{
    "hands_on_practices": [
        {
            "introduction": "Understanding a battery's voltage response to a current load is the cornerstone of equivalent circuit modeling. This first practice challenges you to derive the complete time-domain voltage expression for a simple yet powerful 1-RC model from fundamental circuit laws . Mastering this derivation provides a solid physical intuition for the distinct roles of ohmic resistance, polarization effects, and state-of-charge drift.",
            "id": "3912122",
            "problem": "Consider an Equivalent Circuit Model (ECM) for a lithium-ion cell consisting of an open-circuit voltage source $v_{\\mathrm{oc}}(x)$ dependent on the state of charge (SOC) $x(t)$ (dimensionless, $x \\in [0,1]$), a series ohmic resistance $R_{s}$, and a single first-order polarization branch modeled as a resistor $R_{1}$ in parallel with a capacitor $C_{1}$. The sign convention is that a positive current $I(t)$ corresponds to discharge, so that the terminal voltage $V(t)$ drops relative to $v_{\\mathrm{oc}}(x(t))$ under positive current. Assume the cell is at rest for $t<0$ with $I(t)=0$, polarization voltage initially relaxed, and SOC $x(0)=x_{0}$. At $t=0$, a step discharge current is applied,\n$$\nI(t)=I_{0}\\,\\mathbf{1}_{t\\ge 0},\n$$\nwhere $\\mathbf{1}_{t\\ge 0}$ denotes the indicator function.\n\nStarting only from the following foundational relationships:\n- Kirchhoff’s Voltage Law and Kirchhoff’s Current Law for lumped circuits,\n- The capacitor constitutive relation $i_{C}(t)=C\\,\\frac{dv_{C}}{dt}$,\n- SOC dynamics for a cell of nominal capacity $Q$ (in Coulombs), $\\frac{dx}{dt}=-\\frac{I(t)}{Q}$,\n- A first-order linearization of the open-circuit voltage about $x_{0}$, $v_{\\mathrm{oc}}(x)\\approx v_{\\mathrm{oc}}(x_{0})+k\\,(x-x_{0})$ with $k=\\left.\\frac{dv_{\\mathrm{oc}}}{dx}\\right|_{x_{0}}$,\n\nderive a closed-form expression for the terminal voltage $V(t)$ for $t\\ge 0$ under the stated assumptions, neglecting hysteresis and temperature dependence. Express the terminal voltage formula in volts. The final expression must be a single closed-form analytic function of $t$ and the given parameters $\\{v_{\\mathrm{oc}}(x_{0}),k,x_{0},Q,I_{0},R_{s},R_{1},C_{1}\\}$, with all necessary initial conditions clearly invoked in your derivation. No numerical substitution is required, and no rounding is needed. Provide your final answer as a single analytic expression for $V(t)$.",
            "solution": "The problem provides a complete and consistent set of definitions, initial conditions, and governing physical laws to determine the terminal voltage of a lithium-ion cell, modeled by a first-order equivalent circuit, in response to a step discharge current. The problem is scientifically grounded, well-posed, and objective. Therefore, it is deemed valid and a solution can be derived.\n\nThe equivalent circuit model consists of an open-circuit voltage (OCV) source $v_{\\mathrm{oc}}(x)$, a series resistor $R_{s}$, and a parallel RC branch composed of $R_{1}$ and $C_{1}$. The terminal voltage $V(t)$ is measured across the series combination of these elements. The total current flowing from the cell is denoted by $I(t)$. A positive current corresponds to discharge.\n\nLet $v_{1}(t)$ be the voltage across the parallel RC branch, with the polarity opposing the terminal voltage during discharge. Applying Kirchhoff's Voltage Law (KVL) to the circuit gives the expression for the terminal voltage $V(t)$:\n$$\nV(t) = v_{\\mathrm{oc}}(x(t)) - I(t)R_{s} - v_{1}(t)\n$$\nThe sign convention given in the problem (voltage drops under positive discharge current) confirms the negative signs for the voltage drops across the resistive and polarization elements.\n\nThe derivation proceeds in three parts:\n1.  Deriving the expression for the polarization voltage $v_{1}(t)$.\n2.  Deriving the expression for the state of charge $x(t)$ and subsequently for the OCV $v_{\\mathrm{oc}}(x(t))$.\n3.  Combining these results to obtain the final expression for the terminal voltage $V(t)$.\n\n**1. Polarization Voltage Dynamics**\n\nThe total current $I(t)$ flowing through the cell splits into two paths within the RC branch: the current through the resistor $R_{1}$, denoted $i_{R1}(t)$, and the current through the capacitor $C_{1}$, denoted $i_{C1}(t)$. By Kirchhoff's Current Law (KCL):\n$$\nI(t) = i_{R1}(t) + i_{C1}(t)\n$$\nThe voltage across both parallel elements is $v_{1}(t)$. Using Ohm's law for the resistor and the constitutive relation for the capacitor:\n$$\ni_{R1}(t) = \\frac{v_{1}(t)}{R_{1}}\n$$\n$$\ni_{C1}(t) = C_{1}\\frac{dv_{1}(t)}{dt}\n$$\nSubstituting these into the KCL equation yields a first-order linear ordinary differential equation (ODE) for $v_{1}(t)$:\n$$\nI(t) = \\frac{v_{1}(t)}{R_{1}} + C_{1}\\frac{dv_{1}(t)}{dt}\n$$\nFor $t \\ge 0$, a step current $I(t) = I_{0}$ is applied. The ODE becomes:\n$$\nI_{0} = \\frac{v_{1}(t)}{R_{1}} + C_{1}\\frac{dv_{1}(t)}{dt}\n$$\nRearranging into standard form:\n$$\n\\frac{dv_{1}}{dt} + \\frac{1}{R_{1}C_{1}}v_{1}(t) = \\frac{I_{0}}{C_{1}}\n$$\nThis is a non-homogeneous ODE. The solution is the sum of the homogeneous solution $v_{1,h}(t)$ and a particular solution $v_{1,p}(t)$. The homogeneous equation is $\\frac{dv_{1,h}}{dt} + \\frac{1}{R_{1}C_{1}}v_{1,h} = 0$, which has the solution $v_{1,h}(t) = A\\exp(-t/\\tau_{1})$, where $\\tau_{1} = R_{1}C_{1}$ is the time constant of the RC branch and $A$ is a constant. For a constant input $I_{0}$, the particular solution is a constant, $v_{1,p}(t) = K$. Substituting into the ODE, we get $0 + \\frac{K}{R_{1}C_{1}} = \\frac{I_{0}}{C_{1}}$, which gives $K = I_{0}R_{1}$.\nThe general solution is:\n$$\nv_{1}(t) = A\\exp(-t/\\tau_{1}) + I_{0}R_{1}\n$$\nThe problem states that the polarization voltage is initially relaxed, which means $v_{1}(0) = 0$. Applying this initial condition at $t=0$:\n$$\nv_{1}(0) = 0 = A\\exp(0) + I_{0}R_{1} \\implies A = -I_{0}R_{1}\n$$\nThus, the expression for the polarization voltage for $t \\ge 0$ is:\n$$\nv_{1}(t) = I_{0}R_{1}\\left(1 - \\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)\\right)\n$$\n\n**2. State of Charge and Open-Circuit Voltage Dynamics**\n\nThe state of charge $x(t)$ is governed by the relation:\n$$\n\\frac{dx}{dt} = -\\frac{I(t)}{Q}\n$$\nFor $t \\ge 0$, with $I(t)=I_{0}$, this becomes:\n$$\n\\frac{dx}{dt} = -\\frac{I_{0}}{Q}\n$$\nIntegrating with respect to time from $0$ to $t$, with the initial condition $x(0) = x_{0}$:\n$$\n\\int_{x_{0}}^{x(t)} dx' = \\int_{0}^{t} -\\frac{I_{0}}{Q} dt'\n$$\n$$\nx(t) - x_{0} = -\\frac{I_{0}}{Q}t\n$$\n$$\nx(t) = x_{0} - \\frac{I_{0}}{Q}t\n$$\nNext, we use the provided first-order linearization of the OCV, $v_{\\mathrm{oc}}(x)$, around the initial SOC, $x_{0}$:\n$$\nv_{\\mathrm{oc}}(x) \\approx v_{\\mathrm{oc}}(x_{0}) + k(x-x_{0})\n$$\nwhere $k=\\left.\\frac{dv_{\\mathrm{oc}}}{dx}\\right|_{x_{0}}$. Substituting the expression for $x(t)$ into this approximation gives the time-dependent OCV for $t \\ge 0$:\n$$\nv_{\\mathrm{oc}}(x(t)) = v_{\\mathrm{oc}}(x_{0}) + k\\left(\\left(x_{0} - \\frac{I_{0}}{Q}t\\right) - x_{0}\\right)\n$$\n$$\nv_{\\mathrm{oc}}(x(t)) = v_{\\mathrm{oc}}(x_{0}) - \\frac{k I_{0}}{Q}t\n$$\n\n**3. Assembling the Terminal Voltage Expression**\n\nFinally, we substitute the expressions for $v_{\\mathrm{oc}}(x(t))$ and $v_{1}(t)$ back into the KVL equation for the terminal voltage $V(t)$. For $t \\ge 0$, we have $I(t) = I_{0}$.\n$$\nV(t) = v_{\\mathrm{oc}}(x(t)) - I(t)R_{s} - v_{1}(t)\n$$\n$$\nV(t) = \\left(v_{\\mathrm{oc}}(x_{0}) - \\frac{k I_{0}}{Q}t\\right) - I_{0}R_{s} - I_{0}R_{1}\\left(1 - \\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)\\right)\n$$\nExpanding and rearranging the terms gives the final closed-form expression for the terminal voltage:\n$$\nV(t) = v_{\\mathrm{oc}}(x_{0}) - I_{0}R_{s} - I_{0}R_{1} + I_{0}R_{1}\\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right) - \\frac{k I_{0}}{Q}t\n$$\nThis can be grouped for clarity to show the initial voltage, the linear drift, and the exponential relaxation:\n$$\nV(t) = v_{\\mathrm{oc}}(x_{0}) - I_{0}(R_{s} + R_{1}) - \\frac{k I_{0}}{Q}t + I_{0}R_{1}\\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)\n$$\nThis expression represents the complete voltage response for $t \\ge 0$, incorporating the initial OCV, the instantaneous ohmic voltage drop, the transient polarization effect, and the slow change in OCV due to the change in state of charge.",
            "answer": "$$\\boxed{V(t) = v_{\\mathrm{oc}}(x_{0}) - I_{0}(R_{s} + R_{1}) - \\frac{k I_{0}}{Q}t + I_{0}R_{1}\\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)}$$"
        },
        {
            "introduction": "While continuous-time models describe the underlying physics, real-world battery management systems operate on discrete data samples. This exercise guides you through the crucial process of converting a continuous-time ECM into its exact discrete-time state-space equivalent, which is the standard form used in digital controllers and simulators . This transformation is fundamental for implementing state estimation algorithms and predictive control.",
            "id": "3912067",
            "problem": "Consider an $N$-branch Thevenin equivalent circuit model of a rechargeable cell used in automated battery design and simulation. The model consists of a series ohmic resistance $R_{s}$ and $N$ parallel resistor-capacitor ($R_{k}$–$C_{k}$) branches that capture polarization dynamics. The input is the terminal current $i(t)$, defined positive when discharging. The state of charge $z(t)$ is defined as the fraction of available capacity and evolves by Coulomb counting with total charge capacity $Q$. The open-circuit voltage $E(z)$ is a smooth function of $z$. The branch capacitor voltages $v_{k}(t)$ represent the internal polarization voltages across the $k$-th capacitor. The terminal voltage satisfies $v_{t}(t)=E(z(t))-\\sum_{k=1}^{N} v_{k}(t)-R_{s} i(t)$.\n\nStarting only from the fundamental relations for charge and for resistor-capacitor dynamics—namely, $i_{C_{k}}(t)=C_{k}\\,\\frac{d v_{k}}{dt}$, $v_{R_{k}}(t)=R_{k}\\,i_{R_{k}}(t)$, Kirchhoff’s Current Law $i(t)=i_{R_{k}}(t)+i_{C_{k}}(t)$ for each branch $k$, and Coulomb counting $\\frac{dz}{dt}=-\\frac{i(t)}{Q}$—derive the exact discrete-time, linear, time-invariant state-space model under zero-order hold (piecewise-constant) input over a sampling interval of length $\\Delta t$, and a first-order (affine) small-signal linearization of the voltage measurement about a nominal state-of-charge $z_{0}$.\n\nSpecifically:\n- Define the state vector $x=[\\,z,\\ v_{1},\\ \\dots,\\ v_{N}\\,]^{\\top}$, the input $u=i$, and the output $y=v_{t}$.\n- Linearize the measurement $y(t)$ about $z_{0}$ using a first-order Taylor expansion of $E(z)$ with slope $\\alpha=\\left.\\frac{dE}{dz}\\right|_{z_{0}}$. You may discard any constant offset induced by the linearization by re-centering the output.\n- Using zero-order hold on $u(t)$ over each interval of length $\\Delta t$, obtain the exact sampled model $x_{k+1}=A\\,x_{k}+B\\,u_{k}$ and $y_{k}=C\\,x_{k}+D\\,u_{k}$.\n\nExpress the final result as closed-form analytic expressions for the matrices $(A,B,C,D)$, making clear how $A$ depends on the products $R_{k} C_{k}$ and how $B$ depends on $Q$ and $C_{k}$ through the sampling operation. Your answer must be the four objects $(A,B,C,D)$ arranged as a single row matrix using the LaTeX $\\texttt{pmatrix}$ environment. No numerical evaluation is required. If any approximation is introduced, it must be explicitly justified from the stated physical laws and assumptions. No units are required in the final expression.",
            "solution": "We begin with the fundamental physical relations and definitions that govern the equivalent circuit model of the cell.\n\nThe state of charge $z(t)$ evolves according to Coulomb counting. With the sign convention that $i(t)>0$ for discharge, the rate of change of the state of charge is given by\n$$\n\\frac{d z}{d t}=-\\frac{i(t)}{Q}.\n$$\n\nFor each resistor-capacitor branch $k\\in\\{1,\\dots,N\\}$, Kirchhoff’s Current Law states that the terminal current $i(t)$ splits into the branch resistor current $i_{R_{k}}(t)$ and the branch capacitor current $i_{C_{k}}(t)$:\n$$\ni(t)=i_{R_{k}}(t)+i_{C_{k}}(t).\n$$\nThe constitutive relations for the branch are $v_{R_{k}}(t)=R_{k}\\,i_{R_{k}}(t)$ and $i_{C_{k}}(t)=C_{k}\\,\\frac{d v_{k}}{dt}$, where $v_{k}(t)$ is the capacitor voltage of the $k$-th branch. In the Thevenin model, the branch resistor and capacitor are arranged such that the polarization voltage $v_{k}(t)$ is across both elements, so $v_{R_{k}}(t)=v_{k}(t)$. Substituting these into Kirchhoff’s Current Law gives\n$$\ni(t)=\\frac{v_{k}(t)}{R_{k}}+C_{k}\\,\\frac{d v_{k}}{d t}.\n$$\nRearranging yields a linear first-order differential equation for $v_{k}(t)$:\n$$\n\\frac{d v_{k}}{d t}+\\frac{1}{R_{k} C_{k}}\\,v_{k}(t)=\\frac{i(t)}{C_{k}}.\n$$\nDefining the branch time constant $\\tau_{k}=R_{k} C_{k}$ will be useful for interpreting parameter dependencies.\n\nThe terminal voltage is given by the sum of the open-circuit voltage and the drops across the polarization network and the series resistance:\n$$\nv_{t}(t)=E(z(t))-\\sum_{k=1}^{N} v_{k}(t)-R_{s}\\,i(t).\n$$\nTo obtain a linear time-invariant measurement model suitable for a state-space representation, we linearize $E(z)$ about a nominal state-of-charge $z_{0}$ using a first-order Taylor expansion:\n$$\nE(z)\\approx E(z_{0})+\\left.\\frac{dE}{dz}\\right|_{z_{0}}(z-z_{0})=E(z_{0})+\\alpha\\,(z-z_{0}),\n$$\nwhere $\\alpha=\\left.\\frac{dE}{dz}\\right|_{z_{0}}$. This produces an affine measurement model\n$$\nv_{t}(t)\\approx \\big(E(z_{0})-\\alpha z_{0}\\big)+\\alpha z(t)-\\sum_{k=1}^{N} v_{k}(t)-R_{s}\\,i(t).\n$$\nThe constant offset $\\big(E(z_{0})-\\alpha z_{0}\\big)$ can be removed by re-centering the output. After removing this offset, the linearized measurement becomes\n$$\ny(t)=\\alpha\\,z(t)-\\sum_{k=1}^{N} v_{k}(t)-R_{s}\\,i(t).\n$$\n\nCollect the states into $x(t)=[\\,z(t),\\ v_{1}(t),\\ \\dots,\\ v_{N}(t)\\,]^{\\top}$ and define the input $u(t)=i(t)$ and output $y(t)=v_{t}(t)$, recognizing the linearized form above. The continuous-time state equations are\n$$\n\\frac{d}{dt}\\begin{pmatrix}\nz(t)\\\\\nv_{1}(t)\\\\\n\\vdots\\\\\nv_{N}(t)\n\\end{pmatrix}\n=\n\\underbrace{\\begin{pmatrix}\n0 & 0 & \\cdots & 0\\\\\n0 & -\\frac{1}{R_{1} C_{1}} & \\cdots & 0\\\\\n\\vdots & \\vdots & \\ddots & \\vdots\\\\\n0 & 0 & \\cdots & -\\frac{1}{R_{N} C_{N}}\n\\end{pmatrix}}_{A_{c}}\n\\begin{pmatrix}\nz(t)\\\\\nv_{1}(t)\\\\\n\\vdots\\\\\nv_{N}(t)\n\\end{pmatrix}\n+\n\\underbrace{\\begin{pmatrix}\n-\\frac{1}{Q}\\\\\n\\frac{1}{C_{1}}\\\\\n\\vdots\\\\\n\\frac{1}{C_{N}}\n\\end{pmatrix}}_{B_{c}}\n\\,u(t).\n$$\nThe linearized output equation is\n$$\ny(t)=\\underbrace{\\begin{pmatrix}\n\\alpha & -1 & \\cdots & -1\n\\end{pmatrix}}_{C}\\,\n\\begin{pmatrix}\nz(t)\\\\\nv_{1}(t)\\\\\n\\vdots\\\\\nv_{N}(t)\n\\end{pmatrix}\n+\\underbrace{\\big(-R_{s}\\big)}_{D}\\,u(t).\n$$\n\nWe now discretize the continuous-time model under zero-order hold assumptions: $u(t)$ is held constant over each sampling interval $[k\\Delta t,(k+1)\\Delta t)$. For the state of charge, the exact solution of $\\frac{dz}{dt}=-\\frac{1}{Q}\\,u$ with constant $u$ over the interval gives\n$$\nz((k+1)\\Delta t)=z(k\\Delta t)-\\frac{\\Delta t}{Q}\\,u(k\\Delta t).\n$$\nThus, the discrete-time coefficient on $z$ in $A$ is $1$, and the corresponding entry of $B$ is $-\\frac{\\Delta t}{Q}$.\n\nFor each $k$-th polarization state $v_{k}(t)$, we solve the linear differential equation with constant input over the interval. The exact solution of\n$$\n\\frac{d v_{k}}{d t}+\\frac{1}{\\tau_{k}}\\,v_{k}(t)=\\frac{u}{C_{k}},\\quad \\text{with }u \\text{ constant on }[k\\Delta t,(k+1)\\Delta t),\n$$\nis\n$$\nv_{k}((k+1)\\Delta t)=\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\,v_{k}(k\\Delta t)+\\left(\\frac{u}{C_{k}}\\right)\\int_{0}^{\\Delta t}\\exp\\!\\left(-\\frac{\\Delta t-s}{\\tau_{k}}\\right)\\,ds.\n$$\nEvaluate the integral:\n$$\n\\int_{0}^{\\Delta t}\\exp\\!\\left(-\\frac{\\Delta t-s}{\\tau_{k}}\\right)\\,ds\n=\n\\int_{0}^{\\Delta t}\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\exp\\!\\left(\\frac{s}{\\tau_{k}}\\right)\\,ds\n=\n\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\,\\tau_{k}\\left[\\exp\\!\\left(\\frac{\\Delta t}{\\tau_{k}}\\right)-1\\right]\n=\n\\tau_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\right).\n$$\nHence,\n$$\nv_{k}((k+1)\\Delta t)=\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\,v_{k}(k\\Delta t)+\\left(\\frac{u}{C_{k}}\\right)\\tau_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\right)\n=\n\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\,v_{k}(k\\Delta t)+R_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\right)\\,u(k\\Delta t).\n$$\nThis shows explicitly that the discrete-time state coefficient for $v_{k}$ is $\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)$, exhibiting the dependence of $A$ on the product $R_{k} C_{k}$, and the input coefficient is $R_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\right)$, which depends on $C_{k}$ through the exponential via $\\tau_{k}=R_{k} C_{k}$.\n\nCollecting the discrete-time model, we have\n$$\nx_{k+1}=A\\,x_{k}+B\\,u_{k},\n\\quad\ny_{k}=C\\,x_{k}+D\\,u_{k},\n$$\nwith\n$$\nA=\n\\begin{pmatrix}\n1 & 0 & \\cdots & 0\\\\\n0 & \\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right) & \\cdots & 0\\\\\n\\vdots & \\vdots & \\ddots & \\vdots\\\\\n0 & 0 & \\cdots & \\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\n\\end{pmatrix},\n$$\n$$\nB=\n\\begin{pmatrix}\n-\\frac{\\Delta t}{Q}\\\\\nR_{1}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)\\right)\\\\\n\\vdots\\\\\nR_{N}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\\right)\n\\end{pmatrix},\n\\quad\nC=\n\\begin{pmatrix}\n\\alpha & -1 & \\cdots & -1\n\\end{pmatrix},\n\\quad\nD=-R_{s}.\n$$\n\nDependencies are explicit:\n- The diagonal entries of $A$ for the polarization states depend on the products $R_{k} C_{k}$ via $\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)$.\n- The entries of $B$ depend on $Q$ through $-\\frac{\\Delta t}{Q}$ for the state-of-charge component, and on $C_{k}$ (and $R_{k}$) through $R_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\right)$ for the polarization components.\n\nThese expressions are exact under the stated zero-order hold assumption and the linearization of $E(z)$ about $z_{0}$ with the constant offset removed by re-centering.",
            "answer": "$$\\boxed{\\begin{pmatrix}\n\\begin{pmatrix}\n1 & 0 & \\cdots & 0\\\\\n0 & \\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right) & \\cdots & 0\\\\\n\\vdots & \\vdots & \\ddots & \\vdots\\\\\n0 & 0 & \\cdots & \\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\n\\end{pmatrix}\n&\n\\begin{pmatrix}\n-\\frac{\\Delta t}{Q}\\\\\nR_{1}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)\\right)\\\\\n\\vdots\\\\\nR_{N}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\\right)\n\\end{pmatrix}\n&\n\\begin{pmatrix}\n\\alpha & -1 & \\cdots & -1\n\\end{pmatrix}\n&\n- R_{s}\n\\end{pmatrix} }$$"
        },
        {
            "introduction": "Beyond predicting voltage, ECMs are powerful tools for analyzing battery performance, particularly efficiency and heat generation. In this practice, you will apply the dynamic model to calculate the energy dissipated as heat over a defined load cycle, separating the losses into ohmic and polarization components . This analysis is vital for designing effective thermal management systems and optimizing battery operational efficiency.",
            "id": "3912118",
            "problem": "Consider an Equivalent Circuit Model (ECM) for a rechargeable battery consisting of a series ohmic resistance $R_{s}$ and $K$ polarization branches. Each polarization branch $k \\in \\{1,\\dots,K\\}$ is a resistor-capacitor (RC) network comprised of a resistor $R_{k}$ in parallel with a capacitor $C_{k}$; the branch voltage is denoted $v_{k}(t)$. The terminal current $I(t)$ flows through $R_{s}$ and into each polarization branch, where Kirchhoff’s Current Law (KCL) applies. The load cycle is described by a piecewise-constant current profile $I(t)$ over specified time segments.\n\nFundamental laws to be used:\n- Joule’s law of resistive power: for any resistor with instantaneous current $i(t)$ and resistance $R$, the instantaneous power dissipation is $p(t) = i(t)^{2} R$, and equivalently $p(t) = \\frac{v(t)^{2}}{R}$ in terms of the resistor voltage $v(t)$.\n- The capacitor constitutive relation: for any capacitor with voltage $v(t)$ and capacitance $C$, the instantaneous current is $i_{C}(t) = C \\frac{dv(t)}{dt}$.\n- Kirchhoff’s Current Law (KCL): the algebraic sum of currents entering a node is zero.\n\nStarting from these fundamental laws and definitions, derive the governing dynamics for each polarization branch voltage $v_{k}(t)$ subjected to a piecewise-constant current segment with $I(t) = I_{0}$ over duration $\\Delta t$, and derive from first principles the expression for energy dissipation in:\n- the ohmic resistor $R_{s}$ over the cycle, and\n- the polarization resistors $R_{k}$ over the cycle,\nby integrating the appropriate instantaneous power expressions over time. Explicitly separate the total energy loss into its ohmic and polarization components.\n\nYou must implement a program that, for each test case below, computes three quantities:\n- $E_{\\text{ohmic}}$ in $\\mathrm{J}$ (Joules),\n- $E_{\\text{polarization}}$ in $\\mathrm{J}$ (Joules),\n- $E_{\\text{total}} = E_{\\text{ohmic}} + E_{\\text{polarization}}$ in $\\mathrm{J}$ (Joules).\n\nAssumptions for all test cases:\n- The initial polarization branch voltages satisfy $v_{k}(0) = 0$ for all $k$.\n- Resistances $R_{s}$ and $R_{k}$ are strictly positive in $\\Omega$ (Ohms).\n- Capacitances $C_{k}$ are strictly positive in $\\mathrm{F}$ (Farads).\n- Time durations are strictly positive in $\\mathrm{s}$ (seconds).\n- Currents are in $\\mathrm{A}$ (Amperes) and can be positive (discharge), negative (charge), or zero.\n\nTest suite:\n- Test case $1$:\n  - $R_{s} = 0.015$ $\\Omega$\n  - Polarization branches: $K = 2$ with $(R_{1}, C_{1}) = (0.020$ $\\Omega$, $3000$ $\\mathrm{F})$, $(R_{2}, C_{2}) = (0.060$ $\\Omega$, $800$ $\\mathrm{F})$\n  - Current segments: $\\big(120$ $\\mathrm{A}, 30$ $\\mathrm{s}\\big)$, $\\big(-80$ $\\mathrm{A}, 15$ $\\mathrm{s}\\big)$, $\\big(0$ $\\mathrm{A}, 10$ $\\mathrm{s}\\big)$\n- Test case $2$:\n  - $R_{s} = 0.005$ $\\Omega$\n  - Polarization branches: $K = 1$ with $(R_{1}, C_{1}) = (0.030$ $\\Omega$, $500$ $\\mathrm{F})$\n  - Current segments: $\\big(0$ $\\mathrm{A}, 20$ $\\mathrm{s}\\big)$\n- Test case $3$:\n  - $R_{s} = 0.020$ $\\Omega$\n  - Polarization branches: $K = 3$ with $(R_{1}, C_{1}) = (0.010$ $\\Omega$, $1000$ $\\mathrm{F})$, $(R_{2}, C_{2}) = (0.030$ $\\Omega$, $600$ $\\mathrm{F})$, $(R_{3}, C_{3}) = (0.050$ $\\Omega$, $400$ $\\mathrm{F})$\n  - Current segments: $\\big(200$ $\\mathrm{A}, 0.1$ $\\mathrm{s}\\big)$, $\\big(-200$ $\\mathrm{A}, 0.1$ $\\mathrm{s}\\big)$, $\\big(50$ $\\mathrm{A}, 0.05$ $\\mathrm{s}\\big)$\n- Test case $4$:\n  - $R_{s} = 0.010$ $\\Omega$\n  - Polarization branches: $K = 1$ with $(R_{1}, C_{1}) = (0.050$ $\\Omega$, $2000$ $\\mathrm{F})$\n  - Current segments: $\\big(-150$ $\\mathrm{A}, 40$ $\\mathrm{s}\\big)$\n\nYour program must perform physics-consistent computations based on the above principles and produce the energies for each test case in units of $\\mathrm{J}$ (Joules). The final output format must be a single line containing a comma-separated list of results enclosed in square brackets, where each result is a list of three floating-point numbers $[E_{\\text{ohmic}}, E_{\\text{polarization}}, E_{\\text{total}}]$ rounded to six decimal places. For example, produce output in the form $[[e_{1,o}, e_{1,p}, e_{1,t}], [e_{2,o}, e_{2,p}, e_{2,t}], \\dots]$ where each $e_{\\cdot,\\cdot}$ is a decimal number in $\\mathrm{J}$ rounded to six decimal places.",
            "solution": "The user-provided problem is assessed to be **valid**. It is scientifically grounded in standard electrical circuit theory, internally consistent, well-posed, and contains all necessary information to derive a unique and meaningful solution.\n\n### Principle-Based Solution Design\n\nThe problem requires the derivation and implementation of a solution for calculating energy losses in a battery Equivalent Circuit Model (ECM). The model consists of a series ohmic resistor $R_s$ and $K$ polarization branches. The problem states that \"The terminal current $I(t)$ flows through $R_s$ and into each polarization branch.\" This phrasing, combined with the requirement to derive dynamics for \"each polarization branch voltage $v_k(t)$,\" implies that the $K$ polarization branches are connected in series. In this configuration, the same current $I(t)$ flows through each branch, allowing each branch voltage $v_k(t)$ to evolve independently according to its specific parameters ($R_k, C_k$). The total polarization voltage across all branches is the sum of the individual branch voltages, $\\sum_{k=1}^K v_k(t)$.\n\n#### 1. Derivation of Governing Dynamics\nLet's consider a single polarization branch $k$, which consists of a resistor $R_k$ in parallel with a capacitor $C_k$. The total current flowing into this branch is $I(t)$. According to Kirchhoff’s Current Law (KCL) at the node within the branch, this current splits into a resistive component $I_{R_k}(t)$ and a capacitive component $I_{C_k}(t)$:\n$$I(t) = I_{R_k}(t) + I_{C_k}(t)$$\nFrom Ohm's law, the current through the resistor is $I_{R_k}(t) = v_k(t)/R_k$. From the capacitor's constitutive relation, the current through the capacitor is $I_{C_k}(t) = C_k \\frac{dv_k(t)}{dt}$. Substituting these into the KCL equation yields the governing first-order linear ordinary differential equation (ODE) for the voltage $v_k(t)$ of branch $k$:\n$$I(t) = \\frac{v_k(t)}{R_k} + C_k \\frac{dv_k(t)}{dt}$$\nRearranging this equation into standard form, we get:\n$$\\frac{dv_k(t)}{dt} + \\frac{1}{R_k C_k} v_k(t) = \\frac{I(t)}{C_k}$$\nDefining the time constant of the branch as $\\tau_k = R_k C_k$, the ODE becomes:\n$$\\frac{dv_k(t)}{dt} + \\frac{1}{\\tau_k} v_k(t) = \\frac{I(t)}{C_k}$$\nThe problem specifies a piecewise-constant current profile. For a given time segment of duration $\\Delta t$ where the current is constant, $I(t) = I_0$, the ODE is non-homogeneous with a constant forcing term. The general solution is the sum of a homogeneous solution and a particular solution.\nThe particular solution is the steady-state voltage, $v_{k,ss} = I_0 R_k$.\nThe general solution takes the form $v_k(t) = A e^{-t/\\tau_k} + I_0 R_k$.\nGiven an initial voltage $v_{k,init}$ at the start of the segment (at $t=0$), we can solve for the constant $A$:\n$v_{k,init} = A e^0 + I_0 R_k \\implies A = v_{k,init} - I_0 R_k$.\nThus, the voltage evolution within the segment is:\n$$v_k(t) = (v_{k,init} - I_0 R_k) e^{-t/\\tau_k} + I_0 R_k$$\nThe voltage at the end of the segment of duration $\\Delta t$ is found by evaluating $v_k(\\Delta t)$:\n$$v_{k,final} = (v_{k,init} - I_0 R_k) e^{-\\Delta t/\\tau_k} + I_0 R_k$$\nThis final voltage serves as the initial condition for the next segment. The problem states $v_k(0) = 0$ for all branches.\n\n#### 2. Derivation of Energy Dissipation\nThe total energy loss $E_{\\text{total}}$ is the sum of the ohmic loss $E_{\\text{ohmic}}$ in $R_s$ and the polarization loss $E_{\\text{polarization}}$ across all resistors $R_k$.\n\n**Ohmic Energy Loss ($E_{\\text{ohmic}}$)**\nThe instantaneous power dissipated in the series resistor $R_s$ is given by Joule's law: $p_s(t) = I(t)^2 R_s$. The total energy dissipated over a cycle composed of $M$ segments, where segment $j$ has current $I_j$ and duration $\\Delta t_j$, is the time integral of power:\n$$E_{\\text{ohmic}} = \\int_{cycle} I(t)^2 R_s dt = \\sum_{j=1}^{M} \\int_{t_{j-1}}^{t_j} I_j^2 R_s dt$$\nSince $I_j$ is constant within each segment, the integral is straightforward:\n$$E_{\\text{ohmic}} = \\sum_{j=1}^{M} I_j^2 R_s \\Delta t_j$$\n\n**Polarization Energy Loss ($E_{\\text{polarization}}$)**\nThe total polarization loss is the sum of energy dissipated in each polarization resistor $R_k$: $E_{\\text{polarization}} = \\sum_{k=1}^{K} E_{R_k}$. The energy dissipated in a single resistor $R_k$ over the entire cycle is the time integral of its instantaneous power dissipation, $p_{R_k}(t) = v_k(t)^2 / R_k$.\n$$E_{R_k} = \\int_{cycle} \\frac{v_k(t)^2}{R_k} dt = \\sum_{j=1}^{M} \\int_{0}^{\\Delta t_j} \\frac{v_{k,j}(t)^2}{R_k} dt$$\nwhere $v_{k,j}(t)$ is the voltage function for branch $k$ during segment $j$. Let's substitute the derived expression for $v_k(t)$ for a single segment (with current $I_j$, duration $\\Delta t_j$, and initial voltage $v_{k,j,init}$) into the integral:\n$$E_{R_k, j} = \\frac{1}{R_k} \\int_0^{\\Delta t_j} \\left[ (v_{k,j,init} - I_j R_k) e^{-t/\\tau_k} + I_j R_k \\right]^2 dt$$\nLet $A = v_{k,j,init} - I_j R_k$ and $B = I_j R_k$. The integral becomes:\n$$E_{R_k, j} = \\frac{1}{R_k} \\int_0^{\\Delta t_j} \\left( A^2 e^{-2t/\\tau_k} + 2AB e^{-t/\\tau_k} + B^2 \\right) dt$$\nEvaluating the integral term-by-term yields:\n$$E_{R_k, j} = \\frac{1}{R_k} \\left[ A^2 \\frac{\\tau_k}{2} (1 - e^{-2\\Delta t_j/\\tau_k}) + 2AB\\tau_k (1 - e^{-\\Delta t_j/\\tau_k}) + B^2 \\Delta t_j \\right]$$\nThe total polarization energy is found by summing $E_{R_k,j}$ over all branches $k$ and all segments $j$.\n\n#### 3. Algorithmic Implementation\nThe program will implement the derived formulas for a given set of test cases. For each test case:\n1. Initialize $E_{\\text{ohmic}} = 0$, $E_{\\text{polarization}} = 0$, and the initial voltage for each branch, $v_{k,init} = 0$.\n2. For each current segment $(I_j, \\Delta t_j)$ in the profile:\n    a. Calculate the ohmic energy loss for the segment, $\\Delta E_{\\text{ohmic}} = I_j^2 R_s \\Delta t_j$, and add it to $E_{\\text{ohmic}}$.\n    b. For each polarization branch $k \\in \\{1,\\dots,K\\}$:\n        i. Using the current segment's parameters ($I_j, \\Delta t_j$) and the branch's current state ($v_{k,init}, R_k, C_k$), calculate the energy dissipated, $E_{R_k,j}$, using the integral formula above. Add this to $E_{\\text{polarization}}$.\n        ii. Calculate the branch voltage at the end of the segment, $v_{k,final}$, using the voltage evolution equation. This becomes the initial voltage for the next segment: $v_{k,init} \\leftarrow v_{k,final}$.\n3. After processing all segments, calculate the total energy loss $E_{\\text{total}} = E_{\\text{ohmic}} + E_{\\text{polarization}}$.\n4. Store the triplet $[E_{\\text{ohmic}}, E_{\\text{polarization}}, E_{\\text{total}}]$ for the current test case, ensuring final values are rounded to six decimal places.\n5. After all test cases are processed, format the results into the required output string.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the battery ECM energy loss problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"Rs\": 0.015,\n            \"branches\": [(0.020, 3000), (0.060, 800)],\n            \"profile\": [(120, 30), (-80, 15), (0, 10)],\n        },\n        {\n            \"Rs\": 0.005,\n            \"branches\": [(0.030, 500)],\n            \"profile\": [(0, 20)],\n        },\n        {\n            \"Rs\": 0.020,\n            \"branches\": [(0.010, 1000), (0.030, 600), (0.050, 400)],\n            \"profile\": [(200, 0.1), (-200, 0.1), (50, 0.05)],\n        },\n        {\n            \"Rs\": 0.010,\n            \"branches\": [(0.050, 2000)],\n            \"profile\": [(-150, 40)],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        e_ohmic, e_polarization = calculate_energy(\n            case[\"Rs\"], case[\"branches\"], case[\"profile\"]\n        )\n        e_total = e_ohmic + e_polarization\n        results.append([\n            round(e_ohmic, 6),\n            round(e_polarization, 6),\n            round(e_total, 6),\n        ])\n\n    # Format the final output string as specified\n    result_str = \"[\" + \",\".join([str(res) for res in results]) + \"]\"\n    print(result_str.replace(\" \", \"\"))\n\ndef calculate_energy(Rs, branches, profile):\n    \"\"\"\n    Calculates ohmic and polarization energy losses for a single test case.\n\n    Args:\n        Rs (float): Ohmic series resistance in Ohms.\n        branches (list of tuples): List of (Rk, Ck) tuples for each polarization branch.\n        profile (list of tuples): List of (I, dt) tuples for each current segment.\n\n    Returns:\n        tuple: A tuple containing (E_ohmic, E_polarization) in Joules.\n    \"\"\"\n    num_branches = len(branches)\n    v_initials = np.zeros(num_branches)\n    Rk_vals = np.array([b[0] for b in branches])\n    Ck_vals = np.array([b[1] for b in branches])\n    tau_vals = Rk_vals * Ck_vals\n\n    total_e_ohmic = 0.0\n    total_e_polarization = 0.0\n\n    for I_seg, dt_seg in profile:\n        # 1. Ohmic Loss Calculation\n        e_ohmic_seg = (I_seg**2) * Rs * dt_seg\n        total_e_ohmic += e_ohmic_seg\n\n        # 2. Polarization Loss Calculation for each branch\n        v_finals = np.zeros(num_branches)\n        for k in range(num_branches):\n            Rk, Ck, tau_k = Rk_vals[k], Ck_vals[k], tau_vals[k]\n            v_init = v_initials[k]\n\n            # Calculate energy dissipated in Rk during the segment\n            # Using the direct integral of v_k(t)^2 / Rk\n            A = v_init - I_seg * Rk\n            B = I_seg * Rk\n\n            # Handle tau_k -> 0 or dt_seg/tau_k being very large/small for stability\n            # np.exp handles large negative exponents by returning 0.\n            exp_term1 = np.exp(-dt_seg / tau_k)\n            exp_term2 = np.exp(-2 * dt_seg / tau_k)\n\n            term1 = (A**2) * (tau_k / 2.0) * (1.0 - exp_term2)\n            term2 = 2.0 * A * B * tau_k * (1.0 - exp_term1)\n            term3 = (B**2) * dt_seg\n\n            e_pol_seg_k = (1.0 / Rk) * (term1 + term2 + term3)\n            total_e_polarization += e_pol_seg_k\n\n            # Calculate final voltage for the branch at the end of the segment\n            v_final = A * exp_term1 + B\n            v_finals[k] = v_final\n        \n        v_initials = v_finals\n    \n    return total_e_ohmic, total_e_polarization\n\nsolve()\n```"
        }
    ]
}