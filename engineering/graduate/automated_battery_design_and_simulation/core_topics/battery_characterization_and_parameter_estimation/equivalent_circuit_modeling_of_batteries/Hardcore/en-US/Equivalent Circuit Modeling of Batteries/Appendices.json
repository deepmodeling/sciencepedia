{
    "hands_on_practices": [
        {
            "introduction": "Understanding the transient behavior of a battery is a foundational step in mastering equivalent circuit models. This practice guides you through deriving the terminal voltage response, $V(t)$, for a first-order ECM subjected to a constant current load . By solving the governing differential equations from first principles, you will build a concrete understanding of how the ohmic resistance, $R_s$, and the polarization resistance-capacitance pair, $R_1$ and $C_1$, each contribute to the characteristic shape of the voltage curve.",
            "id": "3912122",
            "problem": "Consider an Equivalent Circuit Model (ECM) for a lithium-ion cell consisting of an open-circuit voltage source $v_{\\mathrm{oc}}(x)$ dependent on the state of charge (SOC) $x(t)$ (dimensionless, $x \\in [0,1]$), a series ohmic resistance $R_{s}$, and a single first-order polarization branch modeled as a resistor $R_{1}$ in parallel with a capacitor $C_{1}$. The sign convention is that a positive current $I(t)$ corresponds to discharge, so that the terminal voltage $V(t)$ drops relative to $v_{\\mathrm{oc}}(x(t))$ under positive current. Assume the cell is at rest for $t0$ with $I(t)=0$, polarization voltage initially relaxed, and SOC $x(0)=x_{0}$. At $t=0$, a step discharge current is applied,\n$$\nI(t)=I_{0}\\,\\mathbf{1}_{t\\ge 0},\n$$\nwhere $\\mathbf{1}_{t\\ge 0}$ denotes the indicator function.\n\nStarting only from the following foundational relationships:\n- Kirchhoff’s Voltage Law and Kirchhoff’s Current Law for lumped circuits,\n- The capacitor constitutive relation $i_{C}(t)=C\\,\\frac{dv_{C}}{dt}$,\n- SOC dynamics for a cell of nominal capacity $Q$ (in Coulombs), $\\frac{dx}{dt}=-\\frac{I(t)}{Q}$,\n- A first-order linearization of the open-circuit voltage about $x_{0}$, $v_{\\mathrm{oc}}(x)\\approx v_{\\mathrm{oc}}(x_{0})+k\\,(x-x_{0})$ with $k=\\left.\\frac{dv_{\\mathrm{oc}}}{dx}\\right|_{x_{0}}$,\n\nderive a closed-form expression for the terminal voltage $V(t)$ for $t\\ge 0$ under the stated assumptions, neglecting hysteresis and temperature dependence. Express the terminal voltage formula in volts. The final expression must be a single closed-form analytic function of $t$ and the given parameters $\\{v_{\\mathrm{oc}}(x_{0}),k,x_{0},Q,I_{0},R_{s},R_{1},C_{1}\\}$, with all necessary initial conditions clearly invoked in your derivation. No numerical substitution is required, and no rounding is needed. Provide your final answer as a single analytic expression for $V(t)$.",
            "solution": "The problem provides a complete and consistent set of definitions, initial conditions, and governing physical laws to determine the terminal voltage of a lithium-ion cell, modeled by a first-order equivalent circuit, in response to a step discharge current. The problem is scientifically grounded, well-posed, and objective. Therefore, it is deemed valid and a solution can be derived.\n\nThe equivalent circuit model consists of an open-circuit voltage (OCV) source $v_{\\mathrm{oc}}(x)$, a series resistor $R_{s}$, and a parallel RC branch composed of $R_{1}$ and $C_{1}$. The terminal voltage $V(t)$ is measured across the series combination of these elements. The total current flowing from the cell is denoted by $I(t)$. A positive current corresponds to discharge.\n\nLet $v_{1}(t)$ be the voltage across the parallel RC branch, with the polarity opposing the terminal voltage during discharge. Applying Kirchhoff's Voltage Law (KVL) to the circuit gives the expression for the terminal voltage $V(t)$:\n$$\nV(t) = v_{\\mathrm{oc}}(x(t)) - I(t)R_{s} - v_{1}(t)\n$$\nThe sign convention given in the problem (voltage drops under positive discharge current) confirms the negative signs for the voltage drops across the resistive and polarization elements.\n\nThe derivation proceeds in three parts:\n1.  Deriving the expression for the polarization voltage $v_{1}(t)$.\n2.  Deriving the expression for the state of charge $x(t)$ and subsequently for the OCV $v_{\\mathrm{oc}}(x(t))$.\n3.  Combining these results to obtain the final expression for the terminal voltage $V(t)$.\n\n**1. Polarization Voltage Dynamics**\n\nThe total current $I(t)$ flowing through the cell splits into two paths within the RC branch: the current through the resistor $R_{1}$, denoted $i_{R1}(t)$, and the current through the capacitor $C_{1}$, denoted $i_{C1}(t)$. By Kirchhoff's Current Law (KCL):\n$$\nI(t) = i_{R1}(t) + i_{C1}(t)\n$$\nThe voltage across both parallel elements is $v_{1}(t)$. Using Ohm's law for the resistor and the constitutive relation for the capacitor:\n$$\ni_{R1}(t) = \\frac{v_{1}(t)}{R_{1}}\n$$\n$$\ni_{C1}(t) = C_{1}\\frac{dv_{1}(t)}{dt}\n$$\nSubstituting these into the KCL equation yields a first-order linear ordinary differential equation (ODE) for $v_{1}(t)$:\n$$\nI(t) = \\frac{v_{1}(t)}{R_{1}} + C_{1}\\frac{dv_{1}(t)}{dt}\n$$\nFor $t \\ge 0$, a step current $I(t) = I_{0}$ is applied. The ODE becomes:\n$$\nI_{0} = \\frac{v_{1}(t)}{R_{1}} + C_{1}\\frac{dv_{1}(t)}{dt}\n$$\nRearranging into standard form:\n$$\n\\frac{dv_{1}}{dt} + \\frac{1}{R_{1}C_{1}}v_{1}(t) = \\frac{I_{0}}{C_{1}}\n$$\nThis is a non-homogeneous ODE. The solution is the sum of the homogeneous solution $v_{1,h}(t)$ and a particular solution $v_{1,p}(t)$. The homogeneous equation is $\\frac{dv_{1,h}}{dt} + \\frac{1}{R_{1}C_{1}}v_{1,h} = 0$, which has the solution $v_{1,h}(t) = A\\exp(-t/\\tau_{1})$, where $\\tau_{1} = R_{1}C_{1}$ is the time constant of the RC branch and $A$ is a constant. For a constant input $I_{0}$, the particular solution is a constant, $v_{1,p}(t) = K$. Substituting into the ODE, we get $0 + \\frac{K}{R_{1}C_{1}} = \\frac{I_{0}}{C_{1}}$, which gives $K = I_{0}R_{1}$.\nThe general solution is:\n$$\nv_{1}(t) = A\\exp(-t/\\tau_{1}) + I_{0}R_{1}\n$$\nThe problem states that the polarization voltage is initially relaxed, which means $v_{1}(0) = 0$. Applying this initial condition at $t=0$:\n$$\nv_{1}(0) = 0 = A\\exp(0) + I_{0}R_{1} \\implies A = -I_{0}R_{1}\n$$\nThus, the expression for the polarization voltage for $t \\ge 0$ is:\n$$\nv_{1}(t) = I_{0}R_{1}\\left(1 - \\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)\\right)\n$$\n\n**2. State of Charge and Open-Circuit Voltage Dynamics**\n\nThe state of charge $x(t)$ is governed by the relation:\n$$\n\\frac{dx}{dt} = -\\frac{I(t)}{Q}\n$$\nFor $t \\ge 0$, with $I(t)=I_{0}$, this becomes:\n$$\n\\frac{dx}{dt} = -\\frac{I_{0}}{Q}\n$$\nIntegrating with respect to time from $0$ to $t$, with the initial condition $x(0) = x_{0}$:\n$$\n\\int_{x_{0}}^{x(t)} dx' = \\int_{0}^{t} -\\frac{I_{0}}{Q} dt'\n$$\n$$\nx(t) - x_{0} = -\\frac{I_{0}}{Q}t\n$$\n$$\nx(t) = x_{0} - \\frac{I_{0}}{Q}t\n$$\nNext, we use the provided first-order linearization of the OCV, $v_{\\mathrm{oc}}(x)$, around the initial SOC, $x_{0}$:\n$$\nv_{\\mathrm{oc}}(x) \\approx v_{\\mathrm{oc}}(x_{0}) + k(x-x_{0})\n$$\nwhere $k=\\left.\\frac{dv_{\\mathrm{oc}}}{dx}\\right|_{x_{0}}$. Substituting the expression for $x(t)$ into this approximation gives the time-dependent OCV for $t \\ge 0$:\n$$\nv_{\\mathrm{oc}}(x(t)) = v_{\\mathrm{oc}}(x_{0}) + k\\left(\\left(x_{0} - \\frac{I_{0}}{Q}t\\right) - x_{0}\\right)\n$$\n$$\nv_{\\mathrm{oc}}(x(t)) = v_{\\mathrm{oc}}(x_{0}) - \\frac{k I_{0}}{Q}t\n$$\n\n**3. Assembling the Terminal Voltage Expression**\n\nFinally, we substitute the expressions for $v_{\\mathrm{oc}}(x(t))$ and $v_{1}(t)$ back into the KVL equation for the terminal voltage $V(t)$. For $t \\ge 0$, we have $I(t) = I_{0}$.\n$$\nV(t) = v_{\\mathrm{oc}}(x(t)) - I(t)R_{s} - v_{1}(t)\n$$\n$$\nV(t) = \\left(v_{\\mathrm{oc}}(x_{0}) - \\frac{k I_{0}}{Q}t\\right) - I_{0}R_{s} - I_{0}R_{1}\\left(1 - \\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)\\right)\n$$\nExpanding and rearranging the terms gives the final closed-form expression for the terminal voltage:\n$$\nV(t) = v_{\\mathrm{oc}}(x_{0}) - I_{0}R_{s} - I_{0}R_{1} + I_{0}R_{1}\\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right) - \\frac{k I_{0}}{Q}t\n$$\nThis can be grouped for clarity to show the initial voltage, the linear drift, and the exponential relaxation:\n$$\nV(t) = v_{\\mathrm{oc}}(x_{0}) - I_{0}(R_{s} + R_{1}) - \\frac{k I_{0}}{Q}t + I_{0}R_{1}\\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)\n$$\nThis expression represents the complete voltage response for $t \\ge 0$, incorporating the initial OCV, the instantaneous ohmic voltage drop, the transient polarization effect, and the slow change in OCV due to the change in state of charge.",
            "answer": "$$\\boxed{v_{\\mathrm{oc}}(x_{0}) - I_{0}(R_{s} + R_{1}) - \\frac{k I_{0}}{Q}t + I_{0}R_{1}\\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)}$$"
        },
        {
            "introduction": "While continuous-time models accurately describe the underlying physics, real-world battery management systems operate in a discrete-time digital domain. This exercise addresses the essential task of converting a continuous-time ECM into a discrete-time state-space representation, defined by the matrices $A$, $B$, $C$, and $D$ . Mastering this procedure is critical for implementing the model in simulations and for designing state estimators, such as the Kalman filter, that run on digital hardware.",
            "id": "3912067",
            "problem": "Consider an $N$-branch Thevenin equivalent circuit model of a rechargeable cell used in automated battery design and simulation. The model consists of a series ohmic resistance $R_{s}$ and $N$ parallel resistor-capacitor ($R_{k}$–$C_{k}$) branches that capture polarization dynamics. The input is the terminal current $i(t)$, defined positive when discharging. The state of charge $z(t)$ is defined as the fraction of available capacity and evolves by Coulomb counting with total charge capacity $Q$. The open-circuit voltage $E(z)$ is a smooth function of $z$. The branch capacitor voltages $v_{k}(t)$ represent the internal polarization voltages across the $k$-th capacitor. The terminal voltage satisfies $v_{t}(t)=E(z(t))-\\sum_{k=1}^{N} v_{k}(t)-R_{s} i(t)$.\n\nStarting only from the fundamental relations for charge and for resistor-capacitor dynamics—namely, $i_{C_{k}}(t)=C_{k}\\,\\frac{d v_{k}}{dt}$, $v_{R_{k}}(t)=R_{k}\\,i_{R_{k}}(t)$, Kirchhoff’s Current Law $i(t)=i_{R_{k}}(t)+i_{C_{k}}(t)$ for each branch $k$, and Coulomb counting $\\frac{dz}{dt}=-\\frac{i(t)}{Q}$—derive the exact discrete-time, linear, time-invariant state-space model under zero-order hold (piecewise-constant) input over a sampling interval of length $\\Delta t$, and a first-order (affine) small-signal linearization of the voltage measurement about a nominal state-of-charge $z_{0}$.\n\nSpecifically:\n- Define the state vector $x=[\\,z,\\ v_{1},\\ \\dots,\\ v_{N}\\,]^{\\top}$, the input $u=i$, and the output $y=v_{t}$.\n- Linearize the measurement $y(t)$ about $z_{0}$ using a first-order Taylor expansion of $E(z)$ with slope $\\alpha=\\left.\\frac{dE}{dz}\\right|_{z_{0}}$. You may discard any constant offset induced by the linearization by re-centering the output.\n- Using zero-order hold on $u(t)$ over each interval of length $\\Delta t$, obtain the exact sampled model $x_{k+1}=A\\,x_{k}+B\\,u_{k}$ and $y_{k}=C\\,x_{k}+D\\,u_{k}$.\n\nExpress the final result as closed-form analytic expressions for the matrices $(A,B,C,D)$, making clear how $A$ depends on the products $R_{k} C_{k}$ and how $B$ depends on $Q$ and $C_{k}$ through the sampling operation. Your answer must be the four objects $(A,B,C,D)$ arranged as a single row matrix using the LaTeX $\\texttt{pmatrix}$ environment. No numerical evaluation is required. If any approximation is introduced, it must be explicitly justified from the stated physical laws and assumptions. No units are required in the final expression.",
            "solution": "We begin with the fundamental physical relations and definitions that govern the equivalent circuit model of the cell.\n\nThe state of charge $z(t)$ evolves according to Coulomb counting. With the sign convention that $i(t)0$ for discharge, the rate of change of the state of charge is given by\n$$\n\\frac{d z}{d t}=-\\frac{i(t)}{Q}.\n$$\n\nFor each resistor-capacitor branch $k\\in\\{1,\\dots,N\\}$, Kirchhoff’s Current Law states that the terminal current $i(t)$ splits into the branch resistor current $i_{R_{k}}(t)$ and the branch capacitor current $i_{C_{k}}(t)$:\n$$\ni(t)=i_{R_{k}}(t)+i_{C_{k}}(t).\n$$\nThe constitutive relations for the branch are $v_{R_{k}}(t)=R_{k}\\,i_{R_{k}}(t)$ and $i_{C_{k}}(t)=C_{k}\\,\\frac{d v_{k}}{dt}$, where $v_{k}(t)$ is the capacitor voltage of the $k$-th branch. In the Thevenin model, the branch resistor and capacitor are arranged such that the polarization voltage $v_{k}(t)$ is across both elements, so $v_{R_{k}}(t)=v_{k}(t)$. Substituting these into Kirchhoff’s Current Law gives\n$$\ni(t)=\\frac{v_{k}(t)}{R_{k}}+C_{k}\\,\\frac{d v_{k}}{d t}.\n$$\nRearranging yields a linear first-order differential equation for $v_{k}(t)$:\n$$\n\\frac{d v_{k}}{d t}+\\frac{1}{R_{k} C_{k}}\\,v_{k}(t)=\\frac{i(t)}{C_{k}}.\n$$\nDefining the branch time constant $\\tau_{k}=R_{k} C_{k}$ will be useful for interpreting parameter dependencies.\n\nThe terminal voltage is given by the sum of the open-circuit voltage and the drops across the polarization network and the series resistance:\n$$\nv_{t}(t)=E(z(t))-\\sum_{k=1}^{N} v_{k}(t)-R_{s}\\,i(t).\n$$\nTo obtain a linear time-invariant measurement model suitable for a state-space representation, we linearize $E(z)$ about a nominal state-of-charge $z_{0}$ using a first-order Taylor expansion:\n$$\nE(z)\\approx E(z_{0})+\\left.\\frac{dE}{dz}\\right|_{z_{0}}(z-z_{0})=E(z_{0})+\\alpha\\,(z-z_{0}),\n$$\nwhere $\\alpha=\\left.\\frac{dE}{dz}\\right|_{z_{0}}$. This produces an affine measurement model\n$$\nv_{t}(t)\\approx \\big(E(z_{0})-\\alpha z_{0}\\big)+\\alpha z(t)-\\sum_{k=1}^{N} v_{k}(t)-R_{s}\\,i(t).\n$$\nThe constant offset $\\big(E(z_{0})-\\alpha z_{0}\\big)$ can be removed by re-centering the output. After removing this offset, the linearized measurement becomes\n$$\ny(t)=\\alpha\\,z(t)-\\sum_{k=1}^{N} v_{k}(t)-R_{s}\\,i(t).\n$$\n\nCollect the states into $x(t)=[\\,z(t),\\ v_{1}(t),\\ \\dots,\\ v_{N}(t)\\,]^{\\top}$ and define the input $u(t)=i(t)$ and output $y(t)=v_{t}(t)$, recognizing the linearized form above. The continuous-time state equations are\n$$\n\\frac{d}{dt}\\begin{pmatrix}\nz(t)\\\\\nv_{1}(t)\\\\\n\\vdots\\\\\nv_{N}(t)\n\\end{pmatrix}\n=\n\\underbrace{\\begin{pmatrix}\n0  0  \\cdots  0\\\\\n0  -\\frac{1}{R_{1} C_{1}}  \\cdots  0\\\\\n\\vdots  \\vdots  \\ddots  \\vdots\\\\\n0  0  \\cdots  -\\frac{1}{R_{N} C_{N}}\n\\end{pmatrix}}_{A_{c}}\n\\begin{pmatrix}\nz(t)\\\\\nv_{1}(t)\\\\\n\\vdots\\\\\nv_{N}(t)\n\\end{pmatrix}\n+\n\\underbrace{\\begin{pmatrix}\n-\\frac{1}{Q}\\\\\n\\frac{1}{C_{1}}\\\\\n\\vdots\\\\\n\\frac{1}{C_{N}}\n\\end{pmatrix}}_{B_{c}}\n\\,u(t).\n$$\nThe linearized output equation is\n$$\ny(t)=\\underbrace{\\begin{pmatrix}\n\\alpha  -1  \\cdots  -1\n\\end{pmatrix}}_{C}\\,\n\\begin{pmatrix}\nz(t)\\\\\nv_{1}(t)\\\\\n\\vdots\\\\\nv_{N}(t)\n\\end{pmatrix}\n+\\underbrace{\\big(-R_{s}\\big)}_{D}\\,u(t).\n$$\n\nWe now discretize the continuous-time model under zero-order hold assumptions: $u(t)$ is held constant over each sampling interval $[k\\Delta t,(k+1)\\Delta t)$. For the state of charge, the exact solution of $\\frac{dz}{dt}=-\\frac{1}{Q}\\,u$ with constant $u$ over the interval gives\n$$\nz((k+1)\\Delta t)=z(k\\Delta t)-\\frac{\\Delta t}{Q}\\,u(k\\Delta t).\n$$\nThus, the discrete-time coefficient on $z$ in $A$ is $1$, and the corresponding entry of $B$ is $-\\frac{\\Delta t}{Q}$.\n\nFor each $k$-th polarization state $v_{k}(t)$, we solve the linear differential equation with constant input over the interval. The exact solution of\n$$\n\\frac{d v_{k}}{d t}+\\frac{1}{\\tau_{k}}\\,v_{k}(t)=\\frac{u}{C_{k}},\\quad \\text{with }u \\text{ constant on }[k\\Delta t,(k+1)\\Delta t),\n$$\nis\n$$\nv_{k}((k+1)\\Delta t)=\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\,v_{k}(k\\Delta t)+\\left(\\frac{u}{C_{k}}\\right)\\int_{0}^{\\Delta t}\\exp\\!\\left(-\\frac{\\Delta t-s}{\\tau_{k}}\\right)\\,ds.\n$$\nEvaluate the integral:\n$$\n\\int_{0}^{\\Delta t}\\exp\\!\\left(-\\frac{\\Delta t-s}{\\tau_{k}}\\right)\\,ds\n=\n\\int_{0}^{\\Delta t}\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\exp\\!\\left(\\frac{s}{\\tau_{k}}\\right)\\,ds\n=\n\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\,\\tau_{k}\\left[\\exp\\!\\left(\\frac{\\Delta t}{\\tau_{k}}\\right)-1\\right]\n=\n\\tau_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\right).\n$$\nHence,\n$$\nv_{k}((k+1)\\Delta t)=\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\,v_{k}(k\\Delta t)+\\left(\\frac{u}{C_{k}}\\right)\\tau_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\right)\n=\n\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\,v_{k}(k\\Delta t)+R_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\right)\\,u(k\\Delta t).\n$$\nThis shows explicitly that the discrete-time state coefficient for $v_{k}$ is $\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)$, exhibiting the dependence of $A$ on the product $R_{k} C_{k}$, and the input coefficient is $R_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\right)$, which depends on $C_{k}$ through the exponential via $\\tau_{k}=R_{k} C_{k}$.\n\nCollecting the discrete-time model, we have\n$$\nx_{k+1}=A\\,x_{k}+B\\,u_{k},\n\\quad\ny_{k}=C\\,x_{k}+D\\,u_{k},\n$$\nwith\n$$\nA=\n\\begin{pmatrix}\n1  0  \\cdots  0\\\\\n0  \\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)  \\cdots  0\\\\\n\\vdots  \\vdots  \\ddots  \\vdots\\\\\n0  0  \\cdots  \\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\n\\end{pmatrix},\n$$\n$$\nB=\n\\begin{pmatrix}\n-\\frac{\\Delta t}{Q}\\\\\nR_{1}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)\\right)\\\\\n\\vdots\\\\\nR_{N}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\\right)\n\\end{pmatrix},\n\\quad\nC=\n\\begin{pmatrix}\n\\alpha  -1  \\cdots  -1\n\\end{pmatrix},\n\\quad\nD=-R_{s}.\n$$\n\nDependencies are explicit:\n- The diagonal entries of $A$ for the polarization states depend on the products $R_{k} C_{k}$ via $\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)$.\n- The entries of $B$ depend on $Q$ through $-\\frac{\\Delta t}{Q}$ for the state-of-charge component, and on $C_{k}$ (and $R_{k}$) through $R_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\right)$ for the polarization components.\n\nThese expressions are exact under the stated zero-order hold assumption and the linearization of $E(z)$ about $z_{0}$ with the constant offset removed by re-centering.",
            "answer": "$$\\boxed{\\begin{pmatrix}\n\\begin{pmatrix}\n1  0  \\cdots  0\\\\\n0  \\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)  \\cdots  0\\\\\n\\vdots  \\vdots  \\ddots  \\vdots\\\\\n0  0  \\cdots  \\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\n\\end{pmatrix}\n\n\\begin{pmatrix}\n-\\frac{\\Delta t}{Q}\\\\\nR_{1}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)\\right)\\\\\n\\vdots\\\\\nR_{N}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\\right)\n\\end{pmatrix}\n\n\\begin{pmatrix}\n\\alpha  -1  \\cdots  -1\n\\end{pmatrix}\n\n- R_{s}\n\\end{pmatrix} }$$"
        },
        {
            "introduction": "The performance of state estimators like the Extended Kalman Filter (EKF) is fundamentally tied to the validity of local linear approximations. This advanced practice delves into the impact of model nonlinearity on state-of-charge (SOC) estimation, a critical function in any battery management system . By analyzing the local curvature of the Open-Circuit Voltage function, $\\mathrm{OCV}''(z)$, you will learn to quantify a primary source of linearization error and understand its consequences for filter accuracy and stability.",
            "id": "3912070",
            "problem": "Consider a canonical one resistor–one capacitor equivalent circuit model of a lithium-ion cell used in automated battery design and simulation. The state vector is $x = (z, v_{1})^{\\top}$, where $z \\in (0,1)$ is the dimensionless State of Charge (SOC) and $v_{1}$ is the voltage across the polarization capacitor. The input is the cell current $i$, taken positive for discharge. The SOC dynamics obey Faraday’s law of charge balance, and the polarization voltage follows linear time-invariant resistor–capacitor dynamics. The static voltage measurement is modeled as $y = h(x,i) + w$, where $w$ is zero-mean measurement noise and $h(x,i)$ is the smooth measurement function arising from superposition of the Open-Circuit Voltage (OCV) and circuit drops. The Extended Kalman Filter (EKF) linearizes the measurement map $h(x,i)$ about the predicted state to perform the correction step.\n\nSuppose the Open-Circuit Voltage (OCV) is represented by a smooth quintic polynomial in SOC,\n$$\n\\mathrm{OCV}(z) = \\alpha_{0} + \\alpha_{1} z + \\alpha_{2} z^{2} + \\alpha_{3} z^{3} + \\alpha_{4} z^{4} + \\alpha_{5} z^{5},\n$$\nwith real coefficients $\\alpha_{k}$ and $z \\in (0,1)$. Let the measurement function be\n$$\nh(x,i) = \\mathrm{OCV}(z) - v_{1} - R_{0} \\, i,\n$$\nwhere $R_{0}  0$ is the series ohmic resistance. The EKF uses the first-order Taylor expansion of $h$ about the predicted state to compute the measurement Jacobian. In a local neighborhood of a predicted SOC $\\hat{z}$, assume the SOC estimation error $e_{z} = z - \\hat{z}$ is small, and the predicted SOC variance is $P_{zz} = \\mathbb{E}[e_{z}^{2}]$. The scalar measurement noise variance is $R = \\mathbb{E}[w^{2}]$, and the SOC component of the Kalman gain is $K_{z}$.\n\nTasks:\n1. Starting from the given polynomial, compute the local curvature $\\mathrm{OCV}''(z)$ as an explicit analytic expression in $z$ and the coefficients $\\alpha_{k}$.\n2. Using the second-order Taylor expansion of $h$ with respect to $z$ about $\\hat{z}$, derive the leading-order expression for the measurement-model linearization error term in the residual due to truncating the Taylor series, and show how the curvature $\\mathrm{OCV}''(\\hat{z})$ enters.\n3. Under the requirement that the magnitude of the EKF correction contributed by the second-order residual mismatch remains smaller than one-half of the standard deviation of the measurement noise, derive a conservative upper bound on $|K_{z}|$ in terms of $P_{zz}$, $R$, and a local supremum $M = \\sup_{z \\in \\mathcal{N}} |\\mathrm{OCV}''(z)|$ over a neighborhood $\\mathcal{N}$ containing $\\hat{z}$. Express the bound as an inequality on $|K_{z}|$.\n\nYour final answer must be the explicit analytic expression for $\\mathrm{OCV}''(z)$ alone. No numerical evaluation is required, and no units should be included in the final answer box.",
            "solution": "The problem statement has been validated and is deemed to be scientifically grounded, well-posed, and objective. It presents a standard problem in nonlinear state estimation for battery management systems, using established models (equivalent circuit, polynomial OCV) and methods (Extended Kalman Filter). All provided information is self-contained and sufficient for the derivations requested. The problem is valid.\n\nThe solution proceeds by addressing the three tasks in sequence.\n\nTask 1: Compute the local curvature $\\mathrm{OCV}''(z)$.\nThe Open-Circuit Voltage (OCV) is given as a quintic polynomial function of the State of Charge (SOC), $z$:\n$$\n\\mathrm{OCV}(z) = \\alpha_{0} + \\alpha_{1} z + \\alpha_{2} z^{2} + \\alpha_{3} z^{3} + \\alpha_{4} z^{4} + \\alpha_{5} z^{5}\n$$\nTo find the curvature, we must compute the second derivative of $\\mathrm{OCV}(z)$ with respect to $z$. First, we compute the first derivative, $\\mathrm{OCV}'(z)$, by applying the power rule of differentiation term-by-term:\n$$\n\\mathrm{OCV}'(z) = \\frac{d}{dz} \\left( \\alpha_{0} + \\alpha_{1} z + \\alpha_{2} z^{2} + \\alpha_{3} z^{3} + \\alpha_{4} z^{4} + \\alpha_{5} z^{5} \\right)\n$$\n$$\n\\mathrm{OCV}'(z) = 0 + \\alpha_{1} \\cdot (1)z^{0} + \\alpha_{2} \\cdot (2)z^{1} + \\alpha_{3} \\cdot (3)z^{2} + \\alpha_{4} \\cdot (4)z^{3} + \\alpha_{5} \\cdot (5)z^{4}\n$$\n$$\n\\mathrm{OCV}'(z) = \\alpha_{1} + 2 \\alpha_{2} z + 3 \\alpha_{3} z^{2} + 4 \\alpha_{4} z^{3} + 5 \\alpha_{5} z^{4}\n$$\nThis expression represents the slope of the OCV-SOC curve, which is a component of the measurement Jacobian.\n\nNext, we differentiate $\\mathrm{OCV}'(z)$ with respect to $z$ to find the second derivative, $\\mathrm{OCV}''(z)$:\n$$\n\\mathrm{OCV}''(z) = \\frac{d}{dz} \\left( \\alpha_{1} + 2 \\alpha_{2} z + 3 \\alpha_{3} z^{2} + 4 \\alpha_{4} z^{3} + 5 \\alpha_{5} z^{4} \\right)\n$$\n$$\n\\mathrm{OCV}''(z) = 0 + 2 \\alpha_{2} \\cdot (1)z^{0} + 3 \\alpha_{3} \\cdot (2)z^{1} + 4 \\alpha_{4} \\cdot (3)z^{2} + 5 \\alpha_{5} \\cdot (4)z^{3}\n$$\n$$\n\\mathrm{OCV}''(z) = 2 \\alpha_{2} + 6 \\alpha_{3} z + 12 \\alpha_{4} z^{2} + 20 \\alpha_{5} z^{3}\n$$\nThis is the explicit analytic expression for the curvature of the OCV function.\n\nTask 2: Derive the leading-order linearization error term.\nThe measurement function is $h(x,i) = \\mathrm{OCV}(z) - v_{1} - R_{0} i$. The EKF linearizes this function around the predicted state $\\hat{x} = (\\hat{z}, \\hat{v}_{1})^{\\top}$. The true measurement is $y = h(x,i) + w$. The predicted measurement is $\\hat{y} = h(\\hat{x},i)$. The measurement residual is $\\tilde{y} = y - \\hat{y}$.\n$$\n\\tilde{y} = (h(x,i) + w) - h(\\hat{x},i) = (\\mathrm{OCV}(z) - v_{1} - R_{0}i + w) - (\\mathrm{OCV}(\\hat{z}) - \\hat{v}_{1} - R_{0}i)\n$$\n$$\n\\tilde{y} = (\\mathrm{OCV}(z) - \\mathrm{OCV}(\\hat{z})) - (v_{1} - \\hat{v}_{1}) + w\n$$\nLet the state estimation errors be $e_{z} = z - \\hat{z}$ and $e_{v1} = v_{1} - \\hat{v}_{1}$. Then $z = \\hat{z} + e_{z}$ and $v_{1} = \\hat{v}_{1} + e_{v1}$.\nWe perform a second-order Taylor series expansion of $\\mathrm{OCV}(z)$ around the predicted SOC, $\\hat{z}$:\n$$\n\\mathrm{OCV}(z) = \\mathrm{OCV}(\\hat{z} + e_{z}) \\approx \\mathrm{OCV}(\\hat{z}) + \\mathrm{OCV}'(\\hat{z}) e_{z} + \\frac{1}{2} \\mathrm{OCV}''(\\hat{z}) e_{z}^{2}\n$$\nSubstituting this into the expression for the residual:\n$$\n\\tilde{y} \\approx \\left( \\mathrm{OCV}(\\hat{z}) + \\mathrm{OCV}'(\\hat{z}) e_{z} + \\frac{1}{2} \\mathrm{OCV}''(\\hat{z}) e_{z}^{2} - \\mathrm{OCV}(\\hat{z}) \\right) - e_{v1} + w\n$$\n$$\n\\tilde{y} \\approx \\mathrm{OCV}'(\\hat{z}) e_{z} - e_{v1} + w + \\frac{1}{2} \\mathrm{OCV}''(\\hat{z}) e_{z}^{2}\n$$\nThe standard EKF model of the residual is based on a first-order linearization: $\\tilde{y}_{EKF} = H(x-\\hat{x}) + w$, where the measurement Jacobian is $H = \\left[ \\frac{\\partial h}{\\partial z} \\quad \\frac{\\partial h}{\\partial v_1} \\right]\\bigg|_{x=\\hat{x}} = [\\mathrm{OCV}'(\\hat{z}) \\quad -1]$. Thus:\n$$\n\\tilde{y}_{EKF} = \\mathrm{OCV}'(\\hat{z}) e_{z} - e_{v1} + w\n$$\nThe measurement-model linearization error is the difference between the second-order approximation of the residual and the first-order approximation used by the EKF. The leading-order term of this error, which we denote as $\\delta\\tilde{y}$, is:\n$$\n\\delta\\tilde{y} = \\tilde{y} - \\tilde{y}_{EKF} \\approx \\frac{1}{2} \\mathrm{OCV}''(\\hat{z}) e_{z}^{2}\n$$\nThis expression demonstrates that the leading-order linearization error in the residual is proportional to the local curvature of the OCV function at the predicted SOC, $\\mathrm{OCV}''(\\hat{z})$, and the square of the SOC estimation error, $e_{z}^2$.\n\nTask 3: Derive an upper bound on $|K_z|$.\nThe EKF state update for the SOC is given by $\\hat{z}^{+} = \\hat{z}^{-} + K_{z} \\tilde{y}$, where $\\hat{z}^{-}$ is the predicted SOC and $\\hat{z}^{+}$ is the corrected SOC. The correction to the SOC state is $\\Delta z = K_{z} \\tilde{y}$.\nThe EKF operates on the true residual $\\tilde{y}$, which includes the linearization error term $\\delta\\tilde{y}$. The portion of the SOC correction that is due to this unmodeled second-order term is:\n$$\n\\Delta z_{err} = K_{z} \\cdot \\delta\\tilde{y} \\approx K_{z} \\left( \\frac{1}{2} \\mathrm{OCV}''(\\hat{z}) e_{z}^{2} \\right)\n$$\nThis term represents a bias in the state update. A robust filter design requires this bias to be small. The problem states that the magnitude of this correction must remain smaller than one-half of the standard deviation of the measurement noise, $\\frac{1}{2}\\sqrt{R}$.\nThis condition applies to the bias introduced in the update. The expected value of this bias term is:\n$$\n\\mathbb{E}[\\Delta z_{err}] \\approx \\mathbb{E} \\left[ \\frac{1}{2} K_{z} \\mathrm{OCV}''(\\hat{z}) e_{z}^{2} \\right] = \\frac{1}{2} K_{z} \\mathrm{OCV}''(\\hat{z}) \\mathbb{E}[e_{z}^{2}]\n$$\nUsing the given definition $P_{zz} = \\mathbb{E}[e_{z}^{2}]$, the expected bias is $\\frac{1}{2} K_{z} \\mathrm{OCV}''(\\hat{z}) P_{zz}$. The requirement is on its magnitude:\n$$\n\\left| \\frac{1}{2} K_{z} \\mathrm{OCV}''(\\hat{z}) P_{zz} \\right|  \\frac{1}{2} \\sqrt{R}\n$$\nSimplifying the constant $\\frac{1}{2}$ and applying properties of absolute value:\n$$\n|K_{z}| |\\mathrm{OCV}''(\\hat{z})| P_{zz}  \\sqrt{R}\n$$\nTo derive a conservative upper bound, we must consider the worst-case value of the curvature in the local neighborhood $\\mathcal{N}$ of $\\hat{z}$. The problem provides this as $M = \\sup_{z \\in \\mathcal{N}} |\\mathrm{OCV}''(z)|$. Replacing $|\\mathrm{OCV}''(\\hat{z})|$ with $M$ ensures the condition holds for any $\\hat{z}$ in the neighborhood:\n$$\n|K_{z}| M P_{zz}  \\sqrt{R}\n$$\nFinally, we can express the upper bound on $|K_{z}|$ by isolating it:\n$$\n|K_{z}|  \\frac{\\sqrt{R}}{M P_{zz}}\n$$\nThis inequality provides a conservative upper bound on the magnitude of the SOC component of the Kalman gain to limit the bias introduced by the second-order nonlinearity of the OCV function.",
            "answer": "$$\n\\boxed{2 \\alpha_{2} + 6 \\alpha_{3} z + 12 \\alpha_{4} z^{2} + 20 \\alpha_{5} z^{3}}\n$$"
        }
    ]
}