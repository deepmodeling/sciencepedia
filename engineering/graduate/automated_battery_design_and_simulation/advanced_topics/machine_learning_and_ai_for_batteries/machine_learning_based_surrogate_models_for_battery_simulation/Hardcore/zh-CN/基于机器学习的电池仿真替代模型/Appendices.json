{
    "hands_on_practices": [
        {
            "introduction": "全尺寸的电池仿真会产生海量数据，例如整个电解质区域的电势场。主成分分析 (Principal Component Analysis, PCA) 提供了一种严谨的方法，通过识别最主要的几种空间模式来压缩这些数据。本练习将引导您深入了解 PCA 的基本理论，证明它如何最小化重构误差，并揭示其特征值如何量化每个空间模式所捕获的物理场方差 。",
            "id": "3926888",
            "problem": "在一个锂离子电池电解质域中，一个零均值的电解质电势场经过空间离散化后，由一个随机向量 $\\boldsymbol{\\phi}\\in\\mathbb{R}^{M}$ 表示，其协方差矩阵为 $\\mathbf{C}=\\mathbb{E}[\\boldsymbol{\\phi}\\boldsymbol{\\phi}^{\\top}]$。假设 $\\mathbf{C}$ 是对称半正定的，其特征分解为 $\\mathbf{C}=\\mathbf{U}\\,\\boldsymbol{\\Lambda}\\,\\mathbf{U}^{\\top}$，其中 $\\mathbf{U}=\\big[\\mathbf{u}_{1},\\dots,\\mathbf{u}_{M}\\big]$ 是标准正交的，$\\boldsymbol{\\Lambda}=\\operatorname{diag}(\\lambda_{1},\\dots,\\lambda_{M})$ 的特征值按 $\\lambda_{1}\\ge\\lambda_{2}\\ge\\cdots\\ge\\lambda_{M}\\ge 0$ 排序。考虑通过正交投影到一个k维子空间得到的电解质电势场的线性秩-k代理模型，特别是投影到由前k个特征向量张成的子空间（主成分分析，PCA）。在整个问题中，使用欧几里得范数，并假设离散化已被缩放，使得 $\\|\\boldsymbol{\\phi}\\|_{2}^{2}$ 的单位为平方伏特。\n\n任务：\n- 仅从协方差、正交投影和谱定理的定义出发，推导在所有秩-k线性代理模型中可实现的最小期望平方重构误差 $\\mathbb{E}\\big[\\|\\boldsymbol{\\phi}-\\hat{\\boldsymbol{\\phi}}\\|_{2}^{2}\\big]$ 的表达式，并证明PCA代理模型达到了这个最小值。用特征值 $\\{\\lambda_{i}\\}_{i=1}^{M}$ 表示结果。然后，解释其对于电解质电势场的物理意义。\n- 对于一个离散化为 $M\\ge 5$ 个节点的特定电解质数据集，测得前五个特征值（单位为平方伏特）为\n$$\n\\lambda_{1}=3.2\\times 10^{-4},\\quad\n\\lambda_{2}=1.6\\times 10^{-4},\\quad\n\\lambda_{3}=8.0\\times 10^{-5},\\quad\n\\lambda_{4}=4.0\\times 10^{-5},\\quad\n\\lambda_{5}=2.0\\times 10^{-5},\n$$\n对于本问题而言，所有后续特征值均可忽略不计。如果使用 $k=2$ 的PCA代理模型，计算你的推导所蕴含的最小期望平方重构误差界的数值。将你的答案四舍五入到四位有效数字，并以平方伏特为单位表示。",
            "solution": "我们从定义开始。设 $\\boldsymbol{\\phi}\\in\\mathbb{R}^{M}$ 是一个零均值随机向量，其协方差为 $\\mathbf{C}=\\mathbb{E}[\\boldsymbol{\\phi}\\boldsymbol{\\phi}^{\\top}]$。考虑由一个到k维子空间的正交投影算子 $\\mathbf{P}$ 构成的任意秩-k线性代理模型，因此重构为 $\\hat{\\boldsymbol{\\phi}}=\\mathbf{P}\\boldsymbol{\\phi}$，其中 $\\mathbf{P}^{2}=\\mathbf{P}$，$\\mathbf{P}^{\\top}=\\mathbf{P}$，且 $\\operatorname{rank}(\\mathbf{P})=k$。期望平方重构误差为\n$$\n\\mathbb{E}\\big[\\|\\boldsymbol{\\phi}-\\hat{\\boldsymbol{\\phi}}\\|_{2}^{2}\\big]\n=\\mathbb{E}\\big[\\|(\\mathbf{I}-\\mathbf{P})\\boldsymbol{\\phi}\\|_{2}^{2}\\big]\n=\\mathbb{E}\\big[\\boldsymbol{\\phi}^{\\top}(\\mathbf{I}-\\mathbf{P})^{\\top}(\\mathbf{I}-\\mathbf{P})\\boldsymbol{\\phi}\\big].\n$$\n由于 $\\mathbf{P}$ 是一个正交投影算子，$(\\mathbf{I}-\\mathbf{P})^{\\top}(\\mathbf{I}-\\mathbf{P})=\\mathbf{I}-\\mathbf{P}$。利用迹的循环性质以及 $\\mathbb{E}[\\boldsymbol{\\phi}\\boldsymbol{\\phi}^{\\top}]=\\mathbf{C}$ 这一事实，我们有\n$$\n\\mathbb{E}\\big[\\|\\boldsymbol{\\phi}-\\hat{\\boldsymbol{\\phi}}\\|_{2}^{2}\\big]\n=\\mathbb{E}\\big[\\operatorname{tr}\\big((\\mathbf{I}-\\mathbf{P})\\boldsymbol{\\phi}\\boldsymbol{\\phi}^{\\top}\\big)\\big]\n=\\operatorname{tr}\\big((\\mathbf{I}-\\mathbf{P})\\,\\mathbb{E}[\\boldsymbol{\\phi}\\boldsymbol{\\phi}^{\\top}]\\big)\n=\\operatorname{tr}\\big((\\mathbf{I}-\\mathbf{P})\\,\\mathbf{C}\\big).\n$$\n写出谱分解 $\\mathbf{C}=\\mathbf{U}\\boldsymbol{\\Lambda}\\mathbf{U}^{\\top}$ 并定义 $\\tilde{\\mathbf{P}}=\\mathbf{U}^{\\top}\\mathbf{P}\\mathbf{U}$，它也是一个秩为k的正交投影算子（合同变换保持幂等性和秩）。那么\n$$\n\\operatorname{tr}\\big((\\mathbf{I}-\\mathbf{P})\\,\\mathbf{C}\\big)\n=\\operatorname{tr}\\big((\\mathbf{I}-\\mathbf{P})\\,\\mathbf{U}\\boldsymbol{\\Lambda}\\mathbf{U}^{\\top}\\big)\n=\\operatorname{tr}\\big(\\mathbf{U}^{\\top}(\\mathbf{I}-\\mathbf{P})\\mathbf{U}\\,\\boldsymbol{\\Lambda}\\big)\n=\\operatorname{tr}\\big((\\mathbf{I}-\\tilde{\\mathbf{P}})\\,\\boldsymbol{\\Lambda}\\big).\n$$\n因为 $\\boldsymbol{\\Lambda}$ 是对角矩阵，其对角元为 $\\lambda_{1},\\dots,\\lambda_{M}$，且 $\\tilde{\\mathbf{P}}$ 是一个秩为k的投影算子，所以量 $\\operatorname{tr}((\\mathbf{I}-\\tilde{\\mathbf{P}})\\boldsymbol{\\Lambda})$ 等于那些其索引对应于被投影算子排除的方向的 $\\lambda_{i}$ 的和。在所有秩-k正交投影算子中，最小值是通过选择 $\\tilde{\\mathbf{P}}$ 来选取 $\\boldsymbol{\\Lambda}$ 的k个最大对角元来实现的，即投影到前k个特征向量张成的空间。这是重排不等式或等价的Ky Fan最大值原理的结果，该原理指出，对于任何特征值按非增顺序排列的对称矩阵 $\\mathbf{A}$，在所有秩-k正交投影算子 $\\mathbf{P}$ 中 $\\operatorname{tr}(\\mathbf{P}\\mathbf{A})$ 的最大值是 $\\sum_{i=1}^{k}\\lambda_{i}(\\mathbf{A})$。将此应用于 $\\mathbf{A}=\\mathbf{C}$ 可得\n$$\n\\min_{\\substack{\\mathbf{P}^{\\top}=\\mathbf{P}=\\mathbf{P}^{2}\\\\ \\operatorname{rank}(\\mathbf{P})=k}}\\operatorname{tr}\\big((\\mathbf{I}-\\mathbf{P})\\,\\mathbf{C}\\big)\n=\\operatorname{tr}(\\mathbf{C})-\\max_{\\mathbf{P}}\\operatorname{tr}(\\mathbf{P}\\mathbf{C})\n=\\Big(\\sum_{i=1}^{M}\\lambda_{i}\\Big)-\\Big(\\sum_{i=1}^{k}\\lambda_{i}\\Big)\n=\\sum_{i=k+1}^{M}\\lambda_{i}.\n$$\n因此，在所有秩-k线性代理模型中，可实现的最小期望平方重构误差为\n$$\n\\mathbb{E}\\big[\\|\\boldsymbol{\\phi}-\\hat{\\boldsymbol{\\phi}}\\|_{2}^{2}\\big]_{\\min}=\\sum_{i=k+1}^{M}\\lambda_{i},\n$$\n而投影到前k个特征向量张成空间的主成分分析 (PCA) 代理模型达到了这个最小值。这个量也作为一个误差界，因为任何其他秩-k线性重构的期望平方误差都不会更小。\n\n对电解质电势场的物理解释：特征值 $\\{\\lambda_{i}\\}$ 是随机场 $\\boldsymbol{\\phi}$ 沿着正交空间模式（特征向量）的方差，这些模式捕获了不同操作条件下电解质电势波动的相干模式。和 $\\sum_{i=k+1}^{M}\\lambda_{i}$ 等于存在于被忽略模式中的总方差。因此，该界定量化了任何秩-k线性代理模型必须舍弃的平均未解析的平方电解质电势波动。在实际应用中，它衡量了所选的k维表示未能捕获的电解质电势特征——例如小尺度欧姆压降和由曲折度引起的非均匀性——的均方大小（单位为平方伏特）。\n\n现在，当使用 $k=2$ 时，为给定的谱计算该界。由于\n$$\n\\lambda_{1}=3.2\\times 10^{-4},\\quad\n\\lambda_{2}=1.6\\times 10^{-4},\\quad\n\\lambda_{3}=8.0\\times 10^{-5},\\quad\n\\lambda_{4}=4.0\\times 10^{-5},\\quad\n\\lambda_{5}=2.0\\times 10^{-5},\n$$\n且所有后续特征值均可忽略不计，我们有\n$$\n\\sum_{i=k+1}^{M}\\lambda_{i}=\\lambda_{3}+\\lambda_{4}+\\lambda_{5}\n=\\big(8.0\\times 10^{-5}\\big)+\\big(4.0\\times 10^{-5}\\big)+\\big(2.0\\times 10^{-5}\\big)\n=1.4\\times 10^{-4}.\n$$\n四舍五入到四位有效数字并以平方伏特为单位表示，最小期望平方重构误差界为 $1.400\\times 10^{-4}$。",
            "answer": "$$\\boxed{1.400 \\times 10^{-4}}$$"
        },
        {
            "introduction": "为耦合系统（如电池的电热模型）训练物理信息神经网络 (Physics-Informed Neural Network, PINN) 时，需要处理一个包含多个损失项的复杂损失函数，这些项分别对应数据拟合和物理定律。本编程练习将通过实现一种基于同方差不确定性的先进损失加权方案，来解决平衡这些通常具有不同量纲和数量级的损失项这一关键挑战 。这项动手任务对于实现稳定的训练和构建无偏的代理模型至关重要。",
            "id": "3926887",
            "problem": "您正在设计一个基于机器学习的代理模型，用于耦合电热伪二维 (P2D) 电池模型。该代理模型使用数据监督和源于连续介质守恒定律的物理约束进行训练。具体来说，电化学部分遵循质量守恒、电荷守恒和本构关系，热学部分则遵循能量守恒。其底层物理学由偏微分方程 (PDE) 编码，通过惩罚在配置点上计算的控制算子残差来促进其满足。训练目标必须在电化学和热学分量之间平衡数据保真度和物理残差，无偏倚，同时确保单位一致和数值稳定的聚合。\n\n从以下基本出发点开始：\n- 质量、电荷和能量的守恒定律意味着存在形式为 $\\mathcal{F}_{c}(u_{c}) = 0$ 的 PDE 关系，其中 $c$ 为分量，$ \\mathcal{F}_{c}$ 是一个微分算子，$u_{c}$ 表示状态场。\n- 在具有同方差（任务相关）噪声的高斯观测模型下，残差向量 $z$ 的负对数似然（其尺度为 $\\sigma$）与 $\\|z\\|^{2}/(2\\sigma^{2}) + \\log \\sigma$ 成正比。\n\n为每个分量 $c \\in \\{\\text{electrochemical}, \\text{thermal}\\}$ 定义两个任务项：\n- 一个数据拟合项 $D_{c}$，由观测值与预测值之差 $\\Delta_{d,c}$ 和特征数据尺度 $s_{d,c}$ 计算得出。\n- 一个物理残差项 $P_{c}$，由 PDE 残差 $r_{c}$ 和特征残差尺度 $s_{r,c}$ 计算得出。\n\n为消除单位并改善条件数，通过各自的尺度对每个项进行归一化，并使用均方值：\n$$\nD_{c} \\equiv \\frac{1}{N_{d,c}} \\sum_{i=1}^{N_{d,c}} \\left(\\frac{\\Delta_{d,c,i}}{s_{d,c}}\\right)^{2}, \n\\quad\nP_{c} \\equiv \\frac{1}{N_{r,c}} \\sum_{j=1}^{N_{r,c}} \\left(\\frac{r_{c,j}}{s_{r,c}}\\right)^{2},\n$$\n约定当 $N_{d,c} = 0$ 或 $N_{r,c} = 0$ 时，相应的项按如下规定处理。\n\n使用同方差不确定性加权方法聚合四个任务 $\\{D_{\\text{electrochemical}}, P_{\\text{electrochemical}}, D_{\\text{thermal}}, P_{\\text{thermal}}\\}$。为每个任务 $i$ 引入一个正噪声尺度 $\\sigma_{i}$，并定义复合目标：\n$$\n\\mathcal{L}(\\{\\sigma_{i}\\}) \n= \\sum_{i} \\left( \\frac{T_{i}}{2\\sigma_{i}^{2}} + \\log \\sigma_{i} \\right),\n\\quad \\text{with} \\quad\nT_{i} \\in \\{D_{\\text{electrochemical}}, P_{\\text{electrochemical}}, D_{\\text{thermal}}, P_{\\text{thermal}}\\}.\n$$\n通过对每个 $\\sigma_{i}$ 最小化 $\\mathcal{L}$ 来消除 $\\{\\sigma_{i}\\}$，这将得到一个仅依赖于 $\\{T_{i}\\}$ 的平衡、闭式损失。为确保数值稳定性和对数的良定义，使用截断值\n$$\n\\tilde{T}_{i} = \\max\\left(T_{i}, \\epsilon^{2}\\right),\n$$\n其中 $\\epsilon$ 是一个很小的正常数。然后计算最小化的平衡目标\n$$\n\\mathcal{L}^{\\star} = \\frac{1}{2} \\sum_{i} \\left( 1 + \\log \\tilde{T}_{i} \\right),\n$$\n其中 $\\log$ 表示自然对数。该目标是无量纲的，因为每个 $T_{i}$ 都是由归一化量构建的。\n\n实现一个程序，根据上述定义，为下面的每个测试用例计算标量 $\\mathcal{L}^{\\star}$。如果一个任务没有样本（即空向量），则将其未截断的均方值视为未定义，并直接设置 $\\tilde{T}_{i} = \\epsilon^{2}$。使用 $\\epsilon = 10^{-12}$。\n\n您的程序必须处理以下测试套件。在每种情况下，最终的标量目标必须表示为无量纲实数。必须使用自然对数，并且最终结果应按照下文的输出格式要求生成。\n\n测试套件：\n- 用例 A：\n  - 电化学数据差值 $\\Delta_{d,\\text{electrochemical}} = [\\, 0.005,\\, -0.002,\\, 0.004,\\, -0.003 \\,]$，数据尺度为 $s_{d,\\text{electrochemical}} = 0.01$。\n  - 热学数据差值 $\\Delta_{d,\\text{thermal}} = [\\, 0.2,\\, -0.1,\\, 0.15 \\,]$，数据尺度为 $s_{d,\\text{thermal}} = 0.5$。\n  - 电化学 PDE 残差 $r_{\\text{electrochemical}} = [\\, 0.8,\\, -0.4,\\, 0.6,\\, -0.5,\\, 0.3 \\,]$，残差尺度为 $s_{r,\\text{electrochemical}} = 1.0$。\n  - 热学 PDE 残差 $r_{\\text{thermal}} = [\\, 2.5,\\, -1.0,\\, 1.5 \\,]$，残差尺度为 $s_{r,\\text{thermal}} = 3.0$。\n- 用例 B：\n  - 电化学数据差值 $\\Delta_{d,\\text{electrochemical}} = [\\, 0.02,\\, -0.01,\\, 0.025,\\, 0.0 \\,]$，数据尺度为 $s_{d,\\text{electrochemical}} = 0.02$。\n  - 热学数据差值 $\\Delta_{d,\\text{thermal}} = [\\, 1.5,\\, -0.5,\\, 1.0,\\, -1.2,\\, 0.8 \\,]$，数据尺度为 $s_{d,\\text{thermal}} = 2.0$。\n  - 电化学 PDE 残差 $r_{\\text{electrochemical}} = [\\, 5.0,\\, -4.0,\\, 6.0,\\, -3.0,\\, 2.0,\\, -1.0 \\,]$，残差尺度为 $s_{r,\\text{electrochemical}} = 10.0$。\n  - 热学 PDE 残差 $r_{\\text{thermal}} = [\\, 50.0,\\, -30.0,\\, 40.0 \\,]$，残差尺度为 $s_{r,\\text{thermal}} = 100.0$。\n- 用例 C：\n  - 电化学数据差值 $\\Delta_{d,\\text{electrochemical}} = [\\, 0.0,\\, 0.0 \\,]$，数据尺度为 $s_{d,\\text{electrochemical}} = 0.01$。\n  - 热学数据差值 $\\Delta_{d,\\text{thermal}} = [\\, \\,]$ （空），数据尺度为 $s_{d,\\text{thermal}} = 0.5$。\n  - 电化学 PDE 残差 $r_{\\text{electrochemical}} = [\\, 10^{-8},\\, -10^{-8} \\,]$，残差尺度为 $s_{r,\\text{electrochemical}} = 10^{-6}$。\n  - 热学 PDE 残差 $r_{\\text{thermal}} = [\\, \\,]$ （空），残差尺度为 $s_{r,\\text{thermal}} = 1.0$。\n\n为每个用例计算标量 $\\mathcal{L}^{\\star}$。所有中间归一化必须按规定执行，最终答案必须以无量纲实数报告。\n\n最终输出格式要求：\n您的程序应生成单行输出，其中包含用例 A、B 和 C 的结果，形式为方括号括起来的逗号分隔列表（例如，$[\\, \\text{resultA}, \\text{resultB}, \\text{resultC} \\,]$）。这三个条目必须是按顺序计算出的用例 A、用例 B 和用例 C 的 $\\mathcal{L}^{\\star}$ 值。",
            "solution": "该问题要求为三个不同的测试用例计算一个复合平衡损失函数，记为 $\\mathcal{L}^{\\star}$。该损失函数设计用于训练电池模拟的物理信息代理模型，其源于同方差不确定性加权原理，该原理可平衡多个训练目标。\n\n目标函数由下式给出：\n$$\n\\mathcal{L}^{\\star} = \\frac{1}{2} \\sum_{i} \\left( 1 + \\log \\tilde{T}_{i} \\right)\n$$\n其中，求和遍历四个任务：电化学数据拟合 ($D_{\\text{elec}}$)、电化学物理残差 ($P_{\\text{elec}}$)、热学数据拟合 ($D_{\\text{therm}}$) 和热学物理残差 ($P_{\\text{therm}}$)。$\\log$ 项代表自然对数。\n\n每个任务项 $T_i$ 是一个均方归一化误差。对于分量 $c \\in \\{\\text{electrochemical}, \\text{thermal}\\}$，数据拟合项 $D_{c}$ 和物理残差项 $P_{c}$ 定义如下：\n$$\nD_{c} = \\frac{1}{N_{d,c}} \\sum_{k=1}^{N_{d,c}} \\left(\\frac{\\Delta_{d,c,k}}{s_{d,c}}\\right)^{2}\n\\quad \\text{and} \\quad\nP_{c} = \\frac{1}{N_{r,c}} \\sum_{j=1}^{N_{r,c}} \\left(\\frac{r_{c,j}}{s_{r,c}}\\right)^{2}\n$$\n在这里，$\\Delta_{d,c,k}$ 是数据差值，$s_{d,c}$ 是特征数据尺度，$N_{d,c}$ 是数据点数量，$r_{c,j}$ 是 PDE 残差，$s_{r,c}$ 是特征残差尺度，$N_{r,c}$ 是残差点数量。\n\n为确保数值稳定性，这些项在用于最终目标函数之前会被截断。截断值 $\\tilde{T}_{i}$ 定义为：\n$$\n\\tilde{T}_{i} = \\max\\left(T_{i}, \\epsilon^{2}\\right)\n$$\n其中 $\\epsilon = 10^{-12}$ 是一个很小的常数，因此 $\\epsilon^2 = 10^{-24}$。如果一个任务没有样本（即其对应的数据向量为空），问题规定其截断项 $\\tilde{T}_{i}$ 直接设为 $\\epsilon^2$。\n\n我们通过为每个用例计算四个截断的任务项，然后将它们代入 $\\mathcal{L}^{\\star}$ 的公式中来求解。\n\n### 用例 A\n\n四个任务项的计算如下：\n$1$. **电化学数据拟合 ($D_{\\text{elec}}$)**:\n给定 $\\Delta_{d,\\text{e}} = [\\, 0.005,\\, -0.002,\\, 0.004,\\, -0.003 \\,]$，$s_{d,\\text{e}} = 0.01$ 和 $N_{d,c} = 4$：\n$$\nD_{\\text{elec}} = \\frac{1}{4} \\left[ \\left(\\frac{0.005}{0.01}\\right)^2 + \\left(\\frac{-0.002}{0.01}\\right)^2 + \\left(\\frac{0.004}{0.01}\\right)^2 + \\left(\\frac{-0.003}{0.01}\\right)^2 \\right] = \\frac{1}{4} [0.25 + 0.04 + 0.16 + 0.09] = 0.135\n$$\n因此，$\\tilde{D}_{\\text{elec}} = \\max(0.135, 10^{-24}) = 0.135$。\n\n$2$. **电化学物理残差 ($P_{\\text{elec}}$)**:\n给定 $r_{\\text{e}} = [\\, 0.8,\\, -0.4,\\, 0.6,\\, -0.5,\\, 0.3 \\,]$，$s_{r,\\text{e}} = 1.0$ 和 $N_{r,c} = 5$：\n$$\nP_{\\text{elec}} = \\frac{1}{5} \\left[ \\left(\\frac{0.8}{1.0}\\right)^2 + \\left(\\frac{-0.4}{1.0}\\right)^2 + \\left(\\frac{0.6}{1.0}\\right)^2 + \\left(\\frac{-0.5}{1.0}\\right)^2 + \\left(\\frac{0.3}{1.0}\\right)^2 \\right] = \\frac{1}{5} [0.64 + 0.16 + 0.36 + 0.25 + 0.09] = 0.3\n$$\n因此，$\\tilde{P}_{\\text{elec}} = \\max(0.3, 10^{-24}) = 0.3$。\n\n$3$. **热学数据拟合 ($D_{\\text{therm}}$)**:\n给定 $\\Delta_{d,\\text{t}} = [\\, 0.2,\\, -0.1,\\, 0.15 \\,]$，$s_{d,\\text{t}} = 0.5$ 和 $N_{d,c} = 3$：\n$$\nD_{\\text{therm}} = \\frac{1}{3} \\left[ \\left(\\frac{0.2}{0.5}\\right)^2 + \\left(\\frac{-0.1}{0.5}\\right)^2 + \\left(\\frac{0.15}{0.5}\\right)^2 \\right] = \\frac{1}{3} [0.16 + 0.04 + 0.09] = \\frac{0.29}{3}\n$$\n因此，$\\tilde{D}_{\\text{therm}} = \\max(0.29/3, 10^{-24}) = 0.29/3$。\n\n$4$. **热学物理残差 ($P_{\\text{therm}}$)**:\n给定 $r_{\\text{t}} = [\\, 2.5,\\, -1.0,\\, 1.5 \\,]$，$s_{r,\\text{t}} = 3.0$ 和 $N_{r,c} = 3$：\n$$\nP_{\\text{therm}} = \\frac{1}{3} \\left[ \\left(\\frac{2.5}{3.0}\\right)^2 + \\left(\\frac{-1.0}{3.0}\\right)^2 + \\left(\\frac{1.5}{3.0}\\right)^2 \\right] = \\frac{1}{3} \\left[ \\frac{6.25}{9} + \\frac{1}{9} + \\frac{2.25}{9} \\right] = \\frac{9.5}{27} = \\frac{19}{54}\n$$\n因此，$\\tilde{P}_{\\text{therm}} = \\max(19/54, 10^{-24}) = 19/54$。\n\n**复合目标 $\\mathcal{L}^{\\star}_A$**:\n$$\n\\mathcal{L}^{\\star}_A = \\frac{1}{2} \\left[ (1 + \\log(0.135)) + (1 + \\log(0.3)) + \\left(1 + \\log\\left(\\frac{0.29}{3}\\right)\\right) + \\left(1 + \\log\\left(\\frac{19}{54}\\right)\\right) \\right]\n$$\n$$\n\\mathcal{L}^{\\star}_A = \\frac{1}{2} [4 + \\log(0.135) + \\log(0.3) + \\log(0.29/3) + \\log(19/54)] \\approx -1.293711\n$$\n\n### 用例 B\n\n$1$. **电化学数据拟合 ($D_{\\text{elec}}$)**:\n给定 $\\Delta_{d,\\text{e}} = [\\, 0.02,\\, -0.01,\\, 0.025,\\, 0.0 \\,]$，$s_{d,\\text{e}} = 0.02$ 和 $N_{d,c} = 4$：\n$$\nD_{\\text{elec}} = \\frac{1}{4} \\left[ \\left(\\frac{0.02}{0.02}\\right)^2 + \\left(\\frac{-0.01}{0.02}\\right)^2 + \\left(\\frac{0.025}{0.02}\\right)^2 + \\left(\\frac{0.0}{0.02}\\right)^2 \\right] = \\frac{1}{4} [1.0 + 0.25 + 1.5625 + 0.0] = 0.703125\n$$\n因此，$\\tilde{D}_{\\text{elec}} = 0.703125$。\n\n$2$. **电化学物理残差 ($P_{\\text{elec}}$)**:\n给定 $r_{\\text{e}} = [\\, 5.0,\\, -4.0,\\, 6.0,\\, -3.0,\\, 2.0,\\, -1.0 \\,]$，$s_{r,\\text{e}} = 10.0$ 和 $N_{r,c} = 6$：\n$$\nP_{\\text{elec}} = \\frac{1}{6} [0.5^2 + (-0.4)^2 + 0.6^2 + (-0.3)^2 + 0.2^2 + (-0.1)^2] = \\frac{1}{6} [0.25 + 0.16 + 0.36 + 0.09 + 0.04 + 0.01] = \\frac{0.91}{6}\n$$\n因此，$\\tilde{P}_{\\text{elec}} = 0.91/6$。\n\n$3$. **热学数据拟合 ($D_{\\text{therm}}$)**:\n给定 $\\Delta_{d,\\text{t}} = [\\, 1.5,\\, -0.5,\\, 1.0,\\, -1.2,\\, 0.8 \\,]$，$s_{d,\\text{t}} = 2.0$ 和 $N_{d,c} = 5$：\n$$\nD_{\\text{therm}} = \\frac{1}{5} [0.75^2 + (-0.25)^2 + 0.5^2 + (-0.6)^2 + 0.4^2] = \\frac{1}{5} [0.5625 + 0.0625 + 0.25 + 0.36 + 0.16] = 0.279\n$$\n因此，$\\tilde{D}_{\\text{therm}} = 0.279$。\n\n$4$. **热学物理残差 ($P_{\\text{therm}}$)**:\n给定 $r_{\\text{t}} = [\\, 50.0,\\, -30.0,\\, 40.0 \\,]$，$s_{r,\\text{t}} = 100.0$ 和 $N_{r,c} = 3$：\n$$\nP_{\\text{therm}} = \\frac{1}{3} [0.5^2 + (-0.3)^2 + 0.4^2] = \\frac{1}{3} [0.25 + 0.09 + 0.16] = \\frac{0.5}{3}\n$$\n因此，$\\tilde{P}_{\\text{therm}} = 0.5/3$。\n\n**复合目标 $\\mathcal{L}^{\\star}_B$**:\n$$\n\\mathcal{L}^{\\star}_B = \\frac{1}{2} \\left[ \\left(1 + \\log(0.703125)\\right) + \\left(1 + \\log\\left(\\frac{0.91}{6}\\right)\\right) + \\left(1 + \\log(0.279)\\right) + \\left(1 + \\log\\left(\\frac{0.5}{3}\\right)\\right) \\right]\n$$\n$$\n\\mathcal{L}^{\\star}_B \\approx -0.653315\n$$\n\n### 用例 C\n\n$1$. **电化学数据拟合 ($D_{\\text{elec}}$)**:\n给定 $\\Delta_{d,\\text{e}} = [\\, 0.0,\\, 0.0 \\,]$，$s_{d,\\text{e}} = 0.01$ 和 $N_{d,c} = 2$：\n$$\nD_{\\text{elec}} = \\frac{1}{2} \\left[ \\left(\\frac{0.0}{0.01}\\right)^2 + \\left(\\frac{0.0}{0.01}\\right)^2 \\right] = 0\n$$\n因此，$\\tilde{D}_{\\text{elec}} = \\max(0, 10^{-24}) = 10^{-24}$。\n\n$2$. **电化学物理残差 ($P_{\\text{elec}}$)**:\n给定 $r_{\\text{e}} = [\\, 10^{-8},\\, -10^{-8} \\,]$，$s_{r,\\text{e}} = 10^{-6}$ 和 $N_{r,c} = 2$：\n$$\nP_{\\text{elec}} = \\frac{1}{2} \\left[ \\left(\\frac{10^{-8}}{10^{-6}}\\right)^2 + \\left(\\frac{-10^{-8}}{10^{-6}}\\right)^2 \\right] = \\frac{1}{2} [(10^{-2})^2 + (-10^{-2})^2] = \\frac{1}{2} [10^{-4} + 10^{-4}] = 10^{-4}\n$$\n因此，$\\tilde{P}_{\\text{elec}} = \\max(10^{-4}, 10^{-24}) = 10^{-4}$。\n\n$3$. **热学数据拟合 ($D_{\\text{therm}}$)**:\n数据向量 $\\Delta_{d,\\text{t}}$ 为空 ($N_{d,c} = 0$)。根据问题规则：\n$$\n\\tilde{D}_{\\text{therm}} = \\epsilon^2 = 10^{-24}\n$$\n\n$4$. **热学物理残差 ($P_{\\text{therm}}$)**:\n残差向量 $r_{\\text{t}}$ 为空 ($N_{r,c} = 0$)。根据问题规则：\n$$\n\\tilde{P}_{\\text{therm}} = \\epsilon^2 = 10^{-24}\n$$\n\n**复合目标 $\\mathcal{L}^{\\star}_C$**:\n$$\n\\mathcal{L}^{\\star}_C = \\frac{1}{2} \\left[ (1 + \\log(10^{-24})) + (1 + \\log(10^{-4})) + (1 + \\log(10^{-24})) + (1 + \\log(10^{-24})) \\right]\n$$\n$$\n\\mathcal{L}^{\\star}_C = \\frac{1}{2} [4 + 3 \\log(10^{-24}) + \\log(10^{-4})] = \\frac{1}{2} [4 + 3(-24 \\log 10) + (-4 \\log 10)]\n$$\n$$\n\\mathcal{L}^{\\star}_C = \\frac{1}{2} [4 - 72 \\log 10 - 4 \\log 10] = 2 - 38 \\log 10 \\approx -85.498233\n$$",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the composite loss function L_star for the given test cases.\n    \"\"\"\n    # Define the small constant epsilon and its square.\n    EPSILON = 1e-12\n    EPSILON_SQ = EPSILON**2\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A\n        {\n            \"d_elec_mismatches\": np.array([0.005, -0.002, 0.004, -0.003]),\n            \"d_elec_scale\": 0.01,\n            \"d_therm_mismatches\": np.array([0.2, -0.1, 0.15]),\n            \"d_therm_scale\": 0.5,\n            \"r_elec_residuals\": np.array([0.8, -0.4, 0.6, -0.5, 0.3]),\n            \"r_elec_scale\": 1.0,\n            \"r_therm_residuals\": np.array([2.5, -1.0, 1.5]),\n            \"r_therm_scale\": 3.0,\n        },\n        # Case B\n        {\n            \"d_elec_mismatches\": np.array([0.02, -0.01, 0.025, 0.0]),\n            \"d_elec_scale\": 0.02,\n            \"d_therm_mismatches\": np.array([1.5, -0.5, 1.0, -1.2, 0.8]),\n            \"d_therm_scale\": 2.0,\n            \"r_elec_residuals\": np.array([5.0, -4.0, 6.0, -3.0, 2.0, -1.0]),\n            \"r_elec_scale\": 10.0,\n            \"r_therm_residuals\": np.array([50.0, -30.0, 40.0]),\n            \"r_therm_scale\": 100.0,\n        },\n        # Case C\n        {\n            \"d_elec_mismatches\": np.array([0.0, 0.0]),\n            \"d_elec_scale\": 0.01,\n            \"d_therm_mismatches\": np.array([]),\n            \"d_therm_scale\": 0.5,\n            \"r_elec_residuals\": np.array([1e-8, -1e-8]),\n            \"r_elec_scale\": 1e-6,\n            \"r_therm_residuals\": np.array([]),\n            \"r_therm_scale\": 1.0,\n        },\n    ]\n\n    results = []\n\n    def compute_clamped_term(values, scale):\n        \"\"\"\n        Computes the clamped task term T_tilde for a given task.\n        \"\"\"\n        if values.size == 0:\n            # If the vector of values is empty, T_tilde is epsilon^2 by definition.\n            return EPSILON_SQ\n        \n        # Calculate the normalized mean squared value (unclamped T_i).\n        normalized_values = values / scale\n        unclamped_T = np.mean(np.square(normalized_values))\n        \n        # Apply clamping.\n        clamped_T = max(unclamped_T, EPSILON_SQ)\n        return clamped_T\n\n    for case in test_cases:\n        # Calculate the four clamped task terms (T_tilde_i) for the current case.\n        clamped_terms = [\n            compute_clamped_term(case[\"d_elec_mismatches\"], case[\"d_elec_scale\"]),\n            compute_clamped_term(case[\"r_elec_residuals\"], case[\"r_elec_scale\"]),\n            compute_clamped_term(case[\"d_therm_mismatches\"], case[\"d_therm_scale\"]),\n            compute_clamped_term(case[\"r_therm_residuals\"], case[\"r_therm_scale\"]),\n        ]\n        \n        # Calculate the final composite objective L_star.\n        # L_star = 0.5 * sum(1 + log(T_tilde_i)) for all i.\n        log_terms = 1 + np.log(np.array(clamped_terms))\n        l_star = 0.5 * np.sum(log_terms)\n        \n        results.append(l_star)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个可靠的代理模型不仅要提供准确的预测，还必须能对其预测的不确定性进行量化。高斯过程 (Gaussian Process, GP) 模型在这一方面表现出色，但在实际应用中，我们常常需要理解不确定性如何传播到衍生量上，例如由电压和电流计算出的电池功率。本练习提供了一个动手推导，用于计算此类衍生量的置信区间，这对于在实际工程决策中使用代理模型是一项至关重要的技能 。",
            "id": "3926913",
            "problem": "一个锂离子电池使用一个多输出高斯过程回归（GPR）代理模型进行建模，该模型用于预测在由温度、荷电状态（SOC）和电流设定点定义的工作条件 $x^{\\star}$ 下的端电压 $V$ 和放电电流 $I$。根据高斯过程（GP）的定义，在 $x^{\\star}$ 处的有限维后验预测分布对于任何输出集都是多元正态的；特别地，在 $x^{\\star}$ 处 $(V,I)$ 的联合预测分布是高斯分布，其均值向量和协方差矩阵由核函数和训练数据确定。高斯随机变量的置信区间（CI）构建使用标准正态分位数。\n\n在特定的工作条件 $x^{\\star}$ 下，训练好的代理模型为 $(V,I)$ 提供了以下后验预测摘要：\n- 平均电压 $\\mu_{V} = 3.7$ 和平均电流 $\\mu_{I} = 2.0$，\n- 电压方差 $\\sigma_{V}^{2} = (0.05)^{2}$，\n- 电流方差 $\\sigma_{I}^{2} = (0.2)^{2}$，\n- 协方差 $\\sigma_{VI} = -0.006$。\n\n假设 $(V,I)$ 的联合预测分布是具有这些参数的高斯分布，并且模型和观测噪声已由 GPR 后验适当地整合到 $\\sigma_{V}^{2}$、$\\sigma_{I}^{2}$ 和 $\\sigma_{VI}$ 中。我们感兴趣的派生量是功率 $P = V I$。从高斯过程定义和多元正态矩的性质出发，通过以下步骤推导 $P$ 的近似双侧 $95\\%$ 置信区间：\n1. 从 $(V,I)$ 的联合高斯预测分布中推导出 $P$ 的前两阶矩，\n2. 用具有这些矩的正态分布来近似 $P$ 的分布，\n3. 使用标准正态分位数 $z_{0.975} \\approx 1.96$ 来构建一个对称的双侧置信区间。\n\n在此近似下，计算 $P$ 的双侧 $95\\%$ 置信区间的半宽，并用瓦特（W）表示您的最终数值答案。将答案四舍五入到四位有效数字。",
            "solution": "问题陈述了在特定工作条件 $x^{\\star}$ 下，端电压 $V$ 和放电电流 $I$ 的联合后验预测分布是一个二元高斯分布。我们可以将随机向量 $\\mathbf{X} = \\begin{pmatrix} V \\\\ I \\end{pmatrix}$ 表示如下：\n$$\n\\mathbf{X} \\sim \\mathcal{N}(\\boldsymbol{\\mu}, \\boldsymbol{\\Sigma})\n$$\n其中均值向量 $\\boldsymbol{\\mu}$ 和协方差矩阵 $\\boldsymbol{\\Sigma}$ 由问题陈述给出：\n$$\n\\boldsymbol{\\mu} = \\begin{pmatrix} \\mu_V \\\\ \\mu_I \\end{pmatrix} = \\begin{pmatrix} 3.7 \\\\ 2.0 \\end{pmatrix}\n$$\n$$\n\\boldsymbol{\\Sigma} = \\begin{pmatrix} \\sigma_V^2 & \\sigma_{VI} \\\\ \\sigma_{VI} & \\sigma_I^2 \\end{pmatrix} = \\begin{pmatrix} (0.05)^2 & -0.006 \\\\ -0.006 & (0.2)^2 \\end{pmatrix} = \\begin{pmatrix} 0.0025 & -0.006 \\\\ -0.006 & 0.04 \\end{pmatrix}\n$$\n我们感兴趣的派生量是功率，$P = VI$。我们的任务是找到 $P$ 的一个近似 $95\\%$ 置信区间（CI）。这将通过首先推导 $P$ 的精确前两阶矩（均值和方差），然后将 $P$ 的分布近似为正态分布来完成。\n\n**1. 功率 ($P$) 的矩的推导**\n\n**$P$ 的均值：**\n两个随机变量乘积的期望值等于它们的均值之积加上它们的协方差。\n$$\n\\mu_P = E[P] = E[VI] = E[V]E[I] + \\text{Cov}(V, I) = \\mu_V \\mu_I + \\sigma_{VI}\n$$\n代入给定值：\n$$\n\\mu_P = (3.7)(2.0) + (-0.006) = 7.4 - 0.006 = 7.394\n$$\n平均功率为 $7.394$ W。\n\n**$P$ 的方差：**\n$P$ 的方差是 $\\sigma_P^2 = \\text{Var}(P) = E[P^2] - (E[P])^2$。我们需要计算 $E[P^2] = E[V^2 I^2]$。为此，我们使用多元正态分布的矩的性质。令 $V = \\mu_V + V_c$ 和 $I = \\mu_I + I_c$，其中 $V_c$ 和 $I_c$ 是中心化（零均值）随机变量，满足 $E[V_c] = E[I_c] = 0$，$E[V_c^2] = \\sigma_V^2$，$E[I_c^2] = \\sigma_I^2$ 和 $E[V_c I_c] = \\sigma_{VI}$。\n\n$E[V^2 I^2]$ 项可以展开为：\n$$\nE[V^2 I^2] = E[(\\mu_V + V_c)^2 (\\mu_I + I_c)^2] = E[(\\mu_V^2 + 2\\mu_V V_c + V_c^2)(\\mu_I^2 + 2\\mu_I I_c + I_c^2)]\n$$\n展开此式并取期望，所有包含中心化变量 $V_c$ 或 $I_c$ 奇数次幂的项的期望都为零。非零项为：\n$$\nE[V^2 I^2] = \\mu_V^2 \\mu_I^2 + \\mu_V^2 E[I_c^2] + \\mu_I^2 E[V_c^2] + E[V_c^2 I_c^2] + 4\\mu_V \\mu_I E[V_c I_c]\n$$\n对于零均值高斯变量，四阶矩 $E[V_c^2 I_c^2]$ 由 Isserlis 定理给出：\n$$\nE[V_c^2 I_c^2] = E[V_c V_c I_c I_c] = E[V_c V_c]E[I_c I_c] + 2(E[V_c I_c])^2 = \\sigma_V^2 \\sigma_I^2 + 2\\sigma_{VI}^2\n$$\n将此代回，我们得到：\n$$\nE[V^2 I^2] = \\mu_V^2 \\mu_I^2 + \\mu_V^2 \\sigma_I^2 + \\mu_I^2 \\sigma_V^2 + (\\sigma_V^2 \\sigma_I^2 + 2\\sigma_{VI}^2) + 4\\mu_V \\mu_I \\sigma_{VI}\n$$\n现在，我们计算方差：\n$$\n\\sigma_P^2 = E[V^2 I^2] - (E[P])^2 = E[V^2 I^2] - (\\mu_V \\mu_I + \\sigma_{VI})^2\n$$\n$$\n\\sigma_P^2 = E[V^2 I^2] - (\\mu_V^2 \\mu_I^2 + 2\\mu_V \\mu_I \\sigma_{VI} + \\sigma_{VI}^2)\n$$\n代入 $E[V^2 I^2]$ 的表达式并化简：\n$$\n\\sigma_P^2 = (\\mu_V^2 \\mu_I^2 + \\mu_V^2 \\sigma_I^2 + \\mu_I^2 \\sigma_V^2 + \\sigma_V^2 \\sigma_I^2 + 2\\sigma_{VI}^2 + 4\\mu_V \\mu_I \\sigma_{VI}) - (\\mu_V^2 \\mu_I^2 + 2\\mu_V \\mu_I \\sigma_{VI} + \\sigma_{VI}^2)\n$$\n$$\n\\sigma_P^2 = \\mu_V^2 \\sigma_I^2 + \\mu_I^2 \\sigma_V^2 + \\sigma_V^2 \\sigma_I^2 + \\sigma_{VI}^2 + 2\\mu_V \\mu_I \\sigma_{VI}\n$$\n现在我们可以代入数值：\n$\\mu_V = 3.7$, $\\mu_I = 2.0$, $\\sigma_V^2 = 0.0025$, $\\sigma_I^2 = 0.04$, $\\sigma_{VI} = -0.006$.\n$$\n\\sigma_P^2 = (3.7)^2(0.04) + (2.0)^2(0.0025) + (0.0025)(0.04) + (-0.006)^2 + 2(3.7)(2.0)(-0.006)\n$$\n$$\n\\sigma_P^2 = (13.69)(0.04) + (4)(0.0025) + 0.0001 + 0.000036 - (14.8)(0.006)\n$$\n$$\n\\sigma_P^2 = 0.5476 + 0.01 + 0.0001 + 0.000036 - 0.0888\n$$\n$$\n\\sigma_P^2 = 0.557736 - 0.0888 = 0.468936\n$$\n$P$ 的标准差是：\n$$\n\\sigma_P = \\sqrt{0.468936} \\approx 0.684789 \\text{ W}\n$$\n\n**2. 对 $P$ 的分布进行正态近似**\n\n两个高斯随机变量的乘积的分布并不严格是高斯分布。然而，为了构建近似置信区间，我们将 $P$ 的分布近似为具有我们刚刚推导出的矩的正态分布：\n$$\nP \\approx \\mathcal{N}(\\mu_P, \\sigma_P^2) \\quad \\text{其中} \\quad \\mu_P = 7.394, \\quad \\sigma_P^2 = 0.468936\n$$\n\n**3. $95\\%$ 置信区间的构建**\n\n对于一个正态分布的变量，其双侧 $95\\%$ 置信区间是使用均值和标准差以及标准正态分布的相应分位数来构建的。对于一个 $95\\%$ 置信区间，尾部的总概率是 $\\alpha = 1 - 0.95 = 0.05$，所以我们使用分位数 $z_{1-\\alpha/2} = z_{0.975}$。问题给出了值 $z_{0.975} \\approx 1.96$。\n\n置信区间由 $\\mu_P \\pm z_{0.975} \\sigma_P$ 给出。该区间的半宽（HW）为：\n$$\nHW = z_{0.975} \\sigma_P\n$$\n使用我们计算出的值：\n$$\nHW = 1.96 \\times \\sqrt{0.468936} \\approx 1.96 \\times 0.684789 \\approx 1.3421864 \\text{ W}\n$$\n问题要求将数值答案四舍五入到四位有效数字。\n$$\nHW \\approx 1.342 \\text{ W}\n$$\n因此，功率的近似 $95\\%$ 置信区间为 $7.394 \\pm 1.342$ W。计算出的半宽为 $1.342$ W。",
            "answer": "$$\n\\boxed{1.342}\n$$"
        }
    ]
}