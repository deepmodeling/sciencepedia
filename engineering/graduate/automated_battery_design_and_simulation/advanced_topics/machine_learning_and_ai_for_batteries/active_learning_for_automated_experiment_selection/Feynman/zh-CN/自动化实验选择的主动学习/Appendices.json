{
    "hands_on_practices": [
        {
            "introduction": "在贝叶斯优化中，我们需要一个策略来决定下一步要运行哪个实验。“期望改善” (Expected Improvement) 函数通过量化探索新候选点可能带来的收益，为此提供了一种强大的方法。这个练习将引导你从第一性原理出发，推导出这个关键的采集函数，从而深入理解如何在探索未知（exploration）和利用已知（exploitation）之间做出原则性的权衡。",
            "id": "3892015",
            "problem": "一个自动化的电池设计与仿真工作流使用贝叶斯优化（BO）来主动选择下一个实验，以最大化一种镍锰钴正极材料成分在 $100$ 次循环后的化成后容量保持率。其代理模型是一个高斯过程（GP），该模型对于候选成分 $x^{\\ast}$ 处容量保持率的后验预测分布近似为正态分布。设在 $x^{\\ast}$ 处的预测容量保持率为随机变量 $Y$，且 $Y \\sim \\mathcal{N}(\\mu, \\sigma^{2})$，其中 $\\mu$ 和 $\\sigma$ 分别是高斯过程的后验预测均值和标准差。当前观测到的最佳保持率为 $y_{\\text{best}}$。为了实施一种谨慎的探索策略，所用的采集函数为带有非负提升余量 $\\xi$ 的期望提升（Expected Improvement, EI）。对于一个最大化目标，其随机提升量 $I$ 定义为 $I = \\max\\{0, Y - (y_{\\text{best}} + \\xi)\\}$。从数学期望和正态概率密度函数的基本定义出发，在正态预测模型下推导期望提升 $\\mathbb{E}[I]$ 的闭式表达式，并使用以下科学上合理的值进行计算：$\\mu = 0.92$，$\\sigma = 0.03$， $y_{\\text{best}} = 0.90$，以及 $\\xi = 0.01$。将容量保持率视为一个无量纲的分数。将最终数值答案四舍五入至四位有效数字，并以无量纲分数的形式表示（最终数值中不含单位符号）。",
            "solution": "用户想要解决以下问题：\n一个自动化的电池设计与仿真工作流使用贝叶斯优化（BO）来主动选择下一个实验，以最大化一种镍锰钴正极材料成分在 $100$ 次循环后的化成后容量保持率。其代理模型是一个高斯过程（GP），该模型对于候选成分 $x^{\\ast}$ 处容量保持率的后验预测分布近似为正态分布。设在 $x^{\\ast}$ 处的预测容量保持率为随机变量 $Y$，且 $Y \\sim \\mathcal{N}(\\mu, \\sigma^{2})$，其中 $\\mu$ 和 $\\sigma$ 分别是高斯过程的后验预测均值和标准差。当前观测到的最佳保持率为 $y_{\\text{best}}$。为了实施一种谨慎的探索策略，所用的采集函数为带有非负提升余量 $\\xi$ 的期望提升（Expected Improvement, EI）。对于一个最大化目标，其随机提升量 $I$ 定义为 $I = \\max\\{0, Y - (y_{\\text{best}} + \\xi)\\}$。从数学期望和正态概率密度函数的基本定义出发，在正态预测模型下推导期望提升 $\\mathbb{E}[I]$ 的闭式表达式，并使用以下科学上合理的值进行计算：$\\mu = 0.92$，$\\sigma = 0.03$， $y_{\\text{best}} = 0.90$，以及 $\\xi = 0.01$。将容量保持率视为一个无量纲的分数。将最终数值答案四舍五入至四位有效数字，并以无量纲分数的形式表示（最终数值中不含单位符号）。\n\n### 步骤 1: 提取已知条件\n- 候选点处预测容量保持率的随机变量是 $Y$。\n- $Y$ 的分布是正态分布：$Y \\sim \\mathcal{N}(\\mu, \\sigma^{2})$。\n- $\\mu$ 是后验预测均值。\n- $\\sigma$ 是后验预测标准差。\n- $y_{\\text{best}}$ 是当前观测到的最佳保持率。\n- $\\xi$ 是一个非负的提升余量。\n- 随机提升量定义为 $I = \\max\\{0, Y - (y_{\\text{best}} + \\xi)\\}$。\n- 目标是推导期望提升 $\\mathbb{E}[I]$ 的闭式表达式。\n- 用于计算的数值为：$\\mu = 0.92$，$\\sigma = 0.03$， $y_{\\text{best}} = 0.90$，$\\xi = 0.01$。\n\n### 步骤 2: 使用提取的已知条件进行验证\n根据指定标准对问题陈述进行验证。\n- **科学依据**：该问题在机器学习（贝叶斯优化、高斯过程）和材料科学（电池设计）领域有充分的依据。期望提升是一个标准的采集函数，其在高斯过程模型下的推导是一个典型问题。背景和数值在科学上是合理的。\n- **适定性**：该问题在数学上是适定的。随机变量、其分布以及待求值的函数都已明确指定。存在唯一解，且可以从第一性原理推导得出。\n- **客观性**：该问题使用精确、客观、形式化的数学语言陈述。\n\n所有其他有效性标准也均得到满足。没有矛盾、信息缺失或歧义。\n\n### 步骤 3: 结论与行动\n问题有效。将提供一个完整的、有理有据的解答。\n\n### 解答推导\n\n期望提升 $\\mathbb{E}[I]$ 由提升函数 $I = \\max\\{0, Y - (y_{\\text{best}} + \\xi)\\}$ 的期望定义。随机变量 $Y$ 服从正态分布 $Y \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其概率密度函数（PDF）为 $f_Y(y)$。\n\n期望的定义是：\n$$ \\mathbb{E}[I] = \\int_{-\\infty}^{\\infty} \\max\\{0, y - (y_{\\text{best}} + \\xi)\\} f_Y(y) \\, dy $$\n让我们定义一个阈值 $y_{\\text{th}} = y_{\\text{best}} + \\xi$。被积函数仅在 $y > y_{\\text{th}}$ 时非零。因此，积分简化为：\n$$ \\mathbb{E}[I] = \\int_{y_{\\text{th}}}^{\\infty} (y - y_{\\text{th}}) f_Y(y) \\, dy $$\n正态分布的概率密度函数（PDF）由下式给出：\n$$ f_Y(y) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(y-\\mu)^2}{2\\sigma^2}\\right) $$\n将此式代入 $\\mathbb{E}[I]$ 的积分中：\n$$ \\mathbb{E}[I] = \\int_{y_{\\text{th}}}^{\\infty} (y - y_{\\text{th}}) \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(y-\\mu)^2}{2\\sigma^2}\\right) \\, dy $$\n为了求解此积分，我们进行变量替换，转换到标准正态分布。令 $z = \\frac{y-\\mu}{\\sigma}$。这意味着 $y = \\mu + z\\sigma$ 且 $dy = \\sigma \\, dz$。积分下限从 $y_{\\text{th}}$ 变为 $z_{\\text{th}} = \\frac{y_{\\text{th}}-\\mu}{\\sigma}$。积分上限保持为 $\\infty$。\n\n积分变为：\n$$ \\mathbb{E}[I] = \\int_{z_{\\text{th}}}^{\\infty} (\\mu + z\\sigma - y_{\\text{th}}) \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^2}{2}\\right) \\sigma \\, dz $$\n令 $\\phi(z) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^2}{2}\\right)$ 为标准正态分布的概率密度函数（PDF）。积分简化为：\n$$ \\mathbb{E}[I] = \\int_{z_{\\text{th}}}^{\\infty} ((\\mu - y_{\\text{th}}) + z\\sigma) \\phi(z) \\, dz $$\n我们可以将其分为两部分：\n$$ \\mathbb{E}[I] = (\\mu - y_{\\text{th}}) \\int_{z_{\\text{th}}}^{\\infty} \\phi(z) \\, dz + \\sigma \\int_{z_{\\text{th}}}^{\\infty} z \\phi(z) \\, dz $$\n让我们分别计算每一部分。\n第一个积分是标准正态分布的尾部概率。令 $\\Phi(z)$ 为标准正态分布的累积分布函数（CDF）。\n$$ \\int_{z_{\\text{th}}}^{\\infty} \\phi(z) \\, dz = P(Z > z_{\\text{th}}) = 1 - \\Phi(z_{\\text{th}}) $$\n第二个积分可以直接求解：\n$$ \\int_{z_{\\text{th}}}^{\\infty} z \\phi(z) \\, dz = \\int_{z_{\\text{th}}}^{\\infty} z \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^2}{2}\\right) \\, dz $$\n使用换元法 $u = -z^2/2$，则有 $du = -z \\, dz$：\n$$ \\int z \\exp\\left(-\\frac{z^2}{2}\\right) \\, dz = -\\int \\exp(u) \\, du = -\\exp(u) = -\\exp\\left(-\\frac{z^2}{2}\\right) $$\n计算定积分：\n$$ \\frac{1}{\\sqrt{2\\pi}} \\left[ -\\exp\\left(-\\frac{z^2}{2}\\right) \\right]_{z_{\\text{th}}}^{\\infty} = \\frac{1}{\\sqrt{2\\pi}} \\left( 0 - \\left(-\\exp\\left(-\\frac{z_{\\text{th}}^2}{2}\\right)\\right) \\right) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z_{\\text{th}}^2}{2}\\right) = \\phi(z_{\\text{th}}) $$\n结合两部分，期望提升的表达式为：\n$$ \\mathbb{E}[I] = (\\mu - y_{\\text{th}})(1 - \\Phi(z_{\\text{th}})) + \\sigma \\phi(z_{\\text{th}}) $$\n让我们定义提升差值 $\\Delta = \\mu - y_{\\text{th}} = \\mu - (y_{\\text{best}} + \\xi)$。那么 $z_{\\text{th}} = \\frac{y_{\\text{th}} - \\mu}{\\sigma} = -\\frac{\\Delta}{\\sigma}$。\n将此代入方程，并使用标准正态分布的性质 $\\phi(-x) = \\phi(x)$ 和 $1 - \\Phi(-x) = \\Phi(x)$：\n$$ \\mathbb{E}[I] = \\Delta (1 - \\Phi(-\\Delta/\\sigma)) + \\sigma \\phi(-\\Delta/\\sigma) $$\n$$ \\mathbb{E}[I] = \\Delta \\Phi(\\Delta/\\sigma) + \\sigma \\phi(\\Delta/\\sigma) $$\n这就是期望提升的闭式表达式。\n\n### 数值计算\n\n现在我们用给定的值来计算这个表达式：$\\mu = 0.92$，$\\sigma = 0.03$， $y_{\\text{best}} = 0.90$，以及 $\\xi = 0.01$。\n\n首先，计算提升差值 $\\Delta$：\n$$ \\Delta = \\mu - (y_{\\text{best}} + \\xi) = 0.92 - (0.90 + 0.01) = 0.92 - 0.91 = 0.01 $$\n接着，计算标准化提升 $Z_{\\text{std}}$：\n$$ Z_{\\text{std}} = \\frac{\\Delta}{\\sigma} = \\frac{0.01}{0.03} = \\frac{1}{3} $$\n$\\mathbb{E}[I]$ 的表达式变为：\n$$ \\mathbb{E}[I] = (0.01) \\cdot \\Phi\\left(\\frac{1}{3}\\right) + (0.03) \\cdot \\phi\\left(\\frac{1}{3}\\right) $$\n我们需要标准正态PDF $\\phi(z)$ 和 CDF $\\Phi(z)$ 在 $z = 1/3$ 处的值。\n$$ \\phi(z) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^2}{2}\\right) $$\n$$ \\phi\\left(\\frac{1}{3}\\right) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{(1/3)^2}{2}\\right) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{1}{18}\\right) \\approx 0.377390 $$\n$$ \\Phi(z) = \\int_{-\\infty}^{z} \\phi(t) \\, dt $$\n从标准表格中查得 CDF 在 $z=1/3$ 处的值为：\n$$ \\Phi\\left(\\frac{1}{3}\\right) \\approx 0.630559 $$\n将这些值代入 $\\mathbb{E}[I]$ 的表达式中：\n$$ \\mathbb{E}[I] \\approx (0.01) \\cdot (0.630559) + (0.03) \\cdot (0.377390) $$\n$$ \\mathbb{E}[I] \\approx 0.00630559 + 0.0113217 $$\n$$ \\mathbb{E}[I] \\approx 0.01762729 $$\n题目要求将最终答案四舍五入至四位有效数字。\n$$ \\mathbb{E}[I] \\approx 0.01763 $$",
            "answer": "$$\n\\boxed{0.01763}\n$$"
        },
        {
            "introduction": "有时，我们的目标不仅仅是找到单一的最优设计，而是学习和理解一个潜在物理模型的参数。本练习将展示如何运用信息论，特别是熵减 (entropy reduction) 的概念，来选择信息量最丰富的实验。你将通过编程实践发现，最优的实验设计恰恰是探测那些我们先验知识中最不确定的方向，从而最高效地增进我们对系统的认知。",
            "id": "3892001",
            "problem": "您正在设计一个自动化实验选择策略，用于估计一个与自动化电池设计和仿真相关的简化电化学模型的参数。考虑一个未知参数向量 $\\theta \\in \\mathbb{R}^n$，其先验分布为高斯分布 $p_0(\\theta) = \\mathcal{N}(\\mu_0, \\Sigma_0)$。一次实验由一个设计来表征，该设计产生一个标量测量值，（在预期操作条件附近进行线性化后）其模型为 $y = h^\\top \\theta + \\varepsilon$。其中 $h \\in \\mathbb{R}^n$ 是与该设计相关的灵敏度向量，$\\varepsilon$ 是均值为零、方差为 $\\sigma^2$ 的高斯噪声。您必须选择能最大化单次测量后 $\\theta$ 的后验熵预期减少量的实验。\n\n从以下基本原理出发：\n- 用于更新信念的贝叶斯定理：$p(\\theta \\mid y, h) \\propto p(y \\mid \\theta, h) \\, p_0(\\theta)$。\n- 高斯似然 $p(y \\mid \\theta, h) = \\mathcal{N}(h^\\top \\theta, \\sigma^2)$ 和高斯先验 $p_0(\\theta) = \\mathcal{N}(\\mu_0, \\Sigma_0)$ 会得到一个高斯后验分布。\n- 一个具有概率密度函数 (PDF) $p(x)$ 的连续随机变量的香农微分熵定义为 $H(X) = - \\int p(x) \\ln p(x) \\, dx$，使用自然对数，因此熵的单位是奈特 (nats)。\n\n您的任务是实现一个程序，给定一组候选灵敏度向量 $h$、一个先验协方差 $\\Sigma_0$ 和一个噪声方差 $\\sigma^2$，计算每个候选设计对应的 $\\theta$ 的熵的预期减少量（以奈特为单位），并返回最大化此预期减少量的设计的索引（使用从零开始的索引）。如果多个设计达到了相同的最大预期减少量，则选择最小的索引。您的程序的输出应该为一行，其中包含所有测试用例的结果，形式为用方括号括起来的逗号分隔列表；例如，[$r_1$,$r_2$,$r_3$]。\n\n以奈特为单位计算熵。本问题不涉及角度。不需要输出物理单位。\n\n测试套件：\n- 案例 1 (正常情况，二维参数，信息丰富的测量)：\n  - 先验协方差：$$\\Sigma_0 = \\begin{bmatrix} 0.04  0 \\\\ 0  0.09 \\end{bmatrix}$$\n  - 噪声方差：$\\sigma^2 = 0.01$\n  - 候选灵敏度向量：$h^{(0)} = [0.8, 0.1]$，$h^{(1)} = [0.2, 1.0]$，$h^{(2)} = [0.5, 0.5]$\n- 案例 2 (边界条件，噪声非常大的测量)：\n  - 先验协方差：$$\\Sigma_0 = \\begin{bmatrix} 0.04  0 \\\\ 0  0.09 \\end{bmatrix}$$\n  - 噪声方差：$\\sigma^2 = 10.0$\n  - 候选灵敏度向量：$h^{(0)} = [0.8, 0.1]$，$h^{(1)} = [0.2, 1.0]$，$h^{(2)} = [0.5, 0.5]$\n- 案例 3 (边缘案例，高度各向异性的先验)：\n  - 先验协方差：$$\\Sigma_0 = \\begin{bmatrix} 0.0001  0 \\\\ 0  4.0 \\end{bmatrix}$$\n  - 噪声方差：$\\sigma^2 = 0.5$\n  - 候选灵敏度向量：$h^{(0)} = [1.0, 0.0]$，$h^{(1)} = [0.0, 1.0]$，$h^{(2)} = [0.5, 0.5]$\n- 案例 4 (标量参数，包含一个非信息性设计)：\n  - 先验协方差：$$\\Sigma_0 = \\begin{bmatrix} 1.0 \\end{bmatrix}$$\n  - 噪声方差：$\\sigma^2 = 0.1$\n  - 候选灵敏度向量：$h^{(0)} = [0.0]$，$h^{(1)} = [0.1]$，$h^{(2)} = [2.0]$\n- 案例 5 (平局情况，不同设计间信息量相等)：\n  - 先验协方差：$$\\Sigma_0 = \\begin{bmatrix} 1.0  0 \\\\ 0  1.0 \\end{bmatrix}$$\n  - 噪声方差：$\\sigma^2 = 0.5$\n  - 候选灵敏度向量：$h^{(0)} = [1.0, 0.0]$，$h^{(1)} = [0.0, 1.0]$\n\n您的程序应该生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表。每个元素应该是对应案例所选设计的从零开始的索引。例如，[$r_1$,$r_2$,$r_3$,$r_4$,$r_5$]。",
            "solution": "用户希望我从一组候选中确定最优的实验设计，以最大化关于未知参数向量 $\\theta$ 的信息增益。该问题定义明确，并在科学上基于贝叶斯推断和信息论，特别是在线性高斯系统的贝叶斯优化实验设计 (BOED) 的背景下。\n\n核心任务是选择由灵敏度向量 $h$ 表征的实验，以最大化参数向量 $\\theta$ 的香农微分熵的预期减少量。关于 $\\theta$ 的先验信念由高斯分布 $p_0(\\theta) = \\mathcal{N}(\\mu_0, \\Sigma_0)$ 给出。单次实验根据线性模型 $y = h^\\top \\theta + \\varepsilon$ 产生一个标量测量值 $y$，其中测量噪声 $\\varepsilon$ 也是高斯的，$\\varepsilon \\sim \\mathcal{N}(0, \\sigma^2)$。\n\n熵的预期减少量等同于未知参数 $\\theta$ 和测量值 $y$ 之间的互信息，记为 $I(\\theta; y)$。根据定义，互信息可以用两种等价的方式表示：\n$$I(\\theta; y) = H(\\theta) - H(\\theta|y)$$\n$$I(\\theta; y) = H(y) - H(y|\\theta)$$\n在这里，$H(\\theta)$ 是参数的先验熵，$H(\\theta|y)$ 是观测到 $y$ 后的后验熵，$H(y)$ 是测量值边缘分布（“预测后验”或证据）的熵，而 $H(y|\\theta)$ 是在真实参数条件下测量值的熵。对于本问题，通过第二种形式 $H(y) - H(y|\\theta)$ 计算 $I(\\theta; y)$ 更为直接。目标是找到最大化此量的设计向量 $h$。\n\n让我们首先确定所需的分布及其熵。所有熵的单位都是奈特。\n\n1.  **条件熵 $H(y|\\theta)$**：测量模型为 $p(y | \\theta, h) = \\mathcal{N}(h^\\top \\theta, \\sigma^2)$。这是关于 $y$ 的单变量高斯分布。方差为 $\\sigma^2_z$ 的高斯随机变量的微分熵是 $\\frac{1}{2} \\ln(2\\pi e \\sigma^2_z)$。因此，在特定 $\\theta$ 条件下 $y$ 的熵是一个常数：\n    $$H(y|\\theta) = \\frac{1}{2} \\ln(2\\pi e \\sigma^2)$$\n    该值与 $\\theta$ 和所选的设计 $h$ 都无关。\n\n2.  **边缘熵 $H(y)$**：测量值 $y$ 的边缘分布 $p(y|h)$ 是通过将联合分布 $p(y, \\theta|h)$ 对所有可能的 $\\theta$ 进行积分得到的：\n    $$p(y|h) = \\int p(y|\\theta, h) p_0(\\theta) d\\theta$$\n    这就是模型的证据。由于 $\\theta$ 的先验和 $y$ 的似然都是高斯的，它们的卷积结果是另一个高斯分布。随机变量 $y$ 是两个独立高斯随机变量 $h^\\top\\theta$ 和 $\\varepsilon$ 的和。 $y$ 的均值为 $\\mathbb{E}[y] = \\mathbb{E}[h^\\top\\theta + \\varepsilon] = h^\\top\\mathbb{E}[\\theta] + \\mathbb{E}[\\varepsilon] = h^\\top\\mu_0$。 $y$ 的方差为：\n    $$\\text{Var}(y) = \\text{Var}(h^\\top\\theta + \\varepsilon) = \\text{Var}(h^\\top\\theta) + \\text{Var}(\\varepsilon)$$\n    使用方差的性质，$\\text{Var}(h^\\top\\theta) = h^\\top \\text{Cov}(\\theta) h = h^\\top \\Sigma_0 h$。噪声方差为 $\\text{Var}(\\varepsilon) = \\sigma^2$。因此，$y$ 的边缘分布是高斯的：\n    $$p(y|h) = \\mathcal{N}(h^\\top\\mu_0, h^\\top\\Sigma_0 h + \\sigma^2)$$\n    该分布的熵为：\n    $$H(y) = \\frac{1}{2} \\ln\\left(2\\pi e (h^\\top\\Sigma_0 h + \\sigma^2)\\right)$$\n\n3.  **互信息/预期熵减少量**：现在我们可以计算给定设计 $h$ 的互信息：\n    $$I(\\theta; y) = H(y) - H(y|\\theta)$$\n    $$I(\\theta; y) = \\frac{1}{2} \\ln\\left(2\\pi e (h^\\top\\Sigma_0 h + \\sigma^2)\\right) - \\frac{1}{2} \\ln\\left(2\\pi e \\sigma^2\\right)$$\n    使用属性 $\\ln(a) - \\ln(b) = \\ln(a/b)$，这可以简化为：\n    $$I(\\theta; y) = \\frac{1}{2} \\ln\\left(\\frac{2\\pi e (h^\\top\\Sigma_0 h + \\sigma^2)}{2\\pi e \\sigma^2}\\right) = \\frac{1}{2} \\ln\\left(\\frac{h^\\top\\Sigma_0 h + \\sigma^2}{\\sigma^2}\\right)$$\n    $$I(\\theta; y) = \\frac{1}{2} \\ln\\left(1 + \\frac{h^\\top\\Sigma_0 h}{\\sigma^2}\\right)$$\n    这个最终表达式表示通过执行由 $h$ 定义的实验所实现的 $\\theta$ 的熵的预期减少量。\n\n4.  **最优设计选择**：任务是从一组候选 $\\{h^{(i)}\\}$ 中选择灵敏度向量 $h$，以最大化此信息增益。\n    $$\\text{argmax}_{h^{(i)}} \\; \\frac{1}{2} \\ln\\left(1 + \\frac{(h^{(i)})^\\top\\Sigma_0 h^{(i)}}{\\sigma^2}\\right)$$\n    自然对数 $\\ln(x)$ 是一个严格单调递增的函数。因此，最大化该表达式等价于最大化其参数 $1 + \\frac{(h^{(i)})^\\top\\Sigma_0 h^{(i)}}{\\sigma^2}$。由于对于任何给定的测试用例，$\\sigma^2$ 是一个正常数，这进一步等价于最大化二次型 $(h^{(i)})^\\top\\Sigma_0 h^{(i)}$。\n\n    量 $h^\\top\\Sigma_0 h$ 有一个清晰的物理解释：它是测量信号部分 $h^\\top\\theta$ 的先验方差。因此，最优实验是在参数不确定性（由 $\\Sigma_0$ 描述）导致预期测量结果不确定性最大的方向上探测系统。这最大化了测量结果“出人意料”并因此提供信息的可能性。\n\n算法如下：对于每个候选向量 $h^{(i)}$，计算标量值 $q_i = (h^{(i)})^\\top \\Sigma_0 h^{(i)}$。最优设计对应于 $q_i$ 的最大值。如果出现平局，问题规定选择索引最小的设计。请注意，此计算不需要先验均值 $\\mu_0$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the optimal experiment design problem for a series of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"Sigma0\": np.array([[0.04, 0.0], [0.0, 0.09]]),\n            \"sigma_sq\": 0.01,\n            \"h_candidates\": [\n                np.array([0.8, 0.1]),\n                np.array([0.2, 1.0]),\n                np.array([0.5, 0.5])\n            ]\n        },\n        {\n            \"Sigma0\": np.array([[0.04, 0.0], [0.0, 0.09]]),\n            \"sigma_sq\": 10.0,\n            \"h_candidates\": [\n                np.array([0.8, 0.1]),\n                np.array([0.2, 1.0]),\n                np.array([0.5, 0.5])\n            ]\n        },\n        {\n            \"Sigma0\": np.array([[0.0001, 0.0], [0.0, 4.0]]),\n            \"sigma_sq\": 0.5,\n            \"h_candidates\": [\n                np.array([1.0, 0.0]),\n                np.array([0.0, 1.0]),\n                np.array([0.5, 0.5])\n            ]\n        },\n        {\n            \"Sigma0\": np.array([[1.0]]),\n            \"sigma_sq\": 0.1,\n            \"h_candidates\": [\n                np.array([0.0]),\n                np.array([0.1]),\n                np.array([2.0])\n            ]\n        },\n        {\n            \"Sigma0\": np.array([[1.0, 0.0], [0.0, 1.0]]),\n            \"sigma_sq\": 0.5,\n            \"h_candidates\": [\n                np.array([1.0, 0.0]),\n                np.array([0.0, 1.0])\n            ]\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Sigma0 = case[\"Sigma0\"]\n        h_candidates = case[\"h_candidates\"]\n        \n        # As derived, maximizing the expected entropy reduction is equivalent to\n        # maximizing the quadratic form h^T * Sigma0 * h.\n        # The noise variance sigma^2 does not affect the choice of the optimal h.\n        \n        q_values = []\n        for h in h_candidates:\n            # h is a 1D array, so we can use np.dot for h.T @ Sigma0 and then another dot.\n            # Or just use the @ operator which handles it correctly.\n            q = h.T @ Sigma0 @ h\n            q_values.append(q)\n            \n        # np.argmax returns the index of the first occurrence of the maximum value,\n        # which satisfies the tie-breaking rule (select the smallest index).\n        best_index = np.argmax(q_values)\n        results.append(best_index)\n\n    # Format the output as a comma-separated list in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "现实世界中的决策不仅要考虑最优的平均结果，还必须权衡风险与成本。本练习引入了一个基于“在险价值条件” (Conditional Value at Risk, CVaR) 的风险敏感效用函数，教你如何做出更稳健的实验选择。通过这个实践，你将学会如何在实验设计中量化并管理潜在的“最坏情况”，同时将预算限制纳入考量，从而做出更符合实际工程需求的决策。",
            "id": "3892012",
            "problem": "考虑一个自动化的电池设计工作流程，其中在固定协议下，电芯的循环寿命由一个以循环次数为单位的随机变量 $L$ 来表征。在进行任何实验之前，假设一个贝叶斯先验 $L \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$，其中参数 $\\mu_0$（单位：循环次数）和 $\\sigma_0$（单位：循环次数）。一个可用的实验 $i$ 产生单次带噪声的测量值 $y_i$，其模型为 $y_i = L + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0, \\tau_i^2)$，$\\tau_i$ 是已知的测量噪声标准差，单位为循环次数。执行实验 $i$ 会产生一笔以美元计量的货币成本 $c_i$。在执行完恰好一个实验后，系统将被部署且不再进行进一步实验，风险将使用循环寿命分布的 $\\alpha \\in (0,1)$ 水平下的下尾条件风险价值 (CVaR) 进行评估。实验 $i$ 的风险敏感效用定义为：在整合了实验 $i$ 的信息之后，循环寿命的下尾条件风险价值 (CVaR) 减去成本惩罚 $\\lambda c_i$，其中 $\\lambda$ 是一个单位为“循环次数/美元”的正标量，它将货币成本转换为等效的循环次数惩罚。\n\n基本原理：\n- 使用贝叶斯法则，结合高斯先验和高斯似然，以及正态分布的性质，来确定在观测到一次噪声方差为 $\\tau_i^2$ 的测量值 $y_i$ 后 $L$ 的后验分布。\n- 随机变量 $X$ 在 $\\alpha$ 水平下的下尾风险价值 (VaR) 是 $\\mathrm{VaR}_{\\alpha}^{\\mathrm{lower}}(X)$，定义为 $X$ 的 $\\alpha$-分位数，即 $\\mathrm{VaR}_{\\alpha}^{\\mathrm{lower}}(X) = F_X^{-1}(\\alpha)$，其中 $F_X$ 是累积分布函数。\n- 随机变量 $X$ 在 $\\alpha$ 水平下的下尾条件风险价值 (CVaR) 是条件期望 $\\mathrm{CVaR}_{\\alpha}^{\\mathrm{lower}}(X) = \\mathbb{E}[X \\mid X \\le \\mathrm{VaR}_{\\alpha}^{\\mathrm{lower}}(X)]$。\n- 标准正态概率密度函数是 $\\phi(x)$，标准正态累积分布函数是 $\\Phi(x)$，逆累积分布函数（分位数函数）是 $\\Phi^{-1}(p)$。\n\n任务：\n- 对于每个具有 $(\\tau_i, c_i)$ 的候选实验 $i$，使用高斯更新来获得在来自实验 $i$ 的一次测量后 $L$ 的后验分布。然后，计算后验 $L$ 分布在 $\\alpha$ 水平下的下尾条件风险价值 (CVaR)，并减去成本惩罚 $\\lambda c_i$ 以获得以循环次数为单位的风险敏感效用 $U_i$。选择使 $U_i$ 最大化的实验索引 $i^\\star$。\n- 索引必须是从零开始的：第一个实验的索引是0，第二个是1，依此类推。\n- 对于每个测试用例，输出一个包含两个条目的列表：所选实验的索引 $i^\\star$（一个整数）和相应的最大风险敏感效用 $U_{i^\\star}$（一个浮点数）。将 $U_{i^\\star}$ 以循环次数表示，并四舍五入到 $6$ 位小数。\n\n测试套件：\n- 用例1（理想情况）：$\\mu_0 = 800$ 循环次数，$\\sigma_0 = 120$ 循环次数，$\\alpha = 0.1$，$\\lambda = 0.2$ 循环次数/美元，实验 $[(\\tau_0, c_0), (\\tau_1, c_1), (\\tau_2, c_2)] = [(200, 500), (80, 900), (50, 2000)]$，其中 $\\tau_i$ 单位为循环次数， $c_i$ 单位为美元。\n- 用例2（风险敏感边缘情况）：$\\mu_0 = 1000$ 循环次数，$\\sigma_0 = 300$ 循环次数，$\\alpha = 0.01$，$\\lambda = 0.1$ 循环次数/美元，实验 $[(\\tau_0, c_0), (\\tau_1, c_1), (\\tau_2, c_2)] = [(500, 100), (50, 5000), (150, 800)]$。\n- 用例3（成本主导边界情况）：$\\mu_0 = 900$ 循环次数，$\\sigma_0 = 200$ 循环次数，$\\alpha = 0.2$，$\\lambda = 0.5$ 循环次数/美元，实验 $[(\\tau_0, c_0), (\\tau_1, c_1), (\\tau_2, c_2)] = [(10^9, 100), (60, 10000), (100, 2000)]$。\n- 用例4（高先验置信度情况）：$\\mu_0 = 700$ 循环次数，$\\sigma_0 = 30$ 循环次数，$\\alpha = 0.05$，$\\lambda = 0.3$ 循环次数/美元，实验 $[(\\tau_0, c_0), (\\tau_1, c_1), (\\tau_2, c_2)] = [(40, 3000), (20, 5000), (100, 500)]$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内没有空格，每个测试用例的结果本身是一个形式为 $[i^\\star, U_{i^\\star}]$ 的双元素列表。例如：$[[i_1,U_1],[i_2,U_2],[i_3,U_3],[i_4,U_4]]$。",
            "solution": "该问题要求选择最优实验来表征电池电芯的循环寿命。选择标准是一个风险敏感效用函数，该函数在实验带来的信息增益与其货币成本之间进行权衡。\n\n首先，有必要对问题陈述进行验证。该问题使用贝叶斯统计和风险理论中的标准、有科学依据的概念来定义所有参数、分布和目标。问题的核心在于评估实验的效用，该效用是基于循环寿命 $L$ 的后验分布定义的。一个关键的观察是，后验分布，特别是其均值，取决于测量结果 $y_i$，而在选择实验时 $y_i$ 是未知的。决策标准必须基于实验进行*之前*可用的信息。唯一科学严谨的解释是，实验 $i$ 的效用是其*期望*效用，其中期望是针对测量值 $y_i$ 的先验预测分布计算的。这种预后验分析是贝叶斯实验设计中的一种标准方法。基于这种解释，该问题是适定且可解的。\n\n让我们开始推导。\n\n循环寿命 $L$ 是一个具有高斯先验分布的随机变量：\n$$ L \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2) $$\n实验 $i$ 产生一个具有高斯似然的测量值 $y_i$：\n$$ y_i | L \\sim \\mathcal{N}(L, \\tau_i^2) $$\n其中 $\\tau_i$ 是已知的测量噪声标准差。\n\n对于共轭高斯分布，使用贝叶斯法则，给定测量值 $y_i$ 后 $L$ 的后验分布也是高斯分布，$L|y_i \\sim \\mathcal{N}(\\mu_{post, i}, \\sigma_{post, i}^2)$。后验参数确定如下：\n\n后验精度（方差的倒数）是先验精度和似然精度之和：\n$$ \\frac{1}{\\sigma_{post, i}^2} = \\frac{1}{\\sigma_0^2} + \\frac{1}{\\tau_i^2} $$\n解出后验方差 $\\sigma_{post, i}^2$ 得：\n$$ \\sigma_{post, i}^2 = \\left( \\frac{\\sigma_0^2 + \\tau_i^2}{\\sigma_0^2 \\tau_i^2} \\right)^{-1} = \\frac{\\sigma_0^2 \\tau_i^2}{\\sigma_0^2 + \\tau_i^2} $$\n因此，后验标准差为：\n$$ \\sigma_{post, i} = \\sqrt{\\frac{\\sigma_0^2 \\tau_i^2}{\\sigma_0^2 + \\tau_i^2}} $$\n请注意，$\\sigma_{post, i}$ 仅取决于先验参数和实验参数，而不取决于测量值 $y_i$。\n\n后验均值 $\\mu_{post, i}$ 是先验均值 $\\mu_0$ 和测量值 $y_i$ 的精度加权平均：\n$$ \\mu_{post, i} = \\sigma_{post, i}^2 \\left( \\frac{\\mu_0}{\\sigma_0^2} + \\frac{y_i}{\\tau_i^2} \\right) $$\n该均值取决于尚未知的测量结果 $y_i$。\n\n效用函数涉及后验分布在 $\\alpha$ 水平下的下尾条件风险价值 (CVaR)。对于一个正态分布的随机变量 $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其下尾 CVaR 由下式给出：\n$$ \\mathrm{CVaR}_{\\alpha}^{\\mathrm{lower}}(X) = \\mu - \\sigma \\frac{\\phi(\\Phi^{-1}(\\alpha))}{\\alpha} $$\n其中 $\\phi(\\cdot)$ 和 $\\Phi(\\cdot)$ 分别是标准正态分布的概率密度函数和累积分布函数。\n\n将此公式应用于后验分布 $L|y_i$，我们得到作为 $y_i$ 函数的 CVaR：\n$$ \\mathrm{CVaR}_{\\alpha}^{\\mathrm{lower}}(L|y_i) = \\mu_{post, i} - \\sigma_{post, i} \\frac{\\phi(\\Phi^{-1}(\\alpha))}{\\alpha} $$\n在观测到 $y_i$ 后，实验 $i$ 的风险敏感效用定义为此 CVaR 减去成本惩罚 $\\lambda c_i$：\n$$ U_i(y_i) = \\mu_{post, i} - \\sigma_{post, i} \\frac{\\phi(\\Phi^{-1}(\\alpha))}{\\alpha} - \\lambda c_i $$\n为了先验地选择一个实验，我们必须计算期望效用 $U_i = \\mathbb{E}_{y_i}[U_i(y_i)]$。期望是针对 $y_i$ 的先验预测分布来计算的。该分布通过对所有可能的 $L$ 值积分先验和似然的乘积来找到：\n$$ p(y_i) = \\int_{-\\infty}^{\\infty} p(y_i|L) p(L) dL $$\n两个高斯分布的卷积是另一个高斯分布。因此，$y_i$ 服从均值为 $\\mu_0$、方差为 $\\sigma_0^2 + \\tau_i^2$ 的正态分布：\n$$ y_i \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2 + \\tau_i^2) $$\n期望效用为：\n$$ U_i = \\mathbb{E}_{y_i} \\left[ \\mu_{post, i} - \\sigma_{post, i} \\frac{\\phi(\\Phi^{-1}(\\alpha))}{\\alpha} - \\lambda c_i \\right] $$\n根据期望的线性性质，这变为：\n$$ U_i = \\mathbb{E}_{y_i}[\\mu_{post, i}] - \\sigma_{post, i} \\frac{\\phi(\\Phi^{-1}(\\alpha))}{\\alpha} - \\lambda c_i $$\n我们计算后验均值的期望：\n$$ \\mathbb{E}_{y_i}[\\mu_{post, i}] = \\mathbb{E}_{y_i} \\left[ \\sigma_{post, i}^2 \\left( \\frac{\\mu_0}{\\sigma_0^2} + \\frac{y_i}{\\tau_i^2} \\right) \\right] = \\sigma_{post, i}^2 \\left( \\frac{\\mu_0}{\\sigma_0^2} + \\frac{\\mathbb{E}_{y_i}[y_i]}{\\tau_i^2} \\right) $$\n由于 $\\mathbb{E}_{y_i}[y_i] = \\mu_0$，我们将其代入：\n$$ \\mathbb{E}_{y_i}[\\mu_{post, i}] = \\sigma_{post, i}^2 \\left( \\frac{\\mu_0}{\\sigma_0^2} + \\frac{\\mu_0}{\\tau_i^2} \\right) = \\mu_0 \\sigma_{post, i}^2 \\left( \\frac{1}{\\sigma_0^2} + \\frac{1}{\\tau_i^2} \\right) $$\n使用恒等式 $1/\\sigma_{post, i}^2 = 1/\\sigma_0^2 + 1/\\tau_i^2$，我们发现期望后验均值就是先验均值：\n$$ \\mathbb{E}_{y_i}[\\mu_{post, i}] = \\mu_0 \\sigma_{post, i}^2 \\left( \\frac{1}{\\sigma_{post, i}^2} \\right) = \\mu_0 $$\n因此，可以在进行任何测量之前评估的实验 $i$ 的效用最终表达式为：\n$$ U_i = \\mu_0 - \\sigma_{post, i} \\frac{\\phi(\\Phi^{-1}(\\alpha))}{\\alpha} - \\lambda c_i $$\n其中 $\\sigma_{post, i} = \\sqrt{\\frac{\\sigma_0^2 \\tau_i^2}{\\sigma_0^2 + \\tau_i^2}}$。\n\n解决该问题的算法如下：\n1. 对于每个测试用例，检索参数 $\\mu_0$、$\\sigma_0$、$\\alpha$、$\\lambda$ 和实验列表 $[(\\tau_i, c_i)]$。\n2. 计算常数因子 $K = \\frac{\\phi(\\Phi^{-1}(\\alpha))}{\\alpha}$，它仅取决于风险水平 $\\alpha$。\n3. 对于列表中的每个实验 $i$：\n    a. 计算后验标准差 $\\sigma_{post, i} = \\sqrt{(\\sigma_0^2 \\tau_i^2) / (\\sigma_0^2 + \\tau_i^2)}$。\n    b. 计算效用 $U_i = \\mu_0 - \\sigma_{post, i} \\cdot K - \\lambda c_i$。\n4. 确定产生最大效用 $U_{i^\\star} = \\max_i \\{U_i\\}$ 的实验索引 $i^\\star$。\n5. 返回数对 $[i^\\star, U_{i^\\star}]$，其中 $U_{i^\\star}$ 四舍五入到6位小数。\n此过程将应用于提供的每个测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Solves the automated battery experiment selection problem for multiple test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"mu0\": 800.0, \"sigma0\": 120.0, \"alpha\": 0.1, \"lambda_\": 0.2,\n            \"experiments\": [(200.0, 500.0), (80.0, 900.0), (50.0, 2000.0)]\n        },\n        {\n            \"mu0\": 1000.0, \"sigma0\": 300.0, \"alpha\": 0.01, \"lambda_\": 0.1,\n            \"experiments\": [(500.0, 100.0), (50.0, 5000.0), (150.0, 800.0)]\n        },\n        {\n            \"mu0\": 900.0, \"sigma0\": 200.0, \"alpha\": 0.2, \"lambda_\": 0.5,\n            \"experiments\": [(1e9, 100.0), (60.0, 10000.0), (100.0, 2000.0)]\n        },\n        {\n            \"mu0\": 700.0, \"sigma0\": 30.0, \"alpha\": 0.05, \"lambda_\": 0.3,\n            \"experiments\": [(40.0, 3000.0), (20.0, 5000.0), (100.0, 500.0)]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        mu0 = case[\"mu0\"]\n        sigma0 = case[\"sigma0\"]\n        alpha = case[\"alpha\"]\n        lambda_ = case[\"lambda_\"]\n        experiments = case[\"experiments\"]\n\n        # Pre-calculate the constant factor for CVaR\n        # K = phi(Phi^-1(alpha)) / alpha\n        z_alpha = norm.ppf(alpha)\n        phi_z_alpha = norm.pdf(z_alpha)\n        cvar_factor = phi_z_alpha / alpha\n\n        max_utility = -np.inf\n        best_index = -1\n\n        sigma0_sq = sigma0 ** 2\n\n        for i, (tau_i, c_i) in enumerate(experiments):\n            tau_i_sq = tau_i ** 2\n\n            # Calculate the posterior standard deviation\n            sigma_post_i_sq = (sigma0_sq * tau_i_sq) / (sigma0_sq + tau_i_sq)\n            sigma_post_i = np.sqrt(sigma_post_i_sq)\n\n            # Calculate the expected risk-sensitive utility\n            # U_i = E[mu_post] - sigma_post * K - lambda * c\n            # E[mu_post] is mu0\n            utility = mu0 - sigma_post_i * cvar_factor - lambda_ * c_i\n\n            if utility > max_utility:\n                max_utility = utility\n                best_index = i\n        \n        # Round the final utility to 6 decimal places as required\n        rounded_utility = round(max_utility, 6)\n        results.append([best_index, rounded_utility])\n\n    # Format the final output string\n    output_parts = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(output_parts)}]\")\n\nsolve()\n\n```"
        }
    ]
}