{
    "hands_on_practices": [
        {
            "introduction": "在构建复杂的物理信息神经网络之前，一个基础步骤是分析控制方程本身。本实践将指导您完成无量纲化的过程，这是一项用于识别系统中关键物理权衡的重要技术。通过推导无量纲数，您将深入了解产热、导热和电化学反应速率之间的竞争关系，这对于构建稳定且可解释的代理模型至关重要。",
            "id": "3941092",
            "problem": "用于伪二维 (P2D) 电池模型的物理信息神经网络 (PINN) 代理模型必须在经过适当缩放的控制方程上进行训练，以确保数值稳定的优化和物理上可解释的残差加权。考虑一个厚度为 $L$ 的单个电极区域，该区域由沿厚度方向坐标 $x$ 上的一维能量平衡表示，并包含热-电化学耦合。能量方程为\n$$\n\\rho c_{p} \\,\\frac{\\partial T}{\\partial t} \\;=\\; k \\,\\frac{\\partial^{2} T}{\\partial x^{2}} \\;+\\; q(x,t),\n$$\n其中 $\\rho$ 是质量密度， $c_{p}$ 是比热容， $k$ 是热导率， $q(x,t)$ 是体积产热。该体积热源来自三种机制：不可逆反应热 $q_{\\mathrm{irr}}$、熵热 $q_{\\mathrm{ent}}$ 和欧姆热 $q_{\\mathrm{ohm}}$，由下式给出：\n$$\nq_{\\mathrm{irr}} \\;=\\; \\eta \\, a_{s} \\, j \\, F, \n\\qquad\nq_{\\mathrm{ent}} \\;=\\; T \\,\\frac{\\partial U}{\\partial T} \\, a_{s} \\, j \\, F,\n\\qquad\nq_{\\mathrm{ohm}} \\;=\\; \\frac{i^{2}}{\\sigma_{\\mathrm{eff}}},\n$$\n其中 $\\eta$ 是反应过电位， $a_{s}$ 是比表面积， $j$ 是摩尔界面通量， $F$ 是法拉第常数， $U$ 是开路电位， $i$ 是沿厚度方向的电流密度， $\\sigma_{\\mathrm{eff}}$ 是结合了电子和离子通道的有效电导率。假设在 $x \\in [0,L]$ 范围内反应是均匀的，因此体积反应电流密度 $a_{s} j F$ 是均匀的，且施加的面电流密度 $i_{\\mathrm{app}}$ 满足：\n$$\n\\int_{0}^{L} a_{s} j F \\, dx \\;=\\; i_{\\mathrm{app}} \\quad \\Rightarrow \\quad a_{s} j F \\;=\\; \\frac{i_{\\mathrm{app}}}{L}.\n$$\n选择一个温度标度 $\\Delta T$ 和一个参考温度 $T_{\\mathrm{ref}}$，并定义热扩散系数 $\\alpha = k/(\\rho c_{p})$。令热扩散时间尺度为 $\\tau_{\\mathrm{th}} = L^{2}/\\alpha$。利用能量守恒对热方程进行缩放，并利用法拉第定律和固相锂守恒来定义平均固相浓度发生 $\\mathcal{O}(1)$ 量级变化时的反应时间尺度，推导以下无量纲数组：\n- 一个比较产热与传导散热的源-传导竞争数。\n- 一个比较热扩散时间尺度与电化学反应时间尺度的类佩克莱特数。\n\n然后，使用以下参数值：\n- $L = 1.0 \\times 10^{-4}\\,\\mathrm{m}$，\n- $k = 1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$，\n- $\\rho = 1800\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，\n- $c_{p} = 900\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$，\n- $\\Delta T = 5\\,\\mathrm{K}$，\n- $i_{\\mathrm{app}} = 25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}$，\n- $\\eta_{0} = 0.06\\,\\mathrm{V}$ (用作过电位标度)，\n- $\\left(\\frac{\\partial U}{\\partial T}\\right) = 2.0 \\times 10^{-4}\\,\\mathrm{V}\\,\\mathrm{K}^{-1}$，\n- $T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$，\n- $\\sigma_{\\mathrm{eff}} = 20\\,\\mathrm{S}\\,\\mathrm{m}^{-1}$，\n- $\\epsilon_{s} = 0.5$ (固相体积分数)，\n- $c_{s,\\max} = 3.1 \\times 10^{4}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$ (最大固相浓度)，\n- $F = 96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1}$，\n\n假设熵项在 $T_{\\mathrm{ref}}$ 时做出正贡献，并计算这两个无量纲数的数值。将最终数值结果表示为四舍五入到四位有效数字的无量纲值。将两个值以双元素行矩阵的形式呈现。",
            "solution": "在尝试求解之前，对问题陈述的有效性进行评估。\n\n### 步骤 1：提取已知条件\n- **控制方程：** 一维能量平衡方程为\n$$\n\\rho c_{p} \\,\\frac{\\partial T}{\\partial t} \\;=\\; k \\,\\frac{\\partial^{2} T}{\\partial x^{2}} \\;+\\; q(x,t)\n$$\n- **变量与常数：**\n  - $T$：温度\n  - $t$：时间\n  - $x$：在 $[0, L]$ 内的沿厚度方向坐标\n  - $\\rho$：质量密度\n  - $c_p$：比热容\n  - $k$：热导率\n  - $q(x,t)$：体积产热\n  - $L$：电极厚度\n- **热源分量：**\n  - $q = q_{\\mathrm{irr}} + q_{\\mathrm{ent}} + q_{\\mathrm{ohm}}$\n  - $q_{\\mathrm{irr}} = \\eta \\, a_{s} \\, j \\, F$ (不可逆反应热)\n  - $q_{\\mathrm{ent}} = T \\,\\frac{\\partial U}{\\partial T} \\, a_{s} \\, j \\, F$ (熵热)\n  - $q_{\\mathrm{ohm}} = \\frac{i^{2}}{\\sigma_{\\mathrm{eff}}}$ (欧姆热)\n- **分量定义：**\n  - $\\eta$：反应过电位\n  - $a_s$：比表面积\n  - $j$：摩尔界面通量\n  - $F$：法拉第常数\n  - $U$：开路电位\n  - $i$：沿厚度方向的电流密度\n  - $\\sigma_{\\mathrm{eff}}$：有效电导率\n- **假设与条件：**\n  - 在 $x \\in [0,L]$ 范围内反应均匀意味着 $a_{s} j F = \\frac{i_{\\mathrm{app}}}{L}$，其中 $i_{\\mathrm{app}}$ 是施加的面电流密度。\n- **缩放参数：**\n  - 温度标度：$\\Delta T$\n  - 参考温度：$T_{\\mathrm{ref}}$\n  - 热扩散系数：$\\alpha = k/(\\rho c_{p})$\n  - 热扩散时间尺度：$\\tau_{\\mathrm{th}} = L^{2}/\\alpha$\n- **任务：**\n  1. 推导一个“源-传导竞争数”。\n  2. 推导一个比较 $\\tau_{\\mathrm{th}}$ 和电化学反应时间尺度的“类佩克莱特数”。\n  3. 使用所提供的数据计算这两个数的数值。\n- **数值：**\n  - $L = 1.0 \\times 10^{-4}\\,\\mathrm{m}$\n  - $k = 1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$\n  - $\\rho = 1800\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n  - $c_{p} = 900\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n  - $\\Delta T = 5\\,\\mathrm{K}$\n  - $i_{\\mathrm{app}} = 25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}$\n  - $\\eta_{0} = 0.06\\,\\mathrm{V}$ (过电位标度)\n  - $(\\frac{\\partial U}{\\partial T}) = 2.0 \\times 10^{-4}\\,\\mathrm{V}\\,\\mathrm{K}^{-1}$\n  - $T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$\n  - $\\sigma_{\\mathrm{eff}} = 20\\,\\mathrm{S}\\,\\mathrm{m}^{-1}$\n  - $\\epsilon_{s} = 0.5$ (固相体积分数)\n  - $c_{s,\\max} = 3.1 \\times 10^{4}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$ (最大固相浓度)\n  - $F = 96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1}$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，借鉴了输运现象（热方程）和电化学（电池建模）的标准原理。产热方程在电池建模领域是标准方程。任务是适定的，要求通过标准的标度分析推导无量纲数组，然后进行数值计算。语言客观、精确。所提供的参数对于电池材料和操作条件在物理上是现实的。问题是自洽的，并为其求解提供了所有必要信息。它没有违反任何指定的无效标准。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答推导\n目标是从控制能量平衡方程中推导出两个无量纲数，然后计算它们的值。\n\n#### 源-传导竞争数（$\\Pi_1$）的推导\n我们首先对能量方程进行无量纲化。我们定义无量纲温度 $\\theta$、空间坐标 $\\tilde{x}$ 和时间 $\\tilde{t}$：\n$$\n\\theta = \\frac{T - T_{\\mathrm{ref}}}{\\Delta T}, \\qquad \\tilde{x} = \\frac{x}{L}, \\qquad \\tilde{t} = \\frac{t}{\\tau_{\\mathrm{th}}}\n$$\n其中 $\\tau_{\\mathrm{th}} = L^2/\\alpha = L^2 \\rho c_p / k$ 是热扩散时间尺度。偏导数变换如下：\n$$\n\\frac{\\partial T}{\\partial t} = \\frac{\\partial (\\Delta T \\theta + T_{\\mathrm{ref}})}{\\partial \\tilde{t}} \\frac{\\partial \\tilde{t}}{\\partial t} = \\frac{\\Delta T}{\\tau_{\\mathrm{th}}} \\frac{\\partial \\theta}{\\partial \\tilde{t}}\n$$\n$$\n\\frac{\\partial T}{\\partial x} = \\frac{\\Delta T}{L} \\frac{\\partial \\theta}{\\partial \\tilde{x}} \\quad \\Rightarrow \\quad \\frac{\\partial^2 T}{\\partial x^2} = \\frac{\\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2}\n$$\n将这些代入控制方程：\n$$\n\\rho c_{p} \\left( \\frac{\\Delta T}{\\tau_{\\mathrm{th}}} \\frac{\\partial \\theta}{\\partial \\tilde{t}} \\right) = k \\left( \\frac{\\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} \\right) + q(x,t)\n$$\n代入 $\\tau_{\\mathrm{th}} = L^2 \\rho c_p / k$：\n$$\n\\rho c_{p} \\left( \\frac{k \\Delta T}{L^2 \\rho c_p} \\frac{\\partial \\theta}{\\partial \\tilde{t}} \\right) = \\frac{k \\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} + q\n$$\n$$\n\\frac{k \\Delta T}{L^2} \\frac{\\partial \\theta}{\\partial \\tilde{t}} = \\frac{k \\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} + q\n$$\n将整个方程除以传导项系数 $\\frac{k \\Delta T}{L^2}$，得到无量纲形式：\n$$\n\\frac{\\partial \\theta}{\\partial \\tilde{t}} = \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} + \\frac{L^2 q}{k \\Delta T}\n$$\n源-传导竞争数（我们表示为 $\\Pi_1$）是无量纲源项 $\\frac{L^2 q}{k \\Delta T}$ 的特征量级。该数比较了产热速率与传导散热速率。\n$$\n\\Pi_1 = \\frac{\\text{特征体积产热速率}}{\\text{特征体积热传导速率}} = \\frac{q_0}{k \\Delta T / L^2} = \\frac{q_0 L^2}{k \\Delta T}\n$$\n我们必须确定特征热源 $q_0$。它是其各分量特征值的总和：$q_0 = q_{0,\\mathrm{irr}} + q_{0,\\mathrm{ent}} + q_{0,\\mathrm{ohm}}$。使用所提供的标度和假设：\n- $q_{0,\\mathrm{irr}} = \\eta_0 (a_s j F) = \\eta_0 \\frac{i_{\\mathrm{app}}}{L}$\n- $q_{0,\\mathrm{ent}} = T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} (a_s j F) = T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\frac{i_{\\mathrm{app}}}{L}$\n- $q_{0,\\mathrm{ohm}} = \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}}$ (使用 $i_{\\mathrm{app}}$ 作为特征电流密度)\n\n因此，总特征热源为：\n$$\nq_0 = \\frac{i_{\\mathrm{app}}}{L} \\left( \\eta_0 + T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\right) + \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}}\n$$\n第一个无量纲数为：\n$$\n\\Pi_1 = \\frac{L^2}{k \\Delta T} \\left[ \\frac{i_{\\mathrm{app}}}{L} \\left( \\eta_0 + T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\right) + \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}} \\right] = \\frac{L i_{\\mathrm{app}}}{k \\Delta T} \\left( \\eta_0 + T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\right) + \\frac{L^2 i_{\\mathrm{app}}^2}{k \\Delta T \\sigma_{\\mathrm{eff}}}\n$$\n\n#### 类佩克莱特数（$\\Pi_2$）的推导\n这个数比较了热扩散时间尺度 $\\tau_{\\mathrm{th}}$ 与电化学反应时间尺度 $\\tau_{\\mathrm{rxn}}$。\n热时间尺度由 $\\tau_{\\mathrm{th}} = L^2 / \\alpha = L^2 \\rho c_p / k$ 给出。\n\n电化学反应时间尺度 $\\tau_{\\mathrm{rxn}}$ 是为平均固相锂浓度发生 $\\mathcal{O}(1)$ 量级变化而定义的。电极固相中的锂守恒由下式给出：\n$$\n\\epsilon_s \\frac{\\partial c_s}{\\partial t} = -\\nabla \\cdot \\mathbf{J}_s\n$$\n当在电极体积上取平均时，总存储锂量的变化是由于颗粒表面的电化学反应。平均固相浓度 $\\bar{c}_s$ 的变化率与体积反应速率 $a_s j$ 相关：\n$$\n\\epsilon_s \\frac{d\\bar{c}_s}{dt} = - a_s j\n$$\n使用给定条件 $a_s j = i_{\\mathrm{app}}/(LF)$：\n$$\n\\epsilon_s \\frac{d\\bar{c}_s}{dt} = - \\frac{i_{\\mathrm{app}}}{LF}\n$$\n浓度特征变化 $\\Delta \\bar{c}_s$ 对应的时间尺度 $\\tau_{\\mathrm{rxn}}$ 通过将导数近似为有限差分来求得：\n$$\n\\epsilon_s \\frac{\\Delta \\bar{c}_s}{\\tau_{\\mathrm{rxn}}} \\approx \\frac{i_{\\mathrm{app}}}{LF}\n$$\n对于一个 $\\mathcal{O}(1)$ 量级的变化，特征浓度变化为最大浓度，即 $\\Delta \\bar{c}_s = c_{s,\\max}$。求解 $\\tau_{\\mathrm{rxn}}$：\n$$\n\\tau_{\\mathrm{rxn}} = \\frac{\\epsilon_s c_{s,\\max} L F}{i_{\\mathrm{app}}}\n$$\n这代表了电极完全充电或放电所需的时间。\n类佩克莱特数 $\\Pi_2$ 是这两个时间尺度的比值：\n$$\n\\Pi_2 = \\frac{\\tau_{\\mathrm{th}}}{\\tau_{\\mathrm{rxn}}} = \\frac{L^2 \\rho c_p / k}{\\epsilon_s c_{s,\\max} L F / i_{\\mathrm{app}}} = \\frac{i_{\\mathrm{app}} L \\rho c_p}{k \\epsilon_s c_{s,\\max} F}\n$$\n\n### 数值计算\n我们现在将提供的数值代入推导出的 $\\Pi_1$ 和 $\\Pi_2$ 的表达式中。\n\n**$\\Pi_1$ 的计算：**\n首先，计算特征源项 $q_0$。\n$$\nq_{0, \\mathrm{irr}} = \\eta_0 \\frac{i_{\\mathrm{app}}}{L} = (0.06\\,\\mathrm{V}) \\frac{25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}}{1.0 \\times 10^{-4}\\,\\mathrm{m}} = 1.5 \\times 10^4\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n$$\nq_{0, \\mathrm{ent}} = T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\frac{i_{\\mathrm{app}}}{L} = (298\\,\\mathrm{K})(2.0 \\times 10^{-4}\\,\\mathrm{V}\\,\\mathrm{K}^{-1}) \\frac{25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}}{1.0 \\times 10^{-4}\\,\\mathrm{m}} = 1.49 \\times 10^4\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n$$\nq_{0, \\mathrm{ohm}} = \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}} = \\frac{(25\\,\\mathrm{A}\\,\\mathrm{m}^{-2})^2}{20\\,\\mathrm{S}\\,\\mathrm{m}^{-1}} = \\frac{625}{20}\\,\\mathrm{W}\\,\\mathrm{m}^{-3} = 31.25\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n总特征源：\n$$\nq_0 = (1.5 \\times 10^4) + (1.49 \\times 10^4) + 31.25 = 29931.25\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n现在计算 $\\Pi_1$：\n$$\n\\Pi_1 = \\frac{q_0 L^2}{k \\Delta T} = \\frac{(29931.25\\,\\mathrm{W}\\,\\mathrm{m}^{-3})(1.0 \\times 10^{-4}\\,\\mathrm{m})^2}{(1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1})(5\\,\\mathrm{K})} = \\frac{2.993125 \\times 10^{-4}}{7.5} \\approx 3.99083 \\times 10^{-5}\n$$\n四舍五入到四位有效数字，$\\Pi_1 \\approx 3.991 \\times 10^{-5}$。\n\n**$\\Pi_2$ 的计算：**\n首先，计算两个时间尺度。\n热扩散时间尺度：\n$$\n\\tau_{\\mathrm{th}} = \\frac{L^2 \\rho c_p}{k} = \\frac{(1.0 \\times 10^{-4}\\,\\mathrm{m})^2 (1800\\,\\mathrm{kg}\\,\\mathrm{m}^{-3})(900\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1})}{1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}} = \\frac{10^{-8} \\times 1.62 \\times 10^6}{1.5}\\,\\mathrm{s} = 0.0108\\,\\mathrm{s}\n$$\n电化学反应时间尺度：\n$$\n\\tau_{\\mathrm{rxn}} = \\frac{\\epsilon_s c_{s,\\max} L F}{i_{\\mathrm{app}}} = \\frac{(0.5)(3.1 \\times 10^4\\,\\mathrm{mol}\\,\\mathrm{m}^{-3})(1.0 \\times 10^{-4}\\,\\mathrm{m})(96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1})}{25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}} \\approx 5982.07\\,\\mathrm{s}\n$$\n现在计算比值 $\\Pi_2$：\n$$\n\\Pi_2 = \\frac{\\tau_{\\mathrm{th}}}{\\tau_{\\mathrm{rxn}}} = \\frac{0.0108\\,\\mathrm{s}}{5982.07\\,\\mathrm{s}} \\approx 1.8054 \\times 10^{-6}\n$$\n四舍五入到四位有效数字，$\\Pi_2 \\approx 1.805 \\times 10^{-6}$。\n\n两个无量纲数分别为 $\\Pi_1 \\approx 3.991 \\times 10^{-5}$ 和 $\\Pi_2 \\approx 1.805 \\times 10^{-6}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3.991 \\times 10^{-5}  & 1.805 \\times 10^{-6}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "从分析转向实践，本练习将挑战您构建一个物理信息的深度算子网络 (DeepONet)，作为电池电压响应的代理模型。您将构建一个网络，该网络学习从输入电流曲线到输出电压轨迹的映射，并以物理参数为条件。核心重点是将物理原理（如欧姆电阻和扩散弛豫）直接嵌入到网络架构中，以提高其准确性和泛化能力。",
            "id": "3941031",
            "problem": "您的任务是设计并实现一个物理启发的深度算子网络 (DeepONet)，该网络近似于从输入电流 $I(t)$ 到锂离子电池端电压 $V(t)$ 的输入-输出因果算子映射，该映射以参数向量 $\\theta$ 和温度 $T$ 为条件，并采用从多孔电极伪二维 (P2D) 模型推导出的简化且科学一致的形式。您编写的程序必须是一个完整、可运行的程序，它实例化这个 DeepONet 代理模型，在一组测试案例上对其进行评估，并报告代理模型的定量误差（以伏特为单位）。\n\n从科学基础原理开始：\n\n- 离子传输遵循菲克定律 (Fick's law)，其一维形式可写作 $J = -D \\nabla c$，其中 $J$ 是通量，$D$ 是扩散系数，$c$ 是浓度。在多孔电极中，反应动力学由巴特勒-福尔默 (Butler–Volmer) 关系式描述，该关系式将界面电流密度 $j$ 与过电势 $\\eta$ 联系起来。固相和电解质相中的电荷守恒以及欧姆定律 (Ohm's law) 产生了一组耦合的偏微分方程。在中小幅度的激励下，线性化和均质化可得到一个用于电压响应的降阶算子表示，该表示由一个开路项、一个瞬时电阻项和一个扩散弛豫项组成。这启发我们使用一个因果线性时不变映射，通过与一个具有物理动机的核函数进行卷积，来表示从输入 $I(t)$ 到输出 $V(t)$ 的映射。\n\n将用于评估的基准真值算子定义为 $I(t)$ 与单指数弛豫核的因果卷积，外加一个欧姆压降和一个开路电压基线：\n$$\nV(t) = U(\\theta,T) - R_0(\\theta,T)\\, I(t) - A(\\theta,T)\\, \\int_{0}^{t} \\frac{1}{\\tau(\\theta,T)} e^{-(t-\\tau')/\\tau(\\theta,T)}\\, I(\\tau')\\, d\\tau',\n$$\n其中 $U(\\theta,T)$ 是开路电压基线，$R_0(\\theta,T)$ 是瞬时电阻，$A(\\theta,T)$ 是扩散弛豫的幅度，而 $\\tau(\\theta,T)$ 是特征弛豫时间常数。这些参数依赖关系必须是关于 $\\theta$ 和 $T$ 的物理上合理的函数。对于数值实现，将此积分实现为具有固定时间离散化的黎曼和 (Riemann sum)。\n\n构建一个深度算子网络以近似映射 $I(\\cdot) \\mapsto V(\\cdot)$，并以 $(\\theta, T)$ 为条件：\n- DeepONet 的输出形式为\n$$\n\\widehat{V}(t) = \\sum_{j=1}^{q} c_j\\big(I(\\cdot), \\theta, T\\big)\\, \\xi_j(t),\n$$\n其中，分支网络 (branch network) 生成系数 $c_j$ 作为输入函数 $I(\\cdot)$ 和参数 $(\\theta,T)$ 的泛函，而主干网络 (trunk network) 生成依赖于位置的基函数 $\\xi_j(t)$。\n\n- 主干网络设计要求：选择一个物理启发的基函数字典，该字典能够跨越相关的响应空间并且独立于 $(\\theta,T)$。包括：\n    1. 一个常数基函数 $\\xi_0(t) = 1$，用于表示 $U(\\theta,T)$。\n    2. 一个恒等插值基，用于使用平滑的局部化函数 $\\{\\phi_i(t)\\}_{i=1}^{m}$ 从位于传感器时间 $\\{s_i\\}$ 的 $m$ 个传感器样本 $\\{I(s_i)\\}_{i=1}^{m}$ 重建 $I(t)$，使得 $I(t) \\approx \\sum_{i=1}^{m} I(s_i)\\, \\phi_i(t)$。\n    3. 一组 $K$ 个指数弛豫核，使用具有时间常数 $\\{\\tau_d^{(k)}\\}_{k=1}^{K}$ 的参数无关字典来近似因果卷积。对于字典中的每个元素和每个传感器，包括因果基函数\n    $$\n    \\xi_{k,i}(t) = \\begin{cases}\n    \\frac{1}{\\tau_d^{(k)}} \\exp\\!\\big(-(t-s_i)/\\tau_d^{(k)}\\big), & t \\ge s_i,\\\\\n    0, & t  s_i.\n    \\end{cases}\n    $$\n\n- 分支网络设计要求：在系数 $c_j$ 中显式编码参数依赖性。使用以下编码策略：\n    1. 对于常数基，生成 $c_0 = U(\\theta,T)$。\n    2. 对于欧姆重建，生成系数 $c^{\\text{ohm}}_i = -R_0(\\theta,T) \\, I(s_i)$，使得 $\\sum_i c^{\\text{ohm}}_i \\phi_i(t) \\approx -R_0(\\theta,T) I(t)$。\n    3. 对于扩散核，生成系数\n    $$\n    c^{\\text{diff}}_{k,i} = -A(\\theta,T)\\, w_k(\\theta,T)\\, I(s_i)\\, \\Delta s,\n    $$\n    其中 $\\Delta s$ 是均匀的传感器间距，而 $w_k(\\theta,T)$ 是依赖于 $(\\theta,T)$ 的非负门控权重，且满足 $\\sum_{k=1}^{K} w_k(\\theta,T) = 1$。为了实现 $w_k(\\theta,T)$，使用基于真实 $\\tau(\\theta,T)$ 与字典值 $\\tau_d^{(k)}$ 接近程度的软分配；例如，定义随 $\\big|\\log \\tau(\\theta,T) - \\log \\tau_d^{(k)}\\big|$ 减小的分数 $r_k(\\theta,T)$，并设置 $w_k(\\theta,T) = \\exp(r_k)/\\sum_j \\exp(r_j)$。这将参数依赖性完全编码在分支网络中，同时保持主干字典固定。\n\n数值上实现上述架构：\n\n- 时间离散化：在 $t \\in [0, t_{\\max}]$ 的有限时间范围内选择一个均匀网格 $t_n = n \\Delta t$，$n=0,\\ldots,N$，其中 $t_{\\max} = $ $10$ (秒)，$\\Delta t = $ $0.02$ (秒)。\n- 传感器布局：在 $[0,t_{\\max}]$ 上均匀使用 $m = $ $25$ 个传感器，位置为 $s_i$，间距为 $\\Delta s$；使用高斯局部化函数 $\\phi_i(t) = \\exp\\!\\big(-(t-s_i)^2/(2\\sigma^2)\\big)$，其中 $\\sigma = \\Delta s$，并归一化 $\\sum_i \\phi_i(t) = 1$ 对所有 $t$ 成立，以形成平滑的单位分解。\n- 字典大小：使用 $K = $ $2$ 个字典元素，$\\tau_d^{(1)} = $ $1.0$ (秒) 和 $\\tau_d^{(2)} = $ $4.0$ (秒)。\n\n为基准真值算子分量使用物理上合理的参数化：\n- 令 $T_0 = $ $298$ (开尔文)，$U_0 = $ $3.6$ (伏特)，$R_{0,\\text{base}} = $ $0.01$ (欧姆)，$\\tau_{\\text{base}} = $ $2.0$ (秒)，$A_{\\text{base}} = $ $0.02$ (伏特/安培)，以及常数 $\\alpha = $ $0.10$，$\\beta = $ $0.001$，$\\delta = $ $0.20$，$\\eta = $ $0.50$，$\\zeta = $ $0.30$ 和 $\\gamma = $ $300.0$，使得：\n$$\nU(\\theta,T) = U_0 + \\alpha\\, \\theta + \\beta\\, (T - T_0),\n$$\n$$\nR_0(\\theta,T) = R_{0,\\text{base}}\\, \\exp\\!\\big(\\gamma / T\\big)\\, \\big(1 + \\delta\\, \\theta\\big),\n$$\n$$\n\\tau(\\theta,T) = \\tau_{\\text{base}}\\, \\big(1 + \\eta\\, \\theta\\big)\\, \\frac{T_0}{T},\n$$\n$$\nA(\\theta,T) = A_{\\text{base}}\\, \\big(1 + \\zeta\\, \\theta\\big)\\, \\sqrt{\\frac{T_0}{T}}.\n$$\n\n通过指定输入电流 $I(t)$、参数向量 $\\theta$ 和温度 $T$ 来定义测试套件：\n\n- 案例 1 (正常路径): $I(t) = 2 \\sin\\big(2\\pi \\cdot 0.5 \\cdot t\\big)$ (安培)，$\\theta = $ $0.5$ (无量纲)，$T = $ $298$ (开尔文)。\n- 案例 2 (带阶跃的边界): $I(t) = 5 \\cdot H(t - 2)$ (安培)，其中 $H$ 是亥维赛阶跃函数 (Heaviside step function)，$\\theta = $ $1.5$ (无量纲)，$T = $ $318$ (开尔文)。\n- 案例 3 (零输入): $I(t) \\equiv 0$ (安培)，$\\theta = $ $0.7$ (无量纲)，$T = $ $290$ (开尔文)。\n- 案例 4 (低温下的窄脉冲边缘): $I(t) = 8 \\exp\\!\\big(-(t - 5)^2/(2 \\cdot 0.15^2)\\big)$ (安培)，$\\theta = $ $0.2$ (无量纲)，$T = $ $273$ (开尔文)。\n\n程序要求：\n\n- 使用上述参数化和一个时间步长为 $\\Delta t$ 的因果离散卷积来实现基准真值算子 $V(t)$。\n- 实现 DeepONet 代理模型 $\\widehat{V}(t)$，其主干字典和分支参数编码如上所述，包括基于分数 $r_k(\\theta,T) = -\\big|\\log \\tau(\\theta,T) - \\log \\tau_d^{(k)}\\big|$ 构建的 softmax 门控权重 $w_k(\\theta,T)$。\n- 对于每个测试案例，计算均方根误差 (root-mean-square error)\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N+1} \\sum_{n=0}^{N} \\big(\\widehat{V}(t_n) - V(t_n)\\big)^2},\n$$\n以伏特 (Volts) 表示。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述顺序报告四个测试案例的结果（单位为伏特），例如 $[\\mathrm{rmse}_1,\\mathrm{rmse}_2,\\mathrm{rmse}_3,\\mathrm{rmse}_4]$。将每个条目四舍五入到 $6$ 位小数。\n\n此问题不涉及角度单位。所有物理单位必须按上述规定使用。参数 $\\theta$ 是无量纲的。在整个实现过程中，请确保科学真实性和数值稳定性。程序必须是完全自包含的，没有任何外部输入。",
            "solution": "用户提供的问题陈述经过验证，被判定为**有效**。它在科学上基于已建立的电化学工程原理，在数学上是一致的，并且是适定的。该问题为构建一个物理启发的算子网络代理模型，并根据一个简化但物理上合理的锂离子电池基准真值模型对其进行评估，提供了完整而明确的规范。数值参数、函数形式和测试案例都已明确定义，从而可以直接且可验证地实现。\n\n解决方案首先实现基准真值模型，然后实现指定的深度算子网络 (DeepONet) 代理模型。接着，对一系列测试案例量化两者之间的误差。\n\n### 基准真值模型实现\n\n基准真值电压响应 $V(t)$ 由以下算子定义：\n$$\nV(t) = U(\\theta,T) - R_0(\\theta,T)\\, I(t) - A(\\theta,T)\\, \\int_{0}^{t} \\frac{1}{\\tau(\\theta,T)} e^{-(t-\\tau')/\\tau(\\theta,T)}\\, I(\\tau')\\, d\\tau'\n$$\n该模型表示三种物理效应的叠加：\n1.  基线开路电压 $U(\\theta,T)$。\n2.  瞬时欧姆压降 $R_0(\\theta,T) I(t)$。\n3.  由扩散弛豫过程产生的动态电压分量，由卷积积分表示。\n\n物理参数 $U$、$R_0$、$A$ 和 $\\tau$ 是无量纲参数 $\\theta$ 和温度 $T$ 的函数。它们指定的依赖关系具有物理动机，例如电阻的阿伦尼乌斯 (Arrhenius) 型温度标度 $R_0 \\propto \\exp(\\gamma/T)$，以及扩散时间常数的反温度标度 $\\tau \\propto 1/T$。这些参数是使用提供的公式针对给定的 $(\\theta, T)$ 对计算的：\n$$\nU(\\theta,T) = U_0 + \\alpha\\, \\theta + \\beta\\, (T - T_0)\n$$\n$$\nR_0(\\theta,T) = R_{0,\\text{base}}\\, \\exp\\!\\big(\\gamma / T\\big)\\, \\big(1 + \\delta\\, \\theta\\big)\n$$\n$$\n\\tau(\\theta,T) = \\tau_{\\text{base}}\\, \\big(1 + \\eta\\, \\theta\\big)\\, \\frac{T_0}{T}\n$$\n$$\nA(\\theta,T) = A_{\\text{base}}\\, \\big(1 + \\zeta\\, \\theta\\big)\\, \\sqrt{\\frac{T_0}{T}}\n$$\n其中所有常数（$U_0, R_{0,\\text{base}}, \\dots$）均已给出。\n\n该模型在离散时间网格 $t_n = n \\Delta t$ 上进行数值实现，其中 $n \\in \\{0, 1, \\dots, N\\}$。卷积积分作为离散因果卷积计算。如果我们定义一个核 $K(t) = \\frac{A(\\theta,T)}{\\tau(\\theta,T)} \\exp(-t/\\tau(\\theta,T))$，则在时间 $t_n$ 的卷积项是 $(K * I)(t_n) \\Delta t$。这可以使用 `numpy.convolve` 高效计算。每个时间步 $t_n$ 的最终基准真值电压为：\n$$\nV(t_n) = U(\\theta,T) - R_0(\\theta,T) I(t_n) - A(\\theta,T) \\left( \\left(\\frac{1}{\\tau(\\theta,T)}e^{-t/\\tau(\\theta,T)}\\right) * I(t) \\right)_n \\Delta t\n$$\n\n### 物理启发的 DeepONet 代理模型实现\n\nDeepONet 旨在近似以 $(\\theta, T)$ 为条件的算子 $I(\\cdot) \\mapsto V(\\cdot)$。其结构 $\\widehat{V}(t) = \\sum_j c_j \\xi_j(t)$ 将模型分为一个主干网络 (trunk network) 和一个分支网络 (branch network)，前者生成与参数无关的基 $\\{\\xi_j(t)\\}$，后者计算依赖于输入和参数的系数 $\\{c_j\\}$。\n\n**主干网络：** 基函数 $\\{\\xi_j(t)\\}$ 被设计用于跨越可能的电压响应空间。它们是固定的，不依赖于 $(\\theta, T)$。所选的基由三个部分组成：\n1.  **常数基：** $\\xi_0(t) = 1$。该函数提供一个偏置项，将由分支网络进行调制以表示开路电压 $U(\\theta,T)$。\n2.  **输入重建基：** 一组 $m=25$ 个局部高斯函数 $\\{\\phi_i(t)\\}_{i=1}^{m}$，中心位于均匀间隔的传感器位置 $\\{s_i\\}_{i=1}^{m}$。这些函数被归一化以形成单位分解，$\\sum_{i=1}^m \\phi_i(t) = 1$，方法是将每个高斯函数除以它们的总和。该基允许网络重建输入电流的平滑表示 $I(t) \\approx \\sum_{i=1}^m I(s_i) \\phi_i(t)$，这对于捕捉欧姆项至关重要。\n3.  **扩散核基：** 一个包含 $K=2$ 个具有固定时间常数 $\\tau_d^{(1)}$ 和 $\\tau_d^{(2)}$ 的因果指数核 $\\{\\xi_{k,i}(t)\\}_{k,i}$ 的字典。每个基函数 $\\xi_{k,i}(t) = \\frac{1}{\\tau_d^{(k)}} \\exp(-(t-s_i)/\\tau_d^{(k)})$ 对于 $t \\ge s_i$（其他情况为 $0$）表示一个源于传感器位置 $s_i$、特征时间为 $\\tau_d^{(k)}$ 的弛豫响应。对于所有传感器 $i$ 和字典元素 $k$ 的这整套函数构成一个能够近似真实卷积核的基。\n\n**分支网络：** 分支网络计算基函数的系数 $\\{c_j\\}$。在此问题中，不执行训练；系数被解析地定义为物理参数 $(\\theta, T)$ 和在传感器位置 $s_i$ 采样的输入电流 $I(\\cdot)$ 的函数。\n1.  **常数基的系数：** $c_0 = U(\\theta,T)$，直接将开路电压的物理特性映射到相应的基函数。\n2.  **欧姆项的系数：** $c^{\\text{ohm}}_i = -R_0(\\theta,T) I(s_i)$。当与单位分解基 $\\phi_i(t)$ 结合时，总和 $\\sum_i c^{\\text{ohm}}_i \\phi_i(t) = -R_0(\\theta,T) \\sum_i I(s_i) \\phi_i(t)$ 提供了对真实欧姆压降 $-R_0(\\theta,T) I(t)$ 的平滑近似。\n3.  **扩散项的系数：** $c^{\\text{diff}}_{k,i} = -A(\\theta,T) w_k(\\theta,T) I(s_i) \\Delta s$。这些系数缩放指数基函数。项 $I(s_i)\\Delta s$ 近似于卷积积分中的无穷小元素 $I(\\tau')d\\tau'$。关键创新是门控权重 $w_k(\\theta,T)$，它是通过将 softmax 函数应用于分数 $r_k(\\theta,T) = -|\\log \\tau(\\theta,T) - \\log \\tau_d^{(k)}|$ 来计算的。该机制在对数意义上选择与真实物理时间常数 $\\tau(\\theta,T)$ “最接近”的字典核 $\\tau_d^{(k)}$，从而有效地使固定的主干基能够适应变化的物理参数。\n\n**代理电压组装：** 最终的代理电压 $\\widehat{V}(t)$ 是通过将所有基函数的贡献按其相应系数加权求和来构建的：\n$$\n\\widehat{V}(t_n) = c_0 \\cdot \\xi_0(t_n) + \\sum_{i=1}^{m} c^{\\text{ohm}}_i \\cdot \\phi_{i}(t_n) + \\sum_{k=1}^{K} \\sum_{i=1}^{m} c^{\\text{diff}}_{k,i} \\cdot \\xi_{k,i}(t_n)\n$$\n此求和过程是在时间网格上的每个点 $t_n$ 数值执行的。\n\n### 评估\n\n对于四个指定的测试案例中的每一个，输入电流分布 $I(t)$、参数 $\\theta$ 和温度 $T$ 都被用来在整个时域上计算基准真值电压 $V(t_n)$ 和代理电压 $\\widehat{V}(t_n)$。然后通过均方根误差 (RMSE) 来量化代理模型的准确性：\n$$\n\\text{RMSE} = \\sqrt{\\frac{1}{N+1} \\sum_{n=0}^{N} \\big(\\widehat{V}(t_n) - V(t_n)\\big)^2}\n$$\n程序计算并报告每个案例的此 RMSE 值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    # --- GLOBAL PARAMETERS ---\n    # Time discretization\n    t_max = 10.0\n    dt = 0.02\n    N = int(t_max / dt)\n    t_grid = np.linspace(0, t_max, N + 1)\n\n    # Sensor placement\n    m = 25\n    s_locs = np.linspace(0, t_max, m)\n    ds = t_max / (m - 1) if m > 1 else 0\n\n    # DeepONet dictionary parameters\n    tau_d = np.array([1.0, 4.0])\n    K = len(tau_d)\n\n    # Physical constants\n    T0 = 298.0\n    U0 = 3.6\n    R0_base = 0.01\n    tau_base = 2.0\n    A_base = 0.02\n    alpha = 0.10\n    beta = 0.001\n    delta = 0.20\n    eta = 0.50\n    zeta = 0.30\n    gamma = 300.0\n\n    # --- HELPER FUNCTIONS ---\n    def get_physical_params(theta, T):\n        \"\"\"Computes the physical parameters U, R0, tau, A for given theta and T.\"\"\"\n        U = U0 + alpha * theta + beta * (T - T0)\n        R0 = R0_base * np.exp(gamma / T) * (1 + delta * theta)\n        tau = tau_base * (1 + eta * theta) * (T0 / T)\n        A = A_base * (1 + zeta * theta) * np.sqrt(T0 / T)\n        return U, R0, tau, A\n\n    # --- GROUND-TRUTH MODEL ---\n    def calculate_V_true(I_t, theta, T):\n        \"\"\"Computes the ground-truth voltage V(t).\"\"\"\n        U, R0, tau, A = get_physical_params(theta, T)\n        \n        # Convolution term: A * integral( (1/tau) * exp(-(t-t'))/tau * I(t') dt' )\n        # Implemented as a discrete convolution\n        if tau > 1e-9: # Avoid division by zero\n            kernel = (1 / tau) * np.exp(-t_grid / tau)\n            convolution_integral = np.convolve(I_t, kernel)[:N + 1] * dt\n        else:\n            convolution_integral = np.zeros_like(t_grid)\n        \n        V_true = U - R0 * I_t - A * convolution_integral\n        return V_true\n\n    # --- PHYSICS-INFORMED DEEPONET SURROGATE ---\n    def calculate_V_hat(I_t, theta, T):\n        \"\"\"Computes the DeepONet surrogate voltage V_hat(t).\"\"\"\n        # Sample input current at sensor locations\n        I_s = np.interp(s_locs, t_grid, I_t)\n        \n        # Get physical parameters for branch network\n        U, R0, tau, A = get_physical_params(theta, T)\n        \n        # --- TRUNK NETWORK: Basis Functions ---\n        # 1. Constant basis\n        xi_0 = np.ones_like(t_grid)\n        \n        # 2. Input reconstruction basis (normalized Gaussians)\n        sigma = ds\n        phi_unnormalized = np.exp(-(t_grid[:, np.newaxis] - s_locs)**2 / (2 * sigma**2))\n        phi_sum = np.sum(phi_unnormalized, axis=1, keepdims=True)\n        # Prevent division by zero if sum is numerically zero\n        phi_sum[phi_sum  1e-9] = 1.0\n        phi_normalized = phi_unnormalized / phi_sum  # Shape: (N+1, m)\n\n        # 3. Diffusive kernel basis (causal exponentials)\n        xi_ki = np.zeros((K, m, N + 1))\n        for k in range(K):\n            for i in range(m):\n                mask = t_grid >= s_locs[i]\n                time_diff = t_grid[mask] - s_locs[i]\n                xi_ki[k, i, mask] = (1 / tau_d[k]) * np.exp(-time_diff / tau_d[k])\n                \n        # --- BRANCH NETWORK: Coefficients ---\n        # 1. Coefficient for constant basis\n        c_0 = U\n        \n        # 2. Coefficients for ohmic term\n        c_ohm_i = -R0 * I_s  # Shape: (m,)\n        \n        # 3. Coefficients for diffusive term\n        # Softmax gating weights w_k\n        r_k = -np.abs(np.log(tau) - np.log(tau_d))\n        exp_r_k = np.exp(r_k)\n        w_k = exp_r_k / np.sum(exp_r_k)  # Shape: (K,)\n        # Full coefficients c_diff_k,i\n        c_diff_ki = -A * w_k[:, np.newaxis] * I_s[np.newaxis, :] * ds # Shape: (K, m)\n\n        # --- ASSEMBLE SURROGATE VOLTAGE ---\n        # Term 1: Constant term\n        V_hat = c_0 * xi_0\n        \n        # Term 2: Ohmic term\n        ohmic_term = np.sum(c_ohm_i[np.newaxis, :] * phi_normalized, axis=1)\n        V_hat += ohmic_term\n        \n        # Term 3: Diffusive term\n        # Sum over k and i.\n        diffusive_term = np.sum(c_diff_ki[:, :, np.newaxis] * xi_ki, axis=(0, 1))\n        V_hat += diffusive_term\n        \n        return V_hat\n\n    # --- TEST SUITE ---\n    test_cases = [\n        (lambda t: 2.0 * np.sin(2 * np.pi * 0.5 * t), 0.5, 298.0),\n        (lambda t: 5.0 * (t >= 2.0), 1.5, 318.0),\n        (lambda t: np.zeros_like(t), 0.7, 290.0),\n        (lambda t: 8.0 * np.exp(-(t - 5.0)**2 / (2 * 0.15**2)), 0.2, 273.0),\n    ]\n\n    results = []\n    for i, (I_func, theta, T) in enumerate(test_cases):\n        I_t = I_func(t_grid)\n        \n        # Calculate ground-truth and surrogate voltages\n        V_true = calculate_V_true(I_t, theta, T)\n        V_hat = calculate_V_hat(I_t, theta, T)\n        \n        # Calculate RMSE\n        rmse = np.sqrt(np.mean((V_hat - V_true)**2))\n        results.append(rmse)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个强大的模型只有在其性能可靠且被充分理解时才有用。本实践专注于一项至关重要的高阶技能：为您的代理模型设计一个鲁棒的验证策略。您将分析不同的交叉验证方案，以学习如何正确评估模型在不同操作条件下的泛化能力，同时严谨地避免数据泄漏等常见陷阱。",
            "id": "3941045",
            "problem": "您正在训练一个物理信息神经网络 (PINN) 代理模型，以模拟锂离子电池的伪二维 (P2D) 电化学模型。该代理模型将电流曲线 $I(t)$ 和温度 $T$ 作为输入，并预测端电压 $V(t)$ 以及内部场，包括固相浓度 $c_s(r,x,t)$、电解质浓度 $c_e(x,t)$ 以及电势 $\\phi_s(x,t)$ 和 $\\phi_e(x,t)$。训练目标是一个复合损失函数，它结合了数据保真度以及 P2D 方程和约束的物理残差：\n- 球形颗粒内的固相扩散：$\\partial_t c_s = D_s(T)\\,\\nabla_r^2 c_s$，其边界通量与颗粒表面的界面电流密度 $j$ 成正比。\n- 电解质质量传输：在多孔电极和隔膜中，$\\epsilon_e\\,\\partial_t c_e = \\nabla_x\\cdot(D_e(T)\\,\\nabla_x c_e) - (1 - t_+^0)\\,a_s\\,j$。\n- 通过 Butler–Volmer 方程描述的界面动力学：$j = 2\\,k(T)\\,\\sqrt{c_e}\\,\\sinh\\!\\left(\\dfrac{\\alpha F\\,\\eta}{R T}\\right)$，其中 $\\eta$ 是过电势，$\\alpha$ 是转移系数，$F$ 是法拉第常数，$R$ 是普适气体常数。\n- Arrhenius 温度依赖性：$k(T) = k_0 \\exp\\!\\left(-\\dfrac{E_a}{R T}\\right)$，$D_s(T) = D_{s,0} \\exp\\!\\left(-\\dfrac{E_{a,s}}{R T}\\right)$，$D_e(T) = D_{e,0} \\exp\\!\\left(-\\dfrac{E_{a,e}}{R T}\\right)$。\n\n您的数据集包含完整的充电和放电实验，每个实验都将一个电流曲线 $p$ 与一个温度 $T$ 配对。电流曲线包括恒流 (CC)、混合脉冲功率特性 (HPPC) 和具有丰富频率内容的驱动循环。温度涵盖三个值 $T \\in \\{273\\ \\mathrm{K}, 298\\ \\mathrm{K}, 323\\ \\mathrm{K}\\}$。每个实验都提供时间序列数据 $\\{I(t), T, V(t)\\}$，并且对于其中一个子集，还提供用于监督学习的高保真度 P2D 内部状态。目标是设计一种交叉验证协议，该协议能够 (i) 评估模型在电流曲线和温度发生分布偏移时的鲁棒性，以及 (ii) 检测对特定工况的过拟合，同时避免数据泄露并使用物理一致性评估。\n\n以下哪种验证协议最能满足这些目标？\n\nA. 执行随机 K 折交叉验证，通过在整个数据集上均匀地分割单个时间索引来实现，确保每一折都包含所有曲线和温度的混合。使用在完整数据集上计算的统计数据对输入进行归一化。通过在 $V(t)$ 的验证集均方误差上进行早停来选择超参数，并报告各折的平均结果。\n\nB. 使用分组感知的 K 折交叉验证，其中每个组是一个单独的实验 $(p,T)$，但使用所有数据（包括留出的组）计算特征归一化。通过在留出的测试折上评估性能来优化超参数，以选择最佳配置。使用端电压 $V(t)$ 误差作为唯一指标。\n\nC. 使用嵌套的、分组感知的交叉验证，其中组在工况级别定义，每个工况是一个 $(\\text{曲线类别}, \\text{温度})$ 对。在外层循环中，执行留一工况法，即留出给定 $(p,T)$ 的所有实验。在对剩余工况的内层循环中，运行分组 K 折交叉验证来选择模型架构以及物理残差和边界/初始条件损失的权重。严格仅在内层循环的训练组上计算归一化统计数据，并将其应用于验证集和外层循环的测试集。在外层测试工况上使用多种指标进行评估：$V(t)$ 随时间的归一化均方根误差，在数据可用时评估 $c_s$ 和 $c_e$ 的轨迹误差，以及 P2D 偏微分方程和约束的平均残差范数。包括压力测试，通过指定外层循环的某些折来留出最高温度 $T=323\\ \\mathrm{K}$ 和变化最快的曲线类别，以探测模型的外推能力。按荷电状态 (state-of-charge) 分层聚合指标，以避免因不相等的停留时间而产生的偏差。\n\nD. 执行留一温度法交叉验证，即留出某一温度下的所有数据，同时在其他温度下的所有曲线上进行训练。使用来自所有数据的全局统计数据进行归一化。使用从训练温度中抽取的单个验证集划分来选择超参数，并且仅评估随时间平均的端电压 $V(t)$ 误差。\n\nE. 在每个实验 $(p,T)$ 内部应用块状时间序列交叉验证，使用时间块来保持自相关性。将跨块和跨实验的误差合并为单一分数。通过在平均块级验证误差上进行早停来选择超参数，并在同一实验的剩余块上报告测试性能。\n\n选择最合适的选项。",
            "solution": "问题要求为锂离子电池 P2D 模型的物理信息神经网络 (PINN) 代理模型找到最合适的交叉验证协议。该协议的既定目标是 (i) 评估在分布偏移下的鲁棒性，(ii) 检测过拟合，(iii) 避免数据泄露，以及 (iv) 使用物理一致性评估。仔细分析这些要求对于选择正确的协议至关重要。\n\n数据集是结构化的，包含多个时间序列实验。每个实验由特定的电流曲线类别（例如，恒流、驱动循环）和特定操作温度 $T$（来自集合 $\\{273\\ \\mathrm{K}, 298\\ \\mathrm{K}, 323\\ \\mathrm{K}\\}$）定义。这种数据点自然地聚集成组的结构至关重要。主要挑战是确保模型不仅能泛化到已知实验内的未见时间点，还能泛化到全新的操作工况，即曲线类型和温度的组合。\n\n让我们根据既定目标和严谨的机器学习模型验证原则来评估每个提议的协议。\n\n### 选项 A 分析\n该选项提议通过随机分割单个时间索引来进行标准的、非分组的 K 折交叉验证。\n\n- **泄露：** 该协议因两种形式的数据泄露而存在严重缺陷。\n    1. **时间泄露：** 数据 $\\{I(t), V(t), ...\\}$ 是具有强自相关性的时间序列。随机抽样单个时间点会将时间上相邻的数据点分别放入训练集和验证集。例如，时间点 $t$ 可能在训练集中，而时间点 $t + \\Delta t$ 在验证集中。模型可以轻易地通过其邻近点的简单插值来预测验证点，导致性能指标被人为夸大。这种方法未能测试模型的长期预测能力。\n    2. **归一化泄露：** 该协议声明“使用在完整数据集上计算的统计数据对输入进行归一化”。这是一个根本性错误。归一化参数（例如，均值和标准差）是训练模型的一部分。通过在整个数据集（包括验证集和测试折）上计算它们，来自留出数据的信息会“泄露”到训练过程中，再次导致过于乐观且无效的性能估计。归一化统计数据必须*仅*从给定折的训练数据中学习。\n\n- **评估分布偏移：** 通过设计，随机分割确保了训练集和验证集是独立同分布的。这种方法无法评估模型对分布偏移的鲁棒性，因为它从未被要求外推或泛化到一个未见的工况（例如，新的温度或新的曲线类别）。\n\n- **评估指标：** 该协议仅依赖于端电压 $V(t)$ 的均方误差。对于一个 PINN 来说，这是一个不完整的评估，因为 PINN 的设计不仅是为了拟合数据，还要满足其潜在的控制偏微分方程 (PDE)，例如 $\\partial_t c_s = D_s(T)\\,\\nabla_r^2 c_s$。一个恰当的评估还必须量化物理残差。\n\n**结论：** 错误。该协议违反了为时间序列和分组数据建立独立测试集的核心原则，并采用了有缺陷的评估策略。\n\n### 选项 B 分析\n该选项提议使用分组感知的 K 折交叉验证，其中组是单个实验。这正确地解决了选项 A 的时间泄露问题。\n\n- **泄露：** 尽管使用了分组感知分割，该协议仍犯了两个关键错误：\n    1. **归一化泄露：** 它重复了选项 A 的缺陷：“使用所有数据（包括留出的组）计算特征归一化”。\n    2. **超参数调优泄露：** 它声明“通过在留出的测试折上评估性能来优化超参数”。测试集（在这种情况下，是单次交叉验证循环中的留出折）必须仅用于最终的、无偏的性能估计。用它来选择超参数（模型架构、学习率、损失权重等）会使超参数对该特定测试集“过拟合”，从而使得最终性能报告无效且过于乐观。正确的超参数调优需要三向划分：训练、验证（用于调优）和测试（用于最终评估），通常通过嵌套交叉验证实现。\n\n- **评估指标：** 与选项 A 类似，它依赖于一个单一且不完整的指标：$V(t)$ 的误差。\n\n**结论：** 错误。它在归一化和超参数优化方面存在根本性的方法论缺陷。\n\n### 选项 C 分析\n该选项提出了一个复杂的、多层次的协议。\n\n- **结构：** 它使用嵌套的、分组感知的交叉验证。这是涉及模型评估和超参数调优的项目的黄金标准。\n    - **外层循环** 执行留一工况法验证，其中“工况”是（曲线类别，温度）对。留出整个工况是测试分布偏移鲁棒性的最直接和最具挑战性的方式，而这是首要目标之一。特殊的“压力测试”（留出最高温度或最动态的曲线）明确地探测了外推能力。\n    - **内层循环** 在剩余数据上执行分组 K 折交叉验证以调整超参数（例如，架构和物理残差的损失权重）。这确保了超参数选择是稳健进行的，而不会触及外层循环的测试集。\n\n- **泄露：** 该协议经过精心设计以防止泄露。它“严格仅在内层循环的训练组上计算归一化统计数据”，这是正确的程序。将超参数调优（内层循环）与最终评估（外层循环）分开，防止了在测试集上进行调优。\n\n- **评估指标：** 评估是全面的，并与 PINN 方法论直接对齐。它包括多个指标：\n    1. **数据保真度：** $V(t)$ 的归一化均方根误差。\n    2. **内部状态准确性：** $c_s(r,x,t)$ 和 $c_e(x,t)$ 的误差，利用了模型的全部预测能力。\n    3. **物理一致性：** PDE 残差的平均范数。\n此外，它建议按荷电状态分层聚合指标，这是一种领域特定的改进，以防止指标被长的静置期（此时误差通常很低）所主导，从而提供对动态性能更有意义的评估。\n\n**结论：** 正确。该协议在方法论上是合理且严谨的，并且与所有既定目标完美对齐。它展示了对机器学习最佳实践和物理系统代理建模特定挑战的深刻理解。\n\n### 选项 D 分析\n该选项提议留一温度法交叉验证。\n\n- **结构：** 这是留一分组交叉验证的一个特例，其中组是温度。这是评估温度外推能力的合理策略。然而，它不如 C 的“留一工况法”全面，因为它没有以同样结构化的方式系统地测试对电流曲线类别的泛化能力。使用“单个验证集划分”进行超参数调优，其稳健性不如 C 中提议的内层交叉验证循环。\n\n- **泄露：** 它与选项 A 和 B 一样，存在关键的归一化泄露问题：“使用来自所有数据的全局统计数据进行归一化”。\n\n- **评估指标：** 它仅使用 $V(t)$ 的误差，这对于 PINN 来说是一个不完整的评估。\n\n**结论：** 错误。虽然其整体结构是一个合理的起点，但它被一个关键的数据泄露缺陷和一个不充分的评估策略所损害，使其劣于 C。\n\n### 选项 E 分析\n该选项提议在每个实验*内部*进行块状时间序列交叉验证。\n\n- **评估分布偏移：** 该协议的范围不正确。通过仅在每个实验*内部*进行分割和测试，它评估的是模型在*已知*操作条件（曲线和温度）下进行时间外推的能力。它完全无法评估对*新*操作条件的泛化能力，而这是问题描述中的核心挑战。它回答了一个与所提问题不同的、简单得多的问题。\n\n- **结构：** 块状交叉验证方法正确地处理了单个时间序列的时间依赖性。然而，它忽略了数据集的更高层次的分组结构（即，不同实验对应不同工况），而这对于测试所期望的鲁棒性形式至关重要。\n\n**结论：** 错误。该方法被误用，并且未能解决评估跨不同电流曲线和温度的鲁棒性这一主要目标。\n\n### 结论\n选项 C 描述了最严谨和最合适的验证协议。它正确地识别了数据的层次结构，并采用嵌套的、分组感知的交叉验证来稳健地评估对新操作工况的泛化能力，同时避免了数据泄露。其多方面的评估策略是针对模型的物理信息特性而量身定制的。所有其他选项都包含关键的方法论缺陷（数据泄露、不当的超参数调优）或在概念上与问题的主要目标不一致。",
            "answer": "$$\\boxed{C}$$"
        }
    ]
}