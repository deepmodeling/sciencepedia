{
    "hands_on_practices": [
        {
            "introduction": "Effective surrogate modeling begins not with the neural network, but with a deep understanding of the underlying physics. This exercise guides you through the essential practice of scaling analysis on the governing thermal-electrochemical equations of a battery. By deriving key dimensionless numbers, you will learn to quantify the competition between heat generation, heat conduction, and electrochemical reaction timescales, a crucial step for ensuring numerical stability and physical interpretability in any physics-informed model .",
            "id": "3941092",
            "problem": "A physics-informed neural network (PINN) surrogate for the pseudo-two-dimensional (P2D) battery model must be trained on appropriately scaled governing equations to ensure numerically stable optimization and physically interpretable residual weighting. Consider a single electrode region of thickness $L$ represented by a one-dimensional energy balance in the through-thickness coordinate $x$ with thermal-electrochemical coupling. The energy equation is\n$$\n\\rho c_{p} \\,\\frac{\\partial T}{\\partial t} \\;=\\; k \\,\\frac{\\partial^{2} T}{\\partial x^{2}} \\;+\\; q(x,t),\n$$\nwhere $\\rho$ is the mass density, $c_{p}$ is the specific heat capacity, $k$ is the thermal conductivity, and $q(x,t)$ is the volumetric heat generation. The volumetric heat source arises from three mechanisms: irreversible reaction heat $q_{\\mathrm{irr}}$, entropic heat $q_{\\mathrm{ent}}$, and ohmic heat $q_{\\mathrm{ohm}}$, given by\n$$\nq_{\\mathrm{irr}} \\;=\\; \\eta \\, a_{s} \\, j \\, F, \n\\qquad\nq_{\\mathrm{ent}} \\;=\\; T \\,\\frac{\\partial U}{\\partial T} \\, a_{s} \\, j \\, F,\n\\qquad\nq_{\\mathrm{ohm}} \\;=\\; \\frac{i^{2}}{\\sigma_{\\mathrm{eff}}},\n$$\nwhere $\\eta$ is the reaction overpotential, $a_{s}$ is the specific surface area, $j$ is the molar interfacial flux, $F$ is the Faraday constant, $U$ is the open-circuit potential, $i$ is the through-thickness current density, and $\\sigma_{\\mathrm{eff}}$ is an effective conductivity combining electronic and ionic pathways. Assume uniform reaction across $x \\in [0,L]$ so that the volumetric reaction current density $a_{s} j F$ is uniform, and the applied areal current density $i_{\\mathrm{app}}$ satisfies\n$$\n\\int_{0}^{L} a_{s} j F \\, dx \\;=\\; i_{\\mathrm{app}} \\quad \\Rightarrow \\quad a_{s} j F \\;=\\; \\frac{i_{\\mathrm{app}}}{L}.\n$$\nChoose a temperature scale $\\Delta T$, a reference temperature $T_{\\mathrm{ref}}$, and define the thermal diffusivity $\\alpha = k/(\\rho c_{p})$. Let the thermal diffusion timescale be $\\tau_{\\mathrm{th}} = L^{2}/\\alpha$. Using conservation of energy for scaling of the heat equation, and using Faraday’s law with solid-phase lithium conservation to define a reaction timescale for an $\\mathcal{O}(1)$ change of average solid concentration, derive the following dimensionless groups:\n- A source-conduction competition number that compares heat generation to heat removal by conduction.\n- A Péclet-like number comparing the thermal diffusion timescale to the electrochemical reaction timescale.\n\nThen, using the parameter values:\n- $L = 1.0 \\times 10^{-4}\\,\\mathrm{m}$,\n- $k = 1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$,\n- $\\rho = 1800\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$,\n- $c_{p} = 900\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n- $\\Delta T = 5\\,\\mathrm{K}$,\n- $i_{\\mathrm{app}} = 25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}$,\n- $\\eta_{0} = 0.06\\,\\mathrm{V}$ (use this for the overpotential scale),\n- $\\left(\\frac{\\partial U}{\\partial T}\\right) = 2.0 \\times 10^{-4}\\,\\mathrm{V}\\,\\mathrm{K}^{-1}$,\n- $T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$,\n- $\\sigma_{\\mathrm{eff}} = 20\\,\\mathrm{S}\\,\\mathrm{m}^{-1}$,\n- $\\epsilon_{s} = 0.5$,\n- $c_{s,\\max} = 3.1 \\times 10^{4}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$,\n- $F = 96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1}$,\n\nassume the entropic term contributes positively at $T_{\\mathrm{ref}}$ and compute numerical values for the two dimensionless numbers. Express the final numerical results as dimensionless values rounded to four significant figures. Present both values as a two-entry row matrix.",
            "solution": "The problem statement is evaluated for validity prior to attempting a solution.\n\n### Step 1: Extract Givens\n- **Governing Equation:** The one-dimensional energy balance is\n$$\n\\rho c_{p} \\,\\frac{\\partial T}{\\partial t} \\;=\\; k \\,\\frac{\\partial^{2} T}{\\partial x^{2}} \\;+\\; q(x,t)\n$$\n- **Variables and Constants:**\n  - $T$: Temperature\n  - $t$: Time\n  - $x$: Through-thickness coordinate in $[0, L]$\n  - $\\rho$: Mass density\n  - $c_p$: Specific heat capacity\n  - $k$: Thermal conductivity\n  - $q(x,t)$: Volumetric heat generation\n  - $L$: Electrode thickness\n- **Heat Source Components:**\n  - $q = q_{\\mathrm{irr}} + q_{\\mathrm{ent}} + q_{\\mathrm{ohm}}$\n  - $q_{\\mathrm{irr}} = \\eta \\, a_{s} \\, j \\, F$ (irreversible reaction heat)\n  - $q_{\\mathrm{ent}} = T \\,\\frac{\\partial U}{\\partial T} \\, a_{s} \\, j \\, F$ (entropic heat)\n  - $q_{\\mathrm{ohm}} = \\frac{i^{2}}{\\sigma_{\\mathrm{eff}}}$ (ohmic heat)\n- **Component Definitions:**\n  - $\\eta$: Reaction overpotential\n  - $a_s$: Specific surface area\n  - $j$: Molar interfacial flux\n  - $F$: Faraday constant\n  - $U$: Open-circuit potential\n  - $i$: Through-thickness current density\n  - $\\sigma_{\\mathrm{eff}}$: Effective conductivity\n- **Assumptions and Conditions:**\n  - Uniform reaction across $x \\in [0,L]$ implies $a_{s} j F = \\frac{i_{\\mathrm{app}}}{L}$, where $i_{\\mathrm{app}}$ is the applied areal current density.\n- **Scaling Parameters:**\n  - Temperature scale: $\\Delta T$\n  - Reference temperature: $T_{\\mathrm{ref}}$\n  - Thermal diffusivity: $\\alpha = k/(\\rho c_{p})$\n  - Thermal diffusion timescale: $\\tau_{\\mathrm{th}} = L^{2}/\\alpha$\n- **Task:**\n  1. Derive a \"source-conduction competition number\".\n  2. Derive a \"Péclet-like number\" comparing $\\tau_{\\mathrm{th}}$ to an electrochemical reaction timescale.\n  3. Compute numerical values for these two numbers using the provided data.\n- **Numerical Values:**\n  - $L = 1.0 \\times 10^{-4}\\,\\mathrm{m}$\n  - $k = 1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$\n  - $\\rho = 1800\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n  - $c_{p} = 900\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n  - $\\Delta T = 5\\,\\mathrm{K}$\n  - $i_{\\mathrm{app}} = 25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}$\n  - $\\eta_{0} = 0.06\\,\\mathrm{V}$ (overpotential scale)\n  - $(\\frac{\\partial U}{\\partial T}) = 2.0 \\times 10^{-4}\\,\\mathrm{V}\\,\\mathrm{K}^{-1}$\n  - $T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$\n  - $\\sigma_{\\mathrm{eff}} = 20\\,\\mathrm{S}\\,\\mathrm{m}^{-1}$\n  - $\\epsilon_{s} = 0.5$ (solid-phase volume fraction)\n  - $c_{s,\\max} = 3.1 \\times 10^{4}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$ (max solid concentration)\n  - $F = 96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, drawing upon standard principles of transport phenomena (heat equation) and electrochemistry (battery modeling). The equations for heat generation are standard in the field of battery modeling. The task is well-posed, requiring the derivation of dimensionless groups through a standard scaling analysis, followed by numerical calculation. The language is objective and precise. The provided parameters are physically realistic for battery materials and operating conditions. The problem is self-contained and provides all necessary information for its solution. It does not violate any of the specified invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution Derivation\nThe objective is to derive two dimensionless numbers from the governing energy balance equation and then compute their values.\n\n#### Derivation of the Source-Conduction Competition Number ($\\Pi_1$)\nWe begin by non-dimensionalizing the energy equation. Let us define the dimensionless temperature $\\theta$, spatial coordinate $\\tilde{x}$, and time $\\tilde{t}$:\n$$\n\\theta = \\frac{T - T_{\\mathrm{ref}}}{\\Delta T}, \\qquad \\tilde{x} = \\frac{x}{L}, \\qquad \\tilde{t} = \\frac{t}{\\tau_{\\mathrm{th}}}\n$$\nwhere $\\tau_{\\mathrm{th}} = L^2/\\alpha = L^2 \\rho c_p / k$ is the thermal diffusion timescale. The partial derivatives transform as:\n$$\n\\frac{\\partial T}{\\partial t} = \\frac{\\partial (\\Delta T \\theta + T_{\\mathrm{ref}})}{\\partial \\tilde{t}} \\frac{\\partial \\tilde{t}}{\\partial t} = \\frac{\\Delta T}{\\tau_{\\mathrm{th}}} \\frac{\\partial \\theta}{\\partial \\tilde{t}}\n$$\n$$\n\\frac{\\partial T}{\\partial x} = \\frac{\\Delta T}{L} \\frac{\\partial \\theta}{\\partial \\tilde{x}} \\quad \\Rightarrow \\quad \\frac{\\partial^2 T}{\\partial x^2} = \\frac{\\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2}\n$$\nSubstituting these into the governing equation:\n$$\n\\rho c_{p} \\left( \\frac{\\Delta T}{\\tau_{\\mathrm{th}}} \\frac{\\partial \\theta}{\\partial \\tilde{t}} \\right) = k \\left( \\frac{\\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} \\right) + q(x,t)\n$$\nSubstituting $\\tau_{\\mathrm{th}} = L^2 \\rho c_p / k$:\n$$\n\\rho c_{p} \\left( \\frac{k \\Delta T}{L^2 \\rho c_p} \\frac{\\partial \\theta}{\\partial \\tilde{t}} \\right) = \\frac{k \\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} + q\n$$\n$$\n\\frac{k \\Delta T}{L^2} \\frac{\\partial \\theta}{\\partial \\tilde{t}} = \\frac{k \\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} + q\n$$\nDividing the entire equation by the conduction term coefficient, $\\frac{k \\Delta T}{L^2}$, yields the dimensionless form:\n$$\n\\frac{\\partial \\theta}{\\partial \\tilde{t}} = \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} + \\frac{L^2 q}{k \\Delta T}\n$$\nThe source-conduction competition number, which we denote $\\Pi_1$, is the characteristic magnitude of the dimensionless source term $\\frac{L^2 q}{k \\Delta T}$. This number compares the rate of heat generation to the rate of heat removal by conduction.\n$$\n\\Pi_1 = \\frac{\\text{Characteristic volumetric heat generation rate}}{\\text{Characteristic volumetric heat conduction rate}} = \\frac{q_0}{k \\Delta T / L^2} = \\frac{q_0 L^2}{k \\Delta T}\n$$\nWe must determine the characteristic heat source, $q_0$. It is the sum of the characteristic values of its components: $q_0 = q_{0,\\mathrm{irr}} + q_{0,\\mathrm{ent}} + q_{0,\\mathrm{ohm}}$. Using the provided scales and assumptions:\n- $q_{0,\\mathrm{irr}} = \\eta_0 (a_s j F) = \\eta_0 \\frac{i_{\\mathrm{app}}}{L}$\n- $q_{0,\\mathrm{ent}} = T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} (a_s j F) = T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\frac{i_{\\mathrm{app}}}{L}$\n- $q_{0,\\mathrm{ohm}} = \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}}$ (using $i_{\\mathrm{app}}$ as the characteristic current density)\n\nThus, the total characteristic heat source is:\n$$\nq_0 = \\frac{i_{\\mathrm{app}}}{L} \\left( \\eta_0 + T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\right) + \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}}\n$$\nAnd the first dimensionless number is:\n$$\n\\Pi_1 = \\frac{L^2}{k \\Delta T} \\left[ \\frac{i_{\\mathrm{app}}}{L} \\left( \\eta_0 + T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\right) + \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}} \\right] = \\frac{L i_{\\mathrm{app}}}{k \\Delta T} \\left( \\eta_0 + T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\right) + \\frac{L^2 i_{\\mathrm{app}}^2}{k \\Delta T \\sigma_{\\mathrm{eff}}}\n$$\n\n#### Derivation of the Péclet-like Number ($\\Pi_2$)\nThis number compares the thermal diffusion timescale, $\\tau_{\\mathrm{th}}$, to the electrochemical reaction timescale, $\\tau_{\\mathrm{rxn}}$.\nThe thermal timescale is given as $\\tau_{\\mathrm{th}} = L^2 / \\alpha = L^2 \\rho c_p / k$.\n\nThe electrochemical reaction timescale, $\\tau_{\\mathrm{rxn}}$, is defined for an $\\mathcal{O}(1)$ change in the average solid-phase lithium concentration. The conservation of lithium in the solid phase of the electrode is given by:\n$$\n\\epsilon_s \\frac{\\partial c_s}{\\partial t} = -\\nabla \\cdot \\mathbf{J}_s\n$$\nWhen averaged over the electrode volume, the change in the total stored lithium is due to the electrochemical reaction at the particle surfaces. The rate of change of the average solid concentration, $\\bar{c}_s$, is related to the volumetric reaction rate, $a_s j$:\n$$\n\\epsilon_s \\frac{d\\bar{c}_s}{dt} = - a_s j\n$$\nUsing the given condition $a_s j = i_{\\mathrm{app}}/(LF)$:\n$$\n\\epsilon_s \\frac{d\\bar{c}_s}{dt} = - \\frac{i_{\\mathrm{app}}}{LF}\n$$\nThe timescale $\\tau_{\\mathrm{rxn}}$ for a characteristic change in concentration $\\Delta \\bar{c}_s$ is found by approximating the derivative as a finite difference:\n$$\n\\epsilon_s \\frac{\\Delta \\bar{c}_s}{\\tau_{\\mathrm{rxn}}} \\approx \\frac{i_{\\mathrm{app}}}{LF}\n$$\nFor an $\\mathcal{O}(1)$ change, the characteristic concentration change is the maximum concentration, $\\Delta \\bar{c}_s = c_{s,\\max}$. Solving for $\\tau_{\\mathrm{rxn}}$:\n$$\n\\tau_{\\mathrm{rxn}} = \\frac{\\epsilon_s c_{s,\\max} L F}{i_{\\mathrm{app}}}\n$$\nThis represents the time to fully charge or discharge the electrode.\nThe Péclet-like number, $\\Pi_2$, is the ratio of these two timescales:\n$$\n\\Pi_2 = \\frac{\\tau_{\\mathrm{th}}}{\\tau_{\\mathrm{rxn}}} = \\frac{L^2 \\rho c_p / k}{\\epsilon_s c_{s,\\max} L F / i_{\\mathrm{app}}} = \\frac{i_{\\mathrm{app}} L \\rho c_p}{k \\epsilon_s c_{s,\\max} F}\n$$\n\n### Numerical Computation\nWe now substitute the provided numerical values into the derived expressions for $\\Pi_1$ and $\\Pi_2$.\n\n**Calculation of $\\Pi_1$:**\nFirst, calculate the characteristic source term, $q_0$.\n$$\nq_{0, \\mathrm{irr}} = \\eta_0 \\frac{i_{\\mathrm{app}}}{L} = (0.06\\,\\mathrm{V}) \\frac{25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}}{1.0 \\times 10^{-4}\\,\\mathrm{m}} = 1.5 \\times 10^4\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n$$\nq_{0, \\mathrm{ent}} = T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\frac{i_{\\mathrm{app}}}{L} = (298\\,\\mathrm{K})(2.0 \\times 10^{-4}\\,\\mathrm{V}\\,\\mathrm{K}^{-1}) \\frac{25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}}{1.0 \\times 10^{-4}\\,\\mathrm{m}} = 1.49 \\times 10^4\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n$$\nq_{0, \\mathrm{ohm}} = \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}} = \\frac{(25\\,\\mathrm{A}\\,\\mathrm{m}^{-2})^2}{20\\,\\mathrm{S}\\,\\mathrm{m}^{-1}} = \\frac{625}{20}\\,\\mathrm{W}\\,\\mathrm{m}^{-3} = 31.25\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\nTotal characteristic source:\n$$\nq_0 = (1.5 \\times 10^4) + (1.49 \\times 10^4) + 31.25 = 29931.25\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\nNow compute $\\Pi_1$:\n$$\n\\Pi_1 = \\frac{q_0 L^2}{k \\Delta T} = \\frac{(29931.25\\,\\mathrm{W}\\,\\mathrm{m}^{-3})(1.0 \\times 10^{-4}\\,\\mathrm{m})^2}{(1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1})(5\\,\\mathrm{K})} = \\frac{2.993125 \\times 10^{-4}}{7.5} \\approx 3.99083 \\times 10^{-5}\n$$\nRounding to four significant figures, $\\Pi_1 \\approx 3.991 \\times 10^{-5}$.\n\n**Calculation of $\\Pi_2$:**\nFirst, calculate the two timescales.\nThermal diffusion timescale:\n$$\n\\tau_{\\mathrm{th}} = \\frac{L^2 \\rho c_p}{k} = \\frac{(1.0 \\times 10^{-4}\\,\\mathrm{m})^2 (1800\\,\\mathrm{kg}\\,\\mathrm{m}^{-3})(900\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1})}{1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}} = \\frac{10^{-8} \\times 1.62 \\times 10^6}{1.5}\\,\\mathrm{s} = 0.0108\\,\\mathrm{s}\n$$\nElectrochemical reaction timescale:\n$$\n\\tau_{\\mathrm{rxn}} = \\frac{\\epsilon_s c_{s,\\max} L F}{i_{\\mathrm{app}}} = \\frac{(0.5)(3.1 \\times 10^4\\,\\mathrm{mol}\\,\\mathrm{m}^{-3})(1.0 \\times 10^{-4}\\,\\mathrm{m})(96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1})}{25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}} \\approx 5982.07\\,\\mathrm{s}\n$$\nNow compute the ratio $\\Pi_2$:\n$$\n\\Pi_2 = \\frac{\\tau_{\\mathrm{th}}}{\\tau_{\\mathrm{rxn}}} = \\frac{0.0108\\,\\mathrm{s}}{5982.07\\,\\mathrm{s}} \\approx 1.8054 \\times 10^{-6}\n$$\nRounding to four significant figures, $\\Pi_2 \\approx 1.805 \\times 10^{-6}$.\n\nThe two dimensionless numbers are $\\Pi_1 \\approx 3.991 \\times 10^{-5}$ and $\\Pi_2 \\approx 1.805 \\times 10^{-6}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3.991 \\times 10^{-5} & 1.805 \\times 10^{-6}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Translating physical laws into a neural network architecture is a core skill in developing surrogate models. This practice challenges you to implement a Physics-Informed Deep Operator Network (DeepONet) that maps an input current profile $I(t)$ to an output voltage $V(t)$. You will construct a specialized architecture where physical parameters are explicitly encoded into the branch network, providing a hands-on demonstration of how to build efficient and interpretable surrogates for dynamic systems .",
            "id": "3941031",
            "problem": "You are tasked with designing and implementing a Physics-Informed Deep Operator Network (DeepONet) that approximates the input-to-output causal operator mapping from current $I(t)$ to terminal voltage $V(t)$ of a lithium-ion cell, conditioned on a parameter vector $\\theta$ and temperature $T$, within a simplified, scientifically consistent form derived from the Porous-Electrode Pseudo Two-Dimensional (P2D) model. The program you write must be a complete, runnable program that instantiates this DeepONet surrogate, evaluates it across a set of test cases, and reports the quantitative error of the surrogate in volts.\n\nBegin from scientifically grounded principles:\n\n- Ion transport obeys Fick's law, which in one dimension can be written as $J = -D \\nabla c$, where $J$ is flux, $D$ is the diffusion coefficient, and $c$ is concentration. In porous electrodes, reaction kinetics are captured by the Butler–Volmer relation linking interfacial current density $j$ to overpotential $\\eta$. Charge conservation in solid and electrolyte phases and Ohm's law yield coupled partial differential equations. Under small-to-moderate excitation, linearization and homogenization lead to a reduced-order operator representation for voltage response composed of an open-circuit term, an instantaneous resistive term, and a diffusive relaxation term. This motivates a causal linear time-invariant mapping from the input $I(t)$ to the output $V(t)$ written as a convolution with a physically motivated kernel.\n\nDefine the ground-truth operator for evaluation as a causal convolution of $I(t)$ with a single-exponential relaxation kernel plus an ohmic drop and an open-circuit voltage baseline:\n$$\nV(t) = U(\\theta,T) - R_0(\\theta,T)\\, I(t) - A(\\theta,T)\\, \\int_{0}^{t} \\frac{1}{\\tau(\\theta,T)} e^{-(t-\\tau')/\\tau(\\theta,T)}\\, I(\\tau')\\, d\\tau',\n$$\nwhere $U(\\theta,T)$ is the open-circuit voltage baseline, $R_0(\\theta,T)$ is the instantaneous resistance, $A(\\theta,T)$ is the amplitude of the diffusive relaxation, and $\\tau(\\theta,T)$ is the characteristic relaxation time constant. These parameter dependencies must be physically sensible functions of $\\theta$ and $T$. For numerical realizations, implement this integral as a Riemann sum with a fixed time discretization.\n\nConstruct a Deep Operator Network to approximate the mapping $I(\\cdot) \\mapsto V(\\cdot)$ conditioned on $(\\theta, T)$:\n- The DeepONet outputs are of the form\n$$\n\\widehat{V}(t) = \\sum_{j=1}^{q} c_j\\big(I(\\cdot), \\theta, T\\big)\\, \\xi_j(t),\n$$\nwhere the branch network produces the coefficients $c_j$ as functionals of the input function $I(\\cdot)$ and the parameters $(\\theta,T)$, and the trunk network produces the location-dependent basis functions $\\xi_j(t)$.\n\n- Trunk network design requirement: choose a physics-informed dictionary of basis functions that spans the relevant response space and is independent of $(\\theta,T)$. Include:\n    1. A constant basis function $\\xi_0(t) = 1$ to represent $U(\\theta,T)$.\n    2. An identity-interpolant basis to reconstruct $I(t)$ from $m$ sensor samples $\\{I(s_i)\\}_{i=1}^{m}$ at sensor times $\\{s_i\\}$ using smooth localized functions $\\{\\phi_i(t)\\}_{i=1}^{m}$, such that $I(t) \\approx \\sum_{i=1}^{m} I(s_i)\\, \\phi_i(t)$.\n    3. A set of $K$ exponential relaxation kernels that approximate the causal convolution using a parameter-independent dictionary with time constants $\\{\\tau_d^{(k)}\\}_{k=1}^{K}$. For each dictionary element and each sensor, include causal basis functions\n    $$\n    \\xi_{k,i}(t) = \\begin{cases}\n    \\frac{1}{\\tau_d^{(k)}} \\exp\\!\\big(-(t-s_i)/\\tau_d^{(k)}\\big), & t \\ge s_i,\\\\\n    0, & t < s_i.\n    \\end{cases}\n    $$\n\n- Branch network design requirement: encode parameter dependence explicitly in the coefficients $c_j$. Use the following encoding strategy:\n    1. For the constant basis, produce $c_0 = U(\\theta,T)$.\n    2. For the ohmic reconstruction, produce coefficients $c^{\\text{ohm}}_i = -R_0(\\theta,T) \\, I(s_i)$ so that $\\sum_i c^{\\text{ohm}}_i \\phi_i(t) \\approx -R_0(\\theta,T) I(t)$.\n    3. For the diffusive kernels, produce coefficients\n    $$\n    c^{\\text{diff}}_{k,i} = -A(\\theta,T)\\, w_k(\\theta,T)\\, I(s_i)\\, \\Delta s,\n    $$\n    where $\\Delta s$ is the uniform sensor spacing and $w_k(\\theta,T)$ are nonnegative gating weights that depend on $(\\theta,T)$ and satisfy $\\sum_{k=1}^{K} w_k(\\theta,T) = 1$. To implement $w_k(\\theta,T)$, use a soft assignment based on the proximity of the true $\\tau(\\theta,T)$ to dictionary $\\tau_d^{(k)}$ values; for example, define scores $r_k(\\theta,T)$ that decrease with $\\big|\\log \\tau(\\theta,T) - \\log \\tau_d^{(k)}\\big|$ and set $w_k(\\theta,T) = \\exp(r_k)/\\sum_j \\exp(r_j)$. This encodes parameter dependence entirely within the branch network while keeping the trunk dictionary fixed.\n\nImplement the above architecture numerically:\n\n- Time discretization: choose a uniform grid $t_n = n \\Delta t$ for $n=0,\\ldots,N$ over a finite horizon of $t \\in [0, t_{\\max}]$, with $t_{\\max} = $ $10$ (seconds) and $\\Delta t = $ $0.02$ (seconds).\n- Sensor placement: use $m = $ $25$ sensors uniformly over $[0,t_{\\max}]$ at positions $s_i$ with spacing $\\Delta s$; use Gaussian localized functions $\\phi_i(t) = \\exp\\!\\big(-(t-s_i)^2/(2\\sigma^2)\\big)$ with $\\sigma = \\Delta s$ and normalize $\\sum_i \\phi_i(t) = 1$ for all $t$ to form a smooth partition of unity.\n- Dictionary size: use $K = $ $2$ dictionary elements with $\\tau_d^{(1)} = $ $1.0$ (seconds) and $\\tau_d^{(2)} = $ $4.0$ (seconds).\n\nUse physically sensible parameterizations for the ground-truth operator components:\n- Let $T_0 = $ $298$ (Kelvin), $U_0 = $ $3.6$ (Volts), $R_{0,\\text{base}} = $ $0.01$ (Ohms), $\\tau_{\\text{base}} = $ $2.0$ (seconds), $A_{\\text{base}} = $ $0.02$ (Volts per Ampere), and constants $\\alpha = $ $0.10$, $\\beta = $ $0.001$, $\\delta = $ $0.20$, $\\eta = $ $0.50$, $\\zeta = $ $0.30$, and $\\gamma = $ $300.0$ such that:\n$$\nU(\\theta,T) = U_0 + \\alpha\\, \\theta + \\beta\\, (T - T_0),\n$$\n$$\nR_0(\\theta,T) = R_{0,\\text{base}}\\, \\exp\\!\\big(\\gamma / T\\big)\\, \\big(1 + \\delta\\, \\theta\\big),\n$$\n$$\n\\tau(\\theta,T) = \\tau_{\\text{base}}\\, \\big(1 + \\eta\\, \\theta\\big)\\, \\frac{T_0}{T},\n$$\n$$\nA(\\theta,T) = A_{\\text{base}}\\, \\big(1 + \\zeta\\, \\theta\\big)\\, \\sqrt{\\frac{T_0}{T}}.\n$$\n\nDefine the test suite by specifying input currents $I(t)$, parameter vectors $\\theta$, and temperatures $T$:\n\n- Case $1$ (happy path): $I(t) = 2 \\sin\\big(2\\pi \\cdot 0.5 \\cdot t\\big)$ (Amperes), $\\theta = $ $0.5$ (dimensionless), $T = $ $298$ (Kelvin).\n- Case $2$ (boundary with step): $I(t) = 5 \\cdot H(t - 2)$ (Amperes) where $H$ is the Heaviside step function, $\\theta = $ $1.5$ (dimensionless), $T = $ $318$ (Kelvin).\n- Case $3$ (zero input): $I(t) \\equiv 0$ (Amperes), $\\theta = $ $0.7$ (dimensionless), $T = $ $290$ (Kelvin).\n- Case $4$ (edge with narrow pulse at low temperature): $I(t) = 8 \\exp\\!\\big(-(t - 5)^2/(2 \\cdot 0.15^2)\\big)$ (Amperes), $\\theta = $ $0.2$ (dimensionless), $T = $ $273$ (Kelvin).\n\nProgram requirements:\n\n- Implement the ground-truth operator $V(t)$ using the parameterizations above and a causal discrete convolution with time step $\\Delta t$.\n- Implement the DeepONet surrogate $\\widehat{V}(t)$ with the trunk dictionary and branch parameter encoding as specified, including the softmax-based gating weights $w_k(\\theta,T)$ constructed from scores $r_k(\\theta,T) = -\\big|\\log \\tau(\\theta,T) - \\log \\tau_d^{(k)}\\big|$.\n- For each test case, compute the root-mean-square error\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N+1} \\sum_{n=0}^{N} \\big(\\widehat{V}(t_n) - V(t_n)\\big)^2},\n$$\nexpressed in Volts.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in Volts, for the four test cases in the order listed above (e.g., $[\\mathrm{rmse}_1,\\mathrm{rmse}_2,\\mathrm{rmse}_3,\\mathrm{rmse}_4]$). Round each entry to $6$ decimal places.\n\nAngle units are not present in this problem. All physical units must be respected as specified above. The parameters $\\theta$ are dimensionless. Ensure scientific realism and numerical stability throughout your implementation. The program must be completely self-contained, without any external input.",
            "solution": "The user-provided problem statement is subjected to validation and is determined to be **valid**. It is scientifically grounded in established principles of electrochemical engineering, mathematically consistent, and well-posed. The problem provides a complete and unambiguous specification for constructing a physics-informed operator network surrogate and evaluating it against a simplified, but physically sensible, ground-truth model of a lithium-ion cell. The numerical parameters, functional forms, and test cases are all clearly defined, enabling a direct and verifiable implementation.\n\nThe solution proceeds by first implementing the ground-truth model and then the specified Deep Operator Network (DeepONet) surrogate. The error between the two is then quantified for a suite of test cases.\n\n### Ground-Truth Model Implementation\n\nThe ground-truth voltage response $V(t)$ is defined by the operator:\n$$\nV(t) = U(\\theta,T) - R_0(\\theta,T)\\, I(t) - A(\\theta,T)\\, \\int_{0}^{t} \\frac{1}{\\tau(\\theta,T)} e^{-(t-\\tau')/\\tau(\\theta,T)}\\, I(\\tau')\\, d\\tau'\n$$\nThis model represents the superposition of three physical effects:\n1.  A baseline open-circuit voltage, $U(\\theta,T)$.\n2.  An instantaneous ohmic voltage drop, $R_0(\\theta,T) I(t)$.\n3.  A dynamic voltage component resulting from diffusive relaxation processes, represented by the convolution integral.\n\nThe physical parameters $U$, $R_0$, $A$, and $\\tau$ are functions of a dimensionless parameter $\\theta$ and temperature $T$. Their specified dependencies are physically motivated, such as the Arrhenius-type temperature scaling for resistance, $R_0 \\propto \\exp(\\gamma/T)$, and the inverse temperature scaling for the diffusion time constant, $\\tau \\propto 1/T$. These parameters are computed for a given $(\\theta, T)$ pair using the provided formulas:\n$$\nU(\\theta,T) = U_0 + \\alpha\\, \\theta + \\beta\\, (T - T_0)\n$$\n$$\nR_0(\\theta,T) = R_{0,\\text{base}}\\, \\exp\\!\\big(\\gamma / T\\big)\\, \\big(1 + \\delta\\, \\theta\\big)\n$$\n$$\n\\tau(\\theta,T) = \\tau_{\\text{base}}\\, \\big(1 + \\eta\\, \\theta\\big)\\, \\frac{T_0}{T}\n$$\n$$\nA(\\theta,T) = A_{\\text{base}}\\, \\big(1 + \\zeta\\, \\theta\\big)\\, \\sqrt{\\frac{T_0}{T}}\n$$\nwhere all constants ($U_0, R_{0,\\text{base}}, \\dots$) are given.\n\nThe model is implemented numerically on a discrete time grid $t_n = n \\Delta t$ for $n \\in \\{0, 1, \\dots, N\\}$. The convolution integral is computed as a discrete causal convolution. If we define a kernel $K(t) = \\frac{A(\\theta,T)}{\\tau(\\theta,T)} \\exp(-t/\\tau(\\theta,T))$, the convolution term at time $t_n$ is $(K * I)(t_n) \\Delta t$. This is efficiently calculated using `numpy.convolve`. The final ground-truth voltage at each time step $t_n$ is then:\n$$\nV(t_n) = U(\\theta,T) - R_0(\\theta,T) I(t_n) - A(\\theta,T) \\left( \\left(\\frac{1}{\\tau(\\theta,T)}e^{-t/\\tau(\\theta,T)}\\right) * I(t) \\right)_n \\Delta t\n$$\n\n### Physics-Informed DeepONet Surrogate Implementation\n\nThe DeepONet is designed to approximate the operator $I(\\cdot) \\mapsto V(\\cdot)$ conditioned on $(\\theta, T)$. Its structure, $\\widehat{V}(t) = \\sum_j c_j \\xi_j(t)$, separates the model into a trunk network, which generates a parameter-independent basis $\\{\\xi_j(t)\\}$, and a branch network, which computes input- and parameter-dependent coefficients $\\{c_j\\}$.\n\n**Trunk Network:** The basis functions $\\{\\xi_j(t)\\}$ are designed to span the space of possible voltage responses. They are fixed and do not depend on $(\\theta, T)$. The chosen basis comprises three components:\n1.  **Constant Basis:** $\\xi_0(t) = 1$. This function provides a bias term, which will be modulated by the branch network to represent the open-circuit voltage $U(\\theta,T)$.\n2.  **Input Reconstruction Basis:** A set of $m=25$ localized Gaussian functions, $\\{\\phi_i(t)\\}_{i=1}^{m}$, centered at uniformly spaced sensor locations $\\{s_i\\}_{i=1}^{m}$. These functions are normalized to form a partition of unity, $\\sum_{i=1}^m \\phi_i(t) = 1$, by dividing each Gaussian by their sum. This basis allows the network to reconstruct a smooth representation of the input current $I(t) \\approx \\sum_{i=1}^m I(s_i) \\phi_i(t)$, which is essential for capturing the ohmic term.\n3.  **Diffusive Kernel Basis:** A dictionary of $K=2$ causal exponential kernels $\\{\\xi_{k,i}(t)\\}_{k,i}$ with fixed time constants $\\tau_d^{(1)}$ and $\\tau_d^{(2)}$. Each basis function $\\xi_{k,i}(t) = \\frac{1}{\\tau_d^{(k)}} \\exp(-(t-s_i)/\\tau_d^{(k)})$ for $t \\ge s_i$ (and $0$ otherwise) represents a relaxation response originating at sensor location $s_i$ with a characteristic time $\\tau_d^{(k)}$. The full set of these functions for all sensors $i$ and dictionary elements $k$ forms a basis capable of approximating the true convolutional kernel.\n\n**Branch Network:** The branch network computes the coefficients $\\{c_j\\}$ for the basis functions. In this problem, no training is performed; the coefficients are analytically defined functions of the physical parameters $(\\theta, T)$ and the input current $I(\\cdot)$, sampled at sensor locations $s_i$.\n1.  **Coefficient for Constant Basis:** $c_0 = U(\\theta,T)$, directly mapping the physics of the open-circuit voltage to the corresponding basis function.\n2.  **Coefficients for Ohmic Term:** $c^{\\text{ohm}}_i = -R_0(\\theta,T) I(s_i)$. When combined with the partition-of-unity basis $\\phi_i(t)$, the sum $\\sum_i c^{\\text{ohm}}_i \\phi_i(t) = -R_0(\\theta,T) \\sum_i I(s_i) \\phi_i(t)$ provides a smooth approximation of the true ohmic drop, $-R_0(\\theta,T) I(t)$.\n3.  **Coefficients for Diffusive Term:** $c^{\\text{diff}}_{k,i} = -A(\\theta,T) w_k(\\theta,T) I(s_i) \\Delta s$. These coefficients scale the exponential basis functions. The term $I(s_i)\\Delta s$ approximates the infinitesimal element $I(\\tau')d\\tau'$ in the convolution integral. The key innovation is the gating weight $w_k(\\theta,T)$, which is computed via a softmax function applied to scores $r_k(\\theta,T) = -|\\log \\tau(\\theta,T) - \\log \\tau_d^{(k)}|$. This mechanism selects the dictionary kernel $\\tau_d^{(k)}$ that is \"closest\" to the true physical time constant $\\tau(\\theta,T)$ in a logarithmic sense, effectively allowing the fixed trunk basis to adapt to varying physical parameters.\n\n**Surrogate Voltage Assembly:** The final surrogate voltage $\\widehat{V}(t)$ is constructed by summing the contributions of all basis functions weighted by their corresponding coefficients:\n$$\n\\widehat{V}(t_n) = c_0 \\cdot \\xi_0(t_n) + \\sum_{i=1}^{m} c^{\\text{ohm}}_i \\cdot \\phi_{i}(t_n) + \\sum_{k=1}^{K} \\sum_{i=1}^{m} c^{\\text{diff}}_{k,i} \\cdot \\xi_{k,i}(t_n)\n$$\nThis summation is performed numerically for each point $t_n$ on the time grid.\n\n### Evaluation\n\nFor each of the four specified test cases, the input current profile $I(t)$, parameter $\\theta$, and temperature $T$ are used to compute both the ground-truth voltage $V(t_n)$ and the surrogate voltage $\\widehat{V}(t_n)$ across the time domain. The accuracy of the surrogate is then quantified by the Root Mean Square Error (RMSE):\n$$\n\\text{RMSE} = \\sqrt{\\frac{1}{N+1} \\sum_{n=0}^{N} \\big(\\widehat{V}(t_n) - V(t_n)\\big)^2}\n$$\nThe program calculates and reports this RMSE value for each case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    # --- GLOBAL PARAMETERS ---\n    # Time discretization\n    t_max = 10.0\n    dt = 0.02\n    N = int(t_max / dt)\n    t_grid = np.linspace(0, t_max, N + 1)\n\n    # Sensor placement\n    m = 25\n    s_locs = np.linspace(0, t_max, m)\n    ds = t_max / (m - 1) if m > 1 else 0\n\n    # DeepONet dictionary parameters\n    tau_d = np.array([1.0, 4.0])\n    K = len(tau_d)\n\n    # Physical constants\n    T0 = 298.0\n    U0 = 3.6\n    R0_base = 0.01\n    tau_base = 2.0\n    A_base = 0.02\n    alpha = 0.10\n    beta = 0.001\n    delta = 0.20\n    eta = 0.50\n    zeta = 0.30\n    gamma = 300.0\n\n    # --- HELPER FUNCTIONS ---\n    def get_physical_params(theta, T):\n        \"\"\"Computes the physical parameters U, R0, tau, A for given theta and T.\"\"\"\n        U = U0 + alpha * theta + beta * (T - T0)\n        R0 = R0_base * np.exp(gamma / T) * (1 + delta * theta)\n        tau = tau_base * (1 + eta * theta) * (T0 / T)\n        A = A_base * (1 + zeta * theta) * np.sqrt(T0 / T)\n        return U, R0, tau, A\n\n    # --- GROUND-TRUTH MODEL ---\n    def calculate_V_true(I_t, theta, T):\n        \"\"\"Computes the ground-truth voltage V(t).\"\"\"\n        U, R0, tau, A = get_physical_params(theta, T)\n        \n        # Convolution term: A * integral( (1/tau) * exp(-(t-t'))/tau * I(t') dt' )\n        # Implemented as a discrete convolution\n        if tau > 1e-9: # Avoid division by zero\n            kernel = (1 / tau) * np.exp(-t_grid / tau)\n            convolution_integral = np.convolve(I_t, kernel)[:N + 1] * dt\n        else:\n            convolution_integral = np.zeros_like(t_grid)\n        \n        V_true = U - R0 * I_t - A * convolution_integral\n        return V_true\n\n    # --- PHYSICS-INFORMED DEEPONET SURROGATE ---\n    def calculate_V_hat(I_t, theta, T):\n        \"\"\"Computes the DeepONet surrogate voltage V_hat(t).\"\"\"\n        # Sample input current at sensor locations\n        I_s = np.interp(s_locs, t_grid, I_t)\n        \n        # Get physical parameters for branch network\n        U, R0, tau, A = get_physical_params(theta, T)\n        \n        # --- TRUNK NETWORK: Basis Functions ---\n        # 1. Constant basis\n        xi_0 = np.ones_like(t_grid)\n        \n        # 2. Input reconstruction basis (normalized Gaussians)\n        sigma = ds\n        phi_unnormalized = np.exp(-(t_grid[:, np.newaxis] - s_locs)**2 / (2 * sigma**2))\n        phi_sum = np.sum(phi_unnormalized, axis=1, keepdims=True)\n        # Prevent division by zero if sum is numerically zero\n        phi_sum[phi_sum  1e-9] = 1.0\n        phi_normalized = phi_unnormalized / phi_sum  # Shape: (N+1, m)\n\n        # 3. Diffusive kernel basis (causal exponentials)\n        xi_ki = np.zeros((K, m, N + 1))\n        for k in range(K):\n            for i in range(m):\n                mask = t_grid >= s_locs[i]\n                time_diff = t_grid[mask] - s_locs[i]\n                xi_ki[k, i, mask] = (1 / tau_d[k]) * np.exp(-time_diff / tau_d[k])\n                \n        # --- BRANCH NETWORK: Coefficients ---\n        # 1. Coefficient for constant basis\n        c_0 = U\n        \n        # 2. Coefficients for ohmic term\n        c_ohm_i = -R0 * I_s  # Shape: (m,)\n        \n        # 3. Coefficients for diffusive term\n        # Softmax gating weights w_k\n        r_k = -np.abs(np.log(tau) - np.log(tau_d))\n        exp_r_k = np.exp(r_k)\n        w_k = exp_r_k / np.sum(exp_r_k)  # Shape: (K,)\n        # Full coefficients c_diff_k,i\n        c_diff_ki = -A * w_k[:, np.newaxis] * I_s[np.newaxis, :] * ds # Shape: (K, m)\n\n        # --- ASSEMBLE SURROGATE VOLTAGE ---\n        # Term 1: Constant term\n        V_hat = c_0 * xi_0\n        \n        # Term 2: Ohmic term\n        ohmic_term = np.sum(c_ohm_i[np.newaxis, :] * phi_normalized, axis=1)\n        V_hat += ohmic_term\n        \n        # Term 3: Diffusive term\n        # Sum over k and i.\n        diffusive_term = np.sum(c_diff_ki[:, :, np.newaxis] * xi_ki, axis=(0, 1))\n        V_hat += diffusive_term\n        \n        return V_hat\n\n    # --- TEST SUITE ---\n    test_cases = [\n        (lambda t: 2.0 * np.sin(2 * np.pi * 0.5 * t), 0.5, 298.0),\n        (lambda t: 5.0 * (t >= 2.0), 1.5, 318.0),\n        (lambda t: np.zeros_like(t), 0.7, 290.0),\n        (lambda t: 8.0 * np.exp(-(t - 5.0)**2 / (2 * 0.15**2)), 0.2, 273.0),\n    ]\n\n    results = []\n    for i, (I_func, theta, T) in enumerate(test_cases):\n        I_t = I_func(t_grid)\n        \n        # Calculate ground-truth and surrogate voltages\n        V_true = calculate_V_true(I_t, theta, T)\n        V_hat = calculate_V_hat(I_t, theta, T)\n        \n        # Calculate RMSE\n        rmse = np.sqrt(np.mean((V_hat - V_true)**2))\n        results.append(rmse)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A trained model's predictions are only as valuable as the rigor with which it has been validated. This problem focuses on the critical task of designing a cross-validation protocol to assess the robustness of a P2D surrogate model across varied operating conditions. You will analyze different validation strategies to identify one that avoids common pitfalls like data leakage while effectively testing the model's ability to generalize to new current profiles and temperatures, a vital step for building trustworthy digital twins .",
            "id": "3941045",
            "problem": "You are training a physics-informed neural network (PINN) surrogate to emulate the Pseudo-Two-Dimensional (P2D) electrochemical model of a lithium-ion cell. The surrogate takes as inputs a current profile $I(t)$ and temperature $T$, and predicts terminal voltage $V(t)$ and internal fields, including solid-phase concentration $c_s(r,x,t)$, electrolyte concentration $c_e(x,t)$, and potentials $\\phi_s(x,t)$ and $\\phi_e(x,t)$. The training objective is a composite loss combining data fidelity and physics residuals of the P2D equations and constraints:\n- Solid-phase diffusion in spherical particles: $\\partial_t c_s = D_s(T)\\,\\nabla_r^2 c_s$, with boundary flux proportional to the interfacial current density $j$ at the particle surface.\n- Electrolyte mass transport: $\\epsilon_e\\,\\partial_t c_e = \\nabla_x\\cdot(D_e(T)\\,\\nabla_x c_e) - (1 - t_+^0)\\,a_s\\,j$ in the porous electrode and separator.\n- Interfacial kinetics via Butler–Volmer: $j = 2\\,k(T)\\,\\sqrt{c_e}\\,\\sinh\\!\\left(\\dfrac{\\alpha F\\,\\eta}{R T}\\right)$, with overpotential $\\eta$, transfer coefficient $\\alpha$, Faraday constant $F$, and universal gas constant $R$.\n- Arrhenius temperature dependence: $k(T) = k_0 \\exp\\!\\left(-\\dfrac{E_a}{R T}\\right)$, $D_s(T) = D_{s,0} \\exp\\!\\left(-\\dfrac{E_{a,s}}{R T}\\right)$, $D_e(T) = D_{e,0} \\exp\\!\\left(-\\dfrac{E_{a,e}}{R T}\\right)$.\n\nYour dataset consists of complete charge and discharge experiments that pair a current profile $p$ with a temperature $T$. Profiles include constant-current (CC), hybrid pulse power characterization (HPPC), and drive cycles with rich frequency content. Temperatures span three values $T \\in \\{273\\ \\mathrm{K}, 298\\ \\mathrm{K}, 323\\ \\mathrm{K}\\}$. Each experiment provides time series $\\{I(t), T, V(t)\\}$ and, for a subset, high-fidelity P2D internal states for supervision. The goal is to design a cross-validation protocol that (i) assesses robustness under distributional shifts across both current profiles and temperatures, and (ii) detects overfitting to specific regimes, while avoiding leakage and using physics-consistent evaluation.\n\nWhich of the following validation protocols best satisfies these goals?\n\nA. Perform random $K$-fold cross-validation by splitting individual time indices uniformly across the entire dataset, ensuring each fold contains a mix of all profiles and temperatures. Normalize inputs using statistics computed over the full dataset. Select hyperparameters by early stopping on validation mean squared error of $V(t)$, and report the average across folds.\n\nB. Use group-aware $K$-fold cross-validation where each group is a single experiment $(p,T)$, but compute feature normalization using all data (including held-out groups). Optimize hyperparameters by evaluating performance on the held-out test fold to pick the best configuration. Use terminal voltage $V(t)$ error as the sole metric.\n\nC. Use nested, group-aware cross-validation with groups defined at the regime level, where each regime is a pair $(\\text{profile class}, \\text{temperature})$. In the outer loop, perform leave-one-regime-out, holding out all experiments for a given $(p,T)$. In the inner loop on the remaining regimes, run group $K$-fold to select architecture and the weights of physics residual and boundary/initial condition losses. Compute normalization statistics strictly on the inner-loop training groups and carry them through to validation and outer-loop test. Evaluate on the outer test regime using multiple metrics: normalized root mean square error of $V(t)$ over time, trajectory errors for $c_s$ and $c_e$ where available, and the mean residual norms of the P2D partial differential equations and constraints. Include stress tests by designating outer-loop folds that leave out the highest temperature $T=323\\ \\mathrm{K}$ and the most rapidly varying profile class to probe extrapolation. Aggregate metrics by state-of-charge strata to avoid bias from unequal dwell times.\n\nD. Perform leave-one-temperature-out cross-validation, holding out all data at one temperature while training on all profiles at the other temperatures. Normalize using global statistics from all data. Use a single validation split drawn from the training temperatures to select hyperparameters, and evaluate only on terminal voltage $V(t)$ error averaged over time.\n\nE. Apply blocked time-series cross-validation within each experiment $(p,T)$, using temporal blocks to preserve autocorrelation. Combine errors across blocks and experiments into a single score. Select hyperparameters via early stopping on the average block-wise validation error, and report test performance on the remaining blocks of the same experiments.\n\nSelect the most appropriate option.",
            "solution": "The problem asks for the most appropriate cross-validation protocol for a physics-informed neural network (PINN) surrogate of a lithium-ion cell's P2D model. The stated goals for the protocol are to (i) assess robustness under distributional shifts, (ii) detect overfitting, (iii) avoid data leakage, and (iv) use physics-consistent evaluation. A careful analysis of these requirements is essential to select the correct protocol.\n\nThe dataset is structured, comprising multiple time-series experiments. Each experiment is defined by a specific current profile class (e.g., constant-current, drive cycle) and a specific operating temperature $T$ from the set $\\{273\\ \\mathrm{K}, 298\\ \\mathrm{K}, 323\\ \\mathrm{K}\\}$. This structure, where data points are naturally clustered into groups, is critical. The primary challenge is to ensure the model generalizes not just to unseen time points within a known experiment, but to entirely new operating regimes, which are combinations of profile types and temperatures.\n\nLet us evaluate each proposed protocol against the stated goals and the principles of rigorous machine learning model validation.\n\n### Analysis of Option A\nThis option proposes a standard, non-grouped $K$-fold cross-validation by randomly splitting individual time indices.\n\n- **Leakage:** This protocol is critically flawed due to two forms of data leakage.\n    1. **Temporal Leakage:** The data $\\{I(t), V(t), ...\\}$ are time series with strong autocorrelation. Randomly sampling individual time points places temporally adjacent data points into training and validation sets. For instance, a point at time $t$ could be in training and the point at $t + \\Delta t$ in validation. A model can easily predict the validation point by simple interpolation from its neighbors, leading to an artificially inflated performance metric. It fails to test the model's ability to perform long-term prediction.\n    2. **Normalization Leakage:** The protocol states to \"Normalize inputs using statistics computed over the full dataset.\" This is a fundamental error. The normalization parameters (e.g., mean and standard deviation) are part of the trained model. By computing them on the entire dataset, including the validation and test folds, information from the holdout data \"leaks\" into the training process, again leading to optimistic and invalid performance estimates. Normalization statistics must be learned *only* from the training data of a given fold.\n\n- **Assessing Distributional Shifts:** By design, random splitting ensures that the training and validation sets are identically distributed. This approach is incapable of assessing the model's robustness to distributional shifts, as it is never required to extrapolate or generalize to an unseen regime (e.g., a new temperature or a new profile class).\n\n- **Evaluation Metrics:** The protocol relies solely on the mean squared error of the terminal voltage $V(t)$. This is an incomplete evaluation for a PINN, which is designed not only to fit data but also to satisfy the underlying governing partial differential equations (PDEs), such as $\\partial_t c_s = D_s(T)\\,\\nabla_r^2 c_s$. A proper evaluation must also quantify the physics residuals.\n\n**Verdict:** Incorrect. This protocol violates the core principles of an independent test set for time-series and grouped data and employs a flawed evaluation strategy.\n\n### Analysis of Option B\nThis option proposes group-aware $K$-fold cross-validation, where groups are individual experiments. This correctly addresses the temporal leakage issue of option A.\n\n- **Leakage:** Despite using group-aware splitting, this protocol commits two critical errors:\n    1. **Normalization Leakage:** It repeats the flaw from option A: \"compute feature normalization using all data (including held-out groups).\"\n    2. **Hyperparameter Tuning Leakage:** It states to \"Optimize hyperparameters by evaluating performance on the held-out test fold.\" The test set (in this case, the holdout fold in a single CV loop) must be used only for final, unbiased performance estimation. Using it to select hyperparameters (model architecture, learning rate, loss weights, etc.) makes the hyperparameters \"overfit\" to that specific test set, rendering the final performance report invalid and optimistic. Proper hyperparameter tuning requires a three-way split: training, validation (for tuning), and testing (for final evaluation), often implemented via nested cross-validation.\n\n- **Evaluation Metrics:** Similar to option A, it relies on a single, incomplete metric: the error in $V(t)$.\n\n**Verdict:** Incorrect. It contains fundamental methodological flaws in normalization and hyperparameter optimization.\n\n### Analysis of Option C\nThis option proposes a sophisticated, multi-layered protocol.\n\n- **Structure:** It uses nested, group-aware cross-validation. This is the gold standard for projects involving both model evaluation and hyperparameter tuning.\n    - The **outer loop** performs leave-one-regime-out validation, where a \"regime\" is a pair of (profile class, temperature). Holding out an entire regime is the most direct and challenging way to test for robustness to distributional shifts, which is a primary goal. Special \"stress tests\" (holding out the highest temperature or most dynamic profile) explicitly probe extrapolation capabilities.\n    - The **inner loop** performs group $K$-fold cross-validation on the remaining data to tune hyperparameters (e.g., architecture and loss weights for the physics residuals). This ensures that hyperparameter selection is performed robustly without touching the outer-loop's test set.\n\n- **Leakage:** This protocol is meticulously designed to prevent leakage. It \"Compute[s] normalization statistics strictly on the inner-loop training groups,\" which is the correct procedure. The separation of hyperparameter tuning (inner loop) and final evaluation (outer loop) prevents tuning on the test set.\n\n- **Evaluation Metrics:** The evaluation is comprehensive and directly aligned with the PINN methodology. It includes multiple metrics:\n    1. **Data fidelity:** Normalized root mean square error of $V(t)$.\n    2. **Internal state accuracy:** Errors for $c_s(r,x,t)$ and $c_e(x,t)$, leveraging the full predictive power of the model.\n    3. **Physics consistency:** The mean norms of the PDE residuals.\n    Furthermore, it suggests aggregating metrics by state-of-charge strata, a domain-specific refinement to prevent metrics from being dominated by long rest periods (where error is typically low), thus providing a more meaningful assessment of dynamic performance.\n\n**Verdict:** Correct. This protocol is methodologically sound, rigorous, and perfectly aligned with all stated goals. It demonstrates a deep understanding of both machine learning best practices and the specific challenges of surrogate modeling for physical systems.\n\n### Analysis of Option D\nThis option proposes leave-one-temperature-out cross-validation.\n\n- **Structure:** This is a specific instance of leave-one-group-out CV, where the group is temperature. It is a reasonable strategy for assessing temperature extrapolation. However, it is less comprehensive than C's \"leave-one-regime-out,\" as it doesn't systematically test for generalization across current profile classes in the same structured manner. The use of a \"single validation split\" for hyperparameter tuning is less robust than the inner cross-validation loop proposed in C.\n\n- **Leakage:** It suffers from the same critical normalization leakage as options A and B: \"Normalize using global statistics from all data.\"\n\n- **Evaluation Metrics:** It uses only the error in $V(t)$, which is an incomplete evaluation for a PINN.\n\n**Verdict:** Incorrect. While its overall structure is a reasonable starting point, it is marred by a critical data leakage flaw and an inadequate evaluation strategy, making it inferior to C.\n\n### Analysis of Option E\nThis option proposes blocked time-series cross-validation *within* each experiment.\n\n- **Assessing Distributional Shifts:** This protocol's scope is incorrect. By only splitting and testing *within* each experiment, it assesses the model's ability to extrapolate in time for a *known* operating condition (profile and temperature). It completely fails to assess generalization to *new* operating conditions, which is the central challenge described in the problem. It answers a different, much simpler question than the one posed.\n\n- **Structure:** The blocked CV approach correctly handles temporal dependencies for a single time series. However, it ignores the higher-level group structure of the dataset (i.e., different experiments corresponding to different regimes), which is essential for testing the desired form of robustness.\n\n**Verdict:** Incorrect. The methodology is misapplied and fails to address the primary goal of assessing robustness across different current profiles and temperatures.\n\n### Conclusion\nOption C describes the most rigorous and appropriate validation protocol. It correctly identifies the hierarchical structure of the data and employs nested, group-aware cross-validation to robustly assess generalization to new operating regimes while avoiding data leakage. Its multi-faceted evaluation strategy is tailored to the physics-informed nature of the model. All other options contain critical methodological flaws (data leakage, improper hyperparameter tuning) or are conceptually misaligned with the problem's primary objectives.",
            "answer": "$$\\boxed{C}$$"
        }
    ]
}