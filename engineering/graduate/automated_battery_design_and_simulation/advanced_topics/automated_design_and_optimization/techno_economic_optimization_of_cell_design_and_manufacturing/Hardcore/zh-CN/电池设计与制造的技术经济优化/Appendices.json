{
    "hands_on_practices": [
        {
            "introduction": "在电池设计中，工程师常常面临相互冲突的目标，例如，在追求更高能量密度的同时必须控制成本。为了应对这一挑战，我们引入了多目标优化的概念。这项实践将引导您构建一个简化的技经模型，用以探索电极厚度 $L_p$ 和孔隙率 $\\epsilon_p$ 这两个关键设计变量对电池性能与成本的影响。通过生成和分析帕累托前沿（Pareto front），您将学会如何量化和可视化这些设计决策中的内在权衡，并找到代表了最优平衡点的“拐点”。",
            "id": "3954458",
            "problem": "制造一个厚度为 $L_p$、孔隙率为 $\\epsilon_p$ 的锂离子电池正极。考虑一个具有两个目标的技术经济优化问题：最大化性能和最小化成本。您需要使用基于基本物理和经济考量推导出的替代模型，来计算和分析在 $L_p$ 和 $\\epsilon_p$ 的离散设计选择上的帕累托前沿。\n\n从以下基础开始：\n\n- 孔隙率和固体体积分数的定义：固体分数为 $1 - \\epsilon_p$。\n- 活性固体面质量：$m_a = \\rho_s (1 - \\epsilon_p) L_p$，其中 $\\rho_s$ 是固体活性材料的密度。\n- 面容量：$Q_a = Q_s \\, m_a$，其中 $Q_s$ 是固体的比容量。\n- 围绕平均电压放电的面能量含量：$E_a = Q_a \\, U_{\\text{mean}}$，其中 $U_{\\text{mean}}$ 是平均放电电压。将 $E_a$ 以 $\\mathrm{Wh/m^2}$ 为单位表示。\n- 多孔网络中有效电解质电导率的 Bruggeman 有效介质 (BEM) 关系：$\\kappa_{\\text{eff}} = \\kappa \\, \\epsilon_p^{\\beta}$，其中 $\\kappa$ 是体电解质电导率，$\\beta$ 是 Bruggeman 指数。\n- 孔隙相中的一维稳态欧姆传导 (SSOC)：对于均匀电流密度 $i$，电极上的欧姆电位降 $\\Delta \\phi$ 为 $\\Delta \\phi = i \\, L_p / \\kappa_{\\text{eff}}$。将允许的压降限制为平均放电电压 $U_{\\text{mean}}$ 的一个分数 $\\alpha$，使得 $i \\le i_{\\text{lim}} = \\alpha \\, U_{\\text{mean}} \\, \\kappa_{\\text{eff}} / L_p$。\n- 在指定目标电流密度 $i_{\\text{target}}$ 下的可输出能量：定义可输出分数 $f = \\min\\left(1, \\, i_{\\text{lim}} / i_{\\text{target}}\\right)$ 和可输出面能量 $E_{\\text{del}} = f \\, E_a$，以 $\\mathrm{Wh/m^2}$ 为单位表示。\n- 结合材料和加工的单位面积成本：$C_{\\text{area}} = c_s \\, m_a + c_{p0} + c_{pL} \\, L_p \\, \\left(1 + \\gamma (1 - \\epsilon_p)\\right)$，以 $\\$\\!/\\mathrm{m^2}$ 为单位表示，其中 $c_s$ 是每 $\\mathrm{kg}$ 的材料成本，$c_{p0}$ 是每 $\\mathrm{m^2}$ 的固定加工管理费用，$c_{pL}$ 是每 $\\mathrm{m^3}$ 的与厚度成比例的加工成本，$\\gamma$ 调节因较高固体分数而增加的加工负担。\n\n任务：\n\n1. 仅使用上述基础，推导 $E_{\\text{del}}(L_p,\\epsilon_p)$ 和 $C_{\\text{area}}(L_p,\\epsilon_p)$ 的显式替代表达式，这些表达式依赖于 $L_p$ 和 $\\epsilon_p$ 及给定的常数。\n2. 在离散设计网格 $L_p \\in \\{60\\,\\mu\\mathrm{m},\\,100\\,\\mu\\mathrm{m},\\,140\\,\\mu\\mathrm{m},\\,180\\,\\mu\\mathrm{m},\\,220\\,\\mu\\mathrm{m}\\}$ 和 $\\epsilon_p \\in \\{0.30,\\,0.35,\\,0.40,\\,0.45,\\,0.50\\}$ 上，为每一对计算 $(E_{\\text{del}}, C_{\\text{area}})$。\n3. 计算用于最大化 $E_{\\text{del}}$ 和最小化 $C_{\\text{area}}$ 的帕累托前沿。如果 $E_1 \\ge E_2$ 且 $C_1 \\le C_2$，并且至少有一个不等式是严格的，则设计 $(E_1, C_1)$ 支配 $(E_2, C_2)$。帕累托前沿是非支配设计的集合。\n4. 通过帕累托前沿的曲率来解释权衡关系。使用最小-最大归一化将帕累托前沿坐标在每个轴上归一化到 $[0,1]$：$x = (C - C_{\\min})/(C_{\\max} - C_{\\min})$ 和 $y = (E - E_{\\min})/(E_{\\max} - E_{\\min})$，其中 $(x,y)$ 是归一化的成本和性能。使用外接圆公式为三个连续点 $(x_{i-1},y_{i-1})$、$(x_i,y_i)$、$(x_{i+1},y_{i+1})$ 计算归一化前沿上每个内部点的离散曲率：\n$$\n\\kappa_i = \\frac{2 A_i}{d_{i-1,i} \\, d_{i,i+1} \\, d_{i+1,i-1}},\n$$\n其中 $A_i$ 是由这三点形成的三角形的面积（使用鞋带公式），$d_{j,k}$ 是点 $j$ 和点 $k$ 之间的欧几里得距离。\n5. 将归一化前沿上具有最大曲率 $\\kappa_i$ 的帕累托设计点识别为“膝点”。如果帕累托前沿的点数少于3个，则定义 $\\kappa = 0$，并根据对 $(x,-y)$ 的字典序偏好，选择具有最低 $x$ 和最高 $y$ 的点作为膝点。\n对于下面测试套件中的每一组参数，计算膝点设计并报告：\n   - $L_p$（以 $\\mu\\mathrm{m}$ 为单位的整数），\n   - $\\epsilon_p$（保留两位小数的小数），\n   - 归一化曲率 $\\kappa$（保留三位小数），\n   - $E_{\\text{del}}$（以 $\\mathrm{Wh/m^2}$ 为单位，保留一位小数），\n   - $C_{\\text{area}}$（以 $\\$\\!/\\mathrm{m^2}$ 为单位，保留两位小数）。\n\n测试套件（每个案例给出 $(\\rho_s, Q_s, U_{\\text{mean}}, \\kappa, \\beta, \\alpha, i_{\\text{target}}, c_s, c_{p0}, c_{pL}, \\gamma)$）：\n\n- 案例 $\\mathbf{A}$（基准）：$(\\,$$3000$$\\,\\mathrm{kg/m^3}$, $170\\,\\mathrm{Ah/kg}$, $3.7\\,\\mathrm{V}$, $1.0\\,\\mathrm{S/m}$, $1.5$, $0.03$, $200\\,\\mathrm{A/m^2}$, $22\\,\\$/\\mathrm{kg}$, $1.5\\,\\$/\\mathrm{m^2}$, $80\\,\\$/\\mathrm{m^3}$, $1.2\\,)$.\n- 案例 $\\mathbf{B}$（更高电导率的电解质）：$(\\,$$3000$$\\,\\mathrm{kg/m^3}$, $170\\,\\mathrm{Ah/kg}$, $3.7\\,\\mathrm{V}$, $1.5\\,\\mathrm{S/m}$, $1.5$, $0.03$, $200\\,\\mathrm{A/m^2}$, $22\\,\\$/\\mathrm{kg}$, $1.5\\,\\$/\\mathrm{m^2}$, $80\\,\\$/\\mathrm{m^3}$, $1.2\\,)$.\n- 案例 $\\mathbf{C}$（更严格的欧姆约束和更高的目标电流）：$(\\,$$3000$$\\,\\mathrm{kg/m^3}$, $170\\,\\mathrm{Ah/kg}$, $3.7\\,\\mathrm{V}$, $1.0\\,\\mathrm{S/m}$, $1.5$, $0.02$, $250\\,\\mathrm{A/m^2}$, $22\\,\\$/\\mathrm{kg}$, $1.5\\,\\$/\\mathrm{m^2}$, $80\\,\\$/\\mathrm{m^3}$, $1.2\\,)$.\n- 案例 $\\mathbf{D}$（更高的材料成本）：$(\\,$$3000$$\\,\\mathrm{kg/m^3}$, $170\\,\\mathrm{Ah/kg}$, $3.7\\,\\mathrm{V}$, $1.0\\,\\mathrm{S/m}$, $1.5$, $0.03$, $200\\,\\mathrm{A/m^2}$, $35\\,\\$/\\mathrm{kg}$, $1.5\\,\\$/\\mathrm{m^2}$, $80\\,\\$/\\mathrm{m^3}$, $1.2\\,)$.\n\n角度单位不适用。百分比必须表示为小数分数。\n\n最终输出格式：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是按 $\\mathbf{A}$、$\\mathbf{B}$、$\\mathbf{C}$、$\\mathbf{D}$ 顺序排列的一个案例的列表：$[\\,[L_p,\\epsilon_p,\\kappa,E_{\\text{del}},C_{\\text{area}}],\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$。",
            "solution": "所提出的问题是技术经济优化和替代模型领域一个明确定义的练习，其基础是锂离子电池设计中既定的物理和经济原理。问题陈述是自包含的，提供了所有必要的参数、定义和方程式。单位是一致的，给出的参数值在物理上是现实的。这些任务是客观的、定量的，并能导出一个唯一的可计算解。因此，该问题被认为是有效的。\n\n解决方案首先推导目标的显式替代模型，然后概述计算流程，以识别帕累托最优设计和优选的“膝点”，该点代表了性能与成本之间的平衡权衡。\n\n### 1. 替代模型的推导\n\n问题要求推导可输出面能量 $E_{\\text{del}}(L_p, \\epsilon_p)$ 和单位面积成本 $C_{\\text{area}}(L_p, \\epsilon_p)$ 作为电极厚度 $L_p$ 和孔隙率 $\\epsilon_p$ 的函数的显式表达式。\n\n**面成本 ($C_{\\text{area}}$):**\n成本模型如下：\n$$\nC_{\\text{area}} = c_s \\, m_a + c_{p0} + c_{pL} \\, L_p \\, \\left(1 + \\gamma (1 - \\epsilon_p)\\right)\n$$\n活性固体面质量 $m_a$ 定义为：\n$$\nm_a = \\rho_s (1 - \\epsilon_p) L_p\n$$\n将 $m_a$ 的表达式代入成本方程，得到最终的成本替代模型，该模型是 $L_p$ 和 $\\epsilon_p$ 以及材料/工艺常数的函数：\n$$\nC_{\\text{area}}(L_p, \\epsilon_p) = c_s \\rho_s (1 - \\epsilon_p) L_p + c_{p0} + c_{pL} L_p \\left(1 + \\gamma (1 - \\epsilon_p)\\right)\n$$\n\n**可输出面能量 ($E_{\\text{del}}$):**\n可输出能量定义为 $E_{\\text{del}} = f \\cdot E_a$，其中 $E_a$ 是总面能量， $f$ 是可输出分数。\n\n首先，我们表示总面能量 $E_a$。它是面容量 $Q_a$ 和平均放电电压 $U_{\\text{mean}}$ 的乘积。\n$$\nE_a = Q_a \\, U_{\\text{mean}}\n$$\n面容量是比容量 $Q_s$ 和面质量 $m_a$ 的乘积：\n$$\nQ_a = Q_s \\, m_a = Q_s \\rho_s (1 - \\epsilon_p) L_p\n$$\n将这些结合起来，得到总面能量的表达式：\n$$\nE_a(L_p, \\epsilon_p) = Q_s \\rho_s U_{\\text{mean}} (1 - \\epsilon_p) L_p\n$$\n这表明总能量含量与厚度 $L_p$ 和固体体积分数 $(1 - \\epsilon_p)$ 呈线性关系。\n\n接下来，我们推导可输出分数 $f$。该分数受到电解质中欧姆损耗的限制，该损耗通过一维稳态欧姆传导 (SSOC) 模型进行建模。极限电流密度 $i_{\\text{lim}}$ 是通过将欧姆电位降 $\\Delta \\phi$ 限制为平均电压 $U_{\\text{mean}}$ 的一个分数 $\\alpha$ 来找到的：\n$$\n\\Delta \\phi = \\frac{i L_p}{\\kappa_{\\text{eff}}} \\le \\alpha U_{\\text{mean}} \\implies i \\le i_{\\text{lim}} = \\frac{\\alpha U_{\\text{mean}} \\kappa_{\\text{eff}}}{L_p}\n$$\n有效电解质电导率 $\\kappa_{\\text{eff}}$ 由 Bruggeman 关系给出：\n$$\n\\kappa_{\\text{eff}} = \\kappa \\, \\epsilon_p^{\\beta}\n$$\n将其代入 $i_{\\text{lim}}$ 的表达式中，得到：\n$$\ni_{\\text{lim}}(L_p, \\epsilon_p) = \\frac{\\alpha U_{\\text{mean}} \\kappa \\epsilon_p^{\\beta}}{L_p}\n$$\n可输出分数 $f$ 是此极限电流与目标电流密度 $i_{\\text{target}}$ 的比率，上限为 $1$：\n$$\nf = \\min\\left(1, \\frac{i_{\\text{lim}}}{i_{\\text{target}}}\\right) = \\min\\left(1, \\frac{\\alpha U_{\\text{mean}} \\kappa \\epsilon_p^{\\beta}}{L_p i_{\\text{target}}}\\right)\n$$\n最后，可输出面能量的替代模型是 $f$ 和 $E_a$ 的乘积：\n$$\nE_{\\text{del}}(L_p, \\epsilon_p) = \\min\\left(1, \\frac{\\alpha U_{\\text{mean}} \\kappa \\epsilon_p^{\\beta}}{L_p i_{\\text{target}}}\\right) \\cdot \\left[ Q_s \\rho_s U_{\\text{mean}} (1 - \\epsilon_p) L_p \\right]\n$$\n该表达式抓住了基本的权衡关系：更厚、更致密的电极（高 $L_p$，低 $\\epsilon_p$）具有较高的理论能量 $E_a$，但可能受到功率限制（低 $f$）的影响，从而降低了实际可输出的能量 $E_{\\text{del}}$。\n\n### 2. 帕累托前沿计算\n\n该优化问题涉及两个目标：最大化可输出能量 $E_{\\text{del}}$ 和最小化面成本 $C_{\\text{area}}$。解决方案不是单个点，而是一组非支配设计，称为帕累托前沿。\n\n如果 $E_1 \\ge E_2$ 且 $C_1 \\le C_2$，并且至少有一个不等式是严格的，则称设计点 $p_1 = (E_1, C_1)$ 支配另一个点 $p_2 = (E_2, C_2)$。帕累托前沿是集合中所有未被任何其他设计支配的设计的集合。\n\n计算步骤如下：\n1.  定义离散设计网格，包含 $N_L=5$ 个厚度值 $L_p \\in \\{60, 100, 140, 180, 220\\}\\,\\mu\\mathrm{m}$ 和 $N_\\epsilon=5$ 个孔隙率值 $\\epsilon_p \\in \\{0.30, 0.35, 0.40, 0.45, 0.50\\}$，总共得到 $N=25$ 个设计点。请注意，在所有计算中，$L_p$ 必须转换为米（例如，$60\\,\\mu\\mathrm{m} = 6 \\times 10^{-5}\\,\\mathrm{m}$）。\n2.  对于 $N$ 个设计对 $(L_p, \\epsilon_p)$ 中的每一个，使用推导出的替代模型计算目标对 $(E_{\\text{del}}, C_{\\text{area}})$。\n3.  通过遍历所有设计点来识别帕累托前沿。对于每个点 $p_i$，检查它是否被任何其他点 $p_j$ 支配。如果不存在这样的 $p_j$，$p_i$ 就是帕累托前沿的成员。\n4.  然后，将识别出的帕累托前沿点按成本 $C_{\\text{area}}$ 递增排序，以进行后续分析。\n\n### 3. 通过曲率识别膝点\n\n帕累托前沿的“膝点”代表一个拐点，通常被解释为最平衡的权衡点。它被识别为归一化前沿上曲率最大的点。\n\n步骤如下：\n1.  如果帕累托前沿包含的点少于3个，则无法计算有意义的曲率。在这种情况下，曲率 $\\kappa$ 定义为 $0$，膝点选择为成本最低的设计，在帕累托前沿上，该点也将在该成本下具有最高的能量。\n2.  如果前沿有3个或更多点，首先对坐标进行归一化。设排序后的帕累托前沿上的点为 $(C_i, E_i)$。找到前沿上所有点的 $C_{\\min}, C_{\\max}, E_{\\min}, E_{\\max}$。归一化坐标 $(x_i, y_i)$ 为：\n    $$\n    x_i = \\frac{C_i - C_{\\min}}{C_{\\max} - C_{\\min}}, \\quad y_i = \\frac{E_i - E_{\\min}}{E_{\\max} - E_{\\min}}\n    $$\n3.  对于归一化前沿上的每个内部点 $i$（即，不是第一个或最后一个点），考虑由它及其相邻点 $(x_{i-1}, y_{i-1})$、$(x_i, y_i)$ 和 $(x_{i+1}, y_{i+1})$ 形成的三角形。\n4.  点 $i$ 处的离散曲率 $\\kappa_i$ 使用外接圆公式计算：\n    $$\n    \\kappa_i = \\frac{2 A_i}{d_{i-1,i} \\, d_{i,i+1} \\, d_{i+1,i-1}}\n    $$\n    其中 $d_{j,k}$ 是归一化点 _j_ 和 _k_ 之间的欧几里得距离，$A_i$ 是由这三点形成的三角形的面积，使用鞋带公式计算。\n5.  膝点是对应于计算出的最大曲率 $\\kappa_i$ 的内部帕累托点的设计。\n\n### 4. 测试案例的实现\n\n整个过程——从为所有25个设计计算目标到识别帕累托前沿的膝点——被封装在一个 Python 脚本中。该脚本遍历四个指定的测试案例中的每一个，应用该案例的常数，并计算膝点设计所需的输出值：$L_p$（以 $\\mu\\mathrmm$ 为单位）、$\\epsilon_p$、归一化曲率 $\\kappa$、$E_{\\text{del}}$（以 $\\mathrm{Wh/m^2}$ 为单位）和 $C_{\\text{area}}$（以 $\\$\\!/\\mathrm{m^2}$ 为单位），并进行指定的四舍五入。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the techno-economic optimization problem for multiple test cases.\n    \"\"\"\n    # 2. Define the discrete design grid\n    Lp_grid_um = np.array([60, 100, 140, 180, 220])\n    Lp_grid_m = Lp_grid_um * 1e-6\n    ep_grid = np.array([0.30, 0.35, 0.40, 0.45, 0.50])\n\n    # Test cases from the problem statement\n    test_cases = [\n        # Case A: base\n        (3000, 170, 3.7, 1.0, 1.5, 0.03, 200, 22, 1.5, 80, 1.2),\n        # Case B: higher conductivity electrolyte\n        (3000, 170, 3.7, 1.5, 1.5, 0.03, 200, 22, 1.5, 80, 1.2),\n        # Case C: stricter ohmic constraint and higher target current\n        (3000, 170, 3.7, 1.0, 1.5, 0.02, 250, 22, 1.5, 80, 1.2),\n        # Case D: higher material cost\n        (3000, 170, 3.7, 1.0, 1.5, 0.03, 200, 35, 1.5, 80, 1.2),\n    ]\n\n    final_results = []\n    \n    for params in test_cases:\n        rho_s, Q_s, U_mean, kappa, beta, alpha, i_target, c_s, c_p0, c_pL, gamma = params\n\n        # Task 2: Compute (E_del, C_area) for each pair\n        design_points = []\n        for Lp_m, Lp_um in zip(Lp_grid_m, Lp_grid_um):\n            for ep in ep_grid:\n                # Surrogate model for E_del\n                m_a = rho_s * (1 - ep) * Lp_m\n                E_a = Q_s * m_a * U_mean\n                kappa_eff = kappa * ep**beta\n                i_lim = alpha * U_mean * kappa_eff / Lp_m\n                f = min(1.0, i_lim / i_target)\n                E_del = f * E_a\n\n                # Surrogate model for C_area\n                C_area = c_s * m_a + c_p0 + c_pL * Lp_m * (1 + gamma * (1 - ep))\n                \n                design_points.append({\n                    'Lp': Lp_um,\n                    'ep': ep,\n                    'E_del': E_del,\n                    'C_area': C_area\n                })\n\n        # Task 3: Compute the Pareto front\n        pareto_front_points = []\n        for p1 in design_points:\n            is_dominated = False\n            for p2 in design_points:\n                if p1 is p2:\n                    continue\n                # p2 dominates p1 if it is better or equal in both objectives\n                # and strictly better in at least one.\n                if (p2['E_del'] = p1['E_del'] and p2['C_area'] = p1['C_area']):\n                    if (p2['E_del']  p1['E_del'] or p2['C_area']  p1['C_area']):\n                        is_dominated = True\n                        break\n            if not is_dominated:\n                pareto_front_points.append(p1)\n\n        # Sort the front by increasing cost\n        pareto_front_points.sort(key=lambda p: p['C_area'])\n\n        # Task 4: Compute the knee point\n        if len(pareto_front_points)  3:\n            # Special case: choose the point with the lowest cost\n            knee_point = pareto_front_points[0]\n            knee_curvature = 0.0\n        else:\n            # Normalize the Pareto front coordinates\n            C_vals = np.array([p['C_area'] for p in pareto_front_points])\n            E_vals = np.array([p['E_del'] for p in pareto_front_points])\n            \n            C_min, C_max = C_vals.min(), C_vals.max()\n            E_min, E_max = E_vals.min(), E_vals.max()\n            \n            C_range = C_max - C_min if (C_max  C_min) else 1.0\n            E_range = E_max - E_min if (E_max  E_min) else 1.0\n\n            normalized_front = np.array([\n                ((p['C_area'] - C_min) / C_range, (p['E_del'] - E_min) / E_range)\n                for p in pareto_front_points\n            ])\n\n            # Calculate curvature for interior points\n            curvatures = []\n            for i in range(1, len(normalized_front) - 1):\n                p_prev = normalized_front[i-1]\n                p_curr = normalized_front[i]\n                p_next = normalized_front[i+1]\n\n                d_prev_curr = np.linalg.norm(p_curr - p_prev)\n                d_curr_next = np.linalg.norm(p_next - p_curr)\n                d_next_prev = np.linalg.norm(p_prev - p_next)\n\n                # Shoelace formula for triangle area\n                area = 0.5 * abs(p_prev[0] * (p_curr[1] - p_next[1]) +\n                                   p_curr[0] * (p_next[1] - p_prev[1]) +\n                                   p_next[0] * (p_prev[1] - p_curr[1]))\n\n                denominator = d_prev_curr * d_curr_next * d_next_prev\n                if denominator  1e-9: # Avoid division by zero for collinear points\n                    curvature = 0.0\n                else:\n                    curvature = 2 * area / denominator\n                curvatures.append(curvature)\n\n            # Find point with max curvature\n            max_curvature_idx = np.argmax(curvatures)\n            knee_curvature = curvatures[max_curvature_idx]\n            # Index of knee point in pareto front is max_curvature_idx + 1\n            knee_point = pareto_front_points[max_curvature_idx + 1]\n\n        # Task 5: Report the results for the knee design\n        final_results.append([\n            int(knee_point['Lp']),\n            round(knee_point['ep'], 2),\n            round(knee_curvature, 3),\n            round(knee_point['E_del'], 1),\n            round(knee_point['C_area'], 2)\n        ])\n\n    # Format the final output string\n    result_str = ','.join([str(res) for res in final_results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了基本的设计权衡之后，下一步是构建一个更全面的系统级模型来评估电池的经济性。本练习将指导您从头开始建立一个电芯级的平准化度电成本（Levelized Cost of Storage, LCOS）模型，该模型综合了材料、制造、良率以及全生命周期内的能量吞吐量等多种因素。通过对模型进行灵敏度分析，您将识别出对总成本影响最大的关键参数，即成本驱动因素，从而为研发和供应链管理提供决策依据。",
            "id": "3954466",
            "problem": "您的任务是构建一个完整、可运行的程序，对电芯级平准化储能成本 (LCOS, 以下表示为 $LCOS_{cell}$) 关于四个价格输入进行基于第一性原理的单次单变量局部敏感性分析：正极活性材料价格 $p_{act}$、铜集流体价格 $p_{cu}$、铝集流体价格 $p_{al}$ 和电解液溶剂价格波动率 $\\sigma$。您的程序必须从基于物理和经济原理的电芯成本和能量模型出发，从第一性原理实现敏感性分析，并为指定的测试套件生成数值弹性。\n\n请使用以下基本依据和定义，除此处列出的内容外，不假设任何快捷公式：\n\n- 平准化储能成本定义：$LCOS_{cell}$ 是生命周期电芯成本的现值与生命周期输送能量的现值之比。设每循环实际贴现率为 $r$，寿命为 $N$ 个循环，则在每个循环结束时输送一个单位的现值因子为几何级数 $\\sum_{t=1}^{N} (1+r)^{-t}$。\n\n- 每循环电芯输送能量：使用由额定电芯容量、平均电芯电压、放电深度和往返效率定义的每循环输送能量 $E_{cyc}$。\n\n- 通过几何形状计算材料质量：对于厚度为 $t$、面积为 $A$、密度为 $\\rho$ 的薄片，其质量为 $\\rho \\, t \\, A$。\n\n- 正极活性材料的容量-质量关系：如果正极活性材料的理论比容量为 $c_{cath}$，利用率为 $u_{cath}$，则为提供所需容量，所需的正极活性材料质量可直接从比容量的定义中得出。\n\n- 电解液溶剂价格波动率：假设电解液溶剂的采购价格遵循对数正态模型，基线几何平均价格为 $p_{solv}$，波动率参数为 $\\sigma$，从而得出期望有效价格为 $p_{solv} \\exp\\left(\\frac{1}{2}\\sigma^{2}\\right)$。\n\n使用以下建模假设和参数，以美元每千瓦时为单位构建 $LCOS_{cell}$：\n\n- 以毫安时为单位的额定电芯容量为 $Q_{cell,mAh} = q_{areal} \\, A_{coated}$，其中 $q_{areal}$ 是以毫安时每平方厘米为单位的正极面容量，$A_{coated}$ 是以平方厘米为单位的总涂覆面积。相应的安时容量为 $Q_{cell,Ah} = Q_{cell,mAh}/1000$。\n\n- 每循环输送能量为 $E_{cyc} = Q_{cell,Ah} \\, V_{avg} \\, D \\, \\eta$，其中 $V_{avg}$ 是以伏特为单位的平均放电电压，$D$ 是以小数表示的放电深度，$\\eta$ 是以小数表示的往返效率。以瓦时为单位表示 $E_{cyc}$。\n\n- 以 $r$ 贴现的 $N$ 次单位交付的现值为 $\\sum_{t=1}^{N} (1+r)^{-t}$（每次交付在循环结束时）。使用此级数计算贴现后的生命周期输送能量，$E_{life} = E_{cyc} \\sum_{t=1}^{N} (1+r)^{-t}$。\n\n- 每个电芯的零时刻总成本 $C_{0}$ 是材料成本和加工成本的总和。包括以下材料组件及其成本：\n  1. 正极活性材料质量 $m_{act}$（千克），根据比容量关系，使用以毫安时每克为单位的 $c_{cath}$ 和以小数表示的利用率 $u_{cath}$ 计算得出。成本为 $(m_{act}/y) \\, p_{act}$，其中 $y$ 是以小数表示的制造良率。\n  2. 铜集流体质量 $m_{cu}$（千克），根据几何形状，使用以微米为单位的铜厚度 $t_{cu}$、以平方厘米为单位的箔片面积 $A_{foil}$ 和以克每立方厘米为单位的密度 $\\rho_{cu}$ 计算得出。成本为 $(m_{cu}/y) \\, p_{cu}$。\n  3. 铝集流体质量 $m_{al}$（千克），类似地使用以微米为单位的铝厚度 $t_{al}$、相同的 $A_{foil}$ 和以克每立方厘米为单位的密度 $\\rho_{al}$ 计算得出。成本为 $(m_{al}/y) \\, p_{al}$。\n  4. 电解液溶剂体积 $V_{ele}$（升），通过与容量成比例的参数 $v_{perAh}$（毫升每安时）计算，即 $V_{ele} = v_{perAh} \\, Q_{cell,Ah} / 1000$。波动下的期望每升价格为 $p_{solv} \\exp\\left(\\frac{1}{2}\\sigma^{2}\\right)$。成本为 $(V_{ele}/y) \\, p_{solv} \\exp\\left(\\frac{1}{2}\\sigma^{2}\\right)$。\n  5. 加工成本是与涂覆面积成比例的涂覆/化成成本和固定组装成本之和：$C_{proc} = c_{area} \\, (A_{coated}/10^{4}) + c_{assy}$，其中 $(A_{coated}/10^{4})$ 将平方厘米转换为平方米。\n\n- 箔片面积通过悬垂因子 $k_{oh}1$ 与涂覆面积相关联，以考虑极耳和未涂覆的边缘：$A_{foil} = k_{oh} \\, A_{coated}$。\n\n- 成本合并：$C_{0} = (m_{act}/y) \\, p_{act} + (m_{cu}/y) \\, p_{cu} + (m_{al}/y) \\, p_{al} + (V_{ele}/y) \\, p_{solv} \\exp\\left(\\frac{1}{2}\\sigma^{2}\\right) + C_{proc}$。\n\n- 最后，将 $C_{0}$ 除以 $E_{life}$ 计算 $LCOS_{cell}$，如果 $E_{life}$ 的单位是瓦时，则乘以 $1000$ 转换为美元每千瓦时。\n\n在每个测试案例的基线参数矢量处进行局部单次单变量敏感性分析。对于每个输入 $x \\in \\{p_{act}, p_{cu}, p_{al}, \\sigma\\}$，通过有限差分进行数值计算局部弹性\n$$\nS_{x} \\equiv \\frac{x}{LCOS_{cell}(x)} \\, \\frac{\\partial \\, LCOS_{cell}}{\\partial x}\n$$\n使用相对步长 $\\epsilon = 10^{-5}$ 的对称双边差分，即，将 $x$ 扰动到 $x \\pm \\delta$，其中 $\\delta = \\max(\\epsilon |x|, \\delta_{min})$，$\\delta_{min}$ 是一个小的绝对下限值。如果向下的扰动会使任何正约束输入变为负值（例如，$\\sigma$ 必须为非负），则在相同步长下切换为单边前向差分。如果 $\\sigma$ 的 $x=0$，弹性 $S_{\\sigma}$ 由此公式定义，并根据其结构计算得出为 $0$。\n\n常量和单位：\n- 使用 $\\rho_{cu} = 8.96$ 克每立方厘米和 $\\rho_{al} = 2.70$ 克每立方厘米。\n- 使用 $k_{oh} = 1.05$。\n- 所有材料价格 $p_{act}$、$p_{cu}$、$p_{al}$ 和 $p_{solv}$ 如指定，固体的单位为美元每千克，溶剂的单位为美元每升。\n- 内部以美元每千瓦时表示 $LCOS_{cell}$，但要求的输出是无量纲的弹性。\n- 不涉及角度；无需角度单位。\n\n测试套件：\n提供三个测试案例。对于每个案例，输入以元组形式给出，参数顺序为 $(q_{areal}, A_{coated}, V_{avg}, D, \\eta, N, r, t_{cu}, t_{al}, p_{act}, p_{cu}, p_{al}, c_{cath}, u_{cath}, y, c_{area}, c_{assy}, v_{perAh}, p_{solv}, \\sigma)$，其值如下：\n\n- 案例 A (理想情况):\n  - $q_{areal} = 4.0$ 毫安时每平方厘米\n  - $A_{coated} = 18000.0$ 平方厘米\n  - $V_{avg} = 3.7$ 伏特\n  - $D = 0.9$\n  - $\\eta = 0.95$\n  - $N = 3000$\n  - $r = 0.08$\n  - $t_{cu} = 8.0$ 微米\n  - $t_{al} = 15.0$ 微米\n  - $p_{act} = 25.0$ 美元每千克\n  - $p_{cu} = 9.0$ 美元每千克\n  - $p_{al} = 3.0$ 美元每千克\n  - $c_{cath} = 180.0$ 毫安时每克\n  - $u_{cath} = 0.95$\n  - $y = 0.95$\n  - $c_{area} = 12.0$ 美元每平方米\n  - $c_{assy} = 0.5$ 美元\n  - $v_{perAh} = 2.5$ 毫升每安时\n  - $p_{solv} = 12.0$ 美元每升\n  - $\\sigma = 0.2$\n\n- 案例 B (零波动率边界，更薄的箔片):\n  - $q_{areal} = 4.0$\n  - $A_{coated} = 18000.0$\n  - $V_{avg} = 3.7$\n  - $D = 0.9$\n  - $\\eta = 0.95$\n  - $N = 3000$\n  - $r = 0.08$\n  - $t_{cu} = 6.0$\n  - $t_{al} = 12.0$\n  - $p_{act} = 25.0$\n  - $p_{cu} = 9.0$\n  - $p_{al} = 3.0$\n  - $c_{cath} = 180.0$\n  - $u_{cath} = 0.95$\n  - $y = 0.95$\n  - $c_{area} = 12.0$\n  - $c_{assy} = 0.5$\n  - $v_{perAh} = 2.5$\n  - $p_{solv} = 12.0$\n  - $\\sigma = 0.0$\n\n- 案例 C (压力测试：更厚的箔片、更低的面容量、更高的价格和贴现率、更短的寿命):\n  - $q_{areal} = 3.0$\n  - $A_{coated} = 18000.0$\n  - $V_{avg} = 3.7$\n  - $D = 0.9$\n  - $\\eta = 0.95$\n  - $N = 1500$\n  - $r = 0.12$\n  - $t_{cu} = 12.0$\n  - $t_{al} = 20.0$\n  - $p_{act} = 40.0$\n  - $p_{cu} = 10.0$\n  - $p_{al} = 4.0$\n  - $c_{cath} = 180.0$\n  - $u_{cath} = 0.93$\n  - $y = 0.93$\n  - $c_{area} = 14.0$\n  - $c_{assy} = 0.6$\n  - $v_{perAh} = 2.8$\n  - $p_{solv} = 14.0$\n  - $\\sigma = 0.4$\n\n程序要求：\n- 完全按照上述描述实现 $LCOS_{cell}$ 的构建，在每个测试案例基线下使用有限差分程序计算局部弹性 $S_{p_{act}}$、$S_{p_{cu}}$、$S_{p_{al}}$ 和 $S_{\\sigma}$，并将结果汇总到最终输出中。\n- 对价格变量使用相对步长 $\\epsilon = 10^{-5}$ 和绝对下限 $\\delta_{min} = 10^{-8}$ 的对称双边差分。对于 $\\sigma$，如果向下的扰动会变为负值，则通过切换到单边前向差分来强制非负性；使用相同的步长选择规则。根据弹性定义处理任何 $x=0$ 的情况，由于乘法因子 $x$ 的存在，其结果为 $0$。\n- 结果表示为四舍五入到 $6$ 位小数的浮点数。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个列表的列表，分别包含案例 A、案例 B 和案例 C 的弹性，顺序为 $[S_{p_{act}}, S_{p_{cu}}, S_{p_{al}}, S_{\\sigma}]$。例如，打印的输出必须具有确切的格式\n\"[ [S_A1,S_A2,S_A3,S_A4], [S_B1,S_B2,S_B3,S_B4], [S_C1,S_C2,S_C3,S_C4] ]\"\n除了分隔列表元素所需的空格外，不含其他空格，并四舍五入到六位小数，例如，\"[[0.123456,0.234567,0.345678,0.456789],[...],[...]]\"。",
            "solution": "该问题要求开发一个程序，对电芯级平准化储能成本（表示为 $LCOS_{cell}$）进行局部敏感性分析。该敏感性通过 $LCOS_{cell}$ 相对于四个输入参数的弹性来量化：正极活性材料价格 $p_{act}$、铜集流体价格 $p_{cu}$、铝集流体价格 $p_{al}$ 和电解液溶剂价格波动率 $\\sigma$。\n\n解决方案主要分两个阶段进行：首先，根据指定的第一性原理构建 $LCOS_{cell}$ 的数学模型；其次，使用有限差分法实现数值敏感性分析。\n\n### I. 建模平准化储能成本 ($LCOS_{cell}$)\n\n$LCOS_{cell}$ 定义为电芯的零时刻总成本与在其生命周期内贴现后的总输送能量之比。\n$$\nLCOS_{cell} = \\frac{C_0}{E_{life}}\n$$\n其中 $C_0$ 是以美元为单位的零时刻成本，$E_{life}$ 是以瓦时为单位的贴现后生命周期输送能量。为将结果表示为美元每千瓦时，应用了一个 $1000$ 的系数。\n\n#### 1. 贴现后生命周期输送能量 ($E_{life}$)\n\n生命周期能量建立在单个循环中输送的能量 $E_{cyc}$ 的基础上。\n首先，根据正极面容量 $q_{areal}$（单位为 $\\text{mAh}/\\text{cm}^2$）和总涂覆面积 $A_{coated}$（单位为 $\\text{cm}^2$），确定额定电芯容量（安时），$Q_{cell,Ah}$：\n$$\nQ_{cell,mAh} = q_{areal} \\, A_{coated}\n$$\n$$\nQ_{cell,Ah} = \\frac{Q_{cell,mAh}}{1000}\n$$\n然后，使用平均放电电压 $V_{avg}$（单位为 V）、放电深度 $D$（无量纲）和往返效率 $\\eta$（无量纲）计算每循环输送能量 $E_{cyc}$（单位为 Wh）：\n$$\nE_{cyc} = Q_{cell,Ah} \\, V_{avg} \\, D \\, \\eta\n$$\n在 $N$ 个循环中输送的能量流的现值，设每循环贴现率为 $r$，由 $E_{life}$ 给出：\n$$\nE_{life} = E_{cyc} \\sum_{t=1}^{N} (1+r)^{-t} = E_{cyc} \\left( \\frac{1 - (1+r)^{-N}}{r} \\right)\n$$\n此几何级数求和公式用于计算。\n\n#### 2. 零时刻电芯成本 ($C_0$)\n\n总成本 $C_0$ 是考虑了良率调整的材料成本和加工成本的总和。制造良率表示为 $y$。\n\n1.  **正极活性材料成本 ($C_{act}$)**：活性材料的质量 $m_{act}$（单位为 kg）由总电芯容量 $Q_{cell,mAh}$、材料的理论比容量 $c_{cath}$（单位为 mAh/g）及其利用率 $u_{cath}$ 决定：\n    $$\n    m_{act,g} = \\frac{Q_{cell,mAh}}{c_{cath} \\, u_{cath}} \\quad \\implies \\quad m_{act} = \\frac{m_{act,g}}{1000}\n    $$\n    使用价格 $p_{act}$（单位为 \\$/kg）计算成本：\n    $$\n    C_{act} = \\frac{m_{act}}{y} \\, p_{act}\n    $$\n\n2.  **集流体成本 ($C_{cu}, C_{al}$)**：铜箔和铝箔的质量 $m_{cu}$ 和 $m_{al}$（单位为 kg）由它们各自的几何形状和密度决定。箔片面积 $A_{foil}$ 通过悬垂因子 $k_{oh}$ 比涂覆面积 $A_{coated}$ 大：$A_{foil} = k_{oh} \\, A_{coated}$。\n    - 对于铜，厚度为 $t_{cu}$（单位为 µm），密度为 $\\rho_{cu}$（单位为 g/cm³）：\n      $$\n      m_{cu} = \\frac{(A_{foil, cm^2}) \\cdot (t_{cu, \\mu m} \\cdot 10^{-4} \\frac{cm}{\\mu m}) \\cdot (\\rho_{cu, g/cm^3})}{1000 \\frac{g}{kg}}\n      $$\n      使用价格 $p_{cu}$（单位为 \\$/kg）计算成本：\n      $$\n      C_{cu} = \\frac{m_{cu}}{y} \\, p_{cu}\n      $$\n    - 对于铝，厚度为 $t_{al}$（单位为 µm），密度为 $\\rho_{al}$（单位为 g/cm³），计算方法类似：\n      $$\n      m_{al} = \\frac{(A_{foil, cm^2}) \\cdot (t_{al, \\mu m} \\cdot 10^{-4} \\frac{cm}{\\mu m}) \\cdot (\\rho_{al, g/cm^3})}{1000 \\frac{g}{kg}}\n      $$\n      使用价格 $p_{al}$（单位为 \\$/kg）计算成本：\n      $$\n      C_{al} = \\frac{m_{al}}{y} \\, p_{al}\n      $$\n\n3.  **电解液溶剂成本 ($C_{ele}$)**：电解液溶剂的体积 $V_{ele}$（单位为 L）通过参数 $v_{perAh}$（单位为 mL/Ah）与电芯容量 $Q_{cell,Ah}$ 成正比：\n    $$\n    V_{ele} = \\frac{v_{perAh} \\cdot Q_{cell,Ah}}{1000}\n    $$\n    期望每升价格通过对数正态价格模型包含了基线价格 $p_{solv}$ 和波动率 $\\sigma$：\n    $$\n    p_{ele,exp} = p_{solv} \\exp\\left(\\frac{1}{2}\\sigma^{2}\\right)\n    $$\n    成本为：\n    $$\n    C_{ele} = \\frac{V_{ele}}{y} \\, p_{ele,exp}\n    $$\n\n4.  **加工成本 ($C_{proc}$)**：这包括与涂覆面积成比例的成本 $c_{area}$（单位为 \\$/m²）和固定的组装成本 $c_{assy}$（单位为 \\$）：\n    $$\n    C_{proc} = c_{area} \\, \\frac{A_{coated, cm^2}}{10^4 \\frac{cm^2}{m^2}} + c_{assy}\n    $$\n\n最后，总成本 $C_0$ 是这些组成部分的总和：\n$$\nC_0 = C_{act} + C_{cu} + C_{al} + C_{ele} + C_{proc}\n$$\n\n$LCOS_{cell}$ 的最终表达式（单位为 \\$/kWh）是：\n$$\nLCOS_{cell} = 1000 \\cdot \\frac{C_0}{E_{life}}\n$$\n\n### II. 通过数值弹性进行敏感性分析\n\n$LCOS_{cell}$ 对输入参数 $x$ 的敏感性通过局部弹性 $S_x$ 来衡量：\n$$\nS_{x} = \\frac{x}{LCOS_{cell}(x)} \\, \\frac{\\partial \\, LCOS_{cell}}{\\partial x}\n$$\n问题要求对 $x \\in \\{p_{act}, p_{cu}, p_{al}, \\sigma\\}$ 进行数值计算。偏导数 $\\frac{\\partial \\, LCOS_{cell}}{\\partial x}$ 使用有限差分格式来近似。\n\n- **步长 ($\\delta$)**: 使用相对步长 $\\epsilon = 10^{-5}$ 和绝对下限 $\\delta_{min} = 10^{-8}$。扰动 $\\delta$ 为：\n  $$\n  \\delta = \\max(\\epsilon |x|, \\delta_{min})\n  $$\n\n- **对称（中心）差分**: 对于函数 $f(x)$，这是默认方法：\n  $$\n  \\frac{\\partial f}{\\partial x} \\approx \\frac{f(x+\\delta) - f(x-\\delta)}{2\\delta}\n  $$\n\n- **前向差分**: 此方法用作非负参数（如 $\\sigma$）的备用方法，在这些参数下，后向步长 $x-\\delta$ 会是负值：\n  $$\n  \\frac{\\partial f}{\\partial x} \\approx \\frac{f(x+\\delta) - f(x)}{\\delta}\n  $$\n\n- **边界条件 ($x=0$)**: 对于 $\\sigma=0$，弹性公式 $S_{\\sigma} = \\frac{\\sigma}{LCOS_{cell}} \\frac{\\partial LCOS_{cell}}{\\partial \\sigma}$ 直接得出 $S_{\\sigma}=0$。\n\n程序将实现一个用于计算 $LCOS_{cell}$ 的函数，该函数接受完整的参数集。然后用扰动后的参数值调用此函数，以计算每个测试案例中每个相关变量的导数和弹性。",
            "answer": "```python\nimport numpy as np\n\ndef lcos_model(params: tuple) - float:\n    \"\"\"\n    Calculates the Levelized Cost of Storage (LCOS) for a battery cell.\n\n    Args:\n        params: A tuple containing the 20 model parameters in the specified order.\n\n    Returns:\n        The calculated LCOS in USD/kWh.\n    \"\"\"\n    # Unpack parameters for clarity\n    (q_areal, A_coated, V_avg, D, eta, N, r, t_cu, t_al,\n     p_act, p_cu, p_al, c_cath, u_cath, y, c_area, c_assy,\n     v_perAh, p_solv, sigma) = params\n\n    # Physical and geometric constants\n    rho_cu = 8.96  # g/cm^3\n    rho_al = 2.70  # g/cm^3\n    k_oh = 1.05\n\n    # 1. Cell Energy Calculation\n    # Q_cell in Ah\n    Q_cell_mAh = q_areal * A_coated\n    Q_cell_Ah = Q_cell_mAh / 1000.0\n\n    # Energy per cycle in Wh\n    E_cyc = Q_cell_Ah * V_avg * D * eta\n\n    # Discount factor for the energy stream over N cycles\n    # Use if r  0 to avoid division by zero. If r=0, sum is N.\n    if r  0:\n      pvf_energy = (1.0 - (1.0 + r)**(-N)) / r\n    else:\n      pvf_energy = float(N)\n      \n    # Lifetime energy delivered in Wh\n    E_life = E_cyc * pvf_energy\n\n    # 2. Cell Cost Calculation (C_0)\n    \n    # Cathode active material cost\n    # m_act in kg ahem\n    m_act_g = Q_cell_mAh / (c_cath * u_cath)\n    m_act_kg = m_act_g / 1000.0\n    cost_act = (m_act_kg / y) * p_act\n\n    # Foil area in cm^2\n    A_foil = k_oh * A_coated\n\n    # Copper current collector cost\n    # Convert thickness t_cu from um to cm (1e-4) and mass from g to kg (1e-3)\n    m_cu_kg = (A_foil * (t_cu * 1e-4) * rho_cu) / 1000.0\n    cost_cu = (m_cu_kg / y) * p_cu\n\n    # Aluminum current collector cost\n    # Convert thickness t_al from um to cm (1e-4) and mass from g to kg (1e-3)\n    m_al_kg = (A_foil * (t_al * 1e-4) * rho_al) / 1000.0\n    cost_al = (m_al_kg / y) * p_al\n\n    # Electrolyte cost\n    # Convert volume from mL to L (1e-3)\n    V_ele_L = (v_perAh * Q_cell_Ah) / 1000.0\n    # Expected price under lognormal model\n    eff_p_solv = p_solv * np.exp(0.5 * sigma**2)\n    cost_ele = (V_ele_L / y) * eff_p_solv\n\n    # Processing costs\n    # Convert area from cm^2 to m^2 (1e-4)\n    cost_proc = c_area * (A_coated * 1e-4) + c_assy\n\n    # Total time-zero cost C_0 in USD\n    C_0 = cost_act + cost_cu + cost_al + cost_ele + cost_proc\n\n    # 3. LCOS Calculation (USD/kWh)\n    if E_life == 0:\n        return float('inf')\n    lcos = 1000.0 * C_0 / E_life\n\n    return lcos\n\n\ndef calculate_elasticities(params: tuple):\n    \"\"\"\n    Computes the local elasticities of LCOS with respect to four input prices.\n\n    Args:\n        params: A tuple containing the baseline parameters for a test case.\n\n    Returns:\n        A list of four elasticities [S_p_act, S_p_cu, S_p_al, S_sigma].\n    \"\"\"\n    vars_to_test = [\n        ('p_act', 9),\n        ('p_cu', 10),\n        ('p_al', 11),\n        ('sigma', 19)\n    ]\n    \n    elasticities = []\n    \n    epsilon = 1e-5\n    delta_min = 1e-8\n    \n    param_list = list(params)\n    \n    for name, index in vars_to_test:\n        x = param_list[index]\n        \n        # Per problem definition, elasticity is 0 if the parameter is 0.\n        if x == 0:\n            elasticities.append(0.0)\n            continue\n            \n        # Calculate step size delta\n        delta = max(epsilon * abs(x), delta_min)\n        \n        # Calculate baseline LCOS\n        lcos_base = lcos_model(tuple(param_list))\n        \n        # Determine finite difference method (forward for sigma if step is too large)\n        use_forward_diff = (name == 'sigma' and (x - delta  0))\n\n        if use_forward_diff:\n            # One-sided forward difference\n            param_list_plus = param_list[:]\n            param_list_plus[index] = x + delta\n            lcos_plus = lcos_model(tuple(param_list_plus))\n            \n            derivative = (lcos_plus - lcos_base) / delta\n        else:\n            # Two-sided symmetric difference\n            param_list_plus = param_list[:]\n            param_list_plus[index] = x + delta\n            lcos_plus = lcos_model(tuple(param_list_plus))\n            \n            param_list_minus = param_list[:]\n            param_list_minus[index] = x - delta\n            lcos_minus = lcos_model(tuple(param_list_minus))\n            \n            derivative = (lcos_plus - lcos_minus) / (2 * delta)\n\n        # Calculate elasticity\n        if lcos_base == 0:\n            elasticity = float('inf') if derivative != 0 else 0.0\n        else:\n            elasticity = (x / lcos_base) * derivative\n        elasticities.append(elasticity)\n        \n    return elasticities\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: Happy path\n        (4.0, 18000.0, 3.7, 0.9, 0.95, 3000, 0.08, 8.0, 15.0, 25.0, 9.0, 3.0, \n         180.0, 0.95, 0.95, 12.0, 0.5, 2.5, 12.0, 0.2),\n        # Case B: Boundary at zero volatility, thinner foils\n        (4.0, 18000.0, 3.7, 0.9, 0.95, 3000, 0.08, 6.0, 12.0, 25.0, 9.0, 3.0, \n         180.0, 0.95, 0.95, 12.0, 0.5, 2.5, 12.0, 0.0),\n        # Case C: Stress case\n        (3.0, 18000.0, 3.7, 0.9, 0.95, 1500, 0.12, 12.0, 20.0, 40.0, 10.0, 4.0,\n         180.0, 0.93, 0.93, 14.0, 0.6, 2.8, 14.0, 0.4)\n    ]\n\n    all_results = []\n    for case_params in test_cases:\n        case_elasticities = calculate_elasticities(case_params)\n        all_results.append(case_elasticities)\n\n    # Format the output string exactly as required\n    case_strings = []\n    for res_list in all_results:\n        num_strings = [f\"{val:.6f}\" for val in res_list]\n        case_strings.append(f\"[{','.join(num_strings)}]\")\n    \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "真实世界的工程设计总是在一系列约束条件下寻求最优解。这项实践将带您深入学习约束优化的核心理论，并将其应用于解决一个实际的生产问题。您将运用Karush-Kuhn-Tucker (KKT) 条件来求解一个关于电极孔隙率 $\\varepsilon$ 和生产良率 $y$ 的成本最小化问题。更重要的是，您将学习如何解读拉格朗日乘子，将其视为“影子价格”（shadow prices），从而量化每个生产约束（如最大孔隙率或最低良率要求）所带来的边际成本。",
            "id": "3954480",
            "problem": "一条用于锂离子电池电芯制造的阴极涂布线正在进行优化，以最小化单位能量的代理平准化制造成本，该成本记为 $J(\\varepsilon,y)$，单位为美元/千瓦时。决策变量是电极孔隙率 $\\varepsilon$（无量纲）和制造良率 $y$（通过产线末端测试的电芯比例，无量纲）。代理成本函数定义为\n$$\nJ(\\varepsilon,y) \\;=\\; \\frac{A}{1-\\varepsilon} \\;-\\; B\\,\\varepsilon \\;+\\; C\\,(y - y_{0})^{2},\n$$\n其中 $A0$、 $B0$、 $C0$ 和 $y_{0}\\in(0,1)$ 是为捕捉一阶技术经济权衡而选择的参数：项 $\\frac{A}{1-\\varepsilon}$ 惩罚因孔隙率增加而导致的能量密度损失，线性项 $-B\\,\\varepsilon$ 反映了在一定限度内增加孔隙率所带来的工艺和传输增益，而二次项 $C\\,(y-y_{0})^{2}$ 则捕捉了通过额外检查、返工或加大工艺强度而偏离标称自然良率 $y_{0}$ 所产生的成本。\n\n设计必须满足最大孔隙率约束和最小良率约束：\n$$\n\\varepsilon \\;\\le\\; \\varepsilon_{\\max}, \\qquad y \\;\\ge\\; y_{\\min},\n$$\n同时满足可行性要求 $0\\varepsilon1$ 和 $0y \\le 1$。\n\n任务：\n为以下参数集构建并求解此约束优化问题：$A = 0.09$, $B = 0.36$, $C = 100$, $y_{0} = 0.80$, $\\varepsilon_{\\max} = 0.40$, $y_{\\min} = 0.90$。\n使用卡罗需-库恩-塔克（KKT）条件计算最优解处的拉格朗日乘子 $(\\lambda_{\\varepsilon}, \\mu_{y})$，其中 $\\lambda_{\\varepsilon}$ 是与孔隙率约束 $\\varepsilon \\le \\varepsilon_{\\max}$ 相关的乘子，$\\mu_{y}$ 是与良率约束 $y \\ge y_{\\min}$ 相关的乘子。将这些乘子解释为影子价格，它们量化了因收紧约束而导致的最优成本的边际增加。\n\n最终输出格式：您的最终答案应为有序对 $(\\lambda_{\\varepsilon}, \\mu_{y})$，四舍五入到两位小数，并以 $1 \\times 2$ 矩阵的形式呈现。",
            "solution": "本题要求解一个约束优化问题并找出拉格朗日乘子。\n\n### 第一步：提取已知条件\n\n题目陈述提供了以下信息：\n-   **目标函数**：单位能量的代理平准化制造成本 $J(\\varepsilon,y)$，单位为美元/千瓦时。\n    $$\n    J(\\varepsilon,y) \\;=\\; \\frac{A}{1-\\varepsilon} \\;-\\; B\\,\\varepsilon \\;+\\; C\\,(y - y_{0})^{2}\n    $$\n-   **决策变量**：\n    -   $\\varepsilon$：电极孔隙率（无量纲）\n    -   $y$：制造良率（无量纲）\n-   **参数**：\n    -   $A = 0.09$\n    -   $B = 0.36$\n    -   $C = 100$\n    -   $y_{0} = 0.80$\n-   **约束条件**：\n    -   孔隙率约束：$\\varepsilon \\le \\varepsilon_{\\max}$，其中 $\\varepsilon_{\\max} = 0.40$。\n    -   良率约束：$y \\ge y_{\\min}$，其中 $y_{\\min} = 0.90$。\n    -   可行性约束：$0  \\varepsilon  1$ 和 $0  y \\le 1$。\n-   **任务**：建立约束优化问题模型，使用卡罗需-库恩-塔克（KKT）条件计算最优解处的拉格朗日乘子 $\\lambda_{\\varepsilon}$（对应孔隙率约束）和 $\\mu_{y}$（对应良率约束）。\n\n### 第二步：使用提取的已知条件进行验证\n\n该问题是工程优化中的一个标准非线性规划问题。\n-   **科学依据**：目标函数是一个代理模型，这是技术经济分析和系统设计中常用且有效的一种技术。各项的设置基于电池制造中的物理和经济权衡，是合理的。没有违反基本的科学或数学原理。\n-   **适定性**：该问题是在一个紧凑的非空可行集上最小化一个函数。目标函数在其可行域上是连续的，并且如下文将要证明的，是凸的。约束条件是线性的。这种结构保证了唯一最优解的存在。\n-   **目标明确**：问题使用精确的数学语言和客观、可量化的参数进行陈述。\n-   **完整性**：所有必要的数据（$A, B, C, y_0, \\varepsilon_{\\max}, y_{\\min}$）都已提供。\n-   **一致性**：约束和参数是自洽的。$\\varepsilon$ 的可行域是 $(0, 0.40]$，$y$ 的可行域是 $[0.90, 1]$，它们都是其自然定义域内的有效子集。\n\n问题是有效的。\n\n### 第三步：求解过程\n\n我们首先正式陈述优化问题。我们要最小化目标函数 $J(\\varepsilon, y)$，并满足不等式约束。标准做法是将所有不等式约束写成 $g_i(\\mathbf{x}) \\le 0$ 的形式。\n\n优化问题为：\n$$\n\\text{minimize} \\quad J(\\varepsilon, y) = \\frac{A}{1-\\varepsilon} - B\\varepsilon + C(y - y_0)^2\n$$\n约束条件为：\n$$\ng_1(\\varepsilon, y) = \\varepsilon - \\varepsilon_{\\max} \\le 0 \\\\\ng_2(\\varepsilon, y) = y_{\\min} - y \\le 0\n$$\n以及隐式约束 $0  \\varepsilon  1$ 和 $0  y \\le 1$。\n\n此问题的拉格朗日函数 $\\mathcal{L}$ 由目标函数加上各约束乘以其对应的非负拉格朗日乘子 $\\lambda_{\\varepsilon}$ 和 $\\mu_y$ 构成。\n$$\n\\mathcal{L}(\\varepsilon, y, \\lambda_{\\varepsilon}, \\mu_y) = J(\\varepsilon, y) + \\lambda_{\\varepsilon}g_1(\\varepsilon, y) + \\mu_y g_2(\\varepsilon, y)\n$$\n$$\n\\mathcal{L}(\\varepsilon, y, \\lambda_{\\varepsilon}, \\mu_y) = \\frac{A}{1-\\varepsilon} - B\\varepsilon + C(y - y_0)^2 + \\lambda_{\\varepsilon}(\\varepsilon - \\varepsilon_{\\max}) + \\mu_y(y_{\\min} - y)\n$$\n卡罗需-库恩-塔克（KKT）条件为最优解 $(\\varepsilon^*, y^*)$ 提供了必要条件。这些条件是：\n\n1.  **平稳性**：拉格朗日函数相对于决策变量的梯度必须为零。\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial \\varepsilon} = \\frac{A}{(1-\\varepsilon)^2} - B + \\lambda_{\\varepsilon} = 0\n    $$\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial y} = 2C(y - y_0) - \\mu_y = 0\n    $$\n\n2.  **原始可行性**：解必须满足所有约束条件。\n    $$\n    \\varepsilon^* - \\varepsilon_{\\max} \\le 0\n    $$\n    $$\n    y_{\\min} - y^* \\le 0 \\quad (\\text{即 } y^* \\ge y_{\\min})\n    $$\n\n3.  **对偶可行性**：拉格朗日乘子必须为非负。\n    $$\n    \\lambda_{\\varepsilon} \\ge 0\n    $$\n    $$\n    \\mu_y \\ge 0\n    $$\n\n4.  **互补松弛性**：每个乘子与其对应约束的乘积必须为零。\n    $$\n    \\lambda_{\\varepsilon}(\\varepsilon^* - \\varepsilon_{\\max}) = 0\n    $$\n    $$\n    \\mu_y(y_{\\min} - y^*) = 0\n    $$\n\n我们可以通过考虑目标函数的可分离性来求解这个系统。函数 $J(\\varepsilon, y)$ 可以写成 $J_{\\varepsilon}(\\varepsilon) + J_y(y)$，其中 $J_{\\varepsilon}(\\varepsilon) = \\frac{A}{1-\\varepsilon} - B\\varepsilon$，$J_y(y) = C(y - y_0)^2$。我们可以分别对 $\\varepsilon$ 和 $y$ 进行优化。\n\n首先，我们找出每个变量的无约束最小值。\n对于 $\\varepsilon$，我们将 $J_{\\varepsilon}$ 的导数设为零：\n$$\n\\frac{dJ_{\\varepsilon}}{d\\varepsilon} = \\frac{A}{(1-\\varepsilon)^2} - B = 0 \\implies (1-\\varepsilon)^2 = \\frac{A}{B} \\implies \\varepsilon = 1 - \\sqrt{\\frac{A}{B}}\n$$\n由于 $\\varepsilon  1$，我们为 $1-\\varepsilon$ 取正根。\n代入数值 $A=0.09$ 和 $B=0.36$：\n$$\n\\varepsilon_{\\text{unc}} = 1 - \\sqrt{\\frac{0.09}{0.36}} = 1 - \\sqrt{\\frac{1}{4}} = 1 - \\frac{1}{2} = 0.5\n$$\n二阶导数 $\\frac{d^2 J_{\\varepsilon}}{d\\varepsilon^2} = \\frac{2A}{(1-\\varepsilon)^3}$ 对于 $\\varepsilon  1$ 是正的，因此 $J_{\\varepsilon}$ 是凸函数。无约束最小值点在 $\\varepsilon = 0.5$。\n\n对于 $y$，我们将 $J_y$ 的导数设为零：\n$$\n\\frac{dJ_y}{dy} = 2C(y - y_0) = 0 \\implies y = y_0\n$$\n代入数值 $y_0=0.80$：\n$$\ny_{\\text{unc}} = 0.80\n$$\n二阶导数 $\\frac{d^2 J_y}{dy^2} = 2C$ 是正数（$200$），因此 $J_y$ 是凸函数。无约束最小值点在 $y=0.80$。\n\n无约束最优点为 $(\\varepsilon, y) = (0.5, 0.8)$。我们现在根据约束条件检查该点：\n-   $\\varepsilon \\le \\varepsilon_{\\max} \\implies 0.5 \\le 0.40$，这是**不成立的**。\n-   $y \\ge y_{\\min} \\implies 0.80 \\ge 0.90$，这是**不成立的**。\n\n由于两个无约束最优点都位于其各自可行区间之外，并且两个成本函数（$J_{\\varepsilon}$ 和 $J_y$）都是凸函数，因此可行域内的最优解必定位于离无约束最优点最近的边界点上。\n-   对于 $\\varepsilon$，可行域为 $(0, \\varepsilon_{\\max}] = (0, 0.40]$。无约束最小值为 $\\varepsilon_{\\text{unc}} = 0.5$。最近的可行点是 $\\varepsilon^* = 0.40$。\n-   对于 $y$，可行域为 $[y_{\\min}, 1] = [0.90, 1]$。无约束最小值为 $y_{\\text{unc}} = 0.80$。最近的可行点是 $y^* = 0.90$。\n\n因此，最优解为 $(\\varepsilon^*, y^*) = (0.40, 0.90)$。\n在该点，两个约束都是激活的（紧的）：\n-   $\\varepsilon^* - \\varepsilon_{\\max} = 0.40 - 0.40 = 0$\n-   $y_{\\min} - y^* = 0.90 - 0.90 = 0$\n\n由于约束是激活的，互补松弛性条件不要求乘子为零。我们现在可以在最优点 $(\\varepsilon^*, y^*) = (0.40, 0.90)$ 处使用平稳性条件来求解乘子。\n\n根据 $\\varepsilon$ 的第一个平稳性条件：\n$$\n\\lambda_{\\varepsilon} = B - \\frac{A}{(1-\\varepsilon^*)^2}\n$$\n代入数值：\n$$\n\\lambda_{\\varepsilon} = 0.36 - \\frac{0.09}{(1-0.40)^2} = 0.36 - \\frac{0.09}{(0.60)^2} = 0.36 - \\frac{0.09}{0.36} = 0.36 - 0.25 = 0.11\n$$\n由于 $\\lambda_{\\varepsilon} = 0.11  0$，此约束的对偶可行性和互补松弛性条件得到满足。\n\n根据 $y$ 的第二个平稳性条件：\n$$\n\\mu_y = 2C(y^* - y_0)\n$$\n代入数值：\n$$\n\\mu_y = 2(100)(0.90 - 0.80) = 200(0.10) = 20\n$$\n由于 $\\mu_y = 20  0$，此约束的对偶可行性和互补松弛性条件得到满足。\n\n对于解 $(\\varepsilon^*, y^*) = (0.40, 0.90)$ 和乘子 $\\lambda_{\\varepsilon} = 0.11$、$\\mu_y = 20$，所有KKT条件都得到满足。由于问题是凸的（在凸集上最小化凸函数），这个KKT点对应于唯一的全局最小值。\n\n拉格朗日乘子，被解释为影子价格，表示最优目标函数值相对于约束放宽的变化率。题目要求的是由于约束*收紧*而导致的成本边际增加，这由乘子本身的值给出。\n-   $\\lambda_{\\varepsilon} = 0.11$：$\\varepsilon_{\\max}$ 的微小减小（收紧）将导致最优成本 $J^*$ 以每单位 $\\varepsilon_{\\max}$ 减小量对应 $0.11$ 美元/千瓦时的速率增加。\n-   $\\mu_y = 20$：$y_{\\min}$ 的微小增加（收紧）将导致最优成本 $J^*$ 以每单位 $y_{\\min}$ 增加量对应 $20$ 美元/千瓦时的速率增加。\n\n所要求的最终答案是有序对 $(\\lambda_{\\varepsilon}, \\mu_y)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.11  20\n\\end{pmatrix}\n}\n$$"
        }
    ]
}