{
    "hands_on_practices": [
        {
            "introduction": "Before embarking on a complex optimization campaign, it is crucial to understand which design parameters most significantly influence performance. This practice introduces Global Sensitivity Analysis (GSA), a powerful technique for quantifying the impact of input variables on a model's output across their entire range of uncertainty. By computing first-order Sobol indices for a physics-informed battery capacity model, you will learn to identify the key design levers that dominate performance variability, a critical first step in any automated design workflow .",
            "id": "3894860",
            "problem": "Construct a complete program that computes first-order Sobol sensitivity indices for the $3\\mathrm{C}$ discharge capacity of a single-layer Lithium-ion cell with respect to four design variables: negative electrode thickness $L_n$ in $\\mathrm{m}$, positive electrode thickness $L_p$ in $\\mathrm{m}$, negative electrode porosity $\\epsilon_n$ (dimensionless), and negative electrode particle radius $R_{p,n}$ in $\\mathrm{m}$. The program must implement a physics-informed surrogate model grounded in fundamental transport and storage considerations and must use a Saltelli-type sampling plan built from scrambled Sobol low-discrepancy sequences to estimate the indices. The final output must report, for each test case, the four first-order Sobol indices and the index of the dominant variable. The dominant variable index must be the integer corresponding to the largest first-order index using the mapping $0 \\rightarrow L_n$, $1 \\rightarrow L_p$, $2 \\rightarrow \\epsilon_n$, $3 \\rightarrow R_{p,n}$.\n\nModel specification grounded in first principles: Let the theoretical areal capacity be limited by the minimum of the two electrodes’ theoretical loadings, consistent with charge balance. Define the theoretical areal capacity $Q_{\\mathrm{theor}}$ in $\\mathrm{arbitrary\\ units}$ as\n$$\nQ_{\\mathrm{theor}}(L_n,L_p,\\epsilon_n) = \\min\\left(\\rho_n (1-\\epsilon_n) L_n,\\ \\rho_p (1-\\epsilon_p) L_p\\right),\n$$\nwhere $\\rho_n$ and $\\rho_p$ are effective volumetric storage coefficients in $\\mathrm{arbitrary\\ units\\ per\\ m^3}$, and $\\epsilon_p$ is the positive electrode porosity (dimensionless). Let the utilization factor under $3\\mathrm{C}$ discharge be represented by a transport-loss factor that penalizes ionic and solid-state diffusion resistances:\n$$\nU(L_n,L_p,\\epsilon_n,R_{p,n}) = \\frac{1}{1 + \\phi_{\\mathrm{ion}}(L_n,L_p,\\epsilon_n) + \\phi_{\\mathrm{solid}}(R_{p,n})},\n$$\nwith\n$$\n\\phi_{\\mathrm{ion}}(L_n,L_p,\\epsilon_n) = c_i\\left(\\frac{L_n}{\\epsilon_n^{b}} + \\frac{L_p}{\\epsilon_p^{b}}\\right), \\quad \\phi_{\\mathrm{solid}}(R_{p,n}) = c_s R_{p,n}^2,\n$$\nwhere $b$ is the Bruggeman exponent (dimensionless), $c_i$ is an ionic-loss coefficient in $\\mathrm{m^{-1}}$, and $c_s$ is a solid diffusion-loss coefficient in $\\mathrm{m^{-2}}$. The $3\\mathrm{C}$ areal capacity in $\\mathrm{arbitrary\\ units}$ is then\n$$\nQ_{3\\mathrm{C}}(L_n,L_p,\\epsilon_n,R_{p,n}) = Q_{\\mathrm{theor}}(L_n,L_p,\\epsilon_n)\\cdot U(L_n,L_p,\\epsilon_n,R_{p,n}).\n$$\nAll variables and parameters must take scientifically plausible values, and the above functional form must be used without alteration.\n\nSampling plan and Sobol index estimator: Use two independent scrambled Sobol sequences to construct matrices $A \\in [0,1]^{{N}\\times 4}$ and $B \\in [0,1]^{{N}\\times 4}$, where $N = 2^m$ for a specified integer $m \\ge 1$. Map each column of $A$ and $B$ to the corresponding physical input ranges using affine transforms. For each input $i \\in \\{1,2,3,4\\}$, construct $A_{B}^{(i)}$ by replacing the $i$-th column of $A$ with the $i$-th column of $B$. Let $f(\\cdot)$ denote $Q_{3\\mathrm{C}}(\\cdot)$. Estimate the variance using the unbiased sample variance of $f(A)$ and compute first-order Sobol indices using the Saltelli estimator:\n$$\nS_i \\approx \\frac{\\frac{1}{N}\\sum_{j=1}^{N} f(B_j)\\left[f\\!\\left((A_{B}^{(i)})_j\\right)-f(A_j)\\right]}{\\operatorname{Var}[f(A)]}.\n$$\n\nInput domain and constants: For all test cases, enforce the following input bounds for the four design variables:\n- $L_n \\in [4.0\\times 10^{-5}\\ \\mathrm{m},\\ 1.2\\times 10^{-4}\\ \\mathrm{m}]$,\n- $L_p \\in [5.0\\times 10^{-5}\\ \\mathrm{m},\\ 1.0\\times 10^{-4}\\ \\mathrm{m}]$,\n- $\\epsilon_n \\in [0.25,\\ 0.50]$,\n- $R_{p,n} \\in [1.0\\times 10^{-6}\\ \\mathrm{m},\\ 6.0\\times 10^{-6}\\ \\mathrm{m}]$.\n\nUnless otherwise specified inside a test case, use the constants $b = 1.5$, $\\epsilon_p = 0.35$, $\\rho_n = 1.0\\times 10^{6}$, $\\rho_p = 1.0\\times 10^{6}$, $c_i = 1.0\\times 10^{4}\\ \\mathrm{m^{-1}}$, and $c_s = 1.0\\times 10^{10}\\ \\mathrm{m^{-2}}$.\n\nAngle units do not apply. All capacities and indices are dimensionless or in arbitrary consistent units, and the final reported Sobol indices are dimensionless. No unit conversion is required in the output.\n\nTest suite: Your program must execute the Sobol estimation for the following four test cases. Each test case fully specifies $m$ and any overrides of the constants:\n\n- Test case $1$ (baseline, happy path): $m = 9$. Use $b = 1.5$, $\\epsilon_p = 0.35$, $\\rho_n = 1.0\\times 10^{6}$, $\\rho_p = 1.0\\times 10^{6}$, $c_i = 1.0\\times 10^{4}$, $c_s = 1.0\\times 10^{10}$.\n\n- Test case $2$ (solid-diffusion-relaxed boundary): $m = 9$. Same as baseline except $c_s = 1.0\\times 10^{8}$.\n\n- Test case $3$ (electrolyte-transport-dominant): $m = 9$. Same as baseline except $c_i = 1.0\\times 10^{5}$.\n\n- Test case $4$ (cathode-limited boundary): $m = 9$. Same as baseline except $\\epsilon_p = 0.25$ and $\\rho_p = 1.2\\times 10^{6}$.\n\nRandomization: For each test case, use scrambled Sobol sequences with a fixed integer seed to ensure reproducibility. Use seed $12345$ for constructing matrix $A$ and seed $67890$ for matrix $B$. Do not introduce any other randomness.\n\nRequired program behavior: For each test case, compute the vector of first-order Sobol indices $[S_{L_n}, S_{L_p}, S_{\\epsilon_n}, S_{R_{p,n}}]$ in that exact order and determine the dominant variable index as the integer corresponding to the maximum of these four values, using the mapping $0 \\rightarrow L_n$, $1 \\rightarrow L_p$, $2 \\rightarrow \\epsilon_n$, $3 \\rightarrow R_{p,n}$. Aggregate the results for all test cases into a single list where each element is a list of five elements $[S_{L_n}, S_{L_p}, S_{\\epsilon_n}, S_{R_{p,n}}, \\mathrm{dom\\_idx}]$.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list of per-test-case lists with no spaces and enclosed in square brackets. For example, a valid output with two dummy cases would look like $[[0.1,0.2,0.3,0.4,2],[...]]$. Your program must not print any other text or characters.",
            "solution": "The problem statement is deemed valid. It is scientifically grounded, well-posed, computationally feasible, and provides a complete and consistent set of definitions, parameters, and procedures. The task is to perform a global sensitivity analysis using first-order Sobol indices on a physics-informed surrogate model for the high-rate discharge capacity of a Lithium-ion battery cell.\n\nThe solution is developed by implementing the specified model and sensitivity analysis protocol. The core of the problem involves understanding how four key design variables—negative electrode thickness ($L_n$), positive electrode thickness ($L_p$), negative electrode porosity ($\\epsilon_n$), and negative electrode particle radius ($R_{p,n}$)—influence the cell's $3\\mathrm{C}$ discharge capacity ($Q_{3\\mathrm{C}}$).\n\nThe model for $Q_{3\\mathrm{C}}$ is constructed from two components:\n$1$. The theoretical areal capacity, $Q_{\\mathrm{theor}}(L_n,L_p,\\epsilon_n)$, which represents the maximum possible charge storage. It is limited by the lesser of the anode's and cathode's capacity, a principle known as electrode balancing:\n$$\nQ_{\\mathrm{theor}}(L_n,L_p,\\epsilon_n) = \\min\\left(\\rho_n (1-\\epsilon_n) L_n,\\ \\rho_p (1-\\epsilon_p) L_p\\right)\n$$\nHere, $\\rho_n$ and $\\rho_p$ are effective volumetric storage coefficients, and $(1-\\epsilon)L$ represents the volume of active material per unit area.\n\n$2$. A utilization factor, $U(L_n,L_p,\\epsilon_n,R_{p,n})$, which accounts for performance losses at a high discharge rate ($3\\mathrm{C}$). These losses arise from finite rates of ion transport in the electrolyte and lithium diffusion in the solid active material particles. The functional form combines these loss mechanisms as resistances in series:\n$$\nU(L_n,L_p,\\epsilon_n,R_{p,n}) = \\frac{1}{1 + \\phi_{\\mathrm{ion}}(L_n,L_p,\\epsilon_n) + \\phi_{\\mathrm{solid}}(R_{p,n})}\n$$\nThe ionic loss term, $\\phi_{\\mathrm{ion}} = c_i\\left(\\frac{L_n}{\\epsilon_n^{b}} + \\frac{L_p}{\\epsilon_p^{b}}\\right)$, increases with electrode thickness (longer transport path) and decreases with porosity (less obstructed path), governed by the Bruggeman exponent $b$. The solid-state diffusion loss term, $\\phi_{\\mathrm{solid}} = c_s R_{p,n}^2$, increases quadratically with particle radius, reflecting the longer time required for lithium to diffuse into or out of larger particles.\n\nThe final model for the capacity is the product of these two components:\n$$\nQ_{3\\mathrm{C}}(L_n,L_p,\\epsilon_n,R_{p,n}) = Q_{\\mathrm{theor}} \\cdot U\n$$\n\nTo quantify the influence of each design variable on $Q_{3\\mathrm{C}}$, a Sobol sensitivity analysis is performed. This method decomposes the total variance of the model output into contributions from each input variable (first-order effects) and their interactions (higher-order effects). The first-order Sobol index, $S_i$, measures the fraction of the total output variance that can be attributed to the $i$-th input variable alone.\n\nThe computational procedure follows the Saltelli sampling method, which is highly efficient for estimating Sobol indices. The implementation steps are as follows:\n\n1.  **Quasi-Random Sampling**: Two independent, scrambled Sobol low-discrepancy sequences are generated to create sample matrices $A$ and $B$, each of size $N \\times 4$, where $N=2^m=2^9=512$ and $4$ is the number of input variables. The `scipy.stats.qmc.Sobol` engine is used with fixed seeds ($12345$ for $A$ and $67890$ for $B$) to ensure reproducibility. These matrices contain samples uniformly distributed in the unit hypercube $[0,1]^4$.\n\n2.  **Input Space Mapping**: The samples in $A$ and $B$ are mapped from the unit hypercube to the physical domain of the design variables using an affine transformation for each variable $X_i$:\n    $$\n    X_i = X_{i, \\min} + (X_{i, \\max} - X_{i, \\min}) \\cdot U_i\n    $$\n    where $U_i$ is the sample from the unit hypercube and $[X_{i, \\min}, X_{i, \\max}]$ are the specified bounds for that variable.\n\n3.  **Model Evaluation**: The $Q_{3\\mathrm{C}}$ model is evaluated for each sample point. This yields three sets of model outputs: $f(A)$, $f(B)$, and, for each input variable $i$, $f(A_B^{(i)})$. The matrix $A_B^{(i)}$ is constructed by taking matrix $A$ and replacing its $i$-th column with the corresponding column from matrix $B$. A total of $N \\times (D+2) = 512 \\times (4+2) = 3072$ model evaluations are performed for each test case.\n\n4.  **Sobol Index Estimation**: The first-order Sobol indices are calculated using the specified Saltelli estimator:\n    $$\n    S_i \\approx \\frac{\\frac{1}{N}\\sum_{j=1}^{N} f(B_j)\\left[f\\!\\left((A_{B}^{(i)})_j\\right)-f(A_j)\\right]}{\\operatorname{Var}[f(A)]}\n    $$\n    The denominator, $\\operatorname{Var}[f(A)]$, is the unbiased sample variance of the model outputs from matrix $A$, calculated with a delta degree of freedom of $1$.\n\n5.  **Dominant Variable Identification**: For each test case, the four computed first-order indices, $[S_{L_n}, S_{L_p}, S_{\\epsilon_n}, S_{R_{p,n}}]$, are compared. The index of the largest value (from $0$ to $3$) is identified as the dominant variable index.\n\nThis entire procedure is executed for each of the four test cases, which systematically vary the model's constant parameters ($c_s$, $c_i$, $\\epsilon_p$, $\\rho_p$) to explore different physical regimes of battery operation (e.g., solid-diffusion-limited vs. electrolyte-transport-limited). The final output aggregates the results from all cases into the specified list format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import qmc\nimport json\n\ndef solve():\n    \"\"\"\n    Computes first-order Sobol sensitivity indices for a Li-ion battery model\n    across four test cases, adhering to the specified problem statement.\n    \"\"\"\n\n    # Define input variable bounds\n    bounds = np.array([\n        [4.0e-5, 1.2e-4],  # L_n [m]\n        [5.0e-5, 1.0e-4],  # L_p [m]\n        [0.25, 0.50],      # epsilon_n [-]\n        [1.0e-6, 6.0e-6]   # R_p,n [m]\n    ])\n\n    test_cases = [\n        # Case 1: Baseline\n        {'m': 9, 'b': 1.5, 'epsilon_p': 0.35, 'rho_n': 1.0e6, 'rho_p': 1.0e6, 'c_i': 1.0e4, 'c_s': 1.0e10},\n        # Case 2: Solid-diffusion-relaxed\n        {'m': 9, 'b': 1.5, 'epsilon_p': 0.35, 'rho_n': 1.0e6, 'rho_p': 1.0e6, 'c_i': 1.0e4, 'c_s': 1.0e8},\n        # Case 3: Electrolyte-transport-dominant\n        {'m': 9, 'b': 1.5, 'epsilon_p': 0.35, 'rho_n': 1.0e6, 'rho_p': 1.0e6, 'c_i': 1.0e5, 'c_s': 1.0e10},\n        # Case 4: Cathode-limited\n        {'m': 9, 'b': 1.5, 'epsilon_p': 0.25, 'rho_n': 1.0e6, 'rho_p': 1.2e6, 'c_i': 1.0e4, 'c_s': 1.0e10},\n    ]\n\n    all_results = []\n\n    for case_params in test_cases:\n        m = case_params['m']\n        N = 2**m\n        D = 4\n\n        # Generate scrambled Sobol sequences for matrices A and B\n        sampler_A = qmc.Sobol(d=D, scramble=True, seed=12345)\n        sampler_B = qmc.Sobol(d=D, scramble=True, seed=67890)\n        \n        A_unit = sampler_A.random(n=N)\n        B_unit = sampler_B.random(n=N)\n\n        # Scale samples from unit hypercube to physical domain\n        lower_bounds = bounds[:, 0]\n        upper_bounds = bounds[:, 1]\n        \n        A_physical = qmc.scale(A_unit, lower_bounds, upper_bounds)\n        B_physical = qmc.scale(B_unit, lower_bounds, upper_bounds)\n\n        # Physics-informed surrogate model\n        def Q_3C(variables, params):\n            L_n, L_p, epsilon_n, R_p_n = variables[:, 0], variables[:, 1], variables[:, 2], variables[:, 3]\n            \n            # Unpack parameters\n            b = params['b']\n            epsilon_p = params['epsilon_p']\n            rho_n = params['rho_n']\n            rho_p = params['rho_p']\n            c_i = params['c_i']\n            c_s = params['c_s']\n            \n            # Theoretical areal capacity\n            Q_theor_n = rho_n * (1 - epsilon_n) * L_n\n            Q_theor_p = rho_p * (1 - epsilon_p) * L_p\n            Q_theor = np.minimum(Q_theor_n, Q_theor_p)\n\n            # Transport loss terms\n            phi_ion = c_i * (L_n / (epsilon_n**b) + L_p / (epsilon_p**b))\n            phi_solid = c_s * R_p_n**2\n\n            # Utilization factor\n            U = 1.0 / (1.0 + phi_ion + phi_solid)\n\n            return Q_theor * U\n\n        # Evaluate the model for sample matrices\n        y_A = Q_3C(A_physical, case_params)\n        y_B = Q_3C(B_physical, case_params)\n\n        # Estimate the variance of the output, as specified\n        var_y_A = np.var(y_A, ddof=1)\n\n        sobol_indices = []\n        for i in range(D):\n            # Create the A_B^(i) matrix\n            A_B_i_physical = np.copy(A_physical)\n            A_B_i_physical[:, i] = B_physical[:, i]\n\n            # Evaluate model on A_B^(i)\n            y_A_B_i = Q_3C(A_B_i_physical, case_params)\n\n            # Calculate the numerator of the S_i estimator\n            numerator = np.mean(y_B * (y_A_B_i - y_A))\n\n            # Calculate the first-order Sobol index\n            s_i = numerator / var_y_A\n            sobol_indices.append(s_i)\n        \n        # Find the index of the dominant variable\n        dominant_index = int(np.argmax(sobol_indices))\n        \n        # Aggregate results for case\n        case_result = sobol_indices + [dominant_index]\n        all_results.append(case_result)\n\n\n    # Final print statement in the exact required format\n    # Use json.dumps for compact, space-free list formatting\n    print(json.dumps(all_results, separators=(',', ':')))\n\nsolve()\n```"
        },
        {
            "introduction": "Battery engineering is fundamentally an exercise in managing trade-offs, most notably the conflict between maximizing energy storage and delivering high power. This exercise moves from broad sensitivity analysis to the evaluation of specific candidate designs, introducing the core concept of Pareto optimality . By calculating the areal energy and power densities for a set of electrode designs and identifying which are \"dominated\", you will gain practical experience in formulating and navigating multi-objective optimization problems where no single perfect solution exists.",
            "id": "3894887",
            "problem": "Consider a single porous intercalation electrode whose geometric area is $A = 1\\,\\mathrm{m^2}$. You will compare four candidate designs defined by the electrode thickness $L$, porosity $\\epsilon$, and active particle radius $R_p$. Assume the opposing electrode and separator are not rate-limiting and neglect contact resistances; all designs share the same materials and temperature. Use only the relations stated below to formulate energy and power densities and determine which designs are Pareto dominated.\n\nFundamental base and parameters:\n- Active-material areal mass is $m_{\\mathrm{areal}} = \\rho_{s}\\,(1 - \\epsilon)\\,L$, where $\\rho_s$ is the solid active-material density.\n- Areal capacity is $Q_{\\mathrm{areal}} = q_s\\,m_{\\mathrm{areal}}$, where $q_s$ is the specific capacity of the active material.\n- Areal energy at a nominal voltage $V_{\\mathrm{nom}}$ is $E_{\\mathrm{areal}} = V_{\\mathrm{nom}}\\,Q_{\\mathrm{areal}}$.\n- The internal resistance consists of three series contributions:\n  1. Ionic conduction in the pore electrolyte modeled using the Bruggeman relation $\\sigma_{\\mathrm{ion,eff}} = \\sigma_e\\,\\epsilon^{b}$, giving $R_{\\mathrm{ion}} = \\dfrac{L}{\\sigma_{\\mathrm{ion,eff}}\\,A}$.\n  2. Electronic conduction in the solid matrix modeled as $\\sigma_{\\mathrm{sol,eff}} = \\sigma_s\\,(1 - \\epsilon)^{b_s}$, giving $R_{\\mathrm{sol}} = \\dfrac{L}{\\sigma_{\\mathrm{sol,eff}}\\,A}$.\n  3. Charge-transfer resistance obtained from the linearized Butler–Volmer kinetics, $r_{\\mathrm{ct}} = \\dfrac{RT}{F\\,i_0}$ per unit interfacial area, with total interfacial area per geometric area $a_s\\,L$, where the specific interfacial area for spherical particles is $a_s = \\dfrac{3\\,(1 - \\epsilon)}{R_p}$. Thus $R_{\\mathrm{ct}} = \\dfrac{RT}{F\\,i_0\\,a_s\\,A\\,L}$.\n- The total internal resistance is $R_{\\mathrm{int}} = R_{\\mathrm{ion}} + R_{\\mathrm{sol}} + R_{\\mathrm{ct}}$.\n- Using a lumped Resistor–Capacitor (RC) time approximation derived from first principles and the maximum power transfer theorem, the areal power density is $P_{\\mathrm{areal}} = \\dfrac{V_{\\mathrm{nom}}^{2}}{4\\,R_{\\mathrm{int}}\\,A}$.\n\nConstants and material properties:\n- $V_{\\mathrm{nom}} = 3.7\\,\\mathrm{V}$, $q_s = 160\\,\\mathrm{Ah\\,kg^{-1}}$, $\\rho_s = 4750\\,\\mathrm{kg\\,m^{-3}}$.\n- Electrolyte conductivity $\\sigma_e = 1.2\\,\\mathrm{S\\,m^{-1}}$, Bruggeman exponent for ion transport $b = 1.5$.\n- Solid-phase conductivity $\\sigma_s = 5000\\,\\mathrm{S\\,m^{-1}}$, exponent for solid network $b_s = 1.5$.\n- Exchange current density $i_0 = 5\\,\\mathrm{A\\,m^{-2}}$ (per unit interfacial area), Faraday constant $F = 96485\\,\\mathrm{C\\,mol^{-1}}$, ideal gas constant $R = 8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$, temperature $T = 298\\,\\mathrm{K}$.\n\nCandidate designs:\n- Design 1: $L = 60\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.35$, $R_p = 4\\times 10^{-6}\\,\\mathrm{m}$.\n- Design 2: $L = 100\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.40$, $R_p = 5\\times 10^{-6}\\,\\mathrm{m}$.\n- Design 3: $L = 80\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.30$, $R_p = 3\\times 10^{-6}\\,\\mathrm{m}$.\n- Design 4: $L = 120\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.45$, $R_p = 8\\times 10^{-6}\\,\\mathrm{m}$.\n\nTasks:\n1. For each design, compute the areal energy $E_{\\mathrm{areal}}$ in $\\mathrm{Wh\\,m^{-2}}$.\n2. For each design, compute the areal power density $P_{\\mathrm{areal}}$ in $\\mathrm{W\\,m^{-2}}$ using the RC time approximation provided above.\n3. Identify which designs are Pareto dominated, where a design is Pareto dominated if another design has at least as high areal energy and at least as high areal power, with strict improvement in at least one of the two metrics.\n\nReport the indices of the Pareto dominated designs in ascending order as the final answer. No rounding instruction is needed for the final answer. Express intermediate energy in $\\mathrm{Wh\\,m^{-2}}$ and power in $\\mathrm{W\\,m^{-2}}$ where applicable.",
            "solution": "**Problem Validation**\n\n**Step 1: Extract Givens**\n- Geometric area: $A = 1\\,\\mathrm{m^2}$\n- Candidate designs are defined by: electrode thickness $L$, porosity $\\epsilon$, and active particle radius $R_p$.\n- Assumptions: The opposing electrode and separator are not rate-limiting; contact resistances are neglected; all designs share the same materials and temperature.\n- Active-material areal mass: $m_{\\mathrm{areal}} = \\rho_{s}\\,(1 - \\epsilon)\\,L$\n- Solid active-material density: $\\rho_s = 4750\\,\\mathrm{kg\\,m^{-3}}$\n- Areal capacity: $Q_{\\mathrm{areal}} = q_s\\,m_{\\mathrm{areal}}$\n- Specific capacity of active material: $q_s = 160\\,\\mathrm{Ah\\,kg^{-1}}$\n- Areal energy at nominal voltage $V_{\\mathrm{nom}}$: $E_{\\mathrm{areal}} = V_{\\mathrm{nom}}\\,Q_{\\mathrm{areal}}$\n- Nominal voltage: $V_{\\mathrm{nom}} = 3.7\\,\\mathrm{V}$\n- Total internal resistance: $R_{\\mathrm{int}} = R_{\\mathrm{ion}} + R_{\\mathrm{sol}} + R_{\\mathrm{ct}}$\n- Ionic resistance: $R_{\\mathrm{ion}} = \\dfrac{L}{\\sigma_{\\mathrm{ion,eff}}\\,A}$, with effective ionic conductivity $\\sigma_{\\mathrm{ion,eff}} = \\sigma_e\\,\\epsilon^{b}$.\n- Electrolyte conductivity: $\\sigma_e = 1.2\\,\\mathrm{S\\,m^{-1}}$\n- Bruggeman exponent for ion transport: $b = 1.5$\n- Electronic resistance: $R_{\\mathrm{sol}} = \\dfrac{L}{\\sigma_{\\mathrm{sol,eff}}\\,A}$, with effective solid-phase conductivity $\\sigma_{\\mathrm{sol,eff}} = \\sigma_s\\,(1 - \\epsilon)^{b_s}$.\n- Solid-phase conductivity: $\\sigma_s = 5000\\,\\mathrm{S\\,m^{-1}}$\n- Exponent for solid network: $b_s = 1.5$\n- Charge-transfer resistance: $R_{\\mathrm{ct}} = \\dfrac{RT}{F\\,i_0\\,a_s\\,A\\,L}$, with specific interfacial area per unit volume $a_s = \\dfrac{3\\,(1 - \\epsilon)}{R_p}$.\n- Universal gas constant: $R = 8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$\n- Temperature: $T = 298\\,\\mathrm{K}$\n- Faraday constant: $F = 96485\\,\\mathrm{C\\,mol^{-1}}$\n- Exchange current density: $i_0 = 5\\,\\mathrm{A\\,m^{-2}}$\n- Areal power density: $P_{\\mathrm{areal}} = \\dfrac{V_{\\mathrm{nom}}^{2}}{4\\,R_{\\mathrm{int}}\\,A}$\n- Design 1: $L = 60\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.35$, $R_p = 4\\times 10^{-6}\\,\\mathrm{m}$.\n- Design 2: $L = 100\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.40$, $R_p = 5\\times 10^{-6}\\,\\mathrm{m}$.\n- Design 3: $L = 80\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.30$, $R_p = 3\\times 10^{-6}\\,\\mathrm{m}$.\n- Design 4: $L = 120\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.45$, $R_p = 8\\times 10^{-6}\\,\\mathrm{m}$.\n- Tasks: (1) Compute $E_{\\mathrm{areal}}$ for each design. (2) Compute $P_{\\mathrm{areal}}$ for each design. (3) Identify which designs are Pareto dominated.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, utilizing established simplified models for porous electrode behavior, such as the Bruggeman relation for effective conductivity and linearized Butler-Volmer kinetics for charge-transfer resistance. All equations, parameters, and constants are physically plausible and consistent with electrochemical engineering literature. The problem is well-posed, providing all necessary information to compute the required performance metrics and execute the Pareto analysis. The language is objective, and all terms are clearly defined. Therefore, the problem is valid.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be developed.\n\n**Solution Derivation**\n\nThe analysis requires computing the areal energy density ($E_{\\mathrm{areal}}$) and areal power density ($P_{\\mathrm{areal}}$) for each of the four designs.\n\nThe areal energy density is given by the formula:\n$$E_{\\mathrm{areal}} = V_{\\mathrm{nom}} \\, Q_{\\mathrm{areal}} = V_{\\mathrm{nom}} \\, q_s \\, m_{\\mathrm{areal}} = V_{\\mathrm{nom}} \\, q_s \\, \\rho_s (1 - \\epsilon) L$$\nThe units of the input parameters ($V_{\\mathrm{nom}}$ in $\\mathrm{V}$, $q_s$ in $\\mathrm{Ah\\,kg^{-1}}$, $\\rho_s$ in $\\mathrm{kg\\,m^{-3}}$, and $L$ in $\\mathrm{m}$) directly yield $E_{\\mathrm{areal}}$ in $\\mathrm{Wh\\,m^{-2}}$.\n\nThe areal power density is given by $P_{\\mathrm{areal}} = \\dfrac{V_{\\mathrm{nom}}^{2}}{4\\,R_{\\mathrm{int}}\\,A}$. Since the geometric area is specified as $A = 1\\,\\mathrm{m^2}$, we can compute the areal resistance $\\mathcal{R}_{\\mathrm{int}} = R_{\\mathrm{int}} A$. The total areal resistance is the sum of the ionic, electronic, and charge-transfer contributions:\n$$\\mathcal{R}_{\\mathrm{int}} = \\mathcal{R}_{\\mathrm{ion}} + \\mathcal{R}_{\\mathrm{sol}} + \\mathcal{R}_{\\mathrm{ct}}$$\nThe individual areal resistance components are defined as:\n1. Ionic: $\\mathcal{R}_{\\mathrm{ion}} = R_{\\mathrm{ion}}\\,A = \\dfrac{L}{\\sigma_e \\epsilon^b}$\n2. Electronic: $\\mathcal{R}_{\\mathrm{sol}} = R_{\\mathrm{sol}}\\,A = \\dfrac{L}{\\sigma_s (1 - \\epsilon)^{b_s}}$\n3. Charge-transfer: $\\mathcal{R}_{\\mathrm{ct}} = R_{\\mathrm{ct}}\\,A = \\dfrac{RT}{F i_0 a_s L}$. Substituting $a_s = \\dfrac{3(1-\\epsilon)}{R_p}$, the expression becomes $\\mathcal{R}_{\\mathrm{ct}} = \\dfrac{RT}{F i_0} \\dfrac{R_p}{3(1-\\epsilon)L}$.\n\nThe power density is then calculated as:\n$$P_{\\mathrm{areal}} = \\frac{V_{\\mathrm{nom}}^2}{4 \\mathcal{R}_{\\mathrm{int}}}$$\nFirst, we compute the constant group $\\dfrac{RT}{F i_0}$:\n$$\\frac{RT}{F i_0} = \\frac{(8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}})(298\\,\\mathrm{K})}{(96485\\,\\mathrm{C\\,mol^{-1}})(5\\,\\mathrm{A\\,m^{-2}})} \\approx 0.0051358\\,\\mathrm{\\Omega\\,m^2}$$\nWe now calculate $E_{\\mathrm{areal}}$ and $P_{\\mathrm{areal}}$ for each of the four designs.\n\n**Design 1:** $L = 60\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.35$, $R_p = 4\\times 10^{-6}\\,\\mathrm{m}$\n$E_{\\mathrm{areal},1} = (3.7) (160) (4750) (1-0.35) (60\\times 10^{-6}) = 109.668\\,\\mathrm{Wh\\,m^{-2}}$\n$\\mathcal{R}_{\\mathrm{ion},1} = \\dfrac{60\\times 10^{-6}}{1.2 \\times (0.35)^{1.5}} \\approx 2.4131 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{sol},1} = \\dfrac{60\\times 10^{-6}}{5000 \\times (0.65)^{1.5}} \\approx 2.2950 \\times 10^{-8}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{ct},1} = (0.0051358) \\dfrac{4\\times 10^{-6}}{3(1-0.35)(60\\times 10^{-6})} \\approx 1.7558 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{int},1} \\approx (2.4131 \\times 10^{-4}) + (2.2950 \\times 10^{-8}) + (1.7558 \\times 10^{-4}) \\approx 4.1691 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$P_{\\mathrm{areal},1} = \\dfrac{(3.7)^2}{4 \\times 4.1691 \\times 10^{-4}} \\approx 8209.19\\,\\mathrm{W\\,m^{-2}}$\n\n**Design 2:** $L = 100\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.40$, $R_p = 5\\times 10^{-6}\\,\\mathrm{m}$\n$E_{\\mathrm{areal},2} = (3.7) (160) (4750) (1-0.40) (100\\times 10^{-6}) = 168.72\\,\\mathrm{Wh\\,m^{-2}}$\n$\\mathcal{R}_{\\mathrm{ion},2} = \\dfrac{100\\times 10^{-6}}{1.2 \\times (0.40)^{1.5}} \\approx 3.2952 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{sol},2} = \\dfrac{100\\times 10^{-6}}{5000 \\times (0.60)^{1.5}} \\approx 4.3034 \\times 10^{-8}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{ct},2} = (0.0051358) \\dfrac{5\\times 10^{-6}}{3(1-0.40)(100\\times 10^{-6})} \\approx 1.4266 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{int},2} \\approx (3.2952 \\times 10^{-4}) + (4.3034 \\times 10^{-8}) + (1.4266 \\times 10^{-4}) \\approx 4.7222 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$P_{\\mathrm{areal},2} = \\dfrac{(3.7)^2}{4 \\times 4.7222 \\times 10^{-4}} \\approx 7247.50\\,\\mathrm{W\\,m^{-2}}$\n\n**Design 3:** $L = 80\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.30$, $R_p = 3\\times 10^{-6}\\,\\mathrm{m}$\n$E_{\\mathrm{areal},3} = (3.7) (160) (4750) (1-0.30) (80\\times 10^{-6}) = 157.472\\,\\mathrm{Wh\\,m^{-2}}$\n$\\mathcal{R}_{\\mathrm{ion},3} = \\dfrac{80\\times 10^{-6}}{1.2 \\times (0.30)^{1.5}} \\approx 4.0560 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{sol},3} = \\dfrac{80\\times 10^{-6}}{5000 \\times (0.70)^{1.5}} \\approx 2.7318 \\times 10^{-8}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{ct},3} = (0.0051358) \\dfrac{3\\times 10^{-6}}{3(1-0.30)(80\\times 10^{-6})} \\approx 0.9171 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{int},3} \\approx (4.0560 \\times 10^{-4}) + (2.7318 \\times 10^{-8}) + (0.9171 \\times 10^{-4}) \\approx 4.9734 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$P_{\\mathrm{areal},3} = \\dfrac{(3.7)^2}{4 \\times 4.9734 \\times 10^{-4}} \\approx 6881.56\\,\\mathrm{W\\,m^{-2}}$\n\n**Design 4:** $L = 120\\times 10^{-6}\\,\\mathrm{m}$, $\\epsilon = 0.45$, $R_p = 8\\times 10^{-6}\\,\\mathrm{m}$\n$E_{\\mathrm{areal},4} = (3.7) (160) (4750) (1-0.45) (120\\times 10^{-6}) = 185.592\\,\\mathrm{Wh\\,m^{-2}}$\n$\\mathcal{R}_{\\mathrm{ion},4} = \\dfrac{120\\times 10^{-6}}{1.2 \\times (0.45)^{1.5}} \\approx 3.3121 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{sol},4} = \\dfrac{120\\times 10^{-6}}{5000 \\times (0.55)^{1.5}} \\approx 5.8720 \\times 10^{-8}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{ct},4} = (0.0051358) \\dfrac{8\\times 10^{-6}}{3(1-0.45)(120\\times 10^{-6})} \\approx 2.0751 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$\\mathcal{R}_{\\mathrm{int},4} \\approx (3.3121 \\times 10^{-4}) + (5.8720 \\times 10^{-8}) + (2.0751 \\times 10^{-4}) \\approx 5.3878 \\times 10^{-4}\\,\\mathrm{\\Omega\\,m^2}$\n$P_{\\mathrm{areal},4} = \\dfrac{(3.7)^2}{4 \\times 5.3878 \\times 10^{-4}} \\approx 6352.28\\,\\mathrm{W\\,m^{-2}}$\n\n**Pareto Dominance Analysis**\nThe performance metrics ($E_{\\mathrm{areal}}$ in $\\mathrm{Wh\\,m^{-2}}$, $P_{\\mathrm{areal}}$ in $\\mathrm{W\\,m^{-2}}$) are:\n- Design 1: ($109.668$, $8209.19$)\n- Design 2: ($168.72$, $7247.50$)\n- Design 3: ($157.472$, $6881.56$)\n- Design 4: ($185.592$, $6352.28$)\n\nA design $i$ is Pareto dominated if another design $j$ exists such that $E_j \\ge E_i$ and $P_j \\ge P_i$, with at least one strict inequality.\n- Design 1 has the highest power density; it cannot be dominated.\n- Design 4 has the highest energy density; it cannot be dominated.\n- Comparing Design 3 to others:\n  - vs. Design 1: $E_3 > E_1$, but $P_3  P_1$. Not dominated by Design 1.\n  - vs. Design 2: $E_2 = 168.72 > E_3 = 157.472$, and $P_2 = 7247.50 > P_3 = 6881.56$. Since Design 2 is superior in both energy and power, **Design 3 is Pareto dominated by Design 2**.\n  - vs. Design 4: $E_4 > E_3$, but $P_4  P_3$. Not dominated by Design 4.\n- Comparing Design 2 to others:\n  - vs. Design 1: $E_2 > E_1$, but $P_2  P_1$. Not dominated by Design 1.\n  - vs. Design 4: $E_4 > E_2$, but $P_4  P_2$. Not dominated by Design 4.\n\nThe only design that is Pareto dominated is Design 3. The question asks for the indices of the dominated designs. The only such index is $3$.",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "After identifying key parameters and understanding the trade-offs, the final step is to employ an algorithm that can automatically navigate the design space to find an optimal solution. This practice offers a look \"under the hood\" of Sequential Quadratic Programming (SQP), a powerful algorithm for constrained nonlinear optimization. By setting up and solving the Karush-Kuhn-Tucker (KKT) system for a single optimization step, you will see precisely how local gradient and curvature information is used to generate a search direction that systematically improves a design while satisfying its constraints .",
            "id": "3894904",
            "problem": "Consider a simplified but scientifically realistic automated battery design scenario for a lithium-ion pouch cell lamination where the decision variables are the layer thicknesses $x = (t_n, t_s, t_p)^{\\top}$ in micrometers, comprising negative electrode thickness $t_n$, separator thickness $t_s$, and positive electrode thickness $t_p$. The task is to compute one sequential quadratic programming step based on a local second-order model of the objective and a first-order model of the constraints at a current iterate $x_k$.\n\nThe objective function $f(x)$ is a differentiable performance metric derived from a surrogate of pack-level energy density penalized by ohmic resistance, evaluated by a multiphysics simulation. You are given at the current iterate $x_k$ the gradient of the objective, $\\nabla f(x_k) = [\\,2,\\,-1,\\,1\\,]^{\\top}$, and a symmetric positive-definite approximation of the Hessian of the Lagrangian, \n$$\nB_k \\;=\\; \\begin{pmatrix}\n4  1  0 \\\\\n1  3  0 \\\\\n0  0  2\n\\end{pmatrix}.\n$$\n\nThe design must satisfy a capacity-balance equality constraint and thickness-related inequality constraints grounded in electrochemical and packaging requirements:\n- The capacity-balance equality is $h(x) = 2\\,t_n - 3\\,t_p = 0$, with Jacobian $\\nabla h(x_k) = [\\,2,\\,0,\\,-3\\,]$ and current residual $h(x_k) = 6$ micrometers.\n- The total laminate thickness inequality is $g_1(x) = t_n + t_s + t_p - T_{\\max} \\le 0$, which is active at $x_k$ with $g_1(x_k) = 0$, and Jacobian $\\nabla g_1(x_k) = [\\,1,\\,1,\\,1\\,]$.\n- A separator minimum-thickness inequality $g_2(x) = t_{s,\\min} - t_s \\le 0$ is strictly inactive at $x_k$ with $g_2(x_k)  0$ and is not part of the active set for this step.\n\nUsing the principles of sequential quadratic programming, form the local quadratic programming subproblem at $x_k$ by:\n- Approximating the objective with a second-order Taylor expansion using $B_k$ and $\\nabla f(x_k)$.\n- Enforcing first-order feasibility for the equality constraint $h(x)$ and the single active inequality $g_1(x)$ through linearization.\n\nUnder an active-set strategy that includes only $g_1$ as active, compute the primal search direction $d_k = (d_{t_n}, d_{t_s}, d_{t_p})^{\\top}$ by solving the necessary optimality conditions of this subproblem. Express the final $d_k$ components in micrometers. Provide exact values; do not round.",
            "solution": "The problem requires computing a single search direction, denoted as $d_k$, for a Sequential Quadratic Programming (SQP) algorithm applied to a battery design optimization problem. The decision variables are the layer thicknesses $x = (t_n, t_s, t_p)^{\\top}$. The search direction is a vector $d_k = (d_{t_n}, d_{t_s}, d_{t_p})^{\\top}$ that represents the step to be taken from the current iterate $x_k$.\n\nThe core of the SQP method is to model the original nonlinear problem at the current iterate $x_k$ as a Quadratic Programming (QP) subproblem. This subproblem is formulated by approximating the objective function with a quadratic model and linearizing the constraints.\n\nThe objective of the QP subproblem is to minimize a quadratic approximation of the change in the objective function. This approximation is given by the second-order Taylor expansion around $x_k$, using the provided gradient $\\nabla f(x_k)$ and the Hessian approximation of the Lagrangian, $B_k$. The objective to minimize with respect to the search direction $d$ is:\n$$\n\\min_{d} \\quad \\frac{1}{2} d^{\\top} B_k d + \\nabla f(x_k)^{\\top} d\n$$\nSubstituting the given values $B_k = \\begin{pmatrix} 4  1  0 \\\\ 1  3  0 \\\\ 0  0  2 \\end{pmatrix}$ and $\\nabla f(x_k) = [\\,2,\\,-1,\\,1\\,]^{\\top}$:\n$$\n\\min_{d} \\quad \\frac{1}{2} \\begin{pmatrix} d_{t_n} \\\\ d_{t_s} \\\\ d_{t_p} \\end{pmatrix}^{\\top} \\begin{pmatrix} 4  1  0 \\\\ 1  3  0 \\\\ 0  0  2 \\end{pmatrix} \\begin{pmatrix} d_{t_n} \\\\ d_{t_s} \\\\ d_{t_p} \\end{pmatrix} + \\begin{pmatrix} 2 \\\\ -1 \\\\ 1 \\end{pmatrix}^{\\top} \\begin{pmatrix} d_{t_n} \\\\ d_{t_s} \\\\ d_{t_p} \\end{pmatrix}\n$$\nThis expression expands to:\n$$\n\\min_{d} \\quad (2 d_{t_n}^2 + d_{t_n} d_{t_s} + \\frac{3}{2} d_{t_s}^2 + d_{t_p}^2) + (2 d_{t_n} - d_{t_s} + d_{t_p})\n$$\n\nThe constraints are linearized about $x_k$. For a generic constraint $c(x)$, the linearization is $c(x_k) + \\nabla c(x_k)^{\\top} d = 0$ for equality constraints, and $c(x_k) + \\nabla c(x_k)^{\\top} d \\le 0$ for inequality constraints.\n\nThe equality constraint is $h(x) = 2\\,t_n - 3\\,t_p = 0$. Its linearization is:\n$$\nh(x_k) + \\nabla h(x_k)^{\\top} d = 0\n$$\nWith $h(x_k)=6$ and $\\nabla h(x_k) = [\\,2,\\,0,\\,-3\\,]^{\\top}$, this becomes:\n$$\n6 + 2\\,d_{t_n} - 3\\,d_{t_p} = 0 \\quad \\implies \\quad 2\\,d_{t_n} - 3\\,d_{t_p} = -6\n$$\n\nThe active inequality constraint is $g_1(x) = t_n + t_s + t_p - T_{\\max} \\le 0$. An active-set method treats active inequalities as equalities for the determination of the search direction. The linearization is:\n$$\ng_1(x_k) + \\nabla g_1(x_k)^{\\top} d = 0\n$$\nWith $g_1(x_k)=0$ and $\\nabla g_1(x_k) = [\\,1,\\,1,\\,1\\,]^{\\top}$, this becomes:\n$$\n0 + d_{t_n} + d_{t_s} + d_{t_p} = 0 \\quad \\implies \\quad d_{t_n} + d_{t_s} + d_{t_p} = 0\n$$\n\nThe QP subproblem is thus:\n$$\n\\min_{d} \\quad 2 d_{t_n}^2 + d_{t_n} d_{t_s} + \\frac{3}{2} d_{t_s}^2 + d_{t_p}^2 + 2 d_{t_n} - d_{t_s} + d_{t_p}\n$$\nsubject to:\n$$\n\\begin{align*}\n2\\,d_{t_n} - 3\\,d_{t_p} = -6 \\\\\nd_{t_n} + d_{t_s} + d_{t_p} = 0\n\\end{align*}\n$$\nSince $B_k$ is positive definite, the objective function is strictly convex, and with linear constraints, this problem has a unique solution. We find this solution by solving the Karush-Kuhn-Tucker (KKT) conditions. Let $\\lambda_h$ and $\\lambda_g$ be the Lagrange multipliers for the linearized constraints $h$ and $g_1$ respectively. The Lagrangian $\\mathcal{L}$ of the subproblem is:\n$$\n\\mathcal{L}(d, \\lambda_h, \\lambda_g) = \\left(\\frac{1}{2} d^{\\top} B_k d + \\nabla f(x_k)^{\\top} d\\right) + \\lambda_h(h(x_k) + \\nabla h(x_k)^{\\top}d) + \\lambda_g(g_1(x_k) + \\nabla g_1(x_k)^{\\top}d)\n$$\nThe KKT conditions are derived by setting the gradient of the Lagrangian with respect to $d$ to zero, along with the constraint equations:\n$$\n\\nabla_d \\mathcal{L} = B_k d + \\nabla f(x_k) + \\lambda_h \\nabla h(x_k) + \\lambda_g \\nabla g_1(x_k) = 0\n$$\nThis gives us a system of linear equations:\n$$\n\\begin{pmatrix}\nB_k  \\nabla h(x_k)  \\nabla g_1(x_k) \\\\\n\\nabla h(x_k)^{\\top}  0  0 \\\\\n\\nabla g_1(x_k)^{\\top}  0  0\n\\end{pmatrix}\n\\begin{pmatrix}\nd \\\\ \\lambda_h \\\\ \\lambda_g\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-\\nabla f(x_k) \\\\ -h(x_k) \\\\ -g_1(x_k)\n\\end{pmatrix}\n$$\nSubstituting the given values:\n$$\n\\begin{pmatrix}\n4  1  0  2  1 \\\\\n1  3  0  0  1 \\\\\n0  0  2  -3  1 \\\\\n2  0  -3  0  0 \\\\\n1  1  1  0  0\n\\end{pmatrix}\n\\begin{pmatrix}\nd_{t_n} \\\\ d_{t_s} \\\\ d_{t_p} \\\\ \\lambda_h \\\\ \\lambda_g\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-2 \\\\ 1 \\\\ -1 \\\\ -6 \\\\ 0\n\\end{pmatrix}\n$$\nThis is a system of $5$ linear equations in $5$ variables. From the last two rows, we have the constraint equations for $d$:\n(1) $2 d_{t_n} - 3 d_{t_p} = -6$\n(2) $d_{t_n} + d_{t_s} + d_{t_p} = 0$\n\nFrom equation (2), we express $d_{t_p}$ in terms of the other variables: $d_{t_p} = -d_{t_n} - d_{t_s}$.\nSubstituting this into equation (1):\n$2 d_{t_n} - 3(-d_{t_n} - d_{t_s}) = -6$\n$5 d_{t_n} + 3 d_{t_s} = -6$ (3)\n\nNow consider the first three rows of the KKT system:\n(4) $4 d_{t_n} + d_{t_s} + 2 \\lambda_h + \\lambda_g = -2$\n(5) $d_{t_n} + 3 d_{t_s} + \\lambda_g = 1$\n(6) $2 d_{t_p} - 3 \\lambda_h + \\lambda_g = -1$\n\nFrom (5), we can express $\\lambda_g$ as $\\lambda_g = 1 - d_{t_n} - 3 d_{t_s}$.\nSubstitute this into (6):\n$2 d_{t_p} - 3 \\lambda_h + (1 - d_{t_n} - 3 d_{t_s}) = -1$\n$3 \\lambda_h = 2 d_{t_p} - d_{t_n} - 3 d_{t_s} + 2$\nUsing $d_{t_p} = -d_{t_n} - d_{t_s}$:\n$3 \\lambda_h = 2(-d_{t_n} - d_{t_s}) - d_{t_n} - 3 d_{t_s} + 2 = -3 d_{t_n} - 5 d_{t_s} + 2$\n$\\lambda_h = -d_{t_n} - \\frac{5}{3} d_{t_s} + \\frac{2}{3}$\n\nNow substitute the expressions for $\\lambda_h$ and $\\lambda_g$ into equation (4):\n$4 d_{t_n} + d_{t_s} + 2(-d_{t_n} - \\frac{5}{3} d_{t_s} + \\frac{2}{3}) + (1 - d_{t_n} - 3 d_{t_s}) = -2$\n$4 d_{t_n} + d_{t_s} - 2 d_{t_n} - \\frac{10}{3} d_{t_s} + \\frac{4}{3} + 1 - d_{t_n} - 3 d_{t_s} = -2$\nCombining terms:\n$(4-2-1)d_{t_n} + (1 - \\frac{10}{3} - 3)d_{t_s} = -2 - 1 - \\frac{4}{3}$\n$d_{t_n} + (\\frac{3-10-9}{3})d_{t_s} = -3 - \\frac{4}{3}$\n$d_{t_n} - \\frac{16}{3} d_{t_s} = -\\frac{13}{3}$\n$3 d_{t_n} - 16 d_{t_s} = -13$ (7)\n\nWe now have a system of two equations, (3) and (7), for $d_{t_n}$ and $d_{t_s}$:\n$5 d_{t_n} + 3 d_{t_s} = -6$\n$3 d_{t_n} - 16 d_{t_s} = -13$\nTo solve this system, we can multiply the first equation by $16$ and the second by $3$:\n$80 d_{t_n} + 48 d_{t_s} = -96$\n$9 d_{t_n} - 48 d_{t_s} = -39$\nAdding these two equations yields:\n$89 d_{t_n} = -135 \\implies d_{t_n} = -\\frac{135}{89}$\n\nSubstitute $d_{t_n}$ back into equation (3):\n$5(-\\frac{135}{89}) + 3 d_{t_s} = -6$\n$-\\frac{675}{89} + 3 d_{t_s} = -\\frac{534}{89}$\n$3 d_{t_s} = \\frac{675 - 534}{89} = \\frac{141}{89}$\n$d_{t_s} = \\frac{141}{3 \\cdot 89} = \\frac{47}{89}$\n\nFinally, calculate $d_{t_p}$ using equation (2):\n$d_{t_p} = -d_{t_n} - d_{t_s} = -(-\\frac{135}{89}) - \\frac{47}{89} = \\frac{135 - 47}{89} = \\frac{88}{89}$\n\nThus, the primal search direction is $d_k = (d_{t_n}, d_{t_s}, d_{t_p})^{\\top} = (-\\frac{135}{89}, \\frac{47}{89}, \\frac{88}{89})^{\\top}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{135}{89}  \\frac{47}{89}  \\frac{88}{89}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}