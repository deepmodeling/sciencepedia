{
    "hands_on_practices": [
        {
            "introduction": "Before we can optimize an electrode's internal architecture, we must correctly define its boundaries. This exercise  challenges you to think critically about the physical interface between the porous electrode and the solid current collector. By selecting the correct mathematical expressions for impermeability, you will learn to ensure your model is physically consistent, a crucial first step in any valid PDE-constrained design problem.",
            "id": "3938705",
            "problem": "Consider a one-dimensional porous negative electrode occupying the spatial domain $x \\in [0, L]$, with the metal current collector at $x = 0$ and the separator at $x = L$. The pore-phase porosity is a prescribed spatially varying function $\\varepsilon_e(x)$ that is to be optimized. The electrolyte contains a binary salt with molar concentration $c_e(x,t)$. The volume-averaged conservation law for electrolyte salt in the porous electrode is\n$$\n\\frac{\\partial}{\\partial t}\\big(\\varepsilon_e(x)\\,c_e(x,t)\\big) + \\frac{\\partial}{\\partial x} N_e(x,t) = R_e(x,t),\n$$\nwhere $N_e(x,t)$ is the macroscopic molar flux of salt and $R_e(x,t)$ is a volumetric source term due to electrochemical reactions at the internal solid–electrolyte interfaces. Assume the usual dilute-solution limit under electroneutrality, so that the macroscopic salt flux is given by Fick’s law with an effective diffusion coefficient,\n$$\nN_e(x,t) = - D_e^{\\mathrm{eff}}(x)\\,\\frac{\\partial c_e}{\\partial x}(x,t), \\quad D_e^{\\mathrm{eff}}(x) = D_e\\,\\varepsilon_e(x)^\\beta,\n$$\nwith $D_e  0$ and $\\beta  0$ constants reflecting tortuosity scaling. Charge conservation in the electrolyte phase is described by\n$$\n\\frac{\\partial i_e}{\\partial x}(x,t) = a_s(x)\\,F\\,j(x,t),\n$$\nwhere $i_e(x,t)$ is the electrolyte ionic current density, $a_s(x)$ is the active surface area per unit electrode volume, $F$ is the Faraday constant, and $j(x,t)$ is the interfacial reaction current density. The metal current collector at $x=0$ is perfectly impermeable to the electrolyte and does not directly participate in electrolyte-phase charge transport.\n\nThe optimization over $\\varepsilon_e(x)$ may create regions of steep porosity gradients near $x=0$. To avoid non-physical accumulation or depletion of salt purely due to changes in the available pore volume at the current collector, appropriate boundary conditions must be posed at $x=0$ that are consistent with the above conservation laws and the physical impermeability of the current collector to the electrolyte.\n\nWhich of the following boundary-condition pairs at $x=0$ correctly enforces the absence of artificial salt accumulation at the current collector in the presence of graded porosity, and what is its physical interpretation?\n\nA. Impose $n\\cdot N_e(0,t) = 0$ and $n\\cdot i_e(0,t) = 0$, where $n$ is the outward unit normal at $x=0$. Interpretation: the current collector is impermeable to electrolyte species and does not allow ionic current; therefore no macroscopic salt molar flux or ionic current crosses the boundary, regardless of $\\varepsilon_e(x)$.\n\nB. Impose $n\\cdot\\big(\\varepsilon_e(0)\\,N_e(0,t)\\big) = 0$ and $n\\cdot i_e(0,t) = 0$. Interpretation: the salt molar flux is weighted by the local porosity at the boundary so that a lower pore volume reduces the allowed flux.\n\nC. Impose $n\\cdot \\nabla\\big(\\varepsilon_e(x)\\,c_e(x,t)\\big)\\big|_{x=0} = 0$ and $n\\cdot i_e(0,t) = 0$. Interpretation: the gradient of stored salt per unit electrode volume vanishes at the boundary to compensate for porosity variation.\n\nD. Impose $c_e(0,t) = c_e^{\\mathrm{ref}}$ and $n\\cdot i_e(0,t) = 0$, for a constant $c_e^{\\mathrm{ref}}$. Interpretation: the salt concentration is clamped at the current collector to prevent changes caused by porosity gradients while blocking ionic current.",
            "solution": "The user has requested an analysis and solution to a problem concerning boundary conditions in a porous electrode model.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   **Domain:** One-dimensional porous negative electrode, $x \\in [0, L]$.\n*   **Boundaries:** Metal current collector at $x = 0$, separator at $x = L$.\n*   **Material Property:** Spatially varying pore-phase porosity, $\\varepsilon_e(x)$.\n*   **Governing Law (Salt Conservation):** $\\frac{\\partial}{\\partial t}\\big(\\varepsilon_e(x)\\,c_e(x,t)\\big) + \\frac{\\partial}{\\partial x} N_e(x,t) = R_e(x,t)$.\n    *   $c_e(x,t)$: Molar concentration of electrolyte salt.\n    *   $N_e(x,t)$: Macroscopic molar flux of salt.\n    *   $R_e(x,t)$: Volumetric source term due to electrochemical reactions.\n*   **Constitutive Law (Salt Flux):** $N_e(x,t) = - D_e^{\\mathrm{eff}}(x)\\,\\frac{\\partial c_e}{\\partial x}(x,t)$.\n    *   $D_e^{\\mathrm{eff}}(x) = D_e\\,\\varepsilon_e(x)^\\beta$, where $D_e  0$ and $\\beta  0$ are constants.\n*   **Governing Law (Charge Conservation):** $\\frac{\\partial i_e}{\\partial x}(x,t) = a_s(x)\\,F\\,j(x,t)$.\n    *   $i_e(x,t)$: Electrolyte ionic current density.\n    *   $a_s(x)$: Active surface area per unit electrode volume.\n    *   $F$: Faraday constant.\n    *   $j(x,t)$: Interfacial reaction current density.\n*   **Physical Conditions at $x=0$:**\n    1.  The metal current collector is perfectly impermeable to the electrolyte.\n    2.  The metal current collector does not directly participate in electrolyte-phase charge transport.\n*   **Objective:** Identify the correct boundary-condition pair at $x=0$ that correctly enforces the physical conditions, particularly in the presence of graded porosity $\\varepsilon_e(x)$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem statement describes a standard one-dimensional porous electrode model, often referred to as a Doyle-Fuller-Newman (DFN) type model.\n\n*   **Scientifically Grounded:** The governing equations are based on fundamental conservation laws (mass and charge) and well-established constitutive relations (Fick's law with a tortuosity correction like the Bruggeman relation). This framework is the cornerstone of modern battery modeling and simulation. The problem is scientifically sound.\n*   **Well-Posed:** The problem asks for the physically correct boundary conditions required to make the overall partial differential equation (PDE) system well-posed. This is a standard and meaningful question in mathematical physics and engineering. The question itself is unambiguous.\n*   **Objective:** The problem is described using precise, objective, and formal mathematical language. There are no subjective or opinion-based statements.\n\nThe problem does not exhibit any of the listed flaws. It is a valid, well-formulated problem in the field of electrochemical engineering and applied mathematics.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. A solution will be derived.\n\n### Derivation and Option Analysis\n\nThe task is to determine the appropriate boundary conditions at the interface between the porous electrode and the metal current collector, located at $x=0$. These conditions must be derived from the stated physical principles.\n\n**Principle-Based Derivation**\n\n1.  **Impermeability to Electrolyte Species:** The problem states that the \"metal current collector at $x=0$ is perfectly impermeable to the electrolyte.\" This means that no salt species can physically pass through the boundary at $x=0$. The physical quantity representing the rate of transport of salt species per unit area is the macroscopic molar flux, $N_e(x,t)$. An impermeable boundary is, by definition, a boundary with zero flux. Therefore, the flux of salt across the boundary at $x=0$ must be zero for all time $t$. In one dimension, this is expressed as:\n    $$ N_e(0,t) = 0 $$\n    The use of the outward unit normal $n$ in the options is a generalization for multi-dimensional problems. In our one-dimensional domain $[0, L]$, the outward normal at $x=0$ is a vector pointing in the $-x$ direction. The flux $N_e$ is the $x$-component of the flux vector. The flux *out of the domain* at $x=0$ is $-N_e(0,t)$. Setting this to zero gives $N_e(0,t)=0$. Thus, the condition $n \\cdot N_e(0,t) = 0$ correctly represents zero flux. This condition is fundamental to the physical nature of the boundary and must hold true regardless of the form of the porosity function $\\varepsilon_e(x)$.\n\n2.  **No Electrolyte-Phase Charge Transport:** The problem states the current collector \"does not directly participate in electrolyte-phase charge transport.\" This means it is a purely electronic conductor and an ionic insulator. No ionic current can flow from the electrolyte into the current collector. The quantity representing the flow of ionic charge per unit area is the electrolyte ionic current density, $i_e(x,t)$. Similar to the salt flux, the ionic current across the boundary at $x=0$ must be zero for all time $t$. This is expressed as:\n    $$ i_e(0,t) = 0 $$\n    Using the outward normal notation, this is $n \\cdot i_e(0,t) = 0$.\n\nCombining these two principles, the physically correct boundary conditions at $x=0$ are $N_e(0,t) = 0$ and $i_e(0,t) = 0$. These are both no-flux (or homogeneous Neumann) boundary conditions, one for mass transport and one for charge transport. The condition on $N_e$ specifically ensures that there is no artificial source or sink of salt at the boundary, thus preventing non-physical accumulation or depletion.\n\n**Option-by-Option Analysis**\n\nA. **Impose $n\\cdot N_e(0,t) = 0$ and $n\\cdot i_e(0,t) = 0$, where $n$ is the outward unit normal at $x=0$. Interpretation: the current collector is impermeable to electrolyte species and does not allow ionic current; therefore no macroscopic salt molar flux or ionic current crosses the boundary, regardless of $\\varepsilon_e(x)$.**\n\n*   **Analysis:** This option directly corresponds to the conditions derived from first principles. The mathematical statements $n\\cdot N_e(0,t) = 0$ (equivalent to $N_e(0,t)=0$) and $n\\cdot i_e(0,t) = 0$ (equivalent to $i_e(0,t)=0$) are the correct mathematical formulations of impermeability to salt and ions, respectively. The interpretation is physically precise and correctly states that this is a fundamental property of the boundary, independent of the porosity profile $\\varepsilon_e(x)$. This is the correct way to model an impermeable, ionically-insulating wall.\n*   **Verdict:** **Correct**\n\nB. **Impose $n\\cdot\\big(\\varepsilon_e(0)\\,N_e(0,t)\\big) = 0$ and $n\\cdot i_e(0,t) = 0$. Interpretation: the salt molar flux is weighted by the local porosity at the boundary so that a lower pore volume reduces the allowed flux.**\n\n*   **Analysis:** This condition, $\\varepsilon_e(0)\\,N_e(0,t) = 0$, is physically ill-conceived. The flux $N_e$ is the quantity that must be zero at an impermeable boundary. While this condition implies $N_e(0,t)=0$ if $\\varepsilon_e(0)  0$, it is not the correct fundamental statement. The quantity $\\varepsilon_e N_e$ does not represent a physical flux. Furthermore, the interpretation is flawed: the flux is not \"weighted\" or \"reduced\"; it is strictly zero. The physical boundary is the collector itself, which is impermeable regardless of the porosity of the material adjacent to it.\n*   **Verdict:** **Incorrect**\n\nC. **Impose $n\\cdot \\nabla\\big(\\varepsilon_e(x)\\,c_e(x,t)\\big)\\big|_{x=0} = 0$ and $n\\cdot i_e(0,t) = 0$. Interpretation: the gradient of stored salt per unit electrode volume vanishes at the boundary to compensate for porosity variation.**\n\n*   **Analysis:** This condition translates to $\\frac{\\partial}{\\partial x}\\left(\\varepsilon_e(x) c_e(x,t)\\right)\\Big|_{x=0} = 0$. By the product rule, this gives $\\frac{d\\varepsilon_e}{dx}(0)\\,c_e(0,t) + \\varepsilon_e(0)\\,\\frac{\\partial c_e}{\\partial x}(0,t) = 0$. The no-flux condition $N_e(0,t) = -D_e^{\\text{eff}}(0)\\frac{\\partial c_e}{\\partial x}(0,t) = 0$ requires $\\frac{\\partial c_e}{\\partial x}(0,t)=0$ (assuming $D_e^{\\text{eff}}(0) \\neq 0$). The condition in this option would then require $\\frac{d\\varepsilon_e}{dx}(0)\\,c_e(0,t) = 0$. This would only be equivalent to a no-flux condition if the porosity gradient at the boundary is zero, which contradicts the problem's premise of allowing for graded porosity with potentially steep gradients. If $\\frac{d\\varepsilon_e}{dx}(0) \\neq 0$, this condition would force a non-zero value for $\\frac{\\partial c_e}{\\partial x}(0,t)$, which in turn implies a non-zero flux $N_e(0,t) \\neq 0$. This directly violates the principle of impermeability.\n*   **Verdict:** **Incorrect**\n\nD. **Impose $c_e(0,t) = c_e^{\\mathrm{ref}}$ and $n\\cdot i_e(0,t) = 0$, for a constant $c_e^{\\mathrm{ref}}$. Interpretation: the salt concentration is clamped at the current collector to prevent changes caused by porosity gradients while blocking ionic current.**\n\n*   **Analysis:** This imposes a Dirichlet boundary condition on the concentration. Such a condition is appropriate for a boundary connected to an infinite reservoir that fixes the concentration. An impermeable solid wall is not a reservoir. Physically, the concentration at an impermeable wall is not fixed; it evolves based on the dynamics within the domain. Imposing a fixed concentration $c_e(0,t) = c_e^{\\mathrm{ref}}$ will generally create a concentration gradient at the boundary, leading to a non-zero flux $N_e(0,t) \\ne 0$, which again violates the physical principle of impermeability.\n*   **Verdict:** **Incorrect**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "The heart of any battery model lies in describing the electrochemical reaction rate, which is often a complex, non-linear function like the Butler-Volmer equation. This practice  demonstrates how to linearize this key relationship under small-overpotential conditions, a common and powerful technique in battery simulation. Mastering this approximation is essential for developing computationally tractable models suitable for gradient-based optimization algorithms.",
            "id": "3938760",
            "problem": "Consider a one-dimensional porous electrode of thickness $L$ immersed in a binary electrolyte, modeled under isothermal conditions at absolute temperature $T$. The ionic current in the electrolyte phase is governed by the conservation law\n$$\n-\\frac{d}{dx}\\!\\left(\\kappa_{\\mathrm{eff}}(\\phi(x))\\,\\frac{d\\psi}{dx}\\right) \\;=\\; a_{s}(\\phi(x))\\, j(\\eta(x)),\n$$\nwhere $x \\in [0,L]$ is the through-thickness coordinate, $\\psi(x)$ is the electrolyte potential, $\\phi(x)$ is the porosity (design field), $\\kappa_{\\mathrm{eff}}(\\phi)$ is the effective ionic conductivity, $a_{s}(\\phi)$ is the specific surface area, and $j(\\eta)$ is the interfacial reaction current density described by Butler–Volmer (BV) kinetics. The overpotential is defined by\n$$\n\\eta(x) \\;=\\; \\phi_{s} - \\psi(x) - U,\n$$\nwhere $\\phi_{s}$ is the electronically conducting phase potential (assumed uniform across the electrode) and $U$ is the open-circuit potential (treated as a constant with respect to $x$ in this setting). The BV kinetics are given by\n$$\nj(\\eta) \\;=\\; j_{0}\\!\\left[\\exp\\!\\left(\\alpha_{a}\\,\\frac{F\\,\\eta}{R\\,T}\\right) - \\exp\\!\\left(-\\alpha_{c}\\,\\frac{F\\,\\eta}{R\\,T}\\right)\\right],\n$$\nwhere $j_{0}  0$ is the exchange current density, $\\alpha_{a} \\in (0,1)$ and $\\alpha_{c} \\in (0,1)$ are the anodic and cathodic charge-transfer coefficients, $F$ is the Faraday constant, and $R$ is the universal gas constant. Assume a single-electron elementary step such that $\\alpha_{a} + \\alpha_{c} = 1$, with the symmetric case $\\alpha_{a} = \\alpha_{c} = \\tfrac{1}{2}$ being representative for many intercalation systems.\n\nIn automated battery design, we consider a Partial Differential Equation (PDE)-constrained optimization to determine a graded porosity architecture $\\phi(x)$ that minimizes the quadratic tracking functional\n$$\n\\mathcal{J}(\\phi,\\psi) \\;=\\; \\frac{1}{2}\\int_{0}^{L}\\!\\left(\\psi(x) - \\psi_{\\mathrm{tgt}}\\right)^{2}\\,dx \\;+\\; \\frac{\\beta}{2}\\int_{0}^{L}\\!\\left(\\frac{d\\phi}{dx}\\right)^{2}\\,dx,\n$$\nsubject to the state PDE above and suitable boundary conditions on $\\psi$, where $\\psi_{\\mathrm{tgt}}$ is a target potential profile and $\\beta  0$ is a regularization parameter.\n\nStarting from first principles and the BV relation provided, perform a first-order Taylor expansion of $j(\\eta)$ about $\\eta=0$ (small-overpotential regime), and obtain the linearized form of the interfacial current density expressed explicitly in terms of $F$, $R$, $T$, $j_{0}$, and $\\eta$. Then, using the structure of the Taylor remainder, articulate the quantitative condition on the magnitude of $|\\eta|$ relative to $R\\,T/F$ under which this linearization is accurate in the sense that the neglected terms are small compared to the retained term, and explain in the context of PDE-constrained optimization of graded porosity architectures why this linearization leads to a well-posed linear source term that is advantageous for sensitivity and adjoint-based design. Express the final linearized current density as a closed-form analytic expression. No numerical evaluation is required.",
            "solution": "We begin with the Butler–Volmer (BV) kinetics,\n$$\nj(\\eta) \\;=\\; j_{0}\\!\\left[\\exp\\!\\left(\\alpha_{a}\\,\\frac{F\\,\\eta}{R\\,T}\\right) - \\exp\\!\\left(-\\alpha_{c}\\,\\frac{F\\,\\eta}{R\\,T}\\right)\\right],\n$$\nand define the dimensionless small parameter\n$$\nx \\;=\\; \\frac{F\\,\\eta}{R\\,T}.\n$$\nFor small overpotentials, $|x| \\ll 1$, we apply the Taylor series expansions of the exponential function,\n$$\n\\exp(b\\,x) \\;=\\; 1 + b\\,x + \\frac{b^{2}\\,x^{2}}{2} + \\frac{b^{3}\\,x^{3}}{6} + \\cdots,\n$$\nand\n$$\n\\exp(-c\\,x) \\;=\\; 1 - c\\,x + \\frac{c^{2}\\,x^{2}}{2} - \\frac{c^{3}\\,x^{3}}{6} + \\cdots,\n$$\nwhere $b = \\alpha_{a}$ and $c = \\alpha_{c}$. Substituting these into the BV expression, we obtain\n\\begin{align*}\nj(\\eta)\n= j_{0}\\Bigg[\\left(1 + \\alpha_{a}\\,x + \\frac{\\alpha_{a}^{2}\\,x^{2}}{2} + \\frac{\\alpha_{a}^{3}\\,x^{3}}{6} + \\cdots\\right) - \\left(1 - \\alpha_{c}\\,x + \\frac{\\alpha_{c}^{2}\\,x^{2}}{2} - \\frac{\\alpha_{c}^{3}\\,x^{3}}{6} + \\cdots\\right)\\Bigg] \\\\\n= j_{0}\\Bigg[(\\alpha_{a} + \\alpha_{c})\\,x + \\frac{\\alpha_{a}^{2} - \\alpha_{c}^{2}}{2}\\,x^{2} + \\frac{\\alpha_{a}^{3} + \\alpha_{c}^{3}}{6}\\,x^{3} + \\cdots\\Bigg].\n\\end{align*}\nUsing the single-electron condition $\\alpha_{a} + \\alpha_{c} = 1$, the leading-order (linear) term reduces to\n$$\nj(\\eta) \\;\\approx\\; j_{0}\\,x \\;=\\; j_{0}\\,\\frac{F\\,\\eta}{R\\,T}.\n$$\nTherefore, the small-overpotential linearization yields the closed-form analytic expression\n$$\nj_{\\mathrm{lin}}(\\eta) \\;=\\; \\frac{F}{R\\,T}\\,j_{0}\\,\\eta.\n$$\n\nNext, we quantify the validity of this linearization by comparing the magnitude of the neglected terms to the retained linear term. The second-order term is\n$$\nj^{(2)}(\\eta) \\;=\\; j_{0}\\,\\frac{\\alpha_{a}^{2} - \\alpha_{c}^{2}}{2}\\,x^{2},\n$$\nand the third-order term is\n$$\nj^{(3)}(\\eta) \\;=\\; j_{0}\\,\\frac{\\alpha_{a}^{3} + \\alpha_{c}^{3}}{6}\\,x^{3}.\n$$\nThe relative error with respect to the linear term $j^{(1)}(\\eta) = j_{0}\\,x$ can be bounded, for small $|x|$, by the ratio of the first neglected term to $j^{(1)}(\\eta)$. Two important cases emerge:\n\n1. General case with $\\alpha_{a} + \\alpha_{c} = 1$ but $\\alpha_{a} \\neq \\alpha_{c}$: The leading correction is quadratic, and the relative error scales like\n$$\n\\left|\\frac{j^{(2)}(\\eta)}{j^{(1)}(\\eta)}\\right| \\;\\approx\\; \\left|\\frac{\\alpha_{a}^{2} - \\alpha_{c}^{2}}{2}\\right|\\,|x| \\;=\\; \\left|\\frac{\\alpha_{a} - \\alpha_{c}}{2}\\right|\\,(\\alpha_{a} + \\alpha_{c})\\,|x| \\;=\\; \\left|\\frac{\\alpha_{a} - \\alpha_{c}}{2}\\right|\\,|x|.\n$$\nThus, for a specified tolerance $\\delta \\in (0,1)$ on the relative error, a sufficient small-overpotential condition is\n$$\n|x| \\;\\ll\\; \\frac{2\\,\\delta}{|\\alpha_{a} - \\alpha_{c}|} \\quad \\Longleftrightarrow \\quad |\\eta| \\;\\ll\\; \\frac{2\\,\\delta}{|\\alpha_{a} - \\alpha_{c}|}\\,\\frac{R\\,T}{F}.\n$$\n\n2. Symmetric case with $\\alpha_{a} = \\alpha_{c} = \\tfrac{1}{2}$: The quadratic term cancels, and the leading correction is cubic. The relative error scales like\n$$\n\\left|\\frac{j^{(3)}(\\eta)}{j^{(1)}(\\eta)}\\right| \\;\\approx\\; \\frac{\\alpha_{a}^{3} + \\alpha_{c}^{3}}{6}\\,x^{2} \\;=\\; \\frac{2\\left(\\tfrac{1}{2}\\right)^{3}}{6}\\,x^{2} \\;=\\; \\frac{1}{24}\\,x^{2},\n$$\nso a tolerance $\\delta$ implies\n$$\n|x| \\;\\ll\\; \\sqrt{24\\,\\delta} \\quad \\Longleftrightarrow \\quad |\\eta| \\;\\ll\\; \\sqrt{24\\,\\delta}\\,\\frac{R\\,T}{F}.\n$$\n\nIn both cases, a fundamental scale for the overpotential is $R\\,T/F$, which characterizes the thermal voltage per electron. At room temperature, $R\\,T/F$ is on the order of $2.6 \\times 10^{-2}$ V, but we avoid numerical substitution here. The symmetric case is notably more forgiving because the absence of the quadratic correction enhances the range of validity of the linear approximation.\n\nFinally, in the PDE-constrained optimization of graded porosity architectures, replacing $j(\\eta)$ by $j_{\\mathrm{lin}}(\\eta)$ turns the source term in the state PDE into an affine function of the electrolyte potential $\\psi$:\n$$\n-\\frac{d}{dx}\\!\\left(\\kappa_{\\mathrm{eff}}(\\phi)\\,\\frac{d\\psi}{dx}\\right) \\;=\\; a_{s}(\\phi)\\,\\frac{F}{R\\,T}\\,j_{0}\\,\\big(\\phi_{s} - \\psi - U\\big),\n$$\nwhich is linear in $\\psi$ given $\\phi$, $j_{0}$, and $\\phi_{s} - U$. This linear structure typically yields a well-posed, coercive elliptic operator and facilitates the derivation of adjoint equations and sensitivity expressions with respect to $\\phi(x)$, streamlining gradient-based optimization algorithms. The validity conditions above ensure that designs remain in regimes where the linearization is accurate: graded architectures that keep local $|\\eta(x)|$ sufficiently below the thermal scale $R\\,T/F$ (as quantified by $\\delta$ and the charge-transfer symmetry) allow reliable use of this linearized kinetic model for computing sensitivities and performing optimization.",
            "answer": "$$\\boxed{\\frac{F}{R\\,T}\\,j_{0}\\,\\eta}$$"
        },
        {
            "introduction": "This final practice  moves from theory to application, challenging you to build a complete numerical tool for electrode design. You will implement and compare two popular methods for parameterizing graded architectures—the sharp-interface level-set method and the smooth-interface density method. By writing the code to solve the governing PDEs and search for an optimal design, you will gain invaluable hands-on experience in the practical workflow of PDE-constrained optimization.",
            "id": "3938778",
            "problem": "You are to implement and compare two architecture control methods—level-set and density—for a one-dimensional electrode under Partial Differential Equation (PDE) constraints. The goal is to quantify which approach better balances electronic and ionic transport pathways while controlling reaction localization.\n\nFundamental base and governing laws:\n- Use charge conservation in steady state and Ohm’s law. In one spatial dimension, for electronic and ionic phases respectively:\n  - Electronic conservation: $\\frac{d}{dx} i_{s}(x) + j(x) = 0$ with $i_{s}(x) = -\\sigma \\frac{d \\phi_{s}}{dx}$.\n  - Ionic conservation: $\\frac{d}{dx} i_{e}(x) - j(x) = 0$ with $i_{e}(x) = -\\kappa \\frac{d \\phi_{e}}{dx}$.\n- With uniform conductivities $\\sigma$ and $\\kappa$, the coupled PDEs become:\n  - $\\sigma \\frac{d^{2} \\phi_{s}}{dx^{2}} + j(x) = 0$,\n  - $\\kappa \\frac{d^{2} \\phi_{e}}{dx^{2}} - j(x) = 0$.\n- The reaction current density uses a linearized Butler–Volmer relation:\n  - $j(x) = k \\, a(x) \\left(\\phi_{s}(x) - \\phi_{e}(x) - U\\right)$,\n  where $k$ is a reaction coefficient, $a(x)$ is an architecture-controlled active area density, and $U$ is the open-circuit potential. For this problem, set $U = 0$.\n\nGeometry and boundary conditions:\n- Consider a dimensionless electrode thickness of $L = 1$, with coordinate $x \\in [0,1]$.\n- Boundary conditions for electronic potential:\n  - Dirichlet at the current collector: $\\phi_{s}(0) = \\Phi_{\\text{app}}$,\n  - Neumann at the separator: $\\frac{d \\phi_{s}}{dx}\\big|_{x=1} = 0$.\n- Boundary conditions for ionic potential:\n  - Neumann at the current collector: $\\frac{d \\phi_{e}}{dx}\\big|_{x=0} = 0$,\n  - Dirichlet at the separator: $\\phi_{e}(1) = 0$.\n\nArchitecture control methods:\n- Level-set method:\n  - Parameterize by an interface location $s \\in [0,1]$ and define the raw area density by a Heaviside function:\n    - $\\bar{a}_{\\text{LS}}(x; s) = \\mathcal{H}(x - s)$, where $\\mathcal{H}$ is the Heaviside step function.\n- Density method:\n  - Parameterize by a center $s \\in [0,1]$ and a smoothness width $w  0$ using a logistic function:\n    - $\\bar{a}_{\\text{DM}}(x; s, w) = \\left(1 + \\exp\\left(-\\frac{x - s}{w}\\right)\\right)^{-1}$.\n- Normalize the area density in both methods to a fixed total area fraction $f$:\n  - Choose a scaling $c$ such that $\\int_{0}^{1} c \\, \\bar{a}(x)\\, dx = f$, and set $a(x) = c\\, \\bar{a}(x)$.\n  - Use $f = 0.5$.\n\nBalance and localization metrics:\n- Define electronic and ionic dissipation:\n  - $D_{s} = \\int_{0}^{1} \\sigma \\left(\\frac{d \\phi_{s}}{dx}\\right)^{2} dx$,\n  - $D_{e} = \\int_{0}^{1} \\kappa \\left(\\frac{d \\phi_{e}}{dx}\\right)^{2} dx$.\n- Define reaction localization around a specified target location $x_{0}$ by a normalized second moment:\n  - $M = \\frac{\\int_{0}^{1} (x - x_{0})^{2}\\, |j(x)|\\, dx}{\\int_{0}^{1} |j(x)|\\, dx}$.\n- Define a composite objective for a given $s$:\n  - $J(s) = \\alpha \\, |D_{s} - D_{e}| + \\beta \\, M$,\n  where $\\alpha  0$ and $\\beta  0$ are weights.\n\nNumerical discretization:\n- Discretize the domain with $N$ grid points and uniform spacing $\\Delta x = \\frac{L}{N-1}$.\n- Use second-order central differences for $\\frac{d^{2}\\phi}{dx^{2}}$ and first-order differences for boundary Neumann conditions.\n- Solve the resulting linear system for $\\phi_{s}$ and $\\phi_{e}$ by assembling a $2N \\times 2N$ block matrix for the coupled equations and applying the boundary conditions.\n- Use $N = 80$.\n- Use constants $\\sigma = 100$, $\\kappa = 1$, $k = 10$, and $\\Phi_{\\text{app}} = 1$.\n\nOptimization and comparison:\n- For each method, perform a grid search over $s \\in [0,1]$ with $101$ uniformly spaced samples, excluding choices that produce a vanishing total area (i.e., ensure $\\int a(x) dx  0$).\n- For the density method, the smoothness width $w$ is given per test case.\n- Compute the minimal composite objective $J_{\\text{LS}}^{*}$ and $J_{\\text{DM}}^{*}$ for the level-set and density methods, respectively, and compare them:\n  - If $J_{\\text{LS}}^{*}  J_{\\text{DM}}^{*} - \\varepsilon$, output $1$,\n  - If $J_{\\text{DM}}^{*}  J_{\\text{LS}}^{*} - \\varepsilon$, output $0$,\n  - Otherwise (difference within tolerance), output $2$,\n  where $\\varepsilon = 10^{-8}$.\n\nUnits and outputs:\n- All quantities are dimensionless. No physical units are required.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_{1},r_{2},r_{3}]$), following the numeric encoding described above.\n\nTest suite (each test case is a tuple $(x_{0}, \\alpha, \\beta, w)$):\n- Case $1$: $(0.50, 1.0, 1.0, 0.10)$, a balanced weighting with mid-electrode target.\n- Case $2$: $(0.10, 1.5, 0.8, 0.02)$, target near current collector and sharper density.\n- Case $3$: $(0.90, 0.5, 2.0, 0.05)$, target near separator with strong localization emphasis.\n- Case $4$: $(0.50, 3.0, 0.3, 0.10)$, strong balance emphasis centrally.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for all four cases as a comma-separated list enclosed in square brackets, in the order of the test cases, for example $[r_{1},r_{2},r_{3},r_{4}]$.",
            "solution": "The problem is valid. It presents a well-posed, scientifically grounded task in computational materials science, specifically the PDE-constrained optimization of battery electrode architecture. All parameters, equations, and boundary conditions are specified, allowing for a unique numerical solution. The problem is free of contradictions, ambiguities, and factual errors.\n\nThe solution proceeds by first discretizing the governing partial differential equations (PDEs) using a finite difference method (FDM), converting the system into a set of linear algebraic equations. Then, for each of the two architecture control methods (level-set and density), a grid search is performed over the control parameter $s$ to find the architecture that minimizes a composite objective function $J(s)$.\n\n### 1. Governing Equations and Discretization\n\nThe steady-state behavior of the electrode is described by two coupled second-order ordinary differential equations for the electronic potential $\\phi_s(x)$ and ionic potential $\\phi_e(x)$ over a one-dimensional domain $x \\in [0, 1]$. With the open-circuit potential $U=0$, the reaction current density is $j(x) = k \\, a(x) (\\phi_s(x) - \\phi_e(x))$. Substituting this into the charge conservation equations yields:\n$$ \\sigma \\frac{d^{2} \\phi_{s}}{dx^{2}} + k \\, a(x) (\\phi_{s}(x) - \\phi_{e}(x)) = 0 $$\n$$ \\kappa \\frac{d^{2} \\phi_{e}}{dx^{2}} - k \\, a(x) (\\phi_{s}(x) - \\phi_{e}(x)) = 0 $$\n\nThe domain $x \\in [0,1]$ is discretized into $N=80$ grid points $x_i = i \\Delta x$ for $i_index \\in \\{0, 1, \\dots, N-1\\}$, where the grid spacing is $\\Delta x = 1 / (N-1)$. The potentials at these points are denoted $\\phi_{s,i} = \\phi_s(x_i)$ and $\\phi_{e,i} = \\phi_e(x_i)$.\n\nWe use a second-order central difference scheme for the second derivatives at interior grid points ($i \\in \\{1, \\dots, N-2\\}$):\n$$ \\left(\\frac{d^2\\phi}{dx^2}\\right)_i \\approx \\frac{\\phi_{i+1} - 2\\phi_i + \\phi_{i-1}}{\\Delta x^2} $$\n\nFor the Neumann boundary conditions, we use a second-order accurate stencil derived from a ghost point method, which is consistent with the problem's hint to use first-order differences to derive the boundary stencil.\n- At $x=1$ ($i=N-1$), $\\frac{d\\phi_s}{dx}|_{x=1}=0$. The stencil for the second derivative becomes $\\left(\\frac{d^2\\phi_s}{dx^2}\\right)_{N-1} \\approx \\frac{2\\phi_{s,N-2} - 2\\phi_{s,N-1}}{\\Delta x^2}$.\n- At $x=0$ ($i=0$), $\\frac{d\\phi_e}{dx}|_{x=0}=0$. The stencil is $\\left(\\frac{d^2\\phi_e}{dx^2}\\right)_{0} \\approx \\frac{2\\phi_{e,1} - 2\\phi_{e,0}}{\\Delta x^2}$.\n\nThe Dirichlet boundary conditions are $\\phi_s(0) = \\Phi_{\\text{app}}$ and $\\phi_e(1)=0$.\n\n### 2. Linear System Formulation\n\nThis discretization leads to a $2N \\times 2N$ linear system of the form $A\\mathbf{\\Phi} = \\mathbf{b}$, where $\\mathbf{\\Phi} = [\\phi_{s,0}, \\dots, \\phi_{s,N-1}, \\phi_{e,0}, \\dots, \\phi_{e,N-1}]^T$ is the vector of unknown potentials. The matrix $A$ and vector $\\mathbf{b}$ are constructed row by row.\n\n- **For $\\phi_s$ (rows $0$ to $N-1$):**\n  - Row $0$ (BC at $x=0$): $\\phi_{s,0} = \\Phi_{\\text{app}}$.\n  - Rows $i \\in \\{1, \\dots, N-2\\}$ (interior): $\\sigma \\frac{\\phi_{s,i+1} - 2\\phi_{s,i} + \\phi_{s,i-1}}{\\Delta x^2} + k a_i (\\phi_{s,i} - \\phi_{e,i}) = 0$.\n  - Row $N-1$ (BC at $x=1$): $\\sigma \\frac{2\\phi_{s,N-2} - 2\\phi_{s,N-1}}{\\Delta x^2} + k a_{N-1} (\\phi_{s,N-1} - \\phi_{e,N-1}) = 0$.\n\n- **For $\\phi_e$ (rows $N$ to $2N-1$):**\n  - Row $N$ (BC at $x=0$): $\\kappa \\frac{2\\phi_{e,1} - 2\\phi_{e,0}}{\\Delta x^2} - k a_0 (\\phi_{s,0} - \\phi_{e,0}) = 0$.\n  - Rows $N+i$ for $i \\in \\{1, \\dots, N-2\\}$ (interior): $\\kappa \\frac{\\phi_{e,i+1} - 2\\phi_{e,i} + \\phi_{e,i-1}}{\\Delta x^2} - k a_i (\\phi_{s,i} - \\phi_{e,i}) = 0$.\n  - Row $2N-1$ (BC at $x=1$): $\\phi_{e,N-1} = 0$.\n\nThis sparse linear system is solved for $\\mathbf{\\Phi}$ for a given active area distribution $a(x)$.\n\n### 3. Architecture Control and Normalization\n\nThe active area density $a(x)$ is defined based on a raw density $\\bar{a}(x)$ and normalized to a total area fraction $f=0.5$. The scaling constant $c$ is determined by $c = f / \\int_{0}^{1} \\bar{a}(x) \\, dx$, so $a(x) = c \\bar{a}(x)$. The integral is computed numerically using the trapezoidal rule.\n\n- **Level-Set (LS) Method:** The raw density is $\\bar{a}_{\\text{LS}}(x; s) = \\mathcal{H}(x-s)$, where $\\mathcal{H}$ is the Heaviside step function. For a discrete grid, we define $\\bar{a}_{\\text{LS}}(x_i; s) = 1$ if $x_i  s$ and $0$ otherwise. The integral base is $\\int_0^1 \\bar{a}_{\\text{LS}}(x;s) dx \\approx 1-s$. The case $s=1$ yields a vanishing area and is excluded from the search.\n- **Density Method (DM):** The raw density is given by a logistic function, $\\bar{a}_{\\text{DM}}(x; s, w) = (1 + \\exp(-\\frac{x-s}{w}))^{-1}$. This function provides a smooth transition from $0$ to $1$ around the center $s$ with a width controlled by $w$. Its integral is always positive for $w0$.\n\n### 4. Objective Function Calculation\n\nAfter solving for the potential profiles $\\phi_s$ and $\\phi_e$, the components of the objective function $J(s) = \\alpha |D_s - D_e| + \\beta M$ are calculated numerically.\n\n- **Dissipation ($D_s, D_e$):** The derivatives $\\frac{d\\phi_s}{dx}$ and $\\frac{d\\phi_e}{dx}$ are computed using second-order central differences for interior points and first-order one-sided differences at the boundaries. The dissipation integrals $D_s = \\int_{0}^{1} \\sigma (\\frac{d\\phi_s}{dx})^2 dx$ and $D_e = \\int_{0}^{1} \\kappa (\\frac{d\\phi_e}{dx})^2 dx$ are then evaluated using the trapezoidal rule.\n- **Reaction Localization ($M$):** The reaction current density $j(x)$ is calculated at each grid point. The localization metric $M = \\frac{\\int_{0}^{1} (x - x_{0})^{2}\\, |j(x)|\\, dx}{\\int_{0}^{1} |j(x)|\\, dx}$ is computed by evaluating the numerator and denominator integrals using the trapezoidal rule.\n\n### 5. Optimization and Comparison\n\nFor each test case, a grid search is conducted over $s \\in [0,1]$ using $101$ uniformly spaced samples. For each $s$, the objective function $J(s)$ is evaluated for both the LS and DM methods. The minimum values found, $J_{\\text{LS}}^{*}$ and $J_{\\text{DM}}^{*}$, are then compared. The final output is determined by the following logic, with a tolerance of $\\varepsilon = 10^{-8}$:\n- $1$ if $J_{\\text{LS}}^{*}  J_{\\text{DM}}^{*} - \\varepsilon$ (Level-Set is better).\n- $0$ if $J_{\\text{DM}}^{*}  J_{\\text{LS}}^{*} - \\varepsilon$ (Density Method is better).\n- $2$ if the difference is within the tolerance (performance is equivalent).\nThis procedure is repeated for each of the four test cases provided.",
            "answer": "```python\nimport numpy as np\n\ndef solve_pde(a, N, dx, sigma, kappa, k, Phi_app):\n    \"\"\"\n    Assembles and solves the 2N x 2N linear system for potentials.\n    \"\"\"\n    A = np.zeros((2 * N, 2 * N))\n    b = np.zeros(2 * N)\n    dx2 = dx**2\n\n    # --- Matrix Assembly ---\n\n    # Row 0: phi_s(0) = Phi_app\n    A[0, 0] = 1.0\n    b[0] = Phi_app\n\n    # Rows 1 to N-2: phi_s interior points\n    for i in range(1, N - 1):\n        A[i, i - 1] = sigma\n        A[i, i] = -2.0 * sigma + k * a[i] * dx2\n        A[i, i + 1] = sigma\n        A[i, N + i] = -k * a[i] * dx2\n    \n    # Row N-1: d(phi_s)/dx at x=L (Neumann)\n    A[N - 1, N - 2] = 2.0 * sigma\n    A[N - 1, N - 1] = -2.0 * sigma + k * a[N - 1] * dx2\n    A[N - 1, 2 * N - 1] = -k * a[N - 1] * dx2\n\n    # Row N: d(phi_e)/dx at x=0 (Neumann)\n    A[N, 0] = -k * a[0] * dx2\n    A[N, N] = -2.0 * kappa + k * a[0] * dx2\n    A[N, N + 1] = 2.0 * kappa\n\n    # Rows N+1 to 2N-2: phi_e interior points\n    for i in range(1, N - 1):\n        idx = N + i\n        A[idx, i] = -k * a[i] * dx2\n        A[idx, idx - 1] = kappa\n        A[idx, idx] = -2.0 * kappa + k * a[i] * dx2\n        A[idx, idx + 1] = kappa\n\n    # Row 2N-1: phi_e(L) = 0\n    A[2 * N - 1, 2 * N - 1] = 1.0\n    b[2 * N - 1] = 0.0\n\n    phi_vec = np.linalg.solve(A, b)\n    phi_s = phi_vec[:N]\n    phi_e = phi_vec[N:]\n\n    return phi_s, phi_e\n\ndef calculate_objective(phi_s, phi_e, a, x, x0, alpha, beta, sigma, kappa, k):\n    \"\"\"\n    Calculates the composite objective function J.\n    \"\"\"\n    # Reaction current density\n    j = k * a * (phi_s - phi_e)\n    \n    # Dissipation calculation\n    dphids_dx = np.gradient(phi_s, x)\n    dphide_dx = np.gradient(phi_e, x)\n    \n    Ds = np.trapz(sigma * dphids_dx**2, x)\n    De = np.trapz(kappa * dphide_dx**2, x)\n    \n    # Localization metric M\n    abs_j = np.abs(j)\n    M_num = np.trapz((x - x0)**2 * abs_j, x)\n    M_den = np.trapz(abs_j, x)\n    \n    M = M_num / M_den if M_den  1e-12 else 0.0\n\n    # Composite objective J\n    J = alpha * np.abs(Ds - De) + beta * M\n    return J\n\ndef find_optimal_J(method, params, constants):\n    \"\"\"\n    Performs a grid search over s to find the minimum objective J*.\n    \"\"\"\n    x0, alpha, beta, w = params\n    N, L, sigma, kappa, k, Phi_app, f, s_samples = constants\n    \n    x = np.linspace(0, L, N)\n    dx = L / (N - 1)\n\n    J_values = []\n    \n    for s in s_samples:\n        # 1. Define architecture a(x)\n        if method == 'LS':\n            a_bar = (x  s).astype(float)\n        elif method == 'DM':\n            a_bar = 1.0 / (1.0 + np.exp(-(x - s) / w))\n        else:\n            raise ValueError(\"Unknown method\")\n\n        integral_a_bar = np.trapz(a_bar, x)\n\n        if integral_a_bar  1e-9: # Avoid division by zero for vanishing area\n            continue\n        \n        c = f / integral_a_bar\n        a = c * a_bar\n\n        # 2. Solve PDEs\n        phi_s, phi_e = solve_pde(a, N, dx, sigma, kappa, k, Phi_app)\n\n        # 3. Calculate objective\n        J = calculate_objective(phi_s, phi_e, a, x, x0, alpha, beta, sigma, kappa, k)\n        J_values.append(J)\n        \n    return min(J_values) if J_values else float('inf')\n\n\ndef solve():\n    # Define problem constants\n    N = 80\n    L = 1.0\n    sigma = 100.0\n    kappa = 1.0\n    k = 10.0\n    Phi_app = 1.0\n    f = 0.5\n    s_samples = np.linspace(0, 1, 101)\n    epsilon = 1e-8\n    \n    constants = (N, L, sigma, kappa, k, Phi_app, f, s_samples)\n    \n    # Define test cases: (x0, alpha, beta, w)\n    test_cases = [\n        (0.50, 1.0, 1.0, 0.10),\n        (0.10, 1.5, 0.8, 0.02),\n        (0.90, 0.5, 2.0, 0.05),\n        (0.50, 3.0, 0.3, 0.10),\n    ]\n\n    results = []\n    for params in test_cases:\n        J_ls_star = find_optimal_J('LS', params, constants)\n        J_dm_star = find_optimal_J('DM', params, constants)\n\n        if J_ls_star  J_dm_star - epsilon:\n            results.append(1)\n        elif J_dm_star  J_ls_star - epsilon:\n            results.append(0)\n        else:\n            results.append(2)\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}