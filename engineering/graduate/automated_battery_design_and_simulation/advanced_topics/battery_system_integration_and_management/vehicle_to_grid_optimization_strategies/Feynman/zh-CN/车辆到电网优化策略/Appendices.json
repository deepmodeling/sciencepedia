{
    "hands_on_practices": [
        {
            "introduction": "我们从V2G中最基本的问题开始：一辆电动汽车究竟能向电网输送多少能量，持续多长时间？这个实践练习聚焦于能量守恒的核心原理，并考虑了能量转换过程中的效率损失。掌握这项基本计算是制定任何可行V2G策略的第一步，它构成了后续更复杂优化模型的基础。",
            "id": "3959539",
            "problem": "一辆参与车辆到电网（Vehicle-to-Grid, V2G）出口的电动汽车（Electric Vehicle, EV），通过一个双向功率转换器连接到电网，其在放电模式下的转换效率为恒定的 $\\eta$。该车载电池的可用能量容量为 $E_{\\text{cap}}$，其在一个荷电状态（State of Charge, SoC）窗口 $\\text{SoC} \\in [\\text{SoC}_{\\min}, \\text{SoC}_{\\max}]$ 内运行，其中荷电状态（SoC）定义为电池中瞬时存储的直流能量 $E_{\\text{dc}}(t)$ 与其可用容量 $E_{\\text{cap}}$ 的比值，即 $\\text{SoC}(t) = E_{\\text{dc}}(t)/E_{\\text{cap}}$。向电网出口的交流（Alternating Current, AC）功率用 $P$ 表示，其上限为 $P_{\\max}$。假设放电损耗完全由转换器效率来体现，并且电池的转换和效率在整个工作范围内是恒定的。放电过程是准稳态的，因此在转换的相应侧，功率和能量的关系为 $P = \\mathrm{d}E/\\mathrm{d}t$。从 $\\text{SoC}(0) = 0.8$ 开始，该电动汽车以恒定的交流功率 $P = 6\\ \\text{kW}$ 进行出口，其中 $P_{\\max} = 7\\ \\text{kW}$，转换器效率 $\\eta = 0.94$，允许的SoC窗口为 $\\text{SoC} \\in [0.2, 0.9]$，电池可用容量为 $E_{\\text{cap}} = 60\\ \\text{kWh}$。计算在满足 $\\text{SoC}(t) \\ge 0.2$ 和 $P \\le P_{\\max}$ 的条件下，持续出口直至达到SoC下限的最长持续时间。答案以小时为单位表示，并将最终数值四舍五入至四位有效数字。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   放电模式下的转换器效率：$\\eta$\n-   电池可用能量容量：$E_{\\text{cap}}$\n-   荷电状态（SoC）窗口：$\\text{SoC} \\in [\\text{SoC}_{\\min}, \\text{SoC}_{\\max}]$\n-   SoC定义：$\\text{SoC}(t) = E_{\\text{dc}}(t)/E_{\\text{cap}}$\n-   瞬时存储的直流能量：$E_{\\text{dc}}(t)$\n-   交流出口功率：$P$\n-   最大交流出口功率：$P_{\\max}$\n-   初始SoC：$\\text{SoC}(0) = 0.8$\n-   出口功率值：$P = 6\\ \\text{kW}$\n-   最大功率值：$P_{\\max} = 7\\ \\text{kW}$\n-   效率值：$\\eta = 0.94$\n-   允许的SoC窗口值：$[\\text{SoC}_{\\min}, \\text{SoC}_{\\max}] = [0.2, 0.9]$\n-   电池容量值：$E_{\\text{cap}} = 60\\ \\text{kWh}$\n-   假设：放电是一个准稳态过程，其中 $P = \\mathrm{d}E/\\mathrm{d}t$。\n-   假设：效率 $\\eta$ 是恒定的。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题基于能量守恒和电能转换的基本原理，使用了一个标准的电池系统简化模型。给定的数值对于现代电动汽车是物理上现实的。\n-   **适定性**：该问题是适定的，提供了计算唯一解（持续时间）所需的所有必要数据（初始状态、最终状态、过程参数）。\n-   **客观性**：问题陈述使用了精确、客观和定量的语言。\n-   **不完整或矛盾的设置**：该问题是自洽的。初始条件 $\\text{SoC}(0) = 0.8$ 在允许的窗口 $[0.2, 0.9]$ 内。工作功率 $P = 6\\ \\text{kW}$ 低于允许的最大功率 $P_{\\max} = 7\\ \\text{kW}$。设置是一致的。\n\n**步骤3：结论与行动**\n该问题被认为是有效的。将提供解答。\n\n### 解题过程\n\n目标是计算电池的荷电状态（$\\text{SoC}$）从其初始值 $\\text{SoC}_0$ 下降到其允许的最小值 $\\text{SoC}_{\\min}$ 所需的总时间 $\\Delta t$，同时以恒定的交流功率 $P$ 进行出口。\n\n基本原理是能量守恒，应用于功率转换器。出口到电网的能量 $\\Delta E_{\\text{ac}}$ 与从电池提取的能量 $\\Delta E_{\\text{dc}}$ 通过转换器效率 $\\eta$ 相关联。\n\n在放电模式下，能量从电池（DC）流向电网（AC）。效率 $\\eta$ 是输出功率与输入功率的比值，对于准稳态过程，也等于输出能量与输入能量的比值。\n$$ \\eta = \\frac{P_{\\text{ac}}}{P_{\\text{dc}}} = \\frac{\\Delta E_{\\text{ac}}}{\\Delta E_{\\text{dc}}} $$\n从电池提取的总能量 $\\Delta E_{\\text{dc}}$ 对应于存储能量的变化。存储的能量 $E_{\\text{dc}}$ 通过SoC和可用容量 $E_{\\text{cap}}$ 定义为 $E_{\\text{dc}}(t) = \\text{SoC}(t) \\cdot E_{\\text{cap}}$。\n\n该过程从初始荷电状态 $\\text{SoC}(0) = \\text{SoC}_0 = 0.8$ 开始，当荷电状态达到下限 $\\text{SoC}_{\\min} = 0.2$ 时结束。令最终荷电状态为 $\\text{SoC}_f = 0.2$。从电池放电的总直流能量为：\n$$ \\Delta E_{\\text{dc}} = E_{\\text{dc, initial}} - E_{\\text{dc, final}} = \\text{SoC}_0 \\cdot E_{\\text{cap}} - \\text{SoC}_f \\cdot E_{\\text{cap}} $$\n$$ \\Delta E_{\\text{dc}} = (\\text{SoC}_0 - \\text{SoC}_f) E_{\\text{cap}} $$\n出口到电网的总交流能量是在持续时间 $\\Delta t$ 内以恒定功率 $P$ 输送的。假设这是一个准稳态过程，该能量由下式给出：\n$$ \\Delta E_{\\text{ac}} = P \\cdot \\Delta t $$\n将 $\\Delta E_{\\text{ac}}$ 和 $\\Delta E_{\\text{dc}}$ 的表达式代入效率方程：\n$$ \\eta = \\frac{P \\cdot \\Delta t}{(\\text{SoC}_0 - \\text{SoC}_f) E_{\\text{cap}}} $$\n这种关系是错误的。正确的能量流是电池（DC，输入）到电网（AC，输出）。因此，$\\eta = \\Delta E_{\\text{ac}} / \\Delta E_{\\text{dc}}$。从电池提取的DC能量 $\\Delta E_{\\text{dc}}$ 转换为AC能量 $\\Delta E_{\\text{ac}}$。\n\n正确的推导如下：\n从电池提取的DC功率为 $P_{\\text{dc}}$。输送到电网的AC功率为 $P$。\n$P = \\eta \\cdot P_{\\text{dc}}$\n因此，$P_{\\text{dc}} = P / \\eta$。\n\n电池能量以恒定DC功率 $P_{\\text{dc}}$ 减少。总持续时间 $\\Delta t$ 由可放电的总DC能量 $\\Delta E_{\\text{dc}}$ 除以该功率得到：\n$$ \\Delta t = \\frac{\\Delta E_{\\text{dc}}}{P_{\\text{dc}}} = \\frac{(\\text{SoC}_0 - \\text{SoC}_f) E_{\\text{cap}}}{P / \\eta} $$\n$$ \\Delta t = \\frac{\\eta \\cdot (\\text{SoC}_0 - \\text{SoC}_f) E_{\\text{cap}}}{P} $$\n现在，我们将给定的数值代入此表达式：\n-   $\\eta = 0.94$\n-   $\\text{SoC}_0 = 0.8$\n-   $\\text{SoC}_f = \\text{SoC}_{\\min} = 0.2$\n-   $E_{\\text{cap}} = 60\\ \\text{kWh}$\n-   $P = 6\\ \\text{kW}$\n\n计算过程如下：\n$$ \\Delta t = \\frac{0.94 \\cdot (0.8 - 0.2) \\cdot 60\\ \\text{kWh}}{6\\ \\text{kW}} $$\n首先，计算SoC的变化量：\n$$ \\text{SoC}_0 - \\text{SoC}_f = 0.8 - 0.2 = 0.6 $$\n将此结果代回 $\\Delta t$ 的方程中：\n$$ \\Delta t = \\frac{0.94 \\cdot 0.6 \\cdot 60}{6}\\ \\text{h} $$\n单位 $\\text{kWh}/\\text{kW}$ 正确地得到小时（$\\text{h}$）。\n$$ \\Delta t = 0.94 \\cdot 0.6 \\cdot 10\\ \\text{h} $$\n$$ \\Delta t = 0.94 \\cdot 6\\ \\text{h} $$\n$$ \\Delta t = 5.64\\ \\text{h} $$\n问题要求最终答案四舍五入到四位有效数字。\n$$ \\Delta t = 5.640\\ \\text{h} $$\n这是在指定条件下持续出口的最长持续时间。",
            "answer": "$$\\boxed{5.640}$$"
        },
        {
            "introduction": "除了简单的能量容量，电池的性能还受到其内部电气动力学特性的制约。这个练习将深入探讨一个标准的Thevenin等效电路模型，帮助你理解在响应V2G调度指令时，电池的端电压和产热率是如何变化的。这些知识对于设计能够尊重电池物理极限、确保其健康和安全性的调度算法至关重要。",
            "id": "3959487",
            "problem": "一个聚合商正在使用自动化电池设计和仿真环境，为车辆到电网 (V2G) 的电能交换设计一种快速时间尺度的控制方案。为确保调度优化器遵守电气和热力学限制，该聚合商使用一个单支路 Thevenin 等效电路模型对每个电动汽车电池包进行建模，该模型包括一个开路电压源、一个串联欧姆电阻和一个并联的电阻-电容极化支路。Thevenin 模型参数如下：串联欧姆电阻为 $R_{0}=50\\ \\text{m}\\Omega$，极化电容为 $C_{1}=2000\\ \\text{F}$，极化时间常数为 $\\tau_{1}=200\\ \\text{s}$，开路电压为 $E(\\text{SoC})=400\\ \\text{V}$，并且在短时暂态过程中可视为常数，因为电荷状态没有明显变化。在时间 $t=0$ 时，电网运营商发出一个大小为 $i=15\\ \\text{A}$ 的放电电流阶跃指令（放电为正），该电流在 $t \\ge 0$ 期间保持恒定。在 $t=0$ 之前，电池已长时间处于开路静置状态，因此极化支路完全弛豫，初始极化电压为零。\n\n仅使用 Kirchhoff 定律、电容器本构关系 $i_{C}=C\\,dv/dt$ 和 Ohm 定律 $v=Ri$，并假设 $E(\\text{SoC})$ 在此时间尺度上为常数且与温度无关，从而忽略可逆（熵）热，请从第一性原理推导以下内容的闭式表达式：\n- $t \\ge 0$ 时的端电压暂态 $V(t)$，以及\n- 由串联欧姆电阻和极化电阻中的焦耳热引起的瞬时产热率 $\\dot{Q}(t)$。\n\n假设采用标准的 Thevenin 单电阻-单电容结构，其中端电压等于开路电压源减去串联欧姆压降再减去电阻-电容支路上的极化电压。极化支路中的电阻表示为 $R_{1}$，并满足 $R_{1}C_{1}=\\tau_{1}$。\n\n将您的最终表达式以单行矩阵的形式给出，其中第一个条目等于 $V(t)$，第二个条目等于 $\\dot{Q}(t)$，两者对所有 $t \\ge 0$ 均有效。将 $V(t)$ 以伏特 (V) 表示，$\\dot{Q}(t)$ 以瓦特 (W) 表示。无需进行数值四舍五入；请使用给定的参数值，给出以 $t$ 表示的精确闭式表达式。",
            "solution": "该问题是有效的，因为它在科学上基于标准电路理论，问题设定良好，数据充分，目标明确，并且没有矛盾或含糊之处。我们开始推导。\n\n电池由一个单支路 Thevenin 等效电路建模。它由一个恒定的开路电压源 $E$、一个串联欧姆电阻 $R_0$ 和一个包含极化电阻 $R_1$ 与极化电容 $C_1$ 的并联支路组成。对于时间 $t \\ge 0$，从端子流出一个恒定的放电电流 $i$。\n\n端电压 $V(t)$ 由开路电压减去串联电阻和极化支路上的电压降给出：\n$$V(t) = E - V_0(t) - V_1(t)$$\n其中 $V_0(t)$ 是 $R_0$ 上的电压降，$V_1(t)$ 是并联的 $R_1C_1$ 支路上的电压。\n\n串联欧姆电阻 $R_0$ 上的电压降由 Ohm 定律给出：\n$$V_0(t) = i R_0$$\n由于电流 $i$ 在 $t \\ge 0$ 时为 $15 \\text{ A}$ 的恒定阶跃，因此 $V_0(t)$ 在 $t \\ge 0$ 时也为常数。\n\n总电流 $i$ 流入极化支路，并分为流过电阻的电流 $i_{R1}(t)$ 和流过电容的电流 $i_{C1}(t)$。根据 Kirchhoff 电流定律 (KCL)：\n$$i = i_{R1}(t) + i_{C1}(t)$$\n流过电阻 $R_1$ 的电流为 $i_{R1}(t) = V_1(t) / R_1$，流过电容 $C_1$ 的电流为 $i_{C1}(t) = C_1 \\frac{dV_1(t)}{dt}$。将这些代入 KCL 方程，得到一个关于极化电压 $V_1(t)$ 的一阶线性常微分方程：\n$$i = \\frac{V_1(t)}{R_1} + C_1 \\frac{dV_1(t)}{dt}$$\n将其整理成标准形式：\n$$\\frac{dV_1(t)}{dt} + \\frac{1}{R_1 C_1} V_1(t) = \\frac{i}{C_1}$$\n项 $R_1 C_1$ 是极化时间常数 $\\tau_1$。方程变为：\n$$\\frac{dV_1(t)}{dt} + \\frac{1}{\\tau_1} V_1(t) = \\frac{i}{C_1}$$\n这个微分方程的通解是齐次解 $V_{1,h}(t)$ 和一个特解 $V_{1,p}(t)$ 的和。齐次方程为 $\\frac{dV_{1,h}}{dt} + \\frac{1}{\\tau_1} V_{1,h} = 0$，其解为 $V_{1,h}(t) = A \\exp(-t/\\tau_1)$，其中 $A$ 为某个常数。对于常数强制项 $i/C_1$，我们假设一个常数特解 $V_{1,p}(t) = K$。将其代入常微分方程 (ODE) 得到 $0 + K/\\tau_1 = i/C_1$，所以 $K = i \\tau_1 / C_1 = i (R_1 C_1) / C_1 = i R_1$。\n极化电压的通解为：\n$$V_1(t) = A \\exp\\left(-\\frac{t}{\\tau_1}\\right) + i R_1$$\n我们使用初始条件，即在 $t=0$ 时极化支路完全弛豫，这意味着 $V_1(0) = 0$。\n$$V_1(0) = A \\exp(0) + i R_1 = A + i R_1 = 0 \\implies A = -i R_1$$\n因此，对于 $t \\ge 0$，极化电压的特解是：\n$$V_1(t) = i R_1 \\left(1 - \\exp\\left(-\\frac{t}{\\tau_1}\\right)\\right)$$\n现在，我们可以写出端电压 $V(t)$ 的最终表达式：\n$$V(t) = E - i R_0 - i R_1 \\left(1 - \\exp\\left(-\\frac{t}{\\tau_1}\\right)\\right)$$\n让我们代入给定的数值：$E = 400 \\text{ V}$，$i = 15 \\text{ A}$，$R_0 = 50 \\text{ m}\\Omega = 0.05 \\ \\Omega$，$C_1 = 2000 \\text{ F}$，以及 $\\tau_1 = 200 \\text{ s}$。首先，我们计算极化电阻 $R_1$：\n$$R_1 = \\frac{\\tau_1}{C_1} = \\frac{200 \\text{ s}}{2000 \\text{ F}} = 0.1 \\ \\Omega$$\n现在，将这些值代入 $V(t)$ 的表达式中：\n$$V(t) = 400 - (15)(0.05) - (15)(0.1) \\left(1 - \\exp\\left(-\\frac{t}{200}\\right)\\right)$$\n$$V(t) = 400 - 0.75 - 1.5 \\left(1 - \\exp\\left(-\\frac{t}{200}\\right)\\right)$$\n$$V(t) = 399.25 - 1.5 + 1.5 \\exp\\left(-\\frac{t}{200}\\right)$$\n$$V(t) = 397.75 + 1.5 \\exp\\left(-\\frac{t}{200}\\right)$$\n这就是 $t \\ge 0$ 时端电压（以伏特为单位）的闭式表达式。\n\n接下来，我们推导由电阻 $R_0$ 和 $R_1$ 中的焦耳热引起的瞬时产热率 $\\dot{Q}(t)$ 的表达式。总产热率是每个电阻中耗散功率的总和：\n$$\\dot{Q}(t) = P_{R0}(t) + P_{R1}(t)$$\n由于电流 $i$ 是恒定的，串联电阻 $R_0$ 中耗散的功率在 $t \\ge 0$ 时也是恒定的：\n$$P_{R0}(t) = i^2 R_0$$\n极化电阻 $R_1$ 中耗散的功率取决于流过它的电流 $i_{R1}(t)$：\n$$P_{R1}(t) = (i_{R1}(t))^2 R_1$$\n电流 $i_{R1}(t)$ 由应用于极化支路的 Ohm 定律给出：\n$$i_{R1}(t) = \\frac{V_1(t)}{R_1} = \\frac{i R_1}{R_1} \\left(1 - \\exp\\left(-\\frac{t}{\\tau_1}\\right)\\right) = i \\left(1 - \\exp\\left(-\\frac{t}{\\tau_1}\\right)\\right)$$\n因此，在 $R_1$ 中耗散的功率为：\n$$P_{R1}(t) = \\left[i \\left(1 - \\exp\\left(-\\frac{t}{\\tau_1}\\right)\\right)\\right]^2 R_1 = i^2 R_1 \\left(1 - \\exp\\left(-\\frac{t}{\\tau_1}\\right)\\right)^2$$\n总瞬时产热率是两项功率之和：\n$$\\dot{Q}(t) = i^2 R_0 + i^2 R_1 \\left(1 - \\exp\\left(-\\frac{t}{\\tau_1}\\right)\\right)^2$$\n$$\\dot{Q}(t) = i^2 \\left[ R_0 + R_1 \\left(1 - \\exp\\left(-\\frac{t}{\\tau_1}\\right)\\right)^2 \\right]$$\n现在，我们代入数值：$i=15 \\text{ A}$，$R_0=0.05 \\ \\Omega$，$R_1=0.1 \\ \\Omega$ 和 $\\tau_1=200 \\text{ s}$。\n$$i^2 = (15)^2 = 225 \\text{ A}^2$$\n$$P_{R0} = (225)(0.05) = 11.25 \\text{ W}$$\n$$P_{R1}(t) = (225)(0.1) \\left(1 - \\exp\\left(-\\frac{t}{200}\\right)\\right)^2 = 22.5 \\left(1 - \\exp\\left(-\\frac{t}{200}\\right)\\right)^2$$\n所以，总产热率（以瓦特为单位）为：\n$$\\dot{Q}(t) = 11.25 + 22.5 \\left(1 - \\exp\\left(-\\frac{t}{200}\\right)\\right)^2$$\n这就是 $t \\ge 0$ 时总瞬时产热率的闭式表达式。\n所需的两个表达式是 $V(t) = 397.75 + 1.5 \\exp\\left(-\\frac{t}{200}\\right)$ 和 $\\dot{Q}(t) = 11.25 + 22.5 \\left(1 - \\exp\\left(-\\frac{t}{200}\\right)\\right)^2$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n397.75 + 1.5 \\exp\\left(-\\frac{t}{200}\\right)  11.25 + 22.5 \\left(1 - \\exp\\left(-\\frac{t}{200}\\right)\\right)^2\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "V2G策略的最终目标是在经济效益和运营约束之间取得平衡，做出最优决策。这项实践将指导你构建一个混合整数线性规划（MILP）模型，这是V2G调度中一个非常强大的框架。你将学习如何定义决策变量，如何将物理和逻辑约束转化为数学方程，以及如何构建一个以成本最小化为目标的目标函数，为解决现实世界中的V2G优化挑战奠定基础。",
            "id": "3959482",
            "problem": "您需要为一个基于能量守恒第一性原理和线性设备约束的车辆到电网 (V2G) 调度问题，推导、实现并求解一个混合整数线性优化模型。考虑一个由 $v \\in \\mathcal{V}$ 索引的电动汽车车队和由 $t \\in \\mathcal{T}$ 索引的离散时间步。其基本基础是源于能量平衡的荷电状态 (SoC) 动态学，以及带有二元连接决策的线性功率约束。您必须推导一个混合整数线性规划 (MILP)，其决策变量为每个车辆在每个时间步的二元连接状态 $x_{v,t} \\in \\{0,1\\}$ 和连续功率变量 $P_{v,t}$，强制执行可用性约束，并整合 SoC 动态学。您的最终程序必须在可用性窗口内枚举所有二元决策，并将由此产生的连续子问题作为线性规划求解至最优。\n\n使用以下基本原理：\n- 荷电状态 (SoC) 的能量守恒：荷电状态 (SoC) $s_{v,t}$ 是车辆 $v$ 电池在时间 $t$ 储存的能量占总可用能量的比例，定义在区间 $[0,1]$ 上。\n- 时间步 $\\Delta t$ 上的离散时间能量平衡：充电和放电对 $s_{v,t}$ 的影响与功率成正比，与可用能量成反比。\n- 线性设备约束：功率限制与连接状态成比例，且 SoC 有界。\n\n按如下方式定义模型。\n- 变量：\n  - 二元连接性 $x_{v,t} \\in \\{0,1\\}$，表示车辆 $v$ 在时间 $t$ 是否物理连接并可以交换功率。\n  - 非负充电功率 $P^{+}_{v,t} \\ge 0$ 和非负放电功率 $P^{-}_{v,t} \\ge 0$，净功率为 $P_{v,t} = P^{+}_{v,t} - P^{-}_{v,t}$。\n  - 荷电状态 (SoC) $s_{v,t} \\in [0,1]$。\n- 参数（给定）：\n  - 可用性窗口 $a_{v,t} \\in \\{0,1\\}$。\n  - 可用能量容量 $E_{v}$，单位为 $\\mathrm{kWh}$。\n  - 最大充电功率 $\\bar{P}^{+}_{v}$，单位为 $\\mathrm{kW}$。\n  - 最大放电功率 $\\bar{P}^{-}_{v}$，单位为 $\\mathrm{kW}$。\n  - 充电效率 $\\eta^{+}_{v} \\in (0,1]$ 和放电效率 $\\eta^{-}_{v} \\in (0,1]$。\n  - 电价 $c_{t}$，单位为美元/$\\mathrm{kWh}$。\n  - 退化惩罚系数 $\\alpha_{v}$，单位为美元/$\\mathrm{kWh}$（吞吐量）。\n  - 每个时间步的连接开销 $\\gamma_{v}$，单位为美元。\n  - 初始 SoC $s_{v,0} \\in [0,1]$；SoC 边界 $s^{\\min}_{v}, s^{\\max}_{v} \\in [0,1]$；终端 SoC 需求 $s^{\\mathrm{req}}_{v} \\in [0,1]$。\n  - 时间步 $\\Delta t$，单位为小时。\n- 使用第一性原理推导的约束：\n  - 可用性：对所有 $v,t$，有 $x_{v,t} \\le a_{v,t}$。\n  - 功率门控：对所有 $v,t$，有 $0 \\le P^{+}_{v,t} \\le \\bar{P}^{+}_{v} x_{v,t}$ 和 $0 \\le P^{-}_{v,t} \\le \\bar{P}^{-}_{v} x_{v,t}$。\n  - SoC 动态学：对所有 $v$ 和所有 $t \\in \\{0,\\dots,|\\mathcal{T}|-1\\}$，有 $s_{v,t+1} = s_{v,t} + \\dfrac{\\eta^{+}_{v} \\Delta t}{E_{v}} P^{+}_{v,t} - \\dfrac{\\Delta t}{\\eta^{-}_{v} E_{v}} P^{-}_{v,t}$。\n  - SoC 边界：对所有 $v,t$，有 $s^{\\min}_{v} \\le s_{v,t} \\le s^{\\max}_{v}$，且 $s_{v,0} = \\text{给定值}$。\n  - 终端需求：对所有 $v$，有 $s_{v,|\\mathcal{T}|} \\ge s^{\\mathrm{req}}_{v}$。\n- 需要推导和实现的目标函数：最小化在整个时间范围内的总货币成本，该成本定义为能源购买成本减去能源销售收入，加上线性退化和连接开销惩罚的总和。形式上，最小化\n  $$\\sum_{t \\in \\mathcal{T}} \\sum_{v \\in \\mathcal{V}} \\left[ c_{t} \\Delta t \\left(P^{+}_{v,t} - P^{-}_{v,t}\\right) + \\alpha_{v} \\Delta t \\left(P^{+}_{v,t} + P^{-}_{v,t}\\right) + \\gamma_{v} x_{v,t} \\right].$$\n鉴于 $x_{v,t}$ 的二元性质和线性的连续约束，这是一个混合整数线性规划问题。您的程序必须详尽地枚举与 $a_{v,t}$ 一致的 $x_{v,t}$ 模式，并对每种模式，将连续子问题（即固定 $x_{v,t}$ 的线性规划）求解至全局最优。选择总成本最小的模式。由于测试实例规模较小，穷举枚举是可行的。\n\n物理单位和输出规范：\n- 功率 $P^{+}_{v,t}, P^{-}_{v,t}$ 必须以 $\\mathrm{kW}$ 为单位处理。\n- 能量容量 $E_{v}$ 必须以 $\\mathrm{kWh}$ 为单位处理。\n- 价格 $c_{t}$ 以美元/$\\mathrm{kWh}$ 为单位。\n- 时间步 $\\Delta t$ 以小时为单位。\n- 荷电状态 $s_{v,t}$ 是在 $[0,1]$ 范围内的无量纲值。\n- 将每个最优总成本以美元表示，四舍五入到 $3$ 位小数。\n\n测试套件。实现您的程序以计算并输出以下各参数集的最优总成本：\n\n- 测试用例 $1$ (一般情况)：\n  - $|\\mathcal{V}| = 2$, $|\\mathcal{T}| = 3$, $\\Delta t = 1$。\n  - 价格 $c_{t} = [0.15, 0.25, 0.20]$，单位为美元/$\\mathrm{kWh}$。\n  - 车辆 $1$：$E_{1} = 60$, $\\bar{P}^{+}_{1} = 7.2$, $\\bar{P}^{-}_{1} = 5.0$, $\\eta^{+}_{1} = 0.95$, $\\eta^{-}_{1} = 0.95$, $s_{1,0} = 0.50$, $s^{\\min}_{1} = 0.20$, $s^{\\max}_{1} = 0.90$, $s^{\\mathrm{req}}_{1} = 0.60$, $\\alpha_{1} = 0.01$, $\\gamma_{1} = 0.02$。\n  - 车辆 $2$：$E_{2} = 75$, $\\bar{P}^{+}_{2} = 11.0$, $\\bar{P}^{-}_{2} = 8.0$, $\\eta^{+}_{2} = 0.90$, $\\eta^{-}_{2} = 0.90$, $s_{2,0} = 0.60$, $s^{\\min}_{2} = 0.30$, $s^{\\max}_{2} = 0.90$, $s^{\\mathrm{req}}_{2} = 0.65$, $\\alpha_{2} = 0.015$, $\\gamma_{2} = 0.02$。\n  - 可用性 $a_{v,t}$：车辆 $1$ 在 $t = 0,1$ 时可用，在 $t = 2$ 时不可用；车辆 $2$ 在 $t = 1,2$ 时可用，在 $t = 0$ 时不可用。\n- 测试用例 $2$ (带负价格的边界情况)：\n  - $|\\mathcal{V}| = 1$, $|\\mathcal{T}| = 4$, $\\Delta t = 1$。\n  - 价格 $c_{t} = [-0.05, 0.10, 0.18, 0.12]$，单位为美元/$\\mathrm{kWh}$。\n  - 车辆 $1$：$E_{1} = 75$, $\\bar{P}^{+}_{1} = 7.0$, $\\bar{P}^{-}_{1} = 7.0$, $\\eta^{+}_{1} = 0.92$, $\\eta^{-}_{1} = 0.92$, $s_{1,0} = 0.40$, $s^{\\min}_{1} = 0.30$, $s^{\\max}_{1} = 0.95$, $s^{\\mathrm{req}}_{1} = 0.50$, $\\alpha_{1} = 0.01$, $\\gamma_{1} = 0.01$。\n  - 可用性 $a_{1,t} = 1$，对所有 $t \\in \\{0,1,2,3\\}$。\n- 测试用例 $3$ (高退化成本的边缘情况)：\n  - $|\\mathcal{V}| = 2$, $|\\mathcal{T}| = 2$, $\\Delta t = 1$。\n  - 价格 $c_{t} = [0.20, 0.22]$，单位为美元/$\\mathrm{kWh}$。\n  - 车辆 $1$：$E_{1} = 60$, $\\bar{P}^{+}_{1} = 7.2$, $\\bar{P}^{-}_{1} = 5.0$, $\\eta^{+}_{1} = 0.95$, $\\eta^{-}_{1} = 0.95$, $s_{1,0} = 0.79$, $s^{\\min}_{1} = 0.20$, $s^{\\max}_{1} = 0.95$, $s^{\\mathrm{req}}_{1} = 0.80$, $\\alpha_{1} = 1.0$, $\\gamma_{1} = 0.00$。\n  - 车辆 $2$：$E_{2} = 60$, $\\bar{P}^{+}_{2} = 7.2$, $\\bar{P}^{-}_{2} = 5.0$, $\\eta^{+}_{2} = 0.95$, $\\eta^{-}_{2} = 0.95$, $s_{2,0} = 0.85$, $s^{\\min}_{2} = 0.20$, $s^{\\max}_{2} = 0.95$, $s^{\\mathrm{req}}_{2} = 0.85$, $\\alpha_{2} = 1.0$, $\\gamma_{2} = 0.00$。\n  - 可用性 $a_{1,t} = 1$，对 $t \\in \\{0,1\\}$；可用性 $a_{2,t} = 0$，对 $t \\in \\{0,1\\}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 `\"[r_{1},r_{2},r_{3}]\"`，其中每个 $r_{i}$ 是测试用例 $i$ 的最优总成本（美元），四舍五入到 $3$ 位小数。",
            "solution": "用户提供了一个明确定义的车辆到电网 (V2G) 优化问题。第一步是验证问题陈述。\n\n### 第 1 步：提取已知条件\n\n**集合与索引：**\n-   车辆：$v \\in \\mathcal{V}$。\n-   离散时间步：$t \\in \\mathcal{T} = \\{0, 1, \\dots, |\\mathcal{T}|-1\\}$。\n\n**决策变量：**\n-   二元连接性：$x_{v,t} \\in \\{0,1\\}$。\n-   非负充电功率：$P^{+}_{v,t} \\ge 0$，单位为 $\\mathrm{kW}$。\n-   非负放电功率：$P^{-}_{v,t} \\ge 0$，单位为 $\\mathrm{kW}$。\n-   荷电状态 (SoC)：$s_{v,t} \\in [0,1]$。\n\n**参数：**\n-   可用性窗口：$a_{v,t} \\in \\{0,1\\}$。\n-   可用能量容量：$E_{v}$，单位为 $\\mathrm{kWh}$。\n-   最大充电功率：$\\bar{P}^{+}_{v}$，单位为 $\\mathrm{kW}$。\n-   最大放电功率：$\\bar{P}^{-}_{v}$，单位为 $\\mathrm{kW}$。\n-   充电效率：$\\eta^{+}_{v} \\in (0,1]$。\n-   放电效率：$\\eta^{-}_{v} \\in (0,1]$。\n-   电价：$c_{t}$，单位为美元/$\\mathrm{kWh}$。\n-   退化惩罚系数：$\\alpha_{v}$，单位为美元/$\\mathrm{kWh}$。\n-   连接开销：$\\gamma_{v}$，单位为美元/时间步。\n-   初始 SoC：$s_{v,0} \\in [0,1]$。\n-   SoC 边界：$s^{\\min}_{v}, s^{\\max}_{v} \\in [0,1]$。\n-   终端 SoC 需求：$s^{\\mathrm{req}}_{v} \\in [0,1]$。\n-   时间步长：$\\Delta t$，单位为小时。\n\n**约束（待正式推导）：**\n1.  可用性：$x_{v,t} \\le a_{v,t}$。\n2.  功率门控：$0 \\le P^{+}_{v,t} \\le \\bar{P}^{+}_{v} x_{v,t}$ 和 $0 \\le P^{-}_{v,t} \\le \\bar{P}^{-}_{v} x_{v,t}$。\n3.  SoC 动态学：$s_{v,t+1} = s_{v,t} + \\dfrac{\\eta^{+}_{v} \\Delta t}{E_{v}} P^{+}_{v,t} - \\dfrac{\\Delta t}{\\eta^{-}_{v} E_{v}} P^{-}_{v,t}$。\n4.  SoC 边界：对所有 $t  0$，$s^{\\min}_{v} \\le s_{v,t} \\le s^{\\max}_{v}$，且 $s_{v,0}$ 是固定的。\n5.  终端需求：$s_{v,|\\mathcal{T}|} \\ge s^{\\mathrm{req}}_{v}$。\n\n**目标函数（待正式推导）：**\n-   最小化总成本：$\\sum_{t \\in \\mathcal{T}} \\sum_{v \\in \\mathcal{V}} \\left[ c_{t} \\Delta t \\left(P^{+}_{v,t} - P^{-}_{v,t}\\right) + \\alpha_{v} \\Delta t \\left(P^{+}_{v,t} + P^{-}_{v,t}\\right) + \\gamma_{v} x_{v,t} \\right]$。\n\n**求解方法：**\n-   穷举枚举与 $a_{v,t}$ 一致的所有二元模式 $x_{v,t}$。\n-   对每种模式，将得到的连续子问题（一个线性规划）求解至最优。\n-   选择产生最小总成本的模式。\n\n**测试用例：**\n-   提供了三个具体的测试用例，包含所有参数。\n\n**输出格式：**\n-   单行输出，包含一个用方括号括起来的逗号分隔列表，其中是每个测试用例的最优成本，四舍五入到 3 位小数。例如：`[r1,r2,r3]`。\n\n### 第 2 步：使用提取的已知条件进行验证\n\n-   **科学依据（关键）：** 该问题基于能量守恒的基本原理，由荷电状态 (SoC) 平衡方程表示。功率限制和 SoC 边界的约束在电池和电力系统建模中是标准做法。经济目标函数是能源市场中成本的常规表示。该模型科学合理且切合实际。\n-   **适定性：** 该问题是一个混合整数线性规划 (MILP)。指定的求解方法——对小实例的二元变量进行穷举枚举——是找到全局最优解的有效方法（尽管通常不具备可扩展性）。每个由此产生的连续子问题都是一个线性规划 (LP)，它是凸的，标准求解器可以在存在解的情况下找到唯一的 dla最优解。问题结构是适定的。\n-   **客观性（关键）：** 问题陈述使用了精确的数学语言，并对所有变量、参数和约束给出了明确的定义。它不含主观或基于意见的陈述。\n-   **完整性与一致性：** 每个测试用例都提供了所有必要的参数。单位（$\\mathrm{kW}$, $\\mathrm{kWh}$, $\\mathrm{h}$, `\\$`）与模型中定义的物理和经济关系一致。例如，乘积 $c_t \\Delta t P_{v,t}$ 的单位是 $(\\$/\\mathrm{kWh}) \\cdot \\mathrm{h} \\cdot \\mathrm{kW} = \\$$，这对于成本项是正确的。问题陈述中没有矛盾之处。\n\n### 第 3 步：结论与行动\n问题陈述是有效的。它具有科学依据、适定、客观和完整。我将继续进行求解。\n\n### 推导与公式化\n\n该问题是一个混合整数线性规划 (MILP)，旨在最小化参与车辆到电网服务的电动汽车车队的总运营成本。我们将首先正式推导模型组件，然后详细说明求解算法。\n\n**1. 模型推导**\n\n该模型建立在三个支柱之上：能量平衡、线性设备约束和经济成本。\n\n-   **荷电状态 (SoC) 动态学：** SoC，$s_{v,t}$，代表存储能量与总可用容量 $E_v$ 的比率。在一个时间步 $\\Delta t$ 内存储能量的变化量是流入电池的净能量。当以功率 $P^{+}_{v,t}$ 充电时，增加到电池的能量是 $\\eta^{+}_{v} P^{+}_{v,t} \\Delta t$，其中 $\\eta^{+}_{v}$ 是充电效率。当以功率 $P^{-}_{v,t}$ 放电时，从电池中移除的能量是 $(1/\\eta^{-}_{v}) P^{-}_{v,t} \\Delta t$，其中输送到电网的能量是 $P^{-}_{v,t} \\Delta t$，$\\eta^{-}_{v}$ 是放电效率。\n    SoC 的变化是存储能量的变化量除以容量 $E_v$：\n    $$s_{v,t+1} - s_{v,t} = \\frac{\\eta^{+}_{v} P^{+}_{v,t} \\Delta t - (1/\\eta^{-}_{v}) P^{-}_{v,t} \\Delta t}{E_v}$$\n    整理后得到给定的状态转移方程：\n    $$s_{v,t+1} = s_{v,t} + \\frac{\\eta^{+}_{v} \\Delta t}{E_v} P^{+}_{v,t} - \\frac{\\Delta t}{\\eta^{-}_{v} E_v} P^{-}_{v,t}$$\n\n-   **功率约束：** 二元变量 $x_{v,t}$ 充当一个开关。如果车辆未连接（$x_{v,t}=0$），则不能交换功率，所以 $P^{+}_{v,t}=0$ 且 $P^{-}_{v,t}=0$。如果已连接（$x_{v,t}=1$），则功率受到车辆硬件 $\\bar{P}^{+}_{v}$ 和 $\\bar{P}^{-}_{v}$ 的限制。这通过“功率门控”约束来体现：\n    $$0 \\le P^{+}_{v,t} \\le \\bar{P}^{+}_{v} x_{v,t}$$\n    $$0 \\le P^{-}_{v,t} \\le \\bar{P}^{-}_{v} x_{v,t}$$\n    此外，车辆只有在物理上可用时才能连接，这要求 $x_{v,t} \\le a_{v,t}$。由于 $x_{v,t}$ 是二元的，这强制要求只有当 $a_{v,t}$ 为 1 时，$x_{v,t}$ 才能为 1。\n\n-   **目标函数：** 总成本是三个组成部分的总和，在所有车辆和时间步上进行累加。\n    1.  **能源成本：** 电力的净成本是价格 $c_t$ 乘以从电网获取的净能量，即 $(P^{+}_{v,t} - P^{-}_{v,t}) \\Delta t$。\n    2.  **退化成本：** 电池退化通常被建模为与总能量吞吐量成正比。功率吞吐量是 $P^{+}_{v,t} + P^{-}_{v,t}$，因此能量吞吐量是 $(P^{+}_{v,t} + P^{-}_{v,t}) \\Delta t$。相关成本是 $\\alpha_v$ 乘以该值。\n    3.  **连接成本：** 车辆连接的每个时间步都会产生固定成本 $\\gamma_v$，建模为 $\\gamma_v x_{v,t}$。\n\n    将这些项相加得到目标函数。我们可以按决策变量 $P^{+}$ 和 $P^{-}$ 对各项进行分组：\n    $$\\min \\sum_{v,t} \\left[ \\Delta t (c_t + \\alpha_v) P^{+}_{v,t} + \\Delta t (\\alpha_v - c_t) P^{-}_{v,t} + \\gamma_v x_{v,t} \\right]$$\n\n**2. 求解策略：枚举与线性规划**\n\n按照规定，我们通过枚举二元变量 $x_{v,t}$ 的所有有效组合，并对每种组合求解关于连续变量的相应 LP 来解决这个 MILP。\n\n对于一个固定的二元模式 $\\mathbf{x} = \\{x_{v,t}\\}$，问题变成一个线性规划 (LP)。这个 LP 的变量是所有 $v \\in \\mathcal{V}$ 和 $t \\in \\mathcal{T}$ 的连续变量 $\\{P^{+}_{v,t}, P^{-}_{v,t}, s_{v,t}\\}$。\n\n对于给定的 $\\mathbf{x}$，LP 子问题是：\n$$\\text{最小化} \\quad \\sum_{v,t} \\left[ \\Delta t (c_t + \\alpha_v) P^{+}_{v,t} + \\Delta t (\\alpha_v - c_t) P^{-}_{v,t} \\right] + \\underbrace{\\sum_{v,t} \\gamma_v x_{v,t}}_{\\text{常数}}$$\n受限于：\n1.  $0 \\le P^{+}_{v,t} \\le \\bar{P}^{+}_{v} x_{v,t}$ (其中 $x_{v,t}$ 是固定的 0 或 1)\n2.  $0 \\le P^{-}_{v,t} \\le \\bar{P}^{-}_{v} x_{v,t}$ (其中 $x_{v,t}$ 是固定的 0 或 1)\n3.  $s_{v,t+1} - s_{v,t} - \\frac{\\eta^{+}_{v} \\Delta t}{E_v} P^{+}_{v,t} + \\frac{\\Delta t}{\\eta^{-}_{v} E_v} P^{-}_{v,t} = 0 \\quad (\\text{对于 } t=0, \\dots, |\\mathcal{T}|-1)$\n4.  $s^{\\min}_{v} \\le s_{v,t} \\le s^{\\max}_{v} \\quad (\\text{对于 } t=1, \\dots, |\\mathcal{T}|)$\n5.  $s_{v,|\\mathcal{T}|} \\ge s^{\\mathrm{req}}_{v}$\n\n这个 LP 可以使用标准求解器如 `scipy.optimize.linprog` 来求解。\n\n**3. 使用 `scipy.optimize.linprog` 实现**\n\n为了使用 `scipy.optimize.linprog`，我们必须将 LP 公式化为标准形式：$\\min \\mathbf{c}^T \\mathbf{z}$，受限于 $\\mathbf{A}_{\\text{ub}} \\mathbf{z} \\le \\mathbf{b}_{\\text{ub}}$，$\\mathbf{A}_{\\text{eq}} \\mathbf{z} = \\mathbf{b}_{\\text{eq}}$，以及 $\\mathbf{lb} \\le \\mathbf{z} \\le \\mathbf{ub}$。\n\n-   **决策向量 $\\mathbf{z}$：** 我们将连续变量扁平化为单个向量 $\\mathbf{z}$。对于 $V=|\\mathcal{V}|$ 辆车和 $T=|\\mathcal{T}|$ 个时间范围，向量可以结构化为：\n    $$\\mathbf{z} = [P^{+}_{0,0}, \\dots, P^{+}_{V-1,T-1}, \\quad P^{-}_{0,0}, \\dots, P^{-}_{V-1,T-1}, \\quad s_{0,1}, \\dots, s_{V-1,T}]$$\n    总变量数为 $2VT + VT = 3VT$。\n\n-   **目标向量 $\\mathbf{c}$：** $\\mathbf{c}$ 中的系数对应于目标函数。对于变量 $P^{+}_{v,t}$，系数是 $\\Delta t (c_t + \\alpha_v)$。对于 $P^{-}_{v,t}$，系数是 $\\Delta t (\\alpha_v - c_t)$。对于所有 $s_{v,t}$ 变量，系数是 $0$。固定成本部分 $\\sum \\gamma_v x_{v,t}$ 在求解后加到 LP 最优值 `result.fun` 上。\n\n-   **边界 ($\\mathbf{lb}, \\mathbf{ub}$):**\n    -   对于 $P^{+}_{v,t}$: $[0, \\bar{P}^{+}_{v} x_{v,t}]$\n    -   对于 $P^{-}_{v,t}$: $[0, \\bar{P}^{-}_{v} x_{v,t}]$\n    -   对于 $s_{v,t}$: $[s^{\\min}_{v}, s^{\\max}_{v}]$\n\n-   **等式约束 ($\\mathbf{A}_{\\text{eq}}, \\mathbf{b}_{\\text{eq}}$):** 这些代表 SoC 动态学。对于每个车辆 $v$ 和时间步 $t \\in \\{0, \\dots, T-1\\}$，我们有一个方程：\n    -   对于 $t=0$: $s_{v,1} - (\\frac{\\eta^{+}_{v}\\Delta t}{E_v})P^{+}_{v,0} + (\\frac{\\Delta t}{\\eta^{-}_{v}E_v})P^{-}_{v,0} = s_{v,0}$\n    -   对于 $t0$: $s_{v,t+1} - s_{v,t} - (\\frac{\\eta^{+}_{v}\\Delta t}{E_v})P^{+}_{v,t} + (\\frac{\\Delta t}{\\eta^{-}_{v}E_v})P^{-}_{v,t} = 0$\n    这些方程定义了 $\\mathbf{A}_{\\text{eq}}$ 的行和 $\\mathbf{b}_{\\text{eq}}$ 的元素。\n\n-   **不等式约束 ($\\mathbf{A}_{\\text{ub}}, \\mathbf{b}_{\\text{ub}}$):** 这些捕获了终端 SoC 需求 $s_{v,T} \\ge s^{\\mathrm{req}}_{v}$，可重写为 $-s_{v,T} \\le -s^{\\mathrm{req}}_{v}$。对于每个车辆 $v$，我们向 $\\mathbf{A}_{\\text{ub}}$ 添加一行，在对应于 $s_{v,T}$ 的位置上填入 $-1$，并在 $\\mathbf{b}_{\\text{ub}}$ 中添加相应的条目 $-s^{\\mathrm{req}}_{v}$。\n\n整个算法由一个外循环组成，该循环生成每个有效的二元模式 $\\mathbf{x}$，以及一个内部部分，用于构建和求解上述 LP。在所有模式中找到的最小成本即为解。",
            "answer": "$$\n\\boxed{[0.540, -0.772, 0.016]}\n$$"
        }
    ]
}