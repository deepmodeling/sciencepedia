{
    "hands_on_practices": [
        {
            "introduction": "在启动序贯优化循环之前，我们需要一组良好的初始数据点来构建代理模型。拉丁超立方设计 (LHD) 是一种标准的空间填充方法，可以有效地探索参数空间，避免采样偏差。本练习  将指导您构建一个LHD，并学习如何评估其在设计空间中的“填充”质量，这是贝叶斯优化成功的第一步。",
            "id": "3896144",
            "problem": "您正在为电池电极自动化优化设计一个初始实验计划，其中目标函数的评估成本高昂。对于目标函数评估成本高昂的贝叶斯优化，标准的做法是首先采用空间填充设计，以减少高斯过程（GP）代理模型下的后验不确定性，并在进行序贯改进之前广泛覆盖整个定义域。拉丁超立方设计（LHD）是一个行之有效的选择。考虑两个设计变量：电极孔隙率和活性材料颗粒直径。您必须在给定的边界内，为这两个变量构建一个$5$点拉丁超立方设计，采用确定性方案在每个层内放置点，然后计算这$5$个点在归一化设计空间中的最小两两欧几里得距离。\n\n基本原理：\n- 拉丁超立方设计（LHD）是一种针对 $m$ 个点的分层抽样方案，它将每个变量的范围划分为 $m$ 个等概率的层，并为每个变量在每个层中精确放置一个样本；等效地，它通过排列使用一对一的分配，以避免沿任何坐标发生碰撞。\n- 将每个变量归一化到单位区间可以确保不同单位之间的可比性，其定义为 $$z = \\frac{x - L}{U - L},$$ 其中 $x$ 是物理变量，$L$ 是下界，$U$ 是上界。\n- 在度量空间中，点 $\\mathbf{a} = (a_1,a_2)$ 和点 $\\mathbf{b} = (b_1,b_2)$ 之间的欧几里得距离为 $$\\lVert \\mathbf{a} - \\mathbf{b} \\rVert_2 = \\sqrt{(a_1 - b_1)^2 + (a_2 - b_2)^2}.$$\n\n设计规格：\n- 令点数为 $m = 5$。\n- 对于每个变量，将归一化区间 $[0,1]$ 划分为 $m$ 个相等的层。使用 $m$ 个中点 $$c_j = \\frac{j - \\tfrac{1}{2}}{m},\\;\\; j \\in \\{1,2,3,4,5\\}.$$ \n- 通过为孔隙率和直径分别提供 $\\{1,2,3,4,5\\}$ 上的两个排列 $\\pi_{\\phi}$ 和 $\\pi_{d}$ 来构建这 $5$ 个点。对于 $i \\in \\{1,\\dots,5\\}$，其归一化坐标为 $$z_i = c_{\\pi_{\\phi}[i]},\\quad w_i = c_{\\pi_{d}[i]}.$$ \n- 使用提供的边界将归一化点 $(z_i,w_i)$ 映射到物理坐标 $(\\phi_i,d_{p,i})$，但两两之间的距离必须在归一化空间中计算，以确保结果无量纲且单位一致，从而适用于高斯过程建模。\n\n计算：\n- 计算这5个归一化点之间的所有两两欧几里得距离，并报告最小值。最终距离以无量纲浮点数表示，四舍五入到 $6$ 位小数。\n\n测试套件：\n提供以下三个测试用例。对于每个用例，按照所述方法使用中点和排列构建LHD，然后计算在归一化空间中的最小两两欧几里得距离。\n- 用例 1（典型的电极尺度范围）：\n  - 孔隙率边界：$\\phi \\in [\\phi_{\\min},\\phi_{\\max}] = [0.25,0.45]$。\n  - 颗粒直径边界：$d_p \\in [d_{\\min},d_{\\max}] = [5,15]$ 微米。\n  - 排列：$\\pi_{\\phi} = (1,2,3,4,5)$，$\\pi_{d} = (5,4,3,2,1)$。\n- 用例 2（窄孔隙率范围，以米为单位的微米级直径）：\n  - 孔隙率边界：$\\phi \\in [\\phi_{\\min},\\phi_{\\max}] = [0.30,0.40]$。\n  - 颗粒直径边界：$d_p \\in [d_{\\min},d_{\\max}] = [2\\times 10^{-6},12\\times 10^{-6}]$ 米。\n  - 排列：$\\pi_{\\phi} = (2,5,1,4,3)$，$\\pi_{d} = (1,3,5,2,4)$。\n- 用例 3（中等孔隙率分布，微米级直径）：\n  - 孔隙率边界：$\\phi \\in [\\phi_{\\min},\\phi_{\\max}] = [0.32,0.50]$。\n  - 颗粒直径边界：$d_p \\in [d_{\\min},d_{\\max}] = [6,10]$ 微米。\n  - 排列：$\\pi_{\\phi} = (5,1,3,2,4)$，$\\pi_{d} = (1,5,2,4,3)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个用例的最小两两欧几里得距离，形式为方括号括起来的逗号分隔列表，每个浮点数四舍五入到六位小数，例如：$$[0.123456,0.234567,0.345678].$$",
            "solution": "问题陈述被评估为有效。它在科学上基于实验设计的原理，特别是拉丁超立方抽样（LHS），这是一种探索昂贵函数（例如在计算材料科学和电池模拟中遇到的那些）参数空间的标准技术。该问题是适定的，为构建样本点提供了确定性且完全指定的程序，并为计算提供了明确的目标。所有必要的数据和定义都已提供，并且没有内部矛盾或歧义。该问题是客观且可形式化的。\n\n任务是为归一化单位正方形 $[0,1] \\times [0,1]$ 中的两个变量构建一个5点拉丁超立方设计（LHD），并计算这些点之间的最小两两欧几里得距离。对三个不同的测试用例重复此过程，每个用例由一对不同的排列定义。\n\n首先，我们确定设计的基本组成部分。点数，也就是每个变量的层数，为 $m=5$。设计空间是归一化的单位超立方体。问题指定了在每个层的中心确定性地放置点。对于归一化区间 $[0,1]$ 中的一个变量， $m$ 个层为 $[0, 1/m), [1/m, 2/m), \\ldots, [(m-1)/m, 1]$。这些层的中点 $c_j$ 由以下公式给出：\n$$c_j = \\frac{j - \\frac{1}{2}}{m}, \\quad j \\in \\{1, 2, 3, 4, 5\\}$$\n对于 $m=5$，中点集合为：\n$c_1 = \\frac{1 - 0.5}{5} = \\frac{0.5}{5} = 0.1$\n$c_2 = \\frac{2 - 0.5}{5} = \\frac{1.5}{5} = 0.3$\n$c_3 = \\frac{3 - 0.5}{5} = \\frac{2.5}{5} = 0.5$\n$c_4 = \\frac{4 - 0.5}{5} = \\frac{3.5}{5} = 0.7$\n$c_5 = \\frac{5 - 0.5}{5} = \\frac{4.5}{5} = 0.9$\n\n通过创建 $m$ 个点来形成一个LHD，确保对于每个变量， $m$ 个层中的每一个都被精确采样一次。这是通过使用排列来实现的。对于我们的二维问题，变量为孔隙率（$\\phi$）和颗粒直径（$d_p$），我们得到了两个排列 $\\pi_{\\phi}$ 和 $\\pi_{d}$，每个都是集合 $\\{1, 2, 3, 4, 5\\}$ 的一个排列。对于 $i \\in \\{1, \\dots, 5\\}$，LHD的第 $i$ 个点的归一化坐标 $(z_i, w_i)$ 由以下公式给出：\n$$z_i = c_{\\pi_{\\phi}[i]}, \\quad w_i = c_{\\pi_{d}[i]}$$\n这里，$\\pi_{\\phi}[i]$ 和 $\\pi_{d}[i]$ 指的是给定排列元组的第 $i$ 个元素。\n\n任意两点 $\\mathbf{p}_i = (z_i, w_i)$ 和 $\\mathbf{p}_k = (z_k, w_k)$ 之间的距离是欧几里得距离，计算如下：\n$$d(\\mathbf{p}_i, \\mathbf{p}_k) = \\sqrt{(z_i - z_k)^2 + (w_i - w_k)^2}$$\n对于 $m=5$ 个点，需要计算 $\\binom{5}{2} = 10$ 个唯一的两两距离。最终目标是找到这10个距离中的最小值。孔隙率和颗粒直径的物理边界是上下文信息，计算中并不需要，因为计算是在归一化空间中进行的。\n\n我们现在对每个测试用例进行分析。\n\n**用例 1：**\n- 排列：$\\pi_{\\phi} = (1,2,3,4,5)$，$\\pi_{d} = (5,4,3,2,1)$。\n这5个归一化点 $\\mathbf{p}_i = (z_i, w_i)$ 是：\n- $\\mathbf{p}_1$：索引 $(1,5) \\rightarrow (c_1, c_5) = (0.1, 0.9)$\n- $\\mathbf{p}_2$：索引 $(2,4) \\rightarrow (c_2, c_4) = (0.3, 0.7)$\n- $\\mathbf{p}_3$：索引 $(3,3) \\rightarrow (c_3, c_3) = (0.5, 0.5)$\n- $\\mathbf{p}_4$：索引 $(4,2) \\rightarrow (c_4, c_2) = (0.7, 0.3)$\n- $\\mathbf{p}_5$：索引 $(5,1) \\rightarrow (c_5, c_1) = (0.9, 0.1)$\n我们计算这10个两两距离。例如，$\\mathbf{p}_1$ 和 $\\mathbf{p}_2$ 之间的距离是：\n$$d(\\mathbf{p}_1, \\mathbf{p}_2) = \\sqrt{(0.1 - 0.3)^2 + (0.9 - 0.7)^2} = \\sqrt{(-0.2)^2 + (0.2)^2} = \\sqrt{0.04 + 0.04} = \\sqrt{0.08}$$\n此序列中的所有相邻点（例如，$(\\mathbf{p}_1, \\mathbf{p}_2)$，$(\\mathbf{p}_2, \\mathbf{p}_3)$ 等）都具有相同的距离。非相邻点之间的距离更大。例如，$d(\\mathbf{p}_1, \\mathbf{p}_3) = \\sqrt{(0.1 - 0.5)^2 + (0.9 - 0.5)^2} = \\sqrt{0.16 + 0.16} = \\sqrt{0.32}$。\n最小距离为 $\\sqrt{0.08} \\approx 0.2828427$。\n\n**用例 2：**\n- 排列：$\\pi_{\\phi} = (2,5,1,4,3)$，$\\pi_{d} = (1,3,5,2,4)$。\n这5个归一化点是：\n- $\\mathbf{p}_1$：索引 $(2,1) \\rightarrow (c_2, c_1) = (0.3, 0.1)$\n- $\\mathbf{p}_2$：索引 $(5,3) \\rightarrow (c_5, c_3) = (0.9, 0.5)$\n- $\\mathbf{p}_3$：索引 $(1,5) \\rightarrow (c_1, c_5) = (0.1, 0.9)$\n- $\\mathbf{p}_4$：索引 $(4,2) \\rightarrow (c_4, c_2) = (0.7, 0.3)$\n- $\\mathbf{p}_5$：索引 $(3,4) \\rightarrow (c_3, c_4) = (0.5, 0.7)$\n我们计算这10个两两距离。我们来考察 $\\mathbf{p}_2$ 和 $\\mathbf{p}_4$ 之间的距离：\n$$d(\\mathbf{p}_2, \\mathbf{p}_4) = \\sqrt{(0.9 - 0.7)^2 + (0.5 - 0.3)^2} = \\sqrt{(0.2)^2 + (0.2)^2} = \\sqrt{0.04 + 0.04} = \\sqrt{0.08}$$\n对所有10对点进行系统搜索后发现，这是最小距离。例如，$d(\\mathbf{p}_1, \\mathbf{p}_4) = \\sqrt{(0.3 - 0.7)^2 + (0.1 - 0.3)^2} = \\sqrt{0.16 + 0.04} = \\sqrt{0.20}$。\n最小距离为 $\\sqrt{0.08} \\approx 0.2828427$。\n\n**用例 3：**\n- 排列：$\\pi_{\\phi} = (5,1,3,2,4)$，$\\pi_{d} = (1,5,2,4,3)$。\n这5个归一化点是：\n- $\\mathbf{p}_1$：索引 $(5,1) \\rightarrow (c_5, c_1) = (0.9, 0.1)$\n- $\\mathbf{p}_2$：索引 $(1,5) \\rightarrow (c_1, c_5) = (0.1, 0.9)$\n- $\\mathbf{p}_3$：索引 $(3,2) \\rightarrow (c_3, c_2) = (0.5, 0.3)$\n- $\\mathbf{p}_4$：索引 $(2,4) \\rightarrow (c_2, c_4) = (0.3, 0.7)$\n- $\\mathbf{p}_5$：索引 $(4,3) \\rightarrow (c_4, c_3) = (0.7, 0.5)$\n我们计算这10个两两距离。考虑 $\\mathbf{p}_2$ 和 $\\mathbf{p}_4$ 之间的距离：\n$$d(\\mathbf{p}_2, \\mathbf{p}_4) = \\sqrt{(0.1 - 0.3)^2 + (0.9 - 0.7)^2} = \\sqrt{(-0.2)^2 + (0.2)^2} = \\sqrt{0.04 + 0.04} = \\sqrt{0.08}$$\n另外，考虑 $\\mathbf{p}_3$ 和 $\\mathbf{p}_5$ 之间的距离：\n$$d(\\mathbf{p}_3, \\mathbf{p}_5) = \\sqrt{(0.5 - 0.7)^2 + (0.3 - 0.5)^2} = \\sqrt{(-0.2)^2 + (-0.2)^2} = \\sqrt{0.04 + 0.04} = \\sqrt{0.08}$$\n全面的比较证实了这是最小距离。\n最小距离为 $\\sqrt{0.08} \\approx 0.2828427$。\n\n在所有三个用例中，最小两两欧几里得距离均为 $\\sqrt{0.08}$。任意两点 $\\mathbf{p}_i$ 和 $\\mathbf{p}_k$ 之间的距离平方为 $d^2 = (( \\pi_{\\phi}[i] - \\pi_{\\phi}[k] )/m)^2 + (( \\pi_{d}[i] - \\pi_{d}[k] )/m)^2$，其中 $\\pi_{\\phi}[i] - \\pi_{\\phi}[k]$ 和 $\\pi_{d}[i] - \\pi_{d}[k]$ 是非零整数。令 $k_{\\phi} = \\pi_{\\phi}[i] - \\pi_{\\phi}[k]$ 和 $k_{d} = \\pi_{d}[i] - \\pi_{d}[k]$。当 $|k_{\\phi}|=1$ 且 $|k_{d}|=1$ 时，可以获得可能的最小距离平方，即 $d^2 = (1^2 + 1^2)/5^2 = 2/25 = 0.08$。三个设计中的每一个都至少包含一对满足此条件的点。\n\n最终结果对所有三个用例都是相同的，四舍五入到6位小数。\n每个用例的最小距离：$0.282843$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Constructs 5-point Latin Hypercube Designs for three test cases,\n    and computes the minimum pairwise Euclidean distance between the\n    points in the normalized [0,1]x[0,1] space for each case.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of two permutation tuples (one for each dimension).\n    test_cases = [\n        # Case 1\n        ((1, 2, 3, 4, 5), (5, 4, 3, 2, 1)),\n        # Case 2\n        ((2, 5, 1, 4, 3), (1, 3, 5, 2, 4)),\n        # Case 3\n        ((5, 1, 3, 2, 4), (1, 5, 2, 4, 3)),\n    ]\n\n    results = []\n    m = 5  # Number of points and strata\n\n    # Calculate the m strata midpoints in the normalized interval [0,1].\n    # The formula is c_j = (j - 0.5) / m for j in {1, ..., m}.\n    # np.arange(1, m + 1) generates the values for j.\n    midpoints = (np.arange(1, m + 1) - 0.5) / m\n\n    # Process each test case\n    for pi_phi, pi_d in test_cases:\n        # Generate the m points for the current LHD.\n        # The points are stored in a numpy array of shape (m, 2).\n        points = np.zeros((m, 2))\n        for i in range(m):\n            # The i-th point (0-indexed) is constructed from the i-th elements\n            # of the permutation tuples.\n            # The values in the permutation tuples are 1-based indices, so we\n            # subtract 1 to get the 0-based index for the midpoints array.\n            idx_phi = pi_phi[i] - 1\n            idx_d = pi_d[i] - 1\n            points[i, 0] = midpoints[idx_phi]\n            points[i, 1] = midpoints[idx_d]\n\n        # Calculate all pairwise distances and find the minimum.\n        # It is computationally more efficient to find the minimum squared\n        # distance first and then take the square root once at the end.\n        min_dist_sq = float('inf')\n\n        # Use itertools.combinations to generate all unique pairs of points.\n        for p1_idx, p2_idx in combinations(range(m), 2):\n            point1 = points[p1_idx]\n            point2 = points[p2_idx]\n            \n            # Calculate the squared Euclidean distance\n            dist_sq = np.sum((point1 - point2)**2)\n            \n            # Update the minimum squared distance if the current one is smaller\n            if dist_sq  min_dist_sq:\n                min_dist_sq = dist_sq\n        \n        # Calculate the minimum distance by taking the square root.\n        min_dist = np.sqrt(min_dist_sq)\n        results.append(min_dist)\n\n    # Final print statement in the exact required format.\n    # The list contains the minimum distances for the three cases,\n    # each formatted as a float rounded to six decimal places.\n    print(f\"[{','.join(f'{d:.6f}' for d in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "获得初始数据后，下一步是更新我们的高斯过程代理模型。本练习  深入探讨了贝叶斯推断的核心，展示了在获得含噪声的实验数据后，如何从先验分布计算目标函数的后验分布。通过这个过程，您将亲手计算不确定性是如何通过收集数据而减少的。",
            "id": "3896095",
            "problem": "在自动化电池设计和仿真中，一个候选设计点 $x$ 的循环寿命是通过进行昂贵的充放电实验来评估的，这些实验会产生含噪声的重复测量值。为了在实验噪声下指导贝叶斯优化，我们考虑一个单一设计点 $x$，其潜在循环寿命 $f(x)$ 被建模为一个高斯过程（GP）。对于一个固定的 $x$，该模型会引出一个正态先验 $f(x) \\sim \\mathcal{N}(m_{0}, \\sigma_{f}^{2})$。每次重复测量被建模为 $y_{i} = f(x) + \\varepsilon_{i}$，其中 $\\varepsilon_{i} \\sim \\mathcal{N}(0, \\sigma_{n}^{2})$ 是独立同分布的。该设定对应于一个具有已知噪声方差的正态似然和一个正态先验。\n\n假设一个物理信息代理模型为该点 $x$ 提供了先验均值 $m_{0} = 950$ 次循环和先验方差 $\\sigma_{f}^{2} = 1000$ (次循环)$^{2}$。一项计量学研究估计观测噪声方差为 $\\sigma_{n}^{2} = 1000$ (次循环)$^{2}$。然后，您在点 $x$ 处进行了 $n=3$ 次重复测量，获得了观测到的循环寿命 $y_{1} = 972$ 次循环，$y_{2} = 961$ 次循环，以及 $y_{3} = 986$ 次循环。\n\n仅使用贝叶斯定理和正态-正态共轭模型的基本定义，完成以下任务：\n\n1.  推导在同一设计点 $x$ 处未来一次含噪声测量值 $y_{*}$ 的后验预测分布，即基于三次观测重复测量值以及给定的先验和噪声参数，计算在点 $x$ 处的后验预测均值和方差。\n\n2.  确定在同一设计点 $x$ 处需要增加的重复测量次数 $k$，使得潜函数 $f(x)$ 的后验方差相对于当前 $n=3$ 次重复测量后的值减半。将 $k$ 视为实现此减半目标的最小非负整数。\n\n将后验预测均值以“次循环”为单位、后验预测方差以“(次循环)$^{2}$”为单位表示，两者均四舍五入至四位有效数字。将 $k$ 作为整数报告。请将您的最终答案以后验预测均值、后验预测方差和 $k$ 的顺序表示为一个单行矩阵中的三个条目。",
            "solution": "首先验证问题，确保其科学合理、提法明确且客观。\n\n### 步骤1：提取已知条件\n-   潜在循环寿命 $f(x)$ 的先验分布：$f(x) \\sim \\mathcal{N}(m_{0}, \\sigma_{f}^{2})$。\n-   先验均值：$m_{0} = 950$ 次循环。\n-   先验方差：$\\sigma_{f}^{2} = 1000$ (次循环)$^{2}$。\n-   重复测量的似然模型：$y_{i} = f(x) + \\varepsilon_{i}$。\n-   观测噪声分布：$\\varepsilon_{i} \\sim \\mathcal{N}(0, \\sigma_{n}^{2})$。\n-   观测噪声方差：$\\sigma_{n}^{2} = 1000$ (次循环)$^{2}$。\n-   观测到的重复测量次数：$n=3$。\n-   观测数据：$y_{1} = 972$, $y_{2} = 961$, $y_{3} = 986$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，采用了标准且被广泛接受的正态-正态共轭模型贝叶斯框架进行推断，这是高斯过程回归的基础。其背景——使用昂贵的仿真进行自动化电池设计——是贝叶斯优化的一个现实应用。该问题提法明确，提供了唯一确定所需量所必需的所有参数和数据。语言客观而精确。没有矛盾、信息缺失或伪科学论断。所提供的数值对于电池循环寿命而言是物理上合理的。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n---\n\n根据问题陈述的要求，解答分为两部分。\n\n### 第一部分：后验预测分布\n\n目标是找到未来一次含噪声测量值 $y_{*}$ 的后验预测分布，即 $p(y_{*} | D)$，其中 $D = \\{y_1, y_2, y_3\\}$。这首先需要找到给定数据 $D$ 的情况下，潜在循环寿命 $f(x)$ 的后验分布，即 $p(f(x)|D)$。\n\n**1. $f(x)$ 的后验分布**\n\n根据贝叶斯定理，后验分布与先验分布和似然函数的乘积成正比：\n$$ p(f(x)|D) \\propto p(D|f(x)) \\, p(f(x)) $$\n先验被给定为一个正态分布：\n$$ p(f(x)) = \\mathcal{N}(f(x) | m_0, \\sigma_f^2) \\propto \\exp\\left(-\\frac{1}{2}\\frac{(f(x) - m_0)^2}{\\sigma_f^2}\\right) $$\n$n$ 次独立同分布观测值 $y_i \\sim \\mathcal{N}(f(x), \\sigma_n^2)$ 的似然函数是：\n$$ p(D|f(x)) = \\prod_{i=1}^n \\mathcal{N}(y_i | f(x), \\sigma_n^2) \\propto \\exp\\left(-\\frac{1}{2\\sigma_n^2} \\sum_{i=1}^n (y_i - f(x))^2\\right) $$\n指数中的求和项可以围绕样本均值 $\\bar{y} = \\frac{1}{n} \\sum_{i=1}^n y_i$ 进行中心化：\n$$ \\sum_{i=1}^n (y_i - f(x))^2 = \\sum_{i=1}^n (y_i - \\bar{y} + \\bar{y} - f(x))^2 = \\sum_{i=1}^n(y_i - \\bar{y})^2 + n(\\bar{y} - f(x))^2 $$\n项 $\\sum_{i=1}^n(y_i - \\bar{y})^2$ 不依赖于 $f(x)$，可以被吸收到归一化常数中。因此，有效似然可以用充分统计量 $\\bar{y}$ 来表示：\n$$ p(D|f(x)) \\propto \\exp\\left(-\\frac{n}{2\\sigma_n^2}(\\bar{y} - f(x))^2\\right) $$\n这表明样本均值的似然是 $p(\\bar{y}|f(x)) = \\mathcal{N}(\\bar{y} | f(x), \\sigma_n^2/n)$。\n\n结合先验和似然，后验分布 $p(f(x)|D)$ 的指数部分（忽略一个加法常数）是：\n$$ -\\frac{1}{2}\\left( \\frac{(f(x) - m_0)^2}{\\sigma_f^2} + \\frac{(f(x) - \\bar{y})^2}{\\sigma_n^2/n} \\right) $$\n展开平方项并收集关于 $f(x)^2$ 和 $f(x)$ 的项：\n$$ -\\frac{1}{2}\\left( f(x)^2\\left(\\frac{1}{\\sigma_f^2} + \\frac{n}{\\sigma_n^2}\\right) - 2f(x)\\left(\\frac{m_0}{\\sigma_f^2} + \\frac{n\\bar{y}}{\\sigma_n^2}\\right) + \\text{const} \\right) $$\n这是 $f(x)$ 的一个正态分布 $\\mathcal{N}(f(x)|m_n, \\sigma_{f,n}^2)$ 的指数部分，其中后验逆方差（精度）$\\frac{1}{\\sigma_{f,n}^2}$ 和后验均值 $m_n$ 可以通过配方法确定：\n$$ \\frac{1}{\\sigma_{f,n}^2} = \\frac{1}{\\sigma_f^2} + \\frac{n}{\\sigma_n^2} $$\n$$ m_n = \\sigma_{f,n}^2 \\left( \\frac{m_0}{\\sigma_f^2} + \\frac{n\\bar{y}}{\\sigma_n^2} \\right) $$\n首先，我们从数据中计算样本均值 $\\bar{y}$：\n$$ \\bar{y} = \\frac{y_1 + y_2 + y_3}{n} = \\frac{972 + 961 + 986}{3} = \\frac{2919}{3} = 973 $$\n现在，代入给定值：$m_0=950$, $\\sigma_f^2=1000$, $\\sigma_n^2=1000$, $n=3$, $\\bar{y}=973$。\n后验方差 $\\sigma_{f,n}^2$ 是：\n$$ \\frac{1}{\\sigma_{f,n}^2} = \\frac{1}{1000} + \\frac{3}{1000} = \\frac{4}{1000} = \\frac{1}{250} \\implies \\sigma_{f,n}^2 = 250 $$\n后验均值 $m_n$ 是：\n$$ m_n = 250 \\left( \\frac{950}{1000} + \\frac{3 \\times 973}{1000} \\right) = \\frac{250}{1000} (950 + 2919) = \\frac{1}{4}(3869) = 967.25 $$\n所以，潜函数的后验分布是 $f(x)|D \\sim \\mathcal{N}(967.25, 250)$。\n\n**2. $y_{*}$ 的后验预测分布**\n\n后验预测分布是给定过去数据 $D$ 的情况下，未来一次观测值 $y_{*}$ 的分布。它通过将 $y_{*}$ 的似然函数对 $f(x)$ 的后验分布进行边缘化得到：\n$$ p(y_{*}|D) = \\int p(y_{*}|f(x)) \\, p(f(x)|D) \\, df(x) $$\n我们有 $y_{*} = f(x) + \\varepsilon_{*}$，其中 $f(x) \\sim \\mathcal{N}(m_n, \\sigma_{f,n}^2)$ 且 $\\varepsilon_{*} \\sim \\mathcal{N}(0, \\sigma_n^2)$。由于 $y_{*}$ 是两个独立正态分布随机变量的和，它也服从正态分布。\n后验预测分布的均值是：\n$$ E[y_{*}|D] = E[f(x) + \\varepsilon_{*}|D] = E[f(x)|D] + E[\\varepsilon_{*}] = m_n + 0 = m_n $$\n后验预测分布的方差是：\n$$ \\text{Var}(y_{*}|D) = \\text{Var}(f(x) + \\varepsilon_{*}|D) = \\text{Var}(f(x)|D) + \\text{Var}(\\varepsilon_{*}) = \\sigma_{f,n}^2 + \\sigma_n^2 $$\n代入计算出的值和给定值：\n$$ E[y_{*}|D] = 967.25 $$\n$$ \\text{Var}(y_{*}|D) = 250 + 1000 = 1250 $$\n按要求四舍五入至四位有效数字：\n-   后验预测均值：$967.3$ 次循环。\n-   后验预测方差：$1250$ (次循环)$^{2}$。\n\n### 第二部分：所需的额外重复测量次数\n\n任务是找到所需的最小非负整数额外重复测量次数 $k$，以使潜函数 $f(x)$ 的后验方差减半。\n\n当前 $n=3$ 次重复测量后的后验方差是 $\\sigma_{f,3}^2 = 250$。\n目标后验方差是 $\\sigma_{f, \\text{target}}^2 = \\frac{1}{2} \\sigma_{f,3}^2 = \\frac{1}{2}(250) = 125$。\n\n设 $N$ 为总重复测量次数。$N$ 次重复测量后的后验方差 $\\sigma_{f,N}^2$ 由以下公式给出：\n$$ \\frac{1}{\\sigma_{f,N}^2} = \\frac{1}{\\sigma_f^2} + \\frac{N}{\\sigma_n^2} $$\n代入已知的方差值：\n$$ \\frac{1}{\\sigma_{f,N}^2} = \\frac{1}{1000} + \\frac{N}{1000} = \\frac{1+N}{1000} $$\n这给出了后验方差作为 $N$ 的函数：\n$$ \\sigma_{f,N}^2 = \\frac{1000}{1+N} $$\n我们需要找到最小的整数 $N$，使得后验方差小于或等于目标方差 $125$。\n$$ \\sigma_{f,N}^2 \\le 125 $$\n$$ \\frac{1000}{1+N} \\le 125 $$\n$$ 1000 \\le 125(1+N) $$\n$$ \\frac{1000}{125} \\le 1+N $$\n$$ 8 \\le 1+N $$\n$$ N \\ge 7 $$\n所需的最小总重复测量次数为 $N=7$。\n由于我们已经进行了 $n=3$ 次重复测量，所需的额外重复测量次数 $k$ 是：\n$$ k = N - n = 7 - 3 = 4 $$\n所需的最小非负整数额外重复测量次数为 $k=4$。\n\n最终答案是一个包含后验预测均值、后验预测方差和 $k$ 的行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n967.3  1250  4\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "有了一个更新的代理模型（即后验分布），我们如何决定在哪里进行下一次昂贵的实验？这就是采集函数的作用。本练习  将让您计算和比较两种流行的采集函数——“改进概率”(PI) 和“上置信界”(UCB)，从而揭示在利用已知良好区域和探索不确定区域之间的基本权衡。",
            "id": "3896133",
            "problem": "一个实验室通过优化一个无量纲的性能目标来自动化锂离子电池配方的电解质盐选择。该性能目标被归一化到区间 $[0,1]$，并结合了模拟的离子电导率和电化学稳定性。该性能通过高斯过程（GP）代理模型进行建模；对于输入 $x$ 处的任何候选盐，未知目标 $f(x)$ 的高斯过程后验预测分布是均值为 $\\mu(x)$、方差为 $\\sigma^{2}(x)$ 的高斯分布。目标是最大化 $f(x)$。\n\n给定三种候选盐 $\\{S_{1},S_{2},S_{3}\\}$，其高斯过程后验摘要是根据在其他设计点上进行的一系列昂贵的多物理场模拟计算得出的。迄今为止观测到的最佳目标值为 $f^{*}=0.95$。使用的改进裕度为 $\\xi=0.01$。上置信界（UCB）探索参数为 $\\beta=4$。对于这三种候选盐，高斯过程后验预测均值和方差如下：\n- $S_{1}$：$\\mu_{1}=0.955$，$\\sigma_{1}^{2}=1.0\\times 10^{-4}$，\n- $S_{2}$：$\\mu_{2}=0.85$，$\\sigma_{2}^{2}=1.44\\times 10^{-2}$，\n- $S_{3}$：$\\mu_{3}=0.95$，$\\sigma_{3}^{2}=4.0\\times 10^{-4}$。\n\n使用以下基本原理：\n- 高斯过程预测模型意味着对于固定的 $x$ 和数据集 $\\mathcal{D}$，有 $f(x)\\mid\\mathcal{D}\\sim\\mathcal{N}(\\mu(x),\\sigma^{2}(x))$。\n- 在 $x$ 处用于最大化的改进概率（PI）采集函数是改进随机变量 $I(x)=\\max\\{0, f(x)-(f^{*}+\\xi)\\}$ 在预测分布下严格为正的概率。\n- 在 $x$ 处用于最大化的上置信界（UCB）采集函数是 $\\mu(x)+\\sqrt{\\beta}\\,\\sigma(x)$，该公式源于次高斯过程的集中不等式。\n\n任务：\n1) 从第一性原理出发，根据 $I(x)$ 的定义和高斯预测模型，推导每个候选盐 $S_{i}$ 的改进概率的解析表达式（用 $\\mu_{i}$、$\\sigma_{i}$、$f^{*}$ 和 $\\xi$ 表示）。对 $S_{1}$、$S_{2}$ 和 $S_{3}$ 数值计算所得表达式。\n2) 使用上置信界的定义，计算每个 $S_{i}$ 处的 UCB 值并进行数值评估。\n3) 根据 PI 和 UCB 的采集值，将三个候选盐从高到低排序。如果采集值完全相等，则优先选择预测均值 $\\mu_{i}$ 较大的候选盐来打破平局。说明每种采集函数会选择哪个候选盐。\n4) 设 $i_{\\mathrm{PI}}\\in\\{1,2,3\\}$ 和 $i_{\\mathrm{UCB}}\\in\\{1,2,3\\}$ 分别表示在上述平局打破规则下，由 PI 和 UCB 选择的候选盐的索引。报告单个整数 $i_{\\mathrm{UCB}}-i_{\\mathrm{PI}}$ 作为你的最终答案。不包括单位。\n\n所有计算都是无量纲的。当需要中间数值时，你可以将标准正态概率近似到至少四位有效数字，但你最终报告的整数 $i_{\\mathrm{UCB}}-i_{\\mathrm{PI}}$ 必须是精确的（对于整数不需要舍入指令）。",
            "solution": "该问题被评估为有效，因为它科学地基于贝叶斯优化的原理，问题设定良好并提供了所有必要信息，并且以客观、正式的语言表达。我们开始解题。\n\n解答分为四个部分，对应于问题陈述中指定的四个任务。\n\n**1) 改进概率（PI）的推导与计算**\n\n改进概率 $\\mathrm{PI}(x)$ 定义为改进随机变量 $I(x) = \\max\\{0, f(x)-(f^{*}+\\xi)\\}$ 严格为正的概率。\n条件 $I(x)  0$ 等价于条件 $f(x) - (f^{*} + \\xi)  0$，即 $f(x)  f^{*} + \\xi$。\n\n问题陈述指出，目标函数 $f(x)$ 的高斯过程后验预测分布是高斯分布：$f(x) \\sim \\mathcal{N}(\\mu(x), \\sigma^2(x))$。\n为计算该概率，我们将随机变量 $f(x)$ 标准化。设 $Z$ 为标准正态随机变量，$Z \\sim \\mathcal{N}(0,1)$。那么我们可以写出 $f(x) = \\mu(x) + \\sigma(x)Z$。\n\n不等式 $f(x)  f^{*} + \\xi$ 变为：\n$$ \\mu(x) + \\sigma(x)Z  f^{*} + \\xi $$\n对 $Z$ 进行整理，我们得到：\n$$ \\sigma(x)Z  f^{*} + \\xi - \\mu(x) $$\n$$ Z  \\frac{f^{*} + \\xi - \\mu(x)}{\\sigma(x)} $$\n因此，概率为：\n$$ \\mathrm{PI}(x) = P\\left(Z  \\frac{f^{*} + \\xi - \\mu(x)}{\\sigma(x)}\\right) $$\n设 $\\Phi(\\cdot)$ 表示标准正态分布的累积分布函数（CDF）。概率 $P(Z  z)$ 可以写成 $1 - \\Phi(z)$，或等价地写成 $\\Phi(-z)$。因此，改进概率的解析表达式为：\n$$ \\mathrm{PI}(x) = \\Phi\\left(\\frac{\\mu(x) - f^{*} - \\xi}{\\sigma(x)}\\right) $$\n现在，我们使用给定的值 $f^{*} = 0.95$ 和 $\\xi = 0.01$ 对这三种候选盐计算该表达式。改进阈值为 $f^{*} + \\xi = 0.95 + 0.01 = 0.96$。\n\n对于候选盐 $S_{1}$：\n$\\mu_{1} = 0.955$ 且 $\\sigma_{1}^{2} = 1.0 \\times 10^{-4}$，所以 $\\sigma_{1} = \\sqrt{1.0 \\times 10^{-4}} = 0.01$。\nCDF的自变量为：\n$$ z_1 = \\frac{\\mu_{1} - (f^{*} + \\xi)}{\\sigma_{1}} = \\frac{0.955 - 0.96}{0.01} = \\frac{-0.005}{0.01} = -0.5 $$\n所以，$\\mathrm{PI}_{1} = \\Phi(-0.5) \\approx 0.3085$。\n\n对于候选盐 $S_{2}$：\n$\\mu_{2} = 0.85$ 且 $\\sigma_{2}^{2} = 1.44 \\times 10^{-2}$，所以 $\\sigma_{2} = \\sqrt{1.44 \\times 10^{-2}} = 0.12$。\nCDF的自变量为：\n$$ z_2 = \\frac{\\mu_{2} - (f^{*} + \\xi)}{\\sigma_{2}} = \\frac{0.85 - 0.96}{0.12} = \\frac{-0.11}{0.12} \\approx -0.9167 $$\n所以，$\\mathrm{PI}_{2} = \\Phi(-0.9167) \\approx 0.1797$。\n\n对于候选盐 $S_{3}$：\n$\\mu_{3} = 0.95$ 且 $\\sigma_{3}^{2} = 4.0 \\times 10^{-4}$，所以 $\\sigma_{3} = \\sqrt{4.0 \\times 10^{-4}} = 0.02$。\nCDF的自变量为：\n$$ z_3 = \\frac{\\mu_{3} - (f^{*} + \\xi)}{\\sigma_{3}} = \\frac{0.95 - 0.96}{0.02} = \\frac{-0.01}{0.02} = -0.5 $$\n所以，$\\mathrm{PI}_{3} = \\Phi(-0.5) \\approx 0.3085$。\n\n**2) 上置信界（UCB）的计算**\n\n上置信界定义为 $\\mathrm{UCB}(x) = \\mu(x) + \\sqrt{\\beta}\\sigma(x)$。\n给定探索参数 $\\beta = 4$，我们有 $\\sqrt{\\beta} = \\sqrt{4} = 2$。我们为每个候选盐计算UCB值。\n\n对于候选盐 $S_{1}$：\n$\\mu_{1} = 0.955$ 且 $\\sigma_{1} = 0.01$。\n$$ \\mathrm{UCB}_{1} = 0.955 + 2 \\times 0.01 = 0.955 + 0.02 = 0.975 $$\n\n对于候选盐 $S_{2}$：\n$\\mu_{2} = 0.85$ 且 $\\sigma_{2} = 0.12$。\n$$ \\mathrm{UCB}_{2} = 0.85 + 2 \\times 0.12 = 0.85 + 0.24 = 1.09 $$\n\n对于候选盐 $S_{3}$：\n$\\mu_{3} = 0.95$ 且 $\\sigma_{3} = 0.02$。\n$$ \\mathrm{UCB}_{3} = 0.95 + 2 \\times 0.02 = 0.95 + 0.04 = 0.99 $$\n\n**3) 候选盐的排序与选择**\n\n我们根据 PI 和 UCB 值，从高到低对候选盐进行排序。\n\n按 PI 排序：\n计算出的 PI 值为 $\\mathrm{PI}_{1} \\approx 0.3085$，$\\mathrm{PI}_{2} \\approx 0.1797$ 和 $\\mathrm{PI}_{3} \\approx 0.3085$。\n我们观察到 $\\mathrm{PI}_{1} = \\mathrm{PI}_{3}  \\mathrm{PI}_{2}$。$S_{1}$ 和 $S_{3}$ 之间存在完全相等的情况。\n平局打破规则规定，优先选择预测均值 $\\mu_{i}$ 较大的候选盐。\n比较 $S_{1}$ 和 $S_{3}$：$\\mu_{1} = 0.955$ 和 $\\mu_{3} = 0.95$。由于 $\\mu_{1}  \\mu_{3}$，候选盐 $S_{1}$ 的排名高于 $S_{3}$。\n最终的 PI 排名为 $S_{1}  S_{3}  S_{2}$。\nPI 采集函数选择的候选盐是 $S_{1}$。因此，$i_{\\mathrm{PI}} = 1$。\n\n按 UCB 排序：\n计算出的 UCB 值为 $\\mathrm{UCB}_{1} = 0.975$，$\\mathrm{UCB}_{2} = 1.09$ 和 $\\mathrm{UCB}_{3} = 0.99$。\n比较这些值，我们得到 $1.09  0.99  0.975$。\nUCB 排名为 $S_{2}  S_{3}  S_{1}$。\nUCB 采集函数选择的候选盐是 $S_{2}$。因此，$i_{\\mathrm{UCB}} = 2$。\n\n**4) 最终计算**\n\n问题要求计算整数值 $i_{\\mathrm{UCB}} - i_{\\mathrm{PI}}$。\n我们发现 $i_{\\mathrm{PI}} = 1$ 且 $i_{\\mathrm{UCB}} = 2$。\n因此，最终结果是：\n$$ i_{\\mathrm{UCB}} - i_{\\mathrm{PI}} = 2 - 1 = 1 $$\n这是需要报告的最终整数。",
            "answer": "$$\\boxed{1}$$"
        }
    ]
}