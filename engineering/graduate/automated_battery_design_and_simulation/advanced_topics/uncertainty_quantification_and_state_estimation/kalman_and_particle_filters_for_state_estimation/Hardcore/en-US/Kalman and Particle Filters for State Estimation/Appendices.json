{
    "hands_on_practices": [
        {
            "introduction": "To truly understand the Kalman Filter, we must move beyond the abstract equations and perform the calculations ourselves. This first exercise guides you through one complete prediction-correction cycle of a KF applied to a common battery model . By computing each component from the predicted state to the final updated covariance, you will gain a concrete understanding of how the filter ingests new information to refine its estimate of the battery's internal state.",
            "id": "3922746",
            "problem": "Consider a Lithium-Ion cell approximated by a one resistor–capacitor (1-RC) Thevenin equivalent under constant-current sampling over the interval. The internal RC polarization voltage and State of Charge (SoC) are modeled in discrete time by a linear Gaussian state-space system. Let the state be $x_{k} = \\begin{pmatrix} v_{\\mathrm{rc},k} \\\\ z_{k} \\end{pmatrix}$, where $v_{\\mathrm{rc},k}$ is the RC branch voltage and $z_{k}$ is the SoC (expressed as a fraction between $0$ and $1$). The current input is $u_{k}$ (positive for discharge), and the measured terminal voltage is $y_{k}$. The discrete-time dynamics and measurement are given by\n$$\nx_{k+1} = A_{d}\\,x_{k} + B_{d}\\,u_{k} + w_{k}, \\quad w_{k} \\sim \\mathcal{N}(0, Q_{d}),\n$$\n$$\ny_{k} = V_{0} + C_{d}\\,x_{k} + D_{d}\\,u_{k} + \\eta_{k}, \\quad \\eta_{k} \\sim \\mathcal{N}(0, R),\n$$\nwith known matrices and scalars\n$$\nA_{d} = \\begin{pmatrix} 0.951229 & 0 \\\\ 0 & 1 \\end{pmatrix}, \\quad B_{d} = \\begin{pmatrix} -0.0004877 \\\\ -5.5556 \\times 10^{-5} \\end{pmatrix}, \\quad C_{d} = \\begin{pmatrix} -1 & 0.2 \\end{pmatrix}, \\quad D_{d} = -0.02,\n$$\n$$\nQ_{d} = \\begin{pmatrix} 1.0 \\times 10^{-5} & 0 \\\\ 0 & 1.0 \\times 10^{-6} \\end{pmatrix}, \\quad R = 1.0 \\times 10^{-4}, \\quad V_{0} = 3.7.\n$$\nAssume a prior state estimate and covariance at time $k=0$ of\n$$\nx_{0|0} = \\begin{pmatrix} 0.050 \\\\ 0.800 \\end{pmatrix}, \\quad P_{0|0} = \\begin{pmatrix} 2.0 \\times 10^{-3} & 0 \\\\ 0 & 4.0 \\times 10^{-4} \\end{pmatrix}.\n$$\nYou are given the following sequence of current inputs and measured terminal voltages:\n$$\nu_{1} = 2.0, \\quad y_{1} = 3.760; \\quad u_{2} = 1.5, \\quad y_{2} = 3.770; \\quad u_{3} = 0.0, \\quad y_{3} = 3.780.\n$$\nStarting from the fundamental definition of a discrete-time linear Gaussian state-space model and the minimum-variance linear estimator, perform one complete iteration of the Kalman Filter (KF) at $k=1$ using the pair $(u_{1}, y_{1})$ to compute:\n- the predicted state $x_{1|0}$,\n- the innovation $v_{1}$,\n- the innovation covariance $S_{1}$,\n- the Kalman gain $K_{1}$,\n- the updated state $x_{1|1}$,\n- and the updated covariance $P_{1|1}$ (use the Joseph-stabilized form for the covariance update).\n\nReport voltages in $\\mathrm{V}$, SoC as a unitless fraction, and covariances in the appropriate squared units; the innovation and its covariance pertain to the voltage channel. Round your final numerical values to four significant figures. Express the final answer as a single row matrix containing, in order,\n$$\n\\big( v_{\\mathrm{rc},1|0}, \\, z_{1|0}, \\, v_{1}, \\, S_{1}, \\, K_{1}^{(1)}, \\, K_{1}^{(2)}, \\, v_{\\mathrm{rc},1|1}, \\, z_{1|1}, \\, P_{1|1}^{(1,1)}, \\, P_{1|1}^{(1,2)}, \\, P_{1|1}^{(2,1)}, \\, P_{1|1}^{(2,2)} \\big).\n$$\nDo not include units in the boxed final answer.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded, well-posed, objective, and contains all necessary information to perform one iteration of a discrete-time Kalman Filter. The model is a standard linear-Gaussian state-space representation of a battery's electrical behavior, and the requested task is a direct application of a well-established algorithm.\n\nThe Kalman Filter is a recursive algorithm that provides the optimal (in the minimum mean square error sense) estimate of the state of a linear-Gaussian system. It operates in a two-step cycle: a prediction (or time update) step and a correction (or measurement update) step.\n\nLet the state estimate at time step $k-1$ be $x_{k-1|k-1}$ with its associated error covariance $P_{k-1|k-1}$. The system is described by:\n$$x_{k} = A_{d}\\,x_{k-1} + B_{d}\\,u_{k-1} + w_{k-1}, \\quad w_{k-1} \\sim \\mathcal{N}(0, Q_{d})$$\n$$y_{k} = H_{d}\\,x_{k} + E_{d}\\,u_{k} + v_{k}, \\quad v_{k} \\sim \\mathcal{N}(0, R)$$\nFor this problem, the measurement equation is given as $y_{k} = V_{0} + C_{d}\\,x_{k} + D_{d}\\,u_{k} + \\eta_{k}$. To align this with the standard form, we can define a modified measurement $y'_{k} = y_{k} - V_{0} - D_{d}u_{k}$. The measurement equation then becomes $y'_{k} = C_{d}x_{k} + \\eta_{k}$. The innovation will be computed with respect to the original form.\n\nThe initial conditions at time $k=0$ are provided:\n$$x_{0|0} = \\begin{pmatrix} 0.050 \\\\ 0.800 \\end{pmatrix}, \\quad P_{0|0} = \\begin{pmatrix} 2.0 \\times 10^{-3} & 0 \\\\ 0 & 4.0 \\times 10^{-4} \\end{pmatrix}$$\nThe task is to perform one full iteration for $k=1$, using the input $u_{1} = 2.0$ and measurement $y_{1} = 3.760$.\n\n**Step 1: Prediction (Time Update)**\n\nThe prediction step projects the state and covariance from $k=0$ to $k=1$, before incorporating the measurement at $k=1$.\n\nThe predicted state mean $x_{1|0}$ is calculated as:\n$$x_{1|0} = A_{d}\\,x_{0|0} + B_{d}\\,u_{1}$$\n$$x_{1|0} = \\begin{pmatrix} 0.951229 & 0 \\\\ 0 & 1 \\end{pmatrix} \\begin{pmatrix} 0.050 \\\\ 0.800 \\end{pmatrix} + \\begin{pmatrix} -0.0004877 \\\\ -5.5556 \\times 10^{-5} \\end{pmatrix} (2.0)$$\n$$x_{1|0} = \\begin{pmatrix} 0.04756145 \\\\ 0.800 \\end{pmatrix} + \\begin{pmatrix} -0.0009754 \\\\ -0.000111112 \\end{pmatrix} = \\begin{pmatrix} 0.04658605 \\\\ 0.79988889 \\end{pmatrix}$$\nSo, $v_{\\mathrm{rc},1|0} \\approx 0.046586$ and $z_{1|0} \\approx 0.79989$.\n\nThe predicted error covariance $P_{1|0}$ is calculated as:\n$$P_{1|0} = A_{d}\\,P_{0|0}\\,A_{d}^T + Q_{d}$$\n$$P_{1|0} = \\begin{pmatrix} 0.951229 & 0 \\\\ 0 & 1 \\end{pmatrix} \\begin{pmatrix} 0.002 & 0 \\\\ 0 & 0.0004 \\end{pmatrix} \\begin{pmatrix} 0.951229 & 0 \\\\ 0 & 1 \\end{pmatrix}^T + \\begin{pmatrix} 1.0 \\times 10^{-5} & 0 \\\\ 0 & 1.0 \\times 10^{-6} \\end{pmatrix}$$\n$$P_{1|0} = \\begin{pmatrix} (0.951229)^2(0.002) & 0 \\\\ 0 & (1)^2(0.0004) \\end{pmatrix} + \\begin{pmatrix} 0.00001 & 0 \\\\ 0 & 0.000001 \\end{pmatrix}$$\n$$P_{1|0} = \\begin{pmatrix} 0.00180967 & 0 \\\\ 0 & 0.0004 \\end{pmatrix} + \\begin{pmatrix} 0.00001 & 0 \\\\ 0 & 0.000001 \\end{pmatrix} = \\begin{pmatrix} 0.00181967 & 0 \\\\ 0 & 0.000401 \\end{pmatrix}$$\n\n**Step 2: Correction (Measurement Update)**\n\nThe correction step refines the predicted state and covariance using the measurement $y_{1}$.\n\nThe innovation, or measurement residual, $v_{1}$ is the difference between the actual measurement and the predicted measurement:\n$$v_{1} = y_{1} - \\hat{y}_{1|0} = y_{1} - (V_{0} + C_{d}\\,x_{1|0} + D_{d}\\,u_{1})$$\n$$v_{1} = 3.760 - \\left( 3.7 + \\begin{pmatrix} -1 & 0.2 \\end{pmatrix} \\begin{pmatrix} 0.04658605 \\\\ 0.79988889 \\end{pmatrix} + (-0.02)(2.0) \\right)$$\n$$v_{1} = 3.760 - (3.7 - 0.04658605 + 0.15997778 - 0.04) = 3.760 - 3.77339173 = -0.01339173$$\n\nThe innovation covariance $S_{1}$ is calculated as:\n$$S_{1} = C_{d}\\,P_{1|0}\\,C_{d}^T + R$$\n$$S_{1} = \\begin{pmatrix} -1 & 0.2 \\end{pmatrix} \\begin{pmatrix} 0.00181967 & 0 \\\\ 0 & 0.000401 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 0.2 \\end{pmatrix} + 1.0 \\times 10^{-4}$$\n$$S_{1} = ((-1)^2(0.00181967) + (0.2)^2(0.000401)) + 0.0001$$\n$$S_{1} = (0.00181967 + 0.00001604) + 0.0001 = 0.00183571 + 0.0001 = 0.00193571$$\n\nThe optimal Kalman gain $K_{1}$ is:\n$$K_{1} = P_{1|0}\\,C_{d}^T\\,S_{1}^{-1}$$\n$$P_{1|0}\\,C_{d}^T = \\begin{pmatrix} 0.00181967 & 0 \\\\ 0 & 0.000401 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 0.2 \\end{pmatrix} = \\begin{pmatrix} -0.00181967 \\\\ 0.0000802 \\end{pmatrix}$$\n$$K_{1} = \\begin{pmatrix} -0.00181967 \\\\ 0.0000802 \\end{pmatrix} (0.00193571)^{-1} = \\begin{pmatrix} -0.940053 \\\\ 0.0414320 \\end{pmatrix}$$\nThus, $K_{1}^{(1)} \\approx -0.94005$ and $K_{1}^{(2)} \\approx 0.041432$.\n\nThe updated state estimate $x_{1|1}$ is:\n$$x_{1|1} = x_{1|0} + K_{1}\\,v_{1}$$\n$$x_{1|1} = \\begin{pmatrix} 0.04658605 \\\\ 0.79988889 \\end{pmatrix} + \\begin{pmatrix} -0.940053 \\\\ 0.0414320 \\end{pmatrix} (-0.01339173)$$\n$$x_{1|1} = \\begin{pmatrix} 0.04658605 \\\\ 0.79988889 \\end{pmatrix} + \\begin{pmatrix} 0.0125889 \\\\ -0.0005548 \\end{pmatrix} = \\begin{pmatrix} 0.059175 \\\\ 0.799334 \\end{pmatrix}$$\nSo, $v_{\\mathrm{rc},1|1} \\approx 0.059175$ and $z_{1|1} \\approx 0.79933$.\n\nThe updated error covariance $P_{1|1}$ is calculated using the Joseph-stabilized form as requested, which guarantees symmetry and positive semi-definiteness:\n$$P_{1|1} = (I - K_{1}\\,C_{d})\\,P_{1|0}\\,(I - K_{1}\\,C_{d})^T + K_{1}\\,R\\,K_{1}^T$$\nFirst term calculation:\n$$I - K_{1}\\,C_{d} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} - \\begin{pmatrix} -0.940053 \\\\ 0.0414320 \\end{pmatrix}\\begin{pmatrix} -1 & 0.2 \\end{pmatrix} = \\begin{pmatrix} 1-0.940053 & 0.1880106 \\\\ 0.0414320 & 1-0.0082864 \\end{pmatrix} = \\begin{pmatrix} 0.059947 & 0.1880106 \\\\ 0.0414320 & 0.9917136 \\end{pmatrix}$$\nLet $M = I-K_1 C_d$. The first term is $M P_{1|0} M^T$:\n$$ M P_{1|0} M^T \\approx \\begin{pmatrix} 2.0713 \\times 10^{-5} & 7.9287 \\times 10^{-5} \\\\ 7.9287 \\times 10^{-5} & 3.9751 \\times 10^{-4} \\end{pmatrix}$$\nSecond term calculation, $K_{1}\\,R\\,K_{1}^T$:\n$$K_{1}\\,R\\,K_{1}^T = \\begin{pmatrix} -0.940053 \\\\ 0.0414320 \\end{pmatrix} (1.0 \\times 10^{-4}) \\begin{pmatrix} -0.940053 & 0.0414320 \\end{pmatrix}$$\n$$K_{1}\\,R\\,K_{1}^T \\approx \\begin{pmatrix} 8.8370 \\times 10^{-5} & -3.8943 \\times 10^{-6} \\\\ -3.8943 \\times 10^{-6} & 1.7166 \\times 10^{-7} \\end{pmatrix}$$\nAdding the two terms:\n$$P_{1|1} = \\begin{pmatrix} 2.0713 \\times 10^{-5} + 8.8370 \\times 10^{-5} & 7.9287 \\times 10^{-5} - 3.8943 \\times 10^{-6} \\\\ 7.9287 \\times 10^{-5} - 3.8943 \\times 10^{-6} & 3.9751 \\times 10^{-4} + 1.7166 \\times 10^{-7} \\end{pmatrix}$$\n$$P_{1|1} = \\begin{pmatrix} 1.09083 \\times 10^{-4} & 7.5393 \\times 10^{-5} \\\\ 7.5393 \\times 10^{-5} & 3.9768 \\times 10^{-4} \\end{pmatrix}$$\n\nRounding the final results to four significant figures:\n$v_{\\mathrm{rc},1|0} \\approx 0.04659$\n$z_{1|0} \\approx 0.7999$\n$v_{1} \\approx -0.01339$\n$S_{1} \\approx 0.001936$\n$K_{1}^{(1)} \\approx -0.9401$\n$K_{1}^{(2)} \\approx 0.04143$\n$v_{\\mathrm{rc},1|1} \\approx 0.05917$\n$z_{1|1} \\approx 0.7993$\n$P_{1|1}^{(1,1)} \\approx 1.091 \\times 10^{-4}$\n$P_{1|1}^{(1,2)} \\approx 7.539 \\times 10^{-5}$\n$P_{1|1}^{(2,1)} \\approx 7.539 \\times 10^{-5}$\n$P_{1|1}^{(2,2)} \\approx 3.977 \\times 10^{-4}$\n\nThese values are formatted into the required row matrix for the final answer.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.04659 & 0.7999 & -0.01339 & 0.001936 & -0.9401 & 0.04143 & 0.05917 & 0.7993 & 0.0001091 & 0.00007539 & 0.00007539 & 0.0003977\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A filter is only as good as the information it receives from the measurements. This next practice explores the crucial concept of observability, which determines whether the internal states—like State of Charge (SOC)—can be uniquely inferred from the output voltage . You will derive the mathematical condition for observability and discover why SOC estimation becomes unreliable in flat regions of the Open-Circuit Voltage curve, a common and critical challenge in battery management.",
            "id": "3922787",
            "problem": "A single-cell lithium-ion battery is modeled for state estimation using a discrete-time equivalent-circuit model with one resistor-capacitor (RC) pair. The state vector is $x_k = [\\, z_k \\;\\; v_k \\,]^{\\top}$, where $z_k$ is the State of Charge (SOC) and $v_k$ is the RC overpotential. The known input is the applied current $u_k = I_k$ (positive for discharge). The sampling period is $\\Delta t > 0$. The dynamics and measurement are\n$$\n\\begin{aligned}\nz_{k+1} &= z_k - \\frac{\\Delta t}{Q} \\, I_k, \\\\\nv_{k+1} &= a \\, v_k + b \\, I_k, \\\\\ny_k &= V_{oc}(z_k) - v_k - R_0 I_k + \\nu_k,\n\\end{aligned}\n$$\nwhere $Q>0$ is capacity, $R_0>0$ is ohmic resistance, $a = \\exp\\!\\left(-\\frac{\\Delta t}{R_1 C_1}\\right)$ with $R_1>0$ and $C_1>0$, and $b = R_1 \\left(1-a\\right)$. The output uses an Open Circuit Voltage (OCV) map $V_{oc}(z)$, and $\\nu_k$ is zero-mean measurement noise. This can be written in the form $y_k = V_{oc}(z_k) + h(x_k) + \\nu_k$ with $h(x_k) = -v_k - R_0 I_k$. Consider local weak observability of the nonlinear system around a fixed operating point $(x^{\\star}, u^{\\star})$ where the OCV slope $\\gamma := \\left.\\frac{d V_{oc}}{dz}\\right|_{z^{\\star}}$ is small, i.e., the OCV curve is locally flat.\n\nUsing only first principles (linearization via first-order Taylor expansion and the rank condition for local weak observability of discrete-time nonlinear systems based on the linearized observability matrix), perform the following:\n\n- Derive the state Jacobian $A_k := \\left.\\frac{\\partial f}{\\partial x}\\right|_{(x^{\\star}, u^{\\star})}$ and the measurement Jacobian $C_k := \\left.\\frac{\\partial g}{\\partial x}\\right|_{(x^{\\star}, u^{\\star})}$ for the given model.\n- Form the local $2 \\times 2$ observability matrix $\\mathcal{O}_k := \\begin{bmatrix} C_k \\\\ C_k A_k \\end{bmatrix}$ at $(x^{\\star}, u^{\\star})$.\n- Compute the determinant $\\det(\\mathcal{O}_k)$ in closed form, simplified in terms of $\\gamma$, $\\Delta t$, $R_1$, and $C_1$.\n\nBased on the determinant, state the condition for local weak observability at $(x^{\\star}, u^{\\star})$ when $\\gamma$ is near zero (flat OCV region), and briefly justify it from your derivation. Express the final determinant in volts (V). The final answer must be the single closed-form analytic expression for $\\det(\\mathcal{O}_k)$.",
            "solution": "The user has provided a problem statement that requires validating and, if valid, solving.\n\n### Step 1: Problem Validation\n\nThe first step is to extract the given information and validate the problem's integrity.\n\n**Extracted Givens:**\n- **State vector:** $x_k = [\\, z_k \\;\\; v_k \\,]^{\\top}$.\n- **State variables:** $z_k$ is State of Charge (SOC, unitless), $v_k$ is RC overpotential (Volts).\n- **Input:** $u_k = I_k$, applied current.\n- **Sampling period:** $\\Delta t > 0$.\n- **State dynamics:**\n  $z_{k+1} = z_k - \\frac{\\Delta t}{Q} \\, I_k$\n  $v_{k+1} = a \\, v_k + b \\, I_k$\n  This can be written as $x_{k+1} = f(x_k, u_k) = \\begin{bmatrix} z_k - \\frac{\\Delta t}{Q} I_k \\\\ a v_k + b I_k \\end{bmatrix}$.\n- **Measurement model:**\n  $y_k = V_{oc}(z_k) - v_k - R_0 I_k + \\nu_k$\n  This can be written as $y_k = g(x_k, u_k) + \\nu_k$, where $g(x_k, u_k) = V_{oc}(z_k) - v_k - R_0 I_k$.\n- **Parameters:**\n  - $Q > 0$ (Capacity)\n  - $R_0 > 0$ (Ohmic resistance)\n  - $R_1 > 0$, $C_1 > 0$ (RC pair parameters)\n  - $a = \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right)$\n  - $b = R_1 (1-a)$\n- **Noise:** $\\nu_k$ is zero-mean measurement noise.\n- **Operating point:** A fixed point $(x^{\\star}, u^{\\star})$, where $x^{\\star}=[z^{\\star}, v^{\\star}]^{\\top}$ and $u^{\\star}=I^{\\star}$.\n- **OCV slope:** $\\gamma := \\left.\\frac{d V_{oc}}{dz}\\right|_{z^{\\star}}$.\n- **Task:** Derive state Jacobian $A_k$, measurement Jacobian $C_k$, form observability matrix $\\mathcal{O}_k = \\begin{bmatrix} C_k \\\\ C_k A_k \\end{bmatrix}$, and compute its determinant $\\det(\\mathcal{O}_k)$. Then, analyze the condition for local weak observability.\n\n**Validation Verdict:**\nThe problem is scientifically grounded, well-posed, and objective. It describes a standard equivalent-circuit model for a lithium-ion battery and asks for a standard local observability analysis. The model is a widely used simplification in battery management systems. The terminology, equations, and requested tasks are all standard in control theory and its applications to electrochemical systems. All necessary information is provided, and there are no internal contradictions. The problem is deemed **valid**.\n\n### Step 2: Derivation and Solution\n\nWe proceed with solving the validated problem. The analysis is performed by linearizing the nonlinear system around the specified operating point $(x^{\\star}, u^{\\star})$.\n\nFirst, we define the nonlinear state transition function $f(x_k, u_k)$ and the measurement function $g(x_k, u_k)$:\n$$\nf(x_k, u_k) = \\begin{bmatrix} f_1(x_k, u_k) \\\\ f_2(x_k, u_k) \\end{bmatrix} = \\begin{bmatrix} z_k - \\frac{\\Delta t}{Q} I_k \\\\ a v_k + b I_k \\end{bmatrix}\n$$\n$$\ng(x_k, u_k) = V_{oc}(z_k) - v_k - R_0 I_k\n$$\nThe state vector is $x_k = \\begin{bmatrix} z_k \\\\ v_k \\end{bmatrix}$.\n\n**Derivation of the State Jacobian $A_k$**\n\nThe state Jacobian matrix $A_k$ is the partial derivative of the state function $f$ with respect to the state vector $x$, evaluated at the operating point $(x^{\\star}, u^{\\star})$.\n$$\nA_k = \\left.\\frac{\\partial f}{\\partial x}\\right|_{(x^{\\star}, u^{\\star})} = \\left. \\begin{bmatrix} \\frac{\\partial f_1}{\\partial z_k} & \\frac{\\partial f_1}{\\partial v_k} \\\\ \\frac{\\partial f_2}{\\partial z_k} & \\frac{\\partial f_2}{\\partial v_k} \\end{bmatrix} \\right|_{(x^{\\star}, u^{\\star})}\n$$\nWe compute the individual partial derivatives:\n- $\\frac{\\partial f_1}{\\partial z_k} = \\frac{\\partial}{\\partial z_k} \\left( z_k - \\frac{\\Delta t}{Q} I_k \\right) = 1$\n- $\\frac{\\partial f_1}{\\partial v_k} = \\frac{\\partial}{\\partial v_k} \\left( z_k - \\frac{\\Delta t}{Q} I_k \\right) = 0$\n- $\\frac{\\partial f_2}{\\partial z_k} = \\frac{\\partial}{\\partial z_k} \\left( a v_k + b I_k \\right) = 0$\n- $\\frac{\\partial f_2}{\\partial v_k} = \\frac{\\partial}{\\partial v_k} \\left( a v_k + b I_k \\right) = a$\n\nThe resulting Jacobian $A_k$ is constant and does not depend on the operating point:\n$$\nA_k = \\begin{bmatrix} 1 & 0 \\\\ 0 & a \\end{bmatrix}\n$$\n\n**Derivation of the Measurement Jacobian $C_k$**\n\nThe measurement Jacobian matrix $C_k$ is the partial derivative of the measurement function $g$ with respect to the state vector $x$, evaluated at the operating point $(x^{\\star}, u^{\\star})$.\n$$\nC_k = \\left.\\frac{\\partial g}{\\partial x}\\right|_{(x^{\\star}, u^{\\star})} = \\left. \\begin{bmatrix} \\frac{\\partial g}{\\partial z_k} & \\frac{\\partial g}{\\partial v_k} \\end{bmatrix} \\right|_{(x^{\\star}, u^{\\star})}\n$$\nWe compute the individual partial derivatives:\n- $\\frac{\\partial g}{\\partial z_k} = \\frac{\\partial}{\\partial z_k} \\left( V_{oc}(z_k) - v_k - R_0 I_k \\right) = \\frac{d V_{oc}}{dz_k}$\n- $\\frac{\\partial g}{\\partial v_k} = \\frac{\\partial}{\\partial v_k} \\left( V_{oc}(z_k) - v_k - R_0 I_k \\right) = -1$\n\nEvaluating these at the operating point $x^{\\star} = [z^{\\star}, v^{\\star}]^{\\top}$, and using the given definition $\\gamma = \\left.\\frac{d V_{oc}}{dz}\\right|_{z^{\\star}}$, we get:\n$$\nC_k = \\begin{bmatrix} \\gamma & -1 \\end{bmatrix}\n$$\n\n**Formation of the Observability Matrix $\\mathcal{O}_k$**\n\nThe local observability matrix for this $2$-state system is given by $\\mathcal{O}_k = \\begin{bmatrix} C_k \\\\ C_k A_k \\end{bmatrix}$.\nWe first compute the product $C_k A_k$:\n$$\nC_k A_k = \\begin{bmatrix} \\gamma & -1 \\end{bmatrix} \\begin{bmatrix} 1 & 0 \\\\ 0 & a \\end{bmatrix} = \\begin{bmatrix} (\\gamma)(1) + (-1)(0) & (\\gamma)(0) + (-1)(a) \\end{bmatrix} = \\begin{bmatrix} \\gamma & -a \\end{bmatrix}\n$$\nNow, we assemble the observability matrix $\\mathcal{O}_k$:\n$$\n\\mathcal{O}_k = \\begin{bmatrix} C_k \\\\ C_k A_k \\end{bmatrix} = \\begin{bmatrix} \\gamma & -1 \\\\ \\gamma & -a \\end{bmatrix}\n$$\n\n**Computation of the Determinant $\\det(\\mathcal{O}_k)$**\n\nThe determinant of the $2 \\times 2$ observability matrix is:\n$$\n\\det(\\mathcal{O}_k) = (\\gamma)(-a) - (-1)(\\gamma) = -\\gamma a + \\gamma = \\gamma(1 - a)\n$$\nThe problem requires the result in terms of $\\gamma$, $\\Delta t$, $R_1$, and $C_1$. We substitute the expression for $a$:\n$$\n\\det(\\mathcal{O}_k) = \\gamma \\left( 1 - \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right) \\right)\n$$\nThe unit of $\\gamma$ is Volts (since $V_{oc}$ is in Volts and $z$ is unitless). The term $(1-a)$ is unitless. Therefore, the determinant has units of Volts (V), as requested.\n\n**Condition for Local Weak Observability**\n\nA discrete-time nonlinear system is locally weakly observable around an operating point if its linearized observability matrix $\\mathcal{O}_k$ has full rank. For our $2 \\times 2$ matrix $\\mathcal{O}_k$, this condition is equivalent to its determinant being non-zero:\n$$\n\\det(\\mathcal{O}_k) \\neq 0\n$$\n$$\n\\gamma \\left( 1 - \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right) \\right) \\neq 0\n$$\nThis condition requires two factors to be non-zero:\n1.  Since $\\Delta t > 0$, $R_1 > 0$, and $C_1 > 0$, the exponent $-\\frac{\\Delta t}{R_1 C_1}$ is strictly negative. This means $\\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right)$ is a positive number strictly less than $1$. Therefore, the term $\\left( 1 - \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right) \\right)$ is always strictly greater than $0$.\n2.  Consequently, the observability condition simplifies to $\\gamma \\neq 0$.\n\nWhen the OCV curve is locally flat, $\\gamma = \\left.\\frac{d V_{oc}}{dz}\\right|_{z^{\\star}}$ is near zero. As $\\gamma \\rightarrow 0$, we have $\\det(\\mathcal{O}_k) \\rightarrow 0$. A determinant of zero implies the observability matrix is singular (rank-deficient). A near-zero determinant indicates that the matrix is ill-conditioned, and the system is poorly observable. This means that small amounts of noise can make it practically impossible to distinguish the effects of the SOC $z_k$ and the overpotential $v_k$ on the output voltage $y_k$. The state estimates, particularly for SOC, will be unreliable. In physical terms, if the open-circuit voltage does not change with the state of charge, there is no way to estimate the state of charge from a voltage measurement, rendering the SOC state unobservable.",
            "answer": "$$\n\\boxed{\\gamma \\left( 1 - \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right) \\right)}\n$$"
        },
        {
            "introduction": "When system nonlinearities become too challenging for the Kalman Filter, the Particle Filter (PF) offers a powerful, sample-based alternative. This exercise focuses on the core mechanics of the PF's measurement update and health management . You will update particle weights based on a new measurement and then calculate the effective sample size ($N_{\\text{eff}}$) to diagnose filter degeneracy, a critical step that determines if resampling is necessary to maintain a healthy population of state hypotheses.",
            "id": "3922794",
            "problem": "Consider a particle-based Bayesian state estimator for a lithium-ion cell within an automated battery design and simulation pipeline. The estimator uses a Particle Filter (PF) to track the battery’s internal state and applies a nonlinear measurement model for terminal voltage. Assume the voltage measurement at time $k$ is modeled by $y_{k} = h(x_{k}) + v_{k}$, where $h(\\cdot)$ is a nonlinear function of the battery state $x_{k}$ and $v_{k}$ is zero-mean Gaussian measurement noise with standard deviation $\\sigma_{v}$. Prior to receiving $y_{k}$, the PF holds $N=5$ propagated particles $\\{x_{k}^{(i)}\\}_{i=1}^{5}$ with equal prior weights $w_{k-1}^{(i)} = \\frac{1}{5}$, and their predicted terminal voltages under the model $h(\\cdot)$ are given by\n$$\n\\hat{v}_{k}^{(1)} = 3.95,\\quad \\hat{v}_{k}^{(2)} = 3.90,\\quad \\hat{v}_{k}^{(3)} = 4.00,\\quad \\hat{v}_{k}^{(4)} = 3.96,\\quad \\hat{v}_{k}^{(5)} = 3.88,\n$$\nin volts. Suppose the new measurement is $y_{k} = 3.95$ volts and the measurement noise standard deviation is $\\sigma_{v} = 0.01$ volts. The resampling threshold is set to $\\tau = 0.5 N$.\n\nStarting from the foundational principles of Bayesian inference and the definition of the Gaussian likelihood for $v_{k}$, perform the measurement update to obtain the normalized posterior importance weights $\\{w_{k}^{(i)}\\}_{i=1}^{5}$. Then, starting from the core definition of the effective sample size as a measure of weight degeneracy in importance sampling, derive the expression used to compute the effective sample size and evaluate it numerically for the given data.\n\nDecide whether resampling should be triggered by comparing the effective sample size to the threshold $\\tau$. Round the effective sample size to four significant figures. Express the final answer as a row matrix containing two entries: the rounded effective sample size and a binary resampling decision indicator $I$, where $I = 1$ if resampling is triggered and $I = 0$ otherwise. No physical units are required in the final answer.",
            "solution": "The problem requires a two-part calculation: first, the update of the particle weights based on a new measurement, and second, the calculation of the effective sample size to decide on resampling.\n\n### Part 1: Measurement Update of Particle Weights\n\nThe core of the Particle Filter's measurement update step is rooted in Bayesian inference. The posterior belief is proportional to the prior belief multiplied by the likelihood of the measurement. For each particle, this translates to updating its weight:\n$$\nw_{k}^{(i)} \\propto w_{k-1}^{(i)} \\cdot p(y_k | x_k^{(i)})\n$$\nHere, $w_{k-1}^{(i)}$ is the prior weight and $p(y_k | x_k^{(i)})$ is the likelihood of observing the measurement $y_k$ given the state of particle $i$.\n\nThe problem states that the prior weights are uniform ($w_{k-1}^{(i)} = 1/5$). The measurement model is $y_{k} = h(x_{k}) + v_{k}$, where $v_{k} \\sim \\mathcal{N}(0, \\sigma_v^2)$. This implies that the likelihood function $p(y_k | x_k^{(i)})$ is a Gaussian probability density function. Since the prior weights are constant, the unnormalized posterior weight, $\\tilde{w}_k^{(i)}$, is proportional to the likelihood (ignoring constant PDF terms):\n$$\n\\tilde{w}_k^{(i)} = \\exp\\left(-\\frac{(y_k - h(x_k^{(i)}))^2}{2\\sigma_v^2}\\right)\n$$\nWe are given $y_k = 3.95$ and $\\sigma_v = 0.01$, so $\\sigma_v^2 = 0.0001$. We use the predicted measurements $\\hat{v}_k^{(i)} = h(x_k^{(i)})$ to calculate the unnormalized weights:\n*   $\\tilde{w}_k^{(1)} = \\exp\\left(-\\frac{(3.95 - 3.95)^2}{0.0002}\\right) = \\exp(0) = 1$\n*   $\\tilde{w}_k^{(2)} = \\exp\\left(-\\frac{(3.95 - 3.90)^2}{0.0002}\\right) = \\exp(-12.5)$\n*   $\\tilde{w}_k^{(3)} = \\exp\\left(-\\frac{(3.95 - 4.00)^2}{0.0002}\\right) = \\exp(-12.5)$\n*   $\\tilde{w}_k^{(4)} = \\exp\\left(-\\frac{(3.95 - 3.96)^2}{0.0002}\\right) = \\exp(-0.5)$\n*   $\\tilde{w}_k^{(5)} = \\exp\\left(-\\frac{(3.95 - 3.88)^2}{0.0002}\\right) = \\exp(-24.5)$\n\n### Part 2: Effective Sample Size and Resampling Decision\n\nThe effective sample size, $N_{\\text{eff}}$, quantifies the degeneracy of the particle weights. A principled choice is derived by equating the sum of the squares of the current weights to that of an ideal set of $N_{\\text{eff}}$ particles with uniform weights:\n$$\n\\frac{1}{N_{\\text{eff}}} = \\sum_{i=1}^{N} (w_k^{(i)})^2 \\quad \\implies \\quad N_{\\text{eff}} = \\frac{1}{\\sum_{i=1}^{N} (w_k^{(i)})^2}\n$$\nThe value of $N_{\\text{eff}}$ ranges from $1$ (complete degeneracy) to $N$ (no degeneracy). For computational convenience, it can be calculated using the unnormalized weights:\n$$\nN_{\\text{eff}} = \\frac{\\left(\\sum_i \\tilde{w}_k^{(i)}\\right)^2}{\\sum_i (\\tilde{w}_k^{(i)})^2}\n$$\nLet's compute the two sums:\n$S_w = \\sum_{i=1}^5 \\tilde{w}_k^{(i)} = 1 + 2\\exp(-12.5) + \\exp(-0.5) + \\exp(-24.5)$\n$S_{w2} = \\sum_{i=1}^5 (\\tilde{w}_k^{(i)})^2 = 1^2 + 2(\\exp(-12.5))^2 + (\\exp(-0.5))^2 + (\\exp(-24.5))^2 = 1 + 2\\exp(-25) + \\exp(-1) + \\exp(-49)$\n\nUsing numerical values:\n$S_w \\approx 1 + 2(3.720 \\times 10^{-6}) + 0.60653 \\approx 1.606538$\n$S_{w2} \\approx 1 + 2(1.384 \\times 10^{-11}) + 0.367879 \\approx 1.367879$\n\n$$\nN_{\\text{eff}} = \\frac{(S_w)^2}{S_{w2}} \\approx \\frac{(1.606538)^2}{1.367879} \\approx \\frac{2.580965}{1.367879} \\approx 1.886835\n$$\nRounding to four significant figures, we get $N_{\\text{eff}} = 1.887$.\n\nFinally, we must decide whether to resample. The resampling threshold is $\\tau = 0.5 N = 0.5 \\times 5 = 2.5$. Resampling is triggered if $N_{\\text{eff}}  \\tau$.\nWe compare our calculated value: $1.887  2.5$. The condition is satisfied.\nTherefore, resampling is triggered, and the resampling indicator is $I=1$.\n\nThe final answer comprises the rounded effective sample size and the resampling indicator.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.887  1\n\\end{pmatrix}\n}\n$$"
        }
    ]
}