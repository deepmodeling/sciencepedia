{
    "hands_on_practices": [
        {
            "introduction": "The stability of point defects, such as vacancies or interstitials, is fundamental to a material's ionic and electronic transport properties. This exercise guides you through the calculation of a defect's formation energy using the grand-canonical formalism, a cornerstone of *ab initio* thermodynamics. By combining total energies from Density Functional Theory (DFT) with chemical potentials and corrections for charge and finite-size effects, you will learn to quantify the energetic cost of creating a charged vacancy, a critical first step in predicting defect concentrations in materials like battery electrodes .",
            "id": "3891327",
            "problem": "A lithium-containing oxide supercell is studied with Density Functional Theory (DFT) to understand defect energetics relevant to automated battery design. Consider a negatively charged lithium vacancy $V_{\\mathrm{Li}}^{-}$ created by removing one lithium atom from the crystal and adjusting the electronic occupations to yield charge $q=-1$ in the defect supercell. Within the grand-canonical picture, the formation energy is the change in the crystal’s energy upon creating the defect while allowing exchange of atoms and electrons with reservoirs. The atomic reservoir for lithium is characterized by a chemical potential $\\mu_{\\mathrm{Li}}$ that can be written as $\\mu_{\\mathrm{Li}}=\\mu_{\\mathrm{Li}}^{\\mathrm{metal}}+\\Delta \\mu_{\\mathrm{Li}}$, where $\\mu_{\\mathrm{Li}}^{\\mathrm{metal}}$ is the per-atom energy of lithium metal and $\\Delta \\mu_{\\mathrm{Li}}$ encodes the thermodynamic conditions of the environment. The electronic reservoir is referenced to the valence band maximum (VBM), so the electron energy is set by the Fermi level $E_{F}$ measured upward from the VBM. Band-edge alignment between the defect and pristine supercells is accounted for by an alignment term $\\Delta V$. Finite-size effects from periodic boundary conditions are represented by an electrostatic correction $E_{\\mathrm{corr}}$.\n\nYou are given the following data for a single $V_{\\mathrm{Li}}^{-}$ in a supercell:\n- Pristine supercell total energy: $E_{\\mathrm{tot}}^{\\mathrm{bulk}}=-832.517\\ \\mathrm{eV}$.\n- Defect supercell total energy (after removing one lithium atom and setting $q=-1$): $E_{\\mathrm{tot}}^{\\mathrm{defect}}=-825.010\\ \\mathrm{eV}$.\n- Lithium chemical potential reference and shift: $\\mu_{\\mathrm{Li}}^{\\mathrm{metal}}=-1.600\\ \\mathrm{eV}$ and $\\Delta \\mu_{\\mathrm{Li}}=-0.500\\ \\mathrm{eV}$.\n- Fermi level referenced to the VBM: $E_{F}=1.25\\ \\mathrm{eV}$.\n- Band-edge alignment term: $\\Delta V=0.10\\ \\mathrm{eV}$.\n- Finite-size electrostatic correction: $E_{\\mathrm{corr}}=0.18\\ \\mathrm{eV}$.\n\nAssume the defect supercell has one fewer lithium atom than the pristine supercell, and that the only atomic reservoir exchange is lithium. Using the grand-canonical definition of formation energy and consistent sign conventions for atomic removal and electronic charge, compute the formation energy of $V_{\\mathrm{Li}}^{-}$. Express your final answer in $\\mathrm{eV}$ and round to four significant figures.",
            "solution": "The problem statement is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n-   Pristine supercell total energy: $E_{\\mathrm{tot}}^{\\mathrm{bulk}}=-832.517\\ \\mathrm{eV}$.\n-   Defect supercell total energy for $V_{\\mathrm{Li}}^{-}$ ($q=-1$): $E_{\\mathrm{tot}}^{\\mathrm{defect}}=-825.010\\ \\mathrm{eV}$.\n-   Lithium chemical potential reference: $\\mu_{\\mathrm{Li}}^{\\mathrm{metal}}=-1.600\\ \\mathrm{eV}$.\n-   Lithium chemical potential shift: $\\Delta \\mu_{\\mathrm{Li}}=-0.500\\ \\mathrm{eV}$.\n-   Fermi level referenced to the valence band maximum (VBM): $E_{F}=1.25\\ \\mathrm{eV}$.\n-   Charge of the defect: $q=-1$.\n-   Number of lithium atoms removed: $1$.\n-   Band-edge alignment term: $\\Delta V=0.10\\ \\mathrm{eV}$.\n-   Finite-size electrostatic correction: $E_{\\mathrm{corr}}=0.18\\ \\mathrm{eV}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded. It uses the standard grand-canonical formalism from computational materials science to calculate the formation energy of a point defect. All concepts, including Density Functional Theory (DFT) total energies, chemical potentials, the Fermi level, and corrections for finite-size and potential alignment, are well-established principles in the field. The provided values are physically realistic for such calculations.\n\nThe problem is well-posed. It provides all necessary data and a clear objective: to compute the formation energy. There are no missing data or contradictory constraints. The definition of all terms is consistent with standard usage in solid-state physics literature.\n\nThe problem is objective. The language is precise and technical, free from any subjective or ambiguous statements.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. A solution will be provided.\n\nThe formation energy, $E_f$, of a defect in a charge state $q$ is defined within the grand-canonical ensemble. It represents the energy change when creating a defect in a crystal that is in equilibrium with atomic and electronic reservoirs. The general formula is:\n$$E_f[D^q] = E_{\\mathrm{tot}}(D^q) - E_{\\mathrm{tot}}(\\text{bulk}) - \\sum_i n_i \\mu_i + q(E_F + E_{\\mathrm{VBM}}) + E_{\\mathrm{corr}}$$\nwhere:\n-   $E_{\\mathrm{tot}}(D^q)$ is the total energy of the supercell containing the defect $D$ with charge $q$.\n-   $E_{\\mathrm{tot}}(\\text{bulk})$ is the total energy of the equivalent pristine (bulk) supercell.\n-   $n_i$ is the number of atoms of species $i$ added to ($n_i > 0$) or removed from ($n_i  0$) the supercell to create the defect.\n-   $\\mu_i$ is the chemical potential of species $i$.\n-   $q$ is the charge state of the defect.\n-   $E_F$ is the Fermi level, which represents the chemical potential of the electrons.\n-   $E_{\\mathrm{VBM}}$ is the energy of the valence band maximum, which serves as the reference for $E_F$.\n-   $E_{\\mathrm{corr}}$ represents any correction terms, such as for finite-size effects.\n\nThe problem also introduces a potential alignment correction, $\\Delta V$, which accounts for the shift in the electrostatic potential of the defect supercell relative to the pristine supercell. This term modifies the reference for the electronic energy. The electron chemical potential term is thus $q(E_F + E_{\\mathrm{VBM}} + \\Delta V)$. As the problem states that $E_F$ is already measured from the VBM, we can set $E_{\\mathrm{VBM}}=0$, and the term becomes $q(E_F + \\Delta V)$.\n\nThe specific defect is a negatively charged lithium vacancy, $V_{\\mathrm{Li}}^{-}$. This means:\n-   One lithium atom is removed, so for lithium, $n_{\\mathrm{Li}} = -1$.\n-   The charge state is $q=-1$.\n\nSubstituting these into the general formula gives the specific equation for the formation energy of $V_{\\mathrm{Li}}^{-}$:\n$$E_f[V_{\\mathrm{Li}}^{-}] = E_{\\mathrm{tot}}^{\\mathrm{defect}} - E_{\\mathrm{tot}}^{\\mathrm{bulk}} - (-1)\\mu_{\\mathrm{Li}} + (-1)(E_F + \\Delta V) + E_{\\mathrm{corr}}$$\n$$E_f[V_{\\mathrm{Li}}^{-}] = E_{\\mathrm{tot}}^{\\mathrm{defect}} - E_{\\mathrm{tot}}^{\\mathrm{bulk}} + \\mu_{\\mathrm{Li}} - (E_F + \\Delta V) + E_{\\mathrm{corr}}$$\n\nFirst, we calculate the total chemical potential of lithium, $\\mu_{\\mathrm{Li}}$, using the given values:\n$$\\mu_{\\mathrm{Li}} = \\mu_{\\mathrm{Li}}^{\\mathrm{metal}} + \\Delta \\mu_{\\mathrm{Li}} = -1.600\\ \\mathrm{eV} + (-0.500\\ \\mathrm{eV}) = -2.100\\ \\mathrm{eV}$$\n\nNow, we substitute all the given numerical values into the formation energy equation:\n-   $E_{\\mathrm{tot}}^{\\mathrm{defect}} = -825.010\\ \\mathrm{eV}$\n-   $E_{\\mathrm{tot}}^{\\mathrm{bulk}} = -832.517\\ \\mathrm{eV}$\n-   $\\mu_{\\mathrm{Li}} = -2.100\\ \\mathrm{eV}$\n-   $E_F = 1.25\\ \\mathrm{eV}$\n-   $\\Delta V = 0.10\\ \\mathrm{eV}$\n-   $E_{\\mathrm{corr}} = 0.18\\ \\mathrm{eV}$\n\n$$E_f[V_{\\mathrm{Li}}^{-}] = (-825.010\\ \\mathrm{eV}) - (-832.517\\ \\mathrm{eV}) + (-2.100\\ \\mathrm{eV}) - (1.25\\ \\mathrm{eV} + 0.10\\ \\mathrm{eV}) + 0.18\\ \\mathrm{eV}$$\n\nLet's compute the terms step-by-step:\n$$E_{\\mathrm{tot}}^{\\mathrm{defect}} - E_{\\mathrm{tot}}^{\\mathrm{bulk}} = 7.507\\ \\mathrm{eV}$$\n$$-(E_F + \\Delta V) = -(1.35\\ \\mathrm{eV}) = -1.35\\ \\mathrm{eV}$$\n\nNow, sum all the terms:\n$$E_f[V_{\\mathrm{Li}}^{-}] = 7.507\\ \\mathrm{eV} - 2.100\\ \\mathrm{eV} - 1.35\\ \\mathrm{eV} + 0.18\\ \\mathrm{eV}$$\n$$E_f[V_{\\mathrm{Li}}^{-}] = 5.407\\ \\mathrm{eV} - 1.35\\ \\mathrm{eV} + 0.18\\ \\mathrm{eV}$$\n$$E_f[V_{\\mathrm{Li}}^{-}] = 4.057\\ \\mathrm{eV} + 0.18\\ \\mathrm{eV}$$\n$$E_f[V_{\\mathrm{Li}}^{-}] = 4.237\\ \\mathrm{eV}$$\n\nThe problem requires the final answer to be rounded to four significant figures. The calculated value, $4.237$, already has four significant figures, so no further rounding is necessary.",
            "answer": "$$\\boxed{4.237}$$"
        },
        {
            "introduction": "The accuracy of any *ab initio* calculation is contingent on the careful convergence of numerical parameters, with the sampling of the Brillouin zone being paramount. This practice delves into the practical task of determining an adequate k-point mesh density to achieve a desired precision for energy differences, which are the basis for all defect and reaction energetics. By working through a physically-motivated model of convergence error, you will develop an intuition for how factors like supercell size and electronic smearing influence the computational cost required for reliable predictions .",
            "id": "3891350",
            "problem": "Consider a cubic supercell representative of a crystalline electrode material used in Automated Battery Design and Simulation (ABDS). You wish to determine the smallest uniform $k$-point mesh density needed to converge the total energy difference per atom between a defective supercell and a pristine supercell to within a target tolerance of $5\\,\\mathrm{meV}$/atom, which is equal to $0.005\\,\\mathrm{eV}$/atom. Assume both supercells share the same cubic lattice parameter and use the same electronic smearing scheme.\n\nUse the following fundamental base and modeling assumptions:\n\n- The Brillouin Zone (BZ) of a cubic cell with lattice parameter $a$ (expressed in $\\mathrm{\\AA}$) has linear extent $2\\pi/a$ in each reciprocal-space direction. For a uniform, isotropic $N \\times N \\times N$ grid, the $k$-point spacing per direction can be approximated by $\\Delta k = 2\\pi/(a N)$, where $\\Delta k$ is in $\\mathrm{\\AA}^{-1}$.\n\n- In Kohn–Sham Density Functional Theory (KS-DFT), Brillouin Zone integration of a sufficiently smooth periodic integrand via a composite trapezoidal rule incurs an error that scales as $\\mathcal{O}((\\Delta k)^2)$, provided that the second derivatives of the integrand are bounded. Electronic smearing based on Fermi–Dirac occupations introduces an effective electronic temperature that regularizes the Fermi surface, increasing smoothness. For the purpose of this problem, model the per-atom total energy integration error in either supercell as\n$$\n\\varepsilon_{\\mathrm{cell}} \\leq A(\\sigma)\\,(\\Delta k)^2,\n$$\nwhere $\\sigma$ (in $\\mathrm{eV}$) is the electronic smearing parameter, and $A(\\sigma)$ (in $\\mathrm{eV}\\cdot\\mathrm{\\AA}^2$/atom) is a material-dependent bound that decreases with increasing $\\sigma$.\n\n- To conservatively bound the error in the per-atom energy difference between defective and pristine supercells, use the triangle inequality:\n$$\n\\varepsilon_{\\mathrm{diff}} \\leq \\varepsilon_{\\mathrm{defect}} + \\varepsilon_{\\mathrm{pristine}}.\n$$\nUnder the shared $A(\\sigma)$ assumption for both cells, this implies\n$$\n\\varepsilon_{\\mathrm{diff}} \\leq 2\\,A(\\sigma)\\,(\\Delta k)^2.\n$$\n\n- For concreteness and scientific plausibility, adopt the parametric model\n$$\nA(\\sigma) = \\frac{A_0}{1 + \\sigma/\\sigma_1},\n$$\nwith constants $A_0 = 2.0\\,\\mathrm{eV}\\cdot\\mathrm{\\AA}^2/\\text{atom}$ and $\\sigma_1 = 0.1\\,\\mathrm{eV}$. This captures the reduction in integrand curvature with increasing smearing width.\n\nYour task:\n\n- For each test case below, determine the smallest integer $N \\geq 1$ such that the per-atom total energy difference error bound $\\varepsilon_{\\mathrm{diff}}$ does not exceed the target tolerance $\\varepsilon_{\\mathrm{tol}} = 0.005\\,\\mathrm{eV}$/atom.\n\n- Assume an isotropic cubic mesh with $N_x = N_y = N_z = N$.\n\n- All physical units must be handled explicitly: lattice parameter $a$ in $\\mathrm{\\AA}$, smearing $\\sigma$ in $\\mathrm{eV}$, and energy tolerance in $\\mathrm{eV}$/atom.\n\n- The final output of your program must be a single line containing the resulting $[N_x,N_y,N_z]$ for each test case, aggregated into a comma-separated list enclosed in square brackets. For example, the overall format should be\n$$\n[\\,[N_1,N_1,N_1],\\,[N_2,N_2,N_2],\\,\\dots\\,]\n$$\nwith no spaces.\n\nTest suite:\n\n- Case $1$: $a = 10.0\\,\\mathrm{\\AA}$, $\\sigma = 0.10\\,\\mathrm{eV}$.\n- Case $2$: $a = 5.0\\,\\mathrm{\\AA}$, $\\sigma = 0.05\\,\\mathrm{eV}$.\n- Case $3$: $a = 20.0\\,\\mathrm{\\AA}$, $\\sigma = 0.20\\,\\mathrm{eV}$.\n- Case $4$ (edge case: near-zero smearing): $a = 8.0\\,\\mathrm{\\AA}$, $\\sigma = 0.001\\,\\mathrm{eV}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\,[n_1,n_1,n_1],\\,[n_2,n_2,n_2],\\,[n_3,n_3,n_3],\\,[n_4,n_4,n_4]\\,]$), where each $n_i$ is the smallest integer $N$ satisfying the bound for the corresponding case.",
            "solution": "We begin from first principles relevant to Brillouin Zone (BZ) integration in Kohn–Sham Density Functional Theory (KS-DFT) and the numerical error behavior of composite trapezoidal rules for smooth periodic integrands.\n\n1. Brillouin Zone scaling with lattice parameter. For a cubic lattice with parameter $a$ (in $\\mathrm{\\AA}$), the reciprocal lattice spans a cube of edge length $2\\pi/a$ per direction. A uniform isotropic $N \\times N \\times N$ $k$-point mesh yields a per-direction spacing\n$$\n\\Delta k = \\frac{2\\pi}{a\\,N},\n$$\nwith $\\Delta k$ expressed in $\\mathrm{\\AA}^{-1}$.\n\n2. Error scaling of composite trapezoidal rule. For a periodic integrand $g(\\mathbf{k})$ with bounded second derivatives, the composite trapezoidal rule in one dimension has an error that scales as $C\\,(\\Delta k)^2$ for some constant $C$ proportional to a bound on $|g''|$. In three dimensions with a separable uniform mesh, the same leading-order scaling persists when the integrand is smooth. In KS-DFT, the non-analyticity at the Fermi surface (a discontinuity in occupation) is regularized by electronic smearing $\\sigma$ (in $\\mathrm{eV}$), such as Fermi–Dirac occupations where $\\sigma = k_B T_e$ in energy units. Increasing $\\sigma$ makes the occupation function smoother and reduces bounds on higher derivatives of the integrand.\n\n3. Modeling the error bound per atom. We model the per-atom total energy integration error in either supercell as\n$$\n\\varepsilon_{\\mathrm{cell}} \\leq A(\\sigma)\\,(\\Delta k)^2,\n$$\nwhere $A(\\sigma)$ carries the effect of smearing on smoothness. To represent the reduction of curvature with smearing, we set\n$$\nA(\\sigma) = \\frac{A_0}{1 + \\sigma/\\sigma_1},\n$$\nwith $A_0 = 2.0\\,\\mathrm{eV}\\cdot\\mathrm{\\AA}^2/\\text{atom}$ and $\\sigma_1 = 0.1\\,\\mathrm{eV}$. This form captures the qualitative trend that larger $\\sigma$ reduces the magnitude of relevant second derivatives.\n\n4. Energy difference error via triangle inequality. The per-atom energy difference between defective and pristine supercells has an error bounded by the sum of individual errors:\n$$\n\\varepsilon_{\\mathrm{diff}} \\leq \\varepsilon_{\\mathrm{defect}} + \\varepsilon_{\\mathrm{pristine}} \\leq 2\\,A(\\sigma)\\,(\\Delta k)^2.\n$$\n\n5. Convergence criterion and solving for $N$. The target tolerance is\n$$\n\\varepsilon_{\\mathrm{tol}} = 0.005\\,\\mathrm{eV}/\\text{atom}.\n$$\nWe require\n$$\n2\\,A(\\sigma)\\,(\\Delta k)^2 \\leq \\varepsilon_{\\mathrm{tol}}.\n$$\nSubstitute $\\Delta k = 2\\pi/(a N)$ to obtain\n$$\n2\\,A(\\sigma)\\,\\left(\\frac{2\\pi}{a\\,N}\\right)^2 \\leq \\varepsilon_{\\mathrm{tol}}.\n$$\nSolving for $N$ yields\n$$\nN \\geq \\frac{2\\pi}{a}\\,\\sqrt{\\frac{2\\,A(\\sigma)}{\\varepsilon_{\\mathrm{tol}}}}.\n$$\nSince $N$ must be an integer and at least $1$, we take\n$$\nN = \\left\\lceil \\max\\left(1,\\ \\frac{2\\pi}{a}\\,\\sqrt{\\frac{2\\,A(\\sigma)}{\\varepsilon_{\\mathrm{tol}}}} \\right)\\right\\rceil.\n$$\n\n6. Compute $A(\\sigma)$ for each test case using\n$$\nA(\\sigma) = \\frac{2.0}{1 + \\sigma/0.1}\\ \\ \\text{in}\\ \\mathrm{eV}\\cdot\\mathrm{\\AA}^2/\\text{atom}.\n$$\nThen evaluate $N$.\n\nNumerical evaluations:\n\n- Case $1$: $a = 10.0$, $\\sigma = 0.10$.\n  $$\n  A(\\sigma) = \\frac{2.0}{1 + 0.10/0.10} = \\frac{2.0}{2} = 1.0,\n  $$\n  $$\n  \\sqrt{\\frac{2 A(\\sigma)}{\\varepsilon_{\\mathrm{tol}}}} = \\sqrt{\\frac{2 \\cdot 1.0}{0.005}} = \\sqrt{400} = 20,\n  $$\n  $$\n  \\frac{2\\pi}{a} \\cdot 20 = \\frac{2\\pi}{10.0} \\cdot 20 = 0.628319 \\cdot 20 \\approx 12.56638,\n  $$\n  $$\n  N = \\lceil 12.56638 \\rceil = 13,\n  $$\n  hence $[N_x,N_y,N_z] = [13,13,13]$.\n\n- Case $2$: $a = 5.0$, $\\sigma = 0.05$.\n  $$\n  A(\\sigma) = \\frac{2.0}{1 + 0.05/0.10} = \\frac{2.0}{1.5} \\approx 1.333333\\ldots,\n  $$\n  $$\n  \\sqrt{\\frac{2 A(\\sigma)}{\\varepsilon_{\\mathrm{tol}}}} = \\sqrt{\\frac{2 \\cdot 1.333333\\ldots}{0.005}} = \\sqrt{533.3333\\ldots} \\approx 23.0940,\n  $$\n  $$\n  \\frac{2\\pi}{a} \\cdot 23.0940 = \\frac{2\\pi}{5.0} \\cdot 23.0940 = 1.256637 \\cdot 23.0940 \\approx 29.028,\n  $$\n  $$\n  N = \\lceil 29.028 \\rceil = 30,\n  $$\n  hence $[N_x,N_y,N_z] = [30,30,30]$.\n\n- Case $3$: $a = 20.0$, $\\sigma = 0.20$.\n  $$\n  A(\\sigma) = \\frac{2.0}{1 + 0.20/0.10} = \\frac{2.0}{3} \\approx 0.666666\\ldots,\n  $$\n  $$\n  \\sqrt{\\frac{2 A(\\sigma)}{\\varepsilon_{\\mathrm{tol}}}} = \\sqrt{\\frac{2 \\cdot 0.666666\\ldots}{0.005}} = \\sqrt{266.6666\\ldots} \\approx 16.3299,\n  $$\n  $$\n  \\frac{2\\pi}{a} \\cdot 16.3299 = \\frac{2\\pi}{20.0} \\cdot 16.3299 = 0.314159 \\cdot 16.3299 \\approx 5.129,\n  $$\n  $$\n  N = \\lceil 5.129 \\rceil = 6,\n  $$\n  hence $[N_x,N_y,N_z] = [6,6,6]$.\n\n- Case $4$: $a = 8.0$, $\\sigma = 0.001$.\n  $$\n  A(\\sigma) = \\frac{2.0}{1 + 0.001/0.10} = \\frac{2.0}{1.01} \\approx 1.980198,\n  $$\n  $$\n  \\sqrt{\\frac{2 A(\\sigma)}{\\varepsilon_{\\mathrm{tol}}}} = \\sqrt{\\frac{2 \\cdot 1.980198}{0.005}} = \\sqrt{792.0792} \\approx 28.160,\n  $$\n  $$\n  \\frac{2\\pi}{a} \\cdot 28.160 = \\frac{2\\pi}{8.0} \\cdot 28.160 = 0.785398 \\cdot 28.160 \\approx 22.099,\n  $$\n  $$\n  N = \\lceil 22.099 \\rceil = 23,\n  $$\n  hence $[N_x,N_y,N_z] = [23,23,23]$.\n\nThese values satisfy the conservative bound on the per-atom total energy difference error using the specified model, ensuring the target tolerance of $0.005\\,\\mathrm{eV}$/atom is met. The final program output should be\n$$\n[\\,[13,13,13],\\,[30,30,30],\\,[6,6,6],\\,[23,23,23]\\,].\n$$",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport math\n\ndef required_kmesh(a_angstrom: float, sigma_eV: float,\n                   A0_eV_A2_per_atom: float = 2.0,\n                   sigma1_eV: float = 0.1,\n                   eps_tol_eV_per_atom: float = 0.005) - int:\n    \"\"\"\n    Compute the smallest integer N such that the per-atom total energy difference\n    error between defective and pristine supercells is bounded by eps_tol_eV_per_atom,\n    using the model:\n        epsilon_diff = 2 * A(sigma) * (Delta k)^2\n    with Delta k = 2*pi / (a * N), and\n        A(sigma) = A0 / (1 + sigma / sigma1).\n    \"\"\"\n    # Compute A(sigma)\n    A_sigma = A0_eV_A2_per_atom / (1.0 + sigma_eV / sigma1_eV)\n    # Compute the continuous lower bound for N from inequality\n    # 2 * A_sigma * (2*pi/(a*N))^2 = eps_tol\n    # = N = (2*pi/a) * sqrt(2*A_sigma/eps_tol)\n    factor = (2.0 * math.pi) / a_angstrom\n    rhs = factor * math.sqrt((2.0 * A_sigma) / eps_tol_eV_per_atom)\n    # Ensure N is at least 1 and integer by ceiling\n    N = max(1, math.ceil(rhs))\n    return N\n\ndef solve():\n    # Define the test cases from the problem statement: (a in Angstrom, sigma in eV)\n    test_cases = [\n        (10.0, 0.10),   # Case 1\n        (5.0, 0.05),    # Case 2\n        (20.0, 0.20),   # Case 3\n        (8.0, 0.001),   # Case 4 (edge case: near-zero smearing)\n    ]\n\n    results = []\n    for a_ang, sigma_eV in test_cases:\n        N = required_kmesh(a_angstrom=a_ang, sigma_eV=sigma_eV)\n        # isotropic cubic mesh [N,N,N]\n        results.append([N, N, N])\n\n    # Build the exact required output format: [[Nx,Ny,Nz],[Nx,Ny,Nz],...]\n    # with no spaces.\n    inner = \",\".join(\"[\" + \",\".join(map(str, triplet)) + \"]\" for triplet in results)\n    print(f\"[{inner}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Understanding ion diffusion is key to designing high-performance battery materials, and this requires computing the energy barriers that migrating ions must overcome. This hands-on problem challenges you to implement the Climbing Image Nudged Elastic Band (CI-NEB) method, a powerful algorithm for identifying the minimum energy path and locating the precise saddle point of a transition. By applying the method to an analytical potential energy surface, you will gain a first-principles understanding of how this workhorse algorithm navigates complex energy landscapes to reveal the atomistic mechanisms and kinetics of diffusion .",
            "id": "3891358",
            "problem": "You are asked to implement a complete, runnable program that computes the lithium migration barrier between two octahedral sites in a layered oxide using the Climbing Image Nudged Elastic Band (CI-NEB) method derived from first principles. You must set up initial and final configurations for a single lithium ion migrating between two octahedral sites and determine the minimum energy path and the barrier height with a well-defined force convergence criterion.\n\nBegin from the following fundamental base:\n- Potential energy surfaces in classical mechanics define forces via the negative gradient, so that for a configuration vector $\\mathbf{r}$, the force satisfies $\\mathbf{F}(\\mathbf{r}) = -\\nabla E(\\mathbf{r})$.\n- A minimum energy path can be represented discretely by a sequence of images parameterizing the path between endpoints; the equilibrium of these images under a combination of physical forces and elastic coupling yields a stationary condition characterizing the path.\n- Climbing Image Nudged Elastic Band (CI-NEB) removes the parallel component of the true force for most images and uses springs along the tangent to maintain a smooth path, and for the highest-energy image inverts the parallel component of the true force and removes the spring to converge directly to the saddle point.\n\nModel the local lithium-ion migration environment as a two-dimensional potential energy surface $E(x,y)$ in electronvolts with positions measured in ångströms, representing two octahedral wells centered at $(-a,0)$ and $(+a,0)$ separated by a central barrier near $(0,0)$. Use the following analytic and differentiable energy function:\n$$\nE(x,y) = -W\\exp\\!\\left(-\\frac{(x-a)^2 + y^2}{\\sigma_w^2}\\right) - W\\exp\\!\\left(-\\frac{(x+a)^2 + y^2}{\\sigma_w^2}\\right) + V_0\\exp\\!\\left(-\\frac{x^2}{\\sigma_{b,x}^2} - \\frac{y^2}{\\sigma_{b,y}^2}\\right),\n$$\nwith fixed parameters\n$$\na = 2.5\\ \\text{\\AA},\\quad \\sigma_w = 0.6\\ \\text{\\AA},\\quad W = 0.4\\ \\text{eV},\\quad V_0 = 0.6\\ \\text{eV},\\quad \\sigma_{b,x} = 1.2\\ \\text{\\AA},\\quad \\sigma_{b,y} = 0.7\\ \\text{\\AA}.\n$$\nThese values produce two wells with minima near $(-a,0)$ and $(a,0)$ and a single central saddle near $(0,0)$.\n\nYour task is to:\n1. Specify the initial and final configurations for a single migrating lithium ion as fixed endpoints at $(-a,0)$ and $(+a,0)$, respectively.\n2. Discretize a path into $N_\\text{img}$ images including endpoints, keep the endpoints fixed, and iteratively relax the internal images according to CI-NEB principles derived from the stated base. Your derivation must start from $\\mathbf{F}(\\mathbf{r}) = -\\nabla E(\\mathbf{r})$, define a unit tangent $\\hat{\\mathbf{t}}$ along the path at each image, decompose the true force into components parallel and perpendicular to $\\hat{\\mathbf{t}}$, and construct a projected force law that:\n   - retains only the perpendicular component of the true force for non-climbing images,\n   - includes a spring force along the tangent to control image spacing,\n   - and, for the climbing image (the highest-energy internal image after a chosen number of iterations), removes the spring and inverts the parallel component of the true force to drive the image to the saddle point.\n3. Update image positions iteratively using a stable step proportional to the constructed force, keeping endpoints fixed. Use a force convergence criterion based on the maximum norm of the CI-NEB force among internal images dropping below a threshold $f_\\text{tol}$, expressed in $\\text{eV}/\\text{\\AA}$.\n4. After convergence, compute the migration barrier as the difference between the maximum image energy along the path and the lower of the two endpoint energies. Express the barrier in electronvolts.\n\nPhysical and numerical units:\n- Use positions in ångströms and energies in electronvolts consistently throughout. Report forces in $\\text{eV}/\\text{\\AA}$ when assessing convergence.\n- Express each final barrier as a floating-point number in electronvolts rounded to three decimal places.\n\nTest suite:\nImplement your program to run the CI-NEB algorithm on the energy function $E(x,y)$ for the following parameter sets. Each parameter set is a tuple $\\left(N_\\text{img}, k, f_\\text{tol}, N_\\text{max}, s, N_\\text{climb}\\right)$ where:\n- $N_\\text{img}$ is the total number of images including endpoints,\n- $k$ is the spring constant in $\\text{eV}/\\text{\\AA}^2$,\n- $f_\\text{tol}$ is the force convergence threshold in $\\text{eV}/\\text{\\AA}$,\n- $N_\\text{max}$ is the maximum number of iterations,\n- $s$ is the step size multiplier with units $\\text{\\AA}\\,/\\left(\\text{eV}/\\text{\\AA}\\right)$,\n- $N_\\text{climb}$ is the iteration index after which climbing image modifications are activated.\n\nUse these four test cases:\n- Case $1$: $\\left(7,\\ 5.0,\\ 5\\times 10^{-3},\\ 15000,\\ 0.03,\\ 200\\right)$.\n- Case $2$: $\\left(9,\\ 3.0,\\ 2\\times 10^{-3},\\ 20000,\\ 0.02,\\ 300\\right)$.\n- Case $3$: $\\left(5,\\ 10.0,\\ 1\\times 10^{-2},\\ 8000,\\ 0.04,\\ 100\\right)$.\n- Case $4$: $\\left(3,\\ 5.0,\\ 5\\times 10^{-3},\\ 12000,\\ 0.03,\\ 150\\right)$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain the four barriers for the test cases in order, each rounded to three decimal places in electronvolts, for example, \"[0.842,0.839,0.846,0.840]\". The program must be completely self-contained and must not require any user input or external files or network access.",
            "solution": "The problem statement is assessed to be valid. It presents a well-posed, scientifically grounded problem in the field of computational materials science. It asks for the implementation of the Climbing Image Nudged Elastic Band (CI-NEB) method, which is a standard and widely used algorithm for finding minimum energy paths and transition states. The problem provides a clear and complete set of givens: an analytic potential energy surface, all necessary physical and algorithmic parameters, a well-defined convergence criterion, and a set of test cases. There are no contradictions, ambiguities, or violations of scientific principles.\n\nWe proceed with a complete, reasoned solution.\n\n### Theoretical Framework and Derivation\n\nThe objective is to determine the minimum energy path (MEP) for a lithium ion migrating between two stable octahedral sites on a potential energy surface (PES). The migration barrier is the energy difference between the highest point on this path (the saddle point) and the initial stable site. The CI-NEB method is an effective numerical technique for this purpose.\n\n#### 1. Potential Energy Surface and Force\n\nThe motion of the ion is governed by a two-dimensional analytic potential energy surface, $E(x,y)$, given in units of electronvolts ($\\text{eV}$) with positions $x$ and $y$ in ångströms ($\\text{\\AA}$):\n$$\nE(x,y) = -W\\exp\\!\\left(-\\frac{(x-a)^2 + y^2}{\\sigma_w^2}\\right) - W\\exp\\!\\left(-\\frac{(x+a)^2 + y^2}{\\sigma_w^2}\\right) + V_0\\exp\\!\\left(-\\frac{x^2}{\\sigma_{b,x}^2} - \\frac{y^2}{\\sigma_{b,y}^2}\\right)\n$$\nThe parameters are fixed as $a = 2.5\\ \\text{\\AA}$, $\\sigma_w = 0.6\\ \\text{\\AA}$, $W = 0.4\\ \\text{eV}$, $V_0 = 0.6\\ \\text{eV}$, $\\sigma_{b,x} = 1.2\\ \\text{\\AA}$, and $\\sigma_{b,y} = 0.7\\ \\text{\\AA}$. This function describes two potential wells (attractive Gaussian terms) centered at $(\\pm a, 0)$ and a central repulsive barrier (repulsive Gaussian term) at $(0,0)$.\n\nIn classical mechanics, the force on a particle is the negative gradient of the potential energy. For a particle at position vector $\\mathbf{r} = (x,y)$, the force is:\n$$\n\\mathbf{F}(\\mathbf{r}) = -\\nabla E(\\mathbf{r}) = -\\left(\\frac{\\partial E}{\\partial x}\\hat{\\mathbf{i}} + \\frac{\\partial E}{\\partial y}\\hat{\\mathbf{j}}\\right)\n$$\nThe partial derivatives are calculated analytically:\n$$\n\\frac{\\partial E}{\\partial x} = \\frac{2W(x-a)}{\\sigma_w^2}\\exp\\!\\left(-\\frac{(x-a)^2 + y^2}{\\sigma_w^2}\\right) + \\frac{2W(x+a)}{\\sigma_w^2}\\exp\\!\\left(-\\frac{(x+a)^2 + y^2}{\\sigma_w^2}\\right) - \\frac{2V_0 x}{\\sigma_{b,x}^2}\\exp\\!\\left(-\\frac{x^2}{\\sigma_{b,x}^2} - \\frac{y^2}{\\sigma_{b,y}^2}\\right)\n$$\n$$\n\\frac{\\partial E}{\\partial y} = \\frac{2Wy}{\\sigma_w^2}\\left[\\exp\\!\\left(-\\frac{(x-a)^2 + y^2}{\\sigma_w^2}\\right) + \\exp\\!\\left(-\\frac{(x+a)^2 + y^2}{\\sigma_w^2}\\right)\\right] - \\frac{2V_0 y}{\\sigma_{b,y}^2}\\exp\\!\\left(-\\frac{x^2}{\\sigma_{b,x}^2} - \\frac{y^2}{\\sigma_{b,y}^2}\\right)\n$$\n\n#### 2. Path Discretization and The Nudged Elastic Band (NEB) Method\n\nThe MEP is a continuous curve, which we approximate by a discrete sequence of configurations, or \"images\". Let the path be represented by a set of $N_\\text{img}$ images, $\\mathbf{R} = \\{\\mathbf{r}_0, \\mathbf{r}_1, \\dots, \\mathbf{r}_{N_\\text{img}-1}\\}$, where $\\mathbf{r}_i=(x_i, y_i)$ is the position vector of the $i$-th image. The endpoints, $\\mathbf{r}_0$ and $\\mathbf{r}_{N_\\text{img}-1}$, are fixed at the initial and final states, here $(-a,0)$ and $(+a,0)$ respectively. The $N_\\text{img}-2$ internal images are iteratively relaxed to find the MEP.\n\nThe NEB method constructs a special force to relax the images. This force combines the true physical force derived from the PES with an artificial spring force that maintains roughly equal spacing between images. A key feature is the \"nudging\", which projects out certain components of these forces.\n\nFor each internal image $\\mathbf{r}_i$ (for $i=1, \\dots, N_\\text{img}-2$), we first define a local tangent to the path, $\\hat{\\mathbf{t}}_i$. A robust estimate for the tangent vector is derived from the positions of the adjacent images:\n$$\n\\mathbf{t}_i = \\mathbf{r}_{i+1} - \\mathbf{r}_{i-1} \\implies \\hat{\\mathbf{t}}_i = \\frac{\\mathbf{t}_i}{\\|\\mathbf{t}_i\\|}\n$$\nThe true force $\\mathbf{F}_i = -\\nabla E(\\mathbf{r}_i)$ is decomposed into components parallel and perpendicular to this tangent:\n$$\n\\mathbf{F}_{i,\\parallel} = (\\mathbf{F}_i \\cdot \\hat{\\mathbf{t}}_i)\\hat{\\mathbf{t}}_i\n$$\n$$\n\\mathbf{F}_{i,\\perp} = \\mathbf{F}_i - \\mathbf{F}_{i,\\parallel}\n$$\nThe perpendicular component $\\mathbf{F}_{i,\\perp}$ pulls the image towards the MEP, while the parallel component $\\mathbf{F}_{i,\\parallel}$ causes it to slide along the path, leading to clustering at minima and thinning at maxima. To prevent this, the standard NEB method removes the parallel component of the true force and replaces it with a parallel component from an artificial spring force.\n\nThe spring force acting on image $\\mathbf{r}_i$ due to its neighbors can be modeled as $\\mathbf{F}_{S,i} = k(\\mathbf{r}_{i+1} + \\mathbf{r}_{i-1} - 2\\mathbf{r}_i)$, where $k$ is the spring constant. Only its component along the tangent is used:\n$$\n\\mathbf{F}_{S,i,\\parallel} = (\\mathbf{F}_{S,i} \\cdot \\hat{\\mathbf{t}}_i)\\hat{\\mathbf{t}}_i\n$$\nThe total NEB force for a regular (non-climbing) image is the sum of the perpendicular true force and the parallel spring force:\n$$\n\\mathbf{F}_i^\\text{NEB} = \\mathbf{F}_{i,\\perp} + \\mathbf{F}_{S,i,\\parallel}\n$$\n\n#### 3. The Climbing Image (CI) Modification\n\nThe NEB method effectively finds the MEP, but due to the discretization and spring forces, the highest-energy image may not converge exactly to the true saddle point. The CI-NEB modification corrects this. After a certain number of initial relaxation iterations ($N_\\text{climb}$), the image with the highest energy, $\\mathbf{r}_c$, is identified. For this \"climbing\" image, the force law is changed:\n1. The spring force is completely removed.\n2. The parallel component of the true force is inverted.\n\nThis forces the image to move \"uphill\" along the path tangent and \"downhill\" in all perpendicular directions, causing it to converge precisely to the saddle point. The force on the climbing image $\\mathbf{r}_c$ is:\n$$\n\\mathbf{F}_c^\\text{CI} = \\mathbf{F}_{c,\\perp} - \\mathbf{F}_{c,\\parallel} = (\\mathbf{F}_c - \\mathbf{F}_{c,\\parallel}) - \\mathbf{F}_{c,\\parallel} = \\mathbf{F}_c - 2 (\\mathbf{F}_c \\cdot \\hat{\\mathbf{t}}_c)\\hat{\\mathbf{t}}_c\n$$\n\n#### 4. Algorithmic Procedure\n\nThe simulation proceeds iteratively:\n1.  **Initialization**: An initial path is created by linear interpolation between the fixed endpoints $\\mathbf{r}_0=(-a,0)$ and $\\mathbf{r}_{N_\\text{img}-1}=(+a,0)$.\n2.  **Iteration Loop**: The loop continues until a force convergence criterion is met or a maximum number of iterations ($N_\\text{max}$) is reached. In each iteration:\n    a. For all images, calculate the energies $E_i$ and true forces $\\mathbf{F}_i$.\n    b. If the iteration count exceeds $N_\\text{climb}$, identify the climbing image $\\mathbf{r}_c$ as the internal image with the highest energy.\n    c. For each internal image $\\mathbf{r}_i$, calculate the appropriate total force: $\\mathbf{F}_i^\\text{CI}$ if it is the climbing image, or $\\mathbf{F}_i^\\text{NEB}$ otherwise.\n    d. Update the positions of all internal images using a simple Euler integration step: $\\mathbf{r}_i \\leftarrow \\mathbf{r}_i + s \\cdot \\mathbf{F}_i^\\text{total}$, where $s$ is a step size multiplier.\n    e. Check for convergence by finding the maximum norm of the calculated total forces, $f_\\text{max} = \\max_i \\|\\mathbf{F}_i^\\text{total}\\|$. If $f_\\text{max}  f_\\text{tol}$, the path has converged.\n\n#### 5. Migration Barrier Calculation\n\nUpon convergence, the set of images $\\{\\mathbf{r}_i\\}$ represents the MEP. The energy of each image is calculated. The migration barrier, $\\Delta E$, is the difference between the maximum energy along the path and the energy of the initial state:\n$$\n\\Delta E = \\max_i(E(\\mathbf{r}_i)) - E(\\mathbf{r}_0)\n$$\nSince the PES is symmetric, $E(\\mathbf{r}_0) = E(\\mathbf{r}_{N_\\text{img}-1})$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the CI-NEB simulations for all test cases and print results.\n    \"\"\"\n    \n    # Fixed parameters for the potential energy surface\n    A = 2.5        # Well separation half-distance in Angstrom\n    SIGMA_W = 0.6  # Well width in Angstrom\n    W = 0.4        # Well depth in eV\n    V0 = 0.6       # Barrier height parameter in eV\n    SIGMA_BX = 1.2 # Barrier width in x in Angstrom\n    SIGMA_BY = 0.7 # Barrier width in y in Angstrom\n\n    def potential_energy(pos):\n        \"\"\"Calculates the potential energy E(x, y) at a given position.\"\"\"\n        x, y = pos[0], pos[1]\n        term1 = -W * np.exp(-((x - A)**2 + y**2) / SIGMA_W**2)\n        term2 = -W * np.exp(-((x + A)**2 + y**2) / SIGMA_W**2)\n        term3 = V0 * np.exp(-(x**2 / SIGMA_BX**2 + y**2 / SIGMA_BY**2))\n        return term1 + term2 + term3\n\n    def true_force(pos):\n        \"\"\"Calculates the true force F = -grad(E) at a given position.\"\"\"\n        x, y = pos[0], pos[1]\n        \n        exp_w1 = np.exp(-((x - A)**2 + y**2) / SIGMA_W**2)\n        exp_w2 = np.exp(-((x + A)**2 + y**2) / SIGMA_W**2)\n        exp_b = np.exp(-(x**2 / SIGMA_BX**2 + y**2 / SIGMA_BY**2))\n        \n        dE_dx = ( (2 * W * (x - A) / SIGMA_W**2) * exp_w1 +\n                  (2 * W * (x + A) / SIGMA_W**2) * exp_w2 -\n                  (2 * V0 * x / SIGMA_BX**2) * exp_b )\n        \n        dE_dy = ( (2 * W * y / SIGMA_W**2) * exp_w1 +\n                  (2 * W * y / SIGMA_W**2) * exp_w2 -\n                  (2 * V0 * y / SIGMA_BY**2) * exp_b )\n                  \n        return -np.array([dE_dx, dE_dy])\n\n    def run_ci_neb(N_img, k, f_tol, N_max, s, N_climb):\n        \"\"\"\n        Executes the Climbing Image Nudged Elastic Band algorithm for one set of parameters.\n        \n        Args:\n            N_img (int): Total number of images in the band.\n            k (float): Spring constant in eV/A^2.\n            f_tol (float): Force convergence tolerance in eV/A.\n            N_max (int): Maximum number of iterations.\n            s (float): Step size multiplier.\n            N_climb (int): Iteration to start climbing image.\n\n        Returns:\n            float: The calculated migration barrier in eV.\n        \"\"\"\n        # 1. Initialize Path: Linear interpolation between endpoints\n        path = np.zeros((N_img, 2))\n        path[:, 0] = np.linspace(-A, A, N_img)\n        \n        r_start = path[0, :].copy()\n        \n        for n_iter in range(N_max):\n            # Calculate energies and true forces for all images\n            energies = np.array([potential_energy(r) for r in path])\n            forces = np.array([true_force(r) for r in path])\n            \n            # Identify climbing image index if climbing is active\n            climbing_image_idx = -1\n            if n_iter = N_climb and N_img  2:\n                internal_energies = energies[1:-1]\n                climbing_image_idx = np.argmax(internal_energies) + 1\n            \n            # Calculate tangents for all internal images\n            tangents = np.zeros_like(path)\n            for i in range(1, N_img - 1):\n                tangent_vec = path[i+1] - path[i-1]\n                norm = np.linalg.norm(tangent_vec)\n                if norm  1e-9:\n                    tangents[i] = tangent_vec / norm\n\n            # Calculate and store CI-NEB forces for this iteration\n            ci_neb_forces_update = np.zeros((N_img - 2, 2))\n            max_force_norm = 0.0\n\n            for i in range(1, N_img - 1):\n                t_hat_i = tangents[i]\n                \n                # Decompose the true force into parallel and perpendicular components\n                F_i_true = forces[i]\n                F_i_parallel_mag = np.dot(F_i_true, t_hat_i)\n                F_i_perp = F_i_true - F_i_parallel_mag * t_hat_i\n                \n                # Determine final force based on whether it's a climbing image\n                if i == climbing_image_idx:\n                    # Force for climbing image: invert parallel component of true force\n                    F_i_final = F_i_true - 2 * F_i_parallel_mag * t_hat_i\n                else:\n                    # Force for regular NEB image\n                    # Spring force is projected along the tangent\n                    F_s_i = k * (path[i+1] + path[i-1] - 2 * path[i])\n                    F_s_i_parallel = np.dot(F_s_i, t_hat_i) * t_hat_i\n                    F_i_final = F_i_perp + F_s_i_parallel\n\n                ci_neb_forces_update[i-1] = F_i_final\n                \n                current_force_norm = np.linalg.norm(F_i_final)\n                if current_force_norm  max_force_norm:\n                    max_force_norm = current_force_norm\n\n            # Check for convergence\n            if max_force_norm  f_tol:\n                break\n                \n            # Update positions of internal images using Euler's method\n            path[1:-1] += s * ci_neb_forces_update\n\n        # After convergence or max iterations, calculate the final barrier\n        final_energies = np.array([potential_energy(p) for p in path])\n        e_ref = potential_energy(r_start)\n        e_max = np.max(final_energies)\n        barrier = e_max - e_ref\n        \n        return barrier\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # (N_img, k, f_tol, N_max, s, N_climb)\n        (7, 5.0, 5e-3, 15000, 0.03, 200),\n        (9, 3.0, 2e-3, 20000, 0.02, 300),\n        (5, 10.0, 1e-2, 8000, 0.04, 100),\n        (3, 5.0, 5e-3, 12000, 0.03, 150),\n    ]\n\n    results = []\n    for case in test_cases:\n        barrier = run_ci_neb(*case)\n        results.append(round(barrier, 3))\n\n    # Print the final results in the exact specified format\n    # The format must be a list of comma-separated floats, e.g., \"[0.842,0.839,0.846,0.840]\"\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}