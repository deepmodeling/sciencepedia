{
    "hands_on_practices": [
        {
            "introduction": "在构建微结构解析模型时，首要步骤是将连续的几何形状离散化为计算网格。此过程的保真度直接影响仿真的准确性，特别是对于控制电化学反应速率的比表面积等关键几何参数。这项实践将引导您通过数值分析来量化离散化误差，从而在计算成本和模型精度之间做出明智的权衡 。",
            "id": "3928322",
            "problem": "在自动化电池设计和仿真中，对锂离子电池电极进行微观结构解析建模时，活性材料颗粒的表面积直接进入反应动力学和传输耦合的计算。考虑一个半径为 $R$ 的球形活性材料颗粒，嵌入一个具有均匀体素尺寸 $\\Delta x$ 的体素化计算域中。我们通过在球坐标系中积分精确的球面面积密度来构建一个二阶表面积估计方案，但使用统一角步长 $\\Delta \\theta$ 的复合中点法则代替连续的极角积分，而方位角积分则通过复合梯形法则进行计算。该方案被参数化，使得沿子午线的相邻极角之间的弧长与体素间距相匹配，即 $R\\,\\Delta \\theta \\approx \\Delta x$。\n\n从基本几何学出发，球体的精确表面积为 $A_{\\text{exact}} = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} R^{2} \\sin \\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = 4\\pi R^{2}$。对于区间 $[0,\\pi]$ 上步长为 $h=\\Delta \\theta$ 的复合中点法则，经典的误差表示表明，对于一个二阶连续可微的被积函数 $f(\\theta)$，存在一个 $\\xi \\in [0,\\pi]$，使得误差满足 $E_{\\text{mid}} = -\\frac{\\pi}{24} h^{2} f''(\\xi)$。请使用此公式，以 $R$ 和 $\\Delta x$ 表示，获得由曲率和二阶求积引起的相对表面积误差的严格上界。\n\n假设方位角积分不产生误差，因为被积函数与 $\\phi$ 无关，并将曲率引起的离散化误差视为由精确面积归一化的极角求积误差。从第一性原理和经过充分检验的数值分析事实出发，推导一个形式为 $\\left|\\frac{A_{\\text{num}}-A_{\\text{exact}}}{A_{\\text{exact}}}\\right| \\leq C \\left(\\frac{\\Delta x}{R}\\right)^{2}$ 的界，其中 $C$ 为显式常数，然后确定所需的最小比率 $R/\\Delta x$，以保证相对误差低于预设的容差 $\\epsilon$。\n\n将您的最终答案表示为关于 $\\epsilon$ 的最小 $R/\\Delta x$ 的闭式解析表达式。无需四舍五入。最终答案是无量纲的，因此不要包含单位。",
            "solution": "问题陈述已经过严格验证，被认为是自洽的、有科学依据且适定的。它提出了一个应用于计算几何的数值分析标准问题，与微观结构解析建模领域相关。所有提供的数据、定义和假设都是一致且足以推导出唯一解的。因此，我们可以进行推导。\n\n该问题要求计算使用特定数值求积方案计算半径为 $R$ 的球体表面积时的相对误差上界，并随后求出达到给定误差容差所需的最小分辨率。\n\n球体的精确表面积由表面元 $\\mathrm{d}A = R^{2} \\sin\\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$ 在极角 $\\theta$ 和方位角 $\\phi$ 的适当范围上积分给出：\n$$\nA_{\\text{exact}} = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} R^{2} \\sin \\theta \\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi\n$$\n被积函数 $R^{2} \\sin \\theta$ 与 $\\phi$ 无关。这使我们可以分离积分：\n$$\nA_{\\text{exact}} = \\left(\\int_{0}^{2\\pi} \\mathrm{d}\\phi\\right) \\left(\\int_{0}^{\\pi} R^{2} \\sin \\theta \\,\\mathrm{d}\\theta\\right) = 2\\pi \\left[-R^{2} \\cos\\theta\\right]_{0}^{\\pi} = 2\\pi \\left(-R^{2}(-1) - (-R^{2}(1))\\right) = 4\\pi R^{2}\n$$\n数值方案近似计算该积分。问题陈述指出，使用复合梯形法则计算的方位角积分不产生误差。这是正确的，因为关于 $\\phi$ 的被积函数 $g(\\phi) = \\int_{0}^{\\pi} R^{2} \\sin \\theta \\,\\mathrm{d}\\theta$ 是一个常数，而复合梯形法则对于常数函数是精确的。因此，误差仅来自极角积分的近似。\n\n面积的数值近似值 $A_{\\text{num}}$ 可以写成：\n$$\nA_{\\text{num}} = 2\\pi \\times (\\text{数值近似}\\int_{0}^{\\pi} R^{2} \\sin \\theta \\,\\mathrm{d}\\theta)\n$$\n数值近似是使用复合中点法则进行的。此近似中的误差（我们记为 $E_{\\theta}$）是积分的数值减去精确值。因此，总面积的误差 $A_{\\text{num}} - A_{\\text{exact}}$ 为 $2\\pi E_{\\theta}$。\n\n问题提供了在区间 $[a,b]$ 上对被积函数 $f(\\theta)$ 使用复合中点法则的误差公式。在我们的例子中，$f(\\theta) = R^{2} \\sin \\theta$，区间是 $[0, \\pi]$，步长是 $h = \\Delta\\theta$。误差公式给出为：\n$$\nE_{\\theta} = -\\frac{\\pi}{24} h^{2} f''(\\xi)\n$$\n对于某个 $\\xi \\in [0, \\pi]$。注意，分子中的项 $\\pi$ 对应于积分区间的长度 $b-a = \\pi-0$。\n\n我们必须首先计算 $f(\\theta)$ 的二阶导数：\n$$\nf(\\theta) = R^{2} \\sin \\theta\n$$\n$$\nf'(\\theta) = \\frac{\\mathrm{d}}{\\mathrm{d}\\theta} (R^{2} \\sin \\theta) = R^{2} \\cos \\theta\n$$\n$$\nf''(\\theta) = \\frac{\\mathrm{d}^{2}}{\\mathrm{d}\\theta^{2}} (R^{2} \\sin \\theta) = -R^{2} \\sin \\theta\n$$\n将此代入误差公式：\n$$\nE_{\\theta} = -\\frac{\\pi}{24} (\\Delta\\theta)^{2} (-R^{2} \\sin \\xi) = \\frac{\\pi R^{2} (\\Delta\\theta)^{2}}{24} \\sin \\xi\n$$\n表面积的总误差则为：\n$$\nA_{\\text{num}} - A_{\\text{exact}} = 2\\pi E_{\\theta} = 2\\pi \\left( \\frac{\\pi R^{2} (\\Delta\\theta)^{2}}{24} \\sin \\xi \\right) = \\frac{\\pi^{2} R^{2} (\\Delta\\theta)^{2}}{12} \\sin \\xi\n$$\n相对误差是该量除以精确面积 $A_{\\text{exact}} = 4\\pi R^{2}$ 进行归一化：\n$$\n\\frac{A_{\\text{num}} - A_{\\text{exact}}}{A_{\\text{exact}}} = \\frac{\\frac{\\pi^{2} R^{2} (\\Delta\\theta)^{2}}{12} \\sin \\xi}{4\\pi R^{2}} = \\frac{\\pi (\\Delta\\theta)^{2}}{48} \\sin \\xi\n$$\n为了找到一个严格的上界，我们取绝对值并找到右侧的最大值。\n$$\n\\left| \\frac{A_{\\text{num}} - A_{\\text{exact}}}{A_{\\text{exact}}} \\right| = \\left| \\frac{\\pi (\\Delta\\theta)^{2}}{48} \\sin \\xi \\right| = \\frac{\\pi (\\Delta\\theta)^{2}}{48} |\\sin \\xi|\n$$\n对于 $\\xi \\in [0, \\pi]$，函数 $\\sin \\xi$ 是非负的，所以 $|\\sin \\xi| = \\sin \\xi$。在此区间上 $\\sin \\xi$ 的最大值是 1，出现在 $\\xi = \\pi/2$ 处。因此，上界为：\n$$\n\\left| \\frac{A_{\\text{num}} - A_{\\text{exact}}}{A_{\\text{exact}}} \\right| \\leq \\frac{\\pi (\\Delta\\theta)^{2}}{48}\n$$\n问题指定了角步长 $\\Delta\\theta$ 和体素间距 $\\Delta x$ 之间的关系：$R\\,\\Delta \\theta \\approx \\Delta x$。为了进行此误差分析，我们将其视为等式 $R\\,\\Delta \\theta = \\Delta x$，这意味着 $\\Delta\\theta = \\frac{\\Delta x}{R}$。将此代入我们的不等式：\n$$\n\\left| \\frac{A_{\\text{num}} - A_{\\text{exact}}}{A_{\\text{exact}}} \\right| \\leq \\frac{\\pi}{48} \\left( \\frac{\\Delta x}{R} \\right)^{2}\n$$\n这与所要求的形式 $\\left|\\frac{A_{\\text{num}}-A_{\\text{exact}}}{A_{\\text{exact}}}\\right| \\leq C \\left(\\frac{\\Delta x}{R}\\right)^{2}$ 相匹配，其中显式常数 $C = \\frac{\\pi}{48}$。\n\n接下来，我们必须找到保证相对误差低于预设容差 $\\epsilon$ 所需的最小比率 $R/\\Delta x$。我们将推导出的上界设为小于或等于 $\\epsilon$：\n$$\n\\frac{\\pi}{48} \\left( \\frac{\\Delta x}{R} \\right)^{2} \\leq \\epsilon\n$$\n我们现在求解比率 $R/\\Delta x$。由于 $R$、$\\Delta x$ 和 $\\epsilon$ 都是正的物理量或误差量，我们可以操作不等式而无需担心符号变化。\n$$\n\\left( \\frac{\\Delta x}{R} \\right)^{2} \\leq \\frac{48\\epsilon}{\\pi}\n$$\n对两边取平方根：\n$$\n\\frac{\\Delta x}{R} \\leq \\sqrt{\\frac{48\\epsilon}{\\pi}}\n$$\n为了找到 $R/\\Delta x$ 的最小值，我们反转不等式：\n$$\n\\frac{R}{\\Delta x} \\geq \\frac{1}{\\sqrt{\\frac{48\\epsilon}{\\pi}}}\n$$\n$$\n\\frac{R}{\\Delta x} \\geq \\sqrt{\\frac{\\pi}{48\\epsilon}}\n$$\n因此，保证满足误差容差的最小比率 $R/\\Delta x$ 是此不等式的下界。\n\n因此，所需的最小比率为 $\\sqrt{\\frac{\\pi}{48\\epsilon}}$。",
            "answer": "$$\\boxed{\\sqrt{\\frac{\\pi}{48\\epsilon}}}$$"
        },
        {
            "introduction": "真实的电极微结构通常包含复杂的孔隙网络，其中部分电解质区域可能被固相材料包围，形成不参与长程离子输运的“死”孔。在求解离子电导问题时，必须对这些孤立区域施加恰当的边界条件以保证全局电荷守恒。这项实践将指导您构建一个能够自动识别并正确处理这些孤立区域的算法，从而确保您的仿真在物理上是自洽的，并避免数值求解中可能出现的奇异性问题 。",
            "id": "3928365",
            "problem": "您的任务是为一个多孔电池电极电解质域中的微观结构解析传导问题制定边界条件，以确保即使当部分电解质被孤立孔隙和非渗透区域所隔离时，全局电荷守恒也始终得到满足。基本依据必须是具有线性本构行为的稳态离子电荷守恒定律：\n\n- 稳态守恒定律由电解质体相中离子电流密度的散度为零给出，此处不存在体积源：$$\\nabla \\cdot \\mathbf{j}_e = 0.$$\n- 离子电流密度通过线性本构关系与电解质电势相关联：$$\\mathbf{j}_e = -\\kappa \\nabla \\phi_e,$$ 其中 $\\kappa$ 是离子电导率（单位为 $\\mathrm{S/m}$），$\\phi_e$ 是电解质电势（单位为 $\\mathrm{V}$）。\n- 在发生电化学反应的固-电解质界面上，施加一个线性化的类Butler-Volmer边界条件（Robin类型），该条件将法向通量与过电势关联起来：$$-\\mathbf{n} \\cdot \\mathbf{j}_e = k \\left(\\phi_e - \\phi_{\\mathrm{eq}}\\right),$$ 其中 $k$ 是界面反应电导（单位为 $\\mathrm{A/(m^2 \\cdot V)}$），$\\phi_{\\mathrm{eq}}$ 是平衡电势（单位为 $\\mathrm{V}$），$\\mathbf{n}$ 是电解质域的向外单位法向量。\n- 在外部储库边界上，强制执行狄利克雷条件：$$\\phi_e = \\phi_{\\mathrm{L}} \\text{ 在左边界,} \\quad \\phi_e = \\phi_{\\mathrm{R}} \\text{ 在右边界},$$ 其中 $\\phi_{\\mathrm{L}}$ 和 $\\phi_{\\mathrm{R}}$ 的单位为 $\\mathrm{V}$。\n- 在非反应边界（例如，如果指定为不导电的域的顶部和底部）上，强制执行零通量诺伊曼条件：$$-\\mathbf{n} \\cdot \\mathbf{j}_e = 0.$$\n\n不渗透到任何储库边界的孤立电解质组分必须与固相的净离子交换为零；也就是说，必须通过在其所有固体界面上设置 $k=0$ 来禁用那里的反应边界条件。这强制要求没有净电荷可以进入或离开那些孤立区域，这是全局电荷守恒所要求的。\n\n构建一个纯粹的数学和算法程序，该程序：\n1. 识别连接的电解质组分，并确定哪些组分渗透到左侧或右侧储库。\n2. 在一个均匀的笛卡尔网格上使用有限体积离散化，组装并求解得到的关于 $\\phi_e$ 的线性系统。该网格的单元尺寸为 $dx$（单位为 $\\mathrm{m}$），面外厚度为 $t$（单位为 $\\mathrm{m}$），其中每个面的传导率为 $$T = \\kappa \\, t.$$ 每个电解质-固体面的反应通量贡献为 $$F_{\\mathrm{rxn}} = k \\, t \\, dx \\, \\left(\\phi_e - \\phi_{\\mathrm{eq}}\\right).$$\n3. 在与孤立电解质组分相邻的所有固体界面上强制 $k=0$。\n4. 计算全局守恒残差，定义为所有电解质边界流出通量和所有反应流出通量的代数和：\n   $$\\mathcal{R} = \\sum_{\\text{reservoir faces}} T \\left(\\phi_e - \\phi_{\\mathrm{res}}\\right) + \\sum_{\\text{reactive faces}} k \\, t \\, dx \\left(\\phi_e - \\phi_{\\mathrm{eq}}\\right),$$\n   其中 $\\phi_{\\mathrm{res}}$ 是 $\\phi_{\\mathrm{L}}$ 或 $\\phi_{\\mathrm{R}}$，取决于储库面。由于内部面通量的抵消和稳态守恒定律，当边界条件一致时，量 $\\mathcal{R}$ 在数值上必须接近于零。\n\n该程序必须为一组二维微观结构掩模实现上述过程，将顶部和底部边界视为零通量诺伊曼边界。面外厚度 $t$ 必须用于将面通量密度转换为电流，因此所有电流单位均为 $\\mathrm{A}$。如果任何电解质组分完全孤立（没有接触储库且没有反应界面，因为 $k$ 被设置为零），则在该组分中直接指定 $\\phi_e = \\phi_{\\mathrm{eq}}$ 以避免奇异性，而不引入任何人为通量。\n\n物理单位和参数：\n- $\\kappa$ 单位为 $\\mathrm{S/m}$；使用 $\\kappa = 1.0 \\, \\mathrm{S/m}$。\n- $k$ 单位为 $\\mathrm{A/(m^2 \\cdot V)}$；对于渗透组分的反应界面，使用 $k = 1.0 \\times 10^{6} \\, \\mathrm{A/(m^2 \\cdot V)}$；对于孤立组分，使用 $k = 0$。\n- $dx = 1.0 \\times 10^{-5} \\, \\mathrm{m}$（单元尺寸）。\n- $t = 5.0 \\times 10^{-6} \\, \\mathrm{m}$（面外厚度）。\n- $\\phi_{\\mathrm{eq}} = 0.0 \\, \\mathrm{V}$，$\\phi_{\\mathrm{L}} = 0.1 \\, \\mathrm{V}$，$\\phi_{\\mathrm{R}} = 0.0 \\, \\mathrm{V}$。\n\n角度单位不适用。所有输出电流必须以 $\\mathrm{A}$ 表示。\n\n测试套件：\n- 情况1（理想情况）：网格尺寸 $8 \\times 6$；一个沿中间行的渗透电解质通道连接左右储库；通道外有一个额外的孤立区域。预期全局残差接近 $0 \\, \\mathrm{A}$。\n- 情况2（孤立边缘情况）：网格尺寸 $5 \\times 5$；一个不接触任何储库的单单元孤立电解质区域；反应被禁用。预期残差恰好为 $0 \\, \\mathrm{A}$。\n- 情况3（仅左侧渗透）：网格尺寸 $7 \\times 6$；一个电解质区域仅接触左侧储库，在到达右边界之前终止；其固体界面上的反应是活动的。预期残差接近 $0 \\, \\mathrm{A}$。\n- 情况4（薄路径边界情况）：网格尺寸 $3 \\times 3$；一个横跨中间行的单单元宽电解质路径连接左右储库；反应是活动的。预期残差接近 $0 \\, \\mathrm{A}$。\n\n您的程序必须产生单行输出，其中包含四个情况的全局残差，格式为用方括号括起来的逗号分隔列表，例如，“[r1,r2,r3,r4]”。每个列表项必须是一个以 $\\mathrm{A}$ 为单位的浮点数。不应打印任何其他文本。",
            "solution": "所提出的问题是一个定义明确的电化学边值问题，它基于稳态电荷守恒的基本原理。它要求解一个线性椭圆偏微分方程，特别是关于电解质电势 $\\phi_e$ 的拉普拉斯方程，该方程受狄利克雷、诺伊曼和罗宾边界条件的组合约束。该问题在科学上和数学上都是合理的。\n\n核心挑战在于在一个具有复杂、可能不连通的微观结构的域中满足全局电荷守恒。未连接到外部电流储库（即非渗透组分）的电解质区域不能作为电荷的净源或净汇。该问题通过要求这些孤立区域与固相的净离子交换为零来正确地形式化了这一物理约束。这是通过在其边界上将界面反应电导 $k$ 设置为 $0$ 来禁用电化学反应实现的。此过程不是任意简化，而是确保问题保持物理意义和数学适定性的必要条件。\n\n如果一个电解质组分完全与两个储库和所有反应性固体界面断开（无论是由于几何形状还是因为 $k$ 已被设置为 $0$），其电势 $\\phi_e$ 仅在相差一个加性常数的意义下是确定的。该问题通过规定在这些区域中 $\\phi_e = \\phi_{\\mathrm{eq}}$ 来解决这种模糊性，这是一个物理上合理的选择，它将电势设置为一个不存在净反应驱动力的参考值，从而确保不引入人为通量，并且得到的线性系统不是奇异的。\n\n解决方案将按规定在均匀笛卡尔网格上使用有限体积法（FVM）实现。这种方法具有内在的守恒性，使其非常适合解决此问题。总体算法如下：\n\n1.  **组分识别**：离散的微观结构被视为一个图，其中电解质单元是节点，相邻的电解质单元共享一条边。采用图遍历算法，如广度优先搜索（BFS），来识别电解质相内的所有连通组分。对于每个组分，我们确定它是否渗透到左侧储库（列 $j=0$）、右侧储库（列 $j=N-1$）或两者皆否。如果一个组分至少连接到一个储库，则认为它是“渗透的”。\n\n2.  **线性系统组装**：构建一个形式为 $\\mathbf{A}\\boldsymbol{\\phi} = \\mathbf{b}$ 的线性方程组，其中 $\\boldsymbol{\\phi}$ 是每个电解质单元中心的未知电势向量。矩阵 $\\mathbf{A}$ 和向量 $\\mathbf{b}$ 是通过将守恒定律应用于每个电解质单元（控制体积）来组装的。\n    - 对于属于非渗透组分的电解质单元 $p$，如果没有参考，其电势是不确定的。我们通过创建一个平凡方程 $1 \\cdot \\phi_p = \\phi_{\\mathrm{eq}}$ 来强制执行条件 $\\phi_p = \\phi_{\\mathrm{eq}}$。这使得 $\\mathbf{A}$ 中的对应行在对角线上为 $1$，其他地方为 $0$，而 $\\mathbf{b}$ 中的对应项为 $\\phi_{\\mathrm{eq}}$。\n    - 对于渗透组分中的电解质单元 $p$，FVM 方程通过对其四个面流出的所有电流求和来建立。\n        - **传导通量**：到相邻电解质单元 $q$ 的电流为 $I_{p \\to q} = T (\\phi_p - \\phi_q)$，其中 $T = \\kappa t$ 是面传导率。\n        - **反应通量**：到相邻固相单元的电流为 $I_{p \\to \\text{solid}} = k \\, t \\, dx (\\phi_p - \\phi_{\\mathrm{eq}})$。这里，由于组分是渗透的，$k > 0$。\n        - **储库通量**：到相邻储库（例如左侧）的电流为 $I_{p \\to \\text{res}} = T (\\phi_p - \\phi_{\\mathrm{L}})$。\n        - **诺伊曼边界通量**：跨越非反应（例如顶部/底部）边界的电流为零。\n    单元 $p$ 的 FVM 方程为 $\\sum_{\\text{faces}} I_{\\text{out}} = 0$。将左侧的未知电势项和右侧的常数项分组，即可得到系统 $\\mathbf{A}\\boldsymbol{\\phi} = \\mathbf{b}$ 的第 $p$ 行。\n\n3.  **系统求解**：得到的线性系统是大型且稀疏的。使用稀疏线性代数求解器可以高效地解出 $\\boldsymbol{\\phi}$。\n\n4.  **残差计算**：获得电势场 $\\phi_e$ 后，通过对穿过域外部边界（储库和反应界面）的所有电流求和来计算全局守恒残差 $\\mathcal{R}$，使用提供的公式：\n    $$\\mathcal{R} = \\sum_{\\text{reservoir faces}} T \\left(\\phi_e - \\phi_{\\mathrm{res}}\\right) + \\sum_{\\text{reactive faces}} k \\, t \\, dx \\left(\\phi_e - \\phi_{\\mathrm{eq}}\\right)$$\n    此总和中的反应电导 $k$ 是模拟中使用的有效值（对于渗透组分 $k > 0$，对于孤立组分 $k=0$）。根据 FVM 的原理，如果问题被正确地表述和求解，这个总和在数值上必须接近于零。\n\n这个系统化的程序保证了对于任意微观结构，全局电荷守恒都得到遵守，正确处理了孤立域的物理和数学复杂性。",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\nfrom collections import deque\n\ndef solve():\n    \"\"\"\n    Validates and solves the microstructure-resolved conduction problem.\n    \"\"\"\n    \n    # --- PHYSICAL PARAMETERS ---\n    KAPPA = 1.0  # S/m\n    K_RXN = 1.0e6  # A/(m^2 * V)\n    DX = 1.0e-5  # m\n    T_THICKNESS = 5.0e-6  # m\n    PHI_EQ = 0.0  # V\n    PHI_L = 0.1  # V\n    PHI_R = 0.0  # V\n\n    T = KAPPA * T_THICKNESS  # Transmissibility (S)\n\n    # --- TEST SUITE DEFINITION ---\n    # 1: electrolyte, 0: solid\n    case1_grid = np.zeros((8, 6), dtype=int)\n    case1_grid[3:5, :] = 1  # Percolating channel\n    case1_grid[0:2, 0:2] = 1 # Isolated pocket\n\n    case2_grid = np.zeros((5, 5), dtype=int)\n    case2_grid[2, 2] = 1  # Single isolated cell\n\n    case3_grid = np.zeros((7, 6), dtype=int)\n    case3_grid[2:5, 0:3] = 1 # Left-only percolation\n\n    case4_grid = np.zeros((3, 3), dtype=int)\n    case4_grid[1, :] = 1 # Thin percolating path\n\n    test_cases = [\n        {\"grid\": case1_grid},\n        {\"grid\": case2_grid},\n        {\"grid\": case3_grid},\n        {\"grid\": case4_grid},\n    ]\n\n    results = []\n    \n    for case_data in test_cases:\n        grid = case_data[\"grid\"]\n        M, N = grid.shape\n\n        # Step 1: Identify connected components using BFS\n        visited = np.zeros_like(grid, dtype=bool)\n        component_map = np.full_like(grid, -1, dtype=int)\n        component_props = []\n        component_id_counter = 0\n\n        for r_start in range(M):\n            for c_start in range(N):\n                if grid[r_start, c_start] == 1 and not visited[r_start, c_start]:\n                    q = deque([(r_start, c_start)])\n                    visited[r_start, c_start] = True\n                    \n                    is_left_percolating = False\n                    is_right_percolating = False\n                    \n                    while q:\n                        r, c = q.popleft()\n                        component_map[r, c] = component_id_counter\n                        if c == 0:\n                            is_left_percolating = True\n                        if c == N - 1:\n                            is_right_percolating = True\n                        \n                        for dr, dc in [(0, 1), (0, -1), (1, 0), (-1, 0)]:\n                            nr, nc = r + dr, c + dc\n                            if 0 = nr  M and 0 = nc  N and grid[nr, nc] == 1 and not visited[nr, nc]:\n                                visited[nr, nc] = True\n                                q.append((nr, nc))\n                    \n                    is_percolating = is_left_percolating or is_right_percolating\n                    component_props.append({\"percolating\": is_percolating})\n                    component_id_counter += 1\n\n        # Map electrolyte cell coordinates to linear system indices\n        electrolyte_cells = np.argwhere(grid == 1)\n        num_vars = len(electrolyte_cells)\n        coord_to_idx = {tuple(coord): i for i, coord in enumerate(electrolyte_cells)}\n\n        if num_vars == 0:\n            results.append(0.0)\n            continue\n            \n        # Step 2: Assemble the linear system A*phi = b\n        A = lil_matrix((num_vars, num_vars), dtype=float)\n        b = np.zeros(num_vars, dtype=float)\n\n        for idx, (r, c) in enumerate(electrolyte_cells):\n            comp_id = component_map[r, c]\n            is_percolating = component_props[comp_id][\"percolating\"]\n\n            if not is_percolating:\n                # Enforce phi_e = phi_eq for non-percolating components\n                A[idx, idx] = 1.0\n                b[idx] = PHI_EQ\n                continue\n\n            # Assemble FVM equation for percolating cells\n            for dr, dc in [(0, 1), (0, -1), (1, 0), (-1, 0)]:\n                nr, nc = r + dr, c + dc\n\n                # Neighbor is a boundary\n                if not (0 = nr  M and 0 = nc  N):\n                    # Left reservoir boundary\n                    if nc  0:\n                        A[idx, idx] += T\n                        b[idx] += T * PHI_L\n                    # Right reservoir boundary\n                    elif nc >= N:\n                        A[idx, idx] += T\n                        b[idx] += T * PHI_R\n                    # Top/Bottom are Neumann (zero flux), no contribution\n                else:\n                    # Neighbor is an electrolyte cell\n                    if grid[nr, nc] == 1:\n                        neighbor_idx = coord_to_idx[(nr, nc)]\n                        A[idx, idx] += T\n                        A[idx, neighbor_idx] -= T\n                    # Neighbor is a solid (reactive boundary)\n                    else:\n                        A[idx, idx] += K_RXN * T_THICKNESS * DX\n                        b[idx] += K_RXN * T_THICKNESS * DX * PHI_EQ\n\n        # Step 3: Solve the system\n        A = A.tocsr()\n        phi_vec = spsolve(A, b)\n\n        # Create a potential grid for easier residual calculation\n        potential_grid = np.full_like(grid, np.nan, dtype=float)\n        for idx, (r, c) in enumerate(electrolyte_cells):\n            potential_grid[r, c] = phi_vec[idx]\n            \n        # Step 4: Compute global conservation residual\n        residual = 0.0\n        for r, c in electrolyte_cells:\n            phi_p = potential_grid[r, c]\n            \n            # Reservoir fluxes\n            if c == 0:\n                residual += T * (phi_p - PHI_L)\n            if c == N - 1:\n                residual += T * (phi_p - PHI_R)\n\n            # Reaction fluxes\n            k_eff = 0.0\n            comp_id = component_map[r,c]\n            if component_props[comp_id][\"percolating\"]:\n                k_eff = K_RXN\n\n            for dr, dc in [(0, 1), (0, -1), (1, 0), (-1, 0)]:\n                nr, nc = r + dr, c + dc\n                if 0 = nr  M and 0 = nc  N and grid[nr, nc] == 0:\n                     residual += k_eff * T_THICKNESS * DX * (phi_p - PHI_EQ)\n\n        results.append(residual)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "微结构解析模型的最终价值在于其预测能力和与实验的关联性。通过将模型预测与电化学阻抗谱（EIS）等实验数据进行拟合，我们可以反向标定模型中难以直接测量的关键物理参数。这项实践将引导您推导一个多孔电极的阻抗模型，并利用非线性最小二乘法来校准交换电流密度（$j_0$）和有效电导率（$\\kappa_{\\mathrm{eff}}$），从而完成从理论建模到实验验证的关键闭环 。",
            "id": "3928396",
            "problem": "您将获得一个已知的多孔电极微观结构以及在多个角频率下测量的复阻抗谱。您的任务是构建并实现一种方法，通过将一个基于物理推导、微观结构解析的小信号模型与测量光谱进行拟合，来校准界面交换电流密度 $j_0$ 和有效离子电导率 $\\kappa_{\\mathrm{eff}}$。微观结构在厚度方向坐标 $x$ 上是均匀的，固相被假定为具有高电子导电性，而电解质相则由一个考虑了曲折度的有效离子电导率来表征。\n\n从适用于小信号电化学阻抗谱（EIS）的第一性原理开始，包括：\n- 电解质相中的电荷守恒和界面反应动力学。\n- 电解质-固相界面的线性化双电层响应。\n- 将具有已知比表面积的多孔电极映射到分布式传输线模型。\n\n在此基础上，推导出一个依赖于 $j_0$ 和 $\\kappa_{\\mathrm{eff}}$ 以及已知的微观结构和热力学参数的多孔电极阻抗的一维频域表示。使用此表示来构建一个非线性最小二乘目标函数，该函数能同时拟合所提供频率范围内阻抗的实部和虚部。\n\n实现校准过程并为每个测试案例输出估计的参数。您的算法必须：\n- 接受已知的微观结构常数和热力学常数。\n- 使用指定的频率网格。\n- 根据给定的参数 $j_0$ 和 $\\kappa_{\\mathrm{eff}}$ 计算复阻抗模型。\n- 最小化阻抗数据实部和虚部的残差平方和。\n- 以 $\\mathrm{A/m^2}$ 为单位返回 $j_0$，以 $\\mathrm{S/m}$ 为单位返回 $\\kappa_{\\mathrm{eff}}$。\n\n假设多孔电极的厚度为 $L$，暴露的宏观面积为 $A$，单位体积的比界面面积为 $a_s$，单位界面面积的双电层电容为 $c_{\\mathrm{dl}}$。多孔电极外部的电解质体电阻（隔膜和引线）为 $R_b$，并被视为已知。热力学常数包括通用气体常数 $R$、法拉第常数 $F$、温度 $T$ 以及转移的电子数 $n$。频率以 $\\mathrm{Hz}$ 为单位给出，必须使用公式 $\\omega = 2\\pi f$ 将其转换为以弧度/秒为单位的角频率，其中角度单位为弧度。\n\n您的程序必须使用以下测试套件。对于每个案例，合成的“测量”光谱是使用相同的微观结构解析模型和所列的真实参数生成的（这确保了内部一致性和科学真实性）。您必须通过校准来恢复这些参数。除了最后两行中的真实参数外，所有案例的微观结构和常数都相同。所有数值必须完全按照给定的使用。\n\n已知常数（所有案例共享）：\n- 电极厚度 $L = 70\\times 10^{-6}\\ \\mathrm{m}$（$70$ 微米）。\n- 电极面积 $A = 1\\times 10^{-4}\\ \\mathrm{m}^2$（$1$ 平方厘米）。\n- 比表面积 $a_s = 3\\times 10^{5}\\ \\mathrm{m^2/m^3}$。\n- 单位面积双电层电容 $c_{\\mathrm{dl}} = 0.2\\ \\mathrm{F/m^2}$。\n- 隔膜和引线电阻 $R_b = 0.5\\ \\Omega$。\n- 温度 $T = 298\\ \\mathrm{K}$。\n- 通用气体常数 $R = 8.314\\ \\mathrm{J/(mol\\cdot K)}$。\n- 法拉第常数 $F = 96485\\ \\mathrm{C/mol}$。\n- 转移电子数 $n = 1$。\n\n频率网格（单位 $\\mathrm{Hz}$），需通过 $\\omega = 2\\pi f$ 转换为 $\\mathrm{rad/s}$ 单位的 $\\omega$：\n$\\left[\\, 1,\\ 3.16227766,\\ 10,\\ 31.6227766,\\ 100,\\ 316.227766,\\ 1000,\\ 3162.27766,\\ 10000 \\,\\right]$。\n\n用于合成测量光谱的各案例真实参数：\n- 案例 $1$：$j_0^{\\mathrm{true}} = 5\\ \\mathrm{A/m^2}$，$\\kappa_{\\mathrm{eff}}^{\\mathrm{true}} = 0.5\\ \\mathrm{S/m}$。\n- 案例 $2$：$j_0^{\\mathrm{true}} = 100\\ \\mathrm{A/m^2}$，$\\kappa_{\\mathrm{eff}}^{\\mathrm{true}} = 0.6\\ \\mathrm{S/m}$。\n- 案例 $3$：$j_0^{\\mathrm{true}} = 5\\ \\mathrm{A/m^2}$，$\\kappa_{\\mathrm{eff}}^{\\mathrm{true}} = 0.1\\ \\mathrm{S/m}$。\n\n对于每个案例，测量的光谱是在频率网格上的复阻抗 $\\{Z(\\omega_i)\\}$，由您的方法必须拟合的同一个基于物理的微观结构解析模型生成。\n\n最终输出要求：\n- 以 $\\mathrm{A/m^2}$ 表示估计的 $j_0$，以 $\\mathrm{S/m}$ 表示估计的 $\\kappa_{\\mathrm{eff}}$。\n- 您的程序应生成单行输出，其中包含所有案例的结果，格式为由每个案例的双元素列表组成的逗号分隔列表，格式必须完全符合：$[[j0_1,\\kappa_1],[j0_2,\\kappa_2],[j0_3,\\kappa_3]]$。\n- 最终输出中的每个数字都应为十进制浮点数。输出行中不应出现单位、文本、空格或额外字符。",
            "solution": "该问题要求通过将一个微观结构解析的阻抗模型与提供的光谱数据进行拟合，来校准两个电化学参数：界面交换电流密度 $j_0$ 和有效离子电导率 $\\kappa_{\\mathrm{eff}}$。解决方案分两个阶段进行：首先，从基本原理推导基于物理的阻抗模型；其次，构建一个数值优化问题以执行参数估计。\n\n### 多孔电极阻抗模型的推导\n\n我们首先建立一维多孔电极在小信号交流扰动下的控制方程。电极从 $x=0$（集流体）延伸到 $x=L$（隔膜界面）。\n\n1.  **电荷守恒与欧姆定律：** 在电解质相中，离子电流密度 $i_2(x,t)$（单位为宏观面积的 $\\mathrm{A/m^2}$）的散度与穿过电极-电解质界面的电流相平衡。单位电极体积的界面电流转移量由比表面积 $a_s$ 和局部孔壁通量 $j_{\\mathrm{total}}(x,t)$（单位为界面面积的 $\\mathrm{A/m^2}$）的乘积给出。\n    $$ \\frac{\\partial i_2}{\\partial x} = -a_s j_{\\mathrm{total}} $$\n    根据欧姆定律，离子电流由电解质电势 $\\phi_2(x,t)$ 的梯度驱动，其中 $\\kappa_{\\mathrm{eff}}$ 是考虑了孔隙率和曲折度的有效离子电导率。\n    $$ i_2 = -\\kappa_{\\mathrm{eff}} \\frac{\\partial \\phi_2}{\\partial x} $$\n    结合这两个方程，得到一个关于电解质电势的二阶关系式：\n    $$ \\kappa_{\\mathrm{eff}} \\frac{\\partial^2 \\phi_2}{\\partial x^2} = a_s j_{\\mathrm{total}} $$\n\n2.  **界面动力学：** 总孔壁通量 $j_{\\mathrm{total}}$ 由两个并联的部分组成：法拉第反应电流 $j_F$ 和非法拉第双电层充电电流 $j_{dl}$。\n    $$ j_{\\mathrm{total}} = j_F + j_{dl} $$\n    双电层充电电流与局部表面过电势 $\\eta(x,t) = \\phi_s(x,t) - \\phi_2(x,t) - U_{ocp}$ 的变化率成正比，其中 $\\phi_s$ 是固相电势，$c_{\\mathrm{dl}}$ 是单位界面面积的双电层电容。\n    $$ j_{dl} = c_{\\mathrm{dl}} \\frac{\\partial \\eta}{\\partial t} $$\n    法拉第电流由 Butler-Volmer 方程描述。对于平衡点（$\\eta \\approx 0$）附近的小正弦扰动，该方程可以线性化为：\n    $$ j_F \\approx j_0 \\frac{n F}{R T} \\eta $$\n    其中 $j_0$ 是交换电流密度，$n$ 是转移的电子数，$F$ 是法拉第常数，$R$ 是通用气体常数，$T$ 是温度。量 $R_{ct} = \\frac{RT}{nFj_0}$ 是单位界面面积的电荷转移电阻。\n\n3.  **频域表示：** 对于电化学阻抗谱（EIS），我们分析系统对小正弦扰动的响应。通过应用傅里叶变换，我们转换到频域，其中时间导数 $\\frac{\\partial}{\\partial t}$ 被替换为 $i\\omega$，$\\omega$ 是角频率，$i = \\sqrt{-1}$。让带有“帽子”符号的变量表示频域中的复振幅。\n    总界面通量变为：\n    $$ \\hat{j}_{\\mathrm{total}} = \\left( \\frac{1}{R_{ct}} + i\\omega c_{\\mathrm{dl}} \\right) \\hat{\\eta} = \\left( \\frac{nFj_0}{RT} + i\\omega c_{\\mathrm{dl}} \\right) \\hat{\\eta} $$\n    括号中的项是单位面积的界面导纳，我们将其表示为 $Y'_{\\text{int}}$。\n    电势的控制方程变换为：\n    $$ \\kappa_{\\mathrm{eff}} \\frac{d^2 \\hat{\\phi}_2}{dx^2} = a_s Y'_{\\text{int}} \\hat{\\eta} $$\n    假设固相具有高导电性，其电势 $\\hat{\\phi}_s$ 在整个电极上是均匀的。过电势为 $\\hat{\\eta}(x) = \\hat{\\phi}_s - \\hat{\\phi}_2(x)$。对 $x$ 求二阶导数得到 $\\frac{d^2\\hat{\\eta}}{dx^2} = -\\frac{d^2\\hat{\\phi}_2}{dx^2}$。将此代入控制方程，得到一个关于过电势的齐次二阶常微分方程：\n    $$ \\frac{d^2 \\hat{\\eta}}{dx^2} - \\gamma^2 \\hat{\\eta} = 0 \\quad \\text{where} \\quad \\gamma^2 = \\frac{a_s Y'_{\\text{int}}}{\\kappa_{\\mathrm{eff}}} $$\n    因此，复传播常数 $\\gamma$ 为：\n    $$ \\gamma(\\omega) = \\sqrt{\\frac{a_s}{\\kappa_{\\mathrm{eff}}} \\left( \\frac{nFj_0}{RT} + i\\omega c_{\\mathrm{dl}} \\right)} $$\n    该常微分方程（ODE）的通解为 $\\hat{\\eta}(x) = C_1 e^{\\gamma x} + C_2 e^{-\\gamma x}$。我们使用边界条件来确定常数 $C_1$ 和 $C_2$：\n    - 在集流体处（$x=0$），没有离子电流可以流过，因此 $\\hat{i}_2(0) = 0$。由于 $\\hat{i}_2 = \\kappa_{\\mathrm{eff}} \\frac{d\\hat{\\eta}}{dx}$，这意味着 $\\frac{d\\hat{\\eta}}{dx}\\Big|_{x=0} = 0$。应用此条件得到 $\\gamma(C_1 - C_2) = 0$，所以 $C_1 = C_2$。解简化为 $\\hat{\\eta}(x) = 2C_1\\cosh(\\gamma x)$。\n    - 在电极-隔膜界面处（$x=L$），施加的总电流 $I_{\\text{total}}$ 等于流入电极的离子电流，$I_{\\text{total}} = A \\cdot \\hat{i}_2(L)$，其中 $A$ 是宏观电极面积。\n      $$ I_{\\text{total}} = A \\cdot \\kappa_{\\mathrm{eff}} \\frac{d\\hat{\\eta}}{dx}\\Big|_{x=L} = A \\cdot \\kappa_{\\mathrm{eff}} \\cdot (2C_1\\gamma \\sinh(\\gamma L)) $$\n    多孔电极的阻抗 $Z_p$ 是其两端电势差与总电流之比。我们将此电势定义为电极前端相对于集流体的过电势 $\\hat{\\eta}(L)$。\n    $$ Z_p(\\omega) = \\frac{\\hat{\\eta}(L)}{I_{\\text{total}}} = \\frac{2C_1\\cosh(\\gamma L)}{A \\kappa_{\\mathrm{eff}} (2C_1\\gamma \\sinh(\\gamma L))} = \\frac{\\cosh(\\gamma L)}{A \\kappa_{\\mathrm{eff}} \\gamma \\sinh(\\gamma L)} = \\frac{1}{A \\kappa_{\\mathrm{eff}} \\gamma \\tanh(\\gamma L)} $$\n    总模型阻抗 $Z_{\\text{model}}$ 还包括来自电极外部电解质和其他电池组件的串联电阻 $R_b$：\n    $$ Z_{\\text{model}}(\\omega; j_0, \\kappa_{\\mathrm{eff}}) = R_b + Z_p(\\omega) = R_b + \\frac{1}{A \\kappa_{\\mathrm{eff}} \\gamma \\tanh(\\gamma L)} $$\n\n### 通过非线性最小二乘法进行参数校准\n\n目标是找到参数矢量 $\\boldsymbol{\\theta} = [j_0, \\kappa_{\\mathrm{eff}}]$，使得在一组角频率 $\\{\\omega_k\\}$ 上，模型阻抗 $Z_{\\text{model}}(\\omega_k; \\boldsymbol{\\theta})$ 与测量得到的阻抗数据 $Z_{\\text{meas}}(\\omega_k)$ 之间的差异最小化。我们构建一个非线性最小二乘目标函数 $\\mathcal{L}(\\boldsymbol{\\theta})$，它表示阻抗实部和虚部的残差平方和：\n$$ \\mathcal{L}(\\boldsymbol{\\theta}) = \\sum_{k} \\left( \\left( \\text{Re}\\{Z_{\\text{model}}(\\omega_k; \\boldsymbol{\\theta})\\} - \\text{Re}\\{Z_{\\text{meas}}(\\omega_k)\\} \\right)^2 + \\left( \\text{Im}\\{Z_{\\text{model}}(\\omega_k; \\boldsymbol{\\theta})\\} - \\text{Im}\\{Z_{\\text{meas}}(\\omega_k)\\} \\right)^2 \\right) $$\n这等效于最小化 $\\sum_k |Z_{\\text{model}}(\\omega_k; \\boldsymbol{\\theta}) - Z_{\\text{meas}}(\\omega_k)|^2$。解决此问题的方法是提供合成的测量光谱，这些光谱是使用相同的 $Z_{\\text{model}}$ 公式和每个案例的已知“真实”参数生成的。然后，我们使用数值优化算法，例如 Levenberg-Marquardt（在 `scipy.optimize.least_squares` 中实现），来找到参数矢量 $\\boldsymbol{\\theta}_{\\text{fit}} = \\arg\\min \\mathcal{L}(\\boldsymbol{\\theta})$。\n\n实现将按以下步骤进行：\n1.  根据推导的公式，定义一个函数来计算 $Z_{\\text{model}}(\\omega; j_0, \\kappa_{\\mathrm{eff}})$。\n2.  对于每个测试案例，使用给定的真实参数生成目标 $Z_{\\text{meas}}$ 数据。\n3.  定义一个残差函数，该函数返回一个包含所有频率下实部和虚部差异的向量，即 $[\\text{Re}(Z_{\\text{model}} - Z_{\\text{meas}}), \\text{Im}(Z_{\\text{model}} - Z_{\\text{meas}})]$。\n4.  使用 `scipy.optimize.least_squares`，并提供残差函数、一个初始猜测值以及物理上有意义的边界条件（$j_0  0$, $\\kappa_{\\mathrm{eff}}  0$），来找到最优参数。\n5.  收集并格式化所有测试案例的结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Solves for the exchange current density (j0) and effective ionic conductivity (kappa_eff)\n    by fitting a porous electrode impedance model to synthetic data.\n    \"\"\"\n\n    # --- Known Constants (shared by all cases) in SI units ---\n    L = 70e-6        # Electrode thickness (m)\n    A = 1e-4         # Electrode area (m^2)\n    a_s = 3e5        # Specific surface area (m^2/m^3)\n    c_dl = 0.2       # Double-layer capacitance per area (F/m^2)\n    R_b = 0.5        # Separator and leads resistance (Ohm)\n    T = 298.0        # Temperature (K)\n    R = 8.314        # Universal gas constant (J/(mol*K))\n    F = 96485.0      # Faraday constant (C/mol)\n    n = 1.0          # Electrons transferred\n\n    constants = (L, A, a_s, c_dl, R_b, T, R, F, n)\n\n    # --- Frequency Grid ---\n    f_grid_hz = np.array([\n        1, 3.16227766, 10, 31.6227766, 100, 316.227766, 1000, 3162.27766, 10000\n    ])\n    omega_grid_rad_s = 2 * np.pi * f_grid_hz\n\n    # --- Per-case true parameters for generating synthetic measured spectra ---\n    test_cases = [\n        (5.0, 0.5),    # Case 1: j0_true = 5 A/m^2, kappa_eff_true = 0.5 S/m\n        (100.0, 0.6),  # Case 2: j0_true = 100 A/m^2, kappa_eff_true = 0.6 S/m\n        (5.0, 0.1),    # Case 3: j0_true = 5 A/m^2, kappa_eff_true = 0.1 S/m\n    ]\n\n    def get_model_impedance(params, omega, consts):\n        \"\"\"\n        Calculates the complex impedance of the porous electrode model.\n\n        Args:\n            params (list or tuple): [j0, kappa_eff].\n            omega (np.ndarray): Angular frequencies (rad/s).\n            consts (tuple): Tuple of physical and geometric constants.\n\n        Returns:\n            np.ndarray: Complex impedance Z_model at each frequency.\n        \"\"\"\n        j0, kappa_eff = params\n        L, A, a_s, c_dl, R_b, T, R, F, n = consts\n        \n        # Pre-calculate constant terms\n        nF_over_RT = (n * F) / (R * T)\n        \n        # Interfacial admittance per unit area (Y')\n        # This is a complex array, one value per frequency\n        Y_prime_int = nF_over_RT * j0 + 1j * omega * c_dl\n        \n        # Complex propagation constant (gamma)\n        # Add a small epsilon to kappa_eff to avoid division by zero if it becomes zero during optimization\n        gamma = np.sqrt((a_s * Y_prime_int) / (kappa_eff + 1e-15))\n        \n        # Porous electrode impedance (Z_p)\n        # The denominator term A * kappa_eff * gamma * tanh(gamma * L) can be zero if tanh is zero.\n        # tanh(z) is zero for z = k * pi * 1j. Our gamma*L has a positive real part for omega > 0,\n        # so tanh is not zero. A small epsilon is added for robustness.\n        tanh_gamma_L = np.tanh(gamma * L)\n        Z_p = 1.0 / (A * kappa_eff * gamma * tanh_gamma_L + 1e-15)\n\n        # Total model impedance\n        return R_b + Z_p\n\n    def residuals(params, Z_measured, omega, consts):\n        \"\"\"\n        Calculates the residuals between the model and measured impedance.\n        This is the objective function for the least-squares solver.\n        \"\"\"\n        Z_model = get_model_impedance(params, omega, consts)\n        \n        # The solver minimizes the sum of squares of these returned values\n        res_real = np.real(Z_model) - np.real(Z_measured)\n        res_imag = np.imag(Z_model) - np.imag(Z_measured)\n        \n        # Concatenate real and imaginary parts into a single residual vector\n        return np.concatenate((res_real, res_imag))\n\n    results = []\n    for true_params in test_cases:\n        # 1. Generate synthetic \"measured\" data for the current case\n        j0_true, kappa_eff_true = true_params\n        Z_measured = get_model_impedance([j0_true, kappa_eff_true], omega_grid_rad_s, constants)\n\n        # 2. Set an initial guess for the optimization\n        initial_guess = [10.0, 0.3]\n\n        # 3. Set physically meaningful bounds for the parameters\n        # j0 and kappa_eff must be positive.\n        bounds = ([1e-3, 1e-3], [1e4, 1e2]) \n\n        # 4. Perform the nonlinear least-squares optimization\n        opt_result = least_squares(\n            residuals,\n            initial_guess,\n            args=(Z_measured, omega_grid_rad_s, constants),\n            bounds=bounds,\n            method='trf'  # Trust Region Reflective algorithm, good for bounds\n        )\n        \n        # 5. Extract and store the fitted parameters\n        j0_fit, kappa_eff_fit = opt_result.x\n        results.append([j0_fit, kappa_eff_fit])\n\n    # --- Final Print Statement in the Exact Required Format ---\n    # Example format: [[j0_1,kappa_1],[j0_2,kappa_2],[j0_3,kappa_3]]\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}