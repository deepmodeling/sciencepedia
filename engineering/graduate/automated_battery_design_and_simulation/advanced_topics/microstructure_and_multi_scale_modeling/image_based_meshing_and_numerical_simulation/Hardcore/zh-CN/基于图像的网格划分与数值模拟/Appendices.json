{
    "hands_on_practices": [
        {
            "introduction": "在开始复杂的数值模拟之前，理解网格划分选择的实际影响至关重要。输入图像的分辨率和网格单元类型（例如，四面体与六面体）的选择，直接决定了数值问题的规模及其计算成本。这项练习提供了一个具体场景，通过计算和比较两种常见网格策略的单元数量和所需内存，帮助您建立对基于图像的建模中可扩展性的直观理解。",
            "id": "3919519",
            "problem": "提供了一个锂离子电池电极的微计算机断层扫描（micro-CT）分割微观结构作为代表性体积单元（RVE）。RVE 是一个边长为 $L_x = L_y = L_z = 100\\,\\mu\\text{m}$ 的立方体。图像体素间距为 $a = 0.5\\,\\mu\\text{m}$，分割过程为每个体素分配三种材料标签之一：活性固相、孔隙（电解质）或碳-粘结剂域。目标是生成一个能保持图像分辨率的、基于图像的网格。\n\n定义“等效分辨率”为在四面体或六面体离散化中，所有方向上使用相同的节点间距 $h$，且 $h = a$。对于六面体网格，假设采用与体素对齐的结构化网格，使得每个体素对应一个六面体单元。对于四面体网格，假设每个体素立方体通过一致的立方体到四面体的三角剖分方法被分割成 $6$ 个四面体，且不增加任何内部点，因此四面体网格与六面体网格使用相同的节点集。\n\n假设网格数据结构仅存储以下内容：\n- 每个节点的三个笛卡尔坐标，以 $64$ 位浮点数形式存储，每个数值大小为 $8$ 字节。\n- 每个单元的连接关系，以 $32$ 位非负整数节点索引形式存储，每个索引大小为 $4$ 字节，六面体有 $8$ 个索引，四面体有 $4$ 个索引。\n- 每个单元的一个 $32$ 位整型材料标签，大小为 $4$ 字节。\n\n忽略任何其他数据（如边界条件、求解器向量、幽灵层、元数据）。使用二进制（以2为底）单位，并以吉比字节（GiB）表示内存占用，其中 $1\\,\\text{GiB} = 2^{30}$ 字节。\n\n计算：\n1. 六面体单元的数量。\n2. 四面体单元的数量。\n3. 六面体情况下的总网格内存占用（节点加单元），以 GiB 为单位。\n4. 四面体情况下的总网格内存占用（节点加单元），以 GiB 为单位。\n\n将两个内存值四舍五入到四位有效数字。以行矩阵的形式报告您的最终答案，顺序为 $\\left(N_{\\text{hex}},\\,N_{\\text{tet}},\\,M_{\\text{hex}},\\,M_{\\text{tet}}\\right)$，其中 $N_{\\text{hex}}$ 和 $N_{\\text{tet}}$ 是单元数量，$M_{\\text{hex}}$ 和 $M_{\\text{tet}}$ 是以 GiB 为单位的内存占用。",
            "solution": "该问题要求计算由电池电极的 micro-CT 图像生成的两种不同网格类型（六面体和四面体）的单元数量和总内存占用。验证过程确认该问题是适定的，具有科学依据，并包含足够的信息以获得唯一解。\n\n首先，我们确定代表性体积单元（RVE）中的体素数量。RVE 是一个边长为 $L = 100\\,\\mu\\text{m}$ 的立方体。图像体素间距为 $a = 0.5\\,\\mu\\text{m}$，这也定义了网格分辨率。沿每个维度（$x$, $y$, $z$）的体素数量由 RVE 边长与体素间距之比得出：\n$$N_{v} = \\frac{L}{a} = \\frac{100\\,\\mu\\text{m}}{0.5\\,\\mu\\text{m}} = 200$$\n因此，立方体 RVE 中的总体素数量为：\n$$N_{\\text{voxel}} = N_{v}^3 = 200^3 = 8,000,000$$\n\n接下来，我们计算每种网格类型的单元数量。\n1.  对于六面体网格，每个体素对应一个六面体单元。因此，六面体单元的数量 $N_{\\text{hex}}$ 等于体素的数量。\n    $$N_{\\text{hex}} = N_{\\text{voxel}} = 8,000,000$$\n2.  对于四面体网格，每个体素立方体被分割成 $6$ 个四面体。因此，四面体单元的数量 $N_{\\text{tet}}$ 是体素数量的 $6$ 倍。\n    $$N_{\\text{tet}} = 6 \\times N_{\\text{voxel}} = 6 \\times 8,000,000 = 48,000,000$$\n\n现在，我们确定网格中的总节点数。一个 $N_v \\times N_v \\times N_v$ 体素的结构化网格在每个维度上有 $(N_v+1)$ 个节点。问题说明两种网格类型共享相同的节点集。\n沿每个维度的节点数量为：\n$$N_{n} = N_{v} + 1 = 200 + 1 = 201$$\n总节点数 $N_{\\text{nodes}}$ 为：\n$$N_{\\text{nodes}} = N_{n}^3 = 201^3 = 8,120,601$$\n\n在确定了节点和单元的数量后，我们可以计算内存占用。每个实体的存储需求已指定。\n每个节点的内存（$S_{\\text{node}}$）包括 $3$ 个坐标，每个坐标是一个 $8$ 字节的浮点数：\n$$S_{\\text{node}} = 3 \\times 8\\,\\text{bytes} = 24\\,\\text{bytes}$$\n所有节点的总内存（$M_{\\text{nodes}}$）为：\n$$M_{\\text{nodes}} = N_{\\text{nodes}} \\times S_{\\text{node}} = 8,120,601 \\times 24\\,\\text{bytes} = 194,894,424\\,\\text{bytes}$$\n\n单元的内存针对每种网格类型分别计算。\n对于一个六面体单元（$S_{\\text{hex\\_elem}}$），存储包括 $8$ 个节点索引（每个 $4$ 字节）和一个材料标签（$4$ 字节）：\n$$S_{\\text{hex\\_elem}} = (8 \\times 4\\,\\text{bytes}) + (1 \\times 4\\,\\text{bytes}) = 32 + 4 = 36\\,\\text{bytes}$$\n所有六面体单元的总内存（$M_{\\text{hex\\_elems}}$）为：\n$$M_{\\text{hex\\_elems}} = N_{\\text{hex}} \\times S_{\\text{hex\\_elem}} = 8,000,000 \\times 36\\,\\text{bytes} = 288,000,000\\,\\text{bytes}$$\n六面体网格的总内存占用 $M_{\\text{hex}}$ 是节点内存和单元内存之和：\n$$M_{\\text{hex}} = M_{\\text{nodes}} + M_{\\text{hex\\_elems}} = 194,894,424 + 288,000,000 = 482,894,424\\,\\text{bytes}$$\n\n对于一个四面体单元（$S_{\\text{tet\\_elem}}$），存储包括 $4$ 个节点索引（每个 $4$ 字节）和一个材料标签（$4$ 字节）：\n$$S_{\\text{tet\\_elem}} = (4 \\times 4\\,\\text{bytes}) + (1 \\times 4\\,\\text{bytes}) = 16 + 4 = 20\\,\\text{bytes}$$\n所有四面体单元的总内存（$M_{\\text{tet\\_elems}}$）为：\n$$M_{\\text{tet\\_elems}} = N_{\\text{tet}} \\times S_{\\text{tet\\_elem}} = 48,000,000 \\times 20\\,\\text{bytes} = 960,000,000\\,\\text{bytes}$$\n四面体网格的总内存占用 $M_{\\text{tet}}$ 是节点内存和单元内存之和：\n$$M_{\\text{tet}} = M_{\\text{nodes}} + M_{\\text{tet\\_elems}} = 194,894,424 + 960,000,000 = 1,154,894,424\\,\\text{bytes}$$\n\n最后，我们将这些内存值从字节转换为吉比字节（GiB），其中 $1\\,\\text{GiB} = 2^{30}$ 字节，并四舍五入到四位有效数字。\n$$1\\,\\text{GiB} = 2^{30}\\,\\text{bytes} = 1,073,741,824\\,\\text{bytes}$$\n对于六面体网格：\n$$M_{\\text{hex}} (\\text{GiB}) = \\frac{482,894,424}{1,073,741,824} \\approx 0.4497138\\,\\text{GiB}$$\n四舍五入到四位有效数字得到 $0.4497\\,\\text{GiB}$。\n\n对于四面体网格：\n$$M_{\\text{tet}} (\\text{GiB}) = \\frac{1,154,894,424}{1,073,741,824} \\approx 1.075580\\,\\text{GiB}$$\n四舍五入到四位有效数字得到 $1.076\\,\\text{GiB}$。\n\n所要求的四个值为：\n1.  $N_{\\text{hex}} = 8,000,000$\n2.  $N_{\\text{tet}} = 48,000,000$\n3.  $M_{\\text{hex}} \\approx 0.4497\\,\\text{GiB}$\n4.  $M_{\\text{tet}} \\approx 1.076\\,\\text{GiB}$",
            "answer": "$$\\boxed{\\begin{pmatrix} 8000000 & 48000000 & 0.4497 & 1.076 \\end{pmatrix}}$$"
        },
        {
            "introduction": "网格本身只是一个几何支架；为了进行物理模拟，我们必须为每个网格单元赋予其所代表材料的物理属性。这个关键步骤将在分割后的图像和基于物理的数学模型之间架起一座桥梁。在此练习中，您将开发一个算法，将体素的相标识映射到关键的材料属性，例如离子扩散系数和电导率，同时还将接触到浓度依赖性属性这一重要概念。",
            "id": "3919547",
            "problem": "您将获得一份通过成像和分割得到的三维体素化分割数据，该数据来自一个复合电池电极的微观结构，用于基于图像的网格划分。该区域被离散化为多个体素，每个体素由一个整数相标识符标记：$0$ 代表充满电解质的孔隙空间，$1$ 代表活性材料，$2$ 代表导电添加剂。假设每个体素中的稳态物质扩散遵循 Fick 第一定律，即在活性相中为 $J = -D(c)\\nabla c$，在电解质中为 $J = -D_{e0}\\nabla c$。函数 $D(c)$ 必须是活性相中一个物理上可接受的化学扩散系数，对于所有 $c \\in [0,1]$ 其值严格为正，并通过一个与 Nernst-Einstein 关系和热力学因子论证相符的光滑本构模型，由参考值 $D_{s0}$ 和两个无量纲参数 $a$ 和 $b$ 导出。电传导通过根据每个体素的相为其分配一个恒定的电导率 $\\sigma$ 来建模。该分割数据作为为每个体素分配材料属性的基础，这些属性将用于后续的数值求解器，如有限体积法 (FVM) 或有限元法 (FEM)。\n\n从 Fick 第一定律、连接扩散系数与迁移率和热力学因子的 Nernst-Einstein 关系，以及各相的指示函数定义出发，推导一个算法，为每个体素 $i$ 分配：\n- 根据其相，以及如果处于活性相，则根据其局部锂化学计量分数 $c_i \\in [0,1]$，确定离子/化学扩散系数 $D_i$（单位为 $\\mathrm{m}^2/\\mathrm{s}$）。\n- 根据其相，确定电导率 $\\sigma_i$（单位为 $\\mathrm{S}/\\mathrm{m}$）。\n\n为活性相中的 $D(c)$ 采用一个本构律，该定律满足 $D(0) = D_{s0}$，在 $[0,1]$ 上严格为正，并由两个无量纲参数 $a$ 和 $b$ 决定；所选形式必须从上述基本依据中明确推导出来。电解质的离子扩散系数是恒定的，等于 $D_{e0}$，并且导电添加剂的离子扩散系数被假定为可忽略不计（设为零）。电导率 $\\sigma$ 在每相中是恒定的：电解质为 $\\sigma_e$，活性固相为 $\\sigma_s$，导电添加剂为 $\\sigma_c$。\n\n您的程序必须为每个测试用例计算：\n1. 活性相体素中的体积平均化学扩散系数 $\\overline{D}_\\text{active}$，以 $\\mathrm{m}^2/\\mathrm{s}$ 为单位，表示为浮点数。如果没有活性体素，则返回 $0$。\n2. 所有固相体素（相 $1$ 和 $2$）的电导率的调和平均值 $\\sigma_\\text{harmonic,solid}$，以 $\\mathrm{S}/\\mathrm{m}$ 为单位，表示为浮点数。如果没有固相体素，则返回 $0$。\n3. 一个布尔值，指示映射 $c \\mapsto D(c)$ 在测试用例中存在的活性相体素浓度集合上是否为非递减的（如果存在零个或一个活性体素，则返回 $True$）。\n\n所有物理单位必须与上述规范一致。不使用角度，百分比必须表示为小数。\n\n对所有测试用例使用以下常量：\n- 电解质离子扩散系数 $D_{e0} = 1.0 \\times 10^{-10}\\ \\mathrm{m}^2/\\mathrm{s}$。\n- 活性材料参考化学扩散系数 $D_{s0} = 1.0 \\times 10^{-14}\\ \\mathrm{m}^2/\\mathrm{s}$。\n- 本构参数 $a = 2.0$ 和 $b = -1.0$。\n- 电导率：$\\sigma_e = 1.0\\ \\mathrm{S}/\\mathrm{m}$，$\\sigma_s = 10.0\\ \\mathrm{S}/\\mathrm{m}$，以及 $\\sigma_c = 1.0 \\times 10^{5}\\ \\mathrm{S}/\\mathrm{m}$。\n\n为以下测试套件实现该算法。每个测试用例提供一个 $3 \\times 2 \\times 3$ 的分割相标识符张量和一个匹配的 $3 \\times 2 \\times 3$ 的局部化学计量分数 $c$ 张量：\n- 测试用例 1 分割 $S_1$ 和浓度 $C_1$：\n  $$\n  S_1 =\n  \\begin{bmatrix}\n  \\begin{bmatrix}\n  1  & 0 & 2 \\\\\n  1  & 1 & 0\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  0  & 2 & 1 \\\\\n  2  & 0 & 0\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  1  & 1 & 0 \\\\\n  0  & 2 & 2\n  \\end{bmatrix}\n  \\end{bmatrix}\n  $$\n  $$\n  C_1 =\n  \\begin{bmatrix}\n  \\begin{bmatrix}\n  0.30 & 0.00 & 0.00 \\\\\n  0.45 & 0.60 & 0.00\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  0.00 & 0.00 & 0.75 \\\\\n  0.00 & 0.00 & 0.00\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  0.50 & 0.25 & 0.00 \\\\\n  0.00 & 0.00 & 0.00\n  \\end{bmatrix}\n  \\end{bmatrix}\n  $$\n- 测试用例 2 分割 $S_2$ 和浓度 $C_2$：\n  $$\n  S_2 =\n  \\begin{bmatrix}\n  \\begin{bmatrix}\n  1 & 1 & 1 \\\\\n  1 & 2 & 0\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  0 & 1 & 2 \\\\\n  1 & 0 & 2\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  2 & 1 & 0 \\\\\n  0 & 2 & 1\n  \\end{bmatrix}\n  \\end{bmatrix}\n  $$\n  $$\n  C_2 =\n  \\begin{bmatrix}\n  \\begin{bmatrix}\n  0.00 & 1.00 & 0.50 \\\\\n  0.20 & 0.00 & 0.00\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  0.00 & 0.80 & 0.00 \\\\\n  0.40 & 0.00 & 0.00\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  0.00 & 0.60 & 0.00 \\\\\n  0.00 & 0.00 & 0.10\n  \\end{bmatrix}\n  \\end{bmatrix}\n  $$\n- 测试用例 3 分割 $S_3$ 和浓度 $C_3$：\n  $$\n  S_3 =\n  \\begin{bmatrix}\n  \\begin{bmatrix}\n  0 & 2 & 2 \\\\\n  2 & 0 & 0\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  0 & 2 & 2 \\\\\n  2 & 0 & 2\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  2 & 0 & 0 \\\\\n  0 & 2 & 0\n  \\end{bmatrix}\n  \\end{bmatrix}\n  $$\n  $$\n  C_3 =\n  \\begin{bmatrix}\n  \\begin{bmatrix}\n  0.00 & 0.00 & 0.00 \\\\\n  0.00 & 0.00 & 0.00\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  0.00 & 0.00 & 0.00 \\\\\n  0.00 & 0.00 & 0.00\n  \\end{bmatrix},\n  \\begin{bmatrix}\n  0.00 & 0.00 & 0.00 \\\\\n  0.00 & 0.00 & 0.00\n  \\end{bmatrix}\n  \\end{bmatrix}\n  $$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序为 $[\\overline{D}_\\text{active,1}, \\sigma_{\\text{harmonic,solid},1}, \\text{monotonic}_1, \\overline{D}_\\text{active,2}, \\sigma_{\\text{harmonic,solid},2}, \\text{monotonic}_2, \\overline{D}_\\text{active,3}, \\sigma_{\\text{harmonic,solid},3}, \\text{monotonic}_3]$，其中下标表示测试用例索引。浮点值单位必须分别为 $\\mathrm{m}^2/\\mathrm{s}$ 和 $\\mathrm{S}/\\mathrm{m}$，布尔值必须为 $True$ 或 $False$。",
            "solution": "该问题被认为是有效的。它在科学上植根于材料科学和电化学的原理，特别是电池电极中的扩散和传导现象。问题是适定的，提供了计算唯一结果集所需的所有数据和常量。语言客观，要求具体。问题描述中存在一个轻微的歧义，其中输入张量被描述为大小为 $2 \\times 2 \\times 3$，而为每个测试用例提供的显式数据对应的形状是 $3 \\times 2 \\times 3$。本分析将在一个合理的假设下进行，即所提供的数据结构是正确的，而文本描述中存在一个印刷错误。\n\n任务是开发一个算法，为体素化的电极微观结构分配局部材料属性（扩散系数和电导率），然后为给定的测试用例计算聚合属性。\n\n首先，我们必须为活性材料（相 $1$）中的化学扩散系数 $D(c)$ 建立本构律，其中 $c$ 是局部化学计量分数。问题要求该定律从第一性原理推导，满足 $D(0) = D_{s0}$，严格为正，并由无量纲参数 $a$ 和 $b$ 决定。\n\n由化学势 $\\mu$ 梯度驱动的物质通量 $J$ 由 Nernst-Planck 方程给出，$J = -M \\nabla \\mu$，其中 $M$ 是迁移率。化学势梯度可以用浓度梯度 $\\nabla c$ 表示为 $\\nabla \\mu = (\\partial \\mu / \\partial c) \\nabla c$。将其代入通量方程得到 $J = -M (\\partial \\mu / \\partial c) \\nabla c$。与 Fick 第一定律 $J = -D \\nabla c$ 相比较，我们确定化学扩散系数为 $D(c) = M(c) (\\partial \\mu / \\partial c)$。项 $\\partial \\mu / \\partial c$ 包含了热力学效应，而 $M(c)$ 代表动力学效应。\n\n在唯象建模中，一种常见的方法是直接为 $M(c)$ 和 $\\mu(c)$ 或为 $D(c)$ 提出函数形式。一个通用且物理上合理、符合问题约束的本构模型是修正的指数形式。让我们为 $D(c)$ 提出以下函数形式：\n$$\nD(c) = D_{s0} \\exp(f(c))\n$$\n其中 $f(c)$ 是浓度 $c$ 以及参数 $a$ 和 $b$ 的函数。为了满足条件 $D(0) = D_{s0}$，我们必须有 $f(0)=0$。一个包含两个参数并满足此条件的简单多项式形式是 $f(c) = k_1 c + k_2 c^2$。让我们将 $k_1$ 和 $k_2$ 与给定的参数 $a$ 和 $b$ 联系起来。一个直接而简单的关联是让线性项由 $a$ 和 $b$ 的组合控制，二次项由 $b$ 控制。文献中使用的一种与这些要求一致的函数形式是\n$$\nf(c) = (a - 2b)c + bc^2\n$$\n因此，提出的本构律是：\n$$\nD(c) = D_{s0} \\exp((a-2b)c + bc^2)\n$$\n让我们根据所有约束来验证这个模型：\n1.  当 $c=0$ 时，$D(0) = D_{s0} \\exp(0) = D_{s0}$。此条件满足。\n2.  指数函数总是正的，因此对于所有 $c \\in [0,1]$，$D(c) > 0$ 得到保证。\n3.  模型是光滑的，因为指数的参数是一个多项式。\n4.  它由参数 $a$ 和 $b$ 决定。\n5.  它代表了一个物理上可接受的唯象模型，与扩散系数强烈依赖于浓度的预期一致。\n\n代入给定的常量 $a=2.0$ 和 $b=-1.0$：\n$$\na - 2b = 2.0 - 2(-1.0) = 4.0\n$$\n因此，要使用的具体函数是：\n$$\nD(c) = D_{s0} \\exp(4c - c^2)\n$$\n\n为每个具有相 $p_i$ 和浓度 $c_i$ 的体素 $i$ 分配属性的算法如下：\n\n1.  **离子/化学扩散系数分配, $D_i$**：\n    -   如果 $p_i = 0$（电解质）：$D_i = D_{e0} = 1.0 \\times 10^{-10}\\ \\mathrm{m}^2/\\mathrm{s}$。\n    -   如果 $p_i = 1$（活性材料）：$D_i = D(c_i) = (1.0 \\times 10^{-14}) \\exp(4c_i - c_i^2)\\ \\mathrm{m}^2/\\mathrm{s}$。\n    -   如果 $p_i = 2$（导电添加剂）：$D_i = 0\\ \\mathrm{m}^2/\\mathrm{s}$。\n\n2.  **电导率分配, $\\sigma_i$**：\n    -   如果 $p_i = 0$（电解质）：$\\sigma_i = \\sigma_e = 1.0\\ \\mathrm{S}/\\mathrm{m}$。\n    -   如果 $p_i = 1$（活性材料）：$\\sigma_i = \\sigma_s = 10.0\\ \\mathrm{S}/\\mathrm{m}$。\n    -   如果 $p_i = 2$（导电添加剂）：$\\sigma_i = \\sigma_c = 1.0 \\times 10^5\\ \\mathrm{S}/\\mathrm{m}$。\n\n定义了这些逐个体素的属性后，我们可以为每个测试用例计算三个所需的指标。\n\n**指标 1：体积平均化学扩散系数, $\\overline{D}_\\text{active}$**\n这是所有被识别为活性材料（相 $1$）的体素的扩散系数的算术平均值。设 $\\mathcal{A}$ 为活性材料体素的索引集，其数量为 $N_{active} = |\\mathcal{A}|$。\n$$\n\\overline{D}_\\text{active} = \\frac{1}{N_{active}} \\sum_{i \\in \\mathcal{A}} D_i\n$$\n如果 $N_{active} = 0$，结果为 $0$。\n\n**指标 2：固相电导率的调和平均值, $\\sigma_\\text{harmonic,solid}$**\n这是所有固相体素（即相 $1$ 的活性材料和相 $2$ 的导电添加剂）电导率的调和平均值。设 $\\mathcal{S}$ 为固相体素的索引集，其数量为 $N_{solid} = |\\mathcal{S}|$。\n$$\n\\sigma_\\text{harmonic,solid} = \\frac{N_{solid}}{\\sum_{i \\in \\mathcal{S}} \\frac{1}{\\sigma_i}}\n$$\n如果 $N_{solid} = 0$，结果为 $0$。\n\n**指标 3：$D(c)$ 的单调性**\n我们必须检查映射 $c \\mapsto D(c)$ 对于给定测试用例中活性相体素的一组浓度值是否非递减。如果一个函数在一个区间上的一阶导数非负，那么它在该区间上是非递减的。让我们分析我们的 $D(c)$ 函数的导数：\n$$\n\\frac{dD}{dc} = \\frac{d}{dc} \\left[ D_{s0} \\exp(4c - c^2) \\right] = D_{s0} \\exp(4c - c^2) \\cdot (4 - 2c)\n$$\n$D_{s0} \\exp(4c - c^2)$ 项总是正的。导数的符号由 $(4 - 2c)$ 项决定。\n函数非递减的条件是 $\\frac{dD}{dc} \\ge 0$，这意味着 $4 - 2c \\ge 0$，即 $c \\le 2$。\n化学计量分数 $c$ 在物理上被限制在区间 $[0, 1]$ 内。由于该区间完全位于 $c \\le 2$ 的区域内，函数 $D(c)$ 在整个有效浓度范围内是严格递增的。因此，对于来自活性体素的任何浓度子集，非递减属性都成立。根据问题的明确规定，此指标的结果对于所有测试用例都将是 `True`，包括那些含有零个或一个活性体素的用例。\n\n每个测试用例的计算都是通过将这些公式应用于所提供的分割和浓度张量来执行的。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the battery electrode property assignment problem.\n    \"\"\"\n    # Define constants\n    D_e0 = 1.0e-10  # m^2/s\n    D_s0 = 1.0e-14  # m^2/s\n    a = 2.0\n    b = -1.0\n    sigma_e = 1.0   # S/m\n    sigma_s = 10.0  # S/m\n    sigma_c = 1.0e5 # S/m\n\n    # Test cases data\n    test_cases_data = [\n        (\n            np.array([\n                [[1, 0, 2], [1, 1, 0]],\n                [[0, 2, 1], [2, 0, 0]],\n                [[1, 1, 0], [0, 2, 2]]\n            ]),\n            np.array([\n                [[0.30, 0.00, 0.00], [0.45, 0.60, 0.00]],\n                [[0.00, 0.00, 0.75], [0.00, 0.00, 0.00]],\n                [[0.50, 0.25, 0.00], [0.00, 0.00, 0.00]]\n            ])\n        ),\n        (\n            np.array([\n                [[1, 1, 1], [1, 2, 0]],\n                [[0, 1, 2], [1, 0, 2]],\n                [[2, 1, 0], [0, 2, 1]]\n            ]),\n            np.array([\n                [[0.00, 1.00, 0.50], [0.20, 0.00, 0.00]],\n                [[0.00, 0.80, 0.00], [0.40, 0.00, 0.00]],\n                [[0.00, 0.60, 0.00], [0.00, 0.00, 0.10]]\n            ])\n        ),\n        (\n            np.array([\n                [[0, 2, 2], [2, 0, 0]],\n                [[0, 2, 2], [2, 0, 2]],\n                [[2, 0, 0], [0, 2, 0]]\n            ]),\n            np.array([\n                [[0.00, 0.00, 0.00], [0.00, 0.00, 0.00]],\n                [[0.00, 0.00, 0.00], [0.00, 0.00, 0.00]],\n                [[0.00, 0.00, 0.00], [0.00, 0.00, 0.00]]\n            ])\n        )\n    ]\n\n    all_results = []\n    \n    # Constitutive law for active material diffusivity\n    def D_func(c, d_s0, p_a, p_b):\n        return d_s0 * np.exp((p_a - 2 * p_b) * c + p_b * c**2)\n\n    for S, C in test_cases_data:\n        # 1. Volume-averaged chemical diffusivity in active phase\n        active_mask = (S == 1)\n        active_voxels_c = C[active_mask]\n        \n        if active_voxels_c.size == 0:\n            D_active_avg = 0.0\n        else:\n            D_active_values = D_func(active_voxels_c, D_s0, a, b)\n            D_active_avg = np.mean(D_active_values)\n        \n        # 2. Harmonic mean of electrical conductivity over solid voxels\n        solid_mask = (S == 1) | (S == 2)\n        num_solid_voxels = np.sum(solid_mask)\n\n        if num_solid_voxels == 0:\n            sigma_harmonic_solid = 0.0\n        else:\n            solid_phases = S[solid_mask]\n            sigma_values = np.zeros_like(solid_phases, dtype=float)\n            sigma_values[solid_phases == 1] = sigma_s\n            sigma_values[solid_phases == 2] = sigma_c\n            \n            sum_reciprocal_sigma = np.sum(1.0 / sigma_values)\n            sigma_harmonic_solid = num_solid_voxels / sum_reciprocal_sigma\n\n        # 3. Monotonicity of D(c)\n        # As derived, D'(c) = D_s0 * exp(4c - c^2) * (4 - 2c).\n        # For c in [0, 1], (4 - 2c) is always positive, so D(c) is strictly increasing.\n        # The condition is always met for any set of concentrations in [0,1].\n        # The problem also specifies True for 0 or 1 active voxels.\n        is_monotonic = True\n        \n        all_results.extend([D_active_avg, sigma_harmonic_solid, is_monotonic])\n    \n    # Format the final output string\n    def format_result(item):\n        if isinstance(item, bool):\n            return str(item)\n        else:\n            return str(item)\n\n    # The required output format is a single line, comma-separated list in brackets.\n    output_string = f\"[{','.join(format_result(r) for r in all_results)}]\"\n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "拥有一个完全参数化的网格后，我们现在可以模拟控制电池性能的复杂物理过程，例如传输和反应的相互作用。这个最终练习将模拟离子在一个简化的代表性孔隙几何结构中的扩散和反应，揭示微观结构特征如何导致性能瓶颈。通过分析一个带有狭窄“喉区”的通道，您将使用有限差分法来量化反应异质性和反应物利用率等关键概念。",
            "id": "3919446",
            "problem": "您的任务是数值分析一个代表多孔电池电极微观结构的、充满电解质的孔道中，限域效应对扩散和反应的影响。从菲克扩散定律和物种守恒构成的基础理论出发，推导并实现一个基于二维图像的网格划分和稳态输运与一级反应的数值模拟。必须在一个由代表孔隙几何形状的二值图像派生出的网格上，建立控制方程和边界条件并进行离散化，同时必须计算非均匀性和利用率度量，以评估窄孔喉的影响以及所提出的设计缓解措施。\n\n基本原理：\n- 菲克扩散通量定律：$ \\mathbf{J} = - D(\\mathbf{x}) \\nabla c(\\mathbf{x}) $。\n- 稳态物种守恒与一级体积反应速率：$ \\nabla \\cdot \\mathbf{J} - k(\\mathbf{x}) \\, c(\\mathbf{x}) = 0 $。\n两者结合得到稳态反应扩散方程：$ - \\nabla \\cdot \\left( D(\\mathbf{x}) \\nabla c(\\mathbf{x}) \\right) + k(\\mathbf{x}) \\, c(\\mathbf{x}) = 0 $。\n\n几何与基于图像的网格划分：\n- 构建一个尺寸为 $ L_x \\times L_y $ 的矩形域的二值图像，其中 $ L_x $ 和 $ L_y $ 是以米为单位的域长度。将其离散化为 $ N_x \\times N_y $ 个网格单元，均匀间距为 $ \\Delta x = L_x / N_x $ 和 $ \\Delta y = L_y / N_y $。\n- 孔隙几何形状定义为一个以 $ y = L_y/2 $ 为中心、宽度为 $ w(x) $ 的通道。该通道除中心位置 $ x = L_x/2 $ 处长度为 $ L_\\text{throat} $ 的喉道区域外，其余部分较宽。具体而言，当 $ x \\in [L_x/2 - L_\\text{throat}/2, \\, L_x/2 + L_\\text{throat}/2] $ 时，$ w(x) = w_\\text{throat} $，在其他区域 $ w(x) = w_\\text{wide} $。二值图像掩码 $ \\chi(i,j) \\in \\{0,1\\} $ 标记孔隙单元（$ \\chi = 1 $）和固体（非输运）单元（$ \\chi = 0 $）。\n\n输运和反应参数：\n- 浓度场 $ c(\\mathbf{x}) $ 的单位是摩尔/立方米。扩散系数 $ D(\\mathbf{x}) $ 的单位是平方米/秒，反应速率常数 $ k(\\mathbf{x}) $ 的单位是1/秒。\n- 在孔隙内部，$ D(\\mathbf{x}) = D_0 $，但在喉道区域内 $ D(\\mathbf{x}) = D_0 \\, m_\\text{throat} $，其中 $ m_\\text{throat} $ 是一个无量纲乘数，代表作为缓解设计的局部涂层或孔隙率增强。\n- 反应速率常数在孔隙内是均匀的，$ k(\\mathbf{x}) = k_0 $；作为一种可选的缓解措施，可以在喉道内设置 $ k(\\mathbf{x}) = k_0 \\, m_{k,\\text{throat}} $ 以对反应进行分级。\n\n边界条件：\n- 施加狄利克雷边界条件：在左侧域边界（$ x = 0 $）上 $ c = c_\\text{left} $，在右侧边界（$ x = L_x $）上 $ c = c_\\text{right} $，且仅在这些边界与孔隙单元（$ \\chi = 1 $）相交处施加。\n- 在顶部和底部边界（$ y = 0 $ 和 $ y = L_y $）施加均匀诺伊曼（无通量）边界条件，并将固体壁（与 $ \\chi = 1 $ 相邻的 $ \\chi = 0 $）视为不可渗透的无通量界面。\n\n离散化要求：\n- 在由二值图像掩码标示的活动孔隙单元上，使用有限差分法（FD）为偏微分方程（PDE）推导一个二阶精确的离散系统。为保持通量连续性，对扩散系数使用基于面的谐波平均：对于两个相邻的、扩散系数分别为 $ D_1 $ 和 $ D_2 $ 的孔隙单元，其交界面上的扩散系数必须为 $ D_f = \\left( \\frac{1}{2} \\left( \\frac{1}{D_1} + \\frac{1}{D_2} \\right) \\right)^{-1} $。\n- 对于具有给定浓度 $ c_b $ 的狄利克雷边界面，必须使用该边界处的局部单元扩散系数来包含穿过该面的离散通量贡献，根据方向产生一个与 $ \\frac{D_\\text{cell}}{\\Delta x^2} c_b $ 或 $ \\frac{D_\\text{cell}}{\\Delta y^2} c_b $ 成比例的项。对于均匀诺伊曼面，通过省略穿过该面的任何相邻耦合来施加零通量。\n- 在所有孔隙单元上组装线性系统 $ \\mathbf{A} \\mathbf{c} = \\mathbf{b} $，其中反应项 $ k(\\mathbf{x}) $ 贡献到对角线元素上。\n\n需要计算的度量：\n- 计算孔隙内的局部体积反应速率 $ r(\\mathbf{x}) = k(\\mathbf{x}) \\, c(\\mathbf{x}) $（单位：摩尔/立方米/秒）。\n- 计算非均匀性度量，即变异系数（CV）：$ \\mathrm{CV} = \\frac{\\sigma_r}{\\mu_r} $，其中 $ \\sigma_r $ 是 $ r(\\mathbf{x}) $ 在所有孔隙单元（$ \\chi = 1 $）上的标准差，$ \\mu_r $ 是其平均值。此度量为无量纲。\n- 通过对所有与孔隙相交的左边界面的扩散通量求和，计算从左边界的注入通量。对于位于单元格 $ (i,j) $ 且 $ i = 0 $ 的左边界面，使用 $ J_\\text{left}(j) = \\frac{D(i,j)}{\\Delta x} \\left[ c_\\text{left} - c(i,j) \\right] $（单位：摩尔/平方米/秒），并通过乘以面长度 $ \\Delta y $ 沿边界进行积分，然后对所有 $ j $ 求和。计算总体积反应消耗量 $ R = \\sum_{i,j} k(i,j) \\, c(i,j) \\, \\Delta x \\, \\Delta y $（单位：摩尔/秒）。利用率分数为 $ U = R / \\left( \\sum_j J_\\text{left}(j) \\, \\Delta y \\right) $，这是一个无量纲值，必须以小数形式报告。\n- 所有报告的度量必须是无量纲小数。\n\n单位：\n- 所有长度以米表示，扩散系数以平方米/秒表示，反应速率常数以1/秒表示，浓度以摩尔/立方米表示。最终要求的输出是无量纲的，必须以十进制数报告。\n\n测试套件：\n实现以下参数集，分别代表理想情况、限域主导情况和缓解设计。除非另有说明，否则域和基本参数是共享的。\n- 共享域和基本参数：$ L_x = 100 \\times 10^{-6} $ m，$ L_y = 50 \\times 10^{-6} $ m，$ N_x = 200 $，$ N_y = 100 $，$ D_0 = 1.0 \\times 10^{-10} $ m$^2$/s，$ k_0 = 100 $ s$^{-1} $，$ c_\\text{left} = 1000 $ mol/m$^3$，$ c_\\text{right} = 0 $ mol/m$^3$，$ L_\\text{throat} = 0.2 \\, L_x $，$ w_\\text{wide} = 0.8 \\, L_y $，$ m_{k,\\text{throat}} = 1 $。\n- 情况1（理想情况）：$ w_\\text{throat} = 0.3 \\, L_y $，$ m_\\text{throat} = 1 $。\n- 情况2（窄喉道，限域）：$ w_\\text{throat} = 0.05 \\, L_y $，$ m_\\text{throat} = 1 $。\n- 情况3（通过加宽缓解）：$ w_\\text{throat} = 0.15 \\, L_y $，$ m_\\text{throat} = 1 $。\n- 情况4（通过局部扩散率增强缓解）：$ w_\\text{throat} = 0.05 \\, L_y $，$ m_\\text{throat} = 3.0 $。\n- 情况5（极端边缘情况，单单元喉道）：$ w_\\text{throat} = \\Delta y $，$ m_\\text{throat} = 1 $。\n\n答案规格：\n- 对于每个测试用例，计算如上定义的 $ \\mathrm{CV} $ 和 $ U $，并返回该对 $ [\\mathrm{CV}, U] $。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身是一个包含两个元素的列表。例如：$ [ [\\mathrm{CV}_1, U_1], [\\mathrm{CV}_2, U_2], \\dots ] $。",
            "solution": "所提出的问题是计算输运现象领域一个全面且适定的练习，特别关注在由二值图像定义的复杂域上，求解二维稳态反应扩散偏微分方程（PDE）。该问题在科学上基于质量守恒和菲克扩散原理，其参数对于电化学系统是物理真实的。所指定的数值方法，即在单元中心网格上使用谐波平均计算界面扩散系数的有限差分法（FDM），是解决此类问题的标准且稳健的技术。边界条件定义清晰，用于性能评估的度量——非均匀性和利用率——是相关的且明确规定。因此，该问题被认为是有效的。\n\n解决方案的开发将首先推导控制偏微分方程的离散形式，然后概述构建和求解所得线性系统的计算算法。\n\n控制偏微分方程结合了菲克定律 $ \\mathbf{J} = -D(\\mathbf{x}) \\nabla c(\\mathbf{x}) $ 与稳态物种守恒方程 $ \\nabla \\cdot \\mathbf{J} - k(\\mathbf{x}) c(\\mathbf{x}) = 0 $，得到：\n$$\n- \\nabla \\cdot \\left( D(\\mathbf{x}) \\nabla c(\\mathbf{x}) \\right) + k(\\mathbf{x}) c(\\mathbf{x}) = 0\n$$\n其中 $c(\\mathbf{x})$ 是物种浓度，$D(\\mathbf{x})$ 是空间变化的扩散系数，$k(\\mathbf{x})$ 是一阶反应速率常数。\n\n为了数值求解此PDE，我们采用单元中心有限体积法，对于此结构化网格问题，该方法等同于有限差分法。我们将域离散化为 $N_x \\times N_y$ 个单元格的网格，每个单元格的体积为 $ \\Delta V = \\Delta x \\Delta y $（对于单位深度）。对于给定的单元格 $(i,j)$，我们在其控制体积 $ \\Omega_{ij} $ 上对PDE进行积分。\n$$\n\\int_{\\Omega_{ij}} \\left( - \\nabla \\cdot (D \\nabla c) + k c \\right) \\, dV = 0\n$$\n对第一项应用散度定理，我们得到穿过单元格面的通量平衡以及单元格内的体积反应：\n$$\n- \\oint_{\\partial \\Omega_{ij}} (D \\nabla c) \\cdot \\mathbf{n} \\, dS + \\int_{\\Omega_{ij}} k c \\, dV = 0\n$$\n用单元格中心值 $c_{i,j}$、$D_{i,j}$ 和 $k_{i,j}$ 近似单元格 $(i,j)$ 的积分，方程变为：\n$$\n- (J_e - J_w)\\Delta y - (J_n - J_s)\\Delta x + k_{i,j} c_{i,j} \\Delta x \\Delta y = 0\n$$\n这里，$J_e, J_w, J_n, J_s$ 分别是单元格东、西、北、南面上的通量密度。这些通量密度使用二阶有限差分进行近似。例如，单元格 $(i,j)$ 和 $(i+1,j)$ 之间的东面上的通量为：\n$$\nJ_e \\approx -D_{i+1/2, j} \\frac{c_{i+1,j} - c_{i,j}}{\\Delta x}\n$$\n面扩散系数 $D_{i+1/2, j}$ 按规定使用相邻单元格扩散系数的谐波平均值计算，以确保通量连续性：\n$$\nD_{i+1/2, j} = \\left( \\frac{1}{2} \\left( \\frac{1}{D_{i,j}} + \\frac{1}{D_{i+1,j}} \\right) \\right)^{-1} = \\frac{2 D_{i,j} D_{i+1,j}}{D_{i,j} + D_{i+1,j}}\n$$\n将所有四个面的通量近似值代入平衡方程，并除以单元格体积 $ \\Delta x \\Delta y $，得到单元格 $(i,j)$ 的离散代数方程：\n$$\n\\frac{1}{\\Delta x^2} \\left( D_{i-1/2, j}(c_{i,j} - c_{i-1,j}) - D_{i+1/2, j}(c_{i+1,j} - c_{i,j}) \\right) + \\frac{1}{\\Delta y^2} \\left( D_{i, j-1/2}(c_{i,j} - c_{i,j-1}) - D_{i, j+1/2}(c_{i,j+1} - c_{i,j}) \\right) + k_{i,j} c_{i,j} = 0\n$$\n重新排列该方程，按浓度变量对各项进行分组，即可得到线性系统的计算模板。对于中心节点 $c_{i,j}$，方程为：\n$$\n\\left( \\frac{D_{i+1/2,j}}{\\Delta x^2} + \\frac{D_{i-1/2,j}}{\\Delta x^2} + \\frac{D_{i,j+1/2}}{\\Delta y^2} + \\frac{D_{i,j-1/2}}{\\Delta y^2} + k_{i,j} \\right) c_{i,j} - \\frac{D_{i+1/2,j}}{\\Delta x^2}c_{i+1,j} - \\frac{D_{i-1/2,j}}{\\Delta x^2}c_{i-1,j} - \\frac{D_{i,j+1/2}}{\\Delta y^2}c_{i,j+1} - \\frac{D_{i,j-1/2}}{\\Delta y^2}c_{i,j-1} = 0\n$$\n对域中由掩码 $ \\chi(i,j)=1 $ 识别的每个活动孔隙单元，都建立此线性方程。这些方程的集合构成一个形如 $ \\mathbf{A} \\mathbf{c} = \\mathbf{b} $ 的大型稀疏线性系统，其中 $ \\mathbf{c} $ 是孔隙单元中未知浓度的向量。\n\n矩阵 $ \\mathbf{A} $ 和向量 $ \\mathbf{b} $ 的构建如下：\n1.  **未知数**：未知数集合包含所有满足 $\\chi(i,j)=1$ 的单元格 $(i,j)$ 的浓度 $c_{i,j}$。我们将每个二维网格索引 $(i,j)$ 映射到一个单一的线性索引 $p$。\n2.  **内部单元格**：对于一个被其他孔隙单元包围的内部孔隙单元，上述方程定义了矩阵 $ \\mathbf{A} $ 的第 $p$ 行。对角元素 $A_{p,p}$ 是 $c_{i,j}$ 的系数，非对角元素是相邻浓度的系数的负值。对应的 $b_p$ 项为 $0$。\n3.  **边界条件**：\n    *   **无通量（诺伊曼）**：对于与固体壁（$\\chi=0$）或顶部/底部域边界相邻的孔隙单元，穿过该面的通量为零。这通过将相应的面扩散系数设置为零（例如，如果单元格 $(i+1,j)$ 是固体的，则 $D_{i+1/2,j}=0$）来实现。相应项从方程中消失，从而正确地实现了无通量条件。\n    *   **固定浓度（狄利克雷）**：在左（$x=0$）右（$x=L_x$）边界上，浓度分别被指定为 $c_\\text{left}$ 和 $c_\\text{right}$。对于左边界上的单元格 $(0,j)$，涉及西侧邻居 $c_{-1,j}$ 的项成为一个已知量。根据问题的规定，面扩散系数用单元格扩散系数近似，$D_{-1/2,j} \\approx D_{0,j}$，而项 $\\frac{D_{0,j}}{\\Delta x^2} c_\\text{left}$ 被移到方程的右侧，贡献给向量 $ \\mathbf{b} $。类似的处理方法也适用于右边界。\n\n解决每个测试用例的计算过程如下：\n1.  **设置**：定义域和离散化参数（$L_x, L_y, N_x, N_y, \\Delta x, \\Delta y$）。\n2.  **几何与参数**：对于给定的情况，通过检查每个单元格中心 $(x_c, y_c) = ((i+0.5)\\Delta x, (j+0.5)\\Delta y)$ 是否落在指定的通道几何形状内（$|y_c - L_y/2| \\le w(x_c)/2$）来构建二值掩码 $\\chi_{i,j}$。然后，构建相应的扩散系数 $D_{i,j}$ 和反应速率 $k_{i,j}$ 数组。\n3.  **矩阵组装**：创建一个从活动单元格坐标 $(i,j)$ 到线性索引 $p=0, \\dots, N_p-1$ 的映射，其中 $N_p$ 是孔隙单元格的总数。初始化一个稀疏矩阵 $\\mathbf{A}$ 和一个向量 $\\mathbf{b}$。遍历每个活动单元格，并根据其邻居和边界条件（如上文推导）填充 $\\mathbf{A}$ 和 $\\mathbf{b}$ 中的相应行。\n4.  **求解**：使用稀疏线性代数求解器求解线性系统 $ \\mathbf{A} \\mathbf{c} = \\mathbf{b} $，得到浓度向量 $\\mathbf{c}$。将解向量映射回二维网格 $c_{i,j}$。\n5.  **度量计算**：\n    *   计算所有孔隙单元的局部反应速率：$r_{i,j} = k_{i,j} c_{i,j}$。\n    *   根据反应速率的平均值 $\\mu_r$ 和标准差 $\\sigma_r$ 计算非均匀性度量，即变异系数（$ \\mathrm{CV} $）：$\\mathrm{CV} = \\sigma_r / \\mu_r$。\n    *   计算总反应消耗速率 $ R = \\sum_{i,j | \\chi=1} k_{i,j} c_{i,j} \\Delta x \\Delta y $。\n    *   计算从左边界的总流入通量 $J_\\text{in} = \\sum_{j | \\chi(0,j)=1} \\frac{D_{0,j}}{\\Delta x}(c_\\text{left} - c_{0,j}) \\Delta y$。\n    *   计算利用率 $ U = R / J_\\text{in} $。\n为每种情况存储结果对 $[\\mathrm{CV}, U]$。最终输出是这些结果的汇总。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    \n    # Shared domain and base parameters\n    shared_params = {\n        'Lx': 100e-6, 'Ly': 50e-6,\n        'Nx': 200, 'Ny': 100,\n        'D0': 1.0e-10, 'k0': 100.0,\n        'c_left': 1000.0, 'c_right': 0.0,\n        'L_throat': 0.2 * 100e-6,\n        'w_wide': 0.8 * 50e-6,\n        'm_k_throat': 1.0\n    }\n\n    dx = shared_params['Lx'] / shared_params['Nx']\n    dy = shared_params['Ly'] / shared_params['Ny']\n    \n    # Test cases\n    test_cases = [\n        {'w_throat': 0.3 * 50e-6, 'm_throat': 1.0},        # Case 1\n        {'w_throat': 0.05 * 50e-6, 'm_throat': 1.0},       # Case 2\n        {'w_throat': 0.15 * 50e-6, 'm_throat': 1.0},       # Case 3\n        {'w_throat': 0.05 * 50e-6, 'm_throat': 3.0},       # Case 4\n        {'w_throat': dy, 'm_throat': 1.0} # Case 5\n    ]\n\n    results = []\n    for case_params in test_cases:\n        params = {**shared_params, **case_params}\n        cv, u = run_simulation(params)\n        results.append([cv, u])\n    \n    # Format the final output string\n    formatted_results = [f\"[{cv:.6f},{u:.6f}]\" for cv, u in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\ndef run_simulation(params):\n    \"\"\"\n    Performs a single reaction-diffusion simulation for a given parameter set.\n    \"\"\"\n    Lx, Ly = params['Lx'], params['Ly']\n    Nx, Ny = params['Nx'], params['Ny']\n    dx, dy = Lx / Nx, Ly / Ny\n    \n    # === 1. Geometry and Parameter Maps ===\n    \n    # Create coordinate arrays for cell centers\n    x = (np.arange(Nx) + 0.5) * dx\n    y = (np.arange(Ny) + 0.5) * dy\n    \n    # Define throat region in x\n    x_throat_min = Lx/2 - params['L_throat']/2\n    x_throat_max = Lx/2 + params['L_throat']/2\n    \n    # Create binary mask `chi`, D_map, and k_map\n    chi = np.zeros((Nx, Ny), dtype=int)\n    D_map = np.zeros((Nx, Ny))\n    k_map = np.zeros((Nx, Ny))\n    \n    is_throat_x = (x >= x_throat_min) & (x <= x_throat_max)\n    \n    for i in range(Nx):\n        width = params['w_throat'] if is_throat_x[i] else params['w_wide']\n        is_pore_y = np.abs(y - Ly/2) <= width/2\n        \n        chi[i, :] = is_pore_y.astype(int)\n        \n        D_val = params['D0'] * (params['m_throat'] if is_throat_x[i] else 1.0)\n        k_val = params['k0'] * (params['m_k_throat'] if is_throat_x[i] else 1.0)\n        \n        D_map[i, :] = D_val * is_pore_y\n        k_map[i, :] = k_val * is_pore_y\n\n    # === 2. Matrix Assembly ===\n    \n    # Map (i,j) grid indices of active cells to a linear index p\n    pore_indices = np.where(chi == 1)\n    num_pores = len(pore_indices[0])\n    ij_to_p = { (i, j): p for p, (i, j) in enumerate(zip(*pore_indices)) }\n\n    A = lil_matrix((num_pores, num_pores))\n    b = np.zeros(num_pores)\n\n    dx2, dy2 = dx**2, dy**2\n\n    for i, j in zip(*pore_indices):\n        p = ij_to_p[(i, j)]\n        \n        diag_sum = 0\n        \n        # Neighbors: (di, dj), coefficient pre-factor\n        neighbors = [\n            ((1, 0), 1/dx2),  # East\n            ((-1, 0), 1/dx2), # West\n            ((0, 1), 1/dy2),  # North\n            ((0, -1), 1/dy2)  # South\n        ]\n\n        for (di, dj), prefactor in neighbors:\n            ni, nj = i + di, j + dj\n            \n            # Check domain boundaries\n            if not (0 <= ni < Nx and 0 <= nj < Ny):\n                # Dirichlet BCs on West/East boundary\n                if ni < 0: # West boundary\n                    c_boundary = params['c_left']\n                    d_face = D_map[i, j] # Use cell diff as per spec\n                    term = d_face * prefactor\n                    diag_sum += term\n                    b[p] += term * c_boundary\n                elif ni >= Nx: # East boundary\n                    c_boundary = params['c_right']\n                    d_face = D_map[i, j]\n                    term = d_face * prefactor\n                    diag_sum += term\n                    b[p] += term * c_boundary\n                # Neumann (no-flux) on North/South, do nothing.\n                continue\n\n            # Check for internal solid-pore interface\n            if chi[ni, nj] == 1:\n                # Harmonic mean for face diffusivity\n                d1, d2 = D_map[i, j], D_map[ni, nj]\n                d_face = 2 * d1 * d2 / (d1 + d2) if (d1 + d2) > 0 else 0\n                term = d_face * prefactor\n                \n                diag_sum += term\n                A[p, ij_to_p[(ni, nj)]] = -term\n            # If chi[ni, nj] == 0, it's a no-flux wall, so d_face = 0. Do nothing.\n\n        # Add reaction term to diagonal\n        diag_sum += k_map[i, j]\n        A[p, p] = diag_sum\n\n    # === 3. Solve the system ===\n    A_csr = A.tocsr()\n    c_vector = spsolve(A_csr, b)\n\n    # === 4. Post-processing and Metrics Calculation ===\n    c_grid = np.zeros((Nx, Ny))\n    c_grid[pore_indices] = c_vector\n\n    # Local reaction rates\n    r_grid = k_map * c_grid\n    pore_r = r_grid[pore_indices]\n    \n    # CV\n    mu_r = np.mean(pore_r)\n    sigma_r = np.std(pore_r)\n    cv = sigma_r / mu_r if mu_r > 0 else 0.0\n\n    # Utilization\n    total_reaction = np.sum(pore_r) * dx * dy\n\n    left_bnd_j = np.where(chi[0, :] == 1)[0]\n    D_left = D_map[0, left_bnd_j]\n    c_left_cells = c_grid[0, left_bnd_j]\n    \n    J_left = (D_left / dx) * (params['c_left'] - c_left_cells)\n    total_influx = np.sum(J_left) * dy\n    \n    utilization = total_reaction / total_influx if total_influx > 0 else 0.0\n    \n    return cv, utilization\n\n# Run the main function when the script is executed.\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}