{
    "hands_on_practices": [
        {
            "introduction": "在网络物理系统中，一个常见的假设是控制器可以完全信任其传感器读数来进行关键决策。本实践练习旨在挑战这一假设，通过构建一个反例，展示即使一个微小且有针对性的传感器测量偏差，也足以欺骗一个朴素的模型预测控制器（MPC），最终导致系统违反热安全约束。通过亲手实现这个反例并设计一个修正后的鲁棒控制器，您将深刻理解为何在预测模型中依赖指令信号而非易受攻击的传感器反馈，是确保系统安全的关键原则 。",
            "id": "3903073",
            "problem": "考虑一个电池模组的单集总参数热模型，该模型受到充电电流的影响，其动态特性源自能量守恒和牛顿冷却定律。热能平衡模型如下。令 $T(t)$ 表示整体温度（单位：开尔文），$I(t)$ 表示充电电流（单位：安培），$R$ 表示等效内阻（单位：欧姆），$h$ 表示有效传热系数（单位：瓦特/开尔文），$C_{\\mathrm{th}}$ 表示集总热容（单位：焦耳/开尔文），$T_{\\mathrm{amb}}$ 表示环境温度（单位：开尔文）。连续时间能量平衡方程为\n$$\nC_{\\mathrm{th}} \\frac{dT}{dt} = I(t)^2 R - h \\left( T(t) - T_{\\mathrm{amb}} \\right).\n$$\n假设采用时间步长为 $dt$ 秒的前向欧拉时间离散化，则离散时间更新方程为\n$$\nT_{k+1} = T_k + \\frac{dt}{C_{\\mathrm{th}}}\\left( I_k^2 R - h \\left( T_k - T_{\\mathrm{amb}} \\right) \\right),\n$$\n其中 $T_k$ 是离散时间索引 $k$ 处的温度，$I_k$ 是施加的电流（单位：安培）。\n\n一次传感器攻击引入了带偏差的电流测量。测量电流建模为\n$$\nI_m = I + b,\n$$\n其中 $I$ 是真实电流，$b$ 是一个偏差（单位：安培），在整个预测时域内为常数。当 $b  0$ 时，代表一次目标性低报攻击。\n\n假设一个朴素模型预测控制 (Model Predictive Control (MPC)) 方案在一个 $N$ 步的有限时域内选择一个恒定充电电流 $I$，以在满足一个估计的热安全约束（即预测温度保持在安全上限 $T_{\\max}$ 开尔文以下）的前提下最大化该电流。该朴素方案依赖于名义测量值，在预测模型中用 $I_m$ 替代 $I$，这隐式地假设了 $b=0$。也就是说，对于候选的恒定电流 $I$，它使用 $I_m = I + b$ 而非真实的 $I$ 来预测温度，并接受能使预测温度保持在约束范围内的最大候选电流。\n\n构造一个反例，证明在电流测量中存在一个虽小但有针对性的负偏差 $b$ 的情况下，即使预测的温度看起来是安全的，这种朴素 MPC 也可能违反真实的热约束。接着，实现一个修正后的设计来消除这种违规。修正后的控制器必须在预测中使用真实的指令电流 $I$（而不是带有偏差的测量值 $I_m$）来评估热约束，并选择一个最大的恒定电流 $I$，使得预测温度在整个时域内都保持在 $T_{\\max}$ 以下。\n\n您的程序必须：\n- 实现离散时间热模型，并模拟在 $N$ 个步骤内恒定电流 $I$ 下的温度轨迹。\n- 实现朴素控制器，该控制器通过在模型中使用 $I_m = \\max(I+b,0)$ 进行预测来选择 $I$。\n- 实现修正后的控制器，该控制器通过在模型中使用真实的指令电流 $I$ 进行预测来选择 $I$。\n- 对于下面的每个测试用例，报告朴素控制器和修正后控制器在整个时域内的最大真实温度（均以开尔文为单位，四舍五入到两位小数）。同时，报告每个控制器真实温度相对于 $T_{\\max}$ 的约束违规布尔指标。\n\n所有角度（如果涉及）都必须以弧度为单位，但此问题不涉及角度。所有物理单位均采用国际单位制 (SI)。最终输出格式必须是单行文本，其中包含所有测试用例的结果，结果是一个用方括号括起来的逗号分隔列表，每个测试用例的结果列表格式为\n$$\n[\\text{max\\_T\\_naive},\\, \\text{max\\_T\\_corrected},\\, \\text{naive\\_violated},\\, \\text{corrected\\_violated}],\n$$\n其中温度以开尔文为单位，布尔值表示是否违规。\n\n测试套件参数集：\n- 情况 A (理想路径，无偏差)：$C_{\\mathrm{th}} = 600\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 1.5\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_0 = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，$dt = 1\\,\\mathrm{s}$，$N = 1200$，$I_{\\max} = 50\\,\\mathrm{A}$，网格步长 $\\Delta I = 0.5\\,\\mathrm{A}$，$b = 0\\,\\mathrm{A}$。\n- 情况 B (反例，目标性小偏差)：$C_{\\mathrm{th}} = 600\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 1.5\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_0 = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，$dt = 1\\,\\mathrm{s}$，$N = 1200$，$I_{\\max} = 50\\,\\mathrm{A}$，网格步长 $\\Delta I = 0.5\\,\\mathrm{A}$，$b = -1.0\\,\\mathrm{A}$。\n- 情况 C (接近阈值的边界偏差)：$C_{\\mathrm{th}} = 600\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 1.5\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_0 = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，$dt = 1\\,\\mathrm{s}$，$N = 1200$，$I_{\\max} = 50\\,\\mathrm{A}$，网格步长 $\\Delta I = 0.5\\,\\mathrm{A}$，$b = -0.5\\,\\mathrm{A}$。\n- 情况 D (高热容和高散热的边缘情况)：$C_{\\mathrm{th}} = 2000\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 4.0\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_0 = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，$dt = 1\\,\\mathrm{s}$，$N = 1200$，$I_{\\max} = 50\\,\\mathrm{A}$，网格步长 $\\Delta I = 0.5\\,\\mathrm{A}$，$b = -1.0\\,\\mathrm{A}$。\n\n实现说明：\n- 控制器从网格 $\\{0, \\Delta I, 2\\Delta I, \\ldots, I_{\\max}\\}$ 中选择最大的恒定电流 $I$，要求其预测的温度序列永远不超过 $T_{\\max}$。朴素预测在发热项中使用 $I_m = \\max(I+b,0)$，而修正后的预测在发热项中使用指令电流 $I$。\n- 真实温度的演变总是使用指令电流 $I$ 进行模拟（假设执行器未受影响），并将最大真实温度与 $T_{\\max}$ 进行比较以计算违规布尔值。\n- 最大温度以开尔文表示，四舍五入到两位小数。布尔值必须是精确的逻辑值。\n\n您的程序应生成单行输出，其中包含按 A、B、C、D 确切顺序排列的测试用例结果，格式为用方括号括起来的逗号分隔列表。例如，输出应如下所示\n$$\n[[300.00,300.00,\\text{False},\\text{False}],[\\dots],[\\dots],[\\dots]]\n$$\n但使用每个情况的实际数值。",
            "solution": "该问题要求对用于管理电池热状态的朴素与修正后的模型预测控制 (MPC) 策略进行批判性比较。问题的核心是展示一个安全漏洞：传感器测量中的一个微小恶意偏差可导致朴素控制器违反安全约束。同时，问题要求实现一个能够减轻此漏洞影响的鲁棒控制器。\n\n该物理系统是一个由单集总参数热模型描述的电池模组。其能量平衡由以下微分方程给出：\n$$\nC_{\\mathrm{th}} \\frac{dT}{dt} = I(t)^2 R - h \\left( T(t) - T_{\\mathrm{amb}} \\right)\n$$\n其中 $T(t)$ 是温度，$I(t)$ 是电流，$C_{\\mathrm{th}}$ 是热容，$R$ 是内阻，$h$ 是传热系数，$T_{\\mathrm{amb}}$ 是环境温度。\n\n采用时间步长为 $dt$ 的前向欧拉离散化，离散时间温度更新规则为：\n$$\nT_{k+1} = T_k + \\frac{dt}{C_{\\mathrm{th}}}\\left( I_k^2 R - h \\left( T_k - T_{\\mathrm{amb}} \\right) \\right)\n$$\n该方程构成了仿真和预测的基础。\n\n传感器攻击为电流测量引入了偏差 $b$，使得测量电流 $I_m$ 与真实电流 $I$ 的关系为 $I_m = I + b$。对于低报攻击，$b  0$。\n\n任务是实现并评估两种控制策略。\n\n1.  **温度轨迹的仿真：**\n    创建一个核心函数来模拟 $N$ 个步骤时间域内的温度演变。该函数接受一个恒定电流 $I_{heat}$（代表焦耳热项 $I^2R$ 中使用的电流）和系统参数，并迭代应用离散时间更新规则来计算温度轨迹 $T_0, T_1, \\dots, T_N$。然后记录此轨迹上的最高温度。该函数是通用的，既可用于预测未来温度，也可用于模拟真实系统响应。\n\n2.  **朴素控制器逻辑：**\n    朴素控制器旨在从离散网格 $\\{\\Delta I, 2\\Delta I, \\dots, I_{\\max}\\}$ 中选择一个它认为是安全的最大可能恒定充电电流 $I$。它的判断基于一个受到传感器攻击影响的预测模型。它在其内部预测模型中用测量电流 $I_m = \\max(I+b, 0)$ 替代真实电流。具体来说，对于每个候选电流 $I$，它在发热项中使用 $I_m$ 来预测温度轨迹：\n    $$\n    T_{k+1, \\text{pred}} = T_{k, \\text{pred}} + \\frac{dt}{C_{\\mathrm{th}}}\\left( I_m^2 R - h \\left( T_{k, \\text{pred}} - T_{\\mathrm{amb}} \\right) \\right)\n    $$\n    它检查最大预测温度 $\\max(T_{\\text{pred}})$ 是否保持在安全上限 $T_{\\max}$ 以下。控制器选择满足此条件的最大候选电流 $I$。其缺陷在于，它为一个安全关键决策信任了带偏差的测量值。当 $b  0$ 时，$I_m  I$，导致控制器低估了产热量 $I^2 R$，从而可能选择一个实际上不安全的电流。\n\n3.  **修正后的控制器逻辑：**\n    修正后的控制器（或称鲁棒控制器）纠正了朴素控制器的缺陷。它明白传感器测量可能不可靠，不应用于预测其自身行为的后果。相反，它直接在其预测模型中使用指令（驱动）电流 $I$。对于每个候选电流 $I$，它使用 $I$ 本身来预测温度：\n    $$\n    T_{k+1, \\text{pred}} = T_{k, \\text{pred}} + \\frac{dt}{C_{\\mathrm{th}}}\\left( I^2 R - h \\left( T_{k, \\text{pred}} - T_{\\mathrm{amb}} \\right) \\right)\n    $$\n    这个预测精确地反映了施加电流 $I$ 的物理后果。控制器从网格中选择最大的候选电流 $I$，使其预测的温度轨迹不超过 $T_{\\max}$。这种设计对传感器测量偏差具有鲁棒性，因为预测回路是基于指令信号闭环的，而不是基于受损的传感器信号。\n\n4.  **评估与反例（情况 B）：**\n    对于每个测试用例，我们首先确定朴素控制器 ($I_{\\text{naive}}$) 和修正后控制器 ($I_{\\text{corrected}}$) 选择的电流。然后，我们模拟**真实**物理系统对这些电流中每一个的响应。真实响应总是由实际的指令电流 $I$ 决定，而不是 $I_m$。\n    \n    我们来分析测试用例 B：$C_{\\mathrm{th}} = 600\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 1.5\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，以及偏差 $b = -1.0\\,\\mathrm{A}$。\n    - **修正后的控制器**：它寻找最大的 $I$，使得真实温度（其将趋近于稳态温度 $T_{ss} = I^2 R/h + T_{\\mathrm{amb}}$）保持在 $T_{\\max} = 313\\,\\mathrm{K}$ 以下。条件 $I^2 (0.02)/(1.5) + 298 \\le 313$ 意味着 $I \\le \\sqrt{15 \\times 1.5 / 0.02} = \\sqrt{1125} \\approx 33.54\\,\\mathrm{A}$。在步长为 $\\Delta I = 0.5\\,\\mathrm{A}$ 的网格上，最大的电流是 $I_{\\text{corrected}} = 33.5\\,\\mathrm{A}$。对于此电流，真实最高温度接近 $312.96\\,\\mathrm{K}$，是安全的。\n    - **朴素控制器**：它使用 $I_m = I - 1.0$ 来预测安全性。它寻找使预测结果安全的最大的 $I$。预测的稳态温度是 $(I-1.0)^2 R/h + T_{\\mathrm{amb}} \\le 313\\,\\mathrm{K}$，这意味着 $I-1.0 \\le 33.54\\,\\mathrm{A}$，或 $I \\le 34.54\\,\\mathrm{A}$。控制器选择满足此条件的最大网格电流，$I_{\\text{naive}} = 34.5\\,\\mathrm{A}$。它*相信*这是安全的，因为它的预测使用的是 $33.5\\,\\mathrm{A}$ 的有效电流。\n    - **真实结果**：系统实际上受到 $I = 34.5\\,\\mathrm{A}$ 的电流作用。真实的稳态温度为 $(34.5)^2 (0.02)/(1.5) + 298 \\approx 313.87\\,\\mathrm{K}$。由于 $N=1200$ 步的时间域足够长（是热时间常数 $\\tau = C_{th}/h = 400\\,\\mathrm{s}$ 的三倍），温度将超过 $313\\,\\mathrm{K}$ 的上限。这证明了失败：朴素控制器被传感器偏差所欺骗，施加了一个违反安全约束的电流。\n\n最终的程序为所有指定的测试用例实现了这一逻辑，报告了两种控制器所达到的最大真实温度以及相应的约束违规状态。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Case A (happy path, no bias)\n        (600, 0.02, 1.5, 298, 298, 313, 1, 1200, 50, 0.5, 0.0),\n        # Case B (counterexample, targeted small bias)\n        (600, 0.02, 1.5, 298, 298, 313, 1, 1200, 50, 0.5, -1.0),\n        # Case C (boundary bias near threshold)\n        (600, 0.02, 1.5, 298, 298, 313, 1, 1200, 50, 0.5, -0.5),\n        # Case D (edge case with high thermal mass and cooling)\n        (2000, 0.02, 4.0, 298, 298, 313, 1, 1200, 50, 0.5, -1.0),\n    ]\n\n    def simulate_temperature(I_heat, C_th, R, h, T_amb, T0, dt, N):\n        \"\"\"\n        Simulates the battery temperature over N steps for a constant heating current.\n        \"\"\"\n        T_trajectory = np.zeros(N + 1)\n        T_trajectory[0] = T0\n        T_k = T0\n        for k in range(N):\n            dT_dt = (I_heat**2 * R - h * (T_k - T_amb)) / C_th\n            T_k = T_k + dt * dT_dt\n            T_trajectory[k+1] = T_k\n        return T_trajectory\n\n    def find_current(params, use_naive_prediction):\n        \"\"\"\n        Finds the largest safe current based on the specified prediction model.\n        \"\"\"\n        C_th, R, h, T_amb, T0, T_max, dt, N, I_max, delta_I, b = params\n        \n        candidate_currents = np.arange(I_max, -delta_I, -delta_I)\n        chosen_I = 0.0\n\n        for I_cand in candidate_currents:\n            if use_naive_prediction:\n                I_pred = max(I_cand + b, 0.0)\n            else:\n                I_pred = I_cand\n            \n            predicted_trajectory = simulate_temperature(I_pred, C_th, R, h, T_amb, T0, dt, N)\n            \n            if np.max(predicted_trajectory) = T_max:\n                chosen_I = I_cand\n                break\n        return chosen_I\n\n    results = []\n    for params in test_cases:\n        C_th, R, h, T_amb, T0, T_max, dt, N, I_max, delta_I, b = params\n\n        # 1. Determine current chosen by naive controller\n        I_naive = find_current(params, use_naive_prediction=True)\n        \n        # 2. Determine current chosen by corrected controller\n        I_corrected = find_current(params, use_naive_prediction=False)\n\n        # 3. Simulate TRUE temperature evolution for naive controller's choice\n        true_T_trajectory_naive = simulate_temperature(I_naive, C_th, R, h, T_amb, T0, dt, N)\n        max_T_naive = np.max(true_T_trajectory_naive)\n        naive_violated = max_T_naive > T_max\n\n        # 4. Simulate TRUE temperature evolution for corrected controller's choice\n        true_T_trajectory_corrected = simulate_temperature(I_corrected, C_th, R, h, T_amb, T0, dt, N)\n        max_T_corrected = np.max(true_T_trajectory_corrected)\n        corrected_violated = max_T_corrected > T_max\n\n        results.append(\n            f\"[{max_T_naive:.2f},{max_T_corrected:.2f},{'True' if naive_violated else 'False'},{'True' if corrected_violated else 'False'}]\"\n        )\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在认识到系统可能受到攻击后，下一步是学习如何有效地检测这些异常行为。本练习引入了一种先进的基于模型的检测技术，即使用可达集（reachable sets）来形式化地界定系统的安全运行区域。当测量状态落在该区域之外时，系统将发出警报，并通过计算马氏距离（Mahalanobis distance）来量化检测置信度，该距离考虑了测量噪声的影响。通过这项实践 ，您将运用控制理论与统计学中的高级概念，构建一个精密的异常检测器，从而掌握一种严谨的方法来识别电池系统状态与预期安全行为的偏差。",
            "id": "3903065",
            "problem": "一个并网模块化锂离子电池组由一个状态估计器监控，该估计器输出一个关于电芯平均信息物理状态向量 $x \\in \\mathbb{R}^{2}$ 的可达集。该状态向量由荷电状态和温度组成，记为 $x = [\\mathrm{SOC}, T]^{\\top}$。在一个固定的预测时域内，且在有界驱动和热输入下，自动化设计工具证明在采样时刻的可达集是椭球体\n$$\n\\mathcal{E} = \\left\\{ x \\in \\mathbb{R}^{2} : (x - \\mu)^{\\top} S^{-1} (x - \\mu) \\leq 1 \\right\\},\n$$\n其中心为 $\\mu = \\begin{pmatrix} 0.6 \\\\ 300 \\end{pmatrix}$，形状矩阵为 $S = \\mathrm{diag}(0.01, 9)$。其中荷电状态是区间 $[0,1]$ 内的无量纲值，温度 $T$ 的单位是开尔文。一个传感器套件提供了对状态的测量值 $y \\in \\mathbb{R}^{2}$，该测量带有零均值高斯噪声，模型为 $y = x + v$，其中 $v \\sim \\mathcal{N}(0, R)$，协方差为 $R = \\mathrm{diag}(0.0004, 1)$。在当前时刻，测量到的状态为\n$$\ny = \\begin{pmatrix} 0.75 \\\\ 300 \\end{pmatrix}.\n$$\n\n假设有一个异常检测器，当且仅当测量状态 $y$ 位于预测的可达集 $\\mathcal{E}$ 之外时，它会宣告异常。为了在高斯测量模型下量化检测置信度，将检验统计量定义为从 $y$ 到可达集的最小马氏距离平方，\n$$\nd^{\\star} = \\min_{x \\in \\mathcal{E}} (y - x)^{\\top} R^{-1} (y - x).\n$$\n在原假设下，即真实状态 $x$ 位于 $\\mathcal{E}$ 内且测量噪声是协方差为 $R$ 的高斯噪声，使用白化噪声模型将最坏情况误报概率表示为维度 $n = 2$ 时的上界 $\\exp(-d^{\\star}/2)$，并将检测置信度定义为 $c = 1 - \\exp(-d^{\\star}/2)$。\n\n任务：\n- 判断 $y \\in \\mathcal{E}$ 或 $y \\notin \\mathcal{E}$。\n- 计算如上定义的检测置信度 $c$。\n\n将最终答案表示为 $c$ 的值（无量纲）。将答案四舍五入到四位有效数字。最终答案中不要包含任何单位。",
            "solution": "我们从可达集 $\\mathcal{E}$ 作为椭球体的定义开始\n$$\n\\mathcal{E} = \\left\\{ x \\in \\mathbb{R}^{2} : (x - \\mu)^{\\top} S^{-1} (x - \\mu) \\leq 1 \\right\\},\n$$\n其中 $\\mu = \\begin{pmatrix} 0.6 \\\\ 300 \\end{pmatrix}$ 且 $S = \\mathrm{diag}(0.01, 9)$。测量模型为 $y = x + v$，其中 $v \\sim \\mathcal{N}(0, R)$ 且 $R = \\mathrm{diag}(0.0004, 1)$。\n\n步骤 1：$y$ 在 $\\mathcal{E}$ 中的隶属度测试。隶属度条件为\n$$\nq(y) \\equiv (y - \\mu)^{\\top} S^{-1} (y - \\mu) \\leq 1.\n$$\n计算 $y - \\mu$：\n$$\ny - \\mu = \\begin{pmatrix} 0.75 - 0.6 \\\\ 300 - 300 \\end{pmatrix} = \\begin{pmatrix} 0.15 \\\\ 0 \\end{pmatrix}.\n$$\n计算 $S^{-1} = \\mathrm{diag}(100, 1/9)$。然后\n$$\nq(y) = \\begin{pmatrix} 0.15  0 \\end{pmatrix} \\begin{pmatrix} 100  0 \\\\ 0  1/9 \\end{pmatrix} \\begin{pmatrix} 0.15 \\\\ 0 \\end{pmatrix} = 100 \\cdot (0.15)^{2} + \\frac{1}{9} \\cdot 0^{2} = 100 \\cdot 0.0225 = 2.25.\n$$\n因为 $q(y) = 2.25  1$，我们得出结论 $y \\notin \\mathcal{E}$，因此检测器宣告异常。\n\n步骤 2：计算最小马氏距离平方 $d^{\\star} = \\min_{x \\in \\mathcal{E}} (y - x)^{\\top} R^{-1} (y - x)$。\n\n我们使用以下基本设置。令 $W = R^{-1} = \\mathrm{diag}(1/0.0004, 1/1) = \\mathrm{diag}(2500, 1)$。我们必须解决以下凸优化问题\n$$\n\\min_{x} \\ (y - x)^{\\top} W (y - x) \\quad \\text{约束条件为} \\quad (x - \\mu)^{\\top} S^{-1} (x - \\mu) \\leq 1.\n$$\n对于边界情况（因为 $y \\notin \\mathcal{E}$，最小化点位于边界上），拉格朗日函数为\n$$\n\\mathcal{L}(x, \\lambda) = (y - x)^{\\top} W (y - x) + \\lambda \\left[(x - \\mu)^{\\top} S^{-1} (x - \\mu) - 1 \\right], \\quad \\lambda \\geq 0.\n$$\n将关于 $x$ 的梯度设为零，得到\n$$\n-2 W (y - x) + 2 \\lambda S^{-1} (x - \\mu) = 0 \\quad \\Rightarrow \\quad W (x - y) + \\lambda S^{-1} (x - \\mu) = 0.\n$$\n这产生了一个线性系统\n$$\n\\left( W + \\lambda S^{-1} \\right) x = W y + \\lambda S^{-1} \\mu.\n$$\n因为 $W$ 和 $S^{-1}$ 是对角矩阵，且 $y - \\mu$ 与第一坐标轴对齐，所以最优解 $x^{\\star}$ 也沿第一坐标轴对齐，其第二坐标等于中心点 $\\mu_{2}$。直观上，并根据对称性可以正式地得出，在此加权范数下，椭球体上离 $y$ 最近的点是从 $\\mu$ 出发穿过 $y$ 的射线上的边界点。椭球体的边界由下式给出\n$$\n\\frac{(x_{1} - \\mu_{1})^{2}}{0.01} + \\frac{(x_{2} - \\mu_{2})^{2}}{9} = 1.\n$$\n因为 $y_{2} = \\mu_{2}$，最近的边界点满足 $x_{2}^{\\star} = \\mu_{2}$ 且\n$$\n\\frac{(x_{1}^{\\star} - \\mu_{1})^{2}}{0.01} = 1 \\quad \\Rightarrow \\quad |x_{1}^{\\star} - \\mu_{1}| = \\sqrt{0.01} = 0.1,\n$$\n符号选择为与 $y_{1} - \\mu_{1}  0$ 的方向相同，因此\n$$\nx_{1}^{\\star} = \\mu_{1} + 0.1 = 0.6 + 0.1 = 0.7, \\quad x_{2}^{\\star} = \\mu_{2} = 300.\n$$\n因此，最小化的边界点是 $x^{\\star} = \\begin{pmatrix} 0.7 \\\\ 300 \\end{pmatrix}$，且最小马氏距离平方为\n$$\nd^{\\star} = (y - x^{\\star})^{\\top} W (y - x^{\\star}) = \\begin{pmatrix} 0.05 \\\\ 0 \\end{pmatrix}^{\\top} \\begin{pmatrix} 2500  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 0.05 \\\\ 0 \\end{pmatrix} = 2500 \\cdot (0.05)^{2} + 1 \\cdot 0^{2} = 2500 \\cdot 0.0025 = 6.25.\n$$\n\n步骤 3：检测置信度。在白化模型下，如果 $z = R^{-1/2} v \\sim \\mathcal{N}(0, I_{2})$，那么 $\\|z\\|^{2}$ 服从自由度为2的卡方分布。观测到一个与 $\\mathcal{E}$ 的不相容性至少和 $y$ 一样大的点的最坏情况误报概率，其上界为尾概率\n$$\np_{\\mathrm{fa}} \\leq \\Pr\\left( \\chi^{2}_{2} \\geq d^{\\star} \\right) = \\exp\\!\\left( -\\frac{d^{\\star}}{2} \\right),\n$$\n这里我们用到了以下事实：对于 $k = 2$，生存函数为 $\\Pr(\\chi^{2}_{2} \\ge t) = \\exp(-t/2)$。因此，检测置信度为\n$$\nc = 1 - \\exp\\!\\left( -\\frac{d^{\\star}}{2} \\right) = 1 - \\exp\\!\\left( -\\frac{6.25}{2} \\right) = 1 - \\exp(-3.125).\n$$\n计算数值：\n$$\n\\exp(-3.125) \\approx 0.0439369 \\quad \\Rightarrow \\quad c \\approx 1 - 0.0439369 = 0.9560631.\n$$\n四舍五入到四位有效数字，置信度为\n$$\nc \\approx 0.9561.\n$$",
            "answer": "$$\\boxed{0.9561}$$"
        },
        {
            "introduction": "在掌握了攻击的检测方法之后，设计的最终目标是构建具有主动防御能力的控制器，从一开始就保证系统的弹性。本练习聚焦于鲁棒模型预测控制（MPC）中的一项核心技术——约束收紧（constraint tightening）。您将通过分析推导，计算出为保证系统安全所必需的最小安全裕度，即使在最坏情况下的执行器攻击和模型不确定性影响下，也能确保电池的电压和温度等关键状态永远不会超出其安全限制 。这项实践将使您从被动检测转向主动预防，这是设计先进、安全网络物理系统的标志。",
            "id": "3903132",
            "problem": "考虑一个锂离子电池单元在固定工作点附近的线性化离散时间信息物理模型，该模型用于一个标称开环模型预测控制（MPC）规划器中。标称预测模型为\n$$\n\\hat{x}_{k+1} = A \\hat{x}_{k} + B u_{k},\n$$\n其中 $\\hat{x}_{k} \\in \\mathbb{R}^{n}$ 是预测状态，$u_{k} \\in \\mathbb{R}$ 是规划的执行器指令（电流设定点），$A \\in \\mathbb{R}^{n \\times n}$ 和 $B \\in \\mathbb{R}^{n \\times 1}$ 是通过第一性原理线性化和系统辨识得到的已知系统矩阵。受到有界执行器攻击和有界模型不确定性影响的实际闭环系统按如下方式演化\n$$\nx_{k+1} = A x_{k} + B\\left(u_{k} + a_{k}\\right) + w_{k},\n$$\n其中 $x_{k} \\in \\mathbb{R}^{n}$ 是实际状态，$a_{k} \\in \\mathbb{R}$ 是执行器攻击信号，$w_{k} \\in \\mathbb{R}^{n}$ 是一个附加集总不确定性，用于解释采样间隔内的模型失配和未建模扰动。假设以下先验已知的界限：\n$$\n|a_{k}| \\le \\bar{a}, \\quad \\|w_{k}\\|_{2} \\le \\bar{w}, \\quad \\text{for all } k \\in \\{0,1,\\dots,N-1\\},\n$$\n其中 $\\bar{a} \\ge 0$ 和 $\\bar{w} \\ge 0$ 是给定常数，$\\|\\cdot\\|_{2}$ 表示向量的欧几里得范数和矩阵的诱导 $2$-范数。初始条件匹配，$\\hat{x}_{0} = x_{0}$。\n\n关注的输出是电池端电压和核心温度，\n$$\nV_{\\text{cell},k} = c_{V}^{\\top} x_{k}, \\quad T_{k} = c_{T}^{\\top} x_{k},\n$$\n其中 $c_{V}, c_{T} \\in \\mathbb{R}^{n}$ 从线性化和热-电化学耦合中已知。将行向量为 $c_{V}^{\\top}$ 和 $c_{T}^{\\top}$ 的矩阵记为 $C \\in \\mathbb{R}^{2 \\times n}$，并定义分量级输出约束\n$$\nV_{\\text{cell},k} \\le V_{\\max}, \\quad T_{k} \\le T_{\\max}, \\quad \\text{for all } k \\in \\{1,\\dots,N\\}.\n$$\n\n为了在长度为 $N \\in \\mathbb{N}$ 的时域内，对所有容许的攻击和不确定性序列鲁棒地强制执行这些约束，标称 MPC 规划器对预测输出应用分量级约束收紧 $\\delta = [\\delta_{V} \\ \\delta_{T}]^{\\top} \\in \\mathbb{R}^{2}_{\\ge 0}$，以使预测满足\n$$\nc_{V}^{\\top} \\hat{x}_{k} \\le V_{\\max} - \\delta_{V}, \\quad c_{T}^{\\top} \\hat{x}_{k} \\le T_{\\max} - \\delta_{T}, \\quad \\text{for all } k \\in \\{1,\\dots,N\\}.\n$$\n根据构造，这种收紧必须保证对于所有 $k \\in \\{1,\\dots,N\\}$ 和所有容许序列 $\\{a_{k}\\}$ 和 $\\{w_{k}\\}$，实际输出满足 $V_{\\text{cell},k} \\le V_{\\max}$ 和 $T_{k} \\le T_{\\max}$。\n\n仅从上述定义、欧几里得范数和诱导 2-范数的性质（三角不等式和次乘性）以及线性时不变状态转移出发，推导确保在整个时域内鲁棒地满足输出约束的最小分量级收紧 $\\delta$。使用诱导 2-范数，将你的最终答案表示为一个以 $A$、$B$、$c_{V}$、$c_{T}$、$\\bar{a}$、$\\bar{w}$ 和 $N$ 表示的单一闭式解析行向量。无需进行数值评估。将收紧的最终表达式以行矩阵 $\\begin{pmatrix}\\delta_{V}  \\delta_{T}\\end{pmatrix}$ 的形式给出。无需四舍五入，最终表达式中不应包含单位。",
            "solution": "该问题要求为一个标称模型预测控制（MPC）规划器推导最小的分量级约束收紧 $\\delta = [\\delta_{V} \\ \\delta_{T}]^{\\top}$，以确保电池系统在执行器攻击和模型不确定性下鲁棒地满足输出约束。\n\n让我们将状态估计误差定义为 $e_{k} = x_{k} - \\hat{x}_{k}$，其中 $x_{k}$ 是实际状态，$\\hat{x}_{k}$ 是预测状态。初始条件为 $x_{0} = \\hat{x}_{0}$，这意味着 $e_{0} = 0$。\n\n误差的动态特性可以通过从实际系统模型中减去标称模型来得到：\n$$\nx_{k+1} - \\hat{x}_{k+1} = \\left(A x_{k} + B(u_{k} + a_{k}) + w_{k}\\right) - \\left(A \\hat{x}_{k} + B u_{k}\\right)\n$$\n$$\ne_{k+1} = A(x_{k} - \\hat{x}_{k}) + B a_{k} + w_{k}\n$$\n$$\ne_{k+1} = A e_{k} + B a_{k} + w_{k}\n$$\n这是误差 $e_k$ 的一个线性时不变递推关系。我们可以从初始条件 $e_{0} = 0$ 开始展开这个递推关系：\n$$\ne_{1} = A e_{0} + B a_{0} + w_{0} = B a_{0} + w_{0}\n$$\n$$\ne_{2} = A e_{1} + B a_{1} + w_{1} = A(B a_{0} + w_{0}) + B a_{1} + w_{1} = A B a_{0} + A w_{0} + B a_{1} + w_{1}\n$$\n通过归纳法，在任意时间步 $k \\ge 1$ 时 $e_{k}$ 的通解由下式给出：\n$$\ne_{k} = A^{k} e_{0} + \\sum_{j=0}^{k-1} A^{k-1-j} \\left( B a_{j} + w_{j} \\right)\n$$\n由于 $e_{0}=0$，这可以简化为：\n$$\ne_{k} = \\sum_{j=0}^{k-1} A^{k-1-j} (B a_{j} + w_{j})\n$$\n\n实际输出为 $y_k = C x_k$，其中 $C$ 的行向量是 $c_V^\\top$ 和 $c_T^\\top$。分量级约束为 $c_V^\\top x_k \\le V_{\\max}$ 和 $c_T^\\top x_k \\le T_{\\max}$。让我们考虑一个通用输出约束 $c_i^\\top x_k \\le Y_{\\max}$，其中 $i \\in \\{V, T\\}$。\nMPC 规划器强制执行收紧后的约束 $c_i^\\top \\hat{x}_k \\le Y_{\\max} - \\delta_i$。\n为保证鲁棒满足，实际输出必须在所有容许的攻击 $\\{a_k\\}$ 和不确定性 $\\{w_k\\}$ 下满足原始约束。我们可以用预测和误差来表示实际输出：\n$$\nc_i^\\top x_k = c_i^\\top (\\hat{x}_k + e_k) = c_i^\\top \\hat{x}_k + c_i^\\top e_k\n$$\n代入规划器强制执行的收紧约束：\n$$\nc_i^\\top x_k \\le (Y_{\\max} - \\delta_i) + c_i^\\top e_k\n$$\n为确保 $c_i^\\top x_k \\le Y_{\\max}$ 总是成立，我们必须有：\n$$\n(Y_{\\max} - \\delta_i) + c_i^\\top e_k \\le Y_{\\max} \\quad \\implies \\quad c_i^\\top e_k \\le \\delta_i\n$$\n这个不等式必须对所有 $k \\in \\{1,\\dots,N\\}$ 以及所有容许的攻击序列 $\\{a_j\\}_{j=0}^{k-1}$ 和不确定性序列 $\\{w_j\\}_{j=0}^{k-1}$ 成立。因此，收紧量 $\\delta_i$ 必须大于或等于在整个时域和所有可能扰动下 $c_i^\\top e_k$ 的最大可能值。最小的收紧量是这种最紧的界：\n$$\n\\delta_i = \\max_{k \\in \\{1,\\dots,N\\}} \\left( \\sup_{\\{a_j\\}, \\{w_j\\}} c_i^\\top e_k \\right)\n$$\n其中上确界是对所有满足 $|a_j| \\le \\bar{a}$ 和 $\\|w_j\\|_2 \\le \\bar{w}$ 的序列取的。\n\n让我们计算固定 $k$ 时 $c_i^\\top e_k$ 的上确界。代入 $e_k$ 的表达式：\n$$\nc_i^\\top e_k = c_i^\\top \\left( \\sum_{j=0}^{k-1} \\left( A^{k-1-j} B a_j + A^{k-1-j} w_j \\right) \\right) = \\sum_{j=0}^{k-1} \\left( c_i^\\top A^{k-1-j} B a_j + c_i^\\top A^{k-1-j} w_j \\right)\n$$\n由于在每个时间步 $j$ 时 $a_j$ 和 $w_j$ 的选择是独立的，因此和的上确界等于各项上确界的和：\n$$\n\\sup_{\\{a_j\\},\\{w_j\\}} c_i^\\top e_k = \\sum_{j=0}^{k-1} \\left( \\sup_{|a_j| \\le \\bar{a}} (c_i^\\top A^{k-1-j} B a_j) + \\sup_{\\|w_j\\|_2 \\le \\bar{w}} (c_i^\\top A^{k-1-j} w_j) \\right)\n$$\n对于第一项，$c_i^\\top A^{k-1-j} B$ 是一个标量。表达式 $s \\cdot a_j$ 在 $|a_j| \\le \\bar{a}$ 的约束下，当 $a_j$ 取与 $s$ 相同符号的最大幅值时达到最大值，其上确界为 $|s| \\bar{a}$。因此：\n$$\n\\sup_{|a_j| \\le \\bar{a}} (c_i^\\top A^{k-1-j} B a_j) = |c_i^\\top A^{k-1-j} B| \\bar{a}\n$$\n对于第二项，令行向量为 $v_j^\\top = c_i^\\top A^{k-1-j}$。我们想求 $\\sup_{\\|w_j\\|_2 \\le \\bar{w}} v_j^\\top w_j$。根据柯西-施瓦茨不等式，$v_j^\\top w_j \\le \\|v_j\\|_2 \\|w_j\\|_2$。当 $w_j$ 与 $v_j$ 对齐时，即 $w_j = \\bar{w} \\frac{v_j}{\\|v_j\\|_2}$，达到最大值。上确界为 $\\|v_j\\|_2 \\bar{w}$。向量 $v_j$ 是 $v_j^\\top$ 的转置，所以 $v_j = (A^{k-1-j})^\\top c_i$。因此：\n$$\n\\sup_{\\|w_j\\|_2 \\le \\bar{w}} (c_i^\\top A^{k-1-j} w_j) = \\|(A^{k-1-j})^\\top c_i\\|_2 \\bar{w}\n$$\n结合这些结果，在时间 $k$ 时输出 $i$ 的最坏情况偏差为：\n$$\nd_{i,k} \\triangleq \\sup_{\\{a_j\\},\\{w_j\\}} c_i^\\top e_k = \\sum_{j=0}^{k-1} \\left( |c_i^\\top A^{k-1-j} B| \\bar{a} + \\|(A^{k-1-j})^\\top c_i\\|_2 \\bar{w} \\right)\n$$\n为了简化表达式，我们改变求和索引为 $m = k-1-j$。当 $j$ 从 $0$ 变到 $k-1$ 时，$m$ 从 $k-1$ 变到 $0$。\n$$\nd_{i,k} = \\sum_{m=0}^{k-1} \\left( |c_i^\\top A^m B| \\bar{a} + \\|(A^m)^\\top c_i\\|_2 \\bar{w} \\right)\n$$\n最小收紧量 $\\delta_i$ 必须对所有 $k \\in \\{1,\\dots,N\\}$ 有效，因此 $\\delta_i = \\max_{k \\in \\{1,\\dots,N\\}} d_{i,k}$。\n求和中的项都是非负的，因为 $\\bar{a} \\ge 0$，$\\bar{w} \\ge 0$，绝对值是非负的，范数也是非负的。因此，$d_{i,k}$ 是 $k$ 的一个单调非减函数：\n$$\nd_{i, k+1} = d_{i,k} + \\left( |c_i^\\top A^k B| \\bar{a} + \\|(A^k)^\\top c_i\\|_2 \\bar{w} \\right) \\ge d_{i,k}\n$$\n在时域 $\\{1,\\dots,N\\}$ 上，$d_{i,k}$ 的最大值必然出现在最后一步，即 $k=N$。\n$$\n\\delta_i = d_{i,N} = \\sum_{m=0}^{N-1} \\left( |c_i^\\top A^m B| \\bar{a} + \\|(A^m)^\\top c_i\\|_2 \\bar{w} \\right)\n$$\n将此通用公式应用于电压（$i=V$）和温度（$i=T$）约束，我们得到：\n$$\n\\delta_V = \\sum_{m=0}^{N-1} \\left( \\bar{a} |c_V^\\top A^m B| + \\bar{w} \\|(A^m)^\\top c_V\\|_2 \\right)\n$$\n$$\n\\delta_T = \\sum_{m=0}^{N-1} \\left( \\bar{a} |c_T^\\top A^m B| + \\bar{w} \\|(A^m)^\\top c_T\\|_2 \\right)\n$$\n最终答案要求以行矩阵 $\\begin{pmatrix} \\delta_V  \\delta_T \\end{pmatrix}$ 的形式给出。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\sum_{m=0}^{N-1} \\left( \\bar{a} |c_V^\\top A^m B| + \\bar{w} \\|(A^m)^\\top c_V\\|_2 \\right)  \\sum_{m=0}^{N-1} \\left( \\bar{a} |c_T^\\top A^m B| + \\bar{w} \\|(A^m)^\\top c_T\\|_2 \\right) \\end{pmatrix}}\n$$"
        }
    ]
}