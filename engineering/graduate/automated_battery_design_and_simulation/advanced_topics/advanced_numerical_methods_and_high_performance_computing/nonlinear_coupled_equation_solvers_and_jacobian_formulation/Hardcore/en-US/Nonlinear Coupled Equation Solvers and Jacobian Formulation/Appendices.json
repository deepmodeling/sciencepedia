{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any finite volume-based simulation is the accurate translation of continuous governing laws into a discrete set of algebraic equations. This first practice focuses on constructing the residual equation for the solid-phase potential, a key variable in porous electrode theory . By working through the discretization of the charge conservation equation, you will gain experience in applying the finite volume method and, crucially, in handling Neumann boundary conditions which represent physical fluxes like the applied current.",
            "id": "3932742",
            "problem": "A one-dimensional through-plane model of the porous solid matrix of the negative electrode in a Lithium-ion battery (LIB) is considered on the spatial domain $x \\in [0, L_{n}]$. The solid-phase potential $ \\phi_{s}(x) $ satisfies the steady charge conservation law, derived from Ohm’s law in the solid matrix and interfacial charge transfer, given by\n$$\n\\nabla \\cdot \\left( \\sigma_{s} \\nabla \\phi_{s} \\right) - a_{s} j = 0,\n$$\nwhere $ \\sigma_{s} $ is the (constant) effective solid-phase conductivity, $ a_{s} $ is the specific interfacial area, and $ j $ is the interfacial reaction current density per unit interfacial area. The interfacial reaction current density is modeled by the Butler–Volmer (BV) relation\n$$\nj = 2 j_{0} \\, \\sinh\\!\\left( \\frac{\\alpha F}{R T} \\, \\eta \\right),\n$$\nwith overpotential\n$$\n\\eta = \\phi_{s} - \\phi_{e} - U(c_{s}),\n$$\nwhere $ j_{0} $ is the exchange current density, $ \\alpha $ is the charge transfer coefficient, $ F $ is the Faraday constant, $ R $ is the universal gas constant, $ T $ is the absolute temperature, $ \\phi_{e} $ is the electrolyte potential, $ U(c_{s}) $ is the open-circuit potential as a function of local solid concentration $ c_{s} $. Assume that $ j_{0}$, $ \\phi_{e} $, and $ U(c_{s}) $ are known at the discrete nodes from a previous iteration within a coupled nonlinear solver.\n\nBoundary conditions are imposed as follows: at the current collector interface $x = 0$,\n$$\n- \\sigma_{s} \\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x=0} = i_{\\mathrm{app}},\n$$\nwhere $ i_{\\mathrm{app}} $ is the applied current density (positive for discharge), and at the separator interface $ x = L_{n} $,\n$$\n- \\sigma_{s} \\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x=L_{n}} = 0.\n$$\n\nDiscretize the domain with a uniform grid of $ N $ cell-centered unknowns $ \\{ \\phi_{s, i} \\}_{i=1}^{N} $ at locations $ x_{i} = (i-1) \\Delta x $ with $ \\Delta x = L_{n}/(N-1) $. Using a second-order finite-volume discretization with central fluxes for internal faces and ghost-elimination for boundaries, construct the nonlinear residuals for the solid potential at the current collector-adjacent node $ i = 1 $ and at the separator-adjacent node $ i = N $. The control-volume residual at node $ i $ is defined as the net conductive flux out of the control volume minus the volumetric interfacial source, i.e.,\n$$\nR_{i}(\\boldsymbol{\\phi}_{s}) \\equiv \\frac{\\sigma_{s}}{\\Delta x} \\left[ \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{i+1/2}} - \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{i-1/2}} \\right] - a_{s} \\, j_{i},\n$$\nwith\n$$\nj_{i} = 2 j_{0,i} \\, \\sinh\\!\\left( \\frac{\\alpha F}{R T} \\left[ \\phi_{s,i} - \\phi_{e,i} - U_{i} \\right] \\right).\n$$\n\nExpress $ R_{1} $ and $ R_{N} $ explicitly in terms of $ \\phi_{s,1} $, $ \\phi_{s,2} $, $ \\phi_{s,N-1} $, $ \\phi_{s,N} $, $ \\sigma_{s} $, $ \\Delta x $, $ a_{s} $, $ i_{\\mathrm{app}} $, $ j_{0,i} $, $ \\alpha $, $ F $, $ R $, $ T $, $ \\phi_{e,i} $, and $ U_{i} $, eliminating ghost values using the boundary conditions. Your final answer must be a single closed-form analytic expression; report the pair $ \\left( R_{1}, R_{N} \\right) $ as a single row matrix. Do not include units in your final boxed answer.",
            "solution": "The problem requires the derivation of the nonlinear residuals for the solid-phase potential, $\\phi_{s}$, at the boundary nodes of a one-dimensional discretized domain of a battery electrode. The governing equation is a nonlinear second-order ordinary differential equation with mixed boundary conditions.\n\nFirst, we validate the problem.\n**Step 1: Extract Givens**\n- Governing Equation: $\\nabla \\cdot \\left( \\sigma_{s} \\nabla \\phi_{s} \\right) - a_{s} j = 0$ for $x \\in [0, L_{n}]$. In one dimension, this is $\\frac{d}{dx} \\left( \\sigma_{s} \\frac{d \\phi_{s}}{d x} \\right) - a_{s} j = 0$.\n- Interfacial Current Density (Butler-Volmer): $j = 2 j_{0} \\, \\sinh\\!\\left( \\frac{\\alpha F}{R T} \\, \\eta \\right)$.\n- Overpotential: $\\eta = \\phi_{s} - \\phi_{e} - U(c_{s})$.\n- Boundary Condition at $x=0$: $- \\sigma_{s} \\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x=0} = i_{\\mathrm{app}}$.\n- Boundary Condition at $x=L_{n}$: $- \\sigma_{s} \\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x=L_{n}} = 0$.\n- Discretization: $N$ unknowns $\\{\\phi_{s,i}\\}_{i=1}^{N}$ on a uniform grid.\n- Nodal Coordinates: $x_{i} = (i-1) \\Delta x$ for $i=1, \\dots, N$.\n- Grid Spacing: $\\Delta x = L_{n}/(N-1)$. This places node $1$ at $x_1=0$ and node $N$ at $x_N=L_n$.\n- Residual Definition: $R_{i}(\\boldsymbol{\\phi}_{s}) \\equiv \\frac{\\sigma_{s}}{\\Delta x} \\left[ \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{i+1/2}} - \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{i-1/2}} \\right] - a_{s} \\, j_{i}$.\n- Discrete Current Density: $j_{i} = 2 j_{0,i} \\, \\sinh\\!\\left( \\frac{\\alpha F}{R T} \\left[ \\phi_{s,i} - \\phi_{e,i} - U_{i} \\right] \\right)$.\n- Known quantities: $\\sigma_{s}$, $a_{s}$, $i_{\\mathrm{app}}$, $j_{0,i}$, $\\alpha$, $F$, $R$, $T$, $\\phi_{e,i}$, $U_{i}$.\n- Task: Find explicit expressions for the residuals $R_{1}$ and $R_{N}$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, employing standard models from electrochemistry (Newman model framework). It is mathematically well-posed as a nonlinear boundary value problem. All terms are defined, and necessary information for the discretization is provided. The instructions on the numerical method (\"second-order finite-volume discretization with central fluxes and ghost-elimination\") are clear, though the term \"cell-centered\" is used loosely for what is functionally a node-centered grid. This ambiguity does not prevent a consistent interpretation and solution. The problem is a standard exercise in computational science and is fully valid.\n\n**Step 3: Proceed to Solution**\nWe will apply the specified \"ghost-elimination\" method, which involves introducing ghost nodes outside the domain to enforce the boundary conditions while using the standard central-difference stencil. The provided residual formula is consistent with a finite-volume approach where each control volume has a width of $\\Delta x$.\n\n**Residual at the Current Collector Interface, $R_{1}$ (for $i=1$)**\n\nThe general formula for the residual at node $i$ is:\n$$\nR_{i} = \\frac{\\sigma_{s}}{\\Delta x} \\left[ \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{i+1/2}} - \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{i-1/2}} \\right] - a_{s} j_{i}\n$$\nFor node $i=1$, located at $x_1=0$, the residual is:\n$$\nR_{1} = \\frac{\\sigma_{s}}{\\Delta x} \\left[ \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{3/2}} - \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{1/2}} \\right] - a_{s} j_{1}\n$$\nThe gradient at the face $x_{3/2}$ (midpoint between $x_1$ and $x_2$) is approximated by a second-order central difference:\n$$\n\\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{3/2}} \\approx \\frac{\\phi_{s,2} - \\phi_{s,1}}{\\Delta x}\n$$\nThe gradient at face $x_{1/2}$ (midpoint between $x_1$ and a ghost node $x_0 = -\\Delta x$) is:\n$$\n\\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{1/2}} \\approx \\frac{\\phi_{s,1} - \\phi_{s,0}}{\\Delta x}\n$$\nSubstituting these into the expression for $R_1$ gives:\n$$\nR_{1} = \\frac{\\sigma_{s}}{\\Delta x} \\left[ \\frac{\\phi_{s,2} - \\phi_{s,1}}{\\Delta x} - \\frac{\\phi_{s,1} - \\phi_{s,0}}{\\Delta x} \\right] - a_{s} j_{1} = \\frac{\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,2} - 2\\phi_{s,1} + \\phi_{s,0}) - a_{s} j_{1}\n$$\nTo eliminate the ghost node value $\\phi_{s,0}$, we use the boundary condition at $x=0$:\n$$\n- \\sigma_{s} \\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x=0} = i_{\\mathrm{app}} \\implies \\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x_1} = -\\frac{i_{\\mathrm{app}}}{\\sigma_s}\n$$\nWe approximate the derivative at $x_1$ using a second-order central difference involving the ghost node $x_0$ and node $x_2$:\n$$\n\\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x_1} \\approx \\frac{\\phi_{s,2} - \\phi_{s,0}}{2\\Delta x}\n$$\nEquating this to the boundary condition gives:\n$$\n\\frac{\\phi_{s,2} - \\phi_{s,0}}{2\\Delta x} = -\\frac{i_{\\mathrm{app}}}{\\sigma_s} \\implies \\phi_{s,0} = \\phi_{s,2} + \\frac{2\\Delta x \\, i_{\\mathrm{app}}}{\\sigma_s}\n$$\nSubstituting this expression for $\\phi_{s,0}$ back into the equation for $R_1$:\n$$\nR_{1} = \\frac{\\sigma_{s}}{(\\Delta x)^{2}} \\left( \\phi_{s,2} - 2\\phi_{s,1} + \\left( \\phi_{s,2} + \\frac{2\\Delta x \\, i_{\\mathrm{app}}}{\\sigma_s} \\right) \\right) - a_{s} j_{1}\n$$\n$$\nR_{1} = \\frac{\\sigma_{s}}{(\\Delta x)^{2}} \\left( 2\\phi_{s,2} - 2\\phi_{s,1} + \\frac{2\\Delta x \\, i_{\\mathrm{app}}}{\\sigma_s} \\right) - a_{s} j_{1}\n$$\n$$\nR_{1} = \\frac{2\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,2} - \\phi_{s,1}) + \\frac{2 i_{\\mathrm{app}}}{\\Delta x} - a_{s} j_{1}\n$$\nFinally, substituting the expression for $j_1$:\n$$\nR_{1} = \\frac{2\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,2} - \\phi_{s,1}) + \\frac{2 i_{\\mathrm{app}}}{\\Delta x} - 2 a_{s} j_{0,1} \\sinh\\!\\left( \\frac{\\alpha F}{R T} (\\phi_{s,1} - \\phi_{e,1} - U_{1}) \\right)\n$$\n\n**Residual at the Separator Interface, $R_{N}$ (for $i=N$)**\n\nFor node $i=N$, located at $x_N=L_n$, the residual is:\n$$\nR_{N} = \\frac{\\sigma_{s}}{\\Delta x} \\left[ \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{N+1/2}} - \\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{N-1/2}} \\right] - a_{s} j_{N}\n$$\nThe gradient at the face $x_{N-1/2}$ (midpoint between $x_{N-1}$ and $x_N$) is:\n$$\n\\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{N-1/2}} \\approx \\frac{\\phi_{s,N} - \\phi_{s,N-1}}{\\Delta x}\n$$\nThe gradient at face $x_{N+1/2}$ (midpoint between $x_N$ and a ghost node $x_{N+1} = L_n + \\Delta x$) is:\n$$\n\\left. \\frac{\\partial \\phi_{s}}{\\partial x} \\right|_{x_{N+1/2}} \\approx \\frac{\\phi_{s,N+1} - \\phi_{s,N}}{\\Delta x}\n$$\nSubstituting these into the expression for $R_N$:\n$$\nR_{N} = \\frac{\\sigma_{s}}{\\Delta x} \\left[ \\frac{\\phi_{s,N+1} - \\phi_{s,N}}{\\Delta x} - \\frac{\\phi_{s,N} - \\phi_{s,N-1}}{\\Delta x} \\right] - a_{s} j_{N} = \\frac{\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,N+1} - 2\\phi_{s,N} + \\phi_{s,N-1}) - a_{s} j_{N}\n$$\nTo eliminate the ghost node value $\\phi_{s,N+1}$, we use the zero-flux boundary condition at $x=L_n$:\n$$\n- \\sigma_{s} \\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x=L_n} = 0 \\implies \\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x_N} = 0\n$$\nUsing a second-order central difference for the derivative at $x_N$:\n$$\n\\frac{\\partial \\phi_{s}}{\\partial x}\\Big|_{x_N} \\approx \\frac{\\phi_{s,N+1} - \\phi_{s,N-1}}{2\\Delta x} = 0 \\implies \\phi_{s,N+1} = \\phi_{s,N-1}\n$$\nSubstituting this into the equation for $R_N$:\n$$\nR_{N} = \\frac{\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,N-1} - 2\\phi_{s,N} + \\phi_{s,N-1}) - a_{s} j_{N}\n$$\n$$\nR_{N} = \\frac{\\sigma_{s}}{(\\Delta x)^{2}} (2\\phi_{s,N-1} - 2\\phi_{s,N}) - a_{s} j_{N}\n$$\n$$\nR_{N} = \\frac{2\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,N-1} - \\phi_{s,N}) - a_{s} j_{N}\n$$\nFinally, substituting the expression for $j_N$:\n$$\nR_{N} = \\frac{2\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,N-1} - \\phi_{s,N}) - 2 a_{s} j_{0,N} \\sinh\\!\\left( \\frac{\\alpha F}{R T} (\\phi_{s,N} - \\phi_{e,N} - U_{N}) \\right)\n$$\n\nThe pair $(R_1, R_N)$ constitutes the final answer.\nFor clarity, let the constant group in the sinh term be $\\beta = \\frac{\\alpha F}{R T}$.\n$R_1 = \\frac{2\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,2} - \\phi_{s,1}) + \\frac{2 i_{\\mathrm{app}}}{\\Delta x} - 2 a_{s} j_{0,1} \\sinh\\!\\left( \\beta (\\phi_{s,1} - \\phi_{e,1} - U_{1}) \\right)$.\n$R_N = \\frac{2\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,N-1} - \\phi_{s,N}) - 2 a_{s} j_{0,N} \\sinh\\!\\left( \\beta (\\phi_{s,N} - \\phi_{e,N} - U_{N}) \\right)$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{2\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,2} - \\phi_{s,1}) + \\frac{2 i_{\\mathrm{app}}}{\\Delta x} - 2 a_{s} j_{0,1} \\sinh\\!\\left( \\frac{\\alpha F}{R T} (\\phi_{s,1} - \\phi_{e,1} - U_{1}) \\right) & \\frac{2\\sigma_{s}}{(\\Delta x)^{2}} (\\phi_{s,N-1} - \\phi_{s,N}) - 2 a_{s} j_{0,N} \\sinh\\!\\left( \\frac{\\alpha F}{R T} (\\phi_{s,N} - \\phi_{e,N} - U_{N}) \\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "With a discrete residual vector established, the next step towards a Newton-Raphson solver is to compute its sensitivity to changes in the unknown variables—the Jacobian matrix. This exercise guides you through the process of deriving the Jacobian entries for an electrolyte potential residual in an interior cell of the discretized domain . This is a crucial skill that demonstrates how the transport and reaction terms in the governing equations contribute to the diagonal and off-diagonal elements of the Jacobian, defining the coupling between neighboring nodes.",
            "id": "3932723",
            "problem": "In a porous electrode of a lithium-ion cell, consider the electrolyte charge conservation written in one spatial dimension as the divergence of ionic current density plus interfacial source equals zero. The governing laws are as follows.\n\nFundamental balance: $\\nabla \\cdot \\mathbf{i}_e + a\\, j = 0$, where $\\mathbf{i}_e$ is the electrolyte ionic current density, $a$ is the interfacial area per unit volume, and $j$ is the interfacial reaction current density.\n\nConstitutive relation for the electrolyte current (Stefan–Maxwell form): $\\mathbf{i}_e = -\\kappa(c,T)\\, \\nabla \\phi_e - \\dfrac{2 R T}{F}\\left(1 - t_+^0\\right) \\kappa(c,T)\\, \\nabla \\ln c$, where $\\kappa$ is the electrolyte conductivity, $c$ is the electrolyte salt concentration, $T$ is the temperature, $R$ is the universal gas constant, $F$ is the Faraday constant, $t_+^0$ is the transference number, and $\\phi_e$ is the electrolyte potential.\n\nKinetics: $j = j(\\eta,c)$ with overpotential $\\eta = \\phi_s - \\phi_e - U(c)$, where $\\phi_s$ is the solid-phase potential and $U(c)$ is the open-circuit potential.\n\nDiscretize the electrolyte charge conservation over a uniform one-dimensional finite volume grid with cell width $\\Delta x$. For an interior control volume indexed by $i$, use a two-point flux approximation at faces $i \\pm \\tfrac{1}{2}$, with face conductivities $\\kappa_{i \\pm \\tfrac{1}{2}}$ treated as known from the previous iterate. The discrete residual for the electrolyte potential equation at node $i$ is\n$$\nR_i = \\frac{i_{e,i+\\tfrac{1}{2}} - i_{e,i-\\tfrac{1}{2}}}{\\Delta x} + a_i\\, j_i(\\eta_i,c_i),\n$$\nwith\n$$\ni_{e,i+\\tfrac{1}{2}} = -\\kappa_{i+\\tfrac{1}{2}} \\frac{\\phi_{e,i+1} - \\phi_{e,i}}{\\Delta x} - \\frac{2 R T}{F}\\left(1 - t_+^0\\right) \\kappa_{i+\\tfrac{1}{2}} \\frac{\\ln c_{i+1} - \\ln c_i}{\\Delta x},\n$$\nand an analogous expression for $i_{e,i-\\tfrac{1}{2}}$. Assume, for the purpose of assembling the Jacobian row with respect to the electrolyte potential unknowns, that $c$, $T$, $t_+^0$, $\\phi_s$, $U(c)$, $a_i$, and $\\kappa_{i \\pm \\tfrac{1}{2}}$ are held fixed, and denote $\\partial j_i/\\partial \\eta_i$ as the kinetic sensitivity evaluated at the current iterate.\n\nWhich option correctly gives the three nonzero Jacobian entries for the residual $R_i$ with respect to the local stencil of electrolyte potential unknowns, that is, the partial derivatives $\\partial R_i/\\partial \\phi_{e,i-1}$, $\\partial R_i/\\partial \\phi_{e,i}$, and $\\partial R_i/\\partial \\phi_{e,i+1}$?\n\nA. \n$\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = -\\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x^2}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{\\kappa_{i-\\tfrac{1}{2}} + \\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2} - a_i \\frac{\\partial j_i}{\\partial \\eta_i}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = -\\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2}.$\n\nB. \n$\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = -\\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x^2}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{\\kappa_{i-\\tfrac{1}{2}} + \\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2} + a_i \\frac{\\partial j_i}{\\partial \\eta_i}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = -\\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2}.$\n\nC.\n$\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = -\\frac{\\kappa_{i}}{\\Delta x^2}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{2\\,\\kappa_{i}}{\\Delta x^2} - a_i \\frac{\\partial j_i}{\\partial \\eta_i}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = -\\frac{\\kappa_{i}}{\\Delta x^2}.$\n\nD.\n$\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = \\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x^2}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = -\\frac{\\kappa_{i-\\tfrac{1}{2}} + \\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2} - a_i \\frac{\\partial j_i}{\\partial \\eta_i}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = \\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2}.$",
            "solution": "### Problem Validation\n\n#### Step 1: Extract Givens\n\nThe problem statement provides the following information:\n- **Governing Equation (Charge Conservation)**: $\\nabla \\cdot \\mathbf{i}_e + a\\, j = 0$, where $\\mathbf{i}_e$ is the electrolyte ionic current density, $a$ is the interfacial area per unit volume, and $j$ is the interfacial reaction current density.\n- **Constitutive Relation (Ionic Current)**: $\\mathbf{i}_e = -\\kappa(c,T)\\, \\nabla \\phi_e - \\dfrac{2 R T}{F}\\left(1 - t_+^0\\right) \\kappa(c,T)\\, \\nabla \\ln c$, with variables $\\kappa$ (conductivity), $c$ (concentration), $T$ (temperature), $R$ (gas constant), $F$ (Faraday constant), $t_+^0$ (transference number), and $\\phi_e$ (electrolyte potential).\n- **Kinetics**: $j = j(\\eta,c)$ with overpotential $\\eta = \\phi_s - \\phi_e - U(c)$, where $\\phi_s$ is the solid-phase potential and $U(c)$ is the open-circuit potential.\n- **Discretized Residual**: For an interior control volume $i$ on a uniform 1D grid of width $\\Delta x$, the residual is $R_i = \\frac{i_{e,i+\\tfrac{1}{2}} - i_{e,i-\\tfrac{1}{2}}}{\\Delta x} + a_i\\, j_i(\\eta_i,c_i)$.\n- **Discretized Flux at face $i+\\tfrac{1}{2}$**: $i_{e,i+\\tfrac{1}{2}} = -\\kappa_{i+\\tfrac{1}{2}} \\frac{\\phi_{e,i+1} - \\phi_{e,i}}{\\Delta x} - \\frac{2 R T}{F}\\left(1 - t_+^0\\right) \\kappa_{i+\\tfrac{1}{2}} \\frac{\\ln c_{i+1} - \\ln c_i}{\\Delta x}$.\n- **Discretized Flux at face $i-\\tfrac{1}{2}$**: An analogous expression applies.\n- **Assumptions for Jacobian Calculation**: For the purpose of differentiating with respect to $\\phi_e$ unknowns, the following are held fixed: $c$, $T$, $t_+^0$, $\\phi_s$, $U(c)$, $a_i$, and $\\kappa_{i \\pm \\tfrac{1}{2}}$.\n- **Notation**: The kinetic sensitivity is denoted as $\\partial j_i/\\partial \\eta_i$.\n- **Question**: Determine the partial derivatives $\\partial R_i/\\partial \\phi_{e,i-1}$, $\\partial R_i/\\partial \\phi_{e,i}$, and $\\partial R_i/\\partial \\phi_{e,i+1}$.\n\n#### Step 2: Validate Using Extracted Givens\n\n- **Scientifically Grounded**: The problem is based on the Doyle-Fuller-Newman (DFN) model, a fundamental and widely-accepted framework for simulating lithium-ion batteries. The equations for charge conservation, ionic transport (Stefan-Maxwell), and reaction kinetics are standard in this context. The problem is a direct application of established electrochemical engineering principles.\n- **Well-Posed**: The problem asks for the calculation of specific partial derivatives of a well-defined algebraic expression (the discretized residual). The finite volume method and the two-point flux approximation are standard numerical techniques. The task is clear and leads to a unique, derivable result.\n- **Objective**: The problem is stated using precise mathematical and technical language, with no subjective or ambiguous terms.\n\nThe problem statement is free of any scientific or factual unsoundness, is formal and relevant, is complete and consistent, is physically plausible, is well-posed, and is a non-trivial but standard exercise in computational modeling.\n\n#### Step 3: Verdict and Action\n\nThe problem statement is valid. I will proceed with the derivation and solution.\n\n### Derivation of Jacobian Entries\n\nThe task is to compute the partial derivatives of the residual $R_i$ with respect to the local electrolyte potentials $\\phi_{e,i-1}$, $\\phi_{e,i}$, and $\\phi_{e,i+1}$.\n\nThe residual at node $i$ is given by:\n$$\nR_i = \\frac{i_{e,i+\\tfrac{1}{2}} - i_{e,i-\\tfrac{1}{2}}}{\\Delta x} + a_i\\, j_i(\\eta_i,c_i)\n$$\n\nFirst, we write out the full expression for $R_i$ by substituting the flux terms. The flux at face $i+\\tfrac{1}{2}$ is given as:\n$$\ni_{e,i+\\tfrac{1}{2}} = -\\kappa_{i+\\tfrac{1}{2}} \\frac{\\phi_{e,i+1} - \\phi_{e,i}}{\\Delta x} - \\frac{2 R T}{F}\\left(1 - t_+^0\\right) \\kappa_{i+\\tfrac{1}{2}} \\frac{\\ln c_{i+1} - \\ln c_i}{\\Delta x}\n$$\nBy analogy, the flux at face $i-\\tfrac{1}{2}$ is:\n$$\ni_{e,i-\\tfrac{1}{2}} = -\\kappa_{i-\\tfrac{1}{2}} \\frac{\\phi_{e,i} - \\phi_{e,i-1}}{\\Delta x} - \\frac{2 R T}{F}\\left(1 - t_+^0\\right) \\kappa_{i-\\tfrac{1}{2}} \\frac{\\ln c_i - \\ln c_{i-1}}{\\Delta x}\n$$\nThe reaction term $j_i$ depends on $\\phi_{e,i}$ through the overpotential $\\eta_i = \\phi_{s,i} - \\phi_{e,i} - U(c_i)$.\n\nWe will now compute the three required partial derivatives. According to the problem statement, all variables other than the stencil potentials $\\phi_{e,i-1}, \\phi_{e,i}, \\phi_{e,i+1}$ are treated as constants. The terms involving $\\ln c$ are therefore constant with respect to these potentials.\n\n1.  **Partial derivative with respect to $\\phi_{e,i-1}$**:\n    The potential $\\phi_{e,i-1}$ appears only in the expression for the flux $i_{e,i-\\tfrac{1}{2}}$. The terms $i_{e,i+\\tfrac{1}{2}}$ and $j_i$ are independent of $\\phi_{e,i-1}$.\n    $$\n    \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = \\frac{1}{\\Delta x} \\frac{\\partial}{\\partial \\phi_{e,i-1}} (-i_{e,i-\\tfrac{1}{2}})\n    $$\n    We calculate the derivative of the flux:\n    $$\n    \\frac{\\partial i_{e,i-\\tfrac{1}{2}}}{\\partial \\phi_{e,i-1}} = \\frac{\\partial}{\\partial \\phi_{e,i-1}} \\left( -\\kappa_{i-\\tfrac{1}{2}} \\frac{\\phi_{e,i} - \\phi_{e,i-1}}{\\Delta x} \\right) = -\\kappa_{i-\\tfrac{1}{2}} \\left( \\frac{-1}{\\Delta x} \\right) = \\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x}\n    $$\n    Substituting this back into the expression for $\\partial R_i/\\partial \\phi_{e,i-1}$:\n    $$\n    \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = \\frac{1}{\\Delta x} \\left( - \\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x} \\right) = -\\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x^2}\n    $$\n\n2.  **Partial derivative with respect to $\\phi_{e,i+1}$**:\n    Similarly, the potential $\\phi_{e,i+1}$ appears only in the expression for the flux $i_{e,i+\\tfrac{1}{2}}$.\n    $$\n    \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = \\frac{1}{\\Delta x} \\frac{\\partial}{\\partial \\phi_{e,i+1}} (i_{e,i+\\tfrac{1}{2}})\n    $$\n    The derivative of the flux is:\n    $$\n    \\frac{\\partial i_{e,i+\\tfrac{1}{2}}}{\\partial \\phi_{e,i+1}} = \\frac{\\partial}{\\partial \\phi_{e,i+1}} \\left( -\\kappa_{i+\\tfrac{1}{2}} \\frac{\\phi_{e,i+1} - \\phi_{e,i}}{\\Delta x} \\right) = -\\kappa_{i+\\tfrac{1}{2}} \\left( \\frac{1}{\\Delta x} \\right) = -\\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x}\n    $$\n    Substituting this back:\n    $$\n    \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = \\frac{1}{\\Delta x} \\left( - \\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x} \\right) = -\\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2}\n    $$\n\n3.  **Partial derivative with respect to $\\phi_{e,i}$**:\n    The potential $\\phi_{e,i}$ appears in both flux terms, $i_{e,i-\\tfrac{1}{2}}$ and $i_{e,i+\\tfrac{1}{2}}$, as well as in the reaction term $j_i$ via $\\eta_i$.\n    $$\n    \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{1}{\\Delta x} \\left( \\frac{\\partial i_{e,i+\\tfrac{1}{2}}}{\\partial \\phi_{e,i}} - \\frac{\\partial i_{e,i-\\tfrac{1}{2}}}{\\partial \\phi_{e,i}} \\right) + a_i \\frac{\\partial j_i}{\\partial \\phi_{e,i}}\n    $$\n    We evaluate each component:\n    - Derivative of $i_{e,i+\\tfrac{1}{2}}$:\n      $$\n      \\frac{\\partial i_{e,i+\\tfrac{1}{2}}}{\\partial \\phi_{e,i}} = \\frac{\\partial}{\\partial \\phi_{e,i}} \\left( -\\kappa_{i+\\tfrac{1}{2}} \\frac{\\phi_{e,i+1} - \\phi_{e,i}}{\\Delta x} \\right) = -\\kappa_{i+\\tfrac{1}{2}} \\left( \\frac{-1}{\\Delta x} \\right) = \\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x}\n      $$\n    - Derivative of $i_{e,i-\\tfrac{1}{2}}$:\n      $$\n      \\frac{\\partial i_{e,i-\\tfrac{1}{2}}}{\\partial \\phi_{e,i}} = \\frac{\\partial}{\\partial \\phi_{e,i}} \\left( -\\kappa_{i-\\tfrac{1}{2}} \\frac{\\phi_{e,i} - \\phi_{e,i-1}}{\\Delta x} \\right) = -\\kappa_{i-\\tfrac{1}{2}} \\left( \\frac{1}{\\Delta x} \\right) = -\\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x}\n      $$\n    - Derivative of $j_i$ using the chain rule:\n      $$\n      \\frac{\\partial j_i}{\\partial \\phi_{e,i}} = \\frac{\\partial j_i}{\\partial \\eta_i} \\frac{\\partial \\eta_i}{\\partial \\phi_{e,i}}\n      $$\n      With $\\eta_i = \\phi_{s,i} - \\phi_{e,i} - U(c_i)$, and noting that $\\phi_{s,i}$ and $U(c_i)$ are held fixed:\n      $$\n      \\frac{\\partial \\eta_i}{\\partial \\phi_{e,i}} = -1\n      $$\n      Therefore:\n      $$\n      \\frac{\\partial j_i}{\\partial \\phi_{e,i}} = -\\frac{\\partial j_i}{\\partial \\eta_i}\n      $$\n    Now, we assemble the full partial derivative $\\partial R_i/\\partial \\phi_{e,i}$:\n    $$\n    \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{1}{\\Delta x} \\left[ \\left( \\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x} \\right) - \\left( -\\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x} \\right) \\right] + a_i \\left( -\\frac{\\partial j_i}{\\partial \\eta_i} \\right)\n    $$\n    $$\n    \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{\\kappa_{i+\\tfrac{1}{2}} + \\kappa_{i-\\tfrac{1}{2}}}{\\Delta x^2} - a_i \\frac{\\partial j_i}{\\partial \\eta_i}\n    $$\n    Re-ordering the terms in the numerator to match the options' convention:\n    $$\n    \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{\\kappa_{i-\\tfrac{1}{2}} + \\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2} - a_i \\frac{\\partial j_i}{\\partial \\eta_i}\n    $$\n\n### Summary of Results and Option Evaluation\nThe derived Jacobian entries are:\n- $\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = -\\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x^2}$\n- $\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{\\kappa_{i-\\tfrac{1}{2}} + \\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2} - a_i \\frac{\\partial j_i}{\\partial \\eta_i}$\n- $\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = -\\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2}$\n\nNow we evaluate each option:\n\n**A.**\n$\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = -\\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x^2}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{\\kappa_{i-\\tfrac{1}{2}} + \\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2} - a_i \\frac{\\partial j_i}{\\partial \\eta_i}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = -\\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2}.$\nThis set of expressions perfectly matches our derived results for all three partial derivatives.\n**Verdict: Correct**\n\n**B.**\n$\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = -\\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x^2}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{\\kappa_{i-\\tfrac{1}{2}} + \\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2} + a_i \\frac{\\partial j_i}{\\partial \\eta_i}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = -\\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2}.$\nThis option has an incorrect sign for the reaction kinetics term in the expression for $\\partial R_i/\\partial \\phi_{e,i}$. The sign should be negative, as derived from the chain rule $\\partial j_i / \\partial \\phi_{e,i} = (\\partial j_i / \\partial \\eta_i) \\cdot (-1)$.\n**Verdict: Incorrect**\n\n**C.**\n$\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = -\\frac{\\kappa_{i}}{\\Delta x^2}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = \\frac{2\\,\\kappa_{i}}{\\Delta x^2} - a_i \\frac{\\partial j_i}{\\partial \\eta_i}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = -\\frac{\\kappa_{i}}{\\Delta x^2}.$\nThis option incorrectly uses a cell-centered conductivity $\\kappa_i$ instead of the face-conductivities $\\kappa_{i \\pm \\tfrac{1}{2}}$ specified in the problem statement for the flux approximation. This is inconsistent with the provided discretization scheme.\n**Verdict: Incorrect**\n\n**D.**\n$\\displaystyle \\frac{\\partial R_i}{\\partial \\phi_{e,i-1}} = \\frac{\\kappa_{i-\\tfrac{1}{2}}}{\\Delta x^2}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i}} = -\\frac{\\kappa_{i-\\tfrac{1}{2}} + \\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2} - a_i \\frac{\\partial j_i}{\\partial \\eta_i}, \\quad \\frac{\\partial R_i}{\\partial \\phi_{e,i+1}} = \\frac{\\kappa_{i+\\tfrac{1}{2}}}{\\Delta x^2}.$\nThis option has the signs of all terms arising from the fluxes inverted. For example, $\\partial R_i/\\partial \\phi_{e,i-1}$ should be $-\\kappa_{i-\\tfrac{1}{2}}/\\Delta x^2$, not positive. The same error affects the other flux-derived terms.\n**Verdict: Incorrect**",
            "answer": "$$\n\\boxed{A}\n$$"
        },
        {
            "introduction": "A theoretically correct model can sometimes be numerically fragile, leading to solver failure under physically realistic but challenging conditions such as ion depletion. This advanced practice addresses the common problem of ill-conditioning that arises when concentrations approach zero . You will explore a powerful stabilization technique—a logarithmic change of variables—to reformulate the system, ensuring solution positivity and improving the solver's robustness by analyzing how this transformation impacts both the residual equations and their corresponding Jacobian entries.",
            "id": "3932811",
            "problem": "In a porous-electrode lithium-ion cell model, consider a one-dimensional domain with uniform properties and an interior control volume indexed by $i$ with neighbors $i-1$ and $i+1$. Let $x$ be the spatial coordinate, $\\Delta x$ the uniform cell spacing, $\\Delta t$ the time step, $c_e$ the electrolyte salt concentration, $\\phi_e$ the electrolyte potential, $\\varepsilon$ the electrolyte porosity, $D_{\\mathrm{eff}}$ the effective electrolyte diffusivity, $\\kappa_{\\mathrm{eff}}$ the effective electrolyte ionic conductivity, $t_+^0$ the cation transference number (with respect to solvent), $a_s$ the specific interfacial area, $R$ the universal gas constant, $T$ the absolute temperature, and $F$ the Faraday constant. Assume isothermal conditions and constant coefficients $\\varepsilon$, $D_{\\mathrm{eff}}$, and $\\kappa_{\\mathrm{eff}}$ in the considered stencil. Denote by $j_i$ the interfacial current density evaluated at node $i$ and treat it as known for the purpose of a single Newton step.\n\nStarting from conservation of species and electrolyte charge in concentrated solution theory, a standard fully implicit finite-volume discretization at node $i$ yields the coupled algebraic residuals\n$$\nR_i^{(c)}(c_e) \\;=\\; \\varepsilon\\,\\frac{c_{e,i} - c_{e,i}^{\\,n}}{\\Delta t} \\;-\\; \\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\left(c_{e,i+1} - 2\\,c_{e,i} + c_{e,i-1}\\right) \\;-\\; \\frac{1 - t_+^0}{F}\\,a_s\\,j_i \\,=\\, 0,\n$$\n$$\nR_i^{(e)}(\\phi_e,c_e) \\;=\\; \\frac{\\kappa_{\\mathrm{eff}}}{\\Delta x^2}\\left(\\phi_{e,i+1} - 2\\,\\phi_{e,i} + \\phi_{e,i-1}\\right) \\;+\\; \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}\\left(\\ln c_{e,i+1} - 2\\,\\ln c_{e,i} + \\ln c_{e,i-1}\\right) \\;-\\; a_s\\,j_i \\,=\\, 0,\n$$\nwhere $c_{e,i}^{\\,n}$ is the known concentration at the previous time level. Newton’s method applied to the unknown vector $u = [\\dots, c_{e,i-1}, c_{e,i}, c_{e,i+1}, \\dots, \\phi_{e,i-1}, \\phi_{e,i}, \\phi_{e,i+1}, \\dots ]^\\top$ requires the Jacobian entries $\\partial R/\\partial u$.\n\nIt is observed in practice that near electrolyte depletion, when $c_{e,i} \\to 0^+$, the Newton step can become ill-conditioned and produce nonphysical negative concentrations if $c_e$ is used directly as a primary variable. A common remedy is to introduce the logarithmic change of variables $\\psi_i = \\ln c_{e,i}$ and to define transformed residuals by substituting $c_{e,j} = \\exp(\\psi_j)$ where appropriate, thereby guaranteeing positivity of $c_e$ and improving the scaling of the Jacobian.\n\nWhich option correctly identifies the ill-conditioning mechanism in the original formulation and provides a mathematically consistent transformed residual system $\\tilde R(\\phi_e,\\psi)$ together with the correct Jacobian blocks with respect to $\\psi$ for the given stencils?\n\nA. The ill-conditioning arises because $\\partial R_i^{(e)}/\\partial c_{e,i}$ contains factors proportional to $1/c_{e,i}$ from differentiating $\\ln c_{e,i}$, which blow up as $c_{e,i}\\to 0^+$. The transformed residuals are obtained by substituting $c_{e,j}=\\exp(\\psi_j)$:\n$$\n\\tilde R_i^{(c)}(\\psi) \\;=\\; \\varepsilon\\,\\frac{e^{\\psi_i} - c_{e,i}^{\\,n}}{\\Delta t} \\;-\\; \\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\left(e^{\\psi_{i+1}} - 2\\,e^{\\psi_i} + e^{\\psi_{i-1}}\\right) \\;-\\; \\frac{1 - t_+^0}{F}\\,a_s\\,j_i,\n$$\n$$\n\\tilde R_i^{(e)}(\\phi_e,\\psi) \\;=\\; \\frac{\\kappa_{\\mathrm{eff}}}{\\Delta x^2}\\left(\\phi_{e,i+1} - 2\\,\\phi_{e,i} + \\phi_{e,i-1}\\right) \\;+\\; \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}\\left(\\psi_{i+1} - 2\\,\\psi_i + \\psi_{i-1}\\right) \\;-\\; a_s\\,j_i.\n$$\nThe corresponding Jacobian entries with respect to $\\psi$ are\n$$\n\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_i} \\;=\\; \\varepsilon\\,\\frac{e^{\\psi_i}}{\\Delta t} \\;+\\; 2\\,\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\,e^{\\psi_i},\\quad\n\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_{i\\pm 1}} \\;=\\; -\\,\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\,e^{\\psi_{i\\pm 1}},\n$$\n$$\n\\frac{\\partial \\tilde R_i^{(e)}}{\\partial \\psi_i} \\;=\\; -\\,2\\,\\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2},\\quad\n\\frac{\\partial \\tilde R_i^{(e)}}{\\partial \\psi_{i\\pm 1}} \\;=\\; +\\,\\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}.\n$$\nThis removes the $1/c_{e,i}$ blow-up because the $\\ln c_e$ terms become linear in $\\psi$, while positivity follows from $c_{e,i}=\\exp(\\psi_i)>0$ for all real $\\psi_i$.\n\nB. The ill-conditioning is due to the diffusion term in $R_i^{(c)}$ becoming small when $c_{e,i}\\to 0^+$, so replacing $c_e$ with $\\psi$ should also replace concentration diffusion with $\\psi$ diffusion. The transformed residuals should therefore be\n$$\n\\tilde R_i^{(c)}(\\psi) \\;=\\; \\varepsilon\\,\\frac{\\psi_i - \\ln c_{e,i}^{\\,n}}{\\Delta t} \\;-\\; \\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\left(\\psi_{i+1} - 2\\,\\psi_i + \\psi_{i-1}\\right) \\;-\\; \\frac{1 - t_+^0}{F}\\,a_s\\,j_i,\n$$\n$$\n\\tilde R_i^{(e)}(\\phi_e,\\psi) \\;=\\; \\frac{\\kappa_{\\mathrm{eff}}}{\\Delta x^2}\\left(\\phi_{e,i+1} - 2\\,\\phi_{e,i} + \\phi_{e,i-1}\\right) \\;+\\; \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}\\left(\\psi_{i+1} - 2\\,\\psi_i + \\psi_{i-1}\\right) \\;-\\; a_s\\,F\\,j_i,\n$$\nwith Jacobian entries identical to the $c_e$-formulation since $\\psi$ is just a relabeling.\n\nC. The ill-conditioning is caused by the reaction source term, so the $\\ln c_e$ term need not be transformed. Use $c_{e,j}=\\exp(\\psi_j)$ only in the species conservation and keep $\\ln c_e$ in $R_i^{(e)}$. The Jacobian of $\\tilde R_i^{(c)}$ with respect to $\\psi$ is\n$$\n\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_i} \\;=\\; \\varepsilon\\,\\frac{1}{\\Delta t} \\;+\\; 2\\,\\frac{D_{\\mathrm{eff}}}{\\Delta x^2},\\quad\n\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_{i\\pm 1}} \\;=\\; -\\,\\frac{D_{\\mathrm{eff}}}{\\Delta x^2},\n$$\nsince the chain rule factors cancel when using $\\psi$.\n\nD. The ill-conditioning is fundamentally due to the discretization stencil; augmenting the residual with a barrier term $+\\mu/\\!c_{e,i}$ suffices to ensure positivity and conditioning without changing variables. The Jacobian is then the original Jacobian plus $\\partial(\\mu/\\!c_{e,i})/\\partial c_{e,i} = -\\mu/c_{e,i}^2$, which remains bounded for small $c_{e,i}$ if $\\mu$ is small. Therefore a variable transform is unnecessary for robust Newton steps.\n\nSelect the option that is fully correct in its identification of the ill-conditioning mechanism and in its transformed residual and Jacobian expressions for the given discretization, while guaranteeing positivity and improved conditioning near depletion.",
            "solution": "The user wants me to act as a meticulous STEM professor, validate the provided problem statement, and then solve it by analyzing the given options.\n\n### Problem Validation\n\n#### Step 1: Extract Givens\n\nThe problem provides the following information:\n- **Model:** A one-dimensional porous-electrode lithium-ion cell model.\n- **Discretization:** An interior control volume indexed by $i$ with neighbors $i-1$ and $i+1$, uniform cell spacing $\\Delta x$, and time step $\\Delta t$.\n- **Variables:** Electrolyte salt concentration $c_e$, electrolyte potential $\\phi_e$.\n- **Constants and Parameters:** Electrolyte porosity $\\varepsilon$, effective electrolyte diffusivity $D_{\\mathrm{eff}}$, effective electrolyte ionic conductivity $\\kappa_{\\mathrm{eff}}$, cation transference number $t_+^0$, specific interfacial area $a_s$, universal gas constant $R$, absolute temperature $T$, Faraday constant $F$.\n- **Assumptions:** Isothermal conditions; constant $\\varepsilon$, $D_{\\mathrm{eff}}$, and $\\kappa_{\\mathrm{eff}}$; interfacial current density $j_i$ is treated as known for a single Newton step.\n- **Original Residual Equations:**\n  $$\n  R_i^{(c)}(c_e) \\;=\\; \\varepsilon\\,\\frac{c_{e,i} - c_{e,i}^{\\,n}}{\\Delta t} \\;-\\; \\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\left(c_{e,i+1} - 2\\,c_{e,i} + c_{e,i-1}\\right) \\;-\\; \\frac{1 - t_+^0}{F}\\,a_s\\,j_i \\,=\\, 0\n  $$\n  $$\n  R_i^{(e)}(\\phi_e,c_e) \\;=\\; \\frac{\\kappa_{\\mathrm{eff}}}{\\Delta x^2}\\left(\\phi_{e,i+1} - 2\\,\\phi_{e,i} + \\phi_{e,i-1}\\right) \\;+\\; \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}\\left(\\ln c_{e,i+1} - 2\\,\\ln c_{e,i} + \\ln c_{e,i-1}\\right) \\;-\\; a_s\\,j_i \\,=\\, 0\n  $$\n  where $c_{e,i}^{\\,n}$ is the concentration at the previous time level.\n- **Numerical Context:** The system is solved using Newton's method for the unknown vector $u = [\\dots, c_{e,i-1}, c_{e,i}, c_{e,i+1}, \\dots, \\phi_{e,i-1}, \\phi_{e,i}, \\phi_{e,i+1}, \\dots ]^\\top$.\n- **Problem Statement:** It is observed that for $c_{e,i} \\to 0^+$, the Newton step becomes ill-conditioned. A proposed remedy is the change of variables $\\psi_i = \\ln c_{e,i}$, leading to transformed residuals $\\tilde R(\\phi_e,\\psi)$.\n- **Question:** Identify the correct ill-conditioning mechanism, the correct transformed residual system, and the correct Jacobian blocks with respect to $\\psi$.\n\n#### Step 2: Validate Using Extracted Givens\n\n1.  **Scientifically Grounded:** The problem is firmly based on the Doyle-Fuller-Newman (DFN) model, a standard and widely accepted framework in electrochemical engineering for simulating lithium-ion batteries. The equations represent the discretized form of conservation of species and charge in the electrolyte, derived from concentrated solution theory. All aspects are scientifically sound.\n2.  **Well-Posed:** The problem is well-posed. It asks for the verification of a standard numerical technique (change of variables) applied to a standard set of discretized PDEs. The task involves straightforward, albeit detailed, application of calculus (substitution and differentiation/chain rule) to derive the transformed system and its Jacobian. A unique correct answer exists.\n3.  **Objective:** The language is technical, precise, and free of any subjective or opinion-based statements.\n4.  **Completeness & Consistency:** The problem is self-contained. All necessary equations, variable definitions, and context for both the original problem and the proposed transformation are provided. There are no contradictions.\n5.  **Realistic & Feasible:** The issue of ill-conditioning near electrolyte depletion ($c_e \\to 0$) is a well-known practical challenge in battery simulation. The logarithmic transformation of the concentration variable is a common and effective technique used in computational electrochemistry to ensure positivity and improve the conditioning of the numerical problem. The scenario is entirely realistic.\n6.  **Other Flaws:** The problem is not trivial, ill-structured, or based on faulty reasoning. It represents a valid and relevant question in the field of scientific computing applied to battery modeling.\n\n#### Step 3: Verdict and Action\n\nThe problem statement is **valid**. The setup is scientifically sound, mathematically consistent, complete, and relevant. I will now proceed to the solution.\n\n### Derivation and Solution\n\nThe core of the problem is to analyze the Jacobian of the original system, perform the specified change of variables, and compute the Jacobian of the transformed system.\n\n**1. Analysis of Ill-Conditioning in the Original System**\n\nThe Jacobian matrix $J$ for Newton's method contains blocks of partial derivatives of the residuals with respect to the unknown variables. The problem arises near electrolyte depletion, i.e., as $c_{e,i} \\to 0^+$. Let us examine the derivatives of the residuals with respect to the concentration variables $c_{e,j}$.\n\nThe species conservation residual is $R_i^{(c)}$. Its derivatives with respect to $c_{e,j}$ are:\n$$\n\\frac{\\partial R_i^{(c)}}{\\partial c_{e,i}} = \\frac{\\varepsilon}{\\Delta t} + 2\\,\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\n$$\n$$\n\\frac{\\partial R_i^{(c)}}{\\partial c_{e,i \\pm 1}} = -\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\n$$\nThese terms are all constant and well-behaved. They do not cause ill-conditioning as $c_{e,i} \\to 0^+$.\n\nThe charge conservation residual is $R_i^{(e)}$. Its derivatives with respect to $c_{e,j}$ are:\n$$\n\\frac{\\partial R_i^{(e)}}{\\partial c_{e,i}} = \\frac{\\partial}{\\partial c_{e,i}} \\left[ \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}(-2\\,\\ln c_{e,i}) \\right] = \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2} \\left( -\\frac{2}{c_{e,i}} \\right)\n$$\n$$\n\\frac{\\partial R_i^{(e)}}{\\partial c_{e,i \\pm 1}} = \\frac{\\partial}{\\partial c_{e,i \\pm 1}} \\left[ \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}(\\ln c_{e,i \\pm 1}) \\right] = \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2} \\left( \\frac{1}{c_{e,i \\pm 1}} \\right)\n$$\nAs $c_{e,i} \\to 0^+$, the term $\\partial R_i^{(e)} / \\partial c_{e,i}$ blows up, since it is proportional to $1/c_{e,i}$. This leads to extremely large entries in the Jacobian matrix, causing it to become ill-conditioned. The Newton solver attempts to compute a step $\\Delta u = -J^{-1}R$, and an ill-conditioned $J$ can lead to a huge, non-physical update $\\Delta c_{e,i}$ that results in $c_{e,i} + \\Delta c_{e,i} < 0$. This confirms the ill-conditioning mechanism.\n\n**2. Derivation of Transformed Residuals**\n\nThe change of variables is $\\psi_j = \\ln c_{e,j}$, which implies $c_{e,j} = \\exp(\\psi_j)$. We substitute this into the original residual equations to obtain the transformed residuals $\\tilde{R}$.\n\nFor species conservation, $R_i^{(c)}$, we substitute $c_{e,j} = \\exp(\\psi_j)$:\n$$\n\\tilde R_i^{(c)}(\\psi) = \\varepsilon\\,\\frac{\\exp(\\psi_i) - c_{e,i}^{\\,n}}{\\Delta t} \\;-\\; \\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\left(\\exp(\\psi_{i+1}) - 2\\,\\exp(\\psi_i) + \\exp(\\psi_{i-1})\\right) \\;-\\; \\frac{1 - t_+^0}{F}\\,a_s\\,j_i\n$$\nFor charge conservation, $R_i^{(e)}$, we substitute $\\ln c_{e,j} = \\psi_j$:\n$$\n\\tilde R_i^{(e)}(\\phi_e,\\psi) = \\frac{\\kappa_{\\mathrm{eff}}}{\\Delta x^2}\\left(\\phi_{e,i+1} - 2\\,\\phi_{e,i} + \\phi_{e,i-1}\\right) \\;+\\; \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}\\left(\\psi_{i+1} - 2\\,\\psi_i + \\psi_{i-1}\\right) \\;-\\; a_s\\,j_i\n$$\nThese expressions for $\\tilde R_i^{(c)}$ and $\\tilde R_i^{(e)}$ are the correct transformed residuals.\n\n**3. Derivation of Transformed Jacobian Blocks**\n\nWe now compute the partial derivatives of the transformed residuals $\\tilde R_i$ with respect to the new variables $\\psi_j$ for $j \\in \\{i-1, i, i+1\\}$.\n\nDerivatives of $\\tilde R_i^{(c)}$ with respect to $\\psi_j$:\n$$\n\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_i} = \\frac{\\partial}{\\partial \\psi_i} \\left[ \\varepsilon\\,\\frac{e^{\\psi_i}}{\\Delta t} - \\frac{D_{\\mathrm{eff}}}{\\Delta x^2}(-2\\,e^{\\psi_i}) \\right] = \\varepsilon\\,\\frac{e^{\\psi_i}}{\\Delta t} + 2\\,\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\,e^{\\psi_i}\n$$\n$$\n\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_{i+1}} = \\frac{\\partial}{\\partial \\psi_{i+1}} \\left[ -\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\,e^{\\psi_{i+1}} \\right] = -\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\,e^{\\psi_{i+1}}\n$$\n$$\n\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_{i-1}} = \\frac{\\partial}{\\partial \\psi_{i-1}} \\left[ -\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\,e^{\\psi_{i-1}} \\right] = -\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\,e^{\\psi_{i-1}}\n$$\nThese can be compactly written as $\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_{i\\pm 1}} = -\\frac{D_{\\mathrm{eff}}}{\\Delta x^2}\\,e^{\\psi_{i\\pm 1}}$.\n\nDerivatives of $\\tilde R_i^{(e)}$ with respect to $\\psi_j$:\nThe transformed residual $\\tilde R_i^{(e)}$ is now a linear function of $\\psi_j$. Let $K = \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}$. The relevant portion is $K(\\psi_{i+1} - 2\\,\\psi_i + \\psi_{i-1})$.\n$$\n\\frac{\\partial \\tilde R_i^{(e)}}{\\partial \\psi_i} = \\frac{\\partial}{\\partial \\psi_i} \\left[ K(-2\\,\\psi_i) \\right] = -2\\,K = -2\\,\\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}\n$$\n$$\n\\frac{\\partial \\tilde R_i^{(e)}}{\\partial \\psi_{i+1}} = \\frac{\\partial}{\\partial \\psi_{i+1}} \\left[ K(\\psi_{i+1}) \\right] = K = \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}\n$$\n$$\n\\frac{\\partial \\tilde R_i^{(e)}}{\\partial \\psi_{i-1}} = \\frac{\\partial}{\\partial \\psi_{i-1}} \\left[ K(\\psi_{i-1}) \\right] = K = \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}\n$$\nThese can be compactly written as $\\frac{\\partial \\tilde R_i^{(e)}}{\\partial \\psi_{i\\pm 1}} = \\frac{2\\,R\\,T\\,(1 - t_+^0)\\,\\kappa_{\\mathrm{eff}}}{F\\,\\Delta x^2}$.\n\nThe singular term proportional to $1/c_{e,i}$ has been eliminated. The new Jacobian entries for $\\partial \\tilde R_i^{(e)}/\\partial \\psi_j$ are constant. The entries for $\\partial \\tilde R_i^{(c)}/\\partial \\psi_j$ are proportional to $e^{\\psi_j} = c_{e,j}$, which go to zero as $c_{e,j} \\to 0$, which is numerically benign. Furthermore, since $c_{e,j} = \\exp(\\psi_j)$, the concentration is guaranteed to be positive for any real value of $\\psi_j$.\n\n### Option-by-Option Analysis\n\n**A. The ill-conditioning arises because $\\partial R_i^{(e)}/\\partial c_{e,i}$ contains factors proportional to $1/c_{e,i}$ from differentiating $\\ln c_{e,i}$, which blow up as $c_{e,i}\\to 0^+$. The transformed residuals are... The corresponding Jacobian entries...**\n-   **Ill-conditioning mechanism:** My analysis confirms this is the correct cause.\n-   **Transformed residuals:** The expressions for $\\tilde R_i^{(c)}(\\psi)$ and $\\tilde R_i^{(e)}(\\phi_e,\\psi)$ match my derivation perfectly.\n-   **Jacobian entries:** The expressions for $\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_i}$, $\\frac{\\partial \\tilde R_i^{(c)}}{\\partial \\psi_{i\\pm 1}}$, $\\frac{\\partial \\tilde R_i^{(e)}}{\\partial \\psi_i}$, and $\\frac{\\partial \\tilde R_i^{(e)}}{\\partial \\psi_{i\\pm 1}}$ all match my derivation.\n-   **Reasoning:** The explanation that the problematic terms become linear in $\\psi$ and that positivity is guaranteed by $c_{e,i}=\\exp(\\psi_i)$ is correct.\n-   **Verdict:** **Correct**.\n\n**B. The ill-conditioning is due to the diffusion term in $R_i^{(c)}$... The transformed residuals should therefore be...**\n-   **Ill-conditioning mechanism:** This is incorrect. As shown, the problematic term is in $R_i^{(e)}$, not $R_i^{(c)}$.\n-   **Transformed residuals:** The proposed residual $\\tilde R_i^{(c)}$ linearizes the transient and diffusion terms in $\\psi$. This does not correspond to a change of variables in the original conservation law, but rather to discretizing a different, physically inconsistent PDE, e.g., $\\varepsilon \\frac{\\partial \\psi}{\\partial t} = D_{\\mathrm{eff}} \\nabla^2 \\psi + \\dots$. This is a fundamental error.\n-   **Verdict:** **Incorrect**.\n\n**C. The ill-conditioning is caused by the reaction source term... The Jacobian of $\\tilde R_i^{(c)}$ with respect to $\\psi$ is...**\n-   **Ill-conditioning mechanism:** Incorrect. The source term $j_i$ is treated as known and constant for the Jacobian calculation at hand. The ill-conditioning comes from the thermodynamic factor in the electrolyte flux, which leads to the $\\ln c_e$ terms in $R_i^{(e)}$.\n-   **Transformed residuals:** The proposal to \"keep $\\ln c_e$ in $R_i^{(e)}$\" while changing the variable to $\\psi = \\ln c_e$ is mathematically inconsistent. One cannot have both the old variable $c_e$ and the new variable $\\psi$ in the transformed equation set meant to be solved for $\\psi$.\n-   **Jacobian:** The calculation for $\\partial \\tilde R_i^{(c)}/\\partial \\psi_i$ is wrong. It omits the chain rule factor $\\partial(e^{\\psi_i})/\\partial \\psi_i = e^{\\psi_i}$.\n-   **Verdict:** **Incorrect**.\n\n**D. The ill-conditioning is fundamentally due to the discretization stencil; augmenting the residual with a barrier term $+\\mu/\\!c_{e,i}$ suffices... The Jacobian is then... $-\\mu/c_{e,i}^2$, which remains bounded...**\n-   **Ill-conditioning mechanism:** Incorrectly attributed to the \"discretization stencil\" in a vague way. The root cause is the physics encoded in the continuous equations.\n-   **Proposed solution analysis:** While adding a barrier term is a valid numerical strategy (interior-point methods), the analysis is flawed. The derivative of the barrier term is $\\partial(\\mu/c_{e,i})/\\partial c_{e,i} = -\\mu/c_{e,i}^2$. The claim that this \"remains bounded for small $c_{e,i}$\" is false. As $c_{e,i} \\to 0$, $c_{e,i}^2 \\to 0$ and the term $-\\mu/c_{e,i}^2$ diverges to $-\\infty$. This intentional divergence creates the \"barrier\", but the justification provided is mathematically incorrect.\n-   **Verdict:** **Incorrect**.\n\nBased on this comprehensive analysis, only Option A is correct in all its parts: the identification of the problem, the mathematical derivation of the solution, and the resulting Jacobian.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}