{
    "hands_on_practices": [
        {
            "introduction": "在模拟电解质输运之前，我们必须确保仿真网格能够捕捉到关键的物理现象。在带电表面附近，核心物理现象是双电层（EDL）的形成，其特征厚度为德拜长度 $\\lambda_D$。本练习将引导您从基本原理出发，推导出 $\\lambda_D$ 的表达式，并用它来确定晶格玻尔兹曼方法（LBM）模拟所需的最小晶格间距，这是建立任何有物理意义的电化学系统模拟的基本技能。",
            "id": "3923123",
            "problem": "一个锂离子电池隔膜被一种对称二元电解质饱和，其中阳离子和阴离子的化合价均为 $z=1$。你将使用格子玻尔兹曼方法（LBM）进行电解质输运模拟，以研究弱极化电极附近的双电层（EDL）。模拟体系处于无量纲电势 $|z e \\phi/(k_B T)|$ 小到足以进行线性化处理的范围。从基本原理出发，推导EDL的尺度（德拜长度），并用它来设计格子分辨率。\n\n假设电解质温度为 $T=298\\,\\mathrm{K}$，溶剂的相对介电常数为 $\\epsilon_r=30$，盐的体相摩尔浓度为 $C_0=10\\,\\mathrm{mol\\,m^{-3}}$。将电解质视为理想电解质，其阳离子和阴离子的体相数密度均等于 $c_0=N_A C_0$，其中 $N_A$ 是阿伏伽德罗常数。使用以下常数：阿伏伽德罗常数 $N_A=6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$，元电荷 $e=1.602176634\\times 10^{-19}\\,\\mathrm{C}$，真空介电常数 $\\epsilon_0=8.8541878128\\times 10^{-12}\\,\\mathrm{F\\,m^{-1}}$，以及玻尔兹曼常数 $k_B=1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$。绝对介电常数为 $\\epsilon=\\epsilon_r \\epsilon_0$。\n\n任务：\n- 根据高斯定律（泊松方程）和离子物种的玻尔兹曼分布，推导连接电势曲率与电势本身的线性化关系，并确定对称二元电解质的逆屏蔽长度 $\\kappa$。\n- 用 $z$、$e$、$\\epsilon$、$k_B T$ 和 $c_0$ 表示德拜长度 $\\lambda_D$，然后将 $C_0$ 转换为 $c_0$ 并计算 $\\lambda_D$ 的数值。\n- 为了在LBM中充分解析EDL，要求至少有 $N=10$ 个格子节点跨越一个德拜长度。计算最小格子间距 $\\Delta x=\\lambda_D/N$。\n\n只需报告以纳米为单位的最小格子间距 $\\Delta x$，四舍五入到三位有效数字，并以 $\\mathrm{nm}$ 为单位表示。",
            "solution": "该问题要求推导双电层（EDL）的特征长度尺度（即德拜长度），并用它来确定格子玻尔兹曼方法（LBM）模拟所需的格子分辨率。推导从对称二元电解质的静电学和统计力学的基本原理开始。\n\n第一个基本原理是电介质中静电学的高斯定律，其微分形式可以表示为泊松方程。该方程将静电势 $\\phi$ 与局部净电荷密度 $\\rho_e$ 联系起来：\n$$\n\\nabla^2 \\phi = -\\frac{\\rho_e}{\\epsilon}\n$$\n此处，$\\epsilon$ 是电解质溶剂的绝对介电常数，由 $\\epsilon = \\epsilon_r \\epsilon_0$ 给出，其中 $\\epsilon_r$ 是相对介电常数，$\\epsilon_0$ 是真空介电常数。\n\n净电荷密度 $\\rho_e$ 源于阳离子和阴离子的局部不平衡。对于阳离子化合价为 $z$、阴离子化合价为 $-z$ 的对称二元电解质，电荷密度为：\n$$\n\\rho_e = z e c_+ - z e c_- = z e (c_+ - c_-)\n$$\n其中 $e$ 是元电荷，$c_+$ 和 $c_-$ 分别是阳离子和阴离子的局部数密度。该问题指定化合价为 $z=1$。\n\n第二个基本原理是统计力学中的玻尔兹曼分布，它描述了在电势作用下处于热平衡状态的带电物种的数密度。带有电荷 $q_i$ 的离子物种 $i$ 的局部数密度 $c_i$ 由下式给出：\n$$\nc_i(\\mathbf{r}) = c_{i,0} \\exp\\left(-\\frac{q_i \\phi(\\mathbf{r})}{k_B T}\\right)\n$$\n其中 $c_{i,0}$ 是体相数密度（在远离任何带电表面，$\\phi \\to 0$ 的地方），$k_B$ 是玻尔兹曼常数，$T$ 是绝对温度。对于我们的体系，阳离子的电荷为 $q_+ = ze = e$，阴离子的电荷为 $q_- = -ze = -e$。它们的体相数密度相等，$c_{+,0} = c_{-,0} = c_0$。因此，它们的局部密度为：\n$$\nc_+ = c_0 \\exp\\left(-\\frac{e\\phi}{k_B T}\\right)\n$$\n$$\nc_- = c_0 \\exp\\left(+\\frac{e\\phi}{k_B T}\\right)\n$$\n将这些表达式代入电荷密度方程，得到：\n$$\n\\rho_e = e c_0 \\left[ \\exp\\left(-\\frac{e\\phi}{k_B T}\\right) - \\exp\\left(\\frac{e\\phi}{k_B T}\\right) \\right]\n$$\n使用双曲正弦函数的定义 $\\sinh(x) = (\\exp(x) - \\exp(-x))/2$，上式可简化为：\n$$\n\\rho_e = -2 e c_0 \\sinh\\left(\\frac{e\\phi}{k_B T}\\right)\n$$\n将这个 $\\rho_e$ 的表达式代入泊松方程，得到完整的泊松-玻尔兹曼方程：\n$$\n\\nabla^2 \\phi = \\frac{2 e c_0}{\\epsilon} \\sinh\\left(\\frac{e\\phi}{k_B T}\\right)\n$$\n该问题指定了弱极化电极的条件，这为线性化处理提供了依据。这对应于无量纲电势很小的体系，即 $|z e \\phi / (k_B T)| \\ll 1$。当 $z=1$ 时，即为 $|e \\phi / (k_B T)| \\ll 1$。对于小自变量 $x$，$\\sinh(x)$ 的泰勒级数展开为 $\\sinh(x) \\approx x$。应用此近似，我们得到：\n$$\n\\nabla^2 \\phi \\approx \\frac{2 e c_0}{\\epsilon} \\left(\\frac{e\\phi}{k_B T}\\right) = \\left(\\frac{2 e^2 c_0}{\\epsilon k_B T}\\right) \\phi\n$$\n这就是线性化的泊松-玻尔兹曼方程，也称为德拜-休克尔方程。它是一个将电势的曲率与电势本身联系起来的线性偏微分方程。该方程通常写成：\n$$\n\\nabla^2 \\phi = \\kappa^2 \\phi\n$$\n通过比较这两种形式，我们确定逆屏蔽长度的平方 $\\kappa^2$ 为：\n$$\n\\kappa^2 = \\frac{2 e^2 c_0}{\\epsilon k_B T}\n$$\n对于化合价为 $z$ 的对称电解质的一般情况，此式为 $\\kappa^2 = \\frac{2 z^2 e^2 c_0}{\\epsilon k_B T}$。\n\n德拜长度 $\\lambda_D$ 是电势衰减的特征长度尺度。它被定义为逆屏蔽长度 $\\kappa$ 的倒数：\n$$\n\\lambda_D = \\frac{1}{\\kappa} = \\sqrt{\\frac{\\epsilon k_B T}{2 e^2 c_0}}\n$$\n由于给定的化合价 $z=1$，此公式可直接应用。\n\n现在，我们计算 $\\lambda_D$ 的数值。我们有以下给定值：\n温度 $T = 298\\,\\mathrm{K}$\n相对介电常数 $\\epsilon_r = 30$\n体相摩尔浓度 $C_0 = 10\\,\\mathrm{mol\\,m^{-3}}$\n化合价 $z = 1$\n阿伏伽德罗常数 $N_A = 6.02214076 \\times 10^{23}\\,\\mathrm{mol^{-1}}$\n元电荷 $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\n真空介电常数 $\\epsilon_0 = 8.8541878128 \\times 10^{-12}\\,\\mathrm{F\\,m^{-1}}$\n玻尔兹曼常数 $k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$\n\n首先，我们计算体相数密度 $c_0$：\n$$\nc_0 = C_0 N_A = (10\\,\\mathrm{mol\\,m^{-3}}) \\times (6.02214076 \\times 10^{23}\\,\\mathrm{mol^{-1}}) = 6.02214076 \\times 10^{24}\\,\\mathrm{m^{-3}}\n$$\n接下来，我们计算绝对介电常数 $\\epsilon$：\n$$\n\\epsilon = \\epsilon_r \\epsilon_0 = 30 \\times (8.8541878128 \\times 10^{-12}\\,\\mathrm{F\\,m^{-1}}) = 2.65625634384 \\times 10^{-10}\\,\\mathrm{F\\,m^{-1}}\n$$\n现在，我们可以将所有数值代入德拜长度的表达式中：\n$$\n\\lambda_D = \\sqrt{\\frac{(2.656256... \\times 10^{-10}\\,\\mathrm{F\\,m^{-1}}) \\times (1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) \\times (298\\,\\mathrm{K})}{2 \\times (1)^2 \\times (1.602176634 \\times 10^{-19}\\,\\mathrm{C})^2 \\times (6.02214076 \\times 10^{24}\\,\\mathrm{m^{-3}})}}\n$$\n分别计算分子和分母：\n分子：$\\epsilon k_B T \\approx 1.092683 \\times 10^{-30}\\,\\mathrm{J\\,F\\,m^{-1}}$\n分母：$2 e^2 c_0 \\approx 3.091901 \\times 10^{-13}\\,\\mathrm{C^2\\,m^{-3}}$\n$$\n\\lambda_D^2 = \\frac{1.092683 \\times 10^{-30}}{3.091901 \\times 10^{-13}}\\,\\mathrm{m^2} \\approx 3.53399 \\times 10^{-18}\\,\\mathrm{m^2}\n$$\n$$\n\\lambda_D = \\sqrt{3.53399 \\times 10^{-18}\\,\\mathrm{m^2}} \\approx 1.87989 \\times 10^{-9}\\,\\mathrm{m}\n$$\n\n最后的任务是确定解析EDL所需的格子间距 $\\Delta x$。问题陈述要求至少有 $N=10$ 个格子节点跨越一个德拜长度。这给出了格子间距的如下关系式：\n$$\n\\Delta x = \\frac{\\lambda_D}{N}\n$$\n代入计算出的 $\\lambda_D$ 值和所需的节点数 $N=10$：\n$$\n\\Delta x = \\frac{1.87989 \\times 10^{-9}\\,\\mathrm{m}}{10} = 1.87989 \\times 10^{-10}\\,\\mathrm{m}\n$$\n问题要求答案以纳米（$\\mathrm{nm}$）为单位，其中 $1\\,\\mathrm{nm} = 10^{-9}\\,\\mathrm{m}$：\n$$\n\\Delta x = (1.87989 \\times 10^{-10}\\,\\mathrm{m}) \\times \\left(\\frac{1\\,\\mathrm{nm}}{10^{-9}\\,\\mathrm{m}}\\right) = 0.187989\\,\\mathrm{nm}\n$$\n四舍五入到三位有效数字，最小格子间距为 $0.188\\,\\mathrm{nm}$。",
            "answer": "$$\n\\boxed{0.188}\n$$"
        },
        {
            "introduction": "在确定了需要解析的物理长度尺度后，理解我们所使用的数值方法——莱迪思玻尔兹曼方法（LBM）——在这些尺度上的行为至关重要。通过研究单个傅里叶模式在 LBM 格式下的演化，我们可以分析其精度和稳定性，这种技术被称为冯·诺依曼稳定性分析，它揭示了数值扩散和色散等离散化误差的本质。本练习将要求您推导一个简化的 LBM 格式的傅里叶放大因子，这将让您深入理解该方法的内在属性及其与所要模拟的连续介质扩散方程之间的对应关系。",
            "id": "3923099",
            "problem": "考虑在多孔电极内，沿一维周期性通道的无对流电解质浓度输运，该过程通过标量格子玻尔兹曼方法 (LBM) 进行建模，其中使用设置为单位1的单弛豫时间 Bhatnagar–Gross–Krook (BGK) 碰撞算子。离散速度集为一维三速模型 (D1Q3)，其速度为 $c_{0} = 0$、$c_{+} = +c$、$c_{-} = -c$，其中 $c = \\Delta x / \\Delta t$，格子间距为 $\\Delta x$，时间步长为 $\\Delta t$。平衡分布函数为 $f_{i}^{\\mathrm{eq}}(x,t) = w_{i} \\,\\phi(x,t)$，权重为 $w_{0} = 2/3$ 和 $w_{+} = w_{-} = 1/6$，宏观电解质浓度为 $\\phi(x,t) = \\sum_{i \\in \\{0,+,-\\}} f_{i}(x,t)$。在单个时间步长内的更新过程包括向平衡态的碰撞和随后的精确迁移：\n- 碰撞：$f_{i}^{\\star}(x,t) = f_{i}^{\\mathrm{eq}}(x,t)$，对于所有 $i \\in \\{0,+,-\\}$。\n- 迁移：$f_{0}(x,t+\\Delta t) = f_{0}^{\\star}(x,t)$，$f_{+}(x,t+\\Delta t) = f_{+}^{\\star}(x-\\Delta x,t)$，$f_{-}(x,t+\\Delta t) = f_{-}^{\\star}(x+\\Delta x,t)$。\n\n假设浓度场为傅里叶模式 $\\phi(x,t) = \\hat{\\phi}(t)\\,\\exp(i k x)$，其中波数为 $k$，复振幅为 $\\hat{\\phi}(t)$。从上述 LBM 更新规则和宏观场的定义出发，推导傅里叶放大因子 $G(k)$，使得 $\\hat{\\phi}(t+\\Delta t) = G(k)\\,\\hat{\\phi}(t)$。然后，使用连续介质扩散模型 $\\partial_{t}\\phi = D\\,\\partial_{xx}\\phi$（扩散系数 $D = (c^{2}\\Delta t)/6$ 对应于此模型上 BGK 弛豫等于1的情况），将 $G(k)$ 与精确的扩散放大因子 $\\exp(-D k^{2}\\Delta t)$ 进行关联，并确定该格式是否对任意 $k$ 引入相位误差，以及在小 $k$ 值下其振幅误差与精确扩散放大因子相比如何。\n\n将最终的傅里叶放大因子 $G(k)$ 表示为 $k$ 和 $\\Delta x$ 的闭式解析表达式。无需取整。最终答案是无量纲的；不包含单位。",
            "solution": "我们从 D1Q3 模型的标量格子玻尔兹曼方法 (LBM) 的碰撞-迁移更新步骤开始。对于单弛豫时间 Bhatnagar–Gross–Krook (BGK) 设置为1的无对流电解质输运，碰撞步骤将分布函数映射到其平衡态，\n$$\nf_{i}^{\\star}(x,t) = f_{i}^{\\mathrm{eq}}(x,t) = w_{i}\\,\\phi(x,t),\n$$\n其中 $w_{0} = 2/3$，$w_{+} = w_{-} = 1/6$。随后的迁移步骤将每个碰撞后的粒子群沿其速度方向输运：\n$$\n\\begin{aligned}\nf_{0}(x,t+\\Delta t) = f_{0}^{\\star}(x,t),\\\\\nf_{+}(x,t+\\Delta t) = f_{+}^{\\star}(x-\\Delta x,t),\\\\\nf_{-}(x,t+\\Delta t) = f_{-}^{\\star}(x+\\Delta x,t),\n\\end{aligned}\n$$\n其中 $c = \\Delta x/\\Delta t$ 是一维格子速度。迁移后的宏观浓度是迁移后的碰撞后分布函数之和，\n$$\n\\phi(x,t+\\Delta t) = f_{0}(x,t+\\Delta t) + f_{+}(x,t+\\Delta t) + f_{-}(x,t+\\Delta t).\n$$\n将碰撞输出代入迁移更新步骤，并使用平衡态的定义，我们得到\n$$\n\\phi(x,t+\\Delta t) = w_{0}\\,\\phi(x,t) + w_{+}\\,\\phi(x-\\Delta x,t) + w_{-}\\,\\phi(x+\\Delta x,t).\n$$\n为进行冯·诺依曼（傅里叶）分析，假设浓度场为傅里叶模式，\n$$\n\\phi(x,t) = \\hat{\\phi}(t)\\,\\exp(i k x),\n$$\n其中波数为 $k$，复振幅为 $\\hat{\\phi}(t)$。在周期性空间域中，指数函数的位移性质意味着\n$$\n\\phi(x \\mp \\Delta x,t) = \\hat{\\phi}(t)\\,\\exp(i k (x \\mp \\Delta x)) = \\hat{\\phi}(t)\\,\\exp(i k x)\\,\\exp(\\mp i k \\Delta x).\n$$\n因此，\n$$\n\\phi(x,t+\\Delta t) = \\hat{\\phi}(t)\\,\\exp(i k x)\\left[w_{0} + w_{+}\\,\\exp(-i k \\Delta x) + w_{-}\\,\\exp(+i k \\Delta x)\\right].\n$$\n通过 $\\hat{\\phi}(t+\\Delta t) = G(k)\\,\\hat{\\phi}(t)$ 定义傅里叶放大因子 $G(k)$。比较 $\\exp(i k x)$ 的系数，我们得到\n$$\nG(k) = w_{0} + w_{+}\\,\\exp(-i k \\Delta x) + w_{-}\\,\\exp(+i k \\Delta x).\n$$\n使用特定权重 $w_{0} = 2/3$ 和 $w_{\\pm} = 1/6$，上式可简化为\n$$\nG(k) = \\frac{2}{3} + \\frac{1}{6}\\left[\\exp(-i k \\Delta x) + \\exp(+i k \\Delta x)\\right] = \\frac{2}{3} + \\frac{1}{3}\\cos(k \\Delta x) = \\frac{2 + \\cos(k \\Delta x)}{3}.\n$$\n对于 BGK 弛豫等于1的指定格式，该表达式是精确的。\n\n我们现在将其与扩散方程 $\\partial_{t}\\phi = D\\,\\partial_{xx}\\phi$ 的精确连续介质扩散放大因子联系起来。傅里叶模式拟设 $\\phi(x,t) = \\hat{\\phi}(t)\\exp(i k x)$ 产生精确的时间演化\n$$\n\\hat{\\phi}(t+\\Delta t) = \\exp(-D k^{2}\\Delta t)\\,\\hat{\\phi}(t).\n$$\n对于 BGK 参数等于1的 D1Q3 格式，相应的扩散系数为 $D = \\frac{c^{2}\\Delta t}{6}$，这是该模型下标量 LBM 的一个经过充分检验的结果。使用 $c = \\Delta x/\\Delta t$，我们可以写出 $D k^{2}\\Delta t = \\frac{(\\Delta x)^{2}k^{2}}{6} = \\frac{(k \\Delta x)^{2}}{6}$。因此，精确的连续介质放大因子是\n$$\n\\exp\\!\\left(-\\frac{(k \\Delta x)^{2}}{6}\\right).\n$$\n为评估相位和振幅误差，我们将 $G(k)$ 与这个精确放大因子进行比较。首先，$G(k)$ 对于所有实数 $k$ 都是实数且非负的，因为它与经过平移和缩放的 $\\cos(k \\Delta x)$ 成正比；因此，LBM 不引入相位误差（$G(k)$ 的辐角为零）。其次，对于小的 $|k \\Delta x|$，将两个表达式进行泰勒级数展开：\n$$\nG(k) = \\frac{2 + \\cos(k \\Delta x)}{3} = 1 - \\frac{(k \\Delta x)^{2}}{6} + \\frac{(k \\Delta x)^{4}}{72} - \\frac{(k \\Delta x)^{6}}{2160} + \\cdots,\n$$\n$$\n\\exp\\!\\left(-\\frac{(k \\Delta x)^{2}}{6}\\right) = 1 - \\frac{(k \\Delta x)^{2}}{6} + \\frac{(k \\Delta x)^{4}}{72} - \\frac{(k \\Delta x)^{6}}{1296} + \\cdots.\n$$\n前两项匹配，因此对于振幅衰减，该格式在空间和时间上都是二阶精确的。第一个差异出现在 $(k \\Delta x)^{6}$ 阶，其中 LBM 的衰减系数 $-1/2160$ 与精确值 $-1/1296$ 不同。因此，对于小波数，振幅误差为 $O\\!\\left((k \\Delta x)^{6}\\right)$，并且在这种无对流的情况下，该格式是非色散的（无相位误差）。\n\n因此，所求的闭式傅里叶放大因子为\n$$\nG(k) = \\frac{2 + \\cos(k \\Delta x)}{3}.\n$$",
            "answer": "$$\\boxed{\\frac{2+\\cos(k\\,\\Delta x)}{3}}$$"
        },
        {
            "introduction": "在掌握了物理需求和数值工具的特性之后，最后一步是验证我们代码实现的正确性。“人造解方法”（Method of Manufactured Solutions, MMS）是一种严谨的程序验证技术，我们通过构建一个解析解，并在控制方程中添加相应的源项，使得数值解与人造解之间的误差能够精确地衡量代码的精度。这项动手编程实践将指导您完成一个泊松-能斯特-普朗克（PNP）方程求解器的完整验证流程，您将实现一个 LBM 求解器，计算收敛速率，并确认您的代码达到了预期的理论精度。",
            "id": "3923131",
            "problem": "您的任务是实现一种一维、双组分格子玻尔兹曼方法（LBM），用于对 Poisson–Nernst–Planck（PNP）系统进行人造解验证。该系统用于模拟自动化电池设计和仿真中的电解质输运。目标是通过细化空间步长 $\\Delta x$ 和时间步长 $\\Delta t$ 来计算网格收敛率，并验证预期的精度阶数。\n\n从以下适用于此背景的基本原理开始：\n\n- 对于离子浓度 $c_{+}(x,t)$ 和 $c_{-}(x,t)$（价态为 $z_{+}=+1$ 和 $z_{-}=-1$）以及电势 $\\phi(x,t)$，在具有周期性边界条件的空间域 $x \\in [0,1]$ 上的无量纲 Poisson–Nernst–Planck（PNP）系统为：\n$$\n\\partial_t c_{\\pm}(x,t) = \\partial_x\\left( D \\,\\partial_x c_{\\pm}(x,t) \\pm c_{\\pm}(x,t) \\,\\partial_x \\phi(x,t) \\right) + S_{\\pm}(x,t),\n$$\n$$\n-\\,\\partial_{xx} \\phi(x,t) = c_{+}(x,t) - c_{-}(x,t) + S_{\\phi}(x,t),\n$$\n其中，$D$ 是一个正常数扩散系数，$S_{\\pm}(x,t)$ 和 $S_{\\phi}(x,t)$ 是人造源项，其选择方式能确保精确满足一个预设的解析解。\n\n- 对于带源项的 D1Q3 格子玻尔兹曼方法（LBM），其离散速度为 $v_0=0$, $v_1=+1$, $v_2=-1$，权重为 $w_0=\\frac{2}{3}$, $w_1=w_2=\\frac{1}{6}$，流体动力学（扩散）极限通过经过充分测试的映射关系恢复目标扩散系数：\n$$\nD = c_s^2 \\left(\\tau - \\tfrac{1}{2}\\right) \\frac{\\Delta x^2}{\\Delta t},\n$$\n其中 $c_s^2=\\frac{1}{3}$ 是格子声速的平方，$\\tau$ 是单弛豫时间 Bhatnagar–Gross–Krook (BGK) 参数，为保证稳定性需满足 $\\tau > \\tfrac{1}{2}$。\n\n在 $x \\in [0,1]$ 上构造一个精确、光滑的周期解，形式如下：\n$$\nc_{+}^{\\mathrm{ex}}(x,t) = 1 + a \\,\\sin(k x)\\,\\cos(\\omega t),\\quad\nc_{-}^{\\mathrm{ex}}(x,t) = 1 + a \\,\\cos(k x)\\,\\sin(\\omega t),\\quad\n\\phi^{\\mathrm{ex}}(x,t) = b\\,\\sin(k x)\\,\\sin(\\omega t),\n$$\n其中常数 $a>0$, $b>0$, $k=2\\pi$, $\\omega=\\pi$。选择无量纲的 $D>0$。定义源项：\n$$\nS_{\\pm}(x,t) = \\partial_t c_{\\pm}^{\\mathrm{ex}}(x,t) - \\partial_x\\left( D\\,\\partial_x c_{\\pm}^{\\mathrm{ex}}(x,t) \\pm c_{\\pm}^{\\mathrm{ex}}(x,t) \\,\\partial_x \\phi^{\\mathrm{ex}}(x,t) \\right),\n$$\n$$\nS_{\\phi}(x,t) = -\\partial_{xx} \\phi^{\\mathrm{ex}}(x,t) - \\left(c_{+}^{\\mathrm{ex}}(x,t) - c_{-}^{\\mathrm{ex}}(x,t)\\right),\n$$\n使得 $\\left(c_{+}^{\\mathrm{ex}},c_{-}^{\\mathrm{ex}},\\phi^{\\mathrm{ex}}\\right)$ 是带强制项的 PNP 系统的一个精确解。\n\n实现两个独立的 D1Q3 LBM 求解器（一个用于 $c_{+}$，一个用于 $c_{-}$），使用人造源项来演化浓度。在宏观平衡中：\n$$\n\\partial_t c_{\\pm} = D\\,\\partial_{xx} c_{\\pm} + R_{\\pm}(x,t),\n$$\n使用\n$$\nR_{\\pm}(x,t) \\equiv S_{\\pm}(x,t) + \\partial_x\\big(\\pm c_{\\pm}^{\\mathrm{ex}}(x,t)\\,\\partial_x \\phi^{\\mathrm{ex}}(x,t)\\big) = \\partial_t c_{\\pm}^{\\mathrm{ex}}(x,t) - D\\,\\partial_{xx} c_{\\pm}^{\\mathrm{ex}}(x,t),\n$$\n该项仅依赖于 $c_{\\pm}^{\\mathrm{ex}}$ 并确保人造解得以满足。在 $t=0$ 时，通过与 $c_{\\pm}^{\\mathrm{ex}}(x,0)$ 达到平衡来初始化分布函数，并使用周期性边界条件将其推进到最终时间 $T$。在 $t=T$ 时，计算每个组分的空间离散 $\\ell^2$ 误差，并报告两个组分的平均值：\n$$\nE(N,\\Delta t) = \\frac{1}{2}\\left( \\sqrt{\\frac{1}{N}\\sum_{j=0}^{N-1}\\left[c_{+}(x_j,T)-c_{+}^{\\mathrm{ex}}(x_j,T)\\right]^2} \\;+\\; \\sqrt{\\frac{1}{N}\\sum_{j=0}^{N-1}\\left[c_{-}(x_j,T)-c_{-}^{\\mathrm{ex}}(x_j,T)\\right]^2} \\right),\n$$\n其中 $x_j=j\\,\\Delta x$，对于 $j=0,1,\\dots,N-1$ 且 $\\Delta x=1/N$。\n\n通过细化 $\\Delta x$（空间收敛）和 $\\Delta t$（时间收敛）来计算观测到的网格收敛率。通过两次连续的细化（步长为 $\\Delta x_1$ 和 $\\Delta x_2$）定义估算的空间阶数 $p$：\n$$\np \\approx \\frac{\\log\\left(E(N_1,\\Delta t_1)/E(N_2,\\Delta t_2)\\right)}{\\log\\left(\\Delta x_1/\\Delta x_2\\right)},\n$$\n以及通过两次连续的细化（步长为 $\\Delta t_1$ 和 $\\Delta t_2$）定义估算的时间阶数 $q$：\n$$\nq \\approx \\frac{\\log\\left(E(N,\\Delta t_1)/E(N,\\Delta t_2)\\right)}{\\log\\left(\\Delta t_1/\\Delta t_2\\right)}.\n$$\n对于这种显式源项注入的 D1Q3 BGK 格式，预期的精度阶数在空间上为 $p \\approx 2$，在时间上为 $q \\approx 1$。\n\n使用以下科学上一致的测试套件：\n\n- 空间细化（理想情况）：\n  - $L=1$, $D=0.01$, $a=0.10$, $b=0.05$, $k=2\\pi$, $\\omega=\\pi$, $T=0.01$。\n  - $N \\in \\{64,128,256\\}$ 且 $\\Delta x=1/N$。\n  - 设置 $\\Delta t = \\kappa\\,\\Delta x^2$ 且 $\\kappa=0.20$ 以使 $\\tau = \\tfrac{1}{2} + \\dfrac{D\\,\\Delta t}{c_s^2\\,\\Delta x^2}$ 与 $N$ 无关且略大于 $\\tfrac{1}{2}$。\n  - 使用配对 $(N_1,N_2)=(128,256)$ 估算 $p$。\n\n- 时间细化（关注时间阶数）：\n  - $L=1$, $D=0.01$, $a=0.10$, $b=0.05$, $k=2\\pi$, $\\omega=\\pi$, $T=0.01$。\n  - 固定 $N=256$ 并细化 $\\Delta t \\in \\{10^{-4},\\,5\\times 10^{-5},\\,2.5\\times 10^{-5}\\}$。\n  - 对于每个 $\\Delta t$，重新计算 $\\tau = \\tfrac{1}{2} + \\dfrac{D\\,\\Delta t}{c_s^2\\,\\Delta x^2}$ 以维持目标 $D$。\n  - 使用配对 $(\\Delta t_1,\\Delta t_2)=(10^{-4},\\,5\\times 10^{-5})$ 估算 $q$。\n\n- 稳定性边界情况：\n  - $L=1$, $D=0.01$, $a=0.10$, $b=0.05$, $k=2\\pi$, $\\omega=\\pi$, $T=0.01$, $N=32$。\n  - 选择 $\\tau=0.51$ 并计算 $\\Delta t=\\left(\\tau-\\tfrac{1}{2}\\right)\\dfrac{c_s^2\\,\\Delta x^2}{D}$。\n  - 报告一个布尔值，指示模拟是否保持数值稳定（无溢出或非有限值，并且最终平均误差 $E(N,\\Delta t)$ 小于 $1.0$）。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，即 $[p,q,\\text{stable}]$，其中 $p$ 和 $q$ 是浮点数，$\\text{stable}$ 是一个布尔字面量。所有量都是无量纲的，因此输出中不需要物理单位。",
            "solution": "问题要求实现并验证一个用于 Poisson-Nernst-Planck (PNP) 系统的一维、双组分格子玻尔兹曼方法 (LBM)。验证采用人造解方法进行，该方法可以精确计算数值误差和收敛率。\n\n总体策略是解耦 PNP 系统。我们不求解浓度 $c_{\\pm}$ 和电势 $\\phi$ 的耦合系统，而是使用给定的 $\\phi^{\\text{ex}}(x,t)$ 和 $c_{\\pm}^{\\text{ex}}(x,t)$ 的精确解析解，为每个组分（$c_+$ 和 $c_-$）的简单平流-扩散-反应方程计算一个等效源项。这将问题简化为为带已知源项的线性平流-扩散方程实现两个独立的 LBM 求解器。\n\n### 1. 人造解与源项\n\n问题提供了在周期域 $x \\in [0,1]$ 上的浓度 $c_{\\pm}^{\\mathrm{ex}}$ 和电势 $\\phi^{\\mathrm{ex}}$ 的人造解：\n$$\n\\begin{align*}\nc_{+}^{\\mathrm{ex}}(x,t) = 1 + a \\sin(k x)\\cos(\\omega t) \\\\\nc_{-}^{\\mathrm{ex}}(x,t) = 1 + a \\cos(k x)\\sin(\\omega t) \\\\\n\\phi^{\\mathrm{ex}}(x,t) = b \\sin(k x)\\sin(\\omega t)\n\\end{align*}\n$$\n其中常数 $k=2\\pi$ 和 $\\omega=\\pi$。\n\n控制 PNP 方程为：\n$$\n\\partial_t c_{\\pm} = \\partial_x\\left( D \\partial_x c_{\\pm} \\pm c_{\\pm} \\partial_x \\phi \\right) + S_{\\pm} = D \\partial_{xx} c_{\\pm} \\pm \\partial_x (c_{\\pm} \\partial_x \\phi) + S_{\\pm}\n$$\n问题通过将 Nernst-Planck 漂移项 $\\pm \\partial_x (c_{\\pm} \\partial_x \\phi)$ 移到右侧并与人造源项 $S_{\\pm}$ 合并来简化此过程。在此项中使用精确解 $c_{\\pm}^{\\mathrm{ex}}$ 和 $\\phi^{\\mathrm{ex}}$。这为 LBM 求解器产生了一个目标方程，其形式为带有效源项 $R_{\\pm}(x,t)$ 的扩散方程：\n$$\n\\partial_t c_{\\pm} = D\\,\\partial_{xx} c_{\\pm} + R_{\\pm}(x,t)\n$$\n有效源项 $R_{\\pm}$ 是通过将人造解代入原始 PNP 系统推导出来的，确保 $c_{\\pm}^{\\mathrm{ex}}$ 是精确解。\n$$\nR_{\\pm}(x,t) = \\partial_t c_{\\pm}^{\\mathrm{ex}}(x,t) - D\\,\\partial_{xx} c_{\\pm}^{\\mathrm{ex}}(x,t)\n$$\n我们计算 $c_{\\pm}^{\\mathrm{ex}}(x,t)$ 的必要导数：\n对于 $c_{+}^{\\mathrm{ex}}(x,t)$:\n$$\n\\begin{align*}\n\\partial_t c_{+}^{\\mathrm{ex}}(x,t) = -a \\omega \\sin(k x)\\sin(\\omega t) \\\\\n\\partial_{xx} c_{+}^{\\mathrm{ex}}(x,t) = -a k^2 \\sin(k x)\\cos(\\omega t)\n\\end{align*}\n$$\n因此，正离子的源项为：\n$$\nR_{+}(x,t) = a \\sin(k x) \\left[ D k^2 \\cos(\\omega t) - \\omega \\sin(\\omega t) \\right]\n$$\n对于 $c_{-}^{\\mathrm{ex}}(x,t)$:\n$$\n\\begin{align*}\n\\partial_t c_{-}^{\\mathrm{ex}}(x,t) = a \\omega \\cos(k x)\\cos(\\omega t) \\\\\n\\partial_{xx} c_{-}^{\\mathrm{ex}}(x,t) = -a k^2 \\cos(k x)\\sin(\\omega t)\n\\end{align*}\n$$\n因此，负离子的源项为：\n$$\nR_{-}(x,t) = a \\cos(k x) \\left[ \\omega \\cos(\\omega t) + D k^2 \\sin(\\omega t) \\right]\n$$\n\n### 2. 带源项的 D1Q3 格子玻尔兹曼方法\n\n我们对每个组分采用 D1Q3 LBM 格式。D1Q3 格子在格子单位下有三个离散速度 $e_0=0, e_1=+1, e_2=-1$，以及相应的权重 $w_0=2/3, w_1=1/6, w_2=1/6$。LBM 通过一系列碰撞和迁移步骤来演化粒子分布函数 $f_i(x,t)$。\n\n宏观浓度通过对分布函数求和来恢复：$c(x,t) = \\sum_{i=0}^{2} f_i(x,t)$。\n\n扩散过程（宏观速度为零）的平衡分布由以下公式给出：\n$$\nf_i^{\\mathrm{eq}}(c) = w_i c\n$$\n\n带有 BGK 碰撞算子和源项的 LBM 算法在每个时间步长 $\\Delta t$ 内实现为两步过程：\n\n**1. 碰撞与力项：** 在此步骤中，分布函数向平衡态弛豫，并受到源项的影响。\n$$\nf_i^*(x,t) = f_i(x,t) - \\frac{1}{\\tau} \\left[ f_i(x,t) - f_i^{\\mathrm{eq}}(c(x,t)) \\right] + \\Delta t F_i(x,t)\n$$\n其中 $\\tau$ 是弛豫时间。选择离散源项 $F_i$ 以便在求和时恢复宏观源项 $R(x,t)$，即 $\\sum_i F_i = R$。一个不引入伪动量的标准选择是 $F_i = w_i R$。因此，碰撞后、施加力项后的分布为：\n$$\nf_i^*(x,t) = f_i(x,t) - \\frac{1}{\\tau} \\left[ f_i(x,t) - f_i^{\\mathrm{eq}}(c(x,t)) \\right] + w_i R(x,t) \\Delta t\n$$\n\n**2. 迁移：** 粒子根据其速度移动到相邻的格点。\n$$\nf_i(x+e_i\\Delta x, t+\\Delta t) = f_i^*(x,t)\n$$\n对于大小为 $N$ 的网格上的周期性边界条件，这可以通过循环移位（例如 `numpy.roll`）来高效实现。\n\n弛豫时间 $\\tau$ 通过以下公式与物理扩散系数 $D$ 相关：\n$$\nD = c_s^2 \\left(\\tau - \\frac{1}{2}\\right) \\frac{\\Delta x^2}{\\Delta t}\n$$\n其中 $c_s^2=1/3$ 是格子声速的平方。此关系用于根据模拟参数设置 $\\tau$。\n\n### 3. 仿真与验证流程\n\n整个模拟过程如下：\n1.  **初始化：** 在 $t=0$ 时，根据精确浓度 $c_{\\pm}^{\\mathrm{ex}}(x,0)$，将分布函数 $f_i(x,0)$ 初始化为其平衡值。\n2.  **时间步进：** LBM 模拟推进若干步，即 `n_steps`。一个重要的细节是步数 $T/\\Delta t$ 可能不是整数。我们使用 `n_steps = round(T/dt)` 并将最终模拟时间定义为 $T_{\\mathrm{final}} = \\text{n\\_steps} \\times \\Delta t$。精确解在该 $T_{\\mathrm{final}}$ 处进行评估，以确保一致的误差计算。在每一步中，源项 $R(x,t)$ 在时间区间的开始处，$t_n = n \\Delta t$，进行评估。\n3.  **误差计算：** 在 $t=T_{\\mathrm{final}}$ 时，计算数值浓度 $c_{\\pm}(x,T_{\\mathrm{final}})$。根据 $E(N,\\Delta t)$ 的公式，计算每个组分的离散 $\\ell^2$ 误差，然后取平均值。\n4.  **收敛率计算：** 通过使用系统细化的网格间距 $\\Delta x$ 或时间步长 $\\Delta t$ 运行模拟，使用提供的对数公式计算观测到的精度阶数 $p$（空间）和 $q$（时间）。\n\n此过程应用于三个测试用例：\n-   **空间细化：** 将 $N$ 从 $128$ 细化到 $256$，$\\Delta t$ 按 $\\kappa \\Delta x^2$ 缩放以保持 $\\tau$ 不变。这可以分离出空间离散化误差，预期为二阶（$p\\approx 2$）。\n-   **时间细化：** 在固定的 $N=256$ 条件下，将 $\\Delta t$ 从 $10^{-4}$ 细化到 $5\\times 10^{-5}$。这可以分离出时间离散化误差，对于这种显式 LBM 格式，预期为一阶（$q\\approx 1$）。\n-   **稳定性边界：** 使用接近稳定性极限 $\\tau=0.5$ 的参数（$N=32$, $\\tau=0.51$）运行模拟。通过检查解中是否存在非有限值，并确保最终误差低于一个宽泛的阈值 $1.0$ 来评估稳定性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to perform LBM verification for the PNP system.\n    It solves three test cases: spatial convergence, temporal convergence,\n    and a stability edge case.\n    \"\"\"\n\n    # --- Problem Constants ---\n    k_val = 2.0 * np.pi\n    omega_val = np.pi\n    D_val = 0.01\n    a_val = 0.10\n    b_val = 0.05\n    T_val = 0.01\n    cs2 = 1.0 / 3.0\n    w = np.array([2.0/3.0, 1.0/6.0, 1.0/6.0])\n\n    # --- Analytic Functions for Manufactured Solution ---\n    \n    def c_plus_ex(x, t, a=a_val, k=k_val, omega=omega_val):\n        return 1.0 + a * np.sin(k * x) * np.cos(omega * t)\n\n    def c_minus_ex(x, t, a=a_val, k=k_val, omega=omega_val):\n        return 1.0 + a * np.cos(k * x) * np.sin(omega * t)\n\n    def R_plus(x, t, a=a_val, D=D_val, k=k_val, omega=omega_val):\n        term1 = -a * omega * np.sin(k * x) * np.sin(omega * t)\n        term2 = a * D * k**2 * np.sin(k * x) * np.cos(omega * t)\n        return term1 + term2\n\n    def R_minus(x, t, a=a_val, D=D_val, k=k_val, omega=omega_val):\n        term1 = a * omega * np.cos(k * x) * np.cos(omega * t)\n        term2 = a * D * k**2 * np.cos(k * x) * np.sin(omega * t)\n        return term1 + term2\n\n    analytic_funcs = {\n        'plus': {'c_ex': c_plus_ex, 'R': R_plus},\n        'minus': {'c_ex': c_minus_ex, 'R': R_minus}\n    }\n\n    # --- LBM Solver Core ---\n\n    def run_single_species_lbm(N, dt, T, tau, species_type):\n        \"\"\"\n        Runs a D1Q3 LBM simulation for a single species.\n        Returns the final L2 error.\n        \"\"\"\n        dx = 1.0 / N\n        x_grid = np.arange(N) * dx\n        \n        n_steps = int(round(T / dt))\n        T_final = n_steps * dt\n\n        c_ex_func = analytic_funcs[species_type]['c_ex']\n        R_func = analytic_funcs[species_type]['R']\n\n        # Initialization at t=0\n        c0 = c_ex_func(x_grid, 0.0)\n        f = np.outer(c0, w)  # Equilibrium distributions, shape (N, 3)\n\n        # Main time-stepping loop\n        for step in range(n_steps):\n            t_current = step * dt\n\n            # Macroscopic concentration\n            c = np.sum(f, axis=1)\n\n            # Equilibrium distribution\n            feq = np.outer(c, w)\n\n            # Source term at grid points\n            source = R_func(x_grid, t_current)\n\n            # Collision step with source term\n            f_post_coll = f - (1.0 / tau) * (f - feq) + np.outer(source, w) * dt\n\n            # Streaming step with periodic boundaries\n            f[:, 0] = f_post_coll[:, 0]\n            f[:, 1] = np.roll(f_post_coll[:, 1], shift=1)\n            f[:, 2] = np.roll(f_post_coll[:, 2], shift=-1)\n\n        # Final concentration\n        c_final = np.sum(f, axis=1)\n\n        if not np.all(np.isfinite(c_final)):\n            return np.inf\n\n        c_exact_final = c_ex_func(x_grid, T_final)\n        \n        error = np.sqrt(np.mean((c_final - c_exact_final)**2))\n        return error\n\n    def calculate_average_error(N, dt, T, tau):\n        \"\"\"\n        Runs simulations for both species and returns the average error.\n        \"\"\"\n        error_plus = run_single_species_lbm(N, dt, T, tau, 'plus')\n        error_minus = run_single_species_lbm(N, dt, T, tau, 'minus')\n        \n        if error_plus == np.inf or error_minus == np.inf:\n            return np.inf\n            \n        return (error_plus + error_minus) / 2.0\n\n    # --- Test Case 1: Spatial Convergence ---\n    kappa_spatial = 0.20\n    tau_spatial = 0.5 + (D_val * kappa_spatial) / cs2\n\n    N1_s, N2_s = 128, 256\n    \n    dx1_s = 1.0 / N1_s\n    dt1_s = kappa_spatial * dx1_s**2\n    E1_s = calculate_average_error(N1_s, dt1_s, T_val, tau_spatial)\n\n    dx2_s = 1.0 / N2_s\n    dt2_s = kappa_spatial * dx2_s**2\n    E2_s = calculate_average_error(N2_s, dt2_s, T_val, tau_spatial)\n\n    p = np.log(E1_s / E2_s) / np.log(dx1_s / dx2_s)\n    \n    # --- Test Case 2: Temporal Convergence ---\n    N_t = 256\n    dx_t = 1.0 / N_t\n\n    dt1_t, dt2_t = 1e-4, 5e-5\n\n    tau1_t = 0.5 + (D_val * dt1_t) / (cs2 * dx_t**2)\n    E1_t = calculate_average_error(N_t, dt1_t, T_val, tau1_t)\n\n    tau2_t = 0.5 + (D_val * dt2_t) / (cs2 * dx_t**2)\n    E2_t = calculate_average_error(N_t, dt2_t, T_val, tau2_t)\n    \n    q = np.log(E1_t / E2_t) / np.log(dt1_t / dt2_t)\n\n    # --- Test Case 3: Stability Edge ---\n    N_stab = 32\n    tau_stab = 0.51\n    dx_stab = 1.0 / N_stab\n    dt_stab = (tau_stab - 0.5) * cs2 * dx_stab**2 / D_val\n    \n    E_stab = calculate_average_error(N_stab, dt_stab, T_val, tau_stab)\n    \n    stable = (E_stab  1.0) and np.isfinite(E_stab)\n\n    # --- Final Output ---\n    results = [p, q, stable]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}