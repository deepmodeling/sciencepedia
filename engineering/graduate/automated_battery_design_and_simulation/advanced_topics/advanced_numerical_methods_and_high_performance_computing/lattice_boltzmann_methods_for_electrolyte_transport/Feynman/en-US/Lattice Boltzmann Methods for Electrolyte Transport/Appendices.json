{
    "hands_on_practices": [
        {
            "introduction": "Before launching a complex simulation, a crucial first step is to ensure the computational grid is fine enough to resolve the key physical phenomena. In electrolytes, the electric double layer (EDL) is a critical feature whose thickness is defined by the Debye length, $\\lambda_D$. This exercise guides you through a first-principles derivation of $\\lambda_D$ and demonstrates how to use this physical scale to determine the necessary lattice resolution for a valid Lattice Boltzmann simulation .",
            "id": "3923123",
            "problem": "A lithium-ion battery separator is saturated with a symmetric binary electrolyte whose cations and anions each have valence $z=1$. You will use the Lattice Boltzmann Method (LBM) for electrolyte transport to simulate the electric double layer (EDL) near a weakly polarized electrode, in the regime where the dimensionless potential $|z e \\phi/(k_B T)|$ is small enough to justify linearization. Starting from fundamental principles, derive the scale of the EDL (the Debye length) and use it to design the lattice resolution.\n\nAssume the electrolyte is at temperature $T=298\\,\\mathrm{K}$, the solvent has relative permittivity $\\epsilon_r=30$, and the bulk molar concentration of the salt is $C_0=10\\,\\mathrm{mol\\,m^{-3}}$. Treat the electrolyte as ideal with the cation and anion bulk number densities equal to $c_0=N_A C_0$, where $N_A$ is Avogadro’s constant. Use the following constants: $N_A=6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$, the elementary charge $e=1.602176634\\times 10^{-19}\\,\\mathrm{C}$, the vacuum permittivity $\\epsilon_0=8.8541878128\\times 10^{-12}\\,\\mathrm{F\\,m^{-1}}$, and the Boltzmann constant $k_B=1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$. The absolute permittivity is $\\epsilon=\\epsilon_r \\epsilon_0$.\n\nTasks:\n- From Gauss’s law (Poisson’s equation) and the Boltzmann distribution for ionic species, derive the linearized relation linking potential curvature to potential itself and identify the inverse screening length $\\kappa$ for a symmetric binary electrolyte.\n- Express the Debye length $\\lambda_D$ in terms of $z$, $e$, $\\epsilon$, $k_B T$, and $c_0$, then convert $C_0$ to $c_0$ and compute the numerical value of $\\lambda_D$.\n- To adequately resolve the EDL in LBM, impose that at least $N=10$ lattice nodes span one Debye length. Compute the minimal lattice spacing $\\Delta x=\\lambda_D/N$.\n\nReport only the minimal lattice spacing $\\Delta x$ in nanometers, rounded to three significant figures, and express the answer in $\\mathrm{nm}$.",
            "solution": "The problem requires the derivation of the characteristic length scale of an electric double layer (EDL), known as the Debye length, and its use in determining the necessary lattice resolution for a Lattice Boltzmann Method (LBM) simulation. The derivation starts from the fundamental principles of electrostatics and statistical mechanics for a symmetric binary electrolyte.\n\nThe first fundamental principle is Gauss's law for electrostatics in a dielectric medium, which can be expressed in its differential form as Poisson's equation. This equation relates the electrostatic potential, $\\phi$, to the local net charge density, $\\rho_e$:\n$$\n\\nabla^2 \\phi = -\\frac{\\rho_e}{\\epsilon}\n$$\nHere, $\\epsilon$ is the absolute permittivity of the electrolyte solvent, given by $\\epsilon = \\epsilon_r \\epsilon_0$, where $\\epsilon_r$ is the relative permittivity and $\\epsilon_0$ is the vacuum permittivity.\n\nThe net charge density $\\rho_e$ arises from the local imbalance of cations and anions. For a symmetric binary electrolyte with cation valence $z$ and anion valence $-z$, the charge density is:\n$$\n\\rho_e = z e c_+ - z e c_- = z e (c_+ - c_-)\n$$\nwhere $e$ is the elementary charge, and $c_+$ and $c_-$ are the local number densities of cations and anions, respectively. The problem specifies a valence of $z=1$.\n\nThe second fundamental principle is the Boltzmann distribution from statistical mechanics, which describes the number density of charged species in thermal equilibrium under an electric potential. The local number density $c_i$ of an ionic species $i$ with charge $q_i$ is given by:\n$$\nc_i(\\mathbf{r}) = c_{i,0} \\exp\\left(-\\frac{q_i \\phi(\\mathbf{r})}{k_B T}\\right)\n$$\nwhere $c_{i,0}$ is the bulk number density (far from any charged surfaces where $\\phi \\to 0$), $k_B$ is the Boltzmann constant, and $T$ is the absolute temperature. For our system, the cations have charge $q_+ = ze = e$ and the anions have charge $q_- = -ze = -e$. Their bulk number densities are equal, $c_{+,0} = c_{-,0} = c_0$. Thus, their local densities are:\n$$\nc_+ = c_0 \\exp\\left(-\\frac{e\\phi}{k_B T}\\right)\n$$\n$$\nc_- = c_0 \\exp\\left(+\\frac{e\\phi}{k_B T}\\right)\n$$\nSubstituting these expressions into the equation for charge density yields:\n$$\n\\rho_e = e c_0 \\left[ \\exp\\left(-\\frac{e\\phi}{k_B T}\\right) - \\exp\\left(\\frac{e\\phi}{k_B T}\\right) \\right]\n$$\nUsing the definition of the hyperbolic sine function, $\\sinh(x) = (\\exp(x) - \\exp(-x))/2$, this simplifies to:\n$$\n\\rho_e = -2 e c_0 \\sinh\\left(\\frac{e\\phi}{k_B T}\\right)\n$$\nSubstituting this expression for $\\rho_e$ into Poisson's equation gives the full Poisson-Boltzmann equation:\n$$\n\\nabla^2 \\phi = \\frac{2 e c_0}{\\epsilon} \\sinh\\left(\\frac{e\\phi}{k_B T}\\right)\n$$\nThe problem specifies the condition of a weakly polarized electrode, which justifies linearization. This corresponds to the regime where the dimensionless potential is small, $|z e \\phi / (k_B T)| \\ll 1$. With $z=1$, this is $|e \\phi / (k_B T)| \\ll 1$. For a small argument $x$, the Taylor series expansion of $\\sinh(x)$ is $\\sinh(x) \\approx x$. Applying this approximation, we get:\n$$\n\\nabla^2 \\phi \\approx \\frac{2 e c_0}{\\epsilon} \\left(\\frac{e\\phi}{k_B T}\\right) = \\left(\\frac{2 e^2 c_0}{\\epsilon k_B T}\\right) \\phi\n$$\nThis is the linearized Poisson-Boltzmann equation, also known as the Debye-Hückel equation. It is a linear partial differential equation relating the potential's curvature to the potential itself. This equation is typically written as:\n$$\n\\nabla^2 \\phi = \\kappa^2 \\phi\n$$\nBy comparing the two forms, we identify the inverse screening length squared, $\\kappa^2$, as:\n$$\n\\kappa^2 = \\frac{2 e^2 c_0}{\\epsilon k_B T}\n$$\nFor the general case of a symmetric electrolyte with valence $z$, this would be $\\kappa^2 = \\frac{2 z^2 e^2 c_0}{\\epsilon k_B T}$.\n\nThe Debye length, $\\lambda_D$, is the characteristic length scale over which the electric potential decays. It is defined as the reciprocal of the inverse screening length, $\\kappa$:\n$$\n\\lambda_D = \\frac{1}{\\kappa} = \\sqrt{\\frac{\\epsilon k_B T}{2 e^2 c_0}}\n$$\nWith the given valence $z=1$, this formula is directly applicable.\n\nNow, we compute the numerical value of $\\lambda_D$. We are given the following values:\nTemperature $T = 298\\,\\mathrm{K}$\nRelative permittivity $\\epsilon_r = 30$\nBulk molar concentration $C_0 = 10\\,\\mathrm{mol\\,m^{-3}}$\nValence $z = 1$\nAvogadro's constant $N_A = 6.02214076 \\times 10^{23}\\,\\mathrm{mol^{-1}}$\nElementary charge $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\nVacuum permittivity $\\epsilon_0 = 8.8541878128 \\times 10^{-12}\\,\\mathrm{F\\,m^{-1}}$\nBoltzmann constant $k_B = 1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$\n\nFirst, we calculate the bulk number density $c_0$:\n$$\nc_0 = C_0 N_A = (10\\,\\mathrm{mol\\,m^{-3}}) \\times (6.02214076 \\times 10^{23}\\,\\mathrm{mol^{-1}}) = 6.02214076 \\times 10^{24}\\,\\mathrm{m^{-3}}\n$$\nNext, we calculate the absolute permittivity $\\epsilon$:\n$$\n\\epsilon = \\epsilon_r \\epsilon_0 = 30 \\times (8.8541878128 \\times 10^{-12}\\,\\mathrm{F\\,m^{-1}}) = 2.65625634384 \\times 10^{-10}\\,\\mathrm{F\\,m^{-1}}\n$$\nNow, we can substitute all the values into the expression for the Debye length:\n$$\n\\lambda_D = \\sqrt{\\frac{(2.656256... \\times 10^{-10}\\,\\mathrm{F\\,m^{-1}}) \\times (1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) \\times (298\\,\\mathrm{K})}{2 \\times (1)^2 \\times (1.602176634 \\times 10^{-19}\\,\\mathrm{C})^2 \\times (6.02214076 \\times 10^{24}\\,\\mathrm{m^{-3}})}}\n$$\nEvaluating the numerator and denominator separately:\nNumerator: $\\epsilon k_B T \\approx 1.092683 \\times 10^{-30}\\,\\mathrm{J\\,F\\,m^{-1}}$\nDenominator: $2 e^2 c_0 \\approx 3.091901 \\times 10^{-13}\\,\\mathrm{C^2\\,m^{-3}}$\n$$\n\\lambda_D^2 = \\frac{1.092683 \\times 10^{-30}}{3.091901 \\times 10^{-13}}\\,\\mathrm{m^2} \\approx 3.53399 \\times 10^{-18}\\,\\mathrm{m^2}\n$$\n$$\n\\lambda_D = \\sqrt{3.53399 \\times 10^{-18}\\,\\mathrm{m^2}} \\approx 1.87989 \\times 10^{-9}\\,\\mathrm{m}\n$$\n\nThe final task is to determine the lattice spacing $\\Delta x$ required to resolve the EDL. The problem states that at least $N=10$ lattice nodes must span one Debye length. This gives the following relation for the lattice spacing:\n$$\n\\Delta x = \\frac{\\lambda_D}{N}\n$$\nSubstituting the calculated value of $\\lambda_D$ and the required number of nodes $N=10$:\n$$\n\\Delta x = \\frac{1.87989 \\times 10^{-9}\\,\\mathrm{m}}{10} = 1.87989 \\times 10^{-10}\\,\\mathrm{m}\n$$\nThe problem requires the answer in nanometers ($\\mathrm{nm}$), where $1\\,\\mathrm{nm} = 10^{-9}\\,\\mathrm{m}$:\n$$\n\\Delta x = (1.87989 \\times 10^{-10}\\,\\mathrm{m}) \\times \\left(\\frac{1\\,\\mathrm{nm}}{10^{-9}\\,\\mathrm{m}}\\right) = 0.187989\\,\\mathrm{nm}\n$$\nRounding to three significant figures, the minimal lattice spacing is $0.188\\,\\mathrm{nm}$.",
            "answer": "$$\n\\boxed{0.188}\n$$"
        },
        {
            "introduction": "The simple 'collide and stream' rules of the Lattice Boltzmann Method are remarkably effective at simulating complex fluid and transport phenomena. To build confidence in this method, we must look 'under the hood' to analyze its numerical properties. This practice utilizes Fourier analysis, a cornerstone of numerical methods, to derive the exact amplification factor of a simple LBM scheme, revealing how it approximates the continuum diffusion equation and allowing for a precise quantification of its inherent numerical error .",
            "id": "3923099",
            "problem": "Consider advection-free electrolyte concentration transport along a one-dimensional periodic channel within a porous electrode, modeled by a scalar Lattice Boltzmann Method (LBM) using the single-relaxation-time Bhatnagar–Gross–Krook (BGK) collision operator set to unity. The discrete velocity set is the one-dimensional, three-speed stencil (D1Q3) with velocities $c_{0} = 0$, $c_{+} = +c$, $c_{-} = -c$, where $c = \\Delta x / \\Delta t$, lattice spacing is $\\Delta x$, and time step is $\\Delta t$. The equilibrium distribution is $f_{i}^{\\mathrm{eq}}(x,t) = w_{i} \\,\\phi(x,t)$ with weights $w_{0} = 2/3$ and $w_{+} = w_{-} = 1/6$, and the macroscopic electrolyte concentration is $\\phi(x,t) = \\sum_{i \\in \\{0,+,-\\}} f_{i}(x,t)$. The update over one time step is collision to equilibrium followed by exact streaming:\n- Collision: $f_{i}^{\\star}(x,t) = f_{i}^{\\mathrm{eq}}(x,t)$ for all $i \\in \\{0,+,-\\}$.\n- Streaming: $f_{0}(x,t+\\Delta t) = f_{0}^{\\star}(x,t)$, $f_{+}(x,t+\\Delta t) = f_{+}^{\\star}(x-\\Delta x,t)$, $f_{-}(x,t+\\Delta t) = f_{-}^{\\star}(x+\\Delta x,t)$.\n\nAssume a Fourier mode for the concentration, $\\phi(x,t) = \\hat{\\phi}(t)\\,\\exp(i k x)$, with wavenumber $k$ and complex amplitude $\\hat{\\phi}(t)$. Starting from the above LBM update and the definition of the macroscopic field, derive the Fourier amplification factor $G(k)$ such that $\\hat{\\phi}(t+\\Delta t) = G(k)\\,\\hat{\\phi}(t)$. Then, using the continuum diffusion model $\\partial_{t}\\phi = D\\,\\partial_{xx}\\phi$ with diffusion coefficient $D = (c^{2}\\Delta t)/6$ corresponding to BGK relaxation equal to unity on this stencil, relate $G(k)$ to the exact diffusive amplifier $\\exp(-D k^{2}\\Delta t)$, and identify whether the scheme introduces phase error for any $k$ and how its amplitude error compares to the exact diffusion amplifier at small $k$.\n\nExpress the final Fourier amplification factor $G(k)$ as a closed-form analytic expression in terms of $k$ and $\\Delta x$. No rounding is required. The final answer is dimensionless; do not include units.",
            "solution": "We begin from the collision-streaming update of the scalar Lattice Boltzmann Method (LBM) for the D1Q3 stencil. For advection-free electrolyte transport with single-relaxation-time Bhatnagar–Gross–Krook (BGK) set to unity, the collision step maps distributions to their equilibrium,\n$$\nf_{i}^{\\star}(x,t) = f_{i}^{\\mathrm{eq}}(x,t) = w_{i}\\,\\phi(x,t),\n$$\nwith $w_{0} = 2/3$, $w_{+} = w_{-} = 1/6$. The subsequent streaming step transports each post-collision population along its velocity:\n$$\n\\begin{aligned}\n&f_{0}(x,t+\\Delta t) = f_{0}^{\\star}(x,t),\\\\\n&f_{+}(x,t+\\Delta t) = f_{+}^{\\star}(x-\\Delta x,t),\\\\\n&f_{-}(x,t+\\Delta t) = f_{-}^{\\star}(x+\\Delta x,t),\n\\end{aligned}\n$$\nwhere $c = \\Delta x/\\Delta t$ is the lattice speed in one dimension. The macroscopic concentration after streaming is the sum of the streamed post-collision distributions,\n$$\n\\phi(x,t+\\Delta t) = f_{0}(x,t+\\Delta t) + f_{+}(x,t+\\Delta t) + f_{-}(x,t+\\Delta t).\n$$\nSubstituting the collision outputs into the streaming update and using the equilibrium definition, we obtain\n$$\n\\phi(x,t+\\Delta t) = w_{0}\\,\\phi(x,t) + w_{+}\\,\\phi(x-\\Delta x,t) + w_{-}\\,\\phi(x+\\Delta x,t).\n$$\nTo perform a von Neumann (Fourier) analysis, assume a Fourier mode for the concentration field,\n$$\n\\phi(x,t) = \\hat{\\phi}(t)\\,\\exp(i k x),\n$$\nwith wavenumber $k$ and complex amplitude $\\hat{\\phi}(t)$. In a periodic spatial domain, the shift property of the exponential implies\n$$\n\\phi(x \\mp \\Delta x,t) = \\hat{\\phi}(t)\\,\\exp(i k (x \\mp \\Delta x)) = \\hat{\\phi}(t)\\,\\exp(i k x)\\,\\exp(\\mp i k \\Delta x).\n$$\nHence,\n$$\n\\phi(x,t+\\Delta t) = \\hat{\\phi}(t)\\,\\exp(i k x)\\left[w_{0} + w_{+}\\,\\exp(-i k \\Delta x) + w_{-}\\,\\exp(+i k \\Delta x)\\right].\n$$\nDefine the Fourier amplification factor $G(k)$ by $\\hat{\\phi}(t+\\Delta t) = G(k)\\,\\hat{\\phi}(t)$. Comparing coefficients of $\\exp(i k x)$, we obtain\n$$\nG(k) = w_{0} + w_{+}\\,\\exp(-i k \\Delta x) + w_{-}\\,\\exp(+i k \\Delta x).\n$$\nWith the specific weights $w_{0} = 2/3$ and $w_{\\pm} = 1/6$, this simplifies to\n$$\nG(k) = \\frac{2}{3} + \\frac{1}{6}\\left[\\exp(-i k \\Delta x) + \\exp(+i k \\Delta x)\\right] = \\frac{2}{3} + \\frac{1}{3}\\cos(k \\Delta x) = \\frac{2 + \\cos(k \\Delta x)}{3}.\n$$\nThis expression is exact for the specified scheme with BGK relaxation equal to unity.\n\nWe now relate this to the exact continuum diffusion amplifier for the diffusion equation $\\partial_{t}\\phi = D\\,\\partial_{xx}\\phi$. The Fourier mode ansatz $\\phi(x,t) = \\hat{\\phi}(t)\\exp(i k x)$ yields the exact temporal evolution\n$$\n\\hat{\\phi}(t+\\Delta t) = \\exp(-D k^{2}\\Delta t)\\,\\hat{\\phi}(t).\n$$\nFor the chosen D1Q3 scheme with BGK parameter equal to unity, the corresponding diffusion coefficient is $D = \\frac{c^{2}\\Delta t}{6}$, a well-tested result for the scalar LBM on this stencil. Using $c = \\Delta x/\\Delta t$, we can write $D k^{2}\\Delta t = \\frac{(\\Delta x)^{2}k^{2}}{6} = \\frac{(k \\Delta x)^{2}}{6}$. Therefore, the exact continuum amplifier is\n$$\n\\exp\\!\\left(-\\frac{(k \\Delta x)^{2}}{6}\\right).\n$$\nTo assess phase and amplitude errors, compare $G(k)$ with this exact amplifier. First, $G(k)$ is real and nonnegative for all real $k$ since it is proportional to $\\cos(k \\Delta x)$ shifted and scaled; thus, the LBM introduces no phase error (the argument of $G(k)$ is zero). Second, for small $|k \\Delta x|$, expand both expressions in a Taylor series:\n$$\nG(k) = \\frac{2 + \\cos(k \\Delta x)}{3} = 1 - \\frac{(k \\Delta x)^{2}}{6} + \\frac{(k \\Delta x)^{4}}{72} - \\frac{(k \\Delta x)^{6}}{2160} + \\cdots,\n$$\n$$\n\\exp\\!\\left(-\\frac{(k \\Delta x)^{2}}{6}\\right) = 1 - \\frac{(k \\Delta x)^{2}}{6} + \\frac{(k \\Delta x)^{4}}{72} - \\frac{(k \\Delta x)^{6}}{1296} + \\cdots.\n$$\nThe leading two terms match, so the scheme is second-order accurate in both space and time for amplitude decay. The first discrepancy appears at order $(k \\Delta x)^{6}$, where the LBM decay coefficient $-1/2160$ differs from the exact $-1/1296$. Consequently, the amplitude error is $O\\!\\left((k \\Delta x)^{6}\\right)$ for small wavenumbers and the scheme is non-dispersive (no phase error) for this advection-free setting.\n\nTherefore, the requested Fourier amplification factor in closed form is\n$$\nG(k) = \\frac{2 + \\cos(k \\Delta x)}{3}.\n$$",
            "answer": "$$\\boxed{\\frac{2+\\cos(k\\,\\Delta x)}{3}}$$"
        },
        {
            "introduction": "Writing a simulation code is only the beginning; rigorously verifying its correctness is a critical and non-trivial part of computational science. This practice introduces the Method of Manufactured Solutions (MMS), a powerful technique for verifying code implementation. You will implement an LBM solver for the Poisson-Nernst-Planck equations and test it against a pre-defined, non-trivial analytical solution, allowing you to precisely measure the code's convergence rates and confirm that it achieves the expected theoretical order of accuracy .",
            "id": "3923131",
            "problem": "You are tasked with implementing a one-dimensional, two-species Lattice Boltzmann Method (LBM) for a manufactured-solution verification of the Poisson–Nernst–Planck (PNP) system that models electrolyte transport in automated battery design and simulation. The goal is to compute grid convergence rates by refining the spatial step size $\\Delta x$ and the temporal step size $\\Delta t$ and to verify the expected orders of accuracy.\n\nStart from the following fundamental base, which is applicable in this context:\n\n- The dimensionless Poisson–Nernst–Planck (PNP) system for ionic concentrations $c_{+}(x,t)$ and $c_{-}(x,t)$ (with valences $z_{+}=+1$ and $z_{-}=-1$) and electric potential $\\phi(x,t)$ on the spatial domain $x \\in [0,1]$ with periodic boundary conditions:\n$$\n\\partial_t c_{\\pm}(x,t) = \\partial_x\\left( D \\,\\partial_x c_{\\pm}(x,t) \\pm c_{\\pm}(x,t) \\,\\partial_x \\phi(x,t) \\right) + S_{\\pm}(x,t),\n$$\n$$\n-\\,\\partial_{xx} \\phi(x,t) = c_{+}(x,t) - c_{-}(x,t) + S_{\\phi}(x,t),\n$$\nwhere $D$ is a positive constant diffusion coefficient, and $S_{\\pm}(x,t)$ and $S_{\\phi}(x,t)$ are manufactured source terms chosen so that a prescribed analytic solution is exactly satisfied.\n\n- For the D1Q3 Lattice Boltzmann Method (LBM) for diffusion with source, with discrete velocities $v_0=0$, $v_1=+1$, $v_2=-1$ and weights $w_0=\\frac{2}{3}$, $w_1=w_2=\\frac{1}{6}$, the hydrodynamic (diffusive) limit recovers the target diffusion coefficient via the well-tested mapping\n$$\nD = c_s^2 \\left(\\tau - \\tfrac{1}{2}\\right) \\frac{\\Delta x^2}{\\Delta t},\n$$\nwhere $c_s^2=\\frac{1}{3}$ is the lattice sound speed squared, and $\\tau$ is the single-relaxation-time Bhatnagar–Gross–Krook (BGK) parameter satisfying $\\tau > \\tfrac{1}{2}$ for stability.\n\nManufacture an exact, smooth, periodic solution on $x \\in [0,1]$ given by\n$$\nc_{+}^{\\mathrm{ex}}(x,t) = 1 + a \\,\\sin(k x)\\,\\cos(\\omega t),\\quad\nc_{-}^{\\mathrm{ex}}(x,t) = 1 + a \\,\\cos(k x)\\,\\sin(\\omega t),\\quad\n\\phi^{\\mathrm{ex}}(x,t) = b\\,\\sin(k x)\\,\\sin(\\omega t),\n$$\nwith constants $a>0$, $b>0$, $k=2\\pi$, and $\\omega=\\pi$. Choose dimensionless $D>0$. Define the source terms\n$$\nS_{\\pm}(x,t) = \\partial_t c_{\\pm}^{\\mathrm{ex}}(x,t) - \\partial_x\\left( D\\,\\partial_x c_{\\pm}^{\\mathrm{ex}}(x,t) \\pm c_{\\pm}^{\\mathrm{ex}}(x,t) \\,\\partial_x \\phi^{\\mathrm{ex}}(x,t) \\right),\n$$\n$$\nS_{\\phi}(x,t) = -\\partial_{xx} \\phi^{\\mathrm{ex}}(x,t) - \\left(c_{+}^{\\mathrm{ex}}(x,t) - c_{-}^{\\mathrm{ex}}(x,t)\\right),\n$$\nso that $\\left(c_{+}^{\\mathrm{ex}},c_{-}^{\\mathrm{ex}},\\phi^{\\mathrm{ex}}\\right)$ is an exact solution of the forced PNP system.\n\nImplement two independent D1Q3 LBM solvers (one for $c_{+}$ and one for $c_{-}$) that evolve the concentrations using the manufactured source term. In the macroscopic balance\n$$\n\\partial_t c_{\\pm} = D\\,\\partial_{xx} c_{\\pm} + R_{\\pm}(x,t),\n$$\nuse\n$$\nR_{\\pm}(x,t) \\equiv S_{\\pm}(x,t) + \\partial_x\\big(\\pm c_{\\pm}^{\\mathrm{ex}}(x,t)\\,\\partial_x \\phi^{\\mathrm{ex}}(x,t)\\big) = \\partial_t c_{\\pm}^{\\mathrm{ex}}(x,t) - D\\,\\partial_{xx} c_{\\pm}^{\\mathrm{ex}}(x,t),\n$$\nwhich depends only on $c_{\\pm}^{\\mathrm{ex}}$ and ensures the manufactured solution is satisfied. Initialize the distribution functions at $t=0$ by equilibrium with $c_{\\pm}^{\\mathrm{ex}}(x,0)$ and advance to a final time $T$ using periodic boundary conditions. At $t=T$, compute the spatial discrete $\\ell^2$ error for each species and report the average of the two species:\n$$\nE(N,\\Delta t) = \\frac{1}{2}\\left( \\sqrt{\\frac{1}{N}\\sum_{j=0}^{N-1}\\left[c_{+}(x_j,T)-c_{+}^{\\mathrm{ex}}(x_j,T)\\right]^2} \\;+\\; \\sqrt{\\frac{1}{N}\\sum_{j=0}^{N-1}\\left[c_{-}(x_j,T)-c_{-}^{\\mathrm{ex}}(x_j,T)\\right]^2} \\right),\n$$\nwhere $x_j=j\\,\\Delta x$ for $j=0,1,\\dots,N-1$ and $\\Delta x=1/N$.\n\nCompute observed grid convergence rates by refining $\\Delta x$ (spatial convergence) and refining $\\Delta t$ (temporal convergence). Define the estimated spatial order $p$ from two successive refinements with $\\Delta x_1$ and $\\Delta x_2$ via\n$$\np \\approx \\frac{\\log\\left(E(N_1,\\Delta t_1)/E(N_2,\\Delta t_2)\\right)}{\\log\\left(\\Delta x_1/\\Delta x_2\\right)},\n$$\nand the estimated temporal order $q$ from two successive refinements with $\\Delta t_1$ and $\\Delta t_2$ via\n$$\nq \\approx \\frac{\\log\\left(E(N,\\Delta t_1)/E(N,\\Delta t_2)\\right)}{\\log\\left(\\Delta t_1/\\Delta t_2\\right)}.\n$$\nThe expected orders of accuracy for this explicit source-injection D1Q3 BGK scheme are $p \\approx 2$ in space and $q \\approx 1$ in time.\n\nUse the following scientifically consistent test suite:\n\n- Spatial refinement (happy path):\n  - $L=1$, $D=0.01$, $a=0.10$, $b=0.05$, $k=2\\pi$, $\\omega=\\pi$, $T=0.01$.\n  - $N \\in \\{64,128,256\\}$ with $\\Delta x=1/N$.\n  - Set $\\Delta t = \\kappa\\,\\Delta x^2$ with $\\kappa=0.20$ so that $\\tau = \\tfrac{1}{2} + \\dfrac{D\\,\\Delta t}{c_s^2\\,\\Delta x^2}$ is independent of $N$ and slightly larger than $\\tfrac{1}{2}$.\n  - Estimate $p$ using the pair $(N_1,N_2)=(128,256)$.\n\n- Temporal refinement (temporal order focus):\n  - $L=1$, $D=0.01$, $a=0.10$, $b=0.05$, $k=2\\pi$, $\\omega=\\pi$, $T=0.01$.\n  - Fix $N=256$ and refine $\\Delta t \\in \\{10^{-4},\\,5\\times 10^{-5},\\,2.5\\times 10^{-5}\\}$.\n  - For each $\\Delta t$, recompute $\\tau = \\tfrac{1}{2} + \\dfrac{D\\,\\Delta t}{c_s^2\\,\\Delta x^2}$ to maintain the target $D$.\n  - Estimate $q$ using the pair $(\\Delta t_1,\\Delta t_2)=(10^{-4},\\,5\\times 10^{-5})$.\n\n- Stability edge case:\n  - $L=1$, $D=0.01$, $a=0.10$, $b=0.05$, $k=2\\pi$, $\\omega=\\pi$, $T=0.01$, $N=32$.\n  - Choose $\\tau=0.51$ and compute $\\Delta t=\\left(\\tau-\\tfrac{1}{2}\\right)\\dfrac{c_s^2\\,\\Delta x^2}{D}$.\n  - Report a boolean indicating whether the simulation remained numerically stable (no overflow or non-finite values and with the final average error $E(N,\\Delta t)$ less than $1.0$).\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, namely $[p,q,\\text{stable}]$, where $p$ and $q$ are floating-point numbers and $\\text{stable}$ is a boolean literal. All quantities are dimensionless, so no physical units are required in the output.",
            "solution": "The problem requires the implementation and verification of a one-dimensional, two-species Lattice Boltzmann Method (LBM) for the Poisson-Nernst-Planck (PNP) system. The verification is performed using the method of manufactured solutions, which allows for the precise computation of numerical errors and convergence rates.\n\nThe overall strategy is to decouple the PNP system. Instead of solving a coupled system for concentrations $c_{\\pm}$ and potential $\\phi$, we use the prescribed exact analytical solution for $\\phi^{\\text{ex}}(x,t)$ and $c_{\\pm}^{\\text{ex}}(x,t)$ to compute an effective source term for a simple advection-diffusion-reaction equation for each species, $c_+$ and $c_-$. This reduces the problem to implementing two independent LBM solvers for a linear advection-diffusion equation with a known source term.\n\n### 1. Manufactured Solution and Source Terms\n\nThe problem provides the manufactured solution for the concentrations $c_{\\pm}^{\\mathrm{ex}}$ and the electric potential $\\phi^{\\mathrm{ex}}$ on the periodic domain $x \\in [0,1]$:\n$$\n\\begin{align*}\nc_{+}^{\\mathrm{ex}}(x,t) &= 1 + a \\sin(k x)\\cos(\\omega t) \\\\\nc_{-}^{\\mathrm{ex}}(x,t) &= 1 + a \\cos(k x)\\sin(\\omega t) \\\\\n\\phi^{\\mathrm{ex}}(x,t) &= b \\sin(k x)\\sin(\\omega t)\n\\end{align*}\n$$\nwith constants $k=2\\pi$ and $\\omega=\\pi$.\n\nThe governing PNP equations are:\n$$\n\\partial_t c_{\\pm} = \\partial_x\\left( D \\partial_x c_{\\pm} \\pm c_{\\pm} \\partial_x \\phi \\right) + S_{\\pm} = D \\partial_{xx} c_{\\pm} \\pm \\partial_x (c_{\\pm} \\partial_x \\phi) + S_{\\pm}\n$$\nThe problem simplifies this by moving the Nernst-Planck drift term $\\pm \\partial_x (c_{\\pm} \\partial_x \\phi)$ to the right-hand side and combining it with the manufactured source $S_{\\pm}$. The exact solution $c_{\\pm}^{\\mathrm{ex}}$ and $\\phi^{\\mathrm{ex}}$ are used in this term. This results in a target equation for the LBM solver of the form of a diffusion equation with an effective source term $R_{\\pm}(x,t)$:\n$$\n\\partial_t c_{\\pm} = D\\,\\partial_{xx} c_{\\pm} + R_{\\pm}(x,t)\n$$\nThe effective source term $R_{\\pm}$ is derived by substituting the manufactured solution into the original PNP system, ensuring that $c_{\\pm}^{\\mathrm{ex}}$ is the exact solution.\n$$\nR_{\\pm}(x,t) = \\partial_t c_{\\pm}^{\\mathrm{ex}}(x,t) - D\\,\\partial_{xx} c_{\\pm}^{\\mathrm{ex}}(x,t)\n$$\nWe compute the necessary derivatives of $c_{\\pm}^{\\mathrm{ex}}(x,t)$:\nFor $c_{+}^{\\mathrm{ex}}(x,t)$:\n$$\n\\begin{align*}\n\\partial_t c_{+}^{\\mathrm{ex}}(x,t) &= -a \\omega \\sin(k x)\\sin(\\omega t) \\\\\n\\partial_{xx} c_{+}^{\\mathrm{ex}}(x,t) &= -a k^2 \\sin(k x)\\cos(\\omega t)\n\\end{align*}\n$$\nThus, the source term for the positive species is:\n$$\nR_{+}(x,t) = a \\sin(k x) \\left[ D k^2 \\cos(\\omega t) - \\omega \\sin(\\omega t) \\right]\n$$\nFor $c_{-}^{\\mathrm{ex}}(x,t)$:\n$$\n\\begin{align*}\n\\partial_t c_{-}^{\\mathrm{ex}}(x,t) &= a \\omega \\cos(k x)\\cos(\\omega t) \\\\\n\\partial_{xx} c_{-}^{\\mathrm{ex}}(x,t) &= -a k^2 \\cos(k x)\\sin(\\omega t)\n\\end{align*}\n$$\nThus, the source term for the negative species is:\n$$\nR_{-}(x,t) = a \\cos(k x) \\left[ \\omega \\cos(\\omega t) + D k^2 \\sin(\\omega t) \\right]\n$$\n\n### 2. D1Q3 Lattice Boltzmann Method with Source\n\nWe employ a D1Q3 LBM scheme for each species. The D1Q3 lattice has three discrete velocities $e_0=0, e_1=+1, e_2=-1$ in lattice units, with corresponding weights $w_0=2/3, w_1=1/6, w_2=1/6$. The LBM evolves the particle distribution functions $f_i(x,t)$ through a sequence of collision and streaming steps.\n\nThe macroscopic concentration is recovered by summing the distributions: $c(x,t) = \\sum_{i=0}^{2} f_i(x,t)$.\n\nThe equilibrium distribution for a diffusion process (zero macroscopic velocity) is given by:\n$$\nf_i^{\\mathrm{eq}}(c) = w_i c\n$$\n\nThe LBM algorithm with a BGK collision operator and a source term is implemented as a two-step process for each time step $\\Delta t$:\n\n**1. Collision and Forcing:** In this step, the distribution functions relax towards equilibrium and are affected by the source term.\n$$\nf_i^*(x,t) = f_i(x,t) - \\frac{1}{\\tau} \\left[ f_i(x,t) - f_i^{\\mathrm{eq}}(c(x,t)) \\right] + \\Delta t F_i(x,t)\n$$\nwhere $\\tau$ is the relaxation time. The discrete source term $F_i$ is chosen to recover the macroscopic source $R(x,t)$ upon summation, i.e., $\\sum_i F_i = R$. A standard choice that introduces no spurious momentum is $F_i = w_i R$. The post-collision, post-forcing distribution is thus:\n$$\nf_i^*(x,t) = f_i(x,t) - \\frac{1}{\\tau} \\left[ f_i(x,t) - f_i^{\\mathrm{eq}}(c(x,t)) \\right] + w_i R(x,t) \\Delta t\n$$\n\n**2. Streaming:** The particles move to adjacent lattice sites according to their velocities.\n$$\nf_i(x+e_i\\Delta x, t+\\Delta t) = f_i^*(x,t)\n$$\nFor periodic boundary conditions on a grid of size $N$, this is efficiently implemented using a circular shift (e.g., `numpy.roll`).\n\nThe relaxation time $\\tau$ is related to the physical diffusion coefficient $D$ by:\n$$\nD = c_s^2 \\left(\\tau - \\frac{1}{2}\\right) \\frac{\\Delta x^2}{\\Delta t}\n$$\nwhere $c_s^2=1/3$ is the squared lattice speed of sound. This relationship is used to set $\\tau$ based on the simulation parameters.\n\n### 3. Simulation and Verification Procedure\n\nThe overall simulation proceeds as follows:\n1.  **Initialization:** At $t=0$, the distribution functions $f_i(x,0)$ are initialized to their equilibrium values based on the exact concentration $c_{\\pm}^{\\mathrm{ex}}(x,0)$.\n2.  **Time-stepping:** The LBM simulation is advanced for a number of steps, `n_steps`. An important detail is that the number of steps, $T/\\Delta t$, may not be an integer. We use `n_steps = round(T/dt)` and define the final simulation time as $T_{\\mathrm{final}} = \\text{n\\_steps} \\times \\Delta t$. The exact solution is evaluated at this $T_{\\mathrm{final}}$ to ensure a consistent error calculation. During each step, the source term $R(x,t)$ is evaluated at the beginning of the time interval, $t_n = n \\Delta t$.\n3.  **Error Calculation:** At $t=T_{\\mathrm{final}}$, the numerical concentration $c_{\\pm}(x,T_{\\mathrm{final}})$ is computed. The discrete $\\ell^2$ error is calculated for each species and then averaged, as specified by the formula for $E(N,\\Delta t)$.\n4.  **Convergence Rate Calculation:** By running simulations with systematically refined grid spacing $\\Delta x$ or time step $\\Delta t$, the observed orders of accuracy $p$ (spatial) and $q$ (temporal) are computed using the provided logarithmic formulas.\n\nThis procedure is applied to the three test cases:\n-   **Spatial Refinement:** $N$ is refined from $128$ to $256$, with $\\Delta t$ scaled as $\\kappa \\Delta x^2$ to keep $\\tau$ constant. This isolates the spatial discretization error, which is expected to be second order ($p\\approx 2$).\n-   **Temporal Refinement:** $\\Delta t$ is refined from $10^{-4}$ to $5\\times 10^{-5}$ with a fixed $N=256$. This isolates the temporal discretization error, expected to be first order ($q\\approx 1$) for this explicit LBM scheme.\n-   **Stability Edge:** A simulation is run with parameters ($N=32$, $\\tau=0.51$) that are close to the stability limit $\\tau=0.5$. The stability is assessed by checking for non-finite values in the solution and ensuring the final error is below a generous threshold of $1.0$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to perform LBM verification for the PNP system.\n    It solves three test cases: spatial convergence, temporal convergence,\n    and a stability edge case.\n    \"\"\"\n\n    # --- Problem Constants ---\n    k_val = 2.0 * np.pi\n    omega_val = np.pi\n    D_val = 0.01\n    a_val = 0.10\n    b_val = 0.05\n    T_val = 0.01\n    cs2 = 1.0 / 3.0\n    w = np.array([2.0/3.0, 1.0/6.0, 1.0/6.0])\n\n    # --- Analytic Functions for Manufactured Solution ---\n    \n    def c_plus_ex(x, t, a=a_val, k=k_val, omega=omega_val):\n        return 1.0 + a * np.sin(k * x) * np.cos(omega * t)\n\n    def c_minus_ex(x, t, a=a_val, k=k_val, omega=omega_val):\n        return 1.0 + a * np.cos(k * x) * np.sin(omega * t)\n\n    def R_plus(x, t, a=a_val, D=D_val, k=k_val, omega=omega_val):\n        term1 = -a * omega * np.sin(k * x) * np.sin(omega * t)\n        term2 = a * D * k**2 * np.sin(k * x) * np.cos(omega * t)\n        return term1 + term2\n\n    def R_minus(x, t, a=a_val, D=D_val, k=k_val, omega=omega_val):\n        term1 = a * omega * np.cos(k * x) * np.cos(omega * t)\n        term2 = a * D * k**2 * np.cos(k * x) * np.sin(omega * t)\n        return term1 + term2\n\n    analytic_funcs = {\n        'plus': {'c_ex': c_plus_ex, 'R': R_plus},\n        'minus': {'c_ex': c_minus_ex, 'R': R_minus}\n    }\n\n    # --- LBM Solver Core ---\n\n    def run_single_species_lbm(N, dt, T, tau, species_type):\n        \"\"\"\n        Runs a D1Q3 LBM simulation for a single species.\n        Returns the final L2 error.\n        \"\"\"\n        dx = 1.0 / N\n        x_grid = np.arange(N) * dx\n        \n        n_steps = int(round(T / dt))\n        T_final = n_steps * dt\n\n        c_ex_func = analytic_funcs[species_type]['c_ex']\n        R_func = analytic_funcs[species_type]['R']\n\n        # Initialization at t=0\n        c0 = c_ex_func(x_grid, 0.0)\n        f = np.outer(c0, w)  # Equilibrium distributions, shape (N, 3)\n\n        # Main time-stepping loop\n        for step in range(n_steps):\n            t_current = step * dt\n\n            # Macroscopic concentration\n            c = np.sum(f, axis=1)\n\n            # Equilibrium distribution\n            feq = np.outer(c, w)\n\n            # Source term at grid points\n            source = R_func(x_grid, t_current)\n\n            # Collision step with source term\n            f_post_coll = f - (1.0 / tau) * (f - feq) + np.outer(source, w) * dt\n\n            # Streaming step with periodic boundaries\n            f[:, 0] = f_post_coll[:, 0]\n            f[:, 1] = np.roll(f_post_coll[:, 1], shift=1)\n            f[:, 2] = np.roll(f_post_coll[:, 2], shift=-1)\n\n        # Final concentration\n        c_final = np.sum(f, axis=1)\n\n        if not np.all(np.isfinite(c_final)):\n            return np.inf\n\n        c_exact_final = c_ex_func(x_grid, T_final)\n        \n        error = np.sqrt(np.mean((c_final - c_exact_final)**2))\n        return error\n\n    def calculate_average_error(N, dt, T, tau):\n        \"\"\"\n        Runs simulations for both species and returns the average error.\n        \"\"\"\n        error_plus = run_single_species_lbm(N, dt, T, tau, 'plus')\n        error_minus = run_single_species_lbm(N, dt, T, tau, 'minus')\n        \n        if error_plus == np.inf or error_minus == np.inf:\n            return np.inf\n            \n        return (error_plus + error_minus) / 2.0\n\n    # --- Test Case 1: Spatial Convergence ---\n    kappa_spatial = 0.20\n    tau_spatial = 0.5 + (D_val * kappa_spatial) / cs2\n\n    N1_s, N2_s = 128, 256\n    \n    dx1_s = 1.0 / N1_s\n    dt1_s = kappa_spatial * dx1_s**2\n    E1_s = calculate_average_error(N1_s, dt1_s, T_val, tau_spatial)\n\n    dx2_s = 1.0 / N2_s\n    dt2_s = kappa_spatial * dx2_s**2\n    E2_s = calculate_average_error(N2_s, dt2_s, T_val, tau_spatial)\n\n    p = np.log(E1_s / E2_s) / np.log(dx1_s / dx2_s)\n    \n    # --- Test Case 2: Temporal Convergence ---\n    N_t = 256\n    dx_t = 1.0 / N_t\n\n    dt1_t, dt2_t = 1e-4, 5e-5\n\n    tau1_t = 0.5 + (D_val * dt1_t) / (cs2 * dx_t**2)\n    E1_t = calculate_average_error(N_t, dt1_t, T_val, tau1_t)\n\n    tau2_t = 0.5 + (D_val * dt2_t) / (cs2 * dx_t**2)\n    E2_t = calculate_average_error(N_t, dt2_t, T_val, tau2_t)\n    \n    q = np.log(E1_t / E2_t) / np.log(dt1_t / dt2_t)\n\n    # --- Test Case 3: Stability Edge ---\n    N_stab = 32\n    tau_stab = 0.51\n    dx_stab = 1.0 / N_stab\n    dt_stab = (tau_stab - 0.5) * cs2 * dx_stab**2 / D_val\n    \n    E_stab = calculate_average_error(N_stab, dt_stab, T_val, tau_stab)\n    \n    stable = (E_stab < 1.0) and np.isfinite(E_stab)\n\n    # --- Final Output ---\n    results = [p, q, stable]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}