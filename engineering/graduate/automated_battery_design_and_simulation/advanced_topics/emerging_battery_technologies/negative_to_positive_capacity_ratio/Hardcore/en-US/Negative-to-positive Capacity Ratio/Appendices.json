{
    "hands_on_practices": [
        {
            "introduction": "The design of a lithium-ion cell begins with fundamental mass balancing. This exercise provides hands-on practice in deriving the essential relationship between the mass of the electrodes and the target Negative-to-Positive (N/P) capacity ratio, a cornerstone of cell engineering. Mastering this calculation is the first step toward building a well-balanced and safe battery .",
            "id": "21555",
            "problem": "In the design of a lithium-ion battery, balancing the capacities of the negative (anode) and positive (cathode) electrodes is crucial for optimal performance, cycle life, and safety. The Negative-to-Positive (N/P) capacity ratio, $\\xi$, is a key design parameter defined as the ratio of the total accessible charge capacity of the anode to that of the cathode. To prevent hazardous lithium metal plating on the anode during charging, the N/P ratio is typically designed to be greater than one ($\\xi > 1$).\n\nThe total mass of an electrode, $M$, is composed of the active material mass, $m_{am}$, and the mass of inactive components (e.g., binder, conductive carbon). The weight fraction of the active material in an electrode is given by $w = m_{am} / M$.\n\nThe theoretical specific capacity of an active material, $Q_s$ (in units of AÂ·h/kg), is often not fully accessible in a practical cell. The material utilization factor, $\\eta$, is a dimensionless parameter ($0  \\eta \\le 1$) that accounts for irreversible capacity losses and incomplete material reaction, such that the practical specific capacity is $\\eta Q_s$.\n\nConsider a lithium-ion cell to be assembled with an anode and a cathode. The anode active material has a theoretical specific capacity of $Q_{s,a}$ and a utilization factor of $\\eta_a$. The anode electrode is fabricated with an active material weight fraction of $w_a$. The cathode active material has a theoretical specific capacity of $Q_{s,c}$ and a utilization factor of $\\eta_c$. The cathode electrode is fabricated with an active material weight fraction of $w_c$.\n\nDerive a general expression for the required mass ratio of the total anode electrode to the total cathode electrode, $M_a/M_c$, needed to achieve a specific target N/P ratio, $\\xi$.",
            "solution": "1. The total accessible charge capacity of the anode is\n$$C_a = m_{am,a}\\,\\eta_a\\,Q_{s,a} = w_a\\,M_a\\,\\eta_a\\,Q_{s,a}.$$\n2. The total accessible charge capacity of the cathode is\n$$C_c = m_{am,c}\\,\\eta_c\\,Q_{s,c} = w_c\\,M_c\\,\\eta_c\\,Q_{s,c}.$$\n3. The N/P ratio is defined as\n$$\\xi = \\frac{C_a}{C_c} = \\frac{w_a\\,M_a\\,\\eta_a\\,Q_{s,a}}{w_c\\,M_c\\,\\eta_c\\,Q_{s,c}}\\,. $$\n4. Solving for the mass ratio $M_a/M_c$ gives\n$$\\frac{M_a}{M_c}\n= \\xi\\,\\frac{w_c\\,\\eta_c\\,Q_{s,c}}{w_a\\,\\eta_a\\,Q_{s,a}}\\,. $$",
            "answer": "$$\\boxed{\\xi\\,\\frac{w_c\\,\\eta_c\\,Q_{s,c}}{w_a\\,\\eta_a\\,Q_{s,a}}}$$"
        },
        {
            "introduction": "Real-world batteries are not ideal, and accounting for initial inefficiencies is a critical design step. This problem moves beyond simple balancing to incorporate the irreversible capacity loss due to the formation of the Solid Electrolyte Interphase (SEI) . You will learn how to calculate the necessary cathode oversizing to compensate for this lithium loss, ensuring the cell achieves its target N/P ratio after the first cycle.",
            "id": "2496809",
            "problem": "A lithium-ion full cell is assembled with a graphite negative electrode and a layered oxide positive electrode. The areal reversible capacities of the host materials are $C_{a}$ for the anode and $C_{c}$ for the cathode, measured in $\\mathrm{mAh \\, cm^{-2}}$. During the first formation cycle, a Solid Electrolyte Interphase (SEI) forms on the graphite electrode, consuming lithium irreversibly with an areal irreversible capacity $C_{\\mathrm{irr}}$. There is no prelithiation, so the initial lithium inventory is provided entirely by the cathode. Assume ideal utilization of both host materials aside from the irreversible loss, negligible side reactions beyond the SEI, and no kinetic limitations.\n\nUsing lithium mass balance and the definition of the negative-to-positive capacity ratio (N/P), where the target ratio after formation is $r_{\\ast}$ defined as the ratio of the anode host capacity to the cyclable positive capacity, derive from first principles an expression for the initial cyclable lithium inventory loss $L_{0}$ and for the required cathode oversizing factor $f$ such that after SEI formation the N/P equals $r_{\\ast}$. Here, the oversizing factor is defined as $f = C_{c}^{\\prime}/C_{c}$, where $C_{c}^{\\prime}$ is the designed cathode capacity after oversizing.\n\nThen evaluate $f$ numerically for $C_{a} = 3.60 \\ \\mathrm{mAh \\, cm^{-2}}$, $C_{c} = 3.20 \\ \\mathrm{mAh \\, cm^{-2}}$, $C_{\\mathrm{irr}} = 0.12 \\ \\mathrm{mAh \\, cm^{-2}}$, and $r_{\\ast} = 1.10$. Express the final oversizing factor as a dimensionless number and round your answer to four significant figures.",
            "solution": "The problem statement is first subjected to validation.\n\nGivens are extracted verbatim:\n- Areal reversible capacity of the anode: $C_{a}$ in $\\mathrm{mAh \\, cm^{-2}}$.\n- Areal reversible capacity of the cathode: $C_{c}$ in $\\mathrm{mAh \\, cm^{-2}}$.\n- Areal irreversible capacity for SEI formation: $C_{\\mathrm{irr}}$ in $\\mathrm{mAh \\, cm^{-2}}$.\n- Initial lithium inventory is entirely from the cathode (no prelithiation).\n- Target negative-to-positive capacity ratio after formation: $r_{\\ast}$, defined as the ratio of the anode host capacity to the cyclable positive capacity.\n- Cathode oversizing factor: $f = C_{c}^{\\prime}/C_{c}$, where $C_{c}^{\\prime}$ is the designed cathode capacity after oversizing.\n\nThe problem requires the derivation of expressions for the initial cyclable lithium inventory loss $L_{0}$ and the cathode oversizing factor $f$, followed by a numerical evaluation of $f$.\n\nValidation verdict: The problem is scientifically grounded in the principles of electrochemistry and battery engineering, specifically concerning cell balancing. It is well-posed, with all necessary parameters and definitions provided to derive a unique solution. The language is objective and the values are physically realistic. The problem is therefore deemed valid.\n\nThe solution proceeds from first principles.\n\nLet $C_{c}^{\\prime}$ be the designed areal capacity of the positive electrode. Since the cathode is the sole source of lithium, the total initial lithium inventory in the cell, $Q_{\\mathrm{Li,total}}$, corresponds to this capacity.\n$$Q_{\\mathrm{Li,total}} = C_{c}^{\\prime}$$\nDuring the first charging cycle, an amount of lithium equivalent to the capacity $C_{\\mathrm{irr}}$ is consumed irreversibly to form the Solid Electrolyte Interphase (SEI) on the anode surface. This quantity of lithium is permanently lost from the cyclable inventory. The remaining lithium, which is available for subsequent cycling between the electrodes, is the cyclable lithium inventory, $Q_{\\mathrm{cyc}}$.\n$$Q_{\\mathrm{cyc}} = Q_{\\mathrm{Li,total}} - C_{\\mathrm{irr}} = C_{c}^{\\prime} - C_{\\mathrm{irr}}$$\nThe problem specifies the target negative-to-positive capacity ratio, $r_{\\ast}$, after formation. This ratio is defined as the anode host capacity divided by the cyclable positive capacity.\n$$r_{\\ast} = \\frac{\\text{Anode host capacity}}{\\text{Cyclable positive capacity}}$$\nThe anode host capacity is its reversible capacity, given as $C_{a}$. The cyclable positive capacity is determined by the amount of lithium that can be reversibly exchanged with the positive electrode, which is precisely the cyclable lithium inventory, $Q_{\\mathrm{cyc}}$. Therefore, the definition of $r_{\\ast}$ becomes:\n$$r_{\\ast} = \\frac{C_{a}}{Q_{\\mathrm{cyc}}}$$\nFrom this relationship, we can express the required cyclable inventory to meet the design target:\n$$Q_{\\mathrm{cyc}} = \\frac{C_{a}}{r_{\\ast}}$$\nBy equating the two expressions for $Q_{\\mathrm{cyc}}$, we establish a mass balance for lithium that connects the designed cathode capacity to the electrode properties and the target ratio.\n$$C_{c}^{\\prime} - C_{\\mathrm{irr}} = \\frac{C_{a}}{r_{\\ast}}$$\nSolving for the designed cathode capacity $C_{c}^{\\prime}$ yields:\n$$C_{c}^{\\prime} = \\frac{C_{a}}{r_{\\ast}} + C_{\\mathrm{irr}}$$\nThis equation dictates the necessary total capacity of the cathode material to achieve the desired N/P ratio after accounting for the initial irreversible loss.\n\nNow we derive the expressions for the two quantities requested.\n\nFirst, the initial cyclable lithium inventory loss, $L_{0}$. This is defined as the fraction of the total initial lithium inventory that is irreversibly consumed.\n$$L_{0} = \\frac{\\text{Irreversible Li loss}}{\\text{Total initial Li inventory}} = \\frac{C_{\\mathrm{irr}}}{Q_{\\mathrm{Li,total}}} = \\frac{C_{\\mathrm{irr}}}{C_{c}^{\\prime}}$$\nSubstituting the derived expression for $C_{c}^{\\prime}$, we obtain the final expression for $L_{0}$:\n$$L_{0} = \\frac{C_{\\mathrm{irr}}}{\\frac{C_{a}}{r_{\\ast}} + C_{\\mathrm{irr}}}$$\nSecond, the cathode oversizing factor, $f$. It is defined as $f = C_{c}^{\\prime} / C_{c}$. Substituting the expression for $C_{c}^{\\prime}$ gives:\n$$f = \\frac{\\frac{C_{a}}{r_{\\ast}} + C_{\\mathrm{irr}}}{C_{c}} = \\frac{1}{C_{c}}\\left(\\frac{C_{a}}{r_{\\ast}} + C_{\\mathrm{irr}}\\right)$$\nThis is the required expression for the oversizing factor.\n\nFinally, we evaluate $f$ numerically using the provided data: $C_{a} = 3.60 \\ \\mathrm{mAh \\, cm^{-2}}$, $C_{c} = 3.20 \\ \\mathrm{mAh \\, cm^{-2}}$, $C_{\\mathrm{irr}} = 0.12 \\ \\mathrm{mAh \\, cm^{-2}}$, and $r_{\\ast} = 1.10$.\n$$f = \\frac{1}{3.20} \\left( \\frac{3.60}{1.10} + 0.12 \\right)$$\nFirst, we compute the term inside the parenthesis:\n$$\\frac{3.60}{1.10} + 0.12 \\approx 3.272727... + 0.12 = 3.392727...$$\nThen, we complete the calculation for $f$:\n$$f = \\frac{3.392727...}{3.20} \\approx 1.060227...$$\nRounding the result to four significant figures as required gives the final numerical answer.\n$$f \\approx 1.060$$\nThis factor indicates that the cathode's areal capacity must be designed to be approximately $6\\%$ larger than the initial reference capacity $C_c$ to compensate for the SEI loss and achieve the target N/P ratio of $1.10$.",
            "answer": "$$\\boxed{1.060}$$"
        },
        {
            "introduction": "The choice of N/P ratio is ultimately a design trade-off between competing performance metrics. This capstone exercise elevates the concept from a simple calculation to a multi-objective optimization problem, which is central to automated battery design . By implementing a discrete search algorithm, you will determine the optimal N/P ratio that balances the conflicting demands of maximizing gravimetric energy density and extending cycle life.",
            "id": "3932019",
            "problem": "You must write a complete, runnable program that, for a set of parameterized lithium-ion cell designs, computes the optimal negative-to-positive (N/P) capacity ratio by resolving a multiobjective trade-off between gravimetric energy density and lithium inventory margin-based cycle life. The optimization is to be performed strictly within a specified ratio range using a numerically stable discrete search. Your program may use only the Python standard library and the specified scientific libraries.\n\nStart from the following fundamental basis and core definitions appropriate to automated battery design and simulation:\n\n- The negative-to-positive capacity ratio is defined as $r = \\dfrac{C_{\\mathrm{neg}}}{C_{\\mathrm{pos}}}$, where $C_{\\mathrm{neg}}$ is the available negative electrode capacity and $C_{\\mathrm{pos}}$ is the available positive electrode capacity, both per unit area in $\\mathrm{mAh/cm^2}$. Practical cells require $r \\geq 1$ to avoid lithium plating and inventory starvation.\n\n- Specific capacity relates capacity and mass via $C = q \\, m$, where $C$ is capacity in $\\mathrm{mAh}$, $q$ is specific capacity in $\\mathrm{mAh/g}$, and $m$ is mass in $\\mathrm{g}$. For a fixed positive electrode areal capacity $C_{\\mathrm{pos}}$ in $\\mathrm{mAh/cm^2}$ and specific capacities $q_{\\mathrm{pos}}$ and $q_{\\mathrm{neg}}$, the active masses per unit area are $m_{\\mathrm{pos}} = \\dfrac{C_{\\mathrm{pos}}}{q_{\\mathrm{pos}}}$ and $m_{\\mathrm{neg}} = \\dfrac{r \\, C_{\\mathrm{pos}}}{q_{\\mathrm{neg}}}$ in $\\mathrm{g/cm^2}$.\n\n- Total mass per unit area is $m_{\\mathrm{area}} = m_{\\mathrm{pos}} + m_{\\mathrm{neg}} + m_{\\mathrm{inact}}$ in $\\mathrm{g/cm^2}$, where $m_{\\mathrm{inact}}$ accounts for inactive components (current collectors, separator, binder, and other non-capacity contributions) in $\\mathrm{g/cm^2}$.\n\n- Cell energy per unit area is $E_{\\mathrm{area}} = V_{\\mathrm{avg}} \\, C_{\\mathrm{del}} / 1000$ in $\\mathrm{Wh/cm^2}$, where $V_{\\mathrm{avg}}$ is the average discharge voltage in $\\mathrm{V}$ and $C_{\\mathrm{del}}$ is the deliverable capacity in $\\mathrm{mAh/cm^2}$. Under $r \\geq 1$, $C_{\\mathrm{del}} = C_{\\mathrm{pos}}$.\n\n- Gravimetric energy density is $E_{\\mathrm{grav}} = \\dfrac{E_{\\mathrm{area}}}{m_{\\mathrm{area}} / 1000}$ in $\\mathrm{Wh/kg}$, using $1 \\, \\mathrm{g} = 10^{-3} \\, \\mathrm{kg}$.\n\n- The lithium inventory margin per unit area is $M = (r - 1) \\, C_{\\mathrm{pos}}$ in $\\mathrm{mAh/cm^2}$, representing excess negative electrode capacity above the positive capacity. With a constant irreversible loss per cycle $Q_{\\mathrm{irr}}$ in $\\mathrm{mAh/cm^2\\text{-}cycle}$, the idealized cycle life from inventory considerations is $N = \\dfrac{M}{Q_{\\mathrm{irr}}}$ in cycles, assuming linear loss accumulation and neglecting rate and temperature effects for this modeling exercise.\n\nTo form a multiobjective trade-off suitable for numerical optimization without providing any shortcut formula:\n\n1. Normalize the gravimetric energy density over the search range $[r_{\\min}, r_{\\max}]$: let $E_{\\min}$ and $E_{\\max}$ be the minimum and maximum of $E_{\\mathrm{grav}}$ computed over the grid of $r$ values. Define $E_{\\mathrm{norm}}(r) = \\dfrac{E_{\\mathrm{grav}}(r) - E_{\\min}}{E_{\\max} - E_{\\min}}$. If $E_{\\max} = E_{\\min}$, define $E_{\\mathrm{norm}}(r) = 0.0$ for all $r$.\n\n2. Cap and normalize the cycle life to a reference target $N_{\\mathrm{ref}}$ in cycles: define $N_{\\mathrm{norm}}(r) = \\dfrac{\\min(N(r), N_{\\mathrm{ref}})}{N_{\\mathrm{ref}}}$.\n\n3. Combine the objectives via a convex weighted sum $S(r) = w_{E} \\, E_{\\mathrm{norm}}(r) + w_{N} \\, N_{\\mathrm{norm}}(r)$, where $w_{E}$ and $w_{N}$ are nonnegative weights with $w_{E} + w_{N} = 1$. The optimal ratio is $r^{\\star} = \\arg\\max_{r \\in [r_{\\min}, r_{\\max}]} S(r)$, with ties broken by choosing the smallest $r$.\n\nYour program must, for each test case, sweep $r$ over a uniform grid from $r_{\\min}$ to $r_{\\max}$ inclusive with a fixed step $\\Delta r$, compute $E_{\\mathrm{grav}}(r)$ and $N(r)$ using the above definitions, form $S(r)$, and return the $r^{\\star}$ rounded to four decimal places. All internal computations must be performed in $\\mathrm{SI}$-consistent units; specifically, convert $\\mathrm{mg/cm^2}$ to $\\mathrm{g/cm^2}$ using $1 \\, \\mathrm{mg} = 10^{-3} \\, \\mathrm{g}$ and convert $\\mathrm{g}$ to $\\mathrm{kg}$ using $1 \\, \\mathrm{g} = 10^{-3} \\, \\mathrm{kg}$. Energy density must be computed in $\\mathrm{Wh/kg}$, but the final reported $r^{\\star}$ is dimensionless.\n\nImplement the program to solve the following test suite, which probes typical, boundary, and edge scenarios; each tuple lists $(C_{\\mathrm{pos}}, q_{\\mathrm{neg}}, q_{\\mathrm{pos}}, V_{\\mathrm{avg}}, m_{\\mathrm{inact}}, Q_{\\mathrm{irr}}, N_{\\mathrm{ref}}, w_{E}, w_{N}, r_{\\min}, r_{\\max}, \\Delta r)$ with units as described above:\n\n- Test $1$: $(C_{\\mathrm{pos}} = $4.0$ \\, \\mathrm{mAh/cm^2}, \\, q_{\\mathrm{neg}} = $355.0$ \\, \\mathrm{mAh/g}, \\, q_{\\mathrm{pos}} = $180.0$ \\, \\mathrm{mAh/g}, \\, V_{\\mathrm{avg}} = $3.7$ \\, \\mathrm{V}, \\, m_{\\mathrm{inact}} = $12.0$ \\, \\mathrm{mg/cm^2}, \\, Q_{\\mathrm{irr}} = $0.0005$ \\, \\mathrm{mAh/cm^2\\text{-}cycle}, \\, N_{\\mathrm{ref}} = $1000.0$ \\, \\mathrm{cycles}, \\, w_{E} = $0.5$, \\, w_{N} = $0.5$, \\, r_{\\min} = $1.02$, \\, r_{\\max} = $1.30$, \\, \\Delta r = $0.0005$)$.\n\n- Test $2$: $(C_{\\mathrm{pos}} = $4.0$, \\, q_{\\mathrm{neg}} = $350.0$, \\, q_{\\mathrm{pos}} = $180.0$, \\, V_{\\mathrm{avg}} = $3.65$, \\, m_{\\mathrm{inact}} = $12.0$, \\, Q_{\\mathrm{irr}} = $0.0015$, \\, N_{\\mathrm{ref}} = $800.0$, \\, w_{E} = $0.3$, \\, w_{N} = $0.7$, \\, r_{\\min} = $1.05$, \\, r_{\\max} = $1.50$, \\, \\Delta r = $0.001$)$.\n\n- Test $3$: $(C_{\\mathrm{pos}} = $3.0$, \\, q_{\\mathrm{neg}} = $360.0$, \\, q_{\\mathrm{pos}} = $170.0$, \\, V_{\\mathrm{avg}} = $3.6$, \\, m_{\\mathrm{inact}} = $20.0$, \\, Q_{\\mathrm{irr}} = $0.0006$, \\, N_{\\mathrm{ref}} = $1200.0$, \\, w_{E} = $0.8$, \\, w_{N} = $0.2$, \\, r_{\\min} = $1.01$, \\, r_{\\max} = $1.20$, \\, \\Delta r = $0.0005$)$.\n\n- Test $4$: $(C_{\\mathrm{pos}} = $2.0$, \\, q_{\\mathrm{neg}} = $355.0$, \\, q_{\\mathrm{pos}} = $185.0$, \\, V_{\\mathrm{avg}} = $3.7$, \\, m_{\\mathrm{inact}} = $10.0$, \\, Q_{\\mathrm{irr}} = $0.0002$, \\, N_{\\mathrm{ref}} = $1500.0$, \\, w_{E} = $0.4$, \\, w_{N} = $0.6$, \\, r_{\\min} = $1.01$, \\, r_{\\max} = $1.15$, \\, \\Delta r = $0.0005$)$.\n\n- Test $5$: $(C_{\\mathrm{pos}} = $4.5$, \\, q_{\\mathrm{neg}} = $355.0$, \\, q_{\\mathrm{pos}} = $200.0$, \\, V_{\\mathrm{avg}} = $3.75$, \\, m_{\\mathrm{inact}} = $15.0$, \\, Q_{\\mathrm{irr}} = $0.0001$, \\, N_{\\mathrm{ref}} = $2000.0$, \\, w_{E} = $0.9$, \\, w_{N} = $0.1$, \\, r_{\\min} = $1.005$, \\, r_{\\max} = $1.10$, \\, \\Delta r = $0.0005$)$.\n\nYour program should produce a single line of output containing the optimal ratios for the five tests as a comma-separated list enclosed in square brackets, with each ratio rounded to four decimal places (e.g., $[1.1234,1.2345,1.3456,1.4567,1.5678]$). The values are dimensionless and must be formatted exactly as described, with no extra whitespace or text.",
            "solution": "The problem statement has been rigorously validated and is determined to be valid. It is scientifically grounded in established principles of electrochemical engineering, well-posed with all necessary parameters and a clear objective, and free from ambiguity or contradiction. The task is to find an optimal negative-to-positive (N/P) capacity ratio, denoted by $r$, for a lithium-ion cell by balancing two competing objectives: gravimetric energy density ($E_{\\mathrm{grav}}$) and cycle life ($N$).\n\nThe solution is found by performing a discrete search over a specified range of $r$ values, $[r_{\\min}, r_{\\max}]$, with a step size of $\\Delta r$. For each value of $r$ in this search grid, we evaluate a composite score function, $S(r)$, and identify the ratio $r^{\\star}$ that maximizes this score.\n\nFirst, we establish the mathematical models for the two objectives as functions of $r$. All other parameters for a given test case are considered constant. The definitions provided are used to derive these functions.\n\nThe gravimetric energy density, $E_{\\mathrm{grav}}$, is the ratio of cell energy per unit area, $E_{\\mathrm{area}}$, to the total mass per unit area, $m_{\\mathrm{area}}$.\nThe energy per unit area is given by $E_{\\mathrm{area}} = \\dfrac{V_{\\mathrm{avg}} \\, C_{\\mathrm{del}}}{1000}$. Since the problem specifies $r \\geq 1$, the deliverable capacity is limited by the positive electrode, so $C_{\\mathrm{del}} = C_{\\mathrm{pos}}$. Therefore, $E_{\\mathrm{area}}$ is constant for a given cell design:\n$$E_{\\mathrm{area}} = \\frac{V_{\\mathrm{avg}} \\, C_{\\mathrm{pos}}}{1000}$$\nThe total mass per unit area, $m_{\\mathrm{area}}$, is the sum of the active positive mass ($m_{\\mathrm{pos}}$), active negative mass ($m_{\\mathrm{neg}}$), and inactive mass ($m_{\\mathrm{inact}}$):\n$$m_{\\mathrm{area}}(r) = m_{\\mathrm{pos}} + m_{\\mathrm{neg}}(r) + m_{\\mathrm{inact}}$$\nUsing the definition $C = qm$, we have $m_{\\mathrm{pos}} = \\dfrac{C_{\\mathrm{pos}}}{q_{\\mathrm{pos}}}$ and $m_{\\mathrm{neg}}(r) = \\dfrac{C_{\\mathrm{neg}}(r)}{q_{\\mathrm{neg}}}$. Since $r = \\dfrac{C_{\\mathrm{neg}}}{C_{\\mathrm{pos}}}$, we can write $m_{\\mathrm{neg}}(r) = \\dfrac{r \\, C_{\\mathrm{pos}}}{q_{\\mathrm{neg}}}$. Note that $m_{\\mathrm{inact}}$ is given in $\\mathrm{mg/cm^2}$ and must be converted to $\\mathrm{g/cm^2}$ by dividing by $1000$. Substituting these into the mass equation:\n$$m_{\\mathrm{area}}(r) = \\frac{C_{\\mathrm{pos}}}{q_{\\mathrm{pos}}} + \\frac{r \\, C_{\\mathrm{pos}}}{q_{\\mathrm{neg}}} + m_{\\mathrm{inact}}$$\nThe gravimetric energy density in $\\mathrm{Wh/kg}$ is then:\n$$E_{\\mathrm{grav}}(r) = \\frac{E_{\\mathrm{area}}}{m_{\\mathrm{area}}(r) / 1000} = \\frac{V_{\\mathrm{avg}} \\, C_{\\mathrm{pos}}}{m_{\\mathrm{area}}(r)} = \\frac{V_{\\mathrm{avg}} \\, C_{\\mathrm{pos}}}{\\frac{C_{\\mathrm{pos}}}{q_{\\mathrm{pos}}} + \\frac{r \\, C_{\\mathrm{pos}}}{q_{\\mathrm{neg}}} + m_{\\mathrm{inact}}}$$\nThis can be simplified to:\n$$E_{\\mathrm{grav}}(r) = \\frac{V_{\\mathrm{avg}}}{\\frac{1}{q_{\\mathrm{pos}}} + \\frac{r}{q_{\\mathrm{neg}}} + \\frac{m_{\\mathrm{inact}}}{C_{\\mathrm{pos}}}}$$\nThis expression clearly shows that as $r$ increases, the denominator increases, and thus $E_{\\mathrm{grav}}(r)$ is a strictly decreasing function of $r$.\n\nThe idealized cycle life, $N$, is determined by the consumption of the lithium inventory margin, $M$. The margin is the excess negative electrode capacity: $M(r) = (r - 1) \\, C_{\\mathrm{pos}}$. With a constant irreversible capacity loss per cycle, $Q_{\\mathrm{irr}}$, the cycle life is:\n$$N(r) = \\frac{M(r)}{Q_{\\mathrm{irr}}} = \\frac{(r - 1) \\, C_{\\mathrm{pos}}}{Q_{\\mathrm{irr}}}$$\nThis expression shows that $N(r)$ is a linearly increasing function of $r$.\n\nThe multiobjective optimization problem consists of finding a balance between maximizing $E_{\\mathrm{grav}}(r)$ (which favors small $r$) and maximizing $N(r)$ (which favors large $r$). This is achieved by creating a composite weighted score, $S(r)$. First, the objectives are normalized.\nThe gravimetric energy density is normalized over the search range using min-max scaling. Let $E_{\\mathrm{grav\\_vals}}$ be the set of all $E_{\\mathrm{grav}}(r)$ values for $r$ in the discrete grid. Then $E_{\\max} = \\max(E_{\\mathrm{grav\\_vals}})$ and $E_{\\min} = \\min(E_{\\mathrm{grav\\_vals}})$. The normalized score is:\n$$E_{\\mathrm{norm}}(r) = \\frac{E_{\\mathrm{grav}}(r) - E_{\\min}}{E_{\\max} - E_{\\min}}$$\nA special case where $E_{\\max} = E_{\\min}$ results in $E_{\\mathrm{norm}}(r)=0.0$.\nThe cycle life is capped at a reference value $N_{\\mathrm{ref}}$ and normalized:\n$$N_{\\mathrm{norm}}(r) = \\frac{\\min(N(r), N_{\\mathrm{ref}})}{N_{\\mathrm{ref}}}$$\nThe composite score function $S(r)$ is a weighted sum of these normalized objectives:\n$$S(r) = w_{E} \\, E_{\\mathrm{norm}}(r) + w_{N} \\, N_{\\mathrm{norm}}(r)$$\nwhere $w_E$ and $w_N$ are the respective weights. The optimal ratio, $r^{\\star}$, is the value of $r$ that maximizes $S(r)$:\n$$r^{\\star} = \\arg\\max_{r \\in \\{r_i\\}} S(r)$$\nwhere $\\{r_i\\}$ is the discrete grid of points from $r_{\\min}$ to $r_{\\max}$. The problem specifies that ties in the maximum score must be resolved by selecting the smallest corresponding value of $r$.\n\nThe algorithmic implementation follows this methodology. For each test case:\n1.  A discrete grid of $r$ values is generated from $r_{\\min}$ to $r_{\\max}$ with step $\\Delta r$. To ensure numerical stability and inclusion of the endpoint, this is implemented using a function like `numpy.linspace`.\n2.  Using this grid, the corresponding values for $E_{\\mathrm{grav}}(r)$ and $N(r)$ are calculated for all points simultaneously using vectorized operations provided by the `NumPy` library.\n3.  The normalization procedures are applied to the resulting arrays of $E_{\\mathrm{grav}}$ and $N$ values.\n4.  The score array $S(r)$ is computed.\n5.  The index of the maximum score is found. `NumPy`'s `argmax` function is suitable as it returns the index of the first occurrence of the maximum value, which naturally satisfies the tie-breaking rule because our grid of $r$ values is sorted in increasing order.\n6.  The optimal ratio $r^{\\star}$ is retrieved from the grid at this index.\n7.  The final result is rounded to four decimal places and formatted as specified.\nThis process is encapsulated in a function that is called for each test case, and the results are aggregated for the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef find_optimal_ratio(params):\n    \"\"\"\n    Computes the optimal N/P ratio for a single cell design.\n\n    Args:\n        params (tuple): A tuple containing all the parameters for a cell design.\n\n    Returns:\n        float: The optimal N/P ratio, not yet rounded.\n    \"\"\"\n    (C_pos, q_neg, q_pos, V_avg, m_inact_mg, \n     Q_irr, N_ref, w_E, w_N, \n     r_min, r_max, dr) = params\n\n    # Unit conversion: mg/cm^2 to g/cm^2\n    m_inact = m_inact_mg / 1000.0\n\n    # Step 1: Create a uniform grid for the N/P ratio 'r'\n    # Use np.linspace for numerical stability and to include the endpoint.\n    num_points = int(round((r_max - r_min) / dr)) + 1\n    r_grid = np.linspace(r_min, r_max, num_points)\n\n    # Step 2: Calculate objectives E_grav and N as functions of r\n    \n    # Calculate constant terms for the cell\n    m_pos = C_pos / q_pos  # g/cm^2\n    E_area = (V_avg * C_pos) / 1000.0  # Wh/cm^2\n\n    # Calculate arrays for r-dependent quantities\n    m_neg_values = (r_grid * C_pos) / q_neg  # g/cm^2\n    m_area_values = m_pos + m_neg_values + m_inact  # g/cm^2\n    \n    # Gravimetric energy density in Wh/kg\n    # The division by 1000 converts m_area from g/cm^2 to kg/cm^2 for the final unit.\n    E_grav_values = E_area / (m_area_values / 1000.0)\n\n    # Idealized cycle life based on lithium inventory margin\n    M_values = (r_grid - 1.0) * C_pos  # mAh/cm^2\n    N_values = M_values / Q_irr  # cycles\n\n    # Step 3: Normalize the objectives\n    \n    # Normalize E_grav\n    E_max = np.max(E_grav_values)\n    E_min = np.min(E_grav_values)\n    E_range = E_max - E_min\n    \n    if E_range == 0.0:\n        E_norm_values = np.zeros_like(r_grid)\n    else:\n        E_norm_values = (E_grav_values - E_min) / E_range\n        \n    # Cap and normalize N\n    N_norm_values = np.minimum(N_values, N_ref) / N_ref\n\n    # Step 4: Combine objectives into a weighted score S(r)\n    S_values = w_E * E_norm_values + w_N * N_norm_values\n\n    # Step 5: Find the optimal r that maximizes S(r)\n    # np.argmax() returns the index of the first maximum value,\n    # which corresponds to the smallest r due to the sorted r_grid.\n    # This fulfills the tie-breaking condition.\n    optimal_idx = np.argmax(S_values)\n    optimal_r = r_grid[optimal_idx]\n\n    return optimal_r\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results in the specified format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (C_pos, q_neg, q_pos, V_avg, m_inact, Q_irr, N_ref, w_E, w_N, r_min, r_max, dr)\n        (4.0, 355.0, 180.0, 3.7, 12.0, 0.0005, 1000.0, 0.5, 0.5, 1.02, 1.30, 0.0005),\n        (4.0, 350.0, 180.0, 3.65, 12.0, 0.0015, 800.0, 0.3, 0.7, 1.05, 1.50, 0.001),\n        (3.0, 360.0, 170.0, 3.6, 20.0, 0.0006, 1200.0, 0.8, 0.2, 1.01, 1.20, 0.0005),\n        (2.0, 355.0, 185.0, 3.7, 10.0, 0.0002, 1500.0, 0.4, 0.6, 1.01, 1.15, 0.0005),\n        (4.5, 355.0, 200.0, 3.75, 15.0, 0.0001, 2000.0, 0.9, 0.1, 1.005, 1.10, 0.0005),\n    ]\n\n    results = []\n    for case in test_cases:\n        optimal_r = find_optimal_ratio(case)\n        results.append(optimal_r)\n\n    # Format the final output string as required: rounded to four decimal places.\n    # E.g., [1.1250, 1.3000, 1.0100, 1.1500, 1.0050]\n    output_str = f\"[{','.join(['{:.4f}'.format(res) for res in results])}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}