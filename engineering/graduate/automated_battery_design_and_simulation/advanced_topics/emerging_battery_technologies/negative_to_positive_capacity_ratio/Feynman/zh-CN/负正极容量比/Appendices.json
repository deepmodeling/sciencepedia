{
    "hands_on_practices": [
        {
            "introduction": "精确的电极容量平衡是实现锂离子电池高性能和安全性的基石。在首次充放电循环中，负极表面会形成固体电解质界面（SEI），这一过程会不可逆地消耗部分锂离子，从而影响电池的实际容量平衡。本练习将通过第一性原理推导，指导您如何量化这一初始容量损失，并计算实现目标N/P比所需的正极过量设计系数，这是所有电池设计工程师必须掌握的基本技能。",
            "id": "2496809",
            "problem": "一个锂离子全电池由石墨负极和层状氧化物正极组装而成。主体材料的面可逆容量对于负极为 $C_{a}$，对于正极为 $C_{c}$，单位为 $\\mathrm{mAh \\, cm^{-2}}$。在首次化成循环期间，石墨电极上会形成固体电解质界面（SEI），该过程不可逆地消耗锂，其面不可逆容量为 $C_{\\mathrm{irr}}$。电池未经预锂化，因此初始的锂库存完全由正极提供。假设除了不可逆损失外，两种主体材料的利用都是理想的，除了SEI形成之外的副反应可以忽略不计，并且没有动力学限制。\n\n利用锂的质量平衡和负极与正极容量比（N/P比）的定义，从第一性原理出发，推导初始可循环锂库存损失 $L_{0}$ 和所需的正极过量系数 $f$ 的表达式，使得SEI形成后N/P比等于 $r_{\\ast}$。此处，化成后的目标N/P比 $r_{\\ast}$ 定义为负极主体容量与可循环正极容量之比。其中，过量系数定义为 $f = C_{c}^{\\prime}/C_{c}$，其中 $C_{c}^{\\prime}$ 是过量设计后的正极容量。\n\n然后，使用给定的数值 $C_{a} = 3.60 \\ \\mathrm{mAh \\, cm^{-2}}$，$C_{c} = 3.20 \\ \\mathrm{mAh \\, cm^{-2}}$，$C_{\\mathrm{irr}} = 0.12 \\ \\mathrm{mAh \\, cm^{-2}}$ 和 $r_{\\ast} = 1.10$ 对 $f$ 进行数值计算。将最终的过量系数表示为一个无量纲数，并将答案四舍五入到四位有效数字。",
            "solution": "首先对问题陈述进行验证。\n\n逐字提取给定条件：\n- 负极的面可逆容量：$C_{a}$，单位 $\\mathrm{mAh \\, cm^{-2}}$。\n- 正极的面可逆容量：$C_{c}$，单位 $\\mathrm{mAh \\, cm^{-2}}$。\n- SEI形成的面不可逆容量：$C_{\\mathrm{irr}}$，单位 $\\mathrm{mAh \\, cm^{-2}}$。\n- 初始锂库存完全来自正极（无预锂化）。\n- 化成后的目标负极与正极容量比：$r_{\\ast}$，定义为负极主体容量与可循环正极容量之比。\n- 正极过量系数：$f = C_{c}^{\\prime}/C_{c}$，其中 $C_{c}^{\\prime}$ 是过量设计后的正极容量。\n\n问题要求推导初始可循环锂库存损失 $L_{0}$ 和正极过量系数 $f$ 的表达式，然后对 $f$ 进行数值计算。\n\n验证结论：该问题在科学上基于电化学和电池工程的原理，特别是关于电池平衡的原理。问题陈述清晰，提供了推导唯一解所需的所有参数和定义。语言客观，数值在物理上是现实的。因此，该问题被认定为有效。\n\n解题过程从第一性原理出发。\n\n设 $C_{c}^{\\prime}$ 为设计的正极面容量。由于正极是唯一的锂源，电池中的总初始锂库存 $Q_{\\mathrm{Li,total}}$ 对应于此容量。\n$$Q_{\\mathrm{Li,total}} = C_{c}^{\\prime}$$\n在首次充电循环中，相当于容量 $C_{\\mathrm{irr}}$ 的锂被不可逆地消耗，用于在负极表面形成固体电解质界面（SEI）。这部分锂从可循环库存中永久损失。剩余的可用于在电极之间后续循环的锂，即为可循环锂库存 $Q_{\\mathrm{cyc}}$。\n$$Q_{\\mathrm{cyc}} = Q_{\\mathrm{Li,total}} - C_{\\mathrm{irr}} = C_{c}^{\\prime} - C_{\\mathrm{irr}}$$\n问题指定了化成后的目标负极与正极容量比 $r_{\\ast}$。该比率定义为负极主体容量除以可循环正极容量。\n$$r_{\\ast} = \\frac{\\text{Anode host capacity}}{\\text{Cyclable positive capacity}}$$\n负极主体容量是其可逆容量，给定为 $C_{a}$。可循环正极容量由可以与正极可逆交换的锂量决定，这恰好是可循环锂库存 $Q_{\\mathrm{cyc}}$。因此，$r_{\\ast}$ 的定义变为：\n$$r_{\\ast} = \\frac{C_{a}}{Q_{\\mathrm{cyc}}}$$\n根据这个关系，我们可以表达出满足设计目标所需的可循环库存：\n$$Q_{\\mathrm{cyc}} = \\frac{C_{a}}{r_{\\ast}}$$\n通过令 $Q_{\\mathrm{cyc}}$ 的两个表达式相等，我们建立了一个锂的质量平衡，它将设计的正极容量与电极属性和目标比率联系起来。\n$$C_{c}^{\\prime} - C_{\\mathrm{irr}} = \\frac{C_{a}}{r_{\\ast}}$$\n求解设计的正极容量 $C_{c}^{\\prime}$ 得到：\n$$C_{c}^{\\prime} = \\frac{C_{a}}{r_{\\ast}} + C_{\\mathrm{irr}}$$\n该方程规定了在考虑初始不可逆损失后，为实现期望的N/P比，正极材料所需的总容量。\n\n现在我们推导所要求的两个量的表达式。\n\n首先，是初始可循环锂库存损失 $L_{0}$。它被定义为被不可逆消耗的锂占总初始锂库存的比例。\n$$L_{0} = \\frac{\\text{Irreversible Li loss}}{\\text{Total initial Li inventory}} = \\frac{C_{\\mathrm{irr}}}{Q_{\\mathrm{Li,total}}} = \\frac{C_{\\mathrm{irr}}}{C_{c}^{\\prime}}$$\n代入推导出的 $C_{c}^{\\prime}$ 表达式，我们得到 $L_{0}$ 的最终表达式：\n$$L_{0} = \\frac{C_{\\mathrm{irr}}}{\\frac{C_{a}}{r_{\\ast}} + C_{\\mathrm{irr}}}$$\n其次，是正极过量系数 $f$。它定义为 $f = C_{c}^{\\prime} / C_{c}$。代入 $C_{c}^{\\prime}$ 的表达式得到：\n$$f = \\frac{\\frac{C_{a}}{r_{\\ast}} + C_{\\mathrm{irr}}}{C_{c}} = \\frac{1}{C_{c}}\\left(\\frac{C_{a}}{r_{\\ast}} + C_{\\mathrm{irr}}\\right)$$\n这就是所要求的过量系数的表达式。\n\n最后，我们使用给定的数据对 $f$ 进行数值计算：$C_{a} = 3.60 \\ \\mathrm{mAh \\, cm^{-2}}$，$C_{c} = 3.20 \\ \\mathrm{mAh \\, cm^{-2}}$，$C_{\\mathrm{irr}} = 0.12 \\ \\mathrm{mAh \\, cm^{-2}}$，以及 $r_{\\ast} = 1.10$。\n$$f = \\frac{1}{3.20} \\left( \\frac{3.60}{1.10} + 0.12 \\right)$$\n首先，我们计算括号内的项：\n$$\\frac{3.60}{1.10} + 0.12 \\approx 3.272727... + 0.12 = 3.392727...$$\n然后，我们完成 $f$ 的计算：\n$$f = \\frac{3.392727...}{3.20} \\approx 1.060227...$$\n根据要求将结果四舍五入到四位有效数字，得到最终的数值答案。\n$$f \\approx 1.060$$\n这个系数表明，为了补偿SEI损失并达到1.10的目标N/P比，正极的面容量设计值必须比初始参考容量 $C_c$ 大约 $6\\%$。",
            "answer": "$$\\boxed{1.060}$$"
        },
        {
            "introduction": "在静态设计之后，理解N/P比如何影响电池的动态性能至关重要。通过简化的单颗粒模型（SPM），我们可以模拟电池在恒流放电过程中的行为，并观察N/P比如何决定电池的可用容量是由正极还是负极限制。这项实践将让您构建一个准静态仿真程序，以确定在不同N/P比设计下，电池的实际输出容量受限于电极材料的化学计量窗口还是工作电压窗口，从而深化对性能瓶颈的理解。",
            "id": "3932025",
            "problem": "设计并实现一个程序，在一个简化的 Doyle–Fuller–Newman (DFN) 和单颗粒模型 (SPM) 框架下，评估负极与正极的容量比（N/P比）对锂离子电池可用放电容量的影响。目标是计算在恒流放电下的放出容量，直到满足以下三个截止标准中最早出现的一个：(i) 负极达到其化学计量下限，(ii) 正极达到其化学计量上限，或 (iii) 端电压达到指定的截止电压。\n\n从以下具有物理基础的基准出发：\n- 电荷守恒和法拉第定律意味着，在恒定施加电流 $I$ 的情况下，固相化学计量随时间线性演化，遵循以下公式：\n$$\n\\frac{d\\theta_{\\mathrm{n}}}{dt} = - \\frac{I}{r\\,Q_{\\mathrm{p}}}, \\qquad \\frac{d\\theta_{\\mathrm{p}}}{dt} = + \\frac{I}{Q_{\\mathrm{p}}},\n$$\n其中 $r$ 是负极与正极的容量比 $r = Q_{\\mathrm{n}}/Q_{\\mathrm{p}}$，$Q_{\\mathrm{p}}$ 是以安时（$\\mathrm{A \\cdot h}$）表示的正极容量，$\\theta_{\\mathrm{n}}$ 和 $\\theta_{\\mathrm{p}}$ 分别是负极和正极的无量纲化学计量。\n- 使用准静态单颗粒模型 (SPM) 假设：球形扩散速度足够快，颗粒内部梯度可忽略不计；动力学足够快，反应过电势可忽略不计，因此端电压为：\n$$\nV(t) = U_{\\mathrm{p}}\\big(\\theta_{\\mathrm{p}}(t)\\big) - U_{\\mathrm{n}}\\big(\\theta_{\\mathrm{n}}(t)\\big) - I\\,R_{\\Omega},\n$$\n其中 $R_{\\Omega}$ 是以 $\\mathrm{\\Omega}$ 为单位的集总欧姆电阻，$U_{\\mathrm{p}}$ 和 $U_{\\mathrm{n}}$ 分别是作为化学计量函数的正极和负极的开路电势 (OCP)。\n- 开路电势由平滑、单调、物理上合理的代理模型指定：\n$$\nU_{\\mathrm{p}}(\\theta) = 4.2 - 0.8\\,\\theta - 0.1\\,\\sin\\!\\big(\\pi\\,\\theta\\big),\n$$\n$$\nU_{\\mathrm{n}}(\\theta) = 0.07 + 0.25\\,(1-\\theta) + 0.03\\,\\sin\\!\\big(\\pi\\,(1-\\theta)\\big),\n$$\n其中 $\\theta \\in [0,1]$。\n- 初始化学计量和允许窗口由下式给出：\n$$\n\\theta_{\\mathrm{n}}(0) = \\theta_{\\mathrm{n},0} = 0.90,\\quad \\theta_{\\mathrm{p}}(0) = \\theta_{\\mathrm{p},0} = 0.05,\n$$\n$$\n\\theta_{\\mathrm{n}} \\in [\\theta_{\\mathrm{n},\\min},\\theta_{\\mathrm{n},\\max}] = [0.05, 0.90],\\quad \\theta_{\\mathrm{p}} \\in [\\theta_{\\mathrm{p},\\min},\\theta_{\\mathrm{p},\\max}] = [0.05, 0.98].\n$$\n这些反映了一个实际的利用窗口，而无需引用详细的相变平台。\n\n给定恒流放电，候选的截止时间为：\n- 负极化学计量边界：\n$$\nt_{\\mathrm{n,\\,bound}} = \\frac{\\theta_{\\mathrm{n},0}-\\theta_{\\mathrm{n},\\min}}{I/(r\\,Q_{\\mathrm{p}})} = \\big(\\theta_{\\mathrm{n},0}-\\theta_{\\mathrm{n},\\min}\\big)\\,\\frac{r\\,Q_{\\mathrm{p}}}{I}.\n$$\n- 正极化学计量边界：\n$$\nt_{\\mathrm{p,\\,bound}} = \\frac{\\theta_{\\mathrm{p},\\max}-\\theta_{\\mathrm{p},0}}{I/Q_{\\mathrm{p}}} = \\big(\\theta_{\\mathrm{p},\\max}-\\theta_{\\mathrm{p},0}\\big)\\,\\frac{Q_{\\mathrm{p}}}{I}.\n$$\n- 电压截止时间 $t_{\\mathrm{V}}$ 被隐式定义为满足以下条件的最早时间 $t \\ge 0$：\n$$\nU_{\\mathrm{p}}\\big(\\theta_{\\mathrm{p}}(t)\\big) - U_{\\mathrm{n}}\\big(\\theta_{\\mathrm{n}}(t)\\big) - I\\,R_{\\Omega} = V_{\\mathrm{cut}},\n$$\n其中截止电压 $V_{\\mathrm{cut}}$ 以 $\\mathrm{V}$ 为单位给出。\n\n将最终放电时间定义为\n$$\nt_{\\mathrm{final}} = \\min\\big(t_{\\mathrm{n,\\,bound}},\\,t_{\\mathrm{p,\\,bound}},\\,t_{\\mathrm{V}}\\big),\n$$\n将放出容量定义为\n$$\nC_{\\mathrm{del}} = I\\,t_{\\mathrm{final}},\n$$\n以安时（$\\mathrm{A \\cdot h}$）表示。在求解 $t_{\\mathrm{V}}$ 时，将搜索限制在区间 $[0, \\min(t_{\\mathrm{n,\\,bound}}, t_{\\mathrm{p,\\,bound}})]$ 内，如果在此上界的电压仍高于截止电压，则认为 $t_{\\mathrm{V}}$ 未被激活。\n\n实现一个算法，该算法：\n- 使用上述定义线性演化化学计量。\n- 准静态地评估电压函数 $V(t)$。\n- 计算三个候选的截止时间，并为每个测试用例返回 $C_{\\mathrm{del}}$。\n\n单位和数值要求：\n- 所有电流 $I$ 的单位为 $\\mathrm{A}$。\n- 所有容量 $Q_{\\mathrm{p}}$ 和结果 $C_{\\mathrm{del}}$ 的单位必须为 $\\mathrm{A \\cdot h}$。\n- 电阻 $R_{\\Omega}$ 的单位为 $\\mathrm{\\Omega}$。\n- 电压的单位为 $\\mathrm{V}$。\n- 将每个最终容量结果表示为以 $\\mathrm{A \\cdot h}$ 为单位的小数。\n\n测试套件：\n使用以下五个参数集，每个参数集以元组 $(r, Q_{\\mathrm{p}}, I, R_{\\Omega}, V_{\\mathrm{cut}})$ 的形式给出：\n- 案例 1：$(0.95,\\ 2.0,\\ 1.0,\\ 0.05,\\ 3.0)$\n- 案例 2：$(1.09411765,\\ 2.0,\\ 1.0,\\ 0.05,\\ 3.0)$\n- 案例 3：$(1.50,\\ 2.0,\\ 1.0,\\ 0.05,\\ 3.0)$\n- 案例 4：$(1.10,\\ 2.0,\\ 1.0,\\ 0.20,\\ 3.0)$\n- 案例 5：$(1.10,\\ 1.0,\\ 1.0,\\ 0.05,\\ 3.0)$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含按上述案例顺序计算出的五个放出容量，格式为用方括号括起来的逗号分隔列表，例如：\n\"[c1,c2,c3,c4,c5]\".",
            "solution": "问题陈述已经过分析并被认为是有效的。它在科学上基于成熟的电池建模原理（简化的 Doyle-Fuller-Newman 框架），在数学上是适定的，并提供了一套完整且一致的定义、方程和参数。任务是计算在指定条件下锂离子电池的放出容量，这是电池工程和仿真中的一个标准问题。\n\n解决方案是遵循所提供的物理模型来开发的。问题的核心是在恒流放电期间跟踪电池的状态，并确定由于三个可能的限制因素之一导致放电终止的精确时刻。\n\n首先，我们定义系统的状态。状态由负极和正极的无量纲固相化学计量表示，分别记为 $\\theta_{\\mathrm{n}}$ 和 $\\theta_{\\mathrm{p}}$。在恒定的放电电流 $I$ 下，这些化学计量随时间 $t$ 线性演化。对给定的微分方程从时间 $t=0$ 开始积分，得到演化方程：\n$$\n\\theta_{\\mathrm{n}}(t) = \\theta_{\\mathrm{n}}(0) - \\frac{I}{r\\,Q_{\\mathrm{p}}} t\n$$\n$$\n\\theta_{\\mathrm{p}}(t) = \\theta_{\\mathrm{p}}(0) + \\frac{I}{Q_{\\mathrm{p}}} t\n$$\n其中 $\\theta_{\\mathrm{n}}(0) = \\theta_{\\mathrm{n},0} = 0.90$ 和 $\\theta_{\\mathrm{p}}(0) = \\theta_{\\mathrm{p},0} = 0.05$ 是初始条件。这里，$Q_{\\mathrm{p}}$ 是正极的容量，$r$ 是负极与正极的容量比。\n\n端电压 $V(t)$ 由单个电极的开路电势 (OCP) $U_{\\mathrm{p}}(\\theta_{\\mathrm{p}})$ 和 $U_{\\mathrm{n}}(\\theta_{\\mathrm{n}})$ 以及电池内阻 $R_{\\Omega}$ 上的欧姆压降决定：\n$$\nV(t) = U_{\\mathrm{p}}\\big(\\theta_{\\mathrm{p}}(t)\\big) - U_{\\mathrm{n}}\\big(\\theta_{\\mathrm{n}}(t)\\big) - I\\,R_{\\Omega}\n$$\nOCP 的具体函数形式如下：\n$$\nU_{\\mathrm{p}}(\\theta) = 4.2 - 0.8\\,\\theta - 0.1\\,\\sin\\!\\big(\\pi\\,\\theta\\big)\n$$\n$$\nU_{\\mathrm{n}}(\\theta) = 0.07 + 0.25\\,(1-\\theta) + 0.03\\,\\sin\\!\\big(\\pi\\,(1-\\theta)\\big)\n$$\n\n当三个可能的标准中第一个被满足时，放电过程终止。因此，我们必须计算每个标准被满足的时间。\n\n1.  **负极化学计量限制：** 如果 $\\theta_{\\mathrm{n}}(t)$ 下降到其指定的下限 $\\theta_{\\mathrm{n},\\min} = 0.05$，则放电停止。达到此限制的时间 $t_{\\mathrm{n,\\,bound}}$ 通过求解 $\\theta_{\\mathrm{n}}(t_{\\mathrm{n,\\,bound}}) = \\theta_{\\mathrm{n},\\min}$ 得到：\n    $$\n    t_{\\mathrm{n,\\,bound}} = \\frac{\\theta_{\\mathrm{n},0}-\\theta_{\\mathrm{n},\\min}}{I/(r\\,Q_{\\mathrm{p}})} = \\big(0.90-0.05\\big)\\,\\frac{r\\,Q_{\\mathrm{p}}}{I} = 0.85\\,\\frac{r\\,Q_{\\mathrm{p}}}{I}\n    $$\n\n2.  **正极化学计量限制：** 如果 $\\theta_{\\mathrm{p}}(t)$ 上升到其指定的上限 $\\theta_{\\mathrm{p},\\max} = 0.98$，则放电停止。达到此限制的时间 $t_{\\mathrm{p,\\,bound}}$ 通过求解 $\\theta_{\\mathrm{p}}(t_{\\mathrm{p,\\,bound}}) = \\theta_{\\mathrm{p},\\max}$ 得到：\n    $$\n    t_{\\mathrm{p,\\,bound}} = \\frac{\\theta_{\\mathrm{p},\\max}-\\theta_{\\mathrm{p},0}}{I/Q_{\\mathrm{p}}} = \\big(0.98-0.05\\big)\\,\\frac{Q_{\\mathrm{p}}}{I} = 0.93\\,\\frac{Q_{\\mathrm{p}}}{I}\n    $$\n\n3.  **电压截止限制：** 如果端电压 $V(t)$ 下降到截止值 $V_{\\mathrm{cut}}$，则放电停止。这定义了一个隐式时间 $t_{\\mathrm{V}}$，作为方程 $V(t) - V_{\\mathrm{cut}} = 0$ 的最小非负根：\n    $$\n    V(t) - V_{\\mathrm{cut}} = 0\n    $$\n    函数 $V(t)$ 在放电期间是严格单调递减的，这保证了如果存在解，该解是唯一的。问题指定，对 $t_{\\mathrm{V}}$ 的搜索必须限制在物理上可及的时间区间内，即 $[0, \\min(t_{\\mathrm{n,\\,bound}}, t_{\\mathrm{p,\\,bound}})]$。如果在此区间末端的电压仍高于 $V_{\\mathrm{cut}}$，则电压限制不是放电的约束条件。\n\n为每个测试用例找到放出容量的算法步骤如下：\n- 对于给定的一组参数 $(r, Q_{\\mathrm{p}}, I, R_{\\Omega}, V_{\\mathrm{cut}})$：\n- a. 计算显式的化学计量限制时间 $t_{\\mathrm{n,\\,bound}}$ 和 $t_{\\mathrm{p,\\,bound}}$。\n- b. 确定电压截止的最大搜索时间：$t_{\\mathrm{max\\_search}} = \\min(t_{\\mathrm{n,\\,bound}}, t_{\\mathrm{p,\\,bound}})$。\n- c. 定义函数 $f(t) = V(t) - V_{\\mathrm{cut}}$。\n- d. 检查电压截止时间 $t_{\\mathrm{V}}$。如果 $f(0) \\le 0$，则初始电压已低于截止电压，所以 $t_{\\mathrm{V}} = 0$。如果 $f(t_{\\mathrm{max\\_search}}) > 0$，则在允许的化学计量窗口内电压永远不会达到截止值，因此我们可以认为 $t_{\\mathrm{V}}$ 实际上是无限大（即不是最小时间）。否则，在区间 $[0, t_{\\mathrm{max\\_search}}]$ 内存在一个唯一的根 $f(t)=0$，必须使用数值求根算法来找到。`scipy.optimize.brentq` 中实现的 Brent 法因其稳健性和效率，是完成此任务的理想选择。\n- e. 最终放电时间是三个候选时间的最小值：\n    $$\n    t_{\\mathrm{final}} = \\min(t_{\\mathrm{n,\\,bound}}, t_{\\mathrm{p,\\,bound}}, t_{\\mathrm{V}})\n    $$\n- f. 放出容量 $C_{\\mathrm{del}}$ 是恒定电流与最终放电时间的乘积：\n    $$\n    C_{\\mathrm{del}} = I \\cdot t_{\\mathrm{final}}\n    $$\n\n对5个测试用例中的每一个都执行此程序，以生成最终的结果列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement as tuples of\n    # (r, Qp, I, R_omega, V_cut).\n    test_cases = [\n        (0.95, 2.0, 1.0, 0.05, 3.0),\n        (1.09411765, 2.0, 1.0, 0.05, 3.0),\n        (1.50, 2.0, 1.0, 0.05, 3.0),\n        (1.10, 2.0, 1.0, 0.20, 3.0),\n        (1.10, 1.0, 1.0, 0.05, 3.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        capacity = calculate_delivered_capacity(r, Qp, I, R_omega, V_cut)\n        # The problem asks for decimal numbers, so we format them.\n        # This formatting is for display and does not affect the calculation.\n        results.append(f\"{capacity:.8f}\".rstrip('0').rstrip('.'))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_delivered_capacity(r, Qp, I, R_omega, V_cut):\n    \"\"\"\n    Calculates the delivered discharge capacity for a single set of parameters.\n\n    Args:\n        r (float): Negative-to-positive capacity ratio.\n        Qp (float): Positive electrode capacity (A.h).\n        I (float): Constant discharge current (A).\n        R_omega (float): Lumped ohmic resistance (Ohm).\n        V_cut (float): Cutoff voltage (V).\n\n    Returns:\n        float: The delivered capacity in A.h.\n    \"\"\"\n    # Fixed parameters from the problem statement\n    theta_n0 = 0.90\n    theta_p0 = 0.05\n    theta_n_min = 0.05\n    theta_p_max = 0.98\n\n    # OCP surrogate functions\n    def Up(theta):\n        return 4.2 - 0.8 * theta - 0.1 * np.sin(np.pi * theta)\n\n    def Un(theta):\n        return 0.07 + 0.25 * (1 - theta) + 0.03 * np.sin(np.pi * (1 - theta))\n\n    # Stoichiometry evolution functions\n    def theta_n(t):\n        return theta_n0 - (I / (r * Qp)) * t\n\n    def theta_p(t):\n        return theta_p0 + (I / Qp) * t\n    \n    # Terminal voltage function\n    def V(t):\n        return Up(theta_p(t)) - Un(theta_n(t)) - I * R_omega\n\n    # 1. Calculate stoichiometry-limited stopping times\n    # Division by zero protection for the academic case of I=0\n    if I == 0:\n        return 0.0\n        \n    t_n_bound = (theta_n0 - theta_n_min) * (r * Qp) / I\n    t_p_bound = (theta_p_max - theta_p0) * Qp / I\n\n    # 2. Determine voltage-limited stopping time, t_V\n    t_V = float('inf')\n    \n    # The search for t_V is restricted to the stoichiometry-limited time window\n    t_max_search = min(t_n_bound, t_p_bound)\n\n    # Function to find the root of: V(t) - V_cut = 0\n    func_for_rootfinder = lambda t: V(t) - V_cut\n\n    # Check boundary conditions for the root-finding\n    V_start = V(0)\n    if V_start = V_cut:\n        # If voltage is already at or below cutoff, discharge time is 0\n        t_V = 0.0\n    else:\n        # Check voltage at the end of the stoichiometry window\n        V_end = V(t_max_search)\n        if V_end = V_cut:\n            # A root exists in the interval [0, t_max_search]. Find it.\n            # brentq is a robust root-finding algorithm for a bracketed root.\n            t_V = brentq(func_for_rootfinder, 0, t_max_search)\n        # If V_end > V_cut, t_V remains infinity, as the voltage cutoff\n        # is not reached.\n\n    # 3. Determine the final discharge time\n    t_final = min(t_n_bound, t_p_bound, t_V)\n\n    # 4. Calculate delivered capacity\n    C_del = I * t_final\n    \n    return C_del\n\nsolve()\n```"
        },
        {
            "introduction": "选择最佳的N/P比本质上是在解决一个多目标的工程权衡问题：较低的N/P比有利于提升能量密度，而较高的N/P比则能提供更多的锂库存余量以延长循环寿命。本练习将指导您构建一个多目标优化模型，将能量密度和循环寿命这两个相互冲突的目标进行归一化和加权。通过执行离散搜索，您可以自动找到在特定设计要求下的最优N/P比，这代表了从理解参数到主动设计决策的关键一步。",
            "id": "3932019",
            "problem": "您必须编写一个完整、可运行的程序，为一组参数化的锂离子电池设计，通过解决重量能量密度和基于锂库存余量的循环寿命之间的多目标权衡问题，计算出最佳的负极与正极（N/P）容量比。该优化必须在指定的比率范围内，使用数值稳定的离散搜索方法严格执行。您的程序只能使用 Python 标准库和指定的科学计算库。\n\n请从以下适用于自动化电池设计和模拟的基本原理和核心定义开始：\n\n- 负极与正极容量比定义为 $r = \\dfrac{C_{\\mathrm{neg}}}{C_{\\mathrm{pos}}}$，其中 $C_{\\mathrm{neg}}$ 是可用的负极容量，$C_{\\mathrm{pos}}$ 是可用的正极容量，两者单位均为 $\\mathrm{mAh \\cdot cm^{-2}}$。实际应用的电池要求 $r \\geq 1$ 以避免析锂和锂库存耗尽。\n\n- 比容量通过 $C = q \\, m$ 将容量和质量关联起来，其中 $C$ 是容量（单位 $\\mathrm{mAh}$），$q$ 是比容量（单位 $\\mathrm{mAh \\cdot g^{-1}}$），$m$ 是质量（单位 $\\mathrm{g}$）。对于固定的正极面容量 $C_{\\mathrm{pos}}$（单位 $\\mathrm{mAh \\cdot cm^{-2}}$）以及比容量 $q_{\\mathrm{pos}}$ 和 $q_{\\mathrm{neg}}$，单位面积的活性物质质量分别为 $m_{\\mathrm{pos}} = \\dfrac{C_{\\mathrm{pos}}}{q_{\\mathrm{pos}}}$ 和 $m_{\\mathrm{neg}} = \\dfrac{r \\, C_{\\mathrm{pos}}}{q_{\\mathrm{neg}}}$（单位 $\\mathrm{g \\cdot cm^{-2}}$）。\n\n- 单位面积的总质量为 $m_{\\mathrm{area}} = m_{\\mathrm{pos}} + m_{\\mathrm{neg}} + m_{\\mathrm{inact}}$（单位 $\\mathrm{g \\cdot cm^{-2}}$），其中 $m_{\\mathrm{inact}}$ 代表非活性组分（集流体、隔膜、粘合剂及其他无容量贡献的成分）的质量（单位 $\\mathrm{mg \\cdot cm^{-2}}$）。\n\n- 单位面积的电池能量为 $E_{\\mathrm{area}} = V_{\\mathrm{avg}} \\, C_{\\mathrm{del}} / 1000$（单位 $\\mathrm{Wh \\cdot cm^{-2}}$），其中 $V_{\\mathrm{avg}}$ 是平均放电电压（单位 $\\mathrm{V}$），$C_{\\mathrm{del}}$ 是可释放容量（单位 $\\mathrm{mAh \\cdot cm^{-2}}$）。在 $r \\geq 1$ 的条件下，$C_{\\mathrm{del}} = C_{\\mathrm{pos}}$。\n\n- 重量能量密度为 $E_{\\mathrm{grav}} = \\dfrac{E_{\\mathrm{area}}}{m_{\\mathrm{area}} / 1000}$（单位 $\\mathrm{Wh/kg}$），使用 $1 \\, \\mathrm{g} = 10^{-3} \\, \\mathrm{kg}$ 进行单位转换。\n\n- 单位面积的锂库存余量为 $M = (r - 1) \\, C_{\\mathrm{pos}}$（单位 $\\mathrm{mAh \\cdot cm^{-2}}$），表示超出正极容量的过量负极容量。假设每圈的不可逆损失恒为 $Q_{\\mathrm{irr}}$（单位 $\\mathrm{mAh \\cdot cm^{-2} \\cdot cycle^{-1}}$），并且在此建模练习中忽略倍率和温度效应，仅从库存角度考虑的理想化循环寿命为 $N = \\dfrac{M}{Q_{\\mathrm{irr}}}$（单位：圈），假设损失是线性累积的。\n\n为构建一个适合数值优化的多目标权衡问题，且不提供任何捷径公式：\n\n1.  在搜索范围 $[r_{\\min}, r_{\\max}]$ 内对重量能量密度进行归一化：设 $E_{\\min}$ 和 $E_{\\max}$ 分别为在 $r$ 值网格上计算出的 $E_{\\mathrm{grav}}$ 的最小值和最大值。定义 $E_{\\mathrm{norm}}(r) = \\dfrac{E_{\\mathrm{grav}}(r) - E_{\\min}}{E_{\\max} - E_{\\min}}$。如果 $E_{\\max} = E_{\\min}$，则对所有 $r$ 定义 $E_{\\mathrm{norm}}(r) = 0.0$。\n\n2.  将循环寿命上限设为参考目标值 $N_{\\mathrm{ref}}$（单位：圈）并进行归一化：定义 $N_{\\mathrm{norm}}(r) = \\dfrac{\\min(N(r), N_{\\mathrm{ref}})}{N_{\\mathrm{ref}}}$。\n\n3.  通过凸加权和将目标函数组合起来 $S(r) = w_{E} \\, E_{\\mathrm{norm}}(r) + w_{N} \\, N_{\\mathrm{norm}}(r)$，其中 $w_{E}$ 和 $w_{N}$ 是非负权重，且 $w_{E} + w_{N} = 1$。最优比率为 $r^{\\star} = \\arg\\max_{r \\in [r_{\\min}, r_{\\max}]} S(r)$，若存在多个最优解，则选择最小的 $r$。\n\n您的程序必须针对每个测试用例，在从 $r_{\\min}$ 到 $r_{\\max}$（包含两端点）的均匀网格上以固定步长 $\\Delta r$ 扫描 $r$，使用上述定义计算 $E_{\\mathrm{grav}}(r)$ 和 $N(r)$，构建 $S(r)$，并返回四舍五入到四位小数的 $r^{\\star}$。所有内部计算必须在 $\\mathrm{SI}$ 一致单位下进行；具体来说，使用 $1 \\, \\mathrm{mg} = 10^{-3} \\, \\mathrm{g}$ 将 $\\mathrm{mg \\cdot cm^{-2}}$ 转换为 $\\mathrm{g \\cdot cm^{-2}}$，并使用 $1 \\, \\mathrm{g} = 10^{-3} \\, \\mathrm{kg}$ 将 $\\mathrm{g}$ 转换为 $\\mathrm{kg}$。能量密度必须以 $\\mathrm{Wh/kg}$ 计算，但最终报告的 $r^{\\star}$ 是无量纲的。\n\n实现程序以解决以下测试套件，这些测试涵盖了典型、边界和边缘场景；每个元组列出了 $(C_{\\mathrm{pos}}, q_{\\mathrm{neg}}, q_{\\mathrm{pos}}, V_{\\mathrm{avg}}, m_{\\mathrm{inact}}, Q_{\\mathrm{irr}}, N_{\\mathrm{ref}}, w_{E}, w_{N}, r_{\\min}, r_{\\max}, \\Delta r)$，其单位如上所述：\n\n- 测试 1：($C_{\\mathrm{pos}} = 4.0 \\, \\mathrm{mAh \\cdot cm^{-2}}$, $q_{\\mathrm{neg}} = 355.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $q_{\\mathrm{pos}} = 180.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $V_{\\mathrm{avg}} = 3.7 \\, \\mathrm{V}$, $m_{\\mathrm{inact}} = 12.0 \\, \\mathrm{mg \\cdot cm^{-2}}$, $Q_{\\mathrm{irr}} = 0.0005 \\, \\mathrm{mAh \\cdot cm^{-2} \\cdot cycle^{-1}}$, $N_{\\mathrm{ref}} = 1000.0$ cycles, $w_{E} = 0.5$, $w_{N} = 0.5$, $r_{\\min} = 1.02$, $r_{\\max} = 1.30$, $\\Delta r = 0.0005$)\n\n- 测试 2：($C_{\\mathrm{pos}} = 4.0 \\, \\mathrm{mAh \\cdot cm^{-2}}$, $q_{\\mathrm{neg}} = 350.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $q_{\\mathrm{pos}} = 180.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $V_{\\mathrm{avg}} = 3.65 \\, \\mathrm{V}$, $m_{\\mathrm{inact}} = 12.0 \\, \\mathrm{mg \\cdot cm^{-2}}$, $Q_{\\mathrm{irr}} = 0.0015 \\, \\mathrm{mAh \\cdot cm^{-2} \\cdot cycle^{-1}}$, $N_{\\mathrm{ref}} = 800.0$ cycles, $w_{E} = 0.3$, $w_{N} = 0.7$, $r_{\\min} = 1.05$, $r_{\\max} = 1.50$, $\\Delta r = 0.001$)\n\n- 测试 3：($C_{\\mathrm{pos}} = 3.0 \\, \\mathrm{mAh \\cdot cm^{-2}}$, $q_{\\mathrm{neg}} = 360.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $q_{\\mathrm{pos}} = 170.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $V_{\\mathrm{avg}} = 3.6 \\, \\mathrm{V}$, $m_{\\mathrm{inact}} = 20.0 \\, \\mathrm{mg \\cdot cm^{-2}}$, $Q_{\\mathrm{irr}} = 0.0006 \\, \\mathrm{mAh \\cdot cm^{-2} \\cdot cycle^{-1}}$, $N_{\\mathrm{ref}} = 1200.0$ cycles, $w_{E} = 0.8$, $w_{N} = 0.2$, $r_{\\min} = 1.01$, $r_{\\max} = 1.20$, $\\Delta r = 0.0005$)\n\n- 测试 4：($C_{\\mathrm{pos}} = 2.0 \\, \\mathrm{mAh \\cdot cm^{-2}}$, $q_{\\mathrm{neg}} = 355.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $q_{\\mathrm{pos}} = 185.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $V_{\\mathrm{avg}} = 3.7 \\, \\mathrm{V}$, $m_{\\mathrm{inact}} = 10.0 \\, \\mathrm{mg \\cdot cm^{-2}}$, $Q_{\\mathrm{irr}} = 0.0002 \\, \\mathrm{mAh \\cdot cm^{-2} \\cdot cycle^{-1}}$, $N_{\\mathrm{ref}} = 1500.0$ cycles, $w_{E} = 0.4$, $w_{N} = 0.6$, $r_{\\min} = 1.01$, $r_{\\max} = 1.15$, $\\Delta r = 0.0005$)\n\n- 测试 5：($C_{\\mathrm{pos}} = 4.5 \\, \\mathrm{mAh \\cdot cm^{-2}}$, $q_{\\mathrm{neg}} = 355.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $q_{\\mathrm{pos}} = 200.0 \\, \\mathrm{mAh \\cdot g^{-1}}$, $V_{\\mathrm{avg}} = 3.75 \\, \\mathrm{V}$, $m_{\\mathrm{inact}} = 15.0 \\, \\mathrm{mg \\cdot cm^{-2}}$, $Q_{\\mathrm{irr}} = 0.0001 \\, \\mathrm{mAh \\cdot cm^{-2} \\cdot cycle^{-1}}$, $N_{\\mathrm{ref}} = 2000.0$ cycles, $w_{E} = 0.9$, $w_{N} = 0.1$, $r_{\\min} = 1.005$, $r_{\\max} = 1.10$, $\\Delta r = 0.0005$)\n\n您的程序应生成单行输出，其中包含五个测试的最优比率，格式为逗号分隔的列表并用方括号括起，每个比率四舍五入到四位小数（例如，$[1.1234,1.2345,1.3456,1.4567,1.5678]$）。这些值是无量纲的，并且必须严格按照所描述的格式进行格式化，不得包含多余的空格或文本。",
            "solution": "问题陈述已经过严格验证，并被确定为有效。其科学依据植根于电化学工程的既定原理，问题定义明确，包含所有必要参数和清晰的目标，且没有歧义或矛盾。任务是通过平衡两个相互竞争的目标：重量能量密度（$E_{\\mathrm{grav}}$）和循环寿命（$N$），来寻找锂离子电池的最佳负极与正极（N/P）容量比，记为 $r$。\n\n解决方案是通过在指定的 $r$ 值范围 $[r_{\\min}, r_{\\max}]$ 内以步长 $\\Delta r$ 进行离散搜索来找到的。对于此搜索网格中的每个 $r$ 值，我们评估一个综合评分函数 $S(r)$，并找出使该分数最大化的比率 $r^{\\star}$。\n\n首先，我们建立两个目标作为 $r$ 的函数的数学模型。对于给定的测试用例，所有其他参数均被视为常数。提供的定义用于推导这些函数。\n\n重量能量密度 $E_{\\mathrm{grav}}$ 是单位面积的电池能量 $E_{\\mathrm{area}}$ 与单位面积的总质量 $m_{\\mathrm{area}}$ 之比。\n单位面积的能量由 $E_{\\mathrm{area}} = \\dfrac{V_{\\mathrm{avg}} \\, C_{\\mathrm{del}}}{1000}$ 给出。由于问题规定 $r \\geq 1$，可释放容量受正极限制，因此 $C_{\\mathrm{del}} = C_{\\mathrm{pos}}$。所以，对于给定的电池设计，$E_{\\mathrm{area}}$ 是一个常数：\n$$E_{\\mathrm{area}} = \\frac{V_{\\mathrm{avg}} \\, C_{\\mathrm{pos}}}{1000}$$\n单位面积的总质量 $m_{\\mathrm{area}}$ 是正极活性物质质量（$m_{\\mathrm{pos}}$）、负极活性物质质量（$m_{\\mathrm{neg}}$）和非活性物质质量（$m_{\\mathrm{inact}}$）的总和：\n$$m_{\\mathrm{area}}(r) = m_{\\mathrm{pos}} + m_{\\mathrm{neg}}(r) + m_{\\mathrm{inact}}$$\n使用定义 $C = qm$，我们有 $m_{\\mathrm{pos}} = \\dfrac{C_{\\mathrm{pos}}}{q_{\\mathrm{pos}}}$ 和 $m_{\\mathrm{neg}}(r) = \\dfrac{C_{\\mathrm{neg}}(r)}{q_{\\mathrm{neg}}}$。由于 $r = \\dfrac{C_{\\mathrm{neg}}}{C_{\\mathrm{pos}}}$，我们可以写出 $m_{\\mathrm{neg}}(r) = \\dfrac{r \\, C_{\\mathrm{pos}}}{q_{\\mathrm{neg}}}$。注意 $m_{\\mathrm{inact}}$ 以 $\\mathrm{mg \\cdot cm^{-2}}$ 为单位给出，必须通过除以 $1000$ 转换为 $\\mathrm{g \\cdot cm^{-2}}$。将这些代入质量方程：\n$$m_{\\mathrm{area}}(r) = \\frac{C_{\\mathrm{pos}}}{q_{\\mathrm{pos}}} + \\frac{r \\, C_{\\mathrm{pos}}}{q_{\\mathrm{neg}}} + m_{\\mathrm{inact}}$$\n重量能量密度（单位为 $\\mathrm{Wh/kg}$）则为：\n$$E_{\\mathrm{grav}}(r) = \\frac{E_{\\mathrm{area}}}{m_{\\mathrm{area}}(r) / 1000} = \\frac{V_{\\mathrm{avg}} \\, C_{\\mathrm{pos}}}{m_{\\mathrm{area}}(r)} = \\frac{V_{\\mathrm{avg}} \\, C_{\\mathrm{pos}}}{\\frac{C_{\\mathrm{pos}}}{q_{\\mathrm{pos}}} + \\frac{r \\, C_{\\mathrm{pos}}}{q_{\\mathrm{neg}}} + m_{\\mathrm{inact}}}$$\n这可以简化为：\n$$E_{\\mathrm{grav}}(r) = \\frac{V_{\\mathrm{avg}}}{\\frac{1}{q_{\\mathrm{pos}}} + \\frac{r}{q_{\\mathrm{neg}}} + \\frac{m_{\\mathrm{inact}}}{C_{\\mathrm{pos}}}}$$\n这个表达式清楚地表明，随着 $r$ 的增加，分母也增加，因此 $E_{\\mathrm{grav}}(r)$ 是 $r$ 的一个严格递减函数。\n\n理想化的循环寿命 $N$ 由锂库存余量 $M$ 的消耗决定。该余量是过量的负极容量：$M(r) = (r - 1) \\, C_{\\mathrm{pos}}$。在每圈不可逆容量损失恒为 $Q_{\\mathrm{irr}}$ 的情况下，循环寿命为：\n$$N(r) = \\frac{M(r)}{Q_{\\mathrm{irr}}} = \\frac{(r - 1) \\, C_{\\mathrm{pos}}}{Q_{\\mathrm{irr}}}$$\n这个表达式表明 $N(r)$ 是 $r$ 的一个线性递增函数。\n\n多目标优化问题在于找到一个平衡点，既要最大化 $E_{\\mathrm{grav}}(r)$（倾向于小的 $r$），又要最大化 $N(r)$（倾向于大的 $r$）。这通过创建一个综合加权分数 $S(r)$ 来实现。首先，对目标进行归一化。\n重量能量密度使用最小-最大缩放在搜索范围内进行归一化。设 $E_{\\mathrm{grav\\_vals}}$ 为离散网格中所有 $r$ 对应的 $E_{\\mathrm{grav}}(r)$ 值的集合。那么 $E_{\\max} = \\max(E_{\\mathrm{grav\\_vals}})$ 且 $E_{\\min} = \\min(E_{\\mathrm{grav\\_vals}})$。归一化分数为：\n$$E_{\\mathrm{norm}}(r) = \\frac{E_{\\mathrm{grav}}(r) - E_{\\min}}{E_{\\max} - E_{\\min}}$$\n在 $E_{\\max} = E_{\\min}$ 的特殊情况下，结果为 $E_{\\mathrm{norm}}(r)=0.0$。\n循环寿命被限制在参考值 $N_{\\mathrm{ref}}$ 并进行归一化：\n$$N_{\\mathrm{norm}}(r) = \\frac{\\min(N(r), N_{\\mathrm{ref}})}{N_{\\mathrm{ref}}}$$\n综合评分函数 $S(r)$ 是这些归一化目标的加权和：\n$$S(r) = w_{E} \\, E_{\\mathrm{norm}}(r) + w_{N} \\, N_{\\mathrm{norm}}(r)$$\n其中 $w_E$ 和 $w_N$ 是各自的权重。最优比率 $r^{\\star}$ 是使 $S(r)$ 最大化的 $r$ 值：\n$$r^{\\star} = \\arg\\max_{r \\in \\{r_i\\}} S(r)$$\n其中 $\\{r_i\\}$ 是从 $r_{\\min}$ 到 $r_{\\max}$ 的离散点网格。问题规定，当最大分数出现平局时，必须选择对应的最小 $r$ 值来解决。\n\n算法实现遵循此方法。对于每个测试用例：\n1.  从 $r_{\\min}$ 到 $r_{\\max}$ 以步长 $\\Delta r$ 生成一个 $r$ 值的离散网格。为确保数值稳定性和包含端点，这可以使用 `numpy.linspace` 之类的函数来实现。\n2.  使用此网格，利用 `NumPy` 库提供的向量化操作，同时计算所有点的相应 $E_{\\mathrm{grav}}(r)$ 和 $N(r)$ 值。\n3.  将归一化程序应用于得到的 $E_{\\mathrm{grav}}$ 和 $N$ 值数组。\n4.  计算得分数组 $S(r)$。\n5.  找到最大得分的索引。`NumPy` 的 `argmax` 函数很适合，因为它返回最大值的首次出现位置的索引，这自然满足了平局决胜规则，因为我们的 $r$ 值网格是按升序排列的。\n6.  从此索引处的网格中检索最优比率 $r^{\\star}$。\n7.  将最终结果四舍五入到四位小数，并按要求格式化。\n此过程被封装在一个函数中，对每个测试用例调用该函数，并将结果汇总以供最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef find_optimal_ratio(params):\n    \"\"\"\n    Computes the optimal N/P ratio for a single cell design.\n\n    Args:\n        params (tuple): A tuple containing all the parameters for a cell design.\n\n    Returns:\n        float: The optimal N/P ratio, not yet rounded.\n    \"\"\"\n    (C_pos, q_neg, q_pos, V_avg, m_inact_mg, \n     Q_irr, N_ref, w_E, w_N, \n     r_min, r_max, dr) = params\n\n    # Unit conversion: mg/cm^2 to g/cm^2\n    m_inact = m_inact_mg / 1000.0\n\n    # Step 1: Create a uniform grid for the N/P ratio 'r'\n    # Use np.linspace for numerical stability and to include the endpoint.\n    num_points = int(round((r_max - r_min) / dr)) + 1\n    r_grid = np.linspace(r_min, r_max, num_points)\n\n    # Step 2: Calculate objectives E_grav and N as functions of r\n    \n    # Calculate constant terms for the cell\n    m_pos = C_pos / q_pos  # g/cm^2\n    E_area = (V_avg * C_pos) / 1000.0  # Wh/cm^2\n\n    # Calculate arrays for r-dependent quantities\n    m_neg_values = (r_grid * C_pos) / q_neg  # g/cm^2\n    m_area_values = m_pos + m_neg_values + m_inact  # g/cm^2\n    \n    # Gravimetric energy density in Wh/kg\n    # The division by 1000 converts m_area from g/cm^2 to kg/cm^2 for the final unit.\n    E_grav_values = E_area / (m_area_values / 1000.0)\n\n    # Idealized cycle life based on lithium inventory margin\n    M_values = (r_grid - 1.0) * C_pos  # mAh/cm^2\n    N_values = M_values / Q_irr  # cycles\n\n    # Step 3: Normalize the objectives\n    \n    # Normalize E_grav\n    E_max = np.max(E_grav_values)\n    E_min = np.min(E_grav_values)\n    E_range = E_max - E_min\n    \n    if E_range == 0.0:\n        E_norm_values = np.zeros_like(r_grid)\n    else:\n        E_norm_values = (E_grav_values - E_min) / E_range\n        \n    # Cap and normalize N\n    N_norm_values = np.minimum(N_values, N_ref) / N_ref\n\n    # Step 4: Combine objectives into a weighted score S(r)\n    S_values = w_E * E_norm_values + w_N * N_norm_values\n\n    # Step 5: Find the optimal r that maximizes S(r)\n    # np.argmax() returns the index of the first maximum value,\n    # which corresponds to the smallest r due to the sorted r_grid.\n    # This fulfills the tie-breaking condition.\n    optimal_idx = np.argmax(S_values)\n    optimal_r = r_grid[optimal_idx]\n\n    return optimal_r\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results in the specified format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (C_pos, q_neg, q_pos, V_avg, m_inact, Q_irr, N_ref, w_E, w_N, r_min, r_max, dr)\n        (4.0, 355.0, 180.0, 3.7, 12.0, 0.0005, 1000.0, 0.5, 0.5, 1.02, 1.30, 0.0005),\n        (4.0, 350.0, 180.0, 3.65, 12.0, 0.0015, 800.0, 0.3, 0.7, 1.05, 1.50, 0.001),\n        (3.0, 360.0, 170.0, 3.6, 20.0, 0.0006, 1200.0, 0.8, 0.2, 1.01, 1.20, 0.0005),\n        (2.0, 355.0, 185.0, 3.7, 10.0, 0.0002, 1500.0, 0.4, 0.6, 1.01, 1.15, 0.0005),\n        (4.5, 355.0, 200.0, 3.75, 15.0, 0.0001, 2000.0, 0.9, 0.1, 1.005, 1.10, 0.0005),\n    ]\n\n    results = []\n    for case in test_cases:\n        optimal_r = find_optimal_ratio(case)\n        results.append(optimal_r)\n\n    # Format the final output string as required: rounded to four decimal places.\n    # E.g., [1.1250, 1.3000, 1.0100, 1.1500, 1.0050]\n    output_str = f\"[{','.join(['{:.4f}'.format(res) for res in results])}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}