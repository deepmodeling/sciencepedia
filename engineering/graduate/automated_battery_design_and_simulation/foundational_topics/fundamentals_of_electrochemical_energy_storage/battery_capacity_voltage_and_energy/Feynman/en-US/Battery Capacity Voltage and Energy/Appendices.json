{
    "hands_on_practices": [
        {
            "introduction": "While State of Charge ($\\\\text{SoC}$) is a ubiquitous metric for tracking battery capacity, it is the State of Energy ($\\\\text{SoE}$) that directly informs energy management decisions. This practice explores the fundamental, non-linear relationship between these two critical states. By deriving the discrepancy between $\\\\text{SoC}$ and $\\\\text{SoE}$ for a cell with a representative multi-plateau voltage profile , you will quantify the significant errors that can arise from conflating charge with energy, a crucial consideration for accurate battery gauging.",
            "id": "3894091",
            "problem": "A single electrochemical cell is discharged at constant current in an automated simulation environment. The open-circuit voltage is well-approximated by two quasi-flat plateaus due to two dominant phase transformations. For the first fraction $\\alpha$ of total charge capacity, the cell voltage remains near a higher plateau $V_{a}$, and for the remaining fraction $1-\\alpha$, the cell voltage remains near a lower plateau $V_{b}$. Assume negligible polarization so the terminal voltage equals the plateau voltage in each region during discharge. Let the State of Charge (SoC) be the fraction $s \\in [0,1]$ of total charge removed, and let the State of Energy (SoE) be the fraction of total electrical energy delivered up to SoC $s$, normalized by the total energy deliverable over a full discharge.\n\nStarting from first principles—charge conservation, the definition of electrical energy as the time integral of power, and the relation between delivered energy and the integral of voltage with respect to discharged charge—derive an expression for the difference $\\Delta(s) = \\text{SoE}(s) - \\text{SoC}(s)$ for this two-plateau cell. Then, for the specific case where $\\alpha = 0.4$, $V_{a} = 3.7\\,\\text{V}$, and $V_{b} = 3.2\\,\\text{V}$, determine the maximum absolute value of $\\Delta(s)$ over $s \\in [0,1]$, which quantifies the error incurred if the approximation $\\text{SoE} \\approx \\text{SoC}$ is assumed.\n\nExpress the final error as a dimensionless decimal. Round your answer to four significant figures.",
            "solution": "The problem is scientifically grounded, well-posed, and objective, making it valid for solution.\n\nLet $Q_{total}$ be the total charge capacity of the cell. The State of Charge, SoC, denoted by $s$, is the fraction of total charge removed. Thus, the charge removed, $q$, is related to $s$ by $q = s \\cdot Q_{total}$, where $s \\in [0,1]$.\n\nThe terminal voltage $V$ is given as a piecewise-constant function of the charge removed. It can be expressed as a function of the SoC, $s$:\n$$ V(s) = \\begin{cases} V_{a} & \\text{for } 0 \\le s \\le \\alpha \\\\ V_{b} & \\text{for } \\alpha < s \\le 1 \\end{cases} $$\nwhere $\\alpha$ is the fraction of capacity discharged at voltage $V_a$.\n\nThe total electrical energy $E_{total}$ delivered over a full discharge cycle ($s=0$ to $s=1$) is the integral of the voltage with respect to the charge removed, from $q=0$ to $q=Q_{total}$:\n$$ E_{total} = \\int_{0}^{Q_{total}} V(q) \\, dq $$\nWe can change the variable of integration to $s$ using $dq = Q_{total} \\, ds$:\n$$ E_{total} = \\int_{0}^{1} V(s) \\cdot Q_{total} \\, ds = Q_{total} \\left( \\int_{0}^{\\alpha} V_a \\, ds + \\int_{\\alpha}^{1} V_b \\, ds \\right) $$\n$$ E_{total} = Q_{total} \\left( V_a [s]_{0}^{\\alpha} + V_b [s]_{\\alpha}^{1} \\right) = Q_{total} (\\alpha V_a + (1-\\alpha)V_b) $$\nLet's define the average discharge voltage as $\\bar{V} = \\alpha V_a + (1-\\alpha)V_b$, so $E_{total} = \\bar{V} Q_{total}$.\n\nThe energy delivered up to an SoC of $s$, denoted $E(s)$, is given by:\n$$ E(s) = \\int_{0}^{s \\cdot Q_{total}} V(q') \\, dq' = Q_{total} \\int_{0}^{s} V(s') \\, ds' $$\nThis must be evaluated piecewise.\n\nFor $0 \\le s \\le \\alpha$:\n$$ E(s) = Q_{total} \\int_{0}^{s} V_a \\, ds' = Q_{total} V_a s $$\n\nFor $\\alpha < s \\le 1$:\n$$ E(s) = Q_{total} \\left( \\int_{0}^{\\alpha} V_a \\, ds' + \\int_{\\alpha}^{s} V_b \\, ds' \\right) = Q_{total} \\left( V_a \\alpha + V_b (s-\\alpha) \\right) $$\n\nThe State of Energy, SoE$(s)$, is the fraction of total energy delivered:\n$$ \\text{SoE}(s) = \\frac{E(s)}{E_{total}} = \\frac{E(s)}{Q_{total} \\bar{V}} $$\n\nFor $0 \\le s \\le \\alpha$:\n$$ \\text{SoE}(s) = \\frac{Q_{total} V_a s}{Q_{total} \\bar{V}} = \\frac{V_a}{\\bar{V}} s $$\n\nFor $\\alpha < s \\le 1$:\n$$ \\text{SoE}(s) = \\frac{Q_{total} (V_a \\alpha + V_b (s-\\alpha))}{Q_{total} \\bar{V}} = \\frac{\\alpha(V_a - V_b) + s V_b}{\\bar{V}} $$\n\nThe problem asks for the difference $\\Delta(s) = \\text{SoE}(s) - \\text{SoC}(s)$. Since $\\text{SoC}(s) = s$, we have:\n\nFor $0 \\le s \\le \\alpha$:\n$$ \\Delta(s) = \\frac{V_a}{\\bar{V}} s - s = s \\left( \\frac{V_a - \\bar{V}}{\\bar{V}} \\right) $$\nSubstituting $\\bar{V} = \\alpha V_a + (1-\\alpha) V_b$:\n$$ V_a - \\bar{V} = V_a - (\\alpha V_a + (1-\\alpha)V_b) = (1-\\alpha)V_a - (1-\\alpha)V_b = (1-\\alpha)(V_a - V_b) $$\nSo,\n$$ \\Delta(s) = s \\frac{(1-\\alpha)(V_a - V_b)}{\\alpha V_a + (1-\\alpha)V_b} $$\n\nFor $\\alpha < s \\le 1$:\n$$ \\Delta(s) = \\frac{\\alpha(V_a - V_b) + s V_b}{\\bar{V}} - s = \\frac{\\alpha(V_a - V_b) + s V_b - s \\bar{V}}{\\bar{V}} $$\nSubstituting for $s \\bar{V}$:\n$$ s \\bar{V} = s(\\alpha V_a + (1-\\alpha)V_b) = s \\alpha V_a + s V_b - s \\alpha V_b $$\nThe numerator becomes:\n$$ \\alpha(V_a - V_b) + s V_b - (s \\alpha V_a + s V_b - s \\alpha V_b) = \\alpha V_a - \\alpha V_b - s \\alpha V_a + s \\alpha V_b = \\alpha(V_a - V_b) (1-s) $$\nSo,\n$$ \\Delta(s) = \\frac{\\alpha(1-s)(V_a - V_b)}{\\alpha V_a + (1-\\alpha)V_b} $$\n\nIn summary, the expression for $\\Delta(s)$ is:\n$$ \\Delta(s) = \\frac{V_a - V_b}{\\alpha V_a + (1-\\alpha)V_b} \\times \\begin{cases} s(1-\\alpha) & \\text{for } 0 \\le s \\le \\alpha \\\\ \\alpha(1-s) & \\text{for } \\alpha < s \\le 1 \\end{cases} $$\nSince $V_a > V_b$, the prefactor is positive. The term inside the case is also non-negative for $s \\in [0,1]$. Thus, $\\Delta(s) \\ge 0$, and maximizing $|\\Delta(s)|$ is equivalent to maximizing $\\Delta(s)$.\nThe function $\\Delta(s)$ consists of two linear segments. For $s \\in [0, \\alpha]$, it increases linearly. For $s \\in [\\alpha, 1]$, it decreases linearly. The maximum value must therefore occur at the junction, $s=\\alpha$.\n$$ \\Delta_{max} = \\Delta(\\alpha) = \\frac{\\alpha(1-\\alpha)(V_a - V_b)}{\\alpha V_a + (1-\\alpha)V_b} $$\nNow, we substitute the specific values given: $\\alpha = 0.4$, $V_a = 3.7\\,\\text{V}$, and $V_b = 3.2\\,\\text{V}$.\n$$ \\Delta_{max} = \\frac{0.4(1-0.4)(3.7 - 3.2)}{0.4(3.7) + (1-0.4)(3.2)} $$\n$$ \\Delta_{max} = \\frac{0.4(0.6)(0.5)}{0.4(3.7) + 0.6(3.2)} $$\n$$ \\Delta_{max} = \\frac{0.12}{1.48 + 1.92} $$\n$$ \\Delta_{max} = \\frac{0.12}{3.40} $$\n$$ \\Delta_{max} = \\frac{12}{340} = \\frac{3}{85} \\approx 0.0352941176... $$\nRounding to four significant figures, we get $0.03529$.\nThis value represents the maximum absolute difference between the State of Energy and the State of Charge for the given cell model.",
            "answer": "$$\n\\boxed{0.03529}\n$$"
        },
        {
            "introduction": "The energy efficiency of a battery is limited by irreversible processes that manifest as voltage hysteresis and resistive heating. This exercise provides a hands-on method for quantifying these losses by integrating the difference between charge and discharge voltage curves derived from a realistic electrochemical model . Mastering this calculation connects the abstract parameters of a cell model to the tangible quantities of dissipated energy and heat generation, which are critical for designing efficient and thermally stable battery systems.",
            "id": "3894074",
            "problem": "In an automated battery design and simulation study, a rechargeable cell is cycled at constant current, first charging from zero State of Charge (SOC) to full SOC and then discharging back to zero SOC at the same magnitude of current. The State of Charge (SOC), denoted by $s$, is defined as $s = Q/Q_{\\max}$ where $Q$ is the total charge transferred since the start of the segment and $Q_{\\max}$ is the rated capacity in coulombs. The terminal voltage on the charge path, $V_{\\text{ch}}(s)$, and on the discharge path, $V_{\\text{dis}}(s)$, are modeled as\n$$\nV_{\\text{ch}}(s) = U(s) + H_{0}\\left(1 - \\exp(-\\lambda s)\\right) + R_{0}\\left(1 + \\gamma s\\right) I,\n$$\n$$\nV_{\\text{dis}}(s) = U(s) - H_{0}\\left(1 - \\exp(-\\lambda s)\\right) - R_{0}\\left(1 + \\gamma s\\right) I,\n$$\nwhere $U(s)$ is the equilibrium Open-Circuit Voltage (OCV) given by\n$$\nU(s) = U_{\\min} + \\Delta U\\, s + a \\ln\\!\\left(\\frac{s + \\varepsilon}{1 - s + \\varepsilon}\\right).\n$$\nThe constants are: $U_{\\min} = 3.2\\,\\text{V}$, $\\Delta U = 0.6\\,\\text{V}$, $a = 0.05\\,\\text{V}$, $\\varepsilon = 10^{-3}$, $H_{0} = 0.03\\,\\text{V}$, $\\lambda = 4$, $R_{0} = 0.05\\,\\Omega$, $\\gamma = 0.20$, and the constant current magnitude is $I = 5\\,\\text{A}$. The rated capacity is $Q_{\\max} = 2.5\\,\\text{Ah}$.\n\nStarting from the fundamental definition of electrical work $W = \\int V\\, dQ$ along a path in the $(V,Q)$ state space, compute the total irreversible work dissipated over the full charge-discharge cycle arising from path dependence (hysteresis and resistive polarization). Express the final energy in $\\text{kJ}$ and round your answer to four significant figures. Use $1\\,\\text{Ah} = 3600\\,\\text{C}$ to convert ampere-hours to coulombs. Assume uniform temperature and neglect any dynamic capacitive or diffusive transients beyond those captured by the given voltage models.",
            "solution": "The problem is valid as it is scientifically grounded in established battery modeling principles, well-posed with all necessary information provided, and objective in its formulation. No inconsistencies, ambiguities, or factual unsoundness were detected.\n\nThe task is to compute the total irreversible work dissipated over a full charge-discharge cycle. The fundamental definition of electrical work, $W$, done on a system is given by the integral of voltage $V$ with respect to charge $Q$:\n$$\nW = \\int V\\, dQ\n$$\nThe dissipated work over a closed cycle, $W_{\\text{dissipated}}$, is the net work done on the system, which corresponds to the area enclosed by the charge and discharge voltage curves in the $(V,Q)$ plane. The cycle consists of charging from an initial charge of $Q=0$ (corresponding to a State of Charge, SOC, of $s=0$) to a final charge of $Q=Q_{\\max}$ ($s=1$), followed by discharging from $Q=Q_{\\max}$ back to $Q=0$.\n\nMathematically, this cyclical integral is expressed as:\n$$\nW_{\\text{dissipated}} = \\oint V\\,dQ = \\int_{\\text{charge}} V_{\\text{ch}}(Q)\\,dQ + \\int_{\\text{discharge}} V_{\\text{dis}}(Q)\\,dQ\n$$\nThe charge path goes from $Q=0$ to $Q=Q_{\\max}$, and the discharge path goes from $Q=Q_{\\max}$ to $Q=0$. Therefore, we can write the integral as:\n$$\nW_{\\text{dissipated}} = \\int_{0}^{Q_{\\max}} V_{\\text{ch}}(Q)\\,dQ + \\int_{Q_{\\max}}^{0} V_{\\text{dis}}(Q)\\,dQ\n$$\nBy reversing the limits of the second integral, we introduce a negative sign:\n$$\nW_{\\text{dissipated}} = \\int_{0}^{Q_{\\max}} V_{\\text{ch}}(Q)\\,dQ - \\int_{0}^{Q_{\\max}} V_{\\text{dis}}(Q)\\,dQ = \\int_{0}^{Q_{\\max}} \\left(V_{\\text{ch}}(Q) - V_{\\text{dis}}(Q)\\right) dQ\n$$\nThe voltage models are provided as functions of the SOC, $s$, where $s = Q/Q_{\\max}$. We perform a change of variables for the integration. From the definition of $s$, we have $Q = s Q_{\\max}$, which implies that the differential charge is $dQ = Q_{\\max}\\,ds$. The integration limits for $s$ corresponding to $Q=0$ and $Q=Q_{\\max}$ are $s=0$ and $s=1$, respectively. The integral becomes:\n$$\nW_{\\text{dissipated}} = \\int_{0}^{1} \\left(V_{\\text{ch}}(s) - V_{\\text{dis}}(s)\\right) Q_{\\max}\\,ds\n$$\nNext, we find the expression for the voltage difference $V_{\\text{ch}}(s) - V_{\\text{dis}}(s)$ using the given models:\n$$\nV_{\\text{ch}}(s) = U(s) + H_{0}\\left(1 - \\exp(-\\lambda s)\\right) + R_{0}\\left(1 + \\gamma s\\right) I\n$$\n$$\nV_{\\text{dis}}(s) = U(s) - H_{0}\\left(1 - \\exp(-\\lambda s)\\right) - R_{0}\\left(1 + \\gamma s\\right) I\n$$\nSubtracting the second equation from the first, the equilibrium potential $U(s)$ cancels out:\n$$\nV_{\\text{ch}}(s) - V_{\\text{dis}}(s) = 2H_{0}\\left(1 - \\exp(-\\lambda s)\\right) + 2R_{0}I\\left(1 + \\gamma s\\right)\n$$\nThis difference represents the total overpotential due to hysteresis and internal resistance. The dissipated work is solely a function of these irreversible processes. Substituting this into the integral for $W_{\\text{dissipated}}$ gives:\n$$\nW_{\\text{dissipated}} = \\int_{0}^{1} \\left[ 2H_{0}\\left(1 - \\exp(-\\lambda s)\\right) + 2R_{0}I\\left(1 + \\gamma s\\right) \\right] Q_{\\max}\\,ds\n$$\n$$\nW_{\\text{dissipated}} = 2Q_{\\max} \\left[ \\int_{0}^{1} H_{0}\\left(1 - \\exp(-\\lambda s)\\right) ds + \\int_{0}^{1} R_{0}I\\left(1 + \\gamma s\\right) ds \\right]\n$$\nWe evaluate the two integrals separately. The first integral, associated with hysteresis loss, is:\n$$\n\\int_{0}^{1} H_{0}\\left(1 - \\exp(-\\lambda s)\\right) ds = H_{0} \\left[ s + \\frac{\\exp(-\\lambda s)}{\\lambda} \\right]_{0}^{1} = H_{0} \\left( \\left(1 + \\frac{\\exp(-\\lambda)}{\\lambda}\\right) - \\left(0 + \\frac{\\exp(0)}{\\lambda}\\right) \\right) = H_{0} \\left(1 - \\frac{1 - \\exp(-\\lambda)}{\\lambda}\\right)\n$$\nThe second integral, associated with ohmic and polarization resistance loss, is:\n$$\n\\int_{0}^{1} R_{0}I\\left(1 + \\gamma s\\right) ds = R_{0}I \\left[ s + \\frac{\\gamma s^2}{2} \\right]_{0}^{1} = R_{0}I \\left( \\left(1 + \\frac{\\gamma}{2}\\right) - (0) \\right) = R_{0}I \\left(1 + \\frac{\\gamma}{2}\\right)\n$$\nCombining these results gives the analytical expression for the total dissipated work:\n$$\nW_{\\text{dissipated}} = 2Q_{\\max} \\left[ H_{0} \\left(1 - \\frac{1 - \\exp(-\\lambda)}{\\lambda}\\right) + R_{0}I \\left(1 + \\frac{\\gamma}{2}\\right) \\right]\n$$\nNow we substitute the numerical values provided. First, the rated capacity $Q_{\\max}$ must be in SI units (Coulombs):\n$$\nQ_{\\max} = 2.5\\,\\text{Ah} = 2.5 \\times 3600\\,\\text{C} = 9000\\,\\text{C}\n$$\nThe other constants are: $H_{0} = 0.03\\,\\text{V}$, $\\lambda = 4$, $R_{0} = 0.05\\,\\Omega$, $I = 5\\,\\text{A}$, and $\\gamma = 0.20$.\n\nWe calculate the two terms within the brackets.\nThe hysteresis contribution term is:\n$$\nH_{0} \\left(1 - \\frac{1 - \\exp(-\\lambda)}{\\lambda}\\right) = 0.03 \\left(1 - \\frac{1 - \\exp(-4)}{4}\\right) \\approx 0.03 \\left(1 - \\frac{1 - 0.0183156}{4}\\right) \\approx 0.03 (0.7545789) \\approx 0.0226374\\,\\text{V}\n$$\nThe resistive contribution term is:\n$$\nR_{0}I \\left(1 + \\frac{\\gamma}{2}\\right) = (0.05 \\times 5) \\left(1 + \\frac{0.20}{2}\\right) = 0.25 (1 + 0.1) = 0.25 \\times 1.1 = 0.275\\,\\text{V}\n$$\nThe sum of these terms is the average voltage difference over the cycle:\n$$\n0.0226374\\,\\text{V} + 0.275\\,\\text{V} = 0.2976374\\,\\text{V}\n$$\nNow, we can compute the total dissipated work, which will be in Joules since all units are SI:\n$$\nW_{\\text{dissipated}} = 2 \\times 9000\\,\\text{C} \\times 0.2976374\\,\\text{V} = 18000 \\times 0.2976374\\,\\text{J} \\approx 5357.4732\\,\\text{J}\n$$\nThe problem requires the answer in kilojoules ($\\text{kJ}$) and rounded to four significant figures.\n$$\nW_{\\text{dissipated}} \\approx 5.3574732\\,\\text{kJ}\n$$\nRounding to four significant figures, we get:\n$$\nW_{\\text{dissipated}} \\approx 5.357\\,\\text{kJ}\n$$",
            "answer": "$$\n\\boxed{5.357}\n$$"
        },
        {
            "introduction": "Theoretical models provide insight, but real-world battery engineering relies on processing discrete, noisy experimental data. This practice bridges that gap by tasking you with developing a numerical quadrature scheme from first principles to calculate energy from sampled voltage-capacity points . More importantly, you will learn to rigorously quantify the uncertainty in your energy estimate, accounting for both the error from discretization and the noise inherent in measurements, a crucial skill for creating reliable and robust battery simulations and analyses.",
            "id": "3894066",
            "problem": "You are tasked with constructing a numerical quadrature scheme to compute battery energy from discretized voltage versus capacity data while providing principled uncertainty quantification. The energy of a cell over a measured capacity span is defined by the integral of voltage with respect to capacity. Start from the following fundamental bases only: (i) the definition of energy as the integral of voltage over charge, namely $$E=\\int_{Q_\\min}^{Q_\\max} V(Q)\\,dQ,$$ where $E$ is energy, $Q$ is capacity, and $V(Q)$ is the voltage as a function of capacity; (ii) standard properties of integrals and derivatives; and (iii) classical bounds for quadrature error derived from smoothness assumptions.\n\nDesign a scheme that, given a sequence of strictly increasing capacity samples $Q_0<Q_1<\\dots<Q_n$ with corresponding measured voltages $V_0, V_1, \\dots, V_n$ and per-sample voltage standard deviations $\\sigma_0,\\sigma_1,\\dots,\\sigma_n$ (assumed independent), produces:\n- an energy estimate $\\widehat{E}$ computed by integrating the discretized $V(Q)$ data,\n- a rigorous upper bound on the quadrature truncation error due to discretization, denoted $\\varepsilon_{\\mathrm{quad}}$, using an a priori curvature bound $B_2$ satisfying $$\\sup_{Q\\in[Q_\\min,Q_\\max]} \\left| \\frac{d^2 V}{dQ^2}(Q) \\right| \\le B_2,$$\n- and a one-standard-deviation uncertainty $\\sigma_E$ for $\\widehat{E}$ propagated from the voltage measurement standard deviations.\n\nYour program must implement the above scheme in a way that is scientifically defensible for battery data and must treat the data as piecewise-defined measurements without assuming a closed-form analytic model for $V(Q)$. You must not use any prepackaged numerical integration function; derive and implement the quadrature from first principles. Express all energies and uncertainties in Watt-hours ($\\mathrm{Wh}$), using capacities in Ampere-hours ($\\mathrm{Ah}$) and voltages in Volts ($\\mathrm{V}$). Angles are not applicable in this problem. The final reported numeric outputs must be rounded to six decimal places.\n\nUse the following test suite. Each case provides $Q$-samples, corresponding $V$-samples, per-sample $\\sigma$ values, and the curvature bound $B_2$:\n\n- Case $1$ (uniform sampling, smooth variation):\n  - $Q$ in $\\mathrm{Ah}$: $[0.0,\\,0.3,\\,0.6,\\,0.9,\\,1.2,\\,1.5,\\,1.8,\\,2.1,\\,2.4]$\n  - $V$ in $\\mathrm{V}$: $[4.1,\\,4.043366,\\,3.989645,\\,3.94115,\\,3.9,\\,3.86631,\\,3.839645,\\,3.818366,\\,3.8]$\n  - $\\sigma$ in $\\mathrm{V}$: $[0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01]$\n  - $B_2$ in $\\mathrm{V}/\\mathrm{Ah}^2$: $0.5$\n\n- Case $2$ (two-point boundary case):\n  - $Q$ in $\\mathrm{Ah}$: $[0.0,\\,2.5]$\n  - $V$ in $\\mathrm{V}$: $[4.2,\\,3.2]$\n  - $\\sigma$ in $\\mathrm{V}$: $[0.02,\\,0.02]$\n  - $B_2$ in $\\mathrm{V}/\\mathrm{Ah}^2$: $0.2$\n\n- Case $3$ (nonuniform sampling with a voltage knee):\n  - $Q$ in $\\mathrm{Ah}$: $[0.0,\\,0.05,\\,0.5,\\,1.7,\\,2.0,\\,2.2,\\,2.5]$\n  - $V$ in $\\mathrm{V}$: $[4.0,\\,3.98,\\,3.85,\\,3.6,\\,3.5,\\,3.45,\\,3.4]$\n  - $\\sigma$ in $\\mathrm{V}$: $[0.006,\\,0.006,\\,0.008,\\,0.010,\\,0.010,\\,0.012,\\,0.012]$\n  - $B_2$ in $\\mathrm{V}/\\mathrm{Ah}^2$: $0.8$\n\nYour program should produce a single line of output containing the results for the three cases as a comma-separated list enclosed in square brackets, where each case’s result is a list of three floats $[\\widehat{E},\\,\\varepsilon_{\\mathrm{quad}},\\,\\sigma_E]$ in $\\mathrm{Wh}$, rounded to six decimal places. For example, the output should look like $[[x_1,y_1,z_1],[x_2,y_2,z_2],[x_3,y_3,z_3]]$ with no additional text.",
            "solution": "The problem requires the construction of a numerical scheme to compute a battery's energy, its quadrature error bound, and its propagated measurement uncertainty from a discrete set of voltage versus capacity data points. The scheme must be derived from first principles.\n\nThe energy $E$ of a battery cell is given by the integral of its voltage $V$ with respect to its charge capacity $Q$:\n$$E = \\int_{Q_{\\min}}^{Q_{\\max}} V(Q) \\, dQ$$\nThe input data consists of $n+1$ discrete points $(Q_k, V_k)$ for $k=0, 1, \\dots, n$, where $Q_0 < Q_1 < \\dots < Q_n$ are strictly increasing capacity samples. Each voltage measurement $V_k$ has an associated independent standard deviation $\\sigma_k$. Additionally, a global upper bound $B_2$ on the curvature of the voltage curve is provided, such that $\\sup_{Q} |V''(Q)| \\le B_2$.\n\nThe numerical scheme is comprised of three components: the energy estimate $\\widehat{E}$, the quadrature error bound $\\varepsilon_{\\mathrm{quad}}$, and the propagated uncertainty $\\sigma_E$.\n\n1.  **Energy Estimate ($\\widehat{E}$)**\n    Given that the data is represented as a sequence of discrete measurements, the most direct and scientifically defensible approach for integration is the composite trapezoidal rule. This method approximates the integral by summing the areas of trapezoids formed by adjacent data points. Over each subinterval $[Q_i, Q_{i+1}]$, the integral is approximated as:\n    $$ \\int_{Q_i}^{Q_{i+1}} V(Q) \\, dQ \\approx \\frac{V_i + V_{i+1}}{2} (Q_{i+1} - Q_i) $$\n    The total energy estimate, $\\widehat{E}$, is the sum of these approximations over all $n$ intervals:\n    $$ \\widehat{E} = \\sum_{i=0}^{n-1} \\frac{V_i + V_{i+1}}{2} (Q_{i+1} - Q_i) $$\n    The units are consistent as required: $[\\text{V}] \\times [\\text{Ah}] = [\\text{Wh}]$.\n\n2.  **Quadrature Error Bound ($\\varepsilon_{\\mathrm{quad}}$)**\n    The truncation error of the trapezoidal rule on a single interval $[a, b]$ for a function $f(x)$ is given by:\n    $$ E_{\\text{trap}} = \\int_a^b f(x) \\, dx - \\frac{f(a) + f(b)}{2}(b-a) = -\\frac{(b-a)^3}{12} f''(\\xi) $$\n    for some $\\xi \\in (a, b)$. The absolute error is therefore bounded by $\\frac{(b-a)^3}{12} \\sup_{x \\in [a,b]} |f''(x)|$.\n    \n    For our problem, the function is $V(Q)$ and we are given a global bound $|V''(Q)| \\le B_2$. The absolute error for the $i$-th interval, $[Q_i, Q_{i+1}]$, is bounded by:\n    $$ |\\varepsilon_i| \\le \\frac{(Q_{i+1} - Q_i)^3}{12} B_2 $$\n    The total quadrature error is the sum of the errors in each interval. By the triangle inequality, the total absolute error is bounded by the sum of the individual absolute error bounds. This gives the rigorous upper bound $\\varepsilon_{\\mathrm{quad}}$ on the total truncation error:\n    $$ \\varepsilon_{\\mathrm{quad}} = \\sum_{i=0}^{n-1} \\frac{(Q_{i+1} - Q_i)^3}{12} B_2 = \\frac{B_2}{12} \\sum_{i=0}^{n-1} (Q_{i+1} - Q_i)^3 $$\n\n3.  **Propagated Uncertainty ($\\sigma_E$)**\n    The energy estimate $\\widehat{E}$ is a linear function of the measured voltages $V_k$. We can express it as $\\widehat{E} = \\sum_{k=0}^{n} c_k V_k$. By expanding the summation for $\\widehat{E}$, we can determine the coefficients $c_k$:\n    -   For the first point ($k=0$): $c_0 = \\frac{1}{2}(Q_1 - Q_0)$\n    -   For the last point ($k=n$): $c_n = \\frac{1}{2}(Q_n - Q_{n-1})$\n    -   For any interior point ($0 < k < n$): $c_k = \\frac{1}{2}(Q_k - Q_{k-1}) + \\frac{1}{2}(Q_{k+1} - Q_k) = \\frac{1}{2}(Q_{k+1} - Q_{k-1})$\n\n    The voltage measurements $V_k$ are assumed to be independent random variables with standard deviations $\\sigma_k$. According to the standard formula for propagation of uncertainty for a linear combination of independent variables, the variance of $\\widehat{E}$ is:\n    $$ \\sigma_E^2 = \\sum_{k=0}^{n} \\left(\\frac{\\partial \\widehat{E}}{\\partial V_k}\\right)^2 \\sigma_k^2 = \\sum_{k=0}^{n} c_k^2 \\sigma_k^2 $$\n    Substituting the derived coefficients $c_k$ yields the full expression for the variance:\n    $$ \\sigma_E^2 = \\left(\\frac{Q_1 - Q_0}{2}\\right)^2 \\sigma_0^2 + \\sum_{k=1}^{n-1} \\left(\\frac{Q_{k+1} - Q_{k-1}}{2}\\right)^2 \\sigma_k^2 + \\left(\\frac{Q_n - Q_{n-1}}{2}\\right)^2 \\sigma_n^2 $$\n    The final one-standard-deviation uncertainty, $\\sigma_E$, is the square root of this variance:\n    $$ \\sigma_E = \\sqrt{\\sigma_E^2} $$\n    This formulation is general and correctly handles both uniform and non-uniform capacity sampling, as well as the boundary case of only two data points ($n=1$).\n\nThese three derived formulae constitute a complete, self-consistent, and scientifically defensible numerical scheme for estimating the battery energy and its associated uncertainties as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"Q\": [0.0, 0.3, 0.6, 0.9, 1.2, 1.5, 1.8, 2.1, 2.4],\n            \"V\": [4.1, 4.043366, 3.989645, 3.94115, 3.9, 3.86631, 3.839645, 3.818366, 3.8],\n            \"sigma\": [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],\n            \"B2\": 0.5\n        },\n        {\n            \"Q\": [0.0, 2.5],\n            \"V\": [4.2, 3.2],\n            \"sigma\": [0.02, 0.02],\n            \"B2\": 0.2\n        },\n        {\n            \"Q\": [0.0, 0.05, 0.5, 1.7, 2.0, 2.2, 2.5],\n            \"V\": [4.0, 3.98, 3.85, 3.6, 3.5, 3.45, 3.4],\n            \"sigma\": [0.006, 0.006, 0.008, 0.010, 0.010, 0.012, 0.012],\n            \"B2\": 0.8\n        },\n    ]\n\n    def compute_energy_and_uncertainty(Q_samples, V_samples, sigma_samples, B2):\n        \"\"\"\n        Computes energy, quadrature error, and propagated uncertainty.\n\n        Args:\n            Q_samples (np.ndarray): Array of capacity samples in Ah.\n            V_samples (np.ndarray): Array of voltage samples in V.\n            sigma_samples (np.ndarray): Array of voltage standard deviations in V.\n            B2 (float): Upper bound on the second derivative, V/Ah^2.\n\n        Returns:\n            tuple: A tuple containing (E_hat, eps_quad, sigma_E).\n        \"\"\"\n        n_points = len(Q_samples)\n        if n_points < 2:\n            return 0.0, 0.0, 0.0\n\n        # 1. Energy Estimate (E_hat) using composite trapezoidal rule\n        Q_diff = np.diff(Q_samples)\n        V_avg = (V_samples[:-1] + V_samples[1:]) / 2.0\n        E_hat = np.sum(V_avg * Q_diff)\n\n        # 2. Quadrature Error Bound (eps_quad)\n        eps_quad = (B2 / 12.0) * np.sum(Q_diff**3)\n\n        # 3. Propagated Uncertainty (sigma_E)\n        # Calculate coefficients c_k for E_hat = sum(c_k * V_k)\n        c = np.zeros(n_points)\n        if n_points >= 2:\n            # Coefficient for the first point V_0\n            c[0] = (Q_samples[1] - Q_samples[0]) / 2.0\n            # Coefficient for the last point V_n\n            c[-1] = (Q_samples[-1] - Q_samples[-2]) / 2.0\n        \n        # Coefficients for an interior point V_k\n        if n_points > 2:\n            c[1:-1] = (Q_samples[2:] - Q_samples[:-2]) / 2.0\n        \n        # Calculate variance and standard deviation\n        variance_E = np.sum((c * sigma_samples)**2)\n        sigma_E = np.sqrt(variance_E)\n\n        return E_hat, eps_quad, sigma_E\n\n    results = []\n    for case in test_cases:\n        Q_np = np.array(case[\"Q\"], dtype=float)\n        V_np = np.array(case[\"V\"], dtype=float)\n        sigma_np = np.array(case[\"sigma\"], dtype=float)\n        B2_val = float(case[\"B2\"])\n\n        E_hat, eps_quad, sigma_E = compute_energy_and_uncertainty(\n            Q_np, V_np, sigma_np, B2_val\n        )\n        \n        # Round the final numeric outputs to six decimal places\n        result_tuple = [\n            round(E_hat, 6),\n            round(eps_quad, 6),\n            round(sigma_E, 6)\n        ]\n        results.append(result_tuple)\n\n    # Format the output string to be exactly [[x1,y1,z1],[x2,y2,z2],...]\n    # without extra spaces.\n    inner_strs = [f\"[{res[0]},{res[1]},{res[2]}]\" for res in results]\n    final_output_str = f\"[{','.join(inner_strs)}]\"\n\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}