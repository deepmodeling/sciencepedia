{
    "hands_on_practices": [
        {
            "introduction": "The fundamental purpose of a thermostat is to ensure the system samples the canonical ensemble at a specified temperature. This is achieved by controlling the system's kinetic energy, whose average value is directly related to temperature via the equipartition theorem. This first practice  focuses on calculating this target mean kinetic energy for a constrained system, a foundational skill that connects the microscopic description of atoms and constraints to the macroscopic thermodynamic state that the Stochastic Velocity Rescaling (SVR) thermostat must maintain.",
            "id": "3841766",
            "problem": "Consider a classical, constrained biomolecular system in a multiscale materials simulation. The system has $N=1000$ atoms and $900$ independent holonomic constraints that remove one Cartesian degree of freedom each. The system is thermostatted using the stochastic velocity rescaling (SVR) thermostat, which maintains the canonical ensemble at temperature $T=310\\ \\mathrm{K}$. Assume constraints are ideal and independent, and that no additional global constraints (such as fixing the center-of-mass motion or rigid-body rotations beyond the stated constraints) are applied. \n\nStarting from first principles for classical statistical mechanics, determine the effective number of quadratic momentum degrees of freedom $N_f$ and derive the expected canonical mean kinetic energy $\\langle K \\rangle$ under SVR. Use the canonical ensemble and the Maxwellâ€“Boltzmann distribution as the fundamental base, and justify the relationship between constraints, the dimension of momentum space, and the mean of the kinetic energy. \n\nCompute $N_f$ and the molar expected mean kinetic energy at temperature $T=310\\ \\mathrm{K}$, expressing the energy in $\\mathrm{kJ/mol}$. Round the energy to four significant figures. Your final answer must be a single row matrix containing $N_f$ and the rounded molar mean kinetic energy.",
            "solution": "### Solution Derivation\n\nThe solution is derived from the first principles of classical statistical mechanics. We first determine the number of effective degrees of freedom and then apply the equipartition theorem to find the mean kinetic energy.\n\n**1. Determination of the Effective Number of Degrees of Freedom ($N_f$)**\n\nA system of $N$ classical particles moving in a three-dimensional Cartesian space has $3N$ positional coordinates $(q_1, q_2, \\ldots, q_{3N})$ and $3N$ corresponding momentum components $(p_1, p_2, \\ldots, p_{3N})$. The total number of degrees of freedom in the unconstrained system is $3N$. In this problem, the number of atoms is $N=1000$, so the initial number of degrees of freedom is $3 \\times 1000 = 3000$.\n\nThe system is subject to $N_c = 900$ independent holonomic constraints. A holonomic constraint is a relation that depends only on the particle coordinates and possibly time, of the form $f_k(\\mathbf{r}_1, \\mathbf{r}_2, \\ldots, \\mathbf{r}_N) = 0$ for $k=1, \\ldots, N_c$. Each independent constraint of this type removes one degree of freedom from the system's configuration space. The number of independent coordinates required to describe the system's configuration is thus reduced.\n\nThe effective number of degrees of freedom, $N_f$, for the system is the total number of degrees of freedom minus the number of independent constraints.\n$$N_f = 3N - N_c$$\nThe problem explicitly states that no other constraints (such as fixing the center-of-mass momentum) are to be considered. Substituting the given values:\n$$N_f = 3 \\times 1000 - 900 = 3000 - 900 = 2100$$\nThese $N_f$ degrees of freedom correspond to the number of independent variables needed to specify the state of the system, and crucially for this problem, correspond to the number of effective quadratic terms in the kinetic energy.\n\n**2. Derivation of the Expected Mean Kinetic Energy ($\\langle K \\rangle$)**\n\nThe system is maintained in a canonical ensemble at a constant temperature $T$ by an SVR thermostat. A key feature of the SVR thermostat is that it ensures the kinetic energy of the system correctly samples the canonical distribution for a system with $N_f$ degrees of freedom.\n\nThe total kinetic energy of the system in Cartesian coordinates is given by the sum of the kinetic energies of all atoms:\n$$K = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i \\cdot \\mathbf{p}_i}{2m_i} = \\sum_{j=1}^{3N} \\frac{p_j^2}{2m_j'}$$\nwhere $\\mathbf{p}_i$ is the momentum of the $i$-th atom with mass $m_i$, and the second sum is over all $3N$ Cartesian momentum components $p_j$ with corresponding masses $m_j'$.\n\nThe equipartition theorem of classical statistical mechanics states that for a system in thermal equilibrium at temperature $T$, the average energy associated with each degree of freedom that appears as a quadratic term in the Hamiltonian is $\\frac{1}{2} k_B T$, where $k_B$ is the Boltzmann constant.\n\nWhile holonomic constraints introduce correlations between the momentum components $p_j$, the kinetic energy can always be expressed as a sum of $N_f$ independent quadratic terms in a set of generalized velocities. Let these generalized velocities be $\\dot{q}'_k$ for $k=1, \\ldots, N_f$. The kinetic energy takes the form $K = \\frac{1}{2} \\sum_{k=1}^{N_f} \\mu_k (\\dot{q}'_k)^2$ in an appropriate basis, where each term corresponds to an independent mode of motion. As each of these $N_f$ terms is quadratic, the equipartition theorem can be applied. The mean kinetic energy of the system, $\\langle K \\rangle$, is the sum of the average energies of these $N_f$ modes:\n$$\\langle K \\rangle = N_f \\times \\frac{1}{2} k_B T = \\frac{N_f}{2} k_B T$$\n\n**3. Calculation of the Molar Expected Mean Kinetic Energy**\n\nThe problem asks for the *molar* expected mean kinetic energy. This quantity represents the total kinetic energy of the system, but expressed in molar units (e.g., $\\mathrm{kJ/mol}$). This is obtained by multiplying the system's average kinetic energy $\\langle K \\rangle$ by the Avogadro constant $N_A$.\n$$\\langle K \\rangle_{\\text{molar}} = \\langle K \\rangle \\times N_A = \\frac{N_f}{2} k_B N_A T$$\nUsing the definition of the molar gas constant, $R = k_B N_A$, the expression simplifies to:\n$$\\langle K \\rangle_{\\text{molar}} = \\frac{N_f}{2} R T$$\nWe have the following values:\n- Number of effective degrees of freedom: $N_f = 2100$.\n- Molar gas constant: $R \\approx 8.314462618\\ \\mathrm{J \\cdot mol^{-1} \\cdot K^{-1}}$.\n- Temperature: $T = 310\\ \\mathrm{K}$.\n\nSubstituting these values into the equation:\n$$\\langle K \\rangle_{\\text{molar}} = \\frac{2100}{2} \\times (8.314462618\\ \\mathrm{J \\cdot mol^{-1} \\cdot K^{-1}}) \\times (310\\ \\mathrm{K})$$\n$$\\langle K \\rangle_{\\text{molar}} = 1050 \\times 8.314462618 \\times 310 \\ \\mathrm{J/mol}$$\n$$\\langle K \\rangle_{\\text{molar}} \\approx 2706356.08\\ \\mathrm{J/mol}$$\n\nThe problem requires the answer in $\\mathrm{kJ/mol}$. Converting units:\n$$\\langle K \\rangle_{\\text{molar}} \\approx 2706.35608\\ \\mathrm{kJ/mol}$$\nFinally, we must round the result to four significant figures as requested:\n$$\\langle K \\rangle_{\\text{molar}} \\approx 2706\\ \\mathrm{kJ/mol}$$\n\nThe two computed quantities are $N_f = 2100$ and $\\langle K \\rangle_{\\text{molar}} = 2706\\ \\mathrm{kJ/mol}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2100 & 2706\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A robust thermostat must do more than simply enforce an average temperature; it must also reproduce the correct thermal fluctuations characteristic of the canonical ensemble. This practice  goes to the heart of statistical mechanics, guiding you to derive the exact probability distribution for the kinetic energy, $p(K)$. Understanding this target Gamma distribution is crucial for appreciating why the SVR method is superior to simpler approaches and how it rigorously generates a canonical ensemble.",
            "id": "3449894",
            "problem": "A classical molecular system of $N$ particles is simulated in the canonical ensemble at temperature $T$ using a thermostat acting only on the momenta. Let the effective number of independent quadratic momentum degrees of freedom (after constraints and removal of conserved motions) be $f$. The Hamiltonian separates as $H(\\mathbf{p},\\mathbf{q})=K(\\mathbf{p})+U(\\mathbf{q})$, where the kinetic energy is $K(\\mathbf{p})=\\sum_{i=1}^{f}\\frac{p_{i}^{2}}{2 m_{i}}$ with appropriate masses $m_{i}$. The canonical phase-space probability density is proportional to $\\exp(-\\beta H)$ with $\\beta=1/(k_{B} T)$, where $k_{B}$ is the Boltzmann constant.\n\nUsing only fundamental definitions of the canonical ensemble and the equipartition theorem, do the following:\n\n1. Show that the momentum partition function factorizes and can be written as $Z_{p}(\\beta)=C\\,\\beta^{-f/2}$, where $C$ is a $\\beta$-independent constant. Then use canonical-ensemble identities to derive the mean and variance of the kinetic energy, $\\mathbb{E}[K]$ and $\\mathrm{Var}[K]$, in terms of $f$, $k_{B}$, and $T$.\n\n2. Consider the set of momentum states with kinetic energy in the interval $[K,K+\\mathrm{d}K]$. By transforming to hyperspherical coordinates in the scaled momentum space, argue that the momentum-space measure at fixed $K$ scales as $K^{f/2-1}\\,\\mathrm{d}K$. Combine this density-of-states factor with the Boltzmann weight to obtain the unnormalized probability density for $K$.\n\n3. Normalize the resulting density to obtain the stationary equilibrium probability density $p(K)$ that a correct thermostat based on stochastic velocity rescaling (SVR) must reproduce for the kinetic energy at temperature $T$. Express $p(K)$ as a closed-form analytic expression in terms of $f$, $k_{B}$, and $T$. Provide this normalized $p(K)$ as your final answer.\n\nYour final answer must be a single closed-form analytic expression for $p(K)$; do not include units in the final boxed expression.",
            "solution": "Part 1: Momentum Partition Function, Mean and Variance of Kinetic Energy\n\nThe total canonical partition function for a system with a separable Hamiltonian, $H(\\mathbf{p},\\mathbf{q})=K(\\mathbf{p})+U(\\mathbf{q})$, is the product of the momentum and position partition functions, $Z(\\beta) = Z_{p}(\\beta)Z_{q}(\\beta)$. The momentum partition function, $Z_{p}(\\beta)$, is given by the integral of the Boltzmann factor associated with the kinetic energy over all possible momenta.\nThe kinetic energy is $K(\\mathbf{p})=\\sum_{i=1}^{f}\\frac{p_{i}^{2}}{2 m_{i}}$, where $f$ is the number of independent quadratic momentum degrees of freedom.\n\nThe momentum partition function is:\n$$Z_{p}(\\beta) = \\int_{-\\infty}^{\\infty} \\dots \\int_{-\\infty}^{\\infty} \\exp(-\\beta K(\\mathbf{p})) \\, dp_1 \\dots dp_f$$\nSubstituting the expression for $K(\\mathbf{p})$:\n$$Z_{p}(\\beta) = \\int \\exp\\left(-\\beta \\sum_{i=1}^{f}\\frac{p_{i}^{2}}{2 m_{i}}\\right) \\, d^f\\mathbf{p} = \\prod_{i=1}^{f} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta p_{i}^{2}}{2 m_{i}}\\right) \\, dp_i$$\nThis is a product of $f$ Gaussian integrals. The value of a single such integral is given by the standard formula $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\pi/a}$. Here, $a = \\frac{\\beta}{2m_i}$.\n$$\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta p_{i}^{2}}{2 m_{i}}\\right) \\, dp_i = \\sqrt{\\frac{\\pi}{ \\frac{\\beta}{2 m_{i}} }} = \\sqrt{\\frac{2\\pi m_i}{\\beta}} = (2\\pi m_i)^{1/2} \\beta^{-1/2}$$\nMultiplying these $f$ terms together gives the momentum partition function:\n$$Z_{p}(\\beta) = \\prod_{i=1}^{f} (2\\pi m_i)^{1/2} \\beta^{-1/2} = \\left(\\prod_{i=1}^{f} \\sqrt{2\\pi m_i}\\right) \\beta^{-f/2}$$\nThis is of the form $Z_{p}(\\beta)=C\\,\\beta^{-f/2}$, where the constant $C = \\prod_{i=1}^{f} \\sqrt{2\\pi m_i}$ is independent of $\\beta = 1/(k_B T)$. This completes the first part of Task 1.\n\nNext, we derive the mean and variance of the kinetic energy using canonical-ensemble identities. The mean kinetic energy $\\mathbb{E}[K]$ is given by:\n$$\\mathbb{E}[K] = -\\frac{\\partial}{\\partial \\beta} \\ln Z_p(\\beta)$$\nFirst, we find $\\ln Z_p(\\beta)$:\n$$\\ln Z_p(\\beta) = \\ln(C \\beta^{-f/2}) = \\ln C - \\frac{f}{2} \\ln \\beta$$\nDifferentiating with respect to $\\beta$:\n$$\\frac{\\partial}{\\partial \\beta} \\ln Z_p(\\beta) = -\\frac{f}{2} \\frac{1}{\\beta}$$\nTherefore, the mean kinetic energy is:\n$$\\mathbb{E}[K] = - \\left(-\\frac{f}{2\\beta}\\right) = \\frac{f}{2\\beta} = \\frac{f}{2} k_B T$$\nThis result is a direct consequence of the equipartition theorem for quadratic degrees of freedom.\n\nThe variance of the kinetic energy, $\\mathrm{Var}[K] = \\mathbb{E}[K^2] - (\\mathbb{E}[K])^2$, is given by the second derivative of $\\ln Z_p(\\beta)$:\n$$\\mathrm{Var}[K] = \\frac{\\partial^2}{\\partial \\beta^2} \\ln Z_p(\\beta)$$\nDifferentiating our previous result for the first derivative:\n$$\\mathrm{Var}[K] = \\frac{\\partial}{\\partial \\beta} \\left(-\\frac{f}{2\\beta}\\right) = - \\left(-\\frac{f}{2\\beta^2}\\right) = \\frac{f}{2\\beta^2} = \\frac{f}{2} (k_B T)^2$$\n\nPart 2: Momentum-space Measure\n\nTo find the momentum-space measure for states with kinetic energy in the interval $[K, K + \\mathrm{d}K]$, we analyze the geometry of the constant-energy surface in momentum space. The equation $K = \\sum_{i=1}^{f} \\frac{p_i^2}{2m_i}$ describes a hyper-ellipsoid. To simplify this geometry, we introduce scaled momentum coordinates $u_i = p_i / \\sqrt{2m_i}$. In terms of these new coordinates, the kinetic energy becomes:\n$$K = \\sum_{i=1}^{f} u_i^2$$\nThis is the equation of a hypersphere of radius $R = \\sqrt{K}$ in the $f$-dimensional space of the variables $\\{u_i\\}$. The volume element in the original momentum space is $d^f\\mathbf{p} = \\prod_{i=1}^{f} dp_i$. The transformation is $p_i = u_i \\sqrt{2m_i}$, so $dp_i = \\sqrt{2m_i} du_i$. The volume element transforms as:\n$$d^f\\mathbf{p} = \\left(\\prod_{i=1}^{f} \\sqrt{2m_i}\\right) d^f\\mathbf{u} = \\left(\\frac{C}{(2\\pi)^{f/2}}\\right)d^f\\mathbf{u} \\propto d^f\\mathbf{u}$$\nThe number of states in the kinetic energy interval $[K, K + \\mathrm{d}K]$ is proportional to the volume of the corresponding shell in the $u$-space. This shell is bounded by two hyperspheres of radii $R = \\sqrt{K}$ and $R' = \\sqrt{K+\\mathrm{d}K}$.\nThe thickness of this shell is $dR = R' - R \\approx \\frac{d R}{dK} dK = \\frac{d(\\sqrt{K})}{dK} dK = \\frac{1}{2\\sqrt{K}} dK$.\nThe volume of a hyperspherical shell of radius $R$ and thickness $dR$ in $f$ dimensions is given by the surface area of the hypersphere multiplied by its thickness: $dV = S_{f-1}(R) \\, dR$, where $S_{f-1}(R)$ is the surface area of an $(f-1)$-sphere of radius $R$. The surface area scales as $R^{f-1}$. Thus, the volume of the shell is proportional to $R^{f-1} dR$.\nSubstituting $R=\\sqrt{K}$ and $dR \\propto K^{-1/2} dK$:\n$$dV \\propto (\\sqrt{K})^{f-1} \\cdot (K^{-1/2} dK) = K^{(f-1)/2} K^{-1/2} dK = K^{f/2 - 1} dK$$\nSince the momentum-space measure is proportional to this volume element, the measure at fixed $K$ scales as $K^{f/2-1} \\,\\mathrm{d}K$. The term $\\Omega(K) \\propto K^{f/2-1}$ is the density of states for the kinetic energy.\n\nPart 3: Normalized Probability Density of Kinetic Energy\n\nThe probability of finding the system with a kinetic energy $K$ is proportional to the product of the density of states $\\Omega(K)$ and the Boltzmann factor $\\exp(-\\beta K)$. The unnormalized probability density for $K$, denoted $p_{un}(K)$, is therefore:\n$$p_{un}(K) \\propto \\Omega(K) \\exp(-\\beta K) \\propto K^{f/2-1} \\exp(-\\beta K)$$\nTo obtain the normalized probability density $p(K)$, we introduce a normalization constant $\\mathcal{N}$ and set the integral of $p(K)$ over all possible values of $K$ (from $0$ to $\\infty$) to unity:\n$$p(K) = \\mathcal{N} K^{f/2-1} \\exp(-\\beta K)$$\n$$\\int_0^\\infty p(K) \\, dK = \\mathcal{N} \\int_0^\\infty K^{f/2-1} \\exp(-\\beta K) \\, dK = 1$$\nThe integral is related to the Gamma function, $\\Gamma(z) = \\int_0^\\infty t^{z-1} e^{-t} dt$. We perform a change of variables $t = \\beta K$, which means $K = t/\\beta$ and $dK = dt/\\beta$.\n\\begin{align*}\n\\int_0^\\infty K^{f/2-1} \\exp(-\\beta K) \\, dK &= \\int_0^\\infty \\left(\\frac{t}{\\beta}\\right)^{f/2-1} \\exp(-t) \\, \\frac{dt}{\\beta} \\\\\n&= \\frac{1}{\\beta^{f/2-1}} \\frac{1}{\\beta} \\int_0^\\infty t^{f/2-1} \\exp(-t) \\, dt \\\\\n&= \\frac{1}{\\beta^{f/2}} \\Gamma\\left(\\frac{f}{2}\\right)\n\\end{align*}\nThe normalization condition becomes:\n$$\\mathcal{N} \\left[ \\frac{1}{\\beta^{f/2}} \\Gamma\\left(\\frac{f}{2}\\right) \\right] = 1 \\implies \\mathcal{N} = \\frac{\\beta^{f/2}}{\\Gamma(f/2)}$$\nSubstituting this normalization constant back into the expression for $p(K)$ and replacing $\\beta$ with $1/(k_B T)$, we get the final normalized probability density for the kinetic energy:\n$$p(K) = \\frac{\\beta^{f/2}}{\\Gamma(f/2)} K^{f/2-1} \\exp(-\\beta K) = \\frac{(1/(k_B T))^{f/2}}{\\Gamma(f/2)} K^{f/2-1} \\exp\\left(-\\frac{K}{k_B T}\\right)$$\nThis is a Gamma distribution with shape parameter $\\alpha = f/2$ and rate parameter $\\beta = 1/(k_B T)$. This is the stationary equilibrium distribution that any correct thermostat, including one based on stochastic velocity rescaling, must reproduce.\n$$p(K) = \\frac{1}{\\Gamma(f/2) (k_B T)^{f/2}} K^{\\frac{f}{2}-1} \\exp\\left(-\\frac{K}{k_B T}\\right)$$",
            "answer": "$$\\boxed{\\frac{1}{\\Gamma(\\frac{f}{2}) (k_{B} T)^{f/2}} K^{\\frac{f}{2}-1} \\exp\\left(-\\frac{K}{k_{B} T}\\right)}$$"
        },
        {
            "introduction": "The theoretical correctness of an algorithm is only half the battle; its numerical implementation must also be sound to produce reliable results. This final practice  addresses a critical issue in practical molecular dynamics: the potential for energy drift arising from the interplay between the Hamiltonian integrator and the thermostat. You will learn the rigorous method for detecting such numerical artifacts by constructing a conserved \"extended energy,\" a powerful diagnostic tool for ensuring the integrity of your thermostatted simulations.",
            "id": "3841736",
            "problem": "A multiscale Molecular Dynamics (MD) simulation couples an atomistic core of $N_{\\mathrm{a}}$ particles to a coarse-grained environment. The atomistic core is thermostatted with Stochastic Velocity Rescaling (SVR), which enforces the canonical distribution by rescaling all velocities by a stochastic factor at each thermostat application. The Hamiltonian of the total system is $H(\\mathbf{p},\\mathbf{q}) = K(\\mathbf{p}) + U(\\mathbf{q})$, where $K$ is the kinetic energy and $U$ is the potential energy. The equations of motion in the atomistic region are integrated with a symplectic, time-reversible scheme (velocity Verlet) with time step $\\Delta t$, and the SVR is applied with relaxation time $\\tau_T$ using a standard operator splitting in which the thermostat and Hamiltonian propagators are alternated. After a long production run at target temperature $T_0$, the running time series of the instantaneous total energy $H(t)$ shows visible secular trends superimposed on thermal fluctuations.\n\nFrom first principles, the presence of a thermostat implies that the Hamiltonian $H$ is not conserved due to heat exchange with the thermal reservoir, whereas in the ideal continuous-time limit, the net heat exchange averages to zero in steady state and any systematic drift in a suitably defined conserved quantity indicates a numerical bias introduced by finite $\\Delta t$ or an inconsistent splitting. Your goal is to identify a scientifically rigorous detection procedure for drift that isolates the effect of finite-time-step integration from random heat exchange, and to recommend corrective measures that reduce or eliminate the drift while preserving correct canonical sampling.\n\nWhich option provides a valid detection strategy and appropriate corrective measures under these conditions?\n\nA. Compute a discrete extended energy by subtracting the cumulative heat injected by SVR from the total energy and test for a linear trend; specifically, at each thermostat application with velocity rescaling factor $\\alpha$, record the kinetic energy change $\\Delta K = K' - K$ and define $E^{\\mathrm{ext}}(t_n) = H(t_n) - \\sum_{k=1}^{n} Q_{\\mathrm{SVR}}(t_k)$ with $Q_{\\mathrm{SVR}}(t_k) = \\Delta K(t_k)$. If $E^{\\mathrm{ext}}(t)$ exhibits a statistically significant slope, reduce $\\Delta t$, switch to a symmetric Strang splitting (half-thermostat, full Hamiltonian, half-thermostat), and choose $\\tau_T$ such that $\\Delta t / \\tau_T \\ll 1$.\n\nB. Monitor the instantaneous temperature $T(t)$ and compare it to $T_0$. If $T(t)$ deviates from $T_0$ beyond expected fluctuations, increase $\\tau_T$ until those deviations vanish; this removes drift in $H(t)$ without altering the integrator.\n\nC. Estimate the shadow Hamiltonian $H^\\star$ associated with velocity Verlet via backward error analysis and enforce its exact conservation by applying an additional deterministic velocity rescaling step after each integration cycle; this prevents drift even in the presence of SVR.\n\nD. Detect drift by computing the autocorrelation function of the random numbers used in SVR. If nonzero autocorrelation at lag greater than $0$ is observed, switch to a different random number generator with lower autocorrelation; this removes energy drift without changing $\\Delta t$ or $\\tau_T$.\n\nE. Interleave short microcanonical segments (turn SVR off for a duration $\\delta t$) with SVR-on segments, and compare the slope of $H(t)$ during microcanonical segments to the slope of $H(t)$ during SVR-on segments. If the slope during SVR-on segments is nonzero, keep $\\Delta t$ fixed and reduce $\\tau_T$ (stronger coupling) to eliminate drift through tighter temperature control.",
            "solution": "The problem asks for a scientifically rigorous method to detect and correct numerical drift in a thermostatted Molecular Dynamics simulation. The drift arises from the finite time step $\\Delta t$ of the integrator and the operator splitting scheme used to couple the thermostat. The key is to separate this numerical artifact from the legitimate, stochastic heat exchange with the thermostat's reservoir.\n\nThe total energy $H$ is not a conserved quantity in the canonical (NVT) ensemble. Its change over a time step $\\Delta t$ is the sum of the numerical error from the integrator, $\\delta H_{\\text{num}}$, and the heat exchanged with the reservoir, $Q_{\\text{thermo}}$.\n$$ \\Delta H = \\delta H_{\\text{num}} + Q_{\\text{thermo}} $$\nIn a correctly functioning simulation at steady state, the long-term average of the heat exchange is zero, $\\langle Q_{\\text{thermo}} \\rangle = 0$. However, a systematic error in the integrator, $\\langle \\delta H_{\\text{num}} \\rangle \\neq 0$, will force the thermostat to systematically add or remove heat to maintain the target temperature, resulting in $\\langle Q_{\\text{thermo}} \\rangle = - \\langle \\delta H_{\\text{num}} \\rangle$ and a drift in the total work done by the thermostat.\n\nTo isolate the numerical error, one can define an extended energy, $E^{\\mathrm{ext}}$, which should be conserved in the absence of numerical errors. This is constructed by subtracting the cumulative heat exchanged with the thermostat from the instantaneous total energy:\n$$ E^{\\mathrm{ext}}(t_n) = H(t_n) - \\sum_{k=1}^{n} Q_{\\text{thermo}}(t_k) $$\nThe change in this quantity over one step is:\n$$ \\Delta E^{\\mathrm{ext}} = \\Delta H(t_n) - Q_{\\text{thermo}}(t_n) = (\\delta H_{\\text{num}} + Q_{\\text{thermo}}(t_n)) - Q_{\\text{thermo}}(t_n) = \\delta H_{\\text{num}} $$\nThus, any secular trend (non-zero slope) in $E^{\\mathrm{ext}}(t)$ is a direct measure of the systematic numerical error of the integration algorithm. For the Stochastic Velocity Rescaling (SVR) thermostat, the heat exchanged in one application is exactly the change in kinetic energy, $Q_{\\text{SVR}} = \\Delta K$.\n\nWith this foundation, we evaluate the options.\n\nA. Compute a discrete extended energy by subtracting the cumulative heat injected by SVR from the total energy and test for a linear trend; specifically, at each thermostat application with velocity rescaling factor $\\alpha$, record the kinetic energy change $\\Delta K = K' - K$ and define $E^{\\mathrm{ext}}(t_n) = H(t_n) - \\sum_{k=1}^{n} Q_{\\mathrm{SVR}}(t_k)$ with $Q_{\\mathrm{SVR}}(t_k) = \\Delta K(t_k)$. If $E^{\\mathrm{ext}}(t)$ exhibits a statistically significant slope, reduce $\\Delta t$, switch to a symmetric Strang splitting (half-thermostat, full Hamiltonian, half-thermostat), and choose $\\tau_T$ such that $\\Delta t / \\tau_T \\ll 1$.\n\n- **Analysis:** This option correctly identifies the extended energy $E^{\\mathrm{ext}}(t)$ as the proper quantity for diagnosing numerical drift. The definition $Q_{\\mathrm{SVR}}(t_k) = \\Delta K(t_k)$ is also correct. The proposed corrective measures are all standard and sound practice for mitigating integrator-induced energy drift. Reducing $\\Delta t$ directly reduces the error per step. Switching to a symmetric splitting scheme (like Strang splitting) improves the order of the integrator, typically from first-order to second-order in $\\Delta t$, drastically reducing the systematic error. The condition $\\Delta t / \\tau_T \\ll 1$ ensures that the thermostat's discrete interventions do not excessively perturb the underlying Hamiltonian trajectory being integrated, a necessary condition for the validity of the split-operator approach. This option provides a complete and correct framework.\n- **Verdict:** **Correct**.\n\nB. Monitor the instantaneous temperature $T(t)$ and compare it to $T_0$. If $T(t)$ deviates from $T_0$ beyond expected fluctuations, increase $\\tau_T$ until those deviations vanish; this removes drift in $H(t)$ without altering the integrator.\n\n- **Analysis:** This is incorrect on multiple fronts. The SVR thermostat is designed to guarantee that the average temperature $\\langle T(t) \\rangle$ matches the target $T_0$. A drift in total energy $H(t)$ can occur even if the thermostat is functioning perfectly. The primary indicator of integrator error is not the temperature, but the extended energy. Furthermore, increasing the relaxation time $\\tau_T$ *weakens* the coupling to the heat bath, leading to *larger*, not smaller, temperature fluctuations. A weaker thermostat would be less able to counteract the energy drift from the integrator, likely making the drift in $H(t)$ worse if the integrator is systematically adding energy.\n- **Verdict:** **Incorrect**.\n\nC. Estimate the shadow Hamiltonian $H^\\star$ associated with velocity Verlet via backward error analysis and enforce its exact conservation by applying an additional deterministic velocity rescaling step after each integration cycle; this prevents drift even in the presence of SVR.\n\n- **Analysis:** This proposal is fundamentally flawed as it violates the simulation's objective. While a symplectic integrator like Verlet conserves a shadow Hamiltonian $H^\\star$, the goal of an NVT simulation is not to conserve any form of energy, but to sample the canonical phase-space distribution. The SVR thermostat is stochastic and is designed to produce these canonical fluctuations. Forcing the conservation of $H^\\star$ via a deterministic rescaling would counteract the thermostat and destroy the canonical sampling. This changes the target ensemble and fails the requirement to \"preserve correct canonical sampling\". Moreover, estimating $H^\\star$ is analytically and computationally prohibitive.\n- **Verdict:** **Incorrect**.\n\nD. Detect drift by computing the autocorrelation function of the random numbers used in SVR. If nonzero autocorrelation at lag greater than $0$ is observed, switch to a different random number generator with lower autocorrelation; this removes energy drift without changing $\\Delta t$ or $\\tau_T$.\n\n- **Analysis:** While a high-quality random number generator (RNG) is crucial for any stochastic simulation, and a poor RNG could introduce biases, this is not the primary or most common source of energy drift. The problem statement points to numerical bias from finite $\\Delta t$ or inconsistent splitting, which is a fundamental property of the integration algorithm, independent of the RNG's quality. Even with a perfect RNG, a finite $\\Delta t$ will cause a drift in the extended energy. Addressing the RNG quality alone is an insufficient and incomplete solution that ignores the main culprit.\n- **Verdict:** **Incorrect**.\n\nE. Interleave short microcanonical segments (turn SVR off for a duration $\\delta t$) with SVR-on segments, and compare the slope of $H(t)$ during microcanonical segments to the slope of $H(t)$ during SVR-on segments. If the slope during SVR-on segments is nonzero, keep $\\Delta t$ fixed and reduce $\\tau_T$ (stronger coupling) to eliminate drift through tighter temperature control.\n\n- **Analysis:** The corrective measure proposed is incorrect. Reducing $\\tau_T$ strengthens the thermostat's coupling. This does not eliminate the source of the drift, which is the integrator error. Instead, it forces the thermostat to work harder to fight the drift, potentially introducing other artifacts associated with overly aggressive thermostatting. A very small $\\tau_T$ can disrupt the natural dynamics of the system. The proper solution is to reduce the integrator error itself by reducing $\\Delta t$ or improving the integration scheme, not to mask the error with a more forceful thermostat.\n- **Verdict:** **Incorrect**.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}