{
    "hands_on_practices": [
        {
            "introduction": "在实现或使用任何恒温器之前，至关重要的是要从第一性原理理解它旨在复现的统计目标。本练习将引导您推导正则系综下系统动能的精确概率分布，这正是随机速度重缩放（SVR）恒温器需要精确采样的目标分布 。通过这个推导，您将为理解 SVR 算法的理论基础和设计精髓打下坚实的统计力学基础。",
            "id": "3449894",
            "problem": "一个由$N$个粒子组成的经典分子系统，在温度$T$下使用一个仅作用于动量的恒温器，在正则系综中进行模拟。设有效独立二次型动量自由度（在考虑约束和移除守恒运动后）的数目为$f$。哈密顿量可分离为$H(\\mathbf{p},\\mathbf{q})=K(\\mathbf{p})+U(\\mathbf{q})$，其中动能为$K(\\mathbf{p})=\\sum_{i=1}^{f}\\frac{p_{i}^{2}}{2 m_{i}}$，具有相应的质量$m_{i}$。正则相空间概率密度正比于$\\exp(-\\beta H)$，其中$\\beta=1/(k_{B} T)$，$k_{B}$是玻尔兹曼常数。\n\n仅使用正则系综的基本定义和能量均分定理，完成以下任务：\n\n1. 证明动量配分函数可因式分解，并且可以写为$Z_{p}(\\beta)=C\\,\\beta^{-f/2}$，其中$C$是一个与$\\beta$无关的常数。然后使用正则系综恒等式，用$f$、$k_{B}$和$T$来表示动能的平均值$\\mathbb{E}[K]$和方差$\\mathrm{Var}[K]$。\n\n2. 考虑动能处于区间$[K,K+\\mathrm{d}K]$内的动量态集合。通过变换到标度化动量空间中的超球坐标，论证在固定$K$值时，动量空间测度与$K^{f/2-1}\\,\\mathrm{d}K$成比例。将此态密度因子与玻尔兹曼权重相结合，以获得$K$的未归一化概率密度。\n\n3. 归一化所得的密度，以获得平稳平衡概率密度$p(K)$，一个正确的基于随机速度重标定(SVR)的恒温器在温度$T$下必须能够再现此动能分布。将$p(K)$表示为一个用$f$、$k_{B}$和$T$表示的闭式解析表达式。将此归一化的$p(K)$作为你的最终答案。\n\n你的最终答案必须是$p(K)$的单个闭式解析表达式；在最终方框内的表达式中不要包含单位。",
            "solution": "该问题是有效的，因为它在科学上基于经典统计力学的原理，问题提法得当，有通往唯一解的清晰路径，且表述客观。我们按顺序解决这三个部分来继续解答。\n\n第一部分：动量配分函数、动能的平均值和方差\n\n对于一个哈密顿量可分离的系统$H(\\mathbf{p},\\mathbf{q})=K(\\mathbf{p})+U(\\mathbf{q})$，其总正则配分函数是动量配分函数和位置配分函数的乘积，$Z(\\beta) = Z_{p}(\\beta)Z_{q}(\\beta)$。动量配分函数$Z_{p}(\\beta)$由动能相关的玻尔兹曼因子在所有可能动量上的积分给出。\n动能为$K(\\mathbf{p})=\\sum_{i=1}^{f}\\frac{p_{i}^{2}}{2 m_{i}}$，其中$f$是独立二次型动量自由度的数目。\n\n动量配分函数为：\n$$Z_{p}(\\beta) = \\int_{-\\infty}^{\\infty} \\dots \\int_{-\\infty}^{\\infty} \\exp(-\\beta K(\\mathbf{p})) \\, dp_1 \\dots dp_f$$\n代入$K(\\mathbf{p})$的表达式：\n$$Z_{p}(\\beta) = \\int \\exp\\left(-\\beta \\sum_{i=1}^{f}\\frac{p_{i}^{2}}{2 m_{i}}\\right) \\, d^f\\mathbf{p} = \\prod_{i=1}^{f} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta p_{i}^{2}}{2 m_{i}}\\right) \\, dp_i$$\n这是一个$f$个高斯积分的乘积。单个此类积分的值由标准公式$\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\pi/a}$给出。此处，$a = \\frac{\\beta}{2m_i}$。\n$$\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta p_{i}^{2}}{2 m_{i}}\\right) \\, dp_i = \\sqrt{\\frac{\\pi}{ \\frac{\\beta}{2 m_{i}} }} = \\sqrt{\\frac{2\\pi m_i}{\\beta}} = (2\\pi m_i)^{1/2} \\beta^{-1/2}$$\n将这$f$项相乘得到动量配分函数：\n$$Z_{p}(\\beta) = \\prod_{i=1}^{f} (2\\pi m_i)^{1/2} \\beta^{-1/2} = \\left(\\prod_{i=1}^{f} \\sqrt{2\\pi m_i}\\right) \\beta^{-f/2}$$\n这符合$Z_{p}(\\beta)=C\\,\\beta^{-f/2}$的形式，其中常数$C = \\prod_{i=1}^{f} \\sqrt{2\\pi m_i}$与$\\beta = 1/(k_B T)$无关。这就完成了任务1的第一部分。\n\n接下来，我们使用正则系综恒等式推导动能的平均值和方差。平均动能$\\mathbb{E}[K]$由下式给出：\n$$\\mathbb{E}[K] = -\\frac{\\partial}{\\partial \\beta} \\ln Z_p(\\beta)$$\n首先，我们求$\\ln Z_p(\\beta)$：\n$$\\ln Z_p(\\beta) = \\ln(C \\beta^{-f/2}) = \\ln C - \\frac{f}{2} \\ln \\beta$$\n对$\\beta$求导：\n$$\\frac{\\partial}{\\partial \\beta} \\ln Z_p(\\beta) = -\\frac{f}{2} \\frac{1}{\\beta}$$\n因此，平均动能是：\n$$\\mathbb{E}[K] = - \\left(-\\frac{f}{2\\beta}\\right) = \\frac{f}{2\\beta} = \\frac{f}{2} k_B T$$\n这个结果是二次型自由度能量均分定理的直接推论。\n\n动能的方差$\\mathrm{Var}[K] = \\mathbb{E}[K^2] - (\\mathbb{E}[K])^2$由$\\ln Z_p(\\beta)$的二阶导数给出：\n$$\\mathrm{Var}[K] = \\frac{\\partial^2}{\\partial \\beta^2} \\ln Z_p(\\beta)$$\n对我们之前得到的一阶导数结果进行微分：\n$$\\mathrm{Var}[K] = \\frac{\\partial}{\\partial \\beta} \\left(-\\frac{f}{2\\beta}\\right) = - \\left(-\\frac{f}{2\\beta^2}\\right) = \\frac{f}{2\\beta^2} = \\frac{f}{2} (k_B T)^2$$\n\n第二部分：动量空间测度\n\n为了找到动能处于区间$[K, K + \\mathrm{d}K]$内各态的动量空间测度，我们分析动量空间中等能面的几何结构。方程$K = \\sum_{i=1}^{f} \\frac{p_i^2}{2m_i}$描述了一个超椭球体。为了简化此几何结构，我们引入标度化动量坐标$u_i = p_i / \\sqrt{2m_i}$。用这些新坐标表示，动能变为：\n$$K = \\sum_{i=1}^{f} u_i^2$$\n这是变量$\\{u_i\\}$的$f$维空间中半径为$R = \\sqrt{K}$的超球面方程。原始动量空间中的体积元为$d^f\\mathbf{p} = \\prod_{i=1}^{f} dp_i$。变换关系为$p_i = u_i \\sqrt{2m_i}$，因此$dp_i = \\sqrt{2m_i} du_i$。体积元变换为：\n$$d^f\\mathbf{p} = \\left(\\prod_{i=1}^{f} \\sqrt{2m_i}\\right) d^f\\mathbf{u} = \\left(\\frac{C}{(2\\pi)^{f/2}}\\right)d^f\\mathbf{u} \\propto d^f\\mathbf{u}$$\n在动能区间$[K, K + \\mathrm{d}K]$内的态数正比于$u$空间中相应壳层的体积。这个壳层由两个半径分别为$R = \\sqrt{K}$和$R' = \\sqrt{K+\\mathrm{d}K}$的超球面界定。\n该壳层的厚度为$dR = R' - R \\approx \\frac{d R}{dK} dK = \\frac{d(\\sqrt{K})}{dK} dK = \\frac{1}{2\\sqrt{K}} dK$。\n在$f$维空间中，半径为$R$、厚度为$dR$的超球壳的体积由超球面的表面积乘以其厚度给出：$dV = S_{f-1}(R) \\, dR$，其中$S_{f-1}(R)$是半径为$R$的$(f-1)$维球面的表面积。表面积与$R^{f-1}$成比例。因此，壳层的体积正比于$R^{f-1} dR$。\n代入$R=\\sqrt{K}$和$dR \\propto K^{-1/2} dK$：\n$$dV \\propto (\\sqrt{K})^{f-1} \\cdot (K^{-1/2} dK) = K^{(f-1)/2} K^{-1/2} dK = K^{f/2 - 1} dK$$\n由于动量空间测度正比于该体积元，所以在固定$K$值时，测度与$K^{f/2-1} \\,\\mathrm{d}K$成比例。$\\Omega(K) \\propto K^{f/2-1}$项是动能的态密度。\n\n第三部分：动能的归一化概率密度\n\n找到系统具有动能$K$的概率正比于态密度$\\Omega(K)$和玻尔兹曼因子$\\exp(-\\beta K)$的乘积。因此，$K$的未归一化概率密度，记为$p_{un}(K)$，是：\n$$p_{un}(K) \\propto \\Omega(K) \\exp(-\\beta K) \\propto K^{f/2-1} \\exp(-\\beta K)$$\n为了获得归一化概率密度$p(K)$，我们引入一个归一化常数$\\mathcal{N}$，并令$p(K)$在所有可能的$K$值（从$0$到$\\infty$）上的积分等于1：\n$$p(K) = \\mathcal{N} K^{f/2-1} \\exp(-\\beta K)$$\n$$\\int_0^\\infty p(K) \\, dK = \\mathcal{N} \\int_0^\\infty K^{f/2-1} \\exp(-\\beta K) \\, dK = 1$$\n该积分与伽马函数$\\Gamma(z) = \\int_0^\\infty t^{z-1} e^{-t} dt$有关。我们进行变量替换$t = \\beta K$，即$K = t/\\beta$和$dK = dt/\\beta$。\n\\begin{align*}\n\\int_0^\\infty K^{f/2-1} \\exp(-\\beta K) \\, dK = \\int_0^\\infty \\left(\\frac{t}{\\beta}\\right)^{f/2-1} \\exp(-t) \\, \\frac{dt}{\\beta} \\\\\n= \\frac{1}{\\beta^{f/2-1}} \\frac{1}{\\beta} \\int_0^\\infty t^{f/2-1} \\exp(-t) \\, dt \\\\\n= \\frac{1}{\\beta^{f/2}} \\Gamma\\left(\\frac{f}{2}\\right)\n\\end{align*}\n归一化条件变为：\n$$\\mathcal{N} \\left[ \\frac{1}{\\beta^{f/2}} \\Gamma\\left(\\frac{f}{2}\\right) \\right] = 1 \\implies \\mathcal{N} = \\frac{\\beta^{f/2}}{\\Gamma(f/2)}$$\n将此归一化常数代回$p(K)$的表达式中，并用$1/(k_B T)$替换$\\beta$，我们得到最终的动能归一化概率密度：\n$$p(K) = \\frac{\\beta^{f/2}}{\\Gamma(f/2)} K^{f/2-1} \\exp(-\\beta K) = \\frac{(1/(k_B T))^{f/2}}{\\Gamma(f/2)} K^{f/2-1} \\exp\\left(-\\frac{K}{k_B T}\\right)$$\n这是一个形状参数为$\\alpha = f/2$、速率参数为$\\beta = 1/(k_B T)$的伽马分布。这就是任何正确的恒温器（包括基于随机速度重标定的恒温器）都必须再现的平稳平衡分布。\n$$p(K) = \\frac{1}{\\Gamma(f/2) (k_B T)^{f/2}} K^{\\frac{f}{2}-1} \\exp\\left(-\\frac{K}{k_B T}\\right)$$",
            "answer": "$$\\boxed{\\frac{1}{\\Gamma(\\frac{f}{2}) (k_{B} T)^{f/2}} K^{\\frac{f}{2}-1} \\exp\\left(-\\frac{K}{k_{B} T}\\right)}$$"
        },
        {
            "introduction": "将理论应用于实践，需要在模拟参数的选择上做出明智的权衡。本练习设定了一个模拟高温熔盐的真实场景，挑战您在确保数值积分稳定性（由时间步长 $\\Delta t$ 决定）和控制恒温器对系统动力学的影响（由弛豫时间 $\\tau$ 决定）之间找到最佳平衡点 。掌握这种权衡是进行可靠分子动力学模拟的核心技能之一，有助于培养您在实际科研问题中的判断力。",
            "id": "3841719",
            "problem": "一种高温熔盐使用经典分子动力学 (MD)、速度 Verlet 积分器和随机速度重标 (SVR) 恒温器进行模拟。由于强的短程排斥和长程库仑相互作用，该熔盐表现出快速的振动（类光学）离子模式。类似离子熔体的经验光谱和模拟数据表明，在高于 $1000\\,\\mathrm{K}$ 的温度下，最快的振动频率位于 $f_{\\max} \\in [20,40]\\,\\mathrm{THz}$ 的范围内，因此相应的角频率满足 $\\omega_{\\max} = 2\\pi f_{\\max} \\in [1.26\\times 10^{14},\\,2.51\\times 10^{14}]\\,\\mathrm{s}^{-1}$。SVR 恒温器通过一个弛豫时间参数 $\\tau$ 作用于总动能（因此其有效随机摩擦率与 $1/\\tau$ 成比例）。\n\n从第一性原理出发，论证当将最快的离子振动模式建模为谐振子时，为了保证速度 Verlet 的稳定性和准确性，对 MD 时间步长 $\\Delta t$ 的约束条件；并论证为确保正则采样且无过阻尼或对输运性质产生过度动力学偏差，对 $\\tau$ 的约束条件。然后，基于这些约束以及与多尺度材料模拟相关的权衡（其中短时振动动力学必须准确，长时输运应保持最小程度的扰动），为具有上述振动光谱的高温熔盐从以下选项中选择最合适的配对 $(\\Delta t,\\tau)$：\n\n- A. $\\Delta t = 0.2\\,\\mathrm{fs}$, $\\tau = 100\\,\\mathrm{fs}$\n- B. $\\Delta t = 2.0\\,\\mathrm{fs}$, $\\tau = 10\\,\\mathrm{fs}$\n- C. $\\Delta t = 0.5\\,\\mathrm{fs}$, $\\tau = 500\\,\\mathrm{fs}$\n- D. $\\Delta t = 0.05\\,\\mathrm{fs}$, $\\tau = 5.0\\,\\mathrm{ps}$\n\n选择能最佳平衡数值稳定性、正则采样的统计准确性以及对内禀输运的最小扰动的选项，并根据基本定律和经过充分检验的结果（例如，牛顿运动定律、速度 Verlet 对谐振子的稳定性特性以及类朗之万恒温器的欠阻尼状态）来论证你的选择。",
            "solution": "出发点是牛顿第二定律，对于单个谐振动模式，它可以写为 $m\\,\\ddot{x}(t) = -k\\,x(t)$，其中 $m$ 是离子质量，$k$ 是与短程排斥力和库仑恢复力相关的有效弹簧常数，而 $\\omega = \\sqrt{k/m}$ 是该模式的角频率。速度 Verlet 积分器通过时间步长为 $\\Delta t$ 的离散更新来近似连续动力学。对于谐振子，对辛二步法（包括速度 Verlet）的线性稳定性分析得出了经过充分检验的稳定性条件\n$$\n\\Delta t\\,\\omega  2,\n$$\n并且为了在高频模式中获得可接受的准确度和小的相位误差，通常会施加一个更严格的界限\n$$\n\\Delta t\\,\\omega \\lesssim \\alpha,\n$$\n其中 $\\alpha$ 是一个小的无量纲数（经验上 $\\alpha \\in [0.1,0.3]$），以确保截断误差和相位误差不会破坏短时动力学、能量守恒或在更长时间尺度上导出的输运性质。对于以 $\\omega_{\\max} \\in [1.26\\times 10^{14},\\,2.51\\times 10^{14}]\\,\\mathrm{s}^{-1}$ 为特征的最快模式，使用保守上限 $\\omega_{\\max} \\approx 2.51\\times 10^{14}\\,\\mathrm{s}^{-1}$ 可得\n$$\n\\Delta t \\lesssim \\frac{\\alpha}{\\omega_{\\max}}.\n$$\n取 $\\alpha \\approx 0.2$（对于高温下离子系统中的刚性、快速模式的常见选择），得出\n$$\n\\Delta t \\lesssim \\frac{0.2}{2.51\\times 10^{14}\\,\\mathrm{s}^{-1}} \\approx 7.97\\times 10^{-16}\\,\\mathrm{s} \\approx 0.80\\,\\mathrm{fs}.\n$$\n因此，接近 $0.5\\,\\mathrm{fs}$ 的 $\\Delta t$ 舒适地位于此范围内，而 $\\Delta t = 2.0\\,\\mathrm{fs}$ 则使 $\\Delta t\\,\\omega_{\\max} \\approx 0.50$（使用上面的 $\\omega_{\\max}$），这虽然仍是线性稳定的，但通常太大，无法准确解析高温下的最快振动，从而导致显著的相位误差、较差的能量守恒以及在采样和输运中的潜在人为效应。\n\n接下来，考虑恒温器耦合。SVR 恒温器随机地重标速度，以将总动能 $K$ 控制到正则分布。其作用可以映射到一个作用于动能的全局类朗之万摩擦，其有效速率为 $\\gamma = 1/\\tau$。对于角频率为 $\\omega$ 的单个振动模式，阻尼谐振子方程 $m\\,\\ddot{x} + \\zeta\\,\\dot{x} + k\\,x = \\xi(t)$（其中 $\\zeta$ 是一个摩擦参数，$\\xi(t)$ 是与涨落-耗散定理一致的随机力）表现出三种状态：如果 $\\zeta/(2m) > \\omega$ 则为过阻尼，如果 $\\zeta/(2m) = \\omega$ 则为临界阻尼，如果 $\\zeta/(2m)  \\omega$ 则为欠阻尼。将此转化为作用于速度的全局摩擦率 $\\gamma$，为避免最快模式的过阻尼，需要满足\n$$\n\\gamma \\ll \\omega_{\\max},\n$$\n即无量纲比率 $\\gamma/\\omega_{\\max} \\ll 1$，并且在实践中，为使输运性质的动力学偏差最小，人们倾向于选择 $\\gamma/\\omega_{\\max} \\sim 10^{-2}$–$10^{-1}$，这样恒温器可以足够快地弛豫动能以维持目标温度，但又不会显著抑制振荡或长时关联。由于 $\\gamma = 1/\\tau$，这意味着\n$$\n\\tau \\gg \\frac{1}{\\omega_{\\max}},\n$$\n通常选择在最快模式的多个振动周期的量级。对于 $\\omega_{\\max} \\approx 2.51\\times 10^{14}\\,\\mathrm{s}^{-1}$，我们有 $1/\\omega_{\\max} \\approx 3.98\\times 10^{-15}\\,\\mathrm{s} \\approx 4.0\\,\\mathrm{fs}$。选择比 $1/\\omega_{\\max}$ 大一到两个数量级的 $\\tau$（例如，$\\tau \\sim 100$–$1000\\,\\mathrm{fs}$）将系统稳固地置于欠阻尼状态，同时确保总动能自相关时间不会大到使温度控制在典型的模拟窗口内失效。这种选择保留了对速度关联敏感的输运性质（扩散、粘度），这在多尺度材料模拟中尤其重要，因为短时动力学为粗粒化模型提供信息，而长时采样则支撑着连续介质模型的封闭。\n\n现在我们通过计算无量纲乘积 $\\Delta t\\,\\omega_{\\max}$ 和 $\\gamma/\\omega_{\\max} = 1/(\\tau\\,\\omega_{\\max})$ 来评估每个选项，取 $\\omega_{\\max} \\approx 2.51\\times 10^{14}\\,\\mathrm{s}^{-1}$：\n\n- 选项 A：$\\Delta t = 0.2\\,\\mathrm{fs} = 2.0\\times 10^{-16}\\,\\mathrm{s}$ 得到 $\\Delta t\\,\\omega_{\\max} \\approx (2.0\\times 10^{-16}\\,\\mathrm{s})(2.51\\times 10^{14}\\,\\mathrm{s}^{-1}) \\approx 0.050$，远低于保守的准确度阈值。$\\tau = 100\\,\\mathrm{fs}$ 意味着 $\\gamma = 1/\\tau = 1.0\\times 10^{13}\\,\\mathrm{s}^{-1}$，得到 $\\gamma/\\omega_{\\max} \\approx 0.040$。这是欠阻尼的，并提供了相当快的温度控制。然而，$\\Delta t = 0.2\\,\\mathrm{fs}$ 对于离子熔体来说极其保守，可能不必要地小，这会降低效率，而相比一个稍大（但仍满足 $\\Delta t\\,\\omega_{\\max} \\lesssim 0.2$）的时间步长，采样并没有实质性的改善。在计算预算和吞吐量很重要的多尺度背景下，这个选择不是最优的。结论：不正确（$\\Delta t$ 过分保守，没有令人信服的采样优势）。\n\n- 选项 B：$\\Delta t = 2.0\\,\\mathrm{fs} = 2.0\\times 10^{-15}\\,\\mathrm{s}$ 得到 $\\Delta t\\,\\omega_{\\max} \\approx 0.50$，这超出了快速振动模式的典型准确度界限，并有在高温下产生显著相位误差和能量守恒性下降的风险。$\\tau = 10\\,\\mathrm{fs}$ 意味着 $\\gamma = 1.0\\times 10^{14}\\,\\mathrm{s}^{-1}$，因此 $\\gamma/\\omega_{\\max} \\approx 0.40$，这是一个相对强的耦合。虽然仍是欠阻尼（$\\gamma/\\omega_{\\max}  1$），但它施加了大量的随机阻尼，很可能使输运性质（例如，扩散系数）产生偏差并抑制速度关联。结论：不正确（时间步长太大，无法保证准确性；恒温器太强，无法实现最小偏差的输运）。\n\n- 选项 C：$\\Delta t = 0.5\\,\\mathrm{fs} = 5.0\\times 10^{-16}\\,\\mathrm{s}$ 得到 $\\Delta t\\,\\omega_{\\max} \\approx (5.0\\times 10^{-16}\\,\\mathrm{s})(2.51\\times 10^{14}\\,\\mathrm{s}^{-1}) \\approx 0.126$，舒适地处于快速振动模式的保守准确度范围内，确保了在高温下对高频离子运动的稳定、准确解析。$\\tau = 500\\,\\mathrm{fs}$ 意味着 $\\gamma = 2.0\\times 10^{12}\\,\\mathrm{s}^{-1}$，因此 $\\gamma/\\omega_{\\max} \\approx 0.008$，这是一个弱耦合。这保留了欠阻尼振荡并最小化了动力学偏差，同时仍在亚皮秒时间尺度上提供了足够的温度控制。总动能自相关时间 $\\sim \\tau$ 相对于典型的纳秒模拟窗口仍然很短，因此正则采样是高效的。结论：正确（平衡了稳定性、准确性和对输运的最小扰动）。\n\n- 选项 D：$\\Delta t = 0.05\\,\\mathrm{fs} = 5.0\\times 10^{-17}\\,\\mathrm{s}$ 得到 $\\Delta t\\,\\omega_{\\max} \\approx 0.0126$，这是极其保守的，并且远小于准确性所需，极大地降低了效率。$\\tau = 5.0\\,\\mathrm{ps}$ 意味着 $\\gamma = 2.0\\times 10^{11}\\,\\mathrm{s}^{-1}$，因此 $\\gamma/\\omega_{\\max} \\approx 0.0008$，这是一个极弱的耦合。虽然这对动力学的扰动最小，但它也导致了非常慢的温度弛豫和长的动能自相关，减少了在实际模拟长度内的统计独立样本数量，并使热控制变得迟缓——这在能量涨落可能很大的高温下是不希望看到的。结论：不正确（$\\Delta t$ 过分保守，恒温控制过慢；实际采样效率差）。\n\n总而言之，选项 C 为具有快速振动模式的高温熔盐达到了最佳平衡：$\\Delta t = 0.5\\,\\mathrm{fs}$ 保证了对 $\\omega_{\\max}$ 的准确性和稳定性，而 $\\tau = 500\\,\\mathrm{fs}$ 提供了弱的、欠阻尼的耦合，既保留了输运性质，又保持了正则采样的有效性。",
            "answer": "$$\\boxed{C}$$"
        },
        {
            "introduction": "本章的最后一个实践环节是将 SVR 算法的理论转化为高效且正确的代码。这个练习将指导您为多个独立的原子组实现 SVR 更新规则，重点在于利用矢量化计算来提升性能，并使用独立的随机数流来保证不同组别之间统计上的独立性 。通过完成这项任务，您将打通从理论概念到实际编程实现的“最后一公里”。",
            "id": "3841727",
            "problem": "您的任务是为多尺度材料模拟中的多个独立组设计并实现一个单步随机速度重缩放（SVR）恒温器更新。每个组代表一组速度自由度，SVR 更新通过一个公共标量来重缩放该组的速度，以便在指定温度下对正则系综进行抽样。您的实现必须对大的 $N$（许多大小不一的组）是高效的，必须维护特定于组的自由度 $N_f$，并且必须为每个组使用独立的随机数流以避免组间相关。\n\n从以下基本原理开始：\n- 一组速度的动能为 $K = \\frac{1}{2} \\sum_{i} m_i v_i^2$，其中 $m_i$ 和 $v_i$ 是每个自由度的质量和速度。\n- 在温度 $T$ 的平衡状态下，动能的稳态正则分布是伽马分布，其概率密度与 $K^{N_f/2-1} \\exp\\!\\left(-\\frac{K}{k_{\\mathrm{B}} T}\\right)$ 成正比，其中 $N_f$ 是独立速度自由度的数量，$k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n- 定义目标动能 $K_T = \\frac{N_f k_{\\mathrm{B}} T}{2}$。一个物理上一致的恒温器更新必须具有向 $K_T$ 的均值回归，弛豫时间为 $ \\tau $，使得更新后动能 $K'$ 的条件期望满足 $\\mathbb{E}[K' \\mid K] = c K + (1 - c) K_T$，其中 $c = \\exp\\!\\left(-\\frac{\\Delta t}{\\tau}\\right)$ 且 $\\Delta t$ 是时间步长。\n\n您的任务是：\n1.  根据正则速度分布的高斯结构和上述的均值回归特性，为每个组推导出一个更新后动能 $K'$ 的精确抽样公式，该动能是通过对组内速度进行共同的随机重缩放得到的。该公式必须与温度 $T$ 下的正则稳态分布一致，并且必须保持速度向量的共线性（即所有分量都按相同标量缩放）。\n2.  设计一个高效的向量化计算，该计算在一次调用中将此 SVR 更新应用于 $N$ 个独立组，其中每个组 $g$ 由其当前动能 $K_g$、自由度 $N_{f,g}$、温度 $T_g$、时间步长 $\\Delta t_g$ 和弛豫时间 $\\tau_g$ 来表征。\n3.  通过为每个组使用不同的随机数流，确保用于不同组的随机变量是独立的。随机数流必须能够通过从单个基础种子进行种子分裂来构造，从而实现可复现性。使用一种能为所有组产生独立流的播种机制。\n4.  在一个单一、自包含的程序中实现该算法，该程序为指定的测试套件计算更新后的动能 $K'_g$，并以所需的输出格式打印结果。\n\n物理单位：\n- 使用 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\ \\mathrm{J/K}$。\n- 动能 $K$、$K'$ 和 $K_T$ 必须以 $\\mathrm{J}$（焦耳）为单位处理和报告。\n- 温度 $T$ 以 $\\mathrm{K}$（开尔文）为单位。\n- 时间 $\\Delta t$ 和 $\\tau$ 以 $\\mathrm{s}$（秒）为单位。\n\n测试套件：\n- 为了可复现性，使用基础种子 $s_0 = 20231024$。将此种子分裂成每个组的独立流。\n- 为以下五个组计算 $K'_g$：\n    1. 组 1：$N_{f,1} = 3$， $T_1 = 300\\ \\mathrm{K}$， $\\Delta t_1 = 1 \\times 10^{-15}\\ \\mathrm{s}$， $\\tau_1 = 1 \\times 10^{-13}\\ \\mathrm{s}$， $K_1 = K_{T,1} = \\frac{N_{f,1} k_{\\mathrm{B}} T_1}{2}$。\n    2. 组 2：$N_{f,2} = 1$， $T_2 = 100\\ \\mathrm{K}$， $\\Delta t_2 = 5 \\times 10^{-15}\\ \\mathrm{s}$， $\\tau_2 = 1 \\times 10^{-13}\\ \\mathrm{s}$， $K_2 = 1 \\times 10^{-22}\\ \\mathrm{J}$。\n    3. 组 3：$N_{f,3} = 50$， $T_3 = 300\\ \\mathrm{K}$， $\\Delta t_3 = 5 \\times 10^{-13}\\ \\mathrm{s}$， $\\tau_3 = 1 \\times 10^{-13}\\ \\mathrm{s}$， $K_3 = 2.0 \\times 10^{-19}\\ \\mathrm{J}$。\n    4. 组 4：$N_{f,4} = 1000$， $T_4 = 300\\ \\mathrm{K}$， $\\Delta t_4 = 1 \\times 10^{-14}\\ \\mathrm{s}$， $\\tau_4 = 5 \\times 10^{-13}\\ \\mathrm{s}$， $K_4 = 1.8 \\times 10^{-18}\\ \\mathrm{J}$。\n    5. 组 5：$N_{f,5} = 6$， $T_5 = 1000\\ \\mathrm{K}$， $\\Delta t_5 = 1 \\times 10^{-15}\\ \\mathrm{s}$， $\\tau_5 = 1 \\times 10^{-9}\\ \\mathrm{s}$， $K_5 = 1.0 \\times 10^{-20}\\ \\mathrm{J}$。\n\n最终输出规范：\n- 您的程序应生成一行输出，其中包含五个组的 $K'_g$ 值（单位为 $\\mathrm{J}$），聚合为一个用方括号括起来的逗号分隔列表，例如：$\\left[ \\text{result}_1, \\text{result}_2, \\text{result}_3, \\text{result}_4, \\text{result}_5 \\right]$。\n- 每个 $\\text{result}_g$ 必须是一个浮点数，表示以 $\\mathrm{J}$ 为单位的 $K'_g$。",
            "solution": "用户提供的问题陈述已经过验证，并被确定为一个有效的、适定的科学问题。以下解决方案源于统计力学和分子模拟数值算法的既定原则。\n\n问题的核心是为一组粒子的动能 $K$ 设计并实现一个更新规则，该更新模拟了与目标温度 $T$ 的热浴的耦合。该更新，被称为随机速度重缩放（SVR）恒温器，必须满足两个关键属性：\n1.  它必须驱动系统趋向于具有 $N_f$ 个自由度的系统的正确正则动能分布，即伽马分布，$K \\sim \\Gamma(\\text{shape}=N_f/2, \\text{scale}=k_{\\mathrm{B}}T)$。\n2.  动能的时间演化必须表现出向目标平均值 $K_T = N_f k_{\\mathrm{B}} T / 2$ 的指数弛豫，由条件期望 $\\mathbb{E}[K' \\mid K] = cK + (1-c)K_T$ 控制，其中 $c = \\exp(-\\Delta t/\\tau)$。\n\nSVR 算法通过从一个为满足这些属性而精心构造的分布中随机抽样新的动能 $K'$ 来实现这一点。然后，速度矢量通过一个公共因子 $\\alpha = \\sqrt{K'/K}$ 进行重缩放，以实现这个新的动能。我们的任务是推导并实现用于抽样 $K'$ 的公式。\n\n遵循 Bussi、Donadio 和 Parrinello 的原创工作，可以构建新动能 $K'$ 的精确抽样公式如下：\n$$\nK' = \\left(\\sqrt{cK} + A\\right)^2 + B\n$$\n其中 $c = \\exp(-\\Delta t/\\tau)$ 是弛豫因子，$A$ 和 $B$ 是从特定分布中抽取的随机变量，旨在注入正确量的随机性。$A$ 和 $B$ 的分布为：\n- $A \\sim \\mathcal{N}(0, \\sigma^2)$，一个均值为 $0$、方差为 $\\sigma^2 = (1-c)k_{\\mathrm{B}}T/2$ 的高斯随机变量。\n- $B \\sim \\Gamma(k, \\theta)$，一个形状参数为 $k = (N_f-1)/2$、尺度参数为 $\\theta = (1-c)k_{\\mathrm{B}}T$ 的伽马分布随机变量。\n\n对于一个组只有一个自由度的特殊情况，即 $N_f=1$，伽马分布的形状参数 $k$ 变为 $0$。形状参数为零的伽马分布变量恒等于零。因此，对于 $N_f=1$，项 $B$ 消失，更新公式简化为 $K' = (\\sqrt{cK} + A)^2$。\n\n我们必须验证这个 $K'$ 的公式是否满足所需的均值回归属性。我们计算条件期望 $\\mathbb{E}[K' \\mid K]$：\n$$\n\\mathbb{E}[K' \\mid K] = \\mathbb{E}\\left[ (\\sqrt{cK} + A)^2 + B \\mid K \\right]\n$$\n$$\n\\mathbb{E}[K' \\mid K] = \\mathbb{E}[cK + 2\\sqrt{cK}A + A^2 + B]\n$$\n利用期望的线性和 $A$、$B$ 的独立性：\n$$\n\\mathbb{E}[K' \\mid K] = cK + 2\\sqrt{cK}\\mathbb{E}[A] + \\mathbb{E}[A^2] + \\mathbb{E}[B]\n$$\n根据 $A$ 和 $B$ 的分布定义，我们知道它们的均值和方差：\n- $\\mathbb{E}[A] = 0$\n- $\\mathbb{E}[A^2] = \\mathrm{Var}(A) + (\\mathbb{E}[A])^2 = \\sigma^2 + 0^2 = (1-c)k_{\\mathrm{B}}T/2$\n- $\\mathbb{E}[B] = k \\cdot \\theta = \\frac{N_f-1}{2} \\cdot (1-c)k_{\\mathrm{B}}T$\n\n将这些代入 $\\mathbb{E}[K' \\mid K]$ 的表达式中：\n$$\n\\mathbb{E}[K' \\mid K] = cK + 2\\sqrt{cK}(0) + \\frac{(1-c)k_{\\mathrm{B}}T}{2} + \\frac{(N_f-1)(1-c)k_{\\mathrm{B}}T}{2}\n$$\n$$\n\\mathbb{E}[K' \\mid K] = cK + (1-c)\\frac{k_{\\mathrm{B}}T}{2} \\left(1 + (N_f-1)\\right)\n$$\n$$\n\\mathbb{E}[K' \\mid K] = cK + (1-c) \\frac{N_f k_{\\mathrm{B}}T}{2}\n$$\n认识到目标动能的定义 $K_T = N_f k_{\\mathrm{B}}T/2$，我们得到：\n$$\n\\mathbb{E}[K' \\mid K] = cK + (1-c)K_T\n$$\n这证实了我们为 $K'$ 选择的公式正确地再现了所需的指数弛豫动力学。该构造还保证了 $K$ 的稳态分布是正确的正则伽马分布，这是原始文献中已确立的结果。\n\n实现将是对 $N=5$ 个独立组的向量化计算。每个组的参数（$N_f, T, \\Delta t, \\tau, K$）将存储在 NumPy 数组中。诸如计算 $c$ 和随机变量 $A_g$ 和 $B_g$ 参数之类的逐元素计算将直接在这些数组上执行。\n\n一个关键要求是为每个组使用独立的随机数流以防止伪相关。这可通过使用 NumPy 的现代随机数生成基础架构来实现。从基础种子 $s_0=20231024$ 创建一个主 `SeedSequence`。然后使用此序列 `spawn`（派生）出五个独立的子种子序列，每个组一个。每个子种子用于初始化一个独立的 `Generator` 实例。然后从其专用生成器中为每个组抽取随机数。\n\n算法流程如下：\n1.  在 NumPy 数组中初始化五个测试组的物理常数和参数。\n2.  使用 `numpy.random.SeedSequence(s_0).spawn(5)` 设置五个独立的随机数生成器。\n3.  为每个组 $g$ 计算弛豫因子 $c_g$ 以及随机变量 $A_g$ 和 $B_g$ 的参数。\n4.  对于每个组 $g$，抽取一个高斯随机数以构造 $A_g$，并且如果 $N_{f,g}  1$，则抽取一个伽马分布随机数作为 $B_g$。如果 $N_{f,g} = 1$，则 $B_g$ 设为 $0$。\n5.  使用推导的公式为每个组计算更新后的动能 $K'_g$。\n6.  将得到的 $K'_g$ 值列表格式化为指定的输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the updated kinetic energies of multiple groups using the\n    Stochastic Velocity Rescaling (SVR) thermostat.\n    \"\"\"\n    # Physical and simulation constants\n    k_B = 1.380649e-23  # Boltzmann constant in J/K\n    base_seed = 20231024\n\n    # Test suite parameters for five groups\n    test_cases_data = [\n        # Group 1: N_f=3, T=300 K, dt=1e-15 s, tau=1e-13 s, K=K_T\n        {'N_f': 3, 'T': 300.0, 'dt': 1e-15, 'tau': 1e-13, 'K_def': {'type': 'target'}},\n        # Group 2: N_f=1, T=100 K, dt=5e-15 s, tau=1e-13 s, K=1e-22 J\n        {'N_f': 1, 'T': 100.0, 'dt': 5e-15, 'tau': 1e-13, 'K_def': {'type': 'value', 'val': 1e-22}},\n        # Group 3: N_f=50, T=300 K, dt=5e-13 s, tau=1e-13 s, K=2.0e-19 J\n        {'N_f': 50, 'T': 300.0, 'dt': 5e-13, 'tau': 1e-13, 'K_def': {'type': 'value', 'val': 2.0e-19}},\n        # Group 4: N_f=1000, T=300 K, dt=1e-14 s, tau=5e-13 s, K=1.8e-18 J\n        {'N_f': 1000, 'T': 300.0, 'dt': 1e-14, 'tau': 5e-13, 'K_def': {'type': 'value', 'val': 1.8e-18}},\n        # Group 5: N_f=6, T=1000 K, dt=1e-15 s, tau=1e-9 s, K=1.0e-20 J\n        {'N_f': 6, 'T': 1000.0, 'dt': 1e-15, 'tau': 1e-9, 'K_def': {'type': 'value', 'val': 1.0e-20}},\n    ]\n\n    num_groups = len(test_cases_data)\n\n    # Extract parameters into NumPy arrays for vectorized computation\n    N_f = np.array([case['N_f'] for case in test_cases_data], dtype=int)\n    T = np.array([case['T'] for case in test_cases_data], dtype=float)\n    dt = np.array([case['dt'] for case in test_cases_data], dtype=float)\n    tau = np.array([case['tau'] for case in test_cases_data], dtype=float)\n    \n    # Calculate initial kinetic energies K\n    K = np.zeros(num_groups, dtype=float)\n    for i, case in enumerate(test_cases_data):\n        if case['K_def']['type'] == 'target':\n            K[i] = N_f[i] * k_B * T[i] / 2.0\n        else:\n            K[i] = case['K_def']['val']\n\n    # --- SVR Algorithm Implementation ---\n\n    # 1. Setup independent random number streams for each group\n    ss = np.random.SeedSequence(base_seed)\n    child_seeds = ss.spawn(num_groups)\n    streams = [np.random.default_rng(s) for s in child_seeds]\n\n    # 2. Calculate group-specific parameters in a vectorized manner\n    c = np.exp(-dt / tau)\n    \n    # Parameters for the Gaussian random variable A\n    sigma_sq_A = (1.0 - c) * k_B * T / 2.0\n    # Guard against negative variance due to floating point inaccuracies if 1-c is tiny\n    sigma_sq_A[sigma_sq_A  0] = 0\n    sigma_A = np.sqrt(sigma_sq_A)\n\n    # Parameters for the Gamma random variable B\n    shape_B = (N_f - 1.0) / 2.0\n    scale_B = (1.0 - c) * k_B * T\n\n    # 3. Generate random numbers from independent streams\n    A = np.zeros(num_groups, dtype=float)\n    B = np.zeros(num_groups, dtype=float)\n\n    for i in range(num_groups):\n        # Draw from Gaussian distribution for A\n        A[i] = streams[i].normal(loc=0.0, scale=sigma_A[i])\n\n        # Draw from Gamma distribution for B, only if N_f > 1\n        if N_f[i] > 1:\n            B[i] = streams[i].gamma(shape=shape_B[i], scale=scale_B[i])\n\n    # 4. Calculate the new kinetic energy K'\n    # Guard against taking sqrt of negative K (physically impossible but good practice)\n    K[K  0] = 0\n    term1 = np.sqrt(c * K) + A\n    K_prime = term1**2 + B\n\n    results = K_prime.tolist()\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}