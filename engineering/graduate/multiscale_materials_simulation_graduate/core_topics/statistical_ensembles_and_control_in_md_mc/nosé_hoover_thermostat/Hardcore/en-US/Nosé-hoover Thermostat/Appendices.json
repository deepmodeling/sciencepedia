{
    "hands_on_practices": [
        {
            "introduction": "The foundational task for any thermostat is to maintain the system at a desired average temperature. In the language of statistical mechanics, this translates to enforcing a specific average kinetic energy. This first exercise  challenges you to determine this target kinetic energy by carefully applying the equipartition theorem, a task that requires a precise accounting of every degree of freedom that contributes to the system's motion, including translational and rotational modes for complex molecules and the effect of system-wide constraints.",
            "id": "3788515",
            "problem": "Consider a three-dimensional Molecular Dynamics (MD) simulation of a coarse-grained fluid in which each molecule is treated as a rigid body. Let there be $N$ molecules in total, and suppose $M$ of them are linear rigid bodies (for which rotations around the molecular axis carry no kinetic energy due to a vanishing principal moment of inertia), while the remaining $N - M$ are non-linear rigid bodies. The rigid-body kinetic energy of molecule $i$ is the sum of a translational quadratic form and a rotational quadratic form, each defined by a positive semi-definite mass matrix; for a linear rigid body the rotational inertia tensor has rank $2$, whereas for a non-linear rigid body it has rank $3$. The numerical integrator removes the total linear momentum at every step so that the center-of-mass velocity of the entire system is identically zero. The system is coupled to a Nosé–Hoover thermostat to sample the canonical ensemble at temperature $T$, where $T$ is the thermodynamic temperature and $k_B$ is the Boltzmann constant.\n\nStarting only from the equipartition principle for quadratic degrees of freedom in the canonical ensemble and from the rigid-body structure of the kinetic energy, determine the effective number of quadratic degrees of freedom that contribute to kinetic energy in this system. Then use this number to write, in closed form, the target kinetic energy that appears in the thermostat’s energy-matching condition required to enforce the canonical temperature. Your answer must be a single analytical expression in terms of $N$, $M$, $k_B$, and $T$. No numerical values are required, and no intermediate formulas should be assumed beyond the fundamental principles stated here. The final expression does not require units. If you choose to present any intermediate quantities, ensure all mathematical expressions are in LaTeX. Provide the final expression only as your answer.",
            "solution": "The problem requires the determination of the target kinetic energy for a system of $N$ rigid molecules coupled to a Nosé–Hoover thermostat, which is designed to maintain a constant average temperature $T$. This target kinetic energy is the ensemble average of the system's kinetic energy, $\\langle K \\rangle$, in the canonical ensemble. The equipartition principle of classical statistical mechanics states that, for a system in thermal equilibrium, every quadratic degree of freedom in the Hamiltonian contributes an average energy of $\\frac{1}{2} k_B T$, where $k_B$ is the Boltzmann constant. Therefore, the task reduces to finding the total number of effective quadratic degrees of freedom, $N_{dof}$, that contribute to the kinetic energy of the system. The target kinetic energy will then be given by the expression:\n$$ \\langle K \\rangle = \\frac{1}{2} N_{dof} k_B T $$\n\nThe total kinetic energy $K$ of the system is the sum of the kinetic energies of all $N$ molecules. Each molecule's kinetic energy is a sum of its translational and rotational kinetic energies. We must determine the number of independent quadratic terms in this total sum.\n\nFirst, we consider the translational degrees of freedom. Each of the $N$ molecules is a point mass with respect to its translational motion in a $3$-dimensional space. The translational kinetic energy of a single molecule $i$ with mass $m_i$ and velocity $\\mathbf{v}_i = (v_{ix}, v_{iy}, v_{iz})$ is given by:\n$$ K_{i, \\text{trans}} = \\frac{1}{2} m_i |\\mathbf{v}_i|^2 = \\frac{1}{2} m_i (v_{ix}^2 + v_{iy}^2 + v_{iz}^2) $$\nThis expression contains $3$ quadratic terms in the velocity components. For a system of $N$ molecules, there would nominally be $3N$ translational degrees of freedom. However, the problem states a constraint: the total linear momentum of the system is held at zero. This corresponds to setting the velocity of the center-of-mass to zero. The total linear momentum $\\mathbf{P}$ is:\n$$ \\mathbf{P} = \\sum_{i=1}^N m_i \\mathbf{v}_i = \\mathbf{0} $$\nThis is a vector equation, which implies three scalar constraints on the velocity components of the particles:\n$$ \\sum_{i=1}^N m_i v_{ix} = 0 $$\n$$ \\sum_{i=1}^N m_i v_{iy} = 0 $$\n$$ \\sum_{i=1}^N m_i v_{iz} = 0 $$\nEach of these linear constraints removes one degree of freedom from the system. Therefore, the total number of independent translational degrees of freedom, $N_{dof, \\text{trans}}$, is not $3N$, but rather:\n$$ N_{dof, \\text{trans}} = 3N - 3 $$\n\nNext, we consider the rotational degrees of freedom. The system contains $M$ linear rigid bodies and $N-M$ non-linear rigid bodies.\nFor a linear rigid body in $3$-dimensional space, the rotational kinetic energy can be described by rotations about two principal axes perpendicular to the molecular axis. The moment of inertia about the molecular axis itself is taken to be zero for a classical linear rigid body, so rotation about this axis carries no kinetic energy. Thus, each of the $M$ linear molecules contributes $2$ rotational degrees of freedom. The total from this group is:\n$$ N_{dof, \\text{rot, linear}} = 2M $$\nFor a non-linear rigid body in $3$-dimensional space, the moments of inertia about all three principal axes are non-zero. Therefore, it has $3$ rotational degrees of freedom. The system contains $N-M$ such molecules. The total from this group is:\n$$ N_{dof, \\text{rot, non-linear}} = 3(N - M) $$\nThe total number of rotational degrees of freedom, $N_{dof, \\text{rot}}$, is the sum of the contributions from both types of molecules:\n$$ N_{dof, \\text{rot}} = 2M + 3(N - M) = 2M + 3N - 3M = 3N - M $$\nThere are no constraints specified for the total angular momentum, so all these rotational degrees of freedom are independent and contribute to the kinetic energy.\n\nThe total number of effective quadratic degrees of freedom for the entire system, $N_{dof}$, is the sum of the translational and rotational degrees of freedom:\n$$ N_{dof} = N_{dof, \\text{trans}} + N_{dof, \\text{rot}} $$\n$$ N_{dof} = (3N - 3) + (3N - M) = 6N - M - 3 $$\n\nFinally, we apply the equipartition principle to find the target kinetic energy, $\\langle K \\rangle$. With $N_{dof} = 6N - M - 3$ quadratic degrees of freedom, each contributing an average energy of $\\frac{1}{2} k_B T$, the total average kinetic energy is:\n$$ \\langle K \\rangle = N_{dof} \\times \\left(\\frac{1}{2} k_B T\\right) = (6N - M - 3) \\frac{1}{2} k_B T $$\nThis is the closed-form expression for the target kinetic energy required by the thermostat.",
            "answer": "$$ \\boxed{\\frac{1}{2} (6N - M - 3) k_B T} $$"
        },
        {
            "introduction": "A well-designed thermostat does not rigidly clamp the kinetic energy but instead allows it to fluctuate naturally, consistent with the statistical properties of the canonical ensemble. This practice  delves into the dynamics of this process by asking you to derive the expected size of these kinetic energy fluctuations. Furthermore, by linearizing the equations of motion, you will uncover the characteristic frequency of energy exchange between the system and the thermostat, providing crucial insight into how the thermostat's 'mass' parameter $Q$ governs its response time.",
            "id": "3788475",
            "problem": "Consider a classical system with $f$ independent quadratic degrees of freedom in contact with a Nosé–Hoover thermostat at temperature $T$. Let $K$ denote the instantaneous kinetic energy. Assume canonical sampling is achieved at equilibrium. Starting from first principles of the canonical ensemble and the Maxwell–Boltzmann distribution, derive a closed-form expression for the variance $\\mathrm{Var}(K)$ in terms of $f$, the Boltzmann constant $k_{B}$, and $T$. Next, consider the standard Nosé–Hoover equations of motion for a system with coordinates $q_{i}$, momenta $p_{i}$, masses $m_{i}$, forces $F_{i}$, and thermostat friction variable $\\xi$ with thermostat mass parameter $Q$:\n$$\n\\dot{q}_{i}=\\frac{p_{i}}{m_{i}},\\qquad\n\\dot{p}_{i}=F_{i}-\\xi\\,p_{i},\\qquad\n\\dot{\\xi}=\\frac{1}{Q}\\left(2K-f\\,k_{B}T\\right).\n$$\nLinearize these equations about thermal equilibrium, where $K=\\langle K\\rangle$ and $\\xi=0$, to obtain the characteristic angular frequency $\\omega_{Q}$ that governs small-amplitude exchanges of kinetic energy between the system and the thermostat. Treat the reversible virial term $\\sum_{i} v_{i}F_{i}$ as rapidly fluctuating and averaging to zero on the thermostat timescale so that the leading-order coupling of $K$ to $\\xi$ dominates the slow envelope dynamics. Express $\\omega_{Q}$ in terms of $f$, $k_{B}$, $T$, and $Q$. Briefly interpret how $Q$ filters kinetic energy fluctuations in a multiscale sense by setting the exchange timescale.\n\nExpress your final answer as a two-entry row matrix $\\big[\\mathrm{Var}(K),\\ \\omega_{Q}\\big]$. Report $\\mathrm{Var}(K)$ in squared energy and $\\omega_{Q}$ in radians per unit time. Do not include units in the boxed answer. No numerical substitution is required; provide exact symbolic expressions only.",
            "solution": "The problem consists of two parts. First, we derive the variance of the kinetic energy, $\\mathrm{Var}(K)$, for a system in the canonical ensemble. Second, we linearize the Nosé-Hoover equations of motion to find the characteristic frequency of energy exchange, $\\omega_{Q}$.\n\nPart 1: Derivation of the Variance of Kinetic Energy, $\\mathrm{Var}(K)$\n\nWe begin from the principles of the canonical ensemble. For a classical system with $f$ independent quadratic degrees of freedom, the total kinetic energy is given by $K = \\sum_{j=1}^{f} \\epsilon_j$, where each $\\epsilon_j$ is the kinetic energy associated with one degree of freedom (e.g., $\\frac{p_x^2}{2m}$).\n\nIn the canonical ensemble at temperature $T$, the probability distribution of momentum for a single degree of freedom is given by the Maxwell-Boltzmann distribution, which is a Gaussian distribution. The corresponding kinetic energy $\\epsilon$ for that degree of freedom has a probability distribution that can be derived from it. This distribution is a Gamma distribution, $\\Gamma(k, \\theta)$, with shape parameter $k = 1/2$ and scale parameter $\\theta = k_B T$. The probability density function for $\\epsilon$ is:\n$$\nP(\\epsilon) = \\frac{1}{\\Gamma(1/2)(k_B T)^{1/2}} \\epsilon^{1/2 - 1} \\exp\\left(-\\frac{\\epsilon}{k_B T}\\right)\n$$\nwhere $\\Gamma(1/2) = \\sqrt{\\pi}$.\n\nThe total kinetic energy $K$ is the sum of $f$ such independent and identically distributed random variables. A key property of the Gamma distribution is that the sum of independent Gamma-distributed variables with the same scale parameter $\\theta$ is also a Gamma-distributed variable. The new shape parameter is the sum of the individual shape parameters. Therefore, $K$ follows a Gamma distribution with shape parameter $k_K = \\sum_{j=1}^{f} (1/2) = f/2$ and scale parameter $\\theta_K = k_B T$. The probability density function for $K$ is:\n$$\nP(K) = \\frac{1}{\\Gamma(f/2)(k_B T)^{f/2}} K^{f/2 - 1} \\exp\\left(-\\frac{K}{k_B T}\\right)\n$$\nFor a Gamma distribution $\\Gamma(k, \\theta)$, the mean is $\\langle X \\rangle = k\\theta$ and the variance is $\\mathrm{Var}(X) = k\\theta^2$. Applying this to the distribution of $K$, we find the mean kinetic energy:\n$$\n\\langle K \\rangle = k_K \\theta_K = \\left(\\frac{f}{2}\\right)(k_B T) = \\frac{f}{2}k_B T\n$$\nThis result is the well-known equipartition theorem. The variance of the kinetic energy is:\n$$\n\\mathrm{Var}(K) = k_K \\theta_K^2 = \\left(\\frac{f}{2}\\right)(k_B T)^2 = \\frac{f}{2}k_B^2 T^2\n$$\nThis expression gives the variance of the kinetic energy in terms of the number of degrees of freedom $f$, the Boltzmann constant $k_B$, and the temperature $T$.\n\nPart 2: Derivation of the Characteristic Frequency, $\\omega_{Q}$\n\nWe are given the standard Nosé-Hoover equations of motion:\n$$\n\\dot{q}_{i}=\\frac{p_{i}}{m_{i}}, \\qquad \\dot{p}_{i}=F_{i}-\\xi p_{i}, \\qquad \\dot{\\xi}=\\frac{1}{Q}\\left(2K-f k_{B}T\\right)\n$$\nWe need to find the equation of motion for the kinetic energy $K = \\sum_{i} \\frac{p_{i}^2}{2m_{i}}$. Taking the time derivative of $K$:\n$$\n\\dot{K} = \\sum_{i} \\frac{p_{i}}{m_{i}} \\dot{p}_{i} = \\sum_{i} v_{i} \\dot{p}_{i}\n$$\nSubstituting the expression for $\\dot{p}_{i}$:\n$$\n\\dot{K} = \\sum_{i} v_{i} (F_{i} - \\xi p_{i}) = \\sum_{i} v_{i}F_{i} - \\xi \\sum_{i} v_{i}p_{i}\n$$\nRecognizing that $v_{i} = p_{i}/m_{i}$, the second term becomes $\\xi \\sum_{i} p_{i}^2/m_{i} = 2\\xi \\sum_{i} p_{i}^2/(2m_{i}) = 2\\xi K$. Thus, the dynamics of $K$ and $\\xi$ are described by the coupled system:\n$$\n\\dot{K} = \\sum_{i} v_{i}F_{i} - 2\\xi K\n$$\n$$\n\\dot{\\xi} = \\frac{1}{Q}(2K - f k_B T)\n$$\nWe linearize this system around the thermal equilibrium fixed point, which is characterized by $\\langle \\xi \\rangle = 0$ and $\\langle K \\rangle = \\frac{f}{2}k_B T$. Let the fluctuations around this point be $\\delta\\xi = \\xi - \\langle \\xi \\rangle = \\xi$ and $\\delta K = K - \\langle K \\rangle$.\nThe equations for the fluctuations are:\n$$\n\\dot{(\\delta K)} = \\dot{K} = \\sum_{i} v_{i}F_{i} - 2(\\delta\\xi)(\\delta K + \\langle K \\rangle)\n$$\n$$\n\\dot{(\\delta\\xi)} = \\dot{\\xi} = \\frac{1}{Q}(2(\\delta K + \\langle K \\rangle) - f k_B T) = \\frac{1}{Q}(2\\delta K + 2\\langle K \\rangle - f k_B T)\n$$\nSubstituting $\\langle K \\rangle = \\frac{f}{2}k_B T$ into the second equation simplifies it:\n$$\n\\dot{(\\delta\\xi)} = \\frac{1}{Q}(2\\delta K + f k_B T - f k_B T) = \\frac{2}{Q}\\delta K\n$$\nThis is the first linearized equation. For the $\\dot{(\\delta K)}$ equation, we linearize by neglecting second-order terms in the fluctuations, i.e., the term $-2(\\delta\\xi)(\\delta K)$. The problem also states to treat the reversible virial term $\\sum_{i} v_{i}F_{i}$ as a fast fluctuating term that can be neglected when analyzing the slow dynamics of the thermostat. This yields:\n$$\n\\dot{(\\delta K)} \\approx -2\\langle K \\rangle \\delta\\xi\n$$\nSubstituting the value of $\\langle K \\rangle$:\n$$\n\\dot{(\\delta K)} = -2\\left(\\frac{f}{2}k_B T\\right)\\delta\\xi = -f k_B T \\delta\\xi\n$$\nWe now have a system of two coupled linear ordinary differential equations:\n$$\n(1) \\qquad \\dot{(\\delta K)} = -f k_B T \\delta\\xi\n$$\n$$\n(2) \\qquad \\dot{(\\delta \\xi)} = \\frac{2}{Q} \\delta K\n$$\nTo find the characteristic frequency, we combine them into a single second-order equation. Differentiating equation (2) with respect to time gives:\n$$\n\\ddot{(\\delta \\xi)} = \\frac{2}{Q} \\dot{(\\delta K)}\n$$\nSubstituting equation (1) into this expression:\n$$\n\\ddot{(\\delta \\xi)} = \\frac{2}{Q}(-f k_B T \\delta\\xi) = -\\left(\\frac{2f k_B T}{Q}\\right)\\delta\\xi\n$$\nThis is the standard form of the simple harmonic oscillator equation, $\\ddot{x} = -\\omega^2 x$. By comparison, the square of the characteristic angular frequency is:\n$$\n\\omega_{Q}^2 = \\frac{2f k_B T}{Q}\n$$\nTherefore, the characteristic angular frequency is:\n$$\n\\omega_{Q} = \\sqrt{\\frac{2f k_B T}{Q}}\n$$\nThe parameter $Q$, often called the thermostat \"mass,\" controls the timescale of energy exchange. A large value of $Q$ results in a small $\\omega_{Q}$ and a long period of oscillation, meaning the energy exchange between the system and the thermostat is slow. The thermostat is \"heavy\" and does not closely follow rapid fluctuations in the system's kinetic energy. Conversely, a small $Q$ leads to a large $\\omega_{Q}$ and a fast response, tightly coupling the system to the thermostat. In a multiscale simulation, $Q$ is chosen to set the thermostat's response timescale $\\tau_Q \\sim 1/\\omega_Q$ to be slower than the fastest physical motions in the system but faster than the timescale of the phenomena under investigation, effectively filtering the kinetic energy fluctuations at a desired frequency.\n\nCombining the two results into the requested matrix form provides the final answer.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{f}{2}k_{B}^{2}T^{2} & \\sqrt{\\frac{2f k_{B} T}{Q}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Moving from the physics to the algorithm, the long-term stability and accuracy of a molecular dynamics simulation depend critically on the properties of the numerical integrator. For Hamiltonian systems, integrators that are time-reversible and approximately conserve phase-space volume are highly desirable. This final practice  guides you through the formal construction of such an integrator for the Nosé-Hoover dynamics using the powerful Liouville operator formalism and symmetric Trotter splitting, revealing the mathematical architecture behind widely used simulation algorithms.",
            "id": "3788516",
            "problem": "Consider a system of $N$ particles with positions $\\mathbf{r}_i$, momenta $\\mathbf{p}_i$, masses $m_i$, and a smooth, time-independent potential energy $U(\\mathbf{r}_1,\\dots,\\mathbf{r}_N)$. The forces are $\\mathbf{F}_i(\\mathbf{r}) = -\\nabla_{\\mathbf{r}_i} U(\\mathbf{r})$. The system is coupled to a single Nosé-Hoover thermostat with variables $\\eta$ and $\\xi$ and thermostat mass $Q$, targeting temperature $T$. Let $g$ denote the number of kinetic degrees of freedom and $k_B$ the Boltzmann constant. The extended phase space dynamics is given by\n$$\n\\frac{d \\mathbf{r}_i}{dt} = \\frac{\\mathbf{p}_i}{m_i}, \\quad\n\\frac{d \\mathbf{p}_i}{dt} = \\mathbf{F}_i(\\mathbf{r}) - \\xi \\mathbf{p}_i, \\quad\n\\frac{d \\eta}{dt} = \\xi, \\quad\n\\frac{d \\xi}{dt} = \\frac{1}{Q}\\left( \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i \\cdot \\mathbf{p}_i}{m_i} - g k_B T \\right).\n$$\nLet $\\mathcal{L}$ be the Liouville operator generating this flow on observables $A(\\{\\mathbf{r}_i\\},\\{\\mathbf{p}_i\\},\\eta,\\xi)$, defined by the chain rule applied to the above equations. In Molecular Dynamics (MD), second-order accurate and reversible integrators are often constructed by symmetric Trotter (Strang) splitting of $\\mathcal{L}$ into sub-operators whose flows can be integrated exactly.\n\nStarting from first principles and the above dynamical system:\n- Define a decomposition $\\mathcal{L} = \\mathcal{L}_A + \\mathcal{L}_B + \\mathcal{L}_C$ into physically meaningful sub-operators associated with position drift, conservative force kicks, and thermostat coupling.\n- Further decompose $\\mathcal{L}_C$ into two exactly solvable sub-operators $\\mathcal{L}_{C1}$ and $\\mathcal{L}_{C2}$ that isolate, respectively, the multiplicative momentum scaling due to $\\xi$ and the $(\\eta,\\xi)$ evolution with momenta held fixed.\n- Using the symmetric Trotter (Strang) composition theorem, derive a reversible, second-order accurate propagator over a timestep $\\Delta t$ as an ordered product of exponentials of the sub-operators. Then, explicitly write the corresponding sequence of updates for $(\\mathbf{r}_i,\\mathbf{p}_i,\\eta,\\xi)$ over one timestep $\\Delta t$, ensuring that each sub-flow is integrated exactly.\n\nProvide in your final answer the single closed-form analytical expression for the symmetric Trotter propagator in terms of $\\exp(\\cdot)$ of the sub-operators. No numerical evaluation is required; your final answer must be an analytic expression only.",
            "solution": "It describes a standard and important task in computational statistical physics: the derivation of a reversible numerical integrator for the Nosé-Hoover thermostat dynamics. The provided equations of motion are correct, and the requested decomposition and application of the Trotter-Strang splitting is a canonical method for achieving this.\n\nThe evolution of any observable $A(\\{\\mathbf{r}_i\\},\\{\\mathbf{p}_i\\},\\eta,\\xi)$ is governed by the Liouville equation, $\\frac{dA}{dt} = \\mathcal{L}A$, where $\\mathcal{L}$ is the Liouville operator. Applying the chain rule and substituting the given equations of motion, we have:\n$$\n\\frac{dA}{dt} = \\sum_{i=1}^{N} \\left( \\nabla_{\\mathbf{r}_i} A \\cdot \\frac{d\\mathbf{r}_i}{dt} + \\nabla_{\\mathbf{p}_i} A \\cdot \\frac{d\\mathbf{p}_i}{dt} \\right) + \\frac{\\partial A}{\\partial \\eta} \\frac{d\\eta}{dt} + \\frac{\\partial A}{\\partial \\xi} \\frac{d\\xi}{dt}\n$$\n$$\n\\frac{dA}{dt} = \\sum_{i=1}^{N} \\left( \\nabla_{\\mathbf{r}_i} A \\cdot \\frac{\\mathbf{p}_i}{m_i} + \\nabla_{\\mathbf{p}_i} A \\cdot (\\mathbf{F}_i(\\mathbf{r}) - \\xi \\mathbf{p}_i) \\right) + \\frac{\\partial A}{\\partial \\eta} \\xi + \\frac{\\partial A}{\\partial \\xi} \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j \\cdot \\mathbf{p}_j}{m_j} - g k_B T \\right)\n$$\nFrom this, we can identify the Liouville operator $\\mathcal{L}$ as:\n$$\n\\mathcal{L} = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i}{m_i} \\cdot \\nabla_{\\mathbf{r}_i} + \\sum_{i=1}^{N} \\mathbf{F}_i(\\mathbf{r}) \\cdot \\nabla_{\\mathbf{p}_i} - \\sum_{i=1}^{N} \\xi \\mathbf{p}_i \\cdot \\nabla_{\\mathbf{p}_i} + \\xi \\frac{\\partial}{\\partial \\eta} + \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j^2}{m_j} - g k_B T \\right) \\frac{\\partial}{\\partial \\xi}\n$$\nThe formal solution to the Liouville equation over a timestep $\\Delta t$ is given by the action of the propagator, $\\exp(\\Delta t \\mathcal{L})$. Since the full operator $\\mathcal{L}$ is complex, we decompose it into simpler sub-operators whose flows can be calculated analytically.\n\nFollowing the problem's directive, we define the decomposition $\\mathcal{L} = \\mathcal{L}_A + \\mathcal{L}_B + \\mathcal{L}_C$:\n-   $\\mathcal{L}_A = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i}{m_i} \\cdot \\nabla_{\\mathbf{r}_i}$, which corresponds to the free drift of particle positions.\n-   $\\mathcal{L}_B = \\sum_{i=1}^{N} \\mathbf{F}_i(\\mathbf{r}) \\cdot \\nabla_{\\mathbf{p}_i}$, which corresponds to the update of momenta due to the conservative forces (a \"kick\").\n-   $\\mathcal{L}_C = - \\sum_{i=1}^{N} \\xi \\mathbf{p}_i \\cdot \\nabla_{\\mathbf{p}_i} + \\xi \\frac{\\partial}{\\partial \\eta} + \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j^2}{m_j} - g k_B T \\right) \\frac{\\partial}{\\partial \\xi}$, which encapsulates all terms related to the thermostat coupling.\n\nNext, we decompose the thermostat operator $\\mathcal{L}_C$ into two parts, $\\mathcal{L}_C = \\mathcal{L}_{C1} + \\mathcal{L}_{C2}$:\n-   $\\mathcal{L}_{C1} = - \\sum_{i=1}^{N} \\xi \\mathbf{p}_i \\cdot \\nabla_{\\mathbf{p}_i}$, which corresponds to the multiplicative scaling (damping/heating) of momenta by the thermostat variable $\\xi$.\n-   $\\mathcal{L}_{C2} = \\xi \\frac{\\partial}{\\partial \\eta} + G(\\mathbf{p}) \\frac{\\partial}{\\partial \\xi}$, where $G(\\mathbf{p}) = \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j^2}{m_j} - g k_B T \\right)$, corresponding to the evolution of the thermostat's own variables $(\\eta, \\xi)$.\n\nThe sub-operators $\\mathcal{L}_A$, $\\mathcal{L}_B$, $\\mathcal{L}_{C1}$, and $\\mathcal{L}_{C2}$ do not commute with each other. Therefore, $\\exp(\\Delta t \\mathcal{L}) \\neq \\exp(\\Delta t \\mathcal{L}_A) \\exp(\\Delta t \\mathcal{L}_B) \\exp(\\Delta t \\mathcal{L}_{C1}) \\exp(\\Delta t \\mathcal{L}_{C2})$. To construct a second-order accurate and reversible integrator, we employ the symmetric Trotter (or Strang) splitting theorem, which states that for operators $\\mathcal{X}$ and $\\mathcal{Y}$, $\\exp(\\tau (\\mathcal{X}+\\mathcal{Y})) = \\exp(\\frac{\\tau}{2}\\mathcal{X}) \\exp(\\tau \\mathcal{Y}) \\exp(\\frac{\\tau}{2}\\mathcal{X}) + \\mathcal{O}(\\tau^3)$.\n\nWe apply this theorem recursively. First, we split the full Liouvillian $\\mathcal{L} = (\\mathcal{L}_A + \\mathcal{L}_B) + \\mathcal{L}_C$. A common symmetric arrangement, analogous to the velocity Verlet algorithm, is to place the force/thermostat updates between two position half-steps. This suggests a primary split of the form $\\mathcal{L} = \\mathcal{L}_A + (\\mathcal{L}_B + \\mathcal{L}_C)$. Applying Strang splitting yields:\n$$\n\\exp(\\Delta t \\mathcal{L}) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\Delta t (\\mathcal{L}_B + \\mathcal{L}_C)\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right)\n$$\nWe further split the central term $\\exp(\\Delta t (\\mathcal{L}_B + \\mathcal{L}_C))$. A symmetric split separates the thermostat part from the conservative force part:\n$$\n\\exp\\left(\\Delta t (\\mathcal{L}_B + \\mathcal{L}_C)\\right) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp(\\Delta t \\mathcal{L}_C) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right)\n$$\nFinally, we split the thermostat operator $\\mathcal{L}_C = \\mathcal{L}_{C1} + \\mathcal{L}_{C2}$ as requested:\n$$\n\\exp(\\Delta t \\mathcal{L}_C) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp(\\Delta t \\mathcal{L}_{C2}) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right)\n$$\nCombining these results gives the final expression for the second-order accurate, reversible propagator:\n$$\n\\exp(\\Delta t \\mathcal{L}) \\approx \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\left[ \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp(\\Delta t \\mathcal{L}_{C2}) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\right] \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right)\n$$\nThe sequence of updates for the phase-space coordinates over one timestep $\\Delta t$ is obtained by applying these operators from right to left. Let the state at time $t$ be $(\\{\\mathbf{r}_i(t)\\}, \\{\\mathbf{p}_i(t)\\}, \\eta(t), \\xi(t))$. Each sub-flow is integrated exactly as follows:\n\n1.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_A)$**: This evolves the system under $d\\mathbf{r}_i/dt' = \\mathbf{p}_i/m_i$ for a duration $\\Delta t/2$.\n    $\\mathbf{r}_i \\leftarrow \\mathbf{r}_i(t) + \\frac{\\mathbf{p}_i(t)}{m_i} \\frac{\\Delta t}{2}$.\n\n2.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_B)$**: This evolves momenta under $d\\mathbf{p}_i/dt' = \\mathbf{F}_i(\\mathbf{r})$ for $\\Delta t/2$.\n    First, compute forces $\\mathbf{F}_i$ at the new positions.\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i(t) + \\mathbf{F}_i \\frac{\\Delta t}{2}$.\n\n3.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_{C1})$**: This evolves momenta under $d\\mathbf{p}_i/dt' = -\\xi \\mathbf{p}_i$ for $\\Delta t/2$. The exact solution is an exponential scaling.\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i \\exp\\left(-\\xi(t) \\frac{\\Delta t}{2}\\right)$.\n\n4.  **Apply $\\exp(\\Delta t \\mathcal{L}_{C2})$**: This evolves the thermostat variables $(\\eta, \\xi)$ for a full timestep $\\Delta t$, with particle momenta held constant. The equations are $d\\eta/dt' = \\xi$ and $d\\xi/dt' = G(\\mathbf{p})$, where $G(\\mathbf{p})$ is constant during this substep.\n    First, compute the thermostat \"force\": $G = \\frac{1}{Q}\\left( \\sum_{j=1}^{N} \\frac{\\mathbf{p}_j \\cdot \\mathbf{p}_j}{m_j} - g k_B T \\right)$, using the current momenta.\n    Store the current value $\\xi_{old} = \\xi$.\n    Update $\\xi$: $\\xi \\leftarrow \\xi_{old} + G \\Delta t$. Let this be $\\xi_{new}$.\n    Update $\\eta$: $\\eta \\leftarrow \\eta(t) + \\frac{1}{2}(\\xi_{old} + \\xi_{new}) \\Delta t = \\eta(t) + \\xi_{old} \\Delta t + \\frac{1}{2} G (\\Delta t)^2$.\n\n5.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_{C1})$**: This is the second half-step of the momentum scaling, now using the updated value of $\\xi$.\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i \\exp\\left(-\\xi \\frac{\\Delta t}{2}\\right)$.\n\n6.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_B)$**: This is the second half-step of the force kick. The forces $\\mathbf{F}_i$ are the same as in step 2, as positions have not changed since.\n    $\\mathbf{p}_i \\leftarrow \\mathbf{p}_i + \\mathbf{F}_i \\frac{\\Delta t}{2}$.\n\n7.  **Apply $\\exp(\\frac{\\Delta t}{2} \\mathcal{L}_A)$**: This is the final half-step of the position drift, using the fully updated momenta.\n    $\\mathbf{r}_i \\leftarrow \\mathbf{r}_i + \\frac{\\mathbf{p}_i}{m_i} \\frac{\\Delta t}{2}$.\n\nThis sequence completes the update for a single timestep $\\Delta t$. The resulting state $(\\{\\mathbf{r}_i(t+\\Delta t)\\}, \\{\\mathbf{p}_i(t+\\Delta t)\\}, \\eta(t+\\Delta t), \\xi(t+\\Delta t))$ is a second-order accurate approximation of the true dynamics, and the integrator is, by its symmetric construction, time-reversible.\nThe final answer is the symbolic representation of this propagator.",
            "answer": "$$\n\\boxed{\\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp(\\Delta t \\mathcal{L}_{C2}) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_{C1}\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_B\\right) \\exp\\left(\\frac{\\Delta t}{2} \\mathcal{L}_A\\right)}\n$$"
        }
    ]
}