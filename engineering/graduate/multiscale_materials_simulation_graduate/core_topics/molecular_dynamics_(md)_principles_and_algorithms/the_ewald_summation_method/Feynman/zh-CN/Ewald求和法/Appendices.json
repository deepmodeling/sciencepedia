{
    "hands_on_practices": [
        {
            "introduction": "计算马德隆常数是检验埃瓦尔德求和方法实现的经典练习。通过从第一性原理出发，为氯化铯、氯化钠等典型离子晶体编写计算程序，本实践旨在将抽象的理论分解为具体的实空间、倒易空间和自相互作用项的计算步骤。完成这项任务不仅能加深对埃瓦尔德求和法核心构件的理解，还能让你亲手再现凝聚态物理学中的一个基本物理量 。",
            "id": "3846353",
            "problem": "您的任务是实现一个完整的、可运行的程序，使用埃瓦尔德求和方法 (ESM) 计算几种周期性离子晶体的无量纲马德隆常数。此处的马德隆常数定义为每个化学式单位的静电能，并以基本能量标度 $q^2/a$ 进行归一化，其中 $q$ 是离子电荷的大小，$a$ 是立方晶格常数。您的推导和实现必须从库仑定律和周期性边界条件的基本原理出发，并且不得假定任何预先给定的埃瓦尔德分解快捷公式。\n\n核心目标是对一个三维周期性且电中性的晶体进行数值计算：\n- 使用短程屏蔽相互作用计算对静电能的实空间贡献，\n- 使用傅里叶空间屏蔽计算倒易空间贡献，\n- 以及由于分裂过程产生的自能修正。\n\n出发点是：\n- 点电荷的库仑定律：在无量纲形式下，两个相距为 $r$ 的电荷 $q_i$ 和 $q_j$ 之间的势为 $q_i q_j / r$。\n- 通过对所有以布拉菲晶格矢量 $\\mathbf{R}$ 为特征的晶格镜像上的相互作用求和来施加周期性边界条件，\n- 以及马德隆常数 $M$ 的定义为 $M = \\dfrac{a}{q^2} \\dfrac{E_{\\text{cell}}}{N_{\\text{pairs}}}$，其中 $E_{\\text{cell}}$ 是每个晶胞的总静电能，$N_{\\text{pairs}}$ 是每个晶胞中带相反电荷的离子对（化学式单位）的数量。本问题中所有量均为无量纲，并在介电常数因子被吸收的单位制中进行测量，因此不需要物理单位。\n\n您必须实现一个算法，该算法：\n- 使用给定的 $a$，通过立方晶格矢量 $\\mathbf{a}_1 = a \\hat{\\mathbf{x}}$, $\\mathbf{a}_2 = a \\hat{\\mathbf{y}}$, $\\mathbf{a}_3 = a \\hat{\\mathbf{z}}$ 来表示晶体，\n- 使用分数坐标基矢位置 $\\{\\mathbf{f}_j\\}$，并将其映射到笛卡尔坐标位置 $\\mathbf{r}_j = \\mathbf{L} \\mathbf{f}_j$，其中 $\\mathbf{L}$ 是以 $\\mathbf{a}_1$, $\\mathbf{a}_2$, $\\mathbf{a}_3$ 为列的 $3 \\times 3$ 矩阵，\n- 为每个基矢位置分配电荷 $\\{q_j\\}$，使得 $\\sum_j q_j = 0$（电中性），\n- 枚举实空间晶格矢量 $\\mathbf{R} = n_1 \\mathbf{a}_1 + n_2 \\mathbf{a}_2 + n_3 \\mathbf{a}_3$，其中整数 $(n_1,n_2,n_3)$ 仅限于满足 $\\|\\mathbf{R}\\| \\le r_{\\text{cut}}$ 的矢量，\n- 枚举倒易空间晶格矢量 $\\mathbf{G} = m_1 \\mathbf{b}_1 + m_2 \\mathbf{b}_2 + m_3 \\mathbf{b}_3$，其中 $\\mathbf{b}_i$ 是由 $\\mathbf{B} = 2\\pi \\mathbf{L}^{-T}$ 定义的倒易晶格矢量，整数 $(m_1,m_2,m_3)$ 仅限于满足 $\\|\\mathbf{G}\\| \\le g_{\\text{cut}}$ 且不包括 $\\mathbf{G} = \\mathbf{0}$ 的矢量，\n- 使用一个分裂参数 $\\alpha > 0$，通过互补误差函数和高斯屏蔽来分离短程和长程部分，\n- 包括分裂势的自相互作用修正项，以及\n- 得出总静电能 $E_{\\text{cell}}$，并由此计算出马德隆常数 $M$。\n\n您的程序必须实现上述过程，并为以下测试套件计算马德隆常数。所有量均为无量纲，$a$ 是立方晶格常数，电荷以 $q$ 为单位，并使用 $q=1$ 进行归一化：\n\n- 测试用例 1 (正常路径，体心基底)：\n  - 晶格常数 $a = 1$。\n  - 基矢位置 (分数坐标)：$(0,0,0)$ 带电荷 $+1$，$(\\tfrac{1}{2}, \\tfrac{1}{2}, \\tfrac{1}{2})$ 带电荷 $-1$。\n  - 分裂参数 $\\alpha = 5$。\n  - 实空间截断半径 $r_{\\text{cut}} = 6$。\n  - 倒易空间截断半径 $g_{\\text{cut}} = 20$。\n  - 这对应于氯化铯结构。\n\n- 测试用例 2 (面心立方子晶格，常规立方晶胞)：\n  - 晶格常数 $a = 1$。\n  - 基矢位置 (分数坐标)，$8$ 个位置：\n    - 氯离子子晶格 (电荷 $-1$)：$(0,0,0)$、$(0,\\tfrac{1}{2},\\tfrac{1}{2})$、$(\\tfrac{1}{2},0,\\tfrac{1}{2})$、$(\\tfrac{1}{2},\\tfrac{1}{2},0)$。\n    - 钠离子子晶格 (电荷 $+1$)：$(\\tfrac{1}{2},0,0)$、$(0,\\tfrac{1}{2},0)$、$(0,0,\\tfrac{1}{2})$、$(\\tfrac{1}{2},\\tfrac{1}{2},\\tfrac{1}{2})$。\n  - 分裂参数 $\\alpha = 6$。\n  - 实空间截断半径 $r_{\\text{cut}} = 6$。\n  - 倒易空间截断半径 $g_{\\text{cut}} = 20$。\n  - 这对应于氯化钠结构。\n\n- 测试用例 3 (闪锌矿结构，带四面体位移的面心立方)：\n  - 晶格常数 $a = 1$。\n  - 基矢位置 (分数坐标)，$8$ 个位置：\n    - 硫子晶格 (电荷 $-1$)：$(0,0,0)$、$(0,\\tfrac{1}{2},\\tfrac{1}{2})$、$(\\tfrac{1}{2},0,\\tfrac{1}{2})$、$(\\tfrac{1}{2},\\tfrac{1}{2},0)$。\n    - 锌子晶格 (电荷 $+1$)：$(\\tfrac{1}{4},\\tfrac{1}{4},\\tfrac{1}{4})$、$(\\tfrac{3}{4},\\tfrac{1}{4},\\tfrac{3}{4})$、$(\\tfrac{1}{4},\\tfrac{3}{4},\\tfrac{3}{4})$、$(\\tfrac{3}{4},\\tfrac{3}{4},\\tfrac{1}{4})$。\n  - 分裂参数 $\\alpha = 5$。\n  - 实空间截断半径 $r_{\\text{cut}} = 6$。\n  - 倒易空间截断半径 $g_{\\text{cut}} = 20$。\n\n- 测试用例 4 (使用不同分裂参数和更紧截断半径的边缘稳定性检查)：\n  - 晶格常数 $a = 1$。\n  - 基矢位置 (分数坐标)：$(0,0,0)$ 带电荷 $+1$，$(\\tfrac{1}{2}, \\tfrac{1}{2}, \\tfrac{1}{2})$ 带电荷 $-1$。\n  - 分裂参数 $\\alpha = 3$。\n  - 实空间截断半径 $r_{\\text{cut}} = 4$。\n  - 倒易空间截断半径 $g_{\\text{cut}} = 12$。\n\n您的程序应生成单行输出，其中包含四个测试用例计算出的马德隆常数，格式为方括号内以逗号分隔的列表，四舍五入到六位小数，例如：$[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$。不应打印任何其他文本。\n\n最终输出不涉及角度。由于所有量都是无量纲的，因此无需报告物理单位。您在解决方案中的推导必须从第一性原理出发，引入并论证埃瓦尔德分裂，并清晰地将推导与程序中实现的算法步骤联系起来。首次使用时请展开任何缩写词，例如埃瓦尔德求和方法 (Ewald Summation Method, ESM) 和泊松求和公式 (Poisson Summation Formula, PSF)。",
            "solution": "该问题要求计算周期性离子晶体的无量纲马德隆常数。此常数表征了晶格的静电势能。对于晶胞内基矢位置 $\\mathbf{r}_i$ 上的 $N$ 个点电荷 $q_i$ 构成的电中性周期性排列，每个晶胞的总静电能 $E_{\\text{cell}}$ 由整个晶体中所有离子对之间的相互作用总和给出。这可以表示为对参考晶胞中的原子对 $(i, j)$ 以及所有布拉菲晶格矢量 $\\mathbf{R}$ 的求和：\n$$\nE_{\\text{cell}} = \\frac{1}{2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\sideset{}{'}\\sum_{\\mathbf{R}} \\frac{q_i q_j}{|\\mathbf{r}_{ij} + \\mathbf{R}|}\n$$\n此处，$\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$ 是参考晶胞中离子 $i$ 和 $j$ 之间的分离矢量。带撇号的求和 $\\sum'$ 表示当晶格矢量 $\\mathbf{R} = \\mathbf{0}$ 时，排除 $i=j$ 的项，这可以防止电荷与自身的无限自相互作用。因子 $1/2$ 用于校正每对相互作用被重复计算的问题。本问题使用无量纲单位，其中势为 $q_i q_j/r$。\n\n直接对 $1/r$ 势求和是有问题的。该和是条件收敛的，意味着其值取决于求和的顺序。为了克服这个问题，我们采用埃瓦尔德求和方法 (Ewald Summation Method, ESM)。ESM 的中心思想是使用一个涉及互补误差函数 $\\text{erfc}(x)$ 和误差函数 $\\text{erf}(x)$ 的数学恒等式，将库仑势分裂成两部分：\n$$\n\\frac{1}{r} = \\frac{\\text{erfc}(\\alpha r)}{r} + \\frac{\\text{erf}(\\alpha r)}{r}\n$$\n参数 $\\alpha$ 控制分裂的宽度。第一项包含 $\\text{erfc}(\\alpha r)$，是一个快速衰减（类似高斯函数）的短程函数。它可以通过仅包含少数相邻晶胞来在实空间中高效求和。第二项包含 $\\text{erf}(\\alpha r)$，是一个长程、平滑的函数。其平滑性使其适合在倒易（傅里叶）空间中进行高效求和。\n\n这种分解使我们能够将总能量 $E_{\\text{cell}}$ 分裂为三个部分：实空间和 $E_{\\text{real}}$、倒易空间和 $E_{\\text{recip}}$ 以及自相互作用修正 $E_{\\text{self}}$。\n$$\nE_{\\text{cell}} = E_{\\text{real}} + E_{\\text{recip}} + E_{\\text{self}}\n$$\n\n实空间贡献 $E_{\\text{real}}$ 是通过对所有相关对的势的短程部分求和得到的：\n$$\nE_{\\text{real}} = \\frac{1}{2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\sideset{}{'}\\sum_{\\mathbf{R}} q_i q_j \\frac{\\text{erfc}(\\alpha |\\mathbf{r}_{ij} + \\mathbf{R}|)}{|\\mathbf{r}_{ij} + \\mathbf{R}|}\n$$\n由于 $\\text{erfc}(x)$ 的快速衰减，对晶格矢量 $\\mathbf{R}$ 的求和可以在所有 $|\\mathbf{R}|$ 大于选定的截断半径 $r_{\\text{cut}}$ 时被截断。该算法遍历所有基底原子对 $(i, j)$ 和截断球内的所有晶格矢量 $\\mathbf{R}$。对于每种组合，它计算距离并加上相应的能量项，同时排除 $i=j, \\mathbf{R}=\\mathbf{0}$ 的情况。\n\n倒易空间贡献 $E_{\\text{recip}}$ 处理势的长程部分。我们不直接对平滑势求和，而是将其变换到倒易空间，在那里它变得短程。这种变换通过泊松求和公式 (Poisson Summation Formula, PSF) 得到了严格的证明，该公式将一个函数在晶格上的和与其傅里叶变换在倒易晶格上的和联系起来。将 PSF 应用于长程势项，可得到能量表达式为对倒易晶格矢量 $\\mathbf{G}$ 的求和：\n$$\nE_{\\text{recip}} = \\frac{2\\pi}{V} \\sum_{\\mathbf{G} \\ne 0} \\frac{e^{-G^2 / (4\\alpha^2)}}{G^2} |S(\\mathbf{G})|^2\n$$\n此处，$V$ 是晶胞的体积，$G = |\\mathbf{G}|$，$S(\\mathbf{G})$ 是结构因子，定义为：\n$$\nS(\\mathbf{G}) = \\sum_{j=1}^{N} q_j e^{-i \\mathbf{G} \\cdot \\mathbf{r}_j}\n$$\n倒易晶格矢量由 $\\mathbf{G} = m_1 \\mathbf{b}_1 + m_2 \\mathbf{b}_2 + m_3 \\mathbf{b}_3$ 给出，其中 $m_k$ 为整数，基矢量 $\\mathbf{b}_i$ 通过 $\\mathbf{B} = 2\\pi (\\mathbf{L}^{-T})$ 从实空间晶格矢量 $\\mathbf{a}_i$ 导出，其中 $\\mathbf{L}$ 和 $\\mathbf{B}$ 分别是以 $\\mathbf{a}_i$ 和 $\\mathbf{b}_i$ 为列的矩阵。$\\mathbf{G}=\\mathbf{0}$ 项被排除，因为晶胞的整体电中性（$\\sum q_j = 0$）确保了 $S(\\mathbf{G}=\\mathbf{0})=0$。由于高斯项 $e^{-G^2 / (4\\alpha^2)}$ 的存在，倒易空间中的和收敛得很快，因此可以在超出截断半径 $g_{\\text{cut}}$ 后进行截断。该算法遍历直到此截断半径的所有倒易晶格矢量 $\\mathbf{G}$，计算结构因子模的平方 $|S(\\mathbf{G})|^2$，并将相应的项加到总和中。\n\nEwald 分裂过程通过用于推导倒易空间项的平滑高斯电荷分布，人为地引入了每个电荷与其自身的相互作用。这种非物理的自能必须被减去。这个修正项 $E_{\\text{self}}$ 是点电荷 $q_i$ 与其自身的中和高斯电荷分布产生的势相互作用的能量，并对基底中的所有原子求和。一个电荷自身的误差函数项在 $r=0$ 处的势为 $\\lim_{r\\to 0} \\frac{\\text{erf}(\\alpha r)}{r} = \\frac{2\\alpha}{\\sqrt{\\pi}}$。总修正项是对所有基底原子求和，得到：\n$$\nE_{\\text{self}} = -\\frac{1}{2} \\sum_{i=1}^{N} q_i^2 \\left( \\frac{2\\alpha}{\\sqrt{\\pi}} \\right) = - \\frac{\\alpha}{\\sqrt{\\pi}} \\sum_{i=1}^{N} q_i^2\n$$\n对于给定的晶体结构和 $\\alpha$，这是一个简单的常数项。\n\n最后，根据问题中的规定，从总能量 $E_{\\text{cell}}$ 计算无量纲马德隆常数 $M$：\n$$\nM = \\frac{a}{q^2} \\frac{E_{\\text{cell}}}{N_{\\text{pairs}}}\n$$\n其中 $a$ 是立方晶格常数，$q$ 是基本离子电荷的大小（此处 $q=1$），$N_{\\text{pairs}}$ 是计算晶胞中的化学式单位数。对于氯化铯（CsCl）结构在其原胞中，$N_{\\text{pairs}}=1$。对于氯化钠（NaCl）和硫化锌（ZnS）结构在其常规立方晶胞中，$N_{\\text{pairs}}=4$。实现将根据指定的截断半径和参数计算 $E_{\\text{real}}$、$E_{\\text{recip}}$ 和 $E_{\\text{self}}$，将它们相加得到 $E_{\\text{cell}}$，然后进行归一化以求得 $M$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import erfc\n\ndef compute_madelung(a, basis_frac, charges, alpha, rcut, gcut, N_pairs):\n    \"\"\"\n    Computes the Madelung constant for a periodic ionic crystal using the Ewald summation method.\n\n    All quantities are dimensionless as per the problem description.\n    \"\"\"\n    # Convert fractional basis positions to Cartesian coordinates\n    L_matrix = a * np.identity(3)\n    basis_cart = np.dot(np.array(basis_frac), L_matrix)\n    \n    # Unit cell volume\n    V = np.linalg.det(L_matrix)\n    \n    # Reciprocal lattice vectors basis\n    B_matrix = 2 * np.pi * np.linalg.inv(L_matrix).T\n    \n    N = len(charges)\n    q_arr = np.array(charges)\n\n    # --- 1. Real-space contribution ---\n    E_real = 0.0\n    # Determine the integer range for lattice vectors R based on rcut\n    n_max = int(np.ceil(rcut / a)) if a > 0 else 0\n    \n    for n1 in range(-n_max, n_max + 1):\n        for n2 in range(-n_max, n_max + 1):\n            for n3 in range(-n_max, n_max + 1):\n                R = np.dot([n1, n2, n3], L_matrix)\n                # Skip R vectors outside the cutoff sphere to be more efficient,\n                # although the loops are bounded by a cube that contains the sphere.\n                if np.linalg.norm(R) > rcut:\n                    continue\n\n                for i in range(N):\n                    for j in range(N):\n                        # Exclude self-interaction term for the central cell (R=0)\n                        if i == j and n1 == 0 and n2 == 0 and n3 == 0:\n                            continue\n                        \n                        r_ij = basis_cart[i] - basis_cart[j]\n                        dist_vec = r_ij + R\n                        dist = np.linalg.norm(dist_vec)\n                        \n                        if dist > 1e-9: # Avoid division by zero for overlapping atoms\n                            E_real += q_arr[i] * q_arr[j] * erfc(alpha * dist) / dist\n    \n    E_real *= 0.5\n\n    # --- 2. Reciprocal-space contribution ---\n    E_recip = 0.0\n    # Determine the integer range for reciprocal vectors G based on gcut\n    m_max = int(np.ceil(gcut * a / (2 * np.pi))) if a > 0 else 0\n    \n    for m1 in range(-m_max, m_max + 1):\n        for m2 in range(-m_max, m_max + 1):\n            for m3 in range(-m_max, m_max + 1):\n                # Exclude G=0 term\n                if m1 == 0 and m2 == 0 and m3 == 0:\n                    continue\n                \n                G = np.dot([m1, m2, m3], B_matrix)\n                G_sq = np.dot(G, G)\n\n                if np.sqrt(G_sq) > gcut:\n                    continue\n                \n                # Structure factor S(G)\n                G_dot_r = np.dot(basis_cart, G)\n                # Note: S(G) = sum(q_j * exp(-i*G.r_j)) = sum(q_j * (cos(G.r_j) - i*sin(G.r_j)))\n                # The correct formula for S(G) is sum(q_j * exp(i*G.r_j)) for energy calculation literature,\n                # but since we take the modulus squared, the sign of i does not matter.\n                S_real = np.sum(q_arr * np.cos(G_dot_r))\n                S_imag = np.sum(q_arr * np.sin(G_dot_r))\n                abs_S_G_sq = S_real**2 + S_imag**2\n\n                term = (np.exp(-G_sq / (4 * alpha**2)) / G_sq) * abs_S_G_sq\n                E_recip += term\n\n    E_recip *= (2 * np.pi / V)\n\n    # --- 3. Self-energy correction ---\n    E_self = - (alpha / np.sqrt(np.pi)) * np.sum(q_arr**2)\n\n    # --- 4. Total energy and Madelung constant ---\n    E_cell = E_real + E_recip + E_self\n    \n    # Definition from problem: M = (a/q^2) * (E_cell / N_pairs), with q=1\n    M = (a / 1.0**2) * (E_cell / N_pairs)\n    \n    return M\n\ndef solve():\n    test_cases = [\n        # Case 1: CsCl structure\n        {\n            \"a\": 1.0,\n            \"basis_frac\": [(0, 0, 0), (0.5, 0.5, 0.5)],\n            \"charges\": [1, -1],\n            \"alpha\": 5.0,\n            \"rcut\": 6.0,\n            \"gcut\": 20.0,\n            \"N_pairs\": 1\n        },\n        # Case 2: NaCl structure\n        {\n            \"a\": 1.0,\n            \"basis_frac\": [\n                (0.0, 0.0, 0.0), (0.0, 0.5, 0.5), (0.5, 0.0, 0.5), (0.5, 0.5, 0.0), # Cl-\n                (0.5, 0.0, 0.0), (0.0, 0.5, 0.0), (0.0, 0.0, 0.5), (0.5, 0.5, 0.5)  # Na+\n            ],\n            \"charges\": [-1, -1, -1, -1, 1, 1, 1, 1],\n            \"alpha\": 6.0,\n            \"rcut\": 6.0,\n            \"gcut\": 20.0,\n            \"N_pairs\": 4\n        },\n        # Case 3: Zincblende (ZnS) structure\n        {\n            \"a\": 1.0,\n            \"basis_frac\": [\n                (0.0, 0.0, 0.0), (0.0, 0.5, 0.5), (0.5, 0.0, 0.5), (0.5, 0.5, 0.0), # S\n                (0.25, 0.25, 0.25), (0.75, 0.25, 0.75), (0.25, 0.75, 0.75), (0.75, 0.75, 0.25) # Zn\n            ],\n            \"charges\": [-1, -1, -1, -1, 1, 1, 1, 1],\n            \"alpha\": 5.0,\n            \"rcut\": 6.0,\n            \"gcut\": 20.0,\n            \"N_pairs\": 4\n        },\n        # Case 4: CsCl with different parameters\n        {\n            \"a\": 1.0,\n            \"basis_frac\": [(0, 0, 0), (0.5, 0.5, 0.5)],\n            \"charges\": [1, -1],\n            \"alpha\": 3.0,\n            \"rcut\": 4.0,\n            \"gcut\": 12.0,\n            \"N_pairs\": 1\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_madelung(\n            a=case[\"a\"],\n            basis_frac=case[\"basis_frac\"],\n            charges=case[\"charges\"],\n            alpha=case[\"alpha\"],\n            rcut=case[\"rcut\"],\n            gcut=case[\"gcut\"],\n            N_pairs=case[\"N_pairs\"]\n        )\n        results.append(f\"{result:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在科学计算中，编写代码只是第一步，确保其准确性与可靠性至关重要。本实践引导你设计一套验证协议，系统性地测试埃瓦尔德求和实现的正确性，包括能量如何随截断参数收敛，以及计算结果是否依赖于人为设定的分裂参数 $\\alpha$。此外，它还通过平移不变性检验来验证代码是否符合周期性系统的基本物理对称性，这是建立对数值工具信心的关键一步 。",
            "id": "3846371",
            "problem": "您的任务是设计、实现并验证一个数值程序，用于使用埃瓦尔德求和方法计算三维 ($3$D) 立方周期性晶胞中一组点电荷在**真空**中的静电相互作用能。重点在于验证和收敛性测试。\n\n标准的埃瓦尔德求和方法计算出的能量对应于系统被完美导体包围的“锡箔”边界条件。要获得系统在真空中的能量（假设宏观形状为球形），必须额外加上一个表面偶极修正项。您的程序必须实现包含此修正的完整求和。\n\n您的程序必须测试：\n1. 随着截断参数 $r_{\\mathrm{cut}}$ 和 $n_{\\mathrm{max}}$ 的增加，能量应收敛到一个稳定值。\n2. 在完全收敛的极限下，总能量必须与任意的埃瓦尔德分裂参数 $\\alpha$ 无关。\n3. 计算出的能量必须在所有电荷的均匀平移下保持不变，这是周期性系统的一个基本物理要求。\n\n所有量均为无量纲，并以约化单位表示，其中基本电荷大小和介电常数被归一化，使得能量成为无量纲量。立方晶胞边长为 $L = 1$。\n\n需实现的验证和收敛性测试协议：\n1. 使用两种 ($2$) 电中性的点电荷构型：\n   - 构型 A：$q = [ +1, -1 ]$，位于位置 $\\mathbf{r} = \\{ (0,0,0), (0.5,0,0) \\} \\times L$。\n   - 构型 B：$q = [ +1, +1, -2 ]$，位于位置 $\\mathbf{r} = \\{ (0,0,0), (0.25,0.25,0.25), (0.5,0.5,0.5) \\} \\times L$。\n2. 对每种构型，使用以下参数通过埃瓦尔德方法计算一个高精度的参考能量 $E_{\\mathrm{ref}}$：$\\alpha_{\\mathrm{ref}} = 5.0$，$r_{\\mathrm{cut,ref}} = 4.0$，$n_{\\mathrm{max,ref}} = 30$。\n3. 定义以下测试用例。每个测试用例指定 $(\\text{config}, \\alpha, r_{\\mathrm{cut}}, n_{\\mathrm{max}})$：\n   - 测试 $1$：$(\\text{A}, 5.0, 1.5, 8)$。\n   - 测试 $2$：$(\\text{A}, 5.0, 3.0, 15)$。\n   - 测试 $3$：$(\\text{A}, 2.0, 4.0, 20)$。\n   - 测试 $4$：$(\\text{A}, 8.0, 1.2, 25)$。\n   - 测试 $5$：$(\\text{B}, 5.0, 2.0, 12)$。\n   - 测试 $6$：$(\\text{B}, 5.0, 3.5, 20)$。\n4. 对于每个测试用例 $k$，计算能量 $E_k$ 并报告相对于相同构型参考值的绝对相对误差：\n   $$\\varepsilon_k = \\frac{|E_k - E_{\\mathrm{ref}}|}{\\max(|E_{\\mathrm{ref}}|, 10^{-12})}.$$\n5. 此外，在构型 A 上使用参考参数实现一个平移不变性检查（测试 $7$）。将所有位置平移 $\\Delta \\mathbf{r} = (0.1, 0.2, 0.3) \\times L$ 并应用周期性包裹使其回到盒子内。使用相同的参数计算原始参考能量 $E_{\\mathrm{ref}}$ 和平移后的能量 $E_{\\mathrm{shift}}$，然后报告绝对差：\n   $$\\delta = |E_{\\mathrm{shift}} - E_{\\mathrm{ref}}|.$$\n\n您的程序必须生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，条目排序为 $[\\varepsilon_1, \\varepsilon_2, \\varepsilon_3, \\varepsilon_4, \\varepsilon_5, \\varepsilon_6, \\delta]$。不得打印任何额外文本。\n\n所有计算必须严格使用无量纲的约化单位。角度（如果内部出现，例如在复指数中）以弧度为单位。最终输出为实值浮点数。",
            "solution": "为了计算周期性排列的点电荷在真空中的静电能，我们使用埃瓦尔德方法。标准的埃瓦尔德和（实空间项、倒易空间项和自能修正项）实际上计算的是系统被一个完美导体（“锡箔”）包围时的能量。为了得到系统在真空中的能量（假设其宏观形状为球体），必须加上一个额外的表面项 $U_{\\text{surface}}$，它解释了系统总偶极矩与宏观边界相互作用产生的能量。因此，在真空边界条件下，总静电能 $U$ 是四个分量的和：\n$$U = U_{\\text{real}} + U_{\\text{reciprocal}} + U_{\\text{self}} + U_{\\text{surface}}$$\n\n每一项都源于对势能的系统性重写。核心思想是使用互补误差函数 $\\mathrm{erfc}(x)$ 和误差函数 $\\mathrm{erf}(x)$ 以及一个任意的分裂参数 $\\alpha$ 将反比距离势 $1/r$ 分裂为一个短程分量和一个长程分量：\n$$ \\frac{1}{r} = \\frac{\\mathrm{erfc}(\\alpha r)}{r} + \\frac{\\mathrm{erf}(\\alpha r)}{r} $$\n\n$\\mathrm{erfc}(\\alpha r)/r$ 项在实空间中迅速衰减，适合于直接的截断求和。$\\mathrm{erf}(\\alpha r)/r$ 项是平滑且缓慢衰减的，使其非常适合转换为在倒易（傅里叶）空间中的快速收敛和。\n\n**1. 实空间能量 ($U_{\\text{real}}$)**\n\n此项对应于短程相互作用。它是通过对每个电荷 $q_i$ 与截断半径 $r_{\\mathrm{cut}}$ 内的所有其他电荷 $q_j$（包括它们的周期性镜像）的相互作用求和来计算的。该求和包括主晶胞内的电荷对以及涉及周期性镜像的电荷对。求和符号上的撇号表示当晶格矢量 $\\mathbf{n}$ 为零时，排除 $i=j$ 的项。\n\n$$ U_{\\text{real}} = \\frac{1}{2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\sideset{}{'}\\sum_{\\mathbf{n}} \\frac{q_i q_j \\mathrm{erfc}(\\alpha|\\mathbf{r}_{ij} + \\mathbf{n}|)}{|\\mathbf{r}_{ij} + \\mathbf{n}|} $$\n此处，$\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$ 是中心晶胞中电荷 $i$ 和 $j$ 之间的矢量，$\\mathbf{n} = (n_x L, n_y L, n_z L)$ 是一个晶格平移矢量，其中 $n_x, n_y, n_z$ 为整数。算法实现涉及遍历所有粒子对 $(i,j)$ 和所有晶格矢量 $\\mathbf{n}$，使得距离 $|\\mathbf{r}_{ij}+\\mathbf{n}|$ 在实空间截断半径 $r_{\\mathrm{cut}}$ 之内。\n\n**2. 倒易空间能量 ($U_{\\text{reciprocal}}$)**\n\n此项解释了相互作用的长程部分。缓慢变化的势能分量被展开为关于倒易晶格矢量 $\\mathbf{k} = \\frac{2\\pi}{L}(n_x, n_y, n_z)$ 的傅里叶级数。所得的和收敛迅速。\n\n$$ U_{\\text{reciprocal}} = \\frac{1}{2V} \\sum_{\\mathbf{k} \\neq \\mathbf{0}} \\frac{4\\pi}{k^2} e^{-k^2/(4\\alpha^2)} |S(\\mathbf{k})|^2 $$\n其中 $k=|\\mathbf{k}|$，$S(\\mathbf{k})$ 是结构因子：\n$$ S(\\mathbf{k}) = \\sum_{j=1}^{N} q_j e^{i\\mathbf{k} \\cdot \\mathbf{r}_j} $$\n$|S(\\mathbf{k})|^2$ 是结构因子的模的平方。求和排除了 $\\mathbf{k}=\\mathbf{0}$ 项，对于电荷中性系统（$\\sum q_i = 0$），该项为零。该求和通过仅包括其整数索引 $(n_x, n_y, n_z)$ 满足 $\\sqrt{n_x^2 + n_y^2 + n_z^2} \\le n_{\\mathrm{max}}$ 的倒易矢量来进行截断。\n\n**3. 自相互作用校正 ($U_{\\text{self}}$)**\n\n埃瓦尔德分裂过程引入了每个粒子与其自身电荷分布（用于推导分裂的高斯电荷云）的非物理相互作用。必须减去这个自能。对于每个电荷 $q_i$，此校正为 $-\\alpha q_i^2 / \\sqrt{\\pi}$。\n\n$$ U_{\\text{self}} = -\\frac{\\alpha}{\\sqrt{\\pi}} \\sum_{i=1}^{N} q_i^2 $$\n\n**4. 表面能 ($U_{\\text{surface}}$)**\n\n埃瓦尔德求和的值取决于在无穷远处假定的宏观介电边界条件。对于被真空包围的系统（$\\epsilon'=1$），需要增加一个与模拟晶胞总偶极矩 $\\mathbf{M} = \\sum_i q_i \\mathbf{r}_i$ 相关的项。对于球形宏观边界，此项为：\n\n$$ U_{\\text{surface}} = \\frac{2\\pi}{3V} |\\mathbf{M}|^2 = \\frac{2\\pi}{3V} \\left| \\sum_{i=1}^{N} q_i \\mathbf{r}_i \\right|^2 $$\n\n**算法设计与验证**\n\n程序将实现一个函数，通过对这四个贡献求和来计算总能量 $U$。参数 $\\alpha$ 控制着实空间求和（对于较大的 $\\alpha$ 收敛更快）与倒易空间求和（对于较小的 $\\alpha$ 收敛更快）之间的计算量平衡。验证协议测试了计算出的能量随着截断参数 $r_{\\mathrm{cut}}$ 和 $n_{\\mathrm{max}}$ 增加时的收敛性，并确认了其在收敛极限下与 $\\alpha$ 的无关性。此外，它还验证了一个基本的物理性质：周期性系统的总能量必须在所有粒子均匀平移下保持不变，这是任何有效实现的必要条件。程序将执行指定的测试用例，计算规定的误差度量 $\\varepsilon_k$ 和 $\\delta$，并报告结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy import special\n\ndef solve():\n    \"\"\"\n    Main function to run the Ewald summation tests as specified in the problem.\n    \"\"\"\n\n    def ewald_energy(q, r, L, alpha, r_cut, n_max):\n        \"\"\"\n        Calculates the Ewald electrostatic energy for a set of point charges in vacuum.\n\n        Args:\n            q (np.ndarray): Array of charges of shape (N,).\n            r (np.ndarray): Array of positions of shape (N, 3).\n            L (float): Side length of the cubic simulation box.\n            alpha (float): Ewald splitting parameter.\n            r_cut (float): Cutoff radius for the real-space sum.\n            n_max (int): Integer cutoff for the reciprocal-space sum.\n\n        Returns:\n            float: The total Ewald energy.\n        \"\"\"\n        N = len(q)\n        V = L**3\n\n        # Real-space term\n        E_real = 0.0\n        n_real_max_int = int(np.ceil(r_cut / L))\n        for i in range(N):\n            for j in range(N):\n                rij = r[i] - r[j]\n                for nx in range(-n_real_max_int, n_real_max_int + 1):\n                    for ny in range(-n_real_max_int, n_real_max_int + 1):\n                        for nz in range(-n_real_max_int, n_real_max_int + 1):\n                            if i == j and nx == 0 and ny == 0 and nz == 0:\n                                continue\n                            \n                            n_vec = np.array([nx, ny, nz]) * L\n                            dist_vec = rij + n_vec\n                            dist = np.linalg.norm(dist_vec)\n                            \n                            if dist > r_cut:\n                                continue\n\n                            if dist > 1e-9:\n                                E_real += q[i] * q[j] * special.erfc(alpha * dist) / dist\n        E_real *= 0.5\n\n        # Reciprocal-space term\n        E_recip = 0.0\n        for nx in range(-n_max, n_max + 1):\n            for ny in range(-n_max, n_max + 1):\n                for nz in range(-n_max, n_max + 1):\n                    if nx == 0 and ny == 0 and nz == 0:\n                        continue\n                    \n                    n_sq = nx**2 + ny**2 + nz**2\n                    if n_sq > n_max**2:\n                        continue\n                        \n                    k_vec = (2.0 * np.pi / L) * np.array([nx, ny, nz])\n                    k_sq = np.dot(k_vec, k_vec)\n\n                    k_dot_r = np.dot(r, k_vec)\n                    S_k_real = np.sum(q * np.cos(k_dot_r))\n                    S_k_imag = np.sum(q * np.sin(k_dot_r))\n                    S_k_sq = S_k_real**2 + S_k_imag**2\n\n                    term = np.exp(-k_sq / (4.0 * alpha**2)) / k_sq\n                    E_recip += term * S_k_sq\n        \n        E_recip *= 2.0 * np.pi / V\n\n        # Self-interaction correction\n        E_self = - (alpha / np.sqrt(np.pi)) * np.sum(q**2)\n\n        # Surface (dipole) term for vacuum (spherical) boundary conditions\n        M_vec = np.sum(q[:, np.newaxis] * r, axis=0)\n        M_sq = np.dot(M_vec, M_vec)\n        E_surface = (2.0 * np.pi / (3.0 * V)) * M_sq\n        \n        return E_real + E_recip + E_self + E_surface\n\n    # --- Problem Setup ---\n    L = 1.0 # Box side length\n    \n    # Configuration A\n    q_A = np.array([1.0, -1.0])\n    r_A = np.array([[0.0, 0.0, 0.0], [0.5, 0.0, 0.0]]) * L\n\n    # Configuration B\n    q_B = np.array([1.0, 1.0, -2.0])\n    r_B = np.array([[0.0, 0.0, 0.0], [0.25, 0.25, 0.25], [0.5, 0.5, 0.5]]) * L\n\n    # Reference parameters\n    alpha_ref = 5.0\n    rcut_ref = 4.0\n    nmax_ref = 30\n\n    # Calculate reference energies\n    E_ref_A = ewald_energy(q_A, r_A, L, alpha_ref, rcut_ref, nmax_ref)\n    E_ref_B = ewald_energy(q_B, r_B, L, alpha_ref, rcut_ref, nmax_ref)\n\n    # Test cases\n    test_cases = [\n        ('A', 5.0, 1.5, 8),   # Test 1\n        ('A', 5.0, 3.0, 15),  # Test 2\n        ('A', 2.0, 4.0, 20),  # Test 3\n        ('A', 8.0, 1.2, 25),  # Test 4\n        ('B', 5.0, 2.0, 12),  # Test 5\n        ('B', 5.0, 3.5, 20),  # Test 6\n    ]\n\n    results = []\n    \n    # --- Execute Test Cases 1-6 ---\n    for i, (config_id, alpha, r_cut, n_max) in enumerate(test_cases):\n        if config_id == 'A':\n            q, r, E_ref = q_A, r_A, E_ref_A\n        else: # config_id == 'B'\n            q, r, E_ref = q_B, r_B, E_ref_B\n        \n        E_k = ewald_energy(q, r, L, alpha, r_cut, n_max)\n        \n        error_denom = max(abs(E_ref), 1e-12)\n        eps_k = abs(E_k - E_ref) / error_denom\n        results.append(eps_k)\n\n    # --- Execute Test Case 7: Translation Invariance ---\n    delta_r = np.array([0.1, 0.2, 0.3]) * L\n    r_A_shifted = (r_A + delta_r) % L\n    \n    E_shift = ewald_energy(q_A, r_A_shifted, L, alpha_ref, rcut_ref, nmax_ref)\n    \n    delta = abs(E_shift - E_ref_A)\n    results.append(delta)\n\n    # --- Final Output ---\n    print(f\"[{','.join(f'{res:.12e}' for res in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "标准的埃瓦尔德求和方法默认采用“锡箔”边界条件，这在物理上等同于将周期性系统置于一个完美的导体包围之中。本实践挑战你思考这一隐含假设，并推导当宏观边界变为真空时，由系统净偶极矩产生的能量校正项。通过将微观模拟与宏观电介质理论联系起来，你将更深刻地理解有限尺寸效应对模拟结果的影响，这对于精确的多尺度建模至关重要 。",
            "id": "3846365",
            "problem": "一个三维周期性系统在传导（锡箔）边界条件下，使用 Ewald 求和方法进行模拟。立方模拟晶胞的边长为 $L$，体积为 $V = L^{3}$，其中包含两个点电荷 $q_{1} = +e$ 和 $q_{2} = -e$，分别位于 $\\mathbf{r}_{1} = (d/2, 0, 0)$ 和 $\\mathbf{r}_{2} = (-d/2, 0, 0)$。这里 $e$ 是元电荷，$d$ 是一个分离参数，且 $d \\ll L$。净电荷为零，但该构型具有非零的总偶极矩 $\\mathbf{M} = \\sum_{i} q_{i} \\mathbf{r}_{i}$。\n\n在多尺度材料模拟中，通过 Ewald 求和计算的长程静电能是条件收敛的，并且依赖于宏观边界条件和样品的形状。在传导边界条件下，省略了 $k=\\mathbf{0}$ 的贡献，这对应于忽略了与样品净偶极矩相关的宏观退极化场。在真空中且具有球形宏观边界的情况下，这种省略会导致对静电能产生一个有限尺寸、依赖于形状的修正。\n\n从包含库仑定律（$\\mathbf{E}(\\mathbf{r}) = \\frac{1}{4\\pi \\varepsilon_{0}} \\int \\rho(\\mathbf{r}') \\frac{\\mathbf{r}-\\mathbf{r}'}{|\\mathbf{r}-\\mathbf{r}'|^{3}} \\,\\mathrm{d}^{3}\\mathbf{r}'$）、泊松方程（$\\nabla^{2} \\phi = -\\rho/\\varepsilon_{0}$）和均匀极化体的宏观静电学（极化强度 $\\mathbf{P} = \\mathbf{M}/V$ 以及椭球体内部由退极化张量 $\\mathbf{N}$ 表征的退极化场）的静电学基本原理出发，推导当用真空和球形边界替换传导边界条件时，对 Ewald 能量产生的依赖于形状的修正项的形式。用 $\\varepsilon_{0}$、$V$ 和 $\\mathbf{M}$ 表示该修正项。\n\n然后，对于上述双电荷构型的具体情况，对边长 $L = 3.00 \\times 10^{-9}\\,\\mathrm{m}$、间距 $d = 6.00 \\times 10^{-10}\\,\\mathrm{m}$ 的立方晶胞，数值计算此修正项。使用常数 $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$，$\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}$，以及阿伏伽德罗常数 $N_{\\mathrm{A}} = 6.02214076 \\times 10^{23}\\,\\mathrm{mol}^{-1}$。将该修正项视为每个模拟晶胞的能量，并通过乘以 $N_{\\mathrm{A}}$ 将其转换为每摩尔的能量。\n\n将最终答案四舍五入至四位有效数字，并以 $\\mathrm{kJ/mol}$ 为单位表示。最终答案必须是一个实数。",
            "solution": "该问题要求推导当假定的宏观边界条件从传导（“锡箔”）变为具有球形的真空时，对通过 Ewald 求和方法计算的静电能的修正项。此修正仅在每个模拟晶胞具有非零净偶极矩 $\\mathbf{M}$ 的系统中出现。\n\n**第一部分：能量修正的推导**\n在 Ewald 求和中，计算的是模拟晶胞周期性晶格的静电能。标准实现方式，特别是对于电中性系统，会省略倒易空间求和中的 $\\mathbf{k}=\\mathbf{0}$ 项。此过程等同于假设无限周期性晶格被零电势的完美导体包围。在这些“锡箔”边界条件下，样品中没有宏观电场，来自宏观样品形状的能量贡献为零。\n\n当宏观样品被真空包围时，非零的偶极矩密度或极化强度 $\\mathbf{P} = \\mathbf{M}/V$ 会在样品内部产生一个宏观电场，称为退极化场 $\\mathbf{E}_{\\text{dep}}$。与此场相关的能量即为必须加到锡箔 Ewald 能量上的修正项。\n\n在均匀极化的椭球形物体内部，退极化场是均匀的，由下式给出：\n$$\n\\mathbf{E}_{\\text{dep}} = -\\frac{\\mathbf{N} \\cdot \\mathbf{P}}{\\varepsilon_{0}}\n$$\n其中 $\\mathbf{N}$ 是退极化张量，它取决于宏观物体的形状。对于球体，即本问题指定的形状，退极化张量是各向同性的：\n$$\n\\mathbf{N} = \\frac{1}{3}\\mathbf{I}\n$$\n其中 $\\mathbf{I}$ 是单位张量。因此，对于球形边界，退极化场为：\n$$\n\\mathbf{E}_{\\text{dep}} = -\\frac{\\mathbf{P}}{3\\varepsilon_{0}}\n$$\n这个极化体的静电自能，即储存在退极化场中的能量，就是所需的修正项 $\\Delta U$。这个能量是建立极化强度 $\\mathbf{P}$ 以对抗其自身产生的场 $\\mathbf{E}_{\\text{dep}}$ 所做的功。能量密度为 $u = -\\frac{1}{2}\\mathbf{P} \\cdot \\mathbf{E}_{\\text{dep}}$。对模拟晶胞的体积 $V$（它代表宏观物体的一个单元）进行积分，得到总的修正能量：\n$$\n\\Delta U = \\int_{V} \\left(-\\frac{1}{2}\\mathbf{P} \\cdot \\mathbf{E}_{\\text{dep}}\\right) dV'\n$$\n由于 $\\mathbf{P}$ 和 $\\mathbf{E}_{\\text{dep}}$ 在样品内部都是均匀的，因此上式可简化为：\n$$\n\\Delta U = -\\frac{V}{2} \\mathbf{P} \\cdot \\mathbf{E}_{\\text{dep}}\n$$\n代入 $\\mathbf{E}_{\\text{dep}}$ 和 $\\mathbf{P}$ 的表达式：\n$$\n\\Delta U = -\\frac{V}{2} \\left(\\frac{\\mathbf{M}}{V}\\right) \\cdot \\left(-\\frac{\\mathbf{M}/V}{3\\varepsilon_{0}}\\right) = \\frac{V}{2} \\frac{|\\mathbf{M}|^2}{3\\varepsilon_{0}V^2}\n$$\n简化后得到能量修正的最终表达式：\n$$\n\\Delta U = \\frac{|\\mathbf{M}|^2}{6\\varepsilon_{0}V}\n$$\n这是需要加到标准 Ewald 能量上，以获得在真空中具有球形宏观边界的周期性系统的能量。\n\n**第二部分：数值计算**\n首先，我们计算给定电荷构型的偶极矩 $\\mathbf{M}$。\n电荷为 $q_{1} = +e$ 位于 $\\mathbf{r}_{1} = (d/2, 0, 0)$，$q_{2} = -e$ 位于 $\\mathbf{r}_{2} = (-d/2, 0, 0)$。\n$$\n\\mathbf{M} = q_{1}\\mathbf{r}_{1} + q_{2}\\mathbf{r}_{2} = (+e)\\begin{pmatrix} d/2 \\\\ 0 \\\\ 0 \\end{pmatrix} + (-e)\\begin{pmatrix} -d/2 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} ed/2 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} ed/2 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} ed \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n偶极矩的大小为 $|\\mathbf{M}| = ed$。其大小的平方为 $|\\mathbf{M}|^2 = (ed)^2$。\n立方晶胞的体积为 $V = L^3$。\n将此代入我们推导出的修正公式：\n$$\n\\Delta U = \\frac{(ed)^2}{6\\varepsilon_{0}L^3}\n$$\n现在，我们代入给定的数值：\n- $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\n- $d = 6.00 \\times 10^{-10}\\,\\mathrm{m}$\n- $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}$\n- $L = 3.00 \\times 10^{-9}\\,\\mathrm{m}$\n\n我们来计算各项：\n$|\\mathbf{M}| = ed = (1.602176634 \\times 10^{-19}\\,\\mathrm{C}) \\times (6.00 \\times 10^{-10}\\,\\mathrm{m}) = 9.613059804 \\times 10^{-29}\\,\\mathrm{C \\cdot m}$\n$|\\mathbf{M}|^2 = (9.613059804 \\times 10^{-29}\\,\\mathrm{C \\cdot m})^2 = 9.24109310 \\times 10^{-57}\\,\\mathrm{C^2 \\cdot m^2}$\n$V = L^3 = (3.00 \\times 10^{-9}\\,\\mathrm{m})^3 = 2.70 \\times 10^{-26}\\,\\mathrm{m^3}$\n\n现在，我们以焦耳为单位计算每个模拟晶胞的能量修正项：\n$$\n\\Delta U = \\frac{9.24109310 \\times 10^{-57}\\,\\mathrm{C^2 \\cdot m^2}}{6 \\times (8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}) \\times (2.70 \\times 10^{-26}\\,\\mathrm{m^3})}\n$$\n$$\n\\Delta U = \\frac{9.24109310 \\times 10^{-57}}{1.43419842 \\times 10^{-36}}\\,\\mathrm{J} = 6.4433150 \\times 10^{-21}\\,\\mathrm{J}\n$$\n这是每个模拟晶胞的修正量。问题要求以 $\\mathrm{kJ/mol}$ 为单位的摩尔能量。我们乘以阿伏伽德罗常数 $N_{\\mathrm{A}}$ 并进行单位换算。\n$$\n\\Delta U_{\\text{molar}} = \\Delta U \\times N_{\\mathrm{A}} = (6.4433150 \\times 10^{-21}\\,\\mathrm{J}) \\times (6.02214076 \\times 10^{23}\\,\\mathrm{mol}^{-1})\n$$\n$$\n\\Delta U_{\\text{molar}} = 3880.303\\,\\mathrm{J/mol}\n$$\n转换为千焦耳每摩尔：\n$$\n\\Delta U_{\\text{molar}} = 3.880303\\,\\mathrm{kJ/mol}\n$$\n最后，我们按要求将结果四舍五入至四位有效数字。\n$$\n\\Delta U_{\\text{molar}} \\approx 3.880\\,\\mathrm{kJ/mol}\n$$",
            "answer": "$$\n\\boxed{3.880}\n$$"
        }
    ]
}