{
    "hands_on_practices": [
        {
            "introduction": "The most effective way to master the Ewald summation method is to construct it from its fundamental components. This exercise guides you through the process of writing a program to compute the Madelung constant, a key measure of electrostatic cohesion in ionic crystals. By implementing the real-space, reciprocal-space, and self-energy terms yourself, you will gain a deep, practical understanding of the mathematical decomposition that makes the Ewald sum both powerful and efficient.",
            "id": "3846353",
            "problem": "You are tasked to implement a complete, runnable program that computes the dimensionless Madelung constant for several periodic ionic crystals using the Ewald summation method (ESM). The Madelung constant is defined here as the electrostatic energy per formula unit normalized by the elementary energy scale $q^2/a$, where $q$ is the magnitude of the ionic charge and $a$ is the cubic lattice constant. Your derivation and implementation must begin from the fundamental base of Coulomb's law and periodic boundary conditions, and must not assume pre-given shortcut formulas for the Ewald decomposition.\n\nThe core objective is to numerically evaluate, for a three-dimensional periodic and charge-neutral crystal:\n- the real-space contribution to the electrostatic energy using a short-ranged screened interaction,\n- the reciprocal-space contribution using Fourier-space screening,\n- and the self-energy correction due to the splitting procedure.\n\nThe starting points are:\n- Coulomb's law for point charges: the potential between two charges $q_i$ and $q_j$ separated by distance $r$ is $q_i q_j / r$ in dimensionless form,\n- the imposition of periodic boundary conditions by summing interactions over all lattice images characterized by Bravais lattice vectors $\\mathbf{R}$,\n- and the definition of the Madelung constant $M$ as $M = \\dfrac{a}{q^2} \\dfrac{E_{\\text{cell}}}{N_{\\text{pairs}}}$, where $E_{\\text{cell}}$ is the total electrostatic energy per unit cell and $N_{\\text{pairs}}$ is the number of oppositely charged ion pairs (formula units) per unit cell. All quantities in this problem are dimensionless and measured in units where the permittivity factor is absorbed, so no physical units are required.\n\nYou must implement an algorithm that:\n- represents the crystal by cubic lattice vectors $\\mathbf{a}_1 = a \\hat{\\mathbf{x}}$, $\\mathbf{a}_2 = a \\hat{\\mathbf{y}}$, $\\mathbf{a}_3 = a \\hat{\\mathbf{z}}$, with $a$ given,\n- uses fractional basis positions $\\{\\mathbf{f}_j\\}$ mapped to Cartesian positions $\\mathbf{r}_j = \\mathbf{L} \\mathbf{f}_j$, where $\\mathbf{L}$ is the $3 \\times 3$ matrix whose columns are $\\mathbf{a}_1$, $\\mathbf{a}_2$, $\\mathbf{a}_3$,\n- assigns charges $\\{q_j\\}$ to each basis site such that $\\sum_j q_j = 0$ (charge neutrality),\n- enumerates real-space lattice vectors $\\mathbf{R} = n_1 \\mathbf{a}_1 + n_2 \\mathbf{a}_2 + n_3 \\mathbf{a}_3$ with integer $(n_1,n_2,n_3)$ restricted to those with $\\|\\mathbf{R}\\| \\le r_{\\text{cut}}$,\n- enumerates reciprocal-space lattice vectors $\\mathbf{G} = m_1 \\mathbf{b}_1 + m_2 \\mathbf{b}_2 + m_3 \\mathbf{b}_3$, where $\\mathbf{b}_i$ are the reciprocal lattice vectors defined by $\\mathbf{B} = 2\\pi \\mathbf{L}^{-T}$, with integer $(m_1,m_2,m_3)$ restricted to those with $\\|\\mathbf{G}\\| \\le g_{\\text{cut}}$ and excluding $\\mathbf{G} = \\mathbf{0}$,\n- uses a splitting parameter $\\alpha > 0$ to separate short- and long-range parts via complementary error functions and Gaussian screening,\n- includes the self-interaction correction term for the split potential, and\n- yields the total electrostatic energy $E_{\\text{cell}}$ from which the Madelung constant $M$ is computed.\n\nYour program must implement the above procedure and compute the Madelung constants for the following test suite. All quantities are dimensionless, $a$ is the cubic lattice constant, and charges are in units of $q$ with $q = 1$ used for normalization:\n\n- Test case $1$ (happy path, body-centered basis): \n  - Lattice constant $a = 1$.\n  - Basis positions (fractional): $(0,0,0)$ with charge $+1$, $(\\frac{1}{2}, \\frac{1}{2}, \\frac{1}{2})$ with charge $-1$.\n  - Splitting parameter $\\alpha = 5$.\n  - Real-space cutoff $r_{\\text{cut}} = 6$.\n  - Reciprocal-space cutoff $g_{\\text{cut}} = 20$.\n  - This corresponds to the cesium chloride structure.\n\n- Test case $2$ (face-centered cubic sublattices, conventional cubic cell):\n  - Lattice constant $a = 1$.\n  - Basis positions (fractional), $8$ sites:\n    - Chloride sublattice (charge $-1$): $(0,0,0)$, $(0,\\frac{1}{2},\\frac{1}{2})$, $(\\frac{1}{2},0,\\frac{1}{2})$, $(\\frac{1}{2},\\frac{1}{2},0)$.\n    - Sodium sublattice (charge $+1$): $(\\frac{1}{2},0,0)$, $(0,\\frac{1}{2},0)$, $(0,0,\\frac{1}{2})$, $(\\frac{1}{2},\\frac{1}{2},\\frac{1}{2})$.\n  - Splitting parameter $\\alpha = 6$.\n  - Real-space cutoff $r_{\\text{cut}} = 6$.\n  - Reciprocal-space cutoff $g_{\\text{cut}} = 20$.\n  - This corresponds to the sodium chloride structure.\n\n- Test case $3$ (zincblende structure, face-centered cubic with tetrahedral shift):\n  - Lattice constant $a = 1$.\n  - Basis positions (fractional), $8$ sites:\n    - Sulfur sublattice (charge $-1$): $(0,0,0)$, $(0,\\frac{1}{2},\\frac{1}{2})$, $(\\frac{1}{2},0,\\frac{1}{2})$, $(\\frac{1}{2},\\frac{1}{2},0)$.\n    - Zinc sublattice (charge $+1$): $(\\frac{1}{4},\\frac{1}{4},\\frac{1}{4})$, $(\\frac{3}{4},\\frac{1}{4},\\frac{3}{4})$, $(\\frac{1}{4},\\frac{3}{4},\\frac{3}{4})$, $(\\frac{3}{4},\\frac{3}{4},\\frac{1}{4})$.\n  - Splitting parameter $\\alpha = 5$.\n  - Real-space cutoff $r_{\\text{cut}} = 6$.\n  - Reciprocal-space cutoff $g_{\\text{cut}} = 20$.\n\n- Test case $4$ (edge stability check with different splitting and tighter cutoffs):\n  - Lattice constant $a = 1$.\n  - Basis positions (fractional): $(0,0,0)$ with charge $+1$, $(\\frac{1}{2}, \\frac{1}{2}, \\frac{1}{2})$ with charge $-1$.\n  - Splitting parameter $\\alpha = 3$.\n  - Real-space cutoff $r_{\\text{cut}} = 4$.\n  - Reciprocal-space cutoff $g_{\\text{cut}} = 12$.\n\nYour program should produce a single line of output containing the computed Madelung constants for the four test cases as a comma-separated list enclosed in square brackets, rounded to six decimal places, for example: $[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$. No other text should be printed.\n\nAngles are not involved in the final output. There are no physical units to report since all quantities are dimensionless. Your derivation in the solution must introduce and justify the Ewald splitting using first principles and clearly connect the derivation to the algorithmic steps implemented in the program. Expand any acronyms upon first use, such as the Ewald Summation Method (ESM) and the Poisson Summation Formula (PSF).",
            "solution": "The problem requires the computation of the dimensionless Madelung constant for periodic ionic crystals. This constant characterizes the electrostatic-potential energy of the crystal lattice. The total electrostatic energy per unit cell, $E_{\\text{cell}}$, for a charge-neutral periodic arrangement of $N$ point charges $q_i$ at basis positions $\\mathbf{r}_i$ within the cell is given by the sum of interactions between all pairs of ions in the entire crystal. This can be expressed as a sum over atom pairs $(i, j)$ in the reference unit cell and all Bravais lattice vectors $\\mathbf{R}$:\n$$\nE_{\\text{cell}} = \\frac{1}{2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\sideset{}{'}\\sum_{\\mathbf{R}} \\frac{q_i q_j}{|\\mathbf{r}_{ij} + \\mathbf{R}|}\n$$\nHere, $\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$ is the vector separating ions $i$ and $j$ in the reference cell. The primed summation $\\sum'$ indicates that the term for $i=j$ is excluded when the lattice vector $\\mathbf{R} = \\mathbf{0}$, which prevents the infinite self-interaction of a charge with itself. The factor of $1/2$ corrects for double-counting each pair interaction. The problem uses dimensionless units where the potential is $q_i q_j/r$.\n\nDirectly summing the $1/r$ potential is problematic. The sum is conditionally convergent, meaning its value depends on the order of summation. To overcome this, the Ewald Summation Method (ESM) is employed. The central idea of ESM is to split the Coulomb potential into two parts using a mathematical identity involving the complementary error function, $\\text{erfc}(x)$, and the error function, $\\text{erf}(x)$:\n$$\n\\frac{1}{r} = \\frac{\\text{erfc}(\\alpha r)}{r} + \\frac{\\text{erf}(\\alpha r)}{r}\n$$\nThe parameter $\\alpha$ controls the width of the split. The first term, containing $\\text{erfc}(\\alpha r)$, is a short-ranged function that decays rapidly (like a Gaussian). It can be summed efficiently in real space by including only a few neighboring cells. The second term, containing $\\text{erf}(\\alpha r)$, is a long-ranged, smooth function. Its smoothness makes it suitable for an efficient summation in reciprocal (Fourier) space.\n\nThis decomposition allows us to split the total energy $E_{\\text{cell}}$ into three components: a real-space sum $E_{\\text{real}}$, a reciprocal-space sum $E_{\\text{recip}}$, and a self-interaction correction $E_{\\text{self}}$.\n$$\nE_{\\text{cell}} = E_{\\text{real}} + E_{\\text{recip}} + E_{\\text{self}}\n$$\n\nThe real-space contribution, $E_{\\text{real}}$, is obtained by summing the short-range part of the potential over all relevant pairs:\n$$\nE_{\\text{real}} = \\frac{1}{2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\sideset{}{'}\\sum_{\\mathbf{R}} q_i q_j \\frac{\\text{erfc}(\\alpha |\\mathbf{r}_{ij} + \\mathbf{R}|)}{|\\mathbf{r}_{ij} + \\mathbf{R}|}\n$$\nDue to the rapid decay of $\\text{erfc}(x)$, the summation over lattice vectors $\\mathbf{R}$ can be truncated for all $|\\mathbf{R}|$ greater than a chosen cutoff radius, $r_{\\text{cut}}$. The algorithm iterates through all pairs of basis atoms $(i, j)$ and all lattice vectors $\\mathbf{R}$ within the cutoff sphere. For each combination, it calculates the distance and adds the corresponding energy term, excluding the $i=j, \\mathbf{R}=\\mathbf{0}$ case.\n\nThe reciprocal-space contribution, $E_{\\text{recip}}$, handles the long-range part of the potential. Instead of summing the smooth potential directly, we transform it to reciprocal space, where it becomes short-ranged. This transformation is rigorously justified using the Poisson Summation Formula (PSF), which relates a sum of a function over a lattice to a sum of its Fourier transform over the reciprocal lattice. Applying the PSF to the long-range potential term yields the energy expression as a sum over reciprocal lattice vectors $\\mathbf{G}$:\n$$\nE_{\\text{recip}} = \\frac{2\\pi}{V} \\sum_{\\mathbf{G} \\ne 0} \\frac{e^{-G^2 / (4\\alpha^2)}}{G^2} |S(\\mathbf{G})|^2\n$$\nHere, $V$ is the volume of the unit cell, $G = |\\mathbf{G}|$, and $S(\\mathbf{G})$ is the structure factor, defined as:\n$$\nS(\\mathbf{G}) = \\sum_{j=1}^{N} q_j e^{-i \\mathbf{G} \\cdot \\mathbf{r}_j}\n$$\nThe reciprocal lattice vectors are given by $\\mathbf{G} = m_1 \\mathbf{b}_1 + m_2 \\mathbf{b}_2 + m_3 \\mathbf{b}_3$ for integers $m_k$, where the basis vectors $\\mathbf{b}_i$ are derived from the real-space lattice vectors $\\mathbf{a}_i$ via $\\mathbf{B} = 2\\pi (\\mathbf{L}^{-T})$, with $\\mathbf{L}$ and $\\mathbf{B}$ being matrices whose columns are $\\mathbf{a}_i$ and $\\mathbf{b}_i$ respectively. The $\\mathbf{G}=\\mathbf{0}$ term is excluded because the overall charge neutrality of the unit cell ($\\sum q_j = 0$) ensures that $S(\\mathbf{G}=\\mathbf{0})=0$. The sum in reciprocal space converges quickly because of the Gaussian term $e^{-G^2 / (4\\alpha^2)}$, so it can be truncated beyond a cutoff $g_{\\text{cut}}$. The algorithm iterates through reciprocal lattice vectors $\\mathbf{G}$ up to this cutoff, computes the squared magnitude of the structure factor $|S(\\mathbf{G})|^2$, and adds the corresponding term to the sum.\n\nThe Ewald splitting procedure artificially introduces an interaction of each charge with itself via the smooth Gaussian charge distribution used to derive the reciprocal-space term. This unphysical self-energy must be subtracted. This correction term, $E_{\\text{self}}$, is the energy of a point charge $q_i$ interacting with the potential generated by its own neutralizing Gaussian charge distribution, summed over all atoms in the basis. The potential at $r=0$ of a charge's own error-function term is $\\lim_{r\\to 0} \\frac{\\text{erf}(\\alpha r)}{r} = \\frac{2\\alpha}{\\sqrt{\\pi}}$. The total correction sums this over all basis atoms, leading to:\n$$\nE_{\\text{self}} = -\\frac{1}{2} \\sum_{i=1}^{N} q_i^2 \\left( \\frac{2\\alpha}{\\sqrt{\\pi}} \\right) = - \\frac{\\alpha}{\\sqrt{\\pi}} \\sum_{i=1}^{N} q_i^2\n$$\nThis is a simple constant term for a given crystal structure and $\\alpha$.\n\nFinally, the dimensionless Madelung constant $M$ is calculated from the total energy $E_{\\text{cell}}$ as specified in the problem:\n$$\nM = \\frac{a}{q^2} \\frac{E_{\\text{cell}}}{N_{\\text{pairs}}}\n$$\nwhere $a$ is the cubic lattice constant, $q$ is the magnitude of the elementary ionic charge (here, $q=1$), and $N_{\\text{pairs}}$ is the number of formula units in the computational unit cell. For the CsCl structure in its primitive cell, $N_{\\text{pairs}}=1$. For the NaCl and ZnS structures in their conventional cubic cells, $N_{\\text{pairs}}=4$. The implementation will calculate $E_{\\text{real}}$, $E_{\\text{recip}}$, and $E_{\\text{self}}$ based on the specified cutoffs and parameters, sum them to get $E_{\\text{cell}}$, and then normalize to find $M$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import erfc\n\ndef compute_madelung(a, basis_frac, charges, alpha, rcut, gcut, N_pairs):\n    \"\"\"\n    Computes the Madelung constant for a periodic ionic crystal using the Ewald summation method.\n\n    All quantities are dimensionless as per the problem description.\n    \"\"\"\n    # Convert fractional basis positions to Cartesian coordinates\n    L_matrix = a * np.identity(3)\n    basis_cart = np.dot(np.array(basis_frac), L_matrix)\n    \n    # Unit cell volume\n    V = np.linalg.det(L_matrix)\n    \n    # Reciprocal lattice vectors basis\n    B_matrix = 2 * np.pi * np.linalg.inv(L_matrix).T\n    \n    N = len(charges)\n    q_arr = np.array(charges)\n\n    # --- 1. Real-space contribution ---\n    E_real = 0.0\n    # Determine the integer range for lattice vectors R based on rcut\n    n_max = int(np.ceil(rcut / a)) if a > 0 else 0\n    \n    for n1 in range(-n_max, n_max + 1):\n        for n2 in range(-n_max, n_max + 1):\n            for n3 in range(-n_max, n_max + 1):\n                R = np.dot([n1, n2, n3], L_matrix)\n                # Skip R vectors outside the cutoff sphere to be more efficient,\n                # although the loops are bounded by a cube that contains the sphere.\n                if np.linalg.norm(R) > rcut:\n                    continue\n\n                for i in range(N):\n                    for j in range(N):\n                        # Exclude self-interaction term for the central cell (R=0)\n                        if i == j and n1 == 0 and n2 == 0 and n3 == 0:\n                            continue\n                        \n                        r_ij = basis_cart[i] - basis_cart[j]\n                        dist_vec = r_ij + R\n                        dist = np.linalg.norm(dist_vec)\n                        \n                        if dist > 1e-9: # Avoid division by zero for overlapping atoms\n                            E_real += q_arr[i] * q_arr[j] * erfc(alpha * dist) / dist\n    \n    E_real *= 0.5\n\n    # --- 2. Reciprocal-space contribution ---\n    E_recip = 0.0\n    # Determine the integer range for reciprocal vectors G based on gcut\n    m_max = int(np.ceil(gcut * a / (2 * np.pi))) if a > 0 else 0\n    \n    for m1 in range(-m_max, m_max + 1):\n        for m2 in range(-m_max, m_max + 1):\n            for m3 in range(-m_max, m_max + 1):\n                # Exclude G=0 term\n                if m1 == 0 and m2 == 0 and m3 == 0:\n                    continue\n                \n                G = np.dot([m1, m2, m3], B_matrix)\n                G_sq = np.dot(G, G)\n\n                if np.sqrt(G_sq) > gcut:\n                    continue\n                \n                # Structure factor S(G)\n                G_dot_r = np.dot(basis_cart, G)\n                # S(G) = sum(q_j * exp(-i*G.r_j)) = sum(q_j * (cos(G.r_j) - i*sin(G.r_j)))\n                # |S(G)|^2 = (Re[S])^2 + (Im[S])^2 = (sum q_j cos(...))^2 + (-sum q_j sin(...))^2\n                S_real = np.sum(q_arr * np.cos(G_dot_r))\n                S_imag = np.sum(q_arr * np.sin(G_dot_r)) # This is -Im[S(G)]\n                abs_S_G_sq = S_real**2 + S_imag**2\n\n                term = (np.exp(-G_sq / (4 * alpha**2)) / G_sq) * abs_S_G_sq\n                E_recip += term\n\n    E_recip *= (2 * np.pi / V)\n\n    # --- 3. Self-energy correction ---\n    E_self = - (alpha / np.sqrt(np.pi)) * np.sum(q_arr**2)\n\n    # --- 4. Total energy and Madelung constant ---\n    E_cell = E_real + E_recip + E_self\n    \n    # Definition from problem: M = (a/q^2) * (E_cell / N_pairs), with q=1\n    M = (a / 1.0**2) * (E_cell / N_pairs)\n    \n    return M\n\ndef solve():\n    test_cases = [\n        # Case 1: CsCl structure\n        {\n            \"a\": 1.0,\n            \"basis_frac\": [(0, 0, 0), (0.5, 0.5, 0.5)],\n            \"charges\": [1, -1],\n            \"alpha\": 5.0,\n            \"rcut\": 6.0,\n            \"gcut\": 20.0,\n            \"N_pairs\": 1\n        },\n        # Case 2: NaCl structure\n        {\n            \"a\": 1.0,\n            \"basis_frac\": [\n                (0.0, 0.0, 0.0), (0.0, 0.5, 0.5), (0.5, 0.0, 0.5), (0.5, 0.5, 0.0), # Cl-\n                (0.5, 0.0, 0.0), (0.0, 0.5, 0.0), (0.0, 0.0, 0.5), (0.5, 0.5, 0.5)  # Na+\n            ],\n            \"charges\": [-1, -1, -1, -1, 1, 1, 1, 1],\n            \"alpha\": 6.0,\n            \"rcut\": 6.0,\n            \"gcut\": 20.0,\n            \"N_pairs\": 4\n        },\n        # Case 3: Zincblende (ZnS) structure\n        {\n            \"a\": 1.0,\n            \"basis_frac\": [\n                (0.0, 0.0, 0.0), (0.0, 0.5, 0.5), (0.5, 0.0, 0.5), (0.5, 0.5, 0.0), # S\n                (0.25, 0.25, 0.25), (0.75, 0.25, 0.75), (0.25, 0.75, 0.75), (0.75, 0.75, 0.25) # Zn\n            ],\n            \"charges\": [-1, -1, -1, -1, 1, 1, 1, 1],\n            \"alpha\": 5.0,\n            \"rcut\": 6.0,\n            \"gcut\": 20.0,\n            \"N_pairs\": 4\n        },\n        # Case 4: CsCl with different parameters\n        {\n            \"a\": 1.0,\n            \"basis_frac\": [(0, 0, 0), (0.5, 0.5, 0.5)],\n            \"charges\": [1, -1],\n            \"alpha\": 3.0,\n            \"rcut\": 4.0,\n            \"gcut\": 12.0,\n            \"N_pairs\": 1\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_madelung(\n            a=case[\"a\"],\n            basis_frac=case[\"basis_frac\"],\n            charges=case[\"charges\"],\n            alpha=case[\"alpha\"],\n            rcut=case[\"rcut\"],\n            gcut=case[\"gcut\"],\n            N_pairs=case[\"N_pairs\"]\n        )\n        results.append(f\"{result:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A correct implementation is only the first step; ensuring its results are reliable is paramount for scientific research. This practice focuses on the critical validation techniques required for any Ewald summation code. You will test for convergence with respect to the key parameters—the splitting parameter $\\alpha$ and the real- and reciprocal-space cutoffs—and verify that the total energy satisfies translational invariance, a fundamental physical property of periodic systems.",
            "id": "3846371",
            "problem": "You are tasked with designing, implementing, and validating a numerical program for computing the electrostatic interaction energy of a set of point charges in a three-dimensional cubic periodic cell using the Ewald summation method. The focus is on validation and convergence testing, not on reproducing a known closed-form result. Your program must test whether systematic changes to the truncation parameters produce convergent energies, and whether the computed energy is invariant under a uniform translation of all charges, as required by physical periodicity.\n\nStart from the following fundamental base:\n- The electrostatic interaction energy of point charges obeys Coulomb's law, and direct summation in a periodic crystal is conditionally convergent. Rigorous evaluation requires a mathematically valid resummation, such as the Ewald splitting into short-range real-space and long-range reciprocal-space partial sums, plus the physically required self-interaction correction under conducting boundary conditions.\n- Standard definitions include a cubic cell of side length $L$, point charges $q_i$ at positions $\\mathbf{r}_i$ with overall charge neutrality $\\sum_i q_i = 0$, and periodic boundary conditions that identify $\\mathbf{r}$ with $\\mathbf{r} + n_x L \\hat{\\mathbf{x}} + n_y L \\hat{\\mathbf{y}} + n_z L \\hat{\\mathbf{z}}$ for all integers $n_x, n_y, n_z$.\n\nYour program must implement a correct, physically consistent Ewald summation under conducting boundary conditions (also called tinfoil boundary), ensuring:\n- A real-space partial sum truncated by a finite radius $r_{\\mathrm{cut}}$.\n- A reciprocal-space partial sum truncated by a spherical index cutoff $n_{\\mathrm{max}}$ in integer reciprocal lattice index space.\n- The appropriate self-interaction correction for each point charge.\n- The total energy must be independent of the arbitrary Ewald splitting parameter $\\alpha$ in the limit of complete convergence. With finite truncations, the energy should approach a stable value as $r_{\\mathrm{cut}}$ and $n_{\\mathrm{max}}$ increase.\n\nAll quantities are dimensionless and expressed in reduced units, where the elementary charge magnitude and permittivity are normalized so that energy is dimensionless. The cubic cell side length is $L = 1$.\n\nValidation and convergence testing protocol to implement:\n1. Use two neutral configurations of point charges:\n   - Configuration A: $q = [ +1, -1 ]$ at positions $\\mathbf{r} = \\{ (0,0,0), (0.5,0,0) \\} \\times L$.\n   - Configuration B: $q = [ +1, +1, -2 ]$ at positions $\\mathbf{r} = \\{ (0,0,0), (0.25,0.25,0.25), (0.5,0.5,0.5) \\} \\times L$.\n2. For each configuration, compute a high-accuracy reference energy $E_{\\mathrm{ref}}$ using the Ewald method with the following parameters: $\\alpha_{\\mathrm{ref}} = 5.0$, $r_{\\mathrm{cut,ref}} = 4.0$, $n_{\\mathrm{max,ref}} = 30$.\n3. Define the following test cases. Each test case specifies $(\\text{config}, \\alpha, r_{\\mathrm{cut}}, n_{\\mathrm{max}})$:\n   - Test $1$: $(\\text{A}, 5.0, 1.5, 8)$.\n   - Test $2$: $(\\text{A}, 5.0, 3.0, 15)$.\n   - Test $3$: $(\\text{A}, 2.0, 4.0, 20)$.\n   - Test $4$: $(\\text{A}, 8.0, 1.2, 25)$.\n   - Test $5$: $(\\text{B}, 5.0, 2.0, 12)$.\n   - Test $6$: $(\\text{B}, 5.0, 3.5, 20)$.\n4. For each test case $k$, compute the energy $E_k$ and report the absolute relative error with respect to the reference for the same configuration:\n   $$\\varepsilon_k = \\frac{|E_k - E_{\\mathrm{ref}}|}{\\max(|E_{\\mathrm{ref}}|, 10^{-12})}.$$\n5. Additionally, implement a translation invariance check (Test $7$) on Configuration A using the reference parameters. Translate all positions by $\\Delta \\mathbf{r} = (0.1, 0.2, 0.3) \\times L$ and apply periodic wrapping back into the box. Compute the original reference energy $E_{\\mathrm{ref}}$ and the translated energy $E_{\\mathrm{shift}}$ with the same parameters, then report the absolute difference:\n   $$\\delta = |E_{\\mathrm{shift}} - E_{\\mathrm{ref}}|.$$\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with entries ordered as $[\\varepsilon_1, \\varepsilon_2, \\varepsilon_3, \\varepsilon_4, \\varepsilon_5, \\varepsilon_6, \\delta]$. No additional text may be printed.\n\nAll computations must be strictly in dimensionless reduced units. Angles, if any appear internally (e.g., in complex exponentials), are in radians. The final outputs are real-valued floats. The design must test both convergence behavior under changes in $\\alpha$, $r_{\\mathrm{cut}}$, and $n_{\\mathrm{max}}$, and physical invariance under uniform translation in a periodic cell.",
            "solution": "The problem requires the implementation of the Ewald summation method to calculate the electrostatic energy of a periodic arrangement of point charges under conducting boundary conditions. The direct summation of Coulomb's law, $U = \\frac{1}{2} \\sum_{i \\neq j} \\frac{q_i q_j}{r_{ij}}$, is conditionally convergent for a three-dimensional periodic lattice, meaning the result depends on the order of summation. The Ewald method provides a robust mathematical technique to compute this energy unambiguously by splitting the sum into two rapidly converging series and adding a necessary correction term. For the conducting (\"tin-foil\") boundary conditions specified in the problem, the total electrostatic energy $U$ is expressed as the sum of three components:\n$$U = U_{\\text{real}} + U_{\\text{reciprocal}} + U_{\\text{self}}$$\n\nThe core idea is to split the inverse distance potential, $1/r$, into a short-range and a long-range component using the complementary error function, $\\mathrm{erfc}(x)$, and the error function, $\\mathrm{erf}(x)$, with an arbitrary splitting parameter $\\alpha$:\n$$ \\frac{1}{r} = \\frac{\\mathrm{erfc}(\\alpha r)}{r} + \\frac{\\mathrm{erf}(\\alpha r)}{r} $$\n\nThe $\\mathrm{erfc}(\\alpha r)/r$ term decays rapidly in real space, suitable for a direct, truncated summation. The $\\mathrm{erf}(\\alpha r)/r$ term is smooth and decays slowly, making it ideal for transformation into a rapidly converging sum in reciprocal (Fourier) space.\n\n**1. Real-Space Energy ($U_{\\text{real}}$)**\n\nThis term corresponds to the short-range interactions. It is calculated by summing the interactions of each charge $q_i$ with all other charges $q_j$ (including their periodic images) within a cutoff radius $r_{\\mathrm{cut}}$. The sum includes pairs within the primary cell and pairs involving periodic images. The prime on the summation indicates that the $i=j$ term is excluded when the lattice vector $\\mathbf{n}$ is zero.\n\n$$ U_{\\text{real}} = \\frac{1}{2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\sideset{}{'}\\sum_{\\mathbf{n}} \\frac{q_i q_j \\mathrm{erfc}(\\alpha|\\mathbf{r}_{ij} + \\mathbf{n}|)}{|\\mathbf{r}_{ij} + \\mathbf{n}|} $$\nHere, $\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$ is the vector between charges $i$ and $j$ in the central cell, and $\\mathbf{n} = (n_x L, n_y L, n_z L)$ is a lattice translation vector for integers $n_x, n_y, n_z$. The algorithmic implementation involves iterating over all particle pairs $(i,j)$ and all lattice vectors $\\mathbf{n}$ such that the distance $|\\mathbf{r}_{ij}+\\mathbf{n}|$ is within the real-space cutoff $r_{\\mathrm{cut}}$.\n\n**2. Reciprocal-Space Energy ($U_{\\text{reciprocal}}$)**\n\nThis term accounts for the long-range part of the interaction. The slowly varying potential component is expanded as a Fourier series over the reciprocal lattice vectors $\\mathbf{k} = \\frac{2\\pi}{L}(n_x, n_y, n_z)$. The resulting sum converges quickly.\n\n$$ U_{\\text{reciprocal}} = \\frac{1}{2V} \\sum_{\\mathbf{k} \\neq \\mathbf{0}} \\frac{4\\pi}{k^2} e^{-k^2/(4\\alpha^2)} |S(\\mathbf{k})|^2 $$\nwhere $V=L^3$, $k=|\\mathbf{k}|$, and $S(\\mathbf{k})$ is the structure factor:\n$$ S(\\mathbf{k}) = \\sum_{j=1}^{N} q_j e^{-i\\mathbf{k} \\cdot \\mathbf{r}_j} $$\n$|S(\\mathbf{k})|^2$ is the squared magnitude of the structure factor. The sum excludes the $\\mathbf{k}=\\mathbf{0}$ term, which corresponds to the interaction with the average potential. For a charge-neutral system ($\\sum q_i = 0$), the structure factor $S(\\mathbf{k}=\\mathbf{0})$ is zero, and this term vanishes. The sum is truncated by including only reciprocal vectors $\\mathbf{k}$ whose integer indices $(n_x, n_y, n_z)$ satisfy $\\sqrt{n_x^2 + n_y^2 + n_z^2} \\le n_{\\mathrm{max}}$.\n\n**3. Self-Interaction Correction ($U_{\\text{self}}$)**\n\nThe Ewald splitting procedure introduces an unphysical interaction of each particle with its own charge distribution (a Gaussian charge cloud used to derive the split). This self-energy must be subtracted. For each charge $q_i$, this correction is $-\\alpha q_i^2 / \\sqrt{\\pi}$.\n\n$$ U_{\\text{self}} = -\\frac{\\alpha}{\\sqrt{\\pi}} \\sum_{i=1}^{N} q_i^2 $$\n\n**Algorithmic Design and Validation**\n\nThe program will implement a function to compute the total energy $U$ by summing these three contributions. The parameter $\\alpha$ controls the balance of work between the real-space sum (which converges faster for larger $\\alpha$) and the reciprocal-space sum (which converges faster for smaller $\\alpha$). The validation protocol tests the convergence of the computed energy as the truncation parameters $r_{\\mathrm{cut}}$ and $n_{\\mathrm{max}}$ are increased, and confirms its independence from $\\alpha$ in the convergent limit. Furthermore, it verifies a fundamental physical property: the total energy of a periodic system must be invariant under a uniform translation of all particles, a requirement for any valid implementation. The program will execute the specified test cases, calculate the prescribed error metrics $\\varepsilon_k$ and $\\delta$, and report the results.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import special\n\ndef solve():\n    \"\"\"\n    Main function to run the Ewald summation tests as specified in the problem.\n    \"\"\"\n\n    def ewald_energy(q, r, L, alpha, r_cut, n_max):\n        \"\"\"\n        Calculates the Ewald electrostatic energy for a set of point charges\n        under conducting boundary conditions.\n\n        Args:\n            q (np.ndarray): Array of charges of shape (N,).\n            r (np.ndarray): Array of positions of shape (N, 3).\n            L (float): Side length of the cubic simulation box.\n            alpha (float): Ewald splitting parameter.\n            r_cut (float): Cutoff radius for the real-space sum.\n            n_max (int): Integer cutoff for the reciprocal-space sum.\n\n        Returns:\n            float: The total Ewald energy.\n        \"\"\"\n        N = len(q)\n        V = L**3\n\n        # Real-space term\n        E_real = 0.0\n        n_real_max_int = int(np.ceil(r_cut / L))\n        for i in range(N):\n            for j in range(N):\n                rij = r[i] - r[j]\n                for nx in range(-n_real_max_int, n_real_max_int + 1):\n                    for ny in range(-n_real_max_int, n_real_max_int + 1):\n                        for nz in range(-n_real_max_int, n_real_max_int + 1):\n                            if i == j and nx == 0 and ny == 0 and nz == 0:\n                                continue\n                            \n                            n_vec = np.array([nx, ny, nz]) * L\n                            dist_vec = rij + n_vec\n                            dist = np.linalg.norm(dist_vec)\n                            \n                            if dist = r_cut:\n                                E_real += q[i] * q[j] * special.erfc(alpha * dist) / dist\n        E_real *= 0.5\n\n        # Reciprocal-space term\n        E_recip = 0.0\n        for nx in range(-n_max, n_max + 1):\n            for ny in range(-n_max, n_max + 1):\n                for nz in range(-n_max, n_max + 1):\n                    if nx == 0 and ny == 0 and nz == 0:\n                        continue\n                    \n                    n_sq = nx**2 + ny**2 + nz**2\n                    if n_sq > n_max**2:\n                        continue\n                        \n                    k_vec = (2.0 * np.pi / L) * np.array([nx, ny, nz])\n                    k_sq = np.dot(k_vec, k_vec)\n\n                    k_dot_r = np.dot(r, k_vec)\n                    S_k_real = np.sum(q * np.cos(k_dot_r))\n                    S_k_imag = np.sum(q * np.sin(k_dot_r))\n                    S_k_sq = S_k_real**2 + S_k_imag**2\n\n                    term = np.exp(-k_sq / (4.0 * alpha**2)) / k_sq\n                    E_recip += term * S_k_sq\n        \n        E_recip *= 2.0 * np.pi / V\n\n        # Self-interaction correction\n        E_self = - (alpha / np.sqrt(np.pi)) * np.sum(q**2)\n        \n        return E_real + E_recip + E_self\n\n    # --- Problem Setup ---\n    L = 1.0 # Box side length\n    \n    # Configuration A\n    q_A = np.array([1.0, -1.0])\n    r_A = np.array([[0.0, 0.0, 0.0], [0.5, 0.0, 0.0]]) * L\n\n    # Configuration B\n    q_B = np.array([1.0, 1.0, -2.0])\n    r_B = np.array([[0.0, 0.0, 0.0], [0.25, 0.25, 0.25], [0.5, 0.5, 0.5]]) * L\n\n    # Reference parameters\n    alpha_ref = 5.0\n    rcut_ref = 4.0\n    nmax_ref = 30\n\n    # Calculate reference energies\n    E_ref_A = ewald_energy(q_A, r_A, L, alpha_ref, rcut_ref, nmax_ref)\n    E_ref_B = ewald_energy(q_B, r_B, L, alpha_ref, rcut_ref, nmax_ref)\n\n    # Test cases\n    test_cases = [\n        ('A', 5.0, 1.5, 8),   # Test 1\n        ('A', 5.0, 3.0, 15),  # Test 2\n        ('A', 2.0, 4.0, 20),  # Test 3\n        ('A', 8.0, 1.2, 25),  # Test 4\n        ('B', 5.0, 2.0, 12),  # Test 5\n        ('B', 5.0, 3.5, 20),  # Test 6\n    ]\n\n    results = []\n    \n    # --- Execute Test Cases 1-6 ---\n    for i, (config_id, alpha, r_cut, n_max) in enumerate(test_cases):\n        if config_id == 'A':\n            q, r, E_ref = q_A, r_A, E_ref_A\n        else: # config_id == 'B'\n            q, r, E_ref = q_B, r_B, E_ref_B\n        \n        E_k = ewald_energy(q, r, L, alpha, r_cut, n_max)\n        \n        error_denom = max(abs(E_ref), 1e-12)\n        eps_k = abs(E_k - E_ref) / error_denom\n        results.append(eps_k)\n\n    # --- Execute Test Case 7: Translation Invariance ---\n    delta_r = np.array([0.1, 0.2, 0.3]) * L\n    r_A_shifted = (r_A + delta_r) % L\n    \n    E_shift = ewald_energy(q_A, r_A_shifted, L, alpha_ref, rcut_ref, nmax_ref)\n    \n    delta = abs(E_shift - E_ref_A)\n    results.append(delta)\n\n    # --- Final Output ---\n    print(f\"[{','.join(f'{res:.12e}' for res in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The Ewald method elegantly bridges the microscopic and macroscopic scales, but this connection requires careful attention to boundary conditions. This advanced practice explores the energy correction needed when simulating systems with a net dipole moment, accounting for the shape of the macroscopic sample in a vacuum. By deriving the correction from the principles of macroscopic electrostatics, you will learn how the assumed boundary conditions can influence simulation results, a crucial concept for the accurate modeling of polar and interfacial systems.",
            "id": "3846365",
            "problem": "A three-dimensional periodic system is simulated using the Ewald summation method under conducting (tin-foil) boundary conditions. The cubic simulation cell has side length $L$ and volume $V = L^{3}$, and contains two point charges $q_{1} = +e$ and $q_{2} = -e$ located at $\\mathbf{r}_{1} = (d/2, 0, 0)$ and $\\mathbf{r}_{2} = (-d/2, 0, 0)$, respectively, where $e$ is the elementary charge and $d$ is a separation parameter with $d \\ll L$. The net charge is zero, but the configuration has a nonzero total dipole moment $\\mathbf{M} = \\sum_{i} q_{i} \\mathbf{r}_{i}$.\n\nIn multiscale materials simulation, the long-range electrostatic energy evaluated by Ewald summation is conditionally convergent and depends on the macroscopic boundary condition and the shape of the sample. Under conducting boundary conditions, a $\\mathbf{k}=\\mathbf{0}$ contribution is omitted, which corresponds to neglecting the macroscopic depolarization field associated with the sample’s net dipole moment. In vacuum with a spherical macroscopic boundary, this omission leads to a finite-size, shape-dependent correction to the electrostatic energy.\n\nStarting from the electrostatic fundamental base comprising Coulomb’s law ($\\mathbf{E}(\\mathbf{r}) = \\frac{1}{4\\pi \\varepsilon_{0}} \\int \\rho(\\mathbf{r}') \\frac{\\mathbf{r}-\\mathbf{r}'}{|\\mathbf{r}-\\mathbf{r}'|^{3}} \\,\\mathrm{d}^{3}\\mathbf{r}'$), Poisson’s equation ($\\nabla^{2} \\phi = -\\rho/\\varepsilon_{0}$), and macroscopic electrostatics of uniformly polarized bodies (polarization $\\mathbf{P} = \\mathbf{M}/V$ and depolarization field inside an ellipsoid characterized by the depolarization tensor $\\mathbf{N}$), derive the form of the shape-dependent correction to the Ewald energy that arises when replacing conducting boundary conditions by vacuum with a spherical boundary. Express the correction in terms of $\\varepsilon_{0}$, $V$, and $\\mathbf{M}$.\n\nThen, for the specific case of the two-charge configuration above, evaluate this correction numerically for a cubic cell with $L = 3.00 \\times 10^{-9}\\,\\mathrm{m}$ and $d = 6.00 \\times 10^{-10}\\,\\mathrm{m}$. Use the constants $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$, $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}$, and Avogadro’s constant $N_{\\mathrm{A}} = 6.02214076 \\times 10^{23}\\,\\mathrm{mol}^{-1}$. Treat the correction as an energy per simulation cell and convert it to an energy per mole by multiplying by $N_{\\mathrm{A}}$.\n\nRound your final answer to four significant figures and express it in $\\mathrm{kJ/mol}$. The final answer must be a single real number.",
            "solution": "The problem requires the derivation of a correction to the electrostatic energy calculated via the Ewald summation method when the assumed macroscopic boundary condition is changed from conducting (\"tin-foil\") to vacuum with a spherical shape. This correction arises only for systems with a non-zero net dipole moment per simulation cell, $\\mathbf{M}$.\n\n**Part 1: Derivation of the Energy Correction**\nIn Ewald summation, the electrostatic energy of a periodic lattice of simulation cells is calculated. The standard implementation, particularly for a charge-neutral system, omits the $\\mathbf{k}=\\mathbf{0}$ term of the reciprocal space sum. This procedure is equivalent to assuming the infinite periodic lattice is surrounded by a perfect conductor at zero potential. Under these \"tin-foil\" boundary conditions, there is no macroscopic electric field across the sample, and the energy contribution from the macroscopic sample's shape is zero.\n\nWhen the macroscopic sample is instead surrounded by vacuum, a non-zero dipole moment density, or polarization $\\mathbf{P} = \\mathbf{M}/V$, creates a macroscopic electric field within the sample, known as the depolarization field, $\\mathbf{E}_{\\text{dep}}$. The energy associated with this field represents the correction that must be added to the tin-foil Ewald energy.\n\nThe depolarization field inside a uniformly polarized body of ellipsoidal shape is uniform and given by:\n$$\n\\mathbf{E}_{\\text{dep}} = -\\frac{\\mathbf{N} \\cdot \\mathbf{P}}{\\varepsilon_{0}}\n$$\nwhere $\\mathbf{N}$ is the depolarization tensor, which depends on the shape of the macroscopic body. For a sphere, which is the shape specified in the problem, the depolarization tensor is isotropic:\n$$\n\\mathbf{N} = \\frac{1}{3}\\mathbf{I}\n$$\nwhere $\\mathbf{I}$ is the identity tensor. Thus, for a spherical boundary, the depolarization field is:\n$$\n\\mathbf{E}_{\\text{dep}} = -\\frac{\\mathbf{P}}{3\\varepsilon_{0}}\n$$\nThe electrostatic self-energy of this polarized body, which is the energy stored in the depolarization field, is the required correction, $\\Delta U$. This energy is the work done to establish the polarization $\\mathbf{P}$ against the field $\\mathbf{E}_{\\text{dep}}$ that it generates. The energy density is $u = -\\frac{1}{2}\\mathbf{P} \\cdot \\mathbf{E}_{\\text{dep}}$. Integrating over the volume $V$ of the simulation cell (which represents one unit of the macroscopic body) gives the total correction energy:\n$$\n\\Delta U = \\int_{V} \\left(-\\frac{1}{2}\\mathbf{P} \\cdot \\mathbf{E}_{\\text{dep}}\\right) dV'\n$$\nSince both $\\mathbf{P}$ and $\\mathbf{E}_{\\text{dep}}$ are uniform within the sample, this simplifies to:\n$$\n\\Delta U = -\\frac{V}{2} \\mathbf{P} \\cdot \\mathbf{E}_{\\text{dep}}\n$$\nSubstituting the expressions for $\\mathbf{E}_{\\text{dep}}$ and $\\mathbf{P}$:\n$$\n\\Delta U = -\\frac{V}{2} \\left(\\frac{\\mathbf{M}}{V}\\right) \\cdot \\left(-\\frac{\\mathbf{M}/V}{3\\varepsilon_{0}}\\right) = \\frac{V}{2} \\frac{|\\mathbf{M}|^2}{3\\varepsilon_{0}V^2}\n$$\nThis simplifies to the final expression for the energy correction:\n$$\n\\Delta U = \\frac{|\\mathbf{M}|^2}{6\\varepsilon_{0}V}\n$$\nThis is the energy to be added to the standard Ewald energy to obtain the energy of a periodic system with a spherical macroscopic boundary in vacuum.\n\n**Part 2: Numerical Evaluation**\nFirst, we calculate the dipole moment $\\mathbf{M}$ for the given charge configuration.\nThe charges are $q_{1} = +e$ at $\\mathbf{r}_{1} = (d/2, 0, 0)$ and $q_{2} = -e$ at $\\mathbf{r}_{2} = (-d/2, 0, 0)$.\n$$\n\\mathbf{M} = q_{1}\\mathbf{r}_{1} + q_{2}\\mathbf{r}_{2} = (+e)\\begin{pmatrix} d/2 \\\\ 0 \\\\ 0 \\end{pmatrix} + (-e)\\begin{pmatrix} -d/2 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} ed/2 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} ed/2 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} ed \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThe magnitude of the dipole moment is $|\\mathbf{M}| = ed$. The magnitude squared is $|\\mathbf{M}|^2 = (ed)^2$.\nThe volume of the cubic cell is $V = L^3$.\nSubstituting this into our derived correction formula:\n$$\n\\Delta U = \\frac{(ed)^2}{6\\varepsilon_{0}L^3}\n$$\nNow, we substitute the given numerical values:\n- $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\n- $d = 6.00 \\times 10^{-10}\\,\\mathrm{m}$\n- $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}$\n- $L = 3.00 \\times 10^{-9}\\,\\mathrm{m}$\n\nLet's calculate the terms:\n$|\\mathbf{M}| = ed = (1.602176634 \\times 10^{-19}\\,\\mathrm{C}) \\times (6.00 \\times 10^{-10}\\,\\mathrm{m}) = 9.613059804 \\times 10^{-29}\\,\\mathrm{C \\cdot m}$\n$|\\mathbf{M}|^2 = (9.613059804 \\times 10^{-29}\\,\\mathrm{C \\cdot m})^2 = 9.24109310 \\times 10^{-57}\\,\\mathrm{C^2 \\cdot m^2}$\n$V = L^3 = (3.00 \\times 10^{-9}\\,\\mathrm{m})^3 = 2.70 \\times 10^{-26}\\,\\mathrm{m^3}$\n\nNow, we calculate the energy correction per simulation cell in Joules:\n$$\n\\Delta U = \\frac{9.24109310 \\times 10^{-57}\\,\\mathrm{C^2 \\cdot m^2}}{6 \\times (8.8541878128 \\times 10^{-12}\\,\\mathrm{F/m}) \\times (2.70 \\times 10^{-26}\\,\\mathrm{m^3})}\n$$\n$$\n\\Delta U = \\frac{9.24109310 \\times 10^{-57}}{1.43419842 \\times 10^{-36}}\\,\\mathrm{J} = 6.4433150 \\times 10^{-21}\\,\\mathrm{J}\n$$\nThis is the correction per simulation cell. The problem asks for the molar energy in $\\mathrm{kJ/mol}$. We multiply by Avogadro's constant $N_{\\mathrm{A}}$ and convert units.\n$$\n\\Delta U_{\\text{molar}} = \\Delta U \\times N_{\\mathrm{A}} = (6.4433150 \\times 10^{-21}\\,\\mathrm{J}) \\times (6.02214076 \\times 10^{23}\\,\\mathrm{mol}^{-1})\n$$\n$$\n\\Delta U_{\\text{molar}} = 3880.303\\,\\mathrm{J/mol}\n$$\nConverting to kilojoules per mole:\n$$\n\\Delta U_{\\text{molar}} = 3.880303\\,\\mathrm{kJ/mol}\n$$\nFinally, we round the result to four significant figures as requested.\n$$\n\\Delta U_{\\text{molar}} \\approx 3.880\\,\\mathrm{kJ/mol}\n$$",
            "answer": "$$\n\\boxed{3.880}\n$$"
        }
    ]
}