{
    "hands_on_practices": [
        {
            "introduction": "理解显式时间积分的稳定性是进行动力学模拟的基石。本练习将通过分析一种常见的数值技术——质量集中（mass lumping）——如何影响有限元模型中的最大稳定时间步长，来深入探讨经典的 Courant-Friedrichs-Lewy (CFL) 条件。通过这个实践，您将亲手推导和量化该技术对系统谱特性和计算效率的影响，从而深刻理解理论与实践之间的联系。",
            "id": "3855310",
            "problem": "考虑使用带有线性四面体单元的有限元法 (FEM) 对各向同性均匀弹性固体的半离散弹性动力学方程进行显式时间积分。设该固体的密度为 $\\rho$，Lamé 参数为 $\\lambda$ 和 $\\mu$。为了捕捉限制稳定性的膨胀响应，我们通过标量波动方程代理 $\\,\\rho\\,\\ddot{u} - \\kappa\\,\\nabla^{2}u = 0\\,$ 来模拟最快模式，其中 $\\kappa = \\rho c^{2}$ 且 $c = \\sqrt{(\\lambda + 2\\mu)/\\rho}$ 等于压缩波速。在单个边长为 $s$ 的正四面体上进行标准的 Galerkin 离散化后，半离散系统采用 $\\,\\mathbf{M}\\,\\ddot{\\mathbf{u}} + \\mathbf{K}\\,\\mathbf{u} = \\mathbf{0}\\,$ 的形式，其中 $\\,\\mathbf{M}\\,$ 和 $\\,\\mathbf{K}\\,$ 分别是与四个标量节点自由度相关的单元质量矩阵和刚度矩阵，$\\,\\mathbf{u}\\,$ 是 $u$ 的节点值向量。设 $\\,\\Delta t\\,$ 是应用于此系统的显式中心差分格式的时间步长。\n\n从基本原理出发——即半离散运动方程、通过线性形函数在四面体上的梯度定义的刚度矩阵 $\\,\\mathbf{K}\\,$，以及质量矩阵 $\\,\\mathbf{M}\\,$ 的一致定义与行和集中定义——推导质量集中如何改变算子 $\\,\\mathbf{M}^{-1}\\mathbf{K}\\,$ 的谱，从而改变最大稳定时间步长 $\\,\\Delta t\\,$。通过计算精确比值 $\\,\\Delta t_{\\mathrm{lump}}/\\Delta t_{\\mathrm{cons}}\\,$ 来量化单个正四面体单元的这种效应，其中 $\\,\\Delta t_{\\mathrm{lump}}\\,$ 和 $\\,\\Delta t_{\\mathrm{cons}}\\,$ 分别表示在行和集中质量矩阵和一致质量矩阵下的中心差分稳定性极限。\n\n请以单一精确值的形式提供最终答案，不带单位。无需四舍五入。",
            "solution": "用户希望找到对标量波动方程进行有限元法 (FEM) 半离散化后，采用显式中心差分积分时最大稳定时间步长的比率。比较的是在单个正线性四面体单元上，使用行和集中质量矩阵 ($\\mathbf{M}_{\\mathrm{lump}}$) 与使用一致质量矩阵 ($\\mathbf{M}_{\\mathrm{cons}}$) 的情况。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件**\n- **物理系统**：各向同性均匀弹性固体，其稳定性分析在一个代理标量波动方程 $\\rho\\,\\ddot{u} - \\kappa\\,\\nabla^{2}u = 0$ 上进行。\n- **材料与模型参数**：密度 $\\rho$，波动模量 $\\kappa = \\rho c^{2}$，其中 $c = \\sqrt{(\\lambda + 2\\mu)/\\rho}$ 是压缩波速。\n- **离散化方法**：Galerkin 有限元法。\n- **单元类型**：单个边长为 $s$ 的正四面体。使用线性形函数，产生 $4$ 个节点自由度。\n- **半离散方程**：$\\mathbf{M}\\,\\ddot{\\mathbf{u}} + \\mathbf{K}\\,\\mathbf{u} = \\mathbf{0}$，其中 $\\mathbf{u}$ 是 $u$ 的节点值向量。\n- **质量矩阵**：考虑两种情况：一致质量矩阵 $\\mathbf{M}_{\\mathrm{cons}}$ 和行和集中质量矩阵 $\\mathbf{M}_{\\mathrm{lump}}$。\n- **时间积分**：采用时间步长为 $\\Delta t$ 的显式中心差分格式。\n- **目标**：推导质量集中对 $\\mathbf{M}^{-1}\\mathbf{K}$ 谱的影响，并计算稳定性极限的精确比值 $\\Delta t_{\\mathrm{lump}}/\\Delta t_{\\mathrm{cons}}$。\n\n**1.2. 根据标准进行验证**\n- **科学依据**：该问题牢固地植根于计算固体力学和有限元分析的标准理论。使用标量波动方程作为弹性动力学稳定性的代理、一致质量矩阵和集中质量矩阵的概念，以及中心差分格式的稳定性分析，都是既定原则。\n- **适定性**：该问题是适定的。它明确了物理模型、单元几何形状（正四面体）、单元类型（线性）以及要执行的分析。这些信息足以唯一确定单元矩阵及其谱特性，从而得到一个单一的、可计算的比率。\n- **客观性**：该问题以精确、客观的数学和工程术语陈述，没有任何主观性或模糊性。\n- **其他缺陷**：该问题是自洽的、合理的、不平凡的，并且可以通过标准的数学程序进行验证。它没有违反任何无效性标准。\n\n**1.3. 结论**\n该问题有效。将提供完整解答。\n\n### 步骤 2：求解推导\n\n对于系统 $\\mathbf{M}\\,\\ddot{\\mathbf{u}} + \\mathbf{K}\\,\\mathbf{u} = \\mathbf{0}$，显式中心差分格式的稳定性由 Courant-Friedrichs-Lewy (CFL) 条件控制，该条件规定时间步长 $\\Delta t$ 不得超过临界值 $\\Delta t_{\\mathrm{max}}$。此极限与半离散系统的最高固有频率 $\\omega_{\\max}$ 相关：\n$$\n\\Delta t \\le \\Delta t_{\\mathrm{max}} = \\frac{2}{\\omega_{\\max}}\n$$\n固有频率 $\\omega$ 是广义特征值问题 $\\mathbf{K}\\mathbf{v} = \\omega^{2}\\mathbf{M}\\mathbf{v}$ 的特征值 $\\lambda_{\\mathrm{eig}}$ 的平方根。这等同于找到矩阵 $\\mathbf{D} = \\mathbf{M}^{-1}\\mathbf{K}$ 的特征值。因此，$\\omega_{\\max} = \\sqrt{\\lambda_{\\max}(\\mathbf{M}^{-1}\\mathbf{K})}$，稳定性极限为：\n$$\n\\Delta t_{\\mathrm{max}} = \\frac{2}{\\sqrt{\\lambda_{\\max}(\\mathbf{M}^{-1}\\mathbf{K})}}\n$$\n我们寻求比值 $\\frac{\\Delta t_{\\mathrm{lump}}}{\\Delta t_{\\mathrm{cons}}}$，它可以表示为最大特征值的形式：\n$$\n\\frac{\\Delta t_{\\mathrm{lump}}}{\\Delta t_{\\mathrm{cons}}} = \\frac{2/\\sqrt{\\lambda_{\\max}(\\mathbf{M}_{\\mathrm{lump}}^{-1}\\mathbf{K})}}{2/\\sqrt{\\lambda_{\\max}(\\mathbf{M}_{\\mathrm{cons}}^{-1}\\mathbf{K})}} = \\sqrt{\\frac{\\lambda_{\\max}(\\mathbf{M}_{\\mathrm{cons}}^{-1}\\mathbf{K})}{\\lambda_{\\max}(\\mathbf{M}_{\\mathrm{lump}}^{-1}\\mathbf{K})}}\n$$\n为了计算这个比值，我们必须首先构造正线性四面体的单元刚度矩阵和质量矩阵。\n\n**2.1. 正四面体的单元矩阵**\n\n一个线性四面体有 $4$ 个节点。设形函数为 $N_i(\\mathbf{x})$，其中 $i=1, 2, 3, 4$。单元矩阵定义为：\n$$\nK_{ij} = \\int_{V_e} \\kappa (\\nabla N_i \\cdot \\nabla N_j) \\, dV\n$$\n$$\n(M_{\\mathrm{cons}})_{ij} = \\int_{V_e} \\rho N_i N_j \\, dV\n$$\n其中 $V_e$ 是单元的体积。对于边长为 $s$ 的正四面体，其体积为 $V_e = \\frac{s^3}{6\\sqrt{2}}$。\n\n对于正四面体，其几何形状是完全对称的。这种对称性反映在单元矩阵的结构上。$\\mathbf{K}$ 和 $\\mathbf{M}_{\\mathrm{cons}}$ 都将是 $a\\mathbf{I} + b\\mathbf{J}$ 的形式，其中 $\\mathbf{I}$ 是 $4 \\times 4$ 的单位矩阵，$\\mathbf{J}$ 是 $4 \\times 4$ 的全一矩阵。\n\n**刚度矩阵 $\\mathbf{K}$**：\n对于线性单元，梯度 $\\nabla N_i$ 在单元内部是常数。由于正四面体的对称性，这些梯度的点积具有特定的结构：$|\\nabla N_i|^2$ 对所有 $i$ 都具有相同的值，我们称之为 $\\alpha_g$；而对于 $i \\ne j$ 的情况，$\\nabla N_i \\cdot \\nabla N_j$ 对所有对都具有相同的值，我们称之为 $\\beta_g$。根据性质 $\\sum_{i=1}^4 \\nabla N_i = \\mathbf{0}$，我们有 $\\nabla N_i \\cdot (\\sum_{j=1}^4 \\nabla N_j) = 0$，这导致 $\\alpha_g + 3\\beta_g = 0$，或 $\\beta_g = -\\alpha_g/3$。\n可以证明，对于边长为 $s$ 的正四面体，$\\alpha_g = \\frac{3}{2s^2}$。因此，$\\beta_g = -\\frac{1}{2s^2}$。\n刚度矩阵的项为 $K_{ij} = \\kappa V_e (\\nabla N_i \\cdot \\nabla N_j)$。\n$$\n\\mathbf{K} = \\kappa V_e \\begin{pmatrix} \\alpha_g  \\beta_g  \\beta_g  \\beta_g \\\\ \\beta_g  \\alpha_g  \\beta_g  \\beta_g \\\\ \\beta_g  \\beta_g  \\alpha_g  \\beta_g \\\\ \\beta_g  \\beta_g  \\beta_g  \\alpha_g \\end{pmatrix} = \\kappa \\frac{s^3}{6\\sqrt{2}} \\frac{1}{2s^2} \\begin{pmatrix} 3  -1  -1  -1 \\\\ -1  3  -1  -1 \\\\ -1  -1  3  -1 \\\\ -1  -1  -1  3 \\end{pmatrix} = \\frac{\\kappa s}{12\\sqrt{2}} \\begin{pmatrix} 3  -1  -1  -1 \\\\ -1  3  -1  -1 \\\\ -1  -1  3  -1 \\\\ -1  -1  -1  3 \\end{pmatrix}\n$$\n该矩阵可以紧凑地写作 $\\mathbf{K} = \\frac{\\kappa s}{12\\sqrt{2}}(4\\mathbf{I} - \\mathbf{J})$。\n\n**一致质量矩阵 $\\mathbf{M}_{\\mathrm{cons}}$**：\n线性四面体一致质量矩阵的标准公式，通过对重心形函数乘积进行积分得出：\n$$\n\\mathbf{M}_{\\mathrm{cons}} = \\frac{\\rho V_e}{20} \\begin{pmatrix} 2  1  1  1 \\\\ 1  2  1  1 \\\\ 1  1  2  1 \\\\ 1  1  1  2 \\end{pmatrix}\n$$\n代入 $V_e = \\frac{s^3}{6\\sqrt{2}}$，我们得到：\n$$\n\\mathbf{M}_{\\mathrm{cons}} = \\frac{\\rho s^3}{120\\sqrt{2}} \\begin{pmatrix} 2  1  1  1 \\\\ 1  2  1  1 \\\\ 1  1  2  1 \\\\ 1  1  1  2 \\end{pmatrix} = \\frac{\\rho s^3}{120\\sqrt{2}}(\\mathbf{I} + \\mathbf{J})\n$$\n\n**集中质量矩阵 $\\mathbf{M}_{\\mathrm{lump}}$**：\n行和集中质量矩阵是一个对角矩阵，其中每个对角线元素是一致质量矩阵对应行中各项的和。\n对 $\\mathbf{M}_{\\mathrm{cons}}$ 的任意一行求和，得到：$\\frac{\\rho s^3}{120\\sqrt{2}} (2 + 1 + 1 + 1) = \\frac{5\\rho s^3}{120\\sqrt{2}} = \\frac{\\rho s^3}{24\\sqrt{2}}$。\n因此，集中质量矩阵为：\n$$\n\\mathbf{M}_{\\mathrm{lump}} = \\frac{\\rho s^3}{24\\sqrt{2}} \\mathbf{I}\n$$\n\n**2.2. 谱分析**\n\n矩阵 $\\mathbf{K}$ 和 $\\mathbf{M}_{\\mathrm{cons}}$ 都具有 $a\\mathbf{I} + b\\mathbf{J}$ 的形式。这类矩阵共享一组相同的特征向量。\n矩阵 $\\mathbf{J}$（全一矩阵）有两个不同的特征值：\n- $\\lambda_1 = 4$，其特征向量为 $\\mathbf{v}_1 = (1, 1, 1, 1)^T$。这对应于均匀（刚体平移）模态。\n- $\\lambda_2 = 0$，其特征空间是维度为 $3$、由与 $\\mathbf{v}_1$ 正交的向量组成。这对应于高阶变形模态。\n\n矩阵 $a\\mathbf{I} + b\\mathbf{J}$ 的特征值为 $a+4b$（一次）和 $a$（三次）。\n让我们将此应用于我们的矩阵特征值问题。\n\n**集中质量情况**：\n我们需要 $\\mathbf{D}_{\\mathrm{lump}} = \\mathbf{M}_{\\mathrm{lump}}^{-1}\\mathbf{K}$ 的特征值。\n$$\n\\mathbf{D}_{\\mathrm{lump}} = \\left(\\frac{\\rho s^3}{24\\sqrt{2}}\\mathbf{I}\\right)^{-1} \\left(\\frac{\\kappa s}{12\\sqrt{2}}(4\\mathbf{I} - \\mathbf{J})\\right) = \\frac{24\\sqrt{2}}{\\rho s^3} \\frac{\\kappa s}{12\\sqrt{2}} (4\\mathbf{I} - \\mathbf{J}) = \\frac{2\\kappa}{\\rho s^2}(4\\mathbf{I} - \\mathbf{J})\n$$\n$4\\mathbf{I}-\\mathbf{J}$ 的特征值是 $4-4=0$ 和 $4-0=4$。\n$\\mathbf{D}_{\\mathrm{lump}}$ 的特征值是 $\\frac{2\\kappa}{\\rho s^2} \\times \\{0, 4, 4, 4\\}$。\n因此，最大特征值为：\n$$\n\\lambda_{\\max}(\\mathbf{M}_{\\mathrm{lump}}^{-1}\\mathbf{K}) = \\frac{2\\kappa}{\\rho s^2} \\times 4 = \\frac{8\\kappa}{\\rho s^2}\n$$\n\n**一致质量情况**：\n我们需要广义特征值问题 $\\mathbf{K}\\mathbf{v} = \\lambda_{\\mathrm{eig}} \\mathbf{M}_{\\mathrm{cons}}\\mathbf{v}$ 的特征值 $\\lambda_{\\mathrm{eig}}$。\n$$\n\\frac{\\kappa s}{12\\sqrt{2}}(4\\mathbf{I} - \\mathbf{J})\\mathbf{v} = \\lambda_{\\mathrm{eig}} \\frac{\\rho s^3}{120\\sqrt{2}}(\\mathbf{I} + \\mathbf{J})\\mathbf{v}\n$$\n乘以 $\\frac{120\\sqrt{2}}{\\rho s^3}$ 可将方程简化为：\n$$\n\\frac{10\\kappa}{\\rho s^2}(4\\mathbf{I} - \\mathbf{J})\\mathbf{v} = \\lambda_{\\mathrm{eig}} (\\mathbf{I} + \\mathbf{J})\\mathbf{v}\n$$\n我们测试 $\\mathbf{K}$ 和 $\\mathbf{M}_{\\mathrm{cons}}$ 的共同特征向量：\n1.  对于均匀模态 $\\mathbf{v}_1=(1,1,1,1)^T$：\n    $$\n    \\frac{10\\kappa}{\\rho s^2}(4\\mathbf{v}_1 - 4\\mathbf{v}_1) = \\lambda_{\\mathrm{eig}} (\\mathbf{v}_1 + 4\\mathbf{v}_1) \\implies \\mathbf{0} = \\lambda_{\\mathrm{eig}}(5\\mathbf{v}_1) \\implies \\lambda_{\\mathrm{eig}} = 0\n    $$\n2.  对于高阶模态 $\\mathbf{v}_k$（与 $\\mathbf{v}_1$ 正交，因此 $\\mathbf{J}\\mathbf{v}_k=\\mathbf{0}$）：\n    $$\n    \\frac{10\\kappa}{\\rho s^2}(4\\mathbf{v}_k - \\mathbf{0}) = \\lambda_{\\mathrm{eig}} (\\mathbf{v}_k + \\mathbf{0}) \\implies \\frac{40\\kappa}{\\rho s^2}\\mathbf{v}_k = \\lambda_{\\mathrm{eig}}\\mathbf{v}_k\n    $$\n    这给出 $\\lambda_{\\mathrm{eig}} = \\frac{40\\kappa}{\\rho s^2}$。这是一个三重特征值。\n\n一致质量情况下的最大特征值为：\n$$\n\\lambda_{\\max}(\\mathbf{M}_{\\mathrm{cons}}^{-1}\\mathbf{K}) = \\frac{40\\kappa}{\\rho s^2}\n$$\n\n**2.3. 时间步长比率的计算**\n\n最大允许时间步长的比率为：\n$$\n\\frac{\\Delta t_{\\mathrm{lump}}}{\\Delta t_{\\mathrm{cons}}} = \\sqrt{\\frac{\\lambda_{\\max}(\\mathbf{M}_{\\mathrm{cons}}^{-1}\\mathbf{K})}{\\lambda_{\\max}(\\mathbf{M}_{\\mathrm{lump}}^{-1}\\mathbf{K})}} = \\sqrt{\\frac{40\\kappa / (\\rho s^2)}{8\\kappa / (\\rho s^2)}} = \\sqrt{\\frac{40}{8}} = \\sqrt{5}\n$$\n这个结果表明，对于一个正线性四面体单元，质量集中将最大稳定时间步长增加了 $\\sqrt{5}$ 倍。这是因为质量集中有效地减小了算子 $\\mathbf{M}^{-1}\\mathbf{K}$ 的谱半径，使系统在其最高频率下表现得“更软”，从而对时间步长的限制更小。",
            "answer": "$$\\boxed{\\sqrt{5}}$$"
        },
        {
            "introduction": "在掌握了基本稳定性原理之后，我们需要将其应用于更接近真实材料的复杂情境。许多工程材料表现出各向异性，其力学行为随方向而变化，这使得确定全局稳定时间步长变得更具挑战性。本练习将引导您针对一个各向异性薄膜推导其方向相关的波速和局部CFL条件，并最终确定适用于整个系统的全局时间步长，这是模拟复杂复合材料时的一项关键技能。",
            "id": "3855320",
            "problem": "考虑一个面内各向异性薄膜，其粗尺度位移场 $u(x,y,t)$ 满足线性双曲守恒律\n$$\n\\rho\\,\\frac{\\partial^{2} u}{\\partial t^{2}}=\\nabla\\cdot\\left(\\mathbf{K}\\,\\nabla u\\right),\n$$\n其中 $\\rho$ 是质量密度，$\\mathbf{K}$ 是一个对称正定的二阶刚度张量。假设为与全局坐标轴对齐的正交各向异性，因此 $\\mathbf{K}=\\mathrm{diag}(K_{x},K_{y})$。一个平面波拟设 $u(\\mathbf{x},t)=U\\exp\\left(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\right)$ 是可容许的，其单位方向为 $\\mathbf{n}=\\mathbf{k}/\\|\\mathbf{k}\\|=(\\cos\\theta,\\sin\\theta)$。在一个多尺度有限元网格上使用显式中心差分时间积分器，其粗边被视为一维传播轴。局部的 Courant-Friedrichs-Lewy (CFL) 稳定性要求必须根据单元的特征长度 $h_{e}$、其相对于 $x$ 轴的取向角 $\\phi_{e}$ 以及材料的方向波速来表述。\n\n从控制方程和平面波拟设出发，推导一个形式如下的局部 CFL 条件\n$$\n\\Delta t_{e}\\leq \\Lambda\\,\\frac{h_{e}}{v_{\\mathrm{eff}}(\\phi_{e})},\n$$\n其中 $\\Lambda$ 是一个严格小于 1 的无量纲 Courant 数，$v_{\\mathrm{eff}}(\\phi_{e})$ 根据材料的最大方向相速度和单元取向来定义。你的推导必须从第一性原理开始，并且不得假定任何已有的 CFL 公式。\n\n然后，对于一个特定的各向异性材料和网格：\n- 材料参数：$K_{x}=4.0\\times 10^{9}$，$K_{y}=1.0\\times 10^{9}$，以及 $\\rho=1600$，所有单位均为一致的国际单位制（SI units）。\n- Courant 数选择：$\\Lambda=0.8$。\n- 三个杆状粗单元的长度和取向如下：单元 $1$ 的 $h_{1}=0.002$ 且 $\\phi_{1}=0^{\\circ}$；单元 $2$ 的 $h_{2}=0.0015$ 且 $\\phi_{2}=45^{\\circ}$；单元 $3$ 的 $h_{3}=0.001$ 且 $\\phi_{3}=90^{\\circ}$。\n\n使用你推导的局部 CFL 条件计算每个 $\\Delta t_{e}$，并提出一个单一的全局时间步长\n$$\n\\Delta t=\\min_{e}\\Delta t_{e}.\n$$\n以微秒（microseconds）为单位表示最终的 $\\Delta t$，并将你的答案四舍五入到三位有效数字。陈述所有步骤，包括方向速度的计算以及进入 $v_{\\mathrm{eff}}(\\phi_{e})$ 的取向依赖性，并论证为何你提出的全局 $\\Delta t$ 在与单元取向兼容的最坏情况波传播下是保守的。",
            "solution": "用户提供了一个问题，要求推导各向异性薄膜的局部 Courant-Friedrichs-Lewy (CFL) 稳定性条件，并将其应用于一个具体案例。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n-   **控制方程：** $\\rho\\,\\frac{\\partial^{2} u}{\\partial t^{2}}=\\nabla\\cdot\\left(\\mathbf{K}\\,\\nabla u\\right)$\n-   **材料属性：**\n    -   $\\rho$：质量密度。\n    -   $\\mathbf{K}$：对称正定的二阶刚度张量。\n    -   **正交各向异性：** $\\mathbf{K}=\\mathrm{diag}(K_{x},K_{y})$。\n-   **波解：** 平面波拟设 $u(\\mathbf{x},t)=U\\exp\\left(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\right)$，波传播方向为 $\\mathbf{n}=\\mathbf{k}/\\|\\mathbf{k}\\|=(\\cos\\theta,\\sin\\theta)$。\n-   **数值格式背景：**\n    -   显式中心差分时间积分器。\n    -   多尺度有限元网格，其粗边作为一维传播轴。\n-   **要求的 CFL 条件形式：** $\\Delta t_{e}\\leq \\Lambda\\,\\frac{h_{e}}{v_{\\mathrm{eff}}(\\phi_{e})}$。\n-   **CFL 参数：**\n    -   $\\Lambda$：无量纲 Courant 数。\n    -   $h_{e}$：单元特征长度。\n    -   $\\phi_{e}$：单元取向角。\n    -   $v_{\\mathrm{eff}}(\\phi_{e})$：依赖于单元取向的有效波速。\n-   **具体材料数据 (国际单位制)：**\n    -   $K_{x}=4.0\\times 10^{9}$。\n    -   $K_{y}=1.0\\times 10^{9}$。\n    -   $\\rho=1600$。\n-   **具体数值数据：**\n    -   $\\Lambda=0.8$。\n-   **具体单元数据：**\n    -   单元 $1$：$h_{1}=0.002$，$\\phi_{1}=0^{\\circ}$。\n    -   单元 $2$：$h_{2}=0.0015$，$\\phi_{2}=45^{\\circ}$。\n    -   单元 $3$：$h_{3}=0.001$，$\\phi_{3}=90^{\\circ}$。\n-   **全局时间步长规则：** $\\Delta t=\\min_{e}\\Delta t_{e}$。\n-   **输出要求：** 最终的 $\\Delta t$ 以微秒为单位，四舍五入到三位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n该问题具有科学依据，采用了各向异性介质的标准线性波动方程和用于数值稳定性的 CFL 条件概念。问题是适定的，提供了执行所要求的推导和计算所需的所有物理和数值参数。语言客观且数学上精确。该问题是计算力学中的一个标准练习，没有任何科学缺陷、不一致或含糊之处。\n\n**步骤 3：结论与行动**\n\n该问题是**有效的**。继续进行求解。\n\n### 第 1 部分：局部 CFL 条件的推导\n\n推导从粗尺度位移场 $u(x,y,t)$ 的控制偏微分方程 (PDE) 开始：\n$$\n\\rho\\,\\frac{\\partial^{2} u}{\\partial t^{2}}=\\nabla\\cdot\\left(\\mathbf{K}\\,\\nabla u\\right)\n$$\n对于刚度张量为 $\\mathbf{K}=\\mathrm{diag}(K_{x},K_{y})$ 的正交各向异性材料，右侧展开为：\n$$\n\\nabla\\cdot\\left(\\mathbf{K}\\,\\nabla u\\right) = \\frac{\\partial}{\\partial x}\\left(K_x \\frac{\\partial u}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\left(K_y \\frac{\\partial u}{\\partial y}\\right) = K_x \\frac{\\partial^2 u}{\\partial x^2} + K_y \\frac{\\partial^2 u}{\\partial y^2}\n$$\n因此，控制方程为：\n$$\n\\rho\\,\\frac{\\partial^{2} u}{\\partial t^{2}} = K_x \\frac{\\partial^2 u}{\\partial x^2} + K_y \\frac{\\partial^2 u}{\\partial y^2}\n$$\n我们代入平面波拟设 $u(\\mathbf{x},t)=U\\exp\\left(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\right)$，其中 $\\mathbf{k}=(k_x, k_y)$ 是波矢量，$\\omega$ 是角频率。所需的偏导数是：\n$$\n\\frac{\\partial^{2} u}{\\partial t^{2}} = (-\\mathrm{i}\\omega)^2 u = -\\omega^2 u\n$$\n$$\n\\frac{\\partial^{2} u}{\\partial x^{2}} = (\\mathrm{i}k_x)^2 u = -k_x^2 u\n$$\n$$\n\\frac{\\partial^{2} u}{\\partial y^{2}} = (\\mathrm{i}k_y)^2 u = -k_y^2 u\n$$\n将这些代入偏微分方程，得到色散关系：\n$$\n\\rho(-\\omega^2 u) = K_x(-k_x^2 u) + K_y(-k_y^2 u)\n$$\n$$\n\\rho\\omega^2 = K_x k_x^2 + K_y k_y^2\n$$\n波的相速度 $v_p$ 是 $v_p = \\omega/\\|\\mathbf{k}\\|$，其中 $\\|\\mathbf{k}\\| = \\sqrt{k_x^2 + k_y^2}$。从色散关系，我们有：\n$$\nv_p^2 = \\frac{\\omega^2}{\\|\\mathbf{k}\\|^2} = \\frac{K_x k_x^2 + K_y k_y^2}{\\rho(k_x^2 + k_y^2)}\n$$\n设波的传播方向由角度 $\\theta$ 定义，使得单位方向矢量为 $\\mathbf{n}=(\\cos\\theta, \\sin\\theta)$。则 $k_x = \\|\\mathbf{k}\\|\\cos\\theta$ 且 $k_y = \\|\\mathbf{k}\\|\\sin\\theta$。代入这些可得到方向相速度 $v_p(\\theta)$：\n$$\nv_p^2(\\theta) = \\frac{K_x (\\|\\mathbf{k}\\|\\cos\\theta)^2 + K_y (\\|\\mathbf{k}\\|\\sin\\theta)^2}{\\rho\\|\\mathbf{k}\\|^2} = \\frac{K_x \\cos^2\\theta + K_y \\sin^2\\theta}{\\rho}\n$$\n$$\nv_p(\\theta) = \\sqrt{\\frac{K_x \\cos^2\\theta + K_y \\sin^2\\theta}{\\rho}}\n$$\nCFL 条件将数值时间步长 $\\Delta t$ 与特征网格尺寸 $h$ 以及信息传播的最大速度联系起来。问题陈述“粗边被视为一维传播轴”。这是多尺度方法中常见的建模简化，意味着给定粗单元的稳定性由沿其轴向的波传播所控制。\n\n因此，对于一个特征长度为 $h_e$、取向角为 $\\phi_e$ 的单元 $e$，其局部 CFL 条件中使用的有效速度 $v_{\\mathrm{eff}}(\\phi_e)$ 必须是材料在单元轴线方向上的相速度。我们将波的传播方向 $\\theta$ 设置为等于单元的取向角 $\\phi_e$。\n$$\nv_{\\mathrm{eff}}(\\phi_e) = v_p(\\phi_e) = \\sqrt{\\frac{K_x \\cos^2\\phi_e + K_y \\sin^2\\phi_e}{\\rho}}\n$$\n这定义了所要求的有效速度。那么，显式时间积分格式的稳定性的局部 CFL 条件是：\n$$\n\\Delta t_e \\leq \\Lambda \\frac{h_e}{v_{\\mathrm{eff}}(\\phi_e)}\n$$\n其中 $\\Lambda$ 是一个为确保稳定性而严格小于 1 的 Courant 数。在建模假设下，即对单元稳定性最严格的动力学是沿其主轴传播的动力学，对 $v_{\\mathrm{eff}}(\\phi_e)$ 的这种选择是保守的。\n\n### 第 2 部分：应用与计算\n\n我们有以下给定的参数：\n-   $K_{x}=4.0\\times 10^{9}$ SI 单位\n-   $K_{y}=1.0\\times 10^{9}$ SI 单位\n-   $\\rho=1600$ SI 单位\n-   $\\Lambda=0.8$\n\n首先，我们计算沿主材料轴的波速的平方：\n$$\nv_x^2 = \\frac{K_x}{\\rho} = \\frac{4.0\\times 10^{9}}{1600} = 2.5 \\times 10^6 \\, (\\mathrm{m/s})^2\n$$\n$$\nv_y^2 = \\frac{K_y}{\\rho} = \\frac{1.0\\times 10^{9}}{1600} = 0.625 \\times 10^6 \\, (\\mathrm{m/s})^2\n$$\n现在，我们为每个单元计算最大允许的时间步长 $\\Delta t_e$。\n\n**单元 1：** $h_1 = 0.002$ m, $\\phi_1 = 0^{\\circ}$\n有效速度为：\n$$\nv_{\\mathrm{eff}}(\\phi_1) = \\sqrt{v_x^2 \\cos^2(0^{\\circ}) + v_y^2 \\sin^2(0^{\\circ})} = \\sqrt{v_x^2} = v_x = \\sqrt{2.5 \\times 10^6} \\, \\mathrm{m/s}\n$$\n时间步长限制为：\n$$\n\\Delta t_1 \\leq (0.8) \\frac{0.002}{\\sqrt{2.5 \\times 10^6}} = \\frac{1.6 \\times 10^{-3}}{10^3 \\sqrt{2.5}} = \\frac{1.6}{\\sqrt{2.5}} \\times 10^{-6} \\, \\mathrm{s} \\approx 1.0119 \\times 10^{-6} \\, \\mathrm{s}\n$$\n\n**单元 2：** $h_2 = 0.0015$ m, $\\phi_2 = 45^{\\circ}$\n有效速度的平方为：\n$$\nv_{\\mathrm{eff}}(\\phi_2)^2 = v_x^2 \\cos^2(45^{\\circ}) + v_y^2 \\sin^2(45^{\\circ}) = v_x^2\\left(\\frac{1}{2}\\right) + v_y^2\\left(\\frac{1}{2}\\right) = \\frac{1}{2}(v_x^2 + v_y^2)\n$$\n$$\nv_{\\mathrm{eff}}(\\phi_2)^2 = \\frac{1}{2}(2.5 \\times 10^6 + 0.625 \\times 10^6) = \\frac{3.125 \\times 10^6}{2} = 1.5625 \\times 10^6 \\, (\\mathrm{m/s})^2\n$$\n$$\nv_{\\mathrm{eff}}(\\phi_2) = \\sqrt{1.5625 \\times 10^6} = 1.25 \\times 10^3 \\, \\mathrm{m/s} = 1250 \\, \\mathrm{m/s}\n$$\n时间步长限制为：\n$$\n\\Delta t_2 \\leq (0.8) \\frac{0.0015}{1250} = \\frac{1.2 \\times 10^{-3}}{1.25 \\times 10^3} = 0.96 \\times 10^{-6} \\, \\mathrm{s}\n$$\n\n**单元 3：** $h_3 = 0.001$ m, $\\phi_3 = 90^{\\circ}$\n有效速度为：\n$$\nv_{\\mathrm{eff}}(\\phi_3) = \\sqrt{v_x^2 \\cos^2(90^{\\circ}) + v_y^2 \\sin^2(90^{\\circ})} = \\sqrt{v_y^2} = v_y = \\sqrt{0.625 \\times 10^6} \\, \\mathrm{m/s}\n$$\n时间步长限制为：\n$$\n\\Delta t_3 \\leq (0.8) \\frac{0.001}{\\sqrt{0.625 \\times 10^6}} = \\frac{0.8 \\times 10^{-3}}{10^3\\sqrt{0.625}} = \\frac{0.8}{\\sqrt{0.625}} \\times 10^{-6} \\, \\mathrm{s} \\approx 1.0119 \\times 10^{-6} \\, \\mathrm{s}\n$$\n注意 $v_x = 2v_y$ 且 $h_1 = 2h_3$，因此比率 $h_1/v_x$ 和 $h_3/v_y$ 相等，导致 $\\Delta t_1 = \\Delta t_3$。\n\n**全局时间步长**\n全局时间步长 $\\Delta t$ 必须对所有单元都稳定，因此我们取局部时间步长限制的最小值：\n$$\n\\Delta t = \\min(\\Delta t_1, \\Delta t_2, \\Delta t_3) = \\min(1.0119...\\times 10^{-6}, 0.96 \\times 10^{-6}, 1.0119...\\times 10^{-6}) \\, \\mathrm{s}\n$$\n$$\n\\Delta t = 0.96 \\times 10^{-6} \\, \\mathrm{s}\n$$\n问题要求以微秒 ($\\mu\\mathrm{s}$) 为单位给出答案，其中 $1\\,\\mu\\mathrm{s} = 10^{-6}\\,\\mathrm{s}$。\n$$\n\\Delta t = 0.96 \\, \\mu\\mathrm{s}\n$$\n四舍五入到三位有效数字，我们得到 $0.960 \\, \\mu\\mathrm{s}$。建议的全局时间步长就是这个值。",
            "answer": "$$\\boxed{0.960}$$"
        },
        {
            "introduction": "虽然基于最坏情况的固定时间步长能够保证稳定性，但其计算效率往往不高。为了解决这个问题，更先进的模拟采用了自适应时间步长策略。这个动手编程练习将指导您从第一性原理出发，设计并实现一个“事件感知”的自适应时间步长规则，该规则能根据系统局部的物理状态（如势能面的曲率或力的大小）动态调整时间步长，从而在保证精度和稳定性的同时，显著提升分子动力学模拟的效率。",
            "id": "3855317",
            "problem": "您的任务是为确定性分子动力学（MD）在势能面（PES）上的模拟设计并实现一个事件感知的自适应时间步长选择规则。其目标是通过监测局部指标，如力的大小$\\,\\|\\nabla V\\|\\,$和加速度的大小$\\,\\|\\mathbf{a}\\|\\,$，在快速跃迁（例如，穿越亚稳态盆地之间的势垒）附近减小时间步长$\\,\\Delta t\\,$，并从解析上证明规则中使用的阈值是合理的。该规则必须从牛顿第二定律$\\,m\\,\\ddot{\\mathbf{x}} = -\\nabla V(\\mathbf{x})\\,$和针对局部刚度和稳定性的标准线性化论证等第一性原理出发进行推导。最终的时间步长选择必须结合确保数值稳定性和控制单步内局部变化的约束。\n\n您的实现必须为每个测试用例接受一个势能$\\,V\\,$、其在当前状态$\\,\\mathbf{x}\\,$下求得的梯度$\\,\\nabla V\\,$和黑塞矩阵$\\,\\nabla^2 V\\,$、当前速度$\\,\\mathbf{v}\\,$、质量$\\,m\\,$以及用户选择的反映每步可接受分数变化的常数。该选择规则必须至少结合以下三个概念上不同的约束：\n\n- 一个局部线性稳定性界，通过将$\\,\\mathbf{x}\\,$附近的PES近似为二次型并确保一个显式二阶积分器的稳定性来推导。\n- 一个通过加速度大小来限制每步速度分数变化的界，表示为$\\,\\|\\mathbf{v}\\|\\,$的一个分数。\n- 一个通过黑塞矩阵范数和步长位移$\\,\\|\\mathbf{v}\\|\\,\\Delta t\\,$来限制每步力的分数变化的界，表示为$\\,\\|\\nabla V(\\mathbf{x})\\|\\,$的一个分数。\n\n您必须从解析上证明这些约束的合理性，并将它们操作化为一个可计算的规则，该规则选择$\\,\\Delta t\\,$作为适用界和给定最大时间步长$\\,\\Delta t_{\\max}\\,$中的最小值。您的程序必须为下面的每个测试用例计算并输出所选的$\\,\\Delta t\\,$（以秒为单位）。如果在驻点处由于$\\,\\mathbf{v}=\\mathbf{0}\\,$或$\\,\\nabla V(\\mathbf{x})=\\mathbf{0}\\,$导致某个分母为零，您的规则必须通过使用一个小的正正则化常数来保持其良定义性和数值鲁棒性。\n\n所有物理量必须使用国际单位制（SI）进行处理和报告。特别地，距离必须以米（$\\,\\mathrm{m}\\,$）为单位，速度以米/秒（$\\,\\mathrm{m/s}\\,$）为单位，质量以千克（$\\,\\mathrm{kg}\\,$）为单位，能量以焦耳（$\\,\\mathrm{J}\\,$）为单位，时间以秒（$\\,\\mathrm{s}\\,$）为单位。最终输出必须以秒（$\\,\\mathrm{s}\\,$）为单位表示为浮点数。\n\n您必须在一套包含$\\,5\\,$个测试用例的测试集上评估您的规则，这些用例旨在探测不同的物理情景：\n\n- 案例$\\,1\\,$（一维双阱，从左侧势阱接近势垒）：令$\\,V(x) = a\\,(x^2 - b^2)^2\\,$，其中$\\,a = 10^{20}\\,\\mathrm{J/m^4}\\,$, $\\,b = 10^{-10}\\,\\mathrm{m}\\,$, 位置$\\,x = -0.8\\,b\\,$, 速度$\\,v = 10^3\\,\\mathrm{m/s}\\,$, 质量$\\,m = 10^{-26}\\,\\mathrm{kg}\\,$, 最大时间步长$\\,\\Delta t_{\\max} = 10^{-12}\\,\\mathrm{s}\\,$, 速度分数变化常数$\\,\\kappa = 0.1\\,$, 力的分数变化常数$\\,\\beta = 0.1\\,$, 稳定性安全系数$\\,s = 0.9\\,$. 为保持一致性，将$\\,x\\,$和$\\,v\\,$视为一维向量。\n- 案例$\\,2\\,$（一维双阱，接近势垒顶部）：$\\,V(x)\\,$, $\\,a\\,$和$\\,b\\,$与案例$\\,1\\,$相同，现在$\\,x = 0\\,$, $\\,v = 10^2\\,\\mathrm{m/s}\\,$, $\\,m = 10^{-26}\\,\\mathrm{kg}\\,$, $\\,\\Delta t_{\\max} = 10^{-12}\\,\\mathrm{s}\\,$, $\\,\\kappa = 0.1\\,$, $\\,\\beta = 0.1\\,$, 和$\\,s = 0.9\\,$.\n- 案例$\\,3\\,$（二维各向异性二次势阱，存在刚性方向）：令$\\,V(x,y) = \\tfrac{1}{2}k_x x^2 + \\tfrac{1}{2}k_y y^2\\,$，其中$\\,k_x = 1\\,\\mathrm{N/m}\\,$, $\\,k_y = 10^3\\,\\mathrm{N/m}\\,$, 位置$\\,\\mathbf{x} = (10^{-10}, 10^{-10})\\,\\mathrm{m}\\,$, 速度$\\,\\mathbf{v} = (0, 10^3)\\,\\mathrm{m/s}\\,$, $\\,m = 10^{-26}\\,\\mathrm{kg}\\,$, $\\,\\Delta t_{\\max} = 10^{-12}\\,\\mathrm{s}\\,$, $\\,\\kappa = 0.1\\,$, $\\,\\beta = 0.1\\,$, 和$\\,s = 0.9\\,$.\n- 案例$\\,4\\,$（一维双阱，在极小值点，静止）：$\\,V(x)\\,$, $\\,a\\,$和$\\,b\\,$与案例$\\,1\\,$相同，其中$\\,x = b\\,$, $\\,v = 0\\,\\mathrm{m/s}\\,$, $\\,m = 10^{-26}\\,\\mathrm{kg}\\,$, $\\,\\Delta t_{\\max} = 10^{-12}\\,\\mathrm{s}\\,$, $\\,\\kappa = 0.1\\,$, $\\,\\beta = 0.1\\,$, 和$\\,s = 0.9\\,$. 此案例探测当$\\,\\nabla V(\\mathbf{x}) = \\mathbf{0}\\,$和$\\,\\mathbf{v} = \\mathbf{0}\\,$时的行为。\n- 案例$\\,5\\,$（一维双阱，刚越过势垒，具有大加速度）：$\\,V(x)\\,$, $\\,a\\,$和$\\,b\\,$与案例$\\,1\\,$相同，其中$\\,x = 0.2\\,b\\,$, $\\,v = 2\\times 10^3\\,\\mathrm{m/s}\\,$, $\\,m = 10^{-26}\\,\\mathrm{kg}\\,$, $\\,\\Delta t_{\\max} = 10^{-12}\\,\\mathrm{s}\\,$, $\\,\\kappa = 0.1\\,$, $\\,\\beta = 0.1\\,$, 和$\\,s = 0.9\\,$.\n\n您的程序应生成一行输出，其中包含$\\,5\\,$个测试用例的结果，结果为一个用方括号括起来的逗号分隔列表。例如，如果结果为$\\,r_1,\\dots,r_5\\,$，则输出必须为$\\,\\big[ r_1, r_2, r_3, r_4, r_5 \\big]\\,$的形式，其中每个$\\,r_i\\,$是一个以秒为单位的浮点数。\n\n注意：在您使用的缩略语首次出现时进行定义。例如，分子动力学（MD）和势能面（PES）。",
            "solution": "该问题要求设计并从解析上证明一种用于分子动力学（MD）模拟的自适应时间步长$\\Delta t$选择规则。核心原则是根据势能面（PES）的局部特性（记为$V(\\mathbf{x})$）来调整$\\Delta t$，以确保数值稳定性和准确性。动力学由牛顿第二定律支配：\n$$\nm\\,\\ddot{\\mathbf{x}} = \\mathbf{F}(\\mathbf{x}) = -\\nabla V(\\mathbf{x})\n$$\n其中$m$是质量，$\\mathbf{x}$是位置向量，$\\ddot{\\mathbf{x}}$是加速度，$\\mathbf{F}(\\mathbf{x})$是力。\n\n所提出的时间步长$\\Delta t$将是用户定义的最大值$\\Delta t_{\\max}$以及三个不同物理和数值约束中的最小值。我们将从第一性原理推导每个约束。\n\n**1. 局部线性稳定性约束 ($\\Delta t_1$)**\n\n显式积分方案（如广泛使用的Verlet算法）的数值稳定性受到系统所能表现出的最高运动频率的限制。为确定此局部频率，我们在当前位置$\\mathbf{x}$附近对运动方程进行线性化。一个小的扰动$\\delta\\mathbf{x}$的演化遵循：\n$$\nm\\,\\delta\\ddot{\\mathbf{x}} \\approx -(\\nabla^2 V(\\mathbf{x})) \\delta\\mathbf{x}\n$$\n其中$\\nabla^2 V(\\mathbf{x})$是势能的黑塞矩阵，它充当一个局部刚度矩阵。这是一个耦合谐振子系统。简正模频率$\\omega_i$由黑塞矩阵的特征值$\\lambda_i$决定。具体来说，$\\omega_i^2 = \\lambda_i / m$。为了使一个模式是振荡且稳定的，其对应的特征值$\\lambda_i$必须为正。\n\n系统中的最高频率$\\omega_{\\max}$决定了稳定性极限。它对应于黑塞矩阵的最大正特征值，即$\\lambda_{\\max} = \\max(\\{\\lambda_i > 0\\})$。对于像Verlet这样的二阶积分器的标准稳定性分析表明，时间步长必须满足$\\Delta t \\le 2 / \\omega_{\\max}$。为确保鲁棒性，我们引入一个安全系数$s \\in (0, 1)$。因此，基于稳定性的时间步长约束$\\Delta t_1$是：\n$$\n\\Delta t_1 = \\frac{2s}{\\omega_{\\max}} = 2s\\sqrt{\\frac{m}{\\lambda_{\\max}}}\n$$\n如果黑塞矩阵没有正特征值（即$\\lambda_{\\max} \\le 0$），则系统在局部是不稳定的或处于拐点。此时没有高频振荡需要解析。在这种情况下，稳定性约束不是限制因素，我们可以认为它对任何$\\Delta t$都满足，我们通过设置$\\Delta t_1 \\to \\infty$来形式化这一点。\n\n**2. 速度分数变化约束 ($\\Delta t_2$)**\n\n为了确保准确性和平滑的轨迹，我们必须限制速度向量$\\mathbf{v}$在单步内的变化量。在一个时间步长$\\Delta t$内，速度的变化量$\\Delta\\mathbf{v}$近似为：\n$$\n\\Delta\\mathbf{v} \\approx \\mathbf{a}\\,\\Delta t\n$$\n其中$\\mathbf{a} = \\mathbf{F}/m = -\\nabla V(\\mathbf{x})/m$是当前加速度。我们施加一个条件，即此变化的幅度是当前速度幅度的一个小分数$\\kappa$：\n$$\n\\|\\Delta\\mathbf{v}\\| \\le \\kappa \\|\\mathbf{v}\\|\n$$\n代入$\\Delta\\mathbf{v}$的近似值得到$\\|\\mathbf{a}\\|\\,\\Delta t \\le \\kappa \\|\\mathbf{v}\\|$。这给出了时间步长界$\\Delta t_2$：\n$$\n\\Delta t_2 = \\kappa \\frac{\\|\\mathbf{v}\\|}{\\|\\mathbf{a}\\|} = \\kappa \\frac{m \\|\\mathbf{v}\\|}{\\|\\nabla V(\\mathbf{x})\\|}\n$$\n在某些物理极限下，此约束变得不明确或过于严格。\n- 如果$\\|\\nabla V(\\mathbf{x})\\| \\approx 0$（即粒子处于或接近驻点），则加速度$\\mathbf{a}$接近于零，速度变化极小。该约束不应是限制性的。如果$\\|\\mathbf{a}\\|$低于一个小的数值容差，我们通过设置$\\Delta t_2 \\to \\infty$来处理。\n- 如果$\\|\\mathbf{v}\\| \\approx 0$但$\\|\\mathbf{a}\\| \\neq 0$（例如，一个静止在斜坡上的粒子），所述准则给出$\\Delta t_2 \\approx 0$，这是不符合物理实际的，因为它会使模拟停止。对于零量，“分数变化”的概念没有意义。因此，如果$\\|\\mathbf{v}\\|$低于一个数值容差，此特定准则不适用，我们设置$\\Delta t_2 \\to \\infty$。系统从静止状态的演化则由其他准则控制。\n\n**3. 力的分数变化约束 ($\\Delta t_3$)**\n\n力$\\mathbf{F}(\\mathbf{x})$随着粒子的移动而变化。在单个时间步长内力的巨大变化表明积分器所依赖的线性力假设（恒定加速度）正在失效。一步内的位移近似为$\\Delta\\mathbf{x} \\approx \\mathbf{v}\\,\\Delta t$。力的一阶泰勒展开为：\n$$\n\\mathbf{F}(\\mathbf{x} + \\Delta\\mathbf{x}) \\approx \\mathbf{F}(\\mathbf{x}) + (\\nabla_{\\mathbf{x}}\\mathbf{F}(\\mathbf{x})) \\Delta\\mathbf{x}\n$$\n因此，力的变化量$\\Delta\\mathbf{F}$为：\n$$\n\\Delta\\mathbf{F} \\approx (\\nabla_{\\mathbf{x}}\\mathbf{F}(\\mathbf{x})) (\\mathbf{v}\\,\\Delta t) = -(\\nabla^2 V(\\mathbf{x})) \\mathbf{v}\\,\\Delta t\n$$\n我们要求此变化是当前力幅度的一个小分数$\\beta$：\n$$\n\\|\\Delta\\mathbf{F}\\| \\le \\beta \\|\\mathbf{F}(\\mathbf{x})\\|\n$$\n代入$\\Delta\\mathbf{F}$的表达式得到$\\|(\\nabla^2 V(\\mathbf{x})) \\mathbf{v}\\|\\,\\Delta t \\le \\beta \\|\\nabla V(\\mathbf{x})\\|$。这产生了时间步长界$\\Delta t_3$：\n$$\n\\Delta t_3 = \\beta \\frac{\\|\\nabla V(\\mathbf{x})\\|}{\\|(\\nabla^2 V(\\mathbf{x})) \\mathbf{v}\\|}\n$$\n与前面的约束类似，我们必须处理极限情况以保证数值鲁棒性。\n- 如果$\\|\\nabla V(\\mathbf{x})\\| \\approx 0$（零力），则分数变化的概念是未定义的。在这种情况下，力在一阶上没有变化，因此该约束应该是宽松的。如果$\\|\\nabla V(\\mathbf{x})\\|$低于一个数值容差，我们设置$\\Delta t_3 \\to \\infty$。\n- 如果分母项$\\|(\\nabla^2 V(\\mathbf{x})) \\mathbf{v}\\|$接近于零（例如，如果$\\mathbf{v}=\\mathbf{0}$，或者$\\mathbf{v}$在黑塞矩阵的零空间中），这表明速度指向力场局部恒定的方向。该约束变得非限制性，设置$\\Delta t_3 \\to \\infty$是合适的。\n\n**最终的自适应时间步长规则**\n\n自适应时间步长$\\Delta t$被选为所有界中最严格的一个，确保所有物理和数值准则同时得到满足：\n$$\n\\Delta t = \\min(\\Delta t_{\\max}, \\Delta t_1, \\Delta t_2, \\Delta t_3)\n$$\n这个复合规则能够鲁棒地适应模拟的时间尺度，在曲率大（$\\lambda_{\\max}$大）、加速度高或力变化快的区域减小$\\Delta t$，而在PES平滑、变化缓慢的区域增大$\\Delta t$。",
            "answer": "```python\nimport numpy as np\n\ndef compute_dt(V_grad, V_hess, v, m, κ, β, s, dt_max):\n    \"\"\"\n    Computes the adaptive time step based on local stability and accuracy criteria.\n\n    Args:\n        V_grad (np.ndarray): Gradient of the potential V at the current position.\n        V_hess (np.ndarray): Hessian of the potential V at the current position.\n        v (np.ndarray): Current velocity vector.\n        m (float): Mass of the particle.\n        κ (float): Fractional velocity change constant.\n        β (float): Fractional force change constant.\n        s (float): Stability safety factor.\n        dt_max (float): Maximum allowed time step.\n\n    Returns:\n        float: The selected adaptive time step, dt.\n    \"\"\"\n    # Define a small tolerance for checking against zero to handle numerical robustness\n    TOL = 1e-15\n\n    # --- 1. Constraint from Local Linear Stability (dt1) ---\n    # Hessian is symmetric, so we can use eigvalsh\n    eigenvalues = np.linalg.eigvalsh(V_hess)\n    lambda_max = np.max(eigenvalues) if eigenvalues.size > 0 else -1.0\n\n    if lambda_max > TOL:\n        omega_max = np.sqrt(lambda_max / m)\n        dt1 = (2.0 * s) / omega_max\n    else:\n        # No positive eigenvalues means no local oscillation, so stability is not an issue.\n        dt1 = np.inf\n\n    # --- 2. Constraint from Fractional Velocity Change (dt2) ---\n    F = -V_grad\n    a = F / m\n    norm_v = np.linalg.norm(v)\n    norm_a = np.linalg.norm(a)\n\n    if norm_v  TOL or norm_a  TOL:\n        # If velocity is zero, fractional change is ill-defined.\n        # If acceleration is zero, velocity does not change.\n        dt2 = np.inf\n    else:\n        dt2 = κ * norm_v / norm_a\n\n    # --- 3. Constraint from Fractional Force Change (dt3) ---\n    norm_F = np.linalg.norm(F)\n\n    if norm_F  TOL:\n        # If force is zero, fractional change is ill-defined.\n        dt3 = np.inf\n    else:\n        # Rate of change of force w.r.t. displacement along v\n        dF = V_hess @ v\n        norm_dF = np.linalg.norm(dF)\n        if norm_dF  TOL:\n            # Velocity is in a direction where force doesn't change\n            dt3 = np.inf\n        else:\n            dt3 = β * norm_F / norm_dF\n\n    # --- Final Time Step Selection ---\n    dt = min(dt_max, dt1, dt2, dt3)\n\n    return dt\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the adaptive time step rule.\n    \"\"\"\n    # Parameters for the double-well potential V(x) = a(x^2 - b^2)^2\n    a = 1.0e20  # J/m^4\n    b = 1.0e-10  # m\n    m_dw = 1.0e-26 # kg\n\n    # Functions for the 1D double-well potential\n    def grad_V_dw(x, a_val, b_val):\n        return np.array([4 * a_val * x[0] * (x[0]**2 - b_val**2)])\n\n    def hess_V_dw(x, a_val, b_val):\n        return np.array([[4 * a_val * (3 * x[0]**2 - b_val**2)]])\n\n    # Parameters for the 2D harmonic potential V(x,y) = 0.5*kx*x^2 + 0.5*ky*y^2\n    k_x = 1.0     # N/m\n    k_y = 1000.0  # N/m\n    m_ho = 1.0e-26 # kg\n\n    def grad_V_ho(x, kx_val, ky_val):\n        return np.array([kx_val * x[0], ky_val * x[1]])\n\n    def hess_V_ho(x, kx_val, ky_val):\n        return np.array([[kx_val, 0.0], [0.0, ky_val]])\n\n    # Define the 5 test cases\n    test_cases = [\n        # Case 1: 1D double-well, approaching barrier\n        {'case_id': 1, 'x': np.array([-0.8 * b]), 'v': np.array([1000.0]),\n         'm': m_dw, 'dt_max': 1e-12, 'κ': 0.1, 'β': 0.1, 's': 0.9,\n         'grad_func': lambda x: grad_V_dw(x, a, b),\n         'hess_func': lambda x: hess_V_dw(x, a, b)},\n        # Case 2: 1D double-well, at barrier top\n        {'case_id': 2, 'x': np.array([0.0]), 'v': np.array([100.0]),\n         'm': m_dw, 'dt_max': 1e-12, 'κ': 0.1, 'β': 0.1, 's': 0.9,\n         'grad_func': lambda x: grad_V_dw(x, a, b),\n         'hess_func': lambda x: hess_V_dw(x, a, b)},\n        # Case 3: 2D harmonic well, anisotropic\n        {'case_id': 3, 'x': np.array([1e-10, 1e-10]), 'v': np.array([0.0, 1000.0]),\n         'm': m_ho, 'dt_max': 1e-12, 'κ': 0.1, 'β': 0.1, 's': 0.9,\n         'grad_func': lambda x: grad_V_ho(x, k_x, k_y),\n         'hess_func': lambda x: hess_V_ho(x, k_x, k_y)},\n        # Case 4: 1D double-well, at minimum, stationary\n        {'case_id': 4, 'x': np.array([b]), 'v': np.array([0.0]),\n         'm': m_dw, 'dt_max': 1e-12, 'κ': 0.1, 'β': 0.1, 's': 0.9,\n         'grad_func': lambda x: grad_V_dw(x, a, b),\n         'hess_func': lambda x: hess_V_dw(x, a, b)},\n        # Case 5: 1D double-well, past barrier\n        {'case_id': 5, 'x': np.array([0.2 * b]), 'v': np.array([2000.0]),\n         'm': m_dw, 'dt_max': 1e-12, 'κ': 0.1, 'β': 0.1, 's': 0.9,\n         'grad_func': lambda x: grad_V_dw(x, a, b),\n         'hess_func': lambda x: hess_V_dw(x, a, b)},\n    ]\n\n    results = []\n    for case in test_cases:\n        V_grad = case['grad_func'](case['x'])\n        V_hess = case['hess_func'](case['x'])\n        dt = compute_dt(V_grad, V_hess, case['v'], case['m'], case['κ'], case['β'], case['s'], case['dt_max'])\n        results.append(f\"{dt:.5e}\")\n\n    print(f\"[{', '.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}