{
    "hands_on_practices": [
        {
            "introduction": "将理论转化为实践是掌握复杂计算方法的关键。本练习  旨在指导您从第一性原理出发，通过编写代码来实现周期性体系中静电势的计算。您将分别实现基于泊松方程的直接傅里叶空间解法和计算效率更高的埃瓦尔德求和方法，并通过数值比较来验证两者在数学上的等价性，从而深刻理解埃瓦尔德方法的核心思想与优势。",
            "id": "3821713",
            "problem": "您必须编写一个完整的程序，使用两种独立的方法计算三维周期性晶胞中一组点电荷在某点产生的静电势：一种是泊松方程的傅里叶空间解法，另一种是Ewald求和法。目标是针对多个测试用例，在指定的绝对容差范围内验证这两种方法之间的数值一致性。\n\n其物理和数学背景如下。考虑一个在周期性边界条件（PBC）下的立方三维周期性晶胞，其边长为$L$。晶胞内有$N$个点电荷$q_i$，位置为$\\mathbf{r}_i$。在$4\\pi\\epsilon_0 = 1$的约化静电单位制中，静电势$\\phi(\\mathbf{r})$由泊松方程定义，方程为$\\nabla^2 \\phi(\\mathbf{r}) = -4\\pi \\rho(\\mathbf{r})$，其中电荷密度$\\rho(\\mathbf{r}) = \\sum_{i=1}^{N} q_i \\delta(\\mathbf{r}-\\mathbf{r}_i)$。\n\n从这一基本出发点，并仅使用下述定义和约束，实现以下两种方法，不得引入任何未说明的物理假设：\n\n- 傅里叶空间解法：将$\\rho(\\mathbf{r})$和$\\phi(\\mathbf{r})$都用与周期性晶胞相符的傅里叶级数表示，并通过对非零倒易晶格矢量（RLV）$\\mathbf{k}$求和来获得目标位置$\\mathbf{r}$处的$\\phi(\\mathbf{r})$，其中$\\mathbf{k} = \\frac{2\\pi}{L} \\mathbf{m}$，$\\mathbf{m} \\in \\mathbb{Z}^3$。您必须使用有限的倒易空间截断$m_{\\max}$来实现此求和，包括所有分量在$[-m_{\\max}, +m_{\\max}]$范围内的整数三元组$\\mathbf{m}$，但$\\mathbf{m}=\\mathbf{0}$除外。确保净电荷$\\sum_i q_i$为零，从而不存在零模式。\n\n- Ewald求和：使用分裂参数$\\alpha > 0$实现传统的三维Ewald分解。总电势是实空间贡献和倒易空间贡献之和。实空间求和必须通过实空间截断$r_{\\mathrm{cut}}$进行截断，包括所有晶格平移矢量$\\mathbf{n}L$（其中$\\mathbf{n}\\in \\mathbb{Z}^3$），使得计算点与平移后电荷位置之间的距离不大于$r_{\\mathrm{cut}}$。倒易空间求和必须由$m_{\\max}$定义的同一组有限非零RLV进行截断。由于计算点不会与任何电荷位置重合，您不得包括任何自相互作用校正。\n\n所有计算和报告都必须使用与$4\\pi\\epsilon_0=1$一致的约化静电单位，长度以晶格参数$a$为单位进行测量，在每个测试中我们将其设置为等于晶胞边长$L$。以数值形式表示静电势$\\phi(\\mathbf{r})$，不带任何单位符号；即，使用上述的约化单位制。\n\n严格按照所述从第一性原理实现这两种方法。不要使用或假设任何现成的简化公式。明确定义并使用倒易晶格矢量和晶格平移。使用稳健的数值处理方法以避免奇异点，并确保在所选截断范围内收敛。\n\n对于每个测试用例，您的程序必须计算傅里叶空间电势$\\phi_{\\mathrm{F}}(\\mathbf{r})$、Ewald电势$\\phi_{\\mathrm{E}}(\\mathbf{r})$、绝对差$\\Delta = |\\phi_{\\mathrm{F}}(\\mathbf{r}) - \\phi_{\\mathrm{E}}(\\mathbf{r})|$，以及一个布尔值，指示$\\Delta$是否小于或等于给定的容差。\n\n测试套件：\n实现以下三个测试用例。在每个用例中，电荷以基本电荷$e$为单位表示，位置以晶胞边长$L$为单位表示。\n\n- 测试用例 $1$（一般情况）：\n    - 晶胞边长：$L = 10.0$\n    - 电荷：$q = [ +1.0, -1.0 ]$\n    - 位置：$\\mathbf{r}_1 = (2.0, 2.0, 2.0)$, $\\mathbf{r}_2 = (7.0, 5.0, 3.0)$\n    - 计算点：$\\mathbf{r} = (1.0, 8.0, 4.0)$\n    - 倒易空间截断：$m_{\\max} = 7$\n    - Ewald分裂参数：$\\alpha = 0.35$\n    - 实空间截断：$r_{\\mathrm{cut}} = 15.0$\n    - 容差：$\\mathrm{tol} = 1.0\\times 10^{-6}$\n\n- 测试用例 $2$（近边界计算点）：\n    - 晶胞边长：$L = 10.0$\n    - 电荷：$q = [ +1.0, -1.0 ]$\n    - 位置：$\\mathbf{r}_1 = (2.0, 2.0, 2.0)$, $\\mathbf{r}_2 = (7.0, 5.0, 3.0)$\n    - 计算点：$\\mathbf{r} = (0.1, 9.9, 9.9)$\n    - 倒易空间截断：$m_{\\max} = 9$\n    - Ewald分裂参数：$\\alpha = 0.45$\n    - 实空间截断：$r_{\\mathrm{cut}} = 18.0$\n    - 容差：$\\mathrm{tol} = 1.0\\times 10^{-6}$\n\n- 测试用例 $3$（对称抵消边界情况）：\n    - 晶胞边长：$L = 10.0$\n    - 电荷：$q = [ +1.0, -1.0 ]$\n    - 位置：$\\mathbf{r}_1 = (2.0, 2.0, 2.0)$, $\\mathbf{r}_2 = (8.0, 8.0, 8.0)$\n    - 计算点：$\\mathbf{r} = (5.0, 5.0, 5.0)$\n    - 倒易空间截断：$m_{\\max} = 10$\n    - Ewald分裂参数：$\\alpha = 0.40$\n    - 实空间截断：$r_{\\mathrm{cut}} = 20.0$\n    - 容差：$\\mathrm{tol} = 1.0\\times 10^{-7}$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，列表由每个测试用例的四元素列表组成，每个列表的形式为$[\\phi_{\\mathrm{F}},\\phi_{\\mathrm{E}},\\Delta,\\mathrm{pass}]$，并用方括号括起来，不含空格。例如：$[[\\phi_F^{(1)},\\phi_E^{(1)},\\Delta^{(1)},\\mathrm{pass}^{(1)}],[\\phi_F^{(2)},\\phi_E^{(2)},\\Delta^{(2)},\\mathrm{pass}^{(2)}],[\\phi_F^{(3)},\\phi_E^{(3)},\\Delta^{(3)},\\mathrm{pass}^{(3)}]]$。\n\n本任务不使用角度。除了默认的浮点表示外，不需要进行四舍五入。通过确认每个测试中的净电荷为零，并且计算点不与任何电荷位置或其周期性映像精确重合，来确保科学真实性。",
            "solution": "该问题已经过验证，被确定为一个适定的、科学上合理的、陈述完整的问题。它要求实现并数值比较两种计算三维周期性系统中静电势的基本方法：泊松方程的直接傅里叶空间解法和Ewald求和法。\n\n两种方法的理论基础都是泊松方程，在指定的约化静电单位制（$4\\pi\\epsilon_0 = 1$）中，其形式为：\n$$ \\nabla^2 \\phi(\\mathbf{r}) = -4\\pi \\rho(\\mathbf{r}) $$\n此处，$\\phi(\\mathbf{r})$是位置$\\mathbf{r}$处的静电势，$\\rho(\\mathbf{r})$是电荷密度。对于一个边长为$L$的周期性立方晶胞内的$N$个点电荷$q_i$（位于$\\mathbf{r}_i$），电荷密度由$\\rho(\\mathbf{r}) = \\sum_{i=1}^{N} q_i \\delta(\\mathbf{r}-\\mathbf{r}_i)$给出。所有计算均在周期性边界条件下进行。\n\n### 方法1：傅里叶空间解法\n\n在周期性系统中，任何足够平滑的函数都可以用傅里叶级数表示。我们将电势$\\phi(\\mathbf{r})$和电荷密度$\\rho(\\mathbf{r})$都进行展开：\n$$ \\phi(\\mathbf{r}) = \\sum_{\\mathbf{k}} \\hat{\\phi}(\\mathbf{k}) e^{i \\mathbf{k} \\cdot \\mathbf{r}} \\quad \\text{和} \\quad \\rho(\\mathbf{r}) = \\sum_{\\mathbf{k}} \\hat{\\rho}(\\mathbf{k}) e^{i \\mathbf{k} \\cdot \\mathbf{r}} $$\n求和遍历倒易晶格矢量（RLV）集合$\\mathbf{k} = \\frac{2\\pi}{L}\\mathbf{m}$，其中$\\mathbf{m} = (m_x, m_y, m_z)$是一个整数三元组。电荷密度的傅里叶系数$\\hat{\\rho}(\\mathbf{k})$计算如下：\n$$ \\hat{\\rho}(\\mathbf{k}) = \\frac{1}{V} \\int_V \\rho(\\mathbf{r}) e^{-i \\mathbf{k} \\cdot \\mathbf{r}} d^3\\mathbf{r} = \\frac{1}{V} \\sum_{i=1}^{N} q_i e^{-i \\mathbf{k} \\cdot \\mathbf{r}_i} $$\n其中$V=L^3$是晶胞体积。我们定义结构因子$S(\\mathbf{k}) = \\sum_{i=1}^{N} q_i e^{-i \\mathbf{k} \\cdot \\mathbf{r}_i}$，因此$\\hat{\\rho}(\\mathbf{k}) = S(\\mathbf{k})/V$。\n\n将傅里叶级数代入泊松方程，并使用$\\nabla^2 e^{i \\mathbf{k} \\cdot \\mathbf{r}} = -|\\mathbf{k}|^2 e^{i \\mathbf{k} \\cdot \\mathbf{r}} = -k^2 e^{i \\mathbf{k} \\cdot \\mathbf{r}}$，我们得到傅里叶系数的代数关系：\n$$ -k^2 \\hat{\\phi}(\\mathbf{k}) = -4\\pi \\hat{\\rho}(\\mathbf{k}) \\implies \\hat{\\phi}(\\mathbf{k}) = \\frac{4\\pi}{k^2} \\hat{\\rho}(\\mathbf{k}) = \\frac{4\\pi}{V k^2} S(\\mathbf{k}) $$\n此关系对所有$\\mathbf{k} \\neq \\mathbf{0}$有效。对于$\\mathbf{k}=\\mathbf{0}$，该方程要求$\\hat{\\rho}(\\mathbf{0})=0$，这意味着电荷中性（$\\sum_i q_i=0$），所有测试用例都满足此条件。电势的$\\mathbf{k}=\\mathbf{0}$分量$\\hat{\\phi}(\\mathbf{0})$代表平均电势，通常设为零。\n\n通过对指定截断$m_{\\max}$内的所有非零RLV求和来重构电势$\\phi_{\\mathrm{F}}(\\mathbf{r})$：\n$$ \\phi_{\\mathrm{F}}(\\mathbf{r}) = \\sum_{\\mathbf{k} \\neq \\mathbf{0}} \\hat{\\phi}(\\mathbf{k}) e^{i \\mathbf{k} \\cdot \\mathbf{r}} = \\frac{4\\pi}{V} \\sum_{\\mathbf{k} \\neq \\mathbf{0}} \\frac{S(\\mathbf{k})}{k^2} e^{i \\mathbf{k} \\cdot \\mathbf{r}} = \\frac{4\\pi}{V} \\sum_{\\mathbf{k} \\neq \\mathbf{0}} \\frac{1}{k^2} \\sum_{i=1}^{N} q_i e^{i \\mathbf{k} \\cdot (\\mathbf{r} - \\mathbf{r}_i)} $$\n对$\\mathbf{k}$的求和是针对所有分量在$[-m_{\\max}, +m_{\\max}]$范围内的整数矢量$\\mathbf{m}$进行的，不包括$\\mathbf{m}=\\mathbf{0}$。\n\n### 方法2：Ewald求和\n\nEwald方法通过使用恒等式$1 = \\mathrm{erfc}(\\alpha r) + \\mathrm{erf}(\\alpha r)$将库仑势$1/r$分裂为短程和长程部分，从而提供一个更快速收敛的级数，其中$\\alpha$是分裂参数：\n$$ \\phi(\\mathbf{r}) = \\sum_{i=1}^N \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3} \\frac{q_i}{|\\mathbf{r}-\\mathbf{r}_i-\\mathbf{n}L|} = \\phi_{\\mathrm{real}}(\\mathbf{r}) + \\phi_{\\mathrm{recip}}(\\mathbf{r}) $$\n其中$\\mathbf{n}L$是晶格平移矢量。\n\n1.  **实空间贡献（$\\phi_{\\mathrm{real}}$）**：涉及互补误差函数$\\mathrm{erfc}$的短程部分在实空间中快速收敛。其对电势的贡献为：\n    $$ \\phi_{\\mathrm{real}}(\\mathbf{r}) = \\sum_{i=1}^N \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3} q_i \\frac{\\mathrm{erfc}(\\alpha |\\mathbf{r} - \\mathbf{r}_i - \\mathbf{n}L|)}{|\\mathbf{r} - \\mathbf{r}_i - \\mathbf{n}L|} $$\n    此求和通过只包含距离$|\\mathbf{r} - \\mathbf{r}_i - \\mathbf{n}L|$不超过实空间截断$r_{\\mathrm{cut}}$的项来进行截断。由于计算点$\\mathbf{r}$不与任何电荷位置$\\mathbf{r}_i$或其周期性映像重合，分母永远不为零。\n\n2.  **倒易空间贡献（$\\phi_{\\mathrm{recip}}$）**：涉及误差函数$\\mathrm{erf}$的长程部分是平滑变化的，并且在倒易空间中可以高效计算。该贡献等效于一组平滑的高斯电荷分布所产生的电势，这些高斯电荷分布抵消了点电荷的长程部分。其推导逻辑与傅里叶空间方法相同，但在结构因子中增加了一个高斯因子。最终的电势为：\n    $$ \\phi_{\\mathrm{recip}}(\\mathbf{r}) = \\frac{4\\pi}{V} \\sum_{\\mathbf{k}\\neq\\mathbf{0}} \\frac{e^{-k^2 / (4\\alpha^2)}}{k^2} S(\\mathbf{k}) e^{i \\mathbf{k} \\cdot \\mathbf{r}} = \\frac{4\\pi}{V} \\sum_{\\mathbf{k}\\neq\\mathbf{0}} \\frac{e^{-k^2 / (4\\alpha^2)}}{k^2} \\sum_{i=1}^{N} q_i e^{i\\mathbf{k} \\cdot (\\mathbf{r} - \\mathbf{r}_i)} $$\n    求和使用与傅里叶方法中相同的倒易空间截断$m_{\\max}$进行截断。问题陈述中关于省略自相互作用校正的指令被解释为在与任何电荷位置都不同的场点$\\mathbf{r}$处计算电势，从而避免了粒子对其自身电势的问题。标准的Ewald电势公式$\\phi(\\mathbf{r})$是直接求和$\\phi_{\\mathrm{E}}(\\mathbf{r}) = \\phi_{\\mathrm{real}}(\\mathbf{r}) + \\phi_{\\mathrm{recip}}(\\mathbf{r})$。\n\n### 算法实现\n\n实现包含两个主要函数，每个方法一个。对于这两种方法，倒易空间求和通过遍历整数矢量$\\mathbf{m}$来执行，其中每个分量$m_x, m_y, m_z$的范围从$-m_{\\max}$到$+m_{\\max}$，并跳过$\\mathbf{m}=\\mathbf{0}$。对于Ewald实空间求和，遍历的是晶格矢量$\\mathbf{n}$，其中每个分量的安全范围由截断$r_{\\mathrm{cut}}$和晶胞长度$L$确定。为简化起见，涉及$e^{i\\theta}$的求和使用复数算术，并取最终结果的实部，因为由于对称性，总和必须是实数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erfc\nimport itertools\n\ndef compute_fourier_potential(L, charges, positions, r_eval, m_max):\n    \"\"\"\n    Computes the electrostatic potential using the Fourier-space method.\n    \"\"\"\n    V = L**3\n    potential_f = 0.0 + 0.0j\n    \n    positions = np.array(positions)\n    r_eval = np.array(r_eval)\n    \n    m_range = range(-m_max, m_max + 1)\n    m_vectors = itertools.product(m_range, m_range, m_range)\n\n    for m in m_vectors:\n        if m == (0, 0, 0):\n            continue\n            \n        m_vec = np.array(m)\n        k_vec = (2 * np.pi / L) * m_vec\n        k_sq = np.dot(k_vec, k_vec)\n\n        # Structure factor S(k)\n        s_k = 0.0 + 0.0j\n        for q, r_i in zip(charges, positions):\n            s_k += q * np.exp(-1j * np.dot(k_vec, r_i))\n            \n        term = (4 * np.pi / V) * (s_k / k_sq) * np.exp(1j * np.dot(k_vec, r_eval))\n        potential_f += term\n        \n    return potential_f.real\n\ndef compute_ewald_potential(L, charges, positions, r_eval, m_max, alpha, r_cut):\n    \"\"\"\n    Computes the electrostatic potential using the Ewald summation method.\n    \"\"\"\n    V = L**3\n    \n    positions = np.array(positions)\n    r_eval = np.array(r_eval)\n\n    # --- Reciprocal space contribution ---\n    potential_recip = 0.0 + 0.0j\n    m_range = range(-m_max, m_max + 1)\n    m_vectors = itertools.product(m_range, m_range, m_range)\n\n    for m in m_vectors:\n        if m == (0, 0, 0):\n            continue\n            \n        m_vec = np.array(m)\n        k_vec = (2 * np.pi / L) * m_vec\n        k_sq = np.dot(k_vec, k_vec)\n        \n        # Structure factor S(k)\n        s_k = 0.0 + 0.0j\n        for q, r_i in zip(charges, positions):\n            s_k += q * np.exp(-1j * np.dot(k_vec, r_i))\n\n        term = (4 * np.pi / V) * (s_k / k_sq) * np.exp(-k_sq / (4 * alpha**2)) * np.exp(1j * np.dot(k_vec, r_eval))\n        potential_recip += term\n\n    # --- Real space contribution ---\n    potential_real = 0.0\n    \n    # Determine range for lattice vectors n\n    n_max = int(np.ceil(r_cut / L)) + 1\n    n_range = range(-n_max, n_max + 1)\n    n_vectors = itertools.product(n_range, n_range, n_range)\n\n    # Storing n vectors to iterate over them for each charge\n    n_vec_list = list(n_vectors)\n\n    for q, r_i in zip(charges, positions):\n        for n in n_vec_list:\n            n_vec = np.array(n)\n            nL = n_vec * L\n            \n            dist_vec = r_eval - (r_i + nL)\n            dist = np.linalg.norm(dist_vec)\n            \n            if dist > 0 and dist = r_cut:\n                potential_real += q * erfc(alpha * dist) / dist\n\n    total_potential = potential_recip.real + potential_real\n    return total_potential\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"L\": 10.0, \"q\": [1.0, -1.0], \n            \"pos\": [[2.0, 2.0, 2.0], [7.0, 5.0, 3.0]],\n            \"r_eval\": [1.0, 8.0, 4.0],\n            \"m_max\": 7, \"alpha\": 0.35, \"r_cut\": 15.0,\n            \"tol\": 1.0e-6\n        },\n        {\n            \"L\": 10.0, \"q\": [1.0, -1.0], \n            \"pos\": [[2.0, 2.0, 2.0], [7.0, 5.0, 3.0]],\n            \"r_eval\": [0.1, 9.9, 9.9],\n            \"m_max\": 9, \"alpha\": 0.45, \"r_cut\": 18.0,\n            \"tol\": 1.0e-6\n        },\n        {\n            \"L\": 10.0, \"q\": [1.0, -1.0], \n            \"pos\": [[2.0, 2.0, 2.0], [8.0, 8.0, 8.0]],\n            \"r_eval\": [5.0, 5.0, 5.0],\n            \"m_max\": 10, \"alpha\": 0.40, \"r_cut\": 20.0,\n            \"tol\": 1.0e-7\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        phi_f = compute_fourier_potential(\n            case[\"L\"], case[\"q\"], case[\"pos\"], case[\"r_eval\"], case[\"m_max\"]\n        )\n        phi_e = compute_ewald_potential(\n            case[\"L\"], case[\"q\"], case[\"pos\"], case[\"r_eval\"], \n            case[\"m_max\"], case[\"alpha\"], case[\"r_cut\"]\n        )\n        \n        delta = abs(phi_f - phi_e)\n        passed = delta = case[\"tol\"]\n        \n        results.append(f\"[{phi_f:.10f},{phi_e:.10f},{delta:.10f},{str(passed).lower()}]\")\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在分子动力学等模拟中，准确计算粒子间的作用力是驱动系统演化的核心。本练习  将带您从埃瓦尔德能量表达式出发，运用矢量微积分推导作用在每个粒子上的力。通过推导实空间部分的力贡献，您将掌握将一个复杂的能量表达式转化为可在模拟中直接使用的解析力公式的关键技能。",
            "id": "3821687",
            "problem": "考虑一个三维周期性体系，其中包含 $N$ 个点电荷 $\\{q_i\\}_{i=1}^N$，其位置为 $\\{\\mathbf{r}_i\\}_{i=1}^N$，位于由晶格矢量 $\\mathbf{a}_1$、$\\mathbf{a}_2$ 和 $\\mathbf{a}_3$ 张成的原胞内。令 $\\mathbf{t}_{\\mathbf{n}} = n_1 \\mathbf{a}_1 + n_2 \\mathbf{a}_2 + n_3 \\mathbf{a}_3$ 表示一个晶格平移，其中 $\\mathbf{n}=(n_1,n_2,n_3)\\in\\mathbb{Z}^3$。对于屏蔽参数 $\\alpha0$，Ewald 分裂静电能的实空间部分为\n$$\nE^{\\text{real}}(\\alpha) = \\frac{1}{2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_i q_j \\,\\phi\\!\\left(R_{ij\\mathbf{n}};\\alpha\\right),\n$$\n其中 $\\phi(R;\\alpha) = \\operatorname{erfc}(\\alpha R)/R$, $R_{ij\\mathbf{n}} = \\left| \\mathbf{R}_{ij\\mathbf{n}} \\right|$，且 $\\mathbf{R}_{ij\\mathbf{n}}=\\mathbf{r}_i-\\mathbf{r}_j+\\mathbf{t}_{\\mathbf{n}}$。晶格求和上的撇号表示排除 $i=j$ 且 $\\mathbf{n}=\\mathbf{0}$ 的项。这里的 $\\operatorname{erfc}$ 是互补误差函数 (complementary error function, erfc)。\n\n从点电荷之间的库仑相互作用、上述 $E^{\\text{real}}(\\alpha)$ 的定义以及标准矢量微积分出发，推导由 Ewald 实空间项产生的对粒子 $i$ 的力，\n$$\n\\mathbf{F}_i^{\\text{real}}(\\alpha) = -\\frac{\\partial E^{\\text{real}}(\\alpha)}{\\partial \\mathbf{r}_i},\n$$\n并用 $\\operatorname{erfc}$ 和高斯因子给出一个 $\\mathbf{F}_i^{\\text{real}}(\\alpha)$ 的显式闭合形式解析表达式。将您的最终答案表示为一个包含对粒子和晶格矢量求和的单一简化解析表达式。不需要进行数值计算。您的最终表达式应适用于一般的三斜晶胞，并且必须包含与上述带撇号的求和约定一致的所有周期性镜像的贡献。除所述内容外，不要假定任何特定的截断或对称性。最终答案必须是单个符号数学表达式。",
            "solution": "目标是通过计算实空间 Ewald 能量 $E^{\\text{real}}(\\alpha)$ 相对于粒子位置矢量 $\\mathbf{r}_i$ 的负梯度来推导粒子 $i$ 所受的力 $\\mathbf{F}_i^{\\text{real}}(\\alpha)$。该力定义为：\n$$\n\\mathbf{F}_i^{\\text{real}}(\\alpha) = -\\frac{\\partial E^{\\text{real}}(\\alpha)}{\\partial \\mathbf{r}_i} = -\\nabla_{\\mathbf{r}_i} E^{\\text{real}}(\\alpha)\n$$\n实空间能量由下式给出：\n$$\nE^{\\text{real}}(\\alpha) = \\frac{1}{2} \\sum_{j=1}^{N} \\sum_{k=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_j q_k \\,\\phi\\!\\left(R_{jk\\mathbf{n}}\\right)\n$$\n此处求和使用了另一组索引 $(j,k)$，以避免与正在计算其受力的粒子索引 $i$ 混淆。带撇号的求和表示排除 $j=k$ 且 $\\mathbf{n}=\\mathbf{0}$ 对应的项。相互作用势为 $\\phi(R) = \\operatorname{erfc}(\\alpha R)/R$，距离为 $R_{jk\\mathbf{n}} = |\\mathbf{R}_{jk\\mathbf{n}}| = |\\mathbf{r}_j - \\mathbf{r}_k + \\mathbf{t}_{\\mathbf{n}}|$。\n\n我们可以将梯度算子移到求和符号内部：\n$$\n\\mathbf{F}_i^{\\text{real}}(\\alpha) = -\\frac{1}{2} \\sum_{j=1}^{N} \\sum_{k=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_j q_k \\nabla_{\\mathbf{r}_i} \\phi\\!\\left(R_{jk\\mathbf{n}}\\right)\n$$\n势 $\\phi(R_{jk\\mathbf{n}})$ 的梯度可使用链式法则求得：\n$$\n\\nabla_{\\mathbf{r}_i} \\phi(R_{jk\\mathbf{n}}) = \\frac{d\\phi(R_{jk\\mathbf{n}})}{dR_{jk\\mathbf{n}}} \\nabla_{\\mathbf{r}_i} R_{jk\\mathbf{n}}\n$$\n首先，我们计算距离的梯度 $R_{jk\\mathbf{n}} = \\sqrt{\\mathbf{R}_{jk\\mathbf{n}} \\cdot \\mathbf{R}_{jk\\mathbf{n}}}$。\n$$\n\\nabla_{\\mathbf{r}_i} R_{jk\\mathbf{n}} = \\frac{1}{2 R_{jk\\mathbf{n}}} \\nabla_{\\mathbf{r}_i} (\\mathbf{R}_{jk\\mathbf{n}} \\cdot \\mathbf{R}_{jk\\mathbf{n}}) = \\frac{1}{R_{jk\\mathbf{n}}} (\\nabla_{\\mathbf{r}_i} \\mathbf{R}_{jk\\mathbf{n}}^T) \\mathbf{R}_{jk\\mathbf{n}}\n$$\n矢量 $\\mathbf{R}_{jk\\mathbf{n}} = \\mathbf{r}_j - \\mathbf{r}_k + \\mathbf{t}_{\\mathbf{n}}$ 关于 $\\mathbf{r}_i$ 的梯度是一个二阶张量：\n$$\n\\nabla_{\\mathbf{r}_i} \\mathbf{R}_{jk\\mathbf{n}} = \\delta_{ij} \\mathbf{I} - \\delta_{ik} \\mathbf{I}\n$$\n其中 $\\mathbf{I}$ 是单位张量，$\\delta_{ab}$ 是克罗内克 δ (Kronecker delta)。因此，\n$$\n\\nabla_{\\mathbf{r}_i} R_{jk\\mathbf{n}} = \\frac{1}{R_{jk\\mathbf{n}}} (\\delta_{ij} \\mathbf{I} - \\delta_{ik} \\mathbf{I})^T \\mathbf{R}_{jk\\mathbf{n}} = (\\delta_{ij} - \\delta_{ik}) \\frac{\\mathbf{R}_{jk\\mathbf{n}}}{R_{jk\\mathbf{n}}}\n$$\n将此代回力的表达式中：\n$$\n\\mathbf{F}_i^{\\text{real}}(\\alpha) = -\\frac{1}{2} \\sum_{j=1}^{N} \\sum_{k=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_j q_k \\frac{d\\phi(R_{jk\\mathbf{n}})}{dR_{jk\\mathbf{n}}} (\\delta_{ij} - \\delta_{ik}) \\frac{\\mathbf{R}_{jk\\mathbf{n}}}{R_{jk\\mathbf{n}}}\n$$\n基于克罗内克 δ，该求和可以分为两部分：\n$$\n\\mathbf{F}_i^{\\text{real}}(\\alpha) = -\\frac{1}{2} \\left[ \\sum_{k=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_i q_k \\frac{d\\phi(R_{ik\\mathbf{n}})}{dR_{ik\\mathbf{n}}} \\frac{\\mathbf{R}_{ik\\mathbf{n}}}{R_{ik\\mathbf{n}}} - \\sum_{j=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_j q_i \\frac{d\\phi(R_{ji\\mathbf{n}})}{dR_{ji\\mathbf{n}}} \\frac{\\mathbf{R}_{ji\\mathbf{n}}}{R_{ji\\mathbf{n}}} \\right]\n$$\n在第一项中，对 $(k, \\mathbf{n})$ 的带撇号求和排除了 $(k=i, \\mathbf{n}=\\mathbf{0})$。在第二项中，对 $(j, \\mathbf{n})$ 的带撇号求和排除了 $(j=i, \\mathbf{n}=\\mathbf{0})$。我们通过将求和索引 $j$ 重新标记为 $k$ 来分析第二项求和：\n$$\n-\\sum_{k=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_k q_i \\frac{d\\phi(R_{ki\\mathbf{n}})}{dR_{ki\\mathbf{n}}} \\frac{\\mathbf{R}_{ki\\mathbf{n}}}{R_{ki\\mathbf{n}}}\n$$\n我们使用关系式 $\\mathbf{R}_{ki\\mathbf{n}} = \\mathbf{r}_k - \\mathbf{r}_i + \\mathbf{t}_{\\mathbf{n}} = -(\\mathbf{r}_i - \\mathbf{r}_k - \\mathbf{t}_{\\mathbf{n}}) = -\\mathbf{R}_{ik,-\\mathbf{n}}$。这意味着 $R_{ki\\mathbf{n}} = R_{ik,-\\mathbf{n}}$。由于 $\\phi(R)$ 仅依赖于大小 $R$，其导数 $\\frac{d\\phi}{dR}$ 也遵循此对称性。第二项求和变为：\n$$\n-\\sum_{k=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_k q_i \\frac{d\\phi(R_{ik,-\\mathbf{n}})}{dR_{ik,-\\mathbf{n}}} \\frac{-\\mathbf{R}_{ik,-\\mathbf{n}}}{R_{ik,-\\mathbf{n}}} = \\sum_{k=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_i q_k \\frac{d\\phi(R_{ik,-\\mathbf{n}})}{dR_{ik,-\\mathbf{n}}} \\frac{\\mathbf{R}_{ik,-\\mathbf{n}}}{R_{ik,-\\mathbf{n}}}\n$$\n由于对 $\\mathbf{n}$ 的求和遍历了 $\\mathbb{Z}^3$ 中的所有整数矢量，我们可以将求和变量从 $\\mathbf{n}$ 更改为 $-\\mathbf{n}$。求和限和撇号条件（排除 $k=i, \\mathbf{n}=\\mathbf{0}$）保持不变。因此，第二项求和与第一项求和相同。\n$$\n\\mathbf{F}_i^{\\text{real}}(\\alpha) = -\\frac{1}{2} \\left[ \\left(\\text{First Term}\\right) + \\left(\\text{First Term}\\right) \\right] = - \\sum_{k=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_i q_k \\frac{d\\phi(R_{ik\\mathbf{n}})}{dR_{ik\\mathbf{n}}} \\frac{\\mathbf{R}_{ik\\mathbf{n}}}{R_{ik\\mathbf{n}}}\n$$\n现在，我们计算 $\\phi(R) = \\operatorname{erfc}(\\alpha R)/R$ 的导数。我们使用商法则和导数 $\\frac{d}{dx}\\operatorname{erfc}(x) = -\\frac{2}{\\sqrt{\\pi}}\\exp(-x^2)$。\n$$\n\\frac{d\\phi}{dR} = \\frac{R \\frac{d}{dR}(\\operatorname{erfc}(\\alpha R)) - \\operatorname{erfc}(\\alpha R) \\frac{dR}{dR}}{R^2} = \\frac{R \\left(-\\frac{2\\alpha}{\\sqrt{\\pi}}\\exp(-\\alpha^2 R^2)\\right) - \\operatorname{erfc}(\\alpha R)}{R^2}\n$$\n$$\n\\frac{d\\phi}{dR} = - \\frac{2\\alpha}{\\sqrt{\\pi}} \\frac{\\exp(-\\alpha^2 R^2)}{R} - \\frac{\\operatorname{erfc}(\\alpha R)}{R^2}\n$$\n将此导数代入力的表达式中，并为与问题陈述保持一致，将哑索引 $k$ 更改为 $j$：\n$$\n\\mathbf{F}_i^{\\text{real}}(\\alpha) = - \\sum_{j=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_i q_j \\left( - \\frac{2\\alpha}{\\sqrt{\\pi}} \\frac{\\exp(-\\alpha^2 R_{ij\\mathbf{n}}^2)}{R_{ij\\mathbf{n}}} - \\frac{\\operatorname{erfc}(\\alpha R_{ij\\mathbf{n}})}{R_{ij\\mathbf{n}}^2} \\right) \\frac{\\mathbf{R}_{ij\\mathbf{n}}}{R_{ij\\mathbf{n}}}\n$$\n通过分配负号和合并项来简化表达式：\n$$\n\\mathbf{F}_i^{\\text{real}}(\\alpha) = \\sum_{j=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_i q_j \\left( \\frac{2\\alpha}{\\sqrt{\\pi}} \\frac{\\exp(-\\alpha^2 R_{ij\\mathbf{n}}^2)}{R_{ij\\mathbf{n}}^2} + \\frac{\\operatorname{erfc}(\\alpha R_{ij\\mathbf{n}})}{R_{ij\\mathbf{n}}^3} \\right) \\mathbf{R}_{ij\\mathbf{n}}\n$$\n这是由 Ewald 实空间和产生的对粒子 $i$ 的力的最终闭合形式解析表达式。该求和遍及所有粒子 $j$ 和所有晶格矢量 $\\mathbf{t_n}$，排除了 $j=i$ 且 $\\mathbf{n}=\\mathbf{0}$ 时的自相互作用项。矢量为 $\\mathbf{R}_{ij\\mathbf{n}} = \\mathbf{r}_i - \\mathbf{r}_j + \\mathbf{t}_{\\mathbf{n}}$。",
            "answer": "$$\n\\boxed{\\sum_{j=1}^{N} \\sum_{\\mathbf{n}\\in\\mathbb{Z}^3}^{\\prime} q_i q_j \\left( \\frac{\\operatorname{erfc}(\\alpha R_{ij\\mathbf{n}})}{R_{ij\\mathbf{n}}^3} + \\frac{2\\alpha}{\\sqrt{\\pi}} \\frac{\\exp(-\\alpha^2 R_{ij\\mathbf{n}}^2)}{R_{ij\\mathbf{n}}^2} \\right) \\mathbf{R}_{ij\\mathbf{n}}}\n$$"
        },
        {
            "introduction": "在使用周期性边界条件模拟带电体系（如材料中的点缺陷）时，缺陷会与其周期性镜像发生非物理性的相互作用，导致计算出的能量存在有限尺寸误差。本练习  引导您从基本静电学原理出发，推导这一主要误差项的来源和形式。掌握这一概念对于在实际研究中准确计算带电缺陷的形成能至关重要。",
            "id": "3821689",
            "problem": "考虑一个带电点缺陷的三维周期性模拟，该缺陷嵌入在一个惰性主体中，模型为一个电荷量为 $q$ 的单点电荷，位于边长为 $L$ 的立方超胞的原点。为了在周期性边界条件（PBC）下保持整体电荷中性，体系中包含一个均匀的补偿背景电荷密度 $-q/L^{3}$。长程静电相互作用使用埃瓦尔德求和技术进行评估，其中库仑核被分解为短程（实空间）和长程（倒易空间）分量。假设采用导电（“锡箔”）边界条件，这意味着宏观电场消失，并且倒易空间中的零波矢项被忽略。\n\n从静电学和泊松方程 $\\nabla^{2}\\phi(\\mathbf{r})=-\\rho(\\mathbf{r})/\\varepsilon_{0}$ 出发，并使用点电荷晶格加均匀背景的埃瓦尔德势的标准定义，推导每个超胞的总静电能中，仅由缺陷电荷与其周期性镜像和中和背景相互作用产生的主要有限尺寸贡献。您可以假设该缺陷除了净电荷外没有偶极矩或四极矩（即，将其视为严格的点电荷），并且可以忽略所有高阶多极矩和形状各向异性效应。在埃瓦尔德构造下，表征晶格点上由所有周期性镜像产生的电势的形状依赖晶格和常数，被称为马德隆常数，它是无量纲的，并且仅依赖于晶胞形状和边界条件；对于具有导电边界条件的立方超胞，将此常数表示为 $\\alpha_{M}$。\n\n从第一性原理出发，解释为什么主要的有限尺寸贡献与 $q^{2}/L$ 成比例，并计算出这个主要项关于 $q$、$L$ 和 $\\alpha_{M}$ 的封闭形式解析表达式。在原子单位制下进行计算，其中库仑相互作用为 $1/r$，能量单位为哈特里（Ha），并以哈特里表示您的最终能量。最终答案必须是单一的封闭形式解析表达式。不需要四舍五入。",
            "solution": "该问题要求计算包含单个点电荷 $q$ 和中和背景的周期性超胞静电能的主要有限尺寸贡献。这是计算材料科学中的一个经典问题，其解是用于带电缺陷计算的 Makov-Payne 校正的主导项。\n\n分析始于静电学的基本方程，即泊松方程，它将静电势 $\\phi(\\mathbf{r})$ 与电荷密度 $\\rho(\\mathbf{r})$ 联系起来。问题指定使用原子单位制，其中两个单位电荷相隔一个单位距离时的库仑相互作用能为一个哈特里，力定律为 $1/r^{2}$。这对应于 $1/(4\\pi\\varepsilon_{0}) = 1$ 的单位体系，因此泊松方程的形式为：\n$$\n\\nabla^{2}\\phi(\\mathbf{r}) = -4\\pi\\rho(\\mathbf{r})\n$$\n该体系由一个边长为 $L$、体积为 $V=L^3$ 的立方超胞组成。一个点电荷 $q$ 放置在原点 $\\mathbf{r}=0$ 处。为了在周期性边界条件（PBC）下保持整体电荷中性，加入了一个均匀的背景电荷密度 $\\rho_{\\text{bg}} = -q/V$。因此，无限周期体系的总电荷分布为：\n$$\n\\rho_{\\text{total}}(\\mathbf{r}) = \\sum_{\\mathbf{n}} q\\delta(\\mathbf{r}-\\mathbf{R_n}) - \\frac{q}{V}\n$$\n其中 $\\mathbf{R_n}$ 是立方晶格的晶格矢量，即对于整数 $n_x, n_y, n_z$，$\\mathbf{R_n} = (n_x L, n_y L, n_z L)$，求和遍及所有这些晶格矢量。\n\n每个超胞的总静电能 $E_{\\text{cell}}$ 由能量密度在一个超胞体积上的积分给出：\n$$\nE_{\\text{cell}} = \\frac{1}{2} \\int_{V} \\rho_{\\text{cell}}(\\mathbf{r})\\phi(\\mathbf{r}) d^{3}\\mathbf{r}\n$$\n其中 $\\rho_{\\text{cell}}(\\mathbf{r}) = q\\delta(\\mathbf{r}) - q/V$ 是中心晶胞内的电荷分布，而 $\\phi(\\mathbf{r})$ 是由完整周期性电荷分布 $\\rho_{\\text{total}}(\\mathbf{r})$ 产生的电势。代入 $\\rho_{\\text{cell}}(\\mathbf{r})$ 的表达式：\n$$\nE_{\\text{cell}} = \\frac{1}{2} \\int_{V} \\left( q\\delta(\\mathbf{r}) - \\frac{q}{V} \\right) \\phi(\\mathbf{r}) d^{3}\\mathbf{r} = \\frac{1}{2} \\left( q\\phi(\\mathbf{r}=0) - \\frac{q}{V} \\int_{V} \\phi(\\mathbf{r}) d^{3}\\mathbf{r} \\right)\n$$\n该积分项与超胞中的平均静电势 $\\langle\\phi\\rangle = (1/V) \\int_{V} \\phi(\\mathbf{r}) d^{3}\\mathbf{r}$ 有关。问题指定了“导电”或“锡箔”边界条件，这意味着宏观电场被屏蔽，平均静电势被设为零。这等同于在倒易空间（埃瓦尔德）求和中忽略电势的 $\\mathbf{k}=0$ 分量。因此，我们有 $\\langle\\phi\\rangle=0$。能量表达式简化为：\n$$\nE_{\\text{cell}} = \\frac{1}{2} q\\phi(0)\n$$\n原点处的电势 $\\phi(0)$ 是由整个周期性电荷分布产生的电势。将此电势分解为两部分是很有用的：\n1. 来自原点处点电荷 $q$ 本身的奇异势 $\\phi_{\\text{self}}(\\mathbf{r}) = q/|\\mathbf{r}|$，当 $\\mathbf{r} \\to 0$ 时发散。\n2. 来自体系中所有其他电荷的正则势 $\\phi_{\\text{reg}}(\\mathbf{r})$：位于 $\\mathbf{R_n} \\neq 0$ 处的点电荷的周期性镜像以及均匀的中和背景。\n\n总电势为 $\\phi(\\mathbf{r}) = \\phi_{\\text{self}}(\\mathbf{r}) + \\phi_{\\text{reg}}(\\mathbf{r})$。因此，$E_{\\text{cell}}$ 项包含了点电荷的无限自能，这是一个必须被移除的非物理产物。物理上有意义的量是电荷 $q$ 与其周期性镜像和背景的相互作用能。这个能量构成了主要的有限尺寸误差。我们用 $E_{\\text{FS}}$ 表示这个相互作用能，它是通过在能量表达式中仅使用电势的正则部分得到的。\n$$\nE_{\\text{FS}} = \\frac{1}{2} q \\phi_{\\text{reg}}(0)\n$$\n因子 $1/2$ 至关重要；它源于这样一个事实：相互作用粒子体系的总能量是每个粒子在所有其他粒子场中的势能之和的一半，以避免对成对相互作用进行双重计数。\n\n原点处的正则势 $\\phi_{\\text{reg}}(0)$ 是一个条件收敛晶格和的结果，该晶格和使用埃瓦尔德求和技术进行正则化和计算。此求和的结果取决于晶格几何形状和边界条件。对于给定的晶格结构，该电势与源电荷 $q$ 成正比，与体系的特征长度尺度 $L$ 成反比。我们可以写成：\n$$\n\\phi_{\\text{reg}}(0) = \\frac{\\alpha_M q}{L}\n$$\n这里，$\\alpha_M$ 是一个被称为马德隆常数的无量纲常数，它概括了晶格和的几何结构。问题陈述为具有导电边界条件的立方超胞提供了这个常数。\n\n将这个正则势的表达式代回能量公式，我们得到静电能的主要有限尺寸贡献：\n$$\nE_{\\text{FS}} = \\frac{1}{2} q \\left( \\frac{\\alpha_M q}{L} \\right) = \\frac{\\alpha_M q^2}{2L}\n$$\n这个表达式揭示了为什么主要的有限尺寸校正与 $q^{2}/L$ 成比例。与 $q^2$ 的比例关系是静电相互作用成对性质的直接结果；能量源于缺陷电荷 $q$ 与其镜像（也带电荷 $q$）以及背景（总电荷为 $-q$）的相互作用，使得能量与 $q \\times q = q^2$ 成正比。与 $1/L$ 的比例关系源于库仑势（$1/r$ 依赖性）的量纲分析，其中缺陷与其周期性镜像之间的特征距离是超胞尺寸 $L$。无量纲的马德隆常数 $\\alpha_M$ 解释了无限镜像晶格的具体几何排列。这个 $1/L$ 项代表了缺陷与其周期性镜像之间的人为相互作用，这是在有限尺寸超胞中计算带电缺陷形成能时的主要误差来源。问题要求忽略的高阶项，其比例关系为 $1/L^3$、$1/L^5$ 等，它们源于电荷密度的高阶多极矩的相互作用。",
            "answer": "$$\n\\boxed{\\frac{\\alpha_{M} q^{2}}{2L}}\n$$"
        }
    ]
}