{
    "hands_on_practices": [
        {
            "introduction": "细致平衡是平衡统计力学的基石，但我们如何利用模拟产生的有限数据来验证它呢？第一个练习提供了一种分析动力学蒙特卡洛模拟中原始跃迁数据的手动方法。通过计算经验概率流，你将学习量化与细致平衡条件的偏差，这是验证模拟模型的一项关键技能。",
            "id": "3823225",
            "problem": "对晶体合金中缺陷迁移的粗粒化动力学蒙特卡洛（KMC）模拟，在固定温度下产生了一个代表介观构型 $x \\in \\{1,2,3\\}$ 的三态嵌入式跳跃马尔可夫链。在一次长时间运行中，模拟记录了以下离开次数和定向转移次数：\n- 每个状态的总离开次数：$N_{1} = 5000$，$N_{2} = 3000$，$N_{3} = 2000$。\n- 定向转移次数：$N_{12} = 2500$，$N_{13} = 2500$；$N_{21} = 1500$，$N_{23} = 1500$；$N_{31} = 1600$，$N_{32} = 400$。所有其他未列出的或 $x=y$ 的定向转移次数 $N_{xy}$ 均可视为 $0$，并且对于每个 $x$，这些次数满足 $\\sum_{y \\neq x} N_{xy} = N_{x}$。\n\n从离散时间马尔可夫链、稳态（长时间）分布以及状态间概率流的平衡细致平衡要求的定义出发，按以下步骤进行：\n1. 使用记录的次数，通过 $\\hat{\\pi}(x) = N_{x} / \\sum_{z} N_{z}$ 和 $\\hat{P}(x,y) = N_{xy} / N_{x}$（对于 $x \\neq y$，此处 $\\hat{P}(x,x) = 0$）构建经验稳态分布 $\\hat{\\pi}(x)$ 和经验转移矩阵 $\\hat{P}(x,y)$。\n2. 根据平衡细致平衡要求每对状态之间相反方向的概率流相等的原理，为每个无序对 $\\{x,y\\}$ 定义一个净概率流 $J_{xy}$，并使用你的 $\\hat{\\pi}$ 和 $\\hat{P}$ 计算其值。\n3. 通过标量度量 $D = \\sum_{x<y} |J_{xy}|$，量化对细致平衡的总偏离，并计算其值。",
            "solution": "该问题陈述已经过验证，被认为是合理的。它为分析马尔可夫链模拟的经验数据提供了一套自洽、一致且适定的指令，这些指令基于统计力学和随机过程的标准原理。所有必要的数据和定义均已提供，任务是客观且可通过计算验证的。\n\n解题过程遵循问题中指定的三个步骤。\n\n1.  **经验稳态分布和转移矩阵**\n\n首先，我们通过将每个状态 $x \\in \\{1,2,3\\}$ 的离开次数相加，计算观测到的总离开事件数 $N_{total}$。\n$$N_{total} = \\sum_{z=1}^{3} N_{z} = N_{1} + N_{2} + N_{3} = 5000 + 3000 + 2000 = 10000$$\n\n使用给定的定义，计算每个状态的经验稳态分布 $\\hat{\\pi}(x)$：\n$$\\hat{\\pi}(1) = \\frac{N_{1}}{N_{total}} = \\frac{5000}{10000} = 0.5$$\n$$\\hat{\\pi}(2) = \\frac{N_{2}}{N_{total}} = \\frac{3000}{10000} = 0.3$$\n$$\\hat{\\pi}(3) = \\frac{N_{3}}{N_{total}} = \\frac{2000}{10000} = 0.2$$\n该分布已正确归一化：$\\hat{\\pi}(1) + \\hat{\\pi}(2) + \\hat{\\pi}(3) = 0.5 + 0.3 + 0.2 = 1$。\n\n接下来，我们计算 $x \\neq y$ 时的经验转移概率 $\\hat{P}(x,y)$。问题指定 $\\hat{P}(x,x) = 0$。\n对于状态 1：\n$$\\hat{P}(1,2) = \\frac{N_{12}}{N_{1}} = \\frac{2500}{5000} = 0.5$$\n$$\\hat{P}(1,3) = \\frac{N_{13}}{N_{1}} = \\frac{2500}{5000} = 0.5$$\n对于状态 2：\n$$\\hat{P}(2,1) = \\frac{N_{21}}{N_{2}} = \\frac{1500}{3000} = 0.5$$\n$$\\hat{P}(2,3) = \\frac{N_{23}}{N_{2}} = \\frac{1500}{3000} = 0.5$$\n对于状态 3：\n$$\\hat{P}(3,1) = \\frac{N_{31}}{N_{3}} = \\frac{1600}{2000} = 0.8$$\n$$\\hat{P}(3,2) = \\frac{N_{32}}{N_{3}} = \\frac{400}{2000} = 0.2$$\n\n完整的经验转移矩阵 $\\hat{P}$ 为：\n$$\n\\hat{P} = \\begin{pmatrix}\n0 & 0.5 & 0.5 \\\\\n0.5 & 0 & 0.5 \\\\\n0.8 & 0.2 & 0\n\\end{pmatrix}\n$$\n\n2.  **净概率流计算**\n\n对于处于具有稳态分布 $\\pi$ 的平衡状态的马尔可夫链，细致平衡原理指出，对于任意一对状态 $\\{x,y\\}$，从 $x$ 到 $y$ 的概率流等于从 $y$ 到 $x$ 的概率流。从 $x$ 到 $y$ 的概率流是处于状态 $x$ 并转移到状态 $y$ 的联合概率，由 $\\pi(x)P(x,y)$ 给出。因此，细致平衡条件为：\n$$\\pi(x)P(x,y) = \\pi(y)P(y,x)$$\n\n无序对 $\\{x,y\\}$ 的净概率流 $J_{xy}$ 定义为这两个相反方向概率流之间的差值。我们将其定义为：\n$$J_{xy} = \\pi(x)P(x,y) - \\pi(y)P(y,x)$$\n$J_{xy}$ 的非零值表示违反了细致平衡，意味着这是一个非平衡稳态。我们使用计算出的 $\\hat{\\pi}$ 和 $\\hat{P}$ 来计算经验净概率流。\n\n对于无序对 $\\{1,2\\}$：\n$$J_{12} = \\hat{\\pi}(1)\\hat{P}(1,2) - \\hat{\\pi}(2)\\hat{P}(2,1) = (0.5)(0.5) - (0.3)(0.5) = 0.25 - 0.15 = 0.10$$\n\n对于无序对 $\\{1,3\\}$：\n$$J_{13} = \\hat{\\pi}(1)\\hat{P}(1,3) - \\hat{\\pi}(3)\\hat{P}(3,1) = (0.5)(0.5) - (0.2)(0.8) = 0.25 - 0.16 = 0.09$$\n\n对于无序对 $\\{2,3\\}$：\n$$J_{23} = \\hat{\\pi}(2)\\hat{P}(2,3) - \\hat{\\pi}(3)\\hat{P}(3,2) = (0.3)(0.5) - (0.2)(0.2) = 0.15 - 0.04 = 0.11$$\n\n3.  **对细致平衡偏离的标量度量**\n\n对细致平衡的总偏离 $D$ 是通过对所有唯一（无序）状态对的净概率流的绝对值求和来量化的。无序对为 $\\{1,2\\}$、$\\{1,3\\}$ 和 $\\{2,3\\}$，对应于求和索引 $x<y$。\n$$D = \\sum_{x<y} |J_{xy}| = |J_{12}| + |J_{13}| + |J_{23}|$$\n$$D = 0.10 + 0.09 + 0.11 = 0.30$$\n\n这个非零值 $D=0.30$ 表明，从数据中推断出的经验动力学严重违反了细致平衡。这表明，用于生成数据的粗粒化KMC模型可能不正确，或者模拟尚未达到平衡。例如，它可能在平衡模型中引入了虚假的净概率流，导致 $1 \\to 2 \\to 3 \\to 1$ 方向存在一个环流。具体来说，我们看到 $J_{12} > 0$, $J_{23} > 0$，而 $J_{31} = -J_{13} = -0.09  0$，但它们并不完全平衡，这表明了存在一个复杂的流模式。",
            "answer": "$$\\boxed{0.3000}$$"
        },
        {
            "introduction": "满足细致平衡不仅仅是一个理论上的形式要求，它对模拟效率有着深远的影响。本练习使用一个简单的双态模型，来解析地推导跃迁概率、系统的谱隙以及积分自相关时间之间的联系。这将阐明满足细致平衡的系统如何实现更快的收敛和更可靠的可观测量采样。",
            "id": "3823252",
            "problem": "考虑一个多尺度材料模拟中晶体缺陷的粗粒化双盆模型，其中系统被简化为在两个亚稳盆 $\\{A,B\\}$ 上的离散时间马尔可夫链，其能量分别为 $E_{A}$ 和 $E_{B}$。在每个时间步长，系统以概率 $P(A \\to B) = \\alpha$ 和 $P(B \\to A) = \\beta$ 提议跃迁，其中 $\\alpha \\in (0,1)$ 且 $\\beta \\in (0,1)$。转移矩阵为\n$$\nP \\;=\\; \\begin{pmatrix}\n1-\\alpha  \\alpha \\\\\n\\beta  1-\\beta\n\\end{pmatrix}\n$$\n假设该链通过满足关于玻尔兹曼平稳分布的细致平衡条件，在逆温度 $\\beta_{\\mathrm{th}}$ 下与热平衡保持物理上的一致性，即 $\\pi_{i} \\propto \\exp(-\\beta_{\\mathrm{th}} E_{i})$ 且 $\\pi_{i} P_{ij} = \\pi_{j} P_{ji}$ 对于 $i,j \\in \\{A,B\\}$。令感兴趣的观测量为能量 $H(X_{t}) = E_{X_{t}}$，并假设 $E_{A} \\neq E_{B}$，因此 $H$ 在平稳状态下的方差不为零。定义中心化观测量 $h(X_{t}) = H(X_{t}) - \\mathbb{E}_{\\pi}[H]$ 和归一化自相关函数 $\\rho(t) = \\mathbb{E}_{\\pi}[h(X_{0}) h(X_{t})]/\\mathbb{E}_{\\pi}[h(X_{0})^{2}]$，对于 $t \\in \\mathbb{N}$，其中 $\\mathbb{E}_{\\pi}[\\cdot]$ 表示关于平稳分布的期望。\n\n仅从离散时间马尔可夫链、平稳分布、细致平衡（可逆性）、可逆转移算子的特征分解以及积分自相关时间的定义出发\n$$\n\\tau_{\\mathrm{int}} \\;=\\; 1 + 2 \\sum_{t=1}^{\\infty} \\rho(t)\n$$,\n执行以下步骤：\n\n1. 推导平稳分布 $\\pi$（用 $\\alpha$ 和 $\\beta$ 表示），并检验其是否满足玻尔兹曼形式的细致平衡。\n\n2. 计算 $P$ 的特征值，并将谱隙 $g$ 定义为 $g = 1 - \\sup\\{|\\lambda| : \\lambda \\in \\mathrm{spec}(P), \\lambda \\neq 1\\}$。\n\n3. 利用 $P$ 的可逆性以及对于二状态链，与常数正交的空间是一维的这一事实，表达中心化能量 $h$ 的 $\\rho(t)$，从而获得 $\\tau_{\\mathrm{int}}$ 的闭式表达式。\n\n请提供积分自相关时间 $\\tau_{\\mathrm{int}}$ 关于 $\\alpha$ 和 $\\beta$ 的单一闭式解析表达式作为最终答案。以步数为单位表示 $\\tau_{\\mathrm{int}}$。无需四舍五入。",
            "solution": "该问题要求推导一个二状态离散时间马尔可夫链中能量观测量的积分自相关时间 $\\tau_{\\mathrm{int}}$。推导将按照问题陈述的要求分步进行。\n\n首先，我们解决问题中概述的三个任务：推导平稳分布并验证细致平衡，计算特征值和谱隙，最后推导自相关函数和积分自相关时间。\n\n**1. 平稳分布与细致平衡**\n设平稳分布为 $\\pi = \\begin{pmatrix} \\pi_A  \\pi_B \\end{pmatrix}$。根据定义，它必须满足平稳性条件 $\\pi P = \\pi$，其中 $P$ 是转移矩阵。\n$$\n\\begin{pmatrix} \\pi_A  \\pi_B \\end{pmatrix} \\begin{pmatrix} 1-\\alpha  \\alpha \\\\ \\beta  1-\\beta \\end{pmatrix} = \\begin{pmatrix} \\pi_A  \\pi_B \\end{pmatrix}\n$$\n这个矩阵方程产生两个线性方程：\n1) $\\pi_A (1-\\alpha) + \\pi_B \\beta = \\pi_A$\n2) $\\pi_A \\alpha + \\pi_B (1-\\beta) = \\pi_B$\n\n从方程 1)，我们发现 $-\\pi_A \\alpha + \\pi_B \\beta = 0$，化简为 $\\pi_A \\alpha = \\pi_B \\beta$。这表明两个方程是线性相关的，因为方程 2) 给出的是相同的关系。再加上归一化条件 $\\pi_A + \\pi_B = 1$，我们可以解出 $\\pi_A$ 和 $\\pi_B$。\n将 $\\pi_B = \\pi_A (\\frac{\\alpha}{\\beta})$ 代入归一化方程得：\n$$\n\\pi_A + \\pi_A \\frac{\\alpha}{\\beta} = 1 \\implies \\pi_A \\left(1 + \\frac{\\alpha}{\\beta}\\right) = 1 \\implies \\pi_A \\left(\\frac{\\beta + \\alpha}{\\beta}\\right) = 1\n$$\n这得出 $\\pi_A = \\frac{\\beta}{\\alpha+\\beta}$。\n因此，$\\pi_B = 1 - \\pi_A = 1 - \\frac{\\beta}{\\alpha+\\beta} = \\frac{\\alpha}{\\alpha+\\beta}$。\n所以平稳分布为 $\\pi = \\left( \\frac{\\beta}{\\alpha+\\beta}, \\frac{\\alpha}{\\alpha+\\beta} \\right)$。\n\n接下来，我们检验细致平衡条件 $\\pi_i P_{ij} = \\pi_j P_{ji}$。需要检验的非平凡情况是 $i=A$ 和 $j=B$。我们需要验证是否 $\\pi_A P_{AB} = \\pi_B P_{BA}$。\n转移概率由 $P_{AB} = \\alpha$ 和 $P_{BA} = \\beta$ 给出。\n左边是 $\\pi_A P_{AB} = \\left(\\frac{\\beta}{\\alpha+\\beta}\\right) \\alpha = \\frac{\\alpha\\beta}{\\alpha+\\beta}$。\n右边是 $\\pi_B P_{BA} = \\left(\\frac{\\alpha}{\\alpha+\\beta}\\right) \\beta = \\frac{\\alpha\\beta}{\\alpha+\\beta}$。\n由于两边相等，细致平衡条件得到满足。这意味着该马尔可夫链是可逆的。\n与玻尔兹曼形式 $\\pi_i \\propto \\exp(-\\beta_{\\mathrm{th}} E_i)$ 的一致性要求平稳概率之比与玻尔兹曼因子之比相匹配：\n$$\n\\frac{\\pi_A}{\\pi_B} = \\frac{\\beta/(\\alpha+\\beta)}{\\alpha/(\\alpha+\\beta)} = \\frac{\\beta}{\\alpha}\n$$\n这必须等于 $\\frac{\\exp(-\\beta_{\\mathrm{th}} E_A)}{\\exp(-\\beta_{\\mathrm{th}} E_B)} = \\exp(\\beta_{\\mathrm{th}}(E_B - E_A))$。因此，如果转移率通过 $\\frac{\\beta}{\\alpha} = \\exp(\\beta_{\\mathrm{th}}(E_B - E_A))$ 与能量差相关，则该模型是物理一致的。\n\n**2. 特征值与谱隙**\n转移矩阵 $P$ 的特征值 $\\lambda$ 是特征方程 $\\det(P - \\lambda I) = 0$ 的根。\n$$\n\\det \\begin{pmatrix} 1-\\alpha-\\lambda  \\alpha \\\\ \\beta  1-\\beta-\\lambda \\end{pmatrix} = (1-\\alpha-\\lambda)(1-\\beta-\\lambda) - \\alpha\\beta = 0\n$$\n展开后得到二次方程：\n$$\n\\lambda^2 - (2-\\alpha-\\beta)\\lambda + (1-\\alpha)(1-\\beta) - \\alpha\\beta = 0\n$$\n$$\n\\lambda^2 - (2-\\alpha-\\beta)\\lambda + (1-\\alpha-\\beta+\\alpha\\beta) - \\alpha\\beta = 0\n$$\n$$\n\\lambda^2 - (2-\\alpha-\\beta)\\lambda + (1-\\alpha-\\beta) = 0\n$$\n对于任何随机矩阵，一个特征值总是 $\\lambda_1 = 1$。我们可以验证这一点：$1^2 - (2-\\alpha-\\beta)(1) + (1-\\alpha-\\beta) = 1-2+\\alpha+\\beta+1-\\alpha-\\beta=0$。\n特征值之和等于矩阵的迹，$\\mathrm{Tr}(P) = (1-\\alpha) + (1-\\beta) = 2-\\alpha-\\beta$。\n因此，$\\lambda_1 + \\lambda_2 = 1 + \\lambda_2 = 2-\\alpha-\\beta$，从而得到第二个特征值 $\\lambda_2 = 1-\\alpha-\\beta$。\n因为 $\\alpha \\in (0,1)$ 且 $\\beta \\in (0,1)$，我们有 $0  \\alpha+\\beta  2$，这意味着 $-1  1-\\alpha-\\beta  1$。因此， $|\\lambda_2|  1$。\n\n谱隙 $g$ 定义为 $g = 1 - \\sup\\{|\\lambda| : \\lambda \\in \\mathrm{spec}(P), \\lambda \\neq 1\\}$。\n这里，除 $1$ 之外唯一的特征值是 $\\lambda_2 = 1-\\alpha-\\beta$。所以，$\\sup\\{|\\lambda| : \\lambda \\neq 1\\} = |\\lambda_2| = |1-\\alpha-\\beta|$。\n谱隙为 $g = 1 - |1-\\alpha-\\beta|$。\n\n**3. 自相关函数与积分自相关时间**\n归一化自相关函数定义为 $\\rho(t) = \\mathbb{E}_{\\pi}[h(X_0) h(X_t)] / \\mathbb{E}_{\\pi}[h(X_0)^2]$。项 $\\mathbb{E}_{\\pi}[h(X_0) h(X_t)]$ 可以用转移算子表示。设 $h$ 是一个列向量，表示状态空间上的函数 $h$，$h = \\begin{pmatrix} h(A) \\\\ h(B) \\end{pmatrix}$。在给定初始状态 $i$ 的情况下，时间 $t$ 时 $h$ 的期望值为 $(P^t h)_i$。那么平稳期望为：\n$\\mathbb{E}_{\\pi}[h(X_0) h(X_t)] = \\sum_{i \\in \\{A,B\\}} \\pi_i h(i) (P^t h)_i$。这是内积 $\\langle h, P^t h \\rangle_{\\pi}$。\n\n算子 $P$ 相对于 $\\pi$ 是可逆的。$\\{A,B\\}$ 上的函数空间是二维的。它由 $P$ 的右特征向量张成。对应于 $\\lambda_1=1$ 的特征向量是一个常数向量，$v_1 = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。中心化观测量 $h$ 的定义使其平稳期望为零：$\\mathbb{E}_{\\pi}[h] = \\sum_i \\pi_i h(i) = \\langle \\mathbf{1}, h \\rangle_{\\pi} = 0$。这意味着在由 $\\pi$ 加权的内积中，$h$ 与常数特征向量 $v_1$ 正交。\n\n对于一个二状态系统，与常数正交的函数空间是一维的。这个空间由对应于 $\\lambda_2$ 的第二个特征向量 $v_2$ 张成。因此，函数 $h$ 必须是 $P$ 的一个特征向量，其特征值为 $\\lambda_2$。\n这意味着将转移算子 $P$ 应用于 $h$ 会将 $h$ 缩放 $\\lambda_2$ 倍，即 $Ph = \\lambda_2 h$。依此类推，$P^t h = \\lambda_2^t h$。\n\n现在我们可以计算 $\\rho(t)$ 的分子：\n$$\n\\mathbb{E}_{\\pi}[h(X_0) h(X_t)] = \\langle h, P^t h \\rangle_{\\pi} = \\langle h, \\lambda_2^t h \\rangle_{\\pi} = \\lambda_2^t \\langle h, h \\rangle_{\\pi} = \\lambda_2^t \\mathbb{E}_{\\pi}[h^2]\n$$\n将此代入 $\\rho(t)$ 的定义中：\n$$\n\\rho(t) = \\frac{\\lambda_2^t \\mathbb{E}_{\\pi}[h^2]}{\\mathbb{E}_{\\pi}[h^2]} = \\lambda_2^t = (1-\\alpha-\\beta)^t\n$$\n因为 $E_A \\neq E_B$，方差 $\\mathbb{E}_{\\pi}[h^2]$ 非零，所以这个消去是有效的。\n\n最后，我们使用给定的公式计算积分自相关时间 $\\tau_{\\mathrm{int}}$：\n$$\n\\tau_{\\mathrm{int}} = 1 + 2 \\sum_{t=1}^{\\infty} \\rho(t) = 1 + 2 \\sum_{t=1}^{\\infty} (1-\\alpha-\\beta)^t\n$$\n这个求和是一个公比为 $r = 1-\\alpha-\\beta$ 的几何级数。由于 $|\\lambda_2| = |r|  1$，该级数收敛。几何级数的和是 $\\sum_{k=1}^{\\infty} r^k = \\frac{r}{1-r}$。\n$$\n\\sum_{t=1}^{\\infty} (1-\\alpha-\\beta)^t = \\frac{1-\\alpha-\\beta}{1 - (1-\\alpha-\\beta)} = \\frac{1-\\alpha-\\beta}{\\alpha+\\beta}\n$$\n将此和代回 $\\tau_{\\mathrm{int}}$ 的表达式中：\n$$\n\\tau_{\\mathrm{int}} = 1 + 2 \\left( \\frac{1-\\alpha-\\beta}{\\alpha+\\beta} \\right) = \\frac{\\alpha+\\beta}{\\alpha+\\beta} + \\frac{2 - 2\\alpha - 2\\beta}{\\alpha+\\beta}\n$$\n$$\n\\tau_{\\mathrm{int}} = \\frac{\\alpha+\\beta + 2 - 2\\alpha - 2\\beta}{\\alpha+\\beta} = \\frac{2 - \\alpha - \\beta}{\\alpha+\\beta}\n$$\n这就得到了积分自相关时间关于 $\\alpha$ 和 $\\beta$ 的闭式表达式。\n这个表达式也可以用第二个特征值 $\\lambda_2 = 1-\\alpha-\\beta$ 写成 $\\tau_{\\mathrm{int}} = \\frac{1+\\lambda_2}{1-\\lambda_2}$。",
            "answer": "$$\n\\boxed{\\frac{2 - \\alpha - \\beta}{\\alpha + \\beta}}\n$$"
        },
        {
            "introduction": "由于统计噪声，真实世界的模拟数据产生的跃迁模型往往会轻微违反细致平衡。这个高级练习介绍了一种强大的方法，通过将非可逆模型投影到最近的可逆对应模型上来修正它们。然后，你将通过计算这种修正如何提高材料属性计算的统计精度，来探索其具体益处。",
            "id": "3823192",
            "problem": "在多尺度材料模拟中，使用粗粒化的介观态来近似高温退火过程中局部微观结构基元之间的转变，其中基元的平衡占据率近似均匀。考虑一个在状态空间 $\\{1,2,3\\}$ 上的离散时间马尔可夫链，其经验得到的转移核 $P$ 是不可逆的。目标平稳分布是均匀分布 $\\pi(1)=\\pi(2)=\\pi(3)=\\frac{1}{3}$，这与高温极限一致。给定的核为\n$$\nP \\;=\\;\n\\begin{pmatrix}\n0.2  0.5  0.3 \\\\\n0.3  0.4  0.3 \\\\\n0.5  0.2  0.3\n\\end{pmatrix}\n$$\n为了能够使用马尔可夫链蒙特卡洛（MCMC）方法对关于 $\\pi$ 的材料属性进行无偏平衡采样，该核必须满足细致平衡条件。从可逆马尔可夫链和细致平衡条件的基本定义出发，并利用在保持随机性和以 $\\pi$ 为平稳分布的转移核空间上的最小二乘变分原理，构建一个在加权弗罗贝尼乌斯意义下将 $P$ 最小化调整为关于 $\\pi$ 可逆的核 $\\widetilde{P}$ 的投影。推导该投影的解析形式，并为上述数据计算出显式的 $\\widetilde{P}$。\n\n接下来，考虑一个在三个状态上定义的无量纲归一化材料属性 $f$，其值为 $f(1)=3$，$f(2)=1$ 和 $f(3)=-2$。通过 $g(i)=f(i)-\\sum_{j}\\pi(j)f(j)$ 定义中心化可观测量 $g$。仅使用关于 $L^{2}(\\pi)$ 上可逆马尔可夫算子及其谱表示的核心事实，推导大样本渐近方差常数 $v(f)$ 的表达式，该常数定义为从平稳状态开始的、转移核为 $\\widetilde{P}$ 的马尔可夫链的 $N \\,\\mathrm{Var}\\!\\left(\\frac{1}{N}\\sum_{t=1}^{N} f(X_{t})\\right)$ 的极限。对于上面求得的 $\\widetilde{P}$ 和给定的 $f$，精确计算 $v(f)$，并将你的最终答案表示为单个精确的有理数。不需要四舍五入，最终答案是无量纲的。",
            "solution": "问题分为两部分。第一部分要求将给定的转移核 $P$ 投影到具有特定平稳分布 $\\pi$ 的可逆核空间上，并推导该投影。第二部分要求使用投影后的核计算材料属性的渐近方差。\n\n首先，我们验证问题的有效性。所有给定的信息在科学上是合理的，在数学上是一致的。状态空间为 $\\{1, 2, 3\\}$。给定的转移核是\n$$\nP = \\begin{pmatrix} 0.2  0.5  0.3 \\\\ 0.3  0.4  0.3 \\\\ 0.5  0.2  0.3 \\end{pmatrix}\n$$\n$P$ 的行和为 $1$，因此它是一个有效的随机矩阵。目标平稳分布是均匀分布 $\\pi(i) = 1/3$，对于 $i \\in \\{1, 2, 3\\}$。核 $P$ 关于 $\\pi$ 不是可逆的，因为可逆性要求 $P$ 是对称的（因为 $\\pi$ 是均匀的），而它并非对称矩阵（例如，$P_{12}=0.5 \\neq P_{21}=0.3$）。问题是适定的且内部一致的。\n\n**第一部分：转移核的投影**\n\n我们的任务是找到一个转移核 $\\widetilde{P}$，它在加权弗罗贝尼乌斯意义下与 $P$ 的差异“最小”，并满足特定约束。目标是最小化以下函数：\n$$\nF(\\widetilde{P}) = \\| \\widetilde{P} - P \\|^2_{F,\\pi} = \\sum_{i=1}^3 \\sum_{j=1}^3 \\pi(i) (\\widetilde{P}_{ij} - P_{ij})^2\n$$\n核 $\\widetilde{P}$ 必须对所有 $i,j \\in \\{1,2,3\\}$ 满足以下约束条件：\n1.  非负性：$\\widetilde{P}_{ij} \\ge 0$。\n2.  随机性：$\\sum_j \\widetilde{P}_{ij} = 1$。\n3.  细致平衡（可逆性）：$\\pi(i) \\widetilde{P}_{ij} = \\pi(j) \\widetilde{P}_{ji}$。\n\n细致平衡和随机性条件共同确保了 $\\pi$ 是 $\\widetilde{P}$ 的平稳分布：\n$$\n(\\pi \\widetilde{P})_j = \\sum_i \\pi(i) \\widetilde{P}_{ij} = \\sum_i \\pi(j) \\widetilde{P}_{ji} = \\pi(j) \\sum_i \\widetilde{P}_{ji} = \\pi(j) \\cdot 1 = \\pi(j)\n$$\n因此我们不需要单独强制施加平稳分布条件。\n\n目标函数可以分离为非对角线（$i \\neq j$）和对角线（$i=j$）项。整体最小化可以通过首先在细致平衡约束下对非对角线元素进行最小化，然后设置对角线元素以满足随机性约束来实现。\n\n考虑求和中对于 $i \\neq j$ 的单个对 $(i, j)$ 的项：\n$$\n\\pi(i)(\\widetilde{P}_{ij} - P_{ij})^2 + \\pi(j)(\\widetilde{P}_{ji} - P_{ji})^2\n$$\n对于这对元素，细致平衡约束为 $\\pi(i)\\widetilde{P}_{ij} = \\pi(j)\\widetilde{P}_{ji}$。我们将这个共同的值定义为 $s_{ij}$。那么 $\\widetilde{P}_{ij} = s_{ij}/\\pi(i)$ 且 $\\widetilde{P}_{ji} = s_{ij}/\\pi(j)$。将此代入表达式，我们需要最小化以下关于 $s_{ij}$ 的函数：\n$$\nL(s_{ij}) = \\pi(i)\\left(\\frac{s_{ij}}{\\pi(i)} - P_{ij}\\right)^2 + \\pi(j)\\left(\\frac{s_{ij}}{\\pi(j)} - P_{ji}\\right)^2 = \\frac{1}{\\pi(i)}(s_{ij} - \\pi(i)P_{ij})^2 + \\frac{1}{\\pi(j)}(s_{ij} - \\pi(j)P_{ji})^2\n$$\n为了找到最小值，我们对 $s_{ij}$ 求导并令其为零：\n$$\n\\frac{dL}{ds_{ij}} = \\frac{2}{\\pi(i)}(s_{ij} - \\pi(i)P_{ij}) + \\frac{2}{\\pi(j)}(s_{ij} - \\pi(j)P_{ji}) = 0\n$$\n$$\ns_{ij} \\left( \\frac{1}{\\pi(i)} + \\frac{1}{\\pi(j)} \\right) = P_{ij} + P_{ji}\n$$\n$$\ns_{ij} \\left( \\frac{\\pi(i)+\\pi(j)}{\\pi(i)\\pi(j)} \\right) = P_{ij} + P_{ji}\n$$\n解出 $s_{ij}$ 得：\n$$\ns_{ij} = \\frac{\\pi(i)\\pi(j)}{\\pi(i)+\\pi(j)}(P_{ij} + P_{ji})\n$$\n由此，我们得到 $\\widetilde{P}$ 的非对角线元素：\n$$\n\\widetilde{P}_{ij} = \\frac{s_{ij}}{\\pi(i)} = \\frac{\\pi(j)}{\\pi(i)+\\pi(j)}(P_{ij} + P_{ji}) \\quad \\text{对于 } i \\neq j\n$$\n然后对角线元素 $\\widetilde{P}_{ii}$ 由随机性约束确定：\n$$\n\\widetilde{P}_{ii} = 1 - \\sum_{j \\neq i} \\widetilde{P}_{ij}\n$$\n这个过程定义了唯一的投影 $\\widetilde{P}$。由于所有 $P_{ij}$ 都是非负的，非对角线的 $\\widetilde{P}_{ij}$ 也将是非负的。计算后我们必须检查 $\\widetilde{P}_{ii} \\ge 0$。\n\n对于给定的问题，对所有 $i$ 都有 $\\pi(i) = 1/3$。非对角线元素的公式显著简化为：\n$$\n\\widetilde{P}_{ij} = \\frac{1/3}{1/3+1/3}(P_{ij} + P_{ji}) = \\frac{1}{2}(P_{ij} + P_{ji}) \\quad \\text{对于 } i \\neq j\n$$\n所以，$\\widetilde{P}$ 的非对角线元素是 $P$ 和 $P^T$ 相应元素的平均值。\n使用给定的矩阵 $P$：\n$$\n\\widetilde{P}_{12} = \\widetilde{P}_{21} = \\frac{1}{2}(P_{12} + P_{21}) = \\frac{1}{2}(0.5 + 0.3) = 0.4\n$$\n$$\n\\widetilde{P}_{13} = \\widetilde{P}_{31} = \\frac{1}{2}(P_{13} + P_{31}) = \\frac{1}{2}(0.3 + 0.5) = 0.4\n$$\n$$\n\\widetilde{P}_{23} = \\widetilde{P}_{32} = \\frac{1}{2}(P_{23} + P_{32}) = \\frac{1}{2}(0.3 + 0.2) = 0.25\n$$\n现在我们计算对角线元素：\n$$\n\\widetilde{P}_{11} = 1 - (\\widetilde{P}_{12} + \\widetilde{P}_{13}) = 1 - (0.4 + 0.4) = 0.2\n$$\n$$\n\\widetilde{P}_{22} = 1 - (\\widetilde{P}_{21} + \\widetilde{P}_{23}) = 1 - (0.4 + 0.25) = 0.35\n$$\n$$\n\\widetilde{P}_{33} = 1 - (\\widetilde{P}_{31} + \\widetilde{P}_{32}) = 1 - (0.4 + 0.25) = 0.35\n$$\n所有元素都是非负的，所以这个核是有效的。得到的可逆核为：\n$$\n\\widetilde{P} = \\begin{pmatrix} 0.2  0.4  0.4 \\\\ 0.4  0.35  0.25 \\\\ 0.4  0.25  0.35 \\end{pmatrix}\n$$\n\n**第二部分：渐近方差计算**\n\n对于一个可观测量 $f$，其大样本渐近方差常数 $v(f)$ 由平稳、可逆马尔可夫链的格林-久保（Green-Kubo）公式给出：\n$$\nv(f) = \\sum_{k=-\\infty}^{\\infty} \\mathrm{Cov}_{\\pi}(f(X_0), f(X_k)) = \\mathrm{Var}_{\\pi}(f) + 2 \\sum_{k=1}^{\\infty} \\mathrm{Cov}_{\\pi}(f(X_0), f(X_k))\n$$\n使用中心化可观测量 $g(i) = f(i) - E_{\\pi}[f]$ 进行计算更为方便。\n给定 $f(1)=3, f(2)=1, f(3)=-2$ 和 $\\pi(i)=1/3$：\n$$\nE_{\\pi}[f] = \\sum_j \\pi(j)f(j) = \\frac{1}{3}(3+1-2) = \\frac{2}{3}\n$$\n中心化可观测量为 $g = (f(1)-\\frac{2}{3}, f(2)-\\frac{2}{3}, f(3)-\\frac{2}{3}) = (\\frac{7}{3}, \\frac{1}{3}, -\\frac{8}{3})$。\n方差公式变为 $v(f) = \\langle g, g \\rangle_{\\pi} + 2 \\sum_{k=1}^{\\infty} \\langle g, \\widetilde{P}^k g \\rangle_{\\pi}$，其中内积为 $\\langle u, v \\rangle_{\\pi} = \\sum_i u(i)v(i)\\pi(i)$。\n\n将 $\\widetilde{P}$ 视为在 $\\{1,2,3\\}$ 上的函数空间 $L^2(\\pi)$ 上的一个算子。由于 $\\widetilde{P}$ 关于 $\\pi$ 是可逆的，它在 $L^2(\\pi)$ 上是自伴的。它有一个谱分解，具有实特征值 $1=\\lambda_1 \\ge \\lambda_2 \\ge \\dots$ 和相应的特征向量标准正交基 $\\{u_i\\}$。由于 $g$ 是中心化的，$E_{\\pi}[g]=0$，这意味着 $g$ 与对应于 $\\lambda_1=1$ 的特征向量 $u_1$（常数函数）正交。\n因此，我们可以写出 $g = \\sum_{i \\ge 2} c_i u_i$ ，其中 $c_i = \\langle g, u_i \\rangle_{\\pi}$。\n那么 $\\widetilde{P}^k g = \\sum_{i \\ge 2} \\lambda_i^k c_i u_i$。\n将此代入 $v(f)$ 的公式：\n$$\nv(f) = \\langle \\sum_i c_i u_i, \\sum_j c_j u_j \\rangle_{\\pi} + 2 \\sum_{k=1}^{\\infty} \\langle \\sum_i c_i u_i, \\sum_j \\lambda_j^k c_j u_j \\rangle_{\\pi}\n$$\n$$\nv(f) = \\sum_i c_i^2 + 2 \\sum_{k=1}^{\\infty} \\sum_i \\lambda_i^k c_i^2 = \\sum_i c_i^2 \\left(1 + 2\\sum_{k=1}^{\\infty} \\lambda_i^k \\right)\n$$\n假设对于 $i \\ge 2$ 有 $|\\lambda_i|1$，则几何级数收敛：$\\sum_{k=1}^{\\infty}\\lambda_i^k = \\frac{\\lambda_i}{1-\\lambda_i}$。\n$$\nv(f) = \\sum_{i \\ge 2} c_i^2 \\left(1 + \\frac{2\\lambda_i}{1-\\lambda_i}\\right) = \\sum_{i \\ge 2} c_i^2 \\left(\\frac{1-\\lambda_i+2\\lambda_i}{1-\\lambda_i}\\right) = \\sum_{i \\ge 2} |\\langle g, u_i \\rangle_{\\pi}|^2 \\frac{1+\\lambda_i}{1-\\lambda_i}\n$$\n我们需要求出 $\\widetilde{P}$ 的特征值和特征向量。因为 $\\pi$ 是均匀分布，$\\widetilde{P}$ 是一个对称矩阵，其特征向量关于标准点积是正交的。$L^2(\\pi)$ 内积就是标准点积的 $1/3$ 倍。\n$\\widetilde{P}$ 的特征值（除了 $\\lambda_1=1$）和特征向量是：\n$\\lambda_2=-0.2$：特征向量 $u_2 = (-2, 1, 1)^T$。\n$\\lambda_3=0.1$：特征向量 $u_3 = (0, 1, -1)^T$。\n这些特征向量按要求是正交的。让我们计算在 $L^2(\\pi)$ 中的平方范数：\n$$\n\\|u_2\\|^2_{\\pi} = \\frac{1}{3}((-2)^2+1^2+1^2) = \\frac{6}{3}=2\n$$\n$$\n\\|u_3\\|^2_{\\pi} = \\frac{1}{3}(0^2+1^2+(-1)^2) = \\frac{2}{3}\n$$\n标准正交特征向量是 $\\hat{u}_2=u_2/\\sqrt{2}$ 和 $\\hat{u}_3=u_3/\\sqrt{2/3}$。\n系数是 $c_i^2=|\\langle g, \\hat{u}_i \\rangle_{\\pi}|^2$。\n$$\n\\langle g, u_2 \\rangle_{\\pi} = \\frac{1}{3} \\left( \\frac{7}{3}(-2)+\\frac{1}{3}(1)-\\frac{8}{3}(1) \\right) = \\frac{1}{9}(-14+1-8) = \\frac{-21}{9}=-\\frac{7}{3}\n$$\n$$\nc_2^2 = \\frac{|\\langle g, u_2 \\rangle_{\\pi}|^2}{\\|u_2\\|^2_{\\pi}} = \\frac{(-7/3)^2}{2} = \\frac{49/9}{2} = \\frac{49}{18}\n$$\n$$\n\\langle g, u_3 \\rangle_{\\pi} = \\frac{1}{3} \\left( \\frac{7}{3}(0)+\\frac{1}{3}(1)-\\frac{8}{3}(-1) \\right) = \\frac{1}{9}(1+8) = \\frac{9}{9}=1\n$$\n$$\nc_3^2 = \\frac{|\\langle g, u_3 \\rangle_{\\pi}|^2}{\\|u_3\\|^2_{\\pi}} = \\frac{1^2}{2/3} = \\frac{3}{2}\n$$\n现在我们使用谱表达式计算 $v(f)$：\n$$\nv(f) = c_2^2 \\frac{1+\\lambda_2}{1-\\lambda_2} + c_3^2 \\frac{1+\\lambda_3}{1-\\lambda_3}\n$$\n当 $\\lambda_2 = -0.2 = -1/5$ 且 $\\lambda_3 = 0.1 = 1/10$ 时：\n$$\n\\frac{1+\\lambda_2}{1-\\lambda_2} = \\frac{1+(-1/5)}{1-(-1/5)} = \\frac{4/5}{6/5} = \\frac{2}{3}\n$$\n$$\n\\frac{1+\\lambda_3}{1-\\lambda_3} = \\frac{1+1/10}{1-1/10} = \\frac{11/10}{9/10} = \\frac{11}{9}\n$$\n代入所有值：\n$$\nv(f) = \\frac{49}{18} \\cdot \\frac{2}{3} + \\frac{3}{2} \\cdot \\frac{11}{9} = \\frac{49}{27} + \\frac{11}{6}\n$$\n为了对这些分数求和，我们找到一个公分母，即 $54$：\n$$\nv(f) = \\frac{49 \\cdot 2}{27 \\cdot 2} + \\frac{11 \\cdot 9}{6 \\cdot 9} = \\frac{98}{54} + \\frac{99}{54} = \\frac{98+99}{54} = \\frac{197}{54}\n$$\n最终结果是所要求的精确有理数。",
            "answer": "$$\\boxed{\\frac{197}{54}}$$"
        }
    ]
}