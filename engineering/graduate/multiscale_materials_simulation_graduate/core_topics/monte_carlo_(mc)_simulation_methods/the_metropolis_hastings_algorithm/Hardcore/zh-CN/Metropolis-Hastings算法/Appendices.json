{
    "hands_on_practices": [
        {
            "introduction": "Metropolis-Hastings 算法的核心在于其接受-拒绝规则，该规则确保了马尔可夫链能够收敛到所需的目标分布。第一个练习将让你在一个离散状态空间中，亲手计算接受概率 $\\alpha$。通过完成这个例子 ，你将巩固对目标概率 $\\pi$ 和提议概率 $q$ 如何共同决定一个提议移动的命运的理解。",
            "id": "1962671",
            "problem": "一个计算模拟使用 Metropolis-Hastings 算法来探索蛋白质的构象状态。该模型将蛋白质的结构简化为三个可能的离散状态：状态1、状态2和状态3。模拟的目标是从一个目标平稳分布 $\\pi$ 中生成样本，该分布表示蛋白质处于每个状态的平衡概率。该目标分布由下式给出：\n$\\pi(\\text{State 1}) = 0.1$\n$\\pi(\\text{State 2}) = 0.3$\n$\\pi(\\text{State 3}) = 0.6$\n\n该算法根据一个提议分布 $q(j|i)$，从当前状态 $i$ 提议转移到新状态 $j$。提议机制定义如下：\n- 从状态1，提议转移到状态2的概率为 $0.2$，提议转移到状态3的概率为 $0.8$。\n- 从状态2，提议转移到状态1的概率为 $0.5$，提议转移到状态3的概率为 $0.5$。\n- 从状态3，提议转移到状态1的概率为 $0.1$，提议转移到状态2的概率为 $0.9$。\n\n假设模拟当前处于状态1，并且提议了一个到状态3的转移。计算此特定转移的接受概率。将你的最终答案表示为一个最简分数。",
            "solution": "在 Metropolis-Hastings 算法中，对于从当前状态 $i$ 提议转移到新状态 $j$ 的接受概率为\n$$\n\\alpha_{i \\to j} = \\min\\left(1, \\frac{\\pi(j)\\,q(i \\mid j)}{\\pi(i)\\,q(j \\mid i)}\\right).\n$$\n对于从状态1到状态3的提议转移，使用给定的目标概率和提议概率。将给定的小数转换为精确分数，\n$$\n\\pi(\\text{State 3}) = \\frac{3}{5}, \\quad \\pi(\\text{State 1}) = \\frac{1}{10}, \\quad q(3 \\mid 1) = \\frac{4}{5}, \\quad q(1 \\mid 3) = \\frac{1}{10}.\n$$\n代入接受率公式：\n$$\n\\frac{\\pi(3)\\,q(1 \\mid 3)}{\\pi(1)\\,q(3 \\mid 1)} = \\frac{\\left(\\frac{3}{5}\\right)\\left(\\frac{1}{10}\\right)}{\\left(\\frac{1}{10}\\right)\\left(\\frac{4}{5}\\right)} = \\frac{\\frac{3}{50}}{\\frac{4}{50}} = \\frac{3}{4}.\n$$\n因此，\n$$\n\\alpha_{1 \\to 3} = \\min\\left(1, \\frac{3}{4}\\right) = \\frac{3}{4}.\n$$",
            "answer": "$$\\boxed{\\frac{3}{4}}$$"
        },
        {
            "introduction": "在实践中，MH 采样器的效率关键取决于提议分布的选择，尤其是在随机游走采样器中的步长。过高或过低的接受率都预示着对状态空间的探索效率低下。这个问题  展示了一个常见的诊断情景——接受率几乎为零——并要求你找出提议方差的根本问题，从而阐释 MCMC 调优中的“金发姑娘”难题（指寻求恰到好处的平衡）。",
            "id": "1962620",
            "problem": "统计学家 Jordan 正在使用 Metropolis-Hastings 算法从一维后验概率分布 $p(\\theta | D)$ 中生成样本，其中 $\\theta$ 是一个模型参数， $D$ 代表观测数据。\n\n已知目标分布 $p(\\theta | D)$ 是单峰的（只有一个峰值）并且近似对称。\n\nJordan 实现了一个随机游走 Metropolis 采样器。在马尔可夫链的每一步 $i$，给定当前状态 $\\theta_i$，从一个以当前状态为中心的正态分布中提议一个候选状态 $\\theta'$：$\\theta' \\sim \\mathcal{N}(\\theta_i, \\sigma_p^2)$。参数 $\\sigma_p^2$ 是这个提议分布的方差，Jordan 必须设置它。\n\n在运行采样器 100,000 次迭代后，Jordan 观察到链几乎没有从其起始位置移动，并且计算出的总接受率小于 0.1%。这表明几乎所有提议的移动都被拒绝了。\n\n以下哪个陈述最好地解释了 Jordan 在选择提议分布时可能遇到的问题？\n\nA. 提议方差 $\\sigma_p^2$ 太大。\nB. 提议方差 $\\sigma_p^2$ 太小。\nC. 提议分布不是对称的，即 $q(\\theta'|\\theta_i) \\neq q(\\theta_i|\\theta')$.\nD. 提议分布的均值是固定的，而不是以当前状态 $\\theta_i$ 为中心。\nE. 目标分布 $p(\\theta|D)$ 没有被归一化，意味着它在所有 $\\theta$ 上的积分不等于 1。",
            "solution": "我们考虑一个提议为 $q(\\theta'|\\theta_{i}) = \\mathcal{N}(\\theta_{i}, \\sigma_{p}^{2})$ 的随机游走 Metropolis 算法。Metropolis-Hastings 的接受概率为\n$$\n\\alpha(\\theta_{i}, \\theta') = \\min\\left(1, \\frac{p(\\theta'|D)}{p(\\theta_{i}|D)} \\cdot \\frac{q(\\theta_{i}|\\theta')}{q(\\theta'|\\theta_{i})}\\right).\n$$\n对于以当前状态为中心的高斯随机游走，其提议是对称的：\n$$\nq(\\theta'|\\theta_{i}) = q(\\theta_{i}|\\theta') \\quad \\text{因为} \\quad q(\\theta'|\\theta_{i}) \\propto \\exp\\left(-\\frac{(\\theta'-\\theta_{i})^{2}}{2\\sigma_{p}^{2}}\\right),\n$$\n它只取决于 $(\\theta'-\\theta_{i})^{2}$。因此\n$$\n\\alpha(\\theta_{i}, \\theta') = \\min\\left(1, \\frac{p(\\theta'|D)}{p(\\theta_{i}|D)}\\right).\n$$\n现在假设 $p(\\theta|D)$ 是单峰且近似对称的，并假设链位于高密度区域附近（在一些初始迭代之后，甚至从一开始就是如此）。如果提议方差 $\\sigma_{p}^{2}$ 太大，提议的增量 $\\delta = \\theta' - \\theta_{i}$ 的典型量级约为 $\\sigma_{p}$，因此大多数提议会远远落入 $p(\\theta'|D) \\ll p(\\theta_{i}|D)$ 的区域。作为一个说明性的近似，如果目标分布在其众数附近大致为方差为 $\\sigma_{t}^{2}$ 的高斯分布，那么\n$$\n\\frac{p(\\theta'|D)}{p(\\theta_{i}|D)} \\approx \\exp\\left(-\\frac{\\delta^{2}}{2\\sigma_{t}^{2}}\\right).\n$$\n当 $\\sigma_{p}^{2} \\gg \\sigma_{t}^{2}$ 时，典型的 $\\delta^{2}$ 的量级为 $\\sigma_{p}^{2}$，这使得指数为一个大的负数，因此对于大多数提议，$\\alpha(\\theta_{i}, \\theta')$ 接近于零。这导致了极低的接受率和一条几乎不移动的链，与观察到的情况完全一致。\n\n相反，如果 $\\sigma_{p}^{2}$ 太小，那么 $\\delta$ 会非常小，$p(\\theta'|D) \\approx p(\\theta_{i}|D)$，接受概率会接近 1，而不是接近零。因此，低于 0.001 的接受率与方差太小的情况不符。\n\n选项 C 是不正确的，因为高斯随机游走提议是对称的。选项 D 是不正确的，因为根据构造，其均值是以当前状态 $\\theta_{i}$ 为中心的。选项 E 对 Metropolis-Hastings 算法不是问题，因为归一化常数在比率中被消掉了：\n$$\n\\frac{p(\\theta'|D)}{p(\\theta_{i}|D)} = \\frac{\\tilde{p}(\\theta')/Z}{\\tilde{p}(\\theta_{i})/Z} = \\frac{\\tilde{p}(\\theta')}{\\tilde{p}(\\theta_{i})}.\n$$\n因此，可能的问题是提议方差太大，导致提议远离典型集（typical set），并以非常高的概率被拒绝。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "尽管 MH 算法在广泛的条件下保证收敛，但如果提议机制与目标分布的几何结构不匹配，其实际性能可能会很差。这个高级问题  探讨了一种经典的失败模式：从具有不连通高概率区域的分布中进行采样。它促使你超越局部接受率的思维，去考虑遍历性这一全局属性，揭示了一个理论上不可约的链在任何有限的模拟时间内实际上可能是可约的。",
            "id": "3252214",
            "problem": "考虑一个一维目标分布，其在 $\\mathbb{R}$ 上的未归一化密度由 $\\tilde{\\pi}(x) = \\exp(-x^2)\\,\\mathbf{1}_{\\{|x|\\ge 1\\}}$ 给出，其中 $\\mathbf{1}_{\\{|x|\\ge 1\\}}$ 是指示函数，当 $|x|\\ge 1$ 时为 $1$，否则为 $0$。令 $\\pi(x) = \\tilde{\\pi}(x)/Z$ 表示归一化的目标分布，其中 $Z$ 是相应的归一化常数。$\\pi$ 的支撑集是不连通集 $S = (-\\infty,-1]\\cup[1,\\infty)$。我们使用 Metropolis-Hastings (MH) 算法运行一个马尔可夫链蒙特卡洛 (MCMC) 方法，其随机游走高斯提议 $q(y\\mid x)$ 等于一个以当前状态为中心的正态分布，具体为 $q(y\\mid x) = \\mathcal{N}(x,\\sigma^2)$，其中 $\\sigma>0$。该算法使用常规的 MH 接受-拒绝机制来确保 $\\pi$ 是不变的。\n\n分析此采样器在支撑集不连通的情况下的行为，并选择所有正确的陈述：\n\nA. 对于任何 $\\sigma>0$，在 $S$ 上得到的马尔可夫链是不可约的且非周期的，因此在分布上收敛于 $\\pi$。\n\nB. 当 $\\sigma$ 足够小时，从左分量 $\\{x\\le -1\\}$ 提议跳跃到右分量 $\\{x\\ge 1\\}$ 的概率在 $1/\\sigma^2$ 上是指数级小的，这意味着分量之间的期望转移时间是指数级大的，并且对于依赖于两个分量的估计量，会产生严重的有限时间偏差。\n\nC. 如果转而使用提议为 $q(y)=\\mathcal{N}(0,\\tau^2)$ 的独立 MH 采样器，对于所有 $\\tau>0$，该链是一致遍历的，因为 $q$ 在 $\\mathbb{R}$ 上处处具有正密度。\n\nD. 任何落在间隙区域 $\\{-1<y<1\\}$ 的提议总是被拒绝，并导致链停留在其当前状态 $x$。",
            "solution": "该问题陈述是分析 Metropolis-Hastings (MH) 算法性质的一个有效练习。它具有科学依据，提法恰当，客观，并包含了所有必要的信息。我们可以开始解答。\n\n未归一化目标密度由 $\\tilde{\\pi}(x) = \\exp(-x^2)\\,\\mathbf{1}_{\\{|x|\\ge 1\\}}$ 给出。该分布的支撑集是集合 $S = (-\\infty,-1]\\cup[1,\\infty)$。提议分布是一个随机游走高斯分布，$q(y\\mid x) = \\mathcal{N}(x,\\sigma^2)$，这是一个均值为 $x$、方差为 $\\sigma^2$ 的正态分布。提议的密度函数是 $q(y|x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}}\\exp\\left(-\\frac{(y-x)^2}{2\\sigma^2}\\right)$。由于该函数在 $x$ 和 $y$ 上是对称的，即 $q(y|x) = q(x|y)$，Metropolis-Hastings 接受概率简化为 Metropolis 形式：\n$$ \\alpha(y|x) = \\min\\left(1, \\frac{\\tilde{\\pi}(y)q(x|y)}{\\tilde{\\pi}(x)q(y|x)}\\right) = \\min\\left(1, \\frac{\\tilde{\\pi}(y)}{\\tilde{\\pi}(x)}\\right) $$\n对于从当前状态 $x \\in S$ 到新状态 $y$ 的一个提议移动，其接受概率为：\n$$ \\alpha(y|x) = \\begin{cases} \\min\\left(1, \\frac{\\exp(-y^2)}{\\exp(-x^2)}\\right)  & \\text{if } |y| \\ge 1 \\\\ 0  & \\text{if } |y| < 1 \\end{cases} $$\n如果提议了一个状态 $y$，链以概率 $\\alpha(y|x)$ 从 $X_t=x$ 移动到 $X_{t+1}=y$。否则，链保持在 $x$，即 $X_{t+1}=x$。\n\n我们现在来评估每个陈述。\n\n**A. 对于任何 $\\sigma>0$，在 $S$ 上得到的马尔可夫链是不可约的且非周期的，因此在分布上收敛于 $\\pi$。**\n\n*   **不可约性**：如果一个马尔可夫链可以从任何状态（或非空状态集）转移到任何其他非空状态集，那么它在状态空间 $S$ 上是不可约的。对于连续状态空间，这意味着转移核允许在任何两个具有正测度的区域之间移动。让我们考虑任意两个状态 $x \\in S$ 和 $y \\in S$。提议密度 $q(y|x)$ 是一个高斯密度，对于所有实数 $x$ 和 $y$ 都是严格为正的。因此，对于 $S$ 中的任何 $x, y$，从 $x$ 提议移动到 $y$ 的一个邻域的概率是正的。接受概率为 $\\alpha(y|x) = \\min(1, \\exp(x^2-y^2))$。由于 $x, y \\in S$，$\\tilde{\\pi}(x) > 0$ 且 $\\tilde{\\pi}(y) > 0$，这意味着 $\\alpha(y|x) > 0$。由于提议密度和接受概率对于支撑集 $S$ 中的任意一对状态都是正的，链可以在 $S$ 中的任何区域转移到 $S$ 中的任何其他区域。因此，该链是不可约的。支撑集 $S$ 的不连通性并不意味着可约性，因为提议分布可以“跳过”间隙。\n*   **非周期性**：如果一个链不会陷入循环，则它是非周期的。非周期性的一个充分条件是，对于任何状态 $x$，停留在该状态的概率 $P(X_{t+1}=x|X_t=x)$ 是正的。在 MH 算法中，一个移动可能被拒绝，导致链停留在同一状态。拒绝概率是 $1-\\int_S q(y|x)\\alpha(y|x)dy$。由于总接受概率小于 $1$，拒绝概率大于 $0$。因此，$P(X_{t+1}=x|X_t=x) > 0$，该链是非周期的。\n*   **收敛性**：一个以 $\\pi$ 为其不变分布的不可约、非周期的马尔可夫链保证在分布上收敛于 $\\pi$。MH 算法的构造就是为了确保 $\\pi$ 是不变分布。鉴于该链是不可约和非周期的，它将收敛到目标分布 $\\pi(x)$。\n\n因此，该陈述是**正确的**。\n\n**B. 当 $\\sigma$ 足够小时，从左分量 $\\{x\\le -1\\}$ 提议跳跃到右分量 $\\{x\\ge 1\\}$ 的概率在 $1/\\sigma^2$ 上是指数级小的，这意味着分量之间的期望转移时间是指数级大的，并且对于依赖于两个分量的估计量，会产生严重的有限时间偏差。**\n\n*   假设链在左分量中，处于状态 $x \\le -1$。跳跃到右分量 $[1, \\infty)$ 需要提议一个状态 $y \\ge 1$。提议是从 $Y \\sim \\mathcal{N}(x, \\sigma^2)$ 中抽取的。提议这样一次跳跃的概率是 $P(Y \\ge 1)$。这个概率在 $x$ 最接近间隙时最大化，即 $x = -1$。\n*   对于 $x=-1$，提议状态 $y \\ge 1$ 的概率是：\n    $$ P(Y \\ge 1) = P\\left(\\frac{Y - (-1)}{\\sigma} \\ge \\frac{1 - (-1)}{\\sigma}\\right) = P\\left(Z \\ge \\frac{2}{\\sigma}\\right) $$\n    其中 $Z \\sim \\mathcal{N}(0,1)$ 是一个标准正态随机变量。\n*   对于小的 $\\sigma > 0$，值 $z = 2/\\sigma$ 很大。标准正态分布的尾部概率 $P(Z \\ge z)$ 对于大的 $z$ 可以使用 Mill's ratio 或其他界来近似，这表明它的行为类似于 $\\frac{1}{z\\sqrt{2\\pi}}\\exp(-z^2/2)$。代入 $z=2/\\sigma$：\n    $$ P\\left(Z \\ge \\frac{2}{\\sigma}\\right) \\propto \\frac{\\sigma}{2} \\exp\\left(-\\frac{(2/\\sigma)^2}{2}\\right) = \\frac{\\sigma}{2} \\exp\\left(-\\frac{2}{\\sigma^2}\\right) $$\n*   这个概率在 $1/\\sigma^2$ 上是指数级小的。由于接受概率最多为 $1$，分量之间转移的总概率也是指数级小的。\n*   进行这种转移的期望步数与该概率成反比，因此在 $1/\\sigma^2$ 上是指数级大的。这意味着采样器在两个分量之间混合得非常慢。\n*   如果运行的模拟步数远小于这个期望转移时间，链很可能会被困在它的起始分量中。任何依赖于从整个支撑集采样的统计估计量（例如，由于对称性，均值应为 $0$）都将严重偏向于所探索分量中的值。\n\n因此，该陈述是**正确的**。\n\n**C. 如果转而使用提议为 $q(y)=\\mathcal{N}(0,\\tau^2)$ 的独立 MH 采样器，对于所有 $\\tau>0$，该链是一致遍历的，因为 $q$ 在 $\\mathbb{R}$ 上处处具有正密度。**\n\n*   独立采样器从一个与当前状态 $x$ 无关的分布 $q(y)$ 中提议移动。独立采样器一致遍历性的一个充分条件是，目标密度与提议密度的比率 $w(x) = \\tilde{\\pi}(x)/q(x)$ 必须在支撑集 $S$ 上有界。\n*   让我们计算当 $|x| \\ge 1$ 时这个比率：\n    $$ w(x) = \\frac{\\tilde{\\pi}(x)}{q(x)} = \\frac{\\exp(-x^2)}{\\frac{1}{\\sqrt{2\\pi\\tau^2}}\\exp(-x^2/(2\\tau^2))} = \\sqrt{2\\pi\\tau^2} \\exp\\left(-x^2 + \\frac{x^2}{2\\tau^2}\\right) = \\sqrt{2\\pi\\tau^2} \\exp\\left(x^2\\left(\\frac{1}{2\\tau^2} - 1\\right)\\right) $$\n*   为了使 $w(x)$ 对所有 $x \\in S$ 有界，指数项不能为正。如果 $x^2$ 的系数为正，当 $|x| \\to \\infty$ 时，$w(x)$ 将无界增长。\n*   系数是 $\\frac{1}{2\\tau^2} - 1$。如果 $\\frac{1}{2\\tau^2} > 1$ (即 $\\tau^2 < 1/2$)，该系数为正。\n*   当 $\\tau^2 < 1/2$ 时，比率 $w(x)$ 在 $S$ 上是无界的。因此，在这种情况下，链不是一致遍历的。\n*   该陈述声称对于所有 $\\tau > 0$ 都具有一致遍历性。由于我们找到了一个使之不成立的 $\\tau$ 范围，所以该陈述是错误的。给出的理由（“因为 $q$ 在 $\\mathbb{R}$ 上处处具有正密度”）是不可约性的一个条件，而不是一致遍历性的条件。\n\n因此，该陈述是**不正确的**。\n\n**D. 任何落在间隙区域 $\\{-1<y<1\\}$ 的提议总是被拒绝，并导致链停留在其当前状态 $x$。**\n\n*   如果提议了一个状态 $y$ 使得 $|y|<1$，那么根据目标密度的定义，$\\tilde{\\pi}(y) = 0$。\n*   接受概率为 $\\alpha(y|x) = \\min(1, \\tilde{\\pi}(y)/\\tilde{\\pi}(x))$。因为当前状态 $x$ 在支撑集 $S$ 中，所以 $\\tilde{\\pi}(x) > 0$。\n*   因此，接受概率为 $\\alpha(y|x) = \\min(1, 0/\\tilde{\\pi}(x)) = 0$。\n*   概率为 0 的接受意味着提议总是被拒绝。根据 MH 算法的规则，当一个提议被拒绝时，链的下一个状态与当前状态相同，即 $X_{t+1}=X_{t}$。\n*   因此，该陈述是**正确的**。\n\n**结论**\n陈述 A、B 和 D 是正确的。陈述 C 是不正确的。",
            "answer": "$$\\boxed{ABD}$$"
        }
    ]
}