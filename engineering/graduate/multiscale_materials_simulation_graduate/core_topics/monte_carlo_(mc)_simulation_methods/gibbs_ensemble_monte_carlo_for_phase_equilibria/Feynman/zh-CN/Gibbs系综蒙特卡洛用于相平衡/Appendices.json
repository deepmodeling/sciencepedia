{
    "hands_on_practices": [
        {
            "introduction": "在分子模拟中，为了计算效率，我们通常会对相互作用势能进行截断，但这会忽略长程相互作用的贡献。本练习旨在通过从第一性原理出发，推导用于修正截断势能的能量和压力的长程“尾部校正”项，从而加深对微观相互作用与宏观热力学性质之间联系的理解。掌握这项基本计算技能  对于在吉布斯系综模拟中获得精确的热力学性质至关重要。",
            "id": "3812411",
            "problem": "考虑一个用于简单流体相平衡的吉布斯系综蒙特卡洛 (GEMC) 双盒子模拟，该流体分子间的相互作用由Lennard–Jones势 $u(r)=4\\epsilon\\left[(\\sigma/r)^{12}-(\\sigma/r)^{6}\\right]$ 描述。在实践中，势函数在有限的截断半径 $r_c$ 处被截断，超出 $r_c$ 的相互作用被忽略。为了表示被忽略的长程相互作用的影响，引入了解析的“尾部校正”，该校正假设当 $r\\ge r_c$ 时对关联函数 $g(r)\\approx 1$（即在截断半径之外是均匀且不相关的）。从均匀流体的位形能的微观定义和压力的维里状态方程出发，推导以下量的闭合形式表达式：\n\n- 单粒子能量尾部校正，作为数密度 $\\rho$ 和截断半径 $r_c$ 的函数，以及\n- 压力尾部校正，作为 $\\rho$ 和 $r_c$ 的函数，\n\n以上均针对截断（未移动）的Lennard–Jones势。然后，解释在一个具有体积 $V_1$ 和 $V_2$、粒子数 $N_1$ 和 $N_2$、盒子边长 $L_1$ 和 $L_2$ 的GEMC计算中，如何将这些校正一致地应用于每个盒子，其中由于最小镜像约定，每个盒子中的实际截断半径为 $r_{c,1}=\\min(r_c,L_1/2)$ 和 $r_{c,2}=\\min(r_c,L_2/2)$。您的推导必须从位形能和压力的基本定义（针对对加性相互作用）开始，并逐步进行到最终表达式；不要引用或直接使用预先推导出的尾部校正公式。用 $\\rho$、$r_c$、$\\epsilon$ 和 $\\sigma$ 来表示最终的解析表达式。不需要进行数值计算，也不需要四舍五入。将您的最终答案表示为包含两个解析表达式的单行矩阵。",
            "solution": "该问题要求推导通过截断Lennard-Jones势相互作用的流体的位形能和压力的尾部校正。它还要求解释这些校正在吉布斯系综蒙特卡洛（GEMC）模拟中的应用。\n\n首先，对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- **模拟方法**：用于双盒子模拟的吉布斯系综蒙特卡洛（GEMC）。\n- **系统**：简单流体。\n- **相互作用势**：Lennard-Jones (LJ) 势，$u(r)=4\\epsilon\\left[(\\sigma/r)^{12}-(\\sigma/r)^{6}\\right]$。\n- **势函数处理**：势在截断半径 $r_c$ 处被截断；对于 $r > r_c$ 的相互作用在直接求和中被忽略。\n- **尾部校正假设**：在距离 $r \\ge r_c$ 处，对关联函数 $g(r) \\approx 1$。\n- **目标1**：推导单粒子能量尾部校正 $u_{tail}$ 的闭合形式表达式，作为数密度 $\\rho$ 和截断半径 $r_c$ 的函数。\n- **目标2**：推导压力尾部校正 $P_{tail}$ 的闭合形式表达式，作为 $\\rho$ 和 $r_c$ 的函数。\n- **推导起点**：推导必须从位形能的微观定义和压力的维里状态方程开始。\n- **目标3**：解释在具有两个盒子（体积为 $V_1, V_2$，粒子数为 $N_1, N_2$，盒子边长为 $L_1, L_2$）的GEMC背景下如何应用这些校正。\n- **实际截断**：由于最小镜像约定，每个盒子 $k$ 中的截断半径为 $r_{c,k}=\\min(r_c,L_k/2)$。\n- **最终表达式变量**：$\\rho$, $r_c$, $\\epsilon$, 和 $\\sigma$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，是统计力学和计算物理学中的一个标准课题。它是一个良构问题，提供了推导唯一解析表达式所需的所有必要信息和假设。其语言客观、精确。该问题不违反任何基本原理，不完整或不矛盾，不包含不切实际的数据，并且在指定领域中是一个非平凡但可解的问题。它可以被完全形式化和验证。\n\n### 步骤3：结论与行动\n问题是有效的。将提供一个完整的、有理有据的解决方案。\n\n### 尾部校正的推导\n\n#### 1. 单粒子能量尾部校正 ($u_{tail}$)\n\n一个体积为V、包含N个粒子的系统，若粒子间通过对势 u(r) 相互作用，其总位形能 $U$ 可以表示为对关联函数 $g(r)$ 的积分：\n$$U = \\frac{N}{2} \\int_0^\\infty u(r) \\rho g(r) 4\\pi r^2 dr$$\n其中 $\\rho = N/V$ 是数密度。\n\n尾部校正 $U_{tail}$ 考虑的是超出模拟截断半径 $r_c$ 的相互作用所产生的能量。这对应于从 $r_c$ 到无穷大的积分部分：\n$$U_{tail} = \\frac{N}{2} \\int_{r_c}^\\infty u(r) \\rho g(r) 4\\pi r^2 dr$$\n问题陈述要求假设在 $r \\ge r_c$ 范围内流体结构是均匀且不相关的，这意味着在该区域 $g(r) \\approx 1$。应用此近似：\n$$U_{tail} \\approx 2\\pi N\\rho \\int_{r_c}^\\infty u(r) r^2 dr$$\n因此，单粒子能量尾部校正 $u_{tail} = U_{tail}/N$ 为：\n$$u_{tail} = 2\\pi\\rho \\int_{r_c}^\\infty u(r) r^2 dr$$\n现在我们代入Lennard-Jones势，$u(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$：\n$$u_{tail} = 2\\pi\\rho \\int_{r_c}^\\infty 4\\epsilon\\left[\\frac{\\sigma^{12}}{r^{12}} - \\frac{\\sigma^{6}}{r^{6}}\\right] r^2 dr$$\n$$u_{tail} = 8\\pi\\rho\\epsilon \\int_{r_c}^\\infty \\left(\\sigma^{12}r^{-10} - \\sigma^{6}r^{-4}\\right) dr$$\n进行积分：\n$$u_{tail} = 8\\pi\\rho\\epsilon \\left[ \\sigma^{12}\\frac{r^{-9}}{-9} - \\sigma^{6}\\frac{r^{-3}}{-3} \\right]_{r_c}^\\infty$$\n$$u_{tail} = 8\\pi\\rho\\epsilon \\left[ -\\frac{\\sigma^{12}}{9r^9} + \\frac{\\sigma^{6}}{3r^3} \\right]_{r_c}^\\infty$$\n计算极限，其中 $r \\to \\infty$ 的项消失：\n$$u_{tail} = 8\\pi\\rho\\epsilon \\left( (0-0) - \\left(-\\frac{\\sigma^{12}}{9r_c^9} + \\frac{\\sigma^{6}}{3r_c^3}\\right) \\right)$$\n这就得到了单粒子能量尾部校正的最终表达式：\n$$u_{tail}(\\rho, r_c) = 8\\pi\\rho\\epsilon\\left(\\frac{1}{9}\\frac{\\sigma^{12}}{r_c^9} - \\frac{1}{3}\\frac{\\sigma^{6}}{r_c^3}\\right)$$\n\n#### 2. 压力尾部校正 ($P_{tail}$)\n\n压力 $P$ 由维里状态方程给出。由分子间作用力引起的部分，即位形压力，是：\n$$P_{conf} = -\\frac{2\\pi\\rho^2}{3} \\int_0^\\infty r^3 \\frac{du(r)}{dr} g(r) dr$$\n压力尾部校正 $P_{tail}$ 是来自超出 $r_c$ 的相互作用的贡献。我们再次应用 $r \\ge r_c$ 时 $g(r) \\approx 1$ 的近似：\n$$P_{tail} \\approx -\\frac{2\\pi\\rho^2}{3} \\int_{r_c}^\\infty r^3 \\frac{du(r)}{dr} dr$$\n首先，我们求LJ势的导数：\n$$\\frac{du}{dr} = 4\\epsilon\\left(-12\\sigma^{12}r^{-13} + 6\\sigma^{6}r^{-7}\\right)$$\n将其代入 $P_{tail}$ 的积分中：\n$$P_{tail} = -\\frac{2\\pi\\rho^2}{3} \\int_{r_c}^\\infty r^3 \\left[4\\epsilon\\left(-12\\frac{\\sigma^{12}}{r^{13}} + 6\\frac{\\sigma^{6}}{r^{7}}\\right)\\right] dr$$\n$$P_{tail} = -\\frac{8\\pi\\rho^2\\epsilon}{3} \\int_{r_c}^\\infty \\left(-12\\sigma^{12}r^{-10} + 6\\sigma^{6}r^{-4}\\right) dr$$\n进行积分：\n$$P_{tail} = -\\frac{8\\pi\\rho^2\\epsilon}{3} \\left[ -12\\sigma^{12}\\frac{r^{-9}}{-9} + 6\\sigma^{6}\\frac{r^{-3}}{-3} \\right]_{r_c}^\\infty$$\n$$P_{tail} = -\\frac{8\\pi\\rho^2\\epsilon}{3} \\left[ \\frac{4}{3}\\sigma^{12}r^{-9} - 2\\sigma^{6}r^{-3} \\right]_{r_c}^\\infty$$\n计算极限：\n$$P_{tail} = -\\frac{8\\pi\\rho^2\\epsilon}{3} \\left( (0-0) - \\left(\\frac{4}{3}\\frac{\\sigma^{12}}{r_c^9} - 2\\frac{\\sigma^{6}}{r_c^3}\\right) \\right)$$\n这就得到了压力尾部校正的最终表达式：\n$$P_{tail}(\\rho, r_c) = \\frac{8\\pi\\rho^2\\epsilon}{3}\\left(\\frac{4}{3}\\frac{\\sigma^{12}}{r_c^9} - 2\\frac{\\sigma^{6}}{r_c^3}\\right) = \\frac{16\\pi\\rho^2\\epsilon}{3}\\left(\\frac{2}{3}\\frac{\\sigma^{12}}{r_c^9} - \\frac{\\sigma^{6}}{r_c^3}\\right)$$\n\n### 在吉布斯系综蒙特卡洛 (GEMC) 中的应用\n\n在GEMC模拟中，代表共存相的两个盒子（盒子1和盒子2）被同时模拟。它们有粒子数 $N_1, N_2$，体积 $V_1, V_2$，因此密度为 $\\rho_1, \\rho_2$。模拟使用截断势计算性质，截断半径为 $r_{c,1}=\\min(r_c,L_1/2)$ 和 $r_{c,2}=\\min(r_c,L_2/2)$。必须应用推导出的尾部校正，以获得对应于完整、未截断势的精确热力学性质。\n\n1.  **校正后的能量**：系统的总势能是两个盒子能量的总和。每个盒子 $k \\in \\{1, 2\\}$ 的校正势能是显式计算的短程能量 $U_{sim,k}$ 和总能量尾部校正 $U_{tail,k} = N_k u_{tail,k}$ 的和。\n    $$U_{corr,k} = U_{sim,k} + N_k u_{tail}(\\rho_k, r_{c,k})$$\n    系统的总校正能量为 $U_{total,corr} = U_{corr,1} + U_{corr,2}$。对于改变密度或粒子数的蒙特卡洛移动，必须使用这个总校正能量来计算 Metropolis 接受准则。\n    -   **粒子位移移动**：在一个盒子内部，$N_k$, $V_k$, $\\rho_k$, 和 $r_{c,k}$ 是恒定的。因此，尾部校正是能量的一个恒定偏移量。能量变化 $\\Delta U_{corr,k}$ 等于模拟能量的变化 $\\Delta U_{sim,k}$，所以接受概率不受尾部校正的影响。\n    -   **体积交换移动**：$V_k$（以及 $L_k$）的变化会改变 $\\rho_k$ 和可能改变的 $r_{c,k}$。这会改变两个盒子的尾部校正项 $N_k u_{tail}(\\rho_k, r_{c,k})$。该移动的接受概率必须包含总尾部能量的变化 $\\Delta U_{tail,total}$。\n    -   **粒子交换移动**：在盒子之间转移一个粒子会改变 $N_1$ 和 $N_2$，这反过来又改变了密度 $\\rho_1$ 和 $\\rho_2$。与体积移动一样，这会改变两个盒子中的尾部校正项，并且变化量 $\\Delta U_{tail,total}$ 必须包含在接受准则中。\n\n2.  **校正后的压力**：为了报告相的平衡压力，每个盒子中由维里公式计算出的压力 $P_{sim,k}$ 必须通过加上压力尾部校正来进行修正。\n    $$P_{corr,k} = P_{sim,k} + P_{tail}(\\rho_k, r_{c,k})$$\n    由于在模拟过程中 $\\rho_k$ 和 $r_{c,k}$ 会波动（由于体积和粒子数的变化），压力的系综平均值为 $\\langle P_{corr,k} \\rangle = \\langle P_{sim,k} \\rangle + \\langle P_{tail}(\\rho_k, r_{c,k}) \\rangle$。也就是说，尾部校正必须在每一步计算并取平均，而不是用平均密度只计算一次。在平衡状态下，两个盒子中的校正压力 $\\langle P_{corr,1} \\rangle$ 和 $\\langle P_{corr,2} \\rangle$ 应该是相等的。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 8\\pi\\rho\\epsilon\\left(\\dfrac{1}{9}\\dfrac{\\sigma^{12}}{r_c^9} - \\dfrac{1}{3}\\dfrac{\\sigma^{6}}{r_c^3}\\right) & \\dfrac{16\\pi\\rho^2\\epsilon}{3}\\left(\\dfrac{2}{3}\\dfrac{\\sigma^{12}}{r_c^9} - \\dfrac{\\sigma^{6}}{r_c^3}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "蒙特卡洛模拟的效率在很大程度上取决于提议移动（如粒子位移、体积交换）的步长。本练习将探讨如何自适应地调节这些移动步长，以达到最优的接受率范围，从而最大限度地提高模拟的采样效率。通过将接受率的经验法则与最大化“期望平方跳跃距离”这一理论基础联系起来 ，你将掌握一项优化模拟性能的关键实践技能。",
            "id": "3812351",
            "problem": "考虑一个单组分流体的双箱系综蒙特卡洛（GEMC）模拟，其总粒子数 $N$、温度 $T$ 和总体积 $V_{\\mathrm{tot}}$ 固定，其中两条耦合的马尔可夫链通过标准的Metropolis-Hastings (MH) 移动来演化盒子1和盒子2的状态。移动类型包括盒子内的粒子位移和保持 $V_{\\mathrm{tot}}$ 守恒的体积交换移动。设 $\\beta = 1/(k_{\\mathrm{B}} T)$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。该模拟旨在通过对微观状态的正确平稳分布进行采样来计算相平衡性质。你希望在一个初始校准阶段自适应地调整位移步长和体积变化幅度，以将接受率目标定在 $0.3$–$0.5$ 左右，然后在生产采样阶段冻结这些参数。\n\n请基于马尔可夫链蒙特卡洛（MCMC）的第一性原理进行推理，包括：针对对称提议的MH接受机制（确保了相对于目标分布的细致平衡）、可观测量的积分自相关时间（IACT）与其估计量的渐近方差之间的联系，以及效率可以与链在单位计算量内移动的距离相关联这一思想。特别地，请使用基于预期跳跃距离和已知维度依赖性的方差缩减论据，来论证为什么对于GEMC的位移和体积交换移动而言，$[0.3, 0.5]$ 范围内的接受窗口是合适的，而不依赖于这些基本原理之外任何特定于GEMC的简化公式。\n\n哪个选项提供了科学上合理的自适应策略以及对该接受窗口的正确论证？\n\nA. 使用分块的 Robbins–Monro 随机近似，为每种移动类型分别调整粒子位移步长 $\\delta_{x}$ 和对数体积变化幅度 $\\delta_{V}$。在每个长度为 $m$ 的校准块之后，估计该移动的接受率 $\\hat{\\alpha}$，并通过 $\\log \\delta^{(k+1)} = \\log \\delta^{(k)} + \\gamma_{k} \\left(\\hat{\\alpha} - \\alpha^{\\star}\\right)$ 在对数空间中更新，其中对于常数 $c>0, k_{0} \\ge 0$, $\\gamma_{k} = c/(k + k_{0})$，并且为每种移动类型选择 $\\alpha^{\\star} \\in [0.3, 0.5]$。通过为随机行走提议最大化预期平方跳跃距离 $J(\\delta) \\propto \\delta^{2} \\alpha(\\delta)$ 来论证 $\\alpha^{\\star} \\in [0.3, 0.5]$ 的合理性：在低到中等维度下（例如，对于标量对数体积 $d=1$，对于单粒子位移 $d=3$），内部最优值对应的接受率大约在 $0.3$ 和 $0.5$ 之间（已知的扩散极限最优值在 $d=1$ 时接近 $0.44$，在更高维度 $d$ 时更低）。在校准阶段后冻结 $\\delta_{x}$ 和 $\\delta_{V}$ 以保持平稳性。\n\nB. 固定非常小的位移和体积变化幅度，以使整个过程中的接受率达到 $\\ge 0.8$，因为更高的接受率总是能减少估计量的方差。不进行自适应调整，因为任何调整都会改变目标分布。\n\nC. 在每一步移动中都使用一个与 $k$ 无关的恒定增益 $\\eta$ 进行自适应更新 $\\delta^{(k+1)} = \\delta^{(k)} + \\eta \\left(\\hat{\\alpha} - \\alpha^{\\star}\\right)$，目标是位移的 $\\alpha^{\\star} = 0.95$ 和体积移动的 $\\alpha^{\\star} = 0.05$。在生产阶段继续进行自适应调整，因为频繁的自适应调整会加速混合且不影响遍历性。\n\nD. 对位移和体积移动强制执行一个通用的接受率目标 $\\alpha^{\\star} = 0.234$，更新步长以使每个盒子中的 $\\alpha$ 接近 $0.234$。用高维随机行走 Metropolis 理论来证明这一点，该理论证明 $\\alpha^{\\star} = 0.234$ 能最小化渐近方差，而不考虑移动的维度或类型。",
            "solution": "用户要求对问题陈述进行严格验证，然后是基于马尔可夫链蒙特卡洛（MCMC）模拟第一性原理的详细解答。\n\n### 问题验证\n\n**第1步：提取已知条件**\n\n-   **模拟类型**：双箱系综蒙特卡洛（GEMC）。\n-   **系统**：单组分流体。\n-   **系综**：总粒子数 $N$、温度 $T$ 和总体积 $V_{\\mathrm{tot}}$ 固定。\n-   **状态演化**：用于盒子1和盒子2的两条耦合的马尔可夫链。\n-   **蒙特卡洛移动**：\n    1.  盒子内的粒子位移。\n    2.  保持 $V_{\\mathrm{tot}}$ 守恒的体积交换移动。\n-   **算法**：标准的 Metropolis-Hastings (MH) 移动。\n-   **符号**：$\\beta = 1/(k_{\\mathrm{B}} T)$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n-   **目标**：通过对正确的平稳分布进行采样来计算相平衡性质。\n-   **调整过程**：在一个初始校准阶段，自适应地调整位移步长和体积变化幅度，以将接受率目标定在 $0.3$–$0.5$ 左右。为生产阶段冻结参数。\n-   **要求的论证**：接受窗口 $[0.3, 0.5]$ 的推理必须基于第一性原理：MH接受机制、细致平衡、积分自相关时间（IACT）、估计量的渐近方差，以及基于预期跳跃距离和维度的高效率分析。\n\n**第2步：使用提取的已知条件进行验证**\n\n-   **科学基础（关键）**：该问题牢固地建立在统计力学和计算物理学的既定原理之上。GEMC、Metropolis-Hastings算法，以及细致平衡、IACT和自适应调整等概念，都是分子模拟领域的标准和基础课题。问题设置是科学合理的。\n-   **适定性**：该问题是适定的。它要求从一组选项中识别出正确的自适应策略及其理论论证，这是概念物理或计算科学问题的标准格式。\n-   **客观性（关键）**：语言精确、技术性强，没有主观或含糊的措辞。诸如“Robbins–Monro 随机近似”和“预期平方跳跃距离”等术语在此上下文中具有特定、明确的含义。\n-   **不完整或矛盾的设置**：问题提供了足够的信息，可以根据所要求的第一性原理来评估选项。没有矛盾之处。\n-   **不切实际或不可行**：所描述的场景——为相平衡调整GEMC模拟——不仅是现实的，而且代表了研究中的一个标准且必要的过程。\n-   **不适定或结构不良**：问题结构良好，并且根据已建立的MCMC理论，可以得出一个唯一的正确答案。\n\n**第3步：结论与行动**\n\n问题陈述是**有效的**。它科学合理、适定，并且没有任何会妨碍严谨分析的缺陷。我现在将进行解题推导和选项评估。\n\n### 解题推导\n\n蒙特卡洛模拟的目标是通过计算从目标分布 $\\pi(X)$ 中抽取的一系列微观状态 $\\{X_i\\}$ 的样本均值来估计一个可观测量的系综平均 $\\langle A \\rangle$。此估计的效率与样本均值估计量的方差 $\\mathrm{Var}(\\bar{A})$ 成反比。对于长度为 $M$ 的长马尔可夫链，该方差近似为：\n$$\n\\mathrm{Var}(\\bar{A}) \\approx \\frac{\\mathrm{Var}(A)}{M} \\tau_A\n$$\n其中 $\\mathrm{Var}(A)$ 是可观测量 $A$ 在系综中的真实方差，而 $\\tau_A$ 是其积分自相关时间（IACT）。IACT衡量需要多少模拟步数才能生成一个新的、有效的独立 $A$ 样本。为了在给定的步数 $M$ 下最大化计算效率，我们必须最小化 $\\tau_A$。\n\n最小化 $\\tau_A$ 涉及对提议机制的优化。提议移动由一个步长 $\\delta$（例如，最大位移距离或最大体积变化）参数化。$\\delta$ 的选择会产生一种权衡：\n\n1.  **非常小的 $\\delta$**：提议的状态非常接近当前状态。势能的变化很小，导致接受概率很高，$\\alpha(\\delta) \\to 1$。然而，系统探索构型空间的速度极慢。连续的状态高度相关，导致 $\\tau_A$ 很大，效率很低。\n2.  **非常大的 $\\delta$**：提议的状态距离较远，并且很可能有高得多的势能。接受概率 $\\alpha(\\delta) \\to 0$。链会频繁拒绝移动，停留在当前状态。这也导致了高相关性、大的 $\\tau_A$ 和低效率。\n\n存在一个平衡这些极端的最佳 $\\delta$。直接相对于 $\\delta$ 最小化 $\\tau_A$ 是复杂的。一个广泛使用且有效的 MCMC 效率代理指标是预期平方跳跃距离 $J(\\delta)$。对于对称的随机行走提议，一次移动尝试跳跃的平方距离与 $\\delta^2$ 成正比。这个跳跃以概率 $\\alpha(\\delta)$ 成功。因此，每一步移动的预期平方距离是：\n$$\nJ(\\delta) \\propto \\delta^2 \\alpha(\\delta)\n$$\n最大化这个量为最小化 $\\tau_A$ 并因此最大化采样效率提供了一个很好的启发式方法。\n\n最大化 $J(\\delta)$ 的最佳接受率 $\\alpha^{\\star}$ 取决于提议移动所在空间的维度 $d$。理论分析（最初由 Roberts、Gelman 和 Gilks 提出）表明，在高维高斯目标分布的极限下：\n-   对于 $d=1$（例如，改变单个标量变量如 $\\log V$ 的移动），最佳接受率是 $\\alpha^{\\star} \\approx 0.44$。\n-   当 $d \\to \\infty$ 时，最佳接受率收敛到 $\\alpha^{\\star} \\approx 0.234$。\n-   对于低到中等维度，例如在3维盒子中的单粒子位移（$d=3$），最佳接受率位于这两个极限之间。\n\n对于所描述的GEMC移动：\n-   **粒子位移**：这是一个在3维空间中的移动，所以 $d=3$。最佳接受率预计在 $[0.3, 0.5]$ 范围内。\n-   **体积交换**：这涉及改变一个盒子 $V_1$ 的体积，而另一个盒子的体积由约束 $V_2 = V_{\\mathrm{tot}} - V_1$ 决定。通常，移动是在 $\\log V_1$ 上执行的。这是一个一维移动，$d=1$，其最佳接受率接近 $0.44$。\n\n因此，对于这两种移动类型，一个 $[0.3, 0.5]$ 的通用目标接受窗口是一个稳健且有理论依据的选择。\n\n为了达到这个目标接受率 $\\alpha^{\\star}$，步长 $\\delta$ 必须被调整。这应该在非生产（校准或平衡）阶段进行，以避免破坏平稳分布。一种 Robbins-Monro 风格的随机近似算法是实现此目的的标准方法。形如\n$$\n\\log \\delta^{(k+1)} = \\log \\delta^{(k)} + \\gamma_{k} (\\hat{\\alpha} - \\alpha^{\\star})\n$$\n的更新是合适的。这里，$\\delta^{(k)}$ 是第 $k$ 个试验块的步长，$\\hat{\\alpha}$ 是该块测得的接受率，而 $\\gamma_k$ 是一个必须随时间递减（例如，$\\gamma_k \\propto 1/k$）的增益参数，以使算法收敛并满足遍历性条件。对数更新确保 $\\delta$ 保持为正。在这个校准阶段之后，$\\delta$ 必须被冻结，以确保生产运行从具有正确平稳分布的时间均匀马尔可夫链中采样。\n\n### 逐项选项分析\n\n**A. 使用分块的 Robbins–Monro 随机近似，为每种移动类型分别调整粒子位移步长 $\\delta_{x}$ 和对数体积变化幅度 $\\delta_{V}$。在每个长度为 $m$ 的校准块之后，估计该移动的接受率 $\\hat{\\alpha}$，并通过 $\\log \\delta^{(k+1)} = \\log \\delta^{(k)} + \\gamma_{k} \\left(\\hat{\\alpha} - \\alpha^{\\star}\\right)$ 在对数空间中更新，其中对于常数 $c>0, k_{0} \\ge 0$, $\\gamma_{k} = c/(k + k_{0})$，并且为每种移动类型选择 $\\alpha^{\\star} \\in [0.3, 0.5]$。通过为随机行走提议最大化预期平方跳跃距离 $J(\\delta) \\propto \\delta^{2} \\alpha(\\delta)$ 来论证 $\\alpha^{\\star} \\in [0.3, 0.5]$ 的合理性：在低到中等维度下（例如，对于标量对数体积 $d=1$，对于单粒子位移 $d=3$），内部最优值对应的接受率大约在 $0.3$ 和 $0.5$ 之间（已知的扩散极限最优值在 $d=1$ 时接近 $0.44$，在更高维度 $d$ 时更低）。在校准阶段后冻结 $\\delta_{x}$ 和 $\\delta_{V}$ 以保持平稳性。**\n\n此选项与第一性原理推导完全一致。它正确地指出了：\n1.  一个标准且稳健的自适应算法（Robbins-Monro）。\n2.  正确的更新规则形式（对数空间，递减增益 $\\gamma_k$）。\n3.  对目标接受窗口（$[0.3, 0.5]$）的正确且有理论依据的论证，基于最大化预期平方跳跃距离。\n4.  对移动维度（位移 $d=3$，体积 $d=1$）和相应最佳接受率（例如，对于 $d=1$ 约为 $0.44$）的正确分析。\n5.  在校准阶段后冻结参数以确保有效采样的正确程序。\n**结论：正确。**\n\n**B. 固定非常小的位移和体积变化幅度，以使整个过程中的接受率达到 $\\ge 0.8$，因为更高的接受率总是能减少估计量的方差。不进行自适应调整，因为任何调整都会改变目标分布。**\n\n这个选项包含一个根本性错误。“更高的接受率总是能减少估计量的方差”这一前提是错误的。如上所述，接近1的接受率意味着非常小的步长、对相空间的缓慢探索、非常高的自相关时间 $\\tau_A$，因此导致*大的*估计量方差。“不进行自适应调整”的说法也是不好的做法；虽然天真的自适应可能有害，但一个明确定义的校准阶段是找到高效参数的标准方法。\n**结论：不正确。**\n\n**C. 在每一步移动中都使用一个与 $k$ 无关的恒定增益 $\\eta$ 进行自适应更新 $\\delta^{(k+1)} = \\delta^{(k)} + \\eta \\left(\\hat{\\alpha} - \\alpha^{\\star}\\right)$，目标是位移的 $\\alpha^{\\star} = 0.95$ 和体积移动的 $\\alpha^{\\star} = 0.05$。在生产阶段继续进行自适应调整，因为频繁的自适应调整会加速混合且不影响遍历性。**\n\n这个选项在多个方面都是不正确的。首先，$\\alpha^{\\star}=0.95$（太高）和 $\\alpha^{\\star}=0.05$（太低）的目标接受率远非最优，且缺乏任何论证。其次，使用一个恒定的增益因子 $\\eta$ 意味着自适应过程永不“冷却”，步长 $\\delta$ 将不会收敛。第三，也是最关键的，在生产运行期间继续这种类型的自适应调整违反了遍历性定理所需的时间均匀转移核的条件。采样器将不会收敛到目标吉布斯分布，从而导致结果无效。\n**结论：不正确。**\n\n**D. 对位移和体积移动强制执行一个通用的接受率目标 $\\alpha^{\\star} = 0.234$，更新步长以使每个盒子中的 $\\alpha$ 接近 $0.234$。用高维随机行走 Metropolis 理论来证明这一点，该理论证明 $\\alpha^{\\star} = 0.234$ 能最小化渐近方差，而不考虑移动的维度或类型。**\n\n这个选项错误地应用了一个特定的理论结果。值 $\\alpha^{\\star} \\approx 0.234$ 是*在无限维度极限*（$d \\to \\infty$）下的最佳接受率。声称这是一个“不考虑移动的维度”的通用目标是不正确的。对于本问题中的低维移动——粒子位移（$d=3$）和体积交换（$d=1$）——已知的最佳接受率要显著高于 $0.234$。将此高维极限应用于低维问题会导致次优的采样效率。\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在进行吉布斯系综模拟后，一个至关重要的问题是：如何判断模拟已达到平衡，并且采集的数据是可靠的？本练习旨在让你评估并选择一套科学上合理且在统计上严谨的收敛性诊断标准 。通过这项实践，你将学会如何超越简单的目测检查，运用统计力学的基本原理来验证相平衡条件，并对模拟结果的可靠性做出有根据的判断。",
            "id": "3812383",
            "problem": "考虑吉布斯系综蒙特卡洛（GEMC），此处定义为一种蒙特卡洛（MC）模拟方法。在该方法中，一个处于固定温度 $T$、总粒子数 $N$ 和总体积 $V$ 的单组分流体由两个盒子表示，其体积分别为 $V_1$ 和 $V_2$，粒子数分别为 $N_1$ 和 $N_2$，且满足 $V_1 + V_2 = V$ 和 $N_1 + N_2 = N$。该模拟采用三种标准移动类型：盒子内的单粒子位移、盒子间的粒子交换，以及通过耦合方式改变 $V_1$ 和 $V_2$ 来保持总体积 $V$ 不变的体积交换移动。选择 Metropolis 接受准则以满足在指定 $T$、$N$ 和 $V$ 条件下相对于平衡态玻尔兹曼分布的细致平衡条件。相平衡的特征是，在温度相等、压力相等和化学势相等的平衡条件下，一个盒子中存在稠密（类液）相，另一个盒子中存在稀疏（类气）相的共存。\n\n一名学生提出了一套收敛性诊断标准，用于评估 GEMC 模拟是否已达到平衡，并能可靠地对相应于相共存的平稳分布进行采样。所提出的诊断标准必须基于统计力学的第一性原理进行论证。设 $\\rho_i = N_i / V_i$ 表示盒子 $i$ 中的数密度，设 $P_i$ 表示盒子 $i$ 中的机械压力，根据对偶相互作用 $u(r)$ 的维里定理估计为\n$$\nP_i = \\rho_i k_{\\mathrm{B}} T + \\frac{1}{3 V_i} \\left\\langle \\sum_{j<k \\text{ in box } i} -r_{jk} \\frac{d u(r_{jk})}{d r_{jk}} \\right\\rangle,\n$$\n设 $\\mu_i$ 表示盒子 $i$ 中的化学势，可通过 Widom 测试粒子插入法估计。\n\n以下哪项提供了一套最全面和最严谨的收敛性诊断标准，以确认 GEMC 模拟已达到相平衡？\n\nA. 确认以下所有条件都得到满足：(i) 在丢弃初始瞬态阶段后，每个盒子中的平均压力在统计上变得相等，即 $\\langle P_1 \\rangle = \\langle P_2 \\rangle$；(ii) 在相同的时间段内，每个盒子中的平均化学势在统计上变得相等，即 $\\langle \\mu_1 \\rangle = \\langle \\mu_2 \\rangle$；(iii) 两个盒子的密度 $\\rho_1(t)$ 和 $\\rho_2(t)$ 的时间序列图显示出向两个不同稳定值的收敛，其联合分布呈现双峰形态；(iv) 系统已充分探索构型空间，表现为盒子的身份发生多次交换（即，盒子1从高密度切换到低密度，反之亦然）。\n\nB. 确认平均压力在统计上相等，即 $\\langle P_1 \\rangle = \\langle P_2 \\rangle$。由于压力相等是热力学平衡的标志，这足以确保相共存。\n\nC. 确认两个盒子的密度随时间收敛到两个不同的稳定值 $\\rho_l$ 和 $\\rho_g$，并且其中一个盒子的压力显著大于另一个，例如 $\\langle P_1 \\rangle \\gg \\langle P_2 \\rangle$，这解释了液相和气相之间固有的压力差。\n\nD. 确认每个盒子中的平均压力在统计上变得相等，即 $\\langle P_1 \\rangle = \\langle P_2 \\rangle$，并且两个盒子的密度直方图都变成静态的。这确保了机械稳定性和平稳性，足以满足相共存条件。",
            "solution": "在推导解决方案之前，必须评估问题陈述的有效性。\n\n### 步骤 1：提取已知条件\n\n问题陈述提供了以下信息：\n- **模拟方法**：吉布斯系综蒙特卡洛（GEMC）。\n- **系统**：单组分流体。\n- **热力学状态**：固定的总温度 $T$、总粒子数 $N$ 和总体积 $V$。\n- **模拟设置**：两个盒子，标记为 1 和 2，体积分别为 $V_1, V_2$，粒子数分别为 $N_1, N_2$。\n- **约束条件**：$V_1 + V_2 = V$ 和 $N_1 + N_2 = N$。\n- **蒙特卡洛移动**：(1) 盒子内的粒子位移，(2) 盒子间的粒子交换，(3) 盒子间的体积交换。\n- **接受准则**：Metropolis 准则，确保相对于整个 $NVT$ 系统的玻尔兹曼分布满足细致平衡。\n- **相共存的平衡条件**：温度相等 ($T_1=T_2$)、压力相等 ($P_1=P_2$) 和化学势相等 ($\\mu_1=\\mu_2$)。\n- **定义**：\n    - 密度：$\\rho_i = N_i / V_i$。\n    - 来自维里定理的压力：$P_i = \\rho_i k_{\\mathrm{B}} T + \\frac{1}{3 V_i} \\left\\langle \\sum_{j<k \\text{ in box } i} -r_{jk} \\frac{d u(r_{jk})}{d r_{jk}} \\right\\rangle$。\n    - 化学势：$\\mu_i$，可通过 Widom 测试粒子插入法估计。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n- **科学基础**：问题完全基于统计力学和分子模拟的既定原理。GEMC、相平衡条件（热、机械、化学平衡）、维里定理和 Widom 插入法都是该领域的标准概念。问题是科学合理的。\n- **适定性**：问题是良构的。它要求从多个选项中评估和选择最严谨的一套收敛性诊断标准，这是一个清晰且明确的任务。\n- **客观性**：问题中的语言是技术性的、精确的，没有任何含糊不清之处。\n- **不完整或矛盾的设置**：问题提供了所有必要的信息来评估选项。维里定理的压力公式的展示有一个截断 ``，但这只是一个显示错误，并不影响对问题概念的理解。压力和化学势的核心概念足以评估选项。\n- **不切实际或不可行**：所描述的情景是 GEMC 模拟中的一个标准且关键的步骤。\n- **不适定或结构不良**：问题结构清晰，并且基于热力学第一性原理，只有一个选项可以被认为是“最全面和最严谨的”。\n\n### 步骤 3：结论与行动\n\n问题陈述是**有效的**。尽管压力公式的文本中有一个小的排版错误，但这并不妨碍对问题的理解和解决。我现在将继续进行解题推导。\n\n### 解题推导\n\n一个 GEMC 模拟的收敛性，即它是否已达到代表相平衡的平稳状态，必须对照热力学平衡的基本条件进行检查。对于在恒定温度下共存的两相（$\\alpha$ 和 $\\beta$），必须同时满足三个条件：\n1.  **热平衡**：$T_\\alpha = T_\\beta$。在 GEMC 中，两个盒子都与同一温度 $T$ 的热浴耦合，因此这个条件是按设计满足的。\n2.  **机械平衡**：$P_\\alpha = P_\\beta$。体积交换移动的设计正是为了驱动系统达到这个条件。因此，验证两个盒子中的平均压力是否相等是一个必要的检查。\n3.  **化学平衡**：$\\mu_\\alpha = \\mu_\\beta$。粒子交换移动的设计正是为了驱动系统达到这个条件。这是相平衡最关键和最微妙的条件。\n\n一个好的收敛性诊断方案必须检查所有这些必要条件（至少是机械和化学平衡），并确认系统已达到一个稳定的状态，并且正在对该状态进行充分的采样。\n\n现在让我们逐一评估各个选项：\n\n**A. 确认以下所有条件都得到满足：(i) 在丢弃初始瞬态阶段后，每个盒子中的平均压力在统计上变得相等，即 $\\langle P_1 \\rangle = \\langle P_2 \\rangle$；(ii) 在相同的时间段内，每个盒子中的平均化学势在统计上变得相等，即 $\\langle \\mu_1 \\rangle = \\langle \\mu_2 \\rangle$；(iii) 两个盒子的密度 $\\rho_1(t)$ 和 $\\rho_2(t)$ 的时间序列图显示出向两个不同稳定值的收敛，其联合分布呈现双峰形态；(iv) 系统已充分探索构型空间，表现为盒子的身份发生多次交换（即，盒子1从高密度切换到低密度，反之亦然）。**\n\n这个选项是最全面的。\n-   (i) 检查机械平衡 ($P_1 = P_2$)。\n-   (ii) 检查化学平衡 ($\\mu_1 = \\mu_2$)，这是至关重要的。\n-   (iii) 检查相分离是否实际发生（两个不同的稳定密度）以及系统是否已达到平稳状态（密度稳定）。\n-   (iv) 检查遍历性。盒子身份的交换表明系统没有被困在其中一个盒子是液体而另一个是气体的单一状态中，而是正在对整个对称的相空间进行采样。\n这个选项包含了所有必要的物理检查和统计检查。**这是最严谨的答案。**\n\n**B. 确认平均压力在统计上相等，即 $\\langle P_1 \\rangle = \\langle P_2 \\rangle$。由于压力相等是热力学平衡的标志，这足以确保相共存。**\n\n这个选项是不充分的。虽然压力相等是必要的，但它并非充分条件。例如，一个均匀的超临界流体，如果被任意地分成两个盒子，也会通过体积交换达到压力相等，但这并不是相共存。此外，即使系统处于相共存区域，如果粒子交换的采样不足，系统也可能处于压力相等但化学势不等的非平衡状态。\n\n**C. 确认两个盒子的密度随时间收敛到两个不同的稳定值 $\\rho_l$ 和 $\\rho_g$，并且其中一个盒子的压力显著大于另一个，例如 $\\langle P_1 \\rangle \\gg \\langle P_2 \\rangle$，这解释了液相和气相之间固有的压力差。**\n\n这个选项是错误的。相平衡的一个基本条件是压力*相等*。压力差的存在（例如，由弯曲界面引起的拉普拉斯压力）正是 GEMC 设计用来*避免*的。因此，$\\langle P_1 \\rangle \\gg \\langle P_2 \\rangle$ 是系统*未达到*平衡的明确信号。\n\n**D. 确认每个盒子中的平均压力在统计上变得相等，即 $\\langle P_1 \\rangle = \\langle P_2 \\rangle$，并且两个盒子的密度直方图都变成静态的。这确保了机械稳定性和平稳性，足以满足相共存条件。**\n\n这个选项比 B 好，因为它增加了平稳性的检查，但它仍然是不充分的。它遗漏了最关键的化学平衡检查 ($\\mu_1 = \\mu_2$)。一个系统可能在机械上稳定（压力相等）但化学上尚未平衡。没有对化学势的检查，就不能确定观察到的密度是否是真正的平衡共存密度。\n\n因此，选项 A 提供了唯一一个既检查了所有必要的物理平衡条件（机械和化学），又评估了统计充分性（平稳性和遍历性）的诊断方案。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}