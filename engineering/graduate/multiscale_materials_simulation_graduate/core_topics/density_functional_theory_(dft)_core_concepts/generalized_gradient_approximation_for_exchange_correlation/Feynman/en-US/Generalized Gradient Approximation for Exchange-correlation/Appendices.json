{
    "hands_on_practices": [
        {
            "introduction": "The Generalized Gradient Approximation improves upon the Local Density Approximation by incorporating information about the local inhomogeneity of the electron density, quantified by the reduced density gradient, $s(\\mathbf{r})$. This foundational exercise provides direct, hands-on practice in deriving $s(\\mathbf{r})$ from its definition for a Gaussian density profile, a common model for localized electronic states. Mastering this calculation is the first step toward understanding how GGAs are constructed and how they interpret different physical environments. ",
            "id": "3811143",
            "problem": "In multiscale materials simulation, the Generalized Gradient Approximation (GGA) for exchange-correlation within Density Functional Theory (DFT) refines the Local Density Approximation by incorporating spatial variations of the electron density. Consider a spherically symmetric, localized electron density representative of a mesoscopic embedding region around a defect, modeled as a Gaussian $n(\\mathbf{r}) = n_0 \\exp(-\\alpha r^2)$, where $r = |\\mathbf{r}|$, $n_0 > 0$ is the peak density, and $\\alpha > 0$ sets the localization scale.\n\nStarting from foundational definitions appropriate to GGA, including the Fermi wavevector $k_{\\mathrm{F}}$ of the homogeneous electron gas and the reduced density gradient used to characterize inhomogeneity, derive the explicit closed-form expression for the reduced density gradient $s(\\mathbf{r})$ for the given $n(\\mathbf{r})$. Then, within the same derivation, analyze how $s$ varies with $r$ and $\\alpha$, including the limiting behavior for small $r$ and large $r$.\n\nExpress the final answer as a single closed-form analytic expression for $s(r)$ in terms of $r$, $n_0$, and $\\alpha$. No rounding is required, and no units should be included in the final expression.",
            "solution": "The task is to derive the expression for the reduced density gradient, $s(\\mathbf{r})$, for a given spherically symmetric electron density, $n(\\mathbf{r}) = n_0 \\exp(-\\alpha r^2)$.\n\nThe derivation proceeds from the foundational definitions used in the Generalized Gradient Approximation (GGA). The reduced density gradient, $s(\\mathbf{r})$, is a dimensionless quantity that measures the local inhomogeneity of the electron gas. It is defined as:\n$$\ns(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_{\\mathrm{F}}(\\mathbf{r}) n(\\mathbf{r})}\n$$\nwhere $\\nabla n(\\mathbf{r})$ is the gradient of the electron density $n(\\mathbf{r})$, and $k_{\\mathrm{F}}(\\mathbf{r})$ is the local Fermi wavevector.\n\nThe local Fermi wavevector, $k_{\\mathrm{F}}(\\mathbf{r})$, is defined by treating the electron gas at position $\\mathbf{r}$ as a homogeneous electron gas with density $n(\\mathbf{r})$. For a three-dimensional system, its expression is:\n$$\nk_{\\mathrm{F}}(\\mathbf{r}) = (3\\pi^2 n(\\mathbf{r}))^{1/3}\n$$\nSubstituting this definition of $k_{\\mathrm{F}}(\\mathbf{r})$ into the expression for $s(\\mathbf{r})$ yields:\n$$\ns(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 (3\\pi^2 n(\\mathbf{r}))^{1/3} n(\\mathbf{r})} = \\frac{|\\nabla n(\\mathbf{r})|}{2 (3\\pi^2)^{1/3} n(\\mathbf{r})^{4/3}}\n$$\nNext, we must compute the gradient of the given electron density, $n(\\mathbf{r}) = n_0 \\exp(-\\alpha r^2)$, where $r = |\\mathbf{r}|$. Due to the spherical symmetry of $n$, the gradient vector will point in the radial direction, $\\hat{\\mathbf{r}}$. We can write the gradient as $\\nabla n(\\mathbf{r}) = \\frac{d n(r)}{dr} \\hat{\\mathbf{r}}$.\nWe compute the derivative with respect to $r$:\n$$\n\\frac{d n(r)}{dr} = \\frac{d}{dr} \\left( n_0 \\exp(-\\alpha r^2) \\right) = n_0 \\exp(-\\alpha r^2) (-2\\alpha r)\n$$\nRecognizing that $n_0 \\exp(-\\alpha r^2)$ is the density $n(r)$ itself, we have:\n$$\n\\frac{d n(r)}{dr} = -2\\alpha r n(r)\n$$\nThe gradient vector is therefore $\\nabla n(\\mathbf{r}) = -2\\alpha r n(r) \\hat{\\mathbf{r}}$. The magnitude of the gradient is:\n$$\n|\\nabla n(\\mathbf{r})| = |-2\\alpha r n(r)| = 2\\alpha r n(r)\n$$\nsince the parameters $\\alpha$ and $n_0$ are positive, and $r \\ge 0$.\n\nNow, we substitute this expression for $|\\nabla n(\\mathbf{r})|$ into our equation for $s(\\mathbf{r})$:\n$$\ns(\\mathbf{r}) = \\frac{2\\alpha r n(r)}{2 (3\\pi^2)^{1/3} n(r)^{4/3}}\n$$\nSimplifying this expression by canceling the factor of $2$ and combining the terms involving $n(r)$:\n$$\ns(r) = \\frac{\\alpha r}{(3\\pi^2)^{1/3} n(r)^{1/3}}\n$$\nThe dependence is only on the radial distance $r$, as expected from spherical symmetry. The final step is to substitute the explicit form of $n(r)$:\n$$\nn(r)^{1/3} = \\left( n_0 \\exp(-\\alpha r^2) \\right)^{1/3} = n_0^{1/3} \\exp\\left(-\\frac{\\alpha r^2}{3}\\right)\n$$\nInserting this into the expression for $s(r)$:\n$$\ns(r) = \\frac{\\alpha r}{(3\\pi^2)^{1/3} n_0^{1/3} \\exp\\left(-\\frac{\\alpha r^2}{3}\\right)}\n$$\nThis can be written in a more compact closed form by combining constants and moving the exponential term to the numerator:\n$$\ns(r) = \\frac{\\alpha r}{\\left(3 \\pi^2 n_0\\right)^{1/3}} \\exp\\left(\\frac{\\alpha r^2}{3}\\right)\n$$\nThis is the final closed-form expression for the reduced density gradient.\n\nAnalysis of the behavior of $s(r)$:\n$1$. Dependence on $r$:\nFor small $r$ ($r \\to 0$): The term $\\exp(\\frac{\\alpha r^2}{3})$ approaches $1$. Therefore, $s(r) \\approx \\frac{\\alpha r}{(3 \\pi^2 n_0)^{1/3}}$. The reduced gradient starts at $s(0)=0$ and increases linearly with $r$. This is physically correct, as at the center of a symmetric distribution, the gradient is zero, implying zero inhomogeneity.\nFor large $r$ ($r \\to \\infty$): Both the linear term $r$ and the exponential term $\\exp(\\frac{\\alpha r^2}{3})$ go to infinity. The exponential term dominates, causing $s(r)$ to grow extremely rapidly. This indicates that the tail of the electron distribution is a region of very high inhomogeneity, where the density changes rapidly on the scale of the local Fermi wavelength.\n\n$2$. Dependence on $\\alpha$: The parameter $\\alpha$ controls the localization of the density; a larger $\\alpha$ corresponds to a more sharply peaked, localized distribution. For any fixed radius $r > 0$, the function $s(r)$ is an increasing function of $\\alpha$. This is because both the prefactor $\\alpha$ and the argument of the exponential, $\\frac{\\alpha r^2}{3}$, increase with $\\alpha$. This aligns with the physical intuition that a more rapidly changing density profile (larger $\\alpha$) corresponds to a greater degree of inhomogeneity.\n\n$3$. Dependence on $n_0$: The quantity $s(r)$ is proportional to $n_0^{-1/3}$. Increasing the peak density $n_0$ while keeping the shape parameter $\\alpha$ fixed leads to a decrease in the reduced gradient $s$ at all points $r$. This reflects the fact that in regions of higher electron density, the system behaves more like a homogeneous electron gas, and thus the same absolute gradient $|\\nabla n|$ is considered less significant.",
            "answer": "$$\n\\boxed{\\frac{\\alpha r \\exp\\left(\\frac{\\alpha r^2}{3}\\right)}{\\left(3 \\pi^2 n_0\\right)^{1/3}}}\n$$"
        },
        {
            "introduction": "Simply calculating the reduced density gradient $s(\\mathbf{r})$ is not enough; we must also understand its physical implications for the exchange-correlation energy. This exercise challenges you to analyze the behavior of $s(\\mathbf{r})$ in two critical physical regimes: the slowly-varying, bulk-like limit and the asymptotic tail of a finite system. By connecting these limits to the design of the exchange enhancement factor $F_{x}(s)$, you will gain insight into the fundamental constraints that guide the construction of modern GGA functionals. ",
            "id": "3811166",
            "problem": "In multiscale materials simulation, exchange-correlation models must remain accurate across regimes ranging from bulk-like, slowly varying electron densities to the asymptotic tails of finite systems. Consider a spin-unpolarized electron density field $n(\\mathbf{r})$ and define the reduced density gradient used in Generalized Gradient Approximation (GGA) exchange as $s(\\mathbf{r}) \\equiv \\dfrac{|\\nabla n(\\mathbf{r})|}{2 k_{F}(\\mathbf{r})\\, n(\\mathbf{r})}$, where $k_{F}(\\mathbf{r}) \\equiv \\big(3 \\pi^{2} n(\\mathbf{r})\\big)^{1/3}$ is the local Fermi wavevector. The GGA exchange energy takes the semilocal form $E_{x}[n] = \\int \\mathrm{d}^{3}r\\, e_{x}^{\\mathrm{LDA}}(n(\\mathbf{r}))\\, F_{x}(s(\\mathbf{r}))$, where $e_{x}^{\\mathrm{Local\\,Density\\,Approximation}}(n) \\equiv -C_{x}\\, n^{4/3}$ with $C_{x} \\equiv \\dfrac{3}{4}\\left(\\dfrac{3}{\\pi}\\right)^{1/3}$, and $F_{x}(s)$ is the exchange enhancement factor. For a slowly varying density, assume a characteristic length $L$ over which $n$ varies such that $|\\nabla n| \\sim n/L$. For a finite bound system, assume the Kohn–Sham density tail is exponential, $n(r) \\sim A\\, e^{-2 \\kappa r}$ as $r \\to \\infty$, with $A>0$ and $\\kappa>0$ determined by the ionization threshold.\n\nBased only on these standard definitions and asymptotic forms, identify all correct statements about the limits $s \\to 0$ and $s \\to \\infty$ and their implications for GGA exchange enhancement in realistic multiscale settings.\n\nA. For a slowly varying density characterized by a length $L$ with $k_{F} L \\gg 1$, one finds $s \\sim 1/(k_{F} L)$ and thus $s \\to 0$ as $L \\to \\infty$.\n\nB. In the asymptotic tail $n(r) \\sim A e^{-2 \\kappa r}$, the ratio $|\\nabla n|/n \\to 2 \\kappa$, so $s \\to 2 \\kappa$ is finite as $r \\to \\infty$.\n\nC. Recovery of the uniform electron gas limit in a Generalized Gradient Approximation (GGA) requires $F_{x}(0) = 1$, and many widely used GGAs impose a finite saturation $F_{x}(s \\to \\infty) = 1 + \\kappa$ (with a constant $\\kappa>0$) to enforce global constraints on $E_{x}[n]$ such as the Lieb–Oxford bound.\n\nD. Because $e_{x}^{\\mathrm{LDA}}(n) \\propto n^{4/3}$ decays to $0$ in the tail of finite systems, a divergence of $F_{x}(s)$ as $s \\to \\infty$ can never impact the integrated exchange energy or the exchange–correlation potential and is therefore harmless.\n\nE. For slowly varying densities, the second-order gradient expansion demands $F_{x}(s) = 1 + \\mu s^{2} + \\mathcal{O}(s^{4})$ with no linear term in $s$, where $\\mu$ is a constant fixed by the gradient expansion of the uniform electron gas.\n\nF. In the asymptotic tail of finite systems, the divergence $s \\to \\infty$ implies that a bounded enhancement factor $F_{x}(s)$ yields the exact asymptotic exchange–correlation potential $v_{xc}(r) \\sim -1/r$.\n\nSelect all that apply.",
            "solution": "**A. For a slowly varying density characterized by a length $L$ with $k_{F} L \\gg 1$, one finds $s \\sim 1/(k_{F} L)$ and thus $s \\to 0$ as $L \\to \\infty$.**\n\nUsing the definition of the reduced density gradient, $s(\\mathbf{r}) \\equiv \\dfrac{|\\nabla n(\\mathbf{r})|}{2 k_{F}(\\mathbf{r})\\, n(\\mathbf{r})}$, and the assumption for a slowly varying density, $|\\nabla n| \\sim n/L$, we can write:\n$$s \\sim \\frac{n/L}{2k_F n} = \\frac{1}{2k_F L}$$\nThe statement uses the notation $s \\sim 1/(k_{F} L)$, which correctly captures the scaling behavior, omitting the constant factor of $1/2$. The limit $L \\to \\infty$ corresponds to the density becoming uniform, which is the definition of the slowly varying limit. In this limit, $s \\to 0$. The condition $k_F L \\gg 1$ means the length scale of density variation $L$ is much larger than the typical electronic length scale $1/k_F$, which is precisely the condition for the density to be considered slowly varying. Thus, the statement is physically and mathematically correct.\n\n**Verdict: Correct.**\n\n**B. In the asymptotic tail $n(r) \\sim A e^{-2 \\kappa r}$, the ratio $|\\nabla n|/n \\to 2 \\kappa$, so $s \\to 2 \\kappa$ is finite as $r \\to \\infty$.**\n\nGiven the asymptotic form of the density for a finite system, $n(r) \\sim A e^{-2 \\kappa r}$ for $r \\to \\infty$. The gradient's magnitude is $|\\nabla n(r)| = |\\frac{\\mathrm{d}n}{\\mathrm{d}r}| \\sim |-2\\kappa A e^{-2\\kappa r}| = 2\\kappa A e^{-2\\kappa r}$.\nThe ratio $|\\nabla n|/n$ is:\n$$\\frac{|\\nabla n(r)|}{n(r)} \\sim \\frac{2\\kappa A e^{-2\\kappa r}}{A e^{-2\\kappa r}} = 2\\kappa$$\nAs $r \\to \\infty$, this ratio indeed approaches the constant $2\\kappa$. However, the reduced gradient $s$ also depends on the local Fermi wavevector $k_F(r) = (3\\pi^2 n(r))^{1/3}$.\n$$s(r) = \\frac{|\\nabla n(r)|}{2 k_F(r) n(r)} = \\frac{1}{2k_F(r)} \\frac{|\\nabla n(r)|}{n(r)}$$\nAs $r \\to \\infty$, $n(r) \\to 0$, which means $k_F(r) \\to 0$. Therefore:\n$$s(r) \\sim \\frac{2\\kappa}{2 k_F(r)} = \\frac{\\kappa}{(3\\pi^2 n(r))^{1/3}} = \\frac{\\kappa}{(3\\pi^2)^{1/3}} (A e^{-2\\kappa r})^{-1/3} = \\frac{\\kappa}{(3\\pi^2 A)^{1/3}} e^{2\\kappa r/3}$$\nSince $\\kappa > 0$, the term $e^{2\\kappa r/3}$ diverges as $r \\to \\infty$. Thus, $s \\to \\infty$ in the asymptotic tail of a finite system. The statement that $s$ approaches a finite value is incorrect.\n\n**Verdict: Incorrect.**\n\n**C. Recovery of the uniform electron gas limit in a Generalized Gradient Approximation (GGA) requires $F_{x}(0) = 1$, and many widely used GGAs impose a finite saturation $F_{x}(s \\to \\infty) = 1 + \\kappa$ (with a constant $\\kappa>0$) to enforce global constraints on $E_{x}[n]$ such as the Lieb–Oxford bound.**\n\nThis statement consists of two parts.\n1.  For a uniform electron gas (UEG), the density $n$ is constant, so $\\nabla n = 0$ and $s = 0$. By design, any valid approximation for the exchange-correlation energy must correctly reproduce the known energy of the UEG. The exact exchange energy for the UEG is given by the Local Density Approximation (LDA). For a GGA to recover the LDA result in this limit, we must have $E_x^{\\mathrm{GGA}}[n_{\\mathrm{UEG}}] = E_x^{\\mathrm{LDA}}[n_{\\mathrm{UEG}}]$. This means $\\int e_x^{\\mathrm{LDA}}(n) F_x(0) \\, \\mathrm{d}^3r = \\int e_x^{\\mathrm{LDA}}(n) \\, \\mathrm{d}^3r$, which requires $F_x(0)=1$. This part is correct.\n2.  The Lieb-Oxford bound is a rigorous lower bound on the exchange-correlation energy. It has been shown that for a GGA to satisfy this bound for any possible density, the exchange enhancement factor $F_x(s)$ must be bounded. Early GGAs with diverging $F_x(s)$ were found to violate this bound. Consequently, modern GGAs (e.g., PBE) are constructed such that $F_x(s)$ saturates to a finite value as $s \\to \\infty$. The form $F_x(s \\to \\infty) = 1+\\kappa$ (where $\\kappa$ is a parameter of the functional, e.g., $\\kappa=0.804$ for PBE) is a characteristic of this design choice. This part of the statement accurately describes a key principle in modern functional development.\n\nBoth parts of the statement are correct.\n\n**Verdict: Correct.**\n\n**D. Because $e_{x}^{\\mathrm{LDA}}(n) \\propto n^{4/3}$ decays to $0$ in the tail of finite systems, a divergence of $F_{x}(s)$ as $s \\to \\infty$ can never impact the integrated exchange energy or the exchange–correlation potential and is therefore harmless.**\n\nThis statement is incorrect on multiple grounds.\n1.  Impact on integrated energy $E_x$: The exchange energy density is $e_x^{\\mathrm{GGA}} = e_x^{\\mathrm{LDA}}(n) F_x(s) = -C_x n^{4/3} F_x(s)$. In the tail ($r \\to \\infty$), $n \\sim e^{-2\\kappa r}$ and $s \\sim n^{-1/3} \\sim e^{2\\kappa r/3}$. If $F_x(s)$ diverges, for instance as $s^\\alpha$ with $\\alpha>0$, the integrand behaves as $n^{4/3} s^\\alpha \\sim (e^{-2\\kappa r})^{4/3} (e^{2\\kappa r/3})^\\alpha = e^{-(8-2\\alpha)\\kappa r/3}$. For the total energy integral $\\int 4\\pi r^2 e_x^{\\mathrm{GGA}} \\, \\mathrm{d}r$ to converge, the exponential decay must be sufficiently fast. If $\\alpha$ is too large (e.g., $\\alpha \\ge 4$), the integral could diverge. So, a diverging $F_x(s)$ can indeed impact the integrated energy.\n2.  Impact on the exchange-correlation potential $v_{xc}$: The potential $v_{xc}(\\mathbf{r}) = \\delta E_{xc}[n] / \\delta n(\\mathbf{r})$. This functional derivative depends on $F_x(s)$ and its derivative $F'_x(s)$. The behavior of $F_x(s)$ for large $s$ is crucial for the asymptotic behavior of $v_{xc}(r)$ as $r \\to \\infty$. It is a well-known fact that for semi-local functionals like GGAs, the potential decays exponentially to zero, irrespective of whether $F_x(s)$ diverges or is bounded. This is in contrast to the exact potential, which should decay as $-1/r$. The incorrect asymptotic behavior of the potential is a major deficiency of GGAs, and it is directly linked to the semi-local form of the functional, i.e., its dependence on $s$. Therefore, the behavior of $F_x(s)$ as $s \\to \\infty$ is far from \"harmless\"; it is a critical aspect of the functional's performance, particularly for the potential.\n\n**Verdict: Incorrect.**\n\n**E. For slowly varying densities, the second-order gradient expansion demands $F_{x}(s) = 1 + \\mu s^{2} + \\mathcal{O}(s^{4})$ with no linear term in $s$, where $\\mu$ is a constant fixed by the gradient expansion of the uniform electron gas.**\n\nFor a slowly varying density, the exchange energy can be systematically expanded in gradients of the density, known as the Gradient Expansion Approximation (GEA).\n$$E_x[n] = \\int e_x^{\\mathrm{LDA}}(n) \\left(1 + \\mu_{GEA} s^2 + \\dots \\right) \\mathrm{d}^3 r$$\nThe expansion must be in even powers of $|\\nabla n|$ (and thus even powers of $s$) due to inversion symmetry: the energy cannot depend on the direction of the gradient, only its magnitude squared. Therefore, a term linear in $s$ is forbidden. For small $s$, the Taylor expansion of the GGA enhancement factor is $F_x(s) = F_x(0) + F_x'(0) s + \\frac{1}{2}F_x''(0) s^2 + \\dots$. To match the GEA, we must have $F_x(0)=1$ (recovering LDA) and $F_x'(0)=0$. This leads to the form $F_x(s) = 1 + \\mu s^2 + \\mathcal{O}(s^4)$, where $\\mu = \\frac{1}{2}F_x''(0)$. The value of the constant $\\mu$ is determined by requiring the GGA to reproduce the second-order gradient correction for the UEG, i.e., $\\mu = \\mu_{GEA} = 10/81$. The statement correctly describes this fundamental constraint on the small-$s$ behavior of any GGA functional.\n\n**Verdict: Correct.**\n\n**F. In the asymptotic tail of finite systems, the divergence $s \\to \\infty$ implies that a bounded enhancement factor $F_{x}(s)$ yields the exact asymptotic exchange–correlation potential $v_{xc}(r) \\sim -1/r$.**\n\nThis statement is the opposite of what is true. The exact exchange-correlation potential for a finite system must decay as $v_{xc}(r) \\sim -1/r$ for large $r$. However, GGA functionals, by virtue of their semi-local nature (depending only on $n(\\mathbf{r})$ and $\\nabla n(\\mathbf{r})$), cannot reproduce this behavior. The GGA potential is given by $v_x^{\\mathrm{GGA}} = \\delta E_x^{\\mathrm{GGA}} / \\delta n$. All terms in this expression decay exponentially to zero as $r \\to \\infty$, because they are constructed from $n$ and its gradients, which decay exponentially. A bounded $F_x(s)$ does not fix this problem; in fact, a bounded $F_x(s)$ is a typical feature of standard GGAs that exhibit this incorrect exponential decay. Obtaining the correct $-1/r$ tail requires a functional with non-local dependence on the density or specific asymptotic corrections, neither of which is a feature of the standard GGA form described.\n\n**Verdict: Incorrect.**\n\n### Summary\nThe correct statements are A, C, and E.",
            "answer": "$$\\boxed{ACE}$$"
        },
        {
            "introduction": "The final step in mastering a theoretical model is to implement it in a practical, computational setting. This exercise guides you through the process of writing code to calculate the GGA exchange energy for a test system, translating the mathematical formulas for $s(\\mathbf{r})$ and the PBE enhancement factor into a numerical algorithm. By comparing the results from numerical gradients of varying accuracy to a semi-analytic reference, you will directly confront the critical issue of discretization error and appreciate the importance of robust numerical methods in materials simulation. ",
            "id": "3811149",
            "problem": "You are to implement and analyze the discretization error in the generalized gradient approximation exchange energy for a three-dimensional periodic test electron density. The goal is to compare exchange energies computed using finite-difference gradients of varying order against energies computed using analytic derivatives of the same test density. All energies must be expressed in atomic units (Hartree).\n\nStart from the foundational base of Density Functional Theory (DFT), where the exchange energy in the generalized gradient approximation (GGA) is defined by an integral of an energy density that depends on both the electron density and its gradient. Use the following fundamental definitions:\n\n- The exchange energy in the generalized gradient approximation (GGA) is\n$$\nE_{x}^{\\mathrm{GGA}} = \\int_{\\Omega} \\varepsilon_{x}^{\\mathrm{LDA}}(n(\\mathbf{r})) \\, F(s(\\mathbf{r})) \\, d^3\\mathbf{r},\n$$\nwhere $\\Omega$ is the simulation domain, $\\varepsilon_{x}^{\\mathrm{LDA}}(n) = -C_x \\, n^{4/3}$ is the local density approximation exchange energy density with the constant $C_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$ in atomic units, and $F(s)$ is the exchange enhancement factor of the generalized gradient approximation.\n\n- Use the canonical Perdew–Burke–Ernzerhof (PBE) exchange enhancement factor with parameters $\\mu = 0.21951$ and $\\kappa = 0.804$:\n$$\nF(s) = 1 + \\kappa - \\frac{\\kappa}{1 + (\\mu/\\kappa)\\, s^2}.\n$$\n\n- The reduced gradient $s(\\mathbf{r})$ is defined by\n$$\ns(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_F(\\mathbf{r}) n(\\mathbf{r})}, \\quad k_F(\\mathbf{r}) = \\left(3 \\pi^2 n(\\mathbf{r})\\right)^{1/3}.\n$$\n\nUse a three-dimensional periodic cubic domain $\\Omega = [0,L]^3$ with periodic boundary conditions and a uniform grid with $N$ points per dimension, grid spacing $h = L/N$, and cell volume $\\Delta V = h^3$. Define the test electron density by\n$$\nn(x,y,z) = n_0 \\left[ 1 + a \\cos(k_x x) \\cos(k_y y) \\cos(k_z z) \\right],\n$$\nwhere $n_0 > 0$, $0 < a < 1$, and the wave vectors are $k_x = \\frac{2\\pi m_x}{L}$, $k_y = \\frac{2\\pi m_y}{L}$, $k_z = \\frac{2\\pi m_z}{L}$ with integer mode numbers $m_x, m_y, m_z \\ge 0$. This choice ensures $n(x,y,z) > 0$ everywhere provided $n_0 (1 - a) > 0$, and the density is compatible with periodic boundary conditions.\n\nCompute two versions of the exchange energy:\n1. An \"analytic-gradient\" reference energy $E_{x}^{\\mathrm{ref}}$ by evaluating $|\\nabla n|$ from analytic derivatives of the density (from calculus), substituting into the above $E_{x}^{\\mathrm{GGA}}$ integrand on the grid, and integrating via the uniform Riemann sum over the grid points.\n2. A \"finite-difference\" energy $E_{x}^{\\mathrm{FD}}$ by approximating $|\\nabla n|$ using central finite differences of order $p \\in \\{2,4,6\\}$ for first derivatives, with periodic boundary conditions and the following one-dimensional stencils applied independently along each axis:\n   - Order $p = 2$:\n   $$\n   f'(x) \\approx \\frac{f(x+h) - f(x-h)}{2h}.\n   $$\n   - Order $p = 4$:\n   $$\n   f'(x) \\approx \\frac{-f(x+2h) + 8f(x+h) - 8f(x-h) + f(x-2h)}{12h}.\n   $$\n   - Order $p = 6$:\n   $$\n   f'(x) \\approx \\frac{f(x-3h) - 9f(x-2h) + 45f(x-h) - 45f(x+h) + 9f(x+2h) - f(x+3h)}{60h}.\n   $$\n\nFor each case, define the discretization error as the absolute difference\n$$\n\\Delta E = \\left| E_{x}^{\\mathrm{FD}} - E_{x}^{\\mathrm{ref}} \\right|.\n$$\n\nYour program must implement the above definitions and produce $\\Delta E$ for a set of test cases that explore resolution, derivative order, and spectral content. Use the following test suite, where each tuple is $(N, p, L, n_0, a, m_x, m_y, m_z)$:\n\n- Case $1$ (happy path): $(64, 2, 10.0, 0.05, 0.30, 2, 3, 4)$.\n- Case $2$ (higher-order on same grid): $(64, 4, 10.0, 0.05, 0.30, 2, 3, 4)$.\n- Case $3$ (coarse grid, moderate modes): $(16, 2, 10.0, 0.05, 0.30, 2, 2, 2)$.\n- Case $4$ (coarse grid, higher-order): $(16, 6, 10.0, 0.05, 0.30, 2, 2, 2)$.\n- Case $5$ (higher spectral content near the grid limit): $(48, 4, 10.0, 0.05, 0.20, 12, 11, 10)$.\n\nAll lengths $L$ are in bohr, all densities $n_0$ are in bohr$^{-3}$, and the final energies $E_{x}^{\\mathrm{ref}}$, $E_{x}^{\\mathrm{FD}}$, and errors $\\Delta E$ must be in Hartree.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list should contain the five $\\Delta E$ values (in Hartree) corresponding to the five test cases, in the same order as listed above, for example, $[e_1,e_2,e_3,e_4,e_5]$. No other text should be printed.",
            "solution": "The objective is to compute the absolute error $\\Delta E = |E_{x}^{\\mathrm{FD}} - E_{x}^{\\mathrm{ref}}|$ between the exchange energy calculated with a finite-difference gradient, $E_{x}^{\\mathrm{FD}}$, and a reference energy calculated with an analytic gradient, $E_{x}^{\\mathrm{ref}}$.\n\nThe GGA exchange energy is given by the integral:\n$$\nE_{x}^{\\mathrm{GGA}} = \\int_{\\Omega} \\varepsilon_{x}^{\\mathrm{LDA}}(n(\\mathbf{r})) \\, F(s(\\mathbf{r})) \\, d^3\\mathbf{r}\n$$\nThe calculation is performed on a periodic cubic domain $\\Omega = [0,L]^3$, discretized into a uniform grid of $N \\times N \\times N$ points. The grid spacing is $h = L/N$ and the volume element for numerical integration is $\\Delta V = h^3$.\n\nThe components of the integrand are:\n1.  The Local Density Approximation (LDA) exchange energy density:\n    $$\n    \\varepsilon_{x}^{\\mathrm{LDA}}(n) = -C_x \\, n^{4/3}, \\quad \\text{with } C_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}\n    $$\n2.  The Perdew–Burke–Ernzerhof (PBE) exchange enhancement factor, which modifies the LDA energy based on the local gradient of the density:\n    $$\n    F(s) = 1 + \\kappa - \\frac{\\kappa}{1 + (\\mu/\\kappa)\\, s^2}\n    $$\n    using the given parameters $\\mu = 0.21951$ and $\\kappa = 0.804$.\n3.  The reduced density gradient $s(\\mathbf{r})$, a dimensionless measure of the density's variation:\n    $$\n    s(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_F(\\mathbf{r}) n(\\mathbf{r})}\n    $$\n    where $k_F(\\mathbf{r}) = (3 \\pi^2 n(\\mathbf{r}))^{1/3}$ is the local Fermi wavevector.\n\nThe test electron density $n(\\mathbf{r})$ is defined on the grid coordinates $(x,y,z)$ as:\n$$\nn(x,y,z) = n_0 \\left[ 1 + a \\cos(k_x x) \\cos(k_y y) \\cos(k_z z) \\right]\n$$\nwith wave vectors $k_i = 2\\pi m_i/L$ for $i \\in \\{x,y,z\\}$.\n\nThe numerical implementation proceeds as follows:\n\n**Step 1: Grid and Density Generation**\nFor each test case $(N, p, L, n_0, a, m_x, m_y, m_z)$, a 3D grid of coordinates is generated. We use `numpy.meshgrid` to create coordinate arrays $x, y, z$ spanning the domain $[0, L)$ with $N$ points along each axis. The test density $n(\\mathbf{r})$ is then evaluated at each point on this grid, yielding a 3D array `n_grid`.\n\n**Step 2: Reference Energy Calculation ($E_{x}^{\\mathrm{ref}}$)**\nThis calculation uses the exact, analytical gradient of the test density. The partial derivatives are:\n$$\n\\frac{\\partial n}{\\partial x} = -n_0 a k_x \\sin(k_x x) \\cos(k_y y) \\cos(k_z z) \\\\\n\\frac{\\partial n}{\\partial y} = -n_0 a k_y \\cos(k_x x) \\sin(k_y y) \\cos(k_z z) \\\\\n\\frac{\\partial n}{\\partial z} = -n_0 a k_z \\cos(k_x x) \\cos(k_y y) \\sin(k_z z)\n$$\nThese derivatives are evaluated on the grid to form three arrays. The magnitude of the gradient, $|\\nabla n|_{\\mathrm{ref}} = \\sqrt{(\\partial n/\\partial x)^2 + (\\partial n/\\partial y)^2 + (\\partial n/\\partial z)^2}$, is then computed pointwise.\nWith both $n(\\mathbf{r})$ and $|\\nabla n|_{\\mathrm{ref}}$ available on the grid, we compute the arrays for $k_F(\\mathbf{r})$, $s(\\mathbf{r})$, $F(s(\\mathbf{r}))$, and $\\varepsilon_{x}^{\\mathrm{LDA}}(n(\\mathbf{r}))$. The integrand for the reference energy is the product $\\varepsilon_{x}^{\\mathrm{LDA}} \\cdot F(s)$. The integral is then computed as a Riemann sum over all grid points:\n$$\nE_{x}^{\\mathrm{ref}} = \\Delta V \\sum_{i,j,k} \\left( \\varepsilon_{x}^{\\mathrm{LDA}} F(s) \\right)_{i,j,k}\n$$\n\n**Step 3: Finite-Difference Energy Calculation ($E_{x}^{\\mathrm{FD}}$)**\nThe procedure for $E_{x}^{\\mathrm{FD}}$ is identical to that for $E_{x}^{\\mathrm{ref}}$, with the crucial exception that the gradient magnitude, $|\\nabla n|_{\\mathrm{FD}}$, is computed using numerical finite differences. We implement the specified central difference stencils of order $p \\in \\{2, 4, 6\\}$ to approximate the partial derivatives $(\\partial n/\\partial x, \\partial n/\\partial y, \\partial n/\\partial z)$. Periodic boundary conditions are handled efficiently by using `numpy.roll` to shift the `n_grid` array. For a given axis, the derivative is computed by applying the one-dimensional stencil. For example, for order $p=2$, the derivative along $x$ (axis $0$) is:\n$$\n\\frac{\\partial n}{\\partial x} \\approx \\frac{\\text{roll}(n, -1, \\text{axis}=0) - \\text{roll}(n, 1, \\text{axis}=0)}{2h}\n$$\nAfter computing the three partial derivative arrays, the gradient magnitude $|\\nabla n|_{\\mathrm{FD}}$ is found, and the subsequent calculation of $s(\\mathbf{r})$, $F(s)$, the integrand, and finally $E_{x}^{\\mathrm{FD}}$ follows the same path as in Step 2.\n\n**Step 4: Error Calculation**\nThe final discretization error for each test case is the absolute difference between the two computed energies: $\\Delta E = |E_{x}^{\\mathrm{FD}} - E_{x}^{\\mathrm{ref}}|$.\n\nThis entire process is encapsulated in a function that is called for each of the five test cases, and the resulting $\\Delta E$ values are collected.\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the calculation of discretization error for GGA exchange energy.\n    \"\"\"\n    # Define physical and PBE constants in atomic units\n    C_x = (3.0 / 4.0) * (3.0 / np.pi)**(1.0 / 3.0)\n    mu = 0.21951\n    kappa = 0.804\n\n    def finite_difference_gradient(n_grid, h, p):\n        \"\"\"\n        Computes the gradient of a 3D field using periodic finite differences.\n        \"\"\"\n        grad_components = []\n        for axis in range(3):  # 0 for x, 1 for y, 2 for z\n            if p == 2:\n                # Order p=2 stencil: [f(x+h) - f(x-h)] / 2h\n                num = (np.roll(n_grid, -1, axis=axis) - np.roll(n_grid, 1, axis=axis))\n                den = 2.0 * h\n            elif p == 4:\n                # Order p=4 stencil: [-f(x+2h)+8f(x+h)-8f(x-h)+f(x-2h)] / 12h\n                num = (-np.roll(n_grid, -2, axis=axis) + 8 * np.roll(n_grid, -1, axis=axis) -\n                       8 * np.roll(n_grid, 1, axis=axis) + np.roll(n_grid, 2, axis=axis))\n                den = 12.0 * h\n            elif p == 6:\n                # Order p=6 stencil from problem statement\n                num = (np.roll(n_grid, 3, axis=axis) - 9 * np.roll(n_grid, 2, axis=axis) +\n                       45 * np.roll(n_grid, 1, axis=axis) - 45 * np.roll(n_grid, -1, axis=axis) +\n                       9 * np.roll(n_grid, -2, axis=axis) - np.roll(n_grid, -3, axis=axis))\n                den = 60.0 * h\n            else:\n                raise ValueError(f\"Unsupported finite difference order p={p}\")\n            \n            grad_components.append(num / den)\n        \n        return grad_components[0], grad_components[1], grad_components[2]\n\n    def calculate_energy(n, grad_n_mag, delta_V):\n        \"\"\"\n        Calculates the PBE exchange energy given density and its gradient magnitude.\n        \"\"\"\n        # Ensure n > 0 to avoid numerical issues\n        n = np.maximum(n, 1e-12)\n        \n        # Fermi wavevector\n        kF = (3 * np.pi**2 * n)**(1.0/3.0)\n        \n        # Reduced gradient s\n        # Denominator is 2*kF*n = 2*(3*pi^2)^(1/3)*n^(4/3), safe for n>0\n        s = grad_n_mag / (2 * kF * n)\n        \n        # PBE enhancement factor F(s)\n        F_s = 1.0 + kappa - kappa / (1.0 + (mu / kappa) * s**2)\n        \n        # LDA exchange energy density\n        eps_x_lda = -C_x * n**(4.0 / 3.0)\n        \n        # Integrand\n        integrand = eps_x_lda * F_s\n        \n        # Integrate via Riemann sum\n        energy = np.sum(integrand) * delta_V\n        \n        return energy\n\n    def compute_error_for_case(N, p, L, n0, a, mx, my, mz):\n        \"\"\"\n        Main computation for a single test case.\n        \"\"\"\n        # 1. Setup grid and parameters\n        h = L / float(N)\n        delta_V = h**3\n        grid_1d = np.linspace(0, L, N, endpoint=False)\n        x, y, z = np.meshgrid(grid_1d, grid_1d, grid_1d, indexing='ij')\n        \n        kx = 2.0 * np.pi * mx / L\n        ky = 2.0 * np.pi * my / L\n        kz = 2.0 * np.pi * mz / L\n\n        # 2. Evaluate density on the grid\n        cos_x = np.cos(kx * x)\n        cos_y = np.cos(ky * y)\n        cos_z = np.cos(kz * z)\n        n_grid = n0 * (1.0 + a * cos_x * cos_y * cos_z)\n\n        # 3. Reference energy (using analytic gradient)\n        sin_x = np.sin(kx * x)\n        sin_y = np.sin(ky * y)\n        sin_z = np.sin(kz * z)\n        \n        dn_dx_ref = -n0 * a * kx * sin_x * cos_y * cos_z\n        dn_dy_ref = -n0 * a * ky * cos_x * sin_y * cos_z\n        dn_dz_ref = -n0 * a * kz * cos_x * cos_y * sin_z\n        \n        grad_n_mag_ref = np.sqrt(dn_dx_ref**2 + dn_dy_ref**2 + dn_dz_ref**2)\n        E_ref = calculate_energy(n_grid, grad_n_mag_ref, delta_V)\n\n        # 4. Finite-difference energy\n        dn_dx_fd, dn_dy_fd, dn_dz_fd = finite_difference_gradient(n_grid, h, p)\n        grad_n_mag_fd = np.sqrt(dn_dx_fd**2 + dn_dy_fd**2 + dn_dz_fd**2)\n        E_fd = calculate_energy(n_grid, grad_n_mag_fd, delta_V)\n\n        # 5. Compute absolute error\n        return np.abs(E_fd - E_ref)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, p, L, n0, a, mx, my, mz)\n        (64, 2, 10.0, 0.05, 0.30, 2, 3, 4),\n        (64, 4, 10.0, 0.05, 0.30, 2, 3, 4),\n        (16, 2, 10.0, 0.05, 0.30, 2, 2, 2),\n        (16, 6, 10.0, 0.05, 0.30, 2, 2, 2),\n        (48, 4, 10.0, 0.05, 0.20, 12, 11, 10),\n    ]\n\n    results = []\n    for case in test_cases:\n        error = compute_error_for_case(*case)\n        results.append(f\"{error:.10e}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\n# solve()\n```",
            "answer": "[1.3283995897e-03,3.7745785502e-06,2.3780362240e-03,4.1953288164e-04,1.1396113973e-02]"
        }
    ]
}