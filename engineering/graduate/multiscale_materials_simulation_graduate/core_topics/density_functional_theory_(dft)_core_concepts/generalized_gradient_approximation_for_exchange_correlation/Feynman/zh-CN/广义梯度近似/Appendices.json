{
    "hands_on_practices": [
        {
            "introduction": "在深入研究广义梯度近似 (GGA) 的复杂性之前，让我们通过一个基础练习来热身。这个练习旨在为 GGA 的核心变量——约化密度梯度 $s$——建立物理直觉。通过为一个高斯形式的局域电子密度推导 $s$ 的解析表达式 ()，你将亲身体会到 $s$ 是如何量化电子密度不均匀性的。",
            "id": "3811143",
            "problem": "在多尺度材料模拟中，密度泛函理论 (DFT) 中用于交换相关的广义梯度近似 (GGA) 通过引入电子密度的空间变化，改进了局域密度近似。考虑一个代表缺陷周围介观嵌入区域的球对称局域电子密度，其模型为高斯函数 $n(\\mathbf{r}) = n_0 \\exp(-\\alpha r^2)$，其中 $r = |\\mathbf{r}|$，$n_0 > 0$ 是峰值密度，$\\alpha > 0$ 设定了局域化尺度。\n\n从适用于 GGA 的基本定义出发，包括均匀电子气的费米波矢 $k_{\\mathrm{F}}$ 和用于表征非均匀性的约化密度梯度，推导给定 $n(\\mathbf{r})$ 的约化密度梯度 $s(\\mathbf{r})$ 的显式闭式表达式。然后，在同一推导过程中，分析 $s$ 如何随 $r$ 和 $\\alpha$ 变化，包括 $r$ 很小和 $r$ 很大时的极限行为。\n\n将最终答案表示为 $s(r)$ 关于 $r$、$n_0$ 和 $\\alpha$ 的单一闭式解析表达式。无需四舍五入，且最终表达式中不应包含单位。",
            "solution": "该问题被验证为具有科学依据、适定且客观。这是密度泛函理论框架内的一个标准推导。\n\n任务是推导给定球对称电子密度 $n(\\mathbf{r}) = n_0 \\exp(-\\alpha r^2)$ 的约化密度梯度 $s(\\mathbf{r})$ 的表达式。\n\n推导从广义梯度近似 (GGA) 中使用的基本定义开始。约化密度梯度 $s(\\mathbf{r})$ 是一个衡量电子气局域非均匀性的无量纲量。其定义为：\n$$\ns(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_{\\mathrm{F}}(\\mathbf{r}) n(\\mathbf{r})}\n$$\n其中 $\\nabla n(\\mathbf{r})$ 是电子密度 $n(\\mathbf{r})$ 的梯度，$k_{\\mathrm{F}}(\\mathbf{r})$ 是局域费米波矢。\n\n局域费米波矢 $k_{\\mathrm{F}}(\\mathbf{r})$ 的定义是将位置 $\\mathbf{r}$ 处的电子气视为密度为 $n(\\mathbf{r})$ 的均匀电子气。对于三维系统，其表达式为：\n$$\nk_{\\mathrm{F}}(\\mathbf{r}) = (3\\pi^2 n(\\mathbf{r}))^{1/3}\n$$\n将 $k_{\\mathrm{F}}(\\mathbf{r})$ 的这个定义代入 $s(\\mathbf{r})$ 的表达式中，得到：\n$$\ns(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 (3\\pi^2 n(\\mathbf{r}))^{1/3} n(\\mathbf{r})} = \\frac{|\\nabla n(\\mathbf{r})|}{2 (3\\pi^2)^{1/3} n(\\mathbf{r})^{4/3}}\n$$\n接下来，我们必须计算给定电子密度 $n(\\mathbf{r}) = n_0 \\exp(-\\alpha r^2)$ 的梯度，其中 $r = |\\mathbf{r}|$。由于 $n$ 的球对称性，梯度矢量将指向径向方向 $\\hat{\\mathbf{r}}$。我们可以将梯度写为 $\\nabla n(\\mathbf{r}) = \\frac{d n(r)}{dr} \\hat{\\mathbf{r}}$。\n我们计算关于 $r$ 的导数：\n$$\n\\frac{d n(r)}{dr} = \\frac{d}{dr} \\left( n_0 \\exp(-\\alpha r^2) \\right) = n_0 \\exp(-\\alpha r^2) (-2\\alpha r)\n$$\n认识到 $n_0 \\exp(-\\alpha r^2)$ 就是密度 $n(r)$ 本身，我们有：\n$$\n\\frac{d n(r)}{dr} = -2\\alpha r n(r)\n$$\n因此，梯度矢量为 $\\nabla n(\\mathbf{r}) = -2\\alpha r n(r) \\hat{\\mathbf{r}}$。梯度的模为：\n$$\n|\\nabla n(\\mathbf{r})| = |-2\\alpha r n(r)| = 2\\alpha r n(r)\n$$\n因为参数 $\\alpha$ 和 $n_0$ 是正的，且 $r \\ge 0$。\n\n现在，我们将 $|\\nabla n(\\mathbf{r})|$ 的这个表达式代入我们关于 $s(\\mathbf{r})$ 的方程中：\n$$\ns(\\mathbf{r}) = \\frac{2\\alpha r n(r)}{2 (3\\pi^2)^{1/3} n(r)^{4/3}}\n$$\n通过消去因子 2 并合并包含 $n(r)$ 的项来化简此表达式：\n$$\ns(r) = \\frac{\\alpha r}{(3\\pi^2)^{1/3} n(r)^{1/3}}\n$$\n正如球对称性所预期的，其依赖关系只在于径向距离 $r$。最后一步是代入 $n(r)$ 的显式形式：\n$$\nn(r)^{1/3} = \\left( n_0 \\exp(-\\alpha r^2) \\right)^{1/3} = n_0^{1/3} \\exp\\left(-\\frac{\\alpha r^2}{3}\\right)\n$$\n将此式代入 $s(r)$ 的表达式中：\n$$\ns(r) = \\frac{\\alpha r}{(3\\pi^2)^{1/3} n_0^{1/3} \\exp\\left(-\\frac{\\alpha r^2}{3}\\right)}\n$$\n通过合并常数并将指数项移到分子，可以将其写成更紧凑的闭式形式：\n$$\ns(r) = \\frac{\\alpha r}{\\left(3 \\pi^2 n_0\\right)^{1/3}} \\exp\\left(\\frac{\\alpha r^2}{3}\\right)\n$$\n这就是约化密度梯度的最终闭式表达式。\n\n对 $s(r)$ 行为的分析：\n$1$. 对 $r$ 的依赖性：\n对于小 $r$ ($r \\to 0$)：项 $\\exp(\\frac{\\alpha r^2}{3})$ 趋近于 $1$。因此，$s(r) \\approx \\frac{\\alpha r}{(3 \\pi^2 n_0)^{1/3}}$。约化梯度从 $s(0)=0$ 开始，并随 $r$ 线性增加。这在物理上是正确的，因为在对称分布的中心，梯度为零，意味着非均匀性为零。\n对于大 $r$ ($r \\to \\infty$)：线形项 $r$ 和指数项 $\\exp(\\frac{\\alpha r^2}{3})$ 都趋于无穷大。指数项占主导地位，导致 $s(r)$ 极快地增长。这表明电子分布的尾部是一个非均匀性非常高的区域，其中密度在局域费米波长的尺度上变化迅速。\n\n$2$. 对 $\\alpha$ 的依赖性：参数 $\\alpha$ 控制密度的局域化程度；较大的 $\\alpha$ 对应于更尖锐、更局域化的分布。对于任何固定的半径 $r > 0$，函数 $s(r)$ 是 $\\alpha$ 的增函数。这是因为前置因子 $\\alpha$ 和指数的宗量 $\\frac{\\alpha r^2}{3}$ 都随 $\\alpha$ 的增加而增加。这与物理直觉相符，即变化更快的密度分布（更大的 $\\alpha$）对应于更高程度的非均匀性。\n\n$3$. 对 $n_0$ 的依赖性：量 $s(r)$ 与 $n_0^{-1/3}$ 成正比。在保持形状参数 $\\alpha$ 固定的情况下增加峰值密度 $n_0$，会导致所有点 $r$ 处的约化梯度 $s$ 减小。这反映了这样一个事实：在电子密度较高的区域，系统的行为更像均匀电子气，因此相同的绝对梯度 $|\\nabla n|$ 被认为不那么显著。",
            "answer": "$$\n\\boxed{\\frac{\\alpha r \\exp\\left(\\frac{\\alpha r^2}{3}\\right)}{\\left(3 \\pi^2 n_0\\right)^{1/3}}}\n$$"
        },
        {
            "introduction": "理论公式必须转化为数值算法才能在计算机上实现。这个练习将指导你思考如何将连续的 GGA 泛函离散化到一个实空间网格上，这是所有现代密度泛函理论 (DFT) 计算代码的核心任务 ()。正确处理变量定义、导数计算和边界条件是确保计算稳定性和准确性的关键。",
            "id": "3811195",
            "problem": "在科恩-沈密度泛函理论 (DFT) 中，广义梯度近似 (GGA) 内的交换相关能量泛函取决于局域电子数密度 $n(\\mathbf{r})$ 及其梯度 $\\nabla n(\\mathbf{r})$。对于一个在均匀三维实空间网格上离散化的、具有周期性或非周期性边界条件的自旋非极化体系，目标是计算 GGA 交换相关能量 $E_{xc}[n]$，以及在需要时，计算相应的交换相关势 $v_{xc}(\\mathbf{r})$。该势通过泛函求导得出，其中包含一个 $\\nabla\\cdot(\\cdot)$ 形式的散度项。用于交换的约化梯度 $s(\\mathbf{r})$ 和相关变量 $t(\\mathbf{r})$ 是基于费米波矢量和托马斯-费米屏蔽波矢量设定的局域尺度的无量纲度量；它们的精确定义必须与广泛使用的 GGA 构造保持一致。需要考虑科学一致性、数值稳定性以及对泛函求导中分部积分所产生的边界项的正确处理。\n\n哪个选项概述了一种在实空间网格上计算 $E_{xc}[n]$ 的科学上一致且数值上稳健的算法，包括 $\\nabla n$、$s$ 和 $t$ 的计算，并为 $v_{xc}(\\mathbf{r})$ 中的 $\\nabla\\cdot$ 项提供了正确的边界处理方法？\n\nA. 在所有格点 $i$ 上初始化 $n_i = n(\\mathbf{r}_i)$。在所有内部点使用二阶中心有限差分计算 $\\nabla n$，并在边界处使用周期性环绕处理。定义 $k_F(\\mathbf{r}_i) = (3\\pi^2 n_i)^{1/3}$ 和 $k_s(\\mathbf{r}_i) = \\sqrt{4 k_F(\\mathbf{r}_i)/\\pi}$。对于自旋非极化情况，设置 $s_i = \\dfrac{|\\nabla n|_i}{2 k_F(\\mathbf{r}_i) n_i}$ 和 $t_i = \\dfrac{|\\nabla n|_i}{2 k_s(\\mathbf{r}_i) n_i}$。使用选定的 GGA 计算局域交换相关能量密度 $\\varepsilon_{xc}(n_i, s_i, t_i)$，并使用适当的求积方法积分得到 $E_{xc} = \\sum_i w_i\\, n_i\\, \\varepsilon_{xc}(n_i, s_i, t_i)$。对于 $v_{xc}$，使用相同的中心差分模板计算 $\\nabla$ 和 $\\nabla\\cdot$ 来计算 $v_{xc}(\\mathbf{r}) = \\dfrac{\\partial (n\\varepsilon_{xc})}{\\partial n} - \\nabla\\cdot\\!\\left(\\dfrac{\\partial (n\\varepsilon_{xc})}{\\partial (\\nabla n)}\\right)$，并应用周期性环绕，使得净表面项因平移不变性而抵消。对于非周期性区域，对通量 $\\dfrac{\\partial (n\\varepsilon_{xc})}{\\partial (\\nabla n)}\\cdot \\hat{\\mathbf{n}} = 0$ 强制施加齐次诺伊曼边界条件，或使用与物理边界一致的虚拟单元，从而确保分部积分产生的面积分得到一致处理。\n\nB. 初始化 $n_i$。在所有地方使用一阶向前差分计算 $\\nabla n$，在最后一个格点切换到向后差分。定义 $s_i = \\dfrac{|\\nabla n|_i}{n_i}$ 和 $t_i = \\nabla^2 n_i$。计算 $\\varepsilon_{xc}(n_i, s_i, t_i)$ 并设置 $E_{xc} = \\sum_i n_i \\varepsilon_{xc}(n_i, s_i, t_i) \\Delta V$。对于 $v_{xc}$，在所有边界处用向前差分近似 $\\nabla\\cdot(\\cdot)$，并假设边界项无论边界条件如何都消失。\n\nC. 初始化 $n_i$。假设周期性边界条件，通过傅里叶微分 (快速傅里叶变换) 计算 $\\nabla n$。定义 $k_F(\\mathbf{r}_i) = (3\\pi^2 n_i)^{1/3}$ 并设置 $s_i = \\dfrac{|\\nabla n|_i}{2 k_F(\\mathbf{r}_i) n_i}$ 和 $t_i = \\dfrac{|\\nabla n|_i}{2 k_F(\\mathbf{r}_i) n_i}$。计算 $\\varepsilon_{xc}(n_i, s_i, t_i)$ 并积分得到 $E_{xc}$。对于 $v_{xc}$，在体相中使用 FFT 计算散度项，但在非周期性边界上施加零狄利克雷边界条件 $v_{xc}=0$ 而不调整通量项，因为周期性微分已确保了一致性。\n\nD. 初始化 $n_i$。在内部使用二阶中心差分计算 $\\nabla n$，在边界处使用无环绕的单侧二阶差分。定义 $s_i = \\dfrac{|\\nabla n|_i}{2 k_F(\\mathbf{r}_i) n_i}$，其中 $k_F(\\mathbf{r}_i) = (3\\pi^2 n_i)^{1/3}$，并设置 $t_i = \\dfrac{|\\nabla n|_i}{2 \\sqrt{n_i}\\, n_i}$。计算 $\\varepsilon_{xc}(n_i, s_i, t_i)$ 并积分得到 $E_{xc}$。对于 $v_{xc}$，将散度项重写为 $n$ 的拉普拉斯算子，并用中心差分计算，同时假设对于任何边界条件，表面项都可以忽略不计。\n\n选择唯一完全正确的选项。不给分步分。",
            "solution": "这个问题要求找出在实空间网格上计算广义梯度近似 (GGA) 交换相关能量 $E_{xc}[n]$ 和势 $v_{xc}(\\mathbf{r})$ 的最科学一致且数值稳健的算法。这需要正确理解 GGA 泛函形式、其变量的定义、微分的数值方法以及对泛函导数中边界项的恰当处理。\n\n让我们首先确立基本原理。\n\n1.  **GGA 能量泛函**：对于自旋非极化体系，GGA 中的交换相关能量是一个能量密度函数在全空间上的积分，该函数依赖于局域电子密度 $n(\\mathbf{r})$ 及其梯度 $\\nabla n(\\mathbf{r})$：\n    $$ E_{xc}[n] = \\int \\mathcal{E}_{xc}(n(\\mathbf{r}), \\nabla n(\\mathbf{r})) \\, d^3\\mathbf{r} = \\int n(\\mathbf{r}) \\varepsilon_{xc}(n(\\mathbf{r}), |\\nabla n(\\mathbf{r})|) \\, d^3\\mathbf{r} $$\n    此处，$\\varepsilon_{xc}$ 是每个粒子的交换相关能量。为了构造一个满足已知标度性质和物理极限的泛函，$\\varepsilon_{xc}$ 通常用无量纲变量表示。\n\n2.  **无量纲变量**：关键的无量纲变量是约化密度梯度 $s$。对于自旋非极化体系，其定义为：\n    $$ s(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_F(\\mathbf{r}) n(\\mathbf{r})} $$\n    其中 $k_F(\\mathbf{r}) = (3\\pi^2 n(\\mathbf{r}))^{1/3}$ 是局域费米波矢量。该变量比较了密度变化的长度尺度 $n/|\\nabla n|$ 与局域费米波长 $1/k_F$。因子 $2$ 是一个通用惯例（例如，在 PBE 泛函中）。\n    \n    许多相关泛函使用一个额外的无量纲变量，通常记为 $t$，它与托马斯-费米屏蔽波矢量 $k_s(\\mathbf{r})$ 相关。一个标准的定义是：\n    $$ t(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_s(\\mathbf{r}) n(\\mathbf{r})} $$\n    其中 $k_s(\\mathbf{r}) = \\sqrt{4 k_F(\\mathbf{r})/\\pi}$。\n\n3.  **GGA 势**：相应的交换相关势 $v_{xc}(\\mathbf{r})$ 是能量对密度的泛函导数：\n    $$ v_{xc}(\\mathbf{r}) = \\frac{\\delta E_{xc}[n]}{\\delta n(\\mathbf{r})} $$\n    对泛函 $E_{xc}[n] = \\int \\mathcal{E}_{xc}(n, \\nabla n) \\, d^3\\mathbf{r}$ 应用欧拉-拉格朗日方程可得：\n    $$ v_{xc}(\\mathbf{r}) = \\frac{\\partial \\mathcal{E}_{xc}}{\\partial n} - \\nabla \\cdot \\left( \\frac{\\partial \\mathcal{E}_{xc}}{\\partial (\\nabla n)} \\right) $$\n    其中 $\\mathcal{E}_{xc} = n\\varepsilon_{xc}$。$\\nabla \\cdot (\\dots)$ 项来自于对涉及 $\\delta(\\nabla n) = \\nabla(\\delta n)$ 的项进行分部积分。此推导假设分部积分产生的边界项 $\\oint (\\partial\\mathcal{E}_{xc}/\\partial(\\nabla n))\\cdot\\hat{\\mathbf{n}}\\,\\delta n\\, dS$ 为零。对于周期性体系，或对于密度（以及 $\\delta n$ 和通量项 $\\partial\\mathcal{E}_{xc}/\\partial(\\nabla n)$）在边界处为零的体系，这个假设是成立的。\n\n4.  **数值实现**：在离散网格上，$E_{xc}$ 的积分变成一个求和。导数必须通过数值方法计算，例如使用有限差分或傅里叶变换。为了保证数值稳定性和准确性，散度算子 $\\nabla\\cdot$ 的离散化必须与梯度算子 $\\nabla$ 的离散化相一致，这一点至关重要。例如，在离散意义上，它们应该是彼此的伴随算子。必须仔细处理边界条件，以正确表示消失的表面项。\n\n现在，我们根据这些原则来评估每个选项。\n\n**选项 A 分析**\n- **导数**：提议使用二阶中心有限差分计算 $\\nabla n$。这是一个标准且稳健的选择，平衡了精度和计算成本。\n- **变量**：所提供的定义 $k_F(\\mathbf{r}_i) = (3\\pi^2 n_i)^{1/3}$、$k_s(\\mathbf{r}_i) = \\sqrt{4 k_F(\\mathbf{r}_i)/\\pi}$、$s_i = \\dfrac{|\\nabla n|_i}{2 k_F(\\mathbf{r}_i) n_i}$ 和 $t_i = \\dfrac{|\\nabla n|_i}{2 k_s(\\mathbf{r}_i) n_i}$，对于自旋非极化体系都是标准且正确的。\n- **能量**：表达式 $E_{xc} = \\sum_i w_i\\, n_i\\, \\varepsilon_{xc}(n_i, s_i, t_i)$ 正确地表示了能量密度 $n\\varepsilon_{xc}$ 的数值积分，其中 $\\varepsilon_{xc}$ 是每个粒子的能量，$w_i$ 是格点体积元。\n- **势和边界条件**：该选项正确陈述了 $v_{xc}$ 的公式。它提议对 $\\nabla$ 和 $\\nabla\\cdot$ 使用相同的中心差分模板，这是一种一致的数值实践。边界条件的处理非常出色：对于周期性体系，环绕处理正确地解决了边界项的抵消问题。对于非周期性体系，它正确地指出了需要对通量项 $\\dfrac{\\partial (n\\varepsilon_{xc})}{\\partial (\\nabla n)}\\cdot \\hat{\\mathbf{n}} = 0$ 施加物理边界条件，以确保分部积分产生的面积分为零。这对于孤立体系是物理上正确且数值上合理的程序。\n- **结论**：该选项在科学上是一致的，在数值上是稳健的，并且在所有细节上都完全正确。\n\n**选项 B 分析**\n- **导数**：提议使用一阶差分。这是一种低精度方案，对于高精度计算而言不能被认为是“数值稳健的”。\n- **变量**：定义 $s_i = \\dfrac{|\\nabla n|_i}{n_i}$ 和 $t_i = \\nabla^2 n_i$ 是不正确的。根据标准的 GGA 惯例，变量 $s$ 没有被恰当地无量纲化（它缺少因子 $1/k_F \\propto 1/n^{1/3}$）。变量 $t$ 被错误地识别为拉普拉斯算子；它应该是一个类似于 $s$ 的基于梯度的无量纲量，但具有不同的标度。一些 meta-GGA 泛函使用拉普拉斯算子，但这个选项混淆了标准变量。\n- **边界条件**：`假设边界项无论边界条件如何都消失`的说法是一个关键错误。对于非周期性体系，分部积分产生的边界项不会自动消失，忽略它会导致错误的势并破坏能量守恒。\n- **结论**：由于低精度的数值方法、基本变量 $s$ 和 $t$ 的错误定义以及对边界条件的致命缺陷处理，该选项是错误的。\n\n**选项 C 分析**\n- **导数**：提议使用傅里叶微分 (FFT)，这对于周期性体系是一种极好的方法。\n- **变量**：$s_i$ 的定义是正确的。然而，它定义了 $t_i = \\dfrac{|\\nabla n|_i}{2 k_F(\\mathbf{r}_i) n_i}$，这意味着 $t_i = s_i$。这是不正确的。虽然某些泛函可能只依赖于 $s$，但问题暗示了两个不同的变量，其中 $t$ 基于 $k_s$ 而不是 $k_F$。这个定义与许多重要相关泛函（例如，LYP）的标准构造不一致。\n- **边界条件**：对非周期性边界的处理是矛盾的，在科学上也是不合理的。它建议对非周期性问题使用 FFT（本质上是周期性的），然后施加一个任意且不符合物理的边界条件（$v_{xc}=0$）。声称“周期性微分已确保了一致性”在非周期性背景下是错误的；它忽略了方法与问题拓扑结构之间的根本不匹配。\n- **结论**：由于变量 $t$ 的定义有缺陷，以及更严重地，其对非周期性边界条件的无意义和不一致的处理，该选项是错误的。\n\n**选项 D 分析**\n- **变量**：$s_i$ 的定义是正确的。$t_i = \\dfrac{|\\nabla n|_i}{2 \\sqrt{n_i}\\, n_i}$ 的定义是不正确的。与密度的标度关系，分母中的 $n^{-3/2}$，与标准的托马斯-费米标度不匹配，后者应为 $k_s n \\propto n^{1/6} n = n^{7/6}$。\n- **势**：它错误地声称 $v_{xc}$ 中的散度项可以重写为 $n$ 的拉普拉斯算子。通用项是 $\\nabla \\cdot [g(n, |\\nabla n|) \\nabla n]$，它与 $\\nabla^2 n$ 不成比例，因为因子 $g(n, |\\nabla n|) = 2n \\frac{\\partial \\varepsilon_{xc}}{\\partial(|\\nabla n|^2)}$ 不是一个常数。这是一个基本的数学错误。\n- **边界条件**：与选项 B 类似，它错误地假设对于任何边界条件，表面项都可以忽略不计。\n- **结论**：由于变量 $t$ 的定义有缺陷、对 GGA 势的结构有根本性的误解以及对边界项的错误处理，该选项是错误的。\n\n**总结**\n选项 A 是唯一一个完整、正确且稳健地描述了在实空间网格上计算 GGA 泛函的数值程序的选项。它正确地指明了变量定义、数值方案以及对周期性和非周期性体系边界条件的关键处理方法。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "现在，我们将理论与实践相结合，进入一个完整的编码练习。你将实现 PBE 交换泛函，并进行一个数值实验，以量化不同阶数的有限差分格式对计算精度的影响 ()。这个练习不仅能巩固你对 GGA 公式的理解，还能让你深刻体会到数值方法的选择在多尺度材料模拟中的重要性。",
            "id": "3811149",
            "problem": "你需要实现并分析在广义梯度近似下，针对三维周期性测试电子密度的交换能计算中的离散化误差。目标是比较使用不同阶数的有限差分梯度计算出的交换能与使用相同测试密度的解析导数计算出的能量。所有能量必须以原子单位 (哈特里) 表示。\n\n从密度泛函理论 (DFT) 的基础出发，在广义梯度近似 (GGA) 中，交换能由一个能量密度的积分定义，该能量密度同时依赖于电子密度及其梯度。使用以下基本定义：\n\n- 广义梯度近似 (GGA) 中的交换能为\n$$\nE_{x}^{\\mathrm{GGA}} = \\int_{\\Omega} \\varepsilon_{x}^{\\mathrm{LDA}}(n(\\mathbf{r})) \\, F(s(\\mathbf{r})) \\, d^3\\mathbf{r},\n$$\n其中 $\\Omega$ 是模拟区域，$\\varepsilon_{x}^{\\mathrm{LDA}}(n) = -C_x \\, n^{4/3}$ 是局域密度近似 (LDA) 的交换能量密度，常数 $C_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$（以原子单位计），而 $F(s)$ 是广义梯度近似的交换增强因子。\n\n- 使用经典的 Perdew–Burke–Ernzerhof (PBE) 交换增强因子，参数为 $\\mu = 0.21951$ 和 $\\kappa = 0.804$：\n$$\nF(s) = 1 + \\kappa - \\frac{\\kappa}{1 + (\\mu/\\kappa)\\, s^2}.\n$$\n\n- 约化梯度 $s(\\mathbf{r})$ 定义为\n$$\ns(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_F(\\mathbf{r}) n(\\mathbf{r})}, \\quad k_F(\\mathbf{r}) = \\left(3 \\pi^2 n(\\mathbf{r})\\right)^{1/3}.\n$$\n\n使用一个三维周期性立方区域 $\\Omega = [0,L]^3$，该区域具有周期性边界条件和一个每维有 $N$ 个点的均匀网格，网格间距为 $h = L/N$，单元体积为 $\\Delta V = h^3$。通过以下方式定义测试电子密度\n$$\nn(x,y,z) = n_0 \\left[ 1 + a \\cos(k_x x) \\cos(k_y y) \\cos(k_z z) \\right],\n$$\n其中 $n_0 > 0$，$0  a  1$，波矢为 $k_x = \\frac{2\\pi m_x}{L}$、$k_y = \\frac{2\\pi m_y}{L}$、$k_z = \\frac{2\\pi m_z}{L}$，模式数 $m_x, m_y, m_z$ 为非负整数。只要 $n_0 (1 - a) > 0$，此选择可确保 $n(x,y,z)$ 处处为正，并且该密度与周期性边界条件兼容。\n\n计算两个版本的交换能：\n1. 一个“解析梯度”参考能量 $E_{x}^{\\mathrm{ref}}$，通过从密度的解析导数（通过微积分得出）计算 $|\\nabla n|$，将其代入网格上的上述 $E_{x}^{\\mathrm{GGA}}$ 被积函数中，并通过对网格点进行均匀黎曼和来积分。\n2. 一个“有限差分”能量 $E_{x}^{\\mathrm{FD}}$，通过使用阶数 $p \\in \\{2,4,6\\}$ 的中心有限差分来近似一阶导数，从而近似 $|\\nabla n|$，其中应用周期性边界条件，并沿每个轴独立应用以下一维差分格式：\n   - 阶数 $p = 2$：\n   $$\n   f'(x) \\approx \\frac{f(x+h) - f(x-h)}{2h}.\n   $$\n   - 阶数 $p = 4$：\n   $$\n   f'(x) \\approx \\frac{-f(x+2h) + 8f(x+h) - 8f(x-h) + f(x-2h)}{12h}.\n   $$\n   - 阶数 $p = 6$：\n   $$\n   f'(x) \\approx \\frac{f(x-3h) - 9f(x-2h) + 45f(x-h) - 45f(x+h) + 9f(x+2h) - f(x+3h)}{60h}.\n   $$\n\n对于每种情况，将离散化误差定义为绝对差\n$$\n\\Delta E = \\left| E_{x}^{\\mathrm{FD}} - E_{x}^{\\mathrm{ref}} \\right|.\n$$\n\n你的程序必须实现上述定义，并为一组探索分辨率、导数阶数和谱含量的测试用例生成 $\\Delta E$。使用以下测试套件，其中每个元组为 $(N, p, L, n_0, a, m_x, m_y, m_z)$：\n\n- 情况 1 (理想路径): $(64, 2, 10.0, 0.05, 0.30, 2, 3, 4)$。\n- 情况 2 (相同网格上的更高阶): $(64, 4, 10.0, 0.05, 0.30, 2, 3, 4)$。\n- 情况 3 (粗糙网格，中等模式): $(16, 2, 10.0, 0.05, 0.30, 2, 2, 2)$。\n- 情况 4 (粗糙网格，更高阶): $(16, 6, 10.0, 0.05, 0.30, 2, 2, 2)$。\n- 情况 5 (接近网格极限的更高谱含量): $(48, 4, 10.0, 0.05, 0.20, 12, 11, 10)$。\n\n所有长度 $L$ 的单位为玻尔 (bohr)，所有密度 $n_0$ 的单位为 玻尔$^{-3}$ (bohr$^{-3}$)，最终能量 $E_{x}^{\\mathrm{ref}}$、$E_{x}^{\\mathrm{FD}}$ 和误差 $\\Delta E$ 必须以哈特里 (Hartree) 为单位。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。该列表应包含与上述五个测试用例相对应的五个 $\\Delta E$ 值（单位为哈特里），顺序与上面列出的一致，例如 $[e_1,e_2,e_3,e_4,e_5]$。不应打印任何其他文本。",
            "solution": "该问题是有效的。它提出了一个明确定义的计算任务，该任务植根于密度泛函理论 (DFT) 的标准公式，特别是使用广义梯度近似 (GGA) 来处理交换泛函。所有提供的方程、常数和参数在科学上都是合理的、完整的，并且相互一致。任务是实现指定的物理和数值方法，以计算有限差分近似相对于半解析参考的离散化误差。\n\n目标是计算使用有限差分梯度计算的交换能 $E_{x}^{\\mathrm{FD}}$ 与使用解析梯度计算的参考能量 $E_{x}^{\\mathrm{ref}}$ 之间的绝对误差 $\\Delta E = |E_{x}^{\\mathrm{FD}} - E_{x}^{\\mathrm{ref}}|$。\n\nGGA 交换能由以下积分给出：\n$$\nE_{x}^{\\mathrm{GGA}} = \\int_{\\Omega} \\varepsilon_{x}^{\\mathrm{LDA}}(n(\\mathbf{r})) \\, F(s(\\mathbf{r})) \\, d^3\\mathbf{r}\n$$\n计算在一个周期性立方区域 $\\Omega = [0,L]^3$ 上进行，该区域被离散化为一个 $N \\times N \\times N$ 个点的均匀网格。网格间距为 $h = L/N$，数值积分的体积元为 $\\Delta V = h^3$。\n\n被积函数的组成部分是：\n1.  局域密度近似 (LDA) 交换能量密度：\n    $$\n    \\varepsilon_{x}^{\\mathrm{LDA}}(n) = -C_x \\, n^{4/3}, \\quad \\text{with } C_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}\n    $$\n2.  Perdew–Burke–Ernzerhof (PBE) 交换增强因子，它根据密度的局域梯度来修正 LDA 能量：\n    $$\n    F(s) = 1 + \\kappa - \\frac{\\kappa}{1 + (\\mu/\\kappa)\\, s^2}\n    $$\n    使用给定的参数 $\\mu = 0.21951$ 和 $\\kappa = 0.804$。\n3.  约化密度梯度 $s(\\mathbf{r})$，一个衡量密度变化的无量纲量：\n    $$\n    s(\\mathbf{r}) = \\frac{|\\nabla n(\\mathbf{r})|}{2 k_F(\\mathbf{r}) n(\\mathbf{r})}\n    $$\n    其中 $k_F(\\mathbf{r}) = (3 \\pi^2 n(\\mathbf{r}))^{1/3}$ 是局域费米波矢。\n\n测试电子密度 $n(\\mathbf{r})$ 在网格坐标 $(x,y,z)$ 上定义为：\n$$\nn(x,y,z) = n_0 \\left[ 1 + a \\cos(k_x x) \\cos(k_y y) \\cos(k_z z) \\right]\n$$\n其中波矢 $k_i = 2\\pi m_i/L$，对于 $i \\in \\{x,y,z\\}$。\n\n数值实现过程如下：\n\n**步骤 1：网格和密度生成**\n对于每个测试用例 $(N, p, L, n_0, a, m_x, m_y, m_z)$，都会生成一个三维坐标网格。我们使用 `numpy.meshgrid` 创建坐标数组 $x, y, z$，这些数组覆盖区域 $[0, L)$，每个轴上有 $N$ 个点。然后在此网格的每个点上计算测试密度 $n(\\mathbf{r})$，得到一个三维数组 `n_grid`。\n\n**步骤 2：参考能量计算 ($E_{x}^{\\mathrm{ref}}$)**\n此计算使用测试密度的精确解析梯度。偏导数为：\n$$\n\\frac{\\partial n}{\\partial x} = -n_0 a k_x \\sin(k_x x) \\cos(k_y y) \\cos(k_z z) \\\\\n\\frac{\\partial n}{\\partial y} = -n_0 a k_y \\cos(k_x x) \\sin(k_y y) \\cos(k_z z) \\\\\n\\frac{\\partial n}{\\partial z} = -n_0 a k_z \\cos(k_x x) \\cos(k_y y) \\sin(k_z z)\n$$\n在网格上计算这些导数以形成三个数组。然后逐点计算梯度的模 $|\\nabla n|_{\\mathrm{ref}} = \\sqrt{(\\partial n/\\partial x)^2 + (\\partial n/\\partial y)^2 + (\\partial n/\\partial z)^2}$。\n在网格上同时有 $n(\\mathbf{r})$ 和 $|\\nabla n|_{\\mathrm{ref}}$ 后，我们计算 $k_F(\\mathbf{r})$、$s(\\mathbf{r})$、$F(s(\\mathbf{r}))$ 和 $\\varepsilon_{x}^{\\mathrm{LDA}}(n(\\mathbf{r}))$ 的数组。参考能量的被积函数是 $\\varepsilon_{x}^{\\mathrm{LDA}} \\cdot F(s)$ 的乘积。然后通过对所有网格点进行黎曼和来计算积分：\n$$\nE_{x}^{\\mathrm{ref}} = \\Delta V \\sum_{i,j,k} \\left( \\varepsilon_{x}^{\\mathrm{LDA}} F(s) \\right)_{i,j,k}\n$$\n\n**步骤 3：有限差分能量计算 ($E_{x}^{\\mathrm{FD}}$)**\n$E_{x}^{\\mathrm{FD}}$ 的计算过程与 $E_{x}^{\\mathrm{ref}}$ 的过程相同，关键区别在于梯度模 $|\\nabla n|_{\\mathrm{FD}}$ 是使用数值有限差分计算的。我们实现指定的阶数 $p \\in \\{2, 4, 6\\}$ 的中心差分格式来近似偏导数 $(\\partial n/\\partial x, \\partial n/\\partial y, \\partial n/\\partial z)$。通过使用 `numpy.roll` 来移动 `n_grid` 数组，可以有效地处理周期性边界条件。对于给定的轴，导数通过应用一维差分格式计算。例如，对于阶数 $p=2$，沿 $x$ 轴（轴 0）的导数为：\n$$\n\\frac{\\partial n}{\\partial x} \\approx \\frac{\\text{roll}(n, -1, \\text{axis}=0) - \\text{roll}(n, 1, \\text{axis}=0)}{2h}\n$$\n在计算出三个偏导数数组后，找到梯度模 $|\\nabla n|_{\\mathrm{FD}}$，随后计算 $s(\\mathbf{r})$、$F(s)$、被积函数以及最终的 $E_{x}^{\\mathrm{FD}}$ 的过程与步骤 2 中的路径相同。\n\n**步骤 4：误差计算**\n每个测试用例的最终离散化误差是两个计算出的能量之间的绝对差：$\\Delta E = |E_{x}^{\\mathrm{FD}} - E_{x}^{\\mathrm{ref}}|$。\n\n这整个过程被封装在一个函数中，该函数会为五个测试用例中的每一个调用，并收集产生的 $\\Delta E$ 值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the calculation of discretization error for GGA exchange energy.\n    \"\"\"\n    # Define physical and PBE constants in atomic units\n    C_x = (3.0 / 4.0) * (3.0 / np.pi)**(1.0 / 3.0)\n    mu = 0.21951\n    kappa = 0.804\n\n    def finite_difference_gradient(n_grid, h, p):\n        \"\"\"\n        Computes the gradient of a 3D field using periodic finite differences.\n        \"\"\"\n        grad_components = []\n        for axis in range(3):  # 0 for x, 1 for y, 2 for z\n            if p == 2:\n                # Order p=2 stencil: [f(x+h) - f(x-h)] / 2h\n                num = (np.roll(n_grid, -1, axis=axis) - np.roll(n_grid, 1, axis=axis))\n                den = 2.0 * h\n            elif p == 4:\n                # Order p=4 stencil: [-f(x+2h)+8f(x+h)-8f(x-h)+f(x-2h)] / 12h\n                num = (-np.roll(n_grid, -2, axis=axis) + 8 * np.roll(n_grid, -1, axis=axis) -\n                       8 * np.roll(n_grid, 1, axis=axis) + np.roll(n_grid, 2, axis=axis))\n                den = 12.0 * h\n            elif p == 6:\n                # Order p=6 stencil from problem statement\n                num = (np.roll(n_grid, 3, axis=axis) - 9 * np.roll(n_grid, 2, axis=axis) +\n                       45 * np.roll(n_grid, 1, axis=axis) - 45 * np.roll(n_grid, -1, axis=axis) +\n                       9 * np.roll(n_grid, -2, axis=axis) - np.roll(n_grid, -3, axis=axis))\n                den = 60.0 * h\n            else:\n                raise ValueError(f\"Unsupported finite difference order p={p}\")\n            \n            grad_components.append(num / den)\n        \n        return grad_components[0], grad_components[1], grad_components[2]\n\n    def calculate_energy(n, grad_n_mag, delta_V):\n        \"\"\"\n        Calculates the PBE exchange energy given density and its gradient magnitude.\n        \"\"\"\n        # Ensure n > 0 to avoid numerical issues\n        n = np.maximum(n, 1e-12)\n        \n        # Fermi wavevector\n        kF = (3 * np.pi**2 * n)**(1.0/3.0)\n        \n        # Reduced gradient s\n        # Denominator is 2*kF*n = 2*(3*pi^2)^(1/3)*n^(4/3), safe for n>0\n        s = grad_n_mag / (2 * kF * n)\n        \n        # PBE enhancement factor F(s)\n        F_s = 1.0 + kappa - kappa / (1.0 + (mu / kappa) * s**2)\n        \n        # LDA exchange energy density\n        eps_x_lda = -C_x * n**(4.0 / 3.0)\n        \n        # Integrand\n        integrand = eps_x_lda * F_s\n        \n        # Integrate via Riemann sum\n        energy = np.sum(integrand) * delta_V\n        \n        return energy\n\n    def compute_error_for_case(N, p, L, n0, a, mx, my, mz):\n        \"\"\"\n        Main computation for a single test case.\n        \"\"\"\n        # 1. Setup grid and parameters\n        h = L / float(N)\n        delta_V = h**3\n        grid_1d = np.linspace(0, L, N, endpoint=False)\n        x, y, z = np.meshgrid(grid_1d, grid_1d, grid_1d, indexing='ij')\n        \n        kx = 2.0 * np.pi * mx / L\n        ky = 2.0 * np.pi * my / L\n        kz = 2.0 * np.pi * mz / L\n\n        # 2. Evaluate density on the grid\n        cos_x = np.cos(kx * x)\n        cos_y = np.cos(ky * y)\n        cos_z = np.cos(kz * z)\n        n_grid = n0 * (1.0 + a * cos_x * cos_y * cos_z)\n\n        # 3. Reference energy (using analytic gradient)\n        sin_x = np.sin(kx * x)\n        sin_y = np.sin(ky * y)\n        sin_z = np.sin(kz * z)\n        \n        dn_dx_ref = -n0 * a * kx * sin_x * cos_y * cos_z\n        dn_dy_ref = -n0 * a * ky * cos_x * sin_y * cos_z\n        dn_dz_ref = -n0 * a * kz * cos_x * cos_y * sin_z\n        \n        grad_n_mag_ref = np.sqrt(dn_dx_ref**2 + dn_dy_ref**2 + dn_dz_ref**2)\n        E_ref = calculate_energy(n_grid, grad_n_mag_ref, delta_V)\n\n        # 4. Finite-difference energy\n        dn_dx_fd, dn_dy_fd, dn_dz_fd = finite_difference_gradient(n_grid, h, p)\n        grad_n_mag_fd = np.sqrt(dn_dx_fd**2 + dn_dy_fd**2 + dn_dz_fd**2)\n        E_fd = calculate_energy(n_grid, grad_n_mag_fd, delta_V)\n\n        # 5. Compute absolute error\n        return np.abs(E_fd - E_ref)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, p, L, n0, a, mx, my, mz)\n        (64, 2, 10.0, 0.05, 0.30, 2, 3, 4),\n        (64, 4, 10.0, 0.05, 0.30, 2, 3, 4),\n        (16, 2, 10.0, 0.05, 0.30, 2, 2, 2),\n        (16, 6, 10.0, 0.05, 0.30, 2, 2, 2),\n        (48, 4, 10.0, 0.05, 0.20, 12, 11, 10),\n    ]\n\n    results = []\n    for case in test_cases:\n        error = compute_error_for_case(*case)\n        results.append(f\"{error:.10e}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}