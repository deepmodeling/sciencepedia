{
    "hands_on_practices": [
        {
            "introduction": "我们从最基础的晶体结构——简单立方晶格——开始。这个练习将引导你完成从实空间基矢计算倒易晶格基矢的基本流程。通过完成这个基础示例 ()，你将巩固对实空间几何如何直接决定第一布里渊区的形状与尺寸的理解。",
            "id": "3837911",
            "problem": "在多尺度材料模拟中，实空间粗粒化与倒易空间采样密度之间的联系是由第一布里渊区（BZ）的几何形状和体积所决定的。考虑一个晶格参数为 $a$ 的三维单原子晶体，其具有简单立方布拉伐晶格。仅从倒易晶格矢量的基本定义和倒易空间中的维格纳-赛兹（Wigner–Seitz）构造法出发，推导原胞倒易晶格矢量，确定第一布里渊区的形状，并计算无量纲积 $a^{3} V_{\\mathrm{BZ}}$，其中 $V_{\\mathrm{BZ}}$ 是第一布里渊区的体积。最终答案请以仅包含 $\\pi$ 的单个闭式解析表达式给出。请勿四舍五入。最终表达式中不要包含单位。",
            "solution": "题目要求对于晶格参数为 $a$ 的简单立方布拉伐晶格，推导其原胞倒易晶格矢量，确定第一布里渊区的形状，并计算无量纲积 $a^{3} V_{\\mathrm{BZ}}$。推导过程必须从基本定义出发。\n\n首先，我们定义实空间简单立方（SC）晶格的原胞晶格矢量。由于晶格是简单立方的，原胞晶格矢量可以选择为相互正交且与笛卡尔坐标轴对齐，其模长等于晶格参数 $a$。\n设基矢为 $\\hat{x}$、$\\hat{y}$ 和 $\\hat{z}$。实空间原胞晶格矢量 $\\mathbf{a}_1$、$\\mathbf{a}_2$ 和 $\\mathbf{a}_3$ 为：\n$$\n\\mathbf{a}_1 = a \\hat{x} \\\\\n\\mathbf{a}_2 = a \\hat{y} \\\\\n\\mathbf{a}_3 = a \\hat{z}\n$$\n\n接下来，我们推导原胞倒易晶格矢量 $\\mathbf{b}_1$、$\\mathbf{b}_2$ 和 $\\mathbf{b}_3$。将倒易晶格矢量与实空间矢量联系起来的基本定义由下式给出：\n$$\n\\mathbf{b}_1 = 2\\pi \\frac{\\mathbf{a}_2 \\times \\mathbf{a}_3}{\\mathbf{a}_1 \\cdot (\\mathbf{a}_2 \\times \\mathbf{a}_3)} \\\\\n\\mathbf{b}_2 = 2\\pi \\frac{\\mathbf{a}_3 \\times \\mathbf{a}_1}{\\mathbf{a}_1 \\cdot (\\mathbf{a}_2 \\times \\mathbf{a}_3)} \\\\\n\\mathbf{b}_3 = 2\\pi \\frac{\\mathbf{a}_1 \\times \\mathbf{a}_2}{\\mathbf{a}_1 \\cdot (\\mathbf{a}_2 \\times \\mathbf{a}_3)}\n$$\n分母 $\\mathbf{a}_1 \\cdot (\\mathbf{a}_2 \\times \\mathbf{a}_3)$ 表示实空间中原胞的体积，我们将其记为 $V_c$。我们来计算这个体积：\n$$\n\\mathbf{a}_2 \\times \\mathbf{a}_3 = (a \\hat{y}) \\times (a \\hat{z}) = a^{2} (\\hat{y} \\times \\hat{z}) = a^{2} \\hat{x}\n$$\n$$\nV_c = \\mathbf{a}_1 \\cdot (\\mathbf{a}_2 \\times \\mathbf{a}_3) = (a \\hat{x}) \\cdot (a^{2} \\hat{x}) = a^{3} (\\hat{x} \\cdot \\hat{x}) = a^{3}\n$$\n现在，我们可以计算每个倒易晶格矢量。\n对于 $\\mathbf{b}_1$：\n$$\n\\mathbf{b}_1 = 2\\pi \\frac{\\mathbf{a}_2 \\times \\mathbf{a}_3}{V_c} = 2\\pi \\frac{a^{2} \\hat{x}}{a^{3}} = \\frac{2\\pi}{a} \\hat{x}\n$$\n对于 $\\mathbf{b}_2$，我们首先计算叉积 $\\mathbf{a}_3 \\times \\mathbf{a}_1$：\n$$\n\\mathbf{a}_3 \\times \\mathbf{a}_1 = (a \\hat{z}) \\times (a \\hat{x}) = a^{2} (\\hat{z} \\times \\hat{x}) = a^{2} \\hat{y}\n$$\n$$\n\\mathbf{b}_2 = 2\\pi \\frac{\\mathbf{a}_3 \\times \\mathbf{a}_1}{V_c} = 2\\pi \\frac{a^{2} \\hat{y}}{a^{3}} = \\frac{2\\pi}{a} \\hat{y}\n$$\n对于 $\\mathbf{b}_3$，我们首先计算叉积 $\\mathbf{a}_1 \\times \\mathbf{a}_2$：\n$$\n\\mathbf{a}_1 \\times \\mathbf{a}_2 = (a \\hat{x}) \\times (a \\hat{y}) = a^{2} (\\hat{x} \\times \\hat{y}) = a^{2} \\hat{z}\n$$\n$$\n\\mathbf{b}_3 = 2\\pi \\frac{\\mathbf{a}_1 \\times \\mathbf{a}_2}{V_c} = 2\\pi \\frac{a^{2} \\hat{z}}{a^{3}} = \\frac{2\\pi}{a} \\hat{z}\n$$\n因此，原胞倒易晶格矢量为：\n$$\n\\mathbf{b}_1 = \\frac{2\\pi}{a} \\hat{x}, \\quad \\mathbf{b}_2 = \\frac{2\\pi}{a} \\hat{y}, \\quad \\mathbf{b}_3 = \\frac{2\\pi}{a} \\hat{z}\n$$\n这些矢量表明，简单立方晶格的倒易晶格也是一个简单立方晶格，其晶格参数为 $\\frac{2\\pi}{a}$。\n\n下一步是确定第一布里渊区（BZ）的形状。第一布里渊区被定义为以原点（$\\mathbf{k}=0$）为中心的倒易晶格的维格纳-赛兹（Wigner-Seitz）原胞。维格纳-赛兹构造法旨在确定倒易空间中比任何其他倒易格点更靠近原点的点集。该原胞的边界由连接原点与其最近邻倒易格点的矢量的垂直平分面构成。\n\n一般的倒易晶格矢量为 $\\mathbf{G} = n_1 \\mathbf{b}_1 + n_2 \\mathbf{b}_2 + n_3 \\mathbf{b}_3$，其中 $n_1, n_2, n_3$ 是整数。原点（$\\mathbf{G}=0$）的最近邻点是对应于 $(n_1, n_2, n_3)$ 为 $(\\pm 1, 0, 0)$、$(0, \\pm 1, 0)$ 和 $(0, 0, \\pm 1)$ 的六个点。这些矢量是：\n$$\n\\pm \\mathbf{b}_1 = \\pm \\frac{2\\pi}{a} \\hat{x} \\\\\n\\pm \\mathbf{b}_2 = \\pm \\frac{2\\pi}{a} \\hat{y} \\\\\n\\pm \\mathbf{b}_3 = \\pm \\frac{2\\pi}{a} \\hat{z}\n$$\n垂直平分面必须穿过这些矢量的中点。例如，对于矢量 $\\mathbf{b}_1$，中点是 $\\frac{1}{2}\\mathbf{b}_1 = \\frac{\\pi}{a}\\hat{x}$。该平面垂直于 $\\mathbf{b}_1$（即垂直于 $\\hat{x}$）并穿过此点。该平面上一点 $\\mathbf{k} = k_x \\hat{x} + k_y \\hat{y} + k_z \\hat{z}$ 的方程为 $k_x = \\frac{\\pi}{a}$。\n将此方法应用于所有六个最近邻矢量，我们得到六个平面：\n$$\nk_x = \\pm \\frac{\\pi}{a} \\\\\nk_y = \\pm \\frac{\\pi}{a} \\\\\nk_z = \\pm \\frac{\\pi}{a}\n$$\n这六个平面构成了第一布里渊区的边界。它们所包围的区域是一个以倒易空间原点为中心的立方体。坐标范围是 $-\\frac{\\pi}{a} \\le k_x \\le \\frac{\\pi}{a}$、$-\\frac{\\pi}{a} \\le k_y \\le \\frac{\\pi}{a}$ 和 $-\\frac{\\pi}{a} \\le k_z \\le \\frac{\\pi}{a}$。\n\n最后，我们计算第一布里渊区的体积 $V_{\\mathrm{BZ}}$ 和无量纲积 $a^{3} V_{\\mathrm{BZ}}$。第一布里渊区是一个立方体，其边长为 $(\\frac{\\pi}{a}) - (-\\frac{\\pi}{a}) = \\frac{2\\pi}{a}$。立方体的体积是边长的立方：\n$$\nV_{\\mathrm{BZ}} = \\left(\\frac{2\\pi}{a}\\right)^{3} = \\frac{8\\pi^{3}}{a^{3}}\n$$\n现在我们计算所要求的无量纲积：\n$$\na^{3} V_{\\mathrm{BZ}} = a^{3} \\left( \\frac{8\\pi^{3}}{a^{3}} \\right) = 8\\pi^{3}\n$$\n这个结果是一个无量纲常数，正如预期，因为 $a^{3}$ 的单位是体积（例如，$\\mathrm{m}^{3}$），而 $V_{\\mathrm{BZ}}$ 的单位是倒易体积（例如，$\\mathrm{m}^{-3}$）。该值仅取决于数学常数 $\\pi$。\n这个结果与一个普遍定理相符，即第一布里渊区的体积等于 $(2\\pi)^{3}$ 除以实空间原胞的体积：$V_{\\mathrm{BZ}} = \\frac{(2\\pi)^{3}}{V_c} = \\frac{(2\\pi)^{3}}{a^{3}}$。",
            "answer": "$$\\boxed{8\\pi^{3}}$$"
        },
        {
            "introduction": "在掌握了基础知识后，我们来探讨一种更常见也更复杂的晶体结构——体心立方 (bcc) 晶格，它需要使用非正交的原胞基矢来描述。这个练习揭示了晶体学中一个至关重要的对偶关系：bcc 晶格的倒易晶格是面心立方 (fcc) 晶格。对于理解大量以 bcc 结构结晶的元素和合金的电子与振动性质而言，掌握这个推导过程 () 是必不可少的。",
            "id": "3837974",
            "problem": "实空间中的三维 Bravais 晶格由三个原胞基矢 $\\mathbf{a}_{1}$、$\\mathbf{a}_{2}$ 和 $\\mathbf{a}_{3}$ 指定，它们通过整数组合线性生成所有格点。倒易晶格定义为所有满足 $\\exp(i\\,\\mathbf{G}\\cdot\\mathbf{R})=1$ 的波矢 $\\mathbf{G}$ 的集合，其中 $\\mathbf{R}$ 是由实空间原胞基矢构成的任意晶格平移矢量。从这个定义和对偶基条件 $\\mathbf{b}_{i}\\cdot\\mathbf{a}_{j}=2\\pi\\,\\delta_{ij}$ 出发，其中 $\\mathbf{b}_{i}$ 是倒易原胞基矢，$\\delta_{ij}$ 是 Kronecker delta，为以下给出的中心化实空间晶格推导其倒易晶格。\n\n考虑一个体心立方 (bcc) Bravais 晶格，其常规立方晶格参数为 $a$，并选择一组原胞基矢\n$$\n\\mathbf{a}_{1}=\\frac{a}{2}(-1,\\,1,\\,1),\\quad\n\\mathbf{a}_{2}=\\frac{a}{2}(1,\\,-1,\\,1),\\quad\n\\mathbf{a}_{3}=\\frac{a}{2}(1,\\,1,\\,-1).\n$$\n仅使用基本定义和已验证的事实（避免使用记忆的现成公式），完成以下任务：\n- 从第一性原理出发，构建一组满足 $\\mathbf{b}_{i}\\cdot\\mathbf{a}_{j}=2\\pi\\,\\delta_{ij}$ 的倒易原胞基矢 $\\{\\mathbf{b}_{1},\\mathbf{b}_{2},\\mathbf{b}_{3}\\}$。\n- 推断倒易晶格的定心类型（例如，面心立方 (fcc)、体心立方 (bcc) 或简单立方），并基于 $\\{\\mathbf{b}_{i}\\}$ 相对于倒易空间中常规立方框架的结构来证明你的结论。\n- 使用第一 Brillouin 区 (BZ) 作为倒易晶格的 Wigner–Seitz 原胞的定义，计算第一 Brillouin 区的精确体积（用 $a$ 表示）。\n\n将 Brillouin 区体积的最终答案表示为关于 $a$ 和 $\\pi$ 的单个闭合形式解析表达式，并以 $\\mathrm{m}^{-3}$ 为单位标明。不要进行任何数值四舍五入。",
            "solution": "该问题要求从给定的体心立方 (bcc) 晶格的原胞基矢出发，进行一个三部分的推导。这三个部分是：倒易原胞基矢的构建、倒易晶格定心类型的确定以及第一 Brillouin 区体积的计算。\n\n首先，我们来构建倒易晶格基矢 $\\{\\mathbf{b}_{1}, \\mathbf{b}_{2}, \\mathbf{b}_{3}\\}$。这些矢量由对偶条件 $\\mathbf{b}_{i} \\cdot \\mathbf{a}_{j} = 2\\pi\\,\\delta_{ij}$ 定义，其中 $\\{\\mathbf{a}_{j}\\}$ 是实空间原胞基矢，$\\delta_{ij}$ 是 Kronecker delta。找到矢量 $\\mathbf{b}_{i}$ 的一个通用且系统的方法是通过以下公式：\n$$\n\\mathbf{b}_{i} = 2\\pi \\frac{\\mathbf{a}_{j} \\times \\mathbf{a}_{k}}{\\mathbf{a}_{i} \\cdot (\\mathbf{a}_{j} \\times \\mathbf{a}_{k})}\n$$\n其中 $(i, j, k)$ 是 $(1, 2, 3)$ 的一个循环置换。分母 $V_c = \\mathbf{a}_{1} \\cdot (\\mathbf{a}_{2} \\times \\mathbf{a}_{3})$ 是实空间中原胞的体积。\n\n给定的实空间原胞基矢是：\n$$\n\\mathbf{a}_{1}=\\frac{a}{2}(-1, 1, 1)\n$$\n$$\n\\mathbf{a}_{2}=\\frac{a}{2}(1, -1, 1)\n$$\n$$\n\\mathbf{a}_{3}=\\frac{a}{2}(1, 1, -1)\n$$\n我们首先计算标量三重积，它代表原胞的体积。首先，我们计算叉积 $\\mathbf{a}_{2} \\times \\mathbf{a}_{3}$：\n$$\n\\mathbf{a}_{2} \\times \\mathbf{a}_{3} = \\left(\\frac{a}{2}\\right)^2 \\det \\begin{pmatrix} \\hat{\\mathbf{x}}  \\hat{\\mathbf{y}}  \\hat{\\mathbf{z}} \\\\ 1  -1  1 \\\\ 1  1  -1 \\end{pmatrix} = \\frac{a^2}{4} \\left( ((-1)(-1) - (1)(1))\\hat{\\mathbf{x}} - ((1)(-1) - (1)(1))\\hat{\\mathbf{y}} + ((1)(1) - (-1)(1))\\hat{\\mathbf{z}} \\right)\n$$\n$$\n\\mathbf{a}_{2} \\times \\mathbf{a}_{3} = \\frac{a^2}{4} (0, 2, 2) = \\frac{a^2}{2} (0, 1, 1)\n$$\n现在，我们计算标量三重积：\n$$\nV_c = \\mathbf{a}_{1} \\cdot (\\mathbf{a}_{2} \\times \\mathbf{a}_{3}) = \\frac{a}{2}(-1, 1, 1) \\cdot \\frac{a^2}{2}(0, 1, 1) = \\frac{a^3}{4} ((-1)(0) + (1)(1) + (1)(1)) = \\frac{a^3}{4}(2) = \\frac{a^3}{2}\n$$\n这是 bcc 原胞的体积，是常规立方晶胞体积 ($a^3$) 的一半，这与预期相符，因为常规晶胞包含2个格点。\n\n现在我们可以找到倒易原胞基矢。对于 $\\mathbf{b}_{1}$：\n$$\n\\mathbf{b}_{1} = 2\\pi \\frac{\\mathbf{a}_{2} \\times \\mathbf{a}_{3}}{V_c} = 2\\pi \\frac{\\frac{a^2}{2}(0, 1, 1)}{\\frac{a^3}{2}} = \\frac{2\\pi}{a}(0, 1, 1)\n$$\n对于 $\\mathbf{b}_{2}$，我们需要计算 $\\mathbf{a}_{3} \\times \\mathbf{a}_{1}$：\n$$\n\\mathbf{a}_{3} \\times \\mathbf{a}_{1} = \\left(\\frac{a}{2}\\right)^2 \\det \\begin{pmatrix} \\hat{\\mathbf{x}}  \\hat{\\mathbf{y}}  \\hat{\\mathbf{z}} \\\\ 1  1  -1 \\\\ -1  1  1 \\end{pmatrix} = \\frac{a^2}{4} \\left( (1)(1) - (-1)(1), (-1)(-1) - (1)(1), (1)(1) - (1)(-1) \\right) = \\frac{a^2}{4} (2, 0, 2) = \\frac{a^2}{2}(1, 0, 1)\n$$\n$$\n\\mathbf{b}_{2} = 2\\pi \\frac{\\mathbf{a}_{3} \\times \\mathbf{a}_{1}}{V_c} = 2\\pi \\frac{\\frac{a^2}{2}(1, 0, 1)}{\\frac{a^3}{2}} = \\frac{2\\pi}{a}(1, 0, 1)\n$$\n对于 $\\mathbf{b}_{3}$，我们需要计算 $\\mathbf{a}_{1} \\times \\mathbf{a}_{2}$：\n$$\n\\mathbf{a}_{1} \\times \\mathbf{a}_{2} = \\left(\\frac{a}{2}\\right)^2 \\det \\begin{pmatrix} \\hat{\\mathbf{x}}  \\hat{\\mathbf{y}}  \\hat{\\mathbf{z}} \\\\ -1  1  1 \\\\ 1  -1  1 \\end{pmatrix} = \\frac{a^2}{4}\\left( (1)(1) - (1)(-1), (1)(1) - (-1)(1), (-1)(-1) - (1)(1) \\right) = \\frac{a^2}{4}(2, 2, 0) = \\frac{a^2}{2}(1, 1, 0)\n$$\n$$\n\\mathbf{b}_{3} = 2\\pi \\frac{\\mathbf{a}_{1} \\times \\mathbf{a}_{2}}{V_c} = 2\\pi \\frac{\\frac{a^2}{2}(1, 1, 0)}{\\frac{a^3}{2}} = \\frac{2\\pi}{a}(1, 1, 0)\n$$\n因此，构建的倒易原胞基矢为：\n$$\n\\mathbf{b}_{1} = \\frac{2\\pi}{a}(0, 1, 1), \\quad \\mathbf{b}_{2} = \\frac{2\\pi}{a}(1, 0, 1), \\quad \\mathbf{b}_{3} = \\frac{2\\pi}{a}(1, 1, 0)\n$$\n\n第二，我们推断倒易晶格的定心类型。矢量 $\\{\\mathbf{b}_{1}, \\mathbf{b}_{2}, \\mathbf{b}_{3}\\}$ 是倒易晶格的原胞基矢。我们可以通过检查它们的结构来识别晶格类型。这些矢量是面心立方 (fcc) 晶格的特征。一个边长为 $A_{recip}$ 的常规立方晶胞的 fcc 晶格可以由连接立方体一个角点到三个相邻面中心的原胞基矢生成。这些矢量是：\n$$\n\\mathbf{v}_{1} = \\frac{A_{recip}}{2}(\\hat{\\mathbf{y}} + \\hat{\\mathbf{z}}), \\quad \\mathbf{v}_{2} = \\frac{A_{recip}}{2}(\\hat{\\mathbf{x}} + \\hat{\\mathbf{z}}), \\quad \\mathbf{v}_{3} = \\frac{A_{recip}}{2}(\\hat{\\mathbf{x}} + \\hat{\\mathbf{y}})\n$$\n将我们计算出的矢量 $\\{\\mathbf{b}_{i}\\}$ 与这些标准的 fcc 原胞基矢（在不考虑排列顺序的情况下）进行比较，我们看到一个直接的对应关系：\n$$\n\\mathbf{b}_{1} \\text{ corresponds to } \\mathbf{v}_{1}, \\quad \\mathbf{b}_{2} \\text{ corresponds to } \\mathbf{v}_{2}, \\quad \\mathbf{b}_{3} \\text{ corresponds to } \\mathbf{v}_{3}\n$$\n这种匹配意味着倒易晶格确实是 fcc。通过比较大小，我们发现 $\\frac{A_{recip}}{2} = \\frac{2\\pi}{a}$，这给出了倒易晶格常规立方晶胞的边长为 $A_{recip} = \\frac{4\\pi}{a}$。因此，bcc 晶格的倒易晶格是 fcc 晶格。\n\n第三，我们计算第一 Brillouin 区的体积 $V_{BZ}$。第一 Brillouin 区被定义为倒易晶格的 Wigner-Seitz 原胞。Bravais 晶格的一个基本性质是 Wigner-Seitz 原胞的体积等于原胞的体积。因此，$V_{BZ}$ 是倒易晶格原胞的体积，可以用倒易原胞基矢的标量三重积来计算。\n$$\nV_{BZ} = |\\mathbf{b}_{1} \\cdot (\\mathbf{b}_{2} \\times \\mathbf{b}_{3})|\n$$\n我们计算 $\\mathbf{b}_{2} \\times \\mathbf{b}_{3}$：\n$$\n\\mathbf{b}_{2} \\times \\mathbf{b}_{3} = \\left(\\frac{2\\pi}{a}\\right)^2 \\det \\begin{pmatrix} \\hat{\\mathbf{x}}  \\hat{\\mathbf{y}}  \\hat{\\mathbf{z}} \\\\ 1  0  1 \\\\ 1  1  0 \\end{pmatrix} = \\left(\\frac{2\\pi}{a}\\right)^2 \\left( (0)(0) - (1)(1), (1)(1) - (1)(0), (1)(1) - (0)(1) \\right) = \\left(\\frac{2\\pi}{a}\\right)^2 (-1, 1, 1)\n$$\n然后我们计算与 $\\mathbf{b}_{1}$ 的点积：\n$$\n\\mathbf{b}_{1} \\cdot (\\mathbf{b}_{2} \\times \\mathbf{b}_{3}) = \\frac{2\\pi}{a}(0, 1, 1) \\cdot \\left(\\frac{2\\pi}{a}\\right)^2 (-1, 1, 1) = \\left(\\frac{2\\pi}{a}\\right)^3 ( (0)(-1) + (1)(1) + (1)(1) ) = \\left(\\frac{2\\pi}{a}\\right)^3 (2) = \\frac{8\\pi^3}{a^3} \\cdot 2 = \\frac{16\\pi^3}{a^3}\n$$\n所以，第一 Brillouin 区的体积是 $V_{BZ} = \\frac{16\\pi^3}{a^3}$。\n\n另外，我们可以使用实空间原胞体积 ($V_c$) 和倒易空间原胞体积 ($V_{BZ}$) 之间的一般关系：\n$$\nV_{BZ} = \\frac{(2\\pi)^3}{V_c}\n$$\n我们之前计算过 $V_c = \\frac{a^3}{2}$。代入这个值：\n$$\nV_{BZ} = \\frac{(2\\pi)^3}{a^3/2} = \\frac{8\\pi^3}{a^3/2} = 2 \\cdot \\frac{8\\pi^3}{a^3} = \\frac{16\\pi^3}{a^3}\n$$\n两种方法得到相同的结果，证实了计算的正确性。如果常规晶格参数 $a$ 的单位是米 ($\\mathrm{m}$)，那么第一 Brillouin 区的体积单位就是立方米的倒数 ($\\mathrm{m}^{-3}$)。",
            "answer": "$$\\boxed{\\frac{16\\pi^3}{a^3}}$$"
        },
        {
            "introduction": "为了将理论与现代计算实践相结合，最后一个练习将从解析推导转向算法实现。它解决了一个在计算材料科学中常见的问题：如何诠释使用超胞计算得到的能带结构，这种计算方法常用于模拟缺陷、表面或复杂的有序结构。其核心思想是将折叠的超胞布里渊区“展开”回原胞的布里渊区。通过实现并验证一个能带展开算法 ()，你将亲身体验一种用于分析模拟结果的强大技术。",
            "id": "3837954",
            "problem": "设计并实现一个完整、可运行的程序，用于构建和验证一种布里渊区解折叠算法。该算法将超胞本征态投影到一维紧束缚模型中的原胞布洛赫态上。算法必须从倒易空间和布洛赫理论的第一性原理推导得出，并且必须作用于一个一维晶格，该晶格具有一个由有限数量原胞组成的超胞。\n\n从以下基本概念出发：\n- 对于原胞晶格常数为 $a$ 的一维晶格，其倒易晶格矢量为 $b = \\frac{2\\pi}{a}$。\n- 对于包含 $S$ 个原胞的超胞，其超胞晶格常数为 $A = S a$，超胞倒易晶格矢量为 $b_{\\mathrm{sc}} = \\frac{2\\pi}{A} = \\frac{2\\pi}{S a}$。\n- 根据布洛赫定理，周期性势场中的本征态可以用晶体动量来标记；对于超胞描述，晶体动量是超胞第一布里渊区内的 $K$，范围是 $K \\in \\left[-\\frac{\\pi}{S a}, \\frac{\\pi}{S a}\\right)$。\n- 原胞晶格的第一布里渊区范围是 $k \\in \\left[-\\frac{\\pi}{a}, \\frac{\\pi}{a}\\right)$。\n\n根据以下原理构建算法：\n1. 构建一维链在最近邻跃迁下的超胞紧束缚哈密顿量 $H(K)$。超胞包含 $S$ 个子晶格，索引为 $s \\in \\{0,1,\\dots,S-1\\}$，其在位能为 $\\varepsilon_s$。子晶格 $s$ 和 $s+1$ 之间的最近邻跃迁振幅为 $t$（索引对 $S$ 取模）。通过一个相位因子 $e^{i K A}$ 对跨越超胞边界的跃迁施加布洛赫边界条件。具体来说，$H(K)$ 是一个 $S \\times S$ 的厄米矩阵，其中：\n   - $H_{s,s}(K) = \\varepsilon_s$，\n   - 对于 $s \\in \\{0,1,\\dots,S-2\\}$，$H_{s,(s+1)\\bmod S}(K) = t$，以及 $H_{S-1,0}(K) = t e^{i K A}$，\n   - $H_{(s+1)\\bmod S,s}(K) = \\left[H_{s,(s+1)\\bmod S}(K)\\right]^*$ 以确保厄米性。\n2. 对角化 $H(K)$ 以获得超胞本征矢量 $\\mathbf{u}^{(n)}(K)$，其中 $n \\in \\{0,1,\\dots,S-1\\}$ 是每个 $K$ 对应的能带索引。\n3. 定义与超胞动量 $K$ 兼容的原胞晶体动量集合为 $k_m = K + G_m$，其中 $m \\in \\{0,1,\\dots,S-1\\}$，$G_m = \\frac{2\\pi m}{S a}$ 是将 $K$ 映回原胞第一布里渊区的超胞倒易晶格矢量。\n4. 使用关于子晶格索引 $s$ 的离散傅里叶变换，将每个超胞本征矢量 $\\mathbf{u}^{(n)}(K)$ 投影到由 $k_m$ 标记的原胞布洛赫基上：\n   - 计算解折叠振幅 $c_m^{(n)}(K) = \\frac{1}{\\sqrt{S}} \\sum_{s=0}^{S-1} e^{-i G_m s a} \\, u^{(n)}_s(K)$。\n   - 解折叠权重为 $w_m^{(n)}(K) = \\left|c_m^{(n)}(K)\\right|^2$。\n5. 使用正交归一性和离散傅里叶变换的幺正性所蕴含的性质来验证算法：\n   - 对于任何归一化的本征矢量 $\\mathbf{u}^{(n)}(K)$，其权重必须满足 $\\sum_{m=0}^{S-1} w_m^{(n)}(K) = 1$。\n   - 如果超胞是均匀的（所有在位能相等，即对所有 $s$ 都有 $\\varepsilon_s = \\varepsilon$），则每个本征矢量对应一个单一的原胞动量扇区，解折叠权重必须是delta函数峰值的形式：$\\max_m w_m^{(n)}(K) \\approx 1$（对于所有 $K$ 和 $n$），误差在数值容差范围内。\n\n根据以下要求实现程序：\n- 使用超胞第一布里淵区中的动量网格，定义为 $K_j = -\\frac{\\pi}{S a} + \\left(j+\\frac{1}{2}\\right) \\frac{2\\pi}{S a M}$，其中 $j \\in \\{0,1,\\dots,M-1\\}$，以避免精确边界上的简并。$M$ 是每个测试用例的 $K$ 点数量。\n- 对于每个测试用例，计算所有 $K_j$ 对应的 $H(K_j)$，进行对角化，计算所有 $w_m^{(n)}(K_j)$，并应用指定的验证检查。\n\n测试套件（每个测试用例都是程序中要实现的一个元组类结构）：\n- 测试用例1（理想情况，均匀双原子超胞）：\n  - 参数：$S = 2$, $a = 1.0$, $t = 1.0$, $\\varepsilon = [0.0, 0.0]$, $M = 16$。\n  - 验证：检查归一化（$\\sum_m w_m^{(n)}(K_j) = 1$ 在容差范围内）和delta函数峰值性质（对于所有 $K_j$ 和 $n$，$\\max_m w_m^{(n)}(K_j) \\ge 1 - \\tau$）。\n- 测试用例2（具有在位调制的非均匀双原子超胞）：\n  - 参数：$S = 2$, $a = 1.0$, $t = 1.0$, $\\varepsilon = [0.3, -0.3]$, $M = 16$。\n  - 验证：仅检查归一化（$\\sum_m w_m^{(n)}(K_j) = 1$ 在容差范围内）。\n- 测试用例3（均匀三原子超胞）：\n  - 参数：$S = 3$, $a = 1.0$, $t = 0.7$, $\\varepsilon = [0.0, 0.0, 0.0]$, $M = 18$。\n  - 验证：同时检查归一化和delta函数峰值性质。\n\n容差：\n- 对所有涉及相等性或delta函数峰值行为的检查，使用绝对容差 $\\tau = 10^{-10}$。\n\n最终输出格式：\n- 你的程序应生成一行输出，其中包含三个测试用例的结果，形式为一个用方括号括起来的逗号分隔列表，每个元素是一个布尔值，指示测试用例是否通过（例如，$\\left[\\mathrm{True},\\mathrm{False},\\mathrm{True}\\right]$）。",
            "solution": "该问题陈述是计算凝聚态物理学中一个有效、适定且科学上合理的练习。它要求实现和验证一维紧束缚模型的能带解折叠算法，这是一种在材料模拟中用于根据底层原胞解释超胞能带结构的标准技术。所有参数、方程和验证标准都已清晰、正确地指定。因此，我们可以着手推导解决方案。\n\n### 理论基础与算法设计\n\n核心任务是将一个可能包含内部结构（例如，不同的在位能）的大“超胞”的电子本征态，与相应的更简单的“原胞”的电子结构联系起来。原胞是晶体的最小重复单元，晶格常数为 $a$。超胞是一个人为构造的更大的重复单元，包含 $S$ 个原胞，晶格常数为 $A = S a$。\n\n在倒易空间中，这对应于超胞的更小的第一布里渊区（FBZ），即 $[-\\pi/A, \\pi/A)$，而原胞的FBZ为 $[-\\pi/a, \\pi/a)$。因此，在超胞形式下计算的能带结构呈现出“折叠”现象。来自原胞FBZ的多个点 $k$ 被映射到超胞FBZ中的单个点 $K$ 上。它们之间的关系由 $k = K + G_m$ 给出，其中 $G_m = m \\frac{2\\pi}{A} = m \\frac{2\\pi}{S a}$ 是超胞晶格的倒易晶格矢量，m为整数。解折叠算法量化了一个具有超胞动量 $K$ 的本征态在多大程度上对应于每个原始原胞动量 $k_m$。\n\n所设计的算法主要分四步进行：\n\n**1. 超胞哈密顿量构建**\n我们使用紧束缚近似来模拟一维原子链。超胞包含 $S$ 个格点（子晶格），索引为 $s \\in \\{0, 1, \\dots, S-1\\}$。每个格点 $s$ 有一个在位能 $\\varepsilon_s$，且最近邻格点之间存在跃迁振幅 $t$。对于给定的超胞晶体动量 $K$，哈密顿量 $H(K)$ 是一个 $S \\times S$ 的厄米矩阵。其矩阵元由应用于超胞的布洛赫定理推导得出。\n矩阵元为：\n-   对角元（在位能）：$H_{s,s}(K) = \\varepsilon_s$。\n-   非对角元（超胞内跃迁）：$H_{s, s+1}(K) = t$，其中 $s \\in \\{0, \\dots, S-2\\}$。\n-   非对角元（超胞间跃迁）：从一个超胞的格点 $s=S-1$ 到下一个超胞的格点 $s=0$ 的跃遷获得一个相位因子 $e^{iKA}$，因此 $H_{S-1, 0}(K) = t e^{iKA}$。\n-   厄米性要求 $H_{r,s}(K) = [H_{s,r}(K)]^*$。假设 $t$ 是实数，这意味着下一次对角线上的元为 $H_{s+1,s}(K) = t$，角元为 $H_{0,S-1}(K) = t e^{-iKA}$。\n\n对于大小为 $S$ 的超胞，哈密顿矩阵 $H(K)$ 的形式为：\n$$\nH(K) = \\begin{pmatrix}\n\\varepsilon_0  t  0  \\dots  t e^{-iKA} \\\\\nt  \\varepsilon_1  t  \\dots  0 \\\\\n0  t  \\varepsilon_2  \\ddots  \\vdots \\\\\n\\vdots  \\vdots  \\ddots  \\ddots  t \\\\\nt e^{iKA}  0  \\dots  t  \\varepsilon_{S-1}\n\\end{pmatrix}\n$$\n这个结构是通过将一个超胞内矩阵（对角线和主次对角线）和一个超胞间矩阵（角元）相加来实现的。\n\n**2. 本征态计算**\n对于超胞第一布里渊区内离散网格上的每个动量点 $K_j$，构建并对角化哈密顿量 $H(K_j)$。由于 $H(K_j)$ 是厄米矩阵，这将产生 $S$ 个实数特征值 $E_n(K_j)$（能带能量）和一组对应的 $S$ 个正交归一的本征矢量 $\\mathbf{u}^{(n)}(K_j)$。每个本征矢量 $\\mathbf{u}^{(n)}(K_j)$ 是一个大小为 $S$ 的列向量，其中分量 $u_s^{(n)}(K_j)$ 是子晶格 $s$ 上的波函数振幅。\n\n**3. 通过投影进行解折叠**\n解折叠的本质是将在超胞内的子晶格表象变换为原胞的布洛赫波表象。一个动量为 $k_m = K + G_m$ 的原胞布洛赫态，其在子晶格上的波函数分量变化形式为 $e^{i k_m x_s} = e^{i k_m s a}$，其中 $x_s = sa$ 是子晶格格点 $s$ 的位置。\n解折叠振幅 $c_m^{(n)}(K)$ 是超胞本征矢量 $\\mathbf{u}^{(n)}(K)$ 在与动量 $k_m$ 相关的原胞布洛赫基态上的投影：\n$$\nc_m^{(n)}(K) = \\frac{1}{\\sqrt{S}} \\sum_{s=0}^{S-1} e^{-i G_m s a} \\, u_s^{(n)}(K)\n$$\n因子 $1/\\sqrt{S}$ 确保变换是幺正的。相位是 $e^{-i G_m s a} = e^{-i (\\frac{2\\pi m}{Sa}) s a} = e^{-i 2\\pi ms/S}$。这表明振幅集合 $\\{c_m^{(n)}(K)\\}_{m=0}^{S-1}$ 实际上是本征矢量分量 $\\{u_s^{(n)}(K)\\}_{s=0}^{S-1}$ 的离散傅里叶变换（DFT），再乘以 $1/\\sqrt{S}$ 进行缩放。这个计算可以使用快速傅里叶变换（FFT）算法高效地执行。\n解折叠权重 $w_m^{(n)}(K) = |c_m^{(n)}(K)|^2$ 代表了超胞态 $(\\mathbf{u}^{(n)}, K)$ 源于动量为 $k_m$ 的原胞态的概率。\n\n**4. 算法验证**\n两个基本检查可验证算法的正确性：\n-   **归一化**：从一个正交归一基（子晶格格点）到另一个（原胞动量）的投影是一个幺正变换。根据DFT的帕塞瓦尔定理，范数必须守恒。由于本征矢量 $\\mathbf{u}^{(n)}(K)$ 是归一化的（$\\sum_s |u_s^{(n)}|^2 = 1$），解折叠权重的总和也必须为1：\n    $$\n    \\sum_{m=0}^{S-1} w_m^{(n)}(K) = \\sum_{m=0}^{S-1} |c_m^{(n)}(K)|^2 = 1\n    $$\n    在给定的数值容差 $\\tau$ 内，这对任何本征态和任何 $K$ 值都必须成立。\n\n-   **均匀极限**：如果超胞势是均匀的（对于所有 $s$，$\\varepsilon_s = \\varepsilon$），则超胞是一个人为的构造，系统保留了原胞晶格的完整平移对称性。真实的本征态是原胞的布洛赫态，每个态都有一个单一且明确的动量 $k$。在超胞计算中，这个态被折叠到 $K = k \\pmod{G_m}$。解折叠过程必须恢复这一事实，这意味着权重分布 $w_m^{(n)}(K)$ 应在单个 $m$ 值处呈现尖锐的峰值。验证检查是最大权重必须约等于1：$\\max_m w_m^{(n)}(K) \\ge 1 - \\tau$。在非均匀超胞中，预计此性质不成立，因为势场破坏了原胞对称性并混合了不同的动量分量。\n\n该实现使用了一个移位的动量网格 $K_j = -\\frac{\\pi}{A} + (j+\\frac{1}{2}) \\frac{2\\pi}{AM}$，以避免在高对称点（布里渊区边界）出现简并。",
            "answer": "```python\nimport numpy as np\n\ndef run_test_case(S, a, t, eps, M, check_delta):\n    \"\"\"\n    Runs a single test case for the Brillouin zone unfolding algorithm.\n\n    Args:\n        S (int): Number of primitive cells in the supercell.\n        a (float): Primitive lattice constant.\n        t (float): Nearest-neighbor hopping amplitude.\n        eps (list or np.ndarray): List of onsite energies for each sublattice.\n        M (int): Number of K-points in the supercell Brillouin zone grid.\n        check_delta (bool): Flag to indicate if the delta-peaked validation\n                            should be performed.\n\n    Returns:\n        bool: True if all validation checks pass for the test case, False otherwise.\n    \"\"\"\n    tau = 1e-10\n    pi = np.pi\n    \n    # Supercell lattice constant\n    A = S * a\n    \n    # Onsite energies as a numpy array\n    eps = np.array(eps)\n\n    # Supercell momentum grid (shifted to avoid BZ boundaries)\n    k_step = 2 * pi / (A * M)\n    K_grid = -pi / A + (np.arange(M) + 0.5) * k_step\n\n    for K in K_grid:\n        # Construct the supercell Hamiltonian H(K)\n        # 1. Intra-supercell part (diagonal and nearest off-diagonals)\n        H_intra = np.diag(eps) + np.diag(np.full(S - 1, t), k=1) + np.diag(np.full(S - 1, t), k=-1)\n        \n        # 2. Inter-supercell part (boundary condition terms)\n        H_inter = np.zeros((S, S), dtype=np.complex128)\n        # Hopping from site S-1 to next cell's site 0\n        H_inter[S - 1, 0] = t * np.exp(1j * K * A)\n        # Hopping from site 0 to previous cell's site S-1 (Hermiticity)\n        H_inter[0, S - 1] = np.conj(H_inter[S - 1, 0])\n        \n        # 3. Total Hamiltonian\n        H = H_intra.astype(np.complex128) + H_inter\n\n        # Diagonalize the Hermitian matrix H(K)\n        # np.linalg.eigh returns normalized eigenvectors in columns\n        _eigenvalues, eigenvectors = np.linalg.eigh(H)\n\n        # Loop over each band (eigenvector)\n        for n in range(S):\n            u_n = eigenvectors[:, n]\n\n            # Compute unfolding amplitudes c_m^{(n)}(K) via FFT\n            # The formula c_m = (1/sqrt(S)) * sum_s exp(-i*G_m*s*a) * u_s\n            # is equivalent to a scaled DFT, as G_m*s*a = 2*pi*m*s/S.\n            # np.fft.fft computes sum_s u_s * exp(-i*2*pi*m*s/S)\n            c_m_vec = np.fft.fft(u_n) / np.sqrt(S)\n\n            # Compute unfolding weights w_m^{(n)}(K)\n            weights = np.abs(c_m_vec)**2\n\n            # Validation Check 1: Normalization\n            # The sum of weights must be 1 due to the unitary nature of DFT.\n            if not np.isclose(np.sum(weights), 1.0, atol=tau):\n                return False\n\n            # Validation Check 2: Delta-peaked property for uniform supercells\n            if check_delta:\n                if not (np.max(weights) >= 1.0 - tau):\n                    return False\n    \n    # If all checks pass for all K-points and all bands, the test case is successful\n    return True\n\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and run the validation.\n    \"\"\"\n    test_cases = [\n        {\n            \"S\": 2, \"a\": 1.0, \"t\": 1.0, \"eps\": [0.0, 0.0], \"M\": 16,\n            \"check_delta\": True, \"description\": \"Uniform diatomic supercell\"\n        },\n        {\n            \"S\": 2, \"a\": 1.0, \"t\": 1.0, \"eps\": [0.3, -0.3], \"M\": 16,\n            \"check_delta\": False, \"description\": \"Nonuniform diatomic supercell\"\n        },\n        { \n            \"S\": 3, \"a\": 1.0, \"t\": 0.7, \"eps\": [0.0, 0.0, 0.0], \"M\": 18,\n            \"check_delta\": True, \"description\": \"Uniform triatomic supercell\"\n        }\n    ]\n\n    results = []\n    for case_params in test_cases:\n        # Isolate the parameters needed for the run function a\n        run_params = {k: v for k, v in case_params.items() if k != 'description'}\n        passed = run_test_case(**run_params)\n        results.append(passed)\n\n    # Format and print the final output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}