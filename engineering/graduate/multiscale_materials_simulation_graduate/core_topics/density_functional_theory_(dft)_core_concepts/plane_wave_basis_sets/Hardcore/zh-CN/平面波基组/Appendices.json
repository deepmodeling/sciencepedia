{
    "hands_on_practices": [
        {
            "introduction": "理解平面波基组的理论是一回事，亲手实现它则是另一回事。这项基础练习将指导您完成任何平面波计算中最关键的第一步：对于一个给定的周期性晶胞，生成满足动能截断条件 $E_{\\text{cut}}$ 的离散倒格子矢量 $\\mathbf{G}$ 集合。通过完成这项任务，您将具体地理解基组的大小是如何由模拟晶胞的几何形状和所选能量截断共同决定的。",
            "id": "3833123",
            "problem": "考虑一个边长为 $(L_x,L_y,L_z)$ 的正交周期性模拟晶胞，其中平面波基矢由倒格矢 $\\mathbf{G} = \\left(G_x,G_y,G_z\\right)$ 索引，这些倒格矢通过倒空间定义 $G_i = \\frac{2\\pi n_i}{L_i}$ 与整数三元组 $(n_x,n_y,n_z)\\in\\mathbb{Z}^3$ 相关联，适用于每个笛卡尔方向 $i\\in\\{x,y,z\\}$。在 Born–von Karman 周期性边界条件下，平面波 $\\exp\\left(i\\,\\mathbf{G}\\cdot \\mathbf{r}\\right)$ 是质量为 $m$ 的自由电子的动能算符 $-\\frac{\\hbar^2}{2m}\\nabla^2$ 的本征函数，其本征值取决于 $|\\mathbf{G}|^2$，其中 $\\hbar$ 是约化普朗克常数。动能随 $|\\mathbf{G}|^2$ 单调增加，这为基函数定义了一种按动能升序排列的自然顺序。\n\n任务：对于每个指定的测试用例，生成所有整数三元组 $(n_x,n_y,n_z)$ 的完整集合，使得在 $\\Gamma$ 点（即晶体波矢 $\\mathbf{k}=\\mathbf{0}$）对应的平面波动能不超过给定的能量截断值 $E_{\\mathrm{cut}}$。然后按动能升序对这些三元组进行排序；对于动能完全相等的三元组，按 $(n_x,n_y,n_z)$ 的升序字典序来打破僵局。计算满足截断条件的三元组数量，并按指定顺序列出它们。\n\n推导和实现的基本依据包括以下经过充分检验的事实：\n- 倒格矢分量满足 $G_i=\\frac{2\\pi n_i}{L_i}$，适用于每个 $i\\in\\{x,y,z\\}$ 和 $(n_x,n_y,n_z)\\in\\mathbb{Z}^3$。\n- 自由电子的动能算符为 $-\\frac{\\hbar^2}{2m}\\nabla^2$。\n- 平面波是拉普拉斯算符的本征函数，其动能取决于 $|\\mathbf{G}|^2$。\n- 按动能升序排序等价于按 $|\\mathbf{G}|^2$ 升序排序。\n\n单位和常数：\n- 使用国际单位制（SI）。晶胞长度必须以米（m）为单位，能量截断值以焦耳（J）为单位。\n- 使用电子静止质量 $m = 9.1093837015\\times 10^{-31}$ kg 和约化普朗克常数 $\\hbar = 1.054571817\\times 10^{-34}$ J·s。\n\n数值包容性和稳健性：\n- 如果计算出的动能小于或等于 $E_{\\mathrm{cut}}$，则包含该平面波。为避免在相等情况下因浮点数误差导致的漏选，应将比较实现为 $E \\le E_{\\mathrm{cut}}\\,(1+\\delta_{\\mathrm{rel}}) + \\delta_{\\mathrm{abs}}$，其中 $\\delta_{\\mathrm{rel}}=10^{-12}$ 且 $\\delta_{\\mathrm{abs}}=10^{-32}$ J。\n\n对于每个测试用例，你的程序必须返回：\n- 所包含三元组的整数数量。\n- 所有包含的三元组的有序列表，形式为列表的列表 $[n_x,n_y,n_z]$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果格式为 $[\\,\\text{count},\\,\\text{ordered\\_triplets}\\,]$。\n\n测试套件（每个元组为 $(L_x,L_y,L_z,E_{\\mathrm{cut}})$，其中 $L$ 的单位为米， $E_{\\mathrm{cut}}$ 的单位为焦耳）：\n- 情况 A（通用各向同性晶胞）：$(L_x,L_y,L_z,E_{\\mathrm{cut}})=\\left(1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,3.0\\times 10^{-19}\\right)$。\n- 情况 B（零值边界截断）：$(L_x,L_y,L_z,E_{\\mathrm{cut}})=\\left(1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,0\\right)$。\n- 情况 C（各向异性晶胞）：$(L_x,L_y,L_z,E_{\\mathrm{cut}})=\\left(1.0\\times 10^{-9},\\,2.0\\times 10^{-9},\\,3.0\\times 10^{-9},\\,1.0\\times 10^{-19}\\right)$。\n- 情况 D（相等情况下的简并壳层包含）：$(L_x,L_y,L_z,E_{\\mathrm{cut}})=\\left(1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,1.0\\times 10^{-9},\\,4.820\\times 10^{-19}\\right)$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，例如：$[[\\text{count}_A,\\text{list}_A],[\\text{count}_B,\\text{list}_B],[\\text{count}_C,\\text{list}_C],[\\text{count}_D,\\text{list}_D]]$。",
            "solution": "该问题是有效的。它科学地基于应用于周期性系统的量子力学原理，这是计算材料科学的基石。该问题是适定的，提供了所有必要的物理常数、数学定义和数值容差，以确定一个唯一且可验证的解。语言客观，要求明确。\n\n主要目标是识别出满足给定动能截断值 $E_{\\mathrm{cut}}$ 的平面波基函数集合，这些基函数由整数三元组 $(n_x, n_y, n_z)$ 索引。基函数被考虑在布里渊区的 $\\Gamma$ 点上，对应于晶体波矢 $\\mathbf{k}=\\mathbf{0}$。\n\n首先，我们建立平面波的动能与其对应的整数三元组之间的关系。质量为 $m$ 的自由电子的定态薛定谔方程由动能算符 $\\hat{T} = -\\frac{\\hbar^2}{2m}\\nabla^2$ 控制。平面波，形式为 $\\psi_{\\mathbf{G}}(\\mathbf{r}) \\propto \\exp(i\\,\\mathbf{G}\\cdot \\mathbf{r})$，是该算符的本征函数。这里，$\\mathbf{G}$ 是一个倒格矢。应用该算符可得：\n$$\n\\hat{T} \\psi_{\\mathbf{G}}(\\mathbf{r}) = -\\frac{\\hbar^2}{2m}\\nabla^2 \\exp(i\\,\\mathbf{G}\\cdot \\mathbf{r}) = -\\frac{\\hbar^2}{2m}}(i\\mathbf{G})\\cdot(i\\mathbf{G}) \\exp(i\\,\\mathbf{G}\\cdot \\mathbf{r}) = \\frac{\\hbar^2|\\mathbf{G}|^2}{2m} \\exp(i\\,\\mathbf{G}\\cdot \\mathbf{r})\n$$\n因此，动能本征值 $E_{\\mathbf{G}}$ 为：\n$$\nE_{\\mathbf{G}} = \\frac{\\hbar^2|\\mathbf{G}|^2}{2m}\n$$\n对于边长为 $(L_x, L_y, L_z)$ 的正交模拟晶胞，倒格矢 $\\mathbf{G} = (G_x, G_y, G_z)$ 的分量由整数三元组 $(n_x, n_y, n_z) \\in \\mathbb{Z}^3$ 定义为 $G_i = \\frac{2\\pi n_i}{L_i}$，其中 $i \\in \\{x, y, z\\}$。其模长的平方 $|\\mathbf{G}|^2$ 为：\n$$\n|\\mathbf{G}|^2 = G_x^2 + G_y^2 + G_z^2 = \\left(\\frac{2\\pi n_x}{L_x}\\right)^2 + \\left(\\frac{2\\pi n_y}{L_y}\\right)^2 + \\left(\\frac{2\\pi n_z}{L_z}\\right)^2 = 4\\pi^2 \\left(\\frac{n_x^2}{L_x^2} + \\frac{n_y^2}{L_y^2} + \\frac{n_z^2}{L_z^2}\\right)\n$$\n将此代入能量本征值表达式，得到特定三元组的动能 $E_{n_x,n_y,n_z}$：\n$$\nE_{n_x,n_y,n_z} = \\frac{\\hbar^2}{2m} \\left[ 4\\pi^2 \\left(\\frac{n_x^2}{L_x^2} + \\frac{n_y^2}{L_y^2} + \\frac{n_z^2}{L_z^2}\\right) \\right] = \\frac{2\\pi^2\\hbar^2}{m} \\left(\\frac{n_x^2}{L_x^2} + \\frac{n_y^2}{L_y^2} + \\frac{n_z^2}{L_z^2}\\right)\n$$\n任务是找到所有满足 $E_{n_x,n_y,n_z} \\le E_{\\mathrm{cut}}$ 的整数三元组 $(n_x, n_y, n_z)$。为了处理边界处的浮点精度问题，该条件使用容差来实现：\n$$\nE_{n_x,n_y,n_z} \\le E_{\\mathrm{cut,eff}} \\quad \\text{where} \\quad E_{\\mathrm{cut,eff}} = E_{\\mathrm{cut}}(1 + \\delta_{\\mathrm{rel}}) + \\delta_{\\mathrm{abs}}\n$$\n其中 $\\delta_{\\mathrm{rel}}=10^{-12}$ 且 $\\delta_{\\mathrm{abs}}=10^{-32}$ J。\n\n解决每个测试用例的算法流程如下：\n$1$. **初始化**：对于给定的测试用例 $(L_x, L_y, L_z, E_{\\mathrm{cut}})$，计算有效能量截断值 $E_{\\mathrm{cut,eff}}$。同时计算常数前置因子 $C_{\\text{factor}} = \\frac{2\\pi^2\\hbar^2}{m}$。包含一个三元组的条件变为：\n$$\n\\frac{n_x^2}{L_x^2} + \\frac{n_y^2}{L_y^2} + \\frac{n_z^2}{L_z^2} \\le \\frac{E_{\\mathrm{cut,eff}}}{C_{\\text{factor}}}\n$$\n这个不等式在 $(n_x, n_y, n_z)$ 空间中描述了一个椭球体，它界定了有效整数三元组的搜索范围。\n\n$2$. **椭球搜索**：通过迭代嵌套循环进行高效搜索，循环的边界由椭球条件动态约束。这避免了在更大的矩形体积中进行搜索。\n- 通过设置 $n_y=0$ 和 $n_z=0$ 找到 $|n_x|$ 的最大可能值：$n_{x,\\max} = \\lfloor L_x \\sqrt{E_{\\mathrm{cut,eff}} / C_{\\text{factor}}} \\rfloor$。我们从 $-n_{x,\\max}$ 到 $n_{x,\\max}$ 遍历 $n_x$。\n- 对于每个 $n_x$，通过设置 $n_z=0$ 找到 $|n_y|$ 的最大可能值：$n_{y,\\max}(n_x) = \\lfloor L_y \\sqrt{E_{\\mathrm{cut,eff}}/C_{\\text{factor}} - n_x^2/L_x^2} \\rfloor$。我们从 $-n_{y,\\max}(n_x)$ 到 $n_{y,\\max}(n_x)$ 遍历 $n_y$。\n- 对于每对 $(n_x, n_y)$， $|n_z|$ 的最大可能值为：$n_{z,\\max}(n_x, n_y) = \\lfloor L_z \\sqrt{E_{\\mathrm{cut,eff}}/C_{\\text{factor}} - n_x^2/L_x^2 - n_y^2/L_y^2} \\rfloor$。我们从 $-n_{z,\\max}(n_x, n_y)$ 到 $n_{z,\\max}(n_x, n_y)$ 遍历 $n_z$。\n通过此过程生成的每个三元组 $(n_x, n_y, n_z)$ 都保证满足能量截断条件。收集这些有效的三元组。\n\n$3$. **排序**：收集到的三元组必须根据指定的标准进行排序。\n- **主键**：精确的动能 $E_{n_x,n_y,n_z}$（不使用容差因子计算），按升序排列。\n- **次键**：对于能量简并（相同）的三元组，通过按 $(n_x, n_y, n_z)$ 的升序字典序排序来打破僵局。\n这可以通过为每个有效三元组创建一个形式为 $(E_{n_x,n_y,n_z}, n_x, n_y, n_z)$ 的元组列表，然后对该列表执行标准排序来实现。\n\n$4$. **最终处理**：排序后，提取出有序的三元组列表。该测试用例的最终结果包括有效三元组的总数和这些三元组的有序列表。对所有提供的测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the plane-wave basis set problem for a suite of test cases.\n    For each case, it finds all integer triplets (nx, ny, nz) whose\n    corresponding kinetic energy is below a cutoff, then sorts them\n    by energy and lexicographically.\n    \"\"\"\n\n    # --- Constants and Tolerances ---\n    # Electron rest mass in kg\n    m_e = 9.1093837015e-31\n    # Reduced Planck constant in J·s\n    hbar = 1.054571817e-34\n    # Relative and absolute tolerances for energy comparison\n    delta_rel = 1e-12\n    delta_abs = 1e-32\n\n    # --- Test Suite ---\n    # Each tuple is (Lx, Ly, Lz, E_cut) in SI units (m, J)\n    test_cases = [\n        # Case A (general isotropic cell)\n        (1.0e-9, 1.0e-9, 1.0e-9, 3.0e-19),\n        # Case B (boundary cutoff at zero)\n        (1.0e-9, 1.0e-9, 1.0e-9, 0.0),\n        # Case C (anisotropic cell)\n        (1.0e-9, 2.0e-9, 3.0e-9, 1.0e-19),\n        # Case D (degenerate shell inclusion at equality)\n        (1.0e-9, 1.0e-9, 1.0e-9, 4.820e-19),\n    ]\n\n    # List to store final results for all test cases\n    all_results = []\n\n    # --- Main Logic ---\n    # Pre-calculate the constant factor in the energy equation\n    C_factor = (2 * (np.pi**2) * (hbar**2)) / m_e\n\n    for case in test_cases:\n        Lx, Ly, Lz, E_cut = case\n\n        # Apply numerical tolerance to the energy cutoff\n        E_cut_eff = E_cut * (1 + delta_rel) + delta_abs\n        \n        # A list to store tuples of (energy, nx, ny, nz) for sorting\n        found_triplets_with_energy = []\n        \n        # Handle the E_cut  0 case explicitly to avoid sqrt of negative\n        if E_cut_eff  0:\n            all_results.append([0, []])\n            continue\n            \n        # Determine the search range for nx (outermost loop)\n        # We use a try-except block for sqrt(negative) arising from float precision\n        try:\n            nx_max = int(np.floor(Lx * np.sqrt(E_cut_eff / C_factor)))\n        except (ValueError, RuntimeWarning):\n            nx_max = 0\n\n        # Efficiently search the ellipsoid of valid (nx, ny, nz) triplets\n        for nx in range(-nx_max, nx_max + 1):\n            E_rem_y = E_cut_eff - C_factor * ((nx / Lx)**2)\n            if E_rem_y  0:\n                continue\n            \n            try:\n                ny_max = int(np.floor(Ly * np.sqrt(E_rem_y / C_factor)))\n            except (ValueError, RuntimeWarning):\n                ny_max = 0\n\n            for ny in range(-ny_max, ny_max + 1):\n                E_rem_z = E_cut_eff - C_factor * (((nx / Lx)**2) + ((ny / Ly)**2))\n                if E_rem_z  0:\n                    continue\n\n                try:\n                    nz_max = int(np.floor(Lz * np.sqrt(E_rem_z / C_factor)))\n                except (ValueError, RuntimeWarning):\n                    nz_max = 0\n                \n                for nz in range(-nz_max, nz_max + 1):\n                    # For a valid triplet, calculate its precise energy for sorting\n                    energy = C_factor * (((nx / Lx)**2) + ((ny / Ly)**2) + ((nz / Lz)**2))\n                    # The search guarantees energy = E_cut_eff. No re-check needed.\n                    found_triplets_with_energy.append((energy, nx, ny, nz))\n        \n        # Sort the results: primary key is energy, secondary is lexicographical (nx,ny,nz)\n        found_triplets_with_energy.sort(key=lambda item: (item[0], item[1], item[2], item[3]))\n        \n        # Extract the sorted triplets, discarding the energy values\n        sorted_triplets = [[t[1], t[2], t[3]] for t in found_triplets_with_energy]\n        \n        # Get the count of found triplets\n        count = len(sorted_triplets)\n        \n        # Append the result for the current case to the main results list\n        all_results.append([count, sorted_triplets])\n\n    # Format the final output string exactly as required, removing all spaces from the string representation\n    # of the list of lists.\n    final_output = str(all_results).replace(\" \", \"\")\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "在学习了如何构建平面波基组之后，理解它为何能有效描述晶体中的电子是至关重要的。这个解析性问题通过将系统简化到一维来提供深刻的物理洞察。通过对一对简并的平面波应用微扰理论，您将推导出在布里渊区边界处能隙的形成过程，从而揭示周期性势场如何将自由电子的抛物线色散关系转变为真实的能带结构这一基本机制。",
            "id": "3833109",
            "problem": "一个质量为 $m$ 的电子在一维空间中运动，其周期性势为 $V(x)=2V_{G}\\cos(Gx)$，其中 $G$ 是一个倒格矢的模（因此晶格间距为 $a=2\\pi/G$），$V_{G}$ 是一个设定势的傅里叶振幅的实常数。从不含时薛定谔方程 $-\\frac{\\hbar^{2}}{2m}\\frac{d^{2}}{dx^{2}}\\psi(x)+V(x)\\psi(x)=E\\psi(x)$ 和平面波基 $\\{\\exp(\\mathrm{i}kx)\\}$ 出发，使用 $V(x)$ 的傅里叶级数表示，在平面波基 $\\{|k-G\\rangle,|k\\rangle,|k+G\\rangle\\}$ 中构建截断的近自由电子哈密顿量，只保留由 $V(x)$ 的非零傅里叶分量产生的耦合。然后，使用此哈密顿量，在简并微扰理论下，假设 $|V_{G}|$ 与远离简并点的自由电子动能相比很小，确定在第一布里渊区边界（由 $k=G/2$ 定义）处最低两个能带之间的能带隙。用仅包含 $V_{G}$ 的单个闭合形式解析表达式来表示你的最终答案。不需要进行数值计算，也不需要报告单位，因为答案是符号化的。",
            "solution": "该问题要求在特定的周期性势下，对于一维近自由电子模型，确定其在第一布里渊区边界处的能带隙。\n\n首先，我们验证问题陈述的有效性。\n\n### 步骤1：提取已知条件\n- 电子质量：$m$\n- 空间维度：1\n- 周期性势：$V(x) = 2V_{G}\\cos(Gx)$\n- 倒格矢模：$G$\n- 晶格间距：$a=2\\pi/G$\n- 势的傅里叶振幅：$V_{G}$ 是一个实常数\n- 不含时薛定谔方程 (TISE)：$-\\frac{\\hbar^{2}}{2m}\\frac{d^{2}}{dx^{2}}\\psi(x)+V(x)\\psi(x)=E\\psi(x)$\n- 用于截断的基组：$\\{|k-G\\rangle,|k\\rangle,|k+G\\rangle\\}$，对应于平面波 $\\{\\exp(\\mathrm{i}(k-G)x), \\exp(\\mathrm{i}kx), \\exp(\\mathrm{i}(k+G)x)\\}$\n- 关注点：第一布里渊区边界，$k=G/2$\n- 方法：简并微扰理论\n- 假设：$|V_{G}|$ 与远离简并点的自由电子动能相比很小。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学上成立：** 该问题描述了近自由电子模型，这是固体物理学中用于解释电子能带结构的一个基本概念。它利用了薛定谔方程、傅里叶分析和微扰理论，所有这些都是标准的、成熟的理论工具。势 $V(x) = 2V_{G}\\cos(Gx)$ 是一个简单周期性势的典型例子。该问题在科学上是合理的。\n- **提法恰当：** 所有必要信息都已提供。势、基组、哈密顿量、k空间中的特定点（$k=G/2$）以及理论框架（简并微扰理论）都已明确定义。这使得可以推导出一个唯一且有意义的能带隙解。\n- **客观性：** 问题以精确、正式且无偏见的语言陈述，不含任何主观或推测性内容。\n\n### 步骤3：结论和行动\n该问题是有效的，因为它在科学上成立、提法恰当且客观。我现在将开始求解。\n\n哈密顿算符为 $H = T + V$，其中 $T = -\\frac{\\hbar^{2}}{2m}\\frac{d^{2}}{dx^{2}}$ 是动能算符，$V(x)$ 是势能算符。我们需要在给定的基 $\\{|k-G\\rangle, |k\\rangle, |k+G\\rangle\\}$ 中求出 $H$ 的矩阵表示。我们将基态表示为 $|1\\rangle = |k-G\\rangle$, $|2\\rangle = |k\\rangle$, 和 $|3\\rangle = |k+G\\rangle$。矩阵元为 $H_{ij} = \\langle i | H | j \\rangle$。\n\n动能算符 $T$ 在平面波基中是对角的。平面波 $|\\kappa\\rangle = \\exp(\\mathrm{i}\\kappa x)$ 是 $T$ 的一个本征态，其本征值为 $E_{\\kappa}^{0} = \\frac{\\hbar^{2}\\kappa^{2}}{2m}$。因此，哈密顿矩阵的动能部分为：\n$$\n\\mathbf{T} = \n\\begin{pmatrix}\n\\frac{\\hbar^{2}(k-G)^{2}}{2m}  0  0 \\\\\n0  \\frac{\\hbar^{2}k^{2}}{2m}  0 \\\\\n0  0  \\frac{\\hbar^{2}(k+G)^{2}}{2m}\n\\end{pmatrix}\n$$\n\n接下来，我们计算势 $V(x)$ 的矩阵元。势由 $V(x) = 2V_{G}\\cos(Gx)$ 给出。我们可以使用复指数来表示它：\n$$\nV(x) = 2V_{G} \\left(\\frac{\\exp(\\mathrm{i}Gx) + \\exp(-\\mathrm{i}Gx)}{2}\\right) = V_{G}\\exp(\\mathrm{i}Gx) + V_{G}\\exp(-\\mathrm{i}Gx)\n$$\n矩阵元 $V_{ij} = \\langle k_i | V(x) | k_j \\rangle$ 由积分给出（忽略会消去的归一化因子）：\n$$\nV_{ij} \\propto \\int V(x) \\exp(-\\mathrm{i}k_i x) \\exp(\\mathrm{i}k_j x) dx = \\int V(x) \\exp(\\mathrm{i}(k_j - k_i)x) dx\n$$\n这个积分正比于 $V(x)$ 在波矢 $q = k_i - k_j$ 处的傅里叶系数。从 $V(x)$ 的形式来看，唯一非零的傅里叶系数对应于 $q = G$ 和 $q = -G$，并且它们都等于 $V_{G}$（因为 $V_G$ 是实数）。\n让我们计算势矩阵 $\\mathbf{V}$ 的元素：\n- 对角元：$V_{11}$, $V_{22}$, $V_{33}$ 对应于 $q = 0$。由于 $V(x)$ 的 $q=0$ 傅里叶分量为零，这些元素为零。\n- 非对角元：\n    - $V_{12} = \\langle k-G | V | k \\rangle$：波矢差为 $k - (k-G) = G$。傅里叶系数为 $V_G$。\n    - $V_{21} = \\langle k | V | k-G \\rangle$：波矢差为 $(k-G) - k = -G$。傅里叶系数为 $V_{-G} = V_G$。\n    - $V_{23} = \\langle k | V | k+G \\rangle$：波矢差为 $(k+G) - k = G$。傅里叶系数为 $V_G$。\n    - $V_{32} = \\langle k+G | V | k \\rangle$：波矢差为 $k - (k+G) = -G$。傅里叶系数为 $V_{-G} = V_G$。\n    - $V_{13} = \\langle k-G | V | k+G \\rangle$：波矢差为 $(k+G) - (k-G) = 2G$。对应的傅里叶系数为零。\n    - $V_{31} = \\langle k+G | V | k-G \\rangle$：波矢差为 $(k-G) - (k+G) = -2G$。对应的傅里叶系数为零。\n\n所以，势矩阵是：\n$$\n\\mathbf{V} = \n\\begin{pmatrix}\n0  V_{G}  0 \\\\\nV_{G}  0  V_{G} \\\\\n0  V_{G}  0\n\\end{pmatrix}\n$$\n\n完整的哈密顿矩阵 $\\mathbf{H} = \\mathbf{T} + \\mathbf{V}$ 是：\n$$\n\\mathbf{H} = \n\\begin{pmatrix}\n\\frac{\\hbar^{2}(k-G)^{2}}{2m}  V_{G}  0 \\\\\nV_{G}  \\frac{\\hbar^{2}k^{2}}{2m}  V_{G} \\\\\n0  V_{G}  \\frac{\\hbar^{2}(k+G)^{2}}{2m}\n\\end{pmatrix}\n$$\n\n问题要求计算第一布里渊区边界处的能带隙，该边界发生在 $k=G/2$。在这一点，未受微扰的自由电子能量（$\\mathbf{H}$ 的对角元）是：\n- $E_{k-G}^{0} = \\frac{\\hbar^{2}(G/2-G)^{2}}{2m} = \\frac{\\hbar^{2}(-G/2)^{2}}{2m} = \\frac{\\hbar^{2}G^{2}}{8m}$\n- $E_{k}^{0} = \\frac{\\hbar^{2}(G/2)^{2}}{2m} = \\frac{\\hbar^{2}G^{2}}{8m}$\n- $E_{k+G}^{0} = \\frac{\\hbar^{2}(G/2+G)^{2}}{2m} = \\frac{\\hbar^{2}(3G/2)^{2}}{2m} = \\frac{9\\hbar^{2}G^{2}}{8m}$\n\n我们观察到未受微扰的态 $|k-G\\rangle = |-G/2\\rangle$ 和 $|k\\rangle = |G/2\\rangle$ 在能量上是简并的：$E_{-G/2}^{0} = E_{G/2}^{0} = \\frac{\\hbar^{2}G^{2}}{8m}$。态 $|k+G\\rangle = |3G/2\\rangle$ 的能量要高得多，不属于这个简并。\n\n根据简并微扰理论，我们必须在由 $\\{|k-G\\rangle, |k\\rangle\\}$ 张成的简并子空间内对角化哈密顿量。在 $k=G/2$ 处，$\\mathbf{H}$ 的相关 $2\\times2$ 子矩阵是：\n$$\n\\mathbf{H}_{\\text{deg}} = \n\\begin{pmatrix}\n\\frac{\\hbar^{2}G^{2}}{8m}  V_{G} \\\\\nV_{G}  \\frac{\\hbar^{2}G^{2}}{8m}\n\\end{pmatrix}\n$$\n为了求能量本征值 $E$，我们求解特征方程 $\\det(\\mathbf{H}_{\\text{deg}} - E\\mathbf{I}) = 0$：\n$$\n\\det \\begin{pmatrix}\n\\frac{\\hbar^{2}G^{2}}{8m} - E  V_{G} \\\\\nV_{G}  \\frac{\\hbar^{2}G^{2}}{8m} - E\n\\end{pmatrix} = 0\n$$\n$$\n\\left(\\frac{\\hbar^{2}G^{2}}{8m} - E\\right)^{2} - V_{G}^{2} = 0\n$$\n$$\n\\frac{\\hbar^{2}G^{2}}{8m} - E = \\pm \\sqrt{V_G^2} = \\pm |V_{G}|\n$$\n这给出了两个能量本征值，它们是施加微扰后在布里渊区边界处态的能量：\n$$\nE_{\\pm} = \\frac{\\hbar^{2}G^{2}}{8m} \\pm |V_{G}|\n$$\n微扰解除了简并，将单个能级分裂成两个。较低的能量 $E_{-} = \\frac{\\hbar^{2}G^{2}}{8m} - |V_{G}|$ 对应于第一（最低）能带的顶。较高的能量 $E_{+} = \\frac{\\hbar^{2}G^{2}}{8m} + |V_{G}|$ 对应于第二能带的底。\n\n能带隙 $E_g$ 是这两个能级之差：\n$$\nE_g = E_{+} - E_{-} = \\left(\\frac{\\hbar^{2}G^{2}}{8m} + |V_{G}|\\right) - \\left(\\frac{\\hbar^{2}G^{2}}{8m} - |V_{G}|\\right)\n$$\n$$\nE_g = |V_{G}| - (-|V_{G}|) = 2|V_{G}|\n$$\n最终答案仅用给定的参数 $V_G$ 表示。绝对值是必要的，因为能隙是一个非负量，而 $V_G$ 仅被定义为一个实常数，可能为负。",
            "answer": "$$\\boxed{2|V_{G}|}$$"
        },
        {
            "introduction": "这项实践练习旨在连接简单模型与真实的计算材料科学。您将编写一个小程序来计算模型晶体的电子带隙，将先前练习中的概念整合到一个完整的数值计算流程中。更重要的是，本练习引入了“收敛性”这一关键概念，要求您系统地测试计算出的带隙如何依赖于能量截断 $E_{\\text{cut}}$ 和 $\\mathbf{k}$ 点网格密度，而这两项正是任何计算材料学研究者为获得可靠模拟结果所必须掌握的基本技能。",
            "id": "2460283",
            "problem": "要求您研究晶体硅的间接带隙相对于平面波动能截断和晶体动量采样网格密度的收敛性。为便于计算，同时保留平面波基和布拉格散射的关键物理特性，请使用一个简化的三维近自由电子模型，该模型在简单立方布拉维晶格上具有余弦周期性势，通过布里渊区边界处的耦合捕捉到一个间接带隙。任务是实现一个完整的程序，该程序在每个晶体动量点上构建平面波基下的单电子哈密顿量，对其进行对角化以获得最低的两个能带，并根据所有采样的晶体动量点，将第二能带的最小值与第一能带的最大值之差作为间接带隙的估计值。所有能量必须以电子伏特报告，所有长度必须以埃报告。\n\n定义和模型：\n- 设晶格参数为 $a = 5.43\\,\\text{\\AA}$。倒格矢基矢为 $\\mathbf{b}_1 = \\frac{2\\pi}{a}\\hat{\\mathbf{x}}$、$\\mathbf{b}_2 = \\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 和 $\\mathbf{b}_3 = \\frac{2\\pi}{a}\\hat{\\mathbf{z}}$。第一布里渊区是立方体 $k_i \\in [-\\pi/a,\\pi/a)$，其中 $i \\in \\{x,y,z\\}$。\n- 电子动能为 $T(\\mathbf{q}) = \\frac{\\hbar^2 |\\mathbf{q}|^2}{2 m_e}$，其中 $\\frac{\\hbar^2}{2m_e} = 3.8099819442818976\\,\\text{eV}\\cdot\\text{\\AA}^2$。\n- 周期性势为 $V(\\mathbf{r}) = 2 V_c \\left[\\cos\\left(\\mathbf{b}_1 \\cdot \\mathbf{r}\\right) + \\cos\\left(\\mathbf{b}_2 \\cdot \\mathbf{r}\\right) + \\cos\\left(\\mathbf{b}_3 \\cdot \\mathbf{r}\\right)\\right]$，其傅里叶系数为 $V_{\\pm \\mathbf{b}_1} = V_{\\pm \\mathbf{b}_2} = V_{\\pm \\mathbf{b}_3} = V_c$，所有其他傅里叶系数均为零。使用 $V_c = -1.25\\,\\text{eV}$。$V(\\mathbf{r})$ 的晶胞平均值为零。\n- 对于每个晶体动量 $\\mathbf{k}$，平面波基由一组以整数三元组 $\\mathbf{n} = (n_x,n_y,n_z)$ 索引的状态构成，其波矢为 $\\mathbf{q}_{\\mathbf{n}}(\\mathbf{k}) = \\mathbf{k} + n_x \\mathbf{b}_1 + n_y \\mathbf{b}_2 + n_z \\mathbf{b}_3$，且满足动能截断条件 $T\\left(\\mathbf{q}_{\\mathbf{n}}(\\mathbf{k})\\right) \\le E_{\\text{cut}}$，其中 $E_{\\text{cut}}$ 是一个以电子伏特为单位的正参数。在此基下的哈密顿量矩阵元为\n$$\nH_{\\mathbf{n},\\mathbf{m}}(\\mathbf{k}) =\n\\begin{cases}\nT\\left(\\mathbf{q}_{\\mathbf{n}}(\\mathbf{k})\\right),  \\text{若 } \\mathbf{n} = \\mathbf{m},\\\\\nV_c,  \\text{若 } \\mathbf{n} - \\mathbf{m} \\in \\{\\pm(1,0,0), \\pm(0,1,0), \\pm(0,0,1)\\},\\\\\n0,  \\text{其他情况。}\n\\end{cases}\n$$\n\n晶体动量采样：\n- 对于整数 $N_k \\ge 1$，在均匀网格上对第一布里渊区进行采样，每个笛卡尔方向上有 $N_k$ 个点，位置在\n$$\nk_i(j) = -\\frac{\\pi}{a} + \\frac{2\\pi}{a}\\,\\frac{j}{N_k}, \\quad j \\in \\{0,1,\\dots,N_k-1\\}, \\quad i \\in \\{x,y,z\\}。\n$$\n这样可以得到 $N_k^3$ 个点 $\\mathbf{k}$ 进行评估。对于每个这样的 $\\mathbf{k}$，使用由截断定义的基构建 $H(\\mathbf{k})$。\n\n能带边和带隙：\n- 对于每个基组中至少包含一个平面波的 $\\mathbf{k}$，令 $E_1(\\mathbf{k}) \\le E_2(\\mathbf{k}) \\le \\dots$ 为 $H(\\mathbf{k})$ 的升序排列的本征值。在所有至少存在一个本征值的 $\\mathbf{k}$ 点集合上，定义价带顶为 $E_v = \\max_{\\mathbf{k}} E_1(\\mathbf{k})$。在所有至少存在两个本征值的 $\\mathbf{k}$ 点集合上，定义导带底为 $E_c = \\min_{\\mathbf{k}} E_2(\\mathbf{k})$。估算的间接带隙为 $E_g = E_c - E_v$，单位为电子伏特。如果没有任何 $\\mathbf{k}$ 点具有至少两个本征值，则 $E_g$ 未定义。\n\n测试组：\n计算以下参数对 $(E_{\\text{cut}}, N_k)$ 的 $E_g$（以电子伏特为单位）：\n- 情况 1：$(6.0, 1)$。\n- 情况 2：$(6.0, 4)$。\n- 情况 3：$(8.0, 4)$。\n- 情况 4：$(12.0, 10)$。\n- 情况 5：$(20.0, 12)$。\n\n输出要求：\n- 您的程序必须产生单行输出，包含五个结果，形式为方括号括起来的逗号分隔列表，例如 $[x_1,x_2,x_3,x_4,x_5]$，其中每个 $x_i$ 是对应情况下 $E_g$ 的浮点数值（以电子伏特为单位），四舍五入到6位小数。如果某个特定的 $E_g$ 因基组尺寸不足而未定义，则对该情况输出编程语言给出的非数字值的字符串表示，但不要更改列表的格式。",
            "solution": "问题陈述已经过严格验证，被认为是有效的。它具有科学依据，定义明确，客观，并包含进行唯一可验证求解所需的所有信息。它代表了计算固态物理学中一个标准但简化的问题，适用于阐释使用平面波基组计算电子能带结构的原理。我们现在开始求解。\n\n基本任务是求解周期性势中单电子的不含时薛定谔方程 $\\hat{H}\\psi(\\mathbf{r}) = E\\psi(\\mathbf{r})$，其中哈密顿量为 $\\hat{H} = \\hat{T} + \\hat{V} = -\\frac{\\hbar^2}{2m_e}\\nabla^2 + V(\\mathbf{r})$。势的周期性，$V(\\mathbf{r}) = V(\\mathbf{r}+\\mathbf{R})$（对于任何正格矢 $\\mathbf{R}$），赋予了本征态特定的结构。根据布洛赫定理 (Bloch's theorem)，解可以写成 $\\psi_{\\mathbf{k}}(\\mathbf{r}) = e^{i\\mathbf{k}\\cdot\\mathbf{r}}u_{\\mathbf{k}}(\\mathbf{r})$ 的形式，其中 $\\mathbf{k}$ 是第一布里渊区中的晶体动量矢量，而 $u_{\\mathbf{k}}(\\mathbf{r})$ 是一个晶胞周期函数，$u_{\\mathbf{k}}(\\mathbf{r}) = u_{\\mathbf{k}}(\\mathbf{r}+\\mathbf{R})$。\n\n鉴于 $u_{\\mathbf{k}}(\\mathbf{r})$ 是周期性的，它可以展开为关于倒格矢 $\\mathbf{G}$ 的傅里叶级数：$u_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}}(\\mathbf{G}) e^{i\\mathbf{G}\\cdot\\mathbf{r}}$。将此代入波函数的布洛赫形式，得到平面波展开：\n$$\n\\psi_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}}(\\mathbf{G}) e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}\n$$\n将此展开式代入薛定谔方程，对于每个 $\\mathbf{k}$，方程都转化为一个关于系数 $c_{\\mathbf{k}}(\\mathbf{G})$ 的无限维矩阵本征值问题。哈密顿量在此平面波基 $|\\mathbf{k}+\\mathbf{G}\\rangle$ 下的矩阵元由 $H_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\langle \\mathbf{k}+\\mathbf{G} | \\hat{H} | \\mathbf{k}+\\mathbf{G}' \\rangle$ 给出。\n\n动能算符 $\\hat{T}$ 在此基下是对角的：\n$$\n\\langle \\mathbf{k}+\\mathbf{G} | \\hat{T} | \\mathbf{k}+\\mathbf{G}' \\rangle = \\frac{\\hbar^2 |\\mathbf{k}+\\mathbf{G}|^2}{2m_e} \\delta_{\\mathbf{G},\\mathbf{G}'}\n$$\n势能算符 $\\hat{V}$ 的矩阵元由势的傅里叶系数决定，$V(\\mathbf{r}) = \\sum_{\\mathbf{G}} V_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}}$：\n$$\n\\langle \\mathbf{k}+\\mathbf{G} | \\hat{V} | \\mathbf{k}+\\mathbf{G}' \\rangle = V_{\\mathbf{G}-\\mathbf{G}'}\n$$\n将两者结合，完整的哈密顿矩阵元为：\n$$\nH_{\\mathbf{G},\\mathbf{G}'}(\\mathbf{k}) = \\frac{\\hbar^2 |\\mathbf{k}+\\mathbf{G}|^2}{2m_e} \\delta_{\\mathbf{G},\\mathbf{G}'} + V_{\\mathbf{G}-\\mathbf{G}'}\n$$\n问题指定了一个简单立方布拉维晶格，晶格参数 $a = 5.43\\,\\text{\\AA}$。其倒格子也是简单立方的，基矢为 $\\mathbf{b}_1 = \\frac{2\\pi}{a}\\hat{\\mathbf{x}}$、$\\mathbf{b}_2 = \\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 和 $\\mathbf{b}_3 = \\frac{2\\pi}{a}\\hat{\\mathbf{z}}$。一个普遍的倒格矢是 $\\mathbf{G}_{\\mathbf{n}} = n_x \\mathbf{b}_1 + n_y \\mathbf{b}_2 + n_z \\mathbf{b}_3$，其中 $\\mathbf{n} = (n_x, n_y, n_z)$ 是一个整数矢量。\n\n周期性势为 $V(\\mathbf{r}) = 2 V_c \\left[\\cos\\left(\\mathbf{b}_1 \\cdot \\mathbf{r}\\right) + \\cos\\left(\\mathbf{b}_2 \\cdot \\mathbf{r}\\right) + \\cos\\left(\\mathbf{b}_3 \\cdot \\mathbf{r}\\right)\\right]$。使用欧拉公式 $\\cos(x) = (e^{ix}+e^{-ix})/2$，我们确定其非零傅里叶系数为 $V_{\\mathbf{G}} = V_c$，当 $\\mathbf{G} \\in \\{\\pm\\mathbf{b}_1, \\pm\\mathbf{b}_2, \\pm\\mathbf{b}_3\\}$ 时，对于所有其他 $\\mathbf{G} \\ne 0$， $V_{\\mathbf{G}} = 0$。平均势 $V_{\\mathbf{G}=0}$ 为零。这意味着势仅将一个平面波 $|\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}\\rangle$ 与另一个平面波 $|\\mathbf{k}+\\mathbf{G}_{\\mathbf{m}}\\rangle$ 耦合，前提是差值 $\\mathbf{G}_{\\mathbf{n}}-\\mathbf{G}_{\\mathbf{m}}$ 是六个最短的非零倒格矢之一。这对应于条件 $\\mathbf{n}-\\mathbf{m}$ 是 $\\pm(1,0,0)$、$\\pm(0,1,0)$ 或 $\\pm(0,0,1)$ 之一。\n\n在实际计算中，无限基必须被截断。这是通过一个动能截断 $E_{\\text{cut}}$ 实现的。对于每个晶体动量 $\\mathbf{k}$，我们只在基组中包含那些动能低于截断值的平面波 $|\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}\\rangle$：\n$$\nT(\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}) = \\frac{\\hbar^2 |\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}|^2}{2m_e} \\le E_{\\text{cut}}\n$$\n这产生了一个有限维、依赖于 $\\mathbf{k}$ 的哈密顿矩阵 $H(\\mathbf{k})$，其矩阵元与问题陈述中指定的完全一致。该矩阵的本征值 $E_1(\\mathbf{k}) \\le E_2(\\mathbf{k}) \\le \\dots$，构成了电子能带结构。\n\n计算算法如下：\n1.  对于每对给定的参数 $(E_{\\text{cut}}, N_k)$，初始化计算。所需的物理常数为 $a = 5.43\\,\\text{\\AA}$、$\\frac{\\hbar^2}{2m_e} = 3.8099819442818976\\,\\text{eV}\\cdot\\text{\\AA}^2$ 和 $V_c = -1.25\\,\\text{eV}$。\n2.  根据规则 $k_i(j) = -\\frac{\\pi}{a} + \\frac{2\\pi}{a}\\,\\frac{j}{N_k}$（其中 $j=0, \\dots, N_k-1$），生成一个包含 $N_k^3$ 个晶体动量矢量 $\\mathbf{k}$ 的均匀网格，用于采样第一布里渊区。\n3.  对网格中的每个 $\\mathbf{k}$ 矢量：\n    a. 确定满足动能截断条件的整数矢量 $\\mathbf{n} = (n_x, n_y, n_z)$ 的有限集合。这通过在一个足够大的整数 $\\mathbf{n}$ 立方体范围内搜索并保留那些满足 $T(\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}}) \\le E_{\\text{cut}}$ 的矢量来完成。\n    b. 如果基组为空，则无法为该 $\\mathbf{k}$ 计算本征值。继续处理下一个 $\\mathbf{k}$。\n    c. 如果基组非空，则构建大小为 $N_{basis} \\times N_{basis}$ 的哈密顿矩阵 $H(\\mathbf{k})$。对角元为 $H_{\\mathbf{n},\\mathbf{n}}(\\mathbf{k}) = T(\\mathbf{k}+\\mathbf{G}_{\\mathbf{n}})$。如果 $\\mathbf{n}-\\mathbf{m}$ 是六个笛卡尔方向之一的单位矢量，则非对角元 $H_{\\mathbf{n},\\mathbf{m}}(\\mathbf{k})$ 为 $V_c$，否则为 $0$。\n    d. 得到的矩阵是厄米矩阵。对其进行对角化以找到其实数本征值。本征值按升序排序：$E_1(\\mathbf{k}) \\le E_2(\\mathbf{k}) \\le \\dots \\le E_{N_{basis}}(\\mathbf{k})$。\n    e. 收集第一个本征值 $E_1(\\mathbf{k})$ 和（如果存在）第二个本征值 $E_2(\\mathbf{k})$。\n4.  遍历所有 $\\mathbf{k}$ 点后，确定价带顶 $E_v = \\max_{\\mathbf{k}} E_1(\\mathbf{k})$，其中最大值取自所有产生至少一个本征值的 $\\mathbf{k}$ 点。\n5.  类似地，确定导带底 $E_c = \\min_{\\mathbf{k}} E_2(\\mathbf{k})$，其中最小值取自所有产生至少两个本征值的 $\\mathbf{k}$ 点。\n6.  如果无法确定 $E_c$（即，没有 $\\mathbf{k}$ 点产生大小为2或更大的基组），则带隙 $E_g$ 未定义。否则，计算间接带隙 $E_g = E_c - E_v$。\n7.  对所有五个测试用例重复此过程，并按指定格式报告结果。这一系统性过程确保了对所述问题提供一个正确且可复现的数值解。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the indirect band gap of a model crystal using a plane-wave basis.\n    \"\"\"\n    # Physical constants and model parameters\n    A_LATTICE = 5.43  # Lattice parameter in Angstroms\n    HBAR_SQ_2ME = 3.8099819442818976  # h-bar^2 / (2*m_e) in eV * Angstrom^2\n    V_C = -1.25  # Potential strength in eV\n\n    # Reciprocal lattice vector magnitude\n    B_SCALAR = 2 * np.pi / A_LATTICE\n\n    # Test cases: (E_cut in eV, N_k)\n    test_cases = [\n        (6.0, 1),\n        (6.0, 4),\n        (8.0, 4),\n        (12.0, 10),\n        (20.0, 12),\n    ]\n\n    results = []\n    for E_cut, N_k in test_cases:\n        e1_all_k = []\n        e2_all_k = []\n\n        # Generate k-point mesh\n        k_coords_1d = -np.pi / A_LATTICE + (2 * np.pi / A_LATTICE) * np.arange(N_k) / N_k\n        kx_grid, ky_grid, kz_grid = np.meshgrid(k_coords_1d, k_coords_1d, k_coords_1d, indexing='ij')\n        k_points = np.stack([kx_grid.ravel(), ky_grid.ravel(), kz_grid.ravel()], axis=-1)\n\n        # Determine search range for integer vectors n = (nx, ny, nz)\n        # Bounding box must account for k-vector shift.\n        # |k_i| = pi/a. We need C * (k_i + n_i*B)^2 = E_cut.\n        # |n_i*B| = sqrt(E_cut/C) + |k_i| = sqrt(E_cut/C) + pi/a\n        # |n_i| = (sqrt(E_cut/C) + pi/a) / B = a/(2pi) * sqrt(E_cut/C) + 1/2\n        n_lim = int(np.ceil((np.sqrt(E_cut / HBAR_SQ_2ME) + np.pi / A_LATTICE) / B_SCALAR))\n        n_range = np.arange(-n_lim, n_lim + 1)\n        nx_v, ny_v, nz_v = np.meshgrid(n_range, n_range, n_range, indexing='ij')\n        n_candidates = np.stack([nx_v.ravel(), ny_v.ravel(), nz_v.ravel()], axis=-1)\n\n        for k_vec in k_points:\n            # Generate basis set for the current k-point\n            G_vectors = n_candidates * B_SCALAR\n            q_vectors = k_vec + G_vectors\n            \n            kinetic_energies = HBAR_SQ_2ME * np.sum(q_vectors**2, axis=-1)\n            \n            basis_indices = np.where(kinetic_energies = E_cut)[0]\n            \n            if basis_indices.size == 0:\n                continue\n            \n            basis_n_vectors = n_candidates[basis_indices]\n            basis_ke = kinetic_energies[basis_indices]\n            N_basis = len(basis_n_vectors)\n            \n            # Construct Hamiltonian\n            H = np.diag(basis_ke)\n            \n            # Map n-vectors to matrix indices for efficient lookup\n            n_to_idx = {tuple(n): i for i, n in enumerate(basis_n_vectors)}\n            \n            # Off-diagonal elements\n            deltas = np.array([[1,0,0], [-1,0,0], [0,1,0], [0,-1,0], [0,0,1], [0,0,-1]])\n            for i, n_i in enumerate(basis_n_vectors):\n                for delta in deltas:\n                    n_j_tuple = tuple(n_i + delta)\n                    if n_j_tuple in n_to_idx:\n                        j = n_to_idx[n_j_tuple]\n                        # Only fill one triangle\n                        if i  j:\n                            H[i, j] = V_C\n                            H[j, i] = V_C\n\n            # Diagonalize and collect eigenvalues\n            if N_basis > 0:\n                # eigvalsh is efficient for Hermitian matrices and returns sorted eigenvalues\n                eigenvalues = np.linalg.eigvalsh(H)\n                e1_all_k.append(eigenvalues[0])\n                if N_basis >= 2:\n                    e2_all_k.append(eigenvalues[1])\n\n        # Calculate band gap for the current (E_cut, N_k) pair\n        if not e2_all_k:\n            Eg = np.nan\n        else:\n            E_v = np.max(e1_all_k)\n            E_c = np.min(e2_all_k)\n            Eg = E_c - E_v\n            \n        results.append(Eg)\n\n    # Format output as specified\n    formatted_results = []\n    for r in results:\n        if np.isnan(r):\n            formatted_results.append(\"nan\")\n        else:\n            formatted_results.append(f\"{r:.6f}\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}