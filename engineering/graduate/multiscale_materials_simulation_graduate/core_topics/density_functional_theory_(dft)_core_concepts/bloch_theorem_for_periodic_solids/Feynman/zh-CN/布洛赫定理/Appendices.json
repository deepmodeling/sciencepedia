{
    "hands_on_practices": [
        {
            "introduction": "平面波方法是现代电子结构计算的基石。这个练习提供了一个亲手实现该方法的机会，虽然是针对一个简单的一维模型，但它极具启发性。通过从薛定谔方程出发，推导周期性势中的哈密顿量，并将其转化为一个倒易空间中的矩阵本征值问题，你将实践固体物理学中的一个核心概念。通过数值求解并探索收敛性，你将对如何从第一性原理计算能带结构获得深刻而实际的理解 。",
            "id": "3792867",
            "problem": "考虑一个一维周期性固体，其由不含时薛定谔方程 $[-\\frac{\\hbar^2}{2m}\\frac{d^2}{dx^2} + V(x)]\\psi(x) = E\\psi(x)$ 描述，其中势函数为余弦势 $V(x) = 2V_G\\cos(Gx)$。根据 Bloch 定理，本征态的形式为 $\\psi_k(x) = e^{ikx}u_k(x)$，其中 $u_k(x)$ 在 $x \\mapsto x + a$ 变换下是周期的，而 $a = \\frac{2\\pi}{G}$ 是晶格周期。在平面波方法中，我们将 $u_k(x)$ 展开为傅里叶级数，并截断为有限数量的倒易晶格谐波。这会导出一个有限维厄米特征值问题，用于近似计算能带 $E_n(k)$。\n\n你的任务是从第一性原理出发，由薛定谔方程和布洛赫形式推导出势函数为 $V(x) = 2V_G\\cos(Gx)$ 的截断平面波哈密顿量。使用由整数 $m \\in \\{-M,\\ldots,M\\}$ 标记的平面波基，并定义作用于与基函数 $e^{i(k+mG)x}$ 相关系数的截断哈密顿量。在 $\\frac{\\hbar^2}{2m} = 1$ 的约化单位制下进行计算，因此能量 $E$ 需用此无量纲单位报告。角度或相位无需报告；若在内部计算中使用了任何角度，它们必须以弧度为单位。确保推导的每一步都基于傅里叶级数和正交性的基本定义和性质，并具有逻辑上的合理性。\n\n实现一个完整的、可运行的程序，该程序能够：\n- 对于给定的 $k$、$G$、$V_G$ 和整数截断值 $M$，构建截断的哈密顿矩阵。\n- 对每个指定的 $k$ 计算两个最低的本征值 $E_1(k)$ 和 $E_2(k)$。\n- 对于每个测试用例，通过计算一个单一的标量度量来评估随着 $G$-截断（即增加 $M$）的收敛性：该度量是指当 $M$ 从测试用例的 $M$ 列表中的一个值增加到下一个值时，在所有指定的 $k$ 值上，两个最低能量的最大绝对变化。更准确地说，如果一个测试用例指定了 $M$ 值列表 $[M_1, M_2, \\ldots, M_L]$ 和 $k$ 值集合 $\\{k_j\\}$，则为每个 $M_i$ 和 $k_j$ 构建双能带能量，并报告\n$$\n\\max_{i=1,\\ldots,L-1}\\max_{j}\\max_{n=1,2}\\left|E_n^{(M_{i+1})}(k_j) - E_n^{(M_i)}(k_j)\\right|.\n$$\n\n使用以下测试套件来评估不同的机制和边界条件：\n- 测试用例 1（中等近自由电子机制）：$V_G = 0.2$，$G = 2\\pi$，$M$ 列表 $[1, 2, 3]$，$k$ 列表 $\\{0, \\frac{G}{4}, \\frac{G}{2}\\}$。\n- 测试用例 2（弱势，关注布里渊区边界）：$V_G = 0.05$，$G = 2\\pi$，$M$ 列表 $[1, 2, 4]$，$k$ 列表 $\\{\\frac{G}{2}\\}$。\n- 测试用例 3（强势，需要更大的截断值）：$V_G = 1.0$，$G = 2\\pi$，$M$ 列表 $[2, 3, 5]$，$k$ 列表 $\\{0, \\frac{G}{4}, \\frac{G}{2}\\}$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，列表中的每个条目是对应测试用例的收敛度量（一个浮点数），并按上述顺序排列。例如：`[r_1,r_2,r_3]`，其中每个 $r_i$ 是上述定义的最大绝对变化，以约化能量单位 $\\frac{\\hbar^2}{2m}=1$ 表示，不带单位符号，并以普通十进制数打印。",
            "solution": "目标是为一维周期势推导截断的平面波哈密顿量，然后用它来计算能带结构能量的收敛性。\n\n### 平面波哈密顿量的推导\n\n出发点是描述一个质量为 $m$ 的电子在周期势 $V(x)$ 中运动的一维不含时薛定谔方程：\n$$\n\\left[-\\frac{\\hbar^2}{2m}\\frac{d^2}{dx^2} + V(x)\\right]\\psi(x) = E\\psi(x)\n$$\n问题指定了约化单位制，使得 $\\frac{\\hbar^2}{2m} = 1$。方程简化为：\n$$\n\\left[-\\frac{d^2}{dx^2} + V(x)\\right]\\psi(x) = E\\psi(x)\n$$\n势函数为 $V(x) = 2V_G\\cos(Gx)$。该势是周期的，晶格周期为 $a = \\frac{2\\pi}{G}$。根据 Bloch 定理，该周期系统的本征态可以写成如下形式：\n$$\n\\psi_k(x) = e^{ikx} u_k(x)\n$$\n其中 $k$ 是晶体动量（第一布里渊区中的一个连续变量），$u_k(x)$ 是一个与晶格具有相同周期性的周期函数，即 $u_k(x+a) = u_k(x)$。\n\n我们将波函数的布洛赫形式代入薛定谔方程。首先，计算 $\\psi_k(x)$ 的二阶导数：\n$$\n\\frac{d\\psi_k}{dx} = \\frac{d}{dx}\\left(e^{ikx} u_k(x)\\right) = ike^{ikx}u_k(x) + e^{ikx}\\frac{du_k}{dx} = e^{ikx}\\left(ik + \\frac{d}{dx}\\right)u_k(x)\n$$\n$$\n\\frac{d^2\\psi_k}{dx^2} = \\frac{d}{dx}\\left[e^{ikx}\\left(ik + \\frac{d}{dx}\\right)u_k(x)\\right] = e^{ikx}\\left(ik + \\frac{d}{dx}\\right)^2 u_k(x) = e^{ikx}\\left(-k^2 + 2ik\\frac{d}{dx} + \\frac{d^2}{dx^2}\\right)u_k(x)\n$$\n将此结果代入薛定谔方程：\n$$\n-e^{ikx}\\left(-k^2 + 2ik\\frac{d}{dx} + \\frac{d^2}{dx^2}\\right)u_k(x) + V(x)e^{ikx}u_k(x) = E e^{ikx}u_k(x)\n$$\n将整个方程除以非零因子 $e^{ikx}$，得到关于周期部分 $u_k(x)$ 的有效薛定谔方程：\n$$\n\\left[k^2 - 2ik\\frac{d}{dx} - \\frac{d^2}{dx^2} + V(x)\\right]u_k(x) = E u_k(x)\n$$\n这可以被重新整理为作用于 $u_k(x)$ 的有效哈密顿量 $\\hat{H}_k$ 的一个更标准的形式：\n$$\n\\hat{H}_k u_k(x) = \\left[\\left(-i\\frac{d}{dx} + k\\right)^2 + V(x)\\right]u_k(x) = E u_k(x)\n$$\n\n下一步是在一个合适的基中表示 $u_k(x)$ 和 $V(x)$。由于 $u_k(x)$ 的周期为 $a = 2\\pi/G$，它可以展开为傅里叶级数，基函数为平面波 $e^{iK_m x}$，其中 $K_m = m \\frac{2\\pi}{a} = mG$ 是倒格矢。整数 $m$ 是这些矢量的索引。\n$$\nu_k(x) = \\sum_{m=-\\infty}^{\\infty} c_m e^{i m G x}\n$$\n那么，完整的波函数 $\\psi_k(x)$ 就是平面波的叠加：\n$$\n\\psi_k(x) = e^{ikx} \\sum_m c_m e^{i m G x} = \\sum_m c_m e^{i(k+mG)x}\n$$\n势函数 $V(x) = 2V_G\\cos(Gx)$ 可以写成其复指数形式：\n$$\nV(x) = V_G \\left(e^{iGx} + e^{-iGx}\\right)\n$$\n现在，将 $u_k(x)$ 的傅里叶级数和 $V(x)$ 的复数形式代入有效薛定谔方程。\n首先，我们来看动能算符如何作用于基函数 $e^{imGx}$：\n$$\n\\left(-i\\frac{d}{dx} + k\\right)^2 e^{imGx} = \\left(-i(imG) + k\\right)^2 e^{imGx} = (k+mG)^2 e^{imGx}\n$$\n将完整哈密顿量 $\\hat{H}_k$ 应用于 $u_k(x)$ 的级数展开：\n$$\n\\hat{H}_k u_k(x) = \\sum_m c_m (k+mG)^2 e^{imGx} + V_G(e^{iGx} + e^{-iGx}) \\sum_m c_m e^{imGx} = E \\sum_m c_m e^{imGx}\n$$\n让我们展开势能项：\n$$\nV(x) u_k(x) = V_G \\sum_m c_m e^{i(m+1)Gx} + V_G \\sum_m c_m e^{i(m-1)Gx}\n$$\n完整的方程变为：\n$$\n\\sum_m c_m (k+mG)^2 e^{imGx} + V_G \\sum_m c_m e^{i(m+1)Gx} + V_G \\sum_m c_m e^{i(m-1)Gx} = E \\sum_m c_m e^{imGx}\n$$\n为了将这个泛函方程转换为关于系数 $\\{c_m\\}$ 的矩阵特征值问题，我们将其投影到选定整数 $n$ 的基函数 $e^{inGx}$ 上。这包括乘以 $e^{-inGx}$ 并在一个晶格周期（例如，从 $x=0$ 到 $x=a = 2\\pi/G$）上积分。我们使用正交关系 $\\int_0^a e^{i(m-n)Gx} dx = a \\delta_{mn}$。\n\n对每一项进行投影：\n1.  动能项： $\\sum_m c_m (k+mG)^2 \\int_0^a e^{i(m-n)Gx} dx = a c_n (k+nG)^2$。\n2.  势能项 1： $V_G \\sum_m c_m \\int_0^a e^{i(m+1-n)Gx} dx = a V_G c_{n-1}$ （因为克罗内克 $\\delta_{m+1,n}$ 仅在 $m=n-1$ 时非零）。\n3.  势能项 2： $V_G \\sum_m c_m \\int_0^a e^{i(m-1-n)Gx} dx = a V_G c_{n+1}$ （因为 $\\delta_{m-1,n}$ 仅在 $m=n+1$ 时非零）。\n4.  能量项（右侧）： $E \\sum_m c_m \\int_0^a e^{i(m-n)Gx} dx = a E c_n$。\n\n除以常数因子 $a$ 后，我们得到关于系数 $c_n$ 的一个线性代数方程组：\n$$\n(k+nG)^2 c_n + V_G c_{n-1} + V_G c_{n+1} = E c_n\n$$\n在实践中，无限求和必须被截断。我们将倒格矢的集合限制在 $m,n \\in \\{-M, -M+1, \\ldots, M-1, M\\}$，其中 $M$ 是一个正整数截断值。这产生了一个 $(2M+1)$ 维的方程组。该系统可以写成矩阵形式 $H\\mathbf{c} = E\\mathbf{c}$，其中 $\\mathbf{c} = (c_{-M}, \\ldots, c_M)^T$ 是系数向量。\n\n哈密顿矩阵 $H$ 的元素，由 $n, m \\in \\{-M, \\ldots, M\\}$ 索引，为：\n$$\nH_{nm} = \\langle n | \\hat{H}_k | m \\rangle = \\int_0^a e^{-inGx} \\hat{H}_k e^{imGx} dx / a\n$$\n根据上面推导的方程：\n$$\n\\sum_m H_{nm} c_m = (k+nG)^2 c_n + V_G c_{n-1} + V_G c_{n+1}\n$$\n通过观察，我们可以确定矩阵元素：\n-   对角元素 ($m=n$)：$H_{n,n} = (k+nG)^2$\n-   非对角元素 ($m=n \\pm 1$)：$H_{n,n-1} = H_{n,n+1} = V_G$\n-   所有其他元素均为零。\n\n这定义了一个 $(2M+1) \\times (2M+1)$ 的实对称三对角矩阵。例如，当 $M=1$ 时，索引为 $n,m \\in \\{-1, 0, 1\\}$。哈密顿矩阵为：\n$$\nH = \\begin{pmatrix}\n(k-G)^2  V_G  0 \\\\\nV_G  k^2  V_G \\\\\n0  V_G  (k+G)^2\n\\end{pmatrix}\n$$\n该矩阵的本征值对应于截断系统的能带 $E_n(k)$。增加 $M$ 会在基组中包含更多的平面波，并使计算出的本征值系统地收敛到给定势的精确解。",
            "answer": "```python\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Computes the convergence of the two lowest energy bands for a 1D cosine potential.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"V_G\": 0.2, \n            \"G\": 2 * np.pi, \n            \"M_list\": [1, 2, 3],\n            \"k_list\": [0.0, (2 * np.pi) / 4.0, (2 * np.pi) / 2.0]\n        },\n        {\n            \"V_G\": 0.05, \n            \"G\": 2 * np.pi, \n            \"M_list\": [1, 2, 4],\n            \"k_list\": [(2 * np.pi) / 2.0]\n        },\n        {\n            \"V_G\": 1.0, \n            \"G\": 2 * np.pi, \n            \"M_list\": [2, 3, 5],\n            \"k_list\": [0.0, (2 * np.pi) / 4.0, (2 * np.pi) / 2.0]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        V_G = case[\"V_G\"]\n        G = case[\"G\"]\n        M_list = case[\"M_list\"]\n        k_list = case[\"k_list\"]\n\n        # Store computed energies for each M\n        # Format: energies_by_M[M] = {k1: (E1, E2), k2: (E1, E2), ...}\n        energies_by_M = {}\n\n        for M in M_list:\n            energies_for_this_M = {}\n            dim = 2 * M + 1\n            \n            # The off-diagonal elements are constant for a given V_G\n            off_diag = np.full(dim - 1, V_G)\n            \n            for k in k_list:\n                # The diagonal elements depend on k, M, and G\n                m_indices = np.arange(-M, M + 1)\n                diag = (k + m_indices * G)**2\n                \n                # The Hamiltonian matrix is real, symmetric, and tridiagonal.\n                # scipy.linalg.eigh_tridiagonal is highly efficient for this case.\n                # It returns sorted eigenvalues.\n                eigenvalues = linalg.eigh_tridiagonal(diag, off_diag, eigvals_only=True)\n                \n                # We need the two lowest eigenvalues\n                energies_for_this_M[k] = (eigenvalues[0], eigenvalues[1])\n            \n            energies_by_M[M] = energies_for_this_M\n\n        # Calculate the convergence metric\n        # max_i max_j max_n |E_n^(M_{i+1})(k_j) - E_n^(M_i)(k_j)|\n        max_change_overall = 0.0\n        for i in range(len(M_list) - 1):\n            M_current = M_list[i]\n            M_next = M_list[i+1]\n            \n            energies_current = energies_by_M[M_current]\n            energies_next = energies_by_M[M_next]\n            \n            # Find the max change for this step in M\n            max_change_step = 0.0\n            for k in k_list:\n                E1_curr, E2_curr = energies_current[k]\n                E1_next, E2_next = energies_next[k]\n                \n                change1 = abs(E1_next - E1_curr)\n                change2 = abs(E2_next - E2_curr)\n                \n                max_change_step = max(max_change_step, change1, change2)\n\n            max_change_overall = max(max_change_overall, max_change_step)\n        \n        results.append(max_change_overall)\n\n    # Final print statement in the exact required format.\n    # Using format specifier to ensure plain decimal output and sufficient precision.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "完整的能带结构 $E(\\mathbf{k})$ 包含了丰富的信息，但为了模拟输运现象，使用简化的参数通常更为实用，其中最重要的参数便是有效质量。这项练习将引导你直接从能带的曲率出发，推导出有效质量张量，从而将这一关键概念牢固地建立在布洛赫电子的半经典动力学之上。理解 $E(\\mathbf{k})$ 的局部形状如何决定电子对外场的响应，对于连接量子力学计算结果与更大尺度的半导体器件或输运模型至关重要 。",
            "id": "3792908",
            "problem": "在多尺度材料模拟中，将量子尺度的能带结构与连续介质输运模型相联系，通常需要对能带极值点附近的Bloch电子进行有效质量描述。考虑一个三维周期性固体，其在 $\\mathbf{k}=\\mathbf{0}$ 处的非简并导带底附近的能量色散关系可近似表示为\n$$\nE(\\mathbf{k})=E_{0}+\\alpha\\,k_{x}^{2}+\\beta\\,k_{y}^{2}+\\gamma\\,k_{z}^{2},\n$$\n其中 $\\alpha$、$\\beta$ 和 $\\gamma$ 是与材料相关的正常数，$\\mathbf{k}=(k_{x},k_{y},k_{z})$ 是晶格波矢，$E_{0}$ 是能带边能量。从Bloch电子半经典动力学的第一性原理和核心定义出发，完成以下任务：\n\n1. 利用群速度的定义以及Bloch电子在缓变外力 $\\mathbf{F}$ 作用下的半经典运动方程，推导出在能带边处通过牛顿形式将 $\\mathbf{F}$ 与加速度 $\\mathbf{a}$ 联系起来的有效质量张量 $\\mathbf{m}^{\\ast}$。明确地将 $\\mathbf{m}^{\\ast}$ 与 $E(\\mathbf{k})$ 在 $\\mathbf{k}=\\mathbf{0}$ 处的局部曲率（二阶导数）联系起来，并为上述色散关系计算 $\\mathbf{m}^{\\ast}$ 的分量。\n\n2. 确定该能带结构下 $\\mathbf{m}^{\\ast}$ 的主轴，并根据曲率的对称性证明你的结论。\n\n3. 考虑态密度（DOS）有效质量，对于一个一般的三维各向异性二次型能带，其定义为 $m_{\\mathrm{DOS}}=\\left(\\det \\mathbf{m}^{\\ast}\\right)^{1/3}$。请用 $\\alpha$、$\\beta$、$\\gamma$ 和约化普朗克常数 $\\hbar$ 以闭合形式表示 $m_{\\mathrm{DOS}}$。\n\n为第1和第2项提供完整的推导过程，以确定有效质量张量是什么，并说明为何所确定的轴是主轴。对于第3项，仅报告 $m_{\\mathrm{DOS}}$ 的最终解析表达式。无需进行数值计算。最终答案必须是单一的闭合形式表达式。在最终的方框答案中不要包含单位。",
            "solution": "该问题要求基于给定的能带极小值附近的各向异性能量色散关系，推导Bloch电子的有效质量张量，确定其主轴，并计算态密度有效质量。分析将从晶体中电子动力学半经典模型的基本原理出发。\n\n半经典模型描述了电子波包在缓变势场中的运动。有两个核心方程控制此运动：\n1. 波包的群速度 $\\mathbf{v}_g$ 与能量色散 $E(\\mathbf{k})$ 的关系为：\n$$\n\\mathbf{v}_g = \\frac{1}{\\hbar} \\nabla_{\\mathbf{k}} E(\\mathbf{k})\n$$\n其中 $\\hbar$ 是约化普朗克常数，$\\mathbf{k}$ 是晶格波矢。\n\n2. 在外力 $\\mathbf{F}$（例如，来自电场）作用下，晶格波矢的变化率由下式给出：\n$$\n\\hbar \\frac{d\\mathbf{k}}{dt} = \\mathbf{F}\n$$\n\n**1. 有效质量张量 $\\mathbf{m}^{\\ast}$ 的推导**\n\n电子波包的加速度 $\\mathbf{a}$ 是其群速度 $\\mathbf{v}_g$ 的时间导数：\n$$\n\\mathbf{a} = \\frac{d\\mathbf{v}_g}{dt} = \\frac{d}{dt} \\left( \\frac{1}{\\hbar} \\nabla_{\\mathbf{k}} E(\\mathbf{k}) \\right)\n$$\n使用微分链式法则，加速度的第 $i$ 个分量 $a_i$ 为：\n$$\na_i = \\frac{1}{\\hbar} \\frac{d}{dt} \\left( \\frac{\\partial E}{\\partial k_i} \\right) = \\frac{1}{\\hbar} \\sum_{j} \\frac{\\partial}{\\partial k_j} \\left( \\frac{\\partial E}{\\partial k_i} \\right) \\frac{dk_j}{dt}\n$$\n其中求和遍及波矢 $\\mathbf{k}$ 的所有分量，即 $j \\in \\{x, y, z\\}$。根据半经典运动方程，我们有 $\\frac{dk_j}{dt} = \\frac{F_j}{\\hbar}$。将此代入加速度的表达式中，得到：\n$$\na_i = \\frac{1}{\\hbar} \\sum_{j} \\left( \\frac{\\partial^2 E}{\\partial k_i \\partial k_j} \\right) \\left( \\frac{F_j}{\\hbar} \\right) = \\frac{1}{\\hbar^2} \\sum_{j} \\left( \\frac{\\partial^2 E}{\\partial k_i \\partial k_j} \\right) F_j\n$$\n该方程将加速度矢量 $\\mathbf{a}$ 与力矢量 $\\mathbf{F}$ 联系起来。我们寻求一个牛顿形式 $\\mathbf{F} = \\mathbf{m}^{\\ast} \\mathbf{a}$，或等价地，$\\mathbf{a} = (\\mathbf{m}^{\\ast})^{-1} \\mathbf{F}$。通过与推导出的表达式进行比较，我们可以辨识出逆有效质量张量 $(\\mathbf{m}^{\\ast})^{-1}$ 的分量：\n$$\n\\left( (\\mathbf{m}^{\\ast})^{-1} \\right)_{ij} = \\frac{1}{\\hbar^2} \\frac{\\partial^2 E(\\mathbf{k})}{\\partial k_i \\partial k_j}\n$$\n元素为 $\\frac{\\partial^2 E}{\\partial k_i \\partial k_j}$ 的矩阵是能量色散 $E(\\mathbf{k})$ 的Hessian矩阵，代表其局部曲率。有效质量张量 $\\mathbf{m}^{\\ast}$ 是该Hessian矩阵的逆矩阵乘以 $\\hbar^2$：\n$$\n\\mathbf{m}^{\\ast} = \\hbar^2 \\left[ \\nabla_{\\mathbf{k}} \\nabla_{\\mathbf{k}} E(\\mathbf{k}) \\right]^{-1}\n$$\n现在，我们将此结果应用于给定的在能带极小值 $\\mathbf{k}=\\mathbf{0}$ 处的能量色散关系：\n$$\nE(\\mathbf{k}) = E_{0}+\\alpha k_{x}^{2}+\\beta k_{y}^{2}+\\gamma k_{z}^{2}\n$$\n我们计算二阶偏导数以构建Hessian矩阵。\n$$\n\\frac{\\partial^2 E}{\\partial k_x^2} = 2\\alpha, \\quad \\frac{\\partial^2 E}{\\partial k_y^2} = 2\\beta, \\quad \\frac{\\partial^2 E}{\\partial k_z^2} = 2\\gamma\n$$\n所有的混合偏导数都为零，例如：\n$$\n\\frac{\\partial^2 E}{\\partial k_x \\partial k_y} = \\frac{\\partial}{\\partial k_x} \\left( \\frac{\\partial E}{\\partial k_y} \\right) = \\frac{\\partial}{\\partial k_x} (2\\beta k_y) = 0\n$$\n由于这些导数是常数，因此在能带极小值附近的曲率是均匀的。$E(\\mathbf{k})$ 的Hessian矩阵为：\n$$\n\\nabla_{\\mathbf{k}} \\nabla_{\\mathbf{k}} E = \\begin{pmatrix} 2\\alpha  0  0 \\\\ 0  2\\beta  0 \\\\ 0  0  2\\gamma \\end{pmatrix}\n$$\n于是，逆有效质量张量为：\n$$\n(\\mathbf{m}^{\\ast})^{-1} = \\frac{1}{\\hbar^2} \\begin{pmatrix} 2\\alpha  0  0 \\\\ 0  2\\beta  0 \\\\ 0  0  2\\gamma \\end{pmatrix} = \\begin{pmatrix} \\frac{2\\alpha}{\\hbar^2}  0  0 \\\\ 0  \\frac{2\\beta}{\\hbar^2}  0 \\\\ 0  0  \\frac{2\\gamma}{\\hbar^2} \\end{pmatrix}\n$$\n有效质量张量 $\\mathbf{m}^{\\ast}$ 是 $(\\mathbf{m}^{\\ast})^{-1}$ 的逆。对于一个对角矩阵，其逆矩阵可以通过取每个对角元素的倒数来得到：\n$$\n\\mathbf{m}^{\\ast} = \\begin{pmatrix} \\frac{\\hbar^2}{2\\alpha}  0  0 \\\\ 0  \\frac{\\hbar^2}{2\\beta}  0 \\\\ 0  0  \\frac{\\hbar^2}{2\\gamma} \\end{pmatrix}\n$$\n其分量为 $m_{xx}^{\\ast} = \\frac{\\hbar^2}{2\\alpha}$，$m_{yy}^{\\ast} = \\frac{\\hbar^2}{2\\beta}$，和 $m_{zz}^{\\ast} = \\frac{\\hbar^2}{2\\gamma}$。\n\n**2. 有效质量张量的主轴**\n\n张量的主轴是其特征向量的方向。在其主轴基底下，张量表示为一个对角矩阵，对角线上的元素是相应的特征值（主值）。\n根据第1部分的结果，有效质量张量 $\\mathbf{m}^{\\ast}$ 在由波矢分量 $(k_x, k_y, k_z)$ 定义的笛卡尔坐标系中已经被表示为一个对角矩阵。这直接意味着该坐标系的基向量，即 $\\hat{\\mathbf{x}}$、$\\hat{\\mathbf{y}}$ 和 $\\hat{\\mathbf{z}}$，是 $\\mathbf{m}^{\\ast}$ 的特征向量。\n因此，对于该能带结构，有效质量张量的主轴是笛卡尔坐标轴 $\\hat{\\mathbf{x}}$、$\\hat{\\mathbf{y}}$ 和 $\\hat{\\mathbf{z}}$。理由是给定的能量色散关系 $E(\\mathbf{k}) = E_{0}+\\alpha k_{x}^{2}+\\beta k_{y}^{2}+\\gamma k_{z}^{2}$ 不包含诸如 $k_x k_y$ 的交叉项。这种函数形式确保了 $E(\\mathbf{k})$ 的Hessian矩阵，以及因此 $(\\mathbf{m}^{\\ast})^{-1}$ 和 $\\mathbf{m}^{\\ast}$，在 $(k_x, k_y, k_z)$ 坐标系中都是对角的。\n\n**3. 态密度（DOS）有效质量**\n\n问题将态密度有效质量定义为 $m_{\\mathrm{DOS}} = \\left(\\det \\mathbf{m}^{\\ast}\\right)^{1/3}$。我们计算上面推导出的有效质量张量 $\\mathbf{m}^{\\ast}$ 的行列式。对于对角矩阵，其行列式是对角元素的乘积：\n$$\n\\det \\mathbf{m}^{\\ast} = \\left(\\frac{\\hbar^2}{2\\alpha}\\right) \\left(\\frac{\\hbar^2}{2\\beta}\\right) \\left(\\frac{\\hbar^2}{2\\gamma}\\right) = \\frac{\\hbar^6}{8\\alpha\\beta\\gamma}\n$$\n现在，我们取该行列式的立方根来求得 $m_{\\mathrm{DOS}}$：\n$$\nm_{\\mathrm{DOS}} = \\left( \\frac{\\hbar^6}{8\\alpha\\beta\\gamma} \\right)^{1/3} = \\frac{(\\hbar^6)^{1/3}}{(8\\alpha\\beta\\gamma)^{1/3}} = \\frac{\\hbar^2}{2(\\alpha\\beta\\gamma)^{1/3}}\n$$\n这就是态密度有效质量的最终闭合形式表达式。",
            "answer": "$$ \\boxed{ \\frac{\\hbar^2}{2 \\left( \\alpha \\beta \\gamma \\right)^{1/3}} } $$"
        },
        {
            "introduction": "在实际的材料模拟中，我们经常研究含有缺陷、表面或有序相的体系，这需要使用破坏原胞晶格平移对称性的“超胞”。这种情况使得对计算出的能带结构的解读变得复杂。本练习介绍了一种强大的技术——“能带展开”，它利用谱权重将超胞中复杂的电子态投影回原胞的简约布里渊区。掌握这一概念将使你能够从现实的大尺度模拟中提取出具有物理意义的能带图，并准确区分主能带与因超胞构建而产生的“影子能带” 。",
            "id": "3792904",
            "problem": "考虑一个一维周期性固体，其模型为每个格点具有单一轨道的紧束缚链，原胞平移矢量为 $a$。在包含 $N$ 个原胞的超胞上施加 Born–von Karman 边界条件，因此希尔伯特空间由长度为 $N$ 的复向量组成，表示在格点 $j=0, 1, \\dots, N-1$ 上的振幅 $\\psi_j$，在平移 $a$ 的作用下采用循环索引。根据周期性系统的基本结构，哈密顿量与平移算符 $T_a$ 对易，并且本征态可以相对于由 $T_a$ 生成的平移进行同时对角化。对于由 $T_a$ 在 $N$ 个原胞上生成的离散循环群，原初波矢为 $k_n = \\frac{2\\pi n}{N a}$，其中整数 $n=0, 1, \\dots, N-1$（角度以弧度为单位）。\n\n从布洛赫态是平移算符的共同本征态（本征值为 $e^{i k a}$）这一事实出发，构建投影算符，该算符将任意态投影到根据由原初波矢 $k_n$ 标记的一维表示进行变换的子空间上。对于一个归一化的超胞本征态 $\\psi$（一个长度为 $N$ 的复向量），将谱权重 $W(k_n;\\psi)$ 定义为 $\\psi$ 投影到与 $k_n$ 相关的表示上的分量的模方。仅使用这一基本基础和平移群的性质，设计一个算法，对于任何给定的态 $\\psi$，计算其谱权重列表 $[W(k_0;\\psi), W(k_1;\\psi), \\dots, W(k_{N-1};\\psi)]$。然后，使用这些谱权重，定义一个规则来识别“影子能带”：主能带是谱权重达到其最大值的原初波矢指数；影子能带是任何谱权重严格为正且严格小于该最大值的原初波矢指数。如果有多个指数共享最大值，则将它们全部视为主能带，并且在这些最大值中不标记任何影子能带。\n\n你的程序必须对以下测试套件实现此计算，其中 $N=4$，$a=1$（角度以弧度为单位），并生成四舍五入到六位小数的谱权重：\n\n1. 情况 A（纯布洛赫态）：$\\psi_j = \\frac{1}{\\sqrt{N}} e^{i k j a}$，其中 $k = \\frac{\\pi}{2}$，$j=0, 1, 2, 3$。\n2. 情况 B（混合布洛赫态）：$\\psi = \\sqrt{0.8}\\,\\phi_{k_0} + \\sqrt{0.2}\\,\\phi_{k_1}$，其中 $\\phi_{k_n}$ 表示归一化的布洛赫态，其分量为 $(\\phi_{k_n})_j = \\frac{1}{\\sqrt{N}} e^{i k_n j a}$，$k_0 = 0$，$k_1 = \\frac{\\pi}{2}$，$j=0, 1, 2, 3$。\n3. 情况 C（局域态）：$\\psi_j = \\delta_{j,0}$，其中 $\\delta_{j,0}$ 是克罗内克 δ 函数。\n\n对于每种情况，计算谱权重并使用上述规则识别影子能带。最终输出格式必须是包含三种情况结果的单行 Python 风格列表，其中每种情况由一个包含两个列表的列表表示：第一个是按 $[k_0, k_1, k_2, k_3]$ 顺序排列的谱权重列表，四舍五入到六位小数；第二个是相同长度的整数列表，其中 $1$ 表示影子能带，否则为 $0$。例如，输出必须具有 `[[weights_A,shadows_A],[weights_B,shadows_B],[weights_C,shadows_C]]` 的形式，其中每个占位符都被实际的浮点数和整数列表替换。\n\n您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，`[[w_A,s_A],[w_B,s_B],[w_C,s_C]]`）。",
            "solution": "问题陈述已经过严格验证，被认为是具有科学依据、定义明确、客观且内部一致的。它提出了一个计算凝聚态物理学中标准但具有实质性内容的问题。\n\n问题的核心是根据布洛赫波来确定给定量子态 $\\psi$ 的构成，布洛赫波是周期性系统中的元激发。这是通过计算第一布里渊区中每个允许的波矢 $k_n$ 的谱权重 $W(k_n; \\psi)$ 来实现的。\n\n**1. 理论框架：布洛赫定理与投影算符**\n\n在具有晶格常数 $a$ 和 $N$ 个格点的一维周期性固体中，在 Born-von Karman（周期性）边界条件下，系统具有离散的平移对称性。这种对称性由平移算符 $T_a$ 描述，它将波函数平移一个晶格位置：$(T_a \\psi)_j = \\psi_{j-1 \\pmod N}$。所有平移的集合构成一个 $N$ 阶循环群，记为 $C_N$，其元素为 $\\{(T_a)^m | m=0, 1, \\dots, N-1\\}$。\n\n根据布洛赫定理，哈密顿量的本征态可以选择为平移算符 $T_a$ 的同时本征态。这些被称为布洛赫态 $\\phi_k$ 的本征态满足本征值方程：\n$$\nT_a \\phi_k = \\lambda_k \\phi_k = e^{i k a} \\phi_k\n$$\n其中 $k$ 是波矢，$e^{i k a}$ 是相应的本征值，由于周期性边界条件 $(T_a)^N = I$，它必须是单位根。这将允许的波矢量子化为离散的原初波矢集合：\n$$\nk_n = \\frac{2\\pi n}{Na}, \\quad \\text{for } n = 0, 1, \\dots, N-1.\n$$\n对应于这些不同波矢的布洛赫态 $\\{\\phi_{k_n}\\}$ 构成了 $N$ 维希尔伯特空间的完备正交基。一个归一化的布洛赫态具有以下分量：\n$$\n(\\phi_{k_n})_j = \\frac{1}{\\sqrt{N}} e^{i k_n j a}\n$$\n\n问题要求构建投影算符 $P_{k_n}$，它将任意态 $\\psi$ 投影到由布洛赫态 $\\phi_{k_n}$ 张成的一维子空间上。这可以从循环群 $C_N$ 的表示论中导出。投影到根据由 $k_n$ 标记的不可约表示（irrep）变换的子空间上的投影算符由下式给出：\n$$\nP_{k_n} = \\frac{d_n}{|G|} \\sum_{g \\in G} \\overline{\\chi_{k_n}(g)} g\n$$\n对于循环群 $C_N$，所有不可约表示都是一维的，因此维数 $d_n = 1$。群的阶为 $|G| = N$。群元素为 $g_j = (T_a)^j$，其中 $j=0, \\dots, N-1$。与 $k_n$ 相关联的不可约表示的特征标 $\\chi_{k_n}$ 是群元素的本征值。对于元素 $(T_a)^j$，特征标为 $\\chi_{k_n}((T_a)^j) = (e^{i k_n a})^j = e^{i k_n j a}$。\n将这些代入公式得到投影算符：\n$$\nP_{k_n} = \\frac{1}{N} \\sum_{j=0}^{N-1} e^{-i k_n j a} (T_a)^j\n$$\n\n**2. 算法设计：谱权重与离散傅里叶变换**\n\n谱权重 $W(k_n; \\psi)$ 定义为归一化态 $\\psi$ 在对应于 $k_n$ 的子空间上的投影的模方：\n$$\nW(k_n; \\psi) = \\| P_{k_n} \\psi \\|^2\n$$\n虽然可以直接将算符 $P_{k_n}$ 应用于 $\\psi$，但存在一种更优雅且计算效率更高的方法。由于布洛赫态 $\\{\\phi_{k_m}\\}$ 构成一个正交归一基，任何态 $\\psi$ 都可以展开为：\n$$\n\\psi = \\sum_{m=0}^{N-1} c_m \\phi_{k_m}\n$$\n系数 $c_m$ 由内积 $c_m = \\langle \\phi_{k_m} | \\psi \\rangle$ 给出。将投影算符 $P_{k_n}$ 应用于此展开式，我们注意到 $P_{k_n}$ 会湮灭所有 $m \\neq n$ 的基态 $\\phi_{k_m}$，并作为单位算符作用于 $\\phi_{k_n}$。因此：\n$$\nP_{k_n} \\psi = P_{k_n} \\left( \\sum_{m=0}^{N-1} c_m \\phi_{k_m} \\right) = c_n \\phi_{k_n}\n$$\n于是，谱权重就是展开系数的模方：\n$$\nW(k_n; \\psi) = \\| c_n \\phi_{k_n} \\|^2 = |c_n|^2 \\| \\phi_{k_n} \\|^2 = |c_n|^2\n$$\n因为布洛赫态是归一化的。问题简化为求系数 $c_n$。让我们计算内积：\n$$\nc_n = \\langle \\phi_{k_n} | \\psi \\rangle = \\sum_{j=0}^{N-1} (\\phi_{k_n})_j^* \\psi_j = \\sum_{j=0}^{N-1} \\left( \\frac{1}{\\sqrt{N}} e^{i k_n j a} \\right)^* \\psi_j = \\frac{1}{\\sqrt{N}} \\sum_{j=0}^{N-1} \\psi_j e^{-i k_n j a}\n$$\n代入 $k_n = \\frac{2\\pi n}{Na}$:\n$$\nc_n = \\frac{1}{\\sqrt{N}} \\sum_{j=0}^{N-1} \\psi_j e^{-i \\frac{2\\pi n j}{N}}\n$$\n该和是态矢量 $\\psi = (\\psi_0, \\psi_1, \\dots, \\psi_{N-1})$ 的离散傅里叶变换（DFT）的第 $n$ 个分量。令 $(\\text{DFT}(\\psi))_n = \\sum_{j=0}^{N-1} \\psi_j e^{-i \\frac{2\\pi n j}{N}}$。那么，$c_n = \\frac{1}{\\sqrt{N}} (\\text{DFT}(\\psi))_n$。\n因此，谱权重与 DFT直接相关：\n$$\nW(k_n; \\psi) = |c_n|^2 = \\left| \\frac{1}{\\sqrt{N}} (\\text{DFT}(\\psi))_n \\right|^2 = \\frac{1}{N} \\left| (\\text{DFT}(\\psi))_n \\right|^2\n$$\n这提供了一个直接的算法：给定一个态矢量 $\\psi$，计算其 DFT，求出每个分量的模方，然后除以 $N$ 进行归一化。像快速傅里叶变换（FFT）这样的高效算法使得这种计算性能非常高。\n\n**3. 应用于测试案例**\n\n我们将此算法应用于给定的测试案例，其中 $N=4$ 且 $a=1$。原初波矢为 $k_n = \\frac{2\\pi n}{4 \\cdot 1} = \\frac{n\\pi}{2}$，其中 $n=0,1,2,3$。\n\n**情况 A (纯布洛赫态)：** $\\psi_j = \\frac{1}{\\sqrt{N}} e^{i k j a}$，其中 $k = \\pi/2$。\n这恰好是归一化的布洛赫态 $\\phi_{k_1}$（因为 $k_1 = \\pi/2$）。态矢量为 $\\psi = \\frac{1}{2}(1, i, -1, -i)$。根据定义，其在布洛赫基中的展开为 $\\psi = 1 \\cdot \\phi_{k_1} + 0 \\cdot \\phi_{k_n}$，对于 $n \\neq 1$。\n系数为 $c_1=1$，其他 $c_n=0$。\n谱权重为 $W(k_n; \\psi) = |c_n|^2$，得出 $[0, 1, 0, 0]$。\n最大权重为 $1.0$。没有其他权重是严格为正的，因此没有影子能带。影子能带指示符为 $[0, 0, 0, 0]$。\n\n**情况 B (混合布洛赫态)：** $\\psi = \\sqrt{0.8}\\,\\phi_{k_0} + \\sqrt{0.2}\\,\\phi_{k_1}$。\n该状态已在布洛赫基展开中给出。系数为 $c_0 = \\sqrt{0.8}$，$c_1 = \\sqrt{0.2}$，且 $c_2 = c_3 = 0$。\n谱权重为 $W(k_n; \\psi) = |c_n|^2$。\n$W(k_0) = |\\sqrt{0.8}|^2 = 0.8$。\n$W(k_1) = |\\sqrt{0.2}|^2 = 0.2$。\n$W(k_2) = 0$，$W(k_3) = 0$。\n权重为 $[0.8, 0.2, 0, 0]$。最大值为 $0.8$。索引 $1$ 处的权重为 $0.2$，满足 $0  0.2  0.8$。因此，$k_1$ 是一个影子能带。影子能带指示符为 $[0, 1, 0, 0]$。\n\n**情况 C (局域态)：** $\\psi_j = \\delta_{j,0}$。\n态矢量为 $\\psi = (1, 0, 0, 0)$。此态是归一化的。我们计算其 DFT：\n$(\\text{DFT}(\\psi))_n = \\sum_{j=0}^{3} \\psi_j e^{-i \\frac{2\\pi n j}{4}} = 1 \\cdot e^0 + 0 + 0 + 0 = 1$，对所有 $n=0,1,2,3$ 成立。\n谱权重为 $W(k_n; \\psi) = \\frac{1}{N} |(\\text{DFT}(\\psi))_n|^2 = \\frac{1}{4} |1|^2 = 0.25$。\n权重为 $[0.25, 0.25, 0.25, 0.25]$。所有权重都等于最大值 $0.25$。根据规则，“如果有多个指数共享最大值……在这些最大值中不标记任何影子能带。” 因此，没有影子能带。影子能带指示符为 $[0, 0, 0, 0]$。实空间中的局域态是所有动量态的均匀叠加。\n\n该分析为实现提供了所有必要的组成部分。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spectral weights and identifies shadow bands for three quantum states\n    in a 1D tight-binding model.\n    \"\"\"\n    N = 4\n    a = 1.0\n\n    # Define primitive reciprocal lattice vectors\n    # k_n = 2 * pi * n / (N * a) for n = 0, 1, 2, 3\n    # k_0=0, k_1=pi/2, k_2=pi, k_3=3pi/2\n    k_vals = [(2 * np.pi * n) / (N * a) for n in range(N)]\n    site_indices = np.arange(N)\n\n    # === Case A: Pure Bloch state ===\n    # psi_j = 1/sqrt(N) * exp(i * k * j * a) with k = pi/2 = k_1\n    k_A = np.pi / 2\n    psi_A = (1 / np.sqrt(N)) * np.exp(1j * k_A * site_indices * a)\n\n    # === Case B: Mixed Bloch state ===\n    # psi = sqrt(0.8)*phi_k0 + sqrt(0.2)*phi_k1\n    # where phi_kn_j = 1/sqrt(N) * exp(i * kn * j * a)\n    phi_k0 = (1 / np.sqrt(N)) * np.exp(1j * k_vals[0] * site_indices * a)\n    phi_k1 = (1 / np.sqrt(N)) * np.exp(1j * k_vals[1] * site_indices * a)\n    psi_B = np.sqrt(0.8) * phi_k0 + np.sqrt(0.2) * phi_k1\n\n    # === Case C: Localized state ===\n    # psi_j = delta_{j,0}\n    psi_C = np.zeros(N, dtype=np.complex128)\n    psi_C[0] = 1.0\n\n    # List of state vectors to process\n    test_cases_psi = [psi_A, psi_B, psi_C]\n    \n    all_results = []\n    \n    for psi in test_cases_psi:\n        # The spectral weight W(k_n; psi) is |c_n|^2, where c_n are the coefficients\n        # of the state psi in the Bloch basis. This can be efficiently computed\n        # using the Fast Fourier Transform (FFT).\n        # W(k_n; psi) = (1/N) * |DFT(psi)_n|^2\n        dft_psi = np.fft.fft(psi)\n        weights = (np.abs(dft_psi)**2) / N\n\n        # Find shadow bands based on the provided rule.\n        # Main band(s) have maximum weight.\n        # Shadow bands have weight > 0 and  max_weight.\n        # A small tolerance is used for robust floating-point comparisons.\n        max_w = np.max(weights)\n        epsilon = 1e-9  # Tolerance for float comparison\n        \n        shadows = [1 if (w > epsilon and w  max_w - epsilon) else 0 for w in weights]\n        \n        # Format weights to six decimal places\n        formatted_weights = [round(w, 6) for w in weights]\n        \n        all_results.append([formatted_weights, shadows])\n\n    # Convert the final list to a string and remove spaces to match the dense format.\n    output_str = str(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}