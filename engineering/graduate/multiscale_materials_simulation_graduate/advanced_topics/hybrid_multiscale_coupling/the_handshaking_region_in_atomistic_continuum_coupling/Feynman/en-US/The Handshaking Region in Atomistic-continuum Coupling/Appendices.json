{
    "hands_on_practices": [
        {
            "introduction": "Before assessing the accuracy of a multiscale coupling scheme, one must first verify its fundamental consistency. The \"patch test\" is a critical benchmark that ensures a coupled model can exactly reproduce a constant strain state without generating spurious, non-physical \"ghost forces\" at the interface . This exercise provides a hands-on derivation of these ghost forces in a flawed coupling scheme and demonstrates how to formulate a corrective term to restore patch-test consistency, a mandatory first step in developing a robust method.",
            "id": "3846756",
            "problem": "Consider a one-dimensional harmonic atomic chain modeling a homogeneous crystalline solid with nearest-neighbor interactions. Atoms are indexed by integers $i \\in \\mathbb{Z}$ and occupy reference positions $X_{i} = i a$, where $a > 0$ is the lattice spacing. The deformed positions are $x_{i} = X_{i} + u_{i}$, where $u_{i}$ is the displacement. Neighbor pairs are connected by linear springs of stiffness $k > 0$, and the atomistic energy is defined by\n$$\nE_{\\mathrm{atom}}(x) = \\frac{k}{2} \\sum_{i \\in \\mathbb{Z}} \\left( x_{i+1} - x_{i} - a \\right)^{2}.\n$$\nAssume a uniform macroscopic strain $ \\epsilon $ so that the displacement field is $u_{i} = \\epsilon X_{i} = \\epsilon i a$. Then the exact atomistic internal force at each atom is zero.\n\nYou wish to couple an atomistic region ($X \\leq 0$) to a continuum region ($X \\geq a$) through a handshaking region consisting of the cross-boundary interaction between atoms $i=0$ and $i=1$. In the continuum region, you model the material using the Cauchy-Born hypothesis derived from the atomistic energy. The continuum energy density per unit reference length is\n$$\nW(F) = \\frac{k a}{2} (F - 1)^{2},\n$$\nwhere $F = \\frac{d x}{d X}$ is the one-dimensional deformation gradient. The first Piola stress (which equals the Cauchy stress in one dimension) is\n$$\n\\sigma(F) = \\frac{d W}{d F} = k a (F - 1) = k a \\epsilon.\n$$\n\nIn a naive force-based coupling, the cross-boundary bond $(0,1)$ is removed from the atomistic force computation, and a continuum traction is applied to atom $i=0$ to represent the interaction with the continuum side. However, due to an incorrect handshaking formulation, the applied continuum traction is scaled by a factor $\\alpha = \\frac{1}{2}$, so that the traction used is $\\alpha \\sigma(F)$ instead of $\\sigma(F)$. The left neighbor bond $( -1, 0 )$ remains atomistic.\n\nUsing first principles, derive the resulting residual (ghost) force at atom $i=0$ under the uniform strain patch test. Then, modify the handshaking formulation by introducing a corrective multiplier $\\gamma$ that rescales the continuum traction in the handshaking region to recover patch-test consistency (i.e., zero ghost force for any uniform strain). Use the specific material parameters $a = 0.25\\,\\mathrm{nm}$ and $k = 100\\,\\mathrm{N/m}$ and assume a small uniform strain $\\epsilon = 0.01$. Express your final answer as the single value of the dimensionless corrective multiplier $\\gamma$. No rounding is required, and no units should be used for the final answer.",
            "solution": "The user wants to solve a problem in atomistic-continuum coupling for a 1D harmonic chain.\n\n### Step 1: Extract Givens\n-   **System**: One-dimensional harmonic atomic chain with nearest-neighbor interactions.\n-   **Reference Positions**: $X_i = i a$ for atoms indexed by $i \\in \\mathbb{Z}$, with lattice spacing $a > 0$.\n-   **Deformed Positions**: $x_i = X_i + u_i$, where $u_i$ is the displacement.\n-   **Atomistic Energy**: $E_{\\mathrm{atom}}(x) = \\frac{k}{2} \\sum_{i \\in \\mathbb{Z}} ( x_{i+1} - x_{i} - a )^{2}$, with spring stiffness $k > 0$.\n-   **Test Condition**: Uniform macroscopic strain $\\epsilon$, leading to displacements $u_i = \\epsilon X_i = \\epsilon i a$.\n-   **Coupling Regions**: Atomistic for $X \\leq 0$ (i.e., $i \\leq 0$), continuum for $X \\geq a$ (i.e., $i \\geq 1$).\n-   **Handshaking**: The interaction across the boundary between atom $i=0$ and atom $i=1$.\n-   **Continuum Model**: Derived from the Cauchy-Born hypothesis.\n-   **Continuum Energy Density**: $W(F) = \\frac{ka}{2} (F-1)^2$, where $F = \\frac{dx}{dX}$ is the deformation gradient.\n-   **Continuum Stress**: $\\sigma(F) = \\frac{dW}{dF} = ka(F-1) = ka\\epsilon$.\n-   **Incorrect Coupling Formulation**:\n    -   The bond $(0,1)$ is removed from the atomistic force sum.\n    -   A traction force is applied to atom $i=0$.\n    -   The magnitude of this applied traction is $\\alpha \\sigma(F)$, with $\\alpha = \\frac{1}{2}$.\n-   **Objective**:\n    1.  Derive the residual (ghost) force at atom $i=0$.\n    2.  Find a corrective multiplier $\\gamma$ that rescales the applied continuum traction to ensure zero ghost force (patch-test consistency).\n-   **Given Parameters**: $a = 0.25\\,\\mathrm{nm}$, $k = 100\\,\\mathrm{N/m}$, $\\epsilon = 0.01$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It describes a standard \"patch test\" analysis, which is a fundamental consistency check for multiscale methods. The 1D harmonic chain is a canonical model system for this purpose. The mathematical definitions of energy, force, Cauchy-Born stress, and the coupling scheme are standard, clear, and consistent. The problem is self-contained and provides all necessary information to derive the dimensionless multiplier $\\gamma$. The numerical parameters provided are physically plausible and, as will be shown, their specific values are not required for the derivation of $\\gamma$, which tests the fundamental understanding of the concept. The problem is valid.\n\n### Step 3: Derivation and Solution\nThe problem requires satisfying the \"patch test,\" a necessary condition for the convergence of a multiscale method. The patch test verifies that for any uniform strain field, the coupled atomistic-continuum model reproduces the exact analytical solution. In this case, the exact solution is that all atoms are in equilibrium, meaning the net force on every atom is zero.\n\nThe net force on an atom $i$ in the full atomistic model is given by $f_i = -\\frac{\\partial E_{\\mathrm{atom}}}{\\partial x_i}$. From the provided energy expression, this becomes:\n$$\nf_i = -\\frac{\\partial}{\\partial x_i} \\left[ \\frac{k}{2}(x_i - x_{i-1} - a)^2 + \\frac{k}{2}(x_{i+1} - x_i - a)^2 \\right] = k(x_{i+1} - 2x_i + x_{i-1})\n$$\nUnder a uniform strain $\\epsilon$, the deformed positions are $x_i = ia(1+\\epsilon)$. Substituting this into the force expression:\n$$\nf_i = k \\left[ (i+1)a(1+\\epsilon) - 2ia(1+\\epsilon) + (i-1)a(1+\\epsilon) \\right] = k a(1+\\epsilon) [ (i+1) - 2i + (i-1) ] = 0\n$$\nThis confirms that in the full atomistic model, the net force on every atom is zero, as stated in the problem.\n\nNow, we analyze the hybrid model. The focus is on atom $i=0$, which sits at the interface. Its left neighbor, atom $i=-1$, is treated atomistically, while its interaction with the right side is replaced by a continuum traction. The net force on atom $i=0$ in the hybrid model, $f_0^{\\mathrm{hyb}}$, is the sum of the force from the left bond $(-1,0)$ and the applied traction force from the right side.\n$$\nf_0^{\\mathrm{hyb}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{traction}}\n$$\nThe force on atom $0$ from atom $-1$ is derived from the potential term involving the bond $(-1,0)$:\n$$\nf_{0 \\leftarrow -1}^{\\mathrm{atom}} = -\\frac{\\partial}{\\partial x_0} \\left[ \\frac{k}{2}(x_0 - x_{-1} - a)^2 \\right] = -k(x_0 - x_{-1} - a)\n$$\nSubstituting the positions under uniform strain, $x_0 = 0$ and $x_{-1} = -a(1+\\epsilon)$, we get:\n$$\nf_{0 \\leftarrow -1}^{\\mathrm{atom}} = -k(0 - [-a(1+\\epsilon)] - a) = -k(a + a\\epsilon - a) = -ka\\epsilon\n$$\nThe problem states that due to an incorrect formulation, the applied traction force is $f^{\\mathrm{traction}} = \\alpha \\sigma(F)$, where $\\alpha = \\frac{1}{2}$ and $\\sigma(F) = ka\\epsilon$.\n$$\nf^{\\mathrm{traction}} = \\frac{1}{2} ka\\epsilon\n$$\nThe resulting net force on atom $0$, which is the residual or \"ghost\" force, is:\n$$\nf_0^{\\mathrm{ghost}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{traction}} = -ka\\epsilon + \\frac{1}{2} ka\\epsilon = -\\frac{1}{2} ka\\epsilon\n$$\nThis is the ghost force under the flawed coupling scheme.\n\nTo restore patch-test consistency, we must modify the scheme so that the net force on atom $0$ is zero. This is achieved by introducing a corrective multiplier $\\gamma$ that rescales the incorrectly formulated traction. The corrected traction is:\n$$\nf^{\\mathrm{corrected}} = \\gamma f^{\\mathrm{traction}} = \\gamma \\left( \\frac{1}{2} ka\\epsilon \\right)\n$$\nThe condition for patch-test consistency is that the new total force on atom $0$ must be zero:\n$$\nf_0^{\\mathrm{new}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{corrected}} = 0\n$$\nSubstituting the expressions for the forces:\n$$\n-ka\\epsilon + \\gamma \\left( \\frac{1}{2} ka\\epsilon \\right) = 0\n$$\nFor the patch test to be valid for any uniform strain $\\epsilon \\neq 0$, and given that $k>0$ and $a>0$, we can divide the entire equation by $ka\\epsilon$:\n$$\n-1 + \\frac{\\gamma}{2} = 0\n$$\nSolving for the dimensionless multiplier $\\gamma$:\n$$\n\\frac{\\gamma}{2} = 1 \\implies \\gamma = 2\n$$\nThe value of $\\gamma$ is independent of the specific material parameters $a$ and $k$, and the strain $\\epsilon$. Therefore, the given numerical values are not needed for the final answer. The corrective multiplier must be $\\gamma=2$ to cancel the initial error factor of $\\alpha=\\frac{1}{2}$ and ensure the applied traction correctly represents the force from the removed atomistic bond.",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "A consistent coupling scheme must accurately transfer information between the atomistic and continuum descriptions. In most schemes, the continuum displacement field is mapped onto the atoms in the handshaking region, but this process inherently introduces a \"representation error\" dependent on the continuum's discretization. This practice involves an analytical derivation of this interpolation error for a sinusoidal displacement wave, providing crucial insight into how the error scales with the continuum mesh size $h$ relative to the deformation wavelength .",
            "id": "3846699",
            "problem": "In a one-dimensional handshaking region used for atomisticâ€“continuum coupling, a continuum displacement field is prescribed by $u_{c}(x) = A \\sin(k x)$, where $A$ is the amplitude and $k$ is the wavenumber. The continuum subdomain is discretized by a uniform mesh with nodal spacing $h$, and atoms in the overlap (handshaking) region are assumed to lie at the midpoints of the continuum elements, i.e., at positions $x_{m} = \\frac{x_{j} + x_{j+1}}{2}$ for each element $\\left[x_{j}, x_{j+1}\\right]$ with $x_{j+1} - x_{j} = h$. The atomistic displacement is assigned by mapping the continuum field to the atomic positions using linear finite element interpolation from the two neighboring continuum nodes, that is, $u_{a}(x_{m}) = N_{1}(x_{m}) u_{c}(x_{j}) + N_{2}(x_{m}) u_{c}(x_{j+1})$ with $N_{1}(x) = 1 - \\frac{x - x_{j}}{h}$ and $N_{2}(x) = \\frac{x - x_{j}}{h}$.\n\nDefine the normalized interpolation error at midpoints by\n$$\nE_{\\mathrm{rel}}(h) = \\sup_{j} \\frac{\\left| u_{c}(x_{m}) - u_{a}(x_{m}) \\right|}{A}.\n$$\nStarting from first principles (the definition of the linear interpolation mapping and the trigonometric form of $u_{c}$), derive a closed-form analytic expression for $E_{\\mathrm{rel}}(h)$ as a function of $k$ and $h$. Then, by asymptotic reasoning from the same base, determine how $E_{\\mathrm{rel}}(h)$ decreases with mesh refinement in the small-mesh limit $k h \\to 0$. Provide the exact closed-form expression for $E_{\\mathrm{rel}}(h)$; no numerical evaluation is required. The answer must be dimensionless, so report the normalized error $E_{\\mathrm{rel}}(h)$ (no units).",
            "solution": "We consider the one-dimensional handshaking region in which atoms at midpoints of continuum elements inherit displacements via linear finite element interpolation. The continuum displacement is $u_{c}(x) = A \\sin(k x)$. On an element $\\left[x_{j}, x_{j+1}\\right]$ with $x_{j+1} - x_{j} = h$, the midpoint is $x_{m} = \\frac{x_{j} + x_{j+1}}{2}$. By the definition of the linear interpolation mapping with shape functions $N_{1}(x) = 1 - \\frac{x - x_{j}}{h}$ and $N_{2}(x) = \\frac{x - x_{j}}{h}$, the mapped atomistic displacement at the midpoint is\n$$\nu_{a}(x_{m}) = \\frac{1}{2} u_{c}(x_{j}) + \\frac{1}{2} u_{c}(x_{j+1}) = \\frac{A}{2} \\left[ \\sin(k x_{j}) + \\sin(k x_{j+1}) \\right].\n$$\nThe exact continuum displacement at the midpoint is\n$$\nu_{c}(x_{m}) = A \\sin\\!\\left( k \\frac{x_{j} + x_{j+1}}{2} \\right) = A \\sin\\!\\left( \\frac{k x_{j} + k x_{j+1}}{2} \\right).\n$$\nIntroduce the phase $\\varphi = k x_{j}$ and the dimensionless element phase increment $s = k h$, so $k x_{j+1} = \\varphi + s$ and $k x_{m} = \\varphi + \\frac{s}{2}$. Then\n$$\nu_{a}(x_{m}) = \\frac{A}{2} \\left[ \\sin(\\varphi) + \\sin(\\varphi + s) \\right], \\quad u_{c}(x_{m}) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right).\n$$\nUsing the trigonometric identity $\\sin(\\alpha) + \\sin(\\beta) = 2 \\sin\\!\\left( \\frac{\\alpha + \\beta}{2} \\right) \\cos\\!\\left( \\frac{\\alpha - \\beta}{2} \\right)$ with $\\alpha = \\varphi$ and $\\beta = \\varphi + s$, we obtain\n$$\n\\frac{1}{2} \\left[ \\sin(\\varphi) + \\sin(\\varphi + s) \\right] = \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\cos\\!\\left( \\frac{s}{2} \\right).\n$$\nTherefore, the interpolation error at the midpoint of element $j$ is\n$$\ne_{j} = u_{c}(x_{m}) - u_{a}(x_{m}) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) - A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\cos\\!\\left( \\frac{s}{2} \\right) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\left[ 1 - \\cos\\!\\left( \\frac{s}{2} \\right) \\right].\n$$\nNormalize by $A$ and take the supremum over all elements $j$ (equivalently, over all phases $\\varphi$), noting that $\\left| \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\right| \\leq 1$ with equality attainable. Thus, the worst-case normalized interpolation error at midpoints across the overlap is\n$$\nE_{\\mathrm{rel}}(h) = \\sup_{j} \\frac{|e_{j}|}{A} = 1 - \\cos\\!\\left( \\frac{k h}{2} \\right).\n$$\nTo determine how mesh refinement reduces this error, consider the small-mesh limit $k h \\to 0$. Using the Taylor expansion $\\cos(z) = 1 - \\frac{z^{2}}{2} + \\frac{z^{4}}{24} - \\cdots$, we obtain\n$$\n1 - \\cos\\!\\left( \\frac{k h}{2} \\right) = \\frac{1}{2} \\left( \\frac{k h}{2} \\right)^{2} - \\frac{1}{24} \\left( \\frac{k h}{2} \\right)^{4} + \\cdots = \\frac{k^{2} h^{2}}{8} - \\frac{k^{4} h^{4}}{384} + \\cdots.\n$$\nTherefore, the leading-order scaling in the handshaking region under mesh refinement is quadratic in $h$: $E_{\\mathrm{rel}}(h) \\sim \\frac{k^{2} h^{2}}{8}$ as $h \\to 0$. The exact closed-form expression is $E_{\\mathrm{rel}}(h) = 1 - \\cos\\!\\left( \\frac{k h}{2} \\right)$, which monotonically decreases to zero with mesh refinement.",
            "answer": "$$\\boxed{1 - \\cos\\!\\left(\\frac{k h}{2}\\right)}$$"
        },
        {
            "introduction": "Enforcing displacement compatibility between the atomistic and continuum models within the handshaking region is a central task in many coupling strategies. This hands-on coding exercise explores two canonical techniques for enforcing such constraints: the penalty method and the Lagrange multiplier method . By implementing and comparing both approaches, you will gain practical understanding of their respective trade-offs in terms of accuracy, implementation complexity, and the mathematical structure of the resulting system of equations.",
            "id": "3846726",
            "problem": "Consider a one-dimensional bridging-domain coupling between two linear discrete models of the same elastic bar: an atomistic spring chain and a continuum chain discretized by the Finite Element Method (FEM). Both models are defined over the same set of nodal positions indexed by integers from $0$ to $N-1$ and share an overlapping handshaking region, defined by a set of node indices $\\mathcal{H} \\subset \\{0,1,\\dots,N-1\\}$ where both atomistic and continuum descriptions coexist and must agree on displacement. The atomistic chain has nodal displacements $\\{u_i\\}_{i=0}^{N-1}$ and uniform nearest-neighbor springs of stiffness $k_{\\mathrm{a}}$. The continuum chain has nodal displacements $\\{v_i\\}_{i=0}^{N-1}$ and uniform nearest-neighbor springs representing a linear Finite Element Method (FEM) discretization with stiffness $k_{\\mathrm{c}}$. The left end of the atomistic chain is held fixed, $u_0 = 0$. The right end of the continuum chain is held fixed, $v_{N-1} = 0$. A localized external nodal force of magnitude $F$ is applied at a single node index $i^\\star \\in \\mathcal{H}$. The external force is split between the two models by a load-share parameter $\\beta \\in [0,1]$, so that the atomistic chain receives $\\beta F$ and the continuum chain receives $(1-\\beta) F$ at the same node index $i^\\star$.\n\nThe fundamental base is the minimum total potential energy principle for linear elastic systems and the equilibrium equations derived from it. For a linear chain with nearest-neighbor springs of stiffness $k$, the internal elastic energy is the sum over all bonds of the quadratic form $\\frac{1}{2}k\\,(u_{i+1}-u_i)^2$, and the equilibrium displacements satisfy linear equations obtained by stationarity of the total potential energy (internal energy minus external work). In the handshaking region $\\mathcal{H}$ the displacement compatibility $u_i = v_i$ must be enforced by one of two methods:\n\n- Lagrange multiplier enforcement: impose $u_i - v_i = 0$ for each $i \\in \\mathcal{H}$ via Karush-Kuhn-Tucker (KKT) conditions with multipliers.\n- Penalty enforcement: add to the energy a positive-definite quadratic penalty $\\frac{1}{2}\\alpha\\sum_{i\\in\\mathcal{H}}(u_i-v_i)^2$ with penalty parameter $\\alpha > 0$.\n\nYou must derive from first principles the discrete equilibrium for both models, formulate the coupled system with handshaking enforcement using each method independently, and compute:\n\n1. The physical elastic energy of the coupled system solution (excluding any penalty contribution), defined as the sum of atomistic internal energy and continuum internal energy.\n2. A displacement-field error quantified as the root-mean-square difference over the $N$ nodes between a composite physical displacement field and a fully atomistic reference solution. Define the composite physical displacement field $w_i$ by\n$w_i = u_i$ for $i < \\min(\\mathcal{H})$, $w_i = \\frac{u_i+v_i}{2}$ for $i \\in \\mathcal{H}$, and $w_i = v_i$ for $i > \\max(\\mathcal{H})$.\nThe reference solution is the equilibrium of a single atomistic chain of length $N$ with the same stiffness $k_{\\mathrm{a}}$, with both ends fixed, $u_0^{\\mathrm{ref}} = 0$ and $u_{N-1}^{\\mathrm{ref}} = 0$, and the same localized force $F$ applied at $i^\\star$. The energy error is the absolute difference between the physical elastic energy in the coupled solution and the elastic energy of the reference solution. The displacement-field error is the root-mean-square norm $\\left(\\sum_{i=0}^{N-1}(w_i - u_i^{\\mathrm{ref}})^2\\right)^{1/2}$.\n\nAll quantities are nondimensional, and answers must be expressed as decimal floats without units. Angles are not used. Your program must implement the derivation in code and produce numerical results for the following test suite of parameter values:\n\n- Test case $1$ (general happy path):\n  $N=8$, $\\mathcal{H}=\\{3,4,5\\}$, $k_{\\mathrm{a}}=1.0$, $k_{\\mathrm{c}}=1.0$, $F=1.0$, $i^\\star=4$, $\\beta=0.5$, $\\alpha=10.0$.\n- Test case $2$ (boundary condition with weak penalty):\n  $N=8$, $\\mathcal{H}=\\{3,4,5\\}$, $k_{\\mathrm{a}}=1.0$, $k_{\\mathrm{c}}=1.0$, $F=1.0$, $i^\\star=4$, $\\beta=0.5$, $\\alpha=10^{-6}$.\n- Test case $3$ (edge case with minimal handshaking and extreme load split):\n  $N=8$, $\\mathcal{H}=\\{1\\}$, $k_{\\mathrm{a}}=1.0$, $k_{\\mathrm{c}}=1.0$, $F=1.0$, $i^\\star=1$, $\\beta=1.0$, $\\alpha=10^{3}$.\n\nFor each test case, compute four floats:\n- Displacement-field error for penalty enforcement.\n- Energy error for penalty enforcement.\n- Displacement-field error for Lagrange multiplier enforcement.\n- Energy error for Lagrange multiplier enforcement.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a sub-list of four floats in the order above. For example, your output must have the form $[[r_{11},r_{12},r_{13},r_{14}],[r_{21},r_{22},r_{23},r_{24}],[r_{31},r_{32},r_{33},r_{34}]]$, with no additional text.",
            "solution": "The user has requested the formulation and solution of a one-dimensional atomistic-continuum coupling problem. The solution is to be computed for two different coupling schemes: a penalty method and a Lagrange multiplier method. For each, we must calculate the displacement error and energy error relative to a full-atomistic reference solution.\n\n### **Problem Validation**\n\n**Step 1: Extract Givens**\n- **Models**: An atomistic chain (displacements $\\{u_i\\}_{i=0}^{N-1}$, stiffness $k_{\\mathrm{a}}$) and a continuum FEM chain (displacements $\\{v_i\\}_{i=0}^{N-1}$, stiffness $k_{\\mathrm{c}}$) on nodes $i=0, \\dots, N-1$.\n- **Boundary Conditions (BCs)**: $u_0 = 0$ (atomistic left end fixed), $v_{N-1} = 0$ (continuum right end fixed).\n- **Handshaking Region**: $\\mathcal{H} \\subset \\{0,1,\\dots,N-1\\}$, where displacements must match, i.e., $u_i = v_i$ for all $i \\in \\mathcal{H}$.\n- **Loading**: External force $F$ at node $i^\\star \\in \\mathcal{H}$, split as $\\beta F$ on the atomistic chain and $(1-\\beta)F$ on the continuum chain.\n- **Coupling Methods**:\n    1.  **Penalty Method**: Add potential energy term $\\frac{1}{2}\\alpha\\sum_{i\\in\\mathcal{H}}(u_i-v_i)^2$ with $\\alpha > 0$.\n    2.  **Lagrange Multiplier Method**: Enforce $u_i - v_i = 0$ for $i \\in \\mathcal{H}$ using Lagrange multipliers $\\lambda_i$.\n- **Reference Solution**: A single atomistic chain with stiffness $k_{\\mathrm{a}}$, nodes $0, \\dots, N-1$, BCs $u_0^{\\mathrm{ref}} = 0, u_{N-1}^{\\mathrm{ref}} = 0$, and a single force $F$ at node $i^\\star$.\n- **Outputs to Calculate**:\n    - **Physical Elastic Energy**: $E = \\frac{1}{2}k_{\\mathrm{a}}\\sum_{i=0}^{N-2}(u_{i+1}-u_i)^2 + \\frac{1}{2}k_{\\mathrm{c}}\\sum_{i=0}^{N-2}(v_{i+1}-v_i)^2$.\n    - **Composite Displacement Field**: $w_i = u_i$ for $i < \\min(\\mathcal{H})$; $w_i = \\frac{u_i+v_i}{2}$ for $i \\in \\mathcal{H}$; $w_i = v_i$ for $i > \\max(\\mathcal{H})$.\n    - **Displacement-Field Error**: $\\left(\\sum_{i=0}^{N-1}(w_i - u_i^{\\mathrm{ref}})^2\\right)^{1/2}$.\n    - **Energy Error**: $|E - E_{\\mathrm{ref}}|$.\n- **Test Cases**: Specific numerical values for $N, \\mathcal{H}, k_{\\mathrm{a}}, k_{\\mathrm{c}}, F, i^\\star, \\beta, \\alpha$ are provided.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is fundamentally sound. It is a standard exercise in computational mechanics and multiscale modeling, employing the principle of minimum potential energy for linear elastic systems. The coupling methods (penalty and Lagrange multipliers) are canonical techniques for enforcing constraints in numerical methods like FEM.\n- **Well-Posedness**: For the penalty method, the total stiffness matrix is symmetric and positive-definite, guaranteeing a unique solution. For the Lagrange multiplier method, the resulting Karush-Kuhn-Tucker (KKT) system is a non-degenerate saddle-point problem, which also has a unique solution under mild and standard conditions (inf-sup or LBB condition), which are met here.\n- **Objectivity**: The problem statement is precise, quantitative, and free of any subjective or ambiguous language.\n- **Completeness**: All necessary parameters and definitions are provided to formulate and solve the problem for the given test cases. While the definition of the composite field $w_i$ could be ambiguous for a non-contiguous handshaking region $\\mathcal{H}$, all provided test cases use contiguous regions, making the definition unambiguous for this specific problem.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. It is scientifically sound, well-posed, and complete. We proceed with the derivation and solution.\n\n### **Derivation of Governing Equations**\n\nThe system's equilibrium state is found by minimizing the total potential energy $\\Pi$, which is the sum of internal elastic energy and the potential of external forces. For a discrete spring system, $\\Pi = \\sum_{\\text{springs}} \\frac{1}{2}k(\\Delta L)^2 - \\sum_{\\text{nodes}} F_j d_j$. The equilibrium equations are found by setting the partial derivatives of $\\Pi$ with respect to each unknown displacement to zero. This results in a system of linear equations, $K\\mathbf{d} = \\mathbf{F}$, where $K$ is the stiffness matrix, $\\mathbf{d}$ is the vector of unknown displacements, and $\\mathbf{F}$ is the vector of nodal forces.\n\n**1. Full Atomistic Reference Solution**\nThe reference system is a single atomistic chain with stiffness $k_{\\mathrm{a}}$. The displacements are $\\{u_i^{\\mathrm{ref}}\\}_{i=0}^{N-1}$.\n- BCs: $u_0^{\\mathrm{ref}} = 0$ and $u_{N-1}^{\\mathrm{ref}} = 0$.\n- Unknowns: $\\mathbf{d}_{\\mathrm{ref}} = (u_1^{\\mathrm{ref}}, \\dots, u_{N-2}^{\\mathrm{ref}})^T$, an $(N-2)$-dimensional vector.\n- Potential Energy: $\\Pi_{\\mathrm{ref}} = \\frac{1}{2} k_{\\mathrm{a}} \\sum_{i=0}^{N-2} (u_{i+1}^{\\mathrm{ref}} - u_i^{\\mathrm{ref}})^2 - F u_{i^\\star}^{\\mathrm{ref}}$.\n- Equilibrium Equations: Differentiating $\\Pi_{\\mathrm{ref}}$ with respect to each $u_j^{\\mathrm{ref}}$ ($j=1, \\dots, N-2$) yields a linear system $K_{\\mathrm{ref}} \\mathbf{d}_{\\mathrm{ref}} = \\mathbf{F}_{\\mathrm{ref}}$.\n- Stiffness Matrix $K_{\\mathrm{ref}}$: An $(N-2) \\times (N-2)$ symmetric tridiagonal matrix with $2k_{\\mathrm{a}}$ on the main diagonal and $-k_{\\mathrm{a}}$ on the first off-diagonals.\n- Force Vector $\\mathbf{F}_{\\mathrm{ref}}$: A vector of zeros, except for the element corresponding to $u_{i^\\star}^{\\mathrm{ref}}$ (at index $i^\\star - 1$), which is $F$.\nAfter solving for $\\mathbf{d}_{\\mathrm{ref}}$, we form the full displacement vector $\\mathbf{u}_{\\mathrm{ref,full}} = (0, u_1^{\\mathrm{ref}}, \\dots, u_{N-2}^{\\mathrm{ref}}, 0)^T$. The reference energy is $E_{\\mathrm{ref}} = \\frac{1}{2} k_{\\mathrm{a}} \\sum_{i=0}^{N-2} (u_{i+1}^{\\mathrm{ref}} - u_i^{\\mathrm{ref}})^2$.\n\n**2. Coupled System Formulation**\nThe coupled system involves two sets of unknowns:\n- Atomistic displacements: $\\mathbf{d}_{\\mathrm{a}} = (u_1, \\dots, u_{N-1})^T$ (size $N-1$, since $u_0=0$).\n- Continuum displacements: $\\mathbf{d}_{\\mathrm{c}} = (v_0, \\dots, v_{N-2})^T$ (size $N-1$, since $v_{N-1}=0$).\nThe total vector of unknowns is $\\mathbf{z} = (\\mathbf{d}_{\\mathrm{a}}^T, \\mathbf{d}_{\\mathrm{c}}^T)^T$, with dimension $2(N-1)$.\nThe uncoupled system is described by a block-diagonal stiffness matrix $K_0 = \\begin{pmatrix} K_{\\mathrm{a}} & 0 \\\\ 0 & K_{\\mathrm{c}} \\end{pmatrix}$ and a force vector $\\mathbf{F}_0$.\n- $K_a$ is the $(N-1) \\times (N-1)$ stiffness matrix for the atomistic chain with $u_0=0$. It is $k_{\\mathrm{a}}$ times a tridiagonal matrix with $2$s on the diagonal and $-1$s on the off-diagonals, except for the last diagonal element, which is $1$.\n- $K_c$ is the $(N-1) \\times (N-1)$ stiffness matrix for the continuum chain with $v_{N-1}=0$. It is $k_{\\mathrm{c}}$ times a tridiagonal matrix with $2$s on the diagonal and $-1$s on the off-diagonals, except for the first diagonal element, which is $1$.\n- $\\mathbf{F}_0$ is a zero vector of size $2(N-1)$, with two non-zero entries: $\\beta F$ at the index for $u_{i^\\star}$ and $(1-\\beta)F$ at the index for $v_{i^\\star}$.\n\n**2a. Penalty Method**\nThe penalty term $\\frac{1}{2}\\alpha\\sum_{i\\in\\mathcal{H}}(u_i-v_i)^2$ is added to the potential energy. This adds a stiffness contribution, $K_{\\mathrm{pen}}$, to the system matrix. For each $i \\in \\mathcal{H}$, the term $\\frac{1}{2}\\alpha(u_i - v_i)^2$ adds $\\alpha$ to the diagonal entries of the matrix corresponding to $u_i$ and $v_i$, and $-\\alpha$ to the off-diagonal entries coupling them.\nThe final system is $(K_0 + K_{\\mathrm{pen}})\\mathbf{z} = \\mathbf{F}_0$.\n\n**2b. Lagrange Multiplier Method**\nWe introduce one Lagrange multiplier $\\lambda_i$ for each constraint $u_i-v_i=0$ where $i \\in \\mathcal{H}$. This leads to a KKT system:\n$$\n\\begin{pmatrix}\nK_0 & C^T \\\\\nC & 0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mathbf{z} \\\\\n\\boldsymbol{\\lambda}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\mathbf{F}_0 \\\\\n\\mathbf{0}\n\\end{pmatrix}\n$$\nHere, $\\boldsymbol{\\lambda}$ is the vector of Lagrange multipliers. $C$ is the constraint matrix, where each row represents a single constraint $u_i - v_i = 0$. For such a row, the entry corresponding to $u_i$ is $1$ and the entry for $v_i$ is $-1$. The total size of the KKT matrix is $(2(N-1) + |\\mathcal{H}|) \\times (2(N-1) + |\\mathcal{H}|)$.\n\n**3. Error Calculation**\nAfter solving for the displacement vector $\\mathbf{z}$ by either method, we reconstruct the full displacement vectors $\\mathbf{u}_{\\mathrm{full}}$ and $\\mathbf{v}_{\\mathrm{full}}$ (both of size $N$) by including the fixed BCs. Then, we calculate the physical elastic energy $E$, construct the composite displacement field $\\mathbf{w}$, and compute the displacement and energy errors relative to the reference solution.",
            "answer": "```python\nimport numpy as np\n\ndef solve_case(N, H, ka, kc, F, i_star, beta, alpha):\n    \"\"\"\n    Solves one test case for the atomistic-continuum coupling problem.\n    \"\"\"\n    # ====== 1. Reference Solution ======\n    n_ref = N - 2\n    if n_ref > 0:\n        K_ref = np.zeros((n_ref, n_ref))\n        for i in range(n_ref):\n            K_ref[i, i] = 2 * ka\n            if i > 0: K_ref[i, i-1] = -ka\n            if i < n_ref - 1: K_ref[i, i+1] = -ka\n        \n        F_ref = np.zeros(n_ref)\n        if 1 <= i_star <= N - 2:\n            F_ref[i_star - 1] = F\n        \n        u_ref_internal = np.linalg.solve(K_ref, F_ref)\n        u_ref_full = np.zeros(N)\n        u_ref_full[1:N-1] = u_ref_internal\n    else: # Trivial case for N<=2\n        u_ref_full = np.zeros(N)\n\n    E_ref = 0.5 * ka * np.sum(np.diff(u_ref_full)**2)\n\n    # ====== 2. Coupled System Setup ======\n    n_vars_per_model = N - 1\n    total_vars = 2 * n_vars_per_model\n\n    # Uncoupled stiffness matrix K0\n    K0 = np.zeros((total_vars, total_vars))\n    \n    # Atomistic part Ka (vars u_1, ..., u_{N-1})\n    if n_vars_per_model > 0:\n        Ka = np.zeros((n_vars_per_model, n_vars_per_model))\n        for i in range(n_vars_per_model):\n            Ka[i, i] = 2 * ka\n            if i > 0: Ka[i, i-1] = -ka\n            if i < n_vars_per_model - 1: Ka[i, i+1] = -ka\n        Ka[n_vars_per_model-1, n_vars_per_model-1] = ka # BC u_0=0\n        K0[:n_vars_per_model, :n_vars_per_model] = Ka\n\n    # Continuum part Kc (vars v_0, ..., v_{N-2})\n    if n_vars_per_model > 0:\n        Kc = np.zeros((n_vars_per_model, n_vars_per_model))\n        for i in range(n_vars_per_model):\n            Kc[i, i] = 2 * kc\n            if i > 0: Kc[i, i-1] = -kc\n            if i < n_vars_per_model - 1: Kc[i, i+1] = -kc\n        Kc[0, 0] = kc # BC v_{N-1}=0\n        K0[n_vars_per_model:, n_vars_per_model:] = Kc\n\n    # Force vector F0\n    F0 = np.zeros(total_vars)\n    if 1 <= i_star < N: # Force on u_{i_star}\n        F0[i_star - 1] = beta * F\n    if 0 <= i_star < N - 1: # Force on v_{i_star}\n        F0[n_vars_per_model + i_star] = (1 - beta) * F\n    \n    # Common function for post-processing\n    min_H, max_H = min(H), max(H)\n    H_set = set(H)\n    def post_process(z):\n        u_full = np.zeros(N)\n        if n_vars_per_model > 0:\n          u_full[1:] = z[:n_vars_per_model]\n\n        v_full = np.zeros(N)\n        if n_vars_per_model > 0:\n          v_full[:-1] = z[n_vars_per_model:]\n        \n        E_physical = 0.5 * ka * np.sum(np.diff(u_full)**2) + 0.5 * kc * np.sum(np.diff(v_full)**2)\n        \n        w = np.zeros(N)\n        for i in range(N):\n            if i < min_H:\n                w[i] = u_full[i]\n            elif i > max_H:\n                w[i] = v_full[i]\n            elif i in H_set:\n                w[i] = 0.5 * (u_full[i] + v_full[i])\n        \n        err_disp = np.sqrt(np.sum((w - u_ref_full)**2))\n        err_en = np.abs(E_physical - E_ref)\n        return err_disp, err_en\n\n    # ====== 3. Penalty Method Solution ======\n    Kp = K0.copy()\n    for i in H_set:\n        is_u_var = 1 <= i < N\n        is_v_var = 0 <= i < N-1\n        if is_u_var and is_v_var:\n            idx_u = i - 1\n            idx_v = n_vars_per_model + i\n            Kp[idx_u, idx_u] += alpha\n            Kp[idx_v, idx_v] += alpha\n            Kp[idx_u, idx_v] -= alpha\n            Kp[idx_v, idx_u] -= alpha\n        elif is_u_var: # v_i is fixed BC\n            idx_u = i - 1\n            Kp[idx_u, idx_u] += alpha\n        elif is_v_var: # u_i is fixed BC\n            idx_v = n_vars_per_model + i\n            Kp[idx_v, idx_v] += alpha\n\n    z_p = np.linalg.solve(Kp, F0)\n    err_disp_p, err_en_p = post_process(z_p)\n    \n    # ====== 4. Lagrange Multiplier Method ======\n    m = len(H)\n    kkt_size = total_vars + m\n    KKT = np.zeros((kkt_size, kkt_size))\n    KKT[:total_vars, :total_vars] = K0\n    \n    RHS_KKT = np.zeros(kkt_size)\n    RHS_KKT[:total_vars] = F0\n    \n    C = np.zeros((m, total_vars))\n    H_list = sorted(list(H))\n    \n    for row_idx, i in enumerate(H_list):\n        is_u_var = 1 <= i < N\n        is_v_var = 0 <= i < N-1\n        if is_u_var:\n            idx_u = i - 1\n            C[row_idx, idx_u] = 1.0\n        if is_v_var:\n            idx_v = n_vars_per_model + i\n            C[row_idx, idx_v] = -1.0\n            \n    KKT[:total_vars, total_vars:] = C.T\n    KKT[total_vars:, :total_vars] = C\n    \n    sol_kkt = np.linalg.solve(KKT, RHS_KKT)\n    z_lm = sol_kkt[:total_vars]\n    err_disp_lm, err_en_lm = post_process(z_lm)\n    \n    return [err_disp_p, err_en_p, err_disp_lm, err_en_lm]\n\n\ndef solve():\n    test_cases = [\n        # (N, H, ka, kc, F, i_star, beta, alpha)\n        (8, {3, 4, 5}, 1.0, 1.0, 1.0, 4, 0.5, 10.0),\n        (8, {3, 4, 5}, 1.0, 1.0, 1.0, 4, 0.5, 1e-6),\n        (8, {1}, 1.0, 1.0, 1.0, 1, 1.0, 1e3),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = solve_case(*case)\n        all_results.append(result)\n\n    # Format output as nested list of floats\n    print(f\"[[{','.join([f'[{\",\".join(map(str, res))}]' for res in all_results])}]\")\n\nsolve()\n```"
        }
    ]
}