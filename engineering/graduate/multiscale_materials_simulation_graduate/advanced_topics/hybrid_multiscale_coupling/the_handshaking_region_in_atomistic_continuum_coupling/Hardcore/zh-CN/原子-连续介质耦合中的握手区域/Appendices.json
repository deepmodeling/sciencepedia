{
    "hands_on_practices": [
        {
            "introduction": "多尺度方法的基石之一是其在最简单变形情况下复现精确物理行为的能力。补丁测试（patch test）正是检验这种基本一致性的“试金石”。本练习  将引导你分析一个存在缺陷的力基耦合方案，推导其在均匀应变下产生的伪力（ghost force），并最终通过修正该方案来恢复其一致性。通过这个过程，你将从第一性原理出发，深刻理解确保原子/连续介质界面力平衡的必要条件。",
            "id": "3846756",
            "problem": "考虑一个一维谐振子原子链，用于模拟具有最近邻相互作用的均匀结晶固体。原子由整数 $i \\in \\mathbb{Z}$ 索引，占据参考位置 $X_{i} = i a$，其中 $a > 0$ 是晶格间距。变形后的位置为 $x_{i} = X_{i} + u_{i}$，其中 $u_{i}$ 是位移。相邻原子对由刚度为 $k > 0$ 的线性弹簧连接，原子能量定义为\n$$\nE_{\\mathrm{atom}}(x) = \\frac{k}{2} \\sum_{i \\in \\mathbb{Z}} \\left( x_{i+1} - x_{i} - a \\right)^{2}.\n$$\n假设存在均匀的宏观应变 $ \\epsilon $，使得位移场为 $u_{i} = \\epsilon X_{i} = \\epsilon i a$。那么，每个原子上精确的原子内部力为零。\n\n您希望通过一个由原子 $i=0$ 和 $i=1$ 之间的跨界相互作用组成的“握手”区域，将原子区域（$X \\leq 0$）与连续介质区域（$X \\geq a$）耦合起来。在连续介质区域，您使用从原子能量推导出的柯西-玻恩(Cauchy-Born)假设来对材料进行建模。单位参考长度上的连续介质能量密度为\n$$\nW(F) = \\frac{k a}{2} (F - 1)^{2},\n$$\n其中 $F = \\frac{d x}{d X}$ 是一维变形梯度。第一皮奥拉(Piola)应力（在一维情况下等于柯西(Cauchy)应力）为\n$$\n\\sigma(F) = \\frac{d W}{d F} = k a (F - 1) = k a \\epsilon.\n$$\n\n在一个基于力的朴素耦合方案中，跨界键 $(0,1)$ 从原子力的计算中移除，并在原子 $i=0$ 上施加一个连续介质牵引力，以表示与连续介质侧的相互作用。然而，由于一个不正确的握手区域公式，所施加的连续介质牵引力被一个因子 $\\alpha = \\frac{1}{2}$ 缩放，因此使用的牵引力是 $\\alpha \\sigma(F)$ 而不是 $\\sigma(F)$。左侧的相邻键 $( -1, 0 )$ 仍然是原子级别的。\n\n使用第一性原理，推导在均匀应变“片检验”(patch test)下原子 $i=0$ 上的残余（鬼）力。然后，通过引入一个修正乘子 $\\gamma$ 来修改握手区域的公式，该乘子重新缩放握手区域中的连续介质牵引力，以恢复片检验的一致性（即，对于任何均匀应变，鬼力为零）。使用具体的材料参数 $a = 0.25\\,\\mathrm{nm}$ 和 $k = 100\\,\\mathrm{N/m}$，并假设一个小的均匀应变 $\\epsilon = 0.01$。将您的最终答案表示为无量纲修正乘子 $\\gamma$ 的单个值。不需要四舍五入，最终答案不应使用单位。",
            "solution": "用户想要解决一个关于一维谐振子链的原子-连续介质耦合问题。\n\n### 第一步：提取已知条件\n-   **系统**：具有最近邻相互作用的一维谐振子原子链。\n-   **参考位置**：$X_i = i a$，对于由 $i \\in \\mathbb{Z}$ 索引的原子，晶格间距为 $a > 0$。\n-   **变形后位置**：$x_i = X_i + u_i$，其中 $u_i$ 是位移。\n-   **原子能量**：$E_{\\mathrm{atom}}(x) = \\frac{k}{2} \\sum_{i \\in \\mathbb{Z}} ( x_{i+1} - x_{i} - a )^{2}$，弹簧刚度为 $k > 0$。\n-   **测试条件**：均匀宏观应变 $\\epsilon$，导致位移 $u_i = \\epsilon X_i = \\epsilon i a$。\n-   **耦合区域**：原子区域为 $X \\leq 0$（即 $i \\leq 0$），连续介质区域为 $X \\geq a$（即 $i \\geq 1$）。\n-   **握手区域**：原子 $i=0$ 和原子 $i=1$ 之间的跨界相互作用。\n-   **连续介质模型**：由柯西-玻恩(Cauchy-Born)假设推导得出。\n-   **连续介质能量密度**：$W(F) = \\frac{ka}{2} (F-1)^2$，其中 $F = \\frac{dx}{dX}$ 是变形梯度。\n-   **连续介质应力**：$\\sigma(F) = \\frac{dW}{dF} = ka(F-1) = ka\\epsilon$。\n-   **不正确的耦合公式**：\n    -   键 $(0,1)$ 从原子力的加和中移除。\n    -   在原子 $i=0$ 上施加一个牵引力。\n    -   此施加的牵引力大小为 $\\alpha \\sigma(F)$，其中 $\\alpha = \\frac{1}{2}$。\n-   **目标**：\n    1.  推导原子 $i=0$ 上的残余（鬼）力。\n    2.  找到一个修正乘子 $\\gamma$，通过重新缩放施加的连续介质牵引力来确保鬼力为零（片检验一致性）。\n-   **给定参数**：$a = 0.25\\,\\mathrm{nm}$，$k = 100\\,\\mathrm{N/m}$，$\\epsilon = 0.01$。\n\n### 第二步：使用提取的已知条件进行验证\n该问题具有科学依据，提法得当，且目标明确。它描述了一个标准的“片检验”（patch test）分析，这是多尺度方法的一个基本一致性检验。一维谐振子链是用于此目的的典型模型系统。能量、力、柯西-玻恩应力以及耦合方案的数学定义是标准的、清晰的且一致的。该问题是自洽的，并提供了推导无量纲乘子 $\\gamma$ 所需的所有信息。所提供的数值参数在物理上是合理的，并且如下文所示，推导 $\\gamma$ 并不需要它们的具体值，这考验了对概念的基本理解。该问题是有效的。\n\n### 第三步：推导与求解\n该问题要求满足“片检验”，这是多尺度方法收敛的必要条件。片检验验证了对于任何均匀应变场，耦合的原子-连续介质模型能够再现精确的解析解。在这种情况下，精确解是所有原子都处于平衡状态，即每个原子上的合力为零。\n\n在全原子模型中，原子 $i$ 上的净力由 $f_i = -\\frac{\\partial E_{\\mathrm{atom}}}{\\partial x_i}$ 给出。从给定的能量表达式，这变为：\n$$\nf_i = -\\frac{\\partial}{\\partial x_i} \\left[ \\frac{k}{2}(x_i - x_{i-1} - a)^2 + \\frac{k}{2}(x_{i+1} - x_i - a)^2 \\right] = k(x_{i+1} - 2x_i + x_{i-1})\n$$\n在均匀应变 $\\epsilon$ 下，变形后的位置为 $x_i = ia(1+\\epsilon)$。将此代入力的表达式：\n$$\nf_i = k \\left[ (i+1)a(1+\\epsilon) - 2ia(1+\\epsilon) + (i-1)a(1+\\epsilon) \\right] = k a(1+\\epsilon) [ (i+1) - 2i + (i-1) ] = 0\n$$\n这证实了在全原子模型中，每个原子上的净力为零，与问题陈述一致。\n\n现在，我们分析混合模型。重点是位于界面上的原子 $i=0$。其左侧相邻的原子 $i=-1$ 按原子方式处理，而其与右侧的相互作用则被连续介质牵引力所取代。在混合模型中，原子 $i=0$ 上的净力 $f_0^{\\mathrm{hyb}}$ 是来自左侧键 $(-1,0)$ 的力与来自右侧施加的牵引力之和。\n$$\nf_0^{\\mathrm{hyb}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{traction}}\n$$\n原子 $-1$ 对原子 $0$ 的力由涉及键 $(-1,0)$ 的势能项导出：\n$$\nf_{0 \\leftarrow -1}^{\\mathrm{atom}} = -\\frac{\\partial}{\\partial x_0} \\left[ \\frac{k}{2}(x_0 - x_{-1} - a)^2 \\right] = -k(x_0 - x_{-1} - a)\n$$\n代入均匀应变下的位置 $x_0 = 0$ 和 $x_{-1} = -a(1+\\epsilon)$，我们得到：\n$$\nf_{0 \\leftarrow -1}^{\\mathrm{atom}} = -k(0 - [-a(1+\\epsilon)] - a) = -k(a + a\\epsilon - a) = -ka\\epsilon\n$$\n问题陈述，由于一个不正确的公式，施加的牵引力为 $f^{\\mathrm{traction}} = \\alpha \\sigma(F)$，其中 $\\alpha = \\frac{1}{2}$ 且 $\\sigma(F) = ka\\epsilon$。\n$$\nf^{\\mathrm{traction}} = \\frac{1}{2} ka\\epsilon\n$$\n作用在原子 $0$ 上的合力，即残余力或“鬼”力，为：\n$$\nf_0^{\\mathrm{ghost}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{traction}} = -ka\\epsilon + \\frac{1}{2} ka\\epsilon = -\\frac{1}{2} ka\\epsilon\n$$\n这就是有缺陷的耦合方案下的鬼力。\n\n为了恢复片检验的一致性，我们必须修改方案，使原子 $0$ 上的净力为零。这通过引入一个修正乘子 $\\gamma$ 来实现，该乘子重新缩放了不正确公式化的牵引力。修正后的牵引力为：\n$$\nf^{\\mathrm{corrected}} = \\gamma f^{\\mathrm{traction}} = \\gamma \\left( \\frac{1}{2} ka\\epsilon \\right)\n$$\n片检验一致性的条件是，原子 $0$ 上的新总力必须为零：\n$$\nf_0^{\\mathrm{new}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{corrected}} = 0\n$$\n代入力的表达式：\n$$\n-ka\\epsilon + \\gamma \\left( \\frac{1}{2} ka\\epsilon \\right) = 0\n$$\n为了使片检验对任何均匀应变 $\\epsilon \\neq 0$ 都有效，并且考虑到 $k>0$ 和 $a>0$，我们可以将整个方程除以 $ka\\epsilon$：\n$$\n-1 + \\frac{\\gamma}{2} = 0\n$$\n求解无量纲乘子 $\\gamma$：\n$$\n\\frac{\\gamma}{2} = 1 \\implies \\gamma = 2\n$$\n$\\gamma$ 的值与具体的材料参数 $a$ 和 $k$ 以及应变 $\\epsilon$ 无关。因此，最终答案不需要给定的数值。修正乘子必须为 $\\gamma=2$，以抵消初始的误差因子 $\\alpha=\\frac{1}{2}$，并确保施加的牵引力正确地代表了被移除的原子键所产生的力。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "在原子-连续介质耦合中，信息在不同尺度模型间的传递是误差的主要来源之一。将平滑的连续介质场映射到离散的原子位置上，不可避免地会引入插值误差，特别是当变形场包含高频（短波长）分量时。本练习  要求你通过解析推导，量化一个正弦位移场在线性插值下产生的误差。这能帮助你建立起耦合误差与物理参数（如变形波长）和数值参数（如连续介质网格尺寸 $h$）之间的直接联系。",
            "id": "3846699",
            "problem": "在一个用于原子-连续介质耦合的一维握手区中，一个连续介质位移场由 $u_{c}(x) = A \\sin(k x)$ 给出，其中 $A$ 是振幅，$k$ 是波数。该连续介质子域通过节点间距为 $h$ 的均匀网格进行离散化，并且假定重叠（握手）区域中的原子位于连续介质单元的中点，即对于每个满足 $x_{j+1} - x_{j} = h$ 的单元 $\\left[x_{j}, x_{j+1}\\right]$，原子位置在 $x_{m} = \\frac{x_{j} + x_{j+1}}{2}$。原子位移是通过使用来自两个相邻连续介质节点的线性有限元插值，将连续介质场映射到原子位置来指定的，即 $u_{a}(x_{m}) = N_{1}(x_{m}) u_{c}(x_{j}) + N_{2}(x_{m}) u_{c}(x_{j+1})$，其中 $N_{1}(x) = 1 - \\frac{x - x_{j}}{h}$ 和 $N_{2}(x) = \\frac{x - x_{j}}{h}$。\n\n将中点处的归一化插值误差定义为\n$$\nE_{\\mathrm{rel}}(h) = \\sup_{j} \\frac{\\left| u_{c}(x_{m}) - u_{a}(x_{m}) \\right|}{A}.\n$$\n从第一性原理（线性插值映射的定义和 $u_{c}$ 的三角函数形式）出发，推导 $E_{\\mathrm{rel}}(h)$ 作为 $k$ 和 $h$ 的函数的闭式解析表达式。然后，基于同样的基础进行渐近推理，确定在小网格极限 $k h \\to 0$ 下，$E_{\\mathrm{rel}}(h)$ 如何随着网格细化而减小。给出 $E_{\\mathrm{rel}}(h)$ 的精确闭式表达式；不需要进行数值计算。答案必须是无量纲的，因此请报告归一化误差 $E_{\\mathrm{rel}}(h)$（无单位）。",
            "solution": "我们考虑一个一维握手区，其中位于连续介质单元中点的原子通过线性有限元插值继承位移。连续介质位移为 $u_{c}(x) = A \\sin(k x)$。在一个满足 $x_{j+1} - x_{j} = h$ 的单元 $\\left[x_{j}, x_{j+1}\\right]$ 上，中点为 $x_{m} = \\frac{x_{j} + x_{j+1}}{2}$。根据带有形函数 $N_{1}(x) = 1 - \\frac{x - x_{j}}{h}$ 和 $N_{2}(x) = \\frac{x - x_{j}}{h}$ 的线性插值映射的定义，中点处的映射原子位移为\n$$\nu_{a}(x_{m}) = \\frac{1}{2} u_{c}(x_{j}) + \\frac{1}{2} u_{c}(x_{j+1}) = \\frac{A}{2} \\left[ \\sin(k x_{j}) + \\sin(k x_{j+1}) \\right].\n$$\n中点处的精确连续介质位移为\n$$\nu_{c}(x_{m}) = A \\sin\\!\\left( k \\frac{x_{j} + x_{j+1}}{2} \\right) = A \\sin\\!\\left( \\frac{k x_{j} + k x_{j+1}}{2} \\right).\n$$\n引入相位 $\\varphi = k x_{j}$ 和无量纲单元相位增量 $s = k h$，因此 $k x_{j+1} = \\varphi + s$ 且 $k x_{m} = \\varphi + \\frac{s}{2}$。则\n$$\nu_{a}(x_{m}) = \\frac{A}{2} \\left[ \\sin(\\varphi) + \\sin(\\varphi + s) \\right], \\quad u_{c}(x_{m}) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right).\n$$\n使用三角恒等式 $\\sin(\\alpha) + \\sin(\\beta) = 2 \\sin\\!\\left( \\frac{\\alpha + \\beta}{2} \\right) \\cos\\!\\left( \\frac{\\alpha - \\beta}{2} \\right)$，并令 $\\alpha = \\varphi$ 和 $\\beta = \\varphi + s$，我们得到\n$$\n\\frac{1}{2} \\left[ \\sin(\\varphi) + \\sin(\\varphi + s) \\right] = \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\cos\\!\\left( \\frac{s}{2} \\right).\n$$\n因此，在单元 $j$ 中点处的插值误差为\n$$\ne_{j} = u_{c}(x_{m}) - u_{a}(x_{m}) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) - A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\cos\\!\\left( \\frac{s}{2} \\right) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\left[ 1 - \\cos\\!\\left( \\frac{s}{2} \\right) \\right].\n$$\n用 $A$ 进行归一化，并对所有单元 $j$（等价地，对所有相位 $\\varphi$）取上确界，注意到 $\\left| \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\right| \\leq 1$ 且等号可以取到。因此，在整个重叠区域的中点处，最坏情况下的归一化插值误差为\n$$\nE_{\\mathrm{rel}}(h) = \\sup_{j} \\frac{|e_{j}|}{A} = 1 - \\cos\\!\\left( \\frac{k h}{2} \\right).\n$$\n为了确定网格细化如何减小此误差，我们考虑小网格极限 $k h \\to 0$。使用泰勒展开式 $\\cos(z) = 1 - \\frac{z^{2}}{2} + \\frac{z^{4}}{24} - \\cdots$，我们得到\n$$\n1 - \\cos\\!\\left( \\frac{k h}{2} \\right) = \\frac{1}{2} \\left( \\frac{k h}{2} \\right)^{2} - \\frac{1}{24} \\left( \\frac{k h}{2} \\right)^{4} + \\cdots = \\frac{k^{2} h^{2}}{8} - \\frac{k^{4} h^{4}}{384} + \\cdots.\n$$\n因此，在网格细化下，握手区中的主阶标度关系是 $h$ 的二次方：当 $h \\to 0$ 时，$E_{\\mathrm{rel}}(h) \\sim \\frac{k^{2} h^{2}}{8}$。精确的闭式表达式为 $E_{\\mathrm{rel}}(h) = 1 - \\cos\\!\\left( \\frac{k h}{2} \\right)$，该值随着网格细化单调递减至零。",
            "answer": "$$\\boxed{1 - \\cos\\!\\left(\\frac{k h}{2}\\right)}$$"
        },
        {
            "introduction": "在握手区中强制实现运动学兼容性（即位移匹配）是耦合方法中的一个核心技术挑战。两种主流策略分别是罚函数法和拉格朗日乘子法，前者通过一个“软”的能量惩罚项来约束位移失配，而后者则施加一个“硬”的代数约束。本编程练习  将让你亲手实现并比较这两种基本的约束施行技术。通过用两种方法解决同一个物理问题，你将对它们的数学构造、数值特性以及在精度和实现复杂性之间的权衡获得宝贵的实践经验。",
            "id": "3846726",
            "problem": "考虑同一弹性杆的两个线性离散模型之间的一维跨域耦合：一个原子弹簧链和一个通过有限元法 (FEM) 离散化的连续介质链。两个模型都定义在从 $0$ 到 $N-1$ 整数索引的同一组节点位置上，并共享一个重叠的握手区域，该区域由一组节点索引 $\\mathcal{H} \\subset \\{0,1,\\dots,N-1\\}$ 定义，在此区域内，原子和连续介质描述共存且位移必须一致。原子链的节点位移为 $\\{u_i\\}_{i=0}^{N-1}$，并具有刚度为 $k_{\\mathrm{a}}$ 的均匀最近邻弹簧。连续介质链的节点位移为 $\\{v_i\\}_{i=0}^{N-1}$，并具有均匀的最近邻弹簧，代表刚度为 $k_{\\mathrm{c}}$ 的线性有限元法 (FEM) 离散化。原子链的左端固定，$u_0 = 0$。连续介质链的右端固定，$v_{N-1} = 0$。在单个节点索引 $i^\\star \\in \\mathcal{H}$ 处施加一个大小为 $F$ 的局部外部节点力。该外力通过一个载荷分配参数 $\\beta \\in [0,1]$ 在两个模型之间分配，因此原子链在同一节点索引 $i^\\star$ 处承受 $\\beta F$ 的力，连续介质链承受 $(1-\\beta) F$ 的力。\n\n基本原理是线性弹性系统的最小总势能原理及其推导出的平衡方程。对于具有刚度为 $k$ 的最近邻弹簧的线性链，其内部弹性势能是所有键上二次型 $\\frac{1}{2}k\\,(u_{i+1}-u_i)^2$ 的总和，平衡位移满足通过总势能（内部能量减去外力功）的驻值条件获得的线性方程。在握手区域 $\\mathcal{H}$ 中，位移协调性 $u_i = v_i$ 必须通过以下两种方法之一来强制执行：\n\n- 拉格朗日乘子法：通过带有乘子的 Karush-Kuhn-Tucker (KKT) 条件，对每个 $i \\in \\mathcal{H}$ 施加 $u_i - v_i = 0$。\n- 罚函数法：向能量中添加一个正定二次罚函数项 $\\frac{1}{2}\\alpha\\sum_{i\\in\\mathcal{H}}(u_i-v_i)^2$，其中罚参数 $\\alpha > 0$。\n\n您必须从第一性原理推导两个模型的离散平衡方程，使用每种方法独立地建立带握手约束的耦合系统，并计算：\n\n1. 耦合系统解的物理弹性势能（不包括任何罚函数项的贡献），定义为原子内部能量和连续介质内部能量之和。\n2. 位移场误差，量化为复合物理位移场与全原子参考解之间在 $N$ 个节点上的均方根差。将复合物理位移场 $w_i$ 定义为：\n对于 $i  \\min(\\mathcal{H})$，$w_i = u_i$；对于 $i \\in \\mathcal{H}$，$w_i = \\frac{u_i+v_i}{2}$；对于 $i > \\max(\\mathcal{H})$，$w_i = v_i$。\n参考解是长度为 $N$、刚度为 $k_{\\mathrm{a}}$ 的单个原子链的平衡状态，两端固定，$u_0^{\\mathrm{ref}} = 0$ 和 $u_{N-1}^{\\mathrm{ref}} = 0$，并在 $i^\\star$ 处施加相同的局部力 $F$。能量误差是耦合解中的物理弹性势能与参考解的弹性势能之间的绝对差。位移场误差是均方根范数 $\\left(\\sum_{i=0}^{N-1}(w_i - u_i^{\\mathrm{ref}})^2\\right)^{1/2}$。\n\n所有量均为无量纲量，答案必须表示为不带单位的十进制浮点数。不使用角度。您的程序必须用代码实现推导过程，并为以下参数值测试套件生成数值结果：\n\n- 测试用例 1（一般正常路径）：\n  $N=8$, $\\mathcal{H}=\\{3,4,5\\}$, $k_{\\mathrm{a}}=1.0$, $k_{\\mathrm{c}}=1.0$, $F=1.0$, $i^\\star=4$, $\\beta=0.5$, $\\alpha=10.0$。\n- 测试用例 2（弱罚函数的边界条件）：\n  $N=8$, $\\mathcal{H}=\\{3,4,5\\}$, $k_{\\mathrm{a}}=1.0$, $k_{\\mathrm{c}}=1.0$, $F=1.0$, $i^\\star=4$, $\\beta=0.5$, $\\alpha=10^{-6}$。\n- 测试用例 3（最小握手区域和极端载荷分配的边界情况）：\n  $N=8$, $\\mathcal{H}=\\{1\\}$, $k_{\\mathrm{a}}=1.0$, $k_{\\mathrm{c}}=1.0$, $F=1.0$, $i^\\star=1$, $\\beta=1.0$, $\\alpha=10^{3}$。\n\n对于每个测试用例，计算四个浮点数：\n- 罚函数法的位移场误差。\n- 罚函数法的能量误差。\n- 拉格朗日乘子法的位移场误差。\n- 拉格朗日乘子法的能量误差。\n\n您的程序应生成单行输出，其中包含一个以逗号分隔的列表，列表括在方括号中，每个测试用例对应一个包含上述顺序的四个浮点数的子列表。例如，您的输出必须具有以下形式：$[[r_{11},r_{12},r_{13},r_{14}],[r_{21},r_{22},r_{23},r_{24}],[r_{31},r_{32},r_{33},r_{34}]]$，不得包含任何额外文本。",
            "solution": "用户要求建立并求解一个一维原子-连续介质耦合问题。该问题的解需要针对两种不同的耦合方案进行计算：罚函数法和拉格朗日乘子法。对于每种方法，我们都必须计算相对于全原子参考解的位移误差和能量误差。\n\n### **问题验证**\n\n**第一步：提取已知条件**\n- **模型**：一个原子链（位移 $\\{u_i\\}_{i=0}^{N-1}$，刚度 $k_{\\mathrm{a}}$）和一个连续介质有限元链（位移 $\\{v_i\\}_{i=0}^{N-1}$，刚度 $k_{\\mathrm{c}}$），均定义在节点 $i=0, \\dots, N-1$ 上。\n- **边界条件 (BCs)**：$u_0 = 0$（原子链左端固定），$v_{N-1} = 0$（连续介质链右端固定）。\n- **握手区域**：$\\mathcal{H} \\subset \\{0,1,\\dots,N-1\\}$，在此区域内位移必须匹配，即对所有 $i \\in \\mathcal{H}$，有 $u_i = v_i$。\n- **载荷**：在节点 $i^\\star \\in \\mathcal{H}$ 处施加外力 $F$，其中 $\\beta F$ 作用于原子链，$(1-\\beta)F$ 作用于连续介质链。\n- **耦合方法**：\n    1.  **罚函数法**：添加势能项 $\\frac{1}{2}\\alpha\\sum_{i\\in\\mathcal{H}}(u_i-v_i)^2$，其中 $\\alpha > 0$。\n    2.  **拉格朗日乘子法**：使用拉格朗日乘子 $\\lambda_i$ 强制执行 $u_i - v_i = 0$（对于 $i \\in \\mathcal{H}$）。\n- **参考解**：一个刚度为 $k_{\\mathrm{a}}$ 的单一原子链，节点为 $0, \\dots, N-1$，边界条件为 $u_0^{\\mathrm{ref}} = 0, u_{N-1}^{\\mathrm{ref}} = 0$，并在节点 $i^\\star$ 处施加单一力 $F$。\n- **待计算的输出**：\n    - **物理弹性势能**：$E = \\frac{1}{2}k_{\\mathrm{a}}\\sum_{i=0}^{N-2}(u_{i+1}-u_i)^2 + \\frac{1}{2}k_{\\mathrm{c}}\\sum_{i=0}^{N-2}(v_{i+1}-v_i)^2$。\n    - **复合位移场**：对于 $i  \\min(\\mathcal{H})$，$w_i = u_i$；对于 $i \\in \\mathcal{H}$，$w_i = \\frac{u_i+v_i}{2}$；对于 $i > \\max(\\mathcal{H})$，$w_i = v_i$。\n    - **位移场误差**：$\\left(\\sum_{i=0}^{N-1}(w_i - u_i^{\\mathrm{ref}})^2\\right)^{1/2}$。\n    - **能量误差**：$|E - E_{\\mathrm{ref}}|$。\n- **测试用例**：提供了 $N, \\mathcal{H}, k_{\\mathrm{a}}, k_{\\mathrm{c}}, F, i^\\star, \\beta, \\alpha$ 的具体数值。\n\n**第二步：使用提取的已知条件进行验证**\n- **科学依据**：该问题基本上是合理的。这是计算力学和多尺度建模中的一个标准练习，采用了线性弹性系统的最小总势能原理。耦合方法（罚函数法和拉格朗日乘子法）是像有限元法这类数值方法中用于强制施加约束的规范技术。\n- **适定性**：对于罚函数法，总刚度矩阵是对称正定的，保证了唯一解的存在。对于拉格朗日乘子法，得到的 Karush-Kuhn-Tucker (KKT) 系统是一个非退化鞍点问题，在温和且标准的条件（inf-sup 或 LBB 条件）下也具有唯一解，这些条件在此处均得到满足。\n- **客观性**：问题陈述精确、定量，没有任何主观或模糊的语言。\n- **完整性**：为给定测试用例建立公式并求解问题所需的所有必要参数和定义都已提供。虽然对于一个非连续的握手区域 $\\mathcal{H}$，复合场 $w_i$ 的定义可能会有歧义，但所有提供的测试用例都使用连续区域，这使得该定义对于此特定问题是明确的。\n\n**第三步：结论与行动**\n问题被判定为**有效**。它在科学上是合理的、适定的和完整的。我们继续进行推导和求解。\n\n### **控制方程的推导**\n\n系统的平衡状态是通过最小化总势能 $\\Pi$ 来找到的，$\\Pi$ 是内部弹性势能和外力势能之和。对于离散弹簧系统，$\\Pi = \\sum_{\\text{springs}} \\frac{1}{2}k(\\Delta L)^2 - \\sum_{\\text{nodes}} F_j d_j$。平衡方程通过将 $\\Pi$ 对每个未知位移的偏导数设为零来求得。这会得到一个线性方程组 $K\\mathbf{d} = \\mathbf{F}$，其中 $K$ 是刚度矩阵，$\\mathbf{d}$ 是未知位移向量，$\\mathbf{F}$ 是节点力向量。\n\n**1. 全原子参考解**\n参考系统是刚度为 $k_{\\mathrm{a}}$ 的单一原子链。位移为 $\\{u_i^{\\mathrm{ref}}\\}_{i=0}^{N-1}$。\n- 边界条件：$u_0^{\\mathrm{ref}} = 0$ 和 $u_{N-1}^{\\mathrm{ref}} = 0$。\n- 未知量：$\\mathbf{d}_{\\mathrm{ref}} = (u_1^{\\mathrm{ref}}, \\dots, u_{N-2}^{\\mathrm{ref}})^T$，一个 $(N-2)$ 维向量。\n- 势能：$\\Pi_{\\mathrm{ref}} = \\frac{1}{2} k_{\\mathrm{a}} \\sum_{i=0}^{N-2} (u_{i+1}^{\\mathrm{ref}} - u_i^{\\mathrm{ref}})^2 - F u_{i^\\star}^{\\mathrm{ref}}$。\n- 平衡方程：将 $\\Pi_{\\mathrm{ref}}$ 对每个 $u_j^{\\mathrm{ref}}$（$j=1, \\dots, N-2$）求导，得到线性系统 $K_{\\mathrm{ref}} \\mathbf{d}_{\\mathrm{ref}} = \\mathbf{F}_{\\mathrm{ref}}$。\n- 刚度矩阵 $K_{\\mathrm{ref}}$：一个 $(N-2) \\times (N-2)$ 的对称三对角矩阵，主对角线上为 $2k_{\\mathrm{a}}$，次对角线上为 $-k_{\\mathrm{a}}$。\n- 力向量 $\\mathbf{F}_{\\mathrm{ref}}$：一个零向量，除了对应于 $u_{i^\\star}^{\\mathrm{ref}}$（在索引 $i^\\star - 1$ 处）的元素为 $F$。\n求解出 $\\mathbf{d}_{\\mathrm{ref}}$ 后，我们构建完整的位移向量 $\\mathbf{u}_{\\mathrm{ref,full}} = (0, u_1^{\\mathrm{ref}}, \\dots, u_{N-2}^{\\mathrm{ref}}, 0)^T$。参考能量为 $E_{\\mathrm{ref}} = \\frac{1}{2} k_{\\mathrm{a}} \\sum_{i=0}^{N-2} (u_{i+1}^{\\mathrm{ref}} - u_i^{\\mathrm{ref}})^2$。\n\n**2. 耦合系统公式**\n耦合系统涉及两组未知量：\n- 原子位移：$\\mathbf{d}_{\\mathrm{a}} = (u_1, \\dots, u_{N-1})^T$（大小为 $N-1$，因为 $u_0=0$）。\n- 连续介质位移：$\\mathbf{d}_{\\mathrm{c}} = (v_0, \\dots, v_{N-2})^T$（大小为 $N-1$，因为 $v_{N-1}=0$）。\n总未知量向量为 $\\mathbf{z} = (\\mathbf{d}_{\\mathrm{a}}^T, \\mathbf{d}_{\\mathrm{c}}^T)^T$，维度为 $2(N-1)$。\n未耦合系统由一个块对角刚度矩阵 $K_0 = \\begin{pmatrix} K_{\\mathrm{a}} & 0 \\\\ 0 & K_{\\mathrm{c}} \\end{pmatrix}$ 和一个力向量 $\\mathbf{F}_0$ 描述。\n- $K_a$ 是原子链在 $u_0=0$ 条件下的 $(N-1) \\times (N-1)$ 刚度矩阵。它是 $k_{\\mathrm{a}}$ 乘以一个三对角矩阵，该矩阵对角线上为 $2$，次对角线上为 $-1$，但最后一个对角元素为 $1$。\n- $K_c$ 是连续介质链在 $v_{N-1}=0$ 条件下的 $(N-1) \\times (N-1)$ 刚度矩阵。它是 $k_{\\mathrm{c}}$ 乘以一个三对角矩阵，该矩阵对角线上为 $2$，次对角线上为 $-1$，但第一个对角元素为 $1$。\n- $\\mathbf{F}_0$ 是一个大小为 $2(N-1)$ 的零向量，有两个非零项：在 $u_{i^\\star}$ 索引处为 $\\beta F$，在 $v_{i^\\star}$ 索引处为 $(1-\\beta)F$。\n\n**2a. 罚函数法**\n罚函数项 $\\frac{1}{2}\\alpha\\sum_{i\\in\\mathcal{H}}(u_i-v_i)^2$ 被添加到势能中。这会向系统矩阵中添加一个刚度贡献 $K_{\\mathrm{pen}}$。对于每个 $i \\in \\mathcal{H}$，项 $\\frac{1}{2}\\alpha(u_i - v_i)^2$ 会向矩阵中对应于 $u_i$ 和 $v_i$ 的对角元素加上 $\\alpha$，并向耦合它们的非对角元素减去 $\\alpha$。\n最终的系统是 $(K_0 + K_{\\mathrm{pen}})\\mathbf{z} = \\mathbf{F}_0$。\n\n**2b. 拉格朗日乘子法**\n我们为每个约束 $u_i-v_i=0$（其中 $i \\in \\mathcal{H}$）引入一个拉格朗日乘子 $\\lambda_i$。这导出一个 KKT 系统：\n$$\n\\begin{pmatrix}\nK_0 & C^T \\\\\nC & 0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mathbf{z} \\\\\n\\boldsymbol{\\lambda}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\mathbf{F}_0 \\\\\n\\mathbf{0}\n\\end{pmatrix}\n$$\n这里，$\\boldsymbol{\\lambda}$ 是拉格朗日乘子向量。$C$ 是约束矩阵，其中每一行代表一个单一约束 $u_i - v_i = 0$。对于这样的一行，对应于 $u_i$ 的条目是 $1$，对应于 $v_i$ 的条目是 $-1$。KKT 矩阵的总大小为 $(2(N-1) + |\\mathcal{H}|) \\times (2(N-1) + |\\mathcal{H}|)$。\n\n**3. 误差计算**\n通过任一方法求解位移向量 $\\mathbf{z}$ 后，我们通过包含固定的边界条件来重建完整的位移向量 $\\mathbf{u}_{\\mathrm{full}}$ 和 $\\mathbf{v}_{\\mathrm{full}}$（大小均为 $N$）。然后，我们计算物理弹性势能 $E$，构建复合位移场 $\\mathbf{w}$，并计算相对于参考解的位移和能量误差。",
            "answer": "```python\nimport numpy as np\n\ndef solve_case(N, H, ka, kc, F, i_star, beta, alpha):\n    \"\"\"\n    Solves one test case for the atomistic-continuum coupling problem.\n    \"\"\"\n    # ====== 1. Reference Solution ======\n    n_ref = N - 2\n    if n_ref > 0:\n        K_ref = np.zeros((n_ref, n_ref))\n        for i in range(n_ref):\n            K_ref[i, i] = 2 * ka\n            if i > 0: K_ref[i, i-1] = -ka\n            if i  n_ref - 1: K_ref[i, i+1] = -ka\n        \n        F_ref = np.zeros(n_ref)\n        if 1 = i_star = N - 2:\n            F_ref[i_star - 1] = F\n        \n        u_ref_internal = np.linalg.solve(K_ref, F_ref)\n        u_ref_full = np.zeros(N)\n        u_ref_full[1:N-1] = u_ref_internal\n    else: # Trivial case for N=2\n        u_ref_full = np.zeros(N)\n\n    E_ref = 0.5 * ka * np.sum(np.diff(u_ref_full)**2)\n\n    # ====== 2. Coupled System Setup ======\n    n_vars_per_model = N - 1\n    total_vars = 2 * n_vars_per_model\n\n    # Uncoupled stiffness matrix K0\n    K0 = np.zeros((total_vars, total_vars))\n    \n    # Atomistic part Ka (vars u_1, ..., u_{N-1})\n    if n_vars_per_model > 0:\n        Ka = np.zeros((n_vars_per_model, n_vars_per_model))\n        for i in range(n_vars_per_model):\n            Ka[i, i] = 2 * ka\n            if i > 0: Ka[i, i-1] = -ka\n            if i  n_vars_per_model - 1: Ka[i, i+1] = -ka\n        Ka[n_vars_per_model-1, n_vars_per_model-1] = ka # BC u_0=0\n        K0[:n_vars_per_model, :n_vars_per_model] = Ka\n\n    # Continuum part Kc (vars v_0, ..., v_{N-2})\n    if n_vars_per_model > 0:\n        Kc = np.zeros((n_vars_per_model, n_vars_per_model))\n        for i in range(n_vars_per_model):\n            Kc[i, i] = 2 * kc\n            if i > 0: Kc[i, i-1] = -kc\n            if i  n_vars_per_model - 1: Kc[i, i+1] = -kc\n        Kc[0, 0] = kc # BC v_{N-1}=0\n        K0[n_vars_per_model:, n_vars_per_model:] = Kc\n\n    # Force vector F0\n    F0 = np.zeros(total_vars)\n    if 1 = i_star  N: # Force on u_{i_star}\n        F0[i_star - 1] = beta * F\n    if 0 = i_star  N - 1: # Force on v_{i_star}\n        F0[n_vars_per_model + i_star] = (1 - beta) * F\n    \n    # Common function for post-processing\n    min_H, max_H = min(H), max(H)\n    H_set = set(H)\n    def post_process(z):\n        u_full = np.zeros(N)\n        if n_vars_per_model > 0:\n          u_full[1:] = z[:n_vars_per_model]\n\n        v_full = np.zeros(N)\n        if n_vars_per_model > 0:\n          v_full[:-1] = z[n_vars_per_model:]\n        \n        E_physical = 0.5 * ka * np.sum(np.diff(u_full)**2) + 0.5 * kc * np.sum(np.diff(v_full)**2)\n        \n        w = np.zeros(N)\n        for i in range(N):\n            if i  min_H:\n                w[i] = u_full[i]\n            elif i > max_H:\n                w[i] = v_full[i]\n            elif i in H_set:\n                w[i] = 0.5 * (u_full[i] + v_full[i])\n        \n        err_disp = np.sqrt(np.sum((w - u_ref_full)**2))\n        err_en = np.abs(E_physical - E_ref)\n        return err_disp, err_en\n\n    # ====== 3. Penalty Method Solution ======\n    Kp = K0.copy()\n    for i in H_set:\n        is_u_var = 1 = i  N\n        is_v_var = 0 = i  N-1\n        if is_u_var and is_v_var:\n            idx_u = i - 1\n            idx_v = n_vars_per_model + i\n            Kp[idx_u, idx_u] += alpha\n            Kp[idx_v, idx_v] += alpha\n            Kp[idx_u, idx_v] -= alpha\n            Kp[idx_v, idx_u] -= alpha\n        elif is_u_var: # v_i is fixed BC\n            idx_u = i - 1\n            Kp[idx_u, idx_u] += alpha\n        elif is_v_var: # u_i is fixed BC\n            idx_v = n_vars_per_model + i\n            Kp[idx_v, idx_v] += alpha\n\n    z_p = np.linalg.solve(Kp, F0)\n    err_disp_p, err_en_p = post_process(z_p)\n    \n    # ====== 4. Lagrange Multiplier Method ======\n    m = len(H)\n    kkt_size = total_vars + m\n    KKT = np.zeros((kkt_size, kkt_size))\n    KKT[:total_vars, :total_vars] = K0\n    \n    RHS_KKT = np.zeros(kkt_size)\n    RHS_KKT[:total_vars] = F0\n    \n    C = np.zeros((m, total_vars))\n    H_list = sorted(list(H))\n    \n    for row_idx, i in enumerate(H_list):\n        is_u_var = 1 = i  N\n        is_v_var = 0 = i  N-1\n        if is_u_var:\n            idx_u = i - 1\n            C[row_idx, idx_u] = 1.0\n        if is_v_var:\n            idx_v = n_vars_per_model + i\n            C[row_idx, idx_v] = -1.0\n            \n    KKT[:total_vars, total_vars:] = C.T\n    KKT[total_vars:, :total_vars] = C\n    \n    sol_kkt = np.linalg.solve(KKT, RHS_KKT)\n    z_lm = sol_kkt[:total_vars]\n    err_disp_lm, err_en_lm = post_process(z_lm)\n    \n    return [err_disp_p, err_en_p, err_disp_lm, err_en_lm]\n\n\ndef solve():\n    test_cases = [\n        # (N, H, ka, kc, F, i_star, beta, alpha)\n        (8, {3, 4, 5}, 1.0, 1.0, 1.0, 4, 0.5, 10.0),\n        (8, {3, 4, 5}, 1.0, 1.0, 1.0, 4, 0.5, 1e-6),\n        (8, {1}, 1.0, 1.0, 1.0, 1, 1.0, 1e3),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = solve_case(*case)\n        all_results.append(result)\n\n    # Format output as nested list of floats\n    print(f\"[{','.join([f'[{\",\".join(map(str, res))}]' for res in all_results])}]\")\n\nsolve()\n```"
        }
    ]
}