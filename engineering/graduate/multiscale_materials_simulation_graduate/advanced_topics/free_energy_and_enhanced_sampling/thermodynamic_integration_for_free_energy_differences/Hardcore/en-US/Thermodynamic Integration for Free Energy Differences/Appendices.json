{
    "hands_on_practices": [
        {
            "introduction": "Before applying thermodynamic integration to complex systems where the answer is unknown, it is a vital pedagogical step to confirm its validity on a model for which an exact analytical solution exists. This builds confidence in the method and reinforces the fundamental principle that free energy is a state function, meaning its change depends only on the endpoints, not the path taken. This exercise  involves a one-dimensional harmonic oscillator, a cornerstone system in statistical mechanics, providing a perfect testbed to demonstrate that TI correctly reproduces the free energy difference calculated directly from the partition function.",
            "id": "3853853",
            "problem": "A single particle in one spatial dimension is coupled to a thermal reservoir at temperature $T$ in the canonical ensemble. Its potential energy depends on a coupling parameter $\\lambda \\in [0,1]$ via $U(x;\\lambda)=\\frac{1}{2}k(\\lambda)x^{2}$, where $k(\\lambda)$ is a smooth, strictly positive function with $k(0)=k_{0}0$ and $k(1)=k_{1}0$. Assume the dynamics are classical and that momentum degrees of freedom are present but can be integrated out when considering configurational contributions. \n\nUsing only foundational definitions from equilibrium statistical mechanics and the notion of introducing a coupling parameter as a thermodynamic path, derive the free energy difference $\\Delta F \\equiv F(\\lambda=1)-F(\\lambda=0)$ in two independent ways:\n- By integrating along the coupling parameter $\\lambda$, expressed in terms of ensemble averages at fixed $\\lambda$, evaluated for this system at temperature $T$.\n- By direct evaluation of the configurational canonical partition function for each endpoint and taking the difference of the corresponding Helmholtz free energies.\n\nShow that the two results coincide for arbitrary smooth positive $k(\\lambda)$ subject to the endpoint constraints, and provide the final expression for $\\Delta F$ as a closed-form analytic function of $k_{0}$, $k_{1}$, $k_{B}$, and $T$. Do not substitute numerical values. Express your final answer as an analytic expression in terms of $k_{B}$ and $T$; no unit specification is required for the final expression.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and self-contained. It represents a standard application of fundamental principles in equilibrium statistical mechanics. No flaws are identified. We may therefore proceed with the derivation.\n\nThe Helmholtz free energy $F$ of a system at temperature $T$ is given by $F = -k_{B} T \\ln Z$, where $k_B$ is the Boltzmann constant and $Z$ is the canonical partition function. For a single classical particle in one dimension with Hamiltonian $H(p,x) = \\frac{p^2}{2m} + U(x)$, the partition function is:\n$$Z = \\frac{1}{h} \\int_{-\\infty}^{\\infty} dp \\int_{-\\infty}^{\\infty} dx \\exp\\left(-\\frac{H(p,x)}{k_{B}T}\\right)$$\nIn this problem, the potential energy $U(x;\\lambda) = \\frac{1}{2}k(\\lambda)x^2$ depends on the coupling parameter $\\lambda$. The Hamiltonian is $H(p,x;\\lambda) = \\frac{p^2}{2m} + \\frac{1}{2}k(\\lambda)x^2$. The partition function $Z(\\lambda)$ can be factored into kinetic and configurational parts:\n$$Z(\\lambda) = \\left(\\frac{1}{h} \\int_{-\\infty}^{\\infty} dp \\exp\\left(-\\frac{p^2}{2mk_{B}T}\\right)\\right) \\left(\\int_{-\\infty}^{\\infty} dx \\exp\\left(-\\frac{U(x;\\lambda)}{k_{B}T}\\right)\\right) = Z_{kin} Z_{c}(\\lambda)$$\nThe kinetic partition function $Z_{kin}$ is independent of $\\lambda$. The corresponding free energy is $F(\\lambda) = -k_{B}T \\ln(Z_{kin} Z_{c}(\\lambda)) = -k_{B}T\\ln Z_{kin} - k_{B}T\\ln Z_{c}(\\lambda) = F_{kin} + F_{c}(\\lambda)$.\nThe free energy difference $\\Delta F$ is therefore:\n$$\\Delta F = F(\\lambda=1) - F(\\lambda=0) = (F_{kin} + F_{c}(1)) - (F_{kin} + F_{c}(0)) = F_{c}(1) - F_{c}(0)$$\nWe only need to consider the configurational contributions to the free energy. Let $\\beta = (k_B T)^{-1}$.\n\n### Method 1: Integration Along the Coupling Parameter\n\nThe free energy difference can be obtained by integrating the derivative of the free energy with respect to the coupling parameter $\\lambda$. This is the method of thermodynamic integration.\n$$\\Delta F = \\int_{0}^{1} \\frac{\\partial F(\\lambda)}{\\partial \\lambda} d\\lambda$$\nWe first evaluate the partial derivative of $F(\\lambda)$ (or, equivalently, $F_c(\\lambda)$):\n$$\\frac{\\partial F_c(\\lambda)}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left(-k_{B}T \\ln Z_{c}(\\lambda)\\right) = -k_{B}T \\frac{1}{Z_{c}(\\lambda)} \\frac{\\partial Z_{c}(\\lambda)}{\\partial \\lambda}$$\nThe derivative of the configurational partition function $Z_{c}(\\lambda) = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) dx$ is:\n$$\\frac{\\partial Z_{c}(\\lambda)}{\\partial \\lambda} = \\int_{-\\infty}^{\\infty} \\frac{\\partial}{\\partial \\lambda} \\exp(-\\beta U(x;\\lambda)) dx = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) (-\\beta) \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} dx$$\nSubstituting this into the expression for $\\frac{\\partial F_c(\\lambda)}{\\partial \\lambda}$:\n$$\\frac{\\partial F_c(\\lambda)}{\\partial \\lambda} = -k_{B}T \\frac{1}{Z_{c}(\\lambda)} \\int_{-\\infty}^{\\infty} \\left(-\\frac{1}{k_{B}T}\\right) \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} \\exp(-\\beta U(x;\\lambda)) dx = \\frac{\\int_{-\\infty}^{\\infty} \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} \\exp(-\\beta U(x;\\lambda)) dx}{\\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) dx}$$\nThis is the definition of the canonical ensemble average of the derivative of the potential energy:\n$$\\frac{\\partial F(\\lambda)}{\\partial \\lambda} = \\left\\langle \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda}$$\nFor the given potential, $U(x;\\lambda) = \\frac{1}{2}k(\\lambda)x^2$, the partial derivative is:\n$$\\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} = \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} x^2$$\nTherefore, the derivative of the free energy is:\n$$\\frac{\\partial F(\\lambda)}{\\partial \\lambda} = \\left\\langle \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} x^2 \\right\\rangle_{\\lambda} = \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} \\langle x^2 \\rangle_{\\lambda}$$\nHere, $\\langle x^2 \\rangle_{\\lambda}$ is the ensemble average of $x^2$ for a harmonic potential with spring constant $k(\\lambda)$ at temperature $T$. This can be computed from the equipartition theorem, which states that each quadratic degree of freedom in the Hamiltonian contributes $\\frac{1}{2}k_{B}T$ to the average energy. The potential energy is a single quadratic term, so $\\langle U \\rangle = \\frac{1}{2}k(\\lambda)\\langle x^2 \\rangle_{\\lambda} = \\frac{1}{2}k_{B}T$. This gives:\n$$\\langle x^2 \\rangle_{\\lambda} = \\frac{k_{B}T}{k(\\lambda)}$$\nSubstituting this result back into the expression for $\\frac{\\partial F(\\lambda)}{\\partial \\lambda}$:\n$$\\frac{\\partial F(\\lambda)}{\\partial \\lambda} = \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} \\left(\\frac{k_{B}T}{k(\\lambda)}\\right) = \\frac{k_{B}T}{2} \\frac{1}{k(\\lambda)} \\frac{dk(\\lambda)}{d\\lambda}$$\nNow, we integrate with respect to $\\lambda$ from $0$ to $1$:\n$$\\Delta F = \\int_{0}^{1} \\frac{k_{B}T}{2} \\frac{1}{k(\\lambda)} \\frac{dk(\\lambda)}{d\\lambda} d\\lambda$$\nThis integral can be solved by a change of variables to $u = k(\\lambda)$, so $du = \\frac{dk}{d\\lambda} d\\lambda$. The integration limits change from $\\lambda=0, \\lambda=1$ to $u=k(0)=k_0, u=k(1)=k_1$.\n$$\\Delta F = \\frac{k_{B}T}{2} \\int_{k_{0}}^{k_{1}} \\frac{1}{u} du = \\frac{k_{B}T}{2} [\\ln|u|]_{k_0}^{k_1}$$\nSince $k(\\lambda)$ is strictly positive, $k_0  0$ and $k_1  0$, so $|u|=u$.\n$$\\Delta F = \\frac{k_{B}T}{2} (\\ln(k_1) - \\ln(k_0)) = \\frac{k_{B}T}{2} \\ln\\left(\\frac{k_1}{k_0}\\right)$$\n\n### Method 2: Direct Evaluation of Free Energy\n\nIn this method, we compute the configurational free energy $F_c(\\lambda)$ directly and then evaluate the difference $\\Delta F = F_c(1) - F_c(0)$. We begin by calculating the configurational partition function $Z_c(\\lambda)$.\n$$Z_{c}(\\lambda) = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{k(\\lambda)x^2}{2k_{B}T}\\right) dx$$\nThis is a standard Gaussian integral of the form $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\frac{\\pi}{a}}$. Here, $a = \\frac{k(\\lambda)}{2k_{B}T}$.\n$$Z_{c}(\\lambda) = \\sqrt{\\frac{\\pi}{k(\\lambda)/(2k_{B}T)}} = \\sqrt{\\frac{2\\pi k_{B}T}{k(\\lambda)}}$$\nNow, we find the configurational free energy, $F_{c}(\\lambda) = -k_{B}T \\ln Z_{c}(\\lambda)$:\n$$F_{c}(\\lambda) = -k_{B}T \\ln\\left(\\left(\\frac{2\\pi k_{B}T}{k(\\lambda)}\\right)^{1/2}\\right) = -\\frac{1}{2}k_{B}T \\ln\\left(\\frac{2\\pi k_{B}T}{k(\\lambda)}\\right)$$\nUsing the properties of logarithms, we can write:\n$$F_{c}(\\lambda) = -\\frac{1}{2}k_{B}T \\left( \\ln(2\\pi k_{B}T) - \\ln(k(\\lambda)) \\right) = \\frac{1}{2}k_{B}T \\ln(k(\\lambda)) - \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T)$$\nNow, we can compute the free energies at the endpoints $\\lambda=0$ and $\\lambda=1$:\n$$F_{c}(\\lambda=1) = \\frac{1}{2}k_{B}T \\ln(k(1)) - \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T) = \\frac{1}{2}k_{B}T \\ln(k_1) - C$$\n$$F_{c}(\\lambda=0) = \\frac{1}{2}k_{B}T \\ln(k(0)) - \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T) = \\frac{1}{2}k_{B}T \\ln(k_0) - C$$\nwhere $C = \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T)$ is a constant independent of $\\lambda$. The free energy difference is then:\n$$\\Delta F = F_{c}(1) - F_{c}(0) = \\left(\\frac{1}{2}k_{B}T \\ln(k_1) - C\\right) - \\left(\\frac{1}{2}k_{B}T \\ln(k_0) - C\\right)$$\n$$\\Delta F = \\frac{1}{2}k_{B}T \\ln(k_1) - \\frac{1}{2}k_{B}T \\ln(k_0) = \\frac{k_{B}T}{2} \\ln\\left(\\frac{k_1}{k_0}\\right)$$\n\n### Conclusion\nBoth methods yield the identical result. This demonstrates the path-independence of the free energy difference, which is a state function. The result depends only on the initial and final states of the system, characterized by $k_0$ and $k_1$ respectively, and not on the specific smooth, positive function $k(\\lambda)$ that connects them. The final expression for the free energy difference is a closed-form analytic function of the given parameters.",
            "answer": "$$\\boxed{\\frac{k_{B}T}{2}\\ln\\left(\\frac{k_{1}}{k_{0}}\\right)}$$"
        },
        {
            "introduction": "A core assumption of thermodynamic integration is that the system remains in equilibrium at each value of the coupling parameter $\\lambda$. In practice, if the transformation involves crossing high energy barriers, the system can become kinetically trapped in metastable states, leading to non-equilibrium effects and inaccurate results. This practice  introduces the hysteresis test, a powerful diagnostic for detecting such issues. By comparing the integrated free energy from a forward path ($\\lambda: 0 \\to 1$) with that from a backward path ($\\lambda: 1 \\to 0$), you will learn to identify and quantify the signature of hysteresis, a key skill for validating real-world simulation data.",
            "id": "3853839",
            "problem": "You are asked to implement and analyze a hysteresis test for Thermodynamic Integration (TI) within a multiscale materials simulation setting. The fundamental base is the equilibrium Statistical Mechanics description through the canonical partition function $Z(\\lambda)$, the Helmholtz free energy $F(\\lambda)=-k_{\\mathrm{B}}T\\ln Z(\\lambda)$, and basic calculus on parameterized Hamiltonians. The control parameter is a dimensionless coupling coordinate $\\lambda\\in[0,1]$ that modulates the Hamiltonian of a system with two metastable states whose occupation depends on $\\lambda$. The generalized force is the ensemble average of the derivative of the potential energy with respect to the control parameter, written as $\\left\\langle \\partial U / \\partial \\lambda \\right\\rangle_{\\lambda}$. In a hysteresis test, one measures this generalized force along both a forward ramp ($\\lambda:0\\to 1$) and a backward ramp ($\\lambda:1\\to 0$). The presence of metastability and sampling barriers implies path dependence: the measured generalized force curves for forward and backward ramps can differ, leading to different integrated free energy differences.\n\nFor the purposes of this problem, model the generalized force curves by a smooth baseline augmented with a sigmoidal switching contribution to mimic metastable state transitions:\n- Baseline contribution: $g_{\\mathrm{base}}(\\lambda)=a\\sin(2\\pi \\lambda)+b\\lambda$.\n- Switching function: $L(\\lambda;\\lambda_{c},w)=\\dfrac{1}{1+e^{-(\\lambda-\\lambda_{c})/w}}$, where $\\lambda_{c}$ is the center of the transition and $w$ controls the sharpness of the transition.\n- Forward generalized force: $g_{\\mathrm{fwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}}\\right)$.\n- Backward generalized force: $g_{\\mathrm{bwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}}\\right)$.\n\nThe switching parameters $\\lambda_{c}^{\\mathrm{fwd}}$, $\\lambda_{c}^{\\mathrm{bwd}}$, $w^{\\mathrm{fwd}}$, and $w^{\\mathrm{bwd}}$ encode hysteresis. Large separation between $\\lambda_{c}^{\\mathrm{fwd}}$ and $\\lambda_{c}^{\\mathrm{bwd}}$ together with small $w$ indicates strong metastability and sampling barriers.\n\nTasks:\n1. Starting from $F(\\lambda)=-k_{\\mathrm{B}}T\\ln Z(\\lambda)$ and the definition of the generalized force, derive the numerical procedure to compute the free energy difference $\\Delta F$ between $\\lambda=0$ and $\\lambda=1$ by integrating the generalized force along the control parameter. Implement this evaluation for both the forward path and the backward path. Express all free energy differences in multiples of $k_{\\mathrm{B}}T$ (dimensionless).\n2. Quantify hysteresis by computing the signed difference $H=\\Delta F_{\\mathrm{fwd}}-\\Delta F_{\\mathrm{bwd}}$ and the path-disagreement area $A=\\int_{0}^{1}\\left|g_{\\mathrm{fwd}}(\\lambda)-g_{\\mathrm{bwd}}(\\lambda)\\right|\\,\\mathrm{d}\\lambda$, both dimensionless in units of $k_{\\mathrm{B}}T$.\n3. Define a boolean flag for metastability as $\\mathrm{MS}=\\left(|H|\\tau_{H}\\right)\\vee\\left(A\\tau_{A}\\right)$, where $\\tau_{H}$ and $\\tau_{A}$ are user-specified thresholds (dimensionless in $k_{\\mathrm{B}}T$ units).\n\nNumerical requirements:\n- Use a uniform grid of $N$ points spanning $\\lambda\\in[0,1]$ with $N$ odd so that composite Simpson's rule can be applied. Let the grid spacing be $h=\\left(1-0\\right)/(N-1)$.\n- Use composite Simpson's rule for all integrals to ensure accuracy. No stochastic noise is present; all functions are deterministic and smooth.\n- Report all floating-point results rounded to six decimal places.\n\nTest suite:\nCompute the outputs for the following parameter sets, each specified as $\\left(a,b,c,\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}},\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}},N,\\tau_{H},\\tau_{A}\\right)$:\n- Case $1$ (no hysteresis, happy path): $\\left(0.5,0.4,1.2,0.5,0.1,0.5,0.1,20001,0.01,0.05\\right)$.\n- Case $2$ (mild hysteresis): $\\left(0.4,0.6,1.0,0.4,0.08,0.6,0.08,20001,0.01,0.05\\right)$.\n- Case $3$ (strong metastability with sharp switching): $\\left(0.3,0.2,2.5,0.2,0.02,0.8,0.02,20001,0.05,0.10\\right)$.\n- Case $4$ (boundary-adjacent switching): $\\left(0.2,0.1,1.5,0.05,0.03,0.95,0.03,20001,0.02,0.08\\right)$.\n\nProgram output format:\n- For each case, output a list $\\left[\\Delta F_{\\mathrm{fwd}},\\Delta F_{\\mathrm{bwd}},H,A,\\mathrm{MS}\\right]$ with $\\Delta F_{\\mathrm{fwd}}$, $\\Delta F_{\\mathrm{bwd}}$, $H$, and $A$ as floats rounded to six decimals, and $\\mathrm{MS}$ as a boolean. Aggregate all four case results into a single line as a comma-separated list enclosed in square brackets, i.e., $\\left[\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right]\\right]$.",
            "solution": "The problem statement is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\n\n- **Problem Domain**: Thermodynamic Integration (TI) for free energy differences in multiscale materials simulation, grounded in equilibrium Statistical Mechanics.\n- **Fundamental Relations**:\n    - Canonical partition function: $Z(\\lambda)$.\n    - Helmholtz free energy: $F(\\lambda)=-k_{\\mathrm{B}}T\\ln Z(\\lambda)$.\n    - Control parameter: $\\lambda \\in [0,1]$.\n    - Generalized force: $\\left\\langle \\partial U / \\partial \\lambda \\right\\rangle_{\\lambda}$.\n- **Hysteresis Test Procedure**: The generalized force is measured along a forward ramp ($\\lambda: 0 \\to 1$) and a backward ramp ($\\lambda: 1 \\to 0$).\n- **Model Functions for Generalized Force**:\n    - Baseline contribution: $g_{\\mathrm{base}}(\\lambda)=a\\sin(2\\pi \\lambda)+b\\lambda$.\n    - Switching function: $L(\\lambda;\\lambda_{c},w)=\\dfrac{1}{1+e^{-(\\lambda-\\lambda_{c})/w}}$.\n    - Forward generalized force: $g_{\\mathrm{fwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}}\\right)$.\n    - Backward generalized force: $g_{\\mathrm{bwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}}\\right)$.\n- **Tasks**:\n    1. Derive and implement the numerical procedure to compute the free energy difference $\\Delta F = F(1) - F(0)$ for both forward and backward paths, expressed in multiples of $k_{\\mathrm{B}}T$.\n    2. Quantify hysteresis by computing the signed difference $H=\\Delta F_{\\mathrm{fwd}}-\\Delta F_{\\mathrm{bwd}}$ and the path-disagreement area $A=\\int_{0}^{1}\\left|g_{\\mathrm{fwd}}(\\lambda)-g_{\\mathrm{bwd}}(\\lambda)\\right|\\,\\mathrm{d}\\lambda$, both dimensionless in units of $k_{\\mathrm{B}}T$.\n    3. Define a boolean flag for metastability: $\\mathrm{MS}=\\left(|H|\\tau_{H}\\right)\\vee\\left(A\\tau_{A}\\right)$.\n- **Numerical Requirements**:\n    - Grid: Uniform grid of $N$ points for $\\lambda \\in [0,1]$, with $N$ odd.\n    - Integration Method: Composite Simpson's rule for all integrals.\n    - Precision: Report floating-point results rounded to six decimal places.\n- **Test Suite**: Parameter sets $\\left(a,b,c,\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}},\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}},N,\\tau_{H},\\tau_{A}\\right)$:\n    - Case 1: $\\left(0.5,0.4,1.2,0.5,0.1,0.5,0.1,20001,0.01,0.05\\right)$.\n    - Case 2: $\\left(0.4,0.6,1.0,0.4,0.08,0.6,0.08,20001,0.01,0.05\\right)$.\n    - Case 3: $\\left(0.3,0.2,2.5,0.2,0.02,0.8,0.02,20001,0.05,0.10\\right)$.\n    - Case 4: $\\left(0.2,0.1,1.5,0.05,0.03,0.95,0.03,20001,0.02,0.08\\right)$.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is evaluated against the validation criteria.\n\n- **Scientifically Grounded**: The problem is based on the fundamental principles of statistical mechanics, specifically the relationship between free energy and the partition function, and its application in thermodynamic integration, a standard and widely-used technique in computational physics and chemistry. The use of sigmoidal functions to model state transitions is a common and appropriate phenomenological approach. The problem is scientifically sound.\n- **Well-Posed**: The problem provides explicit, deterministic mathematical functions and a clear set of tasks. All parameters are defined, and the numerical methods and output requirements are specified unambiguously. This structure ensures that a unique, stable, and meaningful solution exists for each test case.\n- **Objective**: The problem is stated in precise, quantitative terms, free from subjective language or opinion-based claims.\n- **Completeness and Consistency**: The problem is self-contained. All necessary information, including functional forms, parameters for test cases, and numerical specifications, is provided. There are no internal contradictions. For example, the requirement that $N$ is odd is consistent with the application of the composite Simpson's rule over the interval.\n- **Realism**: The setup models a common scenario in molecular simulations where hysteresis indicates insufficient sampling or kinetic trapping between metastable states. The parameters and functional forms are plausible representations of such a system. The task itself represents a standard analysis protocol.\n- **No Other Flaws**: The problem is not metaphorical, trivial, tautological, or unfalsifiable. It requires a specific, non-trivial application of calculus and numerical methods to a physically motivated model.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. It is scientifically sound, well-posed, and complete. A rigorous solution can be constructed.\n\n---\n\n### Solution\n\nThe solution is developed by first establishing the theoretical basis, then defining the quantities to be computed, and finally outlining the numerical implementation.\n\n**1. Theoretical Foundation of Thermodynamic Integration**\n\nThe Helmholtz free energy $F$ is related to the canonical partition function $Z$ of a system at temperature $T$ by the relation:\n$$\nF(\\lambda) = -k_{\\mathrm{B}}T \\ln Z(\\lambda)\n$$\nwhere $k_{\\mathrm{B}}$ is the Boltzmann constant and $\\lambda$ is a parameter that continuously transforms the system's potential energy $U(\\lambda)$. The partition function for a classical system of particles with positions $\\mathbf{r}$ is given by:\n$$\nZ(\\lambda) = \\int e^{-U(\\mathbf{r}; \\lambda)/(k_{\\mathrm{B}}T)} d\\mathbf{r}\n$$\n(neglecting kinetic energy terms, which are assumed to be independent of $\\lambda$).\n\nTo find the change in free energy with respect to $\\lambda$, we differentiate $F(\\lambda)$:\n$$\n\\frac{dF}{d\\lambda} = -k_{\\mathrm{B}}T \\frac{1}{Z(\\lambda)} \\frac{dZ}{d\\lambda}\n$$\nThe derivative of the partition function is:\n$$\n\\frac{dZ}{d\\lambda} = \\int \\left( -\\frac{1}{k_{\\mathrm{B}}T} \\frac{\\partial U(\\mathbf{r}; \\lambda)}{\\partial \\lambda} \\right) e^{-U(\\mathbf{r}; \\lambda)/(k_{\\mathrm{B}}T)} d\\mathbf{r}\n$$\nSubstituting this back, we obtain:\n$$\n\\frac{dF}{d\\lambda} = -k_{\\mathrm{B}}T \\frac{1}{Z(\\lambda)} \\int \\left( -\\frac{1}{k_{\\mathrm{B}}T} \\frac{\\partial U}{\\partial \\lambda} \\right) e^{-U/(k_{\\mathrm{B}}T)} d\\mathbf{r} = \\frac{\\int \\frac{\\partial U}{\\partial \\lambda} e^{-U/(k_{\\mathrm{B}}T)} d\\mathbf{r}}{\\int e^{-U/(k_{\\mathrm{B}}T)} d\\mathbf{r}}\n$$\nThe right-hand side is, by definition, the canonical ensemble average of the derivative of the potential energy with respect to $\\lambda$. This is the generalized force, $g(\\lambda)$:\n$$\n\\frac{dF}{d\\lambda} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} = g(\\lambda)\n$$\nThe total free energy difference between the state at $\\lambda=1$ and the state at $\\lambda=0$ is obtained by integrating this derivative via the fundamental theorem of calculus:\n$$\n\\Delta F = F(1) - F(0) = \\int_{0}^{1} \\frac{dF}{d\\lambda} d\\lambda = \\int_{0}^{1} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} d\\lambda\n$$\nThe problem requires results in dimensionless units of $k_{\\mathrm{B}}T$. Therefore, we compute:\n$$\n\\frac{\\Delta F}{k_{\\mathrm{B}}T} = \\int_{0}^{1} \\frac{1}{k_{\\mathrm{B}}T} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} d\\lambda\n$$\nThe given functions $g_{\\mathrm{fwd}}(\\lambda)$ and $g_{\\mathrm{bwd}}(\\lambda)$ are specified as being dimensionless, consistent with them representing the quantity $\\frac{1}{k_{\\mathrm{B}}T} \\langle \\frac{\\partial U}{\\partial \\lambda} \\rangle_{\\lambda}$.\n\n**2. Hysteresis Analysis and Quantifiers**\n\nIn a physical simulation, the system may not remain in equilibrium as $\\lambda$ is changed at a finite rate. The measured generalized force will depend on the path taken. The forward path ($\\lambda: 0 \\to 1$) yields an estimate for the free energy difference, $\\Delta F_{\\mathrm{fwd}}$. The backward path ($\\lambda: 1 \\to 0$) yields a work value, which can be used to estimate the same free energy difference, $\\Delta F_{\\mathrm{bwd}}$. To ensure a consistent comparison of the quantity $F(1)-F(0)$, both estimates are calculated as integrals from $\\lambda=0$ to $\\lambda=1$:\n$$\n\\Delta F_{\\mathrm{fwd}} = \\int_{0}^{1} g_{\\mathrm{fwd}}(\\lambda) d\\lambda\n$$\n$$\n\\Delta F_{\\mathrm{bwd}} = \\int_{0}^{1} g_{\\mathrm{bwd}}(\\lambda) d\\lambda\n$$\nNote that the integral for the backward path estimate is still over $[0, 1]$, representing $-W_{1\\to 0}$, which is an estimate for $\\Delta F_{0\\to 1}$.\n\nThe degree of hysteresis is quantified by two metrics:\n1.  **Signed Difference ($H$)**: The difference between the forward and backward free energy estimates. This represents the net area enclosed by the two curves.\n    $$\n    H = \\Delta F_{\\mathrm{fwd}} - \\Delta F_{\\mathrm{bwd}} = \\int_{0}^{1} \\left( g_{\\mathrm{fwd}}(\\lambda) - g_{\\mathrm{bwd}}(\\lambda) \\right) d\\lambda\n    $$\n2.  **Path-Disagreement Area ($A$)**: The total area between the forward and backward force curves. This quantifies the total discrepancy, irrespective of sign.\n    $$\n    A = \\int_{0}^{1} | g_{\\mathrm{fwd}}(\\lambda) - g_{\\mathrm{bwd}}(\\lambda) | d\\lambda\n    $$\nFor the given problem, since $\\lambda_{c}^{\\mathrm{fwd}} \\le \\lambda_{c}^{\\mathrm{bwd}}$ and the logistic function $L(\\lambda; \\lambda_{c}, w)$ is a monotonically decreasing function of $\\lambda_c$, it follows that $g_{\\mathrm{fwd}}(\\lambda) \\ge g_{\\mathrm{bwd}}(\\lambda)$ for all $\\lambda \\in [0,1]$ (assuming $c0$, as is true in all test cases). Consequently, for these cases, $H=A$.\n\nFinally, the system is flagged for significant metastability if either of these metrics exceeds a predefined threshold:\n$$\n\\mathrm{MS} = (|H|  \\tau_{H}) \\vee (A  \\tau_{A})\n$$\n\n**3. Numerical Implementation**\n\nThe computation is performed numerically using the composite Simpson's rule, as specified.\n1.  For each test case, a uniform grid of $N$ points for $\\lambda$ is created over the interval $[0, 1]$. The grid spacing is $h=1/(N-1)$. $N$ is chosen to be odd, ensuring an even number of intervals, as required by the rule.\n2.  The functions $g_{\\mathrm{fwd}}(\\lambda)$ and $g_{\\mathrm{bwd}}(\\lambda)$ are evaluated at each point on the $\\lambda$ grid, yielding two arrays of function values.\n3.  The definite integrals for $\\Delta F_{\\mathrm{fwd}}$, $\\Delta F_{\\mathrm{bwd}}$, and $A$ are computed by applying the composite Simpson's rule to the corresponding arrays of function values. The `scipy.integrate.simpson` function provides an efficient and accurate implementation of this rule.\n4.  $\\Delta F_{\\mathrm{fwd}}$ is calculated by integrating the $g_{\\mathrm{fwd}}$ values.\n5.  $\\Delta F_{\\mathrm{bwd}}$ is calculated by integrating the $g_{\\mathrm{bwd}}$ values.\n6.  $H$ is computed as the simple difference: $H = \\Delta F_{\\mathrm{fwd}} - \\Delta F_{\\mathrm{bwd}}$.\n7.  The integrand for $A$ is computed as $|g_{\\mathrm{fwd}} - g_{\\mathrm{bwd}}|$ on the grid, and this new array is integrated to find $A$.\n8.  The boolean flag $\\mathrm{MS}$ is evaluated using the computed $H$ and $A$ and the given thresholds $\\tau_H$ and $\\tau_A$.\n9.  All floating-point results ($\\Delta F_{\\mathrm{fwd}}, \\Delta F_{\\mathrm{bwd}}, H, A$) are rounded to six decimal places. The results for each case are compiled into the specified list format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import simpson\n\ndef solve():\n    \"\"\"\n    Implements and analyzes a hysteresis test for Thermodynamic Integration (TI).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (a, b, c, l_c_fwd, w_fwd, l_c_bwd, w_bwd, N, tau_H, tau_A)\n    test_cases = [\n        (0.5, 0.4, 1.2, 0.5, 0.1, 0.5, 0.1, 20001, 0.01, 0.05),\n        (0.4, 0.6, 1.0, 0.4, 0.08, 0.6, 0.08, 20001, 0.01, 0.05),\n        (0.3, 0.2, 2.5, 0.2, 0.02, 0.8, 0.02, 20001, 0.05, 0.10),\n        (0.2, 0.1, 1.5, 0.05, 0.03, 0.95, 0.03, 20001, 0.02, 0.08),\n    ]\n\n    all_results = []\n\n    def g_base(lam, a, b):\n        \"\"\"Baseline contribution to the generalized force.\"\"\"\n        return a * np.sin(2 * np.pi * lam) + b * lam\n\n    def L_func(lam, lam_c, w):\n        \"\"\"Sigmoidal switching function (logistic function).\"\"\"\n        # Add a small epsilon to the denominator of the exponent to avoid division by zero if w=0\n        # Although problem cases have w  0, this is good practice.\n        w_safe = w if w != 0 else 1e-9\n        return 1.0 / (1.0 + np.exp(-(lam - lam_c) / w_safe))\n\n    for case in test_cases:\n        a, b, c, l_c_fwd, w_fwd, l_c_bwd, w_bwd, N, tau_H, tau_A = case\n\n        # 1. Create a uniform grid for lambda from 0 to 1 with N points.\n        lambda_grid = np.linspace(0.0, 1.0, N)\n\n        # 2. Evaluate the generalized force functions on the grid.\n        g_base_vals = g_base(lambda_grid, a, b)\n        \n        g_fwd_vals = g_base_vals + c * L_func(lambda_grid, l_c_fwd, w_fwd)\n        g_bwd_vals = g_base_vals + c * L_func(lambda_grid, l_c_bwd, w_bwd)\n\n        # 3. Compute free energy differences using composite Simpson's rule.\n        # Scipy's simpson function takes the y-values and the x-values (the grid).\n        delta_F_fwd = simpson(y=g_fwd_vals, x=lambda_grid)\n        delta_F_bwd = simpson(y=g_bwd_vals, x=lambda_grid)\n\n        # 4. Quantify hysteresis.\n        # H is the signed difference of the integrated free energies.\n        H = delta_F_fwd - delta_F_bwd\n        \n        # A is the integral of the absolute difference of the force curves.\n        g_diff_vals = np.abs(g_fwd_vals - g_bwd_vals)\n        A = simpson(y=g_diff_vals, x=lambda_grid)\n\n        # 5. Determine the metastability flag.\n        MS = (np.abs(H)  tau_H) or (A  tau_A)\n\n        # 6. Format the results for the current case.\n        # Round floats to six decimal places, MS is a boolean.\n        case_result = [\n            round(delta_F_fwd, 6),\n            round(delta_F_bwd, 6),\n            round(H, 6),\n            round(A, 6),\n            MS\n        ]\n        all_results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # Use a custom string representation for the list of lists.\n    result_str = \",\".join([str(res) for res in all_results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The fact that Helmholtz free energy is a state function has a profound consequence: the net free energy change around any closed thermodynamic cycle must be zero. This principle can be turned into a rigorous self-consistency check for a set of TI calculations, helping to uncover hidden systematic biases that a single calculation might miss. This final practice  guides you in implementing a thermodynamic cycle closure test. You will assess whether the sum of free energy changes along a closed loop is consistent with zero within statistical uncertainty, providing a robust method to validate the overall integrity of your simulation results.",
            "id": "3853893",
            "problem": "You are given a closed set of thermodynamic paths forming cycles in a coupling-parameter space. Each path is parameterized by a scalar coupling parameter $\\lambda \\in [0,1]$ and has an associated integrand function representing the ensemble average of the derivative of the Hamiltonian with respect to $\\lambda$. Your task is to implement a numerical cycle-closure test to assess thermodynamic consistency across different paths and to detect hidden biases in Thermodynamic Integration (TI). Work within the framework of multiscale materials simulation.\n\nStart from the following fundamental base:\n- In the canonical ensemble, the Helmholtz free energy $F$ satisfies $F = -k_\\mathrm{B} T \\ln Z$, where $k_\\mathrm{B}$ is the Boltzmann constant, $T$ is the absolute temperature, and $Z$ is the partition function.\n- The free energy is a state function; therefore, for any closed cycle that begins and ends at the same thermodynamic state, the exact total free energy change must be $0$.\n- Coupling-parameter TI connects two Hamiltonians by a continuous parameter $\\lambda$, and the free energy difference can be represented as an integral over $\\lambda$ of an ensemble average under the appropriate $\\lambda$-dependent Hamiltonian.\n\nYour program must:\n1. Approximate the free energy change $\\Delta F$ for each path in a cycle by numerically integrating the provided integrand $\\langle \\partial U/\\partial \\lambda \\rangle(\\lambda)$ over $\\lambda \\in [0,1]$. Express all energies in units of $k_\\mathrm{B}T$ (dimensionless).\n2. Estimate the uncertainty of each path integral by propagating pointwise standard deviations under an independence assumption.\n3. Aggregate the path free energy changes around a closed cycle to compute a cycle sum $S$ and its uncertainty $\\sigma_S$.\n4. Form a cycle-closure statistic $z = S/\\sigma_S$ and determine whether the cycle is consistent at a $95\\%$ confidence level using the criterion $|z| \\le z_\\mathrm{crit}$, with $z_\\mathrm{crit} = 1.96$.\n5. Produce a single line of output containing the results for all provided test cases as a comma-separated list enclosed in square brackets. Each test case result must be a list of four elements: the cycle sum $S$ in $k_\\mathrm{B}T$, the cycle uncertainty $\\sigma_S$ in $k_\\mathrm{B}T$, the dimensionless $z$-score, and a Boolean indicating whether the cycle passes the closure test at the specified confidence level. All floats must be rounded to six decimal places. For example, the output must have the form $[[S_1,\\sigma_{S,1},z_1,True],[S_2,\\sigma_{S,2},z_2,False],\\dots]$.\n\nNumerical method requirements:\n- Use Composite Simpson’s rule on an equispaced grid $\\lambda_i$, $i=0,\\dots,N-1$, over $[0,1]$. If the specified number of grid points $N$ is even, increase it by $1$ to satisfy the odd-number requirement for Simpson’s rule. Ensure $N \\ge 3$.\n- Let $\\Delta \\lambda = 1/(N-1)$ and weights $w_i$ be the standard Simpson weights: $w_0 = 1$, $w_{N-1} = 1$, $w_{i} = 4$ for odd $i$, and $w_i = 2$ for even $i$ with $0iN-1$. The integral estimate is\n$$\n\\Delta F \\approx \\frac{\\Delta \\lambda}{3} \\sum_{i=0}^{N-1} w_i\\, g(\\lambda_i),\n$$\nwhere $g(\\lambda)$ denotes the provided integrand function.\n- Assume independent Gaussian uncertainties at each grid point with standard deviation $\\sigma(\\lambda_i)$. Propagate to the integral by\n$$\n\\mathrm{Var}(\\Delta F) \\approx \\left(\\frac{\\Delta \\lambda}{3}\\right)^2 \\sum_{i=0}^{N-1} w_i^2 \\, \\sigma(\\lambda_i)^2.\n$$\n- For a cycle consisting of paths $p=1,\\dots,P$, compute the cycle sum $S = \\sum_{p=1}^P \\Delta F_p$ and $\\sigma_S = \\sqrt{\\sum_{p=1}^P \\mathrm{Var}(\\Delta F_p)}$.\n\nTest suite:\nImplement your program to evaluate the following four cycles. For all cases, energies are in units of $k_\\mathrm{B}T$, angles do not appear, and all outputs must follow the format and rounding requirements described above.\n\n- Case $1$ (unbiased three-path cycle, moderate uncertainty):\n  - Path $1$: $g_1(\\lambda) = a_1 \\lambda^2 + b_1 \\lambda + c_1$ with $a_1 = 0.9$, $b_1 = 0.0$, $c_1 = 0.0$, bias $\\epsilon_1 = 0.0$, $\\sigma_1(\\lambda) = 0.02$, $N_1 = 101$.\n  - Path $2$: $g_2(\\lambda) = a_2 \\lambda^2 + b_2 \\lambda + c_2$ with $a_2 = 0.0$, $b_2 = -0.2$, $c_2 = 0.0$, bias $\\epsilon_2 = 0.0$, $\\sigma_2(\\lambda) = 0.02$, $N_2 = 101$.\n  - Path $3$: $g_3(\\lambda) = a_3 \\lambda^2 + b_3 \\lambda + c_3$ with $a_3 = 0.0$, $b_3 = 0.0$, $c_3 = -0.2$, bias $\\epsilon_3 = 0.0$, $\\sigma_3(\\lambda) = 0.02$, $N_3 = 101$.\n\n- Case $2$ (hidden bias in one path, small uncertainty):\n  - Path $1$: same as Case $1$ Path $1$.\n  - Path $2$: same as Case $1$ Path $2$ but with bias $\\epsilon_2 = +0.05$ added to the integrand.\n  - Path $3$: same as Case $1$ Path $3$.\n  - All $\\sigma(\\lambda) = 0.01$, all $N = 101$.\n\n- Case $3$ (same hidden bias but large uncertainty):\n  - Paths: same integrands and biases as Case $2$.\n  - All $\\sigma(\\lambda) = 0.2$, all $N = 101$.\n\n- Case $4$ (two-path cycle approximating forward and reverse, coarse sampling):\n  - Path $1$: $g_1(\\lambda) = a_1 \\lambda^2 + b_1 \\lambda + c_1$ with $a_1 = 0.6$, $b_1 = -0.3$, $c_1 = 0.1$, bias $\\epsilon_1 = 0.0$, $\\sigma_1(\\lambda) = 0.02$, $N_1 = 3$.\n  - Path $2$: $g_2(\\lambda) = a_2 \\lambda^2 + b_2 \\lambda + c_2$ with $a_2 = -0.6$, $b_2 = 0.3$, $c_2 = -0.1$, bias $\\epsilon_2 = +0.01$, $\\sigma_2(\\lambda) = 0.02$, $N_2 = 3$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element must be a list $[S,\\sigma_S,z,\\mathrm{pass}]$ with $S$ and $\\sigma_S$ in $k_\\mathrm{B}T$, $z$ dimensionless, and pass a Boolean. All floats must be rounded to six decimal places. For example:\n$[[0.000000,0.005000,0.000000,True],[0.050000,0.002000,25.000000,False],\\dots]$.",
            "solution": "The fundamental principle underpinning this analysis is that the Helmholtz free energy, $F$, is a thermodynamic state function. Consequently, for any process that returns a system to its initial state, thereby completing a thermodynamic cycle, the net change in free energy must be identically zero. In the context of thermodynamic integration (TI), where a system's Hamiltonian, often represented by its potential energy component $U(\\lambda)$, is modified via a coupling parameter $\\lambda$, this principle manifests as a cycle-closure condition. If we define a set of paths in $\\lambda$-space that form a closed loop, the sum of the free energy differences, $\\Delta F_p$, along each path $p$ must vanish: $\\sum_p \\Delta F_p = \\oint dF = 0$. Deviations from this zero-sum condition, when accounting for statistical uncertainty, can signify systematic errors or \"hidden biases\" in the underlying simulations or models.\n\nThis problem requires the implementation of a numerical test for this cycle-closure condition. The free energy difference for a single path, evolving from $\\lambda=0$ to $\\lambda=1$, is given by the integral:\n$$\n\\Delta F = \\int_0^1 \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_\\lambda d\\lambda\n$$\nwhere all energies are expressed in dimensionless units of $k_\\mathrm{B}T$, and $\\langle \\cdot \\rangle_\\lambda$ denotes a canonical ensemble average at a fixed $\\lambda$. The integrand, $g(\\lambda) = \\langle \\partial U / \\partial \\lambda \\rangle_\\lambda$, is provided for each path.\n\nThe numerical-algorithmic procedure is as follows:\n\n1.  **Path Integration**: The integral for each path's free energy change, $\\Delta F_p$, is approximated using the Composite Simpson's rule. The interval $\\lambda \\in [0,1]$ is discretized into an equispaced grid of $N$ points, $\\lambda_i$, where $i=0, \\dots, N-1$. If the provided $N$ is even, it is incremented to $N+1$ to satisfy the rule's requirement for an odd number of points (an even number of intervals). The grid spacing is $\\Delta \\lambda = 1/(N-1)$. The integral is then computed as a weighted sum:\n    $$\n    \\Delta F \\approx \\frac{\\Delta \\lambda}{3} \\sum_{i=0}^{N-1} w_i g(\\lambda_i)\n    $$\n    The Simpson's weights $w_i$ are $w_0=1$, $w_{N-1}=1$, and for $0  i  N-1$, $w_i=4$ for odd indices $i$ and $w_i=2$ for even indices $i$. The provided integrand functions $g(\\lambda)$ are polynomials of degree at most $2$; Simpson's rule is exact for polynomials of degree up to $3$, so this numerical integration introduces no approximation error for the mean value.\n\n2.  **Uncertainty Propagation**: The integrand values $g(\\lambda_i)$ are ensemble averages and, as such, are subject to statistical uncertainty, quantified by their standard deviation $\\sigma(\\lambda_i)$. Assuming the statistical errors at different $\\lambda_i$ points are independent and Gaussian, the variance of the path integral, $\\mathrm{Var}(\\Delta F)$, is calculated by propagating the pointwise variances $\\sigma(\\lambda_i)^2$:\n    $$\n    \\mathrm{Var}(\\Delta F) \\approx \\left(\\frac{\\Delta \\lambda}{3}\\right)^2 \\sum_{i=0}^{N-1} w_i^2 \\, \\sigma(\\lambda_i)^2\n    $$\n\n3.  **Cycle Aggregation**: For a cycle composed of $P$ paths, the total cycle closure error, $S$, is the sum of the individual free energy changes:\n    $$\n    S = \\sum_{p=1}^P \\Delta F_p\n    $$\n    Assuming the statistical uncertainties for each path calculation are independent, the total variance of the cycle sum, $\\mathrm{Var}(S)$, is the sum of the individual path variances. The total cycle uncertainty, $\\sigma_S$, is the square root of this sum:\n    $$\n    \\sigma_S = \\sqrt{\\sum_{p=1}^P \\mathrm{Var}(\\Delta F_p)}\n    $$\n\n4.  **Statistical Consistency Test**: To assess consistency, we formulate a $z$-score, which is a dimensionless statistic measuring the cycle closure error in units of its expected statistical uncertainty:\n    $$\n    z = \\frac{S}{\\sigma_S}\n    $$\n    Under the null hypothesis that there are no systematic errors and the uncertainties are correctly estimated, $z$ follows a standard normal distribution. We test for consistency at the $95\\%$ confidence level. This corresponds to a critical value of $z_\\mathrm{crit} = 1.96$. If $|z| \\le z_\\mathrm{crit}$, the cycle is deemed thermodynamically consistent, and the null hypothesis is not rejected. If $|z|  z_\\mathrm{crit}$, the cycle fails the closure test, indicating a statistically significant discrepancy, likely due to a hidden bias or an underestimation of the true uncertainty.\n\nThe implementation will consist of a function to perform the integration and error propagation for a single path, and a main procedure to iterate through the given test cases. For each case, it will process all paths in the cycle, aggregate the results to compute $S$, $\\sigma_S$, and $z$, and determine the pass/fail outcome. The final results are then formatted and printed according to the specified requirements.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the thermodynamic cycle closure problem.\n    It processes a series of test cases, calculates cycle closure statistics,\n    and prints the formatted results.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (unbiased three-path cycle, moderate uncertainty)\n        [\n            {'a': 0.9, 'b': 0.0, 'c': 0.0, 'bias': 0.0, 'sigma': 0.02, 'N': 101},\n            {'a': 0.0, 'b': -0.2, 'c': 0.0, 'bias': 0.0, 'sigma': 0.02, 'N': 101},\n            {'a': 0.0, 'b': 0.0, 'c': -0.2, 'bias': 0.0, 'sigma': 0.02, 'N': 101},\n        ],\n        # Case 2 (hidden bias in one path, small uncertainty)\n        [\n            {'a': 0.9, 'b': 0.0, 'c': 0.0, 'bias': 0.0, 'sigma': 0.01, 'N': 101},\n            {'a': 0.0, 'b': -0.2, 'c': 0.0, 'bias': 0.05, 'sigma': 0.01, 'N': 101},\n            {'a': 0.0, 'b': 0.0, 'c': -0.2, 'bias': 0.0, 'sigma': 0.01, 'N': 101},\n        ],\n        # Case 3 (same hidden bias but large uncertainty)\n        [\n            {'a': 0.9, 'b': 0.0, 'c': 0.0, 'bias': 0.0, 'sigma': 0.2, 'N': 101},\n            {'a': 0.0, 'b': -0.2, 'c': 0.0, 'bias': 0.05, 'sigma': 0.2, 'N': 101},\n            {'a': 0.0, 'b': 0.0, 'c': -0.2, 'bias': 0.0, 'sigma': 0.2, 'N': 101},\n        ],\n        # Case 4 (two-path cycle approximating forward and reverse, coarse sampling)\n        [\n            {'a': 0.6, 'b': -0.3, 'c': 0.1, 'bias': 0.0, 'sigma': 0.02, 'N': 3},\n            {'a': -0.6, 'b': 0.3, 'c': -0.1, 'bias': 0.01, 'sigma': 0.02, 'N': 3},\n        ],\n    ]\n\n    results = []\n    z_crit = 1.96\n\n    def integrate_path(g_func, sigma_val, N, bias):\n        \"\"\"\n        Numerically integrates a path and calculates its variance using Simpson's rule.\n\n        Args:\n            g_func (callable): The integrand function g(lambda).\n            sigma_val (float): The constant standard deviation.\n            N (int): The number of grid points.\n            bias (float): A constant bias to add to the integrand.\n\n        Returns:\n            tuple: A tuple containing the integral (delta_F) and its variance (var_delta_F).\n        \"\"\"\n        # Ensure N is odd for Simpson's rule, and N = 3\n        if N  3:\n            N = 3\n        if N % 2 == 0:\n            N += 1\n        \n        lambdas = np.linspace(0, 1, N)\n        delta_lambda = 1.0 / (N - 1)\n\n        # Evaluate the integrand and uncertainties at grid points\n        g_vals = g_func(lambdas) + bias\n        sigma_vals_sq = np.full_like(lambdas, sigma_val**2)\n\n        # Define Simpson's rule weights\n        weights = np.ones(N)\n        weights[1:-1:2] = 4.0\n        weights[2:-1:2] = 2.0\n        \n        # Calculate integral and variance\n        integral = (delta_lambda / 3.0) * np.sum(weights * g_vals)\n        variance = (delta_lambda / 3.0)**2 * np.sum(weights**2 * sigma_vals_sq)\n        \n        return integral, variance\n\n    for cycle_data in test_cases:\n        cycle_sum_S = 0.0\n        cycle_var_S = 0.0\n        \n        for path_data in cycle_data:\n            # Capture loop variables correctly in the lambda\n            g_func = lambda l, a=path_data['a'], b=path_data['b'], c=path_data['c']: a*l**2 + b*l + c\n            \n            delta_F, var_delta_F = integrate_path(\n                g_func=g_func,\n                sigma_val=path_data['sigma'],\n                N=path_data['N'],\n                bias=path_data['bias']\n            )\n            cycle_sum_S += delta_F\n            cycle_var_S += var_delta_F\n            \n        sigma_S = np.sqrt(cycle_var_S)\n        \n        # Handle case where uncertainty is zero\n        if sigma_S  1e-12:\n            z_score = cycle_sum_S / sigma_S\n        else:\n            z_score = 0.0 if np.abs(cycle_sum_S)  1e-12 else float('inf')\n\n        passed = abs(z_score) = z_crit\n        \n        # Format the result for this cycle\n        results.append(\n            f\"[{cycle_sum_S:.6f},{sigma_S:.6f},{z_score:.6f},{passed}]\"\n        )\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}