{
    "hands_on_practices": [
        {
            "introduction": "在将热力学积分（TI）应用于复杂的现实世界系统之前，通过一个简单且可解析求解的模型来验证其基本原理至关重要。本练习将引导您通过一个单粒子谐振子系统来实践这一点。您将用两种独立的方法推导自由能差：一种是通过沿耦合参数路径进行积分，另一种是通过直接计算配分函数，从而证明热力学积分的严谨性和有效性 ()。",
            "id": "3853853",
            "problem": "一个单粒子在一维空间中与温度为 $T$ 的热库耦合，处于正则系综中。其势能通过 $U(x;\\lambda)=\\frac{1}{2}k(\\lambda)x^{2}$ 依赖于一个耦合参数 $\\lambda \\in [0,1]$，其中 $k(\\lambda)$ 是一个光滑的、严格为正的函数，且满足 $k(0)=k_{0}>0$ 和 $k(1)=k_{1}>0$。假设动力学是经典的，并且动量自由度存在，但在考虑构型贡献时可以被积分掉。\n\n仅使用平衡统计力学的基本定义以及引入耦合参数作为热力学路径的概念，用两种独立的方法推导自由能差 $\\Delta F \\equiv F(\\lambda=1)-F(\\lambda=0)$：\n- 沿着耦合参数 $\\lambda$ 进行积分，以固定 $\\lambda$ 下的系综平均值的形式表示，并针对该系统在温度 $T$ 下进行评估。\n- 通过直接计算每个端点的构型正则配分函数，并求出相应亥姆霍兹自由能的差值。\n\n证明对于满足端点约束的任意光滑正函数 $k(\\lambda)$，两种方法得到的结果一致，并给出 $\\Delta F$ 作为 $k_{0}$、$k_{1}$、$k_{B}$ 和 $T$ 的闭式解析函数。不要代入数值。以 $k_{B}$ 和 $T$ 的解析表达式给出最终答案；最终表达式无需注明单位。",
            "solution": "所述问题具有科学依据，提法恰当，客观且自洽。它代表了平衡统计力学基本原理的一个标准应用。没有发现任何缺陷。因此，我们可以进行推导。\n\n系统在温度 $T$ 下的亥姆霍兹自由能 $F$ 由 $F = -k_{B} T \\ln Z$ 给出，其中 $k_B$ 是玻尔兹曼常数，$Z$ 是正则配分函数。对于一个哈密顿量为 $H(p,x) = \\frac{p^2}{2m} + U(x)$ 的一维单经典粒子，其配分函数为：\n$$Z = \\frac{1}{h} \\int_{-\\infty}^{\\infty} dp \\int_{-\\infty}^{\\infty} dx \\exp\\left(-\\frac{H(p,x)}{k_{B}T}\\right)$$\n在本问题中，势能 $U(x;\\lambda) = \\frac{1}{2}k(\\lambda)x^2$ 依赖于耦合参数 $\\lambda$。哈密顿量为 $H(p,x;\\lambda) = \\frac{p^2}{2m} + \\frac{1}{2}k(\\lambda)x^2$。配分函数 $Z(\\lambda)$ 可以分解为动能部分和构型部分：\n$$Z(\\lambda) = \\left(\\frac{1}{h} \\int_{-\\infty}^{\\infty} dp \\exp\\left(-\\frac{p^2}{2mk_{B}T}\\right)\\right) \\left(\\int_{-\\infty}^{\\infty} dx \\exp\\left(-\\frac{U(x;\\lambda)}{k_{B}T}\\right)\\right) = Z_{kin} Z_{c}(\\lambda)$$\n动能配分函数 $Z_{kin}$ 与 $\\lambda$ 无关。相应的自由能为 $F(\\lambda) = -k_{B}T \\ln(Z_{kin} Z_{c}(\\lambda)) = -k_{B}T\\ln Z_{kin} - k_{B}T\\ln Z_{c}(\\lambda) = F_{kin} + F_{c}(\\lambda)$。\n因此，自由能差 $\\Delta F$ 为：\n$$\\Delta F = F(\\lambda=1) - F(\\lambda=0) = (F_{kin} + F_{c}(1)) - (F_{kin} + F_{c}(0)) = F_{c}(1) - F_{c}(0)$$\n我们只需要考虑对自由能的构型贡献。令 $\\beta = (k_B T)^{-1}$。\n\n### 方法一：沿耦合参数积分\n\n自由能差可以通过对自由能关于耦合参数 $\\lambda$ 的导数进行积分来获得。这就是热力学积分方法。\n$$\\Delta F = \\int_{0}^{1} \\frac{\\partial F(\\lambda)}{\\partial \\lambda} d\\lambda$$\n我们首先计算 $F(\\lambda)$ (或等价地，$F_c(\\lambda)$) 的偏导数：\n$$\\frac{\\partial F_c(\\lambda)}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left(-k_{B}T \\ln Z_{c}(\\lambda)\\right) = -k_{B}T \\frac{1}{Z_{c}(\\lambda)} \\frac{\\partial Z_{c}(\\lambda)}{\\partial \\lambda}$$\n构型配分函数 $Z_{c}(\\lambda) = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) dx$ 的导数为：\n$$\\frac{\\partial Z_{c}(\\lambda)}{\\partial \\lambda} = \\int_{-\\infty}^{\\infty} \\frac{\\partial}{\\partial \\lambda} \\exp(-\\beta U(x;\\lambda)) dx = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) (-\\beta) \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} dx$$\n将此代入 $\\frac{\\partial F_c(\\lambda)}{\\partial \\lambda}$ 的表达式中：\n$$\\frac{\\partial F_c(\\lambda)}{\\partial \\lambda} = -k_{B}T \\frac{1}{Z_{c}(\\lambda)} \\int_{-\\infty}^{\\infty} \\left(-\\frac{1}{k_{B}T}\\right) \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} \\exp(-\\beta U(x;\\lambda)) dx = \\frac{\\int_{-\\infty}^{\\infty} \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} \\exp(-\\beta U(x;\\lambda)) dx}{\\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) dx}$$\n这是势能导数的正则系综平均的定义：\n$$\\frac{\\partial F(\\lambda)}{\\partial \\lambda} = \\left\\langle \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda}$$\n对于给定的势能 $U(x;\\lambda) = \\frac{1}{2}k(\\lambda)x^2$，其偏导数为：\n$$\\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} = \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} x^2$$\n因此，自由能的导数为：\n$$\\frac{\\partial F(\\lambda)}{\\partial \\lambda} = \\left\\langle \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} x^2 \\right\\rangle_{\\lambda} = \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} \\langle x^2 \\rangle_{\\lambda}$$\n这里，$\\langle x^2 \\rangle_{\\lambda}$ 是在温度 $T$ 下、弹簧常数为 $k(\\lambda)$ 的谐振子势中 $x^2$ 的系综平均值。这可以通过能量均分定理计算，该定理指出哈密顿量中的每个二次自由度对平均能量的贡献为 $\\frac{1}{2}k_{B}T$。势能是一个单独的二次项，因此 $\\langle U \\rangle = \\frac{1}{2}k(\\lambda)\\langle x^2 \\rangle_{\\lambda} = \\frac{1}{2}k_{B}T$。这给出：\n$$\\langle x^2 \\rangle_{\\lambda} = \\frac{k_{B}T}{k(\\lambda)}$$\n将此结果代回 $\\frac{\\partial F(\\lambda)}{\\partial \\lambda}$ 的表达式中：\n$$\\frac{\\partial F(\\lambda)}{\\partial \\lambda} = \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} \\left(\\frac{k_{B}T}{k(\\lambda)}\\right) = \\frac{k_{B}T}{2} \\frac{1}{k(\\lambda)} \\frac{dk(\\lambda)}{d\\lambda}$$\n现在，我们对 $\\lambda$ 从 $0$ 到 $1$ 进行积分：\n$$\\Delta F = \\int_{0}^{1} \\frac{k_{B}T}{2} \\frac{1}{k(\\lambda)} \\frac{dk(\\lambda)}{d\\lambda} d\\lambda$$\n该积分可以通过换元法求解，令 $u = k(\\lambda)$，则 $du = \\frac{dk}{d\\lambda} d\\lambda$。积分限从 $\\lambda=0, \\lambda=1$ 变为 $u=k(0)=k_0, u=k(1)=k_1$。\n$$\\Delta F = \\frac{k_{B}T}{2} \\int_{k_{0}}^{k_{1}} \\frac{1}{u} du = \\frac{k_{B}T}{2} [\\ln|u|]_{k_0}^{k_1}$$\n由于 $k(\\lambda)$ 是严格为正的，因此 $k_0 > 0$ 且 $k_1 > 0$，所以 $|u|=u$。\n$$\\Delta F = \\frac{k_{B}T}{2} (\\ln(k_1) - \\ln(k_0)) = \\frac{k_{B}T}{2} \\ln\\left(\\frac{k_1}{k_0}\\right)$$\n\n### 方法二：直接计算自由能\n\n在这种方法中，我们直接计算构型自由能 $F_c(\\lambda)$，然后计算差值 $\\Delta F = F_c(1) - F_c(0)$。我们首先计算构型配分函数 $Z_c(\\lambda)$。\n$$Z_{c}(\\lambda) = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{k(\\lambda)x^2}{2k_{B}T}\\right) dx$$\n这是一个形式为 $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\frac{\\pi}{a}}$ 的标准高斯积分。此处，$a = \\frac{k(\\lambda)}{2k_{B}T}$。\n$$Z_{c}(\\lambda) = \\sqrt{\\frac{\\pi}{k(\\lambda)/(2k_{B}T)}} = \\sqrt{\\frac{2\\pi k_{B}T}{k(\\lambda)}}$$\n现在，我们求构型自由能 $F_{c}(\\lambda) = -k_{B}T \\ln Z_{c}(\\lambda)$：\n$$F_{c}(\\lambda) = -k_{B}T \\ln\\left(\\left(\\frac{2\\pi k_{B}T}{k(\\lambda)}\\right)^{1/2}\\right) = -\\frac{1}{2}k_{B}T \\ln\\left(\\frac{2\\pi k_{B}T}{k(\\lambda)}\\right)$$\n利用对数的性质，我们可以写出：\n$$F_{c}(\\lambda) = -\\frac{1}{2}k_{B}T \\left( \\ln(2\\pi k_{B}T) - \\ln(k(\\lambda)) \\right) = \\frac{1}{2}k_{B}T \\ln(k(\\lambda)) - \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T)$$\n现在，我们可以计算在端点 $\\lambda=0$ 和 $\\lambda=1$ 处的自由能：\n$$F_{c}(\\lambda=1) = \\frac{1}{2}k_{B}T \\ln(k(1)) - \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T) = \\frac{1}{2}k_{B}T \\ln(k_1) - C$$\n$$F_{c}(\\lambda=0) = \\frac{1}{2}k_{B}T \\ln(k(0)) - \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T) = \\frac{1}{2}k_{B}T \\ln(k_0) - C$$\n其中 $C = \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T)$ 是一个与 $\\lambda$ 无关的常数。自由能差则为：\n$$\\Delta F = F_{c}(1) - F_{c}(0) = \\left(\\frac{1}{2}k_{B}T \\ln(k_1) - C\\right) - \\left(\\frac{1}{2}k_{B}T \\ln(k_0) - C\\right)$$\n$$\\Delta F = \\frac{1}{2}k_{B}T \\ln(k_1) - \\frac{1}{2}k_{B}T \\ln(k_0) = \\frac{k_{B}T}{2} \\ln\\left(\\frac{k_1}{k_0}\\right)$$\n\n### 结论\n两种方法都得出了相同的结果。这证明了自由能差的路径无关性，因为自由能是一个状态函数。结果仅取决于系统的初态和末态（分别由 $k_0$ 和 $k_1$ 表征），而与连接它们的具体光滑正函数 $k(\\lambda)$ 无关。自由能差的最终表达式是给定参数的闭式解析函数。",
            "answer": "$$\\boxed{\\frac{k_{B}T}{2}\\ln\\left(\\frac{k_{1}}{k_{0}}\\right)}$$"
        },
        {
            "introduction": "在实际的分子模拟中，热力学积分的被积函数 $\\langle \\partial U / \\partial \\lambda \\rangle$ 通常是通过数值方法估算的，这会引入系统偏差和统计误差。本练习旨在量化这些数值误差，特别是由于使用有限差分法来近似能量导数所带来的影响。通过分析一个谐振子模型，您将推导出并计算由有限步长引起的偏差和方差，从而深刻理解在TI计算中数值精度与计算成本之间的权衡 ()。",
            "id": "3853822",
            "problem": "考虑一个用于多尺度材料模拟中热力学积分（TI）的一维测试系统。TI 将自由能导数与正则系综中的系综平均值联系起来。目标是，在固定的构型空间坐标 $x$ 下，研究势能相对于耦合参数 $\\lambda$ 的导数的有限差分估计值与解析导数的比较，并量化在正则系综上平均时，由有限步长 $h$ 引入的偏差和方差。在整个计算中使用约化单位，其中玻尔兹曼常数 $k_B$ 等于 $1$，温度 $T$ 和能量 $U$ 均为无量纲量。\n\n该测试系统是一个一维谐振子，其势能为 $U(x;\\lambda) = \\frac{1}{2}\\,k(\\lambda)\\,x^2$，其中 $k(\\lambda)$ 是一个依赖于 $\\lambda$ 的刚度。系统在温度 $T$ 下处于热平衡状态，其正则系综概率密度与 $\\exp(-\\beta U(x;\\lambda))$ 成正比，其中逆温度 $\\beta = 1/(k_B T)$。\n\n在固定的参数值 $\\lambda$ 和有限步长 $h$ 下，将 $\\partial U/\\partial \\lambda$ 在固定 $x$ 处的中心有限差分估计量定义为\n$$\n\\mathrm{FD}(x;\\lambda,h) = \\frac{U(x;\\lambda+h) - U(x;\\lambda-h)}{2h}.\n$$\n令解析导数为\n$$\n\\mathrm{AD}(x;\\lambda) = \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda}.\n$$\n定义误差函数\n$$\ne(x;\\lambda,h) = \\mathrm{FD}(x;\\lambda,h) - \\mathrm{AD}(x;\\lambda).\n$$\n在固定 $\\lambda$ 的正则系综上，将由有限步长 $h$ 引起的有限差分估计量的偏差和方差定义为\n$$\nB(\\lambda,h) = \\mathbb{E}_{\\mathrm{can}}[\\,e(x;\\lambda,h)\\,], \\quad V(\\lambda,h) = \\mathrm{Var}_{\\mathrm{can}}[\\,e(x;\\lambda,h)\\,],\n$$\n其中 $\\mathbb{E}_{\\mathrm{can}}[\\cdot]$ 和 $\\mathrm{Var}_{\\mathrm{can}}[\\cdot]$ 表示在固定 $\\lambda$ 下相对于正则系综的期望和方差。\n\n仅从正则系综的定义和给定的 $U(x;\\lambda)$ 出发，推导 $B(\\lambda,h)$ 和 $V(\\lambda,h)$ 的闭式表达式，用 $k(\\lambda)$、其关于 $\\lambda$ 的导数、$h$ 和 $T$ 表示。然后，将这些表达式实现为一个完整的程序，为以下测试套件计算 $B(\\lambda,h)$ 和 $V(\\lambda,h)$：\n\n- 情况 1（对于二次刚度，预期偏差为零的边界情况）：\n  - $k(\\lambda) = k_0 + k_1 \\lambda + k_2 \\lambda^2$，其中 $k_0 = 7, k_1 = 4, k_2 = 3$。\n  - 参数：$\\lambda = 0.6$。\n  - 温度：$T = 1.5$。\n  - 步长：$h = 0.2$。\n\n- 情况 2（对于指数刚度，使用小步长）：\n  - $k(\\lambda) = k_0 \\exp(\\alpha \\lambda)$，其中 $k_0 = 5, \\alpha = 0.8$。\n  - 参数：$\\lambda = 0.3$。\n  - 温度：$T = 1.0$。\n  - 步长：$h = 0.001$。\n\n- 情况 3（对于相同的指数刚度，使用中等步长）：\n  - $k(\\lambda) = k_0 \\exp(\\alpha \\lambda)$，其中 $k_0 = 5, \\alpha = 0.8$。\n  - 参数：$\\lambda = 0.3$。\n  - 温度：$T = 1.0$。\n  - 步长：$h = 0.1$。\n\n- 情况 4（显示有限差分偏差敏感性的有理刚度）：\n  - $k(\\lambda) = \\dfrac{k_0}{1 - b \\lambda}$，其中 $k_0 = 10, b = 0.5$。\n  - 参数：$\\lambda = 0.5$。\n  - 温度：$T = 2.0$。\n  - 步长：$h = 0.05$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果是一个双元素列表 $[B,V]$，两个条目都四舍五入到八位小数。例如：$[[B_1,V_1],[B_2,V_2],[B_3,V_3],[B_4,V_4]]$。由于所有量都在约化单位下计算，请将数字报告为四舍五-入到八位小数的无量纲浮点数。",
            "solution": "在尝试解决方案之前，对问题进行验证。\n\n### 第 1 步：提取已知条件\n- **系统**：正则系综中的一维谐振子。\n- **势能**：$U(x;\\lambda) = \\frac{1}{2}\\,k(\\lambda)\\,x^2$。\n- **热力学状态**：固定温度 $T$。使用约化单位，其中玻尔兹曼常数 $k_B = 1$。逆温度为 $\\beta = 1/T$。\n- **概率密度**：$p(x;\\lambda) \\propto \\exp(-\\beta U(x;\\lambda))$。\n- **有限差分 (FD) 估计量**：$\\mathrm{FD}(x;\\lambda,h) = \\frac{U(x;\\lambda+h) - U(x;\\lambda-h)}{2h}$。\n- **解析导数 (AD)**：$\\mathrm{AD}(x;\\lambda) = \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda}$。\n- **误差函数**：$e(x;\\lambda,h) = \\mathrm{FD}(x;\\lambda,h) - \\mathrm{AD}(x;\\lambda)$。\n- **偏差**：$B(\\lambda,h) = \\mathbb{E}_{\\mathrm{can}}[\\,e(x;\\lambda,h)\\,]$。\n- **方差**：$V(\\lambda,h) = \\mathrm{Var}_{\\mathrm{can}}[\\,e(x;\\lambda,h)\\,]$。\n- **测试用例**：\n    1.  $k(\\lambda) = k_0 + k_1 \\lambda + k_2 \\lambda^2$，其中 $k_0 = 7, k_1 = 4, k_2 = 3$。参数：$\\lambda = 0.6, T = 1.5, h = 0.2$。\n    2.  $k(\\lambda) = k_0 \\exp(\\alpha \\lambda)$，其中 $k_0 = 5, \\alpha = 0.8$。参数：$\\lambda = 0.3, T = 1.0, h = 0.001$。\n    3.  $k(\\lambda) = k_0 \\exp(\\alpha \\lambda)$，其中 $k_0 = 5, \\alpha = 0.8$。参数：$\\lambda = 0.3, T = 1.0, h = 0.1$。\n    4.  $k(\\lambda) = \\dfrac{k_0}{1 - b \\lambda}$，其中 $k_0 = 10, b = 0.5$。参数：$\\lambda = 0.5, T = 2.0, h = 0.05$。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据**：该问题基于统计力学（正则系综、谐振子）和数值分析（有限差分）的基本原理。所有概念都是物理学和计算科学中的标准和公认概念。该问题在科学上是合理的。\n- **适定性**：该问题要求偏差和方差的闭式表达式，这可以从给定的定义中推导出来。对于 $k(\\lambda)>0$ 的谐振子，其正则系综是适定的（高斯分布），确保了所需的期望值存在且有限。该问题是适定的。\n- **客观性**：该问题使用精确、客观的数学语言陈述。没有主观或基于观点的元素。\n\n### 第 3 步：结论与行动\n该问题是有效的，因为它具有科学依据、适定性和客观性。将提供一个完整的、有理有据的解决方案。\n\n### 偏差和方差表达式的推导\n\n一维谐振子的势能由下式给出\n$$\nU(x;\\lambda) = \\frac{1}{2} k(\\lambda) x^2\n$$\n系统在温度 $T$ 下处于正则系综中。坐标 $x$ 的概率密度函数与 $\\exp(-\\beta U(x;\\lambda))$ 成正比，其中由于 $k_B=1$，$\\beta = 1/T$。\n$$\np(x;\\lambda) \\propto \\exp\\left(-\\frac{\\beta k(\\lambda) x^2}{2}\\right)\n$$\n这是一个零均值高斯分布。通过对所有 $x$ 积分找到归一化常数 $Z$：\n$$\nZ = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k(\\lambda) x^2}{2}\\right) dx = \\sqrt{\\frac{2\\pi}{\\beta k(\\lambda)}}\n$$\n归一化的概率密度为：\n$$\np(x;\\lambda) = \\sqrt{\\frac{\\beta k(\\lambda)}{2\\pi}} \\exp\\left(-\\frac{\\beta k(\\lambda) x^2}{2}\\right)\n$$\n这是一个均值为 $\\mu_x=0$、方差为 $\\sigma_x^2 = \\frac{1}{\\beta k(\\lambda)} = \\frac{T}{k(\\lambda)}$ 的高斯分布 $N(0, \\sigma_x^2)$。\n\n我们计算所需的该分布的矩为：\n$$\n\\mathbb{E}_{\\mathrm{can}}[x^2] = \\sigma_x^2 = \\frac{T}{k(\\lambda)}\n$$\n$$\n\\mathbb{E}_{\\mathrm{can}}[x^4] = 3(\\sigma_x^2)^2 = 3\\left(\\frac{T}{k(\\lambda)}\\right)^2\n$$\n$x^2$ 的方差则为：\n$$\n\\mathrm{Var}_{\\mathrm{can}}[x^2] = \\mathbb{E}_{\\mathrm{can}}[(x^2)^2] - (\\mathbb{E}_{\\mathrm{can}}[x^2])^2 = \\mathbb{E}_{\\mathrm{can}}[x^4] - (\\mathbb{E}_{\\mathrm{can}}[x^2])^2 = 3\\left(\\frac{T}{k(\\lambda)}\\right)^2 - \\left(\\frac{T}{k(\\lambda)}\\right)^2 = 2\\left(\\frac{T}{k(\\lambda)}\\right)^2\n$$\n接下来，我们表示误差函数 $e(x;\\lambda,h)$。解析导数为：\n$$\n\\mathrm{AD}(x;\\lambda) = \\frac{\\partial}{\\partial \\lambda} \\left(\\frac{1}{2} k(\\lambda) x^2\\right) = \\frac{1}{2} k'(\\lambda) x^2\n$$\n有限差分估计量为：\n$$\n\\mathrm{FD}(x;\\lambda,h) = \\frac{\\frac{1}{2}k(\\lambda+h)x^2 - \\frac{1}{2}k(\\lambda-h)x^2}{2h} = \\frac{1}{2} \\left[ \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} \\right] x^2\n$$\n误差函数为：\n$$\ne(x;\\lambda,h) = \\mathrm{FD}(x;\\lambda,h) - \\mathrm{AD}(x;\\lambda) = \\frac{1}{2} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right) x^2\n$$\n为简洁起見，我们定义一个与 $x$ 无关的项 $C(\\lambda,h)$：\n$$\nC(\\lambda,h) = \\frac{1}{2} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right)\n$$\n因此，$e(x;\\lambda,h) = C(\\lambda,h) x^2$。\n\n现在我们可以推导偏差 $B(\\lambda,h)$：\n$$\nB(\\lambda,h) = \\mathbb{E}_{\\mathrm{can}}[e(x;\\lambda,h)] = \\mathbb{E}_{\\mathrm{can}}[C(\\lambda,h) x^2] = C(\\lambda,h) \\mathbb{E}_{\\mathrm{can}}[x^2]\n$$\n代入 $C(\\lambda,h)$ 和 $\\mathbb{E}_{\\mathrm{can}}[x^2]$ 的表达式：\n$$\nB(\\lambda,h) = \\frac{1}{2} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right) \\frac{T}{k(\\lambda)}\n$$\n这就是偏差的闭式表达式。\n\n接下来，我们推导方差 $V(\\lambda,h)$：\n$$\nV(\\lambda,h) = \\mathrm{Var}_{\\mathrm{can}}[e(x;\\lambda,h)] = \\mathrm{Var}_{\\mathrm{can}}[C(\\lambda,h) x^2]\n$$\n对于常数 $a$，使用性质 $\\mathrm{Var}[aY] = a^2 \\mathrm{Var}[Y]$：\n$$\nV(\\lambda,h) = [C(\\lambda,h)]^2 \\mathrm{Var}_{\\mathrm{can}}[x^2]\n$$\n代入 $C(\\lambda,h)$ 和 $\\mathrm{Var}_{\\mathrm{can}}[x^2]$ 的表达式：\n$$\nV(\\lambda,h) = \\left[ \\frac{1}{2} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right) \\right]^2 \\cdot 2\\left(\\frac{T}{k(\\lambda)}\\right)^2\n$$\n我们可以注意到 $V$ 和 $B$ 之间的一个简单关系。从偏差表达式，我们可以写出：\n$$\nC(\\lambda,h) = \\frac{B(\\lambda,h)}{\\mathbb{E}_{\\mathrm{can}}[x^2]} = \\frac{B(\\lambda,h)}{T/k(\\lambda)}\n$$\n将此代入方差表达式中：\n$$\nV(\\lambda,h) = \\left( \\frac{B(\\lambda,h)}{T/k(\\lambda)} \\right)^2 \\cdot 2\\left(\\frac{T}{k(\\lambda)}\\right)^2 = 2 B(\\lambda,h)^2\n$$\n这个非常简单的关系式 $V(\\lambda,h) = 2B(\\lambda,h)^2$ 在这个特定系统中成立，因为误差函数 $e(x)$ 与 $x^2$ 成正比，并且位置 $x$ 服从高斯分布。\n\n### 测试用例的计算\n\n我们应用推导出的公式 $B(\\lambda,h) = \\frac{T}{2k(\\lambda)} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right)$ 和 $V(\\lambda,h) = 2B(\\lambda,h)^2$。\n\n- **情况 1**：$k(\\lambda) = 7 + 4\\lambda + 3\\lambda^2$。这是一个二次多项式。其导数为 $k'(\\lambda) = 4 + 6\\lambda$。已知中心差分公式对于最高二次的多项式是精确的。我们来验证一下：\n  $k(\\lambda+h) - k(\\lambda-h) = (7+4(\\lambda+h)+3(\\lambda+h)^2) - (7+4(\\lambda-h)+3(\\lambda-h)^2) = 4(2h)+3(4\\lambda h) = 2h(4+6\\lambda) = 2h k'(\\lambda)$。\n  因此，$\\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) = 0$。\n  这导致 $B_1 = 0$ 和 $V_1 = 2(0)^2=0$。\n\n- **情况 2**：$k(\\lambda) = 5 e^{0.8\\lambda}$，其中 $\\lambda=0.3, T=1.0, h=0.001$。\n  $k'(\\lambda) = 5 \\cdot 0.8 e^{0.8\\lambda} = 4 e^{0.8\\lambda}$。\n  让我们计算偏差公式中括号内的项：\n  $\\Delta = \\frac{5e^{0.8(\\lambda+h)} - 5e^{0.8(\\lambda-h)}}{2h} - 4e^{0.8\\lambda} = \\frac{5e^{0.8\\lambda}(e^{0.8h}-e^{-0.8h})}{2h} - 4e^{0.8\\lambda} = 5e^{0.8\\lambda}\\frac{\\sinh(0.8h)}{h} - 4e^{0.8\\lambda}$。\n  $B(\\lambda,h) = \\frac{T}{2 \\cdot 5e^{0.8\\lambda}} \\left( 5e^{0.8\\lambda}\\frac{\\sinh(0.8h)}{h} - 4e^{0.8\\lambda} \\right) = \\frac{T}{2} \\left( \\frac{\\sinh(0.8h)}{h} - 0.8 \\right)$。\n  对于 $T=1.0, \\alpha=0.8, h=0.001$：\n  $B_2 = \\frac{1.0}{2} \\left( \\frac{\\sinh(0.0008)}{0.001} - 0.8 \\right) \\approx 0.5 \\times (0.80000008533 - 0.8) \\approx 4.2667 \\times 10^{-8}$。\n  $V_2 = 2 B_2^2 \\approx 2 \\times (4.2667 \\times 10^{-8})^2 \\approx 3.64 \\times 10^{-15}$。\n\n- **情况 3**：与情况 2 相同的 $k(\\lambda)$，但 $h=0.1$。\n  对这个 $k(\\lambda)$ 使用简化的偏差公式：\n  $B_3 = \\frac{1.0}{2} \\left( \\frac{\\sinh(0.08)}{0.1} - 0.8 \\right) \\approx 0.5 \\times (0.8008533867 - 0.8) \\approx 0.000426693$。\n  $V_3 = 2 B_3^2 \\approx 2 \\times (0.000426693)^2 \\approx 3.6413 \\times 10^{-7}$。\n\n- **情况 4**：$k(\\lambda) = \\frac{10}{1-0.5\\lambda}$，其中 $\\lambda=0.5, T=2.0, h=0.05$。\n  $k'(\\lambda) = \\frac{10 \\cdot 0.5}{(1-0.5\\lambda)^2} = \\frac{5}{(1-0.5\\lambda)^2}$。\n  在 $\\lambda=0.5$ 时：\n  $k(0.5) = \\frac{10}{1-0.25} = \\frac{40}{3}$。\n  $k'(0.5) = \\frac{5}{(0.75)^2} = \\frac{80}{9}$。\n  $k(0.5+0.05) = k(0.55) = \\frac{10}{1-0.275} = \\frac{10}{0.725} = \\frac{400}{29}$。\n  $k(0.5-0.05) = k(0.45) = \\frac{10}{1-0.225} = \\frac{10}{0.775} = \\frac{400}{31}$。\n  有限差分项：$\\frac{k(0.55)-k(0.45)}{2h} = \\frac{400/29 - 400/31}{0.1} = 4000 \\left(\\frac{2}{899}\\right) = \\frac{8000}{899}$。\n  $B_4 = \\frac{2.0}{2 \\cdot (40/3)} \\left( \\frac{8000}{899} - \\frac{80}{9} \\right) = \\frac{3}{40} \\left( \\frac{72000-71920}{8091} \\right) = \\frac{3}{40} \\frac{80}{8091} = \\frac{6}{8091} = \\frac{2}{2697} \\approx 0.0007415647$。\n  $V_4 = 2 B_4^2 = 2 \\left(\\frac{2}{2697}\\right)^2 = \\frac{8}{7273809} \\approx 1.100003 \\times 10^{-6}$。\n现在实现一个程序来计算这些值并按规定格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the bias and variance of a finite-difference estimator for dU/dλ\n    for a 1D harmonic oscillator in the canonical ensemble.\n    \"\"\"\n\n    # Case 1: k(λ) = k0 + k1*λ + k2*λ^2\n    k1_func = lambda l, p: p['k0'] + p['k1']*l + p['k2']*l**2\n    k1_prime = lambda l, p: p['k1'] + 2*p['k2']*l\n    case1 = {\n        'k_func': k1_func, 'k_prime': k1_prime,\n        'params': {'k0': 7, 'k1': 4, 'k2': 3},\n        'lambda_val': 0.6, 'T': 1.5, 'h': 0.2\n    }\n\n    # Case 2  3: k(λ) = k0 * exp(α*λ)\n    k2_func = lambda l, p: p['k0'] * np.exp(p['alpha']*l)\n    k2_prime = lambda l, p: p['k0'] * p['alpha'] * np.exp(p['alpha']*l)\n    case2 = {\n        'k_func': k2_func, 'k_prime': k2_prime,\n        'params': {'k0': 5, 'alpha': 0.8},\n        'lambda_val': 0.3, 'T': 1.0, 'h': 0.001\n    }\n    case3 = {\n        'k_func': k2_func, 'k_prime': k2_prime,\n        'params': {'k0': 5, 'alpha': 0.8},\n        'lambda_val': 0.3, 'T': 1.0, 'h': 0.1\n    }\n\n    # Case 4: k(λ) = k0 / (1 - b*λ)\n    k4_func = lambda l, p: p['k0'] / (1 - p['b']*l)\n    k4_prime = lambda l, p: p['k0'] * p['b'] / (1 - p['b']*l)**2\n    case4 = {\n        'k_func': k4_func, 'k_prime': k4_prime,\n        'params': {'k0': 10, 'b': 0.5},\n        'lambda_val': 0.5, 'T': 2.0, 'h': 0.05\n    }\n\n    test_cases = [case1, case2, case3, case4]\n    \n    # List to hold the unformatted results\n    results_raw = []\n\n    for case in test_cases:\n        # Unpack case data\n        k_func = case['k_func']\n        k_prime = case['k_prime']\n        params = case['params']\n        lam = case['lambda_val']\n        T = case['T']\n        h = case['h']\n\n        # Derived formulas from the solution section\n        # B = (T / (2*k(λ))) * ( (k(λ+h) - k(λ-h))/(2h) - k'(λ) )\n        # V = 2 * B^2\n\n        k_lam = k_func(lam, params)\n        k_lam_plus_h = k_func(lam + h, params)\n        k_lam_minus_h = k_func(lam - h, params)\n        k_p_lam = k_prime(lam, params)\n\n        fd_term = (k_lam_plus_h - k_lam_minus_h) / (2 * h)\n        diff_term = fd_term - k_p_lam\n        \n        # The canonical ensemble is well-defined only for k(λ) > 0.\n        # The given parameters all satisfy this.\n        if k_lam == 0:\n            B = float('inf')\n            V = float('inf')\n        else:\n            B = (T / (2 * k_lam)) * diff_term\n            V = 2 * B**2\n        \n        results_raw.append([B, V])\n\n    # Format the final output string as per requirements.\n    # Each number must be represented as a float rounded to eight decimal places.\n    # Manual string construction is necessary to ensure fixed-point format\n    # and avoid scientific notation for small numbers.\n    formatted_pairs = []\n    for B_val, V_val in results_raw:\n        formatted_pairs.append(f\"[{B_val:.8f},{V_val:.8f}]\")\n    \n    final_output_string = f\"[{','.join(formatted_pairs)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "热力学积分的一个核心假设是系统在沿 $\\lambda$ 路径变化时始终处于平衡态。然而，在存在高能垒和亚稳态的复杂系统中，这个假设很容易被打破，导致计算结果出现“滞后”现象。本练习将指导您设计并分析一个滞后测试，通过比较正向和反向 $\\lambda$ 路径上的积分结果，来诊断和量化亚稳态的存在及其对自由能计算的影响 ()。这是一种评估TI计算可靠性的关键诊断技术。",
            "id": "3853839",
            "problem": "要求您在多尺度材料模拟的背景下，实现并分析一种用于热力学积分（TI）的滞后测试。其基本原理是通过正则配分函数 $Z(\\lambda)$、亥姆霍兹自由能 $F(\\lambda)=-k_{\\mathrm{B}}T\\ln Z(\\lambda)$ 以及对参数化哈密顿量的基本微积分运算来进行的平衡统计力学描述。控制参数是一个无量纲的耦合坐标 $\\lambda\\in[0,1]$，它调节一个具有两个亚稳态的系统的哈密顿量，这些亚稳态的占据情况取决于 $\\lambda$。广义力是势能对控制参数导数的系综平均，记为 $\\left\\langle \\partial U / \\partial \\lambda \\right\\rangle_{\\lambda}$。在滞后测试中，我们分别沿着前向路径（$\\lambda:0\\to 1$）和反向路径（$\\lambda:1\\to 0$）测量此广义力。亚稳态和采样势垒的存在意味着路径依赖性：前向和反向路径测得的广义力曲线可能会不同，从而导致积分得到的自由能差也不同。\n\n为了本问题的目的，我们将广义力曲线建模为一个平滑基线，并附加一个S型切换贡献项，以模拟亚稳态跃迁：\n- 基线贡献：$g_{\\mathrm{base}}(\\lambda)=a\\sin(2\\pi \\lambda)+b\\lambda$。\n- 切换函数：$L(\\lambda;\\lambda_{c},w)=\\dfrac{1}{1+e^{-(\\lambda-\\lambda_{c})/w}}$，其中 $\\lambda_{c}$ 是跃迁的中心，而 $w$ 控制跃迁的锐度。\n- 前向广义力：$g_{\\mathrm{fwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}}\\right)$。\n- 反向广义力：$g_{\\mathrm{bwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}}\\right)$。\n\n切换参数 $\\lambda_{c}^{\\mathrm{fwd}}$、$\\lambda_{c}^{\\mathrm{bwd}}$、$w^{\\mathrm{fwd}}$ 和 $w^{\\mathrm{bwd}}$ 编码了滞后信息。$\\lambda_{c}^{\\mathrm{fwd}}$ 和 $\\lambda_{c}^{\\mathrm{bwd}}$ 之间的较大分离以及较小的 $w$ 值表明存在强亚稳态和采样势垒。\n\n任务：\n1. 从 $F(\\lambda)=-k_{\\mathrm{B}}T\\ln Z(\\lambda)$ 和广义力的定义出发，推导通过沿控制参数积分广义力来计算 $\\lambda=0$ 和 $\\lambda=1$ 之间自由能差 $\\Delta F$ 的数值方法。对前向路径和反向路径分别实现此计算。所有自由能差均以 $k_{\\mathrm{B}}T$ 的倍数表示（无量纲）。\n2. 通过计算有符号差值 $H=\\Delta F_{\\mathrm{fwd}}-\\Delta F_{\\mathrm{bwd}}$ 和路径差异面积 $A=\\int_{0}^{1}\\left|g_{\\mathrm{fwd}}(\\lambda)-g_{\\mathrm{bwd}}(\\lambda)\\right|\\,\\mathrm{d}\\lambda$ 来量化滞后效应，两者均以 $k_{\\mathrm{B}}T$ 为单位（无量纲）。\n3. 定义一个布尔标志来表示亚稳态：$\\mathrm{MS}=\\left(|H|\\tau_{H}\\right)\\vee\\left(A\\tau_{A}\\right)$，其中 $\\tau_{H}$ 和 $\\tau_{A}$ 是用户指定的阈值（以 $k_{\\mathrm{B}}T$ 为单位，无量纲）。\n\n数值要求：\n- 使用一个包含 $N$ 个点的均匀网格，覆盖 $\\lambda\\in[0,1]$，其中 $N$为奇数，以便应用复合辛普森法则。设网格间距为 $h=\\left(1-0\\right)/(N-1)$。\n- 对所有积分使用复合辛普森法则以确保准确性。不存在随机噪声；所有函数都是确定且平滑的。\n- 报告所有浮点数结果，四舍五入到六位小数。\n\n测试套件：\n为以下参数集计算输出，每个参数集指定为 $\\left(a,b,c,\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}},\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}},N,\\tau_{H},\\tau_{A}\\right)$：\n- 情况1（无滞后，理想路径）：$\\left(0.5,0.4,1.2,0.5,0.1,0.5,0.1,20001,0.01,0.05\\right)$。\n- 情况2（轻度滞后）：$\\left(0.4,0.6,1.0,0.4,0.08,0.6,0.08,20001,0.01,0.05\\right)$。\n- 情况3（强亚稳态伴随急剧切换）：$\\left(0.3,0.2,2.5,0.2,0.02,0.8,0.02,20001,0.05,0.10\\right)$。\n- 情况4（邻近边界的切换）：$\\left(0.2,0.1,1.5,0.05,0.03,0.95,0.03,20001,0.02,0.08\\right)$。\n\n程序输出格式：\n- 对每种情况，输出一个列表 $\\left[\\Delta F_{\\mathrm{fwd}},\\Delta F_{\\mathrm{bwd}},H,A,\\mathrm{MS}\\right]$，其中 $\\Delta F_{\\mathrm{fwd}}$、$\\Delta F_{\\mathrm{bwd}}$、$H$ 和 $A$ 为四舍五入到六位小数的浮点数，$\\mathrm{MS}$ 为布尔值。将所有四种情况的结果汇总到一行，作为一个用方括号括起来的逗号分隔列表，即 $\\left[\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right]\\right]$。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n### 步骤 1：提取已知信息\n\n- **问题领域**：基于平衡统计力学的多尺度材料模拟中用于计算自由能差的热力学积分（TI）。\n- **基本关系**：\n    - 正则配分函数：$Z(\\lambda)$。\n    - 亥姆霍兹自由能：$F(\\lambda)=-k_{\\mathrm{B}}T\\ln Z(\\lambda)$。\n    - 控制参数：$\\lambda \\in [0,1]$。\n    - 广义力：$\\left\\langle \\partial U / \\partial \\lambda \\right\\rangle_{\\lambda}$。\n- **滞后测试流程**：沿前向路径（$\\lambda: 0 \\to 1$）和反向路径（$\\lambda: 1 \\to 0$）测量广义力。\n- **广义力的模型函数**：\n    - 基线贡献：$g_{\\mathrm{base}}(\\lambda)=a\\sin(2\\pi \\lambda)+b\\lambda$。\n    - 切换函数：$L(\\lambda;\\lambda_{c},w)=\\dfrac{1}{1+e^{-(\\lambda-\\lambda_{c})/w}}$。\n    - 前向广义力：$g_{\\mathrm{fwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}}\\right)$。\n    - 反向广义力：$g_{\\mathrm{bwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}}\\right)$。\n- **任务**：\n    1. 推导并实现数值方法，通过对前向和反向路径积分来计算自由能差 $\\Delta F = F(1) - F(0)$，结果以 $k_{\\mathrm{B}}T$ 的倍数表示。\n    2. 通过计算有符号差 $H=\\Delta F_{\\mathrm{fwd}}-\\Delta F_{\\mathrm{bwd}}$ 和路径差异面积 $A=\\int_{0}^{1}\\left|g_{\\mathrm{fwd}}(\\lambda)-g_{\\mathrm{bwd}}(\\lambda)\\right|\\,\\mathrm{d}\\lambda$ 来量化滞后效应，两者均以 $k_{\\mathrm{B}}T$ 为单位（无量纲）。\n    3. 定义一个布尔标志来表示亚稳态：$\\mathrm{MS}=\\left(|H|\\tau_{H}\\right)\\vee\\left(A\\tau_{A}\\right)$。\n- **数值要求**：\n    - 网格：$\\lambda \\in [0,1]$ 上的均匀网格，包含 $N$ 个点，其中 $N$ 为奇数。\n    - 积分方法：对所有积分使用复合辛普森法则。\n    - 精度：报告浮点数结果，四舍五入到六位小数。\n- **测试套件**：参数集 $\\left(a,b,c,\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}},\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}},N,\\tau_{H},\\tau_{A}\\right)$：\n    - 情况1：$\\left(0.5,0.4,1.2,0.5,0.1,0.5,0.1,20001,0.01,0.05\\right)$。\n    - 情况2：$\\left(0.4,0.6,1.0,0.4,0.08,0.6,0.08,20001,0.01,0.05\\right)$。\n    - 情况3：$\\left(0.3,0.2,2.5,0.2,0.02,0.8,0.02,20001,0.05,0.10\\right)$。\n    - 情况4：$\\left(0.2,0.1,1.5,0.05,0.03,0.95,0.03,20001,0.02,0.08\\right)$。\n\n### 步骤 2：使用提取的已知信息进行验证\n\n根据验证标准对问题进行评估。\n\n- **科学依据**：该问题基于统计力学的基本原理，特别是自由能与配分函数之间的关系，及其在热力学积分中的应用，这是一种在计算物理和化学中广泛使用的标准技术。使用S型函数来模拟状态跃迁是一种常见且恰当的唯象方法。该问题在科学上是合理的。\n- **适定性**：该问题提供了明确的、确定性的数学函数和清晰的任务集。所有参数都已定义，数值方法和输出要求也已明确规定。这种结构确保了每个测试用例都存在唯一、稳定且有意义的解。\n- **客观性**：该问题以精确、定量的术语陈述，不含主观性语言或基于观点的论断。\n- **完备性与一致性**：该问题是自洽的。所有必要信息，包括函数形式、测试用例的参数以及数值规格，都已提供。内部没有矛盾。例如，要求 $N$ 为奇数与在区间上应用复合辛普森法则是相符的。\n- **现实性**：该设置模拟了分子模拟中的一个常见场景，其中滞后现象表明亚稳态之间存在采样不足或动力学捕获。参数和函数形式是对这样一个系统的合理表示。任务本身代表了一个标准的分析协议。\n- **无其他缺陷**：该问题不是隐喻性的、琐碎的、同义反复的或不可证伪的。它要求将微积分和数值方法具体地、非平凡地应用于一个有物理动机的模型。\n\n### 步骤 3：结论与行动\n\n该问题是**有效的**。它在科学上合理，具有适定性和完备性。可以构建一个严谨的解决方案。\n\n---\n\n### 解法\n\n解决方案的制定首先建立理论基础，然后定义要计算的量，最后概述数值实现方法。\n\n**1. 热力学积分的理论基础**\n\n亥姆霍兹自由能 $F$ 与系统在温度 $T$ 下的正则配分函数 $Z$ 通过以下关系式相联系：\n$$\nF(\\lambda) = -k_{\\mathrm{B}}T \\ln Z(\\lambda)\n$$\n其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$\\lambda$ 是一个连续变换系统势能 $U(\\lambda)$ 的参数。对于一个具有位置 $\\mathbf{r}$ 的经典粒子系统，其配分函数由下式给出：\n$$\nZ(\\lambda) = \\int e^{-U(\\mathbf{r}; \\lambda)/(k_{\\mathrm{B}}T)} d\\mathbf{r}\n$$\n（忽略了动能项，因为假设它们与 $\\lambda$ 无关）。\n\n为了求得自由能相对于 $\\lambda$ 的变化，我们对 $F(\\lambda)$ 求导：\n$$\n\\frac{dF}{d\\lambda} = -k_{\\mathrm{B}}T \\frac{1}{Z(\\lambda)} \\frac{dZ}{d\\lambda}\n$$\n配分函数的导数是：\n$$\n\\frac{dZ}{d\\lambda} = \\int \\left( -\\frac{1}{k_{\\mathrm{B}}T} \\frac{\\partial U(\\mathbf{r}; \\lambda)}{\\partial \\lambda} \\right) e^{-U(\\mathbf{r}; \\lambda)/(k_{\\mathrm{B}}T)} d\\mathbf{r}\n$$\n将其代回，我们得到：\n$$\n\\frac{dF}{d\\lambda} = -k_{\\mathrm{B}}T \\frac{1}{Z(\\lambda)} \\int \\left( -\\frac{1}{k_{\\mathrm{B}}T} \\frac{\\partial U}{\\partial \\lambda} \\right) e^{-U/(k_{\\mathrm{B}}T)} d\\mathbf{r} = \\frac{\\int \\frac{\\partial U}{\\partial \\lambda} e^{-U/(k_{\\mathrm{B}}T)} d\\mathbf{r}}{\\int e^{-U/(k_{\\mathrm{B}}T)} d\\mathbf{r}}\n$$\n根据定义，等式右边是势能对 $\\lambda$ 导数的正则系综平均。这就是广义力 $g(\\lambda)$：\n$$\n\\frac{dF}{d\\lambda} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} = g(\\lambda)\n$$\n通过微积分基本定理对该导数进行积分，可以得到状态在 $\\lambda=1$ 和 $\\lambda=0$ 之间的总自由能差：\n$$\n\\Delta F = F(1) - F(0) = \\int_{0}^{1} \\frac{dF}{d\\lambda} d\\lambda = \\int_{0}^{1} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} d\\lambda\n$$\n问题要求结果以 $k_{\\mathrm{B}}T$ 的无量纲单位表示。因此，我们计算：\n$$\n\\frac{\\Delta F}{k_{\\mathrm{B}}T} = \\int_{0}^{1} \\frac{1}{k_{\\mathrm{B}}T} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} d\\lambda\n$$\n给定的函数 $g_{\\mathrm{fwd}}(\\lambda)$ 和 $g_{\\mathrm{bwd}}(\\lambda)$ 被指定为无量纲的，这与它们代表量 $\\frac{1}{k_{\\mathrm{B}}T} \\langle \\frac{\\partial U}{\\partial \\lambda} \\rangle_{\\lambda}$ 是一致的。\n\n**2. 滞后分析与量化指标**\n\n在物理模拟中，当 $\\lambda$ 以有限速率变化时，系统可能无法保持平衡。测得的广义力将取决于所走的路径。前向路径（$\\lambda: 0 \\to 1$）产生自由能差的估计值 $\\Delta F_{\\mathrm{fwd}}$。反向路径（$\\lambda: 1 \\to 0$）产生一个功值，可用于估计相同的自由能差 $\\Delta F_{\\mathrm{bwd}}$。为确保对量 $F(1)-F(0)$ 进行一致的比较，两个估计值都计算为从 $\\lambda=0$ 到 $\\lambda=1$ 的积分：\n$$\n\\Delta F_{\\mathrm{fwd}} = \\int_{0}^{1} g_{\\mathrm{fwd}}(\\lambda) d\\lambda\n$$\n$$\n\\Delta F_{\\mathrm{bwd}} = \\int_{0}^{1} g_{\\mathrm{bwd}}(\\lambda) d\\lambda\n$$\n请注意，反向路径估计的积分仍然是在 $[0, 1]$ 上进行的，代表 $-W_{1\\to 0}$，这是对 $\\Delta F_{0\\to 1}$ 的一个估计。\n\n滞后程度由两个指标量化：\n1.  **有符号差（$H$）**：前向和反向自由能估计值之间的差。这代表了两条曲线所包围的净面积。\n    $$\n    H = \\Delta F_{\\mathrm{fwd}} - \\Delta F_{\\mathrm{bwd}} = \\int_{0}^{1} \\left( g_{\\mathrm{fwd}}(\\lambda) - g_{\\mathrm{bwd}}(\\lambda) \\right) d\\lambda\n    $$\n2.  **路径差异面积（$A$）**：前向和反向力曲线之间的总面积。它量化了总差异，不考虑符号。\n    $$\n    A = \\int_{0}^{1} | g_{\\mathrm{fwd}}(\\lambda) - g_{\\mathrm{bwd}}(\\lambda) | d\\lambda\n    $$\n对于给定的问题，由于 $\\lambda_{c}^{\\mathrm{fwd}} \\le \\lambda_{c}^{\\mathrm{bwd}}$ 且逻辑斯谛函数 $L(\\lambda; \\lambda_{c}, w)$ 是 $\\lambda_c$ 的单调递减函数，因此对于所有 $\\lambda \\in [0,1]$ 都有 $g_{\\mathrm{fwd}}(\\lambda) \\ge g_{\\mathrm{bwd}}(\\lambda)$（假设 $c0$，在所有测试用例中均为真）。因此，在这些情况下，$H=A$。\n\n最后，如果这两个指标中的任何一个超过了预定义的阈值，系统就会被标记为具有显著的亚稳态：\n$$\n\\mathrm{MS} = (|H|  \\tau_{H}) \\vee (A  \\tau_{A})\n$$\n\n**3. 数值实现**\n\n计算过程按照规定使用复合辛普森法则进行数值计算。\n1.  对每个测试用例，在区间 $[0, 1]$ 上创建一个包含 $N$ 个点的均匀 $\\lambda$ 网格。网格间距为 $h=1/(N-1)$。选择 $N$ 为奇数，以确保区间数量为偶数，这是该法则的要求。\n2.  在 $\\lambda$ 网格的每个点上计算函数 $g_{\\mathrm{fwd}}(\\lambda)$ 和 $g_{\\mathrm{bwd}}(\\lambda)$ 的值，得到两个函数值数组。\n3.  通过对相应的函数值数组应用复合辛普森法则，计算 $\\Delta F_{\\mathrm{fwd}}$、$\\Delta F_{\\mathrm{bwd}}$ 和 $A$ 的定积分。`scipy.integrate.simpson` 函数提供了该法则的高效且准确的实现。\n4.  通过对 $g_{\\mathrm{fwd}}$ 值进行积分来计算 $\\Delta F_{\\mathrm{fwd}}$。\n5.  通过对 $g_{\\mathrm{bwd}}$ 值进行积分来计算 $\\Delta F_{\\mathrm{bwd}}$。\n6.  $H$ 作为简单差值计算：$H = \\Delta F_{\\mathrm{fwd}} - \\Delta F_{\\mathrm{bwd}}$。\n7.  在网格上计算 $A$ 的被积函数为 $|g_{\\mathrm{fwd}} - g_{\\mathrm{bwd}}|$，然后对这个新数组进行积分得到 $A$。\n8.  使用计算出的 $H$ 和 $A$ 以及给定的阈值 $\\tau_H$ 和 $\\tau_A$ 来评估布尔标志 $\\mathrm{MS}$。\n9.  所有浮点结果（$\\Delta F_{\\mathrm{fwd}}, \\Delta F_{\\mathrm{bwd}}, H, A$）都四舍五入到六位小数。每个案例的结果被编译成指定的列表格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import simpson\n\ndef solve():\n    \"\"\"\n    Implements and analyzes a hysteresis test for Thermodynamic Integration (TI).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (a, b, c, l_c_fwd, w_fwd, l_c_bwd, w_bwd, N, tau_H, tau_A)\n    test_cases = [\n        (0.5, 0.4, 1.2, 0.5, 0.1, 0.5, 0.1, 20001, 0.01, 0.05),\n        (0.4, 0.6, 1.0, 0.4, 0.08, 0.6, 0.08, 20001, 0.01, 0.05),\n        (0.3, 0.2, 2.5, 0.2, 0.02, 0.8, 0.02, 20001, 0.05, 0.10),\n        (0.2, 0.1, 1.5, 0.05, 0.03, 0.95, 0.03, 20001, 0.02, 0.08),\n    ]\n\n    all_results = []\n\n    def g_base(lam, a, b):\n        \"\"\"Baseline contribution to the generalized force.\"\"\"\n        return a * np.sin(2 * np.pi * lam) + b * lam\n\n    def L_func(lam, lam_c, w):\n        \"\"\"Sigmoidal switching function (logistic function).\"\"\"\n        # Add a small epsilon to the denominator of the exponent to avoid division by zero if w=0\n        # Although problem cases have w > 0, this is good practice.\n        w_safe = w if w != 0 else 1e-9\n        return 1.0 / (1.0 + np.exp(-(lam - lam_c) / w_safe))\n\n    for case in test_cases:\n        a, b, c, l_c_fwd, w_fwd, l_c_bwd, w_bwd, N, tau_H, tau_A = case\n\n        # 1. Create a uniform grid for lambda from 0 to 1 with N points.\n        lambda_grid = np.linspace(0.0, 1.0, N)\n\n        # 2. Evaluate the generalized force functions on the grid.\n        g_base_vals = g_base(lambda_grid, a, b)\n        \n        g_fwd_vals = g_base_vals + c * L_func(lambda_grid, l_c_fwd, w_fwd)\n        g_bwd_vals = g_base_vals + c * L_func(lambda_grid, l_c_bwd, w_bwd)\n\n        # 3. Compute free energy differences using composite Simpson's rule.\n        # Scipy's simpson function takes the y-values and the x-values (the grid).\n        delta_F_fwd = simpson(y=g_fwd_vals, x=lambda_grid)\n        delta_F_bwd = simpson(y=g_bwd_vals, x=lambda_grid)\n\n        # 4. Quantify hysteresis.\n        # H is the signed difference of the integrated free energies.\n        H = delta_F_fwd - delta_F_bwd\n        \n        # A is the integral of the absolute difference of the force curves.\n        g_diff_vals = np.abs(g_fwd_vals - g_bwd_vals)\n        A = simpson(y=g_diff_vals, x=lambda_grid)\n\n        # 5. Determine the metastability flag.\n        MS = (np.abs(H) > tau_H) or (A > tau_A)\n\n        # 6. Format the results for the current case.\n        # Round floats to six decimal places, MS is a boolean.\n        case_result = [\n            round(delta_F_fwd, 6),\n            round(delta_F_bwd, 6),\n            round(H, 6),\n            round(A, 6),\n            MS\n        ]\n        all_results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # Use a custom string representation for the list of lists.\n    result_str = \",\".join([str(res).replace(\"'\", \"\") for res in all_results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        }
    ]
}