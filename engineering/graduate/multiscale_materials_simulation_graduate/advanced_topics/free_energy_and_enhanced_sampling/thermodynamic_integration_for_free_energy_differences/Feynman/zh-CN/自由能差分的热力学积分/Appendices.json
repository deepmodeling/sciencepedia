{
    "hands_on_practices": [
        {
            "introduction": "本实践旨在巩固您对热力学积分（TI）公式的理解。我们将把该公式应用于一个简单的一维谐振子系统，该系统的自由能差可以被精确解析计算。通过证明TI方法与直接解析计算得到相同的结果 ，我们将验证TI框架的正确性，并将抽象的公式与具体、可验证的结果联系起来。",
            "id": "3853853",
            "problem": "一个处于一维空间中的单粒子与温度为 $T$ 的热库耦合，构成正则系综。其势能通过 $U(x;\\lambda)=\\frac{1}{2}k(\\lambda)x^{2}$ 依赖于一个耦合参数 $\\lambda \\in [0,1]$，其中 $k(\\lambda)$ 是一个光滑的严格正函数，满足 $k(0)=k_{0}>0$ 和 $k(1)=k_{1}>0$。假设动力学是经典的，并且动量自由度存在，但在考虑构型贡献时可以被积分掉。\n\n仅使用平衡统计力学的基本定义以及将耦合参数引入作为热力学路径的概念，用两种独立的方法推导自由能差 $\\Delta F \\equiv F(\\lambda=1)-F(\\lambda=0)$：\n- 通过沿耦合参数 $\\lambda$ 积分，结果用固定 $\\lambda$ 下的系综平均值表示，并针对该系统在温度 $T$ 下进行计算。\n- 通过直接计算每个端点的构型正则配分函数，并求出相应的亥姆霍兹自由能之差。\n\n证明对于满足端点约束的任意光滑正函数 $k(\\lambda)$，两种方法得到的结果一致，并以 $k_{0}$、$k_{1}$、$k_{B}$ 和 $T$ 的闭式解析函数形式给出 $\\Delta F$ 的最终表达式。不要代入数值。最终答案需以 $k_{B}$ 和 $T$ 的解析表达式形式给出；最终表达式无需指明单位。",
            "solution": "所述问题在科学上是合理的、适定的、客观的且自洽的。它代表了平衡统计力学基本原理的一个标准应用。未发现任何缺陷。因此，我们可以进行推导。\n\n一个系统在温度 $T$ 下的亥姆霍兹自由能 $F$ 由 $F = -k_{B} T \\ln Z$ 给出，其中 $k_B$ 是玻尔兹曼常数，$Z$ 是正则配分函数。对于一个一维单经典粒子，其哈密顿量为 $H(p,x) = \\frac{p^2}{2m} + U(x)$，其配分函数为：\n$$Z = \\frac{1}{h} \\int_{-\\infty}^{\\infty} dp \\int_{-\\infty}^{\\infty} dx \\exp\\left(-\\frac{H(p,x)}{k_{B}T}\\right)$$\n在本问题中，势能 $U(x;\\lambda) = \\frac{1}{2}k(\\lambda)x^2$ 依赖于耦合参数 $\\lambda$。哈密顿量为 $H(p,x;\\lambda) = \\frac{p^2}{2m} + \\frac{1}{2}k(\\lambda)x^2$。配分函数 $Z(\\lambda)$ 可以分解为动能和构型两部分：\n$$Z(\\lambda) = \\left(\\frac{1}{h} \\int_{-\\infty}^{\\infty} dp \\exp\\left(-\\frac{p^2}{2mk_{B}T}\\right)\\right) \\left(\\int_{-\\infty}^{\\infty} dx \\exp\\left(-\\frac{U(x;\\lambda)}{k_{B}T}\\right)\\right) = Z_{kin} Z_{c}(\\lambda)$$\n动能配分函数 $Z_{kin}$ 与 $\\lambda$ 无关。相应的自由能为 $F(\\lambda) = -k_{B}T \\ln(Z_{kin} Z_{c}(\\lambda)) = -k_{B}T\\ln Z_{kin} - k_{B}T\\ln Z_{c}(\\lambda) = F_{kin} + F_{c}(\\lambda)$。\n因此，自由能差 $\\Delta F$ 为：\n$$\\Delta F = F(\\lambda=1) - F(\\lambda=0) = (F_{kin} + F_{c}(1)) - (F_{kin} + F_{c}(0)) = F_{c}(1) - F_{c}(0)$$\n我们只需要考虑自由能的构型贡献。令 $\\beta = (k_B T)^{-1}$。\n\n### 方法一：沿耦合参数积分\n\n自由能差可以通过对自由能关于耦合参数 $\\lambda$ 的导数进行积分得到。这即是热力学积分方法。\n$$\\Delta F = \\int_{0}^{1} \\frac{\\partial F(\\lambda)}{\\partial \\lambda} d\\lambda$$\n我们首先计算 $F(\\lambda)$（或等效地，$F_c(\\lambda)$）的偏导数：\n$$\\frac{\\partial F_c(\\lambda)}{\\partial \\lambda} = \\frac{\\partial}{\\partial \\lambda} \\left(-k_{B}T \\ln Z_{c}(\\lambda)\\right) = -k_{B}T \\frac{1}{Z_{c}(\\lambda)} \\frac{\\partial Z_{c}(\\lambda)}{\\partial \\lambda}$$\n构型配分函数 $Z_{c}(\\lambda) = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) dx$ 的导数为：\n$$\\frac{\\partial Z_{c}(\\lambda)}{\\partial \\lambda} = \\int_{-\\infty}^{\\infty} \\frac{\\partial}{\\partial \\lambda} \\exp(-\\beta U(x;\\lambda)) dx = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) (-\\beta) \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} dx$$\n将此代入 $\\frac{\\partial F_c(\\lambda)}{\\partial \\lambda}$ 的表达式中：\n$$\\frac{\\partial F_c(\\lambda)}{\\partial \\lambda} = -k_{B}T \\frac{1}{Z_{c}(\\lambda)} \\int_{-\\infty}^{\\infty} \\left(-\\frac{1}{k_{B}T}\\right) \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} \\exp(-\\beta U(x;\\lambda)) dx = \\frac{\\int_{-\\infty}^{\\infty} \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} \\exp(-\\beta U(x;\\lambda)) dx}{\\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) dx}$$\n这是势能导数的正则系综平均的定义：\n$$\\frac{\\partial F(\\lambda)}{\\partial \\lambda} = \\left\\langle \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} \\right\\rangle_{\\lambda}$$\n对于给定的势能 $U(x;\\lambda) = \\frac{1}{2}k(\\lambda)x^2$，其偏导数为：\n$$\\frac{\\partial U(x;\\lambda)}{\\partial \\lambda} = \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} x^2$$\n因此，自由能的导数为：\n$$\\frac{\\partial F(\\lambda)}{\\partial \\lambda} = \\left\\langle \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} x^2 \\right\\rangle_{\\lambda} = \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} \\langle x^2 \\rangle_{\\lambda}$$\n此处，$\\langle x^2 \\rangle_{\\lambda}$ 是在温度 $T$ 下、弹簧常数为 $k(\\lambda)$ 的谐振子势中 $x^2$ 的系综平均值。这可以根据能量均分定理计算，该定理指出哈密顿量中的每个二次自由度对平均能量的贡献为 $\\frac{1}{2}k_{B}T$。势能是一个单独的二次项，因此 $\\langle U \\rangle = \\frac{1}{2}k(\\lambda)\\langle x^2 \\rangle_{\\lambda} = \\frac{1}{2}k_{B}T$。由此可得：\n$$\\langle x^2 \\rangle_{\\lambda} = \\frac{k_{B}T}{k(\\lambda)}$$\n将此结果代回 $\\frac{\\partial F(\\lambda)}{\\partial \\lambda}$ 的表达式中：\n$$\\frac{\\partial F(\\lambda)}{\\partial \\lambda} = \\frac{1}{2} \\frac{dk(\\lambda)}{d\\lambda} \\left(\\frac{k_{B}T}{k(\\lambda)}\\right) = \\frac{k_{B}T}{2} \\frac{1}{k(\\lambda)} \\frac{dk(\\lambda)}{d\\lambda}$$\n现在，我们对 $\\lambda$ 从 $0$ 积分到 $1$：\n$$\\Delta F = \\int_{0}^{1} \\frac{k_{B}T}{2} \\frac{1}{k(\\lambda)} \\frac{dk(\\lambda)}{d\\lambda} d\\lambda$$\n该积分可以通过变量代换 $u = k(\\lambda)$ 来求解，于是 $du = \\frac{dk}{d\\lambda} d\\lambda$。积分限从 $\\lambda=0, \\lambda=1$ 变为 $u=k(0)=k_0, u=k(1)=k_1$。\n$$\\Delta F = \\frac{k_{B}T}{2} \\int_{k_{0}}^{k_{1}} \\frac{1}{u} du = \\frac{k_{B}T}{2} [\\ln|u|]_{k_0}^{k_1}$$\n由于 $k(\\lambda)$ 是严格正的，所以 $k_0 > 0$ 且 $k_1 > 0$，因此 $|u|=u$。\n$$\\Delta F = \\frac{k_{B}T}{2} (\\ln(k_1) - \\ln(k_0)) = \\frac{k_{B}T}{2} \\ln\\left(\\frac{k_1}{k_0}\\right)$$\n\n### 方法二：直接计算自由能\n\n在此方法中，我们直接计算构型自由能 $F_c(\\lambda)$，然后计算差值 $\\Delta F = F_c(1) - F_c(0)$。我们首先计算构型配分函数 $Z_c(\\lambda)$。\n$$Z_{c}(\\lambda) = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x;\\lambda)) dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{k(\\lambda)x^2}{2k_{B}T}\\right) dx$$\n这是一个标准的高斯积分，形式为 $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\frac{\\pi}{a}}$。此处，$a = \\frac{k(\\lambda)}{2k_{B}T}$。\n$$Z_{c}(\\lambda) = \\sqrt{\\frac{\\pi}{k(\\lambda)/(2k_{B}T)}} = \\sqrt{\\frac{2\\pi k_{B}T}{k(\\lambda)}}$$\n现在，我们求构型自由能 $F_{c}(\\lambda) = -k_{B}T \\ln Z_{c}(\\lambda)$：\n$$F_{c}(\\lambda) = -k_{B}T \\ln\\left(\\left(\\frac{2\\pi k_{B}T}{k(\\lambda)}\\right)^{1/2}\\right) = -\\frac{1}{2}k_{B}T \\ln\\left(\\frac{2\\pi k_{B}T}{k(\\lambda)}\\right)$$\n利用对数的性质，我们可以写出：\n$$F_{c}(\\lambda) = -\\frac{1}{2}k_{B}T \\left( \\ln(2\\pi k_{B}T) - \\ln(k(\\lambda)) \\right) = \\frac{1}{2}k_{B}T \\ln(k(\\lambda)) - \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T)$$\n现在，我们可以计算在端点 $\\lambda=0$ 和 $\\lambda=1$ 处的自由能：\n$$F_{c}(\\lambda=1) = \\frac{1}{2}k_{B}T \\ln(k(1)) - \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T) = \\frac{1}{2}k_{B}T \\ln(k_1) - C$$\n$$F_{c}(\\lambda=0) = \\frac{1}{2}k_{B}T \\ln(k(0)) - \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T) = \\frac{1}{2}k_{B}T \\ln(k_0) - C$$\n其中 $C = \\frac{1}{2}k_{B}T \\ln(2\\pi k_{B}T)$ 是一个与 $\\lambda$ 无关的常数。于是自由能差为：\n$$\\Delta F = F_{c}(1) - F_{c}(0) = \\left(\\frac{1}{2}k_{B}T \\ln(k_1) - C\\right) - \\left(\\frac{1}{2}k_{B}T \\ln(k_0) - C\\right)$$\n$$\\Delta F = \\frac{1}{2}k_{B}T \\ln(k_1) - \\frac{1}{2}k_{B}T \\ln(k_0) = \\frac{k_{B}T}{2} \\ln\\left(\\frac{k_1}{k_0}\\right)$$\n\n### 结论\n两种方法得到相同的结果。这证明了自由能差与路径无关，它是一个态函数。结果仅取决于系统的初态和末态（分别由 $k_0$ 和 $k_1$ 表征），而与连接它们的具体光滑正函数 $k(\\lambda)$ 无关。自由能差的最终表达式是给定参数的一个闭式解析函数。",
            "answer": "$$\\boxed{\\frac{k_{B}T}{2}\\ln\\left(\\frac{k_{1}}{k_{0}}\\right)}$$"
        },
        {
            "introduction": "在实际模拟中，势能对耦合参数的导数 $\\frac{\\partial U}{\\partial \\lambda}$ 通常使用数值有限差分法计算。本实践旨在探讨这种近似所带来的影响。通过分析一个测试系统 ，我们将推导并计算由有限差分步长引入的偏差和方差，从而为理解数值选择如何影响TI计算的准确性提供关键见解。",
            "id": "3853822",
            "problem": "考虑一个用于多尺度材料模拟中热力学积分（TI）的一维测试系统。在正则系综中，TI将自由能导数与系综平均值联系起来。目标是在固定的位形空间坐标 $x$ 下，检验势能关于耦合参数 $\\lambda$ 的导数的有限差分估计与解析导数的比较，并量化在正则系综上平均时，由有限步长 $h$ 引入的偏差和方差。计算完全在约化单位下进行，其中玻尔兹曼常数 $k_B$ 等于 $1$，温度 $T$ 是无量纲的，能量 $U$ 也是无量纲的。\n\n该测试系统是一个一维谐振子，其势能为 $U(x;\\lambda) = \\frac{1}{2}\\,k(\\lambda)\\,x^2$，其中 $k(\\lambda)$ 是一个依赖于 $\\lambda$ 的刚度。系统在温度 $T$ 下处于热平衡状态，其正则系综概率密度与 $\\exp(-\\beta U(x;\\lambda))$ 成正比，其中逆温度 $\\beta = 1/(k_B T)$。\n\n在固定的参数值 $\\lambda$ 和有限步长 $h$ 下，将固定 $x$ 时 $\\partial U/\\partial \\lambda$ 的中心有限差分估计量定义为\n$$\n\\mathrm{FD}(x;\\lambda,h) = \\frac{U(x;\\lambda+h) - U(x;\\lambda-h)}{2h}.\n$$\n设解析导数为\n$$\n\\mathrm{AD}(x;\\lambda) = \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda}.\n$$\n定义误差函数\n$$\ne(x;\\lambda,h) = \\mathrm{FD}(x;\\lambda,h) - \\mathrm{AD}(x;\\lambda).\n$$\n在固定 $\\lambda$ 的正则系综上，将由有限 $h$ 引起的有限差分估计量的偏差和方差定义为\n$$\nB(\\lambda,h) = \\mathbb{E}_{\\mathrm{can}}[\\,e(x;\\lambda,h)\\,], \\quad V(\\lambda,h) = \\mathrm{Var}_{\\mathrm{can}}[\\,e(x;\\lambda,h)\\,],\n$$\n其中 $\\mathbb{E}_{\\mathrm{can}}[\\cdot]$ 和 $\\mathrm{Var}_{\\mathrm{can}}[\\cdot]$ 分别表示在固定 $\\lambda$ 时对正则系综的期望和方差。\n\n仅从正则系综的定义和给定的 $U(x;\\lambda)$ 出发，推导出 $B(\\lambda,h)$ 和 $V(\\lambda,h)$ 的闭式表达式，用 $k(\\lambda)$ 及其关于 $\\lambda$ 的导数、$h$ 和 $T$ 来表示。然后将这些表达式实现为一个完整的程序，为以下测试套件计算 $B(\\lambda,h)$ 和 $V(\\lambda,h)$：\n\n- 案例 1（对于二次刚度，预期偏差为零的边界情况）：\n  - $k(\\lambda) = k_0 + k_1 \\lambda + k_2 \\lambda^2$，其中 $k_0 = 7, k_1 = 4, k_2 = 3$。\n  - 参数：$\\lambda = 0.6$。\n  - 温度：$T = 1.5$。\n  - 步长：$h = 0.2$。\n\n- 案例 2（指数刚度的小步长情况）：\n  - $k(\\lambda) = k_0 \\exp(\\alpha \\lambda)$，其中 $k_0 = 5, \\alpha = 0.8$。\n  - 参数：$\\lambda = 0.3$。\n  - 温度：$T = 1.0$。\n  - 步长：$h = 0.001$。\n\n- 案例 3（相同指数刚度的中等步长情况）：\n  - $k(\\lambda) = k_0 \\exp(\\alpha \\lambda)$，其中 $k_0 = 5, \\alpha = 0.8$。\n  - 参数：$\\lambda = 0.3$。\n  - 温度：$T = 1.0$。\n  - 步长：$h = 0.1$。\n\n- 案例 4（显示有限差分偏差敏感性的有理刚度）：\n  - $k(\\lambda) = \\dfrac{k_0}{1 - b \\lambda}$，其中 $k_0 = 10, b = 0.5$。\n  - 参数：$\\lambda = 0.5$。\n  - 温度：$T = 2.0$。\n  - 步长：$h = 0.05$。\n\n您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表的结果，其中每个测试案例的结果是一个双元素列表 $[B,V]$，两个条目都四舍五入到八位小数。例如：$[[B_1,V_1],[B_2,V_2],[B_3,V_3],[B_4,V_4]]$。由于所有量都在约化单位下计算，因此将数字报告为四舍五入到八位小数的无量纲浮点数。",
            "solution": "在尝试求解之前，需对问题进行验证。\n\n### 步骤 1：提取已知条件\n- **系统**：正则系综中的一维谐振子。\n- **势能**：$U(x;\\lambda) = \\frac{1}{2}\\,k(\\lambda)\\,x^2$。\n- **热力学状态**：固定温度 $T$。使用约化单位，其中玻尔兹曼常数 $k_B = 1$。逆温度为 $\\beta = 1/T$。\n- **概率密度**：$p(x;\\lambda) \\propto \\exp(-\\beta U(x;\\lambda))$。\n- **有限差分 (FD) 估计量**：$\\mathrm{FD}(x;\\lambda,h) = \\frac{U(x;\\lambda+h) - U(x;\\lambda-h)}{2h}$。\n- **解析导数 (AD)**：$\\mathrm{AD}(x;\\lambda) = \\frac{\\partial U(x;\\lambda)}{\\partial \\lambda}$。\n- **误差函数**：$e(x;\\lambda,h) = \\mathrm{FD}(x;\\lambda,h) - \\mathrm{AD}(x;\\lambda)$。\n- **偏差**：$B(\\lambda,h) = \\mathbb{E}_{\\mathrm{can}}[\\,e(x;\\lambda,h)\\,]$。\n- **方差**：$V(\\lambda,h) = \\mathrm{Var}_{\\mathrm{can}}[\\,e(x;\\lambda,h)\\,]$。\n- **测试案例**：\n    1.  $k(\\lambda) = k_0 + k_1 \\lambda + k_2 \\lambda^2$，其中 $k_0 = 7, k_1 = 4, k_2 = 3$。参数：$\\lambda = 0.6, T = 1.5, h = 0.2$。\n    2.  $k(\\lambda) = k_0 \\exp(\\alpha \\lambda)$，其中 $k_0 = 5, \\alpha = 0.8$。参数：$\\lambda = 0.3, T = 1.0, h = 0.001$。\n    3.  $k(\\lambda) = k_0 \\exp(\\alpha \\lambda)$，其中 $k_0 = 5, \\alpha = 0.8$。参数：$\\lambda = 0.3, T = 1.0, h = 0.1$。\n    4.  $k(\\lambda) = \\dfrac{k_0}{1 - b \\lambda}$，其中 $k_0 = 10, b = 0.5$。参数：$\\lambda = 0.5, T = 2.0, h = 0.05$。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **有科学依据**：问题基于统计力学（正则系综，谐振子）和数值分析（有限差分）的基本原理。所有概念都是物理学和计算科学中标准且成熟的。该问题具有科学合理性。\n- **适定的**：问题要求偏差和方差的闭式表达式，这可以从给定的定义中推导出来。对于 $k(\\lambda)>0$ 的谐振子，其正则系综是适定的（高斯分布），这确保了所需的期望值存在且有限。该问题是适定的。\n- **客观的**：问题使用精确、客观的数学语言陈述。没有主观或基于意见的元素。\n\n### 步骤 3：结论与行动\n该问题是有效的，因为它具有科学依据、适定性和客观性。将提供一个完整的、有理有据的解答。\n\n### 偏差和方差表达式的推导\n\n一维谐振子的势能由下式给出\n$$\nU(x;\\lambda) = \\frac{1}{2} k(\\lambda) x^2\n$$\n系统处于温度 $T$ 的正则系综中。坐标 $x$ 的概率密度函数与 $\\exp(-\\beta U(x;\\lambda))$ 成正比，其中 $\\beta = 1/T$（因为 $k_B=1$）。\n$$\np(x;\\lambda) \\propto \\exp\\left(-\\frac{\\beta k(\\lambda) x^2}{2}\\right)\n$$\n这是一个零均值高斯分布。归一化常数 $Z$ 通过对所有 $x$ 积分得到：\n$$\nZ = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k(\\lambda) x^2}{2}\\right) dx = \\sqrt{\\frac{2\\pi}{\\beta k(\\lambda)}}\n$$\n归一化后的概率密度为：\n$$\np(x;\\lambda) = \\sqrt{\\frac{\\beta k(\\lambda)}{2\\pi}} \\exp\\left(-\\frac{\\beta k(\\lambda) x^2}{2}\\right)\n$$\n这是一个高斯分布 $N(0, \\sigma_x^2)$，其均值为 $\\mu_x=0$，方差为 $\\sigma_x^2 = \\frac{1}{\\beta k(\\lambda)} = \\frac{T}{k(\\lambda)}$。\n\n我们计算所需的该分布的矩：\n$$\n\\mathbb{E}_{\\mathrm{can}}[x^2] = \\sigma_x^2 = \\frac{T}{k(\\lambda)}\n$$\n$$\n\\mathbb{E}_{\\mathrm{can}}[x^4] = 3(\\sigma_x^2)^2 = 3\\left(\\frac{T}{k(\\lambda)}\\right)^2\n$$\n则 $x^2$ 的方差为：\n$$\n\\mathrm{Var}_{\\mathrm{can}}[x^2] = \\mathbb{E}_{\\mathrm{can}}[(x^2)^2] - (\\mathbb{E}_{\\mathrm{can}}[x^2])^2 = \\mathbb{E}_{\\mathrm{can}}[x^4] - (\\mathbb{E}_{\\mathrm{can}}[x^2])^2 = 3\\left(\\frac{T}{k(\\lambda)}\\right)^2 - \\left(\\frac{T}{k(\\lambda)}\\right)^2 = 2\\left(\\frac{T}{k(\\lambda)}\\right)^2\n$$\n接下来，我们表示误差函数 $e(x;\\lambda,h)$。解析导数为：\n$$\n\\mathrm{AD}(x;\\lambda) = \\frac{\\partial}{\\partial \\lambda} \\left(\\frac{1}{2} k(\\lambda) x^2\\right) = \\frac{1}{2} k'(\\lambda) x^2\n$$\n有限差分估计量为：\n$$\n\\mathrm{FD}(x;\\lambda,h) = \\frac{\\frac{1}{2}k(\\lambda+h)x^2 - \\frac{1}{2}k(\\lambda-h)x^2}{2h} = \\frac{1}{2} \\left[ \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} \\right] x^2\n$$\n误差函数为：\n$$\ne(x;\\lambda,h) = \\mathrm{FD}(x;\\lambda,h) - \\mathrm{AD}(x;\\lambda) = \\frac{1}{2} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right) x^2\n$$\n为简洁起见，我们定义一个不依赖于 $x$ 的项 $C(\\lambda,h)$：\n$$\nC(\\lambda,h) = \\frac{1}{2} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right)\n$$\n因此，$e(x;\\lambda,h) = C(\\lambda,h) x^2$。\n\n现在我们可以推导偏差 $B(\\lambda,h)$：\n$$\nB(\\lambda,h) = \\mathbb{E}_{\\mathrm{can}}[e(x;\\lambda,h)] = \\mathbb{E}_{\\mathrm{can}}[C(\\lambda,h) x^2] = C(\\lambda,h) \\mathbb{E}_{\\mathrm{can}}[x^2]\n$$\n代入 $C(\\lambda,h)$ 和 $\\mathbb{E}_{\\mathrm{can}}[x^2]$ 的表达式：\n$$\nB(\\lambda,h) = \\frac{1}{2} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right) \\frac{T}{k(\\lambda)}\n$$\n这是偏差的闭式表达式。\n\n接下来，我们推导方差 $V(\\lambda,h)$：\n$$\nV(\\lambda,h) = \\mathrm{Var}_{\\mathrm{can}}[e(x;\\lambda,h)] = \\mathrm{Var}_{\\mathrm{can}}[C(\\lambda,h) x^2]\n$$\n使用性质 $\\mathrm{Var}[aY] = a^2 \\mathrm{Var}[Y]$（其中 $a$ 是常数）：\n$$\nV(\\lambda,h) = [C(\\lambda,h)]^2 \\mathrm{Var}_{\\mathrm{can}}[x^2]\n$$\n代入 $C(\\lambda,h)$ 和 $\\mathrm{Var}_{\\mathrm{can}}[x^2]$ 的表达式：\n$$\nV(\\lambda,h) = \\left[ \\frac{1}{2} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right) \\right]^2 \\cdot 2\\left(\\frac{T}{k(\\lambda)}\\right)^2\n$$\n我们可以注意到 $V$ 和 $B$ 之间的一个简单关系。从偏差表达式中，我们可以写出：\n$$\nC(\\lambda,h) = \\frac{B(\\lambda,h)}{\\mathbb{E}_{\\mathrm{can}}[x^2]} = \\frac{B(\\lambda,h)}{T/k(\\lambda)}\n$$\n将此代入方差表达式：\n$$\nV(\\lambda,h) = \\left( \\frac{B(\\lambda,h)}{T/k(\\lambda)} \\right)^2 \\cdot 2\\left(\\frac{T}{k(\\lambda)}\\right)^2 = 2 B(\\lambda,h)^2\n$$\n这个非常简单的关系 $V(\\lambda,h) = 2B(\\lambda,h)^2$ 在这个特定系统中成立，因为误差函数 $e(x)$ 与 $x^2$ 成正比，并且位置 $x$ 服从高斯分布。\n\n### 测试案例的计算\n\n我们应用推导出的公式 $B(\\lambda,h) = \\frac{T}{2k(\\lambda)} \\left( \\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) \\right)$ 和 $V(\\lambda,h) = 2B(\\lambda,h)^2$。\n\n- **案例 1**：$k(\\lambda) = 7 + 4\\lambda + 3\\lambda^2$。这是一个二次多项式。其导数为 $k'(\\lambda) = 4 + 6\\lambda$。已知中心差分公式对最高二次的多项式是精确的。我们来验证一下：\n  $k(\\lambda+h) - k(\\lambda-h) = (7+4(\\lambda+h)+3(\\lambda+h)^2) - (7+4(\\lambda-h)+3(\\lambda-h)^2) = 4(2h)+3(4\\lambda h) = 2h(4+6\\lambda) = 2h k'(\\lambda)$。\n  因此，$\\frac{k(\\lambda+h) - k(\\lambda-h)}{2h} - k'(\\lambda) = 0$。\n  这导致 $B_1 = 0$ 和 $V_1 = 2(0)^2=0$。\n\n- **案例 2**：$k(\\lambda) = 5 e^{0.8\\lambda}$，其中 $\\lambda=0.3, T=1.0, h=0.001$。\n  $k'(\\lambda) = 5 \\cdot 0.8 e^{0.8\\lambda} = 4 e^{0.8\\lambda}$。\n  我们计算偏差公式中括号内的项：\n  $\\Delta = \\frac{5e^{0.8(\\lambda+h)} - 5e^{0.8(\\lambda-h)}}{2h} - 4e^{0.8\\lambda} = \\frac{5e^{0.8\\lambda}(e^{0.8h}-e^{-0.8h})}{2h} - 4e^{0.8\\lambda} = 5e^{0.8\\lambda}\\frac{\\sinh(0.8h)}{h} - 4e^{0.8\\lambda}$。\n  $B(\\lambda,h) = \\frac{T}{2 \\cdot 5e^{0.8\\lambda}} \\left( 5e^{0.8\\lambda}\\frac{\\sinh(0.8h)}{h} - 4e^{0.8\\lambda} \\right) = \\frac{T}{2} \\left( \\frac{\\sinh(0.8h)}{h} - 0.8 \\right)$。\n  对于 $T=1.0, \\alpha=0.8, h=0.001$：\n  $B_2 = \\frac{1.0}{2} \\left( \\frac{\\sinh(0.0008)}{0.001} - 0.8 \\right) \\approx 0.5 \\times (0.80000008533 - 0.8) \\approx 4.2667 \\times 10^{-8}$。\n  $V_2 = 2 B_2^2 \\approx 2 \\times (4.2667 \\times 10^{-8})^2 \\approx 3.64 \\times 10^{-15}$。\n\n- **案例 3**：与案例 2 相同的 $k(\\lambda)$，但 $h=0.1$。\n  使用此 $k(\\lambda)$ 的简化偏差公式：\n  $B_3 = \\frac{1.0}{2} \\left( \\frac{\\sinh(0.08)}{0.1} - 0.8 \\right) \\approx 0.5 \\times (0.8008533867 - 0.8) \\approx 0.000426693$。\n  $V_3 = 2 B_3^2 \\approx 2 \\times (0.000426693)^2 \\approx 3.6413 \\times 10^{-7}$。\n\n- **案例 4**：$k(\\lambda) = \\frac{10}{1-0.5\\lambda}$，其中 $\\lambda=0.5, T=2.0, h=0.05$。\n  $k'(\\lambda) = \\frac{10 \\cdot 0.5}{(1-0.5\\lambda)^2} = \\frac{5}{(1-0.5\\lambda)^2}$。\n  在 $\\lambda=0.5$ 处：\n  $k(0.5) = \\frac{10}{1-0.25} = \\frac{40}{3}$。\n  $k'(0.5) = \\frac{5}{(0.75)^2} = \\frac{80}{9}$。\n  $k(0.5+0.05) = k(0.55) = \\frac{10}{1-0.275} = \\frac{10}{0.725} = \\frac{400}{29}$。\n  $k(0.5-0.05) = k(0.45) = \\frac{10}{1-0.225} = \\frac{10}{0.775} = \\frac{400}{31}$。\n  有限差分项：$\\frac{k(0.55)-k(0.45)}{2h} = \\frac{400/29 - 400/31}{0.1} = 4000 \\left(\\frac{2}{899}\\right) = \\frac{8000}{899}$。\n  $B_4 = \\frac{2.0}{2 \\cdot (40/3)} \\left( \\frac{8000}{899} - \\frac{80}{9} \\right) = \\frac{3}{40} \\left( \\frac{72000-71920}{8091} \\right) = \\frac{3}{40} \\frac{80}{8091} = \\frac{6}{8091} = \\frac{2}{2697} \\approx 0.0007415647$。\n  $V_4 = 2 B_4^2 = 2 \\left(\\frac{2}{2697}\\right)^2 = \\frac{8}{7273809} \\approx 1.100003 \\times 10^{-6}$。\n现在实现一个程序来计算这些值并按指定格式输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the bias and variance of a finite-difference estimator for dU/dλ\n    for a 1D harmonic oscillator in the canonical ensemble.\n    \"\"\"\n\n    # Case 1: k(λ) = k0 + k1*λ + k2*λ^2\n    k1_func = lambda l, p: p['k0'] + p['k1']*l + p['k2']*l**2\n    k1_prime = lambda l, p: p['k1'] + 2*p['k2']*l\n    case1 = {\n        'k_func': k1_func, 'k_prime': k1_prime,\n        'params': {'k0': 7, 'k1': 4, 'k2': 3},\n        'lambda_val': 0.6, 'T': 1.5, 'h': 0.2\n    }\n\n    # Case 2  3: k(λ) = k0 * exp(α*λ)\n    k2_func = lambda l, p: p['k0'] * np.exp(p['alpha']*l)\n    k2_prime = lambda l, p: p['k0'] * p['alpha'] * np.exp(p['alpha']*l)\n    case2 = {\n        'k_func': k2_func, 'k_prime': k2_prime,\n        'params': {'k0': 5, 'alpha': 0.8},\n        'lambda_val': 0.3, 'T': 1.0, 'h': 0.001\n    }\n    case3 = {\n        'k_func': k2_func, 'k_prime': k2_prime,\n        'params': {'k0': 5, 'alpha': 0.8},\n        'lambda_val': 0.3, 'T': 1.0, 'h': 0.1\n    }\n\n    # Case 4: k(λ) = k0 / (1 - b*λ)\n    k4_func = lambda l, p: p['k0'] / (1 - p['b']*l)\n    k4_prime = lambda l, p: p['k0'] * p['b'] / (1 - p['b']*l)**2\n    case4 = {\n        'k_func': k4_func, 'k_prime': k4_prime,\n        'params': {'k0': 10, 'b': 0.5},\n        'lambda_val': 0.5, 'T': 2.0, 'h': 0.05\n    }\n\n    test_cases = [case1, case2, case3, case4]\n    \n    # List to hold the unformatted results\n    results_raw = []\n\n    for case in test_cases:\n        # Unpack case data\n        k_func = case['k_func']\n        k_prime = case['k_prime']\n        params = case['params']\n        lam = case['lambda_val']\n        T = case['T']\n        h = case['h']\n\n        # Derived formulas from the solution section\n        # B = (T / (2*k(λ))) * ( (k(λ+h) - k(λ-h))/(2h) - k'(λ) )\n        # V = 2 * B^2\n\n        k_lam = k_func(lam, params)\n        k_lam_plus_h = k_func(lam + h, params)\n        k_lam_minus_h = k_func(lam - h, params)\n        k_p_lam = k_prime(lam, params)\n\n        fd_term = (k_lam_plus_h - k_lam_minus_h) / (2 * h)\n        diff_term = fd_term - k_p_lam\n        \n        # The canonical ensemble is well-defined only for k(λ) > 0.\n        # The given parameters all satisfy this.\n        if k_lam == 0:\n            B = float('inf')\n            V = float('inf')\n        else:\n            B = (T / (2 * k_lam)) * diff_term\n            V = 2 * B**2\n        \n        results_raw.append([B, V])\n\n    # Format the final output string as per requirements.\n    # Each number must be represented as a float rounded to eight decimal places.\n    # Manual string construction is necessary to ensure fixed-point format\n    # and avoid scientific notation for small numbers.\n    formatted_pairs = []\n    for B_val, V_val in results_raw:\n        formatted_pairs.append(f\"[{B_val:.8f},{V_val:.8f}]\")\n    \n    final_output_string = f\"[{','.join(formatted_pairs)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "热力学积分模拟中的一个核心挑战是确保系统在耦合参数 $\\lambda$ 变化时始终保持平衡。本实践介绍一种至关重要的诊断工具——滞后检验（hysteresis test）。通过比较正向（$\\lambda: 0 \\to 1$）和反向（$\\lambda: 1 \\to 0$）变换的结果 ，我们可以检测亚稳态和采样势垒的存在，这些是可能导致自由能计算失效的常见陷阱。",
            "id": "3853839",
            "problem": "您被要求在多尺度材料模拟的背景下，实现并分析一个用于热力学积分（TI）的磁滞测试。其基本原理是通过正则配分函数 $Z(\\lambda)$、Helmholtz 自由能 $F(\\lambda)=-k_{\\mathrm{B}}T\\ln Z(\\lambda)$ 以及对参数化哈密顿量的基本微积分运算来进行的平衡态统计力学描述。控制参数是一个无量纲的耦合坐标 $\\lambda\\in[0,1]$，它调节一个具有两个亚稳态的系统的哈密顿量，这两个亚稳态的占据情况取决于 $\\lambda$。广义力是势能对控制参数导数的系综平均值，记作 $\\left\\langle \\partial U / \\partial \\lambda \\right\\rangle_{\\lambda}$。在磁滞测试中，我们沿着正向扫描（$\\lambda:0\\to 1$）和反向扫描（$\\lambda:1\\to 0$）两个方向测量这个广义力。亚稳态和采样势垒的存在意味着路径依赖性：正向和反向扫描测得的广义力曲线可能不同，从而导致积分得到的自由能差值也不同。\n\n为解决此问题，请通过一个平滑基线和一个S型切换贡献来模拟广义力曲线，以模仿亚稳态转变：\n- 基线贡献：$g_{\\mathrm{base}}(\\lambda)=a\\sin(2\\pi \\lambda)+b\\lambda$。\n- 切换函数：$L(\\lambda;\\lambda_{c},w)=\\dfrac{1}{1+e^{-(\\lambda-\\lambda_{c})/w}}$，其中 $\\lambda_{c}$ 是转变中心，$w$ 控制转变的锐度。\n- 正向广义力：$g_{\\mathrm{fwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}}\\right)$。\n- 反向广义力：$g_{\\mathrm{bwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}}\\right)$。\n\n切换参数 $\\lambda_{c}^{\\mathrm{fwd}}$、$\\lambda_{c}^{\\mathrm{bwd}}$、$w^{\\mathrm{fwd}}$ 和 $w^{\\mathrm{bwd}}$ 编码了磁滞现象。$\\lambda_{c}^{\\mathrm{fwd}}$ 和 $\\lambda_{c}^{\\mathrm{bwd}}$ 之间的巨大分离以及较小的 $w$ 值表明存在强亚稳态和采样势垒。\n\n任务：\n1. 从 $F(\\lambda)=-k_{\\mathrm{B}}T\\ln Z(\\lambda)$ 和广义力的定义出发，推导出通过沿控制参数积分广义力来计算 $\\lambda=0$ 和 $\\lambda=1$ 之间自由能差 $\\Delta F$ 的数值方法。对正向路径和反向路径分别实现此计算。所有自由能差值均以 $k_{\\mathrm{B}}T$ 的倍数表示（无量纲）。\n2. 通过计算有符号差值 $H=\\Delta F_{\\mathrm{fwd}}-\\Delta F_{\\mathrm{bwd}}$ 和路径不一致面积 $A=\\int_{0}^{1}\\left|g_{\\mathrm{fwd}}(\\lambda)-g_{\\mathrm{bwd}}(\\lambda)\\right|\\,\\mathrm{d}\\lambda$ 来量化磁滞，两者均以 $k_{\\mathrm{B}}T$ 为单位（无量纲）。\n3. 定义一个布尔标志来表示亚稳态：$\\mathrm{MS}=\\left(|H|>\\tau_{H}\\right)\\vee\\left(A>\\tau_{A}\\right)$，其中 $\\tau_{H}$ 和 $\\tau_{A}$ 是用户指定的阈值（以 $k_{\\mathrm{B}}T$ 为单位，无量纲）。\n\n数值要求：\n- 在 $\\lambda\\in[0,1]$ 上使用一个包含 $N$ 个点的均匀网格，其中 $N$ 为奇数，以便应用复合辛普森法则。设网格间距为 $h=\\left(1-0\\right)/(N-1)$。\n- 对所有积分使用复合辛普森法则以确保准确性。不存在随机噪声；所有函数都是确定且平滑的。\n- 所有浮点数结果均四舍五入至六位小数。\n\n测试套件：\n为以下参数集计算输出，每个参数集指定为 $\\left(a,b,c,\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}},\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}},N,\\tau_{H},\\tau_{A}\\right)$：\n- 情况1（无磁滞，理想路径）：$\\left(0.5,0.4,1.2,0.5,0.1,0.5,0.1,20001,0.01,0.05\\right)$。\n- 情况2（轻度磁滞）：$\\left(0.4,0.6,1.0,0.4,0.08,0.6,0.08,20001,0.01,0.05\\right)$。\n- 情况3（具有急剧切换的强亚稳态）：$\\left(0.3,0.2,2.5,0.2,0.02,0.8,0.02,20001,0.05,0.10\\right)$。\n- 情况4（边界邻近切换）：$\\left(0.2,0.1,1.5,0.05,0.03,0.95,0.03,20001,0.02,0.08\\right)$。\n\n程序输出格式：\n- 对每种情况，输出一个列表 $\\left[\\Delta F_{\\mathrm{fwd}},\\Delta F_{\\mathrm{bwd}},H,A,\\mathrm{MS}\\right]$，其中 $\\Delta F_{\\mathrm{fwd}}$、$\\Delta F_{\\mathrm{bwd}}$、$H$ 和 $A$ 是四舍五入到六位小数的浮点数，$\\mathrm{MS}$ 是一个布尔值。将所有四种情况的结果聚合到一行中，作为一个用方括号括起来的逗号分隔列表，即 $\\left[\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right]\\right]$。",
            "solution": "首先对问题陈述进行严格的验证过程。\n\n### 第一步：提取已知条件\n\n- **问题领域**：在多尺度材料模拟中，基于平衡态统计力学进行热力学积分（TI）以计算自由能差。\n- **基本关系**：\n    - 正则配分函数：$Z(\\lambda)$。\n    - Helmholtz 自由能：$F(\\lambda)=-k_{\\mathrm{B}}T\\ln Z(\\lambda)$。\n    - 控制参数：$\\lambda \\in [0,1]$。\n    - 广义力：$\\left\\langle \\partial U / \\partial \\lambda \\right\\rangle_{\\lambda}$。\n- **磁滞测试流程**：沿正向扫描（$\\lambda: 0 \\to 1$）和反向扫描（$\\lambda: 1 \\to 0$）测量广义力。\n- **广义力的模型函数**：\n    - 基线贡献：$g_{\\mathrm{base}}(\\lambda)=a\\sin(2\\pi \\lambda)+b\\lambda$。\n    - 切换函数：$L(\\lambda;\\lambda_{c},w)=\\dfrac{1}{1+e^{-(\\lambda-\\lambda_{c})/w}}$。\n    - 正向广义力：$g_{\\mathrm{fwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}}\\right)$。\n    - 反向广义力：$g_{\\mathrm{bwd}}(\\lambda)=g_{\\mathrm{base}}(\\lambda)+c\\,L\\!\\left(\\lambda;\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}}\\right)$。\n- **任务**：\n    1.  推导并实现数值方法，以计算正向和反向路径的自由能差 $\\Delta F = F(1) - F(0)$，结果以 $k_{\\mathrm{B}}T$ 的倍数表示。\n    2.  通过计算有符号差值 $H=\\Delta F_{\\mathrm{fwd}}-\\Delta F_{\\mathrm{bwd}}$ 和路径不一致面积 $A=\\int_{0}^{1}\\left|g_{\\mathrm{fwd}}(\\lambda)-g_{\\mathrm{bwd}}(\\lambda)\\right|\\,\\mathrm{d}\\lambda$ 来量化磁滞，两者均以 $k_{\\mathrm{B}}T$ 为单位（无量纲）。\n    3.  定义一个布尔标志来表示亚稳态：$\\mathrm{MS}=\\left(|H|>\\tau_{H}\\right)\\vee\\left(A>\\tau_{A}\\right)$。\n- **数值要求**：\n    - 网格：在 $\\lambda \\in [0,1]$ 上使用包含 $N$ 个点的均匀网格，其中 $N$ 为奇数。\n    - 积分方法：对所有积分使用复合辛普森法则。\n    - 精度：报告的浮点数结果四舍五入至六位小数。\n- **测试套件**：参数集 $\\left(a,b,c,\\lambda_{c}^{\\mathrm{fwd}},w^{\\mathrm{fwd}},\\lambda_{c}^{\\mathrm{bwd}},w^{\\mathrm{bwd}},N,\\tau_{H},\\tau_{A}\\right)$：\n    - 情况1：$\\left(0.5,0.4,1.2,0.5,0.1,0.5,0.1,20001,0.01,0.05\\right)$。\n    - 情况2：$\\left(0.4,0.6,1.0,0.4,0.08,0.6,0.08,20001,0.01,0.05\\right)$。\n    - 情况3：$\\left(0.3,0.2,2.5,0.2,0.02,0.8,0.02,20001,0.05,0.10\\right)$。\n    - 情况4：$\\left(0.2,0.1,1.5,0.05,0.03,0.95,0.03,20001,0.02,0.08\\right)$。\n\n### 第二步：使用提取的已知条件进行验证\n\n根据验证标准对问题进行评估。\n\n- **科学依据**：该问题基于统计力学的基本原理，特别是自由能与配分函数之间的关系，及其在热力学积分中的应用。热力学积分是计算物理和化学中一种标准且广泛使用的技术。使用S型函数来模拟状态转变是一种常见且合适的唯象方法。该问题具有科学合理性。\n- **适定性**：该问题提供了明确、确定性的数学函数和清晰的任务集。所有参数都有定义，数值方法和输出要求都得到了明确的规定。这种结构确保了每个测试用例都存在唯一、稳定且有意义的解。\n- **客观性**：问题以精确、定量的术语陈述，没有主观语言或基于观点的论断。\n- **完整性与一致性**：问题是自洽的。所有必要信息，包括函数形式、测试用例的参数和数值规范，都已提供。没有内部矛盾。例如，要求 $N$ 为奇数与在该区间上应用复合辛普森法则的要求是一致的。\n- **现实性**：该设置模拟了分子模拟中的一个常见情景，即磁滞现象表明亚稳态之间存在采样不足或动力学陷阱。参数和函数形式是对这类系统的合理表示。任务本身代表了一个标准的分析协议。\n- **无其他缺陷**：问题不是隐喻性的、琐碎的、同义反复的或不可证伪的。它要求将微积分和数值方法的特定、非平凡应用到一个有物理动机的模型上。\n\n### 第三步：结论与行动\n\n该问题是**有效的**。它科学合理、适定且完整。可以构建一个严谨的解决方案。\n\n---\n\n### 解决方案\n\n解决方案首先建立理论基础，然后定义待计算的量，最后概述数值实现。\n\n**1. 热力学积分的理论基础**\n\nHelmholtz 自由能 $F$ 与温度为 $T$ 的系统的正则配分函数 $Z$ 之间的关系为：\n$$\nF(\\lambda) = -k_{\\mathrm{B}}T \\ln Z(\\lambda)\n$$\n其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$\\lambda$ 是一个连续变换系统势能 $U(\\lambda)$ 的参数。对于一个由位置为 $\\mathbf{r}$ 的粒子组成的经典系统，其配分函数为：\n$$\nZ(\\lambda) = \\int e^{-U(\\mathbf{r}; \\lambda)/(k_{\\mathrm{B}}T)} d\\mathbf{r}\n$$\n（忽略了动能项，假设它们与 $\\lambda$ 无关）。\n\n为了求自由能随 $\\lambda$ 的变化，我们对 $F(\\lambda)$ 求导：\n$$\n\\frac{dF}{d\\lambda} = -k_{\\mathrm{B}}T \\frac{1}{Z(\\lambda)} \\frac{dZ}{d\\lambda}\n$$\n配分函数的导数为：\n$$\n\\frac{dZ}{d\\lambda} = \\int \\left( -\\frac{1}{k_{\\mathrm{B}}T} \\frac{\\partial U(\\mathbf{r}; \\lambda)}{\\partial \\lambda} \\right) e^{-U(\\mathbf{r}; \\lambda)/(k_{\\mathrm{B}}T)} d\\mathbf{r}\n$$\n将此代回，我们得到：\n$$\n\\frac{dF}{d\\lambda} = -k_{\\mathrm{B}}T \\frac{1}{Z(\\lambda)} \\int \\left( -\\frac{1}{k_{\\mathrm{B}}T} \\frac{\\partial U}{\\partial \\lambda} \\right) e^{-U/(k_{\\mathrm{B}}T)} d\\mathbf{r} = \\frac{\\int \\frac{\\partial U}{\\partial \\lambda} e^{-U/(k_{\\mathrm{B}}T)} d\\mathbf{r}}{\\int e^{-U/(k_{\\mathrm{B}}T)} d\\mathbf{r}}\n$$\n根据定义，右侧是势能对 $\\lambda$ 的导数的正则系综平均值。这就是广义力 $g(\\lambda)$：\n$$\n\\frac{dF}{d\\lambda} = \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} = g(\\lambda)\n$$\n通过微积分基本定理，对该导数进行积分，即可得到 $\\lambda=1$ 状态与 $\\lambda=0$ 状态之间的总自由能差：\n$$\n\\Delta F = F(1) - F(0) = \\int_{0}^{1} \\frac{dF}{d\\lambda} d\\lambda = \\int_{0}^{1} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} d\\lambda\n$$\n问题要求结果以无量纲单位 $k_{\\mathrm{B}}T$ 表示。因此，我们计算：\n$$\n\\frac{\\Delta F}{k_{\\mathrm{B}}T} = \\int_{0}^{1} \\frac{1}{k_{\\mathrm{B}}T} \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} d\\lambda\n$$\n给定的函数 $g_{\\mathrm{fwd}}(\\lambda)$ 和 $g_{\\mathrm{bwd}}(\\lambda)$ 被指定为无量纲的，这与它们代表量 $\\frac{1}{k_{\\mathrm{B}}T} \\langle \\frac{\\partial U}{\\partial \\lambda} \\rangle_{\\lambda}$ 是一致的。\n\n**2. 磁滞分析与量化指标**\n\n在物理模拟中，当 $\\lambda$ 以有限速率变化时，系统可能不会保持在平衡状态。测得的广义力将取决于所走的路径。正向路径（$\\lambda: 0 \\to 1$）产生自由能差的估计值 $\\Delta F_{\\mathrm{fwd}}$。反向路径（$\\lambda: 1 \\to 0$）产生一个功值，可用于估计相同的自由能差 $\\Delta F_{\\mathrm{bwd}}$。为确保对量 $F(1)-F(0)$ 的一致比较，两个估计值都计算为从 $\\lambda=0$ 到 $\\lambda=1$ 的积分：\n$$\n\\Delta F_{\\mathrm{fwd}} = \\int_{0}^{1} g_{\\mathrm{fwd}}(\\lambda) d\\lambda\n$$\n$$\n\\Delta F_{\\mathrm{bwd}} = \\int_{0}^{1} g_{\\mathrm{bwd}}(\\lambda) d\\lambda\n$$\n请注意，反向路径估计的积分区间仍然是 $[0, 1]$，它代表 $-W_{1\\to 0}$，这是对 $\\Delta F_{0\\to 1}$ 的一个估计。\n\n磁滞程度由两个指标量化：\n1.  **有符号差值 ($H$)**：正向和反向自由能估计值之间的差。这代表了两条曲线所包围的净面积。\n    $$\n    H = \\Delta F_{\\mathrm{fwd}} - \\Delta F_{\\mathrm{bwd}} = \\int_{0}^{1} \\left( g_{\\mathrm{fwd}}(\\lambda) - g_{\\mathrm{bwd}}(\\lambda) \\right) d\\lambda\n    $$\n2.  **路径不一致面积 ($A$)**：正向和反向力曲线之间的总面积。这量化了总的差异，不考虑符号。\n    $$\n    A = \\int_{0}^{1} | g_{\\mathrm{fwd}}(\\lambda) - g_{\\mathrm{bwd}}(\\lambda) | d\\lambda\n    $$\n对于给定的问题，由于 $\\lambda_{c}^{\\mathrm{fwd}} \\le \\lambda_{c}^{\\mathrm{bwd}}$ 且逻辑斯谛函数 $L(\\lambda; \\lambda_{c}, w)$ 是 $\\lambda_c$ 的单调递减函数，因此对于所有 $\\lambda \\in [0,1]$，都有 $g_{\\mathrm{fwd}}(\\lambda) \\ge g_{\\mathrm{bwd}}(\\lambda)$（假设 $c>0$，所有测试用例中均如此）。因此，在这些情况下，$H=A$。\n\n最后，如果这两个指标中的任何一个超过预定阈值，系统将被标记为存在显著的亚稳态：\n$$\n\\mathrm{MS} = (|H| > \\tau_{H}) \\vee (A > \\tau_{A})\n$$\n\n**3. 数值实现**\n\n按照规定，使用复合辛普森法则进行数值计算。\n1.  对于每个测试用例，在区间 $[0, 1]$ 上为 $\\lambda$ 创建一个包含 $N$ 个点的均匀网格。网格间距为 $h=1/(N-1)$。选择 $N$ 为奇数，以确保有偶数个子区间，这是该法则的要求。\n2.  在 $\\lambda$ 网格的每个点上计算函数 $g_{\\mathrm{fwd}}(\\lambda)$ 和 $g_{\\mathrm{bwd}}(\\lambda)$，得到两个函数值数组。\n3.  通过对相应的函数值数组应用复合辛普森法则，计算 $\\Delta F_{\\mathrm{fwd}}$、$\\Delta F_{\\mathrm{bwd}}$ 和 $A$ 的定积分。`scipy.integrate.simpson` 函数提供了此法则的高效准确实现。\n4.  通过对 $g_{\\mathrm{fwd}}$ 值进行积分来计算 $\\Delta F_{\\mathrm{fwd}}$。\n5.  通过对 $g_{\\mathrm{bwd}}$ 值进行积分来计算 $\\Delta F_{\\mathrm{bwd}}$。\n6.  $H$ 作为简单差值计算：$H = \\Delta F_{\\mathrm{fwd}} - \\Delta F_{\\mathrm{bwd}}$。\n7.  $A$ 的被积函数在网格上计算为 $|g_{\\mathrm{fwd}} - g_{\\mathrm{bwd}}|$，然后对这个新数组进行积分以求得 $A$。\n8.  使用计算出的 $H$ 和 $A$ 以及给定的阈值 $\\tau_H$ 和 $\\tau_A$ 来评估布尔标志 $\\mathrm{MS}$。\n9.  所有浮点数结果（$\\Delta F_{\\mathrm{fwd}}, \\Delta F_{\\mathrm{bwd}}, H, A$）均四舍五入至六位小数。每个用例的结果被编译成指定的列表格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import simpson\n\ndef solve():\n    \"\"\"\n    Implements and analyzes a hysteresis test for Thermodynamic Integration (TI).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (a, b, c, l_c_fwd, w_fwd, l_c_bwd, w_bwd, N, tau_H, tau_A)\n    test_cases = [\n        (0.5, 0.4, 1.2, 0.5, 0.1, 0.5, 0.1, 20001, 0.01, 0.05),\n        (0.4, 0.6, 1.0, 0.4, 0.08, 0.6, 0.08, 20001, 0.01, 0.05),\n        (0.3, 0.2, 2.5, 0.2, 0.02, 0.8, 0.02, 20001, 0.05, 0.10),\n        (0.2, 0.1, 1.5, 0.05, 0.03, 0.95, 0.03, 20001, 0.02, 0.08),\n    ]\n\n    all_results = []\n\n    def g_base(lam, a, b):\n        \"\"\"Baseline contribution to the generalized force.\"\"\"\n        return a * np.sin(2 * np.pi * lam) + b * lam\n\n    def L_func(lam, lam_c, w):\n        \"\"\"Sigmoidal switching function (logistic function).\"\"\"\n        # Add a small epsilon to the denominator of the exponent to avoid division by zero if w=0\n        # Although problem cases have w > 0, this is good practice.\n        w_safe = w if w != 0 else 1e-9\n        return 1.0 / (1.0 + np.exp(-(lam - lam_c) / w_safe))\n\n    for case in test_cases:\n        a, b, c, l_c_fwd, w_fwd, l_c_bwd, w_bwd, N, tau_H, tau_A = case\n\n        # 1. Create a uniform grid for lambda from 0 to 1 with N points.\n        lambda_grid = np.linspace(0.0, 1.0, N)\n\n        # 2. Evaluate the generalized force functions on the grid.\n        g_base_vals = g_base(lambda_grid, a, b)\n        \n        g_fwd_vals = g_base_vals + c * L_func(lambda_grid, l_c_fwd, w_fwd)\n        g_bwd_vals = g_base_vals + c * L_func(lambda_grid, l_c_bwd, w_bwd)\n\n        # 3. Compute free energy differences using composite Simpson's rule.\n        # Scipy's simpson function takes the y-values and the x-values (the grid).\n        delta_F_fwd = simpson(y=g_fwd_vals, x=lambda_grid)\n        delta_F_bwd = simpson(y=g_bwd_vals, x=lambda_grid)\n\n        # 4. Quantify hysteresis.\n        # H is the signed difference of the integrated free energies.\n        H = delta_F_fwd - delta_F_bwd\n        \n        # A is the integral of the absolute difference of the force curves.\n        g_diff_vals = np.abs(g_fwd_vals - g_bwd_vals)\n        A = simpson(y=g_diff_vals, x=lambda_grid)\n\n        # 5. Determine the metastability flag.\n        MS = (np.abs(H) > tau_H) or (A > tau_A)\n\n        # 6. Format the results for the current case.\n        # Round floats to six decimal places, MS is a boolean.\n        case_result = [\n            round(delta_F_fwd, 6),\n            round(delta_F_bwd, 6),\n            round(H, 6),\n            round(A, 6),\n            MS\n        ]\n        all_results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # Use a custom string representation for the list of lists.\n    result_str = \",\".join([str(res) for res in all_results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        }
    ]
}