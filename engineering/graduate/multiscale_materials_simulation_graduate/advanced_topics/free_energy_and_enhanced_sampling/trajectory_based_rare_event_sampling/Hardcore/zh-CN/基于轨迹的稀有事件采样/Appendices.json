{
    "hands_on_practices": [
        {
            "introduction": "路径采样方法的核心在于能够正确地从稀有事件的轨迹系综中进行抽样。为了确保采样不偏不倚，算法中的每一步“移动”（例如过渡路径采样(Transition Path Sampling, TPS)中的“打靶”移动）都必须满足细致平衡条件。这个练习将带你亲手实践，推导出一个关键的接收概率，正是这个概率在数学上保证了细致平衡得以满足。通过这个练习，你将把抽象的统计力学原理与采样算法的具体实现联系起来。",
            "id": "3856096",
            "problem": "考虑一个质量为 $m$ 的粒子，在一个 $d$ 维双势阱 $U(\\mathbf{x})$ 中遵循朗之万动力学演化，其摩擦系数为 $\\gamma$，且在温度 $T$ 下的热噪声符合涨落-耗散定理。朗之万方程为\n$$\nm \\dot{\\mathbf{v}}(t) = -\\nabla U(\\mathbf{x}(t)) - \\gamma m \\mathbf{v}(t) + \\sqrt{2 \\gamma m k_{B} T}\\,\\boldsymbol{\\eta}(t),\n$$\n其中 $\\boldsymbol{\\eta}(t)$ 是一个由独立高斯白噪声过程组成的向量，而 $k_{B}$ 是玻尔兹曼常数。该动力学具有如下的稳态正则相空间分布\n$$\n\\rho(\\mathbf{x},\\mathbf{p}) \\propto \\exp\\!\\left(-\\beta \\left[U(\\mathbf{x}) + \\frac{\\|\\mathbf{p}\\|^{2}}{2m}\\right]\\right), \\quad \\text{with } \\beta = \\frac{1}{k_{B} T}.\n$$\n我们使用过渡路径采样 (Transition Path Sampling, TPS) 方法，研究跨越分隔势阱的势垒、从势阱 $A$ 到势阱 $B$ 的稀有反应轨迹。在一次 TPS 打靶移动中，我们从一条反应轨迹上选择一个时间片 $t_{s}$，并通过如下方式扰动该时间片上的动量来生成一条新轨迹：\n$$\n\\mathbf{p}' = \\mathbf{p} + \\delta \\mathbf{p},\n$$\n其中扰动 $\\delta \\mathbf{p}$ 从一个均值为零、协方差为 $m \\sigma^{2} \\mathbf{I}$ 的对称高斯分布中抽取，即\n$$\ng(\\delta \\mathbf{p}) = \\frac{1}{(2\\pi m \\sigma^{2})^{d/2}} \\exp\\!\\left(-\\frac{\\|\\delta \\mathbf{p}\\|^{2}}{2 m \\sigma^{2}}\\right).\n$$\n假设打靶时间 $t_{s}$ 在轨迹上是均匀选择的，并且前向和后向积分使用相同的随机传播子（与给定的朗之万方程一致）。以原始轨迹和提议的新轨迹均满足 $A \\to B$ 边界条件为前提，因此拒绝的发生完全是由于为在反应路径系综中强制执行细致平衡所需的 Metropolis 接受准则。\n\n从第一性原理出发，推导针对此对称高斯动量扰动的 Metropolis 接受概率 $\\alpha(\\delta \\mathbf{p})$，并用 $\\beta$、$m$、$\\mathbf{p}$ 和 $\\delta \\mathbf{p}$ 表示。然后，计算当打靶时间片上的动量为 $\\mathbf{p} = \\mathbf{0}$ 时的平均接受概率。具体而言，即计算\n$$\n\\mathbb{E}_{\\delta \\mathbf{p} \\sim \\mathcal{N}(\\mathbf{0}, m \\sigma^{2} \\mathbf{I})}\\left[\\alpha(\\delta \\mathbf{p})\\right],\n$$\n并将您的最终答案表示为仅含 $\\beta$、$d$ 和 $\\sigma^{2}$ 的单一闭式解析表达式。接受概率是无量纲的，不需要单位。无需进行数值取整；请提供精确的解析表达式。",
            "solution": "问题要求在一次过渡路径采样 (TPS) 打靶移动中，推导对称高斯动量扰动的 Metropolis 接受概率，然后计算在特定条件下该概率的平均值。\n\n**第一步：问题验证**\n\n首先，我将验证问题陈述。\n\n**已知条件：**\n-   **系统动力学：** 质量为 $m$ 的粒子在 $d$ 维势 $U(\\mathbf{x})$ 中遵循朗之万动力学演化：\n    $$m \\dot{\\mathbf{v}}(t) = -\\nabla U(\\mathbf{x}(t)) - \\gamma m \\mathbf{v}(t) + \\sqrt{2 \\gamma m k_{B} T}\\,\\boldsymbol{\\eta}(t)$$\n    其中 $\\boldsymbol{\\eta}(t)$ 是高斯白噪声。\n-   **稳态分布：** 该动力学采样正则相空间分布：\n    $$\\rho(\\mathbf{x},\\mathbf{p}) \\propto \\exp\\!\\left(-\\beta \\left[U(\\mathbf{x}) + \\frac{\\|\\mathbf{p}\\|^{2}}{2m}\\right]\\right), \\quad \\text{with } \\beta = \\frac{1}{k_{B} T}$$\n-   **TPS 移动：** 通过从一条反应轨迹 ($A \\to B$) 中选择一个时间片 $t_s$ 并将动量 $\\mathbf{p}$ 扰动为 $\\mathbf{p}'$ 来执行一次打靶移动：\n    $$\\mathbf{p}' = \\mathbf{p} + \\delta \\mathbf{p}$$\n-   **扰动分布：** 扰动 $\\delta \\mathbf{p}$ 从一个对称高斯分布中抽取：\n    $$g(\\delta \\mathbf{p}) = \\frac{1}{(2\\pi m \\sigma^{2})^{d/2}} \\exp\\!\\left(-\\frac{\\|\\delta \\mathbf{p}\\|^{2}}{2 m \\sigma^{2}}\\right)$$\n    该分布是对称的，即 $g(\\delta \\mathbf{p}) = g(-\\delta \\mathbf{p})$。\n-   **假设：** $t_s$ 是均匀选择的。前向和后向随机传播子相同。新旧轨迹都被限定为从 $A$ 到 $B$ 的反应路径。\n-   **目标：**\n    1.  推导 Metropolis 接受概率 $\\alpha(\\delta \\mathbf{p})$。\n    2.  计算在打靶时间片上的动量为 $\\mathbf{p} = \\mathbf{0}$ 的特定情况下，平均接受概率 $\\mathbb{E}_{\\delta \\mathbf{p}}[\\alpha(\\delta \\mathbf{p})]$。\n\n**验证结论：**\n该问题具有科学依据，提法明确且客观。它描述了计算统计力学中的一个标准程序（过渡路径采样），并将其应用于一个经典的物理模型（朗之万动力学）。所有定义和条件都是标准的且自洽的。该问题是多尺度材料模拟领域一个有效的理论练习。\n\n**第二步：接受概率 $\\alpha(\\delta \\mathbf{p})$ 的推导**\n\n从旧路径 $\\mathcal{X}_{old}$ 移动到新路径 $\\mathcal{X}_{new}$ 的 Metropolis-Hastings 接受概率 $\\alpha$ 由下式给出：\n$$ \\alpha(\\mathcal{X}_{old} \\to \\mathcal{X}_{new}) = \\min\\left(1, \\frac{\\mathcal{P}[\\mathcal{X}_{new}] \\, P_{gen}(\\mathcal{X}_{new} \\to \\mathcal{X}_{old})}{\\mathcal{P}[\\mathcal{X}_{old}] \\, P_{gen}(\\mathcal{X}_{old} \\to \\mathcal{X}_{new})}\\right) $$\n其中 $\\mathcal{P}[\\mathcal{X}]$ 是路径 $\\mathcal{X}$ 在目标系综中的概率，而 $P_{gen}$ 是该移动的生成概率。\n\n从旧路径 $\\mathcal{X}_{old}$ 生成新路径 $\\mathcal{X}_{new}$ 的过程包括：选取一个时间片 $t_s$ （对于长度为 $L$ 的路径，其概率密度为 $1/L$）以及从提议分布 $g(\\delta \\mathbf{p})$ 中抽取一个动量扰动 $\\delta \\mathbf{p}$。因此，生成概率为 $P_{gen}(\\mathcal{X}_{old} \\to \\mathcal{X}_{new}) \\propto g(\\delta \\mathbf{p})$。\n\n为了通过逆向移动从新路径 $\\mathcal{X}_{new}$ 生成旧路径 $\\mathcal{X}_{old}$，需要选择相同的时间片 $t_s$。在新路径上 $t_s$ 时刻的动量是 $\\mathbf{p}'$。为了恢复旧动量 $\\mathbf{p}$，所需的扰动为 $\\delta \\mathbf{p}_{rev} = \\mathbf{p} - \\mathbf{p}' = -\\delta \\mathbf{p}$。这个逆向移动的生成概率为 $P_{gen}(\\mathcal{X}_{new} \\to \\mathcal{X}_{old}) \\propto g(-\\delta \\mathbf{p})$。\n\n由于给定的提议分布 $g$ 是对称的，即 $g(\\delta \\mathbf{p}) = g(-\\delta \\mathbf{p})$，因此生成概率的比值为 1：\n$$ \\frac{P_{gen}(\\mathcal{X}_{new} \\to \\mathcal{X}_{old})}{P_{gen}(\\mathcal{X}_{old} \\to \\mathcal{X}_{new})} = \\frac{g(-\\delta\\mathbf{p})}{g(\\delta \\mathbf{p})} = 1 $$\n\n接受概率简化为仅依赖于目标系综中路径概率比值的形式：\n$$ \\alpha = \\min\\left(1, \\frac{\\mathcal{P}[\\mathcal{X}_{new}]}{\\mathcal{P}[\\mathcal{X}_{old}]}\\right) $$\n问题陈述我们以路径端点分别位于势阱 $A$ 和 $B$ 为条件，因此我们认为路径概率 $\\mathcal{P}[\\mathcal{X}]$ 与路径的内禀概率 $P[\\mathcal{X}]$ 成正比。\n\n对于一个时间可逆且具有稳态分布 $\\rho(\\mathbf{x}, \\mathbf{p})$ 的随机过程，例如本问题所考虑的朗之万动力学，其打靶移动的路径概率比值由打靶时间片上相空间点的稳态概率比值给出：\n$$ \\frac{P[\\mathcal{X}_{new}]}{P[\\mathcal{X}_{old}]} = \\frac{\\rho(\\mathbf{x}(t_s), \\mathbf{p}_{new}(t_s))}{\\rho(\\mathbf{x}(t_s), \\mathbf{p}_{old}(t_s))} $$\n设旧路径上打靶时间片 $t_s$ 处的状态为 $(\\mathbf{x}, \\mathbf{p})$。新动量为 $\\mathbf{p}' = \\mathbf{p} + \\delta\\mathbf{p}$，而在扰动瞬间位置 $\\mathbf{x}$ 保持不变。使用给定的稳态分布 $\\rho(\\mathbf{x},\\mathbf{p}) \\propto \\exp(-\\beta [U(\\mathbf{x}) + \\frac{\\|\\mathbf{p}\\|^{2}}{2m}])$，该比值为：\n$$ \\frac{\\rho(\\mathbf{x}, \\mathbf{p}')}{\\rho(\\mathbf{x}, \\mathbf{p})} = \\frac{\\exp(-\\beta [U(\\mathbf{x}) + \\frac{\\|\\mathbf{p}'\\|^{2}}{2m}])}{\\exp(-\\beta [U(\\mathbf{x}) + \\frac{\\|\\mathbf{p}\\|^{2}}{2m}])} = \\exp\\left(-\\frac{\\beta}{2m} (\\|\\mathbf{p}'\\|^2 - \\|\\mathbf{p}\\|^2)\\right) $$\n代入 $\\|\\mathbf{p}'\\|^2 = \\|\\mathbf{p} + \\delta\\mathbf{p}\\|^2 = \\|\\mathbf{p}\\|^2 + 2\\mathbf{p}\\cdot\\delta\\mathbf{p} + \\|\\delta\\mathbf{p}\\|^2$：\n$$ \\frac{P[\\mathcal{X}_{new}]}{P[\\mathcal{X}_{old}]} = \\exp\\left(-\\frac{\\beta}{2m} (2\\mathbf{p}\\cdot\\delta\\mathbf{p} + \\|\\delta\\mathbf{p}\\|^2)\\right) $$\n因此，对于在打靶点动量为 $\\mathbf{p}$ 的情况下的扰动 $\\delta \\mathbf{p}$，其 Metropolis 接受概率为：\n$$ \\alpha(\\delta \\mathbf{p}) = \\min\\left(1, \\exp\\left(-\\frac{\\beta}{2m} (2\\mathbf{p}\\cdot\\delta\\mathbf{p} + \\|\\delta\\mathbf{p}\\|^2)\\right)\\right) $$\n\n**第三步：平均接受概率的计算**\n\n题目要求我们在打靶时间片上动量为 $\\mathbf{p} = \\mathbf{0}$ 的特定情况下，计算 $\\alpha(\\delta \\mathbf{p})$ 在扰动 $\\delta \\mathbf{p}$ 的分布上的平均值。\n首先，我们在 $\\mathbf{p} = \\mathbf{0}$ 处计算 $\\alpha(\\delta \\mathbf{p})$：\n$$ \\alpha(\\delta \\mathbf{p})|_{\\mathbf{p}=\\mathbf{0}} = \\min\\left(1, \\exp\\left(-\\frac{\\beta}{2m} \\|\\delta\\mathbf{p}\\|^2\\right)\\right) $$\n由于 $\\beta > 0$、$m > 0$ 且 $\\|\\delta\\mathbf{p}\\|^2 \\ge 0$，指数函数的参数始终为非正数。因此，指数项总是小于或等于 1。表达式简化为：\n$$ \\alpha(\\delta \\mathbf{p})|_{\\mathbf{p}=\\mathbf{0}} = \\exp\\left(-\\frac{\\beta}{2m} \\|\\delta\\mathbf{p}\\|^2\\right) $$\n接下来，我们计算该量的期望值。扰动 $\\delta\\mathbf{p}$ 从分布 $g(\\delta\\mathbf{p})$ 中抽取。其期望值为：\n$$ \\mathbb{E}_{\\delta \\mathbf{p}}[\\alpha] = \\int_{\\mathbb{R}^d} \\alpha(\\delta \\mathbf{p})|_{\\mathbf{p}=\\mathbf{0}} \\, g(\\delta \\mathbf{p}) \\, d(\\delta\\mathbf{p}) $$\n代入 $\\alpha$ 和 $g$ 的表达式：\n$$ \\mathbb{E}_{\\delta \\mathbf{p}}[\\alpha] = \\int_{\\mathbb{R}^d} \\exp\\left(-\\frac{\\beta}{2m} \\|\\delta\\mathbf{p}\\|^2\\right) \\frac{1}{(2\\pi m \\sigma^{2})^{d/2}} \\exp\\left(-\\frac{\\|\\delta \\mathbf{p}\\|^{2}}{2 m \\sigma^{2}}\\right) d(\\delta\\mathbf{p}) $$\n我们可以合并指数部分：\n$$ \\mathbb{E}_{\\delta \\mathbf{p}}[\\alpha] = \\frac{1}{(2\\pi m \\sigma^{2})^{d/2}} \\int_{\\mathbb{R}^d} \\exp\\left(-\\|\\delta\\mathbf{p}\\|^2 \\left(\\frac{\\beta}{2m} + \\frac{1}{2m\\sigma^2}\\right)\\right) d(\\delta\\mathbf{p}) $$\n$$ \\mathbb{E}_{\\delta \\mathbf{p}}[\\alpha] = \\frac{1}{(2\\pi m \\sigma^{2})^{d/2}} \\int_{\\mathbb{R}^d} \\exp\\left(-\\frac{\\|\\delta\\mathbf{p}\\|^2}{2m} \\left(\\beta + \\frac{1}{\\sigma^2}\\right)\\right) d(\\delta\\mathbf{p}) $$\n这是一个标准的 $d$ 维高斯积分，其形式为 $\\int_{\\mathbb{R}^d} \\exp(-C\\|\\mathbf{y}\\|^2) d\\mathbf{y} = (\\pi/C)^{d/2}$。在本例中，变量为 $\\mathbf{y} = \\delta\\mathbf{p}$，常数为 $C = \\frac{1}{2m}(\\beta + \\frac{1}{\\sigma^2})$。该积分的值为：\n$$ \\int_{\\mathbb{R}^d} \\exp\\left(-\\frac{\\|\\delta\\mathbf{p}\\|^2}{2m} \\left(\\beta + \\frac{1}{\\sigma^2}\\right)\\right) d(\\delta\\mathbf{p}) = \\left(\\frac{\\pi}{\\frac{1}{2m}(\\beta + \\frac{1}{\\sigma^2})}\\right)^{d/2} = \\left(\\frac{2\\pi m}{\\beta + 1/\\sigma^2}\\right)^{d/2} $$\n将此结果代回期望值的表达式中：\n$$ \\mathbb{E}_{\\delta \\mathbf{p}}[\\alpha] = \\frac{1}{(2\\pi m \\sigma^{2})^{d/2}} \\left( \\frac{2\\pi m}{\\beta + 1/\\sigma^2} \\right)^{d/2} $$\n我们可以将各项合并到同一个幂次下：\n$$ \\mathbb{E}_{\\delta \\mathbf{p}}[\\alpha] = \\left( \\frac{2\\pi m}{(2\\pi m \\sigma^2)(\\beta + 1/\\sigma^2)} \\right)^{d/2} = \\left( \\frac{1}{\\sigma^2 (\\beta + 1/\\sigma^2)} \\right)^{d/2} $$\n$$ \\mathbb{E}_{\\delta \\mathbf{p}}[\\alpha] = \\left( \\frac{1}{1 + \\beta\\sigma^2} \\right)^{d/2} = (1 + \\beta\\sigma^2)^{-d/2} $$\n这就是用 $\\beta$、$d$ 和 $\\sigma^2$ 表示的平均接受概率的最终闭式解析表达式。",
            "answer": "$$\\boxed{(1 + \\beta\\sigma^2)^{-d/2}}$$"
        },
        {
            "introduction": "在完成像前向通量采样(Forward Flux Sampling, FFS)这样的模拟后，我们得到的是原始数据：初始通量计算中的穿越事件数，以及在各个界面上的试探轨迹成功与否的记录。接下来的关键一步，是将这些原始数据转化为有物理意义的量——也就是反应速率——并量化其不确定性。这个练习模拟了计算科学家在数据分析阶段的真实任务。它将教会你如何将各个部分的估计值组合成最终的速率，以及如何运用误差传播理论来计算我们对结果的置信度。",
            "id": "3856102",
            "problem": "一种晶体表现出从亚稳态盆地 $\\mathcal{A}$ 到产物盆地 $\\mathcal{B}$ 的稀有成核事件。使用基于轨迹的稀有事件采样方法——前向通量采样 (FFS)，在序参数 $\\lambda$ 中构建了一系列界面：$\\lambda_{1}  \\lambda_{2}  \\lambda_{3}  \\lambda_{4}$，用以分隔 $\\mathcal{A}$ 和 $\\mathcal{B}$。在一次从 $\\mathcal{A}$ 开始、在恒定温度下进行的长分子动力学模拟中，总模拟时间 $T$ 内从 $\\mathcal{A}$ 到第一个界面 $\\lambda_{1}$ 的前向穿越次数被记为 $n_{0}$。随后，在每个界面 $\\lambda_{i}$ 处，从存储的穿越构型发射 $N_{i}$ 条尝试轨迹，并记录在返回 $\\mathcal{A}$ 之前到达下一个界面 $\\lambda_{i+1}$ 的轨迹数量 $M_{i}$。\n\n假设以下为科学上合理的测量值：\n- 总模拟时间 $T = 50000$ ns，记录的前向穿越次数 $n_{0} = 135$。\n- 在 $\\lambda_{1}$ 处：$N_{1} = 1000$, $M_{1} = 360$。\n- 在 $\\lambda_{2}$ 处：$N_{2} = 800$, $M_{2} = 240$。\n- 在 $\\lambda_{3}$ 处：$N_{3} = 600$, $M_{3} = 150$。\n- 在 $\\lambda_{4}$ 处：$N_{4} = 500$, $M_{4} = 50$。\n\n从适用于多尺度材料模拟中稀有事件采样的第一性原理出发：\n- 用离开 $\\mathcal{A}$ 的稳态反应通量和通过顺序界面穿越到达 $\\mathcal{B}$ 的概率来定义速率常数 $k_{\\mathcal{A}\\mathcal{B}}$。\n- 将 $n_{0}$ 视为泊松过程的实现，将每个 $M_{i}$ 视为成功概率为 $P(\\lambda_{i+1}\\mid\\lambda_{i})$ 的二项过程的实现。\n- 假设通量和条件概率的估计量相互独立，使用一阶（线性）误差传播方法推导 $k_{\\mathcal{A}\\mathcal{B}}$ 的乘积估计量的方差。\n\n计算：\n1. $k_{\\mathcal{A}\\mathcal{B}}$ 的数值估计。\n2. $k_{\\mathcal{A}\\mathcal{B}}$ 的乘积估计量的方差的数值估计。\n\n将最终速率常数以 ns$^{-1}$ 为单位表示，方差以 ns$^{-2}$ 为单位表示。将两个量均四舍五入至三位有效数字。",
            "solution": "用户要求解答一个涉及使用前向通量采样 (FFS) 计算反应速率常数及其方差的问题。该问题已经过验证，被认为是科学上合理、问题明确且客观的。\n\n从亚稳态盆地 $\\mathcal{A}$ 到产物盆地 $\\mathcal{B}$ 的跃迁速率常数 $k_{\\mathcal{A}\\mathcal{B}}$ 定义为离开盆地 $\\mathcal{A}$ 穿过第一个界面 $\\lambda_1$ 的稳态通量 $\\Phi_0$ 与穿过 $\\lambda_1$ 的轨迹在返回 $\\mathcal{A}$ 之前最终到达盆地 $\\mathcal{B}$ 的概率 $P(\\mathcal{B}|\\lambda_1)$ 的乘积。在 FFS 中，这个概率被分解为穿过一系列不重叠界面 $\\lambda_i$ 的条件概率的乘积。\n速率常数由以下表达式给出：\n$$k_{\\mathcal{A}\\mathcal{B}} = \\Phi_0 P(\\lambda_2|\\lambda_1) P(\\lambda_3|\\lambda_2) \\dots P(\\mathcal{B}|\\lambda_k)$$\n在这个问题中，有 $k=4$ 个界面，$\\lambda_1, \\lambda_2, \\lambda_3, \\lambda_4$，而盆地 $\\mathcal{B}$ 是 $\\lambda_4$ 以外的区域。我们用 $\\lambda_0$ 表示盆地 $\\mathcal{A}$ 的边界，用 $\\lambda_5$ 表示盆地 $\\mathcal{B}$ 的边界。则速率常数为：\n$$k_{\\mathcal{A}\\mathcal{B}} = \\Phi_0 \\prod_{i=1}^{4} P(\\lambda_{i+1}|\\lambda_i)$$\n\n该问题提供了估计每一项的数据。通量和条件概率的估计量如下：\n1.  初始通量 $\\hat{\\Phi}_0$ 的估计量是从 $\\mathcal{A}$到 $\\lambda_1$ 的前向穿越次数 $n_0$ 除以在 $\\mathcal{A}$ 中花费的总模拟时间 $T$：\n    $$\\hat{\\Phi}_0 = \\frac{n_0}{T}$$\n2.  每个条件概率 $\\hat{P}_i = \\hat{P}(\\lambda_{i+1}|\\lambda_i)$ 的估计量是成功到达 $\\lambda_{i+1}$ 的尝试轨迹数 $M_i$ 与从 $\\lambda_i$ 发射的总尝试轨迹数 $N_i$ 的比值：\n    $$\\hat{P}_i = \\frac{M_i}{N_i}$$\n\n综合以上，速率常数 $\\hat{k}_{\\mathcal{A}\\mathcal{B}}$ 的估计量为：\n$$\\hat{k}_{\\mathcal{A}\\mathcal{B}} = \\hat{\\Phi}_0 \\prod_{i=1}^{4} \\hat{P}_i = \\frac{n_0}{T} \\left( \\frac{M_1}{N_1} \\right) \\left( \\frac{M_2}{N_2} \\right) \\left( \\frac{M_3}{N_3} \\right) \\left( \\frac{M_4}{N_4} \\right)$$\n\n首先，我们使用提供的数据计算 $k_{\\mathcal{A}\\mathcal{B}}$ 的数值估计：\n$T = 50000$ ns, $n_0 = 135$。\n在 $\\lambda_1$ 处：$N_1 = 1000$, $M_1 = 360$。\n在 $\\lambda_2$ 处：$N_2 = 800$, $M_2 = 240$。\n在 $\\lambda_3$ 处：$N_3 = 600$, $M_3 = 150$。\n在 $\\lambda_4$ 处：$N_4 = 500$, $M_4 = 50$。\n\n各个估计值如下：\n$\\hat{\\Phi}_0 = \\frac{135}{50000} \\text{ ns}^{-1} = 0.0027 \\text{ ns}^{-1} = 2.7 \\times 10^{-3} \\text{ ns}^{-1}$\n$\\hat{P}_1 = \\frac{360}{1000} = 0.36$\n$\\hat{P}_2 = \\frac{240}{800} = 0.3$\n$\\hat{P}_3 = \\frac{150}{600} = 0.25$\n$\\hat{P}_4 = \\frac{50}{500} = 0.1$\n\n估计的速率常数为：\n$$\\hat{k}_{\\mathcal{A}\\mathcal{B}} = (2.7 \\times 10^{-3}) \\times 0.36 \\times 0.3 \\times 0.25 \\times 0.1 = 7.29 \\times 10^{-6} \\text{ ns}^{-1}$$\n四舍五入到三位有效数字，估计值为 $7.29 \\times 10^{-6} \\text{ ns}^{-1}$。\n\n接下来，我们推导估计量 $\\hat{k}_{\\mathcal{A}\\mathcal{B}}$ 的方差。对于独立随机变量的乘积 $Y = X_0 X_1 \\dots X_n$，使用一阶误差传播，其相对方差是各个相对方差的和：\n$$\\left(\\frac{\\sigma_Y}{Y}\\right)^2 = \\sum_{j=0}^{n} \\left(\\frac{\\sigma_{X_j}}{X_j}\\right)^2$$\n将此应用于 $\\hat{k}_{\\mathcal{A}\\mathcal{B}}$，其方差 $\\text{Var}(\\hat{k}_{\\mathcal{A}\\mathcal{B}})$ 由下式给出：\n$$\\frac{\\text{Var}(\\hat{k}_{\\mathcal{A}\\mathcal{B}})}{\\hat{k}_{\\mathcal{A}\\mathcal{B}}^2} = \\frac{\\text{Var}(\\hat{\\Phi}_0)}{\\hat{\\Phi}_0^2} + \\sum_{i=1}^{4} \\frac{\\text{Var}(\\hat{P}_i)}{\\hat{P}_i^2}$$\n我们需要各个估计量的方差。\n1.  穿越次数 $n_0$ 是泊松过程的一个实现。泊松分布的方差等于其均值。事件数均值的最佳估计是 $n_0$。因此，$\\text{Var}(n_0) \\approx n_0$。通量估计量 $\\hat{\\Phi}_0 = n_0/T$ 的方差为：\n    $$\\text{Var}(\\hat{\\Phi}_0) = \\text{Var}\\left(\\frac{n_0}{T}\\right) = \\frac{1}{T^2}\\text{Var}(n_0) = \\frac{n_0}{T^2}$$\n    相对方差为：\n    $$\\frac{\\text{Var}(\\hat{\\Phi}_0)}{\\hat{\\Phi}_0^2} = \\frac{n_0/T^2}{(n_0/T)^2} = \\frac{1}{n_0}$$\n2.  成功尝试的次数 $M_i$ 服从二项分布 $B(N_i, P_i)$。$M_i$ 的方差是 $N_i P_i (1-P_i)$。概率估计量 $\\hat{P}_i = M_i/N_i$ 的方差为：\n    $$\\text{Var}(\\hat{P}_i) = \\text{Var}\\left(\\frac{M_i}{N_i}\\right) = \\frac{1}{N_i^2}\\text{Var}(M_i) = \\frac{N_i P_i (1-P_i)}{N_i^2} = \\frac{P_i (1-P_i)}{N_i}$$\n    使用估计量 $\\hat{P}_i$ 代替 $P_i$，估计方差为 $\\text{Var}(\\hat{P}_i) \\approx \\frac{\\hat{P}_i(1-\\hat{P}_i)}{N_i}$。相对方差为：\n    $$\\frac{\\text{Var}(\\hat{P}_i)}{\\hat{P}_i^2} \\approx \\frac{\\hat{P}_i(1-\\hat{P}_i)/N_i}{\\hat{P}_i^2} = \\frac{1-\\hat{P}_i}{N_i \\hat{P}_i} = \\frac{1-(M_i/N_i)}{N_i(M_i/N_i)} = \\frac{N_i-M_i}{N_i M_i}$$\n\n结合这些结果，速率常数的方差为：\n$$\\text{Var}(\\hat{k}_{\\mathcal{A}\\mathcal{B}}) = \\hat{k}_{\\mathcal{A}\\mathcal{B}}^2 \\left( \\frac{1}{n_0} + \\sum_{i=1}^{4} \\frac{N_i-M_i}{N_i M_i} \\right)$$\n现在我们计算方差的数值。\n求和项为：\n$\\frac{1}{n_0} = \\frac{1}{135} \\approx 0.0074074$\n$\\frac{N_1-M_1}{N_1 M_1} = \\frac{1000-360}{1000 \\times 360} = \\frac{640}{360000} \\approx 0.0017778$\n$\\frac{N_2-M_2}{N_2 M_2} = \\frac{800-240}{800 \\times 240} = \\frac{560}{192000} \\approx 0.0029167$\n$\\frac{N_3-M_3}{N_3 M_3} = \\frac{600-150}{600 \\times 150} = \\frac{450}{90000} = 0.005$\n$\\frac{N_4-M_4}{N_4 M_4} = \\frac{500-50}{500 \\times 50} = \\frac{450}{25000} = 0.018$\n\n括号中的项为：\n$$0.0074074 + 0.0017778 + 0.0029167 + 0.005 + 0.018 = 0.0351019$$\n方差为：\n$$\\text{Var}(\\hat{k}_{\\mathcal{A}\\mathcal{B}}) = (7.29 \\times 10^{-6})^2 \\times 0.0351019$$\n$$\\text{Var}(\\hat{k}_{\\mathcal{A}\\mathcal{B}}) = (5.31441 \\times 10^{-11}) \\times 0.0351019 \\approx 1.86548 \\times 10^{-12} \\text{ ns}^{-2}$$\n四舍五入到三位有效数字，方差为 $1.87 \\times 10^{-12} \\text{ ns}^{-2}$。\n\n最终结果如下：\n1.  $k_{\\mathcal{A}\\mathcal{B}}$ 的数值估计为 $7.29 \\times 10^{-6}$ ns$^{-1}$。\n2.  估计量的方差的数值估计为 $1.87 \\times 10^{-12}$ ns$^{-2}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 7.29 \\times 10^{-6} & 1.87 \\times 10^{-12} \\end{pmatrix}}$$"
        },
        {
            "introduction": "真正掌握一种算法的最好方法莫过于亲手实现它。这个练习为你提供了一个完整的蓝图，用于构建一个模拟材料科学中经典问题——成核现象——的前向通量采样(FFS)程序。通过编写Langevin动力学以及完整的FFS逻辑（包括通量测量和分阶段的试探），你将对该方法的工作原理获得深刻的理解，从单条轨迹的演化到最终速率的统计组装。这个练习将所有理论和数据分析的概念融合成一个可以工作的计算工具。",
            "id": "3856124",
            "problem": "设计一个完整、可运行的程序，使用前向通量采样 (FFS) 估计粗粒化 Lennard-Jones (LJ) 流体中的稀有事件成核率。该程序必须从第一性原理出发，实现一个基于轨迹的稀有事件采样方案，从一维序参量的过阻尼朗之万动力学开始。粗粒化序参量是核尺寸，记为 $\\lambda$，它被建模为一个在有效自由能作用下演化的连续随机过程。使用约化 Lennard-Jones (LJ) 单位，其中长度尺度为 $\\sigma$，能量尺度为 $\\epsilon$，质量为 $m$，时间尺度为 $\\tau = \\sigma \\sqrt{m / \\epsilon}$，所有速率以 $1/\\tau$ 表示。\n\n按如下方式构建模型：\n- 将粗粒化核尺寸表示为在一维空间中遵循过阻尼朗之万动力学演化的单一变量 $\\lambda(t)$。平衡自由能由正则化的经典成核形式建模\n$$\nU(\\lambda) = \\alpha \\left(\\lambda + \\lambda_{\\mathrm{reg}}\\right)^{2/3} - \\Delta \\mu \\, \\lambda,\n$$\n其中 $\\alpha$ 是表面能系数，$\\Delta \\mu$ 是过饱和驱动力，$\\lambda_{\\mathrm{reg}}$ 是一个小的正正则化常数，以避免在 $\\lambda = 0$ 附近出现奇异行为。\n- 序参量 $\\lambda$ 的过阻尼朗之万动力学由以下公式控制\n$$\n\\mathrm{d}\\lambda_t = - \\beta D \\, \\frac{\\partial U}{\\partial \\lambda}(\\lambda_t) \\, \\mathrm{d}t + \\sqrt{2 D} \\, \\mathrm{d}W_t,\n$$\n其中 $D$ 是 $\\lambda$ 空间中的恒定扩散系数，$\\beta = 1/(k_B T)$（其中 $T$ 是温度，$k_B$ 是玻尔兹曼常数），$W_t$ 是标准维纳过程。使用时间步长为 $dt$ 的离散时间模拟，采用与上述随机微分方程一致的数值稳定方案。在下界 $\\lambda = 0$ 处对 $\\lambda$ 进行反射，以强制其物理非负性。\n- 定义亚稳盆 $A$ 为集合 $\\{\\lambda \\, | \\, \\lambda  \\lambda_A\\}$，其中 $\\lambda_A$ 是一个阈值。定义一组递增的界面 $\\lambda_0  \\lambda_1  \\cdots  \\lambda_{M-1}$，以及由 $\\{\\lambda \\, | \\, \\lambda \\ge \\lambda_B\\}$ 定义的目标区域 $B$，其中 $\\lambda_B > \\lambda_{M-1}$。\n\n通过以下步骤实现前向通量采样 (FFS) 来估计从 $A$ 到 $B$ 的成核率：\n- 测量当系统处于 $A$ 中时，离开盆 $A$ 并穿过第一个界面 $\\lambda_0$ 的轨迹的初始通量，并按在 $A$ 中花费的时间进行归一化。\n- 从每个界面的穿越点开始生成试验轨迹，以估计在返回盆 $A$ 之前到达下一个界面（或在最终层级到达目标 $B$）的条件概率。\n- 结合初始通量与一系列界面间的条件概率，计算成核率的估计值，单位为 $1/\\tau$。\n\n所有模拟参数必须以约化 LJ 单位指定。角度不适用。输出必须是实值浮点数。\n\n程序必须解决以下测试套件，该套件包含三组参数，旨在在不同成核机制范围内（包括一般情况、具有更高势垒的更强亚稳情况以及具有更低势垒的更弱亚稳情况）探测算法。每个参数元组包含 $(\\alpha, \\Delta \\mu, T, D, dt, \\lambda_{\\mathrm{reg}}, \\lambda_A, \\text{interfaces}, \\lambda_B, M_{\\text{trials}}, N_{\\text{flux,max}}, N_{\\text{flux,min}}, N_{\\text{trial,max}}, \\text{seed})$：\n\n- 测试用例 1 (中等势垒)：\n  - $\\alpha = 2.0$, $\\Delta \\mu = 0.9$, $T = 0.7$, $D = 0.25$, $dt = 0.01$, $\\lambda_{\\mathrm{reg}} = 0.5$, $\\lambda_A = 0.6$,\n  - 界面：$[\\lambda_0, \\lambda_1, \\lambda_2] = [0.9, 1.5, 2.4]$,\n  - $\\lambda_B = 3.5$,\n  - $M_{\\text{trials}} = 25$, $N_{\\text{flux,max}} = 200000$, $N_{\\text{flux,min}} = 200$, $N_{\\text{trial,max}} = 2000$, $\\text{seed} = 12345$。\n\n- 测试用例 2 (较高势垒)：\n  - $\\alpha = 2.5$, $\\Delta \\mu = 0.7$, $T = 0.6$, $D = 0.20$, $dt = 0.01$, $\\lambda_{\\mathrm{reg}} = 0.5$, $\\lambda_A = 0.6$,\n  - 界面：$[\\lambda_0, \\lambda_1, \\lambda_2] = [1.0, 1.8, 2.8]$,\n  - $\\lambda_B = 4.2$,\n  - $M_{\\text{trials}} = 25$, $N_{\\text{flux,max}} = 250000$, $N_{\\text{flux,min}} = 150$, $N_{\\text{trial,max}} = 2500$, $\\text{seed} = 23456$。\n\n- 测试用例 3 (较低势垒)：\n  - $\\alpha = 1.5$, $\\Delta \\mu = 1.2$, $T = 0.8$, $D = 0.30$, $dt = 0.01$, $\\lambda_{\\mathrm{reg}} = 0.5$, $\\lambda_A = 0.5$,\n  - 界面：$[\\lambda_0, \\lambda_1, \\lambda_2, \\lambda_3] = [0.7, 1.0, 1.5, 2.2]$,\n  - $\\lambda_B = 3.0$,\n  - $M_{\\text{trials}} = 25$, $N_{\\text{flux,max}} = 200000$, $N_{\\text{flux,min}} = 200$, $N_{\\text{trial,max}} = 2000$, $\\text{seed} = 34567$。\n\n您的程序必须：\n- 实现与过阻尼朗之万方程和在 $\\lambda=0$ 处的反射边界一致的随机动力学。\n- 使用单条长轨迹测量从 $A$ 穿过 $\\lambda_0$ 的初始通量，该轨迹会累积在 $A$ 中花费的时间并计数穿越事件，直到观察到 $N_{\\text{flux,min}}$ 次穿越或达到 $N_{\\text{flux,max}}$ 步为止。\n- 对于每个界面层级，从每个穿越点传播 $M_{\\text{trials}}$ 条试验轨迹到下一个界面，或在最终层级传播到 $B$，如果轨迹返回到 $A$ 或到达目标，则提前停止。每次试验必须限制在 $N_{\\text{trial,max}}$ 步内，以保持计算可行性。\n- 聚合初始通量和条件概率的乘积，为每个测试用例估计成核率，单位为 $1/\\tau$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含三个速率估计值，格式为方括号内以逗号分隔的列表，例如 $[r_1, r_2, r_3]$，其中每个 $r_i$ 是为相应测试用例计算的浮点数，单位为 $1/\\tau$。",
            "solution": "`.\n\n**问题验证步骤：**\n\n**步骤 1：提取给定信息**\n我需要逐字列出问题陈述中提供的所有信息。\n\n*   **主题：** 多尺度材料模拟背景下的基于轨迹的稀有事件采样，特别是前向通量采样 (FFS)。\n*   **系统：** 粗粒化 Lennard-Jones (LJ) 流体。\n*   **序参量：** 核尺寸 $\\lambda(t)$，一个连续的一维随机变量。\n*   **自由能：**\n    $$\n    U(\\lambda) = \\alpha \\left(\\lambda + \\lambda_{\\mathrm{reg}}\\right)^{2/3} - \\Delta \\mu \\, \\lambda\n    $$\n    -   $\\alpha$：表面能系数\n    -   $\\Delta \\mu$：过饱和驱动力\n    -   $\\lambda_{\\mathrm{reg}}$：正则化常数\n*   **动力学：** 一维过阻尼朗之万动力学。\n    $$\n    \\mathrm{d}\\lambda_t = - \\beta D \\, \\frac{\\partial U}{\\partial \\lambda}(\\lambda_t) \\, \\mathrm{d}t + \\sqrt{2 D} \\, \\mathrm{d}W_t\n    $$\n    -   $D$：$\\lambda$ 空间中的扩散系数\n    -   $\\beta = 1/(k_B T)$\n    -   $T$：温度\n    -   $k_B$：玻尔兹曼常数 (在 LJ 单位中, $k_B=1$)\n    -   $W_t$：标准维纳过程\n*   **数值积分：**\n    -   使用时间步长 $dt$ 的离散时间模拟。\n    -   在 $\\lambda = 0$ 处使用反射边界条件。\n*   **FFS 区域：**\n    -   亚稳盆 $A$：$\\{\\lambda \\, | \\, \\lambda  \\lambda_A\\}$\n    -   界面：$\\lambda_0  \\lambda_1  \\cdots  \\lambda_{M-1}$\n    -   目标区域 $B$：$\\{\\lambda \\, | \\, \\lambda \\ge \\lambda_B\\}$，其中 $\\lambda_B > \\lambda_{M-1}$\n*   **FFS 算法：**\n    1.  测量从 $A$ 穿过 $\\lambda_0$ 的初始通量 $\\Phi_{A,0}$。\n    2.  估计条件概率 $P(\\lambda_{i+1} | \\lambda_i)$。\n    3.  计算总速率 $R_{AB} = \\Phi_{A,0} \\prod_{i=0}^{M-2} P(\\lambda_{i+1} | \\lambda_i) P(B|\\lambda_{M-1})$。\n*   **单位：** 约化 Lennard-Jones (LJ) 单位。速率单位为 $1/\\tau$。在 LJ 单位中，$\\sigma=1$，$\\epsilon=1$， $m=1$，因此 $\\tau=1$。以 $1/\\tau$ 为单位的速率就是数值速率。此外，$k_B=1$。\n*   **测试用例：** 三组参数。\n    -   **用例 1：**\n        -   $\\alpha = 2.0$, $\\Delta \\mu = 0.9$, $T = 0.7$, $D = 0.25$, $dt = 0.01$, $\\lambda_{\\mathrm{reg}} = 0.5$, $\\lambda_A = 0.6$,\n        -   界面：$[0.9, 1.5, 2.4]$,\n        -   $\\lambda_B = 3.5$,\n        -   $M_{\\text{trials}} = 25$, $N_{\\text{flux,max}} = 200000$, $N_{\\text{flux,min}} = 200$, $N_{\\text{trial,max}} = 2000$, $\\text{seed} = 12345$。\n    -   **用例 2：**\n        -   $\\alpha = 2.5$, $\\Delta \\mu = 0.7$, $T = 0.6$, $D = 0.20$, $dt = 0.01$, $\\lambda_{\\mathrm{reg}} = 0.5$, $\\lambda_A = 0.6$,\n        -   界面：$[1.0, 1.8, 2.8]$,\n        -   $\\lambda_B = 4.2$,\n        -   $M_{\\text{trials}} = 25$, $N_{\\text{flux,max}} = 250000$, $N_{\\text{flux,min}} = 150$, $N_{\\text{trial,max}} = 2500$, $\\text{seed} = 23456$。\n    -   **用例 3：**\n        -   $\\alpha = 1.5$, $\\Delta \\mu = 1.2$, $T = 0.8$, $D = 0.30$, $dt = 0.01$, $\\lambda_{\\mathrm{reg}} = 0.5$, $\\lambda_A = 0.5$,\n        -   界面：$[0.7, 1.0, 1.5, 2.2]$,\n        -   $\\lambda_B = 3.0$,\n        -   $M_{\\text{trials}} = 25$, $N_{\\text{flux,max}} = 200000$, $N_{\\text{flux,min}} = 200$, $N_{\\text{trial,max}} = 2000$, `seed` = 34567。\n*   **实现细节：**\n    -   通量计算：单条长轨迹，在达到 $N_{\\text{flux,min}}$ 次穿越或 $N_{\\text{flux,max}}$ 步时终止。\n    -   试验轨迹：从每个穿越点出发进行 $M_{\\text{trials}}$ 次试验。如果轨迹返回到 $A$ 或到达目标，则终止。每次试验的最大步数为 $N_{\\text{trial,max}}$。\n*   **最终输出格式：** `[r_1, r_2, r_3]`\n\n**步骤 2：使用提取的给定信息进行验证**\n\n1.  **科学上是否成立？**\n    -   该问题描述了一个成核的粗粒化模型，这是材料科学和化学中一个成熟的现象。\n    -   自由能形式 $U(\\lambda) = \\alpha \\lambda^{2/3} - \\Delta \\mu \\lambda$ 是经典成核理论 (CNT) 的主要内容，代表了表面能成本和体自由能增益之间的平衡。正则化项 $\\lambda_{\\mathrm{reg}}$ 是一种标准的数值技术，用于避免在 $\\lambda=0$ 处的导数奇异性。\n    -   动力学由过阻尼朗之万方程控制，这是模拟与热浴耦合的粗粒化变量随机演化的标准且物理上合理的模型。这是对此类过程建模的常见起点。\n    -   前向通量采样 (FFS) 是一种著名且功能强大的稀有事件采样算法，广泛应用于计算物理和化学领域。\n    -   使用约化 LJ 单位是分子模拟中的标准做法。\n    -   **结论：** 该问题在科学上是成立的。所有模型和方法都是该领域的标准方法。\n\n2.  **是否适定（Well-Posed）？**\n    -   目标是估计一个速率，这是一个统计量。问题提供了一个特定的算法 (FFS) 和所有必要的参数。\n    -   参数（$M_{\\text{trials}}$、$N_{\\text{flux,...}}$ 等）旨在确保模拟能够终止并产生有限的结果。\n    -   随机性意味着结果不会是一个单一的确定性数字，而是一个*估计值*。提供了种子以确保可复现性，使得对于给定的实现，输出是唯一的。\n    -   问题设置清晰：从盆 A 中的初始状态过渡到状态 B，中间有界面。A、B 和界面的定义是精确的。\n    -   **结论：** 该问题是适定的。它要求基于一个明确定义的随机算法和一套完整的参数进行数值估计。\n\n3.  **是否客观？**\n    -   该问题完全是定量的，用数学公式和数值指定。没有主观或基于意见的陈述。\n    -   **结论：** 该问题是客观的。\n\n4.  **缺陷检查：**\n    -   **科学/事实上不健全：** 无。物理和方法都是标准的。\n    -   **非形式化/不相关：** 该问题是高度形式化的，是将稀有事件采样技术 (FFS) 应用于材料模拟问题（成核）的教科书式例子。它与指定主题直接相关。\n    -   **不完整/矛盾：** 为三个不同的测试用例提供了所有参数。没有矛盾之处。区域 $A$、$B$ 和界面的定义是清晰的。动力学被完全指定。FFS 过程的描述足够详细。\n    -   **不现实/不可行：** 参数是为计算问题选择的。它们不必对应于特定的真实材料，但在模型的框架内是物理上合理的。考虑到约束条件（$N_{\\text{flux,max}}$、$N_{\\text{trial,max}}$），计算负载似乎是可管理的。\n    -   **不适定/结构不良：** 否。预期会得到一个唯一（对于给定的种子）且有意义（一个速率估计）的解。术语定义明确。\n    -   **伪深刻/琐碎：** 该问题并非微不足道。它要求在一个不平凡的物理模型（基于类 CNT 势的朗之万动力学）上实现一个复杂的采样算法 (FFS)。\n    -   **超出科学可验证性：** 结果可以通过使用给定种子运行指定算法来验证。\n\n**步骤 3：结论与行动**\n\n该问题是**有效的**。这是一个定义明确、科学合理且不平凡的计算物理问题。开始解决问题。\n\n该问题要求实现前向通量采样 (FFS) 算法，以在粗粒化模型中估计成核速率（一种稀有事件）。解决方案的构建首先要定义系统的动力学，然后系统地实现 FFS 算法的各个阶段。\n\n**1. 系统模型与动力学**\n代表核尺寸的序参量 $\\lambda$ 遵循一维过阻尼朗之万方程演化。该方程描述了一个粒子在势场中受到粘性阻力和随机热涨落影响下的运动。\n\n自由能 $U(\\lambda)$ 由正则化的经典成核形式给出：\n$$\nU(\\lambda) = \\alpha \\left(\\lambda + \\lambda_{\\mathrm{reg}}\\right)^{2/3} - \\Delta \\mu \\, \\lambda\n$$\n作用在序参量上的力是 $F(\\lambda) = - \\frac{\\partial U}{\\partial \\lambda}$，即：\n$$\nF(\\lambda) = \\Delta \\mu - \\frac{2\\alpha}{3} \\left(\\lambda + \\lambda_{\\mathrm{reg}}\\right)^{-1/3}\n$$\n动力学由随机微分方程 (SDE) 控制：\n$$\n\\mathrm{d}\\lambda_t = \\beta D F(\\lambda_t) \\, \\mathrm{d}t + \\sqrt{2 D} \\, \\mathrm{d}W_t\n$$\n其中 $\\beta = 1/(k_B T)$ 是逆温度（在约化单位中 $k_B=1$），$D$ 是扩散系数，$W_t$ 是代表热噪声的维纳过程。\n\n**2. 数值积分**\n为了模拟轨迹 $\\lambda(t)$，SDE 使用欧拉-丸山格式在时间上离散化。对于小的时间步长 $dt$，$\\lambda$ 的更新规则是：\n$$\n\\lambda_{t+dt} = \\lambda_t + \\beta D F(\\lambda_t) \\, dt + \\sqrt{2 D dt} \\, \\mathcal{N}(0, 1)\n$$\n其中 $\\mathcal{N}(0, 1)$ 是从标准正态分布中抽取的随机数。核尺寸不能为负（$\\lambda \\ge 0$）的物理约束通过在 $\\lambda = 0$ 处的反射边界条件来强制执行。如果一次更新导致 $\\lambda_{t+dt}  0$，则其值设为 $-\\lambda_{t+dt}$。\n\n**3. 前向通量采样 (FFS) 算法**\nFFS 通过将稀有事件分解为一系列更可能发生的事件来计算从亚稳态 $A$ 到目标态 $B$ 的速率 $R_{A \\to B}$。总速率表示为初始通量和一系列条件概率的乘积：\n$$\nR_{A \\to B} = \\Phi_{A,0} \\times \\left( \\prod_{i=0}^{M-2} P(\\lambda_{i+1}|\\lambda_i) \\right) \\times P(B|\\lambda_{M-1})\n$$\n其中 $\\Phi_{A,0}$ 是离开盆 $A$ 并穿过第一个界面 $\\lambda_0$ 的轨迹通量，$P(\\lambda_{i+1}|\\lambda_i)$ 是在轨迹已到达界面 $\\lambda_i$ 的条件下到达界面 $\\lambda_{i+1}$ 的条件概率。实现遵循三个主要阶段。\n\n**阶段 1：初始通量计算**\n初始通量 $\\Phi_{A,0}$ 是源于盆 $A = \\{\\lambda | \\lambda  \\lambda_A\\}$ 的轨迹首次穿过第一个界面 $\\lambda_0$ 的速率。通过运行长度为 $T_{sim}$ 的长连续轨迹来估计。我们计算系统在盆 $A$ 中时发生的向上穿越 $\\lambda_0$ 的总次数，记为 $N_{A \\to 0}$。在盆 $A$ 中花费的时间 $t_A$ 也被累积。通量则为：\n$$\n\\Phi_{A,0} = \\frac{N_{A \\to 0}}{t_A}\n$$\n模拟在 $\\lambda(0)=0$ 处初始化，该点深处盆 $A$ 内。模拟运行直到达到最大步数 $N_{\\text{flux,max}}$ 或收集到最小穿越次数 $N_{\\text{flux,min}}$。每次成功穿越时的构型（$\\lambda$ 的值）被存储起来以备下一阶段使用。\n\n**阶段 2：条件概率计算**\n该阶段迭代地计算从一个界面前进到下一个界面的概率。设 $C_i$ 是从成功穿越界面 $\\lambda_i$ 收集到的构型集合。为了计算 $P(\\lambda_{i+1}|\\lambda_i)$，我们从 $C_i$ 中的构型启动试验轨迹。\n\n根据规定，从 $C_i$ 中的*每个*构型，我们启动 $M_{\\text{trials}}$ 个独立的试验轨迹。每次试验都是一个模拟，并遵循以下终止条件：\n- **成功：** 轨迹到达下一个界面 $\\lambda_{i+1}$（或最终的盆 $B$）。穿越时的构型被存储。\n- **失败：** 轨迹返回到初始盆 $A$。\n- **超时：** 轨迹在未到达 $\\lambda_{i+1}$ 或返回到 $A$ 的情况下超过了允许的最大步数 $N_{\\text{trial,max}}$。这也视为失败。\n\n如果 $N_{succ}$ 是成功试验的总数，$N_{total}$ 是启动的试验总数（即 $|C_i| \\times M_{\\text{trials}}$），则条件概率为：\n$$\nP(\\lambda_{i+1}|\\lambda_i) = \\frac{N_{succ}}{N_{total}}\n$$\n对每对连续的界面 $(\\lambda_0, \\lambda_1), (\\lambda_1, \\lambda_2), \\dots, (\\lambda_{M-1}, \\lambda_B)$ 重复此过程。每个层级的起始构型集合是前一个层级成功构型的集合。如果在任何阶段没有轨迹成功，则所有后续概率都将为零，导致最终速率为零。\n\n**阶段 3：总速率计算**\n最后，通过将初始通量乘以所有计算出的条件概率的乘积来计算成核速率 $R_{A \\to B}$。如果链中的任何概率为零，则总速率为零。得到的速率单位是时间的倒数，在指定的约化 LJ 单位中为 $1/\\tau$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the FFS simulation for all test cases and print the results.\n    \"\"\"\n    \n    test_cases = [\n        # Test Case 1 (moderate barrier)\n        (2.0, 0.9, 0.7, 0.25, 0.01, 0.5, 0.6, [0.9, 1.5, 2.4], 3.5, 25, 200000, 200, 2000, 12345),\n        # Test Case 2 (higher barrier)\n        (2.5, 0.7, 0.6, 0.20, 0.01, 0.5, 0.6, [1.0, 1.8, 2.8], 4.2, 25, 250000, 150, 2500, 23456),\n        # Test Case 3 (lower barrier)\n        (1.5, 1.2, 0.8, 0.30, 0.01, 0.5, 0.5, [0.7, 1.0, 1.5, 2.2], 3.0, 25, 200000, 200, 2000, 34567),\n    ]\n\n    results = []\n    for params in test_cases:\n        rate = run_ffs_simulation(params)\n        results.append(rate)\n\n    print(f\"[{','.join(f'{r:.8e}' for r in results)}]\")\n\ndef run_ffs_simulation(params):\n    \"\"\"\n    Orchestrates the Forward Flux Sampling simulation for a single parameter set.\n    \"\"\"\n    (alpha, delta_mu, T, D, dt, lambda_reg, lambda_A, interfaces,\n     lambda_B, M_trials, N_flux_max, N_flux_min, N_trial_max, seed) = params\n\n    rng = np.random.default_rng(seed)\n    beta = 1.0 / T\n\n    def force(lam):\n        \"\"\"Calculates the deterministic force F = -dU/d(lambda).\"\"\"\n        if lam + lambda_reg <= 0:\n            # Avoid division by zero or complex numbers if lambda is slightly negative \n            # due to numerical issues before reflection.\n            lam = -lambda_reg + 1e-9\n        return delta_mu - (2.0 / 3.0) * alpha * (lam + lambda_reg)**(-1.0 / 3.0)\n\n    def take_step(lam):\n        \"\"\"Performs one step of the overdamped Langevin dynamics.\"\"\"\n        f = force(lam)\n        drift = beta * D * f * dt\n        noise = np.sqrt(2.0 * D * dt) * rng.normal()\n        lam_new = lam + drift + noise\n        \n        # Reflective boundary condition at lambda = 0\n        if lam_new < 0.0:\n            lam_new = -lam_new\n        return lam_new\n\n    # Stage 1: Initial Flux Calculation\n    initial_flux, initial_crossing_configs = calculate_initial_flux(\n        lambda_A, interfaces[0], N_flux_max, N_flux_min, dt, take_step\n    )\n\n    if initial_flux == 0.0:\n        return 0.0\n\n    # Stage 2: Conditional Probabilities\n    conditional_probs = []\n    current_configs = initial_crossing_configs\n    \n    # Combine interfaces and final basin for iteration\n    all_levels = list(interfaces) + [lambda_B]\n\n    for i in range(len(all_levels) - 1):\n        target_lambda = all_levels[i+1]\n        \n        prob, next_configs = calculate_conditional_prob(\n            start_configs=current_configs,\n            lambda_A=lambda_A,\n            target_lambda=target_lambda,\n            M_trials=M_trials,\n            N_trial_max=N_trial_max,\n            take_step=take_step\n        )\n        \n        conditional_probs.append(prob)\n        current_configs = next_configs\n        \n        if prob == 0.0:\n            # If any probability is zero, the final rate will be zero\n            break\n    \n    # Stage 3: Total Rate Calculation\n    total_prob = np.prod(conditional_probs)\n    rate = initial_flux * total_prob\n    \n    return rate\n\ndef calculate_initial_flux(lambda_A, lambda_0, N_flux_max, N_flux_min, dt, take_step):\n    \"\"\"\n    Runs a long trajectory to measure the initial flux from basin A across interface lambda_0.\n    \"\"\"\n    lam = 0.0\n    time_in_A = 0.0\n    flux_crossings = 0\n    initial_configs = []\n    \n    was_in_A = True\n\n    for _ in range(N_flux_max):\n        lam_old = lam\n        \n        # Check if the system was in basin A before the step\n        is_in_A = lam_old < lambda_A\n        if is_in_A:\n            time_in_A += dt\n            was_in_A = True\n        else:\n            was_in_A = False\n\n        lam = take_step(lam_old)\n        \n        # Check for a crossing event from A to lambda_0\n        if was_in_A and lam_old < lambda_0 and lam >= lambda_0:\n            flux_crossings += 1\n            initial_configs.append(lam)\n            if flux_crossings >= N_flux_min:\n                break\n    \n    if time_in_A > 0:\n        flux_rate = flux_crossings / time_in_A\n    else:\n        flux_rate = 0.0\n        \n    return flux_rate, initial_configs\n\ndef calculate_conditional_prob(start_configs, lambda_A, target_lambda, M_trials, N_trial_max, take_step):\n    \"\"\"\n    Calculates the conditional probability of reaching target_lambda from a set of starting configurations.\n    \"\"\"\n    if not start_configs:\n        return 0.0, []\n\n    num_success = 0\n    next_configs = []\n    total_trials = len(start_configs) * M_trials\n\n    for start_lam in start_configs:\n        for _ in range(M_trials):\n            success, final_lam = run_trial_trajectory(\n                start_lam, lambda_A, target_lambda, N_trial_max, take_step\n            )\n            if success:\n                num_success += 1\n                next_configs.append(final_lam)\n\n    prob = num_success / total_trials if total_trials > 0 else 0.0\n    return prob, next_configs\n\ndef run_trial_trajectory(start_lam, lambda_A, target_lambda, N_trial_max, take_step):\n    \"\"\"\n    Runs a single trial trajectory from a starting lambda.\n    Returns (success_bool, final_lambda).\n    \"\"\"\n    lam = start_lam\n    for _ in range(N_trial_max):\n        lam = take_step(lam)\n        \n        if lam >= target_lambda:\n            return True, lam  # Success\n        if lam < lambda_A:\n            return False, None # Failure (returned to A)\n            \n    return False, None # Failure (timeout)\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}