{
    "hands_on_practices": [
        {
            "introduction": "为真正掌握自由能微扰（Free Energy Perturbation, FEP）这一强大技术，我们必须首先理解其理论基础。本练习将我们带回第一性原理，使用可解析求解的谐振子模型，从头推导基本的 FEP 恒等式 。通过两种独立的方法计算自由能差，您不仅将验证著名的 Zwanzig 方程，还将巩固对其与正则配分函数直接联系的理解。",
            "id": "3847564",
            "problem": "考虑一个处于恒定温度 $T$ 下的经典一维系统，该系统由单一坐标 $x$ 和两个谐振势能函数描述：$U_{A}(x)=\\tfrac{1}{2}k_{A}x^{2}$ 和 $U_{B}(x)=\\tfrac{1}{2}k_{B}x^{2}$，其中 $k_{A}>0$ 和 $k_{B}>0$ 是力常数。请仅使用正则系综定义和经典统计力学的基本原理，通过以下两种方法推导状态 B 和状态 A 之间的自由能差 $\\Delta F \\equiv F_{B}-F_{A}$：\n1. 从 $U_{A}(x)$ 下的正则平均定义出发，计算系综平均 $\\langle \\exp(-\\beta\\Delta U)\\rangle_{A}$，其中 $\\Delta U(x)\\equiv U_{B}(x)-U_{A}(x)$ 且 $\\beta\\equiv 1/(k_{\\mathrm{B}}T)$，$k_{\\mathrm{B}}$ 为玻尔兹曼常数。使用此平均值获得 $\\Delta F$ 的解析表达式，除正则定义外不借助任何预先给出的恒等式。\n2. 独立地计算 $U_{B}$ 和 $U_{A}$ 的精确构型配分函数之比，并用它来获得 $\\Delta F$。证明两种方法的结果一致。\n\n假设哈密顿量可分离为动能和势能部分，并注意，由于状态 A 和 B 的动能相同，任何动量贡献在自由能差中都会抵消。请以 $k_{A}$、$k_{B}$、$k_{\\mathrm{B}}$ 和 $T$ 表示的 $\\Delta F$ 的单一闭式表达式作为最终答案。自由能以焦耳为单位表示。无需进行数值计算或四舍五入。",
            "solution": "该问题要求推导一个由谐振势能函数 $U_{A}(x)=\\tfrac{1}{2}k_{A}x^{2}$ 和 $U_{B}(x)=\\tfrac{1}{2}k_{B}x^{2}$ 描述的一维经典系统在两个状态间的亥姆霍兹自由能差 $\\Delta F \\equiv F_{B}-F_{A}$。推导必须通过两种不同的方法进行，以证明它们的等价性。我们已知逆温度 $\\beta \\equiv 1/(k_{\\mathrm{B}}T)$，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是恒定温度。\n\n首先，我们建立自由能和配分函数之间的基本关系。亥姆霍兹自由能 $F$ 通过总正则配分函数 $Z$ 定义为：\n$$F = -k_{\\mathrm{B}}T \\ln Z = -\\frac{1}{\\beta} \\ln Z$$\n对于具有可分离哈密顿量 $H(p,x) = K(p) + U(x)$ 的一维系统，总配分函数 $Z$ 由对所有相空间坐标 $(p,x)$ 的积分给出：\n$$Z = \\frac{1}{h} \\int \\int \\exp(-\\beta H(p,x)) dp dx = \\left(\\frac{1}{h} \\int \\exp(-\\beta K(p)) dp\\right) \\left(\\int \\exp(-\\beta U(x)) dx\\right)$$\n其中 $h$ 是一个具有作用量单位的常数（通常是普朗克常数），以使 $Z$ 无量纲。我们可以将其写为 $Z = Z_{\\mathrm{kin}} Q$，其中 $Z_{\\mathrm{kin}}$ 是动能贡献，$Q$ 是构型配分函数，$Q = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U(x)) dx$。\n\n自由能差 $\\Delta F$ 为：\n$$\\Delta F = F_{B} - F_{A} = \\left(-\\frac{1}{\\beta} \\ln Z_{B}\\right) - \\left(-\\frac{1}{\\beta} \\ln Z_{A}\\right) = -\\frac{1}{\\beta} \\ln\\left(\\frac{Z_{B}}{Z_{A}}\\right)$$\n由于动能项 $K(p)$ 对状态 A 和 B 都是相同的，它们的动能配分函数 $Z_{\\mathrm{kin},A}$ 和 $Z_{\\mathrm{kin},B}$ 是相等的。因此，总配分函数之比简化为构型配分函数之比：\n$$\\frac{Z_{B}}{Z_{A}} = \\frac{Z_{\\mathrm{kin}} Q_{B}}{Z_{\\mathrm{kin}} Q_{A}} = \\frac{Q_{B}}{Q_{A}}$$\n因此，自由能差与构型配分函数直接相关：\n$$\\Delta F = -\\frac{1}{\\beta} \\ln\\left(\\frac{Q_{B}}{Q_{A}}\\right)$$\n这个从正则定义推导出的关系将是两种方法的核心。\n\n**方法一：使用系综平均进行推导**\n\n此方法要求我们计算系综平均 $\\langle \\exp(-\\beta\\Delta U)\\rangle_{A}$ 并将其与 $\\Delta F$ 联系起来。首先，我们必须按要求从基本定义推导此关系。\n\n状态 A 中某个量 $O(x)$ 的正则系综平均定义为：\n$$\\langle O(x) \\rangle_{A} = \\frac{\\int_{-\\infty}^{\\infty} O(x) \\exp(-\\beta U_{A}(x)) dx}{\\int_{-\\infty}^{\\infty} \\exp(-\\beta U_{A}(x)) dx} = \\frac{\\int_{-\\infty}^{\\infty} O(x) \\exp(-\\beta U_{A}(x)) dx}{Q_{A}}$$\n我们感兴趣的是 $O(x) = \\exp(-\\beta\\Delta U(x))$ 的特定平均值，其中 $\\Delta U(x) = U_{B}(x) - U_{A}(x)$。将其代入定义：\n$$\\langle \\exp(-\\beta\\Delta U) \\rangle_{A} = \\frac{\\int_{-\\infty}^{\\infty} \\exp(-\\beta(U_{B}(x) - U_{A}(x))) \\exp(-\\beta U_{A}(x)) dx}{Q_{A}}$$\n通过合并分子中的指数，我们发现：\n$$\\int_{-\\infty}^{\\infty} \\exp(-\\beta U_{B}(x) + \\beta U_{A}(x) - \\beta U_{A}(x)) dx = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U_{B}(x)) dx = Q_{B}$$\n因此，系综平均恰好是构型配分函数之比：\n$$\\langle \\exp(-\\beta\\Delta U) \\rangle_{A} = \\frac{Q_{B}}{Q_{A}}$$\n将此结果与前面推导的 $\\Delta F$ 表达式结合，我们得到自由能微扰恒等式：\n$$\\Delta F = -k_{\\mathrm{B}}T \\ln \\langle \\exp(-\\beta\\Delta U) \\rangle_{A}$$\n现在，我们为给定的势能显式计算该平均值。势能差为：\n$$\\Delta U(x) = U_{B}(x) - U_{A}(x) = \\frac{1}{2}k_{B}x^{2} - \\frac{1}{2}k_{A}x^{2} = \\frac{1}{2}(k_{B} - k_{A})x^{2}$$\n系综平均为：\n$$\\langle \\exp(-\\beta\\Delta U) \\rangle_{A} = \\frac{\\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\left(\\frac{1}{2}(k_{B}-k_{A})x^{2}\\right)\\right) \\exp\\left(-\\beta \\left(\\frac{1}{2}k_{A}x^{2}\\right)\\right) dx}{\\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\left(\\frac{1}{2}k_{A}x^{2}\\right)\\right) dx}$$\n分子的积分为：\n$$I_{\\mathrm{num}} = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta}{2}(k_{B}-k_{A}+k_{A})x^{2}\\right) dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k_{B}}{2}x^{2}\\right) dx$$\n分母的积分为：\n$$I_{\\mathrm{den}} = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k_{A}}{2}x^{2}\\right) dx$$\n这些是形式为 $\\int_{-\\infty}^{\\infty} \\exp(-ax^{2})dx = \\sqrt{\\pi/a}$ 的标准高斯积分。\n对于分子， $a = \\frac{\\beta k_{B}}{2}$，所以 $I_{\\mathrm{num}} = \\sqrt{\\frac{2\\pi}{\\beta k_{B}}}$。\n对于分母， $a = \\frac{\\beta k_{A}}{2}$，所以 $I_{\\mathrm{den}} = \\sqrt{\\frac{2\\pi}{\\beta k_{A}}}$。\n系综平均是这两个结果的比值：\n$$\\langle \\exp(-\\beta\\Delta U) \\rangle_{A} = \\frac{\\sqrt{2\\pi/(\\beta k_{B})}}{\\sqrt{2\\pi/(\\beta k_{A})}} = \\sqrt{\\frac{2\\pi}{\\beta k_{B}} \\cdot \\frac{\\beta k_{A}}{2\\pi}} = \\sqrt{\\frac{k_{A}}{k_{B}}}$$\n最后，我们将此结果代入 $\\Delta F$ 的表达式中：\n$$\\Delta F = -k_{\\mathrm{B}}T \\ln\\left(\\sqrt{\\frac{k_{A}}{k_{B}}}\\right) = -k_{\\mathrm{B}}T \\ln\\left(\\left(\\frac{k_{A}}{k_{B}}\\right)^{1/2}\\right) = -\\frac{1}{2}k_{\\mathrm{B}}T \\ln\\left(\\frac{k_{A}}{k_{B}}\\right)$$\n利用对数性质 $\\ln(1/x) = -\\ln(x)$，可以写成：\n$$\\Delta F = \\frac{1}{2}k_{\\mathrm{B}}T \\ln\\left(\\frac{k_{B}}{k_{A}}\\right)$$\n\n**方法二：使用配分函数之比进行推导**\n\n此方法直接从构型配分函数之比 $Q_{B}/Q_{A}$ 计算 $\\Delta F$。如引言中所述，$\\Delta F = -k_{\\mathrm{B}}T \\ln(Q_{B}/Q_{A})$。\n\n状态 A 和 B 的构型配分函数为：\n$$Q_{A} = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U_{A}(x)) dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k_{A}}{2}x^{2}\\right) dx$$\n$$Q_{B} = \\int_{-\\infty}^{\\infty} \\exp(-\\beta U_{B}(x)) dx = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k_{B}}{2}x^{2}\\right) dx$$\n使用高斯积分结果 $\\int_{-\\infty}^{\\infty} \\exp(-ax^{2})dx = \\sqrt{\\pi/a}$，我们计算每个配分函数：\n$$Q_{A} = \\sqrt{\\frac{\\pi}{(\\beta k_{A}/2)}} = \\sqrt{\\frac{2\\pi}{\\beta k_{A}}}$$\n$$Q_{B} = \\sqrt{\\frac{\\pi}{(\\beta k_{B}/2)}} = \\sqrt{\\frac{2\\pi}{\\beta k_{B}}}$$\n接下来，我们计算它们的比值：\n$$\\frac{Q_{B}}{Q_{A}} = \\frac{\\sqrt{2\\pi/(\\beta k_{B})}}{\\sqrt{2\\pi/(\\beta k_{A})}} = \\sqrt{\\frac{k_{A}}{k_{B}}}$$\n将此比值代入自由能差的方程中：\n$$\\Delta F = -k_{\\mathrm{B}}T \\ln\\left(\\frac{Q_{B}}{Q_{A}}\\right) = -k_{\\mathrm{B}}T \\ln\\left(\\sqrt{\\frac{k_{A}}{k_{B}}}\\right)$$\n这可以简化为：\n$$\\Delta F = -\\frac{1}{2}k_{\\mathrm{B}}T \\ln\\left(\\frac{k_{A}}{k_{B}}\\right) = \\frac{1}{2}k_{\\mathrm{B}}T \\ln\\left(\\frac{k_{B}}{k_{A}}\\right)$$\n\n**结论**\n\n两种方法都得出了相同的自由能差结果：$\\Delta F = \\frac{1}{2}k_{\\mathrm{B}}T \\ln(k_{B}/k_{A})$。这证实了这两种方法的一致性，它们都是统计力学和计算自由能计算的基石。该表达式具有能量单位（在国际单位制中为焦耳），因为乘积 $k_{\\mathrm{B}}T$ 具有能量单位，而对数项是无量纲的。",
            "answer": "$$\n\\boxed{\\frac{1}{2} k_{\\mathrm{B}}T \\ln\\left(\\frac{k_{B}}{k_{A}}\\right)}\n$$"
        },
        {
            "introduction": "从理想化模型转向现实世界的应用，例如计算药物分子的结合自由能，会带来众多的实际挑战。这个练习将您置于科学同行评审员的角色，任务是批判性地评估一个给定的 FEP 计算方案 。成功识别出其中的方法论缺陷，将训练您认识到从相空间采样不足和端点奇异性，到热力学循环和有限尺寸伪影处理不当等一系列常见陷阱。",
            "id": "2455870",
            "problem": "一篇最近的论文报道了使用单步自由能微扰（FEP）方案，计算一个大的、柔性的、类药物配体与蛋白质结合的“绝对”结合自由能。作者在一个显式溶剂盒子中，使用正则系综（NVT），在 $T=300\\ \\mathrm{K}$ 温度下，以 $2\\ \\mathrm{fs}$ 的时间步长对蛋白质-配体复合物进行了 $5\\ \\mathrm{ns}$ 的模拟。Lennard-Jones 相互作用在 $1.0\\ \\mathrm{nm}$ 的球形截断半径处被截断，且没有长程色散校正；静电相互作用在周期性边界条件下使用粒子网格埃瓦尔德（PME）方法处理。配体在一个步骤中被炼金术般地“关闭”：其与环境的非键相互作用被移除，所报告的自由能使用 Zwanzig 指数平均公式计算\n\n$$\n\\Delta G_{0\\to 1} \\;=\\; -k_{\\mathrm{B}}T \\,\\ln \\left\\langle \\exp\\!\\left[-\\beta\\big(U_{1}-U_{0}\\big)\\right]\\right\\rangle_{0},\n$$\n\n其中 $\\beta=1/(k_{\\mathrm{B}}T)$，$U_{0}$ 是完全相互作用的结合复合物的势能，$U_{1}$ 是配体与其环境完全解偶联时的势能，$\\langle\\cdot\\rangle_{0}$ 表示对从 $U_{0}$ 采样的构象进行的系综平均。计算中没有使用中间耦合参数，没有对范德华相互作用应用软核修饰，并且只评估了正向 $0\\to 1$ 的过程。在解偶联过程中，配体的净电荷变化了 $+1e$；没有添加显式的抗衡离子（依赖于 PME 的均匀中和背景）。没有施加位置或取向限制来将解偶联的配体保持在结合位点内，并且在通过 $\\Delta G^{\\circ}=RT\\ln K_{\\mathrm{d}}$ 将 $\\Delta G$ 转换为解离常数时，没有添加标准态校正。作者没有进行溶剂“分支”的计算（即在体相水中对配体进行解偶联），也没有报告不确定度或收敛性诊断。\n\n鉴于所述方法，以下哪些批评在科学上是合理的？选择所有适用项。\n\nA. 对于一个大的、柔性的配体，从完全相互作用态到完全无相互作用态进行单步 FEP，很可能因相空间重叠差而导致指数平均 $-k_{\\mathrm{B}}T\\ln\\langle e^{-\\beta\\Delta U}\\rangle$ 不稳定且有偏差，若无中间态则更是如此。\n\nB. 忽略对结合位点中配体的限制以及相关的标准态校正，会给绝对结合自由能带来偏差，因为一个解偶联的配体可以自由平动和转动；必须包括限制自由能和一个 $\\Delta G^{\\circ}$ 校正。\n\nC. 在有限周期性盒子中使用 PME 方法时，改变 $+1e$ 的净电荷会因均匀中和背景和镜像相互作用而引入有限尺寸效应；需要进行净电荷校正，忽略它会使 $\\Delta G$ 产生偏差。\n\nD. 仅计算复合物“分支”（在蛋白质结合位点中对配体进行解偶联）不足以得到绝对结合自由能；一个热力学循环需要将复合物分支与溶剂分支（在水中对配体进行解偶联）结合起来，并附带限制和标准态项。\n\nE. 使用正则（NVT）系综而非等温等压（NPT）系综必然使来自 FEP 的结合自由能无效，因此所报告的值在根本上是无意义的。\n\nF. 在没有软核势的情况下，单步关闭 Lennard-Jones 相互作用会在原子重叠时引起端点奇点和巨大的力尖峰，从而导致数值不稳定性和严重的偏差。\n\nG. PME 静电学方法不适用于炼金术转换，因此会使任何此类结合自由能的计算结果都不可靠。\n\nH. 仅依赖正向指数估计器，而没有进行反向计算或使用 Bennett 接受率（BAR）或跨越多个中间态的多态 BAR（MBAR），会带来巨大的偏差风险，并且缺乏可靠的不确定度量化。",
            "solution": "问题陈述描述了一个旨在确定配体与蛋白质绝对结合自由能的计算实验。该问题是对计算化学中自由能计算理论与实践知识的有效检验。所描述的方法充满了严重错误，任务是识别所提供的批评中哪些在科学上是合理的。我现在将逐一评估每个批评。\n\n该计算的核心是 Zwanzig 公式，或称自由能微扰（FEP）：\n$$\n\\Delta G_{0\\to 1} \\;=\\; -k_{\\mathrm{B}}T \\,\\ln \\left\\langle \\exp\\!\\left[-\\beta\\big(U_{1}-U_{0}\\big)\\right]\\right\\rangle_{0}\n$$\n其中，状态 $0$ 是完全相互作用的蛋白质-配体复合物，状态 $1$ 是配体的非键相互作用被炼金术般地“关闭”后的体系。\n\nA. 对于一个大的、柔性的配体，从完全相互作用态到完全无相互作用态进行单步 FEP，很可能因相空间重叠差而导致指数平均 $-k_{\\mathrm{B}}T\\ln\\langle e^{-\\beta\\Delta U}\\rangle$ 不稳定且有偏差，若无中间态则更是如此。\n该批评是**正确的**。FEP 公式的有效性取决于参考态（状态 $0$）的系综与目标态（状态 $1$）的相空间有足够的重叠。当这两个状态差异很大时，例如湮灭一个大配体的所有非键相互作用，对于几乎所有从状态 $0$ 采样的构象，势能差 $\\Delta U = U_1 - U_0$ 都会是很大的正值。指数平均 $\\langle e^{-\\beta\\Delta U} \\rangle_{0}$ 将被 $\\Delta U$ 值很小的极端罕见构象所主导。一次 $5\\ \\mathrm{ns}$ 的有限模拟极不可能充分采样到这些关键构象。这会导致系统性的采样不足问题，从而在计算出的 $\\Delta G$ 中产生巨大的统计误差（方差）和显著的系统误差（偏差）。标准且必要的操作是将转换分解为多个较小的步骤（例如，使用由耦合参数 $\\lambda$ 定义的中间态），以确保相邻步骤之间有足够的相空间重叠。\n\nB. 忽略对结合位点中配体的限制以及相关的标准态校正，会给绝对结合自由能带来偏差，因为一个解偶联的配体可以自由平动和转动；必须包括限制自由能和一个 $\\Delta G^{\\circ}$ 校正。\n该批评是**正确的**。目标是计算“绝对”结合自由能，这对应于标准结合自由能 $\\Delta G^{\\circ}$。该值与标准条件（例如，$1\\ \\mathrm{M}$ 浓度）下的平衡常数 $K_d$ 或 $K_a$ 相关。原始的炼金术计算得到的是将配体从其结合态转移到一个仍然被限制在蛋白质结合位点内的无相互作用态的自由能。要将其与 $\\Delta G^{\\circ}$ 联系起来，需要一个严谨的方案。这包括对配体施加位置和取向限制，计算在这些限制下的自由能变化，然后解析计算并加上将这些限制释放到标准态体积（$V^\\circ$，对应于 $1\\ \\mathrm{M}$）所需的自由能。通过忽略限制，配体的最终状态定义不清（它在口袋内的一个未知体积中采样），而通过忽略标准态校正，得到的数值无法有意义地转换或与实验解离常数进行比较。\n\nC. 在有限周期性盒子中使用 PME 方法时，改变 $+1e$ 的净电荷会因均匀中和背景和镜像相互作用而引入有限尺寸效应；需要进行净电荷校正，忽略它会使 $\\Delta G$ 产生偏差。\n该批评是**正确的**。用于计算周期性体系中静电相互作用的粒子网格埃瓦尔德（PME）方法假定整个模拟盒子是电中性的。如果体系带有净电荷，PME 会隐式地添加一个均匀的背景电荷（一个中和等离子体）以维持电中性。这会因为电荷与其自身的周期性镜像以及这个背景之间的相互作用，而引入一个与体系大小相关的人为能量项。当炼金术转换改变了体系的净电荷时，如这里所述（$+1e$），这个效应不会被抵消。它会在计算出的自由能差中引入一个显著的误差。已经有成熟的校正方案可以用来估计和移除这种有限尺寸效应。对于一个改变电荷的转换过程，忽略这种校正是严重的方法学错误。\n\nD. 仅计算复合物“分支”（在蛋白质结合位点中对配体进行解偶联）不足以得到绝对结合自由能；一个热力学循环需要将复合物分支与溶剂分支（在水中对配体进行解偶联）结合起来，并附带限制和标准态项。\n该批评是**正确的**。绝对结合自由能 $\\Delta G_{bind}^\\circ$ 对应于将一个配体从体相溶剂转移到蛋白质结合位点的过程。这个过程不被直接模拟。取而代之的是，构建一个热力学循环：\n$$\n\\begin{array}{ccc} \\text{复合物(aq)}  \\xrightarrow{\\Delta G_{\\text{bind}}^\\circ}  \\text{蛋白质(aq) + 配体(aq)} \\\\ \\downarrow \\Delta G_{\\text{complex}}   \\downarrow \\Delta G_{\\text{solvent}} \\\\ \\text{蛋白质(aq) + “虚拟”配体(在位点中)}  \\xrightarrow{\\approx 0}  \\text{蛋白质(aq) + “虚拟”配体(在溶剂中)} \\end{array}\n$$\n根据此循环，$\\Delta G_{\\text{bind}}^\\circ = \\Delta G_{\\text{solvent}} - \\Delta G_{\\text{complex}}$。问题陈述中描述的计算只计算了这个循环的一部分，即“复合物分支”($\\Delta G_{\\text{complex}}$)。如果不计算“溶剂分支”($\\Delta G_{\\text{solvent}}$)——即在体相水中对同一样配体进行解偶联的自由能，就不可能确定结合自由能。仅将复合物分支的值报告为绝对结合自由能是对该方法的根本性误解。\n\nE. 使用正则（NVT）系综而非等温等压（NPT）系综必然使来自 FEP 的结合自由能无效，因此所报告的值在根本上是无意义的。\n该批评是**不正确的**。FEP 计算可以在多种统计系综中进行。在 NVT 系综中，结果是亥姆霍兹自由能差 $\\Delta A$。在 NPT 系综中，结果是吉布斯自由能差 $\\Delta G$。两者通过 $\\Delta G = \\Delta A + P\\Delta V$ 相关联。对于凝聚相生物分子体系，配体结合或解偶联时的体积变化 $\\Delta V$ 通常非常小，使得 $P\\Delta V$ 项与其他误差来源相比可以忽略不计。虽然 NPT 系综在理论上更适合与通常在恒定压力下进行的实验进行比较，但使用 NVT 系综是一种常见且通常合理的近似。声称它“必然使...无效”是一种夸大的说法。所描述的其他错误（A、B、C、D、F、H）要严重得多。\n\nF. 在没有软核势的情况下，单步关闭 Lennard-Jones 相互作用会在原子重叠时引起端点奇点和巨大的力尖峰，从而导致数值不稳定性和严重的偏差。\n该批评是**正确的**。Lennard-Jones 势有一个强排斥性的 $r^{-12}$ 项，当原子间距离 $r \\to 0$ 时，该项会发散。当炼金术般地湮灭一个粒子时，其相互作用被关闭。在相反的过程（创生）中，人们将从一个粒子是无相互作用的“虚拟”原子的状态中采样构象。这个虚拟原子可能会漂移到一个与环境中某个原子发生空间冲突的位置。对此类构象评估完全相互作用的势能将产生近乎无限的能量和力，这个问题被称为“端点奇点”。软核势是一种标准技术，用于在短距离内修改势能以防止这种发散，并使自由能计算稳定和收敛。试图在没有软核势的情况下单步关闭 LJ 相互作用是极具问题的，可能导致模拟崩溃，或者充其量，由于这些高能事件而得到一个偏差大到无可救药的结果。\n\nG. PME 静电学方法不适用于炼金术转换，因此会使任何此类结合自由能的计算结果都不可靠。\n该批评是**不正确的**。这是一个错误且过于宽泛的概括。PME 是处理周期性模拟中长程静电相互作用的标准、最先进的方法，包括用于炼金术自由能计算的模拟。虽然它存在已知的、必须被正确处理的效应（如批评 C 中所述），但该方法本身并非“不适用”。文献中绝大多数可靠的 FEP 研究都使用 PME。\n\nH. 仅依赖正向指数估计器，而没有进行反向计算或使用 Bennett 接受率（BAR）或跨越多个中间态的多态 BAR（MBAR），会带来巨大的偏差风险，并且缺乏可靠的不确定度量化。\n该批评是**正确的**。正向 FEP 估计器（Zwanzig 公式）已知是有偏差的，尤其是在相空间重叠很差的情况下。它收敛非常缓慢，并且没有提供对其自身有效性的内部检查。现代自由能计算的最佳实践要求使用统计上更稳健的估计器。Bennett 接受率（BAR）方法结合了来自正向（$0 \\to 1$）和反向（$1 \\to 0$）模拟的数据，为给定的模拟时间提供了一个偏差最小、方差最小的自由能估计。正向和反向估计之间的差异也可以作为一个有用的、尽管不完美的收敛诊断。仅依赖单向的 Zwanzig 公式是糟糕的做法，很可能产生有偏差的结果，并且无法提供可靠的方法来评估计算的统计不确定性或系统误差。",
            "answer": "$$\\boxed{ABCDF H}$$"
        },
        {
            "introduction": "正如我们所见，由相邻态之间重叠不足导致的收敛性差是 FEP 计算中的一个主要障碍。这个动手编程练习旨在探索解决此问题的关键策略：通过非线性地排布耦合参数 $\\lambda$ 来优化炼金术路径 。通过推导并实现统计不确定度的表达式，您将能够定量地评估中间态的选择如何直接影响多窗口 FEP 模拟的效率和精度。",
            "id": "2455876",
            "problem": "考虑一个一维经典谐振子，其势能为 $U(x;\\lambda)=\\tfrac{1}{2}k(\\lambda)x^2$，处于逆温 $\\beta=1/(k_{\\mathrm{B}}T)$ 下，其中 $k(\\lambda)=k_0+(k_1-k_0)s$，对于 $s\\in[0,1]$ 且 $s=\\lambda$。多窗口自由能微扰（FEP）计算通过将区间 $[0,1]$ 在点 $\\{\\lambda_j\\}_{j=0}^{W-1}$（其中 $\\lambda_0=0$ 且 $\\lambda_{W-1}=1$）处划分为 $W$ 个窗口，并对相邻窗口的正向估计量求和，来估计从 $s=0$ 到 $s=1$ 的约化自由能变化 $f=\\beta\\Delta F$：\n$$\n\\hat{f}=\\sum_{i=0}^{W-2}\\left[-\\ln\\left(\\frac{1}{M}\\sum_{m=1}^{M}\\exp\\left(-\\beta\\left[U(x_m^{(i)};\\lambda_{i+1})-U(x_m^{(i)};\\lambda_i)\\right]\\right)\\right)\\right],\n$$\n其中 $\\{x_m^{(i)}\\}_{m=1}^M$ 是在 $\\lambda_i$ 处从正则分布中抽取的 $M$ 个独立平衡样本。\n\n将比较两种中间 $\\lambda$ 间距的选择：\n- 线性间距：$\\lambda_j^{\\mathrm{lin}}=\\dfrac{j}{W-1}$，对于 $j\\in\\{0,1,\\ldots,W-1\\}$。\n- 非线性间距：$\\lambda_j^{(\\alpha)}=\\left(\\dfrac{j}{W-1}\\right)^{\\alpha}$，对于给定的指数 $\\alpha>0$ 和 $j\\in\\{0,1,\\ldots,W-1\\}$。\n\n假设对于每个窗口 $i$，$M$ 个样本是在 $\\lambda_i$ 处从精确的正则平衡中进行的独立同分布抽样。使用约化单位进行计算：所有不确定性均报告为 $k_{\\mathrm{B}}T$ 的无量纲倍数；也就是说，报告 $\\hat{f}$ 本身的预测渐近标准差，而不是乘以 $k_{\\mathrm{B}}T$。\n\n任务：对于下面测试套件中的每个参数集，计算在线性间距和具有指定 $\\alpha$ 的非线性间距下，总约化自由能估计 $\\hat{f}$ 的预测渐近标准差（单位为能量除以玻尔兹曼常数乘以温度，即无量纲），然后报告定义为\n$$\nD=\\sigma_{\\mathrm{lin}}-\\sigma_{\\mathrm{nonlin}},\n$$\n的差值，其中 $\\sigma_{\\mathrm{lin}}$ 和 $\\sigma_{\\mathrm{nonlin}}$ 分别是线性和非线性间距下 $\\hat{f}$ 的预测渐近标准差。使用上述物理模型和定义，不使用任何正则系综和大 $M$ 独立采样渐近行为所未隐含的额外近似。\n\n答案格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[d_1,d_2,d_3]$）作为结果，其中每个 $d_n$ 是测试用例 $n$ 的 $D$ 的浮点值，按下面给出的顺序排列。\n\n测试套件（每个元组为 $(T,\\;k_0,\\;k_1,\\;W,\\;M,\\;\\alpha)$）：\n1. $(300,\\;10.0,\\;100.0,\\;8,\\;20000,\\;2.0)$\n2. $(300,\\;10.0,\\;100.0,\\;2,\\;80000,\\;2.0)$\n3. $(300,\\;120.0,\\;12.0,\\;11,\\;15000,\\;0.5)$\n4. $(300,\\;10.0,\\;100.0,\\;8,\\;20000,\\;0.5)$",
            "solution": "该问题已经过分析，并被确定为有效。它在统计力学和计算化学方面具有科学依据，问题阐述清晰，目标明确，并包含了得出唯一解所需的全部信息。不存在矛盾、模糊之处或事实错误。注意到温度 $T$ 的引入对于最终计算是多余的，因为推导出的无量纲不确定性表达式仅依赖于力常数的比率和样本数量。\n\n解题过程如下。总约化自由能变化 $\\hat{f}$ 被估计为来自 $W-1$ 个独立窗口的贡献之和，即 $\\hat{f} = \\sum_{i=0}^{W-2} \\hat{f}_i$。由于不同窗口中模拟的独立性，总方差是每个窗口方差的总和：\n$$\n\\sigma^2(\\hat{f}) = \\mathrm{Var}\\left(\\sum_{i=0}^{W-2} \\hat{f}_i\\right) = \\sum_{i=0}^{W-2} \\mathrm{Var}(\\hat{f}_i) = \\sum_{i=0}^{W-2} \\sigma_i^2\n$$\n任务简化为求解从状态 $\\lambda_i$ 到 $\\lambda_{i+1}$ 的单个窗口中约化自由能估计的渐近方差 $\\sigma_i^2$。该窗口的估计量由 Zwanzig 公式给出：\n$$\n\\hat{f}_i = -\\ln\\left(\\frac{1}{M}\\sum_{m=1}^{M}\\exp\\left(-\\beta\\Delta U_i(x_m^{(i)})\\right)\\right)\n$$\n其中 $\\Delta U_i(x) = U(x; \\lambda_{i+1}) - U(x; \\lambda_i)$，样本 $x_m^{(i)}$ 从 $\\lambda_i$ 处的正则分布中抽取。令 $Y_m = \\exp(-\\beta\\Delta U_i(x_m^{(i)}))$ 且 $\\bar{Y} = \\frac{1}{M}\\sum Y_m$。则 $\\hat{f}_i = -\\ln(\\bar{Y})$。对于大样本量 $M$，$\\hat{f}_i$ 的方差可以通过围绕 $\\bar{Y}$ 的均值 $\\mu_Y = \\langle \\exp(-\\beta\\Delta U_i) \\rangle_i$ 进行一阶泰勒展开（delta 方法）来近似：\n$$\n\\sigma_i^2 = \\mathrm{Var}(\\hat{f}_i) \\approx \\left(\\left.\\frac{d(-\\ln y)}{dy}\\right|_{y=\\mu_Y}\\right)^2 \\mathrm{Var}(\\bar{Y}) = \\left(\\frac{-1}{\\mu_Y}\\right)^2 \\frac{\\mathrm{Var}(Y_m)}{M}\n$$\n单个样本 $Y_m$ 的方差为 $\\mathrm{Var}(Y_m) = \\langle Y_m^2 \\rangle_i - \\langle Y_m \\rangle_i^2 = \\langle \\exp(-2\\beta\\Delta U_i) \\rangle_i - \\mu_Y^2$。代入这些可得单个窗口的渐近方差：\n$$\n\\sigma_i^2 \\approx \\frac{1}{M} \\frac{\\langle \\exp(-2\\beta\\Delta U_i) \\rangle_i - \\langle \\exp(-\\beta\\Delta U_i) \\rangle_i^2}{\\langle \\exp(-\\beta\\Delta U_i) \\rangle_i^2} = \\frac{1}{M} \\left(\\frac{\\langle \\exp(-2\\beta\\Delta U_i) \\rangle_i}{\\langle \\exp(-\\beta\\Delta U_i) \\rangle_i^2} - 1\\right)\n$$\n为了对指定的谐振子系统评估此表达式，我们必须计算所需的系综平均值。势能为 $U(x; \\lambda) = \\frac{1}{2}k(\\lambda)x^2$。在 $\\lambda_i$ 处的正则概率分布是一个高斯分布，$P_i(x) = Z_i^{-1} \\exp(-\\frac{1}{2}\\beta k_i x^2)$，其中 $k_i = k(\\lambda_i)$，$Z_i = \\int_{-\\infty}^{\\infty} \\exp(-\\frac{1}{2}\\beta k_i x^2)dx = \\sqrt{2\\pi/(\\beta k_i)}$ 是配分函数。\n\n能量差为 $\\Delta U_i(x) = \\frac{1}{2}(k_{i+1}-k_i)x^2$。我们计算平均值：\n$$\n\\langle \\exp(-\\beta\\Delta U_i) \\rangle_i = \\frac{1}{Z_i} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{1}{2}\\beta(k_{i+1}-k_i)x^2\\right) \\exp\\left(-\\frac{1}{2}\\beta k_i x^2\\right) dx\n$$\n$$\n= \\frac{1}{Z_i} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{1}{2}\\beta k_{i+1} x^2\\right) dx = \\frac{Z_{i+1}}{Z_i} = \\sqrt{\\frac{k_i}{k_{i+1}}}\n$$\n对于二阶矩：\n$$\n\\langle \\exp(-2\\beta\\Delta U_i) \\rangle_i = \\frac{1}{Z_i} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta(k_{i+1}-k_i)x^2\\right) \\exp\\left(-\\frac{1}{2}\\beta k_i x^2\\right) dx\n$$\n$$\n= \\frac{1}{Z_i} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{1}{2}\\beta(2k_{i+1}-k_i) x^2\\right) dx = \\frac{\\sqrt{2\\pi/(\\beta(2k_{i+1}-k_i))}}{Z_i} = \\sqrt{\\frac{k_i}{2k_{i+1}-k_i}}\n$$\n该积分仅在 $2k_{i+1}-k_i > 0$ 时有定义，对于所有提供的测试用例，此条件均成立。\n\n将这些结果代入方差公式可得：\n$$\n\\sigma_i^2 = \\frac{1}{M} \\left(\\frac{\\sqrt{k_i/(2k_{i+1}-k_i)}}{(\\sqrt{k_i/k_{i+1}})^2} - 1\\right) = \\frac{1}{M} \\left(\\frac{k_{i+1}}{k_i} \\sqrt{\\frac{k_i}{2k_{i+1}-k_i}} - 1\\right)\n$$\n解析上，括号中的项是非负的，因为 $(\\frac{k_{i+1}}{k_i}\\sqrt{\\frac{k_i}{2k_{i+1}-k_i}})^2 - 1 = \\frac{(k_{i+1}-k_i)^2}{k_i(2k_{i+1}-k_i)} \\ge 0$。\n\n计算步骤如下：\n1. 对于每种间距方案（线性和非线性），生成 $W$ 个耦合参数 $\\{\\lambda_j\\}$ 的集合。\n2. 使用 $k(\\lambda)=k_0+(k_1-k_0)\\lambda$ 计算相应的弹簧常数 $\\{k_j\\}$。\n3. 使用推导出的公式对 $i=0, \\ldots, W-2$ 求和，计算单个窗口的方差 $\\sigma_i^2$。\n4. 取总和的平方根，求得总标准差 $\\sigma(\\hat{f})$。\n5. 计算差值 $D = \\sigma_{\\mathrm{lin}} - \\sigma_{\\mathrm{nonlin}}$。\n\n对测试套件中的每组参数执行此过程，以获得最终的数值结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_total_std_dev(k_start, k_end, W, M, alpha, spacing_type):\n    \"\"\"\n    Computes the asymptotic standard deviation of the total reduced free energy estimate.\n\n    Args:\n        k_start (float): Spring constant at s=0.\n        k_end (float): Spring constant at s=1.\n        W (int): Number of lambda windows.\n        M (int): Number of samples per window.\n        alpha (float): Exponent for non-linear spacing.\n        spacing_type (str): 'linear' or 'nonlinear'.\n\n    Returns:\n        float: The predicted standard deviation of the free energy estimate.\n    \"\"\"\n    if W == 1:\n        return 0.0\n\n    # 1. Generate the set of coupling parameters s\n    if spacing_type == 'linear':\n        s_values = np.linspace(0.0, 1.0, W)\n    elif spacing_type == 'nonlinear':\n        j = np.arange(W)\n        s_values = (j / (W - 1))**alpha\n    else:\n        raise ValueError(\"Invalid spacing type specified.\")\n\n    # 2. Calculate the corresponding spring constants k(s)\n    k_func = lambda s: k_start + (k_end - k_start) * s\n    k_values = k_func(s_values)\n    \n    # 3. Sum the individual window variances\n    total_variance = 0.0\n    for i in range(W - 1):\n        k_i = k_values[i]\n        k_i_plus_1 = k_values[i+1]\n        \n        # Variance for a single window (i -> i+1)\n        # sigma_i^2 = (1/M) * ( (k_{i+1}/k_i) * sqrt(k_i / (2*k_{i+1} - k_i)) - 1 )\n        \n        denominator_term = 2 * k_i_plus_1 - k_i\n        # This condition must be met for the variance to be finite.\n        # It is satisfied for all provided test cases.\n        if denominator_term = 0:\n            return np.inf\n\n        variance_term = (k_i_plus_1 / k_i) * np.sqrt(k_i / denominator_term) - 1.0\n        \n        # Analytically, variance_term must be non-negative.\n        # This ensures robustness against potential floating-point inaccuracies.\n        if variance_term  0:\n            variance_term = 0.0\n\n        total_variance += (1 / M) * variance_term\n\n    # 4. Take the square root to find the total standard deviation\n    return np.sqrt(total_variance)\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (T, k_start, k_end, W, M, alpha)\n    test_cases = [\n        (300, 10.0, 100.0, 8, 20000, 2.0),\n        (300, 10.0, 100.0, 2, 80000, 2.0),\n        (300, 120.0, 12.0, 11, 15000, 0.5),\n        (300, 10.0, 100.0, 8, 20000, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        _T, k_start, k_end, W, M, alpha = case\n        \n        # Calculate standard deviation for linear spacing\n        sigma_lin = compute_total_std_dev(k_start, k_end, W, M, alpha, 'linear')\n        \n        # Calculate standard deviation for non-linear spacing\n        sigma_nonlin = compute_total_std_dev(k_start, k_end, W, M, alpha, 'nonlinear')\n        \n        # 5. Compute the difference and store the result\n        D = sigma_lin - sigma_nonlin\n        results.append(D)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}