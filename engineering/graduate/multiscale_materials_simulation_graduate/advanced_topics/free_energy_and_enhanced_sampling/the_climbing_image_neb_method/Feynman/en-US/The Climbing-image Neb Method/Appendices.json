{
    "hands_on_practices": [
        {
            "introduction": "To truly master the CI-NEB method, we must begin with its fundamental mechanics. This first practice provides a hands-on opportunity to dissect a single, crucial step of the algorithm: the update of the climbing image. By manually calculating the forces and the resulting position change on a simple two-dimensional potential energy surface, you will build an intuitive and quantitative understanding of how the climbing-image modification drives the system directly toward the saddle point. ",
            "id": "3437606",
            "problem": "Consider a two-dimensional potential energy surface used as a simplified model for a diffusion barrier, defined by the scalar field $V(x,y) = (x^{2} - 1)^{2} + y^{2}$ in electronvolts (eV). Two minima are located at $(-1,0)$ and $(1,0)$, separated by a first-order saddle at $(0,0)$. A discrete path between the minima is represented by five images $\\{\\mathbf{r}_{0},\\mathbf{r}_{1},\\mathbf{r}_{2},\\mathbf{r}_{3},\\mathbf{r}_{4}\\}$, with fixed endpoints $\\mathbf{r}_{0} = (-1,0)$ and $\\mathbf{r}_{4} = (1,0)$, and current interior positions\n$\\mathbf{r}_{1} = (-0.4, 0.2)$, $\\mathbf{r}_{2} = (0.0, 0.1)$, and $\\mathbf{r}_{3} = (0.3, -0.1)$.\nYou will execute one iteration of the climbing-image variant of the Nudged Elastic Band method (Climbing-Image Nudged Elastic Band (CI-NEB)) on the highest-energy image, starting from first principles and core definitions.\n\nAssume the following modeling assumptions:\n- The path tangent at an interior image $i$ is the unit vector obtained by normalizing the chord joining its two neighbors, $\\hat{\\boldsymbol{\\tau}}_{i} = \\dfrac{\\mathbf{r}_{i+1} - \\mathbf{r}_{i-1}}{\\lVert \\mathbf{r}_{i+1} - \\mathbf{r}_{i-1}\\rVert}$.\n- The true force due to the potential is $-\\nabla V$.\n- Vector components parallel and perpendicular to a unit direction $\\hat{\\boldsymbol{\\tau}}$ are defined by orthogonal projection: for any vector $\\mathbf{A}$, $\\mathbf{A}^{\\parallel} = (\\mathbf{A}\\cdot \\hat{\\boldsymbol{\\tau}})\\hat{\\boldsymbol{\\tau}}$ and $\\mathbf{A}^{\\perp} = \\mathbf{A} - \\mathbf{A}^{\\parallel}$.\n\nTreat the interior image with the highest potential energy as the climbing image. For that image, construct the parallel and perpendicular components of the true force and apply the climbing-image modification consistent with the definition of the method. Then perform a single explicit Euler positional update of the climbing image using the step parameter $h = 0.5$:\n$\\mathbf{r}_{i}^{\\text{new}} = \\mathbf{r}_{i}^{\\text{old}} + h\\,\\mathbf{F}_{i}^{\\text{CI}}$,\nwhere $\\mathbf{F}_{i}^{\\text{CI}}$ is the total climbing-image force you construct from the above principles.\n\nStarting from the given positions, carry out the following for the highest-energy image $i$:\n1. Identify the climbing image index $i$ by evaluating $V(\\mathbf{r}_{i})$ at the interior images.\n2. Compute the tangent $\\hat{\\boldsymbol{\\tau}}_{i}$ from its neighbors.\n3. Evaluate the gradient $\\nabla V$ at $\\mathbf{r}_{i}$, then decompose the true force $-\\nabla V$ into $\\mathbf{F}_{i}^{\\parallel}$ and $\\mathbf{F}_{i}^{\\perp}$ using the projection definitions above.\n4. Construct the climbing-image force $\\mathbf{F}_{i}^{\\text{CI}}$ for that image according to the climbing-image modification.\n5. Update the climbing image position with the given Euler step.\n6. Evaluate the updated energy $V(\\mathbf{r}_{i}^{\\text{new}})$.\n\nReport as your final answer the updated energy of the climbing image, $V(\\mathbf{r}_{i}^{\\text{new}})$, in eV. Round your answer to four significant figures. Express the final energy in eV.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n-   Potential energy surface: $V(x,y) = (x^{2} - 1)^{2} + y^{2}$ in units of electronvolts (eV).\n-   Discrete path images: $\\{\\mathbf{r}_{0},\\mathbf{r}_{1},\\mathbf{r}_{2},\\mathbf{r}_{3},\\mathbf{r}_{4}\\}$.\n-   Fixed endpoints: $\\mathbf{r}_{0} = (-1,0)$, $\\mathbf{r}_{4} = (1,0)$.\n-   Interior image positions: $\\mathbf{r}_{1} = (-0.4, 0.2)$, $\\mathbf{r}_{2} = (0.0, 0.1)$, $\\mathbf{r}_{3} = (0.3, -0.1)$.\n-   Path tangent definition: $\\hat{\\boldsymbol{\\tau}}_{i} = \\dfrac{\\mathbf{r}_{i+1} - \\mathbf{r}_{i-1}}{\\lVert \\mathbf{r}_{i+1} - \\mathbf{r}_{i-1}\\rVert}$.\n-   True force definition: $-\\nabla V$.\n-   Force component definitions: $\\mathbf{A}^{\\parallel} = (\\mathbf{A}\\cdot \\hat{\\boldsymbol{\\tau}})\\hat{\\boldsymbol{\\tau}}$ and $\\mathbf{A}^{\\perp} = \\mathbf{A} - \\mathbf{A}^{\\parallel}$.\n-   Climbing image identification: The interior image with the highest potential energy.\n-   Position update rule: $\\mathbf{r}_{i}^{\\text{new}} = \\mathbf{r}_{i}^{\\text{old}} + h\\,\\mathbf{F}_{i}^{\\text{CI}}$.\n-   Step parameter: $h = 0.5$.\n-   Objective: Calculate the updated energy $V(\\mathbf{r}_{i}^{\\text{new}})$ for the climbing image, rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem describes the Climbing-Image Nudged Elastic Band (CI-NEB) method, a standard and widely used algorithm in computational chemistry and materials science for finding transition states. The potential $V(x,y)$ is a classic double-well potential, a common model system for such problems. The definitions of the tangent, forces, and the update rule are consistent with the established formulation of the CI-NEB method. The problem is scientifically sound.\n-   **Well-Posed**: All necessary information is provided: the potential function, the initial coordinates of all images, the definitions for all computed quantities (tangent, forces), and the parameters for the update step ($h$). The objective is stated clearly and is achievable with the given data. The problem is self-contained and unambiguous.\n-   **Objective**: The problem is formulated in precise mathematical language and is free of subjective or opinion-based statements.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A solution will be provided by following the prescribed steps.\n\nThe solution proceeds by following the six steps outlined in the problem statement.\n\n**1. Identify the climbing image**\nThe potential energy $V(\\mathbf{r}_i)$ is calculated for each interior image $\\mathbf{r}_i = (x_i, y_i)$.\nThe potential energy function is $V(x,y) = (x^{2} - 1)^{2} + y^{2}$.\n\nFor image $\\mathbf{r}_{1} = (-0.4, 0.2)$:\n$$V(\\mathbf{r}_{1}) = ((-0.4)^{2} - 1)^{2} + (0.2)^{2} = (0.16 - 1)^{2} + 0.04 = (-0.84)^{2} + 0.04 = 0.7056 + 0.04 = 0.7456 \\, \\text{eV}$$\n\nFor image $\\mathbf{r}_{2} = (0.0, 0.1)$:\n$$V(\\mathbf{r}_{2}) = ((0.0)^{2} - 1)^{2} + (0.1)^{2} = (-1)^{2} + 0.01 = 1 + 0.01 = 1.01 \\, \\text{eV}$$\n\nFor image $\\mathbf{r}_{3} = (0.3, -0.1)$:\n$$V(\\mathbf{r}_{3}) = ((0.3)^{2} - 1)^{2} + (-0.1)^{2} = (0.09 - 1)^{2} + 0.01 = (-0.91)^{2} + 0.01 = 0.8281 + 0.01 = 0.8381 \\, \\text{eV}$$\n\nComparing the energies, $V(\\mathbf{r}_2) > V(\\mathbf{r}_3) > V(\\mathbf{r}_1)$. The image with the highest potential energy is $\\mathbf{r}_{2}$. Thus, the climbing image is image $i=2$.\n\n**2. Compute the tangent $\\hat{\\boldsymbol{\\tau}}_{2}$**\nThe tangent at $\\mathbf{r}_2$ is determined by its neighbors, $\\mathbf{r}_1$ and $\\mathbf{r}_3$.\n$$\\mathbf{r}_{3} - \\mathbf{r}_{1} = (0.3 - (-0.4), -0.1 - 0.2) = (0.7, -0.3)$$\nThe norm of this vector is:\n$$\\lVert \\mathbf{r}_{3} - \\mathbf{r}_{1} \\rVert = \\sqrt{(0.7)^{2} + (-0.3)^{2}} = \\sqrt{0.49 + 0.09} = \\sqrt{0.58}$$\nThe unit tangent vector is:\n$$\\hat{\\boldsymbol{\\tau}}_{2} = \\frac{\\mathbf{r}_{3} - \\mathbf{r}_{1}}{\\lVert \\mathbf{r}_{3} - \\mathbf{r}_{1} \\rVert} = \\frac{1}{\\sqrt{0.58}}(0.7, -0.3)$$\n\n**3. Evaluate the gradient and decompose the true force**\nThe gradient of the potential $V(x,y) = (x^2-1)^2+y^2 = x^4-2x^2+1+y^2$ is:\n$$\\nabla V = \\left( \\frac{\\partial V}{\\partial x}, \\frac{\\partial V}{\\partial y} \\right) = (4x^{3} - 4x, 2y)$$\nAt the position of the climbing image $\\mathbf{r}_{2} = (0.0, 0.1)$:\n$$\\nabla V |_{\\mathbf{r}_2} = (4(0.0)^{3} - 4(0.0), 2(0.1)) = (0, 0.2)$$\nThe true force is $\\mathbf{F}_{\\text{true}} = -\\nabla V |_{\\mathbf{r}_2}$:\n$$\\mathbf{F}_{\\text{true}} = (0, -0.2)$$\nThis force is decomposed into components parallel ($\\mathbf{F}_{2}^{\\parallel}$) and perpendicular ($\\mathbf{F}_{2}^{\\perp}$) to the tangent $\\hat{\\boldsymbol{\\tau}}_{2}$. We only need the parallel component for the next step.\n$$\\mathbf{F}_{2}^{\\parallel} = (\\mathbf{F}_{\\text{true}} \\cdot \\hat{\\boldsymbol{\\tau}}_{2}) \\hat{\\boldsymbol{\\tau}}_{2}$$\nFirst, compute the dot product:\n$$\\mathbf{F}_{\\text{true}} \\cdot \\hat{\\boldsymbol{\\tau}}_{2} = (0, -0.2) \\cdot \\frac{1}{\\sqrt{0.58}}(0.7, -0.3) = \\frac{1}{\\sqrt{0.58}} [0 \\cdot (0.7) + (-0.2) \\cdot (-0.3)] = \\frac{0.06}{\\sqrt{0.58}}$$\nNow, construct the parallel force vector:\n$$\\mathbf{F}_{2}^{\\parallel} = \\left(\\frac{0.06}{\\sqrt{0.58}}\\right) \\left(\\frac{1}{\\sqrt{0.58}}(0.7, -0.3)\\right) = \\frac{0.06}{0.58}(0.7, -0.3) = \\frac{6}{58}(0.7, -0.3) = \\frac{3}{29}(0.7, -0.3)$$\n$$\\mathbf{F}_{2}^{\\parallel} = \\left(\\frac{2.1}{29}, -\\frac{0.9}{29}\\right)$$\n\n**4. Construct the climbing-image force $\\mathbf{F}_{2}^{\\text{CI}}$**\nFor the climbing image, the force is modified to remove the spring force component along the tangent and invert the true force component along the tangent, driving the image up the potential energy surface towards the saddle point. The force is given by $\\mathbf{F}_{i}^{\\text{CI}} = \\mathbf{F}_{\\text{true}} - 2 \\mathbf{F}_{i}^{\\parallel}$.\n$$\\mathbf{F}_{2}^{\\text{CI}} = (0, -0.2) - 2 \\left(\\frac{2.1}{29}, -\\frac{0.9}{29}\\right) = (0, -0.2) - \\left(\\frac{4.2}{29}, -\\frac{1.8}{29}\\right)$$\n$$\\mathbf{F}_{2}^{\\text{CI}} = \\left(-\\frac{4.2}{29}, -0.2 + \\frac{1.8}{29}\\right) = \\left(-\\frac{4.2}{29}, -\\frac{5.8}{29} + \\frac{1.8}{29}\\right) = \\left(-\\frac{4.2}{29}, -\\frac{4.0}{29}\\right)$$\n\n**5. Update the climbing image position**\nThe position is updated using an explicit Euler step with $h=0.5$.\n$$\\mathbf{r}_{2}^{\\text{new}} = \\mathbf{r}_{2}^{\\text{old}} + h\\,\\mathbf{F}_{2}^{\\text{CI}}$$\n$$\\mathbf{r}_{2}^{\\text{new}} = (0.0, 0.1) + 0.5 \\left(-\\frac{4.2}{29}, -\\frac{4.0}{29}\\right) = (0, 0.1) + \\left(-\\frac{2.1}{29}, -\\frac{2.0}{29}\\right)$$\nThe new coordinates are:\n$$x_{2}^{\\text{new}} = -\\frac{2.1}{29}$$\n$$y_{2}^{\\text{new}} = 0.1 - \\frac{2.0}{29} = \\frac{1}{10} - \\frac{2}{29} = \\frac{29 - 20}{290} = \\frac{9}{290}$$\nSo, the new position is $\\mathbf{r}_{2}^{\\text{new}} = \\left(-\\frac{2.1}{29}, \\frac{9}{290}\\right)$.\n\n**6. Evaluate the updated energy $V(\\mathbf{r}_{2}^{\\text{new}})$**\nThe energy at the new position is calculated:\n$$V(\\mathbf{r}_{2}^{\\text{new}}) = \\left( \\left(x_{2}^{\\text{new}}\\right)^{2} - 1 \\right)^{2} + \\left(y_{2}^{\\text{new}}\\right)^{2}$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) = \\left( \\left(-\\frac{2.1}{29}\\right)^{2} - 1 \\right)^{2} + \\left(\\frac{9}{290}\\right)^{2}$$\nNumerically evaluating the terms:\n$$x_{2}^{\\text{new}} = -\\frac{2.1}{29} \\approx -0.07241379$$\n$$y_{2}^{\\text{new}} = \\frac{9}{290} \\approx 0.03103448$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) \\approx ((-0.07241379)^{2} - 1)^{2} + (0.03103448)^{2}$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) \\approx (0.00524376 - 1)^{2} + 0.00096314$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) \\approx (-0.99475624)^{2} + 0.00096314$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) \\approx 0.98954002 + 0.00096314 = 0.99050316 \\, \\text{eV}$$\nRounding the result to four significant figures gives $0.9905$.",
            "answer": "$$\n\\boxed{0.9905}\n$$"
        },
        {
            "introduction": "While the basic CI-NEB algorithm is powerful, its successful application requires an awareness of potential numerical pitfalls. A common issue is premature or \"false\" convergence, where the algorithm reports success because the measured perpendicular force is small, even though the system is not yet at a true stationary point. This practice guides you through a first-principles derivation to analyze how errors in the estimated path tangent can lead to a misleading reduction in the perpendicular force, fostering a critical eye for evaluating simulation results. ",
            "id": "3845766",
            "problem": "Consider a transition-state search in multiscale materials simulation using the Climbing-Image Nudged Elastic Band (CI-NEB) method, where the Nudged Elastic Band (NEB) projects forces to remove components along the path tangent. For an intermediate image with atomic coordinates $\\mathbf{R}$ and potential energy $E(\\mathbf{R})$, denote the true force by $\\mathbf{g} = -\\nabla E(\\mathbf{R})$. Let the true path tangent be the unit vector $\\hat{\\tau}$ at this image, and decompose the force as $\\mathbf{g} = g^{\\parallel}\\hat{\\tau} + \\mathbf{g}^{\\perp}$, where $g^{\\parallel} = \\mathbf{g}\\cdot\\hat{\\tau}$ and $\\mathbf{g}^{\\perp} = \\mathbf{g} - (\\mathbf{g}\\cdot\\hat{\\tau})\\hat{\\tau}$. In practice, due to discretization and image spacing, the algorithm may use an estimated tangent $\\hat{\\tau}'$ that is misaligned from $\\hat{\\tau}$ by a small angle $\\delta$ within the plane spanned by $\\hat{\\tau}$ and the unit vector $\\hat{u} = \\mathbf{g}^{\\perp}/\\|\\mathbf{g}^{\\perp}\\|$. The monitored “perpendicular” force is then computed with $\\hat{\\tau}'$ as $\\mathbf{g}^{\\perp'} = \\mathbf{g} - (\\mathbf{g}\\cdot\\hat{\\tau}')\\hat{\\tau}'$, and convergence is often assessed by the reduction of $\\|\\mathbf{g}^{\\perp'}\\|$.\n\nStarting from first principles of vector projection and orthogonal decomposition, derive how a small misalignment angle $\\delta$ can falsely reduce the monitored perpendicular norm $\\|\\mathbf{g}^{\\perp'}\\|$ relative to the true $\\|\\mathbf{g}^{\\perp}\\|$. Define the dimensionless ratio $\\alpha = \\|g^{\\parallel}\\|/\\|\\mathbf{g}^{\\perp}\\|$ and the fractional underestimation\n$$\n\\Delta(\\alpha,\\delta) = 1 - \\frac{\\|\\mathbf{g}^{\\perp'}\\|}{\\|\\mathbf{g}^{\\perp}\\|}.\n$$\nAssuming $\\delta$ is small and retaining terms up to order $\\delta^{2}$, find a closed-form analytical expression for $\\Delta(\\alpha,\\delta)$ in terms of $\\alpha$ and $\\delta$.\n\nAdditionally, based on your derivation, describe at least two robust diagnostics that would mitigate false convergence assessment caused by tangent misalignment, formulated in terms of quantities accessible during CI-NEB iterations. Your final reported result must be the analytical expression for $\\Delta(\\alpha,\\delta)$; do not include units. No rounding is required.",
            "solution": "The problem statement is critically validated and deemed valid. It is scientifically grounded in the principles of computational materials science, specifically the Nudged Elastic Band (NEB) method. The problem is well-posed, objective, and contains sufficient information for a formal derivation. There are no contradictions, factual errors, or ambiguities that would preclude a unique, meaningful solution.\n\nWe begin the derivation by establishing a coordinate system and expressing the relevant vectors. The problem states that the estimated tangent $\\hat{\\tau}'$ is misaligned with the true tangent $\\hat{\\tau}$ within the plane spanned by $\\hat{\\tau}$ and the unit vector in the direction of the true perpendicular force, $\\hat{u} = \\mathbf{g}^{\\perp}/\\|\\mathbf{g}^{\\perp}\\|$. The vectors $\\hat{\\tau}$ and $\\hat{u}$ are, by construction, orthonormal. We can therefore represent the problem in a 2D basis $\\{\\hat{\\tau}, \\hat{u}\\}$.\n\nIn this basis, the true force vector $\\mathbf{g} = g^{\\parallel}\\hat{\\tau} + \\mathbf{g}^{\\perp}$ can be written as:\n$$\n\\mathbf{g} = g^{\\parallel}\\hat{\\tau} + \\|\\mathbf{g}^{\\perp}\\|\\hat{u}\n$$\nwhere $g^{\\parallel} = \\mathbf{g}\\cdot\\hat{\\tau}$ is the scalar projection of the force onto the true tangent.\n\nThe estimated tangent $\\hat{\\tau}'$ is a unit vector in the same plane, misaligned from $\\hat{\\tau}$ by a small angle $\\delta$. We can express $\\hat{\\tau}'$ as a rotation of $\\hat{\\tau}$:\n$$\n\\hat{\\tau}' = (\\cos\\delta)\\hat{\\tau} + s(\\sin\\delta)\\hat{u}\n$$\nwhere $s = \\pm 1$ indicates the direction of the rotation (towards or away from $\\hat{u}$).\n\nThe monitored perpendicular force, $\\mathbf{g}^{\\perp'}$, is the component of $\\mathbf{g}$ orthogonal to $\\hat{\\tau}'$. Its squared magnitude can be calculated using the properties of vector projection:\n$$\n\\|\\mathbf{g}^{\\perp'}\\|^2 = \\|\\mathbf{g}\\|^2 - (\\mathbf{g}\\cdot\\hat{\\tau}')^2\n$$\nFirst, we find the squared magnitude of the total force, $\\|\\mathbf{g}\\|^2$. Since $\\mathbf{g}^{\\perp}$ is orthogonal to $g^{\\parallel}\\hat{\\tau}$:\n$$\n\\|\\mathbf{g}\\|^2 = \\|g^{\\parallel}\\hat{\\tau}\\|^2 + \\|\\mathbf{g}^{\\perp}\\|^2 = (g^{\\parallel})^2 + \\|\\mathbf{g}^{\\perp}\\|^2\n$$\nNext, we calculate the dot product $\\mathbf{g}\\cdot\\hat{\\tau}'$:\n$$\n\\mathbf{g}\\cdot\\hat{\\tau}' = (g^{\\parallel}\\hat{\\tau} + \\|\\mathbf{g}^{\\perp}\\|\\hat{u}) \\cdot ((\\cos\\delta)\\hat{\\tau} + s(\\sin\\delta)\\hat{u})\n$$\nUsing the orthonormality of $\\hat{\\tau}$ and $\\hat{u}$ ($\\hat{\\tau}\\cdot\\hat{\\tau}=1, \\hat{u}\\cdot\\hat{u}=1, \\hat{\\tau}\\cdot\\hat{u}=0$):\n$$\n\\mathbf{g}\\cdot\\hat{\\tau}' = g^{\\parallel}\\cos\\delta + s\\|\\mathbf{g}^{\\perp}\\|\\sin\\delta\n$$\nSubstituting these results into the equation for $\\|\\mathbf{g}^{\\perp'}\\|^2$:\n$$\n\\|\\mathbf{g}^{\\perp'}\\|^2 = \\left((g^{\\parallel})^2 + \\|\\mathbf{g}^{\\perp}\\|^2\\right) - \\left(g^{\\parallel}\\cos\\delta + s\\|\\mathbf{g}^{\\perp}\\|\\sin\\delta\\right)^2\n$$\nExpanding the squared term:\n$$\n\\|\\mathbf{g}^{\\perp'}\\|^2 = (g^{\\parallel})^2 + \\|\\mathbf{g}^{\\perp}\\|^2 - \\left((g^{\\parallel})^2\\cos^2\\delta + (s\\|\\mathbf{g}^{\\perp}\\|)^2\\sin^2\\delta + 2sg^{\\parallel}\\|\\mathbf{g}^{\\perp}\\|\\sin\\delta\\cos\\delta\\right)\n$$\nSince $s^2=1$, we can group terms:\n$$\n\\|\\mathbf{g}^{\\perp'}\\|^2 = (g^{\\parallel})^2(1 - \\cos^2\\delta) + \\|\\mathbf{g}^{\\perp}\\|^2(1 - \\sin^2\\delta) - 2sg^{\\parallel}\\|\\mathbf{g}^{\\perp}\\|\\sin\\delta\\cos\\delta\n$$\nUsing the trigonometric identities $\\sin^2\\delta + \\cos^2\\delta = 1$:\n$$\n\\|\\mathbf{g}^{\\perp'}\\|^2 = (g^{\\parallel})^2\\sin^2\\delta + \\|\\mathbf{g}^{\\perp}\\|^2\\cos^2\\delta - 2sg^{\\parallel}\\|\\mathbf{g}^{\\perp}\\|\\sin\\delta\\cos\\delta\n$$\nThis expression is the square of a binomial:\n$$\n\\|\\mathbf{g}^{\\perp'}\\|^2 = \\left(\\|\\mathbf{g}^{\\perp}\\|\\cos\\delta - sg^{\\parallel}\\sin\\delta\\right)^2\n$$\nTaking the square root gives the magnitude:\n$$\n\\|\\mathbf{g}^{\\perp'}\\| = \\left|\\|\\mathbf{g}^{\\perp}\\|\\cos\\delta - sg^{\\parallel}\\sin\\delta\\right|\n$$\nThe problem specifies that $\\delta$ is a small angle. We can therefore use Taylor series expansions for an approximation up to order $\\delta^2$:\n$\\sin\\delta \\approx \\delta$\n$\\cos\\delta \\approx 1 - \\frac{\\delta^2}{2}$\n\nSubstituting these into the expression for $\\|\\mathbf{g}^{\\perp'}\\|$:\n$$\n\\|\\mathbf{g}^{\\perp'}\\| \\approx \\left|\\|\\mathbf{g}^{\\perp}\\|\\left(1 - \\frac{\\delta^2}{2}\\right) - sg^{\\parallel}\\delta\\right|\n$$\nSince $\\delta$ is small, the term $\\|\\mathbf{g}^{\\perp}\\|$ is dominant, so the expression inside the absolute value is positive. We can drop the absolute value sign.\n$$\n\\|\\mathbf{g}^{\\perp'}\\| \\approx \\|\\mathbf{g}^{\\perp}\\| - sg^{\\parallel}\\delta - \\frac{1}{2}\\|\\mathbf{g}^{\\perp}\\|\\delta^2\n$$\nNow we compute the ratio $\\|\\mathbf{g}^{\\perp'}\\|/\\|\\mathbf{g}^{\\perp}\\|$:\n$$\n\\frac{\\|\\mathbf{g}^{\\perp'}\\|}{\\|\\mathbf{g}^{\\perp}\\|} \\approx 1 - s\\frac{g^{\\parallel}}{\\|\\mathbf{g}^{\\perp}\\|}\\delta - \\frac{1}{2}\\delta^2\n$$\nThe problem defines the dimensionless ratio $\\alpha = \\|g^{\\parallel}\\|/\\|\\mathbf{g}^{\\perp}\\| = |g^{\\parallel}|/\\|\\mathbf{g}^{\\perp}\\|$. Let us write $g^{\\parallel} = \\sigma|g^{\\parallel}|$, where $\\sigma = \\text{sgn}(g^{\\parallel}) = \\pm 1$. The ratio becomes:\n$$\n\\frac{\\|\\mathbf{g}^{\\perp'}\\|}{\\|\\mathbf{g}^{\\perp}\\|} \\approx 1 - s\\sigma\\frac{|g^{\\parallel}|}{\\|\\mathbf{g}^{\\perp}\\|}\\delta - \\frac{1}{2}\\delta^2 = 1 - s\\sigma\\alpha\\delta - \\frac{1}{2}\\delta^2\n$$\nThe problem asks to derive how misalignment \"can falsely reduce\" the norm, which implies we should consider the case that leads to the largest reduction. The reduction is maximized when the first-order term in $\\delta$ is negative, which occurs when $s\\sigma = 1$. This corresponds physically to the estimated tangent $\\hat{\\tau}'$ being rotated from the true tangent $\\hat{\\tau}$ towards the total force vector $\\mathbf{g}$, thereby maximizing the force projection along $\\hat{\\tau}'$ and minimizing the perpendicular residual. Assuming this worst-case scenario for convergence assessment:\n$$\n\\frac{\\|\\mathbf{g}^{\\perp'}\\|}{\\|\\mathbf{g}^{\\perp}\\|} \\approx 1 - \\alpha\\delta - \\frac{1}{2}\\delta^2\n$$\nThis derivation required an approximation of $\\|\\mathbf{g}^{\\perp'}\\|$ which mixed orders of $\\delta$. A more rigorous approach is to expand $\\|\\mathbf{g}^{\\perp'}\\|^2/\\|\\mathbf{g}^{\\perp}\\|^2$ first.\n$$\n\\frac{\\|\\mathbf{g}^{\\perp'}\\|^2}{\\|\\mathbf{g}^{\\perp}\\|^2} = \\left(\\frac{g^{\\parallel}}{\\|\\mathbf{g}^{\\perp}\\|}\\right)^2\\sin^2\\delta + \\cos^2\\delta - 2s\\frac{g^{\\parallel}}{\\|\\mathbf{g}^{\\perp}\\|}\\sin\\delta\\cos\\delta\n$$\nUsing $\\alpha$ and $\\sigma$, and Taylor expansions $\\sin^2\\delta \\approx \\delta^2$, $\\cos^2\\delta \\approx 1-\\delta^2$, and $\\sin\\delta\\cos\\delta \\approx \\delta$:\n$$\n\\frac{\\|\\mathbf{g}^{\\perp'}\\|^2}{\\|\\mathbf{g}^{\\perp}\\|^2} \\approx (\\sigma\\alpha)^2\\delta^2 + (1-\\delta^2) - 2s\\sigma\\alpha\\delta = 1 - 2s\\sigma\\alpha\\delta + (\\alpha^2 - 1)\\delta^2\n$$\nNow, we take the square root of this expression, $\\sqrt{1+x}$ where $x = -2s\\sigma\\alpha\\delta + (\\alpha^2 - 1)\\delta^2$. Using the expansion $\\sqrt{1+x} \\approx 1 + \\frac{1}{2}x - \\frac{1}{8}x^2$ and keeping terms up to $\\delta^2$:\n$$\n\\frac{\\|\\mathbf{g}^{\\perp'}\\|}{\\|\\mathbf{g}^{\\perp}\\|} \\approx 1 + \\frac{1}{2}(-2s\\sigma\\alpha\\delta + (\\alpha^2 - 1)\\delta^2) - \\frac{1}{8}(-2s\\sigma\\alpha\\delta)^2\n$$\n$$\n\\frac{\\|\\mathbf{g}^{\\perp'}\\|}{\\|\\mathbf{g}^{\\perp}\\|} \\approx 1 - s\\sigma\\alpha\\delta + \\frac{1}{2}(\\alpha^2 - 1)\\delta^2 - \\frac{1}{2}\\alpha^2\\delta^2\n$$\n$$\n\\frac{\\|\\mathbf{g}^{\\perp'}\\|}{\\|\\mathbf{g}^{\\perp}\\|} \\approx 1 - s\\sigma\\alpha\\delta - \\frac{1}{2}\\delta^2\n$$\nAgain, assuming the worst-case misalignment where $s\\sigma=1$:\n$$\n\\frac{\\|\\mathbf{g}^{\\perp'}\\|}{\\|\\mathbf{g}^{\\perp}\\|} \\approx 1 - \\alpha\\delta - \\frac{1}{2}\\delta^2\n$$\nWe can now find the fractional underestimation $\\Delta(\\alpha, \\delta)$:\n$$\n\\Delta(\\alpha, \\delta) = 1 - \\frac{\\|\\mathbf{g}^{\\perp'}\\|}{\\|\\mathbf{g}^{\\perp}\\|} \\approx 1 - \\left(1 - \\alpha\\delta - \\frac{1}{2}\\delta^2\\right)\n$$\n$$\n\\Delta(\\alpha, \\delta) \\approx \\alpha\\delta + \\frac{1}{2}\\delta^2\n$$\nThis expression shows that the false reduction is most severe (linear in $\\delta$) when $\\alpha = |g^{\\parallel}|/\\|\\mathbf{g}^{\\perp}\\|$ is large. This occurs when the true force is nearly parallel to the path tangent, a condition often met near the transition state where $\\|\\mathbf{g}^{\\perp}\\|$ is meant to approach zero.\n\nBased on this derivation, two robust diagnostics to mitigate false convergence are:\n1.  **Monitor Tangent Vector Stability**: The tangent estimate $\\hat{\\tau}'$ is typically computed from the positions of adjacent images. During optimization, if the path geometry is unstable, $\\hat{\\tau}'$ will fluctuate significantly between iterations. A robust diagnostic is to monitor the angle $\\theta(t) = \\arccos(\\hat{\\tau}'(t) \\cdot \\hat{\\tau}'(t-1))$ between the tangent vector in the current step $t$ and the previous step $t-1$. If the convergence criterion on $\\|\\mathbf{g}^{\\perp'}\\|$ is met but $\\theta(t)$ remains large, convergence is unreliable. This indicates the estimated tangent, and thus the perpendicular force projection, has not stabilized.\n\n2.  **Monitor Total Force or Force Component Ratio**: The derivation shows the error is proportional to $\\alpha = |g^{\\parallel}|/\\|\\mathbf{g}^{\\perp}\\|$. A very large value of the estimated ratio $\\alpha' = |\\mathbf{g}\\cdot\\hat{\\tau}'|/\\|\\mathbf{g}^{\\perp'}\\|$ is a major red flag, even if $\\|\\mathbf{g}^{\\perp'}\\|$ is small. A true transition state is a stationary point on the potential energy surface where the total force $\\mathbf{g}$ is zero. The CI-NEB aims to find a point where $\\mathbf{g}^{\\perp}$ is zero, so $\\mathbf{g} = g^{\\parallel}\\hat{\\tau}$. A robust convergence check should therefore not only require $\\|\\mathbf{g}^{\\perp'}\\|$ to be small, but should also bound the magnitude of the total force $\\|\\mathbf{g}\\| = \\sqrt{|\\mathbf{g}\\cdot\\hat{\\tau}'|^2 + \\|\\mathbf{g}^{\\perp'}\\|^2}$ or, alternatively, the parallel force component $|\\mathbf{g}\\cdot\\hat{\\tau}'|$. Imposing a threshold on $\\|\\mathbf{g}\\|$ or $|\\mathbf{g}\\cdot\\hat{\\tau}'|$ prevents declaring convergence at a point where a large force vector is merely aligned with a poorly estimated tangent.\n\nThe primary result requested is the analytical expression for $\\Delta(\\alpha,\\delta)$.",
            "answer": "$$\\boxed{\\alpha\\delta + \\frac{1}{2}\\delta^2}$$"
        },
        {
            "introduction": "Real-world applications of CI-NEB, such as studying chemical reactions on catalyst surfaces or phase transformations in materials, involve systems with many degrees of freedom and are computationally demanding. Consequently, these calculations are almost always performed on parallel computing clusters. This final practice shifts our focus from the algorithm's mathematical details to its practical, high-performance implementation, analyzing how different strategies for distributing the NEB images across processors affect the communication overhead and overall efficiency. ",
            "id": "3845801",
            "problem": "Consider a discretized transition path in the Nudged Elastic Band (NEB) method, and its variant Climbing-Image Nudged Elastic Band (CI-NEB), where the path is represented by a sequence of images (configurations) $\\{\\mathbf{r}_i\\}_{i=0}^{N-1}$ with $N \\geq 2$, endpoints $i=0$ and $i=N-1$ held fixed, and inner images $i \\in \\{1,\\dots,N-2\\}$. Each image $i$ has a position vector $\\mathbf{r}_i \\in \\mathbb{R}^d$ with $d \\geq 1$ degrees of freedom, and a scalar energy $E_i \\in \\mathbb{R}$. The spring force for image $i$ depends on the positions of its neighbors $\\mathbf{r}_{i-1}$ and $\\mathbf{r}_{i+1}$, and the tangent at image $i$ depends on the relative ordering of the neighboring energies $E_{i-1}$ and $E_{i+1}$. In the Climbing-Image Nudged Elastic Band (CI-NEB) method, the highest-energy image modifies its force projection, but the data dependencies on neighboring images for computing spring forces and tangents remain local and confined to nearest neighbors.\n\nAssume a distributed-memory parallel computing environment with $P \\geq 1$ compute nodes, and an assignment map $a:\\{0,\\dots,N-1\\} \\rightarrow \\{0,\\dots,P-1\\}$ that maps each image index $i$ to the node $a(i)$ that owns it. Communication is required only across adjacent image boundaries $(j,j+1)$ with $j \\in \\{0,\\dots,N-2\\}$ when $a(j) \\neq a(j+1)$ and at least one of $j$ or $j+1$ is an inner image index. For $N \\leq 2$ there are no inner images, hence no communication is required. For $N \\geq 3$, every adjacent boundary $(j,j+1)$ touches at least one inner image, thus any cross-node adjacency requires communication.\n\nWe consider two image distribution schemes:\n\n- Contiguous blocks, denoted $\\mathcal{D}_\\text{contig}$: Partition the index set $\\{0,\\dots,N-1\\}$ into $K=\\min(P,N)$ consecutive, nearly equal-size blocks, and assign block $k$ to node $k$ for $k \\in \\{0,\\dots,K-1\\}$. All images belong to exactly one block, and blocks cover the entire chain contiguously without overlap.\n\n- Round-robin, denoted $\\mathcal{D}_\\text{rr}$: Assign $a(i)=i \\bmod P$ for all $i \\in \\{0,\\dots,N-1\\}$.\n\nAssume a nearest-neighbor ghost-exchange per iteration whereby for each cross-node adjacent boundary $(j,j+1)$, one message is sent in each direction containing the minimal payload needed by the neighbor to evaluate both spring forces and tangents for its inner images. Assume the payload per message comprises the neighbor’s position vector $\\mathbf{r}$ and scalar energy $E$, represented in double precision. The payload size per message is $B_\\text{msg}=8(d+1)$ bytes, since each of the $d$ positional components and the scalar energy are $8$-byte doubles. Ignoring headers and protocol overhead, the total number of messages per iteration is $M=2C$, where $C$ is the count of cross-node adjacent boundaries that touch at least one inner image. The total bytes per iteration is then $B = M \\cdot B_\\text{msg} = 2C \\cdot 8(d+1)$.\n\nYour task is to implement a program that, for each test case below, computes:\n- The integer $C$, the number of cross-node adjacent boundaries requiring communication as defined above.\n- The integer $M=2C$, the number of half-duplex messages per iteration.\n- The integer $B=2C \\cdot 8(d+1)$, the total number of bytes communicated per iteration.\n\nDistribution scheme details to implement:\n- For $\\mathcal{D}_\\text{contig}$: Let $K=\\min(P,N)$, and let $q=\\left\\lfloor \\frac{N}{K} \\right\\rfloor$ and $r=N \\bmod K$. The first $r$ nodes receive $q+1$ consecutive images, and the remaining $K-r$ nodes receive $q$ consecutive images, forming a contiguous partition of $\\{0,\\dots,N-1\\}$.\n- For $\\mathcal{D}_\\text{rr}$: Let $a(i)=i \\bmod P$ for all $i$.\n\nCommunication counting rule:\n- If $N \\leq 2$, set $C=0$.\n- If $N \\geq 3$, set $C$ to the count of indices $j \\in \\{0,\\dots,N-2\\}$ such that $a(j) \\neq a(j+1)$.\n\nTest suite parameter sets $(N,P,d,\\text{scheme})$:\n1. $(16,4,3,\\mathcal{D}_\\text{contig})$.\n2. $(16,4,3,\\mathcal{D}_\\text{rr})$.\n3. $(5,10,2,\\mathcal{D}_\\text{contig})$.\n4. $(2,5,3,\\mathcal{D}_\\text{rr})$.\n5. $(64,1,6,\\mathcal{D}_\\text{contig})$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s result is a list of three integers $[C,M,B]$, in the same order as the test suite. For example, an output with two cases would look like $[[C_1,M_1,B_1],[C_2,M_2,B_2]]$.",
            "solution": "The user seeks to determine the communication cost, in terms of the number of cross-node boundaries $C$, the number of messages $M$, and the total bytes transferred $B$, for parallel implementations of the Climbing-Image Nudged Elastic Band (CI-NEB) method under two different data distribution schemes. The problem is well-defined and grounded in standard practices of high-performance scientific computing.\n\nThe transition path is discretized into $N$ images, indexed from $i=0$ to $i=N-1$. These images are distributed among $P$ compute nodes. The assignment of image $i$ to a node is given by the map $a(i) \\in \\{0, \\dots, P-1\\}$. The degrees of freedom for each image are given by $d$.\n\nThe required communication metrics are defined as follows:\n- $C$: The number of cross-node adjacent boundaries. The problem specifies that for $N \\leq 2$, there are no inner images, thus $C=0$. For $N \\geq 3$, every boundary $(j, j+1)$ for $j \\in \\{0, \\dots, N-2\\}$ is adjacent to at least one inner image, so communication is required if and only if the adjacent images reside on different nodes. Therefore, for $N \\geq 3$, $C$ is the count of indices $j \\in \\{0, \\dots, N-2\\}$ such that $a(j) \\neq a(j+1)$.\n- $M$: The total number of messages per iteration. Since each cross-node boundary requires a ghost-exchange (one message in each direction), $M = 2C$.\n- $B$: The total number of bytes communicated per iteration. The payload for each message consists of a position vector $\\mathbf{r}_i \\in \\mathbb{R}^d$ and a scalar energy $E_i \\in \\mathbb{R}$, both represented as $8$-byte double-precision numbers. The size per message is $B_{\\text{msg}} = 8(d+1)$ bytes. The total number of bytes is $B = M \\cdot B_{\\text{msg}} = 2C \\cdot 8(d+1) = 16C(d+1)$.\n\nWe will now derive the formula for $C$ for each distribution scheme.\n\n**1. Contiguous Blocks Distribution ($\\mathcal{D}_\\text{contig}$)**\n\nIn this scheme, the $N$ images are partitioned into $K = \\min(P, N)$ contiguous blocks. The first $K$ nodes, indexed $0, \\dots, K-1$, each receive one block. If $P > N$, the remaining $P-K$ nodes are idle.\nThe assignment map $a(i)$ is piecewise constant, changing value only at the boundary between two consecutive blocks. There are $K$ blocks, so there are $K-1$ boundaries between them. Each of these boundaries separates images assigned to different nodes, e.g., node $k$ and node $k+1$.\nTherefore, the number of cross-node boundaries $C$ is simply the number of block boundaries.\n- If $K=1$ (which occurs if $P=1$ or $N \\leq 1$), all images are on a single node, and there are no block boundaries, so $C = 1-1=0$.\n- If $K > 1$, there are $K-1$ boundaries.\n\nCombining this with the general rule for $N$:\n- If $N \\leq 2$, $C=0$.\n- If $N \\geq 3$, $C = K-1 = \\min(P, N) - 1$.\nNote that for $N=2$, the formula gives $\\min(P,2)-1$, which can be $1$ if $P \\geq 2$. So we must strictly adhere to the rule $C=0$ for $N \\le 2$. The derived formula $C = \\min(P,N)-1$ is only valid for $N \\geq 3$.\n\n**2. Round-Robin Distribution ($\\mathcal{D}_\\text{rr}$)**\n\nIn this scheme, the assignment map is given by $a(i) = i \\bmod P$. We need to count the number of indices $j \\in \\{0, \\dots, N-2\\}$ for which $a(j) \\neq a(j+1)$.\nThis is equivalent to counting $j$ such that $j \\bmod P \\neq (j+1) \\bmod P$.\n\n- Case $P=1$: For any image $i$, $a(i) = i \\bmod 1 = 0$. All images are assigned to node $0$. Thus, $a(j) = a(j+1)$ for all $j$, and $C=0$.\n\n- Case $P>1$: Let's consider when $j \\bmod P = (j+1) \\bmod P$. Let this common value be $k$. This would imply $j = q_1 P + k$ and $j+1 = q_2 P + k$ for some integers $q_1, q_2$. Subtracting the first equation from the second gives $1 = (q_2 - q_1)P$. Since $P$ is an integer greater than $1$, this equation has no integer solution for $(q_2-q_1)$. Therefore, for $P>1$, $j \\bmod P \\neq (j+1) \\bmod P$ is always true.\nThis means that for $P>1$, every pair of adjacent images $(i, i+1)$ is assigned to a different pair of nodes.\nThe number of cross-node boundaries $C$ is the total number of adjacent boundaries between images, which is $N-1$.\n\nCombining this with the general rule for $N$:\n- If $N \\leq 2$, $C=0$.\n- If $N \\geq 3$:\n    - If $P=1$, $C=0$.\n    - If $P>1$, $C=N-1$.\n\nWe now apply these derived formulas to each test case.\n\n**Test Case 1: $(N,P,d,\\text{scheme}) = (16, 4, 3, \\mathcal{D}_\\text{contig})$**\n- $N=16$, $P=4$, $d=3$. Since $N=16 \\geq 3$, we apply the formula for $\\mathcal{D}_\\text{contig}$:\n- $C = \\min(P, N) - 1 = \\min(4, 16) - 1 = 4 - 1 = 3$.\n- $M = 2C = 2 \\cdot 3 = 6$.\n- $B = 16 C (d+1) = 16 \\cdot 3 \\cdot (3+1) = 48 \\cdot 4 = 192$.\n- Result: $[3, 6, 192]$.\n\n**Test Case 2: $(N,P,d,\\text{scheme}) = (16, 4, 3, \\mathcal{D}_\\text{rr})$**\n- $N=16$, $P=4$, $d=3$. Since $N=16 \\geq 3$ and $P=4 > 1$, we apply the formula for $\\mathcal{D}_\\text{rr}$:\n- $C = N - 1 = 16 - 1 = 15$.\n- $M = 2C = 2 \\cdot 15 = 30$.\n- $B = 16 C (d+1) = 16 \\cdot 15 \\cdot (3+1) = 240 \\cdot 4 = 960$.\n- Result: $[15, 30, 960]$.\n\n**Test Case 3: $(N,P,d,\\text{scheme}) = (5, 10, 2, \\mathcal{D}_\\text{contig})$**\n- $N=5$, $P=10$, $d=2$. Since $N=5 \\geq 3$, we apply the formula for $\\mathcal{D}_\\text{contig}$:\n- $C = \\min(P, N) - 1 = \\min(10, 5) - 1 = 5 - 1 = 4$.\n- $M = 2C = 2 \\cdot 4 = 8$.\n- $B = 16 C (d+1) = 16 \\cdot 4 \\cdot (2+1) = 64 \\cdot 3 = 192$.\n- Result: $[4, 8, 192]$.\n\n**Test Case 4: $(N,P,d,\\text{scheme}) = (2, 5, 3, \\mathcal{D}_\\text{rr})$**\n- $N=2$, $P=5$, $d=3$. Since $N=2 \\leq 2$, the rule specifies no communication is required.\n- $C = 0$.\n- $M = 0$.\n- $B = 0$.\n- Result: $[0, 0, 0]$.\n\n**Test Case 5: $(N,P,d,\\text{scheme}) = (64, 1, 6, \\mathcal{D}_\\text{contig})$**\n- $N=64$, $P=1$, $d=6$. Since $N=64 \\geq 3$, we apply the formula for $\\mathcal{D}_\\text{contig}$:\n- $C = \\min(P, N) - 1 = \\min(1, 64) - 1 = 1 - 1 = 0$.\n- $M = 2C = 0$.\n- $B = 16 C (d+1) = 0$.\n- This is expected, as with only one processor ($P=1$), there can be no cross-node communication.\n- Result: $[0, 0, 0]$.",
            "answer": "[[3,6,192],[15,30,960],[4,8,192],[0,0,0],[0,0,0]]"
        }
    ]
}