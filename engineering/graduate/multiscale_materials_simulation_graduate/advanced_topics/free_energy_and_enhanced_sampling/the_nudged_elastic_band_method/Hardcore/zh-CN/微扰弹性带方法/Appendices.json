{
    "hands_on_practices": [
        {
            "introduction": "要想精通微动弹性带（NEB）方法，首先必须理解作用于每个“镜像”（路径上的离散点）的力是如何构建的。本练习提供了一个具体的、分步式的计算过程，旨在将NEB力分解为其垂直于路径的势能力分量($\\mathbf{F}_i^{\\perp}$)和平行于路径的弹性力分量($\\mathbf{F}_i^{\\text{spring},\\parallel}$)。通过这个练习，你将清楚地看到这两个分量如何协同作用，共同驱动路径向最小能量路径（MEP）演化。",
            "id": "3849267",
            "problem": "考虑一个在二维构型空间中用于寻找最小能量路径的微动弹性带（Nudged Elastic Band, NEB）方法中使用的离散镜像路径。给定三个连续镜像的位置分别为 $\\mathbf{R}_{i-1} = (1.0,\\,0.0)$、$\\mathbf{R}_{i} = (2.0,\\,1.0)$ 和 $\\mathbf{R}_{i+1} = (3.5,\\,1.5)$，所有坐标均以埃（Ångström）为单位。镜像 $i$ 处的路径切线被指定为单位向量 $\\hat{\\tau}_{i} = \\left(\\frac{1}{\\sqrt{2}},\\,\\frac{1}{\\sqrt{2}}\\right)$。在 $\\mathbf{R}_{i}$ 处的势能梯度为 $\\nabla V(\\mathbf{R}_{i}) = (4,\\,-2)$，单位为电子伏特每埃。物理力为 $\\mathbf{F}_{i}^{\\text{true}} = -\\nabla V(\\mathbf{R}_{i})$。NEB 弹簧常数为 $k = 0.5$，单位为电子伏特每埃平方。该镜像使用 NEB 力通过最速下降移动进行更新，步长为 $\\eta = \\frac{1}{20}$，单位为埃平方每电子伏特。\n\n从以下基本依据出发：\n- 物理力由 $\\mathbf{F} = -\\nabla V$ 给出。\n- 向量 $\\mathbf{a}$ 沿着单位方向 $\\hat{\\mathbf{u}}$ 的平行分量是 $(\\mathbf{a}\\cdot\\hat{\\mathbf{u}})\\,\\hat{\\mathbf{u}}$，垂直分量是 $\\mathbf{a} - (\\mathbf{a}\\cdot\\hat{\\mathbf{u}})\\,\\hat{\\mathbf{u}}$。\n- 位置的最速下降更新使用 $\\mathbf{R}^{\\text{new}} = \\mathbf{R}^{\\text{old}} + \\eta\\,\\mathbf{F}^{\\text{eff}}$，其中 $\\mathbf{F}^{\\text{eff}}$ 为有效力。\n\n计算 $\\mathbf{F}_{i}^{\\text{true}}$ 相对于 $\\hat{\\tau}_{i}$ 的垂直和平行分量。然后，利用从给定位置计算出的路径上相邻间隔的差异，构建沿 $\\hat{\\tau}_{i}$ 方向的平行弹簧贡献项，并通过结合物理力的垂直分量和平行弹簧项来构造 NEB 有效力。最后，确定由此 NEB 更新产生的单步位移的大小 $\\|\\Delta \\mathbf{R}_{i}\\| = \\|\\eta\\,\\mathbf{F}_{i}^{\\text{NEB}}\\|$。\n\n请以精确的封闭形式解析表达式提供最终答案。位移大小以埃（Ångström）表示。不要四舍五入；要求提供精确表达式。最终答案必须是单个表达式。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、问题是良构的，并且提供了所有必要的信息。\n\n**问题验证**\n\n从问题陈述中提取的已知条件：\n- 三个连续镜像的位置：$\\mathbf{R}_{i-1} = (1.0,\\,0.0)$、$\\mathbf{R}_{i} = (2.0,\\,1.0)$ 和 $\\mathbf{R}_{i+1} = (3.5,\\,1.5)$。所有坐标均以埃（Å）为单位。\n- 镜像 $i$ 处的指定路径切线：$\\hat{\\tau}_{i} = \\left(\\frac{1}{\\sqrt{2}},\\,\\frac{1}{\\sqrt{2}}\\right)$。\n- $\\mathbf{R}_{i}$ 处的势能梯度：$\\nabla V(\\mathbf{R}_{i}) = (4,\\,-2)$，单位为电子伏特每埃（eV/Å）。\n- 真实物理力的定义：$\\mathbf{F}_{i}^{\\text{true}} = -\\nabla V(\\mathbf{R}_{i})$。\n- NEB 弹簧常数：$k = 0.5$ eV/Å$^2$。\n- 最速下降步长：$\\eta = \\frac{1}{20}$ Å$^2$/eV。\n- 更新规则：$\\mathbf{R}^{\\text{new}} = \\mathbf{R}^{\\text{old}} + \\eta\\,\\mathbf{F}^{\\text{eff}}$。\n- 向量分量的定义：向量 $\\mathbf{a}$ 沿 $\\hat{\\mathbf{u}}$ 的平行分量为 $(\\mathbf{a}\\cdot\\hat{\\mathbf{u}})\\,\\hat{\\mathbf{u}}$，垂直分量为 $\\mathbf{a} - (\\mathbf{a}\\cdot\\hat{\\mathbf{u}})\\,\\hat{\\mathbf{u}}$。\n\n该问题在科学上是合理的，因为它基于计算科学中广为接受的微动弹性带（NEB）方法。所有参数都已明确定义，单位一致，目标清晰。对于此类练习，使用指定的切向量是一种合理的简化，不会产生矛盾。因此，该问题被认为是有效的，可以推导出解答。\n\n**解答推导**\n\n解答过程遵循问题陈述中要求的步骤。\n\n首先，我们使用给定的势能梯度来确定作用在镜像 $i$ 上的真实物理力 $\\mathbf{F}_{i}^{\\text{true}}$：\n$$\n\\mathbf{F}_{i}^{\\text{true}} = -\\nabla V(\\mathbf{R}_{i}) = -(4,\\,-2) = (-4,\\,2) \\quad \\text{eV/Å}\n$$\n\n接下来，我们将此力分解为平行于和垂直于指定路径切线 $\\hat{\\tau}_{i} = \\left(\\frac{1}{\\sqrt{2}},\\,\\frac{1}{\\sqrt{2}}\\right)$ 的分量。平行分量通过将 $\\mathbf{F}_{i}^{\\text{true}}$ 投影到 $\\hat{\\tau}_{i}$ 上得到：\n$$\n\\mathbf{F}_{i}^{\\text{true},\\parallel} = (\\mathbf{F}_{i}^{\\text{true}} \\cdot \\hat{\\tau}_{i}) \\hat{\\tau}_{i}\n$$\n标量投影为：\n$$\n\\mathbf{F}_{i}^{\\text{true}} \\cdot \\hat{\\tau}_{i} = (-4,\\,2) \\cdot \\left(\\frac{1}{\\sqrt{2}},\\,\\frac{1}{\\sqrt{2}}\\right) = -4\\left(\\frac{1}{\\sqrt{2}}\\right) + 2\\left(\\frac{1}{\\sqrt{2}}\\right) = -\\frac{2}{\\sqrt{2}} = -\\sqrt{2} \\quad \\text{eV/Å}\n$$\n真实力的垂直分量 $\\mathbf{F}_{i}^{\\perp}$ 是真实力中与路径切线正交的部分。该分量在 NEB 力中用于引导路径朝向最小能量路径，而不会导致镜像沿路径滑动。\n$$\n\\mathbf{F}_{i}^{\\perp} = \\mathbf{F}_{i}^{\\text{true}} - \\mathbf{F}_{i}^{\\text{true},\\parallel} = \\mathbf{F}_{i}^{\\text{true}} - (\\mathbf{F}_{i}^{\\text{true}} \\cdot \\hat{\\tau}_{i}) \\hat{\\tau}_{i}\n$$\n代入数值：\n$$\n\\mathbf{F}_{i}^{\\perp} = (-4,\\,2) - (-\\sqrt{2})\\left(\\frac{1}{\\sqrt{2}},\\,\\frac{1}{\\sqrt{2}}\\right) = (-4,\\,2) - (-1,\\,-1) = (-3,\\,3) \\quad \\text{eV/Å}\n$$\n\nNEB 力的第二部分是弹簧力，其作用是保持路径上镜像之间的间距相等。弹簧力平行于路径切线方向作用。\n$$\n\\mathbf{F}_{i}^{\\text{spring},\\parallel} = k (\\|\\mathbf{R}_{i+1} - \\mathbf{R}_{i}\\| - \\|\\mathbf{R}_{i} - \\mathbf{R}_{i-1}\\|) \\hat{\\tau}_{i}\n$$\n我们需要计算与镜像 $i$ 相邻的路径段的长度：\n$$\n\\mathbf{R}_{i} - \\mathbf{R}_{i-1} = (2.0 - 1.0,\\,1.0 - 0.0) = (1,\\,1) \\quad \\text{Å}\n$$\n$$\n\\|\\mathbf{R}_{i} - \\mathbf{R}_{i-1}\\| = \\sqrt{1^2 + 1^2} = \\sqrt{2} \\quad \\text{Å}\n$$\n$$\n\\mathbf{R}_{i+1} - \\mathbf{R}_{i} = (3.5 - 2.0,\\,1.5 - 1.0) = (1.5,\\,0.5) = \\left(\\frac{3}{2},\\,\\frac{1}{2}\\right) \\quad \\text{Å}\n$$\n$$\n\\|\\mathbf{R}_{i+1} - \\mathbf{R}_{i}\\| = \\sqrt{\\left(\\frac{3}{2}\\right)^2 + \\left(\\frac{1}{2}\\right)^2} = \\sqrt{\\frac{9}{4} + \\frac{1}{4}} = \\sqrt{\\frac{10}{4}} = \\sqrt{\\frac{5}{2}} \\quad \\text{Å}\n$$\n当弹簧常数 $k = 0.5 = \\frac{1}{2}$ eV/Å$^2$ 时，弹簧力为：\n$$\n\\mathbf{F}_{i}^{\\text{spring},\\parallel} = \\frac{1}{2} \\left(\\sqrt{\\frac{5}{2}} - \\sqrt{2}\\right) \\hat{\\tau}_{i}\n$$\n\n总 NEB 力 $\\mathbf{F}_{i}^{\\text{NEB}}$ 是真实力的垂直分量与弹簧力的平行分量之和：\n$$\n\\mathbf{F}_{i}^{\\text{NEB}} = \\mathbf{F}_{i}^{\\perp} + \\mathbf{F}_{i}^{\\text{spring},\\parallel}\n$$\n由于 $\\mathbf{F}_{i}^{\\perp}$ 与 $\\hat{\\tau}_{i}$ 正交，而 $\\mathbf{F}_{i}^{\\text{spring},\\parallel}$ 与 $\\hat{\\tau}_{i}$ 平行，因此这两个向量相互正交。因此，总 NEB 力大小的平方等于它们大小的平方和：\n$$\n\\|\\mathbf{F}_{i}^{\\text{NEB}}\\|^2 = \\|\\mathbf{F}_{i}^{\\perp}\\|^2 + \\|\\mathbf{F}_{i}^{\\text{spring},\\parallel}\\|^2\n$$\n让我们计算大小的平方：\n$$\n\\|\\mathbf{F}_{i}^{\\perp}\\|^2 =\\|(-3,\\,3)\\|^2 = (-3)^2 + 3^2 = 9 + 9 = 18\n$$\n$$\n\\|\\mathbf{F}_{i}^{\\text{spring},\\parallel}\\|^2 = \\left\\| \\frac{1}{2} \\left(\\sqrt{\\frac{5}{2}} - \\sqrt{2}\\right) \\hat{\\tau}_{i} \\right\\|^2 = \\left( \\frac{1}{2} \\left(\\sqrt{\\frac{5}{2}} - \\sqrt{2}\\right) \\right)^2 \\|\\hat{\\tau}_{i}\\|^2\n$$\n因为 $\\hat{\\tau}_{i}$ 是一个单位向量，所以 $\\|\\hat{\\tau}_{i}\\|^2 = 1$。\n$$\n\\|\\mathbf{F}_{i}^{\\text{spring},\\parallel}\\|^2 = \\frac{1}{4} \\left(\\sqrt{\\frac{5}{2}} - \\sqrt{2}\\right)^2 = \\frac{1}{4} \\left( \\frac{5}{2} - 2\\sqrt{\\frac{5}{2}}\\sqrt{2} + 2 \\right) = \\frac{1}{4} \\left( \\frac{9}{2} - 2\\sqrt{5} \\right) = \\frac{9}{8} - \\frac{\\sqrt{5}}{2} = \\frac{9 - 4\\sqrt{5}}{8}\n$$\n现在，对大小的平方求和：\n$$\n\\|\\mathbf{F}_{i}^{\\text{NEB}}\\|^2 = 18 + \\frac{9 - 4\\sqrt{5}}{8} = \\frac{144}{8} + \\frac{9 - 4\\sqrt{5}}{8} = \\frac{153 - 4\\sqrt{5}}{8}\n$$\n\n最后，我们使用步长为 $\\eta = \\frac{1}{20}$ 的最速下降更新规则，计算单步位移的大小 $\\|\\Delta \\mathbf{R}_{i}\\|$：\n$$\n\\|\\Delta \\mathbf{R}_{i}\\| = \\|\\eta\\,\\mathbf{F}_{i}^{\\text{NEB}}\\| = \\eta \\|\\mathbf{F}_{i}^{\\text{NEB}}\\| = \\frac{1}{20} \\sqrt{\\frac{153 - 4\\sqrt{5}}{8}}\n$$\n为了将其表示为单个分数，我们化简该表达式：\n$$\n\\|\\Delta \\mathbf{R}_{i}\\| = \\frac{1}{20} \\frac{\\sqrt{153 - 4\\sqrt{5}}}{\\sqrt{8}} = \\frac{\\sqrt{153 - 4\\sqrt{5}}}{20 \\cdot 2\\sqrt{2}} = \\frac{\\sqrt{153 - 4\\sqrt{5}}}{40\\sqrt{2}}\n$$\n对分母进行有理化：\n$$\n\\|\\Delta \\mathbf{R}_{i}\\| = \\frac{\\sqrt{153 - 4\\sqrt{5}} \\cdot \\sqrt{2}}{40\\sqrt{2} \\cdot \\sqrt{2}} = \\frac{\\sqrt{2(153 - 4\\sqrt{5})}}{40 \\cdot 2} = \\frac{\\sqrt{306 - 8\\sqrt{5}}}{80}\n$$\n这就是位移大小的最终精确解析表达式，单位为埃。",
            "answer": "$$\\boxed{\\frac{\\sqrt{306 - 8\\sqrt{5}}}{80}}$$"
        },
        {
            "introduction": "理解了单个镜像的受力之后，我们将视角提升到整个反应路径。NEB计算的准确性不仅取决于力的计算，还严重依赖于镜像在路径上的分布。本练习利用一个简单的一维势能面，直观地展示了不均匀的镜像间距如何导致鞍点位置的计算偏差，并演示了一种实用的解决方法——在能量最高点附近有针对性地插入新的镜像以提高精度。",
            "id": "2818689",
            "problem": "设计并实现一个程序，用于定量分析微动弹性带（NEB）方法（Nudged Elastic Band (NEB)）中因一维最小能量路径上图像点间距不均匀而产生的离散化偏差。分析必须从一个明确定义的势能面出发，并基于微积分的第一性原理进行。\n\n考虑由下式给出的一维势能函数\n$$\nV(x) = \\frac{1}{4}\\left(x^2 - 1\\right)^2,\n$$\n其在 $x=-1$ 和 $x=1$ 处有极小值，并在原点处有一个单一的过渡态（鞍点）。连接这些极小值的最小能量路径是在构型空间中由 $x$ 本身参数化的直线。该路径的真实能垒位置和能量位于 $x^\\ddagger = 0$ 处，其值为 $V^\\ddagger = V(0)$。\n\n在NEB的框架下，一条路径被离散化为一系列连接端点 $x_0=-1$ 和 $x_{N-1}=1$ 的图像点（点）$x_0, x_1, \\dots, x_{N-1}$。能量最高的图像点 $x_k$ 被用作鞍点位置和能垒能量的估计量。当图像点间距不均匀时，$x_k$ 可能会偏离 $x^\\ddagger$，从而导致能垒能量出现偏差。在鞍点附近，一个光滑的势可以进行泰勒展开\n$$\nV(x) \\approx V^\\ddagger - \\frac{|\\kappa|}{2}\\,\\delta^2 + \\mathcal{O}(\\delta^4),\n$$\n其中 $\\delta = x - x^\\ddagger$，$|\\kappa|$ 是鞍点处负曲率的大小。因此，离散最大值处的绝对能量偏差与最近图像点到鞍点的距离成二次方关系。通过在当前最大值附近插入额外的图像点，可以减小 $\\delta$，从而减小能量偏差。\n\n你的任务是：\n- 使用由下式定义的单调映射 $s \\mapsto x$ 在路径上生成包含 $N$ 个图像点（包括端点）的初始集合\n$$\nx_i = -1 + 2\\, s_i^p,\\quad s_i = \\frac{i}{N-1},\\quad i\\in\\{0,1,\\dots,N-1\\},\n$$\n其中指数 $p \\geq 1$ 控制不均匀间距的程度。选择 $p=1$ 会产生均匀间距，而 $p>1$ 会使图像点向左侧极小值聚集。这种参数化纯粹是一种数学手段，用于模拟NEB中不均匀的切向弹簧分布效应，而无需显式地引入弹簧力。\n- 对于每个图像点集，计算能量最高图像点的索引 $k$、其对应的坐标 $x_k$ 和能量 $V(x_k)$。使用 $x^\\ddagger=0$ 和 $V^\\ddagger=V(0)$ 作为精确的鞍点位置和能垒能量，计算绝对能量误差\n$$\n\\Delta E_{\\text{before}} = \\left|V(x_k) - V^\\ddagger\\right|\n$$\n和位置误差\n$$\n\\Delta x_{\\text{before}} = \\left|x_k - x^\\ddagger\\right|.\n$$\n- 通过在 $x_k$ 的紧邻区域插入 $m$ 个新图像点来模拟NEB在离散最大值附近的定向图像点插入，具体方法如下：将两个相邻区间 $\\left[x_{k-1},x_k\\right]$ 和 $\\left[x_k,x_{k+1}\\right]$ 各自划分为相等的子区间，并插入等间距的内部点，使得总共添加 $m$ 个新图像点，其中 $\\lceil m/2 \\rceil$ 个位于左侧区间， $m - \\lceil m/2 \\rceil$ 个位于右侧区间。保持端点 $x=-1$ 和 $x=1$ 固定。插入后重新计算能量最高的图像点，以获得类似定义的 $\\Delta E_{\\text{after}}$ 和 $\\Delta x_{\\text{after}}$。\n- 通过输出每个测试用例的浮点数四元组 $[\\Delta E_{\\text{before}}, \\Delta E_{\\text{after}}, \\Delta x_{\\text{before}}, \\Delta x_{\\text{after}}]$（四舍五入到10位小数）来报告插入的定量效果。\n\n测试套件：\n- 用例A（不均匀间距，中等分辨率）：$N=9$, $p=3$, $m=2$。\n- 用例B（均匀间距，高分辨率）：$N=33$, $p=1$, $m=2$。\n- 用例C（高度不均匀间距，非常粗糙）：$N=5$, $p=5$, $m=2$。\n- 用例D（均匀间距且有一个图像点恰好在鞍点上）：$N=11$, $p=1$, $m=2$。\n\n科学真实性要求：\n- 所有计算都应在提供的精确解析势函数 $V(x)$ 上进行。将能量和位置视为无量纲量。\n- 本问题不使用角度。\n- 算法插入规则必须尊重邻接性：图像点只能在 $\\left[x_{k-1},x_k\\right]$ 和 $\\left[x_k,x_{k+1}\\right]$ 内部插入。\n\n最终输出格式：\n- 你的程序应生成一行输出，其中包含所有测试结果，形式为方括号括起来的逗号分隔列表。按顺序连接用例 A、B、C 和 D 的四个四舍五入后的数字。也就是说，输出是一个包含16个浮点数的扁平列表：\n$[\\Delta E_{\\text{before}}^{(A)},\\Delta E_{\\text{after}}^{(A)},\\Delta x_{\\text{before}}^{(A)},\\Delta x_{\\text{after}}^{(A)},\\dots,\\Delta E_{\\text{before}}^{(D)},\\Delta E_{\\text{after}}^{(D)},\\Delta x_{\\text{before}}^{(D)},\\Delta x_{\\text{after}}^{(D)}]$。",
            "solution": "我们从应用于离散化最小能量路径的微积分第一性原理出发。微动弹性带（NEB）方法通过有限个图像点集 $x_0,\\dots,x_{N-1}$ 来表示构型空间中的一条连续路径，其中 $x_0$ 和 $x_{N-1}$ 固定在反应物和产物的极小值点。能量最高的图像点被用作鞍点的离散代理。当图像点分布不均时，离真实鞍点 $x^\\ddagger$ 最近的图像点可能位于一个有限的偏移量 $\\delta = x_k - x^\\ddagger$ 处，从而对鞍点位置和能垒能量产生有偏估计。\n\n基本原理：对于在 $x^\\ddagger$ 处有一个非简并鞍点的光滑势能面 $V(x)$，在 $x^\\ddagger$ 邻域内的泰勒展开式为\n$$\nV(x^\\ddagger + \\delta) = V^\\ddagger + \\frac{1}{2} V''(x^\\ddagger)\\,\\delta^2 + \\mathcal{O}(\\delta^3),\n$$\n其中根据驻点条件有 $V'(x^\\ddagger)=0$，根据一阶鞍点的定义有 $V''(x^\\ddagger)0$。对于特定势函数\n$$\nV(x) = \\frac{1}{4}(x^2-1)^2 = \\frac{1}{4} - \\frac{1}{2}x^2 + \\frac{1}{4}x^4,\n$$\n根据对称性我们有 $x^\\ddagger=0$，$V^\\ddagger = V(0) = \\frac{1}{4}$，以及 $V''(0) = -1$。因此，\n$$\nV(\\delta) = \\frac{1}{4} - \\frac{1}{2}\\delta^2 + \\frac{1}{4}\\delta^4,\n$$\n且距离鞍点 $\\delta$ 的离散最大值处的绝对能量偏差为\n$$\n\\Delta E = \\left|V(\\delta) - V^\\ddagger\\right| = \\frac{1}{2}\\delta^2 - \\frac{1}{4}\\delta^4.\n$$\n对于足够小的 $\\delta$，主导行为是二次的，\n$$\n\\Delta E \\approx \\frac{1}{2}\\delta^2,\n$$\n这将一个直观认识形式化了，即能垒能量的离散化偏差随图像点与鞍点接近程度的平方而衰减。\n\n算法设计：为模拟不均匀的NEB间距而不显式引入切向弹簧力，我们通过 $x_i = -1 + 2\\,(\\frac{i}{N-1})^p$ 来参数化初始图像点。对于 $p>1$，这将图像点集中在左侧极小值附近。我们通过最大化 $V(x_i)$ 来计算能量最高图像点的索引 $k$。相应的绝对误差为\n$$\n\\Delta x_{\\text{before}} = |x_k - x^\\ddagger|, \\quad \\Delta E_{\\text{before}} = |V(x_k) - V^\\ddagger|.\n$$\n为了减小偏差，我们通过细分相邻区间 $[x_{k-1},x_k]$ 和 $[x_k,x_{k+1}]$，在 $x_k$ 的紧邻区域进行 $m$ 个图像点的定向插入。具体来说，我们在 $[x_{k-1},x_k]$ 中放置 $\\lceil m/2 \\rceil$ 个等间距的内部点，在 $[x_k,x_{k+1}]$ 中放置 $m - \\lceil m/2 \\rceil$ 个。这使得离散最大值附近的局部网格尺寸减半或更小，并相应地减小 $\\Delta x$。由于 $\\Delta E$ 在 $\\Delta x$ 上是渐进二次的，所以在鞍点附近进行理想的对称细化时，可以预期能量偏差会有一个接近4的近似减小因子。\n\n我们将此应用于测试套件：\n- 用例A：$N=9$, $p=3$, $m=2$。初始图像点聚集在 $x=-1$ 附近，在鞍点周围留下一个很大的间隙。离散最大值位于某个 $x_k0$ 处，且 $\\Delta x_{\\text{before}}>0$。插入 $m=2$ 个图像点会在每个相邻区间各放一个，使最近的图像点更接近 $x^\\ddagger=0$，从而显著减小 $\\Delta x$ 和 $\\Delta E$，这与二次方关系一致。\n- 用例B：$N=33$, $p=1$, $m=2$。当 $N$ 为奇数时，均匀间距会使一个图像点恰好位于 $x=0$ 处，因此 $\\Delta x_{\\text{before}}=0$ 且 $\\Delta E_{\\text{before}}=0$。插入操作后最大值仍在 $x^\\ddagger$ 处，因此误差保持为零。\n- 用例C：$N=5$, $p=5$, $m=2$。极其不均匀的粗糙间距使得最近的图像点位于一个很大的 $|\\delta|$ 处，产生一个很大的 $\\Delta E_{\\text{before}}$。插入两个图像点会大幅减小 $\\Delta x$，从而使 $\\Delta E$ 的减小因子超过4这个数量级，尽管确切的因子取决于相邻区间的不对称性。\n- 用例D：$N=11$, $p=1$, $m=2$。与用例B一样，一个图像点恰好位于 $x^\\ddagger$ 处，因此插入前后的误差均为零。\n\n实现细节：\n- 根据解析函数 $V(x)$ 及其对称性直接计算 $V^\\ddagger = V(0)$ 和 $x^\\ddagger=0$。\n- 通过直接计算 $V(x_i)$ 来确定能量最高的图像点。\n- 通过在每个相邻区间上放置等间距的内部点来执行插入，并保持端点 $x=-1$ 和 $x=1$ 不变。\n- 插入后重新计算最大值和误差。\n- 对于每个测试用例，按A、B、C、D的顺序，输出四元组 $[\\Delta E_{\\text{before}}, \\Delta E_{\\text{after}}, \\Delta x_{\\text{before}}, \\Delta x_{\\text{after}}]$，四舍五入到10位小数，并连接成一个扁平列表。\n\n此设计将鞍点附近 $V(x)$ 的数学展开与一个具体的算法补救措施（局部插入）直接联系起来，并通过提供的测试用例展示了减小最大值附近的局部离散化长度如何校正位置和能垒能量估计中的偏差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef potential(x):\n    # V(x) = 1/4 (x^2 - 1)^2\n    return 0.25 * (x**2 - 1.0)**2\n\ndef generate_images(N, p):\n    # Generate N images including endpoints using x = -1 + 2*(s^p), s in [0,1]\n    s = np.linspace(0.0, 1.0, N, dtype=float)\n    x = -1.0 + 2.0 * (s ** p)\n    # Ensure sorted uniqueness (should already be sorted)\n    x = np.array(sorted(set(np.round(x, 16))))  # guard against fp duplicates\n    return x\n\ndef analyze_images(x, x_saddle=0.0):\n    E = potential(x)\n    k = int(np.argmax(E))\n    x_max = float(x[k])\n    E_max = float(E[k])\n    E_saddle = float(potential(x_saddle))\n    dE = abs(E_max - E_saddle)\n    dx = abs(x_max - x_saddle)\n    return dE, dx, k\n\ndef insert_near_max(x, k, m):\n    # Insert m new images near index k: distribute ceil(m/2) on left interval [x[k-1], x[k]]\n    # and the rest on right interval [x[k], x[k+1]]. Endpoints remain fixed.\n    if m == 0:\n        return np.array(x, dtype=float)\n    n = len(x)\n    # Safety: k should not be at endpoints for this potential; if it is, return unchanged\n    if k == 0 or k >= n - 1:\n        return np.array(x, dtype=float)\n    left_count = int(np.ceil(m / 2.0))\n    right_count = int(m - left_count)\n    new_points = []\n\n    # Left interval subdivision: generate equally spaced interior points\n    xL, xK = x[k - 1], x[k]\n    if left_count > 0:\n        for j in range(1, left_count + 1):\n            frac = j / (left_count + 1)\n            new_points.append(xL + frac * (xK - xL))\n\n    # Right interval subdivision\n    xK, xR = x[k], x[k + 1]\n    if right_count > 0:\n        for j in range(1, right_count + 1):\n            frac = j / (right_count + 1)\n            new_points.append(xK + frac * (xR - xK))\n\n    x_aug = np.concatenate([x, np.array(new_points, dtype=float)])\n    x_aug.sort()\n    # Deduplicate with tolerance\n    x_unique = []\n    for xi in x_aug:\n        if len(x_unique) == 0 or abs(xi - x_unique[-1]) > 1e-15:\n            x_unique.append(float(xi))\n    return np.array(x_unique, dtype=float)\n\ndef run_case(N, p, m):\n    x0 = generate_images(N, p)\n    dE_before, dx_before, k = analyze_images(x0, 0.0)\n    x1 = insert_near_max(x0, k, m)\n    dE_after, dx_after, _ = analyze_images(x1, 0.0)\n    return dE_before, dE_after, dx_before, dx_after\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (N, p, m)\n    test_cases = [\n        (9, 3.0, 2),   # Case A\n        (33, 1.0, 2),  # Case B\n        (5, 5.0, 2),   # Case C\n        (11, 1.0, 2),  # Case D\n    ]\n\n    results = []\n    for N, p, m in test_cases:\n        dE_before, dE_after, dx_before, dx_after = run_case(N, p, m)\n        # Round to 10 decimal places as specified\n        results.extend([\n            round(dE_before, 10),\n            round(dE_after, 10),\n            round(dx_before, 10),\n            round(dx_after, 10),\n        ])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "当NEB计算收敛后，一个至关重要的后续步骤是验证所找到的最高能量镜像是否为真实的过渡态。本练习将指导你完成在候选鞍点处数值计算Hessian矩阵的全过程。通过分析Hessian矩阵的特征值，你可以确认该点是否具有且仅具有一个负特征值——这是一阶鞍点的明确标志，从而将NEB的计算结果与过渡态理论严格联系起来。",
            "id": "3789297",
            "problem": "给定一个二维空间中的无量纲势能面，由函数 $E(\\mathbf{x})$（其中 $\\mathbf{x} \\in \\mathbb{R}^2$）指定，以及三条通过候选鞍点图像的离散路径，该图像通过微动弹性带 (Nudged Elastic Band, NEB) 方法获得。您的任务是数值构建每条路径中心图像处的完整 Hessian 矩阵，通过单一负特征值准则对鞍点进行分类，并量化最不稳定模式相对于 NEB 路径切线的方向。\n\n使用的基础理论：\n- 标量场 $E(\\mathbf{x})$ 在 $\\mathbf{x}^\\star$ 处的 Hessian 矩阵是由二阶偏导数定义的矩阵：$H_{ij}(\\mathbf{x}^\\star) = \\frac{\\partial^2 E}{\\partial x_i \\partial x_j}(\\mathbf{x}^\\star)$。\n- 对称 Hessian 矩阵的特征值 $\\lambda_k$ 和特征向量 $\\mathbf{v}_k$ 满足 $H \\mathbf{v}_k = \\lambda_k \\mathbf{v}_k$，其中 $\\{\\mathbf{v}_k\\}$ 是标准正交的。\n- 在原子模拟中，过渡态是一个一阶鞍点，意味着 Hessian 矩阵恰好有一个严格为负的特征值。\n- 在离散路径 $\\{\\mathbf{x}_0,\\mathbf{x}_1,\\mathbf{x}_2\\}$ 中，索引为 $m$ 的图像处的 NEB 路径切线由归一化差分近似：$\\mathbf{t} = \\frac{\\mathbf{x}_{m+1} - \\mathbf{x}_{m-1}}{\\|\\mathbf{x}_{m+1} - \\mathbf{x}_{m-1}\\|}$。\n\n您必须实现一种用于偏导数的对称中心有限差分近似，并使用均匀步长 $h$ 来数值计算 Hessian 矩阵。使用负值容差 $\\tau$ 来分类特征值：如果一个特征值 $\\lambda  -\\tau$，则计为负值；如果 $\\lambda > \\tau$，则计为正值；否则视为数值上为零。报告最小负特征值对应的特征向量与 NEB 切线之间的夹角（以弧度为单位），并报告该特征向量相对于切线的带符号平行分量和垂直分量的范数。夹角应在方向之间计算（忽略整体符号），即在余弦中使用点积的绝对值，并以弧度表示。\n\n测试套件：\n- 案例 $1$ (理想路径): $E_1(x_1,x_2) = (x_1^2 - 1)^2 + 0.5\\,x_2^2$。离散路径图像为 $\\mathbf{x}_0 = (-1,0)$, $\\mathbf{x}_1 = (0,0)$, 和 $\\mathbf{x}_2 = (1,0)$。使用 $h = 10^{-4}$ 和 $\\tau = 10^{-8}$。\n- 案例 $2$ (非过渡态最大值): $E_2(x_1,x_2) = -x_1^2 - x_2^2 + 0.1\\,(x_1^4 + x_2^4)$。离散路径图像为 $\\mathbf{x}_0 = (-0.1,0)$, $\\mathbf{x}_1 = (0,0)$, 和 $\\mathbf{x}_2 = (0.1,0)$。使用 $h = 10^{-4}$ 和 $\\tau = 10^{-8}$。\n- 案例 $3$ (近简并平坦方向): $E_3(x_1,x_2) = (x_1^2 - 1)^2 + \\epsilon\\,x_2^4$ 其中 $\\epsilon = 10^{-6}$。离散路径图像为 $\\mathbf{x}_0 = (-1,0)$, $\\mathbf{x}_1 = (0,0)$, 和 $\\mathbf{x}_2 = (1,0)$。使用 $h = 10^{-4}$ 和 $\\tau = 10^{-8}$。\n\n对于每个案例，在中心图像 $\\mathbf{x}_1$ 处执行以下操作：\n- 使用步长为 $h$ 的对称中心有限差分法，数值计算完整的 Hessian 矩阵 $H(\\mathbf{x}_1)$。\n- 计算 $H(\\mathbf{x}_1)$ 的所有特征值和特征向量。\n- 使用 $\\tau$ 验证单一负特征值准则，并返回一个布尔值，指示该准则是否成立。\n- 根据给定的相邻图像计算 $\\mathbf{x}_1$ 处的 NEB 切线 $\\mathbf{t}$ 并将其归一化。\n- 选择与最小负特征值（即最小的特征值）对应的特征向量 $\\mathbf{v}_{\\min}$。计算由 $\\mathbf{v}_{\\min}$ 和 $\\mathbf{t}$ 张成的方向之间的夹角 $\\theta$（以弧度为单位），带符号的平行分量 $c_{\\parallel} = \\mathbf{v}_{\\min} \\cdot \\mathbf{t}$，以及垂直分量的范数 $c_{\\perp} = \\|\\mathbf{v}_{\\min} - c_{\\parallel}\\,\\mathbf{t}\\|$。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表形式的结果，其中每个元素按顺序对应一个案例。每个案例的结果必须是一个结构为 $[\\text{boolean}, \\theta, c_{\\parallel}, c_{\\perp}]$ 的列表，其中角度 $\\theta$ 以弧度为单位。\n- 示例格式：$[[\\text{True}, 0.123, 0.456, 0.789],[\\text{False}, 0.321, -0.654, 0.987],[\\text{True}, 0.000, 1.000, 0.000]]$。\n\n所有量都是无量纲的；角度以弧度表示。不需要外部输入；请完全按照上述规定在程序中硬编码测试套件。",
            "solution": "该问题要求对二维势能面上的候选鞍点进行分析，这些鞍点是通过微动弹性带 (Nudged Elastic Band, NEB) 计算获得的。对于给定的三种情况，我们必须表征离散路径 $\\{\\mathbf{x}_0, \\mathbf{x}_1, \\mathbf{x}_2\\}$ 中心图像 $\\mathbf{x}_1$ 处的驻点。这种表征涉及计算 Hessian 矩阵，分析其特征值以确定该点是否为一阶鞍点（过渡态），并量化不稳定模式与反应路径切线的对齐程度。\n\n每种情况的步骤如下：\n\n1.  **Hessian 矩阵的数值计算**\n\n标量势能函数 $E(\\mathbf{x})$（其中 $\\mathbf{x} = (x_1, x_2)$）的 Hessian 矩阵 $H$ 是一个 $2 \\times 2$ 的二阶偏导数矩阵：\n$$\nH(\\mathbf{x}) = \\begin{pmatrix}\n\\frac{\\partial^2 E}{\\partial x_1^2}  \\frac{\\partial^2 E}{\\partial x_1 \\partial x_2} \\\\\n\\frac{\\partial^2 E}{\\partial x_2 \\partial x_1}  \\frac{\\partial^2 E}{\\partial x_2^2}\n\\end{pmatrix}\n$$\n由于势能函数是连续可微的，Hessian 矩阵是对称的，即 $\\frac{\\partial^2 E}{\\partial x_1 \\partial x_2} = \\frac{\\partial^2 E}{\\partial x_2 \\partial x_1}$。我们的任务是使用步长为 $h$ 的对称中心有限差分格式，在中心图像 $\\mathbf{x}_1 = (x_{1,1}, x_{2,1})$ 处计算该矩阵。各分量的公式如下：\n\n-   对角元素：\n    $$\n    H_{11} = \\frac{\\partial^2 E}{\\partial x_1^2} \\approx \\frac{E(x_{1,1}+h, x_{2,1}) - 2E(x_{1,1}, x_{2,1}) + E(x_{1,1}-h, x_{2,1})}{h^2}\n    $$\n    $$\n    H_{22} = \\frac{\\partial^2 E}{\\partial x_2^2} \\approx \\frac{E(x_{1,1}, x_{2,1}+h) - 2E(x_{1,1}, x_{2,1}) + E(x_{1,1}, x_{2,1}-h)}{h^2}\n    $$\n-   非对角元素：\n    $$\n    H_{12} = H_{21} = \\frac{\\partial^2 E}{\\partial x_1 \\partial x_2} \\approx \\frac{E(x_{1,1}+h, x_{2,1}+h) - E(x_{1,1}+h, x_{2,1}-h) - E(x_{1,1}-h, x_{2,1}+h) + E(x_{1,1}-h, x_{2,1}-h)}{4h^2}\n    $$\n这些近似被应用于每个测试案例中点 $\\mathbf{x}_1$ 处的特定能量函数 $E(x_1, x_2)$。\n\n2.  **特征值分析与鞍点分类**\n\n一旦数值 Hessian 矩阵 $H(\\mathbf{x}_1)$ 构建完成，我们求解特征值问题 $H \\mathbf{v}_k = \\lambda_k \\mathbf{v}_k$ 以找到其特征值 $\\lambda_k$ 和相应的特征向量 $\\mathbf{v}_k$。对于一个对称的 $2 \\times 2$ Hessian 矩阵，我们将获得两个实特征值 $\\lambda_1$ 和 $\\lambda_2$。\n\n过渡态（或一阶鞍点）的特征是恰好有一个负特征值。我们使用提供的负值容差 $\\tau$ 来进行此分类。一个特征值 $\\lambda$ 当且仅当 $\\lambda  -\\tau$ 时被计为负值。我们计算此类负特征值的数量。如果此数量恰好为一，则点 $\\mathbf{x}_1$ 被分类为过渡态。\n\n3.  **不稳定模式与路径切线分析**\n\n如果该点是鞍点，则对应于单一负特征值的特征向量代表了“不稳定模式”的方向——即离开鞍点的最低能垒方向。我们将此特征向量表示为 $\\mathbf{v}_{\\min}$。\n\n中心图像 $\\mathbf{x}_1$ 处的 NEB 路径切线提供了反应路径方向的近似。它使用相邻图像 $\\mathbf{x}_0$ 和 $\\mathbf{x}_2$ 计算得出：\n$$\n\\mathbf{t} = \\frac{\\mathbf{x}_2 - \\mathbf{x}_0}{\\|\\mathbf{x}_2 - \\mathbf{x}_0\\|}\n$$\n切向量 $\\mathbf{t}$ 被归一化为单位向量。\n\n最后，我们量化不稳定模式 $\\mathbf{v}_{\\min}$ 和路径切线 $\\mathbf{t}$ 之间的关系。$\\mathbf{v}_{\\min}$（由标准特征求解器返回）和 $\\mathbf{t}$ 都是单位向量。\n\n-   **夹角 $\\theta$**：计算两个向量方向之间的夹角。为确保夹角在 $0$ 和 $\\pi/2$ 弧度之间（即我们比较的是方向，而不是具有任意符号的特定向量），我们使用点积的绝对值：\n    $$\n    \\theta = \\arccos(|\\mathbf{v}_{\\min} \\cdot \\mathbf{t}|)\n    $$\n-   **带符号平行分量 $c_{\\parallel}$**：这衡量了 $\\mathbf{v}_{\\min}$ 在 $\\mathbf{t}$ 上的投影。由于 $\\mathbf{t}$ 是单位向量，这只是点积：\n    $$\n    c_{\\parallel} = \\mathbf{v}_{\\min} \\cdot \\mathbf{t}\n    $$\n    $c_{\\parallel}$ 的符号取决于数值求解器返回的特征向量的任意符号约定。\n-   **垂直分量范数 $c_{\\perp}$**：这衡量了 $\\mathbf{v}_{\\min}$ 正交于切线 $\\mathbf{t}$ 的分量的大小。它通过向量差的范数计算得出：\n    $$\n    c_{\\perp} = \\|\\mathbf{v}_{\\min} - c_{\\parallel} \\mathbf{t}\\|\n    $$\n通过将此完整过程应用于三个测试案例中的每一个，我们可以验证候选鞍点的性质以及 NEB 路径对齐的质量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by analyzing candidate saddle points for three test cases.\n    \"\"\"\n\n    def compute_hessian(E, x, h):\n        \"\"\"\n        Computes the Hessian matrix of a 2D scalar function E at point x\n        using symmetric central finite differences with step size h.\n        \"\"\"\n        x1, x2 = x\n        \n        # Second derivative with respect to x1\n        H11 = (E(x1 + h, x2) - 2 * E(x1, x2) + E(x1 - h, x2)) / (h**2)\n        \n        # Second derivative with respect to x2\n        H22 = (E(x1, x2 + h) - 2 * E(x1, x2) + E(x1, x2 - h)) / (h**2)\n        \n        # Mixed partial derivative\n        H12 = (E(x1 + h, x2 + h) - E(x1 + h, x2 - h) - E(x1 - h, x2 + h) + E(x1 - h, x2 - h)) / (4 * h**2)\n        \n        # Hessian is symmetric, H21 = H12\n        return np.array([[H11, H12], [H12, H22]])\n\n    def analyze_saddle(E, path, h, tau):\n        \"\"\"\n        Performs the full analysis for a given potential and path.\n        \"\"\"\n        x0, x1, x2 = path\n        \n        # 1. Compute the Hessian at the central image x1\n        H = compute_hessian(E, x1, h)\n        \n        # 2. Compute eigenvalues and eigenvectors.\n        # numpy.linalg.eigh is used for symmetric matrices. It returns eigenvalues\n        # in ascending order and corresponding eigenvectors as columns.\n        eigenvalues, eigenvectors = np.linalg.eigh(H)\n        \n        # 3. Verify the single negative eigenvalue criterion\n        num_negative_eigenvalues = np.sum(eigenvalues  -tau)\n        is_transition_state = (num_negative_eigenvalues == 1)\n        \n        # 4. Compute the NEB tangent at x1\n        tangent_raw = x2 - x0\n        tangent = tangent_raw / np.linalg.norm(tangent_raw)\n        \n        # 5. Select the eigenvector for the most negative eigenvalue\n        # This corresponds to the first eigenvalue/eigenvector from eigh.\n        v_min = eigenvectors[:, 0]\n        \n        # 6. Compute angle, parallel, and perpendicular components\n        # Angle between directions (using abs of dot product)\n        dot_product = np.dot(v_min, tangent)\n        \n        # Handle potential floating point inaccuracies for arccos\n        # Clamp the argument to the valid range [-1, 1]\n        angle_arg = np.clip(np.abs(dot_product), -1.0, 1.0)\n        theta = np.arccos(angle_arg)\n        \n        # Signed parallel component\n        c_parallel = dot_product\n        \n        # Perpendicular component norm\n        c_perpendicular = np.linalg.norm(v_min - c_parallel * tangent)\n        \n        return [is_transition_state, theta, c_parallel, c_perpendicular]\n\n    # Test suite parameters\n    h = 1e-4\n    tau = 1e-8\n    \n    test_cases = [\n        {\n            \"E\": lambda x1, x2: (x1**2 - 1)**2 + 0.5 * x2**2,\n            \"path\": (np.array([-1.0, 0.0]), np.array([0.0, 0.0]), np.array([1.0, 0.0])),\n        },\n        {\n            \"E\": lambda x1, x2: -x1**2 - x2**2 + 0.1 * (x1**4 + x2**4),\n            \"path\": (np.array([-0.1, 0.0]), np.array([0.0, 0.0]), np.array([0.1, 0.0])),\n        },\n        {\n            \"E\": lambda x1, x2: (x1**2 - 1)**2 + 1e-6 * x2**4,\n            \"path\": (np.array([-1.0, 0.0]), np.array([0.0, 0.0]), np.array([1.0, 0.0])),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = analyze_saddle(case[\"E\"], case[\"path\"], h, tau)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The str() of a list automatically includes brackets and commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}