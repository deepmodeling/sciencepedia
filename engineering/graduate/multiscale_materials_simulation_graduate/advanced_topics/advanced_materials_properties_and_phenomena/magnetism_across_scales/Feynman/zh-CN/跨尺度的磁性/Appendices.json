{
    "hands_on_practices": [
        {
            "introduction": "磁晶各向异性是连接材料晶体结构与其宏观磁性的关键桥梁。本练习将演示如何从第一性原理的量子力学计算（如密度泛函理论，DFT）中提取这一宏观参数（各向异性常数$K$）。通过实践磁扭矩方法，我们将学习一种强大的计算技术，从而搭建起从电子尺度到连续介质模型的直接联系。",
            "id": "3822530",
            "problem": "考虑一个单轴铁磁体，其通过密度泛函理论（DFT）计算得到的总能量取决于磁化矢量 $\\mathbf{M}$ 相对于晶体易磁化轴的取向。该取向通过极角 $\\theta$ 参数化，并以弧度表示。磁晶各向异性常数 $K$ 定义为将磁化矢量 $\\mathbf{M}$ 从易磁化轴上旋转开所对应的能量密度。磁扭矩法将 $\\mathbf{M}$ 微小旋转下的总能量变化与能量最低点附近的各向异性能曲率联系起来。仅从以下基本定义出发：(i) 扭矩是能量的负角导数，即 $ \\tau(\\theta) = -\\frac{\\partial E}{\\partial \\theta} $；(ii) 在易磁化轴附近，能量的各向异性部分是关于 $\\theta$ 的偶函数，并允许进行平滑的泰勒展开。请推导一个算法，用于根据在易磁化轴附近对 $\\mathbf{M}$ 进行小角度旋转所获得的DFT总能量 $E(\\theta)$ 来计算 $K$。具体来说，请将 $E(\\theta)$ 在 $\\theta = 0$ 处的曲率与 $K$ 联系起来，并说明如何通过总能量的小角度有限差分来估算该曲率。然后，通过除以晶胞体积，将 $K$ 表示为以焦耳/立方米为单位的能量密度。\n\n你的程序必须实现所推导的算法，并使用以下包含DFT总能量和体积的测试套件。在每个测试用例中，输入是一个包含五个值的元组：$(E(0), E(+\\delta), E(-\\delta), \\delta, V)$，其中 $E(0)$、$E(+\\delta)$ 和 $E(-\\delta)$ 是以电子伏特/晶胞为单位的总能量，$\\delta$ 是以弧度为单位的小旋转角，$V$ 是以立方米为单位的晶胞体积。如果 $E(-\\delta)$ 不可用，它将以特殊值 None 的形式提供。你的程序必须为每个测试用例计算以焦耳/立方米为单位的各向异性常数 $K$，计算时需遵循小角度近似，并在 $E(+\\delta)$ 和 $E(-\\delta)$ 均可用时使用中心有限差分。\n\n使用以下测试套件：\n- 情况 A（一般小角度旋转，对称能量）：$(E(0), E(+\\delta), E(-\\delta), \\delta, V) = (-100.0, -99.999999, -99.999999, 0.1, 2.0\\times 10^{-29})$。\n- 情况 B（零各向异性边界）：$(E(0), E(+\\delta), E(-\\delta), \\delta, V) = (-50.123456, -50.123456, -50.123456, 0.05, 3.0\\times 10^{-29})$。\n- 情况 C（有限各向异性伴有微小非对称数值噪声）：$(E(0), E(+\\delta), E(-\\delta), \\delta, V) = (-200.0, -199.99999499, -199.99999501, 0.2, 1.8\\times 10^{-29})$。\n- 情况 D（单边小角度数据，$E(-\\delta)$ 缺失）：$(E(0), E(+\\delta), E(-\\delta), \\delta, V) = (-75.0, -74.999999, \\text{None}, 0.15, 2.2\\times 10^{-29})$。\n\n角度值必须以弧度处理。能量值必须以电子伏特/晶胞处理，并使用 $1\\,\\text{electronvolt} = 1.602176634\\times 10^{-19}\\,\\text{Joules}$ 转换为焦耳。体积必须以立方米处理。将每个计算出的各向异性常数 $K$ 表示为以焦耳/立方米为单位的浮点数。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[K_A,K_B,K_C,K_D]$），每个 $K$ 值按上述顺序列出，分别对应相应的测试用例。",
            "solution": "所述问题具有科学依据，提法恰当且客观。它提供了一套完整的定义、数据和约束，足以推导并实现一个唯一且稳定的数值解。其物理模型基于前述标准的单轴磁晶各向异性理论，数值任务则涉及标准的有限差分近似。因此，该问题被认定为有效。\n\n目标是推导一种算法，用于根据通过密度泛函理论（DFT）计算得到的一组总能量值来计算磁晶各向异性常数 $K$。这些能量值是在磁化矢量偏离晶体易磁化轴的微小角度下获得的。\n\n设磁化矢量 $\\mathbf{M}$ 的取向由相对于易磁化轴的极角 $\\theta$ 描述，易磁化轴定义在 $\\theta=0$ 处。系统的总能量 $E(\\theta)$ 可以在 $\\theta=0$ 这个能量最低点附近进行泰勒级数展开：\n$$E(\\theta) = E(0) + \\left.\\frac{\\partial E}{\\partial \\theta}\\right|_{\\theta=0}\\theta + \\frac{1}{2}\\left.\\frac{\\partial^2 E}{\\partial \\theta^2}\\right|_{\\theta=0}\\theta^2 + \\mathcal{O}(\\theta^3)$$\n由于 $\\theta=0$ 对应于易磁化轴，因此它是一个能量最低点。所以，能量对角度的一阶导数（其与扭矩成正比）在该点必须为零：\n$$\\tau(0) = -\\left.\\frac{\\partial E}{\\partial \\theta}\\right|_{\\theta=0} = 0$$\n此外，问题指出，对于单轴晶体，各向异性能在易磁化轴附近是 $\\theta$ 的偶函数。这种对称性意味着能量的泰勒级数展开中所有奇次幂项也必须为零。因此，展开式简化为：\n$$E(\\theta) = E(0) + \\frac{1}{2}\\left.\\frac{\\partial^2 E}{\\partial \\theta^2}\\right|_{\\theta=0}\\theta^2 + \\mathcal{O}(\\theta^4)$$\n对于小角度 $\\theta$，高阶项 $\\mathcal{O}(\\theta^4)$ 可以忽略不计。因此，将磁化强度旋转一个小角度 $\\theta$ 时的能量变化为：\n$$\\Delta E(\\theta) = E(\\theta) - E(0) \\approx \\frac{1}{2}\\left.\\frac{\\partial^2 E}{\\partial \\theta^2}\\right|_{\\theta=0}\\theta^2$$\n这个从第一性原理数据推导出的表达式，必须与单轴磁晶各向异性的唯象模型相一致。在该模型中，各向异性能量密度 $E_{aniso}$ 由下式给出：\n$$E_{aniso}(\\theta) = K \\sin^2\\theta$$\n其中 $K$ 是磁晶各向异性常数，单位为能量/单位体积（例如 J/m$^3$）。对于小角度 $\\theta$，我们可以使用近似 $\\sin\\theta \\approx \\theta$，得到：\n$$E_{aniso}(\\theta) \\approx K\\theta^2$$\nDFT计算提供了体积为 $V$ 的计算晶胞的总能量。为了将其与能量密度进行比较，我们将 $E_{aniso}(\\theta)$ 乘以晶胞体积 $V$，得到晶胞内的总各向异性能：\n$$\\Delta E_{cell}(\\theta) = V \\cdot E_{aniso}(\\theta) \\approx V K \\theta^2$$\n令两个能量变化表达式相等，我们便能找到由DFT计算的能量曲率与各向异性常数 $K$ 之间的关系：\n$$\\frac{1}{2}\\left.\\frac{\\partial^2 E}{\\partial \\theta^2}\\right|_{\\theta=0}\\theta^2 = V K \\theta^2$$\n对 $K$ 求解，我们得到算法的核心公式：\n$$K = \\frac{1}{2V} \\left.\\frac{\\partial^2 E}{\\partial \\theta^2}\\right|_{\\theta=0}$$\n剩下的任务是使用所提供的离散能量值 $E(0)$、$E(+\\delta)$ 和 $E(-\\delta)$ 来数值近似二阶导数（即曲率）$\\left.\\frac{\\partial^2 E}{\\partial \\theta^2}\\right|_{\\theta=0}$。\n\n对于同时有正向（$+\\delta$）和负向（$-\\delta$）旋转数据的情况，最准确的方法是二阶中心有限差分公式：\n$$\\left.\\frac{\\partial^2 E}{\\partial \\theta^2}\\right|_{\\theta=0} \\approx \\frac{E(+\\delta) - 2E(0) + E(-\\delta)}{\\delta^2}$$\n此公式将用于测试用例A、B和C。\n\n对于情况D，能量值 $E(-\\delta)$ 不可用。然而，基于 $E(\\theta)$ 是偶函数的物理前提，我们有恒等式 $E(+\\delta) = E(-\\delta)$。通过在中心差分公式中用 $E(+\\delta)$ 替换 $E(-\\delta)$，我们推导出一个适用于单边数据的近似公式：\n$$\\left.\\frac{\\partial^2 E}{\\partial \\theta^2}\\right|_{\\theta=0} \\approx \\frac{E(+\\delta) - 2E(0) + E(+\\delta)}{\\delta^2} = \\frac{2(E(+\\delta) - E(0))}{\\delta^2}$$\n这等价于对简化的泰勒展开式 $E(\\delta) - E(0) \\approx \\frac{1}{2} E''(0) \\delta^2$ 进行重新整理。此公式将用于测试用例D。\n\n完整的算法如下：\n1.  对于每个测试用例 $(E(0), E(+\\delta), E(-\\delta), \\delta, V)$，确定合适的有限差分格式。\n2.  如果提供了 $E(-\\delta)$，则计算能量曲率，单位为 eV/rad$^2$：\n    $$C_{eV} = \\frac{E(+\\delta) - 2E(0) + E(-\\delta)}{\\delta^2}$$\n3.  如果未提供 $E(-\\delta)$，则按如下方式计算曲率：\n    $$C_{eV} = \\frac{2(E(+\\delta) - E(0))}{\\delta^2}$$\n4.  使用给定的转换因子 $1\\, \\text{eV} = 1.602176634 \\times 10^{-19}\\, \\text{J}$，将曲率从电子伏特/弧度平方（eV/rad$^2$）转换为焦耳/弧度平方（J/rad$^2$）：\n    $$C_{SI} = C_{eV} \\times (1.602176634 \\times 10^{-19})$$\n5.  最后，使用推导出的关系计算各向异性常数 $K$，单位为焦耳/立方米（J/m$^3$）。由于弧度是无量纲单位，因此单位是一致的：\n    $$K = \\frac{C_{SI}}{2V}$$\n此过程提供了一种从微观DFT能量计算中提取宏观各向异性常数 $K$ 的稳健方法。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the magnetocrystalline anisotropy constant K from DFT total energies.\n    \"\"\"\n    \n    # Define the conversion factor from electronvolts to Joules.\n    EV_TO_JOULE = 1.602176634e-19\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (E(0), E(+delta), E(-delta), delta, V)\n    # E is in eV, delta is in radians, V is in m^3.\n    test_cases = [\n        # Case A\n        (-100.0, -99.999999, -99.999999, 0.1, 2.0e-29),\n        # Case B\n        (-50.123456, -50.123456, -50.123456, 0.05, 3.0e-29),\n        # Case C\n        (-200.0, -199.99999499, -199.99999501, 0.2, 1.8e-29),\n        # Case D\n        (-75.0, -74.999999, None, 0.15, 2.2e-29),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        e0, ep_delta, em_delta, delta, volume = case\n\n        # The magnetocrystalline anisotropy constant K is given by:\n        # K = (1 / 2V) * d^2E/d(theta)^2 | at theta=0\n        # where the second derivative is approximated by a finite difference.\n\n        # Calculate the second derivative (curvature) in eV/rad^2.\n        if em_delta is not None:\n            # Use the second-order central finite-difference formula when both\n            # E(+delta) and E(-delta) are available.\n            # E''(0) approx [E(delta) - 2E(0) + E(-delta)] / delta^2\n            curvature_ev_per_rad2 = (ep_delta - 2.0 * e0 + em_delta) / (delta**2)\n        else:\n            # When E(-delta) is not available, we use the property that the\n            # energy is an even function of theta, implying E'(0) = 0.\n            # The Taylor expansion E(delta) = E(0) + 0.5 * E''(0) * delta^2 gives:\n            # E''(0) approx 2 * [E(delta) - E(0)] / delta^2\n            curvature_ev_per_rad2 = 2.0 * (ep_delta - e0) / (delta**2)\n\n        # Convert curvature from eV/rad^2 to J/rad^2.\n        curvature_j_per_rad2 = curvature_ev_per_rad2 * EV_TO_JOULE\n\n        # Calculate K in J/m^3. Radian is dimensionless.\n        if volume == 0:\n            # Avoid division by zero, though not expected in valid problems.\n            k_anisotropy = 0.0\n        else:\n            k_anisotropy = curvature_j_per_rad2 / (2.0 * volume)\n\n        results.append(k_anisotropy)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在获得材料的宏观磁性参数后，我们可以利用微磁学模拟来研究复杂的磁织构。然而，一个核心的计算挑战是处理长程的退磁场 $\\mathbf{H}_d$。本练习将对比两种核心计算方法：用于孤立系统的直接求和法和用于周期性系统的高效快速傅里叶变换（FFT）法，以此揭示不同边界条件在模拟中的实际影响与权衡。",
            "id": "3822494",
            "problem": "你必须编写一个完整且可运行的程序。该程序针对一个有限、离散化的铁磁样品，在两种边界假设下计算其静磁退磁场，并量化当周期性边界核用于有限样品时所产生的误差。这两种边界假设是：(i) 自由空间中的开放边界；(ii) 所有方向上的周期性边界。该程序必须将磁化强度建模为在规则笛卡尔单元网格上的分段常数，并使用物理上一致的单位。最终输出必须为单行，包含一个十进制数列表，每个测试用例对应一个数字，每个数字均为无量纲相对均方根误差。\n\n推导和实现必须从静磁 Maxwell 方程和核心定义出发。在没有自由电流的静磁学中，总磁感应强度满足 $\\nabla \\cdot \\mathbf{B} = 0$，磁场强度满足 $\\nabla \\times \\mathbf{H} = \\mathbf{0}$，其本构关系为 $\\mathbf{B} = \\mu_0 (\\mathbf{H} + \\mathbf{M})$，其中 $\\mu_0$ 是真空磁导率，$\\mathbf{M}$ 是磁化场。由此可得，静磁标势 $\\phi$ 满足 $\\mathbf{H} = -\\nabla \\phi$ 以及在自由空间中的方程 $\\nabla^2 \\phi = \\nabla \\cdot \\mathbf{M}$。对于开放边界，解可以表示为与自由空间 Green 函数的卷积；对于周期性边界，解可以在傅里叶空间中通过周期性单元的离散波矢来表示。你的程序必须以科学上合理且自洽的方式实现这两种情况，并遵循 $\\mathbf{M}$ 和 $\\mathbf{H}$ 的单位。\n\n实现要求：\n- 将一个 $N_x \\times N_y \\times N_z$ 个单元的矩形区域离散化，物理单元尺寸为 $d_x$、$d_y$、$d_z$（米）。将一个尺寸为 $S_x \\times S_y \\times S_z$ 个单元的矩形磁化子域（样品）放置在区域的几何中心。磁化强度 $\\mathbf{M}$ 在样品内部是均匀的，在外部为零。其大小 $M_s$ 必须以安培/米为单位指定。磁化方向必须是 $\\mathbb{R}^3$ 中的单位向量。\n- 开放边界场：将每个磁化单元建模为磁矩为 $\\mathbf{m} = \\mathbf{M} V_{\\text{cell}}$ 的点偶极子，其中 $V_{\\text{cell}} = d_x d_y d_z$。对于样品内部的每个目标单元中心，将总磁场 $\\mathbf{H}_{\\text{open}}$ 计算为样品内所有源单元偶极子场的叠加，并排除自相互作用。确保偶极子场是根据自由空间中由 $\\mathbf{M}$ 的散度引起的标势的梯度从第一性原理计算得出。所有位置必须以米计算，返回的场以安培/米为单位。\n- 周期性边界场：使用周期性边界条件所隐含的傅里叶空间表示法，计算整个区域上的场 $\\mathbf{H}_{\\text{per}}$。使用与快速傅里叶变换 (FFT; Fast Fourier Transform) 网格对应的离散波矢，角波数 $k_x$、$k_y$、$k_z$ 由区域长度 $L_x = N_x d_x$、$L_y = N_y d_y$、$L_z = N_z d_z$ 构建。适当处理零波矢分量，以确保得到物理上有意义的周期解。对结果进行逆变换，以获得以安培/米为单位的实空间场。\n- 误差度量：在样品内部的单元集合上，计算无量纲相对均方根误差\n$$\ne_{\\text{rel}} = \\frac{\\left(\\sum_{p \\in \\mathcal{S}} \\lVert \\mathbf{H}_{\\text{per}}(\\mathbf{r}_p) - \\mathbf{H}_{\\text{open}}(\\mathbf{r}_p) \\rVert^2\\right)^{1/2}}{\\left(\\sum_{p \\in \\mathcal{S}} \\lVert \\mathbf{H}_{\\text{open}}(\\mathbf{r}_p) \\rVert^2\\right)^{1/2}},\n$$\n其中 $\\mathcal{S}$ 是样品单元中心的集合。如果分母在数值上为零，用一个小的正常数对其进行正则化，以避免除以零。\n\n角度单位：由矢量方向所隐含的所有角度均以弧度为单位。物理单位：$d_x$、$d_y$、$d_z$ 必须以米为单位，$M_s$ 必须以安培/米为单位，计算出的场 $\\mathbf{H}$ 以安培/米为单位。最终误差是无量纲十进制数。\n\n测试套件：\n提供四个具有不同几何形状和磁化强度的测试用例来检验实现：\n- 用例 1：$N_x = 6$, $N_y = 6$, $N_z = 6$；$S_x = 4$, $S_y = 4$, $S_z = 4$；$d_x = 5\\times 10^{-9}\\,\\text{m}$, $d_y = 5\\times 10^{-9}\\,\\text{m}$, $d_z = 5\\times 10^{-9}\\,\\text{m}$；$M_s = 8.0\\times 10^{5}\\,\\text{A/m}$；磁化方向 $\\hat{\\mathbf{u}} = (0,0,1)$。\n- 用例 2：$N_x = 6$, $N_y = 6$, $N_z = 6$；$S_x = 6$, $S_y = 6$, $S_z = 6$（样品填满整个区域）；$d_x = 5\\times 10^{-9}\\,\\text{m}$, $d_y = 5\\times 10^{-9}\\,\\text{m}$, $d_z = 5\\times 10^{-9}\\,\\text{m}$；$M_s = 8.0\\times 10^{5}\\,\\text{A/m}$；磁化方向 $\\hat{\\mathbf{u}} = (0,0,1)$。\n- 用例 3：$N_x = 8$, $N_y = 4$, $N_z = 2$；$S_x = 8$, $S_y = 4$, $S_z = 1$（一个单元厚度的薄膜）；$d_x = 5\\times 10^{-9}\\,\\text{m}$, $d_y = 5\\times 10^{-9}\\,\\text{m}$, $d_z = 5\\times 10^{-9}\\,\\text{m}$；$M_s = 8.0\\times 10^{5}\\,\\text{A/m}$；磁化方向 $\\hat{\\mathbf{u}} = (1,0,0)$。\n- 用例 4：$N_x = 3$, $N_y = 3$, $N_z = 3$；$S_x = 1$, $S_y = 1$, $S_z = 2$；$d_x = 5\\times 10^{-9}\\,\\text{m}$, $d_y = 5\\times 10^{-9}\\,\\text{m}$, $d_z = 5\\times 10^{-9}\\,\\text{m}$；$M_s = 5.0\\times 10^{5}\\,\\text{A/m}$；磁化方向 $\\hat{\\mathbf{u}} = (0,1,0)$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含四个测试用例的相对误差，形式为方括号括起来的逗号分隔列表（例如，$\\left[ e_1, e_2, e_3, e_4 \\right]$）。列表元素必须是十进制数（浮点数）。不得打印任何其他文本。",
            "solution": "用户提供的问题是有效的，因为它在科学上基于静磁学，数学上是适定的，并且所有提供的数据和约束都是自洽和一致的。任务是使用两种不同的边界条件假设——开放边界和周期性边界——来计算离散化铁磁样品中的静磁退磁场，并量化它们之间的差异。\n\n理论基础在于无自由电流区域的静磁 Maxwell 方程 $\\nabla \\times \\mathbf{H} = \\mathbf{0}$，以及磁感应强度的散度条件 $\\nabla \\cdot \\mathbf{B} = 0$。本构关系为 $\\mathbf{B} = \\mu_0 (\\mathbf{H} + \\mathbf{M})$，其中 $\\mathbf{H}$ 是磁场强度，$\\mathbf{M}$ 是磁化强度，$\\mu_0$ 是真空磁导率。从 $\\nabla \\times \\mathbf{H} = \\mathbf{0}$，我们可以引入一个磁标势 $\\phi$ 使得 $\\mathbf{H} = -\\nabla \\phi$。代入这些关系得到 $\\nabla \\cdot (\\mathbf{H} + \\mathbf{M}) = 0$，这导致 $\\nabla \\cdot (-\\nabla \\phi) = -\\nabla \\cdot \\mathbf{M}$，从而得出磁标势的 Poisson 方程：\n$$ \\nabla^2 \\phi = \\nabla \\cdot \\mathbf{M} $$\n势的源是“磁荷密度” $\\rho_m = -\\nabla \\cdot \\mathbf{M}$。退磁场 $\\mathbf{H}_d$ 是由磁化分布本身产生的场，即在没有任何外部源的情况下的场 $\\mathbf{H}$。我们现在将概述两种指定的数值方法，以在规则笛卡尔网格上求解该场。\n\n问题域是一个被离散化为 $N_x \\times N_y \\times N_z$ 个物理尺寸为 $d_x \\times d_y \\times d_z$ 的单元的矩形棱柱。一个尺寸为 $S_x \\times S_y \\times S_z$ 个单元的较小矩形棱柱（即样品）位于该区域的中心。磁化强度 $\\mathbf{M}$ 在样品内部是一个常数矢量 $M_s \\hat{\\mathbf{u}}$，在外部为零。\n\n### 开放边界场计算 ($\\mathbf{H}_{\\text{open}}$)\n\n对于开放（自由空间）边界条件，场是通过将每个磁化单元视为点磁偶极子并对其贡献求和来计算的。这是对连续体场的近似，当观察点远离源单元时有效。问题指定了这种点偶极子近似。具有体积 $V_{\\text{cell}} = d_x d_y d_z$ 和均匀磁化强度 $\\mathbf{M}$ 的单元 $j$ 的磁偶极矩 $\\mathbf{m}_j$ 是 $\\mathbf{m}_j = \\mathbf{M} V_{\\text{cell}}$。\n\n位于目标单元 $i$ 中心（位置 $\\mathbf{r}_i$）处，由位于单元 $j$ 中心（位置 $\\mathbf{r}_j$）的源偶极子产生的磁场 $\\mathbf{H}_{ij}(\\mathbf{r}_i)$ 由标准的偶极子场公式给出：\n$$ \\mathbf{H}_{ij}(\\mathbf{r}_i) = \\frac{1}{4\\pi} \\left( \\frac{3\\mathbf{r}(\\mathbf{m}_j \\cdot \\mathbf{r})}{r^5} - \\frac{\\mathbf{m}_j}{r^3} \\right) $$\n其中 $\\mathbf{r} = \\mathbf{r}_i - \\mathbf{r}_j$ 且 $r = \\lVert \\mathbf{r} \\rVert$。样品内任何目标单元 $i$ 的总场是样品中所有源单元 $j$ 的场叠加的结果，不包括 $i=j$ 时的自相互作用项（因为偶极子场在 $r=0$ 处是奇异的）。\n$$ \\mathbf{H}_{\\text{open}}(\\mathbf{r}_i) = \\sum_{j \\in \\mathcal{S}, j \\neq i} \\mathbf{H}_{ij}(\\mathbf{r}_i) $$\n其中 $\\mathcal{S}$ 表示样品内所有单元的集合。该算法涉及对样品中所有单元对进行双重循环来执行此求和。\n\n### 周期性边界场计算 ($\\mathbf{H}_{\\text{per}}$)\n\n对于周期性边界条件，问题在傅里叶空间中解决最为高效。对应于 Poisson 方程解的实空间卷积在傅里叶空间中变为简单的乘法。令 $\\tilde{f}(\\mathbf{k}) = \\mathcal{F}\\{f(\\mathbf{r})\\}$ 表示函数 $f(\\mathbf{r})$ 的傅里叶变换。将傅里叶变换应用于方程 $\\mathbf{H} = -\\nabla \\phi$ 得到 $\\tilde{\\mathbf{H}}(\\mathbf{k}) = -i\\mathbf{k}\\tilde{\\phi}(\\mathbf{k})$。将其应用于 Poisson 方程 $\\nabla^2 \\phi = \\nabla \\cdot \\mathbf{M}$ 得到 $-k^2 \\tilde{\\phi}(\\mathbf{k}) = i\\mathbf{k} \\cdot \\tilde{\\mathbf{M}}(\\mathbf{k})$，其中 $k^2 = \\mathbf{k} \\cdot \\mathbf{k} = k_x^2 + k_y^2 + k_z^2$。\n\n对于 $\\mathbf{k} \\neq \\mathbf{0}$，我们可以在傅里叶空间中求解势：\n$$ \\tilde{\\phi}(\\mathbf{k}) = -i \\frac{\\mathbf{k} \\cdot \\tilde{\\mathbf{M}}(\\mathbf{k})}{k^2} $$\n将此代入 $\\tilde{\\mathbf{H}}(\\mathbf{k})$ 的表达式中得到：\n$$ \\tilde{\\mathbf{H}}(\\mathbf{k}) = (-i\\mathbf{k}) \\left( -i \\frac{\\mathbf{k} \\cdot \\tilde{\\mathbf{M}}(\\mathbf{k})}{k^2} \\right) = - \\frac{\\mathbf{k}(\\mathbf{k} \\cdot \\tilde{\\mathbf{M}}(\\mathbf{k}))}{k^2} $$\n此表达式可以写成矩阵-向量乘积，$\\tilde{\\mathbf{H}}(\\mathbf{k}) = -\\mathbf{N}(\\mathbf{k})\\tilde{\\mathbf{M}}(\\mathbf{k})$，其中 $\\mathbf{N}_{ab}(\\mathbf{k}) = k_a k_b / k^2$ 是傅里叶空间中的退磁张量。\n\n对于特殊情况 $\\mathbf{k}=\\mathbf{0}$，它对应于场的空间平均值，分母 $k^2$ 为零。对于周期性系统，退磁场的空间平均值必须为零。这是因为 $\\mathbf{H}$ 是一个势 $\\phi$ 的梯度，而周期函数在其定义域上的梯度积分是零。因此，我们必须设置 $\\tilde{\\mathbf{H}}(\\mathbf{k}=\\mathbf{0}) = \\mathbf{0}$。\n\n该算法流程如下：\n1.  在完整的 $N_x \\times N_y \\times N_z$ 网格上构建磁化场 $\\mathbf{M}(\\mathbf{r})$。\n2.  计算 $\\mathbf{M}(\\mathbf{r})$ 每个分量的离散傅里叶变换（使用 FFT）以获得 $\\tilde{\\mathbf{M}}(\\mathbf{k})$。\n3.  构建离散波矢 $\\mathbf{k}$ 的网格，其中 $k_\\alpha = 2\\pi f_\\alpha$，$f_\\alpha$ 是由 `numpy.fft.fftfreq(N_\\alpha, d_\\alpha)` 给出的频率。\n4.  对于傅里叶网格上的每个 $\\mathbf{k}$，使用上述公式计算 $\\tilde{\\mathbf{H}}(\\mathbf{k})$ 的分量，并将 $\\mathbf{k}=\\mathbf{0}$ 分量设为零。\n5.  计算 $\\tilde{\\mathbf{H}}(\\mathbf{k})$ 每个分量的傅里叶逆变换（使用 IFFT）以获得实空间场 $\\mathbf{H}_{\\text{per}}(\\mathbf{r})$。\n\n### 误差度量\n\n两种模型之间的差异通过相对均方根误差来量化，该误差在样品 $\\mathcal{S}$ 内的单元上计算：\n$$ e_{\\text{rel}} = \\frac{\\left(\\sum_{p \\in \\mathcal{S}} \\lVert \\mathbf{H}_{\\text{per}}(\\mathbf{r}_p) - \\mathbf{H}_{\\text{open}}(\\mathbf{r}_p) \\rVert^2\\right)^{1/2}}{\\left(\\sum_{p \\in \\mathcal{S}} \\lVert \\mathbf{H}_{\\text{open}}(\\mathbf{r}_p) \\rVert^2\\right)^{1/2}} $$\n分母在开平方根之前通过加上一个小的正常数 $\\epsilon$（例如，$10^{-30}$）进行正则化，以防止除以零，这种情况可能在 $\\mathbf{H}_{\\text{open}}$ 在样品中处处为零时发生。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_H_open(N, S, d, M_vec):\n    \"\"\"\n    Computes the demagnetizing field using open boundaries (direct dipole summation).\n    \n    Args:\n        N (tuple): Domain cell counts (Nx, Ny, Nz).\n        S (tuple): Sample cell counts (Sx, Sy, Sz).\n        d (tuple): Cell dimensions (dx, dy, dz) in meters.\n        M_vec (np.ndarray): Magnetization vector (Mx, My, Mz) in A/m.\n        \n    Returns:\n        np.ndarray: The H field array of shape (Nx, Ny, Nz, 3) in A/m.\n    \"\"\"\n    Nx, Ny, Nz = N\n    Sx, Sy, Sz = S\n    dx, dy, dz = d\n\n    H_open = np.zeros((Nx, Ny, Nz, 3), dtype=np.float64)\n    V_cell = dx * dy * dz\n    m_dipole = M_vec * V_cell\n\n    # Define sample region\n    start_S = np.array([(N[i] - S[i]) // 2 for i in range(3)])\n    end_S = start_S + S\n\n    sample_indices = []\n    sample_coords = []\n    \n    # Create lists of sample indices and physical coordinates\n    for iz in range(start_S[2], end_S[2]):\n        for iy in range(start_S[1], end_S[1]):\n            for ix in range(start_S[0], end_S[0]):\n                sample_indices.append((ix, iy, iz))\n                sample_coords.append([ix*dx, iy*dy, iz*dz])\n\n    sample_coords = np.array(sample_coords)\n    num_sample_cells = len(sample_indices)\n\n    for i in range(num_sample_cells):\n        target_idx = sample_indices[i]\n        target_coord = sample_coords[i]\n        \n        # Vectorized calculation for a single target cell\n        r_vecs = target_coord - sample_coords\n        r_norms = np.linalg.norm(r_vecs, axis=1)\n\n        # Exclude self-interaction\n        valid_indices = r_norms > 1e-15 # Avoid division by zero\n        r_vecs = r_vecs[valid_indices]\n        r_norms = r_norms[valid_indices]\n        \n        r_norms_3 = r_norms**3\n        r_norms_5 = r_norms**5\n        \n        m_dot_r = np.dot(r_vecs, m_dipole)\n        \n        term1 = 3 * r_vecs * (m_dot_r[:, np.newaxis] / r_norms_5[:, np.newaxis])\n        term2 = m_dipole / r_norms_3[:, np.newaxis]\n        \n        H_ij_sum = np.sum(term1 - term2, axis=0) / (4 * np.pi)\n        \n        H_open[target_idx[0], target_idx[1], target_idx[2]] = H_ij_sum\n        \n    return H_open\n\ndef calculate_H_per(N, S, d, M_vec):\n    \"\"\"\n    Computes the demagnetizing field using periodic boundaries (FFT method).\n\n    Args:\n        N (tuple): Domain cell counts (Nx, Ny, Nz).\n        S (tuple): Sample cell counts (Sx, Sy, Sz).\n        d (tuple): Cell dimensions (dx, dy, dz) in meters.\n        M_vec (np.ndarray): Magnetization vector (Mx, My, Mz) in A/m.\n        \n    Returns:\n        np.ndarray: The H field array of shape (Nx, Ny, Nz, 3) in A/m.\n    \"\"\"\n    Nx, Ny, Nz = N\n    Sx, Sy, Sz = S\n    dx, dy, dz = d\n\n    # Create magnetization grid\n    M_grid = np.zeros((Nx, Ny, Nz, 3), dtype=np.float64)\n    start_S = np.array([(N[i] - S[i]) // 2 for i in range(3)])\n    end_S = start_S + S\n    M_grid[start_S[0]:end_S[0], start_S[1]:end_S[1], start_S[2]:end_S[2], :] = M_vec\n    \n    # FFT of magnetization components\n    M_tilde_x = np.fft.fftn(M_grid[:, :, :, 0])\n    M_tilde_y = np.fft.fftn(M_grid[:, :, :, 1])\n    M_tilde_z = np.fft.fftn(M_grid[:, :, :, 2])\n\n    # Create k-space grid\n    kx = 2 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    ky = 2 * np.pi * np.fft.fftfreq(Ny, d=dy)\n    kz = 2 * np.pi * np.fft.fftfreq(Nz, d=dz)\n    Kx, Ky, Kz = np.meshgrid(kx, ky, kz, indexing='ij')\n\n    K_sq = Kx**2 + Ky**2 + Kz**2\n    \n    # k=0 handling\n    K_sq[0, 0, 0] = 1.0 # Avoid division by zero, result will be set to 0 anyway\n\n    k_dot_M_tilde = Kx * M_tilde_x + Ky * M_tilde_y + Kz * M_tilde_z\n\n    # Demagnetization tensor action in Fourier space\n    H_tilde_x = - (Kx * k_dot_M_tilde) / K_sq\n    H_tilde_y = - (Ky * k_dot_M_tilde) / K_sq\n    H_tilde_z = - (Kz * k_dot_M_tilde) / K_sq\n    \n    # Set k=0 component to zero\n    H_tilde_x[0, 0, 0] = 0.0\n    H_tilde_y[0, 0, 0] = 0.0\n    H_tilde_z[0, 0, 0] = 0.0\n    \n    # Inverse FFT to get real-space field\n    H_per = np.zeros((Nx, Ny, Nz, 3), dtype=np.float64)\n    H_per[:, :, :, 0] = np.real(np.fft.ifftn(H_tilde_x))\n    H_per[:, :, :, 1] = np.real(np.fft.ifftn(H_tilde_y))\n    H_per[:, :, :, 2] = np.real(np.fft.ifftn(H_tilde_z))\n    \n    return H_per\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and compute relative errors.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {'N':(6, 6, 6), 'S':(4, 4, 4), 'd':(5e-9, 5e-9, 5e-9), \n         'Ms':8.0e5, 'u':(0, 0, 1)},\n        # Case 2\n        {'N':(6, 6, 6), 'S':(6, 6, 6), 'd':(5e-9, 5e-9, 5e-9), \n         'Ms':8.0e5, 'u':(0, 0, 1)},\n        # Case 3\n        {'N':(8, 4, 2), 'S':(8, 4, 1), 'd':(5e-9, 5e-9, 5e-9), \n         'Ms':8.0e5, 'u':(1, 0, 0)},\n        # Case 4\n        {'N':(3, 3, 3), 'S':(1, 1, 2), 'd':(5e-9, 5e-9, 5e-9), \n         'Ms':5.0e5, 'u':(0, 1, 0)},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N, S, d = case['N'], case['S'], case['d']\n        Ms, u = case['Ms'], np.array(case['u'], dtype=np.float64)\n        M_vec = Ms * u\n        \n        # Calculate fields\n        H_open = calculate_H_open(N, S, d, M_vec)\n        H_per = calculate_H_per(N, S, d, M_vec)\n        \n        # Create sample mask\n        sample_mask = np.zeros(N, dtype=bool)\n        start_S = np.array([(N[i] - S[i]) // 2 for i in range(3)])\n        end_S = start_S + S\n        sample_mask[start_S[0]:end_S[0], start_S[1]:end_S[1], start_S[2]:end_S[2]] = True\n\n        # Extract fields within the sample\n        H_open_sample = H_open[sample_mask]\n        H_per_sample = H_per[sample_mask]\n\n        # Calculate error metric\n        diff_H = H_per_sample - H_open_sample\n        \n        # Use np.linalg.norm on the last axis (vector components)\n        numerator_sq = np.sum(np.linalg.norm(diff_H, axis=-1)**2)\n        denominator_sq = np.sum(np.linalg.norm(H_open_sample, axis=-1)**2)\n\n        # Regularize to prevent division by zero\n        if denominator_sq  1e-30:\n             # If denominator is zero, error is 0 if numerator is also 0, otherwise it's undefined/inf.\n             # In our case, if H_open is 0, then H_per should also be 0 for this case, so error is 0.\n             error = 0.0 if numerator_sq  1e-30 else np.inf\n        else:\n            error = np.sqrt(numerator_sq / denominator_sq)\n            \n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实材料的特性往往体现出多尺度的本质，即原子尺度的缺陷能够决定宏观的磁行为。本练习提供了一个“向上取整”（upscaling）的具体范例，展示如何将局域原子缺陷（具有变化的交换作用$J$和各向异性$K$）的特性转化为一个有效的微磁学模型。通过计算畴壁的解钉扎场，我们能够将微观缺陷参数与可观测的宏观磁现象直接关联起来。",
            "id": "3822519",
            "problem": "考虑一根易磁化轴沿 $x$ 方向的一维铁磁纳米线，其原子尺度模型为一个晶格常数为 $a$ 的简单立方晶格，且由一个横截面积为 $S = a^2$ 的单自旋列构成。设每个晶格位置都带有一个大小为 $\\mu$ 的经典磁矩。背景（无缺陷）材料由最近邻 Heisenberg 交换作用和单离子单轴各向异性描述，其原子尺度交换参数为 $J_0$，原子尺度各向异性参数为 $K_0$，且各向异性方向与 $\\hat{x}$ 一致。在一个以位置 $x_d$ 为中心、长度为 $L_d$ 的局域缺陷区段内，原子尺度交换作用和各向异性的参数值分别为 $J_d$ 和 $K_d$。目标是将这些原子尺度参数升尺度为微磁学量，构建横向磁畴壁所受的有效钉扎势，并计算去钉扎场。\n\n您必须从以下基础出发：\n- 由单位矢量场 $\\mathbf{m}_i$ 表示的自旋的离散 Heisenberg 交换作用和单离子各向异性能：\n$$ E_{\\text{atom}} = -\\sum_{\\langle i,j \\rangle} J_{ij} \\, \\mathbf{m}_i \\cdot \\mathbf{m}_j \\;-\\; \\sum_i K_i \\, (\\mathbf{m}_i \\cdot \\hat{x})^2 \\;-\\; \\mu_0 \\mu \\sum_i H \\, (\\mathbf{m}_i \\cdot \\hat{x}), $$\n其中 $\\mu_0$ 是真空磁导率， $H$ 是沿 $\\hat{x}$ 方向施加的外部磁场，$\\langle i,j \\rangle$ 表示最近邻。\n- 对于单位模长的磁化场 $\\mathbf{m}(x)$，其一维 ($x$) 连续介质微磁学能量密度（单位体积）：\n$$ e(x) = A(x) \\left|\\frac{\\partial \\mathbf{m}}{\\partial x}\\right|^2 \\;+\\; K_u(x) \\big(1 - m_x(x)^2\\big) \\;-\\; \\mu_0 M_s H \\, m_x(x), $$\n其中 $A(x)$ 是交换刚度，$K_u(x)$ 是单轴各向异性常数，$M_s$ 是饱和磁化强度，$m_x(x)$ 是 $\\mathbf{m}(x)$ 的 $x$ 分量。\n- 通过泛函导数计算的有效场：\n$$ \\mathbf{H}_{\\mathrm{eff}}(x) = - \\frac{1}{\\mu_0 M_s} \\frac{\\delta E}{\\delta \\mathbf{m}(x)}, \\quad \\text{其中} \\quad E = \\int e(x) \\, dV. $$\n\n假设采用如下粗粒化方案，将一维纳米线中的原子尺度参数映射到微磁学参数：\n- 通过原子尺度交换作用 $J(x)$ 得到交换刚度 $A(x)$：\n$$ A(x) = \\frac{J(x)}{a}. $$\n- 通过原子尺度单离子各向异性 $K(x)$ 得到单轴各向异性 $K_u(x)$：\n$$ K_u(x) = \\frac{K(x)}{a^3}. $$\n- 通过原子尺度磁矩 $\\mu$ 得到饱和磁化强度：\n$$ M_s = \\frac{\\mu}{a^3}. $$\n\n考虑一个分隔 $m_x = +1$ 和 $m_x = -1$ 磁畴的单横向磁畴壁。在背景材料中，特征畴壁宽度参数 $\\Delta_0$ 是通过在没有缺陷和外场的情况下最小化交换-各向异性能来确定的，得到\n$$ \\Delta_0 = \\sqrt{\\frac{A_0}{K_{u0}}}, \\quad \\text{其中} \\quad A_0 = \\frac{J_0}{a}, \\quad K_{u0} = \\frac{K_0}{a^3}. $$\n\n将磁畴壁视为一个具有中心坐标 $q$ 和背景宽度 $\\Delta_0$ 的刚性轮廓。在此集体坐标近似下，对由局域缺陷区引起的钉扎能进行建模，然后确定最小场强 $H_{\\mathrm{dep}}$，使得塞曼项产生的驱动力能够克服钉扎产生的最大恢复力。由沿 $\\hat{x}$ 方向的外场 $H$ 产生的作用在磁畴壁上的驱动力等于塞曼能对 $q$ 的导数，并且必须反映当磁畴壁前进 $dq$ 时其两侧磁畴的能量差。\n\n您的任务是：\n1. 基于第一性原理和上述基础，推导出去钉扎场 $H_{\\mathrm{dep}}$ 的闭合形式表达式，该表达式应以 $J_0$、 $K_0$、 $J_d$、 $K_d$、 $a$、 $\\mu$ 和 $L_d$ 表示。\n2. 在一个程序中实现该表达式，并遵循下面描述的最终输出格式。\n3. 使用以下参数值测试套件。所有物理量都必须使用国际单位制 (SI)：\n   - 所有测试用例共用的材料参数：\n     - $a = 2.5\\times 10^{-10}$ 米，\n     - $\\mu = 1.8548\\times 10^{-23}$ 安培米平方，\n     - $J_0 = 1.5\\times 10^{-21}$ 焦耳，\n     - $K_0 = 2.0\\times 10^{-24}$ 焦耳，\n     - $\\mu_0 = 4\\pi\\times 10^{-7}$ 牛顿每平方安培。\n   - 五个缺陷案例，每个由 $(J_d, K_d, \\lambda)$ 指定，其中 $L_d = \\lambda \\, \\Delta_0$：\n     1. $(J_d = 1.2\\times 10^{-21}\\ \\text{J},\\; K_d = 3.0\\times 10^{-24}\\ \\text{J},\\; \\lambda = 1.0)$，\n     2. $(J_d = 1.2\\times 10^{-21}\\ \\text{J},\\; K_d = 3.0\\times 10^{-24}\\ \\text{J},\\; \\lambda = 0.0)$，\n     3. $(J_d = 1.8\\times 10^{-21}\\ \\text{J},\\; K_d = 0.5\\times 10^{-24}\\ \\text{J},\\; \\lambda = 5.0)$，\n     4. $(J_d = 2.5\\times 10^{-21}\\ \\text{J},\\; K_d = 2.0\\times 10^{-24}\\ \\text{J},\\; \\lambda = 0.5)$，\n     5. $(J_d = 1.5\\times 10^{-21}\\ \\text{J},\\; K_d = 3.6\\times 10^{-24}\\ \\text{J},\\; \\lambda = 0.2)$。\n4. 对每个测试用例，计算去钉扎场 $H_{\\mathrm{dep}}$，并以安培每米 (A/m) 为单位，将其表示为浮点数。\n5. 最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，并按照上述测试用例的顺序排列（例如 $[h_1,h_2,h_3,h_4,h_5]$）。\n\n请通过清晰地陈述您的假设、保持推导与微磁学连续介质近似一致，并定义所有使用的量来确保科学真实性。角度（如有）必须以弧度为单位。百分比（如有）必须表示为小数或分数。程序无需外部输入，必须能按原样运行，并仅以指定格式打印最终结果行。",
            "solution": "用户提供的问题已被验证，并被确定为磁学和多尺度材料模拟领域中一个良定的、科学上合理的问题。任务是推导并实现一个公式，用于计算具有局域缺陷的一维铁磁纳米线中的磁畴壁去钉扎场。\n\n### 去钉扎场的推导\n\n**1. 系统与能量泛函**\n\n系统是一根易磁化轴沿 $\\hat{x}$ 方向的一维铁磁线。系统的能量由微磁学连续介质模型描述。暂时不考虑外场项，总能量由能量密度 $e(x)$ 在纳米线体积上的积分给出：\n$$ E = \\int e(x) dV = S \\int_{-\\infty}^{\\infty} \\left( A(x) \\left|\\frac{d\\mathbf{m}}{dx}\\right|^2 + K_u(x) \\left(1 - m_x(x)^2\\right) \\right) dx $$\n其中 $S=a^2$ 是横截面积，$\\mathbf{m}(x)$ 是归一化磁化矢量，$A(x)$ 是交换刚度，$K_u(x)$ 是单轴各向异性常数。材料参数是分段常数，在背景区域取值为 $(A_0, K_{u0})$，在以 $x=0$ 为中心、长度为 $L_d$ 的缺陷区域内取值为 $(A_d, K_{ud})$。\n\n**2. 刚性磁畴壁拟设与钉扎势**\n\n我们采用刚性磁畴壁（或集体坐标）近似。磁畴壁的磁化轮廓被假定为固定的，对应于均匀背景材料中的轮廓，并且只允许平移。对于一个中心位于位置 $q$ 的横向磁畴壁，其标准轮廓为：\n$$ m_x(x,q) = \\tanh\\left(\\frac{x-q}{\\Delta_0}\\right); \\quad \\left|\\frac{d\\mathbf{m}}{dx}\\right|^2 = \\frac{1}{\\Delta_0^2}\\text{sech}^2\\left(\\frac{x-q}{\\Delta_0}\\right); \\quad 1-m_x^2 = \\text{sech}^2\\left(\\frac{x-q}{\\Delta_0}\\right) $$\n其中 $\\Delta_0 = \\sqrt{A_0/K_{u0}}$ 是背景材料中的磁畴壁宽度参数。\n\n磁畴壁的总能量作为其位置 $q$ 的函数为：\n$$ E(q) = S \\int_{-\\infty}^{\\infty} \\left[ \\frac{A(x)}{\\Delta_0^2} + K_u(x) \\right] \\text{sech}^2\\left(\\frac{x-q}{\\Delta_0}\\right) dx $$\n钉扎势 $U_p(q)$ 是由缺陷引起的磁畴壁能量的变化。它是缺陷材料中磁畴壁的能量 $E(q)$ 与均匀背景材料中能量 $E_0 = 4S\\sqrt{A_0 K_{u0}}$ 之间的差值。这个差值完全来自于缺陷区域上的积分：\n$$ U_p(q) = E(q) - E_0 = S \\int_{-L_d/2}^{L_d/2} \\left[ \\left(\\frac{A_d}{\\Delta_0^2} + K_{ud}\\right) - \\left(\\frac{A_0}{\\Delta_0^2} + K_{u0}\\right) \\right] \\text{sech}^2\\left(\\frac{x-q}{\\Delta_0}\\right) dx $$\n$$ U_p(q) = S \\left( \\frac{A_d - A_0}{\\Delta_0^2} + K_{ud} - K_{u0} \\right) \\int_{-L_d/2}^{L_d/2} \\text{sech}^2\\left(\\frac{x-q}{\\Delta_0}\\right) dx $$\n\n**3. 钉扎力**\n\n钉扎力是缺陷施加在磁畴壁上的恢复力，由 $F_{\\text{pin}}(q) = -dU_p(q)/dq$ 给出。使用莱布尼茨积分法则 $\\frac{d}{dq}\\int_a^b f(x-q)dx = f(a-q) - f(b-q)$：\n$$ F_{\\text{pin}}(q) = -S \\left( \\frac{A_d - A_0}{\\Delta_0^2} + K_{ud} - K_{u0} \\right) \\left[ \\text{sech}^2\\left(\\frac{-L_d/2-q}{\\Delta_0}\\right) - \\text{sech}^2\\left(\\frac{L_d/2-q}{\\Delta_0}\\right) \\right] $$\n利用 $\\text{sech}^2(z)$ 的偶函数性质，上式可简化为：\n$$ F_{\\text{pin}}(q) = S \\left( \\frac{A_d - A_0}{\\Delta_0^2} + K_{ud} - K_{u0} \\right) \\left[ \\text{sech}^2\\left(\\frac{L_d/2 - q}{\\Delta_0}\\right) - \\text{sech}^2\\left(\\frac{L_d/2 + q}{\\Delta_0}\\right) \\right] $$\n为了获得闭合形式解，我们做一个常见且物理上合理的近似：最大钉扎力出现在磁畴壁中心位于缺陷区域边缘之一时，即 $q = \\pm L_d/2$。在 $q = L_d/2$ 处计算力的大小：\n$$ F_{\\text{pin}}(L_d/2) = S \\left( \\frac{A_d - A_0}{\\Delta_0^2} + K_{ud} - K_{u0} \\right) \\left[ \\text{sech}^2(0) - \\text{sech}^2\\left(\\frac{L_d}{\\Delta_0}\\right) \\right] $$\n因此，钉扎力的最大值为：\n$$ F_{\\text{pin,max}} = \\left| S \\left( \\frac{A_d - A_0}{\\Delta_0^2} + K_{ud} - K_{u0} \\right) \\right| \\left(1 - \\text{sech}^2\\left(\\frac{L_d}{\\Delta_0}\\right)\\right) = \\left| S \\cdot P \\right| \\tanh^2\\left(\\frac{L_d}{\\Delta_0}\\right) $$\n其中 $P = \\frac{A_d - A_0}{\\Delta_0^2} + K_{ud} - K_{u0}$ 是钉扎参数。\n\n**4. 驱动力与去钉扎场**\n\n沿 $\\hat{x}$ 轴的外部磁场 $H$ 对磁畴壁施加一个压力。当磁畴壁移动一个无穷小距离 $dq$ 时，塞曼能量的变化为 $\\delta E_Z = - (2\\mu_0 M_s H) S dq$。由此产生的驱动力为 $F_Z = -\\delta E_Z / dq = 2\\mu_0 M_s H S$。\n当来自场 $H_{\\text{dep}}$ 的驱动力等于最大钉扎力时，发生去钉扎：\n$$ 2\\mu_0 M_s H_{\\text{dep}} S = F_{\\text{pin,max}} $$\n$$ H_{\\text{dep}} = \\frac{F_{\\text{pin,max}}}{2\\mu_0 M_s S} = \\frac{1}{2\\mu_0 M_s} \\left| \\frac{A_d - A_0}{\\Delta_0^2} + K_{ud} - K_{u0} \\right| \\tanh^2\\left(\\frac{L_d}{\\Delta_0}\\right) $$\n\n**5. 用原子尺度参数表示**\n\n最后，我们将粗粒化关系代入 $H_{\\text{dep}}$ 的表达式中。\n- $M_s = \\mu/a^3$\n- $A_0 = J_0/a$, $A_d = J_d/a$\n- $K_{u0} = K_0/a^3$, $K_{ud} = K_d/a^3$\n- $\\Delta_0^2 = A_0/K_{u0} = (J_0/a)/(K_0/a^3) = a^2 J_0/K_0$\n钉扎参数 $P$ 变为：\n$$ P = \\frac{(J_d - J_0)/a}{a^2 J_0/K_0} + \\frac{K_d - K_0}{a^3} = \\frac{K_0(J_d - J_0)}{a^3 J_0} + \\frac{K_d - K_0}{a^3} = \\frac{1}{a^3} \\left( K_0 \\frac{J_d}{J_0} + K_d - 2K_0 \\right) $$\n将 $P$ 和 $M_s$ 代入 $H_{\\text{dep}}$ 的方程中：\n$$ H_{\\text{dep}} = \\frac{1}{2\\mu_0 (\\mu/a^3)} \\left| \\frac{1}{a^3} \\left( K_0 \\frac{J_d}{J_0} + K_d - 2K_0 \\right) \\right| \\tanh^2\\left(\\frac{L_d}{\\Delta_0}\\right) $$\n因子 $a^3$ 被消去。根据问题定义 $L_d = \\lambda \\Delta_0$，双曲正切平方的自变量变为 $\\lambda$。去钉扎场的最终闭合形式表达式为：\n$$ H_{\\text{dep}} = \\frac{1}{2\\mu_0 \\mu} \\left| K_0 \\frac{J_d}{J_0} + K_d - 2K_0 \\right| \\tanh^2(\\lambda) $$\n该表达式将被用于实现并求解给定的测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Calculates the domain wall depinning field for a one-dimensional\n    ferromagnetic nanowire with a localized defect.\n    \"\"\"\n    \n    # Shared material parameters (SI units)\n    # The lattice constant 'a' is not needed in the final formula as it cancels out.\n    # a = 2.5e-10            # Lattice constant (m)\n    mu = 1.8548e-23        # Atomistic magnetic moment (A·m^2)\n    J0 = 1.5e-21           # Background exchange parameter (J)\n    K0 = 2.0e-24           # Background anisotropy parameter (J)\n    mu0 = 4 * math.pi * 1e-7 # Vacuum permeability (N/A^2 or H/m)\n\n    # Test cases: (Jd, Kd, lambda)\n    # Jd: defect exchange (J)\n    # Kd: defect anisotropy (J)\n    # lambda: defect length in units of domain wall width (L_d / Delta_0)\n    test_cases = [\n        (1.2e-21, 3.0e-24, 1.0),  # Case 1\n        (1.2e-21, 3.0e-24, 0.0),  # Case 2\n        (1.8e-21, 0.5e-24, 5.0),  # Case 3\n        (2.5e-21, 2.0e-24, 0.5),  # Case 4\n        (1.5e-21, 3.6e-24, 0.2),  # Case 5\n    ]\n\n    results = []\n    \n    # The depinning field H_dep is derived as:\n    # H_dep = (1 / (2 * mu0 * mu)) * |K0 * (Jd/J0) + Kd - 2*K0| * tanh^2(lambda)\n\n    # Pre-calculate the denominator which is constant for all cases\n    denominator = 2 * mu0 * mu\n\n    for Jd, Kd, lam in test_cases:\n        # Calculate the energy-like term Q = K0 * (Jd/J0) + Kd - 2*K0\n        # This term has units of energy (Joules).\n        Q_term = K0 * (Jd / J0) + Kd - 2 * K0\n        \n        # Calculate the tanh^2(lambda) term, which is dimensionless.\n        tanh_sq_lambda = np.tanh(lam)**2\n        \n        # Calculate the depinning field H_dep in A/m\n        H_dep = (abs(Q_term) / denominator) * tanh_sq_lambda\n        \n        results.append(H_dep)\n\n    # Format the output as a comma-separated list of floating-point numbers\n    # enclosed in square brackets, as per the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}