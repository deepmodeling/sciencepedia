{
    "hands_on_practices": [
        {
            "introduction": "The interaction between a charged molecule and a solvent is fundamentally governed by electrostatics. A powerful way to conceptualize the solvent's response is through the method of images, which simplifies the complex problem of induced polarization at a dielectric interface. This foundational exercise  walks you through deriving the force on a charge near a planar boundary, providing a concrete understanding of the \"reaction field\" that is central to all implicit solvent models.",
            "id": "3807839",
            "problem": "In an implicit solvent model (ISM) used in multiscale materials simulation, a polarizable continuum is represented by a spatially varying dielectric permittivity. Consider a planar interface at $z=0$ separating two semi-infinite, linear, homogeneous, isotropic dielectrics with absolute permittivities $\\epsilon_{1}$ for $z>0$ and $\\epsilon_{2}$ for $z<0$. A point charge of magnitude $q$ is fixed at $\\mathbf{r}_{0}=(0,0,z)$ with $z>0$ inside the $\\epsilon_{1}$ medium. Assume electrostatic equilibrium, no free surface charge at the interface, and that the electrostatic potential $\\Phi(\\mathbf{r}) \\to 0$ as $|\\mathbf{r}|\\to \\infty$.\n\nStarting from the fundamental electrostatic relations $\\mathbf{E}=-\\nabla \\Phi$, $\\nabla \\cdot \\mathbf{D}=\\rho_{\\text{free}}$, and $\\mathbf{D}=\\epsilon \\mathbf{E}$, together with the boundary conditions at a dielectric interface (continuity of $\\Phi$ and continuity of the normal component of $\\mathbf{D}$ in the absence of free surface charge), derive the electrostatic potential $\\Phi_{1}(\\mathbf{r})$ in the $z>0$ region produced by the point charge and the induced bound charges, by mapping the problem to an equivalent source configuration. Then, compute the mechanical force component $F_{z}$ acting on the point charge due to the presence of the interface. Take the $+z$ direction to be away from the interface. Express the final force as a closed-form analytic expression in terms of $q$, $z$, $\\epsilon_{1}$, and $\\epsilon_{2}$. Do not substitute numerical values. Your final answer must be a single expression. If you find a numerical quantity, round to the required significant figures, but here no rounding is required and no units should be included in the final boxed expression.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard problem in electrostatics, fundamental to the theory of continuum dielectric models.\n\nThe physical system consists of two semi-infinite dielectric media with a planar interface at $z=0$. The region $z>0$ has permittivity $\\epsilon_1$ and the region $z<0$ has permittivity $\\epsilon_2$. A point charge $q$ is located at $\\mathbf{r}_{0}=(0,0,z)$ in the first medium, where $z>0$. We are in electrostatic equilibrium.\n\nThe electrostatic potential $\\Phi(\\mathbf{r})$ is governed by the following equations. In the region $z>0$, the potential $\\Phi_1$ must satisfy Poisson's equation:\n$$ \\nabla^2 \\Phi_1 = -\\frac{\\rho_{\\text{free}}}{\\epsilon_1} = -\\frac{q \\delta(\\mathbf{r}-\\mathbf{r}_0)}{\\epsilon_1} $$\nIn the region $z<0$, there are no free charges, so the potential $\\Phi_2$ must satisfy Laplace's equation:\n$$ \\nabla^2 \\Phi_2 = 0 $$\nThe potentials must satisfy the boundary conditions at the interface $z=0$:\n1.  Continuity of potential: $\\Phi_1(x,y,0) = \\Phi_2(x,y,0)$.\n2.  Continuity of the normal component of the electric displacement field $\\mathbf{D}$: $D_{1,n} = D_{2,n}$. Since there is no free surface charge, this means $\\epsilon_1 E_{1,n} = \\epsilon_2 E_{2,n}$. The normal vector to the interface points from region $2$ to region $1$ (or vice versa), let's take it as $\\mathbf{\\hat{n}}=\\mathbf{\\hat{z}}$. So, $\\epsilon_1 (-\\frac{\\partial \\Phi_1}{\\partial z})\\big|_{z=0} = \\epsilon_2 (-\\frac{\\partial \\Phi_2}{\\partial z})\\big|_{z=0}$, which simplifies to $\\epsilon_1 \\frac{\\partial \\Phi_1}{\\partial z}\\big|_{z=0} = \\epsilon_2 \\frac{\\partial \\Phi_2}{\\partial z}\\big|_{z=0}$.\n3.  The potential must vanish at infinity: $\\Phi(\\mathbf{r}) \\to 0$ as $|\\mathbf{r}| \\to \\infty$.\n\nWe will use the method of images to find an equivalent source configuration that satisfies these conditions. Let the position of a point in space be $(x,y,\\zeta)$ to distinguish the coordinate variable from the fixed charge position $z$.\n\nFor the region $\\zeta>0$, the potential $\\Phi_1$ can be represented as the sum of the potential from the original charge $q$ at $(0,0,z)$ and an image charge $q'$ located at the mirror position $(0,0,-z)$. Both charges are considered to be in an unbounded medium of permittivity $\\epsilon_1$.\n$$ \\Phi_1(x,y,\\zeta) = \\frac{1}{4\\pi\\epsilon_1} \\left( \\frac{q}{\\sqrt{x^2+y^2+(\\zeta-z)^2}} + \\frac{q'}{\\sqrt{x^2+y^2+(\\zeta+z)^2}} \\right) $$\nThis form satisfies Poisson's equation for $\\zeta>0$ since the image charge is outside this region.\n\nFor the region $\\zeta<0$, the potential $\\Phi_2$ can be represented as being due to an effective charge $q''$ located at the position of the original charge $(0,0,z)$, but in an unbounded medium of permittivity $\\epsilon_2$.\n$$ \\Phi_2(x,y,\\zeta) = \\frac{1}{4\\pi\\epsilon_2} \\frac{q''}{\\sqrt{x^2+y^2+(\\zeta-z)^2}} $$\nThis form satisfies Laplace's equation for $\\zeta<0$ since the source is outside this region.\n\nNow, we enforce the boundary conditions at the interface $\\zeta=0$ to determine the unknown charges $q'$ and $q''$. Let $\\rho = \\sqrt{x^2+y^2}$.\n\n1.  Continuity of $\\Phi$: $\\Phi_1(x,y,0) = \\Phi_2(x,y,0)$\n$$ \\frac{1}{4\\pi\\epsilon_1} \\left( \\frac{q}{\\sqrt{\\rho^2+z^2}} + \\frac{q'}{\\sqrt{\\rho^2+z^2}} \\right) = \\frac{1}{4\\pi\\epsilon_2} \\frac{q''}{\\sqrt{\\rho^2+z^2}} $$\nThis must hold for all $\\rho$, so we can cancel the common terms to get our first relation:\n$$ \\frac{q+q'}{\\epsilon_1} = \\frac{q''}{\\epsilon_2} \\implies \\epsilon_2(q+q') = \\epsilon_1 q'' \\quad (1) $$\n\n2.  Continuity of normal $D$: $\\epsilon_1 \\frac{\\partial \\Phi_1}{\\partial \\zeta}\\big|_{\\zeta=0} = \\epsilon_2 \\frac{\\partial \\Phi_2}{\\partial \\zeta}\\big|_{\\zeta=0}$\nWe first compute the derivatives with respect to $\\zeta$:\n$$ \\frac{\\partial \\Phi_1}{\\partial \\zeta} = \\frac{1}{4\\pi\\epsilon_1} \\left[ q \\frac{-(\\zeta-z)}{(\\rho^2+(\\zeta-z)^2)^{3/2}} + q' \\frac{-(\\zeta+z)}{(\\rho^2+(\\zeta+z)^2)^{3/2}} \\right] $$\n$$ \\frac{\\partial \\Phi_2}{\\partial \\zeta} = \\frac{1}{4\\pi\\epsilon_2} \\left[ q'' \\frac{-(\\zeta-z)}{(\\rho^2+(\\zeta-z)^2)^{3/2}} \\right] $$\nEvaluating at $\\zeta=0$:\n$$ \\frac{\\partial \\Phi_1}{\\partial \\zeta}\\bigg|_{\\zeta=0} = \\frac{1}{4\\pi\\epsilon_1} \\frac{z(q-q')}{(\\rho^2+z^2)^{3/2}} $$\n$$ \\frac{\\partial \\Phi_2}{\\partial \\zeta}\\bigg|_{\\zeta=0} = \\frac{1}{4\\pi\\epsilon_2} \\frac{z q''}{(\\rho^2+z^2)^{3/2}} $$\nApplying the boundary condition $\\epsilon_1 (\\partial \\Phi_1 / \\partial \\zeta) = \\epsilon_2 (\\partial \\Phi_2 / \\partial \\zeta)$ at $\\zeta=0$:\n$$ \\epsilon_1 \\left( \\frac{z(q-q')}{4\\pi\\epsilon_1(\\rho^2+z^2)^{3/2}} \\right) = \\epsilon_2 \\left( \\frac{z q''}{4\\pi\\epsilon_2(\\rho^2+z^2)^{3/2}} \\right) $$\nThis simplifies to our second relation:\n$$ q-q' = q'' \\quad (2) $$\nNow we solve the system of linear equations $(1)$ and $(2)$ for $q'$ and $q''$. Substitute $(2)$ into $(1)$:\n$$ \\epsilon_2(q+q') = \\epsilon_1(q-q') $$\n$$ \\epsilon_2 q + \\epsilon_2 q' = \\epsilon_1 q - \\epsilon_1 q' $$\n$$ q'(\\epsilon_1 + \\epsilon_2) = q(\\epsilon_1 - \\epsilon_2) $$\n$$ q' = q \\frac{\\epsilon_1 - \\epsilon_2}{\\epsilon_1 + \\epsilon_2} $$\nThe electrostatic potential $\\Phi_1$ in the region $z>0$ (using $z_{coord}$ for the coordinate to avoid ambiguity) is thus:\n$$ \\Phi_1(x,y,z_{coord}) = \\frac{1}{4\\pi\\epsilon_1} \\left( \\frac{q}{\\sqrt{x^2+y^2+(z_{coord}-z)^2}} + q \\frac{\\epsilon_1 - \\epsilon_2}{\\epsilon_1 + \\epsilon_2} \\frac{1}{\\sqrt{x^2+y^2+(z_{coord}+z)^2}} \\right) $$\n\nNext, we compute the force on the charge $q$. The force on $q$ is due to the electric field created by all other sources. In the method of images, the field from the induced polarization charges at the interface is exactly the field created by the image charge $q'$. The force on the real charge $q$ located at $\\mathbf{r}_0=(0,0,z)$ due to the image charge $q'$ at $\\mathbf{r}'=(0,0,-z)$ is calculated as if both were in an infinite medium of permittivity $\\epsilon_1$.\nThe force vector $\\mathbf{F}$ is given by Coulomb's law:\n$$ \\mathbf{F} = \\frac{1}{4\\pi\\epsilon_1} \\frac{q q'}{|\\mathbf{r}_{0} - \\mathbf{r}'|^2} \\mathbf{\\hat{r}} $$\nwhere $\\mathbf{\\hat{r}}$ is the unit vector pointing from $q'$ to $q$.\nThe vector from $\\mathbf{r}'$ to $\\mathbf{r}_0$ is $\\mathbf{r}_0 - \\mathbf{r}' = (0,0,z) - (0,0,-z) = (0,0,2z)$. The direction is along the $+z$ axis, so $\\mathbf{\\hat{r}} = \\mathbf{\\hat{z}}$. The distance is $|\\mathbf{r}_0 - \\mathbf{r}'| = 2z$.\n$$ \\mathbf{F} = \\frac{q q'}{4\\pi\\epsilon_1 (2z)^2} \\mathbf{\\hat{z}} = \\frac{q q'}{16\\pi\\epsilon_1 z^2} \\mathbf{\\hat{z}} $$\nThe force component $F_z$ in the $+z$ direction is the magnitude of this vector component:\n$$ F_z = \\frac{q q'}{16\\pi\\epsilon_1 z^2} $$\nSubstituting the expression for $q'$:\n$$ F_z = \\frac{q}{16\\pi\\epsilon_1 z^2} \\left( q \\frac{\\epsilon_1 - \\epsilon_2}{\\epsilon_1 + \\epsilon_2} \\right) $$\n$$ F_z = \\frac{q^2}{16\\pi\\epsilon_1 z^2} \\frac{\\epsilon_1 - \\epsilon_2}{\\epsilon_1 + \\epsilon_2} $$\nThis expression represents the force component on the charge $q$ directed along the $z$-axis, where the $+z$ direction is away from the interface. If $\\epsilon_1 > \\epsilon_2$, the force is repulsive ($F_z>0$). If $\\epsilon_1 < \\epsilon_2$, the force is attractive ($F_z<0$).",
            "answer": "$$\\boxed{\\frac{q^2}{16\\pi\\epsilon_1 z^2} \\frac{\\epsilon_1 - \\epsilon_2}{\\epsilon_1 + \\epsilon_2}}$$"
        },
        {
            "introduction": "Moving from a planar interface to a more realistic spherical model for an ion, we can calculate one of the most important quantities in solvation science: the free energy of transferring an ion from vacuum to a solvent. This practice  involves deriving the renowned Born formula for solvation free energy from first principles. By completing this derivation, you will see how the geometric size of an ion is directly linked to its effective \"Born radius,\" a key parameter that underpins the widely used Generalized Born (GB) family of implicit solvent models.",
            "id": "3807765",
            "problem": "In multiscale materials simulation, an implicit solvent model is often calibrated to reproduce the electrostatic solvation free energy that would be observed in an explicit solvent description. Consider a spherical, non-polarizable ionic cavity of radius $a$, centered at the origin, containing a point charge $q$ at $r=0$. The cavity interior has dielectric constant $\\epsilon_{\\text{in}}=1$, and it is embedded in a uniform continuum solvent with dielectric constant $\\epsilon>1$. Assume linear, isotropic, and homogeneous dielectric response in the solvent and vacuum interior, and neglect ionic screening (no mobile salt).\n\nStarting from the fundamental base consisting of the Poisson equation in spherical symmetry and the Maxwell boundary conditions at $r=a$, perform the following steps:\n\n- Solve for the electrostatic potential inside and outside the cavity and determine the reaction potential at the ion location, defined as the finite, non-Coulombic part of the potential at $r \\to 0$.\n\n- Using the definition of electrostatic charging work in a linear medium, compute the solvation free energy $\\Delta G_{\\text{solv}}$ for transferring the charge $q$ from vacuum into the dielectric environment described above.\n\n- The generalized Born (GB) implicit solvent model represents the same free energy for a single charge as $\\Delta G_{\\text{GB}} = -\\frac{q^{2}}{8\\pi \\epsilon_{0}}\\left(1-\\frac{1}{\\epsilon}\\right)\\frac{1}{\\alpha}$, where $\\alpha$ is the Born radius. By enforcing $\\Delta G_{\\text{solv}}=\\Delta G_{\\text{GB}}$, compute $\\alpha$ in terms of $a$.\n\nProvide your final answer for $\\alpha$ as a single closed-form analytical expression. Do not include units. No numerical rounding is required.",
            "solution": "The problem asks for the derivation of the Born radius, $\\alpha$, for a spherical ion within the framework of continuum electrostatics, by equating the classic Born solvation free energy with the generalized Born (GB) model's expression.\n\nThe problem is validated as scientifically grounded, well-posed, and objective. It is a standard problem in theoretical and computational chemistry based on Maxwell's equations. All necessary information is provided.\n\nThe first step is to solve for the electrostatic potential inside and outside the spherical cavity. The system has spherical symmetry. Let $\\phi_{\\text{in}}(r)$ be the potential for $r < a$ and $\\phi_{\\text{out}}(r)$ be the potential for $r > a$, where $a$ is the radius of the cavity.\n\nInside the cavity ($r < a$), the dielectric constant is $\\epsilon_{\\text{in}}=1$. The potential is governed by the Poisson equation for a point charge $q$ at the origin:\n$$ \\nabla^2 \\phi_{\\text{in}} = -\\frac{\\rho}{\\epsilon_0 \\epsilon_{\\text{in}}} = -\\frac{q}{\\epsilon_0} \\delta(\\mathbf{r}) $$\nThe general solution is the sum of the potential from the point charge in vacuum and a solution to the Laplace equation that is regular at the origin. The latter must be a constant, which we denote as $B$.\n$$ \\phi_{\\text{in}}(r) = \\frac{q}{4\\pi\\epsilon_0 r} + B $$\n\nOutside the cavity ($r > a$), the dielectric constant is $\\epsilon$. There are no free charges, so the potential is governed by the Laplace equation:\n$$ \\nabla^2 \\phi_{\\text{out}} = 0 $$\nThe general solution that vanishes as $r \\to \\infty$ is:\n$$ \\phi_{\\text{out}}(r) = \\frac{A}{r} $$\nwhere $A$ is a constant to be determined.\n\nThe constants $A$ and $B$ are found by applying the boundary conditions at the dielectric interface, $r=a$.\n\n1.  The potential must be continuous across the boundary: $\\phi_{\\text{in}}(a) = \\phi_{\\text{out}}(a)$.\n    $$ \\frac{q}{4\\pi\\epsilon_0 a} + B = \\frac{A}{a} $$\n\n2.  The normal component of the electric displacement field, $\\mathbf{D} = -\\epsilon_0 \\epsilon_r \\nabla \\phi$, must be continuous across the boundary (since there are no free surface charges). In spherical coordinates, this means the radial component $D_r$ is continuous.\n    $$ \\epsilon_{\\text{in}} \\left. \\frac{d\\phi_{\\text{in}}}{dr} \\right|_{r=a} = \\epsilon \\left. \\frac{d\\phi_{\\text{out}}}{dr} \\right|_{r=a} $$\n    Given $\\epsilon_{\\text{in}} = 1$:\n    $$ \\left. \\frac{d\\phi_{\\text{in}}}{dr} \\right|_{r=a} = \\epsilon \\left. \\frac{d\\phi_{\\text{out}}}{dr} \\right|_{r=a} $$\n    We compute the derivatives:\n    $$ \\frac{d\\phi_{\\text{in}}}{dr} = -\\frac{q}{4\\pi\\epsilon_0 r^2} $$\n    $$ \\frac{d\\phi_{\\text{out}}}{dr} = -\\frac{A}{r^2} $$\n    Substituting these into the boundary condition at $r=a$:\n    $$ -\\frac{q}{4\\pi\\epsilon_0 a^2} = \\epsilon \\left( -\\frac{A}{a^2} \\right) $$\n    This simplifies to:\n    $$ A = \\frac{q}{4\\pi\\epsilon_0 \\epsilon} $$\n\nNow, we substitute the expression for $A$ back into the first boundary condition to solve for $B$:\n$$ \\frac{q}{4\\pi\\epsilon_0 a} + B = \\frac{1}{a} \\left(\\frac{q}{4\\pi\\epsilon_0 \\epsilon}\\right) $$\n$$ B = \\frac{q}{4\\pi\\epsilon_0 a \\epsilon} - \\frac{q}{4\\pi\\epsilon_0 a} = \\frac{q}{4\\pi\\epsilon_0 a} \\left(\\frac{1}{\\epsilon} - 1\\right) $$\n\nThe problem defines the reaction potential, $\\phi_{\\text{reac}}$, as the finite, non-Coulombic part of the potential at $r \\to 0$. In our expression for $\\phi_{\\text{in}}(r)$, the term $\\frac{q}{4\\pi\\epsilon_0 r}$ is the direct Coulomb potential of the charge, which diverges at the origin. The term $B$ is finite and represents the potential at the origin created by the polarization of the surrounding dielectric medium. Therefore, the reaction potential is:\n$$ \\phi_{\\text{reac}} = B = \\frac{q}{4\\pi\\epsilon_0 a} \\left(\\frac{1}{\\epsilon} - 1\\right) = -\\frac{q}{4\\pi\\epsilon_0 a} \\left(1 - \\frac{1}{\\epsilon}\\right) $$\n\nNext, we compute the electrostatic solvation free energy, $\\Delta G_{\\text{solv}}$. This is the work required to charge the ion from $0$ to $q$ in the presence of the reaction potential. For a linear dielectric, the reaction potential is proportional to the charge, $\\phi_{\\text{reac}}(q') = (q'/q) \\phi_{\\text{reac}}(q)$. The charging work is:\n$$ \\Delta G_{\\text{solv}} = \\int_0^q \\phi_{\\text{reac}}(q') \\, dq' $$\nThis integral evaluates to $\\frac{1}{2}q\\phi_{\\text{reac}}$. Substituting the expression for $\\phi_{\\text{reac}}$:\n$$ \\Delta G_{\\text{solv}} = \\frac{1}{2} q \\left[ -\\frac{q}{4\\pi\\epsilon_0 a} \\left(1 - \\frac{1}{\\epsilon}\\right) \\right] $$\n$$ \\Delta G_{\\text{solv}} = -\\frac{q^2}{8\\pi\\epsilon_0 a} \\left(1 - \\frac{1}{\\epsilon}\\right) $$\nThis is the renowned Born formula for the solvation free energy of a spherical ion.\n\nFinally, the problem requires equating this result to the given expression for the generalized Born (GB) free energy, $\\Delta G_{\\text{GB}}$, and solving for the Born radius $\\alpha$.\n$$ \\Delta G_{\\text{GB}} = -\\frac{q^{2}}{8\\pi \\epsilon_{0}}\\left(1-\\frac{1}{\\epsilon}\\right)\\frac{1}{\\alpha} $$\nSetting $\\Delta G_{\\text{solv}} = \\Delta G_{\\text{GB}}$:\n$$ -\\frac{q^2}{8\\pi\\epsilon_0 a} \\left(1 - \\frac{1}{\\epsilon}\\right) = -\\frac{q^{2}}{8\\pi \\epsilon_{0}}\\left(1-\\frac{1}{\\epsilon}\\right)\\frac{1}{\\alpha} $$\nThe common non-zero factor $-\\frac{q^2}{8\\pi\\epsilon_0}\\left(1-\\frac{1}{\\epsilon}\\right)$ (since $q \\ne 0$ and $\\epsilon > 1$) can be canceled from both sides of the equation, yielding:\n$$ \\frac{1}{a} = \\frac{1}{\\alpha} $$\nFrom this, we conclude:\n$$ \\alpha = a $$\nThis result demonstrates that for a perfectly spherical ion, the effective Born radius in the GB model is identical to the geometric radius of the cavity.",
            "answer": "$$\\boxed{a}$$"
        },
        {
            "introduction": "Analytical solutions are limited to highly symmetric systems, but real biomolecules are complex and irregular. To handle realistic geometries, we turn to numerical methods to solve the governing electrostatic equations. This advanced practice  guides you through the implementation of a finite difference solver for the linearized Poisson-Boltzmann (PB) equation, a workhorse for modeling ionic screening effects in solution. You will not only build the solver but also verify its accuracy using the method of manufactured solutions, a critical skill in computational science.",
            "id": "3807816",
            "problem": "Consider the linearized Poisson–Boltzmann (PB) equation arising in implicit solvent models of ionic screening in materials. In electrostatics, Gauss's law relates the electrostatic potential to charge density, and in dilute electrolytes the Debye–Hückel approximation introduces a linear screening term. After nondimensionalization and assuming a constant permittivity, the boundary value problem on the unit square domain is defined as follows: find a sufficiently smooth scalar potential $\\,\\phi(x,y)\\,$ on $\\,\\Omega = (0,1)\\times(0,1)\\,$ satisfying\n$$-\\nabla^2 \\phi(x,y) + \\lambda\\,\\phi(x,y) = s(x,y)\\quad\\text{for}\\quad (x,y)\\in\\Omega,$$\nwith homogeneous Dirichlet boundary conditions\n$$\\phi(x,y) = 0\\quad\\text{for}\\quad (x,y)\\in\\partial\\Omega.$$\nHere, $\\,\\lambda\\ge 0\\,$ is a dimensionless screening parameter (the square of the Debye wavenumber), and $\\,s(x,y)\\,$ is a prescribed source. This model represents an implicit solvent description of ionic screening effects.\n\nYour task is to derive, implement, and verify a finite difference solver using a structured, uniformly spaced grid. Begin from fundamental principles: discretize $\\,\\Omega\\,$ using a uniform mesh with $\\,N\\,$ interior points per axis, grid spacing $\\,h = \\frac{1}{N+1}\\,$, and enforce the boundary condition $\\,\\phi=0\\,$ on $\\,\\partial\\Omega\\,$. Use a second-order accurate central difference approximation for the Laplacian operator. Assemble the resulting linear system and solve for the discrete approximation $\\,\\phi_h\\,$ of $\\,\\phi\\,$ on the interior grid points.\n\nTo produce quantifiable error norms without relying on unknown analytical solutions, use the method of manufactured solutions: take\n$$\\phi^\\star(x,y) = \\sin(\\pi x)\\,\\sin(\\pi y),$$\nand define the source $\\,s(x,y)\\,$ such that $\\,\\phi^\\star\\,$ satisfies the continuous equation. Compute discrete error norms between $\\,\\phi_h\\,$ and the exact $\\,\\phi^\\star\\,$ sampled on the interior grid:\n- The discrete $\\,L^2\\,$ norm\n$$\\|e\\|_{L^2,h} = \\left(h^2 \\sum_{i=1}^{N}\\sum_{j=1}^{N} \\left(\\phi_h(x_i,y_j) - \\phi^\\star(x_i,y_j)\\right)^2\\right)^{1/2},$$\nwhere $\\,x_i = i\\,h\\,$ and $\\,y_j = j\\,h\\,$ for $\\,i,j\\in\\{1,\\dots,N\\}\\,$.\n- The discrete $\\,L^\\infty\\,$ norm\n$$\\|e\\|_{L^\\infty,h} = \\max_{1\\le i,j\\le N}\\left|\\phi_h(x_i,y_j) - \\phi^\\star(x_i,y_j)\\right|.$$\n\nPerform a mesh refinement study with the sequence of interior grid sizes $\\,N\\in\\{16,32,64,128\\}\\,$ for each chosen screening parameter. For each pair of consecutive meshes $\\,N\\,$ and $\\,2N\\,$, estimate the empirical order of accuracy $\\,p\\,$ for each norm via\n$$p = \\frac{\\log\\left(\\frac{\\|e\\|_{h}}{\\|e\\|_{h/2}}\\right)}{\\log(2)},$$\nand report the average over all refinement pairs. You must implement a complete solver that assembles the discrete operator, computes the manufactured source, solves the linear system, evaluates the errors, and computes the convergence orders.\n\nTest suite:\n- Case $\\,1\\,$: $\\,\\lambda = 0\\,$.\n- Case $\\,2\\,$: $\\,\\lambda = 10\\,$.\n- Case $\\,3\\,$: $\\,\\lambda = 100\\,$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain $\\,6\\,$ floating-point numbers in the following order: $[p_{L^2}^{(\\lambda=0)},p_{L^\\infty}^{(\\lambda=0)},p_{L^2}^{(\\lambda=10)},p_{L^\\infty}^{(\\lambda=10)},p_{L^2}^{(\\lambda=100)},p_{L^\\infty}^{(\\lambda=100)}]$. No physical units are involved; all quantities are dimensionless.",
            "solution": "The problem posed is to solve the two-dimensional linearized Poisson-Boltzmann equation on a unit square domain using a finite difference method and to verify the implementation's order of accuracy using the method of manufactured solutions.\n\nThe governing partial differential equation (PDE) is given by:\n$$-\\nabla^2 \\phi(x,y) + \\lambda\\,\\phi(x,y) = s(x,y)\\quad\\text{for}\\quad (x,y)\\in\\Omega$$\nwhere the domain is the unit square $\\Omega = (0,1)\\times(0,1)$. The potential $\\phi(x,y)$ is subject to homogeneous Dirichlet boundary conditions:\n$$\\phi(x,y) = 0\\quad\\text{for}\\quad (x,y)\\in\\partial\\Omega$$\nThe parameter $\\lambda \\ge 0$ is the screening parameter, and $s(x,y)$ is a source term.\n\nFirst, we derive the source term $s(x,y)$ for the method of manufactured solutions. The prescribed exact solution is $\\phi^\\star(x,y) = \\sin(\\pi x)\\sin(\\pi y)$. We substitute this into the PDE to find the corresponding source. The partial derivatives of $\\phi^\\star$ are:\n$$\\frac{\\partial^2 \\phi^\\star}{\\partial x^2} = -\\pi^2 \\sin(\\pi x)\\sin(\\pi y)$$\n$$\\frac{\\partial^2 \\phi^\\star}{\\partial y^2} = -\\pi^2 \\sin(\\pi x)\\sin(\\pi y)$$\nThe Laplacian of $\\phi^\\star$ is therefore:\n$$\\nabla^2 \\phi^\\star = \\frac{\\partial^2 \\phi^\\star}{\\partial x^2} + \\frac{\\partial^2 \\phi^\\star}{\\partial y^2} = -2\\pi^2 \\sin(\\pi x)\\sin(\\pi y) = -2\\pi^2 \\phi^\\star(x,y)$$\nSubstituting this into the governing PDE, we find the source term $s(x,y)$:\n$$s(x,y) = -\\nabla^2 \\phi^\\star(x,y) + \\lambda\\,\\phi^\\star(x,y) = -(-2\\pi^2 \\phi^\\star(x,y)) + \\lambda\\,\\phi^\\star(x,y) = (2\\pi^2 + \\lambda)\\sin(\\pi x)\\sin(\\pi y)$$\n\nNext, we discretize the domain and the PDE. We use a uniform grid with $N$ interior points along each axis, resulting in grid points $(x_i, y_j)$ where $x_i = i h$ and $y_j = j h$ for $i,j \\in \\{1, 2, \\dots, N\\}$. The grid spacing is $h = \\frac{1}{N+1}$. Let $\\phi_{i,j}$ be the numerical approximation of $\\phi(x_i, y_j)$.\n\nThe Laplacian operator $\\nabla^2$ is approximated using a second-order accurate five-point central difference stencil:\n$$\\nabla^2 \\phi(x_i, y_j) \\approx \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{h^2} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{h^2}$$\nSubstituting this approximation into the PDE gives the discrete equation at each interior grid point $(i,j)$:\n$$- \\left( \\frac{\\phi_{i+1,j} + \\phi_{i-1,j} + \\phi_{i,j+1} + \\phi_{i,j-1} - 4\\phi_{i,j}}{h^2} \\right) + \\lambda \\phi_{i,j} = s_{i,j}$$\nwhere $s_{i,j} = s(x_i, y_j)$. Rearranging the terms, we get:\n$$\\left(\\frac{4}{h^2} + \\lambda\\right)\\phi_{i,j} - \\frac{1}{h^2}\\phi_{i-1,j} - \\frac{1}{h^2}\\phi_{i+1,j} - \\frac{1}{h^2}\\phi_{i,j-1} - \\frac{1}{h^2}\\phi_{i,j+1} = s_{i,j}$$\nThe homogeneous Dirichlet boundary conditions imply that for points on the boundary, $\\phi_{0,j} = \\phi_{N+1,j} = \\phi_{i,0} = \\phi_{i,N+1} = 0$.\n\nThese $N^2$ linear equations for the $N^2$ unknown values $\\phi_{i,j}$ can be assembled into a matrix system $A \\boldsymbol{\\phi}_h = \\boldsymbol{s}_h$. We map the $N \\times N$ grid of unknowns to a single vector $\\boldsymbol{\\phi}_h$ of length $N^2$. A common choice is column-major ordering, where the grid columns are stacked. With this mapping, the system matrix $A$ is a sparse, symmetric, positive-definite, block-tridiagonal matrix of size $N^2 \\times N^2$.\n\nThe matrix $A$ can be elegantly constructed using the Kronecker sum. Let $D_{1D}$ be the $N \\times N$ matrix representing the one-dimensional second-order centered difference approximation of the negative second derivative, $-\\frac{d^2}{dx^2}$:\n$$D_{1D} = \\frac{1}{h^2} \\begin{pmatrix} 2 & -1 & & \\\\ -1 & 2 & -1 & \\\\ & \\ddots & \\ddots & \\ddots \\\\ & & -1 & 2 & -1 \\\\ & & & -1 & 2 \\end{pmatrix}$$\nThe matrix for the two-dimensional negative Laplacian, $-\\nabla^2$, represented on the flattened vector of unknowns, is given by the Kronecker sum $A_{2D} = I_N \\otimes D_{1D} + D_{1D} \\otimes I_N$, where $I_N$ is the $N \\times N$ identity matrix. The final system matrix $A$ for the operator $(-\\nabla^2 + \\lambda)$ is:\n$$A = A_{2D} + \\lambda I_{N^2}$$\nwhere $I_{N^2}$ is the $N^2 \\times N^2$ identity matrix. The right-hand side vector $\\boldsymbol{s}_h$ is simply the source term $s(x,y)$ evaluated at all interior grid points and flattened into a vector of length $N^2$ using the same column-major ordering.\n\nTo verify the solver, we perform a mesh refinement study for $N \\in \\{16, 32, 64, 128\\}$. For each mesh, we solve the system $A \\boldsymbol{\\phi}_h = \\boldsymbol{s}_h$ to obtain the numerical solution $\\phi_h$. We then compute the error by comparing it to the exact manufactured solution $\\phi^\\star$ sampled on the grid. The discrete error norms are:\n$$ \\|e\\|_{L^2,h} = \\left(h^2 \\sum_{i=1}^{N}\\sum_{j=1}^{N} \\left(\\phi_{i,j} - \\phi^\\star(x_i,y_j)\\right)^2\\right)^{1/2} $$\n$$ \\|e\\|_{L^\\infty,h} = \\max_{1\\le i,j\\le N}\\left|\\phi_{i,j} - \\phi^\\star(x_i,y_j)\\right| $$\nThe empirical order of accuracy, $p$, is estimated by comparing the error on a mesh with spacing $h$ (from grid size $N$) to the error on a refined mesh with spacing $h/2$ (from grid size $2N$):\n$$ p = \\frac{\\log\\left(\\|e\\|_{h} / \\|e\\|_{h/2}\\right)}{\\log(2)} $$\nThis calculation is performed for each pair of consecutive meshes in the refinement sequence, and the results are averaged to provide a robust estimate of the convergence order. Since our finite difference scheme is second-order accurate and the manufactured solution is infinitely smooth, we expect the calculated order of accuracy $p$ to be close to $2$. The entire procedure is repeated for each specified value of $\\lambda$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import diags, identity, kronsum\nfrom scipy.sparse.linalg import spsolve\n\ndef perform_refinement_study(lambda_val, N_list):\n    \"\"\"\n    Performs a mesh refinement study for a given lambda value.\n\n    Args:\n        lambda_val (float): The screening parameter lambda.\n        N_list (list of int): A list of interior grid sizes (N values).\n\n    Returns:\n        tuple: A tuple containing the average convergence orders for L2 and L-infinity norms.\n    \"\"\"\n    errors_l2 = []\n    errors_linf = []\n\n    for N in N_list:\n        # 1. Set up grid and parameters\n        h = 1.0 / (N + 1)\n        # Create grid points from h to 1-h\n        x = np.linspace(h, 1.0 - h, N)\n        # Create a 2D meshgrid\n        X, Y = np.meshgrid(x, x)\n\n        # 2. Define manufactured solution and source term on the grid\n        phi_exact_grid = np.sin(np.pi * X) * np.sin(np.pi * Y)\n        # Source term: s(x,y) = (2*pi^2 + lambda) * sin(pi*x) * sin(pi*y)\n        source_grid = (2 * np.pi**2 + lambda_val) * phi_exact_grid\n\n        # Flatten source term into a vector using column-major ('F') ordering\n        source_vec = source_grid.flatten(order='F')\n\n        # 3. Assemble the sparse linear system matrix A\n        # Create the 1D discrete Laplacian matrix for -d^2/dx^2\n        main_diag = np.ones(N) * 2.0 / h**2\n        off_diag = np.ones(N - 1) * -1.0 / h**2\n        diagonals = [off_diag, main_diag, off_diag]\n        D2_1D = diags(diagonals, [-1, 0, 1], format='csc')\n\n        # Construct the 2D discrete Laplacian for -nabla^2 using Kronecker sum\n        # A_lap = I (x) D2_1D + D2_1D (x) I\n        A_lap = kronsum(D2_1D, D2_1D)\n\n        # Add the lambda term to get the final system matrix A\n        A = A_lap + lambda_val * identity(N**2, format='csc')\n\n        # 4. Solve the linear system A * phi_h = s_h\n        phi_h_vec = spsolve(A, source_vec)\n\n        # Reshape the solution vector back to a 2D grid (column-major order)\n        phi_h_grid = phi_h_vec.reshape((N, N), order='F')\n\n        # 5. Calculate error norms\n        error_grid = phi_h_grid - phi_exact_grid\n\n        # L2 norm\n        l2_err = np.sqrt(h**2 * np.sum(error_grid**2))\n        errors_l2.append(l2_err)\n\n        # L-infinity norm\n        linf_err = np.max(np.abs(error_grid))\n        errors_linf.append(linf_err)\n\n    # 6. Calculate convergence orders\n    rates_l2 = []\n    rates_linf = []\n    # Loop over pairs of consecutive refinements\n    for i in range(len(N_list) - 1):\n        # p = log(error_h / error_h/2) / log(2)\n        rate_l2 = np.log(errors_l2[i] / errors_l2[i+1]) / np.log(2)\n        rates_l2.append(rate_l2)\n        \n        rate_linf = np.log(errors_linf[i] / errors_linf[i+1]) / np.log(2)\n        rates_linf.append(rate_linf)\n\n    # 7. Average the orders\n    avg_rate_l2 = np.mean(rates_l2)\n    avg_rate_linf = np.mean(rates_linf)\n\n    return avg_rate_l2, avg_rate_linf\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the final results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a value for the screening parameter lambda.\n    # The mesh refinement sequence is fixed.\n    lambda_cases = [0.0, 10.0, 100.0]\n    N_list = [16, 32, 64, 128]\n    \n    results = []\n    for lambda_val in lambda_cases:\n        p_l2, p_linf = perform_refinement_study(lambda_val, N_list)\n        results.append(p_l2)\n        results.append(p_linf)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}