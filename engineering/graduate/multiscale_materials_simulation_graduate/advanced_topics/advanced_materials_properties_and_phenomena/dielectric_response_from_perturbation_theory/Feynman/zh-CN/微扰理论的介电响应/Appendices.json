{
    "hands_on_practices": [
        {
            "introduction": "要理解材料的介电响应，我们必须考虑其构成部分（如分子或原子）实际感受到的电场。由于邻近极化分子的影响，这种“局域场”与宏观平均场有所不同。本练习  将指导您推导著名的克劳修斯-莫索提（Clausius-Mossotti）关系，该关系通过引入洛伦兹局域场修正，在微观极化率和宏观介电常数之间建立了自洽的联系。",
            "id": "3801742",
            "problem": "考虑一种由相同的、无相互作用的可极化分子组成的均匀、各向同性、不导电的流体，其温度足够低，以至于热扰动不会改变其静态线性响应。每个分子具有一个永久偶极算符 $\\hat{\\mathbf{d}}$ 和一个静态分子极化率 $\\alpha$，该极化率由对不随时间变化、空间均匀的外部电场的线性响应定义。用分子哈密顿量的非时变微扰 $\\hat{H} = \\hat{H}_{0} - \\hat{\\mathbf{d}} \\cdot \\mathbf{E}_{\\mathrm{loc}}$ 来模拟与外部电场的相互作用，并在静态极限下将感生偶极矩定义为 $\\mathbf{p} = \\alpha \\,\\mathbf{E}_{\\mathrm{loc}}$，其中 $\\mathbf{E}_{\\mathrm{loc}}$ 是分子所受的局域电场。\n\n设体极化强度为 $\\mathbf{P} = N\\,\\mathbf{p}$，其中 $N$ 是分子的数密度，宏观本构关系为 $\\mathbf{D} = \\epsilon_{0}\\,\\epsilon_{r}\\,\\mathbf{E}$，其中 $\\epsilon_{0}$ 是真空介电常数，$\\epsilon_{r}$ 是体相对介电常数。在各向同性介质中，使用球形空腔结构来计算局域电场，并假设 Lorentz 空腔结果为 $\\mathbf{E}_{\\mathrm{loc}} = \\mathbf{E} + \\mathbf{P}/(3\\,\\epsilon_{0})$。\n\n给定每个分子可以建模为半径为 $r$ 的硬球，并占据一个排斥体积 $v_{m} = \\frac{4}{3}\\pi r^{3}$，并且堆积分数 $\\phi$ 定义为 $\\phi = N\\,v_{m}$。该流体具有：\n- 硬球半径 $r = 1.50 \\times 10^{-10}$ m，\n- 堆积分数 $\\phi = 0.40$，\n- 静态分子极化率 $\\alpha = 1.00 \\times 10^{-40}$ F m$^{2}$。\n\n从以上基础出发，推导由局域电场项所蕴含的 $\\epsilon_{r}$ 与 $N$ 和 $\\alpha$ 之间的自洽关系，并将其与忽略局域电场修正（即在粗粒化之前设置 $\\mathbf{E}_{\\mathrm{loc}} = \\mathbf{E}$）所得到的朴素平均场关系进行对比。然后，使用提供的参数，计算修正后的体相对介电常数与未修正的平均场值之比。将您的最终比值四舍五入到四位有效数字。答案以无量纲数表示（无单位）。",
            "solution": "题目要求推导和比较两种用于介电流体体相对介电常数 $\\epsilon_r$ 的模型，然后数值计算它们的比值。第一个模型包含了 Lorentz 局域电场修正，而第二个朴素模型则忽略了它。\n\n分析从为该材料提供的基本关系开始。体极化强度 $\\mathbf{P}$ 是单位体积内的总偶极矩，由分子数密度 $N$ 和单个分子的平均感生偶极矩 $\\mathbf{p}$ 的乘积给出：\n$$\n\\mathbf{P} = N\\,\\mathbf{p}\n$$\n感生偶极矩 $\\mathbf{p}$ 与分子所受的局域电场 $\\mathbf{E}_{\\mathrm{loc}}$ 成线性正比，比例常数为静态分子极化率 $\\alpha$：\n$$\n\\mathbf{p} = \\alpha\\,\\mathbf{E}_{\\mathrm{loc}}\n$$\n结合这两个方程，得到体极化强度和局域电场之间的直接关系：\n$$\n\\mathbf{P} = N\\,\\alpha\\,\\mathbf{E}_{\\mathrm{loc}}\n$$\n\n首先，我们推导考虑了局域电场修正的修正后相对介电常数 $\\epsilon_{r, \\text{corr}}$。题目指出，对于各向同性介质，局域电场由 Lorentz 空腔模型描述：\n$$\n\\mathbf{E}_{\\mathrm{loc}} = \\mathbf{E} + \\frac{\\mathbf{P}}{3\\,\\epsilon_{0}}\n$$\n其中 $\\mathbf{E}$ 是宏观电场，$\\epsilon_{0}$ 是真空介电常数。将这个 $\\mathbf{E}_{\\mathrm{loc}}$ 的表达式代入 $\\mathbf{P}$ 的方程中：\n$$\n\\mathbf{P} = N\\,\\alpha\\,\\left(\\mathbf{E} + \\frac{\\mathbf{P}}{3\\,\\epsilon_{0}}\\right)\n$$\n这个方程是关于极化强度 $\\mathbf{P}$ 的一个自洽关系式。我们可以解出 $\\mathbf{P}$ 关于宏观电场 $\\mathbf{E}$ 的表达式：\n$$\n\\mathbf{P} - \\frac{N\\,\\alpha}{3\\,\\epsilon_{0}}\\,\\mathbf{P} = N\\,\\alpha\\,\\mathbf{E}\n$$\n$$\n\\mathbf{P}\\,\\left(1 - \\frac{N\\,\\alpha}{3\\,\\epsilon_{0}}\\right) = N\\,\\alpha\\,\\mathbf{E}\n$$\n$$\n\\mathbf{P} = \\frac{N\\,\\alpha}{1 - \\frac{N\\,\\alpha}{3\\,\\epsilon_{0}}}\\,\\mathbf{E}\n$$\n宏观电极化率 $\\chi_e$ 由本构关系 $\\mathbf{P} = \\epsilon_{0}\\,\\chi_e\\,\\mathbf{E}$ 定义。将其与我们推导出的 $\\mathbf{P}$ 的表达式进行比较，我们可以确定修正模型的电极化率 $\\chi_{e, \\text{corr}}$：\n$$\n\\epsilon_{0}\\,\\chi_{e, \\text{corr}} = \\frac{N\\,\\alpha}{1 - N\\,\\alpha/(3\\,\\epsilon_{0})} \\implies \\chi_{e, \\text{corr}} = \\frac{N\\,\\alpha/\\epsilon_{0}}{1 - N\\,\\alpha/(3\\,\\epsilon_{0})}\n$$\n体相对介电常数与电极化率的关系为 $\\epsilon_r = 1 + \\chi_e$。因此，修正后的介电常数为：\n$$\n\\epsilon_{r, \\text{corr}} = 1 + \\chi_{e, \\text{corr}} = 1 + \\frac{N\\,\\alpha/\\epsilon_{0}}{1 - N\\,\\alpha/(3\\,\\epsilon_{0})}\n$$\n一个等效且更常见的形式是 Clausius-Mossotti 关系，它是通过先将宏观关系 $\\mathbf{P} = \\epsilon_0(\\epsilon_r - 1)\\mathbf{E}$ 代入局域电场表达式得到的。这给出 $\\mathbf{E}_{\\mathrm{loc}} = (\\frac{\\epsilon_r+2}{3})\\mathbf{E}$。将其代入 $\\mathbf{P} = N\\alpha\\mathbf{E}_{\\mathrm{loc}}$ 得到 $\\epsilon_0(\\epsilon_r-1)\\mathbf{E} = N\\alpha(\\frac{\\epsilon_r+2}{3})\\mathbf{E}$，简化后得到著名的形式：\n$$\n\\frac{\\epsilon_{r, \\text{corr}} - 1}{\\epsilon_{r, \\text{corr}} + 2} = \\frac{N\\,\\alpha}{3\\,\\epsilon_{0}}\n$$\n\n接下来，我们推导未修正的、朴素的平均场介电常数 $\\epsilon_{r, \\text{uncorr}}$。该模型通过忽略局域电场修正得到，这等价于设置 $\\mathbf{E}_{\\mathrm{loc}} = \\mathbf{E}$。\n在这种情况下，感生偶极矩就是 $\\mathbf{p} = \\alpha\\,\\mathbf{E}$。体极化强度变为：\n$$\n\\mathbf{P} = N\\,\\mathbf{p} = N\\,\\alpha\\,\\mathbf{E}\n$$\n将此直接与定义 $\\mathbf{P} = \\epsilon_{0}\\,\\chi_{e, \\text{uncorr}}\\,\\mathbf{E}$ 比较，我们得到未修正的电极化率：\n$$\n\\chi_{e, \\text{uncorr}} = \\frac{N\\,\\alpha}{\\epsilon_{0}}\n$$\n因此，未修正的相对介电常数为：\n$$\n\\epsilon_{r, \\text{uncorr}} = 1 + \\chi_{e, \\text{uncorr}} = 1 + \\frac{N\\,\\alpha}{\\epsilon_{0}}\n$$\n两种模型之间的对比现在很清楚了。朴素模型预测了 $(\\epsilon_r-1)$ 和数密度 $N$ 之间存在简单的线性关系，而 Clausius-Mossotti 关系则展示了一种更复杂的非线性依赖关系，它通过平均场局域电场修正考虑了偶极-偶极相互作用。修正模型预测了更强的介电响应，当项 $N\\alpha/(3\\epsilon_0)$ 接近 $1$ 时，可能导致发散（铁电灾变）。\n\n为了计算两种介电常数的比值，我们定义无量纲量 $Y = \\frac{N\\,\\alpha}{\\epsilon_{0}}$。\n用 $Y$ 表示，两种介电常数为：\n$$\n\\epsilon_{r, \\text{uncorr}} = 1 + Y\n$$\n$$\n\\epsilon_{r, \\text{corr}} = \\frac{1 + 2\\,Y/3}{1 - Y/3} = \\frac{3+2Y}{3-Y}\n$$\n所求的比值 $R$ 是：\n$$\nR = \\frac{\\epsilon_{r, \\text{corr}}}{\\epsilon_{r, \\text{uncorr}}} = \\frac{\\left(\\frac{3+2Y}{3-Y}\\right)}{1 + Y} = \\frac{3+2Y}{(1+Y)(3-Y)}\n$$\n现在我们必须使用所给数据计算 $Y$ 的数值。数密度 $N$ 没有直接给出，但可以从堆积分数 $\\phi$ 和硬球半径 $r$ 计算得出。堆积分数为 $\\phi = N\\,v_m$，其中 $v_m = \\frac{4}{3}\\pi r^3$ 是分子体积。\n$$\nN = \\frac{\\phi}{v_m} = \\frac{\\phi}{\\frac{4}{3}\\pi r^3} = \\frac{3\\phi}{4\\pi r^3}\n$$\n将此代入 $Y$ 的表达式中：\n$$\nY = \\frac{N\\,\\alpha}{\\epsilon_{0}} = \\left(\\frac{3\\phi}{4\\pi r^3}\\right)\\frac{\\alpha}{\\epsilon_{0}} = \\frac{3\\phi\\alpha}{4\\pi\\epsilon_0 r^3}\n$$\n提供的参数是：\n- 堆积分数 $\\phi = 0.40$\n- 静态分子极化率 $\\alpha = 1.00 \\times 10^{-40} \\, \\text{F m}^2$\n- 硬球半径 $r = 1.50 \\times 10^{-10} \\, \\text{m}$\n\n为了计算 $Y$，我们首先计算极化率体积 $\\alpha' = \\alpha/(4\\pi\\epsilon_0)$。其单位为 m$^3$，因为 $\\alpha$ 的单位为 F·m$^2$，而 $4\\pi\\epsilon_0$ 的单位为 F/m。利用真空介电常数 $\\epsilon_0 \\approx 8.854 \\times 10^{-12}$ F/m，我们得到：\n$$\n\\alpha' = \\frac{1.00 \\times 10^{-40} \\, \\text{F m}^2}{4\\pi (8.854 \\times 10^{-12} \\, \\text{F/m})} \\approx 8.98755 \\times 10^{-31} \\, \\text{m}^3\n$$\n现在我们计算 $Y$。首先是 $r^3$ 和 $N$：\n$$\nr^3 = (1.50 \\times 10^{-10} \\, \\text{m})^3 = 3.375 \\times 10^{-30} \\, \\text{m}^3\n$$\n$$\nN = \\frac{3 \\times 0.40}{4\\pi (1.50 \\times 10^{-10} \\, \\text{m})^3} = \\frac{1.2}{4\\pi \\times 3.375 \\times 10^{-30} \\, \\text{m}^3} \\approx 2.829 \\times 10^{28} \\, \\text{m}^{-3}\n$$\n然后计算 $Y$:\n$$\nY = \\frac{N\\alpha}{\\epsilon_0} = \\frac{(2.829 \\times 10^{28} \\, \\text{m}^{-3})(1.00 \\times 10^{-40} \\, \\text{F m}^2)}{8.854 \\times 10^{-12} \\, \\text{F/m}} \\approx 0.319557\n$$\n使用 $\\alpha'$ 的中间值可以简化计算：\n$$\nY = \\frac{3\\phi\\alpha'}{r^3} = \\frac{3 \\times 0.40 \\times (8.98755 \\times 10^{-31} \\, \\text{m}^3)}{3.375 \\times 10^{-30} \\, \\text{m}^3} = \\frac{1.078506 \\times 10^{-30}}{3.375 \\times 10^{-30}} \\approx 0.319557\n$$\n最后，我们计算比值 $R$：\n$$\nR = \\frac{3 + 2Y}{(1+Y)(3-Y)} = \\frac{3 + 2(0.319557)}{(1+0.319557)(3-0.319557)} = \\frac{3 + 0.639114}{1.319557 \\times 2.680443} = \\frac{3.639114}{3.536955} \\approx 1.02888\n$$\n将结果按要求四舍五入到四位有效数字，得到 $1.029$。",
            "answer": "$$\\boxed{1.029}$$"
        },
        {
            "introduction": "经典的局域场概念在固体的量子理论中有更严谨的对应。本练习  引入了微观介电矩阵 $\\boldsymbol{\\epsilon}_{\\mathbf{G}\\mathbf{G}'}$，其非对角元代表了耦合不同平面波分量的局域场效应。通过对一个简化的介电矩阵进行求逆，您将解析地推导出这些微观场变化如何产生一个不同于简单平均场近似的宏观介电函数。",
            "id": "3801730",
            "problem": "考虑一个处于长波光学极限下的周期性绝缘晶体，其中微扰场的晶格动量 $\\mathbf{q}$ 满足 $|\\mathbf{q}|\\to 0$。在线性响应理论 (LRT) 和随机相位近似 (RPA) 的框架内，材料对外部标量势的微观介电响应由倒易晶格空间中依赖于频率的介电矩阵 $\\boldsymbol{\\epsilon}(\\mathbf{q},\\omega)$ 编码。在一种捕捉局域场效应的简化多尺度处理方法中，我们将倒易晶格基截断为两个通道 $\\mathbf{G}=\\mathbf{0}$ 和 $\\mathbf{G}=\\mathbf{G}_{1}$，因此 $\\boldsymbol{\\epsilon}(\\mathbf{q},\\omega)$ 是在集合 $\\{\\mathbf{0},\\mathbf{G}_{1}\\}$ 上的一个 $2\\times 2$ 矩阵。\n\n假设在光学极限下，对于固定的 $\\mathbf{q}$，介电矩阵元具有以下具有物理动机的模型：\n$$\n\\boldsymbol{\\epsilon}(\\mathbf{q},\\omega)=\n\\begin{pmatrix}\n\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega)  \\epsilon_{\\mathbf{0}\\mathbf{G}_{1}}(\\omega) \\\\\n\\epsilon_{\\mathbf{G}_{1}\\mathbf{0}}(\\omega)  \\epsilon_{\\mathbf{G}_{1}\\mathbf{G}_{1}}(\\omega)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1-\\alpha\\,p(\\omega)  -\\gamma\\,p(\\omega) \\\\\n-\\gamma\\,p(\\omega)  1-\\beta\\,p(\\omega)\n\\end{pmatrix},\n$$\n其中 $p(\\omega)$ 是一个实值标量函数，表示在频率 $\\omega$ 下投影到截断基上的单粒子极化率，而 $\\alpha$、$\\beta$ 和 $\\gamma$ 分别是编码头、体和翼耦合的库仑加权屏蔽强度的正的、无关频率的无量纲参数。该模型与戴森方程结构一致，并在非磁性晶体中保持了 $\\mathbf{G}=\\mathbf{0}$ 和 $\\mathbf{G}=\\mathbf{G}_{1}$ 翼之间的对称性。\n\n宏观光学响应由外部微扰与平均微观场之间的关系决定；忽略局域场效应对应于仅使用头元素 $\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega)$，而恰当考虑局域场效应则需要使用逆介电矩阵 $\\boldsymbol{\\epsilon}^{-1}(\\mathbf{q},\\omega)$。\n\n定义局域场影响度量\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) \\equiv \\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) - \\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega),\n$$\n其中 $\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega)$ 表示在截断模型中通过逆介电矩阵包含局域场效应所得到的宏观介电响应。从 LRT 的基本定义和上面给出的矩阵结构出发，推导 $\\Delta_{\\mathrm{LF}}(\\omega)$ 关于 $\\alpha$、$\\beta$、$\\gamma$ 和 $p(\\omega)$ 的闭合形式解析表达式。\n\n将您的最终答案表示为单个解析表达式。不需要进行数值计算或四舍五入，并且由于 $\\Delta_{\\mathrm{LF}}(\\omega)$ 是无量纲的，所以不涉及单位。",
            "solution": "该问题在固态物理的标准理论框架内提出了一个有效且适定的问题。它在科学上是合理的、自洽的，并要求基于线性响应理论的既定原理进行严格推导。所有提供的定义和参数在介电性质的多尺度建模背景下都是标准的。\n\n目标是推导局域场影响度量 $\\Delta_{\\mathrm{LF}}(\\omega)$ 的解析表达式，其定义为：\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) \\equiv \\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) - \\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega)\n$$\n此处，$\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega)$ 是介电矩阵的头元素，表示不考虑局域场效应的响应。$\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega)$ 是包含了局域场效应的宏观介电函数。\n\n在线性响应理论中，宏观介电函数是通过考虑对纯宏观外部势的总响应，从微观介电矩阵 $\\boldsymbol{\\epsilon}(\\mathbf{q},\\omega)$ 中获得的。这对应于对整个介电矩阵求逆，并取其头-头（$\\mathbf{G}=\\mathbf{0}$, $\\mathbf{G}'=\\mathbf{0}$）元素的逆。在长波极限（$|\\mathbf{q}| \\to 0$）下，定义为：\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\frac{1}{\\left[\\boldsymbol{\\epsilon}^{-1}(\\omega)\\right]_{\\mathbf{0}\\mathbf{0}}}\n$$\n问题给出了介电矩阵 $\\boldsymbol{\\epsilon}(\\omega)$ 的 $2 \\times 2$ 模型：\n$$\n\\boldsymbol{\\epsilon}(\\omega) =\n\\begin{pmatrix}\n1-\\alpha\\,p(\\omega)  -\\gamma\\,p(\\omega) \\\\\n-\\gamma\\,p(\\omega)  1-\\beta\\,p(\\omega)\n\\end{pmatrix}\n$$\n我们的第一步是计算这个矩阵的逆。对于一个通用的 $2 \\times 2$ 矩阵 $\\mathbf{A} = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$，其逆由 $\\mathbf{A}^{-1} = \\frac{1}{ad-bc} \\begin{pmatrix} d  -b \\\\ -c  a \\end{pmatrix}$ 给出。\n\n首先，我们计算 $\\boldsymbol{\\epsilon}(\\omega)$ 的行列式：\n$$\n\\det(\\boldsymbol{\\epsilon}(\\omega)) = \\big(1-\\alpha\\,p(\\omega)\\big)\\big(1-\\beta\\,p(\\omega)\\big) - \\big(-\\gamma\\,p(\\omega)\\big)\\big(-\\gamma\\,p(\\omega)\\big)\n$$\n展开各项得到：\n$$\n\\det(\\boldsymbol{\\epsilon}(\\omega)) = 1 - \\alpha\\,p(\\omega) - \\beta\\,p(\\omega) + \\alpha\\beta\\,\\left[p(\\omega)\\right]^2 - \\gamma^2\\,\\left[p(\\omega)\\right]^2\n$$\n$$\n\\det(\\boldsymbol{\\epsilon}(\\omega)) = 1 - (\\alpha + \\beta)\\,p(\\omega) + (\\alpha\\beta - \\gamma^2)\\,\\left[p(\\omega)\\right]^2\n$$\n现在，我们可以写出逆矩阵 $\\boldsymbol{\\epsilon}^{-1}(\\omega)$：\n$$\n\\boldsymbol{\\epsilon}^{-1}(\\omega) = \\frac{1}{\\det(\\boldsymbol{\\epsilon}(\\omega))}\n\\begin{pmatrix}\n1-\\beta\\,p(\\omega)  \\gamma\\,p(\\omega) \\\\\n\\gamma\\,p(\\omega)  1-\\alpha\\,p(\\omega)\n\\end{pmatrix}\n$$\n由此，我们确定头-头元素，即 $(\\mathbf{0},\\mathbf{0})$ 分量：\n$$\n\\left[\\boldsymbol{\\epsilon}^{-1}(\\omega)\\right]_{\\mathbf{0}\\mathbf{0}} = \\frac{1-\\beta\\,p(\\omega)}{\\det(\\boldsymbol{\\epsilon}(\\omega))} = \\frac{1-\\beta\\,p(\\omega)}{1 - (\\alpha + \\beta)\\,p(\\omega) + (\\alpha\\beta - \\gamma^2)\\,\\left[p(\\omega)\\right]^2}\n$$\n使用宏观介电函数的定义，我们得到 $\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega)$：\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\frac{1}{\\left[\\boldsymbol{\\epsilon}^{-1}(\\omega)\\right]_{\\mathbf{0}\\mathbf{0}}} = \\frac{1 - (\\alpha + \\beta)\\,p(\\omega) + (\\alpha\\beta - \\gamma^2)\\,\\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\n现在我们可以计算局域场影响度量 $\\Delta_{\\mathrm{LF}}(\\omega)$。我们已知 $\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega) = 1-\\alpha\\,p(\\omega)$。\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) = \\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) - \\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega) = \\frac{1 - (\\alpha + \\beta)\\,p(\\omega) + (\\alpha\\beta - \\gamma^2)\\,\\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)} - \\big(1-\\alpha\\,p(\\omega)\\big)\n$$\n为简化起见，我们可以通过代入行列式的定义来重写 $\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega)$ 的表达式：\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\frac{\\big(1-\\alpha p(\\omega)\\big)\\big(1-\\beta p(\\omega)\\big) - \\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\frac{\\big(1-\\alpha p(\\omega)\\big)\\big(1-\\beta p(\\omega)\\big)}{1-\\beta\\,p(\\omega)} - \\frac{\\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\big(1-\\alpha p(\\omega)\\big) - \\frac{\\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\n认识到 $\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega) = 1-\\alpha\\,p(\\omega)$，我们将其代回 $\\Delta_{\\mathrm{LF}}(\\omega)$ 的定义中：\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) = \\left( \\big(1-\\alpha p(\\omega)\\big) - \\frac{\\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)} \\right) - \\big(1-\\alpha\\,p(\\omega)\\big)\n$$\n$1-\\alpha\\,p(\\omega)$ 项相互抵消，剩下最终的表达式：\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) = -\\frac{\\gamma^2\\,\\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\n这个结果表明，局域场修正是由非对角耦合 $\\gamma$ 驱动的，在系统的极化率 $p(\\omega)$ 上是二阶的，并被非宏观通道中的响应所屏蔽，这体现在 $1-\\beta p(\\omega)$ 这一项中。",
            "answer": "$$\n\\boxed{-\\frac{\\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta p(\\omega)}}\n$$"
        },
        {
            "introduction": "本练习  将理论与实际模拟相结合，要求您从第一性原理出发，通过编程来构建微观介电矩阵。您将实现用于描述电子气响应的林哈德函数（Lindhard function），并加入一个微扰性的局域场耦合项，这与真实计算代码的结构相呼应。通过评估宏观介电常数相对于平面波基组截断的收敛性，您将获得材料模拟中一项关键验证步骤的动手经验。",
            "id": "3801733",
            "problem": "考虑一个在简单立方晶格上的周期性、弱非均匀电子系统，采用 Hartree 原子单位制（电子质量 $m=1$，约化普朗克常数 $\\hbar=1$，电子电荷平方 $e^2=1$）进行建模。设晶格常数为 $a$，基本倒易晶格矢量为 $\\mathbf{G}_0 = \\frac{2\\pi}{a}\\hat{\\mathbf{x}}$。在线性响应理论中，倒易空间中的微观介电矩阵由以倒易矢量 $\\mathbf{G}$ 和 $\\mathbf{G}'$ 为索引的平面波分量定义。微观介电矩阵依赖于波矢 $\\mathbf{q}$ 和频率 $\\omega$。在本问题中，我们关注静态极限 $\\omega=0$，并使用一个截断的倒易晶格矢量集合（$|\\mathbf{G}| \\leq G_{\\mathrm{max}}$）来构建平面波展开的微观介电矩阵 $\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$，并评估其相对于截断值 $G_{\\mathrm{max}}$ 的收敛性。\n\n使用以下与上下文相关的基本基础：\n\n- 线性响应理论通过密度-密度响应函数（极化率）$\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},\\omega)$ 将感应密度与外部扰动关联起来。\n- 均匀电子气中的独立粒子（无相互作用）极化率在三维静态极限下有经过充分检验的形式（即 Lindhard 函数）。用 $k_{\\mathrm{F}}$ 表示费米波矢，用 $\\chi_0(k,0)$ 表示静态无相互作用极化率，它是波矢大小 $k$ 的函数。\n- 倒易空间中的库仑相互作用由核函数 $v(k) = \\frac{4\\pi}{k^2}$ 表示。\n\n为了模拟由弱周期性非均匀性引起的局域场效应，考虑由势的正弦调制 $V(\\mathbf{r}) = V_0 \\cos(\\mathbf{G}_0 \\cdot \\mathbf{r})$ 引起的一阶微扰。设 $\\alpha$ 是一个与 $V_0$ 成正比的无量纲小参数，用于表征局域场耦合的强度。在平面波基下，这种调制会耦合相差 $\\pm \\mathbf{G}_0$ 的 $\\mathbf{G}$ 分量。构建一个微扰模型极化率 $\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$，使其包括：\n- 与 $\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0)$ 成正比的对角均匀气贡献。\n- 在 $\\mathbf{G}'$ 和 $\\mathbf{G}'\\pm \\mathbf{G}_0$ 之间的一阶非对角耦合，由 $\\alpha$ 缩放，并在大小 $|\\mathbf{q}+\\mathbf{G}|$ 和 $|\\mathbf{q}+\\mathbf{G}'|$ 上对称化。\n\n然后，使用库仑核函数和上面构建的模型 $\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$ 形成微观介电矩阵。从该微观矩阵中，通过适当处理 $\\mathbf{G}=\\mathbf{0}$ 分量，计算出与线性响应理论一致的宏观介电响应。使用一系列截断值，评估此宏观介电量相对于增大的 $G_{\\mathrm{max}}$ 的收敛性。\n\n所有量都必须在 Hartree 原子单位制下作为无量纲量处理。不涉及角度。您的程序必须：\n\n1. 生成倒易矢量 $\\mathbf{G} = h\\mathbf{G}_0 + k\\frac{2\\pi}{a}\\hat{\\mathbf{y}} + \\ell\\frac{2\\pi}{a}\\hat{\\mathbf{z}}$ 的平面波基，其中 $h,k,\\ell$ 是整数，满足 $|\\mathbf{G}| \\leq G_{\\mathrm{max}}$。\n2. 按照描述构建模型 $\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$，使用静态 Lindhard 函数 $\\chi_0(k,0)$ 作为均匀分量。\n3. 在平面波基中组装微观介电矩阵 $\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$。\n4. 以数学上一致的方式从微观矩阵中提取宏观介电量。\n5. 对于一系列递增的截断值 $G_{\\mathrm{max}}$，计算最后两个连续截断值之间的宏观介电量的变化，作为收敛性的度量。将此变化报告为一个非负实数。\n\n实现零温下均匀电子气的三维静态 Lindhard 函数，以 Hartree 原子单位制表示，为 $k = |\\mathbf{k}|$ 和 $k_{\\mathrm{F}}$ 的函数：\n$$\n\\chi_0(k,0) = -\\frac{k_{\\mathrm{F}}}{\\pi^2}\\left[1 + \\frac{1 - x^2}{2x}\\ln\\left|\\frac{1+x}{1-x}\\right|\\right], \\quad x = \\frac{k}{2k_{\\mathrm{F}}}.\n$$\n对于所有 $k \\geq 0$，此表达式均为实数。\n\n按如下方式定义极化率的微扰局域场模型。对于由整数 $(h,k,\\ell)$ 和 $(h',k',\\ell')$ 索引的倒易矢量：\n- 对角均匀贡献：\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}^{(0)}(\\mathbf{q},0) = \\delta_{\\mathbf{G}\\mathbf{G}'}\\,\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0).\n$$\n- 仅连接 $\\mathbf{G}'$ 与 $\\mathbf{G}'\\pm \\mathbf{G}_0$ 的一阶局域场耦合（即，$h = h'\\pm 1$ 且 $k=k'$ 和 $\\ell=\\ell'$）：\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}^{\\mathrm{LF}}(\\mathbf{q},0) = \\frac{\\alpha}{2}\\left[\\delta_{h,h'+1}\\delta_{k,k'}\\delta_{\\ell,\\ell'} + \\delta_{h,h'-1}\\delta_{k,k'}\\delta_{\\ell,\\ell'}\\right]\\left(\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0) + \\chi_0(|\\mathbf{q}+\\mathbf{G}'|,0)\\right).\n$$\n- 总模型：\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0) = \\chi_{\\mathbf{G}\\mathbf{G}'}^{(0)}(\\mathbf{q},0) + \\chi_{\\mathbf{G}\\mathbf{G}'}^{\\mathrm{LF}}(\\mathbf{q},0).\n$$\n\n使用库仑核函数形成微观介电矩阵：\n$$\n\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0) = \\delta_{\\mathbf{G}\\mathbf{G}'} - v(|\\mathbf{q}+\\mathbf{G}|)\\,\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0), \\quad v(k) = \\frac{4\\pi}{k^2}.\n$$\n\n从微观介电矩阵中，通过一种与线性响应理论一致并考虑局域场效应的操作，使用 $\\mathbf{G}=\\mathbf{0}$ 分量提取宏观介电量。\n\n测试套件和输出规范：\n\n使用以下三个测试用例，每个用例都使用截断值序列 $G_{\\mathrm{max}} \\in \\{|\\mathbf{G}_0|, 2|\\mathbf{G}_0|, 3|\\mathbf{G}_0|\\}$ 进行处理，并为每个用例报告在 $G_{\\mathrm{max}}=2|\\mathbf{G}_0|$ 和 $G_{\\mathrm{max}}=3|\\mathbf{G}_0|$ 之间宏观介电量的绝对变化，作为一个实数：\n\n- 情况 1（一般情况）：$a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.2$, $\\mathbf{q}=0.4\\,\\mathbf{G}_0$。\n- 情况 2（无局域场效应的边界情况）：$a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.0$, $\\mathbf{q}=0.4\\,\\mathbf{G}_0$。\n- 情况 3（接近 Bragg 条件的边缘情况）：$a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.3$, $\\mathbf{q}=0.95\\,\\mathbf{G}_0$。\n\n所有量在 Hartree 原子单位制下都是无量纲的。您的程序应生成单行输出，其中包含三个结果，格式为逗号分隔的列表并用方括号括起来（例如，`[result1,result2,result3]`）。",
            "solution": "我们从线性响应理论开始，其中弱外部扰动引起的电子密度变化通过密度-密度响应函数（极化率）与扰动势相关联。对于周期性系统，在倒易空间中，所有场都以倒易晶格矢量为索引展开为平面波。微观介电矩阵 $\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},\\omega)$ 连接总场和外场的傅里叶分量，体现了在晶胞尺度上的屏蔽和局域场效应。\n\n在平面波基中构建介电矩阵需要以下基本要素：\n\n1. 零温下三维均匀电子气的独立粒子密度响应函数是静态极限下的 Lindhard 函数，记为 $\\chi_0(k,0)$。在 Hartree 原子单位制中，其表达式为\n$$\n\\chi_0(k,0) = -\\frac{k_{\\mathrm{F}}}{\\pi^2}\\left[1 + \\frac{1 - x^2}{2x}\\ln\\left|\\frac{1+x}{1-x}\\right|\\right],\\quad x=\\frac{k}{2k_{\\mathrm{F}}},\n$$\n其中 $k_{\\mathrm{F}}$ 是费米波矢。该函数描述了均匀电子气对波矢大小为 $k$ 的静态扰动的响应，并在 $k=2k_{\\mathrm{F}}$ 处表现出典型的非解析行为。\n\n2. 倒易空间中的库仑相互作用在平面波基下是对角的，由核函数 $v(k)=\\frac{4\\pi}{k^2}$ 给出，其中 $k=|\\mathbf{k}|$ 是波矢的大小。\n\n3. 在一个周期性的、弱非均匀系统中，即使对于给定的宏观波矢 $\\mathbf{q}$，不同倒易晶格矢量上的感应密度傅里叶分量之间也会相互耦合，从而产生局域场效应。对于正弦调制 $V(\\mathbf{r})=V_0\\cos(\\mathbf{G}_0\\cdot\\mathbf{r})$，在一阶微扰理论中，索引相差 $\\pm \\mathbf{G}_0$ 的平面波分量会耦合。我们通过引入一个与 $V_0$ 成正比的无量纲小参数 $\\alpha$ 来对此建模，并构建一个微扰极化率：\n- 对角均匀气贡献\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}^{(0)}(\\mathbf{q},0) = \\delta_{\\mathbf{G}\\mathbf{G}'}\\,\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0).\n$$\n- 非对角一阶局域场耦合\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}^{\\mathrm{LF}}(\\mathbf{q},0) = \\frac{\\alpha}{2}\\left[\\delta_{h,h'+1}\\delta_{k,k'}\\delta_{\\ell,\\ell'} + \\delta_{h,h'-1}\\delta_{k,k'}\\delta_{\\ell,\\ell'}\\right]\\left(\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0) + \\chi_0(|\\mathbf{q}+\\mathbf{G}'|,0)\\right),\n$$\n其中 $\\mathbf{G} = h\\mathbf{G}_0 + k\\frac{2\\pi}{a}\\hat{\\mathbf{y}} + \\ell\\frac{2\\pi}{a}\\hat{\\mathbf{z}}$ 和 $\\mathbf{G}' = h'\\mathbf{G}_0 + k'\\frac{2\\pi}{a}\\hat{\\mathbf{y}} + \\ell'\\frac{2\\pi}{a}\\hat{\\mathbf{z}}$ 分别由整数 $(h,k,\\ell)$ 和 $(h',k',\\ell')$ 索引。此形式捕获了沿 $\\mathbf{G}_0$ 方向相邻倒易晶格矢量之间的主导阶混合，并对称化了耦合以在静态极限下保持厄米性。\n\n总的模型极化率则为\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0) = \\chi_{\\mathbf{G}\\mathbf{G}'}^{(0)}(\\mathbf{q},0) + \\chi_{\\mathbf{G}\\mathbf{G}'}^{\\mathrm{LF}}(\\mathbf{q},0).\n$$\n\n4. 在独立粒子随机相近似（RPA）下，平面波基中的微观介电矩阵通过将库仑核函数与极化率结合而形成：\n$$\n\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0) = \\delta_{\\mathbf{G}\\mathbf{G}'} - v(|\\mathbf{q}+\\mathbf{G}|)\\,\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0),\\quad v(k)=\\frac{4\\pi}{k^2}.\n$$\n这种结构反映了库仑核函数将响应函数的行乘以一个依赖于入射波矢 $\\mathbf{q}+\\mathbf{G}$ 的因子。\n\n5. 对于给定的 $\\mathbf{q}$，宏观介电响应是通过适当考虑局域场效应并提取 $\\mathbf{G}=\\mathbf{0}$ 分量的屏蔽来获得的。在周期性系统的线性响应理论中，与局域场效应一致的宏观介电函数由下式给出\n$$\n\\epsilon_{\\mathrm{M}}(\\mathbf{q},0) = \\frac{1}{\\left[\\epsilon^{-1}(\\mathbf{q},0)\\right]_{\\mathbf{0}\\mathbf{0}}},\n$$\n其中 $\\left[\\epsilon^{-1}(\\mathbf{q},0)\\right]_{\\mathbf{0}\\mathbf{0}}$ 是逆微观介电矩阵的 $\\mathbf{G}=\\mathbf{G}'=\\mathbf{0}$ 元。在没有局域场耦合的情况下，该定义简化为标准的均匀情况结果，并在存在微观混合时将其包含在内。\n\n与上述原理一致的算法步骤：\n\n- 通过枚举整数三元组 $(h,k,\\ell)$ 来生成平面波基，使得大小 $|\\mathbf{G}|$ 小于或等于 $G_{\\mathrm{max}}$。对于晶格常数为 $a$ 的简单立方晶格，我们有\n$$\n\\mathbf{G} = \\frac{2\\pi}{a}(h,k,\\ell),\\quad |\\mathbf{G}| = \\frac{2\\pi}{a}\\sqrt{h^2 + k^2 + \\ell^2}.\n$$\n- 对于沿 $\\hat{\\mathbf{x}}$ 方向、大小为 $q$ 的给定 $\\mathbf{q}$，为每个基矢量 $\\mathbf{G}_i$ 计算 $k_i = |\\mathbf{q}+\\mathbf{G}_i|$。\n- 使用 $\\chi_0(k,0)$ 作为对角元，并使用上面给出的局域场耦合形式作为仅在 $h$ 方向上相差 $\\pm 1$ 的整数索引之间的非对角元（其中 $k,k'$ 和 $\\ell,\\ell'$ 相等），来组装极化率矩阵 $\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$。\n- 通过下式形成微观介电矩阵\n$$\n\\epsilon_{ij} = \\delta_{ij} - v(k_i)\\,\\chi_{ij},\\quad v(k_i) = \\frac{4\\pi}{k_i^2}.\n$$\n- 对 $\\epsilon$ 进行数值求逆，并通过下式提取宏观介电常数\n$$\n\\epsilon_{\\mathrm{M}} = \\frac{1}{\\left(\\epsilon^{-1}\\right)_{i_0,i_0}},\n$$\n其中 $i_0$ 是基中 $(h,k,\\ell)=(0,0,0)$ 的索引。\n- 对于截断值序列 $G_{\\mathrm{max}} \\in \\{|\\mathbf{G}_0|,2|\\mathbf{G}_0|,3|\\mathbf{G}_0|\\}$，计算每个截断值下的 $\\epsilon_{\\mathrm{M}}$，并报告最后两个截断值之间的绝对变化，即\n$$\n\\Delta = \\left|\\epsilon_{\\mathrm{M}}(G_{\\mathrm{max}}=3|\\mathbf{G}_0|) - \\epsilon_{\\mathrm{M}}(G_{\\mathrm{max}}=2|\\mathbf{G}_0|)\\right|.\n$$\n\n测试用例：\n\n- 情况 1：$a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.2$, $\\mathbf{q}=0.4\\,\\mathbf{G}_0$。这测试了具有非零 $\\mathbf{q}$ 的中等局域场强度。\n- 情况 2：$a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.0$, $\\mathbf{q}=0.4\\,\\mathbf{G}_0$。当 $\\alpha=0$ 时，没有非对角耦合；收敛应该很快，并且在数值精度范围内，变化理想情况下为零。\n- 情况 3：$a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.3$, $\\mathbf{q}=0.95\\,\\mathbf{G}_0$。在接近类 Bragg 条件时，由于相邻 $h$ 索引之间的耦合增强，局域场效应更强，这用于测试较慢的收敛性。\n\n程序实现了这些步骤，为每个情况计算 $\\Delta$，并将三个结果作为单个逗号分隔的列表打印在方括号中。所有量在 Hartree 原子单位制下都是无量纲的，并且静态极限确保了输出为实数值。通过不选择能精确抵消任何 $\\mathbf{G}$ 以产生 $|\\mathbf{q}+\\mathbf{G}|=0$ 的 $\\mathbf{q}$，数值保护措施避免了除以零；所选的测试参数满足此条件。",
            "answer": "```python\nimport numpy as np\n\n# Hartree atomic units throughout (dimensionless).\n# Implement static 3D Lindhard function chi0(k, 0) at T=0.\ndef chi0_static(k, kF):\n    # Avoid division by zero in x near zero\n    x = k / (2.0 * kF)\n    # Handle x=0 separately: limit x->0 gives chi0 = -(kF/pi^2) * (1 + 1) = -(2 kF / pi^2)\n    if np.isclose(x, 0.0):\n        return -(2.0 * kF) / (np.pi**2)\n    # Use the standard static expression\n    # For numerical stability, clip arguments of log away from 1\n    # But the expression with absolute value is real-valued for all k >= 0\n    num = 1.0 + x\n    den = 1.0 - x\n    # To avoid log(0), add a tiny epsilon if needed\n    eps = 1e-12\n    den_adj = den if not np.isclose(den, 0.0) else (eps if den >= 0.0 else -eps)\n    val = -(kF / (np.pi**2)) * (1.0 + ((1.0 - x**2) / (2.0 * x)) * np.log(np.abs(num / den_adj)))\n    return val\n\n# Generate reciprocal lattice vectors G = (2*pi/a) * (h, k, l) within |G| = Gmax\ndef generate_G_vectors(a, Gmax):\n    g0 = 2.0 * np.pi / a\n    # Max integer such that g0 * |h,k,l| = Gmax, so |h|,|k|,|l| = Gmax/g0\n    H = int(np.floor(Gmax / g0))  # upper bound for |h|,|k|,|l|\n    G_list = []\n    idx_list = []\n    for h in range(-H, H + 1):\n        for k in range(-H, H + 1):\n            for l in range(-H, H + 1):\n                G_vec = g0 * np.array([h, k, l], dtype=float)\n                if np.linalg.norm(G_vec) = Gmax + 1e-12:\n                    G_list.append(G_vec)\n                    idx_list.append((h, k, l))\n    # Ensure sorted order with (h,k,l) to make index deterministic\n    order = np.argsort(\n        [abs(h) + abs(k) + abs(l) + 0.1 * np.linalg.norm(g0 * np.array([h, k, l])) for (h, k, l) in idx_list]\n    )\n    G_sorted = [G_list[i] for i in order]\n    idx_sorted = [idx_list[i] for i in order]\n    # Map from index triple to position\n    idx_map = {idx_sorted[i]: i for i in range(len(idx_sorted))}\n    return np.array(G_sorted), idx_sorted, idx_map\n\n# Build polarizability matrix chi_GG'(q, 0) with local-field coupling parameter alpha\ndef build_chi_matrix(a, q_vec, G_vectors, idx_tuples, kF, alpha):\n    N = len(G_vectors)\n    chi = np.zeros((N, N), dtype=float)\n    # Precompute k magnitudes and chi0 on diagonals\n    k_mags = np.linalg.norm(G_vectors + q_vec, axis=1)\n    chi0_vals = np.array([chi0_static(k, kF) for k in k_mags])\n    # Diagonal\n    for i in range(N):\n        chi[i, i] = chi0_vals[i]\n    # Local-field couplings: only between h and h±1 with same k,l\n    # Symmetrized by average of chi0 at (i) and (j)\n    # Map from (h,k,l) to position\n    idx_map = {idx_tuples[i]: i for i in range(N)}\n    for j in range(N):\n        h, k, l = idx_tuples[j]\n        for dh in (-1, 1):\n            neighbor = (h + dh, k, l)\n            if neighbor in idx_map:\n                i = idx_map[neighbor]\n                chi[i, j] += 0.5 * alpha * (chi0_vals[i] + chi0_vals[j])\n    return chi, k_mags\n\n# Build microscopic dielectric matrix epsilon = I - V * chi, with V diagonal in incoming index i\ndef build_epsilon_matrix(chi, k_mags):\n    N = chi.shape[0]\n    epsilon = np.eye(N, dtype=float)\n    # Coulomb kernel v(k) = 4*pi / k^2\n    # Avoid division by zero by ensuring k_mags > 0 via problem setup\n    v_diag = 4.0 * np.pi / (k_mags**2)\n    for i in range(N):\n        epsilon[i, :] -= v_diag[i] * chi[i, :]\n    return epsilon\n\n# Compute macroscopic dielectric epsilon_M = 1 / (epsilon^{-1})_{00}\ndef compute_macroscopic_epsilon(epsilon, idx_tuples):\n    # Find index of G=(0,0,0)\n    if (0, 0, 0) not in {t for t in idx_tuples}:\n        raise RuntimeError(\"Basis does not include G=(0,0,0). Increase cutoff.\")\n    i0 = idx_tuples.index((0, 0, 0))\n    eps_inv = np.linalg.inv(epsilon)\n    epsM = 1.0 / eps_inv[i0, i0]\n    return float(epsM)\n\n# Evaluate convergence: difference between epsM at last two cutoffs\ndef evaluate_convergence(a, kF, alpha, q_ratio):\n    g0_mag = 2.0 * np.pi / a\n    q_vec = np.array([q_ratio * g0_mag, 0.0, 0.0], dtype=float)\n    cutoffs = [g0_mag, 2.0 * g0_mag, 3.0 * g0_mag]\n    epsM_values = []\n    for Gmax in cutoffs:\n        G_vectors, idx_tuples, idx_map = generate_G_vectors(a, Gmax)\n        chi, k_mags = build_chi_matrix(a, q_vec, G_vectors, idx_tuples, kF, alpha)\n        epsilon = build_epsilon_matrix(chi, k_mags)\n        epsM = compute_macroscopic_epsilon(epsilon, idx_tuples)\n        epsM_values.append(epsM)\n    # Return absolute change between last two\n    return abs(epsM_values[-1] - epsM_values[-2])\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Parameters: a, kF, alpha, q_ratio (q = q_ratio * |G0|)\n    test_cases = [\n        (10.0, 1.0, 0.2, 0.4),   # Case 1: general case\n        (10.0, 1.0, 0.0, 0.4),   # Case 2: boundary case (no LF)\n        (10.0, 1.0, 0.3, 0.95),  # Case 3: edge case near Bragg\n    ]\n\n    results = []\n    for a, kF, alpha, q_ratio in test_cases:\n        delta = evaluate_convergence(a, kF, alpha, q_ratio)\n        results.append(delta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}