{
    "hands_on_practices": [
        {
            "introduction": "We begin our exploration of the dynamic structure factor, $S(q, \\omega)$, in a conceptually clear physical regime: the high wavevector limit. In this limit, the scattering probe resolves motion on very short length and time scales, effectively capturing the instantaneous velocity of individual particles. This exercise demonstrates how this \"impulse approximation\" directly connects the spectral shape of $S(q, \\omega)$ to the underlying Maxwell-Boltzmann velocity distribution of the particles, resulting in a Gaussian profile whose width reflects thermal Doppler broadening.",
            "id": "3794892",
            "problem": "Consider a dilute, monoatomic classical gas in equilibrium at temperature $T$ (in $\\mathrm{K}$), composed of particles of mass $m$ (in $\\mathrm{kg}$). Let $\\mathbf{q}$ be a scattering wavevector of magnitude $q$ (in $\\mathrm{m}^{-1}$), and let $\\omega$ be an angular frequency (in $\\mathrm{rad}\\,\\mathrm{s}^{-1}$). The dynamic structure factor $S(q,\\omega)$ is defined as the time-Fourier transform of the intermediate scattering function, which itself is based on the density–density correlation in the system. In the high-$q$ limit, the impulse approximation is applicable: the scattering event is sufficiently brief that particle motion is effectively ballistic over the scattering time, and interactions during the event can be neglected. Use the following foundational bases:\n\n- The intermediate scattering function $F(q,t)$ is defined from the density field as an ensemble average of phase factors over classical trajectories, and the dynamic structure factor $S(q,\\omega)$ is the time-Fourier transform of $F(q,t)$ with angular frequency $\\omega$.\n- For a dilute gas in equilibrium, particle velocities are distributed according to the Maxwell–Boltzmann distribution, which is isotropic and depends on the mass $m$ and temperature $T$ through the Boltzmann constant $k_{\\mathrm{B}}$.\n\nStarting from these bases, and working within the classical high-$q$ impulse approximation regime, derive an expression for $S(q,\\omega)$ in terms of $q$, $\\omega$, $m$, $T$, and $k_{\\mathrm{B}}$. Your derivation must proceed from first principles without assuming any closed-form expression for $S(q,\\omega)$.\n\nOnce you have derived the expression, implement a program that, for each test case below, evaluates $S(q,\\omega)$ numerically. Use the Boltzmann constant $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\,\\mathrm{J}\\,\\mathrm{K}^{-1}$. The program must treat all quantities in the International System of Units, with $\\omega$ in $\\mathrm{rad}\\,\\mathrm{s}^{-1}$, $q$ in $\\mathrm{m}^{-1}$, $m$ in $\\mathrm{kg}$, $T$ in $\\mathrm{K}$, and must output $S(q,\\omega)$ in $\\mathrm{s}$. You must produce numerical results for the following test suite:\n\n- Case $1$ (happy path): $m = 6.63 \\times 10^{-26}\\,\\mathrm{kg}$, $T = 3.00 \\times 10^{2}\\,\\mathrm{K}$, $q = 8.00 \\times 10^{10}\\,\\mathrm{m}^{-1}$, $\\omega = 0.00\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$.\n- Case $2$ (frequency tail): $m = 6.63 \\times 10^{-26}\\,\\mathrm{kg}$, $T = 3.00 \\times 10^{2}\\,\\mathrm{K}$, $q = 8.00 \\times 10^{10}\\,\\mathrm{m}^{-1}$, $\\omega = 1.00 \\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$.\n- Case $3$ (low-$q$ boundary check): $m = 6.63 \\times 10^{-26}\\,\\mathrm{kg}$, $T = 3.00 \\times 10^{2}\\,\\mathrm{K}$, $q = 1.00 \\times 10^{8}\\,\\mathrm{m}^{-1}$, $\\omega = 1.00 \\times 10^{9}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$.\n- Case $4$ (heavy and cold gas): $m = 1.00 \\times 10^{-25}\\,\\mathrm{kg}$, $T = 5.00 \\times 10^{1}\\,\\mathrm{K}$, $q = 5.00 \\times 10^{10}\\,\\mathrm{m}^{-1}$, $\\omega = 2.00 \\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$.\n- Case $5$ (very high-$q$ scaling): $m = 6.63 \\times 10^{-26}\\,\\mathrm{kg}$, $T = 3.00 \\times 10^{2}\\,\\mathrm{K}$, $q = 2.00 \\times 10^{11}\\,\\mathrm{m}^{-1}$, $\\omega = 0.00\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[result1,result2,result3]$). Each $result$ must be a floating-point number representing $S(q,\\omega)$ in $\\mathrm{s}$ for the corresponding test case, computed using your derived expression.",
            "solution": "The user has requested a derivation of the dynamic structure factor, $S(q, \\omega)$, for a dilute monoatomic classical gas in the impulse approximation, followed by a numerical implementation.\n\n### Problem Validation\nThe problem is a valid and well-posed problem in physics.\n\n### Derivation of the Dynamic Structure Factor $S(q, \\omega)$\n\nThe dynamic structure factor $S(q, \\omega)$ is defined as the time-Fourier transform of the intermediate scattering function, $F(q, t)$. We adopt the convention $S(q, \\omega) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} F(q,t)e^{i\\omega t}dt$.\n\n$1$. The intermediate scattering function $F(\\mathbf{q}, t)$ is defined for a system of $N$ particles as the autocorrelation function of the microscopic density fluctuations. For a dilute gas, the cross-terms ($j \\neq k$) average to zero, and the function is dominated by the \"self\" part ($j = k$):\n$$\nF(q, t) \\approx F_s(q, t) = \\left\\langle e^{i \\mathbf{q} \\cdot (\\mathbf{r}(t) - \\mathbf{r}(0))} \\right\\rangle\n$$\nwhere $\\langle \\dots \\rangle$ denotes an ensemble average and the function depends only on the magnitude $q=|\\mathbf{q}|$ due to isotropy.\n\n$2$. In the impulse approximation (high-$q$ limit), particle motion is ballistic: $\\mathbf{r}(t) = \\mathbf{r}(0) + \\mathbf{v}t$. Substituting this into the expression for $F_s(q,t)$:\n$$\nF_s(q, t) = \\left\\langle e^{i \\mathbf{q} \\cdot (\\mathbf{v}t)} \\right\\rangle = \\left\\langle e^{i t (\\mathbf{q} \\cdot \\mathbf{v})} \\right\\rangle\n$$\n\n$3$. The ensemble average becomes an average over the Maxwell-Boltzmann velocity distribution, $P(\\mathbf{v})$:\n$$\nP(\\mathbf{v}) = \\left(\\frac{m}{2\\pi k_{\\mathrm{B}} T}\\right)^{3/2} \\exp\\left(-\\frac{m |\\mathbf{v}|^2}{2 k_{\\mathrm{B}} T}\\right)\n$$\nThe intermediate scattering function is then the Fourier transform of this distribution:\n$$\nF_s(q, t) = \\int d^3v \\, P(\\mathbf{v}) \\, e^{i t (\\mathbf{q} \\cdot \\mathbf{v})}\n$$\n\n$4$. To evaluate this integral, we align $\\mathbf{q}$ with the $z$-axis, so $\\mathbf{q} \\cdot \\mathbf{v} = q v_z$. The integral over $v_x$ and $v_y$ yields 1, leaving the integral over $v_z$:\n$$\nF_s(q, t) = \\left(\\frac{m}{2\\pi k_{\\mathrm{B}} T}\\right)^{1/2} \\int_{-\\infty}^{\\infty} dv_z \\, \\exp\\left(-\\frac{m v_z^2}{2 k_{\\mathrm{B}} T}\\right) e^{i (tq) v_z}\n$$\nThis is the Fourier transform of a Gaussian function. The result is a Gaussian function of the transform variable $tq$:\n$$\nF_s(q, t) = \\exp\\left(-\\frac{q^2 t^2 k_{\\mathrm{B}} T}{2m}\\right)\n$$\n\n$5$. Finally, we obtain $S(q, \\omega)$ by taking the time-Fourier transform of $F_s(q, t)$:\n$$\nS(q, \\omega) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} dt \\, \\exp\\left(-\\frac{q^2 k_{\\mathrm{B}} T}{2m} t^2\\right) e^{i \\omega t}\n$$\nThis is again a Fourier transform of a Gaussian. Using the standard integral identity, this time with variable $t$, $a = \\frac{q^2 k_{\\mathrm{B}} T}{2m}$, and transform variable $\\omega$:\n$$\nS(q, \\omega) = \\frac{1}{2\\pi} \\sqrt{\\frac{\\pi}{a}} \\exp\\left(\\frac{-\\omega^2}{4a}\\right) = \\frac{1}{2\\pi} \\sqrt{\\frac{2\\pi m}{q^2 k_{\\mathrm{B}} T}} \\exp\\left(-\\frac{m \\omega^2}{2 q^2 k_{\\mathrm{B}} T}\\right)\n$$\nSimplifying this expression yields the final result:\n$$\nS(q, \\omega) = \\sqrt{\\frac{m}{2\\pi q^2 k_{\\mathrm{B}} T}} \\exp\\left(-\\frac{m \\omega^2}{2 q^2 k_{\\mathrm{B}} T}\\right)\n$$\nThis expression gives the dynamic structure factor as a Gaussian function of $\\omega$ centered at $\\omega=0$, with a width determined by the Doppler broadening due to thermal motion. This is the expression to be implemented numerically.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the dynamic structure factor S(q, ω) for a series of test cases\n    based on the derived formula for a dilute gas in the impulse approximation.\n    \"\"\"\n\n    # Define the Boltzmann constant in SI units (J/K)\n    k_B = 1.380649e-23\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains (m, T, q, omega) in SI units.\n    # m: kg, T: K, q: m^-1, omega: rad/s\n    test_cases = [\n        # Case 1 (happy path)\n        (6.63e-26, 3.00e2, 8.00e10, 0.00),\n        # Case 2 (frequency tail)\n        (6.63e-26, 3.00e2, 8.00e10, 1.00e12),\n        # Case 3 (low-q boundary check)\n        (6.63e-26, 3.00e2, 1.00e8, 1.00e9),\n        # Case 4 (heavy and cold gas)\n        (1.00e-25, 5.00e1, 5.00e10, 2.00e12),\n        # Case 5 (very high-q scaling)\n        (6.63e-26, 3.00e2, 2.00e11, 0.00),\n    ]\n\n    def calculate_S_q_omega(m, T, q, omega):\n        \"\"\"\n        Computes S(q, ω) using the derived formula:\n        S(q, ω) = sqrt(m / (2*pi*k_B*T*q^2)) * exp(-m*ω^2 / (2*k_B*T*q^2))\n        \n        Args:\n            m (float): Particle mass in kg.\n            T (float): Temperature in K.\n            q (float): Wavevector magnitude in m^-1.\n            omega (float): Angular frequency in rad/s.\n        \n        Returns:\n            float: The value of S(q, ω) in seconds.\n        \"\"\"\n        # Ensure q is non-zero to avoid division by zero.\n        if q == 0.0:\n            return np.inf\n\n        # Common denominator term to simplify calculation and improve clarity\n        denominator_term = k_B * T * q**2\n\n        # Calculate the prefactor (the term under the square root)\n        prefactor_arg = m / (2 * np.pi * denominator_term)\n        prefactor = np.sqrt(prefactor_arg)\n\n        # Calculate the argument of the exponential function\n        exponent_arg = -(m * omega**2) / (2 * denominator_term)\n        \n        # Calculate the exponential term\n        exp_term = np.exp(exponent_arg)\n\n        # The final result is the product of the prefactor and the exponential term\n        s_q_omega = prefactor * exp_term\n        \n        return s_q_omega\n\n    results = []\n    for case in test_cases:\n        m, T, q, omega = case\n        result = calculate_S_q_omega(m, T, q, omega)\n        results.append(f\"{result:.6e}\") # Format to standard scientific notation\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having examined the single-particle dynamics at high $q$, we now turn to the opposite extreme: the long-wavelength, low-frequency hydrodynamic limit. Here, we no longer see individual particles but rather the collective, fluid-like modes of the system. This practice guides you through the derivation of the famous Rayleigh-Brillouin triplet, showing how the conservation laws of mass, momentum, and energy give rise to distinct spectral features corresponding to thermal diffusion (the central Rayleigh peak) and propagating sound waves (the Brillouin side peaks).",
            "id": "3794908",
            "problem": "Consider a simple compressible Newtonian fluid in the long-wavelength, low-frequency hydrodynamic regime where density and momentum fluctuations are governed by conservation laws and linear irreversible thermodynamics. The goal is to derive and compute the dynamic structure factor (DSF), defined as $S(\\mathbf{k},\\omega)$, for density fluctuations at wavevector $\\mathbf{k}$ and angular frequency $\\omega$, and to identify the emergence of the Rayleigh-Brillouin triplet: one central peak associated with thermal diffusion and two symmetrically displaced side peaks associated with sound propagation.\n\nStart from the following fundamental and widely accepted bases:\n- Mass conservation (continuity equation): $\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{v}) = 0$, linearized about a uniform equilibrium.\n- Momentum conservation (linearized Navier-Stokes for a Newtonian fluid): $\\rho_0 \\partial_t \\mathbf{v} = -\\nabla p + \\eta \\nabla^2 \\mathbf{v} + \\left(\\zeta + \\frac{\\eta}{3}\\right)\\nabla (\\nabla \\cdot \\mathbf{v})$, where $\\rho_0$ is the equilibrium mass density, $p$ is the pressure, $\\eta$ is the shear viscosity, and $\\zeta$ is the bulk viscosity.\n- Energy conservation and Fourier’s law of heat conduction, linearized to obtain thermal diffusion dynamics for temperature fluctuations with thermal diffusivity $D_T$.\n- Thermodynamic relations linking fluctuations of pressure, density, and temperature, including the ratio of specific heats $\\gamma = c_p/c_v$ and the adiabatic speed of sound $c_s = \\sqrt{\\left(\\frac{\\partial p}{\\partial \\rho}\\right)_s}$.\n\nDefine the Dynamic Structure Factor (DSF) as the frequency-domain density fluctuation spectrum,\n$$\nS(\\mathbf{k},\\omega) = \\frac{1}{2\\pi N}\\int_{-\\infty}^{\\infty} dt\\, e^{i\\omega t} \\left\\langle \\delta \\rho_{\\mathbf{k}}(t)\\, \\delta \\rho_{-\\mathbf{k}}(0) \\right\\rangle,\n$$\nwhere $N$ is the number of particles and $\\delta \\rho_{\\mathbf{k}}(t)$ is the spatial Fourier component of the density fluctuation at wavevector $\\mathbf{k}$. In the hydrodynamic limit $|\\mathbf{k}|\\to 0$ with $|\\omega|$ small compared to microscopic frequencies, show that $S(\\mathbf{k},\\omega)$ is composed of three line shapes corresponding to one diffusive thermal mode and two propagating sound modes. Using the above fundamental bases, derive their centers, widths, and relative weights in terms of $|\\mathbf{k}|$, $\\gamma$, $c_s$, $D_T$, and the longitudinal kinematic viscosity $\\nu_L = \\dfrac{4\\eta/3 + \\zeta}{\\rho_0}$.\n\nThen, design an algorithm to compute the following seven quantitative outputs for a given parameter set $(|\\mathbf{k}|, \\gamma, c_s, D_T, \\nu_L)$, in the precise units indicated:\n1. The full width at half maximum (FWHM) of the central Rayleigh peak in $\\text{rad}\\,\\text{s}^{-1}$.\n2. The full width at half maximum (FWHM) of each Brillouin side peak in $\\text{rad}\\,\\text{s}^{-1}$.\n3. The Brillouin peak center angular frequency $|\\omega_B|$ in $\\text{rad}\\,\\text{s}^{-1}$.\n4. The dimensionless integrated weight (area fraction) of the central Rayleigh peak.\n5. The dimensionless integrated weight (area fraction) of one Brillouin side peak.\n6. The on-peak value of the normalized DSF at $\\omega=0$ (the center of the Rayleigh peak), expressed as a dimensionless float, with the DSF normalized so that its integral over all $\\omega$ equals $1$.\n7. The on-peak value of the normalized DSF at $\\omega=+\\omega_B$ (the center of the right Brillouin peak), expressed as a dimensionless float, with the same normalization as above.\n\nYour program must implement this algorithm and produce results for the following test suite of parameter sets. Use the given values exactly, and treat $|\\mathbf{k}|$ in $\\text{m}^{-1}$, $\\gamma$ dimensionless, $c_s$ in $\\text{m}\\,\\text{s}^{-1}$, $D_T$ in $\\text{m}^2\\,\\text{s}^{-1}$, and $\\nu_L$ in $\\text{m}^2\\,\\text{s}^{-1}$:\n- Test Case 1 (typical liquid-like, moderate $|\\mathbf{k}|$): $|\\mathbf{k}| = 1.0\\times 10^{7}$, $\\gamma = 1.01$, $c_s = 1500.0$, $D_T = 1.4\\times 10^{-7}$, $\\nu_L = 2.0\\times 10^{-6}$.\n- Test Case 2 (boundary small wavenumber): $|\\mathbf{k}| = 1.0\\times 10^{3}$, $\\gamma = 1.01$, $c_s = 1500.0$, $D_T = 1.4\\times 10^{-7}$, $\\nu_L = 2.0\\times 10^{-6}$.\n- Test Case 3 (monatomic gas-like parameters): $|\\mathbf{k}| = 1.0\\times 10^{5}$, $\\gamma = 5.0/3.0$, $c_s = 343.0$, $D_T = 2.2\\times 10^{-5}$, $\\nu_L = 2.5\\times 10^{-5}$.\n- Test Case 4 (isothermal limit of $\\gamma \\to 1$ to suppress the Rayleigh weight): $|\\mathbf{k}| = 5.0\\times 10^{6}$, $\\gamma = 1.0$, $c_s = 2000.0$, $D_T = 1.0\\times 10^{-7}$, $\\nu_L = 1.0\\times 10^{-6}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s seven outputs are grouped into a sublist. The final output format must be:\n$[ [r_1, r_2, r_3, r_4, r_5, r_6, r_7], [\\dots], [\\dots], [\\dots] ]$\nwhere for each test case $r_1$ through $r_7$ are floats in the order specified above.",
            "solution": "The problem is a valid and well-posed exercise in condensed matter physics. The objective is to compute the dynamic structure factor, $S(\\mathbf{k},\\omega)$, which describes the spectrum of spontaneous density fluctuations in a fluid. In the hydrodynamic limit (small wavevector $|\\mathbf{k}|=k$ and small angular frequency $\\omega$), the dynamics are governed by the linearized equations of mass, momentum, and energy conservation. The analysis of these coupled linear equations reveals the collective modes of the fluid, which manifest as distinct peaks in $S(k,\\omega)$.\n\nThe derivation starts from the Fourier-transformed linearized hydrodynamic equations. The analysis reveals three hydrodynamic modes:\n\n$1$. A pair of counter-propagating, damped sound modes (Brillouin peaks). Their dispersion relation is approximately:\n$$ \\omega = \\pm c_s k - i\\Gamma_S $$\nHere, $c_s$ is the adiabatic speed of sound, which gives the peak positions at $\\omega_B = \\pm c_s k$. The imaginary part describes the damping, with a half-width at half-maximum (HWHM) $\\Gamma_S$ given by:\n$$ \\Gamma_S = \\frac{k^2}{2} \\left[ \\nu_L + (\\gamma - 1) D_T \\right] $$\nwhere $\\nu_L$ is the longitudinal kinematic viscosity, $D_T$ is the thermal diffusivity, and $\\gamma = c_p/c_v$ is the ratio of specific heats.\n\n$2$. One non-propagating, diffusive thermal mode (Rayleigh peak). It describes the diffusion of entropy fluctuations at constant pressure. Its dispersion relation is:\n$$ \\omega = -i\\Gamma_R $$\nThe peak is centered at $\\omega = 0$ and has a HWHM $\\Gamma_R$ given by:\n$$ \\Gamma_R = D_T k^2 $$\n\nThe dynamic structure factor $S(k,\\omega)$ is the sum of the spectral signatures of these modes. Normalizing the total integrated intensity to unity, the DSF can be modeled as a sum of three Lorentzians:\n$$ S_{norm}(k, \\omega) = \\frac{1}{\\pi} \\left[ \\left(1 - \\frac{1}{\\gamma}\\right) \\frac{\\Gamma_R}{\\omega^2 + \\Gamma_R^2} + \\frac{1}{2\\gamma} \\left( \\frac{\\Gamma_S}{(\\omega - c_s k)^2 + \\Gamma_S^2} + \\frac{\\Gamma_S}{(\\omega + c_s k)^2 + \\Gamma_S^2} \\right) \\right] $$\nThe prefactors are the integrated weights, with their ratio $(\\gamma-1)$ known as the Landau-Placzek ratio.\n\nFrom this theoretical basis, we derive the seven required quantities for a given parameter set ($k, \\gamma, c_s, D_T, \\nu_L$).\n\n$1$. The FWHM of the Rayleigh peak, $W_R$, is twice its HWHM, $\\Gamma_R$:\n$$ W_R = 2 \\Gamma_R = 2 D_T k^2 $$\n\n$2$. The FWHM of each Brillouin peak, $W_S$, is twice its HWHM, $\\Gamma_S$:\n$$ W_S = 2 \\Gamma_S = \\left( \\nu_L + (\\gamma - 1) D_T \\right) k^2 $$\n\n$3$. The Brillouin peak center angular frequency, $|\\omega_B|$:\n$$ |\\omega_B| = c_s k $$\n\n$4$. The integrated weight of the central Rayleigh peak, $I_R$:\n$$ I_R = 1 - \\frac{1}{\\gamma} $$\n\n$5$. The integrated weight of one Brillouin side peak, $I_S$:\n$$ I_S = \\frac{1}{2\\gamma} $$\n\n$6$. The on-peak value of the normalized DSF at $\\omega=0$:\n$$ S_{norm}(k, 0) = \\frac{1}{\\pi} \\left[ I_R \\frac{1}{\\Gamma_R} + 2 I_S \\frac{\\Gamma_S}{(c_s k)^2 + \\Gamma_S^2} \\right] $$\n\n$7$. The on-peak value of the normalized DSF at $\\omega = c_s k$:\n$$ S_{norm}(k, c_s k) = \\frac{1}{\\pi} \\left[ I_R \\frac{\\Gamma_R}{(c_s k)^2 + \\Gamma_R^2} + I_S \\left( \\frac{1}{\\Gamma_S} + \\frac{\\Gamma_S}{(2 c_s k)^2 + \\Gamma_S^2} \\right) \\right] $$\n\nThe algorithm implemented in the final answer uses these exact formulae.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the properties of the dynamic structure factor for given test cases.\n    \"\"\"\n\n    # Test cases parameters:\n    # (|k| [m^-1], gamma, c_s [m/s], D_T [m^2/s], nu_L [m^2/s])\n    test_cases = [\n        (1.0e7, 1.01, 1500.0, 1.4e-7, 2.0e-6),\n        (1.0e3, 1.01, 1500.0, 1.4e-7, 2.0e-6),\n        (1.0e5, 5.0/3.0, 343.0, 2.2e-5, 2.5e-5),\n        (5.0e6, 1.0, 2000.0, 1.0e-7, 1.0e-6),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = calculate_dsf_properties(case)\n        all_results.append(result)\n\n    # Format the final output string as per problem specification.\n    # e.g., [[r1,r2,...],[...],...]\n    sublist_strings = []\n    for res in all_results:\n        sublist_strings.append(f\"[{','.join(map(str, res))}]\")\n    final_output = f\"[{','.join(sublist_strings)}]\"\n\n    print(final_output)\n\ndef calculate_dsf_properties(params):\n    \"\"\"\n    Calculates the seven specified quantitative outputs for the DSF.\n\n    Args:\n        params (tuple): A tuple containing the physical parameters:\n                        (k_val, gamma, c_s, D_T, nu_L)\n\n    Returns:\n        list: A list of seven float values corresponding to the required outputs.\n    \"\"\"\n    k_val, gamma, c_s, D_T, nu_L = params\n    k_sq = k_val**2\n\n    # Calculate Half-Width at Half-Maximum (HWHM) for Rayleigh and Brillouin peaks\n    hwhm_R = D_T * k_sq\n    hwhm_S = 0.5 * (nu_L + (gamma - 1.0) * D_T) * k_sq\n\n    # 1. FWHM of the central Rayleigh peak\n    fwhm_R = 2.0 * hwhm_R\n\n    # 2. FWHM of each Brillouin side peak\n    fwhm_S = 2.0 * hwhm_S\n\n    # 3. Brillouin peak center angular frequency\n    omega_B = c_s * k_val\n\n    # Handle the gamma = 1 case to avoid division by zero in weight calculation\n    # and to ensure the formula remains physically meaningful (isothermal limit).\n    if gamma == 1.0:\n        weight_R = 0.0\n    else:\n        # 4. Integrated weight of the central Rayleigh peak\n        weight_R = 1.0 - 1.0 / gamma\n    \n    # 5. Integrated weight of one Brillouin side peak\n    weight_S = 1.0 / (2.0 * gamma)\n\n    # 6. On-peak value of the normalized DSF at omega = 0\n    # S_norm(k, 0) = (1/pi) * [ weight_R/hwhm_R + 2*weight_S * hwhm_S / (omega_B^2 + hwhm_S^2) ]\n    term1_peak_R = 0.0\n    if weight_R > 0 and hwhm_R > 0:\n        term1_peak_R = weight_R / hwhm_R\n        \n    term2_peak_R = (2.0 * weight_S) * hwhm_S / (omega_B**2 + hwhm_S**2)\n    peak_val_R = (1.0 / np.pi) * (term1_peak_R + term2_peak_R)\n\n    # 7. On-peak value of the normalized DSF at omega = +omega_B\n    # S_norm(k, omega_B) = (1/pi) * [ weight_R*hwhm_R/(omega_B^2+hwhm_R^2) + \n    #                                weight_S*(1/hwhm_S + hwhm_S/((2*omega_B)^2+hwhm_S^2)) ]\n    term1_peak_S = 0.0\n    if weight_R > 0:\n        term1_peak_S = weight_R * hwhm_R / (omega_B**2 + hwhm_R**2)\n\n    term2_peak_S_main = 0.0\n    if hwhm_S > 0:\n        term2_peak_S_main = 1.0 / hwhm_S\n        \n    term2_peak_S_tail = hwhm_S / ((2.0 * omega_B)**2 + hwhm_S**2)\n    \n    peak_val_S = (1.0 / np.pi) * (term1_peak_S + weight_S * (term2_peak_S_main + term2_peak_S_tail))\n\n    return [fwhm_R, fwhm_S, omega_B, weight_R, weight_S, peak_val_R, peak_val_S]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "The theoretical spectra derived in the previous exercises assume an infinitely large system observed for an infinite duration. In practice, both simulations and experiments are constrained by finite size and finite time, which introduce numerical artifacts into the calculated dynamic structure factor. This final exercise uses a simplified model of a harmonic crystal to provide hands-on experience with these crucial effects, such as spectral peak broadening due to finite observation time and amplitude modulation from finite system size, and explores the use of windowing functions to mitigate them.",
            "id": "3794900",
            "problem": "Consider a one-dimensional harmonic crystal of $N$ identical point masses with mass $m$ connected by linear springs of stiffness $K$ and lattice spacing $a$, arranged on a ring of total length $L = N a$ with periodic boundary conditions. The longitudinal displacement of atom $j$ at position $x_j = j a$ is denoted by $u_j(t)$. The equations of motion are given by Newton's second law with nearest-neighbor Hooke interactions, and the normal modes are plane waves with angular frequency dispersion obtained from the linearized dynamics.\n\nYou will compute the dynamic structure factor $S(q,\\omega)$ from first principles for a single excited normal mode in dimensionless units, focusing on finite-size ($N$) and finite-time ($T$) effects. All angles must be treated in radians and all angular frequencies in radians per time-unit. The final numerical outputs must be dimensionless and expressed as floating-point numbers.\n\nFundamental base:\n- The normal-mode dispersion relation for the one-dimensional harmonic chain is derived from linearized equations of motion and is\n$$\n\\omega(q) = 2 \\sqrt{\\frac{K}{m}} \\left| \\sin\\left( \\frac{q a}{2} \\right) \\right|.\n$$\n- The microscopic density in Fourier space at wave number $q$ is $n_q(t) = \\sum_{j=0}^{N-1} \\exp\\big( i q x_j(t) \\big)$, where $x_j(t) = x_j + u_j(t)$.\n- The coherent intermediate scattering function is defined as\n$$\nF(q,t) = \\frac{1}{N} \\left\\langle n_q(t) \\, n_{-q}(0) \\right\\rangle,\n$$\nand the dynamic structure factor is its time-Fourier transform,\n$$\nS(q,\\omega) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} \\mathrm{d}t \\, e^{i \\omega t} \\, F(q,t).\n$$\n- In the small-amplitude, long-wavelength longitudinal limit, the density fluctuation is linearly related to the normal-mode displacement coordinate via the continuity relation. Specifically, defining the normal-mode coordinate\n$$\nQ(q,t) = \\frac{1}{\\sqrt{N}} \\sum_{j=0}^{N-1} u_j(t) \\, e^{-i q x_j},\n$$\none has the leading-order longitudinal density fluctuation in Fourier space\n$$\n\\delta n_q(t) \\propto q \\, Q(q,t).\n$$\nThis proportionality ensures that frequency content of $Q(q,t)$ determines the peaks of $S(q,\\omega)$, up to an overall $q$-dependent scale.\n\nScenario and numerical construction:\n- Consider a single excited normal mode at $q^*$. Construct the displacement field deterministically as\n$$\nu_j(t) = A \\cos(q^* x_j) \\cos\\big( \\omega(q^*) t \\big),\n$$\nwhere $A$ is a small amplitude. The projection onto a measurement wave number $q$ is governed by the finite-size overlap\n$$\nO(q,q^*) = \\sum_{j=0}^{N-1} \\cos(q^* x_j) \\, e^{-i q x_j}.\n$$\nThe normal-mode coordinate then has the deterministic form\n$$\nQ(q,t) = \\frac{A}{\\sqrt{N}} \\, O(q,q^*) \\, \\cos\\big( \\omega(q^*) t \\big).\n$$\n- Finite-time sampling over a total duration $T_{\\text{obs}} = M \\Delta t$ with $M$ time steps of size $\\Delta t$ and the use of a time window $w(t)$ leads to the discrete-time windowed transform of $Q(q,t)$, whose power spectrum $| \\mathcal{F}\\{ w(t) Q(q,t) \\} |^2$ exhibits a main peak at $\\omega(q^*)$ with a finite width determined by the window's spectral response. A rectangular window produces a Dirichlet kernel with a main-lobe width scaling as $O(2\\pi/T_{\\text{obs}})$, while a Hann window reduces sidelobes and slightly broadens the main lobe.\n\nYour tasks:\n- Using the definitions above and only the fundamental relations provided, implement a program that, for the specified test suite, computes:\n  1. The absolute error between the measured peak angular frequency (location of the largest spectral power in the windowed discrete Fourier transform of $Q(q,t)$) and the analytical $\\omega(q^*)$.\n  2. The full width at half maximum (FWHM) of the main spectral peak for the rectangular window case, computed from the discrete spectrum by locating the half-power crossings on either side of the peak and linearly interpolating between adjacent frequency bins when needed.\n  3. The finite-size overlap ratio\n     $$\n     R = \\frac{|O(q,q^*)|}{|O(q^*,q^*)|},\n     $$\n     which quantifies how finite-size sampling suppresses the measured amplitude when the measurement wave number $q$ does not match the excited mode $q^*$.\n\nAll quantities are to be reported in dimensionless units. Angles are in radians and angular frequencies in radians per time-unit.\n\nAlgorithmic constraints:\n- Construct $Q(q,t)$ directly from the displacement field and the finite-size overlap. Use $Q(q,t)$ to produce a windowed discrete spectrum via the Fast Fourier Transform (FFT). Work exclusively with the time series $Q(q,t)$ and do not compute $n_q(t)$ explicitly.\n- For the FFT, use the one-sided real transform when the time series is real-valued, with frequency bins mapped to angular frequencies via multiplication by $2\\pi$.\n\nTest suite:\n- Case $1$ (happy path): $N = 128$, $m = 1$, $K = 1$, $a = 1$, $\\Delta t = 0.005$, $M = 8192$, $A = 0.01$, $q^* = \\pi/4$, measurement wave number $q = \\pi/4$, window $w(t)$ is Hann. Output the absolute peak frequency error as a float.\n- Case $2$ (finite-time boundary): $N = 128$, $m = 1$, $K = 1$, $a = 1$, $\\Delta t = 0.005$, $M = 512$, $A = 0.01$, $q^* = \\pi/4$, measurement wave number $q = \\pi/4$, window $w(t)$ is rectangular. Output the FWHM as a float.\n- Case $3$ (finite-size mismatch): $N = 32$, $m = 1$, $K = 1$, $a = 1$, $\\Delta t = 0.005$, $M = 8192$, $A = 0.01$, $q^* = \\pi/4$, measurement wave number $q = \\pi/3$, window $w(t)$ is Hann. Output the finite-size overlap ratio $R$ as a float.\n\nFinal output format:\n- Your program should produce a single line of output containing the three results as a comma-separated list enclosed in square brackets, for the three test cases in the order listed above. For example, the output must be of the form `[\\text{result}_1,\\text{result}_2,\\text{result}_3]`. All three results must be floating-point numbers. No additional text should be printed.",
            "solution": "The problem requires the calculation of three distinct physical quantities related to the dynamics of a one-dimensional harmonic crystal, based on a simplified deterministic model of a single excited normal mode. The analysis will proceed by first establishing the theoretical framework based on the provided givens, and then detailing the algorithmic steps for each of the three test cases.\n\nThe system is a 1D chain of $N$ masses $m$ with spring constant $K$ and lattice spacing $a$. The atoms are indexed by $j \\in \\{0, 1, \\dots, N-1\\}$ with equilibrium positions $x_j = j a$. The longitudinal displacement is $u_j(t)$. The dynamics are governed by the normal-mode dispersion relation:\n$$\n\\omega(q) = 2 \\sqrt{\\frac{K}{m}} \\left| \\sin\\left( \\frac{q a}{2} \\right) \\right|\n$$\nwhere $q$ is the wave number.\n\nThe core of the problem is to analyze the spectral content of the normal-mode coordinate $Q(q,t)$, which is defined as the projection of the displacement field $u_j(t)$ onto a plane wave $e^{-i q x_j}$:\n$$\nQ(q,t) = \\frac{1}{\\sqrt{N}} \\sum_{j=0}^{N-1} u_j(t) \\, e^{-i q x_j}\n$$\nThe problem considers a scenario where a single normal mode at wave number $q^*$ is excited, yielding a deterministic standing-wave displacement field:\n$$\nu_j(t) = A \\cos(q^* x_j) \\cos\\big( \\omega(q^*) t \\big)\n$$\nwhere $A$ is a small amplitude and $\\omega(q^*)$ is the analytical frequency from the dispersion relation. Substituting this displacement field into the definition of $Q(q,t)$ gives:\n$$\nQ(q,t) = \\frac{A}{\\sqrt{N}} \\, O(q,q^*) \\, \\cos\\big( \\omega(q^*) t \\big)\n$$\nwhere $O(q,q^*)$ is the complex-valued finite-size overlap factor:\n$$\nO(q,q^*) = \\sum_{j=0}^{N-1} \\cos(q^* x_j) \\, e^{-i q x_j}\n$$\nThe analysis of $Q(q,t)$ is performed in the frequency domain. We generate a discrete time series for $Q(q,t)$ over a duration $T_{\\text{obs}} = M \\Delta t$ at time steps $t_k = k \\Delta t$ for $k \\in \\{0, 1, \\dots, M-1\\}$. This time series is then multiplied by a window function $w(t_k)$ and its power spectrum is computed using the Fast Fourier Transform (FFT). The resulting FFT frequency bins are converted to physical angular frequencies $\\omega$ via $\\omega_k = 2 \\pi f_k = 2\\pi \\frac{k}{M \\Delta t}$.\n\nThe algorithmic procedure for each task is as follows:\n\n**Task 1: Absolute Peak Frequency Error**\nFor Case 1, the wave number $q^*$ is commensurate with the lattice. This makes $O(q^*, q^*)$ real, and thus $Q(q^*,t)$ is a real-valued time series.\n1.  Calculate the analytical frequency $\\omega(q^*)$ using the dispersion relation.\n2.  Construct the real-valued time series $Q(q^*, t_k)$.\n3.  Apply a Hann window $w(t_k) = 0.5(1 - \\cos(2\\pi k / (M-1)))$ to the time series.\n4.  Compute the power spectrum of the windowed time series using `rfft`.\n5.  Determine the angular frequency $\\omega_{\\text{meas}}$ corresponding to the maximum power in the spectrum.\n6.  The result is the absolute error $|\\omega_{\\text{meas}} - \\omega(q^*)|$.\n\n**Task 2: Full Width at Half Maximum (FWHM)**\nFor Case 2, a rectangular window ($w(t_k)=1$) is used.\n1.  Compute the power spectrum of the un-windowed time series $Q(q^*,t)$ using `rfft`.\n2.  Find the peak power $P_{\\text{max}}$ and its angular frequency $\\omega_{\\text{peak}}$.\n3.  Calculate the half-maximum power, $P_{\\text{half}} = P_{\\text{max}}/2$.\n4.  Search downwards in frequency from $\\omega_{\\text{peak}}$ to find the point $\\omega_{\\text{left}}$ where the power spectrum crosses $P_{\\text{half}}$ via linear interpolation.\n5.  Similarly, search upwards in frequency to find the interpolated crossing point $\\omega_{\\text{right}}$.\n6.  The FWHM is calculated as $\\omega_{\\text{right}} - \\omega_{\\text{left}}$.\n\n**Task 3: Finite-Size Overlap Ratio**\nThis task involves a direct, time-independent calculation for Case 3, where $q \\neq q^*$.\n1.  Numerically compute the complex overlap factor $O(q,q^*) = \\sum_{j=0}^{N-1} \\cos(q^* x_j) \\, e^{-i q x_j}$.\n2.  Numerically compute the reference overlap factor $O(q^*,q^*) = \\sum_{j=0}^{N-1} \\cos(q^* x_j) \\, e^{-i q^* x_j}$.\n3.  The result is the ratio of the magnitudes: $R = \\frac{|O(q,q^*)|}{|O(q^*,q^*)|}$.\nThe following program implements these calculations for the specified test suite.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_quantities(params):\n    \"\"\"\n    Calculates the required physical quantity based on the provided parameters.\n\n    The function handles three distinct tasks specified by the 'task' parameter:\n    1. 'peak_error': Computes the absolute error between the measured and analytical peak frequency.\n    2. 'fwhm': Computes the Full Width at Half Maximum of the spectral peak.\n    3. 'ratio': Computes the finite-size overlap ratio R.\n    \"\"\"\n    N, m, K, a, dt, M, A, q_star, q, window_type, task = params\n\n    # Common parameters and analytical calculations\n    x_j = a * np.arange(N)\n    omega_analytical = 2 * np.sqrt(K / m) * np.abs(np.sin(q_star * a / 2))\n\n    # Task 3: Overlap Ratio R. This is a static calculation.\n    if task == 'ratio':\n        O_q_qstar = np.sum(np.cos(q_star * x_j) * np.exp(-1j * q * x_j))\n        O_qstar_qstar = np.sum(np.cos(q_star * x_j) * np.exp(-1j * q_star * x_j))\n        return np.abs(O_q_qstar) / np.abs(O_qstar_qstar)\n\n    # For tasks 1 and 2, perform time-domain analysis.\n    t = dt * np.arange(M)\n    O_q_qstar_val = np.sum(np.cos(q_star * x_j) * np.exp(-1j * q * x_j))\n\n    # Construct the time series for Q(q,t).\n    # Since q=q* for cases 1 & 2 and q* is commensurate, O_q_qstar_val is real.\n    # We can safely take the real part of the resulting series.\n    Q_qt_series = (A / np.sqrt(N)) * O_q_qstar_val * np.cos(omega_analytical * t)\n    Q_qt_series_real = np.real(Q_qt_series)\n\n    # Apply windowing if specified. 'rectangular' means no windowing.\n    if window_type == 'hann':\n        window = np.hanning(M)\n        Q_qt_series_real *= window\n\n    # Perform one-sided real FFT and compute power spectrum\n    fft_vals = np.fft.rfft(Q_qt_series_real)\n    freqs = np.fft.rfftfreq(M, d=dt)\n    power = np.abs(fft_vals)**2\n    angular_freqs = 2 * np.pi * freqs\n\n    # Task 1: Absolute peak frequency error\n    if task == 'peak_error':\n        peak_idx = np.argmax(power)\n        omega_measured = angular_freqs[peak_idx]\n        return np.abs(omega_measured - omega_analytical)\n    \n    # Task 2: Full Width at Half Maximum (FWHM)\n    if task == 'fwhm':\n        peak_idx = np.argmax(power)\n        peak_power = power[peak_idx]\n        half_power = peak_power / 2.0\n\n        # Find left crossing using linear interpolation\n        omega_left = None\n        for i in range(peak_idx - 1, -1, -1):\n            if power[i] = half_power:\n                p1, p2 = power[i], power[i+1]\n                w1, w2 = angular_freqs[i], angular_freqs[i+1]\n                omega_left = w1 + (w2 - w1) * (half_power - p1) / (p2 - p1)\n                break\n        \n        # Find right crossing using linear interpolation\n        omega_right = None\n        for i in range(peak_idx + 1, len(power)):\n            if power[i] = half_power:\n                p1, p2 = power[i-1], power[i]\n                w1, w2 = angular_freqs[i-1], angular_freqs[i]\n                omega_right = w1 + (w2 - w1) * (half_power - p1) / (p2 - p1)\n                break\n        \n        if omega_left is not None and omega_right is not None:\n            return omega_right - omega_left\n        else:\n            # Should not occur for the given problem parameters\n            return 0.0\n\ndef solve():\n    \"\"\"\n    Defines the test suite and orchestrates the calculation for each case.\n    \"\"\"\n    # Define test cases as tuples of parameters.\n    # (N, m, K, a, dt, M, A, q_star, q, window_type, task)\n    test_cases = [\n        # Case 1: happy path -> absolute peak frequency error\n        (128, 1.0, 1.0, 1.0, 0.005, 8192, 0.01, np.pi/4, np.pi/4, 'hann', 'peak_error'),\n        # Case 2: finite-time boundary -> FWHM\n        (128, 1.0, 1.0, 1.0, 0.005, 512, 0.01, np.pi/4, np.pi/4, 'rectangular', 'fwhm'),\n        # Case 3: finite-size mismatch -> overlap ratio R\n        (32, 1.0, 1.0, 1.0, 0.005, 8192, 0.01, np.pi/4, np.pi/3, 'hann', 'ratio'),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_quantities(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}