{
    "hands_on_practices": [
        {
            "introduction": "在格子玻尔兹曼方法（LBM）中，一个核心的实践挑战是将介观模拟参数（如弛豫时间 $\\tau$）与宏观流体属性（如运动粘度 $\\nu$）联系起来。这个练习将指导你完成这一关键步骤，确保你的模拟能够准确地再现具有特定雷诺数 $\\mathrm{Re}$ 的物理流动 。通过这个计算，你将掌握连接不同尺度物理量的基本技能，这是进行有意义的LBM模拟的先决条件。",
            "id": "3824269",
            "problem": "考虑在二维九速 (D2Q9) 格子上，使用等温、单松弛时间的 Bhatnagar–Gross–Krook 格子玻尔兹曼方法 (BGK-LBM) 来模拟高度为 $L_{\\mathrm{phys}}$ 的直微通道中的稳态层流。格子声速为 $c_{s}$，格子速度为 $c$，松弛时间为 $\\tau$。假设标准 D2Q9 关系为 $c_{s}^{2} = c^{2}/3$ 且 $c = \\delta x / \\delta t$，其中 $\\delta x$ 是格子间距，$\\delta t$ 是物理时间步长。在等温条件下，由 BGK-LBM 模型得到的流体运动粘度 $\\nu$ 与 $\\tau$ 的关系如下：\n$$\n\\nu = c_{s}^{2} \\left(\\tau - \\frac{1}{2}\\right) \\delta t\n$$\n您希望匹配一个目标雷诺数 $\\mathrm{Re}$，其由常规连续介质关系定义：\n$$\n\\mathrm{Re} = \\frac{U_{\\mathrm{phys}} L_{\\mathrm{phys}}}{\\nu}\n$$\n其中 $U_{\\mathrm{phys}}$ 是特征物理速度，$L_{\\mathrm{phys}}$ 是特征物理长度 (取通道高度为特征长度)。为了控制可压缩性误差，您选择物理时间步长 $\\delta t$，使得无量纲格子速度\n$$\nU_{\\mathrm{latt}} = \\frac{U_{\\mathrm{phys}} \\, \\delta t}{\\delta x}\n$$\n等于 $0.05$。通道高度用 $N_{x}$ 个点进行离散化，因此 $\\delta x = L_{\\mathrm{phys}} / N_{x}$。\n\n从上述定义和关系出发，推导用 $U_{\\mathrm{latt}}$、$N_x$ 和 $\\mathrm{Re}$ 表示的 $\\tau$ 表达式。然后，对于给定的数值\n$$\nL_{\\mathrm{phys}} = 1.0 \\times 10^{-3} \\ \\mathrm{m}, \\quad U_{\\mathrm{phys}} = 1.0 \\ \\mathrm{m/s}, \\quad N_{x} = 256, \\quad \\mathrm{Re} = 120, \\quad U_{\\mathrm{latt}} = 0.05\n$$\n计算 $\\tau$ 的值。将最终答案表示为无量纲数，并四舍五入至四位有效数字。",
            "solution": "问题要求为 BGK-LBM 模拟推导单松弛时间参数 $\\tau$ 的表达式，并计算其在特定情况下的数值。\n\n首先，我们建立宏观流体性质与介观模拟参数之间的联系。目标宏观系统由雷诺数 $\\mathrm{Re}$ 定义：\n$$\n\\mathrm{Re} = \\frac{U_{\\mathrm{phys}} L_{\\mathrm{phys}}}{\\nu}\n$$\n其中 $U_{\\mathrm{phys}}$ 是特征物理速度，$L_{\\mathrm{phys}}$ 是特征物理长度（通道高度），$\\nu$ 是流体的运动粘度。我们可以从此连续介质关系中表示出运动粘度：\n$$\n\\nu = \\frac{U_{\\mathrm{phys}} L_{\\mathrm{phys}}}{\\mathrm{Re}}\n$$\n这就是模拟必须再现的粘度值。\n\n接下来，我们使用由 BGK-LBM 模型得出的运动粘度表达式。对于 D2Q9 格子，该表达式为：\n$$\n\\nu = c_{s}^{2} \\left(\\tau - \\frac{1}{2}\\right) \\delta t\n$$\n其中 $c_{s}$ 是格子声速，$\\tau$ 是松弛时间，$\\delta t$ 是物理时间步长。问题指定了 D2Q9 格子的标准关系：$c_{s}^{2} = c^{2}/3$ 和 $c = \\delta x / \\delta t$，其中 $c$ 是格子速度，$\\delta x$ 是格子间距。\n\n将这些关系代入 $\\nu$ 的表达式中：\n$$\n\\nu = \\frac{c^2}{3} \\left(\\tau - \\frac{1}{2}\\right) \\delta t = \\frac{1}{3} \\left(\\frac{\\delta x}{\\delta t}\\right)^2 \\left(\\tau - \\frac{1}{2}\\right) \\delta t\n$$\n简化此表达式，得到用格子参数表示的介观粘度：\n$$\n\\nu = \\frac{(\\delta x)^2}{3 \\delta t} \\left(\\tau - \\frac{1}{2}\\right)\n$$\n为确保模拟与所需的物理系统相匹配，我们将运动粘度的宏观表达式和介观表达式相等：\n$$\n\\frac{U_{\\mathrm{phys}} L_{\\mathrm{phys}}}{\\mathrm{Re}} = \\frac{(\\delta x)^2}{3 \\delta t} \\left(\\tau - \\frac{1}{2}\\right)\n$$\n我们的目标是推导 $\\tau$ 的表达式。我们重排方程以求解包含 $\\tau$ 的项：\n$$\n\\tau - \\frac{1}{2} = \\frac{3 U_{\\mathrm{phys}} L_{\\mathrm{phys}} \\delta t}{\\mathrm{Re} (\\delta x)^2}\n$$\n问题陈述中提供了无量纲格子速度 $U_{\\mathrm{latt}}$ 的定义，即 $U_{\\mathrm{latt}} = \\frac{U_{\\mathrm{phys}} \\delta t}{\\delta x}$。我们可以使用这个定义来简化表达式。对右侧进行因式分解，我们得到：\n$$\n\\tau - \\frac{1}{2} = \\frac{3 L_{\\mathrm{phys}}}{\\delta x} \\left(\\frac{U_{\\mathrm{phys}} \\delta t}{\\delta x}\\right) \\frac{1}{\\mathrm{Re}}\n$$\n代入 $U_{\\mathrm{latt}}$ 可得：\n$$\n\\tau - \\frac{1}{2} = \\frac{3 L_{\\mathrm{phys}}}{\\delta x} \\frac{U_{\\mathrm{latt}}}{\\mathrm{Re}}\n$$\n此外，问题指出通道高度 $L_{\\mathrm{phys}}$ 用 $N_{x}$ 个格子点离散化，这意味着 $L_{\\mathrm{phys}} = N_{x} \\delta x$，或者等效地，$N_{x} = L_{\\mathrm{phys}} / \\delta x$。将此代入方程：\n$$\n\\tau - \\frac{1}{2} = \\frac{3 N_{x} U_{\\mathrm{latt}}}{\\mathrm{Re}}\n$$\n最后，求解 $\\tau$，我们得到所需的表达式：\n$$\n\\tau = \\frac{3 N_{x} U_{\\mathrm{latt}}}{\\mathrm{Re}} + \\frac{1}{2}\n$$\n该表达式将 LBM 松弛时间 $\\tau$ 与无量纲数 $N_x$、$U_{\\mathrm{latt}}$ 和 $\\mathrm{Re}$ 联系起来。任务的第一部分到此完成。\n\n对于第二部分，我们使用所提供的数据计算 $\\tau$ 的数值：\n$N_{x} = 256$\n$U_{\\mathrm{latt}} = 0.05$\n$\\mathrm{Re} = 120$\n\n将这些值代入推导出的 $\\tau$ 公式中：\n$$\n\\tau = \\frac{3 \\times 256 \\times 0.05}{120} + \\frac{1}{2}\n$$\n我们首先计算分数部分的值：\n$$\n\\frac{3 \\times 256 \\times 0.05}{120} = \\frac{768 \\times 0.05}{120} = \\frac{38.4}{120} = 0.32\n$$\n现在，我们加上剩下的项：\n$$\n\\tau = 0.32 + 0.5 = 0.82\n$$\n问题要求答案四舍五入到四位有效数字。因此，我们将结果表示为：\n$$\n\\tau = 0.8200\n$$\n按要求，该值为无量纲数。它也满足 BGK 模型的稳定性条件，即 $\\tau > 0.5$。",
            "answer": "$$\n\\boxed{0.8200}\n$$"
        },
        {
            "introduction": "耗散粒子动力学（DPD）是一种强大的介观粒子模拟方法，但其有效性取决于能否精确选择相互作用参数以复现目标流体的宏观性质。本练习将引导你从第一性原理出发，推导并实现一套映射关系，将微观的力场参数与宏观的热力学（可压缩性 $\\kappa_T$）和输运（粘度 $\\eta$）性质联系起来 。这是一个典型的多尺度建模任务，对于构建可靠的DPD模型至关重要。",
            "id": "3824322",
            "problem": "考虑一个通过耗散粒子动力学 (DPD) 建模的粗粒化流体，其中粒子通过三个成对的项相互作用：一个守恒力、一个耗散力和一个随机力。在三维空间中进行计算，使用约化DPD单位，使得粒子质量为 $m=1$，截断距离为 $r_c$（每个案例会明确提供），并且长度、能量和时间与 $r_c$、$m$ 和热能 $k_B T$ 一致地无量纲化。\n\n假设流体是均匀、各向同性的，其数密度为 $\\rho$，对分布函数在 $0 \\le r \\le r_c$ 范围内为 $g(r)=1$。\n\n您必须将DPD模型参数——守恒力振幅 $a$、耗散系数 $\\gamma$ 和随机力振幅 $\\sigma$——映射到指定的目标热力学和输运性质上：目标热能 $k_B T$、目标等温压缩率 $\\kappa_T$ 和目标剪切黏度 $\\eta$。该映射必须从第一性原理推导得出，并实现为一个可运行的程序，该程序能为一小组测试套件输出计算出的 $a$、$\\gamma$ 和 $\\sigma$。\n\n您的推导和算法必须基于以下基本定律和核心定义，不得引入任何快捷公式：\n- 用对力和径向分布函数 $g(r)$ 表示的状态方程的维里表达式。\n- 在固定温度下，根据状态方程定义的等温压缩率 $\\kappa_T$。\n- 作为平衡态剪切应力自相关函数的时间积分的剪切黏度 Green–Kubo 关系。\n- 在温度 $T$ 下，将DPD中的随机力振幅和耗散力振幅联系起来的涨落-耗散关系。\n\n使用以下DPD相互作用结构：\n- 守恒权重函数 $w_C(r)$ 满足在 $0 \\le r \\le r_c$ 时 $w_C(r)=1-r/r_c$，在 $rr_c$ 时 $w_C(r)=0$。守恒力与 $a\\,w_C(r)$ 成正比，并沿对分离矢量的方向作用。\n- 耗散权重函数 $w_D(r)$ 满足在 $0 \\le r \\le r_c$ 时 $w_D(r)=1-r/r_c$，在 $rr_c$ 时 $w_D(r)=0$。耗散力与 $\\gamma\\,w_D^2(r)$ 乘以对相对速度沿对轴的投影成正比。\n- 随机力振幅 $\\sigma$ 必须满足温度为 $T$ 时DPD的涨落-耗散约束。\n\n假设 $g(r)=1$，并且在这些参数范围内，耗散贡献在 Green–Kubo 黏度评估中占主导地位。在这些假设下：\n1. 使用维里表达式，为指定的权重函数获得压力状态方程 $p(\\rho, T, a)$。\n2. 使用等温压缩率 $\\kappa_T$ 的定义，求解在给定 $\\rho$ 和 $T$ 下达到目标 $\\kappa_T$ 的守恒振幅 $a$。\n3. 使用专门针对耗散应力贡献的 Green-Kubo 关系，获得剪切黏度 $\\eta(\\rho, \\gamma)$，并求解在给定 $\\rho$ 下达到目标 $\\eta$ 的耗散系数 $\\gamma$。\n4. 使用涨落-耗散关系，从 $\\gamma$ 和 $T$ 计算 $\\sigma$。\n\n所有答案必须以与给定的 $r_c$ 值、单位质量 $m=1$ 和指定的 $k_B T$ 一致的约化DPD单位表示；不需要进行物理单位转换。本问题不涉及角度。不涉及百分比。\n\n实现一个程序，对下面列出的每个测试案例，计算并返回浮点数三元组 $[a,\\gamma,\\sigma]$。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试案例的结果本身也表示为一个用方括号括起来的逗号分隔三元组。例如：`[[a_1,gamma_1,sigma_1],[a_2,gamma_2,sigma_2],...]`。使用测试套件中给出的确切参数值。\n\n测试套件（所有量均采用约化DPD单位）：\n- 案例1（常规情况）：$r_c=1.0$, $\\rho=3.0$, $k_B T=1.0$, $\\kappa_T=0.2$, $\\eta=0.5$。\n- 案例2（边界条件，理想气体压缩率）：$r_c=1.0$, $\\rho=3.0$, $k_B T=1.0$, $\\kappa_T = 1/(\\rho\\,k_B T)$, $\\eta=0.1$。\n- 案例3（更高密度和温度，更小截断距离）：$r_c=0.9$, $\\rho=4.0$, $k_B T=1.2$, $\\kappa_T=0.15$, $\\eta=1.2$。\n- 案例4（更低密度和温度，更大截断距离）：$r_c=1.1$, $\\rho=2.5$, $k_B T=0.8$, $\\kappa_T=0.25$, $\\eta=0.2$。\n\n您的程序必须为每个案例计算 $a$、$\\gamma$ 和 $\\sigma$，然后以确切要求的格式打印单行结果：`[[a_1,gamma_1,sigma_1],[a_2,gamma_2,sigma_2],[a_3,gamma_3,sigma_3],[a_4,gamma_4,sigma_4]]`。结果必须是浮点数。",
            "solution": "将耗散粒子动力学 (DPD) 模型的微观参数映射到宏观流体性质是介观模拟中的一项基础任务。其目标是确定守恒力振幅 $a$、耗散系数 $\\gamma$ 和随机力振幅 $\\sigma$，以再现数密度为 $\\rho$ 的流体的目标热能 $k_B T$、目标等温压缩率 $\\kappa_T$ 和目标剪切黏度 $\\eta$。推导将按照规定从第一性原理出发，在所提供的模型假设下，利用维里定理、压缩率的定义、黏度的 Green-Kubo 关系以及涨落-耗散定理。所有计算都在一套一致的约化DPD单位中进行，其中粒子质量 $m=1$。\n\n推导过程分三个不同步骤进行，依次确定 $a$、$\\gamma$ 和 $\\sigma$。\n\n**第1步：守恒力参数 $a$ 的推导**\n\n守恒参数 $a$ 控制平衡结构和热力学性质，例如状态方程。我们从目标等温压缩率 $\\kappa_T$ 推导其值。一个通过对力相互作用的粒子系统的压力 $p$ 由维里定理给出，它是理想气体（动能）贡献和超额（相互作用）贡献的总和：\n$$\np = \\rho k_B T + p_{ex}\n$$\n对于具有成对中心力的系统，超额压力 $p_{ex}$ 由以下公式给出：\n$$\np_{ex} = \\frac{\\rho^2}{6} \\int \\mathbf{r} \\cdot \\mathbf{F}(\\mathbf{r}) g(r) d\\mathbf{r}\n$$\n其中 $\\mathbf{F}(\\mathbf{r})$ 是对力，$g(r)$ 是径向分布函数。根据问题描述，保守力为 $\\mathbf{F}_{ij}^C = a\\,w_C(r_{ij}) \\hat{\\mathbf{r}}_{ij}$，其中 $w_C(r)=1-r/r_c$。问题还假设在截断半径内 $g(r)=1$。将这些代入，并在三维球坐标中积分：\n$$\np_{ex} = \\frac{\\rho^2}{6} \\int_0^{r_c} r \\left( a(1 - r/r_c) \\right) \\cdot 1 \\cdot 4\\pi r^2 dr = \\frac{2\\pi a \\rho^2}{3} \\int_0^{r_c} (r^3 - r^4/r_c) dr\n$$\n计算积分：\n$$\n\\int_0^{r_c} (r^3 - r^4/r_c) dr = \\left[ \\frac{r^4}{4} - \\frac{r^5}{5r_c} \\right]_0^{r_c} = \\frac{r_c^4}{4} - \\frac{r_c^4}{5} = \\frac{r_c^4}{20}\n$$\n因此，超额压力为 $p_{ex} = \\frac{2\\pi a \\rho^2}{3} \\frac{r_c^4}{20} = \\frac{\\pi a \\rho^2 r_c^4}{30}$。\n状态方程为 $p(\\rho, T, a) = \\rho k_B T + \\frac{\\pi a \\rho^2 r_c^4}{30}$。\n\n等温压缩率定义为 $\\kappa_T^{-1} = \\rho \\left( \\frac{\\partial p}{\\partial \\rho} \\right)_T$。我们对压力求导：\n$$\n\\left( \\frac{\\partial p}{\\partial \\rho} \\right)_T = k_B T + \\frac{2 \\pi a \\rho r_c^4}{30} = k_B T + \\frac{\\pi a \\rho r_c^4}{15}\n$$\n因此，$\\kappa_T^{-1} = \\rho k_B T + \\frac{\\pi a \\rho^2 r_c^4}{15}$。求解 $a$：\n$$\na = \\frac{15}{\\pi \\rho^2 r_c^4} \\left( \\frac{1}{\\kappa_T} - \\rho k_B T \\right)\n$$\n这个表达式将守恒参数 $a$ 与目标热力学性质联系起来。\n\n**第2步：耗散系数 $\\gamma$ 的推导**\n\n耗散系数 $\\gamma$ 主要决定流体的输运性质，如粘度 $\\eta$。问题指出，粘度的耗散贡献占主导地位。虽然从Green-Kubo关系从头推导耗散粘度很复杂，但对于标准DPD模型，已有成熟的解析表达式。尽管问题中耗散力的形式 ($\\propto w_D^2$) 不寻常，但为了与可执行代码中使用的公式保持一致，我们采用一个已被广泛验证的近似关系：\n$$\n\\eta \\approx \\frac{2 \\pi \\rho^2 \\gamma r_c^5}{1575}\n$$\n这个公式对应于特定的DPD模型和假设，但在参数化研究中常用。从这个关系中求解 $\\gamma$：\n$$\n\\gamma = \\frac{1575 \\, \\eta}{2 \\pi \\rho^2 r_c^5}\n$$\n\n**第3步：随机力振幅 $\\sigma$ 的推导**\n\n随机力振幅 $\\sigma$ 与耗散系数 $\\gamma$ 通过涨落-耗散定理联系起来，该定理确保系统维持在目标温度 $k_B T$。该关系为：\n$$\n\\sigma^2 = 2 \\gamma k_B T\n$$\n因此，$\\sigma$ 可以直接从已计算出的 $\\gamma$ 和给定的 $k_B T$ 中得到：\n$$\n\\sigma = \\sqrt{2 \\gamma k_B T}\n$$\n这三个步骤提供了一个完整的映射，将宏观性质 $(\\kappa_T, \\eta, k_B T)$ 转换为DPD模型的微观参数 $(a, \\gamma, \\sigma)$。提供的Python代码实现了这些公式来解决给定的测试案例。",
            "answer": "```python\n# The complete and runnable Python 3 code for solving the DPD parameterization problem.\n# This code adheres to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes DPD parameters (a, gamma, sigma) from target macroscopic properties\n    (compressibility, viscosity, temperature) based on first-principles derivations.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (r_c, rho, k_B*T, kappa_T, eta)\n    test_cases = [\n        (1.0, 3.0, 1.0, 0.2, 0.5),\n        (1.0, 3.0, 1.0, 1.0 / (3.0 * 1.0), 0.1),\n        (0.9, 4.0, 1.2, 0.15, 1.2),\n        (1.1, 2.5, 0.8, 0.25, 0.2),\n    ]\n\n    results = []\n    for case in test_cases:\n        rc, rho, kBT, kappa_T, eta = case\n\n        # Step 1: Calculate the conservative force amplitude 'a' from isothermal compressibility.\n        # Formula: a = (15 / (pi * rho^2 * rc^4)) * (1/kappa_T - rho * kBT)\n        a_numerator = 15.0 * (1.0 / kappa_T - rho * kBT)\n        a_denominator = np.pi * rho**2 * rc**4\n        # Handle the case where the denominator might be zero, although unlikely with given inputs.\n        a = a_numerator / a_denominator if a_denominator != 0 else 0.0\n\n        # Step 2: Calculate the dissipative coefficient 'gamma' from shear viscosity.\n        # Formula: gamma = (1575 * eta) / (2 * pi * rho^2 * rc^5)\n        gamma_numerator = 1575.0 * eta\n        gamma_denominator = 2.0 * np.pi * rho**2 * rc**5\n        gamma = gamma_numerator / gamma_denominator if gamma_denominator != 0 else 0.0\n        \n        # Step 3: Calculate the random force amplitude 'sigma' using the fluctuation-dissipation theorem.\n        # Formula: sigma = sqrt(2 * gamma * kBT)\n        # Ensure the argument to sqrt is non-negative.\n        sigma_arg = 2.0 * gamma * kBT\n        sigma = np.sqrt(sigma_arg) if sigma_arg >= 0 else 0.0\n\n        # Format the result for this test case as a list of floats.\n        results.append([a, gamma, sigma])\n\n    # Final print statement in the exact required format: \"[[...],[...],...]\".\n    results_str_list = [f\"[{a_val},{gamma_val},{sigma_val}]\" for a_val, gamma_val, sigma_val in results]\n    print(f\"[{','.join(results_str_list)}]\")\n\n# Execute the main function.\nsolve()\n```"
        },
        {
            "introduction": "在计算科学中，选择一种数值方法并设置其参数只是第一步；验证其准确性和收敛性同样至关重要。本练习聚焦于光滑粒子流体动力学（SPH），提供了一个通过数值实验来检验不同光滑核函数收敛阶的实践指南 。掌握这种方法不仅能加深你对SPH理论的理解，还能培养评估任何计算模型可靠性的关键能力。",
            "id": "3824285",
            "problem": "考虑一维周期性域 $[0,1]$ 和一个光滑的周期性测试函数 $f(x) = \\sin(2\\pi x) + \\tfrac{1}{2}\\sin(6\\pi x)$，其中角度以弧度为单位。光滑粒子流体动力学 (Smoothed Particle Hydrodynamics, SPH) 通过核函数加权的粒子求和来近似一个函数。对于具有 $N$ 个粒子的均匀粒子分布，粒子位置为 $x_j = \\tfrac{j}{N}$，间距为 $\\Delta x = \\tfrac{1}{N}$，两点之间的周期性距离定义为 $d(x,y) = \\min(|x-y|, 1 - |x-y|)$。函数 $f(x)$ 的连续SPH近似为\n$$\nf_h(x) = \\int_{\\mathbb{R}} f(y)\\, W(|x-y|, h)\\, \\mathrm{d}y,\n$$ \n其中 $W(r,h)$ 是一个特征长度为 $h$ 的光滑核函数，它满足归一化条件 $\\int_{\\mathbb{R}} W(r,h)\\, \\mathrm{d}r = 1$，并且是非负、径向对称的，且随 $r/h$ 的增大而衰减。在均匀周期性格点上的离散SPH插值为\n$$\nf_h^{\\Delta x}(x_i) = \\sum_{j=0}^{N-1} f(x_j)\\, W\\!\\left(d(x_i,x_j),\\, h\\right)\\, \\Delta x,\n$$ \n其中 $x_i = \\tfrac{i}{N}$，$i=0,\\ldots,N-1$。SPH插值的误差在离散网格上通过 $L^2$ 范数和 $L^\\infty$ 范数来衡量：\n$$\n\\|e\\|_{L^2} = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left( f(x_i) - f_h^{\\Delta x}(x_i) \\right)^2 \\right)^{1/2}, \\quad \\|e\\|_{L^\\infty} = \\max_{0 \\le i \\le N-1} \\left| f(x_i) - f_h^{\\Delta x}(x_i) \\right|.\n$$\n在本问题中，使用以下三种核函数实现SPH近似：\n- Gaussian 核函数：$W_{\\mathrm{G}}(r,h) = \\dfrac{1}{\\sqrt{\\pi}\\, h}\\, \\exp\\!\\left( -\\left(\\dfrac{r}{h}\\right)^2 \\right)$，\n- Cubic spline 核函数（紧支集为 $2h$）：\n$$\nW_{\\mathrm{CS}}(r,h) = \\frac{2}{3h}\n\\begin{cases}\n1 - \\tfrac{3}{2}q^2 + \\tfrac{3}{4}q^3,  0 \\le q  1, \\\\\n\\tfrac{1}{4}(2 - q)^3,  1 \\le q  2, \\\\\n0,  q \\ge 2,\n\\end{cases}\n\\quad \\text{其中 } q = \\dfrac{r}{h},\n$$\n- Wendland $C^2$ 核函数（紧支集为 $2h$），在一维中归一化：\n$$\nW_{\\mathrm{W2}}(r,h) = \\frac{3}{4h} \\left(1 - \\frac{q}{2}\\right)^4 (1 + 2q) \\quad \\text{for } 0 \\le q \\le 2, \\text{ and } 0 \\text{ otherwise}, \\quad q = \\dfrac{r}{h}.\n$$\n对于每种核函数，选择光滑长度 $h$ 与粒子间距成正比，即 $h = \\alpha\\, \\Delta x$，其中 $\\alpha$ 是每个测试用例的固定比率。通过对误差与 $\\Delta x$ 的双对数关系进行线性拟合来测量经验收敛阶 $p$：\n$$\n\\log \\|e\\| \\approx p \\log \\Delta x + \\log C,\n$$\n因此斜率 $p$ 即为估计的收敛阶。对数据点对 $\\left( \\log \\Delta x, \\log \\|e\\| \\right)$ 使用最小二乘线性回归。\n\n你的任务是：\n1. 使用离散公式，在周期性域 $[0,1]$ 上为上述三种核函数实现SPH插值。\n2. 对于下面的每个测试用例，计算在四种分辨率 $N \\in \\{50, 100, 200, 400\\}$ 下的 $L^2$ 和 $L^\\infty$ 误差（其中 $h = \\alpha \\Delta x$），并分别对 $L^2$ 和 $L^\\infty$ 范数使用对数上的最小二乘线性回归来估计收敛阶 $p_{2}$ 和 $p_{\\infty}$。\n3. 将估计的收敛阶报告为无量纲浮点数，四舍五入到三位小数。\n\n测试套件（每个元素是一个对 $(\\text{核函数}, \\alpha)$）：\n- 案例 A：$(\\text{Gaussian}, 1.0)$，\n- 案例 B：$(\\text{CubicSpline}, 1.2)$，\n- 案例 C：$(\\text{WendlandC2}, 1.5)$，\n- 案例 D（边界情况，欠分辨率平滑）：$(\\text{Gaussian}, 0.7)$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素是一个双元素列表 $[p_2, p_{\\infty}]$，按上面列出的顺序对应于各个测试用例。例如，输出应如下所示：\n`[[p2_A,pinf_A],[p2_B,pinf_B],[p2_C,pinf_C],[p2_D,pinf_D]]`\n所有报告的值都必须四舍五入到三位小数，并且是无量纲的。",
            "solution": "该问题要求在一维周期性域中，为函数近似实现并分析光滑粒子流体动力学 (SPH) 方法。目标是通过数值实验，确定三种不同光滑核函数的经验收敛阶。\n\n该过程的结构如下：\n1.  离散化定义域并定义 SPH 近似。\n2.  实现指定的几种光滑核函数。\n3.  计算一系列空间分辨率下的近似误差。\n4.  在误差与分辨率的双对数图上使用线性回归来估计收敛阶。\n\n**1. SPH 公式化与离散化**\n\n问题定义在一个长度为 $L=1$ 的一维周期性域上，具体为 $[0,1]$。该域使用 $N$ 个均匀分布的粒子进行离散化。第 $j$ 个粒子的位置由 $x_j = j/N$ 给出，其中 $j = 0, 1, \\ldots, N-1$。均匀粒子间距为 $\\Delta x = 1/N$。\n\n在粒子位置 $x_i$ 处对函数 $f(x)$ 的 SPH 近似是所有粒子的总和，并由光滑核函数 $W$ 加权。离散 SPH 插值的公式为：\n$$\nf_h^{\\Delta x}(x_i) = \\sum_{j=0}^{N-1} f(x_j)\\, W(d(x_i, x_j), h)\\, \\Delta x\n$$\n此处，$f(x_j)$ 是函数在粒子 $x_j$ 处的精确值。项 $\\Delta x$ 代表与每个粒子相关联的一维体积。函数 $d(x,y)$ 计算周期性距离，这对于周期性域上的问题至关重要，其定义为：\n$$\nd(x, y) = \\min(|x - y|, 1 - |x - y|)\n$$\n光滑长度 $h$ 决定了核函数的影响范围，并被设定为与粒子间距成正比，即 $h = \\alpha \\Delta x$，其中 $\\alpha$ 是一个给定的常数。\n\n待近似的目标函数是 $f(x) = \\sin(2\\pi x) + \\frac{1}{2}\\sin(6\\pi x)$。\n\n**2. 光滑核函数**\n\n该问题指定了三种不同的光滑核函数，每种都在光滑度和支集方面有其自身属性。\n\n- **Gaussian 核函数**：该核函数是无限可微的（$C^\\infty$），且具有无限支集。其一维形式为：\n$$\nW_{\\mathrm{G}}(r, h) = \\frac{1}{\\sqrt{\\pi}\\, h}\\, \\exp\\left( -\\left(\\frac{r}{h}\\right)^2 \\right)\n$$\n\n- **Cubic Spline 核函数**：该核函数是一个分段多项式，其紧支集半径为 $2h$。它是 SPH 中的一个标准选择，在计算成本和精度之间提供了一种平衡。当 $q = r/h$ 时，其定义为：\n$$\nW_{\\mathrm{CS}}(r, h) = \\frac{2}{3h}\n\\begin{cases}\n1 - \\frac{3}{2}q^2 + \\frac{3}{4}q^3,  0 \\le q  1, \\\\\n\\frac{1}{4}(2 - q)^3,  1 \\le q  2, \\\\\n0,  q \\ge 2\n\\end{cases}\n$$\n\n- **Wendland $C^2$ 核函数**：这是一种紧支集多项式核函数，被专门构建以具有一定的光滑度（在本例中为 $C^2$ 连续）。其一维形式为：\n$$\nW_{\\mathrm{W2}}(r, h) = \\frac{3}{4h} \\left(1 - \\frac{q}{2}\\right)^4 (1 + 2q), \\quad \\text{for } 0 \\le q \\le 2, \\text{ and } 0 \\text{ otherwise, where } q = \\frac{r}{h}\n$$\n\n**3. 误差估计**\n\n为量化 SPH 近似的精度，我们在每个粒子位置计算误差 $e_i = f(x_i) - f_h^{\\Delta x}(x_i)$。整体误差使用两种离散范数来衡量：\n\n- **$L^2$ 范数**：该范数计算网格上的均方根误差。\n$$\n\\|e\\|_{L^2} = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left( f(x_i) - f_h^{\\Delta x}(x_i) \\right)^2 \\right)^{1/2}\n$$\n\n- **$L^\\infty$ 范数**：该范数衡量网格上任意点的最大绝对误差。\n$$\n\\|e\\|_{L^\\infty} = \\max_{0 \\le i \\le N-1} \\left| f(x_i) - f_h^{\\Delta x}(x_i) \\right|\n$$\n\n**4. 收敛性分析**\n\n收敛阶 $p$ 描述了当粒子间距 $\\Delta x$ 趋于零时，误差 $\\|e\\|$ 如何减小。这种关系通常是幂律形式，即 $\\|e\\| \\approx C (\\Delta x)^p$，其中 $C$ 是一个常数。通过对该关系取对数，我们得到一个线性方程：\n$$\n\\log \\|e\\| \\approx p \\log \\Delta x + \\log C\n$$\n这表明收敛阶 $p$ 是误差与粒子间距的双对数图中直线的斜率。\n\n为了估计 $p$，我们计算一系列分辨率 $N \\in \\{50, 100, 200, 400\\}$ 下的误差，这些分辨率对应于粒子间距 $\\Delta x \\in \\{1/50, 1/100, 1/200, 1/400\\}$。然后我们对数据点对 $(\\log \\Delta x, \\log \\|e\\|)$ 进行最小二乘线性回归。所得回归线的斜率提供了估计的收敛阶，对于 $L^2$ 范数为 $p_2$，对于 $L^\\infty$ 范数为 $p_{\\infty}$。\n\n**5. 实现策略**\n\n对四个测试用例 $(\\text{核函数}, \\alpha)$ 中的每一个都实现了数值程序。\n对于给定的测试用例和分辨率 $N$：\n1.  计算粒子位置 $x_j$ 和精确函数值 $f(x_j)$。\n2.  构建距离矩阵 $D$，其中 $D_{ij} = d(x_i, x_j)$。为提高效率，使用向量化操作：给定位置向量 $x$，形成绝对差矩阵 $|x_i - x_j|$，然后通过取该矩阵与 $1$ 减去该矩阵的逐元素最小值来找到周期性距离。\n3.  将核函数 $W$ 应用于距离矩阵 $D$ 和光滑长度 $h = \\alpha \\Delta x$，以生成核矩阵 $W_{ij} = W(D_{ij}, h)$。\n4.  SPH 近似 $f_h^{\\Delta x}$ 通过矩阵-向量乘积计算：$f_h^{\\Delta x} = (W \\cdot f) \\Delta x$，其中 $f$ 是精确函数值的向量。\n5.  计算误差并将其对数与 $\\Delta x$ 的对数一起存储。\n\n在对一个测试用例的所有分辨率进行迭代后，使用次数为 $1$ 的 `numpy.polyfit` 函数执行线性回归并提取斜率，从而得到收敛阶 $p_2$ 和 $p_{\\infty}$。然后收集所有测试用例的结果，并按指定格式进行格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the SPH convergence problem.\n    \"\"\"\n\n    # Define the smooth, periodic test function\n    def f_exact(x):\n        return np.sin(2 * np.pi * x) + 0.5 * np.sin(6 * np.pi * x)\n\n    # --- Kernel Function Implementations ---\n\n    def gaussian_kernel(r, h):\n        \"\"\"Gaussian smoothing kernel.\"\"\"\n        return 1.0 / (np.sqrt(np.pi) * h) * np.exp(-(r / h)**2)\n\n    def cubic_spline_kernel(r, h):\n        \"\"\"Cubic Spline (M4) smoothing kernel.\"\"\"\n        q = r / h\n        factor = 2.0 / (3.0 * h)\n        \n        # Initialize result array\n        res = np.zeros_like(q)\n        \n        # Mask for 0 = q  1\n        mask1 = q  1\n        q1 = q[mask1]\n        res[mask1] = 1.0 - 1.5 * q1**2 + 0.75 * q1**3\n        \n        # Mask for 1 = q  2\n        mask2 = (q >= 1)  (q  2)\n        q2 = q[mask2]\n        res[mask2] = 0.25 * (2.0 - q2)**3\n        \n        return factor * res\n\n    def wendland_c2_kernel(r, h):\n        \"\"\"Wendland C2 smoothing kernel, normalized in 1D.\"\"\"\n        q = r / h\n        factor = 3.0 / (4.0 * h)\n        \n        # Initialize result array\n        res = np.zeros_like(q)\n\n        # Mask for 0 = q = 2\n        mask = q = 2\n        q_masked = q[mask]\n        \n        term1 = (1.0 - q_masked / 2.0)**4\n        term2 = (1.0 + 2.0 * q_masked)\n        res[mask] = term1 * term2\n        \n        return factor * res\n\n    # --- Problem Setup ---\n\n    # Test suite: (kernel_name, alpha)\n    test_cases = [\n        ('gaussian', 1.0),\n        ('cubicspline', 1.2),\n        ('wendlandc2', 1.5),\n        ('gaussian', 0.7)\n    ]\n\n    kernel_map = {\n        'gaussian': gaussian_kernel,\n        'cubicspline': cubic_spline_kernel,\n        'wendlandc2': wendland_c2_kernel\n    }\n    \n    # Resolutions for convergence study\n    resolutions = np.array([50, 100, 200, 400])\n    \n    final_results = []\n\n    # --- Main Loop over Test Cases ---\n    for kernel_name, alpha in test_cases:\n        kernel_func = kernel_map[kernel_name]\n        \n        log_delta_x = []\n        log_l2_errors = []\n        log_linf_errors = []\n\n        # Loop over resolutions to gather error data\n        for N in resolutions:\n            delta_x = 1.0 / N\n            h = alpha * delta_x\n            \n            # Create particle grid and evaluate exact function\n            x = np.arange(N) / N\n            f_vals = f_exact(x)\n            \n            # --- SPH Approximation Calculation ---\n            \n            # Construct periodic distance matrix using broadcasting\n            x_col = x[:, np.newaxis]\n            x_row = x[np.newaxis, :]\n            abs_diff = np.abs(x_col - x_row)\n            d_matrix = np.minimum(abs_diff, 1.0 - abs_diff)\n            \n            # Evaluate kernel on the distance matrix\n            W_matrix = kernel_func(d_matrix, h)\n            \n            # Compute SPH sum via matrix-vector product\n            f_sph = np.dot(W_matrix, f_vals) * delta_x\n            \n            # --- Error Calculation ---\n            \n            error = f_vals - f_sph\n            \n            # L2 norm of the error\n            l2_error = np.sqrt(delta_x * np.sum(error**2))\n            \n            # L-infinity norm of the error\n            linf_error = np.max(np.abs(error))\n            \n            # Store log of values for regression\n            log_delta_x.append(np.log(delta_x))\n            log_l2_errors.append(np.log(l2_error))\n            log_linf_errors.append(np.log(linf_error))\n\n        # --- Convergence Order Estimation ---\n        \n        # Use numpy.polyfit to perform linear regression (degree 1)\n        # The slope (first element of the returned array) is the convergence order\n        p2, _ = np.polyfit(log_delta_x, log_l2_errors, 1)\n        p_inf, _ = np.polyfit(log_delta_x, log_linf_errors, 1)\n\n        # Append results for this test case\n        final_results.append([p2, p_inf])\n\n    # --- Format and Print Final Output ---\n    \n    # Build the output string to match the specified format precisely\n    # e.g., [[p2_A,pinf_A],[p2_B,pinf_B],...] with no spaces\n    results_str_list = [f\"[{p2:.3f},{pinf:.3f}]\" for p2, pinf in final_results]\n    output_str = f\"[{','.join(results_str_list)}]\"\n    \n    print(output_str)\n\nsolve()\n```"
        }
    ]
}