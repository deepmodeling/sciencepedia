{
    "hands_on_practices": [
        {
            "introduction": "粗粒化建模的第一步是从高分辨率的原子表征映射到简化的低分辨率表征。对于刚性分子或分子片段，一个常见且有效的方法是将其视为一个整体的刚体，其状态由质心位置和空间朝向来描述。本练习将引导你亲手实践这一映射过程，从一组给定的原子坐标中计算出刚性分子的质心和表示其朝向的四元数，这是构建许多粗粒化模型的基础技能。",
            "id": "3835541",
            "problem": "考虑一个三维空间中三聚体分子的刚性粗粒化映射，该映射将全原子坐标简化为质心和单位方向四元数。设该分子由三个等质量的原子（$m_{1} = m_{2} = m_{3}$）组成，其在体固定坐标系中的固定参考几何构型由以下位置给出：\n$$\n\\mathbf{s}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad\n\\mathbf{s}_{2} = \\begin{pmatrix} -\\tfrac{1}{2} \\\\ \\tfrac{\\sqrt{3}}{2} \\\\ 0 \\end{pmatrix}, \\quad\n\\mathbf{s}_{3} = \\begin{pmatrix} -\\tfrac{1}{2} \\\\ -\\tfrac{\\sqrt{3}}{2} \\\\ 0 \\end{pmatrix},\n$$\n它们满足 $\\sum_{i=1}^{3} m_{i} \\mathbf{s}_{i} = \\mathbf{0}$。在实验室坐标系中，一个观测到的构型由以下原子坐标给出：\n$$\n\\mathbf{r}_{1} = \\begin{pmatrix} 1 \\\\ 3 \\\\ 3 \\end{pmatrix}, \\quad\n\\mathbf{r}_{2} = \\begin{pmatrix} 1 - \\tfrac{\\sqrt{3}}{2} \\\\ \\tfrac{3}{2} \\\\ 3 \\end{pmatrix}, \\quad\n\\mathbf{r}_{3} = \\begin{pmatrix} 1 + \\tfrac{\\sqrt{3}}{2} \\\\ \\tfrac{3}{2} \\\\ 3 \\end{pmatrix}.\n$$\n所有坐标的单位均为纳米，质量相等且有限。\n\n任务：\n1. 从第一性原理（刚体运动学、质量加权定义和三维正交Procrustes对齐）出发，明确地构建一个非线性粗粒化映射，该映射将 $\\{\\mathbf{r}_{i}\\}_{i=1}^{3}$ 映至质心 $\\mathbf{R}$ 和方向单位四元数 $\\mathbf{q} = (q_{0}, q_{1}, q_{2}, q_{3})$（标量优先约定）。该四元数被定义为将参考坐标 $\\{\\mathbf{s}_{i}\\}_{i=1}^{3}$ 与中心化的实验室坐标 $\\{\\mathbf{r}_{i} - \\mathbf{R}\\}_{i=1}^{3}$ 进行质量加权最小二乘对齐的唯一最大化子（在已知的双重覆盖 $\\mathbf{q} \\sim -\\mathbf{q}$ 意义下）。您的公式必须包括对 $\\mathbf{q}$ 的归一化约束和一个明确的符号约定，以确定四元数等价类的代表元。\n2. 使用您构建的显式映射，计算给定数据的粗粒化变量。采纳 $q_{0} > 0$ 的约定。质心以纳米为单位表示，四元数分量为无量纲数。如果您对根式进行近似，请将最终数值四舍五入至四位有效数字；否则，请给出精确值。\n\n将您的最终答案以单行矩阵的形式报告，其中包含七个粗粒化变量，顺序为 $(R_{x}, R_{y}, R_{z}, q_{0}, q_{1}, q_{2}, q_{3})$。",
            "solution": "该问题被评估为具有科学依据、良定且客观。它代表了多尺度材料模拟中从刚性分子的原子坐标确定其粗粒化坐标（质心和方向）的标准流程。问题提供了唯一解所需的所有数据和定义。因此，我将进行完整的推导。\n\n粗粒化映射将全原子坐标集 $\\{\\mathbf{r}_{i}\\}_{i=1}^{3}$ 变换为质心向量 $\\mathbf{R}$ 和方向单位四元数 $\\mathbf{q}$。\n\n**1. 粗粒化映射的构建**\n\n**质心 ($\\mathbf{R}$):**\n质心 $\\mathbf{R}$ 是原子位置 $\\mathbf{r}_{i}$ 的质量加权平均值：\n$$\n\\mathbf{R} = \\frac{\\sum_{i=1}^{3} m_{i} \\mathbf{r}_{i}}{\\sum_{i=1}^{3} m_{i}}\n$$\n鉴于质量相等，$m_{1} = m_{2} = m_{3} = m$，该表达式简化为位置向量的算术平均值：\n$$\n\\mathbf{R} = \\frac{m(\\mathbf{r}_{1} + \\mathbf{r}_{2} + \\mathbf{r}_{3})}{3m} = \\frac{1}{3} (\\mathbf{r}_{1} + \\mathbf{r}_{2} + \\mathbf{r}_{3})\n$$\n\n**方向四元数 ($\\mathbf{q}$):**\n方向是通过找到一个旋转来确定的，该旋转能将中心化的实验室坐标 $\\mathbf{r}'_{i} = \\mathbf{r}_{i} - \\mathbf{R}$ 与参考体固定坐标 $\\mathbf{s}_{i}$ 最佳地对齐。这通过解决正交Procrustes问题来实现，该问题涉及最小化质量加权的平方偏差和：\n$$\nL(\\mathbf{Q}) = \\sum_{i=1}^{3} m_{i} \\|\\mathbf{r}'_{i} - \\mathbf{Q} \\mathbf{s}_{i}\\|^{2}\n$$\n其中 $\\mathbf{Q}$ 是一个 $3 \\times 3$ 的真旋转矩阵（$\\mathbf{Q}^{T}\\mathbf{Q} = \\mathbf{I}$，$\\det(\\mathbf{Q})=1$）。由于所有质量 $m_i$ 都相等且为正，最小化 $L(\\mathbf{Q})$ 等价于最小化 $\\frac{L(\\mathbf{Q})}{m} = \\sum_{i=1}^{3} \\|\\mathbf{r}'_{i} - \\mathbf{Q} \\mathbf{s}_{i}\\|^{2}$。\n\n展开平方范数，我们发现最小化此和等价于最大化项 $\\text{Tr}(\\mathbf{Q} \\mathbf{C})$，其中 $\\mathbf{C}$ 是由下式给出的相关矩阵：\n$$\n\\mathbf{C} = \\sum_{i=1}^{3} \\mathbf{s}_{i} (\\mathbf{r}'_{i})^{T}\n$$\n这个最大化问题的解是通过对 $\\mathbf{C}$ 进行奇异值分解 (SVD) 得到的。设 $\\mathbf{C}$ 的SVD为 $\\mathbf{C} = \\mathbf{U} \\mathbf{\\Sigma} \\mathbf{V}^{T}$，其中 $\\mathbf{U}$ 和 $\\mathbf{V}$ 是正交矩阵，$\\mathbf{\\Sigma}$ 是奇异值构成的对角矩阵。最优旋转矩阵 $\\mathbf{Q}$ 由下式给出：\n$$\n\\mathbf{Q} = \\mathbf{V} \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  \\det(\\mathbf{V}\\mathbf{U}^{T}) \\end{pmatrix} \\mathbf{U}^{T}\n$$\n这个公式确保 $\\mathbf{Q}$ 是一个真旋转，校正了任何潜在的反射。\n\n一旦找到最优旋转矩阵 $\\mathbf{Q}$，就使用标量优先约定将其转换为单位四元数 $\\mathbf{q} = (q_{0}, q_{1}, q_{2}, q_{3})$。其分量由下式给出：\n$$\n\\begin{aligned}\nq_{0} = \\frac{1}{2} \\sqrt{1 + \\text{Tr}(\\mathbf{Q})} \\\\\nq_{1} = \\frac{Q_{32} - Q_{23}}{4q_{0}} \\\\\nq_{2} = \\frac{Q_{13} - Q_{31}}{4q_{0}} \\\\\nq_{3} = \\frac{Q_{21} - Q_{12}}{4q_{0}}\n\\end{aligned}\n$$\n其中 $Q_{ij}$ 是 $\\mathbf{Q}$ 的元素。问题指定了约定 $q_{0} > 0$，这通过取 $q_0$ 的正根来满足。这一选择从等价类 $(\\mathbf{q} \\sim -\\mathbf{q})$ 中固定了四元数的代表元。\n\n**2. 应用于给定数据**\n\n**计算质心 $\\mathbf{R}$：**\n使用给定的实验室坐标：\n$$\n\\mathbf{r}_{1} = \\begin{pmatrix} 1 \\\\ 3 \\\\ 3 \\end{pmatrix}, \\quad\n\\mathbf{r}_{2} = \\begin{pmatrix} 1 - \\frac{\\sqrt{3}}{2} \\\\ \\frac{3}{2} \\\\ 3 \\end{pmatrix}, \\quad\n\\mathbf{r}_{3} = \\begin{pmatrix} 1 + \\frac{\\sqrt{3}}{2} \\\\ \\frac{3}{2} \\\\ 3 \\end{pmatrix}\n$$\n$$\n\\mathbf{R} = \\frac{1}{3} \\left( \\begin{pmatrix} 1 \\\\ 3 \\\\ 3 \\end{pmatrix} + \\begin{pmatrix} 1 - \\frac{\\sqrt{3}}{2} \\\\ \\frac{3}{2} \\\\ 3 \\end{pmatrix} + \\begin{pmatrix} 1 + \\frac{\\sqrt{3}}{2} \\\\ \\frac{3}{2} \\\\ 3 \\end{pmatrix} \\right) = \\frac{1}{3} \\begin{pmatrix} 3 \\\\ 6 \\\\ 9 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix}\n$$\n质心为 $\\mathbf{R} = (1, 2, 3)$。\n\n**计算中心化坐标 $\\mathbf{r}'_i = \\mathbf{r}_i - \\mathbf{R}$：**\n$$\n\\mathbf{r}'_{1} = \\begin{pmatrix} 1 \\\\ 3 \\\\ 3 \\end{pmatrix} - \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\mathbf{r}'_{2} = \\begin{pmatrix} 1 - \\frac{\\sqrt{3}}{2} \\\\ \\frac{3}{2} \\\\ 3 \\end{pmatrix} - \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} = \\begin{pmatrix} -\\frac{\\sqrt{3}}{2} \\\\ -\\frac{1}{2} \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\mathbf{r}'_{3} = \\begin{pmatrix} 1 + \\frac{\\sqrt{3}}{2} \\\\ \\frac{3}{2} \\\\ 3 \\end{pmatrix} - \\begin{pmatrix} 1 \\\\ 2 \\\\ 3 \\end{pmatrix} = \\begin{pmatrix} \\frac{\\sqrt{3}}{2} \\\\ -\\frac{1}{2} \\\\ 0 \\end{pmatrix}\n$$\n\n**计算相关矩阵 $\\mathbf{C}$：**\n参考坐标为：\n$$\n\\mathbf{s}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad\n\\mathbf{s}_{2} = \\begin{pmatrix} -\\frac{1}{2} \\\\ \\frac{\\sqrt{3}}{2} \\\\ 0 \\end{pmatrix}, \\quad\n\\mathbf{s}_{3} = \\begin{pmatrix} -\\frac{1}{2} \\\\ -\\frac{\\sqrt{3}}{2} \\\\ 0 \\end{pmatrix}\n$$\n相关矩阵 $\\mathbf{C} = \\sum_{i=1}^{3} \\mathbf{s}_{i} (\\mathbf{r}'_{i})^{T}$ 计算如下：\n$$\n\\mathbf{C} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} \\begin{pmatrix} 0  1  0 \\end{pmatrix} + \\begin{pmatrix} -\\frac{1}{2} \\\\ \\frac{\\sqrt{3}}{2} \\\\ 0 \\end{pmatrix} \\begin{pmatrix} -\\frac{\\sqrt{3}}{2}  -\\frac{1}{2}  0 \\end{pmatrix} + \\begin{pmatrix} -\\frac{1}{2} \\\\ -\\frac{\\sqrt{3}}{2} \\\\ 0 \\end{pmatrix} \\begin{pmatrix} \\frac{\\sqrt{3}}{2}  -\\frac{1}{2}  0 \\end{pmatrix}\n$$\n$$\n\\mathbf{C} = \\begin{pmatrix} 0  1  0 \\\\ 0  0  0 \\\\ 0  0  0 \\end{pmatrix} + \\begin{pmatrix} \\frac{\\sqrt{3}}{4}  \\frac{1}{4}  0 \\\\ -\\frac{3}{4}  -\\frac{\\sqrt{3}}{4}  0 \\\\ 0  0  0 \\end{pmatrix} + \\begin{pmatrix} -\\frac{\\sqrt{3}}{4}  \\frac{1}{4}  0 \\\\ -\\frac{3}{4}  \\frac{\\sqrt{3}}{4}  0 \\\\ 0  0  0 \\end{pmatrix}\n= \\begin{pmatrix} 0  \\frac{3}{2}  0 \\\\ -\\frac{3}{2}  0  0 \\\\ 0  0  0 \\end{pmatrix}\n$$\n\n**对 $\\mathbf{C}$ 进行SVD并求出 $\\mathbf{Q}$：**\n设 $\\mathbf{C}$ 的SVD为 $\\mathbf{C} = \\mathbf{U} \\mathbf{\\Sigma} \\mathbf{V}^{T}$。\n矩阵为：\n$$\n\\mathbf{U} = \\begin{pmatrix} 0  1  0 \\\\ -1  0  0 \\\\ 0  0  1 \\end{pmatrix}, \\quad\n\\mathbf{\\Sigma} = \\begin{pmatrix} \\frac{3}{2}  0  0 \\\\ 0  \\frac{3}{2}  0 \\\\ 0  0  0 \\end{pmatrix}, \\quad\n\\mathbf{V} = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} = \\mathbf{I}\n$$\n我们从 $\\mathbf{V}\\mathbf{U}^{T}$ 开始计算 $\\mathbf{Q}$：\n$$\n\\mathbf{V}\\mathbf{U}^{T} = \\mathbf{I} \\begin{pmatrix} 0  -1  0 \\\\ 1  0  0 \\\\ 0  0  1 \\end{pmatrix} = \\begin{pmatrix} 0  -1  0 \\\\ 1  0  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n行列式为 $\\det(\\mathbf{V}\\mathbf{U}^{T}) = 1$。因此，无需校正。\n$$\n\\mathbf{Q} = \\mathbf{V}\\mathbf{U}^{T} = \\begin{pmatrix} 0  -1  0 \\\\ 1  0  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\n该旋转矩阵表示绕z轴旋转 $+\\frac{\\pi}{2}$ 弧度（$90^\\circ$）。\n\n**将 $\\mathbf{Q}$ 转换为四元数 $\\mathbf{q}$：**\n$\\mathbf{Q}$ 的迹为 $\\text{Tr}(\\mathbf{Q}) = 0 + 0 + 1 = 1$。\n现在我们计算四元数的分量：\n$$\nq_{0} = \\frac{1}{2} \\sqrt{1 + 1} = \\frac{\\sqrt{2}}{2}\n$$\n$$\nq_{1} = \\frac{Q_{32} - Q_{23}}{4q_{0}} = \\frac{0 - 0}{4(\\frac{\\sqrt{2}}{2})} = 0\n$$\n$$\nq_{2} = \\frac{Q_{13} - Q_{31}}{4q_{0}} = \\frac{0 - 0}{4(\\frac{\\sqrt{2}}{2})} = 0\n$$\n$$\nq_{3} = \\frac{Q_{21} - Q_{12}}{4q_{0}} = \\frac{1 - (-1)}{4(\\frac{\\sqrt{2}}{2})} = \\frac{2}{2\\sqrt{2}} = \\frac{1}{\\sqrt{2}} = \\frac{\\sqrt{2}}{2}\n$$\n得到的四元数是 $\\mathbf{q} = (\\frac{\\sqrt{2}}{2}, 0, 0, \\frac{\\sqrt{2}}{2})$。分量 $q_0$ 为正，满足指定的约定。这些值为精确值。\n\n最终的粗粒化变量是质心向量 $\\mathbf{R}$ 和方向四元数 $\\mathbf{q}$ 的分量。\n$\\mathbf{R} = (1, 2, 3)$ nm。\n$\\mathbf{q} = (\\frac{\\sqrt{2}}{2}, 0, 0, \\frac{\\sqrt{2}}{2})$。\n最终答案向量为 $(R_x, R_y, R_z, q_0, q_1, q_2, q_3)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1  2  3  \\frac{\\sqrt{2}}{2}  0  0  \\frac{\\sqrt{2}}{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在确定了粗粒化表征之后，下一个核心挑战是推导这些新单元之间的有效相互作用（即力和势能）。力匹配法是一种强大的“自下而上”技术，它通过最小化粗粒化模型产生的力与底层原子模拟计算出的精确力之间的差异，来系统地参数化粗粒化势能。本练习将让你通过编程实现这一方法，将最小二乘优化的理论概念与具体的参数化任务联系起来，从而掌握一种核心的势能开发技术。",
            "id": "3835558",
            "problem": "您的任务是实现一个最小二乘力匹配程序，用于在一维设置中从原子级力数据估计粗粒化势参数。从以下基础开始：粗粒化势表示为基函数的线性组合，而粗粒化力是该势的负梯度。具体来说，设粗粒化势为 $U(r) = \\sum_{k=1}^{K} c_k \\,\\phi_k(r)$，其中 $c_k$ 是未知的标量参数，$\\{\\phi_k(r)\\}$ 是坐标 $r$ 的已知基函数。粗粒化力定义为 $F_{\\mathrm{CG}}(r;\\mathbf{c}) = -\\frac{dU}{dr}(r) = -\\sum_{k=1}^{K} c_k \\,\\frac{d\\phi_k}{dr}(r)$。给定在坐标 $\\{r_i\\}_{i=1}^{N}$ 处的原子级力样本 $\\{F_{\\mathrm{atom}}(r_i)\\}_{i=1}^{N}$，力匹配的目标是找到一个 $\\mathbf{c} \\in \\mathbb{R}^K$，以最小化残差范数 $\\left\\| \\mathbf{y} - \\mathbf{A}\\mathbf{c}\\right\\|_2^2$，其中设计矩阵 $\\mathbf{A} \\in \\mathbb{R}^{N \\times K}$ 的元素为 $A_{ik} = -\\frac{d\\phi_k}{dr}(r_i)$，向量 $\\mathbf{y} \\in \\mathbb{R}^N$ 的元素为 $y_i = F_{\\mathrm{atom}}(r_i)$。\n\n您的程序必须：\n- 为每个测试用例，根据提供的基函数和坐标构建 $\\mathbf{A}$。\n- 为每个测试用例，根据提供的原子级力构建 $\\mathbf{y}$。在下述所有测试用例中，$\\mathbf{y}$ 都是通过 $\\mathbf{y} = \\mathbf{A}\\mathbf{c}^\\star$ 从一个已知的参数矢量 $\\mathbf{c}^\\star$ 确定性地生成的，从而确保对最小二乘估计量的一致评估。\n- 计算最小二乘解 $\\widehat{\\mathbf{c}}$，该解最小化 $\\left\\| \\mathbf{y} - \\mathbf{A}\\mathbf{c}\\right\\|_2^2$。在 $\\mathbf{A}$ 是秩亏的或系统是欠定的情况下，使用 Moore–Penrose 伪逆来获得最小范数最小二乘解。\n- 报告每个测试用例的估计参数矢量 $\\widehat{\\mathbf{c}}$。\n\n此问题中的所有量都是无量纲的。将数值结果表示为四舍五入到 $6$ 位小数的浮点数。\n\n测试套件：\n使用以下四个测试用例，每个用例描述了 $\\{\\phi_k(r)\\}$、坐标 $\\{r_i\\}$、样本数 $N$、基函数数 $K$ 以及基准真相参数矢量 $\\mathbf{c}^\\star$。\n\n- 测试用例 1（高矩阵，满列秩）：\n  - 基函数：$\\phi_1(r) = r^2$，$\\phi_2(r) = \\sin(r)$，$\\phi_3(r) = e^{-r}$。\n  - 坐标：$r = [0.0, 0.5, 1.0, 1.5, 2.0]$，其中 $N=5$。\n  - 参数：$\\mathbf{c}^\\star = [0.8, -1.2, 0.5]$，其中 $K=3$。\n  - 原子级力：$F_{\\mathrm{atom}}(r_i) = F_{\\mathrm{CG}}(r_i;\\mathbf{c}^\\star)$ 对于每个 $i$。\n- 测试用例 2（方阵，恰定）：\n  - 基函数：$\\phi_1(r) = r^2$，$\\phi_2(r) = \\sin(r)$，$\\phi_3(r) = e^{-r}$。\n  - 坐标：$r = [0.3, 1.0, 1.7]$，其中 $N=3$。\n  - 参数：$\\mathbf{c}^\\star = [-0.4, 2.0, -0.1]$，其中 $K=3$。\n  - 原子级力：$F_{\\mathrm{atom}}(r_i) = F_{\\mathrm{CG}}(r_i;\\mathbf{c}^\\star)$ 对于每个 $i$。\n- 测试用例 3（高矩阵，因基函数重复而秩亏）：\n  - 基函数：$\\phi_1(r) = r$，$\\phi_2(r) = r$，$\\phi_3(r) = r^3$。\n  - 坐标：$r = [0.2, 0.6, 1.1, 1.5]$，其中 $N=4$。\n  - 参数：$\\mathbf{c}^\\star = [1.0, -1.0, 0.5]$，其中 $K=3$。\n  - 原子级力：$F_{\\mathrm{atom}}(r_i) = F_{\\mathrm{CG}}(r_i;\\mathbf{c}^\\star)$ 对于每个 $i$。\n- 测试用例 4（欠定，最小范数解）：\n  - 基函数：$\\phi_1(r) = r$，$\\phi_2(r) = r^2$，$\\phi_3(r) = \\sin(r)$，$\\phi_4(r) = e^{-r}$。\n  - 坐标：$r = [0.2, 1.0]$，其中 $N=2$。\n  - 参数：$\\mathbf{c}^\\star = [1.0, 0.5, -0.3, 0.2]$，其中 $K=4$。\n  - 原子级力：$F_{\\mathrm{atom}}(r_i) = F_{\\mathrm{CG}}(r_i;\\mathbf{c}^\\star)$ 对于每个 $i$。\n\n实现细节：\n- 对每组基函数，通过 $A_{ik} = -\\frac{d\\phi_k}{dr}(r_i)$ 计算设计矩阵的元素。\n- 将 $\\mathbf{y}$ 构建为 $\\mathbf{A}\\mathbf{c}^\\star$。\n- 使用一个数值稳定的最小二乘求解器计算 $\\widehat{\\mathbf{c}}$，当出现非唯一解时，该求解器会产生最小范数解。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个测试用例的估计系数矢量的列表，格式为方括号括起来的、以逗号分隔的列表的列表。每个内部列表必须包含 $K$ 个系数，四舍五入到 $6$ 位小数，并以标准十进制表示法表示。例如，输出必须类似于 $[[c_{1,1},c_{1,2},\\dots],[c_{2,1},\\dots],\\dots]$。",
            "solution": "该问题要求实现一个最小二乘力匹配程序，以确定粗粒化势的参数 $\\mathbf{c}$。势函数以基函数的线性组合形式给出，$U(r) = \\sum_{k=1}^{K} c_k \\phi_k(r)$。相应的粗粒化力为 $F_{\\mathrm{CG}}(r;\\mathbf{c}) = -\\frac{dU}{dr}(r) = -\\sum_{k=1}^{K} c_k \\frac{d\\phi_k}{dr}(r)$。\n\n该问题被构建为一个线性最小二乘问题。给定一组在相应坐标 $\\{r_i\\}$ 处的 $N$ 个原子级力样本 $\\{F_{\\mathrm{atom}}(r_i)\\}$，我们的目标是找到能最好地再现这些力的系数矢量 $\\mathbf{c} = [c_1, c_2, \\dots, c_K]^T$。这是通过最小化残差矢量的欧几里得范数的平方 $\\left\\| \\mathbf{y} - \\mathbf{A}\\mathbf{c}\\right\\|_2^2$ 来实现的。\n\n这个标准线性模型的组成部分定义如下：\n1.  设计矩阵 $\\mathbf{A} \\in \\mathbb{R}^{N \\times K}$，其元素由在样本坐标处求值的基函数的负导数给出：$A_{ik} = -\\frac{d\\phi_k}{dr}(r_i)$。$\\mathbf{A}$ 的每一列代表单个基函数对所有样本点上力的贡献。\n2.  观测矢量 $\\mathbf{y} \\in \\mathbb{R}^N$，其中包含原子级力样本：$y_i = F_{\\mathrm{atom}}(r_i)$。在本问题中，这些力是根据一个已知的基准真相参数矢量 $\\mathbf{c}^\\star$ 确定性地生成的，使得 $\\mathbf{y} = \\mathbf{A}\\mathbf{c}^\\star$。这意味着存在一个残差为零的完美解。\n\n任务是计算最小二乘解 $\\widehat{\\mathbf{c}}$。该解的性质取决于矩阵 $\\mathbf{A}$ 的属性：\n- 如果 $\\mathbf{A}$ 具有满列秩（即 $\\mathrm{rank}(\\mathbf{A}) = K$），则系统有唯一的最小二乘解。这种情况发生在测试用例 1 和 2 中。由于 $\\mathbf{y}$ 位于 $\\mathbf{A}$ 的列空间中（根据构造），解 $\\widehat{\\mathbf{c}}$ 将精确等于 $\\mathbf{c}^\\star$（在数值精度范围内）。\n- 如果 $\\mathbf{A}$ 是秩亏的（$\\mathrm{rank}(\\mathbf{A})  K$）或系统是欠定的（$N  K$），则有无穷多个解可以完美地最小化残差。这种情况发生在测试用例 3 和 4 中。在这种情况下，问题指定需要找到同时也具有最小欧几里得范数 $\\|\\mathbf{c}\\|_2$ 的唯一解。这被称为最小范数最小二乘解。\n\nMoore-Penrose 伪逆，记作 $\\mathbf{A}^+$，为 $\\widehat{\\mathbf{c}} = \\mathbf{A}^+\\mathbf{y}$ 提供了一个通用求解器，在所有情况下都能得到最小范数最小二乘解。`numpy.linalg.lstsq` 函数是用于寻找此解的一个数值稳定的实现。\n\n每个测试用例的算法流程如下：\n1.  定义坐标集 $\\{r_i\\}_{i=1}^N$ 和基准真相参数 $\\mathbf{c}^\\star$。\n2.  对每个基函数 $\\phi_k(r)$，解析计算其导数 $\\frac{d\\phi_k}{dr}$。\n3.  通过计算 $A_{ik} = -\\frac{d\\phi_k}{dr}(r_i)$ 来构建 $N \\times K$ 的设计矩阵 $\\mathbf{A}$。\n4.  通过计算矩阵-矢量乘积 $\\mathbf{y} = \\mathbf{A}\\mathbf{c}^\\star$ 来构建观测矢量 $\\mathbf{y}$。\n5.  使用 `numpy.linalg.lstsq(A, y)` 求解估计参数 $\\widehat{\\mathbf{c}}$。\n6.  存储结果矢量 $\\widehat{\\mathbf{c}}$ 并对所有测试用例重复此过程。\n\n每个用例的具体基函数及其负导数如下：\n- **测试用例 1 和 2**：基函数 $\\{\\phi_k(r)\\}$ 为 $\\{r^2, \\sin(r), e^{-r}\\}$。$\\mathbf{A}$ 的列由 $\\{-2r, -\\cos(r), e^{-r}\\}$ 构建。\n- **测试用例 3**：基函数为 $\\{r, r, r^3\\}$。$\\mathbf{A}$ 的列由 $\\{-1, -1, -3r^2\\}$ 构建。前两列相同，导致 $\\mathbf{A}$ 秩亏。参数 $c_1$ 和 $c_2$ 无法单独识别；只能确定它们的和。最小范数解将适当地分配贡献。\n- **测试用例 4**：基函数为 $\\{r, r^2, \\sin(r), e^{-r}\\}$。$\\mathbf{A}$ 的列由 $\\{-1, -2r, -\\cos(r), e^{-r}\\}$ 构建。由于有 $N=2$ 个样本和 $K=4$ 个参数，系统是欠定的。解 $\\widehat{\\mathbf{c}}$ 将是 $\\mathbf{c}^\\star$ 在 $\\mathbf{A}$ 的行空间上的正交投影。\n\n最终结果被收集并格式化为列表的列表，每个数值都四舍五入到 $6$ 位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a least-squares force-matching procedure for four test cases\n    to estimate coarse-grained potential parameters.\n    \"\"\"\n    # Define the test cases, including coordinates, true parameters, and\n    # the basis functions for the force (negative derivative of potential basis).\n    test_cases = [\n        {\n            \"r\": np.array([0.0, 0.5, 1.0, 1.5, 2.0]),\n            \"c_star\": np.array([0.8, -1.2, 0.5]),\n            \"force_basis\": [\n                lambda r_vals: -2 * r_vals,\n                lambda r_vals: -np.cos(r_vals),\n                lambda r_vals: np.exp(-r_vals),\n            ],\n        },\n        {\n            \"r\": np.array([0.3, 1.0, 1.7]),\n            \"c_star\": np.array([-0.4, 2.0, -0.1]),\n            \"force_basis\": [\n                lambda r_vals: -2 * r_vals,\n                lambda r_vals: -np.cos(r_vals),\n                lambda r_vals: np.exp(-r_vals),\n            ],\n        },\n        {\n            \"r\": np.array([0.2, 0.6, 1.1, 1.5]),\n            \"c_star\": np.array([1.0, -1.0, 0.5]),\n            \"force_basis\": [\n                lambda r_vals: -1.0 * np.ones_like(r_vals),\n                lambda r_vals: -1.0 * np.ones_like(r_vals),\n                lambda r_vals: -3 * r_vals**2,\n            ],\n        },\n        {\n            \"r\": np.array([0.2, 1.0]),\n            \"c_star\": np.array([1.0, 0.5, -0.3, 0.2]),\n            \"force_basis\": [\n                lambda r_vals: -1.0 * np.ones_like(r_vals),\n                lambda r_vals: -2 * r_vals,\n                lambda r_vals: -np.cos(r_vals),\n                lambda r_vals: np.exp(-r_vals),\n            ],\n        },\n    ]\n\n    all_c_hats = []\n    for case in test_cases:\n        r = case[\"r\"]\n        c_star = case[\"c_star\"]\n        force_basis = case[\"force_basis\"]\n\n        N = len(r)\n        K = len(force_basis)\n\n        # Construct the design matrix A\n        A = np.zeros((N, K))\n        for k, basis_func in enumerate(force_basis):\n            A[:, k] = basis_func(r)\n\n        # Construct the observation vector y from the ground truth parameters\n        y = A @ c_star\n\n        # Compute the least-squares solution. For rank-deficient or\n        # underdetermined systems, lstsq returns the minimum-norm solution.\n        c_hat, _, _, _ = np.linalg.lstsq(A, y, rcond=None)\n        all_c_hats.append(c_hat)\n\n    # Format the results into a string representation of a list of lists.\n    formatted_results = []\n    for c_hat in all_c_hats:\n        # Round each coefficient to 6 decimal places and format as a string\n        rounded_c_str = [f\"{x:.6f}\" for x in c_hat]\n        # Create the string for the inner list, e.g., \"[c1,c2,c3]\"\n        formatted_results.append(f\"[{','.join(rounded_c_str)}]\")\n\n    # Create the final output string for the list of lists, e.g., \"[[...],[...]]\"\n    final_output_str = f\"[{','.join(formatted_results)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "当我们获得了粗粒化势能后，还必须正确地描述系统的动力学行为。仅仅将牛顿方程应用于粗粒化势能通常是不够的，因为被消除的原子自由度会产生等效的摩擦力和随机力。本练习将深入探讨广义朗之万方程 (GLE) 及其核心概念——记忆核，它解释了由快自由度引起的非瞬时效应。通过本练习，你将分析时间尺度分离这一关键原则，并定量地判断何时简化的马尔可夫动力学是有效的，以及何时必须考虑记忆效应。",
            "id": "3835538",
            "problem": "一个通过将高维原子动力学投影到标量集体坐标上获得的单一粗粒化变量 $q(t)$，遵循广义朗之万方程 (GLE)。根据 Mori–Zwanzig 投影算符形式理论和涨落-耗散定理 (FDT)，简化后的动力学可以写为\n$$\nm \\ddot{q}(t) + \\int_{0}^{t} K(t-s)\\,\\dot{q}(s)\\,\\mathrm{d}s + k\\,q(t) = F_{\\mathrm{R}}(t),\n$$\n其中 $m$ 是有效质量，$k$ 是粗粒化谐振劲度系数，$K(t)$ 是由未解析的自由度决定的记忆核，$F_{\\mathrm{R}}(t)$ 是与 FDT 一致的稳态随机力。记忆核的宽度由正交动力学的退相关时间决定；将此宽度表示为快时间尺度 $\\tau_{f} > 0$。在马尔可夫过阻尼极限下，粗粒化模式的慢弛豫时间尺度为 $\\tau_{s} = \\gamma/k$，其中 $\\gamma$ 是定义为记忆核积分的摩擦系数。\n\n考虑高摩擦过阻尼情况 $m \\to 0$，并通过设置 $F_{\\mathrm{R}}(t) = 0$ 来关注平均值的确定性弛豫。假设记忆核具有科学上标准的参数化形式，即通过单指数形式表示的弱尺度分离\n$$\nK(t) = \\frac{\\gamma}{\\tau_{f}} \\exp\\!\\Big(-\\frac{t}{\\tau_{f}}\\Big),\n$$\n其积分为 $\\int_{0}^{\\infty} K(t)\\,\\mathrm{d}t = \\gamma$，宽度为 $\\tau_{f}$。采用狄拉克 delta 函数核的马尔可夫闭合用 $K_{\\delta}(t) = \\gamma\\,\\delta(t)$ 替换 $K(t)$。\n\n基于以上基础，分别确定由非马尔可夫单指数核和马尔可夫 $\\delta$-核闭合预测的慢弛豫速率。然后，计算马尔可夫预测相对于非马尔可夫预测的相对误差 $E$ 的解析表达式，其定义为\n$$\nE \\equiv \\frac{|\\lambda_{\\delta} - \\lambda_{\\mathrm{NM}}|}{|\\lambda_{\\mathrm{NM}}|},\n$$\n其中 $\\lambda_{\\delta}$ 是马尔可夫 $\\delta$-核闭合下的弛豫速率，$\\lambda_{\\mathrm{NM}}$ 是非马尔可夫单指数核下的弛豫速率。您的最终答案必须是关于 $\\tau_{f}$ 和 $\\tau_{s}$ 的单个闭式表达式。无需进行数值计算。仅在相关时说明单位或角度单位；此处不需要。通过将 $E$ 与预设的容差相关联，物理解释带有 $\\delta$-核摩擦的马尔可夫闭合在何时会失效，但最终答案中不要包含任何不等式。",
            "solution": "用户提供了一个来自粗粒化建模领域的科学上有效且定义明确的问题陈述。所有必要的定义和方程都已给出，问题没有矛盾或模糊之处。因此，我将继续进行完整解答。\n\n该问题要求我们确定在过阻尼广义朗之万方程 (GLE) 中，粗粒化变量 $q(t)$ 在两种不同的记忆核 $K(t)$ 模型下的慢弛豫速率。在过阻尼极限 ($m \\to 0$) 下，用于描述平均值确定性弛豫的 GLE 由下式给出：\n$$\n\\int_{0}^{t} K(t-s)\\,\\dot{q}(s)\\,\\mathrm{d}s + k\\,q(t) = 0\n$$\n我们将首先分析马尔可夫情况，然后分析非马尔可夫情况，最后计算它们预测的弛豫速率之间的相对误差。\n\n**1. 马尔可夫弛豫速率 ($\\lambda_{\\delta}$)**\n\n马尔可夫近似用狄拉克 delta 函数 $K_{\\delta}(t) = \\gamma\\,\\delta(t)$ 替换记忆核 $K(t)$，其中 $\\gamma = \\int_{0}^{\\infty} K(t')\\,\\mathrm{d}t'$ 是总摩擦。将此代入 GLE：\n$$\n\\int_{0}^{t} \\gamma\\,\\delta(t-s)\\,\\dot{q}(s)\\,\\mathrm{d}s + k\\,q(t) = 0\n$$\n利用狄拉克 delta 函数的筛选性质，该积分的计算结果为 $\\gamma\\,\\dot{q}(t)$：\n$$\n\\gamma\\,\\dot{q}(t) + k\\,q(t) = 0\n$$\n这是一个一阶线性常微分方程。我们寻求形式为 $q(t) = q(0)\\,\\exp(-\\lambda t)$ 的解，该解描述了指数弛豫。将此拟设代入方程得到：\n$$\n\\gamma\\,(-\\lambda\\,q(t)) + k\\,q(t) = 0\n$$\n对于非平凡解 ($q(t) \\neq 0$)，速率 $\\lambda$ 必须满足：\n$$\n-\\gamma\\,\\lambda + k = 0\n$$\n求解弛豫速率，我们将其表示为 $\\lambda_{\\delta}$，得到：\n$$\n\\lambda_{\\delta} = \\frac{k}{\\gamma}\n$$\n问题将慢弛豫时间尺度定义为 $\\tau_s = \\gamma/k$。因此，马尔可夫弛豫速率为：\n$$\n\\lambda_{\\delta} = \\frac{1}{\\tau_s}\n$$\n\n**2. 非马尔可夫弛豫速率 ($\\lambda_{\\mathrm{NM}}$)**\n\n对于非马尔可夫情况，记忆核由单指数形式给出：\n$$\nK(t) = \\frac{\\gamma}{\\tau_{f}} \\exp\\left(-\\frac{t}{\\tau_{f}}\\right)\n$$\n其中 $\\tau_f$ 是记忆退相关时间。控制积分-微分方程为：\n$$\n\\int_{0}^{t} \\frac{\\gamma}{\\tau_{f}} \\exp\\left(-\\frac{t-s}{\\tau_{f}}\\right)\\,\\dot{q}(s)\\,\\mathrm{d}s + k\\,q(t) = 0\n$$\n这是一个卷积型的沃尔泰拉积分方程。解决此问题的标准方法是将其转换为常微分方程组。让我们定义一个辅助变量 $z(t)$ 作为摩擦项：\n$$\nz(t) \\equiv \\int_{0}^{t} \\frac{\\gamma}{\\tau_{f}} \\exp\\left(-\\frac{t-s}{\\tau_{f}}\\right)\\,\\dot{q}(s)\\,\\mathrm{d}s\n$$\n于是 GLE 变为 $z(t) + k\\,q(t) = 0$，这意味着 $z(t) = -k\\,q(t)$。对时间求导得到 $\\dot{z}(t) = -k\\,\\dot{q}(t)$。\n\n现在，我们使用莱布尼茨积分法则对 $z(t)$ 的定义进行微分：\n$$\n\\dot{z}(t) = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{0}^{t} K(t-s)\\,\\dot{q}(s)\\,\\mathrm{d}s = K(0)\\,\\dot{q}(t) + \\int_{0}^{t} \\frac{\\partial K(t-s)}{\\partial t}\\,\\dot{q}(s)\\,\\mathrm{d}s\n$$\n对于我们的核，$K(0) = \\gamma/\\tau_f$ 且 $\\frac{\\partial K(t-s)}{\\partial t} = -\\frac{1}{\\tau_f} K(t-s)$。将它们代入：\n$$\n\\dot{z}(t) = \\frac{\\gamma}{\\tau_f}\\,\\dot{q}(t) - \\frac{1}{\\tau_f} \\int_{0}^{t} K(t-s)\\,\\dot{q}(s)\\,\\mathrm{d}s = \\frac{\\gamma}{\\tau_f}\\,\\dot{q}(t) - \\frac{1}{\\tau_f} z(t)\n$$\n我们现在有两个方程组成的系统：\n1. $\\dot{z}(t) = -k\\,\\dot{q}(t)$\n2. $\\dot{z}(t) = \\frac{\\gamma}{\\tau_f}\\,\\dot{q}(t) - \\frac{1}{\\tau_f} z(t)$\n\n将 $\\dot{z}(t)$ 的表达式相等，并代入 $z(t) = -k\\,q(t)$：\n$$\n-k\\,\\dot{q}(t) = \\frac{\\gamma}{\\tau_f}\\,\\dot{q}(t) - \\frac{1}{\\tau_f}(-k\\,q(t))\n$$\n重新整理各项，形成关于 $q(t)$ 的单个 ODE：\n$$\n\\left(k + \\frac{\\gamma}{\\tau_f}\\right)\\dot{q}(t) + \\frac{k}{\\tau_f}\\,q(t) = 0\n$$\n乘以 $\\tau_f$：\n$$\n(k\\,\\tau_f + \\gamma)\\dot{q}(t) + k\\,q(t) = 0\n$$\n这又是一个一阶线性 ODE。弛豫速率 $\\lambda_{\\mathrm{NM}}$ 可由特征方程求得：\n$$\n(k\\,\\tau_f + \\gamma)(-\\lambda_{\\mathrm{NM}}) + k = 0\n$$\n求解 $\\lambda_{\\mathrm{NM}}$：\n$$\n\\lambda_{\\mathrm{NM}} = \\frac{k}{\\gamma + k\\,\\tau_f}\n$$\n\n**3. 相对误差计算**\n\n马尔可夫预测相对于非马尔可夫预测的相对误差 $E$ 定义为：\n$$\nE \\equiv \\frac{|\\lambda_{\\delta} - \\lambda_{\\mathrm{NM}}|}{|\\lambda_{\\mathrm{NM}}|}\n$$\n由于 $k, \\gamma, \\tau_f > 0$，速率 $\\lambda_{\\delta}$ 和 $\\lambda_{\\mathrm{NM}}$ 均为正。此外，$\\gamma + k\\tau_f > \\gamma$，所以 $\\lambda_{\\mathrm{NM}}  \\lambda_\\delta$。分子为正，因此我们可以去掉外层的绝对值符号。\n$$\nE = \\frac{\\lambda_{\\delta} - \\lambda_{\\mathrm{NM}}}{\\lambda_{\\mathrm{NM}}} = \\frac{\\lambda_{\\delta}}{\\lambda_{\\mathrm{NM}}} - 1\n$$\n代入速率的表达式：\n$$\nE = \\frac{k/\\gamma}{k/(\\gamma + k\\,\\tau_f)} - 1 = \\frac{\\gamma + k\\,\\tau_f}{\\gamma} - 1 = \\left(1 + \\frac{k\\,\\tau_f}{\\gamma}\\right) - 1\n$$\n这可以简化为：\n$$\nE = \\frac{k\\,\\tau_f}{\\gamma}\n$$\n最后，我们用给定的时间尺度 $\\tau_f$ 和 $\\tau_s = \\gamma/k$ 来表示这个结果。我们注意到 $k/\\gamma = 1/\\tau_s$。\n$$\nE = \\left(\\frac{k}{\\gamma}\\right) \\tau_f = \\frac{\\tau_f}{\\tau_s}\n$$\n\n**物理解释**\n相对误差 $E = \\tau_f / \\tau_s$ 是快记忆时间尺度 $\\tau_f$ 与慢粗粒化弛豫时间尺度 $\\tau_s$ 之比。马尔可夫近似假设了时间尺度的无限分离，即与慢变量的演化相比，热库瞬时退相关 ($\\tau_f \\to 0$)。我们的结果量化了当此假设未被完美满足时所产生的误差。如果为弛豫速率规定了某个相对误差容差，例如 $\\epsilon$，那么当 $E > \\epsilon$ 时，即 $\\tau_f / \\tau_s > \\epsilon$ 时，马尔可夫闭合被认为失效。这种失效发生在记忆持续时间 $\\tau_f$ 占系统自身弛豫时间 $\\tau_s$ 的一个不可忽略的部分时，这违反了时间尺度分离原则。",
            "answer": "$$\\boxed{\\frac{\\tau_f}{\\tau_s}}$$"
        }
    ]
}