{
    "hands_on_practices": [
        {
            "introduction": "在许多实际的量子力学计算中，例如在量子化学和紧束缚模型中，使用原子中心局域化的非正交基函数是常见且高效的策略。然而，这种非正交性引入了数学上的复杂性，具体表现为广义厄米本征问题 $H c = E S c$。本练习将引导你深入探究这个问题的核心，通过推导重叠矩阵 $S$ 的条件数，分析基函数之间的重叠 $s$ 如何直接影响计算的数值稳定性。理解这一点对于构建可靠的变分计算至关重要。",
            "id": "3852559",
            "problem": "在从原子尺度到连续介质的多尺度材料模拟中，非正交局域基组被广泛用于表示量子态，例如在 Kohn–Sham 密度泛函理论（DFT）和紧束缚模型中。考虑一个由两个空间局域化的、归一化的基函数 $\\{\\phi_{1},\\phi_{2}\\}$ 组成的最小模型，它们之间存在非零的相互重叠，其中重叠积分 $s \\equiv \\langle \\phi_{1} \\mid \\phi_{2} \\rangle$ 满足 $0  s  1$。重叠矩阵是 Gram 矩阵\n$$\nS \\equiv \\begin{pmatrix}\n1  s \\\\\ns  1\n\\end{pmatrix},\n$$\n该矩阵是实对称且正定的。该基下的系统哈密顿量由一个厄米矩阵 $H \\in \\mathbb{C}^{2 \\times 2}$ 表示，定态通过求解广义厄米本征问题 $H c = E S c$ 得到。\n\n仅从核心定义（Gram 矩阵、对称正定矩阵的特征值以及诱导矩阵范数）出发，完成以下任务：\n\n- 推导重叠矩阵 $S$ 的 $2$-范数谱条件数，作为 $s$ 的函数。\n\n- 在厄米微扰 $\\Delta H$ 和 $\\Delta S$ 为小量（$\\|\\Delta H\\|_{2} \\ll \\|H\\|_{2}$ 且 $\\|\\Delta S\\|_{2} \\ll \\|S\\|_{2}$）的情况下，量化到一阶精度，非正交性（由 $s$ 衡量）如何影响广义问题 $H c = E S c$ 的简单特征值 $E$ 的稳定性。仅使用广义本征对的线性代数结构以及归一化广义本征向量可选以满足 $c^{*} S c = 1$ 这一事实。你的分析应明确阐述通过重叠矩阵对 $s$ 的依赖性，并总结当 $s \\to 1^{-}$ 时灵敏度的行为。\n\n仅报告 $2$-范数条件数 $\\kappa_{2}(S)$ 作为 $s$ 的函数的闭式解析表达式作为你的最终答案。不需要进行数值计算或四舍五入，也不需要物理单位。",
            "solution": "该问题提出了两个任务：首先，推导一个特定的 $2 \\times 2$ 重叠矩阵 $S$ 的谱条件数；其次，分析广义本征值问题 $H c = E S c$ 对于 $H$ 和 $S$ 的小微扰的稳定性。\n\n该问题经检验是合理的。它在科学上基于应用于计算材料科学的量子力学和线性代数原理。问题设定适定、客观，并包含推导两部分唯一解所需的所有必要信息。\n\n首先，我将推导重叠矩阵 $S$ 的 $2$-范数谱条件数 $\\kappa_{2}(S)$。该矩阵为：\n$$\nS = \\begin{pmatrix}\n1  s \\\\\ns  1\n\\end{pmatrix}\n$$\n其中 $0  s  1$。根据定义，一个矩阵 $A$ 的 $2$-范数谱条件数为 $\\kappa_{2}(A) = \\|A\\|_{2} \\|A^{-1}\\|_{2}$。对于像 $S$ 这样的实对称正定矩阵，其 $2$-范数是它的最大特征值，即 $\\|S\\|_{2} = \\lambda_{\\max}(S)$，其逆矩阵的 $2$-范数是其最小特征值的倒数，即 $\\|S^{-1}\\|_{2} = 1/\\lambda_{\\min}(S)$。因此，条件数是最大特征值与最小特征值的比值：\n$$\n\\kappa_{2}(S) = \\frac{\\lambda_{\\max}(S)}{\\lambda_{\\min}(S)}\n$$\n为了求出 $S$ 的特征值，我们求解特征方程 $\\det(S - \\lambda I) = 0$，其中 $I$ 是 $2 \\times 2$ 的单位矩阵。\n$$\n\\det \\begin{pmatrix}\n1-\\lambda  s \\\\\ns  1-\\lambda\n\\end{pmatrix} = 0\n$$\n这得到 $(1-\\lambda)^{2} - s^{2} = 0$。对两边取平方根，我们得到 $1-\\lambda = \\pm s$，从而得出两个特征值：\n$$\n\\lambda = 1 \\mp s\n$$\n两个特征值是 $\\lambda_{1} = 1+s$ 和 $\\lambda_{2} = 1-s$。由于题目规定 $0  s  1$，两个特征值均为正，这证实了 $S$ 是正定的。最大和最小特征值分别为：\n$$\n\\lambda_{\\max}(S) = 1+s\n$$\n$$\n\\lambda_{\\min}(S) = 1-s\n$$\n将这些代入条件数的公式，得到：\n$$\n\\kappa_{2}(S) = \\frac{1+s}{1-s}\n$$\n\n其次，我将分析非正交性如何影响简单特征值 $E$ 的稳定性。我们从业经扰动的广义本征值问题 $H c = E S c$ 和微扰后的问题 $(H + \\Delta H)(c + \\Delta c) = (E + \\Delta E)(S + \\Delta S)(c + \\Delta c)$ 开始。我们展开微扰后的方程，并仅保留小微扰量 $\\Delta H$、$\\Delta S$、$\\Delta c$ 和 $\\Delta E$ 的一阶项：\n$$\nHc + H\\Delta c + \\Delta H c + \\mathcal{O}(\\delta^{2}) = (ESc + ES\\Delta c + E\\Delta S c + \\Delta E S c) + \\mathcal{O}(\\delta^{2})\n$$\n使用未扰动的方程 $Hc = ESc$，我们可以消去两边的项：\n$$\nH\\Delta c + \\Delta H c \\approx ES\\Delta c + E\\Delta S c + \\Delta E S c\n$$\n为了求出特征值的一阶变化量 $\\Delta E$，我们用未扰动本征向量的伴随向量 $c^{*}$ 从左侧相乘：\n$$\nc^{*}H\\Delta c + c^{*}\\Delta H c \\approx c^{*}ES\\Delta c + c^{*}E\\Delta S c + c^{*}\\Delta E S c\n$$\n由于 $H$ 是厄米矩阵，$H=H^{*}$，且厄米广义本征问题的特征值 $E$ 是实数（$E=E^{*}$）。因此，我们可以对未扰动的方程取伴随：$(Hc)^{*} = (ESc)^{*}$，得到 $c^{*}H^{*} = c^{*}E^{*}S^{*}$，所以 $c^{*}H = E c^{*}S$。利用此关系，左边的项 $c^{*}H\\Delta c$ 等于 $E c^{*}S\\Delta c$，这与右边的第一项 $c^{*}ES\\Delta c$ 相等。这些项相互抵消，得到：\n$$\nc^{*}\\Delta H c \\approx c^{*}E\\Delta S c + c^{*}\\Delta E S c\n$$\n重新整理以求解 $\\Delta E$，得到 $\\Delta E \\, c^{*} S c \\approx c^{*}\\Delta H c - E \\, c^{*}\\Delta S c$。题目指出，可以选择广义本征向量以满足归一化条件 $c^{*} S c = 1$。应用此归一化条件，可将特征值的一阶变化表达式简化为：\n$$\n\\Delta E \\approx c^{*}\\Delta H c - E c^{*}\\Delta S c = c^{*}(\\Delta H - E \\Delta S)c\n$$\n为了量化灵敏度，我们对两边取绝对值，并应用柯西-施瓦茨不等式和诱导矩阵范数的性质：\n$$\n|\\Delta E| \\approx |c^{*}(\\Delta H - E \\Delta S)c| \\le \\|c\\|_{2}^{2} \\|\\Delta H - E \\Delta S\\|_{2} \\le \\|c\\|_{2}^{2} (\\|\\Delta H\\|_{2} + |E| \\|\\Delta S\\|_{2})\n$$\n因此，特征值 $E$ 的灵敏度被因子 $\\|c\\|_{2}^{2}$ 放大。我们可以通过重叠矩阵 $S$ 的性质将此因子与非正交性参数 $s$ 联系起来。根据归一化条件 $c^{*} S c = 1$ 和瑞利-里兹定理，我们有：\n$$\n\\lambda_{\\min}(S) \\|c\\|_{2}^{2} \\le c^{*} S c \\le \\lambda_{\\max}(S) \\|c\\|_{2}^{2}\n$$\n代入 $c^{*} S c = 1$ 和 $\\lambda_{\\min}(S) = 1-s$ 得到：\n$$\n(1-s) \\|c\\|_{2}^{2} \\le 1 \\implies \\|c\\|_{2}^{2} \\le \\frac{1}{1-s}\n$$\n这个不等式表明，放大因子 $\\|c\\|_{2}^{2}$ 的上界为 $(1-s)^{-1}$。因此，特征值 $E$ 对微扰的稳定性直接受到非正交性的影响。当 $s \\to 1^{-}$ 时，基函数变得近似线性相关，$\\lambda_{\\min}(S) \\to 0$，矩阵 $S$ 趋于奇异。因此，条件数 $\\kappa_{2}(S) = \\frac{1+s}{1-s}$ 发散。这种病态性反映在特征值的灵敏度上，因为放大因子 $\\|c\\|_{2}^{2}$ 的上界以 $(1-s)^{-1}$ 的形式发散。因此，增加非正交性（即 $s \\to 1^{-}$）会导致计算出的特征值出现严重的数值不稳定性。",
            "answer": "$$\n\\boxed{\\frac{1+s}{1-s}}\n$$"
        },
        {
            "introduction": "变分计算的精度最终取决于所选基组表示真实波函数的能力。这个练习触及了近似理论的核心，探讨波函数的平滑性（例如，在使用平滑赝势时）与存在库仑奇点时的尖点（cusp）特性，如何从根本上决定了变分能量随基组规模增大的收敛速度。掌握这种关系，对于理解和选择不同的计算策略（如赝势方法与全电子方法）具有深刻的指导意义。",
            "id": "3852634",
            "problem": "在周期性多尺度材料模拟中，一种常见的单粒子薛定谔算符离散化方法是将其投影到截断的平面波空间上，即瑞利-里兹投影。考虑一个在边长为 $L$ 的立方晶胞中的非相对论电子，其哈密顿量为 $H = -\\tfrac{1}{2}\\Delta + V(\\mathbf{r})$，并处于周期性边界条件下。设 $V(\\mathbf{r})$ 是随晶胞周期的实值函数，记 $E$ 为精确的最低本征值，$E_M$ 为通过将试探态限制在由满足 $\\lvert \\mathbf{G} \\rvert \\le G_{\\max}$ 的倒易矢量 $\\mathbf{G}$ 所张成的平面波空间中而得到的最低瑞利-里兹本征值。记基组大小为 $M$，它与半径为 $G_{\\max}$ 的球内的倒易格点数量成正比，即 $M \\asymp G_{\\max}^3$。相关的动能截断为 $E_{\\mathrm{cut}} \\propto G_{\\max}^2$。\n\n在以下两种情况下，比较变分能量误差 $\\delta E_M := E_M - E$ 相对于 $M$ 的渐近收敛性：\n- 情况(i)：一个光滑的周期性赝势，$V \\in C^{\\infty}$，其精确本征函数是周期且解析的；\n- 情况(ii)：一个全电子库仑势，在布拉菲格点处存在点状原子核，这会在原子核位置处的精确本征函数中引入Kato尖点。\n\n仅使用本征值的变分表征和傅里叶级数的基本逼近理论，在 $M \\to \\infty$ 的极限下，判断以下哪些陈述是正确的：\n\nA. 在情况(i)中，变分能量误差 $\\delta E_M$ 以 $M^{1/3}$ 指数级衰减，即存在正常数 $C$ 和 $\\alpha$，使得对于所有足够大的 $M$，有 $\\delta E_M \\le C \\exp\\!\\big(-\\alpha\\, M^{1/3}\\big)$。\n\nB. 在情况(ii)中，使用平面波基组，$\\delta E_M$ 以 $M^{-1}$ 的代数级数衰减。\n\nC. 在情况(ii)中，使用平面波基组，$\\delta E_M$ 以 $M^{-2}$ 的代数级数衰减。\n\nD. 在情况(i)中，使用平面波基组，$\\delta E_M$ 以 $M^{-2}$ 的代数级数衰减。\n\nE. 在情况(ii)中，当用动能截断 $E_{\\mathrm{cut}}$ 表示时，能量误差满足 $\\delta E_M = \\mathcal{O}\\!\\big(E_{\\mathrm{cut}}^{-3/2}\\big)$。\n\nF. 变分原理意味着 $\\delta E_M \\ge 0$，并且在一个可能依赖于谱隙和稳定性的常数范围内，$\\delta E_M$ 的上界为精确本征函数在与 $H$ 相关的 $H^1$ 型能量范数下的最佳逼近误差的平方。",
            "solution": "该问题要求分析使用平面波基组离散化的单粒子薛定谔算符的变分能量误差 $\\delta E_M = E_M - E$ 的收敛速度。需要对两种情况进行收敛性比较：光滑势和奇异库仑势。\n\n分析依赖于两个基本原理：\n1.  **瑞利-里兹变分原理**：该原理指出，哈密顿量 $H$ 的基态能量 $E$ 是瑞利商 $\\langle \\psi | H | \\psi \\rangle / \\langle \\psi | \\psi \\rangle$ 在所有可能的试探波函数 $\\psi$ 上的最小值。在限制于线性子空间 $\\mathcal{S}_M$ 的计算中得到的本征值 $E_M$ 是真实基态能量 $E$ 的一个上界。因此，$E_M \\ge E$，能量误差 $\\delta E_M = E_M - E \\ge 0$。\n2.  **傅里叶级数的逼近理论**：该理论指出，一个函数的截断傅里叶级数逼近的收敛速度取决于该函数的光滑性。对于一个傅里叶系数为 $\\hat{f}(\\mathbf{G})$ 的函数 $f$，用截断到 $G_{\\max}$ 的级数来逼近它的误差与 $|\\mathbf{G}|  G_{\\max}$ 时 $|\\hat{f}(\\mathbf{G})|$ 的衰减率有关。\n\n能量误差 $\\delta E_M$ 的收敛性取决于试探本征函数能多好地逼近真实本征函数 $\\psi$。瑞利-里兹方法理论的一个标准结果是，本征值的误差受能量范数下本征函数逼近误差的平方所限制。对于给定的哈密顿量 $H = -\\frac{1}{2}\\Delta + V$，这个范数与索伯列夫 $H^1$ 范数密切相关。误差主要由基组中未包含的平面波分量的动能决定：\n$$ \\delta E_M \\approx \\sum_{|\\mathbf{G}|  G_{\\max}} \\frac{1}{2} |\\mathbf{G}|^2 |\\hat{\\psi}(\\mathbf{G})|^2 $$\n其中 $\\hat{\\psi}(\\mathbf{G})$ 是精确基态本征函数 $\\psi$ 的傅里叶系数。\n\n现在我们根据 $\\psi$ 的光滑性及其傅里叶系数的衰减情况来分析这两种情况。\n\n**情况(i)：光滑周期性赝势**\n势 $V(\\mathbf{r})$ 被认为是无限可微的，$V \\in C^{\\infty}$，且是周期的。问题陈述精确本征函数 $\\psi$ 是解析的。对于三维空间中的周期性解析函数，其傅里叶系数 $\\hat{\\psi}(\\mathbf{G})$ 随倒易格矢模长的增加呈指数衰减：\n$$ |\\hat{\\psi}(\\mathbf{G})| \\le C_1 \\exp(-c |\\mathbf{G}|) $$\n其中 $C_1$ 和 $c$ 为正常数。这种系数的快速“谱”衰减导致了能量误差同样快速的收敛。误差 $\\delta E_M$ 将由截断边界 $|\\mathbf{G}| \\approx G_{\\max}$ 处的第一个被忽略的项主导，导致误差相对于 $G_{\\max}$ 呈指数衰减：\n$$ \\delta E_M \\le C_2 \\exp(-\\alpha' G_{\\max}) $$\n问题将基组大小 $M$ 定义为半径为 $G_{\\max}$ 的球内的倒易格点数。在三维空间中，这个体积与 $G_{\\max}^3$ 成正比，所以 $M \\asymp G_{\\max}^3$，这意味着 $G_{\\max} \\asymp M^{1/3}$。将此代入误差界中可得：\n$$ \\delta E_M \\le C_2 \\exp(-\\alpha' c' M^{1/3}) = C \\exp(-\\alpha M^{1/3}) $$\n这表明对于光滑势，误差随着基组大小 $M$ 的立方根呈指数衰减。\n\n**情况(ii)：全电子库仑势**\n势 $V(\\mathbf{r})$ 在原子核位置 $\\mathbf{R}$ 处包含 $-Z/|\\mathbf{r}-\\mathbf{R}|$ 形式的库仑奇点。这种奇点从根本上改变了本征函数 $\\psi$ 的光滑性。根据Kato尖点条件，$\\psi$ 是连续的，但在每个原子核处都有一个尖点（梯度的不连续点）。这限制了 $\\psi$ 的光滑性。\n为了确定傅里叶系数的衰减，我们考虑傅里叶空间中的薛定谔方程。\n$$ H\\psi = E\\psi \\implies -\\frac{1}{2}\\Delta\\psi = (E-V)\\psi $$\n拉普拉斯算子的傅里叶变换是 $\\mathcal{F}[\\Delta\\psi](\\mathbf{G}) = -|\\mathbf{G}|^2 \\hat{\\psi}(\\mathbf{G})$。对于大的 $|\\mathbf{G}|$，$\\hat{\\psi}(\\mathbf{G})$ 的行为由 $(E-V)\\psi$ 中最奇异的部分决定。在原点附近的原子核处，$V(\\mathbf{r}) \\sim -Z/r$。由于 $\\psi(\\mathbf{r})$ 在 $r=0$ 附近近似为常数，项 $V\\psi$ 具有 $1/r$ 的奇点。$1/r$ 的三维傅里叶变换与 $1/|\\mathbf{G}|^2$ 成正比。因此，我们有渐近关系：\n$$ -|\\mathbf{G}|^2 \\hat{\\psi}(\\mathbf{G}) \\sim |\\mathbf{G}|^{-2} \\implies \\hat{\\psi}(\\mathbf{G}) \\sim |\\mathbf{G}|^{-4} $$\n能量误差可以通过对高频分量的贡献进行积分来估计：\n$$ \\delta E_M \\propto \\int_{|\\mathbf{G}|  G_{\\max}} |\\mathbf{G}|^2 |\\hat{\\psi}(\\mathbf{G})|^2 \\, d^3\\mathbf{G} $$\n在倒易空间中改用球坐标（设 $K = |\\mathbf{G}|$), 体元为 $4\\pi K^2 dK$。\n$$ \\delta E_M \\propto \\int_{G_{\\max}}^{\\infty} K^2 \\cdot \\left(K^{-4}\\right)^2 \\cdot K^2 \\, dK = \\int_{G_{\\max}}^{\\infty} K^4 \\cdot K^{-8} \\, dK = \\int_{G_{\\max}}^{\\infty} K^{-4} \\, dK $$\n计算该积分可得：\n$$ \\delta E_M \\propto \\left[ -\\frac{1}{3}K^{-3} \\right]_{G_{\\max}}^{\\infty} \\propto G_{\\max}^{-3} $$\n使用关系式 $M \\asymp G_{\\max}^3$ 和 $E_{\\mathrm{cut}} \\propto G_{\\max}^2$，我们可以用 $M$ 或 $E_{\\mathrm{cut}}$ 来表示这种代数衰减。\n用 $M$ 表示：$G_{\\max} \\asymp M^{1/3} \\implies \\delta E_M \\propto (M^{1/3})^{-3} = M^{-1}$。\n用 $E_{\\mathrm{cut}}$ 表示：$G_{\\max} \\propto E_{\\mathrm{cut}}^{1/2} \\implies \\delta E_M \\propto (E_{\\mathrm{cut}}^{1/2})^{-3} = E_{\\mathrm{cut}}^{-3/2}$。\n\n现在我们评估每个选项。\n\n**A. 在情况(i)中，变分能量误差 $\\delta E_M$ 以 $M^{1/3}$ 指数级衰减，即存在正常数 $C$ 和 $\\alpha$，使得对于所有足够大的 $M$，有 $\\delta E_M \\le C \\exp\\!\\big(-\\alpha\\, M^{1/3}\\big)$。**\n我们对情况(i)的分析表明，对于解析本征函数，$\\delta E_M \\sim \\exp(-\\alpha G_{\\max})$。由于 $G_{\\max} \\asymp M^{1/3}$，这变为 $\\delta E_M \\sim \\exp(-\\alpha' M^{1/3})$。这个陈述正确地描述了该问题的谱收敛性。\n**结论：正确。**\n\n**B. 在情况(ii)中，使用平面波基组，$\\delta E_M$ 以 $M^{-1}$ 的代数级数衰减。**\n我们对情况(ii)的分析表明，库仑尖点的存在导致能量误差以 $\\delta E_M \\propto G_{\\max}^{-3}$ 的速度衰减。考虑到 $M \\asymp G_{\\max}^3$，这意味着 $\\delta E_M \\propto M^{-1}$。\n**结论：正确。**\n\n**C. 在情况(ii)中，使用平面波基组，$\\delta E_M$ 以 $M^{-2}$ 的代数级数衰减。**\n这与推导出的 $M^{-1}$ 速率相矛盾。$M^{-2}$ 的速率意味着本征函数比带有尖点的函数更光滑。\n**结论：不正确。**\n\n**D. 在情况(i)中，使用平面波基组，$\\delta E_M$ 以 $M^{-2}$ 的代数级数衰减。**\n这是不正确的。光滑势情况下的收敛是指数级的，这比任何代数衰减速率都要快得多。\n**结论：不正确。**\n\n**E. 在情况(ii)中，当用动能截断 $E_{\\mathrm{cut}}$ 表示时，能量误差满足 $\\delta E_M = \\mathcal{O}\\!\\big(E_{\\mathrm{cut}}^{-3/2}\\big)$。**\n我们对情况(ii)的分析表明 $\\delta E_M \\propto G_{\\max}^{-3}$。使用关系式 $E_{\\mathrm{cut}} \\propto G_{\\max}^2$，即 $G_{\\max} \\propto E_{\\mathrm{cut}}^{1/2}$，我们发现 $\\delta E_M \\propto (E_{\\mathrm{cut}}^{1/2})^{-3} = E_{\\mathrm{cut}}^{-3/2}$。该陈述是用能量截断来正确地重新表述收敛速度。\n**结论：正确。**\n\n**F. 变分原理意味着 $\\delta E_M \\ge 0$，并且在一个可能依赖于谱隙和稳定性的常数范围内，$\\delta E_M$ 的上界为精确本征函数在与 $H$ 相关的 $H^1$ 型能量范数下的最佳逼近误差的平方。**\n这个陈述包含两个主张。首先，`变分原理意味着 $\\delta E_M \\ge 0$`。正如瑞利-里兹原理所确立的，变分能量 $E_M$ 总是真实基态能量 $E$ 的上界，所以 $E_M - E = \\delta E_M \\ge 0$。这是正确的。其次，`$\\delta E_M$ 的上界为精确本征函数在 $H^1$ 型能量范数下的最佳逼近误差的平方`。这是本征值问题数值分析（例如，瑞利-里兹法或有限元法）中的一个标准定理的陈述。具体来说， $|E_M - E| \\le C \\inf_{\\chi \\in \\mathcal{S}_M} \\|\\psi - \\chi\\|_{H^1}^2$。项 $\\inf_{\\chi \\in \\mathcal{S}_M} \\|\\psi - \\chi\\|_{H^1}$ 正是 $\\psi$ 在 $H^1$ 范数下从子空间 $\\mathcal{S}_M$ 得到的最佳逼近误差。能量形式 $\\langle u, Hu \\rangle$ 诱导了一个与 $H^1$ 范数等价的范数（对于在合适域上与 $H$ 的核正交的函数），因此“$H^1$ 型能量范数”的措辞是恰当的。这部分陈述也是该理论的基石。\n**结论：正确。**",
            "answer": "$$\\boxed{ABEF}$$"
        },
        {
            "introduction": "现在，让我们将变分原理应用于一个具体的固态物理问题中。本练习将指导你完成一个晶体基态能量的变分计算，通过对布里渊区进行离散化采样来实现。你将通过编写代码来构建 Monkhorst-Pack 网格，并检验能量如何随着采样密度的增加而收敛，这是现代材料模拟中的一项基本任务，也是将抽象理论付诸实践的绝佳范例。",
            "id": "3852574",
            "problem": "你的任务是，针对二维方晶格上的一个自旋简并、无相互作用的单带紧束缚模型，实现、分析并测试一种使用Monkhorst-Pack（MP）网格的变分布里渊区（BZ）采样方案，并量化每个电子的基态总能量随k点密度的收敛情况。所有三角函数必须使用弧度。所有能量必须以电子伏特（eV）表示。晶格常数必须以埃（Å）表示。\n\n从以下基本原理出发：\n- 量子力学中的Rayleigh-Ritz变分原理：对于全希尔伯特空间的任何子空间中的任意试探态，哈密顿量的期望值为精确基态能量提供了一个上界。\n- 在二维方形Bravais晶格上，每个格点有一个轨道，最近邻跃迁振幅为 $t$ 的紧束缚哈密顿量，其单粒子色散关系为\n$$\n\\varepsilon(\\mathbf{k}) \\;=\\; -2t\\left(\\cos(k_x a) + \\cos(k_y a)\\right),\n$$\n其中 $a$ 是晶格常数，$\\mathbf{k}=(k_x,k_y)$ 是第一布里渊区（BZ）中的晶体动量，余弦函数的参数是以弧度为单位的角度。\n- 晶格常数为 $a$ 的方晶格的第一布里渊区（BZ）是倒易空间中的一个正方形 $\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]\\times\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]$，由倒格矢 $\\mathbf{b}_1=\\frac{2\\pi}{a}\\hat{\\mathbf{x}}$ 和 $\\mathbf{b}_2=\\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 张成。\n- 对于零温下无相互作用、自旋简并（$g_s=2$）的电子，多电子基态是通过遵循泡利不相容原理，按能量递增的顺序占据单粒子态得到的。在连续谱中，使用BZ上的归一化测度，每个原胞的总能量是 $\\varepsilon(\\mathbf{k})$ 与每个自旋的占据函数 $f(\\mathbf{k})\\in[0,1]$ 的积分，并满足平均占据数等于每个自旋的电子数的约束条件。\n\n通过将BZ积分替换为Monkhorst-Pack（MP）网格上的黎曼和，构建一个离散变分问题。在分数坐标中定义一个 $N\\times N$ 的MP网格，其点集为\n$$\nu_i \\;=\\; \\frac{2i - N - 1}{2N},\\quad v_j \\;=\\; \\frac{2j - N - 1}{2N},\\quad i,j\\in\\{1,2,\\dots,N\\},\n$$\n并通过\n$$\n\\mathbf{k}_{ij} \\;=\\; u_i \\,\\mathbf{b}_1 + v_j \\,\\mathbf{b}_2.\n$$\n映射到倒易空间。为每个点分配相等的权重 $w=\\frac{1}{N^2}$，使得 $\\sum_{i,j} w = 1$。对于给定的每个原胞的电子数 $n_e\\in[0,2]$（由于自旋简并 $g_s=2$，2代表单能带被完全填充），定义每个自旋的离散占据数 $f_{ij}\\in[0,1]$，并最小化每个电子的离散总能量\n$$\nE_N \\;=\\; \\frac{g_s \\sum_{i,j} w \\, f_{ij} \\, \\varepsilon(\\mathbf{k}_{ij})}{n_e}\n$$\n同时满足约束条件 $\\sum_{i,j} w \\, f_{ij} \\,=\\, \\frac{n_e}{g_s}$ 和箱式约束 $0\\le f_{ij}\\le 1$。\n\n你的程序必须：\n- 为每个测试用例构建 $N\\times N$ 的MP网格。\n- 求解所述的离散变分问题，以获得每个电子的离散基态总能量 $E_N$，单位为电子伏特（eV）。你必须确定在给定约束条件下使能量最小化的占据数 $f_{ij}$。\n- 对于一个预先指定的大参考网格尺寸 $N_{\\mathrm{ref}}$（所有测试用例通用），使用相同的程序为每个测试用例计算相应的参考变分能量 $E_{N_{\\mathrm{ref}}}$。\n- 通过计算绝对误差 $\\Delta E = \\lvert E_N - E_{N_{\\mathrm{ref}}}\\rvert$（单位为电子伏特 eV）来量化收敛性。\n\n使用以下测试套件，其中每个测试用例是一个四元组 $(t, a, n_e, N)$：\n- 测试1：($t=1.0\\,\\text{eV}$, $a=1.0\\,\\text{\\AA}$, $n_e=1.0$, $N=5$)。\n- 测试2：($t=1.0\\,\\text{eV}$, $a=1.0\\,\\text{\\AA}$, $n_e=1.0$, $N=9$)。\n- 测试3：($t=1.0\\,\\text{eV}$, $a=1.0\\,\\text{\\AA}$, $n_e=0.5$, $N=7$)。\n- 测试4：($t=1.0\\,\\text{eV}$, $a=1.0\\,\\text{\\AA}$, $n_e=2.0$, $N=7$)。\n- 测试5：($t=2.5\\,\\text{eV}$, $a=3.0\\,\\text{\\AA}$, $n_e=1.3$, $N=11$)。\n\n对所有情况使用一个共同的参考网格尺寸 $N_{\\mathrm{ref}}=181$。所有能量必须以电子伏特（eV）报告。所有三角函数中的角度均为弧度。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含五个测试用例的绝对误差 $\\Delta E$（单位为电子伏特 eV），以逗号分隔的列表形式，并用方括号括起来，顺序与测试套件相同。例如，一个有效的输出格式是\n$[x_1,x_2,x_3,x_4,x_5]$,\n其中每个 $x_i$ 是一个以电子伏特（eV）为单位的浮点数。",
            "solution": "我们从量子力学中的Rayleigh-Ritz变分原理开始：对于任何归一化的试探态 $\\lvert\\psi\\rangle$，其期望值 $\\langle\\psi\\lvert \\hat{H} \\rvert\\psi\\rangle$ 是精确基态能量 $E_0$ 的一个上界。在无相互作用的电子系统中，多体基态是能量最低的单粒子本征态构成的Slater行列式。在零温和自旋简并度 $g_s=2$ 的情况下，基态占据方式是遵循泡利不相容原理，按单粒子能量递增的顺序填充单粒子态。\n\n在周期性晶体中，单粒子本征态是布洛赫波，由第一布里渊区（BZ）中的晶体动量 $\\mathbf{k}$ 表征。对于每个格点有一个轨道、最近邻跃迁振幅为 $t$ 的方晶格紧束缚模型，其单粒子能量由下式给出：\n$$\n\\varepsilon(\\mathbf{k}) \\;=\\; -2t\\left(\\cos(k_x a) + \\cos(k_y a)\\right),\n$$\n其中 $a$ 是晶格常数，余弦函数的参数是以弧度为单位的角度。第一布里渊区（BZ）是由倒格矢 $\\mathbf{b}_1=\\frac{2\\pi}{a}\\hat{\\mathbf{x}}$ 和 $\\mathbf{b}_2=\\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 张成的正方形 $\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]\\times\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]$。\n\n在零温下，对于每个原胞有 $n_e$ 个电子（计入双自旋）的情况，在连续谱中，每个原胞的总能量是积分\n$$\nE \\;=\\; \\frac{g_s \\int_{\\mathrm{BZ}} \\varepsilon(\\mathbf{k}) \\, f(\\mathbf{k}) \\,\\mathrm{d}\\mu(\\mathbf{k})}{n_e},\n$$\n其中 $g_s=2$ 是自旋简并度，$f(\\mathbf{k})\\in[0,1]$ 是每个自旋的占据函数，$\\mathrm{d}\\mu(\\mathbf{k})$ 是BZ上的归一化测度，满足 $\\int_{\\mathrm{BZ}}\\mathrm{d}\\mu(\\mathbf{k})=1$。电子数约束为\n$$\n\\int_{\\mathrm{BZ}} f(\\mathbf{k}) \\,\\mathrm{d}\\mu(\\mathbf{k}) \\;=\\; \\frac{n_e}{g_s}.\n$$\n变分原理指出，使能量最小化的 $f(\\mathbf{k})$ 是一个投影算符，它投影到费米等高线以下的最低能量态集合上，即 $f(\\mathbf{k})=\\Theta(\\varepsilon_F-\\varepsilon(\\mathbf{k}))$，其中 $\\varepsilon_F$ 是适当的费米能；最小化过程会首先填充能量较低的态，这是由箱式约束下线性泛函的重排不等式得出的。\n\n为了进行数值计算，我们用Monkhorst-Pack（MP）网格上的黎曼和来近似BZ积分。二维 $N\\times N$ MP网格在分数坐标中由\n$$\nu_i \\;=\\; \\frac{2i - N - 1}{2N},\\quad v_j \\;=\\; \\frac{2j - N - 1}{2N},\\quad i,j\\in\\{1,2,\\dots,N\\},\n$$\n给出，相关的晶体动量为\n$$\n\\mathbf{k}_{ij} \\;=\\; u_i\\,\\mathbf{b}_1 + v_j\\,\\mathbf{b}_2,\n$$\n权重均等，为 $w=\\frac{1}{N^2}$，因此 $\\sum_{i,j} w=1$。注意，$\\varepsilon(\\mathbf{k})$ 中余弦函数的角度为 $k_x a = 2\\pi u_i$ 和 $k_y a = 2\\pi v_j$，单位是弧度。离散变分问题则为\n$$\n\\min_{\\{f_{ij}\\}} \\; \\sum_{i,j} w \\, f_{ij} \\, \\varepsilon(\\mathbf{k}_{ij}) \\;\\;\\text{subject to}\\;\\; \\sum_{i,j} w \\, f_{ij} \\;=\\; \\frac{n_e}{g_s},\\;\\; 0\\le f_{ij}\\le 1,\n$$\n每个电子的离散总能量为\n$$\nE_N \\;=\\; \\frac{g_s \\sum_{i,j} w \\, f_{ij} \\, \\varepsilon(\\mathbf{k}_{ij})}{n_e}.\n$$\n\n解法结构与论证：\n- 目标函数是变量 $\\{f_{ij}\\}$ 的线性函数，具有箱式约束和关于其平均值的线性等式约束。这是一个连续背包问题。根据重排不等式以及可行集是一个多面体的事实，最小化解可以通过将 $\\varepsilon(\\mathbf{k}_{ij})$ 按升序排序，并对能量最低的点设置 $f_{ij}=1$，直到约束几乎饱和，最多只有一个部分占据点来精确满足约束。具体来说，设 $\\{\\varepsilon_\\ell\\}_{\\ell=1}^{N^2}$ 是按升序排列的能量列表，公共权重为 $w=\\frac{1}{N^2}$，并设 $x=\\frac{n_e}{g_s}\\in[0,1]$ 为每个自旋所需的平均占据数。定义 $m=\\left\\lfloor \\frac{x}{w}\\right\\rfloor$ 和余项 $r=x-mw\\in[0,w)$。最小化占据数为：对于 $\\ell\\in\\{1,\\dots,m\\}$，$f_\\ell=1$；如果 $r0$，$f_{m+1}=\\frac{r}{w}$；对于所有更大的 $\\ell$，$f_\\ell=0$。那么每个电子的离散能量为\n$$\nE_N \\;=\\; \\frac{g_s}{n_e} \\left( w \\sum_{\\ell=1}^{m} \\varepsilon_\\ell \\;+\\; r \\,\\varepsilon_{m+1}\\,\\mathbf{1}_{\\{r0\\}} \\right).\n$$\n这是零温费米填充的直接离散模拟，其本身也是在所选MP网格可表示的状态子空间内的一次Rayleigh-Ritz变分最小化。\n- 关于k点密度的收敛性之所以出现，是因为当 $N\\to\\infty$ 时，MP黎曼和收敛于积分，且离散变分最小化解收敛于连续谱的最小化解。因此，使用一个大的参考值 $N_{\\mathrm{ref}}$ 计算出的绝对误差 $\\Delta E=\\lvert E_N-E_{N_{\\mathrm{ref}}}\\rvert$ 量化了采样误差。\n\n算法规划：\n- 对于每个网格尺寸 $N$，构建分数MP坐标 $u_i$ 和 $v_j$，计算 $\\varepsilon(\\mathbf{k}_{ij})=-2t\\left(\\cos(2\\pi u_i)+\\cos(2\\pi v_j)\\right)$（单位为电子伏特），将其展平并按升序排序，然后设置 $w=\\frac{1}{N^2}$。\n- 对于给定的每个原胞电子数 $n_e\\in[0,2]$，设 $x=\\frac{n_e}{g_s}$ 且 $g_s=2$。计算 $m=\\min\\left(\\left\\lfloor \\frac{x}{w}\\right\\rfloor,N^2\\right)$ 和余项 $r=\\max\\left(0,\\,x-mw\\right)$。计算\n$$\nE_N \\;=\\; \\frac{g_s}{n_e}\\left(w\\sum_{\\ell=1}^{m}\\varepsilon_\\ell + r\\,\\varepsilon_{m+1}\\,\\mathbf{1}_{\\{mN^2 \\wedge r0\\}}\\right).\n$$\n- 对于测试套件中的每个测试用例 $(t,a,n_e,N)$，使用一个共同的大参考值 $N_{\\mathrm{ref}}=181$ 计算 $E_N$ 和 $E_{N_{\\mathrm{ref}}}$，然后计算 $\\Delta E=\\lvert E_N-E_{N_{\\mathrm{ref}}}\\rvert$（单位为电子伏特）。\n- 在单行中报告列表 $[\\Delta E_1,\\Delta E_2,\\Delta E_3,\\Delta E_4,\\Delta E_5]$。\n\n边界情况与覆盖理由：\n- 测试1和2在半填充 $n_e=1.0$ 条件下比较了两种不同的k点密度，显示了随着 $N$ 的增加，$\\Delta E$ 会减小。\n- 测试3使用四分之一填充 $n_e=0.5$，用于检验离散方案中最后一个占据态为分数占据的情况。\n- 测试4使用全填充 $n_e=2.0$，此时整个能带被占满。对于这种对称的色散关系，精确的BZ平均值为零，因此 $E_N$ 等于MP平均值，$\\Delta E$ 应接近于零，这用于探测对称性和平均行为。\n- 测试5同时改变了跃迁参数 $t$ 和电子数 $n_e$，用于验证能量随 $t$ 的正确缩放以及方法对不同填充的普适性。\n\n所有能量单位为电子伏特（eV），所有角度单位为弧度。最终程序必须生成单行输出，其中包含五个绝对误差，以逗号分隔的列表形式并用方括号括起来。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef mp_energies_sorted(N: int, t_ev: float, a_angstrom: float) - tuple[np.ndarray, float]:\n    \"\"\"\n    Generate an N x N Monkhorst-Pack grid for a square lattice and return\n    the sorted single-particle energies in eV along with the uniform weight w = 1/N^2.\n\n    Parameters:\n        N (int): divisions along each reciprocal lattice direction.\n        t_ev (float): nearest-neighbor hopping amplitude t in eV.\n        a_angstrom (float): lattice constant a in angstroms (Å).\n\n    Returns:\n        energies_sorted (np.ndarray): sorted energies (ascending), shape (N*N,)\n        w (float): uniform weight = 1/(N^2)\n    \"\"\"\n    # Fractional MP coordinates u_i, v_j in [-0.5, 0.5), centered.\n    i = np.arange(1, N + 1, dtype=float)\n    u = (2.0 * i - N - 1.0) / (2.0 * N)  # shape (N,)\n    # Create meshgrid of fractional coordinates\n    U, V = np.meshgrid(u, u, indexing='ij')  # shape (N,N)\n\n    # For square lattice: kx * a = 2*pi*U, ky * a = 2*pi*V. Angles are in radians.\n    kxa = 2.0 * np.pi * U\n    kya = 2.0 * np.pi * V\n\n    # Tight-binding dispersion: epsilon(k) = -2 t [cos(kx a) + cos(ky a)]\n    # Energies are in eV if t_ev is in eV.\n    eps = -2.0 * t_ev * (np.cos(kxa) + np.cos(kya))  # shape (N,N)\n\n    energies_sorted = np.sort(eps.ravel())\n    w = 1.0 / (N * N)\n    return energies_sorted, w\n\ndef variational_energy_per_electron_from_sorted(energies_sorted: np.ndarray,\n                                                w: float,\n                                                n_e: float,\n                                                g_s: float = 2.0) - float:\n    \"\"\"\n    Compute the discrete variational ground-state total energy per electron (in eV)\n    for a given sorted list of single-particle energies and uniform weight.\n\n    Parameters:\n        energies_sorted (np.ndarray): sorted ascending energies, length K = N^2\n        w (float): uniform weight = 1/K\n        n_e (float): number of electrons per unit cell (including both spins), 0 = n_e = 2\n        g_s (float): spin degeneracy (default 2)\n\n    Returns:\n        E_per_e (float): total energy per electron in eV\n    \"\"\"\n    if n_e == 0.0:\n        # No electrons -> energy per electron undefined; not used by the given test suite.\n        return 0.0\n\n    K = energies_sorted.size\n    x = n_e / g_s  # required average occupation per spin in [0,1]\n    # Compute number of fully occupied k-points and residual fractional occupation.\n    # Add a small epsilon to guard against floating-point representation issues.\n    m = int(np.floor(x / w + 1e-14))\n    if m > K:\n        m = K\n    # Residual fraction toward the next state\n    residual = x - m * w\n    if residual  0.0:\n        residual = 0.0\n\n    # Sum energies of the lowest m states\n    energy_sum = 0.0\n    if m > 0:\n        energy_sum += w * float(np.sum(energies_sorted[:m]))\n    # Add fractional occupation of the (m+1)-th state if needed and available\n    if (m  K) and (residual > 1e-18):\n        energy_sum += residual * float(energies_sorted[m])\n\n    # Total energy per electron\n    E_per_cell = g_s * energy_sum  # energy per unit cell (both spins)\n    E_per_e = E_per_cell / n_e\n    return E_per_e\n\ndef compute_error_for_case(t_ev: float, a_angstrom: float, n_e: float,\n                           N_small: int, N_ref: int) - float:\n    \"\"\"\n    Compute the absolute error |E_N - E_Nref| in eV for a given test case.\n\n    Parameters:\n        t_ev (float): hopping parameter t in eV\n        a_angstrom (float): lattice constant a in angstroms (Å)\n        n_e (float): electrons per unit cell (0 = n_e = 2)\n        N_small (int): small MP grid size\n        N_ref (int): reference MP grid size (large)\n\n    Returns:\n        abs_error (float): absolute error in eV\n    \"\"\"\n    # Small grid energy\n    e_small_sorted, w_small = mp_energies_sorted(N_small, t_ev, a_angstrom)\n    E_small = variational_energy_per_electron_from_sorted(e_small_sorted, w_small, n_e, g_s=2.0)\n\n    # Reference grid energy\n    e_ref_sorted, w_ref = mp_energies_sorted(N_ref, t_ev, a_angstrom)\n    E_ref = variational_energy_per_electron_from_sorted(e_ref_sorted, w_ref, n_e, g_s=2.0)\n\n    return abs(E_small - E_ref)\n\ndef solve():\n    # Define the test cases from the problem statement: (t [eV], a [Å], n_e, N_small)\n    test_cases = [\n        (1.0, 1.0, 1.0, 5),\n        (1.0, 1.0, 1.0, 9),\n        (1.0, 1.0, 0.5, 7),\n        (1.0, 1.0, 2.0, 7),\n        (2.5, 3.0, 1.3, 11),\n    ]\n    # Common reference grid size\n    N_ref = 181\n\n    results = []\n    for t_ev, a_angstrom, n_e, N_small in test_cases:\n        err = compute_error_for_case(t_ev, a_angstrom, n_e, N_small, N_ref)\n        # Format with a reasonable precision to ensure a clean single-line output\n        results.append(f\"{err:.12f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}