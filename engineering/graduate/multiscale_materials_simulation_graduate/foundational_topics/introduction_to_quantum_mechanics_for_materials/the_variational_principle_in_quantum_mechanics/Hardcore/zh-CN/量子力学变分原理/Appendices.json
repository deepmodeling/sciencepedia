{
    "hands_on_practices": [
        {
            "introduction": "在计算固态物理学中，材料的总能量等宏观性质通常通过在倒易晶格的布里渊区内对单粒子能量进行积分来确定。这个练习将变分原理应用于一个具体且基础的计算任务：如何将这个连续的积分问题离散化，并构建一个变分方案来有效地计算晶体的基态能量。通过使用Monkhorst-Pack网格对布里渊区进行采样 ，你将亲手实现一个简化的紧束缚模型，并量化总能量如何随着k点密度收敛，这是所有周期性体系第一性原理计算的核心步骤。",
            "id": "3852574",
            "problem": "您需要为一个二维正方晶格上的自旋简并、无相互作用的单带紧束缚模型，实现、分析和测试一个使用 Monkhorst-Pack (MP) 网格的变分布里渊区 (BZ) 采样方案，并量化每个电子的基态总能量相对于 k 点密度的收敛性。所有三角函数必须使用弧度。所有能量必须以电子伏特 (eV) 表示。晶格常数必须以埃 (Å) 表示。\n\n从以下基本原理出发：\n- 量子力学中的 Rayleigh-Ritz 变分原理：对于完整希尔伯特空间的任意子空间中的任何试探态，哈密顿量的期望值为精确基态能量提供了一个上界。\n- 在每个格点有一个轨道且最近邻跃迁振幅为 $t$ 的二维正方布拉伐晶格上的紧束缚哈密顿量，导出一个单粒子色散关系\n$$\n\\varepsilon(\\mathbf{k}) \\;=\\; -2t\\left(\\cos(k_x a) + \\cos(k_y a)\\right),\n$$\n其中 $a$ 是晶格常数，$\\mathbf{k}=(k_x,k_y)$ 是第一布里渊区 (BZ) 中的晶体动量，余弦函数的自变量是以弧度为单位测量的角度。\n- 晶格常数为 $a$ 的正方晶格的第一布里渊区 (BZ) 是倒易空间中的正方形 $\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]\\times\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]$，由倒易晶格矢量 $\\mathbf{b}_1=\\frac{2\\pi}{a}\\hat{\\mathbf{x}}$ 和 $\\mathbf{b}_2=\\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 张成。\n- 对于零温下无相互作用、自旋简并 ($g_s=2$) 的电子，多电子基态是通过遵循泡利不相容原理，按能量递增顺序占据单粒子态来获得的。在连续极限下，使用 BZ 上的归一化测度，每个原胞的总能量是 $\\varepsilon(\\mathbf{k})$ 与每个自旋的占据数函数 $f(\\mathbf{k})\\in[0,1]$ 的积分，其约束条件为平均占据数等于每个自旋的电子数。\n\n通过用 Monkhorst-Pack (MP) 网格上的黎曼和代替 BZ 积分，建立一个离散变分问题。在分数坐标中定义一个 $N\\times N$ 的 MP 网格，由点集\n$$\nu_i \\;=\\; \\frac{2i - N - 1}{2N},\\quad v_j \\;=\\; \\frac{2j - N - 1}{2N},\\quad i,j\\in\\{1,2,\\dots,N\\},\n$$\n给出，并通过\n$$\n\\mathbf{k}_{ij} \\;=\\; u_i \\,\\mathbf{b}_1 + v_j \\,\\mathbf{b}_2.\n$$\n映射到倒易空间。为每个点分配相等的权重 $w=\\frac{1}{N^2}$，使得 $\\sum_{i,j} w = 1$。对于每个原胞给定的电子数 $n_e\\in[0,2]$（由于自旋简并 $g_s=2$，2 表示单能带全满填充），定义每个自旋的离散占据数 $f_{ij}\\in[0,1]$，并在约束条件 $\\sum_{i,j} w \\, f_{ij} \\,=\\, \\frac{n_e}{g_s}$ 和箱式约束 $0\\le f_{ij}\\le 1$ 下，最小化每个电子的离散总能量\n$$\nE_N \\;=\\; \\frac{g_s \\sum_{i,j} w \\, f_{ij} \\, \\varepsilon(\\mathbf{k}_{ij})}{n_e}\n$$\n\n您的程序必须：\n- 为每个测试用例构建 $N\\times N$ 的 MP 网格。\n- 求解所述离散变分问题，以获得以电子伏特 (eV) 为单位的每个电子的离散基态总能量 $E_N$。您必须确定在给定约束下使能量最小化的占据数 $f_{ij}$。\n- 对于一个预设的大参考网格尺寸 $N_{\\mathrm{ref}}$（对所有测试用例通用），使用相同的程序为每个测试用例计算相应的参考变分能量 $E_{N_{\\mathrm{ref}}}$。\n- 通过计算以电子伏特 (eV) 为单位的绝对误差 $\\Delta E = \\lvert E_N - E_{N_{\\mathrm{ref}}}\\rvert$ 来量化收敛性。\n\n使用以下测试套件，其中每个测试用例是一个四元组 $(t, a, n_e, N)$：\n- 测试 $1$：($t=1.0\\,\\text{eV}, a=1.0\\,\\text{\\AA}, n_e=1.0, N=5$)。\n- 测试 $2$：($t=1.0\\,\\text{eV}, a=1.0\\,\\text{\\AA}, n_e=1.0, N=9$)。\n- 测试 $3$：($t=1.0\\,\\text{eV}, a=1.0\\,\\text{\\AA}, n_e=0.5, N=7$)。\n- 测试 $4$：($t=1.0\\,\\text{eV}, a=1.0\\,\\text{\\AA}, n_e=2.0, N=7$)。\n- 测试 $5$：($t=2.5\\,\\text{eV}, a=3.0\\,\\text{\\AA}, n_e=1.3, N=11$)。\n\n对所有情况使用一个共同的参考网格尺寸 $N_{\\mathrm{ref}}=181$。所有能量必须以电子伏特 (eV) 报告。所有三角函数中的角度均为弧度。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含五个测试用例的绝对误差 $\\Delta E$（单位为电子伏特 eV），形式为方括号括起来的逗号分隔列表，顺序与测试套件相同。例如，一个有效的输出格式是\n$[x_1,x_2,x_3,x_4,x_5]$，\n其中每个 $x_i$ 是一个以电子伏特 (eV) 为单位的浮点数。",
            "solution": "我们从量子力学中的 Rayleigh-Ritz 变分原理开始：对于任何归一化的试探态 $\\lvert\\psi\\rangle$，期望值 $\\langle\\psi\\lvert \\hat{H} \\rvert\\psi\\rangle$ 是精确基态能量 $E_0$ 的一个上界。在一个无相互作用的电子系统中，多体基态是能量最低的单粒子本征态构成的斯莱特行列式 (Slater determinant)。在零温、自旋简并度为 $g_s=2$ 的情况下，基态的占据方式是遵循泡利不相容原理，按照单粒子能量递增的顺序填充单粒子态。\n\n在周期性晶体中，单粒子本征态是由第一布里渊区 (BZ) 中的晶体动量 $\\mathbf{k}$ 表征的布洛赫波 (Bloch waves)。对于每个格点有一个轨道、最近邻跃迁振幅为 $t$ 的正方晶格紧束缚模型，单粒子能量由下式给出\n$$\n\\varepsilon(\\mathbf{k}) \\;=\\; -2t\\left(\\cos(k_x a) + \\cos(k_y a)\\right),\n$$\n其中 $a$ 是晶格常数，余弦函数的自变量是以弧度为单位测量的角度。第一布里渊区 (BZ) 是由倒易晶格矢量 $\\mathbf{b}_1=\\frac{2\\pi}{a}\\hat{\\mathbf{x}}$ 和 $\\mathbf{b}_2=\\frac{2\\pi}{a}\\hat{\\mathbf{y}}$ 张成的正方形 $\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]\\times\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]$。\n\n在零温下，对于每个原胞 $n_e$ 个电子（计算两种自旋），每个原胞的总能量在连续极限下是积分\n$$\nE \\;=\\; \\frac{g_s \\int_{\\mathrm{BZ}} \\varepsilon(\\mathbf{k}) \\, f(\\mathbf{k}) \\,\\mathrm{d}\\mu(\\mathbf{k})}{n_e},\n$$\n其中 $g_s=2$ 是自旋简并度，$f(\\mathbf{k})\\in[0,1]$ 是每个自旋的占据数函数，$\\mathrm{d}\\mu(\\mathbf{k})$ 是 BZ 上的归一化测度，使得 $\\int_{\\mathrm{BZ}}\\mathrm{d}\\mu(\\mathbf{k})=1$。电子数约束为\n$$\n\\int_{\\mathrm{BZ}} f(\\mathbf{k}) \\,\\mathrm{d}\\mu(\\mathbf{k}) \\;=\\; \\frac{n_e}{g_s}.\n$$\n变分原理决定了使能量最小化的 $f(\\mathbf{k})$ 是一个投影到费米等高线以内最低能量态集合上的算子，即 $f(\\mathbf{k})=\\Theta(\\varepsilon_F-\\varepsilon(\\mathbf{k}))$，其中 $\\varepsilon_F$ 是适当的费米能；极小化解会首先填充能量较低的态，这是箱式约束下线性泛函的重排不等式的结果。\n\n为了进行数值计算，我们用 Monkhorst-Pack (MP) 网格上的黎曼和来近似 BZ 积分。二维 $N\\times N$ MP 网格在分数坐标中由\n$$\nu_i \\;=\\; \\frac{2i - N - 1}{2N},\\quad v_j \\;=\\; \\frac{2j - N - 1}{2N},\\quad i,j\\in\\{1,2,\\dots,N\\},\n$$\n给出，相关的晶体动量为\n$$\n\\mathbf{k}_{ij} \\;=\\; u_i\\,\\mathbf{b}_1 + v_j\\,\\mathbf{b}_2,\n$$\n权重相等，为 $w=\\frac{1}{N^2}$，因此 $\\sum_{i,j} w=1$。注意，进入 $\\varepsilon(\\mathbf{k})$ 中余弦函数的角度是 $k_x a = 2\\pi u_i$ 和 $k_y a = 2\\pi v_j$，它们以弧度为单位。离散变分问题则为\n$$\n\\min_{\\{f_{ij}\\}} \\; \\sum_{i,j} w \\, f_{ij} \\, \\varepsilon(\\mathbf{k}_{ij}) \\;\\;\\text{subject to}\\;\\; \\sum_{i,j} w \\, f_{ij} \\;=\\; \\frac{n_e}{g_s},\\;\\; 0\\le f_{ij}\\le 1,\n$$\n每个电子的离散总能量为\n$$\nE_N \\;=\\; \\frac{g_s \\sum_{i,j} w \\, f_{ij} \\, \\varepsilon(\\mathbf{k}_{ij})}{n_e}.\n$$\n\n解法结构与论证：\n- 目标函数是变量 $\\{f_{ij}\\}$ 的线性函数，带有箱式约束和关于其平均值的线性等式约束。这是一个连续背包问题。根据重排不等式以及可行集是一个多拟阵 (polymatroid) 的事实，通过将 $\\varepsilon(\\mathbf{k}_{ij})$ 按升序排序，并对能量最低的点设置 $f_{ij}=1$ 直到约束条件几乎被满足，最多用一个部分占据的点来精确满足约束，即可获得极小化解。具体来说，设 $\\{\\varepsilon_\\ell\\}_{\\ell=1}^{N^2}$ 是按升序排列的能量列表，其共同权重为 $w=\\frac{1}{N^2}$，并设 $x=\\frac{n_e}{g_s}\\in[0,1]$ 是每个自旋所需的平均占据数。定义 $m=\\left\\lfloor \\frac{x}{w}\\right\\rfloor$ 和余量 $r=x-mw\\in[0,w)$。使能量最小化的占据数是：对于 $\\ell\\in\\{1,\\dots,m\\}$，$f_\\ell=1$；如果 $r>0$，则 $f_{m+1}=\\frac{r}{w}$；对于所有更大的 $\\ell$，$f_\\ell=0$。那么每个电子的离散能量为\n$$\nE_N \\;=\\; \\frac{g_s}{n_e} \\left( w \\sum_{\\ell=1}^{m} \\varepsilon_\\ell \\;+\\; r \\,\\varepsilon_{m+1}\\,\\mathbf{1}_{\\{r>0\\}} \\right).\n$$\n- 这是零温费米填充的直接离散模拟，其本身也是在所选 MP 网格上可表示的状态子空间内的 Rayleigh-Ritz 变分最小化。\n- 相对于 k 点密度的收敛性之所以产生，是因为当 $N\\to\\infty$ 时，MP 黎曼和收敛到积分，且离散变分极小化解收敛到连续极小化解。因此，使用一个大的参考值 $N_{\\mathrm{ref}}$ 计算的绝对误差 $\\Delta E=\\lvert E_N-E_{N_{\\mathrm{ref}}}\\rvert$ 量化了采样误差。\n\n算法规划：\n- 对每个网格尺寸 $N$，构建分数 MP 坐标 $u_i$ 和 $v_j$，计算以电子伏特为单位的能量 $\\varepsilon(\\mathbf{k}_{ij})=-2t\\left(\\cos(2\\pi u_i)+\\cos(2\\pi v_j)\\right)$，将其展平并按升序排序，并设置 $w=\\frac{1}{N^2}$。\n- 对于给定的每个原胞电子数 $n_e\\in[0,2]$，设置 $x=\\frac{n_e}{g_s}$，其中 $g_s=2$。计算 $m=\\min\\left(\\left\\lfloor \\frac{x}{w}\\right\\rfloor,N^2\\right)$ 和余量 $r=\\max\\left(0,\\,x-mw\\right)$。计算\n$$\nE_N \\;=\\; \\frac{g_s}{n_e}\\left(w\\sum_{\\ell=1}^{m}\\varepsilon_\\ell + r\\,\\varepsilon_{m+1}\\,\\mathbf{1}_{\\{m<N^2 \\wedge r>0\\}}\\right).\n$$\n- 对于测试套件中的每个测试用例 $(t,a,n_e,N)$，使用一个共同的大参考值 $N_{\\mathrm{ref}}=181$ 计算 $E_N$ 和 $E_{N_{\\mathrm{ref}}}$，然后计算以电子伏特为单位的 $\\Delta E=\\lvert E_N-E_{N_{\\mathrm{ref}}}\\rvert$。\n- 在单行中报告列表 $[\\Delta E_1,\\Delta E_2,\\Delta E_3,\\Delta E_4,\\Delta E_5]$。\n\n边界情况与覆盖理由：\n- 测试 $1$ 和 $2$ 在半填充 $n_e=1.0$ 条件下比较了两种不同的 k 点密度，显示了 $\\Delta E$ 随 $N$ 增加而减小。\n- 测试 $3$ 使用四分之一填充 $n_e=0.5$，用于检验离散方案中最后一个能级被分数占据的行为。\n- 测试 $4$ 使用全填充 $n_e=2.0$，此时整个能带被占据。对于这种对称色散，精确的 BZ 平均值为零，因此 $E_N$ 等于 MP 平均值，$\\Delta E$ 应接近于零，这用于探测对称性和平均行为。\n- 测试 $5$ 同时改变了跃迁参数 $t$ 和电子数 $n_e$，以验证能量随 $t$ 的正确标度关系以及在不同填充下的普适性。\n\n所有能量均以电子伏特 (eV) 为单位，所有角度均以弧度为单位。最终程序必须生成单行输出，其中包含五个绝对误差，形式为方括号括起来的逗号分隔列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef mp_energies_sorted(N: int, t_ev: float, a_angstrom: float) -> tuple[np.ndarray, float]:\n    \"\"\"\n    Generate an N x N Monkhorst-Pack grid for a square lattice and return\n    the sorted single-particle energies in eV along with the uniform weight w = 1/N^2.\n\n    Parameters:\n        N (int): divisions along each reciprocal lattice direction.\n        t_ev (float): nearest-neighbor hopping amplitude t in eV.\n        a_angstrom (float): lattice constant a in angstroms (Å).\n\n    Returns:\n        energies_sorted (np.ndarray): sorted energies (ascending), shape (N*N,)\n        w (float): uniform weight = 1/(N^2)\n    \"\"\"\n    # Fractional MP coordinates u_i, v_j in [-0.5, 0.5), centered.\n    i = np.arange(1, N + 1, dtype=float)\n    u = (2.0 * i - N - 1.0) / (2.0 * N)  # shape (N,)\n    # Create meshgrid of fractional coordinates\n    U, V = np.meshgrid(u, u, indexing='ij')  # shape (N,N)\n\n    # For square lattice: kx * a = 2*pi*U, ky * a = 2*pi*V. Angles are in radians.\n    kxa = 2.0 * np.pi * U\n    kya = 2.0 * np.pi * V\n\n    # Tight-binding dispersion: epsilon(k) = -2 t [cos(kx a) + cos(ky a)]\n    # Energies are in eV if t_ev is in eV.\n    eps = -2.0 * t_ev * (np.cos(kxa) + np.cos(kya))  # shape (N,N)\n\n    energies_sorted = np.sort(eps.ravel())\n    w = 1.0 / (N * N)\n    return energies_sorted, w\n\ndef variational_energy_per_electron_from_sorted(energies_sorted: np.ndarray,\n                                                w: float,\n                                                n_e: float,\n                                                g_s: float = 2.0) -> float:\n    \"\"\"\n    Compute the discrete variational ground-state total energy per electron (in eV)\n    for a given sorted list of single-particle energies and uniform weight.\n\n    Parameters:\n        energies_sorted (np.ndarray): sorted ascending energies, length K = N^2\n        w (float): uniform weight = 1/K\n        n_e (float): number of electrons per unit cell (including both spins), 0 = n_e = 2\n        g_s (float): spin degeneracy (default 2)\n\n    Returns:\n        E_per_e (float): total energy per electron in eV\n    \"\"\"\n    if n_e == 0.0:\n        # No electrons -> energy per electron undefined; not used by the given test suite.\n        return 0.0\n\n    K = energies_sorted.size\n    x = n_e / g_s  # required average occupation per spin in [0,1]\n    # Compute number of fully occupied k-points and residual fractional occupation.\n    # Add a small epsilon to guard against floating-point representation issues.\n    m = int(np.floor(x / w + 1e-14))\n    if m > K:\n        m = K\n    # Residual fraction toward the next state\n    residual = x - m * w\n    if residual  0.0:\n        residual = 0.0\n\n    # Sum energies of the lowest m states\n    energy_sum = 0.0\n    if m > 0:\n        energy_sum += w * float(np.sum(energies_sorted[:m]))\n    # Add fractional occupation of the (m+1)-th state if needed and available\n    if (m  K) and (residual > 1e-18):\n        energy_sum += residual * float(energies_sorted[m])\n\n    # Total energy per electron\n    E_per_cell = g_s * energy_sum  # energy per unit cell (both spins)\n    E_per_e = E_per_cell / n_e\n    return E_per_e\n\ndef compute_error_for_case(t_ev: float, a_angstrom: float, n_e: float,\n                           N_small: int, N_ref: int) - float:\n    \"\"\"\n    Compute the absolute error |E_N - E_Nref| in eV for a given test case.\n\n    Parameters:\n        t_ev (float): hopping parameter t in eV\n        a_angstrom (float): lattice constant a in angstroms (Å)\n        n_e (float): electrons per unit cell (0 = n_e = 2)\n        N_small (int): small MP grid size\n        N_ref (int): reference MP grid size (large)\n\n    Returns:\n        abs_error (float): absolute error in eV\n    \"\"\"\n    # Small grid energy\n    e_small_sorted, w_small = mp_energies_sorted(N_small, t_ev, a_angstrom)\n    E_small = variational_energy_per_electron_from_sorted(e_small_sorted, w_small, n_e, g_s=2.0)\n\n    # Reference grid energy\n    e_ref_sorted, w_ref = mp_energies_sorted(N_ref, t_ev, a_angstrom)\n    E_ref = variational_energy_per_electron_from_sorted(e_ref_sorted, w_ref, n_e, g_s=2.0)\n\n    return abs(E_small - E_ref)\n\ndef solve():\n    # Define the test cases from the problem statement: (t [eV], a [Å], n_e, N_small)\n    test_cases = [\n        (1.0, 1.0, 1.0, 5),\n        (1.0, 1.0, 1.0, 9),\n        (1.0, 1.0, 0.5, 7),\n        (1.0, 1.0, 2.0, 7),\n        (2.5, 3.0, 1.3, 11),\n    ]\n    # Common reference grid size\n    N_ref = 181\n\n    results = []\n    for t_ev, a_angstrom, n_e, N_small in test_cases:\n        err = compute_error_for_case(t_ev, a_angstrom, n_e, N_small, N_ref)\n        # Format with a reasonable precision to ensure a clean single-line output\n        results.append(f\"{err:.12f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "虽然前一个练习中隐式使用的平面波基组是正交的，但在量子化学和材料科学中，许多强大的基组（如原子轨道）是空间局域且非正交的。这种非正交性引入了独特的数值挑战，可能导致计算上的不稳定性。这个练习  旨在揭示这个问题的核心，要求你推导重叠矩阵 $S$ 的条件数，并分析它如何影响广义本征值问题的稳定性，从而让你深刻理解在非正交基下进行变分计算时潜在的数值陷阱。",
            "id": "3852559",
            "problem": "在原子-连续介质多尺度材料模拟中，非正交局域基组被广泛用于表示量子态，例如在Kohn–Sham密度泛函理论（DFT）和紧束缚模型中。考虑一个最小模型，该模型包含两个空间局域化的、归一化的基函数 $\\{\\phi_{1},\\phi_{2}\\}$，它们之间存在非零的相互重叠，其中重叠积分 $s \\equiv \\langle \\phi_{1} \\mid \\phi_{2} \\rangle$ 满足 $0  s  1$。重叠矩阵是格拉姆矩阵\n$$\nS \\equiv \\begin{pmatrix}\n1  s \\\\\ns  1\n\\end{pmatrix},\n$$\n该矩阵是实对称正定矩阵。在此基下，系统哈密顿量由一个厄米矩阵 $H \\in \\mathbb{C}^{2 \\times 2}$ 表示，定态通过求解广义厄米本征问题 $H c = E S c$ 得到。\n\n仅从核心定义（格拉姆矩阵、对称正定矩阵的本征值和诱导矩阵范数）出发，完成以下任务：\n\n- 推导重叠矩阵 $S$ 的 2-范数谱条件数，作为 $s$ 的函数。\n\n- 在厄米微扰 $\\Delta H$ 和 $\\Delta S$ 为一阶小量（即 $\\|\\Delta H\\|_{2} \\ll \\|H\\|_{2}$ 和 $\\|\\Delta S\\|_{2} \\ll \\|S\\|_{2}$）的情况下，量化非正交性（由 $s$ 衡量）如何影响广义问题 $H c = E S c$ 的一个单一本征值 $E$ 的稳定性。仅使用广义本征对的线性代数结构以及归一化的广义本征向量可选择满足 $c^{*} S c = 1$ 这一事实。您的分析应明确阐述通过重叠矩阵对 $s$ 的依赖性，并得出当 $s \\to 1^{-}$ 时灵敏度的行为。\n\n仅报告 2-范数条件数 $\\kappa_{2}(S)$ 作为 $s$ 的函数的闭式解析表达式作为最终答案。不需要数值计算或四舍五入，也不需要物理单位。",
            "solution": "该问题提出了两个任务：首先，推导一个特定的 $2 \\times 2$ 重叠矩阵 $S$ 的谱条件数；其次，分析广义本征值问题 $H c = E S c$ 对于 $H$ 和 $S$ 的小微扰的稳定性。\n\n该问题经检验是合理的。它在科学上基于应用于计算材料科学的量子力学和线性代数原理。问题设定是适定的、客观的，并包含推导两部分唯一解所需的所有信息。\n\n首先，我将推导重叠矩阵 $S$ 的 2-范数谱条件数 $\\kappa_{2}(S)$。该矩阵由下式给出：\n$$\nS = \\begin{pmatrix}\n1  s \\\\\ns  1\n\\end{pmatrix}\n$$\n其中 $0  s  1$。根据定义，一个矩阵 $A$ 的 2-范数谱条件数为 $\\kappa_{2}(A) = \\|A\\|_{2} \\|A^{-1}\\|_{2}$。对于像 $S$ 这样的实对称正定矩阵，其 2-范数是其最大本征值，即 $\\|S\\|_{2} = \\lambda_{\\max}(S)$，其逆矩阵的 2-范数是其最小本征值的倒数，即 $\\|S^{-1}\\|_{2} = 1/\\lambda_{\\min}(S)$。因此，条件数是最大本征值与最小本征值的比值：\n$$\n\\kappa_{2}(S) = \\frac{\\lambda_{\\max}(S)}{\\lambda_{\\min}(S)}\n$$\n为了求出 $S$ 的本征值，我们求解特征方程 $\\det(S - \\lambda I) = 0$，其中 $I$ 是 $2 \\times 2$ 单位矩阵。\n$$\n\\det \\begin{pmatrix}\n1-\\lambda  s \\\\\ns  1-\\lambda\n\\end{pmatrix} = 0\n$$\n这得到 $(1-\\lambda)^{2} - s^{2} = 0$。两边取平方根，得到 $1-\\lambda = \\pm s$，从而得出两个本征值：\n$$\n\\lambda = 1 \\mp s\n$$\n两个本征值是 $\\lambda_{1} = 1+s$ 和 $\\lambda_{2} = 1-s$。由于问题规定 $0  s  1$，两个本征值都为正，这证实了 $S$ 是正定的。最大和最小本征值分别为：\n$$\n\\lambda_{\\max}(S) = 1+s\n$$\n$$\n\\lambda_{\\min}(S) = 1-s\n$$\n将这些代入条件数的公式，得到：\n$$\n\\kappa_{2}(S) = \\frac{1+s}{1-s}\n$$\n\n其次，我将分析非正交性如何影响一个单一本征值 $E$ 的稳定性。我们从未受扰的广义本征值问题 $H c = E S c$ 和受扰问题 $(H + \\Delta H)(c + \\Delta c) = (E + \\Delta E)(S + \\Delta S)(c + \\Delta c)$ 开始。我们展开受扰方程，并仅保留小微扰 $\\Delta H$、$\\Delta S$、$\\Delta c$ 和 $\\Delta E$ 的一阶项：\n$$\nHc + H\\Delta c + \\Delta H c + \\mathcal{O}(\\delta^{2}) = (ESc + ES\\Delta c + E\\Delta S c + \\Delta E S c) + \\mathcal{O}(\\delta^{2})\n$$\n使用未受扰方程 $Hc = ESc$，我们可以消去两边的项：\n$$\nH\\Delta c + \\Delta H c \\approx ES\\Delta c + E\\Delta S c + \\Delta E S c\n$$\n为了求出本征值的一阶变化 $\\Delta E$，我们用未受扰本征向量的伴随 $c^{*}$ 从左侧相乘：\n$$\nc^{*}H\\Delta c + c^{*}\\Delta H c \\approx c^{*}ES\\Delta c + c^{*}E\\Delta S c + c^{*}\\Delta E S c\n$$\n由于 $H$ 是厄米矩阵，$H=H^{*}$，且厄米广义本征问题的本征值 $E$ 是实数（$E=E^{*}$）。因此，我们可以对未受扰方程取伴随：$(Hc)^{*} = (ESc)^{*}$，得到 $c^{*}H^{*} = c^{*}E^{*}S^{*}$，因此 $c^{*}H = E c^{*}S$。利用此关系，左侧的项 $c^{*}H\\Delta c$ 等于 $E c^{*}S\\Delta c$，这与右侧的第一项 $c^{*}ES\\Delta c$ 相等。这些项相互抵消，得到：\n$$\nc^{*}\\Delta H c \\approx c^{*}E\\Delta S c + c^{*}\\Delta E S c\n$$\n重新整理以求解 $\\Delta E$ 可得 $\\Delta E \\, c^{*} S c \\approx c^{*}\\Delta H c - E \\, c^{*}\\Delta S c$。问题指出，广义本征向量可以选择满足归一化条件 $c^{*} S c = 1$。应用此归一化条件，本征值的一阶变化表达式可简化为：\n$$\n\\Delta E \\approx c^{*}\\Delta H c - E c^{*}\\Delta S c = c^{*}(\\Delta H - E \\Delta S)c\n$$\n为了量化灵敏度，我们对两边取绝对值，并应用柯西-施瓦茨不等式和诱导矩阵范数的性质：\n$$\n|\\Delta E| \\approx |c^{*}(\\Delta H - E \\Delta S)c| \\le \\|c\\|_{2}^{2} \\|\\Delta H - E \\Delta S\\|_{2} \\le \\|c\\|_{2}^{2} (\\|\\Delta H\\|_{2} + |E| \\|\\Delta S\\|_{2})\n$$\n因此，本征值 $E$ 的灵敏度被因子 $\\|c\\|_{2}^{2}$ 放大。我们可以通过重叠矩阵 $S$ 的性质将此因子与非正交性参数 $s$ 联系起来。根据归一化条件 $c^{*} S c = 1$ 和瑞利-里兹定理，我们有：\n$$\n\\lambda_{\\min}(S) \\|c\\|_{2}^{2} \\le c^{*} S c \\le \\lambda_{\\max}(S) \\|c\\|_{2}^{2}\n$$\n代入 $c^{*} S c = 1$ 和 $\\lambda_{\\min}(S) = 1-s$ 得到：\n$$\n(1-s) \\|c\\|_{2}^{2} \\le 1 \\implies \\|c\\|_{2}^{2} \\le \\frac{1}{1-s}\n$$\n这个不等式表明，放大因子 $\\|c\\|_{2}^{2}$ 的上界是 $(1-s)^{-1}$。因此，本征值 $E$ 对微扰的稳定性直接受到非正交性的影响。当 $s \\to 1^{-}$ 时，基函数变得近乎线性相关，$\\lambda_{\\min}(S) \\to 0$，矩阵 $S$ 变得奇异。因此，条件数 $\\kappa_{2}(S) = \\frac{1+s}{1-s}$ 发散。这种病态反映在本征值的灵敏度上，因为放大因子 $\\|c\\|_{2}^{2}$ 的上界以 $(1-s)^{-1}$ 的形式发散。因此，增加非正交性（即 $s \\to 1^{-}$）会导致计算出的本征值出现严重的数值不稳定性。",
            "answer": "$$\n\\boxed{\\frac{1+s}{1-s}}\n$$"
        },
        {
            "introduction": "认识到非正交基组带来的数值刚性问题后，下一步自然是寻找解决方案。预处理（Preconditioning）是现代电子结构计算中加速能量变分最小化过程的关键技术。这个练习  让你从根本上理解为何预处理是有效的，要求你从几何（状态空间的自然度规）和优化理论（能量函数的Hessian矩阵）两个角度，论证使用重叠矩阵或Hessian矩阵的逆来构造预处理器的合理性，从而将抽象的数值方法与量子力学问题的物理和几何本质联系起来。",
            "id": "3852597",
            "problem": "在电子结构的多尺度材料模拟中，人们通常通过最小化厄米哈密顿算符 $H$ 在试探波函数 $\\lvert \\psi \\rangle$ 下的瑞利商能量泛函来近似基态能量。变分原理指出，对于任何容许的 $\\lvert \\psi \\rangle$，基态能量 $E_0$ 满足 $E_0 \\leq \\frac{\\langle \\psi \\lvert H \\rvert \\psi \\rangle}{\\langle \\psi \\lvert \\psi \\rangle}$。当在非正交基 $\\{\\lvert \\chi_i \\rangle\\}_{i=1}^N$ 中用系数 $c_i$ 表示 $\\lvert \\psi \\rangle$（即 $\\lvert \\psi \\rangle = \\sum_{i=1}^N c_i \\lvert \\chi_i \\rangle$）时，重叠矩阵 $S$ 定义为 $S_{ij} = \\langle \\chi_i \\lvert \\chi_j \\rangle$ 且为正定矩阵，离散能量泛函则变为 $H$ 和 $S$ 的广义瑞利商。在实践中，基于梯度的最小化方法常常通过预处理来加速，例如使用一个近似重叠矩阵 $S$ 的逆矩阵或近似能量泛函局部Hessian矩阵的逆矩阵。考虑到变分结构以及混合了强局域函数和扩展函数的基组所具有的多尺度特性，下列哪个陈述正确地论证了使用此类预处理器在保持科学正确性的同时加速收敛的合理性？\n\nA. 在非正交基中，系数空间中物理上有意义的距离概念是由重叠矩阵 $S$ 导出的，选择相对于 $S$-内积的最陡下降方向，实际上是将 $S$ 的逆矩阵应用于欧几里得梯度，这为使用近似 $S^{-1}$ 的矩阵进行预处理提供了理由。\n\nB. 在极小值点附近，能量景观在系数上是局部二次的，应用一个近似Hessian矩阵逆矩阵的预处理器可以重新标度坐标，使问题的条件数趋近于 $1$，从而平衡不同特征方向上的弛豫速率，进而在不改变真实最小值位置的情况下加速收敛。\n\nC. 预处理会改变变分最小值的位置，并可能违反变分原理的上界性质；其表观的收敛优势仅仅源于采取了更大的步长，因此在变分最小化中应避免使用。\n\nD. 在多尺度材料模型中，存在相差悬殊的长度尺度会导致重叠矩阵或Hessian矩阵的特征值分布范围巨大，使问题变得刚性；应用逆重叠或逆Hessian预处理器可以压缩谱并缓解刚性问题，从而减少收敛所需的迭代次数。\n\nE. 预处理等价于向哈密顿量添加一个常数平移 $H \\mapsto H + \\alpha I$（其中 $\\alpha$ 为某个标量），这会均匀地降低所有特征值，从而使基态更具主导性，这解释了更快的收敛速度。",
            "solution": "用户希望我验证问题陈述，如果有效，则提供一个评估每个选项的详细解决方案。\n\n### 问题验证\n\n**步骤1：提取给定信息**\n- **主题：** 电子结构的多尺度材料模拟。\n- **方法：** 最小化厄米哈密顿算符 $H$ 的瑞利商能量泛函。\n- **试探波函数：** $\\lvert \\psi \\rangle$。\n- **变分原理：** 对于任何容许的 $\\lvert \\psi \\rangle$，基态能量 $E_0$ 满足 $E_0 \\leq \\frac{\\langle \\psi \\lvert H \\rvert \\psi \\rangle}{\\langle \\psi \\lvert \\psi \\rangle}$。\n- **基组：** 一个非正交基 $\\{\\lvert \\chi_i \\rangle\\}_{i=1}^N$。\n- **波函数表示：** $\\lvert \\psi \\rangle = \\sum_{i=1}^N c_i \\lvert \\chi_i \\rangle$，系数为 $c_i$。\n- **重叠矩阵：** $S$，其元素为 $S_{ij} = \\langle \\chi_i \\lvert \\chi_j \\rangle$。陈述指出 $S$ 是正定的。\n- **离散能量泛函：** $H$ 和 $S$ 的广义瑞利商。\n- **数值方法：** 基于梯度的最小化。\n- **加速技术：** 预处理。\n- **预处理器示例：** 近似重叠矩阵逆矩阵 $S^{-1}$ 的矩阵，或近似能量泛函局部Hessian矩阵逆矩阵的矩阵。\n- **物理背景：** 基组的多尺度特性，混合了强局域函数和扩展函数。\n- **问题：** 下列哪个陈述正确地论证了使用这些预处理器在保持科学正确性的同时加速收敛的合理性？\n\n**步骤2：使用提取的给定信息进行验证**\n- **科学上合理：** 该问题牢固地定位于量子力学、数值线性代数和计算材料科学的交叉领域。变分原理、非正交基组（在量子化学中常见）、广义特征值问题以及预处理梯度方法的使用，都是该领域中标准且成熟的概念和技术。描述在事实上和科学上都是合理的。\n- **问题明确：** 该问题提供了一个清晰且自洽的背景。它要求为特定数值技术（预处理）在此背景下的正确理由。问题是明确的，并且在选项中有一组确定的正确概念性答案。\n- **客观性：** 语言是正式、技术性的，没有主观或带有偏见的陈述。它描述了一个标准的计算物理场景。\n\n**缺陷清单：**\n1.  **科学或事实不合理：** 无。所有概念都是该领域的标准概念。\n2.  **不可形式化或不相关：** 该问题在指定领域内高度相关且可形式化。\n3.  **不完整或矛盾的设定：** 设定是完整的且内部一致。\n4.  **不切实际或不可行：** 所描述的场景是现代电子结构计算中挑战的真实写照。\n5.  **问题不明确或结构不良：** 问题定义明确。\n6.  **故作高深、琐碎或同义反复：** 该问题探讨了量子力学中数值方法的一个基本且不平凡的方面，需要对几何、优化和物理学有深入的理解。\n7.  **超出科学可验证性：** 陈述的正确性可以通过对照数值分析和计算物理的标准教科书来验证。\n\n**步骤3：结论与行动**\n问题陈述是**有效的**。我将继续推导解决方案并分析每个选项。\n\n### 推导与求解\n\n需要最小化的能量泛函是瑞利商：\n$$E[\\psi] = \\frac{\\langle \\psi \\lvert H \\rvert \\psi \\rangle}{\\langle \\psi \\lvert \\psi \\rangle}$$\n在非正交基 $\\{\\lvert \\chi_i \\rangle\\}$ 中，$\\lvert \\psi \\rangle = \\sum_i c_i \\lvert \\chi_i \\rangle$，这成为系数向量 $\\mathbf{c}$ 的函数：\n$$E(\\mathbf{c}) = \\frac{\\sum_{i,j} c_i^* \\langle \\chi_i \\lvert H \\rvert \\chi_j \\rangle c_j}{\\sum_{i,j} c_i^* \\langle \\chi_i \\lvert \\chi_j \\rangle c_j} = \\frac{\\mathbf{c}^\\dagger \\mathbf{H} \\mathbf{c}}{\\mathbf{c}^\\dagger \\mathbf{S} \\mathbf{c}}$$\n其中 $\\mathbf{H}$ 是哈密顿矩阵，元素为 $H_{ij} = \\langle \\chi_i \\lvert H \\rvert \\chi_j \\rangle$，而 $\\mathbf{S}$ 是重叠矩阵，元素为 $S_{ij} = \\langle \\chi_i \\lvert \\chi_j \\rangle$。最小化 $E(\\mathbf{c})$ 等价于求解广义特征值问题 $\\mathbf{H}\\mathbf{c} = E \\mathbf{S}\\mathbf{c}$ 的最低能量解。\n\n基于梯度的方法使用从能量梯度导出的搜索方向来迭代更新系数向量 $\\mathbf{c}$。$E(\\mathbf{c})$ 相对于 $\\mathbf{c}^*$ 的（复）梯度为：\n$$\\mathbf{g} = \\frac{\\partial E}{\\partial \\mathbf{c}^*} = \\frac{1}{\\mathbf{c}^\\dagger \\mathbf{S} \\mathbf{c}} (\\mathbf{H}\\mathbf{c} - E(\\mathbf{c})\\mathbf{S}\\mathbf{c})$$\n向量 $\\mathbf{r} = \\mathbf{H}\\mathbf{c} - E(\\mathbf{c})\\mathbf{S}\\mathbf{c}$ 是残差。一个简单的（最速）梯度下降更新将是 $\\mathbf{c}_{k+1} = \\mathbf{c}_k - \\alpha_k \\mathbf{g}_k$，其中 $\\alpha_k$ 是步长。这个更新规则在系数 $\\mathbf{c}$ 的空间中使用欧几里得度量。\n\n**预处理** 将此更新修改为 $\\mathbf{c}_{k+1} = \\mathbf{c}_k - \\alpha_k \\mathbf{P} \\mathbf{g}_k$，其中 $\\mathbf{P}$ 是预处理器矩阵。目标是选择一个能加速收敛的 $\\mathbf{P}$。这里有两个与预处理相关的主要理由：一个基于几何，另一个基于优化理论。\n\n### 逐项分析\n\n**A. 在非正交基中，系数空间中物理上有意义的距离概念是由重叠矩阵 $S$ 导出的，选择相对于 $S$-内积的最陡下降方向，实际上是将 $S$ 的逆矩阵应用于欧几里得梯度，这为使用近似 $S^{-1}$ 的矩阵进行预处理提供了理由。**\n- **分析：** 该陈述讨论了几何解释。两个波函数 $\\lvert \\psi_1 \\rangle$ 和 $\\lvert \\psi_2 \\rangle$ 之间的距离由它们差的范数给出，$||\\psi_1 - \\psi_2||^2 = \\langle \\psi_1 - \\psi_2 \\lvert \\psi_1 - \\psi_2 \\rangle$。对于波函数的无穷小变化 $\\lvert \\delta \\psi \\rangle = \\sum_i \\delta c_i \\lvert \\chi_i \\rangle$，其范数的平方是 $||\\delta \\psi||^2 = \\langle \\delta \\psi \\lvert \\delta \\psi \\rangle = \\delta \\mathbf{c}^\\dagger \\mathbf{S} \\delta \\mathbf{c}$。这表明系数向量空间中物理上正确的度量（或内积）是 $\\mathbf{S}$-内积，即 $(\\mathbf{u}, \\mathbf{v})_\\mathbf{S} = \\mathbf{u}^\\dagger \\mathbf{S} \\mathbf{v}$。“最速下降”的方向应该相对于这个度量来定义。在 $\\mathbf{S}$-度量下的梯度 $\\mathbf{g}_\\mathbf{S}$ 与欧几里得梯度 $\\mathbf{g}$ 通过 $\\mathbf{g} = \\mathbf{S} \\mathbf{g}_\\mathbf{S}$ 相关联。因此，在自然几何中的最速下降方向是 $-\\mathbf{g}_\\mathbf{S} = -\\mathbf{S}^{-1}\\mathbf{g}$。这正是一个使用预处理器 $\\mathbf{P} = \\mathbf{S}^{-1}$ 的预处理梯度步。该陈述是一个精确且正确的理由。\n- **结论：** 正确。\n\n**B. 在极小值点附近，能量景观在系数上是局部二次的，应用一个近似Hessian矩阵逆矩阵的预处理器可以重新标度坐标，使问题的条件数趋近于 $1$，从而平衡不同特征方向上的弛豫速率，进而在不改变真实最小值位置的情况下加速收敛。**\n- **分析：** 该陈述基于标准的优化理论。在局部最小值附近，任何足够光滑的函数都可以用二次型来近似，$E(\\mathbf{c}) \\approx E(\\mathbf{c}_{min}) + \\frac{1}{2}(\\mathbf{c}-\\mathbf{c}_{min})^\\dagger \\mathcal{H} (\\mathbf{c}-\\mathbf{c}_{min})$，其中 $\\mathcal{H}$ 是二阶导数的Hessian矩阵。基于梯度的方法的收敛速度受 $\\mathcal{H}$ 的条件数（其最大与最小特征值之比）的限制。大的条件数意味着能量等高线是高度椭圆的，梯度下降会进展缓慢且呈之字形。理想的预处理器是 $\\mathbf{P} \\approx \\mathcal{H}^{-1}$。这将预处理更新的有效Hessian矩阵变换为 $\\mathbf{P}^{1/2}\\mathcal{H}\\mathbf{P}^{1/2} \\approx \\mathbf{I}$，使得条件数接近1。这有效地使能量等高线变得球形，从而使基于梯度的方法能够快速收敛。重要的是，预处理只改变了通往最小值的路径；它不改变被最小化的泛函或其最小值的位置。该陈述完全正确。\n- **结论：** 正确。\n\n**C. 预处理会改变变分最小值的位置，并可能违反变分原理的上界性质；其表观的收敛优势仅仅源于采取了更大的步长，因此在变分最小化中应避免使用。**\n- **分析：** 这个陈述有根本性的错误。预处理是一种为迭代优化算法确定更好*搜索方向*的技术。被最小化的函数 $E(\\mathbf{c})$ 保持不变。因此，函数的最小值也保持不变。在每一步 $k$，能量 $E(\\mathbf{c}_k)$ 都是针对一个有效的试探波函数 $\\lvert \\psi_k \\rangle$ 计算的，所以变分原理 $E(\\mathbf{c}_k) \\ge E_0$ 永远不会被违反。其好处不仅仅是采取更大的步长，而是朝着能更有效降低能量并逼近最小值的方向迈进。该陈述完全曲解了预处理的目的和机制。\n- **结论：** 错误。\n\n**D. 在多尺度材料模型中，存在相差悬殊的长度尺度会导致重叠矩阵或Hessian矩阵的特征值分布范围巨大，使问题变得刚性；应用逆重叠或逆Hessian预处理器可以压缩谱并缓解刚性问题，从而减少收敛所需的迭代次数。**\n- **分析：** 该陈述正确地诊断了数值困难的物理根源。一个同时包含非常局域的函数（短长度尺度）和非常扩展的函数（长长度尺度）的基组是“多尺度”的。这导致重叠矩阵 $\\mathbf{S}$ 和Hessian矩阵 $\\mathcal{H}$ 变得病态（ill-conditioned），意味着它们的特征值分布在许多数量级上。这种巨大的谱宽（高条件数）是数值“刚性”问题的直接原因，在这种问题中，不同的误差分量以极不相同的速率衰减，从而减慢了整体收敛速度。一个好的预处理器 $\\mathbf{P}$（如 $\\mathbf{S}^{-1}$ 或 $\\mathcal{H}^{-1}$ 的近似）被设计成使得预处理后的矩阵（例如 $\\mathbf{P}\\mathbf{S}$ 或 $\\mathbf{P}\\mathcal{H}$）的特征值聚集在一起，即具有“压缩的谱”和更接近1的条件数。这直接纠正了刚性问题并加速了收敛。该陈述提供了一个正确且富有物理洞察力的理由。\n- **结论：** 正确。\n\n**E. 预处理等价于向哈密顿量添加一个常数平移 $H \\mapsto H + \\alpha I$（其中 $\\alpha$ 为某个标量），这会均匀地降低所有特征值，从而使基态更具主导性，这解释了更快的收敛速度。**\n- **分析：** 该陈述错误地混淆了两种不同的数值技术。如上所述，预处理通过修改梯度来产生一个更好的搜索方向（$\\mathbf{d}_k = -\\mathbf{P}\\mathbf{g}_k$）。相比之下，谱平移操作改变的是算符本身，例如在广义特征值问题中用 $\\mathbf{H} - \\sigma \\mathbf{S}$ 替换 $\\mathbf{H}$。这是移位反演法的一个关键组成部分，该方法旨在求解靠近平移量 $\\sigma$ 的特征值。向 $H$ 添加一项 $\\alpha I$（或者更准确地说是向矩阵 $H_{ij}$ 添加 $\\alpha S$）会将所有特征值平移 $\\alpha$，但这不会改变它们之间的间距，因此其本身并不会改善简单梯度下降的条件数或收敛速率。这两个概念不等价。\n- **结论：** 错误。",
            "answer": "$$\\boxed{ABD}$$"
        }
    ]
}