{
    "hands_on_practices": [
        {
            "introduction": "电子间的关联效应导致在任一电子周围形成一个电子概率降低的区域，即“关联空穴”。本练习将通过一个具体的关联空穴模型，引导你从第一性原理出发，解析地推导出相应的关联能。这个过程将加深你对关联能物理起源的理解，并展示理论模型如何与能量计算直接联系起来 。",
            "id": "3804520",
            "problem": "一个数密度为 $n$ 的三维均匀电子气 (HEG) 在零温下通过胶状模型进行模拟。一次扩散量子蒙特卡罗 (QMC) 分析提供了一个自旋求和相关洞模型，该模型与粒子数守恒求和规则和预期的短程屏蔽相符：\n$$\n\\Delta g_{c}(r) \\;=\\; A\\left(\\exp(-\\lambda r) \\;-\\; \\left(\\frac{\\mu}{\\lambda}\\right)^{3} \\exp(-\\mu r)\\right),\n$$\n其中参数 $\\mu>\\lambda>0$ 且 $A>0$。电子间的相互作用是库仑势 $v(r)=\\frac{e^{2}}{4\\pi \\varepsilon_{0} r}$，其中 $e$ 是元电荷，$\\varepsilon_{0}$ 是真空介电常数。双粒子密度通过 $\\rho^{(2)}(\\mathbf{r}_{1},\\mathbf{r}_{2})=n^{2} g(|\\mathbf{r}_{1}-\\mathbf{r}_{2}|)$ 与对分布函数相关联。\n\n从双粒子密度的电子-电子相互作用能的定义出发，并利用胶状模型的中性背景来消除与 $g(r)=1$ 相关的哈特里贡献，推导出每个电子的相关能 $\\varepsilon_{c}$，该能量是完全由 $\\Delta g_{c}(r)$ 对相互作用能的贡献。\n\n提供一个关于 $n$、$A$、$\\lambda$、$\\mu$、$e$ 和 $\\varepsilon_{0}$ 的完全简化的 $\\varepsilon_{c}$ 的单一闭式解析表达式。最终能量以焦耳为单位表示。不要代入常数的数值，也不要进行任何取整。",
            "solution": "问题要求解由胶状模型描述的均匀电子气中每个电子的相关能 $\\varepsilon_c$。该能量是给定的相关洞模型 $\\Delta g_c(r)$ 对电子-电子相互作用能的贡献。\n\n一个具有对势 $v(r)$ 的粒子系统中，总相互作用势能由以下通用公式给出：\n$$\nE_{int} = \\frac{1}{2} \\iint \\rho^{(2)}(\\mathbf{r}_{1}, \\mathbf{r}_{2}) v(|\\mathbf{r}_{1} - \\mathbf{r}_{2}|) d^3r_{1} d^3r_{2}\n$$\n问题指出，双粒子密度 $\\rho^{(2)}(\\mathbf{r}_{1}, \\mathbf{r}_{2})$ 通过 $\\rho^{(2)}(\\mathbf{r}_{1}, \\mathbf{r}_{2}) = n^{2} g(|\\mathbf{r}_{1} - \\mathbf{r}_{2}|)$ 与电子数密度 $n$ 和对分布函数 $g(r)$ 相关。将此代入能量表达式得到：\n$$\nE_{int} = \\frac{1}{2} n^{2} \\iint g(|\\mathbf{r}_{1} - \\mathbf{r}_{2}|) v(|\\mathbf{r}_{1} - \\mathbf{r}_{2}|) d^3r_{1} d^3r_{2}\n$$\n对于一个体积为 $V$ 的均匀系统，我们可以进行变量替换，换为相对坐标 $\\mathbf{r} = \\mathbf{r}_{2} - \\mathbf{r}_{1}$ 和质心坐标。对整个体积 $V$ 的质心坐标进行积分会得到一个因子 $V$。因此，表达式简化为：\n$$\nE_{int} = \\frac{1}{2} n^{2} V \\int g(r) v(r) d^3r\n$$\n系统中的总电子数是 $N = nV$。因此，每个电子的相互作用能 $\\varepsilon_{int} = E_{int}/N$ 为：\n$$\n\\varepsilon_{int} = \\frac{E_{int}}{nV} = \\frac{1}{2} n \\int g(r) v(r) d^3r\n$$\n对分布函数可以写成 $g(r) = 1 + h(r)$，其中 $h(r)$ 是对关联函数，表示与均匀、不相关气体的偏差。$g(r) = 1$ 这一项对应于电子与自身之间的经典静电能（哈特里能量）。问题指明，在胶状模型中，这一项被与均匀正背景的相互作用完全抵消。我们被要求求解相关能 $\\varepsilon_c$，这是由相关洞 $\\Delta g_c(r)$ 产生的贡献。这意味着我们在积分中用给定的模型 $\\Delta g_c(r)$ 替换 $g(r)$：\n$$\n\\varepsilon_{c} = \\frac{1}{2} n \\int \\Delta g_{c}(r) v(r) d^3r\n$$\n积分遍及整个空间。我们使用球坐标，其中微分体积元是 $d^3r = 4\\pi r^2 dr$。给定的函数是：\n$$\n\\Delta g_{c}(r) \\;=\\; A\\left(\\exp(-\\lambda r) \\;-\\; \\left(\\frac{\\mu}{\\lambda}\\right)^{3} \\exp(-\\mu r)\\right)\n$$\n$$\nv(r) = \\frac{e^{2}}{4\\pi \\varepsilon_{0} r}\n$$\n将这些代入 $\\varepsilon_c$ 的表达式中：\n$$\n\\varepsilon_{c} = \\frac{1}{2} n \\int_{0}^{\\infty} \\left[ A\\left(\\exp(-\\lambda r) - \\left(\\frac{\\mu}{\\lambda}\\right)^{3} \\exp(-\\mu r)\\right) \\right] \\left( \\frac{e^{2}}{4\\pi \\varepsilon_{0} r} \\right) (4\\pi r^{2} dr)\n$$\n我们可以通过消去 $4\\pi$ 因子并将常数移到积分外来简化表达式：\n$$\n\\varepsilon_{c} = \\frac{1}{2} n A \\frac{e^{2}}{\\varepsilon_{0}} \\int_{0}^{\\infty} \\left[ \\exp(-\\lambda r) - \\left(\\frac{\\mu}{\\lambda}\\right)^{3} \\exp(-\\mu r) \\right] r \\, dr\n$$\n该积分可以通过将其分成两部分来计算：\n$$\nI = \\int_{0}^{\\infty} r \\exp(-\\lambda r) dr - \\left(\\frac{\\mu}{\\lambda}\\right)^{3} \\int_{0}^{\\infty} r \\exp(-\\mu r) dr\n$$\n我们使用标准定积分公式 $\\int_{0}^{\\infty} x^{k} \\exp(-ax) dx = \\frac{k!}{a^{k+1}}$。对于 $k=1$，该公式给出 $\\int_{0}^{\\infty} x \\exp(-ax) dx = \\frac{1}{a^{2}}$。\n将此公式应用于我们的积分：\n$$\n\\int_{0}^{\\infty} r \\exp(-\\lambda r) dr = \\frac{1}{\\lambda^{2}}\n$$\n$$\n\\int_{0}^{\\infty} r \\exp(-\\mu r) dr = \\frac{1}{\\mu^{2}}\n$$\n将这些结果代回 $I$ 的表达式中：\n$$\nI = \\frac{1}{\\lambda^{2}} - \\left(\\frac{\\mu}{\\lambda}\\right)^{3} \\frac{1}{\\mu^{2}} = \\frac{1}{\\lambda^{2}} - \\frac{\\mu^{3}}{\\lambda^{3}\\mu^{2}} = \\frac{1}{\\lambda^{2}} - \\frac{\\mu}{\\lambda^{3}}\n$$\n为了合并这些项，我们使用公分母 $\\lambda^{3}$：\n$$\nI = \\frac{\\lambda}{\\lambda^{3}} - \\frac{\\mu}{\\lambda^{3}} = \\frac{\\lambda - \\mu}{\\lambda^{3}}\n$$\n最后，我们将积分 $I$ 的结果代回 $\\varepsilon_c$ 的表达式中：\n$$\n\\varepsilon_{c} = \\frac{1}{2} n A \\frac{e^{2}}{\\varepsilon_{0}} \\left( \\frac{\\lambda - \\mu}{\\lambda^{3}} \\right)\n$$\n这可以写成一个单一的、完全简化的分数，即每个电子的相关能的最终闭式表达式，单位为焦耳。\n$$\n\\varepsilon_{c} = \\frac{n A e^{2} (\\lambda - \\mu)}{2 \\varepsilon_{0} \\lambda^{3}}\n$$\n在给定条件 $\\mu > \\lambda > 0$ 下，项 $(\\lambda - \\mu)$ 是负的。所有其他量（$n$、$A$、$e$、$\\varepsilon_0$、$\\lambda$）都是正的。因此，$\\varepsilon_c$ 是负值，这对于相关能来说在物理上是正确的，因为它表示由于电子-电子相关性而导致的系统能量降低。",
            "answer": "$$\\boxed{\\frac{n A e^{2} (\\lambda - \\mu)}{2 \\varepsilon_{0} \\lambda^{3}}}$$"
        },
        {
            "introduction": "理论公式虽然优美，但在实际的材料模拟中，交换关联能必须通过对电子密度在空间中进行数值积分来计算。本练习将指导你为一个球对称体系实现一个基于辛普森法则的数值积分程序，用以计算局域密度近似 (LDA) 下的交换关联能。通过这个实践，你将掌握将抽象的泛函理论转化为具体计算代码的核心技能，并学会如何评估数值精度 。",
            "id": "3804514",
            "problem": "考虑在局域密度近似 (LDA) 框架下，计算自旋非极化体系的电子交换和关联能，能量单位为原子单位 (Hartree)。交换关联能量泛函定义为 $E_{xc}[n] = \\int d^3\\mathbf{r}\\, n(\\mathbf{r})\\, \\varepsilon_{xc}(n(\\mathbf{r}))$，其中 $n(\\mathbf{r})$ 是电子数密度，$\\varepsilon_{xc}(n)$ 是密度为 $n$ 的均匀电子气中每个电子的交换关联能。在 LDA 中，每个电子的交换能由 Hartree-Fock 理论推导出的均匀电子气熟知公式给出，即 $\\varepsilon_{x}(n) = -\\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3} n^{1/3}$。每个电子的关联能的高密度极限形式则被建模为 $\\varepsilon_{c}(r_s) = \\gamma \\ln(r_s) + \\beta$，其中 $r_s = \\left(\\frac{3}{4\\pi n}\\right)^{1/3}$，$\\gamma = 0.031091$，$\\beta = -0.048$。这些是广泛使用的常数，与均匀电子气的多体理论一致。\n\n你将使用球坐标为球对称密度实现一个数值积分方法，使得 $E_{xc}[n] = 4\\pi \\int_{0}^{R_{\\max}} dr\\, r^2\\, n(r)\\, \\varepsilon_{xc}(n(r))$。此计算的基础是将 $E_{xc}[n]$ 定义为球坐标下的空间积分，并使用上面提供的 $\\varepsilon_{x}(n)$ 和 $\\varepsilon_{c}(r_s)$ 的已知表达式。\n\n该积分应在均匀径向网格上使用复合辛普森法则进行数值计算。为了确保辛普森模板有效，在为区间 $[0,R_{\\max}]$ 和给定的间距 $h$ 构建网格时，应使用最小的区间数 $M$，该 $M$ 需同时满足 (i) $M \\ge \\lceil R_{\\max}/h \\rceil$ 和 (ii) 是一个偶数。然后将实际间距设置为 $h_{\\text{eff}} = R_{\\max}/M$。这保证了区间数为偶数，同时保持 $h_{\\text{eff}} \\le h$。对于密度趋于零的区域，通过 $r_s \\to \\infty$，每个电子的关联能 $\\varepsilon_{c}(r_s)$ 在 $n \\to 0$ 时形式上发散。然而，被积函数 $n\\,\\varepsilon_c(r_s(n))$ 仍然是可积的，因为当 $n \\to 0$ 时，$n \\ln(n)$ 趋于零。在数值上，为避免计算 $\\ln(0)$，在计算 $r_s$ 时必须对密度设置一个下界 $n_{\\min} = 10^{-12}$；也就是说，在 $\\varepsilon_c$ 中使用 $n_{\\text{corr}}(r) = \\max(n(r), n_{\\min})$，但在最终的被积函数中始终乘以真实的 $n(r)$。\n\n为进行测试，请考虑以下以原子单位表示的球对称密度 $n(r)$：\n- 平滑高斯密度：$n(r) = n_0\\, e^{-\\alpha r^2}$，其中 $n_0 = 0.05$，$\\alpha = 0.3$，截断半径 $R_{\\max} = 12$。\n- 均匀球体密度：当 $0 \\le r \\le R_s$ 时，$n(r) = n_s$；当 $r > R_s$ 时，$n(r) = 0$。其中 $n_s = 0.02$，$R_s = 6$，截断半径 $R_{\\max} = 12$。\n- 指数尖点密度：$n(r) = n_c\\, e^{-\\beta r}$，其中 $n_c = 0.1$，$\\beta = 1.2$，截断半径 $R_{\\max} = 30$。\n\n对于交换能，该积分具有以下精确解析形式，你必须使用它们进行误差评估：\n- 高斯密度：$E_{x}^{\\text{exact}} = -C_x\\, n_0^{4/3}\\, \\pi^{3/2}\\, \\left( \\frac{4}{3}\\alpha \\right)^{-3/2}$，其中 $C_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$。\n- 均匀球体密度：$E_{x}^{\\text{exact}} = -C_x\\, n_s^{4/3}\\, \\frac{4}{3}\\pi R_s^3$。\n- 指数尖点密度：$E_{x}^{\\text{exact}} = -C_x\\, \\frac{8\\pi\\, n_c^{4/3}}{\\left( \\frac{4}{3}\\beta \\right)^3}$。\n\n对于关联能，均匀球体情况在此处使用的高密度模型下具有精确解析形式，因为在其非零区域 $n(r)$ 是常数：\n- 均匀球体密度：$E_{c}^{\\text{exact}} = n_s\\, \\varepsilon_c\\!\\left( \\left(\\frac{3}{4\\pi n_s}\\right)^{1/3} \\right)\\, \\frac{4}{3}\\pi R_s^3$。\n\n使用复合辛普森法则和上述网格构建方法，对所需的积分进行数值近似。使用以下请求间距的测试套件：\n- 对于高斯密度，在 $[0, R_{\\max}]$ 上使用 $h \\in \\{0.4, 0.2, 0.1\\}$，并计算每个 $h$ 对应的绝对交换能误差 $|E_{x}^{\\text{num}} - E_{x}^{\\text{exact}}|$。\n- 对于均匀球体密度，在 $[0, R_{\\max}]$ 上使用 $h = 0.1$，并计算两个绝对误差：交换能误差 $|E_{x}^{\\text{num}} - E_{x}^{\\text{exact}}|$ 和关联能误差 $|E_{c}^{\\text{num}} - E_{c}^{\\text{exact}}|$。\n- 对于指数尖点密度，在 $[0, R_{\\max}]$ 上使用 $h = 0.1$，并计算绝对交换能误差 $|E_{x}^{\\text{num}} - E_{x}^{\\text{exact}}|$。\n\n所有能量和误差必须以 Hartree 为单位表示。你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔结果列表，顺序如下：$h=0.4, h=0.2, h=0.1$ 时的三个高斯交换能误差，然后是 $h=0.1$ 时的两个均匀球体误差（交换能和关联能），最后是 $h=0.1$ 时的指数尖点交换能误差，即 $[e_{G,0.4}, e_{G,0.2}, e_{G,0.1}, e_{U,x,0.1}, e_{U,c,0.1}, e_{E,0.1}]$。",
            "solution": "该问题要求在局域密度近似 (LDA) 框架下，对各种球对称电子密度 $n(r)$，数值计算其交换和关联能 $E_{xc}$。计算结果将与精确解析解进行比较，以评估数值方法的误差。\n\nLDA 中的总交换关联能量泛函由下式给出：\n$$\nE_{xc}[n] = \\int d^3\\mathbf{r}\\, n(\\mathbf{r})\\, \\varepsilon_{xc}(n(\\mathbf{r}))\n$$\n其中 $\\varepsilon_{xc}(n)$ 是密度为 $n$ 的均匀电子气中每个粒子的交换关联能。该能量是交换和关联分量的和，$\\varepsilon_{xc}(n) = \\varepsilon_{x}(n) + \\varepsilon_{c}(n)$。\n\n对于球对称系统，积分简化为：\n$$\nE_{xc}[n] = 4\\pi \\int_{0}^{R_{\\max}} dr\\, r^2\\, n(r)\\, \\varepsilon_{xc}(n(r))\n$$\n其中 $r$ 是径向距离，$R_{\\max}$ 是一个截断半径，在此半径之外密度被认为可以忽略不计。\n\n提供了 $\\varepsilon_{x}(n)$ 和 $\\varepsilon_{c}(n)$ 的具体形式：\n每个粒子的交换能由均匀电子气的 Hartree-Fock 结果给出：\n$$\n\\varepsilon_{x}(n) = -C_x n^{1/3} \\quad \\text{其中} \\quad C_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}\n$$\n每个粒子的关联能由高密度（低 $r_s$）极限形式给出：\n$$\n\\varepsilon_{c}(r_s) = \\gamma \\ln(r_s) + \\beta\n$$\n其中 $\\gamma = 0.031091$，$\\beta = -0.048$，$r_s$ 是 Wigner-Seitz 半径，与密度 $n$ 的关系为：\n$$\nr_s = \\left(\\frac{3}{4\\pi n}\\right)^{1/3}\n$$\n\n积分的数值评估将使用复合辛普森法则进行。规定了一个特定的网格生成程序。对于给定的积分域 $[0, R_{\\max}]$ 和请求的网格间距 $h$，区间数 $M$ 被确定为满足 $M \\ge \\lceil R_{\\max}/h \\rceil$ 的最小偶数。这确保了由 $M+1$ 个点组成的网格适用于需要奇数个点（即偶数个区间）的复合辛普森法则。然后，有效网格间距为 $h_{\\text{eff}} = R_{\\max}/M$。径向网格点为 $r_i = i \\cdot h_{\\text{eff}}$，$i = 0, 1, \\dots, M$。\n\n在关联能项中出现了一个数值挑战，因为 $n \\to 0$ 意味着 $r_s \\to \\infty$ 且 $\\varepsilon_c(r_s) \\to \\infty$。尽管乘积 $n\\,\\varepsilon_c(n)$ 正确地收敛到 $0$，但必须避免对 $\\ln(\\infty)$ 进行浮点计算。问题指定了一个正则化程序：在为关联能计算 $r_s$ 时，密度 $n(r)$ 的下限被设为最小值 $n_{\\min} = 10^{-12}$。也就是说，计算 $\\varepsilon_c(n_{\\text{corr}}(r))$，其中 $n_{\\text{corr}}(r) = \\max(n(r), n_{\\min})$。那么，在径向点 $r$ 处关联能的完整被积函数是 $4\\pi r^2 n(r)\\, \\varepsilon_c(n_{\\text{corr}}(r))$。\n\n该解决方案通过以下步骤实现：\n1.  定义所有物理常数（$C_x, \\gamma, \\beta, n_{\\min}$）和三种给定密度分布（高斯、均匀球体、指数尖点）的参数。\n2.  为每种密度分布 $n(r)$ 实现函数。\n3.  定义交换能和关联能的被积函数。半径为 $r$ 处的交换能被积函数是 $I_x(r) = 4\\pi r^2 n(r) \\varepsilon_x(n(r)) = -4\\pi C_x r^2 [n(r)]^{4/3}$。关联能被积函数是 $I_c(r) = 4\\pi r^2 n(r) \\varepsilon_c(n_{\\text{corr}}(r))$。\n4.  实现一个主计算程序，对每个测试案例：\n    a. 确定区间数 $M$ 并构建从 $0$ 到 $R_{\\max}$ 且包含 $M+1$ 个点的径向网格 $r$。\n    b. 在每个网格点上计算密度 $n(r)$ 和相应的被积函数（$I_x(r)$ 或 $I_c(r)$）。\n    c. 使用数值积分库函数，特别是 `scipy.integrate.simpson`，从被积函数值和网格点的数组中计算定积分。该函数正确实现了复合辛普森法则。\n    d. 使用提供的公式计算精确解析能量。\n    e. 计算数值解与精确值之间的绝对误差。\n5.  收集所有测试案例计算出的误差，并按指定格式格式化为输出字符串。\n\n计算按以下案例进行：\n- **高斯密度**：$n(r) = n_0\\, e^{-\\alpha r^2}$，其中 $n_0 = 0.05$，$\\alpha = 0.3$，$R_{\\max} = 12$。对请求的间距 $h \\in \\{0.4, 0.2, 0.1\\}$ 计算绝对交换能误差 $|E_{x}^{\\text{num}} - E_{x}^{\\text{exact}}|$。\n- **均匀球体密度**：当 $r \\le R_s$ 时 $n(r) = n_s$，否则为 $0$，其中 $n_s = 0.02$，$R_s = 6$，$R_{\\max} = 12$。对 $h = 0.1$ 计算绝对交换能误差 $|E_{x}^{\\text{num}} - E_{x}^{\\text{exact}}|$ 和关联能误差 $|E_{c}^{\\text{num}} - E_{c}^{\\text{exact}}|$。\n- **指数尖点密度**：$n(r) = n_c\\, e^{-\\beta r}$，其中 $n_c = 0.1$，$\\beta = 1.2$，$R_{\\max} = 30$。对 $h = 0.1$ 计算绝对交换能误差 $|E_{x}^{\\text{num}} - E_{x}^{\\text{exact}}|$。\n\n然后，将这些值按规定顺序组合成最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import simpson\n\ndef solve():\n    \"\"\"\n    Computes exchange and correlation energy errors for various density profiles\n    using the Local Density Approximation (LDA) and Simpson's rule integration.\n    \"\"\"\n\n    # --- Constants and Physical Parameters ---\n    C_x = (3/4) * (3 / np.pi)**(1/3)\n    GAMMA = 0.031091\n    BETA_CORR = -0.048\n    N_MIN = 1e-12\n\n    # --- Energy, Density, and Integrand Functions ---\n\n    def eps_c(n):\n        \"\"\"Correlation energy per particle.\"\"\"\n        n_corr = np.maximum(n, N_MIN)\n        # Suppress divide-by-zero warnings for n=0, though np.maximum prevents it.\n        with np.errstate(divide='ignore'):\n            rs = (3 / (4 * np.pi * n_corr))**(1/3)\n        return GAMMA * np.log(rs) + BETA_CORR\n\n    # --- Analytical Solutions ---\n\n    def exact_Ex_gaussian(n0, alpha):\n        return -C_x * n0**(4/3) * np.pi**(3/2) * (4/3 * alpha)**(-3/2)\n\n    def exact_Ex_uniform_sphere(ns, Rs):\n        return -C_x * ns**(4/3) * (4/3 * np.pi * Rs**3)\n\n    def exact_Ec_uniform_sphere(ns, Rs):\n        rs_val = (3 / (4 * np.pi * ns))**(1/3)\n        eps_c_val = GAMMA * np.log(rs_val) + BETA_CORR\n        return ns * eps_c_val * (4/3 * np.pi * Rs**3)\n\n    def exact_Ex_exp_cusp(nc, beta_exp):\n        return -C_x * (8 * np.pi * nc**(4/3)) / ((4/3 * beta_exp)**3)\n\n    # --- Numerical Integration and Error Calculation ---\n    \n    def compute_numerical_errors(config):\n        \"\"\"\n        Main function to compute numerical integrals and errors for a given configuration.\n        \"\"\"\n        errors = []\n        \n        density_type = config['type']\n        params = config['params']\n        R_max = config['R_max']\n        h_values = config['h_values']\n        tasks = config['tasks']\n\n        for h in h_values:\n            # 1. Grid construction\n            if h == 0:\n                # Avoid division by zero, although not expected from problem statement\n                raise ValueError(\"Grid spacing h must be positive.\")\n            M = int(np.ceil(R_max / h))\n            if M % 2 != 0:\n                M += 1\n            if M == 0: # Handle R_max = 0 case\n                M = 2\n            \n            r_grid = np.linspace(0, R_max, M + 1)\n\n            # 2. Density evaluation\n            if density_type == 'gaussian':\n                n0, alpha = params['n0'], params['alpha']\n                n_r = n0 * np.exp(-alpha * r_grid**2)\n            elif density_type == 'uniform_sphere':\n                ns, Rs = params['ns'], params['Rs']\n                n_r = np.where(r_grid = Rs, ns, 0.0)\n            elif density_type == 'exp_cusp':\n                nc, beta_exp = params['nc'], params['beta']\n                n_r = nc * np.exp(-beta_exp * r_grid)\n\n            # 3. Perform integration for each task (exchange/correlation)\n            for task in tasks:\n                if task == 'exchange':\n                    integrand = -4 * np.pi * C_x * r_grid**2 * n_r**(4/3)\n                    E_num = simpson(integrand, r_grid)\n                    \n                    if density_type == 'gaussian':\n                        E_exact = exact_Ex_gaussian(params['n0'], params['alpha'])\n                    elif density_type == 'uniform_sphere':\n                        E_exact = exact_Ex_uniform_sphere(params['ns'], params['Rs'])\n                    elif density_type == 'exp_cusp':\n                        E_exact = exact_Ex_exp_cusp(params['nc'], params['beta'])\n                \n                elif task == 'correlation':\n                    # This task is only for the uniform sphere case\n                    eps_c_r = eps_c(n_r)\n                    integrand = 4 * np.pi * r_grid**2 * n_r * eps_c_r\n                    E_num = simpson(integrand, r_grid)\n                    E_exact = exact_Ec_uniform_sphere(params['ns'], params['Rs'])\n\n                errors.append(abs(E_num - E_exact))\n        \n        return errors\n        \n    # --- Test Case Definitions ---\n    test_configs = [\n        {\n            'type': 'gaussian',\n            'params': {'n0': 0.05, 'alpha': 0.3},\n            'R_max': 12,\n            'h_values': [0.4, 0.2, 0.1],\n            'tasks': ['exchange']\n        },\n        {\n            'type': 'uniform_sphere',\n            'params': {'ns': 0.02, 'Rs': 6},\n            'R_max': 12,\n            'h_values': [0.1],\n            'tasks': ['exchange', 'correlation']\n        },\n        {\n            'type': 'exp_cusp',\n            'params': {'nc': 0.1, 'beta': 1.2},\n            'R_max': 30,\n            'h_values': [0.1],\n            'tasks': ['exchange']\n        }\n    ]\n    \n    # --- Main Execution ---\n    all_results = []\n    for config in test_configs:\n        results_for_case = compute_numerical_errors(config)\n        all_results.extend(results_for_case)\n\n    # --- Final Output Formatting ---\n    print(f\"[{','.join(f'{res:.12e}' for res in all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在多尺度模拟中，将一个大体系划分为多个子体系处理是一种常用策略，但这需要精确处理子体系间的相互作用。由于交换关联泛函的非线性特性，总能量并非各子体系能量的简单加和，其差值被称为非加和交换关联能。本练习将运用数值积分技能来量化这一关键的非加和项，帮助你理解在嵌入理论中描述量子力学相互作用的复杂性与核心挑战 。",
            "id": "3804497",
            "problem": "需要在密度泛函理论（DFT）框架内，使用局域密度近似（LDA）来计算电子交换和关联能，从而进行一维嵌入计算。目标是计算非加和交换关联能，在子系统嵌入中，对于定义在域 $x \\in [0,L]$ 上的两个具有电子密度 $n_A(x)$ 和 $n_B(x)$ 的子系统，该量定义为\n$$\nE_{xc}^{\\mathrm{nad}}[n_A,n_B] \\equiv E_{xc}[n_A+n_B] - E_{xc}[n_A] - E_{xc}[n_B].\n$$\n计算应将 $n(x)$ 视为原子单位（电子/玻尔$^3$）下的三维数密度，该密度在单位横截面积上是均匀的，因此对 $x$ 的一维积分可以再现单位面积上的三维积分。能量必须以 Hartree 表示。长度 $L$ 以玻尔为单位，网格是均匀的，间距为 $\\Delta x = L/(N-1)$。此问题不涉及角度。\n\n从 Kohn–Sham DFT 和均匀电子气模型的第一性原理出发。在问题陈述中，采用以下基本近似和事实，不使用简化公式：\n- 在 LDA 中，交换关联能被写为一个由均匀电子气构建的局域能量密度的积分。\n- 每个电子的交换能仅取决于均匀电子气的局域密度 $n(x)$。\n- 每个电子的关联能由一个经过充分检验的分段参数化给出，该参数化拟合了均匀电子气的量子蒙特卡罗数据（Perdew–Zunger 参数化，自旋非极化情况）。\n\n基于这些基础，推导出对 $E_{xc}[n]$ 的交换和关联贡献的适当表达式，然后在给定网格上通过数值积分计算 $E_{xc}^{\\mathrm{nad}}[n_A,n_B]$。对于 $n(x) \\to 0$ 的情况，使用一种与均匀电子气物理极限行为一致的稳健处理方法。\n\n您的程序必须实现您推导出的公式，并为以下测试用例集计算 $E_{xc}^{\\mathrm{nad}}[n_A,n_B]$。在每个案例中，密度 $n_A(x)$ 和 $n_B(x)$ 在 $[0,L]$ 上的均匀网格 $x_i = i \\Delta x$（$i = 0,1,\\dots,N-1$）上指定。每个高斯密度由公式 $n(x) = A \\exp\\!\\left(-\\frac{(x-x_0)^2}{2\\sigma^2}\\right)$ 定义，其中 $A$ 是峰值密度（单位为电子/玻尔$^3$），$x_0$ 是中心（单位为玻尔），$\\sigma$ 是宽度（单位为玻尔）。均匀密度是常数函数。所有参数均以原子单位给出。\n\n测试用例集：\n- 案例 1（重叠高斯分布，理想情况）：$L=20$，$N=4001$，$n_A(x)$ 为高斯分布，参数为 $A_A=0.05, x_A=8, \\sigma_A=0.8$，$n_B(x)$ 为高斯分布，参数为 $A_B=0.04, x_B=12, \\sigma_B=0.8$。\n- 案例 2（良好分离的高斯分布，接近不重叠极限）：$L=20$，$N=4001$，$n_A(x)$ 为高斯分布，参数为 $A_A=0.05, x_A=4, \\sigma_A=0.5$，$n_B(x)$ 为高斯分布，参数为 $A_B=0.05, x_B=16, \\sigma_B=0.5$。\n- 案例 3（子系统 A 缺失，严格边界）：$L=20$，$N=4001$，$n_A(x) \\equiv 0$，$n_B(x)$ 为高斯分布，参数为 $A_B=0.06, x_B=10, \\sigma_B=1.0$。\n- 案例 4（均匀密度，强重叠，边缘行为）：$L=20$，$N=4001$，$n_A(x) \\equiv 0.03$，$n_B(x) \\equiv 0.02$。\n\n实现要求：\n- 使用均匀网格，并通过黎曼和 $\\sum_i e_{xc}(n(x_i)) \\Delta x$ 来近似积分。\n- 定义与均匀电子气一致的 Wigner–Seitz 半径 $r_s(n)$，并使用自旋非极化的 Perdew–Zunger 关联参数化。\n- 确保在 $n=0$ 处的计算能够平滑地趋近于正确的物理极限，方法是在任何可能未定义的中间表达式中用 $\\max(n,\\varepsilon)$ 替换 $n$，其中选择一个小的下限值 $\\varepsilon$ 以保持数值稳定性和物理极限行为。\n\n您的程序应生成单行输出，其中包含测试用例集中四个案例的 $E_{xc}^{\\mathrm{nad}}[n_A,n_B]$ 结果，以 Hartree 为单位表示为浮点数。最终输出格式必须是一个用方括号括起来的逗号分隔列表，按案例 1 到 4 的顺序排列，例如 $[e_1,e_2,e_3,e_4]$，其中每个 $e_i$ 是一个以 Hartree 为单位的浮点数。",
            "solution": "该问题要求在密度泛函理论（DFT）框架内，具体使用局域密度近似（LDA），计算一维系统的非加和交换关联能 $E_{xc}^{\\mathrm{nad}}[n_A,n_B]$。该问题是适定的，有科学依据，并为获得唯一解提供了所有必要信息。\n\n非加和交换关联能定义为：\n$$\nE_{xc}^{\\mathrm{nad}}[n_A, n_B] = E_{xc}[n_A + n_B] - E_{xc}[n_A] - E_{xc}[n_B]\n$$\n其中 $n_A(x)$ 和 $n_B(x)$ 是定义在域 $x \\in [0, L]$ 上的两个子系统的电子密度。\n\n我们的第一步是建立 LDA 交换关联能泛函 $E_{xc}[n]$ 的表达式。LDA 通过对局域能量密度进行积分来近似非均匀系统的交换关联能，其中每个点的能量密度被视为与该点具有相同电子密度的均匀电子气（UEG）的能量密度。对于指定的一维问题，其中 $n(x)$ 代表在单位横截面积上均匀的三维密度，能量泛函为：\n$$\nE_{xc}[n] = \\int_0^L n(x) \\varepsilon_{xc}(n(x)) dx\n$$\n这里，$\\varepsilon_{xc}(n)$ 是密度为 $n$ 的 UEG 中每个粒子的交换关联能。每个粒子的能量是交换和关联贡献的总和：\n$$\n\\varepsilon_{xc}(n) = \\varepsilon_x(n) + \\varepsilon_c(n)\n$$\n\n该积分将使用黎曼和在均匀网格 $x_i = i \\Delta x$（$i = 0, 1, \\dots, N-1$，其中 $\\Delta x = L/(N-1)$）上进行数值计算。\n$$\nE_{xc}[n] \\approx \\sum_{i=0}^{N-1} n(x_i) \\varepsilon_{xc}(n(x_i)) \\Delta x\n$$\n\n我们现在根据问题的第一性原理指令推导 $\\varepsilon_x(n)$ 和 $\\varepsilon_c(n)$ 的表达式。\n\n**1. 每个粒子的交换能 $\\varepsilon_x(n)$**\n\n对于自旋非极化的 UEG，每个粒子的交换能由精确的 Dirac 公式给出，该公式源自 Hartree-Fock 理论。在原子单位（Hartree）下，该公式为：\n$$\n\\varepsilon_x(n) = - \\frac{3}{4} \\left( \\frac{3}{\\pi} \\right)^{1/3} n^{1/3}\n$$\n相应的单位长度上的交换能密度为 $e_x(n) = n \\varepsilon_x(n) = -C_x n^{4/3}$，其中常数 $C_x = \\frac{3}{4} \\left( \\frac{3}{\\pi} \\right)^{1/3}$。\n\n**2. 每个粒子的关联能 $\\varepsilon_c(n)$**\n\n问题指定使用 Perdew–Zunger（PZ）参数化来计算自旋非极化 UEG 的关联能，该参数化是对精确的量子蒙特卡罗模拟数据的拟合。此参数化表示为无量纲 Wigner–Seitz 半径 $r_s(n)$ 的函数。半径 $r_s$ 的定义是，半径为 $r_s$（以玻尔半径 $a_0$ 为单位）的球体体积等于每个电子的体积 $1/n$。\n$$\n\\frac{4}{3} \\pi r_s^3 = \\frac{1}{n} \\implies r_s(n) = \\left( \\frac{3}{4\\pi n} \\right)^{1/3}\n$$\n$\\varepsilon_c(r_s)$ 的 PZ 参数化是一个分段函数：\n\n对于高密度区域（$r_s  1$）：\n$$\n\\varepsilon_c(r_s) = A \\ln r_s + B + C r_s \\ln r_s + D r_s\n$$\n其中，参数（以 Hartree 为单位）为 $A = 0.0311$, $B = -0.048$, $C = 0.0020$, $D = -0.0116$。\n\n对于低密度区域（$r_s \\geq 1$）：\n$$\n\\varepsilon_c(r_s) = \\frac{\\gamma}{1 + \\beta_1 \\sqrt{r_s} + \\beta_2 r_s}\n$$\n其中，参数为 $\\gamma = -0.1423$, $\\beta_1 = 1.0529$, $\\beta_2 = 0.3334$。\n\n**3. 算法和数值实现**\n\n实现的核心将是一个函数，用于为给定的密度数组 $n$ 计算 $E_{xc}[n]$。该函数将遵循以下步骤：\n- 对于网格上的输入密度数组 $n = \\{n_i\\}$，我们首先处理 $n \\to 0$ 的极限情况。$r_s(n)$ 的计算涉及 $n^{-1/3}$，当 $n=0$ 时会发散。然而，在物理上，能量密度 $e_{xc}(n) = n\\varepsilon_{xc}(n)$ 在 $n \\to 0$ 时趋于 $0$。为了在数值上处理这个问题，我们引入一个小的正数下限 $\\varepsilon$，并使用 $n_{\\text{safe}} = \\max(n, \\varepsilon)$ 来计算 $r_s$。最终的能量密度计算为 $n \\times (\\varepsilon_x(n) + \\varepsilon_c(r_s(n_{\\text{safe}})))$，当 $n=0$ 时，该式能正确地计算为 $0$。\n- 对网格点执行向量化计算：\n    1. 从密度数组 $\\{n_i\\}$ 计算 Wigner–Seitz 半径数组 $\\{r_{s,i}\\}$。\n    2. 使用 $\\varepsilon_x(n_i)$ 的公式计算每个粒子的交换能数组 $\\{\\varepsilon_{x,i}\\}$。\n    3. 通过将分段 PZ 泛函应用于 $\\{r_{s,i}\\}$ 来计算每个粒子的关联能数组 $\\{\\varepsilon_{c,i}\\}$。\n    4. 计算单位长度上的总交换关联能密度数组 $\\{e_{xc,i}\\} = \\{n_i (\\varepsilon_{x,i} + \\varepsilon_{c,i})\\}$。\n    5. 将 $\\{e_{xc,i}\\}$ 的元素求和，并乘以网格间距 $\\Delta x$ 以获得 $E_{xc}[n]$。\n\n为了找到每个测试用例的最终答案，我们在指定的网格上生成密度数组 $n_A(x)$ 和 $n_B(x)$。然后我们计算 $n_{tot}(x) = n_A(x) + n_B(x)$。$E_{xc}[n]$ 函数被调用三次，分别用于 $n_A$、$n_B$ 和 $n_{tot}$。然后通过求差 $E_{xc}^{\\mathrm{nad}} = E_{xc}[n_{tot}] - E_{xc}[n_A] - E_{xc}[n_B]$ 来计算非加和能。对所有四个测试用例重复此过程。一个 $n_A(x) \\equiv 0$ 的特定案例用作空检验，此时 $E_{xc}[n_A]=0$ 且 $E_{xc}[n_A+n_B]=E_{xc}[n_B]$，导致 $E_{xc}^{\\mathrm{nad}}$ 精确为 $0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_exc_lda(n, delta_x):\n    \"\"\"\n    Calculates the exchange-correlation energy for a given 1D density profile\n    using the Local Density Approximation (LDA).\n\n    Args:\n        n (np.ndarray): Array of electron densities at grid points (in Bohr^-3).\n        delta_x (float): Uniform grid spacing (in Bohr).\n\n    Returns:\n        float: The total exchange-correlation energy (in Hartree).\n    \"\"\"\n    # A small positive constant to prevent division by zero for n - 0.\n    # The value is chosen to be small enough to not affect results for typical densities.\n    epsilon = 1e-40\n\n    # Create a \"safe\" density array for calculations involving 1/n.\n    n_safe = np.maximum(n, epsilon)\n\n    # 1. Wigner-Seitz radius, r_s = (3 / (4 * pi * n))^(1/3)\n    rs = (3.0 / (4.0 * np.pi * n_safe))**(1.0/3.0)\n\n    # 2. Exchange energy per particle, epsilon_x(n) = - (3/4) * (3/pi)^(1/3) * n^(1/3)\n    # The calculation is safe with original n since n^(1/3) is 0 for n=0.\n    cx = (3.0/4.0) * (3.0/np.pi)**(1.0/3.0)\n    eps_x = -cx * n**(1.0/3.0)\n\n    # 3. Correlation energy per particle, epsilon_c(r_s) (Perdew-Zunger 1981)\n    eps_c = np.zeros_like(rs)\n\n    # High-density regime: r_s  1.0\n    # eps_c = A*ln(r_s) + B + C*r_s*ln(r_s) + D*r_s\n    high_density_mask = rs  1.0\n    rs_high = rs[high_density_mask]\n    A = 0.0311\n    B = -0.048\n    C = 0.0020\n    D = -0.0116\n    eps_c[high_density_mask] = A * np.log(rs_high) + B + C * rs_high * np.log(rs_high) + D * rs_high\n\n    # Low-density regime: r_s = 1\n    # eps_c = gamma / (1 + beta1*sqrt(r_s) + beta2*r_s)\n    low_density_mask = ~high_density_mask\n    rs_low = rs[low_density_mask]\n    gamma = -0.1423\n    beta1 = 1.0529\n    beta2 = 0.3334\n    eps_c[low_density_mask] = gamma / (1.0 + beta1 * np.sqrt(rs_low) + beta2 * rs_low)\n\n    # 4. Total xc energy density per unit length, e_xc = n * (eps_x + eps_c)\n    # Multiplying by the original n ensures that e_xc is 0 where n is 0.\n    exc_density_per_length = n * (eps_x + eps_c)\n\n    # 5. Integrate using Riemann sum: E_xc = sum(e_xc * delta_x)\n    total_exc_energy = np.sum(exc_density_per_length) * delta_x\n\n    return total_exc_energy\n\ndef gaussian_density(x, A, x0, sigma):\n    \"\"\"Generates a Gaussian density profile.\"\"\"\n    return A * np.exp(-(x - x0)**2 / (2.0 * sigma**2))\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases and prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1: Overlapping Gaussians\n        {'L': 20.0, 'N': 4001,\n         'nA': {'type': 'gaussian', 'params': {'A': 0.05, 'x0': 8.0, 'sigma': 0.8}},\n         'nB': {'type': 'gaussian', 'params': {'A': 0.04, 'x0': 12.0, 'sigma': 0.8}}},\n        # Case 2: Well-separated Gaussians\n        {'L': 20.0, 'N': 4001,\n         'nA': {'type': 'gaussian', 'params': {'A': 0.05, 'x0': 4.0, 'sigma': 0.5}},\n         'nB': {'type': 'gaussian', 'params': {'A': 0.05, 'x0': 16.0, 'sigma': 0.5}}},\n        # Case 3: Subsystem A absent\n        {'L': 20.0, 'N': 4001,\n         'nA': {'type': 'zero'},\n         'nB': {'type': 'gaussian', 'params': {'A': 0.06, 'x0': 10.0, 'sigma': 1.0}}},\n        # Case 4: Uniform densities\n        {'L': 20.0, 'N': 4001,\n         'nA': {'type': 'uniform', 'params': {'A': 0.03}},\n         'nB': {'type': 'uniform', 'params': {'A': 0.02}}},\n    ]\n\n    results = []\n    for case in test_cases:\n        L = case['L']\n        N = case['N']\n        delta_x = L / (N - 1)\n        x_grid = np.linspace(0, L, N)\n\n        # Generate density nA\n        if case['nA']['type'] == 'gaussian':\n            p = case['nA']['params']\n            nA = gaussian_density(x_grid, p['A'], p['x0'], p['sigma'])\n        elif case['nA']['type'] == 'uniform':\n            p = case['nA']['params']\n            nA = np.full(N, p['A'])\n        else: # type == 'zero'\n            nA = np.zeros(N)\n\n        # Generate density nB\n        if case['nB']['type'] == 'gaussian':\n            p = case['nB']['params']\n            nB = gaussian_density(x_grid, p['A'], p['x0'], p['sigma'])\n        elif case['nB']['type'] == 'uniform':\n            p = case['nB']['params']\n            nB = np.full(N, p['A'])\n\n        # Total density\n        n_total = nA + nB\n\n        # Calculate exchange-correlation energies\n        Exc_A = calculate_exc_lda(nA, delta_x)\n        Exc_B = calculate_exc_lda(nB, delta_x)\n        Exc_total = calculate_exc_lda(n_total, delta_x)\n\n        # Calculate non-additive energy\n        Exc_nad = Exc_total - Exc_A - Exc_B\n        results.append(Exc_nad)\n\n    # Format the final output as specified\n    output_str = f\"[{','.join([f'{r:.8f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}