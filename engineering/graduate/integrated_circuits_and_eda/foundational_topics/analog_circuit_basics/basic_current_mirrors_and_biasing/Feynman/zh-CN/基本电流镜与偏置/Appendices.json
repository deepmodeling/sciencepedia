{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个实践练习将带您扮演电路设计师的角色，完成一项基本但至关重要的任务：根据给定的电流比要求，确定晶体管的尺寸。这个练习旨在将理想电流镜的理论（电流比等于几何尺寸之比）与实际电路的物理约束联系起来。通过计算所需的宽度长度比（$W/L$）并验证晶体管是否保持在饱和区工作，您将掌握从设计规格到物理实现的核心技能 。",
            "id": "4257613",
            "problem": "一位工程师正在集成电路和电子设计自动化 (EDA) 的背景下设计一个金属氧化物半导体场效应晶体管 (MOSFET) 电流镜。该电流镜使用了两个长沟道 n 沟道 MOSFET，分别表示为 $M_1$（二极管连接的参考管）和 $M_2$（输出管），采用互补金属氧化物半导体 (CMOS) 工艺制造。参考支路向 $M_1$ 提供恒定电流 $I_{REF}$，而 $M_2$ 的输出支路必须将名义上为 $10:1$ 的参考电流镜像提供给输出节点上的负载。\n\n给定以下工艺和设计参数：电子迁移率-氧化层电容乘积 $\\mu_n C_{ox} = 250\\ \\mu\\mathrm{A}/\\mathrm{V}^2$，阈值电压 $V_{TH} = 0.45\\ \\mathrm{V}$，沟道长度调制参数 $\\lambda = 0.06\\ \\mathrm{V}^{-1}$，电源电压 $V_{DD} = 1.2\\ \\mathrm{V}$。$M_1$ 的几何尺寸是固定的，其宽度 $W_1 = 1.0\\ \\mu\\mathrm{m}$，长度 $L_1 = 0.18\\ \\mu\\mathrm{m}$，参考电流为 $I_{REF} = 20\\ \\mu\\mathrm{A}$。输出晶体管 $M_2$ 使用与 $M_1$ 相同的沟道长度，即 $L_2 = 0.18\\ \\mu\\mathrm{m}$。负载所要求的最小输出电压为 $V_{OUT,\\min} = 0.30\\ \\mathrm{V}$。假设源极和体电极都接地（$0\\ \\mathrm{V}$），因此体效应可以忽略不计。\n\n从长沟道 MOSFET 在饱和区工作的第一性原理出发，并在尺寸设计步骤中忽略沟道长度调制效应，设计者希望选择 $M_2$ 的几何尺寸，以在两个晶体管共享由二极管连接的 $M_1$ 所设定的相同栅源电压时，实现名义上 $I_{OUT}/I_{REF} = 10$ 的电流比。然后，使用所获得的工作点，验证在 $\\lambda$ 不为零的情况下，两个晶体管都满足饱和条件，并且输出顺从电压约束也得到满足。您可以将平方律行为视为饱和区的基本器件模型。\n\n计算在上述尺寸设计假设下，为满足 $10:1$ 镜像目标，$M_2$ 所需的 $W_2/L_2$ 比值。将您的最终答案表示为一个无量纲数，并四舍五入到四位有效数字。最终的方框答案中不应包含单位。",
            "solution": "长沟道 MOSFET 在饱和区工作的基本依据是漏极电流满足\n$$\nI_{D} = \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W}{L}\\,(V_{GS}-V_{TH})^{2}\\,(1+\\lambda V_{DS}),\n$$\n在没有沟道长度调制的情况下，其行为遵循平方律。在尺寸设计时，我们忽略沟道长度调制，这相当于取\n$$\nI_{D} \\approx \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W}{L}\\,(V_{GS}-V_{TH})^{2}.\n$$\n将过驱动电压定义为 $V_{OV} \\equiv V_{GS}-V_{TH}$。在一个 $M_1$ 为二极管连接的电流镜中，栅源电压 $V_{GS}$ 由 $M_1$ 在电流 $I_{REF}$ 下设定，并且 $M_2$ 共享相同的栅极电压和源极节点，因此在尺寸设计时 $M_2$ 以相同的 $V_{OV}$ 工作。\n\n首先，使用给定的 $I_{REF}$ 和 $M_1$ 的几何尺寸来确定 $V_{OV}$。$M_1$ 的几何比率为\n$$\n\\frac{W_1}{L_1} = \\frac{1.0\\ \\mu\\mathrm{m}}{0.18\\ \\mu\\mathrm{m}} = \\frac{1.0}{0.18} \\approx 5.555\\ldots\n$$\n使用 $M_1$ 的平方律饱和表达式，\n$$\nI_{REF} = \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W_1}{L_1}\\,V_{OV}^{2},\n$$\n所以\n$$\nV_{OV}^{2} = \\frac{2\\,I_{REF}}{\\mu_n C_{ox}\\,(W_1/L_1)}.\n$$\n代入 $I_{REF} = 20\\ \\mu\\mathrm{A}$ 和 $\\mu_n C_{ox} = 250\\ \\mu\\mathrm{A}/\\mathrm{V}^2$：\n$$\n\\mu_n C_{ox}\\,\\frac{W_1}{L_1} = \\left(250\\ \\mu\\mathrm{A}/\\mathrm{V}^2\\right)\\times 5.555\\ldots \\approx 1388.888\\ldots\\ \\mu\\mathrm{A}/\\mathrm{V}^2,\n$$\n因此\n$$\nV_{OV}^{2} = \\frac{2\\times 20\\ \\mu\\mathrm{A}}{1388.888\\ldots\\ \\mu\\mathrm{A}/\\mathrm{V}^2} = \\frac{40}{1388.888\\ldots}\\ \\mathrm{V}^2 \\approx 0.0288\\ \\mathrm{V}^2,\n$$\n所以\n$$\nV_{OV} \\approx \\sqrt{0.0288}\\ \\mathrm{V} \\approx 0.1697056\\ \\mathrm{V}.\n$$\n因此 $M_1$ 的栅源电压为\n$$\nV_{GS1} = V_{TH} + V_{OV} \\approx 0.45\\ \\mathrm{V} + 0.1697056\\ \\mathrm{V} \\approx 0.6197056\\ \\mathrm{V}.\n$$\n\n接下来，在尺寸设计时使用相同的 $V_{OV}$ 选择 $W_2/L_2$ 以产生 $I_{OUT} = 10\\,I_{REF} = 200\\ \\mu\\mathrm{A}$：\n$$\nI_{OUT} = \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W_2}{L_2}\\,V_{OV}^{2},\n$$\n所以\n$$\n\\frac{W_2}{L_2} = \\frac{2\\,I_{OUT}}{\\mu_n C_{ox}\\,V_{OV}^{2}}.\n$$\n代入 $I_{OUT} = 200\\ \\mu\\mathrm{A}$，$\\mu_n C_{ox} = 250\\ \\mu\\mathrm{A}/\\mathrm{V}^2$ 和 $V_{OV}^{2} \\approx 0.0288\\ \\mathrm{V}^2$，\n$$\n\\frac{W_2}{L_2} = \\frac{2\\times 200\\ \\mu\\mathrm{A}}{250\\ \\mu\\mathrm{A}/\\mathrm{V}^2 \\times 0.0288\\ \\mathrm{V}^2} = \\frac{400}{7.2} \\approx 55.555\\ldots\n$$\n这正好是 $\\frac{W_1}{L_1}$ 的 $10$ 倍，正如具有相等过驱动电压的理想电流镜所预期的那样。\n\n现在验证当 $\\lambda \\neq 0$ 时的饱和和顺从电压约束。\n\n对于 $M_1$（二极管连接），$V_{DS1} = V_{GS1} \\approx 0.6197056\\ \\mathrm{V}$。饱和条件要求 $V_{DS1} \\ge V_{OV}$。我们有\n$$\nV_{DS1} - V_{OV} \\approx 0.6197056\\ \\mathrm{V} - 0.1697056\\ \\mathrm{V} \\approx 0.450\\ \\mathrm{V} > 0,\n$$\n所以 $M_1$ 保持在饱和区。考虑沟道长度调制，电流变为\n$$\nI_{REF,\\lambda} \\approx \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W_1}{L_1}\\,V_{OV}^{2}\\,(1+\\lambda V_{DS1}),\n$$\n但这不影响饱和条件本身。\n\n对于 $M_2$，饱和条件要求 $V_{DS2} \\ge V_{OV}$。给定的最小输出电压为 $V_{OUT,\\min} = 0.30\\ \\mathrm{V}$。因此，\n$$\nV_{OUT,\\min} - V_{OV} \\approx 0.30\\ \\mathrm{V} - 0.1697056\\ \\mathrm{V} \\approx 0.1302944\\ \\mathrm{V} > 0,\n$$\n所以 $M_2$ 在最坏情况下的输出电压下也保持在饱和区。\n\n最后，评估 $\\lambda$ 对镜像比的影响，以确保顺从电压的考虑是现实的。考虑沟道长度调制后的比值变为\n$$\n\\frac{I_{OUT}}{I_{REF}} \\approx \\left(\\frac{W_2/L_2}{W_1/L_1}\\right)\\,\\frac{1+\\lambda V_{DS2}}{1+\\lambda V_{DS1}}.\n$$\n使用 $\\frac{W_2/L_2}{W_1/L_1} = 10$，$V_{DS2} \\approx V_{OUT,\\min} = 0.30\\ \\mathrm{V}$，$V_{DS1} \\approx V_{GS1} \\approx 0.6197056\\ \\mathrm{V}$ 和 $\\lambda = 0.06\\ \\mathrm{V}^{-1}$，\n$$\n\\frac{I_{OUT}}{I_{REF}} \\approx 10\\,\\frac{1+0.06\\times 0.30}{1+0.06\\times 0.6197056} = 10\\,\\frac{1+0.018}{1+0.037182336} \\approx 10\\,\\frac{1.018}{1.037182336} \\approx 9.815\n$$\n这表明由于 $M_1$ 和 $M_2$ 之间不同的 $V_{DS}$ 值，存在一个中等的比率误差，但两个器件仍然满足饱和和输出顺从电压条件。在平方律假设下，尺寸设计目标仍然得到满足，并且顺从电压裕量是足够的。\n\n因此，所需的比值 $W_2/L_2$ 约为 $55.555\\ldots$。按要求四舍五入到四位有效数字，答案是 $55.56$。",
            "answer": "$$\\boxed{55.56}$$"
        },
        {
            "introduction": "在完成初步的尺寸设计后，下一步是全面表征电流镜的性能，特别是其工作范围的限制。这个练习将引导您从静态的单点计算转向对电路输出特性的动态分析。通过编程实现对输出电压的直流扫描（DC sweep），我们可以精确地确定如“顺从电压”（compliance voltage）等关键性能指标，这模拟了工程师在电子设计自动化（EDA）工具中的标准工作流程 。",
            "id": "4257545",
            "problem": "考虑一个双晶体管金属氧化物半导体场效应晶体管 (MOSFET) 直流 (DC) 电流镜，它在集成电路和电子设计自动化 (EDA) 中用作基本偏置模块。两个晶体管均为n沟道类型，其源极接地，参考支路采用二极管连接方式，输出支路在输出漏极电压 $V_{\\mathrm{out}}$ 下驱动一个负载。二极管连接的晶体管由外部提供的参考电流 $I_{\\mathrm{ref}}$ 驱动，使得栅源电压 $V_{\\mathrm{GS}}$ 由参考器件的直流工作点确定。\n\n使用长沟道MOSFET模型作为基本基础，其参数包括跨导因子 $k = \\mu_n C_{\\mathrm{ox}} \\frac{W}{L}$、阈值电压 $V_{\\mathrm{TH}}$ 和沟道长度调制参数 $\\lambda$。用作基本定律的器件方程如下：\n- 饱和区 ($V_{\\mathrm{DS}} \\geq V_{\\mathrm{GS}} - V_{\\mathrm{TH}}$): \n$$I_{\\mathrm{D,sat}}(V_{\\mathrm{GS}},V_{\\mathrm{DS}}) = \\frac{1}{2} k \\left(V_{\\mathrm{GS}} - V_{\\mathrm{TH}}\\right)^2 \\left(1 + \\lambda V_{\\mathrm{DS}}\\right).$$\n- 三极管区 ($V_{\\mathrm{DS}}  V_{\\mathrm{GS}} - V_{\\mathrm{TH}}$):\n$$I_{\\mathrm{D,tri}}(V_{\\mathrm{GS}},V_{\\mathrm{DS}}) = k \\left[\\left(V_{\\mathrm{GS}} - V_{\\mathrm{TH}}\\right) V_{\\mathrm{DS}} - \\frac{1}{2} V_{\\mathrm{DS}}^2\\right].$$\n\n给定 $I_{\\mathrm{ref}}$，二极管连接的参考晶体管满足以下直流工作点方程：\n$$I_{\\mathrm{ref}} = \\frac{1}{2} k \\left(V_{\\mathrm{GS}} - V_{\\mathrm{TH}}\\right)^2 \\left(1 + \\lambda V_{\\mathrm{GS}}\\right),$$\n必须从此方程中确定栅源电压 $V_{\\mathrm{GS}}$。定义过驱动电压 $V_{\\mathrm{OV}} = V_{\\mathrm{GS}} - V_{\\mathrm{TH}}$。输出晶体管的漏极电压为外部设定的 $V_{\\mathrm{out}}$，即 $V_{\\mathrm{DS,out}} = V_{\\mathrm{out}}$，并与参考器件共享相同的 $V_{\\mathrm{GS}}$。\n\n在此，顺从电压通过在 $V_{\\mathrm{out}} \\in [0, V_{\\mathrm{DD}}]$ 范围内以均匀步长 $\\Delta V$ 进行扫描，并根据以下算法准则进行直流工作点检查来定义：它是使输出电流 $I_{\\mathrm{out}}(V_{\\mathrm{out}})$ 满足下式的最小 $V_{\\mathrm{out}}$ 值\n$$\\frac{\\left|I_{\\mathrm{out}}(V_{\\mathrm{out}}) - I_{\\mathrm{ref}}\\right|}{I_{\\mathrm{ref}}} \\leq \\epsilon,$$\n其中，$I_{\\mathrm{out}}(V_{\\mathrm{out}})$ 在 $V_{\\mathrm{out}} \\geq V_{\\mathrm{OV}}$ 时使用饱和区方程计算，在 $V_{\\mathrm{out}}  V_{\\mathrm{OV}}$ 时使用三极管区方程计算。如果扫描范围内的值均不满足该准则，则报告顺从电压为 $-1.0$。\n\n此外，计算：\n- 输出端进入三极管区工作的起始电压，定义为 $V_{\\mathrm{onset}} = V_{\\mathrm{OV}}$。\n- 起始点对应的电流下降，定义为使用 $V_{\\mathrm{out}} = V_{\\mathrm{OV}}$ 时的三极管区电流计算的分数亏损：\n$$D_{\\mathrm{onset}} = \\frac{I_{\\mathrm{ref}} - I_{\\mathrm{D,tri}}(V_{\\mathrm{GS}}, V_{\\mathrm{OV}})}{I_{\\mathrm{ref}}},$$\n以小数形式表示（无单位）。\n- 在整个扫描范围 $V_{\\mathrm{out}} \\in [0,V_{\\mathrm{DD}}]$ 内的最大下降，定义为\n$$D_{\\max} = \\max_{V_{\\mathrm{out}} \\in [0,V_{\\mathrm{DD}}]} \\max\\left(0, \\frac{I_{\\mathrm{ref}} - I_{\\mathrm{out}}(V_{\\mathrm{out}})}{I_{\\mathrm{ref}}}\\right),$$\n以小数形式表示（无单位）。\n\n您的任务是实现一个程序，对每个提供的测试用例执行以下步骤：\n1. 求解满足二极管连接参考方程的 $V_{\\mathrm{GS}}$，给定 $I_{\\mathrm{ref}}$、$k$、$V_{\\mathrm{TH}}$ 和 $\\lambda$，且源极接地。\n2. 计算 $V_{\\mathrm{OV}}$ 并设置 $V_{\\mathrm{onset}} = V_{\\mathrm{OV}}$。\n3. 以 $\\Delta V$ 为步长，从 $0$ 到 $V_{\\mathrm{DD}}$ 扫描 $V_{\\mathrm{out}}$，使用相应区域的方程评估 $I_{\\mathrm{out}}(V_{\\mathrm{out}})$，根据上述准则找到顺从电压，并计算 $D_{\\mathrm{onset}}$ 和 $D_{\\max}$。\n\n顺从电压和起始电压以伏特表示，并将每个值四舍五入到六位小数。下降值以小数表示，四舍五入到六位小数。不涉及角度。如果在给定扫描范围内未找到顺从电压，则该值输出为 $-1.0$。\n\n测试套件参数集以元组 $(k, V_{\\mathrm{TH}}, \\lambda, I_{\\mathrm{ref}}, V_{\\mathrm{DD}}, \\epsilon, \\Delta V)$ 的形式给出，每个参数均使用国际单位制 (SI)：\n- 情况 1（一般情况）： $(5\\times 10^{-3}\\,\\mathrm{A}/\\mathrm{V}^2,\\; 0.5\\,\\mathrm{V},\\; 0.05\\,\\mathrm{V}^{-1},\\; 100\\times 10^{-6}\\,\\mathrm{A},\\; 1.8\\,\\mathrm{V},\\; 0.01,\\; 1\\times 10^{-3}\\,\\mathrm{V})$。\n- 情况 2（小过驱动边界）： $(5\\times 10^{-3}\\,\\mathrm{A}/\\mathrm{V}^2,\\; 0.5\\,\\mathrm{V},\\; 0.05\\,\\mathrm{V}^{-1},\\; 10\\times 10^{-6}\\,\\mathrm{A},\\; 1.8\\,\\mathrm{V},\\; 0.01,\\; 1\\times 10^{-3}\\,\\mathrm{V})$。\n- 情况 3（强沟道长度调制）： $(5\\times 10^{-3}\\,\\mathrm{A}/\\mathrm{V}^2,\\; 0.5\\,\\mathrm{V},\\; 0.2\\,\\mathrm{V}^{-1},\\; 50\\times 10^{-6}\\,\\mathrm{A},\\; 1.0\\,\\mathrm{V},\\; 0.02,\\; 1\\times 10^{-3}\\,\\mathrm{V})$。\n- 情况 4（因电源受限导致扫描范围内无顺从电压）： $(5\\times 10^{-3}\\,\\mathrm{A}/\\mathrm{V}^2,\\; 0.5\\,\\mathrm{V},\\; 0.05\\,\\mathrm{V}^{-1},\\; 200\\times 10^{-6}\\,\\mathrm{A},\\; 0.25\\,\\mathrm{V},\\; 0.01,\\; 1\\times 10^{-3}\\,\\mathrm{V})$。\n\n您的程序应生成单行输出，其中包含结果，格式为逗号分隔的列表的列表，每个内部列表按相应测试用例的 $[V_{\\mathrm{comp}}, V_{\\mathrm{onset}}, D_{\\mathrm{onset}}, D_{\\max}]$ 顺序排列，数值按指定要求四舍五入。最终输出格式必须严格如下：\n$$[ [v_{1,\\mathrm{comp}}, v_{1,\\mathrm{onset}}, d_{1,\\mathrm{onset}}, d_{1,\\max}], [v_{2,\\mathrm{comp}}, v_{2,\\mathrm{onset}}, d_{2,\\mathrm{onset}}, d_{2,\\max}], [v_{3,\\mathrm{comp}}, v_{3,\\mathrm{onset}}, d_{3,\\mathrm{onset}}, d_{3,\\max}], [v_{4,\\mathrm{comp}}, v_{4,\\mathrm{onset}}, d_{4,\\mathrm{onset}}, d_{4,\\max}] ].$$",
            "solution": "问题陈述已经过评估并被认为是有效的。它以已建立的长沟道MOSFET模型为科学基础，问题提法适定，定义和约束清晰，并以客观、正式的方式呈现，没有歧义或矛盾。所有必要的参数和方程均已提供，使得问题是自洽且可解的。\n\n任务是分析一个基本的金属氧化物半导体场效应晶体管 (MOSFET) 电流镜。我们获得了器件物理模型和四个不同测试用例的一组参数。对于每个用例，我们必须计算顺从电压 ($V_{\\mathrm{comp}}$)、三极管区工作起始电压 ($V_{\\mathrm{onset}}$)、该起始点处的电流下降 ($D_{\\mathrm{onset}}$) 和最大电流下降 ($D_{\\max}$)。\n\n分析按以下步骤进行：\n\n1.  **确定栅源电压 ($V_{\\mathrm{GS}}$)**\n\n参考晶体管 $M_1$ 是二极管连接的，意味着其漏极和栅极连接在一起，因此 $V_{\\mathrm{DS,1}} = V_{\\mathrm{GS}}$。由于阈值电压 $V_{\\mathrm{TH}}$ 为正，这确保了 $V_{\\mathrm{DS,1}} > V_{\\mathrm{GS}} - V_{\\mathrm{TH}}$，因此 $M_1$ 工作在饱和区。问题提供了参考电流 $I_{\\mathrm{ref}}$ 的控制方程：\n$$I_{\\mathrm{ref}} = \\frac{1}{2} k \\left(V_{\\mathrm{GS}} - V_{\\mathrm{TH}}\\right)^2 \\left(1 + \\lambda V_{\\mathrm{GS}}\\right)$$\n为了求解 $V_{\\mathrm{GS}}$，方便地定义过驱动电压 $V_{\\mathrm{OV}} = V_{\\mathrm{GS}} - V_{\\mathrm{TH}}$，这意味着 $V_{\\mathrm{GS}} = V_{\\mathrm{OV}} + V_{\\mathrm{TH}}$。将此代入方程可得：\n$$I_{\\mathrm{ref}} = \\frac{1}{2} k V_{\\mathrm{OV}}^2 \\left(1 + \\lambda (V_{\\mathrm{OV}} + V_{\\mathrm{TH}})\\right)$$\n重新整理后得到一个关于 $V_{\\mathrm{OV}}$ 的三次多项式方程：\n$$ \\frac{2 I_{\\mathrm{ref}}}{k} = V_{\\mathrm{OV}}^2 \\left(1 + \\lambda V_{\\mathrm{TH}} + \\lambda V_{\\mathrm{OV}}\\right) $$\n$$ \\lambda V_{\\mathrm{OV}}^3 + (1 + \\lambda V_{\\mathrm{TH}}) V_{\\mathrm{OV}}^2 - \\frac{2 I_{\\mathrm{ref}}}{k} = 0 $$\n该方程必须求解 $V_{\\mathrm{OV}}$。对于n沟道MOSFET，一个物理上有意义的解要求 $V_{\\mathrm{OV}} > 0$。设 $f(V_{\\mathrm{OV}}) = \\lambda V_{\\mathrm{OV}}^3 + (1 + \\lambda V_{\\mathrm{TH}}) V_{\\mathrm{OV}}^2 - \\frac{2 I_{\\mathrm{ref}}}{k}$。由于 $f(0)  0$ 且当 $V_{\\mathrm{OV}} > 0$ 时函数是严格递增的，因此存在一个唯一的正实根。该根将通过数值方法找到。\n\n2.  **计算起始电压 ($V_{\\mathrm{onset}}$) 和起始下降 ($D_{\\mathrm{onset}}$)**\n\n输出晶体管进入三极管区工作的起始点发生在其漏源电压 $V_{\\mathrm{DS,out}}$ 等于过驱动电压时。问题将起始电压定义为 $V_{\\mathrm{onset}} = V_{\\mathrm{OV}}$。\n\n起始下降 $D_{\\mathrm{onset}}$ 是当输出晶体管工作在饱和区和三极管区的边界，即 $V_{\\mathrm{out}} = V_{\\mathrm{OV}}$ 时的分数电流亏损。问题指定使用三极管区方程进行此计算：\n$$D_{\\mathrm{onset}} = \\frac{I_{\\mathrm{ref}} - I_{\\mathrm{D,tri}}(V_{\\mathrm{GS}}, V_{\\mathrm{OV}})}{I_{\\mathrm{ref}}}$$\n在 $V_{\\mathrm{DS}} = V_{\\mathrm{OV}}$ 时的三极管区电流为：\n$$I_{\\mathrm{D,tri}}(V_{\\mathrm{GS}}, V_{\\mathrm{OV}}) = k \\left[ (V_{\\mathrm{GS}} - V_{\\mathrm{TH}})V_{\\mathrm{OV}} - \\frac{1}{2} V_{\\mathrm{OV}}^2 \\right] = k \\left[ V_{\\mathrm{OV}}^2 - \\frac{1}{2} V_{\\mathrm{OV}}^2 \\right] = \\frac{1}{2} k V_{\\mathrm{OV}}^2$$\n将此式以及 $I_{\\mathrm{ref}}$ 的表达式代入下降方程：\n$$D_{\\mathrm{onset}} = \\frac{\\frac{1}{2} k V_{\\mathrm{OV}}^2 (1 + \\lambda V_{\\mathrm{GS}}) - \\frac{1}{2} k V_{\\mathrm{OV}}^2}{\\frac{1}{2} k V_{\\mathrm{OV}}^2 (1 + \\lambda V_{\\mathrm{GS}})} = \\frac{\\lambda V_{\\mathrm{GS}}}{1 + \\lambda V_{\\mathrm{GS}}}$$\n\n3.  **确定顺从电压 ($V_{\\mathrm{comp}}$)**\n\n顺从电压通过以 $\\Delta V$ 为步长从 $0$ 到 $V_{\\mathrm{DD}}$ 扫描输出电压 $V_{\\mathrm{out}}$，并找到满足以下条件的最小 $V_{\\mathrm{out}}$ 来确定：\n$$\\frac{\\left|I_{\\mathrm{out}}(V_{\\mathrm{out}}) - I_{\\mathrm{ref}}\\right|}{I_{\\mathrm{ref}}} \\leq \\epsilon$$\n输出电流 $I_{\\mathrm{out}}$ 取决于输出晶体管的工作区域，该区域通过比较 $V_{\\mathrm{out}}$ 和 $V_{\\mathrm{OV}}$ 来确定：\n- 如果 $V_{\\mathrm{out}}  V_{\\mathrm{OV}}$ (三极管区):\n$$I_{\\mathrm{out}} = I_{\\mathrm{D,tri}}(V_{\\mathrm{GS}}, V_{\\mathrm{out}}) = k \\left[V_{\\mathrm{OV}} V_{\\mathrm{out}} - \\frac{1}{2} V_{\\mathrm{out}}^2\\right]$$\n- 如果 $V_{\\mathrm{out}} \\geq V_{\\mathrm{OV}}$ (饱和区):\n$$I_{\\mathrm{out}} = I_{\\mathrm{D,sat}}(V_{\\mathrm{GS}}, V_{\\mathrm{out}}) = \\frac{1}{2} k V_{\\mathrm{OV}}^2 \\left(1 + \\lambda V_{\\mathrm{out}}\\right)$$\n程序化的方法是遍历 $V_{\\mathrm{out}}$ 的扫描值，计算 $I_{\\mathrm{out}}$，检查顺从条件，并报告第一个满足条件的 $V_{\\mathrm{out}}$ 值。如果在扫描范围内未找到这样的值，则报告 $V_{\\mathrm{comp}}$ 为 $-1.0$。\n\n4.  **计算最大下降 ($D_{\\max}$)**\n\n最大下降定义为：\n$$D_{\\max} = \\max_{V_{\\mathrm{out}} \\in [0,V_{\\mathrm{DD}}]} \\max\\left(0, \\frac{I_{\\mathrm{ref}} - I_{\\mathrm{out}}(V_{\\mathrm{out}})}{I_{\\mathrm{ref}}}\\right)$$\n为使该量最大化，我们必须找到在 $[0, V_{\\mathrm{DD}}]$ 范围内 $I_{\\mathrm{out}}(V_{\\mathrm{out}})$ 的最小值。函数 $I_{\\mathrm{out}}(V_{\\mathrm{out}})$ 由两部分组成：\n- 对于 $V_{\\mathrm{out}} \\in [0, V_{\\mathrm{OV}})$，$I_{\\mathrm{out}}$ 是一个二次函数，从 $I_{\\mathrm{out}}(0) = 0$ 开始并递增。\n- 对于 $V_{\\mathrm{out}} \\in [V_{\\mathrm{OV}}, V_{\\mathrm{DD}}]$，$I_{\\mathrm{out}}$ 是一个线性递增函数。\n因此，$I_{\\mathrm{out}}(V_{\\mathrm{out}})$ 在非负范围 $[0, V_{\\mathrm{DD}}]$ 内的全局最小值出现在 $V_{\\mathrm{out}} = 0$ 处，此时 $I_{\\mathrm{out}}(0) = 0$。\n此时，下降值为：\n$$\\frac{I_{\\mathrm{ref}} - I_{\\mathrm{out}}(0)}{I_{\\mathrm{ref}}} = \\frac{I_{\\mathrm{ref}} - 0}{I_{\\mathrm{ref}}} = 1$$\n由于 $I_{\\mathrm{out}}$ 永远不为负，这个为 1 的下降值是可能的最大值。因此，对于所有测试用例，$D_{\\max} = 1.0$。\n\n现在的实现将遵循这个基于原则的程序。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the MOSFET current mirror problem for a given set of test cases.\n    \"\"\"\n    # Test suite parameter sets: (k, V_TH, lambda, I_ref, V_DD, epsilon, delta_V)\n    # Units are SI: A/V^2, V, V^-1, A, V, unitless, V\n    test_cases = [\n        (5e-3, 0.5, 0.05, 100e-6, 1.8, 0.01, 1e-3),\n        (5e-3, 0.5, 0.05, 10e-6, 1.8, 0.01, 1e-3),\n        (5e-3, 0.5, 0.2, 50e-6, 1.0, 0.02, 1e-3),\n        (5e-3, 0.5, 0.05, 200e-6, 0.25, 0.01, 1e-3),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        k, V_TH, lam, I_ref, V_DD, epsilon, delta_V = case\n\n        # 1. Solve for V_OV\n        # The equation is: lam * V_OV^3 + (1 + lam * V_TH) * V_OV^2 - (2 * I_ref / k) = 0\n        coeffs = [lam, 1 + lam * V_TH, 0, -2 * I_ref / k]\n        roots = np.roots(coeffs)\n\n        # Find the single positive real root for V_OV\n        V_OV = -1.0\n        for root in roots:\n            if np.isreal(root) and root.real > 0:\n                V_OV = root.real\n                break\n        \n        # In case of floating point inaccuracies in np.isreal\n        if V_OV == -1.0:\n            for root in roots:\n                if abs(root.imag)  1e-9 and root.real > 0:\n                    V_OV = root.real\n                    break\n\n        V_GS = V_OV + V_TH\n\n        # 2. Compute V_onset and D_onset\n        V_onset = V_OV\n        \n        # D_onset = (lam * V_GS) / (1 + lam * V_GS)\n        I_D_tri_onset = 0.5 * k * V_OV**2\n        D_onset = (I_ref - I_D_tri_onset) / I_ref\n\n        # 3. Sweep V_out to find V_comp and D_max\n        V_comp = -1.0\n        found_V_comp = False\n        \n        # D_max is theoretically 1.0 as the minimum current is 0 at V_out=0.\n        # We calculate it via sweep to be rigorous as per problem statement format.\n        D_max = 0.0\n\n        # Create the sweep range for V_out\n        # Add a small amount to V_DD to ensure the endpoint is included in the sweep.\n        v_out_sweep = np.arange(0, V_DD + delta_V / 2, delta_V)\n\n        for V_out in v_out_sweep:\n            if V_out  V_OV:  # Triode region\n                I_out = k * (V_OV * V_out - 0.5 * V_out**2)\n            else:  # Saturation region\n                I_out = 0.5 * k * V_OV**2 * (1 + lam * V_out)\n\n            # Check for compliance voltage\n            if not found_V_comp:\n                if abs(I_out - I_ref) / I_ref = epsilon:\n                    V_comp = V_out\n                    found_V_comp = True\n            \n            # Update maximum droop\n            current_droop = (I_ref - I_out) / I_ref\n            if current_droop > D_max:\n                D_max = current_droop\n        \n        # According to the definition, droop cannot be negative for D_max calculation\n        # The maximum of max(0, droop) will be handled by the fact that min(I_out) is 0.\n\n        # Store rounded results for the current case\n        results.append([\n            round(V_comp, 6),\n            round(V_onset, 6),\n            round(D_onset, 6),\n            round(D_max if D_max > 0 else 0, 6) # Handles potential floating point noise\n        ])\n\n    # Format the final output string\n    output_str = \"[\"\n    for i, res in enumerate(results):\n        output_str += f\"[{','.join(map(str, res))}]\"\n        if i  len(results) - 1:\n            output_str += \", \"\n    output_str += \"]\"\n    \n    # The final print statement must match the problem's required format exactly.\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "最后一个动手实践将探讨一个更高级的主题，即应对真实世界中制造过程的可变性所带来的挑战。在现代集成电路中，没有任何两个晶体管是绝对相同的，这种微小的“失配”（mismatch）会对电路性能产生显著影响。本练习将向您介绍用于量化这种随机失配影响的统计学方法，包括 Pelgrom 定律和蒙特卡洛（Monte Carlo）仿真，并指导您如何设计出满足特定良率（yield）目标的稳健电路 。",
            "id": "4257603",
            "problem": "一个电子设计自动化（EDA）程序必须使用蒙特卡洛（MC）仿真和第一性原理建模，分析由器件失配引起的基本金属-氧化物-半导体场效应晶体管（MOSFET）电流镜的统计电流误差。假设器件为长沟道器件，在强反型区工作，并具有明确定义的过驱动电压。失配遵循 Pelgrom 定律。对于每个测试用例，该程序必须计算围绕理想镜像电流的三西格玛电流扩展，以及在双边相对误差容限下满足指定良率目标所需的最小面积比例因子。\n\n基本原理：\n- 长沟道 MOSFET 在强反型区的平方律电流：对于器件 $i$，其饱和区漏极电流为 $$I_i = \\frac{1}{2} \\beta_i (V_{\\mathrm{ov},i})^2,$$ 其中 $\\beta_i = k' \\frac{W_i}{L_i}$，$k'$ 是工艺跨导因子，$W_i$ 是器件宽度，$L_i$ 是器件长度，$V_{\\mathrm{ov},i} = V_{\\mathrm{GS},i} - V_{\\mathrm{TH},i}$ 是过驱动电压。沟道长度调制和其他二阶效应被忽略。\n- 在一个双晶体管电流镜中，参考晶体管采用二极管连接方式，建立一个栅源电压 $V_{\\mathrm{GS}}$，使得参考电流 $I_{\\mathrm{ref}}$ 流过。输出晶体管的栅源电压与参考晶体管相同（忽略互连线上的电压梯度），理想的电流比等于几何比例因子 $s = \\frac{W_2/L_2}{W_1/L_1}$，因此理想情况下 $I_{\\mathrm{out,ideal}} = s I_{\\mathrm{ref}}$。\n- 针对两个邻近器件的 Pelgrom 失配模型：\n  - 阈值电压失配被建模为一个零均值高斯随机变量 $\\Delta V_{\\mathrm{TH}}$，其标准差为 $$\\sigma_{\\Delta V_{\\mathrm{TH}}} = \\frac{A_{V_{\\mathrm{TH}}}}{\\sqrt{W_1 L_1}} \\sqrt{1 + \\frac{1}{s}},$$ 其中 $A_{V_{\\mathrm{TH}}}$ 是阈值电压的 Pelgrom 系数，单位为 $\\mathrm{V}\\cdot\\mu\\mathrm{m}$，并且当 $L_2 = L_1$ 和 $W_2 = s W_1$ 时，$s$ 说明了输出器件的缩放。\n  - 电流因子（迁移率-电容）相对失配由一个零均值高斯随机变量 $\\delta_\\beta$ 建模，其标准差为 $$\\sigma_{\\delta_\\beta} = \\frac{A_{\\beta}}{\\sqrt{W_1 L_1}} \\sqrt{1 + \\frac{1}{s}},$$ 其中 $A_{\\beta}$ 是相对 $\\beta$ 失配的 Pelgrom 系数，单位为 $\\mu\\mathrm{m}$。几何缩放因子 $s$ 不属于 $\\delta_\\beta$ 的一部分；它乘以标称比率 $\\beta_2/\\beta_1$。\n- 由于两个器件具有相同的 $V_{\\mathrm{GS}}$，即 $V_{\\mathrm{GS}} = V_{\\mathrm{TH},1} + V_{\\mathrm{ov},1}$，输出器件的过驱动电压为 $V_{\\mathrm{ov},2} = V_{\\mathrm{GS}} - V_{\\mathrm{TH},2} = V_{\\mathrm{ov},1} - \\Delta V_{\\mathrm{TH}}$，其中 $\\Delta V_{\\mathrm{TH}} = V_{\\mathrm{TH},2} - V_{\\mathrm{TH},1}$。输出电流变为 $$I_{\\mathrm{out}} = \\frac{1}{2}\\beta_2\\big(V_{\\mathrm{ov},1} - \\Delta V_{\\mathrm{TH}}\\big)^2 = s\\,I_{\\mathrm{ref}} \\cdot (1+\\delta_\\beta)\\left(1 - \\frac{\\Delta V_{\\mathrm{TH}}}{V_{\\mathrm{ov},1}}\\right)^2.$$\n- 相对电流误差（无量纲）定义为 $$\\varepsilon = \\frac{I_{\\mathrm{out}} - s I_{\\mathrm{ref}}}{s I_{\\mathrm{ref}}} = (1+\\delta_\\beta)\\left(1 - \\frac{\\Delta V_{\\mathrm{TH}}}{V_{\\mathrm{ov},1}}\\right)^2 - 1.$$\n\n任务：\n1. 对于每个测试用例，执行包含 $N$ 个样本的蒙特卡洛（MC）仿真，独立生成 $\\Delta V_{\\mathrm{TH}} \\sim \\mathcal{N}(0, \\sigma_{\\Delta V_{\\mathrm{TH}}}^2)$ 和 $\\delta_\\beta \\sim \\mathcal{N}(0, \\sigma_{\\delta_\\beta}^2)$，计算给定 $s$ 时的输出电流 $I_{\\mathrm{out}}$，并计算围绕理想电流的三西格玛电流扩展 $$\\Delta I_{3\\sigma} = 3 \\cdot \\mathrm{std}\\big(I_{\\mathrm{out}} - s I_{\\mathrm{ref}}\\big),$$ 以安培（Amperes）为单位表示。\n2. 使用 $\\varepsilon$ 在零失配点的一阶线性化，推导出一个关于标准差 $\\sigma_\\varepsilon(s)$ 的解析条件，以确保双边容限 $|\\varepsilon| \\le t$ 以至少为 $p$ 的概率（良率目标）得到满足。使用标准正态分布的逆累积分布函数。据此，计算为满足指定容限的良率目标所需的最小比例因子 $s_{\\min} \\ge 1$。如果不存在有限的 $s$ 能满足良率目标，则为 $s_{\\min}$ 输出 $-1.0$。\n\n仿真和单位：\n- MC 仿真使用 $N = 200000$ 个样本，并使用固定的随机种子 $123$ 以保证可复现性。\n- 所有电流必须以 $\\mathrm{A}$ 为单位。\n- 所有尺寸 $W$ 和 $L$ 必须以 $\\mu\\mathrm{m}$ 为单位。\n- $A_{V_{\\mathrm{TH}}}$ 必须以 $\\mathrm{V}\\cdot\\mu\\mathrm{m}$ 为单位。\n- $A_{\\beta}$ 必须以 $\\mu\\mathrm{m}$ 为单位。\n- 过驱动电压 $V_{\\mathrm{ov},1}$ 必须以 $\\mathrm{V}$ 为单位。\n- 容限 $t$ 是无量纲的（相对误差）。\n- 良率目标 $p$ 是一个在区间 $(0,1)$ 内的概率。\n\n测试套件：\n为以下四个参数集提供结果，以测试解决方案的不同方面。每个列表条目是一个元组，顺序为 $(I_{\\mathrm{ref}}, V_{\\mathrm{ov},1}, W_1, L_1, s, A_{V_{\\mathrm{TH}}}, A_{\\beta}, p, t)$。\n\n- 案例 1 (正常路径):\n  - $I_{\\mathrm{ref}} = 1.0\\times 10^{-5}\\,\\mathrm{A}$, $V_{\\mathrm{ov},1} = 0.2\\,\\mathrm{V}$, $W_1 = 10.0\\,\\mu\\mathrm{m}$, $L_1 = 0.18\\,\\mu\\mathrm{m}$, $s = 1.0$, $A_{V_{\\mathrm{TH}}} = 3.0\\times 10^{-3}\\,\\mathrm{V}\\cdot\\mu\\mathrm{m}$, $A_{\\beta} = 1.0\\times 10^{-2}\\,\\mu\\mathrm{m}$, $p = 0.99$, $t = 0.05$。\n- 案例 2 (小器件面积，宽松容限，高良率):\n  - $I_{\\mathrm{ref}} = 1.0\\times 10^{-4}\\,\\mathrm{A}$, $V_{\\mathrm{ov},1} = 0.25\\,\\mathrm{V}$, $W_1 = 0.8\\,\\mu\\mathrm{m}$, $L_1 = 0.18\\,\\mu\\mathrm{m}$, $s = 1.0$, $A_{V_{\\mathrm{TH}}} = 3.0\\times 10^{-3}\\,\\mathrm{V}\\cdot\\mu\\mathrm{m}$, $A_{\\beta} = 1.5\\times 10^{-2}\\,\\mu\\mathrm{m}$, $p = 0.9973$, $t = 0.10$。\n- 案例 3 (缩放电流镜，严苛的良率和容限):\n  - $I_{\\mathrm{ref}} = 5.0\\times 10^{-5}\\,\\mathrm{A}$, $V_{\\mathrm{ov},1} = 0.15\\,\\mathrm{V}$, $W_1 = 4.0\\,\\mu\\mathrm{m}$, $L_1 = 0.18\\,\\mu\\mathrm{m}$, $s = 4.0$, $A_{V_{\\mathrm{TH}}} = 2.5\\times 10^{-3}\\,\\mathrm{V}\\cdot\\mu\\mathrm{m}$, $A_{\\beta} = 1.0\\times 10^{-2}\\,\\mu\\mathrm{m}$, $p = 0.999$, $t = 0.03$。\n- 案例 4 (低过驱动电压，中等面积，困难的良率):\n  - $I_{\\mathrm{ref}} = 5.0\\times 10^{-6}\\,\\mathrm{A}$, $V_{\\mathrm{ov},1} = 0.06\\,\\mathrm{V}$, $W_1 = 20.0\\,\\mu\\mathrm{m}$, $L_1 = 0.18\\,\\mu\\mathrm{m}$, $s = 1.0$, $A_{V_{\\mathrm{TH}}} = 3.0\\times 10^{-3}\\,\\mathrm{V}\\cdot\\mu\\mathrm{m}$, $A_{\\beta} = 1.0\\times 10^{-2}\\,\\mu\\mathrm{m}$, $p = 0.95$, $t = 0.02$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。对于每个测试用例，按顺序输出两个值：三西格玛电流扩展 $\\Delta I_{3\\sigma}$（以 $\\mathrm{A}$ 为单位的浮点数）和最小比例因子 $s_{\\min}$（浮点数，如果不存在有限的 $s$ 能满足良率，则使用 $-1.0$）。因此，输出包含对应于 4 个测试用例的 8 个数字，例如 $[\\Delta I_{3\\sigma,1}, s_{\\min,1}, \\Delta I_{3\\sigma,2}, s_{\\min,2}, \\Delta I_{3\\sigma,3}, s_{\\min,3}, \\Delta I_{3\\sigma,4}, s_{\\min,4}]$。",
            "solution": "该问题要求分析一个基本 MOSFET 电流镜的性能，同时考虑两个晶体管之间的统计失配。分析包括两部分：首先，通过蒙特卡洛（MC）仿真确定输出电流的统计扩展；其次，通过解析推导找出满足指定良率目标所需的最小器件尺寸。\n\n提供的基本模型是用于饱和区 MOSFET 漏极电流的长沟道平方律模型，$I_i = \\frac{1}{2} \\beta_i (V_{\\mathrm{ov},i})^2$，其中 $\\beta_i = k' (W_i/L_i)$，以及用于阈值电压（$V_{\\mathrm{TH}}$）和电流因子（$\\beta$）的 Pelgrom 失配模型。输出电流 $I_{\\mathrm{out}}$ 受参考晶体管（器件 1）和输出晶体管（器件 2）之间失配的影响。鉴于两个晶体管共享相同的栅源电压 $V_{\\mathrm{GS}}$，输出电流表示为 $I_{\\mathrm{out}} = s I_{\\mathrm{ref}} (1+\\delta_\\beta)(1 - \\Delta V_{\\mathrm{TH}}/V_{\\mathrm{ov},1})^2$，其中 $s$ 是几何比例因子，$I_{\\mathrm{ref}}$ 是参考电流，$V_{\\mathrm{ov},1}$ 是参考器件的过驱动电压，$\\Delta V_{\\mathrm{TH}}$ 和 $\\delta_\\beta$ 分别是代表阈值电压和电流因子失配的零均值高斯随机变量。\n\n第一个任务是为给定的器件和操作参数集计算电流误差的三西格玛扩展，$\\Delta I_{3\\sigma} = 3 \\cdot \\mathrm{std}(I_{\\mathrm{out}} - s I_{\\mathrm{ref}})$。这通过蒙特卡洛仿真完成。\n失配变量的标准差 $\\sigma_{\\Delta V_{\\mathrm{TH}}}$ 和 $\\sigma_{\\delta_\\beta}$ 取决于 Pelgrom 系数（$A_{V_{\\mathrm{TH}}}$，$A_{\\beta}$）、参考器件的面积（$W_1 L_1$）以及比例因子（$s$），遵循给定的公式：\n$$ \\sigma_{\\Delta V_{\\mathrm{TH}}} = \\frac{A_{V_{\\mathrm{TH}}}}{\\sqrt{W_1 L_1}} \\sqrt{1 + \\frac{1}{s}} $$\n$$ \\sigma_{\\delta_\\beta} = \\frac{A_{\\beta}}{\\sqrt{W_1 L_1}} \\sqrt{1 + \\frac{1}{s}} $$\n对于每个测试用例，仿真过程如下：\n1.  使用给定的参数计算 $\\sigma_{\\Delta V_{\\mathrm{TH}}}$ 和 $\\sigma_{\\delta_\\beta}$ 的数值。\n2.  从分布 $\\mathcal{N}(0, \\sigma_{\\Delta V_{\\mathrm{TH}}}^2)$ 中为 $\\Delta V_{\\mathrm{TH}}$ 生成 $N=200000$ 个独立的随机样本，并从 $\\mathcal{N}(0, \\sigma_{\\delta_\\beta}^2)$ 中为 $\\delta_\\beta$ 生成随机样本。使用固定的随机种子 $123$ 以确保可复现性。\n3.  对于每对样本 $(\\Delta V_{\\mathrm{TH}}[i], \\delta_\\beta[i])$，计算相应的输出电流 $I_{\\mathrm{out}}[i]$。\n4.  计算理想输出电流 $I_{\\mathrm{out,ideal}} = s I_{\\mathrm{ref}}$。\n5.  计算电流误差数组 $\\Delta I[i] = I_{\\mathrm{out}}[i] - I_{\\mathrm{out,ideal}}$。\n6.  然后，三西格玛扩展计算为 $\\Delta I_{3\\sigma} = 3 \\cdot \\mathrm{std}(\\Delta I)$，其中 $\\mathrm{std}(\\cdot)$ 是电流误差数组的标准差。\n\n第二个任务是推导最小比例因子 $s_{\\min} \\ge 1$ 的解析表达式，该表达式要求相对电流误差 $\\varepsilon = (I_{\\mathrm{out}} - s I_{\\mathrm{ref}}) / (s I_{\\mathrm{ref}})$ 在 $\\pm t$ 的容限内，且概率（良率）至少为 $p$。这需要对 $\\varepsilon$ 的表达式相对于失配变量 $\\Delta V_{\\mathrm{TH}}$ 和 $\\delta_\\beta$ 进行一阶线性化。$\\varepsilon$ 在 $\\Delta V_{\\mathrm{TH}} = 0$ 和 $\\delta_\\beta = 0$ 点的泰勒级数展开为：\n$$ \\varepsilon(\\delta_\\beta, \\Delta V_{\\mathrm{TH}}) = \\varepsilon(0,0) + \\frac{\\partial \\varepsilon}{\\partial \\delta_\\beta}\\bigg|_{(0,0)} \\delta_\\beta + \\frac{\\partial \\varepsilon}{\\partial \\Delta V_{\\mathrm{TH}}}\\bigg|_{(0,0)} \\Delta V_{\\mathrm{TH}} + \\dots $$\n已知 $\\varepsilon = (1+\\delta_\\beta)(1 - \\Delta V_{\\mathrm{TH}}/V_{\\mathrm{ov},1})^2 - 1$，其偏导数分别为 $\\frac{\\partial \\varepsilon}{\\partial \\delta_\\beta} = (1 - \\Delta V_{\\mathrm{TH}}/V_{\\mathrm{ov},1})^2$ 和 $\\frac{\\partial \\varepsilon}{\\partial \\Delta V_{\\mathrm{TH}}} = (1+\\delta_\\beta) \\cdot 2(1 - \\Delta V_{\\mathrm{TH}}/V_{\\mathrm{ov},1})(-\\frac{1}{V_{\\mathrm{ov},1}})$。在 $(0,0)$ 点求值，得到的偏导数分别为 $1$ 和 $-2/V_{\\mathrm{ov},1}$。因此，线性化的误差为：\n$$ \\varepsilon_{\\mathrm{lin}} = \\delta_\\beta - \\frac{2}{V_{\\mathrm{ov},1}}\\Delta V_{\\mathrm{TH}} $$\n由于 $\\delta_\\beta$ 和 $\\Delta V_{\\mathrm{TH}}$ 是独立的零均值高斯变量，$\\varepsilon_{\\mathrm{lin}}$ 也是一个零均值高斯变量。其方差是其分量方差的总和：\n$$ \\sigma^2_\\varepsilon = \\mathrm{Var}(\\varepsilon_{\\mathrm{lin}}) = \\mathrm{Var}(\\delta_\\beta) + \\left(-\\frac{2}{V_{\\mathrm{ov},1}}\\right)^2 \\mathrm{Var}(\\Delta V_{\\mathrm{TH}}) = \\sigma^2_{\\delta_\\beta} + \\frac{4}{V_{\\mathrm{ov},1}^2}\\sigma^2_{\\Delta V_{\\mathrm{TH}}} $$\n代入基于 Pelgrom 定律的方差表达式，可得：\n$$ \\sigma^2_\\varepsilon(s) = \\left( \\frac{A_\\beta^2}{W_1 L_1} + \\frac{4A_{V_{\\mathrm{TH}}}^2}{V_{\\mathrm{ov},1}^2 W_1 L_1} \\right) \\left(1 + \\frac{1}{s}\\right) = \\frac{A_{\\mathrm{comb}}^2}{W_1 L_1} \\left(1 + \\frac{1}{s}\\right) $$\n其中 $A_{\\mathrm{comb}}^2 = A_\\beta^2 + 4A_{V_{\\mathrm{TH}}}^2/V_{\\mathrm{ov},1}^2$ 是一个与几何尺寸无关的组合失配系数。\n\n对于一个零均值高斯变量 $\\varepsilon$，良率要求 $P(|\\varepsilon| \\le t) \\ge p$ 等价于 $P(-t \\le \\varepsilon \\le t) \\ge p$。通过 $\\sigma_\\varepsilon$进行归一化，这变为 $P(-t/\\sigma_\\varepsilon \\le Z \\le t/\\sigma_\\varepsilon) \\ge p$，其中 $Z$ 是一个标准正态变量。如果 $\\Phi(z)$ 是标准正态累积分布函数（CDF），那么 $2\\Phi(t/\\sigma_\\varepsilon) - 1 \\ge p$。这意味着 $t/\\sigma_\\varepsilon \\ge z_p$，其中 $z_p = \\Phi^{-1}((1+p)/2)$ 是对应于双边概率 $p$ 的 z-score。因此，关于方差的条件是 $\\sigma^2_\\varepsilon \\le (t/z_p)^2$。\n\n我们将 $\\sigma^2_\\varepsilon(s)$ 的表达式代入此不等式以求解 $s$：\n$$ \\frac{A_{\\mathrm{comb}}^2}{W_1 L_1} \\left(1 + \\frac{1}{s}\\right) \\le \\left(\\frac{t}{z_p}\\right)^2 $$\n$$ 1 + \\frac{1}{s} \\le \\frac{W_1 L_1}{A_{\\mathrm{comb}}^2} \\left(\\frac{t}{z_p}\\right)^2 $$\n我们定义一个无量纲量 $K = \\frac{W_1 L_1}{A_{\\mathrm{comb}}^2} (\\frac{t}{z_p})^2$。不等式变为 $1 + 1/s \\le K$，即 $1/s \\le K - 1$。\n为了存在有限的正值解 $s$，我们必须有 $K - 1 > 0$，即 $K>1$。如果 $K \\le 1$，则无法通过缩放输出器件来满足良率规范，$s_{\\min}$ 报告为 $-1.0$。\n如果 $K > 1$，我们可以写出 $s \\ge 1/(K-1)$。所需的最小比例因子为 $s_{\\mathrm{min,raw}} = 1/(K-1)$。考虑到 $s_{\\min} \\ge 1$ 的附加约束，最终的最小比例因子为 $s_{\\min} = \\max(1.0, 1/(K-1))$。此解析过程将应用于每个测试用例以找到 $s_{\\min}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Solves the MOSFET current mirror mismatch problem for a suite of test cases.\n    For each case, it computes the 3-sigma current spread via Monte Carlo\n    simulation and the minimum area scale factor via an analytical model.\n    \"\"\"\n\n    # Parameters for the analysis\n    N_samples = 200000\n    seed = 123\n\n    def solve_case(params):\n        \"\"\"\n        Processes a single test case.\n        \n        Args:\n            params (tuple): A tuple containing all parameters for the test case.\n            \n        Returns:\n            tuple: A tuple containing (delta_I_3sigma, s_min).\n        \"\"\"\n        I_ref, V_ov1, W1, L1, s, A_VTH, A_beta, p, t = params\n        \n        # === Part 1: Monte Carlo Simulation ===\n        \n        # Calculate the area of the reference device\n        A1 = W1 * L1\n        \n        # Calculate the standard deviations of the mismatch sources for the pair\n        sigma_delta_VTH = (A_VTH / np.sqrt(A1)) * np.sqrt(1 + 1/s)\n        sigma_delta_beta = (A_beta / np.sqrt(A1)) * np.sqrt(1 + 1/s)\n        \n        # Initialize the random number generator with a fixed seed for reproducibility\n        rng = np.random.default_rng(seed)\n        \n        # Generate N random samples for each mismatch source\n        delta_VTH_samples = rng.normal(loc=0, scale=sigma_delta_VTH, size=N_samples)\n        delta_beta_samples = rng.normal(loc=0, scale=sigma_delta_beta, size=N_samples)\n        \n        # Calculate the ideal output current\n        I_out_ideal = s * I_ref\n        \n        # Calculate the output current samples including mismatch effects\n        term_vth = 1 - (delta_VTH_samples / V_ov1)\n        term_beta = 1 + delta_beta_samples\n        I_out_samples = I_out_ideal * term_beta * (term_vth**2)\n        \n        # Calculate the current error and its 3-sigma spread\n        current_error = I_out_samples - I_out_ideal\n        # np.std computes population standard deviation (ddof=0), which is appropriate for a large MC sample\n        std_current_error = np.std(current_error)\n        delta_I_3sigma = 3 * std_current_error\n        \n        # === Part 2: Analytical Calculation for s_min ===\n        \n        # Calculate the z-score for the given two-sided yield probability p\n        # P(|Z| = z_p) = p  =>  P(Z = z_p) = p + (1-p)/2 = (1+p)/2\n        z_p = norm.ppf((1 + p) / 2)\n        \n        # Calculate the combined mismatch parameter squared\n        A_comb_sq = A_beta**2 + (4 * A_VTH**2) / (V_ov1**2)\n        \n        s_min = -1.0\n        # The z-score could be zero if p=0, which is not physical but we check for robustness.\n        # Also, z_p^2 could be zero.\n        if z_p > 0 and A_comb_sq > 0:\n            K = (A1 * (t**2)) / (A_comb_sq * (z_p**2))\n            \n            # Check if a finite, positive solution for s exists\n            if K > 1:\n                # Minimum s is given by s >= 1/(K-1)\n                s_min_raw = 1 / (K - 1)\n                # The problem asks for s_min >= 1\n                s_min = max(1.0, s_min_raw)\n        \n        return delta_I_3sigma, s_min\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (I_ref, V_ov1, W1, L1, s, A_VTH, A_beta, p, t)\n        # Case 1 (happy path)\n        (1.0e-5, 0.2, 10.0, 0.18, 1.0, 3.0e-3, 1.0e-2, 0.99, 0.05),\n        # Case 2 (small device area, relaxed tolerance, high yield)\n        (1.0e-4, 0.25, 0.8, 0.18, 1.0, 3.0e-3, 1.5e-2, 0.9973, 0.10),\n        # Case 3 (scaled mirror, stringent yield and tolerance)\n        (5.0e-5, 0.15, 4.0, 0.18, 4.0, 2.5e-3, 1.0e-2, 0.999, 0.03),\n        # Case 4 (low overdrive, moderate area, difficult yield)\n        (5.0e-6, 0.06, 20.0, 0.18, 1.0, 3.0e-3, 1.0e-2, 0.95, 0.02),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Calculate the results for one case\n        delta_I, s_min_val = solve_case(case)\n        results.append(delta_I)\n        results.append(s_min_val)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}