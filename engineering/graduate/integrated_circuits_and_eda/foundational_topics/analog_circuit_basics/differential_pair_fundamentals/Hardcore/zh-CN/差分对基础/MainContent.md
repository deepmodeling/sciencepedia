## 引言
[差分对](@entry_id:266000)是现代模拟与[混合信号集成电路设计](@entry_id:270287)的核心基石。相较于单端结构，其固有的共模噪声抑制能力和对电源扰动的高容忍度，使其在高性能放大器、[数据转换](@entry_id:170268)器和通信系统中不可或缺。然而，要充分发挥其潜力，设计师不仅需要掌握其理想工作模型，还必须深刻理解由工艺变化和物理限制带来的非理想效应，并在各种性能指标之间做出明智的权衡。本文旨在为读者构建一个关于[差分对](@entry_id:266000)的系统性知识框架。

在“原理与机制”一章中，我们将深入剖析差分信号与[共模信号](@entry_id:264851)的分解、[差分增益](@entry_id:264006)的计算、[共模抑制](@entry_id:265391)的来源以及失调、噪声等关键非理想性。随后的“应用与跨学科连接”一章将展示这些原理如何在[运算放大器](@entry_id:263966)、高速比较器乃至生物医学传感等多样化场景中得到应用。最后，通过“动手实践”部分，读者将有机会运用所学知识解决具体的[电路分析](@entry_id:261116)问题。

让我们首先从[差分对](@entry_id:266000)最基本的信号处理机制开始。

## 原理与机制

本章节旨在深入探讨差分对电路的核心工作原理与关键机制。我们将从理想的信号处理概念出发，逐步引入实际电路中的非理想因素，并探讨其对电路性能的影响，最终建立一个适用于分析和设计的系统性框架。

### [信号表示](@entry_id:266189)基础：差分信号与[共模信号](@entry_id:264851)

差分对的核心优势在于其对信号的特定处理方式。任何施加于两个输入端（记为 $v_{+}$ 和 $v_{-}$）的电压激励，都可以被唯一地分解为两种基本模式：**[共模信号](@entry_id:264851)（common-mode signal, $v_{cm}$）** 和 **差分信号（differential signal, $v_d$）**。共模分量代表两个输入同步、同向的变化，而差分分量则代表它们之间反向、相对的变化。

这两个分量的标准定义如下：
$$
v_d \triangleq v_{+} - v_{-}
$$
$$
v_{cm} \triangleq \frac{v_{+} + v_{-}}{2}
$$

反之，我们也可以通过共模和差分分量来重构原始的输入信号：
$$
v_{+} = v_{cm} + \frac{v_d}{2}
$$
$$
v_{-} = v_{cm} - \frac{v_d}{2}
$$

这个分解不仅仅是数学上的技巧，它揭示了差分电路运作的物理本质。电路对这两种信号模式的响应是截然不同的。理想的差分放大器会极大地放大差分信号，同时完全抑制[共模信号](@entry_id:264851)。

为了具体理解这一点，我们可以考虑一个实例 。假设输入电压为 $v_{+} = 1\,\text{mV}$ 和 $v_{-} = -2\,\text{mV}$。根据定义，我们可以计算出差分和共模分量：
$$
v_d = (1\,\text{mV}) - (-2\,\text{mV}) = 3\,\text{mV}
$$
$$
v_{cm} = \frac{(1\,\text{mV}) + (-2\,\text{mV})}{2} = -0.5\,\text{mV}
$$

在小信号工作区，差分输入 $v_d$ 的作用是“驱动”或“引导”一个恒定的尾电流在[差分对](@entry_id:266000)的两个支路之间重新分配。在一个完全对称的[差分对](@entry_id:266000)中，当 $v_d = 0$ 时，尾电流被均分到两个支路。当一个正的 $v_d$（即 $v_{+} > v_{-}$）施加时，$v_{+}$ 侧晶体管的栅源电压相对更高，导通能力更强，因此会“抢夺”更多的电流；相应地，$v_{-}$ 侧的晶体管电流减小。如果施加一个负的 $v_d$（即 $v_{+} \lt v_{-}$），情况则完全相反：$v_{-}$ 侧的晶体管将导通更多的电流。这种“推挽”式的电流引导行为是[差分放大器](@entry_id:272747)的核心机制。由于总电流（[尾电流](@entry_id:1123312)）保持不变，差分信号的放大过程对电源和地的扰动远小于单端放大器，这是其在集成电路中备受青睐的关键原因之一。

### 理想小信号[差分增益](@entry_id:264006)分析：半边电路法

为了精确量化[差分对](@entry_id:266000)的放大能力，我们需要进行[小信号分析](@entry_id:263462)。对于一个完全对称的电路，在纯差分（奇模）激励下，其分析可以被极大地简化。这种简化方法被称为 **半边电路法（half-circuit method）**。

该方法的有效性基于一个关键的对称性论证 。考虑一个由两个完全匹配的晶体管构成的[差分对](@entry_id:266000)，它们由一个理想的[尾电流源](@entry_id:262705)（其小信号阻抗 $r_t \to \infty$）偏置，并连接到匹配的负载。当施加一个纯差分输入信号，即 $v_{i1} = +v_d/2$ 和 $v_{i2} = -v_d/2$ 时，由于电路的物理对称性和激励的[反对称性](@entry_id:261893)，电路中任何节点的响应也必须是反对称的。对于位于两个晶体管公共源极点的节点，我们称之为 $v_s$，[反对称性](@entry_id:261893)要求其满足 $v_s = -v_s$，唯一的解是 $v_s = 0$。

这意味着，在纯差分小信号激励下，公共源极点在交流意义上被固定在零电位，表现为一个 **[虚地](@entry_id:269132)（virtual ground）**。因此，我们可以沿着通过该节点的[对称面](@entry_id:1132744)将电路一分为二，只分析其中的一半——即“半边电路”，而对称面上的所有点均视为接地。这一结论即使在晶体管[输出电阻](@entry_id:276800) $r_o$ 为有限值时依然成立，只要两侧的 $r_o$ 是匹配的。

利用半边电路法，我们可以轻松地计算[差分增益](@entry_id:264006)。考虑一个带有阻性负载 $R_D$ 的[MOS差分对](@entry_id:272034) 。其奇模半边电路是一个源极接地的[共源放大器](@entry_id:265648)。其输入为 $v_{id}/2$，负载为 $R_D$ 与晶体管自身输出电阻 $r_o$ 的并联。因此，单端输出 $v_{o1}$ 为：
$$
v_{o1} = -g_m v_{gs1} (R_D \parallel r_o) = -g_m \left(\frac{v_{id}}{2}\right) \left(\frac{R_D r_o}{R_D + r_o}\right)
$$
其中 $g_m$ 是晶体管的[跨导](@entry_id:274251)。由于输出的[反对称性](@entry_id:261893)，$v_{o2} = -v_{o1}$。差分输出电压 $v_{od}$ 定义为 $v_{o1} - v_{o2}$，因此：
$$
v_{od} = v_{o1} - (-v_{o1}) = 2v_{o1} = -g_m v_{id} \left(\frac{R_D r_o}{R_D + r_o}\right)
$$
最终，我们可以得到差分到差分的[电压增益](@entry_id:266814) **$A_d$**：
$$
A_d = \frac{v_{od}}{v_{id}} = -g_m (R_D \parallel r_o) = -g_m \frac{R_D r_o}{R_D + r_o}
$$
这个简洁而重要的结果展示了半边电路法在分析[对称差](@entry_id:156264)分结构时的强大威力。

### [增益提升](@entry_id:275440)技术：[有源负载](@entry_id:262691)

在现代[集成电路设计](@entry_id:1126551)中，为了获得高增益，简单的阻性负载通常不是最优选择，因为在芯片上制造高阻值的线性电阻既占用面积又可能引入非理想效应。取而代之的是 **[有源负载](@entry_id:262691)（active load）**，通常以[电流镜](@entry_id:264819)的形式实现 。

一个典型的[有源负载](@entry_id:262691)N[MOS差分对](@entry_id:272034)，其负载由一个P[MOS电流镜](@entry_id:273667)构成。[差分对](@entry_id:266000)的一侧（例如，M1的漏极）连接到一个二[极管](@entry_id:909477)连接的P[MOS晶体管](@entry_id:273779)（M3），形成电流镜的输入端。另一侧（M2的漏极）则连接到电流镜的输出晶体管（M4），该点同时作为整个放大器的单端输出。

[有源负载](@entry_id:262691)通过两种协同机制显著提升了[电压增益](@entry_id:266814)：

1.  **有效跨导的倍增**：差分输入信号 $v_{id}$ 使得M1和M2的漏极电流分别产生 $i_{d1} = +g_{mn}v_{id}/2$ 和 $i_{d2} = -g_{mn}v_{id}/2$ 的变化。[电流镜](@entry_id:264819)的作用是感知到 $i_{d1}$ 的变化，并在其输出端（M4的漏极）产生一个近似相等的电流变化 $i_{d4} \approx i_{d1}$。因此，汇集到输出节点的总信号电流为 $i_{out} = i_{d4} - i_{d2} \approx (g_{mn}v_{id}/2) - (-g_{mn}v_{id}/2) = g_{mn}v_{id}$。与单端输出的阻性负载情况相比（其有效跨导为 $g_{mn}/2$），[有源负载](@entry_id:262691)通过[电流镜](@entry_id:264819)的“折叠”和“相减”操作，将整个[差分对](@entry_id:266000)的[跨导](@entry_id:274251) $g_{mn}$ 完全用于驱动单端输出。

2.  **有效负载阻抗的大幅提升**：输出节点的总小信号负载阻抗不再是 $R_D$，而是输入NMOS管（M2）的[输出电阻](@entry_id:276800) $r_{o2}$ 与负载PMOS管（M4）的[输出电阻](@entry_id:276800) $r_{o4}$ 的并联组合。即 $R_{out} = r_{o2} \parallel r_{o4}$。由于晶体管的[输出电阻](@entry_id:276800)通常非常高（数十至数百千欧姆），这个并联阻值远大于典型的片上电阻 $R_D$。

综合这两个因素，带[有源负载](@entry_id:262691)的[差分放大器](@entry_id:272747)的单端[差分增益](@entry_id:264006)为：
$$
A_d = \frac{v_o}{v_{id}} = g_{mn} (r_{o2} \parallel r_{o4})
$$
以一个具体例子说明 ，若 $g_{mn} = 2\,\mathrm{mS}$，$r_{o2} = 50\,\mathrm{k\Omega}$，$r_{o4} = 80\,\mathrm{k\Omega}$，则[有源负载](@entry_id:262691)提供的增益约为 $A_d \approx (2\,\mathrm{mS}) \times (50\,\mathrm{k\Omega} \parallel 80\,\mathrm{k\Omega}) \approx 61.5\,\mathrm{V/V}$。而如果采用一个 $10\,\mathrm{k\Omega}$ 的电阻负载，即使忽略晶体管的 $r_o$，其单端增益也仅为 $A_d \approx (g_{mn}/2)R_D = 10\,\mathrm{V/V}$。可见，[有源负载](@entry_id:262691)极大地提升了放大器的增益性能。

### [共模信号](@entry_id:264851)抑制：CMRR及其限制因素

差分放大器的另一个核心性能指标是其抑制[共模信号](@entry_id:264851)的能力，这由 **[共模抑制比](@entry_id:271843)（Common-Mode Rejection Ratio, CMRR）** 来量化。它被定义为[差分增益](@entry_id:264006) $A_d$ 与 **[共模增益](@entry_id:263356)（common-mode gain, $A_{cm}$）** 幅值之比 ：
$$
\mathrm{CMRR} \triangleq \left| \frac{A_d}{A_{cm}} \right|
$$
理想情况下，$A_{cm}=0$，因此CMRR为无穷大。然而，在实际电路中，两个主要因素会导致有限的CMRR。

第一个因素是 **[尾电流源](@entry_id:262705)的有限[输出阻抗](@entry_id:265563)**。理想的[尾电流源](@entry_id:262705)在[小信号模型](@entry_id:270703)中应为开路，即具有无穷大的输出电阻 $r_{tail}$。然而，任何实际的[电流源](@entry_id:275668)都有一个有限的[输出电阻](@entry_id:276800)。这个有限的电阻破坏了对[共模信号](@entry_id:264851)的完美抑制 。

在纯差分输入下，我们已经证明公共源极点是[虚地](@entry_id:269132)，因此 $r_{tail}$ 的值（只要非零）不影响[差分增益](@entry_id:264006) $A_d = -g_m R_D$（此处为便于分析，暂时忽略晶体管的 $r_o$）。然而，当施加一个[共模电压](@entry_id:267734) $v_{cm}$ 时，由于 $r_{tail}$ 的存在，公共源极点 $v_s$ 不再接地，而是会跟随 $v_{cm}$ 发生变化。通过KCL分析可以得到，公共源极电压的波动会通过晶体管的[跨导](@entry_id:274251)转化为漏极电流的变化，从而在输出端产生一个非零的共模输出。对于单端输出，[共模增益](@entry_id:263356)可以近似表示为：
$$
A_{cm} \approx -\frac{R_D}{2r_{tail}}
$$
这个表达式更为精确的形式为 $A_{cm} = -\frac{g_m R_D}{1 + 2 g_m r_{tail}}$。因此，CMRR可以表示为：
$$
\mathrm{CMRR} = \left| \frac{A_d}{A_{cm}} \right| \approx \left| \frac{-g_m R_D}{-R_D / (2r_{tail})} \right| = 2g_m r_{tail}
$$
这个结果明确指出，要获得高的CMRR，[尾电流源](@entry_id:262705)必须具有非常高的[输出阻抗](@entry_id:265563)。

第二个限制CMRR的因素是 **[器件失配](@entry_id:1123618)**。即使[尾电流源](@entry_id:262705)是理想的，如果差分对两侧的晶体管（例如 $g_m$ 或 $V_{TH}$）或负载（例如 $R_D$）存在微小的不匹配，电路的完美对称性就会被打破。这种不对称性会导致所谓的 **共模到差模转换（common-mode to differential-mode conversion）**，即一个纯共模输入信号也会在输出端产生一个差分电压分量，从而显著降低CMRR 。在许多实际应用中，失配往往是限制CMRR性能的主导因素。

### 关键非理想性与设计权衡

除了增益和CMRR，设计师还必须关注其他几个关键的实际性能指标，它们通常涉及在不同性能目标之间的权衡。

#### [输入失调电压](@entry_id:267780)

由于制造过程中的随机偏差，即使是精心设计的差分对，其两侧的晶体管也不可能完全相同。这种 **失配（mismatch）** 导致即使在差分输入为零时，输出也可能存在一个非零的[直流分量](@entry_id:272384)。为了将输出调零，需要在输入端施加一个微小的直流差分电压，这个电压就被定义为 **[输入失调电压](@entry_id:267780)（input-referred offset voltage, $V_{OS}$）** 。

对于[MOS差分对](@entry_id:272034)，失调主要来源于两个方面：阈值电压的失配 ($\Delta V_{TH}$) 和尺寸/迁移率参数的失配 ($\Delta \beta$, 其中 $\beta \equiv \mu C_{ox} W/L$)。通过分析在 $I_{D1}=I_{D2}=I_T/2$ 条件下的栅源电压关系，可以推导出 $V_{OS}$ 的[一阶近似](@entry_id:147559)表达式：
$$
V_{OS} \approx \Delta V_{TH} - \frac{V_{OV}}{2} \frac{\Delta \beta}{\beta}
$$
其中 $V_{OV}$ 是晶体管在标称偏置电流下的[过驱动电压](@entry_id:272139) ($V_{GS} - V_{TH}$)。这个公式揭示了设计上的一个权衡：虽然较低的 $V_{OV}$ 有利于扩大[输入共模范围](@entry_id:273151)（见下文），但它会使电路对 $\beta$ 的失配更为敏感。因此，在需要低失调电压的设计中，通常会采用较大的晶体管尺寸（以减小相对失配）和适中的过驱动电压。

#### 线性度与简并技术

差分对的大信号[传输特性](@entry_id:1133302)（$i_d$ vs. $v_{id}$）呈现出[非线性](@entry_id:637147)，通常为[双曲正切](@entry_id:636446)（BJT）或类似的S形曲线（MOS）。只有在原点附近很小的输入范围内，这种关系才近似线性。为了扩展这个[线性范围](@entry_id:181847)，一种非常有效的技术是 **源极/[发射极简并](@entry_id:267745)（source/emitter degeneration）** 。

该技术通过在每个晶体管的源极（或发射极）串联一个小的简并电阻 $R_S$ 来引入局部负反馈。这个反馈会降低电路的整体跨导，但同时提高了线性度。通过[小信号分析](@entry_id:263462)可以证明，简并后[差分对](@entry_id:266000)的有效跨导 $G_{md}$ 变为：
$$
G_{md} = \frac{g_m}{1 + g_m R_S}
$$
其中 $g_m$ 是单个晶体管的[跨导](@entry_id:274251)。跨导的减小因子为 $(1 + g_m R_S)$。相应地，为了达到同样的[非线性失真](@entry_id:260858)水平，所允许的输入电压范围近似地扩大了相同的倍数。这体现了模[拟设](@entry_id:184384)计中一个无处不在的基本权衡：**增益与线性度之间的权衡**。设计师可以通过选择合适的简并电阻 $R_S$ 来根据应用需求调整这一平衡。

#### [输入共模范围](@entry_id:273151)

**[输入共模范围](@entry_id:273151)（Input Common-Mode Range, ICMR）** 定义了为保证电路中所有晶体管都正常工作在[饱和区](@entry_id:262273)（或有源区）所允许的输入[共模电压](@entry_id:267734) $V_{CM}$ 的变化范围 。超出这个范围，部分晶体管可能会进入[三极管区](@entry_id:276444)或[截止区](@entry_id:262597)，导致增益急剧下降、CMRR恶化，甚至电路功能失效。

ICMR的上下限由一系列饱和条件共同决定。以一个采用NMOS输入对、PMOS[有源负载](@entry_id:262691)和NMOS[尾电流源](@entry_id:262705)的单电源放大器为例：

*   **ICMR下限 ($V_{CM,min}$)**：由[尾电流源](@entry_id:262705)晶体管（$M_{tail}$）和输入对晶体管（$M_{1,2}$）共同决定。输入共模电压 $V_{CM}$ 不能太低，否则公共源极点 $V_S$ 的电压会过低，导致 $M_{tail}$ 进入[三极管区](@entry_id:276444)。同时，$V_{CM}$ 必须足够高于 $V_S$，以维持输入对晶体管的正常导通。综合这两个条件可得：
    $$
    V_{CM,min} = V_{ovt} + V_{ovn} + V_{THn}
    $$
    其中 $V_{ovt}$ 和 $V_{ovn}$ 分别是[尾电流源](@entry_id:262705)管和输入管的过驱动电压，$V_{THn}$ 是输入管的阈值电压。

*   **ICMR上限 ($V_{CM,max}$)**：由输入对晶体管和负载晶体管的饱和条件决定。输入[共模电压](@entry_id:267734) $V_{CM}$ 不能太高，否则会使得输入管的漏极电压被拉得过高，以至于无法满足负载PMOS管的饱和条件；或者输入管自身的栅极电压相对于其漏极电压过高，导致输入管自身进入[三极管区](@entry_id:276444)。这两个约束条件中最严格的一个决定了上限：
    $$
    V_{CM,max} = V_{DD} - V_{ovp} + V_{THn}
    $$
    其中 $V_{ovp}$ 是PMOS负载的过驱动电压。

ICMR是衡量放大器对输入信号[适应能力](@entry_id:194789)的重要指标，其范围的扩展是许多电路设计（如[轨到轨](@entry_id:271568)输入级）中的一个核心挑战。

#### 噪声性能

所有电子元器件都会产生随机的电信号波动，即 **噪声（noise）**。在[差分对](@entry_id:266000)中，主要的噪声源包括晶体管的[热噪声](@entry_id:139193)和闪烁噪声（$1/f$ 噪声）以及[负载电阻](@entry_id:267991)的热噪声。为了评估噪声性能，我们通常将所有内部噪声源的贡献等效到一个位于差分输入端的 **[输入参考噪声](@entry_id:1126527)（input-referred noise）** 电压源 $v_{n,eq}$ 。

分析差分对噪声的关键原则是，来自不同支路且不相关的噪声源，其功率（或功率谱密度PSD）会直接相加。考虑一个对称的[差分对](@entry_id:266000)，其左右两半的等效输入噪声源分别为 $v_{n+}$ 和 $v_{n-}$，它们的功率谱密度为 $S_{v+}(f)$ 和 $S_{v-}(f)$。由于它们在物理上是独立的，因此是 **不相关的（uncorrelated）**。这两个噪声源贡献的总差分输出[噪声功率谱密度](@entry_id:274939)为 $|A_d|^2 (S_{v+}(f) + S_{v-}(f))$。将其等效到输入端，我们得到总的输入参考[噪声功率谱密度](@entry_id:274939)：
$$
S_{v_{n,eq}}(f) = S_{v+}(f) + S_{v-}(f)
$$
如果两半完全相同，即 $S_{v+}(f) = S_{v-}(f) = S_v(f)$，则有：
$$
S_{v_{n,eq}}(f) = 2 S_v(f)
$$
这意味着，[差分对](@entry_id:266000)的总[输入参考噪声](@entry_id:1126527)功率是单边电路的两倍。在均方根（RMS）值上，总噪声电压是单边噪声电压的 $\sqrt{2}$ 倍。这是一个基本而重要的结论，适用于所有[对称差](@entry_id:156264)分结构的[噪声分析](@entry_id:261354)。