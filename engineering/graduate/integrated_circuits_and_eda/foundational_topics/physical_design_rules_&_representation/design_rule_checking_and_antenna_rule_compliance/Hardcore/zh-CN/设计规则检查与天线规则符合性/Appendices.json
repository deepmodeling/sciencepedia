{
    "hands_on_practices": [
        {
            "introduction": "化学机械平坦化（CMP）是确保芯片平整度的关键制造步骤，它对版图的局部金属密度有严格要求，以避免“凹陷”或“侵蚀”等问题。本练习将通过一个具体案例，向您展示如何计算一个给定窗口内的金属覆盖率，这是设计规则检查（DRC）中最基本也是最重要的几何检查之一。通过这个实践，您将深入理解版图图形如何直接影响芯片的可制造性和良率。",
            "id": "4265028",
            "problem": "一个电子设计自动化 (EDA) 的物理验证流程包括对化学机械平坦化 (CMP) 所使用的图形密度窗口进行设计规则检查 (DRC)。考虑第二金属层 ($\\mathrm{M}2$) 的单个 CMP 密度窗口，该窗口被定义为一个方形区域，其角点坐标分别为 $(0\\,\\mu\\mathrm{m}, 0\\,\\mu\\mathrm{m})$ 和 $(100\\,\\mu\\mathrm{m}, 100\\,\\mu\\mathrm{m})$。在此窗口内，三个不相交的绘制金属矩形可能部分位于窗口内部或外部，同一层上矩形之间的重叠区域只能计算一次（即，使用窗口内金属覆盖的几何并集）。这三个矩形是：\n- 矩形 $\\mathrm{P}1$：左下角坐标为 $(-20\\,\\mu\\mathrm{m}, 10\\,\\mu\\mathrm{m})$，右上角坐标为 $(60\\,\\mu\\mathrm{m}, 50\\,\\mu\\mathrm{m})$。\n- 矩形 $\\mathrm{P}2$：左下角坐标为 $(40\\,\\mu\\mathrm{m}, 30\\,\\mu\\mathrm{m})$，右上角坐标为 $(120\\,\\mu\\mathrm{m}, 80\\,\\mu\\mathrm{m})$。\n- 矩形 $\\mathrm{P}3$：左下角坐标为 $(70\\,\\mu\\mathrm{m}, 60\\,\\mu\\mathrm{m})$，右上角坐标为 $(95\\,\\mu\\mathrm{m}, 110\\,\\mu\\mathrm{m})$。\n\n使用窗口中局部金属图形密度的物理定义，即被测试层金属覆盖的窗口面积分数，计算这个 $100\\,\\mu\\mathrm{m} \\times 100\\,\\mu\\mathrm{m}$ 窗口中的局部 $\\mathrm{M}2$ 金属密度。在合规性评估中，可接受的局部密度的目标范围是 $0.30$–$0.70$。将最终密度值表示为无单位的小数，并将您的答案四舍五入到四位有效数字。",
            "solution": "所述问题需经过验证。\n\n**步骤1：提取已知条件**\n- **分析窗口 ($W$):** 一个方形区域，其角点坐标分别为 $(0\\,\\mu\\mathrm{m}, 0\\,\\mu\\mathrm{m})$ 和 $(100\\,\\mu\\mathrm{m}, 100\\,\\mu\\mathrm{m})$。\n- **矩形 P1 ($P_1$):** 左下角坐标为 $(-20\\,\\mu\\mathrm{m}, 10\\,\\mu\\mathrm{m})$，右上角坐标为 $(60\\,\\mu\\mathrm{m}, 50\\,\\mu\\mathrm{m})$。\n- **矩形 P2 ($P_2$):** 左下角坐标为 $(40\\,\\mu\\mathrm{m}, 30\\,\\mu\\mathrm{m})$，右上角坐标为 $(120\\,\\mu\\mathrm{m}, 80\\,\\mu\\mathrm{m})$。\n- **矩形 P3 ($P_3$):** 左下角坐标为 $(70\\,\\mu\\mathrm{m}, 60\\,\\mu\\mathrm{m})$，右上角坐标为 $(95\\,\\mu\\mathrm{m}, 110\\,\\mu\\mathrm{m})$。\n- **重叠规则：** “同一层上矩形之间的重叠区域只能计算一次（即，使用窗口内金属覆盖的几何并集）。”\n- **密度定义 ($\\rho$):** 局部金属图形密度是金属覆盖的窗口面积的分数，$\\rho = \\frac{A_{\\text{metal}}}{A_{\\text{window}}}$。\n- **输出要求：** 最终密度值必须是无单位小数，并四舍五入到四位有效数字。\n- **问题陈述异常：** 问题将矩形描述为“不相交的”，这意味着不重叠。然而，对所提供坐标的简单检查表明，矩形 $P_1$ 和矩形 $P_2$ 实际上是重叠的。这是问题描述中的一个事实不一致之处。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在集成电路物理验证领域具有科学依据。它是客观的，并为唯一解提供了足够的数据。关于术语“不相交”的异常已被注意到；然而，问题提供了一个明确且主导的指令：“使用金属覆盖的几何并集”。在 EDA 实践中，该指令优先于任何描述性术语。因此，该问题是适定的，因为处理重叠的方法已明确定义。该计算是计算几何的标准应用。\n\n**步骤3：结论与行动**\n该问题被判定为**有效**。微小的不一致性已被认识到，但通过其他明确的指令得以解决。将提供完整的解决方案。\n\n**求解推导**\n\n局部金属图形密度 $\\rho$ 定义为分析窗口内金属总面积 $A_{\\text{metal-in-window}}$ 与窗口总面积 $A_{\\text{window}}$ 的比值。\n$$ \\rho = \\frac{A_{\\text{metal-in-window}}}{A_{\\text{window}}} $$\n\n首先，我们计算分析窗口 $W$ 的面积。该窗口是一个方形区域，由区间 $W = [0, 100] \\times [0, 100]$ 的笛卡尔积定义，单位为 $\\mu\\mathrm{m}$。\n$$ A_{\\text{window}} = (100\\,\\mu\\mathrm{m} - 0\\,\\mu\\mathrm{m}) \\times (100\\,\\mu\\mathrm{m} - 0\\,\\mu\\mathrm{m}) = 10000\\,\\mu\\mathrm{m}^2 $$\n\n接下来，我们必须确定此窗口内的金属总面积 $A_{\\text{metal-in-window}}$。该面积是三个矩形 ($P_1$, $P_2$, $P_3$) 的几何并集，并被裁剪到窗口 $W$ 的边界。令 $P'_i = P_i \\cap W$ 表示每个矩形 $P_i$ 位于窗口内的部分。我们需要计算这些裁剪后矩形并集的面积：$A(P'_1 \\cup P'_2 \\cup P'_3)$。\n\n给定的三个矩形为：\n- $P_1 = [-20, 60] \\times [10, 50]$\n- $P_2 = [40, 120] \\times [30, 80]$\n- $P_3 = [70, 95] \\times [60, 110]$\n\n一个通用矩形 $[x_{\\min}, x_{\\max}] \\times [y_{\\min}, y_{\\max}]$ 与窗口 $W = [0, 100] \\times [0, 100]$ 的交集产生一个新的矩形 $[\\max(x_{\\min}, 0), \\min(x_{\\max}, 100)] \\times [\\max(y_{\\min}, 0), \\min(y_{\\max}, 100)]$。\n\n裁剪后的矩形 $P'_i$ 为：\n- $P'_1 = [\\max(-20, 0), \\min(60, 100)] \\times [\\max(10, 0), \\min(50, 100)] = [0, 60] \\times [10, 50]$\n- $P'_2 = [\\max(40, 0), \\min(120, 100)] \\times [\\max(30, 0), \\min(80, 100)] = [40, 100] \\times [30, 80]$\n- $P'_3 = [\\max(70, 0), \\min(95, 100)] \\times [\\max(60, 0), \\min(110, 100)] = [70, 95] \\times [60, 100]$\n\n这些裁剪后矩形的各自面积为：\n- $A(P'_1) = (60 - 0) \\times (50 - 10) = 60 \\times 40 = 2400\\,\\mu\\mathrm{m}^2$\n- $A(P'_2) = (100 - 40) \\times (80 - 30) = 60 \\times 50 = 3000\\,\\mu\\mathrm{m}^2$\n- $A(P'_3) = (95 - 70) \\times (100 - 60) = 25 \\times 40 = 1000\\,\\mu\\mathrm{m}^2$\n\n为了求并集的面积，我们使用三个集合的容斥原理：\n$$ A(P'_1 \\cup P'_2 \\cup P'_3) = A(P'_1) + A(P'_2) + A(P'_3) - A(P'_1 \\cap P'_2) - A(P'_1 \\cap P'_3) - A(P'_2 \\cap P'_3) + A(P'_1 \\cap P'_2 \\cap P'_3) $$\n\n我们现在计算裁剪后矩形成对交集的面积：\n- 交集 $P'_1 \\cap P'_2$：\n  - $x$-区间: $[\\max(0, 40), \\min(60, 100)] = [40, 60]$\n  - $y$-区间: $[\\max(10, 30), \\min(50, 80)] = [30, 50]$\n  - 面积: $A(P'_1 \\cap P'_2) = (60 - 40) \\times (50 - 30) = 20 \\times 20 = 400\\,\\mu\\mathrm{m}^2$\n\n- 交集 $P'_1 \\cap P'_3$：\n  - $x$-区间: $[\\max(0, 70), \\min(60, 95)] = [70, 60]$。由于下界大于上界，交集为空集。\n  - 面积: $A(P'_1 \\cap P'_3) = 0\\,\\mu\\mathrm{m}^2$\n\n- 交集 $P'_2 \\cap P'_3$：\n  - $x$-区间: $[\\max(40, 70), \\min(100, 95)] = [70, 95]$\n  - $y$-区间: $[\\max(30, 60), \\min(80, 100)] = [60, 80]$\n  - 面积: $A(P'_2 \\cap P'_3) = (95 - 70) \\times (80 - 60) = 25 \\times 20 = 500\\,\\mu\\mathrm{m}^2$\n\n最后，我们计算三重交集的面积 $A(P'_1 \\cap P'_2 \\cap P'_3)$。由于 $P'_1 \\cap P'_3$ 为空，三重交集也必定为空。\n$$ A(P'_1 \\cap P'_2 \\cap P'_3) = A((P'_1 \\cap P'_3) \\cap P'_2) = A(\\emptyset \\cap P'_2) = A(\\emptyset) = 0\\,\\mu\\mathrm{m}^2 $$\n\n现在，我们将所有面积代入容斥公式：\n$$ A_{\\text{metal-in-window}} = A(P'_1 \\cup P'_2 \\cup P'_3) = (2400 + 3000 + 1000) - (400 + 0 + 500) + 0 $$\n$$ A_{\\text{metal-in-window}} = 6400 - 900 + 0 = 5500\\,\\mu\\mathrm{m}^2 $$\n\n因此，局部金属密度 $\\rho$ 为：\n$$ \\rho = \\frac{A_{\\text{metal-in-window}}}{A_{\\text{window}}} = \\frac{5500\\,\\mu\\mathrm{m}^2}{10000\\,\\mu\\mathrm{m}^2} = 0.55 $$\n\n问题要求答案表示为四舍五入到四位有效数字的小数。\n$$ \\rho = 0.5500 $$\n\n该值落在 $0.30$ 到 $0.70$ 的可接受目标范围内。",
            "answer": "$$\\boxed{0.5500}$$"
        },
        {
            "introduction": "在等离子体刻蚀过程中，连接到栅极的长段金属线会像天线一样收集电荷，可能导致栅氧层被击穿，这就是所谓的“天线效应”。本练习旨在从物理原理出发，构建一个数学模型来量化保护二极管对天线效应的缓解作用。通过推导有效天线比率 $AR_{\\mathrm{eff}}$ 的计算公式，您将学会如何在高级DRC中对这类设计保护结构进行精确的量化评估，理解其背后的电荷注入与泄放机制。",
            "id": "4265055",
            "problem": "考虑一个集成电路电子设计自动化 (EDA) 中的高级物理验证场景。目标是构建一个基于数学的设计规则检查 (DRC) 天线合规性规则，该规则通过对一个缩放天线比的有效放电因子进行建模，从而在网络上存在二极管时，有条件地放宽天线比 (AR)。\n\n从以下基本原理出发：\n\n- 天线比定义为 $AR = \\frac{A_m}{A_g}$，其中 $A_m$ 是在刻蚀步骤中连接到栅极的总暴露导体面积，$A_g$ 是栅极面积。$A_m$ 和 $A_g$ 都必须以 $\\mu \\mathrm{m}^2$ 为单位表示。\n- 刻蚀过程中的等离子体感应充电会注入与导体面积成正比的电流。设注入电流密度为 $\\rho$，单位为 $\\mathrm{A}/\\mu \\mathrm{m}^2$。注入电流为 $I_{\\mathrm{in}} = \\rho A_m$。\n- 如果存在网络上的二极管，它会在刻蚀期间对节点进行放电，近似地提供一个与其面积成正比的放电电流。设二极管面积为 $A_d$，单位为 $\\mu \\mathrm{m}^2$，在相关偏置下的二极管电流密度为 $J_s$，单位为 $\\mathrm{A}/\\mu \\mathrm{m}^2$。从二极管到天线节点的路径电阻为 $R_p$，单位为 $\\Omega$，二极管表现出一个特征串联电阻参数 $R_s$，单位为 $\\Omega$。你必须使用一个随 $R_p$ 增大而减小的无量纲因子，来为由于 $R_p$ 引起的放电电流建立一个衰减因子模型。\n- 工艺天线规则指定了一个最大允许比率 $AR_{\\max}$ (无量纲)。合规性要求有效天线比 $AR_{\\mathrm{eff}}$ 不超过 $AR_{\\max}$。\n\n构建一个规则，通过使用一个有效放电因子 $\\gamma \\in [0,1]$ 来缩放 $AR$ 以确定 $AR_{\\mathrm{eff}}$。该因子模拟了在二极管辅助放电后，节点上残留的等离子体注入电荷的比例。该规则必须满足以下标准：\n- 如果没有二极管，则节点不接收放电辅助，规则必须简化为 $AR_{\\mathrm{eff}} = AR$。\n- 如果存在二极管，放电辅助必须随着 $A_d$ 的增加和 $R_p$ 的减小而单调地减小 $AR_{\\mathrm{eff}}$。\n- 放电因子的构建必须基于给定的基本原理，并且量纲一致。通过二极管放电的衰减因子模型必须是 $R_p$ 和 $R_s$ 的无量纲函数，当 $R_p \\rightarrow 0$ 时接近 $1$，当 $R_p \\rightarrow \\infty$ 时接近 $0$。\n\n你的任务是实现一个程序，对于每个测试用例，确定净有效天线比是否满足 $AR_{\\mathrm{eff}} \\le AR_{\\max}$。所有输入必须使用指定的单位：\n- 面积 $A_m$、$A_g$ 和 $A_d$ 必须以 $\\mu \\mathrm{m}^2$ 为单位。\n- 电阻 $R_p$ 和 $R_s$ 必须以 $\\Omega$ 为单位。\n- 电流密度 $\\rho$ 和 $J_s$ 必须以 $\\mathrm{A}/\\mu \\mathrm{m}^2$ 为单位。\n\n在你的计算中使用以下固定的工艺参数：\n- $AR_{\\max} = 300$。\n- $\\rho = 1.0 \\times 10^{-9} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$。\n- $J_s = 2.0 \\times 10^{-6} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$。\n- $R_s = 100 \\, \\Omega$。\n\n用于覆盖多个方面的参数值测试套件：\n- 情况 $1$ (无二极管的边界情况)：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (60000, 200, \\text{False}, 0, 0)$。\n- 情况 $2$ (无二极管的失败情况)：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{False}, 0, 0)$。\n- 情况 $3$ (中等二极管和中等路径电阻下的部分放宽)：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 50, 50)$。\n- 情况 $4$ (大二极管和中等路径电阻下的强放宽)：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 300, 400)$。\n- 情况 $5$ (金属面积为零的边缘情况)：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (0, 200, \\text{False}, 0, 0)$。\n- 情况 $6$ (存在二极管但因极大路径电阻而实际断开)：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 100, 10^9)$。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果 (例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\ldots]$)，其中每个 $\\text{result}_i$ 是一个布尔值，指示相应测试用例的合规性，$\\text{True}$ 表示 $AR_{\\mathrm{eff}} \\le AR_{\\max}$，否则为 $\\text{False}$。不允许有其他输出。",
            "solution": "用户需要解决一个问题陈述。\n\n### 步骤1：提取已知条件\n- **天线比定义**：$AR = \\frac{A_m}{A_g}$，其中 $A_m$ 是暴露的导体面积 ($\\mu \\mathrm{m}^2$)，$A_g$ 是栅极面积 ($\\mu \\mathrm{m}^2$)。\n- **注入电流**：$I_{\\mathrm{in}} = \\rho A_m$，其中 $\\rho$ 是注入电流密度 ($\\mathrm{A}/\\mu \\mathrm{m}^2$)。\n- **二极管放电**：一个面积为 $A_d$ ($\\mu \\mathrm{m}^2$) 的网络上二极管提供放电电流。二极管电流密度为 $J_s$ ($\\mathrm{A}/\\mu \\mathrm{m}^2$)。路径电阻为 $R_p$ ($\\Omega$)，二极管串联电阻参数为 $R_s$ ($\\Omega$)。必须对一个关于 $R_p$ 和 $R_s$ 的函数来建模衰减因子。\n- **合规性规则**：有效天线比 $AR_{\\mathrm{eff}}$ 不得超过最大允许比率 $AR_{\\max}$。$AR_{\\mathrm{eff}} \\le AR_{\\max}$。\n- **有效放电因子**：$AR_{\\mathrm{eff}}$ 是通过用一个因子 $\\gamma \\in [0,1]$ 缩放 $AR$ 得到的，该因子模拟了剩余电荷的比例。\n- **模型标准**：\n    1. 如果没有二极管，$AR_{\\mathrm{eff}} = AR$。\n    2. 如果存在二极管，$AR_{\\mathrm{eff}}$ 必须随着 $A_d$ 的增加和 $R_p$ 的减小而单调减小。\n    3. 放电的衰减因子必须是 $R_p$ 和 $R_s$ 的无量纲函数，当 $R_p \\rightarrow 0$ 时接近 $1$，当 $R_p \\rightarrow \\infty$ 时接近 $0$。\n- **固定工艺参数**：\n    - $AR_{\\max} = 300$\n    - $\\rho = 1.0 \\times 10^{-9} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$\n    - $J_s = 2.0 \\times 10^{-6} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$\n    - $R_s = 100 \\, \\Omega$\n- **测试套件**：\n    - 情况 $1$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (60000, 200, \\text{False}, 0, 0)$\n    - 情况 $2$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{False}, 0, 0)$\n    - 情况 $3$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 50, 50)$\n    - 情况 $4$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 300, 400)$\n    - 情况 $5$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (0, 200, \\text{False}, 0, 0)$\n    - 情况 $6$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 100, 10^9)$\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上基于半导体制造中等离子体感应充电的原理，这是一个众所周知的可靠性问题。其公式基于面积、电流密度和电阻等物理量。问题陈述清晰，提供了一个明确的目标（为一组测试用例确定合规性）、足够的数据和一系列构建所需数学模型的约束条件。语言客观而精确。该问题需要从第一性原理和给定约束推导出一个模型，这是物理学和工程学中的标准任务。该构建并非规范不足，因为对单调性和边界条件的约束指导了物理上合理的模型的选择。该问题不违反任何无效性标准。\n\n### 步骤3：结论与行动\n问题有效。将制定一个合理的解决方案。\n\n### 求解推导\n问题的核心是为有效天线比 $AR_{\\mathrm{eff}}$ 构建一个模型。标准天线规则 $AR = \\frac{A_m}{A_g} \\le AR_{\\max}$ 是限制栅极氧化层上应力的一种代理方法。这种应力是由等离子体注入电流 $I_{\\mathrm{in}}$ 流入栅极所产生的电压引起的。二极管提供了另一条路径来释放此电流。\n\n首先，我们定义基础天线比：\n$$AR = \\frac{A_m}{A_g}$$\n如果没有二极管，问题陈述指出 $AR_{\\mathrm{eff}} = AR$。\n\n如果存在二极管，它会提供放电电流。二极管本身可提供的最大放电电流与其面积成正比，$I_{d} = J_s A_d$。然而，此电流必须流过二极管的串联电阻 $R_s$ 和路径电阻 $R_p$。放电路径中的总电阻为 $R_{\\mathrm{path\\_total}} = R_s + R_p$。\n\n我们必须构建一个无量纲衰减因子 $f_{\\mathrm{att}}$，用于模拟由于 $R_p$ 导致的放电效率降低。该因子必须是 $R_s$ 和 $R_p$ 的函数，当 $R_p \\rightarrow 0$ 时接近 $1$，当 $R_p \\rightarrow \\infty$ 时接近 $0$。一个类似于电阻分压器的物理直观模型是合适的。放电“电势”受限于总路径电阻相对于二极管固有电阻的大小。一个满足给定约束的合适函数是：\n$$f_{\\mathrm{att}}(R_p, R_s) = \\frac{R_s}{R_s + R_p}$$\n该函数是无量纲的，当 $R_p=0$ 时等于 $1$，当 $R_p \\rightarrow \\infty$ 时接近 $0$。\n\n有效放电电流 $I_{\\mathrm{discharge\\_eff}}$ 是理想二极管电流经此因子衰减后的值：\n$$I_{\\mathrm{discharge\\_eff}} = I_d \\cdot f_{\\mathrm{att}} = J_s A_d \\frac{R_s}{R_s + R_p}$$\n对栅极充电的净电流是注入电流与有效放电电流之差。物理上，放电电流不能超过注入电流，因此净电流不能为负。\n$$I_{\\mathrm{net}} = \\max(0, I_{\\mathrm{in}} - I_{\\mathrm{discharge\\_eff}}) = \\max\\left(0, \\rho A_m - J_s A_d \\frac{R_s}{R_s + R_p}\\right)$$\n天线规则是栅极上应力的代理，该应力与流入栅极的电流密度 $I_{\\mathrm{net}} / A_g$ 相关。我们定义 $AR_{\\mathrm{eff}}$ 以维持与原始规则相似的结构，其中应力与比率成正比。\n$$\\text{应力} \\propto \\frac{I_{\\mathrm{net}}}{A_g}$$\n我们希望 $\\rho \\cdot AR_{\\mathrm{eff}}$ 代表这个新的应力水平。\n$$\\rho \\cdot AR_{\\mathrm{eff}} = \\frac{I_{\\mathrm{net}}}{A_g} = \\frac{\\max\\left(0, \\rho A_m - J_s A_d \\frac{R_s}{R_s + R_p}\\right)}{A_g}$$\n两边同除以 $\\rho$ 并在 $\\max$ 函数内展开：\n$$AR_{\\mathrm{eff}} = \\max\\left(0, \\frac{\\rho A_m}{\\rho A_g} - \\frac{J_s A_d}{\\rho A_g} \\frac{R_s}{R_s + R_p}\\right)$$\n代入 $AR = A_m / A_g$，我们得到 $AR_{\\mathrm{eff}}$ 的最终表达式：\n$$AR_{\\mathrm{eff}} = \\max\\left(0, AR - \\frac{J_s A_d R_s}{\\rho A_g (R_s + R_p)}\\right)$$\n这个模型满足所有标准。如果没有二极管（模型中 $A_d=0$），减法项为零，得到 $AR_{\\mathrm{eff}} = \\max(0, AR) = AR$（因为面积非负）。$AR_{\\mathrm{eff}}$ 随着 $A_d$ 的增加和 $R_p$ 的减小而单调减小。从 $AR$ 中减去的项是无量纲的，确保了量纲一致性。\n\n### 应用于测试用例\n我们使用推导出的公式和给定的参数：$AR_{\\max} = 300$，$\\rho = 1.0 \\times 10^{-9}$，$J_s = 2.0 \\times 10^{-6}$，以及 $R_s = 100$。\n\n**情况 1**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (60000, 200, \\text{False}, 0, 0)$\n无二极管。$AR_{\\mathrm{eff}} = AR = \\frac{60000}{200} = 300$。\n合规性：$300 \\le 300 \\Rightarrow \\text{True}$。\n\n**情况 2**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{False}, 0, 0)$\n无二极管。$AR_{\\mathrm{eff}} = AR = \\frac{90000}{200} = 450$。\n合规性：$450 \\le 300 \\Rightarrow \\text{False}$。\n\n**情况 3**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{True}, 50, 50)$\n存在二极管。$AR = 450$。\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{(2.0 \\times 10^{-6})(50)(100)}{(1.0 \\times 10^{-9})(200)(100 + 50)}\\right)$\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{1.0 \\times 10^{-2}}{ (2.0 \\times 10^{-7})(150) }\\right) = \\max\\left(0, 450 - \\frac{1.0 \\times 10^{-2}}{3.0 \\times 10^{-5}}\\right)$\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - 333.33...\\right) = 116.66...$\n合规性：$116.66... \\le 300 \\Rightarrow \\text{True}$。\n\n**情况 4**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{True}, 300, 400)$\n存在二极管。$AR = 450$。\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{(2.0 \\times 10^{-6})(300)(100)}{(1.0 \\times 10^{-9})(200)(100 + 400)}\\right)$\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{6.0 \\times 10^{-2}}{(2.0 \\times 10^{-7})(500)}\\right) = \\max\\left(0, 450 - \\frac{6.0 \\times 10^{-2}}{1.0 \\times 10^{-4}}\\right)$\n$AR_{\\mathrm{eff}} = \\max(0, 450 - 600) = \\max(0, -150) = 0$。\n合规性：$0 \\le 300 \\Rightarrow \\text{True}$。\n\n**情况 5**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (0, 200, \\text{False}, 0, 0)$\n无二极管。$A_m = 0$，所以 $AR = 0$。\n$AR_{\\mathrm{eff}} = AR = 0$。\n合规性：$0 \\le 300 \\Rightarrow \\text{True}$。\n\n**情况 6**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{True}, 100, 10^9)$\n存在二极管，但路径电阻极高。$AR = 450$。\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{(2.0 \\times 10^{-6})(100)(100)}{(1.0 \\times 10^{-9})(200)(100 + 10^9)}\\right)$\n项 $(100 + 10^9) \\approx 10^9$。\n$AR_{\\mathrm{eff}} \\approx \\max\\left(0, 450 - \\frac{2.0 \\times 10^{-2}}{(2.0 \\times 10^{-7})(10^9)}\\right) = \\max\\left(0, 450 - \\frac{2.0 \\times 10^{-2}}{2.0 \\times 10^2}\\right)$\n$AR_{\\mathrm{eff}} \\approx \\max(0, 450 - 1.0 \\times 10^{-4}) = 449.9999$。\n合规性：$449.9999 \\le 300 \\Rightarrow \\text{False}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DRC antenna compliance problem for a suite of test cases.\n    \"\"\"\n\n    # Define the fixed technology parameters from the problem statement.\n    AR_max = 300.0\n    rho = 1.0e-9  # A/um^2\n    J_s = 2.0e-6  # A/um^2\n    R_s = 100.0   # Ohm\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Am, Ag, diode_present, Ad, Rp)\n    test_cases = [\n        (60000.0, 200.0, False, 0.0, 0.0),    # Case 1\n        (90000.0, 200.0, False, 0.0, 0.0),    # Case 2\n        (90000.0, 200.0, True, 50.0, 50.0),     # Case 3\n        (90000.0, 200.0, True, 300.0, 400.0),   # Case 4\n        (0.0, 200.0, False, 0.0, 0.0),        # Case 5\n        (90000.0, 200.0, True, 100.0, 1.0e9)  # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        Am, Ag, diode_present, Ad, Rp = case\n\n        # Ensure gate area is non-zero to avoid division by zero.\n        # Physical devices will have Ag > 0.\n        if Ag == 0:\n            # An infinitely large AR, always fails unless Am is also 0.\n            is_compliant = (Am == 0)\n            results.append(is_compliant)\n            continue\n\n        # Calculate the base Antenna Ratio (AR)\n        AR = Am / Ag\n\n        AR_eff = 0.0\n        if not diode_present:\n            # Rule 1: If no diode, AR_eff is just AR.\n            AR_eff = AR\n        else:\n            # Diode is present, calculate the effective AR with relaxation.\n\n            # The subtractive term represents the relaxation effect of the diode.\n            # Its formulation is derived in the solution description.\n            # Numerator of the reduction term\n            reduction_num = J_s * Ad * R_s\n            \n            # Denominator of the reduction term\n            reduction_den = rho * Ag * (R_s + Rp)\n\n            reduction_term = 0.0\n            if reduction_den > 0:\n                reduction_term = reduction_num / reduction_den\n            \n            # AR_eff is the base AR minus the relaxation, clamped at 0.\n            AR_eff = np.maximum(0.0, AR - reduction_term)\n\n        # Check for compliance against the maximum allowed antenna ratio.\n        is_compliant = (AR_eff = AR_max)\n        results.append(is_compliant)\n\n    # Format the final output as a comma-separated list of booleans in brackets.\n    # The boolean values must be capitalized as True/False for correct string conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "修复天线效应违规至关重要，但修复手段本身（如插入跳线）可能会对电路的性能（尤其是时序）产生负面影响。这个问题将引导您直面在可制造性与性能之间的权衡，要求您设计一个算法来优化“跳线”的插入位置，从而在满足天线规则的同时，最小化对信号延迟的负面影响。通过应用 Elmore 延迟模型，您将掌握如何在现代物理设计中进行智能、数据驱动的协同优化，这是一项核心的工程技能。",
            "id": "4265038",
            "problem": "在电子设计自动化 (EDA) 的背景下，您将获得一个简化但科学上真实的一维互连模型，用于研究通过插入跳线 (jumper) 来缓解设计规则检查 (DRC) 中的天线效应。“跳线”被建模为一对通孔，它们局部地改变制造工艺顺序，以断开在等离子体刻蚀过程中栅极所连接的连续金属线长度，从而降低有效天线比，但同时会引入寄生电阻和电容。您的任务是设计并实现一个算法，该算法放置最少数量的跳线以满足天线规则，并选择它们沿导线的位置以最小化时序影响，其中使用网络关键性和增量电阻-电容 (RC) 成本函数作为指导。\n\n基本原理：\n- 天线比被建模为连接到栅极的连续金属线长度除以栅极面积。设栅极面积为 $A_g$ (单位为 $\\mu\\mathrm{m}^2$)，连续金属线长度为 $L$ (单位为 $\\mu\\mathrm{m}$)。天线规则要求最大分段长度必须受限于 $L_\\mathrm{max} = \\alpha_\\mathrm{max} A_g$，其中 $\\alpha_\\mathrm{max}$ 是允许的最大天线比 (单位为 $\\mu\\mathrm{m}^{-1}$)。\n- 到下游节点的总电阻-电容延迟由 Elmore 延迟近似。对于一个电阻-电容树，到某个节点的 Elmore 延迟等于对所有电容求和，每一项是到该电容的上游电阻乘以其电容值。\n- 互连线是一条均匀导线，其单位长度电阻为 $R'$ (单位为 $\\Omega/\\mu\\mathrm{m}$)，单位长度电容为 $C'$ (单位为 $\\mathrm{F}/\\mu\\mathrm{m}$)。接收端栅极电容为 $C_g$ (单位为 $\\mathrm{F}$)。\n- 每个跳线在其插入位置 $x$ (单位为 $\\mu\\mathrm{m}$) 处串联增加一个局部通孔电阻 $r_v$ (单位为 $\\Omega$)，并并联一个到地的通孔电容 $c_v$ (单位为 $\\mathrm{F}$)。假设在给定网络上，所有跳线的这些值都是相同的。\n\n模型假设与推导：\n1. 满足天线规则所需的最小跳线数 $M$ 可由以下不等式推导得出：经跳线分割后的每一段长度都必须小于或等于 $L_\\mathrm{max}$。如果总导线长度为 $L$，则 $M = \\lceil L/L_\\mathrm{max} \\rceil - 1$，当 $L \\le L_\\mathrm{max}$ 时，$M = 0$。\n2. 设 $x_j$ 为第 $j$ 个跳线的位置，按从源端 ($x=0$) 到接收端 ($x=L$) 的顺序排列，$j = 1,2,\\dots,M$。分段长度约束为 $x_1 \\le L_\\mathrm{max}$，对于 $j \\ge 2$ 有 $x_j - x_{j-1} \\le L_\\mathrm{max}$，以及 $L - x_M \\le L_\\mathrm{max}$。\n3. 位于位置 $x$ 的单个跳线所引起的增量 Elmore 延迟，可近似为两项之和：增加的串联电阻 $r_v$ 乘以其下游总电容，以及增加的并联电容 $c_v$ 乘以其上游总电阻。对于多个跳线，通过将一个通孔之前的通孔电阻计入上游电阻，并将一个通孔之后的通孔电容计入下游电容，来捕捉相互作用。\n4. 到第 $j$ 个通孔的上游电阻为 $R_\\mathrm{up}(x_j) = R' x_j + r_v (j-1)$，其下游电容为 $C_\\mathrm{down}(x_j) = C' (L - x_j) + C_g + c_v (M - j)$。第 $j$ 个跳线的增量延迟贡献为 $\\Delta t_j = R_\\mathrm{up}(x_j) c_v + r_v C_\\mathrm{down}(x_j)$，因此所有跳线造成的总增量延迟为\n$$\n\\Delta t_\\mathrm{total} = \\sum_{j=1}^M \\left[ \\left( R' x_j + r_v (j-1) \\right) c_v + r_v \\left( C' (L - x_j) + C_g + c_v (M - j) \\right) \\right].\n$$\n5. 网络关键性权重 $w \\in [0,1]$ 与增量延迟相乘，形成需要最小化的加权成本 $w \\, \\Delta t_\\mathrm{total}$。\n6. 每个跳线所贡献的增量延迟，作为其位置 $x$ 的函数，是 $x$ 的一个仿射函数。其对 $x$ 的导数是一个常数，等于 $\\frac{d}{dx}\\Delta t_j = R' c_v - r_v C'$。因此，在满足分段长度不等式约束的前提下，最优位置会将每个跳线推向约束所允许的极端位置：\n   - 如果 $R' c_v - r_v C'  0$，将跳线移近接收端（$x$ 更大）会减小 $\\Delta t_j$，因此应选择尽可能大的可行位置。\n   - 如果 $R' c_v - r_v C' > 0$，将跳线移近源端（$x$ 更小）会减小 $\\Delta t_j$，因此应选择尽可能小的可行位置。\n   - 如果 $R' c_v - r_v C' = 0$，增量延迟与位置无关；任何满足分段约束的可行位置都会产生相同的增量成本。\n\n与不等式约束一致的极端可行位置是：\n- 对于 $R' c_v - r_v C'  0$，选择 $x_j = L - (M - j + 1) L_\\mathrm{max}$，$j = 1,2,\\dots,M$。\n- 对于 $R' c_v - r_v C' \\ge 0$，选择 $x_j = j L_\\mathrm{max}$，$j = 1,2,\\dots,M$。\n\n实现要求：\n- 实现一个算法，该算法对每个测试用例，计算 $M$，按上述方法计算位置 $\\{x_j\\}$，验证分段约束，并使用上面展示的包含相互作用的精确 Elmore 求和公式计算加权增量延迟 $w \\, \\Delta t_\\mathrm{total}$。\n- 最终延迟以皮秒为单位表示，并四舍五入到三位小数。位置必须以微米为单位报告，并四舍五入到三位小数。\n- 程序必须生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。每个测试用例的结果必须表示为一个列表：$[M, \\text{delay\\_ps}, [x_1,x_2,\\dots,x_M], \\text{compliant}]$，其中 $\\text{delay\\_ps}$ 是一个以皮秒为单位、保留三位小数的浮点数，$x_j$ 值是保留三位小数的浮点数（单位为微米），而 $\\text{compliant}$ 是一个布尔值，指示分区是否满足所有分段长度约束。\n\n单位：\n- 长度 $L$ 单位为 $\\mu\\mathrm{m}$。\n- 栅极面积 $A_g$ 单位为 $\\mu\\mathrm{m}^2$。\n- 允许的比率 $\\alpha_\\mathrm{max}$ 单位为 $\\mu\\mathrm{m}^{-1}$。\n- 单位长度电阻 $R'$ 单位为 $\\Omega/\\mu\\mathrm{m}$。\n- 单位长度电容 $C'$ 在输入时单位为 $\\mathrm{fF}/\\mu\\mathrm{m}$，计算时转换为 $\\mathrm{F}/\\mu\\mathrm{m}$。\n- 栅极电容 $C_g$ 在输入时单位为 $\\mathrm{fF}$，计算时转换为 $\\mathrm{F}$。\n- 通孔电阻 $r_v$ 单位为 $\\Omega$。\n- 通孔电容 $c_v$ 在输入时单位为 $\\mathrm{fF}$，计算时转换为 $\\mathrm{F}$。\n- 输出延迟单位为皮秒。\n\n测试套件：\n提供以下四个测试用例，以检验解决方案的不同方面：\n1. $R' c_v - r_v C'  0$ 的正常情况（跳线靠近接收端）：\n   - $w = 0.8$, $L = 1200$, $A_g = 0.10$, $\\alpha_\\mathrm{max} = 2000$, $R' = 0.05$, $C' = 0.2$, $C_g = 10$, $r_v = 3.0$, $c_v = 1.5$。\n2. $R' c_v - r_v C' = 0$ 的边界情况（增量成本与位置无关）：\n   - $w = 0.5$, $L = 150$, $A_g = 0.05$, $\\alpha_\\mathrm{max} = 2000$, $R' = 0.02$, $C' = 0.5$, $C_g = 5$, $r_v = 0.2$, $c_v = 5$。\n3. 无需跳线的情况（已满足规则）：\n   - $w = 0.6$, $L = 90$, $A_g = 0.08$, $\\alpha_\\mathrm{max} = 1500$, $R' = 0.04$, $C' = 0.25$, $C_g = 8$, $r_v = 1.0$, $c_v = 1.0$。\n4. $R' c_v - r_v C' > 0$ 的情况（跳线靠近源端）：\n   - $w = 0.9$, $L = 750$, $A_g = 0.20$, $\\alpha_\\mathrm{max} = 1000$, $R' = 0.10$, $C' = 0.05$, $C_g = 20$, $r_v = 0.5$, $c_v = 0.5$。\n\n测试套件中的所有数值均采用上述指定单位，其中 $C'$ 和 $c_v$ 分别以 $\\mathrm{fF}/\\mu\\mathrm{m}$ 和 $\\mathrm{fF}$ 为单位给出，并在内部计算时转换为 $\\mathrm{F}/\\mu\\mathrm{m}$ 和 $\\mathrm{F}$。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，每个测试用例的结果格式如前所述。例如，您的最终输出必须采用以下形式：$[[M_1,\\mathrm{delay\\_ps}_1,[x_{1,1},\\dots,x_{1,M_1}],\\mathrm{compliant}_1],[M_2,\\mathrm{delay\\_ps}_2,[\\dots],\\mathrm{compliant}_2],\\dots]$。",
            "solution": "问题陈述已经过仔细审查，并被确定为有效。该问题在科学上基于集成电路设计和电子设计自动化（EDA）的既定原则，特别是使用了一个简化但真实的一维模型来处理互连延迟（Elmore 延迟）和天线规则合规性。问题定义明确，提供了一套完整且一致的定义、公式和参数，从而可以推导出唯一且有意义的解。所有术语都有清晰的定义，目标也是可量化的。\n\n任务是开发一个算法，确定修复金属互连线上天线规则违规所需的最少跳线数量，并优化放置这些跳线，以最小化对信号时序的负面影响。时序惩罚通过加权的增量 Elmore 延迟来量化。\n\n解决方案是确定性的，并遵循指定的逻辑：\n\n1.  **单位转换**：所有输入参数首先被转换为一套一致的国际单位制基本单位（$\\Omega$、$\\mathrm{F}$、$\\mathrm{m}$）。具体来说，以飞法（$\\mathrm{fF}$）为单位的电容值通过乘以 $10^{-15}$ 转换为法拉（$\\mathrm{F}$），单位长度电容也以相同因子从 $\\mathrm{fF}/\\mu\\mathrm{m}$ 转换为 $\\mathrm{F}/\\mu\\mathrm{m}$。\n\n2.  **最大分段长度计算**：天线规则表示为最大允许的连续金属长度 $L_\\mathrm{max}$，由以下公式给出：\n    $$L_\\mathrm{max} = \\alpha_\\mathrm{max} A_g$$\n    其中 $\\alpha_\\mathrm{max}$ 是允许的最大天线比，而 $A_g$ 是所连接栅极的面积。\n\n3.  **跳线数量计算**：计算将总互连长度 $L$ 分割成不长于 $L_\\mathrm{max}$ 的段落所需的最少跳线数量 $M$。如果导线本身已合规（$L \\le L_\\mathrm{max}$），则不需要跳线，因此 $M=0$。否则，分段数量至少为 $L/L_\\mathrm{max}$。由于 $M$ 个跳线会产生 $M+1$ 个分段，最小的 $M$ 由以下公式给出：\n    $$M = \\lceil L/L_\\mathrm{max} \\rceil - 1$$\n\n4.  **跳线放置策略**：优化的核心在于将 $M$ 个跳线放置在位置 $\\{x_j\\}_{j=1}^M$ 上，以最小化总增量延迟 $\\Delta t_\\mathrm{total}$。问题指出，每个跳线贡献的增量延迟是其位置 $x_j$ 的仿射函数。该函数的斜率对所有跳线都是恒定的，并由判别式 $D$ 的符号决定：\n    $$D = R' c_v - r_v C'$$\n    其中 $R'$ 是单位长度电阻，$c_v$ 是通孔电容，$r_v$ 是通孔电阻，$C'$ 是单位长度电容。\n    - 如果 $D  0$，跳线的延迟贡献随着其位置 $x_j$ 的增加（向接收端移动）而减小。因此，在满足分段长度约束的前提下，所有跳线都应尽可能向下游放置。其位置由以下公式给出：\n      $$x_j = L - (M - j + 1) L_\\mathrm{max} \\quad \\text{for } j = 1, \\dots, M$$\n    - 如果 $D \\ge 0$，延迟贡献随着 $x_j$ 的减小（向源端移动）而减小。跳线应尽可能向上游放置。其位置由以下公式给出：\n      $$x_j = j L_\\mathrm{max} \\quad \\text{for } j = 1, \\dots, M$$\n\n5.  **增量延迟计算**：一旦确定了位置 $x_j$，通过对每个跳线的贡献求和来计算总增量 Elmore 延迟。考虑了跳线间相互作用的公式如下：\n    $$\n    \\Delta t_\\mathrm{total} = \\sum_{j=1}^M \\left[ \\left( R' x_j + r_v (j-1) \\right) c_v + r_v \\left( C' (L - x_j) + C_g + c_v (M - j) \\right) \\right]\n    $$\n    最终成本是加权延迟 $w \\Delta t_\\mathrm{total}$，其中 $w$ 是网络关键性权重。此延迟从秒转换为皮秒（$1\\,\\mathrm{ps} = 10^{-12}\\,\\mathrm{s}$）并进行四舍五入。\n\n6.  **约束验证**：计算出跳线位置后，执行一个验证步骤，以确保所有分段长度（包括从源端 $x=0$ 到 $x_1$ 的第一段，以及从 $x_M$ 到接收端 $x=L$ 的最后一段）都小于或等于 $L_\\mathrm{max}$。由于浮点数运算，此检查包含一个小的容差。结果是一个布尔值 `compliant` 标志。根据问题的构造，对于正确的实现，此检查应始终通过。\n\n7.  **输出格式化**：每个测试用例的结果被编译成指定的列表格式：$[M, \\text{delay\\_ps}, [\\text{positions}], \\text{compliant}]$，其中的数值四舍五入到三位小数。\n\n对每个提供的测试用例都实施了这一系统化程序。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the jumper insertion problem for a given set of test cases.\n    \"\"\"\n    test_cases = [\n        # Test Case 1: Happy path with R'cv - rvC'  0\n        {'w': 0.8, 'L': 1200, 'A_g': 0.10, 'alpha_max': 2000, 'R_prime': 0.05, 'C_prime': 0.2, 'C_g': 10, 'r_v': 3.0, 'c_v': 1.5},\n        # Test Case 2: Boundary case with R'cv - rvC' = 0\n        {'w': 0.5, 'L': 150, 'A_g': 0.05, 'alpha_max': 2000, 'R_prime': 0.02, 'C_prime': 0.5, 'C_g': 5, 'r_v': 0.2, 'c_v': 5},\n        # Test Case 3: No-jumper case (already compliant)\n        {'w': 0.6, 'L': 90, 'A_g': 0.08, 'alpha_max': 1500, 'R_prime': 0.04, 'C_prime': 0.25, 'C_g': 8, 'r_v': 1.0, 'c_v': 1.0},\n        # Test Case 4: Case with R'cv - rvC' > 0\n        {'w': 0.9, 'L': 750, 'A_g': 0.20, 'alpha_max': 1000, 'R_prime': 0.10, 'C_prime': 0.05, 'C_g': 20, 'r_v': 0.5, 'c_v': 0.5},\n    ]\n\n    results = []\n    for params in test_cases:\n        w = params['w']\n        L = params['L']\n        A_g = params['A_g']\n        alpha_max = params['alpha_max']\n        R_prime = params['R_prime']\n        \n        # Unit conversions from fF to F\n        C_prime_F = params['C_prime'] * 1e-15\n        C_g_F = params['C_g'] * 1e-15\n        r_v = params['r_v']\n        c_v_F = params['c_v'] * 1e-15\n\n        # Calculate max segment length\n        L_max = alpha_max * A_g\n\n        # Calculate number of jumpers M\n        if L = L_max:\n            M = 0\n        else:\n            M = int(np.ceil(L / L_max)) - 1\n\n        positions = []\n        total_delta_t = 0.0\n        \n        if M > 0:\n            # Determine placement strategy\n            determinant = R_prime * c_v_F - r_v * C_prime_F\n            \n            if determinant  0:\n                # Push jumpers towards sink (larger x)\n                for j in range(1, M + 1):\n                    pos = L - (M - j + 1) * L_max\n                    positions.append(pos)\n            else: # determinant >= 0\n                # Push jumpers towards source (smaller x)\n                for j in range(1, M + 1):\n                    pos = j * L_max\n                    positions.append(pos)\n            \n            # Calculate total incremental delay\n            for j_idx, x_j in enumerate(positions):\n                j = j_idx + 1\n                \n                R_up = R_prime * x_j + r_v * (j - 1)\n                C_down = C_prime_F * (L - x_j) + C_g_F + c_v_F * (M - j)\n                \n                delta_t_j = R_up * c_v_F + r_v * C_down\n                total_delta_t += delta_t_j\n\n        # Verify compliance\n        segment_points = [0.0] + positions + [L]\n        compliant = True\n        tolerance = 1e-9\n        for i in range(len(segment_points) - 1):\n            segment_length = segment_points[i+1] - segment_points[i]\n            if segment_length > L_max + tolerance:\n                compliant = False\n                break\n        \n        # In case M=0, the single segment is L. The check L=L_max already handled this.\n        if M == 0 and L > L_max: # Should not happen based on calculation of M\n            compliant = False\n        \n        # Calculate weighted delay in picoseconds and round\n        weighted_delay_s = w * total_delta_t\n        weighted_delay_ps = weighted_delay_s * 1e12\n        \n        # Round final results to 3 decimal places\n        final_delay = round(weighted_delay_ps, 3)\n        final_positions = [round(p, 3) for p in positions]\n        \n        results.append([M, final_delay, final_positions, compliant])\n    \n    # Format the final output string to match the required format exactly\n    # No spaces, standard list representation\n    final_output_str = str(results).replace(\" \", \"\")\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}