{
    "hands_on_practices": [
        {
            "introduction": "理论知识需要通过动手实践来巩固。本章节的练习将引导您从设计基础元件，到分析系统级完整性，最终到开发智能控制策略。第一个练习将聚焦于电源门控架构的核心——睡眠开关。它的电气特性至关重要，因为它既要足够强壮以快速唤醒电源域，又不能在工作期间引起过大的压降。本练习将指导您通过平衡瞬态唤醒时间和稳态电压完整性这两个相互竞争的需求，来确定睡眠开关的尺寸，并运用到诸如 Elmore 延迟等标准EDA建模技术 。",
            "id": "4290469",
            "problem": "在电子设计自动化（EDA）背景下，一个采用门控电源的互补金属氧化物半导体（CMOS）岛通过一个头睡眠开关由电压为 $V_{\\text{DD}}$ 的主电源轨供电。该开关的导通状态被建模为一个线性电阻 $R_{\\text{sw}}$。该岛的虚拟电源轨通过两个电源网格段进行分布，这两个网格段从睡眠开关向岛的更深区域串联，并被建模为电阻 $R_{1}$ 和 $R_{2}$。三个集总去耦电容连接到虚拟电源轨上逐渐深入的节点：$C_{1}$ 在紧随睡眠开关后的入口节点，$C_{2}$ 在网格段 $R_{1}$ 之后，以及 $C_{3}$ 在网格段 $R_{2}$ 之后。\n\n在时间 $t=0$ 唤醒时，睡眠开关闭合，主电源轨电压从 $0$ 阶跃至 $V_{\\text{DD}}$。要求虚拟电源轨在时间 $t_{s}$ 前达到至少 $V_{\\text{DD}}(1-\\epsilon)$，并且在稳态下，在恒定保持电流 $I_{\\text{ret}}$ 的作用下，主电源轨与虚拟电源轨之间的直流（DC）压降不得超过 $\\epsilon V_{\\text{DD}}$。使用 $R\\!C$ 树的 Elmore 延迟近似来为虚拟电源轨的瞬态稳定过程建模，并使用欧姆定律为稳态压降建模。\n\n给定以下参数：$V_{\\text{DD}}=0.8\\,\\text{V}$, $\\epsilon=0.01$, $t_{s}=10 \\times 10^{-9}\\,\\text{s}$, $I_{\\text{ret}}=5 \\times 10^{-3}\\,\\text{A}$, $R_{1}=0.02\\,\\Omega$, $R_{2}=0.03\\,\\Omega$, $C_{1}=10 \\times 10^{-9}\\,\\text{F}$, $C_{2}=20 \\times 10^{-9}\\,\\text{F}$, 以及 $C_{3}=15 \\times 10^{-9}\\,\\text{F}$，请确定能够同时满足瞬态和直流要求的最大允许睡眠开关电阻 $R_{\\text{sw}}$。将答案四舍五入至四位有效数字，并以欧姆为单位表示。",
            "solution": "$R\\!C$ 网络中虚拟电源轨的充电过程可以近似为一阶响应，其特征在于一个由 Elmore 延迟导出的有效时间常数。对于一个由源端阶跃信号激励的 $R\\!C$ 树，到根节点的 Elmore 延迟 $t_{E}$ 是冲激响应的一阶矩，其计算方法是：对每个电阻，将其阻值与该电阻下游的总电容相乘，然后将所有这些乘积相加。对于所描述的拓扑结构，从源到虚拟电源轨路径上的电阻为 $R_{\\text{sw}}$、$R_{1}$ 和 $R_{2}$，各段对应的下游电容为：\n- 对于 $R_{\\text{sw}}$：下游电容为 $C_{1}+C_{2}+C_{3}$。\n- 对于 $R_{1}$：下游电容为 $C_{2}+C_{3}$。\n- 对于 $R_{2}$：下游电容为 $C_{3}$。\n\n因此，Elmore 延迟为\n$$\nt_{E} \\;=\\; R_{\\text{sw}}\\,(C_{1}+C_{2}+C_{3}) \\;+\\; R_{1}\\,(C_{2}+C_{3}) \\;+\\; R_{2}\\,C_{3}.\n$$\n将虚拟电源轨的阶跃响应近似为 $v(t) = V_{\\text{DD}}\\bigl(1 - \\exp(-t/t_{E})\\bigr)$，则要求 $v(t_{s}) \\geq V_{\\text{DD}}(1-\\epsilon)$ 变为\n$$\n1 - \\exp\\!\\bigl(-t_{s}/t_{E}\\bigr) \\;\\geq\\; 1 - \\epsilon \\quad\\Longrightarrow\\quad \\exp\\!\\bigl(-t_{s}/t_{E}\\bigr) \\;\\leq\\; \\epsilon.\n$$\n取自然对数，\n$$\n-\\frac{t_{s}}{t_{E}} \\;\\leq\\; \\ln(\\epsilon) \\quad\\Longrightarrow\\quad t_{E} \\;\\leq\\; \\frac{t_{s}}{\\ln(1/\\epsilon)}.\n$$\n代入 Elmore 表达式并分离出 $R_{\\text{sw}}$，得到瞬态稳定边界\n$$\nR_{\\text{sw}} \\;\\leq\\; \\frac{\\dfrac{t_{s}}{\\ln(1/\\epsilon)} \\;-\\; R_{1}\\,(C_{2}+C_{3}) \\;-\\; R_{2}\\,C_{3}}{C_{1}+C_{2}+C_{3}}.\n$$\n\n另外，在电流 $I_{\\text{ret}}$ 下，主电源轨和虚拟电源轨之间的稳态直流压降由欧姆定律决定。从源端到虚拟电源轨的总串联电阻为 $R_{\\text{sw}} + R_{1} + R_{2}$，因此压降为\n$$\nV_{\\text{drop,dc}} \\;=\\; I_{\\text{ret}}\\,(R_{\\text{sw}} + R_{1} + R_{2}).\n$$\n要求 $V_{\\text{drop,dc}} \\leq \\epsilon V_{\\text{DD}}$ 得出直流边界\n$$\nI_{\\text{ret}}\\,(R_{\\text{sw}} + R_{1} + R_{2}) \\;\\leq\\; \\epsilon V_{\\text{DD}}\n\\quad\\Longrightarrow\\quad\nR_{\\text{sw}} \\;\\leq\\; \\frac{\\epsilon V_{\\text{DD}}}{I_{\\text{ret}}} \\;-\\; (R_{1} + R_{2}).\n$$\n\n最大允许的睡眠开关电阻是这两个边界中的最小值：\n$$\nR_{\\text{sw,max}} \\;=\\; \\min\\!\\left\\{\n\\frac{\\dfrac{t_{s}}{\\ln(1/\\epsilon)} \\;-\\; R_{1}\\,(C_{2}+C_{3}) \\;-\\; R_{2}\\,C_{3}}{C_{1}+C_{2}+C_{3}}\n\\;,\\;\n\\frac{\\epsilon V_{\\text{DD}}}{I_{\\text{ret}}} \\;-\\; (R_{1} + R_{2})\n\\right\\}.\n$$\n\n现在代入给定的数值。首先计算瞬态边界。所需的时间常数为\n$$\n\\frac{t_{s}}{\\ln(1/\\epsilon)} \\;=\\; \\frac{10 \\times 10^{-9}}{\\ln(100)} \\;\\approx\\; \\frac{10 \\times 10^{-9}}{4.605170186} \\;\\approx\\; 2.17147241 \\times 10^{-9}.\n$$\n来自 $R_{1}$ 和 $R_{2}$ 的恒定 Elmore 贡献为\n$$\nR_{1}(C_{2}+C_{3}) \\;+\\; R_{2}C_{3}\n\\;=\\; 0.02\\,(20 \\times 10^{-9} + 15 \\times 10^{-9}) \\;+\\; 0.03\\,(15 \\times 10^{-9})\n$$\n$$\n=\\; 0.02 \\times 35 \\times 10^{-9} \\;+\\; 0.03 \\times 15 \\times 10^{-9}\n\\;=\\; 0.7 \\times 10^{-9} \\;+\\; 0.45 \\times 10^{-9}\n\\;=\\; 1.15 \\times 10^{-9}.\n$$\n总电容为\n$$\nC_{1}+C_{2}+C_{3} \\;=\\; (10 + 20 + 15) \\times 10^{-9} \\;=\\; 45 \\times 10^{-9}.\n$$\n因此瞬态边界为\n$$\nR_{\\text{sw}} \\;\\leq\\; \\frac{2.17147241 \\times 10^{-9} \\;-\\; 1.15 \\times 10^{-9}}{45 \\times 10^{-9}}\n\\;=\\; \\frac{1.02147241 \\times 10^{-9}}{45 \\times 10^{-9}}\n\\;\\approx\\; 0.022699387.\n$$\n\n接下来计算直流边界：\n$$\n\\frac{\\epsilon V_{\\text{DD}}}{I_{\\text{ret}}} \\;-\\; (R_{1} + R_{2})\n\\;=\\; \\frac{0.01 \\times 0.8}{5 \\times 10^{-3}} \\;-\\; (0.02 + 0.03)\n\\;=\\; \\frac{0.008}{0.005} \\;-\\; 0.05\n\\;=\\; 1.6 \\;-\\; 0.05\n\\;=\\; 1.55.\n$$\n\n取最小值，\n$$\nR_{\\text{sw,max}} \\;=\\; \\min\\{\\,0.022699387\\,,\\,1.55\\,\\} \\;=\\; 0.022699387.\n$$\n四舍五入到四位有效数字并以欧姆为单位表示，最大允许的睡眠开关电阻为 $0.02270$。",
            "answer": "$$\\boxed{0.02270}$$"
        },
        {
            "introduction": "一个被门控的电源域并非真正完全隔离；意外的“潜行路径”可能会破坏其关断状态，导致漏电增加甚至功能失效。本练习将探讨一种经由I/O静电放电（ESD）保护二极管产生的常见潜行路径，要求您运用半导体器件物理知识来确定安全工作边界 。这项分析对于确保在复杂的SoC环境中低功耗设计的鲁棒性至关重要。",
            "id": "4290474",
            "problem": "考虑一个片上系统，其上有一个电源门控逻辑域，该域的本地电源轨表示为 $V_{\\text{off}}$。当门控关闭时，该域通过一个头开关与全局电源隔离，其电源轨 $V_{\\text{off}}$ 通过器件的总漏电和一个可建模为到地等效线性电导 $G_{\\text{off}}$ 的有意设置的泄放通路进行放电。该域共享一个输入/输出 (I/O) 焊盘，其静电放电 (ESD) 保护网络包含一个从焊盘节点（由一个常开模块驱动）连接到 $V_{\\text{off}}$ 的正向导通二极管。该 ESD 二极管由带有串联电阻的 Shockley 方程建模：二极管电流 $I_{\\text{D}}$ 作为二极管电压 $V_{\\text{D}}$ 的函数为 $I_{\\text{D}} = I_{s}\\left(\\exp\\!\\left(\\frac{V_{\\text{D}}}{n V_{T}}\\right)-1\\right)$，其中 $I_{s}$ 是反向饱和电流，$n$ 是理想因子，$V_{T} = \\frac{k_{B} T}{q}$ 是温度 $T$ 下的热电压（$k_{B}$ 是玻尔兹曼常数，$q$ 是元电荷）。串联电阻 $R_{s}$ 模拟了 ESD 器件和互连线中的非理想导电通路。二极管电压为 $V_{\\text{D}} = V_{\\text{IO}} - V_{\\text{off}} - I_{\\text{D}} R_{s}$，其中 $V_{\\text{IO}}$ 是由一个常开域驱动的焊盘电压。\n\n当通过 ESD 二极管的潜流通路将 $V_{\\text{off}}$ 抬高到足以偏置关闭域中的晶体管或干扰状态保持边界条件时，就会发生反向供电。假设在一个稳态条件下，$V_{\\text{off}}$ 已稳定下来，并且到 $V_{\\text{off}}$ 的唯一供电是流经 ESD 二极管的正向电流。从 Shockley 二极管方程和基尔霍夫电流定律 (KCL) 出发，推导一个不等式，该不等式确定了对于一个关闭域，何时 $V_{\\text{off}}$ 会超过设计者选择的安全上限 $V_{\\text{safe}}$。然后，推导出阈值 $V_{\\text{IO}}^{\\max}(V_{\\text{safe}})$ 的一个显式、闭合形式的表达式，使得在稳态下 $V_{\\text{off}} \\leq V_{\\text{safe}}$。使用此表达式计算在以下参数下 $V_{\\text{IO}}^{\\max}$ 的数值：\n- $G_{\\text{off}} = 2.0 \\times 10^{-3}\\,\\mathrm{S}$,\n- $I_{s} = 1.0 \\times 10^{-12}\\,\\mathrm{A}$,\n- $n = 1.6$,\n- $R_{s} = 3.0\\,\\Omega$,\n- $V_{\\text{safe}} = 2.0 \\times 10^{-1}\\,\\mathrm{V}$,\n- $T = 3.0 \\times 10^{2}\\,\\mathrm{K}$, $k_{B} = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$，以及 $q = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$。\n\n基于推导出的条件，为具有状态保持要求的电源门控域构建具有物理合理性的设计规则，以防止通过 I/O 或 ESD 二极管发生意外的反向供电。将 $V_{\\text{IO}}^{\\max}$ 的最终数值答案四舍五入至四位有效数字，并以 $\\mathrm{V}$ 为单位表示。",
            "solution": "### 求解推导\n问题的核心是求出电源门控域的稳态电压 $V_{\\text{off}}$。在稳态下，流入 $V_{\\text{off}}$ 节点的电流必须等于流出该节点的电流。唯一的电流源是 ESD 二极管 ($I_{\\text{D}}$)，唯一的电流沉是到地的漏电通路。\n\n在 $V_{\\text{off}}$ 节点应用基尔霍夫电流定律 (KCL)：\n$$I_{\\text{in}} = I_{\\text{out}}$$\n流入节点的电流是二极管电流 $I_{\\text{D}}$。流出的电流通过到地的等效漏电电导 $G_{\\text{off}}$，其值为 $I_{\\text{leak}} = G_{\\text{off}} V_{\\text{off}}$。\n因此，KCL 方程为：\n$$I_{\\text{D}} = G_{\\text{off}} V_{\\text{off}}$$\n\n二极管电流 $I_{\\text{D}}$ 由 Shockley 方程给出，其中理想二极管结两端的电压 $V_{\\text{D}}$ 因串联电阻 $R_{s}$ 上的电压降而减小。\n$$I_{\\text{D}} = I_{s}\\left(\\exp\\!\\left(\\frac{V_{\\text{D}}}{n V_{T}}\\right)-1\\right)$$\n$$V_{\\text{D}} = V_{\\text{IO}} - V_{\\text{off}} - I_{\\text{D}} R_{s}$$\n\n我们可以将 KCL 结果 $I_{\\text{D}} = G_{\\text{off}} V_{\\text{off}}$ 代入 $V_{\\text{D}}$ 的方程中：\n$$V_{\\text{D}} = V_{\\text{IO}} - V_{\\text{off}} - (G_{\\text{off}} V_{\\text{off}}) R_{s}$$\n$$V_{\\text{D}} = V_{\\text{IO}} - V_{\\text{off}}(1 + G_{\\text{off}} R_{s})$$\n\n现在，将 $V_{\\text{D}}$ 的这个表达式和 $I_{\\text{D}}$ 的 KCL 结果代入 Shockley 方程：\n$$G_{\\text{off}} V_{\\text{off}} = I_{s}\\left(\\exp\\!\\left(\\frac{V_{\\text{IO}} - V_{\\text{off}}(1 + G_{\\text{off}} R_{s})}{n V_{T}}\\right)-1\\right)$$\n这个超越方程定义了外部 I/O 电压 $V_{\\text{IO}}$ 和内部电源轨电压 $V_{\\text{off}}$ 之间的稳态关系。\n\n#### $V_{\\text{off}}  V_{\\text{safe}}$ 不等式的推导\n电压 $V_{\\text{off}}$ 是 $V_{\\text{IO}}$ 的一个单调递增函数。因此，条件 $V_{\\text{off}}  V_{\\text{safe}}$ 对应于 $V_{\\text{IO}}$ 超过某个阈值 $V_{\\text{IO}}^{\\max}$。该阈值是导致 $V_{\\text{off}} = V_{\\text{safe}}$ 的 $V_{\\text{IO}}$ 值。为了确定何时 $V_{\\text{off}}  V_{\\text{safe}}$，我们分析流入 $V_{\\text{off}}$ 节点的净电流。如果对于给定的 $V_{\\text{IO}}$，在 $V_{\\text{off}} = V_{\\text{safe}}$ 时提供的二极管电流大于被漏电通路吸收的电流，即 $I_{\\text{D}}(V_{\\text{off}}=V_{\\text{safe}})  G_{\\text{off}} V_{\\text{safe}}$，那么电压必须上升到 $V_{\\text{safe}}$ 之上以找到新的平衡点。代入 $I_{\\text{D}}$ 的表达式得到不等式：\n$$I_{s}\\left(\\exp\\!\\left(\\frac{V_{\\text{IO}} - V_{\\text{safe}}(1 + G_{\\text{off}} R_{s})}{n V_{T}}\\right)-1\\right)  G_{\\text{off}} V_{\\text{safe}}$$\n这个不等式确定了何时来自 $V_{\\text{IO}}$ 的反向供电足以将 $V_{\\text{off}}$ 提高到指定的安全限值 $V_{\\text{safe}}$ 以上。\n\n#### $V_{\\text{IO}}^{\\max}(V_{\\text{safe}})$ 表达式的推导\n最大允许 I/O 电压 $V_{\\text{IO}}^{\\max}$ 可通过在稳态方程中设置 $V_{\\text{off}} = V_{\\text{safe}}$ 来找到，这对应于不等式的边界条件。\n$$G_{\\text{off}} V_{\\text{safe}} = I_{s}\\left(\\exp\\!\\left(\\frac{V_{\\text{IO}}^{\\max} - V_{\\text{safe}}(1 + G_{\\text{off}} R_{s})}{n V_{T}}\\right)-1\\right)$$\n我们现在求解 $V_{\\text{IO}}^{\\max}$：\n$$\\frac{G_{\\text{off}} V_{\\text{safe}}}{I_{s}} + 1 = \\exp\\!\\left(\\frac{V_{\\text{IO}}^{\\max} - V_{\\text{safe}}(1 + G_{\\text{off}} R_{s})}{n V_{T}}\\right)$$\n对两边取自然对数：\n$$\\ln\\left(\\frac{G_{\\text{off}} V_{\\text{safe}}}{I_{s}} + 1\\right) = \\frac{V_{\\text{IO}}^{\\max} - V_{\\text{safe}}(1 + G_{\\text{off}} R_{s})}{n V_{T}}$$\n乘以 $n V_{T}$：\n$$n V_{T} \\ln\\left(\\frac{G_{\\text{off}} V_{\\text{safe}}}{I_{s}} + 1\\right) = V_{\\text{IO}}^{\\max} - V_{\\text{safe}}(1 + G_{\\text{off}} R_{s})$$\n最后，分离出 $V_{\\text{IO}}^{\\max}$ 得到显式、闭合形式的表达式：\n$$V_{\\text{IO}}^{\\max} = V_{\\text{safe}}(1 + G_{\\text{off}} R_{s}) + n V_{T} \\ln\\left(\\frac{G_{\\text{off}} V_{\\text{safe}}}{I_{s}} + 1\\right)$$\n\n#### $V_{\\text{IO}}^{\\max}$ 的数值计算\n首先，我们计算热电压 $V_{T}$：\n$$V_{T} = \\frac{k_{B} T}{q} = \\frac{(1.380649 \\times 10^{-23}\\,\\text{J/K})(3.0 \\times 10^{2}\\,\\text{K})}{1.602176634 \\times 10^{-19}\\,\\text{C}} \\approx 0.025852\\,\\text{V}$$\n接下来，我们使用给定参数计算 $V_{\\text{IO}}^{\\max}$ 表达式中的各项：\n-   $V_{\\text{safe}} = 0.2\\,\\text{V}$\n-   $G_{\\text{off}} = 2.0 \\times 10^{-3}\\,\\text{S}$\n-   $R_{s} = 3.0\\,\\Omega$\n-   $n = 1.6$\n-   $I_{s} = 1.0 \\times 10^{-12}\\,\\text{A}$\n\n第一项是：\n$$V_{\\text{safe}}(1 + G_{\\text{off}} R_{s}) = (0.2\\,\\text{V}) \\times (1 + (2.0 \\times 10^{-3}\\,\\text{S})(3.0\\,\\Omega)) = (0.2\\,\\text{V}) \\times (1.006) = 0.2012\\,\\text{V}$$\n对于第二项，我们首先计算对数的参数：\n$$\\frac{G_{\\text{off}} V_{\\text{safe}}}{I_{s}} + 1 = \\frac{(2.0 \\times 10^{-3}\\,\\text{S})(0.2\\,\\text{V})}{1.0 \\times 10^{-12}\\,\\text{A}} + 1 = \\frac{4.0 \\times 10^{-4}\\,\\text{A}}{1.0 \\times 10^{-12}\\,\\text{A}} + 1 = 4.0 \\times 10^{8} + 1$$\n那么第二项是：\n$$n V_{T} \\ln\\left(4.0 \\times 10^{8} + 1\\right) \\approx (1.6) \\times (0.025852\\,\\text{V}) \\times \\ln(4.0 \\times 10^{8})$$\n$$ \\approx (0.041363\\,\\text{V}) \\times (19.807) \\approx 0.81923\\,\\text{V}$$\n两项相加：\n$$V_{\\text{IO}}^{\\max} = 0.2012\\,\\text{V} + 0.81923\\,\\text{V} = 1.02043\\,\\text{V}$$\n按要求四舍五入至四位有效数字：\n$$V_{\\text{IO}}^{\\max} \\approx 1.020\\,\\text{V}$$\n\n#### 具有物理合理性的设计规则\n推导出的 $V_{\\text{IO}}^{\\max}$ 表达式为缓解反向供电的设计策略提供了见解。为了最大化对来自常开域的高 $V_{\\text{IO}}$ 的容忍度，必须最大化 $V_{\\text{IO}}^{\\max}$。\n$$V_{\\text{IO}}^{\\max} = V_{\\text{safe}}(1 + G_{\\text{off}} R_{s}) + n V_{T} \\ln\\left(\\frac{G_{\\text{off}} V_{\\text{safe}}}{I_{s}} + 1\\right)$$\n对该方程的分析得出以下设计规则：\n1.  **增加关断态漏电 ($G_{\\text{off}}$)**：$V_{\\text{IO}}^{\\max}$ 的值随 $G_{\\text{off}}$ 的增大而增大。更大的 $G_{\\text{off}}$ 对应于门控域到地的更低阻抗通路。该通路分流更多来自 ESD 二极管的潜电流，防止 $V_{\\text{off}}$ 电源轨浮动到高电压。在实践中，设计者可以添加显式的“泄放”电阻或使用漏电维持单元来增加 $G_{\\text{off}}$。\n2.  **增加 ESD 二极管串联电阻 ($R_{s}$)**：$V_{\\text{IO}}^{\\max}$ 随 $R_{s}$ 的增大而增大。对于给定电流，更大的 $R_{s}$ 会在二极管的电阻部分引起更大的电压降。这降低了有源 p-n 结两端的电压，从而减小了在给定外部电压 $V_{\\text{IO}}$ 下的正向偏置电流。这可以通过增加路径长度的物理版图技术或为二极管结构使用电阻率更高的材料来实现。\n3.  **减小 ESD 二极管饱和电流 ($I_{s}$)**：$V_{\\text{IO}}^{\\max}$ 随 $I_{s}$ 的减小而增大。更小的 $I_{s}$ 对应于在给定正向电压下传导更少电流的二极管。这通常通过使用更小的 ESD 二极管来实现，但其权衡是可能导致更低的 ESD 保护水平。\n4.  **系统级电压管理**：最直接的规则是确保任何驱动共享 I/O 的常开域的输出电压 $V_{\\text{IO}}$ 始终小于计算出的 $V_{\\text{IO}}^{\\max}$。这可能需要电平转换器或仔细划分电源域。\n5.  **最坏情况分析**：项 $V_{T} = k_{B}T/q$ 表明 $V_{\\text{IO}}^{\\max}$ 在较低温度下会减小。这是因为二极管在低温下“导通”得更急剧。因此，所有反向供电分析都必须在规定的最低工作温度下进行，以确保在最坏情况下的安全运行。",
            "answer": "$$\\boxed{1.020}$$"
        },
        {
            "introduction": "决定“何时”进行电源门控与“如何”实现它同等重要，因为错误的决策可能比节省的能量浪费更多。这项高级练习将挑战您超越静态设计的局限，基于系统工作负载的马尔可夫链模型，来开发一种动态的预测性控制策略 。通过对预测错误进行建模，您将分析节能量与不稳定的“抖动”行为风险之间的权衡，这是现代自适应电源管理的一个关键方面。",
            "id": "4290447",
            "problem": "您的任务是在电子设计自动化 (EDA) 的背景下，为一个数字域设计并分析一个运行时电源门控策略。该域在活动状态和空闲状态之间交替。工作负载行为被建模为一个具有两个状态（活动和空闲）的时间均匀的离散时间马尔可夫链。令 $W_t \\in \\{\\mathrm{A},\\mathrm{I}\\}$ 表示在离散时间步 $t$ 的工作负载状态。马尔可夫链的转移概率为：$\\mathbb{P}(W_{t+1}=\\mathrm{I}\\mid W_t=\\mathrm{A})=p_{AI}$ 和 $\\mathbb{P}(W_{t+1}=\\mathrm{A}\\mid W_t=\\mathrm{I})=p_{IA}$。电源门控控制器可以将该域关闭（OFF，带状态保持）或保持开启（ON）。状态保持确保在关闭期间逻辑状态得以保留，但这会产生状态保持泄漏能量成本。\n\n基本假设和定义：\n- 空闲状态下的一个运行长度定义为连续的空闲步数，直到下一次转换到活动状态；在马尔可夫模型下，该空闲运行长度服从参数为 $p_{IA}$ 的几何分布，其期望值为 $1/p_{IA}$ 步。\n- 类似地，活动运行长度服从参数为 $p_{AI}$ 的几何分布，其期望值为 $1/p_{AI}$ 步。\n- 在空闲状态下开启时，每步能量为泄漏能量 $L_{\\mathrm{on}}$（焦耳/步）。在活动状态下开启时，每步能量为动态能量加泄漏能量，$D + L_{\\mathrm{on}}$（焦耳/步）。带状态保持的关闭状态下，每步能量为 $L_{\\mathrm{ret}}$（焦耳/步）。电源门控在关闭时会产生门控开销能量 $E_g$（焦耳/事件），在开启时会产生唤醒开销能量 $E_w$（焦耳/事件）。\n- 盈亏平衡条件是最小的空闲运行长度（以步为单位），当超过该长度时，门控会产生非负的净能量收益。该条件通过比较门控和唤醒开销与运行期间开启状态泄漏能量和状态保持泄漏能量之差得出。令这个最小步数表示为 $B$，需从给定参数中推导。\n\n策略和预测误差模型：\n- 在每个空闲运行开始时，预测器会将其分类：如果预测该运行将持续至少 $B$ 步，则为“长”运行，否则为“短”运行。\n- 如果运行实际上是长的（长度 $\\ge B$），预测器可能以概率 $\\varepsilon_{\\mathrm{FN}}$（假阴性）未能进行门控；否则，它以概率 $1 - \\varepsilon_{\\mathrm{FN}}$ 进行门控。\n- 如果运行实际上是短的（长度 $ B$），预测器可能以概率 $\\varepsilon_{\\mathrm{FP}}$（假阳性）错误地进行门控；否则，它以概率 $1 - \\varepsilon_{\\mathrm{FP}}$ 不进行门控。\n- 当一个运行被门控时，控制器在空闲运行开始时关闭电源，并在该空闲运行结束、状态转换到活动状态时唤醒并开启电源。在活动运行期间不执行门控。\n\n目标：\n- 基于上述基础，推导该策略下每步的期望能量，并与从不进行门控（始终开启）的基线进行比较。计算每步的期望能量节省，以焦耳/步为单位表示。\n- 定义一个稳定性度量，即每步的电源状态切换期望次数。每个被门控的空闲运行恰好引起 2 次切换（一次门控和一次唤醒）。如果此切换率小于或等于给定的阈值 $\\tau_{\\max}$（单位为切换次数/步），则系统被认为是稳定的。以布尔值输出稳定性。\n- 您必须从马尔可夫链和几何分布的第一性原理出发，推导出 $B$ 以及所有必需的概率和期望值，而不能使用问题陈述中提供的快捷公式。\n\n所需输出：\n- 对于每个测试用例，生成一个包含两个元素的列表：每步的期望能量节省（焦耳，一个浮点数）和稳定性布尔值（稳定则为 true，否则为 false）。\n- 将每步的期望能量节省表示为焦耳/步的浮点数，输出中不带单位符号。稳定性必须是布尔值。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，并且本身是一个包含两个元素的列表，顺序为 $\\left[\\text{每步能量节省}, \\text{稳定性布尔值}\\right]$。\n\n测试套件：\n为以下参数集提供结果。所有能量单位为焦耳，每步能量单位为焦耳/步。所有错误概率均为无量纲。\n\n- 案例 1 (理想情况):\n  - $p_{IA} = 0.05$, $p_{AI} = 0.10$\n  - $L_{\\mathrm{on}} = 2 \\times 10^{-6}$, $L_{\\mathrm{ret}} = 0.2 \\times 10^{-6}$, $D = 5 \\times 10^{-6}$\n  - $E_g = 10 \\times 10^{-6}$, $E_w = 12 \\times 10^{-6}$\n  - $\\varepsilon_{\\mathrm{FP}} = 0.05$, $\\varepsilon_{\\mathrm{FN}} = 0.10$\n  - $\\tau_{\\max} = 0.04$\n\n- 案例 2 (高假阳性，可能产生抖动):\n  - $p_{IA} = 0.20$, $p_{AI} = 0.20$\n  - $L_{\\mathrm{on}} = 2 \\times 10^{-6}$, $L_{\\mathrm{ret}} = 0.5 \\times 10^{-6}$, $D = 6 \\times 10^{-6}$\n  - $E_g = 8 \\times 10^{-6}$, $E_w = 8 \\times 10^{-6}$\n  - $\\varepsilon_{\\mathrm{FP}} = 0.60$, $\\varepsilon_{\\mathrm{FN}} = 0.10$\n  - $\\tau_{\\max} = 0.10$\n\n- 案例 3 (完美预测器):\n  - $p_{IA} = 0.10, p_{AI} = 0.05$\n  - $L_{\\mathrm{on}} = 3 \\times 10^{-6}, L_{\\mathrm{ret}} = 0.3 \\times 10^{-6}, D = 7 \\times 10^{-6}$\n  - $E_g = 12 \\times 10^{-6}, E_w = 10 \\times 10^{-6}$\n  - $\\varepsilon_{\\mathrm{FP}} = 0.0, \\varepsilon_{\\mathrm{FN}} = 0.0$\n  - $\\tau_{\\max} = 0.03$\n\n- 案例 4 (泄漏功耗差异不大，盈亏平衡点非常大):\n  - $p_{IA} = 0.05, p_{AI} = 0.05$\n  - $L_{\\mathrm{on}} = 0.5 \\times 10^{-6}, L_{\\mathrm{ret}} = 0.49 \\times 10^{-6}, D = 8 \\times 10^{-6}$\n  - $E_g = 2 \\times 10^{-6}, E_w = 2 \\times 10^{-6}$\n  - $\\varepsilon_{\\mathrm{FP}} = 0.10, \\varepsilon_{\\mathrm{FN}} = 0.10$\n  - $\\tau_{\\max} = 0.02$\n\n- 案例 5 (极短的空闲运行):\n  - $p_{IA} = 0.80, p_{AI} = 0.20$\n  - $L_{\\mathrm{on}} = 2 \\times 10^{-6}, L_{\\mathrm{ret}} = 0.2 \\times 10^{-6}, D = 5 \\times 10^{-6}$\n  - $E_g = 3 \\times 10^{-6}, E_w = 3 \\times 10^{-6}$\n  - $\\varepsilon_{\\mathrm{FP}} = 0.02, \\varepsilon_{\\mathrm{FN}} = 0.10$\n  - $\\tau_{\\max} = 0.05$",
            "solution": "该问题要求为一个应用于数字域的电源门控策略，推导其每步的期望能量节省和一个稳定性度量。该分析基于工作负载状态的离散时间马尔可夫链模型。\n\n分析的核心将利用更新理论，其中一个周期定义为一个完整的活动运行后跟一个空闲运行的序列。我们将计算这样一个周期内的期望能量和事件计数，然后通过期望周期时长进行归一化，以求得每步的平均值。\n\n**1. 马尔可夫链和更新周期属性**\n\n工作负载状态 $W_t$ 服从一个具有状态 $\\{\\mathrm{A}, \\mathrm{I}\\}$ 的双态马尔可夫链。转移概率给定为 $p_{AI} = \\mathbb{P}(W_{t+1}=\\mathrm{I}\\mid W_t=\\mathrm{A})$ 和 $p_{IA} = \\mathbb{P}(W_{t+1}=\\mathrm{A}\\mid W_t=\\mathrm{I})$。\n\n在给定状态下的运行持续时间服从几何分布。\n-   活动运行的长度 $L_A$ 是一个成功概率为 $p_{AI}$ 的几何随机变量。其概率质量函数为 $\\mathbb{P}(L_A=k) = (1-p_{AI})^{k-1}p_{AI}$，其中 $k \\ge 1$。期望长度为 $\\mathbb{E}[L_A] = 1/p_{AI}$。\n-   空闲运行的长度 $L_I$ 是一个成功概率为 $p_{IA}$ 的几何随机变量。其概率质量函数为 $\\mathbb{P}(L_I=k) = (1-p_{IA})^{k-1}p_{IA}$，其中 $k \\ge 1$。期望长度为 $\\mathbb{E}[L_I] = 1/p_{IA}$。\n\n一个更新周期由一次活动运行和随之而来的一次空闲运行组成。一个周期的期望长度是期望运行长度之和：\n$$ \\mathbb{E}[L_{\\text{cycle}}] = \\mathbb{E}[L_A] + \\mathbb{E}[L_I] = \\frac{1}{p_{AI}} + \\frac{1}{p_{IA}} $$\n\n处于活动状态的稳态概率 $\\pi_A$ 和空闲状态的稳态概率 $\\pi_I$ 可以通过平衡方程 $\\pi_A p_{AI} = \\pi_I p_{IA}$ 和归一化条件 $\\pi_A + \\pi_I = 1$ 求得。这得到：\n$$ \\pi_A = \\frac{p_{IA}}{p_{AI} + p_{IA}}, \\quad \\pi_I = \\frac{p_{AI}}{p_{AI} + p_{IA}} $$\n这些代表了在每个状态下花费时间的长期比例，并且与基于周期的观点一致：$\\pi_A = \\mathbb{E}[L_A] / \\mathbb{E}[L_{\\text{cycle}}]$ 和 $\\pi_I = \\mathbb{E}[L_I] / \\mathbb{E}[L_{\\text{cycle}}]$。\n\n**2. 盈亏平衡点 ($B$) 的推导**\n\n盈亏平衡点 $B$ 是电源门控能够提供非负能量收益的最小空闲运行长度。对于一个长度为 $k$ 步的空闲运行：\n- 保持开启时的能量：$E_{\\text{on}}(k) = k \\cdot L_{\\mathrm{on}}$。\n- 进行门控关闭时的能量：$E_{\\text{off}}(k) = k \\cdot L_{\\mathrm{ret}} + E_g + E_w$。\n\n能量节省为 $\\Delta E(k) = E_{\\text{on}}(k) - E_{\\text{off}}(k) = k(L_{\\mathrm{on}} - L_{\\mathrm{ret}}) - (E_g + E_w)$。\n为了获得非负收益，我们需要 $\\Delta E(k) \\ge 0$。假设 $L_{\\mathrm{on}}  L_{\\mathrm{ret}}$（否则从每步来看门控永远没有好处），我们解出 $k$：\n$$ k(L_{\\mathrm{on}} - L_{\\mathrm{ret}}) \\ge E_g + E_w \\implies k \\ge \\frac{E_g + E_w}{L_{\\mathrm{on}} - L_{\\mathrm{ret}}} $$\n由于 $k$ 必须是整数，满足此条件的最小步数 $B$ 是该表达式向上取整的值：\n$$ B = \\left\\lceil \\frac{E_g + E_w}{L_{\\mathrm{on}} - L_{\\mathrm{ret}}} \\right\\rceil $$\n\n**3. 每步的期望能量节省**\n\n每步的期望能量节省是每个周期的期望能量节省除以期望周期长度。节省只在空闲运行期间发生。因此，每个周期的期望节省量就是单次空闲运行的期望能量节省量。\n\n令 $I_{\\text{gate}}$ 为一个指示随机变量，如果一个空闲运行被门控，则为 1，否则为 0。长度为 $L_I$ 的空闲运行的能量节省为 $\\Delta E(L_I) = I_{\\text{gate}} \\cdot [L_I(L_{\\mathrm{on}} - L_{\\mathrm{ret}}) - (E_g + E_w)]$。每次运行（即每个周期）的期望节省量为：\n$$ \\mathbb{E}[\\Delta E_{\\text{run}}] = \\mathbb{E}[I_{\\text{gate}} \\cdot L_I](L_{\\mathrm{on}} - L_{\\mathrm{ret}}) - \\mathbb{E}[I_{\\text{gate}}](E_g + E_w) $$\n这里，$\\mathbb{E}[I_{\\text{gate}}] = P(\\text{gate})$。\n\n门控的概率取决于运行是“长” ($L_I \\ge B$) 还是“短” ($L_I  B$) 。\n长运行的概率是：\n$$ P(\\text{long}) = \\mathbb{P}(L_I \\ge B) = \\sum_{k=B}^{\\infty} (1-p_{IA})^{k-1}p_{IA} = (1-p_{IA})^{B-1} $$\n根据全概率定律，门控一个空闲运行的总概率为：\n$$ P(\\text{gate}) = P(\\text{gate}|\\text{long})P(\\text{long}) + P(\\text{gate}|\\text{short})P(\\text{short}) $$\n$$ P(\\text{gate}) = (1-\\varepsilon_{\\mathrm{FN}})(1-p_{IA})^{B-1} + \\varepsilon_{\\mathrm{FP}}(1 - (1-p_{IA})^{B-1}) $$\n\n接下来，我们计算 $\\mathbb{E}[I_{\\text{gate}} \\cdot L_I]$。使用全期望定律：\n$$ \\mathbb{E}[L_I \\cdot I_{\\text{gate}}] = \\mathbb{E}[\\mathbb{E}[L_I \\cdot I_{\\text{gate}}|L_I]] = \\mathbb{E}[L_I \\cdot \\mathbb{E}[I_{\\text{gate}}|L_I]] $$\n内部的期望 $\\mathbb{E}[I_{\\text{gate}}|L_I=k]$ 是对于长度为 $k$ 的运行进行门控的概率：如果 $k \\ge B$，则为 $1-\\varepsilon_{\\mathrm{FN}}$；如果 $k  B$，则为 $\\varepsilon_{\\mathrm{FP}}$。\n$$ \\mathbb{E}[L_I \\cdot I_{\\text{gate}}] = \\sum_{k=1}^{B-1} k \\cdot \\varepsilon_{\\mathrm{FP}} \\cdot \\mathbb{P}(L_I=k) + \\sum_{k=B}^{\\infty} k \\cdot (1-\\varepsilon_{\\mathrm{FN}}) \\cdot \\mathbb{P}(L_I=k) $$\n令 $E_S(B) = \\sum_{k=1}^{B-1} k \\cdot \\mathbb{P}(L_I=k)$ 且 $E_L(B) = \\sum_{k=B}^{\\infty} k \\cdot \\mathbb{P}(L_I=k)$。那么 $\\mathbb{E}[L_I \\cdot I_{\\text{gate}}] = \\varepsilon_{\\mathrm{FP}} E_S(B) + (1-\\varepsilon_{\\mathrm{FN}}) E_L(B)$。\n注意 $E_S(B) + E_L(B) = \\mathbb{E}[L_I] = 1/p_{IA}$。\n截断和 $E_S(B)$ 可以使用有限算术-几何级数的求和公式计算，得到：\n$$ E_S(B) = \\sum_{k=1}^{B-1} k \\cdot p_{IA}(1-p_{IA})^{k-1} = \\frac{1-(1-p_{IA})^{B-1}}{p_{IA}} - (B-1)(1-p_{IA})^{B-1} $$\n然后 $E_L(B)$ 就是 $E_L(B) = 1/p_{IA} - E_S(B)$。\n\n每次运行的期望能量节省为：\n$$ E_{\\text{savings\\_run}} = (L_{\\mathrm{on}} - L_{\\mathrm{ret}})(\\varepsilon_{\\mathrm{FP}} E_S(B) + (1-\\varepsilon_{\\mathrm{FN}}) E_L(B)) - (E_g + E_w)P(\\text{gate}) $$\n最后，每步的期望能量节省是将该值按周期长度归一化：\n$$ E_{\\text{savings\\_step}} = \\frac{E_{\\text{savings\\_run}}}{\\mathbb{E}[L_{\\text{cycle}}]} = \\frac{E_{\\text{savings\\_run}}}{1/p_{AI} + 1/p_{IA}} $$\n\n**4. 稳定性度量**\n\n稳定性度量是每步的电源状态切换期望次数。一个被门控的空闲运行涉及一次关闭转换（门控）和一次开启转换（唤醒），总共 2 次切换。\n每个周期的期望切换次数是门控一个空闲运行概率的 2 倍：\n$$ \\mathbb{E}[\\text{toggles per cycle}] = 2 \\cdot P(\\text{gate}) $$\n切换率 $\\mathcal{T}$，单位为切换次数/步，是每个周期的期望切换次数除以期望周期长度：\n$$ \\mathcal{T} = \\frac{2 \\cdot P(\\text{gate})}{\\mathbb{E}[L_{\\text{cycle}}]} = \\frac{2 \\cdot P(\\text{gate})}{1/p_{AI} + 1/p_{IA}} $$\n如果该速率不超过给定的阈值 $\\tau_{\\max}$，则系统被认为是稳定的：\n$$ \\text{Stability} \\iff \\mathcal{T} \\le \\tau_{\\max} $$\n至此完成了解决该问题所需的推导。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the power-gating analysis problem for a set of test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path)\n        {\n            \"p_ia\": 0.05, \"p_ai\": 0.10,\n            \"l_on\": 2e-6, \"l_ret\": 0.2e-6, \"d\": 5e-6,\n            \"e_g\": 10e-6, \"e_w\": 12e-6,\n            \"eps_fp\": 0.05, \"eps_fn\": 0.10,\n            \"tau_max\": 0.04\n        },\n        # Case 2 (high false positives, potential chattering)\n        {\n            \"p_ia\": 0.20, \"p_ai\": 0.20,\n            \"l_on\": 2e-6, \"l_ret\": 0.5e-6, \"d\": 6e-6,\n            \"e_g\": 8e-6, \"e_w\": 8e-6,\n            \"eps_fp\": 0.60, \"eps_fn\": 0.10,\n            \"tau_max\": 0.10\n        },\n        # Case 3 (perfect predictor)\n        {\n            \"p_ia\": 0.10, \"p_ai\": 0.05,\n            \"l_on\": 3e-6, \"l_ret\": 0.3e-6, \"d\": 7e-6,\n            \"e_g\": 12e-6, \"e_w\": 10e-6,\n            \"eps_fp\": 0.0, \"eps_fn\": 0.0,\n            \"tau_max\": 0.03\n        },\n        # Case 4 (near-indifferent leakage, break-even very large)\n        {\n            \"p_ia\": 0.05, \"p_ai\": 0.05,\n            \"l_on\": 0.5e-6, \"l_ret\": 0.49e-6, \"d\": 8e-6,\n            \"e_g\": 2e-6, \"e_w\": 2e-6,\n            \"eps_fp\": 0.10, \"eps_fn\": 0.10,\n            \"tau_max\": 0.02\n        },\n        # Case 5 (very short idle runs)\n        {\n            \"p_ia\": 0.80, \"p_ai\": 0.20,\n            \"l_on\": 2e-6, \"l_ret\": 0.2e-6, \"d\": 5e-6,\n            \"e_g\": 3e-6, \"e_w\": 3e-6,\n            \"eps_fp\": 0.02, \"eps_fn\": 0.10,\n            \"tau_max\": 0.05\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        p_ia = case[\"p_ia\"]\n        p_ai = case[\"p_ai\"]\n        l_on = case[\"l_on\"]\n        l_ret = case[\"l_ret\"]\n        e_g = case[\"e_g\"]\n        e_w = case[\"e_w\"]\n        eps_fp = case[\"eps_fp\"]\n        eps_fn = case[\"eps_fn\"]\n        tau_max = case[\"tau_max\"]\n\n        # 1. Calculate break-even point B\n        delta_l = l_on - l_ret\n        if delta_l = 0:\n            B = float('inf')\n        else:\n            B = int(math.ceil((e_g + e_w) / delta_l))\n\n        # 2. Renewal cycle properties\n        exp_L_cycle = (1 / p_ai) + (1 / p_ia)\n\n        # 3. Probabilities related to idle run length\n        q_ia = 1.0 - p_ia\n        \n        prob_long = 0.0\n        if B > 0 and q_ia > 0:\n            try:\n                prob_long = q_ia ** (B - 1)\n            except OverflowError:\n                prob_long = float('inf') # Should not happen with B being int\n        \n        prob_short = 1.0 - prob_long\n\n        # 4. Probability of gating an idle run\n        prob_gate = (1 - eps_fn) * prob_long + eps_fp * prob_short\n\n        # 5. Expected energy savings calculation\n        E_S_B = 0.0\n        if B == 1:\n            E_S_B = 0.0\n        elif B == float('inf'):\n            E_S_B = 1.0 / p_ia\n        else:\n            q_pow_B_minus_1 = q_ia ** (B - 1)\n            E_S_B = (1.0 - q_pow_B_minus_1) / p_ia - (B - 1) * q_pow_B_minus_1\n\n        E_L_B = (1.0 / p_ia) - E_S_B\n        \n        exp_L_I_gated = eps_fp * E_S_B + (1 - eps_fn) * E_L_B\n\n        exp_savings_run = delta_l * exp_L_I_gated - (e_g + e_w) * prob_gate\n        \n        exp_savings_step = exp_savings_run / exp_L_cycle\n\n        # 6. Stability metric calculation\n        toggle_rate = (2 * prob_gate) / exp_L_cycle\n        is_stable = toggle_rate = tau_max\n\n        results.append([exp_savings_step, is_stable])\n    \n    result_strings = []\n    for res_pair in results:\n        float_str = f\"{res_pair[0]:.6g}\"\n        bool_str = str(res_pair[1]).lower()\n        result_strings.append(f\"[{float_str},{bool_str}]\")\n\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}