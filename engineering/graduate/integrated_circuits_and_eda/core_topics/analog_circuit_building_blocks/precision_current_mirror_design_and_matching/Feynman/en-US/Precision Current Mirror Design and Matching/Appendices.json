{
    "hands_on_practices": [
        {
            "introduction": "The choice of a transistor's operating region is a critical decision in analog IC design, with profound implications for both power consumption and circuit precision. This first exercise explores the fundamental trade-off between operating a current mirror in strong inversion versus the ultra-low-power subthreshold regime. By deriving the required device area to maintain the same matching accuracy in both cases, you will gain a deeper quantitative understanding of how device physics dictates design choices for high-precision, low-power applications. ",
            "id": "1281135",
            "problem": "An analog integrated circuit designer is tasked with creating a low-power version of an existing current mirror. The matching performance of a current mirror, which consists of two nominally identical transistors, is limited by random process variations. The dominant source of this current mismatch is the statistical variation in the transistor threshold voltage, $V_{th}$. A widely used model states that the standard deviation of the threshold voltage difference between two such transistors, $\\sigma_{\\Delta V_{th}}$, is inversely proportional to the square root of the transistor's gate area, $A=WL$. This can be expressed as $\\sigma_{\\Delta V_{th}} = \\frac{K}{\\sqrt{A}}$, where $K$ is a process-dependent constant with units of $\\text{V} \\cdot \\mu\\text{m}$.\n\nThe initial design operates with both transistors in the strong inversion saturation region, where the drain current $I_D$ is approximately proportional to $(V_{GS} - V_{th})^2$. This design has transistors with a gate area of $A_{si}$ and an overdrive voltage of $V_{OV} = V_{GS} - V_{th}$.\n\nFor a new ultra-low-power application, the mirror must be redesigned to operate in the subthreshold (weak inversion) region. In this regime, the drain current $I_D$ exhibits an exponential dependency on $V_{th}$, approximated by the relation $I_D \\propto \\exp\\left(-\\frac{V_{th}}{n V_T}\\right)$, where $n$ is the subthreshold slope factor (a dimensionless constant typically between 1 and 2) and $V_T$ is the thermal voltage.\n\nTo ensure the new design has comparable precision to the original, the standard deviation of the relative current mismatch, $\\frac{\\sigma_{I_D}}{I_D}$, must be identical for both operating points. Assuming that the mismatch in $V_{th}$ is the sole contributor to the current mismatch, derive an expression for the scaling factor $\\frac{A_{sub}}{A_{si}}$ that relates the required gate area of the subthreshold design, $A_{sub}$, to the original strong inversion area, $A_{si}$. Your answer should be in terms of $V_{OV}$, $n$, and $V_T$.",
            "solution": "We model the threshold mismatch between two nominally identical transistors by the area-scaling law\n$$\n\\sigma_{\\Delta V_{th}}=\\frac{K}{\\sqrt{A}},\n$$\nwhere $A=WL$ is the gate area and $K$ is a process-dependent constant. Assuming threshold mismatch is the sole source of current mismatch, the standard deviation of the relative current mismatch follows from first-order sensitivity:\n$$\n\\frac{\\sigma_{I_{D}}}{I_{D}}=\\left|\\frac{\\partial \\ln I_{D}}{\\partial V_{th}}\\right|\\sigma_{\\Delta V_{th}}.\n$$\n\nFor strong inversion saturation, the current is $I_{D}\\propto (V_{GS}-V_{th})^{2}=(V_{OV})^{2}$, so\n$$\n\\frac{\\partial \\ln I_{D}}{\\partial V_{th}}=\\frac{1}{I_{D}}\\frac{\\partial I_{D}}{\\partial V_{th}}=\\frac{1}{I_{D}}\\cdot 2(V_{GS}-V_{th})\\cdot(-1)=-\\frac{2}{V_{OV}}.\n$$\nTherefore,\n$$\n\\left(\\frac{\\sigma_{I_{D}}}{I_{D}}\\right)_{si}=\\frac{2}{V_{OV}}\\cdot\\frac{K}{\\sqrt{A_{si}}}.\n$$\n\nFor subthreshold operation, $I_{D}\\propto \\exp\\!\\left(\\frac{V_{GS}-V_{th}}{nV_{T}}\\right)$, hence\n$$\n\\frac{\\partial \\ln I_{D}}{\\partial V_{th}}=-\\frac{1}{nV_{T}},\n$$\nand\n$$\n\\left(\\frac{\\sigma_{I_{D}}}{I_{D}}\\right)_{sub}=\\frac{1}{nV_{T}}\\cdot\\frac{K}{\\sqrt{A_{sub}}}.\n$$\n\nRequiring identical relative mismatch in both cases gives\n$$\n\\frac{2}{V_{OV}}\\cdot\\frac{K}{\\sqrt{A_{si}}}=\\frac{1}{nV_{T}}\\cdot\\frac{K}{\\sqrt{A_{sub}}}.\n$$\nCanceling $K$ and solving for the area ratio:\n$$\n\\frac{2}{V_{OV}}=\\frac{1}{nV_{T}}\\cdot\\frac{\\sqrt{A_{si}}}{\\sqrt{A_{sub}}}\n\\;\\;\\Longrightarrow\\;\\;\n\\frac{\\sqrt{A_{sub}}}{\\sqrt{A_{si}}}=\\frac{V_{OV}}{2nV_{T}}\n\\;\\;\\Longrightarrow\\;\\;\n\\frac{A_{sub}}{A_{si}}=\\left(\\frac{V_{OV}}{2nV_{T}}\\right)^{2}.\n$$",
            "answer": "$$\\boxed{\\left(\\frac{V_{OV}}{2 n V_{T}}\\right)^{2}}$$"
        },
        {
            "introduction": "Practical analog design is an art of compromise, often involving the optimization of a circuit under multiple, conflicting constraints. This next problem elevates the design task from a single-parameter focus to a holistic optimization challenge, where you must judiciously select device dimensions to satisfy targets for current ratio, output impedance, and voltage compliance, all while adhering to a strict total area budget. This practice hones the essential engineering skill of navigating a complex design space to find a feasible and efficient solution. ",
            "id": "4257593",
            "problem": "Consider a two-transistor current mirror implemented with long-channel n-type metal–oxide–semiconductor field-effect transistors (nMOSFETs) in Complementary Metal–Oxide–Semiconductor (CMOS) technology. The mirror consists of a diode-connected reference device $M_1$ and an output device $M_2$ that share a common gate node. Assume both devices operate in strong inversion and saturation, ignore body effect and mobility degradation, and model channel-length modulation with a length-dependent parameter. Use the following well-tested facts and definitions as the fundamental base:\n- The saturation drain current of a long-channel MOSFET is $I_{D} = \\frac{1}{2} k' \\frac{W}{L} V_{ov}^{2}$, where $k'$ is the process transconductance parameter, $W$ is the gate width, $L$ is the gate length, and $V_{ov} = V_{GS} - V_{T}$ is the gate overdrive voltage.\n- In a simple current mirror, both transistors share the same $V_{GS}$; therefore, their $V_{ov}$ are equal under matching assumptions.\n- The small-signal output resistance is $r_{o} \\approx \\frac{1}{\\lambda I_{D}}$ with $\\lambda \\approx \\frac{\\Lambda}{L}$, where $\\Lambda$ is a process constant that captures the inverse proportionality of $\\lambda$ to $L$. Equivalently, $r_{o} \\approx \\frac{L}{\\Lambda I_{D}}$.\n- The saturation (compliance) condition for the output device is $V_{DS} \\geq V_{ov}$; hence the minimum output voltage for compliance is $V_{out,\\min} = V_{ov}$.\n- Gate capacitance and matching scale primarily with device area; a first-order approximation is that gate capacitance is proportional to $W L$, and threshold voltage and current factor mismatch standard deviations follow Pelgrom’s law: $\\sigma_{\\Delta V_{T}} \\propto \\frac{1}{\\sqrt{W L}}$ and $\\frac{\\sigma_{\\Delta \\beta}}{\\beta} \\propto \\frac{1}{\\sqrt{W L}}$, where $\\beta \\triangleq k' \\frac{W}{L}$.\n\nYou are given the following technology and design constraints and targets:\n- Process transconductance parameter: $k' = 2.0 \\times 10^{-4}\\,\\text{A}\\,\\text{V}^{-2}$.\n- Channel-length modulation constant: $\\Lambda = 6.0 \\times 10^{-2}\\,\\text{V}^{-1}\\,\\mu\\text{m}$.\n- Minimum manufacturable channel length: $L_{\\min} = 0.18\\,\\mu\\text{m}$.\n- Reference current: $I_{\\text{ref}} = 25\\,\\mu\\text{A}$ through $M_1$.\n- Mirror ratio target: $M = \\frac{I_{\\text{out}}}{I_{\\text{ref}}} = 3$ for $M_2$.\n- Output resistance target at the output device: $r_{o,\\min} = 4.0 \\times 10^{5}\\,\\Omega$ at $I_{\\text{out}}$.\n- Compliance target: $V_{\\text{comp,max}} = 0.25\\,\\text{V}$ (i.e., require $V_{ov} \\leq V_{\\text{comp,max}}$).\n- Total layout gate area budget: $A_{\\max} = 40\\,\\mu\\text{m}^{2}$ such that $W_1 L_1 + W_2 L_2 \\leq A_{\\max}$.\n\nDesign objective: Choose $(W_1, L_1)$ and $(W_2, L_2)$ to meet the ratio, compliance, and output resistance targets while respecting the area budget, and among all feasible choices, minimize the total gate area $W_1 L_1 + W_2 L_2$ by first principles reasoning. Then, discuss the tradeoffs in small-signal capacitance and statistical matching that accompany your chosen $(W, L)$ pairs.\n\nInstructions:\n- Express the final widths and lengths in micrometers.\n- Round each dimension to three significant figures.\n- Provide the final answer as a single row matrix $[W_1, L_1, W_2, L_2]$.",
            "solution": "The user wants me to solve a problem.\n\nHere's my plan:\n1.  First, I will check if the problem is valid. To do this, I will extract all the given information and constraints. Then I will evaluate if the problem is scientifically sound, well-posed, and objective.\n2.  If the problem is valid, I will proceed to solve it. My approach will be to translate all the design constraints into mathematical inequalities involving the four geometric parameters: $W_1$, $L_1$, $W_2$, and $L_2$. The objective is to minimize the total gate area $A_{\\text{total}} = W_1 L_1 + W_2 L_2$ subject to these constraints.\n3.  I will start by analyzing the constraints on the output transistor, $M_2$, as it has the most stringent requirements (output resistance and output current).\n4.  I will then analyze the overdrive voltage constraint and its impact on the total area, showing that minimizing area requires using the maximum allowed overdrive voltage.\n5.  With the overdrive voltage and channel lengths determined by the constraints and optimization objective, I will calculate the required channel widths.\n6.  Finally, I will verify that the resulting design satisfies all given constraints, including the total area budget.\n7.  I will conclude with the required discussion of tradeoffs.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n\n-   **MOSFET Model:**\n    -   Saturation Current: $I_{D} = \\frac{1}{2} k' \\frac{W}{L} V_{ov}^{2}$\n    -   Overdrive Voltage: $V_{ov} = V_{GS} - V_{T}$\n    -   Mirror Condition: $V_{ov1} = V_{ov2} = V_{ov}$\n    -   Output Resistance: $r_{o} \\approx \\frac{L}{\\Lambda I_{D}}$\n    -   Mismatch Proportionality: $\\sigma_{\\Delta V_{T}} \\propto \\frac{1}{\\sqrt{W L}}$, $\\frac{\\sigma_{\\Delta \\beta}}{\\beta} \\propto \\frac{1}{\\sqrt{W L}}$\n-   **Technology Parameters:**\n    -   $k' = 2.0 \\times 10^{-4}\\,\\text{A}\\,\\text{V}^{-2}$\n    -   $\\Lambda = 6.0 \\times 10^{-2}\\,\\text{V}^{-1}\\,\\mu\\text{m}$\n    -   $L_{\\min} = 0.18\\,\\mu\\text{m}$\n-   **Design Targets and Constraints:**\n    -   $I_{\\text{ref}} = 25\\,\\mu\\text{A}$\n    -   $M = \\frac{I_{\\text{out}}}{I_{\\text{ref}}} = 3$\n    -   $r_{o,\\min} = 4.0 \\times 10^{5}\\,\\Omega$ (for $M_2$)\n    -   $V_{\\text{comp,max}} = 0.25\\,\\text{V}$ (so $V_{ov} \\leq 0.25\\,\\text{V}$)\n    -   $A_{\\max} = 40\\,\\mu\\text{m}^{2}$ (so $W_1 L_1 + W_2 L_2 \\leq 40\\,\\mu\\text{m}^{2}$)\n-   **Objective:** Minimize $A_{\\text{total}} = W_1 L_1 + W_2 L_2$.\n\n**Step 2: Validate Using Extracted Givens**\n\n-   **Scientific Groundedness:** The problem is based on the standard square-law model for long-channel MOSFETs and the first-order model for channel-length modulation. These are cornerstones of analog IC design education and practice. The numerical values are realistic for a legacy CMOS process (e.g., $180\\,\\text{nm}$). The problem is scientifically sound.\n-   **Well-Posedness & Completeness:** The problem provides a clear objective function (minimize area) and a set of constraints. There are four variables to determine ($W_1, L_1, W_2, L_2$) and a system of equations and inequalities derived from the constraints. The problem appears self-contained and solvable.\n-   **Objectivity:** The problem is stated in precise, quantitative terms. There are no subjective or ambiguous statements.\n\n**Step 3: Verdict and Action**\n\nThe problem is deemed **valid**. The reasoning process will now be detailed.\n\n**Solution Derivation**\n\nThe objective is to choose the device dimensions $(W_1, L_1)$ and $(W_2, L_2)$ to satisfy all design constraints while minimizing the total gate area, $A_{\\text{total}} = W_1 L_1 + W_2 L_2$.\n\nFirst, we establish the required output current for the device $M_2$:\n$I_{\\text{out}} = M \\times I_{\\text{ref}} = 3 \\times 25\\,\\mu\\text{A} = 75\\,\\mu\\text{A}$. We denote $I_{D1} = I_{\\text{ref}}$ and $I_{D2} = I_{\\text{out}}$.\n\nThe output resistance constraint for $M_2$ is $r_{o2} \\geq r_{o,\\min}$. Using the provided model $r_{o} \\approx \\frac{L}{\\Lambda I_{D}}$, we can write:\n$$ \\frac{L_2}{\\Lambda I_{D2}} \\geq r_{o,\\min} $$\nThis inequality sets a minimum required channel length for $M_2$. To minimize area, we should generally use the smallest possible dimensions. We determine this minimum required length, $L_{2,\\text{req}}$:\n$$ L_{2,\\text{req}} = r_{o,\\min} \\Lambda I_{D2} $$\nSubstituting the given values:\n$$ L_{2,\\text{req}} = (4.0 \\times 10^{5}\\,\\Omega) \\times (6.0 \\times 10^{-2}\\,\\text{V}^{-1}\\,\\mu\\text{m}) \\times (75 \\times 10^{-6}\\,\\text{A}) $$\n$$ L_{2,\\text{req}} = (4.0 \\times 6.0 \\times 75) \\times (10^5 \\times 10^{-2} \\times 10^{-6})\\,\\mu\\text{m} = 1800 \\times 10^{-3}\\,\\mu\\text{m} = 1.8\\,\\mu\\text{m} $$\nSo, we must have $L_2 \\geq 1.8\\,\\mu\\text{m}$. This is greater than the minimum manufacturable length $L_{\\min} = 0.18\\,\\mu\\text{m}$, so this is the active constraint for $L_2$. To minimize the contribution of $M_2$ to the total area, we select the smallest possible value for $L_2$, which is $L_2 = 1.8\\,\\mu\\text{m}$.\n\nNext, we analyze the total area expression. From the saturation current equation, $I_D = \\frac{1}{2} k' \\frac{W}{L} V_{ov}^2$, we can express the width $W$ as $W = L \\left(\\frac{2 I_D}{k' V_{ov}^2}\\right)$. The total area is:\n$$ A_{\\text{total}} = W_1 L_1 + W_2 L_2 = L_1^2 \\left(\\frac{2 I_{D1}}{k' V_{ov}^2}\\right) + L_2^2 \\left(\\frac{2 I_{D2}}{k' V_{ov}^2}\\right) $$\n$$ A_{\\text{total}} = \\frac{2}{k' V_{ov}^2} (I_{D1} L_1^2 + I_{D2} L_2^2) $$\nTo minimize $A_{\\text{total}}$, we must:\n1.  Maximize the gate overdrive voltage, $V_{ov}$.\n2.  Minimize the channel lengths, $L_1$ and $L_2$.\n\nThe compliance constraint sets an upper limit on the overdrive voltage: $V_{ov} \\leq V_{\\text{comp,max}} = 0.25\\,\\text{V}$. Therefore, to minimize area, we must choose the largest possible $V_{ov}$:\n$$ V_{ov} = 0.25\\,\\text{V} $$\n\nThe contribution of $M_1$ to the area is proportional to $L_1^2$. To minimize area, we must choose the smallest possible value for $L_1$, which is the minimum manufacturable length:\n$$ L_1 = L_{\\min} = 0.18\\,\\mu\\text{m} $$\n\nWe have now determined the optimal lengths ($L_1 = 0.18\\,\\mu\\text{m}$, $L_2 = 1.8\\,\\mu\\text{m}$) and the overdrive voltage ($V_{ov} = 0.25\\,\\text{V}$) that minimize area while satisfying the length and resistance constraints. Now we must calculate the widths $W_1$ and $W_2$.\n\nWe first calculate the required aspect ratios $(W/L)$ for each transistor:\nFor $M_1$:\n$$ \\left(\\frac{W}{L}\\right)_1 = \\frac{2 I_{D1}}{k' V_{ov}^2} = \\frac{2 \\times (25 \\times 10^{-6}\\,\\text{A})}{(2.0 \\times 10^{-4}\\,\\text{A}\\,\\text{V}^{-2}) \\times (0.25\\,\\text{V})^2} = \\frac{5 \\times 10^{-5}}{2.0 \\times 10^{-4} \\times 0.0625} = \\frac{5 \\times 10^{-5}}{1.25 \\times 10^{-5}} = 4 $$\nFor $M_2$:\n$$ \\left(\\frac{W}{L}\\right)_2 = \\frac{2 I_{D2}}{k' V_{ov}^2} = \\frac{2 \\times (75 \\times 10^{-6}\\,\\text{A})}{(2.0 \\times 10^{-4}\\,\\text{A}\\,\\text{V}^{-2}) \\times (0.25\\,\\text{V})^2} = \\frac{1.5 \\times 10^{-4}}{1.25 \\times 10^{-5}} = 12 $$\nThe ratio of the aspect ratios is $\\frac{(W/L)_2}{(W/L)_1} = \\frac{12}{4} = 3$, which correctly implements the current mirror ratio $M=3$.\n\nNow we calculate the widths using the chosen channel lengths:\n$$ W_1 = 4 \\times L_1 = 4 \\times 0.18\\,\\mu\\text{m} = 0.72\\,\\mu\\text{m} $$\n$$ W_2 = 12 \\times L_2 = 12 \\times 1.8\\,\\mu\\text{m} = 21.6\\,\\mu\\text{m} $$\n\nThe resulting design dimensions are $W_1 = 0.72\\,\\mu\\text{m}$, $L_1 = 0.18\\,\\mu\\text{m}$, $W_2 = 21.6\\,\\mu\\text{m}$, and $L_2 = 1.8\\,\\mu\\text{m}$.\n\nLet's verify the total area constraint:\n$$ A_{\\text{total}} = W_1 L_1 + W_2 L_2 = (0.72\\,\\mu\\text{m} \\times 0.18\\,\\mu\\text{m}) + (21.6\\,\\mu\\text{m} \\times 1.8\\,\\mu\\text{m}) $$\n$$ A_{\\text{total}} = 0.1296\\,\\mu\\text{m}^2 + 38.88\\,\\mu\\text{m}^2 = 39.0096\\,\\mu\\text{m}^2 $$\nThis value is less than the area budget $A_{\\max} = 40\\,\\mu\\text{m}^2$, so the design is valid.\nRounding the final dimensions to three significant figures gives:\n$W_1 = 0.720\\,\\mu\\text{m}$, $L_1 = 0.180\\,\\mu\\text{m}$, $W_2 = 21.6\\,\\mu\\text{m}$, $L_2 = 1.80\\,\\mu\\text{m}$.\n\n**Discussion of Tradeoffs**\n\n-   **Capacitance:** The objective of minimizing total gate area $A_{\\text{total}} = W_1 L_1 + W_2 L_2$ simultaneously minimizes the total parasitic gate capacitance, which is approximately proportional to this area. A lower total capacitance is generally desirable for higher speed operation, as it leads to faster transient responses. The capacitance at the shared gate node, $C_{gs1} + C_{gs2}$, is dominated by $C_{gs2}$ since its area ($A_2 = 38.88\\,\\mu\\text{m}^2$) is much larger than that of $M_1$ ($A_1 = 0.1296\\,\\mu\\text{m}^2$). This large gate-node capacitance forms a dominant pole that can limit the bandwidth of the current mirror.\n\n-   **Statistical Matching:** The design strictly minimizes area, which comes at a significant cost to matching precision. Pelgrom's law states that the standard deviation of threshold voltage mismatch ($\\sigma_{\\Delta V_T}$) and current factor mismatch ($\\sigma_{\\Delta \\beta}/\\beta$) are inversely proportional to the square root of the gate area ($1/\\sqrt{WL}$). Our design results in an extremely small area for the reference transistor $M_1$ ($A_1 \\approx 0.13\\,\\mu\\text{m}^2$). This minimal area makes the mirror's current ratio highly sensitive to random process variations, and thus the actual ratio will exhibit a large variance around the target value of $M=3$. Furthermore, the design uses different channel lengths for the two transistors ($L_1 = 0.18\\,\\mu\\text{m}$ and $L_2 = 1.8\\,\\mu\\text{m}$). This is a poor practice for achieving good matching, as it makes the circuit's performance sensitive to systematic process gradients in channel length across the die. A more robust design would use equal lengths ($L_1=L_2$), but as shown by a simple calculation ($A_{\\text{total}} = 51.84\\,\\mu\\text{m}^2$ for $L_1=L_2=1.8\\,\\mu\\text{m}$), such a choice would violate the strict area budget. The problem formulation thus forces the designer into a solution that prioritizes area minimization over matching accuracy.\n\nThe final dimensions, rounded to three significant figures, constitute the solution.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.720 & 0.180 & 21.6 & 1.80 \\end{pmatrix} } $$"
        },
        {
            "introduction": "A design that is perfect on a schematic can fail in silicon if physical layout effects are ignored. This final practice moves beyond the ideal transistor models to confront a crucial real-world challenge: the impact of parasitic resistance in metal interconnects. You will analyze how unintended voltage drops ($IR$ drops) in wiring can corrupt a precision reference current and quantify the resulting error, while also appreciating the effectiveness of a canonical layout solution—the Kelvin connection. ",
            "id": "4291192",
            "problem": "A precision current mirror is implemented on a complementary metal–oxide–semiconductor (CMOS) integrated circuit to deliver a stable output current for an analog front-end. The reference current is generated by forcing a controlled voltage across an integrated resistor using a closed-loop amplifier, and the current is mirrored to the output. The layout must address the voltage drop (IR drop) in metal routing. Consider the following arrangement.\n\nA stable reference voltage $V_{R}$ is applied across a precision resistor of value $R$ by a high-gain differential amplifier that senses the voltage across the resistor and adjusts the gate voltage of a diode-connected reference transistor $M_{1}$ until the sensed voltage equals $V_{R}$. The output transistor $M_{2}$ mirrors this current to the load by a factor $m$ based on device geometry. Two alternative routing schemes are considered for the resistor connections:\n\n1. Non-Kelvin routing: The amplifier senses the resistor’s voltage at the same pads that also carry the full reference current, both on the force side and the return side. The metal routing from the amplifier to the resistor terminals consists of finite-resistance segments and vias. Therefore, the measured voltage includes drops in these conductive paths as well as the resistor itself.\n\n2. Kelvin routing: The amplifier senses the resistor’s voltage using separate sense lines that connect directly to the resistor terminals and carry negligible current. The force and return currents still flow through their respective finite-resistance metal paths, but the sensed voltage excludes these drops.\n\nAssume the following parameters for the resistor and the metal routing:\n\n- Reference voltage $V_{R} = 0.50\\ \\text{V}$.\n- Resistor value $R = 2.50 \\times 10^{3}\\ \\Omega$.\n- Output current mirror ratio $m = 3$.\n- Metal layer sheet resistance $R_{\\square} = 30 \\times 10^{-3}\\ \\Omega/\\square$.\n- Force-side metal segment length and width: $L_{+} = 600\\ \\mu\\text{m}$, $W_{+} = 6\\ \\mu\\text{m}$.\n- Return-side metal segment length and width: $L_{-} = 900\\ \\mu\\text{m}$, $W_{-} = 9\\ \\mu\\text{m}$.\n- Lumped series via/contact resistance on the force side $R_{c,+} = 0.20\\ \\Omega$ and on the return side $R_{c,-} = 0.20\\ \\Omega$.\n- The sense lines in the Kelvin routing carry negligible current, so their voltage drops are negligible.\n\nAssume Direct Current (DC) operation and ignore all semiconductor second-order effects such as channel-length modulation, mobility degradation, body effect, and any gate leakage, so that the mirror factor $m$ scales the reference current ideally. Use the definition of sheet resistance and Ohm’s law to compute the routing resistances and their effect on the measured voltage. Let $R_{\\text{lead}}$ denote the total series resistance of the current-carrying force and return paths combined.\n\nDefine the fractional output current error due to non-Kelvin routing relative to Kelvin routing as\n$$\\epsilon \\equiv \\frac{I_{\\text{OUT, NK}} - I_{\\text{OUT, K}}}{I_{\\text{OUT, K}}},$$\nwhere $I_{\\text{OUT, NK}}$ is the output current with non-Kelvin routing and $I_{\\text{OUT, K}}$ is the output current with Kelvin routing. Compute $\\epsilon$ from first principles using the given parameters. Express the final answer as a decimal number. Round your answer to four significant figures.",
            "solution": "The problem requires the calculation of the fractional output current error, $\\epsilon$, in a precision current mirror due to the use of a non-Kelvin routing scheme for the reference resistor, relative to an ideal Kelvin routing scheme.\n\nThe first step is to calculate the total parasitic series resistance of the current-carrying metal routing, which is denoted as $R_{\\text{lead}}$. This resistance is the sum of the resistances of the force-side metal trace ($R_{+}$), the return-side metal trace ($R_{-}$), and the associated lumped contact/via resistances ($R_{c,+}$ and $R_{c,-}$).\n\nThe resistance of a rectangular metal trace is calculated using its sheet resistance, $R_{\\square}$, length, $L$, and width, $W$, according to the formula $R_{\\text{trace}} = R_{\\square} \\frac{L}{W}$.\n\nGiven the parameters for the force-side trace:\nSheet resistance $R_{\\square} = 30 \\times 10^{-3}\\ \\Omega/\\square$.\nLength $L_{+} = 600\\ \\mu\\text{m}$.\nWidth $W_{+} = 6\\ \\mu\\text{m}$.\n\nThe resistance of the force-side trace is:\n$$R_{+} = R_{\\square} \\frac{L_{+}}{W_{+}} = (30 \\times 10^{-3}\\ \\Omega/\\square) \\times \\frac{600\\ \\mu\\text{m}}{6\\ \\mu\\text{m}} = (30 \\times 10^{-3}) \\times 100\\ \\Omega = 3.0\\ \\Omega$$\n\nGiven the parameters for the return-side trace:\nSheet resistance $R_{\\square} = 30 \\times 10^{-3}\\ \\Omega/\\square$.\nLength $L_{-} = 900\\ \\mu\\text{m}$.\nWidth $W_{-} = 9\\ \\mu\\text{m}$.\n\nThe resistance of the return-side trace is:\n$$R_{-} = R_{\\square} \\frac{L_{-}}{W_{-}} = (30 \\times 10^{-3}\\ \\Omega/\\square) \\times \\frac{900\\ \\mu\\text{m}}{9\\ \\mu\\text{m}} = (30 \\times 10^{-3}) \\times 100\\ \\Omega = 3.0\\ \\Omega$$\n\nThe lumped series contact/via resistances are given as $R_{c,+} = 0.20\\ \\Omega$ and $R_{c,-} = 0.20\\ \\Omega$.\n\nThe total series lead resistance, $R_{\\text{lead}}$, is the sum of all these parasitic components:\n$$R_{\\text{lead}} = R_{+} + R_{c,+} + R_{-} + R_{c,-} = 3.0\\ \\Omega + 0.20\\ \\Omega + 3.0\\ \\Omega + 0.20\\ \\Omega = 6.40\\ \\Omega$$\n\nNow, we analyze the two routing schemes.\n\nCase 1: Kelvin Routing (K)\nIn the Kelvin routing scheme, the high-gain amplifier senses the voltage directly across the terminals of the precision resistor $R$. The feedback loop adjusts the gate voltage of the reference transistor $M_1$ such that the sensed voltage equals the reference voltage $V_R$. Since the sense lines carry negligible current, the voltage across the resistor $R$ is precisely $V_R$. The reference current, $I_{\\text{REF, K}}$, is then given by Ohm's law:\n$$I_{\\text{REF, K}} = \\frac{V_R}{R}$$\nThe output current, $I_{\\text{OUT, K}}$, is a scaled version of the reference current, with the mirror ratio $m$:\n$$I_{\\text{OUT, K}} = m \\cdot I_{\\text{REF, K}} = m \\frac{V_R}{R}$$\n\nCase 2: Non-Kelvin Routing (NK)\nIn the non-Kelvin routing scheme, the amplifier senses the voltage at the same pads that carry the reference current. Therefore, the sensed voltage is the sum of the voltage drop across the resistor $R$ and the voltage drops across the series parasitic resistances $R_{\\text{lead}}$. The feedback loop forces this total sensed voltage to be equal to $V_R$.\n$$V_R = V_{\\text{sensed}} = I_{\\text{REF, NK}} \\cdot R + I_{\\text{REF, NK}} \\cdot R_{\\text{lead}} = I_{\\text{REF, NK}} (R + R_{\\text{lead}})$$\nSolving for the reference current, $I_{\\text{REF, NK}}$, we get:\n$$I_{\\text{REF, NK}} = \\frac{V_R}{R + R_{\\text{lead}}}$$\nThe corresponding output current, $I_{\\text{OUT, NK}}$, is:\n$$I_{\\text{OUT, NK}} = m \\cdot I_{\\text{REF, NK}} = m \\frac{V_R}{R + R_{\\text{lead}}}$$\n\nThe problem defines the fractional output current error $\\epsilon$ as:\n$$\\epsilon \\equiv \\frac{I_{\\text{OUT, NK}} - I_{\\text{OUT, K}}}{I_{\\text{OUT, K}}}$$\nThis can be rewritten as:\n$$\\epsilon = \\frac{I_{\\text{OUT, NK}}}{I_{\\text{OUT, K}}} - 1$$\nSubstituting the expressions for $I_{\\text{OUT, NK}}$ and $I_{\\text{OUT, K}}$:\n$$\\epsilon = \\frac{m \\frac{V_R}{R + R_{\\text{lead}}}}{m \\frac{V_R}{R}} - 1$$\nThe terms $m$ and $V_R$ cancel out, leaving:\n$$\\epsilon = \\frac{R}{R + R_{\\text{lead}}} - 1$$\nCombining the terms into a single fraction:\n$$\\epsilon = \\frac{R - (R + R_{\\text{lead}})}{R + R_{\\text{lead}}} = \\frac{-R_{\\text{lead}}}{R + R_{\\text{lead}}}$$\nThis expression shows that the error is negative, as expected, because the additional series resistance in the non-Kelvin setup reduces the reference current for a given reference voltage.\n\nNow, we substitute the numerical values:\n$R = 2.50 \\times 10^{3}\\ \\Omega = 2500\\ \\Omega$.\n$R_{\\text{lead}} = 6.40\\ \\Omega$.\n\n$$\\epsilon = \\frac{-6.40\\ \\Omega}{2500\\ \\Omega + 6.40\\ \\Omega} = \\frac{-6.40}{2506.40}$$\nPerforming the division:\n$$\\epsilon \\approx -0.0025534631\\dots$$\nRounding the result to four significant figures, we get:\n$$\\epsilon \\approx -0.002553$$",
            "answer": "$$\\boxed{-0.002553}$$"
        }
    ]
}