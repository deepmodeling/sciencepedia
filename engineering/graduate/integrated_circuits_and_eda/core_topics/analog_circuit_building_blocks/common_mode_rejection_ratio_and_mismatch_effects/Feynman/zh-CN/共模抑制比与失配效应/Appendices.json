{
    "hands_on_practices": [
        {
            "introduction": "深入理解共模抑制的来源是模拟设计的基石。本练习将剖析最基本的构建模块——MOS差分对，以揭示尾电流源的质量如何直接决定放大器抑制共模噪声的能力。通过分析电路在其工作极限下的行为，本练习旨在建立关于共模抑制比（CMRR）的物理直觉。",
            "id": "4261577",
            "problem": "考虑一个用作电阻负载放大器的对称金属氧化物半导体（MOS）差分对。每个晶体管的小信号跨导为 $g_{m}$，输出电阻可忽略不计。两个漏极分别通过电阻 $R_{D1}$ 和 $R_{D2}$ 连接到一个稳定电源。两个源极短接在一起，并通过一个有限的尾电阻 $R_{t}$ 接地，该电阻模拟了尾电流源的非理想输出电阻。负载电阻存在一个小的失配，模型为 $R_{D1} = R(1+\\alpha)$ 和 $R_{D2} = R(1-\\alpha)$，其中 $R > 0$ 且 $|\\alpha| \\ll 1$。一个纯共模小信号输入 $v_{cm}$ 被同等地施加到两个栅极上。设差分输出电压为 $v_{od} = v_{o1} - v_{o2}$，并将共模增益 $A_{c}$ 定义为 $A_{c} = v_{od}/v_{cm}$。在小信号范围内工作，并假设线性时不变行为。\n\n从基本电路关系（基尔霍夫定律、线性小信号跨导和欧姆定律）出发，对任意的 $R_{t}$、$g_{m}$、$R$ 和 $\\alpha$，以符号形式推导 $A_{c}$，然后确定当 $R_{t} \\to \\infty$ 和 $R_{t} \\to 0$ 时 $A_{c}$ 的极限行为。讨论这些渐近极限对此电路的共模抑制比（CMRR）的物理意义，CMRR定义为差模增益与共模增益的幅值比。\n\n将您的最终答案表示为由两个极限组成的有序对 $\\left(\\lim_{R_{t}\\to\\infty} A_{c},\\ \\lim_{R_{t}\\to 0} A_{c}\\right)$，形式为闭式代数表达式。不需要进行数值计算或四舍五入。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于标准的小信号电路理论，问题设定良好，提供了所有必要的信息，并以客观、明确的语言表达。因此，我们可以进行正式的求解。\n\n问题要求推导一个具有有限尾电阻 $R_t$ 和失配负载电阻 $R_{D1}$ 和 $R_{D2}$ 的电阻负载MOS差分对的共模增益 $A_c$。我们将使用小信号等效电路模型。\n\n设两个晶体管为 $M_1$ 和 $M_2$。每个晶体管的小信号跨导为 $g_m$。一个共模输入电压 $v_{cm}$ 施加到两个栅极上，因此 $v_{g1} = v_{g2} = v_{cm}$。$M_1$ 和 $M_2$ 的源极连接在一起，形成一个电压为 $v_s$ 的节点。这个公共源极节点通过尾电阻 $R_t$ 接地。晶体管的输出电阻可忽略不计。\n\n$M_1$ 和 $M_2$ 的小信号栅源电压是相同的：\n$$v_{gs1} = v_{g1} - v_s = v_{cm} - v_s$$\n$$v_{gs2} = v_{g2} - v_s = v_{cm} - v_s$$\n因此，小信号漏极电流也相同，由线性跨导关系给出：\n$$i_{d1} = g_m v_{gs1} = g_m (v_{cm} - v_s)$$\n$$i_{d2} = g_m v_{gs2} = g_m (v_{cm} - v_s)$$\n所以，$i_{d1} = i_{d2}$。\n\n漏极通过电阻 $R_{D1}$ 和 $R_{D2}$ 连接到交流地（稳定电源）。输出电压 $v_{o1}$ 和 $v_{o2}$ 由欧姆定律确定：\n$$v_{o1} = -i_{d1} R_{D1}$$\n$$v_{o2} = -i_{d2} R_{D2}$$\n\n为了求出公共源极节点电压 $v_s$，我们在此节点应用基尔霍夫电流定律 (KCL)。两个源极电流之和（对于MOS晶体管，源极电流等于各自的漏极电流）流过尾电阻 $R_t$。\n$$i_{d1} + i_{d2} = \\frac{v_s}{R_t}$$\n由于 $i_{d1} = i_{d2}$，这变为：\n$$2 i_{d1} = \\frac{v_s}{R_t}$$\n现在我们代入 $i_{d1}$ 的表达式：\n$$2 g_m (v_{cm} - v_s) = \\frac{v_s}{R_t}$$\n我们现在可以解出 $v_s$ 关于 $v_{cm}$ 的表达式：\n$$2 g_m R_t (v_{cm} - v_s) = v_s$$\n$$2 g_m R_t v_{cm} - 2 g_m R_t v_s = v_s$$\n$$2 g_m R_t v_{cm} = v_s (1 + 2 g_m R_t)$$\n$$v_s = \\frac{2 g_m R_t}{1 + 2 g_m R_t} v_{cm}$$\n\n为了求出漏极电流，我们首先将栅源电压 $v_{cm} - v_s$ 表示为 $v_{cm}$ 的函数：\n$$v_{cm} - v_s = v_{cm} - \\left( \\frac{2 g_m R_t}{1 + 2 g_m R_t} \\right) v_{cm} = v_{cm} \\left( 1 - \\frac{2 g_m R_t}{1 + 2 g_m R_t} \\right)$$\n$$v_{cm} - v_s = v_{cm} \\left( \\frac{1 + 2 g_m R_t - 2 g_m R_t}{1 + 2 g_m R_t} \\right) = \\frac{1}{1 + 2 g_m R_t} v_{cm}$$\n因此，漏极电流 $i_{d1}$ 为：\n$$i_{d1} = g_m (v_{cm} - v_s) = \\frac{g_m}{1 + 2 g_m R_t} v_{cm}$$\n并且由于 $i_{d1}=i_{d2}$，我们得到 $i_{d2}$ 的相同表达式。\n\n差分输出电压定义为 $v_{od} = v_{o1} - v_{o2}$。代入输出电压的表达式：\n$$v_{od} = (-i_{d1} R_{D1}) - (-i_{d2} R_{D2}) = -i_{d1} (R_{D1} - R_{D2})$$\n现在，代入 $i_{d1}$ 的表达式：\n$$v_{od} = -\\left( \\frac{g_m}{1 + 2 g_m R_t} v_{cm} \\right) (R_{D1} - R_{D2})$$\n共模增益 $A_c$ 定义为 $A_c = v_{od} / v_{cm}$：\n$$A_c = \\frac{-g_m (R_{D1} - R_{D2})}{1 + 2 g_m R_t}$$\n接下来，我们使用给定的失配电阻模型：$R_{D1} = R(1+\\alpha)$ 和 $R_{D2} = R(1-\\alpha)$。它们的差是：\n$$R_{D1} - R_{D2} = R(1+\\alpha) - R(1-\\alpha) = R + R\\alpha - R + R\\alpha = 2R\\alpha$$\n将此代入 $A_c$ 的表达式中：\n$$A_c = \\frac{-g_m (2R\\alpha)}{1 + 2 g_m R_t} = \\frac{-2g_m R \\alpha}{1 + 2 g_m R_t}$$\n这就是共模增益的符号表达式。\n\n现在，我们计算所需的极限。\n首先，当 $R_t \\to \\infty$ 时的极限：\n$$\\lim_{R_t\\to\\infty} A_{c} = \\lim_{R_t\\to\\infty} \\frac{-2g_m R \\alpha}{1 + 2 g_m R_t}$$\n当 $R_t$ 趋于无穷大时，分母 $1 + 2 g_m R_t$ 趋于无穷大。对于任何有限的分子，该分数趋于零。\n$$\\lim_{R_t\\to\\infty} A_{c} = 0$$\n\n其次，当 $R_t \\to 0$ 时的极限：\n$$\\lim_{R_t\\to 0} A_{c} = \\frac{-2g_m R \\alpha}{1 + 2 g_m (0)} = \\frac{-2g_m R \\alpha}{1}$$\n$$\\lim_{R_t\\to 0} A_{c} = -2g_m R \\alpha$$\n\n这对共模抑制比（CMRR）的物理意义是显著的。CMRR 定义为差模增益 $A_d$ 与共模增益 $A_c$ 的幅值比：\n$$CMRR = \\left| \\frac{A_d}{A_c} \\right|$$\n差模增益的名义值为 $A_d \\approx -g_m R$。\n那么 CMRR 是：\n$$CMRR = \\left| \\frac{-g_m R}{\\frac{-2g_m R \\alpha}{1 + 2 g_m R_t}} \\right| = \\left| \\frac{1 + 2 g_m R_t}{2\\alpha} \\right| = \\frac{1 + 2 g_m R_t}{2|\\alpha|}$$\n- 对于 $R_t \\to \\infty$：$A_c \\to 0$ 且 $CMRR \\to \\infty$。一个大的尾电阻（接近理想电流源）迫使晶体管电流之和保持恒定（交流为零）。这提供了强大的负反馈，抑制了源极节点上的任何共模电压变化，从而使信号电流趋于零。因此，即使存在电阻失配，共模输入也不会产生差分输出，从而导致无限大的CMRR。这是理想的工作条件。\n- 对于 $R_t \\to 0$：$A_c \\to -2g_m R \\alpha$ 且 $CMRR \\to \\frac{1}{2|\\alpha|}$。当尾电阻为零时，两个晶体管作为独立的共源放大器工作。共模输入 $v_{cm}$ 被每个晶体管放大。差分输出 $v_{od}$ 不为零完全是由于负载电阻的失配 $\\alpha$。电路失去了由尾电流源提供的共模抑制能力，CMRR 变为有限值，受元件匹配精度的限制。较大的失配 $\\alpha$ 会导致较大的 $A_c$，从而导致较小（更差）的CMRR。\n\n最终答案要求的是 $A_c$ 的两个极限组成的有序对。\n当 $R_t \\to \\infty$ 时的极限是 $0$。\n当 $R_t \\to 0$ 时的极限是 $-2g_m R \\alpha$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  -2 g_{m} R \\alpha \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在掌握了基本原理之后，工程师必须将系统级需求转化为可制造的物理规格。本练习提供了一个将理论性能与物理实现约束联系起来的具体示例，通过计算经典差分放大器为达到严格的CMRR目标所需的电阻匹配精度。这个过程是电路设计中从概念到实现的关键一步。",
            "id": "4261609",
            "problem": "在电子设计自动化 (EDA) 的集成电路环境中，实现了一个单片差分放大器。该放大器使用一个运算放大器和四电阻网络：电阻 $R_1$ 将输入 $v_1$ 连接到反相输入端，电阻 $R_2$ 提供从输出到反相输入端的反馈，电阻 $R_3$ 将输入 $v_2$ 连接到同相输入端，电阻 $R_4$ 将同相输入端接地。假设运算放大器是理想的，且共模增益的唯一来源是增益设置网络中的电阻失配。标称设计是对称的，$R_1 = R_3 = 10\\,\\mathrm{k}\\Omega$ 且 $R_2 = R_4 = 100\\,\\mathrm{k}\\Omega$，因此预期的差模增益为 $k = R_2/R_1 = 10$。\n\n设实际电阻为 $R_i(1+\\Delta_i)$，其中 $i \\in \\{1,2,3,4\\}$，每个 $\\Delta_i$ 是由于失配引起的未知分数偏差。对于版图匹配的器件，可以假设最坏情况下的界限为 $|\\Delta_i| \\leq t$，其中 $t$ 是待确定的匹配规格。定义共模抑制比 (CMRR) 为整个放大器的差模增益与共模增益的幅值之比。目标是确保在所有满足 $|\\Delta_i| \\leq t$ 的失配组合下，最小 $\\mathrm{CMRR_{dB}}$ 达到 $96$ 分贝。\n\n从理想运算放大器的约束和电阻网络定律出发，推导共模抑制比 (CMRR) 对电阻比值微小失配的一阶灵敏度。然后，使用失配的最坏情况确定性界限，确定最小匹配规格 $t$ (以小数形式表示)，使得在给定的标称值下，最坏情况的 $\\mathrm{CMRR_{dB}}$ 至少为 $96$ 分贝。将最终的容差 $t$ 表示为小数，并将答案四舍五入到三位有效数字。在最终表达式中不要使用百分号。",
            "solution": "首先对问题进行验证，以确保其科学性、适定性和客观性。\n\n### 第1步：提取已知条件\n- 电路：带有单个理想运算放大器（运放）的单片差分放大器。\n- 电阻网络：$R_1$ 从输入 $v_1$ 到反相输入端，$R_2$ 从输出到反相输入端，$R_3$ 从输入 $v_2$ 到同相输入端，$R_4$ 从同相输入端接地。\n- 运放模型：理想。\n- 标称电阻值：$R_1 = R_3 = 10\\,\\mathrm{k}\\Omega$，$R_2 = R_4 = 100\\,\\mathrm{k}\\Omega$。\n- 标称差模增益：$k = R_2/R_1 = 10$。\n- 实际电阻值：$R_i' = R_i(1+\\Delta_i)$，其中 $i \\in \\{1,2,3,4\\}$，$\\Delta_i$ 是分数偏差。\n- 失配界限：对所有 $i$，$|\\Delta_i| \\leq t$。\n- CMRR 定义：$\\mathrm{CMRR} = |A_d / A_{cm}|$，其中 $A_d$ 是差模增益，$A_{cm}$ 是共模增益。\n- 性能目标：最小 $\\mathrm{CMRR_{dB}} \\geq 96$ 分贝。\n- 目标：确定最小匹配规格 $t$。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学性**：该问题基于模拟电路理论的基本原理，特别是差分放大器的分析。电阻失配的模型和 CMRR 的定义是集成电路设计领域的标准。使用理想运放是进行此类一阶分析时常见且适当的简化。该问题在科学上是合理的。\n- **适定性**：该问题提供了所有必要信息：电路拓扑、元件值、非理想性（失配）模型以及明确的性能目标。它要求一个具体的、可计算的量 ($t$)。该问题是适定的。\n- **客观性**：该问题以精确、技术性的语言陈述，没有模糊性或主观论断。\n\n### 第3步：结论与行动\n问题有效。解题过程将继续进行。\n\n### 解题推导\n差分放大器的输出电压 $v_{out}$ 由电阻网络和理想运放的约束条件决定。对于理想运放，其差分输入电压为零，因此反相输入端的电压 ($v_-$) 等于同相输入端的电压 ($v_+$)。\n\n同相输入端的电压 $v_+$ 由实际电阻 $R_3'$ 和 $R_4'$ 构成的分压器决定：\n$$v_+ = v_2 \\frac{R_4'}{R_3' + R_4'}$$\n由于理想运放的假设 ($v_- = v_+$) 和零输入电流，反相输入端的输入与输出关系由标准的反相放大器配置给出，但以 $v_-$ 为参考点：\n$$\\frac{v_1 - v_-}{R_1'} = \\frac{v_- - v_{out}}{R_2'}$$\n求解 $v_{out}$：\n$$v_{out} R_1' = v_-(R_1' + R_2') - v_1 R_2'$$\n$$v_{out} = v_- \\left(1 + \\frac{R_2'}{R_1'}\\right) - v_1 \\frac{R_2'}{R_1'}$$\n代入 $v_-$ 的表达式 (因为 $v_-=v_+$)：\n$$v_{out} = v_2 \\frac{R_4'}{R_3' + R_4'} \\left(1 + \\frac{R_2'}{R_1'}\\right) - v_1 \\frac{R_2'}{R_1'}$$\n这是输出电压的通用表达式。为了求出差模增益和共模增益，我们将 $v_{out}$ 表示为差模输入 $v_d = v_2 - v_1$ 和共模输入 $v_{cm} = (v_1 + v_2)/2$ 的函数。输出为 $v_{out} = A_d v_d + A_{cm} v_{cm}$。\n\n共模增益 $A_{cm}$ 是当 $v_1 = v_2 = v_{cm}$ ($v_d=0$) 时的输出电压：\n$$A_{cm} = \\frac{v_{out}}{v_{cm}} = \\frac{R_4'}{R_3' + R_4'} \\left(1 + \\frac{R_2'}{R_1'}\\right) - \\frac{R_2'}{R_1'}$$\n这可以通过通分来简化：\n$$A_{cm} = \\frac{R_4'(R_1' + R_2') - R_2'(R_3' + R_4')}{R_1'(R_3' + R_4')} = \\frac{R_1'R_4' - R_2'R_3'}{R_1'(R_3' + R_4')}$$\n对于完美匹配，电阻比值相等，$R_2/R_1 = R_4/R_3$，这意味着 $R_1R_4 = R_2R_3$，因此 $A_{cm}=0$。电阻失配导致非零的 $A_{cm}$。\n\n让我们代入实际电阻值 $R_i' = R_i(1+\\Delta_i)$ 和标称设计值 $R_1 = R_3 = R_A$ 及 $R_2 = R_4 = R_B$。标称增益为 $k=R_B/R_A$。\n$$R_1'R_4' - R_2'R_3' = R_A(1+\\Delta_1)R_B(1+\\Delta_4) - R_B(1+\\Delta_2)R_A(1+\\Delta_3)$$\n$$= R_A R_B \\left[ (1+\\Delta_1)(1+\\Delta_4) - (1+\\Delta_2)(1+\\Delta_3) \\right]$$\n对于小失配 ($|\\Delta_i| \\ll 1$)，我们只保留一阶项：\n$$R_1'R_4' - R_2'R_3' \\approx R_A R_B \\left[ (1+\\Delta_1+\\Delta_4) - (1+\\Delta_2+\\Delta_3) \\right] = R_A R_B (\\Delta_1 - \\Delta_2 - \\Delta_3 + \\Delta_4)$$\n$A_{cm}$ 的分母是 $R_1'(R_3' + R_4')$。一阶近似下，它约等于其标称值：\n$$R_1'(R_3' + R_4') \\approx R_A(R_A + R_B) = R_A^2(1+k)$$\n因此，共模增益的一阶近似为：\n$$A_{cm} \\approx \\frac{R_A R_B (\\Delta_1 - \\Delta_2 - \\Delta_3 + \\Delta_4)}{R_A^2(1+k)} = \\frac{(R_B/R_A)}{1+k} (\\Delta_1 - \\Delta_2 - \\Delta_3 + \\Delta_4)$$\n$$A_{cm} \\approx \\frac{k}{1+k} (\\Delta_1 - \\Delta_2 - \\Delta_3 + \\Delta_4)$$\n差模增益 $A_d$ 的标称值为 $k = R_2/R_1$。失配 $\\Delta_i$ 会引起 $A_d$ 的微小偏差。然而，对于 CMRR 的计算（即 $A_d$ 与 $A_{cm}$ 的比值），主要影响是 $A_{cm}$ 从零变为一个很小的值。$A_d$ 的分数变化对 CMRR 的影响是高阶效应。因此，我们可以近似认为 $A_d \\approx k$。这是一阶灵敏度分析的基础。\n\n那么，共模抑制比为：\n$$\\mathrm{CMRR} = \\left|\\frac{A_d}{A_{cm}}\\right| \\approx \\left| \\frac{k}{\\frac{k}{1+k}(\\Delta_1 - \\Delta_2 - \\Delta_3 + \\Delta_4)} \\right| = \\left| \\frac{1+k}{\\Delta_1 - \\Delta_2 - \\Delta_3 + \\Delta_4} \\right|$$\n为了保证最小的 CMRR，我们必须考虑最坏情况。当分母 $|\\Delta_1 - \\Delta_2 - \\Delta_3 + \\Delta_4|$ 最大化时，CMRR 最小化。在约束条件 $|\\Delta_i| \\leq t$ 下，我们可以通过选择特定的失配组合来最大化该项。令 $\\Delta_1 = t$，$\\Delta_4 = t$，$\\Delta_2 = -t$，以及 $\\Delta_3 = -t$。这些都满足界限。分母变为：\n$$|\\Delta_1 - \\Delta_2 - \\Delta_3 + \\Delta_4|_{max} = |t - (-t) - (-t) + t| = |4t| = 4t$$\n因此，对于给定的匹配规格 $t$，最小（最坏情况）的 CMRR 为：\n$$\\mathrm{CMRR_{min}} = \\frac{1+k}{4t}$$\n问题要求最小 $\\mathrm{CMRR_{dB}}$ 为 $96\\,\\mathrm{dB}$。从线性比率到分贝的转换公式为 $\\mathrm{CMRR_{dB}} = 20 \\log_{10}(\\mathrm{CMRR})$。\n$$20 \\log_{10}(\\mathrm{CMRR_{min}}) \\geq 96$$\n$$\\log_{10}(\\mathrm{CMRR_{min}}) \\geq \\frac{96}{20} = 4.8$$\n$$\\mathrm{CMRR_{min}} \\geq 10^{4.8}$$\n代入我们对 $\\mathrm{CMRR_{min}}$ 的表达式：\n$$\\frac{1+k}{4t} \\geq 10^{4.8}$$\n问题要求能确保此条件的最小匹配规格 $t$。这对应于满足该不等式的最大 $t$ 值，我们通过取等式来求解：\n$$t = \\frac{1+k}{4 \\times 10^{4.8}}$$\n我们已知标称增益 $k=10$。代入此值：\n$$t = \\frac{1+10}{4 \\times 10^{4.8}} = \\frac{11}{4 \\times 10^{4.8}}$$\n现在，我们计算数值：\n$$10^{4.8} \\approx 63095.734$$\n$$t = \\frac{11}{4 \\times 63095.734} = \\frac{11}{252382.937} \\approx 0.000043585$$\n问题要求将答案四舍五入到三位有效数字。\n$$t \\approx 0.0000436$$\n这是在仍然能实现最坏情况 CMRR 至少为 $96\\,\\mathrm{dB}$ 的前提下，电阻可以容忍的最大分数偏差 $t$。",
            "answer": "$$\\boxed{0.0000436}$$"
        },
        {
            "introduction": "为了超越直流和低频近似并全面评估电路性能，我们需要进行频率相关的分析。这项高级练习将模拟一个实际差分放大器的频率响应，指导你如何使用计算节点分析来评估失配和寄生电容在高频下如何降低CMRR。这种方法反映了现代集成电路设计流程中使用的验证方法。",
            "id": "4261578",
            "problem": "给定一个适用于频域分析的差分放大器的小信号线性模型。目标是使用奇偶模激励计算作为角频率函数的差模增益幅度，表示为 $A_d(\\omega)$，以及共模增益幅度 $A_c(\\omega)$。然后，对这些量进行后处理，以获得共模抑制比（CMRR）的幅度随频率变化的函数，表示为 $\\mathrm{CMRR}(\\omega) = \\left|\\frac{A_d(\\omega)}{A_c(\\omega)}\\right|$。您必须将计算实现为一个数值程序，该程序通过频域中的节点分析来求解小信号电路。\n\n小信号电路定义如下。\n\n- 两个输出节点，电压分别为 $v_{o+}$ 和 $v_{o-}$，以及一个尾节点，电压为 $v_t$。\n- 两个跨导器，将电流从每个输出节点注入到尾节点。它们的小信号跨导为 $g_{m1}$ 和 $g_{m2}$，小信号栅源电压为 $v_{gs1} = v_{g+} - v_t$ 和 $v_{gs2} = v_{g-} - v_t$。从每个输出节点流入尾节点的小信号电流为 $i_{gm1} = g_{m1} v_{gs1}$ 和 $i_{gm2} = g_{m2} v_{gs2}$。\n- 每个输出节点都有一个连接到地的负载电阻和电容：$+$ 侧为 $R_{L+}$ 和 $C_{L+}$，$ -$ 侧为 $R_{L-}$ 和 $C_{L-}$。\n- 每个输出节点分别通过小信号输出电阻 $r_{o+}$ 和 $r_{o-}$ 连接到尾节点。\n- 尾节点通过并联的尾电阻 $R_t$ 和尾电容 $C_t$ 连接到地（两者均接地）。\n- 假设所有栅极节点均为高阻抗，不吸取电流。\n\n频域节点方程遵循基尔霍夫电流定律和电容的阻抗。设 $s = j\\omega$ 且 $\\omega = 2\\pi f$，其中 $f$ 的单位是赫兹。对于每个频率，将未知节点电压组合成一个向量 $\\mathbf{v} = [v_{o+}, v_{o-}, v_t]^T$。栅极激励电压 $v_{g+}$ 和 $v_{g-}$ 是用于形成奇偶模激励的外部施加源。\n\n定义以下测量约定：\n\n- 用于差模增益的奇模激励：施加 $v_{g+} = +\\frac{1}{2}$ 和 $v_{g-} = -\\frac{1}{2}$，得到单位差分输入幅度 $v_{id} = v_{g+} - v_{g-} = 1$。计算差分输出 $v_{od} = v_{o+} - v_{o-}$ 并设 $A_d(\\omega) = \\frac{v_{od}}{v_{id}} = v_{o+} - v_{o-}$。\n- 用于共模增益的偶模激励：施加 $v_{g+} = v_{g-} = 1$，得到单位共模输入幅度 $v_{icm} = 1$。计算在此激励下产生的差模输出电压 $v_{od,cm} = v_{o+} - v_{o-}$，并将共模增益定义为 $A_c(\\omega) = \\frac{v_{od,cm}}{v_{icm}} = v_{o+} - v_{o-}$。\n\n您必须从第一性原理出发，使用节点分析实现频域解：\n\n- 对于每个频率，通过对流经无源元件到地和节点之间的电流求和，并包括来自跨导器的受控源电流，写出每个节点对应的线性方程。使用电容导纳 $s C$。\n- 对每种激励（奇模和偶模），求解得到的 $3 \\times 3$ 线性系统，以获得未知节点电压。\n- 使用解出的节点电压，计算 $A_d(\\omega)$ 和 $A_c(\\omega)$，然后计算 $\\left|\\frac{A_d(\\omega)}{A_c(\\omega)}\\right|$ 并通过 $20 \\log_{10}\\left(\\left|\\frac{A_d(\\omega)}{A_c(\\omega)}\\right|\\right)$ 将其表示为分贝。\n\n通过扰动器件和负载参数来引入失配效应：\n\n- 设标称跨导为 $g_m$。则 $g_{m1} = g_m (1 + \\delta_{gm})$ 且 $g_{m2} = g_m (1 - \\delta_{gm})$。\n- 设标称负载电阻为 $R_L$。则 $R_{L+} = R_L (1 + \\delta_{RL})$ 且 $R_{L-} = R_L (1 - \\delta_{RL})$。\n- 除非另有说明，否则假设 $r_{o+} = r_{o-} = r_o$ 且 $C_{L+} = C_{L-} = C_L$。\n\n使用以下测试套件。对于每个测试用例，计算指定频率下 $\\mathrm{CMRR}(\\omega)$ 的分贝幅度。最终输出必须是浮点数，单位为分贝。\n\n频率（单位：赫兹）：\n- $f \\in \\{10^2, 10^4, 10^6, 10^8\\}$。\n\n测试用例（所有电阻单位为欧姆，电容单位为法拉，跨导单位为西门子）：\n1. 具有小失配和有限尾电流源的正常情况：\n   - $g_m = 5 \\times 10^{-3}$，$r_o = 2 \\times 10^5$，$R_L = 10^4$，$C_L = 2 \\times 10^{-12}$，$R_t = 10^5$，$C_t = 1 \\times 10^{-12}$，$\\delta_{gm} = 0.02$，$\\delta_{RL} = 0.01$。\n2. 近乎理想的电流源尾部，无失配：\n   - $g_m = 2 \\times 10^{-3}$，$r_o = 5 \\times 10^5$，$R_L = 2 \\times 10^4$，$C_L = 1 \\times 10^{-12}$，$R_t = 10^9$，$C_t = 1 \\times 10^{-12}$，$\\delta_{gm} = 0.0$，$\\delta_{RL} = 0.0$。\n3. 强失配和中等尾电流源：\n   - $g_m = 3 \\times 10^{-3}$，$r_o = 1.5 \\times 10^5$，$R_L = 8 \\times 10^3$，$C_L = 2 \\times 10^{-12}$，$R_t = 8 \\times 10^4$，$C_t = 1 \\times 10^{-12}$，$\\delta_{gm} = 0.1$，$\\delta_{RL} = 0.1$。\n4. 较重的电容负载和适度失配：\n   - $g_m = 4 \\times 10^{-3}$，$r_o = 2 \\times 10^5$，$R_L = 5 \\times 10^3$，$C_L = 1 \\times 10^{-11}$，$R_t = 2 \\times 10^5$，$C_t = 5 \\times 10^{-12}$，$\\delta_{gm} = 0.03$，$\\delta_{RL} = 0.0$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，该列表用方括号括起来，按测试用例和频率升序排列。具体来说，列出测试用例1在 $10^2, 10^4, 10^6, 10^8$ 赫兹下的 $20 \\log_{10}\\left(\\left|\\frac{A_d(\\omega)}{A_c(\\omega)}\\right|\\right)$ 值，然后是测试用例2在相同频率下的值，依此类推，直到测试用例3和4。\n- 结果以分贝为单位表示为十进制数，每个数四舍五入到三位小数。\n\n所有答案都是无量纲的分贝。不应打印任何百分比或附加文本。程序必须完全独立，不得要求任何用户输入。输出必须只有一行，且格式必须与描述完全一致（例如，\"[x1,x2,...,x16]\"）。",
            "solution": "## 问题验证\n\n### 步骤1：提取已知条件\n- **电路节点**：三个未知电压节点：$v_{o+}$、$v_{o-}$、$v_t$。\n- **输入节点**：两个外部栅极电压源：$v_{g+}$、$v_{g-}$。\n- **跨导器**：\n  - $g_{m1}$，$v_{gs1} = v_{g+} - v_t$，电流 $i_{gm1} = g_{m1} v_{gs1}$ 从 $v_{o+}$ 流向 $v_t$。\n  - $g_{m2}$，$v_{gs2} = v_{g-} - v_t$，电流 $i_{gm2} = g_{m2} v_{gs2}$ 从 $v_{o-}$ 流向 $v_t$。\n- **无源元件**：\n  - $v_{o+}$ 处的负载：$R_{L+}$ 和 $C_{L+}$ 并联到地。\n  - $v_{o-}$ 处的负载：$R_{L-}$ 和 $C_{L-}$ 并联到地。\n  - 输出电阻：$r_{o+}$（在 $v_{o+}$ 和 $v_t$ 之间），$r_{o-}$（在 $v_{o-}$ 和 $v_t$ 之间）。\n  - 尾阻抗：$R_t$ 和 $C_t$ 从节点 $v_t$ 并联到地。\n- **分析方法**：在频域中使用节点分析，其中 $s = j\\omega = j2\\pi f$。系统是一个关于 $\\mathbf{v} = [v_{o+}, v_{o-}, v_t]^T$ 的 $3 \\times 3$ 线性系统。\n- **测量定义**：\n  - **奇模（用于 $A_d$）**：输入 $v_{g+} = +1/2$，$v_{g-} = -1/2$。差分输入 $v_{id} = 1$。差模增益 $A_d(\\omega) = v_{o+} - v_{o-}$。\n  - **偶模（用于 $A_c$）**：输入 $v_{g+} = v_{g-} = 1$。共模输入 $v_{icm} = 1$。共模增益 $A_c(\\omega) = v_{o+} - v_{o-}$。\n- **输出量**：共模抑制比（CMRR），单位为分贝：$\\mathrm{CMRR}_{dB}(\\omega) = 20 \\log_{10}\\left(\\left|\\frac{A_d(\\omega)}{A_c(\\omega)}\\right|\\right)$。\n- **失配模型**：\n  - $g_{m1} = g_m (1 + \\delta_{gm})$，$g_{m2} = g_m (1 - \\delta_{gm})$。\n  - $R_{L+} = R_L (1 + \\delta_{RL})$，$R_{L-} = R_L (1 - \\delta_{RL})$。\n  - 假设 $r_{o+} = r_{o-} = r_o$ 且 $C_{L+} = C_{L-} = C_L$。\n- **分析频率**：$f \\in \\{10^2, 10^4, 10^6, 10^8\\}$ Hz。\n- **测试用例**：已提供四个完整的测试用例。\n\n### 步骤2：使用提取的已知条件进行验证\n问题有效，定义明确，可以从第一性原理通过算法解决。问题的科学依据、良态性、客观性、完整性和一致性都得到了确认。\n\n### 步骤3：结论与行动\n问题有效。将根据节点分析的原理推导并实现解法。\n\n## 解法\n\n该解法需要在频域中对给定的小信号电路模型执行节点分析。我们构建一个 $3 \\times 3$ 的线性方程组 $\\mathbf{Y}\\mathbf{v} = \\mathbf{i}$，其中 $\\mathbf{v} = [v_{o+}, v_{o-}, v_t]^T$ 是未知节点电压的向量，$\\mathbf{Y}$ 是复导纳矩阵，$\\mathbf{i}$ 是流入节点的电流源向量。复频率由 $s = j\\omega$ 给出。\n\n基尔霍夫电流定律（KCL）应用于三个未知节点中的每一个。\n\n**节点 $v_{o+}$ 处的KCL：**\n$$\nv_{o+} \\left( \\frac{1}{R_{L+}} + sC_{L+} + \\frac{1}{r_{o+}} \\right) - v_t \\left( \\frac{1}{r_{o+}} + g_{m1} \\right) = -g_{m1} v_{g+}\n$$\n\n**节点 $v_{o-}$ 处的KCL：**\n$$\nv_{o-} \\left( \\frac{1}{R_{L-}} + sC_{L-} + \\frac{1}{r_{o-}} \\right) - v_t \\left( \\frac{1}{r_{o-}} + g_{m2} \\right) = -g_{m2} v_{g-}\n$$\n\n**节点 $v_t$ 处的KCL：**\n$$\n-v_{o+}\\left(\\frac{1}{r_{o+}}\\right) - v_{o-}\\left(\\frac{1}{r_{o-}}\\right) + v_t \\left( \\frac{1}{R_t} + sC_t + \\frac{1}{r_{o+}} + \\frac{1}{r_{o-}} + g_{m1} + g_{m2} \\right) = g_{m1}v_{g+} + g_{m2}v_{g-}\n$$\n\n系统 $\\mathbf{Y}\\mathbf{v} = \\mathbf{i}$ 定义如下：\n导纳矩阵 $\\mathbf{Y}$：\n$$\n\\mathbf{Y} =\n\\begin{pmatrix}\n\\frac{1}{R_{L+}} + sC_{L+} + \\frac{1}{r_{o+}}  0  -(\\frac{1}{r_{o+}} + g_{m1}) \\\\\n0  \\frac{1}{R_{L-}} + sC_{L-} + \\frac{1}{r_{o-}}  -(\\frac{1}{r_{o-}} + g_{m2}) \\\\\n-\\frac{1}{r_{o+}}  -\\frac{1}{r_{o-}}  \\frac{1}{R_t} + sC_t + \\frac{1}{r_{o+}} + \\frac{1}{r_{o-}} + g_{m1} + g_{m2}\n\\end{pmatrix}\n$$\n源向量 $\\mathbf{i}$，取决于输入激励 $v_{g+}$ 和 $v_{g-}$：\n$$\n\\mathbf{i} =\n\\begin{pmatrix}\n-g_{m1} v_{g+} \\\\\n-g_{m2} v_{g-} \\\\\ng_{m1}v_{g+} + g_{m2}v_{g-}\n\\end{pmatrix}\n$$\n\n对于每个测试用例和频率，我们执行以下步骤：\n1.  计算所有电路参数的数值，包括失配。\n2.  计算复频率 $s = j2\\pi f$。\n3.  构建复数值矩阵 $\\mathbf{Y}$。\n\n4.  **差模增益（$A_d$）计算**：\n    - 施加奇模激励：$v_{g+} = +0.5$ V，$v_{g-} = -0.5$ V。\n    - 构建相应的源向量 $\\mathbf{i}_{odd}$。\n    - 求解线性系统 $\\mathbf{Y}\\mathbf{v}_{odd} = \\mathbf{i}_{odd}$。\n    - 差模增益为 $A_d(\\omega) = v_{o+,odd} - v_{o-,odd}$。\n\n5.  **共模增益（$A_c$）计算**：\n    - 施加偶模激励：$v_{g+} = v_{g-} = 1$ V。\n    - 构建相应的源向量 $\\mathbf{i}_{even}$。\n    - 求解线性系统 $\\mathbf{Y}\\mathbf{v}_{even} = \\mathbf{i}_{even}$。\n    - 根据修正后的定义，共模增益为 $A_c(\\omega) = v_{o+,even} - v_{o-,even}$。\n\n6.  **CMRR计算**：\n    - CMRR幅度计算为 $\\mathrm{CMRR}(\\omega) = \\left|\\frac{A_d(\\omega)}{A_c(\\omega)}\\right|$。\n    - 将其转换为分贝：$\\mathrm{CMRR}_{dB}(\\omega) = 20 \\log_{10}(\\mathrm{CMRR}(\\omega))$。对于理想的对称情况，其中 $A_c(\\omega)$ 为零，CMRR为无穷大。\n\n此过程通过数值程序实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the CMRR of a differential amplifier for multiple test cases\n    and frequencies using nodal analysis.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (gm, ro, RL, CL, Rt, Ct, delta_gm, delta_RL)\n        (5e-3, 2e5, 1e4, 2e-12, 1e5, 1e-12, 0.02, 0.01),\n        (2e-3, 5e5, 2e4, 1e-12, 1e9, 1e-12, 0.0, 0.0),\n        (3e-3, 1.5e5, 8e3, 2e-12, 8e4, 1e-12, 0.1, 0.1),\n        (4e-3, 2e5, 5e3, 1e-11, 2e5, 5e-12, 0.03, 0.0),\n    ]\n\n    # Frequencies in Hz\n    frequencies = [1e2, 1e4, 1e6, 1e8]\n\n    results = []\n    \n    for case_params in test_cases:\n        gm, ro, RL, CL, Rt, Ct, delta_gm, delta_RL = case_params\n        \n        for f in frequencies:\n            # Complex angular frequency\n            s = 1j * 2 * np.pi * f\n\n            # Apply mismatch to parameters\n            gm1 = gm * (1 + delta_gm)\n            gm2 = gm * (1 - delta_gm)\n            RL_plus = RL * (1 + delta_RL)\n            RL_minus = RL * (1 - delta_RL)\n            \n            # Per the problem, ro and CL have no specified mismatch\n            ro_plus = ro\n            ro_minus = ro\n            CL_plus = CL\n            CL_minus = CL\n\n            # Component admittances and conductances\n            go_plus = 1.0 / ro_plus\n            go_minus = 1.0 / ro_minus\n            \n            Y_L_plus = (1.0 / RL_plus) + s * CL_plus\n            Y_L_minus = (1.0 / RL_minus) + s * CL_minus\n            Y_t = (1.0 / Rt) + s * Ct\n\n            # Construct the 3x3 admittance matrix Y\n            Y = np.zeros((3, 3), dtype=np.complex128)\n            \n            Y[0, 0] = Y_L_plus + go_plus\n            Y[0, 2] = -(go_plus + gm1)\n            Y[1, 1] = Y_L_minus + go_minus\n            Y[1, 2] = -(go_minus + gm2)\n            Y[2, 0] = -go_plus\n            Y[2, 1] = -go_minus\n            Y[2, 2] = Y_t + go_plus + go_minus + gm1 + gm2\n            \n            # === Differential-Mode Gain (Ad) Calculation ===\n            vg_plus_odd = 0.5\n            vg_minus_odd = -0.5\n            i_odd = np.array([-gm1 * vg_plus_odd, -gm2 * vg_minus_odd, gm1 * vg_plus_odd + gm2 * vg_minus_odd], dtype=np.complex128)\n            v_odd = np.linalg.solve(Y, i_odd)\n            Ad = v_odd[0] - v_odd[1]\n\n            # === Common-Mode Gain (Ac) Calculation (Corrected Definition) ===\n            vg_plus_even = 1.0\n            vg_minus_even = 1.0\n            i_even = np.array([-gm1 * vg_plus_even, -gm2 * vg_minus_even, gm1 * vg_plus_even + gm2 * vg_minus_even], dtype=np.complex128)\n            v_even = np.linalg.solve(Y, i_even)\n            Ac = v_even[0] - v_even[1] # Corrected: Common-mode-to-differential-mode gain\n            \n            # === CMRR Calculation ===\n            if np.abs(Ac)  1e-18: # Handle perfect symmetry case\n                cmrr_db = 300.0 # Use a large finite number for practically infinite CMRR\n            else:\n                cmrr_mag = np.abs(Ad / Ac)\n                cmrr_db = 20 * np.log10(cmrr_mag)\n            \n            results.append(f\"{cmrr_db:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\n# solve()\n[84.145,84.142,69.319,29.351,300.000,300.000,300.000,300.000,53.111,53.109,44.400,15.352,74.582,74.581,62.463,22.502]\n```"
        }
    ]
}