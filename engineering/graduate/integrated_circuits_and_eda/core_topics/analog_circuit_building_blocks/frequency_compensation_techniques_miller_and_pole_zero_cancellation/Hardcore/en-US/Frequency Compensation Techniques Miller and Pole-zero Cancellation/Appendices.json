{
    "hands_on_practices": [
        {
            "introduction": "This practice focuses on the fundamental mechanism of pole-zero cancellation using a nulling resistor, $R_{z}$. By deriving the two-stage amplifier's transfer function from first principles, you will see precisely how this resistor modifies the compensation network to introduce a stabilizing left-half-plane zero. This exercise will clarify why this technique is so powerful for improving phase margin at high frequencies without affecting the crucial low-frequency DC gain .",
            "id": "4273420",
            "problem": "Consider a $2$-stage operational amplifier used in integrated circuits and Electronic Design Automation (EDA) flows. The first stage is a transconductor with small-signal transconductance $g_{m1}$ and output resistance $r_{o1}$ that produces a node voltage $v_{x}$. The second stage is a transconductor with small-signal transconductance $g_{m2}$ and output resistance $r_{o2}$ that produces the output voltage $v_{o}$. The output node is loaded by a capacitor $C_{L}$ to ground. Between the output node and the intermediate node, a compensation branch consisting of a series resistor $R_{z}$ and a capacitor $C_{c}$ is connected. Assume the feedback factor is a real constant $\\beta$ independent of frequency.\n\nStarting from Kirchhoff’s Current Law (KCL), the linear small-signal transconductor relation $i = g_{m} v$, and the capacitor admittance $Y_{C} = s C$, derive the exact open-loop transfer function $A(s) = \\frac{v_{o}}{v_{i}}$ of this amplifier as a rational function of $s$, explicitly showing how $R_{z}$ enters the expression. Using your derived $A(s)$, analyze the loop transmission $T(s) = \\beta A(s)$.\n\nThen, by taking the appropriate low-frequency limit of your expression, demonstrate whether $R_{z}$ affects the low-frequency loop transmission $T(0)$. In addition, determine the left-half-plane zero introduced by the compensation branch as a function of the circuit parameters, and explain how this zero modifies the high-frequency loop transmission magnitude and phase. Finally, provide a qualitative assessment, based on first principles, of whether introducing $R_{z}$ changes the large-signal slew rate set by the compensation capacitor and the stage-limited charging current.\n\nYour final reported quantity must be the ratio of the low-frequency loop transmission with $R_{z}$ present to the low-frequency loop transmission with $R_{z} = 0$, expressed as a single exact value. No rounding is required. The ratio is dimensionless; do not include any units in your final answer.",
            "solution": "The problem requires the derivation and analysis of the transfer function for a $2$-stage operational amplifier with a specific frequency compensation network. The validation of the problem statement confirms that it is scientifically grounded, well-posed, and objective, based on standard small-signal models used in integrated circuit design. We may therefore proceed with the solution.\n\nFirst, we establish the small-signal model. The amplifier consists of two stages. The first stage, with input voltage $v_i$, is a transconductor producing a current that is a function of $v_i$. This stage has a transconductance $g_{m1}$ and an output resistance $r_{o1}$. The second stage, with input voltage $v_x$ (the output of the first stage), is a transconductor with transconductance $g_{m2}$ and output resistance $r_{o2}$. Its output is the overall amplifier output, $v_o$. A load capacitor $C_L$ is connected from the output node $v_o$ to ground. The compensation network, consisting of a capacitor $C_c$ in series with a resistor $R_z$, is connected between the intermediate node $v_x$ and the output node $v_o$. The admittance of this compensation branch is given by $Y_c(s) = \\frac{1}{R_z + 1/(sC_c)} = \\frac{sC_c}{1+sR_z C_c}$.\n\nWe will use Kirchhoff’s Current Law (KCL) at nodes $v_x$ and $v_o$. We assume the standard convention for a two-stage inverting amplifier, where the transconductance stages sink current.\n\nKCL at the intermediate node $v_x$ (sum of currents leaving the node is zero):\nThe current sunk by the first stage is $g_{m1}v_i$. The current through its output resistance is $v_x/r_{o1}$. The current through the compensation branch is $(v_x - v_o)Y_c(s)$.\n$$g_{m1}v_i + \\frac{v_x}{r_{o1}} + (v_x - v_o)Y_c(s) = 0$$\nRearranging this equation, we get:\n$$v_x\\left(\\frac{1}{r_{o1}} + Y_c(s)\\right) - v_o Y_c(s) = -g_{m1}v_i \\quad (*)$$\n\nKCL at the output node $v_o$ (sum of currents leaving the node is zero):\nThe current sunk by the second stage is $g_{m2}v_x$. The current through its output resistance is $v_o/r_{o2}$. The current through the load capacitor is $v_o s C_L$. The current through the compensation branch is $(v_o - v_x)Y_c(s)$.\n$$g_{m2}v_x + \\frac{v_o}{r_{o2}} + v_o s C_L + (v_o - v_x)Y_c(s) = 0$$\nRearranging this equation to solve for $v_x$:\n$$v_x(g_{m2} - Y_c(s)) + v_o\\left(\\frac{1}{r_{o2}} + sC_L + Y_c(s)\\right) = 0$$\n$$v_x = -v_o \\frac{\\frac{1}{r_{o2}} + sC_L + Y_c(s)}{g_{m2} - Y_c(s)} \\quad (**)$$\n\nNow, we substitute the expression for $v_x$ from $(**)$ into $(*)$:\n$$-v_o \\frac{\\frac{1}{r_{o2}} + sC_L + Y_c(s)}{g_{m2} - Y_c(s)} \\left(\\frac{1}{r_{o1}} + Y_c(s)\\right) - v_o Y_c(s) = -g_{m1}v_i$$\nTo find the open-loop transfer function $A(s) = \\frac{v_o}{v_i}$, we divide by $-v_o$ and $g_{m1}$ and take the reciprocal:\n$$A(s) = \\frac{v_o}{v_i} = \\frac{g_{m1}}{\\frac{\\left(\\frac{1}{r_{o2}} + sC_L + Y_c(s)\\right)\\left(\\frac{1}{r_{o1}} + Y_c(s)\\right)}{g_{m2} - Y_c(s)} + Y_c(s)}$$\n$$A(s) = \\frac{g_{m1}(g_{m2} - Y_c(s))}{\\left(\\frac{1}{r_{o2}} + sC_L + Y_c(s)\\right)\\left(\\frac{1}{r_{o1}} + Y_c(s)\\right) + Y_c(s)(g_{m2} - Y_c(s))}$$\nExpanding the denominator:\n$$D(s) = \\left(\\frac{1}{r_{o1}r_{o2}} + \\frac{Y_c(s)}{r_{o2}} + \\frac{sC_L}{r_{o1}} + sC_L Y_c(s) + \\frac{Y_c(s)}{r_{o1}} + Y_c(s)^2\\right) + (g_{m2}Y_c(s) - Y_c(s)^2)$$\n$$D(s) = \\frac{1}{r_{o1}r_{o2}} + \\frac{sC_L}{r_{o1}} + Y_c(s)\\left(\\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} + sC_L + g_{m2}\\right)$$\nThe transfer function is:\n$$A(s) = \\frac{g_{m1}(g_{m2} - Y_c(s))}{D(s)} = \\frac{g_{m1}(g_{m2} - Y_c(s))}{\\frac{1}{r_{o1}r_{o2}} + \\frac{sC_L}{r_{o1}} + Y_c(s)\\left(g_{m2} + \\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} + sC_L\\right)}$$\nNow, we substitute $Y_c(s) = \\frac{sC_c}{1+sR_z C_c}$:\nThe numerator becomes:\n$$N(s) = g_{m1}\\left(g_{m2} - \\frac{sC_c}{1+sR_z C_c}\\right) = g_{m1}\\frac{g_{m2}(1+sR_z C_c) - sC_c}{1+sR_z C_c} = g_{m1}g_{m2}\\frac{1+sC_c(R_z - 1/g_{m2})}{1+sR_z C_c}$$\nThe denominator becomes:\n$$D(s) = \\frac{1}{r_{o1}r_{o2}} + \\frac{sC_L}{r_{o1}} + \\frac{sC_c}{1+sR_z C_c}\\left(g_{m2} + \\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} + sC_L\\right)$$\nCombining them and multiplying the numerator and denominator by $(1+sR_z C_c)$:\n$$A(s) = \\frac{g_{m1}g_{m2}(1+sC_c(R_z - 1/g_{m2}))}{\\left(\\frac{1}{r_{o1}r_{o2}} + \\frac{sC_L}{r_{o1}}\\right)(1+sR_z C_c) + sC_c\\left(g_{m2} + \\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} + sC_L\\right)}$$\nExpanding the denominator:\n$$D_{full}(s) = \\frac{1}{r_{o1}r_{o2}} + \\frac{s C_c R_z}{r_{o1}r_{o2}} + \\frac{sC_L}{r_{o1}} + s^2\\frac{C_L C_c R_z}{r_{o1}} + sC_c g_{m2} + \\frac{sC_c}{r_{o1}} + \\frac{sC_c}{r_{o2}} + s^2 C_c C_L$$\nCollecting terms in powers of $s$:\n$$D_{full}(s) = \\frac{1}{r_{o1}r_{o2}} + s\\left[C_c\\left(g_{m2} + \\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} + \\frac{R_z}{r_{o1}r_{o2}}\\right) + \\frac{C_L}{r_{o1}}\\right] + s^2\\left[C_c C_L\\left(1 + \\frac{R_z}{r_{o1}}\\right)\\right]$$\nThe exact open-loop transfer function is:\n$$A(s) = \\frac{g_{m1}g_{m2}(1+sC_c(R_z - 1/g_{m2}))}{\\frac{1}{r_{o1}r_{o2}} + s\\left[C_c\\left(g_{m2} + \\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} + \\frac{R_z}{r_{o1}r_{o2}}\\right) + \\frac{C_L}{r_{o1}}\\right] + s^2 C_c C_L\\left(1 + \\frac{R_z}{r_{o1}}\\right)}$$\nThis expression explicitly shows how $R_z$ enters the transfer function, as requested.\n\nNext, we analyze the loop transmission $T(s) = \\beta A(s)$. The problem asks whether $R_z$ affects the low-frequency loop transmission $T(0)$. We find $T(0)$ by setting $s=0$ in the expression for $T(s)$:\n$$T(0) = \\beta A(0) = \\beta \\frac{g_{m1}g_{m2}(1+0)}{\\frac{1}{r_{o1}r_{o2}} + 0 + 0} = \\beta g_{m1}g_{m2}r_{o1}r_{o2}$$\nThe expression for $T(0)$ does not contain $R_z$. Therefore, we have demonstrated that $R_z$ does not affect the low-frequency loop transmission.\n\nThe zero of the transfer function is found by setting the numerator to zero:\n$$1+s_z C_c(R_z - 1/g_{m2}) = 0$$\nSolving for $s_z$:\n$$s_z = -\\frac{1}{C_c(R_z - 1/g_{m2})}$$\nFor this to be a left-half-plane (LHP) zero, $s_z$ must be a negative real number. Since $C_c  0$, we require $R_z - 1/g_{m2}  0$, or $R_z  1/g_{m2}$.\n\nThe LHP zero modifies the high-frequency loop transmission. A zero at frequency $\\omega_z = |s_z| = \\frac{1}{C_c(R_z - 1/g_{m2})}$ affects the Bode plot as follows:\n1.  Magnitude: For frequencies $\\omega  \\omega_z$, the magnitude plot slope increases by $+20$ dB/decade. This effect can be used to counteract the $-20$ dB/decade slope from a pole, effectively flattening the magnitude response around the unity-gain frequency.\n2.  Phase: For frequencies around $\\omega_z$ (roughly from $0.1\\omega_z$ to $10\\omega_z$), the zero contributes a positive phase shift (phase lead), reaching a maximum of $+90^\\circ$. At $\\omega = \\omega_z$, the phase lead is $+45^\\circ$. This is the primary benefit of introducing $R_z$ such that $R_z  1/g_{m2}$. The amplifier's poles contribute phase lag. The second pole, in particular, can reduce the phase margin to unacceptable levels. The phase lead from the LHP zero compensates for some of the phase lag from the poles, thus increasing the phase margin and improving the stability of the closed-loop amplifier. This technique is known as pole-zero cancellation, where the LHP zero is placed to cancel the effect of the second pole of the amplifier.\n\nFinally, we provide a qualitative assessment of the effect of $R_z$ on the slew rate. Slew rate is a large-signal phenomenon, determined by the maximum current available to charge a capacitor. In this circuit, the slew rate is typically limited by the first stage's maximum available output current (its tail current, $I_{tail1}$) charging the compensation capacitor $C_c$. The slew rate at the output is $SR = \\frac{dV_o}{dt}|_{max}$. During slewing, the first stage is overdriven and provides a constant current $I_{tail1}$ into or out of the compensation branch. This current must flow through the series combination of $R_z$ and $C_c$. The rate of change of voltage *across the capacitor* $C_c$ is still given by $\\frac{dV_{Cc}}{dt} = \\frac{I_{tail1}}{C_c}$. During slewing, the feedback loop is open and the second stage is also saturated, causing its input voltage $v_x$ to be clamped at a nearly constant saturation level. The output voltage $v_o$ is related to $v_x$ through the compensation branch. The fundamental limiting process is the charging of $C_c$ by the finite current $I_{tail1}$. The presence of $R_z$ in series does not change this limiting current or the value of $C_c$. It will cause an instantaneous voltage step of $I_{tail1}R_z$ at node $v_x$ at the onset of slewing, but it does not alter the subsequent steady-state rate of voltage change at the output. Therefore, to a first-order approximation, introducing $R_z$ does not change the large-signal slew rate, which remains $SR \\approx \\frac{I_{tail1}}{C_c}$.\n\nThe final required quantity is the ratio of the low-frequency loop transmission with $R_z$ present to that with $R_z=0$.\nAs demonstrated, the low-frequency loop transmission is $T(0) = \\beta g_{m1}g_{m2}r_{o1}r_{o2}$, which is independent of $R_z$.\nLet $T(0)|_{R_z}$ be $T(0)$ with a non-zero $R_z$, and $T(0)|_{R_z=0}$ be $T(0)$ with $R_z=0$.\n$$T(0)|_{R_z} = \\beta g_{m1}g_{m2}r_{o1}r_{o2}$$\n$$T(0)|_{R_z=0} = \\beta g_{m1}g_{m2}r_{o1}r_{o2}$$\nThe ratio is:\n$$\\frac{T(0)|_{R_z}}{T(0)|_{R_z=0}} = \\frac{\\beta g_{m1}g_{m2}r_{o1}r_{o2}}{\\beta g_{m1}g_{m2}r_{o1}r_{o2}} = 1$$",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "Ideal pole-zero cancellation provides excellent stability, but its effectiveness in real circuits depends on its robustness to parameter variations. This exercise explores a critical practical scenario: the effect of a changing load resistance on a compensated amplifier's output pole. You will analyze how connecting a load $R_L$ shifts the pole's location, thereby breaking the carefully tuned cancellation and creating a pole-zero doublet that can degrade transient performance .",
            "id": "4273330",
            "problem": "Consider a single-ended two-stage operational amplifier intended for precision applications in Electronic Design Automation (EDA). The second stage can be modeled at its output node as a Norton equivalent consisting of a small-signal current source driving a parallel combination of an output resistance $R_o$ and a load capacitance $C_L$. The frequency compensation is implemented using a pole-zero cancellation technique achieved by a series resistor-capacitor network in a Miller path, tuned such that, with only $C_L$ present at the output, the introduced left-half-plane zero exactly cancels the output pole. Subsequently, a resistive load $R_L$ is connected in parallel with $C_L$ at the output node (for example, due to a downstream measurement or interfacing instrument).\n\nStarting from Kirchhoff’s Current Law and the constitutive relations for capacitors and resistors, model the output node as a linear time-invariant one-port and determine:\n\n- The new output pole’s angular frequency after $R_L$ is added in parallel to $C_L$.\n- The multiplicative pole shift factor $S$, defined as $S = \\omega_{p,\\text{new}} / \\omega_{p,\\text{old}}$, where $\\omega_{p,\\text{old}}$ is the output pole angular frequency before adding $R_L$ and $\\omega_{p,\\text{new}}$ is after adding $R_L$.\n- Whether the original pole-zero cancellation still holds when $R_L$ is added, assuming the compensating zero’s frequency is unchanged by the addition of $R_L$.\n\nExpress your final answer as the closed-form analytical expression for the shift factor $S$. No numerical evaluation is required. The final answer is unitless. Do not round.",
            "solution": "The problem requires an analysis of the output stage of a two-stage operational amplifier to determine the effect of adding a resistive load, $R_L$, on the output pole frequency. We are asked to find the new pole frequency, the pole shift factor, and to comment on the validity of the original pole-zero cancellation. The analysis will be based on modeling the output node as a linear time-invariant (LTI) one-port system, starting from first principles.\n\nFirst, we analyze the circuit configuration **before** the resistive load $R_L$ is added. The output node is modeled as a Norton equivalent, which consists of a small-signal current source, let us denote its output current as $i_{in}(t)$, driving a parallel combination of the amplifier's intrinsic output resistance $R_o$ and the load capacitance $C_L$. Let $v_o(t)$ be the small-signal voltage at the output node.\n\nApplying Kirchhoff’s Current Law (KCL) at the output node, the total current from the source must equal the sum of the currents through the parallel elements:\n$$i_{in}(t) = i_{R_o}(t) + i_{C_L}(t)$$\nUsing the constitutive relations for the resistor and capacitor, we have $i_{R_o}(t) = v_o(t) / R_o$ and $i_{C_L}(t) = C_L \\frac{dv_o(t)}{dt}$. Substituting these into the KCL equation yields the governing first-order linear ordinary differential equation for the output node:\n$$i_{in}(t) = \\frac{v_o(t)}{R_o} + C_L \\frac{dv_o(t)}{dt}$$\nTo find the pole of the system, we transform this equation into the Laplace domain. Let $I_{in}(s)$ and $V_o(s)$ be the Laplace transforms of $i_{in}(t)$ and $v_o(t)$, respectively. Assuming zero initial conditions, the transform of the derivative is $sV_o(s)$. The equation becomes:\n$$I_{in}(s) = \\frac{V_o(s)}{R_o} + s C_L V_o(s) = V_o(s) \\left(\\frac{1}{R_o} + s C_L\\right)$$\nThe transfer function from the input current to the output voltage is the output impedance, $Z_{o,\\text{old}}(s)$:\n$$Z_{o,\\text{old}}(s) = \\frac{V_o(s)}{I_{in}(s)} = \\frac{1}{\\frac{1}{R_o} + s C_L} = \\frac{R_o}{1 + s R_o C_L}$$\nA pole is a value of the complex frequency variable $s$ for which the transfer function's magnitude goes to infinity. This occurs when the denominator is zero. The pole, $s_{p,\\text{old}}$, is located at:\n$$1 + s_{p,\\text{old}} R_o C_L = 0 \\implies s_{p,\\text{old}} = -\\frac{1}{R_o C_L}$$\nThe output pole's angular frequency, $\\omega_{p,\\text{old}}$, is defined as the magnitude of this pole location (or, equivalently, the reciprocal of the system's time constant $\\tau = R_o C_L$).\n$$\\omega_{p,\\text{old}} = \\frac{1}{R_o C_L}$$\nThis is the frequency of the output pole before the addition of $R_L$.\n\nNext, we analyze the circuit configuration **after** the resistive load $R_L$ is connected in parallel with $C_L$ and $R_o$. The total impedance at the output node now includes $R_L$. The KCL equation at the output node is updated to include the current through $R_L$:\n$$i_{in}(t) = i_{R_o}(t) + i_{R_L}(t) + i_{C_L}(t)$$\nUsing the constitutive relations, $i_{R_L}(t) = v_o(t) / R_L$. The differential equation becomes:\n$$i_{in}(t) = \\frac{v_o(t)}{R_o} + \\frac{v_o(t)}{R_L} + C_L \\frac{dv_o(t)}{dt} = v_o(t) \\left(\\frac{1}{R_o} + \\frac{1}{R_L}\\right) + C_L \\frac{dv_o(t)}{dt}$$\nWe can define an equivalent resistance, $R_{eq}$, as the parallel combination of $R_o$ and $R_L$:\n$$R_{eq} = R_o \\parallel R_L = \\left(\\frac{1}{R_o} + \\frac{1}{R_L}\\right)^{-1} = \\frac{R_o R_L}{R_o + R_L}$$\nSubstituting $R_{eq}$ into the differential equation simplifies it to a form analogous to the original case:\n$$i_{in}(t) = \\frac{v_o(t)}{R_{eq}} + C_L \\frac{dv_o(t)}{dt}$$\nFollowing the same procedure in the Laplace domain, the new output impedance $Z_{o,\\text{new}}(s)$ is:\n$$Z_{o,\\text{new}}(s) = \\frac{R_{eq}}{1 + s R_{eq} C_L}$$\nThe new pole, $s_{p, \\text{new}}$, is found by setting the denominator to zero:\n$$1 + s_{p, \\text{new}} R_{eq} C_L = 0 \\implies s_{p, \\text{new}} = -\\frac{1}{R_{eq} C_L}$$\nThe new output pole's angular frequency, $\\omega_{p,\\text{new}}$, is therefore:\n$$\\omega_{p,\\text{new}} = \\frac{1}{R_{eq} C_L} = \\frac{1}{\\left(\\frac{R_o R_L}{R_o + R_L}\\right) C_L} = \\frac{R_o + R_L}{R_o R_L C_L}$$\nThis is the first required result.\n\nThe second task is to find the multiplicative pole shift factor $S$, defined as $S = \\omega_{p,\\text{new}} / \\omega_{p,\\text{old}}$. Using the expressions derived above:\n$$S = \\frac{\\omega_{p,\\text{new}}}{\\omega_{p,\\text{old}}} = \\frac{\\frac{R_o + R_L}{R_o R_L C_L}}{\\frac{1}{R_o C_L}}$$\nSimplifying the expression:\n$$S = \\frac{R_o + R_L}{R_o R_L C_L} \\cdot (R_o C_L) = \\frac{R_o + R_L}{R_L}$$\nThis can be written as:\n$$S = 1 + \\frac{R_o}{R_L}$$\nThis is the closed-form expression for the shift factor $S$.\n\nThe final task is to determine if the original pole-zero cancellation still holds. Initially, the compensating zero, let its frequency be $\\omega_z$, was tuned to cancel the output pole. This implies:\n$$\\omega_z = \\omega_{p,\\text{old}}$$\nThe problem states to assume that $\\omega_z$ is unchanged by the addition of $R_L$. The new pole frequency is $\\omega_{p,\\text{new}} = S \\cdot \\omega_{p,\\text{old}}$. For cancellation to still hold, we would need $\\omega_z = \\omega_{p,\\text{new}}$. This requires $\\omega_{p,\\text{old}} = \\omega_{p,\\text{new}}$, which means $S$ must be equal to $1$.\nFrom our expression $S = 1 + \\frac{R_o}{R_L}$, the condition $S = 1$ would only be met if $\\frac{R_o}{R_L} = 0$. Since $R_o$ represents a physical resistance and is non-zero (otherwise there would be no initial pole at a finite frequency to cancel), this condition requires $R_L \\to \\infty$. The condition $R_L \\to \\infty$ means that no resistive load was added, which contradicts the premise. For any finite, non-zero $R_L$, we have $\\frac{R_o}{R_L} > 0$ because resistances are positive quantities.\nTherefore, $S > 1$, which implies $\\omega_{p,\\text{new}} > \\omega_{p,\\text{old}}$.\nSince $\\omega_z = \\omega_{p,\\text{old}}$ and $\\omega_{p,\\text{new}} > \\omega_{p,\\text{old}}$, it is unequivocally true that $\\omega_z \\neq \\omega_{p,\\text{new}}$. The addition of the resistive load $R_L$ shifts the output pole to a higher frequency, breaking the pole-zero cancellation. A pole-zero doublet is created in the amplifier's transfer function, which can degrade its transient settling performance.",
            "answer": "$$\\boxed{1 + \\frac{R_o}{R_L}}$$"
        },
        {
            "introduction": "Effective circuit design involves navigating complex trade-offs between competing performance metrics. This advanced practice places you in the role of a designer tasked with optimizing a compensated amplifier by minimizing a combined error function representing noise, slewing, and settling behavior. By applying constrained optimization techniques, you will determine the optimal design choices for transconductance and compensation capacitance that satisfy a strict phase margin requirement, revealing the principles behind co-optimizing for speed, noise, and stability .",
            "id": "4273397",
            "problem": "Consider a two-stage Metal-Oxide-Semiconductor (MOS) operational amplifier configured as a unity-gain buffer. The first stage is a transconductor with transconductance $g_{m1}$ driving the second stage with transconductance $g_{m2}$, which in turn drives a capacitive load $C_{L}$. The amplifier is Miller compensated using a compensation capacitor $C_{c}$ placed between the intermediate node and the output. A nulling resistor $R_{z}$ is inserted in series with $C_{c}$ to implement pole-zero cancellation; take $R_{z}=1/g_{m2}$ so that the left-half-plane zero due to $(R_{z},C_{c})$ nominally aligns with the second pole. Let the cancellation be imperfect and parameterize it by a residual factor $0\\eta\\leq 1$, with the effective non-dominant pole modeled as $\\omega_{p2}\\approx \\eta\\,g_{m2}/C_{L}$ and the effective zero as $\\omega_{z}\\approx g_{m2}/C_{c}$.\n\nYou are tasked with selecting the pair $(g_{m1},C_{c})$ to minimize a weighted total error metric that accounts for white thermal noise, slewing, and linear settling, plus a design penalty proportional to $C_{c}$ that captures the silicon area and parasitic cost of large on-chip capacitors. The total error metric is\n$$\nJ(g_{m1},C_{c}) \\;=\\; w_{n}\\,E_{\\mathrm{noise}} \\;+\\; w_{s}\\,E_{\\mathrm{slew}} \\;+\\; w_{\\ell}\\,E_{\\mathrm{settle}} \\;+\\; w_{c}\\,C_{c},\n$$\nwhere $w_{n}0$, $w_{s}0$, $w_{\\ell}0$, and $w_{c}0$ are fixed weights. Assume:\n\n1. The dominant unity-gain bandwidth is set by the compensation and first-stage transconductance, $\\omega_{u}=\\dfrac{g_{m1}}{C_{c}}$.\n\n2. The input-referred white noise spectral density of the first transconductor is $S_{v_{n}}=\\dfrac{4 k_{B} T_{0}\\,\\gamma_{n}}{g_{m1}}$, where $k_{B}$ is the Boltzmann constant, $T_{0}$ is the ambient temperature, and $\\gamma_{n}$ is the channel thermal noise factor. Model the integrated noise over the closed-loop unity-gain bandwidth as $E_{\\mathrm{noise}}=\\displaystyle\\int_{0}^{\\omega_{u}} S_{v_{n}}\\,\\dfrac{d\\omega}{2\\pi}$.\n\n3. The slew-limited residual error at a fixed assessment horizon $\\Delta t0$ after a step of amplitude $V_{\\mathrm{step}}0$ scales inversely with the slew rate. For a differential pair feeding the compensation capacitor, take the maximum slew rate as $\\mathrm{SR}=\\dfrac{I_{1}}{C_{c}}$ with $I_{1}\\approx \\dfrac{g_{m1}V_{\\mathrm{ov1}}}{2}$, where $V_{\\mathrm{ov1}}$ is the overdrive voltage of the input devices. Model the slewing error as $E_{\\mathrm{slew}}=\\dfrac{V_{\\mathrm{step}}}{\\mathrm{SR}\\,\\Delta t}$.\n\n4. The linear settling error remaining at a fixed assessment time $t_{f}0$ scales like the residue after first-order decay with time constant $\\tau\\approx 1/\\omega_{u}$, i.e., $E_{\\mathrm{settle}}=V_{\\mathrm{step}}\\exp\\!\\big(-\\omega_{u} t_{f}\\big)$.\n\nImpose the phase margin constraint $\\mathrm{PM}\\geq 60^{\\circ}$. Under the standard two-pole-plus-zero approximation for a Miller-compensated two-stage amplifier with partial pole-zero cancellation, approximate the phase margin at $\\omega_{u}$ by\n$$\n\\mathrm{PM} \\;\\approx\\; 90^{\\circ} \\;-\\; \\arctan\\!\\Big(\\frac{\\omega_{u}}{\\omega_{p2}}\\Big),\n$$\nand enforce $\\mathrm{PM}\\geq 60^{\\circ}$ using the above model of $\\omega_{p2}$.\n\nStarting from these definitions and approximations, set up the constrained optimization problem and carry out the full derivation to obtain closed-form design equations for the optimal pair $(g_{m1}^{\\star},C_{c}^{\\star})$ that minimizes $J(g_{m1},C_{c})$ subject to $\\mathrm{PM}\\geq 60^{\\circ}$. Express your final answer as a single row matrix giving $g_{m1}^{\\star}$ and $C_{c}^{\\star}$ in terms of the parameters $\\{w_{n},w_{s},w_{\\ell},w_{c},k_{B},T_{0},\\gamma_{n},V_{\\mathrm{ov1}},V_{\\mathrm{step}},\\Delta t,t_{f},g_{m2},C_{L},\\eta\\}$; no rounding is required.",
            "solution": "The problem is to find the optimal first-stage transconductance $g_{m1}^{\\star}$ and compensation capacitance $C_{c}^{\\star}$ that minimize a total error metric $J(g_{m1}, C_{c})$ subject to a phase margin constraint. The optimization variables are $(g_{m1}, C_{c})$.\n\nFirst, we formulate the objective function $J(g_{m1}, C_{c})$ using the provided definitions. The objective function is a weighted sum of four terms:\n$$\nJ(g_{m1},C_{c}) = w_{n}E_{\\mathrm{noise}} + w_{s}E_{\\mathrm{slew}} + w_{\\ell}E_{\\mathrm{settle}} + w_{c}C_{c}\n$$\nWe express each error component in terms of the optimization variables $g_{m1}$ and $C_{c}$.\n\n1.  Noise Error ($E_{\\mathrm{noise}}$):\n    The input-referred white noise spectral density is given as $S_{v_{n}} = \\frac{4 k_{B} T_{0}\\gamma_{n}}{g_{m1}}$. The integrated noise error is calculated over the unity-gain bandwidth $\\omega_{u} = g_{m1}/C_{c}$.\n    $$\n    E_{\\mathrm{noise}} = \\int_{0}^{\\omega_{u}} S_{v_{n}}\\,\\dfrac{d\\omega}{2\\pi} = S_{v_{n}} \\frac{\\omega_{u}}{2\\pi} = \\left(\\frac{4 k_{B} T_{0}\\gamma_{n}}{g_{m1}}\\right) \\left(\\frac{g_{m1}/C_{c}}{2\\pi}\\right) = \\frac{2 k_{B} T_{0}\\gamma_{n}}{\\pi C_{c}}\n    $$\n    This term depends only on $C_c$.\n\n2.  Slewing Error ($E_{\\mathrm{slew}}$):\n    The slew rate is $\\mathrm{SR} = \\frac{I_{1}}{C_{c}}$, with $I_{1} \\approx \\frac{g_{m1}V_{\\mathrm{ov1}}}{2}$. Thus, $\\mathrm{SR} = \\frac{g_{m1}V_{\\mathrm{ov1}}}{2C_{c}}$.\n    The slewing error is given by $E_{\\mathrm{slew}} = \\frac{V_{\\mathrm{step}}}{\\mathrm{SR}\\,\\Delta t}$.\n    $$\n    E_{\\mathrm{slew}} = \\frac{V_{\\mathrm{step}}}{\\left(\\frac{g_{m1}V_{\\mathrm{ov1}}}{2C_{c}}\\right)\\Delta t} = \\frac{2 V_{\\mathrm{step}} C_{c}}{g_{m1} V_{\\mathrm{ov1}} \\Delta t}\n    $$\n    This term depends on the ratio $C_c/g_{m1}$.\n\n3.  Linear Settling Error ($E_{\\mathrm{settle}}$):\n    The settling error is modeled as $E_{\\mathrm{settle}} = V_{\\mathrm{step}}\\exp(-\\omega_{u} t_{f})$, with the time constant $\\tau \\approx 1/\\omega_u$ and $\\omega_{u} = g_{m1}/C_{c}$.\n    $$\n    E_{\\mathrm{settle}} = V_{\\mathrm{step}}\\exp\\left(-\\frac{g_{m1}}{C_{c}} t_{f}\\right)\n    $$\n    This term depends on the ratio $g_{m1}/C_{c}$.\n\n4.  Capacitor Penalty:\n    This term is given directly as $w_c C_c$.\n\nCombining these terms, the total objective function is:\n$$\nJ(g_{m1},C_{c}) = w_{n}\\left(\\frac{2 k_{B} T_{0}\\gamma_{n}}{\\pi C_{c}}\\right) + w_{s}\\left(\\frac{2 V_{\\mathrm{step}} C_{c}}{g_{m1} V_{\\mathrm{ov1}} \\Delta t}\\right) + w_{\\ell}V_{\\mathrm{step}}\\exp\\left(-\\frac{g_{m1}}{C_{c}} t_{f}\\right) + w_{c}C_{c}\n$$\n\nNext, we formalize the phase margin constraint. The problem specifies $\\mathrm{PM} \\geq 60^{\\circ}$ and provides the approximation:\n$$\n\\mathrm{PM} \\approx 90^{\\circ} - \\arctan\\left(\\frac{\\omega_{u}}{\\omega_{p2}}\\right)\n$$\nSubstituting the constraint $\\mathrm{PM} \\geq 60^{\\circ}$:\n$$\n90^{\\circ} - \\arctan\\left(\\frac{\\omega_{u}}{\\omega_{p2}}\\right) \\geq 60^{\\circ} \\implies 30^{\\circ} \\geq \\arctan\\left(\\frac{\\omega_{u}}{\\omega_{p2}}\\right)\n$$\nSince $\\arctan(x)$ is a monotonically increasing function, we can take the tangent of both sides:\n$$\n\\tan(30^{\\circ}) \\geq \\frac{\\omega_{u}}{\\omega_{p2}} \\implies \\frac{1}{\\sqrt{3}} \\geq \\frac{\\omega_{u}}{\\omega_{p2}}\n$$\nThis gives the constraint $\\omega_{u} \\leq \\frac{\\omega_{p2}}{\\sqrt{3}}$. We substitute the given expressions $\\omega_{u} = g_{m1}/C_{c}$ and $\\omega_{p2} = \\eta g_{m2}/C_{L}$:\n$$\n\\frac{g_{m1}}{C_{c}} \\leq \\frac{1}{\\sqrt{3}}\\left(\\frac{\\eta g_{m2}}{C_{L}}\\right)\n$$\nThis inequality defines the feasible region for the design parameters.\n\nThe problem is now a constrained optimization: minimize $J(g_{m1}, C_{c})$ subject to the derived inequality. To simplify the problem, we perform a change of variables. Let $u = \\omega_{u} = g_{m1}/C_{c}$ and let the other variable be $C_{c}$. The optimization variables are now $(u, C_{c})$. The objective function becomes:\n$$\nJ(u, C_{c}) = \\left(w_{c}C_{c} + \\frac{2 w_{n} k_{B} T_{0}\\gamma_{n}}{\\pi C_{c}}\\right) + \\left(\\frac{2 w_{s} V_{\\mathrm{step}}}{u V_{\\mathrm{ov1}} \\Delta t} + w_{\\ell}V_{\\mathrm{step}}\\exp(-u t_{f})\\right)\n$$\nThe constraint becomes $u \\leq u_{\\max}$, where $u_{\\max} = \\frac{\\eta g_{m2}}{\\sqrt{3} C_L}$.\n\nThe objective function has advantageously separated into a sum of two independent functions, one depending only on $C_c$ and the other only on $u$:\n$$\nJ(u, C_{c}) = J_{1}(C_c) + J_{2}(u)\n$$\nwhere\n$$\nJ_{1}(C_c) = w_{c}C_{c} + \\frac{1}{C_{c}}\\left(\\frac{2 w_{n} k_{B} T_{0}\\gamma_{n}}{\\pi}\\right)\n$$\n$$\nJ_{2}(u) = \\frac{1}{u}\\left(\\frac{2 w_{s} V_{\\mathrm{step}}}{V_{\\mathrm{ov1}} \\Delta t}\\right) + w_{\\ell}V_{\\mathrm{step}}\\exp(-u t_{f})\n$$\nWe can minimize $J_{1}(C_c)$ and $J_{2}(u)$ independently.\n\nMinimization of $J_{1}(C_c)$:\nTo find the minimum of $J_{1}(C_c)$ for $C_c  0$, we compute its derivative with respect to $C_c$ and set it to zero.\n$$\n\\frac{dJ_{1}}{dC_{c}} = w_{c} - \\frac{1}{C_{c}^{2}}\\left(\\frac{2 w_{n} k_{B} T_{0}\\gamma_{n}}{\\pi}\\right) = 0\n$$\nSolving for $C_c$ gives the optimal value $C_{c}^{\\star}$:\n$$\nC_{c}^{\\star} = \\sqrt{\\frac{2 w_{n} k_{B} T_{0}\\gamma_{n}}{\\pi w_{c}}}\n$$\nThe second derivative $\\frac{d^{2}J_{1}}{dC_{c}^{2}} = \\frac{2}{C_{c}^{3}}\\left(\\frac{2 w_{n} k_{B} T_{0}\\gamma_{n}}{\\pi}\\right)$ is positive for $C_{c}0$, confirming this is a minimum.\n\nMinimization of $J_{2}(u)$:\nWe need to minimize $J_{2}(u)$ subject to $0  u \\leq u_{\\max}$. Let's analyze the derivative of $J_{2}(u)$:\n$$\n\\frac{dJ_{2}}{du} = -\\frac{1}{u^{2}}\\left(\\frac{2 w_{s} V_{\\mathrm{step}}}{V_{\\mathrm{ov1}} \\Delta t}\\right) - t_{f} w_{\\ell}V_{\\mathrm{step}}\\exp(-u t_{f})\n$$\nThe problem states that all weights ($w_s, w_{\\ell}$) and physical parameters ($V_{\\mathrm{step}}, V_{\\mathrm{ov1}}, \\Delta t, t_f$) are positive. Therefore, both terms in the derivative are negative for all $u > 0$. This means $\\frac{dJ_{2}}{du}  0$, so $J_{2}(u)$ is a strictly monotonically decreasing function of $u$. To minimize $J_{2}(u)$ over the feasible interval $(0, u_{\\max}]$, we must choose the largest possible value for $u$.\nThus, the optimal value $u^{\\star}$ is at the boundary of the constraint:\n$$\nu^{\\star} = u_{\\max} = \\frac{\\eta g_{m2}}{\\sqrt{3} C_L}\n$$\nThis means that the optimal design operates exactly at the phase margin limit of $60^{\\circ}$.\n\nFinally, we combine these results to find the optimal parameters $(g_{m1}^{\\star}, C_{c}^{\\star})$. We have already found $C_{c}^{\\star}$. We find $g_{m1}^{\\star}$ using the relation $u^{\\star} = g_{m1}^{\\star}/C_{c}^{\\star}$.\n$$\ng_{m1}^{\\star} = u^{\\star} C_{c}^{\\star} = \\left(\\frac{\\eta g_{m2}}{\\sqrt{3} C_L}\\right) \\left(\\sqrt{\\frac{2 w_n k_B T_{0}\\gamma_{n}}{\\pi w_c}}\\right)\n$$\nThe optimal design parameters are therefore:\n$$\nC_{c}^{\\star} = \\sqrt{\\frac{2 w_n k_B T_{0}\\gamma_{n}}{\\pi w_c}}\n$$\n$$\ng_{m1}^{\\star} = \\frac{\\eta g_{m2}}{\\sqrt{3} C_L} \\sqrt{\\frac{2 w_n k_B T_{0}\\gamma_{n}}{\\pi w_c}}\n$$\nThese expressions provide the complete solution for the optimal design pair in terms of the given system parameters.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\eta g_{m2}}{\\sqrt{3} C_{L}} \\sqrt{\\frac{2 w_{n} k_{B} T_{0}\\gamma_{n}}{\\pi w_{c}}}  \\sqrt{\\frac{2 w_{n} k_{B} T_{0}\\gamma_{n}}{\\pi w_{c}}} \\end{pmatrix}}\n$$"
        }
    ]
}