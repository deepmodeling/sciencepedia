{
    "hands_on_practices": [
        {
            "introduction": "理解放大器稳定性的第一步，是将相位裕度等性能指标转化为具体的电路参数。本练习提供了一项基础实践：计算确保稳定设计所需的最小补偿电容 $C_c$，这是任何模拟电路设计师都必须掌握的关键技能。通过这个练习，您可以将抽象的稳定性理论应用于实际的电路元件取值问题。",
            "id": "4286816",
            "problem": "考虑一个配置为单位增益缓冲器并在电子设计自动化（EDA）流程中进行分析的两级互补金属氧化物半导体（MOS）运算放大器（op-amp）。第一级是跨导为 $g_{m1}$ 的跨导放大器，第二级呈现有限的输出电阻 $r_{o2}$。一个米勒补偿电容 $C_c$ 从第二级的输出端连接回两级之间的中间节点，以稳定放大器。该缓冲器在输出节点驱动一个外部负载电容 $C_L$。假设以下物理和建模条件成立：\n\n1. 在感兴趣的频率范围内，开环传递函数可以由两个主极点近似，一个与补偿节点相关，另一个与输出节点相关。高频寄生参数和任何额外的非主导极点在频率上相距足够远，因此在估算相位裕度时可以忽略。\n2. 已实施一种零点对消策略（例如，在 $C_c$ 上串联一个适当大小的电阻），使得补偿网络引入的任何零点都位于左半平面，并被放置在足够高的频率上，以至于其在单位增益频率处的相位贡献对于保守设计而言可以忽略不计。\n3. 单位反馈系数为 $1$，单位增益频率由第一级跨导和补偿电容在补偿节点处的相互作用设定，而第二个极点由输出节点处的负载电容和第二级的有限输出电阻设定。\n\n在这些假设下，并取 $g_{m1} = 2.0 \\times 10^{-4}\\,\\text{S}$，$r_{o2} = 1.0 \\times 10^{4}\\,\\Omega$ 和 $C_L = 10 \\times 10^{-12}\\,\\text{F}$，请从基本原理出发，推导在单位增益缓冲器配置下，为确保相位裕度 $\\phi_m \\geq 60^\\circ$ 所需的补偿电容 $C_c$ 的最小值。您的推导必须从反馈系统中相位裕度的基本定义以及基于电路元件的物理合理的极点位置开始。\n\n将您关于 $C_c$ 的最终答案以皮法（pF）为单位表示。将您的答案四舍五入到三位有效数字。",
            "solution": "所述问题具有科学依据，提法恰当，客观，并包含足够的信息以获得唯一解。因此，我们可以进行推导。\n\n运算放大器在反馈配置中的稳定性由其开环传递函数决定，我们将其表示为 $A(s)$。根据问题陈述，该传递函数可由一个具有两个主极点的模型近似。此外，我们得知单位增益频率 $\\omega_u$ 由第一级设定，在 $\\omega_u$ 处，第一个极点的相位贡献为 $-90^\\circ$。对于远高于第一极点频率 $\\omega_{p1}$ 的频率 $\\omega$，传递函数可以精确地近似为：\n$$A(s) \\approx \\frac{\\omega_u}{s \\left(1 + \\frac{s}{\\omega_{p2}}\\right)}$$\n其中 $s = j\\omega$ 用于正弦稳态分析。该表达式正确地捕捉了由主极点引起的 $-20\\,\\text{dB/decade}$ 的滚降，并包含了第二极点 $\\omega_{p2}$ 的影响。由米勒补偿网络引入的零点被假设在足够高的频率上，以至于其在 $\\omega_u$ 处的相位影响可以忽略不计。\n\n相位裕度 $\\phi_m$ 定义在单位增益频率 $\\omega_u$ 处，此时开环增益的幅度为1，即 $|A(j\\omega_u)|=1$。相位裕度是 $A(j\\omega_u)$ 的相位超过 $-180^\\circ$ 的量：\n$$\\phi_m = 180^\\circ + \\angle A(j\\omega_u)$$\n\n首先，我们确定开环传递函数的相位 $\\angle A(j\\omega)$：\n$$\\angle A(j\\omega) = \\angle\\left(\\frac{\\omega_u}{j\\omega}\\right) + \\angle\\left(\\frac{1}{1 + \\frac{j\\omega}{\\omega_{p2}}}\\right)$$\n$$\\angle A(j\\omega) = -90^\\circ - \\arctan\\left(\\frac{\\omega}{\\omega_{p2}}\\right)$$\n\n在单位增益频率 $\\omega = \\omega_u$ 处计算该表达式，我们得到：\n$$\\angle A(j\\omega_u) = -90^\\circ - \\arctan\\left(\\frac{\\omega_u}{\\omega_{p2}}\\right)$$\n\n现在，我们可以写出相位裕度的表达式：\n$$\\phi_m = 180^\\circ + \\left(-90^\\circ - \\arctan\\left(\\frac{\\omega_u}{\\omega_{p2}}\\right)\\right)$$\n$$\\phi_m = 90^\\circ - \\arctan\\left(\\frac{\\omega_u}{\\omega_{p2}}\\right)$$\n\n问题要求最小相位裕度为 $\\phi_m \\geq 60^\\circ$。我们将此条件代入我们的方程：\n$$60^\\circ \\leq 90^\\circ - \\arctan\\left(\\frac{\\omega_u}{\\omega_{p2}}\\right)$$\n重新整理不等式，我们得到对极点位置的约束：\n$$\\arctan\\left(\\frac{\\omega_u}{\\omega_{p2}}\\right) \\leq 90^\\circ - 60^\\circ$$\n$$\\arctan\\left(\\frac{\\omega_u}{\\omega_{p2}}\\right) \\leq 30^\\circ$$\n\n由于正切函数在其主定义域上是单调递增的，我们可以对不等式两边取正切而不改变不等式的方向：\n$$\\frac{\\omega_u}{\\omega_{p2}} \\leq \\tan(30^\\circ)$$\n$\\tan(30^\\circ)$ 的精确值是 $\\frac{1}{\\sqrt{3}}$。因此，条件是：\n$$\\frac{\\omega_u}{\\omega_{p2}} \\leq \\frac{1}{\\sqrt{3}}$$\n\n为了找到补偿电容 $C_c$ 的最小值，我们必须使用 $\\omega_u$ 的最大允许值，这对应于等式成立的情况。较小的 $C_c$ 会导致较大的 $\\omega_u$。因此，我们寻求满足边界条件的最小 $C_c$：\n$$\\omega_u = \\frac{\\omega_{p2}}{\\sqrt{3}}$$\n\n问题提供了 $\\omega_u$ 和 $\\omega_{p2}$ 的物理表达式：\n1. 单位增益频率由第一级跨导 $g_{m1}$ 和补偿电容 $C_c$ 设定：\n$$\\omega_u = \\frac{g_{m1}}{C_c}$$\n2. 第二个极点由第二级输出电阻 $r_{o2}$ 和负载电容 $C_L$ 设定：\n$$\\omega_{p2} = \\frac{1}{r_{o2} C_L}$$\n\n将这些表达式代入我们的边界条件方程：\n$$\\frac{g_{m1}}{C_c} = \\frac{1}{\\sqrt{3}} \\left(\\frac{1}{r_{o2} C_L}\\right)$$\n\n我们现在可以解出 $C_c$。这将是所需的最小补偿电容 $C_{c,min}$。\n$$C_{c,min} = g_{m1} r_{o2} C_L \\sqrt{3}$$\n\n给定值为：\n- $g_{m1} = 2.0 \\times 10^{-4}\\,\\text{S}$\n- $r_{o2} = 1.0 \\times 10^{4}\\,\\Omega$\n- $C_L = 10 \\times 10^{-12}\\,\\text{F}$\n\n将这些数值代入 $C_{c,min}$ 的表达式中：\n$$C_{c,min} = (2.0 \\times 10^{-4}) \\times (1.0 \\times 10^{4}) \\times (10 \\times 10^{-12}) \\times \\sqrt{3}$$\n前两项的乘积是 $(2.0 \\times 10^{-4}) \\times (1.0 \\times 10^{4}) = 2.0$。单位 S 和 $\\Omega$ 相互抵消。\n$$C_{c,min} = 2.0 \\times (10 \\times 10^{-12}) \\times \\sqrt{3} \\, \\text{F}$$\n$$C_{c,min} = 20 \\sqrt{3} \\times 10^{-12} \\, \\text{F}$$\n这等价于 $20\\sqrt{3}$ 皮法（pF）。现在，我们计算其数值：\n$$C_{c,min} \\approx 20 \\times 1.73205... \\, \\text{pF}$$\n$$C_{c,min} \\approx 34.6410... \\, \\text{pF}$$\n\n根据要求，将结果四舍五入到三位有效数字，我们得到：\n$$C_{c,min} \\approx 34.6 \\, \\text{pF}$$\n最终答案要求以 pF 为单位，所以数值为 $34.6$。",
            "answer": "$$\\boxed{34.6}$$"
        },
        {
            "introduction": "虽然单点计算很有用，但一个鲁棒的设计需要理解电路在不同配置下的稳定性表现。本练习利用计算方法，系统地探索反馈系数 $\\beta$、增益交越频率与相位裕度之间的关系，并验证一个关键原则：单位增益反馈通常是稳定性面临的最严峻挑战。这种将理论模型转化为可执行代码以进行参数化分析的方法，是现代电子设计自动化（EDA）流程中的核心实践。",
            "id": "4286776",
            "problem": "考虑一个线性时不变运算放大器，其开环传递函数被建模为两个实的、稳定的一阶极点的乘积。设开环传递函数以复频率 $s$ 的函数 $A(s)$ 表示，环路增益为 $L(s) = \\beta \\, A(s)$，其中 $\\beta$ 是反馈系数。假设为负反馈。相位裕度通过波特稳定性判据定义：它是在增益交越角频率处，环路增益相位与 $-180^\\circ$ 之间的角度差，该频率下环路增益的幅度等于1。您必须使用的基本理论包括线性时不变系统理论、频率响应定义和波特稳定性判据。严格从这些基础出发，构建一个计算方法，通过改变 $\\beta$ 来确定不同闭环增益下的相位裕度，并验证增益交越频率如何随 $\\beta$ 的变化而移动。\n\n使用以下科学上真实的开环宏模型参数：\n- 直流开环增益 $A_0 = 10^5$（无量纲）。\n- 第一个实极点位于角频率 $\\omega_1 = 2\\pi \\cdot 10$（单位 $\\text{rad}\\cdot \\text{s}^{-1}$）。\n- 第二个实极点位于角频率 $\\omega_2 = 2\\pi \\cdot 5 \\cdot 10^6$（单位 $\\text{rad}\\cdot \\text{s}^{-1}$）。\n\n设开环传递函数建模为 $A(s) = \\dfrac{A_0}{\\left(1 + \\dfrac{s}{\\omega_1}\\right)\\left(1 + \\dfrac{s}{\\omega_2}\\right)}$，环路增益为 $L(s) = \\beta \\, A(s)$。在虚轴 $s = j\\omega$ 上工作，增益交越角频率 $\\omega_{\\mathrm{gc}}$ 由 $\\left|L(j\\omega_{\\mathrm{gc}})\\right| = 1$ 定义。相位裕度定义为 $\\mathrm{PM} = 180^\\circ + \\angle L(j\\omega_{\\mathrm{gc}})$，其中角度以度为单位进行计算。角度必须以度表示，角频率必须以 $\\text{rad}\\cdot \\text{s}^{-1}$ 表示。\n\n您的任务是编写一个完整的、可运行的程序，该程序能够：\n- 对于每个指定的反馈系数 $\\beta$，当 $\\left|L(j0)\\right| \\ge 1$ 时，通过求解方程 $\\left|L(j\\omega)\\right| = 1$（对于 $\\omega  0$）来数值确定 $\\omega_{\\mathrm{gc}}$，并处理边界情况 $\\left|L(j0)\\right| = 1$。\n- 按上述定义计算以度为单位的相位裕度。\n- 通过检查 $\\omega_{\\mathrm{gc}}$ 值序列相对于 $\\beta$ 值升序序列的单调性，验证增益交越频率如何随 $\\beta$ 的变化而移动。\n\n使用以下反馈系数测试套件来检验解决方案的不同方面：\n- 接近直流增益交越的边界情况：$\\beta = \\dfrac{1}{A_0}$。\n- 高闭环增益情况：$\\beta = 0.02$。\n- 中等闭环增益情况：$\\beta = 0.1$。\n- 中等$\\beta$值情况：$\\beta = 0.5$。\n- 单位增益缓冲器情况：$\\beta = 1.0$。\n\n对于上面给定的升序排列的每个 $\\beta$，程序必须生成数对 $[\\omega_{\\mathrm{gc}}, \\mathrm{PM}]$，其中 $\\omega_{\\mathrm{gc}}$ 的单位是 $\\text{rad}\\cdot \\text{s}^{-1}$，$\\mathrm{PM}$ 的单位是度。每个数值输出必须四舍五入到 $6$ 位小数。此外，在列出所有数对后，输出一个最终的布尔值，指示 $\\omega_{\\mathrm{gc}}$ 值序列是否随 $\\beta$ 的增加而非递减。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。要求的最终输出格式是一个列表的列表，后跟一个布尔值，例如：“[[w1,PM1],[w2,PM2],...[wn,PMn],True]”。请将 $w_k$ 和 $\\mathrm{PM}_k$ 替换为计算并四舍五入到 $6$ 位小数的值，并将布尔值替换为您的单调性验证结果。不应打印任何其他文本。",
            "solution": "问题陈述已经过严格验证，并被认为是有效的。它在科学上基于应用于运算放大器的线性时不变（LTI）系统理论和控制理论的原理。问题是适定的（well-posed），提供了所有必要的参数和定义，从而保证存在唯一、稳定且有意义的数值解。语言客观，参数符合物理实际。\n\n任务是计算一个双极点运放模型在不同反馈条件下的增益交越频率和相位裕度，并验证反馈系数与增益交越频率之间的单调关系。\n\n运算放大器的开环传递函数由下式给出：\n$$\nA(s) = \\dfrac{A_0}{\\left(1 + \\dfrac{s}{\\omega_1}\\right)\\left(1 + \\dfrac{s}{\\omega_2}\\right)}\n$$\n其中 $A_0 = 10^5$ 是直流增益，$\\omega_1 = 2\\pi \\cdot 10 \\, \\text{rad}\\cdot\\text{s}^{-1}$ 是第一个极点频率，$\\omega_2 = 2\\pi \\cdot 5 \\cdot 10^6 \\, \\text{rad}\\cdot\\text{s}^{-1}$ 是第二个极点频率。\n\n环路增益 $L(s)$ 定义为 $L(s) = \\beta A(s)$，其中 $\\beta$ 是反馈系数。\n$$\nL(s) = \\dfrac{\\beta A_0}{\\left(1 + \\dfrac{s}{\\omega_1}\\right)\\left(1 + \\dfrac{s}{\\omega_2}\\right)}\n$$\n为了分析稳定性，我们通过设置 $s = j\\omega$ 来评估频率响应，其中 $j$ 是虚数单位，$\\omega$ 是角频率，单位为 $\\text{rad}\\cdot\\text{s}^{-1}$。\n$$\nL(j\\omega) = \\dfrac{\\beta A_0}{\\left(1 + j\\dfrac{\\omega}{\\omega_1}\\right)\\left(1 + j\\dfrac{\\omega}{\\omega_2}\\right)}\n$$\n\n**1. 增益交越频率, $\\omega_{\\mathrm{gc}}$**\n\n增益交越频率 $\\omega_{\\mathrm{gc}}$ 是环路增益幅度为1时的频率：\n$$\n|L(j\\omega_{\\mathrm{gc}})| = 1\n$$\n环路增益的幅度推导如下：\n$$\n|L(j\\omega)| = \\left| \\dfrac{\\beta A_0}{\\left(1 + j\\dfrac{\\omega}{\\omega_1}\\right)\\left(1 + j\\dfrac{\\omega}{\\omega_2}\\right)} \\right| = \\dfrac{|\\beta A_0|}{|1 + j\\frac{\\omega}{\\omega_1}| |1 + j\\frac{\\omega}{\\omega_2}|} = \\dfrac{\\beta A_0}{\\sqrt{1 + \\left(\\frac{\\omega}{\\omega_1}\\right)^2} \\sqrt{1 + \\left(\\frac{\\omega}{\\omega_2}\\right)^2}}\n$$\n因为 $\\beta > 0$ 且 $A_0 > 0$。\n\n因此，$\\omega_{\\mathrm{gc}}$ 的条件变为：\n$$\n\\dfrac{\\beta A_0}{\\sqrt{1 + \\left(\\frac{\\omega_{\\mathrm{gc}}}{\\omega_1}\\right)^2} \\sqrt{1 + \\left(\\frac{\\omega_{\\mathrm{gc}}}{\\omega_2}\\right)^2}} = 1\n$$\n为了简化数值求根过程，我们可以对方程两边进行平方：\n$$\n(\\beta A_0)^2 = \\left(1 + \\left(\\frac{\\omega_{\\mathrm{gc}}}{\\omega_1}\\right)^2\\right) \\left(1 + \\left(\\frac{\\omega_{\\mathrm{gc}}}{\\omega_2}\\right)^2\\right)\n$$\n我们需要求解这个关于 $\\omega_{\\mathrm{gc}}$ 的方程。让我们定义一个函数 $f(\\omega):$\n$$\nf(\\omega) = \\dfrac{(\\beta A_0)^2}{\\left(1 + (\\frac{\\omega}{\\omega_1})^2\\right) \\left(1 + (\\frac{\\omega}{\\omega_2})^2\\right)} - 1\n$$\n我们将求解 $f(\\omega) = 0$ 在 $\\omega > 0$ 时的根。对于任何使得直流环路增益 $\\beta A_0 > 1$ 的 $\\beta$，存在一个唯一的正解 $\\omega_{\\mathrm{gc}}$，因为当 $\\omega > 0$ 时，$|L(j\\omega)|$ 是一个单调递减函数。对于边界情况 $\\beta A_0 = 1$，交越发生在 $\\omega_{\\mathrm{gc}} = 0$。这将作为一个特殊情况处理。对于所有其他情况，使用数值求根算法，例如 `scipy.optimize.root_scalar` 提供的 Brent 方法，适合用于寻找 $\\omega_{\\mathrm{gc}}$。\n\n**2. 相位裕度, PM**\n\n相位裕度 (PM) 定义为：\n$$\n\\mathrm{PM} = 180^\\circ + \\angle L(j\\omega_{\\mathrm{gc}})\n$$\n环路增益的相位 $\\angle L(j\\omega)$ 由下式给出：\n$$\n\\angle L(j\\omega) = \\angle(\\beta A_0) - \\angle\\left(1 + j\\frac{\\omega}{\\omega_1}\\right) - \\angle\\left(1 + j\\frac{\\omega}{\\omega_2}\\right)\n$$\n由于 $\\beta A_0$ 是一个正实数，其相位为 $0^\\circ$。每个极点项的相位由反正切函数给出。因此，总相位（以弧度为单位）为：\n$$\n\\angle L(j\\omega) = -\\arctan\\left(\\frac{\\omega}{\\omega_1}\\right) - \\arctan\\left(\\frac{\\omega}{\\omega_2}\\right)\n$$\n然后，将 $\\omega_{\\mathrm{gc}}$ 代入此表达式，计算出以度为单位的相位裕度：\n$$\n\\mathrm{PM} = 180^\\circ - \\frac{180^\\circ}{\\pi} \\left[ \\arctan\\left(\\frac{\\omega_{\\mathrm{gc}}}{\\omega_1}\\right) + \\arctan\\left(\\frac{\\omega_{\\mathrm{gc}}}{\\omega_2}\\right) \\right]\n$$\n\n**3. $\\omega_{\\mathrm{gc}}$ 的单调性**\n\n环路增益幅度 $|L(j\\omega)|$ 与 $\\beta$ 成正比。增加 $\\beta$ 会使整个对数幅频波特图向上平移。由于当 $\\omega > 0$ 时，幅频图的斜率为负，向上平移会导致单位增益交越点移动到更高的频率。因此，我们预期 $\\omega_{\\mathrm{gc}}$ 是 $\\beta$ 的一个非递减函数。这一点将通过计算进行验证。\n\n**计算算法**\n\n1.  初始化物理常数 $A_0$, $\\omega_1$ 和 $\\omega_2$。\n2.  按升序遍历指定的反馈系数 $\\beta$ 列表。\n3.  对于每个 $\\beta$：\n    a. 检查边界情况 $\\beta A_0 = 1$。如果成立，则设置 $\\omega_{\\mathrm{gc}} = 0 \\, \\text{rad}\\cdot\\text{s}^{-1}$ 和 $\\mathrm{PM} = 180^\\circ$。\n    b. 否则，使用 `scipy.optimize.root_scalar` 在一个合适的搜索区间（例如 $[10^{-6}, 10 \\cdot \\omega_2]$）内找到方程 $f(\\omega) = 0$ 的根 $\\omega_{\\mathrm{gc}}$。\n    c. 使用推导的公式和计算出的 $\\omega_{\\mathrm{gc}}$ 来计算相位裕度 (PM)。\n    d. 存储数对 $[\\omega_{\\mathrm{gc}}, \\mathrm{PM}]$。\n4.  处理完所有 $\\beta$ 值后，分析存储的 $\\omega_{\\mathrm{gc}}$ 值序列，以验证其是否为非递减。\n5.  根据问题规范，将最终结果格式化并打印为单行文本。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Calculates the gain crossover frequency and phase margin for a two-pole\n    op-amp model for a given set of feedback factors. Also verifies the\n    monotonicity of the gain crossover frequency with respect to the\n    feedback factor.\n    \"\"\"\n    # Define the open-loop macro-model parameters as specified in the problem.\n    A0 = 1e5\n    w1 = 2 * np.pi * 10\n    w2 = 2 * np.pi * 5 * 1e6\n\n    # Test suite of feedback factors in ascending order.\n    # The problem statement implies this order: 1/A0, 0.02, 0.1, 0.5, 1.0\n    beta_values = [\n        1.0 / A0,\n        0.02,\n        0.1,\n        0.5,\n        1.0,\n    ]\n\n    results = []\n    wgc_list = []\n\n    for beta in beta_values:\n        loop_gain_dc = beta * A0\n\n        # Handle the boundary case where DC loop gain is exactly 1.\n        # This corresponds to beta = 1/A0, giving w_gc = 0.\n        if np.isclose(loop_gain_dc, 1.0):\n            w_gc = 0.0\n        else:\n            # Define the function whose root we need to find.\n            # Solving |L(jw)|^2 - 1 = 0 is more robust than |L(jw)| - 1 = 0.\n            def magnitude_squared_minus_one(w):\n                if w = 0:\n                    return np.inf  # Only interested in w > 0\n                term1 = 1 + (w / w1)**2\n                term2 = 1 + (w / w2)**2\n                magnitude_sq = loop_gain_dc**2 / (term1 * term2)\n                return magnitude_sq - 1\n\n            # Use a numerical root-finder. The search bracket [a, b] must\n            # contain the root. A small positive number is used for the lower\n            # bound. The upper bound is set safely above the second pole.\n            try:\n                # Brent's method is generally robust for this type of problem.\n                sol = root_scalar(magnitude_squared_minus_one, bracket=[1e-6, 10 * w2], method='brentq')\n                if sol.converged:\n                    w_gc = sol.root\n                else:\n                    # Fallback or error, though not expected for this problem\n                    w_gc = np.nan\n            except ValueError:\n                # The root is not in the bracket, should not happen with this setup.\n                w_gc = np.nan\n        \n        # Calculate the phase of L(jw_gc) in degrees\n        # Phase (rad) = -atan(w_gc/w1) - atan(w_gc/w2)\n        phase_at_wgc_deg = -np.degrees(np.arctan(w_gc / w1) + np.arctan(w_gc / w2))\n\n        # Calculate Phase Margin (PM) in degrees\n        # PM = 180 + Phase(L(jw_gc))\n        pm = 180.0 + phase_at_wgc_deg\n        \n        # Store results for this beta value, rounded to 6 decimal places.\n        wgc_list.append(w_gc)\n        results.append([round(w_gc, 6), round(pm, 6)])\n\n    # Verify that the sequence of w_gc values is non-decreasing with increasing beta.\n    # The beta_values list is already sorted in ascending order.\n    is_non_decreasing = all(wgc_list[i] = wgc_list[i+1] for i in range(len(wgc_list) - 1))\n\n    # Format the output string precisely as required.\n    result_strings = [f\"[{w},{p}]\" for w, p in results]\n    final_output = f\"[{','.join(result_strings)},{is_non_decreasing}]\"\n\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "现实世界中的集成电路会受到工艺偏差的影响，这意味着元件值并非固定不变，而是在一定容差范围内波动。最后一个练习直面这一高级挑战，要求对相位裕度进行最差情况分析，并计算设计余量（guardband），以确保放大器在所有预期的制造结果中都能保持稳定。这体现了从理想化设计走向面向制造的鲁棒性设计的关键一步。",
            "id": "4286758",
            "problem": "给定一个带有米勒补偿和容性负载的两级运算跨导放大器（OTA）。该OTA被建模为一个线性时不变双极点系统，其中主极点由补偿电容器设定，单位增益频率由输入级跨导决定。第二极点由输出电阻和负载电容设定。假设开环传递函数有两个实极点且没有零点，并且该放大器在单位增益配置下以负反馈方式工作。输入级的小信号跨导表示为 $g_{m1}$，输出电阻为 $R_{\\text{out}}$，补偿电容器为 $C_c$，负载电容器为 $C_L$。相位裕度在单位增益交越频率处定义，并且必须以度为单位表示。\n\n从基本的小信号电路原理出发，包括基尔霍夫电流定律（KCL）和跨导的定义（$i = g_m v$），推导相位裕度作为单位增益频率与第二极点频率之比的函数的近似关系。使用此关系以编程方式确定：\n- 在 $C_c$ 有 $\\pm 20\\%$ 的变化和 $C_L$ 有 $\\pm 30\\%$ 的变化的情况下，最坏情况下的相位裕度。\n- 施加在标称 $C_c$ 上的最小乘法防护裕度因子 $\\alpha$，使得即使 $C_c$ 减少 $20\\%$ 且 $C_L$ 增加 $30\\%$，相位裕度也能保证满足 $\\phi_m \\ge 60^\\circ$。\n\n建模假设：\n- 单位增益频率主要由米勒补偿决定，并由输入级跨导和 $C_c$ 设定。\n- 第二极点由输出节点处的输出电阻和负载电容决定。\n- 开环幅值在单位增益频率处穿过单位值。\n- 相位裕度通过在单位增益频率处评估环路传输的相位来计算。\n- 角度必须以度为单位表示。\n\n物理单位：\n- $g_{m1}$ 单位为西门子（$\\text{S}$），\n- $R_{\\text{out}}$ 单位为欧姆（$\\Omega$），\n- $C_c$ 单位为法拉（$\\text{F}$），\n- $C_L$ 单位为法拉（$\\text{F}$），\n- 相位裕度单位为度。\n\n测试套件：\n对于每组参数 $(g_{m1}, R_{\\text{out}}, C_c, C_L)$，确定在所述变化下的最坏情况相位裕度以及施加在 $C_c$ 上的最小防护裕度因子 $\\alpha$。将每个结果报告为一个对 $[\\phi_{m,\\text{worst}}~\\text{（度）},~\\alpha]$，两者均四舍五入到三位小数。\n\n- 测试用例 1（理想情况）：\n  - $g_{m1} = 50 \\times 10^{-6}~\\text{S}$，\n  - $R_{\\text{out}} = 100 \\times 10^{3}~\\Omega$，\n  - $C_c = 1 \\times 10^{-9}~\\text{F}$，\n  - $C_L = 20 \\times 10^{-12}~\\text{F}$。\n\n- 测试用例 2（近边界，潜在不稳定性）：\n  - $g_{m1} = 200 \\times 10^{-6}~\\text{S}$，\n  - $R_{\\text{out}} = 50 \\times 10^{3}~\\Omega$，\n  - $C_c = 200 \\times 10^{-12}~\\text{F}$，\n  - $C_L = 10 \\times 10^{-12}~\\text{F}$。\n\n- 测试用例 3（重负载和小 $C_c$ 的边缘情况）：\n  - $g_{m1} = 20 \\times 10^{-6}~\\text{S}$，\n  - $R_{\\text{out}} = 200 \\times 10^{3}~\\Omega$，\n  - $C_c = 100 \\times 10^{-12}~\\text{F}$，\n  - $C_L = 200 \\times 10^{-12}~\\text{F}$。\n\n您的程序必须：\n- 通过评估在 $C_c \\in \\{0.8 C_c, 1.2 C_c\\}$ 和 $C_L \\in \\{0.7 C_L, 1.3 C_L\\}$ 的四种角点组合下的相位裕度，并选择最小相位裕度来计算最坏情况相位裕度。\n- 当 $C_c$ 处于 $0.8 C_c$ 且 $C_L$ 处于 $1.3 C_L$ 时，计算施加在标称 $C_c$ 上的最小防护裕度因子 $\\alpha$，以保证 $\\phi_m \\ge 60^\\circ$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个包含三个结果的列表，每个测试用例一个结果，其中每个结果都是一个列表 $[\\phi_{m,\\text{worst}}, \\alpha]$，两个值都四舍五入到三位小数，以逗号分隔的列表形式打印，并用方括号括起来。例如：\n$[[\\phi_{1},\\alpha_{1}],[\\phi_{2},\\alpha_{2}],[\\phi_{3},\\alpha_{3}]]$.",
            "solution": "所述问题具有科学依据，提法得当且客观。它基于模拟集成电路设计中使用的标准（尽管是简化的）运算放大器稳定性模型。所有必要的参数和约束都已提供，从而可以得到唯一且有意义的解。因此，该问题被认为是有效的。\n\n解决方案需要推导相位裕度 $\\phi_m$ 的表达式，然后用它来执行最坏情况分析并确定所需的设计保护带。\n\n两级OTA的开环传递函数 $A(s)$ 被建模为一个双极点系统：\n$$A(s) = \\frac{A_0}{\\left(1 + \\frac{s}{\\omega_{p1}}\\right)\\left(1 + \\frac{s}{\\omega_{p2}}\\right)}$$\n其中 $A_0$ 是直流增益，$\\omega_{p1}$ 是主极点频率，$\\omega_{p2}$ 是第二极点频率。所有频率单位均为弧度/秒。\n\n根据问题陈述和米勒补偿放大器的标准分析，单位增益频率 $\\omega_u$ 由输入级跨导 $g_{m1}$ 与补偿电容 $C_c$ 的比值给出。该频率也是增益带宽积，即 $\\omega_u = A_0 \\omega_{p1}$。\n$$\\omega_u = \\frac{g_{m1}}{C_c}$$\n\n第二极点 $\\omega_{p2}$ 由输出电阻 $R_{\\text{out}}$ 和总负载电容 $C_L$ 决定。\n$$\\omega_{p2} = \\frac{1}{R_{\\text{out}} C_L}$$\n\n相位裕度 $\\phi_m$ 是在单位增益反馈配置中定义的。它在单位增益频率 $\\omega = \\omega_u$ 处计算，此时环路增益的幅值 $|A(j\\omega_u)|$ 等于 $1$。$A(j\\omega)$ 的相位是：\n$$\\angle A(j\\omega) = -\\arctan\\left(\\frac{\\omega}{\\omega_{p1}}\\right) - \\arctan\\left(\\frac{\\omega}{\\omega_{p2}}\\right)$$\n\n相位裕度则为：\n$$\\phi_m = 180^\\circ + \\angle A(j\\omega_u) = 180^\\circ - \\arctan\\left(\\frac{\\omega_u}{\\omega_{p1}}\\right) - \\arctan\\left(\\frac{\\omega_u}{\\omega_{p2}}\\right)$$\n\n对于一个经过适当补偿的放大器，极点分离很大，意味着 $\\omega_u \\gg \\omega_{p1}$。这使得 $\\arctan(\\omega_u/\\omega_{p1})$ 项接近 $90^\\circ$。相位裕度的表达式简化为所要求的近似关系：\n$$\\phi_m \\approx 90^\\circ - \\arctan\\left(\\frac{\\omega_u}{\\omega_{p2}}\\right)$$\n\n为了用给定的电路参数表示，我们代入 $\\omega_u$ 和 $\\omega_{p2}$ 的表达式：\n$$\\frac{\\omega_u}{\\omega_{p2}} = \\frac{g_{m1}/C_c}{1/(R_{\\text{out}}C_L)} = \\frac{g_{m1} R_{\\text{out}} C_L}{C_c}$$\n\n相位裕度（以度为单位）的最终公式是：\n$$\\phi_m \\approx 90 - \\frac{180}{\\pi} \\arctan\\left(\\frac{g_{m1} R_{\\text{out}} C_L}{C_c}\\right)$$\n其中 $180/\\pi$ 因子将反正切函数的输出从弧度转换为度。\n\n**第一部分：最坏情况下的相位裕度 ($\\phi_{m,\\text{worst}}$)**\n\n相位裕度 $\\phi_m$ 是比率 $K = \\frac{\\omega_u}{\\omega_{p2}} = \\frac{g_{m1} R_{\\text{out}} C_L}{C_c}$ 的单调递减函数。因此，最坏情况（最小）的相位裕度出现在该比率最大化时。参数 $g_{m1}$ 和 $R_{\\text{out}}$ 是常数，而 $C_c$ 变化 $\\pm 20\\%$，$C_L$ 变化 $\\pm 30\\%$。\n\n为了最大化比率 $K$，我们必须使用 $C_c$ 的最小值和 $C_L$ 的最大值。\n- 最小 $C_c$：$C_{c,\\text{min}} = (1 - 0.20) C_{c,\\text{nom}} = 0.8 C_{c,\\text{nom}}$\n- 最大 $C_L$：$C_{L,\\text{max}} = (1 + 0.30) C_{L,\\text{nom}} = 1.3 C_{L,\\text{nom}}$\n\n最坏情况下的比率 $K_{\\text{worst}}$ 是：\n$$K_{\\text{worst}} = \\frac{g_{m1} R_{\\text{out}} (1.3 C_{L,\\text{nom}})}{0.8 C_{c,\\text{nom}}} = 1.625 \\left(\\frac{g_{m1} R_{\\text{out}} C_{L,\\text{nom}}}{C_{c,\\text{nom}}}\\right)$$\n问题要求以编程方式检查所有四个角点，我们将这样做。上述逻辑确认了哪个角点会产生最小的相位裕度。\n\n**第二部分：最小防护裕度因子 ($\\alpha$)**\n\n我们需要找到施加在标称补偿电容器 $C_{c,\\text{nom}}$ 上的最小乘法因子 $\\alpha$，使得在最坏情况的工艺变化组合下，相位裕度保证至少为 $60^\\circ$（$\\phi_m \\ge 60^\\circ$）。新的标称电容器是 $\\alpha C_{c,\\text{nom}}$。最坏情况的变化是这个新标称值减少 $20\\%$ 和负载电容器增加 $30\\%$。\n\n此条件下的元件值为：\n- $C_c' = 0.8 (\\alpha C_{c,\\text{nom}})$\n- $C_L' = 1.3 C_{L,\\text{nom}}$\n\n条件 $\\phi_m \\ge 60^\\circ$ 可转换为：\n$$90^\\circ - \\arctan\\left(\\frac{\\omega_u'}{\\omega_{p2}'}\\right) \\ge 60^\\circ$$\n$$\\arctan\\left(\\frac{\\omega_u'}{\\omega_{p2}'}\\right) \\le 30^\\circ$$\n\n对两边取正切：\n$$\\frac{\\omega_u'}{\\omega_{p2}'} \\le \\tan(30^\\circ)$$\n其中 $\\tan(30^\\circ) = 1/\\sqrt{3}$。\n\n代入电路参数得到比率：\n$$\\frac{g_{m1} R_{\\text{out}} C_L'}{C_c'} \\le \\frac{1}{\\sqrt{3}}$$\n$$\\frac{g_{m1} R_{\\text{out}} (1.3 C_{L,\\text{nom}})}{0.8 \\alpha C_{c,\\text{nom}}} \\le \\frac{1}{\\sqrt{3}}$$\n\n设 $K_{\\text{nom}} = \\frac{g_{m1} R_{\\text{out}} C_{L,\\text{nom}}}{C_{c,\\text{nom}}}$。不等式变为：\n$$\\frac{1.3}{0.8 \\alpha} K_{\\text{nom}} \\le \\frac{1}{\\sqrt{3}}$$\n$$\\frac{1.625}{\\alpha} K_{\\text{nom}} \\le \\frac{1}{\\sqrt{3}}$$\n\n解出 $\\alpha$，我们找到所需的最小值：\n$$\\alpha \\ge 1.625 \\sqrt{3} K_{\\text{nom}}$$\n$$\\alpha_{\\text{min}} = 1.625 \\sqrt{3} \\left(\\frac{g_{m1} R_{\\text{out}} C_{L,\\text{nom}}}{C_{c,\\text{nom}}}\\right)$$\n\n这些推导出的公式将被实现，以求解所提供测试套件中的值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the operational amplifier stability problem for the given test cases.\n    \"\"\"\n    # Test cases defined in the problem statement.\n    # Each case is a tuple: (gm1, Rout, Cc_nom, CL_nom)\n    test_cases = [\n        # Test Case 1\n        (50e-6, 100e3, 1e-9, 20e-12),\n        # Test Case 2\n        (200e-6, 50e3, 200e-12, 10e-12),\n        # Test Case 3\n        (20e-6, 200e3, 100e-12, 200e-12),\n    ]\n\n    results = []\n    \n    # Variation factors for Cc and CL\n    cc_vars = [0.8, 1.2]  # +/- 20%\n    cl_vars = [0.7, 1.3]  # +/- 30%\n\n    for case in test_cases:\n        gm1, Rout, Cc_nom, CL_nom = case\n        \n        # --- Part 1: Calculate worst-case phase margin ---\n        \n        # The phase margin is a monotonically decreasing function of the ratio K.\n        # Thus, the minimum phase margin will occur at the maximum ratio K.\n        # This corresponds to the corner with minimum Cc and maximum CL.\n        # However, the problem asks to check all four corners.\n        \n        phi_m_worst = 90.0  # Initialize with the theoretical maximum\n\n        for cc_var in cc_vars:\n            for cl_var in cl_vars:\n                Cc_eff = Cc_nom * cc_var\n                CL_eff = CL_nom * cl_var\n                \n                # Ratio of unity-gain frequency to the second pole frequency\n                ratio_k = (gm1 * Rout * CL_eff) / Cc_eff\n                \n                # Phase margin in degrees\n                phi_m = 90.0 - np.rad2deg(np.arctan(ratio_k))\n                \n                if phi_m  phi_m_worst:\n                    phi_m_worst = phi_m\n\n        # --- Part 2: Calculate minimum guardband factor alpha ---\n        \n        # Nominal ratio K_nom\n        K_nom = (gm1 * Rout * CL_nom) / Cc_nom\n        \n        # tan(30 degrees)\n        tan_30_deg = np.tan(np.deg2rad(30))\n        \n        # The factor 1.625 comes from 1.3 (max CL) / 0.8 (min Cc)\n        alpha_min = (1.625 * K_nom) / tan_30_deg\n        \n        # Round results to three decimal places\n        phi_m_worst_rounded = round(phi_m_worst, 3)\n        alpha_min_rounded = round(alpha_min, 3)\n        \n        results.append([phi_m_worst_rounded, alpha_min_rounded])\n\n    # Final print statement in the exact required format.\n    # The string representation of a list in Python is exactly what's needed.\n    # e.g., str([80.773, 0.281]) -> '[80.773, 0.281]'\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}