{
    "hands_on_practices": [
        {
            "introduction": "动手实践的第一步是掌握对测试访问端口（TAP）状态机的精确控制。这个练习 () 将引导你设计一个最小化的测试模式选择（TMS）信号序列，以在关键状态之间导航，这是执行任何 JTAG 操作的基础。通过计算完成此路径所需的最少时钟周期数，你将深化对状态转换逻辑的理解。",
            "id": "4258516",
            "problem": "在电气和电子工程师协会 (IEEE) 标准 1149.1 边界扫描架构中（通常称为联合测试行动组 (JTAG)），测试访问端口 (TAP) 控制器是一个有限状态机，其下一个状态由测试时钟 ($TCK$) 上升沿采样到的测试模式选择 ($TMS$) 信号确定。考虑数据寄存器 (DR) 扫描路径，其具有以下规范的下一状态规则（仅表述与本问题相关的状态）。在 $TCK$ 的每个上升沿，TAP 控制器根据当前状态和 $TMS$ 的采样值进行转换：\n\n- 从 $Run$-$Test/Idle$ ($RTI$) 状态：$TMS=0 \\rightarrow RTI$，$TMS=1 \\rightarrow Select$-$DR$-$Scan$。\n- 从 $Select$-$DR$-$Scan$ 状态：$TMS=0 \\rightarrow Capture$-$DR$，$TMS=1 \\rightarrow Select$-$IR$-$Scan$。\n- 从 $Capture$-$DR$ 状态：$TMS=0 \\rightarrow Shift$-$DR$，$TMS=1 \\rightarrow Exit1$-$DR$。\n- 从 $Shift$-$DR$ 状态：$TMS=0 \\rightarrow Shift$-$DR$，$TMS=1 \\rightarrow Exit1$-$DR$。\n- 从 $Exit1$-$DR$ 状态：$TMS=0 \\rightarrow Pause$-$DR$，$TMS=1 \\rightarrow Update$-$DR$。\n- 从 $Update$-$DR$ 状态：$TMS=0 \\rightarrow RTI$，$TMS=1 \\rightarrow Select$-$DR$-$Scan$。\n\n假设 TAP 控制器从 $RTI$ 状态开始。你需要设计一个确定性的 $TMS$ 波形，它由在连续的 $TCK$ 上升沿上施加和采样的一系列 $TMS$ 值组成，该波形将 TAP 控制器从 $RTI$ 移动到 $Shift$-$DR$，然后到 $Update$-$DR$，最后回到 $RTI$。你的设计必须最小化完成此状态访问序列所需的 $TCK$ 脉冲数。假设除了访问 $Shift$-$DR$ 之外，不需要进行数据移位（即，进入 $Shift$-$DR$ 后立即退出，不执行任何移位操作）。\n\n仅使用上述基本规则和有限状态机控制的第一性原理，确定完成序列 $RTI \\rightarrow Shift$-$DR \\rightarrow Update$-$DR \\rightarrow RTI$ 所需的最小 $TCK$ 脉冲数。请以单个整数形式提供你的最终答案。无需四舍五入，也无需单位。",
            "solution": "测试访问端口 (TAP) 控制器是一个有限状态机，由测试时钟 ($TCK$) 上升沿采样的测试模式选择 ($TMS$) 信号驱动。其下一状态行为完全由当前状态和 $TCK$ 上升沿的 $TMS$ 值决定。我们使用问题陈述中列出的规范数据寄存器 (DR) 路径转换，这些是 IEEE 标准 1149.1 中的标准事实，并作为基础。\n\n我们必须按 $Run$-$Test/Idle$ ($RTI$) 到 $Shift$-$DR$，然后到 $Update$-$DR$，最后回到 $RTI$ 的顺序访问这些状态，同时最小化 $TCK$ 脉冲的数量。每次转换仅发生在 $TCK$ 的上升沿，因此最小化转换等同于最小化采样的 $TMS$ 事件数量。\n\n步骤 1：从 $RTI$ 移动到 $Shift$-$DR$。\n- 从 $RTI$ 出发，进入数据寄存器 (DR) 路径的唯一方法是通过 $Select$-$DR$-$Scan$，这需要在下一个 $TCK$ 上升沿上设置 $TMS=1$：\n  - $RTI \\xrightarrow{TMS=1} Select$-$DR$-$Scan$。\n- 从 $Select$-$DR$-$Scan$ 出发，要进入 DR 捕获阶段，我们必须设置 $TMS=0$：\n  - $Select$-$DR$-$Scan \\xrightarrow{TMS=0} Capture$-$DR$。\n- 从 $Capture$-$DR$ 出发，要进入 $Shift$-$DR$，我们必须再次设置 $TMS=0$：\n  - $Capture$-$DR \\xrightarrow{TMS=0} Shift$-$DR$。\n\n因此，从 $RTI$ 到达 $Shift$-$DR$ 的最小序列需要三个 $TCK$ 脉冲，在连续的上升沿上对应的 $TMS$ 值为 $1, 0, 0$。此时，我们已使用了 $3$ 个脉冲。\n\n步骤 2：在不进行数据移位的情况下，从 $Shift$-$DR$ 移动到 $Update$-$DR$。\n- 在 $Shift$-$DR$ 状态时，保持在 $Shift$-$DR$ 需要 $TMS=0$；退出需要 $TMS=1$。为最小化脉冲数并避免数据移位，我们立即退出：\n  - $Shift$-$DR \\xrightarrow{TMS=1} Exit1$-$DR$。\n- 从 $Exit1$-$DR$ 出发，要直接进入 $Update$-$DR$，我们设置 $TMS=1$：\n  - $Exit1$-$DR \\xrightarrow{TMS=1} Update$-$DR$。\n\n这需要额外的 $2$ 个脉冲，对应的 $TMS$ 值为 $1, 1$。累计脉冲数现在是 $3 + 2 = 5$ 个。\n\n步骤 3：从 $Update$-$DR$ 返回到 $RTI$。\n- 从 $Update$-$DR$ 出发，返回到 $RTI$ 需要 $TMS=0$：\n  - $Update$-$DR \\xrightarrow{TMS=0} RTI$。\n\n这需要再加 $1$ 个脉冲。总脉冲数是 $5 + 1 = 6$。\n\n因此，完成序列 $RTI \\rightarrow Shift$-$DR \\rightarrow Update$-$DR \\rightarrow RTI$ 所需的最小 $TCK$ 脉冲数为 $6$。在连续的 $TCK$ 上升沿上采样，实现此目标的确定性最小 $TMS$ 波形序列是 $1, 0, 0, 1, 1, 0$。\n\n为证明其最小性，我们观察到：\n- 从 $RTI$ 进入 DR 路径必须经过 $Select$-$DR$-$Scan$ 和 $Capture$-$DR$ 才能到达 $Shift$-$DR$，这至少需要 $3$ 次转换，因为 $RTI \\rightarrow Select$-$DR$-$Scan$ 需要 $TMS=1$，然后 $Select$-$DR$-$Scan \\rightarrow Capture$-$DR$ 需要 $TMS=0$，而 $Capture$-$DR \\rightarrow Shift$-$DR$ 需要 $TMS=0$。\n- 从 $Shift$-$DR$ 没有直接到 $Update$-$DR$ 的转换；最短路径是 $Shift$-$DR \\rightarrow Exit1$-$DR \\rightarrow Update$-$DR$，这正好需要 $2$ 次转换（两次 $TMS=1$）。\n- 从 $Update$-$DR$ 出发，以最少步骤返回 $RTI$ 是通过一次 $TMS=0$ 的转换。\n\n任何替代路径都无法在不违反 TAP 转换规则的情况下减少这些计数；任何绕行（例如，进入 $Pause$-$DR$ 或 $Select$-$IR$-$Scan$）都只会增加转换次数。因此，$6$ 是最小的。",
            "answer": "$$\\boxed{6}$$"
        },
        {
            "introduction": "真实的 JTAG 操作通常涉及多个步骤的组合，例如加载一条指令，然后扫描一个数据寄存器。本练习 () 要求你计算执行这样一个复合操作所需的总时钟周期数，从而将状态机导航的知识应用于更复杂的场景。精确计算时序对于估算测试时间以及与高速系统接口至关重要。",
            "id": "4258496",
            "problem": "一个数字集成电路实现了由电气和电子工程师协会 (IEEE) 标准 $1149.1$ 定义的边界扫描架构，并配备了标准的测试访问端口 (TAP) 控制器。您需要确定，在测试模式选择 (TMS) 信号的最小开销控制下，执行以下复合操作所需的测试时钟 (TCK) 上升沿的确切数量。\n\n假设有以下操作约束和定义：\n- 电路从 TAP 状态 `Run-Test/Idle`（运行测试/空闲）开始，并且在整个复合操作完成后必须结束于 `Run-Test/Idle` 状态。\n- 首先，执行一个 $m$ 位的指令寄存器 (IR) 加载操作。然后，紧接着，将一个特定的 $n$ 位数据寄存器 (DR) 通过测试数据输出 (TDO) 移出。\n- 所有状态转换都遵循 IEEE 标准 $1149.1$ TAP 状态机。所经过的状态路径必须是最小且合法的，没有暂停，也没有超出进入和退出所需移位操作以及在完成后返回 `Run-Test/Idle` 状态所严格必需的额外空闲时间。\n- 测试时钟 (TCK) 的每个上升沿根据当前的 TMS 值推进 TAP 状态机，并在 `Shift-IR` 或 `Shift-DR` 状态下对当前选定的移位寄存器执行一次移位。\n- 在 $m$ 位和 $n$ 位的移位过程中，每个 $TCK$ 上升沿恰好移位一位。每个移位操作的最后一位在置位 TMS 的同时被时钟同步，以在同一个时钟沿退出相应的移位状态。\n- 不施加异步复位。不调用向 `Test-Logic-Reset`（测试逻辑复位）状态的转换。不插入暂停。\n\n在这些假设下，推导一个关于 $m$ 和 $n$ 的封闭形式解析表达式，表示在采用最小合法 TAP 状态转换序列的情况下，从 `Run-Test/Idle` 状态开始，到 `Run-Test/Idle` 状态结束，完成以下操作所需的 $TCK$ 上升沿总数：\n$1)$ 加载 $m$ 位 IR，以及 $2)$ 移出 $n$ 位 DR。\n您的最终答案必须是一个只包含 $m$ 和 $n$ 的单一解析表达式，不带单位。不要进行近似或四舍五入。",
            "solution": "为了确定完成此复合操作所需的总 TCK 周期数，我们必须按顺序分析每个阶段，并计算遵循 IEEE 1149.1 TAP 状态机最小路径所需的 TCK 周期。整个过程分为四个主要部分：加载指令寄存器 (IR)，从 IR 路径转换到数据寄存器 (DR) 路径，移出 DR，以及最后返回 `Run-Test/Idle` 状态。\n\n**1. IR 加载操作 (从 `Run-Test/Idle` 到 `Shift-IR` 并移位)**\n- **导航到 `Shift-IR` 状态：** 从 `Run-Test/Idle` 开始，到达 `Shift-IR` 的最短路径需要 4 个 TCK 周期：\n  1. `Run-Test/Idle` $\\xrightarrow{\\text{TMS=1}}$ `Select-DR-Scan` (1 TCK)\n  2. `Select-DR-Scan` $\\xrightarrow{\\text{TMS=1}}$ `Select-IR-Scan` (1 TCK)\n  3. `Select-IR-Scan` $\\xrightarrow{\\text{TMS=0}}$ `Capture-IR` (1 TCK)\n  4. `Capture-IR` $\\xrightarrow{\\text{TMS=0}}$ `Shift-IR` (1 TCK)\n  此导航过程共需 4 个 TCK 周期。\n\n- **移位 `m` 位指令：** 在 `Shift-IR` 状态下移入 $m$ 位指令需要 $m$ 个 TCK 周期。前 $m-1$ 位在 TMS=0 时移入，最后第 $m$ 位在 TMS=1 时移入，同时使状态机转换到 `Exit1-IR`。\n\n**2. 从 IR 路径转换到 DR 路径 (从 `Exit1-IR` 到 `Shift-DR`)**\n- **导航到 `Shift-DR` 状态：** 在完成 IR 移位后，状态机位于 `Exit1-IR`。要开始 DR 操作，需要导航到 `Shift-DR`。最短路径需要 4 个 TCK 周期：\n  1. `Exit1-IR` $\\xrightarrow{\\text{TMS=1}}$ `Update-IR` (1 TCK)\n  2. `Update-IR` $\\xrightarrow{\\text{TMS=1}}$ `Select-DR-Scan` (1 TCK)\n  3. `Select-DR-Scan` $\\xrightarrow{\\text{TMS=0}}$ `Capture-DR` (1 TCK)\n  4. `Capture-DR` $\\xrightarrow{\\text{TMS=0}}$ `Shift-DR` (1 TCK)\n  此转换过程共需 4 个 TCK 周期。\n\n**3. DR 移出操作 (在 `Shift-DR` 中移位)**\n- **移位 `n` 位数据：** 与 IR 移位类似，移出 $n$ 位数据需要 $n$ 个 TCK 周期。前 $n-1$ 位在 TMS=0 时移出，最后第 $n$ 位在 TMS=1 时移出，使状态机转换到 `Exit1-DR`。\n\n**4. 返回 `Run-Test/Idle` 状态 (从 `Exit1-DR` 返回)**\n- **导航到 `Run-Test/Idle`：** 操作完成后，状态机必须从 `Exit1-DR` 返回到 `Run-Test/Idle`。最短路径需要 2 个 TCK 周期：\n  1. `Exit1-DR` $\\xrightarrow{\\text{TMS=1}}$ `Update-DR` (1 TCK)\n  2. `Update-DR` $\\xrightarrow{\\text{TMS=0}}$ `Run-Test/Idle` (1 TCK)\n  返回过程共需 2 个 TCK 周期。\n\n**总 TCK 周期数计算**\n将所有阶段的 TCK 周期数相加：\n$$ N_{\\text{TCK}} = (\\text{导航到 Shift-IR}) + (\\text{IR 移位}) + (\\text{转换到 Shift-DR}) + (\\text{DR 移位}) + (\\text{返回 Idle}) $$\n$$ N_{\\text{TCK}} = 4 + m + 4 + n + 2 $$\n$$ N_{\\text{TCK}} = m + n + 10 $$\n因此，完成整个复合操作所需的 TCK 上升沿总数为 $m + n + 10$。",
            "answer": "$$\n\\boxed{m+n+10}\n$$"
        },
        {
            "introduction": "理论知识的最终目的是解决实际工程问题。本练习 () 将 JTAG 的底层控制与一个关键的系统级挑战——在进入内部测试（INTEST）模式时避免总线竞争——联系起来。你将需要综合运用对 TAP 状态机和 JTAG 指令（如 SAMPLE/PRELOAD 和 EXTEST）的理解，构建一个安全、无风险的操作序列，以防止硬件损坏。",
            "id": "4258533",
            "problem": "一个片上系统集成了多个总线主控和共享外设接口。在正常操作期间，片上焊盘可能会驱动一个共享总线。您被要求进入联合测试行动组 (JTAG) 的内部测试 (INTEST) 模式以执行核隔离测试，同时避免在片外网络上引起总线竞争。考虑一个符合电气和电子工程师协会 (IEEE) $1149.1$ 标准的边界扫描架构，其边界扫描寄存器 (BSR) 由驱动焊盘驱动器输出使能 (OE) 的输出数据单元和输出控制单元组成。假设以下基本事实：\n\n- 在 $1149.1$ 标准中，BSR 由移位、捕获和更新元件组成，其中 Update-DR 锁存器仅在 BSR 被当前指令选中时，才将值驱动到其作用点。\n- 联合测试行动组 (JTAG) 的测试访问端口 (TAP) 状态机仅在进入 Capture-DR 状态时修改移位路径的内容；将数据锁存到作用点的操作发生在 Update-DR 状态。\n- SAMPLE/PRELOAD 指令选择 BSR 进行移位和捕获，但不驱动引脚；系统逻辑继续控制焊盘驱动器。\n- 外部测试 (EXTEST) 指令选择 BSR 来驱动引脚；输出控制单元设置焊盘驱动器的 OE，输出数据单元设置焊盘驱动器的数据；三态化要求相应控制单元中的 $OE=0$。\n- 内部测试 (INTEST) 指令选择 BSR 来驱动核输入并捕获核输出；安全进入该模式要求禁用焊盘驱动器，以避免与外部驱动器发生竞争。\n- HIGHZ 指令如果被实现，会强制输出进入高阻态，但通常会选择 BYPASS 寄存器，并且不允许对 BSR 进行回读访问。\n- CLAMP 指令如果被实现，会将预加载的 BSR 更新值应用到焊盘，同时选择 BYPASS 寄存器；它会维持焊盘状态，但不允许进行 BSR 扫描。\n\n您的目标是构建一个指令和状态序列，以确保在选择 INTEST 之前满足以下条件：通过将所有相关输出控制单元强制为 $OE=0$ 来禁用焊盘驱动器，并通过 BSR 回读确认已禁用的 OE 状态。该序列必须没有因指令更改或 TAP 转换而引入的瞬态竞争风险，并且必须仅使用上述语义。请选择在正常操作下从 Run-Test/Idle (RTI) 状态开始时，最严格满足这些约束条件的选项。\n\n哪个序列是正确的？\n\nA. 从 RTI 状态开始，通过 Shift-IR 和 Update-IR 加载 SAMPLE/PRELOAD 指令；通过 Shift-DR 预加载所有输出控制位为 $OE=0$，然后执行 Update-DR；通过 Shift-IR 和 Update-IR 加载 EXTEST 指令，使 BSR 控制焊盘 OE；执行 Capture-DR 和 Shift-DR 以回读控制单元状态并验证 $OE=0$；然后通过 Shift-IR 和 Update-IR 加载 INTEST 指令，进入核隔离测试，此时焊盘保持禁用状态。\n\nB. 从 RTI 状态开始，立即通过 Shift-IR 和 Update-IR 加载 INTEST 指令；然后通过 Shift-DR 预加载输出控制位为 $OE=0$；最后在已处于 INTEST 模式下执行 Update-DR 以应用三态。\n\nC. 从 RTI 状态开始，通过 Shift-IR 和 Update-IR 加载 HIGHZ 指令以强制所有输出为高阻态；然后通过 Shift-IR 和 Update-IR 加载 INTEST 指令；假设在 INTEST 期间焊盘保持禁用状态，不进行任何 BSR 回读。\n\nD. 从 RTI 状态开始，通过 Shift-IR 和 Update-IR 加载 SAMPLE/PRELOAD 指令；通过 Shift-DR 预加载所有输出控制位为 $OE=0$；执行 Capture-DR 和 Shift-DR 以回读 BSR 并验证 $OE=0$；然后执行 Update-DR；最后通过 Shift-IR 和 Update-IR 加载 INTEST 指令。\n\nE. 从 RTI 状态开始，通过 Shift-IR 和 Update-IR 加载 SAMPLE/PRELOAD 指令；通过 Shift-DR 预加载 $OE=0$ 并执行 Update-DR；通过 Shift-IR 和 Update-IR 加载 CLAMP 指令以应用预加载的三态；然后在保持 CLAMP 模式的同时，尝试通过执行 Capture-DR 和 Shift-DR 来确认 $OE=0$；最后通过 Shift-IR 和 Update-IR 加载 INTEST 指令。",
            "solution": "此问题的目标是找到一个安全的方法，在不引起总线竞争的前提下进入`INTEST`模式。这意味着在`INTEST`指令生效之前，必须确保所有可能驱动共享总线的输出引脚都已被可靠地置于高阻态（三态），并且该状态已得到验证。\n\n让我们根据 IEEE 1149.1 标准的规则逐一分析每个选项：\n\n*   **B. 错误。** 立即加载 `INTEST` 指令是极其危险的。在加载并更新 `OE=0` 值之前，边界扫描寄存器（BSR）的初始状态是未知的。一旦 `INTEST` 指令生效，BSR 就会接管内核边界，其对焊盘驱动器的初始控制状态可能是随机的或默认的驱动状态，这极有可能立即导致总线竞争。\n\n*   **C. 错误。** 虽然 `HIGHZ` 指令的目的是将输出置于高阻态，但它通常会选择 `BYPASS` 寄存器。这意味着您将无法访问 BSR，因此无法扫描 BSR 以确认输出是否真的处于高阻态，也无法为 `INTEST` 模式预加载任何特定的输入值。此外，从 `HIGHZ` 切换到 `INTEST` 的过程中，控制权的交接不保证是无缝无冲突的。\n\n*   **D. 错误。** 这个序列存在一个关键的逻辑缺陷。它使用 `SAMPLE/PRELOAD` 指令加载 `OE=0` 值，但它在执行 `Update-DR` 之前尝试通过 `Capture-DR` 和 `Shift-DR` 来验证状态。`Capture-DR` 操作捕获的是引脚的当前状态（此时仍由系统逻辑控制），而不是刚刚移入 BSR 移位路径的值。接着，执行 `Update-DR` 时，虽然 `OE=0` 被加载到 BSR 的更新锁存器中，但在 `SAMPLE/PRELOAD` 指令下，这个值并不会被应用到引脚驱动器。当最终切换到 `INTEST` 指令时，更新锁存器中的值在指令切换过程中不保证被保留，因此该序列是不安全的。\n\n*   **E. 错误。** `CLAMP` 指令确实会将预加载的 BSR 值应用到焊盘上。但是，与 `HIGHZ` 类似，它随后会选择 `BYPASS` 寄存器。这使得在 `CLAMP` 模式下无法通过 `Capture-DR` 和 `Shift-DR` 访问 BSR 来确认其状态，因为 BSR 已不在 TDI-TDO 扫描路径中。\n\n*   **A. 正确。** 这个序列描述了实现此目标的标准、健壮且安全的方法。\n    1.  **加载 `SAMPLE/PRELOAD` 指令：** 此操作选择 BSR 作为当前数据寄存器，但不会影响引脚驱动器，系统继续正常工作。\n    2.  **通过 Shift-DR 预加载 `OE=0`：** 将用于禁用所有输出的控制值（`OE=0`）串行移入 BSR 的移位路径。\n    3.  **执行 `Update-DR`：** 将移位路径中的 `OE=0` 值并行加载到 BSR 的更新锁存器中。此时，引脚状态仍然不受影响。\n    4.  **加载 `EXTEST` 指令：** 当 `EXTEST` 指令在 `Update-IR` 状态生效时，BSR 的输出级被使能。它会立即开始驱动来自更新锁存器的值，也就是我们预加载好的安全值（`OE=0`），从而将所有输出置于高阻态。这个转换过程是无冲突的，因为它从一个预先设置好的安全状态开始。\n    5.  **通过 `Capture-DR` 和 `Shift-DR` 验证：** 在 `EXTEST` 模式下，BSR 既控制着引脚，也是活动的数据寄存器。因此，可以执行一次扫描操作来回读 BSR 中控制单元的状态，从而完全确认所有输出已被成功禁用。\n    6.  **加载 `INTEST` 指令：** 既然已经确认焊盘在 BSR 的控制下处于安全的高阻态，此时切换到 `INTEST` 指令（该指令同样保持焊盘与内核的隔离）就是一个安全的操作，可以确保不会发生总线竞争。\n\n该序列正确利用了 BSR 的两阶段（移位/预加载 和 更新/应用）特性，并结合不同指令（`SAMPLE/PRELOAD` 和 `EXTEST`）的功能，实现了安全且可验证的状态转换。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}