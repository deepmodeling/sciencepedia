{
    "hands_on_practices": [
        {
            "introduction": "A core aspect of PLL analysis is understanding its dynamic response to external stimuli. The most fundamental performance metric describing this behavior is the lock time, which quantifies how quickly the loop settles to a stable state after an input phase or frequency step. This practice provides a hands-on derivation of the lock time for a canonical second-order PLL model, building a direct connection between abstract control parameters like natural frequency ($ \\omega_n $) and damping ratio ($ \\zeta $) to this tangible performance specification . This analysis is fundamental for designing control loops that meet system timing requirements.",
            "id": "4288887",
            "problem": "Consider a Phase-Locked Loop (PLL) linearized about lock and modeled by a canonical second-order Linear Time-Invariant (LTI) closed-loop transfer from input phase to output phase. The closed-loop is characterized by a natural frequency $\\,\\omega_{n}\\,$ and damping ratio $\\,\\zeta\\,$ with $\\,0<\\zeta<1\\,$. At time $\\,t=0\\,$, the input phase undergoes a small step of unit amplitude (one radian). Define the lock time $\\,t_{L}(\\epsilon)\\,$ as the smallest time after which the magnitude of the deviation of the output phase from its final value is bounded by a prescribed fractional error band $\\,\\epsilon\\,$ of the step amplitude for all subsequent time, i.e., $\\,|\\phi_{\\text{out}}(t)-1|\\leq \\epsilon\\,$ for all $\\,t\\geq t_{L}(\\epsilon)\\,$, where $\\,0<\\epsilon<1\\,$. Starting from the canonical second-order closed-loop description and the exact unit-step response, derive a conservative closed-form expression for $\\,t_{L}(\\epsilon)\\,$ in terms of $\\,\\omega_{n}\\,$, $\\,\\zeta\\,$, and $\\,\\epsilon\\,$ by ensuring that all subsequent oscillations are contained within the prescribed band via the natural response envelope. State any necessary conditions on $\\,\\epsilon\\,$ for the expression to be strictly positive. Your final answer must be a single symbolic expression for $\\,t_{L}(\\epsilon)\\,$. Do not use any numerical approximations.",
            "solution": "The problem requires the derivation of a conservative, closed-form expression for the lock time $t_{L}(\\epsilon)$ of a canonical second-order Phase-Locked Loop (PLL) subjected to a unit phase step input. The derivation must be based on the envelope of the natural response.\n\nThe closed-loop transfer function $H(s)$ from the input phase $\\Phi_{\\text{in}}(s)$ to the output phase $\\Phi_{\\text{out}}(s)$ for a canonical second-order system is given by:\n$$ H(s) = \\frac{\\Phi_{\\text{out}}(s)}{\\Phi_{\\text{in}}(s)} = \\frac{\\omega_{n}^2}{s^2 + 2\\zeta\\omega_{n}s + \\omega_{n}^2} $$\nHere, $\\omega_{n}$ is the natural frequency and $\\zeta$ is the damping ratio. The problem specifies an underdamped system, for which $0 < \\zeta < 1$.\n\nThe input is a unit phase step applied at time $t=0$, which in the Laplace domain is represented as:\n$$ \\Phi_{\\text{in}}(s) = \\mathcal{L}\\{u(t)\\} = \\frac{1}{s} $$\nwhere $u(t)$ is the unit step function.\n\nThe output phase in the Laplace domain is therefore:\n$$ \\Phi_{\\text{out}}(s) = H(s)\\Phi_{\\text{in}}(s) = \\frac{\\omega_{n}^2}{s(s^2 + 2\\zeta\\omega_{n}s + \\omega_{n}^2)} $$\n\nTo find the time-domain response $\\phi_{\\text{out}}(t)$, we compute the inverse Laplace transform of $\\Phi_{\\text{out}}(s)$. For an underdamped system ($0 < \\zeta < 1$), the standard result for the unit step response is:\n$$ \\phi_{\\text{out}}(t) = 1 - \\exp(-\\zeta\\omega_{n}t) \\left( \\cos(\\omega_{d}t) + \\frac{\\zeta}{\\sqrt{1-\\zeta^2}} \\sin(\\omega_{d}t) \\right) $$\nwhere $\\omega_{d} = \\omega_{n}\\sqrt{1-\\zeta^2}$ is the damped natural frequency. The final value of the output phase is $\\lim_{t \\to \\infty} \\phi_{\\text{out}}(t) = 1$ radian, as expected for a system with unity DC gain responding to a unit step.\n\nThe problem defines the lock time $t_{L}(\\epsilon)$ based on the deviation of the output phase from its final value. Let this deviation be $\\Delta\\phi(t) = \\phi_{\\text{out}}(t) - 1$.\n$$ \\Delta\\phi(t) = - \\exp(-\\zeta\\omega_{n}t) \\left( \\cos(\\omega_{d}t) + \\frac{\\zeta}{\\sqrt{1-\\zeta^2}} \\sin(\\omega_{d}t) \\right) $$\n\nTo determine the envelope of this deviation, we express the sinusoidal terms in a single phase-shifted sinusoidal form, $A\\sin(\\theta + \\psi)$. The amplitude $A$ of the expression in the parenthesis is:\n$$ A = \\sqrt{1^2 + \\left(\\frac{\\zeta}{\\sqrt{1-\\zeta^2}}\\right)^2} = \\sqrt{1 + \\frac{\\zeta^2}{1-\\zeta^2}} = \\sqrt{\\frac{1-\\zeta^2+\\zeta^2}{1-\\zeta^2}} = \\frac{1}{\\sqrt{1-\\zeta^2}} $$\nThus, the deviation can be written as:\n$$ \\Delta\\phi(t) = - \\frac{\\exp(-\\zeta\\omega_{n}t)}{\\sqrt{1-\\zeta^2}} \\sin(\\omega_{d}t + \\psi) $$\nwhere $\\psi = \\arctan\\left(\\frac{\\sqrt{1-\\zeta^2}}{\\zeta}\\right)$. The magnitude of the deviation is:\n$$ |\\phi_{\\text{out}}(t) - 1| = \\left| - \\frac{\\exp(-\\zeta\\omega_{n}t)}{\\sqrt{1-\\zeta^2}} \\sin(\\omega_{d}t + \\psi) \\right| = \\frac{\\exp(-\\zeta\\omega_{n}t)}{\\sqrt{1-\\zeta^2}} |\\sin(\\omega_{d}t + \\psi)| $$\n\nThe problem asks for a conservative estimate of the lock time by using the envelope of the natural response. The envelope of $|\\phi_{\\text{out}}(t) - 1|$ is found by replacing the oscillating term $|\\sin(\\omega_{d}t + \\psi)|$ with its maximum possible value, which is $1$. Let this envelope be $E(t)$.\n$$ E(t) = \\frac{\\exp(-\\zeta\\omega_{n}t)}{\\sqrt{1-\\zeta^2}} $$\nThe lock time condition is $|\\phi_{\\text{out}}(t) - 1| \\leq \\epsilon$ for all $t \\geq t_{L}(\\epsilon)$. To obtain a conservative value for $t_{L}(\\epsilon)$, we enforce the stricter condition that the envelope $E(t)$ must be less than or equal to $\\epsilon$. The lock time $t_{L}(\\epsilon)$ is the time at which the envelope first enters and subsequently remains within this bound. This occurs when the envelope value equals $\\epsilon$.\n$$ E(t_{L}(\\epsilon)) = \\frac{\\exp(-\\zeta\\omega_{n}t_{L}(\\epsilon))}{\\sqrt{1-\\zeta^2}} = \\epsilon $$\n\nWe now solve this equation for $t_{L}(\\epsilon)$:\n$$ \\exp(-\\zeta\\omega_{n}t_{L}(\\epsilon)) = \\epsilon\\sqrt{1-\\zeta^2} $$\nTaking the natural logarithm of both sides gives:\n$$ -\\zeta\\omega_{n}t_{L}(\\epsilon) = \\ln\\left(\\epsilon\\sqrt{1-\\zeta^2}\\right) $$\nSolving for $t_{L}(\\epsilon)$:\n$$ t_{L}(\\epsilon) = -\\frac{1}{\\zeta\\omega_{n}} \\ln\\left(\\epsilon\\sqrt{1-\\zeta^2}\\right) $$\nUsing the property of logarithms $\\ln(x^{-1}) = -\\ln(x)$, this expression can be written as:\n$$ t_{L}(\\epsilon) = \\frac{1}{\\zeta\\omega_{n}} \\ln\\left(\\frac{1}{\\epsilon\\sqrt{1-\\zeta^2}}\\right) $$\nThis is the desired closed-form expression for the lock time.\n\nFinally, we determine the condition on $\\epsilon$ for $t_{L}(\\epsilon)$ to be strictly positive. Given that $\\omega_{n} > 0$ and $0 < \\zeta < 1$, the pre-factor $\\frac{1}{\\zeta\\omega_{n}}$ is always positive. Therefore, for $t_{L}(\\epsilon) > 0$, the argument of the logarithm must be greater than $1$:\n$$ \\frac{1}{\\epsilon\\sqrt{1-\\zeta^2}} > 1 $$\n$$ 1 > \\epsilon\\sqrt{1-\\zeta^2} $$\n$$ \\epsilon < \\frac{1}{\\sqrt{1-\\zeta^2}} $$\nThe problem specifies that $0 < \\epsilon < 1$. For the given range of $\\zeta$, $0 < \\zeta < 1$, the term $\\sqrt{1-\\zeta^2}$ is in the range $(0, 1)$. Consequently, $\\frac{1}{\\sqrt{1-\\zeta^2}}$ is always greater than $1$. Since $\\epsilon < 1$, the condition $\\epsilon < \\frac{1}{\\sqrt{1-\\zeta^2}}$ is always satisfied under the problem's constraints. The physical interpretation is that the requested error bound $\\epsilon$ must be smaller than the initial value of the response envelope at $t=0$, which is $E(0) = (\\sqrt{1-\\zeta^2})^{-1}$, for the lock time to be a positive duration.",
            "answer": "$$\\boxed{\\frac{1}{\\zeta\\omega_{n}}\\ln\\left(\\frac{1}{\\epsilon\\sqrt{1-\\zeta^2}}\\right)}$$"
        },
        {
            "introduction": "Once a PLL achieves lock, its steady-state performance is characterized by small, continuous fluctuations around the ideal output phase. These random fluctuations, collectively known as phase noise and its time-domain equivalent, jitter, are critical performance limiters in communication and clocking applications. This exercise  guides you through the essential task of calculating the total output timing jitter by integrating contributions from different internal noise sources. You will apply the principles of linear systems to see how the PLL's closed-loop transfer function acts as a filter, shaping the noise from components like the reference source and the VCO to determine the ultimate stability of the output signal.",
            "id": "4288869",
            "problem": "Consider a linearized small-signal phase-domain model of a first-order Phase-Locked Loop (PLL) with output carrier frequency $f_{0}$ and loop corner frequency $f_{c}$. Assume all angles are in radians, all noise sources are wide-sense stationary and mutually uncorrelated, and all spectra are single-sided Power Spectral Densities (PSDs). Let the closed-loop magnitude-squared transfer functions from input phase to output phase be specified as follows for frequency offset $f$ from the carrier:\n- From the reference input to the output: $\\left|H_{\\mathrm{ref}}(f)\\right|^{2} = \\dfrac{1}{1 + \\left(\\dfrac{f}{f_{c}}\\right)^{2}}$.\n- From the Voltage-Controlled Oscillator (VCO) intrinsic phase noise to the output: $\\left|H_{\\mathrm{vco}}(f)\\right|^{2} = \\dfrac{\\left(\\dfrac{f}{f_{c}}\\right)^{2}}{1 + \\left(\\dfrac{f}{f_{c}}\\right)^{2}}$.\n\nOver the offset-frequency band $f \\in [f_{1}, f_{2}]$, the only nonzero source PSDs are constant (white) phase-noise floors given by\n- Reference phase noise PSD: $S_{\\phi,\\mathrm{ref}}(f) = S_{r0}$ for $f \\in [f_{1}, f_{2}]$, and $S_{\\phi,\\mathrm{ref}}(f) = 0$ otherwise.\n- VCO phase noise PSD: $S_{\\phi,\\mathrm{vco}}(f) = S_{v0}$ for $f \\in [f_{1}, f_{2}]$, and $S_{\\phi,\\mathrm{vco}}(f) = 0$ otherwise.\n\nUse the parameters $f_{0} = 2.5\\,\\mathrm{GHz}$, $f_{c} = 100\\,\\mathrm{kHz}$, $f_{1} = 1\\,\\mathrm{kHz}$, $f_{2} = 100\\,\\mathrm{MHz}$, $S_{r0} = 1.0 \\times 10^{-10}\\,\\mathrm{rad}^{2}/\\mathrm{Hz}$, and $S_{v0} = 1.0 \\times 10^{-12}\\,\\mathrm{rad}^{2}/\\mathrm{Hz}$.\n\nStarting only from the basic properties of Linear Time-Invariant (LTI) systems relating input PSD to output PSD via the magnitude-squared frequency response, and from the kinematic relation between phase fluctuation and time fluctuation for a sinusoidal carrier, do the following:\n1. Form the total output phase noise PSD $S_{\\phi,\\mathrm{out}}(f)$ over $f \\in [f_{1}, f_{2}]$.\n2. Integrate $S_{\\phi,\\mathrm{out}}(f)$ over $[f_{1}, f_{2}]$ to obtain the output phase variance, and then convert it to Root Mean Square (RMS) time jitter at the PLL output.\n\nExpress the final RMS jitter in femtoseconds (fs) and round your answer to three significant figures. The final numeric answer must be a single number. Do not report intermediate results.",
            "solution": "The solution proceeds in two main parts as requested by the problem statement. First, we formulate the total output phase noise PSD, $S_{\\phi,\\mathrm{out}}(f)$. Second, we integrate this PSD to find the total output phase variance, from which we derive the RMS time jitter.\n\n**1. Total Output Phase Noise PSD**\n\nFor a Linear Time-Invariant (LTI) system, the output power spectral density, $S_{\\text{out}}(f)$, is related to the input power spectral density, $S_{\\text{in}}(f)$, by the magnitude-squared of the system's frequency response, $|H(f)|^2$, as follows:\n$$S_{\\text{out}}(f) = S_{\\text{in}}(f) \\left|H(f)\\right|^2$$\nThe problem states that the noise sources (reference and VCO) are uncorrelated. Therefore, their contributions to the total output noise power add linearly. The total output phase noise PSD, $S_{\\phi,\\mathrm{out}}(f)$, is the sum of the reference noise contribution and the VCO noise contribution.\n\nThe contribution from the reference phase noise is:\n$$S_{\\phi,\\mathrm{out,ref}}(f) = S_{\\phi,\\mathrm{ref}}(f) \\left|H_{\\mathrm{ref}}(f)\\right|^2$$\nThe contribution from the VCO phase noise is:\n$$S_{\\phi,\\mathrm{out,vco}}(f) = S_{\\phi,\\mathrm{vco}}(f) \\left|H_{\\mathrm{vco}}(f)\\right|^2$$\nThe total output phase noise PSD is their sum:\n$$S_{\\phi,\\mathrm{out}}(f) = S_{\\phi,\\mathrm{out,ref}}(f) + S_{\\phi,\\mathrm{out,vco}}(f)$$\nOver the specified frequency band $f \\in [f_{1}, f_{2}]$, the input PSDs are constant floors, $S_{\\phi,\\mathrm{ref}}(f) = S_{r0}$ and $S_{\\phi,\\mathrm{vco}}(f) = S_{v0}$. Substituting the given expressions:\n$$S_{\\phi,\\mathrm{out}}(f) = S_{r0} \\left(\\dfrac{1}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}}\\right) + S_{v0} \\left(\\dfrac{\\left(\\frac{f}{f_{c}}\\right)^{2}}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}}\\right)$$\nThis expression can be combined over a common denominator:\n$$S_{\\phi,\\mathrm{out}}(f) = \\dfrac{S_{r0} + S_{v0}\\left(\\frac{f}{f_{c}}\\right)^{2}}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}}$$\nThis is the total output phase noise PSD for $f \\in [f_{1}, f_{2}]$.\n\n**2. Integration for Phase Variance and Conversion to Time Jitter**\n\nThe total integrated phase variance, $\\sigma_{\\phi}^2$, is the integral of the single-sided PSD $S_{\\phi,\\mathrm{out}}(f)$ over the frequency interval of interest, $[f_{1}, f_{2}]$.\n$$\\sigma_{\\phi}^2 = \\int_{f_{1}}^{f_{2}} S_{\\phi,\\mathrm{out}}(f) \\, df$$\nTo simplify the integration, the integrand is rearranged by algebraic manipulation:\n$$S_{\\phi,\\mathrm{out}}(f) = \\dfrac{S_{r0} + S_{v0}\\left(\\frac{f}{f_{c}}\\right)^{2}}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}} = \\dfrac{S_{r0} - S_{v0} + S_{v0} + S_{v0}\\left(\\frac{f}{f_{c}}\\right)^{2}}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}}$$\n$$S_{\\phi,\\mathrm{out}}(f) = \\dfrac{S_{r0} - S_{v0}}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}} + \\dfrac{S_{v0}\\left(1 + \\left(\\frac{f}{f_{c}}\\right)^{2}\\right)}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}} = \\dfrac{S_{r0} - S_{v0}}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}} + S_{v0}$$\nThis form is more amenable to integration. The phase variance integral becomes:\n$$\\sigma_{\\phi}^2 = \\int_{f_{1}}^{f_{2}} \\left( \\dfrac{S_{r0} - S_{v0}}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}} + S_{v0} \\right) df$$\n$$\\sigma_{\\phi}^2 = (S_{r0} - S_{v0}) \\int_{f_{1}}^{f_{2}} \\dfrac{1}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}} df + S_{v0} \\int_{f_{1}}^{f_{2}} df$$\nThe second integral is trivial: $S_{v0}(f_{2} - f_{1})$. For the first integral, the antiderivative of $\\left(1 + (f/f_c)^2\\right)^{-1}$ with respect to $f$ is $f_{c}\\arctan(f/f_{c})$.\n$$\\int_{f_{1}}^{f_{2}} \\dfrac{1}{1 + \\left(\\frac{f}{f_{c}}\\right)^{2}} df = \\left[ f_{c}\\arctan\\left(\\frac{f}{f_{c}}\\right) \\right]_{f_{1}}^{f_{2}} = f_{c} \\left( \\arctan\\left(\\frac{f_{2}}{f_{c}}\\right) - \\arctan\\left(\\frac{f_{1}}{f_{c}}\\right) \\right)$$\nCombining the results, the total phase variance is:\n$$\\sigma_{\\phi}^2 = (S_{r0} - S_{v0}) f_{c} \\left[ \\arctan\\left(\\frac{f_{2}}{f_{c}}\\right) - \\arctan\\left(\\frac{f_{1}}{f_{c}}\\right) \\right] + S_{v0}(f_{2} - f_{1})$$\nThe Root Mean Square (RMS) phase jitter is $\\sigma_{\\phi} = \\sqrt{\\sigma_{\\phi}^2}$. The kinematic relationship between a small phase fluctuation $\\Delta\\phi$ (in radians) and the corresponding time fluctuation $\\Delta t$ for a sinusoidal carrier with frequency $f_0$ is $\\Delta\\phi = 2\\pi f_0 \\Delta t$. Therefore, the RMS time jitter, $\\sigma_t$, is:\n$$\\sigma_{t} = \\dfrac{\\sigma_{\\phi}}{2\\pi f_{0}} = \\dfrac{1}{2\\pi f_{0}} \\sqrt{(S_{r0} - S_{v0}) f_{c} \\left[ \\arctan\\left(\\frac{f_{2}}{f_{c}}\\right) - \\arctan\\left(\\frac{f_{1}}{f_{c}}\\right) \\right] + S_{v0}(f_{2} - f_{1})}$$\nNow, we substitute the given numerical values:\n- $f_{0} = 2.5 \\times 10^{9}\\,\\mathrm{Hz}$\n- $f_{c} = 100 \\times 10^{3}\\,\\mathrm{Hz} = 10^{5}\\,\\mathrm{Hz}$\n- $f_{1} = 1 \\times 10^{3}\\,\\mathrm{Hz}$\n- $f_{2} = 100 \\times 10^{6}\\,\\mathrm{Hz} = 10^{8}\\,\\mathrm{Hz}$\n- $S_{r0} = 1.0 \\times 10^{-10}\\,\\mathrm{rad}^{2}/\\mathrm{Hz}$\n- $S_{v0} = 1.0 \\times 10^{-12}\\,\\mathrm{rad}^{2}/\\mathrm{Hz}$\n\nFirst, calculate the arguments for the arctan functions:\n- $\\frac{f_{2}}{f_{c}} = \\frac{10^{8}}{10^{5}} = 1000$\n- $\\frac{f_{1}}{f_{c}} = \\frac{10^{3}}{10^{5}} = 0.01$\n\nNext, calculate the terms inside the square root:\n- $S_{r0} - S_{v0} = 1.0 \\times 10^{-10} - 1.0 \\times 10^{-12} = 99 \\times 10^{-12}\\,\\mathrm{rad}^{2}/\\mathrm{Hz}$\n- $f_{2} - f_{1} = 10^{8} - 10^{3} = 99,999,000\\,\\mathrm{Hz}$\n\nThe first term for $\\sigma_{\\phi}^2$:\n$$T_{1} = (99 \\times 10^{-12}) \\times 10^{5} \\times [\\arctan(1000) - \\arctan(0.01)]$$\n$$T_{1} \\approx (9.9 \\times 10^{-6}) \\times (1.5707963 - 0.00999967) = (9.9 \\times 10^{-6}) \\times (1.56079663) \\approx 1.5451887 \\times 10^{-5}\\,\\mathrm{rad}^{2}$$\nThe second term for $\\sigma_{\\phi}^2$:\n$$T_{2} = (1.0 \\times 10^{-12}) \\times (99,999,000) = 9.9999 \\times 10^{-5}\\,\\mathrm{rad}^{2}$$\nThe total phase variance is:\n$$\\sigma_{\\phi}^2 = T_{1} + T_{2} \\approx 1.5451887 \\times 10^{-5} + 9.9999 \\times 10^{-5} = 11.5450887 \\times 10^{-5} \\approx 1.15451 \\times 10^{-4}\\,\\mathrm{rad}^{2}$$\nThe RMS phase jitter is:\n$$\\sigma_{\\phi} = \\sqrt{1.15451 \\times 10^{-4}} \\approx 0.0107448\\,\\mathrm{rad}$$\nFinally, we calculate the RMS time jitter $\\sigma_t$:\n$$\\sigma_{t} = \\dfrac{\\sigma_{\\phi}}{2\\pi f_{0}} \\approx \\dfrac{0.0107448}{2\\pi \\times (2.5 \\times 10^{9})} = \\dfrac{0.0107448}{5\\pi \\times 10^{9}} \\approx \\dfrac{0.0107448}{1.570796 \\times 10^{10}} \\approx 6.83909 \\times 10^{-13}\\,\\mathrm{s}$$\nThe problem asks for the result in femtoseconds ($1\\,\\mathrm{fs} = 10^{-15}\\,\\mathrm{s}$).\n$$\\sigma_{t} \\approx 6.83909 \\times 10^{-13}\\,\\mathrm{s} = 683.909 \\times 10^{-15}\\,\\mathrm{s} = 683.909\\,\\mathrm{fs}$$\nRounding to three significant figures, we get $684\\,\\mathrm{fs}$.",
            "answer": "$$\n\\boxed{684}\n$$"
        },
        {
            "introduction": "While random noise determines the noise floor and integrated jitter, PLL performance can also be degraded by deterministic, periodic interference. These interferences manifest as distinct spectral spurs, which can be particularly problematic in RF synthesizers and communication systems. This final practice  delves into the common issue of reference spurs, which arise from tiny, periodic imperfections in the charge pump and phase-frequency detector. By modeling this non-ideality and calculating the resulting spur magnitude, you will gain a clear understanding of how subtle circuit-level behaviors translate directly into critical spectral purity specifications.",
            "id": "4288852",
            "problem": "Consider an integer-$N$ Phase-Locked Loop (PLL) employing a Phase-Frequency Detector (PFD), a Charge Pump (CP), a passive loop filter, and a Voltage-Controlled Oscillator (VCO). In locked steady state, nonideal PFD reset timing causes equal and opposite CP pulses once per reference period, creating a periodic current into the loop filter at the reference frequency $f_{\\mathrm{ref}} = 1/T_{\\mathrm{ref}}$. Assume the CP output current waveform entering the loop filter can be modeled as a rectangular pulse train of amplitude $I_{\\mathrm{CP}}$ and width $\\tau$ occurring once per reference period $T_{\\mathrm{ref}}$, with zero average over a period. The loop filter presents a magnitude of impedance $|Z(j \\omega_{\\mathrm{ref}})|$ at $\\omega_{\\mathrm{ref}} = 2\\pi f_{\\mathrm{ref}}$. The VCO has gain $K_{\\mathrm{VCO}}$ in $\\mathrm{rad/s/V}$.\n\nStarting from first principles, model the CP current as a periodic rectangular waveform and determine the magnitude of the first harmonic of the control voltage at $\\omega_{\\mathrm{ref}}$. Use the relationship between instantaneous frequency deviation and phase to obtain the small-signal phase modulation index at $\\omega_{\\mathrm{ref}}$, and from this determine the magnitude of the first-order reference sidebands at $\\pm f_{\\mathrm{ref}}$ relative to the carrier, expressed in $\\mathrm{dBc}$.\n\nGiven:\n- $I_{\\mathrm{CP}} = 100\\,\\mathrm{\\mu A}$,\n- $T_{\\mathrm{ref}} = 10\\,\\mathrm{ns}$,\n- $\\tau = 200\\,\\mathrm{ps}$,\n- $|Z(j \\omega_{\\mathrm{ref}})| = 100\\,\\Omega$,\n- $K_{\\mathrm{VCO}} = 2\\pi \\times 300 \\times 10^{6}\\,\\mathrm{rad/s/V}$.\n\nCompute the spur magnitude at $\\pm f_{\\mathrm{ref}}$ in $\\mathrm{dBc}$. Round your final answer to three significant figures and express the result in $\\mathrm{dBc}$.",
            "solution": "The solution proceeds by following the steps outlined in the problem statement.\n\nFirst, we model the charge pump current $i_{\\mathrm{cp}}(t)$ entering the loop filter. The problem states this is a periodic rectangular pulse train with period $T_{\\mathrm{ref}}$, amplitude $I_{\\mathrm{CP}}$, and width $\\tau$. In a locked PLL, any DC component of this disturbance current is cancelled by the feedback loop. The periodic AC components, however, remain and cause ripples on the VCO control voltage. The spur at the reference frequency is caused by the fundamental harmonic of this current waveform. We can represent the AC component of the current by its Fourier series. The waveform can be modeled as a series of pulses of height $I_{\\mathrm{CP}}$ and duration $\\tau$ occurring once every $T_{\\mathrm{ref}}$.\n\nThe complex Fourier series coefficient $c_n$ for a periodic function $f(t)$ with period $T$ is given by $c_n = \\frac{1}{T} \\int_{T} f(t) e^{-j n \\omega_0 t} dt$, where $\\omega_0 = 2\\pi/T$. For the current waveform $i_{\\mathrm{cp}}(t)$, with $T=T_{\\mathrm{ref}}$ and $\\omega_0=\\omega_{\\mathrm{ref}}$, the first harmonic coefficient ($n=1$) is:\n$$c_1 = \\frac{1}{T_{\\mathrm{ref}}} \\int_{0}^{\\tau} I_{\\mathrm{CP}} e^{-j \\omega_{\\mathrm{ref}} t} dt$$\n$$c_1 = \\frac{I_{\\mathrm{CP}}}{T_{\\mathrm{ref}}} \\left[ \\frac{e^{-j \\omega_{\\mathrm{ref}} t}}{-j \\omega_{\\mathrm{ref}}} \\right]_{0}^{\\tau} = \\frac{I_{\\mathrm{CP}}}{-j \\omega_{\\mathrm{ref}} T_{\\mathrm{ref}}} (e^{-j \\omega_{\\mathrm{ref}} \\tau} - 1)$$\nUsing $\\omega_{\\mathrm{ref}} T_{\\mathrm{ref}} = 2\\pi$:\n$$c_1 = \\frac{I_{\\mathrm{CP}}}{-j 2\\pi} (e^{-j \\omega_{\\mathrm{ref}} \\tau} - 1)$$\nThe magnitude of this coefficient is:\n$$|c_1| = \\left| \\frac{I_{\\mathrm{CP}}}{-j 2\\pi} \\right| \\left| e^{-j \\omega_{\\mathrm{ref}} \\tau} - 1 \\right| = \\frac{I_{\\mathrm{CP}}}{2\\pi} \\left| e^{-j \\omega_{\\mathrm{ref}} \\tau/2} (e^{-j \\omega_{\\mathrm{ref}} \\tau/2} - e^{j \\omega_{\\mathrm{ref}} \\tau/2}) \\right|$$\n$$|c_1| = \\frac{I_{\\mathrm{CP}}}{2\\pi} \\left| -2j \\sin\\left(\\frac{\\omega_{\\mathrm{ref}}\\tau}{2}\\right) \\right| = \\frac{I_{\\mathrm{CP}}}{\\pi} \\left| \\sin\\left(\\frac{\\omega_{\\mathrm{ref}}\\tau}{2}\\right) \\right|$$\nThe first harmonic of the current is $i_1(t) = c_1 e^{j\\omega_{\\mathrm{ref}}t} + c_{-1}e^{-j\\omega_{\\mathrm{ref}}t}$. Since $i_{\\mathrm{cp}}(t)$ is real, $c_{-1} = c_1^*$. This combination represents a real sinusoid with a peak amplitude of $I_{1,\\text{peak}} = 2|c_1|$.\n$$I_{1,\\text{peak}} = \\frac{2 I_{\\mathrm{CP}}}{\\pi} \\left| \\sin\\left(\\frac{\\omega_{\\mathrm{ref}}\\tau}{2}\\right) \\right|$$\nThis current harmonic at $\\omega_{\\mathrm{ref}}$ flows into the loop filter, which has an impedance $Z(j\\omega)$. At the frequency $\\omega_{\\mathrm{ref}}$, this current produces a voltage ripple on the VCO control line, $v_{\\mathrm{ctrl},1}(t)$. The peak amplitude of this voltage ripple, $V_{1,\\text{peak}}$, is given by Ohm's law in the frequency domain:\n$$V_{1,\\text{peak}} = I_{1,\\text{peak}} |Z(j \\omega_{\\mathrm{ref}})| = \\frac{2 I_{\\mathrm{CP}}}{\\pi} |Z(j \\omega_{\\mathrm{ref}})| \\left| \\sin\\left(\\frac{\\omega_{\\mathrm{ref}}\\tau}{2}\\right) \\right|$$\nThis voltage ripple modulates the VCO's frequency. The instantaneous frequency deviation from the carrier, $\\Delta\\omega(t)$, is:\n$$\\Delta\\omega(t) = K_{\\mathrm{VCO}} v_{\\mathrm{ctrl},1}(t)$$\nThe peak frequency deviation is $\\Delta\\omega_{\\text{peak}} = K_{\\mathrm{VCO}} V_{1,\\text{peak}}$. The output phase of the VCO is the integral of its instantaneous frequency. The phase deviation $\\Delta\\theta(t)$ is the integral of the frequency deviation $\\Delta\\omega(t)$. For a sinusoidal frequency deviation, the peak phase deviation, known as the phase modulation index $\\beta$, is:\n$$\\beta = \\frac{\\Delta\\omega_{\\text{peak}}}{\\omega_{\\mathrm{ref}}} = \\frac{K_{\\mathrm{VCO}} V_{1,\\text{peak}}}{\\omega_{\\mathrm{ref}}}$$\nSubstituting the expression for $V_{1,\\text{peak}}$:\n$$\\beta = \\frac{K_{\\mathrm{VCO}}}{\\omega_{\\mathrm{ref}}} \\frac{2 I_{\\mathrm{CP}}}{\\pi} |Z(j \\omega_{\\mathrm{ref}})| \\left| \\sin\\left(\\frac{\\omega_{\\mathrm{ref}}\\tau}{2}\\right) \\right|$$\nA phase-modulated signal $V_{\\mathrm{out}}(t) = A\\cos(\\omega_0 t + \\beta \\sin(\\omega_m t))$ can be expanded using Bessel functions. For a small modulation index ($\\beta \\ll 1$), we can use the approximation $J_0(\\beta) \\approx 1$, $J_1(\\beta) \\approx \\beta/2$, and $J_n(\\beta) \\approx 0$ for $n>1$. The output signal is approximately:\n$$V_{\\mathrm{out}}(t) \\approx A \\cos(\\omega_0 t) + A\\frac{\\beta}{2}\\cos((\\omega_0+\\omega_m)t) - A\\frac{\\beta}{2}\\cos((\\omega_0-\\omega_m)t)$$\nThe amplitude of the carrier is $A$, and the amplitude of the first-order sidebands at $\\omega_0 \\pm \\omega_m$ is $A\\beta/2$. Here, the carrier is the PLL output frequency and the modulating signal is the reference, so $\\omega_m = \\omega_{\\mathrm{ref}}$.\nThe power is proportional to amplitude squared. The ratio of the power in a single sideband to the power in the carrier is $(\\frac{A\\beta/2}{A})^2 = (\\frac{\\beta}{2})^2$.\nIn decibels relative to the carrier ($\\mathrm{dBc}$), the magnitude of the reference spur is:\n$$S = 10 \\log_{10}\\left(\\left(\\frac{\\beta}{2}\\right)^2\\right) = 20 \\log_{10}\\left(\\frac{\\beta}{2}\\right)$$\nNow we substitute the given values:\n- $I_{\\mathrm{CP}} = 100 \\times 10^{-6}\\,\\mathrm{A}$\n- $T_{\\mathrm{ref}} = 10 \\times 10^{-9}\\,\\mathrm{s}$\n- $\\tau = 200 \\times 10^{-12}\\,\\mathrm{s}$\n- $|Z(j \\omega_{\\mathrm{ref}})| = 100\\,\\Omega$\n- $K_{\\mathrm{VCO}} = 2\\pi \\times 300 \\times 10^{6}\\,\\mathrm{rad/s/V}$\n\nFirst, calculate $\\omega_{\\mathrm{ref}}$ and the argument of the sine function:\n$$\\omega_{\\mathrm{ref}} = \\frac{2\\pi}{T_{\\mathrm{ref}}} = \\frac{2\\pi}{10 \\times 10^{-9}} = 2\\pi \\times 10^8\\,\\mathrm{rad/s}$$\n$$\\frac{\\omega_{\\mathrm{ref}}\\tau}{2} = \\frac{(2\\pi \\times 10^8) (200 \\times 10^{-12})}{2} = 2\\pi \\times 10^{-2} = 0.02\\pi\\,\\mathrm{rad}$$\nSince $0.02\\pi \\ll 1$, we can use the approximation $\\sin(x) \\approx x$.\n$$\\left| \\sin\\left(\\frac{\\omega_{\\mathrm{ref}}\\tau}{2}\\right) \\right| \\approx \\frac{\\omega_{\\mathrm{ref}}\\tau}{2} = 0.02\\pi$$\nNow, we calculate the modulation index $\\beta$:\n$$\\beta \\approx \\frac{K_{\\mathrm{VCO}}}{\\omega_{\\mathrm{ref}}} \\frac{2 I_{\\mathrm{CP}}}{\\pi} |Z(j \\omega_{\\mathrm{ref}})| \\left(\\frac{\\omega_{\\mathrm{ref}}\\tau}{2}\\right) = \\frac{K_{\\mathrm{VCO}} I_{\\mathrm{CP}} |Z(j \\omega_{\\mathrm{ref}})| \\tau}{\\pi}$$\n$$\\beta \\approx \\frac{(2\\pi \\times 300 \\times 10^6) (100 \\times 10^{-6}) (100) (200 \\times 10^{-12})}{\\pi}$$\n$$\\beta \\approx 2 \\times (300 \\times 10^6) \\times (10^{-4}) \\times (10^2) \\times (2 \\times 10^{-10}) = 1200 \\times 10^{6-4+2-10} = 1200 \\times 10^{-6} = 1.2 \\times 10^{-3}$$\nThe value is small, confirming the validity of the small-index approximation.\nFinally, we compute the spur magnitude in $\\mathrm{dBc}$:\n$$S = 20 \\log_{10}\\left(\\frac{\\beta}{2}\\right) \\approx 20 \\log_{10}\\left(\\frac{1.2 \\times 10^{-3}}{2}\\right) = 20 \\log_{10}(6 \\times 10^{-4})$$\n$$S \\approx 20 (\\log_{10}(6) - 4) \\approx 20 (0.77815 - 4) = 20(-3.22185) \\approx -64.437\\,\\mathrm{dBc}$$\nRounding to three significant figures, the result is $-64.4\\,\\mathrm{dBc}$.",
            "answer": "$$\\boxed{-64.4}$$"
        }
    ]
}