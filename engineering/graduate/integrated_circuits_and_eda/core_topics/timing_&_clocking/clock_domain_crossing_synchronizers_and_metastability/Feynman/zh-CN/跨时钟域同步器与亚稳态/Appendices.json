{
    "hands_on_practices": [
        {
            "introduction": "两级触发器同步器是跨时钟域设计中最基础也是最常见的结构。其可靠性的核心在于为第一级触发器可能进入的亚稳态提供足够长的“解析时间”。本练习将引导你从最基本的时序参数（如时钟周期、建立时间等）出发，推导出亚稳态失效间隔平均时间（MTBF）的关键公式()，从而深刻理解物理实现细节与系统统计可靠性之间的直接联系。",
            "id": "4259927",
            "problem": "在一个采用电子设计自动化（EDA）方法设计的集成电路中，一个两级触发器同步器被用来将一个异步二进制信号传输到目标时钟域。该同步器由两个串联的上升沿触发D型触发器组成，两者都由目标时钟驱动。第一级（$\\text{FF1}$）对异步输入进行采样，第二级（$\\text{FF2}$）在一个目标时钟周期后对$\\text{FF1}$的输出进行采样。设目标时钟周期为$T_{clk}$。设时钟到达$\\text{FF1}$和$\\text{FF2}$的时间相差一个时钟偏斜$skew$，$skew$定义为$\\text{FF2}$的时钟相对于$\\text{FF1}$的时钟提前的时间；一个正的$skew$会减少两次采样事件之间的可用时间。第一级的时钟到Q端延迟为$t_{cq1}$，第二级的建立时间要求为$t_{setup2}$。\n\n在双稳态电路的标准亚稳态模型下，一旦采样事件将第一级锁存器驱动到亚稳态，该亚稳态持续时间超过$t$的概率会以特征时间常数$\\tau>0$近似指数衰减，并且一个与器件和工艺相关的参数$T_{0}>0$捕捉了易受攻击的时间窗口的有效宽度和锁存器的增益因子。假设异步输入的平均跳变率等于目标时钟频率，并且每个目标时钟周期都进行采样，即输入跳变率和采样率都等于$1/T_{clk}$。\n\n仅从这些定义和假设出发，并基于亚稳态解析时间随时间常数$\\tau$呈指数衰减的行为，执行以下操作：\n\n1. 推导在$\\text{FF1}$的采样沿和$\\text{FF2}$的下一个采样沿之间的可用亚稳态解析时间$T_{res}$，用$T_{clk}$、$t_{cq1}$、$t_{setup2}$和$skew$表示。根据时序要求和因果关系，清楚地解释表达式中每一项的理由。\n\n2. 使用指数解析模型以及所述的事件率和采样率，推导此两级触发器同步器的平均无故障时间（MTBF）的闭式解析表达式（以秒为单位），该表达式是$T_{clk}$、$t_{cq1}$、$t_{setup2}$、$skew$、$\\tau$和$T_{0}$的函数。将最终的MTBF表示为单个以秒为单位的闭式表达式。不要进行数值计算；无需四舍五入。",
            "solution": "目标是推导亚稳态的可用解析时间，然后使用一个有充分依据的亚稳态解析随机模型，推导出故障率和平均无故障时间（MTBF）。\n\n我们从目标时钟域中两级同步器的时序结构开始。两个触发器都由目标时钟驱动。设时钟周期为$T_{clk}$，并设时钟到达第二个触发器$\\text{FF2}$的时间相对于到达第一个触发器$\\text{FF1}$的时间提前了$skew$。因此，一个正的$skew$会将$\\text{FF1}$和$\\text{FF2}$采样沿之间的时间从$T_{clk}$减少到$T_{clk}-skew$。\n\n第一个触发器$\\text{FF1}$在上升沿对异步输入进行采样。如果该采样违反了孔径时序（即到达时间与采样瞬间足够接近），$\\text{FF1}$可能进入亚稳态，并需要经过一段随机的解析时间后才能解析。$\\text{FF1}$的输出（$Q_1$）能够变为有效并开始向$\\text{FF2}$传播的最早时间是$\\text{FF1}$的时钟沿时间，加上时钟到Q端的延迟$t_{cq1}$，再加上状态移动到足够接近稳定电平所需的随机额外时间。为了确保正确捕获，$\\text{FF2}$的输入必须在$\\text{FF2}$的采样沿之前保持稳定$t_{setup2}$的时间。因此，$\\text{FF1}$的亚稳态解析的可用时间必须在时刻$(\\text{FF2时钟沿}) - t_{setup2}$之前完成。\n\n让我们如下同步相关的边沿：一个采样事件在时间$t=0$时发生在$\\text{FF1}$上。$\\text{FF2}$的下一个采样沿发生在时间$t=T_{clk}-skew$（因为假设了正的$skew$使$\\text{FF2}$提前）。为了正确捕获，$Q_1$必须在该$\\text{FF2}$边沿之前至少$t_{setup2}$的时间稳定下来并到达$\\text{FF2}$的输入端。此外，$Q_1$在$\\text{FF1}$边沿之后的确定性延迟$t_{cq1}$过去之前不会开始变化。这些时序要求得出了从$\\text{FF1}$采样瞬间到$\\text{FF2}$输入端最晚允许到达时间之间的可用解析时间为\n$$\nT_{res} \\;=\\; (\\text{time from }\\text{FF1}\\text{ edge to }\\text{FF2}\\text{ edge}) \\;-\\; t_{cq1} \\;-\\; t_{setup2} \\;=\\; T_{clk} - skew - t_{cq1} - t_{setup2}.\n$$\n这个表达式从标称的单周期间隔$T_{clk}$中减去了确定性时间预算$t_{cq1}$和$t_{setup2}$，以及边沿间距的有效减少量$skew$，剩下的就是可供$\\text{FF1}$中的亚稳态解析的时间间隔，以便$\\text{FF2}$能采样到一个有效的电平。\n\n接下来我们转向亚稳态解析的统计特性。对于一个因在采样沿附近到达的违规输入而被驱动到亚稳态的双稳态元件，其解析到足够接近稳定电平所需时间的分布，在经过一个小的偏移后，遵循指数尾部分布。一个广泛使用的形式将解析时间超过$t$的概率建模为与$\\exp(-t/\\tau)$成正比，其中$\\tau$是锁存器的时间常数。此处的比例常数不是一个纯概率，而是在故障率计算中作为一个具有时间单位的因子出现，通常表示为$T_{0}$，它包含了易受攻击窗口的有效宽度和与增益相关的参数。当将这种衰减与独立的输入跳变事件和独立的采样事件结合时，单位时间的故障率被建模为（i）相对于采样沿发生违规到达的机会率与（ii）由此产生的亚稳态持续时间超过可用解析时间的概率的乘积：\n$$\n\\lambda \\;=\\; f_{\\text{clk}} \\, f_{\\text{data}} \\, T_{0} \\, \\exp\\!\\left(-\\frac{T_{res}}{\\tau}\\right),\n$$\n其中$f_{\\text{clk}}$是目标采样率，$f_{\\text{data}}$是进入同步器的平均输入跳变率。根据所述假设，两个速率都等于目标时钟频率：$f_{\\text{clk}}=f_{\\text{data}}=\\frac{1}{T_{clk}}$。代入这些值和我们推导出的$T_{res}$，可得\n$$\n\\lambda \\;=\\; \\left(\\frac{1}{T_{clk}}\\right)\\left(\\frac{1}{T_{clk}}\\right) T_{0} \\, \\exp\\!\\left(-\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right)\n\\;=\\; \\frac{T_{0}}{T_{clk}^{2}} \\, \\exp\\!\\left(-\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right).\n$$\n平均无故障时间（MTBF）是故障率的倒数，\n$$\n\\text{MTBF} \\;=\\; \\frac{1}{\\lambda} \\;=\\; \\frac{T_{clk}^{2}}{T_{0}} \\, \\exp\\!\\left(\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right),\n$$\n其单位为秒，因为$T_{clk}^{2}/T_{0}$具有时间量纲，而指数部分是无量纲的。\n\n总之，推导出的可用解析时间是\n$$\nT_{res} \\;=\\; T_{clk} - t_{cq1} - t_{setup2} - skew,\n$$\n并且，在所述的速率和亚稳态模型下，以秒为单位的MTBF是\n$$\n\\text{MTBF} \\;=\\; \\frac{T_{clk}^{2}}{T_{0}} \\, \\exp\\!\\left(\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right).\n$$",
            "answer": "$$\\boxed{\\frac{T_{clk}^{2}}{T_{0}} \\exp\\!\\left(\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right)}$$"
        },
        {
            "introduction": "在真实的芯片设计中，工程师的目标不仅仅是分析现有电路的可靠性，更重要的是设计出满足特定可靠性指标的电路。本练习将问题反转，要求你从一个给定的系统级 $MTBF$ 目标（例如，整个芯片在50年内不发生亚稳态故障）出发。通过逆向应用 $MTBF$ 公式()，你将计算出为达到此目标所必需的最小解析时间，并由此确定电路实现中的具体时序预算。",
            "id": "4259955",
            "problem": "一个两级时钟域交叉同步器被用于将异步数据流捕获到目标时钟域中。如果异步数据转换发生在目标时钟边沿周围的一个小孔径窗口内，第一个触发器可能会进入亚稳态。假设亚稳态和事件建模的基础如下：\n- 异步数据转换被建模为平均速率为 $f_{\\mathrm{data}}$ 的泊松过程。\n- 目标时钟采样边沿以平均速率 $f_{\\mathrm{clk}}$ 出现。\n- 采样边沿周围宽度为 $T_{w}$ 的建立/保持孔径窗口定义了第一个触发器何时可能被激发进入亚稳态。\n- 一旦被激发，亚稳态持续时间超过解析时间 $t$ 的概率呈指数衰减，形式为 $\\exp(-t/\\tau)$，其中 $\\tau$ 是第一个触发器的亚稳态时间常数。\n- 芯片中有 $M$ 个独立且相同的同步器实例，并且实例间的故障在统计上是独立的。\n\n将第一个和第二个触发器之间可用的解析时间定义为\n$$\nT_{\\mathrm{res}} = T_{\\mathrm{clk}} - \\left(t_{\\mathrm{cq1}} + t_{\\mathrm{setup2}} + \\mathrm{skew}\\right),\n$$\n其中 $T_{\\mathrm{clk}} = 1/f_{\\mathrm{clk}}$ 是目标时钟周期，$t_{\\mathrm{cq1}}$ 是第一个触发器的时钟到Q延时，$t_{\\mathrm{setup2}}$ 是第二个触发器的建立时间，$\\mathrm{skew}$ 是第一个和第二个触发器之间的时钟或布线偏斜。如果任何同步器实例向其第二级采样边沿呈现亚稳态输出，即第一级在超过 $T_{\\mathrm{res}}$ 后仍保持亚稳态，则发生系统级故障。\n\n仅从上述假设以及泊松过程和亚稳态指数存活的标准特性出发，推导一个保证指定系统级平均无故障时间 (MTBF) 目标 $\\mathrm{MTBF}_{\\mathrm{sys}}$ 所需的最小 $T_{\\mathrm{res}}$ 的闭式表达式。然后，使用以下参数对其进行数值计算：\n- $f_{\\mathrm{clk}} = 1.2\\ \\text{GHz}$,\n- $f_{\\mathrm{data}} = 0.5\\ \\text{GHz}$,\n- $T_{w} = 20\\ \\text{ps}$,\n- $\\tau = 8\\ \\text{ps}$,\n- $M = 4000$,\n- $\\mathrm{MTBF}_{\\mathrm{sys}} = 50\\ \\text{years}$, 其中 $1\\ \\text{year} = 365.25\\ \\text{days}$。\n\n使用您推导出的 $T_{\\mathrm{res}}$，计算和 $t_{\\mathrm{cq1}} + t_{\\mathrm{setup2}} + \\mathrm{skew}$ 的最大允许裕量。\n\n将最小 $T_{\\mathrm{res}}$ 和最大允许 $t_{\\mathrm{cq1}} + t_{\\mathrm{setup2}} + \\mathrm{skew}$ 都以纳秒表示，并将您的答案四舍五入到四位有效数字。最终答案必须是以单行矩阵 $\\begin{pmatrix} \\cdot  \\cdot \\end{pmatrix}$ 形式写成的一对数值。",
            "solution": "解决方案首先推导系统级平均无故障时间（$\\mathrm{MTBF}_{\\mathrm{sys}}$），然后反转所得表达式以求解所需的最小解析时间 $T_{\\mathrm{res}}$。\n\n系统故障率 $R_{\\mathrm{fail\\_sys}}$ 是系统 MTBF 的倒数，假设故障是可以建模为泊松过程的罕见事件。\n$$ \\mathrm{MTBF}_{\\mathrm{sys}} = \\frac{1}{R_{\\mathrm{fail\\_sys}}} $$\n总系统故障率是 $M$ 个独立且相同的同步器实例的故障率之和。\n$$ R_{\\mathrm{fail\\_sys}} = M \\cdot R_{\\mathrm{fail\\_single}} $$\n其中 $R_{\\mathrm{fail\\_single}}$ 是单个同步器的故障率。\n\n单个同步器的故障率是两个因素的乘积：其第一个触发器被激发进入亚稳态的速率 $R_{\\mathrm{exc}}$，以及一旦被激发，触发器未能在分配的时间 $T_{\\mathrm{res}}$ 内解析到稳定状态的概率，记为 $P_{\\mathrm{fail|exc}}$。\n$$ R_{\\mathrm{fail\\_single}} = R_{\\mathrm{exc}} \\cdot P_{\\mathrm{fail|exc}} $$\n当异步数据转换到达目标时钟边沿的建立-保持孔径窗口 $T_w$ 内时，就会发生亚稳态激发。异步数据转换被建模为平均速率为 $f_{\\mathrm{data}}$ 的泊松过程。目标时钟以平均速率 $f_{\\mathrm{clk}}$ 提供采样机会。单位时间内易受攻击的孔径窗口的总持续时间是 $f_{\\mathrm{clk}} \\cdot T_w$。对于数据转换的泊松过程，这些窗口内发生的事件（转换）的速率是数据转换速率与窗口开放时间分数的乘积。\n$$ R_{\\mathrm{exc}} = f_{\\mathrm{data}} \\cdot (f_{\\mathrm{clk}} \\cdot T_w) $$\n当孔径窗口的持续时间 $T_w$ 远小于数据转换之间的平均时间 $1/f_{\\mathrm{data}}$ 和时钟周期 $1/f_{\\mathrm{clk}}$ 时，此表达式是一个标准且准确的近似。\n\n亚稳态持续时间长于 $t$ 的概率由指数存活函数 $\\exp(-t/\\tau)$ 给出。如果状态持续超过可用的解析时间 $T_{\\mathrm{res}}$，则发生故障。因此，激发后发生故障的条件概率为：\n$$ P_{\\mathrm{fail|exc}} = \\exp\\left(-\\frac{T_{\\mathrm{res}}}{\\tau}\\right) $$\n结合这些表达式，单个同步器的故障率为：\n$$ R_{\\mathrm{fail\\_single}} = (f_{\\mathrm{clk}} f_{\\mathrm{data}} T_w) \\exp\\left(-\\frac{T_{\\mathrm{res}}}{\\tau}\\right) $$\n系统级 MTBF 现在可以表示为：\n$$ \\mathrm{MTBF}_{\\mathrm{sys}} = \\frac{1}{M \\cdot R_{\\mathrm{fail\\_single}}} = \\frac{1}{M f_{\\mathrm{clk}} f_{\\mathrm{data}} T_w \\exp\\left(-\\frac{T_{\\mathrm{res}}}{\\tau}\\right)} = \\frac{\\exp\\left(\\frac{T_{\\mathrm{res}}}{\\tau}\\right)}{M f_{\\mathrm{clk}} f_{\\mathrm{data}} T_w} $$\n为了找到保证目标 $\\mathrm{MTBF}_{\\mathrm{sys}}$ 的最小 $T_{\\mathrm{res}}$，我们求解此方程以得到 $T_{\\mathrm{res}}$：\n$$ \\exp\\left(\\frac{T_{\\mathrm{res}}}{\\tau}\\right) = \\mathrm{MTBF}_{\\mathrm{sys}} \\cdot M \\cdot f_{\\mathrm{clk}} \\cdot f_{\\mathrm{data}} \\cdot T_w $$\n对两边取自然对数：\n$$ \\frac{T_{\\mathrm{res}}}{\\tau} = \\ln\\left(\\mathrm{MTBF}_{\\mathrm{sys}} \\cdot M \\cdot f_{\\mathrm{clk}} \\cdot f_{\\mathrm{data}} \\cdot T_w\\right) $$\n这得出了所需最小解析时间的闭式表达式：\n$$ T_{\\mathrm{res}} = \\tau \\ln\\left(M \\cdot f_{\\mathrm{clk}} \\cdot f_{\\mathrm{data}} \\cdot T_w \\cdot \\mathrm{MTBF}_{\\mathrm{sys}}\\right) $$\n现在，我们代入给定的数值：\n- $f_{\\mathrm{clk}} = 1.2\\ \\text{GHz} = 1.2 \\times 10^9\\ \\text{s}^{-1}$\n- $f_{\\mathrm{data}} = 0.5\\ \\text{GHz} = 0.5 \\times 10^9\\ \\text{s}^{-1}$\n- $T_{w} = 20\\ \\text{ps} = 20 \\times 10^{-12}\\ \\text{s}$\n- $\\tau = 8\\ \\text{ps} = 8 \\times 10^{-12}\\ \\text{s}$\n- $M = 4000$\n- $\\mathrm{MTBF}_{\\mathrm{sys}} = 50\\ \\text{years}$\n\n首先，我们将 $\\mathrm{MTBF}_{\\mathrm{sys}}$ 转换为秒：\n$$ \\mathrm{MTBF}_{\\mathrm{sys}} = 50\\ \\text{years} \\times 365.25\\ \\frac{\\text{days}}{\\text{year}} \\times 24\\ \\frac{\\text{hours}}{\\text{day}} \\times 3600\\ \\frac{\\text{s}}{\\text{hour}} = 1,577,880,000\\ \\text{s} $$\n接下来，我们计算对数的参数：\n$$ \\text{Arg} = M \\cdot f_{\\mathrm{clk}} \\cdot f_{\\mathrm{data}} \\cdot T_w \\cdot \\mathrm{MTBF}_{\\mathrm{sys}} $$\n$$ \\text{Arg} = (4000) \\cdot (1.2 \\times 10^9) \\cdot (0.5 \\times 10^9) \\cdot (20 \\times 10^{-12}) \\cdot (1.57788 \\times 10^9) $$\n$$ \\text{Arg} = (4 \\times 10^3) \\cdot (1.2 \\times 10^9) \\cdot (0.5 \\times 10^9) \\cdot (2 \\times 10^{-11}) \\cdot (1.57788 \\times 10^9) $$\n$$ \\text{Arg} = (4 \\cdot 1.2 \\cdot 0.5 \\cdot 2 \\cdot 1.57788) \\times 10^{(3+9+9-11+9)} = 7.573824 \\times 10^{19} $$\n现在我们可以计算 $T_{\\mathrm{res}}$：\n$$ T_{\\mathrm{res}} = (8 \\times 10^{-12}\\ \\text{s}) \\cdot \\ln(7.573824 \\times 10^{19}) $$\n$$ T_{\\mathrm{res}} \\approx (8 \\times 10^{-12}) \\cdot 45.773815 = 3.6619052 \\times 10^{-10}\\ \\text{s} $$\n转换为纳秒并四舍五入到四位有效数字：\n$$ T_{\\mathrm{res}} \\approx 0.3662\\ \\text{ns} $$\n问题的第二部分是求和 $t_{\\mathrm{cq1}} + t_{\\mathrm{setup2}} + \\mathrm{skew}$ 的最大允许裕量。这个裕量从 $T_{\\mathrm{res}}$ 的定义中推导出来：\n$$ T_{\\mathrm{res}} = T_{\\mathrm{clk}} - \\left(t_{\\mathrm{cq1}} + t_{\\mathrm{setup2}} + \\mathrm{skew}\\right) $$\n令 $T_{\\mathrm{budget}} = t_{\\mathrm{cq1}} + t_{\\mathrm{setup2}} + \\mathrm{skew}$。为了最大化 $T_{\\mathrm{budget}}$，我们必须使用所需的最小 $T_{\\mathrm{res}}$。\n$$ T_{\\mathrm{budget, max}} = T_{\\mathrm{clk}} - T_{\\mathrm{res, min}} $$\n首先，我们计算目标时钟周期 $T_{\\mathrm{clk}}$：\n$$ T_{\\mathrm{clk}} = \\frac{1}{f_{\\mathrm{clk}}} = \\frac{1}{1.2 \\times 10^9\\ \\text{s}^{-1}} = \\frac{5}{6} \\times 10^{-9}\\ \\text{s} \\approx 0.833333...\\ \\text{ns} $$\n现在，我们计算最大裕量：\n$$ T_{\\mathrm{budget, max}} = (0.833333... - 0.36619052...)\\ \\text{ns} = 0.46714281...\\ \\text{ns} $$\n四舍五入到四位有效数字：\n$$ T_{\\mathrm{budget, max}} \\approx 0.4671\\ \\text{ns} $$\n所要求的两个值是最小 $T_{\\mathrm{res}}$ 和最大时序裕量。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.3662  0.4671 \\end{pmatrix}}$$"
        },
        {
            "introduction": "当跨时钟域传输的信号从单个比特扩展到多比特总线时，会引入一种新的、与亚稳态不同的失效模式：数据不一致性。由于不同比特信号路径的延迟差异（skew），接收端可能在一个时钟沿采样到一部分“旧”数据和一部分“新”数据，从而组合成一个有效的、但完全错误的中间状态。本练习将量化这种因比特间偏移导致的解码错误概率，并引导你从根本上解释为何格雷码（Gray coding）是解决这一经典问题的有效方案()。",
            "id": "4259963",
            "problem": "一个数字系统采用了从源时钟域到接收时钟域的时钟域交叉。源域驱动一个两位状态总线，该总线采用二进制编码，状态为 $\\{00,01,10,11\\}$。接收域使用两个独立的两级触发器同步器（每位一个）来采样该总线。接收域时钟的周期为 $T_{r}$，任何数据转换相对于给定接收时钟沿的相位偏移被建模为在 $[0,T_{r})$ 上均匀分布。总线上的所有转换都由源域逻辑驱动，当在某些状态之间切换时，这会导致两个比特在名义上于同一源时钟沿发生变化；然而，由于路径差异，两个比特转换到达第一级同步器输入端的时间相差一个随机偏斜 $S$，其大小在 $[0,S_{\\max}]$ 上均匀分布。假设 $S_{\\max} \\ll T_{r}$ 并且 $S$ 与接收时钟相位无关。\n\n如果在单个接收时钟沿期间，一个同步器捕获了其比特的“旧”值，而另一个同步器捕获了其比特的“新”值，从而产生一个混合的两位代码，该代码等于一个有效但非预期的二进制状态，并因此被下游逻辑在一个接收周期内误解，则称接收域内发生了译码错误。假设同步器中的亚稳态在一个周期内得到解决，因此唯一考虑的错误机制是当两个比特都发生转换时，由重收敛的混合状态引起的误译码。\n\n设在二进制编码中，涉及两个比特同时翻转的状态转换比例为 $\\alpha$。对于参数 $T_{r} = 5\\,\\text{ns}$，$S_{\\max} = 0.45\\,\\text{ns}$ 和 $\\alpha = 0.30$，计算每个源域状态转换的平均译码错误概率。将最终的数值概率四舍五入到四位有效数字。\n\n最后，从格雷码的定义特性（相邻状态之间只有一个比特发生变化）出发，解释如果状态总线采用格雷码编码并且只允许相邻的格雷码转换，为什么这种特定的混合代码误译码错误模式会被消除。你必须通过直接从所述的随机采样模型和单位比特变化特性进行推理来证明这种消除，而不能使用任何捷径公式。",
            "solution": "按照要求，解答分为两部分：首先，计算译码错误概率；其次，关于格雷码的概念性解释。\n\n### 第1部分：平均错误概率的计算\n\n每个源域状态转换的平均译码错误概率，记为 $P_{\\text{error}}$，是两个概率的乘积：\n1. 状态转换涉及两个比特同时翻转的概率。\n2. 在两个比特都翻转的情况下，发生译码错误的条件概率。\n\n问题陈述，涉及两个比特同时翻转的状态转换比例为 $\\alpha$。因此，\n$$P(\\text{2-bit transition}) = \\alpha$$\n根据定义，译码错误只可能在这样的2比特转换期间发生。我们的任务简化为求条件概率 $P(\\text{error} | \\text{2-bit transition})$，然后计算总概率为 $P_{\\text{error}} = \\alpha \\times P(\\text{error} | \\text{2-bit transition})$。\n\n让我们分析译码错误的条件。当接收时钟的采样沿到达第一个比特转换和第二个比特转换之间的时间间隔内时，就会发生错误。这个时间间隔是“危险窗口”。在这个窗口期间，一个比特具有其“新”值，而另一个比特仍保持其“旧”值。\n\n设此危险窗口的持续时间由偏斜 $S$ 定义。偏斜 $S$ 是两个转换比特到达时间的差异大小。问题指定 $S$ 是一个随机变量，在区间 $[0, S_{\\max}]$ 上均匀分布。$S$ 的概率密度函数 (PDF) 为：\n$$f_S(s) = \\begin{cases} \\frac{1}{S_{\\max}} & \\text{for } 0 \\le s \\le S_{\\max} \\\\ 0 & \\text{otherwise} \\end{cases}$$\n问题还指出，数据转换相对于接收时钟沿的相位偏移在 $[0, T_r)$ 上均匀分布。这等同于说，对于一个信号变化的数据库，随机采样时钟沿落在任何持续时间为 $\\Delta t$ 的特定时间间隔内的概率为 $\\frac{\\Delta t}{T_r}$，前提是 $\\Delta t \\ll T_r$。\n\n对于一个具有给定偏斜值 $s$ 的2比特转换的具体实例，危险窗口的持续时间是 $s$。采样时钟沿落入此窗口内的概率为：\n$$P(\\text{error} | S=s) = \\frac{s}{T_r}$$\n这是有效的，因为问题指定了 $S_{\\max} \\ll T_r$，这意味着对于所有可能的 $s$ 值，都有 $s \\ll T_r$。\n\n为了找到在给定2比特转换下的平均错误概率，我们必须对偏斜 $S$ 的所有可能值对该条件概率进行平均，并按 $S$ 的概率密度函数加权。这可以通过计算 $P(\\text{error} | S)$ 的期望值来得出。\n$$P(\\text{error} | \\text{2-bit transition}) = E[P(\\text{error} | S)] = E\\left[\\frac{S}{T_r}\\right] = \\frac{1}{T_r} E[S]$$\n在 $[0, S_{\\max}]$ 上均匀分布的随机变量 $S$ 的期望值为：\n$$E[S] = \\int_{-\\infty}^{\\infty} s f_S(s) ds = \\int_{0}^{S_{\\max}} s \\left(\\frac{1}{S_{\\max}}\\right) ds = \\frac{1}{S_{\\max}} \\left[ \\frac{s^2}{2} \\right]_0^{S_{\\max}} = \\frac{1}{S_{\\max}} \\left( \\frac{S_{\\max}^2}{2} - 0 \\right) = \\frac{S_{\\max}}{2}$$\n将此结果代回，我们得到条件错误概率：\n$$P(\\text{error} | \\text{2-bit transition}) = \\frac{1}{T_r} \\left( \\frac{S_{\\max}}{2} \\right) = \\frac{S_{\\max}}{2T_r}$$\n最后，每个源域状态转换的平均译码错误概率为：\n$$P_{\\text{error}} = \\alpha \\times P(\\text{error} | \\text{2-bit transition}) = \\alpha \\frac{S_{\\max}}{2T_r}$$\n给定的数值为：$T_r = 5\\,\\text{ns}$，$S_{\\max} = 0.45\\,\\text{ns}$ 和 $\\alpha = 0.30$。将这些值代入表达式：\n$$P_{\\text{error}} = 0.30 \\times \\frac{0.45\\,\\text{ns}}{2 \\times 5\\,\\text{ns}} = 0.30 \\times \\frac{0.45}{10} = 0.30 \\times 0.045 = 0.0135$$\n问题要求答案四舍五入到四位有效数字。\n$$P_{\\text{error}} = 0.01350$$\n\n### 第2部分：格雷码的合理解释\n\n问题要求解释为什么如果状态总线采用格雷码编码并且只允许相邻状态转换，指定的错误模式会被消除。该解释必须基于第一性原理。\n\n1. **错误模式的定义**：该错误被定义为“混合代码误译码”。当对于多比特总线，接收同步器在其间的偏斜间隔内对这些比特进行采样时，就会发生这种情况。这导致捕获的状态向量由“旧”和“新”比特值的混合组成，而这种混合恰好形成了一个有效但非预期的状态。这种错误的必要前提条件是在状态转换期间*至少有两个比特必须改变其值*。\n\n2. **格雷码的定义特性**：格雷码的基本特性是序列中任何两个相邻码字仅相差一个比特。问题将系统限制为只允许“相邻的格雷码转换”。\n\n3. **转换分析**：考虑在格雷码总线上从状态 $A$ 到相邻状态 $B$ 的状态转换。设状态由一个比特向量表示。由于格雷码的特性，状态 $A$ 和状态 $B$ 的值仅在一位上不同。假设比特 $k$ 是变化的那个，而所有其他比特 $i \\neq k$ 保持不变。\n\n4. **恒定比特的采样**：对于任何比特 $i \\neq k$，其值是稳定的，在转换期间不会改变。这些比特中每一个的同步器都接收一个恒定的输入。因此，无论接收时钟沿的定时如何，它都将正确无误地采样其对应比特的恒定值。\n\n5. **变化比特的采样**：正在变化的单个比特 $k$ 将从其旧值 $B_k^{\\text{old}}$ 转换到其新值 $B_k^{\\text{new}}$。比特 $k$ 的同步器将在某个时间点对数据线进行采样。根据采样时钟沿是在比特 $k$ 转换之前还是之后到达，同步器将捕获 $B_k^{\\text{old}}$ 或 $B_k^{\\text{new}}$。（在问题的简化假设下，我们忽略了其进入亚稳态且无法解决的情况）。\n\n6. **最终的采样状态**：综合这些结果，接收域逻辑捕获的完整状态向量只有两种可能性：\n    - 所有比特都以其旧值被捕获（如果比特 $k$ 在其转换前被捕获）。这重建了原始状态 $A$。\n    - 所有稳定比特都以其恒定值被捕获，而单个变化的比特 $k$ 以其新值被捕获。这重建了最终状态 $B$。\n\n7. **错误的消除**：由于接收逻辑唯一可能采样的状态是正确的初始状态 ($A$) 或正确的最终状态 ($B$)，因此在结构上不可能形成任何其他状态。“混合代码误译码”错误，其定义是创建一个有效但*非预期*的状态，不可能发生。比特间偏斜“危险窗口”的概念不适用，因为只有一个比特在变化；没有多个并发的转换，偏斜可以在其间表现出来。因此，对相邻状态转换使用格雷码，其本质上就完全消除了这种特定的错误机制。",
            "answer": "$$\n\\boxed{0.01350}\n$$"
        }
    ]
}