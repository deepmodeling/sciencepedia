{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导您对最常见的跨时钟域（CDC）结构——双触发器同步器——进行基础分析。通过推导亚稳态的可用恢复时间（metastability resolution time）和最终的平均无故障时间（MTBF），您将深刻理解时序参数如何直接影响同步器的可靠性。这是评估CDC电路稳健性的基石性计算。",
            "id": "4259927",
            "problem": "一个两级触发器同步器用于将一个异步二进制信号传输到集成电路的目标时钟域中，该集成电路是根据电子设计自动化（EDA）的方法设计的。该同步器由两个串联的上升沿触发的D触发器组成，两者均由目标时钟驱动。第一级（$\\text{FF1}$）对异步输入进行采样，第二级（$\\text{FF2}$）在一个目标时钟周期后对$\\text{FF1}$的输出进行采样。设目标时钟周期为 $T_{clk}$。设$\\text{FF1}$和$\\text{FF2}$处的时钟到达时间相差一个时钟偏斜 $skew$，$skew$ 定义为$\\text{FF2}$处的时钟相对于$\\text{FF1}$处时钟提前的时间；一个正的 $skew$ 会减少两次采样事件之间的可用时间。第一级的时钟到Q输出延迟为 $t_{cq1}$，第二级的建立时间要求为 $t_{setup2}$。\n\n根据双稳态电路的标准亚稳态模型，一旦采样事件将第一级锁存器驱动到亚稳态，该亚稳态持续时间超过 $t$ 的概率会以特征时间常数 $\\tau>0$ 近似指数衰减，并且一个与器件和工艺相关的参数 $T_0>0$ 捕捉了易受攻击的时序窗口的有效宽度和锁存器的增益因子。假设异步输入的平均转换率等于目标时钟频率，并且每个目标时钟周期都进行采样，即输入转换率和采样率均等于 $1/T_{clk}$。\n\n仅从这些定义、假设以及亚稳态解析时间随时间常数 $\\tau$ 指数衰减的行为出发，完成以下任务：\n\n1. 推导在$\\text{FF1}$的采样沿和$\\text{FF2}$的下一个采样沿之间可用的亚稳态解析时间 $T_{res}$，用 $T_{clk}$、$t_{cq1}$、$t_{setup2}$ 和 $skew$ 表示。根据时序要求和因果关系，清楚地解释你表达式中的每一项。\n\n2. 使用指数解析模型以及给定的事件率和采样率，推导这个两级触发器同步器的平均无故障时间（MTBF）的闭式解析表达式（以秒为单位），该表达式是 $T_{clk}$、$t_{cq1}$、$t_{setup2}$、$skew$、$\\tau$ 和 $T_{0}$ 的函数。将最终的MTBF表示为单个以秒为单位的闭式表达式。不需要进行数值计算；也不需要四舍五入。",
            "solution": "目标是推导可用的亚稳态解析时间，然后使用一个广为支持的亚稳态解析随机模型，推导失效率和平均无故障时间（MTBF）。\n\n我们从目标时钟域中两级同步器的时序结构开始。这两个触发器由目标时钟驱动。设时钟周期为 $T_{clk}$，并设第二个触发器$\\text{FF2}$处的时钟到达时间相对于第一个触发器$\\text{FF1}$处的到达时间提前了 $skew$。因此，一个正的 $skew$ 会将$\\text{FF1}$和$\\text{FF2}$采样沿之间的时间从 $T_{clk}$ 减少到 $T_{clk}-skew$。\n\n第一个触发器$\\text{FF1}$在一个上升沿对异步输入进行采样。如果该采样违反了孔径时序（即输入信号在采样瞬间附近到达），$\\text{FF1}$可能会进入亚稳态，并需要经过一段随机的解析时间后才能稳定下来。$\\text{FF1}$的输出（$Q_1$）能够变为有效并开始向$\\text{FF2}$传播的最早时间是$\\text{FF1}$处的时钟沿时间加上时钟到Q输出延迟 $t_{cq1}$，再加上状态移动到足够接近稳定电平所需的随机额外时间。为确保正确捕获，$\\text{FF2}$的输入必须在$\\text{FF2}$的采样沿之前保持稳定 $t_{setup2}$ 的时间。因此，$\\text{FF1}$处亚稳态的可用解析时间必须在 $(\\text{FF2 时钟沿}) - t_{setup2}$ 这一时刻之前完成。\n\n让我们按如下方式同步相关时钟沿：在时间 $t=0$ 时，$\\text{FF1}$处发生一个采样事件。$\\text{FF2}$处的下一个采样沿发生在时间 $t=T_{clk}-skew$（因为假设存在正的 $skew$ 导致$\\text{FF2}$时钟提前）。为了正确捕获，$Q_1$必须在该$\\text{FF2}$时钟沿之前至少 $t_{setup2}$ 的时间稳定下来并到达$\\text{FF2}$的输入端。此外，$Q_1$在$\\text{FF1}$时钟沿之后的确定性延迟 $t_{cq1}$ 过去之前不会开始变化。这些时序要求得出的从$\\text{FF1}$采样瞬间到允许到达$\\text{FF2}$输入端的最晚时刻之间的可用解析时间为\n$$\nT_{res} \\;=\\; (\\text{从}\\text{FF1}\\text{沿到}\\text{FF2}\\text{沿的时间}) \\;-\\; t_{cq1} \\;-\\; t_{setup2} \\;=\\; T_{clk} - skew - t_{cq1} - t_{setup2}.\n$$\n该表达式从标称的一个周期间隔 $T_{clk}$ 中减去了确定性的时间预算 $t_{cq1}$ 和 $t_{setup2}$ 以及时钟沿间距的有效减少量 $skew$，剩下的时间间隔可用于$\\text{FF1}$中的亚稳态解析，从而使得$\\text{FF2}$能采样到有效电平。\n\n接下来我们转向亚稳态解析的统计特性。对于一个因在采样沿附近到达的违规输入而被驱动进入亚稳态的双稳态元件，其解析到足够接近稳定电平所需时间的分布，在经过一个小的偏移量后，服从指数尾部分布。一个广泛使用的形式将解析时间超过 $t$ 的概率建模为与 $\\exp(-t/\\tau)$ 成正比，其中 $\\tau$ 是锁存器的时间常数。比例常数不是一个纯粹的概率，而是在失效率计算中以一个具有时间单位的因子的形式出现，通常表示为 $T_{0}$，它包含了易受攻击窗口的有效宽度和与增益相关的参数。当将这种衰减与独立的输入转换事件和独立的采样事件相结合时，单位时间的失效率被建模为 (i) 相对于采样沿发生违规到达的机会率与 (ii) 由此产生的亚稳态持续时间超过可用解析时间的概率的乘积：\n$$\n\\lambda \\;=\\; f_{\\text{clk}} \\, f_{\\text{data}} \\, T_{0} \\, \\exp\\!\\left(-\\frac{T_{res}}{\\tau}\\right),\n$$\n其中 $f_{\\text{clk}}$ 是目标采样率，$f_{\\text{data}}$ 是进入同步器的平均输入转换率。根据所述假设，这两个速率都等于目标时钟频率：$f_{\\text{clk}}=f_{\\text{data}}=\\frac{1}{T_{clk}}$。将这些值和我们推导出的 $T_{res}$ 代入，得到\n$$\n\\lambda \\;=\\; \\left(\\frac{1}{T_{clk}}\\right)\\left(\\frac{1}{T_{clk}}\\right) T_{0} \\, \\exp\\!\\left(-\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right)\n\\;=\\; \\frac{T_{0}}{T_{clk}^{2}} \\, \\exp\\!\\left(-\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right).\n$$\n平均无故障时间（MTBF）是失效率的倒数，\n$$\n\\text{MTBF} \\;=\\; \\frac{1}{\\lambda} \\;=\\; \\frac{T_{clk}^{2}}{T_{0}} \\, \\exp\\!\\left(\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right),\n$$\n其单位为秒，因为 $T_{clk}^{2}/T_{0}$ 具有时间的量纲，而指数项是无量纲的。\n\n总之，推导出的可用解析时间为\n$$\nT_{res} \\;=\\; T_{clk} - t_{cq1} - t_{setup2} - skew,\n$$\n并且，在给定的速率和亚稳态模型下，以秒为单位的MTBF为\n$$\n\\text{MTBF} \\;=\\; \\frac{T_{clk}^{2}}{T_{0}} \\, \\exp\\!\\left(\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right).\n$$",
            "answer": "$$\\boxed{\\frac{T_{clk}^{2}}{T_{0}} \\exp\\!\\left(\\frac{T_{clk}-t_{cq1}-t_{setup2}-skew}{\\tau}\\right)}$$"
        },
        {
            "introduction": "从分析转向设计，本练习将探讨一个核心的工程权衡问题。增加同步器链的级数可以指数级地提升其可靠性，但每一级也会增加延迟，从而影响系统性能。这个问题将挑战您寻找最优的级数，以同时满足严格的可靠性（MTBF）和延迟要求，这是高性能芯片设计中的一项常见任务。",
            "id": "4259950",
            "problem": "一个数字片上系统必须使用级联的相同边沿触发触发器作为同步器，将一个单比特控制信号从异步源域安全地传输到目的域。目的域以频率 $f_{\\text{clk}}$（周期为 $T_{\\text{clk}}$）进行采样。每增加一级触发器，会增加一个目的时钟周期的端到端延迟。源比特以平均频率 $f_{\\text{data}}$ 独立翻转，这会产生潜在的异步采样风险。\n\n触发器中的亚稳态被建模为一个指数衰减的解析过程：亚稳态在时间 $t$ 前未能解析的概率与 $\\exp(-t/\\tau)$ 成正比衰减，其中 $\\tau$ 是器件的亚稳态时间常数。存在一个与技术相关的有效时间偏移 $T_{0}$，它捕捉了易受攻击窗口的宽度及相关的内部参数，使得当亚稳态的持续时间超过可用解析时间 $T_{\\text{res}}$ 时，就会发生故障。在任何一次采样尝试中都可能发生故障，并且在独立性假设下，采样尝试的发生率与 $f_{\\text{clk}} f_{\\text{data}}$ 的乘积成正比。总平均无故障时间 (MTBF) 随可用解析时间 $T_{\\text{res}}$ 指数级增加，并随尝试率线性减少。\n\n可用解析时间随同步器级数 $N$ 的变化关系为 $T_{\\text{res}} = N T_{\\text{clk}} - T_{\\text{guard}}$，其中 $T_{\\text{guard}}$ 是一个固定的时序裕量，它将建立时间要求、级间时钟到Q端的延迟和时钟偏斜效应合并为一个保守的裕量。假设 $T_{\\text{guard}}$ 与 $N$ 无关。\n\n给定系统和器件参数\n- 目的时钟频率 $f_{\\text{clk}} = 1.0 \\times 10^{9} \\, \\text{s}^{-1}$ (因此 $T_{\\text{clk}} = 1.0 \\times 10^{-9} \\, \\text{s}$),\n- 源翻转频率 $f_{\\text{data}} = 2.0 \\times 10^{8} \\, \\text{s}^{-1}$,\n- 亚稳态时间常数 $\\tau = 30 \\times 10^{-12} \\, \\text{s}$,\n- 有效时间偏移 $T_{0} = 20 \\times 10^{-12} \\, \\text{s}$,\n- 时序裕量 $T_{\\text{guard}} = 150 \\times 10^{-12} \\, \\text{s}$,\n- 目标平均无故障时间 $\\mathrm{MTBF}_{\\text{target}} = 10 \\, \\text{年}$ (使用 $1 \\, \\text{年} = 3.1536 \\times 10^{7} \\, \\text{s}$),\n- 最大允许端到端延迟 $L_{\\max} = 2$ 个目的时钟周期,\n\n请从第一性原理推导出 MTBF 作为 $T_{\\text{res}}$ 函数的解析表达式，并用它来确定能同时满足 $\\mathrm{MTBF} \\ge \\mathrm{MTBF}_{\\text{target}}$ 和延迟约束 $N \\le L_{\\max}$ 的同步器最小整数级数 $N$。将最终答案表示为不带单位的整数 $N$。除了选择精确整数外，无需进行其他舍入。",
            "solution": "在尝试求解之前，对问题陈述的有效性进行评估。\n\n### 步骤 1：提取已知条件\n-   目的时钟频率：$f_{\\text{clk}} = 1.0 \\times 10^{9} \\, \\text{s}^{-1}$\n-   目的时钟周期：$T_{\\text{clk}} = 1.0 \\times 10^{-9} \\, \\text{s}$\n-   源翻转频率：$f_{\\text{data}} = 2.0 \\times 10^{8} \\, \\text{s}^{-1}$\n-   亚稳态时间常数：$\\tau = 30 \\times 10^{-12} \\, \\text{s}$\n-   有效时间偏移：$T_{0} = 20 \\times 10^{-12} \\, \\text{s}$\n-   时序裕量：$T_{\\text{guard}} = 150 \\times 10^{-12} \\, \\text{s}$\n-   目标平均无故障时间：$\\mathrm{MTBF}_{\\text{target}} = 10 \\, \\text{年}$\n-   年份转换：$1 \\, \\text{年} = 3.1536 \\times 10^{7} \\, \\text{s}$\n-   最大允许端到端延迟：$L_{\\max} = 2$ 个目的时钟周期\n-   可用解析时间的关系式：$T_{\\text{res}} = N T_{\\text{clk}} - T_{\\text{guard}}$，其中 $N$ 是同步器的级数。\n-   延迟约束：级数 $N$ 代表以时钟周期为单位的端到端延迟，因此 $N \\le L_{\\max}$。\n\n### 步骤 2：使用提取的已知条件进行验证\n基于提取的信息对问题进行严格审查。\n\n-   **科学依据**：该问题描述了一个涉及亚稳态的典型同步器设计场景。MTBF 模型（其指数依赖于解析时间，反比于时钟和数据频率）是数字集成电路设计中一个标准且成熟的模型（例如，Dally 和 Poulton 模型）。所提供的物理参数（$f_{\\text{clk}}$, $\\tau$ 等）在现代半导体技术的实际范围内。\n-   **适定性**：该问题要求一个单一、特定的值：最小整数级数 $N$。它提供了一套完整的参数和两个清晰、可量化的约束（$\\mathrm{MTBF} \\ge \\mathrm{MTBF}_{\\text{target}}$ 和 $N \\le L_{\\max}$）来确定这个唯一的整数值。\n-   **客观性**：该问题使用 VLSI 设计领域常见的精确技术语言进行陈述。它没有歧义、主观性或个人观点。\n-   **一致性**：给定的条件是自洽的。$f_{\\text{clk}}$ 和 $T_{\\text{clk}}$ 之间的关系陈述正确。这些约束不是相互排斥的，并定义了一个可解的优化问题（寻找最小整数 $N$）。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**，因为它有科学依据、适定、客观且内部一致。将推导解答。\n\n### 解答推导\n该问题要求根据提示从第一性原理推导平均无故障时间（MTBF）的表达式。\n\n故障率 $R_{\\text{fail}}$ 是系统进入亚稳态的速率与该状态持续足够长以致引起故障的概率的乘积。\n\n$1.$ 在第一个触发器的易受攻击时序窗口内采样异步数据跳变的速率与时钟频率、数据翻转频率以及该窗口的宽度成正比。问题提供了一个有效参数 $T_0$，它“捕捉了易受攻击窗口的宽度”。因此，进入亚稳态的速率可以表示为：\n$$ R_{\\text{enter-meta}} = T_{0} f_{\\text{clk}} f_{\\text{data}} $$\n\n$2.$ 一旦进入亚稳态，其在可用时间 $t$ 内未能解析的概率与 $\\exp(-t/\\tau)$ 成正比。如果状态持续时间超过可用解析时间 $T_{\\text{res}}$，则发生故障。问题陈述暗示，在使用参数 $T_0$ 时，比例常数为1。因此，在亚稳态事件已发生的情况下，故障的概率为：\n$$ P(\\text{failure} | \\text{meta}) = \\exp(-T_{\\text{res}}/\\tau) $$\n\n$3.$ 总故障率是这两个量的乘积：\n$$ R_{\\text{fail}} = R_{\\text{enter-meta}} \\times P(\\text{failure} | \\text{meta}) = \\left( T_{0} f_{\\text{clk}} f_{\\text{data}} \\right) \\exp(-T_{\\text{res}}/\\tau) $$\n\n$4.$ MTBF 是故障率的倒数。这就得出了所要求的 MTBF 作为 $T_{\\text{res}}$ 函数的解析表达式：\n$$ \\mathrm{MTBF}(T_{\\text{res}}) = \\frac{1}{R_{\\text{fail}}} = \\frac{\\exp(T_{\\text{res}}/\\tau)}{T_{0} f_{\\text{clk}} f_{\\text{data}}} $$\n\n接下来，我们代入给定的解析时间表达式 $T_{\\text{res}} = N T_{\\text{clk}} - T_{\\text{guard}}$，以将 MTBF 表示为级数 $N$ 的函数：\n$$ \\mathrm{MTBF}(N) = \\frac{\\exp((N T_{\\text{clk}} - T_{\\text{guard}})/\\tau)}{T_{0} f_{\\text{clk}} f_{\\text{data}}} $$\n\n问题要求找到满足两个条件的最小整数 $N$：\n$1.$ $\\mathrm{MTBF}(N) \\ge \\mathrm{MTBF}_{\\text{target}}$\n$2.$ $N \\le L_{\\max}$\n\n我们可以从第一个条件求解最小的 $N$。我们重新整理不等式以分离出 $N$：\n$$ \\frac{\\exp((N T_{\\text{clk}} - T_{\\text{guard}})/\\tau)}{T_{0} f_{\\text{clk}} f_{\\text{data}}} \\ge \\mathrm{MTBF}_{\\text{target}} $$\n对两边取自然对数：\n$$ \\frac{N T_{\\text{clk}} - T_{\\text{guard}}}{\\tau} \\ge \\ln(\\mathrm{MTBF}_{\\text{target}} \\cdot T_{0} \\cdot f_{\\text{clk}} \\cdot f_{\\text{data}}) $$\n$$ N T_{\\text{clk}} - T_{\\text{guard}} \\ge \\tau \\ln(\\mathrm{MTBF}_{\\text{target}} \\cdot T_{0} \\cdot f_{\\text{clk}} \\cdot f_{\\text{data}}) $$\n$$ N \\ge \\frac{T_{\\text{guard}} + \\tau \\ln(\\mathrm{MTBF}_{\\text{target}} \\cdot T_{0} \\cdot f_{\\text{clk}} \\cdot f_{\\text{data}})}{T_{\\text{clk}}} $$\n\n现在，我们将给定的数值代入此不等式。\n首先，将 $\\mathrm{MTBF}_{\\text{target}}$ 转换为秒：\n$$ \\mathrm{MTBF}_{\\text{target}} = 10 \\, \\text{年} \\times 3.1536 \\times 10^{7} \\, \\frac{\\text{s}}{\\text{年}} = 3.1536 \\times 10^{8} \\, \\text{s} $$\n接下来，计算对数的参数：\n$$ C = \\mathrm{MTBF}_{\\text{target}} \\cdot T_{0} \\cdot f_{\\text{clk}} \\cdot f_{\\text{data}} $$\n$$ C = (3.1536 \\times 10^{8} \\, \\text{s}) \\cdot (20 \\times 10^{-12} \\, \\text{s}) \\cdot (1.0 \\times 10^{9} \\, \\text{s}^{-1}) \\cdot (2.0 \\times 10^{8} \\, \\text{s}^{-1}) $$\n$$ C = (3.1536 \\times 10^{8}) \\cdot (20 \\times 10^{-12}) \\cdot (2.0 \\times 10^{17}) = 3.1536 \\cdot 20 \\cdot 2.0 \\times 10^{(8-12+17)} $$\n$$ C = 126.144 \\times 10^{13} = 1.26144 \\times 10^{15} $$\n该值是无量纲的，符合预期。\n\n现在，计算自然对数：\n$$ \\ln(C) = \\ln(1.26144 \\times 10^{15}) \\approx 34.770976 $$\n\n将此结果代回关于 $N$ 的不等式中：\n$$ N \\ge \\frac{(150 \\times 10^{-12} \\, \\text{s}) + (30 \\times 10^{-12} \\, \\text{s}) \\cdot (34.770976)}{1.0 \\times 10^{-9} \\, \\text{s}} $$\n$$ N \\ge \\frac{150 \\times 10^{-12} + 1043.12928 \\times 10^{-12}}{1.0 \\times 10^{-9}} $$\n$$ N \\ge \\frac{1193.12928 \\times 10^{-12}}{1.0 \\times 10^{-9}} $$\n$$ N \\ge 1.19312928 $$\n\n由于 $N$ 必须是整数，满足 MTBF 要求的最小整数值 $N$ 是 $N=2$。\n\n最后，我们必须根据延迟约束 $N \\le L_{\\max}$ 来检查此结果。\n给定的最大延迟是 $L_{\\max}=2$ 个时钟周期。\n我们计算出的值 $N=2$ 满足此约束：$2 \\le 2$。\n\n$N$ 的可能整数值受限于 $N \\ge 1$（同步器必须至少有一级）和 $N \\le L_{\\max}=2$。因此，我们只需要检查 $N=1$ 和 $N=2$。\n对于 $N=1$，不等式 $1 \\ge 1.193...$ 不成立，因此单级同步器是不够的。\n对于 $N=2$，不等式 $2 \\ge 1.193...$ 成立，因此两级同步器是足够的。\n\n因此，同时满足 MTBF 目标和延迟约束的最小整数级数是 $2$。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "同步单个比特信号是一个挑战，而确保多比特数据总线能够一致地传输则是另一个层面的难题。本练习将探讨数据总线同步的问题，其中比特间的时序偏斜（skew）可能导致接收端采样到一个无效的瞬态。您将量化这种错误发生的概率，并从第一性原理出发，理解为何使用格雷码（Gray code）是解决这一关键系统级问题的有效结构性方案。",
            "id": "4259963",
            "problem": "一个数字系统采用从源时钟域到接收时钟域的时钟域交叉。源时钟域驱动一个两位状态总线，该总线以二进制编码表示状态 $\\{00,01,10,11\\}$。接收域使用两个独立的、每个位一个的两级触发器同步器来采样该总线。接收域时钟的周期为 $T_{r}$，任何数据转换相对于给定接收时钟边沿的相位偏移被建模为在 $[0,T_{r})$ 上均匀分布。总线上的所有转换均由源域逻辑驱动，在特定状态之间转换时，该逻辑名义上使两位在同一源时钟边沿发生变化；然而，由于路径差异，两位转换到达第一级同步器输入端的时间相差一个随机偏斜 $S$，其幅值在 $[0,S_{\\max}]$ 上均匀分布。假设 $S_{\\max} \\ll T_{r}$ 且 $S$ 与接收时钟相位无关。\n\n如果在单个接收时钟边沿期间，一个同步器捕获了其位的“旧”值，而另一个同步器捕获了其位的“新”值，从而产生一个等于有效但非预期二进制状态的混合两位代码，并因此被下游逻辑在一个接收周期内误解，则称接收域内发生了解码错误。将同步器中的亚稳态视为在一个周期内解决，因此所考虑的唯一错误机制是当两位同时转换时，由重构的混合状态引起的误解码。\n\n设在二进制编码中，涉及两位同时翻转的状态转换比例为 $\\alpha$。对于参数 $T_{r} = 5\\,\\text{ns}$、$S_{\\max} = 0.45\\,\\text{ns}$ 和 $\\alpha = 0.30$，计算每个源域状态转换的平均解码错误概率。将最终的数值概率四舍五入到四位有效数字。\n\n最后，从格雷码的定义属性（相邻状态之间只有一位发生变化）出发，解释如果状态总线采用格雷码并且只允许相邻的格雷码转换，为什么这种特定的混合代码误解码错误模式会被消除。您必须通过直接从所述的随机采样模型和单位变化属性进行推理来证明这种消除，而不能使用任何快捷公式。",
            "solution": "所述问题具有科学依据，提法恰当，客观，并包含足够信息以得出唯一解。它基于数字逻辑设计的既定原则，特别是时钟域交叉同步。该概率模型是分析此类系统时使用的标准且适当的简化方法。因此，该问题被认为是有效的。\n\n解答按要求分为两部分：首先，计算解码错误概率；其次，关于格雷码的概念性解释。\n\n### 第一部分：平均错误概率的计算\n\n每个源域状态转换的平均解码错误概率，记为 $P_{\\text{error}}$，是两个概率的乘积：\n$1$. 状态转换涉及两位同时翻转的概率。\n$2$. 在两位都翻转的条件下，发生解码错误的条件概率。\n\n问题指出，涉及两位同时翻转的状态转换比例为 $\\alpha$。因此，\n$$P(\\text{2-bit transition}) = \\alpha$$\n根据定义，解码错误只能在这种两位转换期间发生。我们的任务简化为找到条件概率 $P(\\text{error} | \\text{2-bit transition})$，然后计算总概率为 $P_{\\text{error}} = \\alpha \\times P(\\text{error} | \\text{2-bit transition})$。\n\n让我们分析解码错误的条件。当接收时钟的采样边沿到达第一个位转换和第二个位转换之间的时间间隔内时，就会发生错误。这个间隔就是“危险窗口”。在这个窗口期间，一个位具有其“新”值，而另一个位仍具有其“旧”值。\n\n设此危险窗口的持续时间由偏斜 $S$ 定义。偏斜 $S$ 是两个转换位到达时间差异的幅值。问题指定 $S$ 是一个随机变量，在区间 $[0, S_{\\max}]$ 上均匀分布。$S$ 的概率密度函数 (PDF) 是：\n$$f_S(s) = \\begin{cases} \\frac{1}{S_{\\max}},  \\text{for } 0 \\le s \\le S_{\\max} \\\\ 0,  \\text{其他情况下} \\end{cases}$$\n问题还指出，数据转换相对于接收时钟边沿的相位偏移在 $[0, T_r)$ 上均匀分布。这等同于说，对于一个信号变化的数据库，一个随机采样时钟边沿落在任何持续时间为 $\\Delta t$ 的特定时间间隔内的概率由 $\\frac{\\Delta t}{T_r}$ 给出，前提是 $\\Delta t \\ll T_r$。\n\n对于一个具有给定偏斜值 $s$ 的两位转换的具体实例，危险窗口的持续时间是 $s$。采样时钟边沿落入此窗口的概率是：\n$$P(\\text{error} | S=s) = \\frac{s}{T_r}$$\n这是有效的，因为问题指定了 $S_{\\max} \\ll T_r$，这意味着对于 $s$ 的所有可能值，都有 $s \\ll T_r$。\n\n为了在给定两位转换的情况下找到平均错误概率，我们必须对这个条件概率在偏斜 $S$ 的所有可能值上进行平均，并按 $S$ 的概率密度函数进行加权。这可以通过计算 $P(\\text{error} | S)$ 的期望值来得出。\n$$P(\\text{error} | \\text{2-bit transition}) = E[P(\\text{error} | S)] = E\\left[\\frac{S}{T_r}\\right] = \\frac{1}{T_r} E[S]$$\n在 $[0, S_{\\max}]$ 上均匀分布的随机变量 $S$ 的期望值是：\n$$E[S] = \\int_{-\\infty}^{\\infty} s f_S(s) ds = \\int_{0}^{S_{\\max}} s \\left(\\frac{1}{S_{\\max}}\\right) ds = \\frac{1}{S_{\\max}} \\left[ \\frac{s^2}{2} \\right]_0^{S_{\\max}} = \\frac{1}{S_{\\max}} \\left( \\frac{S_{\\max}^2}{2} - 0 \\right) = \\frac{S_{\\max}}{2}$$\n将此结果代回，我们得到条件错误概率：\n$$P(\\text{error} | \\text{2-bit transition}) = \\frac{1}{T_r} \\left( \\frac{S_{\\max}}{2} \\right) = \\frac{S_{\\max}}{2T_r}$$\n最后，每个源域状态转换的平均解码错误概率是：\n$$P_{\\text{error}} = \\alpha \\times P(\\text{error} | \\text{2-bit transition}) = \\alpha \\frac{S_{\\max}}{2T_r}$$\n给定的数值为：$T_r = 5\\,\\text{ns}$、$S_{\\max} = 0.45\\,\\text{ns}$ 和 $\\alpha = 0.30$。将这些值代入表达式中：\n$$P_{\\text{error}} = 0.30 \\times \\frac{0.45\\,\\text{ns}}{2 \\times 5\\,\\text{ns}} = 0.30 \\times \\frac{0.45}{10} = 0.30 \\times 0.045 = 0.0135$$\n问题要求答案四舍五入到四位有效数字。\n$$P_{\\text{error}} = 0.01350$$\n\n### 第二部分：关于格雷码的证明\n\n问题要求解释，如果状态总线采用格雷码并且只允许相邻状态转换，为什么指定的错误模式会被消除。该证明必须基于第一性原理。\n\n$1$. **错误模式的定义**：该错误被定义为“混合代码误解码”。当对于一个多位总线，接收同步器在其位间偏斜的时间间隔内采样时，就会发生这种情况。这导致捕获的状态向量由“旧”和“新”位值的混合组成，而这个混合恰好形成了一个有效但非预期的状态。这种错误的必要前提是，在状态转换期间*至少有两位的值必须改变*。\n\n$2$. **格雷码的定义属性**：格雷码的基本属性是序列中任意两个相邻的代码字仅相差一位。问题将系统限制为只允许“相邻的格雷码转换”。\n\n$3$. **转换分析**：考虑在格雷码总线上从状态 $A$ 到相邻状态 $B$ 的一次状态转换。设状态由一个位向量表示。由于格雷码的属性，状态 $A$ 和状态 $B$ 的值仅在一位上不同。假设位 $k$ 是发生变化的位，而所有其他位 $i \\neq k$ 保持不变。\n\n$4$. **恒定位的采样**：对于任何位 $i \\neq k$，其值在转换期间是稳定的，不会改变。这些位中每一个的同步器都接收一个恒定的输入。因此，无论接收时钟边沿的定时如何，它都将正确且明确地采样其对应位的恒定值。\n\n$5$. **变化位的采样**：正在变化的单位 $k$ 将从其旧值 $B_k^{\\text{old}}$ 转换到其新值 $B_k^{\\text{new}}$。位 $k$ 的同步器将在某个时刻对数据线进行采样。根据采样时钟边沿是在位 $k$ 转换之前还是之后到达，同步器将捕获 $B_k^{\\text{old}}$ 或 $B_k^{\\text{new}}$。（在问题的简化假设下，我们忽略它进入亚稳态且无法解决的情况）。\n\n$6$. **最终采样状态**：综合这些结果，接收域逻辑捕获的完整状态向量只有两种可能性：\n    - 所有位都以其旧值被捕获（如果位 $k$ 在其转换前被捕获）。这将重构原始状态 $A$。\n    - 所有稳定位都以其恒定值被捕获，而单一变化的位 $k$ 以其新值被捕获。这将重构最终状态 $B$。\n\n$7$. **错误的消除**：由于接收逻辑唯一可能采样的状态是正确的初始状态 ($A$) 或正确的最终状态 ($B$)，因此在结构上不可能形成任何其他状态。“混合代码误解码”错误，其定义是产生一个有效但*非预期*的状态，不可能发生。位间偏斜“危险窗口”的概念不适用，因为只有一个位在变化；不存在可以表现出偏斜的多个并发转换。因此，对相邻状态转换使用格雷码，其本质就完全消除了这种特定的错误机制。",
            "answer": "$$\n\\boxed{0.01350}\n$$"
        }
    ]
}