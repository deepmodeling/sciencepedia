{
    "hands_on_practices": [
        {
            "introduction": "Understanding a network's performance limits is crucial for designing efficient systems. The theoretical maximum throughput is often determined not by the raw capacity of its links, but by how specific communication patterns create congestion hotspots. This exercise guides you through a fundamental analysis of network saturation using the transpose traffic pattern on a mesh topology, allowing you to pinpoint the bottleneck links and calculate the network's critical injection rate from first principles.",
            "id": "4285091",
            "problem": "Consider a two-dimensional $k \\times k$ mesh Network-on-Chip (NoC), where each tile at coordinates $(i,j)$, with $i,j \\in \\{0,1,\\dots,k-1\\}$, contains a router. The mesh uses deterministic dimension-order $X$-$Y$ routing, and every physical link is bidirectional with an independent per-direction capacity of $b$ flits per cycle. Assume single-flit packets and uniform steady-state injection: each node injects at rate $\\lambda$ flits per cycle, destined according to the synthetic transpose traffic pattern, that is, a packet sourced at $(i,j)$ is destined to $(j,i)$. Self-traffic along the diagonal $(i=j)$ does not consume any links. Ignore finite buffering effects and assume ideal flow control so that throughput collapse is governed by the first directed link that reaches its capacity.\n\nUsing fundamental conservation of flow and path composition under dimension-order routing, and without invoking any pre-derived traffic formulas, do the following:\n\n1. Derive the offered load, in flits per cycle, on an arbitrary directed horizontal link between $(x,y)$ and $(x+1,y)$ and on an arbitrary directed vertical link between $(c,r)$ and $(c,r+1)$, as functions of $k$, $x$, $y$, $c$, $r$, and the injection rate $\\lambda$.\n\n2. From these expressions, determine the set of directed links that become saturated at the onset of throughput collapse under transpose traffic.\n\n3. Quantify the critical uniform injection rate $\\lambda^{\\star}$ (in flits per cycle per node) at which the first saturation occurs.\n\nExpress the final answer as a single closed-form expression for $\\lambda^{\\star}$ in terms of $k$ and $b$, in flits per cycle. No rounding is required. In your derivation, clearly identify the saturated links you found, but provide only $\\lambda^{\\star}$ as your final numeric expression.",
            "solution": "### Derivation\n\nThe problem requires a derivation of the offered load on network links under transpose traffic, identification of the bottleneck links, and calculation of the maximum sustainable injection rate. We proceed by analyzing the paths taken by packets.\n\nUnder deterministic $X$-$Y$ routing, a packet from a source node $S = (i_s, j_s)$ to a destination node $D = (i_d, j_d)$ first travels horizontally along row $j_s$ until it reaches column $i_d$, and then travels vertically along column $i_d$ to reach row $j_d$. The turn from horizontal to vertical movement occurs at node $(i_d, j_s)$.\n\nFor the specified transpose traffic pattern, the destination for a packet from $S=(i_s, j_s)$ is $D=(j_s, i_s)$. Therefore, the path is composed of a horizontal segment from $(i_s, j_s)$ to $(j_s, j_s)$, followed by a vertical segment from $(j_s, j_s)$ to $(j_s, i_s)$. Note that for diagonal nodes where $i_s=j_s$, the source and destination are the same, and the problem states this self-traffic consumes no links. We only consider $i_s \\neq j_s$.\n\n**1. Offered Load on Directed Links**\n\nWe are asked to derive the load for a rightward horizontal link and an upward vertical link.\n\n**Load on a horizontal link $(x,y) \\rightarrow (x+1,y)$:**\nLet $L_h(x,y \\rightarrow x+1,y)$ be the traffic load on the directed horizontal link from node $(x,y)$ to $(x+1,y)$. For a packet from source $(i_s, j_s)$ to traverse this link, its path must include this segment. According to $X$-$Y$ routing for a transpose destination $(j_s, i_s)$, this requires:\n- The packet must travel along row $y$, so $j_s = y$.\n- The horizontal travel must be rightward, which implies the destination column $j_s$ is to the right of the source column $i_s$. Thus, $i_s < j_s$.\n- The specific link from column $x$ to $x+1$ must be part of the horizontal path from column $i_s$ to $j_s$. This means $i_s \\le x < j_s$.\n\nCombining these conditions for a given link $(x,y) \\rightarrow (x+1,y)$: the contributing source nodes $(i_s, j_s)$ must satisfy $j_s = y$ and $i_s \\le x < y$.\nThe condition $x < y$ is a necessary prerequisite for the link to carry any transpose traffic. If $x \\ge y$, no source $(i_s, y)$ with $i_s < y$ can exist that also satisfies $i_s \\le x$, so the load is $0$.\nIf $x < y$, the contributing sources are the set of nodes $\\{(i_s, y) | 0 \\le i_s \\le x\\}$. The number of such source nodes is $x+1$.\nSince each node injects at a rate of $\\lambda$ flits per cycle, the total load on this link is the sum of the injection rates from all contributing sources.\n$$\nL_{h}(x,y \\rightarrow x+1,y) = \n\\begin{cases} \n\\lambda (x+1) & \\text{if } y > x \\\\\n0 & \\text{if } y \\le x \n\\end{cases}\n$$\nwhere $x \\in \\{0, \\dots, k-2\\}$ and $y \\in \\{0, \\dots, k-1\\}$.\n\n**Load on a vertical link $(c,r) \\rightarrow (c,r+1)$:**\nLet $L_v(c,r \\rightarrow c,r+1)$ be the traffic load on the directed vertical link from node $(c,r)$ to $(c,r+1)$. A packet from source $(i_s, j_s)$ to destination $(j_s, i_s)$ traverses this link if:\n- The vertical leg of its journey occurs on column $c$. The vertical path is entirely on the destination column, so $j_s = c$.\n- The vertical travel must be upward (row index increasing), which implies the destination row $i_s$ is greater than the source row $j_s$. Thus, $i_s > j_s$.\n- The specific link from row $r$ to $r+1$ must be part of the vertical path from row $j_s$ to row $i_s$. This means $j_s \\le r < i_s$.\n\nCombining these conditions for a given link $(c,r) \\rightarrow (c,r+1)$: the contributing source nodes $(i_s, j_s)$ must satisfy $j_s = c$, $i_s > c$, and $c \\le r < i_s$.\nThe condition $c \\le r$ is necessary. If $c > r$, the condition $j_s \\le r$ (with $j_s=c$) cannot be met, so the load is $0$.\nIf $c \\le r$, the conditions on the source node's coordinates $(i_s, j_s)$ become: $j_s=c$ and $i_s > r$ (since $i_s > c$ is implied by $i_s > r$ and $r \\ge c$).\nThe contributing sources are the set of nodes $\\{(i_s, c) | r < i_s \\le k-1\\}$. The number of such source nodes is $(k-1) - (r+1) + 1 = k-1-r$.\nThe total load on this link is:\n$$\nL_{v}(c,r \\rightarrow c,r+1) = \n\\begin{cases} \n\\lambda (k-1-r) & \\text{if } c \\le r \\\\\n0 & \\text{if } c > r \n\\end{cases}\n$$\nwhere $c \\in \\{0, \\dots, k-1\\}$ and $r \\in \\{0, \\dots, k-2\\}$.\n\n**2. Identification of Saturated Links**\n\nSaturation occurs on the link(s) with the maximum offered load. We must find the maximum load by maximizing the expressions derived above over their respective domains.\n\nFor horizontal links (rightward): $L_{h}(x,y \\rightarrow x+1,y) = \\lambda (x+1)$ for $y > x$. To maximize this, we must maximize $x$. The domain for $x$ is $\\{0, \\dots, k-2\\}$. The maximum value is $x = k-2$. This gives a load of $\\lambda(k-2+1) = \\lambda(k-1)$. This maximum is achieved when $x=k-2$ and the condition $y > x$ is met. This means $y > k-2$, which, given $y \\le k-1$, implies $y=k-1$.\nThus, the maximum rightward horizontal load is $L_{h,max} = \\lambda(k-1)$, occurring uniquely on the link $((k-2, k-1), (k-1, k-1))$.\n\nFor vertical links (upward): $L_{v}(c,r \\rightarrow c,r+1) = \\lambda (k-1-r)$ for $c \\le r$. To maximize this, we must minimize $r$. The domain for $r$ is $\\{0, \\dots, k-2\\}$. The minimum value is $r=0$. This gives a load of $\\lambda(k-1-0) = \\lambda(k-1)$. This maximum is achieved when $r=0$ and the condition $c \\le r$ is met. This means $c \\le 0$, which implies $c=0$.\nThus, the maximum upward vertical load is $L_{v,max} = \\lambda(k-1)$, occurring uniquely on the link $((0, 0), (0, 1))$.\n\nThe maximum load found from these expressions is $L_{max} = \\lambda(k-1)$.\nA complete analysis requires checking all four directions. A similar derivation for leftward and downward links reveals that the same maximum load $\\lambda(k-1)$ is also reached on link $((1,0),(0,0))$ (leftward) and link $((k-1,k-1),(k-1,k-2))$ (downward).\nTherefore, the set of directed links that become saturated consists of these four links:\n- $((k-2, k-1), (k-1, k-1))$\n- $((0, 0), (0, 1))$\n- $((1, 0), (0, 0))$\n- $((k-1, k-1), (k-1, k-2))$\n\n**3. Critical Injection Rate $\\lambda^{\\star}$**\n\nThe system saturates when the load on the most heavily utilized link equals the link capacity $b$. We found the maximum load on any link to be $L_{max} = \\lambda(k-1)$.\nLet $\\lambda^{\\star}$ be the critical injection rate at which saturation first occurs. At this point:\n$$L_{max} = b$$\n$$\\lambda^{\\star} (k-1) = b$$\nSolving for $\\lambda^{\\star}$, we get:\n$$\\lambda^{\\star} = \\frac{b}{k-1}$$\nThis expression is valid for $k \\ge 2$. For $k=1$, a single-node mesh, there are no links and no traffic, so saturation is not a meaningful concept and the formula is undefined, which is consistent.",
            "answer": "$$\n\\boxed{\\frac{b}{k-1}}\n$$"
        },
        {
            "introduction": "While minimal, shortest-path routing seems intuitively optimal, it can lead to severe performance degradation when paths converge on a congested link. This practice explores the core principle behind adaptive routing through a carefully constructed thought experiment. By comparing the latency of a minimal path through a hotspot with a longer, non-minimal detour, you will quantify the trade-off between hop count and congestion and determine the precise conditions under which avoiding a bottleneck is the faster choice.",
            "id": "4285102",
            "problem": "Consider a two-dimensional mesh Network-on-Chip (NoC) of size $4 \\times 4$ with routers at integer coordinates $(y,x)$ for $y \\in \\{0,1,2,3\\}$ and $x \\in \\{0,1,2,3\\}$. Links connect nearest neighbors bidirectionally, and deterministic dimension-order (also called $X$-$Y$) routing is used: packets first traverse the $x$-dimension to reach the correct column, then traverse the $y$-dimension to reach the correct row. Each link is modeled as an independent $M/M/1$ queue with service rate $\\mu$ (in flits per cycle). Packets are wormhole routed, and for this problem the expected end-to-end latency of a packet is the sum of the expected sojourn times over the links along its path.\n\nYou are given a constructed traffic matrix that induces a single congested horizontal link on row $y=0$ between columns $x=1$ and $x=2$, denoted $(0,1)\\leftrightarrow(0,2)$, while keeping all other links at a uniform base load. Specifically:\n- There is a uniform, low-intensity background all-to-all traffic such that, after $X$-$Y$ routing, every link in the network receives an average exogenous arrival rate equal to $\\lambda_{0}$ (in flits per cycle). Assume $0 \\le \\lambda_{0} < \\mu$.\n- In addition, there are two high-rate entries in the traffic matrix:\n  - From source $(0,1)$ to destination $(0,2)$ with offered rate $a$ (in flits per cycle).\n  - From source $(0,1)$ to destination $(0,3)$ with offered rate $b$ (in flits per cycle).\n  Under $X$-$Y$ routing, both of these flows traverse the link $(0,1)\\rightarrow(0,2)$, so the total arrival rate on that directed link is $\\lambda_{c}=\\lambda_{0}+a+b$. Assume $0 \\le \\lambda_{c} < \\mu$. All other links remain at arrival rate $\\lambda_{0}$ due to the background traffic alone. The bidirectional nature of links is irrelevant here; consider the direction $(0,1)\\rightarrow(0,2)$ as the congested direction.\n\nConsider a test flow with infinitesimal injection rate (so it does not perturb the queueing loads) from source $(0,0)$ to destination $(0,3)$. Under $X$-$Y$ routing, the minimal path (three hops along row $y=0$) is $(0,0)\\rightarrow(0,1)\\rightarrow(0,2)\\rightarrow(0,3)$, which includes the congested link $(0,1)\\rightarrow(0,2)$. A particular non-minimal path that avoids this congested link is to detour one row down and come back up: $(0,0)\\rightarrow(0,1)\\rightarrow(1,1)\\rightarrow(1,2)\\rightarrow(0,2)\\rightarrow(0,3)$, which has two extra hops compared to the minimal path and, by construction, places the packet only on links with arrival rate $\\lambda_{0}$.\n\nUsing only well-tested queueing results for $M/M/1$ queues and linearity of expected values over a fixed path, do the following:\n1. Show, by explicit comparison of expected path latencies, that there exists a congestion level on the link $(0,1)\\rightarrow(0,2)$ above which the non-minimal detour yields a strictly lower expected end-to-end delay than the minimal $X$-$Y$ path.\n2. Compute the exact threshold value of the congested-link arrival rate $\\lambda_{c}^{\\star}$ (in flits per cycle) as a closed-form expression in terms of $\\mu$ and $\\lambda_{0}$ for this topology and detour choice, such that for all $\\lambda_{c}>\\lambda_{c}^{\\star}$ the non-minimal path has lower expected delay than the minimal path, and for all $\\lambda_{c}<\\lambda_{c}^{\\star}$ the minimal path has lower expected delay.\n\nExpress your final answer for $\\lambda_{c}^{\\star}$ symbolically in terms of $\\mu$ and $\\lambda_{0}$, in units of flits per cycle. No numerical substitution is required.",
            "solution": "The fundamental principle for this analysis is the formula for the expected sojourn time, $E[T]$, in a single $M/M/1$ queue, which represents the average time a packet (or flit) spends in the system (in queue plus in service). For a queue with an average arrival rate of $\\lambda$ and an average service rate of $\\mu$, this is given by:\n$$E[T] = \\frac{1}{\\mu - \\lambda}$$\nThe problem states that the expected end-to-end latency of a packet is the sum of the expected sojourn times over the sequence of links forming its path. This is a direct application of the linearity of expectation.\n\nWe will analyze the two paths for the test flow from source $S=(0,0)$ to destination $D=(0,3)$.\n\nFirst, consider the minimal path dictated by deterministic $X$-$Y$ routing, which we shall denote as Path $1$.\nPath $1$: $(0,0) \\rightarrow (0,1) \\rightarrow (0,2) \\rightarrow (0,3)$.\nThis path is composed of $3$ hops. We must determine the arrival rate for each of the $3$ links traversed:\n1.  Link $(0,0) \\rightarrow (0,1)$: This link is not the specified congested link. Therefore, its arrival rate is the background rate, $\\lambda_{0}$.\n2.  Link $(0,1) \\rightarrow (0,2)$: This is the designated congested link. Its arrival rate is given as $\\lambda_{c}$.\n3.  Link $(0,2) \\rightarrow (0,3)$: This is another uncongested link, with an arrival rate of $\\lambda_{0}$.\n\nThe total expected latency for Path $1$, denoted $L_1$, is the sum of the expected sojourn times on these three links:\n$$L_1 = E[T_{(0,0) \\rightarrow (0,1)}] + E[T_{(0,1) \\rightarrow (0,2)}] + E[T_{(0,2) \\rightarrow (0,3)}]$$\n$$L_1 = \\frac{1}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{c}} + \\frac{1}{\\mu - \\lambda_{0}}$$\n$$L_1 = \\frac{2}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{c}}$$\n\nNext, consider the non-minimal detour path, which we shall denote as Path $2$.\nPath $2$: $(0,0) \\rightarrow (0,1) \\rightarrow (1,1) \\rightarrow (1,2) \\rightarrow (0,2) \\rightarrow (0,3)$.\nThis path is composed of $5$ hops. The problem states that this path is constructed to place the packet only on links with arrival rate $\\lambda_0$. This is because it explicitly bypasses the congested link $(0,1) \\rightarrow (0,2)$. Each of the $5$ links on this path thus has an arrival rate of $\\lambda_{0}$.\n\nThe total expected latency for Path $2$, denoted $L_2$, is the sum of the expected sojourn times on these five identical links:\n$$L_2 = 5 \\times E[T_{\\text{uncongested}}]$$\n$$L_2 = \\frac{5}{\\mu - \\lambda_{0}}$$\n\nWith the expressions for $L_1$ and $L_2$ established, we can address the two parts of the problem.\n\n1.  Show that there exists a congestion level on the congested link above which the non-minimal detour is faster.\nThe non-minimal path (Path $2$) has a lower expected delay than the minimal path (Path $1$) if $L_2 < L_1$.\n$$\\frac{5}{\\mu - \\lambda_{0}} < \\frac{2}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{c}}$$\nThis inequality depends on the value of $\\lambda_{c}$. Let's analyze the behavior of the two latencies. $L_2$ is a constant value with respect to $\\lambda_{c}$, as it only depends on $\\mu$ and $\\lambda_{0}$. In contrast, $L_1$ is a strictly increasing function of $\\lambda_{c}$ over the valid domain $[0, \\mu)$. As the congestion level $\\lambda_{c}$ increases and approaches the service rate $\\mu$, the term $\\mu - \\lambda_{c}$ approaches $0$ from the positive side, causing the term $\\frac{1}{\\mu - \\lambda_{c}}$ to increase without bound. Consequently, $L_1$ also increases without bound.\nAt the lowest possible congestion level for the specified link, where $\\lambda_c = \\lambda_0$ (corresponding to $a+b=0$), the latency of the minimal path is:\n$$L_1(\\lambda_c = \\lambda_0) = \\frac{2}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{0}} = \\frac{3}{\\mu - \\lambda_{0}}$$\nIn this case, $L_1 = \\frac{3}{\\mu - \\lambda_{0}} < \\frac{5}{\\mu - \\lambda_{0}} = L_2$, so the minimal path is faster, as expected.\nHowever, since $L_1$ grows monotonically and unboundedly with $\\lambda_{c}$ while $L_2$ remains constant, there must exist a value of $\\lambda_{c}$ where $L_1$ surpasses $L_2$. This confirms that for sufficiently high congestion levels, the non-minimal path will indeed yield a strictly lower expected delay.\n\n2.  Compute the exact threshold value $\\lambda_{c}^{\\star}$.\nThe threshold $\\lambda_{c}^{\\star}$ is the specific value of the congested link's arrival rate at which the expected latencies of the two paths are equal, i.e., $L_1 = L_2$. For any $\\lambda_c > \\lambda_c^{\\star}$, we will have $L_1 > L_2$.\nSetting the two latency expressions equal:\n$$\\frac{2}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{c}^{\\star}} = \\frac{5}{\\mu - \\lambda_{0}}$$\nTo solve for $\\lambda_{c}^{\\star}$, we first isolate the term containing it:\n$$\\frac{1}{\\mu - \\lambda_{c}^{\\star}} = \\frac{5}{\\mu - \\lambda_{0}} - \\frac{2}{\\mu - \\lambda_{0}}$$\n$$\\frac{1}{\\mu - \\lambda_{c}^{\\star}} = \\frac{3}{\\mu - \\lambda_{0}}$$\nNow, we take the reciprocal of both sides of the equation:\n$$\\mu - \\lambda_{c}^{\\star} = \\frac{\\mu - \\lambda_{0}}{3}$$\nFinally, we solve for $\\lambda_{c}^{\\star}$:\n$$\\lambda_{c}^{\\star} = \\mu - \\frac{\\mu - \\lambda_{0}}{3}$$\nCombining the terms on the right-hand side gives the final closed-form expression:\n$$\\lambda_{c}^{\\star} = \\frac{3\\mu - (\\mu - \\lambda_{0})}{3} = \\frac{3\\mu - \\mu + \\lambda_{0}}{3}$$\n$$\\lambda_{c}^{\\star} = \\frac{2\\mu + \\lambda_{0}}{3}$$\nThis is the threshold arrival rate on the congested link. For any $\\lambda_c > \\lambda_{c}^{\\star}$, the non-minimal path becomes the preferable choice in terms of expected latency. The condition $\\lambda_c < \\lambda_c^{\\star}$ implies the minimal path is faster, and at $\\lambda_c = \\lambda_c^{\\star}$ both paths have identical expected latency.",
            "answer": "$$\\boxed{\\frac{2\\mu + \\lambda_{0}}{3}}$$"
        },
        {
            "introduction": "Building on the insight that non-minimal paths can outperform minimal ones, this exercise delves into the implementation of a practical adaptive routing algorithm. You will model the decision-making logic of Universal Globally Adaptive Load-balanced (UGAL) routing, which dynamically chooses between a minimal path and a non-minimal one based on local network state. By deriving the latency-indifference equation, you will formalize the trade-off between path length and queuing delay into a quantitative rule, revealing how abstract routing principles are translated into concrete hardware logic.",
            "id": "4285037",
            "problem": "A Network-on-Chip (NoC) using wormhole or virtual-cut-through flow control is deployed on a $2\\text{D}$ mesh. Each router adds a constant per-hop base latency composed of a router pipeline latency $t_{r}$ and a link traversal latency $t_{\\ell}$. The network carries single-flit packets, so that the per-flit service (serialization) time on an output port is a known constant $\\tau$. Each output port is scheduled First-Come, First-Served (FCFS). When a packet arrives at an output port that currently has $q$ flits buffered ahead of it, the expected waiting time is approximated by $q\\,\\tau$. The Universal Globally Adaptive Load-balanced (UGAL) routing algorithm, at each source node for each packet, chooses between a minimal path and a two-segment non-minimal path constructed by Valiant routing (source to a randomly chosen intermediate node, then intermediate to destination), by comparing estimated end-to-end latency of the two choices using only locally measurable quantities (hop counts and downstream output queue occupancies).\n\nTreat end-to-end latency as the sum, over the hops of a chosen path, of the base per-hop latency and the output-port waiting time at each hop. Consider a particular source-destination pair at some instant. Let the minimal path have hop count $h_{m}$ and the sum of the downstream output-port queue occupancies along that path be $Q_{m}$. Let the Valiant path (via a uniformly random intermediate) that is currently considered have total hop count $h_{v}$ and the sum of the downstream output-port queue occupancies along its two segments be $Q_{v}$. Define the base per-hop latency $t_{b}$ by $t_{b} = t_{r} + t_{\\ell}$.\n\nStarting from the fundamental model described above, derive a closed-form expression for the threshold difference in aggregate queue occupancy, denoted $K$, such that the UGAL decision is indifferent between choosing the minimal or the Valiant path when $Q_{v} - Q_{m} = K$. Express $K$ solely in terms of $h_{m}$, $h_{v}$, $t_{r}$, $t_{\\ell}$, and $\\tau$. Your final answer must be a single closed-form analytic expression. Do not provide an inequality. Do not include units in your final answer.",
            "solution": "The end-to-end latency for a packet traversing a path in the Network-on-Chip is modeled as the sum of all per-hop latencies. The latency at each hop consists of two components: a fixed base latency and a variable waiting time due to queueing.\n\nLet $L$ denote the total estimated end-to-end latency for an arbitrary path. The path is characterized by its hop count, $h$, and the sum of queue occupancies at the output ports along the path, $Q$.\n\nThe base per-hop latency is defined as $t_{b} = t_{r} + t_{\\ell}$. For a path with $h$ hops, the total contribution from the base latency is $h \\cdot t_{b}$.\n\nThe waiting time at each hop depends on the number of flits already in the corresponding output port's queue. The problem states that for a queue of size $q$, the waiting time is $q \\cdot \\tau$. The total waiting time for the entire path is the sum of these waiting times over all hops. If we denote the queue occupancy at hop $i$ as $q_{i}$, the total waiting time is $\\sum_{i=1}^{h} q_{i}\\tau$. This can be rewritten as $\\tau \\left(\\sum_{i=1}^{h} q_{i}\\right)$. The problem defines the sum of the downstream output-port queue occupancies as $Q = \\sum_{i=1}^{h} q_{i}$. Therefore, the total waiting time is $Q\\tau$.\n\nCombining these components, the general expression for the estimated end-to-end latency $L$ for a path with hop count $h$ and aggregate queue occupancy $Q$ is:\n$$L = h \\cdot t_{b} + Q \\cdot \\tau$$\nSubstituting the expression for $t_{b}$:\n$$L = h(t_{r} + t_{\\ell}) + Q\\tau$$\n\nWe now apply this general formula to the two specific paths considered by the UGAL algorithm: the minimal path and the Valiant path.\n\nFor the minimal path, the hop count is $h_{m}$ and the aggregate queue occupancy is $Q_{m}$. The estimated latency, $L_{m}$, is:\n$$L_{m} = h_{m}(t_{r} + t_{\\ell}) + Q_{m}\\tau$$\n\nFor the Valiant path, the hop count is $h_{v}$ and the aggregate queue occupancy is $Q_{v}$. The estimated latency, $L_{v}$, is:\n$$L_{v} = h_{v}(t_{r} + t_{\\ell}) + Q_{v}\\tau$$\n\nThe UGAL decision is indifferent when the estimated latencies of the two paths are equal. We set $L_{m} = L_{v}$:\n$$h_{m}(t_{r} + t_{\\ell}) + Q_{m}\\tau = h_{v}(t_{r} + t_{\\ell}) + Q_{v}\\tau$$\n\nThe problem asks for an expression for the threshold difference in aggregate queue occupancy, $K$, defined as $K = Q_{v} - Q_{m}$. To find this, we rearrange the indifference equation to isolate the terms involving $Q_{v}$ and $Q_{m}$.\nLet's move all queue-related terms to one side of the equation and all hop-count-related terms to the other side:\n$$h_{m}(t_{r} + t_{\\ell}) - h_{v}(t_{r} + t_{\\ell}) = Q_{v}\\tau - Q_{m}\\tau$$\n\nFactoring out the common terms on both sides of the equation gives:\n$$(h_{m} - h_{v})(t_{r} + t_{\\ell}) = (Q_{v} - Q_{m})\\tau$$\n\nBy definition, $K = Q_{v} - Q_{m}$. Substituting $K$ into the equation:\n$$(h_{m} - h_{v})(t_{r} + t_{\\ell}) = K\\tau$$\n\nFinally, to obtain a closed-form expression for $K$, we divide both sides by $\\tau$. Since $\\tau$ represents a service time, it is a positive physical quantity, so division by $\\tau$ is well-defined.\n$$K = \\frac{(h_{m} - h_{v})(t_{r} + t_{\\ell})}{\\tau}$$\n\nThis expression provides the threshold difference in aggregate queue occupancy $K$ purely in terms of the given parameters $h_{m}$, $h_{v}$, $t_{r}$, $t_{\\ell}$, and $\\tau$.",
            "answer": "$$\\boxed{\\frac{(h_{m} - h_{v})(t_{r} + t_{\\ell})}{\\tau}}$$"
        }
    ]
}