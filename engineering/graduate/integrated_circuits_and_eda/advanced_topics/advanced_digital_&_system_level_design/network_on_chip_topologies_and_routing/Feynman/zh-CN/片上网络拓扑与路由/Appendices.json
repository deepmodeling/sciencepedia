{
    "hands_on_practices": [
        {
            "introduction": "分析网络拓扑的性能极限是片上网络（NoC）设计中的一个核心任务。此练习通过一个经典的合成流量模式——转置流量（transpose traffic），来引导您识别网络中的瓶颈链路。通过系统地计算确定性路由下每条链路的负载，您可以推导出整个网络的饱和点，即最大可持续注入率。这项实践旨在锻炼您在规则拓扑上进行流量分析和性能瓶颈识别的基本能力，这是所有NoC设计者必须掌握的关键技能。",
            "id": "4285091",
            "problem": "考虑一个二维 $k \\times k$ 网格片上网络 (NoC)，其中每个位于坐标 $(i,j)$（$i,j \\in \\{0,1,\\dots,k-1\\}$）的单元都包含一个路由器。该网格使用确定性维度排序 $X$-$Y$ 路由，并且每条物理链路都是双向的，每个方向的独立容量为每个周期 $b$ flit。假设数据包为单 flit，且注入是均匀稳态的：每个节点以每个周期 $\\lambda$ flit 的速率注入，目的地根据合成转置流量模式确定，即源于 $(i,j)$ 的数据包目的地为 $(j,i)$。对角线上的自流量（即 $i=j$ 的情况）不消耗任何链路。忽略有限缓冲效应，并假设流控是理想的，因此吞吐量崩溃由第一个达到其容量的定向链路决定。\n\n使用流量守恒和维度排序路由下的路径构成基本原理，并且不引用任何预先推导出的流量公式，完成以下任务：\n\n1. 推导在任意定向水平链路（从 $(x,y)$ 到 $(x+1,y)$）和任意定向垂直链路（从 $(c,r)$ 到 $(c,r+1)$）上的请求负载（以 flit/周期为单位），作为 $k$、$x$、$y$、$c$、$r$ 和注入率 $\\lambda$ 的函数。\n\n2. 根据这些表达式，确定在转置流量下，吞吐量崩溃开始时达到饱和的定向链路集合。\n\n3. 量化首次饱和发生时的临界均匀注入率 $\\lambda^{\\star}$（以 flit/周期/节点为单位）。\n\n将最终答案表示为关于 $k$ 和 $b$ 的 $\\lambda^{\\star}$ 的单个闭式表达式，单位为 flit/周期。无需四舍五入。在你的推导中，清楚地指出你找到的饱和链路，但最终数值表达式只提供 $\\lambda^{\\star}$。",
            "solution": "### 推导\n\n该问题要求推导转置流量下网络链路上的请求负载，识别瓶颈链路，并计算最大可持续注入率。我们通过分析数据包所走的路径来进行推导。\n\n在确定性 $X-Y$ 路由下，一个从源节点 $S = (i_s, j_s)$ 到目的节点 $D = (i_d, j_d)$ 的数据包首先沿着行 $j_s$ 水平传输，直到到达列 $i_d$，然后沿着列 $i_d$ 垂直传输以到达行 $j_d$。从水平移动到垂直移动的转弯发生在节点 $(i_d, j_s)$。\n\n对于指定的转置流量模式，从 $S=(i_s, j_s)$ 发出的数据包的目的地是 $D=(j_s, i_s)$。因此，路径由一个从 $(i_s, j_s)$到 $(j_s, j_s)$ 的水平段，和一个从 $(j_s, j_s)$到 $(j_s, i_s)$ 的垂直段组成。请注意，对于对角线节点 $i_s=j_s$，源和目的地相同，问题规定这种自流量不消耗任何链路。我们只考虑 $i_s \\neq j_s$ 的情况。\n\n**1. 定向链路上的请求负载**\n\n我们被要求推导一个向右的水平链路和一个向上的垂直链路的负载。\n\n**水平链路 $(x,y) \\rightarrow (x+1,y)$ 上的负载：**\n令 $L_h(x,y \\rightarrow x+1,y)$ 为从节点 $(x,y)$ 到 $(x+1,y)$ 的定向水平链路上的流量负载。一个从源 $(i_s, j_s)$ 发出的数据包要穿过此链路，其路径必须包含此段。根据转置目的地 $(j_s, i_s)$ 的 $X-Y$ 路由，这要求：\n- 数据包必须沿行 $y$ 传输，所以 $j_s = y$。\n- 水平传输必须是向右的，这意味着目的地列 $j_s$ 在源列 $i_s$ 的右侧。因此，$i_s  j_s$。\n- 从列 $x$ 到 $x+1$ 的特定链路必须是从列 $i_s$ 到 $j_s$ 的水平路径的一部分。这意味着 $i_s \\le x  j_s$。\n\n对于一个给定的链路 $(x,y) \\rightarrow (x+1,y)$，综合这些条件：贡献流量的源节点 $(i_s, j_s)$ 必须满足 $j_s = y$ 和 $i_s \\le x  y$。\n条件 $x  y$ 是该链路承载任何转置流量的必要先决条件。如果 $x \\ge y$，则不存在满足 $i_s \\le x$ 的源 $(i_s, y)$（其中 $i_s  y$），因此负载为 0。\n如果 $x  y$，贡献流量的源是节点集合 $\\{(i_s, y) | 0 \\le i_s \\le x\\}$。此类源节点的数量为 $x+1$。\n由于每个节点以每个周期 $\\lambda$ flit 的速率注入，此链路上的总负载是所有贡献源节点注入率的总和。\n$$\nL_{h}(x,y \\rightarrow x+1,y) = \n\\begin{cases} \n\\lambda (x+1)  \\text{如果 } y  x \\\\\n0  \\text{如果 } y \\le x \n\\end{cases}\n$$\n其中 $x \\in \\{0, \\dots, k-2\\}$ 且 $y \\in \\{0, \\dots, k-1\\}$。\n\n**垂直链路 $(c,r) \\rightarrow (c,r+1)$ 上的负载：**\n令 $L_v(c,r \\rightarrow c,r+1)$ 为从节点 $(c,r)$ 到 $(c,r+1)$ 的定向垂直链路上的流量负载。一个从源 $(i_s, j_s)$到目的地 $(j_s, i_s)$ 的数据包如果穿过此链路，则：\n- 其路径的垂直部分发生在列 $c$ 上。垂直路径完全位于目的地的列上，所以 $j_s = c$。\n- 垂直传输必须是向上的（行索引增加），这意味着目的地行 $i_s$ 大于源行 $j_s$。因此，$i_s  j_s$。\n- 从行 $r$到 $r+1$ 的特定链路必须是从行 $j_s$到行 $i_s$ 的垂直路径的一部分。这意味着 $j_s \\le r  i_s$。\n\n对于一个给定的链路 $(c,r) \\rightarrow (c,r+1)$，综合这些条件：贡献流量的源节点 $(i_s, j_s)$ 必须满足 $j_s = c$，$i_s  c$，以及 $c \\le r  i_s$。\n条件 $c \\le r$ 是必要的。如果 $c  r$，则条件 $j_s \\le r$ (其中 $j_s=c$) 无法满足，因此负载为 0。\n如果 $c \\le r$，源节点坐标 $(i_s, j_s)$ 的条件变为：$j_s=c$ 和 $i_s  r$ (因为 $i_s  r$ 和 $r \\ge c$ 蕴含了 $i_s  c$）。\n贡献流量的源是节点集合 $\\{(i_s, c) | r  i_s \\le k-1\\}$。此类源节点的数量为 $(k-1) - (r+1) + 1 = k-1-r$。\n此链路上的总负载为：\n$$\nL_{v}(c,r \\rightarrow c,r+1) = \n\\begin{cases} \n\\lambda (k-1-r)  \\text{如果 } c \\le r \\\\\n0  \\text{如果 } c  r \n\\end{cases}\n$$\n其中 $c \\in \\{0, \\dots, k-1\\}$ 且 $r \\in \\{0, \\dots, k-2\\}$。\n\n**2. 饱和链路的识别**\n\n饱和发生在请求负载最大的链路上。我们必须通过在其各自的定义域上最大化上述推导出的表达式来找到最大负载。\n\n对于水平链路（向右）：$L_{h}(x,y \\rightarrow x+1,y) = \\lambda (x+1)$ 对于 $y  x$。为了最大化此表达式，我们必须最大化 $x$。$x$ 的定义域是 $\\{0, \\dots, k-2\\}$。最大值为 $x = k-2$。这给出的负载为 $\\lambda(k-2+1) = \\lambda(k-1)$。当 $x=k-2$ 并且满足条件 $y  x$ 时达到此最大值。这意味着 $y  k-2$，考虑到 $y \\le k-1$，则 $y=k-1$。\n因此，最大的向右水平负载是 $L_{h,max} = \\lambda(k-1)$，唯一地出现在链路 $((k-2, k-1), (k-1, k-1))$ 上。\n\n对于垂直链路（向上）：$L_{v}(c,r \\rightarrow c,r+1) = \\lambda (k-1-r)$ 对于 $c \\le r$。为了最大化此表达式，我们必须最小化 $r$。$r$ 的定义域是 $\\{0, \\dots, k-2\\}$。最小值为 $r=0$。这给出的负载为 $\\lambda(k-1-0) = \\lambda(k-1)$。当 $r=0$ 并且满足条件 $c \\le r$ 时达到此最大值。这意味着 $c \\le 0$，即 $c=0$。\n因此，最大的向上垂直负载是 $L_{v,max} = \\lambda(k-1)$，唯一地出现在链路 $((0, 0), (0, 1))$ 上。\n\n从这些表达式中找到的最大负载是 $L_{max} = \\lambda(k-1)$。\n完整的分析需要检查所有四个方向。对向左和向下的链路进行类似的推导表明，相同的最大负载 $\\lambda(k-1)$ 也会在链路 $((1,0),(0,0))$（向左）和链路 $((k-1,k-1),(k-1,k-2))$（向下）上达到。\n因此，达到饱和的定向链路集合由以下四个链路组成：\n- $((k-2, k-1), (k-1, k-1))$\n- $((0, 0), (0, 1))$\n- $((1, 0), (0, 0))$\n- $((k-1, k-1), (k-1, k-2))$\n\n**3. 临界注入率 $\\lambda^{\\star}$**\n\n当利用率最高的链路上的负载等于链路容量 $b$ 时，系统达到饱和。我们发现任何链路上的最大负载为 $L_{max} = \\lambda(k-1)$。\n令 $\\lambda^{\\star}$ 为首次饱和发生时的临界注入率。此时：\n$$L_{max} = b$$\n$$\\lambda^{\\star} (k-1) = b$$\n求解 $\\lambda^{\\star}$，我们得到：\n$$\\lambda^{\\star} = \\frac{b}{k-1}$$\n此表达式对 $k \\ge 2$ 有效。对于 $k=1$ 的单节点网格，没有链路也没有流量，因此饱和不是一个有意义的概念，该公式未定义，这是符合逻辑的。",
            "answer": "$$\n\\boxed{\\frac{b}{k-1}}\n$$"
        },
        {
            "introduction": "在识别出网络瓶颈之后，下一步是量化拥塞所带来的延迟。排队论为此提供了强有力的数学框架。本练习将指导您把一个经典的M/M/1排队模型应用于一个具体的网络链路，从第一性原理出发，推导其平均等待时间。这项实践不仅能帮助您将抽象的排队论概念与具体的NoC性能分析联系起来，还能促使您批判性地思考该简化模型在面对真实网络中常见的突发流量时的局限性。",
            "id": "4285043",
            "problem": "考虑一个二维片上网络（NoC），其排列为一个 $N_{x} \\times N_{y}$ 的网格，其中 $N_{x} = 8$ 列，$N_{y} = 8$ 行。路由器由整数坐标 $(x,y)$ 索引，其中 $x \\in \\{0,1,\\dots,7\\}$ 且 $y \\in \\{0,1,\\dots,7\\}$。网络使用确定性的 $X$–$Y$ 路由（XY）：数据包首先完全沿着 $x$ 维度传输，然后沿着 $y$ 维度传输。每个节点以恒定速率 $r = 0.04$ 包/周期独立地注入数据包，目的地从所有其他节点中均匀随机选择（不包括发往自身）。每个数据包的固定长度为 $L = 10$ flits（流控单元），每个单向链路每周期可传输 $F = 1$ flit。假设采用虫洞流控，每个链路的输出队列可以被建模为一个马尔可夫/马尔可夫/单服务器（$M/M/1$）近似下的生灭过程。\n\n关注从路由器 $(3,5)$ 到路由器 $(4,5)$ 的东向链路。使用排队论的基本原理和所述的流量模型，执行以下步骤：\n\n1. 通过从基本定义出发，计算在确定性 $X$–$Y$ 路由下会穿过此特定链路的源-目标对集合，从而推导出该链路的总到达率 $\\lambda$（单位：包/周期）。您的推导必须明确说明均匀选择目的地时排除了源节点本身的情况。\n\n2. 根据给定的 flit 速率 $F$ 和数据包长度 $L$，推导出链路的服务率 $\\mu$（单位：包/周期）。\n\n3. 定义利用率 $\\rho$，并从 $M/M/1$ 队列的稳态生灭特性和 Little 定律出发，推导出队列中的平均等待时间 $W$ 作为 $\\rho$ 和 $\\mu$ 的函数的解析表达式。不要假设任何预先给定的公式；从生灭过程的核心定义和标准稳态属性开始。\n\n4. 计算在指定参数下 $W$ 的数值。将您的答案四舍五入到四位有效数字，并以周期为单位表示最终的等待时间。\n\n根据所述的建模假设，简明而严谨地解释，在链路级别为由现实工作负载生成的突发性 NoC 流量使用 $M/M/1$ 近似的局限性。您的解释应根植于假设的到达和服务过程与实际 NoC 行为之间的不匹配，但最终的数值答案必须仅为计算出的 $W$。",
            "solution": "**1. 总到达率 $\\lambda$ 的推导**\n\n该网络是一个 $N_x \\times N_y$ 的网格，其中 $N_x=8$，$N_y=8$。节点总数为 $N = N_x \\times N_y = 8 \\times 8 = 64$。每个节点以 $r = 0.04$ 包/周期的速率注入数据包。每个数据包的目的地从其他 $N-1 = 63$ 个节点中均匀随机选择。\n\n路由算法是确定性 $X$–$Y$ 路由。一个从源节点 $(s_x, s_y)$ 到目标节点 $(d_x, d_y)$ 的数据包首先沿行 $s_y$ 水平传输，直到到达列 $d_x$，然后沿列 $d_x$ 垂直传输，以到达行 $d_y$。\n\n我们关注的是从路由器 $(3,5)$ 到路由器 $(4,5)$ 的东向链路的总到达率 $\\lambda$。一个数据包要穿过此特定链路，当且仅当其路径要求在第 5 行上从第 3 列移动到第 4 列。根据 $X$–$Y$ 路由，这对源 $(s_x, s_y)$ 和目标 $(d_x, d_y)$ 意味着以下条件：\n- 源的 $x$ 坐标必须在该链路起点的西边或与之重合：$s_x \\in \\{0, 1, 2, 3\\}$。\n- 数据包的水平传输必须沿第 5 行进行：$s_y = 5$。\n- 目标的 $x$ 坐标必须在该链路终点的东边或与之重合：$d_x \\in \\{4, 5, 6, 7\\}$。\n- 目标的 $y$ 坐标 $d_y$ 可以是任何值，因为垂直转向发生在水平传输完成之后：$d_y \\in \\{0, 1, \\dots, 7\\}$。\n\n让我们定义源节点集合 $S_{link}$，其发出的数据包可能穿过该链路：\n$S_{link} = \\{(s_x, 5) \\mid s_x \\in \\{0, 1, 2, 3\\}\\}$。这类源节点的数量为 $|S_{link}| = 4$。\n\n让我们定义目标节点集合 $D_{link}$，对于 $S_{link}$ 中的源，发往这些目标节点的数据包会穿过该链路：\n$D_{link} = \\{(d_x, d_y) \\mid d_x \\in \\{4, 5, 6, 7\\}, d_y \\in \\{0, 1, \\dots, 7\\}\\}$。这类目标节点的数量为 $|D_{link}| = 4 \\times 8 = 32$。\n\n请注意，对于任何源 $s \\in S_{link}$ 和任何目标 $d \\in D_{link}$，我们有 $s \\neq d$，因为它们的 $x$ 坐标不同。因此，排除发往自身的目的地不影响此计算。\n\n链路上的总到达率 $\\lambda$ 是 $S_{link}$ 中每个源节点向 $D_{link}$ 中目的地发送流量贡献的总和。$|S_{link}|$ 个源节点中的每一个都以速率 $r$ 注入数据包。一个数据包被发送到 $D_{link}$ 中某个目的地的概率是此类目的地的数量除以可能目的地的总数，即 $N-1$。\n\n$$ \\lambda = |S_{link}| \\times r \\times \\frac{|D_{link}|}{N-1} $$\n代入给定值：\n$$ \\lambda = 4 \\times 0.04 \\times \\frac{32}{64-1} = 0.16 \\times \\frac{32}{63} = \\frac{5.12}{63} \\text{ 包/周期} $$\n\n**2. 服务率 $\\mu$ 的推导**\n\n服务率 $\\mu$ 是链路能够服务数据包的最大速率。\n链路容量为 $F = 1$ flit/周期。\n数据包长度为 $L = 10$ flits/包。\n\n传输一个完整数据包所需的时间，即服务时间 $T_{service}$，是数据包长度除以链路容量：\n$$ T_{service} = \\frac{L}{F} = \\frac{10 \\text{ flits/包}}{1 \\text{ flit/周期}} = 10 \\text{ 周期/包} $$\n服务率 $\\mu$ 是平均服务时间的倒数：\n$$ \\mu = \\frac{1}{T_{service}} = \\frac{F}{L} = \\frac{1}{10} = 0.1 \\text{ 包/周期} $$\n\n**3. 平均等待时间 $W$ 的推导**\n\n该队列被建模为一个 $M/M/1$ 系统。这对应于在非负整数状态空间 $\\{0, 1, 2, \\dots\\}$ 上的一个生灭过程，其中状态 $n$ 表示系统中有 $n$ 个数据包（在队列中和在服务中）。\n令 $P_n$ 为处于状态 $n$ 的稳态概率。\n对于所有状态 $n \\ge 0$，出生率（到达）为 $\\lambda$。\n对于所有状态 $n \\ge 1$，死亡率（服务完成）为 $\\mu$。\n\n在稳态下，相邻状态之间的流率必须平衡。对于生灭过程，细致平衡方程为：\n$$ \\lambda P_n = \\mu P_{n+1} \\quad \\text{对于 } n \\ge 0 $$\n这给出了递推关系 $P_{n+1} = \\frac{\\lambda}{\\mu} P_n$。我们定义服务器利用率 $\\rho = \\frac{\\lambda}{\\mu}$。对于稳定的队列，必须有 $\\rho  1$。\n递推关系变为 $P_{n+1} = \\rho P_n$。通过归纳法解得：\n$$ P_n = \\rho^n P_0 $$\n所有概率之和必须等于 $1$：\n$$ \\sum_{n=0}^{\\infty} P_n = \\sum_{n=0}^{\\infty} \\rho^n P_0 = P_0 \\sum_{n=0}^{\\infty} \\rho^n = 1 $$\n对于 $\\rho  1$，几何级数和为 $\\sum_{n=0}^{\\infty} \\rho^n = \\frac{1}{1-\\rho}$。\n$$ P_0 \\left(\\frac{1}{1-\\rho}\\right) = 1 \\implies P_0 = 1 - \\rho $$\n因此，稳态概率分布为 $P_n = (1-\\rho)\\rho^n$。\n\n系统中的平均数据包数 $N_{sys}$ 是 $n$ 的期望值：\n$$ N_{sys} = E[n] = \\sum_{n=0}^{\\infty} n P_n = \\sum_{n=1}^{\\infty} n(1-\\rho)\\rho^n = (1-\\rho)\\rho \\sum_{n=1}^{\\infty} n\\rho^{n-1} $$\n注意到该和是几何级数的导数，$\\sum_{n=1}^{\\infty} n\\rho^{n-1} = \\frac{d}{d\\rho} \\sum_{n=0}^{\\infty} \\rho^n = \\frac{d}{d\\rho}\\left(\\frac{1}{1-\\rho}\\right) = \\frac{1}{(1-\\rho)^2}$。\n$$ N_{sys} = (1-\\rho)\\rho \\frac{1}{(1-\\rho)^2} = \\frac{\\rho}{1-\\rho} $$\nLittle 定律指出 $N_{sys} = \\lambda T_{sys}$，其中 $T_{sys}$ 是数据包在系统中的平均总时间。\n$$ T_{sys} = \\frac{N_{sys}}{\\lambda} = \\frac{\\rho/(1-\\rho)}{\\lambda} = \\frac{(\\lambda/\\mu)/(1-\\lambda/\\mu)}{\\lambda} = \\frac{1/\\mu}{1-\\lambda/\\mu} = \\frac{1}{\\mu-\\lambda} $$\n系统中的总时间 $T_{sys}$ 是队列中的平均等待时间 $W$ 和平均服务时间 $T_{service} = 1/\\mu$ 的和。\n$$ T_{sys} = W + T_{service} \\implies W = T_{sys} - T_{service} $$\n$$ W = \\frac{1}{\\mu-\\lambda} - \\frac{1}{\\mu} = \\frac{\\mu - (\\mu-\\lambda)}{\\mu(\\mu-\\lambda)} = \\frac{\\lambda}{\\mu(\\mu-\\lambda)} $$\n这也可以用 $\\rho$ 来表示：\n$$ W = \\frac{\\lambda/\\mu}{\\mu(1-\\lambda/\\mu)} = \\frac{\\rho}{\\mu(1-\\rho)} $$\n\n**4. $W$ 的数值计算**\n\n我们有以下数值：\n$$ \\lambda = \\frac{5.12}{63} \\text{ 包/周期} \\approx 0.08127 \\text{ 包/周期} $$\n$$ \\mu = 0.1 \\text{ 包/周期} $$\n首先，我们计算利用率 $\\rho$：\n$$ \\rho = \\frac{\\lambda}{\\mu} = \\frac{5.12/63}{0.1} = \\frac{5.12}{6.3} = \\frac{51.2}{63} $$\n因为 $51.2  63$，所以 $\\rho  1$，队列是稳定的。\n现在，我们使用推导出的公式计算平均等待时间 $W$：\n$$ W = \\frac{\\rho}{\\mu(1-\\rho)} = \\frac{51.2/63}{0.1 \\times (1 - 51.2/63)} = \\frac{51.2/63}{0.1 \\times (11.8/63)} = \\frac{51.2/63}{1.18/63} = \\frac{51.2}{1.18} $$\n$$ W = \\frac{5120}{118} = \\frac{2560}{59} \\approx 43.38983\\dots \\text{ 周期} $$\n四舍五入到四位有效数字，平均等待时间为 $W = 43.39$ 周期。\n\n**M/M/1 近似的局限性**\n\nM/M/1 模型做出了一些不适用于典型 NoC 流量的简化假设，从而导致不准确性：\n- **马尔可夫到达：** 到达的 'M' 假设了一个泊松过程，其中到达间隔时间是独立且呈指数分布的。真实的 NoC 流量通常是突发性和相关的。例如，一个处理器核心可能在短时间内发出一系列内存请求，或者来自不同源的流量由于上游阻塞而可能变得同步。这种突发性违反了泊松假设，通常会导致比 M/M/1 模型预测的更长的排队延迟。\n- **马尔可夫服务时间：** 第二个 'M' 假设服务时间是指数分布的。问题陈述中指出数据包长度固定为 $L = 10$ flits，链路容量为 $F = 1$ flit/周期。这导致了一个恒定的、确定性的服务时间，即 10 个周期，而不是一个可变的、指数分布的时间。对于服务过程，M/D/1 模型会更合适。M/M/1 模型假设的服务时间方差比实际存在的要高，这倾向于高估与具有相同平均服务时间的 M/D/1 模型相比的等待时间。\n- **队列的独立性：** 将每个链路的输出队列建模为独立的 M/M/1 系统忽略了虫洞交换网络中队列之间的强依赖性。在虫洞流控中，单个数据包可以同时占用多个链路资源。如果一个数据包的头 flit 在下游路由器处被阻塞，整个数据包就会停滞，从而占据它当前占用的链路。这种反压效应在沿路径的不同队列状态之间产生了强烈的相关性，这是独立的 M/M/1 队列假设无法捕捉到的现象。",
            "answer": "$$\n\\boxed{43.39}\n$$"
        },
        {
            "introduction": "既然我们知道拥塞是延迟的主要来源，那么能否通过更智能的路由决策来主动规避它呢？这个想法是自适应路由算法的核心。本练习构建了一个精巧的思想实验，让您在一个拥塞的最小路径和一个更长但通畅的非最小路径之间进行抉择。通过运用排队论的延迟模型，您将能够精确地量化这种权衡，并计算出非最小路径开始胜出的拥塞阈值。这项实践揭示了自适应路由背后的根本原理：最短的路径未必是最快的路径，从而为您理解和设计更高级的负载感知路由协议打下坚实的基础。",
            "id": "4285102",
            "problem": "考虑一个大小为 $4 \\times 4$ 的二维网格片上网络（NoC），其路由器位于整数坐标 $(y,x)$ 处，其中 $y \\in \\{0,1,2,3\\}$ 且 $x \\in \\{0,1,2,3\\}$。链路双向连接最近的邻居，并使用确定性维度顺序（也称 $XY$）路由：数据包首先沿 $x$ 维传输以到达正确的列，然后沿 $y$ 维传输以到达正确的行。每个链路被建模为一个独立的服务速率为 $\\mu$（单位：flit/周期）的 $M/M/1$ 队列。数据包采用虫洞路由，对于本问题，一个数据包的期望端到端延迟是其路径上各链路的期望逗留时间之和。\n\n给定一个构建的流量矩阵，该矩阵在行 $y=0$ 的列 $x=1$ 和 $x=2$ 之间引发了一条拥塞的水平链路，记为 $(0,1)\\leftrightarrow(0,2)$，同时所有其他链路保持在统一的基础负载水平。具体来说：\n- 存在一个统一的、低强度的背景全互联流量，使得在 $XY$ 路由后，网络中的每个链路都接收到等于 $\\lambda_{0}$（单位：flit/周期）的平均外生到达速率。假设 $0 \\le \\lambda_{0}  \\mu$。\n- 此外，流量矩阵中有两个高速率条目：\n  - 从源 $(0,1)$ 到目的 $(0,2)$，提供速率为 $a$（单位：flit/周期）。\n  - 从源 $(0,1)$ 到目的 $(0,3)$，提供速率为 $b$（单位：flit/周期）。\n  在 $XY$ 路由下，这两个流都穿过链路 $(0,1)\\rightarrow(0,2)$，因此该有向链路上的总到达速率为 $\\lambda_{c}=\\lambda_{0}+a+b$。假设 $0 \\le \\lambda_{c}  \\mu$。由于仅存在背景流量，所有其他链路的到达速率保持为 $\\lambda_{0}$。链路的双向性在此无关紧要；将方向 $(0,1)\\rightarrow(0,2)$ 视为拥塞方向。\n\n考虑一个从源 $(0,0)$ 到目的 $(0,3)$ 的测试流，其注入速率无穷小（因此不会干扰排队负载）。在 $XY$ 路由下，最小路径（沿行 $y=0$ 的三跳）为 $(0,0)\\rightarrow(0,1)\\rightarrow(0,2)\\rightarrow(0,3)$，该路径包括拥塞链路 $(0,1)\\rightarrow(0,2)$。一条避开此拥塞链路的特定非最小路径是向下绕行一行再返回：$(0,0)\\rightarrow(0,1)\\rightarrow(1,1)\\rightarrow(1,2)\\rightarrow(0,2)\\rightarrow(0,3)$，该路径比最小路径多两跳，并且根据构造，它使数据包只经过到达速率为 $\\lambda_{0}$ 的链路。\n\n仅使用关于 $M/M/1$ 队列的经过充分检验的排队论结果以及期望值在固定路径上的线性性质，完成以下任务：\n1. 通过对期望路径延迟的显式比较，证明存在一个拥塞水平，当拥塞链路 $(0,1)\\rightarrow(0,2)$ 的拥塞水平高于该值时，非最小绕行路径产生的期望端到端延迟严格低于最小 $XY$ 路径。\n2. 计算拥塞链路到达速率的精确阈值 $\\lambda_{c}^{\\star}$（单位：flit/周期），并用 $\\mu$ 和 $\\lambda_{0}$ 以闭式表达式表示。对于此拓扑和绕行选择，对于所有 $\\lambda_{c}\\lambda_{c}^{\\star}$，非最小路径的期望延迟低于最小路径；对于所有 $\\lambda_{c}  \\lambda_{c}^{\\star}$，最小路径的期望延迟较低。\n\n请用 $\\mu$ 和 $\\lambda_{0}$ 的符号形式表示 $\\lambda_{c}^{\\star}$ 的最终答案，单位为 flit/周期。无需进行数值代入。",
            "solution": "本分析的基本原理是单个 $M/M/1$ 队列中期望逗留时间 $E[T]$ 的公式，它表示一个数据包（或 flit）在系统中（排队时间加服务时间）花费的平均时间。对于一个平均到达速率为 $\\lambda$、平均服务速率为 $\\mu$ 的队列，该时间由以下公式给出：\n$$E[T] = \\frac{1}{\\mu - \\lambda}$$\n问题陈述指出，数据包的期望端到端延迟是其路径上各链路的期望逗留时间之和。这是期望线性性质的直接应用。\n\n我们将分析从源 $S=(0,0)$ 到目的 $D=(0,3)$ 的测试流的两条路径。\n\n首先，考虑由确定性 $XY$ 路由决定的最小路径，我们将其表示为路径 1。\n路径 1：$(0,0) \\rightarrow (0,1) \\rightarrow (0,2) \\rightarrow (0,3)$。\n该路径由 3 跳组成。我们必须确定其所经过的 3 个链路上各自的到达速率：\n1.  链路 $(0,0) \\rightarrow (0,1)$：此链路不是指定的拥塞链路。因此，其到达速率为背景速率 $\\lambda_{0}$。\n2.  链路 $(0,1) \\rightarrow (0,2)$：这是指定的拥塞链路。其到达速率给定为 $\\lambda_{c}$。\n3.  链路 $(0,2) \\rightarrow (0,3)$：这是另一个非拥塞链路，到达速率为 $\\lambda_{0}$。\n\n路径 1 的总期望延迟，记为 $L_1$，是这三个链路上的期望逗留时间之和：\n$$L_1 = E[T_{(0,0) \\rightarrow (0,1)}] + E[T_{(0,1) \\rightarrow (0,2)}] + E[T_{(0,2) \\rightarrow (0,3)}]$$\n$$L_1 = \\frac{1}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{c}} + \\frac{1}{\\mu - \\lambda_{0}}$$\n$$L_1 = \\frac{2}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{c}}$$\n\n接下来，考虑非最小绕行路径，我们将其表示为路径 2。\n路径 2：$(0,0) \\rightarrow (0,1) \\rightarrow (1,1) \\rightarrow (1,2) \\rightarrow (0,2) \\rightarrow (0,3)$。\n该路径由 5 跳组成。问题陈述指出，该路径的构造使得数据包只经过到达速率为 $\\lambda_0$ 的链路。这是因为它明确地绕过了拥塞链路 $(0,1) \\rightarrow (0,2)$。因此，该路径上的 5 个链路各自的到达速率均为 $\\lambda_{0}$。\n\n路径 2 的总期望延迟，记为 $L_2$，是这五个相同链路上的期望逗留时间之和：\n$$L_2 = 5 \\times E[T_{\\text{uncongested}}]$$\n$$L_2 = \\frac{5}{\\mu - \\lambda_{0}}$$\n\n在建立了 $L_1$ 和 $L_2$ 的表达式后，我们可以解决问题的两个部分。\n\n1. 证明存在一个拥塞水平，当拥塞链路的拥塞水平高于该值时，非最小绕行路径更快。\n如果 $L_2  L_1$，则非最小路径（路径 2）的期望延迟低于最小路径（路径 1）。\n$$\\frac{5}{\\mu - \\lambda_{0}}  \\frac{2}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{c}}$$\n这个不等式取决于 $\\lambda_{c}$ 的值。让我们分析这两个延迟的行为。相对于 $\\lambda_{c}$，$L_2$ 是一个常数，因为它只依赖于 $\\mu$ 和 $\\lambda_{0}$。相比之下，$L_1$ 在其有效域 $[0, \\mu)$ 上是 $\\lambda_{c}$ 的严格递增函数。随着拥塞水平 $\\lambda_{c}$ 增加并接近服务速率 $\\mu$，项 $\\mu - \\lambda_{c}$ 从正方向趋近于 0，导致项 $\\frac{1}{\\mu - \\lambda_{c}}$ 无界增长。因此，$L_1$ 也无界增长。\n在指定链路可能的最低拥塞水平，即 $\\lambda_c = \\lambda_0$（对应于 $a+b=0$）时，最小路径的延迟为：\n$$L_1(\\lambda_c = \\lambda_0) = \\frac{2}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{0}} = \\frac{3}{\\mu - \\lambda_{0}}$$\n在这种情况下，$L_1 = \\frac{3}{\\mu - \\lambda_{0}}  \\frac{5}{\\mu - \\lambda_{0}} = L_2$，因此最小路径更快，符合预期。\n然而，由于 $L_1$ 随 $\\lambda_{c}$ 单调无界增长，而 $L_2$ 保持不变，必然存在一个 $\\lambda_{c}$ 的值，使得 $L_1$ 超过 $L_2$。这证实了对于足够高的拥塞水平，非最小路径确实会产生更低的期望延迟。\n\n2. 计算精确的阈值 $\\lambda_{c}^{\\star}$。\n阈值 $\\lambda_{c}^{\\star}$ 是指拥塞链路到达速率的一个特定值，在该值下，两条路径的期望延迟相等，即 $L_1 = L_2$。对于任何 $\\lambda_c > \\lambda_c^{\\star}$，我们都会有 $L_1 > L_2$。\n令两个延迟表达式相等：\n$$\\frac{2}{\\mu - \\lambda_{0}} + \\frac{1}{\\mu - \\lambda_{c}^{\\star}} = \\frac{5}{\\mu - \\lambda_{0}}$$\n为了求解 $\\lambda_{c}^{\\star}$，我们首先分离出包含它的项：\n$$\\frac{1}{\\mu - \\lambda_{c}^{\\star}} = \\frac{5}{\\mu - \\lambda_{0}} - \\frac{2}{\\mu - \\lambda_{0}}$$\n$$\\frac{1}{\\mu - \\lambda_{c}^{\\star}} = \\frac{3}{\\mu - \\lambda_{0}}$$\n现在，对等式两边取倒数：\n$$\\mu - \\lambda_{c}^{\\star} = \\frac{\\mu - \\lambda_{0}}{3}$$\n最后，我们求解 $\\lambda_{c}^{\\star}$：\n$$\\lambda_{c}^{\\star} = \\mu - \\frac{\\mu - \\lambda_{0}}{3}$$\n合并右侧的项，得到最终的闭式表达式：\n$$\\lambda_{c}^{\\star} = \\frac{3\\mu - (\\mu - \\lambda_{0})}{3} = \\frac{3\\mu - \\mu + \\lambda_{0}}{3}$$\n$$\\lambda_{c}^{\\star} = \\frac{2\\mu + \\lambda_{0}}{3}$$\n这是拥塞链路上的阈值到达速率。对于任何 $\\lambda_c > \\lambda_{c}^{\\star}$，就期望延迟而言，非最小路径成为更优的选择。条件 $\\lambda_c  \\lambda_c^{\\star}$ 意味着最小路径更快，而在 $\\lambda_c = \\lambda_c^{\\star}$ 时，两条路径具有相同的期望延迟。",
            "answer": "$$\\boxed{\\frac{2\\mu + \\lambda_{0}}{3}}$$"
        }
    ]
}