{
    "hands_on_practices": [
        {
            "introduction": "At the heart of any clock recovery system lies the voltage-controlled oscillator (VCO), the component responsible for generating the recovered clock. To design a stable and high-performance loop, it is essential to first understand the VCO's fundamental characteristics. This practice guides you through deriving the VCO's gain, $K_{vco}$, and its phase noise profile, $L(\\Delta f)$, from its physical structure, providing a crucial link between circuit-level parameters and system-level performance. ",
            "id": "4259653",
            "problem": "A clock and data recovery architecture employs a ring Voltage-Controlled Oscillator (VCO) comprising $N$ identical, current-starved delay stages. Each stage drives an effective load capacitance $C_{L}$ and exhibits a full-swing voltage excursion $V_{s}$ over each transition. The bias network sets the per-stage bias current $I$ through a control voltage $V_{b}$, with small-signal transconductance $\\alpha = \\partial I / \\partial V_{b}$ that is approximately constant over the operating range of interest. Assume the propagation delay per stage arises from charging or discharging the load capacitance at approximately constant current, so that the delay follows directly from the capacitor current law.\n\nThe oscillator runs at a fundamental frequency set by the loop propagation around the ring. You may treat the stages as identical and the waveform as periodic and stationary in the absence of noise, with sufficiently large amplitude regulation that amplitude perturbations do not significantly couple into phase at the offsets considered.\n\nIn addition to bias control, the oscillator experiences device noise in each stage. Model the dominant device noise contributions at the output nodes of the $N$ stages as zero-mean, wide-sense stationary current noise sources $i_{n,k}(t)$, $k=1,\\dots,N$, each with a one-sided power spectral density $S_{i,k}(\\Delta f)$ in $\\mathrm{A^{2}/Hz}$ evaluated at offset frequency $\\Delta f$ from the carrier. Let the Impulse Sensitivity Function (ISF) $\\Gamma_{k}(\\varphi)$ quantify the normalized phase sensitivity of the oscillator to an infinitesimal charge impulse injected at node $k$ when the oscillator is at phase $\\varphi$, over one period. Define the root-mean-square (rms) value of each ISF over a period $T$ by $\\Gamma_{k,\\mathrm{rms}} = \\sqrt{\\frac{1}{T}\\int_{0}^{T}\\Gamma_{k}^{2}(\\varphi(t))\\,\\mathrm{d}t}$.\n\nStarting from fundamental capacitor charging and delay concepts and the definition of phase from time shift, derive:\n\n1. The VCO gain $K_{vco} = \\partial f_{\\mathrm{osc}} / \\partial V_{b}$ as a function of the bias transconductance $\\alpha$, the number of stages $N$, the load capacitance $C_{L}$, and the voltage swing $V_{s}$.\n\n2. The single-sideband phase noise $L(\\Delta f)$ in linear units per Hertz (dimensionless ratio per Hz), at an offset $\\Delta f$ from the carrier, due to the $N$ device noise sources acting through their ISFs. Express $L(\\Delta f)$ in terms of $\\Gamma_{k,\\mathrm{rms}}$, $S_{i,k}(\\Delta f)$, $C_{L}$, $V_{s}$, and $\\Delta f$, assuming identical $C_{L}$ and $V_{s}$ at all $N$ nodes.\n\nYour final answers must be closed-form analytical expressions. For $K_{vco}$, express your result in $\\mathrm{Hz/V}$. For $L(\\Delta f)$, express your result in linear scale per Hertz (do not use decibels). No numerical evaluation is required.",
            "solution": "The problem is found to be valid as it is scientifically grounded, well-posed, and objective. It presents a standard model of a ring oscillator VCO and asks for the derivation of its gain and phase noise based on fundamental principles and established theoretical frameworks (specifically, the Impulse Sensitivity Function model). All necessary parameters and definitions are provided.\n\nThe solution is presented in two parts as requested.\n\n### Part 1: Derivation of VCO Gain ($K_{vco}$)\n\nThe analysis begins by determining the propagation delay, $t_{pd}$, of a single delay stage. The problem states that this delay arises from charging or discharging the load capacitance, $C_{L}$, with a constant bias current, $I$, over the full voltage swing, $V_{s}$. Based on the fundamental capacitor current-voltage relationship $I = C \\frac{dV}{dt}$, for a constant current $I$, the time $\\Delta t$ required for a voltage change $\\Delta V$ across a capacitor $C$ is $\\Delta t = C \\frac{\\Delta V}{I}$. Applying this to a single stage, the propagation delay is:\n$$t_{pd} = \\frac{C_{L} V_{s}}{I}$$\n\nA ring oscillator's period of oscillation, $T_{osc}$, is determined by the total time it takes for a signal edge to propagate around the loop and for the cycle to complete. For a standard $N$-stage ring oscillator, the period is twice the total propagation delay of the $N$ stages.\n$$T_{osc} = 2 N t_{pd}$$\n\nSubstituting the expression for $t_{pd}$ gives the oscillation period in terms of the circuit parameters:\n$$T_{osc} = 2 N \\frac{C_{L} V_{s}}{I}$$\n\nThe fundamental frequency of oscillation, $f_{osc}$, is the reciprocal of the period:\n$$f_{osc} = \\frac{1}{T_{osc}} = \\frac{I}{2 N C_{L} V_{s}}$$\n\nThe VCO gain, $K_{vco}$, is defined as the sensitivity of the oscillation frequency to changes in the control voltage, $V_{b}$. We calculate this by taking the partial derivative of $f_{osc}$ with respect to $V_{b}$:\n$$K_{vco} = \\frac{\\partial f_{osc}}{\\partial V_{b}} = \\frac{\\partial}{\\partial V_{b}} \\left( \\frac{I}{2 N C_{L} V_{s}} \\right)$$\n\nThe parameters $N$, $C_{L}$, and $V_{s}$ are constants with respect to $V_{b}$. The bias current $I$ is a function of $V_{b}$. Therefore, we apply the chain rule:\n$$K_{vco} = \\frac{1}{2 N C_{L} V_{s}} \\frac{\\partial I}{\\partial V_{b}}$$\n\nThe problem defines the bias network's small-signal transconductance as $\\alpha = \\frac{\\partial I}{\\partial V_{b}}$. Substituting this definition into the expression for $K_{vco}$ yields the final result:\n$$K_{vco} = \\frac{\\alpha}{2 N C_{L} V_{s}}$$\n\n### Part 2: Derivation of Single-Sideband Phase Noise ($L(\\Delta f)$)\n\nThe phase noise is derived using the Impulse Sensitivity Function (ISF) framework. In this model, the phase deviation $\\phi(t)$ of the oscillator is the result of perturbations from noise sources. A noise current $i_{n,k}(t)$ injected at node $k$ causes a phase deviation governed by the ISF for that node, $\\Gamma_{k}(\\varphi)$. The resulting total phase deviation $\\phi(t)$ is the time-integrated effect of all noise currents, weighted by their respective ISFs and normalized by the maximum charge $q_{max}$ displaced across the node capacitance during a swing. For a swing of $V_{s}$ across a capacitance $C_{L}$, this charge is $q_{max} = C_{L} V_{s}$.\n\nThe phase evolution is described by:\n$$\\phi(t) = \\sum_{k=1}^{N} \\int_{-\\infty}^{t} \\frac{\\Gamma_{k}(\\omega_{osc} \\tau)}{C_{L} V_{s}} i_{n,k}(\\tau) d\\tau$$\nwhere $\\omega_{osc} = 2 \\pi f_{osc}$ is the angular frequency of oscillation. This equation shows that the phase $\\phi(t)$ is the output of a linear system whose input is the process $x(t) = \\sum_{k=1}^{N} \\frac{\\Gamma_{k}(\\omega_{osc}t)}{C_{L} V_{s}} i_{n,k}(t)$ and whose impulse response is that of an ideal integrator, $h(t) = u(t)$, which has a frequency response $H(\\Delta f) = \\frac{1}{j 2 \\pi \\Delta f}$.\n\nThe power spectral density (PSD) of the output is related to the PSD of the input by $S_{\\phi}(\\Delta f) = |H(\\Delta f)|^{2} S_{x}(\\Delta f)$. This relationship holds for the one-sided PSDs:\n$$S_{\\phi, \\text{one-sided}}(\\Delta f) = \\frac{1}{(2 \\pi \\Delta f)^{2}} S_{x, \\text{one-sided}}(\\Delta f)$$\n\nNext, we find the one-sided PSD of the input process, $S_{x, \\text{one-sided}}(\\Delta f)$. The noise sources $i_{n,k}(t)$ are assumed to be wide-sense stationary and uncorrelated. Therefore, the PSD of the sum is the sum of the PSDs of the individual terms:\n$$S_{x, \\text{one-sided}}(\\Delta f) = \\sum_{k=1}^{N} \\text{PSD}\\left[\\frac{\\Gamma_{k}(\\omega_{osc}t)}{C_{L} V_{s}} i_{n,k}(t)\\right]$$\n\nEach term is the product of a stationary random process $i_{n,k}(t)$ and a deterministic periodic function $\\frac{\\Gamma_{k}(\\omega_{osc}t)}{C_{L} V_{s}}$. The resulting process is cyclostationary. For offset frequencies $\\Delta f$ that are small compared to $f_{osc}$, the time-averaged PSD of this product is approximately the PSD of the noise scaled by the mean-square value of the periodic function. The mean-square value of $\\frac{\\Gamma_{k}(\\omega_{osc}t)}{C_{L} V_{s}}$ over one period $T$ is:\n$$\\left\\langle \\left(\\frac{\\Gamma_{k}(\\omega_{osc}t)}{C_{L} V_{s}}\\right)^{2} \\right\\rangle = \\frac{1}{(C_{L} V_{s})^{2}} \\frac{1}{T} \\int_{0}^{T} \\Gamma_{k}^{2}(\\varphi(t)) dt$$\nThe problem defines the rms value of the ISF as $\\Gamma_{k,\\mathrm{rms}} = \\sqrt{\\frac{1}{T}\\int_{0}^{T}\\Gamma_{k}^{2}(\\varphi(t)) dt}$, so $\\Gamma_{k,\\mathrm{rms}}^{2} = \\frac{1}{T}\\int_{0}^{T}\\Gamma_{k}^{2}(\\varphi(t)) dt$. Thus, the scaling factor is $\\frac{\\Gamma_{k,\\mathrm{rms}}^{2}}{(C_{L} V_{s})^{2}}$.\n\nThe PSD of the sum $x(t)$ becomes:\n$$S_{x, \\text{one-sided}}(\\Delta f) = \\sum_{k=1}^{N} \\frac{\\Gamma_{k,\\mathrm{rms}}^{2}}{(C_{L} V_{s})^{2}} S_{i,k}(\\Delta f)$$\nwhere $S_{i,k}(\\Delta f)$ is the given one-sided PSD of the current noise source at node $k$.\n\nSubstituting this into the expression for the phase PSD gives:\n$$S_{\\phi, \\text{one-sided}}(\\Delta f) = \\frac{1}{(2 \\pi \\Delta f)^{2}} \\frac{1}{(C_{L} V_{s})^{2}} \\sum_{k=1}^{N} \\Gamma_{k,\\mathrm{rms}}^{2} S_{i,k}(\\Delta f)$$\n\nThe single-sideband phase noise, $L(\\Delta f)$, is defined as half of the one-sided spectral density of the phase fluctuations:\n$$L(\\Delta f) = \\frac{1}{2} S_{\\phi, \\text{one-sided}}(\\Delta f)$$\n\nSubstituting the expression for $S_{\\phi, \\text{one-sided}}(\\Delta f)$ yields the final result for the phase noise:\n$$L(\\Delta f) = \\frac{1}{2} \\cdot \\frac{1}{4 \\pi^{2} (\\Delta f)^{2} (C_{L} V_{s})^{2}} \\sum_{k=1}^{N} \\Gamma_{k,\\mathrm{rms}}^{2} S_{i,k}(\\Delta f)$$\n$$L(\\Delta f) = \\frac{1}{8 \\pi^{2} (\\Delta f)^{2} (C_{L} V_{s})^{2}} \\sum_{k=1}^{N} \\Gamma_{k,\\mathrm{rms}}^{2} S_{i,k}(\\Delta f)$$",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{\\alpha}{2 N C_{L} V_{s}} & \\frac{1}{8 \\pi^{2} (\\Delta f)^{2} (C_{L} V_{s})^{2}} \\sum_{k=1}^{N} \\Gamma_{k,\\mathrm{rms}}^{2} S_{i,k}(\\Delta f) \\end{pmatrix}}$$"
        },
        {
            "introduction": "While ideal models are useful for initial understanding, real-world performance is often limited by component non-idealities. A classic impairment in charge-pump-based CDRs is the reference spur, which arises from mismatch in the charge pump currents. In this exercise, you will analyze how this circuit-level imperfection translates into periodic ripple on the VCO control voltage, ultimately degrading the spectral purity of the output clock. ",
            "id": "4259730",
            "problem": "Consider a clock and data recovery (CDR) loop realized as a charge-pump-based phase-locked loop (PLL). The phase-frequency detector (PFD) and charge pump (CP) generate alternating current pulses at the reference frequency $f_{\\mathrm{ref}}$ under lock. Due to a fractional mismatch between the CP source and sink currents, a residual periodic current at $f_{\\mathrm{ref}}$ is injected into the loop filter. The loop filter is a passive Type-II lead-lag network at the voltage-controlled oscillator (VCO) control node, consisting of a shunt capacitor $C_1$ to ground and a series branch of resistor $R_2$ with capacitor $C_2$ to ground.\n\nStarting from first principles:\n- Model the CP mismatch as a symmetric square-wave current $i_{\\mathrm{m}}(t)$ of amplitude $\\Delta I$ at frequency $f_{\\mathrm{ref}}$, and use Fourier series to obtain the amplitude of its fundamental at $f_{\\mathrm{ref}}$.\n- Use impedance and admittance of linear time-invariant (LTI) components to express the small-signal voltage ripple amplitude at the control node at $f_{\\mathrm{ref}}$ in terms of $R_2$, $C_2$, and $C_1$.\n- Model the VCO as a voltage-to-frequency converter with gain $K_{\\mathrm{VCO}}$ (in $\\mathrm{Hz}/\\mathrm{V}$), and treat the control voltage ripple at $f_{\\mathrm{ref}}$ as a small sinusoidal frequency modulation of the carrier. From sinusoidal frequency modulation theory, relate the first-order sideband amplitude at $\\pm f_{\\mathrm{ref}}$ to the modulation index $\\beta$ via Bessel functions of the first kind, and use the small-modulation approximation to obtain the spur level relative to the carrier.\n\nDerive the dependence of the control-voltage leakage at $f_{\\mathrm{ref}}$ on $R_2$ and $C_2$, clearly indicating how $R_2$ and $C_2$ shape the admittance seen by the injected current at $f_{\\mathrm{ref}}$ and thus the spur. Then, for the following parameters, compute the numerical spur level at $\\pm f_{\\mathrm{ref}}$ relative to the carrier in decibels referenced to carrier (dBc):\n\n- Reference frequency: $f_{\\mathrm{ref}} = 40\\,\\mathrm{MHz}$.\n- Charge pump nominal current: $I_{\\mathrm{CP}} = 250\\,\\mu\\mathrm{A}$.\n- Charge pump mismatch fraction: $\\varepsilon = 0.02$, so $\\Delta I = \\varepsilon I_{\\mathrm{CP}}$.\n- Loop filter components: $C_1 = 8\\,\\mathrm{pF}$, $R_2 = 800\\,\\Omega$, $C_2 = 4\\,\\mathrm{pF}$.\n- VCO gain: $K_{\\mathrm{VCO}} = 120\\,\\mathrm{MHz}/\\mathrm{V}$.\n\nAssume the loop is locked, the ripple couples to the VCO control node quasi-open-loop at $f_{\\mathrm{ref}}$, and the small-modulation approximation is valid. Round your final numerical answer to four significant figures and express it in dBc.",
            "solution": "The problem requires the calculation of the reference spur level in a charge-pump Phase-Locked Loop (PLL) due to charge-pump current mismatch. The solution is developed in four stages: 1. Modeling the mismatch current; 2. Calculating the resulting voltage ripple on the VCO control node by analyzing the loop filter impedance; 3. Modeling the VCO as a frequency modulator to find the relationship between voltage ripple and output spur level; 4. Performing the numerical calculation for the given parameters.\n\n**Step 1: Charge-Pump Mismatch Current**\nA mismatch between the source and sink currents in the charge pump results in a net current being injected into the loop filter even when the loop is locked. When the Phase-Frequency Detector (PFD) duty cycle is $50\\%$, this net current is a symmetric square wave. The problem models this current, $i_{\\mathrm{m}}(t)$, as a symmetric square wave with amplitude $\\Delta I$ and frequency $f_{\\mathrm{ref}}$. The value of $\\Delta I$ is given by the mismatch fraction $\\varepsilon$ and the nominal charge-pump current $I_{\\mathrm{CP}}$:\n$$ \\Delta I = \\varepsilon I_{\\mathrm{CP}} $$\nA symmetric square wave of amplitude $\\Delta I$ and period $T_{\\mathrm{ref}} = 1/f_{\\mathrm{ref}}$ can be expressed by its Fourier series:\n$$ i_{\\mathrm{m}}(t) = \\frac{4\\Delta I}{\\pi} \\sum_{n=1,3,5,...}^{\\infty} \\frac{1}{n} \\sin(n \\omega_{\\mathrm{ref}} t) $$\nwhere $\\omega_{\\mathrm{ref}} = 2\\pi f_{\\mathrm{ref}}$. The fundamental component of this current, at frequency $f_{\\mathrm{ref}}$, has an amplitude $I_{\\mathrm{m1}}$ given by:\n$$ I_{\\mathrm{m1}} = \\frac{4\\Delta I}{\\pi} = \\frac{4 \\varepsilon I_{\\mathrm{CP}}}{\\pi} $$\n\n**Step 2: Control Voltage Ripple**\nThis periodic current $i_{\\mathrm{m}}(t)$ is injected into the loop filter, creating a voltage ripple $v_{\\mathrm{ctrl}}(t)$ at the VCO control node. According to the problem statement, we are interested in the component at $f_{\\mathrm{ref}}$ and can assume the loop does not suppress this ripple (quasi-open-loop analysis). The amplitude of the fundamental voltage ripple, $V_{\\mathrm{ctrl1}}$, is determined by the magnitude of the loop filter's impedance, $Z_{\\mathrm{LF}}(s)$, at $s=j\\omega_{\\mathrm{ref}}$.\n$$ V_{\\mathrm{ctrl1}} = I_{\\mathrm{m1}} |Z_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}})| $$\nThe loop filter is a passive, Type-II lead-lag network. It consists of a capacitor $C_1$ in parallel with the series combination of a resistor $R_2$ and a capacitor $C_2$. The impedance of this network is:\n$$ Z_{\\mathrm{LF}}(s) = \\frac{1}{Y_{\\mathrm{LF}}(s)} = \\frac{1}{sC_1 + \\frac{1}{R_2 + \\frac{1}{sC_2}}} = \\frac{1}{sC_1 + \\frac{sC_2}{1+sR_2C_2}} $$\nEvaluating at $s = j\\omega_{\\mathrm{ref}}$:\n$$ Z_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}}) = \\frac{1}{j\\omega_{\\mathrm{ref}}C_1 + \\frac{j\\omega_{\\mathrm{ref}}C_2}{1+j\\omega_{\\mathrm{ref}}R_2C_2}} $$\nThe admittance $Y_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}}) = 1/Z_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}})$ is shaped by both parallel branches. The `$R_2$-$C_2$` branch adds an admittance term $Y_2 = \\frac{j\\omega_{\\mathrm{ref}}C_2}{1+j\\omega_{\\mathrm{ref}}R_2C_2}$ to the admittance from $C_1$, which is $Y_1 = j\\omega_{\\mathrm{ref}}C_1$. This additional admittance from the $R_2$-$C_2$ branch increases the total admittance magnitude $|Y_{\\mathrm{LF}}|$, which in turn decreases the total impedance magnitude $|Z_{\\mathrm{LF}}|$. A lower impedance results in a smaller voltage ripple $V_{\\mathrm{ctrl1}}$ for a given injected current $I_{\\mathrm{m1}}$. Thus, $R_2$ and $C_2$ help suppress the reference spur leakage by providing an additional path to ground for the high-frequency mismatch current.\n\n**Step 3: VCO Modulation and Spur Level**\nThe voltage ripple $v_{\\mathrm{ctrl}}(t)$ frequency-modulates the VCO. The instantaneous frequency deviation from the carrier is $\\Delta f(t) = K_{\\mathrm{VCO}} v_{\\mathrm{ctrl}}(t)$. Considering only the fundamental component of the ripple, we have a sinusoidal modulation:\n$$ \\Delta f(t) \\approx K_{\\mathrm{VCO}} V_{\\mathrm{ctrl1}} \\sin(\\omega_{\\mathrm{ref}} t) $$\nThe peak frequency deviation is $\\Delta f_{\\mathrm{peak}} = K_{\\mathrm{VCO}} V_{\\mathrm{ctrl1}}$. The modulation index, $\\beta$, is the ratio of the peak frequency deviation to the modulating frequency, $f_{\\mathrm{ref}}$:\n$$ \\beta = \\frac{\\Delta f_{\\mathrm{peak}}}{f_{\\mathrm{ref}}} = \\frac{K_{\\mathrm{VCO}} V_{\\mathrm{ctrl1}}}{f_{\\mathrm{ref}}} $$\nThe spectrum of a sinusoidally frequency-modulated signal consists of a carrier and sidebands with amplitudes determined by Bessel functions of the first kind, $J_n(\\beta)$. The ratio of the first-order sideband amplitude (the spur at $\\pm f_{\\mathrm{ref}}$ from the carrier) to the carrier amplitude is $|J_1(\\beta)/J_0(\\beta)|$.\nFor a small modulation index ($\\beta \\ll 1$), we can use the approximations $J_0(\\beta) \\approx 1$ and $J_1(\\beta) \\approx \\beta/2$. The spur-to-carrier amplitude ratio is therefore approximately $\\beta/2$. The spur level, expressed in decibels relative to the carrier (dBc), is:\n$$ S_{\\mathrm{dBc}} = 20 \\log_{10}\\left(\\frac{\\beta}{2}\\right) $$\n\n**Step 4: Numerical Calculation**\nWe now substitute the given parameters into the derived equations.\n- Reference frequency: $f_{\\mathrm{ref}} = 40\\,\\mathrm{MHz} = 4 \\times 10^7\\,\\mathrm{Hz}$.\n- Charge pump nominal current: $I_{\\mathrm{CP}} = 250\\,\\mu\\mathrm{A} = 2.5 \\times 10^{-4}\\,\\mathrm{A}$.\n- Charge pump mismatch fraction: $\\varepsilon = 0.02$.\n- Loop filter components: $C_1 = 8\\,\\mathrm{pF} = 8 \\times 10^{-12}\\,\\mathrm{F}$, $R_2 = 800\\,\\Omega$, $C_2 = 4\\,\\mathrm{pF} = 4 \\times 10^{-12}\\,\\mathrm{F}$.\n- VCO gain: $K_{\\mathrm{VCO}} = 120\\,\\mathrm{MHz}/\\mathrm{V} = 1.2 \\times 10^8\\,\\mathrm{Hz}/\\mathrm{V}$.\n\nFirst, calculate the mismatch current amplitude $\\Delta I$:\n$$ \\Delta I = 0.02 \\times (2.5 \\times 10^{-4}\\,\\mathrm{A}) = 5 \\times 10^{-6}\\,\\mathrm{A} $$\nNext, find the amplitude of the fundamental current component, $I_{\\mathrm{m1}}$:\n$$ I_{\\mathrm{m1}} = \\frac{4 \\times (5 \\times 10^{-6}\\,\\mathrm{A})}{\\pi} = \\frac{20}{\\pi} \\times 10^{-6}\\,\\mathrm{A} \\approx 6.3662 \\times 10^{-6}\\,\\mathrm{A} $$\nNow, calculate the loop filter impedance magnitude at $f_{\\mathrm{ref}}$. The angular frequency is $\\omega_{\\mathrm{ref}} = 2\\pi f_{\\mathrm{ref}} = 2\\pi(4 \\times 10^7\\,\\mathrm{Hz}) = 8\\pi \\times 10^7\\,\\mathrm{rad/s}$.\nThe admittance of the filter is $Y_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}}) = j\\omega_{\\mathrm{ref}}C_1 + \\frac{j\\omega_{\\mathrm{ref}}C_2}{1+j\\omega_{\\mathrm{ref}}R_2C_2}$. Let's calculate the real and imaginary parts.\n$$ Y_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}}) = j\\omega_{\\mathrm{ref}}C_1 + \\frac{j\\omega_{\\mathrm{ref}}C_2(1-j\\omega_{\\mathrm{ref}}R_2C_2)}{1+(\\omega_{\\mathrm{ref}}R_2C_2)^2} = \\frac{\\omega_{\\mathrm{ref}}^2 R_2 C_2^2}{1+(\\omega_{\\mathrm{ref}}R_2C_2)^2} + j\\left(\\omega_{\\mathrm{ref}}C_1 + \\frac{\\omega_{\\mathrm{ref}}C_2}{1+(\\omega_{\\mathrm{ref}}R_2C_2)^2}\\right) $$\nLet's compute the dimensionless term $\\omega_{\\mathrm{ref}}R_2C_2$:\n$$ \\omega_{\\mathrm{ref}}R_2C_2 = (8\\pi \\times 10^7) \\times 800 \\times (4 \\times 10^{-12}) = 25600\\pi \\times 10^{-5} = 0.256\\pi \\approx 0.80425 $$\nNow compute the components of the admittance:\n$$ \\mathrm{Re}\\{Y_{\\mathrm{LF}}\\} = \\frac{(8\\pi \\times 10^7)^2 \\times 800 \\times (4 \\times 10^{-12})^2}{1+(0.80425)^2} \\approx \\frac{4.013 \\times 10^{-7}}{1.6468} \\approx 2.437 \\times 10^{-4}\\,\\mathrm{S} $$\nWait, an easier way is to use the values computed before:\n$$ \\mathrm{Re}\\{Y_{\\mathrm{LF}}\\} = \\frac{(\\omega_{\\mathrm{ref}}C_2) (\\omega_{\\mathrm{ref}}R_2C_2)}{1+(\\omega_{\\mathrm{ref}}R_2C_2)^2} = \\frac{(2\\pi \\times 4 \\times 10^7 \\times 4 \\times 10^{-12}) \\times 0.80425}{1.6468} = \\frac{(1.0053 \\times 10^{-3}) \\times 0.80425}{1.6468} \\approx 4.907 \\times 10^{-4}\\,\\mathrm{S} $$\n$$ \\mathrm{Im}\\{Y_{\\mathrm{LF}}\\} = (8\\pi \\times 10^7 \\times 8 \\times 10^{-12}) + \\frac{1.0053 \\times 10^{-3}}{1.6468} \\approx 2.0106 \\times 10^{-3} + 0.6104 \\times 10^{-3} = 2.621 \\times 10^{-3}\\,\\mathrm{S} $$\nThe magnitude of the admittance is:\n$$ |Y_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}})| = \\sqrt{(4.907 \\times 10^{-4})^2 + (2.621 \\times 10^{-3})^2} \\approx \\sqrt{2.408 \\times 10^{-7} + 6.869 \\times 10^{-6}} = \\sqrt{7.110 \\times 10^{-6}} \\approx 2.666 \\times 10^{-3}\\,\\mathrm{S} $$\nThe impedance magnitude is the reciprocal:\n$$ |Z_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}})| = \\frac{1}{|Y_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}})|} \\approx \\frac{1}{2.666 \\times 10^{-3}\\,\\mathrm{S}} \\approx 375.0\\,\\Omega $$\nThe amplitude of the control voltage ripple is:\n$$ V_{\\mathrm{ctrl1}} = I_{\\mathrm{m1}} |Z_{\\mathrm{LF}}(j\\omega_{\\mathrm{ref}})| \\approx (6.3662 \\times 10^{-6}\\,\\mathrm{A}) \\times (375.0\\,\\Omega) \\approx 0.002387\\,\\mathrm{V} $$\nNow, calculate the modulation index $\\beta$:\n$$ \\beta = \\frac{K_{\\mathrm{VCO}} V_{\\mathrm{ctrl1}}}{f_{\\mathrm{ref}}} = \\frac{(1.2 \\times 10^8\\,\\mathrm{Hz}/\\mathrm{V}) \\times (0.002387\\,\\mathrm{V})}{4 \\times 10^7\\,\\mathrm{Hz}} = 3 \\times 0.002387 \\approx 0.007161 $$\nSince $\\beta \\ll 1$, the small-modulation approximation is valid.\nFinally, calculate the spur level in dBc:\n$$ S_{\\mathrm{dBc}} = 20 \\log_{10}\\left(\\frac{\\beta}{2}\\right) \\approx 20 \\log_{10}\\left(\\frac{0.007161}{2}\\right) = 20 \\log_{10}(0.0035805) $$\n$$ S_{\\mathrm{dBc}} \\approx 20 \\times (-2.446) = -48.920\\,\\mathrm{dBc} $$\nRounding to four significant figures gives $-48.92\\,\\mathrm{dBc}$.",
            "answer": "$$\\boxed{-48.92}$$"
        },
        {
            "introduction": "Modern high-speed communication systems increasingly rely on all-digital or digitally-assisted PLLs for their flexibility and scalability. A key challenge in this domain is translating the well-established theory of continuous-time loop dynamics into a discrete-time digital implementation. This practice focuses on using the bilinear transform to design a digital proportional-integral (PI) filter that accurately emulates the desired second-order loop characteristics, $\\omega_n$ and $\\zeta$, a fundamental skill for any mixed-signal designer. ",
            "id": "4259696",
            "problem": "Consider a linearized clock and data recovery loop in which the phase-domain model consists of a phase detector with gain $K_{d}$ (output in a normalized control unit per radian), a digital proportionalâ€“integral (PI) filter $F(z)=K_{p}+K_{i}\\frac{z}{z-1}$ running with update period $T_{u}$, a digitally controlled oscillator (DCO) modeled as an integrator with gain $K_{v}$ (radian per second per normalized control unit), and a feedback divider of ratio $N$. Assume small-signal linear behavior and unity phase feedback.\n\nStarting from the bilinear (Tustin) transform definition $s=\\frac{2}{T_{u}}\\frac{z-1}{z+1}$, derive the equivalent continuous-time loop filter $F_{\\mathrm{eq}}(s)$ that matches the discrete-time PI $F(z)$ under the bilinear mapping. Using the continuous-time loop consisting of the phase detector, the equivalent PI loop filter, and the DCO, write the closed-loop characteristic equation in $s$ and identify the natural frequency $\\omega_{n}$ and damping ratio $\\zeta$ in terms of the loop gains. Proceed from first principles by:\n- Mapping $\\frac{z}{z-1}$ to the $s$-domain using the bilinear relation without invoking any shortcut formulas beyond the bilinear definition.\n- Modeling the DCO as a continuous-time integrator $\\frac{K_{v}/N}{s}$, and forming the unity-feedback closed-loop characteristic equation.\n- Matching the polynomial to the standard second-order form $s^{2}+2\\zeta\\omega_{n}s+\\omega_{n}^{2}$, and solving for $\\omega_{n}$ and $\\zeta$ symbolically.\n\nDefine the mapping error as the Euclidean norm of the relative error vector between the achieved $(\\omega_{n},\\zeta)$ and target continuous-time specifications $(\\omega_{n0},\\zeta_{0})$:\n$$E=\\sqrt{\\left(\\frac{\\omega_{n}-\\omega_{n0}}{\\omega_{n0}}\\right)^{2}+\\left(\\frac{\\zeta-\\zeta_{0}}{\\zeta_{0}}\\right)^{2}}.$$\nUse the following numerical values, representative of a multi-gigabit per second clock and data recovery loop:\n- $K_{d}=0.5$,\n- $K_{v}=2\\pi\\times 5\\times 10^{8}$,\n- $N=1$,\n- $T_{u}=1.0\\times 10^{-10}$,\n- $K_{p}=5.0\\times 10^{-3}$,\n- $K_{i}=1.6\\times 10^{-6}$,\n- $\\omega_{n0}=5.0\\times 10^{6}$ (radians per second),\n- $\\zeta_{0}=0.8$.\n\nCompute $E$ and express your final result as a single real number. Round your answer to four significant figures. The mapping error $E$ is dimensionless; no physical units are required for the final answer.",
            "solution": "The discrete-time PI filter is given by $F(z)=K_{p}+K_{i}\\frac{z}{z-1}$. Under the bilinear (Tustin) transform, the relation between $s$ and $z$ is\n$$\ns=\\frac{2}{T_{u}}\\frac{z-1}{z+1}.\n$$\nSolving this for $z$ gives\n$$\n\\frac{sT_{u}}{2}=\\frac{z-1}{z+1}\\quad\\Rightarrow\\quad z-1=\\frac{sT_{u}}{2}(z+1)\\quad\\Rightarrow\\quad z\\left(1-\\frac{sT_{u}}{2}\\right)=1+\\frac{sT_{u}}{2},\n$$\nand hence\n$$\nz=\\frac{1+\\frac{sT_{u}}{2}}{1-\\frac{sT_{u}}{2}}.\n$$\nWe map the discrete integrator term $\\frac{z}{z-1}$ to the $s$-domain using this expression. First compute $z-1$:\n$$\nz-1=\\frac{1+\\frac{sT_{u}}{2}}{1-\\frac{sT_{u}}{2}}-1=\\frac{\\left(1+\\frac{sT_{u}}{2}\\right)-\\left(1-\\frac{sT_{u}}{2}\\right)}{1-\\frac{sT_{u}}{2}}=\\frac{sT_{u}}{1-\\frac{sT_{u}}{2}}.\n$$\nTherefore,\n$$\n\\frac{z}{z-1}=\\frac{\\frac{1+\\frac{sT_{u}}{2}}{1-\\frac{sT_{u}}{2}}}{\\frac{sT_{u}}{1-\\frac{sT_{u}}{2}}}=\\frac{1+\\frac{sT_{u}}{2}}{sT_{u}}.\n$$\nSubstituting back into $F(z)$ yields the equivalent continuous-time loop filter under bilinear mapping:\n$$\nF_{\\mathrm{eq}}(s)=K_{p}+K_{i}\\frac{1+\\frac{sT_{u}}{2}}{sT_{u}}=K_{p}+\\frac{K_{i}}{sT_{u}}+\\frac{K_{i}}{2}.\n$$\nWe can group terms to interpret $F_{\\mathrm{eq}}(s)$ as a continuous-time PI:\n$$\nF_{\\mathrm{eq}}(s)=K_{p}^{\\prime}+\\frac{K_{i}^{\\prime}}{s},\\quad\\text{where}\\quad K_{p}^{\\prime}=K_{p}+\\frac{K_{i}}{2},\\quad K_{i}^{\\prime}=\\frac{K_{i}}{T_{u}}.\n$$\nNext, we form the loop dynamics. The DCO is modeled as an integrator with gain $\\frac{K_{v}}{N}$, thus its transfer function is $\\frac{K_{v}/N}{s}$. The open-loop transfer function from phase error to output phase is\n$$\nL(s)=K_{d}\\,F_{\\mathrm{eq}}(s)\\,\\frac{K_{v}/N}{s}=K_{d}\\left(K_{p}^{\\prime}+\\frac{K_{i}^{\\prime}}{s}\\right)\\frac{K_{v}/N}{s}.\n$$\nUnder unity phase feedback, the closed-loop characteristic equation is\n$$\n1+L(s)=0\\quad\\Rightarrow\\quad 1+K_{d}\\left(K_{p}^{\\prime}+\\frac{K_{i}^{\\prime}}{s}\\right)\\frac{K_{v}/N}{s}=0.\n$$\nMultiplying through by $s$ and rearranging to a monic polynomial yields\n$$\ns^{2}+s\\,K_{d}\\frac{K_{v}}{N}K_{p}^{\\prime}+K_{d}\\frac{K_{v}}{N}K_{i}^{\\prime}=0.\n$$\nComparing to the standard second-order form\n$$\ns^{2}+2\\zeta\\omega_{n}s+\\omega_{n}^{2}=0\n$$\ngives the identifications\n$$\n\\omega_{n}^{2}=K_{d}\\frac{K_{v}}{N}K_{i}^{\\prime}=K_{d}\\frac{K_{v}}{N}\\frac{K_{i}}{T_{u}},\\quad 2\\zeta\\omega_{n}=K_{d}\\frac{K_{v}}{N}K_{p}^{\\prime}=K_{d}\\frac{K_{v}}{N}\\left(K_{p}+\\frac{K_{i}}{2}\\right).\n$$\nSolving for $\\omega_{n}$ and $\\zeta$,\n$$\n\\omega_{n}=\\sqrt{K_{d}\\frac{K_{v}}{N}\\frac{K_{i}}{T_{u}}},\\quad \\zeta=\\frac{K_{d}\\frac{K_{v}}{N}\\left(K_{p}+\\frac{K_{i}}{2}\\right)}{2\\sqrt{K_{d}\\frac{K_{v}}{N}\\frac{K_{i}}{T_{u}}}}.\n$$\nThese are the continuous-time second-order parameters equivalent to the given digital PI filter under bilinear mapping.\n\nWe now compute the numerical values using the provided parameters:\n- $K_{d}=0.5$,\n- $K_{v}=2\\pi\\times 5\\times 10^{8}$,\n- $N=1$,\n- $T_{u}=1.0\\times 10^{-10}$,\n- $K_{p}=5.0\\times 10^{-3}$,\n- $K_{i}=1.6\\times 10^{-6}$,\n- $\\omega_{n0}=5.0\\times 10^{6}$,\n- $\\zeta_{0}=0.8$.\n\nCompute auxiliary quantities:\n$$\nK_{p}^{\\prime}=K_{p}+\\frac{K_{i}}{2}=5.0\\times 10^{-3}+0.8\\times 10^{-6}=5.0008\\times 10^{-3},\n$$\n$$\nK_{i}^{\\prime}=\\frac{K_{i}}{T_{u}}=\\frac{1.6\\times 10^{-6}}{1.0\\times 10^{-10}}=1.6\\times 10^{4},\n$$\nand\n$$\nP=K_{d}\\frac{K_{v}}{N}=0.5\\times \\left(2\\pi\\times 5\\times 10^{8}\\right)=0.5\\times 3.141592653589793\\times 10^{9}=1.5707963267948965\\times 10^{9}.\n$$\nThen\n$$\n\\omega_{n}=\\sqrt{P\\,K_{i}^{\\prime}}=\\sqrt{1.5707963267948965\\times 10^{9}\\times 1.6\\times 10^{4}}=\\sqrt{2.513274122871834\\times 10^{13}}\\approx 5.0132565\\times 10^{6},\n$$\nand\n$$\n\\zeta=\\frac{P\\,K_{p}^{\\prime}}{2\\,\\omega_{n}}=\\frac{1.5707963267948965\\times 10^{9}\\times 5.0008\\times 10^{-3}}{2\\times 5.0132565\\times 10^{6}}\\approx \\frac{7.85523827\\times 10^{6}}{1.00265130\\times 10^{7}}\\approx 0.78345.\n$$\nFinally, compute the mapping error\n$$\nE=\\sqrt{\\left(\\frac{\\omega_{n}-\\omega_{n0}}{\\omega_{n0}}\\right)^{2}+\\left(\\frac{\\zeta-\\zeta_{0}}{\\zeta_{0}}\\right)^{2}}.\n$$\nThe relative errors are\n$$\n\\frac{\\omega_{n}-\\omega_{n0}}{\\omega_{n0}}=\\frac{5.0132565\\times 10^{6}-5.0\\times 10^{6}}{5.0\\times 10^{6}}\\approx 2.6513\\times 10^{-3},\n$$\n$$\n\\frac{\\zeta-\\zeta_{0}}{\\zeta_{0}}=\\frac{0.78345-0.8}{0.8}\\approx -2.0691\\times 10^{-2}.\n$$\nThus\n$$\nE\\approx \\sqrt{\\left(2.6513\\times 10^{-3}\\right)^{2}+\\left(-2.0691\\times 10^{-2}\\right)^{2}}\\approx \\sqrt{7.03\\times 10^{-6}+4.28\\times 10^{-4}}\\approx \\sqrt{4.35\\times 10^{-4}}\\approx 2.086\\times 10^{-2}.\n$$\nRounded to four significant figures, the mapping error is\n$$\nE\\approx 0.02086.\n$$",
            "answer": "$$\\boxed{0.02086}$$"
        }
    ]
}