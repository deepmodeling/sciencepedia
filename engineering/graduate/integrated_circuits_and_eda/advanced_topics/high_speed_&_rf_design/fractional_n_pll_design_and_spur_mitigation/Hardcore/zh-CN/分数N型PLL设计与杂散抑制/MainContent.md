## 引言
在现代[无线通信](@entry_id:266253)和高速数据系统中，对频率源的精度和灵活性提出了前所未有的要求。分数N[锁相环](@entry_id:271717)（Fractional-N PLL）作为一种能够以极高分辨率合成频率的关键技术，已成为射频与[混合信号集成电路设计](@entry_id:270287)的核心。然而，其实现小数分频的核心机制——通过时间平均动态切换整数[分频](@entry_id:162771)比——也引入了一个根本性的挑战：周期性的[量化误差](@entry_id:196306)，这直接导致了被称为“杂散”（spurs）的有害[频谱](@entry_id:276824)分量，严重影响系统性能。如何理解、分析并有效抑制这些杂散，是PLL设计师面临的关键知识鸿沟。

本文旨在系统性地解决这一挑战，为读者构建一个从理论到实践的完整知识框架。在接下来的章节中，我们将首先深入“原理与机制”，剖析分数杂散的产生根源，建立PLL的线性模型，并探讨电路级非理想性如何转化为杂散。随后，我们将在“应用与跨学科联系”中，将理论应用于系统级[设计优化](@entry_id:748326)、仿真表征和先进的校准技术，并探索其在[数字信号处理](@entry_id:263660)、控制理论等相关领域的交叉应用。最后，通过一系列“动手实践”练习，巩固和深化所学知识。通过这一结构化的学习路径，读者将全面掌握分数N[锁相环](@entry_id:271717)的设计精髓与[杂散抑制](@entry_id:1132234)的实用策略。

## 原理与机制

在上一章中，我们介绍了分数N分频[锁相环](@entry_id:271717)（Fractional-N PLL）的基本概念和应用背景。本章将深入探讨其工作的核心原理与关键机制，系统性地剖析杂散（spur）的产生根源，并阐述相应的分析与抑制方法。我们将从分数N分频的基本思想出发，逐步建立一个完整的理论框架，用以理解和解决分数N锁相环设计中的核心挑战。

### 分数N综合的基础：量化误差

锁相环的基本功能是通过一个反馈回路，使得[压控振荡器](@entry_id:265947)（VCO）的输出频率$f_{\mathrm{out}}$与一个高稳定度的参考频率$f_{\mathrm{ref}}$建立精确的倍数关系。在传统的整数N锁相环（Integer-N PLL）中，反馈路径中的[分频器](@entry_id:177929)具有固定的整数分频比$N$，因此输出频率被严格限制为$f_{\mathrm{out}} = N \cdot f_{\mathrm{ref}}$。这种架构的主要杂散来源是[鉴相器](@entry_id:266236)（PFD）和电荷泵（CP）等模块在参考频率$f_{\mathrm{ref}}$下的周期性非理想行为，例如[电荷泵](@entry_id:1122300)电流失配和[时钟馈通](@entry_id:170725)，这会在输出[频谱](@entry_id:276824)上产生位于[载波](@entry_id:261646)频率两侧、偏移量为$f_{\mathrm{ref}}$整数倍（$\pm k f_{\mathrm{ref}}$）的**[参考杂散](@entry_id:1130774)**（reference spurs）。

然而，现代[通信系统](@entry_id:265921)要求更高的频率分辨率，即能够合成非参考频率整数倍的频率。分数N锁相环应运而生，其目标是实现$f_{\mathrm{out}} = (N+\alpha) \cdot f_{\mathrm{ref}}$的频率关系，其中$N$为整数部分，$\alpha$ ($0 \lt \alpha \lt 1$)为小数部分。实现这一目标的核心思想是**[时间平均](@entry_id:267915)**（time-averaging）。由于不存在可以直接进行分数分频的物理器件，分数N[锁相环](@entry_id:271717)通过在不同时间采用不同的整数[分频](@entry_id:162771)比，使得其时间平均值等于期望的分数$N+\alpha$。最常见的方法是在[分频](@entry_id:162771)比$N$和$N+1$之间动态切换。例如，要实现一个平均分频比$N+\alpha$，可以在$P$个参考周期内，$m$次采用$N+1$分频，$(P-m)$次采用$N$分频，其中$\alpha = m/P$ 。

这种切换操作引入了一个根本性的问题：**量化误差**（quantization error）。在任意时刻$n$，瞬时分频比$N_{\mathrm{inst}}[n]$是一个整数（例如$N$或$N+1$），而期望的[分频](@entry_id:162771)比是$N+\alpha$。这两者之差，即$e[n] = (N_{\mathrm{inst}}[n] - N) - \alpha$，构成了分频比的量化误差序列。这个误差序列直接扰动PLL的反馈环路，是分数N锁相环中一类关键杂散——**分数杂散**（fractional spurs）——的根源。

为了理解分数杂散的产生机制，我们首先分析最简单的情况。假设小数部分$\alpha$是一个有理数，可表示为最简分数形式$\alpha=p/q$。控制分频比切换的序列通常由一个数字[累加器](@entry_id:175215)产生，这等效于一个最简单的一阶ΔΣ调制器（DSM）。[累加器](@entry_id:175215)的状态$s[n]$按照$s[n] = \{s[n-1] + \alpha\}$进行更新，其中$\{\cdot\}$表示取小数部分。可以证明，当输入为有理数$\alpha=p/q$时，[累加器](@entry_id:175215)的状态序列$s[n]$以及由此产生的量化误差序列$e[n]$都是周期性的，其基波周期为$q$个参考[时钟周期](@entry_id:165839) 。例如，对于一个由$x_0=0$开始，输入为$\alpha = \frac{137}{512}$的一阶DSM，其输出序列的重复周期$L$等于分母$512$ 。

这个周期为$q$、以$f_{\mathrm{ref}}$速率采样的离散误差序列，在频域上表现为一系列离散的谱线，其频率位于$f_{\mathrm{ref}}/q$的整数倍处。当这个误差序列通过PLL环路调制VCO时，便会在输出[频谱](@entry_id:276824)的载波$f_{\mathrm{out}}$两侧，产生偏移量为$\pm k \cdot f_{\mathrm{ref}}/q$的离散杂散，即分数杂散。由于$q$值可能很大，这些杂散的[频率偏移](@entry_id:266447)可能非常小，甚至落在PLL的环路带宽之内，从而无法被环路滤波器有效滤除。

### 锁相环线性模型与杂散的传递

为了定量分析上述误差如何转化为输出杂散，我们需要建立PLL的线性化模型。在[锁定状态](@entry_id:163103)附近，对于小的相位扰动，PLL可以被视为一个[线性时不变](@entry_id:276287)（LTI）系统。其关键组成模块的增益定义如下：

- **鉴相器/[电荷泵](@entry_id:1122300)增益 ($K_{\phi}$)**：该模块将输入端的相位误差$\Delta\phi$（单位：rad）转换为注入[环路滤波器](@entry_id:275178)的平均电流$\bar{I}_{\mathrm{out}}$（单位：A）。对于一个理想的三态[鉴相器](@entry_id:266236)和[电荷泵](@entry_id:1122300)，当存在一个小的静态[相位误差](@entry_id:162993)$\Delta\phi$时，PFD会产生一个宽度为$\Delta t = \Delta\phi \cdot T_{\mathrm{ref}} / (2\pi)$的脉冲，驱动[电荷泵](@entry_id:1122300)在每个参考周期$T_{\mathrm{ref}}$内注入或吸出电荷。平均电流为$\bar{I}_{\mathrm{out}} = (I_{\mathrm{cp}} \cdot \Delta t) / T_{\mathrm{ref}} = (I_{\mathrm{cp}} / 2\pi) \Delta\phi$。因此，总增益为$K_{\phi} = I_{\mathrm{cp}}/(2\pi)$，单位是A/rad。在模型中，这通常被分解为[鉴相器](@entry_id:266236)增益**$K_{pd} = 1/(2\pi)$**（单位：1/rad，代表从[相位误差](@entry_id:162993)到归一化脉冲宽度的转换）和电荷泵增益**$K_{cp} = I_{cp}$**（单位：A）。这个增益直接决定了环路对相位噪声的敏感度，包括来自DSM的量化相位误差。

- **[压控振荡器](@entry_id:265947)增益 ($K_{VCO}$)**：VCO将控制电压$V_{\mathrm{ctrl}}$的变化转换为输出[角频率](@entry_id:261565)$\omega_{\mathrm{out}}$的变化，其增益定义为 **$K_{VCO} = \frac{d\omega_{\mathrm{out}}}{dV_{\mathrm{ctrl}}}$**，单位是(rad/s)/V 。由于输出相位$\phi_{\mathrm{out}}$是角频率的时间积分（$\phi_{\mathrm{out}}(t) = \int \omega_{\mathrm{out}}(t) dt$），在拉普拉斯域中，VCO作为一个从控制电压到输出相位的[积分器](@entry_id:261578)，其传递函数为$\frac{\Phi_{\mathrm{out}}(s)}{V_{\mathrm{ctrl}}(s)} = \frac{K_{VCO}}{s}$。在实际应用中，$K_{VCO}$也常用单位Hz/V表示，记为$K_{VCO,Hz}$，两者关系为$K_{VCO} = 2\pi K_{VCO,Hz}$。

基于这些定义，PLL的[开环传递函数](@entry_id:276280)可以表示为$L(s) = K_{\phi} \cdot Z(s) \cdot \frac{K_{VCO}}{s}$，其中$Z(s)$是[环路滤波器](@entry_id:275178)的阻抗。这个模型清晰地揭示了杂散的传递路径：任何在VCO控制节点上产生的周期性电压纹波$v_r(t) = V_r\cos(\omega_m t)$，都会通过VCO的频率调制效应，在输出端产生[相位调制](@entry_id:262420)。所产生的峰值[相位偏移](@entry_id:276073)（[调制指数](@entry_id:267497)）为$\beta = \frac{K_{VCO} V_r}{\omega_m}$。对于小的[调制指数](@entry_id:267497)，这会在载波两侧产生幅度近似为$\beta/2$的杂散[边带](@entry_id:261079)。

例如，考虑一个PLL，其参考频率$f_{\mathrm{ref}} = 25\,\mathrm{MHz}$，VCO增益$K_{\mathrm{VCO}} = 50\,\mathrm{MHz/V}$。如果在VCO控制节点上测量到一个[均方根值](@entry_id:276804)为$V_{\mathrm{r,rms}}=2\,\mathrm{mV}$的$25\,\mathrm{MHz}$正弦纹波，我们可以计算出其造成的[参考杂散](@entry_id:1130774)电平。该纹波的峰值电压为$V_{\mathrm{r,pk}} = V_{\mathrm{r,rms}}\sqrt{2} \approx 2.828\,\mathrm{mV}$。对应的[调制指数](@entry_id:267497)为$\beta = \frac{2\pi K_{\mathrm{VCO,Hz}}V_{\mathrm{r,pk}}}{2\pi f_{\mathrm{ref}}} = \frac{(50 \times 10^6\,\mathrm{Hz/V}) \times (2\sqrt{2} \times 10^{-3}\,\mathrm{V})}{25 \times 10^6\,\mathrm{Hz}} = 4\sqrt{2} \times 10^{-3}$。因此，杂散电平约为$20\log_{10}(\beta/2) = 20\log_{10}(2\sqrt{2} \times 10^{-3}) \approx -51\,\mathrm{dBc}$ 。这个计算过程清晰地展示了从控制节点上的电压纹波到最终输出[频谱](@entry_id:276824)上杂散电平的直接转换关系。

### 电路非理想性导致的杂散机制

理论模型中的误差源在实际电路中表现为各种非理想性。下面我们探讨几种典型的电路级杂散产生机制。

#### [电荷泵失配](@entry_id:1122302)与不对称性

电荷泵的非理想性是产生[参考杂散](@entry_id:1130774)和分数杂散的重要原因。考虑一个分数比$\alpha$接近0.5的场景，此时DSM会产生一个近似交替的“加一”、“减一”相位误差序列，导致PFD和CP交替地产生UP和DOWN脉冲。在一个理想系统中，如果UP和DOWN脉冲的宽度和电流大小完全对称，注入和抽出的电荷将相互抵消。然而，在实际电路中：

1.  **电流失配**：由于工艺偏差，UP电流源的电流$I_{\mathrm{U}}$和DOWN[电流源](@entry_id:275668)的电流$I_{\mathrm{D}}$通常不完全相等。
2.  **时序不对称**：电流脉冲的上升时间($t_{r}$)和下降时间($t_{f}$)也可能不对称，导致电流波形并非理想的矩形。

这两种效应共同导致在交替的UP/DOWN周期中，净注入电荷不为零。例如，在一个UP周期内注入的电荷$Q_{\mathrm{U}}$（考虑梯形脉冲）和在一个DOWN周期内抽出的电荷$|Q_{\mathrm{D}}|$不相等。这种交替的[电荷注入](@entry_id:1122296)序列$(Q_{\mathrm{U}}, Q_{\mathrm{D}}, Q_{\mathrm{U}}, \dots)$的周期为$2T_{\mathrm{ref}}$，其基波频率为$f_{\mathrm{ref}}/2$。这个基波分量会在环路滤波电容上产生一个对应频率的[电压纹波](@entry_id:1133886)，最终在VCO输出端形成一个偏移量为$f_{\mathrm{ref}}/2$的杂散。通过对交替电荷序列进行傅里叶分析，可以精确推导出该杂散的幅度，其大小与电荷差$|Q_{\mathrm{U}} - Q_{\mathrm{D}}|$成正比，而电荷差则由$I_{\mathrm{U}}$、$I_{\mathrm{D}}$以及各自的上升/下降时间共同决定 。

#### 多模[分频器](@entry_id:177929)（MMD）的延时失配

MMD本身也可能是一个杂散源。当MMD在不同分频比（如$N$和$N+1$）下工作时，其内部逻辑路径的传播延时可能存在差异。这种**模值相关延时**（modulus-dependent delay）会引入一个与DSM输出序列$a[n]$直接相关的[相位误差](@entry_id:162993)。例如，当$a[n]=1$（选择分频比$N+1$）时，如果MMD的延时比$a[n]=0$时多出$\delta t$，就会在每个$a[n]=1$的周期注入一个大小为$2\pi f_{\mathrm{out}} \delta t$的相位误差。由于这个误差序列的模式完全由周期为$L$的DSM序列决定，它会直接在$k \cdot f_{\mathrm{ref}}/L$的[频率偏移](@entry_id:266447)处产生杂散 。

#### 周期性误差的互调

更复杂的情况是，电路中可能存在多个独立的周期性误差源，它们的相互作用会产生**互调杂散**（intermodulation spurs）。一个典型的例子是，一个采用了周期性元件选择方案（如循环使用8个单位电流源，周期$P=8$）的电荷泵，其固有的元件失配会产生一个周期为$P$的电流误差序列$e_c[n]$。同时，DSM的输出序列$a[n]$诱导的PFD[脉冲序列](@entry_id:1132157)$p[n]$具有周期$L$（例如$L=64$）。在环路中，总的误差电荷与这两者的乘积相关，即$e_{\mathrm{total}}[n] \propto p[n] \cdot e_c[n]$。

时域中的乘法对应于频域中的卷积。$p[n]$的[频谱](@entry_id:276824)包含$f_{\mathrm{ref}}/L$的[谐波](@entry_id:181533)，而$e_c[n]$的[频谱](@entry_id:276824)包含$f_{\mathrm{ref}}/P$的谐波。两者卷积后，会在输出[频谱](@entry_id:276824)上产生位于和频与差频处的互调杂散，其[频率偏移](@entry_id:266447)为$|k_1 \frac{f_{\mathrm{ref}}}{L} \pm k_2 \frac{f_{\mathrm{ref}}}{P}|$。例如，对于$f_{\mathrm{ref}}=50\,\mathrm{MHz}$，$L=64$，$P=8$，基波互调杂散会出现在$|6.25 \pm 0.78125|\,\mathrm{MHz}$，即$5.46875\,\mathrm{MHz}$和$7.03125\,\mathrm{MHz}$附近 。这解释了为什么在实际PLL的[频谱](@entry_id:276824)中，除了预期的基波分数杂散外，还会观察到其他复杂的杂散成分。

### [杂散抑制](@entry_id:1132234)技术

理解了杂散的产生机制后，我们便可以探讨相应的抑制技术。这些技术的核心思想是打破误差产生的周期性，或者将误差能量转移到环路可以滤除的频段。

#### ΔΣ调制与噪声整形

分数N综合中最核心的[杂散抑制](@entry_id:1132234)技术就是**ΔΣ调制**（Delta-Sigma Modulation）。如前所述，一个简单的[累加器](@entry_id:175215)会产生周期性的[量化误差](@entry_id:196306)。而高阶的ΔΣ调制器则通过引入反馈，对[量化噪声](@entry_id:203074)进行**[频谱](@entry_id:276824)整形**（spectral shaping）。一个$M$阶DSM的噪声传递函数（NTF）具有高通特性，近似为$(1-z^{-1})^M$。这意味着[量化噪声](@entry_id:203074)的能量被从低频（带内）推向高频（带外）。

由于PLL本身是一个低通系统，其环路带宽通常远低于参考频率。通过将DSM[量化噪声](@entry_id:203074)的能量整形到远高于环路带宽的频率，大部分噪声能量可以被PLL的[环路滤波器](@entry_id:275178)有效抑制。因此，ΔΣ调制器将原本集中在离散分数杂散频率上的能量，转化为一段被高通整形的、类似噪声的宽带[频谱](@entry_id:276824)，从而显著降低带内杂散的幅度 。

#### [抖动](@entry_id:200248)（Dither）

尽管高阶DSM能有效进行噪声整形，但在输入为常数（如分数N PLL中的$\alpha$）时，它们仍然可能陷入**极限环**（limit cycles），即其状态和输出序列呈现长周期的重复模式，这依然会导致离散的杂散，也称为**空闲音**（idle tones）。为了打破这种确定性的周期行为，可以引入**[抖动](@entry_id:200248)**（dither）技术。

[抖动](@entry_id:200248)是在量化器的输入端注入一个小的、零均值的随机信号$d[n]$。其核心作用是**随机化量化过程**。根据信号处理理论（如Schuchman条件），如果[抖动信号](@entry_id:177752)的统计特性选择得当（例如，其[概率密度函数](@entry_id:140610)覆盖一个量化阶跃），那么量化误差$e[n]$就可以变得与输入信号统计无关，其[频谱](@entry_id:276824)也会变得平坦（白化）。这将彻底打破[极限环](@entry_id:274544)，将离散的杂散能量转化为宽带噪声能量。当然，这是有代价的：总的带内噪声基底会有所抬高。本质上，[抖动](@entry_id:200248)技术是用一个可控的、[频谱](@entry_id:276824)特性更好的宽带噪声，去取代有害的、离散的杂散音 。

#### 动态元件匹配（DEM）

动态元件匹配（Dynamic Element Matching, DEM）是专门用于解决由单元元件（如CP中的单位电流源、MMD中的单位延迟单元）失配所引起杂散的技术。静态失配之所以产生杂散，是因为特定的（有误差的）单元元件被与DSM序列相关联地重复使用。

DEM的核心思想是**通过置换（permuting）单元元件的使用顺序来打破这种相关性**。例如，如果CP需要输出3个单位的电流，D[EM算法](@entry_id:274778)会动态地选择使用哪3个单位电流源，而不是每次都固定使用某3个。通过循环或伪随机地轮换所有可用的单元元件，使得每个单元元件被使用的频率趋于一致。从效果上看，DEM将静态的元件失配向量$\{\delta I_i\}$转换成一个时变的误差序列$e_{\mathrm{cp}}[k]$。与DSM类似，一个设计良好的D[EM算法](@entry_id:274778)可以对此误差序列进行[频谱](@entry_id:276824)整形，使其具有高通特性，将失配能量推向高频区域。这样，由元件失配引起的误差同样可以被PLL的低通环路所滤除 。

### 杂散对系统性能的影响

我们投入大量精力来抑制杂散，根本原因在于其对系统性能的严重影响。杂散在时域上对应于**[确定性抖动](@entry_id:1123600)**（deterministic jitter, DJ）。一个位于载波两侧、偏移量为$f_s$、电平为$L_{spur}$ (dBc)的杂散，对应于一个频率为$f_s$的正弦[相位调制](@entry_id:262420)。这个[相位调制](@entry_id:262420)直接转化为时钟沿的周期性定时误差。

该定时误差的峰峰值$\Delta t_{p-p}$可以通过以下关系计算：首先由杂散电平$L_{spur}$推算出峰值相位偏移$\Delta\phi_{\mathrm{peak}}$，然后通过$\Delta t_{p-p} = 2 \cdot \frac{\Delta\phi_{\mathrm{peak}}}{2\pi f_o}$得到。例如，一个在$2.4\,\mathrm{GHz}$[载波](@entry_id:261646)上，偏移$20\,\mathrm{MHz}$、电平为$-50\,\mathrm{dBc}$的杂散，会产生一个峰峰值约为$0.84\,\mathrm{ps}$的正弦定时误差 。

与[频谱](@entry_id:276824)平坦的**随机抖动**（random jitter, RJ）相比，[确定性抖动](@entry_id:1123600)具有独特的危害性。即使一个[确定性抖动](@entry_id:1123600)和一个随机抖动的[均方根](@entry_id:263605)（RMS）值相等，它们的性质和影响也截然不同：

1.  **有界性 vs. 无界性**：[确定性抖动](@entry_id:1123600)是**有界**的，其峰值是固定的。而高斯分布的随机抖动理论上是**无界**的，尽管出现大偏差的概率很低。
2.  **对定时预算的影响**：对于要求极低[误码率](@entry_id:267618)的系统，[随机抖动](@entry_id:1130551)的“有效”峰值远大于其[RMS值](@entry_id:269927)（例如，在$10^{-12}$[误码率](@entry_id:267618)下，峰峰值约为$14\sigma$）。一个[RMS值](@entry_id:269927)与前述$0.84\,\mathrm{ps}$（峰峰值）的正弦[抖动](@entry_id:200248)相等的[随机抖动](@entry_id:1130551)，其$14\sigma$的峰峰值会大得多，对最差情况下的定时裕度构成更严峻的挑战。
3.  **相关性**：[确定性抖动](@entry_id:1123600)是周期性的，可能与系统中的其他信号产生[拍频](@entry_id:176054)或相关的干扰，导致系统级的性能恶化，而[随机抖动](@entry_id:1130551)则表现为不相关的噪声。

因此，即使一个杂散的RMS功率不大，它所代表的有界、周期性的定时误差也可能直接侵蚀高速数字接口的定时窗口，成为系统性能的瓶颈。这正是分数N锁相环设计中必须严格控制杂散的根本原因。