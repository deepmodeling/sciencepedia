{
    "hands_on_practices": [
        {
            "introduction": "知道了要计算 *什么* ()，下一个问题是如何 *高效地* 计算它。这个实践将一种朴素的、暴力的计算方法与一种优化的、利用局域性的更新方法进行对比，揭示了它们在计算标度行为上的巨大差异。理解这一点对于在实际尺寸的系统上进行模拟至关重要。",
            "id": "3752097",
            "problem": "考虑一个二维周期性晶格，它代表一种多组分高熵合金，在 $N = L_x L_y$ 个晶格点上分布有 $K$ 种化学物质。设位点 $i$ 上的物质种类由 $s_i \\in \\{0,1,\\dots,K-1\\}$ 表示。由成对相互作用引起的热力学能量通过一个哈密顿量来建模，该哈密顿量对相互作用的邻居对进行求和，\n$$\nE(\\mathbf{s}) = \\sum_{\\langle i,j \\rangle} J_{s_i s_j},\n$$\n其中 $J_{ab}$ 是一个对称相互作用矩阵，其元素指定了物质种类 $a$ 和 $b$ 之间的成对相互作用能，$\\langle i,j \\rangle$ 表示在指定的相互作用方案下互为邻居的位点对。\n\n在此类晶格上的蒙特卡洛（MC）方法通常会提议在单个位点 $i$ 上将物质种类从 $s_i$ 更改为 $s_i'$，并需要计算能量差\n$$\n\\Delta E = E(\\mathbf{s}^{(i \\to s_i')}) - E(\\mathbf{s}),\n$$\n以通过玻尔兹曼分布和Metropolis准则来确定是否接受该提议。计算 $\\Delta E$ 的一种朴素方法是重新计算提议更改前后的总能量 $E$。一种优化的计算方法是使用邻居列表，仅考虑位点 $i$ 的邻居集合来更新能量差。在配位数为 $z$（相互作用方案中每个位点的邻居数）的晶格中，基于邻居列表的更新预计每次提议的运行时间为 $\\mathcal{O}(z)$。\n\n你的任务是：\n\n1. 实现一个周期性的 $L_x \\times L_y$ 晶格，该晶格具有物质种类分配 $\\mathbf{s}$ 和一个对称相互作用矩阵 $J_{ab}$，其中 $a,b \\in \\{0,\\dots,K-1\\}$。需要考虑的相互作用方案包括：\n   - 方形晶格上的最近邻，其配位数为 $z=4$。\n   - 方形晶格上的最近邻加次近邻（包括对角线邻居），其配位数为 $z=8$。\n\n2. 实现两种计算单一位点提议更改的能量差 $\\Delta E$ 的方法：\n   - 一种朴素方法，它对整个系统的总能量进行两次重新计算（一次针对原始构型，一次针对修改后的构型）。\n   - 一种优化的邻居列表方法，它仅使用当前位点的邻居来计算 $\\Delta E$。\n\n3. 为这两种方法配备精确的操作计数器，用于计算每次提议中每种方法所需的 $J_{s_i s_j}$ 形式的成对能量评估次数。为保持一致性：\n   - 将单个成对能量评估定义为一次 $J_{ab}$ 的查找。\n   - 在朴素方法中，评估一次总能量 $E$ 需要对每个唯一的相互作用对进行一次成对能量评估。朴素的 $\\Delta E$ 计算需要两次总能量评估（原始和修改后的）。\n   - 在邻居列表方法中，为位点 $i$ 的一次提议计算 $\\Delta E$ 时，对 $i$ 的每个邻居 $j$ 需要进行两次成对能量评估，即 $J_{s_i' s_j}$ 和 $J_{s_i s_j}$。\n\n4. 通过报告每个测试用例的以下列表来分析复杂度缩放：\n   - $z$（配位数），\n   - $N$（晶格点数），\n   - 朴素方法单次提议中成对能量评估的整数计数，\n   - 邻居列表方法单次提议中成对能量评估的整数计数，\n   - 朴素方法与邻居列表方法操作计数的浮点数比率。\n\n在两个方向上都使用周期性边界条件。为了可复现性，请使用固定的随机种子和对称的随机相互作用矩阵 $J$。\n\n测试套件（所有情况均使用 $K=5$ 种物质）：\n- 案例 1（边界条件检查）：$L_x=2$，$L_y=2$，最近邻（$z=4$）。\n- 案例 2（中等尺寸，最近邻）：$L_x=4$，$L_y=4$，最近邻（$z=4$）。\n- 案例 3（随 $N$ 缩放，最近邻）：$L_x=32$，$L_y=32$，最近邻（$z=4$）。\n- 案例 4（更大配位数的影响）：$L_x=32$，$L_y=32$，最近邻加次近邻（$z=8$）。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，并且本身也是一个形式为 $[z, N, \\text{ops\\_naive}, \\text{ops\\_neighbor}, \\text{ratio}]$ 的列表。例如：“[[z1,N1,ops1_naive,ops1_neighbor,ratio1],[z2,N2,ops2_naive,ops2_neighbor,ratio2],...]”。所有值都必须是整数或浮点数类型，比率应报告为浮点数。",
            "solution": "该问题要求分析在二维周期性晶格上对多组分合金进行蒙特卡洛模拟时，与单一位点物质交换相关的能量变化 $\\Delta E$ 的两种不同计算方法的计算复杂度。该分析将通过确定每种方法所需的成对相互作用能评估 $J_{ab}$ 的确切次数来执行。\n\n系统定义在一个具有 $N = L_x L_y$ 个位点的 $L_x \\times L_y$ 周期性晶格上。每个位点 $i$ 被一种化学物质 $s_i \\in \\{0, 1, \\dots, K-1\\}$ 占据。构型 $\\mathbf{s}$ 的总能量由哈密顿量给出：\n$$\nE(\\mathbf{s}) = \\sum_{\\langle i,j \\rangle} J_{s_i s_j}\n$$\n其中 $\\langle i,j \\rangle$ 表示一对唯一的相互作用邻居，而 $J_{ab}$ 是对称的相互作用能矩阵。将位点 $i$ 的物质从 $s_i$ 更改为 $s_i'$ 的能量变化为 $\\Delta E = E(\\mathbf{s}^{(i \\to s_i')}) - E(\\mathbf{s})$。\n\n我们将分析计算 $\\Delta E$ 的两种不同方法的运算成本，该成本定义为 $J_{ab}$ 查找的次数。\n\n**1. 朴素方法：完全重新计算**\n\n此方法计算整个晶格的总能量两次：一次是针对初始构型 $\\mathbf{s}$，得到 $E(\\mathbf{s})$；另一次是针对提议的新构型 $\\mathbf{s}^{(i \\to s_i')}$，得到 $E(\\mathbf{s}^{(i \\to s_i')})$。\n\n根据问题陈述，单次评估总能量 $E(\\mathbf{s})$ 需要对晶格中每个唯一的相互作用对进行一次 $J_{ab}$ 查找。在一个有 $N$ 个位点的周期性晶格中，每个位点的配位数（相互作用邻居的数量）为 $z$，唯一的相互作用对总数由以下公式给出：\n$$\nN_{\\text{pairs}} = \\frac{zN}{2}\n$$\n因子 $1/2$ 用于校正重复计数，因为位点 $i$ 和位点 $j$ 之间的相互作用与 $j$ 和 $i$ 之间的相互作用是相同的。\n\n因此，单次总能量计算的操作次数为 $zN/2$。计算 $\\Delta E$ 的朴素方法需要两次这样的计算。总操作计数 $\\text{ops}_{\\text{naive}}$ 为：\n$$\n\\text{ops}_{\\text{naive}} = 2 \\times N_{\\text{pairs}} = 2 \\times \\left(\\frac{zN}{2}\\right) = zN\n$$\n该计数与总位点数 $N$呈线性关系，因此对于大型系统而言，其计算成本很高。\n\n**2. 优化方法：邻居列表更新**\n\n此方法利用了提议更改的局部性。能量差 $\\Delta E$ 仅源于被修改位点 $i$ 与其直接邻居之间相互作用能的变化。晶格中所有其他对的能量贡献保持不变。\n\n能量变化可以表示为仅对位点 $i$ 的邻居求和：\n$$\n\\Delta E = \\sum_{j \\in \\text{neighbors}(i)} \\left( J_{s_i' s_j} - J_{s_i s_j} \\right)\n$$\n在这里，$s_i$ 是位点 $i$ 的原始物质种类，$s_i'$ 是新的物质种类，$s_j$ 是邻近位点 $j$ 的物质种类。\n\n根据问题定义，为一次提议计算此和需要对位点 $i$ 的 $z$ 个邻居中的每一个进行两次成对能量评估：一次查找新的相互作用能 $J_{s_i' s_j}$，一次查找旧的相互作用能 $J_{s_i s_j}$。\n\n因此，邻居列表方法的总操作计数 $\\text{ops}_{\\text{neighbor}}$ 为：\n$$\n\\text{ops}_{\\text{neighbor}} = z \\times 2 = 2z\n$$\n该计数仅取决于配位数 $z$，而与总系统尺寸 $N$ 无关。\n\n**3. 复杂度比较与缩放分析**\n\n操作计数的比率清晰地衡量了两种方法的相对效率：\n$$\n\\text{Ratio} = \\frac{\\text{ops}_{\\text{naive}}}{\\text{ops}_{\\text{neighbor}}} = \\frac{zN}{2z} = \\frac{N}{2}\n$$\n这一结果至关重要。它表明，邻居列表方法相对于朴素方法的计算优势随系统尺寸 $N$ 呈线性增长。对于 $N$ 在 $10^3$ 到 $10^6$ 或更大数量级的大型晶格，优化方法的计算速度要快上几个数量级，使其成为任何实际蒙特卡洛模拟的先决条件。值得注意的是，效率比与配位数 $z$ 无关。\n\n**4. 测试用例的实现策略**\n\n所提供的测试用例可以通过应用这些推导出的解析公式来解决。对于每个由晶格尺寸 $L_x$ 和 $L_y$ 及相互作用方案指定的案例：\n- 总位点数为 $N = L_x L_y$。\n- 对于最近邻相互作用，配位数 $z$ 为 $4$；对于最近邻加次近邻相互作用，配位数 $z$ 为 $8$。\n- 操作计数计算为 $\\text{ops}_{\\text{naive}} = zN$ 和 $\\text{ops}_{\\text{neighbor}} = 2z$。\n- 比率计算为 $\\text{ops}_{\\text{naive}} / \\text{ops}_{\\text{neighbor}}$。\n\n最终的程序将为指定的测试套件实现这些计算，并按要求格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# The problem allows for scipy, but it is not required for this particular solution.\n# from scipy import special\n\ndef solve():\n    \"\"\"\n    Analyzes the computational complexity of two methods for calculating energy\n    differences in a lattice model for high-entropy alloys.\n    \"\"\"\n\n    # Test Suite defined in the problem statement.\n    # All cases use K=5 species.\n    # interaction 'nn': nearest neighbors.\n    # interaction 'nnn': nearest + next-nearest neighbors.\n    test_cases = [\n        {'Lx': 2, 'Ly': 2, 'interaction': 'nn'},\n        {'Lx': 4, 'Ly': 4, 'interaction': 'nn'},\n        {'Lx': 32, 'Ly': 32, 'interaction': 'nn'},\n        {'Lx': 32, 'Ly': 32, 'interaction': 'nnn'},\n    ]\n\n    results = []\n    for case in test_cases:\n        Lx = case['Lx']\n        Ly = case['Ly']\n        interaction_type = case['interaction']\n\n        # Determine coordination number z based on the interaction scheme.\n        if interaction_type == 'nn':\n            z = 4  # Nearest neighbors: (±1, 0), (0, ±1)\n        elif interaction_type == 'nnn':\n            z = 8  # Nearest + next-nearest neighbors: adds (±1, ±1)\n        else:\n            # This case should not be reached with the given test suite.\n            raise ValueError(f\"Unknown interaction type: {interaction_type}\")\n\n        # Total number of lattice sites N.\n        N = Lx * Ly\n\n        # The problem defines a single operation as one lookup of a J_ab pair energy.\n        # The following calculations are based on the analytical derivation.\n\n        # Naive method operation count:\n        # A full energy calculation requires one operation per unique pair.\n        # For a periodic lattice with N sites and coordination z, there are (z * N) / 2 unique pairs.\n        # The naive method performs two full energy\n        # calculations (before and after the proposed change).\n        # Total naive operations = 2 * ((z * N) / 2) = z * N.\n        ops_naive = z * N\n\n        # Neighbor list method operation count:\n        # This method considers only the z neighbors of the site being changed.\n        # For each neighbor, it performs two pair energy evaluations\n        # (for the old and new species at the central site).\n        # Total neighbor list operations = 2 * z.\n        ops_neighbor = 2 * z\n\n        # The ratio of naive to neighbor-list operation counts.\n        # Analytically, this is (z * N) / (2 * z) = N / 2.\n        ratio = float(ops_naive) / float(ops_neighbor)\n\n        result_list = [z, N, ops_naive, ops_neighbor, ratio]\n        results.append(result_list)\n\n    # The final print statement must produce only the specified single-line format.\n    # The map(str, ...) correctly converts each inner list to its string representation.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "现在，我们将超越固定组分的模拟。本练习介绍了半巨正则系综，这是研究多组分合金相稳定性和平衡组分的强大工具。这项实践涉及推导包含化学势的修正Metropolis接受准则，并将其应用于一个具体例子。",
            "id": "3752153",
            "problem": "考虑一个多组分高熵合金，其原子种类由 $i \\in \\{A,B,C,D,E\\}$ 索引，在体积 $V$ 中占据固定数量的晶格点位。一个微观态 $X$ 由其能量 $E(X)$ 和成分 $\\{N_i(X)\\}$ 表征，其中 $N_i(X)$ 是微观态 $X$ 中种类 $i$ 的原子数量。在恒定温度 $T$ 和恒定化学势 $\\{\\mu_i\\}$ 的半巨正则系综 (SGC) 中，微观态 $X$ 的平衡概率正比于由半巨正则势构成的 Boltzmann 因子，该势由组合 $E(X)-\\sum_i \\mu_i N_i(X)$ 定义。一场马尔可夫链蒙特卡洛 (MCMC) 模拟采用试探移动 $X \\to X'$，这种移动会同时改变 $E$ 和 $\\{N_i\\}$（例如，单点位原子种类嬗变）。假设一个对称提议机制，在该机制中，提议 $X \\to X'$ 的概率等于提议 $X' \\to X$ 的概率。\n\n(a) 从细致平衡条件和适用于半巨正则系综的 Boltzmann 权重出发，推导一个改变能量和成分的通用试探移动的接受概率函数 $p_{\\mathrm{acc}}(X \\to X')$。你的推导必须从统计力学的核心原理开始：平衡权重正比于 $\\exp(-\\beta \\,\\text{potential})$（其中 $\\beta = 1/(k_B T)$），以及 MCMC 跃迁的细致平衡条件。\n\n(b) 考虑一个在温度 $T = 1200 \\,\\mathrm{K}$ 的 $A$-$B$-$C$-$D$-$E$ 合金中的特定单点位嬗变，其中所选点位的原子种类从 $B$ 变为 $E$。假设该试探移动的能量变化为 $\\Delta E = +0.12 \\,\\mathrm{eV}$，且化学势为 $\\mu_A = 0 \\,\\mathrm{eV}$，$\\mu_B = +0.025 \\,\\mathrm{eV}$，$\\mu_C = -0.030 \\,\\mathrm{eV}$，$\\mu_D = +0.015 \\,\\mathrm{eV}$，$\\mu_E = -0.035 \\,\\mathrm{eV}$。对于此嬗变，成分变化为 $\\Delta N_B = -1$，$\\Delta N_E = +1$，且所有其他种类的 $\\Delta N_i = 0$。使用 Boltzmann 常数 $k_B = 8.617333262145 \\times 10^{-5} \\,\\mathrm{eV/K}$。计算此试探移动的接受概率。将最终的接受概率表示为一个无量纲的十进制数，并四舍五入到四位有效数字。",
            "solution": "该问题经确认为科学上成立、设定良好且客观。这是计算统计力学中的一个标准问题。\n\n(a) 部分：接受概率的推导\n\n目标是推导在半巨正则 (SGC) 系综内的马尔可夫链蒙特卡洛 (MCMC) 模拟中，一个试探移动的接受概率 $p_{\\mathrm{acc}}(X \\to X')$。推导始于细致平衡原理，它是马尔可夫链收敛到所需平衡分布的充分条件。\n\n细致平衡条件表明，对于任意两个微观态 $X$ 和 $X'$，在平衡状态下，从 $X$ 到 $X'$ 的跃迁速率必须等于从 $X'$ 到 $X$ 的跃迁速率：\n$$\nP_{eq}(X) W(X \\to X') = P_{eq}(X') W(X' \\to X)\n$$\n其中 $P_{eq}(X)$ 是微观态 $X$ 的平衡概率，而 $W(X \\to X')$ 是从 $X$ 到 $X'$ 的总跃迁概率。\n\n总跃迁概率是两个因子的乘积：从 $X$ 生成到 $X'$ 的试探移动的提议概率 $g(X \\to X')$，以及接受该移动的接受概率 $p_{\\mathrm{acc}}(X \\to X')$。\n$$\nW(X \\to X') = g(X \\to X') p_{\\mathrm{acc}}(X \\to X')\n$$\n将此代入细致平衡方程可得：\n$$\nP_{eq}(X) g(X \\to X') p_{\\mathrm{acc}}(X \\to X') = P_{eq}(X') g(X' \\to X) p_{\\mathrm{acc}}(X' \\to X)\n$$\n我们可以重新整理该式，以求得接受概率的比率：\n$$\n\\frac{p_{\\mathrm{acc}}(X \\to X')}{p_{\\mathrm{acc}}(X' \\to X)} = \\frac{P_{eq}(X')}{P_{eq}(X)} \\frac{g(X' \\to X)}{g(X \\to X')}\n$$\n问题指定了对称提议机制，这意味着 $g(X \\to X') = g(X' \\to X)$。因此，提议概率的比率为 1：\n$$\n\\frac{g(X' \\to X)}{g(X \\to X')} = 1\n$$\n这将接受概率的比率简化为：\n$$\n\\frac{p_{\\mathrm{acc}}(X \\to X')}{p_{\\mathrm{acc}}(X' \\to X)} = \\frac{P_{eq}(X')}{P_{eq}(X)}\n$$\n在半巨正则系综中，微观态 $X$ 的平衡概率由其 SGC 势 $\\Phi_{SGC}(X) = E(X) - \\sum_i \\mu_i N_i(X)$ 的 Boltzmann 权重给出。\n$$\nP_{eq}(X) \\propto \\exp\\left(-\\beta \\Phi_{SGC}(X)\\right)\n$$\n其中 $\\beta = 1/(k_B T)$。因此，平衡概率的比率为：\n$$\n\\frac{P_{eq}(X')}{P_{eq}(X)} = \\frac{\\exp\\left(-\\beta \\Phi_{SGC}(X')\\right)}{\\exp\\left(-\\beta \\Phi_{SGC}(X)\\right)} = \\exp\\left(-\\beta [\\Phi_{SGC}(X') - \\Phi_{SGC}(X)]\\right) = \\exp\\left(-\\beta \\Delta \\Phi_{SGC}\\right)\n$$\nSGC 势的变化量 $\\Delta \\Phi_{SGC}$ 由下式给出：\n$$\n\\Delta \\Phi_{SGC} = \\Phi_{SGC}(X') - \\Phi_{SGC}(X) = \\left(E(X') - \\sum_i \\mu_i N_i(X')\\right) - \\left(E(X) - \\sum_i \\mu_i N_i(X)\\right)\n$$\n$$\n\\Delta \\Phi_{SGC} = [E(X') - E(X)] - \\sum_i \\mu_i [N_i(X') - N_i(X)] = \\Delta E - \\sum_i \\mu_i \\Delta N_i\n$$\nMetropolis-Hastings 算法为满足细致平衡条件的 $p_{\\mathrm{acc}}$ 提供了一个特定的选择。对于对称提议情况（通常称为 Metropolis 算法），接受概率由下式给出：\n$$\np_{\\mathrm{acc}}(X \\to X') = \\min\\left(1, \\frac{P_{eq}(X')}{P_{eq}(X)}\\right)\n$$\n代入我们得到的概率比率表达式，我们得到 SGC 系综中接受概率的最终形式：\n$$\np_{\\mathrm{acc}}(X \\to X') = \\min\\left(1, \\exp\\left(-\\beta \\Delta \\Phi_{SGC}\\right)\\right) = \\min\\left(1, \\exp\\left(-\\beta \\left[\\Delta E - \\sum_i \\mu_i \\Delta N_i\\right]\\right)\\right)\n$$\n\n(b) 部分：接受概率的计算\n\n题目要求我们计算一个从种类 $B$ 到种类 $E$ 的特定单点位嬗变的接受概率。给定的值为：\n温度，$T = 1200 \\,\\mathrm{K}$。\n能量变化，$\\Delta E = +0.12 \\,\\mathrm{eV}$。\nBoltzmann 常数，$k_B = 8.617333262145 \\times 10^{-5} \\,\\mathrm{eV/K}$。\n化学势：$\\mu_B = +0.025 \\,\\mathrm{eV}$ 和 $\\mu_E = -0.035 \\,\\mathrm{eV}$。\n该试探移动涉及将一个种类 $B$ 的原子变为种类 $E$。因此，各种类原子的数量变化为：\n$\\Delta N_B = -1$，$\\Delta N_E = +1$，以及所有其他种类（$i \\in \\{A, C, D\\}$）的 $\\Delta N_i = 0$。\n\n首先，我们计算 SGC 势的变化量 $\\Delta \\Phi_{SGC} = \\Delta E - \\sum_i \\mu_i \\Delta N_i$。求和项 $\\sum_i \\mu_i \\Delta N_i$ 可简化为：\n$$\n\\sum_i \\mu_i \\Delta N_i = \\mu_B \\Delta N_B + \\mu_E \\Delta N_E = (+0.025 \\,\\mathrm{eV})(-1) + (-0.035 \\,\\mathrm{eV})(+1) = -0.025 \\,\\mathrm{eV} - 0.035 \\,\\mathrm{eV} = -0.060 \\,\\mathrm{eV}\n$$\n现在，我们可以计算 $\\Delta \\Phi_{SGC}$：\n$$\n\\Delta \\Phi_{SGC} = \\Delta E - \\sum_i \\mu_i \\Delta N_i = +0.12 \\,\\mathrm{eV} - (-0.060 \\,\\mathrm{eV}) = +0.180 \\,\\mathrm{eV}\n$$\n接下来，我们计算指数项的参数，$-\\beta \\Delta \\Phi_{SGC} = -\\frac{\\Delta \\Phi_{SGC}}{k_B T}$：\n$$\nk_B T = (8.617333262145 \\times 10^{-5} \\,\\mathrm{eV/K}) \\times (1200 \\,\\mathrm{K}) \\approx 0.103408 \\,\\mathrm{eV}\n$$\n该参数为：\n$$\n-\\frac{\\Delta \\Phi_{SGC}}{k_B T} = -\\frac{0.180 \\,\\mathrm{eV}}{0.103407999174 \\,\\mathrm{eV}} \\approx -1.740667\n$$\n那么，接受概率为：\n$$\np_{\\mathrm{acc}} = \\min(1, \\exp(-1.740667))\n$$\n由于参数为负，指数函数的值将小于 $1$。\n$$\np_{\\mathrm{acc}} = \\exp(-1.740667) \\approx 0.175402\n$$\n将此结果四舍五入到四位有效数字，得到 $0.1754$。",
            "answer": "$$\\boxed{0.1754}$$"
        }
    ]
}