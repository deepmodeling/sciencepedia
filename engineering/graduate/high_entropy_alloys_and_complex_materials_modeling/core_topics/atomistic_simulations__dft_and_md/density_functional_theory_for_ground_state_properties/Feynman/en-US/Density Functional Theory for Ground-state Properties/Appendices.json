{
    "hands_on_practices": [
        {
            "introduction": "This practice focuses on a fundamental prerequisite for any reliable DFT calculation of a crystalline material: ensuring the convergence of the Brillouin Zone integration. For periodic systems, observables like total energy are calculated by integrating over a reciprocal space grid of $k$-points. This exercise  provides a hands-on procedure to determine the minimum $k$-point density required to achieve a target accuracy, a crucial step that balances computational cost with predictive precision.",
            "id": "3737416",
            "problem": "You are tasked with designing and implementing a convergence assessment procedure for the sampling of the reciprocal space using a $k$-point grid in Density Functional Theory (DFT) applied to the ground-state of a disordered High-Entropy Alloy (HEA) supercell. The computational setting is a periodic, metallic disordered HEA supercell where the Brillouin Zone (BZ) integral contributing to the Kohn–Sham (KS) total energy and stress must be approximated via a finite set of $k$-points. The fundamental basis you may rely on includes: the Kohn–Sham formulation of Density Functional Theory (DFT) for ground-state properties, the requirement of Brillouin Zone (BZ) integration for periodic systems, and the general principle that quadrature error for such integrals decreases with increasing sampling density. You must not assume any specialized shortcut formulas beyond these foundations.\n\nStarting from the principle that the KS ground-state total energy per atom, denoted $E$, is obtained by integration over the BZ of band energies weighted by occupations and that the Cauchy stress tensor entries $\\sigma_{ij}$ are obtained from derivatives of the ground-state energy with respect to strain (e.g., via Hellmann–Feynman theorem and Pulay corrections where applicable), the discretization of the BZ integral by a finite $k$-point grid introduces a numerical error that generally decreases as the sampling becomes denser. For disordered HEA supercells, the disorder-induced real-space enlargement folds the BZ and modifies the sampling requirements, but the convergence logic remains governed by stabilization of $E$ and stress with increasing $k$-point density.\n\nYour task is to construct a procedure that:\n- Considers a sequence of progressively denser $k$-point grids for a given disordered HEA supercell (not necessarily cubic grids).\n- Uses the criterion that the change in total energy per atom $|\\Delta E|$ between successive grids must be strictly below $1\\,\\mathrm{meV}$ per atom (i.e., $|\\Delta E| < 0.001\\,\\mathrm{eV}$), and the change in stress magnitude $|\\Delta \\sigma|$ between successive grids must be strictly below $0.1\\,\\mathrm{GPa}$ (i.e., $|\\Delta \\sigma| < 0.1\\,\\mathrm{GPa}$).\n- Selects the smallest grid (in terms of the total number of $k$-points $N_k = k_x \\cdot k_y \\cdot k_z$) at which both criteria are satisfied simultaneously for the transition from the previous grid to the current one.\n- If no such grid exists within the provided sequence, outputs $-1$ for that test case.\n\nAssume the stress is provided as a scalar magnitude (e.g., the norm of the stress tensor or an appropriate scalar descriptor of stress relevant to convergence assessment). All total energies are per atom.\n\nYou must implement a program that processes the following test suite of cases. For each case $c$, you are given:\n- A list of $k$-point grids $G^{(c)} = \\{(k_x,k_y,k_z)\\}$ ordered from coarser to finer sampling.\n- A list of total energies per atom $E^{(c)}$ in $\\mathrm{eV}$, aligned with the grids.\n- A list of stress magnitudes $\\sigma^{(c)}$ in $\\mathrm{GPa}$, aligned with the grids.\n\nYour program must apply the strict convergence criterion $|\\Delta E| < 0.001\\,\\mathrm{eV}$ and $|\\Delta \\sigma| < 0.1\\,\\mathrm{GPa}$ between successive grids and return the minimal $N_k$ that satisfies both at once, or $-1$ if none does.\n\nUse the following test suite:\n\n- Case $1$: \n  Grids $G^{(1)}$: $[(2,2,2),(3,3,3),(4,4,4),(6,6,6),(8,8,8)]$.\n  Energies per atom $E^{(1)}$: $[-6.3200,-6.3350,-6.3405,-6.3412,-6.3418]\\,\\mathrm{eV}$.\n  Stress magnitudes $\\sigma^{(1)}$: $[2.05,1.26,0.98,0.92,0.91]\\,\\mathrm{GPa}$.\n\n- Case $2$:\n  Grids $G^{(2)}$: $[(1,1,1),(2,2,2),(3,3,3),(4,4,4),(5,5,5)]$.\n  Energies per atom $E^{(2)}$: $[-7.1250,-7.1300,-7.1310,-7.1314,-7.1316]\\,\\mathrm{eV}$.\n  Stress magnitudes $\\sigma^{(2)}$: $[0.55,0.46,0.42,0.41,0.405]\\,\\mathrm{GPa}$.\n\n- Case $3$:\n  Grids $G^{(3)}$: $[(1,1,1),(2,2,2),(3,3,3),(4,4,4),(6,6,6)]$.\n  Energies per atom $E^{(3)}$: $[-5.0000,-5.1200,-5.1550,-5.1600,-5.1622]\\,\\mathrm{eV}$.\n  Stress magnitudes $\\sigma^{(3)}$: $[1.80,1.40,1.30,1.25,1.22]\\,\\mathrm{GPa}$.\n\n- Case $4$ (anisotropic grids):\n  Grids $G^{(4)}$: $[(2,2,1),(3,3,1),(3,3,2),(4,4,2),(4,4,3)]$.\n  Energies per atom $E^{(4)}$: $[-6.0000,-6.0200,-6.0280,-6.0290,-6.0296]\\,\\mathrm{eV}$.\n  Stress magnitudes $\\sigma^{(4)}$: $[1.10,0.85,0.80,0.78,0.779]\\,\\mathrm{GPa}$.\n\n- Case $5$ (non-monotonic small fluctuations):\n  Grids $G^{(5)}$: $[(2,2,2),(3,3,3),(4,4,4),(6,6,6),(8,8,8)]$.\n  Energies per atom $E^{(5)}$: $[-8.0000,-8.0006,-8.0010,-8.0012,-8.0013]\\,\\mathrm{eV}$.\n  Stress magnitudes $\\sigma^{(5)}$: $[0.95,0.90,0.88,0.879,0.8785]\\,\\mathrm{GPa}$.\n\nBoundary and edge-case requirements:\n- The phrase “below $1\\,\\mathrm{meV}$” and “below $0.1\\,\\mathrm{GPa}$” means a strict inequality: $|\\Delta E| < 0.001\\,\\mathrm{eV}$ and $|\\Delta \\sigma| < 0.1\\,\\mathrm{GPa}$. Equality does not satisfy the criterion.\n- The selected grid corresponds to the finer of the pair where both differences are simultaneously below threshold.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,\\dots]$), where each $result_c$ is the selected total number of $k$-points $N_k$ for case $c$, or $-1$ if no convergence occurred within the provided sequence. No external input is allowed, and no additional text should be printed. All energies must be used in units of $\\mathrm{eV}$ per atom and all stress magnitudes in units of $\\mathrm{GPa}$.",
            "solution": "The problem as stated is formally validated.\n\n**Step 1: Extract Givens**\n- **Task**: Design and implement a convergence assessment procedure for $k$-point grid sampling in Density Functional Theory (DFT) for a High-Entropy Alloy (HEA) supercell.\n- **Principle**: The Kohn-Sham (KS) total energy per atom $E$ and Cauchy stress tensor entries $\\sigma_{ij}$ are obtained via Brillouin Zone (BZ) integration. Discretization using a finite $k$-point grid introduces a numerical error that must be converged.\n- **Convergence Criteria**:\n    1. The change in total energy per atom, $|\\Delta E|$, between successive grids must be strictly less than $1\\,\\mathrm{meV}$ per atom, which is $|\\Delta E| < 0.001\\,\\mathrm{eV}$.\n    2. The change in stress magnitude, $|\\Delta \\sigma|$, between successive grids must be strictly less than $0.1\\,\\mathrm{GPa}$, which is $|\\Delta \\sigma| < 0.1\\,\\mathrm{GPa}$.\n- **Selection Rule**: Select the smallest grid (in terms of total number of $k$-points, $N_k = k_x \\cdot k_y \\cdot k_z$) for which both criteria are met simultaneously. The grid to be selected is the finer of the two grids being compared.\n- **No Convergence**: If no grid in the provided sequence satisfies the criteria, the output for that case is $-1$.\n- **Input Data**: For each case $c$, a list of grids $G^{(c)}$, a list of energies $E^{(c)}$ (in $\\mathrm{eV}$), and a list of stress magnitudes $\\sigma^{(c)}$ (in $\\mathrm{GPa}$).\n- **Test Suite**:\n    - **Case $1$**: $G^{(1)} = [(2,2,2),(3,3,3),(4,4,4),(6,6,6),(8,8,8)]$, $E^{(1)} = [-6.3200,-6.3350,-6.3405,-6.3412,-6.3418]\\,\\mathrm{eV}$, $\\sigma^{(1)} = [2.05,1.26,0.98,0.92,0.91]\\,\\mathrm{GPa}$.\n    - **Case $2$**: $G^{(2)} = [(1,1,1),(2,2,2),(3,3,3),(4,4,4),(5,5,5)]$, $E^{(2)} = [-7.1250,-7.1300,-7.1310,-7.1314,-7.1316]\\,\\mathrm{eV}$, $\\sigma^{(2)} = [0.55,0.46,0.42,0.41,0.405]\\,\\mathrm{GPa}$.\n    - **Case $3$**: $G^{(3)} = [(1,1,1),(2,2,2),(3,3,3),(4,4,4),(6,6,6)]$, $E^{(3)} = [-5.0000,-5.1200,-5.1550,-5.1600,-5.1622]\\,\\mathrm{eV}$, $\\sigma^{(3)} = [1.80,1.40,1.30,1.25,1.22]\\,\\mathrm{GPa}$.\n    - **Case $4$**: $G^{(4)} = [(2,2,1),(3,3,1),(3,3,2),(4,4,2),(4,4,3)]$, $E^{(4)} = [-6.0000,-6.0200,-6.0280,-6.0290,-6.0296]\\,\\mathrm{eV}$, $\\sigma^{(4)} = [1.10,0.85,0.80,0.78,0.779]\\,\\mathrm{GPa}$.\n    - **Case $5$**: $G^{(5)} = [(2,2,2),(3,3,3),(4,4,4),(6,6,6),(8,8,8)]$, $E^{(5)} = [-8.0000,-8.0006,-8.0010,-8.0012,-8.0013]\\,\\mathrm{eV}$, $\\sigma^{(5)} = [0.95,0.90,0.88,0.879,0.8785]\\,\\mathrm{GPa}$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is correctly situated within the standard framework of DFT. The need to converge BZ integrals with respect to $k$-point sampling is a fundamental and mandatory step in any electronic structure calculation for periodic systems. The convergence criteria for total energy ($1\\,\\mathrm{meV/atom}$) and stress ($0.1\\,\\mathrm{GPa}$) are standard, realistic values used in computational materials science.\n- **Well-Posedness**: The problem is well-posed. It provides sequences of pre-calculated data and a deterministic, unambiguous algorithm to be applied. For each input case, there exists a unique, stable, and meaningful solution (either a specific $N_k$ or $-1$).\n- **Objectivity**: The language is precise and objective. The criteria are quantitative and based on strict inequalities. No subjective interpretation is required.\n\n**Step 3: Verdict and Action**\nThe problem is valid. It is scientifically sound, well-posed, objective, and self-contained. The task is a formalization of a standard workflow in computational physics. A solution will be provided.\n\n**Principle-Based Design of the Solution**\n\nThe objective is to determine the minimum $k$-point grid density required to achieve a predefined level of numerical accuracy for the total energy and stress in a DFT calculation. This is a numerical quadrature convergence problem.\n\nIn the Kohn-Sham formulation of DFT for a periodic solid, observables such as the total energy $E$ are calculated by integrating quantities over the first Brillouin Zone (BZ). For example, the electronic part of the ground-state energy involves a sum over occupied bands of an integral of the band energies $\\varepsilon_{n}(\\mathbf{k})$:\n$$ E_{elec} \\propto \\sum_{n} \\int_{\\mathrm{BZ}} w_{n}(\\mathbf{k}) \\varepsilon_{n}(\\mathbf{k}) d\\mathbf{k} $$\nwhere $w_{n}(\\mathbf{k})$ are occupation-related weights. The stress tensor components $\\sigma_{ij}$ are derived from the total energy's response to infinitesimal strain, which also involves BZ integrals.\n\nNumerically, these integrals are approximated by a discrete sum over a regular mesh of $k$-points:\n$$ \\int_{\\mathrm{BZ}} f(\\mathbf{k}) d\\mathbf{k} \\approx \\sum_{i=1}^{N_k} \\omega_i f(\\mathbf{k}_i) $$\nwhere $\\mathbf{k}_i$ are the sampling points, $\\omega_i$ are integration weights, and $N_k$ is the total number of points in the grid. The accuracy of this approximation improves as $N_k$ increases.\n\nThe specified procedure is an algorithmic implementation of this convergence principle. We are given a sequence of calculations performed on progressively denser $k$-point grids. Let the sequence of grids be $\\{G_0, G_1, \\dots, G_{M-1}\\}$, where each grid $G_i$ is defined by $(k_x, k_y, k_z)_i$. For each grid $G_i$, we have the corresponding calculated total energy per atom $E_i$ and stress magnitude $\\sigma_i$.\n\nThe convergence assessment algorithm proceeds as follows:\n$1$. The process starts by comparing the results from the first two grids, $G_0$ and $G_1$, and continues sequentially. The comparison is made for each pair of successive grids $(G_{i-1}, G_i)$ for $i=1, 2, \\dots, M-1$.\n\n$2$. For each step $i$, we calculate the absolute difference in energy per atom, $|\\Delta E_i|$, and stress magnitude, $|\\Delta \\sigma_i|$:\n$$ |\\Delta E_i| = |E_i - E_{i-1}| $$\n$$ |\\Delta \\sigma_i| = |\\sigma_i - \\sigma_{i-1}| $$\n\n$3$. We check if both differences simultaneously satisfy the strict inequality criteria:\n$$ |\\Delta E_i| < E_{tol} \\quad \\text{and} \\quad |\\Delta \\sigma_i| < \\sigma_{tol} $$\nwhere the tolerances are given as $E_{tol} = 0.001\\,\\mathrm{eV}$ and $\\sigma_{tol} = 0.1\\,\\mathrm{GPa}$.\n\n$4$. The first grid $G_i$ for which these two conditions are met is considered the converged grid. The problem requires reporting the total number of $k$-points $N_k$ for this grid, which is calculated as $N_k = (k_x)_i \\cdot (k_y)_i \\cdot (k_z)_i$.\n\n$5$. The search is terminated as soon as the first such grid $G_i$ is found, as this corresponds to the \"smallest grid\" (i.e., the least computationally expensive) that meets the convergence standard.\n\n$6$. If the loop over all $i$ from $1$ to $M-1$ completes without finding any $i$ that satisfies both criteria, it signifies that convergence was not achieved within the provided set of calculations. In this scenario, the designated output is $-1$.\n\nThis procedure is applied to each test case independently.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Processes a suite of DFT convergence test cases to find the minimal k-point grid satisfying\n    predefined energy and stress convergence criteria.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"grids\": [(2, 2, 2), (3, 3, 3), (4, 4, 4), (6, 6, 6), (8, 8, 8)],\n            \"energies\": [-6.3200, -6.3350, -6.3405, -6.3412, -6.3418],\n            \"stresses\": [2.05, 1.26, 0.98, 0.92, 0.91],\n        },\n        {\n            \"grids\": [(1, 1, 1), (2, 2, 2), (3, 3, 3), (4, 4, 4), (5, 5, 5)],\n            \"energies\": [-7.1250, -7.1300, -7.1310, -7.1314, -7.1316],\n            \"stresses\": [0.55, 0.46, 0.42, 0.41, 0.405],\n        },\n        {\n            \"grids\": [(1, 1, 1), (2, 2, 2), (3, 3, 3), (4, 4, 4), (6, 6, 6)],\n            \"energies\": [-5.0000, -5.1200, -5.1550, -5.1600, -5.1622],\n            \"stresses\": [1.80, 1.40, 1.30, 1.25, 1.22],\n        },\n        {\n            \"grids\": [(2, 2, 1), (3, 3, 1), (3, 3, 2), (4, 4, 2), (4, 4, 3)],\n            \"energies\": [-6.0000, -6.0200, -6.0280, -6.0290, -6.0296],\n            \"stresses\": [1.10, 0.85, 0.80, 0.78, 0.779],\n        },\n        {\n            \"grids\": [(2, 2, 2), (3, 3, 3), (4, 4, 4), (6, 6, 6), (8, 8, 8)],\n            \"energies\": [-8.0000, -8.0006, -8.0010, -8.0012, -8.0013],\n            \"stresses\": [0.95, 0.90, 0.88, 0.879, 0.8785],\n        },\n    ]\n\n    # Convergence criteria\n    energy_threshold = 0.001  # eV per atom\n    stress_threshold = 0.1     # GPa\n\n    results = []\n\n    for case in test_cases:\n        grids = case[\"grids\"]\n        energies = case[\"energies\"]\n        stresses = case[\"stresses\"]\n        \n        found_convergence = False\n        \n        # Iterate from the second grid onwards to compare with the previous one\n        for i in range(1, len(grids)):\n            # Calculate the absolute difference in energy and stress\n            delta_e = abs(energies[i] - energies[i-1])\n            delta_s = abs(stresses[i] - stresses[i-1])\n            \n            # Check if both criteria are strictly met\n            if delta_e < energy_threshold and delta_s < stress_threshold:\n                # If converged, get the current grid and calculate total k-points\n                converged_grid = grids[i]\n                # Using np.prod is a clean way to multiply tuple elements\n                num_k_points = int(np.prod(converged_grid))\n                results.append(num_k_points)\n                found_convergence = True\n                break  # Stop at the first grid that meets the criteria\n        \n        if not found_convergence:\n            results.append(-1)\n\n    # Print the final results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "With numerical parameters properly converged, the central task of a ground-state calculation is to find the equilibrium atomic structure by minimizing the total energy. This process, known as structural relaxation, involves iteratively moving atoms according to the forces they experience and adjusting the simulation cell based on the internal pressure. This exercise  simulates this core DFT workflow by having you implement a relaxation algorithm for a surrogate energy functional, providing direct insight into how forces and stress drive a system towards its lowest-energy state.",
            "id": "3737486",
            "problem": "Consider a simplified density functional theory (DFT)-motivated constrained relaxation for a high-entropy alloy (HEA) represented by a Special Quasi-random Structure (SQS). Start from the following fundamental bases: the Hohenberg–Kohn theorems guarantee that the ground-state energy is a unique functional of the electron density, the Kohn–Sham formulation provides a practical route to compute ground-state properties, and the Born–Oppenheimer approximation separates electronic and nuclear degrees of freedom. In the ground state, forces and stresses follow from stationarity of the total energy with respect to atomic positions and strain, respectively, via the Hellmann–Feynman theorem, namely $F_I = -\\partial E / \\partial R_I$ and $\\sigma = (1/V)\\,\\partial E / \\partial \\varepsilon$, where $F_I$ is the force on atom $I$, $R_I$ is its position, $\\sigma$ is the Cauchy stress, $V$ is the volume, and $\\varepsilon$ is the strain.\n\nTo make the problem computationally self-contained while remaining physically plausible, approximate the Kohn–Sham ground-state energy by a surrogate energy functional consisting of species-dependent pairwise Morse interactions and an isotropic harmonic bulk term that models the volume degree of freedom:\n$$\nE(\\{R_I\\},a) \\equiv \\sum_{I<J} V_{\\alpha_I \\alpha_J}(r_{IJ}) + \\frac{1}{2}\\,K\\,(V - V_0)^2,\n$$\nwhere $V_{\\alpha_I \\alpha_J}(r)$ is a Morse potential between species $\\alpha_I$ and $\\alpha_J$, $r_{IJ}$ is the interatomic distance between atoms $I$ and $J$, $a$ is the cubic lattice parameter, $V=a^3$ is the cell volume, $V_0$ is the target volume at fixed composition, and $K$ is a bulk stiffness parameter. The Morse potential is\n$$\nV_{\\alpha \\beta}(r) = D_{\\alpha \\beta}\\left[\\left(1 - e^{-A_{\\alpha \\beta}(r - r^0_{\\alpha \\beta})}\\right)^2 - 1\\right],\n$$\nwith species mixing rules $D_{\\alpha \\beta} = \\sqrt{D_\\alpha D_\\beta}$, $A_{\\alpha \\beta} = \\frac{1}{2}(A_\\alpha + A_\\beta)$, and $r^0_{\\alpha \\beta}=\\frac{1}{2}(r^0_\\alpha + r^0_\\beta)$. The hydrostatic pressure at zero temperature is the sum of a virial term from interatomic interactions and the bulk term,\n$$\nP_{\\text{virial}} = \\frac{1}{3V}\\sum_{I<J}\\big(-r_{IJ}\\,\\frac{dV_{\\alpha_I \\alpha_J}}{dr}(r_{IJ})\\big),\\quad P_{\\text{bulk}} = -K\\,(V - V_0),\\quad P_{\\text{total}} = P_{\\text{virial}} + P_{\\text{bulk}},\n$$\nand conversion between $\\text{eV}/\\text{\\AA}^3$ and GPa is given by $1\\,\\text{eV}/\\text{\\AA}^3 = 160.21766208\\,\\text{GPa}$.\n\nImplement a constrained relaxation at fixed composition for an equiatomic quaternary HEA SQS in a cubic periodic cell. Use fractional coordinates $\\{s_I\\}$ with $R_I = a\\,s_I$, and enforce periodic boundary conditions via the minimum image convention in fractional space. The constraints are: composition is fixed, the lattice remains cubic (only $a$ varies), and spurious rigid translation is removed by projecting out the net displacement increment at each step. At zero temperature, define the ground-state convergence criteria as simultaneous satisfaction of:\n- maximum force magnitude per atom $\\max_I \\|F_I\\| \\le F_{\\text{tol}}$, expressed in $\\text{eV}/\\text{\\AA}$, and\n- absolute hydrostatic stress $|P_{\\text{total}}| \\le S_{\\text{tol}}$, expressed in GPa.\n\nDerive the necessary gradients from first principles to implement the relaxation:\n- Atomic forces $F_I = -\\partial E/\\partial R_I$ from the pair potential derivatives,\n- Hydrostatic pressure $P_{\\text{total}}$ as above, and\n- The gradient of energy with respect to the lattice parameter $\\partial E/\\partial a$, which includes chain rule contributions from pair distances $r_{IJ} = a\\|s_J - s_I\\|$, and from the bulk term.\n\nPerform projected gradient-based updates for positions and the lattice parameter, with simple backtracking line searches to ensure downhill moves in $\\,E\\,$.\n\nUse the following physically plausible parameter values for the equiatomic Co–Cr–Fe–Ni HEA:\n- Species set is $\\{\\text{Co},\\text{Cr},\\text{Fe},\\text{Ni}\\}$ labeled as $\\{0,1,2,3\\}$ with two atoms of each species ($N=8$).\n- Single-species Morse parameters (in consistent units): $D_{\\text{Co}}=0.55\\,\\text{eV}$, $A_{\\text{Co}}=1.45\\,\\text{\\AA}^{-1}$, $r^0_{\\text{Co}}=2.45\\,\\text{\\AA}$; $D_{\\text{Cr}}=0.50\\,\\text{eV}$, $A_{\\text{Cr}}=1.40\\,\\text{\\AA}^{-1}$, $r^0_{\\text{Cr}}=2.48\\,\\text{\\AA}$; $D_{\\text{Fe}}=0.58\\,\\text{eV}$, $A_{\\text{Fe}}=1.48\\,\\text{\\AA}^{-1}$, $r^0_{\\text{Fe}}=2.47\\,\\text{\\AA}$; $D_{\\text{Ni}}=0.60\\,\\text{eV}$, $A_{\\text{Ni}}=1.50\\,\\text{\\AA}^{-1}$, $r^0_{\\text{Ni}}=2.45\\,\\text{\\AA}$. Mixing rules as defined above.\n- Target volume $V_0 = 95.5\\,\\text{\\AA}^3$, bulk stiffness $K=0.0105\\,\\text{eV}/\\text{\\AA}^6$.\n\nUse the following fixed SQS-like fractional coordinates $\\{s_I\\}$ for $N=8$ atoms in a $1\\times 1\\times 1$ cubic cell, chosen to yield diverse near-neighbor environments:\n$$\ns_1=(0.10,0.10,0.10),\\; s_2=(0.60,0.10,0.10),\\; s_3=(0.10,0.60,0.10),\\; s_4=(0.10,0.10,0.60),\\\\\ns_5=(0.60,0.60,0.10),\\; s_6=(0.60,0.10,0.60),\\; s_7=(0.10,0.60,0.60),\\; s_8=(0.60,0.60,0.60).\n$$\nAssign species as $(\\text{Co},\\text{Cr},\\text{Fe},\\text{Ni},\\text{Co},\\text{Cr},\\text{Fe},\\text{Ni})$ to $s_1,\\dots,s_8$ respectively.\n\nYour program must:\n- Compute $E(\\{R_I\\},a)$, $\\{F_I\\}$, and $P_{\\text{total}}$ from the above definitions.\n- Perform constrained relaxation with backtracking line search on both atomic positions and $a$ until convergence or a maximum number of iterations is reached.\n- Apply the convergence criteria in the specified units: forces in $\\text{eV}/\\text{\\AA}$ and stress in GPa.\n\nTest suite. Run the relaxation for the following three cases:\n1. Case A (happy path): initial lattice parameter $a_0=4.30\\,\\text{\\AA}$, force tolerance $F_{\\text{tol}}=0.05\\,\\text{eV}/\\text{\\AA}$, stress tolerance $S_{\\text{tol}}=2.0\\,\\text{GPa}$, maximum iterations $N_{\\text{max}}=1000$.\n2. Case B (stringent boundary): initial lattice parameter $a_0=4.30\\,\\text{\\AA}$, force tolerance $F_{\\text{tol}}=0.001\\,\\text{eV}/\\text{\\AA}$, stress tolerance $S_{\\text{tol}}=0.10\\,\\text{GPa}$, maximum iterations $N_{\\text{max}}=500$.\n3. Case C (high stress edge): initial lattice parameter $a_0=3.80\\,\\text{\\AA}$, force tolerance $F_{\\text{tol}}=0.05\\,\\text{eV}/\\text{\\AA}$, stress tolerance $S_{\\text{tol}}=2.0\\,\\text{GPa}$, maximum iterations $N_{\\text{max}}=1200$.\n\nFinal output specification. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is a boolean indicating whether convergence was achieved for the corresponding test case in the order A, B, C. For example, the output format must be exactly like $[\\text{True},\\text{False},\\text{True}]$ (with no spaces tolerated or any extra text). All angles, if any, must be in radians, and all physical values must be handled in their respective units precisely as stated above; specifically, express forces in $\\text{eV}/\\text{\\AA}$ and stress in GPa.",
            "solution": "The user has provided a valid, well-posed problem statement that is scientifically grounded. The objective is to implement a constrained structural relaxation for a model of a high-entropy alloy (HEA) and test its convergence under different conditions. The solution involves minimizing a defined energy functional with respect to both atomic positions and the lattice parameter.\n\nThe core of the solution is to derive the analytical gradients of the total energy and then use them in an iterative optimization scheme. The process is as follows:\n\n**1. Energy Functional and System Definition**\n\nThe total energy of the 8-atom equiatomic Co-Cr-Fe-Ni system is given by a surrogate functional:\n$$\nE(\\{R_I\\},a) = \\sum_{I<J} V_{\\alpha_I \\alpha_J}(r_{IJ}) + \\frac{1}{2}\\,K\\,(V - V_0)^2\n$$\nwhere $\\{R_I\\}$ are the Cartesian coordinates of the atoms, $a$ is the cubic lattice parameter, and $V=a^3$ is the cell volume. The sum runs over all unique pairs of atoms. The species of atom $I$ is denoted $\\alpha_I$. The pairwise interaction $V_{\\alpha \\beta}(r)$ is a Morse potential:\n$$\nV_{\\alpha \\beta}(r) = D_{\\alpha \\beta}\\left[\\left(1 - e^{-A_{\\alpha \\beta}(r - r^0_{\\alpha \\beta})}\\right)^2 - 1\\right]\n$$\nThe problem specifies the use of fractional coordinates $s_I$ such that $R_I = a \\cdot s_I$. Interatomic distances $r_{IJ} = |R_J - R_I|$ are calculated using the minimum image convention (MIC) for periodic boundary conditions. In fractional coordinates, the displacement vector is $\\Delta s = s_J - s_I$, and its components are wrapped to the interval $[-0.5, 0.5]$ before calculating the Cartesian distance: $\\Delta s_{\\text{mic}, k} = \\Delta s_k - \\text{round}(\\Delta s_k)$, so $r_{IJ} = a \\sqrt{(\\Delta s_{\\text{mic}})^2}$.\n\n**2. Derivation of Gradients for Optimization**\n\nThe relaxation proceeds via gradient descent, which requires the analytical derivatives of the energy functional.\n\n**2.1. Atomic Forces**\n\nThe force on atom $I$, $F_I$, is the negative gradient of the energy with respect to its Cartesian position $R_I$:\n$$\nF_I = -\\frac{\\partial E}{\\partial R_I}\n$$\nThe volume-dependent term does not explicitly depend on individual atomic positions, only on the cell volume. Thus, the forces arise solely from the pairwise Morse potential term. Using the chain rule:\n$$\nF_I = -\\frac{\\partial}{\\partial R_I} \\sum_{J \\neq I} V_{\\alpha_I \\alpha_J}(r_{IJ}) = -\\sum_{J \\neq I} \\frac{dV_{\\alpha_I \\alpha_J}}{dr_{IJ}} \\frac{\\partial r_{IJ}}{\\partial R_I}\n$$\nSince $r_{IJ} = \\sqrt{(R_J - R_I) \\cdot (R_J - R_I)}$, its gradient is $\\frac{\\partial r_{IJ}}{\\partial R_I} = \\frac{R_I - R_J}{r_{IJ}}$. Substituting this gives:\n$$\nF_I = \\sum_{J \\neq I} \\left( -\\frac{dV_{\\alpha_I \\alpha_J}}{dr_{IJ}} \\right) \\frac{R_J - R_I}{r_{IJ}}\n$$\nThe derivative of the Morse potential with respect to distance $r$ is:\n$$\n\\frac{dV_{\\alpha \\beta}}{dr} = D_{\\alpha \\beta} \\cdot 2 \\left(1 - e^{-A_{\\alpha \\beta}(r - r^0_{\\alpha \\beta})}\\right) \\cdot \\left(-e^{-A_{\\alpha \\beta}(r - r^0_{\\alpha \\beta})}\\right) \\cdot (-A_{\\alpha \\beta})\n$$\n$$\n\\frac{dV_{\\alpha \\beta}}{dr} = 2 A_{\\alpha \\beta} D_{\\alpha \\beta} \\ e^{-A_{\\alpha \\beta}(r - r^0_{\\alpha \\beta})} \\left(1 - e^{-A_{\\alpha \\beta}(r - r^0_{\\alpha \\beta})}\\right)\n$$\nThese forces are computed for all atoms and used as the direction for updating atomic positions.\n\n**2.2. Gradient with respect to Lattice Parameter**\n\nThe gradient of the energy with respect to the lattice parameter $a$ is needed to relax the cell volume.\n$$\n\\frac{\\partial E}{\\partial a} = \\frac{\\partial}{\\partial a} \\left( \\sum_{I<J} V_{\\alpha_I \\alpha_J}(r_{IJ}) + \\frac{1}{2}\\,K\\,(a^3 - V_0)^2 \\right)\n$$\nApplying the chain rule to both terms:\n$$\n\\frac{\\partial E}{\\partial a} = \\sum_{I<J} \\frac{dV_{\\alpha_I \\alpha_J}}{dr_{IJ}} \\frac{\\partial r_{IJ}}{\\partial a} + K(a^3 - V_0)\\frac{\\partial(a^3)}{\\partial a}\n$$\nSince $r_{IJ} = a \\cdot \\|\\Delta s_{IJ, \\text{mic}}\\|$, we have $\\frac{\\partial r_{IJ}}{\\partial a} = \\|\\Delta s_{IJ, \\text{mic}}\\| = \\frac{r_{IJ}}{a}$. The derivative of the volume term is $\\frac{\\partial(a^3)}{\\partial a} = 3a^2$.\n$$\n\\frac{\\partial E}{\\partial a} = \\sum_{I<J} \\frac{1}{a} \\left(r_{IJ} \\frac{dV_{\\alpha_I \\alpha_J}}{dr_{IJ}}\\right) + 3Ka^2(a^3 - V_0)\n$$\nThis expression can be related to the total hydrostatic pressure $P_{\\text{total}}$. The virial pressure is $P_{\\text{virial}} = \\frac{1}{3V}\\sum_{I<J} (-r_{IJ}\\,\\frac{dV}{dr})$, and the bulk pressure is $P_{\\text{bulk}} = -K(V-V_0)$.\n$$\n\\sum_{I<J} r_{IJ} \\frac{dV}{dr} = -3V P_{\\text{virial}} = -3a^3 P_{\\text{virial}}\n$$\nSubstituting this into the expression for $\\frac{\\partial E}{\\partial a}$:\n$$\n\\frac{\\partial E}{\\partial a} = \\frac{1}{a}(-3a^3 P_{\\text{virial}}) + 3Ka^2(a^3 - V_0) = -3a^2 P_{\\text{virial}} - 3a^2 P_{\\text{bulk}} = -3a^2 P_{\\text{total}}\n$$\nThus, the gradient descent update for $a$ is driven by the total pressure: a positive pressure (system is compressed) leads to an increase in $a$, and a negative pressure (system is stretched) leads to a decrease in $a$.\n\n**3. Optimization Algorithm: Projected Gradient Descent with Backtracking**\n\nA block coordinate descent approach is employed, where atomic positions and the lattice parameter are updated sequentially within each iteration. Both updates use a simple backtracking line search to ensure the total energy decreases.\n\n**For Atomic Positions:**\n1.  Calculate forces $F_I$ for all atoms. This is the search direction (proportional to the negative gradient).\n2.  Project out rigid translational motion: calculate the center-of-mass force $F_{CM} = \\frac{1}{N}\\sum_I F_I$, and update the search direction for each atom to $F'_I = F_I - F_{CM}$.\n3.  Propose an update to the fractional coordinates: $s'_{I} = s_I + \\alpha_{pos} F'_I$. The initial step size $\\alpha_{pos}$ is chosen adaptively.\n4.  Use a backtracking line search: If $E(s', a) > E(s, a)$, reduce $\\alpha_{pos}$ (e.g., by half) and repeat step 3. Otherwise, accept the new positions $s'$.\n5.  Apply periodic boundary conditions by wrapping the new fractional coordinates into the $[0, 1)$ interval.\n\n**For the Lattice Parameter:**\n1.  Calculate the total pressure $P_{\\text{total}}$. The update direction is proportional to $P_{\\text{total}}$.\n2.  Propose an update to the lattice parameter: $a' = a + \\alpha_{a} P_{\\text{total}}$. The step size $\\alpha_a$ is chosen adaptively.\n3.  Use a backtracking line search: If $E(s, a') > E(s, a)$, reduce $\\alpha_{a}$ and repeat step 2. Otherwise, accept the new lattice parameter $a'$.\n\nThe relaxation proceeds iteratively until the convergence criteria are met: the maximum force magnitude on any atom falls below $F_{\\text{tol}}$ and the absolute total pressure falls below $S_{\\text{tol}}$. $S_{\\text{tol}}$ is given in GPa, so the calculated pressure in eV/Å³ is converted using the provided factor.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the constrained relaxation simulation for three test cases.\n    \"\"\"\n    \n    # --- Physical Constants and Conversion Factors ---\n    GPA_CONVERSION = 160.21766208  # 1 eV/A^3 = 160.217... GPa\n\n    # --- System and Model Parameters ---\n    # Species set: {Co, Cr, Fe, Ni} labeled as {0, 1, 2, 3}\n    species_map = {'Co': 0, 'Cr': 1, 'Fe': 2, 'Ni': 3}\n    \n    # Morse parameters for single species (D [eV], A [1/A], r0 [A])\n    morse_params = {\n        0: {'D': 0.55, 'A': 1.45, 'r0': 2.45},  # Co\n        1: {'D': 0.50, 'A': 1.40, 'r0': 2.48},  # Cr\n        2: {'D': 0.58, 'A': 1.48, 'r0': 2.47},  # Fe\n        3: {'D': 0.60, 'A': 1.50, 'r0': 2.45},  # Ni\n    }\n    \n    # Build pairwise parameters using mixing rules\n    num_species = len(species_map)\n    D_matrix = np.zeros((num_species, num_species))\n    A_matrix = np.zeros((num_species, num_species))\n    r0_matrix = np.zeros((num_species, num_species))\n    for i in range(num_species):\n        for j in range(i, num_species):\n            D_matrix[i, j] = D_matrix[j, i] = np.sqrt(morse_params[i]['D'] * morse_params[j]['D'])\n            A_matrix[i, j] = A_matrix[j, i] = 0.5 * (morse_params[i]['A'] + morse_params[j]['A'])\n            r0_matrix[i, j] = r0_matrix[j, i] = 0.5 * (morse_params[i]['r0'] + morse_params[j]['r0'])\n\n    # Bulk parameters\n    V0 = 95.5  # A^3\n    K = 0.0105  # eV/A^6\n    \n    # Initial SQS-like configuration\n    frac_coords_initial = np.array([\n        [0.10, 0.10, 0.10], [0.60, 0.10, 0.10], [0.10, 0.60, 0.10], [0.10, 0.10, 0.60],\n        [0.60, 0.60, 0.10], [0.60, 0.10, 0.60], [0.10, 0.60, 0.60], [0.60, 0.60, 0.60]\n    ])\n    species_ids = np.array([0, 1, 2, 3, 0, 1, 2, 3], dtype=int)\n    num_atoms = len(species_ids)\n    \n    # --- Core Calculation Engine ---\n    def calculate_system_properties(frac_coords, a, species):\n        \"\"\"Calculates total energy, atomic forces, and total pressure.\"\"\"\n        \n        cart_coords = frac_coords * a\n        volume = a**3\n        \n        energy = 0.0\n        forces = np.zeros_like(cart_coords)\n        virial_sum = 0.0  # Sum of -r * dV/dr for pressure calculation\n        \n        for i in range(num_atoms):\n            for j in range(i + 1, num_atoms):\n                # Minimum Image Convention\n                frac_disp = frac_coords[j] - frac_coords[i]\n                frac_disp_mic = frac_disp - np.round(frac_disp)\n                cart_disp_mic = frac_disp_mic * a\n                r_ij = np.linalg.norm(cart_disp_mic)\n                \n                # Pair parameters\n                sp_i, sp_j = species[i], species[j]\n                D_ij = D_matrix[sp_i, sp_j]\n                A_ij = A_matrix[sp_i, sp_j]\n                r0_ij = r0_matrix[sp_i, sp_j]\n                \n                # Morse potential calculation\n                exp_term = np.exp(-A_ij * (r_ij - r0_ij))\n                energy += D_ij * ((1 - exp_term)**2 - 1)\n                \n                # Force and virial calculation\n                # dV/dr = 2*A*D*exp(-A(r-r0))*(1-exp(-A(r-r0)))\n                dv_dr = 2 * A_ij * D_ij * exp_term * (1 - exp_term)\n                \n                virial_sum += -r_ij * dv_dr\n                \n                # Force is -dV/dr * (rij_vec / |rij_vec|)\n                force_magnitude = -dv_dr\n                if r_ij > 1e-9: # Avoid division by zero\n                    force_vec = force_magnitude * (cart_disp_mic / r_ij)\n                    forces[i] += force_vec\n                    forces[j] -= force_vec\n        \n        # Add bulk term to energy\n        energy += 0.5 * K * (volume - V0)**2\n        \n        # Calculate pressure components\n        p_virial = (1.0 / (3.0 * volume)) * virial_sum if volume > 1e-9 else 0.0\n        p_bulk = -K * (volume - V0)\n        p_total = p_virial + p_bulk # in eV/A^3\n        \n        return energy, forces, p_total\n\n    # --- Relaxation Algorithm ---\n    def run_relaxation(a_init, f_tol, s_tol, n_max):\n        \"\"\"Performs the constrained relaxation for a given set of parameters.\"\"\"\n        a = a_init\n        frac_coords = frac_coords_initial.copy()\n\n        # Adaptive step size scaling factors (heuristic)\n        alpha_pos_scale = 0.02\n        alpha_a_scale = 0.1\n\n        for step in range(n_max):\n            energy, forces, p_total = calculate_system_properties(frac_coords, a, species_ids)\n            \n            # --- Convergence Check ---\n            max_force = np.max(np.linalg.norm(forces, axis=1))\n            pressure_gpa = abs(p_total * GPA_CONVERSION)\n            if max_force <= f_tol and pressure_gpa <= s_tol:\n                return True\n            \n            # --- Position Update (Projected Gradient Descent) ---\n            # Search direction is the force vector\n            pos_search_dir = forces\n            # Project out center-of-mass motion\n            com_motion = np.mean(pos_search_dir, axis=0)\n            proj_pos_search_dir = pos_search_dir - com_motion\n            \n            # Backtracking line search for positions\n            alpha_pos = alpha_pos_scale / (max_force + 1e-6)\n            for _ in range(5):  # Max 5 backtracking steps\n                frac_coords_trial = frac_coords + alpha_pos * proj_pos_search_dir\n                \n                # Wrap coordinates into [0, 1) box\n                frac_coords_trial -= np.floor(frac_coords_trial)\n                \n                energy_trial, _, _ = calculate_system_properties(frac_coords_trial, a, species_ids)\n                if energy_trial < energy:\n                    frac_coords = frac_coords_trial\n                    energy = energy_trial\n                    break\n                alpha_pos /= 2.0\n            \n            # --- Lattice Parameter Update (Gradient Descent) ---\n            # Search direction is proportional to pressure: -dE/da = 3*a^2*P_total\n            a_search_dir = 3.0 * a**2 * p_total\n            \n            # Backtracking line search for lattice parameter `a`\n            alpha_a = alpha_a_scale / (abs(3.0 * a**2 * p_total) + 1e-6)\n            for _ in range(5):\n                a_trial = a + alpha_a * a_search_dir\n                if a_trial <= 0: # Prevent invalid lattice parameter\n                    alpha_a /= 2.0\n                    continue\n                \n                energy_trial, _, _ = calculate_system_properties(frac_coords, a_trial, species_ids)\n                if energy_trial < energy:\n                    a = a_trial\n                    break\n                alpha_a /= 2.0\n                \n        return False\n        \n    # --- Test Cases ---\n    test_cases = [\n        # Case A: happy path\n        {'a_init': 4.30, 'f_tol': 0.05, 's_tol': 2.0, 'n_max': 1000},\n        # Case B: stringent boundary\n        {'a_init': 4.30, 'f_tol': 0.001, 's_tol': 0.10, 'n_max': 500},\n        # Case C: high stress edge\n        {'a_init': 3.80, 'f_tol': 0.05, 's_tol': 2.0, 'n_max': 1200},\n    ]\n\n    results = []\n    for case in test_cases:\n        converged = run_relaxation(case['a_init'], case['f_tol'], case['s_tol'], case['n_max'])\n        results.append(str(converged))\n\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solver\nsolve()\n\n```"
        },
        {
            "introduction": "After determining the ground-state energy of an alloy, a critical step is to place this energy in a meaningful thermodynamic context by calculating its formation energy. This quantity determines the alloy's stability relative to its constituent elements and is essential for predicting phase stability. This practice  guides you through the calculation of formation energy and highlights the critical importance of using correct, stable elemental reference states to ensure the physical and thermodynamic accuracy of your results.",
            "id": "3737564",
            "problem": "You are given a computational task grounded in Density Functional Theory (DFT) for ground-state properties within the context of high-entropy alloys and complex materials modeling. From first principles, the ground-state total energy functional is minimized by the ground-state electron density, and the energy per atom in a solid solution depends on the composition and the elemental chemical potentials chosen as references. When elemental references are not the true ground-state phases (i.e., metastable structures are used), the computed formation energies are systematically shifted. Your task is to formalize this as a mathematical derivation and implement a program that quantifies the effect, then corrects the formation energies using stable elemental references.\n\nFormally define the formation energy per atom of a multicomponent solid solution in terms of the ground-state total energy per atom, the composition fractions, and the elemental chemical potentials, starting from the variational principle of DFT for the ground-state. Using that base, derive the expression showing how formation energies computed with metastable elemental references differ from those computed with stable ground-state references. Clearly identify the correction term in terms of the composition and the differences between metastable and stable elemental reference energies. Use this derivation to design an algorithm that, for each case in the test suite, computes two quantities:\n- The uncorrected formation energy per atom using metastable elemental references.\n- The corrected formation energy per atom using stable elemental references.\n\nAll energies are to be expressed in electronvolts per atom (eV/atom). The composition fractions must be treated as dimensionless numbers that sum to one. No angles are involved. All outputs must be numerical floats.\n\nTest Suite (each case provides the alloy energy per atom, the composition fractions, and arrays of metastable and stable elemental reference energies in eV/atom, aligned by element order):\n\n- Case 1 (happy path): Ternary alloy with equiatomic composition.\n  - Elements: Ni, Co, Cr\n  - Alloy energy per atom: $E_{\\text{alloy}} = -207.7063333333$ eV/atom\n  - Composition: $\\mathbf{x} = [\\tfrac{1}{3}, \\tfrac{1}{3}, \\tfrac{1}{3}]$\n  - Stable references: $\\boldsymbol{\\mu} = [-204.789, -206.650, -211.590]$ eV/atom\n  - Metastable references: $\\tilde{\\boldsymbol{\\mu}} = [-204.777, -206.625, -211.572]$ eV/atom\n\n- Case 2 (boundary: pure element): Single-component solid.\n  - Elements: Co\n  - Alloy energy per atom: $E_{\\text{alloy}} = -206.650$ eV/atom\n  - Composition: $\\mathbf{x} = [1.0]$\n  - Stable references: $\\boldsymbol{\\mu} = [-206.650]$ eV/atom\n  - Metastable references: $\\tilde{\\boldsymbol{\\mu}} = [-206.625]$ eV/atom\n\n- Case 3 (edge: metastable equals stable for one element, nonzero for another; also demonstrates sign flip):\n  - Elements: Ni, Co\n  - Alloy energy per atom: $E_{\\text{alloy}} = -205.7095$ eV/atom\n  - Composition: $\\mathbf{x} = [0.5, 0.5]$\n  - Stable references: $\\boldsymbol{\\mu} = [-204.789, -206.650]$ eV/atom\n  - Metastable references: $\\tilde{\\boldsymbol{\\mu}} = [-204.789, -206.625]$ eV/atom\n\n- Case 4 (edge: no correction needed because metastable equals stable for all elements):\n  - Elements: Fe, Ni, Cr\n  - Alloy energy per atom: $E_{\\text{alloy}} = -208.468$ eV/atom\n  - Composition: $\\mathbf{x} = [\\tfrac{1}{3}, \\tfrac{1}{3}, \\tfrac{1}{3}]$\n  - Stable references: $\\boldsymbol{\\mu} = [-208.980, -204.789, -211.590]$ eV/atom\n  - Metastable references: $\\tilde{\\boldsymbol{\\mu}} = [-208.980, -204.789, -211.590]$ eV/atom\n\nYour program must:\n- For each case, compute the uncorrected formation energy per atom using metastable references and the corrected formation energy per atom using stable references, both in eV/atom.\n- Aggregate the results into a single line of output containing a list of lists, where each inner list is of the form $[E^{\\text{uncorr}}, E^{\\text{corr}}]$, both as floats in eV/atom, in the same order as the test cases.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The items are the four inner lists corresponding to the four cases, each itself a comma-separated pair of floats, for example: `[[e11,e12],[e21,e22],[e31,e32],[e41,e42]]`. All numeric values implicitly carry the unit eV/atom as specified above.",
            "solution": "The problem requires the derivation and implementation of a correction for formation energies in multicomponent alloys when computed using metastable, rather than stable, elemental reference energies. The foundation of this problem lies in the variational principle of Density Functional Theory (DFT), which states that the ground-state total energy of a system is a unique functional of the ground-state electron density and is minimized by it.\n\nFirst, we formalize the definition of the formation energy per atom, $E_f$, for an $N$-component solid solution. Let the alloy be described by a set of composition fractions $\\mathbf{x} = \\{x_1, x_2, \\dots, x_N\\}$, where $\\sum_{i=1}^N x_i = 1$. The total energy per atom of the alloy, as computed from first principles (e.g., via DFT), is denoted as $E_{\\text{alloy}}$.\n\nThe formation energy represents the change in energy upon forming the alloy from its constituent elements in their standard reference states. The standard reference state for an element $i$ is typically its thermodynamic ground-state crystal structure at zero temperature and pressure (e.g., face-centered cubic for Ni, body-centered cubic for Cr). The chemical potential, $\\mu_i$, for element $i$ is defined as the ground-state total energy per atom of this stable reference phase.\n\nThe formation energy per atom computed with respect to these stable elemental references, which we will denote as the corrected formation energy, $E^{\\text{corr}}$, is defined as:\n$$\nE^{\\text{corr}} = E_{\\text{alloy}} - \\sum_{i=1}^{N} x_i \\mu_i\n$$\nHere, $\\boldsymbol{\\mu} = \\{\\mu_1, \\mu_2, \\dots, \\mu_N\\}$ represents the vector of energies per atom for the elements in their stable ground-state phases.\n\nIn computational practice, it is sometimes convenient or necessary to use elemental references that are not the true ground states. For instance, to maintain structural consistency in a study of FCC alloys, one might use an FCC structure for an element like Cr, even though its ground state is BCC. Such a reference is metastable, meaning its energy is higher than the true ground state. Let us denote the vector of these metastable reference energies as $\\tilde{\\boldsymbol{\\mu}} = \\{\\tilde{\\mu}_1, \\tilde{\\mu}_2, \\dots, \\tilde{\\mu}_N\\}$.\n\nThe formation energy computed using these metastable references, which we will call the uncorrected formation energy, $E^{\\text{uncorr}}$, is given by an analogous expression:\n$$\nE^{\\text{uncorr}} = E_{\\text{alloy}} - \\sum_{i=1}^{N} x_i \\tilde{\\mu}_i\n$$\n\nOur objective is to derive the relationship between $E^{\\text{corr}}$ and $E^{\\text{uncorr}}$ and identify the correction term. We can express $E_{\\text{alloy}}$ from the second equation:\n$$\nE_{\\text{alloy}} = E^{\\text{uncorr}} + \\sum_{i=1}^{N} x_i \\tilde{\\mu}_i\n$$\nNow, we substitute this expression for $E_{\\text{alloy}}$ into the equation for the corrected formation energy, $E^{\\text{corr}}$:\n$$\nE^{\\text{corr}} = \\left( E^{\\text{uncorr}} + \\sum_{i=1}^{N} x_i \\tilde{\\mu}_i \\right) - \\sum_{i=1}^{N} x_i \\mu_i\n$$\nBy combining the summation terms, we arrive at the final relationship:\n$$\nE^{\\text{corr}} = E^{\\text{uncorr}} + \\sum_{i=1}^{N} x_i (\\tilde{\\mu}_i - \\mu_i)\n$$\nThis equation reveals that the corrected formation energy is equal to the uncorrected formation energy plus a correction term, $\\Delta E_{\\text{corr}}$. This correction term is the composition-weighted average of the energy differences between the metastable and stable elemental references. For each element $i$, the term $(\\tilde{\\mu}_i - \\mu_i)$ represents the energy penalty for using a metastable structure instead of the stable ground state. Since $\\tilde{\\mu}_i \\ge \\mu_i$ by definition of the ground state, this difference is always non-negative.\n\nThe algorithm to solve the problem is a direct implementation of these derived formulas. For each test case, we are given $E_{\\text{alloy}}$, the composition vector $\\mathbf{x}$, the stable reference energies $\\boldsymbol{\\mu}$, and the metastable reference energies $\\tilde{\\boldsymbol{\\mu}}$.\n\nThe algorithm proceeds as follows for each case:\n1.  Compute the composition-weighted average of the metastable reference energies: $\\sum_{i} x_i \\tilde{\\mu}_i$. This can be performed efficiently using a dot product, $\\mathbf{x} \\cdot \\tilde{\\boldsymbol{\\mu}}$.\n2.  Calculate the uncorrected formation energy: $E^{\\text{uncorr}} = E_{\\text{alloy}} - \\mathbf{x} \\cdot \\tilde{\\boldsymbol{\\mu}}$.\n3.  Compute the composition-weighted average of the stable reference energies: $\\sum_{i} x_i \\mu_i$, or $\\mathbf{x} \\cdot \\boldsymbol{\\mu}$.\n4.  Calculate the corrected formation energy: $E^{\\text{corr}} = E_{\\text{alloy}} - \\mathbf{x} \\cdot \\boldsymbol{\\mu}$.\n5.  Return the pair $[E^{\\text{uncorr}}, E^{\\text{corr}}]$.\n\nThis procedure is applied to all provided test cases.\n\nFor Case 1:\n- $E_{\\text{alloy}} = -207.7063333333$ eV/atom\n- $\\mathbf{x} = [\\frac{1}{3}, \\frac{1}{3}, \\frac{1}{3}]$\n- $\\boldsymbol{\\mu} = [-204.789, -206.650, -211.590]$ eV/atom\n- $\\tilde{\\boldsymbol{\\mu}} = [-204.777, -206.625, -211.572]$ eV/atom\nThe weighted metastable average is $\\mathbf{x} \\cdot \\tilde{\\boldsymbol{\\mu}} = \\frac{1}{3}(-204.777 - 206.625 - 211.572) = -207.658$.\n$E^{\\text{uncorr}} = -207.7063333333 - (-207.658) \\approx -0.04833333$.\nThe weighted stable average is $\\mathbf{x} \\cdot \\boldsymbol{\\mu} = \\frac{1}{3}(-204.789 - 206.650 - 211.590) \\approx -207.67633333$.\n$E^{\\text{corr}} = -207.7063333333 - (-207.6763333333) = -0.03$.\n\nFor Case 2 (pure element):\n- $E_{\\text{alloy}} = -206.650$ eV/atom (which is equal to $\\mu_1$)\n- $\\mathbf{x} = [1.0]$\n- $\\boldsymbol{\\mu} = [-206.650]$ eV/atom\n- $\\tilde{\\boldsymbol{\\mu}} = [-206.625]$ eV/atom\n$E^{\\text{uncorr}} = -206.650 - (1.0 \\times -206.625) = -0.025$.\n$E^{\\textcorr}} = -206.650 - (1.0 \\times -206.650) = 0.0$. This is expected, as the formation energy of a pure element from itself is zero.\n\nThis method is general and robust, accurately handling multicomponent systems, pure elements, and cases where some or all reference energies are identical between the two sets.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates uncorrected and corrected formation energies for a series of alloys.\n\n    The problem defines the formation energy of an alloy as the difference between\n    the alloy's total energy per atom and the composition-weighted average of the\n    elemental chemical potentials (reference energies).\n\n    - Uncorrected formation energy (E_uncorr) uses metastable elemental references.\n    - Corrected formation energy (E_corr) uses stable ground-state elemental references.\n\n    The derivation is as follows:\n    E_uncorr = E_alloy - sum(x_i * mu_metastable_i)\n    E_corr   = E_alloy - sum(x_i * mu_stable_i)\n\n    The code implements these two formulas for each test case.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (E_alloy, composition_x, stable_refs_mu, metastable_refs_tilde_mu)\n    # All energies are in eV/atom. Compositions are dimensionless fractions.\n    test_cases = [\n        # Case 1: Ternary alloy\n        (\n            -207.7063333333,\n            [1/3, 1/3, 1/3],\n            [-204.789, -206.650, -211.590],\n            [-204.777, -206.625, -211.572]\n        ),\n        # Case 2: Pure element\n        (\n            -206.650,\n            [1.0],\n            [-206.650],\n            [-206.625]\n        ),\n        # Case 3: Binary alloy with one element's refs being equal\n        (\n            -205.7095,\n            [0.5, 0.5],\n            [-204.789, -206.650],\n            [-204.789, -206.625]\n        ),\n        # Case 4: No correction needed as all refs are equal\n        (\n            -208.468,\n            [1/3, 1/3, 1/3],\n            [-208.980, -204.789, -211.590],\n            [-208.980, -204.789, -211.590]\n        ),\n    ]\n\n    results = []\n    for case in test_cases:\n        e_alloy, x, mu_stable, mu_metastable = case\n        \n        # Convert lists to numpy arrays for efficient vector operations\n        x_np = np.array(x)\n        mu_stable_np = np.array(mu_stable)\n        mu_metastable_np = np.array(mu_metastable)\n\n        # Calculate the composition-weighted average of reference energies\n        # using the dot product.\n        weighted_mu_stable = np.dot(x_np, mu_stable_np)\n        weighted_mu_metastable = np.dot(x_np, mu_metastable_np)\n\n        # Calculate the uncorrected formation energy using metastable references\n        e_uncorr = e_alloy - weighted_mu_metastable\n\n        # Calculate the corrected formation energy using stable references\n        e_corr = e_alloy - weighted_mu_stable\n        \n        results.append([e_uncorr, e_corr])\n\n    # Format the final output string exactly as required.\n    # The string must be in the format: [[val1,val2],[val3,val4],...]\n    inner_strings = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output = f\"[{','.join(inner_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}