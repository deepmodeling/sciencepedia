{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握Metropolis算法，最好的方法莫过于亲手实践。本章将通过一系列精心设计的练习，引导您从核心概念走向实际应用。第一个练习聚焦于Metropolis算法的心脏——接受概率的计算。我们将为一个具体提出的移动计算其接受概率，这是任何Metropolis模拟中最基本的决策步骤。这个练习将阐明算法如何利用目标概率分布来决定是否接受一个新状态。",
            "id": "1371728",
            "problem": "一位数据科学家正在实现一个马尔可夫链蒙特卡洛（MCMC）模拟，以从参数 $x$ 的后验概率分布中抽取样本。目标分布 $\\pi(x)$ 与该参数负绝对值的指数成正比，即 $\\pi(x) \\propto \\exp(-|x|)$。\n\n该科学家使用梅特罗波利斯算法，并采用一个对称的提议分布 $g(x'|x)$，其中在给定当前状态 $x$ 的条件下提议一个新状态 $x'$ 的概率，等于在给定 $x'$ 的条件下提议 $x$ 的概率（即 $g(x'|x) = g(x|x')$）。\n\n假设在模拟的某一步中，马尔可夫链的当前状态为 $x = 1.5$。该算法接着提议转移到一个新的候选状态 $x' = 2.0$。\n\n计算这一特定转移的接受概率。你的答案应该是一个无量纲的实数。将最终答案四舍五入到四位有效数字。",
            "solution": "对于从 $x$ 到 $x'$ 的转移，在对称提议分布 $g(x'|x)=g(x|x')$ 的情况下，梅特罗波利斯接受概率为\n$$\n\\alpha(x \\to x')=\\min\\left(1,\\frac{\\pi(x')g(x|x')}{\\pi(x)g(x'|x)}\\right)=\\min\\left(1,\\frac{\\pi(x')}{\\pi(x)}\\right).\n$$\n给定目标分布 $\\pi(x)\\propto \\exp(-|x|)$，该比率可简化为\n$$\n\\frac{\\pi(x')}{\\pi(x)}=\\frac{\\exp(-|x'|)}{\\exp(-|x|)}=\\exp\\!\\left(-\\left(|x'|-|x|\\right)\\right).\n$$\n当 $x=1.5$ 且 $x'=2.0$ 时，我们有 $|x|=1.5$ 和 $|x'|=2.0$，因此\n$$\n\\frac{\\pi(x')}{\\pi(x)}=\\exp\\!\\left(-\\left(2.0-1.5\\right)\\right)=\\exp(-0.5).\n$$\n因此，\n$$\n\\alpha(x \\to x')=\\min\\left(1,\\exp(-0.5)\\right)=\\exp(-0.5).\n$$\n在数值上，当四舍五入到四位有效数字时，$\\exp(-0.5)\\approx 0.6065$。",
            "answer": "$$\\boxed{0.6065}$$"
        },
        {
            "introduction": "在掌握了单步计算的基础上，这个练习将模拟一个粒子在几步之内的运动轨迹。通过手动追踪算法的每一步，您将具体地感受到能量变化和随机数如何共同引导系统的演化。这个练习尤其富有启发性，因为它涉及到一个双阱势，这是模拟具有亚稳态系统的常用模型，让您直观地理解粒子如何在势能面上“探索”。",
            "id": "2005950",
            "problem": "一位纳米技术专家正在研究一个分子开关，其状态可以用一个粒子的一维位置 $x$ 来表示。该粒子的势能（以任意单位计）由双势阱函数 $U(x) = \\alpha x^4 - \\gamma x^2$ 描述，其中常数 $\\alpha = 1.0$ 且 $\\gamma = 8.0$。粒子与一个热浴接触，其行为可以通过基于 Metropolis 算法的蒙特卡罗模拟来建模。系统的特征是一个恒定的逆温度 $\\beta = \\frac{1}{k_B T} = 2.0$。\n\n模拟以离散步进行。在每一步中，通过将粒子的当前位置 $x_{current}$ 更改为新位置 $x_{trial} = x_{current} + \\Delta x$ 来提出一次尝试移动。位移 $\\Delta x$ 是一个预先确定的随机值。然后根据 Metropolis 准则来接受或拒绝这次尝试移动：\n1. 如果能量变化 $\\Delta U = U(x_{trial}) - U(x_{current})$ 小于或等于零，则该移动总是被接受。\n2. 如果 $\\Delta U > 0$，则该移动以概率 $P_{accept} = \\exp(-\\beta \\Delta U)$ 被接受。为了实现这一点，从 $[0,1)$ 上的均匀分布中抽取一个随机数 $r$。如果 $r  P_{accept}$，则接受该移动；否则，拒绝该移动。\n3. 如果移动被接受，新位置为 $x_{trial}$。如果被拒绝，粒子保持在 $x_{current}$。\n\n粒子初始时被放置在与势能函数 $U(x)$ 的*值为负的*局部最小值对应的位置上。你需要计算经过恰好 5 个 Metropolis 步骤后粒子的位置。\n\n提供了以下两个包含 5 个预先确定的随机数的序列：\n- 建议的步长位移序列 $\\Delta x$：$\\{0.30, -0.40, 0.10, 0.20, -0.25\\}$\n- 用于接受性检查的随机数序列 $r$：$\\{0.51, 0.12, 0.65, 0.83, 0.47\\}$\n\n计算这 5 步之后粒子的最终位置。以数值形式报告你的答案，并四舍五入到三位有效数字。",
            "solution": "势能由 $U(x)=\\alpha x^{4}-\\gamma x^{2}$ 给出，其中 $\\alpha=1$ 和 $\\gamma=8$，所以 $U(x)=x^{4}-8x^{2}$。驻点满足 $U'(x)=4x^{3}-16x=4x(x^{2}-4)=0$，解得 $x=0, \\pm 2$。二阶导数 $U''(x)=12x^{2}-16$ 得到 $U''(0)=-16$（一个局部极大值）和 $U''(\\pm 2)=32>0$（局部极小值）。粒子从值为负的极小值点开始，所以 $x_{0}=-2$。\n\n在每个 Metropolis 步骤中，对于建议的位移 $\\Delta x$，尝试位置为 $x_{\\text{trial}}=x_{\\text{current}}+\\Delta x$，能量变化为 $\\Delta U=U(x_{\\text{trial}})-U(x_{\\text{current}})$。如果 $\\Delta U \\leq 0$，或者在 $\\Delta U>0$ 的情况下以概率 $P_{\\text{accept}}=\\exp(-\\beta\\Delta U)$（其中 $\\beta=2$），则移动被接受。接受与否通过将一个均匀分布的随机数 $r$ 与 $P_{\\text{accept}}$ 进行比较来实现。\n\n第 1 步：$\\Delta x=0.30$。\n$$x_{\\text{trial}}=-2+0.30=-1.70$$\n$$U(-2)=(-2)^{4}-8(-2)^{2}=16-32=-16$$\n$$U(-1.7)=(-1.7)^{4}-8(-1.7)^{2}=8.3521-8\\cdot 2.89=8.3521-23.12=-14.7679$$\n$$\\Delta U=-14.7679-(-16)=1.2321>0$$\n$$P_{\\text{accept}}=\\exp(-2\\cdot 1.2321)=\\exp(-2.4642)\\approx 0.085$$\n给定 $r=0.51$，因为 $r > P_{\\text{accept}}$，所以拒绝。因此 $x$ 保持为 $-2$。\n\n第 2 步：$\\Delta x=-0.40$。\n$$x_{\\text{trial}}=-2-0.40=-2.40$$\n$$U(-2.4)=(-2.4)^{4}-8(-2.4)^{2}=33.1776-8\\cdot 5.76=33.1776-46.08=-12.9024$$\n$$\\Delta U=-12.9024-(-16)=3.0976>0$$\n$$P_{\\text{accept}}=\\exp(-2\\cdot 3.0976)=\\exp(-6.1952)\\approx 0.002$$\n给定 $r=0.12$，因为 $r > P_{\\text{accept}}$，所以拒绝。因此 $x$ 保持为 $-2$。\n\n第 3 步：$\\Delta x=0.10$。\n$$x_{\\text{trial}}=-2+0.10=-1.90$$\n$$U(-1.9)=(-1.9)^{4}-8(-1.9)^{2}=13.0321-8\\cdot 3.61=13.0321-28.88=-15.8479$$\n$$\\Delta U=-15.8479-(-16)=0.1521>0$$\n$$P_{\\text{accept}}=\\exp(-2\\cdot 0.1521)=\\exp(-0.3042)\\approx 0.738$$\n给定 $r=0.65$，因为 $r  P_{\\text{accept}}$，所以接受。因此 $x$ 更新为 $-1.90$。\n\n第 4 步：$\\Delta x=0.20$。\n$$x_{\\text{trial}}=-1.90+0.20=-1.70$$\n$$U(-1.70) = -14.7679$$\n$$\\Delta U = U(-1.70) - U(-1.90) = -14.7679 - (-15.8479) = 1.08 > 0$$\n$$P_{\\text{accept}}=\\exp(-2\\cdot 1.08)=\\exp(-2.16)\\approx 0.115$$\n给定 $r=0.83$，因为 $r > P_{\\text{accept}}$，所以拒绝。因此 $x$ 保持为 $-1.90$。\n\n第 5 步：$\\Delta x=-0.25$。\n$$x_{\\text{trial}}=-1.90-0.25=-2.15$$\n$$U(-2.15)=(-2.15)^{4}-8(-2.15)^{2} \\approx 21.3675 - 8 \\cdot 4.6225 = 21.3675 - 36.98 = -15.6125$$\n$$\\Delta U = U(-2.15) - U(-1.90) = -15.6125 - (-15.8479) = 0.2354 > 0$$\n$$P_{\\text{accept}}=\\exp(-2\\cdot 0.2354)=\\exp(-0.4708)\\approx 0.625$$\n给定 $r=0.47$，因为 $r  P_{\\text{accept}}$，所以接受。因此 $x$ 更新为 $-2.15$。\n\n经过 5 步之后，粒子的最终位置是 $-2.15$。",
            "answer": "$$\\boxed{-2.15}$$"
        },
        {
            "introduction": "超越单个步骤的模拟，这最后一个练习将探讨Metropolis模拟的一个关键统计特性：期望接受率。这个比率是衡量模拟效率的重要诊断指标，它在很大程度上取决于提议分布的参数，例如最大步长 $\\Delta x_{\\max}$。通过解决这个问题，您将学会如何定量地分析和调整这些参数，以获得更好的模拟性能，这在实际的科学计算中至关重要。",
            "id": "2005960",
            "problem": "一个经典粒子被限制在从 $x=0$ 到 $x=L$ 的一维区域内。在此区域内，它受到一个线性势 $V(x) = \\alpha x$ 的作用，其中 $\\alpha$ 是一个正常数。在该区域之外，势能为无穷大。该系统与温度为 $T$ 的热库处于热接触状态。\n\n采用梅特罗波利斯-蒙特卡洛模拟，根据玻尔兹曼分布对粒子的位置进行采样。在模拟的每一步中，都会从当前位置 $x_i$ 提议一个移动到新位置 $x_p = x_i + \\delta$ 的尝试性移动。步长 $\\delta$ 是一个随机变量，从区间 $[-\\Delta x_{max}, \\Delta x_{max}]$ 上的均匀概率分布中抽取。\n\n假设粒子当前位于盒子的正中心，即 $x_i = L/2$。最大步长设置为 $\\Delta x_{max} = L/4$。系统的物理参数和温度使得无量纲量 $\\beta \\alpha \\Delta x_{max} = 2.0$，其中 $\\beta = 1/(k_B T)$ 且 $k_B$ 是玻尔兹曼常数。\n\n计算下一次提议的移动的期望接受率，需要对所有可能产生的步长 $\\delta$ 进行平均。将您的答案表示为四舍五入到四位有效数字的小数。",
            "solution": "对于正则系综中从 $x_{i}$ 到 $x_{p}=x_{i}+\\delta$ 的对称提议移动，其梅特罗波利斯接受概率为\n$$\nA(\\delta)=\\min\\left(1,\\exp\\left[-\\beta\\left(V(x_{p})-V(x_{i})\\right)\\right]\\right).\n$$\n当 $V(x)=\\alpha x$ 且 $x_{i}=L/2$ 时，能量变化为\n$$\n\\Delta E=V(x_{i}+\\delta)-V(x_{i})=\\alpha\\delta,\n$$\n所以\n$$\nA(\\delta)=\\min\\left(1,\\exp(-\\beta\\alpha\\,\\delta)\\right).\n$$\n因为 $\\Delta x_{\\max}=L/4$ 且 $x_{i}=L/2$，提议的位置 $x_{p}\\in[L/4,3L/4]\\subset[0,L]$，所以没有边界拒绝。步长 $\\delta$ 在 $[-\\Delta,\\Delta]$ 上均匀分布，其中 $\\Delta=\\Delta x_{\\max}$，因此期望接受率为\n$$\nR=\\frac{1}{2\\Delta}\\int_{-\\Delta}^{\\Delta}A(\\delta)\\,d\\delta\n=\\frac{1}{2\\Delta}\\left(\\int_{-\\Delta}^{0}1\\,d\\delta+\\int_{0}^{\\Delta}\\exp(-\\beta\\alpha\\,\\delta)\\,d\\delta\\right).\n$$\n计算积分，\n$$\n\\int_{-\\Delta}^{0}1\\,d\\delta=\\Delta,\\qquad\n\\int_{0}^{\\Delta}\\exp(-\\beta\\alpha\\,\\delta)\\,d\\delta=\\frac{1}{\\beta\\alpha}\\left(1-\\exp(-\\beta\\alpha\\Delta)\\right).\n$$\n因此，\n$$\nR=\\frac{1}{2\\Delta}\\left[\\Delta+\\frac{1}{\\beta\\alpha}\\left(1-\\exp(-\\beta\\alpha\\Delta)\\right)\\right].\n$$\n引入 $s=\\beta\\alpha\\Delta$，得到\n$$\nR=\\frac{1}{2}\\left[1+\\frac{1}{s}\\left(1-\\exp(-s)\\right)\\right].\n$$\n给定 $s=\\beta\\alpha\\Delta x_{\\max}=2.0$，上式变为\n$$\nR=\\frac{1}{2}\\left[1+\\frac{1}{2}\\left(1-\\exp(-2)\\right)\\right].\n$$\n数值上，$\\exp(-2)\\approx 0.135335283$，所以\n$$\nR\\approx \\frac{1}{2}\\left[1+0.5\\times(1-0.135335283)\\right]\n=\\frac{1}{2}\\left[1+0.4323323585\\right]\n\\approx 0.7161661792.\n$$\n四舍五入到四位有效数字，期望接受率为 $0.7162$。",
            "answer": "$$\\boxed{0.7162}$$"
        }
    ]
}