{
    "hands_on_practices": [
        {
            "introduction": "理论的最佳试金石是计算。本节的第一个实践将引导你完成一个基础但至关重要的推导。我们将从一个给定的离散拉格朗日量出发，通过离散勒让德变换的具体计算来推导离散动量。这个练习  旨在揭示抽象定义与我们熟悉的有限差分概念之间的深刻联系，从而将离散力学的理论具体化。",
            "id": "3739303",
            "problem": "考虑一个位形空间 $Q = \\mathbb{R}^{n}$ 和一个形式为 $L(q, \\dot{q}) = \\tfrac{1}{2}\\dot{q}^{\\mathsf{T}} M \\dot{q} - V(q)$ 的机械拉格朗日量，其中 $M \\in \\mathbb{R}^{n \\times n}$ 是一个对称正定常数质量矩阵，而 $V: \\mathbb{R}^{n} \\to \\mathbb{R}$ 是一个连续可微势。设离散时间步长为 $h > 0$。通过在时间上应用梯形法则以及在 $q_{k}$ 和 $q_{k+1}$ 之间进行恒速插值来定义梯形离散拉格朗日量：\n$$\nL_{d}(q_{k}, q_{k+1}; h) \\;=\\; \\frac{1}{2h}\\,(q_{k+1} - q_{k})^{\\mathsf{T}} M (q_{k+1} - q_{k}) \\;-\\; \\frac{h}{2}\\,\\big(V(q_{k}) + V(q_{k+1})\\big).\n$$\n左右离散勒让德变换通过以下方式定义离散动量：\n$$\np_{k}^{-} \\;:=\\; -\\,D_{1} L_{d}(q_{k}, q_{k+1}; h), \n\\qquad\np_{k}^{+} \\;:=\\; D_{2} L_{d}(q_{k-1}, q_{k}; h),\n$$\n其中 $D_{i}$ 表示对第 $i$ 个参数的导数。仅从这些定义出发，用 $M$、$h$、$q_{k-1}$、$q_{k}$、$q_{k+1}$ 以及 $\\nabla V(q_{k})$、$\\nabla V(q_{k+1})$ 显式计算 $p_{k}^{-}$ 和 $p_{k}^{+}$。然后，使用你的表达式，证明中心离散动量\n$$\np_{k}^{c} \\;:=\\; \\frac{1}{2}\\,\\big(p_{k}^{-} + p_{k}^{+}\\big)\n$$\n是在时间层 $k$ 处连续动量 $M\\,\\dot{q}$ 的一个中心有限差分近似，即\n$$\np_{k}^{c} \\;=\\; \\frac{1}{2h}\\,M\\,(q_{k+1} - q_{k-1}).\n$$\n将你的最终答案以闭合形式的单一数对 $\\big(p_{k}^{-},\\,p_{k}^{+}\\big)$ 呈现。无需进行数值计算。",
            "solution": "将首先提取给定信息，然后检查其科学合理性、自洽性和适定性，从而对问题进行验证。\n\n### 第一步：提取已知条件\n- 位形空间：$Q = \\mathbb{R}^{n}$。\n- 连续拉格朗日量：$L(q, \\dot{q}) = \\tfrac{1}{2}\\dot{q}^{\\mathsf{T}} M \\dot{q} - V(q)$。\n- 质量矩阵：$M \\in \\mathbb{R}^{n \\times n}$ 是一个对称正定常数矩阵。\n- 势：$V: \\mathbb{R}^{n} \\to \\mathbb{R}$ 是一个连续可微函数。\n- 离散时间步长：$h > 0$。\n- 梯形离散拉格朗日量：$L_{d}(q_{k}, q_{k+1}; h) = \\frac{1}{2h}\\,(q_{k+1} - q_{k})^{\\mathsf{T}} M (q_{k+1} - q_{k}) - \\frac{h}{2}\\,\\big(V(q_{k}) + V(q_{k+1})\\big)$。\n- 左离散动量：$p_{k}^{-} = -\\,D_{1} L_{d}(q_{k}, q_{k+1}; h)$，其中 $D_{1}$ 是关于第一个参数的导数。\n- 右离散动量：$p_{k}^{+} = D_{2} L_{d}(q_{k-1}, q_{k}; h)$，其中 $D_{2}$ 是关于第二个参数的导数。\n- 中心离散动量：$p_{k}^{c} = \\frac{1}{2}\\,\\big(p_{k}^{-} + p_{k}^{+}\\big)$。\n- 中心动量的目标表达式：$p_{k}^{c} = \\frac{1}{2h}\\,M\\,(q_{k+1} - q_{k-1})$。\n\n### 第二步：使用提取的已知条件进行验证\n该问题是几何数值积分和离散力学领域的标准练习。\n- **科学依据**：拉格朗日量、勒让德变换和数值离散化（特别是梯形法则）的概念是经典力学和数值分析的基本原理。离散拉格朗日量和动量的构造遵循变分积分中的既定方法。\n- **适定性**：该问题是基于所提供定义的直接计算。它被完全指定，并能导出一个唯一的解析解。\n- **客观性**：问题使用精确的数学语言和定义进行陈述，没有任何主观或模糊的术语。\n\n### 第三步：结论与行动\n该问题是**有效的**。它是在离散力学这一特定主题内一个定义明确的数学推导。现在将开始求解过程。\n\n任务是计算左离散动量 $p_{k}^{-}$ 和右离散动量 $p_{k}^{+}$ 的表达式，然后用它们来验证中心离散动量 $p_{k}^{c}$ 的给定形式。\n\n首先，我们计算左离散动量 $p_{k}^{-}$。根据定义，$p_{k}^{-} = -D_{1} L_{d}(q_{k}, q_{k+1}; h)$。我们必须对离散拉格朗日量 $L_{d}(q_{k}, q_{k+1}; h)$ 关于其第一个参数 $q_{k}$ 求导。离散拉格朗日量为\n$$\nL_{d}(q_{k}, q_{k+1}; h) = \\frac{1}{2h}(q_{k+1} - q_{k})^{\\mathsf{T}} M (q_{k+1} - q_{k}) - \\frac{h}{2}(V(q_{k}) + V(q_{k+1}))\n$$\n我们将逐项对 $q_k$ 求导。对于动能项，令 $u = q_{k+1} - q_{k}$。该项为 $\\frac{1}{2h}u^{\\mathsf{T}}Mu$。对于向量 $x$ 和对称矩阵 $A$，使用矩阵微积分法则，梯度 $\\nabla_{x}(x^{\\mathsf{T}}Ax)$ 为 $2Ax$。应用链式法则，关于 $q_k$ 的梯度是：\n$$\nD_{1} \\left( \\frac{1}{2h}(q_{k+1} - q_{k})^{\\mathsf{T}} M (q_{k+1} - q_{k}) \\right) = \\frac{1}{2h} \\cdot 2M(q_{k+1} - q_{k}) \\cdot \\frac{\\partial}{\\partial q_{k}}(q_{k+1} - q_{k}) = \\frac{1}{h} M(q_{k+1} - q_{k}) \\cdot (-I) = -\\frac{1}{h}M(q_{k+1} - q_{k})\n$$\n其中 $I$ 是单位矩阵。\n对于势能项，其导数是直接的：\n$$\nD_{1} \\left( -\\frac{h}{2}(V(q_{k}) + V(q_{k+1})) \\right) = -\\frac{h}{2} \\nabla V(q_{k})\n$$\n结合这些结果，得到总导数 $D_{1} L_{d}$：\n$$\nD_{1} L_{d}(q_{k}, q_{k+1}; h) = -\\frac{1}{h}M(q_{k+1} - q_{k}) - \\frac{h}{2}\\nabla V(q_{k})\n$$\n左离散动量 $p_{k}^{-}$ 是该表达式的负值：\n$$\np_{k}^{-} = -D_{1} L_{d}(q_{k}, q_{k+1}; h) = \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k})\n$$\n\n接下来，我们计算右离散动量 $p_{k}^{+}$。根据定义，$p_{k}^{+} = D_{2} L_{d}(q_{k-1}, q_{k}; h)$。首先，我们写出参数从 $(q_k, q_{k+1})$ 移位到 $(q_{k-1}, q_{k})$ 的 $L_{d}$：\n$$\nL_{d}(q_{k-1}, q_{k}; h) = \\frac{1}{2h}(q_{k} - q_{k-1})^{\\mathsf{T}} M (q_{k} - q_{k-1}) - \\frac{h}{2}(V(q_{k-1}) + V(q_{k}))\n$$\n现在，我们对该表达式关于其第二个参数 $q_{k}$ 求导。对于动能项，令 $v = q_{k} - q_{k-1}$。关于 $q_k$ 的导数是：\n$$\nD_{2} \\left( \\frac{1}{2h}(q_{k} - q_{k-1})^{\\mathsf{T}} M (q_{k} - q_{k-1}) \\right) = \\frac{1}{2h} \\cdot 2M(q_{k} - q_{k-1}) \\cdot \\frac{\\partial}{\\partial q_{k}}(q_{k} - q_{k-1}) = \\frac{1}{h}M(q_{k} - q_{k-1}) \\cdot (I) = \\frac{1}{h}M(q_{k} - q_{k-1})\n$$\n对于势能项，其导数是：\n$$\nD_{2} \\left( -\\frac{h}{2}(V(q_{k-1}) + V(q_{k})) \\right) = -\\frac{h}{2}\\nabla V(q_{k})\n$$\n结合这些结果，得到 $p_k^+$ 的表达式：\n$$\np_{k}^{+} = D_{2} L_{d}(q_{k-1}, q_{k}; h) = \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k})\n$$\n这些是 $p_{k}^{-}$ 和 $p_{k}^{+}$ 的显式表达式。\n\n最后，我们证明中心离散动量 $p_{k}^{c}$ 具有所需的形式。我们使用其定义 $p_{k}^{c} = \\frac{1}{2}(p_{k}^{-} + p_{k}^{+})$ 并代入我们找到的表达式：\n$$\np_{k}^{c} = \\frac{1}{2} \\left[ \\left( \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k}) \\right) + \\left( \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k}) \\right) \\right]\n$$\n包含 $\\nabla V(q_{k})$ 的势能项相互抵消：\n$$\np_{k}^{c} = \\frac{1}{2} \\left[ \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{1}{h}M(q_{k} - q_{k-1}) \\right]\n$$\n提出公因式 $\\frac{1}{h}M$：\n$$\np_{k}^{c} = \\frac{1}{2h} M \\left[ (q_{k+1} - q_{k}) + (q_{k} - q_{k-1}) \\right]\n$$\n化简括号中的表达式可得：\n$$\np_{k}^{c} = \\frac{1}{2h} M (q_{k+1} - q_{k-1})\n$$\n这证实了问题陈述中给出的表达式。项 $\\frac{q_{k+1} - q_{k-1}}{2h}$ 是速度 $\\dot{q}$ 在时间 $t_{k}=kh$ 处的二阶中心有限差分近似。因此，$p_k^c$ 是连续动量 $p(t_k) = M\\dot{q}(t_k)$ 的离散近似。\n\n问题要求最终答案为数对 $(p_{k}^{-},\\,p_{k}^{+})$。\n$p_{k}^{-} = \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k})$\n$p_{k}^{+} = \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k})$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k}) & \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k}) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在掌握了离散动量的计算之后，我们自然要探究其背后更深层次的几何结构。变分积分器的核心优势在于它们能够精确保持一个离散的辛形式，这是其具备优越的长期稳定性的根源。这个练习  将通过对一个简单的自由粒子系统进行直接计算，让你亲手推导出离散庞加莱-嘉当形式和与之相关的离散辛形式，从而直观地理解变分原理是如何自然地蕴含这种几何保持特性的。",
            "id": "3739291",
            "problem": "考虑一个构型空间 $Q=\\mathbb{R}^{n}$，其具有标准的欧几里得内积和范数。设一个质量为 $m>0$ 的粒子的连续拉格朗日量为 $L(q,\\dot{q})=\\tfrac{1}{2}m\\|\\dot{q}\\|^{2}$。对于固定的时间步长 $h>0$，定义中点离散拉格朗日量 $L_{d}:Q\\times Q\\to\\mathbb{R}$ 为\n$$\nL_{d}(q_{0},q_{1}) \\;=\\; h\\,L\\!\\left(\\tfrac{q_{0}+q_{1}}{2},\\,\\tfrac{q_{1}-q_{0}}{h}\\right).\n$$\n在离散拉格朗日力学中，离散 Poincaré–Cartan 1-形式由核心的离散变分原理定义为\n$$\n\\Theta_{d}^{-}(q_{0},q_{1}) \\;=\\; -\\,D_{1}L_{d}(q_{0},q_{1})\\cdot dq_{0}, \n\\qquad\n\\Theta_{d}^{+}(q_{0},q_{1}) \\;=\\; D_{2}L_{d}(q_{0},q_{1})\\cdot dq_{1},\n$$\n而相关的离散辛 2-形式是外导数\n$$\n\\Omega_{d} \\;=\\; -\\,d\\Theta_{d}^{+} \\;=\\; -\\,d\\Theta_{d}^{-}.\n$$\n此处 $D_{1}$ 和 $D_{2}$ 分别表示对 $L_{d}$ 的第一个和第二个参数的偏导数，而 $dq_{0}$、$dq_{1}$ 表示 $Q\\times Q$ 上的坐标 1-形式。\n\n任务：\n- 从上述定义和给定的连续拉格朗日量出发，显式计算 $L_{d}(q_{0},q_{1})$。\n- 仅使用所提供的定义，计算 $\\Theta_{d}^{-}$ 和 $\\Theta_{d}^{+}$ 在 $Q\\times Q$ 上的显式坐标表达式。\n- 显式计算作为 $Q\\times Q$ 上 2-形式的 $\\Omega_{d}$，并从你的表达式中验证 $\\Omega_{d}$ 在 $Q\\times Q$ 上是常数。\n\n答案规格：\n- 在标准坐标 $\\{q_{0}^{i},q_{1}^{i}\\}_{i=1}^{n}$ 下，将 $\\Theta_{d}^{-}$、$\\Theta_{d}^{+}$ 和 $\\Omega_{d}$ 三者的最终答案作为一个包含三个条目的单行矩阵的解析表达式给出。\n- 无需数值取整，最终方框内的表达式不应包含任何单位。",
            "solution": "该问题按如下方式进行验证：\n\\\n**步骤 1：提取给定条件**\n- 构型空间：$Q=\\mathbb{R}^{n}$，具有标准的欧几里得内积和范数。\n- 连续拉格朗日量：$L(q,\\dot{q})=\\tfrac{1}{2}m\\|\\dot{q}\\|^{2}$，对于一个质量为 $m>0$ 的粒子。\n- 时间步长：$h>0$。\n- 中点离散拉格朗日量：$L_{d}(q_{0},q_{1}) = h\\,L\\!\\left(\\tfrac{q_{0}+q_{1}}{2},\\,\\tfrac{q_{1}-q_{0}}{h}\\right)$。\n- 离散 Poincaré–Cartan 1-形式定义：$\\Theta_{d}^{-}(q_{0},q_{1}) = -\\,D_{1}L_{d}(q_{0},q_{1})\\cdot dq_{0}$ 和 $\\Theta_{d}^{+}(q_{0},q_{1}) = D_{2}L_{d}(q_{0},q_{1})\\cdot dq_{1}$。\n- 离散辛 2-形式定义：$\\Omega_{d} = -\\,d\\Theta_{d}^{+} = -\\,d\\Theta_{d}^{-}$。\n- 符号说明：$D_{1}$ 和 $D_{2}$ 分别是关于 $L_d$ 的第一个和第二个参数的偏导数。$dq_{0}$、$dq_{1}$ 是 $Q\\times Q$ 上的坐标 1-形式。\n\n**步骤 2：使用提取的给定条件进行验证**\n- **科学依据：** 该问题牢固地植根于几何力学这一成熟领域，特别是离散变分积分器的理论。离散拉格朗日量、离散 Poincaré-Cartan 形式和离散辛形式的概念在该领域是标准的。所选择的拉格朗日量是针对自由粒子的，这是经典力学中的一个基本系统。\n- **适定性：** 该问题提供了执行所要求计算的所有必要定义和初始数据。任务是明确的，通过直接应用所提供的定义可以得出一个唯一的、有意义的解。\n- **客观性：** 该问题使用精确的数学语言陈述，没有任何模糊性、主观性或意见。\n\n该问题没有表现出任何诸如科学上不健全、不完整、矛盾或模糊之类的缺陷。\n\n**步骤 3：结论与行动**\n该问题是有效的。解题过程如下。\n\n第一个任务是计算离散拉格朗日量 $L_{d}(q_{0},q_{1})$ 的显式形式。我们已知连续拉格朗日量 $L(q,\\dot{q})=\\tfrac{1}{2}m\\|\\dot{q}\\|^{2}$ 和离散化规则 $L_{d}(q_{0},q_{1}) = h\\,L(\\tfrac{q_{0}+q_{1}}{2},\\,\\tfrac{q_{1}-q_{0}}{h})$。\n将参数代入 $L$，我们注意到 $L$ 与其第一个参数 $q$ 无关。我们将 $\\dot{q}$ 替换为有限差分近似 $\\tfrac{q_{1}-q_{0}}{h}$。\n$$\nL\\left(\\tfrac{q_{0}+q_{1}}{2},\\,\\tfrac{q_{1}-q_{0}}{h}\\right) = \\frac{1}{2}m\\left\\|\\frac{q_{1}-q_{0}}{h}\\right\\|^{2} = \\frac{m}{2h^{2}}\\|q_{1}-q_{0}\\|^{2}.\n$$\n现在，我们将其代回 $L_{d}$ 的定义中：\n$$\nL_{d}(q_{0},q_{1}) = h \\left( \\frac{m}{2h^{2}}\\|q_{1}-q_{0}\\|^{2} \\right) = \\frac{m}{2h}\\|q_{1}-q_{0}\\|^{2}.\n$$\n在 $Q \\times Q = \\mathbb{R}^n \\times \\mathbb{R}^n$ 上的标准坐标 $\\{q_{0}^{i}, q_{1}^{i}\\}_{i=1}^{n}$ 中，该表达式变为：\n$$\nL_{d}(q_{0},q_{1}) = \\frac{m}{2h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i})^{2}.\n$$\n\n第二个任务是计算离散 1-形式 $\\Theta_{d}^{-}$ 和 $\\Theta_{d}^{+}$。\n我们从 $\\Theta_{d}^{-}(q_{0},q_{1}) = -D_{1}L_{d}(q_{0},q_{1})\\cdot dq_{0}$ 开始。这等价于 $\\Theta_{d}^{-} = -\\sum_{i=1}^{n} \\frac{\\partial L_{d}}{\\partial q_{0}^{i}} dq_{0}^{i}$。\n我们来计算 $L_{d}$ 关于坐标 $q_{0}^{j}$ 的偏导数：\n$$\n\\frac{\\partial L_{d}}{\\partial q_{0}^{j}} = \\frac{\\partial}{\\partial q_{0}^{j}} \\left( \\frac{m}{2h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i})^{2} \\right) = \\frac{m}{2h} \\cdot 2(q_{1}^{j} - q_{0}^{j})(-1) = -\\frac{m}{h}(q_{1}^{j} - q_{0}^{j}).\n$$\n将此代入 $\\Theta_{d}^{-}$ 的表达式中：\n$$\n\\Theta_{d}^{-} = -\\sum_{j=1}^{n} \\left( -\\frac{m}{h}(q_{1}^{j} - q_{0}^{j}) \\right) dq_{0}^{j} = \\frac{m}{h} \\sum_{j=1}^{n} (q_{1}^{j} - q_{0}^{j}) dq_{0}^{j}.\n$$\n接下来，我们计算 $\\Theta_{d}^{+}(q_{0},q_{1}) = D_{2}L_{d}(q_{0},q_{1})\\cdot dq_{1}$，这等价于 $\\Theta_{d}^{+} = \\sum_{i=1}^{n} \\frac{\\partial L_{d}}{\\partial q_{1}^{i}} dq_{1}^{i}$。\n$L_{d}$ 关于坐标 $q_{1}^{j}$ 的偏导数是：\n$$\n\\frac{\\partial L_{d}}{\\partial q_{1}^{j}} = \\frac{\\partial}{\\partial q_{1}^{j}} \\left( \\frac{m}{2h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i})^{2} \\right) = \\frac{m}{2h} \\cdot 2(q_{1}^{j} - q_{0}^{j})(1) = \\frac{m}{h}(q_{1}^{j} - q_{0}^{j}).\n$$\n将此代入 $\\Theta_{d}^{+}$ 的表达式中：\n$$\n\\Theta_{d}^{+} = \\sum_{j=1}^{n} \\left( \\frac{m}{h}(q_{1}^{j} - q_{0}^{j}) \\right) dq_{1}^{j} = \\frac{m}{h} \\sum_{j=1}^{n} (q_{1}^{j} - q_{0}^{j}) dq_{1}^{j}.\n$$\n\n第三个任务是计算离散辛 2-形式 $\\Omega_{d} = -d\\Theta_{d}^{+}$ 并验证其常数性。\n我们取 $\\Theta_{d}^{+}$ 的外导数：\n$$\nd\\Theta_{d}^{+} = d\\left( \\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{1}^{i} \\right) = \\frac{m}{h} \\sum_{i=1}^{n} d(q_{1}^{i} - q_{0}^{i}) \\wedge dq_{1}^{i}.\n$$\n系数函数的外导数是 $d(q_{1}^{i} - q_{0}^{i}) = dq_{1}^{i} - dq_{0}^{i}$。将其代回：\n$$\nd\\Theta_{d}^{+} = \\frac{m}{h} \\sum_{i=1}^{n} (dq_{1}^{i} - dq_{0}^{i}) \\wedge dq_{1}^{i}.\n$$\n利用楔积的性质，$(A-B)\\wedge A = A \\wedge A - B \\wedge A = 0 - B \\wedge A$，我们得到：\n$$\nd\\Theta_{d}^{+} = \\frac{m}{h} \\sum_{i=1}^{n} (dq_{1}^{i}\\wedge dq_{1}^{i} - dq_{0}^{i} \\wedge dq_{1}^{i}) = \\frac{m}{h} \\sum_{i=1}^{n} (0 - dq_{0}^{i} \\wedge dq_{1}^{i}) = -\\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i}.\n$$\n最后，我们应用定义 $\\Omega_{d} = -d\\Theta_{d}^{+}$：\n$$\n\\Omega_{d} = - \\left( -\\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i} \\right) = \\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i}.\n$$\n为了验证这个结果是一致的，我们也可以计算 $\\Omega_d = -d\\Theta_d^-$：\n$$\nd\\Theta_{d}^{-} = d\\left(\\frac{m}{h}\\sum_{i=1}^{n}(q_{1}^{i}-q_{0}^{i})dq_{0}^{i}\\right) = \\frac{m}{h}\\sum_{i=1}^{n}d(q_{1}^{i}-q_{0}^{i})\\wedge dq_{0}^{i} = \\frac{m}{h}\\sum_{i=1}^{n}(dq_{1}^{i}-dq_{0}^{i})\\wedge dq_{0}^{i}.\n$$\n这可以简化为：\n$$\nd\\Theta_{d}^{-} = \\frac{m}{h}\\sum_{i=1}^{n}(dq_{1}^{i}\\wedge dq_{0}^{i} - dq_{0}^{i}\\wedge dq_{0}^{i}) = \\frac{m}{h}\\sum_{i=1}^{n}dq_{1}^{i}\\wedge dq_{0}^{i} = -\\frac{m}{h}\\sum_{i=1}^{n}dq_{0}^{i}\\wedge dq_{1}^{i}.\n$$\n因此，$\\Omega_{d} = -d\\Theta_{d}^{-} = -(-\\frac{m}{h}\\sum_{i=1}^{n}dq_{0}^{i}\\wedge dq_{1}^{i}) = \\frac{m}{h}\\sum_{i=1}^{n}dq_{0}^{i}\\wedge dq_{1}^{i}$，这证实了我们之前的结果。\n$\\Omega_{d}$ 的表达式是基 2-形式 $dq_{0}^{i} \\wedge dq_{1}^{i}$ 的线性组合，其系数为 $\\frac{m}{h}$。由于 $m$ 和 $h$ 是常数，$\\Omega_{d}$ 在这个标准坐标基中的系数是常数。因此，2-形式 $\\Omega_{d}$ 在 $Q \\times Q$ 上是常数。\n\n所要求的三个量是：\n$$\n\\Theta_{d}^{-} = \\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{0}^{i}\n$$\n$$\n\\Theta_{d}^{+} = \\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{1}^{i}\n$$\n$$\n\\Omega_{d} = \\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i}\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{0}^{i} & \\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{1}^{i} & \\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理论上，只要离散拉格朗日量具有对称性，相应的离散动量图就应该被精确地守恒。然而，在真实计算机的有限精度浮点运算中会发生什么呢？这个实践  将引导你从纸笔推演走向实际编程，通过实现一个简单的变分积分器来观察数值圆整误差如何破坏离散拉格朗日量的精确对称性，并导致理论上守恒的动量产生可测量的漂移。这是计算科学中至关重要的一课，它连接了理论的完美与实践的妥协。",
            "id": "3739286",
            "problem": "考虑一个构型空间 $\\mathbb{R}^d$，其平移群 $G = \\mathbb{R}^d$ 的作用为 $q \\mapsto q + a$，其中 $a \\in \\mathbb{R}^d$ 为任意常数向量。设连续拉格朗日量为 $L(q,\\dot{q}) = \\frac{m}{2} \\|\\dot{q}\\|^2$，它在群 $G$ 的作用下是不变的。对于一个时间步长 $h > 0$，离散拉格朗日量定义为 $L_d(q_k,q_{k+1};h)$，并通过离散欧拉-拉格朗日方程 $D_2 L_d(q_{k-1},q_k;h) + D_1 L_d(q_k,q_{k+1};h) = 0$ 给出变分积分器。对于一个平移不变的离散拉格朗日量，根据离散诺特定理，与 $G$-对称性相关的离散动量映射在步与步之间是守恒的，前提是 $L_d$ 是严格 $G$-不变的。\n\n从上述基本定义出发，任务是：\n- 对于离散拉格朗日量为 $L_d(q_k,q_{k+1};h) = \\frac{m}{2h}\\|q_{k+1}-q_k\\|^2$ 的自由粒子，推导其离散动量映射。\n- 设计一个数值方案来传播离散动力学，并监控由于舍入误差引起的离散线性动量的每步漂移。\n- 通过比较 $L_d$ 的两种代数上等价的求值方式，从数值上将观察到的漂移与浮点运算中对精确 $G$-不变性的违背联系起来：\n  1) 差分形式 $L_d^{\\mathrm{diff}}(q_k,q_{k+1};h) = \\frac{m}{2h}\\|q_{k+1}-q_k\\|^2$；\n  2) 展开点积形式 $L_d^{\\mathrm{exp}}(q_k,q_{k+1};h) = \\frac{m}{2h}\\left(\\|q_{k+1}\\|^2 + \\|q_k\\|^2 - 2\\,q_{k+1}\\cdot q_k\\right)$。\n\n实现以下数值方案：\n1. 对于选定的初始速度 $v_0 \\in \\mathbb{R}^d$，初始化 $q_0 \\in \\mathbb{R}^d$ 和 $q_1 = q_0 + h v_0$。\n2. 对 $k = 1,2,\\dots,N-1$，传播 $q_{k+1} = 2 q_k - q_{k-1}$。\n3. 在每一步 $k = 1,2,\\dots,N-1$，计算离散动量 $p_k = \\frac{m}{h}(q_k - q_{k-1})$ 和漂移 $\\|p_{k+1} - p_k\\|$。\n4. 在每一步，通过计算以下值来评估在固定平移 $a \\in \\mathbb{R}^d$ 下的不变性缺陷：\n   $\\Delta^{\\mathrm{exp}}_k = \\left|L_d^{\\mathrm{exp}}(q_k+a,q_{k+1}+a;h) - L_d^{\\mathrm{exp}}(q_k,q_{k+1};h)\\right|$ 和 \n   $\\Delta^{\\mathrm{diff}}_k = \\left|L_d^{\\mathrm{diff}}(q_k+a,q_{k+1}+a;h) - L_d^{\\mathrm{diff}}(q_k,q_{k+1};h)\\right|$。\n5. 通过计算时间序列 $\\{\\|p_{k+1}-p_k\\|\\}_{k=1}^{N-1}$ 和 $\\{\\Delta^{\\mathrm{exp}}_k\\}_{k=1}^{N-1}$ 之间的皮尔逊相关系数，来量化动量漂移和不变性缺陷之间的关系。如果任一时间序列的方差为零，则将相关性定义为 $0.0$。\n\n你的程序必须实现此方案，并为每个测试用例生成一个包含四个浮点数的列表：\n- 最大动量漂移 $\\max_{1 \\le k \\le N-1} \\|p_{k+1}-p_k\\|$。\n- 最大展开形式不变性缺陷 $\\max_{1 \\le k \\le N-1} \\Delta^{\\mathrm{exp}}_k$。\n- 最大差分形式不变性缺陷 $\\max_{1 \\le k \\le N-1} \\Delta^{\\mathrm{diff}}_k$。\n- 动量漂移序列与展开形式不变性缺陷序列之间的相关系数。\n\n不需要物理单位；所有量都必须作为无量纲数处理。此设置中不出现角度。\n\n测试套件：\n- 案例 1 (正常情况)：$d=3$，$m=1.0$，$h=10^{-3}$，$N=1000$，$a = (0,0,0)$，$q_0 = (0,0,0)$，$v_0 = (1,-1,0.5)$。\n- 案例 2 (边缘情况：大偏移量和小步长)：$d=3$，$m=1.0$，$h=10^{-9}$，$N=2000$，$a = (10^{12},10^{12},10^{12})$，$q_0 = a$，$v_0 = (1,-1,0.5)$。\n- 案例 3 (边界情况：二维中的极小步长和大偏移量)：$d=2$，$m=1.0$，$h=5\\cdot 10^{-12}$，$N=1500$，$a = (10^{15},10^{15})$，$q_0 = a$，$v_0 = (0.3,-0.7)$。\n\n最终输出格式：\n你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，其本身是按上述顺序包含四个浮点数的列表，例如：\n\"[[r_{1,1},r_{1,2},r_{1,3},r_{1,4}],[r_{2,1},r_{2,2},r_{2,3},r_{2,4}],[r_{3,1},r_{3,2},r_{3,3},r_{3,4}]]\"。",
            "solution": "该问题是有效的。它在几何力学领域提出了一个定义明确且科学上合理的数值实验，旨在研究在变分积分器中破坏对称性所产生的数值后果。所有必需的定义、参数和程序都已明确无误地指定，没有歧义或矛盾。\n\n### 理论框架介绍\n\n该问题在离散变分力学的背景下，探讨了对称性与守恒律之间的联系。对于一个连续力学系统，如果其拉格朗日量 $L(q, \\dot{q})$ 在一个李群 $G$ 的作用下保持不变，诺特定理保证存在一个守恒量，称为动量映射。变分积分器是通过离散化哈密顿平稳作用量原理推导出的数值方法。这些方法的一个关键特征是，如果离散拉格朗日量 $L_d(q_k, q_{k+1};h)$ 继承了连续拉格朗日量的对称性，那么得到的数值方案将精确地保持一个相应的离散动量映射。本问题关注平移群 $G = (\\mathbb{R}^d, +)$ 和一个自由粒子，其守恒量是线性动量。然后，它研究了浮点运算如何破坏精确的数值对称性，导致本应守恒的动量发生漂移。\n\n### 第1部分：离散动量映射的推导\n\n离散动量映射是利用离散诺特定理的原理从离散拉格朗日量推导出来的。\n\n1.  **系统与对称性**：构型空间为 $Q = \\mathbb{R}^d$。系统是一个质量为 $m$ 的自由粒子，由离散拉格朗日量 $L_d(q_k, q_{k+1}; h) = \\frac{m}{2h}\\|q_{k+1} - q_k\\|^2$ 描述，这是对连续拉格朗日量 $L(q, \\dot{q}) = \\frac{m}{2}\\|\\dot{q}\\|^2$ 的作用量积分的离散化。对称群是平移群 $G = \\mathbb{R}^d$，它对 $Q$ 的作用为 $\\Phi_a(q) = q + a$，其中 $a \\in \\mathbb{R}^d$ 为任意常数向量。\n\n2.  **离散拉格朗日量的不变性**：离散拉格朗日量在群作用下是严格不变的：\n    $$L_d(\\Phi_a(q_k), \\Phi_a(q_{k+1}); h) = L_d(q_k + a, q_{k+1} + a; h) = \\frac{m}{2h} \\|(q_{k+1} + a) - (q_k + a)\\|^2 = \\frac{m}{2h} \\|q_{k+1} - q_k\\|^2 = L_d(q_k, q_{k+1}; h)$$\n    这种严格不变性是离散守恒律的基础。\n\n3.  **离散动量映射**：根据离散诺特定理，守恒量与离散拉格朗日量的偏导数有关。左、右离散动量由 $L_d$ 对其参数的导数定义。让我们计算这些导数：\n    -   $D_1 L_d(q_k, q_{k+1}; h) = \\frac{\\partial L_d}{\\partial q_k} = \\frac{m}{h}(q_k - q_{k+1})$\n    -   $D_2 L_d(q_k, q_{k+1}; h) = \\frac{\\partial L_d}{\\partial q_{k+1}} = \\frac{m}{h}(q_{k+1} - q_k)$\n\n    问题将第 $k$ 步的离散动量定义为 $p_k$。根据几何积分中的标准惯例，与区间 $(q_{k-1}, q_k)$ 相关的动量由 $p_k = D_2 L_d(q_{k-1}, q_k; h)$ 或 $p_k = -D_1 L_d(q_{k-1}, q_k; h)$ 给出。两种定义都得到相同的结果：\n    $$p_k = D_2 L_d(q_{k-1}, q_k; h) = \\frac{m}{h}(q_k - q_{k-1})$$\n    这个表达式 $p_k$ 是连续线性动量 $p = m\\dot{q}$ 的离散对应物。这就是该系统的离散动量映射。\n\n4.  **守恒律**：动力学由离散欧拉-拉格朗日 (DEL) 方程决定：$D_2 L_d(q_{k-1}, q_k; h) + D_1 L_d(q_k, q_{k+1}; h) = 0$。代入导数：\n    $$\\frac{m}{h}(q_k - q_{k-1}) - \\frac{m}{h}(q_{k+1} - q_k) = 0$$\n    这可以简化为 $p_k - p_{k+1} = 0$，即 $p_{k+1} = p_k$。这证实了离散动量 $p_k = \\frac{m}{h}(q_k - q_{k-1})$ 沿着由 DEL 方程定义的轨迹是精确守恒的。DEL 方程本身可以重新排列，得到问题中指定的积分器：\n    $$q_k - q_{k-1} = q_{k+1} - q_k \\implies q_{k+1} = 2q_k - q_{k-1}$$\n    这就是用于零加速度粒子的斯托末-韦尔莱方法，它正确地表示了自由运动。\n\n### 第2部分：数值方案分析\n\n该问题要求进行数值模拟，以探究使用有限精度浮点运算进行这些计算的后果。\n\n1.  **动量漂移**：在精确算术中，$\\|p_{k+1} - p_k\\| = 0$。然而，$q_{k+1} = 2q_k - q_{k-1}$ 的数值计算会受到舍入误差的影响。当 $q_k$ 和 $q_{k-1}$ 是数值大但差异小的向量时，对它们的操作可能导致精度损失。$q_{k+1}$ 中的这个误差会传播，导致计算出的 $p_{k+1}$ 与 $p_k$ 有微小差异。量 $\\|p_{k+1} - p_k\\|$ 衡量了每一步的这种数值漂移。\n\n2.  **不变性缺陷**：问题引入了两种代数上等价的离散拉格朗日量形式：\n    -   差分形式：$L_d^{\\mathrm{diff}}(q_k, q_{k+1}; h) = \\frac{m}{2h}\\|q_{k+1} - q_k\\|^2$\n    -   展开形式：$L_d^{\\mathrm{exp}}(q_k, q_{k+1}; h) = \\frac{m}{2h}(\\|q_{k+1}\\|^2 + \\|q_k\\|^2 - 2q_{k+1} \\cdot q_k)$\n\n    这样做的目的是为了表明它们在浮点运算下的行为不同。不变性缺陷衡量了数值实现在多大程度上不满足 $L_d(q_k+a, q_{k+1}+a) = L_d(q_k, q_{k+1})$。\n\n    -   对于 $L_d^{\\mathrm{diff}}$，缺陷 $\\Delta^{\\mathrm{diff}}_k$ 是从 $|L_d^{\\mathrm{diff}}(q_k+a, q_{k+1}+a) - L_d^{\\mathrm{diff}}(q_k, q_{k+1})|$ 计算的。核心计算是 $(q_{k+1}+a) - (q_k+a)$。如果 $q_k$ 和 $q_{k+1}$ 数值很大且彼此非常接近，它们的差就很小。减法 $(q_{k+1}+a) - (q_k+a)$ 在数值上是稳定的，因为它能精确地计算两个相近大数的差，从而得到一个准确的小数。因此，我们期望 $\\Delta^{\\mathrm{diff}}_k$ 接近于机器精度。\n\n    -   对于 $L_d^{\\mathrm{exp}}$，缺陷 $\\Delta^{\\mathrm{exp}}_k$ 依赖于计算像 $\\|q_k+a\\|^2 + \\|q_{k+1}\\|^2$ 这样的项，并从相似的项中减去它们。例如，测试不变性涉及计算 $\\|q_k+a\\|^2$ 和 $\\|q_k\\|^2$。如果 $q_k$ 是一个大向量（例如，在案例3中，$q_k \\approx 10^{15}$），那么 $\\|q_k+a\\|^2$ 和 $\\|q_k\\|^2$ 都是巨大的且彼此非常接近。它们的减法 $\\|q_k+a\\|^2 - \\|q_k\\|^2$ 是**灾难性抵消**的一个例子，其中大多数有效数字会丢失，导致巨大的相对误差。因此，$L_d^{\\mathrm{exp}}(q_k+a, q_{k+1}+a)$ 的计算值将与 $L_d^{\\mathrm{exp}}(q_k, q_{k+1})$ 有显著差异，从而导致一个大的不变性缺陷 $\\Delta^{\\mathrm{exp}}_k$。\n\n3.  **相关性**：待检验的核心假设是，守恒量（动量）的数值漂移是由相关对称性（平移不变性）的数值破坏直接引起的。通过计算动量漂移时间序列 $\\{\\|p_{k+1}-p_k\\|\\}_{k=1}^{N-1}$ 和不变性缺陷时间序列 $\\{\\Delta^{\\mathrm{exp}}_k\\}_{k=1}^{N-1}$ 之间的皮尔逊相关系数，我们可以定量地评估这种关系。一个高的正相关性将为几何积分的这一基本原则提供强有力的数值证据，证明未能保持对称性会导致未能保持相应的动量映射。\n\n### 实现策略\n\n数值模拟按如下方式实现：\n1.  为每个测试用例初始化系统参数 ($m, h, d, N, a, q_0, v_0$)。\n2.  建立一个大小为 $(N+1) \\times d$ 的数组 `q` 来存储轨迹。初始化 $q_0$ 和 $q_1 = q_0 + h v_0$。\n3.  从 $k=1$ 到 $N-1$ 进行循环：\n    a. 计算 $q_{k+1} = 2q_k - q_{k-1}$。\n    b. 计算动量 $p_k = \\frac{m}{h}(q_k - q_{k-1})$ 和 $p_{k+1} = \\frac{m}{h}(q_{k+1} - q_k)$。\n    c. 计算动量漂移 $\\|p_{k+1} - p_k\\|$ 并将其存储在结果数组中。\n    d. 使用提供的公式计算不变性缺陷 $\\Delta_k^{\\mathrm{exp}}$ 和 $\\Delta_k^{\\mathrm{diff}}$ 并存储它们。\n4.  循环结束后，计算所需的汇总统计数据：\n    a. 动量漂移序列的最大值。\n    b. $\\Delta_k^{\\mathrm{exp}}$ 序列的最大值。\n    c. $\\Delta_k^{\\mathrm{diff}}$ 序列的最大值。\n    d. 动量漂移序列与 $\\Delta_k^{\\mathrm{exp}}$ 序列之间的皮尔逊相关系数。根据规定，包含了对零方差情况的检查，在这种情况下将相关性设置为 $0.0$。\n5.  将每个测试用例的四个结果浮点数格式化为指定的列表格式，并打印最终结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the numerical experiment problem for discrete momentum maps and invariance.\n    \"\"\"\n    test_cases = [\n        # d, m, h, N, a, q0, v0\n        (3, 1.0, 1e-3, 1000, np.array([0.0, 0.0, 0.0]), np.array([0.0, 0.0, 0.0]), np.array([1.0, -1.0, 0.5])),\n        (3, 1.0, 1e-9, 2000, np.array([1e12, 1e12, 1e12]), np.array([1e12, 1e12, 1e12]), np.array([1.0, -1.0, 0.5])),\n        (2, 1.0, 5e-12, 1500, np.array([1e15, 1e15]), np.array([1e15, 1e15]), np.array([0.3, -0.7]))\n    ]\n\n    def L_diff(q_k, q_k_plus_1, m, h):\n        \"\"\"Computes the discrete Lagrangian using the difference form.\"\"\"\n        diff = q_k_plus_1 - q_k\n        return (m / (2.0 * h)) * np.dot(diff, diff)\n\n    def L_exp(q_k, q_k_plus_1, m, h):\n        \"\"\"Computes the discrete Lagrangian using the expanded form.\"\"\"\n        norm_q_k_sq = np.dot(q_k, q_k)\n        norm_q_k_plus_1_sq = np.dot(q_k_plus_1, q_k_plus_1)\n        dot_prod = np.dot(q_k_plus_1, q_k)\n        return (m / (2.0 * h)) * (norm_q_k_plus_1_sq + norm_q_k_sq - 2.0 * dot_prod)\n\n    final_results = []\n    \n    for d, m, h, N, a, q0, v0 in test_cases:\n        # Initialize trajectory array\n        q = np.zeros((N + 1, d), dtype=np.float64)\n        q[0] = q0\n        q[1] = q0 + h * v0\n\n        # Arrays to store time series data\n        momentum_drifts = np.zeros(N - 1, dtype=np.float64)\n        defects_exp = np.zeros(N - 1, dtype=np.float64)\n        defects_diff = np.zeros(N - 1, dtype=np.float64)\n\n        # Propagate dynamics and collect data\n        for k in range(1, N):\n            # Propagate position using Störmer-Verlet\n            q[k + 1] = 2.0 * q[k] - q[k - 1]\n\n            # The series are indexed from k=1..N-1 in the problem statement.\n            # Our loop runs k from 1 to N-1, so we store results at index k-1.\n            series_idx = k - 1\n            \n            # Compute momenta and drift\n            p_k = (m / h) * (q[k] - q[k - 1])\n            p_k_plus_1 = (m / h) * (q[k + 1] - q[k])\n            momentum_drifts[series_idx] = np.linalg.norm(p_k_plus_1 - p_k)\n            \n            # Current interval for Lagrangian evaluation\n            q_k = q[k]\n            q_k_plus_1 = q[k+1]\n\n            # Compute expanded-form invariance defect\n            l_exp_orig = L_exp(q_k, q_k_plus_1, m, h)\n            l_exp_trans = L_exp(q_k + a, q_k_plus_1 + a, m, h)\n            defects_exp[series_idx] = np.abs(l_exp_trans - l_exp_orig)\n            \n            # Compute difference-form invariance defect\n            l_diff_orig = L_diff(q_k, q_k_plus_1, m, h)\n            l_diff_trans = L_diff(q_k + a, q_k_plus_1 + a, m, h)\n            defects_diff[series_idx] = np.abs(l_diff_trans - l_diff_orig)\n\n        # Calculate summary statistics\n        max_drift = np.max(momentum_drifts)\n        max_defect_exp = np.max(defects_exp)\n        max_defect_diff = np.max(defects_diff)\n        \n        # Calculate Pearson correlation, handling the zero-variance case\n        std_drift = np.std(momentum_drifts)\n        std_defect_exp = np.std(defects_exp)\n        \n        correlation = 0.0\n        if std_drift > 0 and std_defect_exp > 0:\n            # np.corrcoef returns a 2x2 matrix\n            correlation_matrix = np.corrcoef(momentum_drifts, defects_exp)\n            correlation = correlation_matrix[0, 1]\n\n        final_results.append([max_drift, max_defect_exp, max_defect_diff, correlation])\n\n    # Format output as specified\n    formatted_cases = []\n    for case_result in final_results:\n        # Format each list of floats into \"[f1,f2,f3,f4]\"\n        s = f\"[{','.join(map(str, case_result))}]\"\n        formatted_cases.append(s)\n    \n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```"
        }
    ]
}