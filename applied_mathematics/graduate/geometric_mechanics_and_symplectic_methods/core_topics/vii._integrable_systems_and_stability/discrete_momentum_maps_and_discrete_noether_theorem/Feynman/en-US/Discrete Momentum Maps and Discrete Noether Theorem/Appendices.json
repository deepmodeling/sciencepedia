{
    "hands_on_practices": [
        {
            "introduction": "The bridge between the discrete Lagrangian and Hamiltonian formalisms is the discrete Legendre transform, which defines the discrete momenta. This first exercise provides a concrete calculation to ground these abstract definitions. By deriving the discrete momenta for a system discretized with the trapezoidal rule, you will see how they naturally relate to centered finite difference approximations of velocity, reinforcing the connection between the geometric construction and standard numerical methods. ",
            "id": "3739303",
            "problem": "Consider a configuration space $Q = \\mathbb{R}^{n}$ and a mechanical Lagrangian of the form $L(q, \\dot{q}) = \\tfrac{1}{2}\\dot{q}^{\\mathsf{T}} M \\dot{q} - V(q)$, where $M \\in \\mathbb{R}^{n \\times n}$ is a symmetric positive-definite constant mass matrix and $V: \\mathbb{R}^{n} \\to \\mathbb{R}$ is a continuously differentiable potential. Let the discrete time-step be $h > 0$. Define the trapezoidal discrete Lagrangian by applying the trapezoidal rule in time and a constant-velocity interpolation between $q_{k}$ and $q_{k+1}$:\n$$\nL_{d}(q_{k}, q_{k+1}; h) \\;=\\; \\frac{1}{2h}\\,(q_{k+1} - q_{k})^{\\mathsf{T}} M (q_{k+1} - q_{k}) \\;-\\; \\frac{h}{2}\\,\\big(V(q_{k}) + V(q_{k+1})\\big).\n$$\nThe left and right discrete Legendre transforms define the discrete momenta by\n$$\np_{k}^{-} \\;:=\\; -\\,D_{1} L_{d}(q_{k}, q_{k+1}; h), \n\\qquad\np_{k}^{+} \\;:=\\; D_{2} L_{d}(q_{k-1}, q_{k}; h),\n$$\nwhere $D_{i}$ denotes the derivative with respect to the $i$-th argument. Starting from these definitions only, compute $p_{k}^{-}$ and $p_{k}^{+}$ explicitly in terms of $M$, $h$, $q_{k-1}$, $q_{k}$, $q_{k+1}$, and $\\nabla V(q_{k})$, $\\nabla V(q_{k+1})$. Then, using your expressions, show that the centered discrete momentum\n$$\np_{k}^{c} \\;:=\\; \\frac{1}{2}\\,\\big(p_{k}^{-} + p_{k}^{+}\\big)\n$$\nis a centered finite-difference approximation of the continuous momentum $M\\,\\dot{q}$ at the time level $k$, namely\n$$\np_{k}^{c} \\;=\\; \\frac{1}{2h}\\,M\\,(q_{k+1} - q_{k-1}).\n$$\nPresent your final answer as the single pair $\\big(p_{k}^{-},\\,p_{k}^{+}\\big)$ in closed form. No numerical evaluation is required.",
            "solution": "The problem will be validated by first extracting the given information and then checking it for scientific soundness, self-consistency, and well-posedness.\n\n### Step 1: Extract Givens\n- Configuration space: $Q = \\mathbb{R}^{n}$.\n- Continuous Lagrangian: $L(q, \\dot{q}) = \\tfrac{1}{2}\\dot{q}^{\\mathsf{T}} M \\dot{q} - V(q)$.\n- Mass matrix: $M \\in \\mathbb{R}^{n \\times n}$ is a symmetric positive-definite constant matrix.\n- Potential: $V: \\mathbb{R}^{n} \\to \\mathbb{R}$ is a continuously differentiable function.\n- Discrete time-step: $h > 0$.\n- Trapezoidal discrete Lagrangian: $L_{d}(q_{k}, q_{k+1}; h) = \\frac{1}{2h}\\,(q_{k+1} - q_{k})^{\\mathsf{T}} M (q_{k+1} - q_{k}) - \\frac{h}{2}\\,\\big(V(q_{k}) + V(q_{k+1})\\big)$.\n- Left discrete momentum: $p_{k}^{-} = -\\,D_{1} L_{d}(q_{k}, q_{k+1}; h)$, where $D_{1}$ is the derivative with respect to the first argument.\n- Right discrete momentum: $p_{k}^{+} = D_{2} L_{d}(q_{k-1}, q_{k}; h)$, where $D_{2}$ is the derivative with respect to the second argument.\n- Centered discrete momentum: $p_{k}^{c} = \\frac{1}{2}\\,\\big(p_{k}^{-} + p_{k}^{+}\\big)$.\n- Target expression for centered momentum: $p_{k}^{c} = \\frac{1}{2h}\\,M\\,(q_{k+1} - q_{k-1})$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard exercise in the field of geometric numerical integration and discrete mechanics.\n- **Scientifically Grounded**: The concepts of Lagrangians, Legendre transforms, and numerical discretization (specifically, the trapezoidal rule) are fundamental principles in classical mechanics and numerical analysis. The construction of the discrete Lagrangian and momenta follows established methods in variational integration.\n- **Well-Posed**: The problem is a direct calculation based on the provided definitions. It is fully specified and leads to a unique analytical solution.\n- **Objective**: The problem is stated using precise mathematical language and definitions, free of any subjective or ambiguous terminology.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is a well-defined mathematical derivation within the specified topic of discrete mechanics. The solution process will now proceed.\n\nThe task is to compute the expressions for the left and right discrete momenta, $p_{k}^{-}$ and $p_{k}^{+}$, and then use them to verify the given form of the centered discrete momentum, $p_{k}^{c}$.\n\nFirst, we compute the left discrete momentum $p_{k}^{-}$. By definition, $p_{k}^{-} = -D_{1} L_{d}(q_{k}, q_{k+1}; h)$. We must differentiate the discrete Lagrangian $L_{d}(q_{k}, q_{k+1}; h)$ with respect to its first argument, $q_{k}$. The discrete Lagrangian is\n$$\nL_{d}(q_{k}, q_{k+1}; h) = \\frac{1}{2h}(q_{k+1} - q_{k})^{\\mathsf{T}} M (q_{k+1} - q_{k}) - \\frac{h}{2}(V(q_{k}) + V(q_{k+1}))\n$$\nWe will differentiate each term with respect to $q_k$. For the kinetic term, let $u = q_{k+1} - q_{k}$. The term is $\\frac{1}{2h}u^{\\mathsf{T}}Mu$. Using the rules of matrix calculus for a vector $x$ and a symmetric matrix $A$, the gradient $\\nabla_{x}(x^{\\mathsf{T}}Ax)$ is $2Ax$. Applying the chain rule, the gradient with respect to $q_k$ is:\n$$\nD_{1} \\left( \\frac{1}{2h}(q_{k+1} - q_{k})^{\\mathsf{T}} M (q_{k+1} - q_{k}) \\right) = \\frac{1}{2h} \\cdot 2M(q_{k+1} - q_{k}) \\cdot \\frac{\\partial}{\\partial q_{k}}(q_{k+1} - q_{k}) = \\frac{1}{h} M(q_{k+1} - q_{k}) \\cdot (-I) = -\\frac{1}{h}M(q_{k+1} - q_{k})\n$$\nwhere $I$ is the identity matrix.\nFor the potential term, the derivative is straightforward:\n$$\nD_{1} \\left( -\\frac{h}{2}(V(q_{k}) + V(q_{k+1})) \\right) = -\\frac{h}{2} \\nabla V(q_{k})\n$$\nCombining these results gives the total derivative $D_{1} L_{d}$:\n$$\nD_{1} L_{d}(q_{k}, q_{k+1}; h) = -\\frac{1}{h}M(q_{k+1} - q_{k}) - \\frac{h}{2}\\nabla V(q_{k})\n$$\nThe left discrete momentum $p_{k}^{-}$ is the negative of this expression:\n$$\np_{k}^{-} = -D_{1} L_{d}(q_{k}, q_{k+1}; h) = \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k})\n$$\n\nNext, we compute the right discrete momentum $p_{k}^{+}$. By definition, $p_{k}^{+} = D_{2} L_{d}(q_{k-1}, q_{k}; h)$. First, we write down $L_{d}$ with its arguments shifted from $(q_k, q_{k+1})$ to $(q_{k-1}, q_{k})$:\n$$\nL_{d}(q_{k-1}, q_{k}; h) = \\frac{1}{2h}(q_{k} - q_{k-1})^{\\mathsf{T}} M (q_{k} - q_{k-1}) - \\frac{h}{2}(V(q_{k-1}) + V(q_{k}))\n$$\nNow, we differentiate this expression with respect to its second argument, $q_{k}$. For the kinetic term, let $v = q_{k} - q_{k-1}$. The derivative with respect to $q_k$ is:\n$$\nD_{2} \\left( \\frac{1}{2h}(q_{k} - q_{k-1})^{\\mathsf{T}} M (q_{k} - q_{k-1}) \\right) = \\frac{1}{2h} \\cdot 2M(q_{k} - q_{k-1}) \\cdot \\frac{\\partial}{\\partial q_{k}}(q_{k} - q_{k-1}) = \\frac{1}{h}M(q_{k} - q_{k-1}) \\cdot (I) = \\frac{1}{h}M(q_{k} - q_{k-1})\n$$\nFor the potential term, the derivative is:\n$$\nD_{2} \\left( -\\frac{h}{2}(V(q_{k-1}) + V(q_{k})) \\right) = -\\frac{h}{2}\\nabla V(q_{k})\n$$\nCombining these results gives the expression for $p_k^+$:\n$$\np_{k}^{+} = D_{2} L_{d}(q_{k-1}, q_{k}; h) = \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k})\n$$\nThese are the explicit expressions for $p_{k}^{-}$ and $p_{k}^{+}$.\n\nFinally, we show that the centered discrete momentum $p_{k}^{c}$ has the desired form. We use its definition $p_{k}^{c} = \\frac{1}{2}(p_{k}^{-} + p_{k}^{+})$ and substitute the expressions we found:\n$$\np_{k}^{c} = \\frac{1}{2} \\left[ \\left( \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k}) \\right) + \\left( \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k}) \\right) \\right]\n$$\nThe potential terms involving $\\nabla V(q_{k})$ cancel out:\n$$\np_{k}^{c} = \\frac{1}{2} \\left[ \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{1}{h}M(q_{k} - q_{k-1}) \\right]\n$$\nFactoring out the term $\\frac{1}{h}M$:\n$$\np_{k}^{c} = \\frac{1}{2h} M \\left[ (q_{k+1} - q_{k}) + (q_{k} - q_{k-1}) \\right]\n$$\nSimplifying the expression in the brackets yields:\n$$\np_{k}^{c} = \\frac{1}{2h} M (q_{k+1} - q_{k-1})\n$$\nThis confirms the expression given in the problem statement. The term $\\frac{q_{k+1} - q_{k-1}}{2h}$ is the second-order centered finite difference approximation to the velocity $\\dot{q}$ at time $t_{k}=kh$. Thus, $p_k^c$ is a discrete approximation to the continuous momentum $p(t_k) = M\\dot{q}(t_k)$.\n\nThe question asks for the final answer to be the pair $(p_{k}^{-},\\,p_{k}^{+})$.\n$p_{k}^{-} = \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k})$\n$p_{k}^{+} = \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k})$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k}) & \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k}) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Beyond conserving momentum, variational integrators are prized for preserving the geometric structure of phase space known as symplecticity. This practice delves into the heart of this property by asking you to compute the discrete Poincaré–Cartan $1$-forms, $\\Theta_{d}^{-}$ and $\\Theta_{d}^{+}$, and the resulting discrete symplectic $2$-form $\\Omega_{d}$. Carrying out this derivation for a free particle will reveal how the variational structure gives rise to a constant symplectic form, the discrete analogue of the canonical structure that governs Hamiltonian dynamics. ",
            "id": "3739291",
            "problem": "Consider a configuration space $Q=\\mathbb{R}^{n}$ with the standard Euclidean inner product and norm. Let the continuous Lagrangian be $L(q,\\dot{q})=\\tfrac{1}{2}m\\|\\dot{q}\\|^{2}$ for a particle of mass $m>0$. For a fixed time step $h>0$, define the midpoint discrete Lagrangian $L_{d}:Q\\times Q\\to\\mathbb{R}$ by\n$$\nL_{d}(q_{0},q_{1}) \\;=\\; h\\,L\\!\\left(\\tfrac{q_{0}+q_{1}}{2},\\,\\tfrac{q_{1}-q_{0}}{h}\\right).\n$$\nIn discrete Lagrangian mechanics, the discrete Poincaré–Cartan $1$-forms are defined by the core discrete variational principles as\n$$\n\\Theta_{d}^{-}(q_{0},q_{1}) \\;=\\; -\\,D_{1}L_{d}(q_{0},q_{1})\\cdot dq_{0}, \n\\qquad\n\\Theta_{d}^{+}(q_{0},q_{1}) \\;=\\; D_{2}L_{d}(q_{0},q_{1})\\cdot dq_{1},\n$$\nand the associated discrete symplectic $2$-form is the exterior derivative\n$$\n\\Omega_{d} \\;=\\; -\\,d\\Theta_{d}^{+} \\;=\\; -\\,d\\Theta_{d}^{-}.\n$$\nHere $D_{1}$ and $D_{2}$ denote partial derivatives with respect to the first and second arguments of $L_{d}$, respectively, and $dq_{0}$, $dq_{1}$ denote the coordinate $1$-forms on $Q\\times Q$.\n\nTasks:\n- Starting from the above definitions and the given continuous Lagrangian, compute $L_{d}(q_{0},q_{1})$ explicitly.\n- Using only the definitions provided, compute explicit coordinate expressions for $\\Theta_{d}^{-}$ and $\\Theta_{d}^{+}$ on $Q\\times Q$.\n- Compute $\\Omega_{d}$ explicitly as a $2$-form on $Q\\times Q$ and verify from your expression that $\\Omega_{d}$ is constant on $Q\\times Q$.\n\nAnswer specification:\n- Provide your final answer as a single analytic expression for all three of $\\Theta_{d}^{-}$, $\\Theta_{d}^{+}$, and $\\Omega_{d}$ collected together using a single row matrix with three entries, in standard coordinates $\\{q_{0}^{i},q_{1}^{i}\\}_{i=1}^{n}$. \n- No numerical rounding is required and no units should be included in the final boxed expression.",
            "solution": "The problem is validated as follows:\n\\\n**Step 1: Extract Givens**\n- Configuration space: $Q=\\mathbb{R}^{n}$ with standard Euclidean inner product and norm.\n- Continuous Lagrangian: $L(q,\\dot{q})=\\tfrac{1}{2}m\\|\\dot{q}\\|^{2}$ for a particle of mass $m>0$.\n- Time step: $h>0$.\n- Midpoint discrete Lagrangian: $L_{d}(q_{0},q_{1}) = h\\,L\\!\\left(\\tfrac{q_{0}+q_{1}}{2},\\,\\tfrac{q_{1}-q_{0}}{h}\\right)$.\n- Discrete Poincaré–Cartan $1$-forms definitions: $\\Theta_{d}^{-}(q_{0},q_{1}) = -\\,D_{1}L_{d}(q_{0},q_{1})\\cdot dq_{0}$ and $\\Theta_{d}^{+}(q_{0},q_{1}) = D_{2}L_{d}(q_{0},q_{1})\\cdot dq_{1}$.\n- Discrete symplectic $2$-form definition: $\\Omega_{d} = -\\,d\\Theta_{d}^{+} = -\\,d\\Theta_{d}^{-}$.\n- Notation: $D_{1}$ and $D_{2}$ are partial derivatives with respect to the first and second arguments of $L_d$, respectively. $dq_{0}$, $dq_{1}$ are coordinate $1$-forms on $Q\\times Q$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem is firmly rooted in the established field of geometric mechanics, specifically the theory of discrete variational integrators. The concepts of discrete Lagrangians, discrete Poincaré-Cartan forms, and discrete symplectic forms are standard in this domain. The chosen Lagrangian is for a free particle, a fundamental system in classical mechanics.\n- **Well-Posed:** The problem provides all necessary definitions and initial data to perform the requested computations. The tasks are explicit, and a unique, meaningful solution can be derived through direct application of the provided definitions.\n- **Objective:** The problem is stated using precise mathematical language, free from any ambiguity, subjectivity, or opinion.\n\nThe problem does not exhibit any flaws such as scientific unsoundness, incompleteness, contradiction, or ambiguity.\n\n**Step 3: Verdict and Action**\nThe problem is valid. The solution proceeds as follows.\n\nThe first task is to compute the explicit form of the discrete Lagrangian $L_{d}(q_{0},q_{1})$. We are given the continuous Lagrangian $L(q,\\dot{q})=\\tfrac{1}{2}m\\|\\dot{q}\\|^{2}$ and the discretization rule $L_{d}(q_{0},q_{1}) = h\\,L(\\tfrac{q_{0}+q_{1}}{2},\\,\\tfrac{q_{1}-q_{0}}{h})$.\nSubstituting the arguments into $L$, we note that $L$ is independent of its first argument $q$. We replace $\\dot{q}$ with the finite difference approximation $\\tfrac{q_{1}-q_{0}}{h}$.\n$$\nL\\left(\\tfrac{q_{0}+q_{1}}{2},\\,\\tfrac{q_{1}-q_{0}}{h}\\right) = \\frac{1}{2}m\\left\\|\\frac{q_{1}-q_{0}}{h}\\right\\|^{2} = \\frac{m}{2h^{2}}\\|q_{1}-q_{0}\\|^{2}.\n$$\nNow, we substitute this back into the definition of $L_{d}$:\n$$\nL_{d}(q_{0},q_{1}) = h \\left( \\frac{m}{2h^{2}}\\|q_{1}-q_{0}\\|^{2} \\right) = \\frac{m}{2h}\\|q_{1}-q_{0}\\|^{2}.\n$$\nIn the standard coordinates $\\{q_{0}^{i}, q_{1}^{i}\\}_{i=1}^{n}$ on $Q \\times Q = \\mathbb{R}^n \\times \\mathbb{R}^n$, this expression becomes:\n$$\nL_{d}(q_{0},q_{1}) = \\frac{m}{2h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i})^{2}.\n$$\n\nThe second task is to compute the discrete $1$-forms $\\Theta_{d}^{-}$ and $\\Theta_{d}^{+}$.\nWe start with $\\Theta_{d}^{-}(q_{0},q_{1}) = -D_{1}L_{d}(q_{0},q_{1})\\cdot dq_{0}$. This is equivalent to $\\Theta_{d}^{-} = -\\sum_{i=1}^{n} \\frac{\\partial L_{d}}{\\partial q_{0}^{i}} dq_{0}^{i}$.\nLet's compute the partial derivative of $L_{d}$ with respect to a coordinate $q_{0}^{j}$:\n$$\n\\frac{\\partial L_{d}}{\\partial q_{0}^{j}} = \\frac{\\partial}{\\partial q_{0}^{j}} \\left( \\frac{m}{2h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i})^{2} \\right) = \\frac{m}{2h} \\cdot 2(q_{1}^{j} - q_{0}^{j})(-1) = -\\frac{m}{h}(q_{1}^{j} - q_{0}^{j}).\n$$\nSubstituting this into the expression for $\\Theta_{d}^{-}$:\n$$\n\\Theta_{d}^{-} = -\\sum_{j=1}^{n} \\left( -\\frac{m}{h}(q_{1}^{j} - q_{0}^{j}) \\right) dq_{0}^{j} = \\frac{m}{h} \\sum_{j=1}^{n} (q_{1}^{j} - q_{0}^{j}) dq_{0}^{j}.\n$$\nNext, we compute $\\Theta_{d}^{+}(q_{0},q_{1}) = D_{2}L_{d}(q_{0},q_{1})\\cdot dq_{1}$, which is equivalent to $\\Theta_{d}^{+} = \\sum_{i=1}^{n} \\frac{\\partial L_{d}}{\\partial q_{1}^{i}} dq_{1}^{i}$.\nThe partial derivative of $L_{d}$ with respect to a coordinate $q_{1}^{j}$ is:\n$$\n\\frac{\\partial L_{d}}{\\partial q_{1}^{j}} = \\frac{\\partial}{\\partial q_{1}^{j}} \\left( \\frac{m}{2h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i})^{2} \\right) = \\frac{m}{2h} \\cdot 2(q_{1}^{j} - q_{0}^{j})(1) = \\frac{m}{h}(q_{1}^{j} - q_{0}^{j}).\n$$\nSubstituting this into the expression for $\\Theta_{d}^{+}$:\n$$\n\\Theta_{d}^{+} = \\sum_{j=1}^{n} \\left( \\frac{m}{h}(q_{1}^{j} - q_{0}^{j}) \\right) dq_{1}^{j} = \\frac{m}{h} \\sum_{j=1}^{n} (q_{1}^{j} - q_{0}^{j}) dq_{1}^{j}.\n$$\n\nThe third task is to compute the discrete symplectic $2$-form $\\Omega_{d} = -d\\Theta_{d}^{+}$ and verify its constancy.\nWe take the exterior derivative of $\\Theta_{d}^{+}$:\n$$\nd\\Theta_{d}^{+} = d\\left( \\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{1}^{i} \\right) = \\frac{m}{h} \\sum_{i=1}^{n} d(q_{1}^{i} - q_{0}^{i}) \\wedge dq_{1}^{i}.\n$$\nThe exterior derivative of the coefficient function is $d(q_{1}^{i} - q_{0}^{i}) = dq_{1}^{i} - dq_{0}^{i}$. Substituting this back:\n$$\nd\\Theta_{d}^{+} = \\frac{m}{h} \\sum_{i=1}^{n} (dq_{1}^{i} - dq_{0}^{i}) \\wedge dq_{1}^{i}.\n$$\nUsing the properties of the wedge product, $(A-B)\\wedge A = A \\wedge A - B \\wedge A = 0 - B \\wedge A$, we get:\n$$\nd\\Theta_{d}^{+} = \\frac{m}{h} \\sum_{i=1}^{n} (dq_{1}^{i}\\wedge dq_{1}^{i} - dq_{0}^{i} \\wedge dq_{1}^{i}) = \\frac{m}{h} \\sum_{i=1}^{n} (0 - dq_{0}^{i} \\wedge dq_{1}^{i}) = -\\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i}.\n$$\nFinally, we apply the definition $\\Omega_{d} = -d\\Theta_{d}^{+}$:\n$$\n\\Omega_{d} = - \\left( -\\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i} \\right) = \\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i}.\n$$\nTo verify that this result is consistent, we can also compute $\\Omega_d = -d\\Theta_d^-$:\n$$\nd\\Theta_{d}^{-} = d\\left(\\frac{m}{h}\\sum_{i=1}^{n}(q_{1}^{i}-q_{0}^{i})dq_{0}^{i}\\right) = \\frac{m}{h}\\sum_{i=1}^{n}d(q_{1}^{i}-q_{0}^{i})\\wedge dq_{0}^{i} = \\frac{m}{h}\\sum_{i=1}^{n}(dq_{1}^{i}-dq_{0}^{i})\\wedge dq_{0}^{i}.\n$$\nThis simplifies to:\n$$\nd\\Theta_{d}^{-} = \\frac{m}{h}\\sum_{i=1}^{n}(dq_{1}^{i}\\wedge dq_{0}^{i} - dq_{0}^{i}\\wedge dq_{0}^{i}) = \\frac{m}{h}\\sum_{i=1}^{n}dq_{1}^{i}\\wedge dq_{0}^{i} = -\\frac{m}{h}\\sum_{i=1}^{n}dq_{0}^{i}\\wedge dq_{1}^{i}.\n$$\nThus, $\\Omega_{d} = -d\\Theta_{d}^{-} = -(-\\frac{m}{h}\\sum_{i=1}^{n}dq_{0}^{i}\\wedge dq_{1}^{i}) = \\frac{m}{h}\\sum_{i=1}^{n}dq_{0}^{i}\\wedge dq_{1}^{i}$, which confirms our previous result.\nThe expression for $\\Omega_{d}$ is a linear combination of the basis $2$-forms $dq_{0}^{i} \\wedge dq_{1}^{i}$ with coefficients $\\frac{m}{h}$. Since $m$ and $h$ are constants, the coefficients of $\\Omega_{d}$ in this standard coordinate basis are constant. Therefore, the $2$-form $\\Omega_{d}$ is constant on $Q \\times Q$.\n\nThe three requested quantities are:\n$$\n\\Theta_{d}^{-} = \\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{0}^{i}\n$$\n$$\n\\Theta_{d}^{+} = \\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{1}^{i}\n$$\n$$\n\\Omega_{d} = \\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i}\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{0}^{i} & \\frac{m}{h} \\sum_{i=1}^{n} (q_{1}^{i} - q_{0}^{i}) dq_{1}^{i} & \\frac{m}{h} \\sum_{i=1}^{n} dq_{0}^{i} \\wedge dq_{1}^{i}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The theoretical elegance of discrete Noether's theorem promises exact conservation of momentum, but this guarantee holds only if the discrete Lagrangian's symmetries are perfectly respected in computation. This final practice moves from pen-and-paper derivation to a numerical experiment that explores what happens when finite-precision arithmetic intervenes. By implementing a simple variational integrator and comparing two algebraically equivalent formulas, you will directly observe and quantify how numerical round-off error can break symmetry and cause the 'conserved' momentum to drift. ",
            "id": "3739286",
            "problem": "Consider a configuration space $\\mathbb{R}^d$ with the translation group $G = \\mathbb{R}^d$ acting by $q \\mapsto q + a$ for any constant vector $a \\in \\mathbb{R}^d$. Let the continuous Lagrangian be $L(q,\\dot{q}) = \\frac{m}{2} \\|\\dot{q}\\|^2$, which is invariant under the action of $G$. The discrete Lagrangian for a time step $h > 0$ is defined by $L_d(q_k,q_{k+1};h)$ and gives a variational integrator by the discrete Euler–Lagrange equations $D_2 L_d(q_{k-1},q_k;h) + D_1 L_d(q_k,q_{k+1};h) = 0$. For a translation-invariant discrete Lagrangian, the discrete momentum map associated to the $G$-symmetry is preserved step-to-step by discrete Noether’s theorem, provided $L_d$ is exactly $G$-invariant.\n\nStarting from the fundamental definitions above, the task is to:\n- Derive the discrete momentum map for the free particle with discrete Lagrangian $L_d(q_k,q_{k+1};h) = \\frac{m}{2h}\\|q_{k+1}-q_k\\|^2$.\n- Design a numerical scheme to propagate the discrete dynamics and to monitor per-step drift in the discrete linear momentum due to roundoff.\n- Numerically relate the observed drift to violations of exact $G$-invariance in floating-point arithmetic by comparing two algebraically equivalent evaluations of $L_d$: \n  1) a difference form $L_d^{\\mathrm{diff}}(q_k,q_{k+1};h) = \\frac{m}{2h}\\|q_{k+1}-q_k\\|^2$; \n  2) an expanded dot-product form $L_d^{\\mathrm{exp}}(q_k,q_{k+1};h) = \\frac{m}{2h}\\left(\\|q_{k+1}\\|^2 + \\|q_k\\|^2 - 2\\,q_{k+1}\\cdot q_k\\right)$.\n\nImplement the following numerical scheme:\n1. Initialize $q_0 \\in \\mathbb{R}^d$ and $q_1 = q_0 + h v_0$ for a chosen initial velocity $v_0 \\in \\mathbb{R}^d$.\n2. Propagate $q_{k+1} = 2 q_k - q_{k-1}$ for $k = 1,2,\\dots,N-1$.\n3. At each step $k = 1,2,\\dots,N-1$, compute the discrete momentum $p_k = \\frac{m}{h}(q_k - q_{k-1})$ and the drift $\\|p_{k+1} - p_k\\|$.\n4. At each step, compute an invariance defect under a fixed translation $a \\in \\mathbb{R}^d$ by evaluating\n   $\\Delta^{\\mathrm{exp}}_k = \\left|L_d^{\\mathrm{exp}}(q_k+a,q_{k+1}+a;h) - L_d^{\\mathrm{exp}}(q_k,q_{k+1};h)\\right|$ and \n   $\\Delta^{\\mathrm{diff}}_k = \\left|L_d^{\\mathrm{diff}}(q_k+a,q_{k+1}+a;h) - L_d^{\\mathrm{diff}}(q_k,q_{k+1};h)\\right|$.\n5. Quantify the relationship between momentum drift and invariance defect by computing the Pearson correlation coefficient between the time series $\\{\\|p_{k+1}-p_k\\|\\}_{k=1}^{N-1}$ and $\\{\\Delta^{\\mathrm{exp}}_k\\}_{k=1}^{N-1}$. If either time series has zero variance, define the correlation to be $0.0$.\n\nYour program must implement this scheme and produce, for each test case, a list of four floats:\n- The maximum momentum drift $\\max_{1 \\le k \\le N-1} \\|p_{k+1}-p_k\\|$.\n- The maximum expanded-form invariance defect $\\max_{1 \\le k \\le N-1} \\Delta^{\\mathrm{exp}}_k$.\n- The maximum difference-form invariance defect $\\max_{1 \\le k \\le N-1} \\Delta^{\\mathrm{diff}}_k$.\n- The correlation coefficient between the momentum drift series and the expanded-form invariance defect series.\n\nNo physical units are required; all quantities must be treated as dimensionless numbers. Angles do not appear in this setup.\n\nTest Suite:\n- Case 1 (happy path): $d=3$, $m=1.0$, $h=10^{-3}$, $N=1000$, $a = (0,0,0)$, $q_0 = (0,0,0)$, $v_0 = (1,-1,0.5)$.\n- Case 2 (edge case: large offset and small step): $d=3$, $m=1.0$, $h=10^{-9}$, $N=2000$, $a = (10^{12},10^{12},10^{12})$, $q_0 = a$, $v_0 = (1,-1,0.5)$.\n- Case 3 (boundary case: very small step and large offset in two dimensions): $d=2$, $m=1.0$, $h=5\\cdot 10^{-12}$, $N=1500$, $a = (10^{15},10^{15})$, $q_0 = a$, $v_0 = (0.3,-0.7)$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of the four floats in the order specified above, for example, \n\"[[r_{1,1},r_{1,2},r_{1,3},r_{1,4}],[r_{2,1},r_{2,2},r_{2,3},r_{2,4}],[r_{3,1},r_{3,2},r_{3,3},r_{3,4}]]\".",
            "solution": "The problem is valid. It presents a well-posed and scientifically sound numerical experiment in the field of geometric mechanics, designed to investigate the numerical consequences of breaking a symmetry in a variational integrator. All required definitions, parameters, and procedures are specified without ambiguity or contradiction.\n\n### Introduction to the theoretical framework\n\nThe problem explores the connection between symmetry and conservation laws within the context of discrete variational mechanics. For a continuous mechanical system with a Lagrangian $L(q, \\dot{q})$ that is invariant under the action of a Lie group $G$, Noether's theorem guarantees the existence of a conserved quantity, known as the momentum map. Variational integrators are numerical methods derived by discretizing Hamilton's principle of stationary action. A key feature of these methods is that if the discrete Lagrangian $L_d(q_k, q_{k+1};h)$ inherits the symmetries of the continuous Lagrangian, the resulting numerical scheme will exactly preserve a corresponding discrete momentum map. This problem focuses on the translation group $G = (\\mathbb{R}^d, +)$ and a free particle, for which the conserved quantity is linear momentum. It then investigates how floating-point arithmetic can break the exact numerical symmetry, leading to a drift in the otherwise conserved momentum.\n\n### Part 1: Derivation of the Discrete Momentum Map\n\nThe discrete momentum map is derived from the discrete Lagrangian using the principles of discrete Noether's theorem.\n\n1.  **System and Symmetry**: The configuration space is $Q = \\mathbb{R}^d$. The system is a free particle with mass $m$, described by the discrete Lagrangian $L_d(q_k, q_{k+1}; h) = \\frac{m}{2h}\\|q_{k+1} - q_k\\|^2$, which is a discretization of the action integral for the continuous Lagrangian $L(q, \\dot{q}) = \\frac{m}{2}\\|\\dot{q}\\|^2$. The symmetry group is the translation group $G = \\mathbb{R}^d$, acting on $Q$ by $\\Phi_a(q) = q + a$ for any constant vector $a \\in \\mathbb{R}^d$.\n\n2.  **Invariance of the Discrete Lagrangian**: The discrete Lagrangian is exactly invariant under the group action:\n    $$L_d(\\Phi_a(q_k), \\Phi_a(q_{k+1}); h) = L_d(q_k + a, q_{k+1} + a; h) = \\frac{m}{2h} \\|(q_{k+1} + a) - (q_k + a)\\|^2 = \\frac{m}{2h} \\|q_{k+1} - q_k\\|^2 = L_d(q_k, q_{k+1}; h)$$\n    This exact invariance is the foundation for the discrete conservation law.\n\n3.  **Discrete Momentum Map**: According to discrete Noether's theorem, the conserved quantity is related to the partial derivatives of the discrete Lagrangian. The left and right discrete momenta are defined from the derivatives of $L_d$ with respect to its arguments. Let's compute these derivatives:\n    -   $D_1 L_d(q_k, q_{k+1}; h) = \\frac{\\partial L_d}{\\partial q_k} = \\frac{m}{h}(q_k - q_{k+1})$\n    -   $D_2 L_d(q_k, q_{k+1}; h) = \\frac{\\partial L_d}{\\partial q_{k+1}} = \\frac{m}{h}(q_{k+1} - q_k)$\n\n    The problem defines the discrete momentum at step $k$ as $p_k$. Following standard conventions in geometric integration, the momentum associated with the interval $(q_{k-1}, q_k)$ is given by $p_k = D_2 L_d(q_{k-1}, q_k; h)$ or $p_k = -D_1 L_d(q_{k-1}, q_k; h)$. Both definitions yield the same result:\n    $$p_k = D_2 L_d(q_{k-1}, q_k; h) = \\frac{m}{h}(q_k - q_{k-1})$$\n    This expression $p_k$ is the discrete analogue of the continuous linear momentum $p = m\\dot{q}$. This is the discrete momentum map for the system.\n\n4.  **Conservation Law**: The dynamics are governed by the discrete Euler-Lagrange (DEL) equations: $D_2 L_d(q_{k-1}, q_k; h) + D_1 L_d(q_k, q_{k+1}; h) = 0$. Substituting the derivatives:\n    $$\\frac{m}{h}(q_k - q_{k-1}) - \\frac{m}{h}(q_{k+1} - q_k) = 0$$\n    This simplifies to $p_k - p_{k+1} = 0$, or $p_{k+1} = p_k$. This confirms that the discrete momentum $p_k = \\frac{m}{h}(q_k - q_{k-1})$ is exactly conserved along the trajectory defined by the DEL equations. The DEL equation itself can be rearranged to give the integrator specified in the problem:\n    $$q_k - q_{k-1} = q_{k+1} - q_k \\implies q_{k+1} = 2q_k - q_{k-1}$$\n    This is the Störmer-Verlet method for a particle with zero acceleration, correctly representing free motion.\n\n### Part 2: Analysis of the Numerical Scheme\n\nThe problem requires a numerical simulation to explore the consequences of performing these calculations using finite-precision floating-point arithmetic.\n\n1.  **Momentum Drift**: In exact arithmetic, $\\|p_{k+1} - p_k\\| = 0$. However, the numerical computation of $q_{k+1} = 2q_k - q_{k-1}$ is subject to round-off error. When $q_k$ and $q_{k-1}$ are large vectors with small differences, their manipulation can lead to a loss of precision. This error in $q_{k+1}$ propagates, causing the computed $p_{k+1}$ to differ slightly from $p_k$. The quantity $\\|p_{k+1} - p_k\\|$ measures this numerical drift per step.\n\n2.  **Invariance Defect**: The problem introduces two algebraically equivalent forms of the discrete Lagrangian:\n    -   Difference form: $L_d^{\\mathrm{diff}}(q_k, q_{k+1}; h) = \\frac{m}{2h}\\|q_{k+1} - q_k\\|^2$\n    -   Expanded form: $L_d^{\\mathrm{exp}}(q_k, q_{k+1}; h) = \\frac{m}{2h}(\\|q_{k+1}\\|^2 + \\|q_k\\|^2 - 2q_{k+1} \\cdot q_k)$\n\n    The purpose is to show they behave differently under floating-point arithmetic. The invariance defect measures the failure of the numerical implementation to satisfy $L_d(q_k+a, q_{k+1}+a) = L_d(q_k, q_{k+1})$.\n\n    -   For $L_d^{\\mathrm{diff}}$, the defect $\\Delta^{\\mathrm{diff}}_k$ is calculated from $|L_d^{\\mathrm{diff}}(q_k+a, q_{k+1}+a) - L_d^{\\mathrm{diff}}(q_k, q_{k+1})|$. The core computation is $(q_{k+1}+a) - (q_k+a)$. If $q_k$ and $q_{k+1}$ are large and very close to each other, their difference is small. The subtraction $(q_{k+1}+a) - (q_k+a)$ is numerically stable, as it computes the difference of two nearby large numbers to produce a small number accurately. Therefore, we expect $\\Delta^{\\mathrm{diff}}_k$ to be close to machine precision.\n\n    -   For $L_d^{\\mathrm{exp}}$, the defect $\\Delta^{\\mathrm{exp}}_k$ relies on computing terms like $\\|q_k+a\\|^2 + \\|q_{k+1}\\|^2$ and subtracting them from similar terms. For instance, testing invariance involves calculating $\\|q_k+a\\|^2$ and $\\|q_k\\|^2$. If $q_k$ is a large vector (e.g., $q_k \\approx 10^{15}$ as in Case 3), then $\\|q_k+a\\|^2$ and $\\|q_k\\|^2$ are both enormous and very close to each other. Their subtraction, $\\|q_k+a\\|^2 - \\|q_k\\|^2$, is an example of **catastrophic cancellation**, where most significant digits are lost, leading to a large relative error. Consequently, the computed value of $L_d^{\\mathrm{exp}}(q_k+a, q_{k+1}+a)$ will differ significantly from $L_d^{\\mathrm{exp}}(q_k, q_{k+1})$, resulting in a large invariance defect $\\Delta^{\\mathrm{exp}}_k$.\n\n3.  **Correlation**: The central hypothesis to be tested is that the numerical drift in the conserved quantity (momentum) is directly caused by the numerical breaking of the associated symmetry (translation invariance). By computing the Pearson correlation coefficient between the time series of momentum drift, $\\{\\|p_{k+1}-p_k\\|\\}_{k=1}^{N-1}$, and the invariance defect time series, $\\{\\Delta^{\\mathrm{exp}}_k\\}_{k=1}^{N-1}$, we can quantitatively assess this relationship. A high positive correlation would provide strong numerical evidence for this fundamental principle of geometric integration, demonstrating that the failure to preserve symmetry leads to a failure to preserve the corresponding momentum map.\n\n### Implementation Strategy\n\nThe numerical simulation is implemented as follows:\n1.  Initialize system parameters ($m, h, d, N, a, q_0, v_0$) for each test case.\n2.  Set up an array `q` of size $(N+1) \\times d$ to store the trajectory. Initialize $q_0$ and $q_1 = q_0 + h v_0$.\n3.  Loop for $k$ from $1$ to $N-1$:\n    a. Compute $q_{k+1} = 2q_k - q_{k-1}$.\n    b. Compute the momenta $p_k = \\frac{m}{h}(q_k - q_{k-1})$ and $p_{k+1} = \\frac{m}{h}(q_{k+1} - q_k)$.\n    c. Calculate the momentum drift $\\|p_{k+1} - p_k\\|$ and store it in a results array.\n    d. Calculate the invariance defects $\\Delta_k^{\\mathrm{exp}}$ and $\\Delta_k^{\\mathrm{diff}}$ using the provided formulas and store them.\n4.  After the loop, compute the required summary statistics:\n    a. The maximum value of the momentum drift series.\n    b. The maximum value of the $\\Delta_k^{\\mathrm{exp}}$ series.\n    c. The maximum value of the $\\Delta_k^{\\mathrm{diff}}$ series.\n    d. The Pearson correlation coefficient between the momentum drift series and the $\\Delta_k^{\\mathrm{exp}}$ series. A check for zero variance is included, setting the correlation to $0.0$ in that case, as specified.\n5.  Format the four resulting floating-point numbers into the specified list format for each test case and print the final result.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the numerical experiment problem for discrete momentum maps and invariance.\n    \"\"\"\n    test_cases = [\n        # d, m, h, N, a, q0, v0\n        (3, 1.0, 1e-3, 1000, np.array([0.0, 0.0, 0.0]), np.array([0.0, 0.0, 0.0]), np.array([1.0, -1.0, 0.5])),\n        (3, 1.0, 1e-9, 2000, np.array([1e12, 1e12, 1e12]), np.array([1e12, 1e12, 1e12]), np.array([1.0, -1.0, 0.5])),\n        (2, 1.0, 5e-12, 1500, np.array([1e15, 1e15]), np.array([1e15, 1e15]), np.array([0.3, -0.7]))\n    ]\n\n    def L_diff(q_k, q_k_plus_1, m, h):\n        \"\"\"Computes the discrete Lagrangian using the difference form.\"\"\"\n        diff = q_k_plus_1 - q_k\n        return (m / (2.0 * h)) * np.dot(diff, diff)\n\n    def L_exp(q_k, q_k_plus_1, m, h):\n        \"\"\"Computes the discrete Lagrangian using the expanded form.\"\"\"\n        norm_q_k_sq = np.dot(q_k, q_k)\n        norm_q_k_plus_1_sq = np.dot(q_k_plus_1, q_k_plus_1)\n        dot_prod = np.dot(q_k_plus_1, q_k)\n        return (m / (2.0 * h)) * (norm_q_k_plus_1_sq + norm_q_k_sq - 2.0 * dot_prod)\n\n    final_results = []\n    \n    for d, m, h, N, a, q0, v0 in test_cases:\n        # Initialize trajectory array\n        q = np.zeros((N + 1, d), dtype=np.float64)\n        q[0] = q0\n        q[1] = q0 + h * v0\n\n        # Arrays to store time series data\n        momentum_drifts = np.zeros(N - 1, dtype=np.float64)\n        defects_exp = np.zeros(N - 1, dtype=np.float64)\n        defects_diff = np.zeros(N - 1, dtype=np.float64)\n\n        # Propagate dynamics and collect data\n        for k in range(1, N):\n            # Propagate position using Störmer-Verlet\n            q[k + 1] = 2.0 * q[k] - q[k - 1]\n\n            # The series are indexed from k=1..N-1 in the problem statement.\n            # Our loop runs k from 1 to N-1, so we store results at index k-1.\n            series_idx = k - 1\n            \n            # Compute momenta and drift\n            p_k = (m / h) * (q[k] - q[k - 1])\n            p_k_plus_1 = (m / h) * (q[k + 1] - q[k])\n            momentum_drifts[series_idx] = np.linalg.norm(p_k_plus_1 - p_k)\n            \n            # Current interval for Lagrangian evaluation\n            q_k = q[k]\n            q_k_plus_1 = q[k+1]\n\n            # Compute expanded-form invariance defect\n            l_exp_orig = L_exp(q_k, q_k_plus_1, m, h)\n            l_exp_trans = L_exp(q_k + a, q_k_plus_1 + a, m, h)\n            defects_exp[series_idx] = np.abs(l_exp_trans - l_exp_orig)\n            \n            # Compute difference-form invariance defect\n            l_diff_orig = L_diff(q_k, q_k_plus_1, m, h)\n            l_diff_trans = L_diff(q_k + a, q_k_plus_1 + a, m, h)\n            defects_diff[series_idx] = np.abs(l_diff_trans - l_diff_orig)\n\n        # Calculate summary statistics\n        max_drift = np.max(momentum_drifts)\n        max_defect_exp = np.max(defects_exp)\n        max_defect_diff = np.max(defects_diff)\n        \n        # Calculate Pearson correlation, handling the zero-variance case\n        std_drift = np.std(momentum_drifts)\n        std_defect_exp = np.std(defects_exp)\n        \n        correlation = 0.0\n        if std_drift > 0 and std_defect_exp > 0:\n            # np.corrcoef returns a 2x2 matrix\n            correlation_matrix = np.corrcoef(momentum_drifts, defects_exp)\n            correlation = correlation_matrix[0, 1]\n\n        final_results.append([max_drift, max_defect_exp, max_defect_diff, correlation])\n\n    # Format output as specified\n    formatted_cases = []\n    for case_result in final_results:\n        # Format each list of floats into \"[f1,f2,f3,f4]\"\n        s = f\"[{','.join(map(str, case_result))}]\"\n        formatted_cases.append(s)\n    \n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```"
        }
    ]
}