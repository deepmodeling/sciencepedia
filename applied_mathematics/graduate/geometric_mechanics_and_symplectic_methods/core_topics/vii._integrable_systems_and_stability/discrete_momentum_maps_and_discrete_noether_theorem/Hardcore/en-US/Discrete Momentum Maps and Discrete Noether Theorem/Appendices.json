{
    "hands_on_practices": [
        {
            "introduction": "To begin our exploration of discrete mechanics, we first must establish a clear connection between the familiar continuous world and its discrete analogue. This practice grounds the abstract definition of discrete momentum, derived from the discrete Legendre transform, in the concrete language of numerical analysis. By explicitly calculating the left and right discrete momenta for a system discretized with the trapezoidal rule , you will see how these new quantities naturally emerge as finite-difference approximations to the continuous momentum, providing a solid foundation for the concepts that follow.",
            "id": "3739303",
            "problem": "Consider a configuration space $Q = \\mathbb{R}^{n}$ and a mechanical Lagrangian of the form $L(q, \\dot{q}) = \\tfrac{1}{2}\\dot{q}^T M \\dot{q} - V(q)$, where $M \\in \\mathbb{R}^{n \\times n}$ is a symmetric positive-definite constant mass matrix and $V: \\mathbb{R}^{n} \\to \\mathbb{R}$ is a continuously differentiable potential. Let the discrete time-step be $h > 0$. Define the trapezoidal discrete Lagrangian by applying the trapezoidal rule in time and a constant-velocity interpolation between $q_{k}$ and $q_{k+1}$:\n$$\nL_{d}(q_{k}, q_{k+1}; h) \\;=\\; \\frac{1}{2h}\\,(q_{k+1} - q_{k})^T M (q_{k+1} - q_{k}) \\;-\\; \\frac{h}{2}\\,\\big(V(q_{k}) + V(q_{k+1})\\big).\n$$\nThe left and right discrete Legendre transforms define the discrete momenta by\n$$\np_{k}^{-} \\;:=\\; -\\,D_{1} L_{d}(q_{k}, q_{k+1}; h), \n\\qquad\np_{k}^{+} \\;:=\\; D_{2} L_{d}(q_{k-1}, q_{k}; h),\n$$\nwhere $D_{i}$ denotes the derivative with respect to the $i$-th argument. Starting from these definitions only, compute $p_{k}^{-}$ and $p_{k}^{+}$ explicitly in terms of $M$, $h$, $q_{k-1}$, $q_{k}$, $q_{k+1}$, and $\\nabla V(q_{k})$, $\\nabla V(q_{k+1})$. Then, using your expressions, show that the centered discrete momentum\n$$\np_{k}^{c} \\;:=\\; \\frac{1}{2}\\,\\big(p_{k}^{-} + p_{k}^{+}\\big)\n$$\nis a centered finite-difference approximation of the continuous momentum $M\\,\\dot{q}$ at the time level $k$, namely\n$$\np_{k}^{c} \\;=\\; \\frac{1}{2h}\\,M\\,(q_{k+1} - q_{k-1}).\n$$\nPresent your final answer as the single pair $\\big(p_{k}^{-},\\,p_{k}^{+}\\big)$ in closed form. No numerical evaluation is required.",
            "solution": "The problem will be validated by first extracting the given information and then checking it for scientific soundness, self-consistency, and well-posedness.\n\n### Step 1: Extract Givens\n- Configuration space: $Q = \\mathbb{R}^{n}$.\n- Continuous Lagrangian: $L(q, \\dot{q}) = \\tfrac{1}{2}\\dot{q}^T M \\dot{q} - V(q)$.\n- Mass matrix: $M \\in \\mathbb{R}^{n \\times n}$ is a symmetric positive-definite constant matrix.\n- Potential: $V: \\mathbb{R}^{n} \\to \\mathbb{R}$ is a continuously differentiable function.\n- Discrete time-step: $h > 0$.\n- Trapezoidal discrete Lagrangian: $L_{d}(q_{k}, q_{k+1}; h) = \\frac{1}{2h}\\,(q_{k+1} - q_{k})^T M (q_{k+1} - q_{k}) - \\frac{h}{2}\\,\\big(V(q_{k}) + V(q_{k+1})\\big)$.\n- Left discrete momentum: $p_{k}^{-} = -\\,D_{1} L_{d}(q_{k}, q_{k+1}; h)$, where $D_{1}$ is the derivative with respect to the first argument.\n- Right discrete momentum: $p_{k}^{+} = D_{2} L_{d}(q_{k-1}, q_{k}; h)$, where $D_{2}$ is the derivative with respect to the second argument.\n- Centered discrete momentum: $p_{k}^{c} = \\frac{1}{2}\\,\\big(p_{k}^{-} + p_{k}^{+}\\big)$.\n- Target expression for centered momentum: $p_{k}^{c} = \\frac{1}{2h}\\,M\\,(q_{k+1} - q_{k-1})$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard exercise in the field of geometric numerical integration and discrete mechanics.\n- **Scientifically Grounded**: The concepts of Lagrangians, Legendre transforms, and numerical discretization (specifically, the trapezoidal rule) are fundamental principles in classical mechanics and numerical analysis. The construction of the discrete Lagrangian and momenta follows established methods in variational integration.\n- **Well-Posed**: The problem is a direct calculation based on the provided definitions. It is fully specified and leads to a unique analytical solution.\n- **Objective**: The problem is stated using precise mathematical language and definitions, free of any subjective or ambiguous terminology.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is a well-defined mathematical derivation within the specified topic of discrete mechanics. The solution process will now proceed.\n\nThe task is to compute the expressions for the left and right discrete momenta, $p_{k}^{-}$ and $p_{k}^{+}$, and then use them to verify the given form of the centered discrete momentum, $p_{k}^{c}$.\n\nFirst, we compute the left discrete momentum $p_{k}^{-}$. By definition, $p_{k}^{-} = -D_{1} L_{d}(q_{k}, q_{k+1}; h)$. We must differentiate the discrete Lagrangian $L_{d}(q_{k}, q_{k+1}; h)$ with respect to its first argument, $q_{k}$. The discrete Lagrangian is\n$$\nL_{d}(q_{k}, q_{k+1}; h) = \\frac{1}{2h}(q_{k+1} - q_{k})^T M (q_{k+1} - q_{k}) - \\frac{h}{2}(V(q_{k}) + V(q_{k+1}))\n$$\nWe will differentiate each term with respect to $q_k$. For the kinetic term, let $u = q_{k+1} - q_{k}$. The term is $\\frac{1}{2h}u^T M u$. Using the rules of matrix calculus for a vector $x$ and a symmetric matrix $A$, the gradient $\\nabla_{x}(x^T A x)$ is $2Ax$. Applying the chain rule, the gradient with respect to $q_k$ is:\n$$\nD_{1} \\left( \\frac{1}{2h}(q_{k+1} - q_{k})^T M (q_{k+1} - q_{k}) \\right) = \\frac{1}{2h} \\cdot 2M(q_{k+1} - q_{k}) \\cdot \\frac{\\partial}{\\partial q_{k}}(q_{k+1} - q_{k}) = \\frac{1}{h} M(q_{k+1} - q_{k}) \\cdot (-I) = -\\frac{1}{h}M(q_{k+1} - q_{k})\n$$\nwhere $I$ is the identity matrix.\nFor the potential term, the derivative is straightforward:\n$$\nD_{1} \\left( -\\frac{h}{2}(V(q_{k}) + V(q_{k+1})) \\right) = -\\frac{h}{2} \\nabla V(q_{k})\n$$\nCombining these results gives the total derivative $D_{1} L_{d}$:\n$$\nD_{1} L_{d}(q_{k}, q_{k+1}; h) = -\\frac{1}{h}M(q_{k+1} - q_{k}) - \\frac{h}{2}\\nabla V(q_{k})\n$$\nThe left discrete momentum $p_{k}^{-}$ is the negative of this expression:\n$$\np_{k}^{-} = -D_{1} L_{d}(q_{k}, q_{k+1}; h) = \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k})\n$$\n\nNext, we compute the right discrete momentum $p_{k}^{+}$. By definition, $p_{k}^{+} = D_{2} L_{d}(q_{k-1}, q_{k}; h)$. First, we write down $L_{d}$ with its arguments shifted from $(q_k, q_{k+1})$ to $(q_{k-1}, q_{k})$:\n$$\nL_{d}(q_{k-1}, q_{k}; h) = \\frac{1}{2h}(q_{k} - q_{k-1})^T M (q_{k} - q_{k-1}) - \\frac{h}{2}(V(q_{k-1}) + V(q_{k}))\n$$\nNow, we differentiate this expression with respect to its second argument, $q_{k}$. For the kinetic term, let $v = q_{k} - q_{k-1}$. The derivative with respect to $q_k$ is:\n$$\nD_{2} \\left( \\frac{1}{2h}(q_{k} - q_{k-1})^T M (q_{k} - q_{k-1}) \\right) = \\frac{1}{2h} \\cdot 2M(q_{k} - q_{k-1}) \\cdot \\frac{\\partial}{\\partial q_{k}}(q_{k} - q_{k-1}) = \\frac{1}{h}M(q_{k} - q_{k-1}) \\cdot (I) = \\frac{1}{h}M(q_{k} - q_{k-1})\n$$\nFor the potential term, the derivative is:\n$$\nD_{2} \\left( -\\frac{h}{2}(V(q_{k-1}) + V(q_{k})) \\right) = -\\frac{h}{2}\\nabla V(q_{k})\n$$\nCombining these results gives the expression for $p_k^+$:\n$$\np_{k}^{+} = D_{2} L_{d}(q_{k-1}, q_{k}; h) = \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k})\n$$\nThese are the explicit expressions for $p_{k}^{-}$ and $p_{k}^{+}$.\n\nFinally, we show that the centered discrete momentum $p_{k}^{c}$ has the desired form. We use its definition $p_{k}^{c} = \\frac{1}{2}(p_{k}^{-} + p_{k}^{+})$ and substitute the expressions we found:\n$$\np_{k}^{c} = \\frac{1}{2} \\left[ \\left( \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k}) \\right) + \\left( \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k}) \\right) \\right]\n$$\nThe potential terms involving $\\nabla V(q_{k})$ cancel out:\n$$\np_{k}^{c} = \\frac{1}{2} \\left[ \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{1}{h}M(q_{k} - q_{k-1}) \\right]\n$$\nFactoring out the term $\\frac{1}{h}M$:\n$$\np_{k}^{c} = \\frac{1}{2h} M \\left[ (q_{k+1} - q_{k}) + (q_{k} - q_{k-1}) \\right]\n$$\nSimplifying the expression in the brackets yields:\n$$\np_{k}^{c} = \\frac{1}{2h} M (q_{k+1} - q_{k-1})\n$$\nThis confirms the expression given in the problem statement. The term $\\frac{q_{k+1} - q_{k-1}}{2h}$ is the second-order centered finite difference approximation to the velocity $\\dot{q}$ at time $t_{k}=kh$. Thus, $p_k^c$ is a discrete approximation to the continuous momentum $p(t_k) = M\\dot{q}(t_k)$.\n\nThe question asks for the final answer to be the pair $(p_{k}^{-},\\,p_{k}^{+})$.\n$p_{k}^{-} = \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k})$\n$p_{k}^{+} = \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k})$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{h}M(q_{k+1} - q_{k}) + \\frac{h}{2}\\nabla V(q_{k}) & \\frac{1}{h}M(q_{k} - q_{k-1}) - \\frac{h}{2}\\nabla V(q_{k}) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Having established how to define discrete momentum, we now investigate what determines the *quality* of a variational integrator. This problem  guides you through a theoretical analysis connecting the properties of an $s$-point Gauss-Legendre quadrature to the resulting integrator's high order of accuracy, $p=2s$. You will also explore how the symmetry of the numerical method leads to self-adjointness, a property that ensures the excellent long-term fidelity of the simulation's conserved quantities.",
            "id": "3739298",
            "problem": "Consider a finite-dimensional Lie group $G$ with Lie algebra $\\mathfrak{g}$ and a smooth, left-invariant Lagrangian $L: TG \\to \\mathbb{R}$. For a fixed time step $h>0$, define the exact discrete Lagrangian $L_{d}^{E}: G \\times G \\to \\mathbb{R}$ by the action integral evaluated along the unique solution of the Euler–Lagrange boundary-value problem connecting $(g_{0}, g_{1})$ in time $h$:\n$$\nL_{d}^{E}(g_{0}, g_{1}; h) := \\int_{0}^{h} L\\big(g(t), \\dot{g}(t)\\big) \\, dt,\n$$\nwhere $g(0)=g_{0}$ and $g(h)=g_{1}$. Construct a discrete Lagrangian $L_{d}: G \\times G \\to \\mathbb{R}$ by approximating the integral with an $s$-point Gauss–Legendre quadrature applied to a $G$-equivariant interpolation $c:[0,h]\\to G$ satisfying $c(0)=g_{0}$ and $c(h)=g_{1}$ and admitting a right-trivialized velocity of the form $\\dot{c}(t)=c(t)\\,\\xi(t)$ with $\\xi:[0,h]\\to\\mathfrak{g}$ smooth. Assume the interpolation is sufficiently accurate so that, as $h\\to 0$, the dominant error in $L_{d}$ relative to $L_{d}^{E}$ is dictated by the quadrature error.\n\nLet the discrete dynamics be given by the discrete Euler–Lagrange equations derived from $L_{d}$. Using only fundamental properties of Gauss–Legendre quadrature and the variational construction, determine the method’s order of accuracy $p$ as a function of the number of quadrature points $s$. Additionally, consider the discrete momentum maps associated with a left action of $G$ on itself: for any $\\xi\\in\\mathfrak{g}$, define\n$$\n\\langle J_{d}^{-}(g_{k}, g_{k+1}), \\xi \\rangle := - \\left\\langle D_{1} L_{d}(g_{k}, g_{k+1}), \\, \\xi_{G}(g_{k}) \\right\\rangle,\n\\qquad\n\\langle J_{d}^{+}(g_{k}, g_{k+1}), \\xi \\rangle := \\left\\langle D_{2} L_{d}(g_{k}, g_{k+1}), \\, \\xi_{G}(g_{k+1}) \\right\\rangle,\n$$\nwhere $\\xi_{G}(g)$ is the fundamental vector field generated by $\\xi$ and $D_{i}$ denotes the partial derivative with respect to the $i$-th argument. Explain, from first principles, how the symmetry of Gauss–Legendre nodes and weights influences conservation laws via the discrete version of Noether’s theorem and the self-adjointness of the discrete Lagrangian.\n\nYour final answer must be the single analytic expression for the order $p$ as a function of $s$. No numerical evaluation is required.",
            "solution": "The problem is first validated to be self-contained, scientifically grounded in the field of geometric mechanics, and well-posed. All premises and definitions are standard in the theory of variational integrators and Lie group methods. The problem is therefore deemed valid and a full solution is provided.\n\nThe problem contains two parts. The first is to determine the order of accuracy $p$ of the numerical method as a function of the number of Gauss-Legendre quadrature points $s$. The second is to explain the influence of the symmetry properties of Gauss-Legendre quadrature on the conservation laws of the discrete system.\n\n### Part 1: Order of Accuracy\n\nThe order of accuracy of a variational integrator is determined by how closely the approximate discrete Lagrangian, $L_d$, approximates the exact discrete Lagrangian, $L_d^E$. An integrator is said to be of order $p$ if the discrete Lagrangian is accurate to order $p+1$, meaning that for an exact solution curve $g(t)$ of the Euler-Lagrange equations, the difference between $L_d(g(t), g(t+h); h)$ and $L_d^E(g(t), g(t+h); h)$ is of order $h^{p+1}$.\n$$\nL_d(g_0, g_1; h) - L_d^E(g_0, g_1; h) = O(h^{p+1})\n$$\nwhere we denote $g_0 = g(t)$ and $g_1 = g(t+h)$.\n\nThe exact discrete Lagrangian is defined by the action integral along the true solution path:\n$$\nL_d^E(g_0, g_1; h) = \\int_0^h L(g(\\tau), \\dot{g}(\\tau)) d\\tau\n$$\nwhere $g(\\tau)$ is the solution of the continuous Euler-Lagrange equations with boundary conditions $g(0) = g_0$ and $g(h) = g_1$.\n\nThe approximate discrete Lagrangian $L_d$ is constructed by applying an $s$-point Gauss-Legendre quadrature to an integral of the same form, but evaluated along an interpolation curve $c(\\tau)$ which connects $g_0$ and $g_1$.\n$$\nL_d(g_0, g_1; h) = h \\sum_{i=1}^s b_i L(c(t_i), \\dot{c}(t_i))\n$$\nwhere $t_i = h c_i$ are the quadrature points, and $b_i$ and $c_i$ are the weights and nodes of the $s$-point Gauss-Legendre rule on the interval $[0,1]$.\n\nThe problem stipulates that the interpolation $c(\\tau)$ is \"sufficiently accurate\" such that the dominant error in $L_d$ as an approximation to $L_d^E$ is dictated by the quadrature error. This allows us to analyze the error by considering the application of the quadrature rule to the exact integrand, $f(\\tau) = L(g(\\tau), \\dot{g}(\\tau))$.\n\nA fundamental result from numerical analysis states that an $s$-point Gauss-Legendre quadrature rule has an order of accuracy of $2s$. This means that for any sufficiently smooth function $f(\\tau)$, the quadrature error is of order $2s+1$ in the step size $h$:\n$$\n\\int_0^h f(\\tau) d\\tau - h \\sum_{i=1}^s b_i f(h c_i) = C h^{2s+1} f^{(2s)}(\\xi) + O(h^{2s+2})\n$$\nfor some $\\xi \\in (0,h)$, where $C$ is a constant. The error is $O(h^{2s+1})$.\n\nApplying this to our Lagrangians, we have:\n$$\nL_d^E(g_0, g_1; h) = \\int_0^h L(g(\\tau), \\dot{g}(\\tau)) d\\tau\n$$\nThe approximate discrete Lagrangian, under the simplifying assumption, is effectively the quadrature applied to the exact integrand:\n$$\nL_d(g_0, g_1; h) \\approx h \\sum_{i=1}^s b_i L(g(t_i), \\dot{g}(t_i))\n$$\nTherefore, the error in the discrete Lagrangian is dictated by the quadrature error:\n$$\nL_d(g_0, g_1; h) - L_d^E(g_0, g_1; h) = O(h^{2s+1})\n$$\nBy the definition of the order of a variational integrator, we have $p+1 = 2s+1$. Solving for $p$ yields:\n$$\np = 2s\n$$\nThus, a variational integrator constructed from an $s$-point Gauss-Legendre quadrature rule is of order $2s$.\n\n### Part 2: Influence of Symmetry on Conservation Laws\n\nThe influence of Gauss-Legendre quadrature symmetry on conservation laws is profound and can be understood by breaking down the argument into the roles of group invariance and method-specific self-adjointness.\n\n1.  **Discrete Noether's Theorem and $G$-Invariance**\n\nThe continuous Lagrangian $L$ is given as left-invariant on the Lie group $G$. The approximate discrete Lagrangian $L_d$ is constructed using a $G$-equivariant interpolation. This construction ensures that $L_d$ inherits the left-invariance of $L$. That is, for any $a \\in G$:\n$$\nL_d(ag_k, ag_{k+1}) = L_d(g_k, g_{k+1})\n$$\nThe discrete dynamics are given by the discrete Euler-Lagrange (DEL) equations, obtained by finding stationary points of the discrete action sum $S_d = \\sum_k L_d(g_k, g_{k+1})$:\n$$\nD_2 L_d(g_{k-1}, g_k) + D_1 L_d(g_k, g_{k+1}) = 0\n$$\nThe left-invariance of $L_d$ leads to a discrete version of Noether's Theorem. Differentiating the invariance condition with respect to an infinitesimal group transformation generated by $\\xi \\in \\mathfrak{g}$ yields:\n$$\n\\langle D_1 L_d(g_k, g_{k+1}), \\xi_G(g_k) \\rangle + \\langle D_2 L_d(g_k, g_{k+1}), \\xi_G(g_{k+1}) \\rangle = 0\n$$\nUsing the definitions of the discrete momentum maps $J_d^-$ and $J_d^+$ provided:\n$$\n-\\langle J_d^-(g_k, g_{k+1}), \\xi \\rangle + \\langle J_d^+(g_k, g_{k+1}), \\xi \\rangle = 0 \\implies J_d^-(g_k, g_{k+1}) = J_d^+(g_k, g_{k+1})\n$$\nNow, pairing the DEL equation with the vector field $\\xi_G(g_k)$ at the point $g_k$:\n$$\n\\langle D_2 L_d(g_{k-1}, g_k), \\xi_G(g_k) \\rangle + \\langle D_1 L_d(g_k, g_{k+1}), \\xi_G(g_k) \\rangle = 0\n$$\nFrom the definitions, this becomes:\n$$\n\\langle J_d^+(g_{k-1}, g_k), \\xi \\rangle - \\langle J_d^-(g_k, g_{k+1}), \\xi \\rangle = 0\n$$\nSince this holds for all $\\xi \\in \\mathfrak{g}$, we obtain the momentum conservation law:\n$$\nJ_d^+(g_{k-1}, g_k) = J_d^-(g_k, g_{k+1})\n$$\nThis demonstrates that the discrete momentum map is exactly conserved along the numerical trajectory. This result stems from the $G$-invariance of $L_d$ and holds for any variational integrator built this way, regardless of the specific quadrature rule.\n\n2.  **Symmetry of Gauss-Legendre Quadrature and Self-Adjointness**\n\nThe question specifically asks about the role of the *symmetry* of Gauss-Legendre nodes and weights. For an $s$-point rule on $[0,1]$, this symmetry is expressed as:\n$$\nc_i + c_{s-i+1} = 1 \\quad \\text{and} \\quad b_i = b_{s-i+1} \\quad \\text{for } i=1, \\dots, s\n$$\nThis property of the quadrature rule is not necessary for the discrete Noether's theorem to hold, but it imparts a crucial additional property to the numerical method: it makes the method **self-adjoint** (or symmetric/time-reversible).\n\nA consequence of self-adjointness in variational integrators is the symmetry of the discrete Lagrangian itself. When the continuous Lagrangian $L$ is even in its velocity argument (as is true for natural mechanical systems, $L(g,v) = L(g,-v)$), the symmetry of the quadrature rule implies that the discrete Lagrangian is symmetric with respect to its arguments:\n$$\nL_d(g_1, g_0) = L_d(g_0, g_1)\n$$\nThis property, the \"self-adjointness of the discrete Lagrangian,\" reflects the time-reversibility of the numerical flow map. While the exact conservation of $J_d$ is guaranteed by $G$-invariance alone, the self-adjointness due to the Gauss-Legendre quadrature has two further, critical implications for the quality and interpretation of this conservation law:\n\n- **High Order of Accuracy**: As shown in Part 1, the properties of Gauss-Legendre quadrature yield a method of order $p=2s$. This is the highest possible order for an $s$-stage implicit Runge-Kutta method. This means that the conserved discrete momentum $J_d$ is not just any conserved quantity; it is a very high-order approximation of the true continuous momentum map $J$. The error between the numerical and true momentum at any given time step scales as $O(h^{2s})$.\n\n- **Modified Conserved Quantities and Backward Error Analysis**: The most profound consequence of self-adjointness is that the numerical flow generated by the integrator is the *exact* flow of a modified, nearby system. By backward error analysis, there exists a modified Lagrangian $L_{mod}$ (or Hamiltonian $H_{mod}$) which is a perturbation of the original one in even powers of the time step $h$:\n$$\nL_{mod} = L + O(h^{2s})\n$$\nThe numerical trajectory $\\{g_k\\}$ is the exact solution trajectory of the Euler-Lagrange equations for $L_{mod}$. Because the discretization scheme preserves the $G$-symmetry of the problem, this modified Lagrangian $L_{mod}$ is also $G$-invariant. Therefore, the modified system possesses its own exactly conserved continuous momentum map, $J_{mod}$, according to the continuous Noether's theorem. The discrete momentum map $J_d$ that is exactly conserved by the numerical method is a high-order discretization of this $J_{mod}$.\n\nIn summary, the symmetry of the Gauss-Legendre quadrature is not responsible for the *existence* of a conserved discrete momentum map (which comes from the variational principle and $G$-invariance), but it is responsible for the *quality* and *meaning* of that conservation. It ensures the method is self-adjoint, which leads to a high order of accuracy ($p=2s$) and, more deeply, guarantees that the numerical method is exactly preserving the momentum map of a nearby, symmetric physical system. This provides the theoretical foundation for the excellent long-term qualitative behavior and stability observed in simulations using these methods.",
            "answer": "$$\n\\boxed{p = 2s}\n$$"
        },
        {
            "introduction": "Theoretical exactness is a powerful guide, but its realization in practice is constrained by floating-point arithmetic. This final exercise provides a hands-on computational demonstration of this fact, exploring how an algebraically perfect symmetry can be broken numerically. By coding a simple integrator and comparing two equivalent formulas for the discrete Lagrangian $L_d$ , you will directly observe how roundoff error introduces an invariance defect, $\\Delta_g(k)$, that correlates with a drift in the otherwise conserved momentum, providing a powerful lesson on the interplay between geometric structure and numerical stability.",
            "id": "3739286",
            "problem": "Consider a configuration space $\\mathbb{R}^d$ with the translation group $G = \\mathbb{R}^d$ acting by $q \\mapsto q + a$ for any constant vector $a \\in \\mathbb{R}^d$. Let the continuous Lagrangian be $L(q,\\dot{q}) = \\frac{m}{2} \\|\\dot{q}\\|^2$, which is invariant under the action of $G$. The discrete Lagrangian for a time step $h > 0$ is defined by $L_d(q_k,q_{k+1};h)$ and gives a variational integrator by the discrete Euler–Lagrange equations $D_2 L_d(q_{k-1},q_k;h) + D_1 L_d(q_k,q_{k+1};h) = 0$. For a translation-invariant discrete Lagrangian, the discrete momentum map associated to the $G$-symmetry is preserved step-to-step by discrete Noether’s theorem, provided $L_d$ is exactly $G$-invariant.\n\nStarting from the fundamental definitions above, the task is to:\n- Derive the discrete momentum map for the free particle with discrete Lagrangian $L_d(q_k,q_{k+1};h) = \\frac{m}{2h}\\|q_{k+1}-q_k\\|^2$.\n- Design a numerical scheme to propagate the discrete dynamics and to monitor per-step drift in the discrete linear momentum due to roundoff.\n- Numerically relate the observed drift to violations of exact $G$-invariance in floating-point arithmetic by comparing two algebraically equivalent evaluations of $L_d$: \n  1) a difference form $L_d^{\\mathrm{diff}}(q_k,q_{k+1};h) = \\frac{m}{2h}\\|q_{k+1}-q_k\\|^2$; \n  2) an expanded dot-product form $L_d^{\\mathrm{exp}}(q_k,q_{k+1};h) = \\frac{m}{2h}\\left(\\|q_{k+1}\\|^2 + \\|q_k\\|^2 - 2\\,q_{k+1}\\cdot q_k\\right)$.\n\nImplement the following numerical scheme:\n1. Initialize $q_0 \\in \\mathbb{R}^d$ and $q_1 = q_0 + h v_0$ for a chosen initial velocity $v_0 \\in \\mathbb{R}^d$.\n2. Propagate $q_{k+1} = 2 q_k - q_{k-1}$ for $k = 1,2,\\dots,N-1$.\n3. At each step $k = 1,2,\\dots,N-1$, compute the discrete momentum $p_k = \\frac{m}{h}(q_k - q_{k-1})$ and the drift $\\|p_{k+1} - p_k\\|$.\n4. At each step, compute an invariance defect under a fixed translation $a \\in \\mathbb{R}^d$ by evaluating\n   $\\Delta^{\\mathrm{exp}}_k = \\left|L_d^{\\mathrm{exp}}(q_k+a,q_{k+1}+a;h) - L_d^{\\mathrm{exp}}(q_k,q_{k+1};h)\\right|$ and \n   $\\Delta^{\\mathrm{diff}}_k = \\left|L_d^{\\mathrm{diff}}(q_k+a,q_{k+1}+a;h) - L_d^{\\mathrm{diff}}(q_k,q_{k+1};h)\\right|$.\n5. Quantify the relationship between momentum drift and invariance defect by computing the Pearson correlation coefficient between the time series $\\{\\|p_{k+1}-p_k\\|\\}_{k=1}^{N-1}$ and $\\{\\Delta^{\\mathrm{exp}}_k\\}_{k=1}^{N-1}$. If either time series has zero variance, define the correlation to be $0.0$.\n\nYour program must implement this scheme and produce, for each test case, a list of four floats:\n- The maximum momentum drift $\\max_{1 \\le k \\le N-1} \\|p_{k+1}-p_k\\|$.\n- The maximum expanded-form invariance defect $\\max_{1 \\le k \\le N-1} \\Delta^{\\mathrm{exp}}_k$.\n- The maximum difference-form invariance defect $\\max_{1 \\le k \\le N-1} \\Delta^{\\mathrm{diff}}_k$.\n- The correlation coefficient between the momentum drift series and the expanded-form invariance defect series.\n\nNo physical units are required; all quantities must be treated as dimensionless numbers. Angles do not appear in this setup.\n\nTest Suite:\n- Case 1 (happy path): $d=3$, $m=1.0$, $h=10^{-3}$, $N=1000$, $a = (0,0,0)$, $q_0 = (0,0,0)$, $v_0 = (1,-1,0.5)$.\n- Case 2 (edge case: large offset and small step): $d=3$, $m=1.0$, $h=10^{-9}$, $N=2000$, $a = (10^{12},10^{12},10^{12})$, $q_0 = a$, $v_0 = (1,-1,0.5)$.\n- Case 3 (boundary case: very small step and large offset in two dimensions): $d=2$, $m=1.0$, $h=5\\cdot 10^{-12}$, $N=1500$, $a = (10^{15},10^{15})$, $q_0 = a$, $v_0 = (0.3,-0.7)$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of the four floats in the order specified above, for example, \n\"[[r_{1,1},r_{1,2},r_{1,3},r_{1,4}],[r_{2,1},r_{2,2},r_{2,3},r_{2,4}],[r_{3,1},r_{3,2},r_{3,3},r_{3,4}]]\".",
            "solution": "The problem is valid. It presents a well-posed and scientifically sound numerical experiment in the field of geometric mechanics, designed to investigate the numerical consequences of breaking a symmetry in a variational integrator. All required definitions, parameters, and procedures are specified without ambiguity or contradiction.\n\n### Introduction to the theoretical framework\n\nThe problem explores the connection between symmetry and conservation laws within the context of discrete variational mechanics. For a continuous mechanical system with a Lagrangian $L(q, \\dot{q})$ that is invariant under the action of a Lie group $G$, Noether's theorem guarantees the existence of a conserved quantity, known as the momentum map. Variational integrators are numerical methods derived by discretizing Hamilton's principle of stationary action. A key feature of these methods is that if the discrete Lagrangian $L_d(q_k, q_{k+1};h)$ inherits the symmetries of the continuous Lagrangian, the resulting numerical scheme will exactly preserve a corresponding discrete momentum map. This problem focuses on the translation group $G = (\\mathbb{R}^d, +)$ and a free particle, for which the conserved quantity is linear momentum. It then investigates how floating-point arithmetic can break the exact numerical symmetry, leading to a drift in the otherwise conserved momentum.\n\n### Part 1: Derivation of the Discrete Momentum Map\n\nThe discrete momentum map is derived from the discrete Lagrangian using the principles of discrete Noether's theorem.\n\n1.  **System and Symmetry**: The configuration space is $Q = \\mathbb{R}^d$. The system is a free particle with mass $m$, described by the discrete Lagrangian $L_d(q_k, q_{k+1}; h) = \\frac{m}{2h}\\|q_{k+1} - q_k\\|^2$, which is a discretization of the action integral for the continuous Lagrangian $L(q, \\dot{q}) = \\frac{m}{2}\\|\\dot{q}\\|^2$. The symmetry group is the translation group $G = \\mathbb{R}^d$, acting on $Q$ by $\\Phi_a(q) = q + a$ for any constant vector $a \\in \\mathbb{R}^d$.\n\n2.  **Invariance of the Discrete Lagrangian**: The discrete Lagrangian is exactly invariant under the group action:\n    $$L_d(\\Phi_a(q_k), \\Phi_a(q_{k+1}); h) = L_d(q_k + a, q_{k+1} + a; h) = \\frac{m}{2h} \\|(q_{k+1} + a) - (q_k + a)\\|^2 = \\frac{m}{2h} \\|q_{k+1} - q_k\\|^2 = L_d(q_k, q_{k+1}; h)$$\n    This exact invariance is the foundation for the discrete conservation law.\n\n3.  **Discrete Momentum Map**: According to discrete Noether's theorem, the conserved quantity is related to the partial derivatives of the discrete Lagrangian. The left and right discrete momenta are defined from the derivatives of $L_d$ with respect to its arguments. Let's compute these derivatives:\n    -   $D_1 L_d(q_k, q_{k+1}; h) = \\frac{\\partial L_d}{\\partial q_k} = \\frac{m}{h}(q_k - q_{k+1})$\n    -   $D_2 L_d(q_k, q_{k+1}; h) = \\frac{\\partial L_d}{\\partial q_{k+1}} = \\frac{m}{h}(q_{k+1} - q_k)$\n\n    The problem defines the discrete momentum at step $k$ as $p_k$. Following standard conventions in geometric integration, the momentum associated with the interval $(q_{k-1}, q_k)$ is given by $p_k = D_2 L_d(q_{k-1}, q_k; h)$ or $p_k = -D_1 L_d(q_{k-1}, q_k; h)$. Both definitions yield the same result:\n    $$p_k = D_2 L_d(q_{k-1}, q_k; h) = \\frac{m}{h}(q_k - q_{k-1})$$\n    This expression $p_k$ is the discrete analogue of the continuous linear momentum $p = m\\dot{q}$. This is the discrete momentum map for the system.\n\n4.  **Conservation Law**: The dynamics are governed by the discrete Euler-Lagrange (DEL) equations: $D_2 L_d(q_{k-1}, q_k; h) + D_1 L_d(q_k, q_{k+1}; h) = 0$. Substituting the derivatives:\n    $$\\frac{m}{h}(q_k - q_{k-1}) - \\frac{m}{h}(q_{k+1} - q_k) = 0$$\n    This simplifies to $p_k - p_{k+1} = 0$, or $p_{k+1} = p_k$. This confirms that the discrete momentum $p_k = \\frac{m}{h}(q_k - q_{k-1})$ is exactly conserved along the trajectory defined by the DEL equations. The DEL equation itself can be rearranged to give the integrator specified in the problem:\n    $$q_k - q_{k-1} = q_{k+1} - q_k \\implies q_{k+1} = 2q_k - q_{k-1}$$\n    This is the Störmer-Verlet method for a particle with zero acceleration, correctly representing free motion.\n\n### Part 2: Analysis of the Numerical Scheme\n\nThe problem requires a numerical simulation to explore the consequences of performing these calculations using finite-precision floating-point arithmetic.\n\n1.  **Momentum Drift**: In exact arithmetic, $\\|p_{k+1} - p_k\\| = 0$. However, the numerical computation of $q_{k+1} = 2q_k - q_{k-1}$ is subject to round-off error. When $q_k$ and $q_{k-1}$ are large vectors with small differences, their manipulation can lead to a loss of precision. This error in $q_{k+1}$ propagates, causing the computed $p_{k+1}$ to differ slightly from $p_k$. The quantity $\\|p_{k+1} - p_k\\|$ measures this numerical drift per step.\n\n2.  **Invariance Defect**: The problem introduces two algebraically equivalent forms of the discrete Lagrangian:\n    -   Difference form: $L_d^{\\mathrm{diff}}(q_k, q_{k+1}; h) = \\frac{m}{2h}\\|q_{k+1} - q_k\\|^2$\n    -   Expanded form: $L_d^{\\mathrm{exp}}(q_k, q_{k+1}; h) = \\frac{m}{2h}(\\|q_{k+1}\\|^2 + \\|q_k\\|^2 - 2q_{k+1} \\cdot q_k)$\n\n    The purpose is to show they behave differently under floating-point arithmetic. The invariance defect measures the failure of the numerical implementation to satisfy $L_d(q_k+a, q_{k+1}+a) = L_d(q_k, q_{k+1})$.\n\n    -   For $L_d^{\\mathrm{diff}}$, the defect $\\Delta^{\\mathrm{diff}}_k$ is calculated from $|L_d^{\\mathrm{diff}}(q_k+a, q_{k+1}+a) - L_d^{\\mathrm{diff}}(q_k, q_{k+1})|$. The core computation is $(q_{k+1}+a) - (q_k+a)$. If $q_k$ and $q_{k+1}$ are large and very close to each other, their difference is small. The subtraction $(q_{k+1}+a) - (q_k+a)$ is numerically stable, as it computes the difference of two nearby large numbers to produce a small number accurately. Therefore, we expect $\\Delta^{\\mathrm{diff}}_k$ to be close to machine precision.\n\n    -   For $L_d^{\\mathrm{exp}}$, the defect $\\Delta^{\\mathrm{exp}}_k$ relies on computing terms like $\\|q_k+a\\|^2 + \\|q_{k+1}\\|^2$ and subtracting them from similar terms. For instance, testing invariance involves calculating $\\|q_k+a\\|^2$ and $\\|q_k\\|^2$. If $q_k$ is a large vector (e.g., $q_k \\approx 10^{15}$ as in Case 3), then $\\|q_k+a\\|^2$ and $\\|q_k\\|^2$ are both enormous and very close to each other. Their subtraction, $\\|q_k+a\\|^2 - \\|q_k\\|^2$, is an example of **catastrophic cancellation**, where most significant digits are lost, leading to a large relative error. Consequently, the computed value of $L_d^{\\mathrm{exp}}(q_k+a, q_{k+1}+a)$ will differ significantly from $L_d^{\\mathrm{exp}}(q_k, q_{k+1})$, resulting in a large invariance defect $\\Delta^{\\mathrm{exp}}_k$.\n\n3.  **Correlation**: The central hypothesis to be tested is that the numerical drift in the conserved quantity (momentum) is directly caused by the numerical breaking of the associated symmetry (translation invariance). By computing the Pearson correlation coefficient between the time series of momentum drift, $\\{\\|p_{k+1}-p_k\\|\\}_{k=1}^{N-1}$, and the invariance defect time series, $\\{\\Delta^{\\mathrm{exp}}_k\\}_{k=1}^{N-1}$, we can quantitatively assess this relationship. A high positive correlation would provide strong numerical evidence for this fundamental principle of geometric integration, demonstrating that the failure to preserve symmetry leads to a failure to preserve the corresponding momentum map.\n\n### Implementation Strategy\n\nThe numerical simulation is implemented as follows:\n1.  Initialize system parameters ($m, h, d, N, a, q_0, v_0$) for each test case.\n2.  Set up an array `q` of size $(N+1) \\times d$ to store the trajectory. Initialize $q_0$ and $q_1 = q_0 + h v_0$.\n3.  Loop for $k$ from $1$ to $N-1$:\n    a. Compute $q_{k+1} = 2q_k - q_{k-1}$.\n    b. Compute the momenta $p_k = \\frac{m}{h}(q_k - q_{k-1})$ and $p_{k+1} = \\frac{m}{h}(q_{k+1} - q_k)$.\n    c. Calculate the momentum drift $\\|p_{k+1} - p_k\\|$ and store it in a results array.\n    d. Calculate the invariance defects $\\Delta_k^{\\mathrm{exp}}$ and $\\Delta_k^{\\mathrm{diff}}$ using the provided formulas and store them.\n4.  After the loop, compute the required summary statistics:\n    a. The maximum value of the momentum drift series.\n    b. The maximum value of the $\\Delta_k^{\\mathrm{exp}}$ series.\n    c. The maximum value of the $\\Delta_k^{\\mathrm{diff}}$ series.\n    d. The Pearson correlation coefficient between the momentum drift series and the $\\Delta_k^{\\mathrm{exp}}$ series. A check for zero variance is included, setting the correlation to $0.0$ in that case, as specified.\n5.  Format the four resulting floating-point numbers into the specified list format for each test case and print the final result.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the numerical experiment problem for discrete momentum maps and invariance.\n    \"\"\"\n    test_cases = [\n        # d, m, h, N, a, q0, v0\n        (3, 1.0, 1e-3, 1000, np.array([0.0, 0.0, 0.0]), np.array([0.0, 0.0, 0.0]), np.array([1.0, -1.0, 0.5])),\n        (3, 1.0, 1e-9, 2000, np.array([1e12, 1e12, 1e12]), np.array([1e12, 1e12, 1e12]), np.array([1.0, -1.0, 0.5])),\n        (2, 1.0, 5e-12, 1500, np.array([1e15, 1e15]), np.array([1e15, 1e15]), np.array([0.3, -0.7]))\n    ]\n\n    def L_diff(q_k, q_k_plus_1, m, h):\n        \"\"\"Computes the discrete Lagrangian using the difference form.\"\"\"\n        diff = q_k_plus_1 - q_k\n        return (m / (2.0 * h)) * np.dot(diff, diff)\n\n    def L_exp(q_k, q_k_plus_1, m, h):\n        \"\"\"Computes the discrete Lagrangian using the expanded form.\"\"\"\n        norm_q_k_sq = np.dot(q_k, q_k)\n        norm_q_k_plus_1_sq = np.dot(q_k_plus_1, q_k_plus_1)\n        dot_prod = np.dot(q_k_plus_1, q_k)\n        return (m / (2.0 * h)) * (norm_q_k_plus_1_sq + norm_q_k_sq - 2.0 * dot_prod)\n\n    final_results = []\n    \n    for d, m, h, N, a, q0, v0 in test_cases:\n        # Initialize trajectory array\n        q = np.zeros((N + 1, d), dtype=np.float64)\n        q[0] = q0\n        q[1] = q0 + h * v0\n\n        # Arrays to store time series data\n        momentum_drifts = np.zeros(N - 1, dtype=np.float64)\n        defects_exp = np.zeros(N - 1, dtype=np.float64)\n        defects_diff = np.zeros(N - 1, dtype=np.float64)\n\n        # Propagate dynamics and collect data\n        for k in range(1, N):\n            # Propagate position using Störmer-Verlet\n            q[k + 1] = 2.0 * q[k] - q[k - 1]\n\n            # The series are indexed from k=1..N-1 in the problem statement.\n            # Our loop runs k from 1 to N-1, so we store results at index k-1.\n            series_idx = k - 1\n            \n            # Compute momenta and drift\n            p_k = (m / h) * (q[k] - q[k - 1])\n            p_k_plus_1 = (m / h) * (q[k + 1] - q[k])\n            momentum_drifts[series_idx] = np.linalg.norm(p_k_plus_1 - p_k)\n            \n            # Current interval for Lagrangian evaluation\n            q_k = q[k]\n            q_k_plus_1 = q[k+1]\n\n            # Compute expanded-form invariance defect\n            l_exp_orig = L_exp(q_k, q_k_plus_1, m, h)\n            l_exp_trans = L_exp(q_k + a, q_k_plus_1 + a, m, h)\n            defects_exp[series_idx] = np.abs(l_exp_trans - l_exp_orig)\n            \n            # Compute difference-form invariance defect\n            l_diff_orig = L_diff(q_k, q_k_plus_1, m, h)\n            l_diff_trans = L_diff(q_k + a, q_k_plus_1 + a, m, h)\n            defects_diff[series_idx] = np.abs(l_diff_trans - l_diff_orig)\n\n        # Calculate summary statistics\n        max_drift = np.max(momentum_drifts)\n        max_defect_exp = np.max(defects_exp)\n        max_defect_diff = np.max(defects_diff)\n        \n        # Calculate Pearson correlation, handling the zero-variance case\n        std_drift = np.std(momentum_drifts)\n        std_defect_exp = np.std(defects_exp)\n        \n        correlation = 0.0\n        if std_drift > 0 and std_defect_exp > 0:\n            # np.corrcoef returns a 2x2 matrix\n            correlation_matrix = np.corrcoef(momentum_drifts, defects_exp)\n            correlation = correlation_matrix[0, 1]\n\n        final_results.append([max_drift, max_defect_exp, max_defect_diff, correlation])\n\n    # Format output as specified\n    formatted_cases = []\n    for case_result in final_results:\n        # Format each list of floats into \"[f1,f2,f3,f4]\"\n        s = f\"[{','.join(map(str, case_result))}]\"\n        formatted_cases.append(s)\n    \n    print(f\"[{','.join(formatted_cases)}]\")\n\nsolve()\n```"
        }
    ]
}