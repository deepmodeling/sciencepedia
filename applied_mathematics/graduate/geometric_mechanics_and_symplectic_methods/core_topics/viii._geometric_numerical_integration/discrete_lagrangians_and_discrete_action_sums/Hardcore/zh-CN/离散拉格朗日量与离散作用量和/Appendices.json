{
    "hands_on_practices": [
        {
            "introduction": "掌握变分积分器的第一步是从基本原理出发构建一个。本练习  将指导你完成对一个一维系统的作用量进行离散化的全过程，推导出离散欧拉-拉格朗日方程，并证明所得积分器最重要的特性：辛性。这个练习为后续更复杂的应用奠定了坚实的理论和实践基础。",
            "id": "3758398",
            "problem": "考虑一个机械系统，其位形流形为 $Q = \\mathbb{R}$，质量参数为 $m > 0$，光滑势函数为 $V: \\mathbb{R} \\rightarrow \\mathbb{R}$。其连续拉格朗日量为 $L(q,\\dot{q}) = \\tfrac{1}{2} m \\dot{q}^{2} - V(q)$。设 $t_{k}$ 表示离散时间点，固定步长为 $h > 0$，采样值为 $q_{k} \\in \\mathbb{R}$。从驻定作用量原理和离散作用量和的标准定义出发，在以下建模假设下，通过近似在 $[t_{k}, t_{k+1}]$ 上的作用量来构造一个离散拉格朗日量 $L_{d}(q_{k}, q_{k+1}, h)$：\n- 假设 $q(t)$ 是连接 $(t_{k}, q_{k})$ 和 $(t_{k+1}, q_{k+1})$ 的唯一线性插值。\n- 使用梯形法则近似在 $[t_{k}, t_{k+1}]$ 上的势能积分。\n定义离散作用量 $S_{d} = \\sum_{k=0}^{N-1} L_{d}(q_{k}, q_{k+1}, h)$，并通过要求 $S_{d}$ 对于固定端点的 $\\{q_{k}\\}_{k=1}^{N-1}$ 的变分是驻定的来推导离散欧拉-拉格朗日（DEL）方程。然后，引入离散勒让德变换 $p_{k}^{-} := - D_{1} L_{d}(q_{k}, q_{k+1}, h)$ 和 $p_{k}^{+} := D_{2} L_{d}(q_{k-1}, q_{k}, h)$，并施加动量匹配条件 $p_{k}^{-} = p_{k}^{+}$ 以获得单步更新映射 $(q_{k}, p_{k}) \\mapsto (q_{k+1}, p_{k+1})$。证明此映射是辛的，即它保持 $T^{*}\\mathbb{R}$ 上的典范辛形式不变。\n\n最后，将其特化到势函数为 $V(q) = \\tfrac{1}{2} k q^{2}$（其中 $k > 0$）的谐振子情况，并将所得的单步映射明确地写成用 $q_{k}$、$p_{k}$、$m$、$k$ 和 $h$ 表示的 $q_{k+1}$ 和 $p_{k+1}$ 的闭式表达式。您的最终答案必须是一个单一的解析表达式，由两个更新公式连接成一个行矩阵组成。不需要四舍五入，最终答案中不应包含任何单位。",
            "solution": "该问题陈述是几何力学领域中的一个有效练习，具体涉及变分积分器的构造。它在科学上植根于分析力学中的驻定作用量原理，并使用标准的数值近似技术。该问题是适定的，有一套清晰明确的指令，可导出一个唯一的解。所有术语都有正式定义，任务从一般原理逻辑地推进到具体应用。因此，我们开始求解。\n\n解决方案按问题陈述的要求分为四个部分：\n1.  构造离散拉格朗日量 $L_d$。\n2.  推导离散欧拉-拉格朗日（DEL）方程。\n3.  定义单步映射并证明其辛性。\n4.  特化到谐振子以求得显式映射。\n\n_第1部分：构造离散拉格朗日量_\n\n在时间区间 $[t_k, t_{k+1}]$ 上的连续作用量由拉格朗日量的积分给出：\n$$S_{k, k+1} = \\int_{t_k}^{t_{k+1}} L(q(t), \\dot{q}(t)) dt = \\int_{t_k}^{t_{k+1}} \\left( \\frac{1}{2} m \\dot{q}(t)^2 - V(q(t)) \\right) dt$$\n离散拉格朗日量 $L_d(q_k, q_{k+1}, h)$ 是该积分的一个近似。设 $h = t_{k+1} - t_k$。\n\n首先，我们处理动能项。问题假设 $q(t)$ 是 $(t_k, q_k)$ 和 $(t_{k+1}, q_{k+1})$ 之间的线性插值。因此，在区间 $[t_k, t_{k+1}]$ 上，速度 $\\dot{q}(t)$ 是恒定的：\n$$\\dot{q}(t) = \\frac{q_{k+1} - q_k}{t_{k+1} - t_k} = \\frac{q_{k+1} - q_k}{h}$$\n动能的积分是精确的：\n$$\\int_{t_k}^{t_{k+1}} \\frac{1}{2} m \\dot{q}^2 dt = \\frac{1}{2} m \\left(\\frac{q_{k+1} - q_k}{h}\\right)^2 \\int_{t_k}^{t_{k+1}} dt = \\frac{m}{2h^2} (q_{k+1} - q_k)^2 \\cdot h = \\frac{m}{2h} (q_{k+1} - q_k)^2$$\n\n接下来，我们处理势能项。按规定使用梯形法则对积分进行近似：\n$$\\int_{t_k}^{t_{k+1}} V(q(t)) dt \\approx \\frac{h}{2} (V(q(t_k)) + V(q(t_{k+1}))) = \\frac{h}{2} (V(q_k) + V(q_{k+1}))$$\n\n结合这两个结果，构造出离散拉格朗日量 $L_d(q_k, q_{k+1}, h)$：\n$$L_d(q_k, q_{k+1}, h) = \\frac{m}{2h} (q_{k+1} - q_k)^2 - \\frac{h}{2} (V(q_k) + V(q_{k+1}))$$\n\n_第2部分：推导离散欧拉-拉格朗日（DEL）方程_\n\n离散作用量 $S_d$ 是离散拉格朗日量在一个点序列 $\\{q_k\\}_{k=0}^N$ 上的总和：\n$$S_d = \\sum_{k=0}^{N-1} L_d(q_k, q_{k+1}, h)$$\n驻定作用量原理要求 $S_d$ 对任意内部点 $q_j$（其中 $j \\in \\{1, \\dots, N-1\\}$）的变分为零，同时保持端点 $q_0$ 和 $q_N$ 固定。点 $q_j$ 出现在求和中的两项：$L_d(q_{j-1}, q_j, h)$ 和 $L_d(q_j, q_{j+1}, h)$。\n驻定性条件为 $\\frac{\\partial S_d}{\\partial q_j} = 0$：\n$$\\frac{\\partial S_d}{\\partial q_j} = \\frac{\\partial}{\\partial q_j} \\left[ L_d(q_{j-1}, q_j, h) + L_d(q_j, q_{j+1}, h) \\right] = 0$$\n使用 $D_1$ 和 $D_2$ 分别表示对 $L_d$ 的第一个和第二个自变量的偏导数，上式变为：\n$$D_2 L_d(q_{j-1}, q_j, h) + D_1 L_d(q_j, q_{j+1}, h) = 0$$\n这就是离散欧拉-拉格朗日（DEL）方程的一般形式。\n\n_第3部分：辛单步映射_\n\n离散勒让德变换定义为：\n$$p_k^- := -D_1 L_d(q_k, q_{k+1}, h)$$\n$$p_k^+ := D_2 L_d(q_{k-1}, q_k, h)$$\n根据这些定义，DEL方程 $D_2 L_d(q_{k-1}, q_k, h) + D_1 L_d(q_k, q_{k+1}, h) = 0$ 等价于动量匹配条件 $p_k^+ = p_k^-$。\n\n单步更新映射 $\\Phi_h: (q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$ 是通过将动量 $p_k$ 等同于 $p_k^-$，然后将 $p_{k+1}$ 定义为 $p_{k+1}^+$ 来定义的。这导出了以下隐式定义该映射的方程组：\n$$p_k = -D_1 L_d(q_k, q_{k+1}, h)$$\n$$p_{k+1} = D_2 L_d(q_k, q_{k+1}, h)$$\n为证明此映射是辛的，我们必须证明它保持典范辛2-形式 $\\omega = dq \\wedge dp$ 不变。在我们的离散情景下，这意味着我们必须证明 $dq_{k+1} \\wedge dp_{k+1} = dq_k \\wedge dp_k$。\n\n我们将 $p_k$ 和 $p_{k+1}$ 视为独立坐标 $q_k$ 和 $q_{k+1}$ 的函数。对两个定义方程取外微分得到：\n$$dp_k = -\\frac{\\partial}{\\partial q_k}(D_1 L_d) dq_k - \\frac{\\partial}{\\partial q_{k+1}}(D_1 L_d) dq_{k+1} = -D_{11} L_d dq_k - D_{12} L_d dq_{k+1}$$\n$$dp_{k+1} = \\frac{\\partial}{\\partial q_k}(D_2 L_d) dq_k + \\frac{\\partial}{\\partial q_{k+1}}(D_2 L_d) dq_{k+1} = D_{21} L_d dq_k + D_{22} L_d dq_{k+1}$$\n现在我们计算楔积：\n$$dq_k \\wedge dp_k = dq_k \\wedge (-D_{11} L_d dq_k - D_{12} L_d dq_{k+1}) = -D_{12} L_d (dq_k \\wedge dq_{k+1})$$\n$$dq_{k+1} \\wedge dp_{k+1} = dq_{k+1} \\wedge (D_{21} L_d dq_k + D_{22} L_d dq_{k+1}) = D_{21} L_d (dq_{k+1} \\wedge dq_k) = -D_{21} L_d (dq_k \\wedge dq_{k+1})$$\n由于 $V$ 是光滑的，所以 $L_d$ 至少是其自变量的 $C^2$ 函数。根据关于混合偏导数相等的Clairaut定理，$D_{12} L_d = D_{21} L_d$。因此，我们证明了：\n$$dq_k \\wedge dp_k = dq_{k+1} \\wedge dp_{k+1}$$\n这证实了从任何这种形式的非退化离散拉格朗日量导出的单步映射都是辛的。需要非退化条件 $D_{12}L_d \\neq 0$ 来确保该映射是良定义的。对于我们的 $L_d$，$D_1 L_d(q_k, q_{k+1}, h) = -\\frac{m}{h}(q_{k+1}-q_k) - \\frac{h}{2}V'(q_k)$，所以 $D_{12}L_d = -\\frac{m}{h}$，由于 $m > 0$ 和 $h > 0$，它不为零。\n\n_第4部分：特化到谐振子_\n\n对于简谐振子，势函数为 $V(q) = \\frac{1}{2} k q^2$，其中 $k > 0$。其导数为 $V'(q) = kq$。\n具体的离散拉格朗日量为：\n$$L_d(q_k, q_{k+1}, h) = \\frac{m}{2h} (q_{k+1} - q_k)^2 - \\frac{h}{2} \\left(\\frac{1}{2}k q_k^2 + \\frac{1}{2}k q_{k+1}^2\\right) = \\frac{m}{2h}(q_{k+1} - q_k)^2 - \\frac{kh}{4}(q_k^2 + q_{k+1}^2)$$\n我们计算偏导数 $D_1L_d$ 和 $D_2L_d$：\n$$D_1 L_d = \\frac{m}{h}(q_k - q_{k+1}) - \\frac{kh}{2}q_k$$\n$$D_2 L_d = \\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{2}q_{k+1}$$\n单步映射由以下方程组定义：\n$$p_k = -D_1 L_d = \\frac{m}{h}(q_{k+1} - q_k) + \\frac{kh}{2}q_k$$\n$$p_{k+1} = D_2 L_d = \\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{2}q_{k+1}$$\n我们必须求解这个线性方程组，以得到 $q_{k+1}$ 和 $p_{k+1}$ 作为 $q_k$ 和 $p_k$ 的函数。\n从第一个方程，我们求解 $q_{k+1}$：\n$$p_k - q_k\\left(\\frac{kh}{2} - \\frac{m}{h}\\right) = \\frac{m}{h}q_{k+1}$$\n$$q_{k+1} = \\frac{h}{m} p_k - q_k\\left(\\frac{kh^2}{2m} - 1\\right) = q_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k$$\n这就是位置 $q_{k+1}$ 的更新规则。\n为了求得 $p_{k+1}$，我们可以用第一个方程减去第二个方程：\n$$p_k - p_{k+1} = \\left(\\frac{kh}{2}q_k\\right) - \\left(-\\frac{kh}{2}q_{k+1}\\right) = \\frac{kh}{2}(q_k + q_{k+1})$$\n$$p_{k+1} = p_k - \\frac{kh}{2}(q_k + q_{k+1})$$\n现在，我们代入求得的 $q_{k+1}$ 的表达式：\n$$p_{k+1} = p_k - \\frac{kh}{2}\\left[q_k + \\left(q_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k\\right)\\right]$$\n$$p_{k+1} = p_k - \\frac{kh}{2}\\left[q_k\\left(1 + 1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k\\right]$$\n$$p_{k+1} = p_k - \\frac{kh}{2}\\left[q_k\\left(2 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m} p_k\\right]$$\n$$p_{k+1} = p_k - q_k kh\\left(1 - \\frac{kh^2}{4m}\\right) - p_k \\frac{kh^2}{2m}$$\n$$p_{k+1} = p_k\\left(1 - \\frac{kh^2}{2m}\\right) - kh\\left(1 - \\frac{kh^2}{4m}\\right)q_k$$\n这就是动量 $p_{k+1}$ 的更新规则。\n\n所得的单步映射由以下两个表达式给出：\n$$q_{k+1} = q_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m}p_k$$\n$$p_{k+1} = p_k\\left(1 - \\frac{kh^2}{2m}\\right) - kh\\left(1 - \\frac{kh^2}{4m}\\right)q_k$$\n这些就是更新映射的闭式表达式。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nq_k\\left(1 - \\frac{kh^2}{2m}\\right) + \\frac{h}{m}p_k & p_k\\left(1 - \\frac{kh^2}{2m}\\right) - kh\\left(1 - \\frac{kh^2}{4m}\\right)q_k\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然所有变分积分器都具有辛性，但并非所有积分器都同样适用于长时间模拟。本练习  旨在探讨线性稳定性这一关键概念，通过对谐振子的两种不同离散拉格朗日量进行比较，你将通过分析更新映射的谱半径，学习到离散化方案的选择如何影响数值解的长期定性行为。",
            "id": "3739172",
            "problem": "考虑一个单自由度线性振子，其广义坐标为 $q \\in \\mathbb{R}$，质量为 $m > 0$（单位：千克），刚度为 $k > 0$（单位：牛顿/米）。其连续拉格朗日量定义为 $L(q,\\dot{q}) = T(q,\\dot{q}) - V(q)$，其中 $T(q,\\dot{q}) = \\frac{m}{2}\\dot{q}^{2}$ 且 $V(q) = \\frac{k}{2}q^{2}$。令 $\\omega = \\sqrt{k/m}$ 表示自然角频率，单位为弧度/秒。离散拉格朗日量 $L_{d}(q_{k},q_{k+1};h)$ 近似了时长为 $h$ 秒的时间步上的作用量积分，并通过离散作用量和的平稳性导出离散动力学。\n\n使用离散欧拉-拉格朗日（DEL）方程作为基本依据：对于一个序列 $\\{q_{k}\\}_{k=0}^{N}$ 和一个固定的时间步长 $h > 0$，离散作用量和 $\\sum_{k=0}^{N-1} L_{d}(q_{k},q_{k+1};h)$ 的驻点满足 DEL 方程\n$$\nD_{2}L_{d}(q_{k-1},q_{k};h) + D_{1}L_{d}(q_{k},q_{k+1};h) = 0 \\quad \\text{对所有 } k = 1,\\dots,N-1,\n$$\n其中 $D_{1}$ 和 $D_{2}$ 分别表示 $L_{d}$ 对其第一个和第二个参数的偏导数。\n\n在本问题中，对于由标准求积法则应用于作用量被积函数 $L(q,\\dot{q})$ 所构造的两种离散拉格朗日量，通过对 DEL 更新进行线性化来分析其稳定性，使用以下定义：\n\n1. 中点离散拉格朗日量：\n$$\nL_{d}^{\\mathrm{mid}}(q_{k},q_{k+1};h) \\equiv h\\,L\\!\\left(\\frac{q_{k}+q_{k+1}}{2},\\,\\frac{q_{k+1}-q_{k}}{h}\\right).\n$$\n\n2. 梯形离散拉格朗日量：\n$$\nL_{d}^{\\mathrm{trap}}(q_{k},q_{k+1};h) \\equiv \\frac{h}{2}\\left[L\\!\\left(q_{k},\\,\\frac{q_{k+1}-q_{k}}{h}\\right) + L\\!\\left(q_{k+1},\\,\\frac{q_{k+1}-q_{k}}{h}\\right)\\right].\n$$\n\n任务：\n\n- 从 DEL 方程和给定的 $L(q,\\dot{q})$ 出发，为每种离散拉格朗日量推导出一个形式为\n$$\nq_{k+1} = a\\,q_{k} + b\\,q_{k-1},\n$$\n的齐次线性两步递推关系，其系数 $a$ 和 $b$ 依赖于 $m$、$k$ 和 $h$。\n\n- 将每个递推关系重写为作用于二维状态向量 $(q_{k},q_{k-1})^{\\top}$ 的一阶线性更新：\n$$\n\\begin{pmatrix} q_{k+1} \\\\ q_{k} \\end{pmatrix} = A \\begin{pmatrix} q_{k} \\\\ q_{k-1} \\end{pmatrix},\n$$\n并为每个离散拉格朗日量求出相应的 $2\\times 2$ 更新矩阵 $A$。\n\n- 对于每个更新矩阵 $A$，计算其特征值和谱半径 $\\rho(A)$。谱半径定义为特征值绝对值的最大值。谱半径是无量纲的。\n\n- 定义线性稳定性的二元分类如下。当且仅当以下两个条件都成立时，称更新是线性稳定的：\n  1. 谱半径满足 $\\rho(A) \\le 1$。\n  2. 如果存在重根特征值（代数重数大于一），则更新矩阵必须是可对角化的（即，不存在非平凡的若尔当块）。\n\n实现一个程序，对下面指定的每个测试用例，计算：\n- 中点离散拉格朗日量更新的谱半径。\n- 梯形离散拉格朗日量更新的谱半径。\n- 中点更新的布尔线性稳定性分类。\n- 梯形更新的布尔线性稳定性分类。\n\n使用以下测试套件，参数以国际单位制（SI 单位）表示：质量 $m$ 单位为千克（kg），刚度 $k$ 单位为牛顿/米（N/m），时间步长 $h$ 单位为秒（s）。谱半径是无量纲的。对于所有计算，假定使用实数算术，并具有足够的精度以一致地区分稳定性分类。\n\n测试用例：\n- 用例 1: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,4.0\\,\\mathrm{N/m},\\,0.2\\,\\mathrm{s})$。\n- 用例 2: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,4.0\\,\\mathrm{N/m},\\,1.0\\,\\mathrm{s})$。\n- 用例 3: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,4.0\\,\\mathrm{N/m},\\,1.1\\,\\mathrm{s})$。\n- 用例 4: $(m,k,h) = (3.0\\,\\mathrm{kg},\\,3.0\\,\\mathrm{N/m},\\,1.8\\,\\mathrm{s})$。\n- 用例 5: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,1.0\\,\\mathrm{N/m},\\,1.0\\times 10^{-6}\\,\\mathrm{s})$。\n- 用例 6: $(m,k,h) = (1.0\\,\\mathrm{kg},\\,100.0\\,\\mathrm{N/m},\\,0.19\\,\\mathrm{s})$。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。对于每个用例，按以下顺序输出四个值：中点谱半径、梯形谱半径、中点稳定性布尔值、梯形稳定性布尔值。所有谱半径表示为保留六位小数的浮点数。因此，最终输出聚合了二十四个条目，对应六个测试用例，格式为单行：\n$$\n[\\rho_{\\mathrm{mid},1},\\rho_{\\mathrm{trap},1},s_{\\mathrm{mid},1},s_{\\mathrm{trap},1},\\dots,\\rho_{\\mathrm{mid},6},\\rho_{\\mathrm{trap},6},s_{\\mathrm{mid},6},s_{\\mathrm{trap},6}],\n$$\n其中每个 $\\rho_{\\cdot}$ 是一个小数点后有六位数（无量纲）的浮点数，每个 $s_{\\cdot}$ 是一个布尔值。",
            "solution": "该问题陈述经评估有效。它在几何数值积分领域具有科学依据，特别是关于哈密顿系统的变分积分子。该问题是适定的，为获得唯一解提供了所有必要的定义、常数和条件。语言客观而精确。任务是可数学形式化的，并与离散拉格朗日量的主题直接相关。不存在矛盾、歧义或事实错误。\n\n求解过程首先分析中点法则，然后分析梯形法则。对每种法则，我们推导离散欧拉-拉格朗日方程，得到线性递推关系，构建状态空间更新矩阵，并分析其谱性质以确定谱半径和线性稳定性。\n\n单自由度线性振子的连续拉格朗日量由下式给出\n$$\nL(q, \\dot{q}) = T(\\dot{q}) - V(q) = \\frac{1}{2}m\\dot{q}^2 - \\frac{1}{2}kq^2\n$$\n其中 $m > 0$ 是质量，$k > 0$ 是刚度。自然角频率为 $\\omega = \\sqrt{k/m}$。离散系统 $\\{q_k\\}_{k=0}^N$ 的动力学由离散欧拉-拉格朗日（DEL）方程决定：\n$$\nD_2 L_d(q_{k-1}, q_k; h) + D_1 L_d(q_k, q_{k+1}; h) = 0\n$$\n其中 $D_i$ 是对第 $i$ 个参数的偏导数。\n\n### 中点离散拉格朗日量分析\n\n中点离散拉格朗日量定义为\n$$\nL_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) \\equiv h L\\left(\\frac{q_k + q_{k+1}}{2}, \\frac{q_{k+1} - q_k}{h}\\right)\n$$\n代入连续拉格朗日量 $L$ 可得\n$$\nL_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) = h \\left[ \\frac{m}{2}\\left(\\frac{q_{k+1} - q_k}{h}\\right)^2 - \\frac{k}{2}\\left(\\frac{q_k + q_{k+1}}{2}\\right)^2 \\right] = \\frac{m}{2h}(q_{k+1} - q_k)^2 - \\frac{kh}{8}(q_k + q_{k+1})^2\n$$\n为了构建 DEL 方程，我们计算偏导数：\n$$\nD_1 L_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) = \\frac{\\partial L_{d}^{\\mathrm{mid}}}{\\partial q_k} = \\frac{m}{h}(q_{k+1} - q_k)(-1) - \\frac{kh}{8} \\cdot 2(q_k + q_{k+1}) = -\\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{4}(q_k + q_{k+1})\n$$\n$$\nD_2 L_{d}^{\\mathrm{mid}}(q_{k-1}, q_k; h) = \\frac{\\partial L_{d}^{\\mathrm{mid}}(q_{k-1}, q_k; h)}{\\partial q_k} = \\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{8} \\cdot 2(q_{k-1} + q_k) = \\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{4}(q_{k-1} + q_k)\n$$\n将这些代入 DEL 方程 $D_2 L_{d}^{\\mathrm{mid}}(q_{k-1}, q_k; h) + D_1 L_{d}^{\\mathrm{mid}}(q_k, q_{k+1}; h) = 0$：\n$$\n\\left(\\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{4}(q_{k-1} + q_k)\\right) + \\left(-\\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{4}(q_k + q_{k+1})\\right) = 0\n$$\n按 $q_{k+1}$、$q_k$ 和 $q_{k-1}$ 对各项进行分组：\n$$\nq_{k+1}\\left(-\\frac{m}{h} - \\frac{kh}{4}\\right) + q_k\\left(\\frac{2m}{h} - \\frac{kh}{2}\\right) + q_{k-1}\\left(-\\frac{m}{h} - \\frac{kh}{4}\\right) = 0\n$$\n乘以 $-1$ 并代入 $\\omega^2 = k/m$：\n$$\nq_{k+1}\\left(\\frac{m}{h} + \\frac{m\\omega^2 h}{4}\\right) - q_k\\left(\\frac{2m}{h} - \\frac{m\\omega^2 h}{2}\\right) + q_{k-1}\\left(\\frac{m}{h} + \\frac{m\\omega^2 h}{4}\\right) = 0\n$$\n除以 $m/h$：\n$$\nq_{k+1}\\left(1 + \\frac{\\omega^2 h^2}{4}\\right) - q_k\\left(2 - \\frac{\\omega^2 h^2}{2}\\right) + q_{k-1}\\left(1 + \\frac{\\omega^2 h^2}{4}\\right) = 0\n$$\n递推关系为 $q_{k+1} = a_{\\mathrm{mid}} q_k + b_{\\mathrm{mid}} q_{k-1}$，其中\n$$\na_{\\mathrm{mid}} = \\frac{2 - \\frac{1}{2}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2} = \\frac{8 - 2\\omega^2 h^2}{4 + \\omega^2 h^2}, \\quad b_{\\mathrm{mid}} = -1\n$$\n状态向量 $(q_k, q_{k-1})^\\top$ 的更新矩阵 $A_{\\mathrm{mid}}$ 为\n$$\nA_{\\mathrm{mid}} = \\begin{pmatrix} a_{\\mathrm{mid}}  -1 \\\\ 1  0 \\end{pmatrix}\n$$\n特征方程为 $\\det(A_{\\mathrm{mid}} - \\lambda I) = \\lambda^2 - a_{\\mathrm{mid}}\\lambda + 1 = 0$。特征值的乘积为 $1$。如果判别式 $a_{\\mathrm{mid}}^2 - 4  < 0$（等价于 $|a_{\\mathrm{mid}}|  < 2$），则特征值为共轭复数。令 $x = \\omega^2 h^2 > 0$。则 $a_{\\mathrm{mid}} = (8-2x)/(4+x)$。条件 $|a_{\\mathrm{mid}}|  < 2$ 变为 $|\\frac{8-2x}{4+x}|  < 2$，可简化为 $-2(4+x)  < 8-2x  < 2(4+x)$。左边不等式 $-8-2x  < 8-2x$ 意味着 $-8  < 8$，恒成立。右边不等式 $8-2x  < 8+2x$ 意味着 $0  < 4x$，对于 $x > 0$ 成立。因此，对于所有物理参数 $m,k,h > 0$，$|a_{\\mathrm{mid}}|  < 2$。\n因此，特征值为单位圆上不同的共轭复数。这意味着谱半径为 $\\rho(A_{\\mathrm{mid}}) = 1$。由于 $\\rho(A_{\\mathrm{mid}}) \\le 1$ 且特征值永不重复，两个稳定性条件均得到满足。中点法是无条件线性稳定的。\n\n### 梯形离散拉格朗日量分析\n\n梯形离散拉格朗日量定义为\n$$\nL_{d}^{\\mathrm{trap}}(q_k, q_{k+1}; h) \\equiv \\frac{h}{2}\\left[L\\left(q_k, \\frac{q_{k+1}-q_k}{h}\\right) + L\\left(q_{k+1}, \\frac{q_{k+1}-q_k}{h}\\right)\\right]\n$$\n代入连续拉格朗日量 $L$ 可得\n$$\nL_d^{\\mathrm{trap}} = \\frac{h}{2}\\left[\\left(\\frac{m}{2}(\\frac{q_{k+1}-q_k}{h})^2 - \\frac{k}{2}q_k^2\\right) + \\left(\\frac{m}{2}(\\frac{q_{k+1}-q_k}{h})^2 - \\frac{k}{2}q_{k+1}^2\\right)\\right] = \\frac{m}{2h}(q_{k+1}-q_k)^2 - \\frac{kh}{4}(q_k^2+q_{k+1}^2)\n$$\n用于 DEL 方程的偏导数为：\n$$\nD_1 L_{d}^{\\mathrm{trap}}(q_k, q_{k+1}; h) = -\\frac{m}{h}(q_{k+1}-q_k) - \\frac{kh}{2}q_k\n$$\n$$\nD_2 L_{d}^{\\mathrm{trap}}(q_{k-1}, q_k; h) = \\frac{m}{h}(q_k-q_{k-1}) - \\frac{kh}{2}q_k\n$$\n代入 DEL 方程：\n$$\n\\left(\\frac{m}{h}(q_k - q_{k-1}) - \\frac{kh}{2}q_k\\right) + \\left(-\\frac{m}{h}(q_{k+1} - q_k) - \\frac{kh}{2}q_k\\right) = 0\n$$\n整理各项：\n$$\n-\\frac{m}{h}q_{k+1} + \\left(\\frac{2m}{h} - kh\\right)q_k - \\frac{m}{h}q_{k-1} = 0\n$$\n乘以 $-h/m$ 并代入 $\\omega^2=k/m$：\n$$\nq_{k+1} - (2 - \\omega^2 h^2)q_k + q_{k-1} = 0\n$$\n递推关系为 $q_{k+1} = a_{\\mathrm{trap}} q_k + b_{\\mathrm{trap}} q_{k-1}$，其中\n$$\na_{\\mathrm{trap}} = 2 - \\omega^2 h^2, \\quad b_{\\mathrm{trap}} = -1\n$$\n更新矩阵 $A_{\\mathrm{trap}}$ 为\n$$\nA_{\\mathrm{trap}} = \\begin{pmatrix} a_{\\mathrm{trap}}  -1 \\\\ 1  0 \\end{pmatrix}\n$$\n特征方程为 $\\lambda^2 - a_{\\mathrm{trap}}\\lambda + 1 = 0$。当且仅当特征值为实数且不为 1 时，谱半径 $\\rho(A_{\\mathrm{trap}}) > 1$，这发生在 $|a_{\\mathrm{trap}}| > 2$ 时。\n令 $x = \\omega h$。条件变为 $|2-x^2| > 2$。如果 $2-x^2 > 2 \\implies -x^2 > 0$（对于实数 $x$ 不可能），或者如果 $2-x^2  < -2 \\implies 4  < x^2 \\implies x > 2$（因为 $x>0$），则此条件成立。\n所以，如果 $\\omega h > 2$，系统不稳定，且 $\\rho(A_{\\mathrm{trap}}) > 1$。\n如果 $\\omega h  < 2$，则 $|a_{\\mathrm{trap}}|  < 2$，特征值位于单位圆上，且 $\\rho(A_{\\mathrm{trap}}) = 1$。该方法是线性稳定的。\n如果 $\\omega h = 2$，则 $a_{\\mathrm{trap}} = 2 - 2^2 = -2$。特征方程变为 $\\lambda^2 + 2\\lambda + 1 = (\\lambda+1)^2 = 0$，得到一个重根特征值 $\\lambda = -1$。谱半径为 $\\rho(A_{\\mathrm{trap}}) = 1$。更新矩阵为 $A_{\\mathrm{trap}} = \\begin{pmatrix} -2  -1 \\\\ 1  0 \\end{pmatrix}$。这不是单位矩阵的标量倍数。因此，根据问题的第二个稳定性条件，当 $\\omega h = 2$ 时，该方法不是线性稳定的。\n\n用于实现的结果摘要：\n- **中点法**：对于所有 $m, k, h > 0$，$\\rho_{\\mathrm{mid}} = 1$ 且稳定。\n- **梯形法**：令 $x = \\omega h = h\\sqrt{k/m}$。\n  - 如果 $x  < 2$：$\\rho_{\\mathrm{trap}} = 1$ 且方法稳定。\n  - 如果 $x = 2$：$\\rho_{\\mathrm{trap}} = 1$ 但方法不稳定。\n  - 如果 $x > 2$：$\\rho_{\\mathrm{trap}} = \\frac{|2-x^2| + \\sqrt{(2-x^2)^2-4}}{2} > 1$ 且方法不稳定。\n\n现在将这些公式应用于测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spectral radius and stability for midpoint and trapezoidal\n    discrete Lagrangian methods for a linear oscillator.\n    \"\"\"\n    test_cases = [\n        # Case 1: (m, k, h) = (1.0 kg, 4.0 N/m, 0.2 s)\n        (1.0, 4.0, 0.2),\n        # Case 2: (m, k, h) = (1.0 kg, 4.0 N/m, 1.0 s)\n        (1.0, 4.0, 1.0),\n        # Case 3: (m, k, h) = (1.0 kg, 4.0 N/m, 1.1 s)\n        (1.0, 4.0, 1.1),\n        # Case 4: (m, k, h) = (3.0 kg, 3.0 N/m, 1.8 s)\n        (3.0, 3.0, 1.8),\n        # Case 5: (m, k, h) = (1.0 kg, 1.0 N/m, 1.0e-6 s)\n        (1.0, 1.0, 1.0e-6),\n        # Case 6: (m, k, h) = (1.0 kg, 100.0 N/m, 0.19 s)\n        (1.0, 100.0, 0.19)\n    ]\n\n    results = []\n    \n    # Use a small tolerance for floating point comparisons\n    TOL = 1e-9\n\n    for m, k, h in test_cases:\n        # --- Midpoint Method Analysis ---\n        # The spectral radius for the midpoint method is always 1,\n        # and it is unconditionally stable for m, k, h > 0.\n        rho_mid = 1.0\n        stable_mid = True\n\n        # --- Trapezoidal Method Analysis ---\n        omega = np.sqrt(k / m)\n        x = omega * h\n        \n        rho_trap = 0.0\n        stable_trap = False\n\n        if x  2.0 - TOL:\n            # Conditionally stable region\n            rho_trap = 1.0\n            stable_trap = True\n        elif abs(x - 2.0) = TOL:\n            # Boundary of stability: repeated eigenvalues, non-diagonalizable matrix\n            rho_trap = 1.0\n            stable_trap = False\n        else: # x > 2.0 + TOL\n            # Unstable region\n            a_trap = 2.0 - x**2\n            # a_trap will be  -2\n            # rho = (|a| + sqrt(a^2 - 4)) / 2\n            rho_trap = (abs(a_trap) + np.sqrt(a_trap**2 - 4.0)) / 2.0\n            stable_trap = False\n\n        results.extend([\n            f\"{rho_mid:.6f}\",\n            f\"{rho_trap:.6f}\",\n            str(stable_mid),\n            str(stable_trap)\n        ])\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "变分原理的威力远不止于简单的欧几里得空间，它可以优雅地推广到复杂的几何流形上。本练习  将作用量最小化原理应用于一个经典的几何问题：寻找球面上两点之间的最短路径（即测地线）。这个计算问题展示了如何构建并求解一个约束变分问题，从而将抽象的理论与在流形上的实际编程实现联系起来。",
            "id": "3739622",
            "problem": "考虑一个黎曼流形，具体为嵌入在三维欧几里得空间 $\\mathbb{S}^2 \\subset \\mathbb{R}^3$ 中的单位二球面，其度量由环境欧几里得度量诱导。设动能拉格朗日量为 $L(q,\\dot{q})=\\tfrac{1}{2}\\|\\dot{q}\\|^2$，其中 $q \\in \\mathbb{S}^2$ 且 $\\dot{q}$ 在点 $q$ 处与 $\\mathbb{S}^2$ 相切。离散变分原理旨在寻找一个点序列 $\\{q_0,q_1,\\dots,q_N\\} \\subset \\mathbb{S}^2$，其端点 $q_0$ 和 $q_N$ 固定，该序列能够最小化与离散拉格朗日量 $L_d$ 相关联的离散作用量。$L_d$ 是在每个时间步长上对 $L$ 的作用量积分的近似。您将使用变分积分器的视角，在完整约束 $\\|q_k\\|^2=1$（对所有 $k$）下，通过最小化离散作用量来构造离散测地线。\n\n从上述定义和离散作用量的概念出发，实现一个程序。对于下面指定的每个测试用例，该程序通过最小化离散作用量来计算连接给定端点的离散测地线序列 $\\{q_k\\}_{k=0}^N$\n$$\nS_d(\\{q_k\\}) \\equiv \\sum_{k=0}^{N-1} L_d(q_k,q_{k+1};h),\n$$\n并选择离散拉格朗日量为\n$$\nL_d(q_k,q_{k+1};h) \\equiv \\frac{1}{2h}\\|q_{k+1}-q_k\\|^2,\n$$\n其中 $h0$ 是均匀时间步长。通过引入一种与变分积分器方法论一致的约束处理策略，在所有内部节点上强制执行球面约束 $\\|q_k\\|^2=1$。使用一种在离散变分观点下有理论依据的算法方法，并通过最小化受 $\\mathbb{S}^2$ 上完整约束的离散作用量，数值求解连接 $q_0$ 到 $q_N$ 的两点边值问题。所有角度必须以弧度为单位。\n\n您的程序必须为每个测试用例构造离散测地线，然后计算该用例指定的一个标量诊断值。最终程序输出必须是单行文本，其中包含一个用方括号括起来的、以逗号分隔的诊断值列表，顺序与下面的测试套件完全一致。\n\n使用以下测试套件：\n- 测试用例 1（一般情况）：$q_0=(0,0,1)$，$q_N=(\\sin\\theta,0,\\cos\\theta)$，其中 $\\theta=0.6$ 弧度，$N=20$。设 $h=\\tfrac{1}{N}$。计算沿离散路径的总球面弧长，\n$$\n\\ell_{\\mathrm{disc}} \\equiv \\sum_{k=0}^{N-1} \\arccos\\big(\\max(-1,\\min(1,\\,q_k\\cdot q_{k+1}))\\big),\n$$\n并返回其与真实最短球面距离 $\\ell_{\\mathrm{true}}=\\arccos(q_0\\cdot q_N)=\\theta$ 的绝对差，即输出浮点数 $|\\ell_{\\mathrm{disc}}-\\ell_{\\mathrm{true}}|$。\n- 测试用例 2（边界条件情况）：$q_0=(0,0,1)$，$q_N=(0,0,1)$，$N=10$。设 $h=\\tfrac{1}{N}$。计算沿离散路径的连续节点之间的最大球面弧长，\n$$\n\\max_{0\\le k \\le N-1} \\arccos\\big(\\max(-1,\\min(1,\\,q_k\\cdot q_{k+1}))\\big),\n$$\n并返回此浮点数。\n- 测试用例 3（近对跖点边缘情况）：$q_0=(0,0,1)$，$q_N=(\\sin\\phi,0,\\cos\\phi)$，其中 $\\phi=\\pi-0.01$ 弧度，$N=50$。设 $h=\\tfrac{1}{N}$。通过寻找一个单位法向量 $n\\in\\mathbb{R}^3$ 来最小化偏差平方和 $\\sum_{k=0}^N (n\\cdot q_k)^2$，从而将一个通过原点的最佳拟合平面拟合到计算出的离散路径上。计算均方根平面度偏差\n$$\n\\sqrt{\\frac{1}{N+1}\\sum_{k=0}^N (n\\cdot q_k)^2},\n$$\n并返回此浮点数。\n\n所有角度必须以弧度为单位。您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表（例如，“[result1,result2,result3]”）。每个测试用例的结果必须是浮点数。您实现的方法必须基于上述离散变分力学框架，从动能拉格朗日量和一致的离散作用量出发，并且必须通过在整个路径构建过程中强制执行球面约束来确保科学真实性和数值合理性。",
            "solution": "该问题要求通过最小化离散作用量来计算单位二球面 $\\mathbb{S}^2$ 上的离散测地线。此任务植根于离散变分力学的原理，这是几何力学的一个子领域，旨在在数值模拟中保持力学系统的几何与结构特性。\n\n其理论基础是最小作用量原理。对于黎曼流形上的自由粒子，测地线是使该作用量最小化的曲线，其动能拉格朗日量为 $L(q, \\dot{q}) = \\frac{1}{2} m \\|\\dot{q}\\|^2$。这里，我们考虑球体 $\\mathbb{S}^2$ 上单位质量 $m=1$ 的情况，因此 $L(q, \\dot{q}) = \\frac{1}{2}\\|\\dot{q}\\|^2$，其中范数是由 $\\mathbb{R}^3$ 的环境欧几里得度量诱导的。\n\n离散变分力学用离散点序列 $\\{q_k\\}_{k=0}^N$ 替代连续路径 $q(t)$，其中 $q_k \\approx q(t_k)$ 且对于固定的时间步长 $h$ 有 $t_k = kh$。作用量积分 $S$ 由一个离散和式，即离散作用量 $S_d$ 来近似：\n$$\nS[q(t)] = \\int_0^{Nh} L(q(t), \\dot{q}(t)) dt \\approx S_d(\\{q_k\\}) = \\sum_{k=0}^{N-1} L_d(q_k, q_{k+1}; h)\n$$\n此处，$L_d(q_k, q_{k+1}; h)$ 是一个离散拉格朗日量，它近似了连续拉格朗日量在单个时间步长上的积分，即 $L_d(q_k, q_{k+1}; h) \\approx \\int_{kh}^{(k+1)h} L dt$。如问题中所给出的，一个简单而常见的选择是基于 $\\dot{q}$ 的有限差分近似：\n$$\nL_d(q_k, q_{k+1}; h) \\equiv \\frac{1}{2h}\\|q_{k+1}-q_k\\|^2\n$$\n这与 $h \\cdot L\\left(q, (q_{k+1}-q_k)/h\\right)$ 成正比，是一个有效的一阶近似。\n\n离散测地线是在给定约束条件下使 $S_d$ 取极值的序列 $\\{q_k\\}$。端点 $q_0$ 和 $q_N$ 是固定的。内部点 $\\{q_k\\}_{k=1}^{N-1}$ 必须位于球面上，这施加了完整约束：\n$$\ng_k(q_k) = \\|q_k\\|^2 - 1 = 0 \\quad \\text{for } k=1, \\dots, N-1\n$$\n因此，问题被转化为一个约束优化问题：\n$$\n\\min_{q_1, \\dots, q_{N-1}} S_d(\\{q_k\\}) \\quad \\text{subject to} \\quad \\|q_k\\|^2 = 1 \\text{ for } k=1, \\dots, N-1\n$$\n我们来分析目标函数。我们希望最小化 $S_d = \\sum_{k=0}^{N-1} \\frac{1}{2h}\\|q_{k+1}-q_k\\|^2$。由于 $h$ 是一个正常数，这等价于最小化 $\\sum_{k=0}^{N-1}\\|q_{k+1}-q_k\\|^2$。展开范数并对所有 $k$（包括给定的位于球面上的端点）应用约束 $\\|q_k\\|^2=1$，可得：\n$$\n\\sum_{k=0}^{N-1}\\|q_{k+1}-q_k\\|^2 = \\sum_{k=0}^{N-1} (q_{k+1} - q_k) \\cdot (q_{k+1} - q_k) = \\sum_{k=0}^{N-1} (\\|q_{k+1}\\|^2 - 2 q_k \\cdot q_{k+1} + \\|q_k\\|^2)\n$$\n$$\n= \\sum_{k=0}^{N-1} (1 - 2 q_k \\cdot q_{k+1} + 1) = \\sum_{k=0}^{N-1} (2 - 2 q_k \\cdot q_{k+1}) = 2N - 2 \\sum_{k=0}^{N-1} q_k \\cdot q_{k+1}\n$$\n最小化此表达式等价于最大化点积之和 $\\sum_{k=0}^{N-1} q_k \\cdot q_{k+1}$。这有一个清晰的几何解释：路径被尽可能地拉直，因为 $q_k \\cdot q_{k+1} = \\cos(\\alpha_k)$，其中 $\\alpha_k$ 是连续向量之间的夹角。最大化此和会最小化沿路径的角度变化。\n\n因此，该问题为一个数值求解器表述为：\n- **变量**：一个单一向量 $x \\in \\mathbb{R}^{3(N-1)}$，表示内部点 $\\{q_1, \\dots, q_{N-1}\\}$ 的扁平化坐标。\n- **目标函数**：最小化 $f(x) = - \\sum_{k=0}^{N-1} q_k \\cdot q_{k+1}$。\n- **约束**：$N-1$ 个等式约束的集合，$g_k(x) = \\|q_k\\|^2 - 1 = 0$，其中 $q_k$ 是从 $x$ 的相应分段重构的。\n\n这是一个标准的非线性规划问题，可使用 `scipy.optimize.minimize` 中提供的序列最小二乘规划（Sequential Least Squares Programming, SLSQP）方法求解。为了让迭代求解器高效收敛，需要一个合适的路径初始猜测。球面线性插值（slerp）是理想选择，但一个更简单有效的替代方法是在 $q_0$ 和 $q_N$ 之间进行线性插值，然后将每个中间点投影到单位球面上。\n\n诊断计算在优化后的离散路径 $\\{q_k\\}_{k=0}^N$ 上执行：\n1.  **总球面弧长**：$\\ell_{\\mathrm{disc}} = \\sum_{k=0}^{N-1} \\arccos(q_k \\cdot q_{k+1})$。该值与真实最短距离 $\\ell_{\\mathrm{true}}=\\arccos(q_0 \\cdot q_N)$ 进行比较。为防止 `arccos` 的数值错误，其参数被裁剪到区间 $[-1, 1]$ 内。\n2.  **最大分段长度**：$\\max_{k} \\arccos(q_k \\cdot q_{k+1})$，它衡量了沿路径的最大单步长度。对于 $q_0=q_N$ 的情况，最小作用量路径是平凡的（对所有 $k$ 都有 $q_k=q_0$），此诊断值预计为 $0$。\n3.  **均方根平面度偏差**：$\\mathbb{S}^2$ 上的真实测地线是一个大圆，位于一个穿过原点的平面内。离散路径的平面度通过找到最佳拟合点集 $\\{q_k\\}$ 的平面的单位法向量 $n$ 来评估。这是通过在 $\\|n\\|^2 = 1$ 的约束下最小化投影平方和 $\\sum_{k=0}^N (n \\cdot q_k)^2$ 来完成的。这是一个经典的线性代数问题：最小和是二阶矩矩阵 $M = \\sum_{k=0}^N q_k q_k^T$ 的最小特征值 $\\lambda_{\\min}$。均方根偏差即为 $\\sqrt{\\lambda_{\\min}/(N+1)}$。\n\n该实现将此逻辑封装在一个函数中，该函数为每个测试用例设置并求解优化问题以找到离散测地线，然后计算指定的诊断量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print the results.\n    \"\"\"\n\n    def solve_case(q0, qN, N):\n        \"\"\"\n        Solves for the discrete geodesic for a single test case.\n\n        Args:\n            q0 (np.ndarray): Starting point on the sphere.\n            qN (np.ndarray): Ending point on the sphere.\n            N (int): Number of segments in the path.\n\n        Returns:\n            np.ndarray: The optimized path as a sequence of (N+1) points.\n        \"\"\"\n        # 1. Initial guess for the interior points {q_1, ..., q_{N-1}}\n        # Linear interpolation between endpoints, then project to the sphere.\n        if np.allclose(q0, qN):\n            q_init = np.tile(q0, (N - 1, 1))\n        else:\n            q_init = np.array([q0 + (k / N) * (qN - q0) for k in range(1, N)])\n            norms = np.linalg.norm(q_init, axis=1, keepdims=True)\n            # Avoid division by zero if an interpolated point is the origin\n            # (not expected for the given test cases).\n            q_init /= np.where(norms > 1e-12, norms, 1.0)\n        \n        x0 = q_init.flatten()\n\n        # 2. Objective function to be minimized\n        # We minimize -sum(q_k . q_{k+1}), which is equivalent to maximizing the sum\n        # of dot products, and thus minimizing the original discrete action.\n        def objective_func(x, q0_v=q0, qN_v=qN, num_segs=N):\n            path = np.vstack([q0_v, x.reshape(num_segs - 1, 3), qN_v])\n            # Element-wise product and sum over axes gives dot products\n            dots = np.sum(path[:-1] * path[1:], axis=1)\n            return -np.sum(dots)\n\n        # 3. Constraints: ||q_k||^2 - 1 = 0 for k = 1, ..., N-1\n        constraints = []\n        for k in range(N - 1):\n            def constraint_factory(k_idx):\n                def constraint_func(x):\n                    q_k = x[3 * k_idx : 3 * (k_idx + 1)]\n                    return np.dot(q_k, q_k) - 1.0\n                return constraint_func\n            constraints.append({'type': 'eq', 'fun': constraint_factory(k)})\n\n        # 4. Optimization\n        res = minimize(\n            objective_func,\n            x0,\n            method='SLSQP',\n            constraints=constraints,\n            options={'maxiter': 1000, 'ftol': 1e-10}\n        )\n\n        if not res.success:\n            # Fallback or error, though not expected for this problem.\n            # For robustness, could return the initial guess path.\n            print(f\"Warning: Optimization failed for case N={N}. Message: {res.message}\")\n            x_opt = x0\n        else:\n            x_opt = res.x\n\n        # 5. Reconstruct the full optimized path {q_0, ..., q_N}\n        optimized_path = np.vstack([q0, x_opt.reshape(N - 1, 3), qN])\n        return optimized_path\n\n    results = []\n\n    # === Test Case 1 ===\n    theta_1 = 0.6\n    q0_1 = np.array([0.0, 0.0, 1.0])\n    qN_1 = np.array([np.sin(theta_1), 0.0, np.cos(theta_1)])\n    N_1 = 20\n    path_1 = solve_case(q0_1, qN_1, N_1)\n    dots_1 = np.sum(path_1[:-1] * path_1[1:], axis=1)\n    dots_1 = np.clip(dots_1, -1.0, 1.0) # For numerical stability of arccos\n    l_disc_1 = np.sum(np.arccos(dots_1))\n    l_true_1 = theta_1 # Since arccos(q0 . qN) = theta\n    res_1 = np.abs(l_disc_1 - l_true_1)\n    results.append(res_1)\n\n    # === Test Case 2 ===\n    q0_2 = np.array([0.0, 0.0, 1.0])\n    qN_2 = np.array([0.0, 0.0, 1.0])\n    N_2 = 10\n    path_2 = solve_case(q0_2, qN_2, N_2)\n    dots_2 = np.sum(path_2[:-1] * path_2[1:], axis=1)\n    dots_2 = np.clip(dots_2, -1.0, 1.0)\n    res_2 = np.max(np.arccos(dots_2))\n    results.append(res_2)\n\n    # === Test Case 3 ===\n    phi_3 = np.pi - 0.01\n    q0_3 = np.array([0.0, 0.0, 1.0])\n    qN_3 = np.array([np.sin(phi_3), 0.0, np.cos(phi_3)])\n    N_3 = 50\n    path_3 = solve_case(q0_3, qN_3, N_3)\n    # Fit best plane by finding the normal n that minimizes sum((n.q_k)^2).\n    # This n is the eigenvector of the moment matrix M = sum(q_k * q_k.T)\n    # corresponding to the smallest eigenvalue.\n    M = path_3.T @ path_3 # M_ij = sum_k q_k[i] * q_k[j]\n    # np.linalg.eigh is for Hermitian (symmetric) matrices and returns sorted eigenvalues.\n    eigenvalues, _ = np.linalg.eigh(M)\n    lambda_min = eigenvalues[0] # The smallest eigenvalue\n    # The minimum sum of squares is lambda_min.\n    # The RMS deviation is sqrt( (sum of squares) / (number of points) )\n    res_3 = np.sqrt(lambda_min / (N_3 + 1))\n    results.append(res_3)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}