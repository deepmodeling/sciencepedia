{
    "hands_on_practices": [
        {
            "introduction": "Before applying any numerical method, it is crucial to understand its domain of applicability. Splitting methods are predicated on the ability to separate a Hamiltonian $H(q,p)$ into a sum of simpler, individually solvable parts, typically a kinetic term $T(p)$ and a potential term $V(q)$. This exercise challenges you to analyze several physically significant Hamiltonians, determine whether they are separable, and understand why the presence of coupling terms between position and momentum makes the standard splitting approach fail. ",
            "id": "3766842",
            "problem": "Consider a Hamiltonian system on the cotangent bundle of a configuration manifold modeled locally as the phase space $\\mathbb{R}^{d}\\times\\mathbb{R}^{d}$ with canonical coordinates $(q,p)$ and canonical symplectic form. Hamilton’s equations are $\\dot{q}=\\partial H/\\partial p$ and $\\dot{p}=-\\partial H/\\partial q$. A Hamiltonian $H(q,p)$ is called separable if it can be written as $H(q,p)=T(p)+V(q)$, where $T$ depends only on $p$ and $V$ depends only on $q$. The standard splitting method for separable Hamiltonians composes the exact flows of the Hamiltonian vector fields generated by $T$ and $V$, which are explicitly solvable because the $T$-flow leaves $p$ constant while translating $q$, and the $V$-flow leaves $q$ constant while translating $p$. In a general setting, a necessary condition for separability is that the mixed second derivative (the mixed Hessian) satisfies $\\partial^{2}H/\\partial q\\,\\partial p=0$ everywhere.\n\nSelect all options that correctly provide an example of a nonseparable Hamiltonian $H(q,p)$ that cannot be written as $T(p)+V(q)$ and explain why the standard splitting into $T$ and $V$ fails to apply.\n\nA. $H(q,p)=\\tfrac{1}{2}\\,(p-A(q))^{\\top}M^{-1}(p-A(q))+V(q)$, where $M$ is a constant, symmetric, positive-definite matrix and $A:\\mathbb{R}^{d}\\to\\mathbb{R}^{d}$ is a smooth, nonconstant vector potential. This $H$ is nonseparable because the mixed Hessian $\\partial^{2}H/\\partial q\\,\\partial p$ is nonzero when $\\nabla A(q)\\neq 0$. The standard splitting fails since the “kinetic” part depends on $q$, so its exact flow does not keep $p$ constant and is not the trivial drift used by the splitting; any attempt to absorb $p\\cdot A(q)$ into $V$ makes $V$ depend on $p$, violating the separable form.\n\nB. $H(q,p)=\\tfrac{1}{2}\\,p^{\\top}M(q)^{-1}p+V(q)$, where $M(q)$ is a smooth, symmetric, positive-definite, position-dependent mass matrix. This $H$ is nonseparable because $\\partial^{2}H/\\partial q\\,\\partial p\\neq 0$ whenever $\\nabla M(q)\\neq 0$. The standard splitting fails because the $T$-flow now changes $p$ (it depends on $q$), so one cannot implement the drift with $p$ fixed; “freezing” $M(q)$ to force a drift is not an exact Hamiltonian flow and thus breaks symplecticity and reversibility.\n\nC. $H(q,p)=\\tfrac{1}{2}\\,\\|p\\|^{2}+V(q)+p^{\\top}C\\,q$, where $C$ is a fixed nonzero matrix. This $H$ is nonseparable because $\\partial^{2}H/\\partial q\\,\\partial p=C\\neq 0$. The standard splitting fails because any attempt to write $H=T(p)+V(q)$ forces the $p^{\\top}C\\,q$ term into either $T$ or $V$, making one of them depend on both $q$ and $p$; the resulting subflow is not the trivial drift or kick required for the method.\n\nD. $H(q,p)=\\tfrac{1}{2}\\,\\|p\\|^{2}+V(q)$. This $H$ is nonseparable, so the standard splitting fails.\n\nSelect all correct options.",
            "solution": "The problem statement is critically validated before proceeding to a solution.\n\n### Step 1: Extract Givens\n- **System**: A Hamiltonian system on the cotangent bundle, locally $\\mathbb{R}^{d}\\times\\mathbb{R}^{d}$, with canonical coordinates $(q,p)$ and canonical symplectic form.\n- **Equations of Motion**: Hamilton’s equations are $\\dot{q}=\\partial H/\\partial p$ and $\\dot{p}=-\\partial H/\\partial q$.\n- **Definition of Separable Hamiltonian**: A Hamiltonian $H(q,p)$ is separable if it can be written as $H(q,p)=T(p)+V(q)$.\n- **Standard Splitting Method**: This method composes the exact flows of the Hamiltonian vector fields generated by $T(p)$ and $V(q)$.\n- **Properties of Sub-flows**:\n    - The flow generated by $T(p)$ (the \"drift\") leaves $p$ constant and translates $q$. The equations are $\\dot{q} = \\nabla_p T(p)$ and $\\dot{p} = 0$.\n    - The flow generated by $V(q)$ (the \"kick\") leaves $q$ constant and translates $p$. The equations are $\\dot{q} = 0$ and $\\dot{p} = -\\nabla_q V(q)$.\n- **Necessary Condition for Separability**: The mixed Hessian matrix, with entries $\\frac{\\partial^{2}H}{\\partial q_i \\partial p_j}$, is the zero matrix everywhere, i.e., $\\partial^{2}H/\\partial q\\,\\partial p=0$.\n- **Task**: Identify all options that correctly provide an example of a nonseparable Hamiltonian and correctly explain why the standard splitting method fails to apply.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is scientifically and mathematically sound. It provides standard, correct definitions from the field of geometric mechanics and numerical integration concerning separable Hamiltonians and splitting methods. The concepts are fundamental and well-established. The problem is well-posed, asking for the identification of correct examples based on the provided definitions. There are no contradictions, ambiguities, or missing information. The necessary condition $\\partial^{2}H/\\partial q\\,\\partial p=0$ is a direct consequence of the definition $H(q,p)=T(p)+V(q)$, as $\\partial_q(\\partial_p H) = \\partial_q(\\partial_p (T(p)+V(q))) = \\partial_q(\\nabla_p T(p)) = 0$.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. A solution will be derived by analyzing each option.\n\n### Solution and Option Analysis\nThe core of the problem is to test whether a given Hamiltonian $H(q,p)$ is nonseparable, meaning it cannot be written as a sum of a function of only $p$ and a function of only $q$. A sufficient way to demonstrate nonseparability is to show that the mixed partial derivative matrix $\\partial^{2}H/(\\partial q\\,\\partial p)$ is non-zero. If a Hamiltonian is nonseparable, the standard splitting into a $T(p)$ part and a $V(q)$ part is, by definition, impossible. The sub-problems for drift and kick would no longer be simple translations in $q$ or $p$ respectively.\n\n**Option A: $H(q,p)=\\tfrac{1}{2}\\,(p-A(q))^{\\top}M^{-1}(p-A(q))+V(q)$**\nThis Hamiltonian describes the dynamics of a charged particle in a magnetic field (where $A(q)$ is the vector potential) on a Riemannian manifold with metric $M$. We expand the Hamiltonian:\n$$H(q,p) = \\frac{1}{2} (p^{\\top}M^{-1}p - p^{\\top}M^{-1}A(q) - A(q)^{\\top}M^{-1}p + A(q)^{\\top}M^{-1}A(q)) + V(q)$$\nSince $M^{-1}$ is symmetric, $p^{\\top}M^{-1}A(q) = A(q)^{\\top}M^{-1}p$. Thus:\n$$H(q,p) = \\frac{1}{2} p^{\\top}M^{-1}p - A(q)^{\\top}M^{-1}p + \\frac{1}{2} A(q)^{\\top}M^{-1}A(q) + V(q)$$\nThe term $-A(q)^{\\top}M^{-1}p$ couples the variables $q$ and $p$. To test for nonseparability, we compute the gradient with respect to $p$ and then differentiate with respect to $q$.\n$$\\frac{\\partial H}{\\partial p} = M^{-1}p - M^{-1}A(q)$$\nThe mixed Hessian matrix $\\partial^2 H/(\\partial q\\, \\partial p)$ is the Jacobian of this expression with respect to $q$. Let $J_A(q)$ be the Jacobian matrix of $A(q)$, with entries $(J_A)_{ij} = \\partial A_i/\\partial q_j$. Differentiating the components $(\\partial H/\\partial p_k) = \\sum_l (M^{-1})_{kl}(p_l-A_l(q))$ with respect to $q_j$ gives:\n$$\\frac{\\partial^2 H}{\\partial q_j \\partial p_k} = -\\sum_l (M^{-1})_{kl} \\frac{\\partial A_l}{\\partial q_j} = -(M^{-1} J_A(q))_{kj}$$\nThis mixed Hessian matrix is non-zero because $A(q)$ is nonconstant (so $J_A(q) \\neq 0$) and $M^{-1}$ is invertible. Thus, the Hamiltonian is nonseparable.\nThe explanation for the failure of standard splitting is also correct. Any attempt to form a splitting $H = T+V$ where $T$ depends only on $p$ and $V$ depends only on $q$ is impossible due to the $-A(q)^{\\top}M^{-1}p$ term. If we define a \"kinetic\" part $T_{\\text{eff}}(q,p) = \\tfrac{1}{2}\\,(p-A(q))^{\\top}M^{-1}(p-A(q))$, its associated Hamiltonian flow has $\\dot{p} = -\\partial H/\\partial q$, which is non-zero and depends on both $q$ and $p$. This is not the simple drift with $\\dot{p}=0$ required by the standard splitting method.\n**Verdict: Correct.**\n\n**Option B: $H(q,p)=\\tfrac{1}{2}\\,p^{\\top}M(q)^{-1}p+V(q)$**\nThis Hamiltonian describes motion on a Riemannian manifold with a position-dependent metric $M(q)$. The term $\\tfrac{1}{2}\\,p^{\\top}M(q)^{-1}p$ couples $q$ and $p$. We compute the mixed Hessian:\n$$\\frac{\\partial H}{\\partial p} = M(q)^{-1}p$$\nDifferentiating the $j$-th component with respect to $q_k$:\n$$\\frac{\\partial^2 H}{\\partial q_k \\partial p_j} = \\frac{\\partial}{\\partial q_k} \\left(\\sum_l (M(q)^{-1})_{jl} p_l \\right) = \\sum_l \\frac{\\partial (M(q)^{-1})_{jl}}{\\partial q_k} p_l$$\nThis expression is non-zero whenever $M(q)$ is not a constant matrix (i.e., $\\nabla M(q) \\neq 0$) and $p \\neq 0$. The Hamiltonian is nonseparable.\nThe explanation for splitting failure is accurate. To apply the standard method, one would need to integrate the flow of the kinetic part, $T(q,p) = \\tfrac{1}{2}\\,p^{\\top}M(q)^{-1}p$, alone. The equations for this flow are $\\dot{q} = M(q)^{-1}p$ and $\\dot{p} = -\\partial T/\\partial q$. The term $\\partial T/\\partial q$ is non-zero because $M(q)^{-1}$ depends on $q$. Therefore, $\\dot{p} \\neq 0$, and this sub-problem is not a simple drift where $p$ is constant. The comment about \"freezing\" $M(q)$ correctly points out that such an approximation breaks the Hamiltonian structure of the sub-problem, thereby forfeiting the guarantee of symplecticity.\n**Verdict: Correct.**\n\n**Option C: $H(q,p)=\\tfrac{1}{2}\\,\\|p\\|^{2}+V(q)+p^{\\top}C\\,q$**\nThe coupling term is $p^{\\top}C\\,q$. We compute the mixed Hessian.\n$$\\frac{\\partial H}{\\partial p_k} = \\frac{\\partial}{\\partial p_k} \\left(\\frac{1}{2}\\sum_i p_i^2 + V(q) + \\sum_{i,j} p_i C_{ij} q_j \\right) = p_k + \\sum_j C_{kj} q_j$$\nDifferentiating with respect to $q_l$:\n$$\\frac{\\partial^2 H}{\\partial q_l \\partial p_k} = \\frac{\\partial}{\\partial q_l} \\left( p_k + \\sum_j C_{kj} q_j \\right) = C_{kl}$$\nThe mixed Hessian matrix is the constant matrix $C$. Since $C$ is a fixed nonzero matrix, the Hamiltonian is nonseparable.\nThe explanation for failure is a direct consequence of this structure. The term $p^{\\top}C\\,q$ cannot be assigned exclusively to a $T(p)$ or a $V(q)$ part without violating the condition that $T$ depends only on $p$ and $V$ depends only on $q$. For instance, if one defines $T_{\\text{new}}(p,q) = \\tfrac{1}{2}\\,\\|p\\|^{2} + p^{\\top}C\\,q$, then the flow of $T_{\\text{new}}$ is not a simple drift because $\\partial T_{\\text{new}}/\\partial q = C^{\\top}p \\neq 0$, so $\\dot{p} \\neq 0$. This confirms the explanation.\n**Verdict: Correct.**\n\n**Option D: $H(q,p)=\\tfrac{1}{2}\\,\\|p\\|^{2}+V(q)$**\nThis Hamiltonian is of the form $H(q,p) = T(p)+V(q)$ with $T(p) = \\tfrac{1}{2}\\,\\|p\\|^{2}$ and $V(q)$ as given. This is the canonical example of a separable Hamiltonian. The mixed Hessian is:\n$$\\frac{\\partial H}{\\partial p_k} = p_k$$\n$$\\frac{\\partial^2 H}{\\partial q_l \\partial p_k} = \\frac{\\partial}{\\partial q_l}(p_k) = 0$$\nThe mixed Hessian is zero, confirming separability. The statement \"This $H$ is nonseparable\" is false. Consequently, the conclusion \"so the standard splitting fails\" is also false; in fact, this is the ideal case where standard splitting methods (like the Verlet method) apply and work exceptionally well.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{ABC}$$"
        },
        {
            "introduction": "Once a Hamiltonian is identified as separable, we can construct an integrator by composing the exact flows of its constituent parts. This practice guides you through the step-by-step construction of the widely used second-order Strang splitting method for the harmonic oscillator, a foundational model in physics. By deriving the resulting 'discrete frequency' of the numerical map, you will gain a concrete understanding of how the integrator approximates the true dynamics and how its accuracy depends on the time step. ",
            "id": "3766828",
            "problem": "Consider the one-degree-of-freedom harmonic oscillator with Hamiltonian $H(q,p)=\\frac{p^{2}}{2}+\\frac{\\omega^{2}q^{2}}{2}$, where $q$ is position, $p$ is momentum, and $\\omega>0$ is a constant. Let $H$ be split into the kinetic part $T(p)=\\frac{p^{2}}{2}$ and the potential part $V(q)=\\frac{\\omega^{2}q^{2}}{2}$. Using Hamilton’s equations and the exact flows generated separately by $T$ and $V$, construct the second-order symmetric Strang splitting (also called the kick–drift–kick method) with time step $h>0$ to update $(q_{n},p_{n})\\mapsto(q_{n+1},p_{n+1})$.\n\nThen, by composing the subflows into a single linear one-step map on $(q,p)$, determine the corresponding planar rotation angle $\\theta$ of this map and the associated discrete frequency $\\tilde{\\omega}$ defined implicitly by $\\theta=\\tilde{\\omega}h$. Your reasoning must start from Hamilton’s equations and the exact subflows of $T$ and $V$, and proceed by explicit composition.\n\nAs your final answer, report the discrete frequency $\\tilde{\\omega}$ as a closed-form analytic expression in terms of $h$ and $\\omega$. Express the discrete frequency in radians per unit time. Do not approximate or round the result; give it in exact symbolic form.",
            "solution": "The problem is first assessed for validity.\n\n**Step 1: Extract Givens**\n- Hamiltonian: $H(q,p)=\\frac{p^{2}}{2}+\\frac{\\omega^{2}q^{2}}{2}$\n- Position coordinate: $q$\n- Momentum coordinate: $p$\n- Constant frequency: $\\omega > 0$\n- Hamiltonian splitting: $H = T+V$\n- Kinetic part: $T(p)=\\frac{p^{2}}{2}$\n- Potential part: $V(q)=\\frac{\\omega^{2}q^{2}}{2}$\n- Numerical method: Second-order symmetric Strang splitting (kick–drift–kick)\n- Time step: $h > 0$\n- Update map: $(q_{n},p_{n})\\mapsto(q_{n+1},p_{n+1})$\n- Required quantities: The planar rotation angle $\\theta$ of the one-step map and the discrete frequency $\\tilde{\\omega}$ defined by $\\theta=\\tilde{\\omega}h$.\n- Final answer: A closed-form analytic expression for $\\tilde{\\omega}$ in terms of $h$ and $\\omega$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It concerns the application of a standard numerical integration technique (Strang splitting) to a fundamental model in classical mechanics (the simple harmonic oscillator). The concepts of Hamilton's equations, separable Hamiltonians, and symplectic integrators are well-established in the field of geometric mechanics. All necessary data and definitions are provided, and there are no internal contradictions, ambiguities, or scientifically unsound premises. The problem is a standard, non-trivial exercise in the analysis of numerical methods for Hamiltonian systems.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete, reasoned solution will be provided.\n\nThe Hamiltonian for the harmonic oscillator is $H(q,p) = \\frac{p^{2}}{2} + \\frac{\\omega^{2}q^{2}}{2}$. This is separable into a kinetic energy term $T(p) = \\frac{p^{2}}{2}$ and a potential energy term $V(q) = \\frac{\\omega^{2}q^{2}}{2}$.\n\nWe first determine the exact flows corresponding to $T(p)$ and $V(q)$ individually.\n\nFor the kinetic part, the Hamiltonian is $H_T = T(p)$. Hamilton's equations are:\n$$\n\\dot{q} = \\frac{\\partial T}{\\partial p} = p\n$$\n$$\n\\dot{p} = -\\frac{\\partial T}{\\partial q} = 0\n$$\nIntegrating these equations over a time interval $t$ starting from $(q_0, p_0)$ yields:\n$p(t) = p_0$\n$q(t) = q_0 + \\int_{0}^{t} p_0 \\,ds = q_0 + p_0 t$\nThe exact flow map for $T$ over a time $t$, denoted $\\Phi_t^T$, is a \"drift\":\n$$\n\\Phi_t^T(q,p) = (q+pt, p)\n$$\n\nFor the potential part, the Hamiltonian is $H_V = V(q)$. Hamilton's equations are:\n$$\n\\dot{q} = \\frac{\\partial V}{\\partial p} = 0\n$$\n$$\n\\dot{p} = -\\frac{\\partial V}{\\partial q} = -\\omega^2 q\n$$\nIntegrating these equations over a time interval $t$ starting from $(q_0, p_0)$ yields:\n$q(t) = q_0$\n$p(t) = p_0 + \\int_{0}^{t} (-\\omega^2 q_0) \\,ds = p_0 - \\omega^2 q_0 t$\nThe exact flow map for $V$ over a time $t$, denoted $\\Phi_t^V$, is a \"kick\":\n$$\n\\Phi_t^V(q,p) = (q, p-\\omega^2 q t)\n$$\n\nThe second-order symmetric Strang splitting, described as a \"kick-drift-kick\" method, is constructed by composing these flows. The update from $(q_n, p_n)$ to $(q_{n+1}, p_{n+1})$ over a time step $h$ is given by the composition $\\Phi_{h/2}^V \\circ \\Phi_h^T \\circ \\Phi_{h/2}^V$. Let's apply this composition sequentially.\n\n$1$. **First kick (time $h/2$):** Apply $\\Phi_{h/2}^V$ to $(q_n, p_n)$.\n$$\n(q', p') = \\Phi_{h/2}^V(q_n, p_n) = \\left(q_n, p_n - \\frac{\\omega^2 q_n h}{2}\\right)\n$$\n\n$2$. **Drift (time $h$):** Apply $\\Phi_h^T$ to the intermediate state $(q', p')$.\n$$\n(q'', p'') = \\Phi_h^T(q', p') = \\left(q' + p'h, p'\\right) = \\left(q_n + \\left(p_n - \\frac{\\omega^2 q_n h}{2}\\right)h, p_n - \\frac{\\omega^2 q_n h}{2}\\right)\n$$\nSimplifying the first component gives:\n$$\nq'' = q_n + p_n h - \\frac{\\omega^2 q_n h^2}{2}\n$$\n\n$3$. **Second kick (time $h/2$):** Apply $\\Phi_{h/2}^V$ to $(q'', p'')$ to get the final state $(q_{n+1}, p_{n+1})$.\n$$\n(q_{n+1}, p_{n+1}) = \\Phi_{h/2}^V(q'', p'') = \\left(q'', p'' - \\frac{\\omega^2 q'' h}{2}\\right)\n$$\nThe new position is $q_{n+1} = q''$:\n$$\nq_{n+1} = q_n \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + p_n h\n$$\nThe new momentum is $p_{n+1} = p'' - \\frac{\\omega^2 q'' h}{2}$:\n$$\np_{n+1} = \\left(p_n - \\frac{\\omega^2 q_n h}{2}\\right) - \\frac{\\omega^2 h}{2}\\left(q_n + p_n h - \\frac{\\omega^2 q_n h^2}{2}\\right)\n$$\n$$\np_{n+1} = p_n - \\frac{\\omega^2 q_n h}{2} - \\frac{\\omega^2 q_n h}{2} - \\frac{\\omega^2 p_n h^2}{2} + \\frac{\\omega^4 q_n h^3}{4}\n$$\n$$\np_{n+1} = p_n \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + q_n \\left(-\\omega^2 h + \\frac{\\omega^4 h^3}{4}\\right)\n$$\n$$\np_{n+1} = q_n \\left(-\\omega^2 h\\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\\right) + p_n \\left(1 - \\frac{\\omega^2 h^2}{2}\\right)\n$$\n\nThis linear update can be expressed in matrix form as $(q_{n+1}, p_{n+1})^T = M (q_n, p_n)^T$, where $M$ is the one-step map:\n$$\nM = \\begin{pmatrix} 1 - \\frac{\\omega^2 h^2}{2} & h \\\\ -\\omega^2 h\\left(1 - \\frac{\\omega^2 h^2}{4}\\right) & 1 - \\frac{\\omega^2 h^2}{2} \\end{pmatrix}\n$$\nThe map $M$ represents a discrete evolution that approximates the continuous-time rotation in phase space of the exact harmonic oscillator. The stability and rotational properties of this map are determined by its eigenvalues. The eigenvalues $\\lambda$ are the roots of the characteristic equation $\\det(M - \\lambda I) = 0$, which is $\\lambda^2 - \\text{Tr}(M)\\lambda + \\det(M) = 0$.\n\nThe trace of $M$ is:\n$$\n\\text{Tr}(M) = \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) = 2 - \\omega^2 h^2\n$$\nThe determinant of $M$ is:\n$$\n\\det(M) = \\left(1 - \\frac{\\omega^2 h^2}{2}\\right)^2 - h \\left(-\\omega^2 h\\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\\right)\n$$\n$$\n\\det(M) = \\left(1 - \\omega^2 h^2 + \\frac{\\omega^4 h^4}{4}\\right) + \\omega^2 h^2 \\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\n$$\n$$\n\\det(M) = 1 - \\omega^2 h^2 + \\frac{\\omega^4 h^4}{4} + \\omega^2 h^2 - \\frac{\\omega^4 h^4}{4} = 1\n$$\nAs expected for a map derived from a symplectic splitting method, $\\det(M)=1$.\n\nFor a stable discrete rotation, the eigenvalues must be a complex conjugate pair on the unit circle, $\\lambda = e^{\\pm i\\theta}$, where $\\theta$ is the rotation angle per step. In this case, the trace of the matrix is $\\text{Tr}(M) = e^{i\\theta} + e^{-i\\theta} = 2\\cos\\theta$.\nEquating the two expressions for the trace gives:\n$$\n2\\cos\\theta = 2 - \\omega^2 h^2\n$$\n$$\n\\cos\\theta = 1 - \\frac{\\omega^2 h^2}{2}\n$$\nThis defines the numerical rotation angle $\\theta$. The method is stable as long as the argument of the arccosine is in $[-1, 1]$, which requires $-1 \\le 1 - \\frac{\\omega^2 h^2}{2} \\le 1$. This implies $0 \\le \\frac{\\omega^2 h^2}{2} \\le 2$, or $\\omega^2 h^2 \\le 4$, leading to the stability condition $\\omega h \\le 2$.\n\nThe problem defines the discrete frequency $\\tilde{\\omega}$ via the relation $\\theta = \\tilde{\\omega}h$. Substituting this into our expression for $\\cos\\theta$:\n$$\n\\cos(\\tilde{\\omega}h) = 1 - \\frac{\\omega^2 h^2}{2}\n$$\nTo solve for $\\tilde{\\omega}$, we use the half-angle identity $\\cos(A) = 1 - 2\\sin^2(A/2)$. Let $A = \\tilde{\\omega}h$:\n$$\n1 - 2\\sin^2\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = 1 - \\frac{\\omega^2 h^2}{2}\n$$\n$$\n2\\sin^2\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\frac{\\omega^2 h^2}{2}\n$$\n$$\n\\sin^2\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\frac{\\omega^2 h^2}{4}\n$$\nTaking the square root of both sides gives:\n$$\n\\sin\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\pm \\frac{\\omega h}{2}\n$$\nFor the numerical frequency $\\tilde{\\omega}$ to correspond to the exact frequency $\\omega$ in the limit $h \\to 0$, we must choose the positive root. For small arguments, $\\sin(x) \\approx x$, so $\\frac{\\tilde{\\omega}h}{2} \\approx \\frac{\\omega h}{2}$, which implies $\\tilde{\\omega} \\approx \\omega$. Thus, we take the positive solution:\n$$\n\\sin\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\frac{\\omega h}{2}\n$$\nSolving for $\\tilde{\\omega}$ yields the final expression for the discrete frequency:\n$$\n\\frac{\\tilde{\\omega}h}{2} = \\arcsin\\left(\\frac{\\omega h}{2}\\right)\n$$\n$$\n\\tilde{\\omega} = \\frac{2}{h} \\arcsin\\left(\\frac{\\omega h}{2}\\right)\n$$\nThis is the closed-form analytic expression for the discrete frequency of the Strang-split harmonic oscillator.",
            "answer": "$$\n\\boxed{\\frac{2}{h} \\arcsin\\left(\\frac{\\omega h}{2}\\right)}\n$$"
        },
        {
            "introduction": "The true power of splitting methods is realized in their practical implementation, particularly the construction of higher-order schemes for enhanced accuracy. This final practice transitions from theoretical derivation to computational application, guiding you through the implementation of a fourth-order integrator using Yoshida's composition technique. By testing your code on an anisotropic oscillator and measuring its performance, you will see firsthand the remarkable long-term stability and precision that define modern geometric integrators. ",
            "id": "3766822",
            "problem": "Consider the separable Hamiltonian system in two dimensions with the phase-space coordinate $\\left(q,p\\right) \\in \\mathbb{R}^2 \\times \\mathbb{R}^2$ and the Hamiltonian\n$$\nH(q,p) = T(p) + V(q), \\quad T(p) = \\tfrac{1}{2}\\left(p_1^2 + p_2^2\\right), \\quad V(q) = \\tfrac{1}{2}\\left(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2\\right),\n$$\nwhere $\\omega_1 > 0$ and $\\omega_2 > 0$ are constant angular frequencies. The Hamiltonian vector field defined by Hamilton's equations is\n$$\n\\dot{q} = \\nabla_p T(p) = p, \\quad \\dot{p} = -\\nabla_q V(q) = -\\operatorname{diag}(\\omega_1^2, \\omega_2^2)\\, q.\n$$\nThis system describes an anisotropic harmonic oscillator and is separable into kinetic and potential parts. The exact solution is a rotation in each coordinate plane with angular frequencies $\\omega_1$ and $\\omega_2$, respectively, and trigonometric functions use the angle unit in radians.\n\nDesign and implement a program that:\n- Constructs a fourth-order symplectic integrator by composing a symmetric second-order Strang splitting for the separable Hamiltonian described above, using the composition proposed by Haruo Yoshida. The program must implement the flows of the kinetic part $T(p)$ and the potential part $V(q)$ exactly and assemble the full one-step integrator by a specific fourth-order composition of second-order steps.\n- Uses a fixed time step $h$ that is dimensionless and a fixed number of steps $N$ to integrate from time $t=0$ to time $t=Nh$. Your numerical solution must evolve both position and momentum.\n- Computes two error metrics at the final time $t=Nh$ for each test case:\n  1. The relative energy error, defined as\n     $$\n     \\varepsilon_H = \\frac{\\left|H(q_N,p_N) - H(q_0,p_0)\\right|}{H(q_0,p_0)},\n     $$\n     where $(q_N,p_N)$ is the numerical solution after $N$ steps and $(q_0,p_0)$ is the initial condition.\n  2. The relative state error against the exact solution at $t=Nh$, defined by\n     $$\n     \\varepsilon_X = \\frac{\\left\\| \\begin{pmatrix} q_N \\\\ p_N \\end{pmatrix} - \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}{\\left\\| \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}.\n     $$\n\nFundamental base to be used:\n- Hamilton's equations for separable Hamiltonians and the exact solvability of the subflows $\\phi_T^t$ and $\\phi_V^t$ for the kinetic and potential parts, respectively.\n- The existence of symmetric second-order Strang splitting for separable systems and the existence of fourth-order compositions constructed from symmetric second-order methods.\n\nInitial condition:\n- Use $(q_0, p_0) = \\left((1, -\\tfrac{1}{2}), (0.3, 0.7)\\right)$.\n\nIntegrator specification:\n- Time step $h$ is fixed and dimensionless; set $h = 10^{-2}$.\n- Number of steps $N$ is fixed; set $N = 1000$.\n- Trigonometric functions must use angles measured in radians.\n\nTest suite:\n- Define the following five test cases by the pair $(\\omega_1 h, \\omega_2 h)$, ensuring scientific realism and coverage of different regimes while remaining within a stable regime for the implemented method:\n\n  1. $(0.05, 0.05)$: very small step relative to both frequencies (near-linear regime).\n\n  2. $(0.25, 0.75)$: moderate anisotropy with distinct scales.\n\n  3. $(0.75, 0.25)$: swapped anisotropy to test symmetry in indices.\n\n  4. $(1.05, 1.05)$: near the known stability boundary of second-order splitting substeps.\n\n  5. $(1.10, 0.10)$: extreme anisotropy with one frequency near boundary.\n\nFor each test case, set $\\omega_1 = (\\omega_1 h)/h$ and $\\omega_2 = (\\omega_2 h)/h$, keeping the fixed $h$ specified above. Integrate the system for $N$ steps using the Yoshida fourth-order composition of the symmetric second-order Strang splitting and compute $\\varepsilon_H$ and $\\varepsilon_X$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of the list should itself be a two-element list of floating-point numbers in the order $[\\varepsilon_H, \\varepsilon_X]$, one per test case, e.g., \"[[eH1,eX1],[eH2,eX2],...]\".",
            "solution": "## Problem Validation\n\n### Step 1: Extract Givens\n\n- **Hamiltonian System**:\n    - Phase-space coordinate: $(q,p) \\in \\mathbb{R}^2 \\times \\mathbb{R}^2$.\n    - Hamiltonian: $H(q,p) = T(p) + V(q)$, which is separable.\n    - Kinetic energy: $T(p) = \\tfrac{1}{2}\\left(p_1^2 + p_2^2\\right)$.\n    - Potential energy: $V(q) = \\tfrac{1}{2}\\left(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2\\right)$, where $\\omega_1 > 0$ and $\\omega_2 > 0$ are constants.\n- **Hamilton's Equations**:\n    - $\\dot{q} = \\nabla_p T(p) = p$.\n    - $\\dot{p} = -\\nabla_q V(q) = -\\operatorname{diag}(\\omega_1^2, \\omega_2^2)\\, q$.\n- **Initial Condition**:\n    - $(q_0, p_0) = \\left((1, -0.5), (0.3, 0.7)\\right)$.\n- **Integrator Specification**:\n    - Method: Fourth-order symplectic integrator from composing a symmetric second-order Strang splitting using Haruo Yoshida's composition.\n    - Sub-flows for $T(p)$ and $V(q)$ must be implemented exactly.\n    - Time step: $h = 10^{-2}$ (fixed and dimensionless).\n    - Number of steps: $N = 1000$.\n    - Trigonometric functions use radians.\n- **Test Cases**:\n    - Test cases are defined by the pair $(\\omega_1 h, \\omega_2 h)$:\n      1. $(0.05, 0.05)$\n      2. $(0.25, 0.75)$\n      3. $(0.75, 0.25)$\n      4. $(1.05, 1.05)$\n      5. $(1.10, 0.10)$\n    - For each case, $\\omega_1 = (\\omega_1 h)/h$ and $\\omega_2 = (\\omega_2 h)/h$.\n- **Error Metrics to Compute**:\n    1. Relative energy error: $\\varepsilon_H = \\frac{\\left|H(q_N,p_N) - H(q_0,p_0)\\right|}{H(q_0,p_0)}$.\n    2. Relative state error: $\\varepsilon_X = \\frac{\\left\\| \\begin{pmatrix} q_N \\\\ p_N \\end{pmatrix} - \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}{\\left\\| \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}$.\n- **Final Output Format**: `[[eH1,eX1],[eH2,eX2],...]`.\n\n### Step 2: Validate Using Extracted Givens\n\n- **Scientifically Grounded**: The problem describes the dynamics of a 2D anisotropic harmonic oscillator, a fundamental model in classical mechanics. The Hamiltonian is correctly formulated. The use of splitting methods, specifically Strang splitting and Yoshida's composition, is a standard, rigorously established technique in geometric numerical integration for Hamiltonian systems. All concepts are firmly based on established principles of physics and mathematics.\n- **Well-Posed**: The problem is well-posed. The differential equations have a unique, stable solution for any given set of initial conditions. The numerical method is well-defined, and the parameters ($h$, $N$) are specified. The error metrics are standard and unambiguous.\n- **Objective**: The problem is stated using precise, objective mathematical language. There are no subjective or opinion-based statements.\n- **Completeness and Consistency**: All necessary information is provided. The givens are self-contained and consistent. The Hamiltonian, initial conditions, integration parameters, test cases, and desired outputs are all explicitly defined. There are no contradictions.\n- **Other Flaws**: The problem is not trivial, metaphorical, or unrealistic. The test cases are chosen to probe different dynamic regimes and the stability properties of the method, which is a meaningful exercise.\n\n### Step 3: Verdict and Action\n\nThe problem is valid. It is scientifically sound, well-posed, and complete. A solution will be constructed.\n\n## Solution\n\nThe solution to this problem involves three main components: deriving the exact analytical solution for validation, constructing the specified fourth-order symplectic integrator, and implementing a numerical procedure to compute the required error metrics for the given test cases.\n\n### 1. Exact Solution of the Anisotropic Harmonic Oscillator\n\nThe Hamiltonian $H(q, p) = \\frac{1}{2}(p_1^2 + p_2^2) + \\frac{1}{2}(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2)$ separates into two independent 1D harmonic oscillators, one for each coordinate. Hamilton's equations are:\n$$\n\\dot{q}_i = p_i, \\quad \\dot{p}_i = -\\omega_i^2 q_i, \\quad \\text{for } i=1, 2.\n$$\nDifferentiating $\\dot{q}_i$ with respect to time gives the second-order ordinary differential equation $\\ddot{q}_i + \\omega_i^2 q_i = 0$. Given initial conditions $(q_{i,0}, p_{i,0})$ at $t=0$, the unique solution for each coordinate $i$ is:\n$$\nq_i(t) = q_{i,0} \\cos(\\omega_i t) + \\frac{p_{i,0}}{\\omega_i} \\sin(\\omega_i t)\n$$\n$$\np_i(t) = \\dot{q}_i(t) = p_{i,0} \\cos(\\omega_i t) - q_{i,0} \\omega_i \\sin(\\omega_i t)\n$$\nThis exact solution will be used at the final time $t_f = Nh$ to compute the state error $\\varepsilon_X$.\n\n### 2. Fourth-Order Symplectic Integrator\n\nA symplectic integrator is designed to preserve the symplectic structure of phase space, which leads to excellent long-term energy conservation properties. For a separable Hamiltonian $H = T(p) + V(q)$, the total flow can be approximated by composing the exact flows of the subsystems governed by $T(p)$ and $V(q)$ alone.\n\n**Exact Sub-flows:**\nLet $\\phi_{\\cdot}^{\\tau}$ denote the exact flow for a time interval $\\tau$.\n- **Flow for $T(p)$**: Hamilton's equations are $\\dot{q} = \\nabla_p T(p) = p$ and $\\dot{p} = 0$. Integrating over a time step $\\tau$ yields:\n  $$ \\phi_T^\\tau(q,p) = (q + p\\tau, p) $$\n- **Flow for $V(q)$**: Hamilton's equations are $\\dot{q} = 0$ and $\\dot{p} = -\\nabla_q V(q) = -M q$, where $M = \\operatorname{diag}(\\omega_1^2, \\omega_2^2)$. Integrating over a time step $\\tau$ yields:\n  $$ \\phi_V^\\tau(q,p) = (q, p - Mq\\tau) $$\n\n**Second-Order Strang Splitting:**\nA symmetric second-order method, known as Strang (or leapfrog) splitting, is constructed as:\n$$\n\\Psi_2(h) = \\phi_V^{h/2} \\circ \\phi_T^h \\circ \\phi_V^{h/2}\n$$\nThis composition is symmetric ($\\Psi_2(-h) = (\\Psi_2(h))^{-1}$) and has a local error of order $O(h^3)$, resulting in a global error of order $O(h^2)$.\n\n**Fourth-Order Yoshida Composition:**\nHaruo Yoshida demonstrated that a higher-order symmetric integrator can be constructed by composing a second-order symmetric method. A fourth-order method $\\Psi_4(h)$ is given by:\n$$\n\\Psi_4(h) = \\Psi_2(c_1 h) \\circ \\Psi_2(c_2 h) \\circ \\Psi_2(c_1 h)\n$$\nThe constants $c_1$ and $c_2$ must satisfy $2c_1 + c_2 = 1$ and $2c_1^3 + c_2^3 = 0$. The solution is:\n$$\nc_1 = \\frac{1}{2 - 2^{1/3}}, \\quad c_2 = -\\frac{2^{1/3}}{2 - 2^{1/3}}\n$$\nNumerically, these are $c_1 \\approx 1.35120719$ and $c_2 \\approx -1.70241438$.\nExpanding the composition and combining adjacent $\\phi_V$ flows gives a single-step algorithm for $\\Psi_4(h)$:\n$$\n\\Psi_4(h) = \\phi_V^{d_1 h} \\circ \\phi_T^{e_1 h} \\circ \\phi_V^{d_2 h} \\circ \\phi_T^{e_2 h} \\circ \\phi_V^{d_3 h} \\circ \\phi_T^{e_3 h} \\circ \\phi_V^{d_4 h}\n$$\nwhere the time step coefficients are:\n- For $V$-steps: $d_1 = d_4 = \\frac{c_1}{2}$ and $d_2 = d_3 = \\frac{c_1+c_2}{2}$.\n- For $T$-steps: $e_1 = e_3 = c_1$ and $e_2 = c_2$.\n\n### 3. Numerical Implementation and Error Calculation\n\nThe algorithm proceeds as follows for each test case:\n1.  **Initialization**:\n    - From the test case parameters $(\\omega_1 h, \\omega_2 h)$ and the fixed time step $h=10^{-2}$, calculate the frequencies $\\omega_1$ and $\\omega_2$.\n    - Set the initial state $(q, p)$ to $(q_0, p_0) = \\left((1, -0.5), (0.3, 0.7)\\right)$.\n    - Compute the initial energy $H_0 = H(q_0, p_0)$.\n2.  **Integration**:\n    - Iterate $N = 1000$ times to advance the system from $t=0$ to $t_f = Nh = 10$.\n    - In each iteration, apply the 7-stage Yoshida integrator step using the coefficients derived above and the exact sub-flows $\\phi_T$ and $\\phi_V$. The state $(q, p)$ is updated at each of the 7 stages.\n3.  **Error Computation**:\n    - After $N$ steps, the final numerical state is $(q_N, p_N)$.\n    - Compute the final energy $H_N = H(q_N, p_N)$. The relative energy error is $\\varepsilon_H = |H_N - H_0| / H_0$. Due to the symplectic nature of the integrator, $H_N$ is expected to be very close to $H_0$.\n    - Compute the exact state $(q_{\\text{exact}}(t_f), p_{\\text{exact}}(t_f))$ using the analytical formulas derived in Section 1.\n    - Compute the relative state error $\\varepsilon_X$ using the Euclidean norm ($L_2$-norm) of the difference between the numerical and exact final state vectors, normalized by the norm of the exact final state vector.\n\nThis procedure is repeated for all five test cases, and the resulting pairs $[\\varepsilon_H, \\varepsilon_X]$ are collected for the final output.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of integrating a 2D anisotropic harmonic oscillator\n    using a 4th-order Yoshida symplectic integrator and computes error metrics.\n    \"\"\"\n    \n    # --- Problem Parameters ---\n    h = 1e-2  # Fixed time step\n    N = 1000  # Number of steps\n    q0 = np.array([1.0, -0.5])  # Initial position\n    p0 = np.array([0.3, 0.7])   # Initial momentum\n    \n    # Test cases defined by the pair (omega_1 * h, omega_2 * h)\n    test_cases = [\n        (0.05, 0.05),\n        (0.25, 0.75),\n        (0.75, 0.25),\n        (1.05, 1.05),\n        (1.10, 0.10),\n    ]\n\n    # --- Integrator Coefficients ---\n    # Yoshida 4th-order composition coefficients\n    cbrt2 = 2**(1/3)\n    c1 = 1 / (2 - cbrt2)\n    c2 = 1 - 2 * c1\n    \n    # Time intervals for the 7 stages of one Yoshida step\n    # V-steps (potential, updates momentum)\n    dt_v = np.array([c1 / 2, (c1 + c2) / 2, (c1 + c2) / 2, c1 / 2]) * h\n    # T-steps (kinetic, updates position)\n    dt_t = np.array([c1, c2, c1]) * h\n\n    # --- Main Loop ---\n    results = []\n    for w1h, w2h in test_cases:\n        # Calculate frequencies for the current test case\n        w1 = w1h / h\n        w2 = w2h / h\n        \n        # Matrix M = diag(w1^2, w2^2) for the potential part\n        M = np.diag([w1**2, w2**2])\n\n        # --- Numerical Integration ---\n        # Initialize state for numerical integration\n        q_n = np.copy(q0)\n        p_n = np.copy(p0)\n        \n        # Calculate initial Hamiltonian H(q0, p0)\n        H0 = 0.5 * (p0 @ p0) + 0.5 * (q0 @ (M @ q0))\n        \n        # Propagate for N steps\n        for _ in range(N):\n            # One step of 4th-order Yoshida integrator (7 stages)\n            p_n = p_n - M @ q_n * dt_v[0]  # Stage 1: V-step\n            q_n = q_n + p_n * dt_t[0]      # Stage 2: T-step\n            p_n = p_n - M @ q_n * dt_v[1]  # Stage 3: V-step\n            q_n = q_n + p_n * dt_t[1]      # Stage 4: T-step\n            p_n = p_n - M @ q_n * dt_v[2]  # Stage 5: V-step\n            q_n = q_n + p_n * dt_t[2]      # Stage 6: T-step\n            p_n = p_n - M @ q_n * dt_v[3]  # Stage 7: V-step\n        \n        # Final numerical state (q_N, p_N)\n        q_N, p_N = q_n, p_n\n        \n        # --- Error Calculation ---\n        \n        # 1. Relative Energy Error (eps_H)\n        H_N = 0.5 * (p_N @ p_N) + 0.5 * (q_N @ (M @ q_N))\n        eps_H = np.abs(H_N - H0) / H0 if H0 != 0 else 0.0\n\n        # 2. Relative State Error (eps_X)\n        \n        # Calculate exact solution at final time t_f = N*h\n        t_final = N * h\n        \n        # Component 1\n        c1t, s1t = np.cos(w1 * t_final), np.sin(w1 * t_final)\n        q1_exact = q0[0] * c1t + (p0[0] / w1) * s1t\n        p1_exact = p0[0] * c1t - q0[0] * w1 * s1t\n        \n        # Component 2\n        c2t, s2t = np.cos(w2 * t_final), np.sin(w2 * t_final)\n        q2_exact = q0[1] * c2t + (p0[1] / w2) * s2t\n        p2_exact = p0[1] * c2t - q0[1] * w2 * s2t\n        \n        q_exact = np.array([q1_exact, q2_exact])\n        p_exact = np.array([p1_exact, p2_exact])\n        \n        # Combine into phase-space vectors\n        X_N = np.concatenate((q_N, p_N))\n        X_exact = np.concatenate((q_exact, p_exact))\n        \n        # Calculate relative L2 norm\n        norm_X_exact = np.linalg.norm(X_exact)\n        eps_X = np.linalg.norm(X_N - X_exact) / norm_X_exact if norm_X_exact != 0 else 0.0\n\n        results.append([eps_H, eps_X])\n\n    # --- Final Output ---\n    # Format the results into the required string format \"[[eH1,eX1],[eH2,eX2],...]\"\n    results_str = [f\"[{eH},{eX}]\" for eH, eX in results]\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}