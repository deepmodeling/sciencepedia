{
    "hands_on_practices": [
        {
            "introduction": "理论学习的最佳方式是动手实践。我们从一个基础但至关重要的练习开始：将斯特朗（Strang）分裂法应用于简谐振子。这个练习将引导您手动构建一个二阶辛积分器，并通过分析其单步映射，揭示数值方法如何引入一个与真实频率略有不同的“离散频率”，这是理解几何积分器行为的关键一步。",
            "id": "3766828",
            "problem": "考虑一个单自由度谐振子，其哈密顿量为 $H(q,p)=\\frac{p^{2}}{2}+\\frac{\\omega^{2}q^{2}}{2}$，其中 $q$ 是位置，$p$ 是动量，$\\omega>0$ 是一个常数。将 $H$ 分裂为动能部分 $T(p)=\\frac{p^{2}}{2}$ 和势能部分 $V(q)=\\frac{\\omega^{2}q^{2}}{2}$。使用哈密顿方程以及由 $T$ 和 $V$ 分别生成的精确流，构造时间步长为 $h>0$ 的二阶对称 Strang 分裂（也称为踢-漂移-踢方法），以更新 $(q_{n},p_{n})\\mapsto(q_{n+1},p_{n+1})$。\n\n然后，通过将子流复合为 $(q,p)$ 上的单个线性单步映射，确定该映射对应的平面旋转角 $\\theta$ 以及由 $\\theta=\\tilde{\\omega}h$ 隐式定义的离散频率 $\\tilde{\\omega}$。你的推理过程必须从哈密顿方程及 $T$ 和 $V$ 的精确子流开始，并通过显式复合进行推导。\n\n作为最终答案，请给出离散频率 $\\tilde{\\omega}$ 关于 $h$ 和 $\\omega$ 的闭式解析表达式。将离散频率以弧度每单位时间表示。不要对结果进行近似或四舍五入；请以精确的符号形式给出。",
            "solution": "首先评估问题的有效性。\n\n**步骤 1：提取已知条件**\n- 哈密顿量：$H(q,p)=\\frac{p^{2}}{2}+\\frac{\\omega^{2}q^{2}}{2}$\n- 位置坐标：$q$\n- 动量坐标：$p$\n- 恒定频率：$\\omega > 0$\n- 哈密顿分裂：$H = T+V$\n- 动能部分：$T(p)=\\frac{p^{2}}{2}$\n- 势能部分：$V(q)=\\frac{\\omega^{2}q^{2}}{2}$\n- 数值方法：二阶对称 Strang 分裂 (踢-漂移-踢)\n- 时间步长：$h > 0$\n- 更新映射：$(q_{n},p_{n})\\mapsto(q_{n+1},p_{n+1})$\n- 待求量：单步映射的平面旋转角 $\\theta$ 和由 $\\theta=\\tilde{\\omega}h$ 定义的离散频率 $\\tilde{\\omega}$。\n- 最终答案：$\\tilde{\\omega}$ 关于 $h$ 和 $\\omega$ 的闭式解析表达式。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据、是良定的且客观的。它涉及将一种标准的数值积分技术（Strang 分裂）应用于经典力学中的一个基本模型（简谐振子）。哈密顿方程、可分哈密顿量和辛积分器的概念在几何力学领域是公认的。所有必要的数据和定义都已提供，不存在内部矛盾、歧义或不科学的前提。该问题是哈密顿系统数值方法分析中的一个标准的、非平凡的练习。\n\n**步骤 3：结论与行动**\n该问题有效。将提供一个完整的、有理有据的解答。\n\n谐振子的哈密顿量为 $H(q,p) = \\frac{p^{2}}{2} + \\frac{\\omega^{2}q^{2}}{2}$。它可以分离为一个动能项 $T(p) = \\frac{p^{2}}{2}$ 和一个势能项 $V(q) = \\frac{\\omega^{2}q^{2}}{2}$。\n\n我们首先分别确定对应于 $T(p)$ 和 $V(q)$ 的精确流。\n\n对于动能部分，哈密顿量为 $H_T = T(p)$。哈密顿方程为：\n$$\n\\dot{q} = \\frac{\\partial T}{\\partial p} = p\n$$\n$$\n\\dot{p} = -\\frac{\\partial T}{\\partial q} = 0\n$$\n从 $(q_0, p_0)$ 开始，对这些方程在一个时间间隔 $t$ 上积分，得到：\n$p(t) = p_0$\n$q(t) = q_0 + \\int_{0}^{t} p_0 \\,ds = q_0 + p_0 t$\n$T$ 在时间 $t$ 上的精确流映射，记为 $\\Phi_t^T$，是一个“漂移”：\n$$\n\\Phi_t^T(q,p) = (q+pt, p)\n$$\n\n对于势能部分，哈密顿量为 $H_V = V(q)$。哈密顿方程为：\n$$\n\\dot{q} = \\frac{\\partial V}{\\partial p} = 0\n$$\n$$\n\\dot{p} = -\\frac{\\partial V}{\\partial q} = -\\omega^2 q\n$$\n从 $(q_0, p_0)$ 开始，对这些方程在一个时间间隔 $t$ 上积分，得到：\n$q(t) = q_0$\n$p(t) = p_0 + \\int_{0}^{t} (-\\omega^2 q_0) \\,ds = p_0 - \\omega^2 q_0 t$\n$V$ 在时间 $t$ 上的精确流映射，记为 $\\Phi_t^V$，是一个“踢”：\n$$\n\\Phi_t^V(q,p) = (q, p-\\omega^2 q t)\n$$\n\n被描述为“踢-漂移-踢”方法的二阶对称 Strang 分裂是通过复合这些流来构造的。在一个时间步长 $h$ 上，从 $(q_n, p_n)$ 到 $(q_{n+1}, p_{n+1})$ 的更新由复合映射 $\\Phi_{h/2}^V \\circ \\Phi_h^T \\circ \\Phi_{h/2}^V$ 给出。让我们依次应用这个复合映射。\n\n1. **第一次踢（时间 $h/2$）：** 将 $\\Phi_{h/2}^V$ 应用于 $(q_n, p_n)$。\n$$\n(q', p') = \\Phi_{h/2}^V(q_n, p_n) = \\left(q_n, p_n - \\frac{\\omega^2 q_n h}{2}\\right)\n$$\n\n2. **漂移（时间 $h$）：** 将 $\\Phi_h^T$ 应用于中间状态 $(q', p')$。\n$$\n(q'', p'') = \\Phi_h^T(q', p') = \\left(q' + p'h, p'\\right) = \\left(q_n + \\left(p_n - \\frac{\\omega^2 q_n h}{2}\\right)h, p_n - \\frac{\\omega^2 q_n h}{2}\\right)\n$$\n化简第一个分量得到：\n$$\nq'' = q_n + p_n h - \\frac{\\omega^2 q_n h^2}{2}\n$$\n\n3. **第二次踢（时间 $h/2$）：** 将 $\\Phi_{h/2}^V$ 应用于 $(q'', p'')$ 以得到最终状态 $(q_{n+1}, p_{n+1})$。\n$$\n(q_{n+1}, p_{n+1}) = \\Phi_{h/2}^V(q'', p'') = \\left(q'', p'' - \\frac{\\omega^2 q'' h}{2}\\right)\n$$\n新的位置是 $q_{n+1} = q''$：\n$$\nq_{n+1} = q_n \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + p_n h\n$$\n新的动量是 $p_{n+1} = p'' - \\frac{\\omega^2 q'' h}{2}$：\n$$\np_{n+1} = \\left(p_n - \\frac{\\omega^2 q_n h}{2}\\right) - \\frac{\\omega^2 h}{2}\\left(q_n + p_n h - \\frac{\\omega^2 q_n h^2}{2}\\right)\n$$\n$$\np_{n+1} = p_n - \\frac{\\omega^2 q_n h}{2} - \\frac{\\omega^2 q_n h}{2} - \\frac{\\omega^2 p_n h^2}{2} + \\frac{\\omega^4 q_n h^3}{4}\n$$\n$$\np_{n+1} = p_n \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + q_n \\left(-\\omega^2 h + \\frac{\\omega^4 h^3}{4}\\right)\n$$\n$$\np_{n+1} = q_n \\left(-\\omega^2 h\\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\\right) + p_n \\left(1 - \\frac{\\omega^2 h^2}{2}\\right)\n$$\n\n这个线性更新可以表示为矩阵形式 $(q_{n+1}, p_{n+1})^T = M (q_n, p_n)^T$，其中 $M$ 是单步映射矩阵：\n$$\nM = \\begin{pmatrix} 1 - \\frac{\\omega^2 h^2}{2} & h \\\\ -\\omega^2 h\\left(1 - \\frac{\\omega^2 h^2}{4}\\right) & 1 - \\frac{\\omega^2 h^2}{2} \\end{pmatrix}\n$$\n映射 $M$ 代表了一个离散演化，它近似了精确谐振子在相空间中的连续时间旋转。该映射的稳定性和旋转性质由其特征值决定。特征值 $\\lambda$ 是特征方程 $\\det(M - \\lambda I) = 0$ 的根，即 $\\lambda^2 - \\text{Tr}(M)\\lambda + \\det(M) = 0$。\n\n$M$ 的迹是：\n$$\n\\text{Tr}(M) = \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) = 2 - \\omega^2 h^2\n$$\n$M$ 的行列式是：\n$$\n\\det(M) = \\left(1 - \\frac{\\omega^2 h^2}{2}\\right)^2 - h \\left(-\\omega^2 h\\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\\right)\n$$\n$$\n\\det(M) = \\left(1 - \\omega^2 h^2 + \\frac{\\omega^4 h^4}{4}\\right) + \\omega^2 h^2 \\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\n$$\n$$\n\\det(M) = 1 - \\omega^2 h^2 + \\frac{\\omega^4 h^4}{4} + \\omega^2 h^2 - \\frac{\\omega^4 h^4}{4} = 1\n$$\n正如从辛分裂方法导出的映射所预期的那样，$\\det(M)=1$。\n\n对于一个稳定的离散旋转，特征值必须是单位圆上的一对共轭复数，$\\lambda = e^{\\pm i\\theta}$，其中 $\\theta$ 是每步的旋转角。在这种情况下，矩阵的迹为 $\\text{Tr}(M) = e^{i\\theta} + e^{-i\\theta} = 2\\cos\\theta$。\n令两个关于迹的表达式相等，可得：\n$$\n2\\cos\\theta = 2 - \\omega^2 h^2\n$$\n$$\n\\cos\\theta = 1 - \\frac{\\omega^2 h^2}{2}\n$$\n这定义了数值旋转角 $\\theta$。只要 arccosine 的自变量在 $[-1, 1]$ 区间内，该方法就是稳定的，这要求 $-1 \\le 1 - \\frac{\\omega^2 h^2}{2} \\le 1$。这意味着 $0 \\le \\frac{\\omega^2 h^2}{2} \\le 2$，或 $\\omega^2 h^2 \\le 4$，从而导出稳定性条件 $\\omega h \\le 2$。\n\n题目通过关系 $\\theta = \\tilde{\\omega}h$ 定义了离散频率 $\\tilde{\\omega}$。将此代入我们关于 $\\cos\\theta$ 的表达式中：\n$$\n\\cos(\\tilde{\\omega}h) = 1 - \\frac{\\omega^2 h^2}{2}\n$$\n为了解出 $\\tilde{\\omega}$，我们使用半角恒等式 $\\cos(A) = 1 - 2\\sin^2(A/2)$。令 $A = \\tilde{\\omega}h$：\n$$\n1 - 2\\sin^2\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = 1 - \\frac{\\omega^2 h^2}{2}\n$$\n$$\n2\\sin^2\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\frac{\\omega^2 h^2}{2}\n$$\n$$\n\\sin^2\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\frac{\\omega^2 h^2}{4}\n$$\n对两边取平方根可得：\n$$\n\\sin\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\pm \\frac{\\omega h}{2}\n$$\n为了使数值频率 $\\tilde{\\omega}$ 在 $h \\to 0$ 的极限下与精确频率 $\\omega$ 相对应，我们必须选择正根。对于小自变量，$\\sin(x) \\approx x$，所以 $\\frac{\\tilde{\\omega}h}{2} \\approx \\frac{\\omega h}{2}$，这意味着 $\\tilde{\\omega} \\approx \\omega$。因此，我们取正解：\n$$\n\\sin\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\frac{\\omega h}{2}\n$$\n解出 $\\tilde{\\omega}$ 即可得到离散频率的最终表达式：\n$$\n\\frac{\\tilde{\\omega}h}{2} = \\arcsin\\left(\\frac{\\omega h}{2}\\right)\n$$\n$$\n\\tilde{\\omega} = \\frac{2}{h} \\arcsin\\left(\\frac{\\omega h}{2}\\right)\n$$\n这就是使用 Strang 分裂的谐振子的离散频率的闭式解析表达式。",
            "answer": "$$\n\\boxed{\\frac{2}{h} \\arcsin\\left(\\frac{\\omega h}{2}\\right)}\n$$"
        },
        {
            "introduction": "在构建了分裂格式之后，下一个核心问题是评估其精度。本练习要求您通过泰勒展开，精确计算并比较一阶李-特罗特（Lie-Trotter）方法和二阶斯特朗分裂法的局部截断误差。通过这个分析过程，您将亲身体会到对称组合格式为何能将精度提升一个数量级，并为选择更优的数值方案提供坚实的理论依据。",
            "id": "3766797",
            "problem": "考虑一个可分哈密顿系统，其哈密顿量 $H(q,p)=T(p)+V(q)$ 由 $T(p)=\\frac{p^{2}}{2}$ 和 $V(q)=\\frac{\\omega^{2} q^{2}}{2}$ 给出，其中 $q$ 和 $p$ 是正则坐标，$\\omega>0$ 是一个恒定频率。在单个步长 $h>0$ 内的精确哈密顿流求解常微分方程 (ODE) 组 $\\dot{q}=p$，$\\dot{p}=-\\omega^{2} q$。\n\n定义 Lie-Trotter 分裂法为复合映射 $\\Phi_{\\text{LT}}(h)=\\exp(h L_{T})\\,\\exp(h L_{V})$，以及 Strang (对称) 分裂法为 $\\Phi_{\\text{S}}(h)=\\exp\\!\\big(\\frac{h}{2} L_{T}\\big)\\,\\exp(h L_{V})\\,\\exp\\!\\big(\\frac{h}{2} L_{T}\\big)$，其中 $L_{T}$ 和 $L_{V}$ 分别是与 $T$ 和 $V$ 相关联的刘维尔算子。由 $T$ 在时间 $\\tau$ 内生成的流为 $(q,p)\\mapsto(q+\\tau p,\\,p)$，由 $V$ 在时间 $\\tau$ 内生成的流为 $(q,p)\\mapsto(q,\\,p-\\tau\\,\\omega^{2} q)$。\n\n设 $\\varphi_{H}(h)$ 表示时间 $h$ 内的精确哈密顿流。单步法 $\\Phi(h)$ 的局部截断误差是作用于精确初始数据的数值单步映射与精确流之间的差值，即 $e(h) = \\Phi(h)(q,p) - \\varphi_{H}(h)(q,p)$。\n\n从哈密顿方程和给定的分裂流出发，推导精确单步映射 $\\varphi_{H}(h)$ 以及单步映射 $\\Phi_{\\text{LT}}(h)$ 和 $\\Phi_{\\text{S}}(h)$。然后，通过对小参数 $\\theta=\\omega h$ 进行泰勒展开，计算 Lie-Trotter 和 Strang 方法的局部截断误差 $e_{\\text{LT}}(h)$ 和 $e_{\\text{S}}(h)$，在每个分量中保留截至并包括 $(\\omega h)^{3}$ 阶的所有非零项。请将您的最终答案表示为一个单行矩阵，按顺序罗列 $\\Delta q_{\\text{LT}}$、$\\Delta p_{\\text{LT}}$、$\\Delta q_{\\text{S}}$、$\\Delta p_{\\text{S}}$。无需四舍五入，您的答案必须是关于 $q$、$p$、$\\omega$ 和 $h$ 的解析表达式。",
            "solution": "用户希望解决一个几何力学领域的问题。\n\n### 步骤 1：提取已知条件\n- **哈密顿量**: $H(q,p)=T(p)+V(q)$\n- **动能**: $T(p)=\\frac{p^{2}}{2}$\n- **势能**: $V(q)=\\frac{\\omega^{2} q^{2}}{2}$\n- **正则坐标**: $q$, $p$\n- **常数**: $\\omega>0$\n- **精确流的常微分方程组**: $\\dot{q}=p$, $\\dot{p}=-\\omega^{2} q$\n- **Lie-Trotter 分裂法**: $\\Phi_{\\text{LT}}(h)=\\exp(h L_{T})\\,\\exp(h L_{V})$\n- **Strang 分裂法**: $\\Phi_{\\text{S}}(h)=\\exp\\!\\big(\\frac{h}{2} L_{T}\\big)\\,\\exp(h L_{V})\\,\\exp\\!\\big(\\frac{h}{2} L_{T}\\big)$\n- **刘维尔算子**: $L_{T}$, $L_{V}$\n- **T 的流**: 由 T 在时间 $\\tau$ 内生成的流为 $(q,p)\\mapsto(q+\\tau p,\\,p)$。\n- **V 的流**: 由 V 在时间 $\\tau$ 内生成的流为 $(q,p)\\mapsto(q,\\,p-\\tau\\,\\omega^{2} q)$。\n- **局部截断误差定义**: $e(h) = \\Phi(h)(q,p) - \\varphi_{H}(h)(q,p)$，其中 $\\varphi_{H}(h)$ 是时间 h 内的精确流。\n- **任务**: 推导 $\\varphi_{H}(h)$、$\\Phi_{\\text{LT}}(h)$、$\\Phi_{\\text{S}}(h)$。计算局部截断误差 $e_{\\text{LT}}(h) = (\\Delta q_{\\text{LT}}, \\Delta p_{\\text{LT}})$ 和 $e_{\\text{S}}(h) = (\\Delta q_{\\text{S}}, \\Delta p_{\\text{S}})$，截至并包括 $(\\omega h)^{3}$ 阶。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据指定标准对问题进行验证。\n- **科学依据**：该问题描述了简谐振子，这是经典力学中的一个基本模型。在几何数值积分的框架内，哈密顿量、哈密顿方程以及 Lie-Trotter 和 Strang 分裂法的定义都是标准且正确的。\n- **适定性**：该问题要求推导特定的解析表达式。所有必要的定义和出发点都已给出，并且所要求的计算会导出一个唯一且有意义的解。\n- **客观性**：该问题以精确、形式化的数学语言陈述。它没有歧义和主观论断。\n- **完整性与一致性**：该问题是自洽的。流、分裂法和误差的定义都已明确给出，并且相互一致。\n- **真实性**：该问题是计算物理、几何力学和数值分析专业学生的标准教科书练习题。\n- **结构**：该问题结构良好，引导求解者通过一个逻辑清晰的推导和计算序列。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。这是一个几何力学领域内适定的、科学上合理的、客观的问题。我将继续进行求解。\n\n### 精确流 $\\varphi_{H}(h)$ 的推导\n该系统由哈密顿方程描述：\n$$ \\dot{q} = \\frac{\\partial H}{\\partial p} = p $$\n$$ \\dot{p} = -\\frac{\\partial H}{\\partial q} = -\\omega^2 q $$\n对第一个方程关于时间求导得到 $\\ddot{q} = \\dot{p}$。代入第二个方程，得到简谐运动的二阶常微分方程：\n$$ \\ddot{q} + \\omega^2 q = 0 $$\n$q(t)$ 的通解为 $q(t) = A \\cos(\\omega t) + B \\sin(\\omega t)$。\n由此，我们得到 $p(t) = \\dot{q}(t) = -A\\omega \\sin(\\omega t) + B\\omega \\cos(\\omega t)$。\n应用初始条件 $(q(0), p(0)) = (q_0, p_0)$：\n$q(0) = A = q_0$\n$p(0) = B\\omega = p_0 \\implies B = \\frac{p_0}{\\omega}$\n将 A 和 B 代回，在时间 $t=h$ 时的解为：\n$q(h) = q_0 \\cos(\\omega h) + \\frac{p_0}{\\omega} \\sin(\\omega h)$\n$p(h) = -q_0 \\omega \\sin(\\omega h) + p_0 \\cos(\\omega h)$\n因此，精确单步映射为 $\\varphi_{H}(h)(q_0, p_0) = (q(h), p(h))$。\n\n### Lie-Trotter 映射 $\\Phi_{\\text{LT}}(h)$ 的推导\n映射 $\\Phi_{\\text{LT}}(h)$ 是 V 在时间 h 内的流与 T 在时间 h 内的流的复合。\n设 $(q_0, p_0)$ 为初始状态。\n1. 应用 $\\exp(h L_V)$: $(q_1, p_1) = (q_0, p_0 - h \\omega^2 q_0)$。\n2. 对 $(q_1, p_1)$ 应用 $\\exp(h L_T)$: $(q_f, p_f) = (q_1 + h p_1, p_1)$。\n代入 $(q_1, p_1)$ 的表达式：\n$q_f = q_0 + h (p_0 - h \\omega^2 q_0) = (1 - \\omega^2 h^2) q_0 + h p_0$\n$p_f = p_0 - h \\omega^2 q_0$\n所以，$\\Phi_{\\text{LT}}(h)(q_0, p_0) = ((1 - \\omega^2 h^2) q_0 + h p_0, -h \\omega^2 q_0 + p_0)$。\n\n### Strang 分裂映射 $\\Phi_{\\text{S}}(h)$ 的推导\n映射 $\\Phi_{\\text{S}}(h)$ 是 T 的半步流、V 的整步流和另一个 T 的半步流的复合。\n设 $(q_0, p_0)$ 为初始状态。\n1. 应用 $\\exp(\\frac{h}{2} L_T)$: $(q_1, p_1) = (q_0 + \\frac{h}{2} p_0, p_0)$。\n2. 对 $(q_1, p_1)$ 应用 $\\exp(h L_V)$: $(q_2, p_2) = (q_1, p_1 - h \\omega^2 q_1)$。\n$q_2 = q_1 = q_0 + \\frac{h}{2} p_0$\n$p_2 = p_1 - h \\omega^2 q_1 = p_0 - h \\omega^2 (q_0 + \\frac{h}{2} p_0) = -h \\omega^2 q_0 + (1 - \\frac{h^2 \\omega^2}{2}) p_0$\n3. 对 $(q_2, p_2)$ 应用 $\\exp(\\frac{h}{2} L_T)$: $(q_f, p_f) = (q_2 + \\frac{h}{2} p_2, p_2)$。\n$p_f = p_2 = -h \\omega^2 q_0 + (1 - \\frac{h^2 \\omega^2}{2}) p_0$\n$q_f = q_2 + \\frac{h}{2} p_2 = (q_0 + \\frac{h}{2} p_0) + \\frac{h}{2} (-h \\omega^2 q_0 + (1 - \\frac{h^2 \\omega^2}{2}) p_0)$\n$q_f = q_0 + \\frac{h}{2} p_0 - \\frac{h^2 \\omega^2}{2} q_0 + \\frac{h}{2} p_0 - \\frac{h^3 \\omega^2}{4} p_0$\n$q_f = (1 - \\frac{\\omega^2 h^2}{2}) q_0 + (h - \\frac{\\omega^2 h^3}{4}) p_0$\n所以，$\\Phi_{\\text{S}}(h)(q_0, p_0) = \\left( (1 - \\frac{\\omega^2 h^2}{2}) q_0 + (h - \\frac{\\omega^2 h^3}{4}) p_0, -h \\omega^2 q_0 + (1 - \\frac{\\omega^2 h^2}{2}) p_0 \\right)$。\n\n### 精确流的泰勒展开\n我们将 $q(h)$ 和 $p(h)$ 的精确流解按 h 的幂展开至 $h^3$ 阶。\n我们使用泰勒级数 $\\cos(x) = 1 - \\frac{x^2}{2!} + \\mathcal{O}(x^4)$ 和 $\\sin(x) = x - \\frac{x^3}{3!} + \\mathcal{O}(x^5)$。设 $\\theta = \\omega h$。\n$q_{\\text{exact}}(h) = q_0 \\cos(\\theta) + \\frac{p_0}{\\omega} \\sin(\\theta) = q_0 \\left(1 - \\frac{\\theta^2}{2}\\right) + \\frac{p_0}{\\omega} \\left(\\theta - \\frac{\\theta^3}{6}\\right) + \\mathcal{O}(h^4)$\n$q_{\\text{exact}}(h) = q_0 \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + p_0 \\left(h - \\frac{\\omega^2 h^3}{6}\\right) + \\mathcal{O}(h^4)$\n\n$p_{\\text{exact}}(h) = -q_0 \\omega \\sin(\\theta) + p_0 \\cos(\\theta) = -q_0 \\omega \\left(\\theta - \\frac{\\theta^3}{6}\\right) + p_0 \\left(1 - \\frac{\\theta^2}{2}\\right) + \\mathcal{O}(h^4)$\n$p_{\\text{exact}}(h) = -q_0 \\left(\\omega^2 h - \\frac{\\omega^4 h^3}{6}\\right) + p_0 \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + \\mathcal{O}(h^4)$\n$p_{\\text{exact}}(h) = \\left(-\\omega^2 h + \\frac{\\omega^4 h^3}{6}\\right) q_0 + \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) p_0 + \\mathcal{O}(h^4)$\n\n### 局部截断误差的计算\n局部截断误差为 $e(h) = \\Phi(h)(q_0, p_0) - \\varphi_{H}(h)(q_0, p_0)$。为简洁起见，将 $(q_0, p_0)$ 记为 $(q,p)$。\n\n#### Lie-Trotter 误差 $e_{\\text{LT}}(h) = (\\Delta q_{\\text{LT}}, \\Delta p_{\\text{LT}})$\n$\\Delta q_{\\text{LT}} = q_{\\text{LT}} - q_{\\text{exact}}$\n$\\Delta q_{\\text{LT}} = \\left((1 - \\omega^2 h^2) q + h p\\right) - \\left( (1 - \\frac{\\omega^2 h^2}{2}) q + (h - \\frac{\\omega^2 h^3}{6}) p \\right) + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{LT}} = \\left(1 - \\omega^2 h^2 - 1 + \\frac{\\omega^2 h^2}{2}\\right)q + \\left(h - h + \\frac{\\omega^2 h^3}{6}\\right)p + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{LT}} = -\\frac{\\omega^2 h^2}{2} q + \\frac{\\omega^2 h^3}{6} p$\n\n$\\Delta p_{\\text{LT}} = p_{\\text{LT}} - p_{\\text{exact}}$\n$\\Delta p_{\\text{LT}} = \\left(-h \\omega^2 q + p\\right) - \\left( (-\\omega^2 h + \\frac{\\omega^4 h^3}{6}) q + (1 - \\frac{\\omega^2 h^2}{2}) p \\right) + \\mathcal{O}(h^4)$\n$\\Delta p_{\\text{LT}} = \\left(-h \\omega^2 + \\omega^2 h - \\frac{\\omega^4 h^3}{6}\\right)q + \\left(1 - 1 + \\frac{\\omega^2 h^2}{2}\\right)p + \\mathcal{O}(h^4)$\n$\\Delta p_{\\text{LT}} = -\\frac{\\omega^4 h^3}{6} q + \\frac{\\omega^2 h^2}{2} p$\n\n#### Strang 分裂误差 $e_{\\text{S}}(h) = (\\Delta q_{\\text{S}}, \\Delta p_{\\text{S}})$\n$\\Delta q_{\\text{S}} = q_{\\text{S}} - q_{\\text{exact}}$\n$\\Delta q_{\\text{S}} = \\left( (1 - \\frac{\\omega^2 h^2}{2}) q + (h - \\frac{\\omega^2 h^3}{4}) p \\right) - \\left( (1 - \\frac{\\omega^2 h^2}{2}) q + (h - \\frac{\\omega^2 h^3}{6}) p \\right) + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{S}} = \\left(1 - \\frac{\\omega^2 h^2}{2} - 1 + \\frac{\\omega^2 h^2}{2}\\right)q + \\left(h - \\frac{\\omega^2 h^3}{4} - h + \\frac{\\omega^2 h^3}{6}\\right)p + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{S}} = \\left(-\\frac{1}{4} + \\frac{1}{6}\\right) \\omega^2 h^3 p + \\mathcal{O}(h^4) = \\left(-\\frac{3}{12} + \\frac{2}{12}\\right) \\omega^2 h^3 p + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{S}} = -\\frac{\\omega^2 h^3}{12} p$\n\n$\\Delta p_{\\text{S}} = p_{\\text{S}} - p_{\\text{exact}}$\n$\\Delta p_{\\text{S}} = \\left(-h \\omega^2 q + (1 - \\frac{\\omega^2 h^2}{2}) p \\right) - \\left( (-\\omega^2 h + \\frac{\\omega^4 h^3}{6}) q + (1 - \\frac{\\omega^2 h^2}{2}) p \\right) + \\mathcal{O}(h^4)$\n$\\Delta p_{\\text{S}} = \\left(-h \\omega^2 + \\omega^2 h - \\frac{\\omega^4 h^3}{6}\\right)q + \\left(1 - \\frac{\\omega^2 h^2}{2} - 1 + \\frac{\\omega^2 h^2}{2}\\right)p + \\mathcal{O}(h^4)$\n$\\Delta p_{\\text{S}} = -\\frac{\\omega^4 h^3}{6} q$\n\n这些是截至 $(\\omega h)^3$ 阶的局部截断误差分量。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{\\omega^{2} h^{2}}{2} q + \\frac{\\omega^{2} h^{3}}{6} p & -\\frac{\\omega^{4} h^{3}}{6} q + \\frac{\\omega^{2} h^{2}}{2} p & -\\frac{\\omega^{2} h^{3}}{12} p & -\\frac{\\omega^{4} h^{3}}{6} q\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "现在，让我们将理论分析转化为计算实践。这个练习将指导您实现一个更高级的四阶吉田（Yoshida）组合辛积分器，并用它来求解一个二维各向异性谐振子系统。通过编写代码并在一系列精心设计的测试案例下测量能量误差和状态误差，您不仅能巩固对高阶积分器构造的理解，还能直观地观察到数值步长和系统频率对长期模拟精度的影响。",
            "id": "3766822",
            "problem": "考虑一个二维可分哈密顿系统，其相空间坐标为 $\\left(q,p\\right) \\in \\mathbb{R}^2 \\times \\mathbb{R}^2$，哈密顿量为\n$$\nH(q,p) = T(p) + V(q), \\quad T(p) = \\tfrac{1}{2}\\left(p_1^2 + p_2^2\\right), \\quad V(q) = \\tfrac{1}{2}\\left(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2\\right),\n$$\n其中 $\\omega_1 > 0$ 和 $\\omega_2 > 0$ 为恒定角频率。由哈密顿方程定义的哈密顿向量场为\n$$\n\\dot{q} = \\nabla_p T(p) = p, \\quad \\dot{p} = -\\nabla_q V(q) = -\\operatorname{diag}(\\omega_1^2, \\omega_2^2)\\, q.\n$$\n该系统描述了一个各向异性谐振子，并且可以分离为动能和势能部分。其精确解是在每个坐标平面上分别以角频率 $\\omega_1$ 和 $\\omega_2$ 进行的旋转，且三角函数使用弧度作为角度单位。\n\n设计并实现一个程序，该程序：\n- 通过组合一个对称的二阶 Strang 分裂法，为上述可分哈密顿量构建一个四阶辛积分器，该组合方法由 Haruo Yoshida 提出。程序必须精确地实现动能部分 $T(p)$ 和势能部分 $V(q)$ 的流，并通过对二阶步长的特定四阶组合来组装完整的单步积分器。\n- 使用固定的无量纲时间步长 $h$ 和固定的步数 $N$，从时间 $t=0$ 积分到时间 $t=Nh$。您的数值解必须同时演化位置和动量。\n- 在每个测试案例的最终时间 $t=Nh$ 计算两个误差度量：\n  1. 相对能量误差，定义为\n     $$\n     \\varepsilon_H = \\frac{\\left|H(q_N,p_N) - H(q_0,p_0)\\right|}{H(q_0,p_0)},\n     $$\n     其中 $(q_N,p_N)$ 是 $N$ 步后的数值解，$(q_0,p_0)$ 是初始条件。\n  2. 相对于 $t=Nh$ 时精确解的相对状态误差，定义为\n     $$\n     \\varepsilon_X = \\frac{\\left\\| \\begin{pmatrix} q_N \\\\ p_N \\end{pmatrix} - \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}{\\left\\| \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}.\n     $$\n\n使用的基本原理：\n- 可分哈密顿量的哈密顿方程，以及动能部分和势能部分子流 $\\phi_T^t$ 和 $\\phi_V^t$ 的精确可解性。\n- 可分系统存在对称的二阶 Strang 分裂法，以及存在由对称二阶方法构建的四阶组合方法。\n\n初始条件：\n- 使用 $(q_0, p_0) = \\left((1, -\\tfrac{1}{2}), (0.3, 0.7)\\right)$。\n\n积分器规格：\n- 时间步长 $h$ 是固定的无量纲值；设 $h = 10^{-2}$。\n- 步数 $N$ 是固定的；设 $N = 1000$。\n- 三角函数必须使用以弧度为单位的角度。\n\n测试套件：\n- 通过序对 $(\\omega_1 h, \\omega_2 h)$ 定义以下五个测试案例，确保科学真实性并覆盖不同区域，同时保持在所实现方法的稳定区域内：\n  1. $(0.05, 0.05)$: 相对于两个频率都非常小的步长（近线性区域）。\n  2. $(0.25, 0.75)$: 具有不同尺度的中等各向异性。\n  3. $(0.75, 0.25)$: 交换的各向异性以测试指数的对称性。\n  4. $(1.05, 1.05)$: 接近二阶分裂子步的已知稳定性边界。\n  5. $(1.10, 0.10)$: 极端各向异性，一个频率接近边界。\n\n对于每个测试案例，设置 $\\omega_1 = (\\omega_1 h)/h$ 和 $\\omega_2 = (\\omega_2 h)/h$，同时保持上述指定的固定 $h$。使用对称二阶 Strang 分裂的 Yoshida 四阶组合方法对系统积分 $N$ 步，并计算 $\\varepsilon_H$ 和 $\\varepsilon_X$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素本身都应是一个包含两个浮点数的列表，顺序为 $[\\varepsilon_H, \\varepsilon_X]$，每个测试案例一个，例如：“[[eH1,eX1],[eH2,eX2],...]”。",
            "solution": "## 问题验证\n\n### 步骤 1：提取给定信息\n\n- **哈密顿系统**：\n    - 相空间坐标：$(q,p) \\in \\mathbb{R}^2 \\times \\mathbb{R}^2$。\n    - 哈密顿量：$H(q,p) = T(p) + V(q)$，该哈密顿量是可分的。\n    - 动能：$T(p) = \\tfrac{1}{2}\\left(p_1^2 + p_2^2\\right)$。\n    - 势能：$V(q) = \\tfrac{1}{2}\\left(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2\\right)$，其中 $\\omega_1 > 0$ 和 $\\omega_2 > 0$ 是常数。\n- **哈密顿方程**：\n    - $\\dot{q} = \\nabla_p T(p) = p$。\n    - $\\dot{p} = -\\nabla_q V(q) = -\\operatorname{diag}(\\omega_1^2, \\omega_2^2)\\, q$。\n- **初始条件**：\n    - $(q_0, p_0) = \\left((1, -0.5), (0.3, 0.7)\\right)$。\n- **积分器规格**：\n    - 方法：通过使用 Haruo Yoshida 的组合法，由一个对称二阶 Strang 分裂法构成的四阶辛积分器。\n    - 必须精确实现 $T(p)$ 和 $V(q)$ 的子流。\n    - 时间步长：$h = 10^{-2}$（固定的无量纲值）。\n    - 步数：$N = 1000$。\n    - 三角函数使用弧度。\n- **测试案例**：\n    - 测试案例由序对 $(\\omega_1 h, \\omega_2 h)$ 定义：\n      1. $(0.05, 0.05)$\n      2. $(0.25, 0.75)$\n      3. $(0.75, 0.25)$\n      4. $(1.05, 1.05)$\n      5. $(1.10, 0.10)$\n    - 对每个案例，$\\omega_1 = (\\omega_1 h)/h$ 且 $\\omega_2 = (\\omega_2 h)/h$。\n- **待计算的误差度量**：\n    1. 相对能量误差：$\\varepsilon_H = \\frac{\\left|H(q_N,p_N) - H(q_0,p_0)\\right|}{H(q_0,p_0)}$。\n    2. 相对状态误差：$\\varepsilon_X = \\frac{\\left\\| \\begin{pmatrix} q_N \\\\ p_N \\end{pmatrix} - \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}{\\left\\| \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}$。\n- **最终输出格式**：`[[eH1,eX1],[eH2,eX2],...]`。\n\n### 步骤 2：使用提取的给定信息进行验证\n\n- **科学依据**：该问题描述了二维各向异性谐振子的动力学，这是经典力学中的一个基本模型。哈密顿量的表述是正确的。分裂方法的使用，特别是 Strang 分裂法和 Yoshida 组合法，是哈密顿系统几何数值积分中一种标准的、经过严格验证的技术。所有概念都牢固地建立在物理学和数学的既定原则之上。\n- **适定性**：该问题是适定的。对于任何给定的初始条件，微分方程都有唯一的稳定解。数值方法定义明确，参数（$h$，$N$）已指定。误差度量是标准且明确的。\n- **客观性**：问题使用精确、客观的数学语言陈述。没有主观或基于观点的陈述。\n- **完整性和一致性**：所有必要的信息都已提供。给定信息是自洽且一致的。哈密顿量、初始条件、积分参数、测试案例和期望输出都已明确定义。没有矛盾之处。\n- **其他缺陷**：该问题并非微不足道、隐喻性或不切实际。选择测试案例旨在探究不同的动力学区域和方法的稳定性，这是一项有意义的练习。\n\n### 步骤 3：结论与行动\n\n问题有效。它在科学上是合理的，是适定的，并且是完整的。将构建一个解决方案。\n\n## 解决方案\n\n此问题的解决方案包括三个主要部分：推导用于验证的精确解析解，构建指定的四阶辛积分器，以及实现一个数值程序来为给定的测试案例计算所需的误差度量。\n\n### 1. 各向异性谐振子的精确解\n\n哈密顿量 $H(q, p) = \\frac{1}{2}(p_1^2 + p_2^2) + \\frac{1}{2}(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2)$ 可分离为两个独立的一维谐振子，每个坐标一个。哈密顿方程为：\n$$\n\\dot{q}_i = p_i, \\quad \\dot{p}_i = -\\omega_i^2 q_i, \\quad \\text{for } i=1, 2.\n$$\n将 $\\dot{q}_i$ 对时间求导，得到二阶常微分方程 $\\ddot{q}_i + \\omega_i^2 q_i = 0$。给定在 $t=0$ 时的初始条件 $(q_{i,0}, p_{i,0})$，每个坐标 $i$ 的唯一解是：\n$$\nq_i(t) = q_{i,0} \\cos(\\omega_i t) + \\frac{p_{i,0}}{\\omega_i} \\sin(\\omega_i t)\n$$\n$$\np_i(t) = \\dot{q}_i(t) = p_{i,0} \\cos(\\omega_i t) - q_{i,0} \\omega_i \\sin(\\omega_i t)\n$$\n这个精确解将在最终时间 $t_f = Nh$ 用于计算状态误差 $\\varepsilon_X$。\n\n### 2. 四阶辛积分器\n\n辛积分器旨在保持相空间的辛结构，这带来了优异的长期能量守恒特性。对于可分哈密顿量 $H = T(p) + V(q)$，总流可以通过组合仅由 $T(p)$ 和 $V(q)$ 控制的子系统的精确流来近似。\n\n**精确子流：**\n令 $\\phi_{\\cdot}^{\\tau}$ 表示时间间隔 $\\tau$ 内的精确流。\n- **$T(p)$ 的流**：哈密顿方程为 $\\dot{q} = \\nabla_p T(p) = p$ 和 $\\dot{p} = 0$。在一个时间步长 $\\tau$ 上积分得到：\n  $$ \\phi_T^\\tau(q,p) = (q + p\\tau, p) $$\n- **$V(q)$ 的流**：哈密顿方程为 $\\dot{q} = 0$ 和 $\\dot{p} = -\\nabla_q V(q) = -M q$，其中 $M = \\operatorname{diag}(\\omega_1^2, \\omega_2^2)$。在一个时间步长 $\\tau$ 上积分得到：\n  $$ \\phi_V^\\tau(q,p) = (q, p - Mq\\tau) $$\n\n**二阶 Strang 分裂法：**\n一种对称的二阶方法，称为 Strang（或蛙跳）分裂法，其构造如下：\n$$\n\\Psi_2(h) = \\phi_V^{h/2} \\circ \\phi_T^h \\circ \\phi_V^{h/2}\n$$\n这种组合是对称的（$\\Psi_2(-h) = (\\Psi_2(h))^{-1}$），其局部误差为 $O(h^3)$ 阶，导致全局误差为 $O(h^2)$ 阶。\n\n**四阶 Yoshida 组合法：**\nHaruo Yoshida 证明，可以通过组合一个二阶对称方法来构建一个更高阶的对称积分器。一个四阶方法 $\\Psi_4(h)$ 由下式给出：\n$$\n\\Psi_4(h) = \\Psi_2(c_1 h) \\circ \\Psi_2(c_2 h) \\circ \\Psi_2(c_1 h)\n$$\n常数 $c_1$ 和 $c_2$ 必须满足 $2c_1 + c_2 = 1$ 和 $2c_1^3 + c_2^3 = 0$。解为：\n$$\nc_1 = \\frac{1}{2 - 2^{1/3}}, \\quad c_2 = -\\frac{2^{1/3}}{2 - 2^{1/3}}\n$$\n其数值约为 $c_1 \\approx 1.35120719$ 和 $c_2 \\approx -1.70241438$。\n展开该组合，一个完整的 $\\Psi_4(h)$ 步由一个七阶段的 V-T-V-T-V-T-V 序列构成。各阶段的步长乘以 $h$ 后为：\n- T-步 (drift): $(c_1 h, c_2 h, c_1 h)$\n- V-步 (kick): $(c_1 h/2, (c_1+c_2)h/2, (c_1+c_2)h/2, c_1 h/2)$\n\n### 3. 数值实现与误差计算\n\n对于每个测试案例，算法按以下步骤进行：\n1.  **初始化**：\n    - 根据测试案例参数 $(\\omega_1 h, \\omega_2 h)$ 和固定时间步长 $h=10^{-2}$，计算频率 $\\omega_1$ 和 $\\omega_2$。\n    - 将初始状态 $(q, p)$ 设置为 $(q_0, p_0) = \\left((1, -0.5), (0.3, 0.7)\\right)$。\n    - 计算初始能量 $H_0 = H(q_0, p_0)$。\n2.  **积分**：\n    - 迭代 $N = 1000$ 次，将系统从 $t=0$ 推进到 $t_f = Nh = 10$。\n    - 在每次迭代中，使用上面推导的系数和精确子流 $\\phi_T$ 和 $\\phi_V$ 来应用 7 阶段的 Yoshida 积分器步长。状态 $(q, p)$ 在 7 个阶段中的每一个阶段都会更新。\n3.  **误差计算**：\n    - $N$ 步后，最终的数值状态为 $(q_N, p_N)$。\n    - 计算最终能量 $H_N = H(q_N, p_N)$。相对能量误差为 $\\varepsilon_H = |H_N - H_0| / H_0$。由于积分器的辛性质，$H_N$ 预计会非常接近 $H_0$。\n    - 使用第 1 节中推导的解析公式计算精确状态 $(q_{\\text{exact}}(t_f), p_{\\text{exact}}(t_f))$。\n    - 使用数值最终状态向量与精确最终状态向量之差的欧几里得范数（$L_2$-范数），并除以精确最终状态向量的范数，来计算相对状态误差 $\\varepsilon_X$。\n\n对所有五个测试案例重复此过程，并收集所得的序对 $[\\varepsilon_H, \\varepsilon_X]$ 用于最终输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of integrating a 2D anisotropic harmonic oscillator\n    using a 4th-order Yoshida symplectic integrator and computes error metrics.\n    \"\"\"\n    \n    # --- Problem Parameters ---\n    h = 1e-2  # Fixed time step\n    N = 1000  # Number of steps\n    q0 = np.array([1.0, -0.5])  # Initial position\n    p0 = np.array([0.3, 0.7])   # Initial momentum\n    \n    # Test cases defined by the pair (omega_1 * h, omega_2 * h)\n    test_cases = [\n        (0.05, 0.05),\n        (0.25, 0.75),\n        (0.75, 0.25),\n        (1.05, 1.05),\n        (1.10, 0.10),\n    ]\n\n    # --- Integrator Coefficients ---\n    # Yoshida 4th-order composition coefficients\n    cbrt2 = 2**(1/3)\n    c1 = 1 / (2 - cbrt2)\n    c2 = 1 - 2 * c1\n    \n    # Time intervals for the 7 stages of one Yoshida step\n    # V-steps (potential, updates momentum)\n    dt_v = np.array([c1 / 2, (c1 + c2) / 2, (c1 + c2) / 2, c1 / 2]) * h\n    # T-steps (kinetic, updates position)\n    dt_t = np.array([c1, c2, c1]) * h\n\n    # --- Main Loop ---\n    results = []\n    for w1h, w2h in test_cases:\n        # Calculate frequencies for the current test case\n        w1 = w1h / h\n        w2 = w2h / h\n        \n        # Matrix M = diag(w1^2, w2^2) for the potential part\n        M = np.diag([w1**2, w2**2])\n\n        # --- Numerical Integration ---\n        # Initialize state for numerical integration\n        q_n = np.copy(q0)\n        p_n = np.copy(p0)\n        \n        # Calculate initial Hamiltonian H(q0, p0)\n        H0 = 0.5 * (p0 @ p0) + 0.5 * (q0 @ (M @ q0))\n        \n        # Propagate for N steps\n        for _ in range(N):\n            # One step of 4th-order Yoshida integrator (7 stages)\n            p_n = p_n - M @ q_n * dt_v[0]  # Stage 1: V-step\n            q_n = q_n + p_n * dt_t[0]      # Stage 2: T-step\n            p_n = p_n - M @ q_n * dt_v[1]  # Stage 3: V-step\n            q_n = q_n + p_n * dt_t[1]      # Stage 4: T-step\n            p_n = p_n - M @ q_n * dt_v[2]  # Stage 5: V-step\n            q_n = q_n + p_n * dt_t[2]      # Stage 6: T-step\n            p_n = p_n - M @ q_n * dt_v[3]  # Stage 7: V-step\n        \n        # Final numerical state (q_N, p_N)\n        q_N, p_N = q_n, p_n\n        \n        # --- Error Calculation ---\n        \n        # 1. Relative Energy Error (eps_H)\n        H_N = 0.5 * (p_N @ p_N) + 0.5 * (q_N @ (M @ q_N))\n        eps_H = np.abs(H_N - H0) / H0 if H0 != 0 else 0.0\n\n        # 2. Relative State Error (eps_X)\n        \n        # Calculate exact solution at final time t_f = N*h\n        t_final = N * h\n        \n        # Component 1\n        c1t, s1t = np.cos(w1 * t_final), np.sin(w1 * t_final)\n        q1_exact = q0[0] * c1t + (p0[0] / w1) * s1t if w1 != 0 else q0[0] + p0[0] * t_final\n        p1_exact = p0[0] * c1t - q0[0] * w1 * s1t if w1 != 0 else p0[0]\n        \n        # Component 2\n        c2t, s2t = np.cos(w2 * t_final), np.sin(w2 * t_final)\n        q2_exact = q0[1] * c2t + (p0[1] / w2) * s2t if w2 != 0 else q0[1] + p0[1] * t_final\n        p2_exact = p0[1] * c2t - q0[1] * w2 * s2t if w2 != 0 else p0[1]\n        \n        q_exact = np.array([q1_exact, q2_exact])\n        p_exact = np.array([p1_exact, p2_exact])\n        \n        # Combine into phase-space vectors\n        X_N = np.concatenate((q_N, p_N))\n        X_exact = np.concatenate((q_exact, p_exact))\n        \n        # Calculate relative L2 norm\n        norm_X_exact = np.linalg.norm(X_exact)\n        eps_X = np.linalg.norm(X_N - X_exact) / norm_X_exact if norm_X_exact != 0 else 0.0\n\n        results.append([eps_H, eps_X])\n\n    # --- Final Output ---\n    # Format the results into the required string format \"[[eH1,eX1],[eH2,eX2],...]\"\n    results_str = [f\"[{eH},{eX}]\" for eH, eX in results]\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}