{
    "hands_on_practices": [
        {
            "introduction": "This first exercise provides foundational practice in constructing a splitting method from first principles. By applying the symmetric Strang splitting to the simple harmonic oscillator, you will derive the explicit one-step update map. This process reveals how the numerical integrator approximates the continuous rotational dynamics in phase space and allows you to calculate the resulting \"discrete frequency,\" a crucial metric for understanding the method's long-term behavior .",
            "id": "3766828",
            "problem": "Consider the one-degree-of-freedom harmonic oscillator with Hamiltonian $H(q,p)=\\frac{p^{2}}{2}+\\frac{\\omega^{2}q^{2}}{2}$, where $q$ is position, $p$ is momentum, and $\\omega>0$ is a constant. Let $H$ be split into the kinetic part $T(p)=\\frac{p^{2}}{2}$ and the potential part $V(q)=\\frac{\\omega^{2}q^{2}}{2}$. Using Hamilton’s equations and the exact flows generated separately by $T$ and $V$, construct the second-order symmetric Strang splitting (also called the kick–drift–kick method) with time step $h>0$ to update $(q_{n},p_{n})\\mapsto(q_{n+1},p_{n+1})$.\n\nThen, by composing the subflows into a single linear one-step map on $(q,p)$, determine the corresponding planar rotation angle $\\theta$ of this map and the associated discrete frequency $\\tilde{\\omega}$ defined implicitly by $\\theta=\\tilde{\\omega}h$. Your reasoning must start from Hamilton’s equations and the exact subflows of $T$ and $V$, and proceed by explicit composition.\n\nAs your final answer, report the discrete frequency $\\tilde{\\omega}$ as a closed-form analytic expression in terms of $h$ and $\\omega$. Express the discrete frequency in radians per unit time. Do not approximate or round the result; give it in exact symbolic form.",
            "solution": "The problem is first assessed for validity.\n\n**Step 1: Extract Givens**\n- Hamiltonian: $H(q,p)=\\frac{p^{2}}{2}+\\frac{\\omega^{2}q^{2}}{2}$\n- Position coordinate: $q$\n- Momentum coordinate: $p$\n- Constant frequency: $\\omega > 0$\n- Hamiltonian splitting: $H = T+V$\n- Kinetic part: $T(p)=\\frac{p^{2}}{2}$\n- Potential part: $V(q)=\\frac{\\omega^{2}q^{2}}{2}$\n- Numerical method: Second-order symmetric Strang splitting (kick–drift–kick)\n- Time step: $h > 0$\n- Update map: $(q_{n},p_{n})\\mapsto(q_{n+1},p_{n+1})$\n- Required quantities: The planar rotation angle $\\theta$ of the one-step map and the discrete frequency $\\tilde{\\omega}$ defined by $\\theta=\\tilde{\\omega}h$.\n- Final answer: A closed-form analytic expression for $\\tilde{\\omega}$ in terms of $h$ and $\\omega$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It concerns the application of a standard numerical integration technique (Strang splitting) to a fundamental model in classical mechanics (the simple harmonic oscillator). The concepts of Hamilton's equations, separable Hamiltonians, and symplectic integrators are well-established in the field of geometric mechanics. All necessary data and definitions are provided, and there are no internal contradictions, ambiguities, or scientifically unsound premises. The problem is a standard, non-trivial exercise in the analysis of numerical methods for Hamiltonian systems.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete, reasoned solution will be provided.\n\nThe Hamiltonian for the harmonic oscillator is $H(q,p) = \\frac{p^{2}}{2} + \\frac{\\omega^{2}q^{2}}{2}$. This is separable into a kinetic energy term $T(p) = \\frac{p^{2}}{2}$ and a potential energy term $V(q) = \\frac{\\omega^{2}q^{2}}{2}$.\n\nWe first determine the exact flows corresponding to $T(p)$ and $V(q)$ individually.\n\nFor the kinetic part, the Hamiltonian is $H_T = T(p)$. Hamilton's equations are:\n$$\n\\dot{q} = \\frac{\\partial T}{\\partial p} = p\n$$\n$$\n\\dot{p} = -\\frac{\\partial T}{\\partial q} = 0\n$$\nIntegrating these equations over a time interval $t$ starting from $(q_0, p_0)$ yields:\n$p(t) = p_0$\n$q(t) = q_0 + \\int_{0}^{t} p_0 \\,ds = q_0 + p_0 t$\nThe exact flow map for $T$ over a time $t$, denoted $\\Phi_t^T$, is a \"drift\":\n$$\n\\Phi_t^T(q,p) = (q+pt, p)\n$$\n\nFor the potential part, the Hamiltonian is $H_V = V(q)$. Hamilton's equations are:\n$$\n\\dot{q} = \\frac{\\partial V}{\\partial p} = 0\n$$\n$$\n\\dot{p} = -\\frac{\\partial V}{\\partial q} = -\\omega^2 q\n$$\nIntegrating these equations over a time interval $t$ starting from $(q_0, p_0)$ yields:\n$q(t) = q_0$\n$p(t) = p_0 + \\int_{0}^{t} (-\\omega^2 q_0) \\,ds = p_0 - \\omega^2 q_0 t$\nThe exact flow map for $V$ over a time $t$, denoted $\\Phi_t^V$, is a \"kick\":\n$$\n\\Phi_t^V(q,p) = (q, p-\\omega^2 q t)\n$$\n\nThe second-order symmetric Strang splitting, described as a \"kick-drift-kick\" method, is constructed by composing these flows. The update from $(q_n, p_n)$ to $(q_{n+1}, p_{n+1})$ over a time step $h$ is given by the composition $\\Phi_{h/2}^V \\circ \\Phi_h^T \\circ \\Phi_{h/2}^V$. Let's apply this composition sequentially.\n\n$1$. **First kick (time $h/2$):** Apply $\\Phi_{h/2}^V$ to $(q_n, p_n)$.\n$$\n(q', p') = \\Phi_{h/2}^V(q_n, p_n) = \\left(q_n, p_n - \\frac{\\omega^2 q_n h}{2}\\right)\n$$\n\n$2$. **Drift (time $h$):** Apply $\\Phi_h^T$ to the intermediate state $(q', p')$.\n$$\n(q'', p'') = \\Phi_h^T(q', p') = \\left(q' + p'h, p'\\right) = \\left(q_n + \\left(p_n - \\frac{\\omega^2 q_n h}{2}\\right)h, p_n - \\frac{\\omega^2 q_n h}{2}\\right)\n$$\nSimplifying the first component gives:\n$$\nq'' = q_n + p_n h - \\frac{\\omega^2 q_n h^2}{2} = q_n\\left(1-\\frac{\\omega^2h^2}{2}\\right) + p_n h\n$$\n\n$3$. **Second kick (time $h/2$):** Apply $\\Phi_{h/2}^V$ to $(q'', p'')$ to get the final state $(q_{n+1}, p_{n+1})$.\n$$\n(q_{n+1}, p_{n+1}) = \\Phi_{h/2}^V(q'', p'') = \\left(q'', p'' - \\frac{\\omega^2 q'' h}{2}\\right)\n$$\nThe new position is $q_{n+1} = q''$:\n$$\nq_{n+1} = q_n \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + p_n h\n$$\nThe new momentum is $p_{n+1} = p'' - \\frac{\\omega^2 q'' h}{2}$:\n$$\np_{n+1} = \\left(p_n - \\frac{\\omega^2 q_n h}{2}\\right) - \\frac{\\omega^2 h}{2}\\left(q_n\\left(1-\\frac{\\omega^2h^2}{2}\\right) + p_n h\\right)\n$$\n$$\np_{n+1} = p_n - \\frac{\\omega^2 q_n h}{2} - \\frac{\\omega^2 q_n h}{2}\\left(1-\\frac{\\omega^2h^2}{2}\\right) - \\frac{\\omega^2 p_n h^2}{2}\n$$\n$$\np_{n+1} = p_n\\left(1 - \\frac{\\omega^2 h^2}{2}\\right) - \\frac{\\omega^2 q_n h}{2} - \\frac{\\omega^2 q_n h}{2} + \\frac{\\omega^4 q_n h^3}{4}\n$$\n$$\np_{n+1} = p_n \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + q_n \\left(-\\omega^2 h + \\frac{\\omega^4 h^3}{4}\\right)\n$$\n$$\np_{n+1} = q_n \\left(-\\omega^2 h\\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\\right) + p_n \\left(1 - \\frac{\\omega^2 h^2}{2}\\right)\n$$\n\nThis linear update can be expressed in matrix form as $(q_{n+1}, p_{n+1})^T = M (q_n, p_n)^T$, where $M$ is the one-step map:\n$$\nM = \\begin{pmatrix} 1 - \\frac{\\omega^2 h^2}{2} & h \\\\ -\\omega^2 h\\left(1 - \\frac{\\omega^2 h^2}{4}\\right) & 1 - \\frac{\\omega^2 h^2}{2} \\end{pmatrix}\n$$\nThe map $M$ represents a discrete evolution that approximates the continuous-time rotation in phase space of the exact harmonic oscillator. The stability and rotational properties of this map are determined by its eigenvalues. The eigenvalues $\\lambda$ are the roots of the characteristic equation $\\det(M - \\lambda I) = 0$, which is $\\lambda^2 - \\text{Tr}(M)\\lambda + \\det(M) = 0$.\n\nThe trace of $M$ is:\n$$\n\\text{Tr}(M) = \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) = 2 - \\omega^2 h^2\n$$\nThe determinant of $M$ is:\n$$\n\\det(M) = \\left(1 - \\frac{\\omega^2 h^2}{2}\\right)^2 - h \\left(-\\omega^2 h\\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\\right)\n$$\n$$\n\\det(M) = \\left(1 - \\omega^2 h^2 + \\frac{\\omega^4 h^4}{4}\\right) + \\omega^2 h^2 \\left(1 - \\frac{\\omega^2 h^2}{4}\\right)\n$$\n$$\n\\det(M) = 1 - \\omega^2 h^2 + \\frac{\\omega^4 h^4}{4} + \\omega^2 h^2 - \\frac{\\omega^4 h^4}{4} = 1\n$$\nAs expected for a map derived from a symplectic splitting method, $\\det(M)=1$.\n\nFor a stable discrete rotation, the eigenvalues must be a complex conjugate pair on the unit circle, $\\lambda = e^{\\pm i\\theta}$, where $\\theta$ is the rotation angle per step. In this case, the trace of the matrix is $\\text{Tr}(M) = e^{i\\theta} + e^{-i\\theta} = 2\\cos\\theta$.\nEquating the two expressions for the trace gives:\n$$\n2\\cos\\theta = 2 - \\omega^2 h^2\n$$\n$$\n\\cos\\theta = 1 - \\frac{\\omega^2 h^2}{2}\n$$\nThis defines the numerical rotation angle $\\theta$. The method is stable as long as the argument of the arccosine is in $[-1, 1]$, which requires $-1 \\le 1 - \\frac{\\omega^2 h^2}{2} \\le 1$. This implies $0 \\le \\frac{\\omega^2 h^2}{2} \\le 2$, or $\\omega^2 h^2 \\le 4$, leading to the stability condition $\\omega h \\le 2$.\n\nThe problem defines the discrete frequency $\\tilde{\\omega}$ via the relation $\\theta = \\tilde{\\omega}h$. Substituting this into our expression for $\\cos\\theta$:\n$$\n\\cos(\\tilde{\\omega}h) = 1 - \\frac{\\omega^2 h^2}{2}\n$$\nTo solve for $\\tilde{\\omega}$, we use the half-angle identity $\\cos(A) = 1 - 2\\sin^2(A/2)$. Let $A = \\tilde{\\omega}h$:\n$$\n1 - 2\\sin^2\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = 1 - \\frac{\\omega^2 h^2}{2}\n$$\n$$\n2\\sin^2\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\frac{\\omega^2 h^2}{2}\n$$\n$$\n\\sin^2\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\frac{\\omega^2 h^2}{4}\n$$\nTaking the square root of both sides gives:\n$$\n\\sin\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\pm \\frac{\\omega h}{2}\n$$\nFor the numerical frequency $\\tilde{\\omega}$ to correspond to the exact frequency $\\omega$ in the limit $h \\to 0$, we must choose the positive root. For small arguments, $\\sin(x) \\approx x$, so $\\frac{\\tilde{\\omega}h}{2} \\approx \\frac{\\omega h}{2}$, which implies $\\tilde{\\omega} \\approx \\omega$. Thus, we take the positive solution:\n$$\n\\sin\\left(\\frac{\\tilde{\\omega}h}{2}\\right) = \\frac{\\omega h}{2}\n$$\nSolving for $\\tilde{\\omega}$ yields the final expression for the discrete frequency:\n$$\n\\frac{\\tilde{\\omega}h}{2} = \\arcsin\\left(\\frac{\\omega h}{2}\\right)\n$$\n$$\n\\tilde{\\omega} = \\frac{2}{h} \\arcsin\\left(\\frac{\\omega h}{2}\\right)\n$$\nThis is the closed-form analytic expression for the discrete frequency of the Strang-split harmonic oscillator.",
            "answer": "$$\n\\boxed{\\frac{2}{h} \\arcsin\\left(\\frac{\\omega h}{2}\\right)}\n$$"
        },
        {
            "introduction": "After building an integrator, the next crucial step is to analyze its accuracy. This exercise guides you through a formal derivation of the local truncation error for both the first-order Lie-Trotter and second-order Strang splitting methods. By performing a Taylor series analysis, you will directly see why higher-order methods are more efficient and gain a concrete understanding of how the error depends on the step size $h$ and the system's frequency $\\omega$ .",
            "id": "3766797",
            "problem": "Consider the separable Hamiltonian system with Hamiltonian $H(q,p)=T(p)+V(q)$ given by $T(p)=\\frac{p^{2}}{2}$ and $V(q)=\\frac{\\omega^{2} q^{2}}{2}$, where $q$ and $p$ are canonical coordinates and $\\omega>0$ is a constant frequency. The exact Hamiltonian flow over one step $h>0$ solves the ordinary differential equation (ODE) system $\\dot{q}=p$, $\\dot{p}=-\\omega^{2} q$.\n\nDefine the Lie–Trotter splitting method as the composition $\\Phi_{\\text{LT}}(h)=\\exp(h L_{T})\\,\\exp(h L_{V})$ and the Strang (symmetric) splitting method as $\\Phi_{\\text{S}}(h)=\\exp\\!\\big(\\frac{h}{2} L_{T}\\big)\\,\\exp(h L_{V})\\,\\exp\\!\\big(\\frac{h}{2} L_{T}\\big)$, where $L_{T}$ and $L_{V}$ are the Liouville operators associated with $T$ and $V$, respectively. The flow generated by $T$ over time $\\tau$ is $(q,p)\\mapsto(q+\\tau p,\\,p)$ and the flow generated by $V$ over time $\\tau$ is $(q,p)\\mapsto(q,\\,p-\\tau\\,\\omega^{2} q)$.\n\nLet $\\varphi_{H}(h)$ denote the exact Hamiltonian flow over time $h$. The local truncation error of a one-step method $\\Phi(h)$ is the difference between the numerical one-step map applied to the exact initial data and the exact flow, i.e., $e(h) = \\Phi(h)(q,p) - \\varphi_{H}(h)(q,p)$.\n\nStarting from Hamilton’s equations and the stated split flows, derive the exact one-step map $\\varphi_{H}(h)$ and the one-step maps $\\Phi_{\\text{LT}}(h)$ and $\\Phi_{\\text{S}}(h)$. Then, by a Taylor expansion in the small parameter $\\theta=\\omega h$, compute the local truncation error $e_{\\text{LT}}(h)$ and $e_{\\text{S}}(h)$ for Lie–Trotter and Strang, respectively, retaining all nonzero terms up to and including order $(\\omega h)^{3}$ in each component. Present your final answer as a single row matrix listing $\\Delta q_{\\text{LT}}$, $\\Delta p_{\\text{LT}}$, $\\Delta q_{\\text{S}}$, $\\Delta p_{\\text{S}}$ in that order. No rounding is required, and your answer must be an analytic expression in $q$, $p$, $\\omega$, and $h$.",
            "solution": "The user wants to solve a problem in the field of geometric mechanics.\n\n### Step 1: Extract Givens\n- **Hamiltonian**: $H(q,p)=T(p)+V(q)$\n- **Kinetic Energy**: $T(p)=\\frac{p^{2}}{2}$\n- **Potential Energy**: $V(q)=\\frac{\\omega^{2} q^{2}}{2}$\n- **Canonical Coordinates**: $q$, $p$\n- **Constant**: $\\omega>0$\n- **Exact Flow ODEs**: $\\dot{q}=p$, $\\dot{p}=-\\omega^{2} q$\n- **Lie–Trotter Splitting Method**: $\\Phi_{\\text{LT}}(h)=\\exp(h L_{T})\\,\\exp(h L_{V})$\n- **Strang Splitting Method**: $\\Phi_{\\text{S}}(h)=\\exp\\!\\big(\\frac{h}{2} L_{T}\\big)\\,\\exp(h L_{V})\\,\\exp\\!\\big(\\frac{h}{2} L_{T}\\big)$\n- **Liouville Operators**: $L_{T}$, $L_{V}$\n- **Flow of T**: The flow generated by $T$ over time $\\tau$ is $(q,p)\\mapsto(q+\\tau p,\\,p)$.\n- **Flow of V**: The flow generated by $V$ over time $\\tau$ is $(q,p)\\mapsto(q,\\,p-\\tau\\,\\omega^{2} q)$.\n- **Local Truncation Error Definition**: $e(h) = \\Phi(h)(q,p) - \\varphi_{H}(h)(q,p)$, where $\\varphi_{H}(h)$ is the exact flow over time $h$.\n- **Task**: Derive $\\varphi_{H}(h)$, $\\Phi_{\\text{LT}}(h)$, $\\Phi_{\\text{S}}(h)$. Compute local truncation errors $e_{\\text{LT}}(h) = (\\Delta q_{\\text{LT}}, \\Delta p_{\\text{LT}})$ and $e_{\\text{S}}(h) = (\\Delta q_{\\text{S}}, \\Delta p_{\\text{S}})$ up to and including order $(\\omega h)^{3}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is subjected to validation against the specified criteria.\n- **Scientifically Grounded**: The problem describes the simple harmonic oscillator, a fundamental model in classical mechanics. The Hamiltonian, Hamilton's equations, and the definitions of Lie-Trotter and Strang splitting methods are standard and correct within the framework of geometric numerical integration.\n- **Well-Posed**: The problem asks for the derivation of specific analytical expressions. All necessary definitions and starting points are provided, and the requested calculations lead to a unique and meaningful solution.\n- **Objective**: The problem is stated in precise, formal mathematical language. It is free from ambiguity and subjective claims.\n- **Completeness and Consistency**: The problem is self-contained. The definitions of the flows, the splitting methods, and the error are all explicitly provided and are mutually consistent.\n- **Realism**: The problem is a standard textbook exercise for students of computational physics, geometric mechanics, and numerical analysis.\n- **Structure**: The problem is well-structured, guiding the solver through a logical sequence of derivations and calculations.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is a well-posed, scientifically sound, and objective question in the field of geometric mechanics. I will proceed with the solution.\n\n### Derivation of the Exact Flow $\\varphi_{H}(h)$\nThe system is described by Hamilton's equations:\n$$ \\dot{q} = \\frac{\\partial H}{\\partial p} = p $$\n$$ \\dot{p} = -\\frac{\\partial H}{\\partial q} = -\\omega^2 q $$\nDifferentiating the first equation with respect to time gives $\\ddot{q} = \\dot{p}$. Substituting the second equation yields the second-order ordinary differential equation for simple harmonic motion:\n$$ \\ddot{q} + \\omega^2 q = 0 $$\nThe general solution for $q(t)$ is $q(t) = A \\cos(\\omega t) + B \\sin(\\omega t)$.\nFrom this, we find $p(t) = \\dot{q}(t) = -A\\omega \\sin(\\omega t) + B\\omega \\cos(\\omega t)$.\nApplying the initial conditions $(q(0), p(0)) = (q_0, p_0)$:\n$q(0) = A = q_0$\n$p(0) = B\\omega = p_0 \\implies B = \\frac{p_0}{\\omega}$\nSubstituting $A$ and $B$ back, the solution at time $t=h$ is:\n$q(h) = q_0 \\cos(\\omega h) + \\frac{p_0}{\\omega} \\sin(\\omega h)$\n$p(h) = -q_0 \\omega \\sin(\\omega h) + p_0 \\cos(\\omega h)$\nThus, the exact one-step map is $\\varphi_{H}(h)(q_0, p_0) = (q(h), p(h))$.\n\n### Derivation of the Lie-Trotter Map $\\Phi_{\\text{LT}}(h)$\nThe map $\\Phi_{\\text{LT}}(h)$ is the composition of the flow for $V$ over time $h$ followed by the flow for $T$ over time $h$.\nLet $(q_0, p_0)$ be the initial state.\n$1$. Apply $\\exp(h L_V)$: $(q_1, p_1) = (q_0, p_0 - h \\omega^2 q_0)$.\n$2$. Apply $\\exp(h L_T)$ to $(q_1, p_1)$: $(q_f, p_f) = (q_1 + h p_1, p_1)$.\nSubstituting the expressions for $(q_1, p_1)$:\n$q_f = q_0 + h (p_0 - h \\omega^2 q_0) = (1 - \\omega^2 h^2) q_0 + h p_0$\n$p_f = p_0 - h \\omega^2 q_0$\nSo, $\\Phi_{\\text{LT}}(h)(q_0, p_0) = ((1 - \\omega^2 h^2) q_0 + h p_0, -h \\omega^2 q_0 + p_0)$.\n\n### Derivation of the Strang Splitting Map $\\Phi_{\\text{S}}(h)$\nThe map $\\Phi_{\\text{S}}(h)$ is the composition of a half-step flow for $T$, a full-step flow for $V$, and another half-step flow for $T$.\nLet $(q_0, p_0)$ be the initial state.\n$1$. Apply $\\exp(\\frac{h}{2} L_T)$: $(q_1, p_1) = (q_0 + \\frac{h}{2} p_0, p_0)$.\n$2$. Apply $\\exp(h L_V)$ to $(q_1, p_1)$: $(q_2, p_2) = (q_1, p_1 - h \\omega^2 q_1)$.\n$q_2 = q_1 = q_0 + \\frac{h}{2} p_0$\n$p_2 = p_1 - h \\omega^2 q_1 = p_0 - h \\omega^2 (q_0 + \\frac{h}{2} p_0) = -h \\omega^2 q_0 + (1 - \\frac{h^2 \\omega^2}{2}) p_0$\n$3$. Apply $\\exp(\\frac{h}{2} L_T)$ to $(q_2, p_2)$: $(q_f, p_f) = (q_2 + \\frac{h}{2} p_2, p_2)$.\n$p_f = p_2 = -h \\omega^2 q_0 + (1 - \\frac{h^2 \\omega^2}{2}) p_0$\n$q_f = q_2 + \\frac{h}{2} p_2 = (q_0 + \\frac{h}{2} p_0) + \\frac{h}{2} (-h \\omega^2 q_0 + (1 - \\frac{h^2 \\omega^2}{2}) p_0)$\n$q_f = q_0 + \\frac{h}{2} p_0 - \\frac{h^2 \\omega^2}{2} q_0 + \\frac{h}{2} p_0 - \\frac{h^3 \\omega^2}{4} p_0$\n$q_f = (1 - \\frac{\\omega^2 h^2}{2}) q_0 + (h - \\frac{\\omega^2 h^3}{4}) p_0$\nSo, $\\Phi_{\\text{S}}(h)(q_0, p_0) = \\left( (1 - \\frac{\\omega^2 h^2}{2}) q_0 + (h - \\frac{\\omega^2 h^3}{4}) p_0, -h \\omega^2 q_0 + (1 - \\frac{\\omega^2 h^2}{2}) p_0 \\right)$.\n\n### Taylor Expansion of the Exact Flow\nWe expand the exact flow solutions for $q(h)$ and $p(h)$ in powers of $h$ up to order $h^3$.\nWe use the Taylor series $\\cos(x) = 1 - \\frac{x^2}{2!} + \\mathcal{O}(x^4)$ and $\\sin(x) = x - \\frac{x^3}{3!} + \\mathcal{O}(x^5)$. Let $\\theta = \\omega h$.\n$q_{\\text{exact}}(h) = q_0 \\cos(\\theta) + \\frac{p_0}{\\omega} \\sin(\\theta) = q_0 \\left(1 - \\frac{\\theta^2}{2}\\right) + \\frac{p_0}{\\omega} \\left(\\theta - \\frac{\\theta^3}{6}\\right) + \\mathcal{O}(h^4)$\n$q_{\\text{exact}}(h) = q_0 \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + p_0 \\left(h - \\frac{\\omega^2 h^3}{6}\\right) + \\mathcal{O}(h^4)$\n\n$p_{\\text{exact}}(h) = -q_0 \\omega \\sin(\\theta) + p_0 \\cos(\\theta) = -q_0 \\omega \\left(\\theta - \\frac{\\theta^3}{6}\\right) + p_0 \\left(1 - \\frac{\\theta^2}{2}\\right) + \\mathcal{O}(h^4)$\n$p_{\\text{exact}}(h) = -q_0 \\left(\\omega^2 h - \\frac{\\omega^4 h^3}{6}\\right) + p_0 \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) + \\mathcal{O}(h^4)$\n$p_{\\text{exact}}(h) = \\left(-\\omega^2 h + \\frac{\\omega^4 h^3}{6}\\right) q_0 + \\left(1 - \\frac{\\omega^2 h^2}{2}\\right) p_0 + \\mathcal{O}(h^4)$\n\n### Calculation of Local Truncation Errors\nThe local truncation error is $e(h) = \\Phi(h)(q_0, p_0) - \\varphi_{H}(h)(q_0, p_0)$. Let $(q_0, p_0)$ be denoted as $(q,p)$ for brevity.\n\n#### Lie-Trotter Error $e_{\\text{LT}}(h) = (\\Delta q_{\\text{LT}}, \\Delta p_{\\text{LT}})$\n$\\Delta q_{\\text{LT}} = q_{\\text{LT}} - q_{\\text{exact}}$\n$\\Delta q_{\\text{LT}} = \\left((1 - \\omega^2 h^2) q + h p\\right) - \\left( (1 - \\frac{\\omega^2 h^2}{2}) q + (h - \\frac{\\omega^2 h^3}{6}) p \\right) + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{LT}} = \\left(1 - \\omega^2 h^2 - 1 + \\frac{\\omega^2 h^2}{2}\\right)q + \\left(h - h + \\frac{\\omega^2 h^3}{6}\\right)p + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{LT}} = -\\frac{\\omega^2 h^2}{2} q + \\frac{\\omega^2 h^3}{6} p$\n\n$\\Delta p_{\\text{LT}} = p_{\\text{LT}} - p_{\\text{exact}}$\n$\\Delta p_{\\text{LT}} = \\left(-h \\omega^2 q + p\\right) - \\left( (-\\omega^2 h + \\frac{\\omega^4 h^3}{6}) q + (1 - \\frac{\\omega^2 h^2}{2}) p \\right) + \\mathcal{O}(h^4)$\n$\\Delta p_{\\text{LT}} = \\left(-h \\omega^2 + \\omega^2 h - \\frac{\\omega^4 h^3}{6}\\right)q + \\left(1 - 1 + \\frac{\\omega^2 h^2}{2}\\right)p + \\mathcal{O}(h^4)$\n$\\Delta p_{\\text{LT}} = -\\frac{\\omega^4 h^3}{6} q + \\frac{\\omega^2 h^2}{2} p$\n\n#### Strang Splitting Error $e_{\\text{S}}(h) = (\\Delta q_{\\text{S}}, \\Delta p_{\\text{S}})$\n$\\Delta q_{\\text{S}} = q_{\\text{S}} - q_{\\text{exact}}$\n$\\Delta q_{\\text{S}} = \\left( (1 - \\frac{\\omega^2 h^2}{2}) q + (h - \\frac{\\omega^2 h^3}{4}) p \\right) - \\left( (1 - \\frac{\\omega^2 h^2}{2}) q + (h - \\frac{\\omega^2 h^3}{6}) p \\right) + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{S}} = \\left(1 - \\frac{\\omega^2 h^2}{2} - 1 + \\frac{\\omega^2 h^2}{2}\\right)q + \\left(h - \\frac{\\omega^2 h^3}{4} - h + \\frac{\\omega^2 h^3}{6}\\right)p + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{S}} = \\left(-\\frac{1}{4} + \\frac{1}{6}\\right) \\omega^2 h^3 p + \\mathcal{O}(h^4) = \\left(-\\frac{3}{12} + \\frac{2}{12}\\right) \\omega^2 h^3 p + \\mathcal{O}(h^4)$\n$\\Delta q_{\\text{S}} = -\\frac{\\omega^2 h^3}{12} p$\n\n$\\Delta p_{\\text{S}} = p_{\\text{S}} - p_{\\text{exact}}$\n$\\Delta p_{\\text{S}} = \\left(-h \\omega^2 q + (1 - \\frac{\\omega^2 h^2}{2}) p \\right) - \\left( (-\\omega^2 h + \\frac{\\omega^4 h^3}{6}) q + (1 - \\frac{\\omega^2 h^2}{2}) p \\right) + \\mathcal{O}(h^4)$\n$\\Delta p_{\\text{S}} = \\left(-h \\omega^2 + \\omega^2 h - \\frac{\\omega^4 h^3}{6}\\right)q + \\left(1 - \\frac{\\omega^2 h^2}{2} - 1 + \\frac{\\omega^2 h^2}{2}\\right)p + \\mathcal{O}(h^4)$\n$\\Delta p_{\\text{S}} = -\\frac{\\omega^4 h^3}{6} q$\n\nThese are the local truncation error components up to order $(\\omega h)^3$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{\\omega^{2} h^{2}}{2} q + \\frac{\\omega^{2} h^{3}}{6} p & -\\frac{\\omega^{4} h^{3}}{6} q + \\frac{\\omega^{2} h^{2}}{2} p & -\\frac{\\omega^{2} h^{3}}{12} p & -\\frac{\\omega^{4} h^{3}}{6} q\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "This final practice bridges theory and computation by asking you to implement a more sophisticated, fourth-order integrator. You will use Yoshida's composition technique to build a highly accurate method from a basic second-order one and test its performance on an anisotropic oscillator. This exercise mimics the workflow of a computational scientist: constructing an algorithm based on theoretical principles and then validating its performance through numerical experiments .",
            "id": "3766822",
            "problem": "Consider the separable Hamiltonian system in two dimensions with the phase-space coordinate $\\left(q,p\\right) \\in \\mathbb{R}^2 \\times \\mathbb{R}^2$ and the Hamiltonian\n$$\nH(q,p) = T(p) + V(q), \\quad T(p) = \\tfrac{1}{2}\\left(p_1^2 + p_2^2\\right), \\quad V(q) = \\tfrac{1}{2}\\left(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2\\right),\n$$\nwhere $\\omega_1 > 0$ and $\\omega_2 > 0$ are constant angular frequencies. The Hamiltonian vector field defined by Hamilton's equations is\n$$\n\\dot{q} = \\nabla_p T(p) = p, \\quad \\dot{p} = -\\nabla_q V(q) = -\\operatorname{diag}(\\omega_1^2, \\omega_2^2)\\, q.\n$$\nThis system describes an anisotropic harmonic oscillator and is separable into kinetic and potential parts. The exact solution is a rotation in each coordinate plane with angular frequencies $\\omega_1$ and $\\omega_2$, respectively, and trigonometric functions use the angle unit in radians.\n\nDesign and implement a program that:\n- Constructs a fourth-order symplectic integrator by composing a symmetric second-order Strang splitting for the separable Hamiltonian described above, using the composition proposed by Haruo Yoshida. The program must implement the flows of the kinetic part $T(p)$ and the potential part $V(q)$ exactly and assemble the full one-step integrator by a specific fourth-order composition of second-order steps.\n- Uses a fixed time step $h$ that is dimensionless and a fixed number of steps $N$ to integrate from time $t=0$ to time $t=Nh$. Your numerical solution must evolve both position and momentum.\n- Computes two error metrics at the final time $t=Nh$ for each test case:\n  1. The relative energy error, defined as\n     $$\n     \\varepsilon_H = \\frac{\\left|H(q_N,p_N) - H(q_0,p_0)\\right|}{H(q_0,p_0)},\n     $$\n     where $(q_N,p_N)$ is the numerical solution after $N$ steps and $(q_0,p_0)$ is the initial condition.\n  2. The relative state error against the exact solution at $t=Nh$, defined by\n     $$\n     \\varepsilon_X = \\frac{\\left\\| \\begin{pmatrix} q_N \\\\ p_N \\end{pmatrix} - \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}{\\left\\| \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}.\n     $$\n\nFundamental base to be used:\n- Hamilton's equations for separable Hamiltonians and the exact solvability of the subflows $\\phi_T^t$ and $\\phi_V^t$ for the kinetic and potential parts, respectively.\n- The existence of symmetric second-order Strang splitting for separable systems and the existence of fourth-order compositions constructed from symmetric second-order methods.\n\nInitial condition:\n- Use $(q_0, p_0) = \\left((1, -0.5), (0.3, 0.7)\\right)$.\n\nIntegrator specification:\n- Time step $h$ is fixed and dimensionless; set $h = 10^{-2}$.\n- Number of steps $N$ is fixed; set $N = 1000$.\n- Trigonometric functions must use angles measured in radians.\n\nTest suite:\n- Define the following five test cases by the pair $(\\omega_1 h, \\omega_2 h)$, ensuring scientific realism and coverage of different regimes while remaining within a stable regime for the implemented method:\n  1. $(0.05, 0.05)$: very small step relative to both frequencies (near-linear regime).\n  2. $(0.25, 0.75)$: moderate anisotropy with distinct scales.\n  3. $(0.75, 0.25)$: swapped anisotropy to test symmetry in indices.\n  4. $(1.05, 1.05)$: near the known stability boundary of second-order splitting substeps.\n  5. $(1.10, 0.10)$: extreme anisotropy with one frequency near boundary.\n\nFor each test case, set $\\omega_1 = (\\omega_1 h)/h$ and $\\omega_2 = (\\omega_2 h)/h$, keeping the fixed $h$ specified above. Integrate the system for $N$ steps using the Yoshida fourth-order composition of the symmetric second-order Strang splitting and compute $\\varepsilon_H$ and $\\varepsilon_X$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of the list should itself be a two-element list of floating-point numbers in the order $[\\varepsilon_H, \\varepsilon_X]$, one per test case, e.g., \"[[eH1,eX1],[eH2,eX2],...]\".",
            "solution": "## Problem Validation\n\n### Step 1: Extract Givens\n\n- **Hamiltonian System**:\n    - Phase-space coordinate: $(q,p) \\in \\mathbb{R}^2 \\times \\mathbb{R}^2$.\n    - Hamiltonian: $H(q,p) = T(p) + V(q)$, which is separable.\n    - Kinetic energy: $T(p) = \\tfrac{1}{2}\\left(p_1^2 + p_2^2\\right)$.\n    - Potential energy: $V(q) = \\tfrac{1}{2}\\left(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2\\right)$, where $\\omega_1 > 0$ and $\\omega_2 > 0$ are constants.\n- **Hamilton's Equations**:\n    - $\\dot{q} = \\nabla_p T(p) = p$.\n    - $\\dot{p} = -\\nabla_q V(q) = -\\operatorname{diag}(\\omega_1^2, \\omega_2^2)\\, q$.\n- **Initial Condition**:\n    - $(q_0, p_0) = \\left((1, -0.5), (0.3, 0.7)\\right)$.\n- **Integrator Specification**:\n    - Method: Fourth-order symplectic integrator from composing a symmetric second-order Strang splitting using Haruo Yoshida's composition.\n    - Sub-flows for $T(p)$ and $V(q)$ must be implemented exactly.\n    - Time step: $h = 10^{-2}$ (fixed and dimensionless).\n    - Number of steps: $N = 1000$.\n    - Trigonometric functions use radians.\n- **Test Cases**:\n    - Test cases are defined by the pair $(\\omega_1 h, \\omega_2 h)$:\n      1. $(0.05, 0.05)$\n      2. $(0.25, 0.75)$\n      3. $(0.75, 0.25)$\n      4. $(1.05, 1.05)$\n      5. $(1.10, 0.10)$\n    - For each case, $\\omega_1 = (\\omega_1 h)/h$ and $\\omega_2 = (\\omega_2 h)/h$.\n- **Error Metrics to Compute**:\n    1. Relative energy error: $\\varepsilon_H = \\frac{\\left|H(q_N,p_N) - H(q_0,p_0)\\right|}{H(q_0,p_0)}$.\n    2. Relative state error: $\\varepsilon_X = \\frac{\\left\\| \\begin{pmatrix} q_N \\\\ p_N \\end{pmatrix} - \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}{\\left\\| \\begin{pmatrix} q_{\\mathrm{exact}}(Nh) \\\\ p_{\\mathrm{exact}}(Nh) \\end{pmatrix} \\right\\|_2}$.\n- **Final Output Format**: `[[eH1,eX1],[eH2,eX2],...]`.\n\n### Step 2: Validate Using Extracted Givens\n\n- **Scientifically Grounded**: The problem describes the dynamics of a 2D anisotropic harmonic oscillator, a fundamental model in classical mechanics. The Hamiltonian is correctly formulated. The use of splitting methods, specifically Strang splitting and Yoshida's composition, is a standard, rigorously established technique in geometric numerical integration for Hamiltonian systems. All concepts are firmly based on established principles of physics and mathematics.\n- **Well-Posed**: The problem is well-posed. The differential equations have a unique, stable solution for any given set of initial conditions. The numerical method is well-defined, and the parameters ($h$, $N$) are specified. The error metrics are standard and unambiguous.\n- **Objective**: The problem is stated using precise, objective mathematical language. There are no subjective or opinion-based statements.\n- **Completeness and Consistency**: All necessary information is provided. The givens are self-contained and consistent. The Hamiltonian, initial conditions, integration parameters, test cases, and desired outputs are all explicitly defined. There are no contradictions.\n- **Other Flaws**: The problem is not trivial, metaphorical, or unrealistic. The test cases are chosen to probe different dynamic regimes and the stability properties of the method, which is a meaningful exercise.\n\n### Step 3: Verdict and Action\n\nThe problem is valid. It is scientifically sound, well-posed, and complete. A solution will be constructed.\n\n## Solution\n\nThe solution to this problem involves three main components: deriving the exact analytical solution for validation, constructing the specified fourth-order symplectic integrator, and implementing a numerical procedure to compute the required error metrics for the given test cases.\n\n### 1. Exact Solution of the Anisotropic Harmonic Oscillator\n\nThe Hamiltonian $H(q, p) = \\frac{1}{2}(p_1^2 + p_2^2) + \\frac{1}{2}(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2)$ separates into two independent 1D harmonic oscillators, one for each coordinate. Hamilton's equations are:\n$$\n\\dot{q}_i = p_i, \\quad \\dot{p}_i = -\\omega_i^2 q_i, \\quad \\text{for } i=1, 2.\n$$\nDifferentiating $\\dot{q}_i$ with respect to time gives the second-order ordinary differential equation $\\ddot{q}_i + \\omega_i^2 q_i = 0$. Given initial conditions $(q_{i,0}, p_{i,0})$ at $t=0$, the unique solution for each coordinate $i$ is:\n$$\nq_i(t) = q_{i,0} \\cos(\\omega_i t) + \\frac{p_{i,0}}{\\omega_i} \\sin(\\omega_i t)\n$$\n$$\np_i(t) = \\dot{q}_i(t) = p_{i,0} \\cos(\\omega_i t) - q_{i,0} \\omega_i \\sin(\\omega_i t)\n$$\nThis exact solution will be used at the final time $t_f = Nh$ to compute the state error $\\varepsilon_X$.\n\n### 2. Fourth-Order Symplectic Integrator\n\nA symplectic integrator is designed to preserve the symplectic structure of phase space, which leads to excellent long-term energy conservation properties. For a separable Hamiltonian $H = T(p) + V(q)$, the total flow can be approximated by composing the exact flows of the subsystems governed by $T(p)$ and $V(q)$ alone.\n\n**Exact Sub-flows:**\nLet $\\phi_{\\cdot}^{\\tau}$ denote the exact flow for a time interval $\\tau$.\n- **Flow for $T(p)$**: Hamilton's equations are $\\dot{q} = \\nabla_p T(p) = p$ and $\\dot{p} = 0$. Integrating over a time step $\\tau$ yields:\n  $$ \\phi_T^\\tau(q,p) = (q + p\\tau, p) $$\n- **Flow for $V(q)$**: Hamilton's equations are $\\dot{q} = 0$ and $\\dot{p} = -\\nabla_q V(q) = -M q$, where $M = \\operatorname{diag}(\\omega_1^2, \\omega_2^2)$. Integrating over a time step $\\tau$ yields:\n  $$ \\phi_V^\\tau(q,p) = (q, p - Mq\\tau) $$\n\n**Second-Order Strang Splitting:**\nA symmetric second-order method, known as Strang (or leapfrog) splitting, is constructed as:\n$$\n\\Psi_2(h) = \\phi_V^{h/2} \\circ \\phi_T^h \\circ \\phi_V^{h/2}\n$$\nThis composition is symmetric ($\\Psi_2(-h) = (\\Psi_2(h))^{-1}$) and has a local error of order $O(h^3)$, resulting in a global error of order $O(h^2)$.\n\n**Fourth-Order Yoshida Composition:**\nHaruo Yoshida demonstrated that a higher-order symmetric integrator can be constructed by composing a second-order symmetric method. A fourth-order method $\\Psi_4(h)$ is given by:\n$$\n\\Psi_4(h) = \\Psi_2(c_1 h) \\circ \\Psi_2(c_2 h) \\circ \\Psi_2(c_1 h)\n$$\nThe constants $c_1$ and $c_2$ must satisfy $2c_1 + c_2 = 1$ and $2c_1^3 + c_2^3 = 0$. The solution is:\n$$\nc_1 = \\frac{1}{2 - 2^{1/3}}, \\quad c_2 = -\\frac{2^{1/3}}{2 - 2^{1/3}}\n$$\nNumerically, these are $c_1 \\approx 1.35120719$ and $c_2 \\approx -1.70241438$.\nExpanding the composition and combining adjacent $\\phi_V$ flows gives a 7-stage algorithm for one step of $\\Psi_4(h)$. The sequence of operations is $\\phi_V \\circ \\phi_T \\circ \\phi_V \\circ \\phi_T \\circ \\phi_V \\circ \\phi_T \\circ \\phi_V$, with the following time durations for each sub-step:\n- V-step durations: $d_1 h, d_2 h, d_3 h, d_4 h$, where $d_1 = d_4 = \\frac{c_1}{2}$ and $d_2 = d_3 = \\frac{c_1+c_2}{2}$.\n- T-step durations: $e_1 h, e_2 h, e_3 h$, where $e_1 = e_3 = c_1$ and $e_2 = c_2$.\n\n### 3. Numerical Implementation and Error Calculation\n\nThe algorithm proceeds as follows for each test case:\n1.  **Initialization**:\n    - From the test case parameters $(\\omega_1 h, \\omega_2 h)$ and the fixed time step $h=10^{-2}$, calculate the frequencies $\\omega_1$ and $\\omega_2$.\n    - Set the initial state $(q, p)$ to $(q_0, p_0) = \\left((1, -0.5), (0.3, 0.7)\\right)$.\n    - Compute the initial energy $H_0 = H(q_0, p_0)$.\n2.  **Integration**:\n    - Iterate $N = 1000$ times to advance the system from $t=0$ to $t_f = Nh = 10$.\n    - In each iteration, apply the 7-stage Yoshida integrator step using the coefficients derived above and the exact sub-flows $\\phi_T$ and $\\phi_V$. The state $(q, p)$ is updated at each of the 7 stages.\n3.  **Error Computation**:\n    - After $N$ steps, the final numerical state is $(q_N, p_N)$.\n    - Compute the final energy $H_N = H(q_N, p_N)$. The relative energy error is $\\varepsilon_H = |H_N - H_0| / H_0$. Due to the symplectic nature of the integrator, $H_N$ is expected to be very close to $H_0$.\n    - Compute the exact state $(q_{\\text{exact}}(t_f), p_{\\text{exact}}(t_f))$ using the analytical formulas derived in Section 1.\n    - Compute the relative state error $\\varepsilon_X$ using the Euclidean norm ($L_2$-norm) of the difference between the numerical and exact final state vectors, normalized by the norm of the exact final state vector.\n\nThis procedure is repeated for all five test cases, and the resulting pairs $[\\varepsilon_H, \\varepsilon_X]$ are collected for the final output.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of integrating a 2D anisotropic harmonic oscillator\n    using a 4th-order Yoshida symplectic integrator and computes error metrics.\n    \"\"\"\n    \n    # --- Problem Parameters ---\n    h = 1e-2  # Fixed time step\n    N = 1000  # Number of steps\n    q0 = np.array([1.0, -0.5])  # Initial position\n    p0 = np.array([0.3, 0.7])   # Initial momentum\n    \n    # Test cases defined by the pair (omega_1 * h, omega_2 * h)\n    test_cases = [\n        (0.05, 0.05),\n        (0.25, 0.75),\n        (0.75, 0.25),\n        (1.05, 1.05),\n        (1.10, 0.10),\n    ]\n\n    # --- Integrator Coefficients ---\n    # Yoshida 4th-order composition coefficients\n    cbrt2 = 2**(1/3)\n    c1 = 1 / (2 - cbrt2)\n    c2 = 1 - 2 * c1\n    \n    # Time intervals for the 7 stages of one Yoshida step\n    # V-steps (potential, updates momentum)\n    dt_v = np.array([c1 / 2, (c1 + c2) / 2, (c1 + c2) / 2, c1 / 2]) * h\n    # T-steps (kinetic, updates position)\n    dt_t = np.array([c1, c2, c1]) * h\n\n    # --- Main Loop ---\n    results = []\n    for w1h, w2h in test_cases:\n        # Calculate frequencies for the current test case\n        w1 = w1h / h\n        w2 = w2h / h\n        \n        # Matrix M = diag(w1^2, w2^2) for the potential part\n        M = np.diag([w1**2, w2**2])\n\n        # --- Numerical Integration ---\n        # Initialize state for numerical integration\n        q_n = np.copy(q0)\n        p_n = np.copy(p0)\n        \n        # Calculate initial Hamiltonian H(q0, p0)\n        H0 = 0.5 * (p0 @ p0) + 0.5 * (q0 @ (M @ q0))\n        \n        # Propagate for N steps\n        for _ in range(N):\n            # One step of 4th-order Yoshida integrator (7 stages)\n            p_n = p_n - M @ q_n * dt_v[0]  # Stage 1: V-step\n            q_n = q_n + p_n * dt_t[0]      # Stage 2: T-step\n            p_n = p_n - M @ q_n * dt_v[1]  # Stage 3: V-step\n            q_n = q_n + p_n * dt_t[1]      # Stage 4: T-step\n            p_n = p_n - M @ q_n * dt_v[2]  # Stage 5: V-step\n            q_n = q_n + p_n * dt_t[2]      # Stage 6: T-step\n            p_n = p_n - M @ q_n * dt_v[3]  # Stage 7: V-step\n        \n        # Final numerical state (q_N, p_N)\n        q_N, p_N = q_n, p_n\n        \n        # --- Error Calculation ---\n        \n        # 1. Relative Energy Error (eps_H)\n        H_N = 0.5 * (p_N @ p_N) + 0.5 * (q_N @ (M @ q_N))\n        eps_H = np.abs(H_N - H0) / H0 if H0 != 0 else 0.0\n\n        # 2. Relative State Error (eps_X)\n        \n        # Calculate exact solution at final time t_f = N*h\n        t_final = N * h\n        \n        # Component 1\n        c1t, s1t = np.cos(w1 * t_final), np.sin(w1 * t_final)\n        q1_exact = q0[0] * c1t + (p0[0] / w1) * s1t\n        p1_exact = p0[0] * c1t - q0[0] * w1 * s1t\n        \n        # Component 2\n        c2t, s2t = np.cos(w2 * t_final), np.sin(w2 * t_final)\n        q2_exact = q0[1] * c2t + (p0[1] / w2) * s2t\n        p2_exact = p0[1] * c2t - q0[1] * w2 * s2t\n        \n        q_exact = np.array([q1_exact, q2_exact])\n        p_exact = np.array([p1_exact, p2_exact])\n        \n        # Combine into phase-space vectors\n        X_N = np.concatenate((q_N, p_N))\n        X_exact = np.concatenate((q_exact, p_exact))\n        \n        # Calculate relative L2 norm\n        norm_X_exact = np.linalg.norm(X_exact)\n        eps_X = np.linalg.norm(X_N - X_exact) / norm_X_exact if norm_X_exact != 0 else 0.0\n\n        results.append([eps_H, eps_X])\n\n    # --- Final Output ---\n    # Format the results into the required string format \"[[eH1,eX1],[eH2,eX2],...]\"\n    results_str = [f\"[{eH},{eX}]\" for eH, eX in results]\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}