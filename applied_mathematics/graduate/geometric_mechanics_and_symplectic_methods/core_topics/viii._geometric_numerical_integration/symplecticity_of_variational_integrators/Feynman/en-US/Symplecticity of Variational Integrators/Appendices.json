{
    "hands_on_practices": [
        {
            "introduction": "This exercise guides you through the foundational process of creating a variational integrator from first principles. By discretizing the action for the simple harmonic oscillator using the midpoint rule, you will derive a discrete Lagrangian and the corresponding implicit update equations. This process demonstrates how the variational structure inherently guarantees the resulting numerical scheme is symplectic, a cornerstone property for long-term simulation accuracy. ",
            "id": "3770937",
            "problem": "Let a one degree-of-freedom mechanical system be defined by the Lagrangian $L(q,\\dot{q})=\\tfrac{1}{2} m \\dot{q}^{2}-\\tfrac{1}{2} k q^{2}$ with $m>0$, $k>0$. Consider a fixed time step $h>0$. Use the discrete variational principle, where the discrete Lagrangian approximates the action integral over one time step by midpoint quadrature, namely $L_{d}^{\\text{mid}}(q_{k},q_{k+1};h) \\approx \\int_{t_{k}}^{t_{k+1}} L(q,\\dot{q})\\,\\mathrm{d}t$ with the midpoint rule. \n\nTasks:\n- Starting from the continuous action and the midpoint quadrature, compute the explicit analytic expression for the midpoint discrete Lagrangian $L_{d}^{\\text{mid}}(q_{k},q_{k+1};h)$ in terms of $q_{k}$, $q_{k+1}$, $h$, $m$, and $k$.\n- From the discrete Euler–Lagrange equations and the discrete Legendre transforms, derive the implicit one-step update equations for $(q_{k+1},p_{k+1})$ in terms of $(q_{k},p_{k})$, where $p=\\partial L/\\partial \\dot{q}=m \\dot{q}$ is the canonical momentum.\n- Show, by reasoning from the discrete variational construction (without appealing to external results), that the resulting update map is symplectic in the canonical coordinates $(q,p)$.\n- Finally, let $\\omega=\\sqrt{k/m}$. Express the one-step map in linear form and identify the induced rotation angle $\\Omega h$ in the symplectically scaled variables. Provide a closed-form expression for $\\cos(\\Omega h)$ in terms of the non-dimensional time step $\\omega h$.\n\nYour final boxed answer must be the analytic expression for $\\cos(\\Omega h)$ as a function of $\\omega h$. Do not include units in your final boxed answer.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, and objective. It is a standard problem in the field of geometric numerical integration and contains all necessary information for a unique solution.\n\nThe continuous Lagrangian for the one degree-of-freedom harmonic oscillator is given by\n$$L(q, \\dot{q}) = \\frac{1}{2}m\\dot{q}^2 - \\frac{1}{2}kq^2$$\nwhere $q$ is the generalized coordinate, $\\dot{q}$ is its time derivative, and $m, k > 0$ are the mass and spring constant, respectively.\n\n### Task 1: Compute the Midpoint Discrete Lagrangian\n\nThe discrete Lagrangian $L_d(q_k, q_{k+1}; h)$ is defined by approximating the action integral over a time step $h$ using the midpoint quadrature rule.\n$$L_d(q_k, q_{k+1}; h) = \\int_{t_k}^{t_{k+1}} L(q(t), \\dot{q}(t)) dt \\approx h L\\left(q\\left(t_k + \\frac{h}{2}\\right), \\dot{q}\\left(t_k + \\frac{h}{2}\\right)\\right)$$\nTo evaluate the Lagrangian at the midpoint in time, we approximate the path between $q_k = q(t_k)$ and $q_{k+1} = q(t_{k+1})$ by a straight line.\nThe position at the midpoint is the average of the endpoints:\n$$q\\left(t_k + \\frac{h}{2}\\right) \\approx \\frac{q_k + q_{k+1}}{2}$$\nThe velocity along this linear path is constant and is approximated by the finite difference:\n$$\\dot{q}\\left(t_k + \\frac{h}{2}\\right) \\approx \\frac{q_{k+1} - q_k}{h}$$\nSubstituting these approximations into the expression for the discrete Lagrangian yields:\n$$L_d^{\\text{mid}}(q_k, q_{k+1}; h) = h \\left[ \\frac{1}{2}m\\left(\\frac{q_{k+1} - q_k}{h}\\right)^2 - \\frac{1}{2}k\\left(\\frac{q_k + q_{k+1}}{2}\\right)^2 \\right]$$\nExpanding this expression gives the explicit analytic form:\n$$L_d^{\\text{mid}}(q_k, q_{k+1}; h) = \\frac{m}{2h}(q_{k+1} - q_k)^2 - \\frac{kh}{8}(q_k + q_{k+1})^2$$\n\n### Task 2: Derive the One-Step Update Equations\n\nThe discrete action is the sum $S_d = \\sum_k L_d(q_k, q_{k+1}; h)$. The discrete variational principle, $\\delta S_d = 0$, for an interior point $q_k$ leads to the discrete Euler-Lagrange (DEL) equations:\n$$D_1 L_d(q_k, q_{k+1}; h) + D_2 L_d(q_{k-1}, q_k; h) = 0$$\nwhere $D_1$ and $D_2$ denote the partial derivatives with respect to the first and second arguments of $L_d$, respectively.\n\nThe discrete Legendre transforms define the momenta at the beginning and end of the interval $[t_k, t_{k+1}]$:\n$$p_k = -D_1 L_d(q_k, q_{k+1}; h)$$\n$$p_{k+1} = D_2 L_d(q_k, q_{k+1}; h)$$\nLet's compute these derivatives from the discrete Lagrangian:\n$$D_1 L_d = \\frac{\\partial}{\\partial q_k} \\left(\\frac{m}{2h}(q_{k+1}-q_k)^2 - \\frac{kh}{8}(q_k+q_{k+1})^2\\right) = -\\frac{m}{h}(q_{k+1}-q_k) - \\frac{kh}{4}(q_k+q_{k+1})$$\n$$D_2 L_d = \\frac{\\partial}{\\partial q_{k+1}} \\left(\\frac{m}{2h}(q_{k+1}-q_k)^2 - \\frac{kh}{8}(q_k+q_{k+1})^2\\right) = \\frac{m}{h}(q_{k+1}-q_k) - \\frac{kh}{4}(q_k+q_{k+1})$$\nUsing the Legendre transforms, we obtain the implicit one-step update equations that define the map $(q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$:\n$$p_k = -D_1 L_d = \\frac{m}{h}(q_{k+1}-q_k) + \\frac{kh}{4}(q_k+q_{k+1})$$\n$$p_{k+1} = D_2 L_d = \\frac{m}{h}(q_{k+1}-q_k) - \\frac{kh}{4}(q_k+q_{k+1})$$\n\n### Task 3: Show that the Map is Symplectic\n\nA map $(q, p) \\mapsto (Q, P)$ is symplectic if it preserves the canonical symplectic 2-form $\\omega = dq \\wedge dp$, i.e., $dQ \\wedge dP = dq \\wedge dp$.\nThe discrete Legendre transforms define a relationship between $(q_k, q_{k+1})$ and $(q_k, p_k; q_{k+1}, p_{k+1})$. Consider the total differential of the discrete Lagrangian $L_d(q_k, q_{k+1}; h)$:\n$$dL_d = D_1 L_d \\,dq_k + D_2 L_d \\,dq_{k+1}$$\nSubstituting the definitions of the momenta, $p_k = -D_1 L_d$ and $p_{k+1} = D_2 L_d$:\n$$dL_d = -p_k \\,dq_k + p_{k+1} \\,dq_{k+1}$$\nThis equation relates the differentials of the variables. $L_d$ is a function of $q_k$ and $q_{k+1}$, so $p_k$ and $p_{k+1}$ are functions of $(q_k, q_{k+1})$. The equation is an identity relating 1-forms on the space with coordinates $(q_k, q_{k+1})$.\nTaking the exterior derivative of this equation and using the property that the exterior derivative of an exact form is zero, $d(dL_d)=0$, we get:\n$$d(-p_k \\,dq_k + p_{k+1} \\,dq_{k+1}) = 0$$\nUsing the linearity of $d$ and the identity $d(f dg) = df \\wedge dg$:\n$$-d(p_k \\,dq_k) + d(p_{k+1} \\,dq_{k+1}) = 0$$\n$$-dp_k \\wedge dq_k + dp_{k+1} \\wedge dq_{k+1} = 0$$\nUsing the anti-commutative property of the wedge product, $dq \\wedge dp = -dp \\wedge dq$:\n$$dq_k \\wedge dp_k = dq_{k+1} \\wedge dp_{k+1}$$\nThis shows that the update map from $(q_k, p_k)$ to $(q_{k+1}, p_{k+1})$ preserves the canonical symplectic 2-form $dq \\wedge dp$. Therefore, the one-step map is symplectic. This proof is derived directly from the discrete variational principle as required.\n\n### Task 4: Express the Map in Linear Form and Find $\\cos(\\Omega h)$\n\nWe must solve the implicit update equations for $(q_{k+1}, p_{k+1})$ in terms of $(q_k, p_k)$. Adding and subtracting the two equations for momenta gives:\n$$p_k + p_{k+1} = 2 \\frac{m}{h}(q_{k+1} - q_k) \\quad \\implies \\quad q_{k+1} - q_k = \\frac{h}{2m}(p_k + p_{k+1})$$\n$$p_k - p_{k+1} = 2 \\frac{kh}{4}(q_k + q_{k+1}) \\quad \\implies \\quad p_k - p_{k+1} = \\frac{kh}{2}(q_k + q_{k+1})$$\nThese are the equations for the implicit midpoint rule. We solve for $(q_{k+1}, p_{k+1})$ explicitly. From the second equation: $p_{k+1} = p_k - \\frac{kh}{2}(q_k + q_{k+1})$. Substitute $q_{k+1}$ from the first equation: $p_{k+1} = p_k - \\frac{kh}{2}\\left(q_k + q_k + \\frac{h}{2m}(p_k+p_{k+1})\\right)$.\n$$p_{k+1} = p_k - khq_k - \\frac{kh^2}{4m}(p_k+p_{k+1})$$\nLet $\\omega = \\sqrt{k/m}$. Then $k=\\omega^2 m$.\n$$p_{k+1}\\left(1 + \\frac{\\omega^2 h^2}{4}\\right) = p_k\\left(1 - \\frac{\\omega^2 h^2}{4}\\right) - kh q_k$$\n$$p_{k+1} = \\frac{1 - \\frac{1}{4}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2} p_k - \\frac{kh}{1 + \\frac{1}{4}\\omega^2 h^2} q_k$$\nNow we find $q_{k+1}$ from $q_{k+1} = q_k + \\frac{h}{2m}(p_k+p_{k+1})$.\n$$q_{k+1} = q_k + \\frac{h}{2m}p_k + \\frac{h}{2m} \\left( \\frac{1 - \\frac{1}{4}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2} p_k - \\frac{kh}{1 + \\frac{1}{4}\\omega^2 h^2} q_k \\right)$$\n$$q_{k+1} = \\left(1 - \\frac{kh^2/2m}{1 + \\frac{1}{4}\\omega^2 h^2}\\right) q_k + \\left(\\frac{h}{2m} + \\frac{h/2m(1 - \\frac{1}{4}\\omega^2 h^2)}{1 + \\frac{1}{4}\\omega^2 h^2}\\right) p_k$$\nSimplifying the coefficient of $q_k$:\n$$1 - \\frac{\\omega^2 h^2/2}{1 + \\frac{1}{4}\\omega^2 h^2} = \\frac{1 + \\frac{1}{4}\\omega^2 h^2 - \\frac{2}{4}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2} = \\frac{1 - \\frac{1}{4}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2}$$\nSimplifying the coefficient of $p_k$:\n$$\\frac{h}{2m} \\left( 1 + \\frac{1 - \\frac{1}{4}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2} \\right) = \\frac{h}{2m} \\frac{1 + \\frac{1}{4}\\omega^2 h^2 + 1 - \\frac{1}{4}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2} = \\frac{h}{m} \\frac{1}{1 + \\frac{1}{4}\\omega^2 h^2}$$\nThe linear one-step map is $\\begin{pmatrix} q_{k+1} \\\\ p_{k+1} \\end{pmatrix} = A \\begin{pmatrix} q_k \\\\ p_k \\end{pmatrix}$, where the matrix $A$ is:\n$$A = \\frac{1}{1+\\frac{1}{4}\\omega^2 h^2} \\begin{pmatrix} 1 - \\frac{1}{4}\\omega^2 h^2 & h/m \\\\ -kh & 1 - \\frac{1}{4}\\omega^2 h^2 \\end{pmatrix}$$\nTo identify the rotation, we use symplectically scaled variables that make the energy orbits circular. A suitable choice is $Q = \\sqrt{m\\omega}q$ and $P = p/\\sqrt{m\\omega}$, which satisfies $dQ \\wedge dP = dq \\wedge dp$. The inverse relations are $q = Q/\\sqrt{m\\omega}$ and $p=P\\sqrt{m\\omega}$.\nThe map in the new variables $(Q,P)$ is given by a matrix $B$ such that $\\begin{pmatrix} Q_{k+1} \\\\ P_{k+1} \\end{pmatrix} = B \\begin{pmatrix} Q_k \\\\ P_k \\end{pmatrix}$.\n$$Q_{k+1} = A_{11} Q_k + (m\\omega) A_{12} P_k$$\n$$P_{k+1} = \\frac{1}{m\\omega} A_{21} Q_k + A_{22} P_k$$\nThe new matrix $B$ is:\n$$B_{11} = B_{22} = A_{11} = \\frac{1 - \\frac{1}{4}\\omega^2 h^2}{1 + \\frac{1}{4}\\omega^2 h^2}$$\n$$B_{12} = (m\\omega)A_{12} = \\frac{m\\omega(h/m)}{1+\\frac{1}{4}\\omega^2 h^2} = \\frac{\\omega h}{1+\\frac{1}{4}\\omega^2 h^2}$$\n$$B_{21} = \\frac{1}{m\\omega}A_{21} = \\frac{-kh}{m\\omega(1+\\frac{1}{4}\\omega^2 h^2)} = \\frac{-m\\omega^2 h}{m\\omega(1+\\frac{1}{4}\\omega^2 h^2)} = \\frac{-\\omega h}{1+\\frac{1}{4}\\omega^2 h^2}$$\nSo the matrix $B$ is a rotation matrix:\n$$B = \\begin{pmatrix} \\cos(\\Omega h) & \\sin(\\Omega h) \\\\ -\\sin(\\Omega h) & \\cos(\\Omega h) \\end{pmatrix} = \\frac{1}{1+\\frac{1}{4}\\omega^2 h^2} \\begin{pmatrix} 1 - \\frac{1}{4}\\omega^2 h^2 & \\omega h \\\\ -\\omega h & 1 - \\frac{1}{4}\\omega^2 h^2 \\end{pmatrix}$$\nBy comparing the elements, we identify the cosine of the induced rotation angle $\\Omega h$:\n$$\\cos(\\Omega h) = \\frac{1 - \\frac{1}{4}(\\omega h)^2}{1 + \\frac{1}{4}(\\omega h)^2}$$\nMultiplying the numerator and denominator by $4$ gives a cleaner expression:\n$$\\cos(\\Omega h) = \\frac{4 - (\\omega h)^2}{4 + (\\omega h)^2}$$",
            "answer": "$$\\boxed{\\frac{4 - (\\omega h)^2}{4 + (\\omega h)^2}}$$"
        },
        {
            "introduction": "To appreciate the unique structure of variational integrators, it is instructive to analyze a method that lacks it. This problem examines the widely-used explicit Euler method, demonstrating through direct analysis why it cannot be derived from a discrete Lagrangian. This exercise illuminates the specific structural requirement that Euler's method violates, providing a clear counterexample and reinforcing why not all numerical integrators preserve the symplectic form. ",
            "id": "3770976",
            "problem": "Consider a mechanical system with configuration space $\\mathbb{R}$ and Lagrangian $L(q,\\dot{q})=\\tfrac{1}{2} m \\dot{q}^{2}-V(q)$, where $m>0$ and $V:\\mathbb{R}\\to\\mathbb{R}$ is smooth. The continuous action over a time interval $[0,T]$ is $S[q]=\\int_{0}^{T} L(q(t),\\dot{q}(t))\\,\\mathrm{d}t$. One constructs a naive discrete action by a left-endpoint quadrature with step size $h=T/N$,\n$$\nS_{d}^{\\mathrm{left}}(q_{0},\\dots,q_{N})=\\sum_{k=0}^{N-1} h\\,L\\!\\left(q_{k},\\frac{q_{k+1}-q_{k}}{h}\\right).\n$$\nHowever, suppose instead of applying the discrete variational principle to $S_{d}^{\\mathrm{left}}$, one directly discretizes Hamilton’s equations for the associated Hamiltonian $H(q,p)=\\tfrac{1}{2m}p^{2}+V(q)$ by an explicit forward Euler step to obtain a time-$h$ map $(q_{k},p_{k})\\mapsto(q_{k+1},p_{k+1})$:\n$$\nq_{k+1}=q_{k}+h\\,\\frac{\\partial H}{\\partial p}(q_{k},p_{k}),\\qquad p_{k+1}=p_{k}-h\\,\\frac{\\partial H}{\\partial q}(q_{k},p_{k}).\n$$\nSpecialize to the harmonic oscillator $V(q)=\\tfrac{1}{2}k q^{2}$ with $k>0$, so that $H(q,p)=\\tfrac{1}{2m}p^{2}+\\tfrac{1}{2}k q^{2}$. \n\nTasks:\n- Present the explicit forward Euler update for this harmonic oscillator and explain, from first principles of discrete variational mechanics, precisely which structural requirement is violated by producing this map from the naive discretization, thereby yielding a non-symplectic integrator.\n- Then, to certify non-symplecticity by a direct calculation, compute the determinant of the Jacobian matrix of the one-step map $(q_{k},p_{k})\\mapsto(q_{k+1},p_{k+1})$ as a function of $h$, $m$, and $k$. \n\nProvide your final answer as a single simplified symbolic expression in terms of $h$, $m$, and $k$. No numerical evaluation is required, and no units are needed in the final boxed expression. If you introduce any angles, express them in radians. Do not include inequalities or equations as your final answer; only the requested expression.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of classical and geometric mechanics, is well-posed with a unique and meaningful solution, and is formulated using objective, unambiguous language.\n\nThe problem asks for two main tasks concerning the explicit forward Euler discretization of Hamilton's equations for a harmonic oscillator. First, to explain from the principles of discrete variational mechanics why this method is non-symplectic. Second, to verify this non-symplecticity by direct computation of the determinant of the map's Jacobian.\n\nLet the system be described by the configuration coordinate $q \\in \\mathbb{R}$ and its conjugate momentum $p \\in \\mathbb{R}$. The Hamiltonian for the harmonic oscillator is given as $H(q,p)=\\frac{1}{2m}p^{2}+\\frac{1}{2}k q^{2}$, where $m > 0$ and $k > 0$.\n\nHamilton's equations are:\n$$\n\\dot{q} = \\frac{\\partial H}{\\partial p} = \\frac{p}{m}\n$$\n$$\n\\dot{p} = -\\frac{\\partial H}{\\partial q} = -kq\n$$\n\nThe explicit forward Euler method discretizes these ordinary differential equations with a time step $h$ as follows:\n$$\nq_{k+1} = q_{k} + h \\dot{q}_{k} = q_{k} + h \\frac{\\partial H}{\\partial p}(q_{k}, p_{k})\n$$\n$$\np_{k+1} = p_{k} + h \\dot{p}_{k} = p_{k} - h \\frac{\\partial H}{\\partial q}(q_{k}, p_{k})\n$$\nSubstituting the partial derivatives of the specific harmonic oscillator Hamiltonian, we obtain the explicit one-step map $(q_{k},p_{k}) \\mapsto (q_{k+1},p_{k+1})$:\n$$\nq_{k+1} = q_{k} + \\frac{h}{m} p_{k}\n$$\n$$\np_{k+1} = p_{k} - h k q_{k}\n$$\n\nNow, we address the first task: the explanation from first principles of discrete variational mechanics. A numerical integrator is a variational integrator if and only if it can be derived from a discrete Lagrangian, $L_d(q_k, q_{k+1})$, which approximates the action integral over a single time step, $\\int_{t_k}^{t_{k+1}} L(q, \\dot{q}) \\, \\mathrm{d}t$. The map $(q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$ is then defined implicitly by the discrete Legendre transforms:\n$$\np_k = -\\frac{\\partial L_d}{\\partial q_k}(q_k, q_{k+1})\n$$\n$$\np_{k+1} = \\frac{\\partial L_d}{\\partial q_{k+1}}(q_k, q_{k+1})\n$$\nThis structure, a direct consequence of the discrete variational principle, guarantees that the resulting map is symplectic. The structural requirement that the forward Euler method violates is precisely that it cannot be generated by any such discrete Lagrangian $L_d$.\n\nTo demonstrate this violation, we can attempt to find an $L_d$ that generates the forward Euler map. From the first equation of the forward Euler map, $q_{k+1} = q_{k} + \\frac{h}{m} p_{k}$, we can express the momentum $p_k$ in terms of the positions:\n$$\np_{k} = \\frac{m}{h}(q_{k+1} - q_{k})\n$$\nEquating this with the first discrete Legendre transform equation, we have:\n$$\n-\\frac{\\partial L_d}{\\partial q_k} = \\frac{m}{h}(q_{k+1} - q_{k})\n$$\nIntegrating this with respect to $q_k$ gives a candidate form for $L_d$:\n$$\nL_d(q_k, q_{k+1}) = - \\frac{m}{h} \\left( q_{k+1}q_k - \\frac{1}{2}q_k^2 \\right) + C(q_{k+1})\n$$\nwhere $C(q_{k+1})$ is an arbitrary function of $q_{k+1}$.\n\nNow we use the second equation of the forward Euler map, $p_{k+1} = p_{k} - h k q_{k}$. Substituting our expression for $p_k$:\n$$\np_{k+1} = \\frac{m}{h}(q_{k+1} - q_{k}) - h k q_{k}\n$$\nThis expression for $p_{k+1}$ must be consistent with the second discrete Legendre transform, $p_{k+1} = \\frac{\\partial L_d}{\\partial q_{k+1}}$. Differentiating our candidate $L_d$ with respect to $q_{k+1}$:\n$$\n\\frac{\\partial L_d}{\\partial q_{k+1}} = -\\frac{m}{h} q_k + C'(q_{k+1})\n$$\nEquating the two expressions for $p_{k+1}$, we must have:\n$$\n\\frac{m}{h}(q_{k+1} - q_{k}) - h k q_{k} = -\\frac{m}{h} q_k + C'(q_{k+1})\n$$\nSimplifying this equation yields:\n$$\n\\frac{m}{h} q_{k+1} - h k q_{k} = C'(q_{k+1})\n$$\nThis equation presents a contradiction. The left-hand side depends on both $q_k$ and $q_{k+1}$, while the right-hand side, $C'(q_{k+1})$, can only depend on $q_{k+1}$. This equality can only hold if the term depending on $q_k$ vanishes, which would require $h k = 0$. However, both $h$ and $k$ are given as positive. Therefore, no function $L_d(q_k, q_{k+1})$ exists that can generate the forward Euler map. This failure to be derivable from a discrete action principle is the fundamental structural reason why the forward Euler integrator is not symplectic. The problem states that the naive discrete action $S_{d}^{\\mathrm{left}}$ is not used to derive the map; had it been used, it would have generated a symplectic integrator (specifically, the symplectic Euler B method), which is different from the forward Euler method.\n\nFor the second task, we directly certify non-symplecticity by computing the determinant of the Jacobian matrix of the one-step map. Let the map be $\\Phi_h: (q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$, defined by:\n$$\nq_{k+1} = f(q_k, p_k) = q_k + \\frac{h}{m} p_k\n$$\n$$\np_{k+1} = g(q_k, p_k) = -h k q_k + p_k\n$$\nThe Jacobian matrix, $J$, of this map is:\n$$\nJ = \\begin{pmatrix} \\frac{\\partial f}{\\partial q_k} & \\frac{\\partial f}{\\partial p_k} \\\\ \\frac{\\partial g}{\\partial q_k} & \\frac{\\partial g}{\\partial p_k} \\end{pmatrix}\n$$\nWe compute the four partial derivatives:\n$$\n\\frac{\\partial f}{\\partial q_k} = \\frac{\\partial}{\\partial q_k} \\left(q_k + \\frac{h}{m} p_k\\right) = 1\n$$\n$$\n\\frac{\\partial f}{\\partial p_k} = \\frac{\\partial}{\\partial p_k} \\left(q_k + \\frac{h}{m} p_k\\right) = \\frac{h}{m}\n$$\n$$\n\\frac{\\partial g}{\\partial q_k} = \\frac{\\partial}{\\partial q_k} \\left(-h k q_k + p_k\\right) = -hk\n$$\n$$\n\\frac{\\partial g}{\\partial p_k} = \\frac{\\partial}{\\partial p_k} \\left(-h k q_k + p_k\\right) = 1\n$$\nSubstituting these into the Jacobian matrix:\n$$\nJ = \\begin{pmatrix} 1 & \\frac{h}{m} \\\\ -hk & 1 \\end{pmatrix}\n$$\nThe determinant of the Jacobian is:\n$$\n\\det(J) = (1)(1) - \\left(\\frac{h}{m}\\right)(-hk) = 1 + \\frac{h^2 k}{m}\n$$\nA map is symplectic if and only if its Jacobian is a symplectic matrix. A necessary condition for a matrix to be symplectic is that its determinant must be equal to $1$. Since $h>0$, $k>0$, and $m>0$, the term $\\frac{h^2 k}{m}$ is strictly positive. Thus, $\\det(J) = 1 + \\frac{h^2 k}{m} > 1$. As the determinant is not equal to $1$, the forward Euler map is not symplectic. This means that the map does not preserve the phase space volume element $\\mathrm{d}q \\wedge \\mathrm{d}p$, and in this case, it expands it at every step. This calculation provides direct verification of the conclusion drawn from the principles of variational mechanics.",
            "answer": "$$\\boxed{1 + \\frac{h^2 k}{m}}$$"
        },
        {
            "introduction": "Theory provides the blueprint for symplectic methods, but practical implementation demands verification. This practice moves from analytical derivation to computational diagnosis, challenging you to build a numerical tool that tests for symplecticity. By approximating the Jacobian of an update map and checking the fundamental symplectic condition, you will gain a powerful technique to confirm the geometric integrity of any given integrator, bridging the gap between abstract theory and concrete code. ",
            "id": "3770944",
            "problem": "You are asked to construct and apply a numerical diagnostic for symplecticity of discrete-time updates arising from variational integrators in geometric mechanics. The goal is to verify the preservation of the canonical symplectic form under the discrete flow by computing the Jacobian matrix of the update and evaluating a matrix identity. The diagnostic should be demonstrated on integrators derived from discrete variational principles and contrasted against a baseline integrator that is not variational.\n\nStart from the discrete version of Hamilton's principle, which postulates that true trajectories extremize a discrete action built from a discrete Lagrangian. Use the one degree-of-freedom harmonic oscillator defined by the standard Lagrangian $L(q,\\dot{q}) = \\tfrac{1}{2} m \\dot{q}^{2} - \\tfrac{1}{2} k q^{2}$ with $m = 1$ and $k > 0$. Let the time step be $h > 0$. Define the discrete state $z = (q,p) \\in \\mathbb{R}^{2}$ with canonical symplectic form represented by the constant matrix\n$$\n\\Omega = \\begin{bmatrix}\n0 & 1 \\\\\n-1 & 0\n\\end{bmatrix}.\n$$\nThe discrete update map is a function $\\Phi_{h} : \\mathbb{R}^{2} \\to \\mathbb{R}^{2}$ taking $z_{k}$ to $z_{k+1}$.\n\nYour tasks are:\n- Derive update maps $\\Phi_{h}$ for two discrete variational integrators (define the class of integrators from the discrete Hamilton's principle and appropriate quadrature choices for the discrete Lagrangian). The first integrator should correspond to a second-order position-momentum scheme typically associated with a trapezoidal rule construction, and the second integrator should correspond to a one-step implicit scheme associated with the midpoint rule construction. For comparison, also include a baseline explicit first-order method that is not derived from the discrete variational principle.\n- Implement each update map as a function that takes $(q,p)$, the step size $h$, and stiffness $k$, and returns the updated state $(q',p')$.\n- Design a numerical symplecticity diagnostic by computing the Jacobian matrix $J \\in \\mathbb{R}^{2 \\times 2}$ of $\\Phi_{h}$ at a given state $z$ using central finite differences with a small perturbation magnitude. Verify the symplectic condition\n$$\nJ^{\\mathsf{T}} \\Omega J = \\Omega\n$$\nnumerically by computing the residual matrix\n$$\nR = J^{\\mathsf{T}} \\Omega J - \\Omega\n$$\nand its Frobenius norm. Declare the update to be symplectic if the Frobenius norm of $R$ is less than a given tolerance.\n- Use real-valued computations only; no angles are involved, and no physical units are required in the output. Ensure numerical robustness by choosing a central-difference perturbation size that accurately resolves the Jacobian entries while remaining within double-precision limits.\n- Implement the diagnostic to return a boolean for each test case indicating whether the symplecticity condition holds within the tolerance.\n\nTest Suite and Output Specification:\n- Use the following test cases, each specified by an integrator label, step size $h$, stiffness $k$, an evaluation state $z$, and a symplecticity tolerance $\\tau$ for the Frobenius norm of $R$:\n    1. Variational second-order scheme (trapezoidal construction), $h = 0.1$, $k = 1.0$, $z = (0.7,-0.3)$, $\\tau = 10^{-12}$.\n    2. Variational second-order scheme (trapezoidal construction), $h = 10^{-12}$, $k = 1.0$, $z = (0.7,-0.3)$, $\\tau = 10^{-12}$.\n    3. Explicit first-order baseline method (not variational), $h = 0.1$, $k = 1.0$, $z = (0.7,-0.3)$, $\\tau = 10^{-12}$.\n    4. Variational one-step implicit scheme (midpoint construction), $h = 0.1$, $k = 3.0$, $z = (0.3,0.4)$, $\\tau = 10^{-12}$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[r_{1},r_{2},r_{3},r_{4}]$, where each $r_{i}$ is a boolean value indicating whether $J^{\\mathsf{T}} \\Omega J = \\Omega$ was satisfied within the specified tolerance for the corresponding test case.\n\nAll mathematical statements, symbols, variables, functions, operators, and numbers must be expressed in LaTeX using inline notation with dollar signs. Define any acronym upon first use. The final answer must be a complete, runnable Python program that computes and prints the requested single-line output with no additional text.",
            "solution": "The problem requires the construction and application of a numerical diagnostic to verify the symplecticity of several discrete-time update maps for the harmonic oscillator. The foundation for this analysis is the theory of geometric numerical integration, which seeks to design numerical methods that preserve the geometric properties of the underlying continuous dynamical system. One of the most important such properties is symplecticity, which corresponds to the preservation of phase space volume and is a hallmark of Hamiltonian mechanics.\n\nThe continuous system under consideration is the one degree-of-freedom harmonic oscillator, described by the Lagrangian $L(q,\\dot{q}) = \\frac{1}{2} m \\dot{q}^{2} - \\frac{1}{2} k q^{2}$. As specified, we set the mass $m=1$. The state of the system is given by the position-momentum pair $z = (q,p) \\in \\mathbb{R}^{2}$. The conjugate momentum is $p = \\frac{\\partial L}{\\partial \\dot{q}} = m\\dot{q} = \\dot{q}$. The corresponding Hamiltonian is $H(q,p) = p\\dot{q} - L = \\frac{1}{2} p^2 + \\frac{1}{2} k q^2$. The dynamics are governed by Hamilton's equations, $\\dot{z} = J_{can} \\nabla H(z)$, where $J_{can}$ is the canonical symplectic matrix, which in this problem is denoted $\\Omega = \\begin{bmatrix} 0  1 \\\\ -1  0 \\end{bmatrix}$. A map $\\Phi: \\mathbb{R}^2 \\to \\mathbb{R}^2$ is symplectic if its Jacobian matrix, $J = D\\Phi$, satisfies the condition $J^{\\mathsf{T}} \\Omega J = \\Omega$.\n\nWe will derive three update maps, $\\Phi_h: z_k \\mapsto z_{k+1}$ where $z_k = (q_k, p_k)$, and then test their symplecticity numerically.\n\nFirst, we derive the variational integrators from a discrete version of Hamilton's principle. This principle states that the discrete trajectory $\\{q_k\\}_{k=0}^N$ extremizes the discrete action $S_d = \\sum_{k=0}^{N-1} L_d(q_k, q_{k+1}, h)$, where $L_d$ is a discrete Lagrangian that approximates the action integral over a single time step $h$. The resulting equations of motion are the discrete Euler-Lagrange (DEL) equations:\n$$D_1 L_d(q_k, q_{k+1}, h) + D_2 L_d(q_{k-1}, q_k, h) = 0$$\nwhere $D_i$ denotes the partial derivative with respect to the $i$-th argument. The update map from $(q_k, p_k)$ to $(q_{k+1}, p_{k+1})$ is defined implicitly through the discrete momenta:\n$$p_k = -D_1 L_d(q_k, q_{k+1}, h)$$\n$$p_{k+1} = D_2 L_d(q_k, q_{k+1}, h)$$\n\nA common and effective choice for the discrete Lagrangian is based on approximating the integral $\\int_{t_k}^{t_{k+1}} L(q(t), \\dot{q}(t)) dt$ using midpoint/trapezoidal quadrature rules. We approximate the velocity $\\dot{q}$ by a finite difference $(q_{k+1}-q_k)/h$ and the position $q$ by an average $(q_k+q_{k+1})/2$. This gives the discrete Lagrangian:\n$$L_d(q_k, q_{k+1}, h) = h L\\left(\\frac{q_k+q_{k+1}}{2}, \\frac{q_{k+1}-q_k}{h}\\right)$$\nFor the harmonic oscillator with $m=1$, this becomes:\n$$L_d(q_k, q_{k+1}, h) = h \\left[ \\frac{1}{2}\\left(\\frac{q_{k+1}-q_k}{h}\\right)^2 - \\frac{1}{2}k\\left(\\frac{q_k+q_{k+1}}{2}\\right)^2 \\right] = \\frac{1}{2h}(q_{k+1}-q_k)^2 - \\frac{kh}{8}(q_k+q_{k+1})^2$$\nFrom this, we derive the discrete momenta:\n$$p_k = -D_1 L_d = -\\left(-\\frac{1}{h}(q_{k+1}-q_k) - \\frac{kh}{4}(q_k+q_{k+1})\\right) = \\frac{q_{k+1}-q_k}{h} + \\frac{kh}{4}(q_k+q_{k+1})$$\n$$p_{k+1} = D_2 L_d = \\frac{1}{h}(q_{k+1}-q_k) - \\frac{kh}{4}(q_k+q_{k+1})$$\nRearranging these two equations gives the update rule. Summing them yields $\\frac{q_{k+1}-q_k}{h} = \\frac{p_k+p_{k+1}}{2}$, and subtracting yields $\\frac{p_{k+1}-p_k}{h} = -k \\frac{q_k+q_{k+1}}{2}$. This is precisely the implicit midpoint rule (or trapezoidal rule, as they are identical for a linear system) applied to Hamilton's equations $\\dot{q}=p, \\dot{p}=-kq$. This single derivation thus covers both the \"variational second-order scheme (trapezoidal construction)\" and the \"variational one-step implicit scheme (midpoint construction)\". We solve this linear system for $(q_{k+1}, p_{k+1})$:\n$$\n\\begin{bmatrix} 1  -h/2 \\\\ kh/2  1 \\end{bmatrix} \\begin{bmatrix} q_{k+1} \\\\ p_{k+1} \\end{bmatrix} = \\begin{bmatrix} 1  h/2 \\\\ -kh/2  1 \\end{bmatrix} \\begin{bmatrix} q_k \\\\ p_k \\end{bmatrix}\n$$\nInverting the matrix on the left, we obtain the explicit update map $\\Phi_h(z_k) = z_{k+1}$:\n$$\n\\begin{bmatrix} q_{k+1} \\\\ p_{k+1} \\end{bmatrix} = \\frac{1}{1 + \\frac{kh^2}{4}} \\begin{bmatrix} 1 - \\frac{kh^2}{4}  h \\\\ -kh  1 - \\frac{kh^2}{4} \\end{bmatrix} \\begin{bmatrix} q_k \\\\ p_k \\end{bmatrix}\n$$\nThis is a linear map, so its Jacobian $J$ is the constant matrix in the expression above. A quick check shows its determinant is $\\det(J) = 1$, which is a necessary condition for a $2 \\times 2$ map to be symplectic.\n\nFor comparison, we use a baseline non-variational method: the explicit first-order Euler method. This method is defined by approximating the derivative with a forward difference: $z_{k+1} = z_k + h f(z_k)$, where $f(z_k)$ represents the vector field of the differential equation. For our system:\n$$q_{k+1} = q_k + h p_k$$\n$$p_{k+1} = p_k - h k q_k$$\nThis can be written in matrix form:\n$$\n\\begin{bmatrix} q_{k+1} \\\\ p_{k+1} \\end{bmatrix} = \\begin{bmatrix} 1  h \\\\ -kh  1 \\end{bmatrix} \\begin{bmatrix} q_k \\\\ p_k \\end{bmatrix}\n$$\nThe Jacobian of this map is the constant matrix $J = \\begin{bmatrix} 1  h \\\\ -kh  1 \\end{bmatrix}$. Its determinant is $\\det(J) = 1 - (h)(-kh) = 1+kh^2$. Since $k  0$ and $h  0$, $\\det(J)  1$, which proves the map is not symplectic.\n\nThe numerical diagnostic for symplecticity proceeds as follows. For a given update map $\\Phi_h(z)$, we must compute its Jacobian $J(z)$. We employ central finite differences, which offer second-order accuracy. The columns of the $2 \\times 2$ Jacobian are computed as:\n$$J_{:,1} = \\frac{\\Phi_h(q+\\epsilon, p) - \\Phi_h(q-\\epsilon, p)}{2\\epsilon}, \\quad J_{:,2} = \\frac{\\Phi_h(q, p+\\epsilon) - \\Phi_h(q, p-\\epsilon)}{2\\epsilon}$$\nwhere $\\epsilon$ is a small perturbation. A value of $\\epsilon = 10^{-8}$ provides a good balance between truncation error (which scales as $\\epsilon^2$) and floating-point round-off error. Once the Jacobian $J$ is computed numerically at a state $z$, we evaluate the symplecticity condition by computing the residual matrix $R = J^{\\mathsf{T}} \\Omega J - \\Omega$. A map is considered numerically symplectic if the Frobenius norm of this residual, $\\|R\\|_F = \\sqrt{\\sum_{i,j} |R_{ij}|^2}$, is smaller than a specified tolerance $\\tau$. For a truly symplectic map, this norm will be zero analytically. Numerically, it will be a small number on the order of machine precision, resulting from floating-point arithmetic and the finite-difference approximation error. For a non-symplectic map, the norm will be significantly larger.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef variational_trapezoidal_midpoint_update(z, h, k):\n    \"\"\"\n    Implements the update for the variational integrator based on the\n    midpoint/trapezoidal rule for the harmonic oscillator.\n    z: current state [q, p]\n    h: time step\n    k: stiffness\n    \"\"\"\n    q, p = z\n    denominator = 1.0 + k * h**2 / 4.0\n    q_prime = ((1.0 - k * h**2 / 4.0) * q + h * p) / denominator\n    p_prime = (-k * h * q + (1.0 - k * h**2 / 4.0) * p) / denominator\n    return np.array([q_prime, p_prime])\n\ndef explicit_first_order_update(z, h, k):\n    \"\"\"\n    Implements the update for the explicit first-order Euler method\n    for the harmonic oscillator.\n    z: current state [q, p]\n    h: time step\n    k: stiffness\n    \"\"\"\n    q, p = z\n    q_prime = q + h * p\n    p_prime = p - h * k * q\n    return np.array([q_prime, p_prime])\n\nintegrator_map = {\n    \"Variational second-order scheme (trapezoidal construction)\": variational_trapezoidal_midpoint_update,\n    \"Variational one-step implicit scheme (midpoint construction)\": variational_trapezoidal_midpoint_update,\n    \"Explicit first-order baseline method (not variational)\": explicit_first_order_update,\n}\n\ndef check_symplecticity(integrator_func, z0, h, k, tolerance):\n    \"\"\"\n    Numerically checks if an integrator is symplectic at a given state.\n    integrator_func: The update map function.\n    z0: The state (q, p) at which to check.\n    h: time step.\n    k: stiffness.\n    tolerance: The threshold for the Frobenius norm of the residual.\n    \"\"\"\n    z0 = np.array(z0, dtype=float)\n\n    # A robust choice for perturbation size in central differences\n    epsilon = 1.0e-8\n\n    # Perturbation vectors for each dimension of the state space\n    e1 = np.array([epsilon, 0.0])\n    e2 = np.array([0.0, epsilon])\n\n    # Compute Jacobian J column by column using central differences\n    J_col1 = (integrator_func(z0 + e1, h, k) - integrator_func(z0 - e1, h, k)) / (2 * epsilon)\n    J_col2 = (integrator_func(z0 + e2, h, k) - integrator_func(z0 - e2, h, k)) / (2 * epsilon)\n\n    J = np.array([J_col1, J_col2]).T\n\n    # Canonical symplectic form matrix\n    Omega = np.array([[0.0, 1.0], [-1.0, 0.0]])\n\n    # Compute the residual matrix R = J^T * Omega * J - Omega\n    # The @ operator is used for matrix multiplication.\n    R = J.T @ Omega @ J - Omega\n    \n    # Compute the Frobenius norm of the residual matrix\n    residual_norm = np.linalg.norm(R, 'fro')\n\n    return residual_norm  tolerance\n\ndef solve():\n    \"\"\"\n    Runs the symplecticity diagnostic for the specified test cases and prints the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (\"Variational second-order scheme (trapezoidal construction)\", 0.1, 1.0, (0.7, -0.3), 1e-12),\n        (\"Variational second-order scheme (trapezoidal construction)\", 1e-12, 1.0, (0.7, -0.3), 1e-12),\n        (\"Explicit first-order baseline method (not variational)\", 0.1, 1.0, (0.7, -0.3), 1e-12),\n        (\"Variational one-step implicit scheme (midpoint construction)\", 0.1, 3.0, (0.3, 0.4), 1e-12)\n    ]\n\n    results = []\n    for label, h, k, z, tau in test_cases:\n        integrator_function = integrator_map[label]\n        is_symplectic = check_symplecticity(integrator_function, z, h, k, tau)\n        results.append(str(is_symplectic).lower())\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}