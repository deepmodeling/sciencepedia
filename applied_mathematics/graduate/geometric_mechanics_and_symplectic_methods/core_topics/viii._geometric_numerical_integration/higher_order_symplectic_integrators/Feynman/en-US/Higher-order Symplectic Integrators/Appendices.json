{
    "hands_on_practices": [
        {
            "introduction": "The technique of splitting a Hamiltonian into individually solvable parts, such as kinetic and potential energy, is the foundation of many powerful geometric integrators. This exercise provides fundamental practice in this 'divide and conquer' strategy. By deriving the exact flows for a separable Hamiltonian and composing them into the symmetric Strang splitting scheme, you will construct a complete second-order symplectic integrator from first principles, solidifying your understanding of how these methods work at the most basic level .",
            "id": "3746144",
            "problem": "Consider a one-dimensional particle of mass $m$ with Hamiltonian $H(q,p)=T(p)+V(q)$, where $T(p)=\\frac{p^{2}}{2m}$ and $V(q)=\\frac{\\lambda}{4}q^{4}$, with $\\lambda>0$ a constant. Starting from the definitions of Hamiltonian flow and Hamilton's equations, derive the exact flows generated by the kinetic sub-Hamiltonian $T(p)$ and the potential sub-Hamiltonian $V(q)$, and then implement one step of the symmetric second-order splitting known as Strang splitting with time step $h>0$ by composing a half step of the $V$-flow, a full step of the $T$-flow, and a half step of the $V$-flow. Let the initial state be $(q_{0},p_{0})$ at time $t=0$. Compute and present explicitly the resulting update formulas for $(q_{1},p_{1})$ after this single Strang splitting step in closed form, expressed solely in terms of $q_{0}$, $p_{0}$, $m$, $\\lambda$, and $h$. No rounding is required, and your final answer should be provided as symbolic expressions. The final reported result must be the analytic expressions for $q_{1}$ and $p_{1}$ only.",
            "solution": "The user wants me to solve the problem by following these steps:\n1. Validate the problem statement.\n2. If valid, derive the solution.\n\n### Step 1: Extract Givens\n- **Hamiltonian:** $H(q,p) = T(p) + V(q)$\n- **Kinetic Energy:** $T(p) = \\frac{p^{2}}{2m}$\n- **Potential Energy:** $V(q) = \\frac{\\lambda}{4}q^{4}$\n- **Constants:** $m > 0$, $\\lambda > 0$, $h > 0$\n- **Initial State:** $(q_0, p_0)$ at time $t=0$\n- **Task:** Derive the update formulas for one step of a specific Strang splitting scheme: composition of a half step of the $V$-flow, a full step of the $T$-flow, and a half step of the $V$-flow. The final state is $(q_1, p_1)$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is set within the well-established framework of Hamiltonian mechanics and geometric numerical integration. The Hamiltonian describes a one-dimensional anharmonic oscillator, a standard physical model. Strang splitting is a fundamental and widely used second-order symplectic integrator. The premises are physically and mathematically sound.\n- **Well-Posed:** The problem is clearly specified. The Hamiltonian is separable, a necessary condition for the splitting method described. All required information ($H$, initial conditions, parameters, and the specific composition of flows) is provided. The task of deriving the update formulas for a single step leads to a unique and meaningful result.\n- **Objective:** The problem is stated using precise, unambiguous mathematical and technical language, free of subjective content.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically grounded, well-posed, and objective. It does not violate any of the invalidity criteria. I will now proceed with the solution.\n\nThe problem requires the derivation of a one-step update rule for a particle with state $(q, p)$ evolving under the Hamiltonian $H(q,p) = T(p)+V(q) = \\frac{p^2}{2m} + \\frac{\\lambda}{4}q^4$. The evolution is approximated using a specific symmetric splitting method over a time step $h$.\n\nFirst, we must derive the exact flows generated by the kinetic sub-Hamiltonian $T(p)$ and the potential sub-Hamiltonian $V(q)$. The evolution of a system governed by a Hamiltonian $H$ is described by Hamilton's equations:\n$$\n\\dot{q} = \\frac{\\partial H}{\\partial p}, \\quad \\dot{p} = -\\frac{\\partial H}{\\partial q}\n$$\n\n**Flow for the Kinetic Sub-Hamiltonian $T(p)$**\nWe consider the system governed solely by $H_T = T(p) = \\frac{p^2}{2m}$. Hamilton's equations for this subsystem are:\n$$\n\\dot{q} = \\frac{\\partial T}{\\partial p} = \\frac{\\partial}{\\partial p} \\left( \\frac{p^2}{2m} \\right) = \\frac{p}{m}\n$$\n$$\n\\dot{p} = -\\frac{\\partial T}{\\partial q} = 0\n$$\nTo find the flow over a time interval $\\Delta t$, we integrate these ordinary differential equations. Starting from an initial state $(q_{\\text{init}}, p_{\\text{init}})$ at $t=0$:\nThe equation $\\dot{p} = 0$ implies that $p(t)$ is constant. Thus, $p(t) = p_{\\text{init}}$.\nSubstituting this into the first equation gives $\\dot{q} = \\frac{p_{\\text{init}}}{m}$. Integrating this with respect to time yields:\n$$\nq(\\Delta t) = q_{\\text{init}} + \\int_0^{\\Delta t} \\frac{p_{\\text{init}}}{m} dt = q_{\\text{init}} + \\frac{p_{\\text{init}}}{m} \\Delta t\n$$\nThe exact flow map for the kinetic part, $\\Phi_T^{\\Delta t}$, is therefore:\n$$\n\\Phi_T^{\\Delta t}(q, p) = \\left(q + \\frac{p}{m} \\Delta t, \\, p\\right)\n$$\n\n**Flow for the Potential Sub-Hamiltonian $V(q)$**\nNext, we consider the system governed solely by $H_V = V(q) = \\frac{\\lambda}{4}q^4$. Hamilton's equations for this subsystem are:\n$$\n\\dot{q} = \\frac{\\partial V}{\\partial p} = 0\n$$\n$$\n\\dot{p} = -\\frac{\\partial V}{\\partial q} = -\\frac{\\partial}{\\partial q} \\left( \\frac{\\lambda}{4}q^4 \\right) = -\\lambda q^3\n$$\nIntegrating these equations over a time interval $\\Delta t$ from an initial state $(q_{\\text{init}}, p_{\\text{init}})$:\nThe equation $\\dot{q} = 0$ implies that $q(t)$ is constant. Thus, $q(t) = q_{\\text{init}}$.\nSubstituting this into the second equation gives $\\dot{p} = -\\lambda q_{\\text{init}}^3$. Integrating this with respect to time yields:\n$$\np(\\Delta t) = p_{\\text{init}} + \\int_0^{\\Delta t} (-\\lambda q_{\\text{init}}^3) dt = p_{\\text{init}} - \\lambda q_{\\text{init}}^3 \\Delta t\n$$\nThe exact flow map for the potential part, $\\Phi_V^{\\Delta t}$, is therefore:\n$$\n\\Phi_V^{\\Delta t}(q, p) = \\left(q, \\, p - \\lambda q^3 \\Delta t\\right)\n$$\n\n**Strang Splitting Step**\nThe problem specifies a second-order symmetric splitting scheme given by the composition of a half step of the $V$-flow, a full step of the $T$-flow, and another half step of the $V$-flow. The operator for one step of size $h$, denoted $\\mathcal{S}_h$, is the composition of these flows, which are applied from right to left:\n$$\n\\mathcal{S}_h = \\Phi_V^{h/2} \\circ \\Phi_T^h \\circ \\Phi_V^{h/2}\n$$\nThis is a valid form of Strang splitting, often used in position-Verlet or leapfrog integration schemes. Let the state at the beginning of the step be $(q_0, p_0)$. The state after one step, $(q_1, p_1)$, is given by $\\mathcal{S}_h(q_0, p_0)$. We compute this by applying the maps sequentially.\n\n1.  **First half-step with $V$-flow:** Let $(q_a, p_a) = \\Phi_V^{h/2}(q_0, p_0)$. The time interval is $\\Delta t = h/2$.\n    $$\n    q_a = q_0\n    $$\n    $$\n    p_a = p_0 - \\lambda q_0^3 \\frac{h}{2}\n    $$\n\n2.  **Full step with $T$-flow:** Let $(q_b, p_b) = \\Phi_T^h(q_a, p_a)$. The time interval is $\\Delta t = h$.\n    $$\n    q_b = q_a + \\frac{p_a}{m} h\n    $$\n    $$\n    p_b = p_a\n    $$\n    Substituting the expressions for $(q_a, p_a)$:\n    $$\n    q_b = q_0 + \\frac{h}{m} \\left(p_0 - \\frac{\\lambda h}{2} q_0^3 \\right) = q_0 + \\frac{h p_0}{m} - \\frac{\\lambda h^2}{2m} q_0^3\n    $$\n    $$\n    p_b = p_0 - \\frac{\\lambda h}{2} q_0^3\n    $$\n\n3.  **Second half-step with $V$-flow:** The final state is $(q_1, p_1) = \\Phi_V^{h/2}(q_b, p_b)$. The time interval is $\\Delta t = h/2$.\n    $$\n    q_1 = q_b\n    $$\n    $$\n    p_1 = p_b - \\lambda q_b^3 \\frac{h}{2}\n    $$\n    Substituting the expressions for $(q_b, p_b)$:\n    For $q_1$:\n    $$\n    q_1 = q_b = q_0 + \\frac{h p_0}{m} - \\frac{\\lambda h^2}{2m} q_0^3\n    $$\n    For $p_1$:\n    $$\n    p_1 = \\left(p_0 - \\frac{\\lambda h}{2} q_0^3\\right) - \\frac{\\lambda h}{2} \\left(q_0 + \\frac{h p_0}{m} - \\frac{\\lambda h^2}{2m} q_0^3\\right)^3\n    $$\n\nThese are the explicit, closed-form update formulas for $(q_1, p_1)$ expressed solely in terms of the initial state $(q_0, p_0)$ and the system parameters $m, \\lambda, h$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nq_{0} + \\frac{h p_{0}}{m} - \\frac{\\lambda h^{2} q_{0}^{3}}{2m} & p_{0} - \\frac{\\lambda h}{2} q_{0}^{3} - \\frac{\\lambda h}{2} \\left( q_{0} + \\frac{h p_{0}}{m} - \\frac{\\lambda h^{2} q_{0}^{3}}{2m} \\right)^{3}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from second-order to higher-order accuracy without sacrificing the symplectic structure is a key challenge. A remarkably elegant solution, pioneered by researchers like Yoshida, Forest, and Ruth, is to compose a basic symmetric second-order integrator with itself using a specific sequence of scaled time steps. This practice guides you through the Lie-algebraic derivation, based on the Baker-Campbell-Hausdorff formula, to uncover the algebraic conditions these scaling coefficients must satisfy to cancel the leading error term and achieve fourth-order accuracy .",
            "id": "3746170",
            "problem": "Consider a Hamiltonian system on a symplectic manifold with Hamiltonian $H = A + B + C$, where $A$, $B$, and $C$ are smooth functions whose associated Hamiltonian vector fields generate flows that can be computed exactly. Let $L_{A}$, $L_{B}$, and $L_{C}$ be the corresponding Lie derivative operators so that the exact flow over time $h$ is $\\exp\\!\\big(h(L_{A} + L_{B} + L_{C})\\big)$. Define the symmetric second-order kernel $S_{2}(h)$ by composing the exact subflows in the palindromic sequence\n$$\nS_{2}(h) \\equiv \\exp\\!\\big(\\tfrac{h}{2} L_{A}\\big)\\,\\exp\\!\\big(\\tfrac{h}{2} L_{B}\\big)\\,\\exp\\!\\big(h L_{C}\\big)\\,\\exp\\!\\big(\\tfrac{h}{2} L_{B}\\big)\\,\\exp\\!\\big(\\tfrac{h}{2} L_{A}\\big).\n$$\nYou seek a symmetric fourth-order symplectic integrator constructed by a composition of $S_{2}$ at scaled time steps:\n$$\n\\Phi(h) \\equiv \\prod_{i=1}^{s} S_{2}(\\gamma_{i} h),\n$$\nwith the composition taken in palindromic order and real coefficients $\\gamma_{i}$ to be determined. Starting from the Baker–Campbell–Hausdorff expansion and the fact that $S_{2}(h)$ is a symmetric second-order method, derive the necessary and sufficient algebraic conditions on the coefficients $\\{\\gamma_{i}\\}_{i=1}^{s}$ for $\\Phi(h)$ to achieve fourth-order accuracy for arbitrary $A$, $B$, and $C$. Then, restricting to the minimal nontrivial palindromic case $s=3$ with $\\gamma_{1}=\\gamma_{3}$, solve these conditions to produce one explicit working set of coefficients.\n\nYour final answer must be a single closed-form expression for the triple $(\\gamma_{1},\\gamma_{2},\\gamma_{3})$, written as a row matrix. No numerical rounding is required, and no physical units are involved. Express angles, if any, in radians. Do not report any inequalities or equations in the final answer; report only the coefficient triple.",
            "solution": "The problem is valid. It is a well-posed and standard problem in the field of geometric numerical integration, specifically the construction of higher-order symplectic integrators from a basic symmetric second-order kernel. All terms are formally defined and the problem is self-contained.\n\nLet $L_H = L_A + L_B + L_C$ be the Lie derivative operator associated with the full Hamiltonian $H$. The exact time evolution over a step $h$ is given by the operator $\\exp(h L_H)$.\nThe provided second-order kernel, $S_2(h)$, is a symmetric method. A method $\\Psi(h)$ is symmetric if $\\Psi(h)\\Psi(-h) = \\text{Id}$, which implies that its representation as the exponential of a single operator, $\\Psi(h) = \\exp(L_{\\Psi}(h))$, has a Lie-series expansion $L_{\\Psi}(h)$ containing only odd powers of $h$.\nSince $S_2(h)$ is a second-order method, its effective Lie operator, $L_{S_2}(h)$, must match the exact one up to order $h^2$. Thus, we can write its expansion as:\n$$\nL_{S_2}(h) = h L_H + K_3 h^3 + K_5 h^5 + \\mathcal{O}(h^7)\n$$\nwhere $K_3, K_5, \\ldots$ are operators expressed as nested Lie brackets of $L_A$, $L_B$, and $L_C$. For the method to be genuinely second-order and not higher, $K_3$ must be non-zero for an arbitrary choice of $A, B, C$.\n\nThe fourth-order integrator $\\Phi(h)$ is constructed by composing $s$ of these second-order kernels with scaled time steps $\\gamma_i h$:\n$$\n\\Phi(h) = \\prod_{i=1}^{s} S_2(\\gamma_i h) = S_2(\\gamma_1 h) S_2(\\gamma_2 h) \\cdots S_2(\\gamma_s h)\n$$\nExpressing each a term in this product as an exponential map, we have:\n$$\n\\Phi(h) = \\exp(L_{S_2}(\\gamma_1 h)) \\exp(L_{S_2}(\\gamma_2 h)) \\cdots \\exp(L_{S_2}(\\gamma_s h))\n$$\nTo find the single effective Lie operator $L_{\\Phi}(h)$ such that $\\Phi(h) = \\exp(L_{\\Phi}(h))$, we apply the Baker–Campbell–Hausdorff (BCH) formula. To leading orders, the BCH formula gives:\n$$\nL_{\\Phi}(h) = \\sum_{i=1}^{s} L_{S_2}(\\gamma_i h) + \\frac{1}{2} \\sum_{1 \\le i < j \\le s} [L_{S_2}(\\gamma_i h), L_{S_2}(\\gamma_j h)] + \\ldots\n$$\nSubstituting the expansion for $L_{S_2}(h)$:\n$$\nL_{S_2}(\\gamma_i h) = (\\gamma_i h) L_H + K_3 (\\gamma_i h)^3 + \\mathcal{O}(h^5)\n$$\nThe sum becomes:\n$$\n\\sum_{i=1}^{s} L_{S_2}(\\gamma_i h) = \\sum_{i=1}^{s} \\left( \\gamma_i h L_H + \\gamma_i^3 h^3 K_3 \\right) + \\mathcal{O}(h^5) = h \\left(\\sum_{i=1}^{s} \\gamma_i\\right) L_H + h^3 \\left(\\sum_{i=1}^{s} \\gamma_i^3\\right) K_3 + \\mathcal{O}(h^5)\n$$\nThe commutator term $[L_{S_2}(\\gamma_i h), L_{S_2}(\\gamma_j h)]$ is of order $\\mathcal{O}(h^2)$ in general, but its leading term is $[\\gamma_i h L_H, \\gamma_j h L_H] = \\gamma_i \\gamma_j h^2 [L_H, L_H] = 0$. The next terms in the commutator are of $\\mathcal{O}(h^4)$, so they do not affect the $\\mathcal{O}(h^3)$ term of the final operator.\nThus, the Lie operator for the composite method is:\n$$\nL_{\\Phi}(h) = h \\left(\\sum_{i=1}^{s} \\gamma_i\\right) L_H + h^3 \\left(\\sum_{i=1}^{s} \\gamma_i^3\\right) K_3 + \\mathcal{O}(h^5)\n$$\nFor $\\Phi(h)$ to be a fourth-order method, its Lie operator $L_{\\Phi}(h)$ must agree with the exact operator $h L_H$ up to terms of order $h^4$. This leads to two conditions on the coefficients $\\gamma_i$:\n1.  **Consistency (1st order correctness):** The coefficient of the $h L_H$ term must be $1$.\n    $$ \\sum_{i=1}^{s} \\gamma_i = 1 $$\n2.  **4th order correctness:** The coefficient of the $h^3 K_3$ error term must be zero.\n    $$ \\sum_{i=1}^{s} \\gamma_i^3 = 0 $$\nThese are the necessary and sufficient algebraic conditions.\n\nNow, we solve these conditions for the minimal nontrivial palindromic case $s=3$, where $\\gamma_1 = \\gamma_3$. The two conditions become a system of two equations for two unknowns, $\\gamma_1$ and $\\gamma_2$:\n1.  $2\\gamma_1 + \\gamma_2 = 1$\n2.  $2\\gamma_1^3 + \\gamma_2^3 = 0$\n\nFrom the first equation, we express $\\gamma_2$ in terms of $\\gamma_1$:\n$$ \\gamma_2 = 1 - 2\\gamma_1 $$\nSubstitute this into the second equation:\n$$ 2\\gamma_1^3 + (1 - 2\\gamma_1)^3 = 0 $$\nThis equation can be rearranged as:\n$$ (1 - 2\\gamma_1)^3 = -2\\gamma_1^3 $$\nSince the problem states that $\\gamma_i$ are real coefficients, we can take the real cube root of both sides:\n$$ 1 - 2\\gamma_1 = (-2)^{\\frac{1}{3}} \\gamma_1 = -2^{\\frac{1}{3}} \\gamma_1 $$\nNow we solve for $\\gamma_1$:\n$$ 1 = 2\\gamma_1 - 2^{\\frac{1}{3}}\\gamma_1 = \\gamma_1(2 - 2^{\\frac{1}{3}}) $$\n$$ \\gamma_1 = \\frac{1}{2 - 2^{\\frac{1}{3}}} $$\nFrom the palindromic condition, we have $\\gamma_3$:\n$$ \\gamma_3 = \\gamma_1 = \\frac{1}{2 - 2^{\\frac{1}{3}}} $$\nFinally, we find $\\gamma_2$ using the relation $\\gamma_2 = 1 - 2\\gamma_1$:\n$$ \\gamma_2 = 1 - 2 \\left( \\frac{1}{2 - 2^{\\frac{1}{3}}} \\right) = \\frac{(2 - 2^{\\frac{1}{3}}) - 2}{2 - 2^{\\frac{1}{3}}} = \\frac{-2^{\\frac{1}{3}}}{2 - 2^{\\frac{1}{3}}} $$\nThus, the explicit working set of coefficients is the triple $(\\gamma_1, \\gamma_2, \\gamma_3)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2 - 2^{\\frac{1}{3}}} & \\frac{-2^{\\frac{1}{3}}}{2 - 2^{\\frac{1}{3}}} & \\frac{1}{2 - 2^{\\frac{1}{3}}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Theory comes to life through implementation. This capstone exercise challenges you to apply the fourth-order composition technique from the previous practice  to the celebrated Kepler problem, a demanding and historically significant test for any numerical integrator. By coding this explicit splitting method and comparing its long-term energy conservation against a powerful implicit alternative—the Gauss collocation method—you will gain practical insight into the performance, cost, and trade-offs of different families of higher-order symplectic integrators .",
            "id": "3746162",
            "problem": "Consider the canonical Hamiltonian system for the planar Kepler problem in nondimensional units with gravitational parameter equal to $1$. The Hamiltonian is $H(q,p) = \\tfrac{1}{2}\\lVert p \\rVert^{2} - \\lVert q \\rVert^{-1}$, where $q \\in \\mathbb{R}^{2}$ and $p \\in \\mathbb{R}^{2}$. The Hamiltonian equations are $ \\dot{q} = \\partial H / \\partial p$ and $ \\dot{p} = - \\partial H / \\partial q$. The resulting ordinary differential equation is $ \\dot{q} = p$ and $ \\dot{p} = - q / \\lVert q \\rVert^{3}$. Angles, when they appear, must be interpreted in radians, and all quantities are nondimensional.\n\nStarting from the fundamental definitions of canonical Hamiltonian systems and collocation-based Runge–Kutta methods, derive the two-stage Gauss collocation method (which is an implicit Runge–Kutta method of order four that is symplectic) for general autonomous systems $ \\dot{y} = f(y)$. Then, specialize this method to the Kepler vector field defined by $ f(q,p) = (p, - q / \\lVert q \\rVert^{3})$ and implement it using a Newton iteration for the stage equations with an analytically derived Jacobian of the Kepler vector field. Separately, construct a fourth-order symplectic splitting integrator by composing three second-order symmetric Strang steps for the separable Hamiltonian $H = T(p) + V(q)$ into a fourth-order method (this is the standard fourth-order composition due to Hiroshi Yoshida). Implement this splitting for the Kepler problem by using the exact flows of $T$ and $V$ in each substep.\n\nUse both integrators to simulate long-time energy behavior over multiple orbital periods for the following initial conditions and numerical parameters. The orbits are elliptical with semi-major axis $a = 1$, so the orbital period is $T_{\\mathrm{orbit}} = 2\\pi$. Initialize each case at periapsis with $q(0) = (1 - e, 0)$ and $p(0) = (0, \\sqrt{(1+e)/(1-e)})$, which yields the same energy $H = -\\tfrac{1}{2}$ for all eccentricities $e$. For each case, integrate for $N_{\\mathrm{per}}$ periods using step size $h$, and compute the maximum absolute energy deviation over the entire simulation for each integrator,\n$$\nE_{\\max} = \\max_{0 \\le t \\le N_{\\mathrm{per}} T_{\\mathrm{orbit}}} \\left| H(q(t),p(t)) - H(q(0),p(0)) \\right|.\n$$\nTo ensure a fair comparison at similar computational cost, use the same $h$ for both methods in each case. All reported energy deviations must be in nondimensional energy units.\n\nThe test suite consists of the following four cases:\n- Case $1$: $e = 0$, $h = 0.05$, $N_{\\mathrm{per}} = 10$.\n- Case $2$: $e = 0.1$, $h = 0.05$, $N_{\\mathrm{per}} = 10$.\n- Case $3$: $e = 0.6$, $h = 0.02$, $N_{\\mathrm{per}} = 10$.\n- Case $4$: $e = 0.9$, $h = 0.005$, $N_{\\mathrm{per}} = 10$.\n\nYour program must implement both integrators, run them on all four cases, and output the maximum absolute energy deviations for the Gauss collocation and the fourth-order splitting methods, in that order, for each case. The final output must be a single line containing a list of four pairs $[E_{\\max}^{\\mathrm{Gauss}}, E_{\\max}^{\\mathrm{Split}}]$, one pair per case, in the order given above. The final output format must be exactly a comma-separated list enclosed in square brackets, for example, $[[x_{1},y_{1}],[x_{2},y_{2}],[x_{3},y_{3}],[x_{4},y_{4}]]$, where each $x_{i}$ and $y_{i}$ are floats representing the energy deviations for case $i$ in nondimensional energy units.",
            "solution": "The user has provided a scientifically sound, well-posed, and complete problem. I will now proceed with the formal derivation and solution.\n\nThe problem requires the derivation, implementation, and comparison of two fourth-order symplectic numerical integrators for the planar Kepler problem. The Hamiltonian is $H(q,p) = \\frac{1}{2}\\lVert p \\rVert^{2} - \\lVert q \\rVert^{-1}$, where $q, p \\in \\mathbb{R}^{2}$. The equations of motion are $\\dot{q} = p$ and $\\dot{p} = -q/\\lVert q \\rVert^3$. We represent the state of the system by a vector $y = (q_x, q_y, p_x, p_y)^T \\in \\mathbb{R}^4$. The system is an autonomous ordinary differential equation (ODE) of the form $\\dot{y} = f(y)$.\n\n### Part 1: Two-Stage Gauss Collocation Method\n\n#### General Derivation of Collocation Runge-Kutta Methods\nA collocation method approximates the solution of $\\dot{y} = f(y)$ over a time step $[t_n, t_{n+1}]$ of size $h = t_{n+1} - t_n$ by a polynomial $u(\\tau)$ of degree $s$. The polynomial is constrained to satisfy:\n1.  It matches the solution at the beginning of the step: $u(t_n) = y_n$.\n2.  It satisfies the differential equation at $s$ distinct collocation points $t_n + c_i h$ for $i=1, \\dots, s$, where $c_i \\in [0, 1]$ are the collocation nodes.\n    $$ \\dot{u}(t_n + c_i h) = f(u(t_n + c_i h)) $$\nThe numerical solution at the end of the step is then defined as $y_{n+1} = u(t_{n+1})$.\n\nLet us define the stage derivatives as $k_i = \\dot{u}(t_n + c_i h)$. The polynomial $\\dot{u}(t_n + \\tau h)$ has degree $s-1$ and passes through the points $(c_i, k_i)$. We can represent it using Lagrange basis polynomials $L_j(\\tau) = \\prod_{l \\neq j} \\frac{\\tau - c_l}{c_j - c_l}$:\n$$ \\dot{u}(t_n + \\tau h) = \\sum_{j=1}^s k_j L_j(\\frac{\\tau-t_n}{h}) $$\nIntegrating from $t_n$ to $t_n + \\tau h$ gives the polynomial $u$ itself:\n$$ u(t_n + \\tau h) = y_n + h \\int_0^\\tau \\sum_{j=1}^s k_j L_j(\\sigma) d\\sigma = y_n + h \\sum_{j=1}^s k_j \\int_0^\\tau L_j(\\sigma) d\\sigma $$\nThe stage values are $Y_i = u(t_n + c_i h)$. The collocation condition $k_i = f(Y_i)$ becomes:\n$$ Y_i = y_n + h \\sum_{j=1}^s k_j \\int_0^{c_i} L_j(\\sigma) d\\sigma $$\n$$ k_i = f(Y_i) = f\\left(y_n + h \\sum_{j=1}^s a_{ij} k_j\\right) \\quad \\text{where } a_{ij} = \\int_0^{c_i} L_j(\\sigma) d\\sigma $$\nThe final update is $y_{n+1} = u(t_n+h)$:\n$$ y_{n+1} = y_n + h \\sum_{j=1}^s k_j \\int_0^1 L_j(\\sigma) d\\sigma = y_n + h \\sum_{j=1}^s b_j k_j \\quad \\text{where } b_j = \\int_0^1 L_j(\\sigma) d\\sigma $$\nThis is the standard form of an $s$-stage Runge-Kutta method.\n\n#### Two-Stage Gauss-Legendre Method ($s=2$)\nGauss-Legendre methods are a family of collocation methods where the collocation points $c_i$ are the roots of the Legendre polynomial $P_s(x)$ shifted to the interval $[0,1]$. For $s=2$, we use the roots of $P_2(2x-1)$. The Legendre polynomial is $P_2(z) = \\frac{1}{2}(3z^2-1)$. The roots of $P_2(2x-1) = 6x^2-6x+1$ are:\n$$ c_{1,2} = \\frac{6 \\pm \\sqrt{36-24}}{12} = \\frac{1}{2} \\pm \\frac{\\sqrt{12}}{12} = \\frac{1}{2} \\pm \\frac{\\sqrt{3}}{6} $$\nThe Lagrange basis polynomials for these two points are $L_1(\\sigma) = \\frac{\\sigma-c_2}{c_1-c_2}$ and $L_2(\\sigma) = \\frac{\\sigma-c_1}{c_2-c_1}$. Calculating the integrals for $a_{ij}$ and $b_i$ yields the Butcher tableau:\n$$\n\\begin{array}{c|cc}\nc_1 & a_{11} & a_{12} \\\\\nc_2 & a_{21} & a_{22} \\\\\n\\hline\n& b_1 & b_2\n\\end{array}\n=\n\\begin{array}{c|cc}\n\\frac{1}{2} - \\frac{\\sqrt{3}}{6} & \\frac{1}{4} & \\frac{1}{4} - \\frac{\\sqrt{3}}{6} \\\\\n\\frac{1}{2} + \\frac{\\sqrt{3}}{6} & \\frac{1}{4} + \\frac{\\sqrt{3}}{6} & \\frac{1}{4} \\\\\n\\hline\n& \\frac{1}{2} & \\frac{1}{2}\n\\end{array}\n$$\nThis method is of order $2s=4$. A Runge-Kutta method is symplectic if $b_i > 0$ and the matrix $M$ with entries $M_{ij} = b_i a_{ij} + b_j a_{ji} - b_i b_j$ is the zero matrix. For the 2-stage Gauss method, $b_1=b_2=1/2$, and it is straightforward to verify that $M_{ij}=0$ for all $i,j \\in \\{1,2\\}$, thus the method is symplectic.\n\n#### Implementation for the Kepler Problem\nThe stage equations form a system of nonlinear equations for the stage derivatives $K_1, K_2 \\in \\mathbb{R}^4$:\n$$ K_1 = f\\left(y_n + h(a_{11}K_1 + a_{12}K_2)\\right) $$\n$$ K_2 = f\\left(y_n + h(a_{21}K_1 + a_{22}K_2)\\right) $$\nWe solve this $8$-dimensional system for $(K_1, K_2)$ using Newton's method. Let $Z = (K_1^T, K_2^T)^T \\in \\mathbb{R}^8$. We seek a root of the function $G(Z)=0$:\n$$ G(Z) = \\begin{pmatrix} K_1 - f(y_n + h(a_{11}K_1 + a_{12}K_2)) \\\\ K_2 - f(y_n + h(a_{21}K_1 + a_{22}K_2)) \\end{pmatrix} $$\nThe Newton iteration is $Z_{k+1} = Z_k - J_G(Z_k)^{-1} G(Z_k)$. The Jacobian $J_G = \\partial G / \\partial Z$ is an $8 \\times 8$ block matrix:\n$$ J_G = \\begin{pmatrix} I_4 - h a_{11} J_f(Y_1) & -h a_{12} J_f(Y_1) \\\\ -h a_{21} J_f(Y_2) & I_4 - h a_{22} J_f(Y_2) \\end{pmatrix} $$\nwhere $Y_1 = y_n + h(a_{11}K_1 + a_{12}K_2)$, $Y_2 = y_n + h(a_{21}K_1 + a_{22}K_2)$, $I_4$ is the $4 \\times 4$ identity matrix, and $J_f(y)$ is the Jacobian of the Kepler vector field $f(y)$.\n\nThe vector field is $f(q, p) = (p, -q/r^3)$ with $r = \\lVert q \\rVert$. The Jacobian $J_f(y) = \\partial f / \\partial y$ is:\n$$ J_f(q, p) = \\begin{pmatrix} \\partial \\dot{q} / \\partial q & \\partial \\dot{q} / \\partial p \\\\ \\partial \\dot{p} / \\partial q & \\partial \\dot{p} / \\partial p \\end{pmatrix} = \\begin{pmatrix} 0_{2 \\times 2} & I_{2 \\times 2} \\\\ A_{qp} & 0_{2 \\times 2} \\end{pmatrix} $$\nThe non-trivial block is $A_{qp} = \\partial(-q/r^3)/\\partial q$. Its components are:\n$$ (A_{qp})_{ij} = \\frac{\\partial}{\\partial q_j}\\left(-\\frac{q_i}{r^3}\\right) = -\\frac{\\delta_{ij}}{r^3} - q_i(-3r^{-4})\\frac{\\partial r}{\\partial q_j} = -\\frac{\\delta_{ij}}{r^3} + \\frac{3q_i q_j}{r^5} $$\nIn matrix form, $A_{qp} = \\frac{3}{r^5}qq^T - \\frac{1}{r^3}I_{2 \\times 2}$. Once the Newton iteration converges to find $K_1, K_2$, the state is updated: $y_{n+1} = y_n + \\frac{h}{2}(K_1 + K_2)$.\n\n### Part 2: Fourth-Order Symplectic Splitting Method\n\n#### General Theory of Splitting Methods\nFor a separable Hamiltonian $H(q,p) = T(p) + V(q)$, Hamilton's equations can be split into two exactly solvable subsystems:\n1.  $\\dot{q} = \\partial T / \\partial p$, $\\dot{p} = 0$, with exact flow $\\phi_t^T$.\n2.  $\\dot{q} = 0$, $\\dot{p} = -\\partial V / \\partial q$, with exact flow $\\phi_t^V$.\n\nA symplectic integrator can be constructed by composing these exact flows. Strang splitting provides a second-order symmetric integrator:\n$$ S_2(h) = \\phi_{h/2}^V \\circ \\phi_h^T \\circ \\phi_{h/2}^V $$\nThis method is symmetric ($S_2(-h) = S_2(h)^{-1}$) and symplectic.\n\n#### Yoshida's Fourth-Order Composition\nA fourth-order method can be created by composing three steps of a second-order symmetric method $S_2$:\n$$ S_4(h) = S_2(\\gamma_1 h) \\circ S_2(\\gamma_2 h) \\circ S_2(\\gamma_1 h) $$\nFor this composition to be of fourth order, the coefficients $\\gamma_i$ must satisfy $2\\gamma_1 + \\gamma_2 = 1$ and $2\\gamma_1^3 + \\gamma_2^3 = 0$. The solution is:\n$$ \\gamma_1 = \\frac{1}{2 - 2^{1/3}}, \\quad \\gamma_2 = -\\frac{2^{1/3}}{2 - 2^{1/3}} $$\nExpanding the composition $S_4(h)$ in terms of the elementary flows $\\phi^T$ and $\\phi^V$:\n$$ S_4(h) = [\\phi_{\\gamma_1 h/2}^V \\circ \\phi_{\\gamma_1 h}^T \\circ \\phi_{\\gamma_1 h/2}^V] \\circ [\\phi_{\\gamma_2 h/2}^V \\circ \\phi_{\\gamma_2 h}^T \\circ \\phi_{\\gamma_2 h/2}^V] \\circ [\\phi_{\\gamma_1 h/2}^V \\circ \\phi_{\\gamma_1 h}^T \\circ \\phi_{\\gamma_1 h/2}^V] $$\nBy combining adjacent $\\phi^V$ steps ($\\phi_{t_1}^V \\circ \\phi_{t_2}^V = \\phi_{t_1+t_2}^V$), we obtain a sequence of alternating drift and kick steps.\n\n#### Implementation for the Kepler Problem\nFor the Kepler Hamiltonian, we have $T(p) = \\frac{1}{2}\\lVert p \\rVert^2$ and $V(q) = -1/\\lVert q \\rVert$. The exact flows are:\n-   $\\phi_t^T(q,p) = (q+tp, p)$, which corresponds to a linear drift of positions (a \"kick\" on $q$).\n-   $\\phi_t^V(q,p) = (q, p - t(q/\\lVert q \\rVert^3))$, which corresponds to an impulse on momenta (a \"drift\" of $p$).\n\nThe composition $S_4(h)$ results in a 7-stage algorithm often called the Forest-Ruth method. Let one step be $(q,p) \\to (q_{new}, p_{new})$.\nThe algorithm is defined by coefficients $c_i$ for the momentum updates and $d_i$ for the position updates:\n$p \\leftarrow p + c_1 h F(q)$, $q \\leftarrow q + d_1 h M^{-1}p$, etc., where $F(q) = -\\nabla V(q) = -q/\\lVert q \\rVert^3$.\nThe sequence of operations for one step of size $h$ is:\n1. $p \\leftarrow p - c_1 h \\frac{q}{\\lVert q \\rVert^3}$\n2. $q \\leftarrow q + d_1 h p$\n3. $p \\leftarrow p - c_2 h \\frac{q}{\\lVert q \\rVert^3}$\n4. $q \\leftarrow q + d_2 h p$\n5. $p \\leftarrow p - c_3 h \\frac{q}{\\lVert q \\rVert^3}$\n6. $q \\leftarrow q + d_3 h p$\n7. $p \\leftarrow p - c_4 h \\frac{q}{\\lVert q \\rVert^3}$\n\nThe coefficients are derived from the $\\gamma_i$:\n- Position update coefficients: $d_1 = \\gamma_1$, $d_2 = \\gamma_2$, $d_3 = \\gamma_1$. Note $\\sum d_i = 1$.\n- Momentum update coefficients: $c_1 = \\gamma_1/2$, $c_2 = (\\gamma_1+\\gamma_2)/2$, $c_3 = c_2$, $c_4 = c_1$. Note $\\sum c_i = 1$. This corresponds to the composition $\\phi_{c_1 h}^V \\circ \\phi_{d_1 h}^T \\circ \\phi_{c_2 h}^V \\circ \\phi_{d_2 h}^T \\circ \\phi_{c_3 h}^V \\circ \\phi_{d_3 h}^T \\circ \\phi_{c_4 h}^V$. This method is explicit, easy to implement, and symplectic by construction.\n\nBoth integrators will be used to simulate the specified orbits, and the maximum absolute energy deviation $\\max_t |H(q(t), p(t)) - H(q(0), p(0))|$ will be computed as a measure of performance.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef H_kepler(y):\n    \"\"\"Computes the Hamiltonian for the Kepler problem.\"\"\"\n    q = y[:2]\n    p = y[2:]\n    r = np.linalg.norm(q)\n    return 0.5 * np.dot(p, p) - 1.0 / r\n\ndef f_kepler(y):\n    \"\"\"Computes the vector field for the Kepler problem.\"\"\"\n    q = y[:2]\n    p = y[2:]\n    r = np.linalg.norm(q)\n    f_val = np.zeros(4)\n    f_val[:2] = p\n    f_val[2:] = -q / (r**3)\n    return f_val\n\ndef Jf_kepler(y):\n    \"\"\"Computes the Jacobian of the Kepler vector field.\"\"\"\n    q = y[:2]\n    r = np.linalg.norm(q)\n    r5 = r**5\n    \n    A_qp = (3.0 / r5) * np.outer(q, q)\n    A_qp[0, 0] -= 1.0 / (r**3)\n    A_qp[1, 1] -= 1.0 / (r**3)\n    \n    Jf = np.zeros((4, 4))\n    Jf[0, 2] = 1.0\n    Jf[1, 3] = 1.0\n    Jf[2:, :2] = A_qp\n    return Jf\n\ndef gauss_step(y_n, h):\n    \"\"\"Performs one step of the 2-stage Gauss collocation method.\"\"\"\n    # Butcher tableau for 2-stage Gauss method\n    sqrt3 = np.sqrt(3.0)\n    a11 = 0.25\n    a12 = 0.25 - sqrt3 / 6.0\n    a21 = 0.25 + sqrt3 / 6.0\n    a22 = 0.25\n    \n    # Newton's method for stage equations\n    # Initial guess for stages K1, K2\n    K1 = f_kepler(y_n)\n    K2 = f_kepler(y_n)\n    \n    tol = 1e-15\n    max_iter = 10\n    \n    for _ in range(max_iter):\n        Y1 = y_n + h * (a11 * K1 + a12 * K2)\n        Y2 = y_n + h * (a21 * K1 + a22 * K2)\n        \n        G1 = K1 - f_kepler(Y1)\n        G2 = K2 - f_kepler(Y2)\n        G = np.concatenate((G1, G2))\n        \n        if np.linalg.norm(G) < tol:\n            break\n            \n        Jf1 = Jf_kepler(Y1)\n        Jf2 = Jf_kepler(Y2)\n        \n        # Assemble the 8x8 Jacobian J_G\n        I4 = np.identity(4)\n        J_G11 = I4 - h * a11 * Jf1\n        J_G12 = -h * a12 * Jf1\n        J_G21 = -h * a21 * Jf2\n        J_G22 = I4 - h * a22 * Jf2\n        J_G = np.block([[J_G11, J_G12], [J_G21, J_G22]])\n        \n        delta_Z = np.linalg.solve(J_G, -G)\n        \n        K1 += delta_Z[:4]\n        K2 += delta_Z[4:]\n\n    # Final update\n    y_n1 = y_n + h * 0.5 * (K1 + K2)\n    return y_n1\n\ndef yoshida_step(y_n, h):\n    \"\"\"Performs one step of the 4th-order Yoshida splitting method.\"\"\"\n    q = y_n[:2].copy()\n    p = y_n[2:].copy()\n\n    # Yoshida coefficients\n    gamma1 = 1.0 / (2.0 - 2.0**(1.0/3.0))\n    gamma2 = 1.0 - 2.0 * gamma1\n\n    # Coefficients for position and momentum updates\n    c1 = gamma1 / 2.0\n    c2 = (gamma1 + gamma2) / 2.0\n    c3 = c2\n    c4 = c1\n\n    d1 = gamma1\n    d2 = gamma2\n    d3 = d1\n\n    # Sequence of updates (Forest-Ruth algorithm)\n    # Step 1\n    p -= c1 * h * (q / np.linalg.norm(q)**3)\n    # Step 2\n    q += d1 * h * p\n    # Step 3\n    p -= c2 * h * (q / np.linalg.norm(q)**3)\n    # Step 4\n    q += d2 * h * p\n    # Step 5\n    p -= c3 * h * (q / np.linalg.norm(q)**3)\n    # Step 6\n    q += d3 * h * p\n    # Step 7\n    p -= c4 * h * (q / np.linalg.norm(q)**3)\n    \n    return np.concatenate((q, p))\n\ndef solve():\n    \"\"\"Main function to run simulations and produce the final output.\"\"\"\n    test_cases = [\n        {'e': 0.0, 'h': 0.05, 'N_per': 10},\n        {'e': 0.1, 'h': 0.05, 'N_per': 10},\n        {'e': 0.6, 'h': 0.02, 'N_per': 10},\n        {'e': 0.9, 'h': 0.005, 'N_per': 10},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        e = case['e']\n        h = case['h']\n        N_per = case['N_per']\n\n        # Initial conditions at periapsis\n        q0 = np.array([1.0 - e, 0.0])\n        p0 = np.array([0.0, np.sqrt((1.0 + e) / (1.0 - e))])\n        y0 = np.concatenate((q0, p0))\n        \n        H0 = H_kepler(y0)\n        \n        t_final = N_per * 2.0 * np.pi\n        n_steps = int(round(t_final / h))\n\n        # --- Gauss Collocation Method ---\n        y_gauss = y0.copy()\n        max_dev_gauss = 0.0\n        for _ in range(n_steps):\n            y_gauss = gauss_step(y_gauss, h)\n            H_n = H_kepler(y_gauss)\n            max_dev_gauss = max(max_dev_gauss, abs(H_n - H0))\n\n        # --- Yoshida Splitting Method ---\n        y_yoshida = y0.copy()\n        max_dev_yoshida = 0.0\n        for _ in range(n_steps):\n            y_yoshida = yoshida_step(y_yoshida, h)\n            H_n = H_kepler(y_yoshida)\n            max_dev_yoshida = max(max_dev_yoshida, abs(H_n - H0))\n            \n        results.append([max_dev_gauss, max_dev_yoshida])\n\n    # Format the final output string\n    result_str = \",\".join([f\"[{g:e},{s:e}]\" for g, s in results])\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        }
    ]
}