{
    "hands_on_practices": [
        {
            "introduction": "Understanding the motion of a rotating body requires describing its angular velocity from two different perspectives: a frame fixed in space and a frame attached to the body itself. This first practice challenges you to derive the fundamental relationship between the space angular velocity, $\\Omega$, and the body angular velocity, $\\omega$, starting from their definitions as elements of the Lie algebra $\\mathfrak{so}(3)$. Successfully completing this derivation solidifies your understanding of how the changing orientation of the body, represented by the rotation matrix $R(t)$, acts as the bridge connecting these two crucial descriptions of motion. ",
            "id": "3731342",
            "problem": "Consider the special orthogonal group $\\mathrm{SO}(3)$ and a continuously differentiable curve $R(t) \\in \\mathrm{SO}(3)$. Let the left-trivialized (space-frame) angular velocity $\\Omega(t) \\in \\mathbb{R}^{3}$ and the right-trivialized (body-frame) angular velocity $\\omega(t) \\in \\mathbb{R}^{3}$ be defined through the isomorphism between $\\mathbb{R}^{3}$ and the Lie algebra $\\mathfrak{so}(3)$ via the hat map $\\widehat{(\\cdot)} : \\mathbb{R}^{3} \\to \\mathfrak{so}(3)$ given by $\\widehat{v} w = v \\times w$ for all $v,w \\in \\mathbb{R}^{3}$. Specifically, define the angular velocities by the identities $\\widehat{\\Omega}(t) = \\dot{R}(t) R(t)^{\\top}$ and $\\widehat{\\omega}(t) = R(t)^{\\top} \\dot{R}(t)$. Recall that for a matrix Lie group, the adjoint representation $\\operatorname{Ad}_{g} : \\mathfrak{g} \\to \\mathfrak{g}$ is given by $\\operatorname{Ad}_{g} X = g X g^{-1}$ for $g \\in G$ and $X \\in \\mathfrak{g}$, and coincides with the differential at the identity of the conjugation map. Starting only from these definitions and the product rule for differentiation of matrix products, use the relation between left- and right-trivialized velocities on a Lie group to derive a closed-form expression for $\\Omega(t)$ in terms of $R(t)$ and $\\omega(t)$. Provide your final answer as a single analytic expression for $\\Omega(t)$ in terms of $R(t)$ and $\\omega(t)$. Angles are understood in radians. No numerical evaluation or rounding is required.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It consists of standard definitions from geometric mechanics and Lie group theory and asks for the derivation of a fundamental relationship between two well-defined quantities. No inconsistencies, ambiguities, or factual errors are present.\n\nWe are tasked with deriving a closed-form expression for the space-frame angular velocity, $\\Omega(t)$, in terms of the body-frame angular velocity, $\\omega(t)$, and the orientation matrix, $R(t)$. The derivation will proceed from the provided definitions.\n\nThe given definitions for the hatted versions of the space-frame and body-frame angular velocities are:\n$$\n\\widehat{\\Omega}(t) = \\dot{R}(t) R(t)^{\\top} \\quad (1)\n$$\n$$\n\\widehat{\\omega}(t) = R(t)^{\\top} \\dot{R}(t) \\quad (2)\n$$\nHere, $R(t)$ is an element of the special orthogonal group $\\mathrm{SO}(3)$, which means $R(t)$ is a $3 \\times 3$ orthogonal matrix with determinant $1$. A key property of any orthogonal matrix is that its inverse is equal to its transpose, i.e., $R(t)^{-1} = R(t)^{\\top}$. Therefore, $R(t)R(t)^{\\top} = R(t)^{\\top}R(t) = I$, where $I$ is the $3 \\times 3$ identity matrix.\n\nOur objective is to relate $\\Omega(t)$ and $\\omega(t)$. We can achieve this by first establishing a relationship between their hatted counterparts, $\\widehat{\\Omega}(t)$ and $\\widehat{\\omega}(t)$. Let us begin with equation $(2)$ and solve for the time derivative of the rotation matrix, $\\dot{R}(t)$. By left-multiplying both sides of equation $(2)$ by $R(t)$, we obtain:\n$$\nR(t) \\widehat{\\omega}(t) = R(t) \\left( R(t)^{\\top} \\dot{R}(t) \\right)\n$$\nUsing the associativity of matrix multiplication and the property that $R(t)R(t)^{\\top} = I$, the expression simplifies to:\n$$\nR(t) \\widehat{\\omega}(t) = \\left( R(t) R(t)^{\\top} \\right) \\dot{R}(t) = I \\dot{R}(t) = \\dot{R}(t)\n$$\nThis gives us an expression for $\\dot{R}(t)$ in terms of $R(t)$ and $\\widehat{\\omega}(t)$:\n$$\n\\dot{R}(t) = R(t) \\widehat{\\omega}(t) \\quad (3)\n$$\nThis relationship is known as the right-trivialized tangent vector, or body-velocity form.\n\nNow, we substitute this expression for $\\dot{R}(t)$ into the definition for $\\widehat{\\Omega}(t)$ from equation $(1)$:\n$$\n\\widehat{\\Omega}(t) = \\left( R(t) \\widehat{\\omega}(t) \\right) R(t)^{\\top}\n$$\nThis can be written as:\n$$\n\\widehat{\\Omega}(t) = R(t) \\widehat{\\omega}(t) R(t)^{\\top} \\quad (4)\n$$\nAs $R(t) \\in \\mathrm{SO}(3)$, its inverse is $R(t)^{-1} = R(t)^{\\top}$. Thus, we can write equation $(4)$ as:\n$$\n\\widehat{\\Omega}(t) = R(t) \\widehat{\\omega}(t) R(t)^{-1}\n$$\nThis is precisely the definition of the Adjoint representation of the Lie group $\\mathrm{SO}(3)$ on its Lie algebra $\\mathfrak{so}(3)$. Specifically, for $g = R(t) \\in \\mathrm{SO}(3)$ and $X = \\widehat{\\omega}(t) \\in \\mathfrak{so}(3)$, we have $\\widehat{\\Omega}(t) = \\operatorname{Ad}_{R(t)}(\\widehat{\\omega}(t))$.\n\nTo proceed from the Lie algebra elements to the vectors in $\\mathbb{R}^3$, we use a fundamental identity of the hat map associated with $\\mathrm{SO}(3)$. For any rotation matrix $A \\in \\mathrm{SO}(3)$ and any vector $v \\in \\mathbb{R}^3$, the following relation holds:\n$$\n\\widehat{Av} = A \\widehat{v} A^{\\top}\n$$\nThis identity connects the Adjoint action of the group on its algebra with the standard action of the group on the vector space $\\mathbb{R}^3$. Applying this identity to equation $(4)$ by setting $A = R(t)$ and $v = \\omega(t)$, we obtain:\n$$\nR(t) \\widehat{\\omega}(t) R(t)^{\\top} = \\widehat{R(t) \\omega(t)}\n$$\nSubstituting this back into equation $(4)$ yields:\n$$\n\\widehat{\\Omega}(t) = \\widehat{R(t) \\omega(t)}\n$$\nThe hat map, $\\widehat{(\\cdot)}: \\mathbb{R}^3 \\to \\mathfrak{so}(3)$, is a linear isomorphism. This means it is a one-to-one and onto mapping. Therefore, if the images of two vectors under the hat map are equal, the vectors themselves must be equal. By applying the inverse of the hat map to both sides of the last equation, we conclude:\n$$\n\\Omega(t) = R(t) \\omega(t)\n$$\nThis is the desired closed-form expression for the space-frame angular velocity $\\Omega(t)$ in terms of the rotation matrix $R(t)$ and the body-frame angular velocity $\\omega(t)$.",
            "answer": "$$\\boxed{\\Omega(t) = R(t) \\omega(t)}$$"
        },
        {
            "introduction": "The kinetic energy of a rotating rigid body is a cornerstone of its dynamics, but its mathematical expression depends on the chosen frame of reference. This practice guides you to explore this concept through the lens of Riemannian geometry on the Lie group $SO(3)$. By constructing two different kinetic energy functions—one from a left-invariant metric associated with the body frame and another from a right-invariant metric associated with the space frame—you will directly compute how they differ, revealing the non-trivial geometric consequences of the body's inertia distribution and orientation. ",
            "id": "3731346",
            "problem": "Consider the Special Orthogonal Group $\\mathrm{SO}(3)$ of rotations in three-dimensional Euclidean space and its Lie algebra $\\mathfrak{so}(3)$. Use the standard \"hat\" isomorphism $\\widehat{(\\cdot)} : \\mathbb{R}^3 \\to \\mathfrak{so}(3)$, defined so that for any $a \\in \\mathbb{R}^3$, the matrix $\\widehat{a} \\in \\mathfrak{so}(3)$ satisfies $\\widehat{a}\\,b = a \\times b$ for all $b \\in \\mathbb{R}^3$. For a differentiable curve $R(t) \\in \\mathrm{SO}(3)$, define the body angular velocity $\\widehat{\\omega}(t) := R(t)^{-1} \\dot{R}(t)$ and the space angular velocity $\\widehat{\\Omega}(t) := \\dot{R}(t) R(t)^{-1}$, where the overdot denotes time differentiation and the \"hat\" has been used to identify angular velocity vectors in $\\mathbb{R}^3$ with elements of $\\mathfrak{so}(3)$.\n\nLet $J$ be a positive-definite, symmetric inertia matrix in the body frame, with principal moments of inertia $I_1$, $I_2$, and $I_3$ along the body axes, so that $J = \\mathrm{diag}(I_1, I_2, I_3)$. Consider the bilinear form on $\\mathfrak{so}(3)$ that is induced from the inner product on $\\mathbb{R}^3$ via the \"hat\" isomorphism and $J$, namely, for angular velocity vectors $a, b \\in \\mathbb{R}^3$, define $\\langle \\widehat{a}, \\widehat{b} \\rangle_J := a^{\\top} J b$. Use this to construct two Riemannian metrics on $\\mathrm{SO}(3)$:\n- The left-invariant metric $g_L$ obtained by left-translating $\\langle \\cdot, \\cdot \\rangle_J$ from the identity to a general $R \\in \\mathrm{SO}(3)$.\n- The right-invariant metric $g_R$ obtained by right-translating $\\langle \\cdot, \\cdot \\rangle_J$ from the identity to a general $R \\in \\mathrm{SO}(3)$.\n\nFor a given orientation $R \\in \\mathrm{SO}(3)$ and tangent vector $\\dot{R} \\in T_R \\mathrm{SO}(3)$ at time $t_0$, define the kinetic energies as $T_L := \\frac{1}{2} g_L|_{R}(\\dot{R}, \\dot{R})$ and $T_R := \\frac{1}{2} g_R|_{R}(\\dot{R}, \\dot{R})$. Start from the fundamental definitions above, together with the standard properties of the adjoint representation of a Lie group and the $\\mathrm{SO}(3)$ action on $\\mathbb{R}^3$, to derive a closed-form expression for the difference $T_L - T_R$ at $t_0$ in terms of $J$, $R$, and the body angular velocity vector $\\omega(t_0)$.\n\nEvaluate this expression for the specific case where $R$ is a rotation by angle $\\theta$ about the spatial $z$-axis, i.e.,\n$$\nR(\\theta) = \\begin{pmatrix}\n\\cos\\theta & -\\sin\\theta & 0 \\\\\n\\sin\\theta & \\cos\\theta & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix},\n$$\nand the body angular velocity at $t_0$ is the vector $\\omega(t_0) = (\\omega_1, \\omega_2, \\omega_3)^{\\top}$ in the body principal-axis basis. Your final answer must be a single closed-form analytic expression (no intermediate equations) for $T_L - T_R$ in terms of $I_1$, $I_2$, $I_3$, $\\theta$ (in radians), and $\\omega_1$, $\\omega_2$, $\\omega_3$, and it must be expressed in Joules. No numerical rounding is required.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, objective, and complete. The provided definitions for the Lie group $\\mathrm{SO}(3)$, its Lie algebra $\\mathfrak{so}(3)$, the hat isomorphism, body and space angular velocities, and the inertia-induced bilinear form are all standard in the field of geometric mechanics. The construction of left- and right-invariant metrics from an inner product on the Lie algebra is a fundamental procedure in Riemannian geometry on Lie groups. The problem asks for a specific derivation based on these definitions. The problem is mathematically and physically sound, self-contained, and has a unique, derivable solution. The minor conflict between the instruction \"expressed in Joules\" and the formatting rule \"No Units\" is interpreted as a flaw in the prompt's formatting constraints, not the problem's content. The problem is therefore deemed valid.\n\nWe begin by formalizing the kinetic energies $T_L$ and $T_R$.\n\nThe left-invariant metric $g_L$ at a point $R \\in \\mathrm{SO}(3)$ is defined by left-translating the inner product $\\langle \\cdot, \\cdot \\rangle_J$ from the identity element $e$. For tangent vectors $\\dot{R}_1, \\dot{R}_2 \\in T_R\\mathrm{SO}(3)$, the metric is given by:\n$$g_L|_{R}(\\dot{R}_1, \\dot{R}_2) = \\langle L_{R^{-1}}*(\\dot{R}_1), L_{R^{-1}}*(\\dot{R}_2) \\rangle_J$$\nThe pushforward of the left translation map acts as $L_{R^{-1}}*(\\dot{R}) = R^{-1}\\dot{R}$. By definition, the body angular velocity is $\\widehat{\\omega} = R^{-1}\\dot{R}$. Thus, a tangent vector $\\dot{R}$ at $R$ is mapped to the Lie algebra element $\\widehat{\\omega}$ at the identity. The kinetic energy $T_L$ is then:\n$$T_L = \\frac{1}{2} g_L|_{R}(\\dot{R}, \\dot{R}) = \\frac{1}{2} \\langle R^{-1}\\dot{R}, R^{-1}\\dot{R} \\rangle_J = \\frac{1}{2} \\langle \\widehat{\\omega}, \\widehat{\\omega} \\rangle_J$$\nUsing the given definition $\\langle \\widehat{a}, \\widehat{b} \\rangle_J = a^{\\top} J b$, we have:\n$$T_L = \\frac{1}{2} \\omega^{\\top} J \\omega$$\nThis is the standard expression for the kinetic energy of a rigid body in the body frame.\n\nSimilarly, the right-invariant metric $g_R$ is defined by right-translating the inner product from the identity:\n$$g_R|_{R}(\\dot{R}_1, \\dot{R}_2) = \\langle R_{R^{-1}}*(\\dot{R}_1), R_{R^{-1}}*(\\dot{R}_2) \\rangle_J$$\nThe pushforward of the right translation map acts as $R_{R^{-1}}*(\\dot{R}) = \\dot{R}R^{-1}$. By definition, the space angular velocity is $\\widehat{\\Omega} = \\dot{R}R^{-1}$. The kinetic energy $T_R$ is therefore:\n$$T_R = \\frac{1}{2} g_R|_{R}(\\dot{R}, \\dot{R}) = \\frac{1}{2} \\langle \\dot{R}R^{-1}, \\dot{R}R^{-1} \\rangle_J = \\frac{1}{2} \\langle \\widehat{\\Omega}, \\widehat{\\Omega} \\rangle_J$$\nWhich gives:\n$$T_R = \\frac{1}{2} \\Omega^{\\top} J \\Omega$$\n\nNext, we establish the relationship between the body angular velocity vector $\\omega$ and the space angular velocity vector $\\Omega$. From their definitions:\n$$\\widehat{\\omega} = R^{-1}\\dot{R} \\quad \\text{and} \\quad \\widehat{\\Omega} = \\dot{R}R^{-1}$$\nFrom the first equation, we can write $\\dot{R} = R\\widehat{\\omega}$. Substituting this into the second equation gives:\n$$\\widehat{\\Omega} = (R\\widehat{\\omega})R^{-1} = R\\widehat{\\omega}R^{\\top}$$\nThis is the adjoint action of $R$ on $\\widehat{\\omega}$, i.e., $\\widehat{\\Omega} = \\mathrm{Ad}_R(\\widehat{\\omega})$. For the group $\\mathrm{SO}(3)$, this action corresponds to a rotation of the associated vector in $\\mathbb{R}^3$, such that $\\mathrm{Ad}_R(\\widehat{\\omega}) = \\widehat{R\\omega}$. Therefore, we have $\\widehat{\\Omega} = \\widehat{R\\omega}$, which implies $\\Omega = R\\omega$.\n\nSubstituting $\\Omega = R\\omega$ into the expression for $T_R$:\n$$T_R = \\frac{1}{2} (R\\omega)^{\\top} J (R\\omega) = \\frac{1}{2} \\omega^{\\top} R^{\\top} J R \\omega$$\nNow we can compute the difference $T_L - T_R$:\n$$T_L - T_R = \\frac{1}{2} \\omega^{\\top} J \\omega - \\frac{1}{2} \\omega^{\\top} R^{\\top} J R \\omega = \\frac{1}{2} \\omega^{\\top} (J - R^{\\top} J R) \\omega$$\n\nTo evaluate this for the specific case, we use the given forms for $J$ and $R$:\n$$J = \\begin{pmatrix} I_1 & 0 & 0 \\\\ 0 & I_2 & 0 \\\\ 0 & 0 & I_3 \\end{pmatrix}, \\quad R = \\begin{pmatrix} \\cos\\theta & -\\sin\\theta & 0 \\\\ \\sin\\theta & \\cos\\theta & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}, \\quad \\omega = \\begin{pmatrix} \\omega_1 \\\\ \\omega_2 \\\\ \\omega_3 \\end{pmatrix}$$\nLet $c = \\cos\\theta$ and $s = \\sin\\theta$. The transpose is $R^{\\top} = \\begin{pmatrix} c & s & 0 \\\\ -s & c & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}$.\nFirst, calculate the matrix product $R^{\\top} J R$:\n$$R^{\\top} J R = \\begin{pmatrix} c & s & 0 \\\\ -s & c & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} I_1 & 0 & 0 \\\\ 0 & I_2 & 0 \\\\ 0 & 0 & I_3 \\end{pmatrix} \\begin{pmatrix} c & -s & 0 \\\\ s & c & 0 \\\\ 0 & 0 & 1 \\end{pmatrix}$$\n$$R^{\\top} J R = \\begin{pmatrix} c & s & 0 \\\\ -s & c & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} I_1 c & -I_1 s & 0 \\\\ I_2 s & I_2 c & 0 \\\\ 0 & 0 & I_3 \\end{pmatrix} = \\begin{pmatrix} I_1 c^2 + I_2 s^2 & -I_1 cs + I_2 sc & 0 \\\\ -I_1 sc + I_2 cs & I_1 s^2 + I_2 c^2 & 0 \\\\ 0 & 0 & I_3 \\end{pmatrix}$$\n$$R^{\\top} J R = \\begin{pmatrix} I_1 \\cos^2\\theta + I_2 \\sin^2\\theta & (I_2 - I_1) \\sin\\theta\\cos\\theta & 0 \\\\ (I_2 - I_1) \\sin\\theta\\cos\\theta & I_1 \\sin^2\\theta + I_2 \\cos^2\\theta & 0 \\\\ 0 & 0 & I_3 \\end{pmatrix}$$\nNow, we find the matrix $M = J - R^{\\top} J R$:\n$$M = \\begin{pmatrix} I_1 - (I_1 c^2 + I_2 s^2) & -(I_2 - I_1)sc & 0 \\\\ -(I_2 - I_1)sc & I_2 - (I_1 s^2 + I_2 c^2) & 0 \\\\ 0 & 0 & I_3 - I_3 \\end{pmatrix}$$\nThe entries simplify using $\\cos^2\\theta + \\sin^2\\theta = 1$:\n$$M_{11} = I_1(1-c^2) - I_2 s^2 = I_1 s^2 - I_2 s^2 = (I_1 - I_2)s^2$$\n$$M_{22} = I_2(1-c^2) - I_1 s^2 = I_2 s^2 - I_1 s^2 = -(I_1 - I_2)s^2$$\n$$M_{12} = M_{21} = -(I_2 - I_1)sc = (I_1 - I_2)sc$$\n$$M_{33} = 0$$\nSo the matrix $M$ is:\n$$M = (I_1 - I_2) \\begin{pmatrix} \\sin^2\\theta & \\sin\\theta\\cos\\theta & 0 \\\\ \\sin\\theta\\cos\\theta & -\\sin^2\\theta & 0 \\\\ 0 & 0 & 0 \\end{pmatrix}$$\nFinally, we compute the quadratic form $\\frac{1}{2} \\omega^{\\top} M \\omega$:\n$$T_L - T_R = \\frac{1}{2} \\begin{pmatrix} \\omega_1 & \\omega_2 & \\omega_3 \\end{pmatrix} (I_1 - I_2) \\begin{pmatrix} s^2 & sc & 0 \\\\ sc & -s^2 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} \\omega_1 \\\\ \\omega_2 \\\\ \\omega_3 \\end{pmatrix}$$\n$$T_L - T_R = \\frac{1}{2} (I_1 - I_2) \\left( \\omega_1 (s^2 \\omega_1 + sc \\omega_2) + \\omega_2 (sc \\omega_1 - s^2 \\omega_2) \\right)$$\n$$T_L - T_R = \\frac{1}{2} (I_1 - I_2) \\left( \\omega_1^2 s^2 + \\omega_1\\omega_2 sc + \\omega_1\\omega_2 sc - \\omega_2^2 s^2 \\right)$$\n$$T_L - T_R = \\frac{1}{2} (I_1 - I_2) \\left( (\\omega_1^2 - \\omega_2^2)s^2 + 2\\omega_1\\omega_2 sc \\right)$$\nSubstituting back $s = \\sin\\theta$ and $c = \\cos\\theta$, we obtain the final closed-form expression:\n$$T_L - T_R = \\frac{1}{2} (I_1 - I_2) \\left( (\\omega_1^2 - \\omega_2^2)\\sin^2\\theta + 2\\omega_1\\omega_2\\sin\\theta\\cos\\theta \\right)$$\nThis expression represents the difference in the two mathematically constructed kinetic energies, with units of energy (Joules in SI units), as a function of the body's inertia and its instantaneous orientation and angular velocity.\nThis can also be written using the double-angle identity for sine as:\n$$T_L - T_R = \\frac{1}{2} (I_1 - I_2) \\left( (\\omega_1^2 - \\omega_2^2)\\sin^2\\theta + \\omega_1\\omega_2\\sin(2\\theta) \\right)$$\nThe former expression is arguably more direct. We shall provide that one as the final answer.",
            "answer": "$$\n\\boxed{\\frac{1}{2} (I_1 - I_2) \\left( (\\omega_1^2 - \\omega_2^2)\\sin^2\\theta + 2\\omega_1\\omega_2\\sin\\theta\\cos\\theta \\right)}\n$$"
        },
        {
            "introduction": "Translating the continuous equations of motion for a rigid body into a robust computer simulation requires special care to preserve the geometric structure of the rotation group $SO(3)$. This hands-on coding challenge moves from theory to practice, tasking you with implementing a geometric numerical integrator. You will use the exponential map from the Lie algebra $\\mathfrak{so}(3)$ to the Lie group $SO(3)$ to ensure that each discrete time step correctly updates the orientation matrix, inherently preserving its orthogonality and preventing the accumulation of unphysical errors common in naive approaches. ",
            "id": "3731349",
            "problem": "Consider the special orthogonal group $SO(3)$ of orientation-preserving rotations in three-dimensional space. Let $R(t) \\in SO(3)$ denote the configuration (rotation matrix) of a rigid body at time $t$, and let the body angular velocity $\\omega(t) \\in \\mathbb{R}^3$ be defined by the kinematic relation $\\widehat{\\omega}(t) = R(t)^\\top \\dot{R}(t)$, where the hat map $\\widehat{\\cdot} : \\mathbb{R}^3 \\to \\mathfrak{so}(3)$ sends a vector to its corresponding skew-symmetric matrix. The space angular velocity $\\Omega(t) \\in \\mathbb{R}^3$ is defined by $\\widehat{\\Omega}(t) = \\dot{R}(t) R(t)^\\top$. These satisfy the relation $\\Omega(t) = R(t)\\,\\omega(t)$.\n\nThe geometric numerical integration problem is to evolve $R(t)$ in $SO(3)$ using a structure-preserving update that advances along the Lie group using the Lie algebra element associated to a time-averaged body angular velocity on each step. Your derivation and implementation must start from the fundamental kinematic relation $\\dot{R}(t) = R(t)\\,\\widehat{\\omega}(t)$ and the definition of the exponential map from $\\mathfrak{so}(3)$ to $SO(3)$, without invoking shortcut formulas.\n\nImplement a program that:\n- Derives a first-order accurate, group-preserving discrete update that maps $R_k \\in SO(3)$ at time $t_k$ to $R_{k+1} \\in SO(3)$ at time $t_{k+1} = t_k + h$ using the midpoint body angular velocity $\\omega(t_k + h/2)$.\n- Uses the matrix logarithm on $SO(3)$ to define a discrete space angular velocity over each step via\n$$\\widehat{\\Omega}_k^{\\mathrm{disc}} = \\frac{1}{h}\\,\\log\\!\\big(R_{k+1} R_k^\\top\\big),$$\nand compares it to the mapped midpoint body angular velocity $R_k\\,\\omega(t_k + h/2)$.\n\nFor each time step $k$, compute the following diagnostics:\n- The orthogonality error\n$$\\epsilon_{\\mathrm{ortho}}(k) = \\big\\|R_k^\\top R_k - I_3\\big\\|_F,$$\nwhere $\\|\\cdot\\|_F$ denotes the Frobenius norm.\n- The determinant error\n$$\\epsilon_{\\mathrm{det}}(k) = \\big|\\det(R_k) - 1\\big|.$$\n- The kinematic consistency error\n$$\\epsilon_{\\mathrm{kin}}(k) = \\big\\|\\Omega_k^{\\mathrm{disc}} - R_k\\,\\omega(t_k + h/2)\\big\\|_2,$$\nwhere $\\Omega_k^{\\mathrm{disc}} \\in \\mathbb{R}^3$ is the vector obtained by applying the inverse hat (vee) map to $\\widehat{\\Omega}_k^{\\mathrm{disc}}$.\n\nAfter $N$ steps, compute the final rotation angle\n$$\\theta_{\\mathrm{final}} = \\arccos\\!\\left(\\frac{\\operatorname{trace}(R_N) - 1}{2}\\right),$$\nexpressed in radians.\n\nAll angular velocities must be in radians per second (rad/s), and all angles must be in radians. All times must be in seconds (s). The initial condition is $R_0 = I_3$.\n\nTest Suite:\nImplement the above for the following four test cases, each with its own body angular velocity function $\\omega(t)$, final time $T$, and step size $h$:\n- Case $1$ (smooth, low-frequency): $T = 1.0\\,\\mathrm{s}$, $h = 0.01\\,\\mathrm{s}$, and\n$$\\omega(t) = \\begin{bmatrix} 0.3 \\sin(0.7 t) \\\\ 0.2 \\cos(0.5 t) \\\\ 0.1 \\end{bmatrix}\\ \\mathrm{rad/s}.$$\n- Case $2$ (zero motion): $T = 1.0\\,\\mathrm{s}$, $h = 0.02\\,\\mathrm{s}$, and\n$$\\omega(t) = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}\\ \\mathrm{rad/s}.$$\n- Case $3$ (single large step, constant body spin): $T = 1.2\\,\\mathrm{s}$, $h = 1.2\\,\\mathrm{s}$, and\n$$\\omega(t) = \\begin{bmatrix} 0 \\\\ 0 \\\\ 2.0 \\end{bmatrix}\\ \\mathrm{rad/s}.$$\n- Case $4$ (high-frequency content with moderate step): $T = 0.4\\,\\mathrm{s}$, $h = 0.05\\,\\mathrm{s}$, and\n$$\\omega(t) = \\begin{bmatrix} 2.0 \\sin(8 t) \\\\ -1.5 \\sin(9 t) \\\\ 1.0 \\cos(7 t) \\end{bmatrix}\\ \\mathrm{rad/s}.$$\n\nFor each case, report the following list of four floats:\n$$\\Big[\\max_k \\epsilon_{\\mathrm{ortho}}(k),\\ \\max_k \\epsilon_{\\mathrm{det}}(k),\\ \\max_k \\epsilon_{\\mathrm{kin}}(k),\\ \\theta_{\\mathrm{final}}\\Big].$$\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case and is itself a list of four floats as specified above (for example, $\\big[[a,b,c,d],[e,f,g,h]\\big]$). The output must contain no spaces.",
            "solution": "The problem requires the derivation and implementation of a geometric numerical integrator for the dynamics of a rigid body on the special orthogonal group $SO(3)$. The core task is to evolve the orientation matrix $R(t) \\in SO(3)$ according to the kinematic equation $\\dot{R}(t) = R(t)\\,\\widehat{\\omega}(t)$, where $\\omega(t) \\in \\mathbb{R}^3$ is the body-fixed angular velocity and $\\widehat{\\cdot}$ is the hat map from $\\mathbb{R}^3$ to the Lie algebra $\\mathfrak{so}(3)$ of skew-symmetric matrices.\n\nThe problem specifies a first-order accurate, structure-preserving update rule that uses the midpoint body angular velocity. We will first derive this integrator, then analyze the diagnostic quantities to be computed.\n\n**Derivation of the Geometric Integrator**\n\nThe fundamental kinematic ordinary differential equation (ODE) is:\n$$\n\\dot{R}(t) = R(t)\\,\\widehat{\\omega}(t)\n$$\nTo obtain a discrete update from time $t_k$ to $t_{k+1} = t_k + h$, we consider the ODE over this interval. The problem mandates using the midpoint body angular velocity, which implies approximating the potentially time-varying $\\omega(t)$ by a constant value over the interval $[t_k, t_{k+1}]$, specifically its value at the midpoint $t_{k+1/2} = t_k + h/2$. Let $\\omega_{k+1/2} = \\omega(t_{k+1/2})$. The ODE is thus approximated as:\n$$\n\\dot{R}(t) \\approx R(t)\\,\\widehat{\\omega}_{k+1/2}\n$$\nThis is a linear, time-invariant matrix ODE. To solve it, we right-multiply by $R(t)^{-1}$ and introduce a variable $u(t) = R_k^{-1} R(t)$, where $R_k = R(t_k)$. Differentiating $u(t)$ gives $\\dot{u}(t) = R_k^{-1} \\dot{R}(t) = R_k^{-1} R(t) \\widehat{\\omega}_{k+1/2} = u(t) \\widehat{\\omega}_{k+1/2}$. The initial condition is $u(t_k) = R_k^{-1} R_k = I_3$, where $I_3$ is the $3 \\times 3$ identity matrix.\n\nThe solution to the initial value problem $\\dot{u}(\\tau) = u(\\tau) A$ with $u(0)=I$ is $u(\\tau) = \\exp(\\tau A)$. In our case, $A = \\widehat{\\omega}_{k+1/2}$ and we integrate over a duration $h$. The solution for $u(t)$ at $t=t_{k+1}$ is thus $u(t_{k+1}) = \\exp(h\\,\\widehat{\\omega}_{k+1/2})$. Substituting back $u(t_{k+1}) = R_k^{-1} R_{k+1}$, we get:\n$$\nR_k^{-1} R_{k+1} = \\exp(h\\,\\widehat{\\omega}_{k+1/2})\n$$\nLeft-multiplying by $R_k$ yields the final update rule:\n$$\nR_{k+1} = R_k \\exp(h\\,\\widehat{\\omega}_{k+1/2})\n$$\nThis is a Lie-group integrator known as the exponential midpoint rule (or a variant of the Lie-Euler method). It is structure-preserving: if $R_k \\in SO(3)$, then $R_{k+1}$ is also in $SO(3)$. This is because $\\widehat{\\omega}_{k+1/2} \\in \\mathfrak{so}(3)$, and the matrix exponential maps the Lie algebra $\\mathfrak{so}(3)$ to the Lie group $SO(3)$. The product of two matrices in $SO(3)$ is also in $SO(3)$.\n\n**Analysis of Diagnostic Quantities**\n\n1.  **Orthogonality and Determinant Errors**:\n    The orthogonality error is $\\epsilon_{\\mathrm{ortho}}(k) = \\big\\|R_k^\\top R_k - I_3\\big\\|_F$ and the determinant error is $\\epsilon_{\\mathrm{det}}(k) = \\big|\\det(R_k) - 1\\big|$. Since the update rule guarantees that if $R_k \\in SO(3)$, then $R_{k+1} \\in SO(3)$, we must have $R_k^\\top R_k = I_3$ and $\\det(R_k) = 1$ for all $k$, starting from $R_0 = I_3$. The properties of the matrix exponential ensure this: for any skew-symmetric matrix $A \\in \\mathfrak{so}(3)$, $\\exp(A)$ is an orthogonal matrix, and $\\det(\\exp(A)) = \\exp(\\operatorname{trace}(A)) = \\exp(0) = 1$. Therefore, these errors are expected to be non-zero only due to floating-point representation and the finite precision of the numerical algorithms for the matrix exponential.\n\n2.  **Kinematic Consistency Error**:\n    The kinematic consistency error is defined as $\\epsilon_{\\mathrm{kin}}(k) = \\big\\|\\Omega_k^{\\mathrm{disc}} - R_k\\,\\omega_{k+1/2}\\big\\|_2$, where the discrete space angular velocity $\\Omega_k^{\\mathrm{disc}}$ is obtained from $\\widehat{\\Omega}_k^{\\mathrm{disc}} = \\frac{1}{h}\\,\\log\\!\\big(R_{k+1} R_k^\\top\\big)$. We can show that for our specific integrator and this definition, this error is theoretically zero.\n    Starting from our update rule:\n    $$\n    R_{k+1} = R_k \\exp(h\\,\\widehat{\\omega}_{k+1/2})\n    $$\n    Post-multiply by $R_k^\\top$ (which is $R_k^{-1}$ since $R_k \\in SO(3)$):\n    $$\n    R_{k+1} R_k^\\top = R_k \\exp(h\\,\\widehat{\\omega}_{k+1/2}) R_k^\\top\n    $$\n    Using the identity for the matrix exponential and a similarity transform, $\\exp(P A P^{-1}) = P \\exp(A) P^{-1}$, we get:\n    $$\n    R_{k+1} R_k^\\top = \\exp(R_k (h\\,\\widehat{\\omega}_{k+1/2}) R_k^\\top)\n    $$\n    Furthermore, for any rotation matrix $R \\in SO(3)$ and vector $v \\in \\mathbb{R}^3$, the hat map satisfies the identity $\\widehat{Rv} = R \\widehat{v} R^\\top$. Applying this:\n    $$\n    R_{k+1} R_k^\\top = \\exp(h\\,\\widehat{R_k \\omega_{k+1/2}})\n    $$\n    Now, taking the matrix logarithm of both sides gives:\n    $$\n    \\log(R_{k+1} R_k^\\top) = h\\,\\widehat{R_k \\omega_{k+1/2}}\n    $$\n    Dividing by the step size $h$:\n    $$\n    \\frac{1}{h} \\log(R_{k+1} R_k^\\top) = \\widehat{R_k \\omega_{k+1/2}}\n    $$\n    The expression on the left is the definition of $\\widehat{\\Omega}_k^{\\mathrm{disc}}$. Thus:\n    $$\n    \\widehat{\\Omega}_k^{\\mathrm{disc}} = \\widehat{R_k \\omega_{k+1/2}}\n    $$\n    Applying the inverse hat map (the vee map, $\\vee$) to both sides, which extracts the vector from its skew-symmetric matrix representation, yields:\n    $$\n    \\Omega_k^{\\mathrm{disc}} = R_k \\omega_{k+1/2}\n    $$\n    This demonstrates that the two quantities being compared in the kinematic consistency error are identical. The computed error $\\epsilon_{\\mathrm{kin}}(k)$ will therefore be non-zero only due to the numerical precision of the matrix logarithm (`logm`), matrix exponential (`expm`), and floating-point arithmetic.\n\n3.  **Final Rotation Angle**:\n    After $N$ steps, the final angle of rotation $\\theta_{\\mathrm{final}}$ is computed from the trace of the final rotation matrix $R_N$. The formula $\\theta = \\arccos\\left(\\frac{\\operatorname{trace}(R) - 1}{2}\\right)$ is a standard result for any rotation matrix $R \\in SO(3)$.\n\n**Implementation Strategy**\n\nThe solution is implemented by creating a function that takes the simulation parameters ($T$, $h$, and the function $\\omega(t)$) and performs the integration. Inside a loop of $N = T/h$ steps, the algorithm computes the midpoint velocity, forms the Lie algebra element, calculates the matrix exponential to find the incremental rotation, and updates the orientation matrix $R_k$. Within this loop, the specified diagnostic errors are computed at each step and stored. After the loop, the maximum of each error series and the final rotation angle are compiled into the result list for the given test case. This procedure is repeated for all four test cases provided. Auxiliary functions for the `hat` and `vee` maps are defined for clarity and reusability.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm, logm\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the final results.\n    \"\"\"\n\n    def hat(v):\n        \"\"\"Maps a vector in R^3 to its corresponding skew-symmetric matrix in so(3).\"\"\"\n        return np.array([\n            [0, -v[2], v[1]],\n            [v[2], 0, -v[0]],\n            [-v[1], v[0], 0]\n        ])\n\n    def vee(S):\n        \"\"\"Maps a skew-symmetric matrix in so(3) to its corresponding vector in R^3.\"\"\"\n        # Using a robust formula to handle potential numerical inaccuracies\n        return np.array([\n            (S[2, 1] - S[1, 2]) / 2.0,\n            (S[0, 2] - S[2, 0]) / 2.0,\n            (S[1, 0] - S[0, 1]) / 2.0\n        ])\n\n    def solve_case(T, h, omega_func):\n        \"\"\"\n        Solves one case of the rigid body integration problem.\n\n        Args:\n            T (float): Total simulation time.\n            h (float): Time step size.\n            omega_func (callable): Function omega(t) that returns the body angular velocity.\n\n        Returns:\n            list: A list of four floats: [max_ortho_error, max_det_error, max_kin_error, theta_final].\n        \"\"\"\n        num_steps = int(round(T / h))\n        R = np.eye(3)\n        \n        ortho_errors = []\n        det_errors = []\n        kin_errors = []\n\n        # Diagnostics for initial state R_0\n        ortho_errors.append(np.linalg.norm(R.T @ R - np.eye(3), 'fro'))\n        det_errors.append(abs(np.linalg.det(R) - 1.0))\n\n        for k in range(num_steps):\n            t_k = k * h\n            R_k = R\n\n            # Calculate midpoint angular velocity\n            t_mid = t_k + h / 2.0\n            w_mid = omega_func(t_mid)\n\n            # Lie algebra element\n            w_hat = hat(w_mid)\n\n            # Update rotation matrix using matrix exponential\n            delta_R = expm(h * w_hat)\n            R_next = R_k @ delta_R\n            R = R_next\n\n            # Orthogonality and determinant errors for R_{k+1}\n            ortho_errors.append(np.linalg.norm(R.T @ R - np.eye(3), 'fro'))\n            det_errors.append(abs(np.linalg.det(R) - 1.0))\n\n            # Kinematic consistency error for step k\n            rel_rot = R_next @ R_k.T\n            log_rel_rot = logm(rel_rot)\n            Omega_disc_hat = log_rel_rot / h\n            Omega_disc = vee(Omega_disc_hat)\n            \n            Omega_ref = R_k @ w_mid\n            \n            kin_errors.append(np.linalg.norm(Omega_disc - Omega_ref))\n\n        R_N = R\n        # Final rotation angle\n        trace_R_N = np.trace(R_N)\n        # Clip argument for arccos to handle potential floating point errors\n        arg = np.clip((trace_R_N - 1.0) / 2.0, -1.0, 1.0)\n        theta_final = np.arccos(arg)\n\n        # Collect final results for the case\n        max_ortho_error = np.max(ortho_errors)\n        max_det_error = np.max(det_errors)\n        max_kin_error = 0.0 if not kin_errors else np.max(kin_errors) # Handle N=0 case\n\n        return [max_ortho_error, max_det_error, max_kin_error, theta_final]\n\n    # Define the angular velocity functions for each test case\n    def omega1(t):\n        return np.array([0.3 * np.sin(0.7 * t), 0.2 * np.cos(0.5 * t), 0.1])\n\n    def omega2(t):\n        return np.array([0.0, 0.0, 0.0])\n\n    def omega3(t):\n        return np.array([0.0, 0.0, 2.0])\n\n    def omega4(t):\n        return np.array([2.0 * np.sin(8 * t), -1.5 * np.sin(9 * t), 1.0 * np.cos(7 * t)])\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 0.01, omega1),\n        (1.0, 0.02, omega2),\n        (1.2, 1.2, omega3),\n        (0.4, 0.05, omega4),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        T, h, omega_func = case\n        result = solve_case(T, h, omega_func)\n        all_results.append(result)\n\n    # Format the final output string to exactly match requirements (no spaces).\n    results_str = ','.join([repr(res).replace(' ', '') for res in all_results])\n    print(f\"[{results_str}]\")\n\nsolve()\n```"
        }
    ]
}