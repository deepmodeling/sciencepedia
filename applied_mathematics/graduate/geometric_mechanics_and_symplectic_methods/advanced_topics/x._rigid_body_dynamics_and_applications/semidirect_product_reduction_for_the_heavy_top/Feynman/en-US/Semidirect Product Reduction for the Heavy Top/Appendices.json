{
    "hands_on_practices": [
        {
            "introduction": "A fundamental skill in geometric mechanics is the ability to derive the equations of motion from a given Lagrangian. This practice guides you through the variational principles on a semidirect product Lie group to obtain the Euler-Poincaré equations for the heavy top. By completing this derivation (), you will solidify your understanding of how the abstract framework of reduction theory translates into the concrete, physically meaningful equations governing the top's dynamics.",
            "id": "3765893",
            "problem": "Consider the rigid heavy top modeled as a semidirect product system for the Special Orthogonal Group in three dimensions (SO(3)) acting on the space of vectors in three dimensions, with body angular velocity $\\Omega \\in \\mathbb{R}^{3}$ and the advected gravity direction $\\Gamma \\in \\mathbb{R}^{3}$. Let the body inertia tensor $I:\\mathbb{R}^{3}\\to\\mathbb{R}^{3}$ be symmetric and positive-definite, the mass be $m$, the gravitational acceleration be $g$, the distance from the fixed point to the center of mass be $l$, and the fixed body vector pointing from the fixed point to the center of mass be $\\chi \\in \\mathbb{R}^{3}$. The reduced Lagrangian is\n$$\nl(\\Omega,\\Gamma)=\\frac{1}{2}\\,\\Omega\\cdot I\\Omega - mgl\\,\\Gamma\\cdot \\chi.\n$$\nUsing Hamilton’s principle on the semidirect product with right-invariant reduction and the associated constrained variations, start from the following fundamental bases:\n- The identification of the Lie algebra of the Special Orthogonal Group in three dimensions (so(3)) with $\\mathbb{R}^{3}$ via the hat map, with the Lie bracket given by the cross product.\n- The coadjoint action identity $\\,\\mathrm{ad}^{*}_{\\Omega}\\mu=\\mu\\times\\Omega\\,$ for $\\Omega,\\mu\\in\\mathbb{R}^{3}$.\n- The advected parameter kinematics for the gravity direction in body coordinates, $\\dot{\\Gamma}+\\Omega\\times\\Gamma=0$.\n- The definition of the diamond operation for the semidirect product induced by the standard rotation action, obtained from duality with the infinitesimal generator.\n\nDerive the Euler–Poincaré (EP) equation with advected parameter for this system, compute the variational derivatives $\\frac{\\delta l}{\\delta \\Omega}$ and $\\frac{\\delta l}{\\delta \\Gamma}$, and then simplify the corresponding semidirect product forcing term expressed as $-\\Gamma\\times\\frac{\\delta l}{\\delta \\Gamma}$. Do not introduce any shortcut formulas beyond the listed bases; instead, explicitly carry out all variational steps needed to reach the reduced equations. \n\nProvide your final result as a single closed-form analytic expression consisting of the tuple $\\left(\\frac{\\delta l}{\\delta \\Omega},\\frac{\\delta l}{\\delta \\Gamma},-\\Gamma\\times\\frac{\\delta l}{\\delta \\Gamma}\\right)$. No numerical evaluation is required. If multiple expressions are returned, present them as a single row matrix. No units are required in the final expression, and angles should be understood in radians.",
            "solution": "The problem is valid. It is a well-posed problem in geometric mechanics, based on established scientific principles, and all necessary information is provided for a unique derivation.\n\nThe derivation of the Euler–Poincaré equation for the heavy top starts with Hamilton's principle for the reduced system. The action, $S$, is the integral of the reduced Lagrangian, $l(\\Omega, \\Gamma)$, over a time interval $[t_1, t_2]$.\n$$\nS = \\int_{t_1}^{t_2} l(\\Omega(t), \\Gamma(t)) dt\n$$\nHamilton's principle states that the variation of the action, $\\delta S$, must be zero for any admissible variation of the path, which means $\\delta S = 0$.\n$$\n\\delta S = \\delta \\int_{t_1}^{t_2} l(\\Omega, \\Gamma) dt = \\int_{t_1}^{t_2} \\delta l(\\Omega, \\Gamma) dt = 0\n$$\nThe variation of the Lagrangian, $\\delta l$, is given by the chain rule:\n$$\n\\delta l = \\frac{\\delta l}{\\delta \\Omega} \\cdot \\delta \\Omega + \\frac{\\delta l}{\\delta \\Gamma} \\cdot \\delta \\Gamma\n$$\nHere, $\\frac{\\delta l}{\\delta \\Omega}$ and $\\frac{\\delta l}{\\delta \\Gamma}$ are the variational (or functional) derivatives of the Lagrangian. The problem is set in the framework of right-invariant reduction. The configuration is described by a path $g(t) \\in SO(3)$. The body angular velocity is $\\Omega(t) = g(t)^{-1} \\dot{g}(t)$. A variation of the path is given by $g_\\epsilon(t) = g(t) \\exp(\\epsilon \\xi(t))$, where $\\xi(t) \\in \\mathfrak{so}(3) \\cong \\mathbb{R}^3$ is an arbitrary variational vector field that vanishes at the endpoints, i.e., $\\xi(t_1) = \\xi(t_2) = 0$.\n\nThe variations $\\delta \\Omega$ and $\\delta \\Gamma$ are induced by $\\xi(t)$.\nThe variation of the body angular velocity $\\Omega$ is given by:\n$$\n\\delta \\Omega = \\frac{d\\xi}{dt} + [\\Omega, \\xi] = \\frac{d\\xi}{dt} + \\Omega \\times \\xi\n$$\nThe advected parameter $\\Gamma(t)$ is the representation of a fixed vector in space as seen from the body frame, $\\Gamma(t) = g(t)^{-1} \\Gamma_{\\text{space}}$. Its variation is:\n$$\n\\delta \\Gamma = \\frac{d}{d\\epsilon}\\bigg|_{\\epsilon=0} (\\exp(\\epsilon \\xi(t))^{-1} \\Gamma(t)) = -\\hat{\\xi}\\Gamma = -\\xi \\times \\Gamma = \\Gamma \\times \\xi\n$$\nThis is consistent with the provided kinematic equation $\\dot{\\Gamma} + \\Omega \\times \\Gamma = 0$, as can be seen by differentiating $\\Gamma (t) = g(t)^{-1}\\Gamma_{\\text{space}}$.\n\nSubstituting these expressions for $\\delta l$, $\\delta\\Omega$, and $\\delta\\Gamma$ into the action variation gives:\n$$\n\\delta S = \\int_{t_1}^{t_2} \\left[ \\frac{\\delta l}{\\delta \\Omega} \\cdot \\left(\\frac{d\\xi}{dt} + \\Omega \\times \\xi\\right) + \\frac{\\delta l}{\\delta \\Gamma} \\cdot (\\Gamma \\times \\xi) \\right] dt = 0\n$$\nWe perform integration by parts on the first term:\n$$\n\\int_{t_1}^{t_2} \\frac{\\delta l}{\\delta \\Omega} \\cdot \\frac{d\\xi}{dt} dt = \\left[ \\frac{\\delta l}{\\delta \\Omega} \\cdot \\xi \\right]_{t_1}^{t_2} - \\int_{t_1}^{t_2} \\frac{d}{dt}\\left(\\frac{\\delta l}{\\delta \\Omega}\\right) \\cdot \\xi dt\n$$\nThe boundary term vanishes because $\\xi(t_1) = \\xi(t_2) = 0$. The integral becomes:\n$$\n\\delta S = \\int_{t_1}^{t_2} \\left[ -\\frac{d}{dt}\\left(\\frac{\\delta l}{\\delta \\Omega}\\right) \\cdot \\xi + \\frac{\\delta l}{\\delta \\Omega} \\cdot (\\Omega \\times \\xi) + \\frac{\\delta l}{\\delta \\Gamma} \\cdot (\\Gamma \\times \\xi) \\right] dt = 0\n$$\nUsing the scalar triple product identity $A \\cdot (B \\times C) = C \\cdot (A \\times B)$, we can factor out the variation $\\xi$:\n$$\n\\frac{\\delta l}{\\delta \\Omega} \\cdot (\\Omega \\times \\xi) = \\xi \\cdot \\left(\\frac{\\delta l}{\\delta \\Omega} \\times \\Omega\\right)\n$$\n$$\n\\frac{\\delta l}{\\delta \\Gamma} \\cdot (\\Gamma \\times \\xi) = \\xi \\cdot \\left(\\frac{\\delta l}{\\delta \\Gamma} \\times \\Gamma\\right)\n$$\nSubstituting these back into the integral for $\\delta S$:\n$$\n\\delta S = \\int_{t_1}^{t_2} \\left[ -\\frac{d}{dt}\\left(\\frac{\\delta l}{\\delta \\Omega}\\right) + \\frac{\\delta l}{\\delta \\Omega} \\times \\Omega + \\frac{\\delta l}{\\delta \\Gamma} \\times \\Gamma \\right] \\cdot \\xi dt = 0\n$$\nSince this equation must hold for any arbitrary variation $\\xi(t)$, the term in the square brackets must be identically zero. This yields the Euler-Poincaré equation with an advected parameter:\n$$\n\\frac{d}{dt}\\left(\\frac{\\delta l}{\\delta \\Omega}\\right) = \\frac{\\delta l}{\\delta \\Omega} \\times \\Omega + \\frac{\\delta l}{\\delta \\Gamma} \\times \\Gamma\n$$\nThis equation describes the evolution of the body angular momentum. The first term on the right, $\\frac{\\delta l}{\\delta \\Omega} \\times \\Omega$, corresponds to the coadjoint action term $\\mathrm{ad}^*_\\Omega \\frac{\\delta l}{\\delta \\Omega}$. The second term, $\\frac{\\delta l}{\\delta \\Gamma} \\times \\Gamma$, is the forcing term due to the potential energy, which corresponds to the diamond product term in the abstract theory.\n\nNow we compute the specific quantities for the given Lagrangian:\n$$\nl(\\Omega,\\Gamma)=\\frac{1}{2}\\,\\Omega\\cdot I\\Omega - mgl\\,\\Gamma\\cdot \\chi\n$$\nwhere $I$ is the symmetric inertia tensor.\n\nFirst, we find the variational derivative with respect to $\\Omega$:\nThe variation in $l$ with respect to a change in $\\Omega$ is:\n$$\n\\delta_\\Omega l = \\frac{1}{2}(\\delta\\Omega \\cdot I\\Omega + \\Omega \\cdot I\\delta\\Omega) = \\frac{1}{2}(\\delta\\Omega \\cdot I\\Omega + \\Omega \\cdot I^T\\delta\\Omega) = \\frac{1}{2}(\\delta\\Omega \\cdot I\\Omega + I\\Omega \\cdot \\delta\\Omega) = I\\Omega \\cdot \\delta\\Omega\n$$\nThus, the variational derivative is:\n$$\n\\frac{\\delta l}{\\delta \\Omega} = I\\Omega\n$$\nThis is the angular momentum of the heavy top in the body frame.\n\nSecond, we find the variational derivative with respect to $\\Gamma$:\nThe variation in $l$ with respect to a change in $\\Gamma$ is:\n$$\n\\delta_\\Gamma l = -mgl\\,(\\delta\\Gamma \\cdot \\chi) = (-mgl\\chi) \\cdot \\delta\\Gamma\n$$\nThus, the variational derivative is:\n$$\n\\frac{\\delta l}{\\delta \\Gamma} = -mgl\\,\\chi\n$$\n\nThird, we compute the semidirect product forcing term as specified in the problem, $-\\Gamma\\times\\frac{\\delta l}{\\delta \\Gamma}$:\n$$\n-\\Gamma\\times\\frac{\\delta l}{\\delta \\Gamma} = -\\Gamma \\times (-mgl\\,\\chi) = mgl\\,(\\Gamma \\times \\chi)\n$$\nThis term represents the torque exerted by gravity on the top, expressed in the body frame. We note that this is identical to the forcing term derived from first principles, $\\frac{\\delta l}{\\delta \\Gamma} \\times \\Gamma$:\n$$\n\\frac{\\delta l}{\\delta \\Gamma} \\times \\Gamma = (-mgl\\,\\chi) \\times \\Gamma = -mgl\\,(\\chi \\times \\Gamma) = mgl\\,(\\Gamma \\times \\chi)\n$$\n\nThe problem asks for the tuple of the three computed quantities. They are:\n1.  $\\frac{\\delta l}{\\delta \\Omega} = I\\Omega$\n2.  $\\frac{\\delta l}{\\delta \\Gamma} = -mgl\\,\\chi$\n3.  $-\\Gamma\\times\\frac{\\delta l}{\\delta \\Gamma} = mgl\\,(\\Gamma \\times \\chi)$\n\nCombining these into a single expression as requested.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} I\\Omega & -mgl\\chi & mgl(\\Gamma \\times \\chi) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Once the equations of motion are established, the next step is to analyze the system's structure for conserved quantities, which are the key to understanding its behavior. This exercise applies the powerful principles of Noether's theorem to the heavy top's axial symmetry around the gravity vector. You will identify the infinitesimal generator of this symmetry and derive the corresponding conserved momentum map (), revealing the famous conserved vertical component of angular momentum.",
            "id": "3765899",
            "problem": "Consider the heavy top with configuration described by the Special Orthogonal Group $\\mathrm{SO}(3)$, orientation $R \\in \\mathrm{SO}(3)$, body angular velocity $\\Omega \\in \\mathbb{R}^{3}$ defined by $\\widehat{\\Omega} = R^{-1} \\dot{R}$, and advected parameter $\\Gamma \\in \\mathbb{R}^{3}$ given by $\\Gamma = R^{\\top} e_{3}$, where $e_{3} \\in \\mathbb{R}^{3}$ is the unit vector along the vertical (space-fixed) axis. The map $\\,\\widehat{\\cdot}\\, : \\mathbb{R}^{3} \\to \\mathfrak{so}(3)$ is the canonical isomorphism satisfying $\\widehat{u} v = u \\times v$ for all $u, v \\in \\mathbb{R}^{3}$. The reduced heavy top Lagrangian is\n$$\n\\ell(\\Omega, \\Gamma) = \\tfrac{1}{2}\\, \\Omega \\cdot \\mathbb{I} \\Omega \\;-\\; m g\\, \\chi \\cdot \\Gamma,\n$$\nwhere $\\mathbb{I}$ is the inertia tensor (a symmetric, positive-definite linear map on $\\mathbb{R}^{3}$), $m$ is the mass, $g$ is the gravitational acceleration, and $\\chi \\in \\mathbb{R}^{3}$ is the vector from the fixed point to the center of mass expressed in body coordinates. The kinematic constraint for the advected parameter is $\\dot{\\Gamma} = -\\,\\Omega \\times \\Gamma$.\n\nThe symmetry group acting on the configuration is the subgroup $\\mathrm{SO}(2) \\subset \\mathrm{SO}(3)$ of rotations about the space-fixed vertical axis $e_{3}$. This subgroup acts by left multiplication on $R$, namely $h \\cdot R = h R$ for $h \\in \\mathrm{SO}(2)$, and leaves $\\Gamma$ invariant, i.e., $h \\cdot \\Gamma = \\Gamma$. The action lifts to the tangent bundle by $h \\cdot (R, \\dot{R}) = (h R, h \\dot{R})$.\n\nStarting from these definitions and the heavy top Lagrangian above, and using the standard principles of Noether’s theorem for systems with symmetry and semidirect product reduction, do the following:\n\n1. Compute the infinitesimal generator (fundamental vector field) on $(R, \\Gamma)$ associated with the one-parameter subgroup $h(s) = \\exp\\!\\big(s\\,\\widehat{e_{3}}\\big)$ of $\\mathrm{SO}(2)$.\n2. Compute the corresponding conserved quantity (momentum map value) associated with this $\\mathrm{SO}(2)$ symmetry, expressed purely in terms of $\\Omega$, $\\Gamma$, and $\\mathbb{I}$.\n\nYour final answer must contain both the infinitesimal generator and the conserved quantity. Express the final answer as a row matrix in the order: first entry equals the infinitesimal generator on $(R, \\Gamma)$, second entry equals the conserved quantity. No numerical evaluation is required, and no rounding is needed. No physical units should appear in the final answer. Use radians for any angular descriptions.",
            "solution": "The problem statement is valid. It is a well-posed problem in geometric mechanics, grounded in the standard theory of the heavy top and semidirect product reduction. The definitions, constraints, and requested computations are scientifically sound, complete, and consistently formulated. We will proceed with the solution.\n\n**1. Infinitesimal Generator**\n\nThe configuration of the system is described by the pair $(R, \\Gamma) \\in \\mathrm{SO}(3) \\times \\mathbb{R}^3$. The symmetry group is $G = \\mathrm{SO}(2)$, identified as the subgroup of rotations in $\\mathrm{SO}(3)$ about the space-fixed vertical axis $e_3$. The one-parameter subgroup corresponding to this symmetry is given by $h(s) = \\exp(s\\,\\widehat{e_3})$, where $\\widehat{e_3}$ is the element of the Lie algebra $\\mathfrak{so}(3)$ corresponding to $e_3 \\in \\mathbb{R}^3$.\n\nThe action of an element $h \\in \\mathrm{SO}(2)$ on a point $(R, \\Gamma)$ is defined as:\n- Action on $R$: $h \\cdot R = hR$ (left multiplication).\n- Action on $\\Gamma$: $h \\cdot \\Gamma = \\Gamma$ (the identity action).\n\nThe infinitesimal generator of the action, associated with the Lie algebra element $\\xi = \\widehat{e_3} \\in \\mathfrak{so}(3)$, is a vector field on the manifold $\\mathrm{SO}(3) \\times \\mathbb{R}^3$. This vector field at a point $(R, \\Gamma)$ is found by differentiating the action of the one-parameter subgroup $h(s) = \\exp(s\\xi)$ at $s=0$.\n\nThe component of the generator on $\\mathrm{SO}(3)$ at the point $R$ is:\n$$ \\xi_{\\mathrm{SO}(3)}(R) = \\left. \\frac{d}{ds} \\right|_{s=0} (h(s) \\cdot R) = \\left. \\frac{d}{ds} \\right|_{s=0} (\\exp(s\\widehat{e_3}) R) $$\nUsing the product rule for differentiation, we get:\n$$ \\xi_{\\mathrm{SO}(3)}(R) = \\left( \\left. \\frac{d}{ds} \\right|_{s=0} \\exp(s\\widehat{e_3}) \\right) R = \\widehat{e_3} R $$\nThis is a tangent vector in $T_R\\mathrm{SO}(3)$, the tangent space to $\\mathrm{SO}(3)$ at $R$.\n\nThe component of the generator on $\\mathbb{R}^3$ at the point $\\Gamma$ is:\n$$ \\xi_{\\mathbb{R}^3}(\\Gamma) = \\left. \\frac{d}{ds} \\right|_{s=0} (h(s) \\cdot \\Gamma) = \\left. \\frac{d}{ds} \\right|_{s=0} (\\Gamma) = 0 $$\nThe generator is the zero vector field on $\\mathbb{R}^3$ because the action on $\\Gamma$ is trivial.\n\nCombining these, the infinitesimal generator on the product space $\\mathrm{SO}(3) \\times \\mathbb{R}^3$ at the point $(R, \\Gamma)$ is the pair $(\\widehat{e_3} R, 0)$.\n\n**2. Conserved Quantity (Momentum Map)**\n\nThe invariance of the heavy top Lagrangian under the left action of $\\mathrm{SO}(2)$ on $\\mathrm{SO}(3)$ guarantees the existence of a conserved quantity by Noether's theorem. This quantity is the value of the momentum map associated with the symmetry.\n\nThe Lagrangian on the full tangent bundle $T\\mathrm{SO}(3)$ is given by $L(R, \\dot{R}) = \\ell(\\Omega, \\Gamma)$, where $\\Omega$ and $\\Gamma$ are functions of $(R, \\dot{R})$:\n$$ L(R, \\dot{R}) = \\frac{1}{2} (\\text{unhat}(R^{-1}\\dot{R})) \\cdot \\mathbb{I} (\\text{unhat}(R^{-1}\\dot{R})) - m g\\, \\chi \\cdot (R^{\\top} e_3) $$\nThe conserved quantity associated with a Lie algebra element $\\xi$ is given by the pairing of the conjugate momentum with the infinitesimal generator of the action on the configuration space: $J_{\\xi} = \\langle \\frac{\\partial L}{\\partial \\dot{R}}, \\xi_{\\mathrm{SO}(3)}(R) \\rangle$.\n\nIt is often more convenient to work with body-fixed quantities. The momentum map for a left-invariant system on a Lie group can be expressed as the pairing of the momentum in the body frame, $\\Pi = \\frac{\\partial \\ell}{\\partial \\Omega}$, with the body representation of the symmetry generator.\n\nFirst, we compute the body momentum $\\Pi \\in \\mathbb{R}^3$ from the reduced Lagrangian $\\ell(\\Omega, \\Gamma) = \\frac{1}{2} \\Omega \\cdot \\mathbb{I} \\Omega - m g\\, \\chi \\cdot \\Gamma$. The conjugate momentum to the body angular velocity $\\Omega$ is:\n$$ \\Pi = \\frac{\\partial \\ell}{\\partial \\Omega} = \\mathbb{I} \\Omega $$\nThis is the angular momentum vector expressed in the body-fixed frame.\n\nNext, we find the representation of the symmetry generator in the body frame. The symmetry corresponds to rotations about the space-fixed axis $e_3$. The vector $e_3$ is represented in the body frame by the transformation $R^{-1}e_3$. Since $R \\in \\mathrm{SO}(3)$, its inverse is its transpose, $R^{-1} = R^{\\top}$. So, the body representation of the symmetry axis is $R^{\\top}e_3$.\nFrom the problem statement, we are given the advected parameter $\\Gamma = R^{\\top}e_3$. Thus, $\\Gamma$ is precisely the representation of the space-fixed vertical axis in the body frame.\n\nThe conserved quantity is the dot product of the body angular momentum $\\Pi$ and the body representation of the symmetry axis $\\Gamma$:\n$$ p_3 = \\Pi \\cdot \\Gamma = (\\mathbb{I}\\Omega) \\cdot \\Gamma $$\n\nThis result can be confirmed by considering the spatial angular momentum. The spatial angular momentum vector is $\\pi = R\\Pi = R\\mathbb{I}\\Omega$. The symmetry is with respect to rotations about the fixed spatial axis $e_3$. The conserved quantity is the component of the spatial angular momentum along this axis:\n$$ \\pi \\cdot e_3 = (R\\mathbb{I}\\Omega) \\cdot e_3 $$\nUsing the property of the dot product under orthogonal transformations, $\\langle u, v \\rangle = \\langle R^{\\top}u, R^{\\top}v \\rangle$, we can write this as:\n$$ (R\\mathbb{I}\\Omega) \\cdot e_3 = \\langle R\\mathbb{I}\\Omega, e_3 \\rangle = \\langle \\mathbb{I}\\Omega, R^{\\top}e_3 \\rangle = (\\mathbb{I}\\Omega) \\cdot (R^{\\top}e_3) $$\nSubstituting $\\Gamma = R^{\\top}e_3$, we recover the same result:\n$$ p_3 = (\\mathbb{I}\\Omega) \\cdot \\Gamma $$\nThis quantity represents the conserved vertical component of the total angular momentum.\n\nThe two requested quantities are the infinitesimal generator $(\\widehat{e_3} R, 0)$ and the conserved quantity $(\\mathbb{I}\\Omega) \\cdot \\Gamma$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} (\\widehat{e_3} R, 0) & (\\mathbb{I}\\Omega) \\cdot \\Gamma \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Bridging the gap between continuous theory and practical application often requires numerical simulation. This exercise challenges you to implement a geometric integrator for a system whose dynamics are inspired by the heavy top, which respects the underlying Poisson structure of the phase space. By constructing a first-order Lie-Poisson integrator (), you will learn how to discretize the dynamics while exactly preserving the system's Casimir invariants, ensuring the long-term stability and physical fidelity of your simulation.",
            "id": "3765884",
            "problem": "Consider a system on the special orthogonal group acting on a vector space via the semidirect product structure $SO(3) \\ltimes \\mathbb{R}^3$. Let the body angular momentum be $\\Pi \\in \\mathbb{R}^3$ and the body representation of a fixed spatial vector be $\\Gamma \\in \\mathbb{R}^3$. The inertia tensor is a symmetric, positive-definite matrix $I \\in \\mathbb{R}^{3 \\times 3}$, the mass is $m$ in kilograms, gravitational acceleration is $g$ in meters per second squared, and the distance from the fixed point to the center of mass is $l$ in meters. Define the body angular velocity $\\Omega = I^{-1} \\Pi$ with $\\Omega \\in \\mathbb{R}^3$. Take the unit vector $e_3 = (0,0,1)$ to be a fixed direction in the spatial frame. For this exercise, let the dynamics on the dual of the Lie algebra of the semidirect product be given by the following equations:\n$$\n\\dot{\\Pi} = \\Pi \\times \\Omega + m g l \\, \\Gamma \\times e_3, \\qquad \\dot{\\Gamma} = \\Gamma \\times \\Omega,\n$$\nwith the angular velocity defined by\n$$\n\\Omega = I^{-1} \\Pi.\n$$\nAngles must be treated in radians.\n\nYour task is to implement a one-step, first-order Lie–Poisson integrator that advances $(\\Pi, \\Gamma)$ by a time step $h$ in seconds, starting from given $(\\Pi, \\Gamma)$ and parameters $(I, m, g, l)$. The integrator must be based on the semidirect product structure and preserve the Lie–Poisson invariants (Casimirs) $C_1 = \\|\\Gamma\\|^2$ and $C_2 = \\Pi \\cdot \\Gamma$ exactly at the discrete level. Design your program to:\n- Compute $\\Omega = I^{-1}\\Pi$.\n- Apply a Lie–group rotation generated by $\\Omega$ using the matrix exponential $\\exp(h[\\Omega]_\\times)$, where $[\\Omega]_\\times$ is the skew-symmetric matrix representing the cross product with $\\Omega$, to advance both $\\Pi$ and $\\Gamma$.\n- Apply the interaction term in a way consistent with the semidirect product structure, so that the Casimirs $C_1$ and $C_2$ are preserved by the discrete map.\n\nPhysical units:\n- $I$ in kilogram meter squared ($\\mathrm{kg}\\cdot \\mathrm{m}^2$),\n- $m$ in kilograms ($\\mathrm{kg}$),\n- $g$ in meters per second squared ($\\mathrm{m/s}^2$),\n- $l$ in meters ($\\mathrm{m}$),\n- $\\Pi$ in kilogram meter squared per second ($\\mathrm{kg}\\cdot \\mathrm{m}^2/\\mathrm{s}$),\n- $h$ in seconds ($\\mathrm{s}$),\n- $\\Gamma$ is dimensionless.\n\nFor each test case, your program should produce the updated $(\\Pi_{\\text{new}}, \\Gamma_{\\text{new}})$ after one time step $h$, and also compute the changes in the Casimirs:\n$$\n\\Delta C_1 = \\|\\Gamma_{\\text{new}}\\|^2 - \\|\\Gamma\\|^2, \\qquad\n\\Delta C_2 = \\Pi_{\\text{new}} \\cdot \\Gamma_{\\text{new}} - \\Pi \\cdot \\Gamma.\n$$\nReturn these eight numbers as a list $[\\Pi_{\\text{new},1}, \\Pi_{\\text{new},2}, \\Pi_{\\text{new},3}, \\Gamma_{\\text{new},1}, \\Gamma_{\\text{new},2}, \\Gamma_{\\text{new},3}, \\Delta C_1, \\Delta C_2]$ for each test case.\n\nTest suite (all angles are in radians, and the time step $h$ is in seconds):\n1. Happy path with anisotropic inertia:\n   - $I = \\mathrm{diag}(0.37,\\,0.52,\\,0.91)$ $\\mathrm{kg}\\cdot\\mathrm{m}^2$,\n   - $m = 3.0$ $\\mathrm{kg}$, $g = 9.80665$ $\\mathrm{m/s}^2$, $l = 0.25$ $\\mathrm{m}$,\n   - $h = 0.01$ $\\mathrm{s}$,\n   - $\\Pi = (0.12,\\,-0.08,\\,0.20)$ $\\mathrm{kg}\\cdot\\mathrm{m}^2/\\mathrm{s}$,\n   - $\\Gamma = \\left(0.5,\\,0.5,\\,0.70710678\\right)$ (unit vector).\n2. Boundary case with zero angular momentum:\n   - $I = \\mathrm{diag}(1.1,\\,0.9,\\,0.7)$ $\\mathrm{kg}\\cdot\\mathrm{m}^2$,\n   - $m = 2.5$ $\\mathrm{kg}$, $g = 9.81$ $\\mathrm{m/s}^2$, $l = 0.35$ $\\mathrm{m}$,\n   - $h = 0.005$ $\\mathrm{s}$,\n   - $\\Pi = (0,\\,0,\\,0)$ $\\mathrm{kg}\\cdot\\mathrm{m}^2/\\mathrm{s}$,\n   - $\\Gamma = (0.6,\\,-0.8,\\,0.0)$ (unit vector).\n3. Edge case with vertical alignment $\\Gamma \\parallel e_3$:\n   - $I = \\mathrm{diag}(0.8,\\,0.6,\\,0.4)$ $\\mathrm{kg}\\cdot\\mathrm{m}^2$,\n   - $m = 1.2$ $\\mathrm{kg}$, $g = 9.81$ $\\mathrm{m/s}^2$, $l = 0.20$ $\\mathrm{m}$,\n   - $h = 0.02$ $\\mathrm{s}$,\n   - $\\Pi = (0.3,\\,-0.15,\\,0.05)$ $\\mathrm{kg}\\cdot\\mathrm{m}^2/\\mathrm{s}$,\n   - $\\Gamma = (0.0,\\,0.0,\\,1.0)$ (unit vector).\n4. No gravity case ($g = 0$):\n   - $I = \\mathrm{diag}(0.5,\\,0.5,\\,0.5)$ $\\mathrm{kg}\\cdot\\mathrm{m}^2$,\n   - $m = 4.0$ $\\mathrm{kg}$, $g = 0.0$ $\\mathrm{m/s}^2$, $l = 0.30$ $\\mathrm{m}$,\n   - $h = 0.015$ $\\mathrm{s}$,\n   - $\\Pi = (0.05,\\,0.08,\\,-0.02)$ $\\mathrm{kg}\\cdot\\mathrm{m}^2/\\mathrm{s}$,\n   - $\\Gamma = (0.2,\\,0.5,\\,0.842614)$ (unit vector).\n\nFinal output format:\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each test case result is itself a list in the format specified above. For example:\n- $[\\,[\\Pi_{\\text{new},1},\\Pi_{\\text{new},2},\\Pi_{\\text{new},3},\\Gamma_{\\text{new},1},\\Gamma_{\\text{new},2},\\Gamma_{\\text{new},3},\\Delta C_1,\\Delta C_2],\\ldots\\,]$.",
            "solution": "The problem requires the implementation of a first-order Lie–Poisson integrator for the equations of motion of a heavy top. The dynamics are described on the dual of the Lie algebra of the semidirect product group $SE(3) = SO(3) \\ltimes \\mathbb{R}^3$. The state of the system is given by the pair $(\\Pi, \\Gamma)$, where $\\Pi \\in \\mathbb{R}^3$ is the angular momentum in the body-fixed frame and $\\Gamma \\in \\mathbb{R}^3$ is the representation of the fixed spatial vertical direction in the body-fixed frame.\n\nThe equations of motion are given as:\n$$\n\\dot{\\Pi} = \\Pi \\times \\Omega + m g l \\, \\Gamma \\times e_3\n$$\n$$\n\\dot{\\Gamma} = \\Gamma \\times \\Omega\n$$\nwhere $\\Omega = I^{-1} \\Pi$ is the body angular velocity, $I$ is the inertia tensor, $m$ is the mass, $g$ is the gravitational acceleration, $l$ is the distance from the pivot to the center of mass, and $e_3 = (0,0,1)^T$ is the unit vector in the direction of gravity in the spatial frame.\n\nThe system possesses two Casimir invariants, which are functions that are constant along any trajectory. These are given by:\n$C_1 = \\|\\Gamma\\|^2$\n$C_2 = \\Pi \\cdot \\Gamma$\nA Lie-Poisson integrator is a numerical method designed to preserve these Casimirs exactly at the discrete level, thereby respecting the geometric structure of the phase space.\n\nThe problem specifies a first-order integrator constructed through a splitting method. The vector field governing the dynamics can be decomposed into two distinct parts. Let the state be $z = (\\Pi, \\Gamma)$. The equation $\\dot{z} = f(z)$ is split as $\\dot{z} = f_1(z) + f_2(z)$, where:\n$f_1(\\Pi, \\Gamma) = (\\Pi \\times \\Omega, \\Gamma \\times \\Omega)$: This corresponds to the dynamics of a free rigid body.\n$f_2(\\Pi, \\Gamma) = (m g l \\, \\Gamma \\times e_3, 0)$: This corresponds to the effect of the gravitational torque.\n\nThe key insight of a Lie-Trotter splitting method is that if we can find the exact solutions (flows) $\\Phi_t^{f_1}$ and $\\Phi_t^{f_2}$ for each sub-problem, we can approximate the flow of the full system by composing them. A first-order integrator for a time step $h$ is given by $\\Phi_h \\approx \\Phi_h^{f_2} \\circ \\Phi_h^{f_1}$. The order of composition can be reversed; we choose this specific order. We will now show that this composition exactly preserves the Casimirs $C_1$ and $C_2$.\n\n**Step 1: Flow of the free rigid body sub-problem, $\\Phi_h^{f_1}$**\nThe equations for this part are $\\dot{\\Pi} = \\Pi \\times \\Omega$ and $\\dot{\\Gamma} = \\Gamma \\times \\Omega$, with $\\Omega = I^{-1}\\Pi$ held constant over the infinitesimal interval for the purpose of the split. This describes a rotation of the vectors $\\Pi$ and $\\Gamma$ around the axis $\\Omega$ with angular speed $\\|\\Omega\\|$. The solution over a time step $h$ is a rotation. Let $(\\Pi_n, \\Gamma_n)$ be the state at the beginning of the step. We first compute the angular velocity $\\Omega_n = I^{-1}\\Pi_n$. The state is then updated by a rotation matrix $R_n = \\exp(h[\\Omega_n]_\\times)$, where $[\\Omega_n]_\\times$ is the skew-symmetric matrix corresponding to the cross product with $\\Omega_n$.\nThe intermediate state $(\\Pi_{n+1/2}, \\Gamma_{n+1/2})$ is:\n$$\n\\Pi_{n+1/2} = R_n \\Pi_n\n$$\n$$\n\\Gamma_{n+1/2} = R_n \\Gamma_n\n$$\nSince $R_n$ is an orthogonal matrix ($R_n^T R_n = I$), it preserves norms and dot products. Therefore, this step preserves both Casimirs:\n$\\|\\Gamma_{n+1/2}\\|^2 = \\|R_n \\Gamma_n\\|^2 = \\Gamma_n^T R_n^T R_n \\Gamma_n = \\Gamma_n^T \\Gamma_n = \\|\\Gamma_n\\|^2$.\n$\\Pi_{n+1/2} \\cdot \\Gamma_{n+1/2} = (R_n \\Pi_n) \\cdot (R_n \\Gamma_n) = \\Pi_n^T R_n^T R_n \\Gamma_n = \\Pi_n^T \\Gamma_n = \\Pi_n \\cdot \\Gamma_n$.\n\n**Step 2: Flow of the gravitational torque sub-problem, $\\Phi_h^{f_2}$**\nThe equations for this part are $\\dot{\\Pi} = m g l \\, \\Gamma \\times e_3$ and $\\dot{\\Gamma} = 0$.\nIn this subsystem, $\\Gamma$ is constant. The equation for $\\Pi$ is a simple forward Euler step, which is exact since the right-hand side is constant over the step (as $\\Gamma$ is constant). We apply this flow to the intermediate state $(\\Pi_{n+1/2}, \\Gamma_{n+1/2})$.\nThe final state $(\\Pi_{n+1}, \\Gamma_{n+1})$ is:\n$$\n\\Pi_{n+1} = \\Pi_{n+1/2} + h \\, m g l \\, (\\Gamma_{n+1/2} \\times e_3)\n$$\n$$\n\\Gamma_{n+1} = \\Gamma_{n+1/2}\n$$\nNow, we check the preservation of Casimirs for this step.\nPreservation of $C_1$:\n$\\|\\Gamma_{n+1}\\|^2 = \\|\\Gamma_{n+1/2}\\|^2$. This is trivially preserved.\nPreservation of $C_2$:\n$ \\Pi_{n+1} \\cdot \\Gamma_{n+1} = \\left( \\Pi_{n+1/2} + h \\, m g l \\, (\\Gamma_{n+1/2} \\times e_3) \\right) \\cdot \\Gamma_{n+1/2} $\n$ = \\Pi_{n+1/2} \\cdot \\Gamma_{n+1/2} + h \\, m g l \\, ((\\Gamma_{n+1/2} \\times e_3) \\cdot \\Gamma_{n+1/2}) $\nThe second term is zero because the cross product $\\Gamma_{n+1/2} \\times e_3$ yields a vector that is orthogonal to $\\Gamma_{n+1/2}$. Therefore, their dot product is zero.\n$ \\Pi_{n+1} \\cdot \\Gamma_{n+1} = \\Pi_{n+1/2} \\cdot \\Gamma_{n+1/2} $\n\nBy composing both steps, we find that $(\\Pi_{n+1}, \\Gamma_{n+1})$ has the same Casimir values as $(\\Pi_n, \\Gamma_n)$. The change in Casimirs, $\\Delta C_1$ and $\\Delta C_2$, will be zero up to floating-point precision. The implementation will use `scipy.linalg.expm` to compute the matrix exponential, a numerically robust method.\n\nThe overall algorithm for a single step is:\n1. Given $(\\Pi_n, \\Gamma_n)$ and parameters $(I, m, g, l, h)$, calculate initial Casimirs $C_{1,n} = \\Gamma_n \\cdot \\Gamma_n$ and $C_{2,n} = \\Pi_n \\cdot \\Gamma_n$.\n2. Compute angular velocity $\\Omega_n = I^{-1} \\Pi_n$.\n3. Construct the skew-symmetric matrix $[\\Omega_n]_\\times$.\n4. Compute the rotation matrix $R_n = \\exp(h[\\Omega_n]_\\times)$.\n5. Apply the rotation: $\\Pi_{n+1/2} = R_n \\Pi_n$, $\\Gamma_{n+1/2} = R_n \\Gamma_n$.\n6. Apply the gravitational torque: $\\Pi_{n+1} = \\Pi_{n+1/2} + hmg l (\\Gamma_{n+1/2} \\times e_3)$, $\\Gamma_{n+1} = \\Gamma_{n+1/2}$.\n7. Calculate final Casimirs $C_{1,n+1} = \\Gamma_{n+1} \\cdot \\Gamma_{n+1}$ and $C_{2,n+1} = \\Pi_{n+1} \\cdot \\Gamma_{n+1}$.\n8. Compute differences $\\Delta C_1 = C_{1,n+1} - C_{1,n}$ and $\\Delta C_2 = C_{2,n+1} - C_{2,n}$.\n9. Return the required list of eight values: $(\\Pi_{n+1}, \\Gamma_{n+1}, \\Delta C_1, \\Delta C_2)$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Solves the heavy top problem for the given test cases using a\n    one-step, first-order Lie-Poisson integrator.\n    \"\"\"\n\n    test_cases = [\n        # 1. Happy path with anisotropic inertia\n        {\n            \"I_diag\": np.array([0.37, 0.52, 0.91]),\n            \"m\": 3.0, \"g\": 9.80665, \"l\": 0.25, \"h\": 0.01,\n            \"Pi\": np.array([0.12, -0.08, 0.20]),\n            \"Gamma\": np.array([0.5, 0.5, 0.70710678]),\n        },\n        # 2. Boundary case with zero angular momentum\n        {\n            \"I_diag\": np.array([1.1, 0.9, 0.7]),\n            \"m\": 2.5, \"g\": 9.81, \"l\": 0.35, \"h\": 0.005,\n            \"Pi\": np.array([0.0, 0.0, 0.0]),\n            \"Gamma\": np.array([0.6, -0.8, 0.0]),\n        },\n        # 3. Edge case with vertical alignment Gamma || e_3\n        {\n            \"I_diag\": np.array([0.8, 0.6, 0.4]),\n            \"m\": 1.2, \"g\": 9.81, \"l\": 0.20, \"h\": 0.02,\n            \"Pi\": np.array([0.3, -0.15, 0.05]),\n            \"Gamma\": np.array([0.0, 0.0, 1.0]),\n        },\n        # 4. No gravity case (g = 0)\n        {\n            \"I_diag\": np.array([0.5, 0.5, 0.5]),\n            \"m\": 4.0, \"g\": 0.0, \"l\": 0.30, \"h\": 0.015,\n            \"Pi\": np.array([0.05, 0.08, -0.02]),\n            \"Gamma\": np.array([0.2, 0.5, 0.842614]),\n        },\n    ]\n\n    results = []\n    e3 = np.array([0.0, 0.0, 1.0])\n\n    for case in test_cases:\n        I_inv = np.diag(1.0 / case[\"I_diag\"])\n        m, g, l, h = case[\"m\"], case[\"g\"], case[\"l\"], case[\"h\"]\n        Pi_n, Gamma_n = case[\"Pi\"], case[\"Gamma\"]\n\n        # Calculate initial Casimirs\n        C1_initial = np.dot(Gamma_n, Gamma_n)\n        C2_initial = np.dot(Pi_n, Gamma_n)\n\n        # Step 1: Free rigid body motion (Flow of f1)\n        Omega_n = I_inv @ Pi_n\n        \n        # Handle zero rotation case\n        if np.linalg.norm(Omega_n) == 0.0:\n            R_n = np.identity(3)\n        else:\n            # Construct skew-symmetric matrix for cross product\n            Omega_skew = np.array([\n                [0, -Omega_n[2], Omega_n[1]],\n                [Omega_n[2], 0, -Omega_n[0]],\n                [-Omega_n[1], Omega_n[0], 0]\n            ])\n            # Compute rotation matrix using matrix exponential\n            R_n = expm(h * Omega_skew)\n        \n        # Apply rotation\n        Pi_half = R_n @ Pi_n\n        Gamma_half = R_n @ Gamma_n\n\n        # Step 2: Gravitational action (Flow of f2)\n        torque = m * g * l * np.cross(Gamma_half, e3)\n        \n        Pi_new = Pi_half + h * torque\n        Gamma_new = Gamma_half  # Gamma is constant in this step\n\n        # Calculate final Casimirs and their change\n        C1_final = np.dot(Gamma_new, Gamma_new)\n        C2_final = np.dot(Pi_new, Gamma_new)\n        \n        delta_C1 = C1_final - C1_initial\n        delta_C2 = C2_final - C2_initial\n        \n        # Format result for this case\n        case_result = list(Pi_new) + list(Gamma_new) + [delta_C1, delta_C2]\n        results.append(case_result)\n    \n    # Format the final output string\n    # Using a list of lists comprehension for clean formatting.\n    # The str() conversion is sufficient for standard floating point representation.\n    output_str = \"[\" + \",\".join([\n        \"[\" + \",\".join(map(str, res)) + \"]\" for res in results\n    ]) + \"]\"\n\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}