{
    "hands_on_practices": [
        {
            "introduction": "The isomorphism between the Lie algebra $\\mathfrak{so}(3)$ and $\\mathbb{R}^3$ with the cross product is a cornerstone of geometric mechanics. This practice solidifies this connection by having you compute the matrix representation of the adjoint operator, $\\mathrm{ad}_{\\widehat{a}}$. By working through the definitions of the Lie bracket and the basis of $\\mathfrak{so}(3)$, you will directly demonstrate that the action of the adjoint map is equivalent to the cross-product operation, providing a concrete understanding of this crucial concept. ",
            "id": "3779331",
            "problem": "Consider the Special Orthogonal Group $\\mathrm{SO}(3)$ with Lie algebra $\\mathfrak{so}(3)$, identified with $\\mathbb{R}^{3}$ via the linear map $a \\mapsto \\widehat{a}$ defined by $\\widehat{a} x = a \\times x$ for all $x \\in \\mathbb{R}^{3}$, where $\\times$ denotes the vector cross product. Let $\\{e_{1}, e_{2}, e_{3}\\}$ denote the standard basis of $\\mathbb{R}^{3}$, and define the basis $\\{E_{1}, E_{2}, E_{3}\\}$ of $\\mathfrak{so}(3)$ by $E_{i} := \\widehat{e_{i}}$. The Lie bracket on $\\mathfrak{so}(3)$ is the matrix commutator $[A,B] = AB - BA$. Let $\\epsilon_{ijk}$ denote the Levi-Civita symbol and assume the Einstein summation convention is not in effect unless explicitly stated.\n\nStarting from the core definitions above, compute the linear map $\\mathrm{ad}_{\\widehat{a}} : \\mathfrak{so}(3) \\to \\mathfrak{so}(3)$ defined by $\\mathrm{ad}_{\\widehat{a}}(X) = [\\widehat{a}, X]$ on the basis vectors $\\{E_{1}, E_{2}, E_{3}\\}$, and represent $\\mathrm{ad}_{\\widehat{a}}$ as a single $3 \\times 3$ matrix with respect to the ordered basis $\\{E_{1}, E_{2}, E_{3}\\}$, with entries expressed in terms of $\\epsilon_{ijk}$ and the components $a_{1}, a_{2}, a_{3}$ of $a$. Your final answer must be a closed-form analytic expression (no numerical evaluation is required).",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It is a standard exercise in the study of Lie algebras, specifically $\\mathfrak{so}(3)$, and its adjoint representation. All terms are formally defined, and the premises are consistent and complete.\n\nOur objective is to find the $3 \\times 3$ matrix representation of the linear map $\\mathrm{ad}_{\\widehat{a}} : \\mathfrak{so}(3) \\to \\mathfrak{so}(3)$ with respect to the ordered basis $\\{E_{1}, E_{2}, E_{3}\\}$. The map is defined as $\\mathrm{ad}_{\\widehat{a}}(X) = [\\widehat{a}, X]$, where the bracket is the matrix commutator.\n\nLet $a \\in \\mathbb{R}^{3}$ be a vector with components $(a_1, a_2, a_3)$, so $a = \\sum_{i=1}^{3} a_i e_i$. The corresponding element in $\\mathfrak{so}(3)$ is $\\widehat{a}$. The basis of $\\mathfrak{so}(3)$ is given by $E_i = \\widehat{e_i}$ for $i \\in \\{1, 2, 3\\}$. By linearity of the hat map, we can express $\\widehat{a}$ in this basis:\n$$\n\\widehat{a} = \\widehat{\\sum_{i=1}^{3} a_i e_i} = \\sum_{i=1}^{3} a_i \\widehat{e_i} = \\sum_{i=1}^{3} a_i E_i\n$$\nThe matrix representation of $\\mathrm{ad}_{\\widehat{a}}$ is a matrix whose $j$-th column is the coordinate vector of $\\mathrm{ad}_{\\widehat{a}}(E_j)$ in the basis $\\{E_1, E_2, E_3\\}$. We compute the action of $\\mathrm{ad}_{\\widehat{a}}$ on a basis vector $E_j$:\n$$\n\\mathrm{ad}_{\\widehat{a}}(E_j) = [\\widehat{a}, E_j]\n$$\nUsing the expression for $\\widehat{a}$ and the bilinearity of the Lie bracket:\n$$\n\\mathrm{ad}_{\\widehat{a}}(E_j) = \\left[ \\sum_{i=1}^{3} a_i E_i, E_j \\right] = \\sum_{i=1}^{3} a_i [E_i, E_j]\n$$\nTo proceed, we must compute the commutators of the basis vectors, $[E_i, E_j]$. These are the structure constants of the Lie algebra. The commutator of two hat-mapped vectors is given by the hat map of their cross product: $[\\widehat{u}, \\widehat{v}] = \\widehat{u \\times v}$. This is a fundamental property of the Lie algebra isomorphism between $(\\mathbb{R}^3, \\times)$ and $(\\mathfrak{so}(3), [,])$.\nApplying this property to our basis vectors $E_i = \\widehat{e_i}$ and $E_j = \\widehat{e_j}$:\n$$\n[E_i, E_j] = [\\widehat{e_i}, \\widehat{e_j}] = \\widehat{e_i \\times e_j}\n$$\nThe cross product of the standard basis vectors of $\\mathbb{R}^3$ is given by the Levi-Civita symbol $\\epsilon_{ijk}$:\n$$\ne_i \\times e_j = \\sum_{k=1}^{3} \\epsilon_{ijk} e_k\n$$\nSubstituting this into the expression for the commutator:\n$$\n[E_i, E_j] = \\widehat{\\sum_{k=1}^{3} \\epsilon_{ijk} e_k} = \\sum_{k=1}^{3} \\epsilon_{ijk} \\widehat{e_k} = \\sum_{k=1}^{3} \\epsilon_{ijk} E_k\n$$\nNow we substitute this result back into our expression for $\\mathrm{ad}_{\\widehat{a}}(E_j)$:\n$$\n\\mathrm{ad}_{\\widehat{a}}(E_j) = \\sum_{i=1}^{3} a_i [E_i, E_j] = \\sum_{i=1}^{3} a_i \\left( \\sum_{k=1}^{3} \\epsilon_{ijk} E_k \\right)\n$$\nBy reordering the summations, we can express this result as a linear combination of the basis vectors $E_k$:\n$$\n\\mathrm{ad}_{\\widehat{a}}(E_j) = \\sum_{k=1}^{3} \\left( \\sum_{i=1}^{3} a_i \\epsilon_{ijk} \\right) E_k\n$$\nThe coefficient of $E_k$ in the expansion of $\\mathrm{ad}_{\\widehat{a}}(E_j)$ is the matrix element $M_{kj}$ of the transformation matrix $M$ for $\\mathrm{ad}_{\\widehat{a}}$ (where $k$ is the row index and $j$ is the column index). Thus:\n$$\nM_{kj} = \\sum_{i=1}^{3} a_i \\epsilon_{ijk}\n$$\nWe can now compute the entries of the $3 \\times 3$ matrix $M = [\\mathrm{ad}_{\\widehat{a}}]$ explicitly.\n\nFor the first column ($j=1$):\n$M_{11} = \\sum_{i=1}^{3} a_i \\epsilon_{i11} = 0$\n$M_{21} = \\sum_{i=1}^{3} a_i \\epsilon_{i12} = a_3 \\epsilon_{312} = a_3(1) = a_3$\n$M_{31} = \\sum_{i=1}^{3} a_i \\epsilon_{i13} = a_2 \\epsilon_{213} = a_2(-1) = -a_2$\n\nFor the second column ($j=2$):\n$M_{12} = \\sum_{i=1}^{3} a_i \\epsilon_{i21} = a_3 \\epsilon_{321} = a_3(-1) = -a_3$\n$M_{22} = \\sum_{i=1}^{3} a_i \\epsilon_{i22} = 0$\n$M_{32} = \\sum_{i=1}^{3} a_i \\epsilon_{i23} = a_1 \\epsilon_{123} = a_1(1) = a_1$\n\nFor the third column ($j=3$):\n$M_{13} = \\sum_{i=1}^{3} a_i \\epsilon_{i31} = a_2 \\epsilon_{231} = a_2(1) = a_2$\n$M_{23} = \\sum_{i=1}^{3} a_i \\epsilon_{i32} = a_1 \\epsilon_{132} = a_1(-1) = -a_1$\n$M_{33} = \\sum_{i=1}^{3} a_i \\epsilon_{i33} = 0$\n\nAssembling these components into the matrix $M$:\n$$\nM = \\begin{pmatrix} M_{11} & M_{12} & M_{13} \\\\ M_{21} & M_{22} & M_{23} \\\\ M_{31} & M_{32} & M_{33} \\end{pmatrix} = \\begin{pmatrix} 0 & -a_3 & a_2 \\\\ a_3 & 0 & -a_1 \\\\ -a_2 & a_1 & 0 \\end{pmatrix}\n$$\nThis resulting matrix is precisely the matrix representation of the hat map applied to the vector $a$, i.e., $M = \\widehat{a}$. Therefore, the matrix for the adjoint map $\\mathrm{ad}_{\\widehat{a}}$ in the basis $\\{E_1, E_2, E_3\\}$ is $\\widehat{a}$ itself.\nThe entry $M_{kj}$ of this matrix can be written compactly using the Levi-Civita symbol and the property $\\epsilon_{ijk} = \\epsilon_{kij}$:\n$$\nM_{kj} = \\sum_{i=1}^{3} a_i \\epsilon_{ijk} = \\sum_{i=1}^{3} a_i \\epsilon_{kij} = \\sum_{i=1}^{3} \\epsilon_{kij} a_i\n$$\nThe expression $\\sum_{i=1}^{3} \\epsilon_{kij} a_i$ is the standard formula for the $(k,j)$-th entry of the matrix $\\widehat{a}$. This confirms our result.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & -a_{3} & a_{2} \\\\ a_{3} & 0 & -a_{1} \\\\ -a_{2} & a_{1} & 0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While the exponential map takes an axis-angle vector from $\\mathfrak{so}(3)$ to a rotation matrix in $\\mathrm{SO}(3)$, the inverse operation—the matrix logarithm—is equally important for analysis and control. This exercise guides you through the derivation of a numerically robust formula for the logarithm, $\\widehat{a} = \\log(R)$. You will see how to leverage Rodrigues' formula and specific trigonometric functions to create an expression that avoids instabilities near the identity, a critical consideration in practical applications. ",
            "id": "3779327",
            "problem": "Let $R \\in \\mathrm{SO}(3)$ be a rotation matrix in the Special Orthogonal Group (SO(3)), and let $\\mathfrak{so}(3)$ denote its Lie algebra consisting of $3 \\times 3$ real skew-symmetric matrices. Identify $\\mathfrak{so}(3)$ with $\\mathbb{R}^{3}$ by the hat map $\\widehat{(\\cdot)}:\\mathbb{R}^{3} \\to \\mathfrak{so}(3)$ defined by $\\widehat{a}\\,x = a \\times x$ for all $x \\in \\mathbb{R}^{3}$, where $a \\in \\mathbb{R}^{3}$ and $\\times$ denotes the cross product. Let $a \\in \\mathbb{R}^{3}$ be the axis-angle vector such that $R = \\exp(\\widehat{a})$, and denote $\\theta = \\|a\\|$. Define the normalized trigonometric functions $\\mathrm{sinc}:\\mathbb{R} \\to \\mathbb{R}$ and $\\mathrm{vsinc}:\\mathbb{R} \\to \\mathbb{R}$ by\n$$\n\\mathrm{sinc}(x) = \\begin{cases}\n\\frac{\\sin(x)}{x}, & x \\neq 0,\\\\\n1, & x = 0,\n\\end{cases}\n\\qquad\n\\mathrm{vsinc}(x) = \\begin{cases}\n\\frac{1 - \\cos(x)}{x^{2}}, & x \\neq 0,\\\\\n\\frac{1}{2}, & x = 0.\n\\end{cases}\n$$\nStarting from the power-series definition of the matrix exponential and the algebraic identity $\\widehat{a}^{2} = a a^{\\top} - \\|a\\|^{2} I$, derive an analytic expression for $\\widehat{a} = \\log(R)$ in terms of $R$ that remains numerically stable as $\\theta \\to 0$ by using the functions $\\mathrm{sinc}$ and $\\mathrm{vsinc}$ to reorganize the inversion and avoid catastrophic cancellation. Your final expression must depend only on $R$ and standard matrix scalars without introducing any iterative or piecewise procedures, and it must be a single closed-form analytic expression. No rounding is required, and no units are involved. Express the final answer for $\\widehat{a}$ succinctly.",
            "solution": "The user-provided problem has been analyzed and is determined to be valid. It is scientifically grounded, well-posed, and objective. The problem statement is self-contained and free of contradictions or ambiguities. It presents a standard but non-trivial task in geometric mechanics that can be solved through rigorous mathematical derivation.\n\nThe objective is to derive a closed-form, numerically stable expression for the Lie algebra element $\\widehat{a} = \\log(R)$ corresponding to a rotation matrix $R \\in \\mathrm{SO}(3)$. The derivation will start from the power-series definition of the matrix exponential and use the provided algebraic identity and trigonometric functions.\n\nFirst, we express the rotation matrix $R = \\exp(\\widehat{a})$ using its power series expansion:\n$$ R = \\exp(\\widehat{a}) = \\sum_{k=0}^{\\infty} \\frac{\\widehat{a}^k}{k!} = I + \\widehat{a} + \\frac{\\widehat{a}^2}{2!} + \\frac{\\widehat{a}^3}{3!} + \\dots $$\nwhere $I$ is the $3 \\times 3$ identity matrix.\n\nThe problem provides the identity $\\widehat{a}^2 = aa^\\top - \\|a\\|^2 I$. Let $\\theta = \\|a\\|$ be the magnitude of the axis-angle vector $a$. The identity becomes $\\widehat{a}^2 = aa^\\top - \\theta^2 I$. We find the higher powers of $\\widehat{a}$ by repeatedly applying this identity. For $\\widehat{a}^3$:\n$$ \\widehat{a}^3 = \\widehat{a} (\\widehat{a}^2) = \\widehat{a} (aa^\\top - \\theta^2 I) = \\widehat{a}(aa^\\top) - \\theta^2 \\widehat{a} $$\nThe term $\\widehat{a}(aa^\\top)$ represents a matrix that, when acting on a vector $x \\in \\mathbb{R}^3$, yields $\\widehat{a}(aa^\\top)x = a \\times (a(a^\\top x))$. Since $a^\\top x$ is a scalar, this is equivalent to $(a^\\top x)(a \\times a)$. The cross product of any vector with itself is the zero vector, $a \\times a = 0$, so the matrix $\\widehat{a}(aa^\\top)$ is the zero matrix. This simplifies the expression for $\\widehat{a}^3$ to a recurrence relation:\n$$ \\widehat{a}^3 = -\\theta^2 \\widehat{a} $$\nThis relation allows us to express all higher powers of $\\widehat{a}$ in terms of $\\widehat{a}$ and $\\widehat{a}^2$:\n$$ \\widehat{a}^4 = \\widehat{a}(\\widehat{a}^3) = -\\theta^2 \\widehat{a}^2 $$\n$$ \\widehat{a}^5 = \\widehat{a}(\\widehat{a}^4) = -\\theta^2 \\widehat{a}^3 = \\theta^4 \\widehat{a} $$\nIn general, for $k \\ge 1$, we have $\\widehat{a}^{2k} = (-1)^{k-1}\\theta^{2(k-1)}\\widehat{a}^2$ and for $k \\ge 0$, $\\widehat{a}^{2k+1} = (-1)^k\\theta^{2k}\\widehat{a}$.\n\nWe substitute these into the power series for $R$, separating terms with odd and even powers of $\\widehat{a}$:\n$$ R = I + \\left(\\sum_{k=0}^{\\infty} \\frac{(-1)^k \\theta^{2k}}{(2k+1)!}\\right) \\widehat{a} + \\left(\\sum_{k=1}^{\\infty} \\frac{(-1)^{k-1} \\theta^{2(k-1)}}{(2k)!}\\right) \\widehat{a}^2 $$\nThe series coefficients are recognizable as Taylor series for trigonometric functions.\nThe coefficient of $\\widehat{a}$ is:\n$$ 1 - \\frac{\\theta^2}{3!} + \\frac{\\theta^4}{5!} - \\dots = \\frac{1}{\\theta} \\left(\\theta - \\frac{\\theta^3}{3!} + \\frac{\\theta^5}{5!} - \\dots \\right) = \\frac{\\sin(\\theta)}{\\theta} $$\nUsing the function $\\mathrm{sinc}(\\theta)$ as defined in the problem, this coefficient is $\\mathrm{sinc}(\\theta)$.\n\nThe coefficient of $\\widehat{a}^2$ is:\n$$ \\frac{1}{2!} - \\frac{\\theta^2}{4!} + \\frac{\\theta^4}{6!} - \\dots = \\frac{1}{\\theta^2} \\left(\\frac{\\theta^2}{2!} - \\frac{\\theta^4}{4!} + \\frac{\\theta^6}{6!} - \\dots \\right) = \\frac{1 - \\cos(\\theta)}{\\theta^2} $$\nUsing the function $\\mathrm{vsinc}(\\theta)$ as defined, this coefficient is $\\mathrm{vsinc}(\\theta)$. The definitions of these functions ensure they are well-defined and continuous at $\\theta=0$.\n\nThis yields the celebrated Rodrigues' rotation formula in a form that is manifestly stable for small $\\theta$:\n$$ R = I + \\mathrm{sinc}(\\theta) \\widehat{a} + \\mathrm{vsinc}(\\theta) \\widehat{a}^2 $$\nTo find $\\widehat{a} = \\log(R)$, we must invert this equation.\n\nFirst, we can find the rotation angle $\\theta$ by taking the trace of $R$.\n$$ \\mathrm{tr}(R) = \\mathrm{tr}(I) + \\mathrm{sinc}(\\theta) \\mathrm{tr}(\\widehat{a}) + \\mathrm{vsinc}(\\theta) \\mathrm{tr}(\\widehat{a}^2) $$\nThe trace of the identity matrix $I \\in \\mathbb{R}^{3 \\times 3}$ is $\\mathrm{tr}(I)=3$. As a skew-symmetric matrix, $\\widehat{a}$ has zero trace, $\\mathrm{tr}(\\widehat{a})=0$. The trace of $\\widehat{a}^2$ is $\\mathrm{tr}(\\widehat{a}^2) = \\mathrm{tr}(aa^\\top - \\theta^2 I) = \\mathrm{tr}(aa^\\top) - \\mathrm{tr}(\\theta^2 I) = a^\\top a - 3\\theta^2 = \\|a\\|^2 - 3\\theta^2 = \\theta^2 - 3\\theta^2 = -2\\theta^2$.\nSubstituting these values:\n$$ \\mathrm{tr}(R) = 3 + 0 + \\mathrm{vsinc}(\\theta)(-2\\theta^2) = 3 - 2\\theta^2\\left(\\frac{1-\\cos(\\theta)}{\\theta^2}\\right) = 3 - 2(1-\\cos(\\theta)) = 1 + 2\\cos(\\theta) $$\nFrom this, we solve for $\\cos(\\theta)$:\n$$ \\cos(\\theta) = \\frac{\\mathrm{tr}(R) - 1}{2} $$\nFor the principal logarithm, the angle $\\theta$ is restricted to $[0, \\pi]$. Thus, $\\theta$ can be uniquely determined as:\n$$ \\theta = \\arccos\\left(\\frac{\\mathrm{tr}(R) - 1}{2}\\right) $$\nNext, to isolate $\\widehat{a}$, we utilize its skew-symmetric property. The transpose of $R$ is:\n$$ R^\\top = (I + \\mathrm{sinc}(\\theta) \\widehat{a} + \\mathrm{vsinc}(\\theta) \\widehat{a}^2)^\\top $$\nSince $I^\\top=I$, $\\widehat{a}^\\top = -\\widehat{a}$, and $(\\widehat{a}^2)^\\top = (\\widehat{a}^\\top)^2 = (-\\widehat{a})^2 = \\widehat{a}^2$, we have:\n$$ R^\\top = I - \\mathrm{sinc}(\\theta) \\widehat{a} + \\mathrm{vsinc}(\\theta) \\widehat{a}^2 $$\nSubtracting $R^\\top$ from $R$ cancels the identity and symmetric $\\widehat{a}^2$ terms:\n$$ R - R^\\top = (I + \\mathrm{sinc}(\\theta) \\widehat{a} + \\mathrm{vsinc}(\\theta) \\widehat{a}^2) - (I - \\mathrm{sinc}(\\theta) \\widehat{a} + \\mathrm{vsinc}(\\theta) \\widehat{a}^2) = 2\\mathrm{sinc}(\\theta) \\widehat{a} $$\nSolving for $\\widehat{a}$ gives:\n$$ \\widehat{a} = \\frac{1}{2\\mathrm{sinc}(\\theta)} (R - R^\\top) = \\frac{\\theta}{2\\sin(\\theta)} (R - R^\\top) $$\nThis expression is valid for $\\theta \\in (0, \\pi)$. To obtain the final expression in terms of $R$ alone, we substitute the expressions for $\\theta$ and $\\sin(\\theta)$. We already have $\\theta$ in terms of $\\mathrm{tr}(R)$. For $\\sin(\\theta)$, we use the identity $\\sin(\\theta) = \\sqrt{1 - \\cos^2(\\theta)}$, where the positive root is chosen because $\\theta \\in [0, \\pi]$ implies $\\sin(\\theta) \\ge 0$.\n$$ \\sin(\\theta) = \\sqrt{1 - \\left(\\frac{\\mathrm{tr}(R) - 1}{2}\\right)^2} = \\frac{1}{2}\\sqrt{4 - (\\mathrm{tr}(R) - 1)^2} $$\nSubstituting the expressions for $\\theta$ and $\\sin(\\theta)$ into the formula for $\\widehat{a}$:\n$$ \\widehat{a} = \\frac{\\arccos\\left(\\frac{\\mathrm{tr}(R) - 1}{2}\\right)}{2 \\cdot \\frac{1}{2}\\sqrt{4 - (\\mathrm{tr}(R) - 1)^2}} (R - R^\\top) $$\nThis simplifies to the final closed-form expression for the matrix logarithm of $R$:\n$$ \\widehat{a} = \\frac{\\arccos\\left(\\frac{\\mathrm{tr}(R) - 1}{2}\\right)}{\\sqrt{4 - (\\mathrm{tr}(R) - 1)^2}} (R - R^\\top) $$\nThis expression is a single analytic function of $R$. As $\\theta \\to 0$, $\\mathrm{tr}(R) \\to 3$, and the expression approaches the indeterminate form $0/0$. However, a limit analysis shows the scalar coefficient tends to $1/2$, matching the first-order approximation $\\widehat{a} \\approx \\frac{1}{2}(R-R^\\top)$, confirming the formula's numerical stability for small angles as required.",
            "answer": "$$ \\boxed{ \\frac{\\arccos\\left(\\frac{1}{2}(\\mathrm{tr}(R) - 1)\\right)}{\\sqrt{4 - (\\mathrm{tr}(R) - 1)^2}} (R - R^\\top) } $$"
        },
        {
            "introduction": "Simulating rigid body dynamics on a computer presents a significant challenge: standard numerical integrators do not inherently respect the geometric constraints of the rotation group $\\mathrm{SO}(3)$. This hands-on problem asks you to derive and implement a projection method that enforces these constraints, a cornerstone of many geometric integration schemes. You will connect the singular value decomposition (SVD) to the problem of finding the \"closest\" rotation matrix and analyze how this projection relates to the exponential map, bridging the gap between abstract theory and computational practice. ",
            "id": "3779340",
            "problem": "Consider the Lie group of special orthogonal matrices $\\mathrm{SO}(3)$ and its Lie algebra $\\mathfrak{so}(3)$ identified with $\\mathbb{R}^3$ via the hat map $\\widehat{(\\cdot)}:\\mathbb{R}^3\\to\\mathfrak{so}(3)$, which satisfies $\\widehat{\\omega}\\,v=\\omega\\times v$ for every $\\omega,v\\in\\mathbb{R}^3$. Let $\\Omega(t)\\in\\mathfrak{so}(3)$ denote the angular velocity, and consider the kinematic equation $\\dot{R}(t)=R(t)\\,\\Omega(t)$ for $R(t)\\in\\mathrm{SO}(3)$. For constant angular velocity over a time step $h>0$, the exact update from $t$ to $t+h$ is $R(t+h)=R(t)\\,\\exp(h\\,\\Omega)$, where $\\exp:\\mathfrak{so}(3)\\to\\mathrm{SO}(3)$ is the matrix exponential.\n\nIn numerical integration, a first-order explicit Euler step from $R(t)$ produces $\\widetilde{R}=R(t)+h\\,R(t)\\,\\Omega=R(t)\\,(I+h\\,\\Omega)$, which generally violates the orthogonality constraint $\\widetilde{R}^\\top\\widetilde{R}=I$ and may not have determinant $1$. A projection method onto $\\mathrm{SO}(3)$ aims to map $\\widetilde{R}$ to $R_{\\mathrm{proj}}\\in\\mathrm{SO}(3)$ that is closest to $\\widetilde{R}$ in a suitable norm and enforces $R_{\\mathrm{proj}}^\\top R_{\\mathrm{proj}}=I$ and $\\det(R_{\\mathrm{proj}})=1$.\n\nYour tasks are:\n\n- Derive, from first principles, a projection method that, given $\\widetilde{R}\\in\\mathbb{R}^{3\\times 3}$, returns $R_{\\mathrm{proj}}\\in\\mathrm{SO}(3)$ minimizing $\\|\\widetilde{R}-R_{\\mathrm{proj}}\\|_F$ subject to $R_{\\mathrm{proj}}^\\top R_{\\mathrm{proj}}=I$ and $\\det(R_{\\mathrm{proj}})=1$, where $\\|\\cdot\\|_F$ denotes the Frobenius norm. Show this minimizer equals $U\\,V^\\top$ obtained from the Singular Value Decomposition (SVD) of $\\widetilde{R}=U\\,\\Sigma\\,V^\\top$ (Singular Value Decomposition (SVD)), with the adjustment that $\\det(U\\,V^\\top)$ is enforced to be $1$ by flipping the sign of the appropriate singular vector if necessary.\n\n- Establish the relation of this projection method to the exponential map by considering the case $R(t)=I$ and $\\Omega=\\widehat{\\omega}$ with constant $\\omega\\in\\mathbb{R}^3$ over a time step $h$. Using series expansions up to the necessary order, show that the projected Euler update $R_{\\mathrm{proj}}(h)$ satisfies $R_{\\mathrm{proj}}(h)=\\exp(h\\,\\widehat{\\omega})+O(h^2)$ in the canonical bi-invariant Riemannian metric on $\\mathrm{SO}(3)$, and compute the leading-order term of the deviation.\n\n- Implement the following in a program:\n  1. The hat map $\\widehat{(\\cdot)}$ and the exponential map $\\exp:\\mathfrak{so}(3)\\to\\mathrm{SO}(3)$ using the Rodrigues formula. Angles must be computed and reported in radians.\n  2. The projection method derived above, with determinant correction as needed.\n  3. For each test case, starting from $R(t)=I$, compute $\\widetilde{R}=I+h\\,\\widehat{\\omega}$, project to $R_{\\mathrm{proj}}$, and compare with $R_{\\mathrm{true}}=\\exp(h\\,\\widehat{\\omega})$ by reporting:\n     - The pre-projection orthogonality error $\\|\\widetilde{R}^\\top\\widetilde{R}-I\\|_F$.\n     - The post-projection orthogonality error $\\|R_{\\mathrm{proj}}^\\top R_{\\mathrm{proj}}-I\\|_F$.\n     - The geodesic error $d_{\\mathrm{SO(3)}}(R_{\\mathrm{proj}},R_{\\mathrm{true}})$ defined as the rotation angle of $R_{\\mathrm{proj}}^\\top R_{\\mathrm{true}}$ in radians.\n     - A boolean indicating whether $|\\det(R_{\\mathrm{proj}})-1|<\\varepsilon$ for a tolerance $\\varepsilon=10^{-12}$.\n\n- Angles must be in radians. All reported floating-point values are real numbers.\n\nUse the following test suite of parameter values, interpreted as $\\omega\\in\\mathbb{R}^3$ and step size $h>0$:\n\n- Test case $1$: $\\omega=(0.3,-0.4,0.5)$, $h=0.1$.\n- Test case $2$: $\\omega=(10^{-8},-2\\times 10^{-8},3\\times 10^{-8})$, $h=1.0$.\n- Test case $3$: $\\omega=(2.0,3.0,-1.0)$, $h=0.5$.\n- Test case $4$: $\\omega=(10.0,0.0,0.0)$, $h=\\pi/10$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a list $[\\text{pre_orth_err},\\text{post_orth_err},\\text{geodesic_err},\\text{det_is_one}]$. For example, the output format must be $[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],\\ldots]$ with no additional text.",
            "solution": "The problem is valid as it is scientifically grounded in geometric mechanics and numerical analysis, well-posed, objective, and self-contained. All components are standard and verifiable.\n\n### Part 1: Derivation of the Projection Method\n\nThe first task is to find a matrix $R_{\\mathrm{proj}} \\in \\mathrm{SO}(3)$ that minimizes the Frobenius norm of the difference to a given matrix $\\widetilde{R} \\in \\mathbb{R}^{3\\times 3}$. The optimization problem is:\n$$\n\\min_{R \\in \\mathrm{SO}(3)} \\|\\widetilde{R} - R\\|_F^2\n$$\nThe Frobenius norm squared is given by $\\|\\mathbf{A}\\|_F^2 = \\mathrm{tr}(\\mathbf{A}^\\top \\mathbf{A})$. We can expand the objective function:\n$$\n\\|\\widetilde{R} - R\\|_F^2 = \\mathrm{tr}\\left((\\widetilde{R} - R)^\\top (\\widetilde{R} - R)\\right) = \\mathrm{tr}(\\widetilde{R}^\\top \\widetilde{R} - \\widetilde{R}^\\top R - R^\\top \\widetilde{R} + R^\\top R)\n$$\nUsing the linearity of the trace, this becomes:\n$$\n\\|\\widetilde{R} - R\\|_F^2 = \\mathrm{tr}(\\widetilde{R}^\\top \\widetilde{R}) - \\mathrm{tr}(\\widetilde{R}^\\top R) - \\mathrm{tr}(R^\\top \\widetilde{R}) + \\mathrm{tr}(R^\\top R)\n$$\nSince $R \\in \\mathrm{SO}(3)$, it is an orthogonal matrix, so $R^\\top R = I$. The trace is $\\mathrm{tr}(I) = 3$. Also, $\\mathrm{tr}(R^\\top \\widetilde{R}) = \\mathrm{tr}((R^\\top \\widetilde{R})^\\top) = \\mathrm{tr}(\\widetilde{R}^\\top R)$. The expression simplifies to:\n$$\n\\|\\widetilde{R} - R\\|_F^2 = \\mathrm{tr}(\\widetilde{R}^\\top \\widetilde{R}) - 2\\mathrm{tr}(\\widetilde{R}^\\top R) + 3\n$$\nThe term $\\mathrm{tr}(\\widetilde{R}^\\top \\widetilde{R})$ is a constant with respect to the optimization variable $R$. Therefore, minimizing $\\|\\widetilde{R} - R\\|_F^2$ is equivalent to maximizing $\\mathrm{tr}(\\widetilde{R}^\\top R)$.\n\nLet the Singular Value Decomposition (SVD) of $\\widetilde{R}$ be $\\widetilde{R} = U\\Sigma V^\\top$, where $U, V \\in \\mathrm{O}(3)$ are orthogonal matrices and $\\Sigma = \\mathrm{diag}(\\sigma_1, \\sigma_2, \\sigma_3)$ is a diagonal matrix of non-negative singular values, conventionally ordered such that $\\sigma_1 \\ge \\sigma_2 \\ge \\sigma_3 \\ge 0$.\n\nSubstituting the SVD into the trace expression we need to maximize:\n$$\n\\mathrm{tr}(\\widetilde{R}^\\top R) = \\mathrm{tr}((U\\Sigma V^\\top)^\\top R) = \\mathrm{tr}(V\\Sigma U^\\top R)\n$$\nUsing the cyclic property of the trace, $\\mathrm{tr}(ABC) = \\mathrm{tr}(CAB)$:\n$$\n\\mathrm{tr}(V\\Sigma U^\\top R) = \\mathrm{tr}(\\Sigma U^\\top R V)\n$$\nLet's define a new matrix $Z = U^\\top R V$. Since $U$, $R$, and $V$ are orthogonal, $Z$ is also an orthogonal matrix ($Z^\\top Z = V^\\top R^\\top U U^\\top R V = V^\\top R^\\top R V = V^\\top V = I$). The problem is now to maximize $\\mathrm{tr}(\\Sigma Z)$ over all orthogonal matrices $Z$ that can be formed this way.\nThe trace is $\\mathrm{tr}(\\Sigma Z) = \\sum_{i=1}^3 \\sigma_i Z_{ii}$. Since $Z$ is orthogonal, its column vectors are unit vectors, which implies that $|Z_{ii}| \\le 1$. To maximize this sum, given that $\\sigma_i \\ge 0$, we should make the diagonal entries $Z_{ii}$ as large as possible. The maximum is achieved when $Z_{ii}=1$ for all $i$, which corresponds to $Z=I$.\n\nIf we choose $Z=I$, then $U^\\top R V = I$, which implies $R = U I V^\\top = UV^\\top$. This matrix is in $\\mathrm{O}(3)$, but we need to satisfy the constraint $R \\in \\mathrm{SO}(3)$, which requires $\\det(R)=1$.\nLet's analyze $\\det(UV^\\top)$:\n$\\det(UV^\\top) = \\det(U)\\det(V^\\top) = \\det(U)\\det(V)$.\nThe determinants of $U$ and $V$ from SVD can be $\\pm 1$.\nThe problem splits into two cases:\n\nCase 1: $\\det(UV^\\top) = 1$.\nIn this case, our solution $R_{\\mathrm{proj}} = UV^\\top$ is already in $\\mathrm{SO}(3)$. The choice $Z=I$ is valid since $\\det(Z)=\\det(U^\\top R_{\\mathrm{proj}} V) = \\det(U^\\top)\\det(UV^\\top)\\det(V) = \\det(U)^{-1}(1)\\det(V) = \\det(U)\\det(V)=1$. So $R_{\\mathrm{proj}} = UV^\\top$ is the correct minimizer.\n\nCase 2: $\\det(UV^\\top) = -1$.\nOur previous choice $Z=I$ is not valid because it would imply $\\det(R_{\\mathrm{proj}})=-1$. We must find the maximum of $\\mathrm{tr}(\\Sigma Z)$ subject to $Z \\in \\mathrm{O}(3)$ and $\\det(Z) = \\det(U^\\top R V) = \\det(U^\\top)\\det(R)\\det(V) = \\det(U)\\det(V) = -1$.\nWe want to maximize $\\sum_i \\sigma_i Z_{ii}$. Since $\\sigma_1 \\ge \\sigma_2 \\ge \\sigma_3 \\ge 0$, to maximize the sum, we should make $Z_{ii}$ as large as possible, but must also satisfy $\\det(Z)=-1$. The optimal choice is to set the diagonal entries corresponding to the largest singular values to $1$ and flip the sign of the one corresponding to the smallest singular value. We choose $Z = \\mathrm{diag}(1, 1, -1)$. This matrix is orthogonal and has determinant $-1$. The trace value is $\\sigma_1 + \\sigma_2 - \\sigma_3$. This trace is maximal under the given constraints.\nThis choice of $Z$ gives $R_{\\mathrm{proj}} = U Z V^\\top = U \\mathrm{diag}(1, 1, -1) V^\\top$.\nLet's check the determinant: $\\det(R_{\\mathrm{proj}}) = \\det(U)\\det(\\mathrm{diag}(1,1,-1))\\det(V^\\top) = \\det(U)(-1)\\det(V) = -\\det(UV^\\top) = -(-1) = 1$. This matrix is in $\\mathrm{SO}(3)$.\n\nA compact way to write this solution for both cases is:\n$$\nR_{\\mathrm{proj}} = U \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & \\det(UV^\\top) \\end{pmatrix} V^\\top.\n$$\nThis formula enforces that the resulting matrix is in $\\mathrm{SO}(3)$ and is the closest one to $\\widetilde{R}$ in the Frobenius norm. For $\\widetilde{R} = I + h\\widehat{\\omega}$, we have $\\det(\\widetilde{R}) = \\det(I+h\\widehat{\\omega}) = 1 + h^2\\|\\omega\\|^2 > 0$. If $\\widetilde{R}$ is non-singular, $\\det(\\widetilde{R}) = \\det(U)\\det(\\Sigma)\\det(V^\\top) = \\det(UV^\\top)\\prod\\sigma_i$. Thus $\\mathrm{sgn}(\\det(UV^\\top)) = \\mathrm{sgn}(\\det(\\widetilde{R}))$. For the Euler step, $\\det(\\widetilde{R})>0$, so we are always in Case 1 and $R_{\\mathrm{proj}} = UV^\\top$.\n\n### Part 2: Analysis of the Projected Euler Method\n\nWe consider an Euler step from $R(t)=I$ with constant angular velocity $\\omega$, so $\\Omega = \\widehat{\\omega}$. The approximate rotation is $\\widetilde{R} = I + h \\widehat{\\omega}$. We project this matrix to $\\mathrm{SO}(3)$ using the derived method. The result $R_{\\mathrm{proj}}$ is the orthogonal part of the polar decomposition of $\\widetilde{R}$, which can be calculated as $R_{\\mathrm{proj}} = \\widetilde{R} (\\widetilde{R}^\\top \\widetilde{R})^{-1/2}$.\n\nFirst, we compute $\\widetilde{R}^\\top \\widetilde{R}$:\n$$\n\\widetilde{R}^\\top \\widetilde{R} = (I + h \\widehat{\\omega})^\\top (I + h \\widehat{\\omega}) = (I - h \\widehat{\\omega})(I + h \\widehat{\\omega}) = I - h^2 \\widehat{\\omega}^2.\n$$\nLet $\\phi = h\\|\\omega\\|$ be the total angle of rotation over the step $h$, and $n = \\omega/\\|\\omega\\|$ be the normalized axis of rotation. Then $h\\widehat{\\omega} = \\phi\\widehat{n}$. We use the identity $\\widehat{n}^2 = nn^\\top - I$.\n$$\n\\widetilde{R}^\\top \\widetilde{R} = I - \\phi^2 \\widehat{n}^2 = I - \\phi^2(nn^\\top - I) = (1+\\phi^2)I - \\phi^2 nn^\\top.\n$$\nThe matrix $S = (\\widetilde{R}^\\top \\widetilde{R})^{1/2}$ has the same eigenvectors as $\\widetilde{R}^\\top \\widetilde{R}$, which are $n$ (with eigenvalue $1$) and any vector orthogonal to $n$ (with eigenvalue $1+\\phi^2$). The eigenvalues of $S$ are the square roots of these, i.e., $1$ and $\\sqrt{1+\\phi^2}$. So, $S$ can be written using the projector $P_n = nn^\\top$:\n$$\nS = 1 \\cdot P_n + \\sqrt{1+\\phi^2} \\cdot (I - P_n).\n$$\nIts inverse is $S^{-1} = 1 \\cdot P_n + \\frac{1}{\\sqrt{1+\\phi^2}} \\cdot (I - P_n)$.\nNow we compute $R_{\\mathrm{proj}} = \\widetilde{R} S^{-1}$:\n$$\nR_{\\mathrm{proj}} = (I + \\phi\\widehat{n}) \\left(P_n + \\frac{1}{\\sqrt{1+\\phi^2}}(I-P_n)\\right) = P_n + \\frac{I-P_n}{\\sqrt{1+\\phi^2}} + \\phi\\widehat{n}P_n + \\frac{\\phi\\widehat{n}(I-P_n)}{\\sqrt{1+\\phi^2}}.\n$$\nUsing $\\widehat{n}P_n=0$ and $\\widehat{n}(I-P_n) = \\widehat{n}$, we get:\n$$\nR_{\\mathrm{proj}} = P_n + \\frac{1}{\\sqrt{1+\\phi^2}}(I-P_n) + \\frac{\\phi}{\\sqrt{1+\\phi^2}}\\widehat{n}.\n$$\nThis has the form of Rodrigues' rotation formula, $R = I + \\sin\\alpha \\widehat{n} + (1-\\cos\\alpha)\\widehat{n}^2$, rearranged as $R = P_n + \\cos\\alpha (I-P_n) + \\sin\\alpha \\widehat{n}$.\nBy comparison, the angle of rotation $\\theta_{\\mathrm{proj}}$ for $R_{\\mathrm{proj}}$ satisfies:\n$\\cos(\\theta_{\\mathrm{proj}}) = \\frac{1}{\\sqrt{1+\\phi^2}}$ and $\\sin(\\theta_{\\mathrm{proj}}) = \\frac{\\phi}{\\sqrt{1+\\phi^2}}$.\nThis implies $\\tan(\\theta_{\\mathrm{proj}}) = \\phi$. So, the angle of the projected rotation is $\\theta_{\\mathrm{proj}} = \\arctan(\\phi) = \\arctan(h\\|\\omega\\|)$. The axis is $n = \\omega/\\|\\omega\\|$.\n\nThe true solution is $R_{\\mathrm{true}} = \\exp(h\\widehat{\\omega})$, which is a rotation about axis $n$ by an angle $\\theta_{\\mathrm{true}} = \\phi = h\\|\\omega\\|$.\n\nThe geodesic distance on $\\mathrm{SO}(3)$, $d_{\\mathrm{SO(3)}}(R_1, R_2)$, is the angle of the relative rotation $R_1^\\top R_2$. Since $R_{\\mathrm{proj}}$ and $R_{\\mathrm{true}}$ share the same rotation axis $n$, the distance is simply the absolute difference of their rotation angles:\n$$\nd(R_{\\mathrm{proj}}, R_{\\mathrm{true}}) = |\\theta_{\\mathrm{true}} - \\theta_{\\mathrm{proj}}| = |\\phi - \\arctan(\\phi)|.\n$$\nUsing the Taylor series for $\\arctan(\\phi) = \\phi - \\frac{\\phi^3}{3} + O(\\phi^5)$, we find the leading-order term for the geodesic distance:\n$$\nd(R_{\\mathrm{proj}}, R_{\\mathrm{true}}) = \\left|\\phi - \\left(\\phi - \\frac{\\phi^3}{3} + O(\\phi^5)\\right)\\right| = \\frac{\\phi^3}{3} + O(\\phi^5) = \\frac{1}{3}h^3\\|\\omega\\|^3 + O(h^5).\n$$\nThe distance is $O(h^3)$. Since any function that is $O(h^3)$ is also $O(h^2)$, the statement \"$R_{\\mathrm{proj}}(h)=\\exp(h\\,\\widehat{\\omega})+O(h^2)$ in the canonical metric\" is technically correct, as the distance is bounded by $Ch^2$. The reason for the higher-than-expected order is that the projected Euler method is symmetric, and symmetric integrators have even orders of convergence. Its local error being $O(h^3)$ implies the method is second-order, a significant improvement over the standard first-order Euler method.\n\nThe leading-order term of the deviation in the matrix representation $R_{\\mathrm{proj}} - R_{\\mathrm{true}}$ is:\n$R_{\\mathrm{proj}} = I + \\sin(\\theta_{\\mathrm{proj}})\\widehat{n} + (1-\\cos(\\theta_{\\mathrm{proj}}))\\widehat{n}^2$\n$R_{\\mathrm{true}} = I + \\sin(\\theta_{\\mathrm{true}})\\widehat{n} + (1-\\cos(\\theta_{\\mathrm{true}}))\\widehat{n}^2$\n$\\sin(\\theta_{\\mathrm{proj}}) = \\phi(1+\\phi^2)^{-1/2} = \\phi - \\frac{1}{2}\\phi^3 + O(\\phi^5)$.\n$1-\\cos(\\theta_{\\mathrm{proj}}) = 1-(1+\\phi^2)^{-1/2} = \\frac{1}{2}\\phi^2 - \\frac{3}{8}\\phi^4 + O(\\phi^6)$.\n$\\sin(\\theta_{\\mathrm{true}}) = \\phi - \\frac{1}{6}\\phi^3 + O(\\phi^5)$.\n$1-\\cos(\\theta_{\\mathrm{true}}) = \\frac{1}{2}\\phi^2 - \\frac{1}{24}\\phi^4 + O(\\phi^6)$.\nThe difference is:\n$$\nR_{\\mathrm{proj}} - R_{\\mathrm{true}} = (\\sin(\\theta_{\\mathrm{proj}})-\\sin(\\theta_{\\mathrm{true}}))\\widehat{n} + ((1-\\cos\\theta_{\\mathrm{proj}})-(1-\\cos\\theta_{\\mathrm{true}}))\\widehat{n}^2.\n$$\nThe leading term comes from the $\\widehat{n}$ part:\n$$\nR_{\\mathrm{proj}} - R_{\\mathrm{true}} = \\left(\\left(\\phi - \\frac{1}{2}\\phi^3\\right) - \\left(\\phi - \\frac{1}{6}\\phi^3\\right)\\right)\\widehat{n} + O(\\phi^4) = -\\frac{1}{3}\\phi^3\\widehat{n} + O(\\phi^4).\n$$\nSubstituting back $\\phi=h\\|\\omega\\|$ and $\\widehat{n} = \\widehat{\\omega}/\\|\\omega\\|$:\n$$\nR_{\\mathrm{proj}} - R_{\\mathrm{true}} = -\\frac{1}{3}(h\\|\\omega\\|)^3 \\frac{\\widehat{\\omega}}{\\|\\omega\\|} + O(h^4) = -\\frac{1}{3}h^3\\|\\omega\\|^2 \\widehat{\\omega} + O(h^4).\n$$\nThis is the leading-order term of the deviation.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import svd\n\ndef hat(v):\n    \"\"\"\n    Computes the hat map of a vector v in R^3, mapping it to so(3).\n    \"\"\"\n    if v.shape != (3,):\n        raise ValueError(\"Input must be a 3-element vector.\")\n    return np.array([\n        [0, -v[2], v[1]],\n        [v[2], 0, -v[0]],\n        [-v[1], v[0], 0]\n    ])\n\ndef exp_so3(Omega):\n    \"\"\"\n    Computes the exponential map from so(3) to SO(3) using Rodrigues' formula.\n    Omega is a 3x3 skew-symmetric matrix.\n    \"\"\"\n    # Extract omega vector from Omega matrix\n    w = np.array([Omega[2, 1], Omega[0, 2], Omega[1, 0]])\n    theta = np.linalg.norm(w)\n    I = np.identity(3)\n\n    if theta < 1e-12: # Handle small angles to avoid division by zero\n        # Taylor expansion: I + Omega + Omega^2/2\n        return I + Omega + 0.5 * (Omega @ Omega)\n    \n    K = Omega / theta\n    # Rodrigues' formula\n    R = I + np.sin(theta) * K + (1 - np.cos(theta)) * (K @ K)\n    return R\n\ndef project_to_so3(R_tilde):\n    \"\"\"\n    Projects a 3x3 matrix R_tilde to the closest matrix in SO(3)\n    in the Frobenius norm using SVD.\n    \"\"\"\n    U, _, Vt = svd(R_tilde)\n    R_proj = U @ Vt\n    \n    # Ensure the determinant is +1.\n    # The SVD from scipy may yield U, V with det=-1. We must correct R_proj=UVt\n    if np.linalg.det(R_proj) < 0:\n        # Flip the sign of the last column of U\n        U_corr = U.copy()\n        U_corr[:, -1] *= -1\n        R_proj = U_corr @ Vt\n        \n    return R_proj\n\ndef get_geodesic_error(R1, R2):\n    \"\"\"\n    Computes the geodesic distance on SO(3) between two rotation matrices.\n    This is the angle of the relative rotation R1^T @ R2.\n    \"\"\"\n    R_rel = R1.T @ R2\n    # The trace of a rotation matrix is 1 + 2*cos(theta)\n    # where theta is the angle of rotation.\n    # Clip the argument to arccos to handle potential floating point inaccuracies\n    trace_val = np.trace(R_rel)\n    arg = np.clip((trace_val - 1.0) / 2.0, -1.0, 1.0)\n    angle = np.arccos(arg)\n    return angle\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (omega, h)\n        (np.array([0.3, -0.4, 0.5]), 0.1),\n        (np.array([1e-8, -2e-8, 3e-8]), 1.0),\n        (np.array([2.0, 3.0, -1.0]), 0.5),\n        (np.array([10.0, 0.0, 0.0]), np.pi / 10.0),\n    ]\n\n    results = []\n    \n    I = np.identity(3)\n    det_tolerance = 1e-12\n\n    for omega, h in test_cases:\n        # 1. Compute Omega, the approximate R_tilde, and true R\n        Omega = hat(omega)\n        R_tilde = I + h * Omega\n        R_true = exp_so3(h * Omega)\n\n        # 2. Compute pre-projection orthogonality error\n        pre_orth_err = np.linalg.norm((R_tilde.T @ R_tilde) - I, 'fro')\n\n        # 3. Project R_tilde to SO(3)\n        R_proj = project_to_so3(R_tilde)\n\n        # 4. Compute post-projection metrics\n        post_orth_err = np.linalg.norm((R_proj.T @ R_proj) - I, 'fro')\n        geodesic_err = get_geodesic_error(R_proj, R_true)\n        det_is_one = abs(np.linalg.det(R_proj) - 1.0) < det_tolerance\n\n        # Append results for this test case\n        case_results = [\n            pre_orth_err,\n            post_orth_err,\n            geodesic_err,\n            det_is_one\n        ]\n        results.append(case_results)\n\n    # Format the final output string exactly as required, converting booleans to lowercase strings for Python's str()\n    # and ensuring there are no spaces after commas.\n    output_str = \"[\"\n    for i, res_list in enumerate(results):\n        # Convert boolean to lowercase 'true' or 'false'\n        res_list_str = [f\"{v:.15e}\" if isinstance(v, float) else str(v).lower() for v in res_list]\n        output_str += f\"[{','.join(res_list_str)}]\"\n        if i < len(results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n\n    print(output_str)\n\nsolve()\n\n```"
        }
    ]
}