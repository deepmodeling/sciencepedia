{
    "hands_on_practices": [
        {
            "introduction": "理解庞加莱映射最好的方法，莫过于从头开始为一个简单系统构建一个。本练习将以经典的双谐振子系统为例，演示如何确定恒定的返回时间，并推导出庞加莱映射的显式矩阵形式。通过展示高维连续流如何简化为低维离散映射，该练习为后续更复杂的分析奠定了基础。",
            "id": "3760888",
            "problem": "考虑一个四维相空间上的哈密顿系统，其正则坐标为 $(q_1,p_1,q_2,p_2)$，正则辛形式为 $\\omega = dq_1 \\wedge dp_1 + dq_2 \\wedge dp_2$。其哈密顿量是两个解耦谐振子的哈密顿量：\n$$\nH(q_1,p_1,q_2,p_2) = \\frac{p_1^{2}}{2 m_1} + \\frac{1}{2} m_1 \\omega_1^{2} q_1^{2} + \\frac{p_2^{2}}{2 m_2} + \\frac{1}{2} m_2 \\omega_2^{2} q_2^{2},\n$$\n其中 $m_1,m_2 > 0$ 和 $\\omega_1,\\omega_2 > 0$ 是常数。固定一个能量 $E > 0$ 并考虑能量面 $H^{-1}(E)$。定义庞加莱截面 $S$ 为\n$$\nS = \\{ (q_1,p_1,q_2,p_2) \\in H^{-1}(E) \\mid q_1 = 0,\\ p_1 > 0 \\}.\n$$\n\n从哈密顿方程以及庞加莱截面和庞加莱映射的定义出发，完成以下任务：\n\n1. 将截面 $S$ 显式地构造为 $H^{-1}(E)$ 的一个光滑二维子流形，并确定 $S$ 通过限制从环境辛形式 $\\omega$ 继承的约化辛形式。\n\n2. 显式计算庞加莱回归映射 $P : S \\to S$，该映射将 $S$ 上的一个点沿哈密顿流推进到它与 $S$ 的下一个交点。将 $P$ 表示为作用于 $S$ 上坐标 $(q_2,p_2)$ 的线性辛变换。\n\n你的最终答案必须是代表 $P$ 在 $(q_2,p_2)$ 上的 $2 \\times 2$ 矩阵的单一闭式解析表达式，用 $m_2$、$\\omega_2$ 和 $\\omega_1$ 表示。不需要四舍五入，最终表达式中不应包含单位。角度必须以弧度为单位理解。",
            "solution": "该问题是良定的，并在标准哈密顿力学中有坚实的科学基础。所有必要信息均已提供，所求量可通过既定方法推导。因此，该问题是有效的。\n\n正则坐标为 $(q_1, p_1, q_2, p_2)$。两个解耦谐振子系统的哈密顿量由下式给出：\n$$\nH(q_1,p_1,q_2,p_2) = H_1(q_1, p_1) + H_2(q_2, p_2) = \\left(\\frac{p_1^{2}}{2 m_1} + \\frac{1}{2} m_1 \\omega_1^{2} q_1^{2}\\right) + \\left(\\frac{p_2^{2}}{2 m_2} + \\frac{1}{2} m_2 \\omega_2^{2} q_2^{2}\\right)\n$$\n该系统在固定能量 $E > 0$ 的恒定能量面 $H^{-1}(E)$ 上进行考虑。庞加莱截面 $S$ 定义为该能量面上 $q_1 = 0$ 且 $p_1 > 0$ 的子集。\n\n**1. 庞加莱截面 $S$ 的结构及其辛形式**\n\n一个点 $(q_1, p_1, q_2, p_2)$ 属于 $S$ 当且仅当它满足三个条件：\n1. $H(q_1, p_1, q_2, p_2) = E$\n2. $q_1 = 0$\n3. $p_1 > 0$\n\n将 $q_1 = 0$ 代入哈密顿量，能量约束变为：\n$$\n\\frac{p_1^{2}}{2 m_1} + H_2(q_2, p_2) = E\n$$\n由此，我们可以解出 $p_1$：\n$$\np_1^2 = 2 m_1 (E - H_2(q_2, p_2)) \\implies p_1 = \\sqrt{2 m_1 (E - H_2(q_2, p_2))}\n$$\n条件 $p_1 > 0$ 通过取正平方根来满足。$p_1$ 的这个表达式是实数且为正，当且仅当 $E - H_2(q_2, p_2) > 0$。这意味着截面 $S$ 上的坐标 $(q_2, p_2)$ 必须位于由下式定义的开集 $U \\subset \\mathbb{R}^2$ 中：\n$$\nU = \\{ (q_2, p_2) \\in \\mathbb{R}^2 \\mid H_2(q_2, p_2)  E \\} = \\left\\{ (q_2, p_2) \\in \\mathbb{R}^2 \\mid \\frac{p_2^{2}}{2 m_2} + \\frac{1}{2} m_2 \\omega_2^{2} q_2^{2}  E \\right\\}\n$$\n这个集合 $U$ 是 $(q_2, p_2)$ 平面中一个椭圆的内部。\n\n截面 $S$ 可以被描述为 $U$ 上的一个函数图像。具体来说，我们有一个映射 $i: U \\to \\mathbb{R}^4$，由下式给出：\n$$\ni(q_2, p_2) = (0, \\sqrt{2 m_1 (E - H_2(q_2, p_2))}, q_2, p_2)\n$$\n这个映射的像是 $S$。由于 $i$ 是从开集 $U \\subset \\mathbb{R}^2$ 到 $\\mathbb{R}^4$ 的一个光滑映射，且其微分是单射的，因此 $S$ 是一个光滑的二维子流形。\n\n$S$ 上的辛形式，记作 $\\omega_S$，是环境辛形式 $\\omega = dq_1 \\wedge dp_1 + dq_2 \\wedge dp_2$ 在 $S$ 上的限制。这等价于通过包含映射 $i$ 对 $\\omega$ 的拉回。让我们来计算 $i^*\\omega$：\n$$\ni^*\\omega = i^*(dq_1 \\wedge dp_1 + dq_2 \\wedge dp_2) = i^*(dq_1 \\wedge dp_1) + i^*(dq_2 \\wedge dp_2)\n$$\n楔积的拉回是拉回的楔积：\n$$\ni^*\\omega = (i^*dq_1) \\wedge (i^*dp_1) + (i^*dq_2) \\wedge (i^*dp_2)\n$$\n拉回运算与外微分运算可交换，所以有 $i^*df = d(i^*f)$。\n拉回到 $U$ 上的坐标函数是：\n$i^*q_1 = 0$ (一个常函数)\n$i^*p_1 = \\sqrt{2 m_1 (E - H_2(q_2, p_2))}$\n$i^*q_2 = q_2$\n$i^*p_2 = p_2$\n\n拉回的 $q_1$ 的外微分是 $i^*dq_1 = d(i^*q_1) = d(0) = 0$。\n因此，第一项 $(i^*dq_1) \\wedge (i^*dp_1)$ 为零。\n第二项是 $i^*(dq_2 \\wedge dp_2) = (i^*dq_2) \\wedge (i^*dp_2) = d(i^*q_2) \\wedge d(i^*p_2) = dq_2 \\wedge dp_2$。\n所以，在 $S$ 上继承的、用坐标 $(q_2, p_2)$ 表示的辛形式是：\n$$\n\\omega_S = dq_2 \\wedge dp_2\n$$\n\n**2. 庞加莱回归映射 $P$**\n\n庞加莱映射 $P: S \\to S$ 将截面上的一个点沿着哈密顿流的轨迹推进，直到它首次返回该截面。由于哈密顿量是可分离的，流 $\\Phi_t$ 也是可分离的：$\\Phi_t(q_1, p_1, q_2, p_2) = (\\Phi_t^{(1)}(q_1, p_1), \\Phi_t^{(2)}(q_2, p_2))$，其中 $\\Phi_t^{(i)}$ 是第 $i$ 个振子的流。\n\n让我们找到回归时间 $T$。$S$ 上的一个初始点坐标为 $(0, p_{1,0}, q_{2,0}, p_{2,0})$，其中 $p_{1,0} > 0$。我们需要找到最小的时间 $T > 0$，使得流将第一个振子带回到截面条件：$q_1(T) = 0$ 且 $p_1(T) > 0$。\n\n第一个振子的哈密顿方程为：\n$$\n\\dot{q}_1 = \\frac{\\partial H}{\\partial p_1} = \\frac{p_1}{m_1} \\quad ; \\quad \\dot{p}_1 = -\\frac{\\partial H}{\\partial q_1} = -m_1 \\omega_1^2 q_1\n$$\n初始条件为 $(q_1(0), p_1(0)) = (0, p_{1,0})$ 的解是：\n$$\nq_1(t) = \\frac{p_{1,0}}{m_1 \\omega_1} \\sin(\\omega_1 t)\n$$\n$$\np_1(t) = p_{1,0} \\cos(\\omega_1 t)\n$$\n我们寻找最小的 $T > 0$，使得 $q_1(T) = 0$ 且 $p_1(T) > 0$。\n条件 $q_1(T) = 0$ 意味着 $\\frac{p_{1,0}}{m_1 \\omega_1} \\sin(\\omega_1 T) = 0$。由于 $p_{1,0} > 0$，这意味着 $\\sin(\\omega_1 T) = 0$。对于任意整数 $n$，当 $\\omega_1 T = n\\pi$ 时，该式成立。因为我们需要 $T > 0$，所以必须有 $n \\ge 1$。\n\n第二个条件是 $p_1(T) > 0$：\n$$\np_1(T) = p_{1,0} \\cos(\\omega_1 T) = p_{1,0} \\cos(n\\pi) = p_{1,0} (-1)^n > 0\n$$\n由于 $p_{1,0} > 0$，我们需要 $(-1)^n > 0$，这意味着 $n$ 必须是一个偶数。\n最小的正偶数是 $n=2$。因此，首次回归时间 $T$ 由下式给出：\n$$\n\\omega_1 T = 2\\pi \\implies T = \\frac{2\\pi}{\\omega_1}\n$$\n这个回归时间对于截面 $S$ 上的所有点都是恒定的。\n\n庞加莱映射 $P$ 作用于 $S$ 中一点的坐标 $(q_2, p_2)$，使其演化时间 $T$。设初始点为 $(q_{2,0}, p_{2,0})$，映射后的点为 $(q_2', p_2')$。则 $(q_2', p_2') = (q_2(T), p_2(T))$。\n\n第二个振子的哈密顿方程为：\n$$\n\\dot{q}_2 = \\frac{p_2}{m_2} \\quad ; \\quad \\dot{p}_2 = -m_2 \\omega_2^2 q_2\n$$\n通解可以写成初始条件的线性变换：\n$$\n\\begin{pmatrix} q_2(t) \\\\ p_2(t) \\end{pmatrix} = \\begin{pmatrix} \\cos(\\omega_2 t)  \\frac{1}{m_2 \\omega_2} \\sin(\\omega_2 t) \\\\ -m_2 \\omega_2 \\sin(\\omega_2 t)  \\cos(\\omega_2 t) \\end{pmatrix} \\begin{pmatrix} q_2(0) \\\\ p_2(0) \\end{pmatrix}\n$$\n庞加莱映射 $P$ 对应于 $t=T=2\\pi/\\omega_1$ 时的这个变换。因此，$P$ 作用于向量 $(q_2, p_2)^T$ 的矩阵表示为：\n$$\n\\begin{pmatrix} \\cos\\left(\\omega_2 \\frac{2\\pi}{\\omega_1}\\right)  \\frac{1}{m_2 \\omega_2} \\sin\\left(\\omega_2 \\frac{2\\pi}{\\omega_1}\\right) \\\\ -m_2 \\omega_2 \\sin\\left(\\omega_2 \\frac{2\\pi}{\\omega_1}\\right)  \\cos\\left(\\omega_2 \\frac{2\\pi}{\\omega_1}\\right) \\end{pmatrix}\n$$\n这是一个线性辛变换，因为其行列式为 $\\cos^2(\\cdot) + \\sin^2(\\cdot) = 1$。该映射表示在重新标度的坐标中的一个旋转，旋转角为 $2\\pi \\frac{\\omega_2}{\\omega_1}$。截面上的动力学行为取决于两个振子的频率之比。\n最终的矩阵只依赖于 $m_2$、$\\omega_2$ 和 $\\omega_1$，符合题目要求。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\cos\\left(\\frac{2\\pi\\omega_2}{\\omega_1}\\right)  \\frac{1}{m_2 \\omega_2} \\sin\\left(\\frac{2\\pi\\omega_2}{\\omega_1}\\right) \\\\ -m_2 \\omega_2 \\sin\\left(\\frac{2\\pi\\omega_2}{\\omega_1}\\right)  \\cos\\left(\\frac{2\\pi\\omega_2}{\\omega_1}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "拥有了映射之后，我们便可以分析它的性质，其中最关键的就是不动点的稳定性。对于时间周期系统，频闪庞加莱映射的不动点对应于系统的周期轨道。本练习将引导你通过线性化映射并分析其导数的特征值，来判断这些周期轨道是稳定的（椭圆型）还是不稳定的（双曲型），并引入数值方法来完成这一分析，这对于处理无解析解的系统至关重要。",
            "id": "3760835",
            "problem": "考虑一个定义在坐标为 $q$ 和 $p$ 的相平面上的单自由度、时间周期性哈密顿系统。其哈密顿量由下式给出\n$$\nH(q,p,t) = \\frac{1}{2} p^2 + \\frac{1}{2} \\kappa(t) q^2,\n$$\n其中 $t$ 是无量纲时间，$\\kappa(t)$ 是一个分段常数的 $T$ 周期函数，定义为\n$$\n\\kappa(t) = \n\\begin{cases}\n\\omega^2,  0 \\le t \\pmod T  \\alpha T,\\\\\n- \\lambda^2,  \\alpha T \\le t \\pmod T  T,\n\\end{cases}\n$$\n其中参数 $\\omega > 0$，$\\lambda \\geq 0$，$\\alpha \\in (0,1]$ 且 $T > 0$。所有量均为无量纲。\n\n根据哈密顿方程，\n$$\n\\dot{q} = \\frac{\\partial H}{\\partial p} = p, \\qquad \\dot{p} = -\\frac{\\partial H}{\\partial q} = -\\kappa(t) q.\n$$\n频闪 Poincaré 映射 $P_T$ 通过对流在一个周期 $T$ 内积分，将 $(q(0),p(0))$ 映为 $(q(T),p(T))$。Poincaré 映射的不动点 $(q^\\ast,p^\\ast)$ 满足 $P_T(q^\\ast,p^\\ast) = (q^\\ast,p^\\ast)$。对于上述系统，原点 $(q^\\ast,p^\\ast)=(0,0)$ 总是一个不动点。关于轨道 $\\gamma(t)$ 的线性化（变分方程）为\n$$\n\\frac{d}{dt}\\begin{pmatrix}\\delta q \\\\ \\delta p\\end{pmatrix} = A(t) \\begin{pmatrix}\\delta q \\\\ \\delta p\\end{pmatrix}, \\qquad\nA(t) = \\begin{pmatrix}\n0  1\\\\\n- \\kappa(t)  0\n\\end{pmatrix}.\n$$\nPoincaré 映射在某一点的导数，记为 $DP_T(q,p)$，由满足 $M(0)=I$ 的方程 $\\dot{M}(t) = A(t) M(t)$ 的基本矩阵解 $M(t)$ 在 $t=T$ 时的值给出，因此 $DP_T(q,p) = M(T)$。由于对于时间周期性哈密顿系统，$P_T$ 是正则的，因此 $DP_T(q,p)$ 是二维辛矩阵，这意味着 $\\det(DP_T(q,p)) = 1$。对于一个 $2 \\times 2$ 辛矩阵，其特征值要么是单位圆上的共轭复数，要么是互为倒数的实数，要么是重复的单位值；这些情况可以通过迹 $\\operatorname{tr}(DP_T)$ 来区分。\n\n你的任务：\n- 从哈密顿流和变分方程的基本定义出发，为由 $H(q,p,t)$ 定义的系统构建频闪 Poincaré 映射 $P_T$，并推导如何通过基本矩阵 $M(T)$ 计算其导数 $DP_T$。\n- 利用辛性质来论证将不动点分为椭圆、双曲或抛物型的基于迹的分类方法，不得援引任何预先给出的简化公式。\n- 实现一个程序，对于给定的 $(\\omega,\\lambda,\\alpha,T)$，通过积分变分方程以获得原点处的 $M(T)$，计算 $\\operatorname{tr}(M(T))$，并将 $(0,0)$ 处的不动点分类为：\n  - 椭圆型：如果特征值位于单位圆上，\n  - 双曲型：如果特征值为非单位圆上的互为倒数的实数，\n  - 抛物型：如果特征值为重复的单位值（临界情况）。\n  分类必须由从辛性质推导出的迹条件决定。使用数值容差来稳健地区分临界情况。\n\n数值要求：\n- 所有量均为无量纲；不涉及物理单位。\n- 你的程序必须使用数值积分来计算 $M(T)$；不允许使用闭式表达式。\n\n测试组：\n为以下参数集提供计算，这些参数集共同探究了一个标准情况、一个强双曲情况和一个边界情况：\n1. $(\\omega,\\lambda,\\alpha,T) = (1.0,\\,0.0,\\,1.0,\\,\\pi/2)$。\n2. $(\\omega,\\lambda,\\alpha,T) = (1.0,\\,2.0,\\,0.2,\\,1.0)$。\n3. $(\\omega,\\lambda,\\alpha,T) = (1.0,\\,0.0,\\,1.0,\\,2\\pi)$。\n\n答案规格：\n- 对于每个测试用例，返回一个包含两个条目的列表：第一个是迹 $\\operatorname{tr}(DP_T)$，四舍五入到六位小数；第二个是整数分类代码，其中 $1$ 表示椭圆型，$-1$ 表示双曲型， $0$ 表示抛物型。\n- 你的程序应生成单行输出，其中包含所有测试用例的结果，格式为一个由方括号括起来的逗号分隔列表，其中每个元素是对应一个测试用例的列表。例如：`[[trace_1,class_1],[trace_2,class_2],[trace_3,class_3]]`。\n\n设计约束：\n- 推导必须从哈密顿流和变分方程的定义以及正则变换的辛性质出发。在这些基础之外，不要假设或引用专门的“简化”公式。\n- 通过适当的求解器容差确保数值稳定性。\n- 所有三角函数求值均隐式使用弧度，因为所有量都是无量纲的，不需要进行角度单位转换。",
            "solution": "经评估，用户提供的问题是有效的。它在科学上基于哈密顿力学原理和常微分方程理论，问题阐述清晰（well-posed），具有完整且一致的定义和参数集，并以客观的数学语言表达。因此，我们可以着手解决。\n\n核心任务是确定时间周期性哈密顿系统在原点 $(q,p)=(0,0)$ 处不动点的稳定性。这可以通过分析在不动点处求值的频闪 Poincaré 映射导数 $DP_T$ 的特征值来实现。矩阵 $DP_T$ 是该系统变分方程的单值矩阵。\n\n### 1. 单值矩阵的推导\n\n系统由哈密顿量 $H(q,p,t) = \\frac{1}{2} p^2 + \\frac{1}{2} \\kappa(t) q^2$ 描述。系统状态由向量 $\\mathbf{x}(t) = (q(t), p(t))^T$ 给出。哈密顿方程提供了其动力学：\n$$\n\\dot{\\mathbf{x}} = \\begin{pmatrix} \\dot{q} \\\\ \\dot{p} \\end{pmatrix} = \\begin{pmatrix} \\partial H / \\partial p \\\\ -\\partial H / \\partial q \\end{pmatrix} = \\begin{pmatrix} p \\\\ -\\kappa(t) q \\end{pmatrix} = \\mathbf{f}(\\mathbf{x}, t).\n$$\n该方程组是线性的，可以写成 $\\dot{\\mathbf{x}} = A(t)\\mathbf{x}$ 的形式，其中矩阵 $A(t)$ 是\n$$\nA(t) = \\begin{pmatrix} 0  1 \\\\ -\\kappa(t)  0 \\end{pmatrix}.\n$$\n频闪 Poincaré 映射 $P_T$ 将系统状态推进一个周期 $T$，使得 $P_T(\\mathbf{x}_0) = \\mathbf{x}(T)$，其中 $\\mathbf{x}(t)$ 是满足初始条件 $\\mathbf{x}(0) = \\mathbf{x}_0$ 的方程 $\\dot{\\mathbf{x}} = A(t)\\mathbf{x}$ 的解。\n\n为研究轨道 $\\mathbf{x}(t)$ 的稳定性，我们考虑一个无穷小微扰 $\\delta\\mathbf{x}(t)$ 的演化。该微擾的动力学由变分方程决定。令 $\\mathbf{x}'(t) = \\mathbf{x}(t) + \\delta\\mathbf{x}(t)$ 为一条受扰轨道。其演化由 $\\dot{\\mathbf{x}}' = \\mathbf{f}(\\mathbf{x}', t)$ 给出。对 $\\delta\\mathbf{x}$ 展开到一阶：\n$$\n\\frac{d}{dt}(\\mathbf{x} + \\delta\\mathbf{x}) = \\mathbf{f}(\\mathbf{x} + \\delta\\mathbf{x}, t) \\approx \\mathbf{f}(\\mathbf{x}, t) + D_{\\mathbf{x}}\\mathbf{f}(\\mathbf{x}, t) \\delta\\mathbf{x},\n$$\n其中 $D_{\\mathbf{x}}\\mathbf{f}$ 是向量场 $\\mathbf{f}$ 关于状态变量 $\\mathbf{x}$ 的雅可比矩阵。减去原始方程 $\\dot{\\mathbf{x}} = \\mathbf{f}(\\mathbf{x}, t)$，即可得到线性变分方程：\n$$\n\\frac{d}{dt}\\delta\\mathbf{x} = D_{\\mathbf{x}}\\mathbf{f}(\\mathbf{x}, t) \\delta\\mathbf{x}.\n$$\n对于给定系统，向量场为 $\\mathbf{f}(\\mathbf{x}, t) = (p, -\\kappa(t)q)^T$。其关于 $\\mathbf{x}=(q,p)$ 的雅可比矩阵是：\n$$\nD_{\\mathbf{x}}\\mathbf{f} = \\begin{pmatrix} \\partial p / \\partial q  \\partial p / \\partial p \\\\ \\partial(-\\kappa q) / \\partial q  \\partial(-\\kappa q) / \\partial p \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ -\\kappa(t)  0 \\end{pmatrix} = A(t).\n$$\n关键的是，对于这个线性系统，矩阵 $A(t)$ 与状态 $\\mathbf{x}$ 无关。因此，变分方程与原始运动方程相同。\n\n线性系统 $\\dot{\\delta\\mathbf{x}} = A(t)\\delta\\mathbf{x}$ 的解可以用基本矩阵解 $M(t)$ 来表示，它被定义为矩阵微分方程\n$$\n\\dot{M}(t) = A(t) M(t),\n$$\n在初始条件 $M(0) = I$ (其中 $I$ 是 $2 \\times 2$ 单位矩阵)下的解。对于给定的初始微扰 $\\delta\\mathbf{x}_0$，其解为 $\\delta\\mathbf{x}(t) = M(t)\\delta\\mathbf{x}_0$。\n\nPoincaré 映射的导数 $DP_T$ 是一个线性算子，它将初始微扰 $\\delta\\mathbf{x}_0$ 映射到一个周期后的最终微擾 $\\delta\\mathbf{x}(T)$。从关系式 $\\delta\\mathbf{x}(T) = M(T)\\delta\\mathbf{x}_0$ 中，我们直接确定\n$$\nDP_T = M(T).\n$$\n这个矩阵 $M(T)$ 也被称为单值矩阵。\n\n### 2. 基于辛性质的稳定性分类\n\n哈密顿系统生成的流是一种正则变换。因此，Poincaré 映射 $P_T$ 是一个正则映射。其导数 $DP_T = M(T)$ 必须是一个辛矩阵。对于一个 $2 \\times 2$ 矩阵，辛条件等价于其行列式为 1：\n$$\n\\det(M(T)) = 1.\n$$\n不动点的稳定性由单值矩阵 $M(T)$ 的特征值 $\\mu$ 决定。特征值是特征多项式 $\\det(M(T) - \\mu I) = 0$ 的根。对于一个 $2 \\times 2$ 矩阵 $M$，该多项式为：\n$$\n\\mu^2 - \\operatorname{tr}(M)\\mu + \\det(M) = 0.\n$$\n代入辛条件 $\\det(M(T)) = 1$ 并令 $\\tau = \\operatorname{tr}(M(T))$，我们得到特征值的特征方程：\n$$\n\\mu^2 - \\tau\\mu + 1 = 0.\n$$\n这个二次方程的解为\n$$\n\\mu_{1,2} = \\frac{\\tau \\pm \\sqrt{\\tau^2 - 4}}{2}.\n$$\n这些特征值的性质取决于判别式 $\\Delta = \\tau^2 - 4$：\n\n1.  **椭圆情况**：如果 $|\\tau|  2$，那么 $\\tau^2  4$，判别式 $\\Delta$ 为负。特征值为一对共轭复数：\n    $$\n    \\mu_{1,2} = \\frac{\\tau \\pm i\\sqrt{4 - \\tau^2}}{2}.\n    $$\n    这些特征值的模为 $|\\mu|^2 = \\left(\\frac{\\tau}{2}\\right)^2 + \\left(\\frac{\\sqrt{4 - \\tau^2}}{2}\\right)^2 = \\frac{\\tau^2 + 4 - \\tau^2}{4} = 1$。特征值位于复平面的单位圆上。不动点附近的微扰既不指数增长也不衰减，而是在其周围振荡。这表示线性稳定。（分类代码：$1$）\n\n2.  **双曲情况**：如果 $|\\tau| > 2$，那么 $\\tau^2 > 4$，判别式 $\\Delta$ 为正。特征值为互不相等的实数。从特征方程 $\\mu^2 - \\tau\\mu + 1 = 0$ 可知，它们的乘积为 $\\mu_1 \\mu_2 = 1$。因此，特征值是互为倒数的实数，例如 $\\mu_1 > 1$ 和 $\\mu_2 = 1/\\mu_1  1$。存在模大于1的特征值意味着沿着其对应特征向量的微扰会指数增长。该不动点不稳定（是一个鞍点）。（分类代码：$-1$）\n\n3.  **抛物情况**：如果 $|\\tau| = 2$，那么 $\\tau^2 = 4$，判别式 $\\Delta$ 为零。特征值为重根。如果 $\\tau=2$，则 $\\mu_1=\\mu_2=1$。如果 $\\tau=-2$，则 $\\mu_1=\\mu_2=-1$。这是一个介于稳定与不稳定之间的临界情况。矩阵 $M(T)$ 可能可以也可能不可以对角化，导致微扰呈线性或代数增长。（分类代码：$0$）\n\n### 3. 数值实现\n\n为了计算单值矩阵 $M(T)$，我们必须在区间 $t \\in [0, T]$ 上数值求解初值问题 $\\dot{M}(t) = A(t)M(t)$，其中 $M(0)=I$。这个矩阵方程等价于一个关于 $M(t) = \\begin{pmatrix} m_{11}(t)  m_{12}(t) \\\\ m_{21}(t)  m_{22}(t) \\end{pmatrix}$ 各元素的四个耦合一阶线性常微分方程组：\n$$\n\\frac{d}{dt}\\begin{pmatrix} m_{11} \\\\ m_{12} \\\\ m_{21} \\\\ m_{22} \\end{pmatrix} = \\begin{pmatrix} m_{21} \\\\ m_{22} \\\\ -\\kappa(t) m_{11} \\\\ -\\kappa(t) m_{12} \\end{pmatrix}.\n$$\n我们定义一个状态向量 $\\mathbf{y}(t) = [m_{11}(t), m_{12}(t), m_{21}(t), m_{22}(t)]^T$。初始条件是 $\\mathbf{y}(0) = [1, 0, 0, 1]^T$。函数 $\\kappa(t)$ 根据问题陈述分段定义。使用高精度数值求解器 `scipy.integrate.solve_ivp`，并设置严格的误差容差以确保准确性，将此系统从 $t=0$ 积分到 $t=T$。最终的状态向量 $\\mathbf{y}(T)$ 给出了单值矩阵 $M(T)$ 的元素。然后计算迹为 $\\tau = m_{11}(T) + m_{22}(T)$。最后，根据上面推导出的准则，基于 $\\tau$ 的值进行分类，并使用 $10^{-9}$ 的数值容差来稳健地识别抛物情况 $|\\tau|=2$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves for the stability of a fixed point in a time-periodic Hamiltonian system\n    by numerically computing the trace of the monodromy matrix and classifying it.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (omega, lambda, alpha, T)\n        (1.0, 0.0, 1.0, np.pi/2),\n        (1.0, 2.0, 0.2, 1.0),\n        (1.0, 0.0, 1.0, 2*np.pi),\n    ]\n\n    results = []\n    # Tolerance for parabolic classification\n    parabolic_tolerance = 1e-9\n\n    for case in test_cases:\n        omega, lambda_, alpha, T = case\n\n        def create_ode_func(omega, lambda_, alpha, T):\n            \"\"\"\n            Creates the ODE function dy/dt = f(t, y) for the 4 elements of the\n            monodromy matrix, closing over the system parameters.\n            \n            y is a 4-element vector [m11, m12, m21, m22].\n            \"\"\"\n            # Pre-calculate squared parameters for efficiency\n            omega_sq = omega**2\n            lambda_sq = lambda_**2\n            \n            def ode_func(t, y):\n                \"\"\"\n                The system of ODEs for the elements of the fundamental matrix M.\n                dM/dt = A(t) * M, where A(t) = [[0, 1], [-kappa(t), 0]].\n                \"\"\"\n                m11, m12, m21, m22 = y\n                \n                # The integration occurs over [0, T], so t % T is not needed.\n                # The condition is defined as 0 = t mod T  alpha*T.\n                if t  alpha * T:\n                    kappa_val = omega_sq\n                else:\n                    kappa_val = -lambda_sq\n                \n                # Derivatives from the matrix equation:\n                # d/dt [m11, m12] = [m21, m22]\n                # d/dt [m21, m22] = [-kappa*m11, -kappa*m12]\n                dm11_dt = m21\n                dm12_dt = m22\n                dm21_dt = -kappa_val * m11\n                dm22_dt = -kappa_val * m12\n                \n                return [dm11_dt, dm12_dt, dm21_dt, dm22_dt]\n\n            return ode_func\n\n        # Create the specific ODE function for the current case\n        ode_system = create_ode_func(omega, lambda_, alpha, T)\n\n        # Initial condition: M(0) = I\n        y0 = np.array([1.0, 0.0, 0.0, 1.0])\n        \n        # Time span for integration\n        t_span = (0, T)\n\n        # Numerically integrate the ODE system to find M(T)\n        # Use a high-precision solver with tight tolerances\n        sol = solve_ivp(\n            ode_system, \n            t_span, \n            y0, \n            method='DOP853',  # A high-order accurate method\n            rtol=1e-12, \n            atol=1e-12\n        )\n        \n        # The final state vector contains the elements of M(T)\n        m_final = sol.y[:, -1]\n        \n        # The trace of the monodromy matrix M(T) is m11(T) + m22(T)\n        trace_m = m_final[0] + m_final[3]\n\n        # Classify the fixed point based on the trace\n        if np.abs(np.abs(trace_m) - 2.0)  parabolic_tolerance:\n            classification_code = 0  # Parabolic\n        elif np.abs(trace_m)  2.0:\n            classification_code = 1  # Elliptic\n        else: # np.abs(trace_m) > 2.0\n            classification_code = -1 # Hyperbolic\n\n        # Round trace to six decimal places for the output\n        trace_rounded = round(trace_m, 6)\n        \n        results.append([trace_rounded, classification_code])\n\n    # Format the final output string exactly as specified.\n    # e.g., [[trace1,class1],[trace2,class2]]\n    inner_strings = [f\"[{trace},{code}]\" for trace, code in results]\n    output_string = f\"[{','.join(inner_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "最后一个练习将我们的技能推广到自治系统，在这类系统中，周期轨道存在于恒定的能量面上。此时，构造庞加莱映射的导数需要更精细的处理，必须通过投影来考虑返回时间的变化。本练习将处理一个非线性耦合系统，通过数值积分变分方程并执行正确的几何投影，展示了庞加莱映射方法在分析复杂周期运动稳定性方面的全部威力。",
            "id": "3760869",
            "problem": "考虑一个具有两个自由度的自治哈密顿系统，该系统定义在相空间上，坐标为 $(q_1,q_2,p_1,p_2)$，哈密顿量为\n$$\nH(q_1,q_2,p_1,p_2) \\;=\\; \\tfrac{1}{2}\\left(p_1^2 + p_2^2\\right) \\;+\\; \\tfrac{1}{2}\\left(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2\\right) \\;+\\; \\varepsilon\\, q_1^2 q_2^2,\n$$\n其中 $\\omega_1>0$、$\\omega_2>0$ 和 $\\varepsilon \\ge 0$ 是参数。哈密顿向量场由标准的哈密顿方程给出\n$$\n\\dot{q}_i \\;=\\; \\frac{\\partial H}{\\partial p_i}, \\qquad \\dot{p}_i \\;=\\; -\\frac{\\partial H}{\\partial q_i}, \\qquad i\\in\\{1,2\\}.\n$$\n对于任意振幅 $A>0$，由 $q_2=0$ 和 $p_2=0$ 定义的子流形在流下是不变的，且初始条件\n$$\nx^\\ast(0) \\;=\\; \\big(q_1,q_2,p_1,p_2\\big)\\Big|_{t=0} \\;=\\; \\big(0,\\,0,\\,A\\omega_1,\\,0\\big)\n$$\n位于一个周期为 $T = 2\\pi/\\omega_1$ 的周期轨道上。定义庞加莱截面\n$$\n\\Sigma \\;=\\; \\{\\, x \\in \\mathbb{R}^4 \\;|\\; h(x)=0 \\,\\}, \\quad \\text{with } h(x)=q_1,\n$$\n以及穿越条件 $\\dot{q}_1>0$（即在穿越时 $p_1>0$）。因此，$x^\\ast(0)\\in\\Sigma$ 并且是在沿周期轨道经过一个周期后由流诱导的庞加莱映射的一个不动点。\n\n你的任务是，对于每个指定的参数集，计算庞加莱映射在不动点 $x^\\ast(0)$ 处的导数，记为 $DP$，作为切空间 $T_{x^\\ast(0)}\\Sigma$ 上的一个线性映射。你必须通过以下数值方法来完成：\n- 从 $x^\\ast(0)$ 开始，将哈密顿流积分一个周期 $T$。\n- 同时积分相关的变分方程（沿轨迹的流的线性化），以获得满足 $\\Phi(0)=I$ 的基本解矩阵 $\\Phi(T)$。\n- 将得到的线性化映射沿截面穿越处的流方向投影到切空间 $T_{x^\\ast(0)}\\Sigma$ 上，其方式是强制一阶满足截面约束。\n\n你可以假设的基本原理：\n- 哈密顿向量场 $f(x)$ 由 $f(x) = J \\nabla H(x)$ 给出，其中 $J$ 是标准辛矩阵，沿轨迹 $x(t)$ 的变分方程为 $\\dot{\\Phi}(t) = Df\\big(x(t)\\big)\\,\\Phi(t)$，且 $\\Phi(0)=I$。\n- 不动点处的庞加莱映射线性化 $DP$ 是通过将一个周期上的线性化流与一个几何操作复合得到的，该操作通过移除沿流方向的分量并限制在截面切空间上，从而一阶强制满足截面约束。\n\n你必须为组合系统 $(x(t),\\Phi(t))$ 在 $[0,T]$ 上实现一个数值积分器，构造所需的沿截面处流方向到 $T_{x^\\ast(0)}\\Sigma$ 的投影，并提取 $DP$ 在由有序典范坐标方向集 $(q_2,p_1,p_2)$（这些方向在 $x^\\ast(0)$ 处与 $\\Sigma$ 相切）给出的 $T_{x^\\ast(0)}\\Sigma$ 基底中的具体矩阵表示。\n\n对于下面的每个测试用例，计算 $DP$ 的三个特征值并报告它们的模。最终的数值答案是无量纲的。你的程序应计算每个测试用例的特征值模列表，并输出一行，其中包含按指定顺序排列的这些列表的列表。每个模必须四舍五入到小数点后十位。\n\n测试套件（每个元组为 $(\\omega_1,\\omega_2,\\varepsilon,A)$）：\n1. $(1.0,\\,1.5,\\,0.05,\\,0.2)$\n2. $(1.0,\\,1.5,\\,0.0,\\,0.3)$\n3. $(1.0,\\,2.0,\\,0.1,\\,0.1)$\n4. $(1.0,\\,0.8,\\,0.2,\\,0.4)$\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个类 JSON 的嵌套列表字符串形式的结果，每个内部列表对应一个测试用例，并按非递减顺序列出三个特征值的模，每个模都四舍五入到小数点后十位。例如，一个有效的格式是\n`[[m11,m12,m13],[m21,m22,m23],[m31,m32,m33],[m41,m42,m43]]`\n除了所示的空格外，不需要其他空格。",
            "solution": "用户希望我解决一个几何力学和辛方法领域的问题，具体与庞加莱映射有关。\n\n这是我的计划：\n\n1.  **验证问题：** 我需要检查说明中提供的严格验证清单。\n    *   **步骤1：提取已知条件：** 我将逐字列出所有方程、定义和参数。\n    *   **步骤2：验证：** 我将检查问题是否具有科学依据、是否适定、客观和完整。我将查找任何指定的缺陷。\n    *   **步骤3：结论：** 根据验证结果，我将决定是继续解决还是宣布问题无效。\n\n2.  **分解问题（如果有效）：**\n    *   **系统：** 一个具有2个自由度的哈密顿系统。\n        *   哈密顿量：$H = \\frac{1}{2}(p_1^2 + p_2^2) + \\frac{1}{2}(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2) + \\varepsilon q_1^2 q_2^2$。\n        *   相空间坐标：$(q_1, q_2, p_1, p_2)$。\n        *   哈密顿方程：$\\dot{q}_i = \\frac{\\partial H}{\\partial p_i}$，$\\dot{p}_i = -\\frac{\\partial H}{\\partial q_i}$。\n    *   **周期轨道：**\n        *   一个不变子流形由 $q_2=0, p_2=0$ 给出。\n        *   初始条件 $x^\\ast(0) = (0, 0, A\\omega_1, 0)$ 在此子流形上。\n        *   此初始条件导致一个周期为 $T = 2\\pi/\\omega_1$ 的周期轨道。\n    *   **庞加莱截面和映射：**\n        *   截面 $\\Sigma$ 由 $h(x) = q_1 = 0$ 定义。\n        *   穿越条件为 $\\dot{q}_1 > 0$，即 $p_1 > 0$。\n        *   点 $x^\\ast(0)$ 在此截面上，是庞加莱映射的一个不动点。\n    *   **任务：** 计算庞加莱映射在不动点 $x^\\ast(0)$ 处的导数 $DP$。\n    *   **方法：**\n        1.  从 $x^\\ast(0)$ 开始，将状态 $x(t)$ 的哈密顿流积分一个周期 $T = 2\\pi/\\omega_1$。\n        2.  同时，积分变分方程 $\\dot{\\Phi}(t) = Df(x(t)) \\Phi(t)$（其中 $\\Phi(0)=I$），得到基本解矩阵 $\\Phi(T)$。\n        3.  将线性化映射 $\\Phi(T)$ 投影到切空间 $T_{x^\\ast(0)}\\Sigma$ 上，得到 $DP$。\n    *   **表示：**\n        *   最终映射 $DP$ 应表示为 $T_{x^\\ast(0)}\\Sigma$ 基底下的一个矩阵。\n        *   $T_{x^\\ast(0)}\\Sigma$ 的基底由坐标方向 $(q_2, p_1, p_2)$ 给出。\n    *   **输出：** 对每个测试用例，求出 $DP$ 矩阵表示的特征值，并报告它们的模，排序并四舍五入。\n\n3.  **详细数学公式（如果有效）：**\n\n    *   **状态向量：** 令 $x = (q_1, q_2, p_1, p_2)^T$。问题陈述隐含地使用了这个顺序。我们遵循这个顺序。\n    *   **哈密顿向量场：**\n        *   $\\dot{q}_1 = \\frac{\\partial H}{\\partial p_1} = p_1$\n        *   $\\dot{q}_2 = \\frac{\\partial H}{\\partial p_2} = p_2$\n        *   $\\dot{p}_1 = -\\frac{\\partial H}{\\partial q_1} = -(\\omega_1^2 q_1 + 2\\varepsilon q_1 q_2^2) = -q_1(\\omega_1^2 + 2\\varepsilon q_2^2)$\n        *   $\\dot{p}_2 = -\\frac{\\partial H}{\\partial q_2} = -(\\omega_2^2 q_2 + 2\\varepsilon q_1^2 q_2) = -q_2(\\omega_2^2 + 2\\varepsilon q_1^2)$\n        *   向量场为 $f(x) = (\\, p_1, \\, p_2, \\, -q_1(\\omega_1^2 + 2\\varepsilon q_2^2), \\, -q_2(\\omega_2^2 + 2\\varepsilon q_1^2) \\,)^T$。\n\n    *   **周期轨道 $x^\\ast(t)$：**\n        *   初始条件：$x^\\ast(0) = (0, 0, A\\omega_1, 0)$。\n        *   在不变子流形 $q_2=0, p_2=0$ 上，方程简化为：\n            *   $\\dot{q}_1 = p_1$\n            *   $\\dot{p}_1 = -\\omega_1^2 q_1$\n            *   $\\dot{q}_2 = 0$\n            *   $\\dot{p}_2 = 0$\n        *   这是 $(q_1, p_1)$ 对的一个简谐振子。\n        *   对于 $q_1(0)=0$ 和 $p_1(0)=A\\omega_1$，解为：\n            *   $q_1(t) = A \\sin(\\omega_1 t)$\n            *   $p_1(t) = A\\omega_1 \\cos(\\omega_1 t)$\n        *   所以，周期轨道为 $x^\\ast(t) = (A \\sin(\\omega_1 t), \\, 0, \\, A\\omega_1 \\cos(\\omega_1 t), \\, 0)^T$。\n        *   周期确实是 $T = 2\\pi/\\omega_1$。在 $t=T$ 时，我们有 $x^\\ast(T) = (0, 0, A\\omega_1, 0) = x^\\ast(0)$。\n\n    *   **变分方程：** 我们需要向量场的雅可比矩阵 $Df(x)$。\n        *   $f(x) = (f_1, f_2, f_3, f_4)^T = (p_1, p_2, -q_1(\\omega_1^2 + 2\\varepsilon q_2^2), -q_2(\\omega_2^2 + 2\\varepsilon q_1^2))^T$。\n        *   $Df(x) = \\begin{pmatrix}\n              \\frac{\\partial f_1}{\\partial q_1}  \\frac{\\partial f_1}{\\partial q_2}  \\frac{\\partial f_1}{\\partial p_1}  \\frac{\\partial f_1}{\\partial p_2} \\\\\n              \\frac{\\partial f_2}{\\partial q_1}  \\frac{\\partial f_2}{\\partial q_2}  \\frac{\\partial f_2}{\\partial p_1}  \\frac{\\partial f_2}{\\partial p_2} \\\\\n              \\frac{\\partial f_3}{\\partial q_1}  \\frac{\\partial f_3}{\\partial q_2}  \\frac{\\partial f_3}{\\partial p_1}  \\frac{\\partial f_3}{\\partial p_2} \\\\\n              \\frac{\\partial f_4}{\\partial q_1}  \\frac{\\partial f_4}{\\partial q_2}  \\frac{\\partial f_4}{\\partial p_1}  \\frac{\\partial f_4}{\\partial p_2}\n            \\end{pmatrix} = \\begin{pmatrix}\n              0  0  1  0 \\\\\n              0  0  0  1 \\\\\n              -(\\omega_1^2 + 2\\varepsilon q_2^2)  -4\\varepsilon q_1 q_2  0  0 \\\\\n              -4\\varepsilon q_1 q_2  -(\\omega_2^2 + 2\\varepsilon q_1^2)  0  0\n            \\end{pmatrix}$\n    *   **沿轨道的线性化：** 我们需要沿 $x^\\ast(t)$ 计算 $Df$。\n        *   $q_1(t) = A \\sin(\\omega_1 t)$\n        *   $q_2(t) = 0$\n        *   $Df(x^\\ast(t)) = \\begin{pmatrix}\n              0  0  1  0 \\\\\n              0  0  0  1 \\\\\n              -\\omega_1^2  0  0  0 \\\\\n              0  -(\\omega_2^2 + 2\\varepsilon A^2 \\sin^2(\\omega_1 t))  0  0\n            \\end{pmatrix}$\n        *   这就是驱动变分方程 $\\dot{\\Phi}(t) = M(t) \\Phi(t)$ 的矩阵 $M(t) = Df(x^\\ast(t))$。\n\n    *   **数值积分：**\n        *   状态是一个20维向量：4个分量用于 $x(t)$，16个分量用于 $\\Phi(t)$（一个4x4矩阵）。\n        *   要积分的常微分方程组是：\n            *   $\\dot{x} = f(x)$\n            *   $\\dot{\\Phi} = Df(x) \\Phi$\n        *   令 $Y = (x, \\Phi_{11}, ..., \\Phi_{44})^T$ 为组合状态向量。大小为 $4+16=20$。我们也可以将其看作是同时对向量 $x$ 和矩阵 $\\Phi$ 进行积分。\n        *   导数函数 `dY/dt` 将计算 $f(x)$ 和 $Df(x)\\Phi$。\n        *   我们需要一个数值积分器，如 `scipy.integrate.solve_ivp`。问题建议实现一个，但使用库函数是标准做法，也更稳健。我们使用 `solve_ivp` 和高精度方法，如 RK45 或 DOP853。\n        *   初始条件：$x(0) = x^\\ast(0) = (0, 0, A\\omega_1, 0)$ 和 $\\Phi(0) = I_{4 \\times 4}$。\n        *   积分区间：$[0, T]$，其中 $T = 2\\pi/\\omega_1$。\n        *   结果将是 $x(T)$ 和 $\\Phi(T)$。由于积分会有数值误差，$x(T)$ 将接近但不完全等于 $x^\\ast(0)$。我们真正需要的是矩阵 $\\Phi(T)$。\n\n    *   **特殊情况 $\\varepsilon = 0$：**\n        *   当 $\\varepsilon = 0$ 时，系统是两个解耦的谐振子。\n        *   $H = \\frac{1}{2}(p_1^2 + \\omega_1^2 q_1^2) + \\frac{1}{2}(p_2^2 + \\omega_2^2 q_2^2)$。\n        *   雅可比矩阵沿轨道是常数：\n            $Df(x^\\ast(t)) = \\begin{pmatrix}\n              0  0  1  0 \\\\\n              0  0  0  1 \\\\\n              -\\omega_1^2  0  0  0 \\\\\n              0  -\\omega_2^2  0  0\n            \\end{pmatrix} = M_{const}$。\n        *   基本解矩阵是 $\\Phi(T) = e^{M_{const} T}$。\n        *   $M_{const}$ 是块对角的：$M_{const} = \\begin{pmatrix} A_1  0 \\\\ 0  A_2 \\end{pmatrix}$，其中 $A_i = \\begin{pmatrix} 0  1 \\\\ -\\omega_i^2  0 \\end{pmatrix}$。\n        *   所以 $\\Phi(T) = \\begin{pmatrix} e^{A_1 T}  0 \\\\ 0  e^{A_2 T} \\end{pmatrix}$。\n        *   我们来计算 $e^{A_i t}$：$A_i^2 = \\begin{pmatrix} -\\omega_i^2  0 \\\\ 0  -\\omega_i^2 \\end{pmatrix} = -\\omega_i^2 I$。\n        *   $e^{A_i t} = I \\cos(\\omega_i t) + A_i \\frac{1}{\\omega_i} \\sin(\\omega_i t) = \\begin{pmatrix} \\cos(\\omega_i t)  \\frac{1}{\\omega_i}\\sin(\\omega_i t) \\\\ -\\omega_i \\sin(\\omega_i t)  \\cos(\\omega_i t) \\end{pmatrix}$。\n        *   在 $t=T=2\\pi/\\omega_1$ 时：\n            *   $e^{A_1 T} = \\begin{pmatrix} \\cos(2\\pi)  \\frac{1}{\\omega_1}\\sin(2\\pi) \\\\ -\\omega_1 \\sin(2\\pi)  \\cos(2\\pi) \\end{pmatrix} = I_{2 \\times 2}$。\n            *   $e^{A_2 T} = \\begin{pmatrix} \\cos(\\omega_2 T)  \\frac{1}{\\omega_2}\\sin(\\omega_2 T) \\\\ -\\omega_2 \\sin(\\omega_2 T)  \\cos(\\omega_2 T) \\end{pmatrix} = \\begin{pmatrix} \\cos(2\\pi \\frac{\\omega_2}{\\omega_1})  \\frac{1}{\\omega_2}\\sin(2\\pi \\frac{\\omega_2}{\\omega_1}) \\\\ -\\omega_2 \\sin(2\\pi \\frac{\\omega_2}{\\omega_1})  \\cos(2\\pi \\frac{\\omega_2}{\\omega_1}) \\end{pmatrix}$。这是一个旋转矩阵。\n        *   所以对于 $\\varepsilon=0$，在 $(q_1, q_2, p_1, p_2)$ 基底下，$\\Phi(T)$ 是：\n            $\\Phi(T) = \\begin{pmatrix}\n              1  0  0  0 \\\\\n              0  \\cos(\\theta)  0  \\frac{1}{\\omega_2}\\sin(\\theta) \\\\\n              0  0  1  0 \\\\\n              0  -\\omega_2 \\sin(\\theta)  0  \\cos(\\theta)\n            \\end{pmatrix}$，其中 $\\theta = \\omega_2 T = 2\\pi \\frac{\\omega_2}{\\omega_1}$。\n        *   这个解析结果将为测试用例2中的数值积分器提供一个很好的检验。\n\n    *   **投影以获得 $DP$：**\n        *   线性化流将 $x^\\ast(0)$ 处的一个切向量 $\\delta x_0$ 映射到 $x^\\ast(T) = x^\\ast(0)$ 处的 $\\delta x_T = \\Phi(T) \\delta x_0$。\n        *   庞加莱截面是 $\\Sigma = \\{x | q_1=0\\}$。切空间 $T_{x^\\ast(0)}\\Sigma$ 是截面定义函数 $h(x)=q_1$ 的梯度的核。\n        *   $\\nabla h = (1, 0, 0, 0)^T$。所以 $T_{x^\\ast(0)}\\Sigma = \\{ \\delta x | \\langle \\nabla h, \\delta x \\rangle = 0 \\} = \\{ (\\delta q_1, \\delta q_2, \\delta p_1, \\delta p_2) | \\delta q_1 = 0 \\}$。\n        *   这是一个由 $q_2, p_1, p_2$ 的基向量张成的三维空间。\n        *   庞加莱映射 $P$ 将截面 $\\Sigma$ 上的点 $x_0$ 映到下一个交点 $x_1 \\in \\Sigma$。我们想求它的导数 $DP$。\n        *   令 $x_0 = x^\\ast(0) + \\delta x_0$，其中 $\\delta x_0 \\in T_{x^\\ast(0)}\\Sigma$。\n        *   流将其带到 $x(T') \\approx x^\\ast(T') + \\Phi(T') \\delta x_0$，其中 $T'$ 是新的返回时间，接近于 $T$。\n        *   与不动点的偏差为 $\\delta x_1 = x_1 - x^\\ast(0) \\approx \\Phi(T) \\delta x_0 - f(x^\\ast(0)) \\frac{\\langle \\nabla h, \\Phi(T) \\delta x_0 \\rangle}{\\langle \\nabla h, f(x^\\ast(0)) \\rangle}$。\n        *   这是 $DP$ 在 $\\delta x_0$ 上的作用。这个线性映射是 $DP = \\left( I - \\frac{f(x^\\ast(0)) \\otimes \\nabla h}{\\langle \\nabla h, f(x^\\ast(0)) \\rangle} \\right) \\Phi(T)$。\n        *   我们来计算这些向量。\n            *   $x^\\ast(0) = (0, 0, A\\omega_1, 0)$。\n            *   $f(x^\\ast(0)) = (p_1, p_2, ...,)^T|_{x^\\ast(0)} = (A\\omega_1, 0, 0, 0)^T$。\n            *   $\\nabla h = (1, 0, 0, 0)^T$。\n            *   $\\langle \\nabla h, f(x^\\ast(0)) \\rangle = (1,0,0,0) \\cdot (A\\omega_1, 0, 0, 0) = A\\omega_1$。这是 $\\dot{q}_1(0)$，按要求为正。\n            *   投影矩阵 $P_{proj} = I - \\frac{f(x^\\ast(0)) \\otimes \\nabla h^T}{A\\omega_1} = I - \\frac{1}{A\\omega_1} \\begin{pmatrix} A\\omega_1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} = \\begin{pmatrix} 0  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\end{pmatrix}$。\n        *   所以 $DP = P_{proj} \\Phi(T)$。\n        *   我们需要将 $DP$ 表示为在基 $(q_2, p_1, p_2)$ 下作用于 $T_{x^\\ast(0)}\\Sigma$ 上的映射。\n        *   坐标按 $q_1, q_2, p_1, p_2$ 索引为 $1, 2, 3, 4$。基底对应于方向 $e_2, e_3, e_4$。\n        *   $M_{DP}$ 的表示是通过选取 $P_{proj}\\Phi(T)$ 中对应于这些基向量的行和列得到的。\n        *   $M_{DP} = \\begin{pmatrix} \\Phi_{22}  \\Phi_{23}  \\Phi_{24} \\\\ \\Phi_{32}  \\Phi_{33}  \\Phi_{34} \\\\ \\Phi_{42}  \\Phi_{43}  \\Phi_{44} \\end{pmatrix}$。这里利用了 $P_{proj}\\Phi(T)$ 的第一行为零，且第一列不属于基底的事实。\n        *   通过将状态向量重排为 $x=(q_1, p_1, q_2, p_2)$，问题可以显著简化。\n        *   沿轨道的雅可比矩阵 $Df(x^\\ast(t))$ 变为块对角：\n            $$\n            Df(x^\\ast(t)) = \\begin{pmatrix}\n             0  1  0  0 \\\\\n             -\\omega_1^2  0  0  0 \\\\\n             0  0  0  1 \\\\\n             0  0  -(\\omega_2^2 + 2\\varepsilon A^2 \\sin^2(\\omega_1 t))  0\n            \\end{pmatrix} = \\begin{pmatrix} M_1  0 \\\\ 0  M_2(t) \\end{pmatrix}\n            $$\n        *   基本解矩阵 $\\Phi(T)$ 也是块对角的：$\\Phi(T) = \\begin{pmatrix} \\Phi_1(T)  0 \\\\ 0  \\Phi_2(T) \\end{pmatrix}$。\n        *   $\\Phi_1(T) = \\exp(M_1 T)$，其中 $T=2\\pi/\\omega_1$。其值为 $2\\times2$ 的单位矩阵 $I_2$。\n        *   $\\Phi_2(T)$ 是 $\\dot{\\Phi}_2 = M_2(t)\\Phi_2$ 在 $t=T$ 时的解，其中 $\\Phi_2(0)=I_2$。\n        *   截面为 $q_1=0$。在新坐标系下，$\\nabla h = (1, 0, 0, 0)^T$。流向量为 $f(x^\\ast(0))=(A\\omega_1, 0, 0, 0)^T$。投影相同。\n        *   在此坐标顺序下，切空间的基底现在是 $(p_1, q_2, p_2)$。我们使用问题指定的基底顺序 $(q_2, p_1, p_2)$。此基底下的向量 $(v_1, v_2, v_3)$ 对应于 $\\delta x_0 = (0, v_2, v_1, v_3)^T$。\n        *   $DP$ 的矩阵表示被发现为 $M_{DP} = \\begin{pmatrix} \\Phi_{2,11}  0  \\Phi_{2,12} \\\\ 0  1  0 \\\\ \\Phi_{2,21}  0  \\Phi_{2,22} \\end{pmatrix}$，其中 $\\Phi_2(T) = \\begin{pmatrix} \\Phi_{2,11}  \\Phi_{2,12} \\\\ \\Phi_{2,21}  \\Phi_{2,22} \\end{pmatrix}$。\n        *   $M_{DP}$ 的特征值为 $1$ 和 $\\Phi_2(T)$ 的两个特征值。\n        *   任务简化为通过积分线性非自治系统 $\\ddot{y} + g(t)y = 0$ 一个周期 $T=2\\pi/\\omega_1$ 来数值计算 $\\Phi_2(T)$，其中 $g(t) = \\omega_2^2 + 2\\varepsilon A^2 \\sin^2(\\omega_1 t)$，并求其单值矩阵 $\\Phi_2(T)$ 的特征值。\n        *   由于 $(q_2, p_2)$ 的横向系统是哈密顿系统，映射 $\\Phi_2(T)$ 必须是辛的。对于一个 $2\\times 2$ 矩阵，这意味着其行列式为 $1$。其特征值的乘积为 $1$。这为数值结果提供了一个检验。\n\n### 数值步骤总结：\n1.  对每个测试用例 $(\\omega_1, \\omega_2, \\varepsilon, A)$，设置周期 $T = 2\\pi/\\omega_1$。\n2.  定义 $2\\times2$ 矩阵 $\\Phi_2(t)$ 四个分量的一阶常微分方程组：\n    $$\n    \\frac{d}{dt} \\begin{pmatrix} a(t)  b(t) \\\\ c(t)  d(t) \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ -g(t)  0 \\end{pmatrix} \\begin{pmatrix} a(t)  b(t) \\\\ c(t)  d(t) \\end{pmatrix}, \\quad \\text{with } g(t) = \\omega_2^2 + 2\\varepsilon A^2 \\sin^2(\\omega_1 t).\n    $$\n    这等价于 $\\dot{a}=c, \\dot{b}=d, \\dot{c}=-g(t)a, \\dot{d}=-g(t)b$。\n3.  设置初始条件 $\\Phi_2(0) = I_2$，即 $(a,b,c,d) = (1,0,0,1)$。\n4.  在区间 $[0, T]$ 上数值积分此系统，求得 $\\Phi_2(T)$。\n5.  映射 $DP$ 的三个特征值为 $\\{1, \\lambda_1, \\lambda_2 \\}$，其中 $\\lambda_{1,2}$ 是 $\\Phi_2(T)$ 的特征值。\n6.  计算这三个特征值的模并进行排序。\n\n对于特殊情况 $\\varepsilon=0$，$g(t)=\\omega_2^2$ 是常数。矩阵 $\\Phi_2(T)$ 可以解析计算为\n$$\n\\Phi_2(T) = \\begin{pmatrix} \\cos(\\omega_2 T)  \\frac{1}{\\omega_2}\\sin(\\omega_2 T) \\\\ -\\omega_2 \\sin(\\omega_2 T)  \\cos(\\omega_2 T) \\end{pmatrix}.\n$$\n其特征值为 $e^{\\pm i \\omega_2 T}$，模均为 $1$。因此，对于 $\\varepsilon=0$，三个特征值的模都为 $1$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes the magnitudes of eigenvalues of the linearized Poincaré map\n    for a given Hamiltonian system for several parameter sets.\n    \"\"\"\n\n    # Test suite: each tuple is (omega1, omega2, epsilon, A)\n    test_cases = [\n        (1.0, 1.5, 0.05, 0.2),\n        (1.0, 1.5, 0.0, 0.3),\n        (1.0, 2.0, 0.1, 0.1),\n        (1.0, 0.8, 0.2, 0.4),\n    ]\n\n    all_results = []\n\n    for params in test_cases:\n        w1, w2, eps, A = params\n\n        # The period of the reference orbit.\n        T = 2 * np.pi / w1\n\n        # Case epsilon = 0 is analytically solvable. The system decouples into\n        # two linear harmonic oscillators. The linearized Poincare map has\n        # eigenvalues with magnitude 1. This serves as a sanity check.\n        if eps == 0.0:\n            magnitudes = [1.0, 1.0, 1.0]\n            all_results.append(magnitudes)\n            continue\n\n        # The ODE for the transverse variational dynamics Phi_2(t) corresponds to\n        # the second-order scalar equation:\n        # d^2(q2)/dt^2 + g(t)*q2 = 0\n        # where g(t) = w2^2 + 2*eps*A^2*sin^2(w1*t).\n        # We integrate the 4 components of the 2x2 matrix Phi_2.\n        # Let y = [a, b, c, d] where Phi_2 = [[a, b], [c, d]].\n        # The ODE system is:\n        # da/dt = c\n        # db/dt = d\n        # dc/dt = -g(t)*a\n        # dd/dt = -g(t)*b\n        \n        g_t_factor = 2 * eps * A**2\n        w2_sq = w2**2\n        \n        def ode_rhs(t, y):\n            a, b, c, d = y\n            g_t = w2_sq + g_t_factor * (np.sin(w1 * t))**2\n            dydt = [c, d, -g_t * a, -g_t * b]\n            return dydt\n\n        # Initial condition for Phi_2 is the identity matrix.\n        y0 = [1.0, 0.0, 0.0, 1.0]\n        \n        # Integrate the ODE system over one period T.\n        # Use a high-precision solver to get accurate results.\n        sol = solve_ivp(\n            ode_rhs,\n            [0, T],\n            y0,\n            method='DOP853',\n            t_eval=[T],\n            rtol=1e-13,\n            atol=1e-13\n        )\n        \n        # The solution at t=T gives the components of the monodromy matrix Phi_2(T).\n        phi2_T_flat = sol.y[:, -1]\n        phi2_T = phi2_T_flat.reshape((2, 2))\n\n        # The eigenvalues of the derivative of the Poincare map DP are 1 and\n        # the two eigenvalues of phi2_T.\n        eigvals_phi2 = np.linalg.eigvals(phi2_T)\n        \n        # The full set of eigenvalue magnitudes for DP.\n        magnitudes = sorted([1.0, np.abs(eigvals_phi2[0]), np.abs(eigvals_phi2[1])])\n        \n        all_results.append(magnitudes)\n\n    # Format the output as specified in the problem statement.\n    # Each magnitude is rounded to 10 decimal places.\n    result_strings = []\n    for res in all_results:\n        # Format each number and create the inner list string.\n        inner_str = f'[{\",\".join([f\"{val:.10f}\" for val in res])}]'\n        result_strings.append(inner_str)\n    \n    # Create the final outer list string.\n    final_output = f\"[{', '.join(result_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}