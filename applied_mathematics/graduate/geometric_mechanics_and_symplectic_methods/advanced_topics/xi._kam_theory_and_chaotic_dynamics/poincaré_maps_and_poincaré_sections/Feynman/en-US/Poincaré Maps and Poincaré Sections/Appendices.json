{
    "hands_on_practices": [
        {
            "introduction": "The most direct way to grasp the power of a Poincaré map is to construct one from first principles. This exercise guides you through the analytical construction of a Poincaré map for a simple, integrable system: two uncoupled harmonic oscillators . By explicitly calculating the return time to a section defined on one oscillator and tracking the evolution of the other, you will see how a four-dimensional continuous flow reduces to a two-dimensional discrete map, revealing the fundamental rotational dynamics governed by the system's frequency ratio.",
            "id": "3760888",
            "problem": "Consider the Hamiltonian system on the four-dimensional phase space with canonical coordinates $(q_1,p_1,q_2,p_2)$ and canonical symplectic form $\\omega = dq_1 \\wedge dp_1 + dq_2 \\wedge dp_2$. The Hamiltonian is that of two uncoupled harmonic oscillators:\n$$\nH(q_1,p_1,q_2,p_2) = \\frac{p_1^{2}}{2 m_1} + \\frac{1}{2} m_1 \\omega_1^{2} q_1^{2} + \\frac{p_2^{2}}{2 m_2} + \\frac{1}{2} m_2 \\omega_2^{2} q_2^{2},\n$$\nwhere $m_1, m_2 > 0$ and $\\omega_1, \\omega_2 > 0$ are constants. Fix an energy $E > 0$ and consider the energy level $H^{-1}(E)$. Define the Poincaré section $S$ by\n$$\nS = \\{ (q_1,p_1,q_2,p_2) \\in H^{-1}(E) \\mid q_1 = 0,\\ p_1 > 0 \\}.\n$$\n\nStarting from Hamilton's equations and the definition of a Poincaré section and Poincaré map, do the following:\n\n1. Construct the section $S$ explicitly as a smooth two-dimensional submanifold of $H^{-1}(E)$, and determine the reduced symplectic form inherited on $S$ from the ambient symplectic form $\\omega$ by restriction.\n\n2. Compute explicitly the Poincaré return map $P : S \\to S$ that advances a point on $S$ to its next intersection with $S$ under the Hamiltonian flow. Express $P$ as a linear symplectic transformation acting on the coordinates $(q_2,p_2)$ on $S$.\n\nYour final answer must be a single closed-form analytic expression for the $2 \\times 2$ matrix representing $P$ on $(q_2,p_2)$ in terms of $m_2$, $\\omega_2$, and $\\omega_1$. No rounding is required and no units should be included in the final expression. Angles must be understood in radians.",
            "solution": "The problem is well-posed and scientifically grounded in standard Hamiltonian mechanics. All necessary information is provided, and the requested quantities can be derived through established methods. The problem is therefore valid.\n\nThe canonical coordinates are $(q_1, p_1, q_2, p_2)$. The Hamiltonian for the system of two uncoupled harmonic oscillators is given by:\n$$\nH(q_1,p_1,q_2,p_2) = H_1(q_1, p_1) + H_2(q_2, p_2) = \\left(\\frac{p_1^{2}}{2 m_1} + \\frac{1}{2} m_1 \\omega_1^{2} q_1^{2}\\right) + \\left(\\frac{p_2^{2}}{2 m_2} + \\frac{1}{2} m_2 \\omega_2^{2} q_2^{2}\\right)\n$$\nThe system is considered on a constant energy surface $H^{-1}(E)$ for a fixed energy $E > 0$. The Poincaré section $S$ is defined as the subset of this energy surface where $q_1 = 0$ and $p_1 > 0$.\n\n**1. Structure of the Poincaré Section $S$ and its Symplectic Form**\n\nA point $(q_1, p_1, q_2, p_2)$ is in $S$ if it satisfies three conditions:\n1. $H(q_1, p_1, q_2, p_2) = E$\n2. $q_1 = 0$\n3. $p_1 > 0$\n\nSubstituting $q_1 = 0$ into the Hamiltonian, the energy constraint becomes:\n$$\n\\frac{p_1^{2}}{2 m_1} + H_2(q_2, p_2) = E\n$$\nFrom this, we can solve for $p_1$:\n$$\np_1^2 = 2 m_1 (E - H_2(q_2, p_2)) \\implies p_1 = \\sqrt{2 m_1 (E - H_2(q_2, p_2))}\n$$\nThe condition $p_1 > 0$ is satisfied by taking the positive square root. This expression for $p_1$ is real and positive if and only if $E - H_2(q_2, p_2) > 0$. This means that the coordinates $(q_2, p_2)$ on the section $S$ must lie in the open set $U \\subset \\mathbb{R}^2$ defined by:\n$$\nU = \\{ (q_2, p_2) \\in \\mathbb{R}^2 \\mid H_2(q_2, p_2)  E \\} = \\left\\{ (q_2, p_2) \\in \\mathbb{R}^2 \\mid \\frac{p_2^{2}}{2 m_2} + \\frac{1}{2} m_2 \\omega_2^{2} q_2^{2}  E \\right\\}\n$$\nThis set $U$ is the interior of an ellipse in the $(q_2, p_2)$-plane.\n\nThe section $S$ can be described as the graph of a function over $U$. Specifically, we have a map $i: U \\to \\mathbb{R}^4$ given by:\n$$\ni(q_2, p_2) = (0, \\sqrt{2 m_1 (E - H_2(q_2, p_2))}, q_2, p_2)\n$$\nThe image of this map is $S$. Since $i$ is a smooth map from an open set $U \\subset \\mathbb{R}^2$ into $\\mathbb{R}^4$, and its differential is injective, $S$ is a smooth two-dimensional submanifold.\n\nThe symplectic form on $S$, denoted $\\omega_S$, is the restriction of the ambient symplectic form $\\omega = dq_1 \\wedge dp_1 + dq_2 \\wedge dp_2$ to $S$. This is equivalent to the pullback of $\\omega$ by the inclusion map $i$. Let's compute $i^*\\omega$:\n$$\ni^*\\omega = i^*(dq_1 \\wedge dp_1 + dq_2 \\wedge dp_2) = i^*(dq_1 \\wedge dp_1) + i^*(dq_2 \\wedge dp_2)\n$$\nThe pullback of a wedge product is the wedge product of the pullbacks:\n$$\ni^*\\omega = (i^*dq_1) \\wedge (i^*dp_1) + (i^*dq_2) \\wedge (i^*dp_2)\n$$\nThe pullback commutes with the exterior derivative, so $i^*df = d(i^*f)$.\nThe coordinate functions pulled back to $U$ are:\n$i^*q_1 = 0$ (a constant function)\n$i^*p_1 = \\sqrt{2 m_1 (E - H_2(q_2, p_2))}$\n$i^*q_2 = q_2$\n$i^*p_2 = p_2$\n\nThe exterior derivative of the pulled-back $q_1$ is $i^*dq_1 = d(i^*q_1) = d(0) = 0$.\nTherefore, the first term $(i^*dq_1) \\wedge (i^*dp_1)$ vanishes.\nThe second term is $i^*(dq_2 \\wedge dp_2) = (i^*dq_2) \\wedge (i^*dp_2) = d(i^*q_2) \\wedge d(i^*p_2) = dq_2 \\wedge dp_2$.\nSo, the inherited symplectic form on $S$, expressed in the coordinates $(q_2, p_2)$, is:\n$$\n\\omega_S = dq_2 \\wedge dp_2\n$$\n\n**2. The Poincaré Return Map $P$**\n\nThe Poincaré map $P: S \\to S$ advances a point on the section along the trajectory of the Hamiltonian flow until it first returns to the section. Since the Hamiltonian is separable, the flow $\\Phi_t$ also separates: $\\Phi_t(q_1, p_1, q_2, p_2) = (\\Phi_t^{(1)}(q_1, p_1), \\Phi_t^{(2)}(q_2, p_2))$, where $\\Phi_t^{(i)}$ is the flow of the $i$-th oscillator.\n\nLet's find the return time $T$. An initial point on $S$ has coordinates $(0, p_{1,0}, q_{2,0}, p_{2,0})$ with $p_{1,0} > 0$. We need to find the smallest time $T > 0$ such that the flow brings the first oscillator back to the sectional condition: $q_1(T) = 0$ and $p_1(T) > 0$.\n\nHamilton's equations for the first oscillator are:\n$$\n\\dot{q}_1 = \\frac{\\partial H}{\\partial p_1} = \\frac{p_1}{m_1} \\quad ; \\quad \\dot{p}_1 = -\\frac{\\partial H}{\\partial q_1} = -m_1 \\omega_1^2 q_1\n$$\nThe solution with initial conditions $(q_1(0), p_1(0)) = (0, p_{1,0})$ is:\n$$\nq_1(t) = \\frac{p_{1,0}}{m_1 \\omega_1} \\sin(\\omega_1 t)\n$$\n$$\np_1(t) = p_{1,0} \\cos(\\omega_1 t)\n$$\nWe seek the smallest $T > 0$ such that $q_1(T) = 0$ and $p_1(T) > 0$.\nThe condition $q_1(T) = 0$ implies $\\frac{p_{1,0}}{m_1 \\omega_1} \\sin(\\omega_1 T) = 0$. Since $p_{1,0} > 0$, this means $\\sin(\\omega_1 T) = 0$. This holds for $\\omega_1 T = n\\pi$ for any integer $n$. Since we need $T > 0$, we must have $n \\ge 1$.\n\nThe second condition is $p_1(T) > 0$:\n$$\np_1(T) = p_{1,0} \\cos(\\omega_1 T) = p_{1,0} \\cos(n\\pi) = p_{1,0} (-1)^n > 0\n$$\nSince $p_{1,0} > 0$, we require $(-1)^n > 0$, which means $n$ must be an even integer.\nThe smallest positive even integer is $n=2$. Thus, the first return time $T$ is given by:\n$$\n\\omega_1 T = 2\\pi \\implies T = \\frac{2\\pi}{\\omega_1}\n$$\nThis return time is constant for all points on the section $S$.\n\nThe Poincaré map $P$ acts on the coordinates $(q_2, p_2)$ of a point in $S$ by evolving them for time $T$. Let the initial point be $(q_{2,0}, p_{2,0})$ and the mapped point be $(q_2', p_2')$. Then $(q_2', p_2') = (q_2(T), p_2(T))$.\n\nHamilton's equations for the second oscillator are:\n$$\n\\dot{q}_2 = \\frac{p_2}{m_2} \\quad ; \\quad \\dot{p}_2 = -m_2 \\omega_2^2 q_2\n$$\nThe general solution can be written as a linear transformation of the initial conditions:\n$$\n\\begin{pmatrix} q_2(t) \\\\ p_2(t) \\end{pmatrix} = \\begin{pmatrix} \\cos(\\omega_2 t)  \\frac{1}{m_2 \\omega_2} \\sin(\\omega_2 t) \\\\ -m_2 \\omega_2 \\sin(\\omega_2 t)  \\cos(\\omega_2 t) \\end{pmatrix} \\begin{pmatrix} q_2(0) \\\\ p_2(0) \\end{pmatrix}\n$$\nThe Poincaré map $P$ corresponds to this transformation with $t=T=2\\pi/\\omega_1$. The matrix representation of $P$ acting on the vector $(q_2, p_2)^T$ is therefore:\n$$\n\\begin{pmatrix} \\cos\\left(\\omega_2 \\frac{2\\pi}{\\omega_1}\\right)  \\frac{1}{m_2 \\omega_2} \\sin\\left(\\omega_2 \\frac{2\\pi}{\\omega_1}\\right) \\\\ -m_2 \\omega_2 \\sin\\left(\\omega_2 \\frac{2\\pi}{\\omega_1}\\right)  \\cos\\left(\\omega_2 \\frac{2\\pi}{\\omega_1}\\right) \\end{pmatrix}\n$$\nThis is a linear symplectic transformation, as its determinant is $\\cos^2(\\cdot) + \\sin^2(\\cdot) = 1$. The map represents a rotation in rescaled coordinates, with the angle of rotation being $2\\pi \\frac{\\omega_2}{\\omega_1}$. The dynamics on the section depend on the ratio of the frequencies of the two oscillators.\nThe final matrix depends only on $m_2$, $\\omega_2$, and $\\omega_1$, as requested.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\cos\\left(\\frac{2\\pi\\omega_2}{\\omega_1}\\right)  \\frac{1}{m_2 \\omega_2} \\sin\\left(\\frac{2\\pi\\omega_2}{\\omega_1}\\right) \\\\ -m_2 \\omega_2 \\sin\\left(\\frac{2\\pi\\omega_2}{\\omega_1}\\right)  \\cos\\left(\\frac{2\\pi\\omega_2}{\\omega_1}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While analytical maps are insightful, most systems of interest are not integrable. This practice introduces the essential numerical methods for analyzing the stability of fixed points, focusing on stroboscopic maps for time-periodic systems . You will implement a numerical solver for the variational equations to compute the monodromy matrix, the linearization of the map, and then use its trace to classify the fixed point as elliptic, hyperbolic, or parabolic—a powerful classification that follows directly from the map's underlying symplectic geometry.",
            "id": "3760835",
            "problem": "Consider a one-degree-of-freedom, time-periodic Hamiltonian system defined on the phase plane with coordinates $q$ and $p$. The Hamiltonian is given by\n$$\nH(q,p,t) = \\frac{1}{2} p^2 + \\frac{1}{2} \\kappa(t) q^2,\n$$\nwhere $t$ is dimensionless time and $\\kappa(t)$ is a piecewise constant, $T$-periodic function defined by\n$$\n\\kappa(t) = \n\\begin{cases}\n\\omega^2,  0 \\leq t \\bmod T  \\alpha T,\\\\\n- \\lambda^2,  \\alpha T \\leq t \\bmod T  T,\n\\end{cases}\n$$\nwith parameters $\\omega > 0$, $\\lambda \\geq 0$, $\\alpha \\in (0,1]$, and $T > 0$. All quantities are dimensionless.\n\nBy Hamilton's equations,\n$$\n\\dot{q} = \\frac{\\partial H}{\\partial p} = p, \\qquad \\dot{p} = -\\frac{\\partial H}{\\partial q} = -\\kappa(t) q.\n$$\nThe stroboscopic Poincaré map $P_T$ sends $(q(0),p(0))$ to $(q(T),p(T))$ by integrating the flow over one period $T$. A fixed point $(q^\\ast,p^\\ast)$ of the Poincaré map satisfies $P_T(q^\\ast,p^\\ast) = (q^\\ast,p^\\ast)$. For the system above, the origin $(q^\\ast,p^\\ast)=(0,0)$ is always a fixed point. The linearization (variational equations) about a trajectory $\\gamma(t)$ are\n$$\n\\frac{d}{dt}\\begin{pmatrix}\\delta q \\\\ \\delta p\\end{pmatrix} = A(t) \\begin{pmatrix}\\delta q \\\\ \\delta p\\end{pmatrix}, \\qquad\nA(t) = \\begin{pmatrix}\n0  1\\\\\n- \\kappa(t)  0\n\\end{pmatrix}.\n$$\nThe derivative of the Poincaré map at a point, denoted $DP_T(q,p)$, is given by the fundamental matrix solution $M(t)$ of $\\dot{M}(t) = A(t) M(t)$ with $M(0)=I$, evaluated at $t=T$, so that $DP_T(q,p) = M(T)$. Since $P_T$ is canonical for a time-periodic Hamiltonian, $DP_T(q,p)$ is symplectic in two dimensions, which implies $\\det(DP_T(q,p)) = 1$. For a $2 \\times 2$ symplectic matrix, the eigenvalues are either complex conjugates on the unit circle, real reciprocals, or repeated unity; these cases are distinguished by the trace $\\operatorname{tr}(DP_T)$.\n\nYour tasks:\n- Starting from the fundamental definitions of Hamiltonian flow and variational equations, construct the stroboscopic Poincaré map $P_T$ for the system defined by $H(q,p,t)$ and derive how to compute the derivative $DP_T$ via the fundamental matrix $M(T)$.\n- Use the symplectic property to justify the trace-based classification of fixed points into elliptic, hyperbolic, or parabolic, without invoking any pre-stated shortcut formulas.\n- Implement a program that, for given $(\\omega,\\lambda,\\alpha,T)$, integrates the variational equations to obtain $M(T)$ at the origin, computes $\\operatorname{tr}(M(T))$, and classifies the fixed point at $(0,0)$ as:\n  - Elliptic if the eigenvalues lie on the unit circle,\n  - Hyperbolic if the eigenvalues are real reciprocal off the unit circle,\n  - Parabolic if the eigenvalues are repeated unity (borderline case).\n  The classification must be decided by the trace condition derived from the symplectic property. Use a numerical tolerance to distinguish the borderline case robustly.\n\nNumerical requirements:\n- All quantities are dimensionless; no physical units are involved.\n- Your program must use numerical integration to compute $M(T)$; closed-form expressions are not permitted.\n\nTest suite:\nProvide computations for the following parameter sets, which together probe a standard case, a strongly hyperbolic case, and a boundary case:\n1. $(\\omega,\\lambda,\\alpha,T) = (1.0,\\,0.0,\\,1.0,\\,\\pi/2)$.\n2. $(\\omega,\\lambda,\\alpha,T) = (1.0,\\,2.0,\\,0.2,\\,1.0)$.\n3. $(\\omega,\\lambda,\\alpha,T) = (1.0,\\,0.0,\\,1.0,\\,2\\pi)$.\n\nAnswer specification:\n- For each test case, return a list with two entries: the first is the trace $\\operatorname{tr}(DP_T)$ rounded to six decimal places, and the second is an integer classification code, where $1$ denotes elliptic, $-1$ denotes hyperbolic, and $0$ denotes parabolic.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each element is the list for one test case. For example: $[[\\text{trace}_1,\\text{class}_1],[\\text{trace}_2,\\text{class}_2],[\\text{trace}_3,\\text{class}_3]]$.\n\nDesign constraints:\n- The derivation must start from the definitions of Hamiltonian flow and variational equations, and from the symplectic property of canonical transformations. Do not assume or cite specialized \"shortcut\" formulas beyond these foundations.\n- Ensure numerical stability by appropriate solver tolerances.\n- Use radians for all trigonometric evaluations implicitly, as all quantities are dimensionless and no angle unit conversion is necessary.",
            "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in the principles of Hamiltonian mechanics and the theory of ordinary differential equations, well-posed with a complete and consistent set of definitions and parameters, and expressed in objective mathematical language. We may therefore proceed with the solution.\n\nThe core task is to determine the stability of the fixed point at the origin $(q,p)=(0,0)$ for a time-periodic Hamiltonian system. This is achieved by analyzing the eigenvalues of the derivative of the stroboscopic Poincaré map, $DP_T$, evaluated at the fixed point. The matrix $DP_T$ is the monodromy matrix of the system's variational equations.\n\n### 1. Derivation of the Monodromy Matrix\n\nThe system is described by the Hamiltonian $H(q,p,t) = \\frac{1}{2} p^2 + \\frac{1}{2} \\kappa(t) q^2$. The state of the system is given by the vector $\\mathbf{x}(t) = (q(t), p(t))^T$. Hamilton's equations provide the dynamics:\n$$\n\\dot{\\mathbf{x}} = \\begin{pmatrix} \\dot{q} \\\\ \\dot{p} \\end{pmatrix} = \\begin{pmatrix} \\partial H / \\partial p \\\\ -\\partial H / \\partial q \\end{pmatrix} = \\begin{pmatrix} p \\\\ -\\kappa(t) q \\end{pmatrix} = \\mathbf{f}(\\mathbf{x}, t).\n$$\nThis system of equations is linear and can be written as $\\dot{\\mathbf{x}} = A(t)\\mathbf{x}$, where the matrix $A(t)$ is\n$$\nA(t) = \\begin{pmatrix} 0  1 \\\\ -\\kappa(t)  0 \\end{pmatrix}.\n$$\nThe stroboscopic Poincaré map $P_T$ advances the state of the system by one period $T$, such that $P_T(\\mathbf{x}_0) = \\mathbf{x}(T)$, where $\\mathbf{x}(t)$ is the solution to $\\dot{\\mathbf{x}} = A(t)\\mathbf{x}$ with initial condition $\\mathbf{x}(0) = \\mathbf{x}_0$.\n\nTo study the stability of a trajectory $\\mathbf{x}(t)$, we consider the evolution of an infinitesimal perturbation $\\delta\\mathbf{x}(t)$. The dynamics of this perturbation are governed by the variational equations. Let $\\mathbf{x}'(t) = \\mathbf{x}(t) + \\delta\\mathbf{x}(t)$ be a perturbed trajectory. Its evolution is given by $\\dot{\\mathbf{x}}' = \\mathbf{f}(\\mathbf{x}', t)$. Expanding to first order in $\\delta\\mathbf{x}$:\n$$\n\\frac{d}{dt}(\\mathbf{x} + \\delta\\mathbf{x}) = \\mathbf{f}(\\mathbf{x} + \\delta\\mathbf{x}, t) \\approx \\mathbf{f}(\\mathbf{x}, t) + D_{\\mathbf{x}}\\mathbf{f}(\\mathbf{x}, t) \\delta\\mathbf{x},\n$$\nwhere $D_{\\mathbf{x}}\\mathbf{f}$ is the Jacobian matrix of the vector field $\\mathbf{f}$ with respect to the state variables $\\mathbf{x}$. Subtracting the original equation $\\dot{\\mathbf{x}} = \\mathbf{f}(\\mathbf{x}, t)$ yields the linear variational equation:\n$$\n\\frac{d}{dt}\\delta\\mathbf{x} = D_{\\mathbf{x}}\\mathbf{f}(\\mathbf{x}, t) \\delta\\mathbf{x}.\n$$\nFor the given system, the vector field is $\\mathbf{f}(\\mathbf{x}, t) = (p, -\\kappa(t)q)^T$. Its Jacobian with respect to $\\mathbf{x}=(q,p)$ is:\n$$\nD_{\\mathbf{x}}\\mathbf{f} = \\begin{pmatrix} \\partial p / \\partial q  \\partial p / \\partial p \\\\ \\partial(-\\kappa q) / \\partial q  \\partial(-\\kappa q) / \\partial p \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ -\\kappa(t)  0 \\end{pmatrix} = A(t).\n$$\nCrucially, for this linear system, the matrix $A(t)$ is independent of the state $\\mathbf{x}$. Thus, the variational equations are identical to the original equations of motion.\n\nThe solution to the linear system $\\dot{\\delta\\mathbf{x}} = A(t)\\delta\\mathbf{x}$ can be expressed using the fundamental matrix solution $M(t)$, which is defined as the solution to the matrix differential equation\n$$\n\\dot{M}(t) = A(t) M(t),\n$$\nwith the initial condition $M(0) = I$, where $I$ is the $2 \\times 2$ identity matrix. The solution for a given initial perturbation $\\delta\\mathbf{x}_0$ is then $\\delta\\mathbf{x}(t) = M(t)\\delta\\mathbf{x}_0$.\n\nThe derivative of the Poincaré map, $DP_T$, is the linear operator that maps an initial perturbation $\\delta\\mathbf{x}_0$ to the final perturbation $\\delta\\mathbf{x}(T)$ after one period. From the relationship $\\delta\\mathbf{x}(T) = M(T)\\delta\\mathbf{x}_0$, we directly identify\n$$\nDP_T = M(T).\n$$\nThis matrix $M(T)$ is also known as the monodromy matrix.\n\n### 2. Stability Classification from the Symplectic Property\n\nThe flow generated by a Hamiltonian system is a canonical transformation. Consequently, the Poincaré map $P_T$ is a canonical map. Its derivative, $DP_T = M(T)$, must be a symplectic matrix. For a $2 \\times 2$ matrix, the symplectic condition is equivalent to the determinant being equal to one:\n$$\n\\det(M(T)) = 1.\n$$\nThe stability of the fixed point is dictated by the eigenvalues, $\\mu$, of the monodromy matrix $M(T)$. The eigenvalues are the roots of the characteristic polynomial, $\\det(M(T) - \\mu I) = 0$. For a $2 \\times 2$ matrix $M$, this polynomial is:\n$$\n\\mu^2 - \\operatorname{tr}(M)\\mu + \\det(M) = 0.\n$$\nSubstituting the symplectic condition $\\det(M(T)) = 1$ and letting $\\tau = \\operatorname{tr}(M(T))$, we obtain the characteristic equation for the eigenvalues:\n$$\n\\mu^2 - \\tau\\mu + 1 = 0.\n$$\nThe solutions to this quadratic equation are\n$$\n\\mu_{1,2} = \\frac{\\tau \\pm \\sqrt{\\tau^2 - 4}}{2}.\n$$\nThe nature of these eigenvalues depends on the discriminant $\\Delta = \\tau^2 - 4$:\n\n1.  **Elliptic Case**: If $|\\tau|  2$, then $\\tau^2  4$, and the discriminant $\\Delta$ is negative. The eigenvalues are a complex conjugate pair:\n    $$\n    \\mu_{1,2} = \\frac{\\tau \\pm i\\sqrt{4 - \\tau^2}}{2}.\n    $$\n    The magnitude of these eigenvalues is $|\\mu|^2 = \\left(\\frac{\\tau}{2}\\right)^2 + \\left(\\frac{\\sqrt{4 - \\tau^2}}{2}\\right)^2 = \\frac{\\tau^2 + 4 - \\tau^2}{4} = 1$. The eigenvalues lie on the unit circle in the complex plane. Perturbations near the fixed point neither grow nor decay exponentially but oscillate around it. This signifies linear stability. (Classification code: $1$)\n\n2.  **Hyperbolic Case**: If $|\\tau| > 2$, then $\\tau^2 > 4$, and the discriminant $\\Delta$ is positive. The eigenvalues are real and distinct. From the characteristic equation $\\mu^2 - \\tau\\mu + 1 = 0$, we know their product is $\\mu_1 \\mu_2 = 1$. Thus, the eigenvalues are real reciprocals, e.g., $\\mu_1 > 1$ and $\\mu_2 = 1/\\mu_1  1$. The existence of an eigenvalue with magnitude greater than one implies that perturbations along its corresponding eigenvector grow exponentially. The fixed point is unstable (a saddle). (Classification code: $-1$)\n\n3.  **Parabolic Case**: If $|\\tau| = 2$, then $\\tau^2 = 4$, and the discriminant $\\Delta$ is zero. The eigenvalues are repeated. If $\\tau=2$, $\\mu_1=\\mu_2=1$. If $\\tau=-2$, $\\mu_1=\\mu_2=-1$. This is a borderline case between stable and unstable behavior. The matrix $M(T)$ may or may not be diagonalizable, leading to either linear or algebraic growth of perturbations. (Classification code: $0$)\n\n### 3. Numerical Implementation\n\nTo compute the monodromy matrix $M(T)$, we must numerically solve the initial value problem $\\dot{M}(t) = A(t)M(t)$ with $M(0)=I$ over the interval $t \\in [0, T]$. This matrix equation is equivalent to a system of four coupled, first-order, linear ordinary differential equations for the elements of $M(t) = \\begin{pmatrix} m_{11}(t)  m_{12}(t) \\\\ m_{21}(t)  m_{22}(t) \\end{pmatrix}$:\n$$\n\\frac{d}{dt}\\begin{pmatrix} m_{11} \\\\ m_{12} \\\\ m_{21} \\\\ m_{22} \\end{pmatrix} = \\begin{pmatrix} m_{21} \\\\ m_{22} \\\\ -\\kappa(t) m_{11} \\\\ -\\kappa(t) m_{12} \\end{pmatrix}.\n$$\nWe define a state vector $\\mathbf{y}(t) = [m_{11}(t), m_{12}(t), m_{21}(t), m_{22}(t)]^T$. The initial condition is $\\mathbf{y}(0) = [1, 0, 0, 1]^T$. The function $\\kappa(t)$ is defined piecewise according to the problem statement. This system is integrated from $t=0$ to $t=T$ using a high-precision numerical solver, `scipy.integrate.solve_ivp`, with stringent error tolerances to ensure accuracy. The final state vector $\\mathbf{y}(T)$ gives the elements of the monodromy matrix $M(T)$. The trace is then computed as $\\tau = m_{11}(T) + m_{22}(T)$. Finally, the classification is performed based on the value of $\\tau$ using the criteria derived above, with a numerical tolerance of $10^{-9}$ to robustly identify the parabolic case $|\\tau|=2$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves for the stability of a fixed point in a time-periodic Hamiltonian system\n    by numerically computing the trace of the monodromy matrix and classifying it.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (omega, lambda, alpha, T)\n        (1.0, 0.0, 1.0, np.pi/2),\n        (1.0, 2.0, 0.2, 1.0),\n        (1.0, 0.0, 1.0, 2*np.pi),\n    ]\n\n    results = []\n    # Tolerance for parabolic classification\n    parabolic_tolerance = 1e-9\n\n    for case in test_cases:\n        omega, lambda_, alpha, T = case\n\n        def create_ode_func(omega, lambda_, alpha, T):\n            \"\"\"\n            Creates the ODE function dy/dt = f(t, y) for the 4 elements of the\n            monodromy matrix, closing over the system parameters.\n            \n            y is a 4-element vector [m11, m12, m21, m22].\n            \"\"\"\n            # Pre-calculate squared parameters for efficiency\n            omega_sq = omega**2\n            lambda_sq = lambda_**2\n            \n            def ode_func(t, y):\n                \"\"\"\n                The system of ODEs for the elements of the fundamental matrix M.\n                dM/dt = A(t) * M, where A(t) = [[0, 1], [-kappa(t), 0]].\n                \"\"\"\n                m11, m12, m21, m22 = y\n                \n                # The integration occurs over [0, T], so t % T is not needed.\n                # The condition is defined as 0 = t mod T  alpha*T.\n                if t  alpha * T:\n                    kappa_val = omega_sq\n                else:\n                    kappa_val = -lambda_sq\n                \n                # Derivatives from the matrix equation:\n                # d/dt [m11, m12] = [m21, m22]\n                # d/dt [m21, m22] = [-kappa*m11, -kappa*m12]\n                dm11_dt = m21\n                dm12_dt = m22\n                dm21_dt = -kappa_val * m11\n                dm22_dt = -kappa_val * m12\n                \n                return [dm11_dt, dm12_dt, dm21_dt, dm22_dt]\n\n            return ode_func\n\n        # Create the specific ODE function for the current case\n        ode_system = create_ode_func(omega, lambda_, alpha, T)\n\n        # Initial condition: M(0) = I\n        y0 = np.array([1.0, 0.0, 0.0, 1.0])\n        \n        # Time span for integration\n        t_span = (0, T)\n\n        # Numerically integrate the ODE system to find M(T)\n        # Use a high-precision solver with tight tolerances\n        sol = solve_ivp(\n            ode_system, \n            t_span, \n            y0, \n            method='DOP853',  # A high-order accurate method\n            rtol=1e-12, \n            atol=1e-12\n        )\n        \n        # The final state vector contains the elements of M(T)\n        m_final = sol.y[:, -1]\n        \n        # The trace of the monodromy matrix M(T) is m11(T) + m22(T)\n        trace_m = m_final[0] + m_final[3]\n\n        # Classify the fixed point based on the trace\n        classification_code = 0  # Default to Parabolic\n        if np.abs(np.abs(trace_m) - 2.0)  parabolic_tolerance:\n            classification_code = 0  # Parabolic\n        elif np.abs(trace_m)  2.0:\n            classification_code = 1  # Elliptic\n        else: # np.abs(trace_m) > 2.0\n            classification_code = -1 # Hyperbolic\n\n        # Round trace to six decimal places for the output\n        trace_rounded = round(trace_m, 6)\n        \n        results.append([trace_rounded, classification_code])\n\n    # Format the final output string exactly as specified.\n    # e.g., [[trace1,class1],[trace2,class2]]\n    inner_strings = [f\"[{trace},{code}]\" for trace, code in results]\n    output_string = f\"[{','.join(inner_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "This practice extends the numerical stability analysis to a more general and fundamental case: a periodic orbit within an autonomous, nonlinear system . The task involves integrating the variational equations along a known periodic trajectory to find the linearized flow and then correctly projecting this map onto the tangent space of the Poincaré section. This exercise provides hands-on experience with analyzing the transverse stability of an orbit, a crucial step in understanding the complex geometric structures that emerge in Hamiltonian systems.",
            "id": "3760869",
            "problem": "Consider the autonomous Hamiltonian system with two degrees of freedom defined on the phase space with coordinates $(q_1,q_2,p_1,p_2)$ and Hamiltonian\n$$\nH(q_1,q_2,p_1,p_2) \\;=\\; \\tfrac{1}{2}\\left(p_1^2 + p_2^2\\right) \\;+\\; \\tfrac{1}{2}\\left(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2\\right) \\;+\\; \\varepsilon\\, q_1^2 q_2^2,\n$$\nwhere $\\omega_1 > 0$, $\\omega_2 > 0$, and $\\varepsilon \\ge 0$ are parameters. The Hamiltonian vector field is given by the standard Hamilton equations\n$$\n\\dot{q}_i \\;=\\; \\frac{\\partial H}{\\partial p_i}, \\qquad \\dot{p}_i \\;=\\; -\\frac{\\partial H}{\\partial q_i}, \\qquad i\\in\\{1,2\\}.\n$$\nFor any amplitude $A > 0$, the submanifold defined by $q_2=0$ and $p_2=0$ is invariant under the flow, and the initial condition\n$$\nx^\\ast(0) \\;=\\; \\big(q_1,q_2,p_1,p_2\\big)\\Big|_{t=0} \\;=\\; \\big(0,\\,0,\\,A\\omega_1,\\,0\\big)\n$$\nlies on a periodic orbit of period $T = 2\\pi/\\omega_1$. Define the Poincaré section\n$$\n\\Sigma \\;=\\; \\{\\, x \\in \\mathbb{R}^4 \\;|\\; h(x)=0 \\,\\}, \\quad \\text{with } h(x)=q_1,\n$$\nand the crossing condition $\\dot{q}_1 > 0$ (that is, $p_1 > 0$ at the crossing). Thus, $x^\\ast(0)\\in\\Sigma$ and is a fixed point of the Poincaré map induced by the flow after one period along the periodic orbit.\n\nYour task is to compute, for each specified parameter set, the derivative of the Poincaré map at the fixed point $x^\\ast(0)$, denoted $DP$, as a linear map on the tangent space $T_{x^\\ast(0)}\\Sigma$. You must do this numerically by:\n- Integrating the Hamiltonian flow over one period $T$ starting from $x^\\ast(0)$.\n- Simultaneously integrating the associated variational equations (the linearization of the flow along the trajectory) to obtain the fundamental solution matrix $\\Phi(T)$ with $\\Phi(0)=I$.\n- Projecting the resulting linearized map to the tangent space $T_{x^\\ast(0)}\\Sigma$ along the flow direction at the section crossing in a way that enforces the section constraint to first order.\n\nFundamental base you may assume:\n- The Hamiltonian vector field $f(x)$ is given by $f(x) = J \\nabla H(x)$, where $J$ is the standard symplectic matrix, and the variational equations along a trajectory $x(t)$ are $\\dot{\\Phi}(t) = Df\\big(x(t)\\big)\\,\\Phi(t)$ with $\\Phi(0)=I$.\n- The Poincaré map linearization $DP$ at a fixed point is obtained by composing the linearized flow over one period with the geometric operation that enforces the section constraint to first order by removing the component along the flow direction and restricting to the section tangent space.\n\nYou must implement a numerical integrator for the combined system $(x(t),\\Phi(t))$ over $[0,T]$, construct the required projection to $T_{x^\\ast(0)}\\Sigma$ along the flow direction at the section, and extract a concrete matrix representation of $DP$ in the basis of $T_{x^\\ast(0)}\\Sigma$ given by the ordered set of canonical coordinate directions $(q_2,p_1,p_2)$, which are tangent to $\\Sigma$ at $x^\\ast(0)$.\n\nFor each test case below, compute the three eigenvalues of $DP$ and report their magnitudes. The final numerical answers are dimensionless. Your program should compute the list of eigenvalue magnitudes for each test case and output a single line containing a list of these lists in the specified order. Each magnitude must be rounded to ten digits after the decimal point.\n\nTest suite (each tuple is $(\\omega_1,\\omega_2,\\varepsilon,A)$):\n1. $(1.0,\\,1.5,\\,0.05,\\,0.2)$\n2. $(1.0,\\,1.5,\\,0.0,\\,0.3)$\n3. $(1.0,\\,2.0,\\,0.1,\\,0.1)$\n4. $(1.0,\\,0.8,\\,0.2,\\,0.4)$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a JSON-like nested list string, where each inner list corresponds to one test case and contains the three eigenvalue magnitudes in nondecreasing order, each rounded to ten digits after the decimal point. For example, a valid format is\n\"[ [m11,m12,m13], [m21,m22,m23], [m31,m32,m33], [m41,m42,m43] ]\"\nwith no spaces required beyond those shown.",
            "solution": "The user wants me to solve a problem in the field of geometric mechanics and symplectic methods, specifically related to Poincaré maps.\n\nHere's my plan:\n\n1.  **Validate the Problem:** I need to go through the strict validation checklist provided in the instructions.\n    *   **Step 1: Extract Givens:** I'll list all the equations, definitions, and parameters verbatim.\n    *   **Step 2: Validate:** I will check if the problem is scientifically grounded, well-posed, objective, and complete. I'll look for any of the specified flaws.\n    *   **Step 3: Verdict:** Based on the validation, I'll decide whether to proceed with the solution or declare the problem invalid.\n\n2.  **Deconstruct the Problem (if valid):**\n    *   **System:** A Hamiltonian system with 2 degrees of freedom.\n        *   Hamiltonian: $H = \\frac{1}{2}(p_1^2 + p_2^2) + \\frac{1}{2}(\\omega_1^2 q_1^2 + \\omega_2^2 q_2^2) + \\varepsilon q_1^2 q_2^2$.\n        *   Phase space coordinates: $(q_1, q_2, p_1, p_2)$.\n        *   Hamilton's equations: $\\dot{q}_i = \\frac{\\partial H}{\\partial p_i}$, $\\dot{p}_i = -\\frac{\\partial H}{\\partial q_i}$.\n    *   **Periodic Orbit:**\n        *   An invariant submanifold is given by $q_2=0, p_2=0$.\n        *   The initial condition $x^\\ast(0) = (0, 0, A\\omega_1, 0)$ is on this submanifold.\n        *   This initial condition leads to a periodic orbit with period $T = 2\\pi/\\omega_1$.\n    *   **Poincaré Section and Map:**\n        *   Section $\\Sigma$ is defined by $h(x) = q_1 = 0$.\n        *   Crossing condition is $\\dot{q}_1 > 0$, which means $p_1 > 0$.\n        *   The point $x^\\ast(0)$ is on this section and is a fixed point of the Poincaré map.\n    *   **Task:** Compute the derivative of the Poincaré map, $DP$, at the fixed point $x^\\ast(0)$.\n    *   **Method:**\n        1.  Integrate the Hamiltonian flow for the state $x(t)$ starting from $x^\\ast(0)$ over one period $T = 2\\pi/\\omega_1$.\n        2.  Simultaneously, integrate the variational equations $\\dot{\\Phi}(t) = Df(x(t)) \\Phi(t)$ with $\\Phi(0)=I$ to get the fundamental solution matrix $\\Phi(T)$.\n        3.  Project the linearized map $\\Phi(T)$ to the tangent space $T_{x^\\ast(0)}\\Sigma$ to get $DP$.\n    *   **Representation:**\n        *   The final map $DP$ should be represented as a matrix in the basis of $T_{x^\\ast(0)}\\Sigma$.\n        *   The basis for $T_{x^\\ast(0)}\\Sigma$ is given by the coordinate directions $(q_2, p_1, p_2)$.\n    *   **Output:** For each test case, find the eigenvalues of the matrix representation of $DP$ and report their magnitudes, sorted and rounded.\n\n3.  **Detailed Mathematical Formulation (if valid):**\n\n    *   **State Vector:** Let $x = (q_1, q_2, p_1, p_2)^T$. The problem statement uses this ordering implicitly. Let's stick to it.\n    *   **Hamiltonian Vector Field:**\n        *   $\\dot{q}_1 = \\frac{\\partial H}{\\partial p_1} = p_1$\n        *   $\\dot{q}_2 = \\frac{\\partial H}{\\partial p_2} = p_2$\n        *   $\\dot{p}_1 = -\\frac{\\partial H}{\\partial q_1} = -(\\omega_1^2 q_1 + 2\\varepsilon q_1 q_2^2) = -q_1(\\omega_1^2 + 2\\varepsilon q_2^2)$\n        *   $\\dot{p}_2 = -\\frac{\\partial H}{\\partial q_2} = -(\\omega_2^2 q_2 + 2\\varepsilon q_1^2 q_2) = -q_2(\\omega_2^2 + 2\\varepsilon q_1^2)$\n        *   The vector field is $f(x) = (\\, p_1, \\, p_2, \\, -q_1(\\omega_1^2 + 2\\varepsilon q_2^2), \\, -q_2(\\omega_2^2 + 2\\varepsilon q_1^2) \\,)^T$.\n\n    *   **The Periodic Orbit $x^\\ast(t)$:**\n        *   Initial condition: $x^\\ast(0) = (0, 0, A\\omega_1, 0)$.\n        *   On the invariant manifold $q_2=0, p_2=0$, the equations simplify to:\n            *   $\\dot{q}_1 = p_1$\n            *   $\\dot{p}_1 = -\\omega_1^2 q_1$\n            *   $\\dot{q}_2 = 0$\n            *   $\\dot{p}_2 = 0$\n        *   This is a simple harmonic oscillator for the $(q_1, p_1)$ pair.\n        *   With $q_1(0)=0$ and $p_1(0)=A\\omega_1$, the solution is:\n            *   $q_1(t) = A \\sin(\\omega_1 t)$\n            *   $p_1(t) = A\\omega_1 \\cos(\\omega_1 t)$\n        *   So, the periodic orbit is $x^\\ast(t) = (A \\sin(\\omega_1 t), \\, 0, \\, A\\omega_1 \\cos(\\omega_1 t), \\, 0)^T$.\n        *   The period is indeed $T = 2\\pi/\\omega_1$. At $t=T$, we have $x^\\ast(T) = (0, 0, A\\omega_1, 0) = x^\\ast(0)$.\n\n    *   **Variational Equations:** We need the Jacobian of the vector field, $Df(x)$.\n        *   $f(x) = (f_1, f_2, f_3, f_4)^T = (p_1, p_2, -q_1(\\omega_1^2 + 2\\varepsilon q_2^2), -q_2(\\omega_2^2 + 2\\varepsilon q_1^2))^T$.\n        *   $Df(x) = \\begin{pmatrix}\n              \\frac{\\partial f_1}{\\partial q_1}  \\frac{\\partial f_1}{\\partial q_2}  \\frac{\\partial f_1}{\\partial p_1}  \\frac{\\partial f_1}{\\partial p_2} \\\\\n              \\frac{\\partial f_2}{\\partial q_1}  \\frac{\\partial f_2}{\\partial q_2}  \\frac{\\partial f_2}{\\partial p_1}  \\frac{\\partial f_2}{\\partial p_2} \\\\\n              \\frac{\\partial f_3}{\\partial q_1}  \\frac{\\partial f_3}{\\partial q_2}  \\frac{\\partial f_3}{\\partial p_1}  \\frac{\\partial f_3}{\\partial p_2} \\\\\n              \\frac{\\partial f_4}{\\partial q_1}  \\frac{\\partial f_4}{\\partial q_2}  \\frac{\\partial f_4}{\\partial p_1}  \\frac{\\partial f_4}{\\partial p_2}\n            \\end{pmatrix} = \\begin{pmatrix}\n              0  0  1  0 \\\\\n              0  0  0  1 \\\\\n              -(\\omega_1^2 + 2\\varepsilon q_2^2)  -4\\varepsilon q_1 q_2  0  0 \\\\\n              -4\\varepsilon q_1 q_2  -(\\omega_2^2 + 2\\varepsilon q_1^2)  0  0\n            \\end{pmatrix}$\n    *   **Linearization along the Orbit:** We need to evaluate $Df$ along $x^\\ast(t)$.\n        *   $q_1(t) = A \\sin(\\omega_1 t)$\n        *   $q_2(t) = 0$\n        *   $Df(x^\\ast(t)) = \\begin{pmatrix}\n              0  0  1  0 \\\\\n              0  0  0  1 \\\\\n              -\\omega_1^2  0  0  0 \\\\\n              0  -(\\omega_2^2 + 2\\varepsilon A^2 \\sin^2(\\omega_1 t))  0  0\n            \\end{pmatrix}$\n        *   This is the matrix $M(t) = Df(x^\\ast(t))$ that drives the variational equations $\\dot{\\Phi}(t) = M(t) \\Phi(t)$.\n\n    *   **Numerical Integration:**\n        *   The state is a 20-dimensional vector: 4 for $x(t)$ and 16 for $\\Phi(t)$ (a 4x4 matrix).\n        *   The ODE system to integrate is:\n            *   $\\dot{x} = f(x)$\n            *   $\\dot{\\Phi} = Df(x) \\Phi$\n        *   Let $Y = (x, \\Phi_{11}, \\Phi_{12}, ..., \\Phi_{44})^T$ be the combined state vector. The size is $4+16=20$. We can also think of it as integrating the vector $x$ and the matrix $\\Phi$ simultaneously.\n        *   The derivative function `dY/dt` will compute $f(x)$ and $Df(x)\\Phi$.\n        *   We need a numerical integrator, like `scipy.integrate.solve_ivp`. The problem suggests implementing one, but using a library function is standard practice and more robust. Let's use `solve_ivp` with a high-precision method like RK45 or DOP853.\n        *   Initial condition: $x(0) = x^\\ast(0) = (0, 0, A\\omega_1, 0)$ and $\\Phi(0) = I_{4 \\times 4}$.\n        *   Integration interval: $[0, T]$ where $T = 2\\pi/\\omega_1$.\n        *   The result will be $x(T)$ and $\\Phi(T)$. Since the integration will have numerical errors, $x(T)$ will be close to but not exactly $x^\\ast(0)$. The matrix $\\Phi(T)$ is what we really need.\n\n    *   **Special Case $\\varepsilon = 0$:**\n        *   When $\\varepsilon = 0$, the system is two uncoupled harmonic oscillators.\n        *   $H = \\frac{1}{2}(p_1^2 + \\omega_1^2 q_1^2) + \\frac{1}{2}(p_2^2 + \\omega_2^2 q_2^2)$.\n        *   The Jacobian is constant along the orbit:\n            $Df(x^\\ast(t)) = \\begin{pmatrix}\n              0  0  1  0 \\\\\n              0  0  0  1 \\\\\n              -\\omega_1^2  0  0  0 \\\\\n              0  -\\omega_2^2  0  0\n            \\end{pmatrix} = M_{const}$.\n        *   The fundamental solution matrix is $\\Phi(T) = e^{M_{const} T}$.\n        *   $M_{const}$ is block diagonal: $M_{const} = \\begin{pmatrix} A_1  0 \\\\ 0  A_2 \\end{pmatrix}$ where $A_i = \\begin{pmatrix} 0  1 \\\\ -\\omega_i^2  0 \\end{pmatrix}$.\n        *   So $\\Phi(T) = \\begin{pmatrix} e^{A_1 T}  0 \\\\ 0  e^{A_2 T} \\end{pmatrix}$.\n        *   Let's compute $e^{A_i t}$: $A_i^2 = \\begin{pmatrix} -\\omega_i^2  0 \\\\ 0  -\\omega_i^2 \\end{pmatrix} = -\\omega_i^2 I$.\n        *   $e^{A_i t} = I \\cos(\\omega_i t) + A_i \\frac{1}{\\omega_i} \\sin(\\omega_i t) = \\begin{pmatrix} \\cos(\\omega_i t)  \\frac{1}{\\omega_i}\\sin(\\omega_i t) \\\\ -\\omega_i \\sin(\\omega_i t)  \\cos(\\omega_i t) \\end{pmatrix}$.\n        *   At $t=T=2\\pi/\\omega_1$:\n            *   $e^{A_1 T} = \\begin{pmatrix} \\cos(2\\pi)  \\frac{1}{\\omega_1}\\sin(2\\pi) \\\\ -\\omega_1 \\sin(2\\pi)  \\cos(2\\pi) \\end{pmatrix} = I_{2 \\times 2}$.\n            *   $e^{A_2 T} = \\begin{pmatrix} \\cos(\\omega_2 T)  \\frac{1}{\\omega_2}\\sin(\\omega_2 T) \\\\ -\\omega_2 \\sin(\\omega_2 T)  \\cos(\\omega_2 T) \\end{pmatrix} = \\begin{pmatrix} \\cos(2\\pi \\frac{\\omega_2}{\\omega_1})  \\frac{1}{\\omega_2}\\sin(2\\pi \\frac{\\omega_2}{\\omega_1}) \\\\ -\\omega_2 \\sin(2\\pi \\frac{\\omega_2}{\\omega_1})  \\cos(2\\pi \\frac{\\omega_2}{\\omega_1}) \\end{pmatrix}$. This is a rotation matrix.\n        *   So for $\\varepsilon=0$, $\\Phi(T)$ is (in the $(q_1, q_2, p_1, p_2)$ basis):\n            $\\Phi(T) = \\begin{pmatrix}\n              1  0  0  0 \\\\\n              0  \\cos(\\theta)  0  \\frac{1}{\\omega_2}\\sin(\\theta) \\\\\n              0  0  1  0 \\\\\n              0  -\\omega_2 \\sin(\\theta)  0  \\cos(\\theta)\n            \\end{pmatrix}$ where $\\theta = \\omega_2 T = 2\\pi \\frac{\\omega_2}{\\omega_1}$.\n        *   This analytic result will be a good check for the numerical integrator in test case 2.\n\n    *   **Projection to get $DP$:**\n        *   The linearized flow maps a tangent vector $\\delta x_0$ at $x^\\ast(0)$ to $\\delta x_T = \\Phi(T) \\delta x_0$ at $x^\\ast(T) = x^\\ast(0)$.\n        *   The Poincaré section is $\\Sigma = \\{x | q_1=0\\}$. The tangent space $T_{x^\\ast(0)}\\Sigma$ is the kernel of the gradient of the section-defining function $h(x)=q_1$.\n        *   $\\nabla h = (1, 0, 0, 0)^T$. So $T_{x^\\ast(0)}\\Sigma = \\{ \\delta x | \\langle \\nabla h, \\delta x \\rangle = 0 \\} = \\{ (\\delta q_1, \\delta q_2, \\delta p_1, \\delta p_2) | \\delta q_1 = 0 \\}$.\n        *   This is a 3D space spanned by the basis vectors for $q_2, p_1, p_2$.\n        *   The Poincaré map $P$ maps a point $x_0 \\in \\Sigma$ to the next intersection point $x_1 \\in \\Sigma$. We want to find its derivative $DP$.\n        *   Let $x_0 = x^\\ast(0) + \\delta x_0$ with $\\delta x_0 \\in T_{x^\\ast(0)}\\Sigma$.\n        *   The flow takes it to $x(T') \\approx x^\\ast(T') + \\Phi(T') \\delta x_0$, where $T'$ is the new return time, close to $T$.\n        *   The deviation from the fixed point is $\\delta x_1 = x_1 - x^\\ast(0) \\approx \\Phi(T) \\delta x_0 - f(x^\\ast(0)) \\frac{\\langle \\nabla h, \\Phi(T) \\delta x_0 \\rangle}{\\langle \\nabla h, f(x^\\ast(0)) \\rangle}$.\n        *   This is the action of $DP$ on $\\delta x_0$. The linear map is $DP = \\left( I - \\frac{f(x^\\ast(0)) \\otimes \\nabla h}{\\langle \\nabla h, f(x^\\ast(0)) \\rangle} \\right) \\Phi(T)$.\n        *   Let's compute the vectors.\n            *   $x^\\ast(0) = (0, 0, A\\omega_1, 0)$.\n            *   $f(x^\\ast(0)) = (p_1, p_2, ...,)^T|_{x^\\ast(0)} = (A\\omega_1, 0, 0, 0)^T$.\n            *   $\\nabla h = (1, 0, 0, 0)^T$.\n            *   $\\langle \\nabla h, f(x^\\ast(0)) \\rangle = (1,0,0,0) \\cdot (A\\omega_1, 0, 0, 0) = A\\omega_1$. This is $\\dot{q}_1(0)$, which is positive as required.\n            *   The projection matrix $P_{proj} = I - \\frac{f(x^\\ast(0)) \\otimes \\nabla h^T}{A\\omega_1} = I - \\frac{1}{A\\omega_1} \\begin{pmatrix} A\\omega_1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} = \\begin{pmatrix} 0  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\end{pmatrix}$.\n        *   So $DP = P_{proj} \\Phi(T)$.\n        *   We need to represent $DP$ as a map on $T_{x^\\ast(0)}\\Sigma$ in the basis $(q_2, p_1, p_2)$.\n        *   The coordinates are indexed $1, 2, 3, 4$ for $q_1, q_2, p_1, p_2$. The basis corresponds to directions $e_2, e_3, e_4$.\n        *   The representation $M_{DP}$ is obtained by selecting the rows and columns of $P_{proj}\\Phi(T)$ corresponding to these basis vectors.\n        *   $M_{DP} = \\begin{pmatrix} \\Phi_{22}  \\Phi_{23}  \\Phi_{24} \\\\ \\Phi_{32}  \\Phi_{33}  \\Phi_{34} \\\\ \\Phi_{42}  \\Phi_{43}  \\Phi_{44} \\end{pmatrix}$. This uses the fact that the first row of $P_{proj}\\Phi(T)$ is zero, and the first column is not part of the basis.\n        *   The problem simplifies significantly by reordering the state vector to $x=(q_1, p_1, q_2, p_2)$.\n        *   The Jacobian along the orbit, $Df(x^\\ast(t))$, becomes block-diagonal:\n            $$\n            Df(x^\\ast(t)) = \\begin{pmatrix}\n             0  1  0  0 \\\\\n             -\\omega_1^2  0  0  0 \\\\\n             0  0  0  1 \\\\\n             0  0  -(\\omega_2^2 + 2\\varepsilon A^2 \\sin^2(\\omega_1 t))  0\n            \\end{pmatrix} = \\begin{pmatrix} M_1  0 \\\\ 0  M_2(t) \\end{pmatrix}\n            $$\n        *   The fundamental solution matrix $\\Phi(T)$ is also block-diagonal: $\\Phi(T) = \\begin{pmatrix} \\Phi_1(T)  0 \\\\ 0  \\Phi_2(T) \\end{pmatrix}$.\n        *   $\\Phi_1(T) = \\exp(M_1 T)$ where $T=2\\pi/\\omega_1$. This evaluates to the $2\\times2$ identity matrix, $I_2$.\n        *   $\\Phi_2(T)$ is the solution at $t=T$ of $\\dot{\\Phi}_2 = M_2(t)\\Phi_2$ with $\\Phi_2(0)=I_2$.\n        *   The section is $q_1=0$. In the new coordinates, $\\nabla h = (1, 0, 0, 0)^T$. The flow vector is $f(x^\\ast(0))=(A\\omega_1, 0, 0, 0)^T$. The projection is the same.\n        *   The tangent space basis is now for $(p_1, q_2, p_2)$ using this coordinate order. Let's use the problem-specified basis order $(q_2, p_1, p_2)$. A vector $(v_1, v_2, v_3)$ in this basis corresponds to $\\delta x_0 = (0, v_2, v_1, v_3)^T$.\n        *   The matrix representation of $DP$ is found to be $M_{DP} = \\begin{pmatrix} \\Phi_{2,11}  0  \\Phi_{2,12} \\\\ 0  1  0 \\\\ \\Phi_{2,21}  0  \\Phi_{2,22} \\end{pmatrix}$, where $\\Phi_2(T) = \\begin{pmatrix} \\Phi_{2,11}  \\Phi_{2,12} \\\\ \\Phi_{2,21}  \\Phi_{2,22} \\end{pmatrix}$.\n        *   The eigenvalues of $M_{DP}$ are $1$ and the two eigenvalues of $\\Phi_2(T)$.\n        *   The task reduces to numerically computing $\\Phi_2(T)$ by integrating the linear non-autonomous system $\\ddot{y} + g(t)y = 0$ for one period $T=2\\pi/\\omega_1$, where $g(t) = \\omega_2^2 + 2\\varepsilon A^2 \\sin^2(\\omega_1 t)$, and finding the eigenvalues of its monodromy matrix $\\Phi_2(T)$.\n        *   Since the transverse system for $(q_2, p_2)$ is Hamiltonian, the map $\\Phi_2(T)$ must be symplectic. For a $2\\times 2$ matrix, this implies its determinant is $1$. The product of its eigenvalues is $1$. This provides a check on the numerical results.\n\n### Summary of the numerical procedure:\n1.  For each test case $(\\omega_1, \\omega_2, \\varepsilon, A)$, set the period $T = 2\\pi/\\omega_1$.\n2.  Define the system of first-order ODEs for the four components of the $2\\times2$ matrix $\\Phi_2(t)$:\n    $$\n    \\frac{d}{dt} \\begin{pmatrix} a(t)  b(t) \\\\ c(t)  d(t) \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ -g(t)  0 \\end{pmatrix} \\begin{pmatrix} a(t)  b(t) \\\\ c(t)  d(t) \\end{pmatrix}, \\quad \\text{with } g(t) = \\omega_2^2 + 2\\varepsilon A^2 \\sin^2(\\omega_1 t).\n    $$\n    This is equivalent to $\\dot{a}=c, \\dot{b}=d, \\dot{c}=-g(t)a, \\dot{d}=-g(t)b$.\n3.  Set the initial condition $\\Phi_2(0) = I_2$, i.e., $(a,b,c,d) = (1,0,0,1)$.\n4.  Numerically integrate this system over the interval $[0, T]$ to find $\\Phi_2(T)$.\n5.  The three eigenvalues of the map $DP$ are $\\{1, \\lambda_1, \\lambda_2 \\}$, where $\\lambda_{1,2}$ are the eigenvalues of $\\Phi_2(T)$.\n6.  Compute the magnitudes of these three eigenvalues and sort them.\n\nFor the special case $\\varepsilon=0$, $g(t)=\\omega_2^2$ is constant. The matrix $\\Phi_2(T)$ can be computed analytically as\n$$\n\\Phi_2(T) = \\begin{pmatrix} \\cos(\\omega_2 T)  \\frac{1}{\\omega_2}\\sin(\\omega_2 T) \\\\ -\\omega_2 \\sin(\\omega_2 T)  \\cos(\\omega_2 T) \\end{pmatrix}.\n$$\nIts eigenvalues are $e^{\\pm i \\omega_2 T}$, both of magnitude $1$. Thus, for $\\varepsilon=0$, the three eigenvalue magnitudes are all $1$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes the magnitudes of eigenvalues of the linearized Poincaré map\n    for a given Hamiltonian system for several parameter sets.\n    \"\"\"\n\n    # Test suite: each tuple is (omega1, omega2, epsilon, A)\n    test_cases = [\n        (1.0, 1.5, 0.05, 0.2),\n        (1.0, 1.5, 0.0, 0.3),\n        (1.0, 2.0, 0.1, 0.1),\n        (1.0, 0.8, 0.2, 0.4),\n    ]\n\n    all_results = []\n\n    for params in test_cases:\n        w1, w2, eps, A = params\n\n        # The period of the reference orbit.\n        T = 2 * np.pi / w1\n\n        # Case epsilon = 0 is analytically solvable. The system decouples into\n        # two linear harmonic oscillators. The linearized Poincare map has\n        # eigenvalues with magnitude 1. This serves as a sanity check.\n        if eps == 0.0:\n            magnitudes = [1.0, 1.0, 1.0]\n            all_results.append(magnitudes)\n            continue\n\n        # The ODE for the transverse variational dynamics Phi_2(t) corresponds to\n        # the second-order scalar equation:\n        # d^2(q2)/dt^2 + g(t)*q2 = 0\n        # where g(t) = w2^2 + 2*eps*A^2*sin^2(w1*t).\n        # We integrate the 4 components of the 2x2 matrix Phi_2.\n        # Let y = [a, b, c, d] where Phi_2 = [[a, b], [c, d]].\n        # The ODE system is:\n        # da/dt = c\n        # db/dt = d\n        # dc/dt = -g(t)*a\n        # dd/dt = -g(t)*b\n        \n        g_t_factor = 2 * eps * A**2\n        w2_sq = w2**2\n        \n        def ode_rhs(t, y):\n            a, b, c, d = y\n            g_t = w2_sq + g_t_factor * (np.sin(w1 * t))**2\n            dydt = [c, d, -g_t * a, -g_t * b]\n            return dydt\n\n        # Initial condition for Phi_2 is the identity matrix.\n        y0 = [1.0, 0.0, 0.0, 1.0]\n        \n        # Integrate the ODE system over one period T.\n        # Use a high-precision solver to get accurate results.\n        sol = solve_ivp(\n            ode_rhs,\n            [0, T],\n            y0,\n            method='DOP853',\n            t_eval=[T],\n            rtol=1e-13,\n            atol=1e-13\n        )\n        \n        # The solution at t=T gives the components of the monodromy matrix Phi_2(T).\n        phi2_T_flat = sol.y[:, -1]\n        phi2_T = phi2_T_flat.reshape((2, 2))\n\n        # The eigenvalues of the derivative of the Poincare map DP are 1 and\n        # the two eigenvalues of phi2_T.\n        eigvals_phi2 = np.linalg.eigvals(phi2_T)\n        \n        # The full set of eigenvalue magnitudes for DP.\n        magnitudes = sorted([1.0, np.abs(eigvals_phi2[0]), np.abs(eigvals_phi2[1])])\n        \n        all_results.append(magnitudes)\n\n    # Format the output as specified in the problem statement.\n    # Each magnitude is rounded to 10 decimal places.\n    result_strings = []\n    for res in all_results:\n        # Format each number and create the inner list string.\n        inner_str = f'[{\",\".join([f\"{val:.10f}\" for val in res])}]'\n        result_strings.append(inner_str)\n    \n    # Create the final outer list string.\n    final_output = f\"[{', '.join(result_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}