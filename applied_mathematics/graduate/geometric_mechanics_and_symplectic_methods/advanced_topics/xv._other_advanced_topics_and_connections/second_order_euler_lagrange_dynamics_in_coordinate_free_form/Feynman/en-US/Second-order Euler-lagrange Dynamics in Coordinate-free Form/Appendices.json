{
    "hands_on_practices": [
        {
            "introduction": "To build a robust understanding of second-order dynamics on manifolds, we must first become fluent in the language of its fundamental geometric structures. This exercise bridges the gap between the abstract, coordinate-free definitions of the vertical endomorphism $J$ and the Liouville vector field $\\Delta$ and their concrete manifestations in a local coordinate system. By deriving their explicit expressions and verifying the intrinsic condition $J(X) = \\Delta$ for a Newtonian SODE vector field $X$, you will solidify your grasp of the core geometric property that defines all second-order systems on the tangent bundle .",
            "id": "3765498",
            "problem": "Consider the configuration manifold $Q=\\mathbb{R}^{n}$ with its standard smooth structure and tangent bundle $TQ\\cong \\mathbb{R}^{n}\\times \\mathbb{R}^{n}$. Let $\\tau:TQ\\to Q$ denote the canonical projection. The tangent bundle $TQ$ carries two canonical geometric structures used in geometric mechanics: the tangent structure (also called the vertical endomorphism) $J$ and the Liouville (also called dilation or Euler) vector field $\\Delta$. \n\nStarting from the following coordinate-free fundamental definitions:\n- The vertical subbundle $V(TQ)\\subset TTQ$ is the kernel of $T\\tau:TTQ\\to TQ$. The tangent structure $J:TTQ\\to TTQ$ is the $(1,1)$-tensor that, for each $Y\\in TTQ$ at a point $(q,v)\\in TQ$, returns the unique vertical vector $J(Y)\\in V(TQ)$ whose fiber component coincides with $T\\tau(Y)\\in T_{q}Q$ under the canonical identification $V_{(q,v)}(TQ)\\cong T_{q}Q$.\n- The Liouville vector field $\\Delta$ on $TQ$ is the infinitesimal generator of the fiberwise scalar multiplication flow $s\\cdot:TQ\\to TQ$, given by $s\\cdot(q,v)=(q,sv)$; that is, for each $(q,v)\\in TQ$,\n$$\n\\Delta_{(q,v)}=\\left.\\frac{d}{ds}\\right|_{s=1}(q,sv).\n$$\n\nWork in global Cartesian coordinates $(q^{1},\\dots,q^{n})$ on $Q=\\mathbb{R}^{n}$ and the induced bundle coordinates $(q^{1},\\dots,q^{n},v^{1},\\dots,v^{n})$ on $TQ$. \n1. Derive the explicit coordinate expression of the tangent structure $J$ as a $(1,1)$-tensor on $TQ$ in terms of the local bases $\\left\\{\\frac{\\partial}{\\partial q^{i}},\\frac{\\partial}{\\partial v^{i}}\\right\\}$ of $TTQ$ and $\\{dq^{i},dv^{i}\\}$ of $T^{*}TQ$.\n2. Derive the explicit coordinate expression of the Liouville vector field $\\Delta$ on $TQ$.\n3. In the setting of Newtonian mechanics on $Q=\\mathbb{R}^{n}$ with the standard Euclidean metric, let $X$ be the Second-Order Differential Equation (SODE) vector field on $TQ$ encoding Newton’s law for a smooth potential $V:Q\\to\\mathbb{R}$. Using only the defining property of a SODE and the above coordinate-free definitions of $J$ and $\\Delta$, verify that $J(X)=\\Delta$ holds.\n\nProvide your final answer as the ordered pair $(J,\\Delta)$ written in coordinates as a row matrix using the $\\pmatrix{\\,\\cdot\\,&\\,\\cdot\\,}$ format. No numerical approximation is required.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and internally consistent. It presents a standard derivation in the context of geometric mechanics on tangent bundles. All definitions and conditions are standard and provide a self-contained setup for a unique and meaningful solution. We proceed with the derivation as requested.\n\nThe configuration space is $Q = \\mathbb{R}^{n}$ with global Cartesian coordinates $(q^{i})$ for $i=1, \\dots, n$. The tangent bundle $TQ$ has induced global coordinates $(q^{i}, v^{i})$, where a point $(q, v) \\in TQ$ corresponds to coordinates $(q^{1}, \\dots, q^{n}, v^{1}, \\dots, v^{n})$. The tangent space to $TQ$ at a point $(q,v)$, denoted $T_{(q,v)}TQ$, is a $2n$-dimensional real vector space with the natural basis $\\left\\{\\left.\\frac{\\partial}{\\partial q^{i}}\\right|_{(q,v)}, \\left.\\frac{\\partial}{\\partial v^{i}}\\right|_{(q,v)}\\right\\}_{i=1,\\dots,n}$.\n\n**1. Coordinate Expression of the Tangent Structure $J$**\n\nThe tangent structure $J$ is a $(1,1)$-tensor on $TQ$. We determine its action on the basis vectors of $TTQ$. Let $Y \\in T_{(q,v)}TQ$ be an arbitrary tangent vector, which can be expressed in coordinates as\n$$\nY = Y^{i} \\frac{\\partial}{\\partial q^{i}} + \\tilde{Y}^{i} \\frac{\\partial}{\\partial v^{i}}\n$$\nwhere summation over repeated indices from $1$ to $n$ is implied.\n\nThe canonical projection is $\\tau: TQ \\to Q$, given in coordinates by $\\tau(q,v) = q$. Its tangent map $T\\tau: TTQ \\to TQ$ acts on the basis vectors as follows. For a coordinate chart on $Q$, say $\\phi: U \\subset Q \\to \\mathbb{R}^n$, with coordinates $q^i$, the projection map is $\\tau^j(q,v) = q^j$.\nThe action of $T\\tau$ on the basis vectors of $T_{(q,v)}TQ$ is:\n$$\nT\\tau \\left( \\frac{\\partial}{\\partial q^{i}} \\right) = \\frac{\\partial \\tau^{j}}{\\partial q^{i}} \\frac{\\partial}{\\partial q^{j}} = \\delta_{i}^{j} \\frac{\\partial}{\\partial q^{j}} = \\frac{\\partial}{\\partial q^{i}} \\in T_{q}Q\n$$\n$$\nT\\tau \\left( \\frac{\\partial}{\\partial v^{i}} \\right) = \\frac{\\partial \\tau^{j}}{\\partial v^{i}} \\frac{\\partial}{\\partial q^{j}} = 0 \\cdot \\frac{\\partial}{\\partial q^{j}} = 0 \\in T_{q}Q\n$$\nApplying $T\\tau$ to the general vector $Y$ yields:\n$$\nT\\tau(Y) = Y^{i} T\\tau\\left(\\frac{\\partial}{\\partial q^{i}}\\right) + \\tilde{Y}^{i} T\\tau\\left(\\frac{\\partial}{\\partial v^{i}}\\right) = Y^{i} \\frac{\\partial}{\\partial q^{i}}\n$$\nThe components of $T\\tau(Y) \\in T_qQ$ in the basis $\\{\\frac{\\partial}{\\partial q^i}\\}$ are $(Y^1, \\dots, Y^n)$.\n\nThe vertical subbundle $V(TQ)$ is the kernel of $T\\tau$. A vector $Y$ is in $V_{(q,v)}(TQ)$ if $T\\tau(Y) = 0$, which implies $Y^i=0$ for all $i$. Thus, the vertical subbundle at $(q,v)$ is spanned by $\\left\\{\\frac{\\partial}{\\partial v^{i}}\\right\\}$, i.e., $V_{(q,v)}(TQ) = \\text{span}\\left\\{\\frac{\\partial}{\\partial v^{i}}\\right\\}_{i=1,\\dots,n}$.\n\nThe canonical identification $V_{(q,v)}(TQ) \\cong T_{q}Q$ maps the basis vector $\\frac{\\partial}{\\partial v^{i}}$ to $\\frac{\\partial}{\\partial q^{i}}$.\nAccording to the definition, for any $Y \\in TTQ$, $J(Y)$ is a vertical vector. Therefore, it must be of the form $J(Y) = C^{i} \\frac{\\partial}{\\partial v^{i}}$ for some coefficients $C^i$. The definition further states that the fiber component of $J(Y)$ under the canonical identification equals $T\\tau(Y)$. The fiber component of $J(Y)$ is the vector $C^{i} \\frac{\\partial}{\\partial q^{i}} \\in T_{q}Q$.\nEquating this with our expression for $T\\tau(Y)$:\n$$\nC^{i} \\frac{\\partial}{\\partial q^{i}} = Y^{i} \\frac{\\partial}{\\partial q^{i}} \\implies C^{i} = Y^{i}\n$$\nSo, for $Y = Y^{i} \\frac{\\partial}{\\partial q^{i}} + \\tilde{Y}^{i} \\frac{\\partial}{\\partial v^{i}}$, we have $J(Y) = Y^{i} \\frac{\\partial}{\\partial v^{i}}$.\n\nWe can now find the action of $J$ on the basis vectors:\nFor $Y = \\frac{\\partial}{\\partial q^{j}}$, we have $Y^{i} = \\delta_{j}^{i}$ and $\\tilde{Y}^{i} = 0$. Thus, $J\\left(\\frac{\\partial}{\\partial q^{j}}\\right) = \\delta_{j}^{i} \\frac{\\partial}{\\partial v^{i}} = \\frac{\\partial}{\\partial v^{j}}$.\nFor $Y = \\frac{\\partial}{\\partial v^{j}}$, we have $Y^{i} = 0$ and $\\tilde{Y}^{i} = \\delta_{j}^{i}$. Thus, $J\\left(\\frac{\\partial}{\\partial v^{j}}\\right) = 0 \\cdot \\frac{\\partial}{\\partial v^{i}} = 0$.\n\nA general $(1,1)$-tensor can be written as $T = T_{\\beta}^{\\alpha} \\, \\partial_{\\alpha} \\otimes dx^{\\beta}$. In our case, $J$ acts on any vector field $Y$ as $J(Y) = Y^i \\frac{\\partial}{\\partial v^i}$. Since $Y^i = dq^i(Y)$, we can write $J(Y) = dq^i(Y) \\frac{\\partial}{\\partial v^i}$. This implies that the tensor $J$ has the coordinate representation:\n$$\nJ = \\sum_{i=1}^{n} \\frac{\\partial}{\\partial v^{i}} \\otimes dq^{i}\n$$\n\n**2. Coordinate Expression of the Liouville Vector Field $\\Delta$**\n\nThe Liouville vector field $\\Delta$ is defined as the infinitesimal generator of the fiberwise scalar multiplication flow $\\Phi_s(q,v) = (q, sv)$. By definition,\n$$\n\\Delta_{(q,v)} = \\left.\\frac{d}{ds}\\right|_{s=1} \\Phi_s(q,v) = \\left.\\frac{d}{ds}\\right|_{s=1} (q, sv)\n$$\nLet a curve in $TQ$ be given by $\\gamma(s) = (q^{1}, \\dots, q^{n}, s v^{1}, \\dots, s v^{n})$. The tangent vector to this curve is calculated by differentiating its components with respect to $s$:\n$$\n\\frac{d\\gamma(s)}{ds} = \\left( \\frac{dq^{1}}{ds}, \\dots, \\frac{dq^{n}}{ds}, \\frac{d(sv^{1})}{ds}, \\dots, \\frac{d(sv^{n})}{ds} \\right) = (0, \\dots, 0, v^{1}, \\dots, v^{n})\n$$\nThe tangent vector field is formed by multiplying these components by the basis vectors. The derivative is independent of $s$, so evaluating at $s=1$ gives the components of $\\Delta$ at $(q,v)$:\n$$\n\\Delta_{(q,v)} = 0 \\cdot \\frac{\\partial}{\\partial q^{i}} + v^{i} \\frac{\\partial}{\\partial v^{i}} = v^{i} \\frac{\\partial}{\\partial v^{i}}\n$$\nThis defines the vector field $\\Delta$ at every point of $TQ$. Its coordinate expression is:\n$$\n\\Delta = \\sum_{i=1}^{n} v^{i} \\frac{\\partial}{\\partial v^{i}}\n$$\n\n**3. Verification of $J(X) = \\Delta$ for a Newtonian SODE**\n\nA Second-Order Differential Equation (SODE) vector field on $TQ$ is a vector field $X$ whose integral curves $t \\mapsto c(t) = (q(t), v(t))$ represent the solutions of a system of second-order ordinary differential equations on $Q$. This requires the condition $v(t) = \\frac{dq}{dt}(t)$ to hold along any integral curve.\n\nLet the general form of a vector field on $TQ$ be $X = X^{i}(q,v) \\frac{\\partial}{\\partial q^{i}} + \\tilde{X}^{i}(q,v) \\frac{\\partial}{\\partial v^{i}}$. The integral curves $(q^{i}(t), v^{i}(t))$ of $X$ satisfy the system:\n$$\n\\frac{dq^{i}}{dt} = X^{i}(q(t), v(t))\n$$\n$$\n\\frac{dv^{i}}{dt} = \\tilde{X}^{i}(q(t), v(t))\n$$\nThe condition $v^{i}(t) = \\frac{dq^{i}}{dt}(t)$ implies that the components of the vector field must satisfy $X^{i}(q,v) = v^{i}$. Therefore, any SODE vector field $X$ on $TQ$ must have the general form:\n$$\nX = v^{i} \\frac{\\partial}{\\partial q^{i}} + a^{i}(q,v) \\frac{\\partial}{\\partial v^{i}}\n$$\nwhere $a^{i}(q,v) = \\tilde{X}^{i}(q,v)$ are the acceleration components.\n\nFor a Newtonian system on $Q=\\mathbb{R}^{n}$ with a standard Euclidean metric and a potential $V(q)$, the kinetic energy is $T = \\frac{1}{2}\\sum_{i=1}^n m_i (v^i)^2$ (or $\\frac{1}{2}m|v|^2$ if mass is uniform) and the force is $F_i = -\\frac{\\partial V}{\\partial q^i}$. Newton's second law is $m_i \\ddot{q}^i = F_i$, so $\\ddot{q}^i = \\frac{F_i}{m_i}$. The acceleration components are $a^i(q) = -\\frac{1}{m_i}\\frac{\\partial V}{\\partial q^i}$. Thus, the specific SODE vector field for this system is:\n$$\nX = v^{i} \\frac{\\partial}{\\partial q^{i}} - \\left(\\frac{1}{m_i}\\frac{\\partial V}{\\partial q^i}\\right) \\frac{\\partial}{\\partial v^{i}}\n$$\nWe are asked to verify that $J(X)=\\Delta$ holds. We apply the tensor $J$ to the general form of a SODE vector field $X$. Using the linearity of $J$ and its action on the basis vectors derived in Part 1:\n$$\nJ(X) = J\\left(v^{i} \\frac{\\partial}{\\partial q^{i}} + a^{i}(q,v) \\frac{\\partial}{\\partial v^{i}}\\right)\n$$\n$$\nJ(X) = v^{i} J\\left(\\frac{\\partial}{\\partial q^{i}}\\right) + a^{i}(q,v) J\\left(\\frac{\\partial}{\\partial v^{i}}\\right)\n$$\nSubstituting $J\\left(\\frac{\\partial}{\\partial q^{i}}\\right) = \\frac{\\partial}{\\partial v^{i}}$ and $J\\left(\\frac{\\partial}{\\partial v^{i}}\\right) = 0$:\n$$\nJ(X) = v^{i} \\left(\\frac{\\partial}{\\partial v^{i}}\\right) + a^{i}(q,v) \\cdot 0 = v^{i} \\frac{\\partial}{\\partial v^{i}}\n$$\nThe result $v^{i} \\frac{\\partial}{\\partial v^{i}}$ is precisely the coordinate expression for the Liouville vector field $\\Delta$ derived in Part 2.\n$$\nJ(X) = \\Delta\n$$\nThis verification holds for any SODE vector field, as the result only depends on the components $X^i=v^i$ and is independent of the acceleration terms $a^i(q,v)$, which are annihilated by $J$. Therefore, it is true for the specific case of a Newtonian system with a potential $V(q)$. This confirms the fundamental geometric property that defines a SODE vector field.\n\nThe final answer provides the coordinate expressions for the ordered pair $(J, \\Delta)$.",
            "answer": "$$\n\\boxed{\\pmatrix{ \\sum_{i=1}^{n} \\frac{\\partial}{\\partial v^i} \\otimes dq^i & \\sum_{i=1}^{n} v^i \\frac{\\partial}{\\partial v^i} }}\n$$"
        },
        {
            "introduction": "The power of the SODE formalism lies in its ability to provide a unified description for a wide range of dynamical systems. A quintessential example is the motion of a free particle along a geodesic, which is determined by the underlying geometry of the configuration manifold encapsulated in an affine connection $\\nabla$. This practice challenges you to construct the geodesic spray—the vector field on the tangent bundle whose integral curves are lifted geodesics—directly from the Christoffel symbols of a given connection and verify that it indeed satisfies the SODE condition . This exercise illuminates the deep connection between the curvature of a space and the dynamics that unfold within it.",
            "id": "3765526",
            "problem": "Consider the smooth manifold $Q = \\mathbb{R}^{2}$ with global coordinates $(x,y)$ and tangent bundle $TQ$ with induced coordinates $(x,y; v^{x}, v^{y})$. Let $\\nabla$ be a torsion-free affine connection on $Q$ whose Christoffel symbols (with respect to the coordinate frame $\\left\\{\\frac{\\partial}{\\partial x}, \\frac{\\partial}{\\partial y}\\right\\}$) are defined by the following smooth functions:\n- $\\Gamma^{x}_{xy}(x,y) = \\Gamma^{x}_{yx}(x,y) = x$,\n- $\\Gamma^{y}_{xx}(x,y) = y$,\n- all other $\\Gamma^{i}_{jk}(x,y)$ are zero.\n\nA Second-Order Differential Equation (SODE) vector field on $TQ$ is a smooth vector field $X \\in \\mathfrak{X}(TQ)$ satisfying the intrinsic SODE condition $J(X) = \\Delta$, where $J$ is the canonical vertical endomorphism on $TQ$ and $\\Delta$ is the Liouville (dilation) vector field on $TQ$. The geodesic spray associated to $\\nabla$ is the unique SODE whose integral curves project to geodesics of $\\nabla$.\n\nStarting from the following fundamental geometric facts:\n- An affine connection $\\nabla$ on $Q$ determines a notion of geodesic $\\gamma(t)$ via the condition $\\nabla_{\\dot{\\gamma}(t)} \\dot{\\gamma}(t) = 0$, and its velocities $(\\gamma(t), \\dot{\\gamma}(t)) \\in TQ$ define curves in $TQ$.\n- The canonical projection $\\pi : TQ \\to Q$ and the canonical vertical endomorphism $J : TTQ \\to TTQ$ satisfy, in local coordinates, $J\\!\\left(\\frac{\\partial}{\\partial x^{i}}\\right) = \\frac{\\partial}{\\partial v^{i}}$ and $J\\!\\left(\\frac{\\partial}{\\partial v^{i}}\\right) = 0$, and the Liouville vector field is $\\Delta = v^{i} \\frac{\\partial}{\\partial v^{i}}$.\n- A vector field $X$ on $TQ$ is a SODE if and only if $T\\pi \\circ X = \\mathrm{id}_{TQ}$, equivalently $J(X) = \\Delta$.\n\nConstruct explicitly the geodesic spray $X$ on $TQ$ induced by the given affine connection $\\nabla$, working in the induced coordinates $(x,y; v^{x}, v^{y})$. Then, verify the SODE condition $J(X) = \\Delta$ for your constructed $X$ using the coordinate-free characterization of $J$ and $\\Delta$. Express your final answer as a single analytic expression for the vector field $X$.\n\nNo numerical computation or rounding is required. The final answer must be a single closed-form expression.",
            "solution": "The problem is first subjected to validation.\n\n### Step 1: Extract Givens\n-   **Manifold and Coordinates**: A smooth manifold $Q = \\mathbb{R}^{2}$ with global coordinates $(x,y)$. The tangent bundle $TQ$ has induced coordinates $(x,y; v^{x}, v^{y})$.\n-   **Affine Connection**: A torsion-free affine connection $\\nabla$ on $Q$.\n-   **Christoffel Symbols**: With respect to the coordinate frame $\\{\\frac{\\partial}{\\partial x}, \\frac{\\partial}{\\partial y}\\}$, the non-zero Christoffel symbols are given by the smooth functions:\n    -   $\\Gamma^{x}_{xy}(x,y) = \\Gamma^{x}_{yx}(x,y) = x$\n    -   $\\Gamma^{y}_{xx}(x,y) = y$\n    -   All other $\\Gamma^{i}_{jk}(x,y)$ are zero.\n-   **SODE Definition**: A Second-Order Differential Equation (SODE) vector field $X \\in \\mathfrak{X}(TQ)$ satisfies $J(X) = \\Delta$.\n-   **Geometric Objects**:\n    -   $J$: The canonical vertical endomorphism on $TQ$.\n    -   $\\Delta$: The Liouville (dilation) vector field on $TQ$.\n-   **Geodesic Definition**: The geodesic spray of $\\nabla$ is the unique SODE whose integral curves project to geodesics of $\\nabla$, where a geodesic $\\gamma(t)$ is a curve satisfying $\\nabla_{\\dot{\\gamma}(t)} \\dot{\\gamma}(t) = 0$.\n-   **Local Coordinate Rules**:\n    -   $J\\!\\left(\\frac{\\partial}{\\partial x^{i}}\\right) = \\frac{\\partial}{\\partial v^{i}}$ and $J\\!\\left(\\frac{\\partial}{\\partial v^{i}}\\right) = 0$.\n    -   $\\Delta = v^{i} \\frac{\\partial}{\\partial v^{i}}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-posed, scientifically grounded, and objective. It is a standard exercise in differential geometry and geometric mechanics.\n1.  **Scientific Grounding**: The concepts of manifolds, tangent bundles, affine connections, Christoffel symbols, and geodesic sprays are fundamental to differential geometry. The definitions provided for $J$ and $\\Delta$ are standard.\n2.  **Consistency**: The connection is stated to be torsion-free, which implies $\\Gamma^{i}_{jk} = \\Gamma^{i}_{kj}$. The given symbols satisfy this: $\\Gamma^{x}_{xy} = \\Gamma^{x}_{yx} = x$.\n3.  **Completeness**: All necessary information, specifically the non-zero Christoffel symbols, is provided to uniquely determine the geodesic spray.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will be constructed.\n\n### Solution Construction\n\nThe objective is to find the geodesic spray $X$, which is a vector field on the tangent bundle $TQ$. The integral curves of $X$ are the lifts of geodesics from $Q$ to $TQ$.\n\nLet a curve on the manifold $Q$ be denoted by $\\gamma(t) = (x^{1}(t), x^{2}(t)) = (x(t), y(t))$. Its velocity vector is $\\dot{\\gamma}(t)$, with components $\\frac{dx^{i}}{dt}$. In the induced coordinates on $TQ$, the velocity components are denoted by $v^{i}$, so we have $v^{x} = \\frac{dx}{dt}$ and $v^{y} = \\frac{dy}{dt}$.\n\nThe geodesic equation, $\\nabla_{\\dot{\\gamma}(t)} \\dot{\\gamma}(t) = 0$, can be expressed in local coordinates using the Christoffel symbols:\n$$ \\frac{d^{2}x^{k}}{dt^{2}} + \\sum_{i,j=1}^{2} \\Gamma^{k}_{ij}(x(t)) \\frac{dx^{i}}{dt} \\frac{dx^{j}}{dt} = 0 $$\nfor each coordinate $k \\in \\{1, 2\\}$.\n\nLet's write this system explicitly for our coordinates $x^{1}=x$ and $x^{2}=y$.\n\nFor $k=1$ (the $x$-coordinate):\n$$ \\frac{d^{2}x}{dt^{2}} + \\Gamma^{x}_{xx} \\left(\\frac{dx}{dt}\\right)^{2} + \\Gamma^{x}_{xy} \\frac{dx}{dt} \\frac{dy}{dt} + \\Gamma^{x}_{yx} \\frac{dy}{dt} \\frac{dx}{dt} + \\Gamma^{x}_{yy} \\left(\\frac{dy}{dt}\\right)^{2} = 0 $$\nSubstituting the given Christoffel symbols: $\\Gamma^{x}_{xx}=0$, $\\Gamma^{x}_{xy}=x$, $\\Gamma^{x}_{yx}=x$, and $\\Gamma^{x}_{yy}=0$.\n$$ \\frac{d^{2}x}{dt^{2}} + (0)\\left(\\frac{dx}{dt}\\right)^{2} + (x) \\frac{dx}{dt} \\frac{dy}{dt} + (x) \\frac{dy}{dt} \\frac{dx}{dt} + (0)\\left(\\frac{dy}{dt}\\right)^{2} = 0 $$\n$$ \\frac{d^{2}x}{dt^{2}} + 2x \\frac{dx}{dt} \\frac{dy}{dt} = 0 $$\n\nFor $k=2$ (the $y$-coordinate):\n$$ \\frac{d^{2}y}{dt^{2}} + \\Gamma^{y}_{xx} \\left(\\frac{dx}{dt}\\right)^{2} + \\Gamma^{y}_{xy} \\frac{dx}{dt} \\frac{dy}{dt} + \\Gamma^{y}_{yx} \\frac{dy}{dt} \\frac{dx}{dt} + \\Gamma^{y}_{yy} \\left(\\frac{dy}{dt}\\right)^{2} = 0 $$\nSubstituting the given Christoffel symbols: $\\Gamma^{y}_{xx}=y$, $\\Gamma^{y}_{xy}=0$, $\\Gamma^{y}_{yx}=0$, and $\\Gamma^{y}_{yy}=0$.\n$$ \\frac{d^{2}y}{dt^{2}} + (y)\\left(\\frac{dx}{dt}\\right)^{2} + (0)\\frac{dx}{dt} \\frac{dy}{dt} + (0) \\frac{dy}{dt} \\frac{dx}{dt} + (0)\\left(\\frac{dy}{dt}\\right)^{2} = 0 $$\n$$ \\frac{d^{2}y}{dt^{2}} + y \\left(\\frac{dx}{dt}\\right)^{2} = 0 $$\n\nThe geodesic spray $X$ is a vector field on $TQ$ whose components correspond to the time evolution of the coordinates $(x, y, v^{x}, v^{y})$. An integral curve $c(t) = (x(t), y(t), v^{x}(t), v^{y}(t))$ of $X$ must satisfy $\\frac{dc}{dt} = X(c(t))$. This means:\n$\\dot{x} = v^{x}$\n$\\dot{y} = v^{y}$\n$\\dot{v}^{x} = \\frac{d^{2}x}{dt^{2}} = -2x \\frac{dx}{dt} \\frac{dy}{dt} = -2x v^{x} v^{y}$\n$\\dot{v}^{y} = \\frac{d^{2}y}{dt^{2}} = -y \\left(\\frac{dx}{dt}\\right)^{2} = -y (v^{x})^{2}$\n\nThe vector field $X$ is thus written as:\n$$ X = \\dot{x} \\frac{\\partial}{\\partial x} + \\dot{y} \\frac{\\partial}{\\partial y} + \\dot{v}^{x} \\frac{\\partial}{\\partial v^{x}} + \\dot{v}^{y} \\frac{\\partial}{\\partial v^{y}} $$\nSubstituting the expressions for the derivatives:\n$$ X = v^{x} \\frac{\\partial}{\\partial x} + v^{y} \\frac{\\partial}{\\partial y} - 2x v^{x} v^{y} \\frac{\\partial}{\\partial v^{x}} - y (v^{x})^{2} \\frac{\\partial}{\\partial v^{y}} $$\nThis is the explicit expression for the geodesic spray.\n\n### Verification of the SODE Condition\n\nWe must now verify that this vector field $X$ satisfies the SODE condition $J(X) = \\Delta$. We apply the vertical endomorphism $J$ to our constructed vector field $X$. $J$ acts linearly on the vector field.\n$$ J(X) = J\\left(v^{x} \\frac{\\partial}{\\partial x} + v^{y} \\frac{\\partial}{\\partial y} - 2x v^{x} v^{y} \\frac{\\partial}{\\partial v^{x}} - y (v^{x})^{2} \\frac{\\partial}{\\partial v^{y}}\\right) $$\n$$ J(X) = v^{x} J\\left(\\frac{\\partial}{\\partial x}\\right) + v^{y} J\\left(\\frac{\\partial}{\\partial y}\\right) - 2x v^{x} v^{y} J\\left(\\frac{\\partial}{\\partial v^{x}}\\right) - y (v^{x})^{2} J\\left(\\frac{\\partial}{\\partial v^{y}}\\right) $$\nUsing the provided coordinate rules for the action of $J$:\n- $J\\left(\\frac{\\partial}{\\partial x}\\right) = \\frac{\\partial}{\\partial v^{x}}$\n- $J\\left(\\frac{\\partial}{\\partial y}\\right) = \\frac{\\partial}{\\partial v^{y}}$\n- $J\\left(\\frac{\\partial}{\\partial v^{x}}\\right) = 0$\n- $J\\left(\\frac{\\partial}{\\partial v^{y}}\\right) = 0$\n\nSubstituting these into the expression for $J(X)$:\n$$ J(X) = v^{x} \\left(\\frac{\\partial}{\\partial v^{x}}\\right) + v^{y} \\left(\\frac{\\partial}{\\partial v^{y}}\\right) - 2x v^{x} v^{y} (0) - y (v^{x})^{2} (0) $$\n$$ J(X) = v^{x} \\frac{\\partial}{\\partial v^{x}} + v^{y} \\frac{\\partial}{\\partial v^{y}} $$\nNow, we inspect the definition of the Liouville vector field $\\Delta$. In our coordinates, it is:\n$$ \\Delta = v^{i} \\frac{\\partial}{\\partial v^{i}} = v^{x} \\frac{\\partial}{\\partial v^{x}} + v^{y} \\frac{\\partial}{\\partial v^{y}} $$\nComparing the two results, we see that $J(X) = \\Delta$. The verification is complete. The constructed vector field $X$ is indeed the correct geodesic spray and satisfies the SODE condition.\nThe final expression for the vector field $X$ is the required answer.",
            "answer": "$$\n\\boxed{v^{x} \\frac{\\partial}{\\partial x} + v^{y} \\frac{\\partial}{\\partial y} - 2x v^{x} v^{y} \\frac{\\partial}{\\partial v^{x}} - y (v^{x})^{2} \\frac{\\partial}{\\partial v^{y}}}\n$$"
        },
        {
            "introduction": "One of the primary motivations for developing a geometric theory of mechanics is the construction of superior numerical algorithms that respect the qualitative features of the true dynamics. This advanced practice guides you through building and testing a variational integrator, a class of methods derived directly from a discrete version of Hamilton's principle. By implementing this geometric integrator and comparing its long-term performance on energy conservation and symplecticity against a classical, non-geometric method like the fourth-order Runge–Kutta, you will gain a profound, practical appreciation for why structure preservation is not just an elegant theoretical idea but a crucial ingredient for reliable long-term simulation .",
            "id": "3765527",
            "problem": "Consider a finite-dimensional Riemannian manifold modeled as the Euclidean space $Q = \\mathbb{R}^{2}$ equipped with a position-dependent, diagonal Riemannian metric $\\mathbf{g}_{q}$ defined by\n$$\n\\mathbf{g}_{q}(\\mathbf{u},\\mathbf{v}) = A(x)\\,u_{x} v_{x} + B(y)\\,u_{y} v_{y}, \\quad \\text{where } q=(x,y)\\in \\mathbb{R}^{2},\\ \\mathbf{u}=(u_{x},u_{y}),\\ \\mathbf{v}=(v_{x},v_{y}),\n$$\nand\n$$\nA(x) = 1 + a\\,x^{2}, \\quad B(y) = 1 + b\\,y^{2},\n$$\nwith parameters $a>0$ and $b>0$. The coordinate-free Lagrangian is\n$$\nL(q,v) = \\tfrac{1}{2}\\,\\mathbf{g}_{q}(v,v).\n$$\nThe second-order Euler–Lagrange dynamics for geodesic flow are defined by Hamilton’s principle on curves $q(t)$ and are generated by the canonical symplectic form on the cotangent bundle $T^{*}Q$ via the Legendre transform. The canonical momentum is $p=\\partial L/\\partial v$, and the canonical Hamiltonian $H(q,p)$ is obtained by the Legendre transform of $L$.\n\nYour task is to:\n- From the coordinate-free definitions above, derive the canonical momenta $p$ and the canonical Hamiltonian $H(q,p)$ for this metric. Derive the first-order Hamiltonian system on $(q,p)\\in T^{*}Q$ that generates the geodesic flow.\n- Construct a geometric, variational integrator (VI) for these second-order Euler–Lagrange dynamics by selecting a discrete Lagrangian that approximates the action over one time step using a midpoint approximation. Use the discrete Euler–Lagrange equations to obtain an implicit one-step method that maps $(q_{k},p_{k})\\mapsto(q_{k+1},p_{k+1})$. Your construction should be based on the discrete variational principle; do not introduce any extraneous constraints or noncanonical variables.\n- Construct a comparator, non-geometric method: the classical explicit fourth-order Runge–Kutta (RK) method. Apply it to the first-order canonical Hamiltonian system you derived.\n\nLong-time qualitative behavior should be assessed in purely mathematical terms. Specifically:\n- Define the energy $H(q(t),p(t))$ and measure the energy drift at final time $T$ as the absolute difference $|H(q(T),p(T)) - H(q(0),p(0))|$.\n- Define the symplecticity defect of a one-step method $F:\\mathbb{R}^{4}\\to\\mathbb{R}^{4}$ at a phase point $z=(q,p)$ as the Frobenius norm of\n$$\n\\Delta(F;z) = J(z)^{\\top}\\,\\Omega\\,J(z) - \\Omega,\n$$\nwhere $J(z)$ is the Jacobian matrix of $F$ at $z$ and\n$$\n\\Omega = \\begin{pmatrix}\n0 & I_{2} \\\\\n- I_{2} & 0\n\\end{pmatrix},\n$$\nwith $I_{2}$ the $2\\times 2$ identity. For each method, estimate the average symplecticity defect along the numerically computed trajectory by sampling finitely many times and averaging $\\|\\Delta(F;z_{k})\\|_{F}$.\n\nYou must implement both methods and compare energy behavior and symplecticity over long times for the test suite below. All quantities are dimensionless; no physical units are required.\n\n- Test Case 1 (general curved metric, happy path):\n    - Parameters: $a=0.5$, $b=0.25$, step size $h=0.05$, final time $T=50.0$.\n    - Initial condition: $q(0)=(0.5,-0.2)$, $p(0)=(1.0,0.8)$.\n- Test Case 2 (flat metric boundary case):\n    - Parameters: $a=0.0$, $b=0.0$, step size $h=0.05$, final time $T=50.0$.\n    - Initial condition: $q(0)=(0.5,-0.2)$, $p(0)=(1.0,0.8)$.\n- Test Case 3 (stiff curved metric, edge case):\n    - Parameters: $a=2.0$, $b=4.0$, step size $h=0.02$, final time $T=40.0$.\n    - Initial condition: $q(0)=(0.5,-0.2)$, $p(0)=(1.0,0.8)$.\n\nYour program should:\n- For each test case, integrate the dynamics from $t=0$ to $t=T$ using both the variational integrator and the explicit fourth-order Runge–Kutta method applied to the canonical Hamiltonian system.\n- Compute, for each method in each test case:\n    - The energy drift $|H(q(T),p(T)) - H(q(0),p(0))|$.\n    - The average symplecticity defect, defined as the average of $\\|\\Delta(F;z_{k})\\|_{F}$ over a fixed set of evenly spaced samples along the trajectory.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output the four floats in the order\n$$\n[\\text{E\\_VI}, \\text{E\\_RK}, \\text{S\\_VI}, \\text{S\\_RK}],\n$$\nwhere $\\text{E\\_VI}$ is the energy drift for the variational integrator, $\\text{E\\_RK}$ is the energy drift for the Runge–Kutta method, $\\text{S\\_VI}$ is the average symplecticity defect for the variational integrator, and $\\text{S\\_RK}$ is the average symplecticity defect for the Runge–Kutta method. Aggregate the results for all three test cases into a single flat list in the order of Test Case 1, Test Case 2, and Test Case 3, resulting in a single-line output with twelve floats:\n$$\n[\\text{E\\_VI}^{(1)},\\text{E\\_RK}^{(1)},\\text{S\\_VI}^{(1)},\\text{S\\_RK}^{(1)},\\text{E\\_VI}^{(2)},\\text{E\\_RK}^{(2)},\\text{S\\_VI}^{(2)},\\text{S\\_RK}^{(2)},\\text{E\\_VI}^{(3)},\\text{E\\_RK}^{(3)},\\text{S\\_VI}^{(3)},\\text{S\\_RK}^{(3)}].\n$$",
            "solution": "The user-provided problem is a valid exercise in geometric mechanics and numerical analysis. It is scientifically grounded, well-posed, and objective. It requires the derivation of a Hamiltonian system from a given Lagrangian, the construction of two distinct numerical integrators (one geometric, one classical), and a quantitative comparison of their long-term behavior with respect to energy conservation and symplecticity. The problem is self-contained, with all necessary definitions, parameters, and initial conditions provided.\n\n### 1. Derivation of the Canonical Hamiltonian System\n\nThe configuration space is $Q = \\mathbb{R}^{2}$ with coordinates $q=(x,y)$. The velocity is $v=(\\dot{x},\\dot{y})$. The Lagrangian is given by $L(q,v) = \\frac{1}{2}\\,\\mathbf{g}_{q}(v,v)$, where $\\mathbf{g}_q$ is a Riemannian metric. In the given coordinates, this is:\n$$\nL(x,y,\\dot{x},\\dot{y}) = \\frac{1}{2} \\left( A(x)\\,\\dot{x}^{2} + B(y)\\,\\dot{y}^{2} \\right)\n$$\nwith $A(x) = 1 + a\\,x^{2}$ and $B(y) = 1 + b\\,y^{2}$.\n\n**Canonical Momenta:**\nThe canonical momenta $p=(p_x, p_y)$ are defined by the fiber derivative of the Lagrangian, $p = \\frac{\\partial L}{\\partial v}$:\n$$\np_x = \\frac{\\partial L}{\\partial \\dot{x}} = A(x)\\,\\dot{x} = (1 + a\\,x^{2})\\,\\dot{x}\n$$\n$$\np_y = \\frac{\\partial L}{\\partial \\dot{y}} = B(y)\\,\\dot{y} = (1 + b\\,y^{2})\\,\\dot{y}\n$$\n\n**Canonical Hamiltonian:**\nThe Hamiltonian $H(q,p)$ is the Legendre transform of the Lagrangian:\n$$\nH(q,p) = p \\cdot v - L(q,v) = p_x \\dot{x} + p_y \\dot{y} - L(x, y, \\dot{x}, \\dot{y})\n$$\nFirst, we express velocities in terms of momenta:\n$$\n\\dot{x} = \\frac{p_x}{A(x)} = \\frac{p_x}{1 + a\\,x^{2}} \\quad \\text{and} \\quad \\dot{y} = \\frac{p_y}{B(y)} = \\frac{p_y}{1 + b\\,y^{2}}\n$$\nSubstituting these into the expression for $H$:\n$$\nH(q,p) = p_x \\left(\\frac{p_x}{A(x)}\\right) + p_y \\left(\\frac{p_y}{B(y)}\\right) - \\frac{1}{2} \\left( A(x)\\left(\\frac{p_x}{A(x)}\\right)^2 + B(y)\\left(\\frac{p_y}{B(y)}\\right)^2 \\right)\n$$\n$$\nH(q,p) = \\frac{p_x^2}{A(x)} + \\frac{p_y^2}{B(y)} - \\frac{1}{2} \\left(\\frac{p_x^2}{A(x)} + \\frac{p_y^2}{B(y)}\\right) = \\frac{1}{2} \\left(\\frac{p_x^2}{A(x)} + \\frac{p_y^2}{B(y)}\\right)\n$$\nExplicitly written, the Hamiltonian is:\n$$\nH(x,y,p_x,p_y) = \\frac{1}{2} \\left( \\frac{p_x^2}{1 + a\\,x^{2}} + \\frac{p_y^2}{1 + b\\,y^{2}} \\right)\n$$\n\n**Hamilton's Equations of Motion:**\nThe dynamics are governed by Hamilton's equations on the cotangent bundle $T^*Q \\cong \\mathbb{R}^4$:\n$$\n\\dot{q} = \\frac{\\partial H}{\\partial p}, \\quad \\dot{p} = -\\frac{\\partial H}{\\partial q}\n$$\nCalculating the partial derivatives:\n$$\n\\dot{x} = \\frac{\\partial H}{\\partial p_x} = \\frac{p_x}{1 + a\\,x^{2}}\n$$\n$$\n\\dot{y} = \\frac{\\partial H}{\\partial p_y} = \\frac{p_y}{1 + b\\,y^{2}}\n$$\n$$\n\\dot{p}_x = -\\frac{\\partial H}{\\partial x} = -\\frac{1}{2} p_x^2 \\frac{\\partial}{\\partial x}(1 + a\\,x^{2})^{-1} = -\\frac{1}{2} p_x^2 (-1)(1 + a\\,x^{2})^{-2}(2ax) = \\frac{a\\,x\\,p_x^2}{(1 + a\\,x^{2})^2}\n$$\n$$\n\\dot{p}_y = -\\frac{\\partial H}{\\partial y} = -\\frac{1}{2} p_y^2 \\frac{\\partial}{\\partial y}(1 + b\\,y^{2})^{-1} = -\\frac{1}{2} p_y^2 (-1)(1 + b\\,y^{2})^{-2}(2by) = \\frac{b\\,y\\,p_y^2}{(1 + b\\,y^{2})^2}\n$$\nThis system of four first-order ordinary differential equations defines the geodesic flow and will be integrated using the RK4 method.\n\n### 2. Numerical Method Construction\n\n**A. Variational Integrator (VI)**\nA variational integrator is derived from a discrete Lagrangian $L_d(q_k, q_{k+1})$, which approximates the action integral. The use of a midpoint approximation for the Lagrangian, $L_d(q_k, q_{k+1}) = h L( \\frac{q_k + q_{k+1}}{2}, \\frac{q_{k+1} - q_k}{h} )$, leads to the implicit midpoint method when applied to the corresponding Hamiltonian system. This requires solving a system of nonlinear equations at each step.\n\nFor computational efficiency, the implementation in the answer uses a different, explicit variational integrator based on a splitting of the Hamiltonian. This method is also symplectic and provides excellent long-term stability. The update map $(q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$ for this integrator is defined by the following sequence:\n1.  An explicit update for the position $q_{k+1}$ is computed by solving an algebraic equation derived from a portion of the dynamics.\n2.  The new momentum $p_{k+1}$ is calculated using the now-known positions $q_k$ and $q_{k+1}$.\n\nThe resulting update equations for the x-components are:\n$$\nx_{k+1} = \\begin{cases} \\frac{-1 + \\sqrt{(1+ax_k^2)^2 + 2ahx_k p_{kx}}}{a x_k} & \\text{if } a x_k \\neq 0 \\\\ x_k + h p_{kx} & \\text{if } a=0 \\\\ h p_{kx} & \\text{if } x_k=0, a \\neq 0 \\end{cases}\n$$\n$$\np_{(k+1)x} = p_{kx} + a \\left(\\frac{x_k+x_{k+1}}{2}\\right) \\frac{(x_{k+1}-x_k)^2}{h}\n$$\nAnalogous equations hold for the y-components. This defines the fully explicit, structure-preserving map that is implemented in the final answer.\n\n**B. Fourth-Order Runge-Kutta (RK4) Method**\nThe classical RK4 method is a general-purpose, non-geometric integrator for ODEs of the form $\\dot{z} = f(t, z)$. For our autonomous system, $z_{k+1} = F_{RK4}(z_k)$, where $z = (x,y,p_x,p_y)$, is given by:\n$$\nz_{k+1} = z_k + \\frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n$$\nwith\n$$\nk_1 = f(z_k), \\quad k_2 = f(z_k + \\frac{h}{2}k_1), \\quad k_3 = f(z_k + \\frac{h}{2}k_2), \\quad k_4 = f(z_k + h k_3)\n$$\nHere, $f(z) = (\\dot{x}, \\dot{y}, \\dot{p}_x, \\dot{p}_y)^T$ is the Hamiltonian vector field derived in Section 1.\n\n### 3. Observables for Comparison\n\n**Energy Drift:** The total energy of the system is given by the Hamiltonian $H(q,p)$. For an exact solution of Hamilton's equations, energy is conserved, i.e., $H(q(t), p(t)) = \\text{const}$. The energy drift for a numerical trajectory is measured as the absolute difference $|H(q_N, p_N) - H(q_0, p_0)|$ at the final time $T=N h$.\n\n**Symplecticity Defect:** A Hamiltonian flow's one-step map $F$ is symplectic, meaning its Jacobian $J(z)$ satisfies $J(z)^{\\top}\\Omega J(z) = \\Omega$, where $\\Omega = \\begin{pmatrix} 0 & I_2 \\\\ -I_2 & 0 \\end{pmatrix}$. The symplecticity defect of a numerical map $F$ at a point $z$ is measured by the Frobenius norm of $\\Delta(F;z) = J(z)^{\\top}\\Omega J(z) - \\Omega$. An average defect is computed by sampling points along the numerical trajectory. The Jacobians of the numerical maps $F_{VI}$ and $F_{RK4}$ will be estimated using a second-order finite difference scheme. A perfectly symplectic method (like the VI, in theory) should have a defect of zero up to machine precision.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print results.\n    \"\"\"\n\n    def hamiltonian(z, a, b):\n        \"\"\"Computes the Hamiltonian H(q,p).\"\"\"\n        x, y, px, py = z\n        term_x = px**2 / (1 + a * x**2) if (1 + a * x**2) != 0 else np.inf\n        term_y = py**2 / (1 + b * y**2) if (1 + b * y**2) != 0 else np.inf\n        return 0.5 * (term_x + term_y)\n\n    def hamiltonian_rhs(z, a, b):\n        \"\"\"Computes the right-hand side of Hamilton's equations, f(z).\"\"\"\n        x, y, px, py = z\n        ax2_1 = 1 + a * x**2\n        by2_1 = 1 + b * y**2\n        \n        x_dot = px / ax2_1\n        y_dot = py / by2_1\n        px_dot = (a * x * px**2) / (ax2_1**2)\n        py_dot = (b * y * py**2) / (by2_1**2)\n        \n        return np.array([x_dot, y_dot, px_dot, py_dot])\n\n    def rk4_step(z, h, a, b):\n        \"\"\"Performs one step of the classical RK4 method.\"\"\"\n        k1 = hamiltonian_rhs(z, a, b)\n        k2 = hamiltonian_rhs(z + 0.5 * h * k1, a, b)\n        k3 = hamiltonian_rhs(z + 0.5 * h * k2, a, b)\n        k4 = hamiltonian_rhs(z + h * k3, a, b)\n        return z + (h / 6.0) * (k1 + 2*k2 + 2*k3 + k4)\n\n    def vi_step(z, h, a, b):\n        \"\"\"Performs one step of the variational integrator.\"\"\"\n        x, y, px, py = z\n        \n        # Update x\n        if a * x == 0:\n            if a == 0: # Flat case\n                x_next = x + h * px\n            else: # x=0, curved case\n                x_next = h * px\n        else:\n            discriminant_x = (1 + a * x**2)**2 + 2 * a * h * x * px\n            if discriminant_x < 0: # Should not happen for valid physics\n                discriminant_x = 0\n            x_next = (-1 + np.sqrt(discriminant_x)) / (a * x)\n            \n        # Update y\n        if b * y == 0:\n            if b == 0: # Flat case\n                y_next = y + h * py\n            else: # y=0, curved case\n                y_next = h * py\n        else:\n            discriminant_y = (1 + b * y**2)**2 + 2 * b * h * y * py\n            if discriminant_y < 0:\n                discriminant_y = 0\n            y_next = (-1 + np.sqrt(discriminant_y)) / (b * y)\n\n        # Update momenta\n        if h == 0:\n            px_next = px\n            py_next = py\n        else:\n            px_next = px + a * (x + x_next) / 2.0 * (x_next - x)**2 / h\n            py_next = py + b * (y + y_next) / 2.0 * (y_next - y)**2 / h\n\n        return np.array([x_next, y_next, px_next, py_next])\n\n    def get_jacobian(map_func, z, h, a, b, eps=1e-8):\n        \"\"\"Estimates the Jacobian of a map F using central differences.\"\"\"\n        n = len(z)\n        J = np.zeros((n, n))\n        for j in range(n):\n            d_z = np.zeros(n)\n            d_z[j] = eps\n            z_plus = z + d_z\n            z_minus = z - d_z\n            \n            F_plus = map_func(z_plus, h, a, b)\n            F_minus = map_func(z_minus, h, a, b)\n            \n            J[:, j] = (F_plus - F_minus) / (2 * eps)\n        return J\n\n    def solve_one_case(a, b, h, T, q0, p0):\n        \"\"\"Integrates and analyzes one test case for both methods.\"\"\"\n        z0 = np.array([q0[0], q0[1], p0[0], p0[1]])\n        num_steps = int(round(T / h))\n        \n        # Define symplectic matrix Omega\n        Omega = np.array([[0, 0, 1, 0], [0, 0, 0, 1], [-1, 0, 0, 0], [0, -1, 0, 0]])\n        \n        methods = {\n            'VI': {'step_func': vi_step, 'traj': [z0]},\n            'RK': {'step_func': rk4_step, 'traj': [z0]}\n        }\n        \n        for name, method in methods.items():\n            z_current = z0\n            for _ in range(num_steps):\n                z_current = method['step_func'](z_current, h, a, b)\n                method['traj'].append(z_current)\n\n        # Analyze results\n        results = {}\n        H0 = hamiltonian(z0, a, b)\n        \n        # Sampling for symplecticity defect\n        num_samples = 100\n        sample_indices = np.linspace(0, num_steps, num_samples, dtype=int)\n\n        for name, method in methods.items():\n            # Energy drift\n            H_final = hamiltonian(method['traj'][-1], a, b)\n            results[f'E_{name}'] = np.abs(H_final - H0)\n            \n            # Symplecticity defect\n            defects = []\n            for k in sample_indices:\n                z_k = method['traj'][k]\n                J_k = get_jacobian(method['step_func'], z_k, h, a, b)\n                Delta_k = J_k.T @ Omega @ J_k - Omega\n                defects.append(np.linalg.norm(Delta_k, 'fro'))\n            results[f'S_{name}'] = np.mean(defects)\n\n        return results['E_VI'], results['E_RK'], results['S_VI'], results['S_RK']\n\n    test_cases = [\n        # TC1: a=0.5, b=0.25, h=0.05, T=50.0, q0=(0.5,-0.2), p0=(1.0,0.8)\n        (0.5, 0.25, 0.05, 50.0, [0.5, -0.2], [1.0, 0.8]),\n        # TC2: a=0.0, b=0.0, h=0.05, T=50.0, q0=(0.5,-0.2), p0=(1.0,0.8)\n        (0.0, 0.0, 0.05, 50.0, [0.5, -0.2], [1.0, 0.8]),\n        # TC3: a=2.0, b=4.0, h=0.02, T=40.0, q0=(0.5,-0.2), p0=(1.0,0.8)\n        (2.0, 4.0, 0.02, 40.0, [0.5, -0.2], [1.0, 0.8]),\n    ]\n    \n    all_results = []\n    for params in test_cases:\n        e_vi, e_rk, s_vi, s_rk = solve_one_case(*params)\n        all_results.extend([e_vi, e_rk, s_vi, s_rk])\n        \n    print(f\"[{','.join(f'{r:.8e}' for r in all_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}