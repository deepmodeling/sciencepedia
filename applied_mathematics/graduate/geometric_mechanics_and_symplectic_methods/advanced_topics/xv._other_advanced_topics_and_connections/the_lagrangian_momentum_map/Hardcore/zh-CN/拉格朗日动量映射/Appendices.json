{
    "hands_on_practices": [
        {
            "introduction": "拉格朗日力学中的一个核心洞见是，对称性与守恒量之间存在深刻联系。一个看似违反直觉的例子是，即使系统的拉格朗日量显式含时（通常意味着能量不守恒），某些动量映射分量依然可以保持守恒。本练习将通过一个参数驱动的振子系统，引导您计算与平面旋转对称性相关的动量映射，并利用欧拉-拉格朗日方程证明，尽管系统参数在周期性变化，该动量映射（即角动量）仍然是一个不随时间改变的守恒量 。",
            "id": "3778435",
            "problem": "考虑一个参数驱动的平面振子，其位形空间为 $Q = \\mathbb{R}^{2}$，坐标为 $q = (x,y)$。其动力学由拉格朗日量 $L : TQ \\times \\mathbb{R} \\to \\mathbb{R}$ 给出：\n$$\nL(q,\\dot{q},t) = \\frac{1}{2} m \\left( \\dot{x}^{2} + \\dot{y}^{2} \\right) - \\frac{1}{2} k(t) \\left( x^{2} + y^{2} \\right),\n$$\n其中 $m > 0$ 是一个恒定的质量，$k(t) = k_{0} \\left( 1 + \\epsilon \\cos(\\omega t) \\right)$ 是一个周期性刚度，其常数 $k_{0} > 0$, $0  \\epsilon  1$ 且 $\\omega > 0$。单位圆群 $S^{1}$ 通过平面旋转作用于 $Q$，即对于 $\\theta \\in S^{1}$，其作用为 $R_{\\theta} \\cdot q$，其中 $R_{\\theta} \\in \\mathrm{SO}(2)$ 是旋转矩阵。\n\n使用几何力学的第一性原理，包括拉格朗日动量映射的定义和欧拉-拉格朗日方程，推导与 $S^{1}$ 对称性相关的动量映射，并计算其在给定周期性调制 $k(t)$ 下随时间的演化。设时间 $t=0$ 时的初始条件为 $q(0) = (x_{0}, y_{0})$ 和 $\\dot{q}(0) = (\\dot{x}_{0}, \\dot{y}_{0})$。\n\n给出相关的动量映射作为时间函数的最终表达式，用 $m$、$x_{0}$、$y_{0}$、$\\dot{x}_{0}$ 和 $\\dot{y}_{0}$ 表示。用国际单位制（SI单位）表示你的最终结果。如果演化是恒定的，最终答案必须是一个不依赖于 $t$ 的单一闭式符号表达式。",
            "solution": "问题陈述已经过验证，被认为是科学上合理的、适定的和客观的。这是几何力学领域内的一个正式问题。我们现在可以进行求解。\n\n该系统由拉格朗日量 $L : T\\mathbb{R}^{2} \\times \\mathbb{R} \\to \\mathbb{R}$ 描述，其表达式为\n$$\nL(q,\\dot{q},t) = \\frac{1}{2} m \\left( \\dot{x}^{2} + \\dot{y}^{2} \\right) - \\frac{1}{2} k(t) \\left( x^{2} + y^{2} \\right),\n$$\n其中 $q = (x,y)$ 且 $\\dot{q} = (\\dot{x}, \\dot{y})$。随时间变化的刚度为 $k(t) = k_{0} \\left( 1 + \\epsilon \\cos(\\omega t) \\right)$。\n\n对称群是圆群 $G = S^{1}$，通过旋转作用于位形空间 $Q = \\mathbb{R}^{2}$。一个元素 $\\theta \\in S^{1}$（我们可以将其等同于一个角度 $\\theta \\in [0, 2\\pi)$）通过映射 $\\Phi_{\\theta}: Q \\to Q$ 作用于点 $q=(x,y) \\in Q$，定义如下：\n$$\n\\Phi_{\\theta}(q) = R_{\\theta}q = \\begin{pmatrix} \\cos\\theta  -\\sin\\theta \\\\ \\sin\\theta  \\cos\\theta \\end{pmatrix} \\begin{pmatrix} x \\\\ y \\end{pmatrix} = \\begin{pmatrix} x\\cos\\theta - y\\sin\\theta \\\\ x\\sin\\theta + y\\cos\\theta \\end{pmatrix}.\n$$\n第一步是找到此作用的无穷小生成元。$S^{1}$ 的李代数是 $\\mathfrak{g} \\cong \\mathbb{R}$。我们选择一个基元，比如 $\\xi=1 \\in \\mathfrak{g}$。相应的无穷小生成元是 $Q$ 上的一个矢量场 $\\xi_{Q}$，由下式给出：\n$$\n\\xi_{Q}(q) = \\frac{d}{d\\theta}\\bigg|_{\\theta=0} \\Phi_{\\theta}(q) = \\frac{d}{d\\theta}\\bigg|_{\\theta=0} \\begin{pmatrix} x\\cos\\theta - y\\sin\\theta \\\\ x\\sin\\theta + y\\cos\\theta \\end{pmatrix} = \\begin{pmatrix} -y \\\\ x \\end{pmatrix}.\n$$\n用偏导数表示，该矢量场为 $\\xi_{Q} = -y \\frac{\\partial}{\\partial x} + x \\frac{\\partial}{\\partial y}$。\n\n拉格朗日动量映射 $J: TQ \\to \\mathfrak{g}^{*}$ 由其与李代数 $\\mathfrak{g}$ 元素的配对定义。对于生成元 $\\xi$，动量映射的分量 $J_{\\xi}$ 由以下公式给出：\n$$\nJ_{\\xi}(q, \\dot{q}) = \\left\\langle \\frac{\\partial L}{\\partial \\dot{q}}, \\xi_{Q}(q) \\right\\rangle,\n$$\n其中 $\\frac{\\partial L}{\\partial \\dot{q}}$ 是正则动量。由于 $\\mathfrak{g} \\cong \\mathbb{R}$，我们可以将动量映射 $J$ 等同于标量函数 $J_{\\xi=1}$。\n首先，我们计算动量：\n$$\np_x = \\frac{\\partial L}{\\partial \\dot{x}} = m\\dot{x}\n$$\n$$\np_y = \\frac{\\partial L}{\\partial \\dot{y}} = m\\dot{y}\n$$\n因此，$\\frac{\\partial L}{\\partial \\dot{q}} = (m\\dot{x}, m\\dot{y})$。\n那么动量映射就是标准的内积：\n$$\nJ(q, \\dot{q}) = \\langle (m\\dot{x}, m\\dot{y}), (-y, x) \\rangle = m\\dot{x}(-y) + m\\dot{y}(x) = m(x\\dot{y} - y\\dot{x}).\n$$\n这个表达式被认为是粒子绕原点的角动量。\n\n为了确定动量映射随时间的演化，我们计算其全时间导数 $\\frac{dJ}{dt}$，该计算是沿着满足欧拉-拉格朗日方程的轨迹 $(q(t), \\dot{q}(t))$ 进行的。\n$$\n\\frac{dJ}{dt} = \\frac{d}{dt} \\left[ m\\left(x(t)\\dot{y}(t) - y(t)\\dot{x}(t)\\right) \\right].\n$$\n使用乘积法则求导：\n$$\n\\frac{dJ}{dt} = m \\left( (\\dot{x}\\dot{y} + x\\ddot{y}) - (\\dot{y}\\dot{x} + y\\ddot{x}) \\right) = m(x\\ddot{y} - y\\ddot{x}).\n$$\n现在，我们必须从欧拉-拉格朗日方程中找到 $\\ddot{x}$ 和 $\\ddot{y}$ 的表达式：\n$$\n\\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{x}}\\right) - \\frac{\\partial L}{\\partial x} = 0\n$$\n$$\n\\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{y}}\\right) - \\frac{\\partial L}{\\partial y} = 0\n$$\n所需的导数为：\n$$\n\\frac{\\partial L}{\\partial x} = -k(t)x \\quad \\text{和} \\quad \\frac{\\partial L}{\\partial y} = -k(t)y.\n$$\n欧拉-拉格朗日方程变为：\n$$\n\\frac{d}{dt}(m\\dot{x}) - (-k(t)x) = 0 \\implies m\\ddot{x} = -k(t)x\n$$\n$$\n\\frac{d}{dt}(m\\dot{y}) - (-k(t)y) = 0 \\implies m\\ddot{y} = -k(t)y\n$$\n将这些关于 $\\ddot{x}$ 和 $\\ddot{y}$ 的表达式代入 $J$ 的时间导数中：\n$$\n\\frac{dJ}{dt} = m \\left( x\\left(-\\frac{k(t)}{m}y\\right) - y\\left(-\\frac{k(t)}{m}x\\right) \\right) = m \\left( -\\frac{k(t)}{m}xy + \\frac{k(t)}{m}yx \\right) = 0.\n$$\n由于 $\\frac{dJ}{dt} = 0$，动量映射 $J$ 是一个运动常数。这是诺特定理的直接推论。尽管拉格朗日量显式地依赖于时间，但旋转对称性本身不依赖于时间，并且对于任何固定的时间 $t$，拉格朗日量在这种对称性下都是不变的。势能 $V(q, t) = \\frac{1}{2} k(t) (x^2+y^2)$ 仅取决于到原点的径向距离，这使得力成为中心力，而对于中心力，角动量总是守恒的。\n\n动量映射的值在所有时间内都是恒定的，并由初始条件决定。在时间 $t=0$ 时，我们有 $q(0) = (x_0, y_0)$ 和 $\\dot{q}(0) = (\\dot{x}_0, \\dot{y}_0)$。因此，对于任何时间 $t$，动量映射为：\n$$\nJ(t) = J(0) = m(x_0 \\dot{y}_0 - y_0 \\dot{x}_0).\n$$\n最终表达式是一个由系统初始状态决定的常数。要求用国际单位制（SI单位）表示结果，意味着变量 $m, x_0, y_0, \\dot{x}_0, \\dot{y}_0$ 被假定以其各自的国际单位（千克、米、米每秒）进行测量，从而使结果的单位为千克·米平方每秒（$kg \\cdot m^{2}/s$），这是角动量的国际单位。",
            "answer": "$$\n\\boxed{m(x_0 \\dot{y}_0 - y_0 \\dot{x}_0)}\n$$"
        },
        {
            "introduction": "从简单的平面系统过渡到更复杂的刚体动力学，几何力学的方法展现出其强大的威力。重陀螺问题是分析力学中的一个经典范例，其构型空间为非交换群 $\\mathrm{SO}(3)$。本练习要求您将动量映射的理论应用于此系统，计算由围绕空间固定垂直轴的旋转对称性（即 $\\mathrm{SO}(2)$ 子群作用）所产生的守恒量 。通过此过程，您将实践如何在物体坐标系下表达对称性生成元并导出守恒的角动量分量，这是处理非交换对称性和半直积结构的关键一步。",
            "id": "3765899",
            "problem": "考虑一个重陀螺，其位形由特殊正交群 $\\mathrm{SO}(3)$ 描述，取向为 $R \\in \\mathrm{SO}(3)$，物体角速度为 $\\Omega \\in \\mathbb{R}^{3}$ (由 $\\widehat{\\Omega} = R^{-1} \\dot{R}$ 定义)，伴流参数为 $\\Gamma \\in \\mathbb{R}^{3}$ (由 $\\Gamma = R^{\\top} e_{3}$ 给出)，其中 $e_{3} \\in \\mathbb{R}^{3}$ 是沿竖直（空间固定）轴的单位向量。映射 $\\,\\widehat{\\cdot}\\, : \\mathbb{R}^{3} \\to \\mathfrak{so}(3)$ 是典范同构，对所有 $u, v \\in \\mathbb{R}^{3}$ 满足 $\\widehat{u} v = u \\times v$。约化的重陀螺拉格朗日量为\n$$\n\\ell(\\Omega, \\Gamma) = \\tfrac{1}{2}\\, \\Omega \\cdot \\mathbb{I} \\Omega \\;-\\; m g\\, \\chi \\cdot \\Gamma,\n$$\n其中 $\\mathbb{I}$ 是惯性张量（$\\mathbb{R}^{3}$ 上的对称正定线性映射），$m$ 是质量，$g$ 是重力加速度，$\\chi \\in \\mathbb{R}^{3}$ 是以物体坐标表示的从固定点到质心的向量。伴流参数的运动学约束为 $\\dot{\\Gamma} = -\\,\\Omega \\times \\Gamma$。\n\n作用于该位形的对称群是绕空间固定竖直轴 $e_{3}$ 旋转的子群 $\\mathrm{SO}(2) \\subset \\mathrm{SO}(3)$。该子群通过左乘作用于 $R$，即对于 $h \\in \\mathrm{SO}(2)$ 有 $h \\cdot R = h R$，并使 $\\Gamma$ 保持不变，即 $h \\cdot \\Gamma = \\Gamma$。该作用通过 $h \\cdot (R, \\dot{R}) = (h R, h \\dot{R})$ 提升至切丛。\n\n从以上定义和重陀螺拉格朗日量出发，并使用 Noether 定理中关于具有对称性的系统和半直积约化的标准原理，完成以下任务：\n\n1. 计算与 $\\mathrm{SO}(2)$ 的单参数子群 $h(s) = \\exp\\!\\big(s\\,\\widehat{e_{3}}\\big)$ 相关联的、在 $(R, \\Gamma)$ 上的无穷小生成元（基本向量场）。\n2. 计算与此 $\\mathrm{SO}(2)$ 对称性对应的守恒量（动量映射值），并完全用 $\\Omega$、$\\Gamma$ 和 $\\mathbb{I}$ 表示。\n\n你的最终答案必须同时包含无穷小生成元和守恒量。将最终答案表示为一个行矩阵，其顺序为：第一个元素等于在 $(R, \\Gamma)$ 上的无穷小生成元，第二个元素等于守恒量。无需进行数值计算，也无需四舍五入。最终答案中不应出现物理单位。任何角度描述均使用弧度。",
            "solution": "该问题陈述有效。这是一个几何力学中的适定问题，基于重陀螺和半直积约化的标准理论。其定义、约束和所要求的计算在科学上是合理的、完整的且表述一致的。我们将着手求解。\n\n问题要求两个量：指定的 $\\mathrm{SO}(2)$ 对称性作用的无穷小生成元，以及根据 Noether 定理导出的相应守恒量。\n\n**1. 无穷小生成元**\n\n系统的位形由对 $(R, \\Gamma) \\in \\mathrm{SO}(3) \\times \\mathbb{R}^3$ 描述。对称群为 $G = \\mathrm{SO}(2)$，被识别为 $\\mathrm{SO}(3)$ 中绕空间固定竖直轴 $e_3$ 旋转的子群。与此对称性对应的单参数子群由 $h(s) = \\exp(s\\,\\widehat{e_3})$ 给出，其中 $\\widehat{e_3}$ 是李代数 $\\mathfrak{so}(3)$ 中对应于 $e_3 \\in \\mathbb{R}^3$ 的元素。\n\n元素 $h \\in \\mathrm{SO}(2)$ 在点 $(R, \\Gamma)$ 上的作用定义如下：\n- 在 $R$ 上的作用：$h \\cdot R = hR$（左乘）。\n- 在 $\\Gamma$ 上的作用：$h \\cdot \\Gamma = \\Gamma$（单位作用）。\n\n与李代数元素 $\\xi = \\widehat{e_3} \\in \\mathfrak{so}(3)$ 相关联的作用的无穷小生成元是流形 $\\mathrm{SO}(3) \\times \\mathbb{R}^3$ 上的一个向量场。该向量场在点 $(R, \\Gamma)$ 处可通过对单参数子群 $h(s) = \\exp(s\\xi)$ 的作用在 $s=0$ 处求导得到。\n\n在点 $R$ 处，生成元在 $\\mathrm{SO}(3)$ 上的分量为：\n$$ \\xi_{\\mathrm{SO}(3)}(R) = \\left. \\frac{d}{ds} \\right|_{s=0} (h(s) \\cdot R) = \\left. \\frac{d}{ds} \\right|_{s=0} (\\exp(s\\widehat{e_3}) R) $$\n使用微分的乘法法则，我们得到：\n$$ \\xi_{\\mathrm{SO}(3)}(R) = \\left( \\left. \\frac{d}{ds} \\right|_{s=0} \\exp(s\\widehat{e_3}) \\right) R = \\widehat{e_3} R $$\n这是一个在 $T_R\\mathrm{SO}(3)$（即 $\\mathrm{SO}(3)$ 在 $R$ 点的切空间）中的切向量。\n\n在点 $\\Gamma$ 处，生成元在 $\\mathbb{R}^3$ 上的分量为：\n$$ \\xi_{\\mathbb{R}^3}(\\Gamma) = \\left. \\frac{d}{ds} \\right|_{s=0} (h(s) \\cdot \\Gamma) = \\left. \\frac{d}{ds} \\right|_{s=0} (\\Gamma) = 0 $$\n由于在 $\\Gamma$ 上的作用是平凡的，因此生成元在 $\\mathbb{R}^3$ 上是零向量场。\n\n将这些组合起来，在乘积空间 $\\mathrm{SO}(3) \\times \\mathbb{R}^3$ 的点 $(R, \\Gamma)$ 处的无穷小生成元是对 $(\\widehat{e_3} R, 0)$。\n\n**2. 守恒量（动量映射）**\n\n根据 Noether 定理，重陀螺拉格朗日量在 $\\mathrm{SO}(2)$ 对 $\\mathrm{SO}(3)$ 的左作用下的不变性保证了一个守恒量的存在。这个量是与该对称性相关联的动量映射的值。\n\n完整切丛 $T\\mathrm{SO}(3)$ 上的拉格朗日量由 $L(R, \\dot{R}) = \\ell(\\Omega, \\Gamma)$ 给出，其中 $\\Omega$ 和 $\\Gamma$ 是 $(R, \\dot{R})$ 的函数：\n$$ L(R, \\dot{R}) = \\frac{1}{2} (\\text{unhat}(R^{-1}\\dot{R})) \\cdot \\mathbb{I} (\\text{unhat}(R^{-1}\\dot{R})) - m g\\, \\chi \\cdot (R^{\\top} e_3) $$\n与李代数元素 $\\xi$ 相关联的守恒量由共轭动量与位形空间上作用的无穷小生成元的配对给出：$J_{\\xi} = \\langle \\frac{\\partial L}{\\partial \\dot{R}}, \\xi_{\\mathrm{SO}(3)}(R) \\rangle$。\n\n通常使用物体固定坐标系下的量更为方便。对于李群上的左不变系统，动量映射可以表示为物体坐标系中的动量 $\\Pi = \\frac{\\partial \\ell}{\\partial \\Omega}$ 与对称性生成元的物体坐标系表示的配对。\n\n首先，我们从约化拉格朗日量 $\\ell(\\Omega, \\Gamma) = \\frac{1}{2} \\Omega \\cdot \\mathbb{I} \\Omega - m g\\, \\chi \\cdot \\Gamma$ 计算物体动量 $\\Pi \\in \\mathbb{R}^3$。物体角速度 $\\Omega$ 的共轭动量是：\n$$ \\Pi = \\frac{\\partial \\ell}{\\partial \\Omega} = \\mathbb{I} \\Omega $$\n这是在物体固定坐标系中表示的角动量向量。\n\n接下来，我们寻找对称性生成元在物体坐标系中的表示。该对称性对应于绕空间固定轴 $e_3$ 的旋转。向量 $e_3$ 在物体坐标系中通过变换 $R^{-1}e_3$ 来表示。由于 $R \\in \\mathrm{SO}(3)$，其逆是其转置，即 $R^{-1} = R^{\\top}$。因此，对称轴的物体坐标系表示为 $R^{\\top}e_3$。\n根据问题陈述，我们已知伴流参数 $\\Gamma = R^{\\top}e_3$。因此，$\\Gamma$ 正是空间固定竖直轴在物体坐标系中的表示。\n\n守恒量是物体角动量 $\\Pi$ 与对称轴的物体坐标系表示 $\\Gamma$ 的点积：\n$$ p_3 = \\Pi \\cdot \\Gamma = (\\mathbb{I}\\Omega) \\cdot \\Gamma $$\n\n这个结果可以通过考虑空间角动量来验证。空间角动量向量是 $\\pi = R\\Pi = R\\mathbb{I}\\Omega$。对称性是关于固定空间轴 $e_3$ 的旋转。守恒量是空间角动量沿该轴的分量：\n$$ \\pi \\cdot e_3 = (R\\mathbb{I}\\Omega) \\cdot e_3 $$\n利用点积在正交变换下的性质 $\\langle u, v \\rangle = \\langle R^{\\top}u, R^{\\top}v \\rangle$，我们可以将其写为：\n$$ (R\\mathbb{I}\\Omega) \\cdot e_3 = \\langle R\\mathbb{I}\\Omega, e_3 \\rangle = \\langle \\mathbb{I}\\Omega, R^{\\top}e_3 \\rangle = (\\mathbb{I}\\Omega) \\cdot (R^{\\top}e_3) $$\n代入 $\\Gamma = R^{\\top}e_3$，我们得到相同的结果：\n$$ p_3 = (\\mathbb{I}\\Omega) \\cdot \\Gamma $$\n这个量表示总角动量的守恒竖直分量。\n\n所要求的两个量是无穷小生成元 $(\\widehat{e_3} R, 0)$ 和守恒量 $(\\mathbb{I}\\Omega) \\cdot \\Gamma$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} (\\widehat{e_3} R, 0)   (\\mathbb{I}\\Omega) \\cdot \\Gamma \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论的价值最终体现在其应用中，而动量映射在现代计算科学，特别是几何积分领域，扮演着至关重要的角色。本练习将引导您从连续的拉格朗日理论出发，构建一个用于开普勒问题的变分积分器，这是一种能够精确保持系统几何结构的数值方法 。您需要通过编程实现该算法，并数值验证离散诺特定理的威力：与标准数值方法不同，该积分器能够在一个极长的时间尺度上精确地保持离散的动量映射（角动量），同时能量误差也保持有界，从而实现卓越的长期稳定性。",
            "id": "3770966",
            "problem": "您需要实现一个自包含的程序，为平面开普勒问题构建一个变分积分器，然后对几个测试案例的角动量长期保持性和能量近似守恒性进行定量评估。数学和算法的推导必须从驻定作用量原理和离散变分原理出发，不得依赖任何预先封装的公式或隐藏的捷径。\n\n考虑一个单位质量的粒子在引力参数为 $\\mu  0$ 的平方反比中心势下于平面内运动。设位形为 $q(t) \\in \\mathbb{R}^2 \\setminus \\{0\\}$，速度为 $\\dot{q}(t)$，欧几里得范数为 $\\| \\cdot \\|$。连续拉格朗日量为 $L(q,\\dot{q}) = T(\\dot{q}) - U(q)$，其中动能 $T(\\dot{q}) = \\frac{1}{2} \\|\\dot{q}\\|^2$，势能 $U(q) = - \\frac{\\mu}{\\|q\\|}$。对于单位质量 $m=1$，连续欧拉-拉格朗日方程可推得 $m \\ddot{q} = - \\nabla U(q)$。\n\n变分积分器通过离散化作用量积分得到。在步长为 $h  0$ 的均匀时间网格 $t_k = k h$ 上，通过使用一致的、旋转不变的求积方法来近似区间 $[t_k,t_{k+1}]$ 上的积分 $\\int_{t_k}^{t_{k+1}} L(q,\\dot{q}) \\, dt$，定义离散拉格朗日量 $L_d(q_k, q_{k+1}; h)$。对于可分离的 $L(q,\\dot{q})$，在势能项上使用梯形法则，并将区间内的速度视为常数，从而得到一个仅依赖于 $q_k$、$q_{k+1}$ 和 $h$ 的离散拉格朗日量。离散欧拉-拉格朗日方程通过要求离散作用量和 $\\sum_k L_d(q_k,q_{k+1};h)$ 对 $q_k$ 的变分保持驻定而获得，这导出了一个位置的二阶更新规则。相应的离散勒让德变换定义了网格节点上的动量 $p_k^{-}$ 和 $p_k^{+}$。由于离散拉格朗日量在旋转下不变，根据离散版本的诺特定理，与特殊正交群 (SO(2)) 的旋转对称性相关的离散动量映射是精确守恒的。\n\n您的任务：\n\n1.  从第一性原理推导由上述定义的离散拉格朗日量所蕴含的显式位置更新规则。然后，在您的程序中实现由此产生的变分积分器。仅使用当前和前一个时间步可用的量；除了 $L(q,\\dot{q})$、$T(\\dot{q})$ 和 $U(q)$ 的定义外，不得假定任何连续时间公式。\n\n2.  实现离散勒让德变换，以从离散拉格朗日量计算每个节点 $q_k$ 处的离散动量 $p_k^{+}$，并使用平面动量映射 $J(q,p) = q_x p_y - q_y p_x$ 来构建模拟过程中的离散角动量序列 $\\{J_k\\}$。通过计算所有模拟步骤中的最大绝对偏差 $\\max_k |J_k - J_0|$ 来衡量长期保持性。\n\n3.  为评估能量的近似守恒，定义连续机械能 $E(q,\\dot{q}) = \\frac{1}{2}\\|\\dot{q}\\|^2 + U(q)$，并用中心差分 $\\frac{q_{k+1} - q_{k-1}}{2h}$ 来近似节点处的 $\\dot{q}(t_k)$。计算模拟过程中的序列 $\\{E_k\\}$，并报告最大绝对偏差 $\\max_k |E_k - E_0|$ 以及每步平均漂移 $(E_N - E_0)/N$，其中 $N$ 是总步数。\n\n4.  对于每个测试用例，通过在 $t_0$ 时指定 $q_0$ 和 $\\dot{q}_0$ 来初始化积分器，然后通过与您在任务1中推导的变分更新一致的单步计算来获得 $q_1$。\n\n5.  实现以下测试套件。所有量均为无量纲。对于每个测试用例，使用步长 $h$ 模拟 $N$ 步，并为每个用例输出三个度量，顺序为：最大绝对角动量偏差、最大绝对能量偏差、每步平均能量漂移（可以为负的浮点数）。在所有用例中，使用引力参数 $\\mu = 1$。\n    -   测试用例1（理想圆形轨道）：半径 $r_0 = 1$，初始位置 $q_0 = (r_0, 0)$，初始速度 $\\dot{q}_0 = (0, \\sqrt{\\mu/r_0})$，步长 $h = 0.01$，步数 $N = 20000$。\n    -   测试用例2（中等偏心率椭圆）：半长轴 $a = 1$，偏心率 $e = 0.6$，近心点半径 $r_p = a(1-e)$，初始位置 $q_0 = (r_p, 0)$，近心点速度 $\\dot{q}_0 = (0, \\sqrt{\\mu(1+e)/(a(1-e))})$，步长 $h = 0.02$，步数 $N = 20000$。\n    -   测试用例3（高偏心率椭圆，更小步长）：半长轴 $a = 1$，偏心率 $e = 0.9$，近心点半径 $r_p = a(1-e)$，初始位置 $q_0 = (r_p, 0)$，近心点速度 $\\dot{q}_0 = (0, \\sqrt{\\mu(1+e)/(a(1-e))})$，步长 $h = 0.005$，步数 $N = 20000$。\n\n6.  最终输出格式：您的程序应生成单行输出，包含一个逗号分隔的列表的列表形式的结果，每个测试用例一个列表，每个列表按上述顺序包含三个浮点数。例如，形如 $\\texttt{[[ang\\_err1,energy\\_err1,drift1],[ang\\_err2,energy\\_err2,drift2],[ang\\_err3,energy\\_err3,drift3]]}$ 的一行。\n\n实现必须是完全自包含的，并且无需用户输入即可运行。不允许使用外部数据文件或网络访问。如果在您的内部计算中出现任何角度，必须以弧度为单位。不需要物理单位；将所有量视为无量纲。程序必须遵守指定的执行环境和库约束。",
            "solution": "为平面开普勒问题构建变分积分器并评估其守恒性质的问题是有效且良态的。它基于拉格朗日力学、几何积分和数值分析的既定原理。所有必要的常数、初始条件和评估指标都已指定，构成一个自包含且可解的问题。\n\n求解过程首先从指定的离散拉格朗日量推导离散运动方程，然后实现得到的算法，最后在给定的测试用例上评估其性能。\n\n### 步骤1：变分积分器的推导\n\n问题始于一个单位质量粒子（$m=1$）在中心势 $U(q) = -\\frac{\\mu}{\\|q\\|}$ 中的连续拉格朗日量：\n$$\nL(q, \\dot{q}) = T(\\dot{q}) - U(q) = \\frac{1}{2}\\|\\dot{q}\\|^2 + \\frac{\\mu}{\\|q\\|}\n$$\n变分积分器通过离散化作用量积分 $S = \\int L(q, \\dot{q}) \\, dt$ 来构建。离散作用量是一个和式 $S_d = \\sum_k L_d(q_k, q_{k+1}; h)$，其中 $L_d$ 是近似单个时间步长 $h$ 内作用量的离散拉格朗日量。\n\n离散拉格朗日量 $L_d(q_k, q_{k+1}; h)$ 是通过近似积分 $\\int_{t_k}^{t_{k+1}} L(q(t), \\dot{q}(t)) \\, dt$ 来定义的。我们使用指定的求积法则：\n1.  动能项通过假设在区间 $[t_k, t_{k+1}]$ 上的速度是恒定的 $\\dot{q}(t) \\approx \\frac{q_{k+1} - q_k}{h}$ 来近似。\n    $$\n    \\int_{t_k}^{t_{k+1}} T(\\dot{q}) \\, dt \\approx \\int_{t_k}^{t_{k+1}} \\frac{1}{2} \\left\\| \\frac{q_{k+1} - q_k}{h} \\right\\|^2 \\, dt = h \\cdot \\frac{1}{2h^2} \\|q_{k+1} - q_k\\|^2 = \\frac{1}{2h} \\|q_{k+1} - q_k\\|^2\n    $$\n2.  势能项通过对 $-U(q)$ 应用梯形法则来近似。\n    $$\n    \\int_{t_k}^{t_{k+1}} (-U(q(t))) \\, dt \\approx \\frac{h}{2} (-U(q_k) - U(q_{k+1})) = \\frac{h \\mu}{2} \\left( \\frac{1}{\\|q_k\\|} + \\frac{1}{\\|q_{k+1}\\|} \\right)\n    $$\n将这些结合起来，得到离散拉格朗日量：\n$$\nL_d(q_k, q_{k+1}; h) = \\frac{\\|q_{k+1} - q_k\\|^2}{2h} + \\frac{h \\mu}{2} \\left( \\frac{1}{\\|q_k\\|} + \\frac{1}{\\|q_{k+1}\\|} \\right)\n$$\n离散欧拉-拉格朗日（DEL）方程由驻定作用量原理 $\\delta S_d = 0$ 推导得出。对于一个内部点 $q_k$，这得到：\n$$\nD_2 L_d(q_{k-1}, q_k; h) + D_1 L_d(q_k, q_{k+1}; h) = 0\n$$\n其中 $D_1$ 和 $D_2$ 分别表示对 $L_d$ 的第一个和第二个向量参数的偏导数（梯度）。我们来计算这些导数。我们利用 $\\nabla_q \\frac{1}{\\|q\\|} = -\\frac{q}{\\|q\\|^3}$，所以 $\\nabla_q U(q) = \\nabla_q(-\\frac{\\mu}{\\|q\\|}) = \\frac{\\mu q}{\\|q\\|^3}$。\n$$\nD_1 L_d(q_k, q_{k+1}; h) = \\frac{\\partial L_d}{\\partial q_k} = \\frac{-(q_{k+1} - q_k)}{h} + \\frac{h \\mu}{2} \\left(-\\frac{q_k}{\\|q_k\\|^3}\\right) = \\frac{q_k - q_{k+1}}{h} - \\frac{h}{2} \\frac{\\mu q_k}{\\|q_k\\|^3}\n$$\n$$\nD_2 L_d(q_{k-1}, q_k; h) = \\frac{\\partial L_d}{\\partial q_k} = \\frac{q_k - q_{k-1}}{h} + \\frac{h \\mu}{2} \\left(-\\frac{q_k}{\\|q_k\\|^3}\\right) = \\frac{q_k - q_{k-1}}{h} - \\frac{h}{2} \\frac{\\mu q_k}{\\|q_k\\|^3}\n$$\n将这些代入DEL方程：\n$$\n\\left( \\frac{q_k - q_{k-1}}{h} - \\frac{h}{2} \\frac{\\mu q_k}{\\|q_k\\|^3} \\right) + \\left( \\frac{q_k - q_{k+1}}{h} - \\frac{h}{2} \\frac{\\mu q_k}{\\|q_k\\|^3} \\right) = 0\n$$\n$$\n\\frac{2q_k - q_{k-1} - q_{k+1}}{h} - h \\frac{\\mu q_k}{\\|q_k\\|^3} = 0\n$$\n解出 $q_{k+1}$ 得到显式的位置更新规则，即Störmer-Verlet方法：\n$$\nq_{k+1} = 2q_k - q_{k-1} - h^2 \\frac{\\mu q_k}{\\|q_k\\|^3}\n$$\n这个更新规则需要两个先前的位置，$q_k$ 和 $q_{k-1}$。对于初始化，我们给定了 $q_0$ 和 $\\dot{q}_0$。我们必须以与积分器一致的方式找到 $q_1$。这可以通过一个“半步踢，整步漂”的方案来实现，等价于一个二阶泰勒展开：\n$$\nq_1 = q_0 + h\\dot{q}_0 + \\frac{h^2}{2}\\ddot{q}_0\n$$\n从连续运动方程可知，$\\ddot{q}_0 = -\\nabla U(q_0) = -\\frac{\\mu q_0}{\\|q_0\\|^3}$。因此，第一步是：\n$$\nq_1 = q_0 + h\\dot{q}_0 - \\frac{h^2 \\mu}{2} \\frac{q_0}{\\|q_0\\|^3}\n$$\n有了 $q_0$ 和 $q_1$，模拟就可以使用主更新规则进行所有后续步骤。\n\n### 步骤2：角动量守恒\n\n问题指出，由于离散拉格朗日量的旋转对称性（对于任何旋转 $g \\in SO(2)$，都有 $L_d(gq_k, gq_{k+1};h) = L_d(q_k, q_{k+1};h)$），相关的离散动量映射是精确守恒的。这个守恒量就是离散角动量。我们使用从离散勒让德变换得到的离散动量 $p_k^+$ 在每个节点 $q_k$ 处计算它：\n$$\np_k^+ = D_2 L_d(q_k, q_{k+1}; h) = \\frac{q_{k+1} - q_k}{h} - \\frac{h}{2} \\frac{\\mu q_{k+1}}{\\|q_{k+1}\\|^3}\n$$\n在步骤 $k$ 的离散角动量，使用指定的公式 $J(q,p) = q_x p_y - q_y p_x$ 为：\n$$\nJ_k = (q_k)_x (p_k^+)_y - (q_k)_y (p_k^+)_x\n$$\n我们计算序列 $\\{J_k\\}$，其中 $k=0, \\dots, N-1$。初始值 $J_0$ 使用 $q_0$ 和 $p_0^+$ 计算，而 $p_0^+$ 需要 $q_1$。偏差通过 $\\max_k |J_k - J_0|$ 来衡量。由于积分器的几何特性，这个偏差预计在机器精度的量级。\n\n### 步骤3：能量的近似守恒\n\n该积分器并不精确守恒连续能量。我们通过计算每个节点处能量的近似值来评估其近似守恒性。连续能量为 $E(q,\\dot{q}) = \\frac{1}{2}\\|\\dot{q}\\|^2 - \\frac{\\mu}{\\|q\\|}$。\n速度 $\\dot{q}_k$ 使用二阶中心差分来近似：\n$$\n\\dot{q}_k \\approx \\frac{q_{k+1} - q_{k-1}}{2h}\n$$\n这使我们能够计算能量序列 $\\{E_k\\}$，其中 $k=1, \\dots, N$。参考能量 $E_0$ 使用给定的初始条件计算：\n$$\nE_0 = E(q_0, \\dot{q}_0) = \\frac{1}{2}\\|\\dot{q}_0\\|^2 - \\frac{\\mu}{\\|q_0\\|}\n$$\n对于 $k=1, \\dots, N$，能量为：\n$$\nE_k = \\frac{1}{2} \\left\\| \\frac{q_{k+1} - q_{k-1}}{2h} \\right\\|^2 - \\frac{\\mu}{\\|q_k\\|}\n$$\n请注意，计算 $E_N$ 需要 $q_{N+1}$，因此模拟必须多运行一步。能量的度量指标是最大绝对偏差 $\\max_k |E_k - E_0|$ 和每步平均漂移 $(E_N - E_0)/N$。对于像Verlet这样的对称积分器，能量误差预计是有界的（振荡的），而不是线性增长的，因此在长时间内平均漂移非常小。\n\n### 步骤4：算法实现\n\n程序将为一系列测试用例实现推导出的公式。对于每个用例：\n1.  初始化参数（$\\mu=1$、$q_0$、$\\dot{q}_0$、$h$、$N$）。\n2.  分配一个数组来存储位置 $q_0, \\dots, q_{N+1}$。\n3.  使用特殊的初始化公式计算 $q_1$。\n4.  从 $k=1$ 到 $N$ 迭代，使用Störmer-Verlet更新规则计算 $q_{k+1}$。\n5.  计算离散角动量序列 $J_0, \\dots, J_{N-1}$，并找出与 $J_0$ 的最大绝对偏差。\n6.  计算近似能量序列 $E_0, \\dots, E_N$，并找出最大绝对偏差和平均漂移。\n7.  存储并格式化得到的三个度量。\n\n这个植根于第一性原理的系统性步骤，确保了实现的正确性和鲁棒性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and evaluates a variational integrator for the planar Kepler problem.\n    \"\"\"\n    \n    # Gravitational parameter\n    mu = 1.0\n\n    # Define the test cases from the problem statement.\n    # Each case: (initial position q0, initial velocity q0_dot, time step h, number of steps N)\n    a_2, e_2 = 1.0, 0.6\n    rp_2 = a_2 * (1.0 - e_2)\n    vp_2 = np.sqrt(mu * (1.0 + e_2) / (a_2 * (1.0 - e_2)))\n    \n    a_3, e_3 = 1.0, 0.9\n    rp_3 = a_3 * (1.0 - e_3)\n    vp_3 = np.sqrt(mu * (1.0 + e_3) / (a_3 * (1.0 - e_3)))\n\n    test_cases = [\n        (np.array([1.0, 0.0]), np.array([0.0, np.sqrt(mu/1.0)]), 0.01, 20000),\n        (np.array([rp_2, 0.0]), np.array([0.0, vp_2]), 0.02, 20000),\n        (np.array([rp_3, 0.0]), np.array([0.0, vp_3]), 0.005, 20000),\n    ]\n\n    all_results = []\n    \n    for q0, q0_dot, h, N in test_cases:\n        \n        # --- Simulation ---\n        # We need N+2 points (q_0, ..., q_{N+1}) to compute energy at E_N.\n        q_history = np.zeros((N + 2, 2))\n        q_history[0] = q0\n        \n        # Task 1/4: Initialization of q1\n        # q1 = q0 + h*q0_dot + (h^2/2)*ddot(q0)\n        # ddot(q0) = -mu * q0 / ||q0||^3\n        norm_q0 = np.linalg.norm(q0)\n        q0_ddot = -mu * q0 / (norm_q0**3)\n        q1 = q0 + h * q0_dot + 0.5 * h**2 * q0_ddot\n        q_history[1] = q1\n        \n        # Main integration loop (Störmer-Verlet)\n        # q_{k+1} = 2*q_k - q_{k-1} - h^2 * mu * q_k / ||q_k||^3\n        for k in range(1, N + 1):\n            q_k = q_history[k]\n            q_k_minus_1 = q_history[k-1]\n            norm_qk = np.linalg.norm(q_k)\n            # Handle the case where the particle might pass through the origin\n            if norm_qk == 0:\n                # In a real scenario, this would need careful handling.\n                # Here, we can assume it won't happen with the given ICs.\n                q_k_plus_1 = np.full(2, np.nan)\n            else:\n                force_term = -h**2 * mu * q_k / (norm_qk**3)\n                q_k_plus_1 = 2 * q_k - q_k_minus_1 + force_term\n            q_history[k+1] = q_k_plus_1\n            \n        # --- Analysis ---\n        \n        # Task 2: Angular Momentum Preservation\n        # J_k = q_k_x * p_k_y^+ - q_k_y * p_k_x^+\n        # p_k^+ = (q_{k+1} - q_k)/h - (h/2) * (mu*q_{k+1}/||q_{k+1}||^3)\n        # Sequence is J_0, ..., J_{N-1}\n        j_history = np.zeros(N)\n        for k in range(N):\n            q_k = q_history[k]\n            q_k_plus_1 = q_history[k+1]\n            \n            norm_qk_plus_1 = np.linalg.norm(q_k_plus_1)\n            \n            p_k_plus_term1 = (q_k_plus_1 - q_k) / h\n            p_k_plus_term2 = - (h / 2.0) * mu * q_k_plus_1 / (norm_qk_plus_1**3)\n            p_k_plus = p_k_plus_term1 + p_k_plus_term2\n            \n            j_k = q_k[0] * p_k_plus[1] - q_k[1] * p_k_plus[0]\n            j_history[k] = j_k\n        \n        j0 = j_history[0]\n        max_ang_mom_dev = np.max(np.abs(j_history - j0))\n        \n        # Task 3: Energy Near-Conservation\n        # E_k = 0.5 * ||(q_{k+1}-q_{k-1})/(2h)||^2 - mu/||q_k||\n        # E_0 is computed from initial conditions\n        e_history = np.zeros(N + 1)\n        \n        # E_0 from exact initial velocity\n        e0 = 0.5 * np.dot(q0_dot, q0_dot) - mu / np.linalg.norm(q0)\n        e_history[0] = e0\n        \n        # E_k for k=1..N using centered difference for velocity\n        for k in range(1, N + 1):\n            q_k_plus_1 = q_history[k+1]\n            q_k_minus_1 = q_history[k-1]\n            q_k = q_history[k]\n            \n            q_k_dot_approx = (q_k_plus_1 - q_k_minus_1) / (2.0 * h)\n            \n            kinetic_energy = 0.5 * np.dot(q_k_dot_approx, q_k_dot_approx)\n            potential_energy = -mu / np.linalg.norm(q_k)\n            e_k = kinetic_energy + potential_energy\n            e_history[k] = e_k\n            \n        e_n = e_history[N]\n        max_energy_dev = np.max(np.abs(e_history - e0))\n        avg_energy_drift = (e_n - e0) / N\n        \n        all_results.append([max_ang_mom_dev, max_energy_dev, avg_energy_drift])\n\n    # Final print statement in the exact required format.\n    case_strings = []\n    for case_result in all_results:\n        case_strings.append(f\"[{case_result[0]},{case_result[1]},{case_result[2]}]\")\n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```"
        }
    ]
}