{
    "hands_on_practices": [
        {
            "introduction": "为了开始我们的实践探索，我们首先回顾力学中辛几何的基石：庞加莱的绝对积分不变量。第一个练习提供了一个具体的机会，让你从第一性原理出发，证明辛形式 $\\omega$ 在哈密顿流作用下演化的任意曲面上的积分保持不变。通过求解 $\\mathbb{R}^4$ 上的一个特定线性系统，你将巩固对 $\\omega$ 的闭合性以及哈密顿动力学结构如何保证这一基本守恒定律的理解。",
            "id": "3765101",
            "problem": "考虑标准辛向量空间 $\\mathbb{R}^{4}$，其坐标为 $(q_{1},q_{2},p_{1},p_{2})$，标准辛形式为 $\\omega = \\mathrm{d}q_{1} \\wedge \\mathrm{d}p_{1} + \\mathrm{d}q_{2} \\wedge \\mathrm{d}p_{2}$。设哈密顿量为正定二次函数\n$$\nH(q_{1},q_{2},p_{1},p_{2}) = \\frac{1}{2}\\left(2\\left(q_{1}^{2}+p_{1}^{2}\\right) + 3\\left(q_{2}^{2}+p_{2}^{2}\\right)\\right),\n$$\n它通过哈密顿方程生成一个线性哈密顿流 $\\varphi_{t}:\\mathbb{R}^{4}\\to\\mathbb{R}^{4}$。定义初始有向平行四边形 $S_{0}\\subset \\mathbb{R}^{4}$，其参数化为\n$$\nz_{0}(s,u) = s\\,v_{1} + u\\,v_{2}, \\quad (s,u)\\in [0,1]\\times[0,1],\n$$\n其中\n$$\nv_{1} = (1,\\,0,\\,2,\\,-1),\\qquad v_{2} = (0,\\,2,\\,1,\\,3).\n$$\n设 $S_{t} = \\varphi_{t}(S_{0})$ 是在时间 $t$ 时，流作用下输运的有向平行四边形。从哈密顿动力学和辛几何的第一性原理出发，计算积分\n$$\nI(t) = \\int_{S_{t}}\\omega\n$$\n并验证（通过从基本定义推导）$I(t)$ 是该流的一个绝对积分不变量。给出 $I(t)$ 的精确值，它是一个与 $t$ 无关的实数。无需四舍五入。",
            "solution": "该问题要求完成两个主要任务：首先，从基本原理出发，验证积分 $I(t) = \\int_{S_{t}}\\omega$ 是给定哈密顿流的一个绝对积分不变量；其次，计算其精确值。绝对积分不变量是指当积分区域随流输运时，其值在时间上保持不变的量。\n\n设 $\\varphi_{t}$ 是由哈密顿量 $H$ 生成的哈密顿流。曲面 $S_{t}$ 是初始曲面 $S_{0}$ 在此流作用下的像，即 $S_{t} = \\varphi_{t}(S_{0})$。积分为 $I(t) = \\int_{\\varphi_{t}(S_{0})} \\omega$。利用微分形式积分的变量替换公式，我们可以将积分拉回到固定区域 $S_{0}$ 上：\n$$\nI(t) = \\int_{S_{0}} (\\varphi_{t})^{*}\\omega\n$$\n其中 $(\\varphi_{t})^{*}$ 是由流 $\\varphi_{t}$ 诱导的拉回映射。\n\n为证明 $I(t)$ 是一个不变量，我们必须证明它与时间 $t$ 无关。这等价于证明其时间导数为零：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}I(t) = \\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{S_{0}} (\\varphi_{t})^{*}\\omega = \\int_{S_{0}} \\frac{\\mathrm{d}}{\\mathrm{d}t}(\\varphi_{t})^{*}\\omega\n$$\n在由向量场 $X$ 生成的流下，一个形式的拉回的时间演化由李导数给出：$\\frac{\\mathrm{d}}{\\mathrm{d}t}(\\varphi_{t})^{*}\\omega = (\\varphi_{t})^{*}(\\mathcal{L}_{X_H}\\omega)$，其中 $X_H$ 是与 $H$ 相关联的哈密顿向量场。因此，我们有：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}I(t) = \\int_{S_{0}} (\\varphi_{t})^{*}(\\mathcal{L}_{X_H}\\omega)\n$$\n积分 $I(t)$ 为常数的充要条件是辛形式 $\\omega$ 关于哈密顿向量场 $X_H$ 的李导数为零，即 $\\mathcal{L}_{X_H}\\omega = 0$。我们现在从第一性原理证明这一点。\n\n根据 Cartan 的“魔术”公式，微分形式 $\\alpha$ 关于向量场 $X$ 的李导数由 $\\mathcal{L}_{X}\\alpha = \\mathrm{d}(i_{X}\\alpha) + i_{X}(\\mathrm{d}\\alpha)$ 给出，其中 $\\mathrm{d}$ 是外导数， $i_{X}$ 是内积。在我们的情况下，这变为：\n$$\n\\mathcal{L}_{X_H}\\omega = \\mathrm{d}(i_{X_H}\\omega) + i_{X_H}(\\mathrm{d}\\omega)\n$$\n辛形式的一个基本性质是它是闭的，意味着其外导数为零。让我们对给定的形式 $\\omega = \\mathrm{d}q_{1} \\wedge \\mathrm{d}p_{1} + \\mathrm{d}q_{2} \\wedge \\mathrm{d}p_{2}$ 验证这一点：\n$$\n\\mathrm{d}\\omega = \\mathrm{d}(\\mathrm{d}q_{1} \\wedge \\mathrm{d}p_{1}) + \\mathrm{d}(\\mathrm{d}q_{2} \\wedge \\mathrm{d}p_{2})\n$$\n利用性质 $\\mathrm{d}(\\alpha \\wedge \\beta) = \\mathrm{d}\\alpha \\wedge \\beta - \\alpha \\wedge \\mathrm{d}\\beta$ 以及恰当形式 $\\mathrm{d}f$ 的外导数为零（即 $\\mathrm{d}^{2}=0$）这一事实，我们得到：\n$$\n\\mathrm{d}(\\mathrm{d}q_{1} \\wedge \\mathrm{d}p_{1}) = (\\mathrm{d}^{2}q_{1}) \\wedge \\mathrm{d}p_{1} - \\mathrm{d}q_{1} \\wedge (\\mathrm{d}^{2}p_{1}) = 0 - 0 = 0\n$$\n类似地，$\\mathrm{d}(\\mathrm{d}q_{2} \\wedge \\mathrm{d}p_{2})=0$。因此，$\\mathrm{d}\\omega = 0$。该辛形式是闭的。这意味着 Cartan 公式中的第二项为零：$i_{X_H}(\\mathrm{d}\\omega) = i_{X_H}(0) = 0$。\n\n我们剩下 $\\mathcal{L}_{X_H}\\omega = \\mathrm{d}(i_{X_H}\\omega)$。根据定义，哈密顿向量场 $X_H$ 是满足关系 $i_{X_H}\\omega = -\\mathrm{d}H$ 的唯一向量场。将此代入我们的李导数表达式中：\n$$\n\\mathcal{L}_{X_H}\\omega = \\mathrm{d}(-\\mathrm{d}H) = -\\mathrm{d}^{2}H\n$$\n由于算子 $\\mathrm{d}$ 具有其平方恒为零的性质（$\\mathrm{d}^{2} = 0$），我们有 $\\mathcal{L}_{X_H}\\omega = 0$。\n\n由于 $\\mathcal{L}_{X_H}\\omega = 0$，我们有 $\\frac{\\mathrm{d}}{\\mathrm{d}t}I(t) = \\int_{S_{0}} (\\varphi_{t})^{*}(0) = 0$。这证实了 $I(t)$ 是一个常数，与 $t$ 无关。因此，$I(t)$ 是该流的一个绝对积分不变量。这种不变性是所有哈密顿流的一个普遍性质，也是 Poincaré 积分不变量定理的一个陈述（具体来说，$\\omega$ 是一个绝对积分不变量）。\n\n为了求出 $I(t)$ 的值，我们可以简单地在任何时刻计算它，例如在 $t=0$ 时：\n$$\nI(t) = I(0) = \\int_{S_{0}}\\omega\n$$\n曲面 $S_{0}$ 是 $\\mathbb{R}^{4}$ 中由向量 $v_{1} = (1,\\,0,\\,2,\\,-1)$ 和 $v_{2} = (0,\\,2,\\,1,\\,3)$ 张成的有向平行四边形。一个 2-形式在平行四边形上的积分由该形式在其张成向量上的求值给出。在我们的情况下：\n$$\n\\int_{S_{0}}\\omega = \\omega(v_{1}, v_{2})\n$$\n我们将向量的分量与坐标 $(q_{1}, q_{2}, p_{1}, p_{2})$ 等同起来。\n对于 $v_1$：$\\delta q_{1}^{(1)}=1$，$\\delta q_{2}^{(1)}=0$，$\\delta p_{1}^{(1)}=2$，$\\delta p_{2}^{(1)}=-1$。\n对于 $v_2$：$\\delta q_{1}^{(2)}=0$，$\\delta q_{2}^{(2)}=2$，$\\delta p_{1}^{(2)}=1$，$\\delta p_{2}^{(2)}=3$。\n\n2-形式 $\\omega = \\mathrm{d}q_{1} \\wedge \\mathrm{d}p_{1} + \\mathrm{d}q_{2} \\wedge \\mathrm{d}p_{2}$ 在向量对 $(v_{1}, v_{2})$ 上的作用是：\n$$\n\\omega(v_{1}, v_{2}) = (\\mathrm{d}q_{1} \\wedge \\mathrm{d}p_{1})(v_{1}, v_{2}) + (\\mathrm{d}q_{2} \\wedge \\mathrm{d}p_{2})(v_{1}, v_{2})\n$$\n使用楔积在向量上的定义，$(\\mathrm{d}f \\wedge \\mathrm{d}g)(u,v) = \\mathrm{d}f(u)\\mathrm{d}g(v) - \\mathrm{d}f(v)\\mathrm{d}g(u)$，这是求值矩阵的行列式：\n$$\n(\\mathrm{d}q_{1} \\wedge \\mathrm{d}p_{1})(v_{1}, v_{2}) = \\det\\begin{pmatrix} \\mathrm{d}q_{1}(v_{1}) & \\mathrm{d}q_{1}(v_{2}) \\\\ \\mathrm{d}p_{1}(v_{1}) & \\mathrm{d}p_{1}(v_{2}) \\end{pmatrix} = \\det\\begin{pmatrix} 1 & 0 \\\\ 2 & 1 \\end{pmatrix} = (1)(1) - (0)(2) = 1\n$$\n$$\n(\\mathrm{d}q_{2} \\wedge \\mathrm{d}p_{2})(v_{1}, v_{2}) = \\det\\begin{pmatrix} \\mathrm{d}q_{2}(v_{1}) & \\mathrm{d}q_{2}(v_{2}) \\\\ \\mathrm{d}p_{2}(v_{1}) & \\mathrm{d}p_{2}(v_{2}) \\end{pmatrix} = \\det\\begin{pmatrix} 0 & 2 \\\\ -1 & 3 \\end{pmatrix} = (0)(3) - (2)(-1) = 2\n$$\n将这些贡献相加，我们得到积分的值：\n$$\nI(t) = I(0) = \\omega(v_{1}, v_{2}) = 1 + 2 = 3\n$$\n积分值为 $3$，并且这个值对于所有时间 $t$ 都是常数。哈密顿量 $H$ 的具体形式仅在于它生成了一个哈密顿流，从而保证了不变性。振荡的具体频率不影响此特定积分的值。",
            "answer": "$$\n\\boxed{3}\n$$"
        },
        {
            "introduction": "虽然绝对不变量很强大，但力学中的许多重要量仅在特定的边界条件下才守恒，这引出了相对积分不变量的概念。本练习使用1-形式 $\\alpha = p\\,dq$ 提供了一个清晰且必要的例子，该形式非恰当，因此其积分通常不守恒。你将证明，只要积分路径的端点被约束在一个特定的子流形上，其积分就成为一个不变量，从而揭示边界项在定义这些条件守恒律中的关键作用。",
            "id": "3765096",
            "problem": "设 $M=\\mathbb{R}^{2}$ 配备全局坐标 $(q,p)$ 和典范辛形式 $\\omega = dp \\wedge dq$。考虑 $M$ 上的1-形式 $\\alpha = p\\,dq$ 以及由 $N = \\{(q,p) \\in \\mathbb{R}^{2} \\mid p=0\\}$ 定义的嵌入子流形 $N \\subset M$。使用辛几何和微分形式演算的基本定义，完成以下任务：\n\n1) 通过分析其外微分，证明 $\\alpha$ 在 $M$ 上不是恰当的。然后论证，当限制在 $N$ 上时，形式 $\\alpha$ 变得恰当，即存在 $N$ 上的光滑函数 $\\beta$ 使得 $i^{*}\\alpha = d\\beta$，其中 $i: N \\hookrightarrow M$ 是包含映射。\n\n2) 设 $H(q,p) = \\frac{1}{2}p^{2}$，并设 $X_{H}$ 是由条件 $i_{X_{H}}\\omega = dH$ 定义的哈密顿向量场。考虑一个单参数曲线族 $\\gamma_{t}$，它是通过初始光滑曲线 $\\gamma_{0}$ 在 $X_{H}$ 的流作用下演化得到的，并且具有性质：对于所有 $t$，$\\gamma_{t}$ 的端点都保持在 $N$ 中。从第一性原理出发，证明量\n$$\nI(t) = \\int_{\\gamma_{t}} \\alpha\n$$\n不依赖于 $t$。你的推导必须从哈密顿向量场的定义、 $M$ 上的典范辛形式以及 Cartan 的李导数公式出发，并且只能依赖于这些基础工具。\n\n3) 设初始曲线 $\\gamma_{0}$ 是从 $(0,0)$ 到 $(Q,0)$ 的分段光滑路径，其中 $Q>0$，由以下三段给出：\n- $\\gamma_{0}^{(1)}$: $q(\\lambda)=0$, $p(\\lambda)=\\lambda A$ for $\\lambda \\in [0,1]$,\n- $\\gamma_{0}^{(2)}$: $q(\\lambda)=\\lambda Q$, $p(\\lambda)=A$ for $\\lambda \\in [0,1]$,\n- $\\gamma_{0}^{(3)}$: $q(\\lambda)=Q$, $p(\\lambda)=A(1-\\lambda)$ for $\\lambda \\in [0,1]$,\n其中 $A>0$ 是一个给定常数。计算不变量 $I(0) = \\int_{\\gamma_{0}} \\alpha$，结果表示为关于 $A$ 和 $Q$ 的闭式解析表达式。不需要四舍五入，也不涉及物理单位。最终答案必须是单个解析表达式。",
            "solution": "该问题陈述清晰，具有科学依据且自洽。所有定义和条件在几何力学和辛几何领域都是标准的。我将开始解答。\n\n问题包含三个部分。我将按顺序进行解答。\n\n**第1部分：1-形式 $\\alpha$ 及其限制的分析**\n\n$M=\\mathbb{R}^{2}$ 流形上的1-形式由 $\\alpha = p\\,dq$ 给出。为确定 $\\alpha$ 是否是恰当的，我们首先检查它是否是闭形式。如果一个形式的外微分为零，则它是闭的。我们计算 $\\alpha$ 的外微分：\n$$\nd\\alpha = d(p\\,dq) = dp \\wedge dq + p \\wedge d(dq)\n$$\n因为对任意坐标函数 $q$ 都有 $d(dq) = d(d(q)) = 0$，所以第二项为零。剩下：\n$$\nd\\alpha = dp \\wedge dq\n$$\n问题陈述将典范辛形式定义为 $\\omega = dp \\wedge dq$。因此，$d\\alpha = \\omega$。由于 $\\omega$ 是 $\\mathbb{R}^{2}$ 上的非零2-形式，所以 $d\\alpha \\neq 0$。因为 $\\alpha$ 不是闭的，所以它不可能是恰当的。一个 $k$-形式是恰当的（$\\alpha = d\\beta$）的必要条件是它必须是闭的（$d\\alpha = d(d\\beta) = 0$）。\n\n接下来，我们考虑 $\\alpha$ 在子流形 $N = \\{(q,p) \\in \\mathbb{R}^{2} \\mid p=0\\}$ 上的限制。设 $i: N \\hookrightarrow M$ 是包含映射。$N$ 中的一个点由其 $q$ 坐标唯一确定，因此我们可以用 $q$ 来参数化 $N$。包含映射为 $i(q) = (q, 0)$。限制后的形式是拉回 $i^{*}\\alpha$：\n$$\ni^{*}\\alpha = i^{*}(p\\,dq) = (i^{*}p) d(i^{*}q)\n$$\n函数 $p$ 到 $N$ 上的拉回，记作 $i^{*}p$，是函数 $p$ 在 $N$ 的点上的取值。在 $N$ 上，坐标 $p$ 恒等于零。因此，$i^{*}p = 0$。函数 $q$ 的拉回就是 $q$ 本身，所以 $i^*q = q$。\n将这些代入 $i^{*}\\alpha$ 的表达式中：\n$$\ni^{*}\\alpha = (0) d(q) = 0\n$$\n结果是 $N$ 上的零1-形式。我们必须证明这个形式在 $N$ 上是恰当的。这需要找到一个 $N$ 上的光滑函数（一个0-形式）$\\beta$，使得 $d\\beta = i^{*}\\alpha = 0$。我们考虑一个常数函数 $\\beta: N \\to \\mathbb{R}$，定义为 $\\beta(q) = c$，其中 $c$ 是某个常数。其外微分为：\n$$\nd\\beta = \\frac{\\partial\\beta}{\\partial q} dq = \\frac{\\partial c}{\\partial q} dq = 0\n$$\n既然我们找到了这样一个函数（例如 $\\beta=0$），形式 $i^{*}\\alpha$ 在 $N$ 上就是恰当的。\n\n**第2部分：$I(t)$ 不变性的证明**\n\n待分析的量是 $I(t) = \\int_{\\gamma_t} \\alpha$。曲线 $\\gamma_t$ 是通过初始曲线 $\\gamma_0$ 在向量场 $X_H$ 的哈密顿流 $\\phi_t$ 作用下演化得到的。因此，$\\gamma_t = \\phi_t(\\gamma_0)$。该积分可以用流映射的拉回重写：\n$$\nI(t) = \\int_{\\phi_t(\\gamma_0)} \\alpha = \\int_{\\gamma_0} \\phi_t^{*}\\alpha\n$$\n为了证明 $I(t)$ 不依赖于 $t$，我们必须证明其时间导数为零。对 $t$ 求导：\n$$\n\\frac{dI}{dt} = \\frac{d}{dt} \\int_{\\gamma_0} \\phi_t^{*}\\alpha = \\int_{\\gamma_0} \\frac{d}{dt}(\\phi_t^{*}\\alpha)\n$$\n沿流的拉回的时间导数是李导数的拉回：$\\frac{d}{dt}(\\phi_t^{*}\\alpha) = \\phi_t^{*}(\\mathcal{L}_{X_H}\\alpha)$。将其代回并将积分域从 $\\gamma_0$ 更改为 $\\gamma_t$：\n$$\n\\frac{dI}{dt} = \\int_{\\gamma_0} \\phi_t^{*}(\\mathcal{L}_{X_H}\\alpha) = \\int_{\\phi_t(\\gamma_0)} \\mathcal{L}_{X_H}\\alpha = \\int_{\\gamma_t} \\mathcal{L}_{X_H}\\alpha\n$$\n我们现在使用 Cartan 的魔法公式来计算李导数：$\\mathcal{L}_{X_H}\\alpha = i_{X_H}(d\\alpha) + d(i_{X_H}\\alpha)$。我们来计算每一项。\n从第1部分可知，$d\\alpha = \\omega$。所以，第一项是 $i_{X_H}(d\\alpha) = i_{X_H}\\omega$。根据问题中给出的哈密顿向量场 $X_H$ 的定义，$i_{X_H}\\omega = dH$。\n\n对于第二项 $d(i_{X_H}\\alpha)$，我们首先需要找到向量场 $X_H$。哈密顿量为 $H(q,p) = \\frac{1}{2}p^{2}$，所以其外微分为 $dH = \\frac{\\partial H}{\\partial q}dq + \\frac{\\partial H}{\\partial p}dp = 0 \\cdot dq + p \\cdot dp = p\\,dp$。设 $X_H = \\dot{q}\\frac{\\partial}{\\partial q} + \\dot{p}\\frac{\\partial}{\\partial p}$。我们计算内积 $i_{X_H}\\omega$：\n$i_{X_H}\\omega = i_{\\dot{q}\\frac{\\partial}{\\partial q} + \\dot{p}\\frac{\\partial}{\\partial p}}(dp \\wedge dq) = \\dot{q} i_{\\frac{\\partial}{\\partial q}}(dp \\wedge dq) + \\dot{p} i_{\\frac{\\partial}{\\partial p}}(dp \\wedge dq) = \\dot{q}(-dp) + \\dot{p}(dq) = \\dot{p}\\,dq - \\dot{q}\\,dp$\n将 $i_{X_H}\\omega$ 与 $dH$ 相等：\n$$\n\\dot{p}\\,dq - \\dot{q}\\,dp = 0\\,dq + p\\,dp\n$$\n通过比较基底1-形式 $dq$ 和 $dp$ 的系数，我们得到该系统的哈密顿方程：$\\dot{p}=0$ 和 $-\\dot{q}=p$，这意味着 $\\dot{q}=-p$。因此，哈密顿向量场为 $X_H = -p\\frac{\\partial}{\\partial q}$。\n\n现在我们计算函数 $i_{X_H}\\alpha = \\alpha(X_H)$：\n$i_{X_H}\\alpha = (p\\,dq) \\left(-p\\frac{\\partial}{\\partial q}\\right) = p \\cdot dq\\left(-p\\frac{\\partial}{\\partial q}\\right) = p \\cdot(-p) \\cdot dq\\left(\\frac{\\partial}{\\partial q}\\right) = p \\cdot (-p) \\cdot 1 = -p^2$\n现在我们可以组合出李导数：\n$$\n\\mathcal{L}_{X_H}\\alpha = dH + d(-p^2) = d\\left(\\frac{1}{2}p^2\\right) + d(-p^2) = d\\left(\\frac{1}{2}p^2 - p^2\\right) = d\\left(-\\frac{1}{2}p^2\\right)\n$$\n李导数是一个恰当形式。将其代回到 $\\frac{dI}{dt}$ 的表达式中：\n$$\n\\frac{dI}{dt} = \\int_{\\gamma_t} d\\left(-\\frac{1}{2}p^2\\right)\n$$\n根据线积分的微积分基本定理，一个恰当形式 $dF$ 在曲线 $\\gamma$ 上的积分等于 $F$ 在曲线端点处取值的差。设 $\\gamma_t$ 的端点为 $z_{start}(t)$ 和 $z_{end}(t)$。\n$$\n\\frac{dI}{dt} = \\left[-\\frac{1}{2}p^2\\right]_{z_{start}(t)}^{z_{end}(t)} = -\\frac{1}{2} [p(z_{end}(t))]^2 - \\left(-\\frac{1}{2} [p(z_{start}(t))]^2\\right)\n$$\n问题陈述指出，对于所有 $t$，$\\gamma_t$ 的端点都保持在子流形 $N$ 中。子流形 $N$ 的定义是 $p=0$。因此，在端点处，$p(z_{start}(t))=0$ 且 $p(z_{end}(t))=0$。这得到：\n$$\n\\frac{dI}{dt} = -\\frac{1}{2}(0)^2 + \\frac{1}{2}(0)^2 = 0\n$$\n由于对所有 $t$ 都有 $\\frac{dI}{dt}=0$，量 $I(t)$ 不依赖于 $t$；它是一个不变量。\n\n**第3部分：不变量 $I(0)$ 的计算**\n\n由于 $I(t)$ 是一个常数，其值等于它在 $t=0$ 时的值，即 $I(0) = \\int_{\\gamma_0} \\alpha$。我们给定了一条分段光滑路径 $\\gamma_0$，它是三段的并集：$\\gamma_0 = \\gamma_0^{(1)} \\cup \\gamma_0^{(2)} \\cup \\gamma_0^{(3)}$。积分为每段上积分的总和：\n$$\nI(0) = \\int_{\\gamma_0^{(1)}} p\\,dq + \\int_{\\gamma_0^{(2)}} p\\,dq + \\int_{\\gamma_0^{(3)}} p\\,dq\n$$\n我们使用给定的参数化计算每个积分。$p\\,dq$ 在参数化曲线 $(q(\\lambda), p(\\lambda))$ 上的积分为 $\\int p(\\lambda) \\frac{dq}{d\\lambda} d\\lambda$。\n\n路径段 $\\gamma_0^{(1)}$: $q(\\lambda)=0$, $p(\\lambda)=\\lambda A$ for $\\lambda \\in [0,1]$.\n这里，$q(\\lambda)=0$，所以 $\\frac{dq}{d\\lambda}=0$。被积函数为零。\n$$\n\\int_{\\gamma_0^{(1)}} p\\,dq = \\int_0^1 (\\lambda A) (0) d\\lambda = 0\n$$\n\n路径段 $\\gamma_0^{(2)}$: $q(\\lambda)=\\lambda Q$, $p(\\lambda)=A$ for $\\lambda \\in [0,1]$.\n这里，$q(\\lambda)=\\lambda Q$，所以 $\\frac{dq}{d\\lambda}=Q$。$p$ 的值是常数，$p(\\lambda)=A$。\n$$\n\\int_{\\gamma_0^{(2)}} p\\,dq = \\int_0^1 (A) (Q) d\\lambda = AQ \\int_0^1 d\\lambda = AQ [\\lambda]_0^1 = AQ\n$$\n\n路径段 $\\gamma_0^{(3)}$: $q(\\lambda)=Q$, $p(\\lambda)=A(1-\\lambda)$ for $\\lambda \\in [0,1]$.\n这里，$q(\\lambda)=Q$，所以 $\\frac{dq}{d\\lambda}=0$。被积函数为零。\n$$\n\\int_{\\gamma_0^{(3)}} p\\,dq = \\int_0^1 A(1-\\lambda) (0) d\\lambda = 0\n$$\n\n将三段路径的结果相加：\n$$\nI(0) = 0 + AQ + 0 = AQ\n$$\n不变量的值为 $AQ$。",
            "answer": "$$\\boxed{AQ}$$"
        },
        {
            "introduction": "积分不变量的原理从连续系统延伸到计算力学领域，成为构建保结构数值算法的基础。最后的这个实践练习通过要求你验证一个变分积分器——特别是Störmer-Verlet方法——的守恒性质，从而将理论与计算联系起来。通过实现该积分器并将离散作用量的变分与其对应的边界项进行比较，你将获得关于相对积分不变量如何在离散设置中体现的实践洞察，并理解其对保证数值模拟长期保真度的重要性。",
            "id": "3765084",
            "problem": "考虑一个辛流形上的一维哈密顿系统，其具有正则坐标 $(q,p)$ 和正则辛形式 $\\omega = \\mathrm{d}q \\wedge \\mathrm{d}p$。设哈密顿量为 $H(q,p) = \\frac{1}{2m}p^2 + \\frac{k}{2}q^2$，其中 $m>0$ 和 $k>0$ 为常数，相应的拉格朗日量为 $L(q,\\dot{q}) = \\frac{1}{2} m \\dot{q}^2 - \\frac{k}{2} q^2$。辛积分器以大小为 $h>0$ 的离散时间步长来推进状态 $(q,p)$。\n\n通过在时间区间 $[t_k,t_{k+1}]$ 上的梯形求积，定义离散拉格朗日量 $L_d(q_k,q_{k+1};h)$：\n$$\nL_d(q_k,q_{k+1};h) = \\frac{m}{2h}(q_{k+1}-q_k)^2 - \\frac{hk}{4}\\left(q_k^2 + q_{k+1}^2\\right).\n$$\n沿序列 $\\{q_k\\}_{k=0}^{N}$ 的离散作用量是其总和\n$$\nS_d\\big(\\{q_k\\}_{k=0}^{N}\\big) = \\sum_{k=0}^{N-1} L_d(q_k,q_{k+1};h).\n$$\n相关的离散勒让德变换通过以下方式定义端点一形式：\n$$\np_k^{-} = -\\frac{\\partial L_d}{\\partial q_k}(q_k,q_{k+1};h), \\quad p_{k+1}^{+} = \\frac{\\partial L_d}{\\partial q_{k+1}}(q_k,q_{k+1};h).\n$$\n数值解 $(q_k,p_k)$ 可以通过 Störmer–Verlet 方法生成，该方法是辛的，并由下式给出：\n$$\np_{k+\\frac{1}{2}} = p_k - \\frac{h}{2} \\, \\frac{\\partial V}{\\partial q}(q_k), \\quad q_{k+1} = q_k + \\frac{h}{m} \\, p_{k+\\frac{1}{2}}, \\quad p_{k+1} = p_{k+\\frac{1}{2}} - \\frac{h}{2} \\, \\frac{\\partial V}{\\partial q}(q_{k+1}),\n$$\n其中 $V(q) = \\frac{k}{2}q^2$ 且 $\\frac{\\partial V}{\\partial q}(q) = k q$。\n\n相对积分不变量的概念将作用量的变分与由一形式定义的边界项联系起来。对于辛积分器，可以将两条邻近离散轨道上离散作用量的变化与和端点一形式相关的边界项进行比较。此外，对于线性哈密顿系统，Störmer–Verlet 方法允许一个修正方程，其具有一个由时间步长和参数 $(m,k)$ 决定的影子频率，这会在离散时间点上导出近似的连续动量。\n\n您的任务是实现以下测试，通过比较边界项来评估离散作用量总和是否近似一个相对积分不变量：\n\n1. 对每个测试用例，使用 Störmer–Verlet 方法生成两条长度为 $N$ 的离散轨道：一条从 $(q_0,p_0)$ 开始的基准轨道，和一条从 $(q_0+\\delta q_0,p_0+\\delta p_0)$ 开始的受扰轨道，其中 $\\delta q_0$ 和 $\\delta p_0$ 是小扰动。\n\n2. 使用上面给出的离散拉格朗日量 $L_d$ 计算基准轨道和受扰轨道上的离散作用量 $S_d^{\\mathrm{base}}$ 和 $S_d^{\\mathrm{pert}}$，并构成差值\n$$\n\\Delta S_d = S_d^{\\mathrm{pert}} - S_d^{\\mathrm{base}}.\n$$\n\n3. 使用离散勒让德变换计算基准轨道端点处的离散端点一形式：\n   - 在初始端点 $k=0$ 处，从 $q_0,q_1$ 计算 $p_0^{-}$。\n   - 在最终端点 $k=N$ 处，从 $q_{N-1},q_N$ 计算 $p_N^{+}$。\n\n   然后使用端点变分 $\\Delta q_0 = \\delta q_0$ 和 $\\Delta q_N = q_N^{\\mathrm{pert}} - q_N^{\\mathrm{base}}$ 构成离散边界配对：\n   $$ \n   B_{\\mathrm{disc}} = p_N^{+} \\, \\Delta q_N - p_0^{-} \\, \\Delta q_0. \n   $$\n\n4. 计算由该方法对线性振子的修正方程所预测的边界配对。令 $\\omega = \\sqrt{k/m}$ 并通过下式定义影子角 $\\theta \\in (0,\\pi)$：\n$$\n\\cos \\theta = 1 - \\frac{h^2 \\omega^2}{2},\n$$\n角度以弧度为单位。该修正方程在离散时间 $t_k$ 导出动量近似，由下式给出：\n$$\n\\tilde{p}_k = m \\, \\frac{\\theta}{\\sin \\theta} \\, \\frac{q_{k+1}-q_{k-1}}{2h},\n$$\n这是通过将中心差分与影子解的精确时间导数相匹配而导出的。使用基准轨道，通过从 $(q_0,p_0)$ 进行一个后向步得到 $q_{-1}$，以及从 $(q_N,p_N)$ 进行一个前向步得到 $q_{N+1}$，来计算 $\\tilde{p}_0$ 和 $\\tilde{p}_N$。然后构成\n$$\nB_{\\mathrm{mod}} = \\tilde{p}_N \\, \\Delta q_N - \\tilde{p}_0 \\, \\Delta q_0.\n$$\n\n5. 对于每个测试用例，输出绝对不匹配度\n$$\n\\left|\\Delta S_d - B_{\\mathrm{disc}}\\right|, \\quad \\left|\\Delta S_d - B_{\\mathrm{mod}}\\right|.\n$$\n\n角度必须以弧度处理。所有量都可以视为无量纲，因此不需要进行物理单位转换。\n\n测试套件：\n- 案例 1 (一般情况)：$m=1.0$, $k=1.0$, $h=0.05$, $N=200$, $q_0=1.0$, $p_0=0.0$, $\\delta q_0=10^{-6}$, $\\delta p_0=-2\\times 10^{-6}$。\n- 案例 2 (小步长)：$m=2.0$, $k=0.5$, $h=10^{-3}$, $N=2000$, $q_0=0.7$, $p_0=-0.3$, $\\delta q_0=5\\times 10^{-7}$, $\\delta p_0=5\\times 10^{-7}$。\n- 案例 3 (接近稳定性阈值)：$m=1.0$, $k=1.0$, $h=1.999$, $N=20$, $q_0=0.3$, $p_0=0.7$, $\\delta q_0=10^{-7}$, $\\delta p_0=-10^{-7}$。\n- 案例 4 (短轨道)：$m=1.0$, $k=1.0$, $h=0.2$, $N=2$, $q_0=0.5$, $p_0=-0.2$, $\\delta q_0=10^{-6}$, $\\delta p_0=10^{-6}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且是一个包含两个浮点数的列表：\n$$\n\\left[ [r_{1,1}, r_{1,2}], [r_{2,1}, r_{2,2}], [r_{3,1}, r_{3,2}], [r_{4,1}, r_{4,2}] \\right],\n$$\n其中对于第 $i$ 个测试用例，$r_{i,1} = \\left|\\Delta S_d - B_{\\mathrm{disc}}\\right|$ 且 $r_{i,2} = \\left|\\Delta S_d - B_{\\mathrm{mod}}\\right|$。",
            "solution": "用户提供的问题已经过分析，并被认为是**有效**的。这是一个适定的计算任务，其基础是几何力学和数值分析的既定原理，特别涉及变分积分器及其相关的守恒性质。所有必要的参数和方程都已提供，问题内部一致。\n\n解决方案通过实现问题陈述中概述的步骤进行。任务的核心是比较两条邻近轨道之间离散作用量总和的变分 $\\Delta S_d$ 与相应边界项的两种不同近似 $B_{\\mathrm{disc}}$ 和 $B_{\\mathrm{mod}}$。\n\n首先，我们必须生成所需的轨道。该系统是一个质量为 $m$、弹簧常数为 $k$ 的简谐振子。其动力学由哈密顿量 $H(q,p) = \\frac{1}{2m}p^2 + \\frac{k}{2}q^2$ 控制。问题指定使用 Störmer–Verlet 方法，这是一种二阶辛积分器。对于势 $V(q) = \\frac{k}{2}q^2$，从时间步 $t_k$ 到 $t_{k+1} = t_k+h$ 的更新由以下序列给出：\n$$\np_{k+\\frac{1}{2}} = p_k - \\frac{h}{2} \\frac{\\partial V}{\\partial q}(q_k) = p_k - \\frac{hk}{2}q_k\n$$\n$$\nq_{k+1} = q_k + \\frac{h}{m} p_{k+\\frac{1}{2}}\n$$\n$$\np_{k+1} = p_{k+\\frac{1}{2}} - \\frac{h}{2} \\frac{\\partial V}{\\partial q}(q_{k+1}) = p_{k+\\frac{1}{2}} - \\frac{hk}{2}q_{k+1}\n$$\n遵循此方案，我们生成两条长度为 $N$ 的轨道：一条从 $(q_0, p_0)$ 开始的基准轨道 $\\{(q_k^{\\mathrm{base}}, p_k^{\\mathrm{base}})\\}$ 和一条从 $(q_0+\\delta q_0, p_0+\\delta p_0)$ 开始的受扰轨道 $\\{(q_k^{\\mathrm{pert}}, p_k^{\\mathrm{pert}})\\}$。\n\n接下来，我们为每条轨道计算离散作用量 $S_d$。问题提供了离散拉格朗日量 $L_d$：\n$$\nL_d(q_k,q_{k+1};h) = \\frac{m}{2h}(q_{k+1}-q_k)^2 - \\frac{hk}{4}\\left(q_k^2 + q_{k+1}^2\\right)\n$$\n离散作用量是总和 $S_d = \\sum_{k=0}^{N-1} L_d(q_k,q_{k+1};h)$。我们分别为基准轨道和受扰轨道计算这个总和，得到 $S_d^{\\mathrm{base}}$ 和 $S_d^{\\mathrm{pert}}$，然后求出它们的差值 $\\Delta S_d = S_d^{\\mathrm{pert}} - S_d^{\\mathrm{base}}$。\n\n第三步是计算离散边界配对项 $B_{\\mathrm{disc}}$。该项源于离散变分原理。对于满足离散欧拉-拉格朗日方程的轨道，离散作用量的变分 $\\delta S_d$ 可简化为包含端点变分和离散勒让德变换的边界项。对于有限扰动，此关系是近似的。边界项由下式给出：\n$$\nB_{\\mathrm{disc}} = p_N^{+} \\, \\Delta q_N - p_0^{-} \\, \\Delta q_0\n$$\n其中 $\\Delta q_0 = \\delta q_0$ 且 $\\Delta q_N = q_N^{\\mathrm{pert}} - q_N^{\\mathrm{base}}$。端点动量 $p_0^{-}$ 和 $p_N^{+}$ 是使用所提供的离散勒让德变换从基准轨道计算得出的：\n$$\np_k^{-} = -\\frac{\\partial L_d}{\\partial q_k}(q_k,q_{k+1};h) = \\frac{m}{h}(q_{k+1}-q_k) + \\frac{hk}{2}q_k\n$$\n$$\np_{k+1}^{+} = \\frac{\\partial L_d}{\\partial q_{k+1}}(q_k,q_{k+1};h) = \\frac{m}{h}(q_{k+1}-q_k) - \\frac{hk}{2}q_{k+1}\n$$\n我们使用基准轨道的 $(q_0, q_1)$ 来评估 $p_0^{-}$，使用 $(q_{N-1}, q_N)$ 来评估 $p_N^{+}$。\n\n第四步涉及修正边界配对 $B_{\\mathrm{mod}}$，它源于修正方程或“影子哈密顿量”的概念。像 Störmer-Verlet 这样的辛积分器并不精确守恒原始的哈密顿量 $H$，但它们精确守恒一个邻近的修正哈密顿量 $H_h$。对于像谐振子这样的线性系统，积分器的轨道位于一个椭圆上，就像精确解一样，但其“影子”频率略有不同。这一概念能够在离散时间点上给出更精确的连续动量近似。影子角 $\\theta$ 由 $\\cos \\theta = 1 - \\frac{h^2 \\omega^2}{2}$ 定义，其中 $\\omega = \\sqrt{k/m}$ 是自然频率。修正动量为：\n$$\n\\tilde{p}_k = m \\, \\frac{\\theta}{\\sin \\theta} \\, \\frac{q_{k+1}-q_{k-1}}{2h}\n$$\n为了计算基准轨道的 $\\tilde{p}_0$ 和 $\\tilde{p}_N$，我们需要在区间 $[0,N]$ 之外的 $q$ 值。我们通过从 $(q_0, p_0)$ 执行单个后向 Störmer-Verlet 步来获得 $q_{-1}$，并通过从 $(q_N, p_N)$ 执行单个前向步来获得 $q_{N+1}$。$q_{-1}$ 的后向步是通过反转 Störmer-Verlet 映射导出的：$q_{-1} = q_0 - \\frac{h}{m}(p_0 + \\frac{h}{2}kq_0)$。$q_{N+1}$ 的前向步是该算法的标准应用：$q_{N+1} = q_N + \\frac{h}{m}(p_N - \\frac{h}{2}kq_N)$。\n利用这些值，我们计算 $\\tilde{p}_0$ 和 $\\tilde{p}_N$ 并构成修正边界项：\n$$\nB_{\\mathrm{mod}} = \\tilde{p}_N \\, \\Delta q_N - \\tilde{p}_0 \\, \\Delta q_0\n$$\n\n最后，对每个测试用例，我们计算两个所需的绝对不匹配度 $|\\Delta S_d - B_{\\mathrm{disc}}|$ 和 $|\\Delta S_d - B_{\\mathrm{mod}}|$。这些值量化了每个边界项近似与离散作用量的实际变分的匹配程度。结果按指定格式收集和格式化。第一个不匹配度 $|\\Delta S_d - B_{\\mathrm{disc}}|$ 预计会非常小，量级约为扰动大小的平方，这反映了离散变分原理在浮点精度和非线性效应范围内的精确性。第二个不匹配度 $|\\Delta S_d - B_{\\mathrm{mod}}|$ 测试了修正方程的动量在捕捉边界效应方面的保真度。",
            "answer": "```python\nimport numpy as np\n\ndef generate_trajectory(m, k, h, N, q0, p0):\n    \"\"\"\n    Generates a trajectory using the Störmer-Verlet method.\n    \"\"\"\n    q = np.zeros(N + 1, dtype=np.float64)\n    p = np.zeros(N + 1, dtype=np.float64)\n    q[0], p[0] = q0, p0\n    for i in range(N):\n        p_half = p[i] - (h / 2.0) * k * q[i]\n        q[i + 1] = q[i] + (h / m) * p_half\n        p[i + 1] = p_half - (h / 2.0) * k * q[i + 1]\n    return q, p\n\ndef discrete_lagrangian(m, k, h, qk, qk1):\n    \"\"\"\n    Calculates the discrete Lagrangian for a single time step.\n    \"\"\"\n    kinetic = (m / (2.0 * h)) * (qk1 - qk)**2\n    potential = (h * k / 4.0) * (qk**2 + qk1**2)\n    return kinetic - potential\n\ndef discrete_action(m, k, h, N, q_series):\n    \"\"\"\n    Computes the total discrete action along a trajectory.\n    \"\"\"\n    action = 0.0\n    for i in range(N):\n        action += discrete_lagrangian(m, k, h, q_series[i], q_series[i+1])\n    return action\n\ndef run_case(m, k, h, N, q0, p0, dq0, dp0):\n    \"\"\"\n    Runs a single test case and computes the required mismatches.\n    \"\"\"\n    # 1. Generate baseline and perturbed trajectories\n    q_base, p_base = generate_trajectory(m, k, h, N, q0, p0)\n    q_pert, p_pert = generate_trajectory(m, k, h, N, q0 + dq0, p0 + dp0)\n\n    # 2. Compute the difference in discrete action\n    action_base = discrete_action(m, k, h, N, q_base)\n    action_pert = discrete_action(m, k, h, N, q_pert)\n    delta_S_d = action_pert - action_base\n\n    # 3. Compute the discrete boundary pairing B_disc\n    delta_q0 = dq0\n    delta_qN = q_pert[N] - q_base[N]\n    \n    # p_0^- from (q_0, q_1)\n    p0_minus = (m / h) * (q_base[1] - q_base[0]) + (h * k / 2.0) * q_base[0]\n    # p_N^+ from (q_{N-1}, q_N)\n    pN_plus = (m / h) * (q_base[N] - q_base[N-1]) - (h * k / 2.0) * q_base[N]\n    \n    B_disc = pN_plus * delta_qN - p0_minus * delta_q0\n\n    # 4. Compute the modified boundary pairing B_mod\n    omega = np.sqrt(k / m)\n    cos_theta_arg = 1.0 - (h * omega)**2 / 2.0\n    \n    # The problem specifies theta is in (0, pi), so arccos is well-defined.\n    theta = np.arccos(cos_theta_arg)\n\n    # Get q_{-1} by a backward step from (q_0, p_0)\n    q_m1 = q_base[0] - (h / m) * (p_base[0] + (h / 2.0) * k * q_base[0])\n    \n    # Get q_{N+1} by a forward step from (q_N, p_N)\n    pN_half = p_base[N] - (h / 2.0) * k * q_base[N]\n    q_Np1 = q_base[N] + (h / m) * pN_half\n    \n    # Compute modified momentum at endpoints.\n    # sin(theta) is non-zero because theta is in (0, pi).\n    ratio = theta / np.sin(theta)\n\n    p0_tilde = m * ratio * (q_base[1] - q_m1) / (2.0 * h)\n    pN_tilde = m * ratio * (q_Np1 - q_base[N-1]) / (2.0 * h)\n    \n    B_mod = pN_tilde * delta_qN - p0_tilde * delta_q0\n    \n    # 5. Compute absolute mismatches\n    mismatch_disc = np.abs(delta_S_d - B_disc)\n    mismatch_mod = np.abs(delta_S_d - B_mod)\n    \n    return [mismatch_disc, mismatch_mod]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (m, k, h, N, q0, p0, delta_q0, delta_p0)\n        (1.0, 1.0, 0.05, 200, 1.0, 0.0, 1e-6, -2e-6),\n        (2.0, 0.5, 1e-3, 2000, 0.7, -0.3, 5e-7, 5e-7),\n        (1.0, 1.0, 1.999, 20, 0.3, 0.7, 1e-7, -1e-7),\n        (1.0, 1.0, 0.2, 2, 0.5, -0.2, 1e-6, 1e-6)\n    ]\n    \n    results = []\n    for params in test_cases:\n        res = run_case(*params)\n        results.append(res)\n    \n    # Format output as specified: [[r11,r12],[r21,r22],...]\n    print(f\"[{','.join(map(str, results))}]\".replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}