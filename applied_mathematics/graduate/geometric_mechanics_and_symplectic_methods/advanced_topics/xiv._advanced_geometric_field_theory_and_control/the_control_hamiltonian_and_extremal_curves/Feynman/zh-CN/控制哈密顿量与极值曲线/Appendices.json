{
    "hands_on_practices": [
        {
            "introduction": "本章旨在通过一系列动手实践，将控制哈密顿量和极值曲线的理论应用于具体问题。我们将从一个基础的受控谐振子模型出发，逐步掌握庞特里亚金极大值原理 (Pontryagin Maximum Principle, PMP) 的核心应用方法。这个练习  将引导你完整地走一遍PMP的流程：构建控制哈密顿量，通过最大化求解最优控制律，并最终推导出描述最优轨迹的“最大化哈密顿量”。通过这个过程，你还将验证一个基本而重要的结论：对于自治系统，最大化哈密顿量本身是一个守恒量。",
            "id": "3774822",
            "problem": "考虑一个位形空间为 $\\mathbb{R}$ 的受控正则力学系统，其广义坐标为 $q$，共轭动量为 $p$，由以下漂移加控制动力学给出：\n$$\n\\dot{q} = p, \\qquad \\dot{p} = -\\omega^{2} q + u,\n$$\n其中 $\\omega  0$ 是一个固定频率参数，$u$ 是一个标量控制。性能指标是二次能量泛函：\n$$\nJ[u] = \\int_{0}^{T} \\frac{1}{2} r\\, u(t)^{2}\\, \\mathrm{d}t,\n$$\n其中 $r  0$ 是常数，$T  0$ 是一个固定的终端时间。任务是分析状态空间 $X = \\mathbb{R}^{2}$ 的余切丛 $T^{\\ast}X$ 中的极值曲线，其中 $x = (q,p)$，协态为 $\\lambda = (\\lambda_{q}, \\lambda_{p})$。使用 $T^{\\ast}X$ 上的正则辛形式（记为 $\\omega_{\\mathrm{can}}$）和庞特里亚金极大值原理 (PMP)，后者引入了由下式定义的控制哈密顿量：\n$$\n\\mathcal{H}(x,\\lambda,u) = \\lambda \\cdot f(x,u) - L(x,u),\n$$\n其中 $f(x,u)$ 是状态动力学，$L(x,u)$ 是运行成本密度。\n\n从上述基本定义和事实出发，执行以下步骤：\n\n1.  利用给定的 $f$ 和 $L$，推导该系统的显式控制哈密顿量 $\\mathcal{H}(q,p,\\lambda_{q},\\lambda_{p},u)$。\n2.  确定使 $\\mathcal{H}$ 对 $u$ 逐点最大化的控制 $u^{\\ast}$。\n3.  将 $u^{\\ast}$ 代回以获得最大化的哈密顿量 $\\mathcal{H}^{\\ast}(q,p,\\lambda_{q},\\lambda_{p})$，并写出与 $\\mathcal{H}^{\\ast}$ 和 $\\omega_{\\mathrm{can}}$ 相关联的 $T^{\\ast}X$ 上的极值提升 $(q,p,\\lambda_{q},\\lambda_{p})$ 的正则哈密顿系统。\n4.  仅利用哈密顿流的辛不变性和最大化哈密顿量的时间自治性，论证 $\\mathcal{H}^{\\ast}$ 沿着极值曲线是守恒的。\n5.  给定初始条件 $q(0) = q_{0}$、$p(0) = p_{0}$、$\\lambda_{q}(0) = \\alpha$ 和 $\\lambda_{p}(0) = \\beta$，计算 $\\mathcal{H}^{\\ast}$ 沿着极值曲线的恒定值。将你的最终答案表示为单一的闭式解析表达式。\n\n你的最终答案必须是单一的解析表达式。无需四舍五入。最终答案中不应包含物理单位。",
            "solution": "通过遵循指定的五个步骤来分析和解决该问题。\n\n### 第一步：推导控制哈密顿量\n\n问题给出了状态空间 $X = \\mathbb{R}^{2}$，其坐标为 $x = (q,p)$，其中 $q$ 是广义坐标，$p$ 是共轭动量。状态动力学由向量场 $f(x,u)$ 给出：\n$$\n\\dot{x} = \\begin{pmatrix} \\dot{q} \\\\ \\dot{p} \\end{pmatrix} = f(x,u) = \\begin{pmatrix} p \\\\ -\\omega^{2} q + u \\end{pmatrix}\n$$\n运行成本由拉格朗日量 $L(x,u) = \\frac{1}{2} r u(t)^{2}$ 给出。\n\n庞特里亚金极大值原理 (PMP) 在余切丛 $T^{\\ast}X$ 上引入了一个控制哈密顿量 $\\mathcal{H}$。$T^{\\ast}X$ 上的坐标为 $(x, \\lambda) = (q, p, \\lambda_{q}, \\lambda_{p})$，其中 $\\lambda = (\\lambda_{q}, \\lambda_{p})$ 是协态。控制哈密顿量定义为：\n$$\n\\mathcal{H}(x,\\lambda,u) = \\lambda \\cdot f(x,u) - L(x,u)\n$$\n代入给定的 $f(x,u)$ 和 $L(x,u)$ 表达式，我们得到：\n$$\n\\mathcal{H}(q,p,\\lambda_{q},\\lambda_{p},u) = \\begin{pmatrix} \\lambda_{q}  \\lambda_{p} \\end{pmatrix} \\begin{pmatrix} p \\\\ -\\omega^{2} q + u \\end{pmatrix} - \\frac{1}{2} r u^{2}\n$$\n展开点积可得控制哈密顿量的显式形式：\n$$\n\\mathcal{H}(q,p,\\lambda_{q},\\lambda_{p},u) = \\lambda_{q} p + \\lambda_{p}(-\\omega^{2} q + u) - \\frac{1}{2} r u^{2}\n$$\n\n### 第二步：确定最优控制\n\n根据 PMP，对于一条极值曲线，对于给定的状态 $x(t)$ 和协态 $\\lambda(t)$，控制 $u^{\\ast}(t)$ 必须在时间上逐点最大化哈密顿量 $\\mathcal{H}$。为了找到使 $\\mathcal{H}$ 最大化的控制 $u^{\\ast}$，我们将 $(q, p, \\lambda_{q}, \\lambda_{p})$ 视为固定参数，并对 $u$ 进行优化。\n\n我们计算 $\\mathcal{H}$ 关于 $u$ 的一阶和二阶偏导数：\n$$\n\\frac{\\partial \\mathcal{H}}{\\partial u} = \\lambda_{p} - r u\n$$\n令一阶导数为零，得到极值的必要条件：\n$$\n\\lambda_{p} - r u = 0 \\implies u = \\frac{\\lambda_{p}}{r}\n$$\n为确认这是一个最大值，我们检查二阶导数：\n$$\n\\frac{\\partial^{2} \\mathcal{H}}{\\partial u^{2}} = -r\n$$\n由于问题陈述 $r  0$，二阶导数为负。这证实了 $u = \\frac{\\lambda_{p}}{r}$ 这个值是 $\\mathcal{H}$ 的全局最大值点。因此，最优控制为：\n$$\nu^{\\ast}(q,p,\\lambda_{q},\\lambda_{p}) = \\frac{\\lambda_{p}}{r}\n$$\n\n### 第三步：最大化的哈密顿量与正则系统\n\n将最优控制 $u^{\\ast}$ 代回 $\\mathcal{H}$ 的表达式，得到最大化的哈密顿量，记为 $\\mathcal{H}^{\\ast}$：\n$$\n\\mathcal{H}^{\\ast}(q,p,\\lambda_{q},\\lambda_{p}) = \\mathcal{H}(q,p,\\lambda_{q},\\lambda_{p},u^{\\ast}) = \\lambda_{q} p + \\lambda_{p}(-\\omega^{2} q + u^{\\ast}) - \\frac{1}{2} r (u^{\\ast})^{2}\n$$\n$$\n\\mathcal{H}^{\\ast} = \\lambda_{q} p + \\lambda_{p}\\left(-\\omega^{2} q + \\frac{\\lambda_{p}}{r}\\right) - \\frac{1}{2} r \\left(\\frac{\\lambda_{p}}{r}\\right)^{2}\n$$\n化简表达式：\n$$\n\\mathcal{H}^{\\ast} = \\lambda_{q} p - \\omega^{2} q \\lambda_{p} + \\frac{\\lambda_{p}^{2}}{r} - \\frac{1}{2} \\frac{\\lambda_{p}^{2}}{r}\n$$\n$$\n\\mathcal{H}^{\\ast}(q,p,\\lambda_{q},\\lambda_{p}) = \\lambda_{q} p - \\omega^{2} q \\lambda_{p} + \\frac{1}{2r} \\lambda_{p}^{2}\n$$\n这个函数 $\\mathcal{H}^{\\ast}$ 是辛流形 $(T^{\\ast}X, \\omega_{\\mathrm{can}})$ 上的极值曲线的真正哈密顿量，其中 $T^{\\ast}X \\cong \\mathbb{R}^{4}$ 的坐标为 $(q,p,\\lambda_{q},\\lambda_{p})$，正则辛形式为 $\\omega_{\\mathrm{can}} = \\mathrm{d}\\lambda_{q} \\wedge \\mathrm{d}q + \\mathrm{d}\\lambda_{p} \\wedge \\mathrm{d}p$。极值提升的动力学由 $\\mathcal{H}^{\\ast}$ 的哈密顿方程给出：\n- $\\dot{q} = \\frac{\\partial \\mathcal{H}^{\\ast}}{\\partial \\lambda_{q}} = p$\n- $\\dot{p} = \\frac{\\partial \\mathcal{H}^{\\ast}}{\\partial \\lambda_{p}} = -\\omega^{2} q + \\frac{1}{r} \\lambda_{p}$\n- $\\dot{\\lambda}_{q} = -\\frac{\\partial \\mathcal{H}^{\\ast}}{\\partial q} = -(-\\omega^{2} \\lambda_{p}) = \\omega^{2} \\lambda_{p}$\n- $\\dot{\\lambda}_{p} = -\\frac{\\partial \\mathcal{H}^{\\ast}}{\\partial p} = -(\\lambda_{q}) = -\\lambda_{q}$\n\n这就是 $T^{\\ast}X$ 上极值提升 $(q(t), p(t), \\lambda_{q}(t), \\lambda_{p}(t))$ 的正则哈密顿系统。\n\n### 第四步：最大化哈密顿量的守恒性\n\n最大化的哈密顿量 $\\mathcal{H}^{\\ast}$ 是相空间 $T^{\\ast}X$ 上的一个函数，并且不显式依赖于时间 $t$。这样的哈密顿量被称为自治的或不依赖于时间的。极值曲线是在辛流形 $(T^{\\ast}X, \\omega_{\\mathrm{can}})$ 上与 $\\mathcal{H}^{\\ast}$ 相关联的哈密顿向量场 $X_{\\mathcal{H}^{\\ast}}$ 的积分曲线。\n\n对于任何哈密顿系统，函数 $F$ 沿着流的时间演化由泊松括号给出：$\\frac{\\mathrm{d}F}{\\mathrm{d}t} = \\{F, H\\} + \\frac{\\partial F}{\\partial t}$。将此应用于哈密顿量 $H=\\mathcal{H}^{\\ast}$ 本身，我们有：\n$$\n\\frac{\\mathrm{d}\\mathcal{H}^{\\ast}}{\\mathrm{d}t} = \\{\\mathcal{H}^{\\ast}, \\mathcal{H}^{\\ast}\\} + \\frac{\\partial \\mathcal{H}^{\\ast}}{\\partial t}\n$$\n泊松括号是反对称的，这意味着对于任何函数 $F$，都有 $\\{F, F\\} = 0$。因此，$\\{\\mathcal{H}^{\\ast}, \\mathcal{H}^{\\ast}\\} = 0$。\n此外，如前所述，$\\mathcal{H}^{\\ast}$ 是时间自治的，所以它关于时间的偏导数为零：$\\frac{\\partial \\mathcal{H}^{\\ast}}{\\partial t} = 0$。\n结合这些事实，我们得到：\n$$\n\\frac{\\mathrm{d}\\mathcal{H}^{\\ast}}{\\mathrm{d}t} = 0 + 0 = 0\n$$\n这表明 $\\mathcal{H}^{\\ast}$ 沿着任何极值曲线都是一个运动常数。这是哈密顿力学中的一个基本结果：对于一个自治系统，哈密顿量本身就是一个守恒量（运动积分）。“哈密顿流的辛不变性”指的是流由辛同胚组成这一事实，这是导致包括此守恒定律在内的这类守恒定律的几何基础。\n\n### 第五步：计算 $\\mathcal{H}^{\\ast}$ 的恒定值\n\n由于 $\\mathcal{H}^{\\ast}$ 沿着任何极值曲线都是守恒的，它的值是一个常数，等于它在 $t=0$ 时的初始值。我们已知初始条件：\n$$\nq(0) = q_{0}, \\quad p(0) = p_{0}, \\quad \\lambda_{q}(0) = \\alpha, \\quad \\lambda_{p}(0) = \\beta\n$$\n我们将这些初始值代入，计算 $\\mathcal{H}^{\\ast}$ 在 $t=0$ 时的值：\n$$\n\\mathcal{H}^{\\ast}(t=0) = \\mathcal{H}^{\\ast}(q(0), p(0), \\lambda_{q}(0), \\lambda_{p}(0)) = \\lambda_{q}(0)p(0) - \\omega^{2}q(0)\\lambda_{p}(0) + \\frac{1}{2r}(\\lambda_{p}(0))^{2}\n$$\n$$\n\\text{恒定值 } \\mathcal{H}^{\\ast} = \\alpha p_{0} - \\omega^{2} q_{0} \\beta + \\frac{1}{2r}\\beta^{2}\n$$\n这就是由给定初始条件所确定的唯一极值曲线上最大化哈密顿量的恒定值。",
            "answer": "$$\n\\boxed{\\alpha p_{0} - \\omega^{2} q_{0} \\beta + \\frac{\\beta^{2}}{2r}}\n$$"
        },
        {
            "introduction": "在掌握了PMP的基本流程后，我们来解决一个在实际应用中更常见的问题：如何将系统从一个给定的初始状态精确引导至一个期望的末端状态。这类问题本质上是一个两点边值问题 (two-point boundary value problem, TPBVP)。这个练习  将以一个简单的双积分器系统为例，介绍如何运用“打靶法” (shooting method) 的思想来求解这类问题。你将学习如何利用初始伴随状态 (costate) 来参数化所有可能的极值曲线族，然后通过求解一个代数方程组来“瞄准”并找到那条恰好能“击中”目标终点的最优轨迹。",
            "id": "3774821",
            "problem": "考虑一个实数轴上的受控力学系统，其位形变量为 $q$，速度为 $v$。控制输入为 $u$。状态为 $x = (q, v)$，动力学由基本运动学和动力学关系 $ \\dot{q} = v$ 和 $ \\dot{v} = u$ 给出。要最小化的性能指标是在固定时间区间 $T  0$ 上的作用量 $J[u] = \\int_{0}^{T} \\frac{1}{2} u(t)^2 \\, \\mathrm{d}t$，并受限于端点约束 $q(0) = q_0$，$v(0) = v_0$，$q(T) = q_T$ 和 $v(T) = v_T$。\n\n使用 Pontryagin 极大值原理进行最优控制，并利用余切丛 $T^*X$ 上的几何力学和典范辛形式来构造控制哈密顿量，并推导极值曲线的必要条件。然后，为一族参数化的极值曲线设计一个打靶法，以满足端点约束。具体而言：\n\n- 使用标准配对 $ \\langle p, f(x,u) \\rangle$ 和被积函数中的拉格朗日项来定义控制哈密顿量 $H(q, v, p_q, p_v, u)$。推导 $H$ 关于 $u$ 的最小化子以及 $(q, v, p_q, p_v)$ 的哈密顿系统。\n- 证明协态 $p_q$ 是常数，$p_v$ 是时间的仿射函数，并引入参数 $c_1 = p_q(0)$ 和 $c_2 = p_v(0)$，从而获得一族参数化的极值曲线 $(q(t; c_1, c_2), v(t; c_1, c_2))$。\n- 通过施加终端约束 $q(T; c_1, c_2) = q_T$ 和 $v(T; c_1, c_2) = v_T$ 来建立打靶方程。使用牛顿法求解 $(c_1, c_2)$，其中使用从状态转移关系到终端时间推导出的关于 $(c_1, c_2)$ 的雅可比矩阵。\n\n你的程序必须：\n- 实现上述参数化打靶法，为每个测试用例计算满足终端约束的唯一参数对 $(c_1, c_2)$（假设所选的测试用例都存在唯一解）。\n- 对于得到的极值曲线，计算最小作用量值 $J^\\star = \\int_{0}^{T} \\frac{1}{2} u(t)^2 \\, \\mathrm{d}t$，其中 $u(t)$ 是从哈密顿最小化条件中获得的。\n- 为指定的测试套件生成一行输出，包含作用量值的列表 $[J_1, J_2, \\dots]$，每个元素都以浮点数形式打印。格式必须是方括号内用逗号分隔的列表，且没有空格（例如 $[1.0,2.0]$）。\n\n使用以下参数值的测试套件，涵盖一般情况、边界条件和边缘情况：\n- 情况 1：$T = 1$，$q_0 = 0$，$v_0 = 0$，$q_T = 1$，$v_T = 0$。\n- 情况 2：$T = 2$，$q_0 = 0$，$v_0 = 0$，$q_T = 0$，$v_T = 0$。\n- 情况 3：$T = \\frac{1}{2}$，$q_0 = 0$，$v_0 = 1$，$q_T = 1$，$v_T = 0$。\n- 情况 4：$T = 1$，$q_0 = 0$，$v_0 = 0$，$q_T = 0$，$v_T = 1$。\n\n你的程序应生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如 $[J_1,J_2,J_3,J_4]$）。不需要物理单位；所有量纲均为无量纲。不涉及角度。不涉及百分比。输出必须是浮点数。",
            "solution": "经评估，该问题有效。这是一个定义明确、自成体系且科学上合理的最优控制问题，基于力学和控制理论的基本原理。所有必要的数据和条件都已提供，不存在内部矛盾或不适定因素。我们可以着手求解。\n\n该问题的核心是找到一个最优控制 $u(t)$，它能在一个固定的时间 $T$ 内，将一个简单的力学系统从给定的初始状态 $(q_0, v_0)$ 驱动到最终状态 $(q_T, v_T)$，同时最小化由作用量积分 $J[u] = \\int_{0}^{T} \\frac{1}{2} u(t)^2 \\, \\mathrm{d}t$ 度量的总控制能量。我们采用庞特里亚金原理来推导最优轨迹（一条极值曲线）的必要条件。\n\n系统的状态为 $x = (q, v)$，动力学由 $\\dot{x} = f(x, u)$ 给出，其中：\n$$ \\dot{q} = v $$\n$$ \\dot{v} = u $$\n待最小化的成本函数是 $J[u] = \\int_{0}^{T} L(x, u) \\, \\mathrm{d}t$，其中拉格朗日量（或运行成本）为 $L(x, u) = \\frac{1}{2} u^2$。\n\n**第1步：控制哈密顿量和最优性条件**\n\n根据庞特里亚金原理，我们引入协态变量 $p = (p_q, p_v)$ 并构造控制哈密顿量 $H(x, p, u)$。对于最小化问题，标准惯例是定义 $H = L + p^T f$，然后对 $u$ 进行最小化。\n$$ H(q, v, p_q, p_v, u) = L(x, u) + p_q \\dot{q} + p_v \\dot{v} $$\n$$ H(q, v, p_q, p_v, u) = \\frac{1}{2} u^2 + p_q v + p_v u $$\n对于一条极值轨迹，最优控制 $u^\\star(t)$ 必须在每个时刻最小化 $H$。我们通过将 $H$ 对 $u$ 的偏导数设为零来找到这个最小化子：\n$$ \\frac{\\partial H}{\\partial u} = u + p_v = 0 \\implies u^\\star(t) = -p_v(t) $$\n二阶导数 $\\frac{\\partial^2 H}{\\partial u^2} = 1  0$ 证实了这确实是一个最小值。\n\n**第2步：极值曲线的哈密顿系统**\n\n我们将最优控制 $u^\\star = -p_v$ 代回哈密顿量，得到“真”哈密顿量 $H^\\star$，它控制着状态和协态沿着极值曲线的流动：\n$$ H^\\star(q, v, p_q, p_v) = \\frac{1}{2}(-p_v)^2 + p_q v + p_v(-p_v) = p_q v - \\frac{1}{2}p_v^2 $$\n状态 $(q, v)$ 和协态 $(p_q, p_v)$ 沿极值曲线的动力学由哈密顿方程给出：\n$$ \\dot{q} = \\frac{\\partial H^\\star}{\\partial p_q} = v \\qquad \\dot{p}_q = -\\frac{\\partial H^\\star}{\\partial q} = 0 $$\n$$ \\dot{v} = \\frac{\\partial H^\\star}{\\partial p_v} = -p_v \\qquad \\dot{p}_v = -\\frac{\\partial H^\\star}{\\partial v} = -p_q $$\n这四个方程构成了描述所有可能极值路径的哈密顿系统。\n\n**第3步：求解参数化的极值曲线**\n\n我们可以解析地求解这个常微分方程组。\n从 $\\dot{p}_q = 0$ 可知，$p_q(t)$ 是常数。设 $p_q(t) = c_1$，其中 $c_1 = p_q(0)$。\n然后，$\\dot{p}_v = -p_q = -c_1$。对时间积分得到 $p_v(t) = -c_1 t + c_2$，其中 $c_2 = p_v(0)$。这证实了 $p_q$ 是常数，$p_v$ 是时间的仿射函数。\n\n现在我们求解状态变量。最优控制为 $u^\\star(t) = -p_v(t) = c_1 t - c_2$。\n将其代入 $v$ 的动力学方程：\n$$ \\dot{v}(t) = u^\\star(t) = c_1 t - c_2 $$\n使用初始条件 $v(0) = v_0$ 从 $0$ 到 $t$ 积分：\n$$ v(t) = v_0 + \\int_{0}^{t} (c_1 \\tau - c_2) d\\tau = v_0 + \\frac{1}{2}c_1 t^2 - c_2 t $$\n接下来，我们使用 $\\dot{q} = v(t)$ 和初始条件 $q(0) = q_0$ 来求解 $q(t)$：\n$$ q(t) = q_0 + \\int_{0}^{t} \\left(v_0 + \\frac{1}{2}c_1 \\tau^2 - c_2 \\tau \\right) d\\tau = q_0 + v_0 t + \\frac{1}{6}c_1 t^3 - \\frac{1}{2}c_2 t^2 $$\n我们现在找到了一个由初始协态 $c_1$ 和 $c_2$ 参数化的双参数极值曲线族 $(q(t; c_1, c_2), v(t; c_1, c_2))$。\n\n**第4步：打靶法**\n\n打靶法在于找到参数 $(c_1, c_2)$ 的唯一值，使得所得轨迹满足终端边界条件 $q(T) = q_T$ 和 $v(T) = v_T$。我们通过将 $t=T$ 代入 $q(t)$ 和 $v(t)$ 的解来施加这些条件：\n$$ q_T = q_0 + v_0 T + \\frac{1}{6}c_1 T^3 - \\frac{1}{2}c_2 T^2 $$\n$$ v_T = v_0 + \\frac{1}{2}c_1 T^2 - c_2 T $$\n这是一个关于两个未知数 $c_1$ 和 $c_2$ 的二元线性方程组。我们可以将其写成矩阵形式 $A \\mathbf{c} = \\mathbf{b}$，其中 $\\mathbf{c} = [c_1, c_2]^T$：\n$$ \\begin{pmatrix} \\frac{T^3}{6}  -\\frac{T^2}{2} \\\\ \\frac{T^2}{2}  -T \\end{pmatrix} \\begin{pmatrix} c_1 \\\\ c_2 \\end{pmatrix} = \\begin{pmatrix} q_T - q_0 - v_0 T \\\\ v_T - v_0 \\end{pmatrix} $$\n矩阵 $A$ 是打靶函数 $F(c_1, c_2) = (q(T; c_1, c_2) - q_T, v(T; c_1, c_2) - v_T)^T$ 的雅可比矩阵。由于问题是线性的，用于求解 $F(c_1, c_2) = 0$ 的牛顿法在一步之内收敛到精确解 $\\mathbf{c} = A^{-1} \\mathbf{b}$。$A$ 的行列式为 $\\det(A) = -T^4/6 - (-T^4/4) = T^4/12$。由于 $T0$，该矩阵始终可逆，保证了 $(c_1, c_2)$ 存在唯一解。\n\n逆矩阵为：\n$$ A^{-1} = \\frac{12}{T^4} \\begin{pmatrix} -T  T^2/2 \\\\ -T^2/2  T^3/6 \\end{pmatrix} = \\begin{pmatrix} -12/T^3  6/T^2 \\\\ -6/T^2  2/T \\end{pmatrix} $$\n求解 $c_1$ 和 $c_2$：\n$$ c_1 = -\\frac{12}{T^3}(q_T - q_0 - v_0 T) + \\frac{6}{T^2}(v_T - v_0) $$\n$$ c_2 = -\\frac{6}{T^2}(q_T - q_0 - v_0 T) + \\frac{2}{T}(v_T - v_0) $$\n这些解析公式将在代码中实现。\n\n**第5步：计算最小作用量**\n\n最后，我们使用最优控制 $u^\\star(t) = c_1 t - c_2$ 计算最小作用量 $J^\\star$。\n$$ J^\\star = \\int_{0}^{T} \\frac{1}{2} (u^\\star(t))^2 \\, \\mathrm{d}t = \\frac{1}{2} \\int_{0}^{T} (c_1 t - c_2)^2 \\, \\mathrm{d}t $$\n$$ J^\\star = \\frac{1}{2} \\int_{0}^{T} (c_1^2 t^2 - 2c_1 c_2 t + c_2^2) \\, \\mathrm{d}t $$\n$$ J^\\star = \\frac{1}{2} \\left[ \\frac{1}{3}c_1^2 t^3 - c_1 c_2 t^2 + c_2^2 t \\right]_0^T $$\n$$ J^\\star = \\frac{1}{2} \\left( \\frac{1}{3}c_1^2 T^3 - c_1 c_2 T^2 + c_2^2 T \\right) $$\n程序将使用这些解析公式为每个测试用例计算 $c_1$、$c_2$，并随后计算 $J^\\star$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the optimal control problem for a set of test cases using an\n    analytical solution derived from Pontryagin's Maximum Principle.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (T, q0, v0, qT, vT)\n    test_cases = [\n        (1.0, 0.0, 0.0, 1.0, 0.0),  # Case 1\n        (2.0, 0.0, 0.0, 0.0, 0.0),  # Case 2\n        (0.5, 0.0, 1.0, 1.0, 0.0),  # Case 3\n        (1.0, 0.0, 0.0, 0.0, 1.0),  # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        T, q0, v0, qT, vT = case\n\n        # The shooting method for this linear problem reduces to solving a 2x2\n        # linear system A*c = b for the initial costates c = [c1, c2]^T.\n        #\n        # A = [[T^3/6, -T^2/2],\n        #      [T^2/2, -T]]\n        #\n        # b = [qT - q0 - v0*T,\n        #      vT - v0]\n        #\n        # We use the direct analytical solution c = A_inv * b.\n\n        b1 = qT - q0 - v0 * T\n        b2 = vT - v0\n\n        # Precompute powers of T\n        T2 = T * T\n        T3 = T2 * T\n\n        # Analytical solution for c1 and c2 from the inverted system matrix.\n        # This is equivalent to one step of Newton's method.\n        # c1 = (-12/T^3)*b1 + (6/T^2)*b2\n        # c2 = (-6/T^2)*b1 + (2/T)*b2\n        c1 = -12.0 * b1 / T3 + 6.0 * b2 / T2\n        c2 = -6.0 * b1 / T2 + 2.0 * b2 / T\n\n        # Calculate the minimal action J* using the derived formula:\n        # J* = 0.5 * ( (1/3)*c1^2*T^3 - c1*c2*T^2 + c2^2*T )\n        cost = 0.5 * (c1**2 * T3 / 3.0 - c1 * c2 * T2 + c2**2 * T)\n        \n        results.append(cost)\n\n    # Format the output as a comma-separated list of floating-point numbers\n    # enclosed in square brackets, with no spaces.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "哈密顿控制理论的优美之处在于其普适性，它并不仅限于欧几里得空间中的简单系统。这个进阶练习  将带领我们进入一个更抽象但几何内涵丰富的领域：次黎曼几何。我们将探讨在著名的海森堡群 (Heisenberg group) 上，如何寻找能量最小的路径，即次黎曼测地线。通过应用相同的PMP框架，你将发现这些非欧空间中的极值曲线所具有的独特几何结构与优美规律，深刻体会到几何力学方法的强大与统一。",
            "id": "3767471",
            "problem": "考虑一个具有全局坐标 $(x,y,z)$ 的三维海森堡流形和一个秩为2的分布 $\\mathcal{D}=\\mathrm{span}\\{X_1,X_2\\}$，其中 $X_1=\\partial_x-\\frac{y}{2}\\partial_z$ 且 $X_2=\\partial_y+\\frac{x}{2}\\partial_z$。为 $\\mathcal{D}$ 配备一个次黎曼度量，使得 $X_1$ 和 $X_2$ 是标准正交的。一条水平曲线 $q(t)=(x(t),y(t),z(t))$ 服从受控动力学 $\\dot{q}(t)=u_1(t)X_1(q(t))+u_2(t)X_2(q(t))$，其中 $u_1,u_2$ 是可测控制。成本是在固定时域 $T0$ 上的动能泛函 $J(u)=\\frac{1}{2}\\int_0^T\\left(u_1(t)^2+u_2(t)^2\\right)\\,\\mathrm{d}t$。\n\n从以下基本事实和原理出发：\n- 当 $\\mathcal{D}$ 的李括号闭包张成切空间时，Chow–Rashevskii 定理保证了小时间可控性。\n- 用于能量最小化控制系统的庞特里亚金极大值原理 (Pontryagin Maximum Principle, PMP) 产生一个非平凡余向量 $p(t)\\in T^*_{q(t)}M$ 和在赋予了典范辛形式的余切丛 $T^*M$ 上的极大化哈密顿量 $H$，使得极值曲线满足哈密顿方程 $\\dot{q}=\\frac{\\partial H}{\\partial p}$ 和 $\\dot{p}=-\\frac{\\partial H}{\\partial q}$，以及依赖于控制的哈密顿量的逐点极大化。\n- $X_1,X_2$ 在次黎曼度量下的标准正交性意味着能量哈密顿量二次依赖于余向量求值 $h_i(t)=\\langle p(t),X_i(q(t))\\rangle$。\n\n任务：\n1. 写出该海森堡控制系统的庞特里亚金极大值原理方程，明确指出极大化哈密顿量 $H$、状态-协态（哈密顿）系统，以及控制 $u_1,u_2$ 和余向量分量之间的最优反馈关系。\n2. 在垂直余向量分量 $\\lambda:=p_z$ 为非零常数，且哈密顿量能级固定为 $H=\\frac{1}{2}\\rho^2$（其中 $\\rho0$）的情况下，通过求解哈密顿系统来确定正常极值曲线。施加初始条件 $q(0)=(0,0,0)$，并选择旋转相位使得 $t=0$ 处的切向量没有 $y$ 分量（这将相位正则化以简化最终表达式）。你的推导必须从所述原理出发，逐步进行，直至得到显式轨迹。\n\n答案规格：\n- 使用标准函数，将最终轨迹 $(x(t),y(t),z(t))$ 表示为关于参数 $\\rho0$、$\\lambda\\neq 0$ 和时间 $t$ 的单个闭式解析表达式。\n- 使用 $\\mathrm{pmatrix}$ 环境，按 $x(t)$、$y(t)$、$z(t)$ 的顺序，将最终答案表示为矩阵中的单行。\n- 无需进行数值舍入。",
            "solution": "首先对问题进行严格的验证过程。\n\n### 第 1 步：提取已知条件\n- **流形与坐标**：具有全局坐标 $(x,y,z)$ 的三维海森堡流形。\n- **分布**：秩为2的分布 $\\mathcal{D}=\\mathrm{span}\\{X_1,X_2\\}$。\n- **矢量场**：$X_1=\\partial_x-\\frac{y}{2}\\partial_z$ 和 $X_2=\\partial_y+\\frac{x}{2}\\partial_z$。\n- **度量**：使 $\\{X_1, X_2\\}$ 标准正交的次黎曼度量。\n- **动力学**：水平曲线 $q(t)=(x(t),y(t),z(t))$ 的动力学为 $\\dot{q}(t)=u_1(t)X_1(q(t))+u_2(t)X_2(q(t))$。\n- **控制**：$u_1(t), u_2(t)$ 是可测函数。\n- **成本泛函**：动能 $J(u)=\\frac{1}{2}\\int_0^T\\left(u_1(t)^2+u_2(t)^2\\right)\\,\\mathrm{d}t$，在固定时域 $[0,T]$ 上，其中 $T0$。\n- **基本原理**：\n    1.  用于小时间可控性的 Chow–Rashevskii 定理。\n    2.  用于能量最小化系统的庞特里亚金极大值原理 (PMP)，导出余切丛 $T^*M$ 上的哈密顿方程。\n    3.  $X_1, X_2$ 的标准正交性意味着哈密顿量为 $H = \\frac{1}{2}(h_1^2 + h_2^2)$，其中 $h_i = \\langle p, X_i \\rangle$。\n- **任务**：\n    1.  构建 PMP 方程：极大化哈密顿量 $H$、状态-协态系统和最优控制反馈律。\n    2.  在以下条件下求解正常极值曲线：\n        - $p_z(t) = \\lambda$ 是一个非零常数。\n        - 哈密顿量能级为 $H=\\frac{1}{2}\\rho^2$，其中 $\\rho0$。\n        - 初始条件为 $q(0)=(0,0,0)$。\n        - 相位正则化：$t=0$ 处的切向量没有 $y$ 分量。\n- **答案规格**：\n    - 最终答案是轨迹 $(x(t), y(t), z(t))$ 的单个闭式表达式。\n    - 格式为使用 $\\mathrm{pmatrix}$ 环境的单行矩阵。\n\n### 第 2 步：使用提取的已知条件进行验证\n对问题的有效性进行分析。\n- **科学依据**：该问题是次黎曼几何和几何控制理论中的一个典型例子。海森堡群、其次黎曼结构以及庞特里亚金极大值原理的应用都是数学和理论物理中标准且完善的概念。系统的可控性是控制问题有意义的先决条件，由 Chow–Rashevskii 定理保证。我们通过计算生成矢量场的李括号来验证这一点：\n$$\n[X_1, X_2] = \\left[\\partial_x - \\frac{y}{2}\\partial_z, \\partial_y + \\frac{x}{2}\\partial_z\\right]\n= [\\partial_x, \\frac{x}{2}\\partial_z] - \\left[\\frac{y}{2}\\partial_z, \\partial_y\\right]\n= \\frac{1}{2}\\partial_z - \\left(-\\frac{1}{2}\\partial_z\\right) = \\partial_z.\n$$\n由于 $\\{X_1(q), X_2(q), [X_1,X_2](q)\\}$ 在每一点 $q$ 都张成切空间 $T_q M$，因此分布 $\\mathcal{D}$ 是括号生成的。该问题在科学上是合理的。\n- **适定性**：该问题提供了足够的数据和约束来确定唯一解。任务是在给定的能量、动量和初始条件下，找到一组特定的极值曲线（测地线）。相位正则化固定了解中的最后一个自由度。该问题是适定的。\n- **客观性**：该问题使用精确的数学语言陈述，没有歧义或主观内容。\n- **缺陷分析**：该问题不违反任何无效性标准。它在科学上是合理的，可形式化、完整、内部一致，并且构成了其领域内一个非平凡的标准问题。\n\n### 第 3 步：结论与行动\n问题是 **有效的**。开始求解。\n\n### 任务 1：庞特里亚金极大值原理的构建\n\n状态为 $q=(x,y,z)$，控制为 $u=(u_1, u_2)$。动力学为 $\\dot{q} = u_1 X_1 + u_2 X_2$。拉格朗日量为 $L(u) = \\frac{1}{2}(u_1^2 + u_2^2)$。PMP 引入一个余向量 $p(t) = (p_x(t), p_y(t), p_z(t)) \\in T^*_{q(t)}M$。依赖于控制的哈密顿量为 $H_u = \\langle p, \\dot{q} \\rangle - L_0$，其中 $L_0$ 是成本的被积函数。问题旨在最小化能量，这对应于选择 $L_0 = L(u)=\\frac{1}{2}(u_1^2+u_2^2)$。\n\n依赖于控制的哈密顿量为：\n$$ H_u(q,p,u) = \\langle p, u_1 X_1 + u_2 X_2 \\rangle - \\frac{1}{2}(u_1^2 + u_2^2) $$\n令 $h_1 = \\langle p, X_1 \\rangle$ 和 $h_2 = \\langle p, X_2 \\rangle$。哈密顿量变为：\n$$ H_u = u_1 h_1 + u_2 h_2 - \\frac{1}{2}(u_1^2 + u_2^2) $$\nPMP 指出，对于最优轨迹，控制 $u(t)$ 必须在每个时间点 $t$ 极大化 $H_u$。我们通过将关于控制的偏导数设为零来求极大值：\n$$ \\frac{\\partial H_u}{\\partial u_1} = h_1 - u_1 = 0 \\implies u_1 = h_1 $$\n$$ \\frac{\\partial H_u}{\\partial u_2} = h_2 - u_2 = 0 \\implies u_2 = h_2 $$\n这提供了最优反馈关系。将这些最优控制代回 $H_u$ 得到极大化哈密顿量（或庞特里亚金哈密顿量）$H$：\n$$ H(q,p) = h_1^2 + h_2^2 - \\frac{1}{2}(h_1^2 + h_2^2) = \\frac{1}{2}(h_1^2+h_2^2) $$\n为了写出哈密顿方程，我们在典范坐标下表示 $H$。余向量 $p$ 的分量 $(p_x, p_y, p_z)$ 对偶于 $(\\partial_x, \\partial_y, \\partial_z)$。\n$$ h_1 = \\langle p, \\partial_x-\\frac{y}{2}\\partial_z \\rangle = p_x - \\frac{y}{2}p_z $$\n$$ h_2 = \\langle p, \\partial_y+\\frac{x}{2}\\partial_z \\rangle = p_y + \\frac{x}{2}p_z $$\n因此，哈密顿量为：\n$$ H = \\frac{1}{2} \\left[ \\left( p_x - \\frac{y}{2}p_z \\right)^2 + \\left( p_y + \\frac{x}{2}p_z \\right)^2 \\right] $$\n极值轨迹满足哈密顿方程 $\\dot{q} = \\frac{\\partial H}{\\partial p}$ 和 $\\dot{p} = -\\frac{\\partial H}{\\partial q}$：\n- **状态方程**：\n$$ \\dot{x} = \\frac{\\partial H}{\\partial p_x} = p_x - \\frac{y}{2}p_z = h_1 = u_1 $$\n$$ \\dot{y} = \\frac{\\partial H}{\\partial p_y} = p_y + \\frac{x}{2}p_z = h_2 = u_2 $$\n$$ \\dot{z} = \\frac{\\partial H}{\\partial p_z} = -\\frac{y}{2}h_1 + \\frac{x}{2}h_2 = \\frac{1}{2}(x\\dot{y} - y\\dot{x}) $$\n- **协态方程**：\n$$ \\dot{p}_x = -\\frac{\\partial H}{\\partial x} = -\\left(p_y + \\frac{x}{2}p_z\\right)\\frac{p_z}{2} = -\\frac{p_z}{2}h_2 $$\n$$ \\dot{p}_y = -\\frac{\\partial H}{\\partial y} = -\\left(p_x - \\frac{y}{2}p_z\\right)\\left(-\\frac{p_z}{2}\\right) = \\frac{p_z}{2}h_1 $$\n$$ \\dot{p}_z = -\\frac{\\partial H}{\\partial z} = 0 $$\n\n### 任务 2：求解正常极值曲线\n\n我们在给定条件下求解该系统。\n方程 $\\dot{p}_z = 0$ 意味着 $p_z(t)$ 是一个常数。给定该常数为 $p_z = \\lambda \\neq 0$。\n哈密顿量也是一个运动常数。给定 $H = \\frac{1}{2}\\rho^2$ 对于某个 $\\rho0$。这意味着对所有 $t$ 都有 $h_1(t)^2 + h_2(t)^2 = \\rho^2$。\n\n我们求 $h_1$ 和 $h_2$ 的动力学：\n$$ \\dot{h}_1 = \\frac{d}{dt}\\left(p_x - \\frac{y}{2}\\lambda\\right) = \\dot{p}_x - \\frac{\\lambda}{2}\\dot{y} = \\left(-\\frac{\\lambda}{2}h_2\\right) - \\frac{\\lambda}{2}h_2 = -\\lambda h_2 $$\n$$ \\dot{h}_2 = \\frac{d}{dt}\\left(p_y + \\frac{x}{2}\\lambda\\right) = \\dot{p}_y + \\frac{\\lambda}{2}\\dot{x} = \\left(\\frac{\\lambda}{2}h_1\\right) + \\frac{\\lambda}{2}h_1 = \\lambda h_1 $$\n我们有系统 $\\dot{h}_1 = -\\lambda h_2$ 和 $\\dot{h}_2 = \\lambda h_1$。对第一个方程求导得到 $\\ddot{h}_1 = -\\lambda \\dot{h}_2 = -\\lambda(\\lambda h_1) = -\\lambda^2 h_1$。这是简谐振子方程。通解为 $h_1(t) = A\\cos(\\lambda t) + B\\sin(\\lambda t)$。那么 $h_2(t) = -\\frac{1}{\\lambda}\\dot{h}_1 = A\\sin(\\lambda t) - B\\cos(\\lambda t)$。\n条件 $h_1^2+h_2^2=\\rho^2$ 意味着 $A^2+B^2=\\rho^2$。令 $A = \\rho\\cos(\\phi)$ 和 $B = \\rho\\sin(\\phi)$，其中 $\\phi$ 为相角。\n$$ h_1(t) = \\rho \\cos(\\lambda t - \\phi) $$\n$$ h_2(t) = \\rho \\sin(\\lambda t - \\phi) $$\n现在我们求解状态变量 $x,y,z$。\n$$ \\dot{x}(t) = h_1(t) = \\rho \\cos(\\lambda t - \\phi) $$\n$$ \\dot{y}(t) = h_2(t) = \\rho \\sin(\\lambda t - \\phi) $$\n使用初始条件 $q(0) = (0,0,0)$ 进行积分：\n$$ x(t) = \\int_0^t \\rho \\cos(\\lambda \\tau - \\phi) d\\tau = \\left[ \\frac{\\rho}{\\lambda} \\sin(\\lambda \\tau - \\phi) \\right]_0^t = \\frac{\\rho}{\\lambda}(\\sin(\\lambda t - \\phi) + \\sin(\\phi)) $$\n$$ y(t) = \\int_0^t \\rho \\sin(\\lambda \\tau - \\phi) d\\tau = \\left[ -\\frac{\\rho}{\\lambda} \\cos(\\lambda \\tau - \\phi) \\right]_0^t = -\\frac{\\rho}{\\lambda}(\\cos(\\lambda t - \\phi) - \\cos(\\phi)) $$\n我们应用相位正则化：$t=0$ 处的切向量没有 $y$ 分量，这意味着 $\\dot{y}(0)=0$。\n$$ \\dot{y}(0) = h_2(0) = \\rho \\sin(-\\phi) = -\\rho\\sin(\\phi) = 0 $$\n因为 $\\rho0$，这意味着 $\\sin(\\phi)=0$，所以 $\\phi=k\\pi$ 对于某个整数 $k$。我们选择 $\\phi=0$，这给出 $\\cos(\\phi)=1$。这个选择简化了表达式且不失一般性（选择 $\\phi=\\pi$ 会使 $x$ 和 $y$ 的符号反转）。\n当 $\\phi=0$ 时，$x(t)$ 和 $y(t)$ 的表达式变为：\n$$ x(t) = \\frac{\\rho}{\\lambda}(\\sin(\\lambda t) + \\sin(0)) = \\frac{\\rho}{\\lambda}\\sin(\\lambda t) $$\n$$ y(t) = -\\frac{\\rho}{\\lambda}(\\cos(\\lambda t) - \\cos(0)) = \\frac{\\rho}{\\lambda}(1 - \\cos(\\lambda t)) $$\n控制变为 $u_1(t) = h_1(t) = \\rho\\cos(\\lambda t)$ 和 $u_2(t) = h_2(t) = \\rho\\sin(\\lambda t)$。\n最后，我们使用 $\\dot{z} = \\frac{1}{2}(x\\dot{y} - y\\dot{x})$ 求解 $z(t)$：\n$$ \\dot{z}(t) = \\frac{1}{2} \\left[ \\left(\\frac{\\rho}{\\lambda}\\sin(\\lambda t)\\right)(\\rho \\sin(\\lambda t)) - \\left(\\frac{\\rho}{\\lambda}(1 - \\cos(\\lambda t))\\right)(\\rho \\cos(\\lambda t)) \\right] $$\n$$ \\dot{z}(t) = \\frac{\\rho^2}{2\\lambda} \\left[ \\sin^2(\\lambda t) - (\\cos(\\lambda t) - \\cos^2(\\lambda t)) \\right] $$\n$$ \\dot{z}(t) = \\frac{\\rho^2}{2\\lambda} \\left[ (\\sin^2(\\lambda t) + \\cos^2(\\lambda t)) - \\cos(\\lambda t) \\right] = \\frac{\\rho^2}{2\\lambda}(1 - \\cos(\\lambda t)) $$\n使用 $z(0)=0$ 进行积分：\n$$ z(t) = \\int_0^t \\frac{\\rho^2}{2\\lambda}(1 - \\cos(\\lambda \\tau)) d\\tau = \\frac{\\rho^2}{2\\lambda} \\left[ \\tau - \\frac{1}{\\lambda}\\sin(\\lambda \\tau) \\right]_0^t $$\n$$ z(t) = \\frac{\\rho^2}{2\\lambda} \\left(t - \\frac{1}{\\lambda}\\sin(\\lambda t)\\right) = \\frac{\\rho^2}{2\\lambda^2}(\\lambda t - \\sin(\\lambda t)) $$\n最终的轨迹由三元组 $(x(t), y(t), z(t))$ 给出。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\rho}{\\lambda}\\sin(\\lambda t)  \\frac{\\rho}{\\lambda}(1 - \\cos(\\lambda t))  \\frac{\\rho^2}{2\\lambda^2}(\\lambda t - \\sin(\\lambda t)) \\end{pmatrix}}\n$$"
        }
    ]
}