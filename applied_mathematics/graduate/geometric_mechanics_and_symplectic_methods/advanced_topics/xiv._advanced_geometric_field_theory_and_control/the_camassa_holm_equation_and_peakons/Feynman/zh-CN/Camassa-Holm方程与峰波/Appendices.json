{
    "hands_on_practices": [
        {
            "introduction": "单孤峰子是 Camassa-Holm 方程最基本的孤波解，理解其性质是研究多孤峰子相互作用的基础。本练习将指导你使用欧拉-庞加莱动量方程，通过分布理论推导孤峰子最著名的特性——其速度等于其振幅。这项实践旨在让你熟练掌握在几何力学框架下处理弱解和分布导数的核心技能。",
            "id": "3773822",
            "problem": "考虑实线上的标量速度场 $u(x,t)$ 的Camassa–Holm方程，其线性色散参数为 $\\kappa \\in \\mathbb{R}$，\n$$\nu_t - u_{xxt} + \\kappa\\,u_x + 3\\,u\\,u_x \\;=\\; 2\\,u_x\\,u_{xx} + u\\,u_{xxx}.\n$$\n通过定义 $m = u - u_{xx}$ 引入亥姆霍兹动量 $m(x,t)$，从而有 $u = K * m$，其中 $K(x)$ 是亥姆霍兹算子 $1 - \\partial_x^2$ 的格林函数，即 $K(x) = \\tfrac{1}{2}\\,e^{-|x|}$。在几何力学表述中，Camassa–Holm方程是欧拉-庞加莱（EP）方程\n$$\nm_t + u\\,m_x + 2\\,u_x\\,m = -\\,\\kappa\\,u_x,\n$$\n其中 $m = u - u_{xx}$ 和 $u = K * m$ 如上所述。考虑动量变量中的一个单峰孤子拟设，由一个移动的狄拉克δ分布给出：$m(x,t) = 2\\,p(t)\\,\\delta\\big(x - q(t)\\big)$，其中 $p(t)$ 是随时间变化的振幅，$q(t)$ 是位置。仅使用所述的基础，即动量定义 $m = u - u_{xx}$、卷积 $u = K * m$ 以及Camassa–Holm方程的欧拉-庞加莱形式，进行以下推理：\n\n- 对于 $\\kappa = 0$ 的情况，将在分布的意义上把单峰孤子拟设代入欧拉-庞加莱方程，推导出 $p(t)$ 和 $q(t)$ 的常微分方程。\n- 根据此推导，解释为何当 $\\kappa = 0$ 时，峰孤子以等于其振幅的速度行进。\n- 对于与格林函数卷积 $u = K * m$ 对应的速度场 $u(x,t) = p(t)\\,e^{-\\big|x - q(t)\\big|}$，通过在分布的意义上直接代入控制方程来验证此关系。\n\n以下哪个陈述是正确的？\n\nA. 对于 $\\kappa=0$，将 $m(x,t) = 2\\,p(t)\\,\\delta\\big(x - q(t)\\big)$ 代入 $m_t + u\\,m_x + 2\\,u_x\\,m = 0$ 并使用 $u = K * m$ 及 $K(x) = \\tfrac{1}{2}\\,e^{-|x|}$，得到分布恒等式 $q'(t) = p(t)$ 和 $p'(t) = 0$。因此，峰孤子的速度等于其振幅，并且将 $u(x,t) = p(t)\\,e^{-\\big|x - q(t)\\big|}$（其中 $q'(t) = p(t)$ 和 $p'(t) = 0$）直接代入，在分布的意义上满足该方程。\n\nB. 对于 $\\kappa=0$，$m(x,t) = 2\\,p(t)\\,\\delta\\big(x - q(t)\\big)$ 中的因子 $2$ 意味着速度是振幅的两倍，因此正确的关系是 $q'(t) = 2\\,p(t)$ 和 $p'(t) = 0$。直接代入证实了这种更强的速度-振幅比例关系。\n\nC. 对于 $\\kappa=0$，非线性根据 $p'(t) = -3\\,p(t)^2$ 引起振幅衰减，而速度初始时等于振幅，$q'(0) = p(0)$，但随时间偏离。直接代入揭示了一个长期漂移，使得恒定的速度-振幅等式无效。\n\nD. 对于 $\\kappa=0$，峰孤子拟设失败，因为 $u$ 在 $x = q(t)$ 处不可微，所以在分布的意义上，动量方程和速度表述都不能被满足。因此，速度不能等于振幅，并且直接代入会产生矛盾。\n\n选择唯一最佳答案。",
            "solution": "在尝试任何解答之前，对问题陈述进行验证。\n\n### 第1步：提取已知条件\n-   标量速度场 $u(x,t)$ 的Camassa–Holm (CH)方程给出如下：\n    $$u_t - u_{xxt} + \\kappa\\,u_x + 3\\,u\\,u_x \\;=\\; 2\\,u_x\\,u_{xx} + u\\,u_{xxx}$$\n-   线性色散参数为 $\\kappa \\in \\mathbb{R}$。\n-   亥姆霍兹动量定义为 $m(x,t) = u - u_{xx}$。\n-   速度 $u$ 通过与格林函数 $K(x)$ 的卷积从动量 $m$ 获得：$u = K * m$。\n-   亥姆霍兹算子 $1 - \\partial_x^2$ 的格林函数是 $K(x) = \\tfrac{1}{2}\\,e^{-|x|}$。\n-   CH方程的欧拉-庞加莱 (EP) 形式是：\n    $$m_t + u\\,m_x + 2\\,u_x\\,m = -\\,\\kappa\\,u_x$$\n-   动量的单峰孤子拟设由 $m(x,t) = 2\\,p(t)\\,\\delta\\big(x - q(t)\\big)$ 给出，其中 $p(t)$ 是振幅，$q(t)$ 是位置。\n-   问题指定分析针对 $\\kappa = 0$ 的情况。\n-   任务是：(1) 从 $\\kappa=0$ 的EP方程推导 $p(t)$ 和 $q(t)$ 的常微分方程。(2) 解释为什么速度等于振幅。(3) 通过直接代入方程的速度形式来验证这一点。\n\n### 第2步：使用提取的已知条件进行验证\n1.  **科学依据**：该问题基于成熟的Camassa–Holm方程理论，该方程是研究浅水波的一个基本模型，并与几何力学有深刻的联系。所提供的方程形式（原始版本和欧拉-庞加莱版本）、动量定义和格林函数都是标准且正确的。\n2.  **适定性**：该问题是适定的。它要求推导和验证一种特定类型的解（峰孤子），这是可积系统分析中的一个标准程序。指令清晰，并能导出一个明确的结果。\n3.  **客观性**：语言完全是数学化和客观的。\n4.  **完整与一致性**：提供了所有必要信息。$u$ 和 $m$ 之间的关系被明确定义。EP方程是原始CH方程的一个已知的、有效的重新表述。对于 $\\kappa=0$，CH方程 $u_t - u_{xxt} + 3uu_x = 2u_x u_{xx} + u u_{xxx}$ 确实等价于EP形式 $m_t + u m_x + 2u_x m = 0$，因为 $m_t + (um)_x + u_x m = m_t + u_x m + u m_x + u_x m = m_t + u m_x + 2u_x m$，并且 $(um)_x + u_x m = (u(u-u_{xx}))_x + u_x(u-u_{xx}) = (u^2-uu_{xx})_x + u_x u - u_x u_{xx} = 2uu_x - (uu_{xx})_x + u_x u - u_x u_{xx} = 3uu_x - u_x u_{xx} - u u_{xxx} - u_x u_{xx} = 3uu_x - 2u_x u_{xx} - u u_{xxx}$。因此 $m_t + 3uu_x - 2u_x u_{xx} - u u_{xxx} = 0$，这就是 $\\kappa=0$ 时的原始CH方程。该设置是一致的。\n5.  **未检测到其他缺陷**：该问题不包含任何列出的使其无效的缺陷。使用分布和不可微函数是峰孤子解的一个关键特征，并且“在分布的意义上”处理它们是正确的数学方法。\n\n### 第3步：结论和行动\n问题陈述是**有效的**。将推导一个完整的解。\n\n### 推导与解答\n\n问题要求对 $\\kappa = 0$ 的情况进行三部分分析。\n\n**第1部分：推导 $p(t)$ 和 $q(t)$ 的常微分方程**\n\n对于 $\\kappa=0$，欧拉-庞加莱方程是 $m_t + u\\,m_x + 2\\,u_x\\,m = 0$。\n我们首先找到与动量拟设 $m(x,t) = 2\\,p(t)\\,\\delta\\big(x - q(t)\\big)$ 对应的速度场 $u(x,t)$。\n$$ u(x,t) = (K * m)(x,t) = \\int_{-\\infty}^{\\infty} K(x-y)\\,m(y,t)\\,dy $$\n$$ u(x,t) = \\int_{-\\infty}^{\\infty} \\frac{1}{2}e^{-|x-y|} \\left( 2\\,p(t)\\,\\delta\\big(y - q(t)\\big) \\right) dy = p(t) \\int_{-\\infty}^{\\infty} e^{-|x-y|} \\delta\\big(y - q(t)\\big) dy $$\n使用狄拉克δ函数的筛选性质，我们发现：\n$$ u(x,t) = p(t)\\,e^{-|x - q(t)|} $$\n这是单个峰孤子的速度场。峰孤子的振幅是 $p(t)$，其位置是 $q(t)$。\n\n为了找到 $p(t)$ 和 $q(t)$ 的常微分方程，我们将 $m$ 的拟设和推导出的 $u$ 代入EP方程。由于 $m$ 是一个分布，而 $u$ 不光滑，该方程必须在弱意义下解释。设 $\\phi(x)$ 是一个具有紧支集的任意光滑检验函数。方程的弱形式是 $\\langle m_t + u\\,m_x + 2\\,u_x\\,m, \\phi \\rangle = 0$。\n\n我们来计算每一项：\n1.  $\\langle m_t, \\phi \\rangle = \\frac{d}{dt}\\langle m, \\phi \\rangle = \\frac{d}{dt} \\int 2p(t)\\delta(x-q(t))\\phi(x)dx = \\frac{d}{dt} [2p(t)\\phi(q(t))]$\n    $= 2p'(t)\\phi(q(t)) + 2p(t)\\phi'(q(t))q'(t)$。\n\n2.  余下的项 $u m_x + 2 u_x m$ 可以重写为 $(u m)_x + u_x m$。让我们以分布的方式处理它们。\n    $\\langle u m_x + 2 u_x m, \\phi \\rangle = \\langle m, u_x \\phi - u \\phi_x \\rangle = \\int 2p(t)\\delta(x-q(t)) [u_x(x,t)\\phi(x) - u(x,t)\\phi'(x)] dx $\n    $= 2p(t) [u_x(q(t),t)\\phi(q(t)) - u(q(t),t)\\phi'(q(t))]$。\n\n为了计算这个，我们需要 $u(q,t)$ 和 $u_x(q,t)$。\n-   $u(q(t),t) = p(t)e^{-|q(t)-q(t)|} = p(t)$。\n-   $u$ 的导数是 $u_x(x,t) = -p(t)\\,\\text{sgn}(x-q(t))\\,e^{-|x-q(t)|}$。这个导数在 $x=q(t)$ 处有一个跳跃间断点，从 $x  q(t)$ 时的 $p(t)$ 跳到 $x > q(t)$ 时的 $-p(t)$。在CH方程弱解的背景下，间断点处的值取为左右极限的平均值：\n    $u_x(q(t),t) := \\frac{1}{2} \\left[ u_x(q^-,t) + u_x(q^+,t) \\right] = \\frac{1}{2} [p(t) + (-p(t))] = 0$。\n\n代入这些值：\n$\\langle u m_x + 2 u_x m, \\phi \\rangle = 2p(t)[(0)\\phi(q(t)) - p(t)\\phi'(q(t))] = -2p(t)^2\\phi'(q(t))$。\n\n合并所有项，EP方程的弱形式是：\n$2p'(t)\\phi(q(t)) + 2p(t)q'(t)\\phi'(q(t)) - 2p(t)^2\\phi'(q(t)) = 0$。\n$[2p'(t)]\\phi(q(t)) + [2p(t)q'(t) - 2p(t)^2]\\phi'(q(t)) = 0$。\n\n由于这个恒等式必须对任何检验函数 $\\phi$ 成立，所以 $\\phi(q(t))$ 和 $\\phi'(q(t))$ 的系数必须独立地为零。\n-   从 $\\phi(q(t))$ 的系数得到：$2p'(t) = 0 \\implies p'(t) = 0$。这意味着振幅 $p$ 是常数。\n-   从 $\\phi'(q(t))$ 的系数得到：$2p(t)q'(t) - 2p(t)^2 = 0 \\implies 2p(t)(q'(t) - p(t)) = 0$。\n对于一个非平凡的峰孤子，$p(t) \\neq 0$，所以我们必须有 $q'(t) - p(t) = 0 \\implies q'(t) = p(t)$。\n\n推导出的常微分方程是 $p'(t)=0$ 和 $q'(t)=p(t)$。\n\n**第2部分：解释速度-振幅关系**\n\n峰孤子的速度是其位置的变化率，即 $q'(t)$。速度分布 $u(x,t)$ 的振幅是 $p(t)$。推导出的关系 $q'(t) = p(t)$ 直接表明峰孤子的速度等于其振幅。\n\n**第3部分：通过直接代入进行验证**\n\n我们必须验证 $u(x,t) = p_0 e^{-|x-q(t)|}$（其中 $p'(t)=0$，所以 $p(t)=p_0$ 是一个常数，且 $q'(t) = p_0$）是 $\\kappa=0$ 时CH方程 $u_t - u_{xxt} + 3uu_x = 2u_x u_{xx} + u u_{xxx}$ 的一个解。这等价于 $m_t + 3uu_x = 2u_x u_{xx} + u u_{xxx}$。\n\n让我们以分布的形式计算各项。设 $q(t) = p_0 t + q_0$。\n-   $u(x,t) = p_0 e^{-|x-q(t)|}$。\n-   $u_x = -p_0 \\text{sgn}(x-q) e^{-|x-q|}$。\n-   $u_t = \\frac{\\partial}{\\partial t} (p_0 e^{-|x-q(t)|}) = p_0 e^{-|x-q|} (-\\text{sgn}(x-q))(-q'(t)) = p_0 q'(t) \\text{sgn}(x-q) e^{-|x-q|} = -q'(t) u_x = -p_0 u_x$。\n-   $u_{xx} = \\frac{\\partial}{\\partial x} (-p_0 \\text{sgn}(x-q)e^{-|x-q|}) = p_0 \\text{sgn}^2(x-q)e^{-|x-q|} - p_0 (2\\delta(x-q))e^{-|x-q|} = p_0 e^{-|x-q|} - 2p_0 \\delta(x-q) = u - 2p_0 \\delta(x-q)$。\n-   $u_{xxx} = u_x - 2p_0 \\delta'(x-q) = -p_0 \\text{sgn}(x-q)e^{-|x-q|} - 2p_0 \\delta'(x-q)$。\n-   $m = u - u_{xx} = u - (u - 2p_0 \\delta(x-q)) = 2p_0 \\delta(x-q)$。\n-   $m_t = \\frac{\\partial}{\\partial t} (2p_0 \\delta(x-q(t))) = 2p_0 (-q'(t))\\delta'(x-q(t)) = -2p_0^2 \\delta'(x-q)$。\n\n现在我们组合CH方程 $m_t + 3uu_x = 2u_x u_{xx} + u u_{xxx}$ 的两边。\n左手边 (LHS):\n$LHS = m_t + 3uu_x = -2p_0^2 \\delta'(x-q) + 3(p_0 e^{-|x-q|})(-p_0 \\text{sgn}(x-q)e^{-|x-q|})$\n$LHS = -2p_0^2 \\delta'(x-q) - 3p_0^2 \\text{sgn}(x-q)e^{-2|x-q|}$。\n\n右手边 (RHS): $2u_x u_{xx} + u u_{xxx}$。这涉及到分布的乘积，必须小心处理。\n$RHS = 2u_x(u-2p_0\\delta(x-q)) + u(u_x - 2p_0\\delta'(x-q))$\n$RHS = 2uu_x - 4p_0 u_x \\delta(x-q) + uu_x - 2p_0 u \\delta'(x-q)$\n$RHS = 3uu_x - 4p_0 u_x \\delta(x-q) - 2p_0 u \\delta'(x-q)$\n我们使用光滑函数与分布乘积的标准规则：\n-   $f(x)\\delta(x-a) = f(a)\\delta(x-a)$。此处，$u_x \\delta(x-q) = u_x(q)\\delta(x-q) = 0 \\cdot \\delta(x-q) = 0$。\n-   $f(x)\\delta'(x-a) = f(a)\\delta'(x-a) - f'(a)\\delta(x-a)$。此处，$u \\delta'(x-q) = u(q)\\delta'(x-q) - u_x(q)\\delta(x-q) = p_0\\delta'(x-q) - 0\\cdot\\delta(x-q) = p_0\\delta'(x-q)$。\n\n将这些代入RHS表达式：\n$RHS = 3uu_x - 4p_0(0) - 2p_0(p_0\\delta'(x-q)) = 3uu_x - 2p_0^2\\delta'(x-q)$\n$RHS = 3(p_0 e^{-|x-q|})(-p_0 \\text{sgn}(x-q)e^{-|x-q|}) - 2p_0^2\\delta'(x-q)$\n$RHS = -3p_0^2 \\text{sgn}(x-q)e^{-2|x-q|} - 2p_0^2\\delta'(x-q)$。\n\n比较LHS和RHS：\n$LHS = -2p_0^2 \\delta'(x-q) - 3p_0^2 \\text{sgn}(x-q)e^{-2|x-q|}$\n$RHS = -2p_0^2 \\delta'(x-q) - 3p_0^2 \\text{sgn}(x-q)e^{-2|x-q|}$\nLHS和RHS是相同的。验证成功。\n\n### 选项评估\n\nA. **对于 $\\kappa = 0$，将 $m(x,t) = 2\\,p(t)\\,\\delta\\big(x - q(t)\\big)$ 代入 $m_t + u\\,m_x + 2\\,u_x\\,m = 0$ 并使用 $u = K * m$ 及 $K(x) = \\tfrac{1}{2}\\,e^{-|x|}$ 得到分布恒等式 $q'(t) = p(t)$ 和 $p'(t) = 0$。因此，峰孤子的速度等于其振幅，并且将 $u(x,t) = p(t)\\,e^{-\\big|x - q(t)\\big|}$（其中 $q'(t) = p(t)$ 和 $p'(t) = 0$）直接代入，在分布的意义上满足该方程。**\n这个陈述完全被我们的推导和验证所支持。推导出的常微分方程是 $p'(t)=0$ 和 $q'(t)=p(t)$。这意味着速度等于振幅。直接代入证实了这个解的有效性。\n**结论：正确。**\n\nB. **对于 $\\kappa = 0$，$m(x,t) = 2\\,p(t)\\,\\delta\\big(x - q(t)\\big)$ 中的因子 $2$ 意味着速度是振幅的两倍，因此正确的关系是 $q'(t) = 2\\,p(t)$ 和 $p'(t) = 0$。直接代入证实了这种更强的速度-振幅比例关系。**\n这是不正确的。我们的推导表明 $q'(t)=p(t)$，而不是 $2p(t)$。因子 $2$ 源于关系 $m=u-u_{xx}$，而不是一个速度加倍的机制。动量 $m$ 的振幅是 $2p$，而速度 $u$ 的振幅是 $p$。速度 $q'$ 等于速度振幅 $p$。\n**结论：不正确。**\n\nC. **对于 $\\kappa = 0$，非线性根据 $p'(t) = -3\\,p(t)^2$ 引起振幅衰减，而速度初始时等于振幅，$q'(0) = p(0)$，但随时间偏离。直接代入揭示了一个长期漂移，使得恒定的速度-振幅等式无效。**\n这是不正确的。我们的推导表明 $p'(t)=0$，意味着振幅是恒定的。单个峰孤子是一种孤立波，其传播时形状和振幅不变。对于这个精确解，不会发生衰减或速度偏离。\n**结论：不正确。**\n\nD. **对于 $\\kappa = 0$，峰孤子拟设失败，因为 $u$ 在 $x = q(t)$ 处不可微，所以在分布的意义上，动量方程和速度表述都不能被满足。因此，速度不能等于振幅，并且直接代入产生矛盾。**\n这是不正确的。$u$ 的不可微性是峰孤子的一个关键特征，但它不会导致拟设失败。弱解和分布导数的整个理论就是为了处理这种情况而设计的。正如我们的验证所示，方程的两种形式在分布的意义上都完全满足，并且直接代入得到一个恒等式，而不是矛盾。\n**结论：不正确。**\n\n唯一正确的陈述是A。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "从单个孤峰子到多个孤峰子，系统的动力学行为变得更加丰富，其相互作用由一个优美的哈密顿系统所描述。本练习将引导你从多孤峰子哈密顿量 $H$ 出发，推导每个孤峰子动量的演化方程。通过计算 $\\dot{p}_i = -\\frac{\\partial H}{\\partial q_i}$，你将明确地看到孤峰子之间的“作用力”是如何依赖于它们各自的位置和动量的，这是将哈密顿力学应用于可积偏微分方程的一个典型范例。",
            "id": "3773868",
            "problem": "考虑一维空间中的 Camassa-Holm (CH) 方程，通过 $N$-peakon ansatz 将其约化到有限维 peakon 流形\n$$\nu(x,t) = \\sum_{k=1}^{N} p_k(t)\\, K\\big(x - q_k(t)\\big), \\quad K(x) = \\frac{1}{2}\\exp\\big(-|x|\\big),\n$$\n其中 $K$ 是实直线上 Helmholtz 算子 $1 - \\partial_x^2$ 的 Green 函数，$(q_i(t),p_i(t))$ 是具有经典力学标准辛结构的正则坐标。相应的约化 Hamilton 量为\n$$\nH(q,p) = \\frac{1}{2}\\sum_{j=1}^{N}\\sum_{k=1}^{N} p_j p_k\\, K\\big(q_j - q_k\\big),\n$$\nHamilton 方程为\n$$\n\\dot{q}_i = \\frac{\\partial H}{\\partial p_i}, \\qquad \\dot{p}_i = -\\,\\frac{\\partial H}{\\partial q_i}.\n$$\n仅利用 $K$ 是偶函数，$K'(x)$ 是奇函数，以及\n$$\nK'(x) = -\\frac{1}{2}\\,\\operatorname{sgn}(x)\\,\\exp\\big(-|x|\\big)\n$$\n且约定 $\\operatorname{sgn}(0)=0$ 这些事实，计算 $\\frac{\\partial H}{\\partial q_i}$ 的显式表达式，并尽可能地化简。然后使用关于 $\\dot{p}_i$ 的 Hamilton 方程，以推导出其用 $\\operatorname{sgn}(q_i-q_j)$ 和 $\\exp\\big(-|q_i-q_j|\\big)$ 表示的显式符号结构。将你的最终答案报告为 $\\dot{p}_i$ 作为 $\\{q_j,p_j\\}_{j=1}^{N}$ 函数的闭式解析表达式。不需要进行数值计算，也不涉及单位。",
            "solution": "本题要求在 Camassa-Holm 方程的 $N$-peakon 解的 Hamilton 框架内，推导 peakon 动量的时间导数 $\\dot{p}_i$ 的显式公式。\n\n控制动力学的是 Hamilton 方程：\n$$\n\\dot{q}_i = \\frac{\\partial H}{\\partial p_i}, \\qquad \\dot{p}_i = -\\frac{\\partial H}{\\partial q_i}\n$$\nHamilton 量 $H$ 由下式给出：\n$$\nH(q,p) = \\frac{1}{2}\\sum_{j=1}^{N}\\sum_{k=1}^{N} p_j p_k K\\big(q_j - q_k\\big)\n$$\n其中 $K(x) = \\frac{1}{2}\\exp(-|x|)$。我们的目标是计算 $\\dot{p}_i$，这需要计算偏导数 $\\frac{\\partial H}{\\partial q_i}$。\n\n为了系统地计算这个导数，我们首先重写 Hamilton 量，明确地分离出依赖于 $q_i$ 的项。在双重求和中，$K$ 的自变量依赖于 $q_i$ 的项是指标 $j=i$ 或 $k=i$ 的那些项。我们可以通过分离这些项来重写 Hamilton 量。\n$$\nH = \\frac{1}{2} \\left[ \\sum_{k=1}^{N} p_i p_k K(q_i-q_k) + \\sum_{j=1, j\\neq i}^{N} p_j p_i K(q_j-q_i) + \\sum_{j\\neq i, k\\neq i} p_j p_k K(q_j-q_k) \\right]\n$$\n鉴于核函数 $K(x)$ 是偶函数，我们有 $K(q_j-q_i) = K(-(q_i-q_j)) = K(q_i-q_j)$。因此，在重新标记求和指标后，括号中的前两项求和是相同的。此外，如果前两个求和的范围都是从 $1$ 到 $N$，则对角项 $p_i^2 K(q_i-q_i) = p_i^2 K(0)$ 会出现在两个求和中。一种更仔细的分离方法是：\n$$\nH = \\frac{1}{2} p_i^2 K(0) + \\sum_{k \\neq i} p_i p_k K(q_i-q_k) + \\frac{1}{2} \\sum_{j \\neq i, k \\neq i} p_j p_k K(q_j-q_k)\n$$\n这种形式清楚地分离出了所有依赖于 $q_i$ 的项。第一项和第三项相对于 $q_i$ 是常数。因此，对 $H$ 关于 $q_i$ 求导只影响第二项。\n$$\n\\frac{\\partial H}{\\partial q_i} = \\frac{\\partial}{\\partial q_i} \\left( \\sum_{k \\neq i} p_i p_k K(q_i-q_k) \\right)\n$$\n使用链式法则求导，我们得到：\n$$\n\\frac{\\partial H}{\\partial q_i} = \\sum_{k \\neq i} p_i p_k K'(q_i-q_k) \\cdot \\frac{\\partial}{\\partial q_i}(q_i-q_k) = \\sum_{k \\neq i} p_i p_k K'(q_i-q_k)\n$$\n注意求和是对 $k \\in \\{1, ..., N\\}$ 且 $k \\neq i$ 进行的。为清楚起见，我们用 $j$ 替换哑指标 $k$：\n$$\n\\frac{\\partial H}{\\partial q_i} = \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} p_i p_j K'(q_i-q_j)\n$$\n这就是 $\\frac{\\partial H}{\\partial q_i}$ 的显式公式。现在，我们使用关于 $\\dot{p}_i$ 的 Hamilton 方程：\n$$\n\\dot{p}_i = -\\frac{\\partial H}{\\partial q_i} = - \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} p_i p_j K'(q_i-q_j)\n$$\n题目给出了核函数导数的显式形式：\n$$\nK'(x) = -\\frac{1}{2}\\,\\operatorname{sgn}(x)\\,\\exp\\big(-|x|\\big)\n$$\n其中 $\\operatorname{sgn}(0)=0$。将 $x = q_i - q_j$ 代入此表达式，得到：\n$$\nK'(q_i - q_j) = -\\frac{1}{2}\\,\\operatorname{sgn}(q_i - q_j)\\,\\exp\\big(-|q_i - q_j|\\big)\n$$\n我们将此代回关于 $\\dot{p}_i$ 的方程中：\n$$\n\\dot{p}_i = - \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} p_i p_j \\left( -\\frac{1}{2}\\,\\operatorname{sgn}(q_i - q_j)\\,\\exp\\big(-|q_i - q_j|\\big) \\right)\n$$\n两个负号相消，得到简化后的表达式：\n$$\n\\dot{p}_i = \\frac{1}{2} \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} p_i p_j \\,\\operatorname{sgn}(q_i - q_j)\\,\\exp\\big(-|q_i - q_j|\\big)\n$$\n最后，由于 $p_i$ 相对于求和指标 $j$ 是一个常数，我们可以将其从求和中提出来，以获得最终的闭式表达式：\n$$\n\\dot{p}_i = \\frac{1}{2} p_i \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} p_j \\,\\operatorname{sgn}(q_i - q_j)\\,\\exp\\big(-|q_i - q_j|\\big)\n$$\n这个表达式清楚地揭示了 $\\dot{p}_i$ 的符号结构。求和中的每一项都取决于相互作用的 peakon 的动量 $p_j$、通过 $\\operatorname{sgn}(q_i - q_j)$ 体现的相对位置，以及一个依赖于距离 $|q_i-q_j|$ 的指数衰减因子。总变化率 $\\dot{p}_i$ 与其自身的动量 $p_i$ 成正比。",
            "answer": "$$\\boxed{\\frac{1}{2} p_i \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} p_j \\operatorname{sgn}(q_i - q_j) \\exp(-|q_i - q_j|)}$$"
        },
        {
            "introduction": "这项实践练习将分析推导与计算实现相结合，是连接理论与实践的桥梁。虽然对于多孤峰子系统我们很难找到解析解，但可以使用尊重其内在几何结构的数值方法来精确模拟其动力学。本练习要求你实现一个变分积分器（variational integrator），这是一种强大的保结构算法，它能够将抽象的拉格朗日/哈密顿理论转化为可进行数值实验的动态模型，从而让你亲手揭示孤峰子“舞蹈”的奥秘。",
            "id": "3773813",
            "problem": "你的任务是为与 Camassa-Holm 方程相关的尖峰子动力学设计并实现一个结构保持（变分）时间积分器。已知 Camassa-Holm 方程是微分同胚群上关于一阶 Sobolev 度量下的一个测地流，其动能由积分 $$\\int (u^2 + u_x^2)\\,dx,$$ 给出，其中 $u$ 是速度场，$u_x$ 是其空间导数。考虑 $N$-尖峰子拟设 $$u(x,t) = \\sum_{i=1}^N p_i(t) \\exp\\!\\big(-|x-q_i(t)|\\big),$$ 其中 $q_i(t)$ 是尖峰位置，$p_i(t)$ 是尖峰振幅（动量）。在此拟设下，尖峰位置处的速度满足 $$\\dot{q}_i(t) = \\sum_{j=1}^N p_j(t)\\,\\exp\\!\\big(-|q_i(t)-q_j(t)|\\big),$$ 且振幅演化由一个哈密顿系统控制，该系统源于一个近似动能泛函的离散拉格朗日量。\n\n从几何力学和变分表述的基本原理出发，执行以下步骤：\n\n1. 利用动能与积分 $$\\int (u^2 + u_x^2)\\,dx$$ 的等同关系，推导尖峰位置 $q=(q_1,\\dots,q_N)$ 和速度 $\\dot{q}=(\\dot{q}_1,\\dots,\\dot{q}_N)$ 的有限维拉格朗日量。证明该拉格朗日量可以写成 $$L(q,\\dot{q}) = \\tfrac{1}{2}\\,\\dot{q}^\\top K(q)^{-1}\\dot{q},$$ 其中相互作用矩阵 $K(q)\\in\\mathbb{R}^{N\\times N}$ 的元素为 $$K_{ij}(q) = \\exp\\!\\big(-|q_i-q_j|\\big).$$ 同时证明，在勒让德变换下，以正则变量 $(q,p)$ 表示的哈密顿量为 $$H(q,p) = \\tfrac{1}{2}\\,p^\\top K(q)\\,p.$$\n\n2. 通过中点法则定义一个时间步长为 $h0$ 的离散拉格朗日量 $$L_d(q_k,q_{k+1};h) = h\\,L\\!\\left(\\tfrac{q_k+q_{k+1}}{2},\\,\\tfrac{q_{k+1}-q_k}{h}\\right) = \\tfrac{h}{2}\\,v^\\top K\\!\\left(\\tfrac{q_k+q_{k+1}}{2}\\right)^{-1}v,$$ 其中 $v=(q_{k+1}-q_k)/h$。写出离散欧拉-拉格朗日方程 $$D_2 L_d(q_{k-1},q_k;h) + D_1 L_d(q_k,q_{k+1};h) = 0,$$ 并解释这些方程在离散勒让德变换下如何等价于应用于以 $H(q,p)$ 为哈密顿量的正则哈密顿系统的隐式中点法。\n\n3. 为尖峰子哈密顿系统 $$\\dot{q} = \\frac{\\partial H}{\\partial p}(q,p),\\quad \\dot{p} = -\\frac{\\partial H}{\\partial q}(q,p),$$ 实现一个用于隐式中点更新的求解器，其中\n   - $$\\frac{\\partial H}{\\partial p}(q,p) = K(q)\\,p,$$\n   - $$\\frac{\\partial H}{\\partial q_i}(q,p) = -\\sum_{j=1}^N p_i p_j\\,\\operatorname{sign}(q_i-q_j)\\,\\exp\\!\\big(-|q_i-q_j|\\big),$$ 约定 $\\operatorname{sign}(0)=0$。\n   你的求解器必须处理一个时间步长的隐式中点方程\n   $$q_{k+1} = q_k + h\\,\\frac{\\partial H}{\\partial p}\\!\\left(\\tfrac{q_k+q_{k+1}}{2},\\,\\tfrac{p_k+p_{k+1}}{2}\\right),\\quad p_{k+1} = p_k - h\\,\\frac{\\partial H}{\\partial q}\\!\\left(\\tfrac{q_k+q_{k+1}}{2},\\,\\tfrac{p_k+p_{k+1}}{2}\\right),$$\n   使用牛顿迭代法，并以数值近似（可接受并期望使用有限差分）的方式计算雅可比矩阵。\n\n4. 设计与精确尖峰子轨迹进行比较的测试，如下所示：\n   - 对于单个尖峰子（$N=1$），精确解为 $$q(t) = q_0 + p_0\\,t,\\quad p(t) = p_0,$$ 必须用作参考轨迹。\n   - 对于多个尖峰子的情况（$N\\ge 2$），通过使用一个非常小的时间步长，用经典的四阶龙格-库塔方法数值求解正则哈密顿系统，来获得一个高精度的参考解，并将时间 $T$ 时的最终状态用作参考轨迹。\n\n5. 对于每个测试用例，你的程序必须计算在时间 $T$ 时，变分积分器和参考轨迹之间的最终状态误差向量的欧几里得范数。该误差向量是位置差异和动量差异的拼接（答案不涉及物理单位）。\n\n6. 使用以下测试套件（确保所有数值都按规定精确处理）：\n   - 测试用例 1 (正常路径): $N=1$, $q_0=-2$, $p_0=1.5$, $T=3$, $N_{\\text{steps}}=300$。\n   - 测试用例 2 (边界条件): $N=1$, $q_0=0.5$, $p_0=0$, $T=1$, $N_{\\text{steps}}=50$。\n   - 测试用例 3 (相互作用，良好分离的尖峰): $N=2$, $q_0=(-10,10)$, $p_0=(2,0.5)$, $T=0.5$, $N_{\\text{steps}}=200$, 参考积分使用 $N_{\\text{ref}}=50000$ 步。\n   - 测试用例 4 (边界情况，重合的尖峰): $N=2$, $q_0=(0,0)$, $p_0=(1,1)$, $T=0.1$, $N_{\\text{steps}}=50$, 参考积分使用 $N_{\\text{ref}}=50000$ 步。\n\n7. 最终输出格式：你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，“[result1,result2,result3,result4]”）。每个结果必须是一个浮点数（采用标准十进制表示法），代表相应测试用例的最终状态误差的欧几里得范数。\n\n不允许外部输入。实现必须是确定性的。使用为最终程序指定的数值库。所有角度（如果出现）必须以弧度为单位理解，但此问题不明确涉及角度。",
            "solution": "该问题已根据指定标准进行了验证。\n\n**结论**：该问题是**有效的**。\n\n**理由**：\n1.  **科学依据充分**：该问题深深植根于几何力学和可积系统理论这一成熟领域。Camassa-Holm 方程、其尖峰子解及其作为测地流的表述都是标准的研究课题。所提供的拉格朗日量、哈密顿量和导数的方程是正确的，并且可以在相关科学文献中找到。\n2.  **适定性**：所有必要信息，包括控制方程、数值方法、初始条件和测试参数，都已提供。任务是实现一个特定的算法并计算一个确定性的输出，这构成了计算科学中的一个适定问题。\n3.  **客观性**：该问题使用精确的数学语言陈述，没有任何主观或模糊的术语。\n\n该问题是计算几何力学中一个严谨且标准的练习，要求理论推导和数值实现。它满足了一个有效科学问题的所有标准。我们现在可以着手解决。\n\n解决方案按要求分为三部分：连续和离散力学框架的推导、数值实现的描述以及测试程序的说明。\n\n### 1. 尖峰子动力学的拉格朗日和哈密顿表述\n\n问题始于 Camassa-Holm 方程的动能，它对应于速度场 $u(x,t)$ 的 Sobolev $H^1$ 范数的平方。由于没有势能，我们将拉格朗日量等同于此动能。对于一个保守力学系统，拉格朗日量为 $L = T - V$。此处 $V=0$，动能由 $T = \\frac{1}{2} \\int_{-\\infty}^{\\infty} (u^2 + u_x^2) \\, dx$ 给出。\n\n$N$-尖峰子拟设由下式给出\n$$u(x,t) = \\sum_{i=1}^N p_i(t) \\exp\\!\\big(-|x-q_i(t)|\\big).$$\n该拟设的一个关键性质是，它表示了方程 $(1-\\partial_x^2) u = 2 \\sum_{i=1}^N p_i \\delta(x-q_i)$ 的一个分布解，其中 $\\delta(\\cdot)$ 是狄拉克 delta 函数。利用此性质，可以高效地计算动能。该积分表示 $H^1$ 内积，$\\langle u, u \\rangle_{H^1} = \\int (u \\cdot u + u_x \\cdot u_x) \\, dx$。通过分部积分，这等价于 $\\int u (1-\\partial_x^2)u \\, dx$。\n\n代入分布恒等式，我们得到：\n$$\n\\begin{aligned}\n2T = \\int_{-\\infty}^{\\infty} u(x,t) (1-\\partial_x^2)u(x,t) \\, dx \\\\\n= \\int_{-\\infty}^{\\infty} \\left( \\sum_{j=1}^N p_j e^{-|x-q_j|} \\right) \\left( 2 \\sum_{i=1}^N p_i \\delta(x-q_i) \\right) \\, dx \\\\\n= 2 \\sum_{i,j=1}^N p_i p_j \\int_{-\\infty}^{\\infty} e^{-|x-q_j|} \\delta(x-q_i) \\, dx.\n\\end{aligned}\n$$\n根据 delta 函数的筛选性质，$\\int f(x)\\delta(x-a)dx = f(a)$，积分计算结果为 $\\exp(-|q_i-q_j|)$。因此，\n$$2T = 2 \\sum_{i,j=1}^N p_i p_j \\exp(-|q_i-q_j|).$$\n用矩阵表示法，这是 $2T = p^\\top K(q) p$，其中 $p = (p_1, \\dots, p_N)^\\top$ 并且 $K(q)$ 是对称相互作用矩阵，其元素为 $K_{ij}(q) = \\exp(-|q_i-q_j|)$。\n\n系统的哈密顿量 $H(q,p)$ 等于其总能量，也就是动能。因此，\n$$H(q,p) = T = \\tfrac{1}{2}\\,p^\\top K(q)\\,p.$$\n这证实了问题陈述的第一部分。\n\n为了求得拉格朗日量 $L(q, \\dot{q})$，我们必须执行从相空间 $(q,p)$ 到位形空间 $(q, \\dot{q})$ 的勒让德变换。我们需要动量 $p$ 和速度 $\\dot{q}$ 之间的关系。第一个哈密顿方程给出了这个关系：\n$$\\dot{q} = \\frac{\\partial H}{\\partial p} = \\frac{\\partial}{\\partial p} \\left( \\tfrac{1}{2}\\,p^\\top K(q)\\,p \\right) = K(q)p.$$\n假设位置 $q_i$ 均不相同，则矩阵 $K(q)$ 是正定的，因而是可逆的。我们可以用速度来表示动量：\n$$p = K(q)^{-1}\\dot{q}.$$\n拉格朗日量由勒让德变换 $L(q, \\dot{q}) = p^\\top \\dot{q} - H(q,p(q,\\dot{q}))$ 定义。代入 $p$ 和 $H$ 的表达式：\n$$\n\\begin{aligned}\nL(q, \\dot{q}) = \\big(K(q)^{-1}\\dot{q}\\big)^\\top \\dot{q} - \\tfrac{1}{2}\\,\\big(K(q)^{-1}\\dot{q}\\big)^\\top K(q) \\big(K(q)^{-1}\\dot{q}\\big) \\\\\n= \\dot{q}^\\top (K(q)^{-1})^\\top \\dot{q} - \\tfrac{1}{2}\\,\\dot{q}^\\top (K(q)^{-1})^\\top K(q) K(q)^{-1} \\dot{q}.\n\\end{aligned}\n$$\n由于 $K(q)$ 是对称的，其逆矩阵 $K(q)^{-1}$ 也是对称的，所以 $(K(q)^{-1})^\\top = K(q)^{-1}$。这将表达式简化为：\n$$L(q, \\dot{q}) = \\dot{q}^\\top K(q)^{-1} \\dot{q} - \\tfrac{1}{2}\\,\\dot{q}^\\top K(q)^{-1} \\dot{q} = \\tfrac{1}{2}\\,\\dot{q}^\\top K(q)^{-1}\\dot{q}.$$\n这证实了问题陈述中给出的拉格朗日量的表达式。\n\n### 2. 变分积分器及其哈密顿对应部分\n\n变分积分器是通过离散化哈密顿平稳作用量原理 $\\delta \\int L(q, \\dot{q}) \\, dt = 0$ 推导出来的。我们使用一个求积法则来近似时间间隔 $[t_k, t_{k+1}]$ （时长 $h = t_{k+1}-t_k$）上的作用量积分。该问题指定了一个基于中点法则的离散拉格朗日量：\n$$L_d(q_k,q_{k+1};h) = h\\,L\\!\\left(\\tfrac{q_k+q_{k+1}}{2},\\,\\tfrac{q_{k+1}-q_k}{h}\\right).$$\n代入我们的 $L(q, \\dot{q})$ 表达式，并定义 $q_{mid} = \\frac{q_k+q_{k+1}}{2}$ 和 $v = \\frac{q_{k+1}-q_k}{h}$：\n$$L_d(q_k,q_{k+1};h) = \\tfrac{h}{2}\\,v^\\top K(q_{mid})^{-1}v = \\tfrac{1}{2h}(q_{k+1}-q_k)^\\top K\\!\\left(\\tfrac{q_k+q_{k+1}}{2}\\right)^{-1}(q_{k+1}-q_k).$$\n离散作用量是总和 $S_d = \\sum_k L_d(q_k, q_{k+1})$。离散平稳作用量原理 $\\delta S_d = 0$ 要求对于内部路径点 $q_k$ 的变分为零。这产生了离散欧拉-拉格朗日（DEL）方程：\n$$\\frac{\\partial}{\\partial q_k} \\Big( L_d(q_{k-1},q_k;h) + L_d(q_k,q_{k+1};h) \\Big) = D_2 L_d(q_{k-1},q_k;h) + D_1 L_d(q_k,q_{k+1};h) = 0,$$\n其中 $D_1$ 和 $D_2$ 分别表示关于第一个和第二个参数的偏导数。\n\n众所周知，这种离散变分表述等价于哈密顿方面的一个特定的辛积分器。我们通过离散勒让德变换定义区间 $[t_k, t_{k+1}]$ 两端的离散动量：\n$$p_k = -D_1 L_d(q_k, q_{k+1}) \\quad \\text{和} \\quad p_{k+1} = D_2 L_d(q_k, q_{k+1}).$$\n让我们为我们特定的 $L_d$ 分析这些定义：\n$$p_{k+1} = \\frac{\\partial L_d}{\\partial q_{k+1}} = \\frac{h}{2}\\frac{\\partial}{\\partial q_{k+1}} \\left( L(q_{mid}, v) \\right) = \\frac{h}{2} \\left( \\frac{\\partial L}{\\partial q_{mid}} \\frac{\\partial q_{mid}}{\\partial q_{k+1}} + \\frac{\\partial L}{\\partial v} \\frac{\\partial v}{\\partial q_{k+1}} \\right) = \\frac{h}{2} \\left( \\frac{1}{2}\\frac{\\partial L}{\\partial q} + \\frac{1}{h}\\frac{\\partial L}{\\partial \\dot{q}} \\right),$$\n其中 $L$ 的导数在 $(q_{mid}, v)$ 处求值。类似地，\n$$p_k = -\\frac{\\partial L_d}{\\partial q_{k}} = -\\frac{h}{2}\\frac{\\partial}{\\partial q_{k}} \\left( L(q_{mid}, v) \\right) = -\\frac{h}{2} \\left( \\frac{1}{2}\\frac{\\partial L}{\\partial q} - \\frac{1}{h}\\frac{\\partial L}{\\partial \\dot{q}} \\right).$$\n将这两个方程相加和相减得到：\n$$p_{k+1} + p_k = \\frac{\\partial L}{\\partial \\dot{q}}(q_{mid}, v) + \\frac{\\partial L}{\\partial \\dot{q}}(q_{mid}, v) = 2 \\frac{\\partial L}{\\partial \\dot{q}}(q_{mid}, v) = 2 p_{mid},$$\n$$p_{k+1} - p_k = \\frac{h}{2}\\frac{\\partial L}{\\partial q}(q_{mid}, v) + \\frac{h}{2}\\frac{\\partial L}{\\partial q}(q_{mid}, v) = h \\frac{\\partial L}{\\partial q}(q_{mid}, v).$$\n使用恒等式 $\\frac{\\partial L}{\\partial q} = -\\frac{\\partial H}{\\partial q}$ 和定义 $p = \\frac{\\partial L}{\\partial \\dot{q}}$，并重新整理，我们得到：\n$$p_{mid} = \\frac{p_k+p_{k+1}}{2} = p(q_{mid}, v) = K(q_{mid})^{-1}v = K(\\tfrac{q_k+q_{k+1}}{2})^{-1} (\\tfrac{q_{k+1}-q_k}{h}),$$\n$$\\frac{p_{k+1}-p_k}{h} = \\frac{\\partial L}{\\partial q}(q_{mid}, v) = -\\frac{\\partial H}{\\partial q}(q_{mid}, p_{mid}).$$\n从第一个方程，我们可以写出 $v = K(q_{mid})p_{mid}$。回想一下 $\\dot{q} = \\nabla_p H(q,p) = K(q)p$，我们有 $\\nabla_p H(q_{mid}, p_{mid}) = K(q_{mid})p_{mid} = v$。代入 $v = (q_{k+1}-q_k)/h$，我们得到完整的方程组：\n$$ \\frac{q_{k+1}-q_k}{h} = \\frac{\\partial H}{\\partial p}(\\tfrac{q_k+q_{k+1}}{2}, \\tfrac{p_k+p_{k+1}}{2}), $$\n$$ \\frac{p_{k+1}-p_k}{h} = -\\frac{\\partial H}{\\partial q}(\\tfrac{q_k+q_{k+1}}{2}, \\tfrac{p_k+p_{k+1}}{2}). $$\n这些恰好是应用于哈密顿系统的隐式中点法方程。这表明，从中点离散拉格朗日量推导出的变分积分器等价于隐式中点法，后者是一种一阶辛龙格-库塔方法。\n\n### 3. 数值实现\n\n为了将系统从状态 $(q_k, p_k)$ 在一个时间步长 $h$ 内推进到 $(q_{k+1}, p_{k+1})$，我们必须求解上述定义的 $2N$ 个非线性方程组。设状态向量为 $y = (q,p) \\in \\mathbb{R}^{2N}$。更新由 $y_{k+1} = y_k + h f(\\frac{y_k+y_{k+1}}{2})$ 给出，其中 $f(y) = (\\nabla_p H, -\\nabla_q H)$ 是哈密顿向量场。\n\n我们定义一个残差函数 $F(y_{k+1})$，其根给出了下一个时间步的解：\n$$ F(y_{k+1}) = y_{k+1} - y_k - h f\\left(\\frac{y_k+y_{k+1}}{2}\\right) = 0. $$\n该系统使用牛顿法求解。从一个初始猜测 $y_{k+1}^{(0)}$ 开始，我们使用更新规则迭代地优化猜测：\n$$ y_{k+1}^{(m+1)} = y_{k+1}^{(m)} - [J_F(y_{k+1}^{(m)})]^{-1} F(y_{k+1}^{(m)}), $$\n其中 $J_F$ 是 $F$ 关于 $y_{k+1}$ 的雅可比矩阵。雅可比矩阵由 $J_F(y) = I - \\frac{h}{2} J_f(\\frac{y_k+y}{2})$ 给出，其中 $J_f$ 是向量场 $f$ 的雅可比矩阵。该问题允许使用有限差分来近似 $J_F$，从而避免了其解析推导。对于雅可比矩阵的每一列 $j$，我们对于一个小的微扰 $\\epsilon$ 计算 $J_{F,j} \\approx \\frac{F(y+\\epsilon e_j) - F(y)}{\\epsilon}$，其中 $e_j$ 是第 $j$ 个标准基向量。在每次迭代中，求解线性系统 $J_F \\Delta y = -F$ 以获得修正量 $\\Delta y = y_{k+1}^{(m+1)} - y_{k+1}^{(m)}$。一个好的初始猜测 $y_{k+1}^{(0)}$ 可以通过一个显式欧拉步获得：$y_{k+1}^{(0)} = y_k + hf(y_k)$。\n\n### 4. 参考轨迹与误差评估\n\n为了评估变分积分器的精度，将其结果与参考解进行比较。\n-   **对于 $N=1$ 的尖峰子：** 哈密顿量为 $H(q,p) = \\frac{1}{2}p^2$。哈密顿方程为 $\\dot{q} = \\partial H/\\partial p = p$ 和 $\\dot{p} = -\\partial H/\\partial q = 0$。对于初始条件 $(q_0, p_0)$，精确解为 $p(t) = p_0$ 和 $q(t) = q_0 + p_0 t$。这个解析解作为精确参考。\n-   **对于 $N \\ge 2$ 的尖峰子：** 该系统通常不能以简单形式积分。通过使用经典的四阶龙格-库塔（RK4）方法，以一个非常小的时间步长 $h_{ref} = T/N_{ref}$（其中 $N_{ref}$ 远大于用于变分积分器的 $N_{steps}$）求解相同的哈密顿常微分方程，来生成一个高精度的数值参考解。\n\n在最终时间 $T$ 对误差进行量化。设变分积分器得到的最终状态为 $y_f = (q_f, p_f)$，参考最终状态为 $y_{ref} = (q_{ref}, p_{ref})$。误差向量定义为 $e = y_f - y_{ref}$。每个测试用例最终报告的值是此误差向量的欧几里得范数，$\\|e\\|_2 = \\sqrt{(q_f - q_{ref})^\\top(q_f - q_{ref}) + (p_f - p_{ref})^\\top(p_f - p_{ref})}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef _build_K_matrix(q):\n    \"\"\"Constructs the interaction matrix K(q).\"\"\"\n    q = np.asarray(q)\n    N = len(q)\n    q_col = q.reshape(N, 1)\n    q_row = q.reshape(1, N)\n    return np.exp(-np.abs(q_col - q_row))\n\ndef _grad_q_H(q, p):\n    \"\"\"Computes the partial derivative of the Hamiltonian H with respect to q.\"\"\"\n    q, p = np.asarray(q), np.asarray(p)\n    N = len(q)\n    \n    q_col = q.reshape(N, 1)\n    q_row = q.reshape(1, N)\n    \n    dist_matrix = q_col - q_row\n    # Problem specifies sign(0) = 0. np.sign(0) is 0.\n    sign_matrix = np.sign(dist_matrix)\n    \n    exp_matrix = np.exp(-np.abs(dist_matrix))\n    \n    p_col = p.reshape(N, 1)\n    p_row = p.reshape(1, N)\n    \n    # Element-wise product of matrices\n    term_matrix = p_col * p_row * sign_matrix * exp_matrix\n    \n    # Sum over each row (sum over j for each i)\n    grad = -np.sum(term_matrix, axis=1)\n    return grad\n\ndef hamiltonian_rhs(y):\n    \"\"\"\n    Computes the Hamiltonian vector field F = (dH/dp, -dH/dq).\n    y is a concatenated state vector [q, p].\n    \"\"\"\n    N = len(y) // 2\n    q, p = y[:N], y[N:]\n    \n    K = _build_K_matrix(q)\n    dq_dt = K @ p\n    dp_dt = -_grad_q_H(q, p)\n    \n    return np.concatenate([dq_dt, dp_dt])\n\ndef implicit_midpoint_step(y_k, h, tol=1e-12, max_iter=20):\n    \"\"\"\n    Performs one step of the implicit midpoint integrator using a Newton solver.\n    \"\"\"\n    dim = len(y_k)\n\n    # Initial guess using explicit Euler\n    y_next_guess = y_k + h * hamiltonian_rhs(y_k)\n\n    def F(y_next):\n        return y_next - y_k - h * hamiltonian_rhs(0.5 * (y_k + y_next))\n\n    # Newton iteration\n    for _ in range(max_iter):\n        # Calculate residual\n        res = F(y_next_guess)\n        \n        # Check for convergence\n        if np.linalg.norm(res)  tol:\n            return y_next_guess\n\n        # Approximate Jacobian J_F using finite differences\n        jac = np.zeros((dim, dim))\n        eps = 1e-8\n        for j in range(dim):\n            y_pert = y_next_guess.copy()\n            y_pert[j] += eps\n            res_pert = F(y_pert)\n            jac[:, j] = (res_pert - res) / eps\n        \n        # Solve the linear system for the update\n        try:\n            delta_y = np.linalg.solve(jac, -res)\n        except np.linalg.LinAlgError:\n            # If Jacobian is singular, use pseudo-inverse.\n            # This can happen in symmetric cases like test 4.\n            delta_y = np.linalg.pinv(jac) @ -res\n\n        # Update guess\n        y_next_guess += delta_y\n    \n    # If convergence is not reached, we still return the last guess.\n    # For this problem, it is expected to converge.\n    return y_next_guess\n\ndef rk4_step(y, h):\n    \"\"\"Performs one step of the classical 4th-order Runge-Kutta method.\"\"\"\n    k1 = hamiltonian_rhs(y)\n    k2 = hamiltonian_rhs(y + 0.5 * h * k1)\n    k3 = hamiltonian_rhs(y + 0.5 * h * k2)\n    k4 = hamiltonian_rhs(y + h * k3)\n    return y + (h / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n\ndef solve():\n    test_cases = [\n        # (N, q0, p0, T, N_steps, N_ref)\n        (1, np.array([-2.0]), np.array([1.5]), 3.0, 300, None),\n        (1, np.array([0.5]), np.array([0.0]), 1.0, 50, None),\n        (2, np.array([-10.0, 10.0]), np.array([2.0, 0.5]), 0.5, 200, 50000),\n        (2, np.array([0.0, 0.0]), np.array([1.0, 1.0]), 0.1, 50, 50000),\n    ]\n\n    results = []\n    for N, q0, p0, T, N_steps, N_ref in test_cases:\n        y0 = np.concatenate([q0, p0])\n        h = T / N_steps\n\n        # Variational integrator simulation\n        y_sim = y0.copy()\n        for _ in range(N_steps):\n            y_sim = implicit_midpoint_step(y_sim, h)\n        \n        # Reference trajectory calculation\n        if N == 1:\n            q_ref = q0 + p0 * T\n            p_ref = p0\n            y_ref = np.concatenate([q_ref, p_ref])\n        else:\n            y_ref = y0.copy()\n            h_ref = T / N_ref\n            for _ in range(N_ref):\n                y_ref = rk4_step(y_ref, h_ref)\n\n        # Error calculation\n        error = np.linalg.norm(y_sim - y_ref)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}