{
    "hands_on_practices": [
        {
            "introduction": "理解非完整力学始于掌握其底层的几何结构。本练习提供了一个直接的、动手计算的机会，为一个在 $\\mathbb{R}^3$ 中的简单系统构建反作用力余向量空间 $S_q$ 和允许位移分布 $D_q$。通过显式地找出这些空间的基向量，您将巩固对普法夫约束（Pfaffian constraints）如何在每一点上划分切空间和余切空间的理解。",
            "id": "3774076",
            "problem": "考虑一个力学系统，其位形流形为 $Q=\\mathbb{R}^{3}$，全局坐标为 $(q^{1},q^{2},q^{3})$。该系统受到线性速度约束，由一阶微分形式（one-form）$\\omega^{1}=dq^{1}+\\alpha\\,dq^{2}$ 和 $\\omega^{2}=dq^{3}$ 指定，其中 $\\alpha\\in\\mathbb{R}$ 是一个固定参数。根据非完整约束的谢塔耶夫原理，瞬时反作用力余向量位于子空间 $S_{q}\\subset T^{*}_{q}Q$ 中，该子空间由约束函数对速度的偏导数所得到的一阶微分形式张成。容许的虚位移构成约束分布 $D_{q}\\subset T_{q}Q$，该分布被 $S_{q}$ 零化。\n\n从切空间、余切空间、线性约束和谢塔耶夫虚位移容许性条件的基本定义出发，用坐标余向量 $\\{dq^{1},dq^{2},dq^{3}\\}$ 显式地计算零化空间 $S_{q}$，并通过在坐标基 $\\{\\partial/\\partial q^{1},\\partial/\\partial q^{2},\\partial/\\partial q^{3}\\}$ 中提供一个张成向量，将相应的约束分布 $D_{q}$ 确定为 $T_{q}Q$ 的一维子空间。\n\n答案规格：\n- 将最终答案表示为单个行矩阵，按顺序包含：首先是张成余向量 $\\omega^{1}$ 相对于 $\\{dq^{1},dq^{2},dq^{3}\\}$ 的三个系数，然后是张成余向量 $\\omega^{2}$ 的三个系数，最后是 $D_{q}$ 的一个张成向量在基 $\\{\\partial/\\partial q^{1},\\partial/\\partial q^{2},\\partial/\\partial q^{3}\\}$ 中的三个坐标。\n- 最终答案必须是单一的解析表达式；不需要单位。",
            "solution": "问题要求我们根据谢塔耶夫原理，为一个具有非完整约束的力学系统确定反作用力余向量子空间 $S_q$ 和相应的容许虚位移约束分布 $D_q$。\n\n位形流形是 $Q=\\mathbb{R}^{3}$，全局坐标为 $(q^{1}, q^{2}, q^{3})$。点 $q \\in Q$ 处的切空间是 $T_qQ$，其自然坐标基为 $\\{\\frac{\\partial}{\\partial q^{1}}, \\frac{\\partial}{\\partial q^{2}}, \\frac{\\partial}{\\partial q^{3}}\\}$。余切空间是 $T_q^*Q$，其对偶基为 $\\{dq^{1}, dq^{2}, dq^{3}\\}$。一个一般的向量 $v \\in T_qQ$ 可以写成 $v = \\dot{q}^{i} \\frac{\\partial}{\\partial q^{i}}$（使用爱因斯坦求和约定），其中 $\\dot{q}^{i}$ 是速度向量的分量。一个一般的余向量 $\\omega \\in T_q^*Q$ 可以写成 $\\omega = \\omega_i dq^{i}$。\n\n该系统受到两个线性速度约束，由以下一阶微分形式给出：\n$$ \\omega^{1} = dq^{1} + \\alpha \\, dq^{2} $$\n$$ \\omega^{2} = dq^{3} $$\n其中 $\\alpha \\in \\mathbb{R}$ 是一个常数。这些约束表示为 $\\omega^{k}(v) = 0$，其中 $k=1,2$。用速度分量表示，这可以转化为：\n1. $f_1(\\dot{q}) = \\omega^{1}(v) = (dq^{1} + \\alpha \\, dq^{2})(\\dot{q}^{i} \\frac{\\partial}{\\partial q^{i}}) = \\dot{q}^{1} + \\alpha \\dot{q}^{2} = 0$\n2. $f_2(\\dot{q}) = \\omega^{2}(v) = dq^{3}(\\dot{q}^{i} \\frac{\\partial}{\\partial q^{i}}) = \\dot{q}^{3} = 0$\n此处，$f_1$ 和 $f_2$ 是约束函数，它们只依赖于速度。\n\n问题指出，反作用力余向量子空间 $S_q$ 由约束函数对速度分量的偏导数所得到的一阶微分形式张成。对于一组一般的线性约束 $f_k(\\dot{q}) = A_{ki}(q)\\dot{q}^i = 0$，相应的约束一阶微分形式是 $\\omega^k = A_{ki}(q) dq^i$。我们可以验证，问题的描述与这个标准定义是等价的。张成余向量为 $\\sum_{i} \\frac{\\partial f_k}{\\partial \\dot{q}^{i}} dq^{i}$。\n\n对于第一个约束 $f_1 = \\dot{q}^{1} + \\alpha \\dot{q}^{2}$:\n$$ \\frac{\\partial f_1}{\\partial \\dot{q}^{1}} = 1, \\quad \\frac{\\partial f_1}{\\partial \\dot{q}^{2}} = \\alpha, \\quad \\frac{\\partial f_1}{\\partial \\dot{q}^{3}} = 0 $$\n相应的一阶微分形式是 $1 \\cdot dq^{1} + \\alpha \\cdot dq^{2} + 0 \\cdot dq^{3} = dq^{1} + \\alpha \\, dq^{2}$，这恰好是 $\\omega^{1}$。\n\n对于第二个约束 $f_2 = \\dot{q}^{3}$:\n$$ \\frac{\\partial f_2}{\\partial \\dot{q}^{1}} = 0, \\quad \\frac{\\partial f_2}{\\partial \\dot{q}^{2}} = 0, \\quad \\frac{\\partial f_2}{\\partial \\dot{q}^{3}} = 1 $$\n相应的一阶微分形式是 $0 \\cdot dq^{1} + 0 \\cdot dq^{2} + 1 \\cdot dq^{3} = dq^{3}$，这恰好是 $\\omega^{2}$。\n\n因此，反作用力余向量子空间 $S_q \\subset T_q^*Q$ 由给定的约束一阶微分形式张成：\n$$ S_q = \\text{span}\\{\\omega^{1}, \\omega^{2}\\} = \\text{span}\\{dq^{1} + \\alpha \\, dq^{2}, dq^{3}\\} $$\n张成余向量 $\\omega^{1}$ 相对于基 $\\{dq^{1}, dq^{2}, dq^{3}\\}$ 的系数是 $(1, \\alpha, 0)$。\n张成余向量 $\\omega^{2}$ 相对于基 $\\{dq^{1}, dq^{2}, dq^{3}\\}$ 的系数是 $(0, 0, 1)$。\n\n接下来，我们确定约束分布 $D_q \\subset T_qQ$。根据谢塔耶夫原理，容许的虚位移是被反作用力余向量零化的向量。因此，$D_q$ 是 $S_q$ 的零化子，记作 $D_q = (S_q)^{\\circ}$。一个向量 $X \\in T_qQ$ 属于 $D_q$ 当且仅当对于所有 $\\omega \\in S_q$ 都有 $\\omega(X) = 0$。这等价于对 $S_q$ 的基向量检验该条件：\n$$ \\omega^{k}(X) = 0 \\quad \\text{for } k=1, 2 $$\n\n设向量 $X \\in D_q$ 在坐标基中表示为 $X = v^{1}\\frac{\\partial}{\\partial q^{1}} + v^{2}\\frac{\\partial}{\\partial q^{2}} + v^{3}\\frac{\\partial}{\\partial q^{3}}$。条件变为：\n1. $\\omega^{1}(X) = (dq^{1} + \\alpha \\, dq^{2})(v^{i}\\frac{\\partial}{\\partial q^{i}}) = v^{1} + \\alpha v^{2} = 0$\n2. $\\omega^{2}(X) = dq^{3}(v^{i}\\frac{\\partial}{\\partial q^{i}}) = v^{3} = 0$\n\n我们得到了一个关于 $X$ 的三个分量 $(v^{1}, v^{2}, v^{3})$ 的两个线性方程组：\n$$ v^{1} + \\alpha v^{2} = 0 $$\n$$ v^{3} = 0 $$\n从第一个方程，我们有 $v^{1} = -\\alpha v^{2}$。第二个方程给出 $v^{3}=0$。分量 $v^{2}$ 是一个自由参数。我们设 $v^2 = c$，其中 $c$ 为任意实数。那么任何向量 $X \\in D_q$ 的形式为：\n$$ X = (-\\alpha c)\\frac{\\partial}{\\partial q^{1}} + c\\frac{\\partial}{\\partial q^{2}} + 0\\frac{\\partial}{\\partial q^{3}} = c \\left(-\\alpha\\frac{\\partial}{\\partial q^{1}} + \\frac{\\partial}{\\partial q^{2}}\\right) $$\n空间 $D_q$ 是一个一维分布，这与预期相符，因为 $\\dim(D_q) = \\dim(T_qQ) - \\dim(S_q) = 3-2=1$（因为 $\\omega^1$ 和 $\\omega^2$ 是线性无关的）。\n$D_q$ 的一个张成向量可以通过为 $c$ 选择任何非零值来找到。一个典型的选择是 $c=1$，这给出了张成向量：\n$$ X_D = -\\alpha\\frac{\\partial}{\\partial q^{1}} + 1\\cdot\\frac{\\partial}{\\partial q^{2}} + 0\\cdot\\frac{\\partial}{\\partial q^{3}} $$\n这个张成向量在基 $\\{\\frac{\\partial}{\\partial q^{1}}, \\frac{\\partial}{\\partial q^{2}}, \\frac{\\partial}{\\partial q^{3}}\\}$ 中的坐标是 $(-\\alpha, 1, 0)$。\n\n总结所求的量：\n- 张成余向量 $\\omega^{1}$ 的系数是 $(1, \\alpha, 0)$。\n- 张成余向量 $\\omega^{2}$ 的系数是 $(0, 0, 1)$。\n- $D_q$ 的一个张成向量的坐标是 $(-\\alpha, 1, 0)$。\n\n最终答案以一个单行矩阵的形式呈现，按指定顺序包含这九个值。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  \\alpha  0  0  0  1  -\\alpha  1  0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "非完整约束的一个深刻后果是对守恒律的修正。本练习研究一个具有明显平移对称性的粒子，并揭示了为何相应的线性动量不守恒。通过直接计算和几何推理，您将揭示约束分布在破坏对称性方面的关键作用，并了解谢塔耶夫原理如何解释导致动量变化的约束力。",
            "id": "3774092",
            "problem": "考虑一个质量为 $m$ 的自由粒子，在三维欧几里得空间中运动，坐标为 $(x,y,z)$，其动能拉格朗日量为 $L=\\tfrac{1}{2}m(\\dot{x}^{2}+\\dot{y}^{2}+\\dot{z}^{2})$。施加由一形式 $\\omega=dz-x\\,dy$ 给出的线性速度约束，因此允许的速度满足 $\\omega(\\dot{q})=\\dot{z}-x\\,\\dot{y}=0$。使用拉格朗日-达朗贝尔原理和谢塔耶夫容许虚位移，即容许虚位移 $\\delta q$ 满足 $\\omega(\\delta q)=0$，并且约束反作用力在此类位移上不做功。\n\n1. 从这些原理出发，推导带有拉格朗日乘子 $\\lambda$ 的约束运动方程，并通过一致地施加约束来确定 $\\lambda$ 关于 $(x,\\dot{x},\\dot{y})$ 的表达式。\n\n2. 考虑对应于 $y$ 方向平移的对称性（生成元为 $\\xi_{Q}=\\partial_{y}$），计算相关动量 $p_{y}=m\\,\\dot{y}$ 沿约束动力学任一解的时间导数的显式表达式。你的最终答案必须是单一的闭式解析表达式。\n\n3. 用与约束分布 $\\mathcal{D}=\\ker\\omega$ 相关的几何术语解释为何 $y$ 方向平移动量不守恒，将你的计算与对称性生成元同约束分布及其零化子的对准关系联系起来。\n\n将 $p_{y}$ 的时间导数的最终答案表示为单一的解析表达式。不需要数值四舍五入。最终表达式中不应包含单位。",
            "solution": "该问题被验证为具有科学依据、问题明确且客观。这是一个非完整力学中的标准问题，需要应用带有谢塔耶夫法则的拉格朗日-达朗贝尔原理。所有必要数据均已提供且一致。\n\n解答过程按问题陈述的要求分为三部分。首先，我们推导约束运动方程并确定拉格朗日乘子。其次，我们计算与 $y$ 方向平移对称性相关的动量的时间导数。第三，我们为该动量不守恒提供一个几何解释。\n\n**1. 运动方程和拉格朗日乘子的推导**\n\n该系统由位形空间 $\\mathbb{R}^3$ （坐标为 $q=(x,y,z)$）上的拉格朗日量 $L=\\frac{1}{2}m(\\dot{x}^{2}+\\dot{y}^{2}+\\dot{z}^{2})$ 描述。动力学受到由一形式 $\\omega=dz-x\\,dy$ 给出的线性速度约束。约束方程为 $\\omega(\\dot{q}) = \\dot{z}-x\\,\\dot{y}=0$。\n\n根据带有谢塔耶夫法则的拉格朗日-达朗贝尔原理，运动方程由经约束力修正的 Euler-Lagrange 方程给出：\n$$ \\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{q}^i}\\right) - \\frac{\\partial L}{\\partial q^i} = F_{c,i} $$\n其中 $F_c$ 是约束力一形式。对容许虚位移 $\\delta q$ 的谢塔耶夫条件是它们必须满足约束，即 $\\omega(\\delta q) = \\delta z - x\\,\\delta y = 0$。虚功为零原理规定约束力在任何容许虚位移上不做功，这意味着约束力一形式 $F_c$ 必须与约束一形式 $\\omega$ 成正比。因此，对于某个标量函数 $\\lambda(t)$（即拉格朗日乘子），有 $F_c = \\lambda \\omega$。\n\n约束力的分量通过展开 $F_c = \\lambda \\omega = \\lambda(dz - x\\,dy)$ 得到：\n$F_{c,x} = 0$\n$F_{c,y} = -x\\lambda$\n$F_{c,z} = \\lambda$\n\n拉格朗日量的导数为：\n$\\frac{\\partial L}{\\partial \\dot{x}} = m\\dot{x}$，$\\frac{\\partial L}{\\partial \\dot{y}} = m\\dot{y}$，$\\frac{\\partial L}{\\partial \\dot{z}} = m\\dot{z}$。\n$\\frac{\\partial L}{\\partial x} = 0$，$\\frac{\\partial L}{\\partial y} = 0$，$\\frac{\\partial L}{\\partial z} = 0$。\n\n将这些代入 Euler-Lagrange 方程，得到约束运动方程：\n$$\n\\begin{align*}\nm\\ddot{x} = 0 \\quad (1) \\\\\nm\\ddot{y} = -x\\lambda \\quad (2) \\\\\nm\\ddot{z} = \\lambda \\quad (3)\n\\end{align*}\n$$\n\n为了确定拉格朗日乘子 $\\lambda$，我们通过要求约束方程沿有效轨线的时间导数为零来施加约束。将约束方程 $\\dot{z} - x\\dot{y} = 0$ 对时间求导，得到：\n$$ \\frac{d}{dt}(\\dot{z} - x\\dot{y}) = \\ddot{z} - \\dot{x}\\dot{y} - x\\ddot{y} = 0 $$\n现在，我们将运动方程中 $\\ddot{y}$ 和 $\\ddot{z}$ 的表达式 $\\ddot{y} = -\\frac{x\\lambda}{m}$ 和 $\\ddot{z} = \\frac{\\lambda}{m}$ 代入已求导的约束方程：\n$$ \\left(\\frac{\\lambda}{m}\\right) - \\dot{x}\\dot{y} - x\\left(-\\frac{x\\lambda}{m}\\right) = 0 $$\n$$ \\frac{\\lambda}{m} - \\dot{x}\\dot{y} + \\frac{x^2\\lambda}{m} = 0 $$\n$$ \\frac{\\lambda}{m}(1+x^2) = \\dot{x}\\dot{y} $$\n解出 $\\lambda$，得到其关于状态变量的表达式：\n$$ \\lambda = \\frac{m\\dot{x}\\dot{y}}{1+x^2} $$\n\n**2. 动量 $p_y$ 的时间导数**\n\n与坐标 $y$ 共轭的动量定义为 $p_y = \\frac{\\partial L}{\\partial \\dot{y}}$。\n$$ p_y = m\\dot{y} $$\n该动量的时间导数为 $\\frac{dp_y}{dt} = \\frac{d}{dt}(m\\dot{y}) = m\\ddot{y}$。\n根据第二个运动方程 (2)，我们有 $m\\ddot{y} = -x\\lambda$。\n代入上一步中我们找到的 $\\lambda$ 的表达式：\n$$ \\frac{dp_y}{dt} = -x\\left(\\frac{m\\dot{x}\\dot{y}}{1+x^2}\\right) $$\n$$ \\frac{dp_y}{dt} = -\\frac{mx\\dot{x}\\dot{y}}{1+x^2} $$\n该表达式通常不为零，这表明动量 $p_y$ 不是一个守恒量。\n\n**3. $p_y$ 不守恒的几何解释**\n\n拉格朗日量 $L$ 与坐标 $y$ 无关，这意味着系统在 $y$ 方向的平移下具有对称性。该对称性的无穷小生成元是位形空间上的矢量场 $\\xi_Q = \\partial_y$。在没有非完整约束的情况下，Noether 定理将保证相关动量 $p_y$ 的守恒。\n\n在非完整系统中，与对称性 $\\xi_Q$ 相关的动量守恒，当且仅当该对称性是约束系统的一个“动力学对称性”。这要求约束力在沿对称性生成元的位移上不做功，即 $\\langle F_c, \\xi_Q \\rangle = 0$。由于 $F_c = \\lambda \\omega$，此条件等价于 $\\lambda \\omega(\\xi_Q) = 0$。\n\n让我们为我们的系统计算 $\\omega(\\xi_Q)$：\n$$ \\omega(\\xi_Q) = (dz - x\\,dy)(\\partial_y) = dz(\\partial_y) - x\\,dy(\\partial_y) $$\n根据定义，$dz(\\partial_y) = 0$ 且 $dy(\\partial_y) = 1$。因此，\n$$ \\omega(\\xi_Q) = -x $$\n动量 $p_y$ 的变化率由下式给出：\n$$ \\frac{dp_y}{dt} = \\langle F_c, \\xi_Q \\rangle = \\lambda \\omega(\\xi_Q) = -x\\lambda $$\n这与从运动方程得到的结果相符。\n\n从几何上看，$p_y$ 的不守恒源于对称性生成元 $\\xi_Q$ 与约束分布 $\\mathcal{D} = \\ker \\omega$ 之间的不对准。分布 $\\mathcal{D}$ 是切空间中包含所有容许速度的子空间。一个对称性的相关动量守恒，如果其生成元矢量场在每一点都位于该分布之内，即 $\\xi_Q \\in \\mathcal{D}$。这等价于条件 $\\omega(\\xi_Q) = 0$。\n\n由于我们发现 $\\omega(\\xi_Q) = -x$（非恒等于零），对称性生成元 $\\xi_Q = \\partial_y$ 不是约束分布 $\\mathcal{D}$ 的一个截面（在平面 $x=0$ 上除外）。这意味着纯粹的 $y$ 方向平移不是一个容许的虚位移。因此，与 $\\mathcal{D}$ 中所有矢量正交的约束力 $F_c = \\lambda \\omega$，不一定与 $\\xi_Q$ 正交。约束力在对称性方向上的非零投影 $\\langle F_c, \\xi_Q \\rangle = -x\\lambda$ 做功，并导致动量 $p_y$ 随时间变化。对称性相对于约束分布未能“水平”，是守恒律失效的根本几何原因。",
            "answer": "$$\\boxed{-\\frac{mx\\dot{x}\\dot{y}}{1+x^2}}$$"
        },
        {
            "introduction": "为了连接理论与实践，这最后一个练习要求您为一个经典的复杂非完整系统——滚动的圆盘——实现数值解。您将实现并比较两种计算约束加速度的有效方法：拉格朗日乘子法和等效的几何投影法。这项练习不仅强化了这两种形式在理论上的等价性，还为模拟和分析实际的非完整动力学系统提供了必要的技能。",
            "id": "3774109",
            "problem": "考虑一个建模为非完整力学系统的平面刚性滚动圆盘。设其位形由广义坐标 $q = (x, y, \\theta, \\phi)$ 表示，其中 $x$ 和 $y$ 表示圆盘中心的笛卡尔坐标，$\\theta$ 是圆盘的航向（偏航）角（滚动方向相对于 $x$ 轴的角度），$\\phi$ 是圆盘围绕其轴的自旋角。圆盘的质量为 $m$，半径为 $r$，绕垂直（偏航）轴的转动惯量为 $I_\\theta$，绕其自身轴（自旋）的转动惯量为 $I_\\phi$。动能由 $T = \\frac{1}{2} m (\\dot{x}^2 + \\dot{y}^2) + \\frac{1}{2} I_\\theta \\dot{\\theta}^2 + \\frac{1}{2} I_\\phi \\dot{\\phi}^2$ 给出，并假设势能为零。广义外力为 $Q = (F_x, F_y, \\tau_\\theta, \\tau_\\phi)$，可以不为零。\n\n无滑滚动约束在速度上是线性的，由以下两个普法夫方程给出：\n$$\n-\\sin\\theta\\,\\dot{x} + \\cos\\theta\\,\\dot{y} = 0, \\quad \\cos\\theta\\,\\dot{x} + \\sin\\theta\\,\\dot{y} - r\\,\\dot{\\phi} = 0,\n$$\n可以写成矩阵形式 $A(q)\\,\\dot{q} = 0$，其中\n$$\nA(q) = \\begin{bmatrix}\n-\\sin\\theta  \\ \\cos\\theta  \\ 0  \\ 0 \\\\\n\\ \\cos\\theta  \\ \\sin\\theta  \\ 0  -r\n\\end{bmatrix}.\n$$\n角度必须以弧度表示，距离以米表示，质量以千克表示，时间以秒表示，力以牛顿表示，力矩以牛顿米表示。\n\n对于非完整约束，谢塔耶夫原理规定约束反作用力在根据普法夫约束选择的虚位移上不做虚功，从而导出带乘子的拉格朗日-达朗贝尔方程：\n$$\nM\\,\\ddot{q} = Q + A(q)^\\top \\lambda, \\quad A(q)\\,\\dot{q} = 0, \\quad A(q)\\,\\ddot{q} + \\dot{A}(q,\\dot{q})\\,\\dot{q} = 0,\n$$\n其中 $M = \\mathrm{diag}(m, m, I_\\theta, I_\\phi)$ 是质量-惯性矩阵，$\\lambda \\in \\mathbb{R}^2$ 是实施约束的拉格朗日乘子。这里，$\\dot{A}(q,\\dot{q})$ 表示 $A$ 沿运动轨迹的时间导数。\n\n另一种几何构造方法使用投影法：给定由 $M$ 定义动能度量 $g$ 的力学型拉格朗日量，以及约束分布 $\\mathcal{D} = \\{ \\dot{q} \\mid A(q)\\,\\dot{q} = 0 \\}$，受约束加速度可通过将无约束加速度 $a_0 = M^{-1} Q$ 使用 $M$-正交投影，投影到满足微分后约束的加速度上得到，其公式形式为\n$$\n\\ddot{q} = a_0 + M^{-1} A(q)^\\top \\lambda, \\quad \\text{其中 } \\lambda \\text{ 的选择需满足 } A(q)\\,\\ddot{q} = -\\dot{A}(q,\\dot{q})\\,\\dot{q}。\n$$\n你的任务是实现这两种方法，以计算滚动圆盘的受约束加速度矢量场 $\\ddot{q}$：\n- 方法1（基于乘子）：求解由带谢塔耶夫乘子的拉格朗日-达朗贝尔方程产生的耦合线性系统。\n- 方法2（基于投影）：计算无约束加速度 $a_0 = M^{-1} Q$ 在满足微分后约束的加速度上的 $M$-正交投影。\n\n对于数值实现：\n- 如上计算 $A(q)$。\n- 使用链式法则计算 $\\dot{A}(q,\\dot{q})\\,\\dot{q}$。由于 $A$ 仅依赖于 $\\theta$，这可简化为 $\\dot{A}(q,\\dot{q})\\,\\dot{q} = \\frac{\\partial A}{\\partial \\theta}\\,\\dot{\\theta}\\,\\dot{q}$，其中\n$$\n\\frac{\\partial A}{\\partial \\theta} = \\begin{bmatrix}\n-\\cos\\theta  -\\sin\\theta  0  0 \\\\\n-\\sin\\theta  \\ \\cos\\theta  0  0\n\\end{bmatrix}.\n$$\n\n实现这两种计算，并通过在以下参数值的测试套件上报告数值差异来比较得出的加速度。在每个测试用例中，初始速度 $(\\dot{x}, \\dot{y}, \\dot{\\theta}, \\dot{\\phi})$ 必须满足约束 $A(q)\\,\\dot{q} = 0$，且角度以弧度为单位。\n\n测试套件：\n1. 带小自旋力矩的一般运动：\n   - $m = 1.5$，$r = 0.3$，$I_\\theta = 0.2$，$I_\\phi = 0.05$，$\\theta = 0.5$，$v = 0.6$（前进速度），$\\dot{\\theta} = 0.3$。\n   - 定义 $\\dot{x} = v \\cos\\theta$，$\\dot{y} = v \\sin\\theta$，$\\dot{\\phi} = v / r$。\n   - $Q = (0,\\ 0,\\ 0.0,\\ 0.02)$。\n2. 静止时施加自旋力矩：\n   - $m = 2.0$，$r = 0.25$，$I_\\theta = 0.25$，$I_\\phi = 0.08$，$\\theta = 1.2$，$v = 0.0$，$\\dot{\\theta} = 0.0$。\n   - 定义 $\\dot{x} = 0$，$\\dot{y} = 0$，$\\dot{\\phi} = 0$。\n   - $Q = (0,\\ 0,\\ 0.0,\\ 0.1)$。\n3. 沿航向受力的极轻圆盘：\n   - $m = 0.01$，$r = 0.2$，$I_\\theta = 0.05$，$I_\\phi = 0.02$，$\\theta = 0.4$，$v = 0.5$，$\\dot{\\theta} = 0.0$。\n   - 定义 $\\dot{x} = v \\cos\\theta$，$\\dot{y} = v \\sin\\theta$，$\\dot{\\phi} = v / r$。\n   - 令 $F = 0.3$ 且 $Q = (F \\cos\\theta,\\ F \\sin\\theta,\\ 0.0,\\ 0.0)$。\n4. 带自旋力矩和轻微偏航的小半径圆盘：\n   - $m = 1.0$，$r = 0.05$，$I_\\theta = 0.15$，$I_\\phi = 0.02$，$\\theta = 0.9$，$v = 0.3$，$\\dot{\\theta} = 0.1$。\n   - 定义 $\\dot{x} = v \\cos\\theta$，$\\dot{y} = v \\sin\\theta$，$\\dot{\\phi} = v / r$。\n   - $Q = (0,\\ 0,\\ 0.0,\\ 0.2)$。\n\n最终输出规格：\n- 对于每个测试用例，通过两种方法计算 $\\ddot{q}$ 并构成差分向量 $\\Delta = \\ddot{q}_{\\mathrm{proj}} - \\ddot{q}_{\\mathrm{mult}}$。\n- 为每个测试用例报告两个数值：\n  1. $\\Delta_{\\mathrm{lin}} = \\max\\{|\\Delta_x|, |\\Delta_y|\\}$，以米/秒$^2$（m/s$^2$）表示。\n  2. $\\Delta_{\\mathrm{ang}} = \\max\\{|\\Delta_\\theta|, |\\Delta_\\phi|\\}$，以弧度/秒$^2$（rad/s$^2$）表示。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表项为四个测试用例的线性和角向差异交替出现。例如，输出格式必须与此完全一样：\n$$\n[\\Delta_{\\mathrm{lin},1},\\Delta_{\\mathrm{ang},1},\\Delta_{\\mathrm{lin},2},\\Delta_{\\mathrm{ang},2},\\Delta_{\\mathrm{lin},3},\\Delta_{\\mathrm{ang},3},\\Delta_{\\mathrm{lin},4},\\Delta_{\\mathrm{ang},4}],\n$$\n其中下标 $i$ 表示第 $i$ 个测试用例。所有角度以弧度表示，加速度以指定单位表示，并将每个报告值四舍五入到八位小数。",
            "solution": "该问题是有效的。这是一个经典力学中适定的问题，特别是非完整动力学领域，基于已建立的科学原理（谢塔耶夫原理和拉格朗日-达朗贝尔方程）。参数和初始条件是完整、一致且物理上合理的。\n\n在此，我们提出一个系统性的解法，用两种不同但在数学上等价的方法来计算滚动圆盘的受约束加速度。\n\n### 1. 系统定义\n滚动圆盘的位形由广义坐标 $q = (x, y, \\theta, \\phi) \\in \\mathbb{R}^4$ 描述。系统的动力学由其动能 $T$ 决定，势能为零。动能是广义速度 $\\dot{q}$ 的二次型，$T(\\dot{q}) = \\frac{1}{2} \\dot{q}^\\top M \\dot{q}$，其中 $M$ 是常对角质量-惯性矩阵：\n$$\nM = \\mathrm{diag}(m, m, I_\\theta, I_\\phi)\n$$\n运动受到两个无滑滚动的非完整约束，这些约束在速度上是线性的，可以写成 $A(q)\\dot{q} = 0$，其约束矩阵为：\n$$\nA(q) = \\begin{bmatrix}\n-\\sin\\theta  \\ \\cos\\theta  \\ 0  \\ 0 \\\\\n\\ \\cos\\theta  \\ \\sin\\theta  \\ 0  -r\n\\end{bmatrix}\n$$\n约束必须在所有时间都成立，这意味着它们的时间导数也必须为零：\n$$\n\\frac{d}{dt}(A(q)\\dot{q}) = \\dot{A}(q, \\dot{q})\\dot{q} + A(q)\\ddot{q} = 0\n$$\n这给出了关于加速度的约束方程：\n$$\nA(q)\\ddot{q} = -\\dot{A}(q, \\dot{q})\\dot{q}\n$$\n我们来计算右侧的向量，记为 $b = -\\dot{A}(q, \\dot{q})\\dot{q}$。由于 $A$ 仅依赖于 $\\theta = q_3$，链式法则给出 $\\dot{A} = \\frac{\\partial A}{\\partial \\theta}\\dot{\\theta}$。因此，$b$ 项为：\n$$\nb = -\\left(\\frac{\\partial A}{\\partial \\theta}\\dot{\\theta}\\right)\\dot{q} = -\\dot{\\theta} \\begin{bmatrix}\n-\\cos\\theta  -\\sin\\theta  0  0 \\\\\n-\\sin\\theta  \\cos\\theta  0  0\n\\end{bmatrix}\n\\begin{bmatrix} \\dot{x} \\\\ \\dot{y} \\\\ \\dot{\\theta} \\\\ \\dot{\\phi} \\end{bmatrix}\n= -\\dot{\\theta} \\begin{bmatrix} -\\dot{x}\\cos\\theta - \\dot{y}\\sin\\theta \\\\ -\\dot{x}\\sin\\theta + \\dot{y}\\cos\\theta \\end{bmatrix}\n$$\n测试用例将速度定义为 $\\dot{x} = v \\cos\\theta$ 和 $\\dot{y} = v \\sin\\theta$，这满足第一个约束。将这些代入 $b$ 的表达式中，会得到显著的简化：\n$$\n-\\dot{x}\\cos\\theta - \\dot{y}\\sin\\theta = -v(\\cos^2\\theta + \\sin^2\\theta) = -v\n$$\n$$\n-\\dot{x}\\sin\\theta + \\dot{y}\\cos\\theta = -v(\\cos\\theta\\sin\\theta - \\sin\\theta\\cos\\theta) = 0\n$$\n因此，加速度约束的右侧变为：\n$$\nb = -\\dot{\\theta} \\begin{bmatrix} -v \\\\ 0 \\end{bmatrix} = \\begin{bmatrix} v\\dot{\\theta} \\\\ 0 \\end{bmatrix}\n$$\n\n### 2. 方法1：基于乘子的解法\n该系统的拉格朗日-达朗贝尔方程，包含了广义外力 $Q$ 和通过拉格朗日乘子 $\\lambda \\in \\mathbb{R}^2$ 引入的约束力，为：\n$$\nM\\ddot{q} = Q + A(q)^\\top \\lambda \\quad \\text{或} \\quad M\\ddot{q} - A(q)^\\top \\lambda = Q\n$$\n我们将此方程与加速度约束 $A(q)\\ddot{q} = b$ 结合。这就构成了一个包含6个方程的耦合线性系统，用于求解6个未知数，即 $\\ddot{q}$ 的4个分量和 $\\lambda$ 的2个分量。以分块矩阵形式，该系统为：\n$$\n\\begin{bmatrix} M  -A(q)^\\top \\\\ A(q)  \\mathbf{0}_{2\\times2} \\end{bmatrix} \\begin{bmatrix} \\ddot{q} \\\\ \\lambda \\end{bmatrix} = \\begin{bmatrix} Q \\\\ b \\end{bmatrix}\n$$\n其中 $\\mathbf{0}_{2\\times2}$ 是 $2 \\times 2$ 的零矩阵。这个鞍点系统可以求解出向量 $[\\ddot{q}^\\top, \\lambda^\\top]^\\top$。解向量的前四个分量即为所求的加速度 $\\ddot{q}_{\\mathrm{mult}}$。\n\n### 3. 方法2：基于投影的解法\n该方法通过先求解乘子 $\\lambda$ 来解耦问题。我们首先从运动方程中表达出 $\\ddot{q}$：\n$$\n\\ddot{q} = M^{-1}(Q + A(q)^\\top \\lambda)\n$$\n然后，我们将此表达式代入加速度约束 $A(q)\\ddot{q} = b$ 中：\n$$\nA(q) \\left( M^{-1}(Q + A(q)^\\top \\lambda) \\right) = b\n$$\n重新整理各项以求解 $\\lambda$：\n$$\nA(q) M^{-1} Q + A(q) M^{-1} A(q)^\\top \\lambda = b\n$$\n$$\n\\left( A(q) M^{-1} A(q)^\\top \\right) \\lambda = b - A(q) M^{-1} Q\n$$\n这是一个关于 $\\lambda$ 的 $2 \\times 2$ 线性系统，形式为 $G\\lambda = c$，其中 $G = A(q) M^{-1} A(q)^\\top$ 是格拉姆矩阵，而 $c = b - A(q) M^{-1} Q$。格拉姆矩阵可以显式计算：\n$$\nG_c = A M^{-1} A^\\top = \\begin{bmatrix} -\\frac{\\sin\\theta}{m}  \\frac{\\cos\\theta}{m}  0  0 \\\\ \\frac{\\cos\\theta}{m}  \\frac{\\sin\\theta}{m}  0  -\\frac{r}{I_\\phi} \\end{bmatrix} \\begin{bmatrix} -\\sin\\theta  \\cos\\theta \\\\ \\cos\\theta  \\sin\\theta \\\\ 0  0 \\\\ 0  -r \\end{bmatrix}\n$$\n$$\nG_c = \\begin{bmatrix} \\frac{\\sin^2\\theta}{m} + \\frac{\\cos^2\\theta}{m}  -\\frac{\\sin\\theta\\cos\\theta}{m} + \\frac{\\cos\\theta\\sin\\theta}{m} \\\\ -\\frac{\\cos\\theta\\sin\\theta}{m} + \\frac{\\sin\\theta\\cos\\theta}{m}  \\frac{\\cos^2\\theta}{m} + \\frac{\\sin^2\\theta}{m} + \\frac{r^2}{I_\\phi} \\end{bmatrix} = \\begin{bmatrix} \\frac{1}{m}  0 \\\\ 0  \\frac{1}{m} + \\frac{r^2}{I_\\phi} \\end{bmatrix}\n$$\n$G_c$ 的这种简化的对角形式使得求解 $\\lambda$ 变得非常简单。一旦找到 $\\lambda$，就将其代回 $\\ddot{q}$ 的表达式中，得到加速度 $\\ddot{q}_{\\mathrm{proj}}$。\n\n### 4. 数值比较\n对于每个测试用例，我们使用上述两种方法计算 $\\ddot{q}_{\\mathrm{mult}}$ 和 $\\ddot{q}_{\\mathrm{proj}}$。计算差分向量 $\\Delta = \\ddot{q}_{\\mathrm{proj}} - \\ddot{q}_{\\mathrm{mult}}$。由于两种方法在数学上是等价的，任何非零的 $\\Delta$ 都归因于由不同求解策略（求解一个 6x6 系统与求解一个 2x2 系统并执行代入）产生的浮点数数值误差。我们报告线性和角向分量的最大绝对差：\n$$\n\\Delta_{\\mathrm{lin}} = \\max(|\\Delta_x|, |\\Delta_y|) \\quad \\text{和} \\quad \\Delta_{\\mathrm{ang}} = \\max(|\\Delta_\\theta|, |\\Delta_\\phi|)\n$$\n以下代码实现了此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the rolling disk problem.\n    It computes the constrained acceleration using two methods and reports their difference.\n    \"\"\"\n\n    def compute_accelerations(params):\n        \"\"\"\n        Computes accelerations for a single test case.\n        \n        Args:\n            params (tuple): A tuple containing the parameters for the test case:\n C          (m, r, I_theta, I_phi, theta, v, dq_theta, Q_vec).\n        \n        Returns:\n            tuple: A tuple containing (delta_lin, delta_ang), the linear and angular \n                   differences between the two methods, rounded to 8 decimal places.\n        \"\"\"\n        m, r, I_theta, I_phi, theta, v, dq_theta, Q_vec = params\n\n        # State vectors and constants\n        s, c = np.sin(theta), np.cos(theta)\n        \n        # Generalized velocities \\dot{q}\n        dq_x = v * c\n        dq_y = v * s\n        # The spin \\dot{\\phi} is determined by the no-slip condition v = r*\\dot{\\phi}\n        dq_phi = v / r if abs(r) > 1e-12 else 0.0\n        dq = np.array([dq_x, dq_y, dq_theta, dq_phi])\n\n        # Mass-inertia matrix M\n        M = np.diag([m, m, I_theta, I_phi])\n\n        # Constraint matrix A(q)\n        A = np.array([\n            [-s, c, 0, 0],\n            [c, s, 0, -r]\n        ])\n        \n        # RHS of the differentiated constraint equation: b = -\\dot{A}\\dot{q}\n        # As derived in the solution, this simplifies to b = [v * \\dot{\\theta}, 0]\n        b = np.array([v * dq_theta, 0.0])\n\n        # --- Method 1: Multiplier-based (Lagrange-d'Alembert) ---\n        # Solves the block system [M, -A^T; A, 0] [ddq; lambda] = [Q; b]\n        A_T = A.T\n        # Construct the 6x6 saddle-point matrix K\n        K = np.block([\n            [M, -A_T],\n            [A, np.zeros((2, 2))]\n        ])\n        # Construct the 6x1 RHS vector R\n        R = np.concatenate([Q_vec, b])\n        \n        # Solve for [ddq, lambda]\n        X = np.linalg.solve(K, R)\n        ddq_mult = X[:4]\n\n        # --- Method 2: Projector-based ---\n        # Solves for lambda from (A M^-1 A^T) lambda = b - A M^-1 Q\n        # Then computes ddq = M^-1 (Q + A^T lambda)\n        M_inv = np.diag([1/m, 1/m, 1/I_theta, 1/I_phi])\n        \n        # Gram matrix G = A M^-1 A^T\n        # Using the simplified analytical form for G\n        G_22_val = 1/m + r**2 / I_phi if abs(I_phi) > 1e-12 else 1/m\n        G = np.array([\n            [1/m, 0],\n            [0, G_22_val]\n        ])\n        \n        # Unconstrained acceleration a_0 = M^-1 Q\n        a0 = M_inv @ Q_vec\n        # RHS for the lambda equation: c_vec = b - A a_0\n        c_vec = b - A @ a0\n        \n        # Solve for lambda\n        lambda_vec = np.linalg.solve(G, c_vec)\n        \n        # Compute final acceleration ddq_proj\n        ddq_proj = a0 + M_inv @ A_T @ lambda_vec\n\n        # --- Comparison ---\n        delta = ddq_proj - ddq_mult\n        delta_lin = np.max(np.abs(delta[:2]))\n        delta_ang = np.max(np.abs(delta[2:]))\n\n        return delta_lin, delta_ang\n\n    # Define the test cases from the problem statement.\n    # Format: (m, r, I_theta, I_phi, theta, v, dq_theta, Q_vec)\n    test_cases = [\n        # Case 1: General motion with small spin torque\n        (1.5, 0.3, 0.2, 0.05, 0.5, 0.6, 0.3, np.array([0.0, 0.0, 0.0, 0.02])),\n        # Case 2: At rest with applied spin torque\n        (2.0, 0.25, 0.25, 0.08, 1.2, 0.0, 0.0, np.array([0.0, 0.0, 0.0, 0.1])),\n        # Case 3: Very light disk with force along heading\n        (0.01, 0.2, 0.05, 0.02, 0.4, 0.5, 0.0, np.array([0.3 * np.cos(0.4), 0.3 * np.sin(0.4), 0.0, 0.0])),\n        # Case 4: Small radius with spin torque and mild yaw\n        (1.0, 0.05, 0.15, 0.02, 0.9, 0.3, 0.1, np.array([0.0, 0.0, 0.0, 0.2])),\n    ]\n\n    results = []\n    for case in test_cases:\n        d_lin, d_ang = compute_accelerations(case)\n        # Append results formatted to 8 decimal places as required.\n        results.append(f\"{d_lin:.8f}\")\n        results.append(f\"{d_ang:.8f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}