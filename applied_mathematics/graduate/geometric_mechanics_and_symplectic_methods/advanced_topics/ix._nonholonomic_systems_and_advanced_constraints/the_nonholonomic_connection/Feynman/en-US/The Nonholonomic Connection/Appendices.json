{
    "hands_on_practices": [
        {
            "introduction": "The nonholonomic connection, $\\nabla^{nh}$, governs the geometry of motion for systems with velocity constraints. To understand its local structure, we can compute its Christoffel symbols, which describe how basis vectors of the allowed motion change. This first exercise  provides fundamental practice by asking you to compute a specific nonholonomic Christoffel symbol for the Chaplygin sleigh, a classic example in mechanics. By following the definition—projecting the Levi-Civita covariant derivative onto the constraint distribution—you will gain a concrete understanding of how these geometric quantities are constructed.",
            "id": "3780354",
            "problem": "Consider a planar rigid body (the “knife edge” or Chaplygin sleigh) whose configuration manifold is $Q=\\mathbb{R}^{2}\\times \\mathbb{S}^{1}$ with coordinates $q=(x,y,\\theta)$. The kinetic energy metric is\n$$\ng = m\\,dx^{2} + m\\,dy^{2} + I\\,d\\theta^{2},\n$$\nwhere $m$ and $I$ are positive constants representing mass and moment of inertia about the out-of-plane axis, respectively. The nonholonomic constraint that there is no slip transverse to the body’s longitudinal axis is given by a single linear velocity constraint\n$$\nA(q)\\,\\dot{q}=0,\\qquad A(q)=\\begin{bmatrix}-\\sin\\theta & \\cos\\theta & 0\\end{bmatrix},\n$$\nso that the allowed velocities satisfy $-\\sin\\theta\\,\\dot{x}+\\cos\\theta\\,\\dot{y}=0$. Let $D=\\ker A(q)\\subset TQ$ denote the constraint distribution.\n\nUsing only the fundamental definitions that the Levi–Civita connection $\\nabla$ of $g$ is the unique torsion-free, metric-compatible connection and that the nonholonomic connection $\\nabla^{nh}$ is obtained by $g$-orthogonally projecting $\\nabla$ onto $D$ on both slots (i.e., for vector fields $X,Y$ taking values in $D$, $\\nabla^{nh}_{X}Y = P\\big(\\nabla_{X}Y\\big)$, where $P:TQ\\to D$ is the $g$-orthogonal projector), explicitly construct $\\nabla^{nh}$ for this system.\n\nChoose the nonholonomic frame\n$$\ne_{1}(q)=\\cos\\theta\\,\\partial_{x}+\\sin\\theta\\,\\partial_{y},\\qquad e_{2}(q)=\\partial_{\\theta},\n$$\nwhich spans $D$. Define the nonholonomic Christoffel symbols $\\Gamma^{c}_{ab}(q)$ by\n$$\n\\nabla^{nh}_{e_{a}}e_{b}=\\Gamma^{c}_{ab}\\,e_{c},\\quad a,b,c\\in\\{1,2\\}.\n$$\nCompute the single component $\\Gamma^{1}_{22}(q)$ as an explicit expression in $q$. Your final answer must be a single closed-form analytic expression with no units.",
            "solution": "The user wants to compute the nonholonomic Christoffel symbol $\\Gamma^{1}_{22}(q)$ for a Chaplygin sleigh. The logical path to the solution is to follow the definitions provided in the problem statement.\n\nThe quantity to be computed, $\\Gamma^{1}_{22}$, is defined as the coefficient of $e_{1}$ in the expansion of $\\nabla^{nh}_{e_{2}}e_{2}$ in the basis $\\{e_{1}, e_{2}\\}$:\n$$\n\\nabla^{nh}_{e_{2}}e_{2} = \\Gamma^{1}_{22}\\,e_{1} + \\Gamma^{2}_{22}\\,e_{2}\n$$\nThe nonholonomic connection $\\nabla^{nh}$ is defined by the $g$-orthogonal projection of the Levi-Civita connection $\\nabla$ of the metric $g$ onto the constraint distribution $D$. For vector fields $X, Y$ that span $D$, the definition is:\n$$\n\\nabla^{nh}_{X}Y = P(\\nabla_{X}Y)\n$$\nwhere $P: TQ \\to D$ is the $g$-orthogonal projector.\n\nApplying this definition to the specific case $X=e_{2}$ and $Y=e_{2}$, we get:\n$$\n\\nabla^{nh}_{e_{2}}e_{2} = P(\\nabla_{e_{2}}e_{2})\n$$\nThe problem is thus reduced to two main steps:\n1. Compute the Levi-Civita covariant derivative $\\nabla_{e_{2}}e_{2}$.\n2. Project the resulting vector field onto the distribution $D$.\n\n**Step 1: Compute the Levi-Civita covariant derivative $\\nabla_{e_{2}}e_{2}$.**\n\nThe Levi-Civita connection $\\nabla$ is determined by the metric $g$. The metric is given in the coordinate basis $\\{\\partial_x, \\partial_y, \\partial_\\theta\\}$ as:\n$$\ng = m\\,dx^{2} + m\\,dy^{2} + I\\,d\\theta^{2}\n$$\nThis corresponds to a metric tensor matrix $G$ with components $g_{ij} = g(\\partial_i, \\partial_j)$ that is diagonal and constant:\n$$\nG = \\begin{pmatrix} m & 0 & 0 \\\\ 0 & m & 0 \\\\ 0 & 0 & I \\end{pmatrix}\n$$\nwhere $m$ and $I$ are positive constants.\n\nThe Christoffel symbols of the first kind for the Levi-Civita connection are given by:\n$$\n\\Gamma_{ijk} = \\frac{1}{2}\\left(\\frac{\\partial g_{jk}}{\\partial q^i} + \\frac{\\partial g_{ik}}{\\partial q^j} - \\frac{\\partial g_{ij}}{\\partial q^k}\\right)\n$$\nThe Christoffel symbols of the second kind are $\\Gamma^k_{ij} = g^{kl}\\Gamma_{lij}$. Since all metric components $g_{ij}$ are constants, all their partial derivatives with respect to the coordinates $(x, y, \\theta)$ are zero.\n$$\n\\frac{\\partial g_{ij}}{\\partial q^k} = 0 \\quad \\text{for all } i,j,k \\in \\{x,y,\\theta\\}\n$$\nConsequently, all Christoffel symbols of the Levi-Civita connection are zero in this coordinate system: $\\Gamma^k_{ij} = 0$.\n\nThe covariant derivative of a coordinate basis vector field along another is given by $\\nabla_{\\partial_i}\\partial_j = \\Gamma^k_{ij}\\partial_k$. Since all $\\Gamma^k_{ij}$ are zero, we have $\\nabla_{\\partial_i}\\partial_j = 0$. This means the connection is flat in the $(x, y, \\theta)$ coordinates.\n\nThe problem provides the frame vector $e_{2}$ as a coordinate basis vector:\n$$\ne_{2}(q) = \\partial_{\\theta}\n$$\nWe can now compute $\\nabla_{e_{2}}e_{2}$:\n$$\n\\nabla_{e_{2}}e_{2} = \\nabla_{\\partial_{\\theta}}\\partial_{\\theta}\n$$\nUsing the formula $\\nabla_{\\partial_{\\theta}}\\partial_{\\theta} = \\Gamma^k_{\\theta\\theta}\\partial_k$ and the fact that all $\\Gamma^k_{\\theta\\theta}=0$, we find:\n$$\n\\nabla_{e_{2}}e_{2} = 0\n$$\nThe resulting vector field is the zero vector field.\n\n**Step 2: Project $\\nabla_{e_{2}}e_{2}$ onto the distribution $D$.**\n\nThe nonholonomic connection is obtained by projecting this result onto the distribution $D$ using the projector $P$. The projector $P$ is a linear map. Its action on the zero vector is to produce the zero vector:\n$$\nP(0) = 0\n$$\nTherefore, we have:\n$$\n\\nabla^{nh}_{e_{2}}e_{2} = P(\\nabla_{e_{2}}e_{2}) = P(0) = 0\n$$\n\n**Step 3: Determine the coefficient $\\Gamma^{1}_{22}$.**\n\nWe equate the result from Step $2$ with the definition of the nonholonomic Christoffel symbols:\n$$\n\\Gamma^{1}_{22}\\,e_{1} + \\Gamma^{2}_{22}\\,e_{2} = 0\n$$\nThe frame vectors $e_{1} = \\cos\\theta\\,\\partial_{x}+\\sin\\theta\\,\\partial_{y}$ and $e_{2} = \\partial_{\\theta}$ are linearly independent at every point $q \\in Q$. For their linear combination to be the zero vector, the coefficients must be zero.\n$$\n\\Gamma^{1}_{22} = 0 \\quad \\text{and} \\quad \\Gamma^{2}_{22} = 0\n$$\nThe problem asks for the component $\\Gamma^{1}_{22}(q)$. The result is $0$. This value is constant and thus independent of $q$.",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "The natural paths of motion in a constrained system, in the absence of external forces, are the geodesics of the nonholonomic connection. These paths, also known as autoparallels, can be found using the Lagrange-d'Alembert variational principle. This exercise  challenges you to derive and solve the equations for such a nonholonomic geodesic for the canonical Heisenberg distribution. This practice is invaluable for connecting the abstract geometric framework to the tangible equations of motion and for exploring the intriguing relationship between nonholonomic and sub-Riemannian geodesics.",
            "id": "3780406",
            "problem": "Let $\\mathbb{R}^{3}$ carry the Euclidean metric $g$ in Cartesian coordinates $(x,y,z)$, and consider the Heisenberg-type nonintegrable distribution $\\mathcal{D}=\\ker \\alpha$ defined by the one-form $\\alpha = dz - \\tfrac{1}{2}\\left(x\\,dy - y\\,dx\\right)$. The orthogonal complement is determined by the Euclidean musical isomorphism $g^{\\sharp}$, and the nonholonomic connection is defined by projecting the Levi-Civita connection $\\nabla$ of $g$ onto $\\mathcal{D}$ by the orthogonal projector $P:\\,T\\mathbb{R}^{3}\\to \\mathcal{D}$. A nonholonomic geodesic is a curve $\\gamma(t)$ with $\\dot{\\gamma}(t)\\in \\mathcal{D}$ for all $t$ and $P\\left(\\nabla_{\\dot{\\gamma}}\\dot{\\gamma}\\right)=0$.\n\nStarting from first principles of the d’Alembert-Lagrange nonholonomic variational principle for the kinetic Lagrangian $L=\\tfrac{1}{2}\\|\\dot{\\gamma}\\|^{2}$ under the velocity constraint $\\alpha(\\dot{\\gamma})=0$, derive the governing equations of motion for the nonholonomic geodesics and solve them for the initial-value problem\n$$\n\\gamma(0)=(0,0,0),\\qquad \\dot{\\gamma}(0)=(v_{1},\\,v_{2},\\,0),\n$$\nwhere $v_{1}$ and $v_{2}$ are real constants. Then, using the fundamental Hamiltonian framework for sub-Riemannian geometry and the Pontryagin Maximum Principle (PMP), compare the resulting nonholonomic geodesics with the normal sub-Riemannian geodesics for the Heisenberg structure obtained by declaring the vector fields $X_{1}=\\partial_{x}-\\tfrac{y}{2}\\partial_{z}$ and $X_{2}=\\partial_{y}+\\tfrac{x}{2}\\partial_{z}$ orthonormal on $\\mathcal{D}$.\n\nProvide the explicit parametric form of the nonholonomic geodesic $\\gamma_{\\mathrm{nh}}(t)$ for the given initial conditions. Express your final answer as a single row matrix containing the three component functions $(x(t),\\,y(t),\\,z(t))$. No numerical approximation is required.",
            "solution": "The problem is first validated to ensure it is well-posed, scientifically grounded, and internally consistent.\n\n### Step 1: Extract Givens\n-   **Configuration Space**: $\\mathbb{R}^3$ with Cartesian coordinates $(x,y,z)$.\n-   **Metric**: Standard Euclidean metric $g$.\n-   **Lagrangian**: Kinetic energy Lagrangian $L = \\frac{1}{2}\\|\\dot{\\gamma}\\|^2 = \\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2 + \\dot{z}^2)$.\n-   **Nonholonomic Constraint**: The velocity vector $\\dot{\\gamma}=(\\dot{x}, \\dot{y}, \\dot{z})$ must lie in the distribution $\\mathcal{D} = \\ker \\alpha$, where $\\alpha = dz - \\frac{1}{2}(x\\,dy - y\\,dx)$. This constraint is given by the Pfaffian equation $\\alpha(\\dot{\\gamma}) = 0$, which translates to $\\dot{z} - \\frac{1}{2}(x\\dot{y} - y\\dot{x}) = 0$.\n-   **Initial Conditions**: $\\gamma(0) = (x(0), y(0), z(0)) = (0,0,0)$ and $\\dot{\\gamma}(0) = (\\dot{x}(0), \\dot{y}(0), \\dot{z}(0)) = (v_1, v_2, 0)$, where $v_1, v_2 \\in \\mathbb{R}$ are constants.\n-   **Task**: Derive and solve the equations for the nonholonomic geodesic subjected to the given initial conditions using the d'Alembert-Lagrange principle. Furthermore, compare this result with the normal sub-Riemannian geodesics.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientific Grounding**: The problem is a standard exercise in nonholonomic and sub-Riemannian geometry, which are well-established branches of differential geometry and geometric mechanics. The Heisenberg distribution is a canonical example. The problem is scientifically sound.\n-   **Well-Posedness and Consistency**: The problem provides a Lagrangian, a valid nonholonomic constraint, and a full set of initial conditions. The initial velocity $\\dot{\\gamma}(0)=(v_1, v_2, 0)$ at the point $\\gamma(0)=(0,0,0)$ must satisfy the constraint: $\\dot{z}(0) - \\frac{1}{2}(x(0)\\dot{y}(0) - y(0)\\dot{x}(0)) = 0 - \\frac{1}{2}(0 \\cdot v_2 - 0 \\cdot v_1) = 0$. The initial condition is consistent with the constraint. The problem is well-posed.\n-   **Objectivity**: The problem is stated in precise mathematical language, free from any subjectivity or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A full solution will be provided.\n\n### Derivation of the Equations of Motion\n\nWe use the d'Alembert-Lagrange nonholonomic variational principle. The equations of motion for a system with Lagrangian $L(q, \\dot{q})$ subject to a linear velocity constraint $C(q, \\dot{q}) = \\sum_i A_i(q) \\dot{q}^i = 0$ are given by:\n$$\n\\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{q}^i}\\right) - \\frac{\\partial L}{\\partial q^i} = \\lambda A_i(q)\n$$\nwhere $\\lambda$ is a Lagrange multiplier determined by the persistence of the constraint.\n\nThe Lagrangian is $L = \\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2 + \\dot{z}^2)$. The coordinates are $q = (x, y, z)$. The partial derivatives of $L$ are:\n$$\n\\frac{\\partial L}{\\partial \\dot{x}} = \\dot{x}, \\quad \\frac{\\partial L}{\\partial \\dot{y}} = \\dot{y}, \\quad \\frac{\\partial L}{\\partial \\dot{z}} = \\dot{z}\n$$\n$$\n\\frac{\\partial L}{\\partial x} = 0, \\quad \\frac{\\partial L}{\\partial y} = 0, \\quad \\frac{\\partial L}{\\partial z} = 0\n$$\nThe constraint equation $\\dot{z} - \\frac{1}{2}(x\\dot{y} - y\\dot{x}) = 0$ can be written as $A_x \\dot{x} + A_y \\dot{y} + A_z \\dot{z} = 0$, with:\n$$\nA_x = \\frac{y}{2}, \\quad A_y = -\\frac{x}{2}, \\quad A_z = 1\n$$\nThe Lagrange-d'Alembert equations for the coordinates $(x,y,z)$ are:\n1.  $\\ddot{x} = \\lambda A_x = \\lambda \\frac{y}{2}$\n2.  $\\ddot{y} = \\lambda A_y = -\\lambda \\frac{x}{2}$\n3.  $\\ddot{z} = \\lambda A_z = \\lambda$\n\nTo find the Lagrange multiplier $\\lambda$, we differentiate the constraint equation with respect to time $t$:\n$$\n\\frac{d}{dt}\\left(\\dot{z} - \\frac{1}{2}(x\\dot{y} - y\\dot{x})\\right) = 0\n$$\n$$\n\\ddot{z} - \\frac{1}{2}(\\dot{x}\\dot{y} + x\\ddot{y} - \\dot{y}\\dot{x} - y\\ddot{x}) = 0\n$$\n$$\n\\ddot{z} - \\frac{1}{2}(x\\ddot{y} - y\\ddot{x}) = 0\n$$\nNow, substitute the expressions for $\\ddot{x}$, $\\ddot{y}$, and $\\ddot{z}$ from the equations of motion into this differentiated constraint:\n$$\n\\lambda - \\frac{1}{2}\\left(x\\left(-\\lambda \\frac{x}{2}\\right) - y\\left(\\lambda \\frac{y}{2}\\right)\\right) = 0\n$$\n$$\n\\lambda - \\frac{1}{2}\\left(-\\frac{\\lambda x^2}{2} - \\frac{\\lambda y^2}{2}\\right) = 0\n$$\n$$\n\\lambda + \\frac{\\lambda}{4}(x^2 + y^2) = 0\n$$\n$$\n\\lambda \\left(1 + \\frac{x^2 + y^2}{4}\\right) = 0\n$$\nSince the term $1 + \\frac{1}{4}(x^2 + y^2)$ is strictly positive for all real $x$ and $y$, the only possibility is that the multiplier $\\lambda$ is identically zero, i.e., $\\lambda(t) = 0$ for all $t$.\n\nThis result indicates that for this specific nonholonomic system, the constraint force is zero. The equations of motion simplify to:\n$$\n\\ddot{x} = 0, \\quad \\ddot{y} = 0, \\quad \\ddot{z} = 0\n$$\nThese equations describe motion in a straight line at a constant velocity.\n\n### Solving the Initial Value Problem\n\nWe integrate the equations of motion twice. A single integration yields:\n$$\n\\dot{x}(t) = c_1, \\quad \\dot{y}(t) = c_2, \\quad \\dot{z}(t) = c_3\n$$\nApplying the initial velocity condition $\\dot{\\gamma}(0)=(v_1, v_2, 0)$, we find the constants of integration:\n$$\nc_1 = v_1, \\quad c_2 = v_2, \\quad c_3 = 0\n$$\nSo, the velocity vector is constant: $\\dot{\\gamma}(t) = (v_1, v_2, 0)$.\n\nIntegrating a second time yields the trajectory:\n$$\nx(t) = v_1 t + d_1, \\quad y(t) = v_2 t + d_2, \\quad z(t) = 0 \\cdot t + d_3\n$$\nApplying the initial position condition $\\gamma(0)=(0,0,0)$:\n$$\nd_1 = 0, \\quad d_2 = 0, \\quad d_3 = 0\n$$\nThus, the explicit parametric form of the nonholonomic geodesic is:\n$$\n\\gamma_{\\mathrm{nh}}(t) = (v_1 t, v_2 t, 0)\n$$\nWe must verify that this solution satisfies the nonholonomic constraint for all $t$:\n$$\n\\dot{z}(t) - \\frac{1}{2}\\left(x(t)\\dot{y}(t) - y(t)\\dot{x}(t)\\right) = 0 - \\frac{1}{2}\\left((v_1 t)(v_2) - (v_2 t)(v_1)\\right) = -\\frac{1}{2}(v_1 v_2 t - v_2 v_1 t) = 0\n$$\nThe constraint is satisfied for all time.\n\n### Comparison with Sub-Riemannian Geodesics\n\nThe problem also asks for a comparison with the normal sub-Riemannian geodesics obtained from the Pontryagin Maximum Principle (PMP) for the same distribution. The sub-Riemannian geodesic equations for the Heisenberg group are known to be:\n$$\n\\ddot{x} = -p_z \\dot{y}, \\quad \\ddot{y} = p_z \\dot{x}\n$$\nwhere $p_z$ is the constant momentum conjugate to the $z$ coordinate. These equations describe circular motion in the $(x,y)$-plane (for $p_z \\neq 0$), leading to helical paths in $\\mathbb{R}^3$. These are generally different from the straight-line nonholonomic geodesic found above.\n\nHowever, there is a special case. If the initial costate vector for the PMP has $p_z(0)=0$, then the sub-Riemannian geodesic equations become $\\ddot{x}=0$ and $\\ddot{y}=0$. This also implies $\\ddot{z}=0$. This is precisely the system we solved for the nonholonomic geodesic. Therefore, the nonholonomic geodesic $\\gamma_{\\mathrm{nh}}(t)$ for this specific problem corresponds to the sub-Riemannian geodesic for the special case where the conjugate momentum $p_z$ is zero.\n\nThe solution to the specified initial value problem for the nonholonomic geodesic is the straight-line path.\n\nThe final answer is the set of component functions for $\\gamma_{\\mathrm{nh}}(t)$.\n$$\nx(t) = v_1 t\n$$\n$$\ny(t) = v_2 t\n$$\n$$\nz(t) = 0\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nv_1 t & v_2 t & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While analytical solutions offer deep insight, most nonholonomic systems are too complex to be solved by hand, making numerical simulation an essential tool. The projector method is a powerful algorithm that directly implements the geometry of the nonholonomic connection to time-step the dynamics. In this practice , you will develop a simulation for the classic rolling disk, translating the abstract definition of the mass-metric orthogonal projection into a concrete numerical integrator. This exercise provides critical skills in computational mechanics and reinforces the connection between the continuous theory and its discrete approximation.",
            "id": "3780359",
            "problem": "Consider the classical rolling disk with configuration manifold given by the Special Euclidean group in two dimensions (SE(2)) times the circle, with generalized coordinates $(x,y,\\theta,\\phi)$, where $(x,y)$ are the planar coordinates of the point of contact, $\\theta$ is the heading angle of the disk in radians, and $\\phi$ is the roll angle of the disk in radians. The disk of radius $r$ and mass $m$ has a kinetic energy Lagrangian that induces a Riemannian metric on the configuration manifold, with principal moments of inertia $I_\\theta$ about the vertical axis (associated with $\\theta$) and $I_\\phi$ about the disk’s spin axis (associated with $\\phi$). The nonholonomic rolling-without-slipping constraint enforces the kinematic relations $x$-velocity equals $r$ times the roll rate projected onto the heading direction and $y$-velocity equals $r$ times the roll rate projected onto the orthogonal direction. The constraint distribution is a subbundle of the tangent bundle defined by these linear velocity relations at each configuration.\n\nStarting from first principles of kinetic energy and the rolling constraint, the nonholonomic connection $\\nabla^{nh}$ is the affine connection obtained by projecting the Levi–Civita connection associated with the kinetic energy metric onto the constraint distribution. For the benchmark rolling disk with a constant mass metric and the stated constraints, $\\nabla^{nh}$-geodesics correspond to constrained motions with no external forces whose accelerations are the orthogonal projection (with respect to the kinetic energy metric) of the unconstrained accelerations onto the constraint distribution.\n\nImplement the projector method for time-stepping the constrained dynamics of the rolling disk viewed as $\\nabla^{nh}$ geodesic flow. At each time step, advance the configuration using the current velocity, and then apply the mass-metric orthogonal projector onto the instantaneous constraint distribution to update the velocity so that it satisfies the rolling constraints at the new configuration. Use a first-order explicit scheme in time. Derive and implement the exact solution for the benchmark case where the heading rate and roll rate are constants, and the translational velocities are constrained by the rolling relations. Verify numerically that the discrete $\\nabla^{nh}$ geodesics converge to the exact solution as the time step $\\Delta t$ decreases by reporting the errors at a fixed final time $T$.\n\nFundamental base:\n- Kinetic energy defines a Riemannian metric on the configuration manifold, with generalized velocities $(\\dot{x},\\dot{y},\\dot{\\theta},\\dot{\\phi})$ and positive constants $m$, $I_\\theta$, $I_\\phi$.\n- The rolling constraint is linear in velocities and depends on the configuration angle $\\theta$.\n- The mass-metric orthogonal projection of a velocity onto the constraint distribution is defined by minimizing the kinetic energy norm of the correction subject to the linear constraints.\n\nYour program must:\n- Treat the disk parameters $m$, $r$, $I_\\theta$, $I_\\phi$ as constants with physically plausible values.\n- Use initial conditions $(x_0,y_0,\\theta_0,\\phi_0)$ in meters and radians, and constant rates $(\\dot{\\theta}_0,\\dot{\\phi}_0)$ in radians per second.\n- Simulate the discrete $\\nabla^{nh}$ geodesic flow from $t=0$ to $t=T$ seconds using the projector method with time steps $\\Delta t$ specified in the test suite below.\n- Compute the exact solution at $t=T$ using the constant $(\\dot{\\theta}_0,\\dot{\\phi}_0)$ case consistent with the rolling constraints.\n- Report two errors for each test case: the Euclidean norm of the position error in meters, $\\sqrt{(\\Delta x)^2 + (\\Delta y)^2}$, and the Euclidean norm of the angle error in radians, $\\sqrt{(\\Delta \\theta)^2 + (\\Delta \\phi)^2}$, at time $T$.\n\nUnits:\n- Positions must be treated in meters.\n- Angles must be treated in radians.\n- Time must be treated in seconds.\n\nTest suite:\n- Use disk parameters $m=1.0$ kilograms, $r=0.5$ meters, $I_\\theta=0.2$ kilogram meter squared, $I_\\phi=0.1$ kilogram meter squared.\n- Use initial conditions $(x_0,y_0,\\theta_0,\\phi_0)=(0.0,0.0,0.3,0.0)$.\n- Use constant rates $(\\dot{\\theta}_0,\\dot{\\phi}_0)=(0.4,1.0)$ radians per second.\n- Use final time $T=1.0$ seconds.\n- Evaluate the method for the following values of $\\Delta t$ in seconds: $0.5$ (boundary case with few steps), $0.3$ (non-divisor of $T$), $0.2$ (moderate), and $0.05$ (small).\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain eight floating-point numbers in the following order: $[e_{pos,0.5},e_{ang,0.5},e_{pos,0.3},e_{ang,0.3},e_{pos,0.2},e_{ang,0.2},e_{pos,0.05},e_{ang,0.05}]$, where $e_{pos,\\Delta t}$ is the position error in meters and $e_{ang,\\Delta t}$ is the angle error in radians at time $T$ for the given $\\Delta t$.",
            "solution": "The user wants to analyze the motion of a rolling disk using the framework of nonholonomic mechanics. This involves deriving the equations of motion, defining a numerical integration scheme based on projection, and comparing the numerical results to a known exact solution.\n\n### 1. Problem Validation\nThe provided problem statement is a standard exercise in geometric mechanics, specifically concerning the nonholonomic dynamics of a rolling disk.\n\n- **Givens**:\n    - **Configuration Manifold**: $SE(2) \\times S^1$ with generalized coordinates $q = (x, y, \\theta, \\phi)$.\n    - **Coordinates**: $(x,y)$ are the contact point's planar coordinates, $\\theta$ is the heading angle, $\\phi$ is the roll angle.\n    - **Parameters**: Mass $m$, radius $r$, principal moments of inertia $I_\\theta$ and $I_\\phi$.\n    - **Kinetic Energy**: $T(\\dot{q}) = \\frac{1}{2} m (\\dot{x}^2 + \\dot{y}^2) + \\frac{1}{2} I_\\theta \\dot{\\theta}^2 + \\frac{1}{2} I_\\phi \\dot{\\phi}^2$. This defines the Riemannian metric (mass matrix) $M = \\text{diag}(m, m, I_\\theta, I_\\phi)$.\n    - **Nonholonomic Constraints**: The rolling-without-slipping conditions are given as:\n        - $\\dot{x} = r \\dot{\\phi} \\cos\\theta$\n        - $\\dot{y} = r \\dot{\\phi} \\sin\\theta$\n    - **Numerical Method**: A first-order explicit projector method.\n    - **Task**: Implement the projector method, derive and implement the exact solution for constant angular rates, and compute the error between the numerical and exact solutions at time $T$ for a given set of parameters, initial conditions, and time steps $\\Delta t$.\n    - **Parameters**: $m=1.0$, $r=0.5$, $I_\\theta=0.2$, $I_\\phi=0.1$.\n    - **Initial Conditions**: $(x_0,y_0,\\theta_0,\\phi_0)=(0.0,0.0,0.3,0.0)$, $(\\dot{\\theta}_0,\\dot{\\phi}_0)=(0.4,1.0)$.\n    - **Time**: $T=1.0$, $\\Delta t \\in \\{0.5, 0.3, 0.2, 0.05\\}$.\n\n- **Validation**:\n    - The problem is **scientifically grounded** in classical and geometric mechanics.\n    - It is **well-posed**, providing all necessary information to derive a unique solution.\n    - It is **objective** and free from ambiguity.\n    - The problem does not violate any of the invalidity criteria. The setup is standard, the requested task is clear, and the comparison is verifiable.\n\n- **Verdict**: The problem is **valid**.\n\n### 2. Derivation of the Exact Solution\nThe motion of the system without external forces is described by the $\\nabla^{nh}$-geodesics, which are solutions to the Lagrange-d'Alembert equations. The Lagrangian is the kinetic energy, $L(q, \\dot{q}) = T(\\dot{q})$. The constraints are linear in velocity and can be written as $A(q)\\dot{q}=0$, where\n$$\nA(q) = \\begin{pmatrix}\n1 & 0 & 0 & -r \\cos\\theta \\\\\n0 & 1 & 0 & -r \\sin\\theta\n\\end{pmatrix}\n$$\nThe Lagrange-d'Alembert equations are $\\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{q}}\\right) - \\frac{\\partial L}{\\partial q} = A(q)^T \\lambda$, where $\\lambda = (\\lambda_1, \\lambda_2)^T$ are Lagrange multipliers.\n- For $q^3=\\theta$: $\\frac{d}{dt}(I_\\theta\\dot{\\theta}) - 0 = 0 \\implies I_\\theta\\ddot{\\theta} = 0$. Thus, $\\dot{\\theta}(t)$ is a constant, $\\dot{\\theta}(t) = \\dot{\\theta}_0$.\n- For $q^4=\\phi$: $\\frac{d}{dt}(I_\\phi\\dot{\\phi}) - 0 = -r\\cos\\theta \\cdot \\lambda_1 - r\\sin\\theta \\cdot \\lambda_2$.\n- For $q^1=x$ and $q^2=y$: $m\\ddot{x} = \\lambda_1$ and $m\\ddot{y} = \\lambda_2$.\nSubstituting $\\lambda_1, \\lambda_2$ into the $\\phi$ equation gives $I_\\phi\\ddot{\\phi} = -r(m\\ddot{x}\\cos\\theta + m\\ddot{y}\\sin\\theta)$.\nTo find $\\ddot{x}$ and $\\ddot{y}$, we differentiate the constraint equations:\n$\\ddot{x} = r\\ddot{\\phi}\\cos\\theta - r\\dot{\\phi}\\dot{\\theta}\\sin\\theta$\n$\\ddot{y} = r\\ddot{\\phi}\\sin\\theta + r\\dot{\\phi}\\dot{\\theta}\\cos\\theta$\nSubstituting these into the equation for $\\ddot{\\phi}$:\n$I_\\phi\\ddot{\\phi} = -mr( (r\\ddot{\\phi}\\cos\\theta - r\\dot{\\phi}\\dot{\\theta}\\sin\\theta)\\cos\\theta + (r\\ddot{\\phi}\\sin\\theta + r\\dot{\\phi}\\dot{\\theta}\\cos\\theta)\\sin\\theta )$\n$I_\\phi\\ddot{\\phi} = -mr( r\\ddot{\\phi}(\\cos^2\\theta + \\sin^2\\theta) ) = -mr^2\\ddot{\\phi}$\n$(I_\\phi + mr^2)\\ddot{\\phi} = 0$. Since $I_\\phi, m, r > 0$, we must have $\\ddot{\\phi}=0$. Thus, $\\dot{\\phi}(t)$ is also a constant, $\\dot{\\phi}(t) = \\dot{\\phi}_0$.\n\nThe benchmark case where angular rates are constant is therefore the exact geodesic solution. We can integrate these to find the configuration at time $T$.\n$\\theta(T) = \\theta_0 + \\dot{\\theta}_0 T$\n$\\phi(T) = \\phi_0 + \\dot{\\phi}_0 T$\n$x(T) = x_0 + \\int_0^T r\\dot{\\phi}_0 \\cos(\\theta_0 + \\dot{\\theta}_0 t) dt = x_0 + r\\frac{\\dot{\\phi}_0}{\\dot{\\theta}_0}[\\sin(\\theta_0 + \\dot{\\theta}_0 T) - \\sin(\\theta_0)]$ (for $\\dot{\\theta}_0 \\neq 0$)\n$y(T) = y_0 + \\int_0^T r\\dot{\\phi}_0 \\sin(\\theta_0 + \\dot{\\theta}_0 t) dt = y_0 + r\\frac{\\dot{\\phi}_0}{\\dot{\\theta}_0}[\\cos(\\theta_0) - \\cos(\\theta_0 + \\dot{\\theta}_0 T)]$ (for $\\dot{\\theta}_0 \\neq 0$)\n\n### 3. Derivation of the Projector Method\nThe numerical scheme consists of an unconstrained update followed by a projection.\n1.  **Drift Step**: An explicit Euler step is taken.\n    $q_{k+1}^* = q_k + \\Delta t \\cdot \\dot{q}_k$\n    $\\dot{q}_{k+1}^* = \\dot{q}_k$ (since there are no external forces, unconstrained acceleration is zero).\n2.  **Projection Step**: The velocity $\\dot{q}_{k+1}^*$ is projected orthogonally with respect to the mass metric $M$ onto the constraint distribution $\\mathcal{D}_{q_{k+1}^*}$. This means finding $\\dot{q}_{k+1}$ that minimizes $||\\dot{q}_{k+1} - \\dot{q}_{k+1}^*||_M^2$ subject to $A(q_{k+1}^*)\\dot{q}_{k+1} = 0$.\nThe solution to this constrained minimization is given by an orthogonal projector $P(q)$: $\\dot{q}_{k+1} = P(q_{k+1}^*)\\dot{q}_{k+1}^*$.\nThe projector is $P(q) = I - M^{-1}A(q)^T(A(q)M^{-1}A(q)^T)^{-1}A(q)$.\nThe update rule for the velocity is $\\dot{q}_{k+1} = \\dot{q}_{k+1}^* - M^{-1}A(q_{k+1}^*)^T\\lambda$, where the Lagrange multipliers $\\lambda$ are found by solving:\n$(A(q_{k+1}^*) M^{-1} A(q_{k+1}^*)^T) \\lambda = A(q_{k+1}^*) \\dot{q}_{k+1}^*$.\nLet $q' = q_{k+1}^*$ and $\\dot{q}' = \\dot{q}_{k+1}^*$. The matrix $C(q') = A(q') M^{-1} A(q')^T$ is:\n$C(\\theta') = \\begin{pmatrix} 1/m + (r^2 \\cos^2\\theta')/I_\\phi & (r^2 \\cos\\theta' \\sin\\theta')/I_\\phi \\\\ (r^2 \\cos\\theta' \\sin\\theta')/I_\\phi & 1/m + (r^2 \\sin^2\\theta')/I_\\phi \\end{pmatrix}$\nIts determinant is constant: $\\det(C) = \\frac{1}{m^2} + \\frac{r^2}{m I_\\phi}$.\nThe constraint violation is $\\epsilon = A(q')\\dot{q}' = \\begin{pmatrix} \\dot{x}' - r\\dot{\\phi}'\\cos\\theta' \\\\ \\dot{y}' - r\\dot{\\phi}'\\sin\\theta' \\end{pmatrix}$.\nWe solve $C(\\theta')\\lambda=\\epsilon$ for $\\lambda=(\\lambda_1, \\lambda_2)^T$. The new velocity $\\dot{q}_{k+1}$ is then calculated as:\n$\\dot{x}_{k+1} = \\dot{x}' - \\lambda_1/m$\n$\\dot{y}_{k+1} = \\dot{y}' - \\lambda_2/m$\n$\\dot{\\theta}_{k+1} = \\dot{\\theta}'$\n$\\dot{\\phi}_{k+1} = \\dot{\\phi}' + (r/I_\\phi)(\\lambda_1\\cos\\theta' + \\lambda_2\\sin\\theta')$\nThe configuration is updated to $q_{k+1} = q_{k+1}^*$. This process is repeated until time $T$ is reached.\n\n### 4. Algorithm Outline\nThe final program implements the following logic:\n1.  Define all physical parameters, initial conditions, and test cases.\n2.  Calculate the exact final state $(x(T), y(T), \\theta(T), \\phi(T))$ using the analytical formulas derived above.\n3.  For each time step $\\Delta t$ in the test suite:\n    a. Initialize the numerical state $q_{num}$ and $\\dot{q}_{num}$ at $t=0$. The initial velocity $(\\dot{x}_0, \\dot{y}_0)$ is determined by the constraints.\n    b. Loop from $t=0$ to $T$. In each iteration, the step size $h$ is $\\min(\\Delta t, T-t)$ to ensure the final step lands exactly on $T$.\n    c. Perform the drift-projection step:\n        i. Update position: $q^* = q_{num} + h \\cdot \\dot{q}_{num}$.\n        ii. Calculate the constraint violation $\\epsilon$ using $\\dot{q}_{num}$ and the new angle $\\theta^*_k$.\n        iii. Form and invert the $2 \\times 2$ matrix $C(\\theta^*_k)$.\n        iv. Solve for the Lagrange multipliers $\\lambda$.\n        v. Compute the velocity correction and find the new velocity $\\dot{q}_{num, k+1}$.\n        vi. Update state: $q_{num} = q^*$.\n    d. After the loop, compute the position and angle errors by comparing the final numerical state $q_{num}$ with the exact state $q_{exact}$.\n4.  Collect and print the eight error values in the specified format.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the rolling disk problem by simulating its motion\n    using a projector method and comparing it to the exact solution.\n    \"\"\"\n\n    # Disk parameters\n    m = 1.0  # kg\n    r = 0.5  # m\n    I_theta = 0.2  # kg.m^2\n    I_phi = 0.1  # kg.m^2\n\n    # Initial conditions\n    q0 = np.array([0.0, 0.0, 0.3, 0.0])  # (x, y, theta, phi) in m, rad\n    d_theta0 = 0.4  # rad/s\n    d_phi0 = 1.0  # rad/s\n\n    # Simulation time\n    T = 1.0  # s\n\n    # Test suite for time steps\n    delta_t_values = [0.5, 0.3, 0.2, 0.05]\n\n    # Calculate exact solution at T\n    x0, y0, theta0, phi0 = q0\n    theta_T_exact = theta0 + d_theta0 * T\n    phi_T_exact = phi0 + d_phi0 * T\n\n    if d_theta0 != 0:\n        x_T_exact = x0 + r * d_phi0 / d_theta0 * (np.sin(d_theta0 * T + theta0) - np.sin(theta0))\n        y_T_exact = y0 + r * d_phi0 / d_theta0 * (np.cos(theta0) - np.cos(d_theta0 * T + theta0))\n    else: # Special case for straight line motion\n        x_T_exact = x0 + r * d_phi0 * T * np.cos(theta0)\n        y_T_exact = y0 + r * d_phi0 * T * np.sin(theta0)\n        \n    q_exact_T = np.array([x_T_exact, y_T_exact, theta_T_exact, phi_T_exact])\n\n    \n    def run_simulation(dt_val):\n        \"\"\"\n        Runs the numerical simulation for a given time step delta_t.\n        \"\"\"\n        # Initial state\n        q = np.copy(q0)\n        \n        # Calculate initial velocity from constraints\n        d_x0 = r * d_phi0 * np.cos(q0[2])\n        d_y0 = r * d_phi0 * np.sin(q0[2])\n        q_dot = np.array([d_x0, d_y0, d_theta0, d_phi0])\n        \n        t = 0.0\n        \n        # Pre-calculate constant term for projector\n        det_C_const = 1.0 / (1.0 / (m**2) + r**2 / (m * I_phi))\n\n        while t  T:\n            # Adjust final time step to land exactly on T\n            h = min(dt_val, T - t)\n            \n            # --- 1. Drift Step (Unconstrained update) ---\n            q_star = q + h * q_dot\n            q_dot_star = q_dot  # In the absence of forces, velocity is constant\n            \n            # --- 2. Projection Step ---\n            theta_new = q_star[2]\n            c_theta = np.cos(theta_new)\n            s_theta = np.sin(theta_new)\n\n            # Constraint violation term epsilon = A(q*)q_dot*\n            epsilon_1 = q_dot_star[0] - r * q_dot_star[3] * c_theta\n            epsilon_2 = q_dot_star[1] - r * q_dot_star[3] * s_theta\n\n            # C_matrix = A * M_inv * A_T\n            C11 = 1.0/m + (r**2 / I_phi) * c_theta**2\n            C12 = (r**2 / I_phi) * c_theta * s_theta\n            C22 = 1.0/m + (r**2 / I_phi) * s_theta**2\n\n            # C_inv = adj(C)/det(C)\n            C_inv_11 = C22 * det_C_const\n            C_inv_12 = -C12 * det_C_const\n            C_inv_22 = C11 * det_C_const\n            \n            # Lagrange multipliers lambda = C_inv * epsilon\n            lambda_1 = C_inv_11 * epsilon_1 + C_inv_12 * epsilon_2\n            lambda_2 = C_inv_12 * epsilon_1 + C_inv_22 * epsilon_2\n            \n            # Velocity correction delta_q_dot = -M_inv * A_T * lambda\n            delta_q_dot = np.zeros(4)\n            delta_q_dot[0] = -lambda_1 / m\n            delta_q_dot[1] = -lambda_2 / m\n            # delta_q_dot[2] is 0\n            delta_q_dot[3] = (r / I_phi) * (c_theta * lambda_1 + s_theta * lambda_2)\n            \n            # --- Update state for next iteration ---\n            q = q_star\n            q_dot = q_dot_star + delta_q_dot\n            t += h\n\n        return q\n\n    results = []\n    for dt in delta_t_values:\n        # Run simulation to get final numerical state\n        q_num_T = run_simulation(dt)\n\n        # Calculate errors\n        pos_error = np.linalg.norm(q_num_T[:2] - q_exact_T[:2])\n        ang_error = np.linalg.norm(q_num_T[2:] - q_exact_T[2:])\n        \n        results.extend([pos_error, ang_error])\n\n    # Print results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}