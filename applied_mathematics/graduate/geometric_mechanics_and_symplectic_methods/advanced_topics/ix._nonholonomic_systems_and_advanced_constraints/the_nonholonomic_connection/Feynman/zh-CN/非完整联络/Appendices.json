{
    "hands_on_practices": [
        {
            "introduction": "非完整联络是控制受约束系统动力学的核心几何对象。它通过将标准的 Levi-Civita 联络投影到约束分布上而定义。本练习  将通过一个经典模型——“冰刀”或 Chaplygin 雪橇，为您提供从第一性原理出发，应用这一定义来计算联络分量（即非完整 Christoffel 符号）的直接实践。通过这种具体的计算，您将能牢固掌握非完整联络的抽象概念。",
            "id": "3780354",
            "problem": "考虑一个平面刚体（“刀刃”或 Chaplygin 雪橇），其位形空间为 $Q=\\mathbb{R}^{2}\\times \\mathbb{S}^{1}$，坐标为 $q=(x,y,\\theta)$。动能度量为\n$$\ng = m\\,dx^{2} + m\\,dy^{2} + I\\,d\\theta^{2},\n$$\n其中 $m$ 和 $I$ 是正常数，分别代表质量和绕平面外轴的转动惯量。沿刚体纵轴横向无滑动的非完整约束由单个线性速度约束给出\n$$\nA(q)\\,\\dot{q}=0,\\qquad A(q)=\\begin{bmatrix}-\\sin\\theta  \\cos\\theta  0\\end{bmatrix},\n$$\n因此，允许的速度满足 $-\\sin\\theta\\,\\dot{x}+\\cos\\theta\\,\\dot{y}=0$。令 $D=\\ker A(q)\\subset TQ$ 表示约束分布。\n\n仅使用基本定义，即 $g$ 的 Levi-Civita 联络 $\\nabla$ 是唯一的无挠、度量兼容的联络，以及非完整联络 $\\nabla^{nh}$ 是通过将 $\\nabla$ 在两个变量上 $g$-正交投影到 $D$ 上获得的（即，对于取值于 $D$ 的向量场 $X,Y$，有 $\\nabla^{nh}_{X}Y = P\\big(\\nabla_{X}Y\\big)$，其中 $P:TQ\\to D$ 是 $g$-正交投影算子），为该系统显式构造 $\\nabla^{nh}$。\n\n选择非完整标架\n$$\ne_{1}(q)=\\cos\\theta\\,\\partial_{x}+\\sin\\theta\\,\\partial_{y},\\qquad e_{2}(q)=\\partial_{\\theta},\n$$\n它张成 $D$。通过下式定义非完整 Christoffel 符号 $\\Gamma^{c}_{ab}(q)$\n$$\n\\nabla^{nh}_{e_{a}}e_{b}=\\Gamma^{c}_{ab}\\,e_{c},\\quad a,b,c\\in\\{1,2\\}.\n$$\n计算单个分量 $\\Gamma^{1}_{22}(q)$ 作为 $q$ 的显式表达式。你的最终答案必须是无单位的单个闭式解析表达式。",
            "solution": "用户想要计算 Chaplygin 雪橇的非完整 Christoffel 符号 $\\Gamma^{1}_{22}(q)$。求解的逻辑路径是遵循问题陈述中给出的定义。\n\n待计算的量 $\\Gamma^{1}_{22}$ 定义为 $\\nabla^{nh}_{e_{2}}e_{2}$ 在基 $\\{e_{1}, e_{2}\\}$ 中展开时 $e_{1}$ 的系数：\n$$\n\\nabla^{nh}_{e_{2}}e_{2} = \\Gamma^{1}_{22}\\,e_{1} + \\Gamma^{2}_{22}\\,e_{2}\n$$\n非完整联络 $\\nabla^{nh}$ 由度量 $g$ 的 Levi-Civita 联络 $\\nabla$ 到约束分布 $D$ 上的 $g$-正交投影定义。对于取值于 $D$ 的向量场 $X, Y$，定义为：\n$$\n\\nabla^{nh}_{X}Y = P(\\nabla_{X}Y)\n$$\n其中 $P: TQ \\to D$ 是 $g$-正交投影算子。\n\n将此定义应用于 $X=e_{2}$ 和 $Y=e_{2}$ 的特定情况，我们得到：\n$$\n\\nabla^{nh}_{e_{2}}e_{2} = P(\\nabla_{e_{2}}e_{2})\n$$\n因此，问题简化为两个主要步骤：\n1. 计算 Levi-Civita 协变导数 $\\nabla_{e_{2}}e_{2}$。\n2. 将所得向量场投影到分布 $D$ 上。\n\n**步骤 1：计算 Levi-Civita 协变导数 $\\nabla_{e_{2}}e_{2}$。**\n\nLevi-Civita 联络 $\\nabla$ 由度量 $g$ 确定。在坐标基 $\\{\\partial_x, \\partial_y, \\partial_\\theta\\}$ 中，度量由下式给出：\n$$\ng = m\\,dx^{2} + m\\,dy^{2} + I\\,d\\theta^{2}\n$$\n这对应于一个度量张量矩阵 $G$，其分量 $g_{ij} = g(\\partial_i, \\partial_j)$ 是对角且恒定的：\n$$\nG = \\begin{pmatrix} m  0  0 \\\\ 0  m  0 \\\\ 0  0  I \\end{pmatrix}\n$$\n其中 $m$ 和 $I$ 是正常数。\n\nLevi-Civita 联络的第一类 Christoffel 符号由下式给出：\n$$\n\\Gamma_{ijk} = \\frac{1}{2}\\left(\\frac{\\partial g_{jk}}{\\partial q^i} + \\frac{\\partial g_{ik}}{\\partial q^j} - \\frac{\\partial g_{ij}}{\\partial q^k}\\right)\n$$\n第二类 Christoffel 符号为 $\\Gamma^k_{ij} = g^{kl}\\Gamma_{lij}$。由于所有度量分量 $g_{ij}$ 都是常数，它们关于坐标 $(x, y, \\theta)$ 的所有偏导数都为零。\n$$\n\\frac{\\partial g_{ij}}{\\partial q^k} = 0 \\quad \\text{对所有 } i,j,k \\in \\{x,y,\\theta\\}\n$$\n因此，在此坐标系中，Levi-Civita 联络的所有 Christoffel 符号都为零：$\\Gamma^k_{ij} = 0$。\n\n一个坐标基向量场沿另一个坐标基向量场的协变导数由 $\\nabla_{\\partial_i}\\partial_j = \\Gamma^k_{ij}\\partial_k$ 给出。由于所有的 $\\Gamma^k_{ij}$ 都为零，我们有 $\\nabla_{\\partial_i}\\partial_j = 0$。这意味着该联络在 $(x, y, \\theta)$ 坐标下是平坦的。\n\n问题将标架向量 $e_{2}$ 作为坐标基向量给出：\n$$\ne_{2}(q) = \\partial_{\\theta}\n$$\n我们现在可以计算 $\\nabla_{e_{2}}e_{2}$：\n$$\n\\nabla_{e_{2}}e_{2} = \\nabla_{\\partial_{\\theta}}\\partial_{\\theta}\n$$\n使用公式 $\\nabla_{\\partial_{\\theta}}\\partial_{\\theta} = \\Gamma^k_{\\theta\\theta}\\partial_k$ 以及所有 $\\Gamma^k_{\\theta\\theta}=0$ 的事实，我们发现：\n$$\n\\nabla_{e_{2}}e_{2} = 0\n$$\n所得的向量场是零向量场。\n\n**步骤 2：将 $\\nabla_{e_{2}}e_{2}$ 投影到分布 $D$ 上。**\n\n非完整联络是通过使用投影算子 $P$ 将此结果投影到分布 $D$ 上得到的。投影算子 $P$ 是一个线性映射。它作用于零向量的结果是零向量：\n$$\nP(0) = 0\n$$\n因此，我们有：\n$$\n\\nabla^{nh}_{e_{2}}e_{2} = P(\\nabla_{e_{2}}e_{2}) = P(0) = 0\n$$\n\n**步骤 3：确定系数 $\\Gamma^{1}_{22}$。**\n\n我们将步骤 2 的结果与非完整 Christoffel 符号的定义相等：\n$$\n\\Gamma^{1}_{22}\\,e_{1} + \\Gamma^{2}_{22}\\,e_{2} = 0\n$$\n标架向量 $e_{1} = \\cos\\theta\\,\\partial_{x}+\\sin\\theta\\,\\partial_{y}$ 和 $e_{2} = \\partial_{\\theta}$ 在每个点 $q \\in Q$ 处都是线性无关的。要使其线性组合为零向量，系数必须为零。\n$$\n\\Gamma^{1}_{22} = 0 \\quad \\text{且} \\quad \\Gamma^{2}_{22} = 0\n$$\n问题要求的是分量 $\\Gamma^{1}_{22}(q)$。结果是 $0$。这个值是常数，因此与 $q$ 无关。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "理解了非完整联络的定义后，下一步便是分析它所描述的运动：非完整测地线。这些曲线在遵守约束的同时尽可能地“笔直”，其形式化定义为 $P(\\nabla_{\\dot{\\gamma}}\\dot{\\gamma})=0$。Lagrange-d'Alembert 原理为推导这些运动方程提供了一个强大的变分方法。本练习  将引导您在典型的 Heisenberg 群背景下，推导并求解非完整测地线的运动方程。它不仅为应用拉格朗日方法处理非完整力学问题提供了宝贵的实践，也揭示了这些动力学系统有时会呈现出出人意料的简洁性。",
            "id": "3780406",
            "problem": "设 $\\mathbb{R}^{3}$ 在笛卡尔坐标 $(x,y,z)$ 下具有欧几里得度量 $g$，并考虑由1-形式 $\\alpha = dz - \\tfrac{1}{2}\\left(x\\,dy - y\\,dx\\right)$ 定义的 Heisenberg 型不可积分布 $\\mathcal{D}=\\ker \\alpha$。其正交补由欧几里得音乐同构 $g^{\\sharp}$ 确定，非完整联络通过正交投影算子 $P:\\,T\\mathbb{R}^{3}\\to \\mathcal{D}$ 将 $g$ 的 Levi-Civita 联络 $\\nabla$ 投影到 $\\mathcal{D}$ 上来定义。一条非完整测地线是一条曲线 $\\gamma(t)$，满足对所有 $t$ 都有 $\\dot{\\gamma}(t)\\in \\mathcal{D}$ 且 $P\\left(\\nabla_{\\dot{\\gamma}}\\dot{\\gamma}\\right)=0$。\n\n从 d’Alembert-Lagrange 非完整变分原理的第一性原理出发，对于在速度约束 $\\alpha(\\dot{\\gamma})=0$ 下的动能拉格朗日量 $L=\\tfrac{1}{2}\\|\\dot{\\gamma}\\|^{2}$，推导出非完整测地线的运动控制方程，并针对初值问题\n$$\n\\gamma(0)=(0,0,0),\\qquad \\dot{\\gamma}(0)=(v_{1},\\,v_{2},\\,0),\n$$\n求解它们，其中 $v_{1}$ 和 $v_{2}$ 是实常数。然后，利用亚黎曼几何的基本哈密顿框架和 Pontryagin 极大值原理 (PMP)，将得到的非完整测地线与正规亚黎曼测地线进行比较，该亚黎曼测地线是针对 Heisenberg 结构而言的，其通过声明向量场 $X_{1}=\\partial_{x}-\\tfrac{y}{2}\\partial_{z}$ 和 $X_{2}=\\partial_{y}+\\tfrac{x}{2}\\partial_{z}$ 在 $\\mathcal{D}$ 上是标准正交的来获得。\n\n提供给定初始条件下非完整测地线 $\\gamma_{\\mathrm{nh}}(t)$ 的显式参数形式。将你的最终答案表示为一个包含三个分量函数 $(x(t),\\,y(t),\\,z(t))$ 的单行矩阵。不需要数值近似。",
            "solution": "首先验证问题，以确保其是适定的、有科学依据且内部一致的。\n\n### 第1步：提取已知条件\n-   **位形空间**: 具有笛卡尔坐标 $(x,y,z)$ 的 $\\mathbb{R}^3$。\n-   **度量**: 标准欧几里得度量 $g$。\n-   **拉格朗日量**: 动能拉格朗日量 $L = \\frac{1}{2}\\|\\dot{\\gamma}\\|^2 = \\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2 + \\dot{z}^2)$。\n-   **非完整约束**: 速度向量 $\\dot{\\gamma}=(\\dot{x}, \\dot{y}, \\dot{z})$ 必须位于分布 $\\mathcal{D} = \\ker \\alpha$ 中，其中 $\\alpha = dz - \\frac{1}{2}(x\\,dy - y\\,dx)$。该约束由 Pfaffian 方程 $\\alpha(\\dot{\\gamma}) = 0$ 给出，即 $\\dot{z} - \\frac{1}{2}(x\\dot{y} - y\\dot{x}) = 0$。\n-   **初始条件**: $\\gamma(0) = (x(0), y(0), z(0)) = (0,0,0)$ 和 $\\dot{\\gamma}(0) = (\\dot{x}(0), \\dot{y}(0), \\dot{z}(0)) = (v_1, v_2, 0)$，其中 $v_1, v_2 \\in \\mathbb{R}$ 是常数。\n-   **任务**: 使用 d'Alembert-Lagrange 原理，推导并求解在给定初始条件下的非完整测地线方程。此外，将此结果与正规亚黎曼测地线进行比较。\n\n### 第2步：使用提取的已知条件进行验证\n-   **科学依据**: 该问题是非完整几何和亚黎曼几何中的一个标准练习，这两者是微分几何和几何力学中成熟的分支。Heisenberg 分布是一个典型的例子。该问题在科学上是合理的。\n-   **适定性和一致性**: 该问题提供了一个拉格朗日量、一个有效的非完整约束和一套完整的初始条件。在点 $\\gamma(0)=(0,0,0)$ 处的初始速度 $\\dot{\\gamma}(0)=(v_1, v_2, 0)$ 必须满足约束：$\\dot{z}(0) - \\frac{1}{2}(x(0)\\dot{y}(0) - y(0)\\dot{x}(0)) = 0 - \\frac{1}{2}(0 \\cdot v_2 - 0 \\cdot v_1) = 0$。初始条件与约束一致。该问题是适定的。\n-   **客观性**: 该问题以精确的数学语言陈述，没有任何主观性或模糊性。\n\n### 第3步：结论和行动\n问题被判定为**有效**。将提供完整解答。\n\n### 运动方程的推导\n\n我们使用 d'Alembert-Lagrange 非完整变分原理。对于具有拉格朗日量 $L(q, \\dot{q})$ 并受线性速度约束 $C(q, \\dot{q}) = \\sum_i A_i(q) \\dot{q}^i = 0$ 的系统，其运动方程由下式给出：\n$$\n\\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{q}^i}\\right) - \\frac{\\partial L}{\\partial q^i} = \\lambda A_i(q)\n$$\n其中 $\\lambda$ 是由约束的持续性决定的拉格朗日乘子。\n\n拉格朗日量是 $L = \\frac{1}{2}(\\dot{x}^2 + \\dot{y}^2 + \\dot{z}^2)$。坐标是 $q = (x, y, z)$。$L$ 的偏导数是：\n$$\n\\frac{\\partial L}{\\partial \\dot{x}} = \\dot{x}, \\quad \\frac{\\partial L}{\\partial \\dot{y}} = \\dot{y}, \\quad \\frac{\\partial L}{\\partial \\dot{z}} = \\dot{z}\n$$\n$$\n\\frac{\\partial L}{\\partial x} = 0, \\quad \\frac{\\partial L}{\\partial y} = 0, \\quad \\frac{\\partial L}{\\partial z} = 0\n$$\n约束方程 $\\dot{z} - \\frac{1}{2}(x\\dot{y} - y\\dot{x}) = 0$ 可以写成 $A_x \\dot{x} + A_y \\dot{y} + A_z \\dot{z} = 0$ 的形式，其中：\n$$\nA_x = \\frac{y}{2}, \\quad A_y = -\\frac{x}{2}, \\quad A_z = 1\n$$\n坐标 $(x,y,z)$ 的 Lagrange-d'Alembert 方程是：\n1.  $\\ddot{x} = \\lambda A_x = \\lambda \\frac{y}{2}$\n2.  $\\ddot{y} = \\lambda A_y = -\\lambda \\frac{x}{2}$\n3.  $\\ddot{z} = \\lambda A_z = \\lambda$\n\n为了求出拉格朗日乘子 $\\lambda$，我们将约束方程对时间 $t$ 求导：\n$$\n\\frac{d}{dt}\\left(\\dot{z} - \\frac{1}{2}(x\\dot{y} - y\\dot{x})\\right) = 0\n$$\n$$\n\\ddot{z} - \\frac{1}{2}(\\dot{x}\\dot{y} + x\\ddot{y} - \\dot{y}\\dot{x} - y\\ddot{x}) = 0\n$$\n$$\n\\ddot{z} - \\frac{1}{2}(x\\ddot{y} - y\\ddot{x}) = 0\n$$\n现在，将运动方程中 $\\ddot{x}$、$\\ddot{y}$ 和 $\\ddot{z}$ 的表达式代入这个微分后的约束方程中：\n$$\n\\lambda - \\frac{1}{2}\\left(x\\left(-\\lambda \\frac{x}{2}\\right) - y\\left(\\lambda \\frac{y}{2}\\right)\\right) = 0\n$$\n$$\n\\lambda - \\frac{1}{2}\\left(-\\frac{\\lambda x^2}{2} - \\frac{\\lambda y^2}{2}\\right) = 0\n$$\n$$\n\\lambda + \\frac{\\lambda}{4}(x^2 + y^2) = 0\n$$\n$$\n\\lambda \\left(1 + \\frac{x^2 + y^2}{4}\\right) = 0\n$$\n由于对于所有实数 $x$ 和 $y$，项 $1 + \\frac{1}{4}(x^2 + y^2)$ 恒为正，唯一的可能性是乘子 $\\lambda$ 恒为零，即对所有 $t$ 都有 $\\lambda(t) = 0$。\n\n这个结果表明，对于这个特定的非完整系统，约束力为零。运动方程简化为：\n$$\n\\ddot{x} = 0, \\quad \\ddot{y} = 0, \\quad \\ddot{z} = 0\n$$\n这些方程描述了以恒定速度进行的直线运动。\n\n### 求解初值问题\n\n我们将运动方程积分两次。一次积分得到：\n$$\n\\dot{x}(t) = c_1, \\quad \\dot{y}(t) = c_2, \\quad \\dot{z}(t) = c_3\n$$\n应用初始速度条件 $\\dot{\\gamma}(0)=(v_1, v_2, 0)$，我们求出积分常数：\n$$\nc_1 = v_1, \\quad c_2 = v_2, \\quad c_3 = 0\n$$\n所以，速度向量是恒定的：$\\dot{\\gamma}(t) = (v_1, v_2, 0)$。\n\n第二次积分得到轨迹：\n$$\nx(t) = v_1 t + d_1, \\quad y(t) = v_2 t + d_2, \\quad z(t) = 0 \\cdot t + d_3\n$$\n应用初始位置条件 $\\gamma(0)=(0,0,0)$:\n$$\nd_1 = 0, \\quad d_2 = 0, \\quad d_3 = 0\n$$\n因此，非完整测地线的显式参数形式是：\n$$\n\\gamma_{\\mathrm{nh}}(t) = (v_1 t, v_2 t, 0)\n$$\n我们必须验证该解在所有时间 $t$ 都满足非完整约束：\n$$\n\\dot{z}(t) - \\frac{1}{2}\\left(x(t)\\dot{y}(t) - y(t)\\dot{x}(t)\\right) = 0 - \\frac{1}{2}\\left((v_1 t)(v_2) - (v_2 t)(v_1)\\right) = -\\frac{1}{2}(v_1 v_2 t - v_2 v_1 t) = 0\n$$\n该约束在所有时间都得到满足。\n\n### 与亚黎曼测地线的比较\n\n问题还要求与从相同分布的 Pontryagin 极大值原理 (PMP) 得到的正规亚黎曼测地线进行比较。Heisenberg 群的亚黎曼测地线方程是已知的：\n$$\n\\ddot{x} = -p_z \\dot{y}, \\quad \\ddot{y} = p_z \\dot{x}\n$$\n其中 $p_z$ 是与 $z$ 坐标共轭的常数动量。这些方程描述了 $(x,y)$ 平面上的圆周运动（当 $p_z \\neq 0$ 时），从而导致 $\\mathbb{R}^3$ 中的螺旋路径。这些通常与上面找到的直线非完整测地线不同。\n\n然而，有一个特殊情况。如果 PMP 的初始协态向量满足 $p_z(0)=0$，那么亚黎曼测地线方程就变成 $\\ddot{x}=0$ 和 $\\ddot{y}=0$。这也意味着 $\\ddot{z}=0$。这正是我们为非完整测地线求解的系统。因此，对于这个特定问题，非完整测地线 $\\gamma_{\\mathrm{nh}}(t)$ 对应于共轭动量 $p_z$ 为零的特殊情况下的亚黎曼测地线。\n\n对于指定的非完整测地线初值问题，其解是直线路径。\n\n最终答案是 $\\gamma_{\\mathrm{nh}}(t)$ 的分量函数集。\n$$\nx(t) = v_1 t\n$$\n$$\ny(t) = v_2 t\n$$\n$$\nz(t) = 0\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nv_1 t & v_2 t & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "对于像滚动的圆盘这样复杂的系统，解析解是罕见的，我们必须借助数值方法来模拟和理解其运动。投影法是非完整动力学几何定义的直接数值实现，在每个时间步，通过将速度投影回约束分布来“校正”无约束的运动。本练习  将理论付诸实践，要求您为经典的滚动圆盘问题编写一个仿真程序。通过编写投影法并与精确解进行比较来验证其收敛性，您将在几何力学的现代研究中获得必不可少的计算技术实践经验。",
            "id": "3780359",
            "problem": "考虑一个经典的滚动圆盘，其位形流形由二维特殊欧几里得群 (SE(2)) 与一个圆周相乘给出，广义坐标为 $(x,y,\\theta,\\phi)$，其中 $(x,y)$ 是接触点的平面坐标，$\\theta$ 是圆盘的朝向角（以弧度为单位），$\\phi$ 是圆盘的滚动角（以弧度为单位）。半径为 $r$、质量为 $m$ 的圆盘具有一个动能拉格朗日量，该拉格朗日量在位形流形上导出一个黎曼度量，其主转动惯量分别为绕垂直轴的 $I_\\theta$（与 $\\theta$ 相关）和绕圆盘自旋轴的 $I_\\phi$（与 $\\phi$ 相关）。非完整的无滑动滚动约束强制执行以下运动学关系：$x$ 方向的速度等于 $r$ 乘以滚动速率在朝向方向上的投影，$y$ 方向的速度等于 $r$ 乘以滚动速率在正交方向上的投影。约束分布是在每个位形上由这些线性速度关系定义的切丛的一个子丛。\n\n从动能和滚动约束的第一性原理出发，非完整联络 $\\nabla^{nh}$ 是通过将与动能度量相关的 Levi–Civita 联络投影到约束分布上而获得的仿射联络。对于具有恒定质量度量和所述约束的基准滚动圆盘，$\\nabla^{nh}$-测地线对应于没有外力的受约束运动，其加速度是无约束加速度在约束分布上的正交投影（相对于动能度量）。\n\n实现投影法，用于将滚动圆盘的受约束动力学视为 $\\nabla^{nh}$ 测地流进行时间步进。在每个时间步，使用当前速度推进位形，然后将质量度量正交投影仪作用于瞬时约束分布上以更新速度，使其在新位形上满足滚动约束。使用时间上的一阶显式格式。推导并实现基准情况的精确解，其中朝向速率和滚动速率是常数，且平移速度受滚动关系约束。通过报告在固定最终时间 $T$ 时的误差，数值验证离散的 $\\nabla^{nh}$ 测地线随着时间步长 $\\Delta t$ 减小而收敛于精确解。\n\n基本依据：\n- 动能定义了位形流形上的一个黎曼度量，具有广义速度 $(\\dot{x},\\dot{y},\\dot{\\theta},\\dot{\\phi})$ 和正常数 $m$、$I_\\theta$、$I_\\phi$。\n- 滚动约束在速度上是线性的，并取决于位形角 $\\theta$。\n- 速度在约束分布上的质量度量正交投影定义为，在满足线性约束的条件下，最小化修正量的动能范数。\n\n你的程序必须：\n- 将圆盘参数 $m$、$r$、$I_\\theta$、$I_\\phi$ 视为具有物理上合理值的常数。\n- 使用以米和弧度为单位的初始条件 $(x_0,y_0,\\theta_0,\\phi_0)$，以及以弧度/秒为单位的恒定速率 $(\\dot{\\theta}_0,\\dot{\\phi}_0)$。\n- 使用下面测试套件中指定的时间步长 $\\Delta t$，通过投影法模拟从 $t=0$ 到 $t=T$ 秒的离散 $\\nabla^{nh}$ 测地流。\n- 使用与滚动约束一致的恒定 $(\\dot{\\theta}_0,\\dot{\\phi}_0)$ 情况，计算在 $t=T$ 时的精确解。\n- 为每个测试用例报告两个误差：在时间 $T$ 时的位置误差的欧几里得范数（单位为米），$\\sqrt{(\\Delta x)^2 + (\\Delta y)^2}$，以及角度误差的欧几里得范数（单位为弧度），$\\sqrt{(\\Delta \\theta)^2 + (\\Delta \\phi)^2}$。\n\n单位：\n- 位置必须以米为单位处理。\n- 角度必须以弧度为单位处理。\n- 时间必须以秒为单位处理。\n\n测试套件：\n- 使用圆盘参数 $m=1.0$ 千克，$r=0.5$ 米，$I_\\theta=0.2$ 千克·米²，$I_\\phi=0.1$ 千克·米²。\n- 使用初始条件 $(x_0,y_0,\\theta_0,\\phi_0)=(0.0,0.0,0.3,0.0)$。\n- 使用恒定速率 $(\\dot{\\theta}_0,\\dot{\\phi}_0)=(0.4,1.0)$ 弧度/秒。\n- 使用最终时间 $T=1.0$ 秒。\n- 对以下秒为单位的 $\\Delta t$ 值评估该方法：$0.5$（步数少的边界情况）、$0.3$（不是 $T$ 的约数）、$0.2$（中等）和 $0.05$（小）。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。该列表必须按以下顺序包含八个浮点数：$[e_{pos,0.5},e_{ang,0.5},e_{pos,0.3},e_{ang,0.3},e_{pos,0.2},e_{ang,0.2},e_{pos,0.05},e_{ang,0.05}]$，其中 $e_{pos,\\Delta t}$ 是在给定 $\\Delta t$ 时，在时间 $T$ 的位置误差（单位米），$e_{ang,\\Delta t}$ 是角度误差（单位弧度）。",
            "solution": "用户希望使用非完整力学框架来分析滚动圆盘的运动。这包括推导运动方程，定义一个基于投影的数值积分方案，并将数值结果与已知的精确解进行比较。\n\n### 1. 问题验证\n所提供的问题陈述是几何力学中的一个标准练习，具体涉及滚动圆盘的非完整动力学。\n\n- **给定条件**：\n    - **位形流形**：$SE(2) \\times S^1$，广义坐标为 $q = (x, y, \\theta, \\phi)$。\n    - **坐标**：$(x,y)$ 是接触点的平面坐标，$\\theta$ 是朝向角，$\\phi$ 是滚动角。\n    - **参数**：质量 $m$，半径 $r$，主转动惯量 $I_\\theta$ 和 $I_\\phi$。\n    - **动能**：$T(\\dot{q}) = \\frac{1}{2} m (\\dot{x}^2 + \\dot{y}^2) + \\frac{1}{2} I_\\theta \\dot{\\theta}^2 + \\frac{1}{2} I_\\phi \\dot{\\phi}^2$。这定义了黎曼度量（质量矩阵）$M = \\text{diag}(m, m, I_\\theta, I_\\phi)$。\n    - **非完整约束**：无滑动滚动条件如下：\n        - $\\dot{x} = r \\dot{\\phi} \\cos\\theta$\n        - $\\dot{y} = r \\dot{\\phi} \\sin\\theta$\n    - **数值方法**：一阶显式投影法。\n    - **任务**：实现投影法，推导并实现恒定角速率下的精确解，并为一组给定的参数、初始条件和时间步长 $\\Delta t$ 计算在时间 $T$ 时数值解与精确解之间的误差。\n    - **参数**：$m=1.0$, $r=0.5$, $I_\\theta=0.2$, $I_\\phi=0.1$。\n    - **初始条件**：$(x_0,y_0,\\theta_0,\\phi_0)=(0.0,0.0,0.3,0.0)$，$(\\dot{\\theta}_0,\\dot{\\phi}_0)=(0.4,1.0)$。\n    - **时间**：$T=1.0$，$\\Delta t \\in \\{0.5, 0.3, 0.2, 0.05\\}$。\n\n- **验证**：\n    - 该问题在经典力学和几何力学中具有**科学依据**。\n    - 它是**适定的**，提供了推导唯一解所需的所有信息。\n    - 它是**客观的**并且没有歧义。\n    - 该问题不违反任何无效性标准。设置是标准的，所要求的任务是清晰的，并且比较是可验证的。\n\n- **结论**：该问题是**有效的**。\n\n### 2. 精确解的推导\n系统的运动在没有外力的情况下由 $\\nabla^{nh}$-测地线描述，这些测地线是 Lagrange-d'Alembert 方程的解。拉格朗日量是动能，$L(q, \\dot{q}) = T(\\dot{q})$。约束在速度上是线性的，可以写成 $A(q)\\dot{q}=0$，其中\n$$\nA(q) = \\begin{pmatrix}\n1  0  0  -r \\cos\\theta \\\\\n0  1  0  -r \\sin\\theta\n\\end{pmatrix}\n$$\nLagrange-d'Alembert 方程为 $\\frac{d}{dt}\\left(\\frac{\\partial L}{\\partial \\dot{q}}\\right) - \\frac{\\partial L}{\\partial q} = A(q)^T \\lambda$，其中 $\\lambda = (\\lambda_1, \\lambda_2)^T$ 是拉格朗日乘子。\n- 对于 $q^3=\\theta$：$\\frac{d}{dt}(I_\\theta\\dot{\\theta}) - 0 = 0 \\implies I_\\theta\\ddot{\\theta} = 0$。因此，$\\dot{\\theta}(t)$ 是一个常数，$\\dot{\\theta}(t) = \\dot{\\theta}_0$。\n- 对于 $q^4=\\phi$：$\\frac{d}{dt}(I_\\phi\\dot{\\phi}) - 0 = -r\\cos\\theta \\cdot \\lambda_1 - r\\sin\\theta \\cdot \\lambda_2$。\n- 对于 $q^1=x$ 和 $q^2=y$：$m\\ddot{x} = \\lambda_1$ 和 $m\\ddot{y} = \\lambda_2$。\n将 $\\lambda_1, \\lambda_2$ 代入 $\\phi$ 的方程得到 $I_\\phi\\ddot{\\phi} = -r(m\\ddot{x}\\cos\\theta + m\\ddot{y}\\sin\\theta)$。\n为了求 $\\ddot{x}$ 和 $\\ddot{y}$，我们对约束方程求导：\n$\\ddot{x} = r\\ddot{\\phi}\\cos\\theta - r\\dot{\\phi}\\dot{\\theta}\\sin\\theta$\n$\\ddot{y} = r\\ddot{\\phi}\\sin\\theta + r\\dot{\\phi}\\dot{\\theta}\\cos\\theta$\n将这些代入 $\\ddot{\\phi}$ 的方程：\n$I_\\phi\\ddot{\\phi} = -mr( (r\\ddot{\\phi}\\cos\\theta - r\\dot{\\phi}\\dot{\\theta}\\sin\\theta)\\cos\\theta + (r\\ddot{\\phi}\\sin\\theta + r\\dot{\\phi}\\dot{\\theta}\\cos\\theta)\\sin\\theta )$\n$I_\\phi\\ddot{\\phi} = -mr( r\\ddot{\\phi}(\\cos^2\\theta + \\sin^2\\theta) ) = -mr^2\\ddot{\\phi}$\n$(I_\\phi + mr^2)\\ddot{\\phi} = 0$。因为 $I_\\phi, m, r > 0$，我们必须有 $\\ddot{\\phi}=0$。因此，$\\dot{\\phi}(t)$ 也是一个常数，$\\dot{\\phi}(t) = \\dot{\\phi}_0$。\n\n因此，角速率为常数的基准情况就是精确的测地线解。我们可以对这些进行积分，以求得在时间 $T$ 的位形。\n$\\theta(T) = \\theta_0 + \\dot{\\theta}_0 T$\n$\\phi(T) = \\phi_0 + \\dot{\\phi}_0 T$\n$x(T) = x_0 + \\int_0^T r\\dot{\\phi}_0 \\cos(\\theta_0 + \\dot{\\theta}_0 t) dt = x_0 + r\\frac{\\dot{\\phi}_0}{\\dot{\\theta}_0}[\\sin(\\theta_0 + \\dot{\\theta}_0 T) - \\sin(\\theta_0)]$（对于 $\\dot{\\theta}_0 \\neq 0$）\n$y(T) = y_0 + \\int_0^T r\\dot{\\phi}_0 \\sin(\\theta_0 + \\dot{\\theta}_0 t) dt = y_0 + r\\frac{\\dot{\\phi}_0}{\\dot{\\theta}_0}[\\cos(\\theta_0) - \\cos(\\theta_0 + \\dot{\\theta}_0 T)]$（对于 $\\dot{\\theta}_0 \\neq 0$）\n\n### 3. 投影法的推导\n数值方案包括一个无约束更新，然后是一个投影。\n1.  **漂移步**：采用显式欧拉步。\n    $q_{k+1}^* = q_k + \\Delta t \\cdot \\dot{q}_k$\n    $\\dot{q}_{k+1}^* = \\dot{q}_k$（因为没有外力，无约束加速度为零）。\n2.  **投影步**：将速度 $\\dot{q}_{k+1}^*$ 关于质量度量 $M$ 正交投影到约束分布 $\\mathcal{D}_{q_{k+1}^*}$ 上。这意味着找到 $\\dot{q}_{k+1}$，使得在 $A(q_{k+1}^*)\\dot{q}_{k+1} = 0$ 的约束下，最小化 $||\\dot{q}_{k+1} - \\dot{q}_{k+1}^*||_M^2$。\n这个约束最小化问题的解由一个正交投影仪 $P(q)$ 给出：$\\dot{q}_{k+1} = P(q_{k+1}^*)\\dot{q}_{k+1}^*$。\n投影仪为 $P(q) = I - M^{-1}A(q)^T(A(q)M^{-1}A(q)^T)^{-1}A(q)$。\n速度的更新规则是 $\\dot{q}_{k+1} = \\dot{q}_{k+1}^* - M^{-1}A(q_{k+1}^*)^T\\lambda$，其中拉格朗日乘子 $\\lambda$ 通过求解以下方程得到：\n$(A(q_{k+1}^*) M^{-1} A(q_{k+1}^*)^T) \\lambda = A(q_{k+1}^*) \\dot{q}_{k+1}^*$。\n令 $q' = q_{k+1}^*$ 和 $\\dot{q}' = \\dot{q}_{k+1}^*$。矩阵 $C(q') = A(q') M^{-1} A(q')^T$ 为：\n$C(\\theta') = \\begin{pmatrix} 1/m + (r^2 \\cos^2\\theta')/I_\\phi  (r^2 \\cos\\theta' \\sin\\theta')/I_\\phi \\\\ (r^2 \\cos\\theta' \\sin\\theta')/I_\\phi  1/m + (r^2 \\sin^2\\theta')/I_\\phi \\end{pmatrix}$\n其行列式为常数：$\\det(C) = \\frac{1}{m^2} + \\frac{r^2}{m I_\\phi}$。\n约束违反量为 $\\epsilon = A(q')\\dot{q}' = \\begin{pmatrix} \\dot{x}' - r\\dot{\\phi}'\\cos\\theta' \\\\ \\dot{y}' - r\\dot{\\phi}'\\sin\\theta' \\end{pmatrix}$。\n我们求解 $C(\\theta')\\lambda=\\epsilon$ 以得到 $\\lambda=(\\lambda_1, \\lambda_2)^T$。然后新的速度 $\\dot{q}_{k+1}$ 计算如下：\n$\\dot{x}_{k+1} = \\dot{x}' - \\lambda_1/m$\n$\\dot{y}_{k+1} = \\dot{y}' - \\lambda_2/m$\n$\\dot{\\theta}_{k+1} = \\dot{\\theta}'$\n$\\dot{\\phi}_{k+1} = \\dot{\\phi}' + (r/I_\\phi)(\\lambda_1\\cos\\theta' + \\lambda_2\\sin\\theta')$\n位形更新为 $q_{k+1} = q_{k+1}^*$。重复此过程直到达到时间 $T$。\n\n### 4. 算法大纲\n最终的程序实现以下逻辑：\n1.  定义所有物理参数、初始条件和测试用例。\n2.  使用上面推导的解析公式计算最终的精确状态 $(x(T), y(T), \\theta(T), \\phi(T))$。\n3.  对于测试套件中的每个时间步长 $\\Delta t$：\n    a. 在 $t=0$ 时初始化数值状态 $q_{num}$ 和 $\\dot{q}_{num}$。初始速度 $(\\dot{x}_0, \\dot{y}_0)$ 由约束条件确定。\n    b. 从 $t=0$ 循环到 $T$。在每次迭代中，步长 $h$ 为 $\\min(\\Delta t, T-t)$，以确保最后一步正好落在 $T$ 上。\n    c. 执行漂移-投影步骤：\n        i. 更新位置：$q^* = q_{num} + h \\cdot \\dot{q}_{num}$。\n        ii. 使用 $\\dot{q}_{num}$ 和新角度 $\\theta^*_k$ 计算约束违反量 $\\epsilon$。\n        iii. 构造并求逆 $2 \\times 2$ 矩阵 $C(\\theta^*_k)$。\n        iv. 求解拉格朗日乘子 $\\lambda$。\n        v. 计算速度修正量并求得新速度 $\\dot{q}_{num, k+1}$。\n        vi. 更新状态：$q_{num} = q^*$。\n    d. 循环结束后，通过将最终数值状态 $q_{num}$ 与精确状态 $q_{exact}$ 进行比较，计算位置和角度误差。\n4.  收集并按指定格式打印八个误差值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the rolling disk problem by simulating its motion\n    using a projector method and comparing it to the exact solution.\n    \"\"\"\n\n    # Disk parameters\n    m = 1.0  # kg\n    r = 0.5  # m\n    I_theta = 0.2  # kg.m^2\n    I_phi = 0.1  # kg.m^2\n\n    # Initial conditions\n    q0 = np.array([0.0, 0.0, 0.3, 0.0])  # (x, y, theta, phi) in m, rad\n    d_theta0 = 0.4  # rad/s\n    d_phi0 = 1.0  # rad/s\n\n    # Simulation time\n    T = 1.0  # s\n\n    # Test suite for time steps\n    delta_t_values = [0.5, 0.3, 0.2, 0.05]\n\n    # Calculate exact solution at T\n    x0, y0, theta0, phi0 = q0\n    theta_T_exact = theta0 + d_theta0 * T\n    phi_T_exact = phi0 + d_phi0 * T\n\n    if d_theta0 != 0:\n        x_T_exact = x0 + r * d_phi0 / d_theta0 * (np.sin(d_theta0 * T + theta0) - np.sin(theta0))\n        y_T_exact = y0 + r * d_phi0 / d_theta0 * (np.cos(theta0) - np.cos(d_theta0 * T + theta0))\n    else: # Special case for straight line motion\n        x_T_exact = x0 + r * d_phi0 * T * np.cos(theta0)\n        y_T_exact = y0 + r * d_phi0 * T * np.sin(theta0)\n        \n    q_exact_T = np.array([x_T_exact, y_T_exact, theta_T_exact, phi_T_exact])\n\n    \n    def run_simulation(dt_val):\n        \"\"\"\n        Runs the numerical simulation for a given time step delta_t.\n        \"\"\"\n        # Initial state\n        q = np.copy(q0)\n        \n        # Calculate initial velocity from constraints\n        d_x0 = r * d_phi0 * np.cos(q0[2])\n        d_y0 = r * d_phi0 * np.sin(q0[2])\n        q_dot = np.array([d_x0, d_y0, d_theta0, d_phi0])\n        \n        t = 0.0\n        \n        # Pre-calculate inverse of determinant of C\n        det_C_inv = 1.0 / (1.0 / (m**2) + r**2 / (m * I_phi))\n\n        while t  T:\n            # Adjust final time step to land exactly on T\n            h = min(dt_val, T - t)\n            \n            # --- 1. Drift Step (Unconstrained update) ---\n            q_star = q + h * q_dot\n            q_dot_star = q_dot  # In the absence of forces, velocity is constant\n            \n            # --- 2. Projection Step ---\n            theta_new = q_star[2]\n            c_theta = np.cos(theta_new)\n            s_theta = np.sin(theta_new)\n\n            # Constraint violation term epsilon = A(q*)q_dot*\n            epsilon_1 = q_dot_star[0] - r * q_dot_star[3] * c_theta\n            epsilon_2 = q_dot_star[1] - r * q_dot_star[3] * s_theta\n\n            # C_matrix = A * M_inv * A_T\n            C11 = 1.0/m + (r**2 / I_phi) * c_theta**2\n            C12 = (r**2 / I_phi) * c_theta * s_theta\n            C22 = 1.0/m + (r**2 / I_phi) * s_theta**2\n\n            # C_inv = adj(C) * (1/det(C))\n            C_inv_11 = C22 * det_C_inv\n            C_inv_12 = -C12 * det_C_inv\n            C_inv_22 = C11 * det_C_inv\n            \n            # Lagrange multipliers lambda = C_inv * epsilon\n            lambda_1 = C_inv_11 * epsilon_1 + C_inv_12 * epsilon_2\n            lambda_2 = C_inv_12 * epsilon_1 + C_inv_22 * epsilon_2\n            \n            # Velocity correction delta_q_dot = -M_inv * A_T * lambda\n            delta_q_dot = np.zeros(4)\n            delta_q_dot[0] = -lambda_1 / m\n            delta_q_dot[1] = -lambda_2 / m\n            # delta_q_dot[2] is 0\n            delta_q_dot[3] = (r / I_phi) * (c_theta * lambda_1 + s_theta * lambda_2)\n            \n            # --- Update state for next iteration ---\n            q = q_star\n            q_dot = q_dot_star + delta_q_dot\n            t += h\n\n        return q\n\n    results = []\n    for dt in delta_t_values:\n        # Run simulation to get final numerical state\n        q_num_T = run_simulation(dt)\n\n        # Calculate errors\n        pos_error = np.linalg.norm(q_num_T[:2] - q_exact_T[:2])\n        ang_error = np.linalg.norm(q_num_T[2:] - q_exact_T[2:])\n        \n        results.extend([pos_error, ang_error])\n\n    # Print results in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}