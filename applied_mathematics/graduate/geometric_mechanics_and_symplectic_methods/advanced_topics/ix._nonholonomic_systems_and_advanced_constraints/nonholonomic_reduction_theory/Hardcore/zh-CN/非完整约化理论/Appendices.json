{
    "hands_on_practices": [
        {
            "introduction": "在非完整力学中，首要任务是明确区分完整约束与非完整约束。Frobenius 定理为此提供了根本性的判据，特别是对于由单个 1-形式 $\\omega$ 定义的约束，其可积性（即完整性）取决于条件 $\\omega \\wedge d\\omega = 0$ 是否成立。本练习  旨在通过直接计算来巩固这一核心概念，让您亲手运用外微分和楔积等外代数工具，来判断一个给定的速度约束是真正的非完整约束，还是可积的完整约束的伪装。",
            "id": "3759769",
            "problem": "考虑构型流形 $Q = \\mathbb{R}^{3}$，其全局坐标为 $(x,y,\\theta)$。设一个非完整速度约束由零化 $1$-形式 $\\omega \\in \\Omega^{1}(Q)$ 指定\n$$\n\\omega \\;=\\; (1 + x y)\\, d\\theta \\;-\\; x\\, dy \\;+\\; y\\, dx.\n$$\n这个 $1$-形式定义了一个余维为一的分布 $\\mathcal{D} = \\ker \\omega \\subset TQ$。在非完整约化理论的背景下，$\\mathcal{D}$ 的可积性（即约束是否为完整的）由 Frobenius 对余维一分布的判据决定：该分布是可积的当且仅当 $\\omega \\wedge d\\omega = 0$。\n\n从外代数的第一性原理出发，计算外导数 $d\\omega$，然后计算 $3$-形式 $\\omega \\wedge d\\omega$。将 $\\omega \\wedge d\\omega$ 表示为一个标量函数乘以典范体积形式 $dx \\wedge dy \\wedge d\\theta$，即\n$$\n\\omega \\wedge d\\omega \\;=\\; f(x,y,\\theta)\\; dx \\wedge dy \\wedge d\\theta.\n$$\n你的任务是确定标量系数 $f(x,y,\\theta)$。将这个单一标量函数作为你的最终答案。如果系数是常数，请提供其常数值。无需四舍五入。",
            "solution": "本题要求对于构型流形 $Q = \\mathbb{R}^{3}$（坐标为 $(x,y,\\theta)$）上给定的 $1$-形式 $\\omega$，计算表达式 $\\omega \\wedge d\\omega = f(x,y,\\theta)\\; dx \\wedge dy \\wedge d\\theta$ 中的标量函数 $f(x,y,\\theta)$。\n\n首先对问题进行验证。\n- **已知条件**：\n  - 构型流形 $Q = \\mathbb{R}^{3}$，坐标为 $(x,y,\\theta)$。\n  - 一个 $1$-形式 $\\omega = (1 + x y)\\, d\\theta - x\\, dy + y\\, dx$。\n  - 目标是找到标量函数 $f(x,y,\\theta)$，使得 $\\omega \\wedge d\\omega = f(x,y,\\theta)\\; dx \\wedge dy \\wedge d\\theta$。\n- **验证**：\n  - 该问题具有科学依据，使用了外代数和微分几何中的标准定义和运算（外导数、楔积）。\n  - 该问题是适定的，因为对给定形式计算外导数和楔积会产生唯一的结果。\n  - 语言客观、精确。\n  - 该问题是自洽的，并提供了所有必要的信息。\n  - 其背景，即非完整约化理论和 Frobenius 判据，是恰当且相关的。\n- **结论**：该问题有效，且有唯一解。\n\n我们开始求解。给定的 $1$-形式为：\n$$\n\\omega = (1 + x y)\\, d\\theta - x\\, dy + y\\, dx\n$$\n为使计算清晰，我们根据基 $1$-形式 $dx, dy, d\\theta$ 重新排列各项：\n$$\n\\omega = y\\, dx - x\\, dy + (1 + xy)\\, d\\theta\n$$\n这个 $1$-形式可以写成 $\\omega = \\omega_x\\, dx + \\omega_y\\, dy + \\omega_\\theta\\, d\\theta$，其中分量函数为：\n$$\n\\omega_x = y, \\quad \\omega_y = -x, \\quad \\omega_\\theta = 1 + xy\n$$\n\n第一步是计算 $\\omega$ 的外导数，记为 $d\\omega$。对于 $\\mathbb{R}^{3}$ 上的一个 $1$-形式，其外导数是一个 $2$-形式，由通用公式给出：\n$$\nd\\omega = d(\\omega_x) \\wedge dx + d(\\omega_y) \\wedge dy + d(\\omega_\\theta) \\wedge d\\theta\n$$\n我们计算每个分量函数的外导数：\n$$\nd(\\omega_x) = d(y) = \\frac{\\partial y}{\\partial x}dx + \\frac{\\partial y}{\\partial y}dy + \\frac{\\partial y}{\\partial \\theta}d\\theta = 0\\cdot dx + 1\\cdot dy + 0\\cdot d\\theta = dy\n$$\n$$\nd(\\omega_y) = d(-x) = \\frac{\\partial (-x)}{\\partial x}dx + \\frac{\\partial (-x)}{\\partial y}dy + \\frac{\\partial (-x)}{\\partial \\theta}d\\theta = -1\\cdot dx + 0\\cdot dy + 0\\cdot d\\theta = -dx\n$$\n$$\nd(\\omega_\\theta) = d(1+xy) = \\frac{\\partial (1+xy)}{\\partial x}dx + \\frac{\\partial (1+xy)}{\\partial y}dy + \\frac{\\partial (1+xy)}{\\partial \\theta}d\\theta = y\\cdot dx + x\\cdot dy + 0\\cdot d\\theta = y\\,dx + x\\,dy\n$$\n现在，将这些代入 $d\\omega$ 的表达式。我们使用楔积是幂零的性质，即对于任何基 $1$-形式 $d\\alpha$，$d\\alpha \\wedge d\\alpha = 0$。\n$$\nd\\omega = (dy) \\wedge dx + (-dx) \\wedge dy + (y\\,dx + x\\,dy) \\wedge d\\theta\n$$\n使用楔积的反交换性，特别是 $dy \\wedge dx = -dx \\wedge dy$，并对最后一项进行分配：\n$$\nd\\omega = (-dx \\wedge dy) + (-dx \\wedge dy) + y\\,dx \\wedge d\\theta + x\\,dy \\wedge d\\theta\n$$\n合并同类项，我们得到 $2$-形式 $d\\omega$：\n$$\nd\\omega = -2\\,dx \\wedge dy + y\\,dx \\wedge d\\theta + x\\,dy \\wedge d\\theta\n$$\n\n第二步是计算 $\\omega$ 和 $d\\omega$ 的楔积。这将得到一个 $3$-形式。\n$$\n\\omega \\wedge d\\omega = \\left( y\\, dx - x\\, dy + (1 + xy)\\, d\\theta \\right) \\wedge \\left( -2\\,dx \\wedge dy + y\\,dx \\wedge d\\theta + x\\,dy \\wedge d\\theta \\right)\n$$\n我们展开这个乘积。任何包含重复基 $1$-形式（例如 $dx \\wedge dx$）的项都将为零。唯一非零的贡献将是那些产生 $dx \\wedge dy \\wedge d\\theta$ 的排列的项。我们可以分别计算 $\\omega$ 的每个部分的贡献：\n1. 来自 $\\omega$ 的 $dx$ 项的贡献：\n   $(y\\,dx)$ 与 $d\\omega$ 的楔积仅当与 $dy \\wedge d\\theta$ 分量进行楔积时才会产生非零项。\n   $$\n   (y\\,dx) \\wedge (x\\,dy \\wedge d\\theta) = yx\\,(dx \\wedge dy \\wedge d\\theta)\n   $$\n2. 来自 $\\omega$ 的 $dy$ 项的贡献：\n   $(-x\\,dy)$ 与 $d\\omega$ 的楔积仅当与 $dx \\wedge d\\theta$ 分量进行楔积时才会产生非零项。\n   $$\n   (-x\\,dy) \\wedge (y\\,dx \\wedge d\\theta) = -xy\\,(dy \\wedge dx \\wedge d\\theta)\n   $$\n   使用 $dy \\wedge dx = -dx \\wedge dy$，我们有 $dy \\wedge dx \\wedge d\\theta = -dx \\wedge dy \\wedge d\\theta$。\n   $$\n   -xy\\,(-dx \\wedge dy \\wedge d\\theta) = xy\\,(dx \\wedge dy \\wedge d\\theta)\n   $$\n3. 来自 $\\omega$ 的 $d\\theta$ 项的贡献：\n   $((1+xy)\\,d\\theta)$ 与 $d\\omega$ 的楔积仅当与 $dx \\wedge dy$ 分量进行楔积时才会产生非零项。\n   $$\n   ((1+xy)\\,d\\theta) \\wedge (-2\\,dx \\wedge dy) = -2(1+xy)\\,(d\\theta \\wedge dx \\wedge dy)\n   $$\n   使用循环置换性质 $d\\theta \\wedge dx \\wedge dy = dx \\wedge dy \\wedge d\\theta$。\n   $$\n   -2(1+xy)\\,(dx \\wedge dy \\wedge d\\theta) = (-2 - 2xy)\\,(dx \\wedge dy \\wedge d\\theta)\n   $$\n现在，我们对这三项贡献求和，以找到总的 $3$-形式 $\\omega \\wedge d\\omega$：\n$$\n\\omega \\wedge d\\omega = \\left( xy + xy + (-2 - 2xy) \\right) dx \\wedge dy \\wedge d\\theta\n$$\n$$\n\\omega \\wedge d\\omega = (2xy - 2 - 2xy) dx \\wedge dy \\wedge d\\theta\n$$\n$$\n\\omega \\wedge d\\omega = -2\\,dx \\wedge dy \\wedge d\\theta\n$$\n通过将此结果与所需形式 $\\omega \\wedge d\\omega = f(x,y,\\theta)\\; dx \\wedge dy \\wedge d\\theta$ 进行比较，我们可以确定标量系数 $f(x,y,\\theta)$。\n$$\nf(x,y,\\theta) = -2\n$$\n该函数为常数。根据 Frobenius 定理，由于 $\\omega \\wedge d\\omega \\neq 0$，分布 $\\mathcal{D} = \\ker\\omega$ 是不可积的，该约束是真正的非完整约束。",
            "answer": "$$\n\\boxed{-2}\n$$"
        },
        {
            "introduction": "掌握了如何识别非完整约束之后，下一步便是分析其动力学行为。Suslov 刚体是研究非完整系统的一个经典范例，它清晰地展示了约束如何影响系统的演化。本练习  引导您超越仅仅建立运动方程的层面，要求您将动力学约化到约束所定义的子流形上，并研究由此产生的约化动力学系统的性质。通过计算约化向量场的散度来判断系统是否存在一个不变测度，这是理解非完整系统长期行为和遍历性质的关键一步。",
            "id": "3759687",
            "problem": "考虑 Suslov 刚体，这是一个具有固定点的刚体，在特殊正交群 (SO(3)) 上演化，其体角速度为 $\\Omega \\in \\mathbb{R}^{3}$，惯性张量为 $\\mathbb{I}$（一个对称正定的 $3 \\times 3$ 矩阵）。施加非完整 Suslov 约束 $a \\cdot \\Omega = 0$，其中 $a = e_{3}$ 是体坐标系中的一个固定单位向量。假设惯性张量在基 $(e_{1},e_{2},e_{3})$ 中是对角的，即 $\\mathbb{I} = \\mathrm{diag}(I_{1},I_{2},I_{3})$，并且刚体在垂直于 $a$ 的平面上具有惯性不对称性，即 $I_{1} \\neq I_{2}$，其中 $I_{1}, I_{2}, I_{3} > 0$。\n\n从刚体动力学的第一性原理出发，使用带有执行约束的非完整反作用力的欧拉方程，即\n$$\n\\mathbb{I}\\,\\dot{\\Omega} = \\mathbb{I}\\,\\Omega \\times \\Omega + \\lambda\\, a,\n$$\n其中 $\\lambda$ 是执行约束 $a \\cdot \\Omega = 0$ 的拉格朗日乘子，并结合约束相容性条件 $\\frac{d}{dt}(a \\cdot \\Omega) = 0$。将动力学约化到约束子流形 $\\{\\Omega \\in \\mathbb{R}^{3} \\mid \\Omega_{3} = 0\\}$ 上，并获得在坐标为 $(\\Omega_{1},\\Omega_{2})$ 的平面上的诱导约化向量场 $X(\\Omega_{1},\\Omega_{2})$。\n\n使用 $\\mathbb{R}^{2}$ 上向量场的标准散度定义，\n$$\n\\mathrm{div}\\, X = \\frac{\\partial X_{1}}{\\partial \\Omega_{1}} + \\frac{\\partial X_{2}}{\\partial \\Omega_{2}},\n$$\n计算约化 Suslov 向量场关于 $(\\Omega_{1},\\Omega_{2})$ 平面上的勒贝格面积形式的散度。根据你的计算，判断该系统在其约化空间上是否承认一个不变测度，并从第一性原理证明你的结论。\n\n将你的最终答案表示为在所述假设下获得的散度 $\\mathrm{div}\\, X(\\Omega_{1},\\Omega_{2})$ 的明确值。无需四舍五入。",
            "solution": "该问题要求计算 Suslov 刚体约化向量场的散度。我们首先对问题陈述进行严格的验证。\n\n### 步骤1：提取已知条件\n-   系统：具有固定点的 Suslov 刚体。\n-   位形空间：特殊正交群，$SO(3)$。\n-   状态变量：体角速度，$\\Omega \\in \\mathbb{R}^{3}$。\n-   惯性张量：$\\mathbb{I}$，一个对称正定的 $3 \\times 3$ 矩阵，在体坐标系基 $(e_{1},e_{2},e_{3})$ 中是对角的，$\\mathbb{I} = \\mathrm{diag}(I_{1},I_{2},I_{3})$ 且 $I_{1}, I_{2}, I_{3} > 0$。\n-   惯性不对称性：$I_{1} \\neq I_{2}$。\n-   非完整约束：$a \\cdot \\Omega = 0$，其中 $a = e_{3}$ 是体坐标系中的一个固定单位向量。\n-   运动方程：$\\mathbb{I}\\,\\dot{\\Omega} = \\mathbb{I}\\,\\Omega \\times \\Omega + \\lambda\\, a$，其中 $\\lambda$ 是一个拉格朗日乘子。\n-   约束相容性：$\\frac{d}{dt}(a \\cdot \\Omega) = 0$。\n-   任务：将动力学约化到约束子流形 $\\{\\Omega \\in \\mathbb{R}^{3} \\mid \\Omega_{3} = 0\\}$，找到约化向量场 $X(\\Omega_{1},\\Omega_{2})$，并计算其散度 $\\mathrm{div}\\, X = \\frac{\\partial X_{1}}{\\partial \\Omega_{1}} + \\frac{\\partial X_{2}}{\\partial \\Omega_{2}}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题陈述具有科学依据，描述了非完整力学中的一个标准问题。所提供的方程、约束和定义均为几何力学领域的标准内容。所有必要的数据均已提供。符号 $\\mathbb{I}\\,\\Omega \\times \\Omega$ 略有歧义；标准运算符优先级会意味着 $\\mathbb{I}(\\Omega \\times \\Omega)$，其值为零。然而，在刚体动力学的语境中，此项普遍代表陀螺力矩 $(\\mathbb{I}\\Omega) \\times \\Omega$。假设采用这种标准的物理解释，该问题是适定的、客观的、完整的和一致的。它没有违反任何科学原理，是其领域内一个可形式化的问题。\n\n### 步骤3：结论与行动\n根据对刚体欧拉方程的标准解释，该问题被认为是**有效的**。我们将继续进行求解。\n\n### 求解推导\nSuslov 刚体的运动方程由带有约束力的欧拉-庞加莱方程给出：\n$$\n\\mathbb{I}\\,\\dot{\\Omega} = (\\mathbb{I}\\Omega) \\times \\Omega + \\lambda\\, a\n$$\n在这里，我们将项 $\\mathbb{I}\\,\\Omega \\times \\Omega$ 解释为 $(\\mathbb{I}\\Omega) \\times \\Omega$，它代表由物体旋转引起的内力矩。向量 $\\Omega$ 的分量为 $(\\Omega_{1}, \\Omega_{2}, \\Omega_{3})$，惯性张量为 $\\mathbb{I} = \\mathrm{diag}(I_{1}, I_{2}, I_{3})$，约束向量为 $a = e_{3} = (0, 0, 1)^T$。\n\n以分量形式表示，方程组为：\n$$\n\\begin{pmatrix} I_{1}\\dot{\\Omega}_{1} \\\\ I_{2}\\dot{\\Omega}_{2} \\\\ I_{3}\\dot{\\Omega}_{3} \\end{pmatrix} = \\begin{pmatrix} I_{1}\\Omega_{1} \\\\ I_{2}\\Omega_{2} \\\\ I_{3}\\Omega_{3} \\end{pmatrix} \\times \\begin{pmatrix} \\Omega_{1} \\\\ \\Omega_{2} \\\\ \\Omega_{3} \\end{pmatrix} + \\lambda \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n计算叉积 $(\\mathbb{I}\\Omega) \\times \\Omega$：\n$$\n(\\mathbb{I}\\Omega) \\times \\Omega = \\begin{pmatrix} (I_{2}-I_{3})\\Omega_{2}\\Omega_{3} \\\\ (I_{3}-I_{1})\\Omega_{3}\\Omega_{1} \\\\ (I_{1}-I_{2})\\Omega_{1}\\Omega_{2} \\end{pmatrix}\n$$\n这给出了方程组：\n1. $I_{1}\\dot{\\Omega}_{1} = (I_{2}-I_{3})\\Omega_{2}\\Omega_{3}$\n2. $I_{2}\\dot{\\Omega}_{2} = (I_{3}-I_{1})\\Omega_{3}\\Omega_{1}$\n3. $I_{3}\\dot{\\Omega}_{3} = (I_{1}-I_{2})\\Omega_{1}\\Omega_{2} + \\lambda$\n\n拉格朗日乘子 $\\lambda$ 由约束相容性条件 $\\frac{d}{dt}(a \\cdot \\Omega) = 0$ 确定。由于 $a=e_{3}$ 在体坐标系中是固定的，其在此坐标系中的时间导数为零，因此条件变为 $a \\cdot \\dot{\\Omega} = 0$，即 $\\dot{\\Omega}_{3}=0$。\n\n我们可以通过将此条件施加于第三个运动方程来求解 $\\lambda$。然而，一个更基本的方法是先求解 $\\dot{\\Omega}$，然后应用该条件。从主方程，我们有：\n$$\n\\dot{\\Omega} = \\mathbb{I}^{-1} \\left( (\\mathbb{I}\\Omega) \\times \\Omega + \\lambda a \\right)\n$$\n其中 $\\mathbb{I}^{-1} = \\mathrm{diag}(1/I_1, 1/I_2, 1/I_3)$。应用条件 $a \\cdot \\dot{\\Omega} = 0$：\n$$\na \\cdot \\left[ \\mathbb{I}^{-1} \\left( (\\mathbb{I}\\Omega) \\times \\Omega + \\lambda a \\right) \\right] = 0\n$$\n$$\na \\cdot \\mathbb{I}^{-1}((\\mathbb{I}\\Omega) \\times \\Omega) + \\lambda (a \\cdot \\mathbb{I}^{-1}a) = 0\n$$\n我们计算这两项：\n$$\na \\cdot \\mathbb{I}^{-1}a = e_{3} \\cdot \\mathrm{diag}(1/I_{1}, 1/I_{2}, 1/I_{3}) e_{3} = e_{3} \\cdot (0, 0, 1/I_{3})^T = \\frac{1}{I_{3}}\n$$\n$$\na \\cdot \\mathbb{I}^{-1}((\\mathbb{I}\\Omega) \\times \\Omega) = e_{3} \\cdot \\begin{pmatrix} (I_{2}-I_{3})\\Omega_{2}\\Omega_{3}/I_{1} \\\\ (I_{3}-I_{1})\\Omega_{3}\\Omega_{1}/I_{2} \\\\ (I_{1}-I_{2})\\Omega_{1}\\Omega_{2}/I_{3} \\end{pmatrix} = \\frac{I_{1}-I_{2}}{I_{3}}\\Omega_{1}\\Omega_{2}\n$$\n将这些代回关于 $\\lambda$ 的方程中：\n$$\n\\frac{I_{1}-I_{2}}{I_{3}}\\Omega_{1}\\Omega_{2} + \\lambda \\frac{1}{I_{3}} = 0 \\implies \\lambda = -(I_{1}-I_{2})\\Omega_{1}\\Omega_{2}\n$$\n问题要求的是在约束子流形（即由约束 $a \\cdot \\Omega = \\Omega_3 = 0$ 定义的平面）上的约化动力学。约化向量场 $X(\\Omega_1, \\Omega_2)$ 由在该子流形上求值的 $\\dot{\\Omega}_{1}$ 和 $\\dot{\\Omega}_{2}$ 的表达式给出。\n$$\nX(\\Omega_1, \\Omega_2) = (\\dot{\\Omega}_{1}, \\dot{\\Omega}_{2})|_{\\Omega_3=0}\n$$\n$\\dot{\\Omega}_{1}$ 和 $\\dot{\\Omega}_{2}$ 的方程为：\n$$\n\\dot{\\Omega}_{1} = \\frac{I_{2}-I_{3}}{I_{1}}\\Omega_{2}\\Omega_{3}\n$$\n$$\n\\dot{\\Omega}_{2} = \\frac{I_{3}-I_{1}}{I_{2}}\\Omega_{3}\\Omega_{1}\n$$\n将约束 $\\Omega_3 = 0$ 代入这些方程，我们得到约化向量场的分量：\n$$\nX_1(\\Omega_1, \\Omega_2) = \\frac{I_{2}-I_{3}}{I_{1}}\\Omega_{2}(0) = 0\n$$\n$$\nX_2(\\Omega_1, \\Omega_2) = \\frac{I_{3}-I_{1}}{I_{2}}(0)\\Omega_{1} = 0\n$$\n因此，在 $(\\Omega_{1}, \\Omega_{2})$ 平面上的约化向量场是零向量场：\n$$\nX(\\Omega_{1}, \\Omega_{2}) = (0, 0)\n$$\n根据定义，该向量场的散度为：\n$$\n\\mathrm{div}\\, X = \\frac{\\partial X_{1}}{\\partial \\Omega_{1}} + \\frac{\\partial X_{2}}{\\partial \\Omega_{2}} = \\frac{\\partial (0)}{\\partial \\Omega_{1}} + \\frac{\\partial (0)}{\\partial \\Omega_{2}} = 0 + 0 = 0\n$$\n散度为零的事实，根据 Liouville 定理，意味着约化系统的流保持勒贝格面积形式 $d\\Omega_{1} \\wedge d\\Omega_{2}$ 不变。因此，该系统在其约化空间上承认一个不变测度，且该测度就是平面上的标准面积元。问题中复杂的设定，包括不对称性 $I_{1} \\neq I_{2}$，导致了在速度空间 $(\\Omega_1, \\Omega_2)$ 中的平凡约化动力学，尽管在 $SO(3)$ 中的完整动力学将表现出非平凡的漂移或“和乐”。然而，问题只关心速度平面上约化向量场的散度。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "非完整系统的几何表述揭示了一种深刻的代数结构——非完整括号，它取代了哈密顿力学中的标准泊松括号。该括号的结构函数直接反映了约束分布的“曲率”，正是这种曲率导致了系统独特的运动学漂移或完整性缺失效应。本练习  是一个综合性实践，它将抽象的几何理论（如李括号和度量投影）与具体的算法实现联系起来。通过为经典的滚动圆盘等系统编写代码来计算非完整括号，您将深刻理解非完整系统的几何根源，并掌握将理论转化为计算工具的核心技能。",
            "id": "3759692",
            "problem": "考虑一个力学系统，其位形流形由光滑流形的乘积给出，建模为具有$n$个局部坐标$q = (q^1,\\dots,q^n)$的坐标卡。设拉格朗日量为力学类型$L(q,\\dot{q}) = \\tfrac{1}{2} \\dot{q}^{\\mathsf{T}} M(q) \\dot{q} - V(q)$，其中$M(q)$是一个正定质量矩阵，$V(q)$是一个势。存在等级为常数$m$的线性非完整（速度相关，不可积）约束$A(q) \\dot{q} = 0$，定义了维数为$d = n - m$的约束分布$\\mathcal{D}(q) = \\ker A(q) \\subset T_q Q$。假设存在二维特殊欧几里得群$\\operatorname{SE(2)}$或其子群的自由且正规的对称群作用，且约束和拉格朗日量在该对称性下不变。\n\n定义一个张成$\\mathcal{D}(q)$的局部向量场基$\\{X_i(q)\\}_{i=1}^d$，其中每个$X_i(q)$在坐标基下表示为$X_i(q) = \\sum_{k=1}^n X_i^k(q) \\tfrac{\\partial}{\\partial q^k}$。用$[X_i,X_j]$表示向量场的李括号。与该分布和对称性相关的形状空间余切丛上的约化非完整括号，可以用由$[X_i,X_j]$在由$M(q)$给出的动能度量下到$\\mathcal{D}(q)$上的投影所定义的结构函数$c_{ij}^k(q)$来表示。具体来说，设$P_{\\mathcal{D}}(q)$是到$\\mathcal{D}(q)$上的度量正交投影算子，并通过方程$P_{\\mathcal{D}}(q)[X_i,X_j] = \\sum_{k=1}^d c_{ij}^k(q) X_k(q)$来定义$c_{ij}^k(q)$。那么，与标架$\\{X_i\\}$相适应的准坐标$(q^i,p_i)$上的殆泊松非完整括号由以下公式给出：\n- $\\{q^i,q^j\\}_{\\mathrm{nh}} = 0$,\n- $\\{q^i,p_j\\}_{\\mathrm{nh}} = \\delta^i_j$,\n- $\\{p_i,p_j\\}_{\\mathrm{nh}} = -\\sum_{k=1}^d c_{ij}^k(q) p_k$,\n其中$\\delta^i_j$是克罗内克δ。\n\n您的任务是设计并实现一个算法，该算法在给定约束基$\\{X_i\\}$、质量矩阵$M(q)$以及指示哪些坐标被约化掉的对称性数据的情况下，通过微分和投影符号化地计算约化的非完整括号结构函数$c_{ij}^k(q)$，并在指定状态下对其求值。您必须在通过平面平移约化的滚动圆盘示例上验证该算法，其位形为$q = (x,y,\\theta,\\phi)$，其中$x$和$y$是平面坐标，$\\theta$是朝向角，$\\phi$是自旋角，两个角度都以弧度为单位。无滑动约束由分布基编码\n$$\nX_1(q) = \\frac{\\partial}{\\partial \\theta},\\quad\nX_2(q) = \\frac{\\partial}{\\partial \\phi} + R \\cos(\\theta) \\frac{\\partial}{\\partial x} + R \\sin(\\theta) \\frac{\\partial}{\\partial y},\n$$\n该基在平面平移（$\\operatorname{SE(2)}$的对称子群，其作用方式为$(x,y) \\mapsto (x+a,y+b)$，其中$(a,b)\\in\\mathbb{R}^2$）下不变。使用对角质量矩阵$M(q) = \\operatorname{diag}(m_x,m_y,I_\\theta,I_\\phi)$，其中$m_x$、$m_y$、$I_\\theta$、$I_\\phi$为正常数，半径$R>0$。平移对称性约化后的括号限制在形状变量$(\\theta,\\phi)$及其相关动量$(p_\\theta,p_\\phi)$上。\n\n算法要求：\n- 将每个基向量场$X_i(q)$表示为其坐标分量$X_i^k(q)$及其对所有指标$k,\\ell$的雅可比矩阵$\\partial X_i^k / \\partial q^\\ell$。\n- 使用定义$[X_i,X_j]^k(q) = \\sum_{\\ell=1}^n \\left( X_i^\\ell(q) \\frac{\\partial X_j^k}{\\partial q^\\ell}(q) - X_j^\\ell(q) \\frac{\\partial X_i^k}{\\partial q^\\ell}(q) \\right)$计算李括号$[X_i,X_j]$。\n- 使用到$\\operatorname{span}\\{X_1(q),\\dots,X_d(q)\\}$上的$M(q)$-正交投影算子，将$[X_i,X_j]$投影到由$M(q)$诱导的动能度量下的$\\mathcal{D}(q)$上：\n$$\nP_{\\mathcal{D}}(q) = X(q) \\left(X(q)^{\\mathsf{T}} M(q) X(q)\\right)^{-1} X(q)^{\\mathsf{T}} M(q),\n$$\n其中$X(q)$是以向量$X_i(q)$为列的$n\\times d$矩阵。\n- 使用度量格拉姆矩阵$G(q) = X(q)^{\\mathsf{T}} M(q) X(q)$和内积，从恒等式$P_{\\mathcal{D}}(q)[X_i,X_j] = \\sum_{k=1}^d c_{ij}^k(q) X_k(q)$求解系数$c_{ij}^k(q)$，方法是将投影在基$\\{X_k(q)\\}$中表示出来：\n$$\nc_{ij}(q) = G(q)^{-1} X(q)^{\\mathsf{T}} M(q) [X_i,X_j](q),\n$$\n其中$c_{ij}(q)$是分量为$c_{ij}^k(q)$的$d$维向量。\n\n关于物理单位和角度的说明：\n- 所有角度必须以弧度为单位。\n- 质量矩阵项$m_x$、$m_y$的单位为千克，$I_\\theta$、$I_\\phi$是转动惯量，单位为千克-米平方，$R$的单位为米。由于输出是无量纲的结构函数$c_{ij}^k(q)$，您无需在输出中缩放单位。\n\n测试套件：\n- 案例1（滚动圆盘，基准）：$R = 1$, $m_x = 1$, $m_y = 1$, $I_\\theta = 1$, $I_\\phi = 1$, 状态$q = (x,y,\\theta,\\phi) = (0,0,0,0)$。\n- 案例2（滚动圆盘，非平凡角度）：$R = 1$, $m_x = 2$, $m_y = 3$, $I_\\theta = 0.5$, $I_\\phi = 0.75$, 状态$q = (x,y,\\theta,\\phi) = (1,-1,\\pi/4,1)$。\n- 案例3（$\\mathbb{R}^2$上的玩具非完整标架）：$q = (q^1,q^2)$, $X_1 = \\tfrac{\\partial}{\\partial q^1}$, $X_2 = \\mathrm{e}^{q^1} \\tfrac{\\partial}{\\partial q^2}$, $M = \\operatorname{diag}(1,1)$, 状态$q = (0,0)$。\n- 案例4（$\\mathbb{R}^2$上带耦合的玩具非完整标架）：$q = (q^1,q^2)$, $X_1 = \\tfrac{\\partial}{\\partial q^1} + q^2 \\tfrac{\\partial}{\\partial q^2}$, $X_2 = \\tfrac{\\partial}{\\partial q^2}$, $M = \\operatorname{diag}(1,1)$, 状态$q = (0,1)$。\n\n对于每个案例，计算在指定状态下求值的对$\\left(c_{12}^1(q), c_{12}^2(q)\\right)$（使用适合该标架的相应维数$d$）。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个案例报告为包含两个浮点数的列表，并按上述案例顺序排列，例如$[[a_1,b_1],[a_2,b_2],[a_3,b_3],[a_4,b_4]]$。",
            "solution": "我们从一个由拉格朗日量$L(q,\\dot{q}) = \\tfrac{1}{2} \\dot{q}^{\\mathsf{T}} M(q) \\dot{q} - V(q)$和一组等级为常数$m$的线性非完整约束$A(q)\\dot{q} = 0$控制的力学系统开始。这些约束定义了一个维数为$d = n - m$的分布$\\mathcal{D}(q) = \\ker A(q) \\subset T_q Q$。约束在$\\mathcal{D}$上的动力学可以用一个施加约束的投影向量场来表述。为了描述约化的非完整括号，我们采用与张成$\\mathcal{D}$的局部向量场基相适应的准坐标，并使用由动能度量诱导的几何结构。\n\n原理和定义：\n- 余切丛$T^*Q$上的典范辛形式在坐标$(q^i,p_i)$上诱导出典范泊松括号：$\\{q^i,q^j\\} = 0$, $\\{q^i,p_j\\} = \\delta^i_j$, $\\{p_i,p_j\\} = 0$。\n- 在非完整力学中，由于约束的不可积性，产生约束演化的括号是从典范括号修改而来的，它产生了一个殆泊松括号，该括号通常不满足雅可比恒等式，但保留了斜对称性和莱布尼茨法则。\n- 对于分布$\\mathcal{D}$的局部标架$\\{X_i\\}_{i=1}^d$，不可积性由对易子$[X_i,X_j]$捕捉，它们不一定位于$\\mathcal{D}$中。$[X_i,X_j]$中位于$\\mathcal{D}$内的分量决定了准坐标上括号的结构函数$c_{ij}^k$。\n\n令$X_i(q) = \\sum_{k=1}^n X_i^k(q) \\tfrac{\\partial}{\\partial q^k}$为基向量场。李括号通过以下方式计算：\n$$\n[X_i,X_j]^k(q) = \\sum_{\\ell=1}^n \\left( X_i^\\ell(q) \\frac{\\partial X_j^k}{\\partial q^\\ell}(q) - X_j^\\ell(q) \\frac{\\partial X_i^k}{\\partial q^\\ell}(q) \\right).\n$$\n这源于定义$[X_i,X_j] = X_i \\circ X_j - X_j \\circ X_i$作用于光滑函数并使用坐标表达式。\n\n为了获得准坐标$(q^i,p_i)$上的约化非完整括号，我们使用由$M(q)$诱导的动能内积，即$\\langle u, v \\rangle_{M(q)} = u^{\\mathsf{T}} M(q) v$，来定义$T_q Q$中任意向量到$\\mathcal{D}(q)$上的投影。如果$X(q)$表示以$X_i(q)$为列的$n\\times d$矩阵，那么到$\\operatorname{span}\\{X_1(q),\\dots,X_d(q)\\}$上的正交投影算子是：\n$$\nP_{\\mathcal{D}}(q) = X(q) \\left( X(q)^{\\mathsf{T}} M(q) X(q) \\right)^{-1} X(q)^{\\mathsf{T}} M(q).\n$$\n对于在坐标中表示的任何向量$w \\in T_q Q$，其到分布上的投影是$P_{\\mathcal{D}}(q) w$。特别地，我们通过将$P_{\\mathcal{D}}(q)[X_i,X_j]$写在基$\\{X_k(q)\\}$中来定义系数$c_{ij}^k(q)$。度量格拉姆矩阵$G(q) = X(q)^{\\mathsf{T}} M(q) X(q)$编码了内积$\\langle X_k, X_\\ell \\rangle_{M(q)}$。与基作内积并对格拉姆矩阵求逆可得：\n$$\nc_{ij}(q) = G(q)^{-1} X(q)^{\\mathsf{T}} M(q) [X_i,X_j](q),\n$$\n其中$c_{ij}(q)$是其第$k$个条目为$c_{ij}^k(q)$的$d$维向量。这个表达式是通过求解$P_{\\mathcal{D}}(q)[X_i,X_j]$在基中关于度量的最小二乘表示得出的：由于根据构造，$P_{\\mathcal{D}}(q)[X_i,X_j]$位于$X_k(q)$的张成空间中，我们有$P_{\\mathcal{D}}(q)[X_i,X_j] = X(q) \\alpha$，其中$\\alpha$是某个系数向量。与$X(q)$作$M(q)$-内积得到$X(q)^{\\mathsf{T}} M(q) P_{\\mathcal{D}}(q)[X_i,X_j] = X(q)^{\\mathsf{T}} M(q) X(q) \\alpha$，并且因为$P_{\\mathcal{D}}(q)$在该张成空间上作为恒等算子，左侧即为$X(q)^{\\mathsf{T}} M(q) [X_i,X_j]$。因此，$\\alpha = \\left( X(q)^{\\mathsf{T}} M(q) X(q) \\right)^{-1} X(q)^{\\mathsf{T}} M(q) [X_i,X_j]$，我们将其识别为$c_{ij}(q)$。\n\n那么，与标架相适应的准坐标中的约化非完整括号为：\n- $\\{q^i,q^j\\}_{\\mathrm{nh}} = 0$,\n- $\\{q^i,p_j\\}_{\\mathrm{nh}} = \\delta^i_j$,\n- $\\{p_i,p_j\\}_{\\mathrm{nh}} = -\\sum_{k=1}^d c_{ij}^k(q) p_k$,\n这与标架的非完整性诱导的运动学结构一致。当与形状空间上的约化哈密顿量以及在发生哈密顿化时的适当测度相结合时，这个括号可以再现约束动力学。\n\n算法实现：\n- 将每个$X_i(q)$及其雅可比矩阵$\\partial X_i^k / \\partial q^\\ell$表示为$q$的函数。\n- 使用上面的坐标公式计算$[X_i,X_j](q)$。\n- 构建$X(q)$、$M(q)$、$G(q) = X(q)^{\\mathsf{T}} M(q) X(q)$，并通过$c_{ij}(q) = G(q)^{-1} X(q)^{\\mathsf{T}} M(q) [X_i,X_j](q)$计算$c_{ij}(q)$。\n- 报告每个测试案例的$(c_{12}^1(q), c_{12}^2(q))$。\n\n在滚动圆盘上的验证：\n通过平面平移约化的滚动圆盘使用$q = (x,y,\\theta,\\phi)$和分布基\n$$\nX_1(q) = \\frac{\\partial}{\\partial \\theta},\\quad\nX_2(q) = \\frac{\\partial}{\\partial \\phi} + R \\cos(\\theta) \\frac{\\partial}{\\partial x} + R \\sin(\\theta) \\frac{\\partial}{\\partial y}.\n$$\n计算对易子：$[X_1,X_2] = -R \\sin(\\theta) \\frac{\\partial}{\\partial x} + R \\cos(\\theta) \\frac{\\partial}{\\partial y}$。这个向量，我们记为 $w$，完全位于由“群”变量 $(x,y)$ 张成的空间中。为了计算结构函数 $c_{12}^k$，我们需要计算 $w$ 与基向量 $X_1, X_2$ 关于度量 $M$ 的内积。\n$\\langle w, X_1 \\rangle_{M(q)} = w^{\\mathsf{T}} M X_1 = 0$，因为 $w$ 在 $\\theta, \\phi$ 方向的分量为零，而 $X_1$ 在 $x,y$ 方向的分量为零。\n$\\langle w, X_2 \\rangle_{M(q)} = w^{\\mathsf{T}} M X_2 = [-R\\sin\\theta, R\\cos\\theta, 0, 0] \\begin{pmatrix} m_x & 0 & 0 & 0 \\\\ 0 & m_y & 0 & 0 \\\\ 0 & 0 & I_\\theta & 0 \\\\ 0 & 0 & 0 & I_\\phi \\end{pmatrix} \\begin{pmatrix} R\\cos\\theta \\\\ R\\sin\\theta \\\\ 0 \\\\ 1 \\end{pmatrix} = -m_x R^2 \\sin\\theta\\cos\\theta + m_y R^2 \\sin\\theta\\cos\\theta = R^2 \\sin\\theta\\cos\\theta (m_y - m_x)$。\n这个内积通常不为零，除非圆盘在平面上的惯性是对称的，即 $m_x = m_y$。因此，结构函数 $c_{ij}^k$ 通常不为零。具体来说，$c_{12}^1 = 0$ 因为 $\\langle w, X_1 \\rangle_{M(q)} = 0$，而 $c_{12}^2$ 将与 $\\langle w, X_2 \\rangle_{M(q)}$ 成正比。这就解释了为什么对于具有各向异性质量分布的滚动圆盘，其约化动力学会表现出非平凡的几何效应。对于测试案例1，由于 $m_x=m_y=1$，该内积为零，故 $c_{12}^k=0$。然而对于案例2，由于 $m_x \\neq m_y$，我们将得到一个非零的 $c_{12}^2$ 值，这与提供的代码的计算结果一致。\n\n玩具标架：\n- 对于$\\mathbb{R}^2$上$M = \\operatorname{diag}(1,1)$的$X_1 = \\tfrac{\\partial}{\\partial q^1}$, $X_2 = \\mathrm{e}^{q^1} \\tfrac{\\partial}{\\partial q^2}$，对易子为：\n$$\n[X_1,X_2] = \\frac{\\partial}{\\partial q^1} \\left( \\mathrm{e}^{q^1} \\right) \\frac{\\partial}{\\partial q^2} - 0 = \\mathrm{e}^{q^1} \\frac{\\partial}{\\partial q^2}.\n$$\n到$\\{X_1,X_2\\}$张成空间上的投影就是其自身，在基中表示我们发现$[X_1,X_2] = 0 \\cdot X_1 + 1 \\cdot X_2$，因此对所有$q^1$，$c_{12}^1 = 0$，$c_{12}^2 = 1$。在$q^1 = 0$时，这得到$c_{12}^1(0,0) = 0$，$c_{12}^2(0,0) = 1$。\n- 对于$X_1 = \\tfrac{\\partial}{\\partial q^1} + q^2 \\tfrac{\\partial}{\\partial q^2}$, $X_2 = \\tfrac{\\partial}{\\partial q^2}$，对易子为：\n$$\n[X_1,X_2] = X_1(X_2) - X_2(X_1) = 0 - \\frac{\\partial}{\\partial q^2} (q^2) \\frac{\\partial}{\\partial q^2} = - \\frac{\\partial}{\\partial q^2} = - X_2.\n$$\n因此对所有$q^2$，$c_{12}^1 = 0$，$c_{12}^2 = -1$，在$q^2 = 1$时，我们有$c_{12}^1(0,1) = 0$，$c_{12}^2(0,1) = -1$。\n\n程序中实现的算法遵循了这些推导：\n- 它通过返回$X_i(q)$及其雅可比矩阵的函数来编码每个标架。\n- 它使用动能度量计算对易子和投影。\n- 它使用格拉姆矩阵求解$c_{ij}^k(q)$。\n- 它为指定的测试案例评估所请求的对$\\left(c_{12}^1(q),c_{12}^2(q)\\right)$。\n\n预期输出为：\n- 案例1：$[0.0,0.0]$。\n- 案例2：根据上述推导，代码将计算出一个非零值，约为 $[0.0, 0.1538]$。\n- 案例3：$[0.0,1.0]$。\n- 案例4：$[0.0,-1.0]$。\n\n最终程序以所需的单行格式打印这些结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef lie_bracket(Xi, JXi, Xj, JXj):\n    \"\"\"\n    Compute the Lie bracket [Xi, Xj] in coordinate components.\n    Xi, Xj: vectors of length n representing the components X_i^k(q), X_j^k(q).\n    JXi, JXj: Jacobians of Xi, Xj w.r.t. q, shape (n, n), where entry (k, l) = d X^k / d q^l.\n    Returns: vector w of length n, the components of [Xi, Xj].\n    \"\"\"\n    # [Xi, Xj]^k = sum_l Xi^l * d Xj^k / d q^l - Xj^l * d Xi^k / d q^l\n    # We can implement this via matrix-vector products across columns of Jacobians.\n    # Take columns of JXj: each column l is d Xj / d q^l (vector of length n).\n    # Then sum_l Xi[l] * JXj[:, l] -> n-vector. Similarly for the second term.\n    term1 = JXj @ Xi  # sum_l Xi[l] * JXj[:, l]\n    term2 = JXi @ Xj  # sum_l Xj[l] * JXi[:, l]\n    return term1 - term2\n\ndef project_coefficients(w, X_basis, M):\n    \"\"\"\n    Project the vector w onto the span of columns of X_basis using the M-inner product,\n    and return the coefficients c solving P_D w = sum_k c_k X_k.\n    X_basis: n x d matrix whose columns are the basis vectors X_k(q).\n    M: n x n positive-definite mass matrix.\n    Returns: c: d-vector of coefficients.\n    \"\"\"\n    # Gram matrix G = X^T M X\n    G = X_basis.T @ M @ X_basis\n    # Right-hand side b = X^T M w\n    b = X_basis.T @ M @ w\n    # Solve G c = b\n    c = np.linalg.solve(G, b)\n    return c\n\n# Rolling disk frame on Q=R^2 x S^1 x S^1 with q=(x,y,theta,phi)\ndef rolling_disk_frame(q, R, M_diag):\n    \"\"\"\n    Returns basis vectors X1, X2 and their Jacobians at state q for the rolling disk.\n    q: array-like of length 4: [x, y, theta, phi]\n    R: radius\n    M_diag: diagonal entries of mass matrix [m_x, m_y, I_theta, I_phi]\n    \"\"\"\n    x, y, theta, phi = q\n    n = 4\n    # X1 = d/d theta\n    X1 = np.array([0.0, 0.0, 1.0, 0.0])\n    # Jacobian of X1 is zero (constant components)\n    JX1 = np.zeros((n, n))\n    # X2 = d/d phi + R cos(theta) d/d x + R sin(theta) d/d y\n    X2 = np.array([R * np.cos(theta), R * np.sin(theta), 0.0, 1.0])\n    JX2 = np.zeros((n, n))\n    # Derivatives with respect to theta affect x and y components\n    JX2[0, 2] = -R * np.sin(theta)  # d (R cos theta) / d theta\n    JX2[1, 2] = R * np.cos(theta)   # d (R sin theta) / d theta\n    # Mass matrix M\n    M = np.diag(M_diag)\n    return X1, JX1, X2, JX2, M\n\n# Toy frame 1 on R^2: X1 = d/d q1, X2 = e^{q1} d/d q2\ndef toy_frame_exp(q):\n    \"\"\"\n    q: array-like of length 2: [q1, q2]\n    Returns X1, JX1, X2, JX2, M for toy frame with exponential scaling.\n    \"\"\"\n    q1, q2 = q\n    n = 2\n    X1 = np.array([1.0, 0.0])\n    JX1 = np.zeros((n, n))\n    X2 = np.array([0.0, np.exp(q1)])\n    JX2 = np.zeros((n, n))\n    # d X2^2 / d q1 = e^{q1}\n    JX2[1, 0] = np.exp(q1)\n    M = np.eye(n)\n    return X1, JX1, X2, JX2, M\n\n# Toy frame 2 on R^2: X1 = d/d q1 + q2 d/d q2, X2 = d/d q2\ndef toy_frame_coupled(q):\n    \"\"\"\n    q: array-like of length 2: [q1, q2]\n    Returns X1, JX1, X2, JX2, M for toy frame with coupling.\n    \"\"\"\n    q1, q2 = q\n    n = 2\n    X1 = np.array([1.0, q2])\n    JX1 = np.zeros((n, n))\n    # d X1^2 / d q2 = 1\n    JX1[1, 1] = 1.0\n    X2 = np.array([0.0, 1.0])\n    JX2 = np.zeros((n, n))\n    M = np.eye(n)\n    return X1, JX1, X2, JX2, M\n\ndef compute_c12(frame_data):\n    \"\"\"\n    Given frame data returning (X1, JX1, X2, JX2, M), compute (c12^1, c12^2).\n    \"\"\"\n    X1, JX1, X2, JX2, M = frame_data\n    # Compute commutator [X1, X2]\n    w = lie_bracket(X1, JX1, X2, JX2)\n    # Build basis matrix X = [X1, X2]\n    X_basis = np.column_stack((X1, X2))\n    # Project and get coefficients\n    c12 = project_coefficients(w, X_basis, M)\n    # Return as two floats\n    return float(c12[0]), float(c12[1])\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Case 1: Rolling disk, baseline\n    R1 = 1.0\n    M_diag1 = [1.0, 1.0, 1.0, 1.0]\n    q1 = np.array([0.0, 0.0, 0.0, 0.0])\n    frame1 = rolling_disk_frame(q1, R1, M_diag1)\n\n    # Case 2: Rolling disk, nontrivial angle\n    R2 = 1.0\n    M_diag2 = [2.0, 3.0, 0.5, 0.75]\n    q2 = np.array([1.0, -1.0, np.pi/4.0, 1.0])\n    frame2 = rolling_disk_frame(q2, R2, M_diag2)\n\n    # Case 3: Toy anholonomic frame on R^2\n    q3 = np.array([0.0, 0.0])\n    frame3 = toy_frame_exp(q3)\n\n    # Case 4: Toy anholonomic frame on R^2 with coupling\n    q4 = np.array([0.0, 1.0])\n    frame4 = toy_frame_coupled(q4)\n\n    test_cases = [frame1, frame2, frame3, frame4]\n\n    results = []\n    for frame in test_cases:\n        c1, c2 = compute_c12(frame)\n        # Format each case result as [c1,c2]\n        results.append([c1, c2])\n\n    # Final print statement in the exact required format.\n    # Single line: list of lists\n    print(f\"[{','.join(['[' + ','.join(map(str, r)) + ']' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}