{
    "hands_on_practices": [
        {
            "introduction": "在分析任何非完整系统时，首要步骤是精确描述其速度约束。这些约束共同定义了一个称为约束分布的数学对象。本练习旨在通过具体计算，将代表约束的普法夫（Pfaffian）1-形式，转化为在任意点处允许速度空间的维度（即分布的秩），从而让你掌握刻画非完整约束的基本功。",
            "id": "3759781",
            "problem": "考虑构型流形 $Q=\\mathbb{R}^{4}$，其全局坐标为 $(x,y,z,w)$。一个非完整约束分布 $\\mathcal{D}\\subset TQ$ 由三个 Pfaffian 1-形式的逐点核给出，形式如下\n$$\n\\mathcal{D}(q)\\;=\\;\\bigcap_{a=1}^{3}\\ker\\omega^{a}(q)\\;=\\;\\{\\,v\\in T_{q}Q\\;:\\;\\omega^{a}(q)\\cdot v=0,\\;a=1,2,3\\,\\},\n$$\n其中 Pfaffian 1-形式为\n$$\n\\omega^{1} \\;=\\; \\mathrm{d}x + y\\,\\mathrm{d}z,\\qquad\n\\omega^{2} \\;=\\; \\mathrm{d}y + z\\,\\mathrm{d}w,\\qquad\n\\omega^{3} \\;=\\; x\\,\\mathrm{d}y - y\\,\\mathrm{d}x + \\mathrm{d}z.\n$$\n仅从约束分布是 Pfaffian 1-形式的公共核的定义，以及线性代数中核的维数等于环境维数减去相关线性映射的秩这一事实出发，完成以下任务：\n\n1) 构建与约束相关的线性映射 $W(q):T_{q}Q\\to\\mathbb{R}^{3}$ 及其关于由 $(x,y,z,w)$ 诱导的自然基的矩阵表示。\n\n2) 使用第一性原理，推导一种根据 $\\operatorname{rank}W(q)$ 计算 $\\operatorname{rank}\\mathcal{D}(q)$ 的方法，并确定集合 $\\{\\omega^{1}(q),\\omega^{2}(q),\\omega^{3}(q)\\}$ 是否对所有 $q\\in Q$ 都是逐点线性无关的。\n\n3) 最后，计算分布在点 $q_{0}=(1,2,0,-1)$ 处的秩，并将此秩作为您的最终答案。不需要单位。不要对结果进行四舍五入。",
            "solution": "该问题是有效的，因为它在微分几何和力学方面有科学依据，问题提出得当，客观，并包含唯一解所需的所有必要信息。\n\n该问题要求对构型流形 $Q=\\mathbb{R}^{4}$（坐标为 $(x,y,z,w)$）上的一个非完整约束分布进行三部分分析。在点 $q \\in Q$ 处的分布 $\\mathcal{D}(q)$ 是切空间 $T_qQ$ 的子空间，定义为三个 Pfaffian 1-形式的公共核：$\\omega^{1} = \\mathrm{d}x + y\\,\\mathrm{d}z$，$\\omega^{2} = \\mathrm{d}y + z\\,\\mathrm{d}w$，以及 $\\omega^{3} = x\\,\\mathrm{d}y - y\\,\\mathrm{d}x + \\mathrm{d}z$。\n\n1) 首先，我们构建线性映射 $W(q):T_{q}Q\\to\\mathbb{R}^{3}$ 及其矩阵表示。\n在任意点 $q=(x,y,z,w)$，切空间 $T_{q}Q$ 是一个 4 维向量空间，其自然基由坐标诱导得出，为 $\\{\\frac{\\partial}{\\partial x}|_q, \\frac{\\partial}{\\partial y}|_q, \\frac{\\partial}{\\partial z}|_q, \\frac{\\partial}{\\partial w}|_q\\}$。一个切向量 $v \\in T_qQ$ 可以表示为 $v = v_x \\frac{\\partial}{\\partial x}|_q + v_y \\frac{\\partial}{\\partial y}|_q + v_z \\frac{\\partial}{\\partial z}|_q + v_w \\frac{\\partial}{\\partial w}|_q$，并且可以用 $\\mathbb{R}^4$ 中分量为 $(v_x, v_y, v_z, v_w)$ 的列向量表示。\n约束分布 $\\mathcal{D}(q)$ 是所有 $v \\in T_qQ$ 的集合，满足 $\\omega^{a}(q) \\cdot v = 0$ (对于 $a \\in \\{1,2,3\\}$)。这组条件定义了一个线性映射 $W(q): T_qQ \\to \\mathbb{R}^3$，其核恰好是 $\\mathcal{D}(q)$。该映射由其对向量 $v$ 的作用定义：\n$$\nW(q)(v) = \\begin{pmatrix} \\omega^{1}(q) \\cdot v \\\\ \\omega^{2}(q) \\cdot v \\\\ \\omega^{3}(q) \\cdot v \\end{pmatrix}.\n$$\n为了找到该映射的矩阵表示，我们将 1-形式在对偶基 $\\{\\mathrm{d}x, \\mathrm{d}y, \\mathrm{d}z, \\mathrm{d}w\\}$ 中表示。这些 1-形式的坐标表示构成了矩阵的行，它们是：\n$\\omega^{1} = (1, 0, y, 0)$\n$\\omega^{2} = (0, 1, 0, z)$\n$\\omega^{3} = (-y, x, 1, 0)$\n因此，线性映射 $W(q)$ 的矩阵 $[W(q)]$ 是一个 $3 \\times 4$ 矩阵：\n$$\n[W(q)] = \\begin{pmatrix}\n1  & 0 & y & 0 \\\\\n0 & 1 & 0 & z \\\\\n-y & x & 1 & 0\n\\end{pmatrix}.\n$$\n\n2) 其次，我们推导一种计算 $\\operatorname{rank}\\mathcal{D}(q)$ 的方法，并确定这些形式的线性无关性。\n问题引导我们使用秩-零度定理，该定理指出对于一个线性映射 $F: V \\to U$，有 $\\dim V = \\dim(\\ker F) + \\operatorname{rank}(F)$。这里，线性映射是 $W(q): T_qQ \\to \\mathbb{R}^3$。定义域是 $V = T_qQ$，且 $\\dim(T_qQ)=4$。核是 $\\ker W(q) = \\mathcal{D}(q)$。分布的秩是其维数，即 $\\operatorname{rank}\\mathcal{D}(q) = \\dim(\\mathcal{D}(q))$。映射 $W(q)$ 的秩是其像的维数，这等于其矩阵表示的秩，即 $\\operatorname{rank}W(q) = \\operatorname{rank}[W(q)]$。\n应用秩-零度定理：\n$$\n\\dim(T_qQ) = \\dim(\\mathcal{D}(q)) + \\operatorname{rank}W(q)\n$$\n$$\n4 = \\operatorname{rank}\\mathcal{D}(q) + \\operatorname{rank}[W(q)]\n$$\n这为我们提供了计算分布秩的方法：\n$$\n\\operatorname{rank}\\mathcal{D}(q) = 4 - \\operatorname{rank}[W(q)].\n$$\n1-形式集合 $\\{\\omega^{1}(q),\\omega^{2}(q),\\omega^{3}(q)\\}$ 是逐点线性无关的，当且仅当对于每个 $q$，矩阵 $[W(q)]$ 的行是线性无关的。这等价于条件 $\\operatorname{rank}[W(q)] = 3$。为了检验这一点，我们可以计算 $[W(q)]$ 的一个 $3 \\times 3$ 子矩阵的行列式。考虑由前三列构成的子式：\n$$\n\\det \\begin{pmatrix} 1 & 0 & y \\\\ 0 & 1 & 0 \\\\ -y & x & 1 \\end{pmatrix} = 1(1 \\cdot 1 - 0 \\cdot x) - 0 + y(0 \\cdot x - 1 \\cdot (-y)) = 1 + y^2.\n$$\n因为 $y$ 是一个实坐标，所以 $y^2 \\ge 0$，因此行列式 $1+y^2$ 总是大于或等于 $1$。由于对于任何 $q \\in Q$，该子式永远不为零，所以矩阵 $[W(q)]$ 的秩恒为 $3$。\n因此，1-形式集合 $\\{\\omega^{1}(q),\\omega^{2}(q),\\omega^{3}(q)\\}$ 对所有 $q \\in Q$ 都是逐点线性无关的。\n\n3) 最后，我们计算分布在点 $q_{0}=(1,2,0,-1)$ 处的秩。\n使用推导出的方法，$\\operatorname{rank}\\mathcal{D}(q_0) = 4 - \\operatorname{rank}[W(q_0)]$。我们首先通过代入 $x=1$, $y=2$, 和 $z=0$ 来计算矩阵 $[W(q)]$ 在 $q_0$ 处的值：\n$$\n[W(q_0)] = \\begin{pmatrix}\n1 & 0 & 2 & 0 \\\\\n0 & 1 & 0 & 0 \\\\\n-2 & 1 & 1 & 0\n\\end{pmatrix}.\n$$\n正如在一般性分析中确立的，该矩阵的秩必为 $3$。我们可以通过行化简来验证这一点。\n应用行变换 $R_3 \\to R_3 + 2R_1$：\n$$\n\\begin{pmatrix} 1 & 0 & 2 & 0 \\\\ 0 & 1 & 0 & 0 \\\\ 0 & 1 & 5 & 0 \\end{pmatrix}.\n$$\n应用行变换 $R_3 \\to R_3 - R_2$：\n$$\n\\begin{pmatrix} 1 & 0 & 2 & 0 \\\\ 0 & 1 & 0 & 0 \\\\ 0 & 0 & 5 & 0 \\end{pmatrix}.\n$$\n该矩阵是行阶梯形，并且有三个非零行。因此，$\\operatorname{rank}[W(q_0)] = 3$。\n分布在 $q_0$ 处的秩为：\n$$\n\\operatorname{rank}\\mathcal{D}(q_0) = 4 - 3 = 1.\n$$",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "非完整系统的核心在于其约束的“不可积性”，这将其与等价于位置约束的完整系统区分开来。然而，一个速度约束是否真正不可积需要严格的检验。本练习将引导你运用微分几何中的弗罗贝尼乌斯定理（Frobenius theorem），通过外微分和楔积的计算，为判断一个约束分布是否可积提供一个决定性的判据。",
            "id": "3759769",
            "problem": "考虑构型流形 $Q = \\mathbb{R}^{3}$，其全局坐标为 $(x,y,\\theta)$。设一个非完整速度约束由零化 $1$-形式 $\\omega \\in \\Omega^{1}(Q)$ 指定\n$$\n\\omega \\;=\\; (1 + x y)\\, d\\theta \\;-\\; x\\, dy \\;+\\; y\\, dx.\n$$\n这个 $1$-形式定义了一个余维为一的分布 $\\mathcal{D} = \\ker \\omega \\subset TQ$。在非完整约化理论的背景下，$\\mathcal{D}$ 的可积性（即约束是否为完整的）由 Frobenius 准则对于余维一分布决定：该分布是可积的当且仅当 $\\omega \\wedge d\\omega = 0$。\n\n从外代数的第一性原理出发，计算外导数 $d\\omega$，然后计算 $3$-形式 $\\omega \\wedge d\\omega$。将 $\\omega \\wedge d\\omega$ 表示为一个标量函数乘以典范体积形式 $dx \\wedge dy \\wedge d\\theta$ 的形式，即\n$$\n\\omega \\wedge d\\omega \\;=\\; f(x,y,\\theta)\\; dx \\wedge dy \\wedge d\\theta.\n$$\n你的任务是确定标量系数 $f(x,y,\\theta)$。将此单一标量函数作为你的最终答案报告。如果该系数是常数，请提供其常数值。无需四舍五入。",
            "solution": "该问题要求对于给定的构型流形 $Q = \\mathbb{R}^{3}$（坐标为 $(x,y,\\theta)$）上的 $1$-形式 $\\omega$，计算表达式 $\\omega \\wedge d\\omega = f(x,y,\\theta)\\; dx \\wedge dy \\wedge d\\theta$ 中的标量函数 $f(x,y,\\theta)$。\n\n首先验证该问题。\n- **已知条件**：\n  - 构型流形 $Q = \\mathbb{R}^{3}$，坐标为 $(x,y,\\theta)$。\n  - 一个 $1$-形式 $\\omega = (1 + x y)\\, d\\theta - x\\, dy + y\\, dx$。\n  - 目标是找到标量函数 $f(x,y,\\theta)$，使得 $\\omega \\wedge d\\omega = f(x,y,\\theta)\\; dx \\wedge dy \\wedge d\\theta$。\n- **验证**：\n  - 该问题具有科学依据，使用了外代数和微分几何（外导数、楔积）中的标准定义和运算。\n  - 该问题是适定的，因为对给定形式计算外导数和楔积会产生唯一的结果。\n  - 语言客观且精确。\n  - 该问题是自洽的，并提供了所有必要的信息。\n  - 其背景，即非完整约化理论和 Frobenius 准则，是恰当且相关的。\n- **结论**：该问题有效且存在唯一解。\n\n我们开始求解。给定的 $1$-形式为：\n$$\n\\omega = (1 + x y)\\, d\\theta - x\\, dy + y\\, dx\n$$\n为便于计算，我们根据基 $1$-形式 $dx, dy, d\\theta$ 对各项重新排序：\n$$\n\\omega = y\\, dx - x\\, dy + (1 + xy)\\, d\\theta\n$$\n这个 $1$-形式可以写成 $\\omega = \\omega_x\\, dx + \\omega_y\\, dy + \\omega_\\theta\\, d\\theta$，其中分量函数为：\n$$\n\\omega_x = y, \\quad \\omega_y = -x, \\quad \\omega_\\theta = 1 + xy\n$$\n\n第一步是计算 $\\omega$ 的外导数，记为 $d\\omega$。对于 $\\mathbb{R}^{3}$ 上的一个 $1$-形式，其外导数是一个 $2$-形式，由以下通用公式给出：\n$$\nd\\omega = d(\\omega_x) \\wedge dx + d(\\omega_y) \\wedge dy + d(\\omega_\\theta) \\wedge d\\theta\n$$\n我们计算每个分量函数的外导数：\n$$\nd(\\omega_x) = d(y) = \\frac{\\partial y}{\\partial x}dx + \\frac{\\partial y}{\\partial y}dy + \\frac{\\partial y}{\\partial \\theta}d\\theta = 0\\cdot dx + 1\\cdot dy + 0\\cdot d\\theta = dy\n$$\n$$\nd(\\omega_y) = d(-x) = \\frac{\\partial (-x)}{\\partial x}dx + \\frac{\\partial (-x)}{\\partial y}dy + \\frac{\\partial (-x)}{\\partial \\theta}d\\theta = -1\\cdot dx + 0\\cdot dy + 0\\cdot d\\theta = -dx\n$$\n$$\nd(\\omega_\\theta) = d(1+xy) = \\frac{\\partial (1+xy)}{\\partial x}dx + \\frac{\\partial (1+xy)}{\\partial y}dy + \\frac{\\partial (1+xy)}{\\partial \\theta}d\\theta = y\\cdot dx + x\\cdot dy + 0\\cdot d\\theta = y\\,dx + x\\,dy\n$$\n现在，将这些结果代入 $d\\omega$ 的表达式中。我们使用楔积是幂零的性质，即对于任何基 $1$-形式 $d\\alpha$，$d\\alpha \\wedge d\\alpha = 0$。\n$$\nd\\omega = (dy) \\wedge dx + (-dx) \\wedge dy + (y\\,dx + x\\,dy) \\wedge d\\theta\n$$\n使用楔积的反交换性质，特别是 $dy \\wedge dx = -dx \\wedge dy$，并对最后一项进行分配：\n$$\nd\\omega = (-dx \\wedge dy) + (-dx \\wedge dy) + y\\,dx \\wedge d\\theta + x\\,dy \\wedge d\\theta\n$$\n合并同类项，我们得到 $2$-形式 $d\\omega$：\n$$\nd\\omega = -2\\,dx \\wedge dy + y\\,dx \\wedge d\\theta + x\\,dy \\wedge d\\theta\n$$\n\n第二步是计算 $\\omega$ 和 $d\\omega$ 的楔积。这将得到一个 $3$-形式。\n$$\n\\omega \\wedge d\\omega = \\left( y\\, dx - x\\, dy + (1 + xy)\\, d\\theta \\right) \\wedge \\left( -2\\,dx \\wedge dy + y\\,dx \\wedge d\\theta + x\\,dy \\wedge d\\theta \\right)\n$$\n我们展开这个乘积。任何包含重复基 $1$-形式（例如，$dx \\wedge dx$）的项都将为零。唯一非零的贡献将是那些产生 $dx \\wedge dy \\wedge d\\theta$ 排列的项。我们可以分别计算 $\\omega$ 各部分的贡献：\n1. 来自 $\\omega$ 中 $dx$ 项的贡献：\n   楔积 $(y\\,dx)$ 与 $d\\omega$ 的运算，只有当与 $dy \\wedge d\\theta$ 分量进行楔积时才会产生非零项。\n   $$\n   (y\\,dx) \\wedge (x\\,dy \\wedge d\\theta) = yx\\,(dx \\wedge dy \\wedge d\\theta)\n   $$\n2. 来自 $\\omega$ 中 $dy$ 项的贡献：\n   楔积 $(-x\\,dy)$ 与 $d\\omega$ 的运算，只有当与 $dx \\wedge d\\theta$ 分量进行楔积时才会产生非零项。\n   $$\n   (-x\\,dy) \\wedge (y\\,dx \\wedge d\\theta) = -xy\\,(dy \\wedge dx \\wedge d\\theta)\n   $$\n   使用 $dy \\wedge dx = -dx \\wedge dy$，我们有 $dy \\wedge dx \\wedge d\\theta = -dx \\wedge dy \\wedge d\\theta$。\n   $$\n   -xy\\,(-dx \\wedge dy \\wedge d\\theta) = xy\\,(dx \\wedge dy \\wedge d\\theta)\n   $$\n3. 来自 $\\omega$ 中 $d\\theta$ 项的贡献：\n   楔积 $((1+xy)\\,d\\theta)$ 与 $d\\omega$ 的运算，只有当与 $dx \\wedge dy$ 分量进行楔积时才会产生非零项。\n   $$\n   ((1+xy)\\,d\\theta) \\wedge (-2\\,dx \\wedge dy) = -2(1+xy)\\,(d\\theta \\wedge dx \\wedge dy)\n   $$\n   使用循环置换性质 $d\\theta \\wedge dx \\wedge dy = dx \\wedge dy \\wedge d\\theta$。\n   $$\n   -2(1+xy)\\,(dx \\wedge dy \\wedge d\\theta) = (-2 - 2xy)\\,(dx \\wedge dy \\wedge d\\theta)\n   $$\n现在，我们将这三个贡献相加，得到总的 $3$-形式 $\\omega \\wedge d\\omega$：\n$$\n\\omega \\wedge d\\omega = \\left( xy + xy + (-2 - 2xy) \\right) dx \\wedge dy \\wedge d\\theta\n$$\n$$\n\\omega \\wedge d\\omega = (2xy - 2 - 2xy) dx \\wedge dy \\wedge d\\theta\n$$\n$$\n\\omega \\wedge d\\omega = -2\\,dx \\wedge dy \\wedge d\\theta\n$$\n将此结果与所需形式 $\\omega \\wedge d\\omega = f(x,y,\\theta)\\; dx \\wedge dy \\wedge d\\theta$ 进行比较，我们可以确定标量系数 $f(x,y,\\theta)$。\n$$\nf(x,y,\\theta) = -2\n$$\n该函数是一个常数。根据 Frobenius 定理，由于 $\\omega \\wedge d\\omega \\neq 0$，分布 $\\mathcal{D} = \\ker\\omega$ 是不可积的，且该约束是真正的非完整的。",
            "answer": "$$\n\\boxed{-2}\n$$"
        },
        {
            "introduction": "与哈密顿系统的辛结构不同，非完整系统的动力学具有一种独特的几何结构，其核心由所谓的“非完整括号”（nonholonomic bracket）来描述。这项高级实践将带领你从分析约束本身，跃升到计算这个支配系统约化后可观测量演化的基本代数结构。通过将几何公式转化为具体算法，你将真正把抽象理论与实际计算联系起来。",
            "id": "3759692",
            "problem": "考虑一个力学系统，其位形流形由光滑流形的乘积给出，并被建模为一个具有$n$个局部坐标$q = (q^1,\\dots,q^n)$的坐标卡。设拉格朗日量为力学类型$L(q,\\dot{q}) = \\tfrac{1}{2} \\dot{q}^{\\mathsf{T}} M(q) \\dot{q} - V(q)$，其中$M(q)$是一个正定质量矩阵，$V(q)$是一个势。存在秩为常数$m$的线性非完整（速度相关，不可积）约束$A(q) \\dot{q} = 0$，这些约束定义了约束分布$\\mathcal{D}(q) = \\ker A(q) \\subset T_q Q$，其维度为$d = n - m$。假设存在二维特殊欧几里得群$\\operatorname{SE(2)}$或其子群的自由且正规的对称群作用，且约束和拉格朗日量在该对称性下保持不变。\n\n定义一个张成$\\mathcal{D}(q)$的矢量场的局部基$\\{X_i(q)\\}_{i=1}^d$，其中每个$X_i(q)$在坐标基中表示为$X_i(q) = \\sum_{k=1}^n X_i^k(q) \\tfrac{\\partial}{\\partial q^k}$。用$[X_i,X_j]$表示矢量场的李括号。与该分布和对称性相关的形状空间的余切丛上的约化非完整括号，可以用由$[X_i,X_j]$关于$M(q)$给出的动能度规到$\\mathcal{D}(q)$上的投影所定义的结构函数$c_{ij}^k(q)$来表示。具体来说，设$P_{\\mathcal{D}}(q)$是到$\\mathcal{D}(q)$上的度规正交投影算子，并通过方程$P_{\\mathcal{D}}(q)[X_i,X_j] = \\sum_{k=1}^d c_{ij}^k(q) X_k(q)$定义$c_{ij}^k(q)$。那么，适应于标架$\\{X_i\\}$的准坐标$(q^i,p_i)$上的殆泊松非完整括号由以下给出：\n- $\\{q^i,q^j\\}_{\\mathrm{nh}} = 0$，\n- $\\{q^i,p_j\\}_{\\mathrm{nh}} = \\delta^i_j$，\n- $\\{p_i,p_j\\}_{\\mathrm{nh}} = -\\sum_{k=1}^d c_{ij}^k(q) p_k$，\n其中$\\delta^i_j$是克罗内克δ。\n\n你的任务是设计并实现一个算法，在给定约束基$\\{X_i\\}$、质量矩阵$M(q)$以及指示哪些坐标被约化掉的对称性数据的情况下，通过符号微分和投影来计算约化的非完整括号结构函数$c_{ij}^k(q)$，并在指定状态下对其求值。你必须在通过平面平移进行约化的滚盘例子上验证该算法，其中位形为$q = (x,y,\\theta,\\phi)$，$x$和$y$是平面坐标，$\\theta$是朝向角，$\\phi$是自旋角，两个角度均以弧度为单位。无滑移约束由分布基\n$$\nX_1(q) = \\frac{\\partial}{\\partial \\theta},\\quad\nX_2(q) = \\frac{\\partial}{\\partial \\phi} + R \\cos(\\theta) \\frac{\\partial}{\\partial x} + R \\sin(\\theta) \\frac{\\partial}{\\partial y},\n$$\n编码，该基在平面平移（$\\operatorname{SE(2)}$的对称子群，其作用为$(x,y) \\mapsto (x+a,y+b)$，对于$(a,b)\\in\\mathbb{R}^2$）下保持不变。使用对角质量矩阵$M(q) = \\operatorname{diag}(m_x,m_y,I_\\theta,I_\\phi)$，其中$m_x$，$m_y$，$I_\\theta$，$I_\\phi$为正常数，半径$R>0$。平移对称性约化后的括号限制于形状变量$(\\theta,\\phi)$及其相关的动量$(p_\\theta,p_\\phi)$。\n\n算法要求：\n- 将每个基矢量场$X_i(q)$表示为其坐标分量$X_i^k(q)$及其对所有指标$k,\\ell$的雅可比矩阵$\\partial X_i^k / \\partial q^\\ell$。\n- 使用定义$[X_i,X_j]^k(q) = \\sum_{\\ell=1}^n \\left( X_i^\\ell(q) \\frac{\\partial X_j^k}{\\partial q^\\ell}(q) - X_j^\\ell(q) \\frac{\\partial X_i^k}{\\partial q^\\ell}(q) \\right)$计算李括号$[X_i,X_j]$。\n- 使用由$M(q)$诱导的动能度规，通过到$\\operatorname{span}\\{X_1(q),\\dots,X_d(q)\\}$上的$M(q)$-正交投影算子将$[X_i,X_j]$投影到$\\mathcal{D}(q)$上：\n$$\nP_{\\mathcal{D}}(q) = X(q) \\left(X(q)^{\\mathsf{T}} M(q) X(q)\\right)^{-1} X(q)^{\\mathsf{T}} M(q),\n$$\n其中$X(q)$是列为矢量$X_i(q)$的$n\\times d$矩阵。\n- 通过使用度规格拉姆矩阵$G(q) = X(q)^{\\mathsf{T}} M(q) X(q)$和内积，从恒等式$P_{\\mathcal{D}}(q)[X_i,X_j] = \\sum_{k=1}^d c_{ij}^k(q) X_k(q)$中求解系数$c_{ij}^k(q)$，将投影表示在基$\\{X_k(q)\\}$中：\n$$\nc_{ij}(q) = G(q)^{-1} X(q)^{\\mathsf{T}} M(q) [X_i,X_j](q),\n$$\n其中$c_{ij}(q)$是分量为$c_{ij}^k(q)$的$d$维矢量。\n\n物理单位和角度说明：\n- 所有角度必须以弧度为单位。\n- 质量矩阵项$m_x$，$m_y$的单位是千克，$I_\\theta$，$I_\\phi$是转动惯量，单位是千克-米平方，$R$的单位是米。由于输出是无量纲的结构函数$c_{ij}^k(q)$，你不需要在输出中进行单位换算。\n\n测试套件：\n- 案例1（滚盘，基准）：$R = 1$，$m_x = 1$，$m_y = 1$，$I_\\theta = 1$，$I_\\phi = 1$，状态$q = (x,y,\\theta,\\phi) = (0,0,0,0)$。\n- 案例2（滚盘，非平凡角）：$R = 1$，$m_x = 2$，$m_y = 3$，$I_\\theta = 0.5$，$I_\\phi = 0.75$，状态$q = (x,y,\\theta,\\phi) = (1,-1,\\pi/4,1)$。\n- 案例3（$\\mathbb{R}^2$上的示例性非完整标架）：$q = (q^1,q^2)$，$X_1 = \\tfrac{\\partial}{\\partial q^1}$，$X_2 = \\mathrm{e}^{q^1} \\tfrac{\\partial}{\\partial q^2}$，$M = \\operatorname{diag}(1,1)$，状态$q = (0,0)$。\n- 案例4（$\\mathbb{R}^2$上带耦合的示例性非完整标架）：$q = (q^1,q^2)$，$X_1 = \\tfrac{\\partial}{\\partial q^1} + q^2 \\tfrac{\\partial}{\\partial q^2}$，$X_2 = \\tfrac{\\partial}{\\partial q^2}$，$M = \\operatorname{diag}(1,1)$，状态$q = (0,1)$。\n\n对于每个案例，计算在指定状态下求值的对$\\left(c_{12}^1(q), c_{12}^2(q)\\right)$（使用适用于该标架的相应维度$d$）。你的程序应生成单行输出，包含一个用方括号括起来的、以逗号分隔的结果列表，其中每个案例报告为一个包含两个浮点数的列表，按上述案例顺序排列，例如[[a_1,b_1],[a_2,b_2],[a_3,b_3],[a_4,b_4]]。",
            "solution": "我们从一个由拉格朗日量$L(q,\\dot{q}) = \\tfrac{1}{2} \\dot{q}^{\\mathsf{T}} M(q) \\dot{q} - V(q)$和一组常秩为$m$的线性非完整约束$A(q)\\dot{q} = 0$控制的力学系统开始。这些约束定义了一个维度为$d = n-m$的分布$\\mathcal{D}(q) = \\ker A(q) \\subset T_q Q$。约束到$\\mathcal{D}$上的动力学可以用一个强制执行约束的投影矢量场来表述。为了描述约化的非完整括号，我们采用适应于张成$\\mathcal{D}$的局部矢量场基的准坐标，并使用由动能度规诱导的几何结构。\n\n原理和定义：\n- 余切丛$T^*Q$上的典范辛形式诱导出坐标$(q^i,p_i)$上的典范泊松括号：$\\{q^i,q^j\\} = 0$，$\\{q^i,p_j\\} = \\delta^i_j$，$\\{p_i,p_j\\} = 0$。\n- 在非完整力学中，由于约束的不可积性，产生约束演化的括号是在典范括号的基础上修正得到的，从而产生一个通常不满足雅可比恒等式但保持斜对称性和莱布尼茨法则的殆泊松括号。\n- 对于分布$\\mathcal{D}$的一个局部标架$\\{X_i\\}_{i=1}^d$，不可积性由对易子$[X_i,X_j]$捕获，它不一定位于$\\mathcal{D}$中。$[X_i,X_j]$中位于$\\mathcal{D}$内的分量决定了准坐标上括号的结构函数$c_{ij}^k$。\n\n设$X_i(q) = \\sum_{k=1}^n X_i^k(q) \\tfrac{\\partial}{\\partial q^k}$为基矢量场。李括号通过以下方式计算：\n$$\n[X_i,X_j]^k(q) = \\sum_{\\ell=1}^n \\left( X_i^\\ell(q) \\frac{\\partial X_j^k}{\\partial q^\\ell}(q) - X_j^\\ell(q) \\frac{\\partial X_i^k}{\\partial q^\\ell}(q) \\right).\n$$\n这源于定义$[X_i,X_j] = X_i \\circ X_j - X_j \\circ X_i$作用在光滑函数上并使用坐标表达式。\n\n为了得到适应于该标架的准坐标$(q^i,p_i)$上的约化非完整括号，我们使用由$M(q)$诱导的动能内积，即$\\langle u, v \\rangle_{M(q)} = u^{\\mathsf{T}} M(q) v$，来定义$T_q Q$中任意矢量到$\\mathcal{D}(q)$上的投影。如果$X(q)$表示列为$X_i(q)$的$n\\times d$矩阵，则到$\\operatorname{span}\\{X_1(q),\\dots,X_d(q)\\}$上的正交投影算子为：\n$$\nP_{\\mathcal{D}}(q) = X(q) \\left( X(q)^{\\mathsf{T}} M(q) X(q) \\right)^{-1} X(q)^{\\mathsf{T}} M(q).\n$$\n对于在坐标中表示的任何矢量$w \\in T_q Q$，其到该分布上的投影是$P_{\\mathcal{D}}(q) w$。特别地，我们通过将$P_{\\mathcal{D}}(q)[X_i,X_j]$写在基$\\{X_k(q)\\}$中来定义系数$c_{ij}^k(q)$。度规格拉姆矩阵$G(q) = X(q)^{\\mathsf{T}} M(q) X(q)$编码了内积$\\langle X_k, X_\\ell \\rangle_{M(q)}$。通过与基取内积并对格拉姆矩阵求逆可得：\n$$\nc_{ij}(q) = G(q)^{-1} X(q)^{\\mathsf{T}} M(q) [X_i,X_j](q),\n$$\n其中$c_{ij}(q)$是第$k$个条目为$c_{ij}^k(q)$的$d$维矢量。这个表达式是通过求解$P_{\\mathcal{D}}(q)[X_i,X_j]$在关于度规的基下的最小二乘表示得出的：由于$P_{\\mathcal{D}}(q)[X_i,X_j]$根据构造位于$X_k(q)$的张成空间内，我们有$P_{\\mathcal{D}}(q)[X_i,X_j] = X(q) \\alpha$对于某个系数矢量$\\alpha$成立。与$X(q)$取$M(q)$-内积得到$X(q)^{\\mathsf{T}} M(q) P_{\\mathcal{D}}(q)[X_i,X_j] = X(q)^{\\mathsf{T}} M(q) X(q) \\alpha$。又因为$P_{\\mathcal{D}}(q)$在其张成空间上作为单位算子，左侧即为$X(q)^{\\mathsf{T}} M(q) [X_i,X_j]$。因此，$\\alpha = \\left( X(q)^{\\mathsf{T}} M(q) X(q) \\right)^{-1} X(q)^{\\mathsf{T}} M(q) [X_i,X_j]$，我们将其识别为$c_{ij}(q)$。\n\n适应于该标架的准坐标中的约化非完整括号为：\n- $\\{q^i,q^j\\}_{\\mathrm{nh}} = 0$，\n- $\\{q^i,p_j\\}_{\\mathrm{nh}} = \\delta^i_j$，\n- $\\{p_i,p_j\\}_{\\mathrm{nh}} = -\\sum_{k=1}^d c_{ij}^k(q) p_k$，\n这与标架的非完整性所诱导的运动学结构相一致。当与形状空间上的约化哈密顿量以及（如果发生哈密顿化）适当的测度相结合时，这个括号能再现约束动力学。\n\n算法实现：\n- 将每个$X_i(q)$及其雅可比矩阵$\\partial X_i^k / \\partial q^\\ell$表示为$q$的函数。\n- 使用上述坐标公式计算$[X_i,X_j](q)$。\n- 构造$X(q)$，$M(q)$，$G(q) = X(q)^{\\mathsf{T}} M(q) X(q)$，并通过$c_{ij}(q) = G(q)^{-1} X(q)^{\\mathsf{T}} M(q) [X_i,X_j](q)$计算$c_{ij}(q)$。\n- 报告每个测试案例的$(c_{12}^1(q), c_{12}^2(q))$。\n\n在滚盘上的验证：\n通过平面平移约化的滚盘使用$q = (x,y,\\theta,\\phi)$和分布基\n$$\nX_1(q) = \\frac{\\partial}{\\partial \\theta},\\quad\nX_2(q) = \\frac{\\partial}{\\partial \\phi} + R \\cos(\\theta) \\frac{\\partial}{\\partial x} + R \\sin(\\theta) \\frac{\\partial}{\\partial y}.\n$$\n计算对易子：\n$$\n[X_1,X_2] = X_1(X_2) - X_2(X_1) = -R \\sin(\\theta) \\frac{\\partial}{\\partial x} + R \\cos(\\theta) \\frac{\\partial}{\\partial y},\n$$\n因为唯一非零的导数是$\\tfrac{\\partial}{\\partial \\theta} \\left( R \\cos(\\theta) \\right) = -R \\sin(\\theta)$和$\\tfrac{\\partial}{\\partial \\theta} \\left( R \\sin(\\theta) \\right) = R \\cos(\\theta)$，并且$X_2$在$\\tfrac{\\partial}{\\partial \\phi}$上的系数是常数。为了找到结构函数，我们计算对易子与基矢量的$M$-内积。由于$M$是对角的，且$[X_1, X_2]$和$X_1$分别只在$(x,y)$和$\\theta$方向有分量，$\\langle [X_1,X_2], X_1 \\rangle_{M(q)} = 0$，因此$c_{12}^1(q)=0$。然而，第二个内积通常不为零：$\\langle [X_1,X_2], X_2 \\rangle_{M(q)} = (m_y - m_x)R^2\\sin\\theta\\cos\\theta$。此内积仅当质体的平动质量在$x,y$方向上相等（$m_x=m_y$）时为零。因此，一般情况下$c_{12}^2(q)$不为零，这意味着约化非完整括号不是典范的，$\\{p_\\theta,p_\\phi\\}_{\\mathrm{nh}} \\neq 0$。\n\n示例性标架：\n- 对于$\\mathbb{R}^2$上的$X_1 = \\tfrac{\\partial}{\\partial q^1}$，$X_2 = \\mathrm{e}^{q^1} \\tfrac{\\partial}{\\partial q^2}$和$M = \\operatorname{diag}(1,1)$，对易子为：\n$$\n[X_1,X_2] = \\frac{\\partial}{\\partial q^1} \\left( \\mathrm{e}^{q^1} \\right) \\frac{\\partial}{\\partial q^2} - 0 = \\mathrm{e}^{q^1} \\frac{\\partial}{\\partial q^2}.\n$$\n到$\\{X_1,X_2\\}$张成空间上的投影就是它本身，在基中表示我们发现$[X_1,X_2] = 0 \\cdot X_1 + 1 \\cdot X_2$，因此对于所有$q^1$，$c_{12}^1 = 0$，$c_{12}^2 = 1$。在$q^1 = 0$时，这得到$c_{12}^1(0,0) = 0$，$c_{12}^2(0,0) = 1$。\n- 对于$X_1 = \\tfrac{\\partial}{\\partial q^1} + q^2 \\tfrac{\\partial}{\\partial q^2}$，$X_2 = \\tfrac{\\partial}{\\partial q^2}$，对易子为：\n$$\n[X_1,X_2] = X_1(X_2) - X_2(X_1) = 0 - \\frac{\\partial}{\\partial q^2} (q^2) \\frac{\\partial}{\\partial q^2} = - \\frac{\\partial}{\\partial q^2} = - X_2.\n$$\n因此，对于所有$q^2$，$c_{12}^1 = 0$，$c_{12}^2 = -1$，在$q^2 = 1$时，我们有$c_{12}^1(0,1) = 0$，$c_{12}^2(0,1) = -1$。\n\n程序中实现的算法遵循这些推导：\n- 它通过函数返回$X_i(q)$及其雅可比矩阵来编码每个标架。\n- 它使用动能度规计算对易子和投影。\n- 它使用格拉姆矩阵求解$c_{ij}^k(q)$。\n- 它为指定的测试案例计算所要求的对$\\left(c_{12}^1(q),c_{12}^2(q)\\right)$。\n\n预期的输出是：\n- 案例1: $[0.0, 0.0]$\n- 案例2: $[0.0, 0.15384615384615385]$\n- 案例3: $[0.0, 1.0]$\n- 案例4: $[0.0, -1.0]$\n\n最终程序以要求的单行格式打印这些结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef lie_bracket(Xi, JXi, Xj, JXj):\n    \"\"\"\n    Compute the Lie bracket [Xi, Xj] in coordinate components.\n    Xi, Xj: vectors of length n representing the components X_i^k(q), X_j^k(q).\n    JXi, JXj: Jacobians of Xi, Xj w.r.t. q, shape (n, n), where entry (k, l) = d X^k / d q^l.\n    Returns: vector w of length n, the components of [Xi, Xj].\n    \"\"\"\n    # [Xi, Xj]^k = sum_l Xi^l * d Xj^k / d q^l - Xj^l * d Xi^k / d q^l\n    # We can implement this via matrix-vector products across columns of Jacobians.\n    # Take columns of JXj: each column l is d Xj / d q^l (vector of length n).\n    # Then sum_l Xi[l] * JXj[:, l] -> n-vector. Similarly for the second term.\n    term1 = JXj @ Xi  # sum_l Xi[l] * JXj[:, l]\n    term2 = JXi @ Xj  # sum_l Xj[l] * JXi[:, l]\n    return term1 - term2\n\ndef project_coefficients(w, X_basis, M):\n    \"\"\"\n    Project the vector w onto the span of columns of X_basis using the M-inner product,\n    and return the coefficients c solving P_D w = sum_k c_k X_k.\n    X_basis: n x d matrix whose columns are the basis vectors X_k(q).\n    M: n x n positive-definite mass matrix.\n    Returns: c: d-vector of coefficients.\n    \"\"\"\n    # Gram matrix G = X^T M X\n    G = X_basis.T @ M @ X_basis\n    # Right-hand side b = X^T M w\n    b = X_basis.T @ M @ w\n    # Solve G c = b\n    c = np.linalg.solve(G, b)\n    return c\n\n# Rolling disk frame on Q=R^2 x S^1 x S^1 with q=(x,y,theta,phi)\ndef rolling_disk_frame(q, R, M_diag):\n    \"\"\"\n    Returns basis vectors X1, X2 and their Jacobians at state q for the rolling disk.\n    q: array-like of length 4: [x, y, theta, phi]\n    R: radius\n    M_diag: diagonal entries of mass matrix [m_x, m_y, I_theta, I_phi]\n    \"\"\"\n    x, y, theta, phi = q\n    n = 4\n    # X1 = d/d theta\n    X1 = np.array([0.0, 0.0, 1.0, 0.0])\n    # Jacobian of X1 is zero (constant components)\n    JX1 = np.zeros((n, n))\n    # X2 = d/d phi + R cos(theta) d/d x + R sin(theta) d/d y\n    X2 = np.array([R * np.cos(theta), R * np.sin(theta), 0.0, 1.0])\n    JX2 = np.zeros((n, n))\n    # Derivatives with respect to theta affect x and y components\n    JX2[0, 2] = -R * np.sin(theta)  # d (R cos theta) / d theta\n    JX2[1, 2] = R * np.cos(theta)   # d (R sin theta) / d theta\n    # Mass matrix M\n    M = np.diag(M_diag)\n    return X1, JX1, X2, JX2, M\n\n# Toy frame 1 on R^2: X1 = d/d q1, X2 = e^{q1} d/d q2\ndef toy_frame_exp(q):\n    \"\"\"\n    q: array-like of length 2: [q1, q2]\n    Returns X1, JX1, X2, JX2, M for toy frame with exponential scaling.\n    \"\"\"\n    q1, q2 = q\n    n = 2\n    X1 = np.array([1.0, 0.0])\n    JX1 = np.zeros((n, n))\n    X2 = np.array([0.0, np.exp(q1)])\n    JX2 = np.zeros((n, n))\n    # d X2^2 / d q1 = e^{q1}\n    JX2[1, 0] = np.exp(q1)\n    M = np.eye(n)\n    return X1, JX1, X2, JX2, M\n\n# Toy frame 2 on R^2: X1 = d/d q1 + q2 d/d q2, X2 = d/d q2\ndef toy_frame_coupled(q):\n    \"\"\"\n    q: array-like of length 2: [q1, q2]\n    Returns X1, JX1, X2, JX2, M for toy frame with coupling.\n    \"\"\"\n    q1, q2 = q\n    n = 2\n    X1 = np.array([1.0, q2])\n    JX1 = np.zeros((n, n))\n    # d X1^2 / d q2 = 1\n    JX1[1, 1] = 1.0\n    X2 = np.array([0.0, 1.0])\n    JX2 = np.zeros((n, n))\n    M = np.eye(n)\n    return X1, JX1, X2, JX2, M\n\ndef compute_c12(frame_data):\n    \"\"\"\n    Given frame data returning (X1, JX1, X2, JX2, M), compute (c12^1, c12^2).\n    \"\"\"\n    X1, JX1, X2, JX2, M = frame_data\n    # Compute commutator [X1, X2]\n    w = lie_bracket(X1, JX1, X2, JX2)\n    # Build basis matrix X = [X1, X2]\n    X_basis = np.column_stack((X1, X2))\n    # Project and get coefficients\n    c12 = project_coefficients(w, X_basis, M)\n    # Return as two floats\n    return float(c12[0]), float(c12[1])\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Case 1: Rolling disk, baseline\n    R1 = 1.0\n    M_diag1 = [1.0, 1.0, 1.0, 1.0]\n    q1 = np.array([0.0, 0.0, 0.0, 0.0])\n    frame1 = rolling_disk_frame(q1, R1, M_diag1)\n\n    # Case 2: Rolling disk, nontrivial angle\n    R2 = 1.0\n    M_diag2 = [2.0, 3.0, 0.5, 0.75]\n    q2 = np.array([1.0, -1.0, np.pi/4.0, 1.0])\n    frame2 = rolling_disk_frame(q2, R2, M_diag2)\n\n    # Case 3: Toy anholonomic frame on R^2\n    q3 = np.array([0.0, 0.0])\n    frame3 = toy_frame_exp(q3)\n\n    # Case 4: Toy anholonomic frame on R^2 with coupling\n    q4 = np.array([0.0, 1.0])\n    frame4 = toy_frame_coupled(q4)\n\n    test_cases = [frame1, frame2, frame3, frame4]\n\n    results = []\n    for frame in test_cases:\n        c1, c2 = compute_c12(frame)\n        # Format each case result as [c1,c2]\n        results.append([c1, c2])\n\n    # Final print statement in the exact required format.\n    # Single line: list of lists\n    print(f\"[{','.join(['[' + ','.join(map(str, r)) + ']' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}