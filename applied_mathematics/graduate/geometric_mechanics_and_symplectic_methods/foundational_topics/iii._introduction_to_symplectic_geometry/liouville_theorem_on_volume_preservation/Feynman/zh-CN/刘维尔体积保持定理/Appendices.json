{
    "hands_on_practices": [
        {
            "introduction": "本练习在向量场的层面上直接证明了刘维尔定理。通过为一个非多项式形式的哈密顿量计算散度，学生将亲眼看到哈密顿方程的结构如何内在地保证相空间流是不可压缩的，这与哈密顿量的具体形式无关。这个实践加强了对哈密顿量 $H$、其向量场 $X_H$ 以及体积守恒性质之间联系的理解 。",
            "id": "3754655",
            "problem": "考虑一个 $2n$ 维相空间 $\\mathbb{R}^{2n}$，其具有正则坐标 $(q^{1},\\dots,q^{n},p_{1},\\dots,p_{n})$、正则辛形式 $\\omega=\\sum_{i=1}^{n} dq^{i}\\wedge dp_{i}$以及刘维尔体积形式 $\\mu=\\omega^{n}/n!$。设哈密顿量为\n$$\nH(q,p)=\\sum_{i=1}^{n}\\Big(\\ln(1+p_{i}^{2})+\\exp(q^{i})\\Big).\n$$\n从哈密顿向量场 $X_{H}$ 的定义关系式（由内积 $i_{X_{H}}\\omega=dH$ 给出）出发，推导正则坐标下对应的常微分方程组（ODE）$(\\dot{q}^{i},\\dot{p}_{i})$。利用关于体积形式的散度定义，即 $\\mathcal{L}_{X}\\mu=(\\operatorname{div}_{\\mu}X)\\mu$，以及在正则坐标中，当 $\\mu$ 具有恒定密度时，散度简化为\n$$\n\\operatorname{div}_{\\mu}X_{H}=\\sum_{i=1}^{n}\\left(\\frac{\\partial \\dot{q}^{i}}{\\partial q^{i}}+\\frac{\\partial \\dot{p}_{i}}{\\partial p_{i}}\\right),\n$$\n的事实，计算给定非多项式哈密顿量 $H(q,p)$ 的 $\\operatorname{div}_{\\mu}X_{H}$，并给出最终的简化解析表达式。将你的最终答案表示为单一的封闭形式表达式。无需四舍五入。",
            "solution": "此问题要求推导给定哈密顿系统的运动方程，并计算相应哈密顿向量场关于刘维尔体积形式的散度。\n\n首先，我们验证问题陈述的有效性。\n\n### 步骤1：提取已知条件\n- 相空间：$2n$ 维空间 $\\mathbb{R}^{2n}$。\n- 正则坐标：$(q^{1},\\dots,q^{n},p_{1},\\dots,p_{n})$。\n- 正则辛形式：$\\omega=\\sum_{i=1}^{n} dq^{i}\\wedge dp_{i}$。\n- 刘维尔体积形式：$\\mu=\\omega^{n}/n!$。\n- 哈密顿量：$H(q,p)=\\sum_{i=1}^{n}\\Big(\\ln(1+p_{i}^{2})+\\exp(q^{i})\\Big)$。\n- 哈密顿向量场 $X_{H}$ 的定义关系式：$i_{X_{H}}\\omega=dH$。\n- 散度定义：$\\mathcal{L}_{X}\\mu=(\\operatorname{div}_{\\mu}X)\\mu$，其中 $\\mathcal{L}_{X}$ 是李导数。\n- 正则坐标中的散度公式：$\\operatorname{div}_{\\mu}X_{H}=\\sum_{i=1}^{n}\\left(\\frac{\\partial \\dot{q}^{i}}{\\partial q^{i}}+\\frac{\\partial \\dot{p}_{i}}{\\partial p_{i}}\\right)$，其中 $\\dot{q}^{i}$ 和 $\\dot{p}_{i}$ 是 $X_{H}$ 的分量。\n\n### 步骤2：使用提取的已知条件进行验证\n此问题在几何力学和辛几何的框架内是明确定义的。\n- **科学依据：** 哈密顿力学、辛形式、哈密顿向量场和刘维尔体积形式等概念是基础且完善的。给定的哈密顿量是相空间 $\\mathbb{R}^{2n}$ 上的光滑函数（$C^{\\infty}$），确保所有需要的导数都存在且连续。\n- **问题适定：** 问题清晰明确，并提供了所有必要的信息。它要求基于所提供的定义和公式进行直接计算。存在唯一且有意义的解。\n- **客观性：** 问题以精确的数学语言陈述，不含主观或基于观点的论断。\n\n### 步骤3：结论与行动\n问题有效。解答过程将继续进行。\n\n解答包括两部分：首先，从关系式 $i_{X_{H}}\\omega=dH$ 推导哈密顿运动方程；其次，计算所得向量场 $X_{H}$ 的散度。\n\n**第一部分：运动方程的推导**\n\n哈密顿量由下式给出\n$$\nH(q,p)=\\sum_{j=1}^{n}\\Big(\\ln(1+p_{j}^{2})+\\exp(q^{j})\\Big)\n$$\n我们计算其外微分 $dH$。\n$$\ndH = \\sum_{i=1}^{n} \\left( \\frac{\\partial H}{\\partial q^{i}} dq^{i} + \\frac{\\partial H}{\\partial p_{i}} dp_{i} \\right)\n$$\n$H$ 关于正则坐标的偏导数为：\n$$\n\\frac{\\partial H}{\\partial q^{i}} = \\frac{\\partial}{\\partial q^{i}} \\sum_{j=1}^{n}\\Big(\\ln(1+p_{j}^{2})+\\exp(q^{j})\\Big) = \\exp(q^{i})\n$$\n$$\n\\frac{\\partial H}{\\partial p_{i}} = \\frac{\\partial}{\\partial p_{i}} \\sum_{j=1}^{n}\\Big(\\ln(1+p_{j}^{2})+\\exp(q^{j})\\Big) = \\frac{1}{1+p_{i}^{2}} \\cdot (2p_{i}) = \\frac{2p_{i}}{1+p_{i}^{2}}\n$$\n因此，哈密顿量的外微分是\n$$\ndH = \\sum_{i=1}^{n} \\left( \\exp(q^{i}) dq^{i} + \\frac{2p_{i}}{1+p_{i}^{2}} dp_{i} \\right)\n$$\n哈密顿向量场 $X_{H}$ 的坐标形式写作\n$$\nX_{H} = \\sum_{j=1}^{n} \\left( \\dot{q}^{j} \\frac{\\partial}{\\partial q^{j}} + \\dot{p}_{j} \\frac{\\partial}{\\partial p_{j}} \\right)\n$$\n其中 $\\dot{q}^{j}$ 和 $\\dot{p}_{j}$ 是我们要求解的向量场的分量函数。$X_{H}$ 与辛形式 $\\omega = \\sum_{k=1}^{n} dq^{k} \\wedge dp_{k}$ 的内积是\n$$\ni_{X_{H}}\\omega = i_{\\sum_{j=1}^{n} ( \\dot{q}^{j} \\frac{\\partial}{\\partial q^{j}} + \\dot{p}_{j} \\frac{\\partial}{\\partial p_{j}} )} \\left( \\sum_{k=1}^{n} dq^{k} \\wedge dp_{k} \\right)\n$$\n利用内积的线性和其在基底上的作用规则 ($i_{\\partial/\\partial q^i} dq^j = \\delta^j_i$, $i_{\\partial/\\partial q^i} dp_j = 0$, etc.)，我们得到：\n$$\ni_{X_H}\\omega = \\sum_{i=1}^n \\left( \\dot{q}^i i_{\\partial/\\partial q^i} (dq^i \\wedge dp_i) + \\dot{p}_i i_{\\partial/\\partial p_i} (dq^i \\wedge dp_i) \\right) = \\sum_{i=1}^n (\\dot{q}^i dp_i - \\dot{p}_i dq^i)\n$$\n现在我们应用定义关系 $i_{X_{H}}\\omega = dH$：\n$$\n\\sum_{i=1}^{n} \\left( -\\dot{p}_{i} dq^{i} + \\dot{q}^{i} dp_{i} \\right) = \\sum_{i=1}^{n} \\left( \\exp(q^{i}) dq^{i} + \\frac{2p_{i}}{1+p_{i}^{2}} dp_{i} \\right)\n$$\n通过比较每个 $i \\in \\{1, \\dots, n\\}$ 的基底 $1$-形式 $dq^{i}$ 和 $dp_{i}$ 的系数，我们得到哈密顿方程：\n$$\n\\dot{q}^{i} = \\frac{\\partial H}{\\partial p_{i}} = \\frac{2p_{i}}{1+p_{i}^{2}}\n$$\n$$\n\\dot{p}_{i} = -\\frac{\\partial H}{\\partial q^{i}} = -\\exp(q^{i})\n$$\n这就是描述系统演化的常微分方程组。\n\n**第二部分：散度的计算**\n\n问题给出了在正则坐标下 $X_{H}$ 相对于刘维尔体积形式 $\\mu$ 的散度公式：\n$$\n\\operatorname{div}_{\\mu}X_{H}=\\sum_{i=1}^{n}\\left(\\frac{\\partial \\dot{q}^{i}}{\\partial q^{i}}+\\frac{\\partial \\dot{p}_{i}}{\\partial p_{i}}\\right)\n$$\n我们使用第一部分中推导出的 $\\dot{q}^{i}$ 和 $\\dot{p}_{i}$ 的表达式。对于每个 $i$，我们计算所需的偏导数。\n\n分量 $\\dot{q}^{i} = \\frac{2p_{i}}{1+p_{i}^{2}}$ 仅是 $p_{i}$ 的函数。因此，它关于 $q^{i}$ 的偏导数为：\n$$\n\\frac{\\partial \\dot{q}^{i}}{\\partial q^{i}} = \\frac{\\partial}{\\partial q^{i}} \\left( \\frac{2p_{i}}{1+p_{i}^{2}} \\right) = 0\n$$\n因为 $q^{i}$ 和 $p_i$ 是独立坐标。\n\n分量 $\\dot{p}_{i} = -\\exp(q^{i})$ 仅是 $q^{i}$ 的函数。因此，它关于 $p_{i}$ 的偏导数为：\n$$\n\\frac{\\partial \\dot{p}_{i}}{\\partial p_{i}} = \\frac{\\partial}{\\partial p_{i}} \\left( -\\exp(q^{i}) \\right) = 0\n$$\n因为 $p_i$ 和 $q^i$ 是独立坐标。\n\n将这些结果代入散度公式：\n$$\n\\operatorname{div}_{\\mu}X_{H} = \\sum_{i=1}^{n} (0 + 0) = \\sum_{i=1}^{n} 0 = 0\n$$\n哈密顿向量场的散度为 $0$。这个结果是对关于相空间体积守恒的 Liouville 定理的一个具体验证。该定理指出，对于任何哈密顿系统，其向量场关于正则体积形式的散度恒为零，即 $\\operatorname{div}_{\\mu}X_{H}=0$。这通常是成立的，因为对于任何足够光滑的哈密顿量 $H$，\n$$\n\\operatorname{div}_{\\mu}X_{H} = \\sum_{i=1}^{n}\\left(\\frac{\\partial}{\\partial q^{i}}\\left(\\frac{\\partial H}{\\partial p_{i}}\\right)+\\frac{\\partial}{\\partial p_{i}}\\left(-\\frac{\\partial H}{\\partial q^{i}}\\right)\\right) = \\sum_{i=1}^{n}\\left(\\frac{\\partial^{2}H}{\\partial q^{i}\\partial p_{i}} - \\frac{\\partial^{2}H}{\\partial p_{i}\\partial q^{i}}\\right) = 0\n$$\n根据混合偏导数的相等性（Schwarz 定理）。我们的显式计算证实了这一普遍原理对于给定的非多项式哈密顿量也成立。最终的简化解析表达式为 $0$。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "虽然哈密顿流总是保体积的，但反之并不成立。本练习通过分析一个保体积但非辛的数值映射，探讨了这一关键区别。通过这项分析，学生将理解到辛性是一个远比保体积更强的条件，它对于保持哈密顿动力学的几何结构至关重要，而这一概念是设计可靠的长期数值积分算法的核心 。",
            "id": "3754652",
            "problem": "考虑一个在相空间 $\\mathbb{R}^{4}$ 上具有两个自由度的哈密顿系统，其正则坐标为 $(q_{1},q_{2},p_{1},p_{2})$，正则辛形式为 $\\omega = dq_{1} \\wedge dp_{1} + dq_{2} \\wedge dp_{2}$。设哈密顿量为 $H(q,p) = \\frac{1}{2}\\left(p_{1}^{2} + p_{2}^{2}\\right) + \\frac{1}{2}\\left(\\Omega_{1}^{2} q_{1}^{2} + \\Omega_{2}^{2} q_{2}^{2}\\right)$，其中 $\\Omega_{1}$ 和 $\\Omega_{2}$ 是正常数。定义单步数值方法（一个离散时间映射）$\\Phi_{h,\\alpha} : \\mathbb{R}^{4} \\to \\mathbb{R}^{4}$ 为\n$$\n\\Phi_{h,\\alpha}(q_{1},q_{2},p_{1},p_{2}) = \\left(q_{1} + h\\,p_{1},\\; q_{2} + h\\,p_{2},\\; p_{1},\\; p_{2} + \\alpha\\, q_{1}\\right),\n$$\n其中 $h > 0$ 是时间步长，$\\alpha \\in \\mathbb{R}$ 是一个固定参数。\n\n从以下基本定义出发：(i) 一个映射是辛映射，当且仅当其切映射保持正则辛形式，这等价于 $D\\Phi^{\\top} J\\, D\\Phi = J$，其中 $J = \\begin{pmatrix} 0  & I \\\\ -I & 0 \\end{pmatrix}$，$I$ 是 $2 \\times 2$ 的单位矩阵；(ii) 刘维尔定理指出，哈密顿流保持刘维尔体积形式 $\\Omega = \\omega \\wedge \\omega$（因此其雅可比行列式等于1）。请完成以下任务：\n\n1. 计算方法 $\\Phi_{h,\\alpha}$ 的雅可比矩阵 $D\\Phi_{h,\\alpha}$ 及其行列式。判断该方法是否对所有的 $h$ 和 $\\alpha$ 都保体积。\n\n2. 使用辛条件 $D\\Phi_{h,\\alpha}^{\\top} J\\, D\\Phi_{h,\\alpha} = J$，确定使 $\\Phi_{h,\\alpha}$ 成为辛映射时 $\\alpha$ 所需满足的充分必要条件（用 $h$ 和其他可能的常数表示）。\n\n3. 运用几何力学的基本原理，解释为什么仅仅保持体积（即 $\\det(D\\Phi_{h,\\alpha}) = 1$）并不能保证正确的长期哈密顿结构。你的解释应说明为什么非辛保体积方法通常在向后误差分析（BEA）的意义下不容许一个修正哈密顿量，从而即使相空间体积得以保持，不变量中仍会出现伪长期漂移。\n\n请给出使 $\\Phi_{h,\\alpha}$ 成为辛映射的参数 $\\alpha$ 的唯一值作为你的最终答案。无需四舍五入。无需单位。",
            "solution": "问题要求对一个哈密顿系统的数值方法 $\\Phi_{h,\\alpha}$ 进行分析。分析内容包括检验其保体积性和辛性，并解释这两种性质的不同含义。系统的状态向量为 $z = (q_{1}, q_{2}, p_{1}, p_{2})^{\\top} \\in \\mathbb{R}^{4}$。\n\n该数值方法由映射 $\\Phi_{h,\\alpha}: \\mathbb{R}^{4} \\to \\mathbb{R}^{4}$ 给出，定义为：\n$$\n\\Phi_{h,\\alpha}(q_{1}, q_{2}, p_{1}, p_{2}) = (q_{1} + h p_{1}, q_{2} + h p_{2}, p_{1}, p_{2} + \\alpha q_{1})\n$$\n其中 $h > 0$ 是时间步长，$\\alpha \\in \\mathbb{R}$ 是一个参数。\n\n我们将映射的分量表示为 $z' = \\Phi_{h,\\alpha}(z)$:\n$q_{1}' = q_{1} + h p_{1}$\n$q_{2}' = q_{2} + h p_{2}$\n$p_{1}' = p_{1}$\n$p_{2}' = p_{2} + \\alpha q_{1}$\n\n**1. 雅可比矩阵与保体积性**\n\n第一个任务是计算该映射的雅可比矩阵 $D\\Phi_{h,\\alpha}$ 及其行列式。如果一个映射的雅可比矩阵行列式等于1，则该映射是保体积的。\n\n雅可比矩阵为 $D\\Phi_{h,\\alpha} = \\frac{\\partial z'}{\\partial z}$。其分量是输出坐标对输入坐标的偏导数。\n坐标按 $(q_{1}, q_{2}, p_{1}, p_{2})$ 的顺序排列。\n\n偏导数如下：\n$\\frac{\\partial q_{1}'}{\\partial q_{1}} = 1$, $\\frac{\\partial q_{1}'}{\\partial q_{2}} = 0$, $\\frac{\\partial q_{1}'}{\\partial p_{1}} = h$, $\\frac{\\partial q_{1}'}{\\partial p_{2}} = 0$\n$\\frac{\\partial q_{2}'}{\\partial q_{1}} = 0$, $\\frac{\\partial q_{2}'}{\\partial q_{2}} = 1$, $\\frac{\\partial q_{2}'}{\\partial p_{1}} = 0$, $\\frac{\\partial q_{2}'}{\\partial p_{2}} = h$\n$\\frac{\\partial p_{1}'}{\\partial q_{1}} = 0$, $\\frac{\\partial p_{1}'}{\\partial q_{2}} = 0$, $\\frac{\\partial p_{1}'}{\\partial p_{1}} = 1$, $\\frac{\\partial p_{1}'}{\\partial p_{2}} = 0$\n$\\frac{\\partial p_{2}'}{\\partial q_{1}} = \\alpha$, $\\frac{\\partial p_{2}'}{\\partial q_{2}} = 0$, $\\frac{\\partial p_{2}'}{\\partial p_{1}} = 0$, $\\frac{\\partial p_{2}'}{\\partial p_{2}} = 1$\n\n将这些偏导数组合成矩阵，我们得到雅可比矩阵：\n$$\nD\\Phi_{h,\\alpha} = \\begin{pmatrix}\n1 & 0 & h & 0 \\\\\n0 & 1 & 0 & h \\\\\n0 & 0 & 1 & 0 \\\\\n\\alpha & 0 & 0 & 1\n\\end{pmatrix}\n$$\n为了求行列式，我们可以使用代数余子式展开。沿第三行（大部分元素为零）展开可以简化计算：\n$$\n\\det(D\\Phi_{h,\\alpha}) = (-1)^{3+3} \\cdot 1 \\cdot \\det \\begin{pmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & h \\\\\n\\alpha & 0 & 1\n\\end{pmatrix}\n$$\n现在，我们计算这个 $3 \\times 3$ 矩阵的行列式，例如沿第一行展开：\n$$\n\\det \\begin{pmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & h \\\\\n\\alpha & 0 & 1\n\\end{pmatrix} = (-1)^{1+1} \\cdot 1 \\cdot \\det \\begin{pmatrix}\n1 & h \\\\\n0 & 1\n\\end{pmatrix} = 1 \\cdot (1 \\cdot 1 - h \\cdot 0) = 1\n$$\n因此，我们有：\n$$\n\\det(D\\Phi_{h,\\alpha}) = 1\n$$\n对于所有 $h > 0$ 和 $\\alpha \\in \\mathbb{R}$ 的值，行列式都为1。因此，方法 $\\Phi_{h,\\alpha}$ 对所有 $h$ 和 $\\alpha$ 都是保体积的。\n\n**2. 辛性条件**\n\n一个映射 $\\Phi$ 是辛映射，如果其雅可比矩阵 $D\\Phi$ 满足条件 $D\\Phi^{\\top} J D\\Phi = J$。\n对于坐标排序 $(q_{1}, q_{2}, p_{1}, p_{2})$，正则辛矩阵 $J$ 由下式给出：\n$$\nJ = \\begin{pmatrix} 0 & I \\\\ -I & 0 \\end{pmatrix}_4 = \\begin{pmatrix}\n0 & 0 & 1 & 0 \\\\\n0 & 0 & 0 & 1 \\\\\n-1 & 0 & 0 & 0 \\\\\n0 & -1 & 0 & 0\n\\end{pmatrix}\n$$\n其中 $I$ 是 $2 \\times 2$ 的单位矩阵。我们记 $M = D\\Phi_{h,\\alpha}$。我们需要计算 $M^{\\top} J M$ 并使其等于 $J$。\n\n$M$ 的转置矩阵是：\n$$\nM^{\\top} = \\begin{pmatrix}\n1 & 0 & 0 & \\alpha \\\\\n0 & 1 & 0 & 0 \\\\\nh & 0 & 1 & 0 \\\\\n0 & h & 0 & 1\n\\end{pmatrix}\n$$\n首先，我们计算乘积 $J M$：\n$$\nJ M = \\begin{pmatrix}\n0 & 0 & 1 & 0 \\\\\n0 & 0 & 0 & 1 \\\\\n-1 & 0 & 0 & 0 \\\\\n0 & -1 & 0 & 0\n\\end{pmatrix} \\begin{pmatrix}\n1 & 0 & h & 0 \\\\\n0 & 1 & 0 & h \\\\\n0 & 0 & 1 & 0 \\\\\n\\alpha & 0 & 0 & 1\n\\end{pmatrix} = \\begin{pmatrix}\n0 & 0 & 1 & 0 \\\\\n\\alpha & 0 & 0 & 1 \\\\\n-1 & 0 & -h & 0 \\\\\n0 & -1 & 0 & -h\n\\end{pmatrix}\n$$\n接下来，我们左乘 $M^{\\top}$：\n$$\nM^{\\top}JM = \\begin{pmatrix}\n1 & 0 & 0 & \\alpha \\\\\n0 & 1 & 0 & 0 \\\\\nh & 0 & 1 & 0 \\\\\n0 & h & 0 & 1\n\\end{pmatrix} \\begin{pmatrix}\n0 & 0 & 1 & 0 \\\\\n\\alpha & 0 & 0 & 1 \\\\\n-1 & 0 & -h & 0 \\\\\n0 & -1 & 0 & -h\n\\end{pmatrix} = \\begin{pmatrix}\n0 & -\\alpha & 1 & -h\\alpha \\\\\n\\alpha & 0 & 0 & 1 \\\\\n-1 & 0 & 0 & 0 \\\\\nh\\alpha & -1 & 0 & 0\n\\end{pmatrix}\n$$\n为使映射成为辛映射，这个结果矩阵必须等于 $J$：\n$$\n\\begin{pmatrix}\n0 & -\\alpha & 1 & -h\\alpha \\\\\n\\alpha & 0 & 0 & 1 \\\\\n-1 & 0 & 0 & 0 \\\\\nh\\alpha & -1 & 0 & 0\n\\end{pmatrix} = \\begin{pmatrix}\n0 & 0 & 1 & 0 \\\\\n0 & 0 & 0 & 1 \\\\\n-1 & 0 & 0 & 0 \\\\\n0 & -1 & 0 & 0\n\\end{pmatrix}\n$$\n逐个元素比较这两个矩阵，我们得到关于 $\\alpha$ 的几个条件：\n- (1,2) 元素: $-\\alpha = 0 \\implies \\alpha = 0$。\n- (2,1) 元素: $\\alpha = 0$。\n- (1,4) 元素: $-h\\alpha = 0 \\implies \\alpha = 0$ (因为 $h>0$)。\n- (4,1) 元素: $h\\alpha = 0 \\implies \\alpha = 0$。\n\n所有非对角线、非平凡的条件都要求 $\\alpha=0$。如果 $\\alpha=0$，则 $M^{\\top}JM$ 矩阵简化为 $J$ 本身。因此，使映射 $\\Phi_{h,\\alpha}$ 成为辛映射的充分必要条件是 $\\alpha=0$。\n\n**3. 保体积与辛性的区别**\n\n仅仅保体积（雅可比行列式为1）是一个比辛性（保持辛形式）弱得多的条件。辛性要求保持相空间中所有二维区域的“有向面积”，而不仅仅是总的 $2n$ 维体积。\n- **几何结构：** 哈密顿动力学的本质在于其辛结构，而不是其保体积性。能量守恒等性质与辛结构密切相关。非辛的保体积积分器，即使保持了体积，也破坏了这种精细的几何结构。\n- **向后误差分析（Backward Error Analysis, BEA）：** BEA 理论表明，一个辛积分器所产生的数值轨迹，可以被看作是某个略微修改过的“影子哈密顿量” $\\tilde{H}$ 的精确解。这意味着数值轨迹精确地停留在一个哈密顿系统的能量曲面上，因此能量（以及其他由 $\\tilde{H}$ 产生的守恒量）不会发生系统性漂移，只会在真实值附近有界振荡。\n- **伪漂移：** 对于非辛但保体积的方法，通常不存在这样的影子哈密顿量。因此，尽管相空间总体积被保留，但像能量这样的不变量会表现出随机游走式的漂移，在长期模拟中累积显著误差，导致结果不物理。该问题中的映射当 $\\alpha \\neq 0$ 时就是一个例子：它保体积，但会破坏系统的动力学结构。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "本数值实验将前一个练习中的理论区别变得具体可见。通过实现并比较辛积分子（如 Störmer-Verlet）和非辛积分子（如 RK4），学生将直接观察到只有前者能在长时间模拟中将相空间面积的误差保持在机器精度范围内。这个动手编程练习展示了为哈密顿系统使用几何积分子的实际重要性 。",
            "id": "3754650",
            "problem": "考虑一个处于正则坐标中的平面摆，其中构型角 $q$ 以弧度为单位，其共轭动量为 $p$。使用具有二阶微分形式 $\\omega = \\mathrm{d}q \\wedge \\mathrm{d}p$ 的正则辛结构以及无量纲哈密顿量 $H(q,p) = \\frac{p^{2}}{2} + 1 - \\cos(q)$。相流 $\\varphi^{t}$ 由哈密顿方程的积分曲线定义，而哈密顿方程则由与哈密顿量 $H$ 和正则辛形式相关联的哈密顿向量场导出。\n\n您的任务如下：\n\n1. 仅从正则辛形式、哈密顿函数和哈密顿方程的定义出发，计算与 $H(q,p)$ 相关联的哈密顿向量场，以及由此产生的控制 $(q(t),p(t))$ 的一阶方程组。然后，从第一性原理出发，证明该向量场的散度（相对于平面上的标准勒贝格测度）处处为零，从而证明精确流 $\\varphi^{t}$ 保持相空间面积。\n\n2. 在 $(q,p)$ 上实现两种不同的时间步长为 $h$ 的数值流映射：\n   - 一种适用于形式为 $H(q,p) = T(p) + V(q)$ 的可分离哈密顿量的辛方法，具体为 Störmer–Verlet（也称为速度 Verlet）格式。该格式应实现为半步动量更新、全步位置更新和第二次半步动量更新的复合。\n   - 一种非辛方法，具体为经典的四阶 Runge–Kutta (RK4) 方法。\n\n   两种方法都必须将每个点 $(q,p)$ 以步长 $h$ 向前演化指定的步数 $N$。所有角度均须以弧度为单位。\n\n3. 为了数值验证关于面积保持的刘维尔定理 (Liouville's theorem)，用一个有 $M$ 个顶点的正多边形来近似一小块相空间区域。将该多边形初始化为 $(q,p)$ 中以 $(q_{0},p_{0})$ 为中心、半轴在 $q$ 方向为 $a$、在 $p$ 方向为 $b$ 的轴对齐椭圆，并用 $M$ 个等距角对其进行离散化。在每种选定的数值流映射下，将所有顶点以步长 $h$ 演化 $N$ 步，并使用鞋带公式 (shoelace formula) 计算演化前后多边形的有向面积。对于每个测试，报告定义为 $(A_{\\mathrm{final}} - A_{\\mathrm{initial}})/A_{\\mathrm{initial}}$ 的相对面积变化。\n\n4. 使用以下测试套件。对于每个测试用例，输出一个等于相对面积变化的浮点数。所有角度均以弧度为单位；除了明确声明角度以弧度为单位外，不需要进行物理单位转换。\n\n   令 $M = 200$。对于每个测试用例，使用指定方法演化由参数 $(q_{0}, p_{0}, a, b, h, N)$ 构建的多边形：\n   - 测试 $1$（正常路径，辛方法）：方法 Störmer–Verlet，$(q_{0},p_{0}) = (0.1, 0.2)$，$(a,b) = (0.05, 0.05)$，$h = 0.01$，$N = 2000$。\n   - 测试 $2$（正常路径，非辛方法）：方法 RK4，参数与测试 $1$ 相同。\n   - 测试 $3$（近分离线，辛方法）：方法 Störmer–Verlet，$(q_{0},p_{0}) = (\\pi - 0.2, 0.0)$，$(a,b) = (0.05, 0.05)$，$h = 0.01$，$N = 2000$。\n   - 测试 $4$（近分离线，非辛方法）：方法 RK4，参数与测试 $3$ 相同。\n   - 测试 $5$（大步长，非辛方法压力测试）：方法 RK4，$(q_{0},p_{0}) = (1.0, 0.0)$，$(a,b) = (0.08, 0.08)$，$h = 0.2$，$N = 200$。\n   - 测试 $6$（大步长，辛欧拉变体）：方法 Symplectic Euler，定义为 $p_{n+1} = p_{n} - h\\,\\partial_{q}V(q_{n})$ 和 $q_{n+1} = q_{n} + h\\,\\partial_{p}T(p_{n+1})$，其中 $T(p) = \\frac{p^{2}}{2}$ 且 $V(q) = 1 - \\cos(q)$，使用与测试 $5$ 相同的参数。\n\n您的程序必须生成单行输出，其中包含一个逗号分隔的列表，该列表包含按上述测试顺序排列的六个浮点数相对面积变化，并用方括号括起来，例如 $[x_{1},x_{2},x_{3},x_{4},x_{5},x_{6}]$，其中每个 $x_{k}$ 是一个浮点数。不应产生任何其他输出。所有中间角度必须以弧度解释，输出值必须是无量纲的实数。",
            "solution": "问题要求对一个由特定哈密顿量描述的平面摆系统进行两部分分析。首先，我们必须解析地推导出运动方程，并证明精确的相流保持面积。其次，我们必须实现三个数值积分器（Störmer-Verlet、RK4 和 Symplectic Euler），用它们来模拟相空间中小块区域的演化，并数值比较它们的面积保持特性。\n\n### 第 1 部分：解析推导\n\n系统在正则坐标 $(q, p)$ 中定义，其中 $q$ 是角度，$p$ 是共轭动量。相空间是一个二维流形，配备了正则辛二阶微分形式 $\\omega = \\mathrm{d}q \\wedge \\mathrm{d}p$。动力学由哈密顿函数 $H(q,p) = \\frac{p^{2}}{2} + 1 - \\cos(q)$ 控制。\n\n哈密顿向量场 $X_H$ 由关系 $i_{X_H}\\omega = \\mathrm{d}H$ 定义，其中 $i_{X_H}$ 是关于 $X_H$ 的内积。设向量场为 $X_H = \\dot{q}\\frac{\\partial}{\\partial q} + \\dot{p}\\frac{\\partial}{\\partial p}$。哈密顿量的外导数是 $\\mathrm{d}H = \\frac{\\partial H}{\\partial q}\\mathrm{d}q + \\frac{\\partial H}{\\partial p}\\mathrm{d}p$。\n\n应用内积于辛形式 $\\omega = \\mathrm{d}q \\wedge \\mathrm{d}p$：\n$i_{X_H}\\omega = i_{\\dot{q}\\frac{\\partial}{\\partial q} + \\dot{p}\\frac{\\partial}{\\partial p}}(\\mathrm{d}q \\wedge \\mathrm{d}p) = \\dot{q} \\cdot i_{\\partial/\\partial q}(\\mathrm{d}q \\wedge \\mathrm{d}p) + \\dot{p} \\cdot i_{\\partial/\\partial p}(\\mathrm{d}q \\wedge \\mathrm{d}p) = \\dot{q}\\mathrm{d}p - \\dot{p}\\mathrm{d}q$。\n将 $i_{X_H}\\omega = \\mathrm{d}H$ 中一阶微分形式的系数相等：\n$\\dot{q}\\mathrm{d}p - \\dot{p}\\mathrm{d}q = \\frac{\\partial H}{\\partial p}\\mathrm{d}p + \\frac{\\partial H}{\\partial q}\\mathrm{d}q$\n这导出了标准的哈密顿方程：\n$\\dot{q} = \\frac{\\partial H}{\\partial p}$\n$\\dot{p} = -\\frac{\\partial H}{\\partial q}$\n\n对于给定的哈密顿量 $H(q,p) = \\frac{p^{2}}{2} + 1 - \\cos(q)$：\n$\\frac{\\partial H}{\\partial p} = p$\n$\\frac{\\partial H}{\\partial q} = \\sin(q)$\n一阶微分方程组为：\n$\\dot{q} = p$\n$\\dot{p} = -\\sin(q)$\n哈密顿向量场为 $X_H(q,p) = (p, -\\sin(q))$。为了证明相流保持相空间面积，我们计算此向量场关于坐标 $(q,p)$ 的散度：\n$\\nabla \\cdot X_H = \\frac{\\partial}{\\partial q}(\\dot{q}) + \\frac{\\partial}{\\partial p}(\\dot{p}) = \\frac{\\partial}{\\partial q}(p) + \\frac{\\partial}{\\partial p}(-\\sin(q))$\n由于 $p$ 与 $q$ 无关，$\\sin(q)$ 与 $p$ 无关，所以两个偏导数都为零：\n$\\nabla \\cdot X_H = 0 + 0 = 0$\n根据刘维尔定理 (Liouville's theorem)，散度为零的向量场生成保体积的流。在这个二维情况下，这意味着与 $X_H$ 相关联的流 $\\varphi^t$ 保持相空间中的面积。\n\n### 第 2 和第 3 部分：数值方法与验证\n\n我们将实现两种辛方法和一种非辛方法来演化一组初始点，并测量它们所围成面积的变化。哈密顿量是可分离的，$H(q,p) = T(p) + V(q)$，其中 $T(p) = \\frac{p^2}{2}$ 且 $V(q) = 1 - \\cos(q)$。运动方程为 $\\dot{q} = \\partial_p T(p)$ 和 $\\dot{p} = -\\partial_q V(q)$。\n\n**Störmer–Verlet (SV) 方法：** 这是一个二阶辛积分器。从时间 $t_n$ 到 $t_{n+1}=t_n+h$ 的单步由以下复合操作给出：\n1. 半步动量更新：$p_{n+1/2} = p_n - \\frac{h}{2} V'(q_n) = p_n - \\frac{h}{2} \\sin(q_n)$\n2. 全步位置更新：$q_{n+1} = q_n + h T'(p_{n+1/2}) = q_n + h p_{n+1/2}$\n3. 半步动量更新：$p_{n+1} = p_{n+1/2} - \\frac{h}{2} V'(q_{n+1}) = p_{n+1/2} - \\frac{h}{2} \\sin(q_{n+1})$\n作为一种辛方法，预期该方法将在机器精度范围内保持相空间面积。\n\n**四阶 Runge–Kutta (RK4) 方法：** 这是一种通用的、高精度的但非辛的方法。对于一个自治系统 $\\dot{\\mathbf{y}} = f(\\mathbf{y})$，其中 $\\mathbf{y} = (q, p)^T$ 且 $f(\\mathbf{y}) = (p, -\\sin(q))^T$，单步计算如下：\n$$ \\mathbf{k}_1 = f(\\mathbf{y}_n) $$\n$$ \\mathbf{k}_2 = f(\\mathbf{y}_n + \\frac{h}{2}\\mathbf{k}_1) $$\n$$ \\mathbf{k}_3 = f(\\mathbf{y}_n + \\frac{h}{2}\\mathbf{k}_2) $$\n$$ \\mathbf{k}_4 = f(\\mathbf{y}_n + h\\mathbf{k}_3) $$\n$$ \\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{h}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4) $$\n该方法通常不保持辛结构，预期会在相空间面积上表现出数值漂移。\n\n**辛欧拉 (Symplectic Euler, SE) 方法：** 问题为测试 $6$ 指定了这种一阶辛方法：\n1. 全步动量更新：$p_{n+1} = p_n - h V'(q_n) = p_n - h \\sin(q_n)$\n2. 全步位置更新：$q_{n+1} = q_n + h T'(p_{n+1}) = q_n + h p_{n+1}$\n该方法也是辛方法，应该保持相空间面积。\n\n**数值验证：** 一个以 $(q_0, p_0)$ 为中心、半轴为 $a$ 和 $b$ 的小椭圆区域被离散化为一个有 $M$ 个顶点的多边形。顶点由 $(q_k, p_k) = (q_0+a\\cos(2\\pi k/M), p_0+b\\sin(2\\pi k/M))$ 给出，其中 $k=0, \\dots, M-1$。这个多边形的有向面积可以使用鞋带公式 (shoelace formula) 计算：\n$$ A = \\frac{1}{2} \\sum_{k=0}^{M-1} (q_k p_{k+1} - q_{k+1} p_k) $$\n其中 $(q_M, p_M) = (q_0, p_0)$。\n对于每个测试用例，我们计算多边形的初始面积 $A_{\\mathrm{initial}}$，使用指定方法将其所有顶点以步长 $h$ 演化 $N$ 步，计算最终面积 $A_{\\mathrm{final}}$，并报告相对面积变化 $(A_{\\mathrm{final}} - A_{\\mathrm{initial}}) / A_{\\mathrm{initial}}$。\n\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by running a suite of numerical experiments on the planar pendulum\n    to compare area preservation properties of symplectic and non-symplectic integrators.\n    \"\"\"\n\n    # --- Numerical Integrator Implementations ---\n\n    def hamiltonian_rhs(state):\n        \"\"\"\n        Computes the RHS of Hamilton's equations for the pendulum.\n        state is an (M, 2) array of (q, p) pairs.\n        Returns an (M, 2) array of (q_dot, p_dot) pairs.\n        \"\"\"\n        q = state[:, 0]\n        p = state[:, 1]\n        q_dot = p\n        p_dot = -np.sin(q)\n        return np.stack([q_dot, p_dot], axis=1)\n\n    def step_sv(state, h):\n        \"\"\"\n        Performs one step of the Störmer-Verlet integrator.\n        state is an (M, 2) array of (q, p) pairs.\n        h is the step size.\n        Returns the new state array.\n        \"\"\"\n        q, p = state[:, 0], state[:, 1]\n        \n        # Half-step momentum update\n        p_half = p - (h / 2.0) * np.sin(q)\n        \n        # Full-step position update\n        q_new = q + h * p_half\n        \n        # Second half-step momentum update\n        p_new = p_half - (h / 2.0) * np.sin(q_new)\n        \n        return np.stack([q_new, p_new], axis=1)\n\n    def step_rk4(state, h):\n        \"\"\"\n        Performs one step of the classical fourth-order Runge-Kutta integrator.\n        state is an (M, 2) array of (q, p) pairs.\n        h is the step size.\n        Returns the new state array.\n        \"\"\"\n        k1 = hamiltonian_rhs(state)\n        k2 = hamiltonian_rhs(state + (h / 2.0) * k1)\n        k3 = hamiltonian_rhs(state + (h / 2.0) * k2)\n        k4 = hamiltonian_rhs(state + h * k3)\n        \n        return state + (h / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n\n    def step_se(state, h):\n        \"\"\"\n        Performs one step of the Symplectic Euler integrator as defined in the problem.\n        state is an (M, 2) array of (q, p) pairs.\n        h is the step size.\n        Returns the new state array.\n        \"\"\"\n        q, p = state[:, 0], state[:, 1]\n\n        # Full-step momentum update\n        p_new = p - h * np.sin(q)\n\n        # Full-step position update\n        q_new = q + h * p_new\n        \n        return np.stack([q_new, p_new], axis=1)\n\n    # --- Area Calculation ---\n    \n    def shoelace_area(vertices):\n        \"\"\"\n        Calculates the signed area of a polygon using the shoelace formula.\n        vertices is an (M, 2) array of (q, p) coordinates.\n        \"\"\"\n        q, p = vertices[:, 0], vertices[:, 1]\n        # This implements 0.5 * sum(q_i * p_{i+1} - q_{i+1} * p_i)\n        return 0.5 * (np.dot(q, np.roll(p, -1)) - np.dot(p, np.roll(q, -1)))\n\n    # --- Test Suite ---\n\n    M = 200 # Number of vertices for the polygon\n\n    test_cases = [\n        # method, (q0, p0), (a, b), h, N\n        (\"sv\",  (0.1, 0.2), (0.05, 0.05), 0.01, 2000), # Test 1\n        (\"rk4\", (0.1, 0.2), (0.05, 0.05), 0.01, 2000), # Test 2\n        (\"sv\",  (np.pi - 0.2, 0.0), (0.05, 0.05), 0.01, 2000), # Test 3\n        (\"rk4\", (np.pi - 0.2, 0.0), (0.05, 0.05), 0.01, 2000), # Test 4\n        (\"rk4\", (1.0, 0.0), (0.08, 0.08), 0.2, 200),        # Test 5\n        (\"se\",  (1.0, 0.0), (0.08, 0.08), 0.2, 200),        # Test 6\n    ]\n\n    method_map = {\n        \"sv\": step_sv,\n        \"rk4\": step_rk4,\n        \"se\": step_se\n    }\n\n    results = []\n    \n    for method_name, center, axes, h, N in test_cases:\n        q0, p0 = center\n        a, b = axes\n        \n        # 1. Initialize polygon vertices on an ellipse\n        thetas = np.linspace(0, 2 * np.pi, M, endpoint=False)\n        q_initial = q0 + a * np.cos(thetas)\n        p_initial = p0 + b * np.sin(thetas)\n        vertices = np.stack([q_initial, p_initial], axis=1)\n\n        # 2. Compute initial area\n        initial_area = shoelace_area(vertices)\n\n        # 3. Evolve vertices over N steps\n        integrator_func = method_map[method_name]\n        for _ in range(N):\n            vertices = integrator_func(vertices, h)\n\n        # 4. Compute final area\n        final_area = shoelace_area(vertices)\n\n        # 5. Calculate relative area change and store result\n        relative_change = (final_area - initial_area) / initial_area\n        results.append(relative_change)\n    \n    return results\n```",
            "answer": "[-3.3306690738754696e-16,-0.00010007831841443695,-1.6653345369377348e-16,0.00014022802705708892,0.005128092289656461,1.1102230246251565e-16]"
        }
    ]
}