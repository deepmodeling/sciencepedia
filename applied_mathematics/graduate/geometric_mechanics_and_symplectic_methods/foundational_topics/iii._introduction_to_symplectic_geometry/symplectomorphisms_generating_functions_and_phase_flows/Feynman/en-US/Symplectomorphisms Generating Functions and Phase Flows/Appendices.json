{
    "hands_on_practices": [
        {
            "introduction": "The relationship between a generating function and a canonical transformation is a cornerstone of Hamiltonian mechanics. This exercise provides direct practice in making this connection explicit, starting from a given Type-1 generating function $S(q,Q)$ to derive the full transformation and verify its symplectic nature from first principles. Mastering this procedure builds a solid foundation for understanding how these functions operate .",
            "id": "3771596",
            "problem": "Consider the cotangent bundle of the real line, viewed as a symplectic manifold with canonical coordinates $(q,p)$ and $(Q,P)$ and canonical symplectic $2$-form $\\omega = dq \\wedge dp$. Let the transformation between $(q,p)$ and $(Q,P)$ be generated by a type-1 generating function $S(q,Q)$ in the sense that the transformation is defined by the exactness of the canonical one-form, namely $p\\,dq - P\\,dQ = dS$. Take the prescribed generating function\n$$\nS(q,Q) = \\frac{1}{2} a\\, q^{2} + b\\, q\\, Q + \\frac{1}{2} c\\, Q^{2},\n$$\nwhere $a,b,c \\in \\mathbb{R}$ and $b \\neq 0$.\n\nStarting only from the fundamental definition of canonical transformations via generating functions and the canonical $2$-form, construct the canonical transformation explicitly. Derive $(Q,P)$ as functions of $(q,p)$, and also derive $(q,p)$ as functions of $(Q,P)$, by solving the relations that follow from $p\\,dq - P\\,dQ = dS$. Rigorously verify that the transformation is symplectic by showing $\\phi^{*} \\omega = \\omega$.\n\nProvide your final answer as a single expression containing the four mappings $Q(q,p)$, $P(q,p)$, $q(Q,P)$, and $p(Q,P)$, in that order. No numerical approximation is required, and no units are involved.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of Hamiltonian mechanics, well-posed with sufficient and consistent information, and objectively stated. The condition $b \\neq 0$ ensures the existence of a unique transformation. We will now proceed with the solution.\n\nThe transformation is defined by a type-1 generating function $S(q,Q)$ through the relation $p\\,dq - P\\,dQ = dS$. The manifold is the cotangent bundle $T^*\\mathbb{R}$ with canonical coordinates $(q,p)$ and canonical symplectic form $\\omega = dq \\wedge dp$. The given generating function is\n$$\nS(q,Q) = \\frac{1}{2} a\\, q^{2} + b\\, q\\, Q + \\frac{1}{2} c\\, Q^{2}\n$$\nwhere $a, b, c$ are real constants and $b \\neq 0$.\n\nFirst, we compute the total differential of $S(q,Q)$ with respect to its arguments, $q$ and $Q$:\n$$\ndS = \\frac{\\partial S}{\\partial q} dq + \\frac{\\partial S}{\\partial Q} dQ\n$$\nThe partial derivatives of $S(q,Q)$ are:\n$$\n\\frac{\\partial S}{\\partial q} = \\frac{\\partial}{\\partial q} \\left(\\frac{1}{2} a\\, q^{2} + b\\, q\\, Q + \\frac{1}{2} c\\, Q^{2}\\right) = a\\,q + b\\,Q\n$$\n$$\n\\frac{\\partial S}{\\partial Q} = \\frac{\\partial}{\\partial Q} \\left(\\frac{1}{2} a\\, q^{2} + b\\, q\\, Q + \\frac{1}{2} c\\, Q^{2}\\right) = b\\,q + c\\,Q\n$$\nSubstituting these into the expression for $dS$ gives:\n$$\ndS = (a\\,q + b\\,Q) dq + (b\\,q + c\\,Q) dQ\n$$\nBy comparing this with the fundamental definition $p\\,dq - P\\,dQ = dS$, we equate the coefficients of the differentials $dq$ and $dQ$:\n$$\np = \\frac{\\partial S}{\\partial q} \\implies p = a\\,q + b\\,Q\n$$\n$$\n-P = \\frac{\\partial S}{\\partial Q} \\implies -P = b\\,q + c\\,Q \\implies P = -b\\,q - c\\,Q\n$$\nThese two equations implicitly define the canonical transformation.\n\nOur first task is to construct the explicit transformation $\\phi: (q,p) \\mapsto (Q,P)$, i.e., to express $(Q,P)$ as functions of $(q,p)$.\nFrom the first relation, $p = a\\,q + b\\,Q$, we solve for $Q$. Since we are given $b \\neq 0$, this is always possible:\n$$\nb\\,Q = p - a\\,q \\implies Q(q,p) = \\frac{1}{b}(p - a\\,q) = -\\frac{a}{b}q + \\frac{1}{b}p\n$$\nNow, we substitute this expression for $Q$ into the second relation, $P = -b\\,q - c\\,Q$, to find $P$ as a function of $(q,p)$:\n$$\nP(q,p) = -b\\,q - c\\left(-\\frac{a}{b}q + \\frac{1}{b}p\\right) = -b\\,q + \\frac{ac}{b}q - \\frac{c}{b}p = \\left(\\frac{ac - b^2}{b}\\right)q - \\frac{c}{b}p\n$$\nThis completes the forward transformation $(q,p) \\mapsto (Q,P)$.\n\nNext, we construct the inverse transformation $\\phi^{-1}: (Q,P) \\mapsto (q,p)$. We use the same two initial relations, but this time solve for $(q,p)$ in terms of $(Q,P)$.\nFrom the second relation, $P = -b\\,q - c\\,Q$, we solve for $q$. Again, using $b \\neq 0$:\n$$\nb\\,q = -P - c\\,Q \\implies q(Q,P) = -\\frac{1}{b}(P + c\\,Q) = -\\frac{c}{b}Q - \\frac{1}{b}P\n$$\nNow, we substitute this expression for $q$ into the first relation, $p = a\\,q + b\\,Q$, to find $p$ as a function of $(Q,P)$:\n$$\np(Q,P) = a\\left(-\\frac{c}{b}Q - \\frac{1}{b}P\\right) + b\\,Q = -\\frac{ac}{b}Q - \\frac{a}{b}P + b\\,Q = \\left(\\frac{b^2 - ac}{b}\\right)Q - \\frac{a}{b}P\n$$\nThis completes the inverse transformation $(Q,P) \\mapsto (q,p)$.\n\nThe final part of the task is to rigorously verify that the transformation $\\phi$ is symplectic. A transformation is symplectic if it preserves the symplectic form. That is, if $\\omega = dq \\wedge dp$ is the symplectic form in the original coordinates and $\\omega' = dQ \\wedge dP$ is the form in the new coordinates, we must show that the pullback of $\\omega'$ under $\\phi$ equals $\\omega$: $\\phi^*\\omega' = \\omega$.\n$$\n\\phi^*\\omega' = \\phi^*(dQ \\wedge dP) = d(\\phi^*Q) \\wedge d(\\phi^*P) = d(Q(q,p)) \\wedge d(P(q,p))\n$$\nWe compute the differentials of $Q(q,p)$ and $P(q,p)$ with respect to $q$ and $p$:\n$$\ndQ = \\frac{\\partial Q}{\\partial q}dq + \\frac{\\partial Q}{\\partial p}dp = \\left(-\\frac{a}{b}\\right)dq + \\left(\\frac{1}{b}\\right)dp\n$$\n$$\ndP = \\frac{\\partial P}{\\partial q}dq + \\frac{\\partial P}{\\partial p}dp = \\left(\\frac{ac - b^2}{b}\\right)dq + \\left(-\\frac{c}{b}\\right)dp\n$$\nNow we compute their wedge product:\n$$\ndQ \\wedge dP = \\left(-\\frac{a}{b}dq + \\frac{1}{b}dp\\right) \\wedge \\left(\\frac{ac - b^2}{b}dq - \\frac{c}{b}dp\\right)\n$$\nUsing the distributive property of the wedge product and the identities $dq \\wedge dq = 0$, $dp \\wedge dp = 0$, and $dp \\wedge dq = -dq \\wedge dp$, we obtain:\n$$\ndQ \\wedge dP = \\left(-\\frac{a}{b}\\right)\\left(-\\frac{c}{b}\\right)dq \\wedge dp + \\left(\\frac{1}{b}\\right)\\left(\\frac{ac - b^2}{b}\\right)dp \\wedge dq\n$$\n$$\ndQ \\wedge dP = \\left(\\frac{ac}{b^2}\\right)dq \\wedge dp - \\left(\\frac{ac - b^2}{b^2}\\right)dq \\wedge dp\n$$\nCombining the terms:\n$$\ndQ \\wedge dP = \\left(\\frac{ac - (ac - b^2)}{b^2}\\right)dq \\wedge dp = \\left(\\frac{ac - ac + b^2}{b^2}\\right)dq \\wedge dp\n$$\n$$\ndQ \\wedge dP = \\left(\\frac{b^2}{b^2}\\right)dq \\wedge dp = 1 \\cdot dq \\wedge dp = dq \\wedge dp\n$$\nSince $dQ \\wedge dP = dq \\wedge dp$, we have shown that $\\phi^*\\omega' = \\omega$. The transformation is therefore symplectic, as required.\n\nThe four derived mappings are:\n$Q(q,p) = -\\frac{a}{b}q + \\frac{1}{b}p$\n$P(q,p) = \\frac{ac-b^2}{b}q - \\frac{c}{b}p$\n$q(Q,P) = -\\frac{c}{b}Q - \\frac{1}{b}P$\n$p(Q,P) = \\frac{b^2-ac}{b}Q - \\frac{a}{b}P$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{a}{b}q + \\frac{1}{b}p & \\frac{ac-b^2}{b}q - \\frac{c}{b}p & -\\frac{c}{b}Q - \\frac{1}{b}P & \\frac{b^2-ac}{b}Q - \\frac{a}{b}P\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While we often use a generating function to define a transformation, it is equally important to be able to find the generating function that corresponds to a known coordinate change. This practice tackles that inverse problem for the physically significant transformation from Delaunay to Poincaré variables in celestial mechanics. By solving for the Type-2 generating function, you will see how it serves as a compact and elegant way to encode a canonical map .",
            "id": "3771571",
            "problem": "Consider the planar two-body problem and its standard Delaunay variables $\\left(L,\\ell,G,g\\right)$, where $L$ and $G$ are actions and $\\ell$ and $g$ are conjugate angles. It is a well-established fact that $\\left(L,\\ell,G,g\\right)$ is a canonical set with symplectic two-form given by $dL \\wedge d\\ell + dG \\wedge dg$. Define the planar Poincaré variables $\\left(\\Lambda,\\lambda,\\Gamma,\\gamma\\right)$ by\n$$\n\\Lambda := L, \\quad \\lambda := \\ell + g, \\quad \\Gamma := L - G, \\quad \\gamma := -\\,g.\n$$\nStarting only from the definition of a symplectomorphism as a transformation that preserves the symplectic two-form, and the canonical form of the Liouville one-form $\\theta = p \\, dq$ for canonical pairs, do the following:\n\n1. Compute the Liouville one-form both in Delaunay variables, $\\theta_{\\text{Del}} = L \\, d\\ell + G \\, dg$, and in Poincaré variables, $\\theta_{\\text{Poi}} = \\Lambda \\, d\\lambda + \\Gamma \\, d\\gamma$. Show that the corresponding symplectic two-forms coincide, thereby verifying that the transformation $\\left(L,\\ell,G,g\\right) \\mapsto \\left(\\Lambda,\\lambda,\\Gamma,\\gamma\\right)$ is a symplectomorphism.\n\n2. Construct a generating function of type $2$, $F_{2}\\!\\left(\\ell,g;\\Lambda,\\Gamma\\right)$, for the transformation from $\\left(L,\\ell,G,g\\right)$ to $\\left(\\Lambda,\\lambda,\\Gamma,\\gamma\\right)$, in the sense that it satisfies\n$$\nL \\;=\\; \\frac{\\partial F_{2}}{\\partial \\ell}, \\qquad G \\;=\\; \\frac{\\partial F_{2}}{\\partial g}, \\qquad \\lambda \\;=\\; \\frac{\\partial F_{2}}{\\partial \\Lambda}, \\qquad \\gamma \\;=\\; \\frac{\\partial F_{2}}{\\partial \\Gamma}.\n$$\nGive your answer for $F_{2}\\!\\left(\\ell,g;\\Lambda,\\Gamma\\right)$ in closed form, up to an arbitrary additive constant. Your final answer must be this single analytic expression. No numerical approximation is required.",
            "solution": "The problem is well-posed, scientifically grounded, and contains all necessary information for its resolution. The concepts of Delaunay and Poincaré variables, symplectomorphisms, Liouville one-forms, and generating functions are standard in the field of Hamiltonian mechanics and symplectic geometry. The problem is therefore valid.\n\nWe will address the two parts of the problem sequentially.\n\nPart 1: Verification of the Symplectomorphism\n\nA transformation of coordinates is a symplectomorphism if it preserves the symplectic two-form. In our case, the phase space is four-dimensional, described by the Delaunay variables $\\left(L, \\ell, G, g\\right)$ or the Poincaré variables $\\left(\\Lambda, \\lambda, \\Gamma, \\gamma\\right)$.\n\nThe symplectic two-form in Delaunay coordinates is given by the exterior derivative of the Liouville one-form $\\theta_{\\text{Del}} = L \\, d\\ell + G \\, dg$.\n$$\n\\omega_{\\text{Del}} = d\\theta_{\\text{Del}} = d\\left(L \\, d\\ell + G \\, dg\\right) = dL \\wedge d\\ell + dG \\wedge dg\n$$\nSimilarly, the symplectic two-form in Poincaré coordinates is given by the exterior derivative of the Liouville one-form $\\theta_{\\text{Poi}} = \\Lambda \\, d\\lambda + \\Gamma \\, d\\gamma$.\n$$\n\\omega_{\\text{Poi}} = d\\theta_{\\text{Poi}} = d\\left(\\Lambda \\, d\\lambda + \\Gamma \\, d\\gamma\\right) = d\\Lambda \\wedge d\\lambda + d\\Gamma \\wedge d\\gamma\n$$\nTo verify that the transformation $\\left(L, \\ell, G, g\\right) \\mapsto \\left(\\Lambda, \\lambda, \\Gamma, \\gamma\\right)$ is a symplectomorphism, we must show that $\\omega_{\\text{Poi}} = \\omega_{\\text{Del}}$. We will do this by expressing $\\omega_{\\text{Poi}}$ in terms of the Delaunay variables and their differentials.\n\nThe transformation is defined by:\n$$\n\\Lambda = L, \\qquad \\lambda = \\ell + g, \\qquad \\Gamma = L - G, \\qquad \\gamma = -g\n$$\nFirst, we find the differentials of the new variables in terms of the differentials of the old variables:\n$$\nd\\Lambda = dL\n$$\n$$\nd\\lambda = d\\ell + dg\n$$\n$$\nd\\Gamma = dL - dG\n$$\n$$\nd\\gamma = -dg\n$$\nNow, substitute these expressions into the formula for $\\omega_{\\text{Poi}}$:\n$$\n\\omega_{\\text{Poi}} = d\\Lambda \\wedge d\\lambda + d\\Gamma \\wedge d\\gamma = \\left(dL\\right) \\wedge \\left(d\\ell + dg\\right) + \\left(dL - dG\\right) \\wedge \\left(-dg\\right)\n$$\nUsing the distributive property of the wedge product, we expand the terms:\n$$\n\\omega_{\\text{Poi}} = \\left(dL \\wedge d\\ell + dL \\wedge dg\\right) + \\left(-dL \\wedge dg - (-dG) \\wedge dg\\right)\n$$\nUsing the anti-commutative property of the wedge product, $a \\wedge b = -b \\wedge a$, we have $-dL \\wedge dg = dg \\wedge dL$ and $-(-dG) \\wedge dg = dG \\wedge dg$. The expression becomes:\n$$\n\\omega_{\\text{Poi}} = dL \\wedge d\\ell + dL \\wedge dg - dL \\wedge dg + dG \\wedge dg\n$$\nThe terms $dL \\wedge dg$ and $-dL \\wedge dg$ cancel each other out, leaving:\n$$\n\\omega_{\\text{Poi}} = dL \\wedge d\\ell + dG \\wedge dg\n$$\nThis is precisely the expression for the symplectic two-form in Delaunay coordinates, $\\omega_{\\text{Del}}$. Thus, we have shown that $\\omega_{\\text{Poi}} = \\omega_{\\text{Del}}$. The transformation preserves the symplectic two-form and is therefore a symplectomorphism.\n\nPart 2: Construction of the Generating Function\n\nWe are asked to find a generating function of type 2, denoted by $F_{2}\\!\\left(\\ell,g;\\Lambda,\\Gamma\\right)$. This function of the old coordinates $\\left(\\ell, g\\right)$ and new momenta $\\left(\\Lambda, \\Gamma\\right)$ must satisfy the following relations:\n$$\nL \\;=\\; \\frac{\\partial F_{2}}{\\partial \\ell}, \\qquad G \\;=\\; \\frac{\\partial F_{2}}{\\partial g}, \\qquad \\lambda \\;=\\; \\frac{\\partial F_{2}}{\\partial \\Lambda}, \\qquad \\gamma \\;=\\; \\frac{\\partial F_{2}}{\\partial \\Gamma}\n$$\nTo construct $F_{2}$, we will integrate these partial differential equations. First, we need to express the old momenta $L$ and $G$ in terms of the variables of $F_{2}$, which are $\\left(\\ell, g, \\Lambda, \\Gamma\\right)$. From the transformation equations:\n$$\nL = \\Lambda\n$$\n$$\nG = L - \\Gamma = \\Lambda - \\Gamma\n$$\nLet us start with the first equation, $L = \\frac{\\partial F_{2}}{\\partial \\ell}$. Substituting $L=\\Lambda$:\n$$\n\\frac{\\partial F_{2}}{\\partial \\ell} = \\Lambda\n$$\nIntegrating with respect to $\\ell$ (treating $g$, $\\Lambda$, and $\\Gamma$ as constants):\n$$\nF_{2}\\!\\left(\\ell,g;\\Lambda,\\Gamma\\right) = \\int \\Lambda \\, d\\ell = \\Lambda \\ell + f(g, \\Lambda, \\Gamma)\n$$\nwhere $f(g, \\Lambda, \\Gamma)$ is a function of integration that can depend on the other variables $g$, $\\Lambda$, and $\\Gamma$.\n\nNext, we use the second equation, $G = \\frac{\\partial F_2}{\\partial g}$. Substituting $G = \\Lambda - \\Gamma$:\n$$\n\\frac{\\partial F_{2}}{\\partial g} = \\Lambda - \\Gamma\n$$\nTaking the partial derivative of our expression for $F_2$ with respect to $g$:\n$$\n\\frac{\\partial}{\\partial g} \\left(\\Lambda \\ell + f(g, \\Lambda, \\Gamma)\\right) = \\frac{\\partial f}{\\partial g}\n$$\nEquating the two expressions for $\\frac{\\partial F_{2}}{\\partial g}$:\n$$\n\\frac{\\partial f}{\\partial g} = \\Lambda - \\Gamma\n$$\nIntegrating with respect to $g$ (treating $\\Lambda$ and $\\Gamma$ as constants):\n$$\nf(g, \\Lambda, \\Gamma) = \\int (\\Lambda - \\Gamma) \\, dg = (\\Lambda - \\Gamma)g + h(\\Lambda, \\Gamma)\n$$\nwhere $h(\\Lambda, \\Gamma)$ is a function of integration that can depend on $\\Lambda$ and $\\Gamma$.\nSubstituting this back into our expression for $F_2$:\n$$\nF_{2}\\!\\left(\\ell,g;\\Lambda,\\Gamma\\right) = \\Lambda \\ell + (\\Lambda - \\Gamma)g + h(\\Lambda, \\Gamma)\n$$\nTo determine $h(\\Lambda, \\Gamma)$, we use the remaining two relations for the new coordinates $\\lambda$ and $\\gamma$. First, for $\\lambda = \\frac{\\partial F_{2}}{\\partial \\Lambda}$:\n$$\n\\frac{\\partial F_{2}}{\\partial \\Lambda} = \\frac{\\partial}{\\partial \\Lambda} \\left(\\Lambda \\ell + (\\Lambda - \\Gamma)g + h(\\Lambda, \\Gamma)\\right) = \\ell + g + \\frac{\\partial h}{\\partial \\Lambda}\n$$\nFrom the transformation rules, we know $\\lambda = \\ell + g$. Therefore:\n$$\n\\ell + g = \\ell + g + \\frac{\\partial h}{\\partial \\Lambda} \\quad \\implies \\quad \\frac{\\partial h}{\\partial \\Lambda} = 0\n$$\nNow, for $\\gamma = \\frac{\\partial F_{2}}{\\partial \\Gamma}$:\n$$\n\\frac{\\partial F_{2}}{\\partial \\Gamma} = \\frac{\\partial}{\\partial \\Gamma} \\left(\\Lambda \\ell + (\\Lambda - \\Gamma)g + h(\\Lambda, \\Gamma)\\right) = -g + \\frac{\\partial h}{\\partial \\Gamma}\n$$\nFrom the transformation rules, we know $\\gamma = -g$. Therefore:\n$$\n-g = -g + \\frac{\\partial h}{\\partial \\Gamma} \\quad \\implies \\quad \\frac{\\partial h}{\\partial \\Gamma} = 0\n$$\nSince the partial derivatives of $h$ with respect to both $\\Lambda$ and $\\Gamma$ are zero, $h(\\Lambda, \\Gamma)$ must be a constant. As the generating function is defined up to an arbitrary additive constant, we can set this constant to zero without loss of generality.\n\nThus, the generating function of type 2 for the transformation is:\n$$\nF_{2}\\!\\left(\\ell,g;\\Lambda,\\Gamma\\right) = \\Lambda \\ell + (\\Lambda - \\Gamma)g\n$$",
            "answer": "$$\n\\boxed{\\Lambda \\ell + (\\Lambda - \\Gamma)g}\n$$"
        },
        {
            "introduction": "The power of geometric mechanics extends deeply into the realm of computation, enabling the design of numerical methods that respect the underlying structure of physical laws. This hands-on problem guides you through the construction of a symplectic integrator, a numerical scheme derived from a discrete generating function that preserves the symplectic nature of Hamiltonian flow. You will implement this map and observe its remarkable long-term stability, a direct consequence of its geometric foundation .",
            "id": "3771622",
            "problem": "You are given a Hamiltonian system on the phase space $\\mathbb{R}^{2n}$ with canonical coordinates $(q,p) \\in \\mathbb{R}^n \\times \\mathbb{R}^n$ and canonical symplectic form $\\omega = \\sum_{i=1}^n dq_i \\wedge dp_i$. Consider the coupled quadratic Hamiltonian with $n=2$,\n$$\nH(q,p) = \\tfrac{1}{2} p^\\top p + \\tfrac{1}{2} q^\\top K q,\n$$\nwhere $K \\in \\mathbb{R}^{2 \\times 2}$ is symmetric positive definite and represents a linear coupling of two oscillatory modes. The continuous-time flow is determined by Hamilton's equations,\n$$\n\\dot{q} = \\frac{\\partial H}{\\partial p}(q,p), \\quad \\dot{p} = -\\frac{\\partial H}{\\partial q}(q,p).\n$$\nConstruct a discrete-time symplectic map $(q_k,p_k) \\mapsto (q_{k+1},p_{k+1})$ using a Type-2 discrete generating function $S_h(q_k,p_{k+1})$ for a timestep $h > 0$. Use only fundamental definitions of canonical transformations generated by $S_h$ and the structure of $H(q,p)$ to derive an explicit update rule for $(q_{k+1},p_{k+1})$ in terms of $(q_k,p_k)$, $h$, and $K$. Then, for the linear-quadratic case, assemble the $4 \\times 4$ Jacobian matrix $A_h$ of the one-step map written in block form and verify that it is a symplectic matrix by checking the condition\n$$\nA_h^\\top \\Omega A_h = \\Omega, \\quad \\text{where} \\quad \\Omega = \\begin{bmatrix} 0 & I \\\\ -I & 0 \\end{bmatrix},\n$$\nwith $I$ the $2 \\times 2$ identity matrix and $0$ the $2 \\times 2$ zero matrix.\n\nUsing the derived symplectic map, implement a long-time numerical integration and verify long-time stability by monitoring boundedness. Use the Euclidean norm on phase space, $\\|(q,p)\\|_2 = \\sqrt{\\|q\\|_2^2 + \\|p\\|_2^2}$, and define\n$$\nR_N = \\frac{\\max_{0 \\le k \\le N} \\|(q_k,p_k)\\|_2}{\\|(q_0,p_0)\\|_2}.\n$$\nA trajectory is deemed numerically long-time stable over $N$ steps if $R_N$ is below a prescribed threshold. Do not use any a priori stability criterion in your code to decide stability; evaluate it based on the computed trajectory.\n\nYour program must construct the discrete symplectic map via a discrete generating function, implement the time-stepping, and evaluate the following test suite. All quantities are dimensionless.\n\nDefinitions to be used:\n- A Type-2 generating function $S(q,P)$ generates a canonical transformation $(q,p) \\mapsto (Q,P)$ via $p = \\partial S/\\partial q$ and $Q = \\partial S/\\partial P$.\n- For the Hamiltonian $H(q,p) = T(p) + V(q)$, the gradient satisfies $\\partial H/\\partial q = \\nabla V(q)$ and $\\partial H/\\partial p = \\nabla T(p)$.\n- The maximum natural frequency is $\\omega_{\\max} = \\sqrt{\\lambda_{\\max}(K)}$, where $\\lambda_{\\max}(K)$ is the largest eigenvalue of $K$.\n\nTest suite:\n- For all tests, let the coupling matrix be\n  $$\n  K(\\omega_1,\\omega_2,c) = \\begin{bmatrix} \\omega_1^2 + c & -c \\\\ -c & \\omega_2^2 + c \\end{bmatrix}.\n  $$\n  The initial condition is fixed as $q_0 = [1.0,\\,0.5]^\\top$ and $p_0 = [0.0,\\,-0.3]^\\top$.\n\n- Test 1 (happy path, strictly stable): Parameters $\\omega_1 = 1.0$, $\\omega_2 = 1.6$, $c = 0.1$. Compute $\\omega_{\\max}$ from $K$, set $h = \\frac{1}{\\omega_{\\max}}$ (i.e., half the linear stability limit), and integrate for $N=100000$ steps. Decide stability by checking $R_N \\le 5.0$.\n\n- Test 2 (near stability boundary): Same $\\omega_1$, $\\omega_2$, $c$ as Test 1. Set $h = 0.999 \\cdot \\frac{2}{\\omega_{\\max}}$ and integrate for $N=50000$ steps. Decide stability by checking $R_N \\le 50.0$.\n\n- Test 3 (beyond stability boundary): Same $\\omega_1$, $\\omega_2$, $c$ as Test 1. Set $h = 1.01 \\cdot \\frac{2}{\\omega_{\\max}}$ and integrate for $N=2000$ steps. Decide stability by checking $R_N \\le 100.0$; this should fail.\n\n- Test 4 (symplecticity of the linear map): Using the $K$ and $h$ from Test 1, construct the one-step map matrix $A_h$ in block form. Verify the symplecticity condition $A_h^\\top \\Omega A_h = \\Omega$ numerically by requiring the Frobenius norm of the residual to be less than $10^{-12}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"), where each result is a boolean corresponding to the tests in order.",
            "solution": "The user-provided problem is assessed to be valid as it is scientifically grounded in Hamiltonian mechanics and geometric numerical integration, is well-posed with a clear theoretical derivation and specific numerical tests, and is expressed objectively using standard mathematical terminology.\n\nHerein, we derive the symplectic map, verify its properties, and outline the implementation for the specified numerical tests.\n\nThe system is described by the Hamiltonian for two coupled harmonic oscillators on the phase space $\\mathbb{R}^4$:\n$$\nH(q,p) = \\tfrac{1}{2} p^\\top p + \\tfrac{1}{2} q^\\top K q\n$$\nwhere $q = (q_1, q_2)^\\top \\in \\mathbb{R}^2$, $p = (p_1, p_2)^\\top \\in \\mathbb{R}^2$, and $K \\in \\mathbb{R}^{2 \\times 2}$ is a symmetric positive definite matrix. This Hamiltonian is separable into a kinetic energy term $T(p) = \\tfrac{1}{2} p^\\top p$ and a potential energy term $V(q) = \\tfrac{1}{2} q^\\top K q$.\n\nWe are tasked to construct a symplectic map $(q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$ for a timestep $h > 0$ using a Type-2 generating function $S_h(q_k, p_{k+1})$. A standard choice for a generating function that approximates the time-$h$ flow for a separable Hamiltonian is based on a symplectic splitting method. Specifically, we use the generating function that corresponds to the composition of the exact flow of $V(q)$ for a time $h$ followed by the exact flow of $T(p)$ for a time $h$. This integrator is known as the Symplectic Euler B method. Its Type-2 generating function is given by:\n$$\nS_h(q_k, p_{k+1}) = q_k^\\top p_{k+1} + h \\left( T(p_{k+1}) + V(q_k) \\right)\n$$\nSubstituting the expressions for $T$ and $V$, we have:\n$$\nS_h(q_k, p_{k+1}) = q_k^\\top p_{k+1} + h \\left( \\tfrac{1}{2} p_{k+1}^\\top p_{k+1} + \\tfrac{1}{2} q_k^\\top K q_k \\right)\n$$\nA Type-2 generating function $S(q, P)$ defines a canonical transformation from coordinates $(q,p)$ to $(Q,P)$ via the relations $p = \\frac{\\partial S}{\\partial q}$ and $Q = \\frac{\\partial S}{\\partial P}$. For our discrete map, we identify the \"old\" coordinates as $(q_k, p_k)$ and the \"new\" coordinates as $(q_{k+1}, p_{k+1})$. The generating function $S_h(q_k, p_{k+1})$ is of the form $S(q_k, P_{k+1})$ where $P_{k+1}$ is used instead of $p_{k+1}$ to denote it as an independent variable of $S_h$. However, for clarity in the context of the map, we retain the $p_{k+1}$ notation. The transformation relations are thus:\n$$\np_k = \\frac{\\partial S_h(q_k, p_{k+1})}{\\partial q_k} \\quad \\text{and} \\quad q_{k+1} = \\frac{\\partial S_h(q_k, p_{k+1})}{\\partial p_{k+1}}\n$$\nWe compute these partial derivatives:\n$$\n\\frac{\\partial S_h}{\\partial q_k} = p_{k+1} + h \\frac{\\partial}{\\partial q_k} \\left( \\tfrac{1}{2} q_k^\\top K q_k \\right) = p_{k+1} + h K q_k\n$$\n$$\n\\frac{\\partial S_h}{\\partial p_{k+1}} = q_k + h \\frac{\\partial}{\\partial p_{k+1}} \\left( \\tfrac{1}{2} p_{k+1}^\\top p_{k+1} \\right) = q_k + h p_{k+1}\n$$\nSetting these equal to $p_k$ and $q_{k+1}$ respectively, we obtain the implicit update rules:\n$$\np_k = p_{k+1} + h K q_k\n$$\n$$\nq_{k+1} = q_k + h p_{k+1}\n$$\nTo obtain an explicit map $(q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$, we rearrange the first equation to solve for $p_{k+1}$:\n$$\np_{k+1} = p_k - h K q_k\n$$\nThen, we substitute this expression into the second equation:\n$$\nq_{k+1} = q_k + h(p_k - h K q_k) = (I - h^2 K)q_k + h p_k\n$$\nwhere $I$ is the $2 \\times 2$ identity matrix. This constitutes the explicit one-step map.\n\nFor the symplecticity verification, we express the map in linear matrix form. Let $z_k = (q_k^\\top, p_k^\\top)^\\top \\in \\mathbb{R}^4$ be the state vector. The map $z_k \\mapsto z_{k+1}$ is given by $z_{k+1} = A_h z_k$, where $A_h$ is the $4 \\times 4$ block matrix:\n$$\nA_h = \\begin{bmatrix} I - h^2 K & hI \\\\ -hK & I \\end{bmatrix}\n$$\nA matrix $A$ is symplectic if it preserves the standard symplectic form, which is characterized by the matrix $\\Omega = \\begin{bmatrix} 0 & I \\\\ -I & 0 \\end{bmatrix}$. The condition for symplecticity is $A_h^\\top \\Omega A_h = \\Omega$. We verify this condition. The transpose of $A_h$ is:\n$$\nA_h^\\top = \\begin{bmatrix} (I - h^2 K)^\\top & (-hK)^\\top \\\\ (hI)^\\top & I^\\top \\end{bmatrix} = \\begin{bmatrix} I - h^2 K & -hK \\\\ hI & I \\end{bmatrix}\n$$\nsince $K$ is symmetric and $I$ is symmetric.\nWe compute the product $A_h^\\top \\Omega A_h$:\n\\begin{align*}\nA_h^\\top \\Omega A_h &= \\begin{bmatrix} I - h^2 K & -hK \\\\ hI & I \\end{bmatrix} \\begin{bmatrix} 0 & I \\\\ -I & 0 \\end{bmatrix} \\begin{bmatrix} I - h^2 K & hI \\\\ -hK & I \\end{bmatrix} \\\\\n&= \\begin{bmatrix} (I - h^2 K)(0) + (-hK)(-I) & (I - h^2 K)(I) + (-hK)(0) \\\\ (hI)(0) + (I)(-I) & (hI)(I) + (I)(0) \\end{bmatrix} \\begin{bmatrix} I - h^2 K & hI \\\\ -hK & I \\end{bmatrix} \\\\\n&= \\begin{bmatrix} hK & I - h^2 K \\\\ -I & hI \\end{bmatrix} \\begin{bmatrix} I - h^2 K & hI \\\\ -hK & I \\end{bmatrix} \\\\\n&= \\begin{bmatrix} (hK)(I - h^2 K) + (I - h^2 K)(-hK) & (hK)(hI) + (I - h^2 K)(I) \\\\ (-I)(I - h^2 K) + (hI)(-hK) & (-I)(hI) + (hI)(I) \\end{bmatrix} \\\\\n&= \\begin{bmatrix} hK - h^3K^2 - hK + h^3K^2 & h^2K + I - h^2K \\\\ -I + h^2K - h^2K & -hI + hI \\end{bmatrix} \\\\\n&= \\begin{bmatrix} 0 & I \\\\ -I & 0 \\end{bmatrix} = \\Omega\n\\end{align*}\nThe condition is satisfied, confirming that the derived map $A_h$ is indeed symplectic. This theoretical verification will be confirmed numerically in Test 4.\n\nThe numerical stability of this map for the linear system $\\dot{z} = \\begin{pmatrix} 0 & I \\\\ -K & 0 \\end{pmatrix}z$ depends on the eigenvalues of the amplification matrix $A_h$. The method is stable if all eigenvalues of $A_h$ have a modulus less than or equal to $1$. For the Symplectic Euler integrator, this leads to the linear stability condition $0 \\le h \\le 2/\\omega_{\\max}$, where $\\omega_{\\max} = \\sqrt{\\lambda_{\\max}(K)}$ is the highest natural frequency of the system. The numerical tests are designed to probe this stability boundary.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by deriving and implementing a symplectic integrator\n    for a coupled quadratic Hamiltonian system, and running a suite of tests.\n    \"\"\"\n\n    def run_integration_test(params):\n        \"\"\"\n        Runs a single numerical integration test case.\n        \"\"\"\n        K_params, h_factor, N, R_thresh = params\n        omega1, omega2, c = K_params\n        \n        q0 = np.array([1.0, 0.5])\n        p0 = np.array([0.0, -0.3])\n        \n        K = np.array([\n            [omega1**2 + c, -c],\n            [-c, omega2**2 + c]\n        ])\n        \n        # Calculate max frequency omega_max\n        eigenvalues = np.linalg.eigvalsh(K)\n        lambda_max = np.max(eigenvalues)\n        omega_max = np.sqrt(lambda_max)\n        \n        # Set timestep h\n        h = h_factor / omega_max\n        \n        # Initialize state\n        q, p = q0.copy(), p0.copy()\n        \n        # Initial norm\n        norm0 = np.linalg.norm(np.concatenate((q, p)))\n        if norm0 == 0:\n            return True # Trivial case, stable\n        max_norm = norm0\n        \n        # Precompute matrices for the map\n        I = np.identity(2)\n        h2K = h**2 * K\n        hK = h * K\n        \n        # Time integration loop\n        for _ in range(N):\n            # Apply the symplectic map\n            # q_new = (I - h^2 * K) @ q + h * p\n            # p_new = -h * K @ q + p\n            q_new = (I - h2K) @ q + h * p\n            p_new = -hK @ q + p\n            \n            q, p = q_new, p_new\n            \n            current_norm = np.linalg.norm(np.concatenate((q, p)))\n            if current_norm > max_norm:\n                max_norm = current_norm\n        \n        # Calculate R_N and check against threshold\n        R_N = max_norm / norm0\n        return R_N <= R_thresh\n\n    def run_symplecticity_test(K_params, h_factor):\n        \"\"\"\n        Numerically verifies the symplecticity of the one-step map matrix.\n        \"\"\"\n        omega1, omega2, c = K_params\n        \n        K = np.array([\n            [omega1**2 + c, -c],\n            [-c, omega2**2 + c]\n        ])\n        \n        # Calculate max frequency omega_max\n        eigenvalues = np.linalg.eigvalsh(K)\n        lambda_max = np.max(eigenvalues)\n        omega_max = np.sqrt(lambda_max)\n        \n        # Set timestep h\n        h = h_factor / omega_max\n        \n        # Construct the 4x4 matrices\n        I2 = np.identity(2)\n        Z2 = np.zeros((2, 2))\n        \n        # A_h = [[I - h^2*K, h*I], [-h*K, I]]\n        A_h = np.block([\n            [I2 - h**2 * K, h * I2],\n            [-h * K,        I2]\n        ])\n        \n        # Omega = [[0, I], [-I, 0]]\n        Omega = np.block([\n            [Z2,  I2],\n            [-I2, Z2]\n        ])\n        \n        # Verify A_h^T * Omega * A_h = Omega\n        residual = A_h.T @ Omega @ A_h - Omega\n        \n        # Check if the Frobenius norm of the residual is below the tolerance\n        fro_norm = np.linalg.norm(residual, 'fro')\n        return fro_norm < 1e-12\n\n    # Common parameters for all tests\n    K_params = (1.0, 1.6, 0.1)  # (omega1, omega2, c)\n    \n    # Test 1: Happy path, strictly stable\n    # h = 1/omega_max, N=100000, R_N <= 5.0\n    test1_params = (K_params, 1.0, 100000, 5.0)\n    result1 = run_integration_test(test1_params)\n    \n    # Test 2: Near stability boundary\n    # h = 0.999 * 2/omega_max, N=50000, R_N <= 50.0\n    test2_params = (K_params, 0.999 * 2.0, 50000, 50.0)\n    result2 = run_integration_test(test2_params)\n\n    # Test 3: Beyond stability boundary\n    # h = 1.01 * 2/omega_max, N=2000, R_N <= 100.0 (should fail)\n    test3_params = (K_params, 1.01 * 2.0, 2000, 100.0)\n    result3 = run_integration_test(test3_params)\n    \n    # Test 4: Symplecticity of the linear map\n    # h from Test 1, Fro-norm residual < 1e-12\n    result4 = run_symplecticity_test(K_params, 1.0) # h_factor from Test 1\n\n    results = [result1, result2, result3, result4]\n    \n    # Format output as a list of lowercase boolean strings\n    output_str = f\"[{','.join(str(r).lower() for r in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}