{
    "hands_on_practices": [
        {
            "introduction": "我们从一个基础练习开始，它将带我们实践从一个给定的第一类生成函数出发，一步步构建一个完整的正则变换。这个练习旨在巩固生成函数与新旧正则坐标之间的基本关系，并通过直接计算来验证变换的保辛性。通过这个过程，你将能熟练地将在隐式方程中定义的变换，转化为显式的坐标映射关系。",
            "id": "3771596",
            "problem": "考虑实线的余切丛，将其视为一个辛流形，具有典范坐标 $(q,p)$ 和 $(Q,P)$ 以及典范辛2-形式 $\\omega = dq \\wedge dp$。设 $(q,p)$ 和 $(Q,P)$ 之间的变换由一个第一类生成函数 $S(q,Q)$ 生成，即该变换由典范1-形式的恰当性定义，即 $p\\,dq - P\\,dQ = dS$。取指定的生成函数\n$$\nS(q,Q) = \\frac{1}{2} a\\, q^{2} + b\\, q\\, Q + \\frac{1}{2} c\\, Q^{2},\n$$\n其中 $a,b,c \\in \\mathbb{R}$ 且 $b \\neq 0$。\n\n仅从通过生成函数和典范2-形式的典范变换基本定义出发，显式地构造该典范变换。通过求解 $p\\,dq - P\\,dQ = dS$ 导出的关系，推导出作为 $(q,p)$ 函数的 $(Q,P)$，以及作为 $(Q,P)$ 函数的 $(q,p)$。通过证明 $\\phi^{*} \\omega = \\omega$，严格验证该变换是辛变换。\n\n以一个包含四个映射 $Q(q,p)$、$P(q,p)$、$q(Q,P)$ 和 $p(Q,P)$ 的单一表达式的形式提供你的最终答案，并按此顺序排列。不需要数值近似，也不涉及单位。",
            "solution": "该问题是有效的，因为它科学地基于哈密顿力学的原理，问题陈述良好，信息充分且一致，并且客观陈述。条件 $b \\neq 0$ 确保了唯一变换的存在。我们现在开始求解。\n\n该变换由一个第一类生成函数 $S(q,Q)$ 通过关系 $p\\,dq - P\\,dQ = dS$ 定义。该流形是余切丛 $T^*\\mathbb{R}$，具有典范坐标 $(q,p)$ 和典范辛形式 $\\omega = dq \\wedge dp$。给定的生成函数是\n$$\nS(q,Q) = \\frac{1}{2} a\\, q^{2} + b\\, q\\, Q + \\frac{1}{2} c\\, Q^{2}\n$$\n其中 $a, b, c$ 是实常数且 $b \\neq 0$。\n\n首先，我们计算 $S(q,Q)$ 关于其自变量 $q$ 和 $Q$ 的全微分：\n$$\ndS = \\frac{\\partial S}{\\partial q} dq + \\frac{\\partial S}{\\partial Q} dQ\n$$\n$S(q,Q)$ 的偏导数是：\n$$\n\\frac{\\partial S}{\\partial q} = \\frac{\\partial}{\\partial q} \\left(\\frac{1}{2} a\\, q^{2} + b\\, q\\, Q + \\frac{1}{2} c\\, Q^{2}\\right) = a\\,q + b\\,Q\n$$\n$$\n\\frac{\\partial S}{\\partial Q} = \\frac{\\partial}{\\partial Q} \\left(\\frac{1}{2} a\\, q^{2} + b\\, q\\, Q + \\frac{1}{2} c\\, Q^{2}\\right) = b\\,q + c\\,Q\n$$\n将这些代入 $dS$ 的表达式，得到：\n$$\ndS = (a\\,q + b\\,Q) dq + (b\\,q + c\\,Q) dQ\n$$\n通过将其与基本定义 $p\\,dq - P\\,dQ = dS$ 进行比较，我们令微分 $dq$ 和 $dQ$ 的系数相等：\n$$\np = \\frac{\\partial S}{\\partial q} \\implies p = a\\,q + b\\,Q\n$$\n$$\n-P = \\frac{\\partial S}{\\partial Q} \\implies -P = b\\,q + c\\,Q \\implies P = -b\\,q - c\\,Q\n$$\n这两个方程隐式地定义了典范变换。\n\n我们的第一个任务是构造显式变换 $\\phi: (q,p) \\mapsto (Q,P)$，即把 $(Q,P)$ 表示为 $(q,p)$ 的函数。\n从第一个关系式 $p = a\\,q + b\\,Q$，我们解出 $Q$。因为给定 $b \\neq 0$，这总是可能的：\n$$\nb\\,Q = p - a\\,q \\implies Q(q,p) = \\frac{1}{b}(p - a\\,q) = -\\frac{a}{b}q + \\frac{1}{b}p\n$$\n现在，我们将这个 $Q$ 的表达式代入第二个关系式 $P = -b\\,q - c\\,Q$，以求出作为 $(q,p)$ 函数的 $P$：\n$$\nP(q,p) = -b\\,q - c\\left(-\\frac{a}{b}q + \\frac{1}{b}p\\right) = -b\\,q + \\frac{ac}{b}q - \\frac{c}{b}p = \\left(\\frac{ac - b^2}{b}\\right)q - \\frac{c}{b}p\n$$\n这样就完成了正变换 $(q,p) \\mapsto (Q,P)$。\n\n接下来，我们构造逆变换 $\\phi^{-1}: (Q,P) \\mapsto (q,p)$。我们使用相同的两个初始关系式，但这次解出用 $(Q,P)$ 表示的 $(q,p)$。\n从第二个关系式 $P = -b\\,q - c\\,Q$，我们解出 $q$。再次利用 $b \\neq 0$：\n$$\nb\\,q = -P - c\\,Q \\implies q(Q,P) = -\\frac{1}{b}(P + c\\,Q) = -\\frac{c}{b}Q - \\frac{1}{b}P\n$$\n现在，我们将这个 $q$ 的表达式代入第一个关系式 $p = a\\,q + b\\,Q$，以求出作为 $(Q,P)$ 函数的 $p$：\n$$\np(Q,P) = a\\left(-\\frac{c}{b}Q - \\frac{1}{b}P\\right) + b\\,Q = -\\frac{ac}{b}Q - \\frac{a}{b}P + b\\,Q = \\left(\\frac{b^2 - ac}{b}\\right)Q - \\frac{a}{b}P\n$$\n这样就完成了逆变换 $(Q,P) \\mapsto (q,p)$。\n\n任务的最后一部分是严格验证变换 $\\phi$ 是辛变换。如果一个变换保持辛形式，则该变换是辛变换。也就是说，如果 $\\omega = dq \\wedge dp$ 是原始坐标下的辛形式，而 $\\omega' = dQ \\wedge dP$ 是新坐标下的辛形式，我们必须证明 $\\omega'$ 在 $\\phi$ 下的拉回等于 $\\omega$：$\\phi^*\\omega' = \\omega$。\n$$\n\\phi^*\\omega' = \\phi^*(dQ \\wedge dP) = d(\\phi^*Q) \\wedge d(\\phi^*P) = d(Q(q,p)) \\wedge d(P(q,p))\n$$\n我们计算 $Q(q,p)$ 和 $P(q,p)$ 关于 $q$ 和 $p$ 的微分：\n$$\ndQ = \\frac{\\partial Q}{\\partial q}dq + \\frac{\\partial Q}{\\partial p}dp = \\left(-\\frac{a}{b}\\right)dq + \\left(\\frac{1}{b}\\right)dp\n$$\n$$\ndP = \\frac{\\partial P}{\\partial q}dq + \\frac{\\partial P}{\\partial p}dp = \\left(\\frac{ac - b^2}{b}\\right)dq + \\left(-\\frac{c}{b}\\right)dp\n$$\n现在我们计算它们的楔积：\n$$\ndQ \\wedge dP = \\left(-\\frac{a}{b}dq + \\frac{1}{b}dp\\right) \\wedge \\left(\\frac{ac - b^2}{b}dq - \\frac{c}{b}dp\\right)\n$$\n利用楔积的分配律以及恒等式 $dq \\wedge dq = 0$，$dp \\wedge dp = 0$ 和 $dp \\wedge dq = -dq \\wedge dp$，我们得到：\n$$\ndQ \\wedge dP = \\left(-\\frac{a}{b}\\right)\\left(-\\frac{c}{b}\\right)dq \\wedge dp + \\left(\\frac{1}{b}\\right)\\left(\\frac{ac - b^2}{b}\\right)dp \\wedge dq\n$$\n$$\ndQ \\wedge dP = \\left(\\frac{ac}{b^2}\\right)dq \\wedge dp - \\left(\\frac{ac - b^2}{b^2}\\right)dq \\wedge dp\n$$\n合并各项：\n$$\ndQ \\wedge dP = \\left(\\frac{ac - (ac - b^2)}{b^2}\\right)dq \\wedge dp = \\left(\\frac{ac - ac + b^2}{b^2}\\right)dq \\wedge dp\n$$\n$$\ndQ \\wedge dP = \\left(\\frac{b^2}{b^2}\\right)dq \\wedge dp = 1 \\cdot dq \\wedge dp = dq \\wedge dp\n$$\n由于 $dQ \\wedge dP = dq \\wedge dp$，我们证明了 $\\phi^*\\omega' = \\omega$。因此，该变换是辛变换，符合要求。\n\n推导出的四个映射是：\n$Q(q,p) = -\\frac{a}{b}q + \\frac{1}{b}p$\n$P(q,p) = \\frac{ac-b^2}{b}q - \\frac{c}{b}p$\n$q(Q,P) = -\\frac{c}{b}Q - \\frac{1}{b}P$\n$p(Q,P) = \\frac{b^2-ac}{b}Q - \\frac{a}{b}P$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{a}{b}q + \\frac{1}{b}p & \\frac{ac-b^2}{b}q - \\frac{c}{b}p & -\\frac{c}{b}Q - \\frac{1}{b}P & \\frac{b^2-ac}{b}Q - \\frac{a}{b}P\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在掌握了基本的代数构造后，我们转向一个更深刻的概念性问题，它揭示了相空间的几何结构所扮演的关键角色。这个练习将引导我们探究一个辛向量场为何不一定是哈密顿场，其根本原因在于流形自身的拓扑性质。通过在一个圆柱形相空间上的思想实验，我们将理解并非所有保持辛结构的变换（即辛同胚）都源于一个全局的哈密顿函数。",
            "id": "3771565",
            "problem": "考虑辛流形 $\\left(M,\\omega\\right)$，其中 $M = S^{1} \\times \\mathbb{R}$，$S^{1}$ 是圆周，$\\mathbb{R}$ 是实直线。在 $M$ 上使用全局坐标 $(\\theta,I)$，其中 $\\theta$ 是 $S^{1}$ 上的角度坐标，$I$ 是 $\\mathbb{R}$ 上的坐标。设辛形式为 $\\omega = d\\theta \\wedge dI$。回顾以下定义作为您的基本依据：如果李导数 $\\mathcal{L}_{X}\\omega = 0$，则称 $M$ 上的光滑矢量场 $X$ 为辛矢量场；如果存在一个光滑函数 $H \\in C^{\\infty}(M)$ 使得 $\\iota_{X}\\omega = dH$，则称 $X$ 为哈密顿矢量场。时间无关矢量场 $X$ 的相流 $\\varphi_{t}$ 是由 $X$ 通过 $\\frac{d}{dt} \\varphi_{t}(z) = X\\left(\\varphi_{t}(z)\\right)$（对于 $z \\in M$）生成的单参数微分同胚族；若一个微分同胚在拉回作用下保持 $\\omega$ 不变，则称其为辛同胚。\n\n使用 $M$ 上的时间无关矢量场 $X = \\frac{\\partial}{\\partial I}$，并按如下步骤进行，仅从上述核心定义和已证实的结论（嘉当公式 $\\mathcal{L}_{X}\\omega = d\\left(\\iota_{X}\\omega\\right) + \\iota_{X}d\\omega$ 以及 de Rham 上同调中恰当形式和闭形式的性质）出发：\n\n1. 显式推导 $\\iota_{X}\\omega$ 并使用嘉当公式判断 $X$ 是否为辛矢量场。\n2. 通过分析 $\\iota_{X}\\omega$ 在 $S^{1} \\times \\mathbb{R}$ 上的全局恰当性来评估 $X$ 是否为哈密顿矢量场。通过计算沿 $S^{1}$ 中一个非平凡环路的线积分，并利用恰当 1-形式在闭合环路上的积分为零的判据来证明您的结论。\n3. 计算 $X$ 的相流 $\\varphi_{t}$，并证明它保持 $\\omega$ 不变，从而得出结论 $\\varphi_{t}$ 是一个单参数辛同胚族。\n4. 考虑可观测量 $H(\\theta,I) = I + \\cos\\theta$。确定沿 $X$ 的相流的时间导数 $\\frac{d}{dt}H\\left(\\varphi_{t}(\\theta_{0},I_{0})\\right)$，将您的结果表示为一个与初始条件 $(\\theta_{0},I_{0})$ 无关的实数。\n5. 在泛复叠 $\\mathbb{R} \\times \\mathbb{R}$ 上，使用对应于 $(\\theta,I)$ 的坐标 $(q,p)$，为辛同胚 $\\varphi_{t}$ 构建一个 II 型母函数 $F_{2}(q,P;t)$，并验证能够产生 $Q = q$ 和 $P = p + t$ 的典则关系 $p = \\frac{\\partial F_{2}}{\\partial q}$ 和 $Q = \\frac{\\partial F_{2}}{\\partial P}$。\n\n您的最终答案必须是第 4 项所要求的量的精确值。无需四舍五入。",
            "solution": "用户提供了一个几何力学领域的多部分问题。我将首先验证问题陈述，如果认为有效，则将进行分步解答。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n- 流形：$(M, \\omega)$，其中 $M = S^1 \\times \\mathbb{R}$，全局坐标为 $(\\theta, I)$。\n- 辛形式：$\\omega = d\\theta \\wedge dI$。\n- 定义（辛矢量场）：如果 $\\mathcal{L}_X \\omega = 0$，则矢量场 $X$ 是辛矢量场。\n- 定义（哈密顿矢量场）：如果 $\\exists H \\in C^\\infty(M)$ 使得 $\\iota_X \\omega = dH$，则矢量场 $X$ 是哈密顿矢量场。\n- 定义（相流）：$X$ 的相流 $\\varphi_t$ 由 $\\frac{d}{dt}\\varphi_t(z) = X(\\varphi_t(z))$ 给出。\n- 定义（辛同胚）：如果 $\\psi^*\\omega = \\omega$，则微分同胚 $\\psi$ 是一个辛同胚。\n- 给定矢量场：$X = \\frac{\\partial}{\\partial I}$。\n- 给定可观测量：$H(\\theta, I) = I + \\cos\\theta$。\n- 提供的工具：嘉当公式，$\\mathcal{L}_X\\omega = d(\\iota_X\\omega) + \\iota_X d\\omega$。\n\n**第 2 步：使用提取的已知条件进行验证**\n该问题在科学上是成立的，是辛几何中的一个标准练习。它是一个适定问题，每个部分都有一个可以从已知条件推导出的明确目标。语言客观且无歧义。问题设置是完整和一致的，展示了一个非单连通流形上辛但非哈密顿矢量场的经典例子，这是该领域的一个关键概念。不存在科学或逻辑上的缺陷。\n\n**第 3 步：结论与行动**\n问题有效。我现在开始解答。\n\n### 详细解答\n\n**第 1 部分：判断 $X$ 是否为辛矢量场**\n\n首先，我们计算矢量场 $X = \\frac{\\partial}{\\partial I}$ 与辛形式 $\\omega = d\\theta \\wedge dI$ 的内积 $\\iota_X \\omega$。\n$$\n\\iota_X \\omega = \\iota_{\\frac{\\partial}{\\partial I}} (d\\theta \\wedge dI)\n$$\n使用性质 $\\iota_V(A \\wedge B) = (\\iota_V A) \\wedge B - A \\wedge (\\iota_V B)$，我们有：\n$$\n\\iota_{\\frac{\\partial}{\\partial I}} (d\\theta \\wedge dI) = \\left(\\iota_{\\frac{\\partial}{\\partial I}} d\\theta\\right) \\wedge dI - d\\theta \\wedge \\left(\\iota_{\\frac{\\partial}{\\partial I}} dI\\right)\n$$\n内积作用在矢量场上即为求值：\n$$\n\\iota_{\\frac{\\partial}{\\partial I}} d\\theta = d\\theta\\left(\\frac{\\partial}{\\partial I}\\right) = 0\n$$\n$$\n\\iota_{\\frac{\\partial}{\\partial I}} dI = dI\\left(\\frac{\\partial}{\\partial I}\\right) = 1\n$$\n将这些代回，我们发现：\n$$\n\\iota_X \\omega = (0) \\wedge dI - d\\theta \\wedge (1) = -d\\theta\n$$\n现在，我们使用嘉当公式 $\\mathcal{L}_X \\omega = d(\\iota_X \\omega) + \\iota_X(d\\omega)$ 来检查 $X$ 是否为辛矢量场。辛形式 $\\omega$ 是一个 2-维流形上的 2-形式，因此其外微分 $d\\omega$ 必然是一个 3-形式，从而恒等于零。具体来说：\n$$\nd\\omega = d(d\\theta \\wedge dI) = d(d\\theta) \\wedge dI - d\\theta \\wedge d(dI) = 0 \\wedge dI - d\\theta \\wedge 0 = 0\n$$\n由于 $d\\omega=0$，形式 $\\omega$ 是闭的。因此，嘉当公式中的第二项为 $\\iota_X(d\\omega) = \\iota_X(0) = 0$。\n第一项是 $\\iota_X \\omega$ 的外微分：\n$$\nd(\\iota_X \\omega) = d(-d\\theta) = -d(d\\theta) = 0\n$$\n因为 $d^2 = 0$。\n因此，李导数为：\n$$\n\\mathcal{L}_X \\omega = 0 + 0 = 0\n$$\n因为 $\\mathcal{L}_X \\omega = 0$，所以矢量场 $X = \\frac{\\partial}{\\partial I}$ 是辛矢量场。\n\n**第 2 部分：评估 $X$ 是否为哈密顿矢量场**\n\n如果 1-形式 $\\iota_X \\omega$ 是恰当的，即存在一个全局函数 $H \\in C^\\infty(M)$ 使得 $dH = \\iota_X \\omega$，则矢量场 $X$ 是哈密顿矢量场。从第 1 部分，我们有 $\\iota_X \\omega = -d\\theta$。我们必须确定 $-d\\theta$ 在流形 $M = S^1 \\times \\mathbb{R}$ 上是否为恰当形式。\n\n根据斯托克斯定理（或者更基本地，根据恰当形式的定义），一个恰当 1-形式在任何闭合环路上的积分必须为零。让我们考虑 $M$ 上的一个非平凡闭合环路。一个自然的选择是固定 $I$ 值的圆周 $S^1$，比如 $I=I_0$。我们可以将此环路 $\\gamma$ 参数化为 $\\theta$ 从 $0$ 跑到 $2\\pi$。\n线积分为：\n$$\n\\int_{\\gamma} \\iota_X \\omega = \\int_{\\gamma} (-d\\theta) = \\int_{0}^{2\\pi} (-1) \\, d\\theta = -[\\theta]_{0}^{2\\pi} = -(2\\pi - 0) = -2\\pi\n$$\n由于在闭合环路 $\\gamma$ 上的积分为 $-2\\pi \\neq 0$，所以 1-形式 $-d\\theta$ 在 $S^1 \\times \\mathbb{R}$ 上不是恰当的。因此，不存在全局定义的光滑函数 $H$ 使得 $dH = -d\\theta$。所以，矢量场 $X$ 不是哈密顿矢量场。这是一个辛但非哈密顿矢量场的例子。\n\n**第 3 部分：计算相流 $\\varphi_t$ 并证明其为辛同胚**\n\n相流 $\\varphi_t(\\theta_0, I_0) = (\\theta(t), I(t))$ 由矢量场 $X = 0 \\cdot \\frac{\\partial}{\\partial \\theta} + 1 \\cdot \\frac{\\partial}{\\partial I}$ 生成。相应的常微分方程组是：\n$$\n\\frac{d\\theta}{dt} = 0, \\quad \\frac{dI}{dt} = 1\n$$\n对于初始条件 $(\\theta(0), I(0)) = (\\theta_0, I_0)$，解为：\n$$\n\\theta(t) = \\theta_0, \\quad I(t) = I_0 + t\n$$\n所以，相流由映射 $\\varphi_t: M \\to M$ 给出：\n$$\n\\varphi_t(\\theta_0, I_0) = (\\theta_0, I_0 + t)\n$$\n为了证明 $\\varphi_t$ 是一个辛同胚族，我们必须验证它在拉回作用下保持辛形式不变，即 $\\varphi_t^* \\omega = \\omega$。\n设目标空间中的坐标为 $(\\theta', I') = \\varphi_t(\\theta, I) = (\\theta, I+t)$。所以，$\\theta' = \\theta$ 且 $I' = I+t$。我们用新坐标表示旧坐标：$\\theta = \\theta'$，$I = I' - t$。\n拉回 $\\varphi_t^* \\omega$ 计算如下：\n$$\n\\varphi_t^* \\omega = \\varphi_t^* (d\\theta \\wedge dI) = d(\\theta \\circ \\varphi_t) \\wedge d(I \\circ \\varphi_t)\n$$\n复合函数为 $\\theta \\circ \\varphi_t(\\theta,I) = \\theta$ 和 $I \\circ \\varphi_t(\\theta,I) = I+t$。因此：\n$$\n\\varphi_t^* \\omega = d(\\theta) \\wedge d(I+t)\n$$\n由于 $t$ 是一个参数而不是流形上的坐标，所以 $d(I+t) = dI$。因此，\n$$\n\\varphi_t^* \\omega = d\\theta \\wedge dI = \\omega\n$$\n辛形式的拉回是它自身。因此，$\\varphi_t$ 是一个单参数辛同胚族。\n\n**第 4 部分：计算 $H$ 沿流的时间导数**\n\n我们需要计算 $\\frac{d}{dt}H(\\varphi_t(\\theta_0, I_0))$，其中 $H(\\theta, I) = I + \\cos\\theta$。\n首先，沿轨迹 $\\varphi_t(\\theta_0, I_0) = (\\theta_0, I_0 + t)$ 计算 $H$ 的值：\n$$\nH(\\varphi_t(\\theta_0, I_0)) = H(\\theta_0, I_0 + t) = (I_0 + t) + \\cos(\\theta_0)\n$$\n现在，对这个表达式关于 $t$ 求导。初始条件 $(\\theta_0, I_0)$ 是关于时间 $t$ 的常数。\n$$\n\\frac{d}{dt} \\left( (I_0 + t) + \\cos(\\theta_0) \\right) = \\frac{d}{dt}(I_0) + \\frac{d}{dt}(t) + \\frac{d}{dt}(\\cos(\\theta_0)) = 0 + 1 + 0 = 1\n$$\n另外，一个可观测量 $f$ 沿着矢量场 $X$ 的流的变化率由李导数 $\\mathcal{L}_X f$ 给出，对于一个函数 $f$ 来说，这就是方向导数 $X(f)$。\n$$\n\\frac{d}{dt} H(\\varphi_t) = \\mathcal{L}_X H = X(H) = \\frac{\\partial}{\\partial I}(I + \\cos\\theta) = \\frac{\\partial I}{\\partial I} + \\frac{\\partial(\\cos\\theta)}{\\partial I} = 1 + 0 = 1\n$$\n结果是一个常实数，1。\n\n**第 5 部分：构造 II 型母函数**\n\n我们在泛复叠 $\\mathbb{R} \\times \\mathbb{R}$ 上工作，坐标为 $(q,p)$，对应于 $(\\theta,I)$。辛映射为 $\\varphi_t: (q,p) \\mapsto (Q,P)$，其中\n$$\nQ = q, \\quad P = p+t\n$$\n一个 II 型母函数 $F_2(q, P; t)$ 依赖于旧的位置坐标 $q$ 和新的动量坐标 $P$。它由以下关系定义：\n$$\np = \\frac{\\partial F_2}{\\partial q}, \\quad Q = \\frac{\\partial F_2}{\\partial P}\n$$\n从变换中，我们有 $p = P-t$ 和 $Q=q$。将这些代入定义关系中：\n$$\nP-t = \\frac{\\partial F_2(q, P; t)}{\\partial q}\n$$\n$$\nq = \\frac{\\partial F_2(q, P; t)}{\\partial P}\n$$\n对第二个方程关于 $P$ 积分：\n$$\nF_2(q, P; t) = \\int q \\, dP = qP + g(q; t)\n$$\n其中 $g(q; t)$ 是关于 $q$ 和参数 $t$ 的任意函数。\n将这个 $F_2$ 的表达式代入第一个定义关系中：\n$$\nP-t = \\frac{\\partial}{\\partial q} (qP + g(q; t)) = P + \\frac{\\partial g(q; t)}{\\partial q}\n$$\n这简化为：\n$$\n\\frac{\\partial g(q; t)}{\\partial q} = -t\n$$\n对 $q$ 积分：\n$$\ng(q; t) = \\int (-t) \\, dq = -tq + C(t)\n$$\n其中 $C(t)$ 是关于 $t$ 的任意函数。我们可以选择 $C(t)=0$，因为它不影响典则变换。\n因此，该变换的一个 II 型母函数是：\n$$\nF_2(q, P; t) = qP - tq\n$$\n让我们验证这是否生成了正确的变换。\n$$\np = \\frac{\\partial F_2}{\\partial q} = \\frac{\\partial}{\\partial q}(qP - tq) = P-t \\implies P = p+t\n$$\n$$\nQ = \\frac{\\partial F_2}{\\partial P} = \\frac{\\partial}{\\partial P}(qP - tq) = q\n$$\n这些关系正确地产生了映射 $(q,p) \\mapsto (q, p+t)$。\n\n问题要求给出第 4 部分的单一数值答案。\n结果是 1。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "最后，我们将理论与现代计算物理实践联系起来，展示生成函数概念在设计数值算法中的强大应用。这个问题引导我们如何将连续的生成函数思想“离散化”，从而构造出能够在长时间模拟中保持哈密顿系统几何结构的辛积分算法。这揭示了辛几何在确保数值解的长期稳定性和定性准确性方面的实际价值，这在天体力学和分子动力学等领域至关重要。",
            "id": "3771622",
            "problem": "给定一个相空间为 $\\mathbb{R}^{2n}$ 的哈密顿系统，其正则坐标为 $(q,p) \\in \\mathbb{R}^n \\times \\mathbb{R}^n$，正则辛形式为 $\\omega = \\sum_{i=1}^n dq_i \\wedge dp_i$。考虑 $n=2$ 的耦合二次哈密顿量，\n$$\nH(q,p) = \\tfrac{1}{2} p^\\top p + \\tfrac{1}{2} q^\\top K q,\n$$\n其中 $K \\in \\mathbb{R}^{2 \\times 2}$ 是一个对称正定矩阵，表示两个振荡模式的线性耦合。其连续时间流由哈密顿方程确定，\n$$\n\\dot{q} = \\frac{\\partial H}{\\partial p}(q,p), \\quad \\dot{p} = -\\frac{\\partial H}{\\partial q}(q,p).\n$$\n对于时间步长 $h>0$，使用第二类离散生成函数 $S_h(q_k,p_{k+1})$ 构建一个离散时间辛映射 $(q_k,p_k) \\mapsto (q_{k+1},p_{k+1})$。仅使用由 $S_h$ 生成的正则变换的基本定义以及 $H(q,p)$ 的结构，推导一个用 $(q_k,p_k)$、$h$ 和 $K$ 表示 $(q_{k+1},p_{k+1})$ 的显式更新法则。然后，对于此线性二次情形，以分块形式构建单步映射的 $4 \\times 4$ 雅可比矩阵 $A_h$，并通过检验条件\n$$\nA_h^\\top \\Omega A_h = \\Omega, \\quad \\text{其中} \\quad \\Omega = \\begin{bmatrix} 0 & I \\\\ -I & 0 \\end{bmatrix},\n$$\n来验证它是一个辛矩阵，其中 $I$ 是 $2 \\times 2$ 单位矩阵，$0$ 是 $2 \\times 2$ 零矩阵。\n\n使用推导出的辛映射，实现一个长时间数值积分，并通过监测其有界性来验证长时间稳定性。使用相空间上的欧几里得范数 $\\|(q,p)\\|_2 = \\sqrt{\\|q\\|_2^2 + \\|p\\|_2^2}$，并定义\n$$\nR_N = \\frac{\\max_{0 \\le k \\le N} \\|(q_k,p_k)\\|_2}{\\|(q_0,p_0)\\|_2}.\n$$\n如果 $R_N$ 低于一个预设的阈值，则认为该轨迹在 $N$ 步内是数值上长时间稳定的。在你的代码中不要使用任何先验稳定性判据来判断稳定性；应根据计算出的轨迹来评估。\n\n你的程序必须通过离散生成函数构建离散辛映射，实现时间步进，并评估以下测试套件。所有量都是无量纲的。\n\n需要使用的定义：\n- 第二类生成函数 $S(q,P)$ 通过 $p = \\partial S/\\partial q$ 和 $Q = \\partial S/\\partial P$ 生成一个正则变换 $(q,p) \\mapsto (Q,P)$。\n- 对于哈密顿量 $H(q,p) = T(p) + V(q)$，其梯度满足 $\\partial H/\\partial q = \\nabla V(q)$ 和 $\\partial H/\\partial p = \\nabla T(p)$。\n- 最大自然频率为 $\\omega_{\\max} = \\sqrt{\\lambda_{\\max}(K)}$，其中 $\\lambda_{\\max}(K)$ 是 $K$ 的最大特征值。\n\n测试套件：\n- 对于所有测试，设耦合矩阵为\n  $$\n  K(\\omega_1,\\omega_2,c) = \\begin{bmatrix} \\omega_1^2 + c & -c \\\\ -c & \\omega_2^2 + c \\end{bmatrix}.\n  $$\n  初始条件固定为 $q_0 = [1.0,\\,0.5]^\\top$ 和 $p_0 = [0.0,\\,-0.3]^\\top$。\n\n- 测试 1 (正常情况，严格稳定)：参数 $\\omega_1 = 1.0$，$\\omega_2 = 1.6$，$c = 0.1$。从 $K$ 计算 $\\omega_{\\max}$，设置 $h = \\frac{1}{\\omega_{\\max}}$（即线性稳定性极限的一半），并积分 $N=100000$ 步。通过检查 $R_N \\le 5.0$ 来判断稳定性。\n\n- 测试 2 (接近稳定性边界)：$\\omega_1$、$\\omega_2$、$c$ 与测试 1 相同。设置 $h = 0.999 \\cdot \\frac{2}{\\omega_{\\max}}$ 并积分 $N=50000$ 步。通过检查 $R_N \\le 50.0$ 来判断稳定性。\n\n- 测试 3 (超出稳定性边界)：$\\omega_1$、$\\omega_2$、$c$ 与测试 1 相同。设置 $h = 1.01 \\cdot \\frac{2}{\\omega_{\\max}}$ 并积分 $N=2000$ 步。通过检查 $R_N \\le 100.0$ 来判断稳定性；此测试应失败。\n\n- 测试 4 (线性映射的辛性)：使用测试 1 中的 $K$ 和 $h$，以分块形式构建单步映射矩阵 $A_h$。通过要求残差的弗罗贝尼乌斯范数小于 $10^{-12}$，来数值上验证辛性条件 $A_h^\\top \\Omega A_h = \\Omega$。\n\n你的程序应产生单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表（例如，\"[result1,result2,result3,result4]\"），每个结果都是一个布尔值，按顺序对应于各个测试。",
            "solution": "用户提供的问题经评估是有效的，因为它在科学上基于哈密顿力学和几何数值积分，问题是适定的，具有清晰的理论推导和具体的数值测试，并使用标准数学术语进行了客观表述。\n\n在此，我们推导该辛映射，验证其性质，并概述针对指定数值测试的实现方案。\n\n该系统由相空间 $\\mathbb{R}^4$ 上的两个耦合谐振子的哈密顿量描述：\n$$\nH(q,p) = \\tfrac{1}{2} p^\\top p + \\tfrac{1}{2} q^\\top K q\n$$\n其中 $q = (q_1, q_2)^\\top \\in \\mathbb{R}^2$，$p = (p_1, p_2)^\\top \\in \\mathbb{R}^2$，并且 $K \\in \\mathbb{R}^{2 \\times 2}$ 是一个对称正定矩阵。该哈密顿量可分离为一个动能项 $T(p) = \\tfrac{1}{2} p^\\top p$ 和一个势能项 $V(q) = \\tfrac{1}{2} q^\\top K q$。\n\n我们的任务是使用第二类生成函数 $S_h(q_k, p_{k+1})$ 为时间步长 $h > 0$ 构建一个辛映射 $(q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$。对于可分哈密顿量，近似其时间-$h$流的生成函数的一个标准选择是基于辛分裂法。具体来说，我们使用的生成函数对应于 $V(q)$ 在时间 $h$ 内的精确流与 $T(p)$ 在时间 $h$ 内的精确流的复合。该积分器被称为辛欧拉B方法。其第二类生成函数由下式给出：\n$$\nS_h(q_k, p_{k+1}) = q_k^\\top p_{k+1} + h \\left( T(p_{k+1}) + V(q_k) \\right)\n$$\n代入 $T$ 和 $V$ 的表达式，我们得到：\n$$\nS_h(q_k, p_{k+1}) = q_k^\\top p_{k+1} + h \\left( \\tfrac{1}{2} p_{k+1}^\\top p_{k+1} + \\tfrac{1}{2} q_k^\\top K q_k \\right)\n$$\n第二类生成函数 $S(q, P)$ 通过关系式 $p = \\frac{\\partial S}{\\partial q}$ 和 $Q = \\frac{\\partial S}{\\partial P}$ 定义了一个从坐标 $(q,p)$ 到 $(Q,P)$ 的正则变换。对于我们的离散映射，我们将“旧”坐标视为 $(q_k, p_k)$，“新”坐标视为 $(q_{k+1}, p_{k+1})$。生成函数 $S_h(q_k, p_{k+1})$ 具有 $S(q_k, P_{k+1})$ 的形式，其中使用 $P_{k+1}$ 代替 $p_{k+1}$ 来表示它是 $S_h$ 的一个自变量。然而，为了在映射的上下文中保持清晰，我们保留 $p_{k+1}$ 记法。因此，变换关系为：\n$$\np_k = \\frac{\\partial S_h(q_k, p_{k+1})}{\\partial q_k} \\quad \\text{和} \\quad q_{k+1} = \\frac{\\partial S_h(q_k, p_{k+1})}{\\partial p_{k+1}}\n$$\n我们计算这些偏导数：\n$$\n\\frac{\\partial S_h}{\\partial q_k} = p_{k+1} + h \\frac{\\partial}{\\partial q_k} \\left( \\tfrac{1}{2} q_k^\\top K q_k \\right) = p_{k+1} + h K q_k\n$$\n$$\n\\frac{\\partial S_h}{\\partial p_{k+1}} = q_k + h \\frac{\\partial}{\\partial p_{k+1}} \\left( \\tfrac{1}{2} p_{k+1}^\\top p_{k+1} \\right) = q_k + h p_{k+1}\n$$\n将它们分别设为 $p_k$ 和 $q_{k+1}$，我们得到以下隐式更新法则：\n$$\np_k = p_{k+1} + h K q_k\n$$\n$$\nq_{k+1} = q_k + h p_{k+1}\n$$\n为了获得一个显式映射 $(q_k, p_k) \\mapsto (q_{k+1}, p_{k+1})$，我们重排第一个方程以求解 $p_{k+1}$：\n$$\np_{k+1} = p_k - h K q_k\n$$\n然后，我们将此表达式代入第二个方程：\n$$\nq_{k+1} = q_k + h(p_k - h K q_k) = (I - h^2 K)q_k + h p_k\n$$\n其中 $I$ 是 $2 \\times 2$ 单位矩阵。这就构成了显式单步映射。\n\n为了进行辛性验证，我们将该映射表示为线性矩阵形式。令 $z_k = (q_k^\\top, p_k^\\top)^\\top \\in \\mathbb{R}^4$ 为状态向量。映射 $z_k \\mapsto z_{k+1}$ 由 $z_{k+1} = A_h z_k$ 给出，其中 $A_h$ 是 $4 \\times 4$ 的分块矩阵：\n$$\nA_h = \\begin{bmatrix} I - h^2 K & hI \\\\ -hK & I \\end{bmatrix}\n$$\n如果一个矩阵 $A$ 保持标准辛形式不变，则它是辛矩阵。标准辛形式由矩阵 $\\Omega = \\begin{bmatrix} 0 & I \\\\ -I & 0 \\end{bmatrix}$ 表征。辛性条件是 $A_h^\\top \\Omega A_h = \\Omega$。我们来验证这个条件。$A_h$ 的转置是：\n$$\nA_h^\\top = \\begin{bmatrix} (I - h^2 K)^\\top & (-hK)^\\top \\\\ (hI)^\\top & I^\\top \\end{bmatrix} = \\begin{bmatrix} I - h^2 K & -hK \\\\ hI & I \\end{bmatrix}\n$$\n因为 $K$ 和 $I$ 都是对称的。\n我们计算乘积 $A_h^\\top \\Omega A_h$：\n\\begin{align*}\nA_h^\\top \\Omega A_h &= \\begin{bmatrix} I - h^2 K & -hK \\\\ hI & I \\end{bmatrix} \\begin{bmatrix} 0 & I \\\\ -I & 0 \\end{bmatrix} \\begin{bmatrix} I - h^2 K & hI \\\\ -hK & I \\end{bmatrix} \\\\\n&= \\begin{bmatrix} (I - h^2 K)(0) + (-hK)(-I) & (I - h^2 K)(I) + (-hK)(0) \\\\ (hI)(0) + (I)(-I) & (hI)(I) + (I)(0) \\end{bmatrix} \\begin{bmatrix} I - h^2 K & hI \\\\ -hK & I \\end{bmatrix} \\\\\n&= \\begin{bmatrix} hK & I - h^2 K \\\\ -I & hI \\end{bmatrix} \\begin{bmatrix} I - h^2 K & hI \\\\ -hK & I \\end{bmatrix} \\\\\n&= \\begin{bmatrix} (hK)(I - h^2 K) + (I - h^2 K)(-hK) & (hK)(hI) + (I - h^2 K)(I) \\\\ (-I)(I - h^2 K) + (hI)(-hK) & (-I)(hI) + (hI)(I) \\end{bmatrix} \\\\\n&= \\begin{bmatrix} hK - h^3K^2 - hK + h^3K^2 & h^2K + I - h^2K \\\\ -I + h^2K - h^2K & -hI + hI \\end{bmatrix} \\\\\n&= \\begin{bmatrix} 0 & I \\\\ -I & 0 \\end{bmatrix} = \\Omega\n\\end{align*}\n条件得到满足，证实了推导出的映射 $A_h$ 确实是辛的。这个理论验证将在测试 4 中得到数值证实。\n\n对于线性系统 $\\dot{z} = \\begin{pmatrix} 0 & I \\\\ -K & 0 \\end{pmatrix}z$，此映射的数值稳定性取决于放大矩阵 $A_h$ 的特征值。如果 $A_h$ 的所有特征值的模都小于或等于 $1$，则该方法是稳定的。对于辛欧拉积分器，这导出了线性稳定性条件 $0 \\le h \\le 2/\\omega_{\\max}$，其中 $\\omega_{\\max} = \\sqrt{\\lambda_{\\max}(K)}$ 是系统的最高自然频率。这些数值测试旨在探测这个稳定性边界。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by deriving and implementing a symplectic integrator\n    for a coupled quadratic Hamiltonian system, and running a suite of tests.\n    \"\"\"\n\n    def run_integration_test(params):\n        \"\"\"\n        Runs a single numerical integration test case.\n        \"\"\"\n        K_params, h_factor, N, R_thresh = params\n        omega1, omega2, c = K_params\n        \n        q0 = np.array([1.0, 0.5])\n        p0 = np.array([0.0, -0.3])\n        \n        K = np.array([\n            [omega1**2 + c, -c],\n            [-c, omega2**2 + c]\n        ])\n        \n        # Calculate max frequency omega_max\n        eigenvalues = np.linalg.eigvalsh(K)\n        lambda_max = np.max(eigenvalues)\n        omega_max = np.sqrt(lambda_max)\n        \n        # Set timestep h\n        h = h_factor / omega_max\n        \n        # Initialize state\n        q, p = q0.copy(), p0.copy()\n        \n        # Initial norm\n        norm0 = np.linalg.norm(np.concatenate((q, p)))\n        if norm0 == 0:\n            return True # Trivial case, stable\n        max_norm = norm0\n        \n        # Precompute matrices for the map\n        I = np.identity(2)\n        h2K = h**2 * K\n        hK = h * K\n        \n        # Time integration loop\n        for _ in range(N):\n            # Apply the symplectic map\n            # q_new = (I - h^2 * K) @ q + h * p\n            # p_new = -h * K @ q + p\n            q_new = (I - h2K) @ q + h * p\n            p_new = -hK @ q + p\n            \n            q, p = q_new, p_new\n            \n            current_norm = np.linalg.norm(np.concatenate((q, p)))\n            if current_norm > max_norm:\n                max_norm = current_norm\n        \n        # Calculate R_N and check against threshold\n        R_N = max_norm / norm0\n        return R_N <= R_thresh\n\n    def run_symplecticity_test(K_params, h_factor):\n        \"\"\"\n        Numerically verifies the symplecticity of the one-step map matrix.\n        \"\"\"\n        omega1, omega2, c = K_params\n        \n        K = np.array([\n            [omega1**2 + c, -c],\n            [-c, omega2**2 + c]\n        ])\n        \n        # Calculate max frequency omega_max\n        eigenvalues = np.linalg.eigvalsh(K)\n        lambda_max = np.max(eigenvalues)\n        omega_max = np.sqrt(lambda_max)\n        \n        # Set timestep h\n        h = h_factor / omega_max\n        \n        # Construct the 4x4 matrices\n        I2 = np.identity(2)\n        Z2 = np.zeros((2, 2))\n        \n        # A_h = [[I - h^2*K, h*I], [-h*K, I]]\n        A_h = np.block([\n            [I2 - h**2 * K, h * I2],\n            [-h * K,        I2]\n        ])\n        \n        # Omega = [[0, I], [-I, 0]]\n        Omega = np.block([\n            [Z2,  I2],\n            [-I2, Z2]\n        ])\n        \n        # Verify A_h^T * Omega * A_h = Omega\n        residual = A_h.T @ Omega @ A_h - Omega\n        \n        # Check if the Frobenius norm of the residual is below the tolerance\n        fro_norm = np.linalg.norm(residual, 'fro')\n        return fro_norm < 1e-12\n\n    # Common parameters for all tests\n    K_params = (1.0, 1.6, 0.1)  # (omega1, omega2, c)\n    \n    # Test 1: Happy path, strictly stable\n    # h = 1/omega_max, N=100000, R_N <= 5.0\n    test1_params = (K_params, 1.0, 100000, 5.0)\n    result1 = run_integration_test(test1_params)\n    \n    # Test 2: Near stability boundary\n    # h = 0.999 * 2/omega_max, N=50000, R_N <= 50.0\n    test2_params = (K_params, 0.999 * 2.0, 50000, 50.0)\n    result2 = run_integration_test(test2_params)\n\n    # Test 3: Beyond stability boundary\n    # h = 1.01 * 2/omega_max, N=2000, R_N <= 100.0 (should fail)\n    test3_params = (K_params, 1.01 * 2.0, 2000, 100.0)\n    result3 = run_integration_test(test3_params)\n    \n    # Test 4: Symplecticity of the linear map\n    # h from Test 1, Fro-norm residual < 1e-12\n    result4 = run_symplecticity_test(K_params, 1.0) # h_factor from Test 1\n\n    results = [result1, result2, result3, result4]\n    \n    # Format output as a list of lowercase boolean strings\n    output_str = f\"[{','.join(str(r).lower() for r in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}