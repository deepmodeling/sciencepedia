{
    "hands_on_practices": [
        {
            "introduction": "这项练习将引导我们进行一次基础性的探索。我们首先从一个简单系统的拉格朗日量出发，推导庞加莱-嘉当1-形式的具体表达式。然后，我们将为一个经典的谐振子系统计算环路积分 $\\oint p\\,dq$ 的值，最后通过第一性原理严格证明该积分在哈密顿流下的不变性 ()。这个练习旨在从头开始，为我们理解庞加莱-嘉当积分不变量奠定坚实的理论基础。",
            "id": "3780954",
            "problem": "考虑一个一维力学系统，其位形坐标为 $q$，质量参数为 $m>0$，势为一个光滑函数 $V(q)$。系统的动力学由拉格朗日量 $L(q,\\dot{q})=\\tfrac{1}{2}m\\dot{q}^{2}-V(q)$ 描述。在坐标为 $(q,p,t)$ 的扩展相空间中进行计算，其中 $p$ 表示与 $q$ 共轭的正则动量，$t$ 是时间坐标。\n\n(a) 从作用量原理以及拉格朗日和哈密顿描述之间的勒让德变换出发，推导与拉格朗日量 $L(q,\\dot{q})=\\tfrac{1}{2}m\\dot{q}^{2}-V(q)$ 相关的Poincaré–Cartan 1-形式 $\\Theta_{L}$。你的推导必须从正则动量和能量函数的定义开始，并得出一个在 $(q,p,t)$ 上的 $\\Theta_{L}$ 的显式解析表达式。\n\n(b) 考虑谐振子势 $V(q)=\\tfrac{1}{2}m\\omega^{2}q^{2}$ 的特殊情况，其中 $\\omega>0$。考虑一个能量为 $E>0$ 的非平凡周期解，并沿着该解运动一个完整周期，在扩展相空间中形成闭合轨道 $\\gamma$。计算闭合线积分 $J=\\oint_{\\gamma}p\\,dq$，并仅用 $E$ 和 $\\omega$ 表示你的答案。你的最终答案应为一个单个的闭式解析表达式。\n\n(c) 使用几何力学的第一性原理，验证该系统的Poincaré–Cartan积分不变量：证明对于任何由欧拉-拉格朗日流携带的光滑单参数闭合曲线族 $\\Gamma_{t}$，量 $I(t)=\\oint_{\\Gamma_{t}}\\Theta_{L}$ 与 $t$ 无关。你的验证过程必须从关于李导数的Cartan恒等式和 $\\Theta_{L}$ 的外微分开始，且不得将该不变量作为一个已知事实来假设。\n\n最终提交的答案是(b)部分得到的 $J$ 的表达式。不需要进行数值近似。",
            "solution": "该问题陈述被评估为有效。它科学地植根于经典力学和几何力学的既定原理，提供了一套完备且一致的定义和约束，并且是适定的，能够导出一个唯一且有意义的解。该问题是客观且可形式化的，要求在其指定领域内进行标准的推导和计算。\n\n(a) 我们的任务是为拉格朗日量 $L(q, \\dot{q}) = \\frac{1}{2}m\\dot{q}^{2} - V(q)$ 推导Poincaré–Cartan 1-形式 $\\Theta_{L}$。推导从正则动量和哈密顿量的定义开始。\n\n与坐标 $q$ 共轭的正则动量 $p$ 定义为拉格朗日量对速度 $\\dot{q}$ 的偏导数：\n$$p = \\frac{\\partial L}{\\partial \\dot{q}}$$\n对于给定的拉格朗日量，可得：\n$$p = \\frac{\\partial}{\\partial \\dot{q}} \\left( \\frac{1}{2}m\\dot{q}^{2} - V(q) \\right) = m\\dot{q}$$\n由此，我们可以用动量 $p$ 来表示速度 $\\dot{q}$：\n$$\\dot{q} = \\frac{p}{m}$$\n哈密顿量 $H(q, p)$ 对应于系统的总能量，通过对拉格朗日量进行勒让德变换得到：\n$$H(q, p) = p\\dot{q} - L(q, \\dot{q})$$\n为了将哈密顿量表示为仅关于 $q$ 和 $p$ 的函数，我们代入 $\\dot{q}$ 和 $L$ 的表达式：\n$$H(q, p) = p \\left( \\frac{p}{m} \\right) - \\left[ \\frac{1}{2}m \\left( \\frac{p}{m} \\right)^{2} - V(q) \\right]$$\n$$H(q, p) = \\frac{p^{2}}{m} - \\left[ \\frac{1}{2}m \\frac{p^{2}}{m^{2}} - V(q) \\right] = \\frac{p^{2}}{m} - \\frac{p^{2}}{2m} + V(q)$$\n$$H(q, p) = \\frac{p^{2}}{2m} + V(q)$$\nPoincaré–Cartan 1-形式 $\\Theta_{L}$ 在坐标为 $(q, p, t)$ 的扩展相空间上定义为：\n$$\\Theta_{L} = p \\, dq - H(q, p) \\, dt$$\n代入推导出的哈密顿量 $H(q, p)$ 的表达式，我们得到 $\\Theta_{L}$ 的显式形式：\n$$\\Theta_{L} = p \\, dq - \\left( \\frac{p^{2}}{2m} + V(q) \\right) dt$$\n\n(b) 对于谐振子，势为 $V(q) = \\frac{1}{2}m\\omega^{2}q^{2}$。哈密顿量为：\n$$H(q, p) = \\frac{p^{2}}{2m} + \\frac{1}{2}m\\omega^{2}q^{2}$$\n能量为常数 $E > 0$ 的周期解对应于哈密顿量的一个水平集，$H(q, p) = E$。这在 $(q, p)$ 相空间中定义了一个闭合轨道 $\\gamma$：\n$$\\frac{p^{2}}{2m} + \\frac{1}{2}m\\omega^{2}q^{2} = E$$\n这个方程描述了在 $(q, p)$ 平面上以原点为中心的一个椭圆。为了确定其几何性质，我们将方程重写为标准形式 $\\frac{x^{2}}{a^{2}} + \\frac{y^{2}}{b^{2}} = 1$：\n$$\\frac{q^{2}}{2E/(m\\omega^{2})} + \\frac{p^{2}}{2mE} = 1$$\n这表明椭圆的半轴长分别为沿 $q$ 轴的 $a_q = \\sqrt{\\frac{2E}{m\\omega^{2}}}$ 和沿 $p$ 轴的 $a_p = \\sqrt{2mE}$。\n积分 $J = \\oint_{\\gamma} p \\, dq$ 代表了相平面中闭合曲线 $\\gamma$ 所包围的面积。椭圆的面积由 $\\pi$ 与其两个半轴的乘积给出。\n$$J = \\text{Area} = \\pi a_q a_p$$\n代入半轴的表达式：\n$$J = \\pi \\left( \\sqrt{\\frac{2E}{m\\omega^{2}}} \\right) \\left( \\sqrt{2mE} \\right) = \\pi \\sqrt{\\frac{2E}{m\\omega^{2}} \\cdot 2mE} = \\pi \\sqrt{\\frac{4mE^{2}}{m\\omega^{2}}}$$\n$$J = \\pi \\sqrt{\\frac{4E^{2}}{\\omega^{2}}} = \\pi \\frac{2E}{\\omega}$$\n因此，作用量积分的值为 $J = \\frac{2\\pi E}{\\omega}$。\n\n(c) 我们必须证明积分 $I(t) = \\oint_{\\Gamma_{t}} \\Theta_{L}$ 与 $t$ 无关，其中 $\\Gamma_{t}$ 是由欧拉-拉格朗日流携带的一个单参数闭合曲线族。这意味着 $\\frac{dI}{dt} = 0$。\n设 $\\phi_{t}$ 为扩展相空间上的流映射，使得 $\\Gamma_{t} = \\phi_{t}(\\Gamma_{0})$。该积分可写为 $I(t) = \\oint_{\\Gamma_0} \\phi_t^* \\Theta_L$。对时间求导：\n$$\\frac{dI}{dt} = \\frac{d}{dt} \\oint_{\\Gamma_0} \\phi_t^* \\Theta_L = \\oint_{\\Gamma_0} \\frac{d}{dt} (\\phi_t^* \\Theta_L)$$\n拉回的时间导数是李导数的拉回：$\\frac{d}{dt}(\\phi_t^* \\Theta_L) = \\phi_t^* (\\mathcal{L}_X \\Theta_L)$，其中 $X$ 是生成流 $\\phi_t$ 的向量场。\n$$\\frac{dI}{dt} = \\oint_{\\Gamma_0} \\phi_t^* (\\mathcal{L}_X \\Theta_L) = \\oint_{\\Gamma_t} \\mathcal{L}_X \\Theta_L$$\n为了证明该不变量，我们必须证明这个积分为零。哈密顿流的生成元 $X$ 由哈密顿方程给出，并扩展以包含时间：\n$$X = \\frac{\\partial H}{\\partial p} \\frac{\\partial}{\\partial q} - \\frac{\\partial H}{\\partial q} \\frac{\\partial}{\\partial p} + 1 \\cdot \\frac{\\partial}{\\partial t}$$\n我们使用关于李导数的Cartan魔法公式：$\\mathcal{L}_X \\Theta_L = d(i_X \\Theta_L) + i_X(d\\Theta_L)$。\n首先，我们计算 $\\Theta_L = p \\, dq - H \\, dt$ 的外微分：\n$$d\\Theta_L = d(p \\, dq) - d(H \\, dt) = dp \\wedge dq - (dH \\wedge dt)$$\n$$d\\Theta_L = dp \\wedge dq - \\left(\\frac{\\partial H}{\\partial q} dq + \\frac{\\partial H}{\\partial p} dp\\right) \\wedge dt = dp \\wedge dq - \\frac{\\partial H}{\\partial q} dq \\wedge dt - \\frac{\\partial H}{\\partial p} dp \\wedge dt$$\n接下来，我们计算内积 $i_X(d\\Theta_L)$：\n$$i_X(d\\Theta_L) = i_X(dp \\wedge dq) - i_X\\left(\\frac{\\partial H}{\\partial q} dq \\wedge dt\\right) - i_X\\left(\\frac{\\partial H}{\\partial p} dp \\wedge dt\\right)$$\n我们计算每一项：\n$i_X(dp \\wedge dq) = (i_X dp)dq - (i_X dq)dp = \\dot{p} \\, dq - \\dot{q} \\, dp = -\\frac{\\partial H}{\\partial q}dq - \\frac{\\partial H}{\\partial p}dp = -dH$.\n$i_X(dq \\wedge dt) = (i_X dq)dt - (i_X dt)dq = \\dot{q} \\, dt - 1 \\cdot dq = \\frac{\\partial H}{\\partial p}dt - dq$.\n$i_X(dp \\wedge dt) = (i_X dp)dt - (i_X dt)dp = \\dot{p} \\, dt - 1 \\cdot dp = -\\frac{\\partial H}{\\partial q}dt - dp$.\n将这些代回：\n$$i_X(d\\Theta_L) = (-dH) - \\frac{\\partial H}{\\partial q}\\left(\\frac{\\partial H}{\\partial p}dt - dq\\right) - \\frac{\\partial H}{\\partial p}\\left(-\\frac{\\partial H}{\\partial q}dt - dp\\right)$$\n$$i_X(d\\Theta_L) = -\\left(\\frac{\\partial H}{\\partial q}dq + \\frac{\\partial H}{\\partial p}dp\\right) - \\frac{\\partial H}{\\partial q}\\frac{\\partial H}{\\partial p}dt + \\frac{\\partial H}{\\partial q}dq + \\frac{\\partial H}{\\partial p}\\frac{\\partial H}{\\partial q}dt + \\frac{\\partial H}{\\partial p}dp$$\n所有项都相互抵消，得到：\n$$i_X(d\\Theta_L) = 0$$\n利用这个结果，Cartan公式简化为 $\\mathcal{L}_X \\Theta_L = d(i_X \\Theta_L)$。现在我们将其代入 $\\frac{dI}{dt}$ 的表达式中：\n$$\\frac{dI}{dt} = \\oint_{\\Gamma_t} d(i_X \\Theta_L)$$\n根据广义斯托克斯定理，一个恰当形式（$d\\alpha$，其中 $\\alpha=i_X \\Theta_L$）在一个闭合无边流形（闭合回路 $\\Gamma_t$）上的积分为零。\n$$\\oint_{\\Gamma_t} d(i_X \\Theta_L) = 0$$\n因此，$\\frac{dI}{dt} = 0$，这证明了 $I(t)$ 是一个运动常数，从而验证了Poincaré–Cartan积分不变量。",
            "answer": "$$\\boxed{\\frac{2\\pi E}{\\omega}}$$"
        },
        {
            "introduction": "在验证了积分不变量在时间演化（即哈密顿流）下的守恒性后，第二个练习将从另一个角度加深我们的理解。我们将探讨这个不变量在坐标变换下的行为。通过应用一个特定的正则变换 ()，这项练习将展示作用量积分 $\\oint p\\,dq$ 的值保持不变，从而突显其作为一个不依赖于特定坐标系选择的几何不变量的深刻本质。",
            "id": "3780990",
            "problem": "考虑一个单自由度哈密顿系统，其坐标为 $q$，动量为 $p$，质量 $m>0$，角频率 $\\omega>0$，由哈密顿量\n$$\nH(q,p) \\;=\\; \\frac{p^{2}}{2m} \\;+\\; \\frac{1}{2} m \\omega^{2} q^{2}\n$$\n所支配。\n令 $\\mathcal{C}_{E}$ 表示相空间中对应于固定能量 $E>0$ 的闭合周期轨道，因此沿 $\\mathcal{C}_{E}$ 有 $H(q,p)=E$。\n\n(a) 仅使用哈密顿力学和几何积分的基本定义，计算回路积分\n$$\nI \\;=\\; \\oint_{\\mathcal{C}_{E}} p \\,\\mathrm{d}q\n$$\n并用 $E$ 和 $\\omega$ 表示其值。\n\n(b) 执行由第二类生成函数\n$$\nF_{2}(q,P) \\;=\\; q\\,P \\;+\\; \\frac{\\gamma}{2}\\,q^{2}\n$$\n生成的正则变换，其中 $\\gamma$ 为实常数。确定变换后的变量 $(Q,P)$ 以及通过在新变量中表示 $H$ 所得到的变换后的哈密顿量 $H'(Q,P)$。令 $\\mathcal{C}'_{E}$ 为 $\\mathcal{C}_{E}$ 在此变换下于 $(Q,P)$ 平面中的像。\n\n仅使用第二类生成函数的基本变换定律和 Poincaré–Cartan 一形式的定义，计算\n$$\nI' \\;=\\; \\oint_{\\mathcal{C}'_{E}} P \\,\\mathrm{d}Q,\n$$\n并证明其值等于在 (a) 部分得到的值。将您的最终答案表示为这两个回路积分的共同值，形式为关于 $E$ 和 $\\omega$ 的闭合表达式。\n\n您的最终答案必须是单个解析表达式。无需四舍五入。",
            "solution": "我们从哈密顿系统、正则变换和 Poincaré–Cartan 一形式的基本定义出发。对于一个具有哈密顿量 $H(q,p)$ 的单自由度哈密顿系统，其 Poincaré–Cartan 一形式是扩展相空间上的一个一形式，由下式给出\n$$\n\\theta \\;=\\; p\\,\\mathrm{d}q \\;-\\; H\\,\\mathrm{d}t.\n$$\n对于由第二类生成函数 $F_{2}(q,P)$ 生成的不依赖于时间的正则变换，其变换定律为\n$$\np \\;=\\; \\frac{\\partial F_{2}}{\\partial q}, \n\\qquad\nQ \\;=\\; \\frac{\\partial F_{2}}{\\partial P},\n$$\n且变换后的哈密顿量为 $H'(Q,P) = H(q(Q,P),p(Q,P))$，因为不存在显式的时间依赖性。Poincaré–Cartan 一形式的变化为一个全微分，\n$$\np\\,\\mathrm{d}q \\;-\\; H\\,\\mathrm{d}t \\;=\\; P\\,\\mathrm{d}Q \\;-\\; H'\\,\\mathrm{d}t \\;+\\; \\mathrm{d}\\big(F_{2}(q,P) \\;-\\; P\\,Q\\big),\n$$\n因此，对于扩展空间中的任意闭合回路，$p\\,\\mathrm{d}q - H\\,\\mathrm{d}t$ 与 $P\\,\\mathrm{d}Q - H'\\,\\mathrm{d}t$ 的回路积分之差为零。特别地，对于在固定能量 $E$ 下、在一个周期上参数化的闭合相空间回路，我们有 $\\oint p\\,\\mathrm{d}q = \\oint P\\,\\mathrm{d}Q$。\n\n(a) 部分。我们计算固定能量 $E$ 的谐振子的\n$$\nI \\;=\\; \\oint_{\\mathcal{C}_{E}} p \\,\\mathrm{d}q\n$$\n。能量壳 $H(q,p)=E$ 为椭圆\n$$\n\\frac{p^{2}}{2mE} \\;+\\; \\frac{m\\omega^{2} q^{2}}{2E} \\;=\\; 1,\n$$\n其半轴为\n$$\nq_{\\max} \\;=\\; \\sqrt{\\frac{2E}{m\\omega^{2}}}, \n\\qquad\np_{\\max} \\;=\\; \\sqrt{2mE}.\n$$\n回路积分的直接计算使用时间 $t$ 在一个周期 $T = \\frac{2\\pi}{\\omega}$ 内的参数化。一个标准解为\n$$\nq(t) \\;=\\; A \\cos(\\omega t + \\phi), \n\\qquad \np(t) \\;=\\; m \\dot{q}(t) \\;=\\; -m A \\omega \\sin(\\omega t + \\phi),\n$$\n其中振幅为 $A = \\sqrt{\\tfrac{2E}{m\\omega^{2}}}$。于是\n$$\nI \\;=\\; \\oint p\\,\\mathrm{d}q \\;=\\; \\int_{0}^{T} p(t)\\,\\dot{q}(t)\\,\\mathrm{d}t.\n$$\n由于 $p(t)\\,\\dot{q}(t)=m \\dot{q}(t)^{2} = 2\\,T_{\\text{kin}}(t)$，我们有\n$$\nI \\;=\\; \\int_{0}^{T} m \\dot{q}(t)^{2}\\,\\mathrm{d}t \\;=\\; m A^{2} \\omega^{2} \\int_{0}^{T} \\sin^{2}(\\omega t + \\phi)\\,\\mathrm{d}t \\;=\\; m A^{2} \\omega^{2} \\cdot \\frac{T}{2}.\n$$\n使用 $A^{2} = \\tfrac{2E}{m\\omega^{2}}$ 和 $T = \\tfrac{2\\pi}{\\omega}$，我们得到\n$$\nI \\;=\\; m \\left(\\frac{2E}{m\\omega^{2}}\\right) \\omega^{2} \\cdot \\frac{1}{2}\\cdot \\frac{2\\pi}{\\omega}\n\\;=\\; \\frac{2\\pi E}{\\omega}.\n$$\n一个等效的几何论证使用 Green 定理：回路积分 $\\oint_{\\mathcal{C}_{E}} p\\,\\mathrm{d}q$ 等于沿哈密顿流诱导的方向遍历时，椭圆所围成的有向面积。对于谐振子，该方向为顺时针方向，因此积分等于 $+\\text{面积}(\\text{椭圆}) = \\pi q_{\\max} p_{\\max} = \\pi \\sqrt{\\frac{2E}{m\\omega^{2}}} \\cdot \\sqrt{2mE} = \\frac{2\\pi E}{\\omega}$，这与时间参数化的结果一致。\n\n(b) 部分。对于\n$$\nF_{2}(q,P) \\;=\\; q\\,P \\;+\\; \\frac{\\gamma}{2}\\,q^{2},\n$$\n正则变换为\n$$\np \\;=\\; \\frac{\\partial F_{2}}{\\partial q} \\;=\\; P \\;+\\; \\gamma q,\n\\qquad\nQ \\;=\\; \\frac{\\partial F_{2}}{\\partial P} \\;=\\; q.\n$$\n因此，\n$$\nQ \\;=\\; q,\n\\qquad\nP \\;=\\; p - \\gamma q.\n$$\n变换后的哈密顿量是以 $(Q,P)$ 表示的原始哈密顿量：\n$$\nH'(Q,P) \\;=\\; \\frac{\\big(P + \\gamma Q\\big)^{2}}{2m} \\;+\\; \\frac{1}{2} m \\omega^{2} Q^{2}.\n$$\n能量为 $E$ 的椭圆 $\\mathcal{C}_{E}$ 在此线性辛变换下的像是曲线 $\\mathcal{C}'_{E}$，由 $H'(Q,P)=E$ 定义。新变量下的回路积分为\n$$\nI' \\;=\\; \\oint_{\\mathcal{C}'_{E}} P \\,\\mathrm{d}Q.\n$$\n我们直接从变换关系式计算 $I'$。由于 $Q=q$ 且 $P=p - \\gamma q$ 且 $\\mathrm{d}Q = \\mathrm{d}q$，我们有\n$$\nI' \\;=\\; \\oint_{\\mathcal{C}'_{E}} P\\,\\mathrm{d}Q \\;=\\; \\oint_{\\mathcal{C}_{E}} \\big(p - \\gamma q\\big)\\,\\mathrm{d}q \\;=\\; \\oint_{\\mathcal{C}_{E}} p\\,\\mathrm{d}q \\;-\\; \\gamma \\oint_{\\mathcal{C}_{E}} q\\,\\mathrm{d}q.\n$$\n第二项为零，因为它是全微分沿闭合回路的积分：\n$$\n\\oint_{\\mathcal{C}_{E}} q\\,\\mathrm{d}q \\;=\\; \\frac{1}{2}\\oint_{\\mathcal{C}_{E}} \\mathrm{d}\\big(q^{2}\\big) \\;=\\; 0.\n$$\n因此，\n$$\nI' \\;=\\; \\oint_{\\mathcal{C}_{E}} p\\,\\mathrm{d}q \\;=\\; \\frac{2\\pi E}{\\omega}.\n$$\n这个等式是 Poincaré–Cartan 积分不变量在不依赖于时间的正则变换下的一个具体体现，因为 Poincaré–Cartan 一形式的变化是一个全微分，并且沿闭合曲线的回路积分是不变的。\n\n因此，两个回路积分有共同的值\n$$\nI \\;=\\; I' \\;=\\; \\frac{2\\pi E}{\\omega}.\n$$",
            "answer": "$$\\boxed{\\frac{2\\pi E}{\\omega}}$$"
        },
        {
            "introduction": "最后的练习旨在连接抽象理论与计算物理实践。我们将通过编写一个数值实验来“观察”庞加莱积分不变量的真实表现 ()。这项练习不仅能让我们直观地验证理论的正确性，更重要的是，它强调了在模拟哈密顿系统时使用保结构算法（如Störmer-Verlet方法）的重要性，因为只有这类算法才能准确地捕捉系统的长期几何特性。",
            "id": "3780966",
            "problem": "您需要实现一个数值验证，用于验证单自由度哈密顿流的庞加莱积分不变量。该验证必须从几何力学和辛方法的第一性原理出发。考虑具有坐标 $(q,p)$ 的正则相空间和正则1-形式 $\\theta = p\\,dq$。哈密顿系统由哈密顿函数 $H(q,p)$ 指定，其流由哈密顿方程 $\\dot{q} = \\partial H/\\partial p$ 和 $\\dot{p} = -\\partial H/\\partial q$ 定义。庞加莱积分不变量指出，对于一条由哈密顿流输运的闭合曲线，正则1-形式沿该曲线的线积分随时间保持不变。您的任务是通过在相空间中离散化闭合环路，将环路沿流输运一段固定的时间，并比较线积分的离散近似值，来对选定的哈密顿量进行该不变量的数值检验。\n\n您的程序必须从一个有效的基础出发实现以下内容：\n- 由可分离哈密顿量 $H(q,p) = T(p) + V(q)$ 生成的哈密顿流，其中 $T(p) = p^{2}/(2m)$ 且 $V(q)$ 为光滑势。使用由哈密顿方程给出的常微分方程组。\n- 一个与几何结构一致的辛时间步进方法。使用位置-Verlet（也称为 Störmer-Verlet）方法：对于时间步长 $h$，执行\n  - $p_{n+\\frac{1}{2}} = p_{n} - \\frac{h}{2}\\,\\partial V/\\partial q\\,(q_{n})$，\n  - $q_{n+1} = q_{n} + h\\,\\frac{p_{n+\\frac{1}{2}}}{m}$，\n  - $p_{n+1} = p_{n+\\frac{1}{2}} - \\frac{h}{2}\\,\\partial V/\\partial q\\,(q_{n+1})$。\n- 沿由 $N$ 个有序点 $\\{(q_{i},p_{i})\\}_{i=0}^{N-1}$（具有周期性索引）参数化的闭合环路 $\\gamma$ 的线积分 $\\theta$ 的离散近似。近似为\n$$\n\\oint_{\\gamma} p\\,dq \\approx \\sum_{i=0}^{N-1} p_{i}\\,(q_{i+1}-q_{i}),\n$$\n其中 $q_{N} \\equiv q_{0}$ 且 $p_{N} \\equiv p_{0}$。\n\n使用参数化 $q(\\phi) = a\\cos\\phi$，$p(\\phi) = b\\sin\\phi$ 在 $N$ 个等间距角度 $\\phi \\in [0,2\\pi)$ 上采样，构造以 $(q,p)$ 平面原点为中心的椭圆作为初始闭合环路。\n\n对于下面的每个测试用例：\n- 构建初始环路 $(q_{i},p_{i})$，其中 $i=0,\\dots,N-1$。\n- 根据初始环路计算离散积分 $I_{0}$。\n- 使用步长为 $h=\\tau/n$ 的 Störmer-Verlet 方法，进行 $n$ 个时间步，将环路上的每个点在哈密顿流下输运时间 $\\tau$。\n- 计算输运后环路的离散积分 $I_{\\tau}$。\n- 通过检查是否满足 $|I_{\\tau} - I_{0}| \\le \\text{tol}$，判断不变量是否在指定的绝对容差 $\\text{tol}$ 内成立。\n\n仅使用以下哈密顿量：\n- 谐振子：$H(q,p) = \\frac{p^{2}}{2m} + \\frac{k}{2}q^{2}$，其中 $\\partial V/\\partial q = k q$。\n- 四次振子：$H(q,p) = \\frac{p^{2}}{2m} + \\frac{\\lambda}{4}q^{4}$，其中 $\\partial V/\\partial q = \\lambda q^{3}$。\n\n不需要物理单位；所有量均为无量纲。用于构造环路的角度必须以弧度为单位。\n\n测试套件：\n- 情况 1 (正常路径，谐振子，高分辨率):\n  - 哈密顿量：谐振子，$m=1$，$k=1$。\n  - 环路参数：$a=1.3$，$b=0.9$，$N=512$。\n  - 积分参数：$\\tau=3.7$，$n=1200$。\n  - 容差：$\\text{tol}=10^{-6}$。\n- 情况 2 (谐振子，较粗分辨率和更长时间):\n  - 哈密顿量：谐振子，$m=1$，$k=2.5$。\n  - 环路参数：$a=2.0$，$b=1.5$，$N=96$。\n  - 积分参数：$\\tau=10.0$，$n=100$。\n  - 容差：$\\text{tol}=5\\times 10^{-3}$。\n- 情况 3 (四次振子，高分辨率):\n  - 哈密顿量：四次振子，$m=1$，$\\lambda=0.75$。\n  - 环路参数：$a=1.2$，$b=0.8$，$N=512$。\n  - 积分参数：$\\tau=1.3$，$n=1800$。\n  - 容差：$\\text{tol}=10^{-5}$。\n- 情况 4 (四次振子，中等分辨率和较长时间):\n  - 哈密顿量：四次振子，$m=1$，$\\lambda=1.0$。\n  - 环路参数：$a=0.9$，$b=1.5$，$N=128$。\n  - 积分参数：$\\tau=4.2$，$n=160$。\n  - 容差：$\\text{tol}=2\\times 10^{-2}$。\n- 情况 5 (极小环路幅度的边界情况):\n  - 哈密顿量：谐振子，$m=1$，$k=1$。\n  - 环路参数：$a=0.02$，$b=0.015$，$N=256$。\n  - 积分参数：$\\tau=2.0$，$n=200$。\n  - 容差：$\\text{tol}=10^{-6}$。\n\n您的程序应生成单行输出，其中包含各用例的布尔结果，格式为方括号括起来的逗号分隔列表，例如 $[{\\rm True},{\\rm False},{\\rm True},\\dots]$。如果 $|I_{\\tau} - I_{0}| \\le \\text{tol}$，则每个测试用例的结果为 ${\\rm True}$，否则为 ${\\rm False}$。不允许有其他输出。",
            "solution": "在尝试解决方案之前，需要对问题进行验证。\n\n### 步骤 1：提取已知信息\n\n- **正则1-形式：** 在具有坐标 $(q,p)$ 的正则相空间中为 $\\theta = p\\,dq$。\n- **哈密顿系统：** 流由哈密顿方程 $\\dot{q} = \\partial H/\\partial p$ 和 $\\dot{p} = -\\partial H/\\partial q$ 定义。\n- **庞加莱积分不变量：** 对于由哈密顿流输运的闭合曲线 $\\gamma(t)$，线积分 $\\oint_{\\gamma(t)} p\\,dq$ 随时间保持不变。\n- **哈密顿形式：** 可分离哈密顿量 $H(q,p) = T(p) + V(q)$，动能为 $T(p) = p^{2}/(2m)$，势能为光滑势 $V(q)$。\n- **数值积分器：** Störmer-Verlet 方法，时间步长为 $h$：\n  1. $p_{n+\\frac{1}{2}} = p_{n} - \\frac{h}{2}\\,\\partial V/\\partial q\\,(q_{n})$\n  2. $q_{n+1} = q_{n} + h\\,\\frac{p_{n+\\frac{1}{2}}}{m}$\n  3. $p_{n+1} = p_{n+\\frac{1}{2}} - \\frac{h}{2}\\,\\partial V/\\partial q\\,(q_{n+1})$\n- **离散线积分：** 对于一个由 $N$ 个点 $\\{(q_{i},p_{i})\\}_{i=0}^{N-1}$ 组成的环路，积分近似为 $\\oint_{\\gamma} p\\,dq \\approx \\sum_{i=0}^{N-1} p_{i}\\,(q_{i+1}-q_{i})$，其中索引是周期性的，$q_{N} \\equiv q_{0}$。\n- **初始环路构造：** 由 $q(\\phi) = a\\cos\\phi$，$p(\\phi) = b\\sin\\phi$ 参数化的椭圆，在 $N$ 个等间距角度 $\\phi \\in [0,2\\pi)$ 上采样。\n- **哈密顿量和力：**\n  - 谐振子：$H(q,p) = \\frac{p^{2}}{2m} + \\frac{k}{2}q^{2}$，其中 $\\partial V/\\partial q = k q$。\n  - 四次振子：$H(q,p) = \\frac{p^{2}}{2m} + \\frac{\\lambda}{4}q^{4}$，其中 $\\partial V/\\partial q = \\lambda q^{3}$。\n- **验证标准：** 如果 $|I_{\\tau} - I_{0}| \\le \\text{tol}$，则不变量成立，其中 $I_0$ 和 $I_\\tau$ 分别是时间 $0$ 和 $\\tau$ 时的离散积分。\n- **测试套件：**\n  - 情况 1：谐振子，$m=1$，$k=1$，$a=1.3$，$b=0.9$，$N=512$，$\\tau=3.7$，$n=1200$，$\\text{tol}=10^{-6}$。\n  - 情况 2：谐振子，$m=1$，$k=2.5$，$a=2.0$，$b=1.5$，$N=96$，$\\tau=10.0$，$n=100$，$\\text{tol}=5\\times 10^{-3}$。\n  - 情况 3：四次振子，$m=1$，$\\lambda=0.75$，$a=1.2$，$b=0.8$，$N=512$，$\\tau=1.3$，$n=1800$，$\\text{tol}=10^{-5}$。\n  - 情况 4：四次振子，$m=1$，$\\lambda=1.0$，$a=0.9$，$b=1.5$，$N=128$，$\\tau=4.2$，$n=160$，$\\text{tol}=2\\times 10^{-2}$。\n  - 情况 5：谐振子，$m=1$，$k=1$，$a=0.02$，$b=0.015$，$N=256$，$\\tau=2.0$，$n=200$，$\\text{tol}=10^{-6}$。\n\n### 步骤 2：使用提取的已知信息进行验证\n\n根据验证标准评估问题陈述。\n\n- **科学性：** 该问题牢固地植根于经典力学，特别是哈密顿动力学和辛几何。庞加莱积分不变量、哈密顿方程以及辛积分器（Störmer-Verlet）的使用都是几何力学中标准且成熟的概念。该问题不含伪科学和事实错误。\n- **适定性：** 该问题是适定的。它指定了一个清晰的计算任务：对于 5 个测试用例中每个具有完整参数的用例，执行一组已定义的数值步骤，并基于明确的标准返回一个布尔结果。在数值验证的背景下，解是唯一的且有意义的。\n- **客观性：** 语言精确、数学化，没有主观或含糊的陈述。所有术语，如“哈密顿流”、“Störmer-Verlet 方法”和离散积分近似，都得到了明确的定义。\n\n该问题没有任何使其无效的缺陷。它在科学上是合理的，规格是完整的，并且在计算上是可行的。选择辛积分器来验证辛映射的不变量是一个关键特征，这使得该问题在概念上是稳健的，而非无足轻重。\n\n### 步骤 3：结论与行动\n\n问题是 **有效的**。将开发一个解决方案。\n\n### 解决方案\n\n该解决方案涉及实现一个数值实验，以验证哈密顿系统的庞加莱积分不变量 $\\oint p\\,dq$。其核心原理是哈密顿流是辛同胚，它保持辛2-形式 $\\omega = dq \\wedge dp$ 不变。根据斯托克斯定理（Stokes' theorem），在任何曲面 $A$ 上的面积分 $\\iint_A \\omega$ 的守恒，意味着在边界 $\\partial A$ 上正则1-形式 $\\theta=p\\,dq$ 的线积分 $\\oint_{\\partial A} \\theta$ 的守恒。本问题直接对选定的闭合环路检验此不变量。\n\n数值实现的一个关键方面是积分器的选择。标准的数值方法，如欧拉法（Euler method）或龙格-库塔法（Runge-Kutta methods），虽然在短时间内通常是准确的，但通常不是辛的。它们不保持相空间的几何结构，导致守恒量（包括庞加莱不变量）出现长期漂移。该问题正确地指定了 Störmer-Verlet 方法，这是一种二阶辛积分器。其辛性质确保了它能高精度地保持积分不变量的离散模拟，使其特别适用于长期模拟和验证此类几何守恒律。\n\n对每个测试用例，实现将按以下步骤进行：\n\n1.  **定义系统：** 基于测试用例，确定哈密顿量的参数：质量 $m$ 和势参数（$k$ 或 $\\lambda$）。这定义了力函数 $F(q) = -\\partial V/\\partial q$，对于谐振子是 $F(q) = -kq$，对于四次振子是 $F(q) = -\\lambda q^3$。\n\n2.  **生成初始环路：** 将相空间中的一个闭合环路离散化为 $N$ 个点。这些点使用给定的椭圆参数形式生成：\n    $$\n    q_i = a\\cos(\\phi_i), \\quad p_i = b\\sin(\\phi_i)\n    $$\n    其中 $\\phi_i = 2\\pi i/N$，对于 $i = 0, 1, \\dots, N-1$。\n\n3.  **计算初始积分：** 使用指定的离散公式近似线积分 $\\oint p\\,dq$。设初始环路由长度为 $N$ 的数组 $q^{(0)}$ 和 $p^{(0)}$ 表示。初始积分 $I_0$ 计算如下：\n    $$\n    I_0 = \\sum_{i=0}^{N-1} p_i^{(0)} (q_{i+1}^{(0)} - q_i^{(0)})\n    $$\n    周期性边界条件 $q_N \\equiv q_0$ 将通过对 $q$ 数组进行循环移位来处理。\n\n4.  **随时间演化环路：** 使用 Störmer-Verlet 方法将环路上的 $N$ 个点从 $t=0$ 演化到 $t=\\tau$。这需要进行 $n$ 个步长，每个步长为 $h = \\tau/n$。对于每一步和环路上的每个点 $(q_j, p_j)$：\n    $$\n    p_{j, \\text{half}} = p_j + \\frac{h}{2} F(q_j)\n    $$\n    $$\n    q_{j, \\text{new}} = q_j + h \\frac{p_{j, \\text{half}}}{m}\n    $$\n    $$\n    p_{j, \\text{new}} = p_{j, \\text{half}} + \\frac{h}{2} F(q_{j, \\text{new}})\n    $$\n    这个过程重复 $n$ 次以获得最终的环路点 $(q^{(\\tau)}, p^{(\\tau)})$。为提高效率，此计算将进行向量化，同时将更新规则应用于整个 $q$ 和 $p$ 点的数组。\n\n5.  **计算最终积分：** 使用相同的离散公式，为输运后的环路点 $(q^{(\\tau)}, p^{(\\tau)})$ 计算积分 $I_{\\tau}$。\n\n6.  **验证不变量：** 将初始积分和最终积分的绝对差 $|I_{\\tau} - I_0|$ 与指定的容差 $\\text{tol}$ 进行比较。如果差值在容差范围内，则结果为 `True`，否则为 `False`。对所有测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Numerically verifies the Poincaré integral invariant for Hamiltonian flows.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: harmonic oscillator, fine resolution\n        {\n            \"hamiltonian\": \"harmonic\",\n            \"params\": {\"m\": 1.0, \"k\": 1.0},\n            \"loop\": {\"a\": 1.3, \"b\": 0.9, \"N\": 512},\n            \"integration\": {\"tau\": 3.7, \"n\": 1200},\n            \"tol\": 1e-6,\n        },\n        # Case 2: harmonic oscillator, coarser resolution\n        {\n            \"hamiltonian\": \"harmonic\",\n            \"params\": {\"m\": 1.0, \"k\": 2.5},\n            \"loop\": {\"a\": 2.0, \"b\": 1.5, \"N\": 96},\n            \"integration\": {\"tau\": 10.0, \"n\": 100},\n            \"tol\": 5e-3,\n        },\n        # Case 3: quartic oscillator, fine resolution\n        {\n            \"hamiltonian\": \"quartic\",\n            \"params\": {\"m\": 1.0, \"lambda\": 0.75},\n            \"loop\": {\"a\": 1.2, \"b\": 0.8, \"N\": 512},\n            \"integration\": {\"tau\": 1.3, \"n\": 1800},\n            \"tol\": 1e-5,\n        },\n        # Case 4: quartic oscillator, moderate resolution\n        {\n            \"hamiltonian\": \"quartic\",\n            \"params\": {\"m\": 1.0, \"lambda\": 1.0},\n            \"loop\": {\"a\": 0.9, \"b\": 1.5, \"N\": 128},\n            \"integration\": {\"tau\": 4.2, \"n\": 160},\n            \"tol\": 2e-2,\n        },\n        # Case 5: edge case, small loop\n        {\n            \"hamiltonian\": \"harmonic\",\n            \"params\": {\"m\": 1.0, \"k\": 1.0},\n            \"loop\": {\"a\": 0.02, \"b\": 0.015, \"N\": 256},\n            \"integration\": {\"tau\": 2.0, \"n\": 200},\n            \"tol\": 1e-6,\n        },\n    ]\n\n    results = []\n\n    def compute_integral(q, p):\n        \"\"\"\n        Computes the discrete line integral sum_{i=0}^{N-1} p_i * (q_{i+1} - q_i).\n        The periodic boundary is handled by np.roll.\n        \"\"\"\n        q_next = np.roll(q, -1)\n        dq = q_next - q\n        return np.sum(p * dq)\n\n    for case in test_cases:\n        # Unpack parameters\n        hamiltonian_type = case[\"hamiltonian\"]\n        m = case[\"params\"][\"m\"]\n        a = case[\"loop\"][\"a\"]\n        b = case[\"loop\"][\"b\"]\n        N = case[\"loop\"][\"N\"]\n        tau = case[\"integration\"][\"tau\"]\n        n_steps = case[\"integration\"][\"n\"]\n        tol = case[\"tol\"]\n\n        # Define force function F(q) = -dV/dq\n        if hamiltonian_type == \"harmonic\":\n            k = case[\"params\"][\"k\"]\n            force_func = lambda q_vals: -k * q_vals\n        elif hamiltonian_type == \"quartic\":\n            lambda_p = case[\"params\"][\"lambda\"]\n            force_func = lambda q_vals: -lambda_p * q_vals**3\n        else:\n            raise ValueError(\"Unknown Hamiltonian type\")\n            \n        # 1. Generate initial loop\n        phi = np.linspace(0, 2 * np.pi, N, endpoint=False)\n        q0 = a * np.cos(phi)\n        p0 = b * np.sin(phi)\n\n        # 2. Compute initial integral\n        I0 = compute_integral(q0, p0)\n\n        # 3. Evolve the loop using Störmer-Verlet integrator\n        q = q0.copy()\n        p = p0.copy()\n        h = tau / n_steps\n\n        for _ in range(n_steps):\n            # p_{n+1/2} = p_n - (h/2) * dV/dq(q_n) = p_n + (h/2) * F(q_n)\n            p_half = p + (h / 2.0) * force_func(q)\n            # q_{n+1} = q_n + h * p_{n+1/2} / m\n            q = q + h * p_half / m\n            # p_{n+1} = p_{n+1/2} - (h/2) * dV/dq(q_{n+1}) = p_{n+1/2} + (h/2) * F(q_{n+1})\n            p = p_half + (h / 2.0) * force_func(q)\n            \n        # 4. Compute final integral\n        I_tau = compute_integral(q, p)\n\n        # 5. Verify invariance\n        is_invariant = np.abs(I_tau - I0) = tol\n        results.append(is_invariant)\n\n    # Format and print output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}