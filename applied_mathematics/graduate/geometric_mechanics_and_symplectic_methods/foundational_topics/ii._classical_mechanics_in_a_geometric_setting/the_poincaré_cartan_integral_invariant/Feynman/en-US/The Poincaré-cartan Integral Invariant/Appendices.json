{
    "hands_on_practices": [
        {
            "introduction": "This first practice lays the theoretical foundation of the Poincaré-Cartan integral invariant. Starting from the familiar Lagrangian of a one-dimensional system, you will derive the corresponding Poincaré-Cartan 1-form, $\\Theta_L = p \\, dq - H \\, dt$. By applying this to the harmonic oscillator, a cornerstone model in physics, you will compute the action integral $\\oint p \\, dq$ for a periodic orbit and then perform a rigorous proof of its invariance using the tools of exterior calculus . This exercise solidifies the connection between the Lagrangian formulation, the Hamiltonian picture, and the geometric concept of an integral invariant.",
            "id": "3780954",
            "problem": "Consider a one-dimensional mechanical system with configuration coordinate $q$, mass parameter $m>0$, and a smooth potential $V(q)$. The dynamics are described by the Lagrangian $L(q,\\dot{q})=\\frac{1}{2}m\\dot{q}^{2}-V(q)$. Work in the extended phase space with coordinates $(q,p,t)$, where $p$ denotes the canonical momentum conjugate to $q$ and $t$ is the time coordinate.\n\n(a) Starting from the action principle and the Legendre transform between Lagrangian and Hamiltonian descriptions, derive the Poincaré–Cartan $1$-form $\\Theta_{L}$ associated with the Lagrangian $L(q,\\dot{q})=\\frac{1}{2}m\\dot{q}^{2}-V(q)$. Your derivation must begin from the definitions of canonical momentum and the energy function and proceed to an explicit analytic expression for $\\Theta_{L}$ on $(q,p,t)$.\n\n(b) Specialize to the harmonic oscillator potential $V(q)=\\frac{1}{2}m\\omega^{2}q^{2}$ with $\\omega>0$. Consider a nontrivial periodic solution of energy $E>0$ and form the closed trajectory $\\gamma$ in extended phase space by following the solution for one full period. Compute the closed line integral $J=\\oint_{\\gamma}p\\,dq$ and express your answer in terms of $E$ and $\\omega$ only. Provide your final answer as a single closed-form analytic expression.\n\n(c) Using first principles of geometric mechanics, verify the Poincaré–Cartan integral invariant for this system: prove that for any smooth one-parameter family of closed curves $\\Gamma_{t}$ carried by the Euler–Lagrange flow, the quantity $I(t)=\\oint_{\\Gamma_{t}}\\Theta_{L}$ is independent of $t$. Your verification must start from Cartan’s identity for the Lie derivative and the exterior differential of $\\Theta_{L}$, and must not assume the invariant as a given fact.\n\nThe final answer to submit is the expression obtained for $J$ in part (b). No numerical approximation is needed.",
            "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the established principles of classical and geometric mechanics, provides a complete and consistent set of definitions and constraints, and is well-posed, leading to a unique and meaningful solution. The problem is objective and formalizable, asking for standard derivations and calculations within its specified domain.\n\n(a) We are tasked with deriving the Poincaré–Cartan $1$-form $\\Theta_{L}$ for the Lagrangian $L(q, \\dot{q}) = \\frac{1}{2}m\\dot{q}^{2} - V(q)$. The derivation starts from the definitions of the canonical momentum and the Hamiltonian.\n\nThe canonical momentum $p$ conjugate to the coordinate $q$ is defined by the partial derivative of the Lagrangian with respect to the velocity $\\dot{q}$:\n$$p = \\frac{\\partial L}{\\partial \\dot{q}}$$\nFor the given Lagrangian, this yields:\n$$p = \\frac{\\partial}{\\partial \\dot{q}} \\left( \\frac{1}{2}m\\dot{q}^{2} - V(q) \\right) = m\\dot{q}$$\nFrom this, we can express the velocity $\\dot{q}$ in terms of the momentum $p$:\n$$\\dot{q} = \\frac{p}{m}$$\nThe Hamiltonian $H(q, p)$, which corresponds to the total energy of the system, is obtained via the Legendre transform of the Lagrangian:\n$$H(q, p) = p\\dot{q} - L(q, \\dot{q})$$\nTo express the Hamiltonian as a function of $q$ and $p$ only, we substitute the expressions for $\\dot{q}$ and $L$:\n$$H(q, p) = p \\left( \\frac{p}{m} \\right) - \\left[ \\frac{1}{2}m \\left( \\frac{p}{m} \\right)^{2} - V(q) \\right]$$\n$$H(q, p) = \\frac{p^{2}}{m} - \\left[ \\frac{1}{2}m \\frac{p^{2}}{m^{2}} - V(q) \\right] = \\frac{p^{2}}{m} - \\frac{p^{2}}{2m} + V(q)$$\n$$H(q, p) = \\frac{p^{2}}{2m} + V(q)$$\nThe Poincaré–Cartan $1$-form $\\Theta_{L}$ is defined on the extended phase space with coordinates $(q, p, t)$ as:\n$$\\Theta_{L} = p \\, dq - H(q, p) \\, dt$$\nSubstituting the derived expression for the Hamiltonian $H(q, p)$, we obtain the explicit form of $\\Theta_{L}$:\n$$\\Theta_{L} = p \\, dq - \\left( \\frac{p^{2}}{2m} + V(q) \\right) dt$$\n\n(b) For the harmonic oscillator, the potential is $V(q) = \\frac{1}{2}m\\omega^{2}q^{2}$. The Hamiltonian is:\n$$H(q, p) = \\frac{p^{2}}{2m} + \\frac{1}{2}m\\omega^{2}q^{2}$$\nA periodic solution with constant energy $E > 0$ corresponds to a level set of the Hamiltonian, $H(q, p) = E$. This defines a closed trajectory $\\gamma$ in the $(q, p)$ phase space:\n$$\\frac{p^{2}}{2m} + \\frac{1}{2}m\\omega^{2}q^{2} = E$$\nThis equation describes an ellipse centered at the origin of the $(q, p)$ plane. To identify its geometric properties, we rewrite the equation in standard form $\\frac{x^{2}}{a^{2}} + \\frac{y^{2}}{b^{2}} = 1$:\n$$\\frac{q^{2}}{2E/(m\\omega^{2})} + \\frac{p^{2}}{2mE} = 1$$\nThis shows the semi-axes of the ellipse are $a_q = \\sqrt{\\frac{2E}{m\\omega^{2}}}$ along the $q$-axis and $a_p = \\sqrt{2mE}$ along the $p$-axis.\nThe integral $J = \\oint_{\\gamma} p \\, dq$ represents the area enclosed by the closed curve $\\gamma$ in the phase plane. The area of an ellipse is given by the product of $\\pi$ and its semi-axes.\n$$J = \\text{Area} = \\pi a_q a_p$$\nSubstituting the expressions for the semi-axes:\n$$J = \\pi \\left( \\sqrt{\\frac{2E}{m\\omega^{2}}} \\right) \\left( \\sqrt{2mE} \\right) = \\pi \\sqrt{\\frac{2E}{m\\omega^{2}} \\cdot 2mE} = \\pi \\sqrt{\\frac{4mE^{2}}{m\\omega^{2}}}$$\n$$J = \\pi \\sqrt{\\frac{4E^{2}}{\\omega^{2}}} = \\pi \\frac{2E}{\\omega}$$\nThus, the value of the action integral is $J = \\frac{2\\pi E}{\\omega}$.\n\n(c) We must prove that the integral $I(t) = \\oint_{\\Gamma_{t}} \\Theta_{L}$ is independent of $t$, where $\\Gamma_{t}$ is a one-parameter family of closed curves carried by the Euler-Lagrange flow. This means $\\frac{dI}{dt} = 0$.\nLet $\\phi_{t}$ be the flow map on the extended phase space, so that $\\Gamma_{t} = \\phi_{t}(\\Gamma_{0})$. The integral can be written as $I(t) = \\oint_{\\Gamma_0} \\phi_t^* \\Theta_L$. Taking the time derivative:\n$$\\frac{dI}{dt} = \\frac{d}{dt} \\oint_{\\Gamma_0} \\phi_t^* \\Theta_L = \\oint_{\\Gamma_0} \\frac{d}{dt} (\\phi_t^* \\Theta_L)$$\nThe time derivative of the pullback is the pullback of the Lie derivative: $\\frac{d}{dt}(\\phi_t^* \\Theta_L) = \\phi_t^* (\\mathcal{L}_X \\Theta_L)$, where $X$ is the vector field generating the flow $\\phi_t$.\n$$\\frac{dI}{dt} = \\oint_{\\Gamma_0} \\phi_t^* (\\mathcal{L}_X \\Theta_L) = \\oint_{\\Gamma_t} \\mathcal{L}_X \\Theta_L$$\nTo prove the invariant, we must show that this integral vanishes. The generator $X$ of the Hamiltonian flow is given by Hamilton's equations, extended to include time:\n$$X = \\frac{\\partial H}{\\partial p} \\frac{\\partial}{\\partial q} - \\frac{\\partial H}{\\partial q} \\frac{\\partial}{\\partial p} + 1 \\cdot \\frac{\\partial}{\\partial t}$$\nWe use Cartan's magic formula for the Lie derivative: $\\mathcal{L}_X \\Theta_L = d(i_X \\Theta_L) + i_X(d\\Theta_L)$.\nFirst, we compute the exterior derivative of $\\Theta_L = p \\, dq - H \\, dt$:\n$$d\\Theta_L = d(p \\, dq) - d(H \\, dt) = dp \\wedge dq - (dH \\wedge dt)$$\n$$d\\Theta_L = dp \\wedge dq - \\left(\\frac{\\partial H}{\\partial q} dq + \\frac{\\partial H}{\\partial p} dp\\right) \\wedge dt = dp \\wedge dq - \\frac{\\partial H}{\\partial q} dq \\wedge dt - \\frac{\\partial H}{\\partial p} dp \\wedge dt$$\nNext, we compute the interior product $i_X(d\\Theta_L)$:\n$$i_X(d\\Theta_L) = i_X(dp \\wedge dq) - i_X\\left(\\frac{\\partial H}{\\partial q} dq \\wedge dt\\right) - i_X\\left(\\frac{\\partial H}{\\partial p} dp \\wedge dt\\right)$$\nWe evaluate each term:\n$i_X(dp \\wedge dq) = (i_X dp)dq - (i_X dq)dp = \\left\\langle X, dp \\right\\rangle dq - \\left\\langle X, dq \\right\\rangle dp = \\dot{p} \\, dq - \\dot{q} \\, dp = -\\frac{\\partial H}{\\partial q}dq - \\frac{\\partial H}{\\partial p}dp = -dH$.\n$i_X(dq \\wedge dt) = (i_X dq)dt - (i_X dt)dq = \\dot{q} \\, dt - 1 \\cdot dq = \\frac{\\partial H}{\\partial p}dt - dq$.\n$i_X(dp \\wedge dt) = (i_X dp)dt - (i_X dt)dp = \\dot{p} \\, dt - 1 \\cdot dp = -\\frac{\\partial H}{\\partial q}dt - dp$.\nSubstituting these back:\n$$i_X(d\\Theta_L) = (-dH) - \\frac{\\partial H}{\\partial q}\\left(\\frac{\\partial H}{\\partial p}dt - dq\\right) - \\frac{\\partial H}{\\partial p}\\left(-\\frac{\\partial H}{\\partial q}dt - dp\\right)$$\n$$i_X(d\\Theta_L) = -\\left(\\frac{\\partial H}{\\partial q}dq + \\frac{\\partial H}{\\partial p}dp\\right) - \\frac{\\partial H}{\\partial q}\\frac{\\partial H}{\\partial p}dt + \\frac{\\partial H}{\\partial q}dq + \\frac{\\partial H}{\\partial p}\\frac{\\partial H}{\\partial q}dt + \\frac{\\partial H}{\\partial p}dp$$\nAll terms cancel out, leading to:\n$$i_X(d\\Theta_L) = 0$$\nWith this result, Cartan's formula simplifies to $\\mathcal{L}_X \\Theta_L = d(i_X \\Theta_L)$. Now we substitute this into the expression for $\\frac{dI}{dt}$:\n$$\\frac{dI}{dt} = \\oint_{\\Gamma_t} d(i_X \\Theta_L)$$\nBy the generalized Stokes' theorem, the integral of an exact form ($d\\alpha$ where $\\alpha=i_X \\Theta_L$) over a closed boundaryless manifold (the closed loop $\\Gamma_t$) is zero.\n$$\\oint_{\\Gamma_t} d(i_X \\Theta_L) = 0$$\nTherefore, $\\frac{dI}{dt} = 0$, which proves that $I(t)$ is a constant of motion, verifying the Poincaré–Cartan integral invariant.",
            "answer": "$$\\boxed{\\frac{2\\pi E}{\\omega}}$$"
        },
        {
            "introduction": "Having established the integral invariant, we now explore its robustness under coordinate changes. This exercise demonstrates that the value of the action integral $\\oint p \\, dq$ is not an artifact of a specific choice of canonical coordinates but is a true geometric property of the dynamics. You will perform a canonical transformation using a generating function and explicitly show that the integral remains unchanged in the new coordinate system . This practice highlights a key feature of canonical transformations and deepens the understanding of why these invariants are so fundamental in geometric mechanics.",
            "id": "3780990",
            "problem": "Consider a one-degree-of-freedom Hamiltonian system with coordinate $q$, momentum $p$, mass $m>0$, and angular frequency $\\omega>0$, governed by the Hamiltonian\n$$\nH(q,p) \\;=\\; \\frac{p^{2}}{2m} \\;+\\; \\frac{1}{2} m \\omega^{2} q^{2}.\n$$\nLet $\\mathcal{C}_{E}$ denote the closed periodic trajectory in phase space corresponding to fixed energy $E>0$, so that $H(q,p)=E$ along $\\mathcal{C}_{E}$.\n\n(a) Using only fundamental definitions from Hamiltonian mechanics and geometric integration, compute the loop integral\n$$\nI \\;=\\; \\oint_{\\mathcal{C}_{E}} p \\,\\mathrm{d}q\n$$\nin terms of $E$ and $\\omega$.\n\n(b) Perform the canonical transformation generated by the type-2 generating function\n$$\nF_{2}(q,P) \\;=\\; q\\,P \\;+\\; \\frac{\\gamma}{2}\\,q^{2},\n$$\nwhere $\\gamma$ is a real constant. Determine the transformed variables $(Q,P)$ and the transformed Hamiltonian $H'(Q,P)$ obtained by expressing $H$ in the new variables. Let $\\mathcal{C}'_{E}$ be the image of $\\mathcal{C}_{E}$ under this transformation in the $(Q,P)$-plane.\n\nUsing only the foundational transformation laws for type-2 generating functions and the definition of the Poincaré–Cartan one-form, compute\n$$\nI' \\;=\\; \\oint_{\\mathcal{C}'_{E}} P \\,\\mathrm{d}Q,\n$$\nand show that it equals the value obtained in part (a). Express your final answer as the common value of these two loop integrals in closed form as a function of $E$ and $\\omega$.\n\nYour final answer must be a single analytic expression. No rounding is required.",
            "solution": "We begin from the fundamental definitions of Hamiltonian systems, canonical transformations, and the Poincaré–Cartan one-form. For a one-degree-of-freedom Hamiltonian system with Hamiltonian $H(q,p)$, the Poincaré–Cartan one-form is the one-form on extended phase space given by\n$$\n\\theta \\;=\\; p\\,\\mathrm{d}q \\;-\\; H\\,\\mathrm{d}t.\n$$\nFor a time-independent canonical transformation generated by a type-2 generating function $F_{2}(q,P)$, the transformation laws are\n$$\np \\;=\\; \\frac{\\partial F_{2}}{\\partial q}, \n\\qquad\nQ \\;=\\; \\frac{\\partial F_{2}}{\\partial P},\n$$\nand the transformed Hamiltonian is $H'(Q,P) = H(q(Q,P),p(Q,P))$ because there is no explicit time dependence. The Poincaré–Cartan one-form changes by an exact differential,\n$$\np\\,\\mathrm{d}q \\;-\\; H\\,\\mathrm{d}t \\;=\\; P\\,\\mathrm{d}Q \\;-\\; H'\\,\\mathrm{d}t \\;+\\; \\mathrm{d}\\big(F_{2}(q,P) \\;-\\; P\\,Q\\big),\n$$\nso for any closed loop in the extended space, the difference between the loop integrals of $p\\,\\mathrm{d}q - H\\,\\mathrm{d}t$ and $P\\,\\mathrm{d}Q - H'\\,\\mathrm{d}t$ is zero. In particular, on a closed phase-space loop at fixed energy $E$ parametrized over one period, we have $\\oint p\\,\\mathrm{d}q = \\oint P\\,\\mathrm{d}Q$.\n\nPart (a). We compute\n$$\nI \\;=\\; \\oint_{\\mathcal{C}_{E}} p \\,\\mathrm{d}q\n$$\nfor the harmonic oscillator at fixed energy $E$. The energy shell $H(q,p)=E$ is the ellipse\n$$\n\\frac{p^{2}}{2mE} \\;+\\; \\frac{m\\omega^{2} q^{2}}{2E} \\;=\\; 1,\n$$\nwith semi-axes\n$$\nq_{\\max} \\;=\\; \\sqrt{\\frac{2E}{m\\omega^{2}}}, \n\\qquad\np_{\\max} \\;=\\; \\sqrt{2mE}.\n$$\nA direct computation of the loop integral uses the parametrization by time $t$ over one period $T = \\frac{2\\pi}{\\omega}$. A standard solution is\n$$\nq(t) \\;=\\; A \\cos(\\omega t + \\phi), \n\\qquad \np(t) \\;=\\; m \\dot{q}(t) \\;=\\; -m A \\omega \\sin(\\omega t + \\phi),\n$$\nwith amplitude $A = \\sqrt{\\tfrac{2E}{m\\omega^{2}}}$. Then\n$$\nI \\;=\\; \\oint p\\,\\mathrm{d}q \\;=\\; \\int_{0}^{T} p(t)\\,\\dot{q}(t)\\,\\mathrm{d}t.\n$$\nSince $p(t)\\,\\dot{q}(t)=m \\dot{q}(t)^{2} = 2\\,T_{\\text{kin}}(t)$, we have\n$$\nI \\;=\\; \\int_{0}^{T} m \\dot{q}(t)^{2}\\,\\mathrm{d}t \\;=\\; m A^{2} \\omega^{2} \\int_{0}^{T} \\sin^{2}(\\omega t + \\phi)\\,\\mathrm{d}t \\;=\\; m A^{2} \\omega^{2} \\cdot \\frac{T}{2}.\n$$\nUsing $A^{2} = \\tfrac{2E}{m\\omega^{2}}$ and $T = \\tfrac{2\\pi}{\\omega}$, we obtain\n$$\nI \\;=\\; m \\left(\\frac{2E}{m\\omega^{2}}\\right) \\omega^{2} \\cdot \\frac{1}{2}\\cdot \\frac{2\\pi}{\\omega}\n\\;=\\; \\frac{2\\pi E}{\\omega}.\n$$\nAn equivalent geometric argument uses Green’s theorem: the loop integral $\\oint_{\\mathcal{C}_{E}} p\\,\\mathrm{d}q$ equals the signed area enclosed by the ellipse when traversed in the direction induced by the Hamiltonian flow. For the harmonic oscillator, the direction is clockwise, so the integral equals $+\\text{Area}(\\text{ellipse}) = \\pi q_{\\max} p_{\\max} = \\pi \\sqrt{\\frac{2E}{m\\omega^{2}}} \\cdot \\sqrt{2mE} = \\frac{2\\pi E}{\\omega}$, consistent with the time-parameterization result.\n\nPart (b). With\n$$\nF_{2}(q,P) \\;=\\; q\\,P \\;+\\; \\frac{\\gamma}{2}\\,q^{2},\n$$\nthe canonical transformation is\n$$\np \\;=\\; \\frac{\\partial F_{2}}{\\partial q} \\;=\\; P \\;+\\; \\gamma q,\n\\qquad\nQ \\;=\\; \\frac{\\partial F_{2}}{\\partial P} \\;=\\; q.\n$$\nThus,\n$$\nQ \\;=\\; q,\n\\qquad\nP \\;=\\; p - \\gamma q.\n$$\nThe transformed Hamiltonian is the original Hamiltonian expressed in $(Q,P)$:\n$$\nH'(Q,P) \\;=\\; \\frac{\\big(P + \\gamma Q\\big)^{2}}{2m} \\;+\\; \\frac{1}{2} m \\omega^{2} Q^{2}.\n$$\nThe image of the energy-$E$ ellipse $\\mathcal{C}_{E}$ under this linear symplectic transformation is the curve $\\mathcal{C}'_{E}$ defined by $H'(Q,P)=E$. The loop integral in the new variables is\n$$\nI' \\;=\\; \\oint_{\\mathcal{C}'_{E}} P \\,\\mathrm{d}Q.\n$$\nWe compute $I'$ directly from the transformation relations. Since $Q=q$ and $P=p - \\gamma q$ and $\\mathrm{d}Q = \\mathrm{d}q$, we have\n$$\nI' \\;=\\; \\oint_{\\mathcal{C}'_{E}} P\\,\\mathrm{d}Q \\;=\\; \\oint_{\\mathcal{C}_{E}} \\big(p - \\gamma q\\big)\\,\\mathrm{d}q \\;=\\; \\oint_{\\mathcal{C}_{E}} p\\,\\mathrm{d}q \\;-\\; \\gamma \\oint_{\\mathcal{C}_{E}} q\\,\\mathrm{d}q.\n$$\nThe second term vanishes because it is the integral of an exact differential around a closed loop:\n$$\n\\oint_{\\mathcal{C}_{E}} q\\,\\mathrm{d}q \\;=\\; \\frac{1}{2}\\oint_{\\mathcal{C}_{E}} \\mathrm{d}\\big(q^{2}\\big) \\;=\\; 0.\n$$\nTherefore,\n$$\nI' \\;=\\; \\oint_{\\mathcal{C}_{E}} p\\,\\mathrm{d}q \\;=\\; \\frac{2\\pi E}{\\omega}.\n$$\nThis equality is a concrete manifestation of the Poincaré–Cartan integral invariant for time-independent canonical transformations, since the Poincaré–Cartan one-form changes by an exact differential and the loop integral over a closed curve is invariant.\n\nHence, both loop integrals have the common value\n$$\nI \\;=\\; I' \\;=\\; \\frac{2\\pi E}{\\omega}.\n$$",
            "answer": "$$\\boxed{\\frac{2\\pi E}{\\omega}}$$"
        },
        {
            "introduction": "This final practice bridges the gap between abstract theory and computational physics, allowing you to observe the Poincaré integral invariant in action. You will implement a numerical simulation to evolve a set of points in phase space according to Hamiltonian dynamics for both harmonic and nonlinear systems. The key task is to verify that the discrete approximation of the action integral $\\oint p \\, dq$ is conserved over time, a result which hinges on the use of a structure-preserving symplectic integrator like the Störmer-Verlet method . This computational experiment provides tangible confirmation of the theoretical invariant and illustrates the power of geometric integration methods.",
            "id": "3780966",
            "problem": "You are to implement a numerical verification of the Poincaré integral invariant for Hamiltonian flows in one degree of freedom. The verification must start from first principles of geometric mechanics and symplectic methods. Consider the canonical phase space with coordinates $(q,p)$ and the canonical one-form $\\theta = p\\,dq$. A Hamiltonian system is specified by a Hamiltonian function $H(q,p)$, and its flow is defined by Hamilton's equations $\\dot{q} = \\partial H/\\partial p$ and $\\dot{p} = -\\partial H/\\partial q$. The Poincaré integral invariant states that, for a closed curve transported by the Hamiltonian flow, the line integral of the canonical one-form around the curve remains constant in time. Your task is to test this invariance numerically for chosen Hamiltonians by discretizing closed loops in phase space, transporting the loop along the flow for a fixed time, and comparing the discrete approximations to the line integrals.\n\nYour program must implement the following from a valid foundational base:\n- The Hamiltonian flow generated by a separable Hamiltonian $H(q,p) = T(p) + V(q)$ with $T(p) = p^{2}/(2m)$ and a smooth potential $V(q)$. Use the system of ordinary differential equations given by Hamilton's equations.\n- A symplectic time-stepping method consistent with the geometric structure. Use the position-Verlet (also known as Störmer-Verlet) method: for time step $h$, perform\n  - $p_{n+\\frac{1}{2}} = p_{n} - \\frac{h}{2}\\,\\partial V/\\partial q\\,(q_{n})$,\n  - $q_{n+1} = q_{n} + h\\,\\frac{p_{n+\\frac{1}{2}}}{m}$,\n  - $p_{n+1} = p_{n+\\frac{1}{2}} - \\frac{h}{2}\\,\\partial V/\\partial q\\,(q_{n+1})$.\n- A discrete approximation to the line integral of $\\theta$ along a closed loop $\\gamma$ parameterized by $N$ ordered points $\\{(q_{i},p_{i})\\}_{i=0}^{N-1}$ with periodic indexing. Approximate\n$$\n\\oint_{\\gamma} p\\,dq \\approx \\sum_{i=0}^{N-1} p_{i}\\,(q_{i+1}-q_{i}),\n$$\nwith $q_{N} \\equiv q_{0}$ and $p_{N} \\equiv p_{0}$.\n\nConstruct initial closed loops as ellipses centered at the origin in the $(q,p)$-plane using the parametrization $q(\\phi) = a\\cos\\phi$, $p(\\phi) = b\\sin\\phi$ sampled at $N$ equispaced angles $\\phi \\in [0,2\\pi)$.\n\nFor each test case below:\n- Build the initial loop $(q_{i},p_{i})$ for $i=0,\\dots,N-1$.\n- Compute the discrete integral $I_{0}$ from the initial loop.\n- Transport every point of the loop under the Hamiltonian flow for time $\\tau$ using $n$ time steps of the Störmer-Verlet method with step $h=\\tau/n$.\n- Compute the discrete integral $I_{\\tau}$ of the transported loop.\n- Determine whether the invariance holds within a specified absolute tolerance $\\text{tol}$ by checking whether $|I_{\\tau} - I_{0}| \\le \\text{tol}$.\n\nUse only the following Hamiltonians:\n- Harmonic oscillator: $H(q,p) = \\frac{p^{2}}{2m} + \\frac{k}{2}q^{2}$, with $\\partial V/\\partial q = k q$.\n- Quartic oscillator: $H(q,p) = \\frac{p^{2}}{2m} + \\frac{\\lambda}{4}q^{4}$, with $\\partial V/\\partial q = \\lambda q^{3}$.\n\nNo physical units are required; all quantities are dimensionless. Angles for constructing the loops must be in radians.\n\nTest suite:\n- Case $1$ (happy path, harmonic oscillator, fine resolution):\n  - Hamiltonian: harmonic, $m=1$, $k=1$.\n  - Loop parameters: $a=1.3$, $b=0.9$, $N=512$.\n  - Integration parameters: $\\tau=3.7$, $n=1200$.\n  - Tolerance: $\\text{tol}=10^{-6}$.\n- Case $2$ (harmonic oscillator, coarser resolution and larger time):\n  - Hamiltonian: harmonic, $m=1$, $k=2.5$.\n  - Loop parameters: $a=2.0$, $b=1.5$, $N=96$.\n  - Integration parameters: $\\tau=10.0$, $n=100$.\n  - Tolerance: $\\text{tol}=5\\times 10^{-3}$.\n- Case $3$ (quartic oscillator, fine resolution):\n  - Hamiltonian: quartic, $m=1$, $\\lambda=0.75$.\n  - Loop parameters: $a=1.2$, $b=0.8$, $N=512$.\n  - Integration parameters: $\\tau=1.3$, $n=1800$.\n  - Tolerance: $\\text{tol}=10^{-5}$.\n- Case $4$ (quartic oscillator, moderate resolution and longer time):\n  - Hamiltonian: quartic, $m=1$, $\\lambda=1.0$.\n  - Loop parameters: $a=0.9$, $b=1.5$, $N=128$.\n  - Integration parameters: $\\tau=4.2$, $n=160$.\n  - Tolerance: $\\text{tol}=2\\times 10^{-2}$.\n- Case $5$ (edge case with very small loop amplitude):\n  - Hamiltonian: harmonic, $m=1$, $k=1$.\n  - Loop parameters: $a=0.02$, $b=0.015$, $N=256$.\n  - Integration parameters: $\\tau=2.0$, $n=200$.\n  - Tolerance: $\\text{tol}=10^{-6}$.\n\nYour program should produce a single line of output containing the boolean results for the cases, formatted as a comma-separated list enclosed in square brackets, for example $[{\\rm True},{\\rm False},{\\rm True},\\dots]$. The result for each test case is ${\\rm True}$ if $|I_{\\tau} - I_{0}| \\le \\text{tol}$ and ${\\rm False}$ otherwise. No other output is permitted.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n\n- **Canonical One-Form:** $\\theta = p\\,dq$ in the canonical phase space with coordinates $(q,p)$.\n- **Hamiltonian System:** The flow is defined by Hamilton's equations $\\dot{q} = \\partial H/\\partial p$ and $\\dot{p} = -\\partial H/\\partial q$.\n- **Poincaré Integral Invariant:** For a closed curve $\\gamma(t)$ transported by the Hamiltonian flow, the line integral $\\oint_{\\gamma(t)} p\\,dq$ is constant in time.\n- **Hamiltonian Form:** Separable Hamiltonian $H(q,p) = T(p) + V(q)$ with kinetic energy $T(p) = p^{2}/(2m)$ and a smooth potential $V(q)$.\n- **Numerical Integrator:** Störmer-Verlet method with time step $h$:\n  1. $p_{n+\\frac{1}{2}} = p_{n} - \\frac{h}{2}\\,\\partial V/\\partial q\\,(q_{n})$\n  2. $q_{n+1} = q_{n} + h\\,\\frac{p_{n+\\frac{1}{2}}}{m}$\n  3. $p_{n+1} = p_{n+\\frac{1}{2}} - \\frac{h}{2}\\,\\partial V/\\partial q\\,(q_{n+1})$\n- **Discrete Line Integral:** For a loop of $N$ points $\\{(q_{i},p_{i})\\}_{i=0}^{N-1}$, the integral is approximated as $\\oint_{\\gamma} p\\,dq \\approx \\sum_{i=0}^{N-1} p_{i}\\,(q_{i+1}-q_{i})$, with periodic indexing $q_{N} \\equiv q_{0}$.\n- **Initial Loop Construction:** Ellipses parameterized by $q(\\phi) = a\\cos\\phi$, $p(\\phi) = b\\sin\\phi$ sampled at $N$ equispaced angles $\\phi \\in [0,2\\pi)$.\n- **Hamiltonians and Forces:**\n  - Harmonic oscillator: $H(q,p) = \\frac{p^{2}}{2m} + \\frac{k}{2}q^{2}$, with $\\partial V/\\partial q = k q$.\n  - Quartic oscillator: $H(q,p) = \\frac{p^{2}}{2m} + \\frac{\\lambda}{4}q^{4}$, with $\\partial V/\\partial q = \\lambda q^{3}$.\n- **Verification Criterion:** The invariance holds if $|I_{\\tau} - I_{0}| \\le \\text{tol}$, where $I_0$ and $I_\\tau$ are the discrete integrals at time $0$ and $\\tau$, respectively.\n- **Test Suite:**\n  - Case $1$: harmonic, $m=1$, $k=1$, $a=1.3$, $b=0.9$, $N=512$, $\\tau=3.7$, $n=1200$, $\\text{tol}=10^{-6}$.\n  - Case $2$: harmonic, $m=1$, $k=2.5$, $a=2.0$, $b=1.5$, $N=96$, $\\tau=10.0$, $n=100$, $\\text{tol}=5\\times 10^{-3}$.\n  - Case $3$: quartic, $m=1$, $\\lambda=0.75$, $a=1.2$, $b=0.8$, $N=512$, $\\tau=1.3$, $n=1800$, $\\text{tol}=10^{-5}$.\n  - Case $4$: quartic, $m=1$, $\\lambda=1.0$, $a=0.9$, $b=1.5$, $N=128$, $\\tau=4.2$, $n=160$, $\\text{tol}=2\\times 10^{-2}$.\n  - Case $5$: harmonic, $m=1$, $k=1$, $a=0.02$, $b=0.015$, $N=256$, $\\tau=2.0$, $n=200$, $\\text{tol}=10^{-6}$.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem statement is evaluated against the validation criteria.\n\n- **Scientifically Grounded:** The problem is firmly rooted in classical mechanics, specifically Hamiltonian dynamics and symplectic geometry. The Poincaré integral invariant, Hamilton's equations, and the use of a symplectic integrator (Störmer-Verlet) are all standard, well-established concepts in geometric mechanics. The problem is free of pseudoscience and factual errors.\n- **Well-Posed:** The problem is well-posed. It specifies a clear computational task: for each of the $5$ test cases with fully provided parameters, perform a set of defined numerical steps and return a boolean result based on a clear criterion. The solution is unique and meaningful within the context of numerical verification.\n- **Objective:** The language is precise, mathematical, and free of subjective or ambiguous statements. All terms like \"Hamiltonian flow\", \"Störmer-Verlet method\", and the discrete integral approximation are defined explicitly.\n\nThe problem does not exhibit any invalidating flaws. It is scientifically sound, fully specified, and computationally feasible. The choice of a symplectic integrator for verifying an invariant of a symplectic map is a key feature, making the problem conceptually robust rather than trivial.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. A solution will be developed.\n\n### Solution\n\nThe solution involves implementing a numerical experiment to verify the Poincaré integral invariant, $\\oint p\\,dq$, for Hamiltonian systems. The core principle is that Hamiltonian flows are symplectomorphisms, which preserve the symplectic two-form $\\omega = dq \\wedge dp$. By Stokes' theorem, the preservation of the area integral $\\iint_A \\omega$ over any surface $A$ implies the preservation of the line integral $\\oint_{\\partial A} \\theta$ of the canonical one-form $\\theta=p\\,dq$ around the boundary $\\partial A$. This problem tests this invariance directly for chosen closed loops.\n\nA critical aspect of the numerical implementation is the choice of integrator. Standard numerical methods like the Euler method or Runge-Kutta methods, while often accurate for short times, are generally not symplectic. They do not preserve the geometric structure of the phase space, leading to secular drift in conserved quantities, including the Poincaré invariant. The problem correctly prescribes the Störmer-Verlet method, which is a second-order symplectic integrator. Its symplectic nature ensures that it preserves a discrete analogue of the integral invariant to a high degree of accuracy, making it exceptionally well-suited for long-term simulations and for verifying geometric conservation laws like this one.\n\nThe implementation will proceed in the following steps for each test case:\n\n1.  **Define the System:** Based on the test case, establish the parameters for the Hamiltonian: mass $m$ and potential parameters ($k$ or $\\lambda$). This defines the force function $F(q) = -\\partial V/\\partial q$, which is $F(q) = -kq$ for the harmonic oscillator and $F(q) = -\\lambda q^3$ for the quartic oscillator.\n\n2.  **Generate the Initial Loop:** A closed loop in phase space is discretized into $N$ points. These points are generated using the given parametric form for an ellipse:\n    $$\n    q_i = a\\cos(\\phi_i), \\quad p_i = b\\sin(\\phi_i)\n    $$\n    where $\\phi_i = 2\\pi i/N$ for $i = 0, 1, \\dots, N-1$.\n\n3.  **Compute the Initial Integral:** The line integral $\\oint p\\,dq$ is approximated using the specified discrete formula. Let the initial loop be represented by arrays $q^{(0)}$ and $p^{(0)}$ of length $N$. The initial integral $I_0$ is calculated as:\n    $$\n    I_0 = \\sum_{i=0}^{N-1} p_i^{(0)} (q_{i+1}^{(0)} - q_i^{(0)})\n    $$\n    The periodic boundary condition $q_N \\equiv q_0$ will be handled by cyclically shifting the $q$ array.\n\n4.  **Evolve the Loop in Time:** Each of the $N$ points on the loop is evolved forward in time from $t=0$ to $t=\\tau$ using the Störmer-Verlet method. This is done for $n$ steps, each of duration $h = \\tau/n$. For each step and for every point $(q_j, p_j)$ on the loop:\n    $$\n    p_{j, \\text{half}} = p_j + \\frac{h}{2} F(q_j)\n    $$\n    $$\n    q_{j, \\text{new}} = q_j + h \\frac{p_{j, \\text{half}}}{m}\n    $$\n    $$\n    p_{j, \\text{new}} = p_{j, \\text{half}} + \\frac{h}{2} F(q_{j, \\text{new}})\n    $$\n    This process is repeated $n$ times to obtain the final loop points $(q^{(\\tau)}, p^{(\\tau)})$. This calculation is vectorized for efficiency, applying the update rules to the entire arrays of $q$ and $p$ points simultaneously.\n\n5.  **Compute the Final Integral:** Using the same discrete formula, the integral $I_{\\tau}$ is computed for the transported loop with points $(q^{(\\tau)}, p^{(\\tau)})$.\n\n6.  **Verify Invariance:** The absolute difference between the initial and final integrals, $|I_{\\tau} - I_0|$, is compared against the specified tolerance, $\\text{tol}$. The result is `True` if the difference is within the tolerance and `False` otherwise. This procedure is repeated for all test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Numerically verifies the Poincaré integral invariant for Hamiltonian flows.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: harmonic oscillator, fine resolution\n        {\n            \"hamiltonian\": \"harmonic\",\n            \"params\": {\"m\": 1.0, \"k\": 1.0},\n            \"loop\": {\"a\": 1.3, \"b\": 0.9, \"N\": 512},\n            \"integration\": {\"tau\": 3.7, \"n\": 1200},\n            \"tol\": 1e-6,\n        },\n        # Case 2: harmonic oscillator, coarser resolution\n        {\n            \"hamiltonian\": \"harmonic\",\n            \"params\": {\"m\": 1.0, \"k\": 2.5},\n            \"loop\": {\"a\": 2.0, \"b\": 1.5, \"N\": 96},\n            \"integration\": {\"tau\": 10.0, \"n\": 100},\n            \"tol\": 5e-3,\n        },\n        # Case 3: quartic oscillator, fine resolution\n        {\n            \"hamiltonian\": \"quartic\",\n            \"params\": {\"m\": 1.0, \"lambda\": 0.75},\n            \"loop\": {\"a\": 1.2, \"b\": 0.8, \"N\": 512},\n            \"integration\": {\"tau\": 1.3, \"n\": 1800},\n            \"tol\": 1e-5,\n        },\n        # Case 4: quartic oscillator, moderate resolution\n        {\n            \"hamiltonian\": \"quartic\",\n            \"params\": {\"m\": 1.0, \"lambda\": 1.0},\n            \"loop\": {\"a\": 0.9, \"b\": 1.5, \"N\": 128},\n            \"integration\": {\"tau\": 4.2, \"n\": 160},\n            \"tol\": 2e-2,\n        },\n        # Case 5: edge case, small loop\n        {\n            \"hamiltonian\": \"harmonic\",\n            \"params\": {\"m\": 1.0, \"k\": 1.0},\n            \"loop\": {\"a\": 0.02, \"b\": 0.015, \"N\": 256},\n            \"integration\": {\"tau\": 2.0, \"n\": 200},\n            \"tol\": 1e-6,\n        },\n    ]\n\n    results = []\n\n    def compute_integral(q, p):\n        \"\"\"\n        Computes the discrete line integral sum_{i=0}^{N-1} p_i * (q_{i+1} - q_i).\n        The periodic boundary is handled by np.roll.\n        \"\"\"\n        q_next = np.roll(q, -1)\n        dq = q_next - q\n        return np.sum(p * dq)\n\n    for case in test_cases:\n        # Unpack parameters\n        hamiltonian_type = case[\"hamiltonian\"]\n        m = case[\"params\"][\"m\"]\n        a = case[\"loop\"][\"a\"]\n        b = case[\"loop\"][\"b\"]\n        N = case[\"loop\"][\"N\"]\n        tau = case[\"integration\"][\"tau\"]\n        n_steps = case[\"integration\"][\"n\"]\n        tol = case[\"tol\"]\n\n        # Define force function F(q) = -dV/dq\n        if hamiltonian_type == \"harmonic\":\n            k = case[\"params\"][\"k\"]\n            force_func = lambda q_vals: -k * q_vals\n        elif hamiltonian_type == \"quartic\":\n            lambda_p = case[\"params\"][\"lambda\"]\n            force_func = lambda q_vals: -lambda_p * q_vals**3\n        else:\n            raise ValueError(\"Unknown Hamiltonian type\")\n            \n        # 1. Generate initial loop\n        phi = np.linspace(0, 2 * np.pi, N, endpoint=False)\n        q0 = a * np.cos(phi)\n        p0 = b * np.sin(phi)\n\n        # 2. Compute initial integral\n        I0 = compute_integral(q0, p0)\n\n        # 3. Evolve the loop using Störmer-Verlet integrator\n        q = q0.copy()\n        p = p0.copy()\n        h = tau / n_steps\n\n        for _ in range(n_steps):\n            # p_{n+1/2} = p_n - (h/2) * dV/dq(q_n) = p_n + (h/2) * F(q_n)\n            p_half = p + (h / 2.0) * force_func(q)\n            # q_{n+1} = q_n + h * p_{n+1/2} / m\n            q = q + h * p_half / m\n            # p_{n+1} = p_{n+1/2} - (h/2) * dV/dq(q_{n+1}) = p_{n+1/2} + (h/2) * F(q_{n+1})\n            p = p_half + (h / 2.0) * force_func(q)\n            \n        # 4. Compute final integral\n        I_tau = compute_integral(q, p)\n\n        # 5. Verify invariance\n        is_invariant = np.abs(I_tau - I0) = tol\n        results.append(is_invariant)\n\n    # Format and print output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}