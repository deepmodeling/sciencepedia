{
    "hands_on_practices": [
        {
            "introduction": "The conservation of energy in an autonomous system is a cornerstone of Hamiltonian mechanics. This first exercise provides a concrete verification of this principle using the simple harmonic oscillator, a ubiquitous model in physics. By starting from the fundamental geometric definition of the Hamiltonian vector field, you will derive the equations of motion and directly show that the total energy, represented by the Hamiltonian $H$, remains constant over time . This practice reinforces the deep connection between the time-independence of the Hamiltonian and its role as a conserved quantity.",
            "id": "3734532",
            "problem": "Consider the one-degree-of-freedom harmonic oscillator on the phase space $\\mathbb{R}^{2}$ with canonical coordinates $(q,p)$ and the canonical symplectic form $\\omega=\\mathrm{d}q\\wedge \\mathrm{d}p$. The Hamiltonian function is\n$$\nH(q,p)=\\frac{p^{2}}{2m}+\\frac{1}{2}k\\,q^{2},\n$$\nwhere $m>0$ and $k>0$ are constant parameters. Use the geometric definition of a Hamiltonian system—namely, the Hamiltonian vector field $X_{H}$ defined by the contraction relation $i_{X_{H}}\\omega=\\mathrm{d}H$—as the fundamental starting point. From this base, derive the equations of motion and then compute the time derivative $\\mathrm{d}H/\\mathrm{d}t$ along the flow generated by $H$. Explain why the result demonstrates conservation of energy for this autonomous system. Additionally, determine the constant value of $H$ along trajectories in terms of the initial conditions $(q(0),p(0))$ to exhibit its invariance.\n\nYour final reported quantity must be the value of $\\mathrm{d}H/\\mathrm{d}t$ along solutions. Provide this value as a single real number or a single closed-form analytic expression. No rounding is required, and no units should be included in the final reported quantity.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It presents a standard problem in geometric mechanics—the harmonic oscillator—and asks for a derivation based on fundamental principles, specifically the relationship between a Hamiltonian function $H$, its corresponding vector field $X_H$, and the symplectic form $\\omega$.\n\nThe system is defined on the phase space $\\mathbb{R}^{2}$ with canonical coordinates $(q,p)$. The Hamiltonian function is given by\n$$H(q,p) = \\frac{p^2}{2m} + \\frac{1}{2}k q^2$$\nand the canonical symplectic form is\n$$\\omega = \\mathrm{d}q \\wedge \\mathrm{d}p$$\nwhere $m > 0$ and $k > 0$ are constants. The analysis begins with the fundamental definition of the Hamiltonian vector field $X_H$ via the contraction relation:\n$$i_{X_H}\\omega = \\mathrm{d}H$$\n\nFirst, we compute the exterior derivative of the Hamiltonian, $\\mathrm{d}H$. Using the rules of calculus on manifolds, we have:\n$$\\mathrm{d}H = \\frac{\\partial H}{\\partial q} \\mathrm{d}q + \\frac{\\partial H}{\\partial p} \\mathrm{d}p$$\nThe partial derivatives are:\n$$\\frac{\\partial H}{\\partial q} = k q$$\n$$\\frac{\\partial H}{\\partial p} = \\frac{p}{m}$$\nSubstituting these into the expression for $\\mathrm{d}H$ yields:\n$$\\mathrm{d}H = k q \\, \\mathrm{d}q + \\frac{p}{m} \\, \\mathrm{d}p$$\n\nNext, we represent the Hamiltonian vector field $X_H$ in the coordinate basis $\\{\\frac{\\partial}{\\partial q}, \\frac{\\partial}{\\partial p}\\}$. Let its components be the rates of change of the coordinates, $\\dot{q}$ and $\\dot{p}$:\n$$X_H = \\dot{q} \\frac{\\partial}{\\partial q} + \\dot{p} \\frac{\\partial}{\\partial p}$$\nNow we compute the contraction $i_{X_H}\\omega$. Using the linearity of the interior product and its action on wedge products:\n$$i_{X_H}\\omega = i_{\\left(\\dot{q} \\frac{\\partial}{\\partial q} + \\dot{p} \\frac{\\partial}{\\partial p}\\right)}(\\mathrm{d}q \\wedge \\mathrm{d}p)$$\n$$i_{X_H}\\omega = \\dot{q} \\, i_{\\frac{\\partial}{\\partial q}}(\\mathrm{d}q \\wedge \\mathrm{d}p) + \\dot{p} \\, i_{\\frac{\\partial}{\\partial p}}(\\mathrm{d}q \\wedge \\mathrm{d}p)$$\nThe interior product contracts a vector field with a differential form. We recall that $i_{\\frac{\\partial}{\\partial x^i}} \\mathrm{d}x^j = \\delta^j_i$, where $\\delta^j_i$ is the Kronecker delta.\n$$i_{\\frac{\\partial}{\\partial q}}(\\mathrm{d}q \\wedge \\mathrm{d}p) = (i_{\\frac{\\partial}{\\partial q}}\\mathrm{d}q) \\wedge \\mathrm{d}p - \\mathrm{d}q \\wedge (i_{\\frac{\\partial}{\\partial q}}\\mathrm{d}p) = 1 \\cdot \\mathrm{d}p - \\mathrm{d}q \\wedge 0 = \\mathrm{d}p$$\n$$i_{\\frac{\\partial}{\\partial p}}(\\mathrm{d}q \\wedge \\mathrm{d}p) = (i_{\\frac{\\partial}{\\partial p}}\\mathrm{d}q) \\wedge \\mathrm{d}p - \\mathrm{d}q \\wedge (i_{\\frac{\\partial}{\\partial p}}\\mathrm{d}p) = 0 \\wedge \\mathrm{d}p - \\mathrm{d}q \\wedge 1 = -\\mathrm{d}q$$\nSubstituting these back, we find the expression for the contraction:\n$$i_{X_H}\\omega = \\dot{q} \\, \\mathrm{d}p - \\dot{p} \\, \\mathrm{d}q$$\n\nTo derive the equations of motion, we equate the two expressions for $\\mathrm{d}H$ and $i_{X_H}\\omega$:\n$$-\\dot{p} \\, \\mathrm{d}q + \\dot{q} \\, \\mathrm{d}p = k q \\, \\mathrm{d}q + \\frac{p}{m} \\, \\mathrm{d}p$$\nSince $\\{\\mathrm{d}q, \\mathrm{d}p\\}$ forms a basis for the cotangent space at each point, we can equate the coefficients of the basis $1$-forms:\n\\begin{align*}\n\\text{Coefficient of } \\mathrm{d}q: \\quad & -\\dot{p} = k q \\implies \\dot{p} = -k q \\\\\n\\text{Coefficient of } \\mathrm{d}p: \\quad & \\dot{q} = \\frac{p}{m}\n\\end{align*}\nThese are the familiar Hamilton's equations for the harmonic oscillator.\n\nThe next task is to compute the time derivative of $H$ along the solution trajectories, which are the integral curves of the vector field $X_H$. This rate of change is given by the action of the vector field on the function $H$, which can be computed using the chain rule:\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = \\frac{\\partial H}{\\partial q} \\frac{\\mathrm{d}q}{\\mathrm{d}t} + \\frac{\\partial H}{\\partial p} \\frac{\\mathrm{d}p}{\\mathrm{d}t} = \\frac{\\partial H}{\\partial q} \\dot{q} + \\frac{\\partial H}{\\partial p} \\dot{p}$$\nSubstituting the partial derivatives of $H$ and the equations of motion we just derived:\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = (k q) \\left(\\frac{p}{m}\\right) + \\left(\\frac{p}{m}\\right) (-k q) = \\frac{kqp}{m} - \\frac{kqp}{m} = 0$$\n\nThis result, $\\frac{\\mathrm{d}H}{\\mathrm{d}t}=0$, demonstrates the conservation of energy. Since the Hamiltonian $H$ is autonomous (it has no explicit dependence on time) and represents the total mechanical energy of the system (kinetic energy $\\frac{p^2}{2m}$ plus potential energy $\\frac{1}{2}k q^2$), the fact that its time derivative is zero means that the total energy is a constant of motion.\n\nA more profound geometric argument confirms this result for any autonomous Hamiltonian system. The time derivative of $H$ along the flow of $X_H$ is the Lie derivative of $H$ with respect to $X_H$:\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = \\mathcal{L}_{X_H} H = \\mathrm{d}H(X_H)$$\nUsing the defining relation $i_{X_H}\\omega=\\mathrm{d}H$, we can substitute for $\\mathrm{d}H$:\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = (i_{X_H}\\omega)(X_H)$$\nBy the definition of the interior product, $(i_V\\alpha)(W) = \\alpha(V,W)$ for a $2$-form $\\alpha$. Therefore:\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = \\omega(X_H, X_H)$$\nA symplectic form $\\omega$ is, by definition, an alternating $2$-form, meaning it is skew-symmetric: $\\omega(V,W) = -\\omega(W,V)$ for any vector fields $V, W$. A direct consequence of skew-symmetry is that $\\omega(V,V)=0$ for any vector field $V$. Thus:\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = \\omega(X_H, X_H) = 0$$\nThis elegant proof shows that energy conservation is a direct consequence of the geometric structure of Hamiltonian mechanics.\n\nFinally, we determine the constant value of $H$. Since $\\frac{\\mathrm{d}H}{\\mathrm{d}t}=0$, the value of $H(q(t), p(t))$ is constant for all time $t$. This constant is determined by the state of the system at any time, typically the initial time $t=0$. Given the initial conditions $(q(0), p(0))$, the value of the Hamiltonian for the entire trajectory is:\n$$H(q(t), p(t)) = H(q(0), p(0)) = \\frac{p(0)^2}{2m} + \\frac{1}{2}k q(0)^2$$\nThis expression confirms the invariance of the Hamiltonian along the system's trajectories. The specific quantity requested by the problem is the value of $\\mathrm{d}H/\\mathrm{d}t$. As demonstrated by two methods, this value is $0$.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Understanding when a principle applies is as important as understanding the principle itself. This practice explores a scenario where energy is *not* conserved by introducing a Hamiltonian with explicit time dependence . By calculating the rate of change of energy for a particle in a time-varying linear potential, you will see that $\\frac{dH}{dt} = \\frac{\\partial H}{\\partial t}$, directly demonstrating that energy conservation is tied to the system's invariance under time translation. This exercise highlights a crucial result from Noether's theorem in the Hamiltonian context.",
            "id": "3734526",
            "problem": "Consider a single-degree-of-freedom Hamiltonian system on the cotangent bundle $T^{\\ast}\\mathbb{R}$ with canonical coordinates $(x,p)$ and canonical symplectic form $\\omega = dx \\wedge dp$. Let the Hamiltonian be\n$$\nH(x,p,t) = \\frac{p^{2}}{2m} + \\gamma\\, t\\, x,\n$$\nwhere $m>0$ and $\\gamma \\neq 0$ are constants. The configuration-space coordinate and velocity at time $t=0$ are $x(0) = x_{0}$ and $\\dot{x}(0) = v_{0}$.\n\nStarting only from fundamental definitions of Hamiltonian dynamics and symplectic geometry—specifically, that the Hamiltonian vector field $X_{H}$ satisfies $\\iota_{X_{H}}\\omega = dH$, which in canonical coordinates yields Hamilton’s equations $\\dot{x} = \\partial H/\\partial p$ and $\\dot{p} = -\\partial H/\\partial x$—do the following:\n\n1. Derive the explicit trajectory $x(t)$ and momentum $p(t)$ for this system.\n\n2. Using the chain rule together with Hamilton’s equations, compute the instantaneous rate of change of the energy $H(x(t),p(t),t)$ along the Hamiltonian flow, expressed as a function of $t$, $m$, $\\gamma$, $x_{0}$, and $v_{0}$. Give your final answer as a single closed-form analytic expression.\n\n3. Briefly, and based solely on first principles, explain why this example demonstrates the failure of the Jacobi–Maupertuis principle (JMP) when $\\partial V/\\partial t \\neq 0$, where $V(x,t) = \\gamma\\, t\\, x$. Do not use any pre-stated target formulas; instead, ground your reasoning in the requirement of a fixed energy level for the construction of a time-independent Jacobi metric.\n\nYour final answer must be the explicit analytic expression obtained in part 2. No numerical approximation is required.",
            "solution": "The problem as stated is formally valid. It is scientifically grounded in the principles of classical and geometric mechanics, well-posed with sufficient initial conditions to yield a unique solution, and expressed in objective, unambiguous mathematical language. All necessary information is provided, and there are no internal contradictions. We may therefore proceed with the solution.\n\nThe solution is structured in three parts as requested by the problem statement.\n\n### Part 1: Derivation of the Trajectory and Momentum\n\nWe are given the Hamiltonian for a single-degree-of-freedom system:\n$$\nH(x,p,t) = \\frac{p^{2}}{2m} + \\gamma\\, t\\, x\n$$\nwhere $m > 0$ and $\\gamma \\neq 0$ are constants. The canonical coordinates are $(x,p)$.\n\nThe dynamics are governed by Hamilton's equations, which are derived from the fundamental relation $\\iota_{X_{H}}\\omega = dH$. In the canonical coordinates $(x,p)$ with the symplectic form $\\omega = dx \\wedge dp$, these equations are:\n$$\n\\dot{x} = \\frac{\\partial H}{\\partial p}\n$$\n$$\n\\dot{p} = -\\frac{\\partial H}{\\partial x}\n$$\n\nFirst, we compute the required partial derivatives of the Hamiltonian:\n$$\n\\frac{\\partial H}{\\partial p} = \\frac{\\partial}{\\partial p}\\left(\\frac{p^{2}}{2m} + \\gamma\\, t\\, x\\right) = \\frac{p}{m}\n$$\n$$\n\\frac{\\partial H}{\\partial x} = \\frac{\\partial}{\\partial x}\\left(\\frac{p^{2}}{2m} + \\gamma\\, t\\, x\\right) = \\gamma t\n$$\n\nSubstituting these into Hamilton's equations yields the system of ordinary differential equations for the trajectory $(x(t), p(t))$:\n$$\n\\text{(1)} \\quad \\dot{x} = \\frac{p}{m}\n$$\n$$\n\\text{(2)} \\quad \\dot{p} = -\\gamma t\n$$\n\nWe begin by solving equation (2) for the momentum $p(t)$. This is a first-order separable differential equation. We integrate with respect to time from $t=0$ to an arbitrary time $t$:\n$$\n\\int_{p(0)}^{p(t)} dp' = \\int_{0}^{t} (-\\gamma \\tau) \\, d\\tau\n$$\n$$\np(t) - p(0) = -\\gamma \\left[ \\frac{\\tau^2}{2} \\right]_{0}^{t} = -\\frac{\\gamma t^2}{2}\n$$\nThe initial momentum $p(0)$ is related to the initial velocity $\\dot{x}(0) = v_0$ through equation (1):\n$$\np(0) = m \\dot{x}(0) = m v_0\n$$\nSubstituting this into the integrated expression for $p(t)$, we obtain the explicit form of the momentum:\n$$\np(t) = m v_0 - \\frac{1}{2}\\gamma t^2\n$$\n\nNext, we solve for the position $x(t)$ using equation (1), $\\dot{x}(t) = p(t)/m$. Substituting the expression for $p(t)$:\n$$\n\\dot{x}(t) = \\frac{1}{m}\\left(m v_0 - \\frac{1}{2}\\gamma t^2\\right) = v_0 - \\frac{\\gamma t^2}{2m}\n$$\nWe integrate this equation with respect to time from $t=0$ to $t$, using the initial condition $x(0) = x_0$:\n$$\n\\int_{x(0)}^{x(t)} dx' = \\int_{0}^{t} \\left(v_0 - \\frac{\\gamma \\tau^2}{2m}\\right) \\, d\\tau\n$$\n$$\nx(t) - x(0) = \\left[ v_0 \\tau - \\frac{\\gamma \\tau^3}{6m} \\right]_{0}^{t} = v_0 t - \\frac{\\gamma t^3}{6m}\n$$\nUsing the initial condition $x(0) = x_0$, we find the explicit trajectory:\n$$\nx(t) = x_0 + v_0 t - \\frac{\\gamma t^3}{6m}\n$$\n\n### Part 2: Instantaneous Rate of Change of Energy\n\nWe are asked to compute the total time derivative of the Hamiltonian, $H(x(t), p(t), t)$, along the trajectory of the system. We use the multivariate chain rule:\n$$\n\\frac{dH}{dt} = \\frac{\\partial H}{\\partial x}\\frac{dx}{dt} + \\frac{\\partial H}{\\partial p}\\frac{dp}{dt} + \\frac{\\partial H}{\\partial t}\n$$\nFrom Hamilton's equations, we have the substitutions $\\frac{dx}{dt} = \\dot{x} = \\frac{\\partial H}{\\partial p}$ and $\\frac{dp}{dt} = \\dot{p} = -\\frac{\\partial H}{\\partial x}$. Substituting these into the chain rule expression:\n$$\n\\frac{dH}{dt} = \\frac{\\partial H}{\\partial x}\\left(\\frac{\\partial H}{\\partial p}\\right) + \\frac{\\partial H}{\\partial p}\\left(-\\frac{\\partial H}{\\partial x}\\right) + \\frac{\\partial H}{\\partial t}\n$$\nThe first two terms cancel, a general property of Hamiltonian flows:\n$$\n\\frac{dH}{dt} = \\frac{\\partial H}{\\partial x}\\frac{\\partial H}{\\partial p} - \\frac{\\partial H}{\\partial p}\\frac{\\partial H}{\\partial x} + \\frac{\\partial H}{\\partial t} = \\frac{\\partial H}{\\partial t}\n$$\nThis demonstrates that for any Hamiltonian system, the total rate of change of energy along a trajectory is equal to the explicit partial derivative of the Hamiltonian with respect to time.\n\nFor the given Hamiltonian, $H(x,p,t) = \\frac{p^{2}}{2m} + \\gamma\\, t\\, x$, this partial derivative is:\n$$\n\\frac{\\partial H}{\\partial t} = \\frac{\\partial}{\\partial t}\\left(\\frac{p^{2}}{2m} + \\gamma t x\\right) = \\gamma x\n$$\nTherefore, the rate of change of energy along the flow is $\\frac{dH}{dt} = \\gamma x(t)$. To express this in terms of the initial conditions and system parameters, we substitute the expression for $x(t)$ derived in Part 1:\n$$\n\\frac{dH}{dt} = \\gamma \\left( x_0 + v_0 t - \\frac{\\gamma t^3}{6m} \\right)\n$$\nExpanding this gives the final analytic expression for the rate of change of energy:\n$$\n\\frac{dH}{dt} = \\gamma x_0 + \\gamma v_0 t - \\frac{\\gamma^2 t^3}{6m}\n$$\n\n### Part 3: Failure of the Jacobi–Maupertuis Principle\n\nThe Jacobi–Maupertuis principle (JMP) connects the trajectories of a conservative mechanical system with the geodesics of a specific Riemannian metric on the configuration space. Its derivation is predicated on the conservation of energy.\n\nThe principle starts from a time-independent Hamiltonian $H(q,p) = T(q,p) + V(q)$, where the energy $H$ is a constant of motion, $H=E$. The action principle can be reformulated into the abbreviated action, $S_0 = \\int p \\cdot dq$. For a standard kinetic term $T = \\sum_i \\frac{p_i^2}{2m_i}$, the momentum magnitude is given by solving for $|p|$ from $E = T+V$, which yields $|p| = \\sqrt{2m(E-V(q))}$ for a single particle. The action becomes $S_0 = \\int \\sqrt{2m(E-V(q))} \\, ds$, where $ds$ is the Euclidean arc length element on the configuration manifold.\n\nThe expression $\\sqrt{2m(E-V(q))}$ is used to define a conformal factor for a new metric, the Jacobi metric, $g_J = 2m(E-V(q)) g_{\\text{Euclidean}}$. The trajectories of the mechanical system having energy $E$ are then the geodesics of the configuration manifold endowed with this metric $g_J$.\n\nThe crucial, foundational requirement for this entire construction is the existence of a single, constant value of energy, $E$, that characterizes the trajectory. The Jacobi metric itself is defined using this constant $E$.\n\nIn the problem at hand, the potential energy is $V(x,t) = \\gamma t x$, which is explicitly time-dependent. As shown in Part 2, this explicit time dependence leads to non-conservation of energy:\n$$\n\\frac{dH}{dt} = \\frac{\\partial H}{\\partial t} = \\frac{\\partial V}{\\partial t} = \\gamma x(t)\n$$\nSince $\\gamma \\neq 0$ and $x(t)$ is generally not zero, the energy $H(t)$ is not constant along a given path. Because there is no fixed energy level $E$ associated with the trajectory, it is impossible to define a single, time-independent Jacobi metric whose geodesics would correspond to the system's path. The very premise of the JMP—reformulating the dynamics as a purely geometric problem on a static manifold—is invalid when the energy landscape itself is changing over time. Thus, the JMP fails for systems where $\\partial V/\\partial t \\neq 0$.",
            "answer": "$$\n\\boxed{\\gamma x_{0} + \\gamma v_{0} t - \\frac{\\gamma^{2} t^{3}}{6m}}\n$$"
        },
        {
            "introduction": "The theoretical elegance of energy conservation has profound practical implications for computational science. This exercise moves from analytical theory to numerical practice, tasking you with simulating a Hamiltonian system using two different algorithms . By comparing the long-term energy behavior of a non-symplectic method (explicit Euler) with a structure-preserving symplectic integrator (Størmer–Verlet), you will gain hands-on experience with why geometric integrators are essential for obtaining physically meaningful results in long-time simulations of mechanical systems.",
            "id": "3734508",
            "problem": "Consider the one-dimensional harmonic oscillator with Hamiltonian $H(q,p) = \\frac{p^2}{2m} + \\frac{1}{2} k q^2$, where $q$ denotes position, $p$ denotes momentum, $m$ is the mass, and $k$ is the stiffness parameter. The exact Hamiltonian dynamics are governed by Hamilton's equations, which are fundamental in geometric mechanics: $\\dot{q} = \\partial H / \\partial p$ and $\\dot{p} = -\\partial H / \\partial q$. For this separable Hamiltonian, these equations generate symplectic flows on phase space that conserve the total energy $H(q,p)$ exactly. The purpose of this problem is to quantify and compare the energy behavior of two numerical time-stepping methods applied to this system: a symplectic method (Stoermer–Verlet) and a non-symplectic method (explicit Euler).\n\nStarting from the fundamental laws and core definitions of Hamiltonian systems and the concept of symplecticity, derive the update rules for the Stoermer–Verlet method by composing exact partial flows associated with the kinetic energy $\\frac{p^2}{2m}$ and the potential energy $\\frac{1}{2}k q^2$. Similarly, derive the explicit Euler updates directly from Hamilton's equations treated as a first-order system. Implement both integrators for the harmonic oscillator and, for a range of time steps and parameters, compute the maximum relative energy error over a finite time horizon. The relative error at a discrete time $t_n$ is defined as $\\left|H(q_n,p_n) - H(q_0,p_0)\\right| / H(q_0,p_0)$, which is dimensionless. Because the energy $H$ has physical units, you are required to report unitless relative errors only. Angles do not appear explicitly in this problem, so no angle unit specification is necessary.\n\nYour program must:\n- Use Hamilton's equations $\\dot{q} = p/m$ and $\\dot{p} = -k q$ as the fundamental starting point.\n- Derive and implement the Stoermer–Verlet integrator via splitting of the separable Hamiltonian into kinetic and potential parts to obtain a symplectic composition.\n- Derive and implement the explicit Euler method directly from the time-discretized Hamilton's equations.\n- For each test case, compute the maximum of the relative energy error over $N$ uniform steps of size $h$ across the chosen time horizon $T$.\n- Produce results as floats. If numerical overflow occurs in a method, the relative error may be reported as $+\\infty$, which is acceptable as a floating-point representation.\n\nUse the following test suite. For each case, the time horizon $T$ is defined by a specified number of oscillator periods, where the angular frequency is $\\omega = \\sqrt{k/m}$ and the period is $2\\pi/\\omega$. Let $N = \\lfloor T/h \\rfloor$ be the number of steps. Initial energy must be strictly positive in all cases.\n\n- Case 1 (happy path, small step): $m = 1$, $k = 1$, $h = 0.05$, number of periods $= 20$, $q_0 = 1.0$, $p_0 = 0.0$.\n- Case 2 (moderate step, observable drift in explicit Euler): $m = 1$, $k = 1$, $h = 0.2$, number of periods $= 10$, $q_0 = 1.0$, $p_0 = 0.0$.\n- Case 3 (near stability limit for Stoermer–Verlet, mixed initial energy): $m = 1$, $k = 4$, $h = 0.9$ (note that $h < 2/\\omega$), number of periods $= 5$, $q_0 = 0.7$, $p_0 = 0.5$.\n- Case 4 (large mass, soft spring, large step but within Stoermer–Verlet stability): $m = 2$, $k = 0.5$, $h = 1.9$, number of periods $= 10$, $q_0 = 0.0$, $p_0 = 1.0$.\n\nFor each case:\n1. Compute $T$ from the specified number of periods and parameters $m$ and $k$.\n2. Set $N = \\lfloor T/h \\rfloor$.\n3. Integrate with Stoermer–Verlet and explicit Euler separately.\n4. Record the maximum relative energy error over all steps $n = 1,\\dots,N$ for each method.\n\nFinal output format:\n- Your program should produce a single line of output containing a list of four elements, each element being a two-float list corresponding to one test case. Each inner list must be ordered as $[\\text{error}_{\\text{SV}}, \\text{error}_{\\text{EE}}]$, where $\\text{error}_{\\text{SV}}$ is the maximum relative energy error for Stoermer–Verlet and $\\text{error}_{\\text{EE}}$ is the corresponding value for explicit Euler. The final printed line must look like:\n$[[e_{SV,1},e_{EE,1}],[e_{SV,2},e_{EE,2}],[e_{SV,3},e_{EE,3}],[e_{SV,4},e_{EE,4}]]$,\nwith all values in decimal form or $+\\infty$ when applicable.",
            "solution": "The problem requires the derivation, implementation, and comparison of two numerical integration methods, explicit Euler and Stoermer–Verlet, for the one-dimensional harmonic oscillator. The comparison is based on the conservation of energy.\n\nThe system is defined by the Hamiltonian function, representing the total energy:\n$$H(q, p) = \\frac{p^2}{2m} + \\frac{1}{2} k q^2$$\nwhere $q$ is the position, $p$ is the momentum, $m$ is the mass, and $k$ is the spring stiffness constant. The dynamics are governed by Hamilton's equations of motion:\n$$ \\dot{q} = \\frac{\\partial H}{\\partial p} = \\frac{p}{m} $$\n$$ \\dot{p} = -\\frac{\\partial H}{\\partial q} = -k q $$\nThis pair of first-order ordinary differential equations forms the basis for the numerical time-stepping schemes.\n\n**1. Explicit Euler Method**\n\nThe explicit Euler method is a first-order numerical procedure for solving initial value problems of the form $\\dot{\\mathbf{y}} = \\mathbf{f}(\\mathbf{y})$. It approximates the state at the next time step, $t_{n+1} = t_n + h$, using the state and its derivative at the current time, $t_n$:\n$$ \\mathbf{y}_{n+1} = \\mathbf{y}_n + h \\mathbf{f}(\\mathbf{y}_n) $$\nLet the state vector be $\\mathbf{y} = (q, p)^T$. From Hamilton's equations, the function $\\mathbf{f}(\\mathbf{y})$ is:\n$$ \\mathbf{f}(q, p) = \\begin{pmatrix} p/m \\\\ -kq \\end{pmatrix} $$\nApplying the explicit Euler formula to each component of the state vector, we obtain the update rules from state $(q_n, p_n)$ to $(q_{n+1}, p_{n+1})$:\n$$ q_{n+1} = q_n + h \\left(\\frac{p_n}{m}\\right) $$\n$$ p_{n+1} = p_n + h (-k q_n) $$\nThese updates use the values of $q_n$ and $p_n$ from the beginning of the time step $h$. This method is known to be non-symplectic. For an oscillatory system like the harmonic oscillator, the numerical energy computed using this method will systematically drift, typically increasing over time, because the eigenvalues of its amplification matrix have a modulus greater than $1$.\n\n**2. Stoermer–Verlet Method**\n\nThe Stoermer–Verlet method is a symplectic integrator, which is particularly well-suited for Hamiltonian systems. Its derivation is based on the principle of operator splitting. The Hamiltonian is separable into a kinetic energy part, $T(p) = p^2/(2m)$, and a potential energy part, $V(q) = \\frac{1}{2} k q^2$. The exact evolution of the system over a time step $h$ can be formally written as an operation on the phase space coordinates, $\\mathbf{z}_{n+1} = e^{h L_H} \\mathbf{z}_n$, where $L_H$ is the Lie operator associated with $H$. Since $H = T+V$, we have $L_H = L_T + L_V$.\n\nA second-order accurate approximation is achieved by a symmetric composition, known as Strang splitting:\n$$ e^{h L_H} \\approx e^{\\frac{h}{2} L_V} e^{h L_T} e^{\\frac{h}{2} L_V} $$\nThis means we apply the flow corresponding to the potential energy for a half-step, then the flow for the kinetic energy for a full step, and finally the potential energy flow again for a half-step.\n\nThe exact flow under $L_T$ for a time $\\Delta t$ is:\n$$ \\dot{q} = \\frac{\\partial T}{\\partial p} = \\frac{p}{m}, \\quad \\dot{p} = -\\frac{\\partial T}{\\partial q} = 0 \\quad \\implies \\quad q(\\Delta t) = q(0) + \\Delta t \\frac{p(0)}{m}, \\quad p(\\Delta t) = p(0) $$\n\nThe exact flow under $L_V$ for a time $\\Delta t$ is:\n$$ \\dot{q} = \\frac{\\partial V}{\\partial p} = 0, \\quad \\dot{p} = -\\frac{\\partial V}{\\partial q} = -k q \\quad \\implies \\quad q(\\Delta t) = q(0), \\quad p(\\Delta t) = p(0) - \\Delta t k q(0) $$\n\nApplying the splitting sequence to the state $(q_n, p_n)$:\n1.  **First potential half-step ($\\Delta t = h/2$)**: We define an intermediate momentum $p_{n+1/2}$.\n    $$ p_{n+1/2} = p_n - \\frac{h}{2} k q_n $$\n2.  **Full kinetic step ($\\Delta t = h$)**: We update the position using the intermediate momentum.\n    $$ q_{n+1} = q_n + h \\frac{p_{n+1/2}}{m} $$\n3.  **Second potential half-step ($\\Delta t = h/2$)**: We update the momentum to its final value at $t_{n+1}$ using the newly computed position $q_{n+1}$.\n    $$ p_{n+1} = p_{n+1/2} - \\frac{h}{2} k q_{n+1} $$\n\nThis set of three equations constitutes the Stoermer–Verlet (in its leapfrog form) integration scheme. As a symplectic method, it does not exactly conserve the Hamiltonian $H$, but it does exactly conserve a nearby \"shadow\" Hamiltonian. This property ensures that the energy error remains bounded over long integration times, oscillating around the initial value, provided the time step $h$ is below the stability limit, which for the harmonic oscillator is $h < 2/\\omega$ where $\\omega = \\sqrt{k/m}$.\n\n**3. Numerical Evaluation**\n\nFor each test case, we will compute the total time horizon $T$ based on the oscillator's natural period $2\\pi/\\omega$, and the number of steps $N = \\lfloor T/h \\rfloor$. We will then integrate the system from the initial conditions $(q_0, p_0)$ for $N$ steps using both methods. At each step $n \\in \\{1, \\dots, N\\}$, we compute the relative energy error:\n$$ \\epsilon_n = \\frac{|H(q_n, p_n) - H(q_0, p_0)|}{|H(q_0, p_0)|} $$\nThe final reported value for each method will be the maximum error observed over the entire simulation, $\\max_{n=1 \\dots N} \\epsilon_n$. We expect the explicit Euler error to grow, while the Stoermer-Verlet error remains small and bounded.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and compares the energy conservation properties of the \n    explicit Euler and Stoermer-Verlet integrators for the harmonic oscillator.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: m, k, h, num_periods, q0, p0\n        (1.0, 1.0, 0.05, 20.0, 1.0, 0.0),\n        # Case 2\n        (1.0, 1.0, 0.2, 10.0, 1.0, 0.0),\n        # Case 3\n        (1.0, 4.0, 0.9, 5.0, 0.7, 0.5),\n        # Case 4\n        (2.0, 0.5, 1.9, 10.0, 0.0, 1.0),\n    ]\n\n    results = []\n\n    for m, k, h, num_periods, q0, p0 in test_cases:\n        \n        # Calculate simulation parameters\n        omega = np.sqrt(k / m)\n        period = 2.0 * np.pi / omega\n        T = num_periods * period\n        N = int(np.floor(T / h))\n\n        # Define Hamiltonian function\n        def hamiltonian(q, p, m_val, k_val):\n            return p**2 / (2.0 * m_val) + 0.5 * k_val * q**2\n\n        H0 = hamiltonian(q0, p0, m, k)\n\n        # --- Stoermer-Verlet Integration ---\n        q_sv, p_sv = q0, p0\n        max_rel_error_sv = 0.0\n        \n        for _ in range(N):\n            p_half = p_sv - (h / 2.0) * k * q_sv\n            q_sv = q_sv + h * p_half / m\n            p_sv = p_half - (h / 2.0) * k * q_sv\n            \n            H_n = hamiltonian(q_sv, p_sv, m, k)\n            rel_error = np.abs(H_n - H0) / np.abs(H0)\n            if rel_error > max_rel_error_sv:\n                max_rel_error_sv = rel_error\n\n        # --- Explicit Euler Integration ---\n        q_ee, p_ee = q0, p0\n        max_rel_error_ee = 0.0\n        \n        for _ in range(N):\n            q_new = q_ee + h * p_ee / m\n            p_new = p_ee - h * k * q_ee\n            q_ee, p_ee = q_new, p_new\n\n            H_n = hamiltonian(q_ee, p_ee, m, k)\n            rel_error = np.abs(H_n - H0) / np.abs(H0)\n            if rel_error > max_rel_error_ee:\n                max_rel_error_ee = rel_error\n\n        results.append([max_rel_error_sv, max_rel_error_ee])\n\n    # Format the final output string without spaces in the inner lists\n    string_parts = [f'[{r[0]},{r[1]}]' for r in results]\n    final_string = f\"[{','.join(string_parts)}]\"\n    print(final_string)\n\nsolve()\n```"
        }
    ]
}