{
    "hands_on_practices": [
        {
            "introduction": "我们以哈密顿力学中的经典模型——谐振子——开启我们的实践探索。本练习  将引导你并非从物理直觉出发，而是直接从该理论的几何核心推导出能量守恒。通过从哈密顿矢量场与辛形式之间的基本关系式入手，你将证明为何任何自治哈密顿系统的能量本质上都是一个运动常量。",
            "id": "3734532",
            "problem": "考虑相空间 $\\mathbb{R}^{2}$ 上的单自由度谐振子，其具有正则坐标 $(q,p)$ 和正则辛形式 $\\omega=\\mathrm{d}q\\wedge \\mathrm{d}p$。哈密顿函数为\n$$\nH(q,p)=\\frac{p^{2}}{2m}+\\frac{1}{2}k\\,q^{2},\n$$\n其中 $m>0$ 和 $k>0$ 是常数参数。使用哈密顿系统的几何定义——即由缩并关系 $i_{X_{H}}\\omega=\\mathrm{d}H$ 定义的哈密顿向量场 $X_{H}$——作为基本出发点。以此为基础，推导运动方程，然后计算沿着由 $H$ 生成的流的时间导数 $\\mathrm{d}H/\\mathrm{d}t$。解释为何该结果证明了此自治系统的能量守恒。此外，根据初始条件 $(q(0),p(0))$ 确定 $H$ 沿着轨迹的恒定值，以展示其不变性。\n\n您最终报告的量必须是沿着解的 $\\mathrm{d}H/\\mathrm{d}t$ 的值。请将此值以单个实数或单个闭式解析表达式的形式给出。无需四舍五入，最终报告的量中不应包含任何单位。",
            "solution": "该问题是有效的，因为它具有科学依据、是适定的且客观的。它提出了几何力学中的一个标准问题——谐振子，并要求基于基本原理进行推导，特别是基于哈密顿函数 $H$、其对应的向量场 $X_H$ 以及辛形式 $\\omega$ 之间的关系。\n\n系统定义在具有正则坐标 $(q,p)$ 的相空间 $\\mathbb{R}^{2}$ 上。哈密顿函数由下式给出\n$$H(q,p) = \\frac{p^2}{2m} + \\frac{1}{2}k q^2$$\n正则辛形式为\n$$\\omega = \\mathrm{d}q \\wedge \\mathrm{d}p$$\n其中 $m > 0$ 和 $k > 0$ 是常数。分析始于哈密顿向量场 $X_H$ 的基本定义，该定义通过缩并关系给出：\n$$i_{X_H}\\omega = \\mathrm{d}H$$\n\n首先，我们计算哈密顿函数的外微分 $\\mathrm{d}H$。利用流形上的微积分法则，我们有：\n$$\\mathrm{d}H = \\frac{\\partial H}{\\partial q} \\mathrm{d}q + \\frac{\\partial H}{\\partial p} \\mathrm{d}p$$\n偏导数为：\n$$\\frac{\\partial H}{\\partial q} = k q$$\n$$\\frac{\\partial H}{\\partial p} = \\frac{p}{m}$$\n将这些代入 $\\mathrm{d}H$ 的表达式中，得到：\n$$\\mathrm{d}H = k q \\, \\mathrm{d}q + \\frac{p}{m} \\, \\mathrm{d}p$$\n\n接下来，我们在坐标基 $\\{\\frac{\\partial}{\\partial q}, \\frac{\\partial}{\\partial p}\\}$ 中表示哈密顿向量场 $X_H$。设其分量为坐标的变化率 $\\dot{q}$ 和 $\\dot{p}$：\n$$X_H = \\dot{q} \\frac{\\partial}{\\partial q} + \\dot{p} \\frac{\\partial}{\\partial p}$$\n现在我们计算缩并 $i_{X_H}\\omega$。利用内积的线性性及其对楔积的作用：\n$$i_{X_H}\\omega = i_{\\left(\\dot{q} \\frac{\\partial}{\\partial q} + \\dot{p} \\frac{\\partial}{\\partial p}\\right)}(\\mathrm{d}q \\wedge \\mathrm{d}p)$$\n$$i_{X_H}\\omega = \\dot{q} \\, i_{\\frac{\\partial}{\\partial q}}(\\mathrm{d}q \\wedge \\mathrm{d}p) + \\dot{p} \\, i_{\\frac{\\partial}{\\partial p}}(\\mathrm{d}q \\wedge \\mathrm{d}p)$$\n内积将向量场与微分形式进行缩并。我们回顾 $i_{\\frac{\\partial}{\\partial x^i}} \\mathrm{d}x^j = \\delta^j_i$，其中 $\\delta^j_i$ 是克罗内克δ符号。\n$$i_{\\frac{\\partial}{\\partial q}}(\\mathrm{d}q \\wedge \\mathrm{d}p) = (i_{\\frac{\\partial}{\\partial q}}\\mathrm{d}q) \\wedge \\mathrm{d}p - \\mathrm{d}q \\wedge (i_{\\frac{\\partial}{\\partial q}}\\mathrm{d}p) = 1 \\cdot \\mathrm{d}p - \\mathrm{d}q \\wedge 0 = \\mathrm{d}p$$\n$$i_{\\frac{\\partial}{\\partial p}}(\\mathrm{d}q \\wedge \\mathrm{d}p) = (i_{\\frac{\\partial}{\\partial p}}\\mathrm{d}q) \\wedge \\mathrm{d}p - \\mathrm{d}q \\wedge (i_{\\frac{\\partial}{\\partial p}}\\mathrm{d}p) = 0 \\wedge \\mathrm{d}p - \\mathrm{d}q \\wedge 1 = -\\mathrm{d}q$$\n将这些结果代回，我们得到缩并的表达式：\n$$i_{X_H}\\omega = \\dot{q} \\, \\mathrm{d}p - \\dot{p} \\, \\mathrm{d}q$$\n\n为了推导运动方程，我们令 $\\mathrm{d}H$ 和 $i_{X_H}\\omega$ 的两个表达式相等：\n$$-\\dot{p} \\, \\mathrm{d}q + \\dot{q} \\, \\mathrm{d}p = k q \\, \\mathrm{d}q + \\frac{p}{m} \\, \\mathrm{d}p$$\n由于 $\\{\\mathrm{d}q, \\mathrm{d}p\\}$ 在每一点都构成余切空间的基，我们可以令基1-形式的系数相等：\n\\begin{align*}\n\\mathrm{d}q \\text{ 的系数：} \\quad  -\\dot{p} = k q \\implies \\dot{p} = -k q \\\\\n\\mathrm{d}p \\text{ 的系数：} \\quad  \\dot{q} = \\frac{p}{m}\n\\end{align*}\n这些就是我们熟悉的谐振子的哈密顿方程。\n\n下一个任务是计算 $H$ 沿着解轨道的时间导数，这些轨道是向量场 $X_H$ 的积分曲线。这个变化率由向量场对函数 $H$ 的作用给出，可以使用链式法则计算：\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = \\frac{\\partial H}{\\partial q} \\frac{\\mathrm{d}q}{\\mathrm{d}t} + \\frac{\\partial H}{\\partial p} \\frac{\\mathrm{d}p}{\\mathrm{d}t} = \\frac{\\partial H}{\\partial q} \\dot{q} + \\frac{\\partial H}{\\partial p} \\dot{p}$$\n代入我们刚刚推导出的 $H$ 的偏导数和运动方程：\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = (k q) \\left(\\frac{p}{m}\\right) + \\left(\\frac{p}{m}\\right) (-k q) = \\frac{kqp}{m} - \\frac{kqp}{m} = 0$$\n\n这个结果 $\\frac{\\mathrm{d}H}{\\mathrm{d}t}=0$ 证明了能量守恒。由于哈密顿量 $H$ 是自治的（即不显含时间），并且代表了系统的总机械能（动能 $\\frac{p^2}{2m}$ 加上势能 $\\frac{1}{2}k q^2$），其时间导数为零的事实意味着总能量是一个运动常数。\n\n一个更深刻的几何论证对任何自治哈密顿系统都证实了这一结果。$H$ 沿 $X_H$ 的流的时间导数是 $H$ 关于 $X_H$ 的李导数：\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = \\mathcal{L}_{X_H} H = \\mathrm{d}H(X_H)$$\n使用定义关系 $i_{X_H}\\omega=\\mathrm{d}H$，我们可以代入 $\\mathrm{d}H$：\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = (i_{X_H}\\omega)(X_H)$$\n根据内积的定义，对于一个2-形式 $\\alpha$，有 $(i_V\\alpha)(W) = \\alpha(V,W)$。因此：\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = \\omega(X_H, X_H)$$\n根据定义，辛形式 $\\omega$ 是一个交错2-形式，这意味着它是反对称的：对于任意向量场 $V, W$，有 $\\omega(V,W) = -\\omega(W,V)$。反对称性的一个直接推论是，对于任意向量场 $V$，有 $\\omega(V,V)=0$。因此：\n$$\\frac{\\mathrm{d}H}{\\mathrm{d}t} = \\omega(X_H, X_H) = 0$$\n这个优雅的证明表明，能量守恒是哈密顿力学几何结构的直接结果。\n\n最后，我们确定 $H$ 的恒定值。由于 $\\frac{\\mathrm{d}H}{\\mathrm{d}t}=0$，$H(q(t), p(t))$ 的值对所有时间 $t$ 都是恒定的。这个常数由系统在任何时刻的状态决定，通常是初始时刻 $t=0$。给定初始条件 $(q(0), p(0))$，整个轨迹上的哈密顿量的值为：\n$$H(q(t), p(t)) = H(q(0), p(0)) = \\frac{p(0)^2}{2m} + \\frac{1}{2}k q(0)^2$$\n这个表达式证实了哈密顿量沿系统轨迹的不变性。问题所要求的特定量是 $\\mathrm{d}H/\\mathrm{d}t$ 的值。如两种方法所示，该值为 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在为自治系统建立了能量守恒之后，我们现在来研究当这个条件被放宽时会发生什么。这个问题  引入了一个显含时间的势能，迫使我们面对一个能量不守恒的情景。通过直接计算能量的变化率，你将看到能量守恒的失效与哈密顿量对时间的显式依赖是如何直接相关的，这为理解诺特定理 (Noether's theorem) 背后的原理提供了一个具体的例证。",
            "id": "3734526",
            "problem": "考虑一个在余切丛 $T^{\\ast}\\mathbb{R}$ 上的单自由度哈密顿系统，其正则坐标为 $(x,p)$，正则辛形式为 $\\omega = dx \\wedge dp$。设哈密顿量为\n$$\nH(x,p,t) = \\frac{p^{2}}{2m} + \\gamma\\, t\\, x,\n$$\n其中 $m>0$ 和 $\\gamma \\neq 0$ 是常数。在时间 $t=0$ 时，位形空间坐标和速度分别为 $x(0) = x_{0}$ 和 $\\dot{x}(0) = v_{0}$。\n\n仅从哈密顿动力学和辛几何的基本定义出发——具体来说，哈密顿矢量场 $X_{H}$ 满足 $\\iota_{X_{H}}\\omega = dH$，这在正则坐标下导出哈密顿方程 $\\dot{x} = \\partial H/\\partial p$ 和 $\\dot{p} = -\\partial H/\\partial x$——完成以下任务：\n\n1. 推导该系统的显式轨迹 $x(t)$ 和动量 $p(t)$。\n\n2. 使用链式法则和哈密顿方程，计算能量 $H(x(t),p(t),t)$ 沿哈密顿流的瞬时变化率，并表示为 $t$、$m$、$\\gamma$、$x_{0}$ 和 $v_{0}$ 的函数。请以单一的封闭形式解析表达式给出最终答案。\n\n3. 简要地，并仅基于第一性原理，解释为什么当 $\\partial V/\\partial t \\neq 0$（其中 $V(x,t) = \\gamma\\, t\\, x$）时，此例证了雅可比-莫佩尔蒂原理 (Jacobi–Maupertuis principle, JMP) 的失效。不要使用任何预先给定的目标公式；相反，将你的推理建立在构造一个不依赖于时间的雅可比度规需要一个固定能级这一要求上。\n\n你的最终答案必须是第2部分中得到的显式解析表达式。不需要数值近似。",
            "solution": "所述问题在形式上是有效的。它在科学上基于经典力学和几何力学的原理，问题提法良好，并有足够的初始条件以产生唯一解，且以客观、明确的数学语言表达。所有必要的信息都已提供，不存在内部矛盾。因此，我们可以着手求解。\n\n根据问题陈述的要求，解答分为三个部分。\n\n### 第1部分：轨迹和动量的推导\n\n我们给定一个单自由度系统的哈密顿量：\n$$\nH(x,p,t) = \\frac{p^{2}}{2m} + \\gamma\\, t\\, x\n$$\n其中 $m > 0$ 和 $\\gamma \\neq 0$ 是常数。正则坐标为 $(x,p)$。\n\n系统的动力学由哈密顿方程决定，这些方程由基本关系 $\\iota_{X_{H}}\\omega = dH$ 导出。在带有辛形式 $\\omega = dx \\wedge dp$ 的正则坐标 $(x,p)$ 中，这些方程为：\n$$\n\\dot{x} = \\frac{\\partial H}{\\partial p}\n$$\n$$\n\\dot{p} = -\\frac{\\partial H}{\\partial x}\n$$\n\n首先，我们计算哈密顿量所需的偏导数：\n$$\n\\frac{\\partial H}{\\partial p} = \\frac{\\partial}{\\partial p}\\left(\\frac{p^{2}}{2m} + \\gamma\\, t\\, x\\right) = \\frac{p}{m}\n$$\n$$\n\\frac{\\partial H}{\\partial x} = \\frac{\\partial}{\\partial x}\\left(\\frac{p^{2}}{2m} + \\gamma\\, t\\, x\\right) = \\gamma t\n$$\n\n将这些偏导数代入哈密顿方程，得到关于轨迹 $(x(t), p(t))$ 的常微分方程组：\n$$\n\\text{(1)} \\quad \\dot{x} = \\frac{p}{m}\n$$\n$$\n\\text{(2)} \\quad \\dot{p} = -\\gamma t\n$$\n\n我们首先求解方程 (2) 以得到动量 $p(t)$。这是一个一阶可分离微分方程。我们对时间从 $t=0$ 积分到一个任意时间 $t$：\n$$\n\\int_{p(0)}^{p(t)} dp' = \\int_{0}^{t} (-\\gamma \\tau) \\, d\\tau\n$$\n$$\np(t) - p(0) = -\\gamma \\left[ \\frac{\\tau^2}{2} \\right]_{0}^{t} = -\\frac{\\gamma t^2}{2}\n$$\n初始动量 $p(0)$ 通过方程 (1) 与初始速度 $\\dot{x}(0) = v_0$ 相关联：\n$$\np(0) = m \\dot{x}(0) = m v_0\n$$\n将此代入 $p(t)$ 的积分表达式中，我们得到动量的显式形式：\n$$\np(t) = m v_0 - \\frac{1}{2}\\gamma t^2\n$$\n\n接下来，我们使用方程 (1) $\\dot{x}(t) = p(t)/m$ 求解位置 $x(t)$。代入 $p(t)$ 的表达式：\n$$\n\\dot{x}(t) = \\frac{1}{m}\\left(m v_0 - \\frac{1}{2}\\gamma t^2\\right) = v_0 - \\frac{\\gamma t^2}{2m}\n$$\n我们使用初始条件 $x(0) = x_0$，将此方程对时间从 $t=0$ 积分到 $t$：\n$$\n\\int_{x(0)}^{x(t)} dx' = \\int_{0}^{t} \\left(v_0 - \\frac{\\gamma \\tau^2}{2m}\\right) \\, d\\tau\n$$\n$$\nx(t) - x(0) = \\left[ v_0 \\tau - \\frac{\\gamma \\tau^3}{6m} \\right]_{0}^{t} = v_0 t - \\frac{\\gamma t^3}{6m}\n$$\n使用初始条件 $x(0) = x_0$，我们得到显式轨迹：\n$$\nx(t) = x_0 + v_0 t - \\frac{\\gamma t^3}{6m}\n$$\n\n### 第2部分：能量的瞬时变化率\n\n我们被要求计算哈密顿量 $H(x(t), p(t), t)$ 沿系统轨迹的全时间导数。我们使用多元链式法则：\n$$\n\\frac{dH}{dt} = \\frac{\\partial H}{\\partial x}\\frac{dx}{dt} + \\frac{\\partial H}{\\partial p}\\frac{dp}{dt} + \\frac{\\partial H}{\\partial t}\n$$\n根据哈密顿方程，我们有代换关系 $\\frac{dx}{dt} = \\dot{x} = \\frac{\\partial H}{\\partial p}$ 和 $\\frac{dp}{dt} = \\dot{p} = -\\frac{\\partial H}{\\partial x}$。将这些代入链式法则表达式中：\n$$\n\\frac{dH}{dt} = \\frac{\\partial H}{\\partial x}\\left(\\frac{\\partial H}{\\partial p}\\right) + \\frac{\\partial H}{\\partial p}\\left(-\\frac{\\partial H}{\\partial x}\\right) + \\frac{\\partial H}{\\partial t}\n$$\n前两项相互抵消，这是哈密顿流的一个普遍性质：\n$$\n\\frac{dH}{dt} = \\frac{\\partial H}{\\partial x}\\frac{\\partial H}{\\partial p} - \\frac{\\partial H}{\\partial p}\\frac{\\partial H}{\\partial x} + \\frac{\\partial H}{\\partial t} = \\frac{\\partial H}{\\partial t}\n$$\n这表明对于任何哈密顿系统，能量沿轨迹的总变化率等于哈密顿量对时间的显式偏导数。\n\n对于给定的哈密顿量 $H(x,p,t) = \\frac{p^{2}}{2m} + \\gamma\\, t\\, x$，该偏导数为：\n$$\n\\frac{\\partial H}{\\partial t} = \\frac{\\partial}{\\partial t}\\left(\\frac{p^{2}}{2m} + \\gamma t x\\right) = \\gamma x\n$$\n因此，能量沿流的变化率为 $\\frac{dH}{dt} = \\gamma x(t)$。为了用初始条件和系统参数来表示它，我们代入第1部分中推导出的 $x(t)$ 的表达式：\n$$\n\\frac{dH}{dt} = \\gamma \\left( x_0 + v_0 t - \\frac{\\gamma t^3}{6m} \\right)\n$$\n展开后得到能量变化率的最终解析表达式：\n$$\n\\frac{dH}{dt} = \\gamma x_0 + \\gamma v_0 t - \\frac{\\gamma^2 t^3}{6m}\n$$\n\n### 第3部分：雅可比-莫佩尔蒂原理的失效\n\n雅可比-莫佩尔蒂原理 (Jacobi–Maupertuis principle, JMP) 将保守力学系统的轨迹与位形空间上特定黎曼度规的测地线联系起来。其推导以能量守恒为前提。\n\n该原理从一个不依赖于时间的哈密顿量 $H(q,p) = T(q,p) + V(q)$ 出发，其中能量 $H$ 是一个运动常数，$H=E$。作用量原理可以被重构为节略作用量 $S_0 = \\int p \\cdot dq$。对于一个标准的动能项 $T = \\sum_i \\frac{p_i^2}{2m_i}$，动量大小通过从 $E = T+V$ 中解出 $|p|$ 得到，对于单个粒子，这得出 $|p| = \\sqrt{2m(E-V(q))}$。作用量变为 $S_0 = \\int \\sqrt{2m(E-V(q))} \\, ds$，其中 $ds$ 是位形流形上的欧几里得弧长元。\n\n表达式 $\\sqrt{2m(E-V(q))}$ 被用来为一个新的度规——雅可比度规 $g_J = 2m(E-V(q)) g_{\\text{Euclidean}}$——定义一个共形因子。具有能量 $E$ 的力学系统的轨迹就是赋予了该度规 $g_J$ 的位形流形上的测地线。\n\n这整个构造的关键和基础性要求是存在一个单一、恒定的能量值 $E$ 来表征轨迹。雅可比度规本身就是用这个常数 $E$ 来定义的。\n\n在当前问题中，势能为 $V(x,t) = \\gamma t x$，它显式地依赖于时间。如第2部分所示，这种显式的时间依赖性导致能量不守恒：\n$$\n\\frac{dH}{dt} = \\frac{\\partial H}{\\partial t} = \\frac{\\partial V}{\\partial t} = \\gamma x(t)\n$$\n由于 $\\gamma \\neq 0$ 且 $x(t)$ 通常不为零，能量 $H(t)$ 沿给定路径不是恒定的。因为没有与轨迹相关联的固定能级 $E$，所以不可能定义一个单一的、不依赖于时间的雅可比度规，使其测地线对应于系统的路径。当能量景观本身随时间变化时，JMP 的基本前提——将动力学问题重构为静态流形上的纯几何问题——是无效的。因此，对于 $\\partial V/\\partial t \\neq 0$ 的系统，JMP 失效。",
            "answer": "$$\n\\boxed{\\gamma x_{0} + \\gamma v_{0} t - \\frac{\\gamma^{2} t^{3}}{6m}}\n$$"
        },
        {
            "introduction": "我们的最后一个实践将焦点从解析理论转向至关重要的数值计算领域。虽然精确解能够完美地保持能量守恒，但其数值近似解通常却不能。这个练习  要求你实现并比较两种不同的算法——一种是辛算法 (Stoermer-Verlet)，另一种是非辛算法 (explicit Euler)——来观察它们的长期能量行为。这个实践性的比较将生动地展示，为何在哈密顿系统的长时间模拟中，结构保持算法对于获得具有物理意义的结果至关重要。",
            "id": "3734508",
            "problem": "考虑一维谐振子，其哈密顿量为 $H(q,p) = \\frac{p^2}{2m} + \\frac{1}{2} k q^2$，其中 $q$ 表示位置，$p$ 表示动量，$m$ 是质量，$k$ 是刚度系数。精确的哈密顿动力学由哈密顿方程所支配，这在几何力学中是基础性的：$\\dot{q} = \\partial H / \\partial p$ 和 $\\dot{p} = -\\partial H / \\partial q$。对于此可分离哈密顿量，这些方程在相空间上生成辛流，该辛流精确地守恒总能量 $H(q,p)$。本问题的目的是量化和比较应用于此系统的两种数值时间步进方法的能量行为：一种辛方法 (Stoermer–Verlet) 和一种非辛方法 (显式欧拉法)。\n\n从哈密顿系统的基本定律和核心定义以及辛性概念出发，通过组合与动能 $\\frac{p^2}{2m}$ 和势能 $\\frac{1}{2}k q^2$ 相关的精确部分流，推导 Stoermer–Verlet 方法的更新规则。同样地，将哈密顿方程视为一阶系统，直接从中推导显式欧拉法的更新。为谐振子实现这两种积分器，并对于一系列时间步长和参数，计算在一个有限时间范围内的最大相对能量误差。在离散时间 $t_n$ 的相对误差定义为 $\\left|H(q_n,p_n) - H(q_0,p_0)\\right| / H(q_0,p_0)$，该值是无量纲的。由于能量 $H$ 具有物理单位，您只需报告无量纲的相对误差。角度未在此问题中显式出现，因此无需指定角度单位。\n\n您的程序必须：\n- 使用哈密顿方程 $\\dot{q} = p/m$ 和 $\\dot{p} = -k q$ 作为基本出发点。\n- 通过将可分离哈密顿量分裂为动能和势能部分来推导并实现 Stoermer–Verlet 积分器，以获得一个辛组合。\n- 直接从时间离散化的哈密顿方程推导并实现显式欧拉法。\n- 对于每个测试用例，在所选时间范围 $T$ 内，计算 $N$ 个大小为 $h$ 的均匀步长上的最大相对能量误差。\n- 以浮点数形式生成结果。如果某个方法中出现数值溢出，相对误差可以报告为 $+\\infty$，这作为浮点数表示是可以接受的。\n\n使用以下测试套件。对于每种情况，时间范围 $T$ 由指定的振荡周期数定义，其中角频率为 $\\omega = \\sqrt{k/m}$，周期为 $2\\pi/\\omega$。设步数为 $N = \\lfloor T/h \\rfloor$。所有情况下的初始能量必须严格为正。\n\n- 情况 1 (理想情况，小步长)：$m = 1$，$k = 1$，$h = 0.05$，周期数 $= 20$，$q_0 = 1.0$，$p_0 = 0.0$。\n- 情况 2 (中等步长，显式欧拉法中存在可观察到的漂移)：$m = 1$，$k = 1$，$h = 0.2$，周期数 $= 10$，$q_0 = 1.0$，$p_0 = 0.0$。\n- 情况 3 (接近 Stoermer–Verlet 的稳定性极限，混合初始能量)：$m = 1$，$k = 4$，$h = 0.9$ (注意 $h  2/\\omega$)，周期数 $= 5$，$q_0 = 0.7$，$p_0 = 0.5$。\n- 情况 4 (大质量，软弹簧，大步长但在 Stoermer–Verlet 稳定性范围内)：$m = 2$，$k = 0.5$，$h = 1.9$，周期数 $= 10$，$q_0 = 0.0$，$p_0 = 1.0$。\n\n对于每种情况：\n1. 根据指定的周期数以及参数 $m$ 和 $k$ 计算 $T$。\n2. 设置 $N = \\lfloor T/h \\rfloor$。\n3. 分别使用 Stoermer–Verlet 和显式欧拉法进行积分。\n4. 记录每种方法在所有步长 $n = 1,\\dots,N$ 上的最大相对能量误差。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个有四个元素的列表，每个元素是对应一个测试用例的、含两个浮点数的列表。每个内部列表必须按 $[\\text{error}_{\\text{SV}}, \\text{error}_{\\text{EE}}]$ 的顺序排列，其中 $\\text{error}_{\\text{SV}}$ 是 Stoermer–Verlet 方法的最大相对能量误差，而 $\\text{error}_{\\text{EE}}$ 是显式欧拉法对应的误差值。最终打印的行必须如下所示：\n$[[e_{SV,1},e_{EE,1}],[e_{SV,2},e_{EE,2}],[e_{SV,3},e_{EE,3}],[e_{SV,4},e_{EE,4}]]$，\n所有值均为十进制形式，或在适用时为 $+\\infty$。",
            "solution": "该问题要求针对一维谐振子，推导、实现并比较两种数值积分方法：显式欧拉法和 Stoermer–Verlet 法。比较的基础是能量守恒。\n\n该系统由代表总能量的哈密顿函数定义：\n$$H(q, p) = \\frac{p^2}{2m} + \\frac{1}{2} k q^2$$\n其中 $q$ 是位置，$p$ 是动量，$m$ 是质量，$k$ 是弹簧刚度常数。动力学由哈密顿运动方程所支配：\n$$ \\dot{q} = \\frac{\\partial H}{\\partial p} = \\frac{p}{m} $$\n$$ \\dot{p} = -\\frac{\\partial H}{\\partial q} = -k q $$\n这对一阶常微分方程构成了数值时间步进格式的基础。\n\n**1. 显式欧拉法**\n\n显式欧拉法是求解形如 $\\dot{\\mathbf{y}} = \\mathbf{f}(\\mathbf{y})$ 的初值问题的一种一阶数值方法。它使用当前时间 $t_n$ 的状态及其导数来近似下一个时间步 $t_{n+1} = t_n + h$ 的状态：\n$$ \\mathbf{y}_{n+1} = \\mathbf{y}_n + h \\mathbf{f}(\\mathbf{y}_n) $$\n设状态向量为 $\\mathbf{y} = (q, p)^T$。根据哈密顿方程，函数 $\\mathbf{f}(\\mathbf{y})$ 为：\n$$ \\mathbf{f}(q, p) = \\begin{pmatrix} p/m \\\\ -kq \\end{pmatrix} $$\n将显式欧拉公式应用于状态向量的每个分量，我们得到从状态 $(q_n, p_n)$ 到 $(q_{n+1}, p_{n+1})$ 的更新规则：\n$$ q_{n+1} = q_n + h \\left(\\frac{p_n}{m}\\right) $$\n$$ p_{n+1} = p_n + h (-k q_n) $$\n这些更新使用时间步 $h$ 开始时的 $q_n$ 和 $p_n$ 值。已知该方法是非辛的。对于像谐振子这样的振荡系统，使用此方法计算的数值能量会系统性地漂移，通常随时间增加，因为其放大矩阵的特征值的模大于1。\n\n**2. Stoermer–Verlet 方法**\n\nStoermer–Verlet 方法是一种辛积分器，特别适用于哈密顿系统。其推导基于算子分裂原理。哈密顿量可分离为动能部分 $T(p) = p^2/(2m)$ 和势能部分 $V(q) = \\frac{1}{2} k q^2$。系统在一个时间步 $h$ 内的精确演化可以形式上写为对相空间坐标的操作，$\\mathbf{z}_{n+1} = e^{h L_H} \\mathbf{z}_n$，其中 $L_H$ 是与 $H$ 相关联的李算子。由于 $H = T+V$，我们有 $L_H = L_T + L_V$。\n\n通过一种称为 Strang 分裂的对称组合，可以实现二阶精确近似：\n$$ e^{h L_H} \\approx e^{\\frac{h}{2} L_V} e^{h L_T} e^{\\frac{h}{2} L_V} $$\n这意味着我们先应用对应于势能的流进行半步，然后应用对应于动能的流进行一整步，最后再次应用势能流进行半步。\n\n在 $L_T$ 下经过时间 $\\Delta t$ 的精确流为：\n$$ \\dot{q} = \\frac{\\partial T}{\\partial p} = \\frac{p}{m}, \\quad \\dot{p} = -\\frac{\\partial T}{\\partial q} = 0 \\quad \\implies \\quad q(\\Delta t) = q(0) + \\Delta t \\frac{p(0)}{m}, \\quad p(\\Delta t) = p(0) $$\n\n在 $L_V$ 下经过时间 $\\Delta t$ 的精确流为：\n$$ \\dot{q} = \\frac{\\partial V}{\\partial p} = 0, \\quad \\dot{p} = -\\frac{\\partial V}{\\partial q} = -k q \\quad \\implies \\quad q(\\Delta t) = q(0), \\quad p(\\Delta t) = p(0) - \\Delta t k q(0) $$\n\n将此分裂序列应用于状态 $(q_n, p_n)$：\n1.  **第一个势能半步 ($\\Delta t = h/2$)**：我们定义一个中间动量 $p_{n+1/2}$。\n    $$ p_{n+1/2} = p_n - \\frac{h}{2} k q_n $$\n2.  **完整的动能步 ($\\Delta t = h$)**：我们使用中间动量更新位置。\n    $$ q_{n+1} = q_n + h \\frac{p_{n+1/2}}{m} $$\n3.  **第二个势能半步 ($\\Delta t = h/2$)**：我们使用新计算的位置 $q_{n+1}$ 将动量更新到其在 $t_{n+1}$ 的最终值。\n    $$ p_{n+1} = p_{n+1/2} - \\frac{h}{2} k q_{n+1} $$\n\n这三组方程构成了 Stoermer–Verlet（以其蛙跳形式）积分格式。作为一种辛方法，它不精确守恒哈密顿量 $H$，但它精确守恒一个邻近的“影子”哈密顿量。此性质确保了在长时间积分中，能量误差保持有界，并在初始值附近振荡，前提是时间步 $h$ 低于稳定性极限，对于谐振子而言，该极限为 $h  2/\\omega$，其中 $\\omega = \\sqrt{k/m}$。\n\n**3. 数值评估**\n\n对于每个测试用例，我们将根据振荡器的固有周期 $2\\pi/\\omega$ 计算总时间范围 $T$，以及步数 $N = \\lfloor T/h \\rfloor$。然后我们将使用两种方法从初始条件 $(q_0, p_0)$ 开始对系统进行 $N$ 步积分。在每一步 $n \\in \\{1, \\dots, N\\}$，我们计算相对能量误差：\n$$ \\epsilon_n = \\frac{|H(q_n, p_n) - H(q_0, p_0)|}{|H(q_0, p_0)|} $$\n每种方法的最终报告值将是整个模拟过程中观测到的最大误差 $\\max_{n=1 \\dots N} \\epsilon_n$。我们预计显式欧拉法的误差会增长，而 Stoermer-Verlet 法的误差将保持微小且有界。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and compares the energy conservation properties of the \n    explicit Euler and Stoermer-Verlet integrators for the harmonic oscillator.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: m, k, h, num_periods, q0, p0\n        (1.0, 1.0, 0.05, 20.0, 1.0, 0.0),\n        # Case 2\n        (1.0, 1.0, 0.2, 10.0, 1.0, 0.0),\n        # Case 3\n        (1.0, 4.0, 0.9, 5.0, 0.7, 0.5),\n        # Case 4\n        (2.0, 0.5, 1.9, 10.0, 0.0, 1.0),\n    ]\n\n    results = []\n\n    for m, k, h, num_periods, q0, p0 in test_cases:\n        \n        # Calculate simulation parameters\n        omega = np.sqrt(k / m)\n        period = 2.0 * np.pi / omega\n        T = num_periods * period\n        N = int(np.floor(T / h))\n\n        # Define Hamiltonian function\n        def hamiltonian(q, p, m_val, k_val):\n            return p**2 / (2.0 * m_val) + 0.5 * k_val * q**2\n\n        H0 = hamiltonian(q0, p0, m, k)\n\n        # --- Stoermer-Verlet Integration ---\n        q_sv, p_sv = q0, p0\n        max_rel_error_sv = 0.0\n        \n        for _ in range(N):\n            p_half = p_sv - (h / 2.0) * k * q_sv\n            q_sv = q_sv + h * p_half / m\n            p_sv = p_half - (h / 2.0) * k * q_sv\n            \n            H_n = hamiltonian(q_sv, p_sv, m, k)\n            rel_error = np.abs(H_n - H0) / np.abs(H0)\n            if rel_error > max_rel_error_sv:\n                max_rel_error_sv = rel_error\n\n        # --- Explicit Euler Integration ---\n        q_ee, p_ee = q0, p0\n        max_rel_error_ee = 0.0\n        \n        for _ in range(N):\n            q_new = q_ee + h * p_ee / m\n            p_new = p_ee - h * k * q_ee\n            q_ee, p_ee = q_new, p_new\n\n            H_n = hamiltonian(q_ee, p_ee, m, k)\n            rel_error = np.abs(H_n - H0) / np.abs(H0)\n            if rel_error > max_rel_error_ee:\n                max_rel_error_ee = rel_error\n\n        results.append([max_rel_error_sv, max_rel_error_ee])\n\n    # Format the final output string without spaces in the inner lists\n    string_parts = [f'[{r[0]},{r[1]}]' for r in results]\n    final_string = f\"[{','.join(string_parts)}]\"\n    print(final_string)\n\nsolve()\n```"
        }
    ]
}