{
    "hands_on_practices": [
        {
            "introduction": "生成模型的一个核心应用是从其生成的样本来计算目标物理系统（如玻尔兹曼分布）的平衡性质。本练习将引导您实践连接这两个世界的关键技术——重要性重加权。您将推导重要性采样估计量，并分析其统计不确定性，这对于理解计算结果的可靠性至关重要。",
            "id": "3765001",
            "problem": "考虑一个多尺度分子系统，其一维粗粒化变量 $x$ 捕捉了一个慢集体模式。对于 $x$ 的平衡目标分布是玻尔兹曼分布 $p^{\\star}(x) \\propto \\exp(-U(x))$，其温度的选择使得归一化目标密度为标准正态律 $p^{\\star}(x) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{x^{2}}{2}\\right)$。一个具有显式密度的生成模型，如变分自编码器（VAE），从参数族 $p_{\\theta}(x) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\!\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right)$ 中提出样本，其中 $\\theta = (\\mu,\\sigma)$ 是模型参数。您从 $p_{\\theta}$ 中抽取 $n$ 个独立样本 $\\{x_{i}\\}_{i=1}^{n}$，并试图使用重要性采样来计算可观测值在 $p^{\\star}$ 下的平衡期望。\n\n从重要性采样的基本定义和大数定律出发，推导重加权方案 $w(x) = \\frac{p^{\\star}(x)}{p_{\\theta}(x)}$ 以及可观测值 $f(x) = x^{2}$ 的自归一化重要性采样估计量。然后，使用基于样本均值的适当极限定理的第一性原理推导，获得自归一化估计量的渐近方差，并用 $p_{\\theta}$ 下的期望来表示。\n\n最后，专门针对科学上现实的情况 $\\mu = 0$ 和 $\\sigma = 1$（即生成模型与目标匹配），并将可观测值 $f(x) = x^{2}$ 的自归一化重要性采样估计量的渐近方差计算为一个实数值。最终答案以无单位形式表示。无需四舍五入。",
            "solution": "首先验证问题，确保其具有科学依据、问题提法恰当，并提供了所有必要的信息。\n\n**第1步：提取已知条件**\n- 一维粗粒化变量：$x$。\n- 平衡目标密度：$p^{\\star}(x) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^{2}}{2}\\right)$，即标准正态分布 $\\mathcal{N}(0,1)$。\n- 生成模型参数密度：$p_{\\theta}(x) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma} \\exp\\left(-\\frac{(x-\\mu)^{2}}{2\\sigma^{2}}\\right)$，即参数为 $\\theta = (\\mu, \\sigma)$ 的正态分布 $\\mathcal{N}(\\mu, \\sigma^2)$。\n- 样本：从 $p_{\\theta}(x)$ 中抽取的 $n$ 个独立同分布样本集 $\\{x_{i}\\}_{i=1}^{n}$。\n- 可观测值：$f(x) = x^{2}$。\n- 任务1：推导重加权方案 $w(x) = \\frac{p^{\\star}(x)}{p_{\\theta}(x)}$ 和 $\\langle f(x) \\rangle_{p^{\\star}}$ 的自归一化重要性采样（SNIS）估计量。\n- 任务2：推导SNIS估计量的渐近方差，并用 $p_{\\theta}$ 下的期望表示。\n- 任务3：在生成模型与目标完全匹配的特定情况（即 $\\mu = 0$ 和 $\\sigma = 1$）下，计算该渐近方差。\n\n**第2步：使用提取的已知条件进行验证**\n该问题是有效的。这是一个在统计力学和机器学习中提法恰当的标准问题。玻尔兹曼分布、生成模型、正态分布和重要性采样的概念都具有科学依据。问题陈述是自包含的、客观的，并为唯一解提供了所有必要信息。最终的计算是针对一个科学上现实的基准情况（一个完美的模型）。\n\n**第3步：结论与行动**\n问题有效。将提供一个完整的、有理有据的解答。\n\n**自归一化重要性采样（SNIS）估计量的推导**\n\n目标是计算可观测值 $f(x)$ 关于目标分布 $p^{\\star}(x)$ 的期望，记为 $\\langle f \\rangle_{p^{\\star}}$：\n$$\n\\langle f \\rangle_{p^{\\star}} = \\int f(x) p^{\\star}(x) \\,dx\n$$\n我们有来自不同分布的样本，即提议分布 $p_{\\theta}(x)$。为了用 $p_{\\theta}(x)$ 来表示这个期望，我们在被积函数上乘以并除以 $p_{\\theta}(x)$，假设只要 $f(x)p^{\\star}(x) \\neq 0$，就有 $p_{\\theta}(x) > 0$：\n$$\n\\langle f \\rangle_{p^{\\star}} = \\int f(x) \\frac{p^{\\star}(x)}{p_{\\theta}(x)} p_{\\theta}(x) \\,dx\n$$\n我们将重要性权重（或重加权因子）定义为目标密度与提议密度的比率：\n$$\nw(x) = \\frac{p^{\\star}(x)}{p_{\\theta}(x)}\n$$\n现在，该期望可以写成关于提议分布 $p_{\\theta}(x)$ 的期望：\n$$\n\\langle f \\rangle_{p^{\\star}} = \\int (f(x) w(x)) p_{\\theta}(x) \\,dx = \\mathbb{E}_{p_{\\theta}}[f(x)w(x)]\n$$\n在许多实际场景中，分布只在归一化常数范围内是已知的。让我们将 $\\langle f \\rangle_{p^{\\star}}$ 写成积分的比率：\n$$\n\\langle f \\rangle_{p^{\\star}} = \\frac{\\int f(x) p^{\\star}(x) \\,dx}{\\int p^{\\star}(x) \\,dx}\n$$\n通过在分子和分母中都引入 $p_{\\theta}(x)/p_{\\theta}(x)$，我们得到：\n$$\n\\langle f \\rangle_{p^{\\star}} = \\frac{\\int f(x) w(x) p_{\\theta}(x) \\,dx}{\\int w(x) p_{\\theta}(x) \\,dx} = \\frac{\\mathbb{E}_{p_{\\theta}}[f(x)w(x)]}{\\mathbb{E}_{p_{\\theta}}[w(x)]}\n$$\n给定从 $p_{\\theta}(x)$ 中抽取的 $n$ 个独立同分布样本 $\\{x_i\\}_{i=1}^n$，大数定律表明我们可以使用样本均值来近似分子和分母中的期望：\n$$\n\\mathbb{E}_{p_{\\theta}}[f(x)w(x)] \\approx \\frac{1}{n} \\sum_{i=1}^{n} f(x_i)w(x_i)\n$$\n$$\n\\mathbb{E}_{p_{\\theta}}[w(x)] \\approx \\frac{1}{n} \\sum_{i=1}^{n} w(x_i)\n$$\n将这些近似值代入比率中，得到自归一化重要性采样（SNIS）估计量 $\\hat{f}_{SNIS}$：\n$$\n\\hat{f}_{SNIS} = \\frac{\\frac{1}{n} \\sum_{i=1}^{n} f(x_i)w(x_i)}{\\frac{1}{n} \\sum_{i=1}^{n} w(x_i)} = \\frac{\\sum_{i=1}^{n} f(x_i)w(x_i)}{\\sum_{i=1}^{n} w(x_i)}\n$$\n其中 $w_i = w(x_i)$。这完成了推导的第一部分。\n\n**渐近方差的推导**\n\nSNIS估计量 $\\hat{f}_{SNIS}$ 是两个样本均值的比率。为了求其渐近方差，我们采用多元中心极限定理和Delta方法。我们从每个样本 $x_i$ 中定义两个随机变量：$A_i = f(x_i)w(x_i)$ 和 $B_i = w(x_i)$。它们的样本均值是 $\\bar{A}_n = \\frac{1}{n}\\sum A_i$ 和 $\\bar{B}_n = \\frac{1}{n}\\sum B_i$，因此 $\\hat{f}_{SNIS} = \\bar{A}_n / \\bar{B}_n$。\n\n根据大数定律，当 $n \\to \\infty$ 时：\n$\\bar{A}_n \\to \\mu_A = \\mathbb{E}_{p_{\\theta}}[f(x)w(x)] = \\langle f \\rangle_{p^{\\star}}$\n$\\bar{B}_n \\to \\mu_B = \\mathbb{E}_{p_{\\theta}}[w(x)] = \\int \\frac{p^{\\star}(x)}{p_{\\theta}(x)} p_{\\theta}(x) \\,dx = \\int p^{\\star}(x) \\,dx = 1$ (因为 $p^{\\star}$ 是一个归一化的密度)。\n\n多元中心极限定理指出，样本均值向量在分布上收敛于一个多元正态分布：\n$$\n\\sqrt{n} \\left( \\begin{pmatrix} \\bar{A}_n \\\\ \\bar{B}_n \\end{pmatrix} - \\begin{pmatrix} \\mu_A \\\\ \\mu_B \\end{pmatrix} \\right) \\xrightarrow{d} \\mathcal{N}\\left( \\mathbf{0}, \\Sigma \\right)\n$$\n其中 $\\Sigma$ 是向量 $(A_i, B_i)^T$ 的协方差矩阵：\n$$\n\\Sigma = \\begin{pmatrix} \\text{Var}_{p_{\\theta}}(A)  \\text{Cov}_{p_{\\theta}}(A, B) \\\\ \\text{Cov}_{p_{\\theta}}(A, B)  \\text{Var}_{p_{\\theta}}(B) \\end{pmatrix} = \\begin{pmatrix} \\text{Var}_{p_{\\theta}}(fw)  \\text{Cov}_{p_{\\theta}}(fw, w) \\\\ \\text{Cov}_{p_{\\theta}}(fw, w)  \\text{Var}_{p_{\\theta}}(w) \\end{pmatrix}\n$$\n我们感兴趣的是函数 $g(a,b) = a/b$。估计量为 $\\hat{f}_{SNIS} = g(\\bar{A}_n, \\bar{B}_n)$。Delta方法提供了该估计量的渐近分布。$\\sqrt{n}(\\hat{f}_{SNIS} - g(\\mu_A, \\mu_B))$ 的渐近分布的方差由 $V_{asym} = \\nabla g^T \\Sigma \\nabla g$ 给出，其中梯度 $\\nabla g$ 在 $(\\mu_A, \\mu_B)$ 处求值。\n\n$g(a,b)$ 的梯度为 $\\nabla g = (\\frac{\\partial g}{\\partial a}, \\frac{\\partial g}{\\partial b})^T = (1/b, -a/b^2)^T$。\n在 $(\\mu_A, \\mu_B) = (\\langle f \\rangle_{p^{\\star}}, 1)$ 处求值：\n$$\n\\nabla g(\\mu_A, \\mu_B) = \\left( 1, -\\langle f \\rangle_{p^{\\star}} \\right)^T\n$$\n渐近方差则为：\n$$\nV_{asym} = \\begin{pmatrix} 1  -\\langle f \\rangle_{p^{\\star}} \\end{pmatrix} \\begin{pmatrix} \\text{Var}_{p_{\\theta}}(fw)  \\text{Cov}_{p_{\\theta}}(fw, w) \\\\ \\text{Cov}_{p_{\\theta}}(fw, w)  \\text{Var}_{p_{\\theta}}(w) \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -\\langle f \\rangle_{p^{\\star}} \\end{pmatrix}\n$$\n$V_{asym} = \\text{Var}_{p_{\\theta}}(fw) - 2\\langle f \\rangle_{p^{\\star}}\\text{Cov}_{p_{\\theta}}(fw, w) + \\langle f \\rangle_{p^{\\star}}^2\\text{Var}_{p_{\\theta}}(w)$\n这个表达式可以通过将其识别为随机变量线性组合的方差来简化：\n$V_{asym} = \\text{Var}_{p_{\\theta}}(1 \\cdot (fw) - \\langle f \\rangle_{p^{\\star}} \\cdot w) = \\text{Var}_{p_{\\theta}}((f - \\langle f \\rangle_{p^{\\star}})w)$。\n\n我们可以展开这个方差：$\\text{Var}(X) = \\mathbb{E}[X^2] - (\\mathbb{E}[X])^2$。\n令 $X = (f - \\langle f \\rangle_{p^{\\star}})w$。$X$ 的期望是：\n$\\mathbb{E}_{p_{\\theta}}[X] = \\mathbb{E}_{p_{\\theta}}[fw - \\langle f \\rangle_{p^{\\star}}w] = \\mathbb{E}_{p_{\\theta}}[fw] - \\langle f \\rangle_{p^{\\star}}\\mathbb{E}_{p_{\\theta}}[w]$。\n我们知道 $\\mathbb{E}_{p_{\\theta}}[fw] = \\langle f \\rangle_{p^{\\star}}$ 和 $\\mathbb{E}_{p_{\\theta}}[w] = 1$。\n所以，$\\mathbb{E}_{p_{\\theta}}[X] = \\langle f \\rangle_{p^{\\star}} - \\langle f \\rangle_{p^{\\star}}(1) = 0$。\n因此，方差就是 $X^2$ 的期望：\n$$\nV_{asym} = \\mathbb{E}_{p_{\\theta}}[((f(x) - \\langle f \\rangle_{p^{\\star}})w(x))^2] = \\mathbb{E}_{p_{\\theta}}[(f(x) - \\langle f \\rangle_{p^{\\star}})^2 w(x)^2]\n$$\n这就是SNIS估计量的渐近方差用提议分布 $p_{\\theta}$ 下的期望表示的所需表达式。对于大的 $n$，估计量 $\\hat{f}_{SNIS}$ 的方差近似为 $\\frac{1}{n} V_{asym}$。\n\n**特定情况的计算**\n\n我们现在专门讨论生成模型是完美的情况：$\\mu = 0$ 且 $\\sigma = 1$。\n- 目标分布：$p^{\\star}(x) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^{2}}{2}\\right)$。\n- 提议分布：$p_{\\theta}(x) = \\frac{1}{\\sqrt{2\\pi}(1)} \\exp\\left(-\\frac{(x-0)^{2}}{2(1)^{2}}\\right) = p^{\\star}(x)$。\n- 可观测值：$f(x) = x^2$。\n\n首先，我们确定权重函数 $w(x)$：\n$$\nw(x) = \\frac{p^{\\star}(x)}{p_{\\theta}(x)} = \\frac{\\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^{2}}{2}\\right)}{\\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^{2}}{2}\\right)} = 1\n$$\n对于所有的 $x$，权重恰好为 $1$。\n\n接下来，我们计算可观测值的真实期望 $\\langle f \\rangle_{p^{\\star}}$：\n$$\n\\langle f \\rangle_{p^{\\star}} = \\langle x^2 \\rangle_{p^{\\star}} = \\int_{-\\infty}^{\\infty} x^2 p^{\\star}(x) \\,dx\n$$\n这是标准正态分布 $\\mathcal{N}(0,1)$ 的二阶矩。由于均值为 $0$，二阶矩等于方差，即 $1$。\n$$\n\\langle f \\rangle_{p^{\\star}} = 1\n$$\n\n最后，我们将这些量代入渐近方差的公式中：\n$$\nV_{asym} = \\mathbb{E}_{p_{\\theta}}[(f(x) - \\langle f \\rangle_{p^{\\star}})^2 w(x)^2]\n$$\n$$\nV_{asym} = \\mathbb{E}_{p_{\\theta}}[(x^2 - 1)^2 (1)^2] = \\mathbb{E}_{p_{\\theta}}[(x^2 - 1)^2]\n$$\n期望是相对于 $p_{\\theta}(x)$ 计算的，而 $p_{\\theta}(x)$ 是标准正态分布。\n我们展开多项式：$(x^2 - 1)^2 = x^4 - 2x^2 + 1$。\n利用期望的线性性质：\n$$\nV_{asym} = \\mathbb{E}_{p_{\\theta}}[x^4 - 2x^2 + 1] = \\mathbb{E}_{p_{\\theta}}[x^4] - 2\\mathbb{E}_{p_{\\theta}}[x^2] + \\mathbb{E}_{p_{\\theta}}[1]\n$$\n我们需要标准正态分布 ($Z \\sim \\mathcal{N}(0,1)$) 的矩：\n- $\\mathbb{E}_{p_{\\theta}}[1] = 1$。\n- $\\mathbb{E}_{p_{\\theta}}[x^2]$ 是方差，即 $1$。\n- $\\mathbb{E}_{p_{\\theta}}[x^4]$ 是四阶矩。对于一般的正态分布 $\\mathcal{N}(\\mu, \\sigma^2)$，四阶中心矩是 $3\\sigma^4$。由于我们的均值 $\\mu=0$ 且标准差 $\\sigma=1$，四阶矩是 $3(1)^4 = 3$。\n\n代入这些值：\n$$\nV_{asym} = 3 - 2(1) + 1 = 3 - 2 + 1 = 2\n$$\n因此，在完美生成模型的情况下，对于 $f(x)=x^2$ 的自归一化重要性采样估计量的渐近方差为 $2$。",
            "answer": "$$\n\\boxed{2}\n$$"
        },
        {
            "introduction": "生成模型有多种不同类型，例如具有显式密度的变分自编码器（VAE）和具有隐式密度的生成对抗网络（GAN），这种差异会对其应用产生实际影响。本练习要求您分析源自这两种模型类型的估计量的偏差，重点是理解隐式模型在密度比率估计不完美时的影响。通过这个假设场景，您可以深入探究不同模型架构在实际应用中可能引入的系统性误差。",
            "id": "3764977",
            "problem": "在多尺度建模与分析中，考虑从两种不同生成模型（变分自编码器 (VAE) 和生成对抗网络 (GAN)）生成的构型中估计某个可观测量的平衡期望。设标量反应坐标上的目标微观平衡分布为标准正态密度，记为 $\\pi(x)$，其中 $x \\in \\mathbb{R}$ 且 $\\pi(x)$ 是 $\\mathcal{N}(0,1)$ 的密度。设可观测量为 $A(x) = x^{2}$。\n\n假设 VAE 定义了一个显式提议密度 $q_{V}(x)$，而 GAN 定义了一个隐式提议分布 $q_{G}(x)$，该分布可以产生样本但无法进行可行的密度评估。你使用重要性重加权方法，根据每个模型的样本来估计 $\\mathbb{E}_{\\pi}[A]$，并作出以下选择：\n- 对于 VAE，你使用精确的重要性权重 $w_{V}(x) = \\frac{\\pi(x)}{q_{V}(x)}$。\n- 对于 GAN，你使用从一个校准的密度比代理获得的近似权重，其乘性校准误差建模为\n$$\n\\tilde{w}_{G}(x) = \\gamma \\left(1 + \\eta x^{2}\\right) \\frac{\\pi(x)}{q_{G}(x)},\n$$\n其中 $\\gamma = \\frac{19}{20}$ 且 $\\eta = \\frac{1}{50}$。\n\n假设估计量为未归一化重要性采样估计量\n$$\n\\hat{\\mu} = \\frac{1}{N} \\sum_{i=1}^{N} \\tilde{w}(x_{i}) A(x_{i}), \\quad x_{i} \\sim q(\\cdot),\n$$\n其中 $\\tilde{w}(x)$ 为各模型相应的权重。从 $\\mathbb{E}_{\\pi}[A]$ 的定义和重要性采样的定义出发，推导每种模型的估计量偏差，然后计算基于 GAN 的估计量与基于 VAE 的估计量之间的偏差之差，记为\n$$\n\\Delta B = B_{G} - B_{V},\n$$\n其中 $B_{M} = \\mathbb{E}_{q_{M}}\\!\\left[\\tilde{w}_{M}(x) A(x)\\right] - \\mathbb{E}_{\\pi}[A(x)]$，$M \\in \\{V, G\\}$。将最终偏差之差 $\\Delta B$ 表示为一个无量纲标量。无需四舍五入，请提供精确值。",
            "solution": "我们旨在计算两种模型估计量的偏差之差 $\\Delta B = B_G - B_V$。偏差的定义为 $B_M = \\mathbb{E}_{q_M}[\\hat{\\mu}] - \\mathbb{E}_{\\pi}[A(x)]$，其中 $\\hat{\\mu} = \\tilde{w}_M(x) A(x)$ 是单个样本的估计量。\n\n**第1步：计算真实期望值**\n\n首先，我们计算可观测量的真实期望值。目标分布是标准正态分布 $\\pi(x) = \\mathcal{N}(0,1)$，可观测量为 $A(x) = x^2$。因此，真实期望值是标准正态分布的二阶矩，也就是其方差。\n$$\n\\mathbb{E}_{\\pi}[A(x)] = \\mathbb{E}_{\\pi}[x^2] = 1\n$$\n\n**第2步：计算VAE估计量的偏差 $B_V$**\n\n对于VAE，我们使用精确的重要性权重，即 $\\tilde{w}_V(x) = w_V(x) = \\frac{\\pi(x)}{q_V(x)}$。\n估计量的期望值为：\n$$\n\\mathbb{E}_{q_V}[\\tilde{w}_V(x) A(x)] = \\int_{-\\infty}^{\\infty} \\tilde{w}_V(x) A(x) q_V(x) dx\n$$\n将权重和可观测量代入：\n$$\n\\mathbb{E}_{q_V}\\left[\\frac{\\pi(x)}{q_V(x)} x^2\\right] = \\int_{-\\infty}^{\\infty} \\frac{\\pi(x)}{q_V(x)} x^2 q_V(x) dx = \\int_{-\\infty}^{\\infty} x^2 \\pi(x) dx = \\mathbb{E}_{\\pi}[x^2] = 1\n$$\n因此，VAE估计量的偏差为：\n$$\nB_V = \\mathbb{E}_{q_V}[\\tilde{w}_V(x) A(x)] - \\mathbb{E}_{\\pi}[A(x)] = 1 - 1 = 0\n$$\n这表明，对于未归一化的重要性采样，如果权重是精确的，估计量是无偏的。\n\n**第3步：计算GAN估计量的偏差 $B_G$**\n\n对于GAN，我们使用近似权重 $\\tilde{w}_G(x) = \\gamma (1 + \\eta x^2) \\frac{\\pi(x)}{q_G(x)}$。\n估计量的期望值为：\n$$\n\\mathbb{E}_{q_G}[\\tilde{w}_G(x) A(x)] = \\int_{-\\infty}^{\\infty} \\tilde{w}_G(x) A(x) q_G(x) dx\n$$\n将权重和可观测量代入：\n$$\n\\mathbb{E}_{q_G}\\left[\\gamma \\left(1 + \\eta x^{2}\\right) \\frac{\\pi(x)}{q_G(x)} x^2 \\right] = \\int_{-\\infty}^{\\infty} \\gamma \\left(1 + \\eta x^{2}\\right) \\frac{\\pi(x)}{q_G(x)} x^2 q_G(x) dx\n$$\n$$\n= \\gamma \\int_{-\\infty}^{\\infty} (1 + \\eta x^2) x^2 \\pi(x) dx = \\gamma \\int_{-\\infty}^{\\infty} (x^2 + \\eta x^4) \\pi(x) dx\n$$\n利用期望的线性性质，这可以写成：\n$$\n= \\gamma \\left( \\mathbb{E}_{\\pi}[x^2] + \\eta \\mathbb{E}_{\\pi}[x^4] \\right)\n$$\n我们需要标准正态分布的二阶矩和四阶矩：\n- $\\mathbb{E}_{\\pi}[x^2] = 1$\n- $\\mathbb{E}_{\\pi}[x^4] = 3$\n代入这些值：\n$$\n\\mathbb{E}_{q_G}[\\tilde{w}_G(x) A(x)] = \\gamma (1 + \\eta \\cdot 3) = \\gamma(1 + 3\\eta)\n$$\n因此，GAN估计量的偏差为：\n$$\nB_G = \\mathbb{E}_{q_G}[\\tilde{w}_G(x) A(x)] - \\mathbb{E}_{\\pi}[A(x)] = \\gamma(1 + 3\\eta) - 1\n$$\n\n**第4步：计算偏差之差 $\\Delta B$**\n\n现在我们计算偏差之差：\n$$\n\\Delta B = B_G - B_V = (\\gamma(1 + 3\\eta) - 1) - 0 = \\gamma(1 + 3\\eta) - 1\n$$\n代入给定的参数值 $\\gamma = \\frac{19}{20}$ 和 $\\eta = \\frac{1}{50}$：\n$$\n\\Delta B = \\frac{19}{20} \\left(1 + 3 \\cdot \\frac{1}{50}\\right) - 1\n$$\n$$\n= \\frac{19}{20} \\left(1 + \\frac{3}{50}\\right) - 1 = \\frac{19}{20} \\left(\\frac{50}{50} + \\frac{3}{50}\\right) - 1\n$$\n$$\n= \\frac{19}{20} \\cdot \\frac{53}{50} - 1 = \\frac{19 \\times 53}{20 \\times 50} - 1\n$$\n$$\n= \\frac{1007}{1000} - 1 = \\frac{1007}{1000} - \\frac{1000}{1000} = \\frac{7}{1000}\n$$\n最终的偏差之差为 $\\frac{7}{1000}$。",
            "answer": "$$ \\boxed{\\frac{7}{1000}} $$"
        },
        {
            "introduction": "训练完生成模型后，我们如何判断它是否成功学习了目标物理分布？本练习超越了简单的损失函数，探讨了模型评估这一关键任务。您将分析各种评估指标，并选择一个在统计上稳健的综合评分方法，该方法能恰当地结合基于物理和基于机器学习的准则，同时考虑到它们之间的相互依赖性。",
            "id": "3764917",
            "problem": "一个生成模型被训练用于在温度 $T$ 下，从一个具有势能 $U(x)$ 和数密度 $\\rho$ 的系统的正则系综中采样分子构型。令 $p(x)$ 表示构型 $x$ 上的目标平衡分布，令 $q(x)$ 表示生成器的分布。给定实践中使用的四类评估泛函：\n\n- 受 Fréchet Inception Distance (FID) 启发的特征空间差异：一个经验估计 $\\widehat D_{\\mathrm{FID}}$，它比较真实构型与生成构型的等变特征嵌入 $\\phi(x)$ 的矩，并被构造成对刚性运动和粒子置换不变。\n\n- 生成模型的精确率 $\\widehat P$ 和召回率 $\\widehat R$，在同一特征空间中估计，用于评估样本质量和对目标支撑集的覆盖范围，取值范围为 $[0,1]$。\n\n- 基于能量的差异 $\\widehat D_{\\mathrm{KL}}$，定义为在相同温度 $T$ 下，目标分布 $p$ 和生成分布 $q$ 下标量能量 $U(x)$ 分布之间的经验 Kullback–Leibler 散度。\n\n- 结构差异 $\\widehat D_g$，定义为目标径向分布函数 $g_p(r)$ 与生成径向分布函数 $g_q(r)$ 之间的加权平方 $L^2$ 差，在 $r \\in [0,r_{\\max}]$ 上使用非负权重 $w(r)$ 进行积分。\n\n假设以下基本事实：\n\n- 在正则系综中，$p(x) \\propto \\exp(-\\beta U(x))$，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$。一个正确的采样器必须能复现 $U(x)$ 的平衡边际分布以及诸如 $g(r)$ 等结构可观测量的平衡边际分布。\n\n- 在零假设 $H_0 : q = p$ 下，随着样本量 $n \\to \\infty$，上述每个经验差异都收敛到 $0$。并且，根据多元中心极限定理和 Delta 方法，这些一致估计量的联合向量服从一个渐近高斯分布，其协方差矩阵 $\\Sigma$ 可以被一致地估计（例如通过非参数自助法）。\n\n要求你为分子构型采样选择一个最符合原则的综合评分，该评分应满足：\n\n- 无量纲，并且可跨不同系统和样本量 $n$ 进行比较，\n\n- 对生成样本中精确率的不足和召回率的不足都进行惩罚，\n\n- 聚合关于 $U(x)$ 和 $g(r)$ 的基于物理的差异，而不会被任意单位或尺度主导，\n\n- 考虑组分估计量之间的依赖性，以避免重复计算证据，\n\n- 在 $H_0$ 下具有一个可解释的参考分布，以便进行校准或设置阈值。\n\n考虑以下候选方案，其中 $\\widehat \\Sigma$ 表示在 $H_0$ 下组分估计量向量协方差的一致估计，并且所有积分、散度和范数都由相同的 $n$ 个样本计算得出：\n\nA. $S_A \\;=\\; \\widehat D_{\\mathrm{FID}} \\;+\\; \\left(1 - \\widehat P\\right) \\;+\\; \\left(1 - \\widehat R\\right) \\;+\\; \\widehat D_{\\mathrm{KL}} \\;+\\; \\widehat D_g$。\n\nB. $S_B \\;=\\; \\left(\\widehat D_{\\mathrm{FID}} \\;\\widehat D_{\\mathrm{KL}} \\;\\widehat D_g \\right)^{1/3} \\;\\cdot\\; \\left(1 - \\widehat P \\,\\widehat R\\right)$。\n\nC. 定义偏差向量 $V \\in \\mathbb{R}^5$ 为 $V \\;=\\; \\big(\\widehat D_{\\mathrm{FID}},\\; \\widehat D_{\\mathrm{KL}},\\; \\widehat D_g,\\; 1-\\widehat P,\\; 1-\\widehat R\\big)^\\top$，并设 $S_C \\;=\\; V^\\top \\,\\widehat \\Sigma^{-1}\\, V$。\n\nD. $S_D \\;=\\; W_2\\!\\left(\\mu_{\\phi(p)}, \\mu_{\\phi(q)}\\right) \\;+\\; W_2\\!\\left(p_{U}, q_{U}\\right) \\;+\\; W_2\\!\\left(p_{g}, q_{g}\\right)$，其中 $W_2$ 表示 $2$-Wasserstein 距离，$\\mu_{\\phi(\\cdot)}$ 是特征分布，$p_{U}$ 和 $q_{U}$ 是能量分布，$p_{g}$ 和 $q_{g}$ 是在 $r \\in [0,r_{\\max}]$ 上采样的 $g(r)$ 值的分布。\n\n基于所述原则，哪个选项最能满足所列标准？请选择唯一的最佳选项。",
            "solution": "### 问题验证\n\n**第1步：提取已知条件**\n\n- **系统和系综：** 一个由势能函数 $U(x)$ 和数密度 $\\rho$ 描述的分子构型 $x$ 系统。该系统处于温度 $T$ 的正则系综中。\n- **目标分布：** 平衡概率分布为 $p(x) \\propto \\exp(-\\beta U(x))$，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$。\n- **生成器分布：** 一个生成模型从分布 $q(x)$ 中产生样本。\n- **评估泛函（估计量）：**\n    1. $\\widehat D_{\\mathrm{FID}}$：一个经验性的特征空间差异，类似于 Fréchet Inception Distance，基于等变特征嵌入 $\\phi(x)$ 的矩。它对刚性运动和置换不变。\n    2. $\\widehat P$ 和 $\\widehat R$：经验精确率和召回率，取值范围为 $[0,1]$，在与 $\\widehat D_{\\mathrm{FID}}$ 相同的特征空间中估计。\n    3. $\\widehat D_{\\mathrm{KL}}$：在分布 $p$ 和 $q$ 下，标量能量 $U(x)$ 分布之间的经验 Kullback–Leibler 散度。\n    4. $\\widehat D_g$：目标径向分布函数 $g_p(r)$ 与生成函数 $g_q(r)$ 之间的加权平方 $L^2$ 差，其连续形式为 $\\int_0^{r_{\\max}} w(r) [g_p(r) - g_q(r)]^2 dr$，其中 $w(r) \\ge 0$。\n- **假设的基本事实：**\n    1. 正确的采样需要复现 $U(x)$ 的边际分布和诸如 $g(r)$ 等可观测量的边际分布。\n    2. 在零假设 $H_0 : q = p$ 下，随着样本量 $n \\to \\infty$，所有经验差异都收敛到 $0$。\n    3. 在 $H_0$ 下，一致估计量的联合向量渐近服从高斯分布，其协方差矩阵 $\\Sigma$ 可以通过 $\\widehat \\Sigma$ 一致地估计。\n- **综合评分所需标准：**\n    1. 无量纲，且可跨系统和样本量进行比较。\n    2. 对精确率和召回率的不足都进行惩罚。\n    3. 聚合关于 $U(x)$ 和 $g(r)$ 的基于物理的差异，而不会被任意单位或尺度主导。\n    4. 考虑组分估计量之间的依赖性。\n    5. 在 $H_0$ 下具有一个可解释的参考分布。\n\n**第2步：使用提取的已知条件进行验证**\n\n- **科学依据：** 问题牢固地植根于统计力学（正则系综、势能、径向分布函数）和生成模型的统计评估，这是现代机器学习和计算科学的一个主要课题。所有概念都是标准的、科学上合理的。\n- **适定性：** 问题提供了一组定义明确的候选评分和一套清晰的评估标准。任务是根据已建立的统计原则，确定哪个候选方案最能满足这些标准。问题的结构决定了它有一个唯一的最佳答案。\n- **客观性：** 问题使用精确的技术语言陈述。这些标准虽然需要基于科学原则进行解释，但它们是客观的。\n- **完整性和一致性：** 问题提供了所有必要的信息，包括关于估计量联合向量的渐近正态性和一致协方差估计 $\\widehat\\Sigma$ 可用性的关键事实。没有矛盾之处。\n- **现实性和可行性：** 所描述的评估指标和统计假设代表了当前机器学习在分子建模领域的研究和实践。计算是可行的。\n\n**第3步：结论和行动**\n\n问题陈述是有效的。它在科学上是合理的、适定的、客观的和完整的。我现在将进入解答阶段。\n\n### 推导与选项分析\n\n任务是找到最能满足五个指定标准的综合评分。让我们根据这些标准分析每个候选评分。与理想情况的偏差向量为 $V = \\big(\\widehat D_{\\mathrm{FID}},\\; \\widehat D_{\\mathrm{KL}},\\; \\widehat D_g,\\; 1-\\widehat P,\\; 1-\\widehat R\\big)^\\top$。在零假设 $H_0: q=p$ 下，此向量的真值为零向量。\n\n**评估标准清单：**\n1.  **无量纲与可比性：** 该评分是否没有单位，并且对其组分的任意缩放具有鲁棒性？\n2.  **惩罚精确率与召回率：** 当 $\\widehat P$ 或 $\\widehat R$ 从 1 下降时，该评分是否会增加？\n3.  **聚合物理指标：** 它是否以一种对其原生单位或尺度不敏感的方式结合 $\\widehat D_{\\mathrm{KL}}$ 和 $\\widehat D_g$？\n4.  **考虑依赖性：** 它是否使用了协方差矩阵 $\\Sigma$ 中的信息？\n5.  **可解释的参考分布：** 在 $H_0$ 下，该评分是否有一个已知的、简单的分布？\n\n---\n\n**选项 A 分析：** $S_A \\;=\\; \\widehat D_{\\mathrm{FID}} \\;+\\; \\left(1 - \\widehat P\\right) \\;+\\; \\left(1 - \\widehat R\\right) \\;+\\; \\widehat D_{\\mathrm{KL}} \\;+\\; \\widehat D_g$\n\n该评分是各个差异度量的简单算术和。\n\n1.  **无量纲与可比性：否。** 这些组分有不同的单位。例如，$\\widehat D_{\\mathrm{KL}}$ 是无量纲的，但 $\\widehat D_{\\mathrm{FID}}$ 和 $\\widehat D_g$ 通常具有取决于特征空间 $\\phi(x)$ 和权重函数 $w(r)$ 定义的单位。将不同单位的量相加在物理上是无意义的。总分将被数值最大的组分所主导，而这只是单位和尺度选择的人为结果，并非重要性的度量。\n2.  **惩罚精确率与召回率：是。** 包含了 $(1 - \\widehat P)$ 和 $(1 - \\widehat R)$ 项。\n3.  **聚合物理指标：否。** 聚合方式是简单的求和，这明确地使其容易受到任意单位或尺度的支配，而这正是标准试图避免的行为。\n4.  **考虑依赖性：否。** 这个和完全忽略了估计量之间的统计相关性，这些相关性由协方差矩阵 $\\Sigma$ 的非对角元素捕获。\n5.  **可解释的参考分布：否。** 在 $H_0$ 下，$S_A$ 是相关的、渐近正态变量的加权和。其分布不是标准分布，并且将依赖于其组分的未知的、特定于系统的尺度。\n\n**结论：不正确。** 该评分几乎在所有“有原则的”评分标准上都失败了。\n\n---\n\n**选项 B 分析：** $S_B \\;=\\; \\left(\\widehat D_{\\mathrm{FID}} \\;\\widehat D_{\\mathrm{KL}} \\;\\widehat D_g \\right)^{1/3} \\;\\cdot\\; \\left(1 - \\widehat P \\,\\widehat R\\right)$\n\n该评分对某些组分使用几何平均数，并对精确率和召回率使用一个乘法因子。\n\n1.  **无量纲与可比性：否。** 几何平均项 $(\\widehat D_{\\mathrm{FID}} \\;\\widehat D_{\\mathrm{KL}} \\;\\widehat D_g )^{1/3}$ 仍然依赖于其构成部分的单位和尺度。例如，如果特征映射 $\\phi(x)$ 被重新缩放，$\\widehat D_{\\mathrm{FID}}$ 会改变，因此 $S_B$ 也会改变。\n2.  **惩罚精确率与召回率：是。** 当 $\\widehat P$ 或 $\\widehat R$ 偏离 1 时，因子 $(1 - \\widehat P \\widehat R)$ 会增加。\n3.  **聚合物理指标：否。** 虽然几何平均值在应对不同尺度方面可能比算术平均值更具鲁棒性，但它并未从根本上解决以有原则的方式组合具有任意单位的量的问题。\n4.  **考虑依赖性：否。** 与选项 A 一样，此评分不使用协方差信息 $\\Sigma$。\n5.  **可解释的参考分布：否。** 在 $H_0$ 下，这个复杂的估计量乘积的分布是高度非标准的，并且很难表征或用于校准。\n\n**结论：不正确。** 该评分在大多数关键统计原则上也都失败了。\n\n---\n\n**选项 D 分析：** $S_D \\;=\\; W_2\\!\\left(\\mu_{\\phi(p)}, \\mu_{\\phi(q)}\\right) \\;+\\; W_2\\!\\left(p_{U}, q_{U}\\right) \\;+\\; W_2\\!\\left(p_{g}, q_{g}\\right)$\n\n该选项提出了一套基于 $2$-Wasserstein 距离 $W_2$ 的替代指标，并将其和作为评分。\n\n1.  **无量纲与可比性：否。** 这是一个距离的算术和。每个 $W_2$ 项都有单位。例如，$W_2(p_U, q_U)$ 具有能量单位。因此，总和不是无量纲的，并且与 $S_A$ 一样，存在尺度主导问题。\n2.  **惩罚精确率与召回率：否。** 该评分完全忽略了精确率和召回率指标 $\\widehat P$ 和 $\\widehat R$，直接违反了既定要求。\n3.  **聚合物理指标：否。** 聚合方式是通过简单的求和，对尺度不具鲁棒性。此外，术语 $W_2(p_g, q_g)$ 被模糊地定义为“$g(r)$ 值的分布”之间的距离，这不是一种比较函数 $g_p(r)$ 和 $g_q(r)$ 的标准或明确有意义的方法。\n4.  **考虑依赖性：否。** 它是一个简单的和，忽略了 $W_2$ 距离估计量之间的任何统计依赖性。\n5.  **可解释的参考分布：否。** 出于与 $S_A$ 相同的原因，这个相关变量的和在 $H_0$ 下没有一个简单的、已知的参考分布。\n\n**结论：不正确。** 该选项在每一项标准上都失败了，并且引入了定义不明确的术语。\n\n---\n\n**选项 C 分析：** $S_C \\;=\\; V^\\top \\,\\widehat \\Sigma^{-1}\\, V$，其中 $V \\;=\\; \\big(\\widehat D_{\\mathrm{FID}},\\; \\widehat D_{\\mathrm{KL}},\\; \\widehat D_g,\\; 1-\\widehat P,\\; 1-\\widehat R\\big)^\\top$\n\n该评分是一个涉及差异向量 $V$ 及其估计协方差矩阵 $\\widehat\\Sigma$ 的逆矩阵的二次型。这是马氏距离的推广，被称为霍特林 $T^2$ 统计量或沃尔德统计量。\n\n1.  **无量纲与可比性：是。** 设组分 $V_i$ 的单位为 $[u_i]$。则协方差矩阵元素 $\\Sigma_{ij}$ 的单位为 $[u_i][u_j]$。逆矩阵元素 $(\\Sigma^{-1})_{ij}$ 的单位为 $1/([u_i][u_j])$。二次型是形如 $\\sum_{i,j} V_i (\\Sigma^{-1})_{ij} V_j$ 的项之和。这样一个项的单位是 $[u_i] \\cdot (1/([u_i][u_j])) \\cdot [u_j]$，即无量纲。因此，整个评分 $S_C$ 是无量纲的。通过相对于内在的统计方差和协方差进行归一化，它创建了一个尺度不变的偏差度量。只要统计假设成立，它就可以在任何系统或指标集之间进行比较。\n2.  **惩罚精确率与召回率：是。** $1-\\widehat P$ 和 $1-\\widehat R$ 项是向量 $V$ 的组分。$\\widehat P$ 或 $\\widehat R$ 对 1 的任何偏离都会使 $V$ 非零，并且由于 $\\widehat\\Sigma^{-1}$ 是正定的， $S_C$ 将为正。\n3.  **聚合物理指标：是。** 它包括 $\\widehat D_{\\mathrm{KL}}$ 和 $\\widehat D_g$。$\\widehat \\Sigma^{-1}$ 的加权自动且有原则地处理了它们不同的尺度和单位。噪声大（高方差）的指标自然会被降低权重。\n4.  **考虑依赖性：是。** 这是使用逆协方差矩阵 $\\widehat \\Sigma^{-1}$ 的主要目的。它将相关的差异向量 $V$ 转换到一个新的基，在该基中各组分不相关且方差为单位 1，然后再对它们的平方求和。这明确地避免了从相关指标中重复计算信息。\n5.  **可解释的参考分布：是。** 根据问题陈述，在 $H_0$ 下，估计量向量是渐近高斯的。具体来说，$\\sqrt{n} V$ 在分布上收敛于一个多元正态分布 $\\mathcal{N}(\\mathbf{0}, \\Sigma_A)$，其中 $\\Sigma_A$ 是渐近协方差矩阵。因此，统计量 $n V^\\top \\Sigma_A^{-1} V$ 收敛于一个具有 $k$ 个自由度的卡方分布 $\\chi^2_k$，其中 $k=5$ 是 $V$ 的维度。由于 $\\widehat\\Sigma$ 是 $V$ 的真实协方差（对于大 $n$ 约为 $\\Sigma_A/n$）的一致估计量，因此在 $H_0$ 下，统计量 $S_C = V^\\top \\widehat\\Sigma^{-1} V$ 在分布上近似于 $\\chi^2_5$。$\\chi^2$ 分布是一个标准的、易于理解的参考分布，允许进行有原则的假设检验和校准（例如，计算 p 值）。\n\n**结论：正确。** 该选项独特而优雅地满足了所有五个标准。它代表了对此类多元假设检验的标准、有统计学原则的方法。",
            "answer": "$$\\boxed{C}$$"
        }
    ]
}