{
    "hands_on_practices": [
        {
            "introduction": "任何原子间势（无论是经典的还是机器学习的）的核心功能都是为给定的原子构型计算其总能量和每个原子上的作用力。这个练习将通过一个简单的解析势函数，巩固势能与力之间最基本的关系，即力是能量对位置的负梯度（$F = -\\nabla E$）。通过完成这个计算，你将掌握分子动力学模拟的基石，并为理解更复杂的机器学习势如何执行相同的任务打下坚实的基础。",
            "id": "3822117",
            "problem": "考虑一个一维三原子构型，用于说明一个简单的机器学习原子间势 (Machine Learning Interatomic Potential, MLIP)。单个原子的能量定义为\n$$\\varepsilon(\\mathcal{N}_i)=\\sum_{j\\in \\mathcal{N}_i} a \\exp(-b r_{ij}),$$\n其中 $r_{ij}$ 是原子 $i$ 和 $j$ 之间的欧几里得距离，$a$ 和 $b$ 是正常数，$\\mathcal{N}_i$ 是原子 $i$ 的邻居集合，包含所有其他原子。系统的总能量是所有原子各自能量的总和。原子 $k$ 上的经典力定义为 $\\mathbf{F}_k=-\\nabla_{\\mathbf{R}_k} E_{\\mathrm{tot}}$，其中 $\\mathbf{R}_k$ 是原子 $k$ 的位置，$E_{\\mathrm{tot}}$ 是总能量。\n\n取三个沿 $x$ 轴共线放置的原子，其位置分别为 $x_1=0\\,\\mathrm{\\AA}$、$x_2=2.0\\,\\mathrm{\\AA}$ 和 $x_3=3.5\\,\\mathrm{\\AA}$。使用参数 $a=0.25\\,\\mathrm{eV}$ 和 $b=1.0\\,\\mathrm{\\AA}^{-1}$。假设 $\\mathcal{N}_i=\\{j\\neq i\\}$（即所有其他原子都是邻居），并忽略任何边界条件。\n\n计算总能量 $E_{\\mathrm{tot}}$ 以及每个原子在 $x$ 方向上受到的力 $F_{1x}$、$F_{2x}$ 和 $F_{3x}$。最终的能量以电子伏特 (eV) 表示，力以电子伏特每埃 ($\\mathrm{eV}/\\mathrm{\\AA}$) 表示。将最终数值结果四舍五入到四位有效数字。",
            "solution": "用户要求我解决一个物理问题。\n\n### 步骤 1：提取已知条件\n- 原子 $i$ 的能量：$\\varepsilon(\\mathcal{N}_i)=\\sum_{j\\in \\mathcal{N}_i} a \\exp(-b r_{ij})$\n- 系统的总能量：$E_{\\mathrm{tot}}=\\sum_{i} \\varepsilon(\\mathcal{N}_i)$\n- 原子 $k$ 上的力：$\\mathbf{F}_k=-\\nabla_{\\mathbf{R}_k} E_{\\mathrm{tot}}$\n- 原子数：$3$\n- 沿 $x$ 轴的原子位置：$x_1=0\\,\\mathrm{\\AA}$、$x_2=2.0\\,\\mathrm{\\AA}$、$x_3=3.5\\,\\mathrm{\\AA}$\n- 参数 $a$：$0.25\\,\\mathrm{eV}$\n- 参数 $b$：$1.0\\,\\mathrm{\\AA}^{-1}$\n- 邻居集合定义：$\\mathcal{N}_i=\\{j\\neq i\\}$\n- 问题是一维的。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题使用了一种简化的、但物理上合理的原子间势能形式，类似于 Born-Mayer 势的排斥部分或机器学习势中使用的分量（例如，Behler-Parrinello 对称函数）。力定义为势能的负梯度是经典力学的一个基本原理。该设置是计算材料科学中的一个标准玩具模型。\n- **适定性**：该问题提供了计算总能量和力的唯一值所需的所有必要信息（位置、能量的函数形式、参数）。解对于输入的微小变化是稳定的。\n- **客观性**：该问题使用精确的数学定义和客观的数值数据进行陈述。没有主观或含糊不清的术语。\n- **结论**：该问题在科学上是合理的，具有适定性和客观性，并且不包含内部矛盾或缺失信息。因此，该问题是有效的。\n\n### 步骤 3：结论与行动\n该问题有效。我现在将提供一个完整且有理有据的解答。\n\n### 解答\n\n三原子系统的总能量是原子 $1$、$2$ 和 $3$ 各自能量的总和。\n$$E_{\\mathrm{tot}} = \\varepsilon_1 + \\varepsilon_2 + \\varepsilon_3$$\n原子 $i$ 的能量为 $\\varepsilon_i = \\sum_{j \\neq i} a \\exp(-b r_{ij})$。\n- 对于原子 $1$，$\\varepsilon_1 = a \\exp(-b r_{12}) + a \\exp(-b r_{13})$。\n- 对于原子 $2$，$\\varepsilon_2 = a \\exp(-b r_{21}) + a \\exp(-b r_{23})$。\n- 对于原子 $3$，$\\varepsilon_3 = a \\exp(-b r_{31}) + a \\exp(-b r_{32})$。\n\n由于距离 $r_{ij} = r_{ji}$，总能量为：\n$$E_{\\mathrm{tot}} = (a \\exp(-b r_{12}) + a \\exp(-b r_{13})) + (a \\exp(-b r_{12}) + a \\exp(-b r_{23})) + (a \\exp(-b r_{13}) + a \\exp(-b r_{23}))$$\n$$E_{\\mathrm{tot}} = 2a (\\exp(-b r_{12}) + \\exp(-b r_{13}) + \\exp(-b r_{23}))$$\n这种形式正确地计算了每对原子对该对中两个原子能量的贡献。\n\n首先，我们根据给定的位置 $x_1=0\\,\\mathrm{\\AA}$、$x_2=2.0\\,\\mathrm{\\AA}$ 和 $x_3=3.5\\,\\mathrm{\\AA}$ 计算成对距离 $r_{ij} = |x_i - x_j|$。\n$$r_{12} = |x_1 - x_2| = |0 - 2.0| = 2.0\\,\\mathrm{\\AA}$$\n$$r_{13} = |x_1 - x_3| = |0 - 3.5| = 3.5\\,\\mathrm{\\AA}$$\n$$r_{23} = |x_2 - x_3| = |2.0 - 3.5| = 1.5\\,\\mathrm{\\AA}$$\n\n现在，我们可以使用给定的参数 $a=0.25\\,\\mathrm{eV}$ 和 $b=1.0\\,\\mathrm{\\AA}^{-1}$ 计算总能量 $E_{\\mathrm{tot}}$。\n$$E_{\\mathrm{tot}} = 2(0.25\\,\\mathrm{eV}) (\\exp(-1.0 \\times 2.0) + \\exp(-1.0 \\times 3.5) + \\exp(-1.0 \\times 1.5))$$\n$$E_{\\mathrm{tot}} = 0.5 (\\exp(-2.0) + \\exp(-3.5) + \\exp(-1.5))\\,\\mathrm{eV}$$\n使用计算器计算指数项：\n$$E_{\\mathrm{tot}} \\approx 0.5 (0.135335 + 0.030197 + 0.223130)\\,\\mathrm{eV}$$\n$$E_{\\mathrm{tot}} \\approx 0.5 (0.388662)\\,\\mathrm{eV} \\approx 0.194331\\,\\mathrm{eV}$$\n四舍五入到四位有效数字，$E_{\\mathrm{tot}} \\approx 0.1943\\,\\mathrm{eV}$。\n\n接下来，我们计算力。由于系统是一维的，原子 $k$ 上的力为 $F_{kx} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_k}$。用坐标表示的总能量是：\n$$E_{\\mathrm{tot}} = 2a (\\exp(-b|x_1-x_2|) + \\exp(-b|x_1-x_3|) + \\exp(-b|x_2-x_3|))$$\n我们使用链式法则以及当 $u \\neq 0$ 时 $\\frac{d|u|}{du} = \\mathrm{sgn}(u)$ 这一事实：\n$\\frac{\\partial}{\\partial x_k} \\exp(-b|x_i-x_j|) = -b \\exp(-b|x_i-x_j|) \\frac{\\partial|x_i-x_j|}{\\partial x_k}$。\n绝对值项的导数是：\n$\\frac{\\partial|x_i-x_j|}{\\partial x_k} = \\begin{cases} \\mathrm{sgn}(x_i-x_j)  & \\text{如果 } k=i \\\\ -\\mathrm{sgn}(x_i-x_j) & \\text{如果 } k=j \\\\ 0 & \\text{如果 } k \\neq i,j \\end{cases}$\n\n原子 $1$ 上的力 $F_{1x}$：\n$$F_{1x} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_1} = -2a \\left[ \\frac{\\partial}{\\partial x_1}\\exp(-b|x_1-x_2|) + \\frac{\\partial}{\\partial x_1}\\exp(-b|x_1-x_3|) \\right]$$\n$$F_{1x} = -2a \\left[ -b \\exp(-b r_{12}) \\mathrm{sgn}(x_1-x_2) -b \\exp(-b r_{13}) \\mathrm{sgn}(x_1-x_3) \\right]$$\n$$F_{1x} = 2ab \\left[ \\mathrm{sgn}(x_1-x_2) \\exp(-b r_{12}) + \\mathrm{sgn}(x_1-x_3) \\exp(-b r_{13}) \\right]$$\n由于 $x_1  x_2$ 和 $x_1  x_3$，我们有 $\\mathrm{sgn}(x_1-x_2) = -1$ 和 $\\mathrm{sgn}(x_1-x_3) = -1$。代入数值：\n$F_{1x} = 2(0.25)(1.0) [(-1)\\exp(-1.0 \\times 2.0) + (-1)\\exp(-1.0 \\times 3.5)] = -0.5(\\exp(-2.0) + \\exp(-3.5)) \\approx -0.082766\\,\\mathrm{eV}/\\mathrm{\\AA}$\n\n原子 $2$ 上的力 $F_{2x}$：\n$F_{2x} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_2} = 2ab \\left[ \\mathrm{sgn}(x_2-x_1) \\exp(-b r_{12}) + \\mathrm{sgn}(x_2-x_3) \\exp(-b r_{23}) \\right]$\n由于 $x_2 > x_1$ 和 $x_2  x_3$，我们有 $\\mathrm{sgn}(x_2-x_1) = 1$ 和 $\\mathrm{sgn}(x_2-x_3) = -1$。代入数值：\n$F_{2x} = 0.5 [ (1)\\exp(-2.0) + (-1)\\exp(-1.5) ] \\approx -0.043898\\,\\mathrm{eV}/\\mathrm{\\AA}$\n\n原子 $3$ 上的力 $F_{3x}$：\n$F_{3x} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_3} = 2ab \\left[ \\mathrm{sgn}(x_3-x_1) \\exp(-b r_{13}) + \\mathrm{sgn}(x_3-x_2) \\exp(-b r_{23}) \\right]$\n由于 $x_3 > x_1$ 和 $x_3 > x_2$，我们有 $\\mathrm{sgn}(x_3-x_1) = 1$ 和 $\\mathrm{sgn}(x_3-x_2) = 1$。代入数值：\n$F_{3x} = 0.5 [ (1)\\exp(-3.5) + (1)\\exp(-1.5) ] \\approx 0.126664\\,\\mathrm{eV}/\\mathrm{\\AA}$\n\n作为验证，力的总和为 $F_{1x} + F_{2x} + F_{3x} \\approx -0.082766 - 0.043898 + 0.126664 = 0$。\n四舍五入到四位有效数字，我们得到 $F_{1x} \\approx -0.08277\\,\\mathrm{eV}/\\mathrm{\\AA}$，$F_{2x} \\approx -0.04390\\,\\mathrm{eV}/\\mathrm{\\AA}$，$F_{3x} \\approx 0.1267\\,\\mathrm{eV}/\\mathrm{\\AA}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1943   -0.08277   -0.04390   0.1267\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "机器学习原子间势（MLIP）用神经网络取代了简单的解析函数，以实现从原子局部环境到能量的复杂映射。为了进行动力学模拟，我们仍然需要计算力，这要求对神经网络的输出（能量）关于原子坐标进行微分。这个练习将通过手动应用链式法则，引导你逐步计算通过描述符和网络层的梯度，从而揭示“自动微分”或“反向传播”在MLIPs中的工作原理，让你深刻理解力是如何从学到的能量模型中精确导出的。",
            "id": "3822094",
            "problem": "在多尺度材料模拟中，机器学习（ML）原子间势将系统的势能表示为每个原子能量贡献的总和，这些贡献是从对称性保持描述符与标量能量之间的学习映射中获得的。力由总能量相对于原子坐标的负梯度得出。考虑一个具有二次激活函数的最小双层原子神经网络，它将由对距离构建的局部、旋转和平移不变的描述符映射到每个原子的能量。三个原子位于二维平面上，位置分别为 $\\mathbf{r}_1 = (0, 0)$、$\\mathbf{r}_2 = (1, 0)$ 和 $\\mathbf{r}_3 = (0, 1)$。令 $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ 表示原子 $i$ 和 $j$ 之间的欧几里得距离。对于每个原子 $i$，定义两个标量描述符\n$$\ns_i = \\sum_{j \\neq i} r_{ij}, \\qquad t_i = \\sum_{j \\neq i} r_{ij}^{2}.\n$$\n该原子网络有两个隐藏单元，其预激活值为\n$$\nz_{i1} = w_{11}\\, s_i + w_{12}\\, t_i + b_1,\\qquad z_{i2} = w_{21}\\, s_i + w_{22}\\, t_i + b_2,\n$$\n对每个隐藏单元应用逐点激活函数 $\\phi(x) = x^{2}$，以及一个标量输出的原子能量\n$$\ne_i = v_1\\, \\phi(z_{i1}) + v_2\\, \\phi(z_{i2}) + b.\n$$\n总能量为 $E = \\sum_{i=1}^{3} e_i$。使用牛顿第二定律的势能形式，即力由能量的负梯度给出，$ \\mathbf{F}_i = - \\nabla_{\\mathbf{r}_i} E$，并像在自动微分（AD）中一样，使用链式法则对描述符进行微分。网络参数为\n$$\nw_{11} = 1,\\quad w_{12} = -1,\\quad b_1 = 0,\\qquad w_{21} = 2,\\quad w_{22} = 1,\\quad b_2 = -1,\\\\\nv_1 = \\frac{1}{2},\\quad v_2 = -\\frac{1}{4},\\quad b = 0.\n$$\n所有量均为无量纲。计算给定三原子构型的总能量 $E$ 以及力 $\\mathbf{F}_1$、$\\mathbf{F}_2$ 和 $\\mathbf{F}_3$。将你的最终答案表示为一个单行矩阵，顺序为\n$$\n\\left(E,\\; F_{1x},\\; F_{1y},\\; F_{2x},\\; F_{2y},\\; F_{3x},\\; F_{3y}\\right),\n$$\n使用精确值，不要四舍五入。",
            "solution": "基本原理是，保守力是势能相对于位置的负梯度，并且对于任何可微的复合函数，链式法则给出了复合函数的导数。具体来说，对于总能量 $E(\\{\\mathbf{r}_i\\})$，\n$$\n\\mathbf{F}_i = - \\nabla_{\\mathbf{r}_i} E.\n$$\n由于描述符依赖于对距离，我们将需要 $\\frac{\\partial r_{ij}}{\\partial \\mathbf{r}_i} = \\frac{\\mathbf{r}_i - \\mathbf{r}_j}{r_{ij}}$（对于 $i \\neq j$），这可以通过对 $r_{ij} = \\sqrt{(\\mathbf{r}_i - \\mathbf{r}_j) \\cdot (\\mathbf{r}_i - \\mathbf{r}_j)}$ 直接微分得到。\n\n首先计算 $\\mathbf{r}_1 = (0, 0)$、$\\mathbf{r}_2 = (1, 0)$ 和 $\\mathbf{r}_3 = (0, 1)$ 的对距离：\n$$\nr_{12} = \\| (0,0) - (1,0)\\| = 1,\\quad r_{13} = \\|(0,0) - (0,1)\\| = 1,\\quad r_{23} = \\|(1,0) - (0,1)\\| = \\sqrt{2}.\n$$\n每个原子的描述符为\n$$\ns_1 = r_{12} + r_{13} = 1 + 1 = 2,\\qquad t_1 = r_{12}^{2} + r_{13}^{2} = 1 + 1 = 2,\\\\\ns_2 = r_{21} + r_{23} = 1 + \\sqrt{2},\\qquad t_2 = r_{21}^{2} + r_{23}^{2} = 1 + 2 = 3,\\\\\ns_3 = r_{31} + r_{32} = 1 + \\sqrt{2},\\qquad t_3 = r_{31}^{2} + r_{32}^{2} = 1 + 2 = 3.\n$$\n计算隐藏单元的预激活值和激活值。使用给定的权重和偏置，\n$$\nz_{i1} = 1 \\cdot s_i + (-1) \\cdot t_i + 0 = s_i - t_i,\\qquad \\phi(z_{i1}) = (s_i - t_i)^{2},\\\\\nz_{i2} = 2 \\cdot s_i + 1 \\cdot t_i - 1 = 2 s_i + t_i - 1,\\qquad \\phi(z_{i2}) = (2 s_i + t_i - 1)^{2}.\n$$\n每个原子的能量为\n$$\ne_i = \\frac{1}{2}(s_i - t_i)^{2} - \\frac{1}{4}(2 s_i + t_i - 1)^{2}.\n$$\n计算每个原子的 $e_i$：\n对于 $i=1$，$s_1 = 2$，$t_1 = 2$，所以\n$$\n(s_1 - t_1)^{2} = 0,\\qquad (2 s_1 + t_1 - 1)^{2} = (4 + 2 - 1)^{2} = 5^{2} = 25,\\\\\ne_1 = \\frac{1}{2} \\cdot 0 - \\frac{1}{4} \\cdot 25 = -\\frac{25}{4}.\n$$\n对于 $i=2$，$s_2 = 1 + \\sqrt{2}$，$t_2 = 3$，所以\n$$\n(s_2 - t_2)^{2} = (1 + \\sqrt{2} - 3)^{2} = (\\sqrt{2} - 2)^{2} = 2 - 4 \\sqrt{2} + 4 = 6 - 4 \\sqrt{2},\\\\\n(2 s_2 + t_2 - 1)^{2} = \\left(2(1 + \\sqrt{2}) + 3 - 1\\right)^{2} = (4 + 2 \\sqrt{2})^{2} = 16(1+\\frac{\\sqrt{2}}{2})^2 = 16(1+\\sqrt{2}+\\frac{1}{2}) = 16(\\frac{3}{2}+\\sqrt{2}) = 24+16\\sqrt{2},\\\\\ne_2 = \\frac{1}{2}(6 - 4 \\sqrt{2}) - \\frac{1}{4}(24 + 16 \\sqrt{2}) = 3 - 2 \\sqrt{2} - 6 - 4 \\sqrt{2} = -3 - 6 \\sqrt{2}.\n$$\n对于 $i=3$，$s_3 = 1 + \\sqrt{2}$，$t_3 = 3$，其值与 $i=2$ 时相同，\n$$\ne_3 = -3 - 6 \\sqrt{2}.\n$$\n因此，总能量为\n$$\nE = e_1 + e_2 + e_3 = -\\frac{25}{4} + \\left(-3 - 6 \\sqrt{2}\\right) + \\left(-3 - 6 \\sqrt{2}\\right) = -\\frac{49}{4} - 12 \\sqrt{2}.\n$$\n接下来，通过微分推导力。由于 $e_i$ 依赖于 $(s_i, t_i)$，而 $s_i$ 和 $t_i$ 依赖于距离 $r_{ij}$，因此使用链式法则。符号化地计算偏导数 $\\frac{\\partial e_i}{\\partial s_i}$ 和 $\\frac{\\partial e_i}{\\partial t_i}$：\n$$\n\\frac{\\partial e_i}{\\partial s_i} = \\frac{1}{2} \\cdot 2 (s_i - t_i) \\cdot 1 \\;+\\; \\left(-\\frac{1}{4}\\right) \\cdot 2 (2 s_i + t_i - 1) \\cdot 2\n= (s_i - t_i) - (2 s_i + t_i - 1) = - s_i - 2 t_i + 1,\\\\\n\\frac{\\partial e_i}{\\partial t_i} = \\frac{1}{2} \\cdot 2 (s_i - t_i) \\cdot (-1) \\;+\\; \\left(-\\frac{1}{4}\\right) \\cdot 2 (2 s_i + t_i - 1) \\cdot 1\n= - (s_i - t_i) - \\frac{1}{2}(2 s_i + t_i - 1) = - 2 s_i + \\frac{1}{2} t_i + \\frac{1}{2}.\n$$\n对于单个对 $r_{ij}$，它对 $(s_i, t_i)$ 和 $(s_j, t_j)$ 都有贡献，且\n$$\n\\frac{\\partial s_i}{\\partial r_{ij}} = 1,\\quad \\frac{\\partial t_i}{\\partial r_{ij}} = 2 r_{ij},\\qquad\n\\frac{\\partial s_j}{\\partial r_{ij}} = 1,\\quad \\frac{\\partial t_j}{\\partial r_{ij}} = 2 r_{ij}.\n$$\n因此\n$$\n\\frac{\\partial E}{\\partial r_{ij}} = \\frac{\\partial e_i}{\\partial s_i} \\cdot 1 + \\frac{\\partial e_i}{\\partial t_i} \\cdot 2 r_{ij} + \\frac{\\partial e_j}{\\partial s_j} \\cdot 1 + \\frac{\\partial e_j}{\\partial t_j} \\cdot 2 r_{ij}\n= \\left(\\frac{\\partial e_i}{\\partial s_i} + \\frac{\\partial e_j}{\\partial s_j}\\right) + \\left(\\frac{\\partial e_i}{\\partial t_i} + \\frac{\\partial e_j}{\\partial t_j}\\right) 2 r_{ij}.\n$$\n接下来，我们在已计算的 $(s_i, t_i)$ 处计算 $\\frac{\\partial e_i}{\\partial s_i}$ 和 $\\frac{\\partial e_i}{\\partial t_i}$。对于 $i=1$，$s_1 = 2$，$t_1 = 2$，\n$$\n\\frac{\\partial e_1}{\\partial s_1} = -2 - 4 + 1 = -5,\\qquad \\frac{\\partial e_1}{\\partial t_1} = -4 + \\frac{1}{2}\\cdot 2 + \\frac{1}{2} = -\\frac{5}{2}.\n$$\n对于 $i=2$，$s_2 = 1 + \\sqrt{2}$，$t_2 = 3$，\n$$\n\\frac{\\partial e_2}{\\partial s_2} = - (1 + \\sqrt{2}) - 2 \\cdot 3 + 1 = - \\sqrt{2} - 6,\\\\\n\\frac{\\partial e_2}{\\partial t_2} = - 2 (1 + \\sqrt{2}) + \\frac{1}{2} \\cdot 3 + \\frac{1}{2} = - 2 \\sqrt{2}.\n$$\n对于 $i=3$，$s_3 = 1 + \\sqrt{2}$，$t_3 = 3$，\n$$\n\\frac{\\partial e_3}{\\partial s_3} = - \\sqrt{2} - 6,\\qquad \\frac{\\partial e_3}{\\partial t_3} = - 2 \\sqrt{2}.\n$$\n现在计算 $\\frac{\\partial E}{\\partial r_{12}}$、$\\frac{\\partial E}{\\partial r_{13}}$ 和 $\\frac{\\partial E}{\\partial r_{23}}$：\n对于对 $(1,2)$，$r_{12} = 1$，\n$$\n\\frac{\\partial E}{\\partial r_{12}} = \\left(\\frac{\\partial e_1}{\\partial s_1} + \\frac{\\partial e_2}{\\partial s_2}\\right) + \\left(\\frac{\\partial e_1}{\\partial t_1} + \\frac{\\partial e_2}{\\partial t_2}\\right) 2 r_{12}\n= \\left(-5 + (- \\sqrt{2} - 6)\\right) + \\left(-\\frac{5}{2} - 2 \\sqrt{2}\\right) 2\\\\\n= \\left(-11 - \\sqrt{2}\\right) + \\left(-5 - 4 \\sqrt{2}\\right) = -16 - 5 \\sqrt{2}.\n$$\n对于对 $(1,3)$，$r_{13} = 1$，\n$$\n\\frac{\\partial E}{\\partial r_{13}} = \\left(\\frac{\\partial e_1}{\\partial s_1} + \\frac{\\partial e_3}{\\partial s_3}\\right) + \\left(\\frac{\\partial e_1}{\\partial t_1} + \\frac{\\partial e_3}{\\partial t_3}\\right) 2 r_{13}\\\\\n= \\left(-5 + (- \\sqrt{2} - 6)\\right) + \\left(-\\frac{5}{2} - 2 \\sqrt{2}\\right) 2 = -16 - 5 \\sqrt{2}.\n$$\n对于对 $(2,3)$，$r_{23} = \\sqrt{2}$，\n$$\n\\frac{\\partial E}{\\partial r_{23}} = \\left(\\frac{\\partial e_2}{\\partial s_2} + \\frac{\\partial e_3}{\\partial s_3}\\right) + \\left(\\frac{\\partial e_2}{\\partial t_2} + \\frac{\\partial e_3}{\\partial t_3}\\right) 2 r_{23}\\\\\n= \\left(- \\sqrt{2} - 6 + (- \\sqrt{2} - 6)\\right) + \\left(- 2 \\sqrt{2} - 2 \\sqrt{2}\\right) 2 \\sqrt{2}\\\\\n= \\left(- 2 \\sqrt{2} - 12\\right) + \\left(- 4 \\sqrt{2} \\cdot 2 \\sqrt{2}\\right) = - 2 \\sqrt{2} - 12 - 16 = - 2 \\sqrt{2} - 28.\n$$\n最后，使用以下公式将关于距离的导数转换成关于坐标的力\n$$\n\\nabla_{\\mathbf{r}_i} r_{ij} = \\frac{\\mathbf{r}_i - \\mathbf{r}_j}{r_{ij}},\\qquad \\mathbf{F}_i = - \\sum_{j \\neq i} \\frac{\\partial E}{\\partial r_{ij}} \\frac{\\mathbf{r}_i - \\mathbf{r}_j}{r_{ij}}.\n$$\n计算每个力的矢量分量。\n\n对于原子1，\n$$\n\\frac{\\mathbf{r}_1 - \\mathbf{r}_2}{r_{12}} = \\frac{(-1, 0)}{1} = (-1, 0),\\qquad\n\\frac{\\mathbf{r}_1 - \\mathbf{r}_3}{r_{13}} = \\frac{(0, -1)}{1} = (0, -1),\n$$\n所以\n$$\n\\mathbf{F}_1 = - \\frac{\\partial E}{\\partial r_{12}} (-1, 0) - \\frac{\\partial E}{\\partial r_{13}} (0, -1) = \\left(\\frac{\\partial E}{\\partial r_{12}},\\; \\frac{\\partial E}{\\partial r_{13}}\\right) = \\left(-16 - 5 \\sqrt{2},\\; -16 - 5 \\sqrt{2}\\right).\n$$\n对于原子2，\n$$\n\\frac{\\mathbf{r}_2 - \\mathbf{r}_1}{r_{21}} = \\frac{(1, 0)}{1} = (1, 0),\\qquad\n\\frac{\\mathbf{r}_2 - \\mathbf{r}_3}{r_{23}} = \\frac{(1, -1)}{\\sqrt{2}},\n$$\n所以\n$$\n\\mathbf{F}_2 = - \\frac{\\partial E}{\\partial r_{12}} (1, 0) - \\frac{\\partial E}{\\partial r_{23}} \\frac{(1, -1)}{\\sqrt{2}}\n= \\left(- \\frac{\\partial E}{\\partial r_{12}} - \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}},\\; \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}}\\right).\n$$\n代入精确值，\n$$\n- \\frac{\\partial E}{\\partial r_{12}} = 16 + 5 \\sqrt{2},\\qquad - \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}} = - \\frac{- 2 \\sqrt{2} - 28}{\\sqrt{2}} = 2 + 14 \\sqrt{2},\\qquad \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}} = - 2 - 14 \\sqrt{2},\n$$\n得到\n$$\n\\mathbf{F}_2 = \\left(16 + 5 \\sqrt{2} + 2 + 14 \\sqrt{2},\\; - 2 - 14 \\sqrt{2}\\right) = \\left(18 + 19 \\sqrt{2},\\; - 2 - 14 \\sqrt{2}\\right).\n$$\n对于原子3，\n$$\n\\frac{\\mathbf{r}_3 - \\mathbf{r}_1}{r_{31}} = \\frac{(0, 1)}{1} = (0, 1),\\qquad\n\\frac{\\mathbf{r}_3 - \\mathbf{r}_2}{r_{32}} = \\frac{(-1, 1)}{\\sqrt{2}},\n$$\n所以\n$$\n\\mathbf{F}_3 = - \\frac{\\partial E}{\\partial r_{13}} (0, 1) - \\frac{\\partial E}{\\partial r_{23}} \\frac{(-1, 1)}{\\sqrt{2}}\n= \\left(\\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}},\\; - \\frac{\\partial E}{\\partial r_{13}} - \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}}\\right).\n$$\n代入数值，\n$$\n\\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}} = - 2 - 14 \\sqrt{2},\\qquad - \\frac{\\partial E}{\\partial r_{13}} = 16 + 5 \\sqrt{2},\\qquad - \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}} = 2 + 14 \\sqrt{2},\n$$\n得到\n$$\n\\mathbf{F}_3 = \\left(- 2 - 14 \\sqrt{2},\\; 16 + 5 \\sqrt{2} + 2 + 14 \\sqrt{2}\\right) = \\left(- 2 - 14 \\sqrt{2},\\; 18 + 19 \\sqrt{2}\\right).\n$$\n作为一致性检查，动量守恒意味着 $\\sum_{i=1}^{3} \\mathbf{F}_i = \\mathbf{0}$。对x分量求和，\n$$\n\\left(-16 - 5 \\sqrt{2}\\right) + \\left(18 + 19 \\sqrt{2}\\right) + \\left(- 2 - 14 \\sqrt{2}\\right) = 0,\n$$\n以及y分量，\n$$\n\\left(-16 - 5 \\sqrt{2}\\right) + \\left(- 2 - 14 \\sqrt{2}\\right) + \\left(18 + 19 \\sqrt{2}\\right) = 0,\n$$\n确认了内部一致性。因此，所求的能量和力分量为\n$$\nE = - \\frac{49}{4} - 12 \\sqrt{2},\\quad \\mathbf{F}_1 = \\left(-16 - 5 \\sqrt{2},\\; -16 - 5 \\sqrt{2}\\right),\\quad \\mathbf{F}_2 = \\left(18 + 19 \\sqrt{2},\\; - 2 - 14 \\sqrt{2}\\right),\\quad \\mathbf{F}_3 = \\left(- 2 - 14 \\sqrt{2},\\; 18 + 19 \\sqrt{2}\\right).\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}-\\frac{49}{4}-12\\sqrt{2}  -16-5\\sqrt{2}  -16-5\\sqrt{2}  18+19\\sqrt{2}  -2-14\\sqrt{2}  -2-14\\sqrt{2}  18+19\\sqrt{2}\\end{pmatrix}}$$"
        },
        {
            "introduction": "物理学的一个基本原则是，相同的粒子是不可区分的。因此，一个物理上自洽的机器学习势必须尊重这种置换不变性，即交换两个相同原子的标签（或索引）不应改变系统的总能量。这个练习旨在揭示违反该原则所导致的严重问题。通过构建一个不满足置换不变性的“坏”模型，并将其与物理上正确的模型进行对比，你将学会如何定量评估这种对称性的重要性，并理解为何构建不变性特征是设计可靠MLIPs的核心挑战。",
            "id": "3886545",
            "problem": "要求您形式化并量化在计算催化和化学工程领域的机器学习（ML）原子间势中，违反相同原子排列不变性的后果。目标是构建一个场景，其中依赖于索引的特征会导致人为的能量分裂，并根据一个有物理基础的参考来量化由此产生的预测误差。从一个具有物理动机的、排列不变的参考能量出发，用它来分析一个故意设置为排列可变的代理模型。您的程序必须生成一行输出，其中包含一组测试构型的汇总数值结果，这些结果以无量纲的约化单位表示，并四舍五入到八位小数。\n\n基本原理：\n- 在经典力学和量子力学中，相同的原子是不可区分的；总能量必须在原子标签的任何排列下保持不变。形式上，如果有 $N$ 个相同的原子，且一个构型由成对距离的集合 $\\{r_{ij}\\}$ 描述，那么索引的对称群 $S_N$ 中的任何排列 $\\pi$ 都必须满足 $E(\\{r_{ij}\\}) = E(\\{r_{\\pi(i)\\pi(j)}\\})$。\n- 一个用于非键相互作用的标准、经过充分测试的成对能量函数是 Lennard-Jones (LJ) 势。在特征能量和长度尺度均设为单位的约化单位制中，一个构型的总能量计算如下\n$$\nE_{\\text{LJ}}(\\mathbf{R}) = \\sum_{1 \\leq i  j \\leq N} 4 \\varepsilon \\left[\\left(\\frac{\\sigma}{r_{ij}}\\right)^{12} - \\left(\\frac{\\sigma}{r_{ij}}\\right)^6\\right],\n$$\n其中 $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$, $\\varepsilon$ 和 $\\sigma$ 分别是能量和长度尺度，对无序对求和确保了排列不变性。使用 $\\varepsilon = 1$ 和 $\\sigma = 1$ 的约化单位，从而使得能量和距离都是无量纲的。\n\n依赖索引的代理模型：\n- 定义依赖于局部距离的单原子描述符，\n$$\nd_i = \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} \\exp\\left(-\\frac{r_{ij}}{\\sigma}\\right), \\quad e_i = \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} \\frac{r_{ij}}{\\sigma}.\n$$\n- 通过使用依赖于索引的权重，构建一个故意设置为排列可变的代理能量，\n$$\nE_{\\text{bad}}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left[a_i \\, d_i + b_i \\, e_i\\right],\n$$\n其中 $\\mathbf{a} = (a_1, \\dots, a_N)$ 和 $\\mathbf{b} = (b_1, \\dots, b_N)$ 依赖于原子索引。在标签的一个排列 $\\pi \\in S_N$ 下，预测的能量变为\n$$\nE_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left[a_{\\pi(i)} \\, d_i + b_{\\pi(i)} \\, e_i\\right],\n$$\n如果 $d_i$ 和 $e_i$ 不全相等，这可能导致相同原子的能量不同。\n- 为了比较，构建一个具有共享权重的排列不变的代理模型，\n$$\nE_{\\text{good}}(\\mathbf{R}; a, b) = \\sum_{i=1}^{N} \\left[a \\, d_i + b \\, e_i\\right].\n$$\n\n每个测试案例需要计算的量：\n- 在一组标签排列 $\\mathcal{P}$ 上的人为能量分裂幅度，\n$$\n\\Delta_{\\text{split}} = \\max_{\\pi \\in \\mathcal{P}} E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) - \\min_{\\pi \\in \\mathcal{P}} E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}).\n$$\n- 相对于 LJ 能量，依赖索引的模型在 $\\mathcal{P}$ 上的最大绝对预测误差，\n$$\n\\text{Err}_{\\text{bad,max}} = \\max_{\\pi \\in \\mathcal{P}} \\left|E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) - E_{\\text{LJ}}(\\mathbf{R})\\right|.\n$$\n- 排列不变的代理模型（共享权重）的绝对预测误差，\n$$\n\\text{Err}_{\\text{good}} = \\left|E_{\\text{good}}(\\mathbf{R}; a, b) - E_{\\text{LJ}}(\\mathbf{R})\\right|.\n$$\n\n角度单位是无关紧要的，因为只使用了距离。所有能量和距离都必须用 $\\varepsilon = 1$ 和 $\\sigma = 1$ 的无量纲约化单位表示。所有输出均四舍五入到八位小数。\n\n测试套件：\n- 使用以下四个构型案例。坐标以三维空间中的笛卡尔坐标给出，单位为约化单位。使用 $\\varepsilon = 1$ 和 $\\sigma = 1$。对于每个案例，应用由单位排列和反向索引排列组成的排列集合 $\\mathcal{P}$。共享权重为 $a = 0.9$, $b = -0.15$。\n\n案例 1（非对称线性三原子，理想情况）：\n- $N = 3$,\n- 位置：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.2, 0.0, 0.0\\right)$, $\\left(2.5, 0.0, 0.0\\right)$,\n- 依赖索引的权重：$\\mathbf{a} = (0.8, 1.4, 0.5)$, $\\mathbf{b} = (-0.3, 0.2, 0.1)$。\n\n案例 2（等边三角形，对称性边界条件）：\n- $N = 3$,\n- 边长：$L = 1.6$,\n- 位置：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(L, 0.0, 0.0\\right)$, $\\left(\\frac{L}{2}, \\frac{\\sqrt{3}}{2} L, 0.0\\right)$,\n- 依赖索引的权重：$\\mathbf{a} = (0.8, 1.4, 0.5)$, $\\mathbf{b} = (-0.3, 0.2, 0.1)$。\n\n案例 3（双原子对，边界情况）：\n- $N = 2$,\n- 位置：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.1, 0.0, 0.0\\right)$,\n- 依赖索引的权重：$\\mathbf{a} = (1.2, 0.7)$, $\\mathbf{b} = (-0.25, 0.05)$。\n\n案例 4（四个原子组成的非对称矩形布局）：\n- $N = 4$,\n- 位置：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.4, 0.0, 0.0\\right)$, $\\left(0.0, 2.2, 0.0\\right)$, $\\left(2.1, 2.3, 0.0\\right)$,\n- 依赖索引的权重：$\\mathbf{a} = (0.7, 1.1, 0.6, 1.5)$, $\\mathbf{b} = (-0.2, 0.25, -0.05, 0.3)$。\n\n要求的最终输出格式：\n- 对每个案例，计算三元组 $\\left[\\Delta_{\\text{split}}, \\text{Err}_{\\text{bad,max}}, \\text{Err}_{\\text{good}}\\right]$，类型为浮点数。您的程序应生成单行输出，其中包含这些逐案例三元组的列表，四舍五入到八位小数，格式为由方括号括起来的、逗号分隔的 Python 风格列表，例如 $\\left[[x_1,y_1,z_1],[x_2,y_2,z_2],\\dots\\right]$。",
            "solution": "用户提供的问题被评估为**有效**。该问题具有科学依据，提法明确，且客观。问题陈述提供了一套清晰、自洽的定义、数据和约束，可以得出一个唯一且有意义的解。它通过在机器学习原子间势的背景下，形式化违反一个基本物理原理——排列不变性——的后果，从而构建了一个在计算化学领域具有重要教学价值的练习。四个测试案例所需的所有数据都已提供，需要计算的量在数学上是明确无误的。\n\n着手求解，问题的核心是量化一个机器学习模型因未能遵守相同原子物理不可区分性原则而引入的误差。这个原理，即排列不变性，规定了由 $N$ 个相同原子组成的系统的总能量必须保持不变，无论我们如何标记它们。在数学上，对于原子索引 $\\{1, \\dots, N\\}$ 的任何排列 $\\pi$，能量函数 $E$ 必须满足 $E(\\{\\mathbf{r}_i\\}) = E(\\{\\mathbf{r}_{\\pi(i)}\\})$。\n\n解决方案的结构如下：\n1.  使用 Lennard-Jones (LJ) 势计算一个作为参考的、物理上正确的能量。这作为“基准真相”。在指定的约化单位中，特征能量 $\\varepsilon=1$ 和长度 $\\sigma=1$，LJ 势为：\n    $$E_{\\text{LJ}}(\\mathbf{R}) = \\sum_{1 \\leq i  j \\leq N} 4 \\left(r_{ij}^{-12} - r_{ij}^{-6}\\right)$$\n    其中 $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ 是原子 $i$ 和 $j$ 之间的距离。这种对唯一原子对求和的公式本质上是排列不变的。\n\n2.  基于局部原子环境描述符构建了两个代理模型。对于每个原子 $i$，我们定义描述符 $d_i$ 和 $e_i$ 来概括其邻域环境：\n    $$d_i = \\sum_{j \\neq i} \\exp(-r_{ij})$$\n    $$e_i = \\sum_{j \\neq i} r_{ij}$$\n    这些描述符本身是排列不变的，因为它们是空间中某点周围局部几何的属性，与分配给该点原子的标签无关。\n\n3.  第一个代理模型 $E_{\\text{good}}$ 通过为每个原子的描述符分配相同的权重 $a$ 和 $b$ 来构造成排列不变的：\n    $$E_{\\text{good}}(\\mathbf{R}; a, b) = \\sum_{i=1}^{N} \\left(a \\, d_i + b \\, e_i\\right)$$\n    在原子标签的排列下，描述符值集合 $\\{d_i, e_i\\}$ 仅仅是被重新排序，但它们在所有原子上的总和保持不变，从而确保 $E_{\\text{good}}$ 是不变的。\n\n4.  第二个代理模型 $E_{\\text{bad}}$ 通过分配依赖于索引的权重 $a_i$ 和 $b_i$ 来故意构造成违反排列不变性：\n    $$E_{\\text{bad}}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left(a_i \\, d_i + b_i \\, e_i\\right)$$\n    如果我们根据排列 $\\pi$ 对原子标签进行置换，原子 $i$（及其固定的描述符 $d_i, e_i$）现在被分配了标签 $\\pi(i)$，因此获得权重 $a_{\\pi(i)}$ 和 $b_{\\pi(i)}$。根据问题中的定义，在这个新标签下的能量是：\n    $$E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left(a_{\\pi(i)} \\, d_i + b_{\\pi(i)} \\, e_i\\right)$$\n    如果原子环境（以及因此的描述符 $d_i, e_i$）不完全相同，这个能量通常会依赖于排列 $\\pi$，这是不符合物理规律的。\n\n每个测试案例的算法流程如下：\n首先，根据给定的原子坐标计算成对距离的 $N \\times N$ 矩阵 $r_{ij}$。利用这些距离，计算参考能量 $E_{\\text{LJ}}$。然后，计算描述符向量 $\\mathbf{d}=(d_1, \\dots, d_N)$ 和 $\\mathbf{e}=(e_1, \\dots, e_N)$。\n\n为了量化这种违反，我们考虑两个排列：单位排列（$\\pi_{id}(i) = i$）和反向索引排列（对于基于 0 的索引，$\\pi_{rev}(i) = N-1-i$）。计算两个对应的能量 $E_{\\text{bad}}^{(\\pi_{id})}$ 和 $E_{\\text{bad}}^{(\\pi_{rev})}$。\n\n根据这些值，我们计算所需的度量指标：\n-   人为能量分裂，$\\Delta_{\\text{split}} = |E_{\\text{bad}}^{(\\pi_{id})} - E_{\\text{bad}}^{(\\pi_{rev})}|$。这直接衡量了不变性违反的程度。在对称构型中（例如，双原子分子或等边三聚体），所有原子的描述符 $\\{d_i, e_i\\}$ 都是相同的，导致 $\\Delta_{\\text{split}}$ 为零，正如预期。\n-   坏模型的最大绝对预测误差，$\\text{Err}_{\\text{bad,max}} = \\max(|E_{\\text{bad}}^{(\\pi_{id})} - E_{\\text{LJ}}|, |E_{\\text{bad}}^{(\\pi_{rev})} - E_{\\text{LJ}}|)$。这反映了有缺陷模型在给定标签下的最坏情况误差。\n-   好模型的绝对预测误差，$\\text{Err}_{\\text{good}} = |E_{\\text{good}}(\\mathbf{R}; a, b) - E_{\\text{LJ}}|$。这将模型固有的表示能力误差与由对称性破缺引起的误差分离开来。\n\n通过为每个案例计算三元组 $[\\Delta_{\\text{split}}, \\text{Err}_{\\text{bad,max}}, \\text{Err}_{\\text{good}}]$，我们系统地分析并量化了在计算模型中违反一个核心物理原理的后果。",
            "answer": "[[0.22416075,0.76344583,0.59765360],[0.00000000,0.66986641,0.52924151],[0.00000000,1.40805330,1.26470395],[1.55831637,1.83854131,0.54714643]]"
        }
    ]
}