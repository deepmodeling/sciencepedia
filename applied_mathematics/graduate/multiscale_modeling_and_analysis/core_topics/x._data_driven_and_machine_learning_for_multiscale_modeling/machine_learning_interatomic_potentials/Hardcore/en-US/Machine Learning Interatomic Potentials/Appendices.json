{
    "hands_on_practices": [
        {
            "introduction": "Before diving into complex machine learning models, it is essential to master the fundamental relationship between potential energy and interatomic forces. This exercise provides a foundational workout, asking you to calculate the total energy and atomic forces for a simple system using a defined per-atom energy model . By working through this calculation, you will solidify your understanding of how local atomic environments contribute to the total potential energy surface and how forces arise as the negative gradient of this energy.",
            "id": "3822117",
            "problem": "Consider a one-dimensional three-atom configuration used to illustrate a simple Machine Learning Interatomic Potential (MLIP). The per-atom energy is defined by\n$$\\varepsilon(\\mathcal{N}_i)=\\sum_{j\\in \\mathcal{N}_i} a \\exp(-b r_{ij}),$$\nwhere $r_{ij}$ is the Euclidean distance between atoms $i$ and $j$, $a$ and $b$ are positive constants, and $\\mathcal{N}_i$ is the neighbor set of atom $i$ containing all other atoms. The total energy of the system is the sum of per-atom energies over all atoms. The classical force on atom $k$ is defined as $\\mathbf{F}_k=-\\nabla_{\\mathbf{R}_k} E_{\\mathrm{tot}}$, where $\\mathbf{R}_k$ is the position of atom $k$ and $E_{\\mathrm{tot}}$ is the total energy.\n\nTake three atoms placed collinearly along the $x$-axis with positions $x_1=0\\,\\mathrm{\\AA}$, $x_2=2.0\\,\\mathrm{\\AA}$, and $x_3=3.5\\,\\mathrm{\\AA}$. Use parameters $a=0.25\\,\\mathrm{eV}$ and $b=1.0\\,\\mathrm{\\AA}^{-1}$. Assume $\\mathcal{N}_i=\\{j\\neq i\\}$ (that is, all other atoms are neighbors), and neglect any boundary conditions.\n\nCompute the total energy $E_{\\mathrm{tot}}$ and the forces on each atom along the $x$-direction, $F_{1x}$, $F_{2x}$, and $F_{3x}$. Express the final energy in electronvolts (eV) and the forces in electronvolts per ångström ($\\mathrm{eV}/\\mathrm{\\AA}$). Round your final numerical values to four significant figures.",
            "solution": "The total energy of the three-atom system is the sum of the per-atom energies for atoms $1$, $2$, and $3$.\n$$E_{\\mathrm{tot}} = \\varepsilon_1 + \\varepsilon_2 + \\varepsilon_3$$\nThe per-atom energy for atom $i$ is $\\varepsilon_i = \\sum_{j \\neq i} a \\exp(-b r_{ij})$. Because each pairwise interaction energy contributes to the per-atom energy of both atoms in the pair, the total energy can be written as a sum over unique pairs:\n$$E_{\\mathrm{tot}} = 2a (\\exp(-b r_{12}) + \\exp(-b r_{13}) + \\exp(-b r_{23}))$$\n\nFirst, we calculate the pairwise distances $r_{ij} = |x_i - x_j|$ from the given positions $x_1=0\\,\\mathrm{\\AA}$, $x_2=2.0\\,\\mathrm{\\AA}$, and $x_3=3.5\\,\\mathrm{\\AA}$.\n$$r_{12} = |0 - 2.0| = 2.0\\,\\mathrm{\\AA}$$\n$$r_{13} = |0 - 3.5| = 3.5\\,\\mathrm{\\AA}$$\n$$r_{23} = |2.0 - 3.5| = 1.5\\,\\mathrm{\\AA}$$\n\nNow, we can compute the total energy $E_{\\mathrm{tot}}$ using the given parameters $a=0.25\\,\\mathrm{eV}$ and $b=1.0\\,\\mathrm{\\AA}^{-1}$.\n$$E_{\\mathrm{tot}} = 2(0.25\\,\\mathrm{eV}) (\\exp(-1.0 \\times 2.0) + \\exp(-1.0 \\times 3.5) + \\exp(-1.0 \\times 1.5))$$\n$$E_{\\mathrm{tot}} = 0.5 (\\exp(-2.0) + \\exp(-3.5) + \\exp(-1.5))\\,\\mathrm{eV}$$\n$$E_{\\mathrm{tot}} \\approx 0.5 (0.135335 + 0.030197 + 0.223130)\\,\\mathrm{eV}$$\n$$E_{\\mathrm{tot}} \\approx 0.5 (0.388662)\\,\\mathrm{eV} \\approx 0.194331\\,\\mathrm{eV}$$\nRounding to four significant figures, $E_{\\mathrm{tot}} \\approx 0.1943\\,\\mathrm{eV}$.\n\nNext, we calculate the forces. Since the system is one-dimensional, the force on atom $k$ is $F_{kx} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_k}$. The total energy expressed in terms of coordinates is:\n$$E_{\\mathrm{tot}} = 2a (\\exp(-b|x_1-x_2|) + \\exp(-b|x_1-x_3|) + \\exp(-b|x_2-x_3|))$$\nWe use the chain rule and the fact that $\\frac{d|u|}{du} = \\mathrm{sgn}(u)$ for $u \\neq 0$.\n\nForce on atom $1$, $F_{1x}$:\n$$F_{1x} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_1} = -2a \\left[ -b \\exp(-b r_{12}) \\mathrm{sgn}(x_1-x_2) -b \\exp(-b r_{13}) \\mathrm{sgn}(x_1-x_3) \\right]$$\nGiven $x_1<x_2$ and $x_1<x_3$, we have $\\mathrm{sgn}(x_1-x_2)=-1$ and $\\mathrm{sgn}(x_1-x_3)=-1$.\n$$F_{1x} = -2ab \\left[ \\exp(-b r_{12}) + \\exp(-b r_{13}) \\right]$$\nSubstituting values $2ab = 2(0.25)(1.0) = 0.5\\,\\mathrm{eV}/\\mathrm{\\AA}$:\n$$F_{1x} = -0.5 (\\exp(-2.0) + \\exp(-3.5)) \\approx -0.5(0.135335 + 0.030197) \\approx -0.082766\\,\\mathrm{eV}/\\mathrm{\\AA}$$\nRounding to four significant figures, $F_{1x} \\approx -0.08277\\,\\mathrm{eV}/\\mathrm{\\AA}$.\n\nForce on atom $2$, $F_{2x}$:\n$$F_{2x} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_2} = -2a \\left[ -b \\exp(-b r_{12})(-\\mathrm{sgn}(x_1-x_2)) -b \\exp(-b r_{23})\\mathrm{sgn}(x_2-x_3) \\right]$$\nSince $\\mathrm{sgn}(x_1-x_2) = -1$ and $\\mathrm{sgn}(x_2-x_3)=-1$:\n$$F_{2x} = 2ab \\left[ \\exp(-b r_{12}) - \\exp(-b r_{23}) \\right]$$\n$$F_{2x} = 0.5 (\\exp(-2.0) - \\exp(-1.5)) \\approx 0.5(0.135335 - 0.223130) \\approx -0.0438975\\,\\mathrm{eV}/\\mathrm{\\AA}$$\nRounding to four significant figures, $F_{2x} \\approx -0.04390\\,\\mathrm{eV}/\\mathrm{\\AA}$.\n\nForce on atom $3$, $F_{3x}$:\n$$F_{3x} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_3} = -2a \\left[ -b \\exp(-b r_{13})(-\\mathrm{sgn}(x_1-x_3)) -b \\exp(-b r_{23})(-\\mathrm{sgn}(x_2-x_3)) \\right]$$\nSince $\\mathrm{sgn}(x_1-x_3) = -1$ and $\\mathrm{sgn}(x_2-x_3) = -1$:\n$$F_{3x} = 2ab \\left[ \\exp(-b r_{13}) + \\exp(-b r_{23}) \\right]$$\n$$F_{3x} = 0.5 (\\exp(-3.5) + \\exp(-1.5)) \\approx 0.5(0.030197 + 0.223130) \\approx 0.1266635\\,\\mathrm{eV}/\\mathrm{\\AA}$$\nRounding to four significant figures, $F_{3x} \\approx 0.1267\\,\\mathrm{eV}/\\mathrm{\\AA}$.\n\nAs a check, the sum of internal forces on a closed system must be zero: $F_{1x} + F_{2x} + F_{3x} \\approx -0.08277 - 0.04390 + 0.1267 = 0.00003$, which is zero within rounding error. Our analytical derivation confirms the exact sum is zero.",
            "answer": "$$\n\\boxed{\nE_{\\mathrm{tot}} = 0.1943\\,\\mathrm{eV}, \\quad F_{1x} = -0.08277\\,\\mathrm{eV}/\\mathrm{\\AA}, \\quad F_{2x} = -0.04390\\,\\mathrm{eV}/\\mathrm{\\AA}, \\quad F_{3x} = 0.1267\\,\\mathrm{eV}/\\mathrm{\\AA}\n}\n$$"
        },
        {
            "introduction": "At the heart of a Machine Learning Interatomic Potential (MLIP) is a neural network that maps local atomic environment descriptors to energy. This practice problem models a minimal atomic neural network, guiding you through the process of calculating energy and forces for a simple atomic configuration . This hands-on task illuminates the \"forward pass\" to get energy and, more importantly, the \"backward pass\" via the chain rule—the principle behind automatic differentiation—to derive forces, a cornerstone of training and using MLIPs in simulations.",
            "id": "3822094",
            "problem": "In multiscale materials simulation, Machine Learning (ML) interatomic potentials represent a system’s potential energy as a sum of per-atom energy contributions obtained from a learned mapping between symmetry-preserving descriptors and scalar energies. Forces follow from the negative gradient of the total energy with respect to atomic coordinates. Consider a minimal two-layer atomic neural network with quadratic activation that maps local, rotationally and translationally invariant descriptors built from pairwise distances to per-atom energies. Three atoms lie in a two-dimensional plane at positions $\\mathbf{r}_1 = (0, 0)$, $\\mathbf{r}_2 = (1, 0)$, and $\\mathbf{r}_3 = (0, 1)$. Let $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ denote the Euclidean distance between atoms $i$ and $j$. For each atom $i$, define the two scalar descriptors\n$$\ns_i = \\sum_{j \\neq i} r_{ij}, \\qquad t_i = \\sum_{j \\neq i} r_{ij}^{2}.\n$$\nThe atomic network has two hidden units with preactivations\n$$\nz_{i1} = w_{11}\\, s_i + w_{12}\\, t_i + b_1,\\qquad z_{i2} = w_{21}\\, s_i + w_{22}\\, t_i + b_2,\n$$\na pointwise activation $\\phi(x) = x^{2}$ applied to each hidden unit, and a scalar output per-atom energy\n$$\ne_i = v_1\\, \\phi(z_{i1}) + v_2\\, \\phi(z_{i2}) + b.\n$$\nThe total energy is $E = \\sum_{i=1}^{3} e_i$. Use the principle that forces are given by the negative gradient of the energy, $ \\mathbf{F}_i = - \\nabla_{\\mathbf{r}_i} E$, and carry out the differentiation through the descriptors using the chain rule as in Automatic Differentiation (AD). The network parameters are\n$$\nw_{11} = 1,\\quad w_{12} = -1,\\quad b_1 = 0,\\qquad w_{21} = 2,\\quad w_{22} = 1,\\quad b_2 = -1,\\\\\nv_1 = \\frac{1}{2},\\quad v_2 = -\\frac{1}{4},\\quad b = 0.\n$$\nAll quantities are dimensionless. Compute the total energy $E$ for the given three-atom configuration and the forces $\\mathbf{F}_1$, $\\mathbf{F}_2$, and $\\mathbf{F}_3$. Express your final answer as a single row matrix in the order\n$$\n\\left(E,\\; F_{1x},\\; F_{1y},\\; F_{2x},\\; F_{2y},\\; F_{3x},\\; F_{3y}\\right),\n$$\nusing exact values and no rounding.",
            "solution": "The force on an atom is the negative gradient of the potential energy with respect to its position, $\\mathbf{F}_i = - \\nabla_{\\mathbf{r}_i} E$. To compute this, we use the chain rule, propagating derivatives from the total energy $E$ back to the atomic coordinates $\\mathbf{r}_i$.\n\n**Step 1: Compute pairwise distances and descriptors.**\nFor atom positions $\\mathbf{r}_1 = (0, 0)$, $\\mathbf{r}_2 = (1, 0)$, and $\\mathbf{r}_3 = (0, 1)$, the distances are:\n$$\nr_{12} = \\| (0,0) - (1,0)\\| = 1,\\quad r_{13} = \\|(0,0) - (0,1)\\| = 1,\\quad r_{23} = \\|(1,0) - (0,1)\\| = \\sqrt{2}.\n$$\nThe descriptors for each atom are:\n$$\ns_1 = r_{12} + r_{13} = 1 + 1 = 2,\\qquad t_1 = r_{12}^{2} + r_{13}^{2} = 1^2 + 1^2 = 2,\\\\\ns_2 = r_{21} + r_{23} = 1 + \\sqrt{2},\\qquad t_2 = r_{21}^{2} + r_{23}^{2} = 1^2 + (\\sqrt{2})^2 = 3,\\\\\ns_3 = r_{31} + r_{32} = 1 + \\sqrt{2},\\qquad t_3 = r_{31}^{2} + r_{32}^{2} = 1^2 + (\\sqrt{2})^2 = 3.\n$$\n\n**Step 2: Compute per-atom energies and total energy (Forward Pass).**\nThe per-atom energy is $e_i = \\frac{1}{2}(s_i - t_i)^{2} - \\frac{1}{4}(2 s_i + t_i - 1)^{2}$.\nFor atom 1 ($s_1=2, t_1=2$):\n$e_1 = \\frac{1}{2}(2 - 2)^{2} - \\frac{1}{4}(2 \\cdot 2 + 2 - 1)^{2} = 0 - \\frac{1}{4}(5)^2 = -\\frac{25}{4}.$\nFor atoms 2 and 3 ($s_2=s_3=1+\\sqrt{2}, t_2=t_3=3$):\n$s-t = (1+\\sqrt{2})-3 = \\sqrt{2}-2 \\implies (s-t)^2 = 2 - 4\\sqrt{2} + 4 = 6-4\\sqrt{2}.$\n$2s+t-1 = 2(1+\\sqrt{2})+3-1 = 4+2\\sqrt{2} \\implies (2s+t-1)^2 = 16+16\\sqrt{2}+8 = 24+16\\sqrt{2}.$\n$e_2 = e_3 = \\frac{1}{2}(6 - 4 \\sqrt{2}) - \\frac{1}{4}(24 + 16 \\sqrt{2}) = (3 - 2 \\sqrt{2}) - (6 + 4 \\sqrt{2}) = -3 - 6 \\sqrt{2}.$\nThe total energy is $E = e_1 + e_2 + e_3 = -\\frac{25}{4} + 2(-3 - 6 \\sqrt{2}) = -\\frac{49}{4} - 12 \\sqrt{2}.$\n\n**Step 3: Compute derivatives for the backward pass.**\nWe need the derivatives of the total energy with respect to the intermediate descriptors. By the chain rule, $\\frac{\\partial E}{\\partial r_{ij}} = \\sum_k \\frac{\\partial E}{\\partial e_k} \\frac{\\partial e_k}{\\partial r_{ij}}$. Since $E=\\sum e_k$, $\\frac{\\partial E}{\\partial e_k}=1$. A distance $r_{ij}$ affects $e_i$ and $e_j$.\n$$ \\frac{\\partial E}{\\partial r_{ij}} = \\frac{\\partial e_i}{\\partial r_{ij}} + \\frac{\\partial e_j}{\\partial r_{ij}} = \\left(\\frac{\\partial e_i}{\\partial s_i}\\frac{\\partial s_i}{\\partial r_{ij}} + \\frac{\\partial e_i}{\\partial t_i}\\frac{\\partial t_i}{\\partial r_{ij}}\\right) + \\left(\\frac{\\partial e_j}{\\partial s_j}\\frac{\\partial s_j}{\\partial r_{ij}} + \\frac{\\partial e_j}{\\partial t_j}\\frac{\\partial t_j}{\\partial r_{ij}}\\right) $$\nWith $\\frac{\\partial s_k}{\\partial r_{ij}} = 1$ and $\\frac{\\partial t_k}{\\partial r_{ij}} = 2r_{ij}$ (for $k \\in \\{i, j\\}$), this simplifies to:\n$$ \\frac{\\partial E}{\\partial r_{ij}} = \\left(\\frac{\\partial e_i}{\\partial s_i} + \\frac{\\partial e_j}{\\partial s_j}\\right) + 2 r_{ij} \\left(\\frac{\\partial e_i}{\\partial t_i} + \\frac{\\partial e_j}{\\partial t_j}\\right) $$\nThe partial derivatives of $e_i$ are:\n$$ \\frac{\\partial e_i}{\\partial s_i} = (s_i - t_i) - (2 s_i + t_i - 1) = -s_i - 2t_i + 1 $$\n$$ \\frac{\\partial e_i}{\\partial t_i} = -(s_i - t_i) - \\frac{1}{2}(2 s_i + t_i - 1) = -2s_i + \\frac{1}{2}t_i + \\frac{1}{2} $$\nEvaluating these at the descriptor values:\nFor atom 1: $\\frac{\\partial e_1}{\\partial s_1} = -2 - 4 + 1 = -5$, $\\quad \\frac{\\partial e_1}{\\partial t_1} = -4 + 1 + \\frac{1}{2} = -\\frac{5}{2}$.\nFor atoms 2 & 3: $\\frac{\\partial e_{2,3}}{\\partial s_{2,3}} = -(1+\\sqrt{2}) - 6 + 1 = -6-\\sqrt{2}$, $\\quad \\frac{\\partial e_{2,3}}{\\partial t_{2,3}} = -2(1+\\sqrt{2}) + \\frac{3}{2} + \\frac{1}{2} = -2\\sqrt{2}$.\n\nNow, compute $\\frac{\\partial E}{\\partial r_{ij}}$ for each pair:\n- Pair (1,2), $r_{12}=1$: $\\frac{\\partial E}{\\partial r_{12}} = (-5 - 6 - \\sqrt{2}) + 2(1)(-\\frac{5}{2} - 2\\sqrt{2}) = -11 - \\sqrt{2} - 5 - 4\\sqrt{2} = -16 - 5\\sqrt{2}.$\n- Pair (1,3), $r_{13}=1$: By symmetry, $\\frac{\\partial E}{\\partial r_{13}} = -16 - 5\\sqrt{2}.$\n- Pair (2,3), $r_{23}=\\sqrt{2}$: $\\frac{\\partial E}{\\partial r_{23}} = ((-6-\\sqrt{2}) + (-6-\\sqrt{2})) + 2\\sqrt{2}(-2\\sqrt{2} - 2\\sqrt{2}) = (-12-2\\sqrt{2}) + 2\\sqrt{2}(-4\\sqrt{2}) = -12 - 2\\sqrt{2} - 16 = -28 - 2\\sqrt{2}.$\n\n**Step 4: Compute forces.**\nThe force on atom $i$ is $\\mathbf{F}_i = - \\nabla_{\\mathbf{r}_i} E = - \\sum_{j \\neq i} \\frac{\\partial E}{\\partial r_{ij}} \\nabla_{\\mathbf{r}_i} r_{ij} = - \\sum_{j \\neq i} \\frac{\\partial E}{\\partial r_{ij}} \\frac{\\mathbf{r}_i - \\mathbf{r}_j}{r_{ij}}.$\n- $\\mathbf{F}_1 = - \\frac{\\partial E}{\\partial r_{12}} \\frac{(-1, 0)}{1} - \\frac{\\partial E}{\\partial r_{13}} \\frac{(0, -1)}{1} = (\\frac{\\partial E}{\\partial r_{12}}, \\frac{\\partial E}{\\partial r_{13}}) = (-16 - 5\\sqrt{2}, -16 - 5\\sqrt{2}).$\n- $\\mathbf{F}_2 = - \\frac{\\partial E}{\\partial r_{12}} \\frac{(1, 0)}{1} - \\frac{\\partial E}{\\partial r_{23}} \\frac{(1, -1)}{\\sqrt{2}} = (-\\frac{\\partial E}{\\partial r_{12}} - \\frac{1}{\\sqrt{2}}\\frac{\\partial E}{\\partial r_{23}}, \\frac{1}{\\sqrt{2}}\\frac{\\partial E}{\\partial r_{23}}).$\n$F_{2x} = -(-16 - 5\\sqrt{2}) - \\frac{1}{\\sqrt{2}}(-28 - 2\\sqrt{2}) = 16 + 5\\sqrt{2} + 14\\sqrt{2} + 2 = 18 + 19\\sqrt{2}.$\n$F_{2y} = \\frac{1}{\\sqrt{2}}(-28 - 2\\sqrt{2}) = -14\\sqrt{2} - 2.$\nSo $\\mathbf{F}_2 = (18 + 19\\sqrt{2}, -2 - 14\\sqrt{2}).$\n- $\\mathbf{F}_3 = - \\frac{\\partial E}{\\partial r_{13}} \\frac{(0, 1)}{1} - \\frac{\\partial E}{\\partial r_{23}} \\frac{(-1, 1)}{\\sqrt{2}} = (\\frac{1}{\\sqrt{2}}\\frac{\\partial E}{\\partial r_{23}}, -\\frac{\\partial E}{\\partial r_{13}} - \\frac{1}{\\sqrt{2}}\\frac{\\partial E}{\\partial r_{23}}).$\n$F_{3x} = \\frac{1}{\\sqrt{2}}(-28 - 2\\sqrt{2}) = -14\\sqrt{2} - 2.$\n$F_{3y} = -(-16 - 5\\sqrt{2}) - \\frac{1}{\\sqrt{2}}(-28 - 2\\sqrt{2}) = 16 + 5\\sqrt{2} + 14\\sqrt{2} + 2 = 18 + 19\\sqrt{2}.$\nSo $\\mathbf{F}_3 = (-2 - 14\\sqrt{2}, 18 + 19\\sqrt{2}).$\nA check confirms $\\mathbf{F}_1 + \\mathbf{F}_2 + \\mathbf{F}_3 = \\mathbf{0}$.",
            "answer": "$$\\boxed{\\begin{pmatrix}-\\frac{49}{4}-12\\sqrt{2} & -16-5\\sqrt{2} & -16-5\\sqrt{2} & 18+19\\sqrt{2} & -2-14\\sqrt{2} & -2-14\\sqrt{2} & 18+19\\sqrt{2}\\end{pmatrix}}$$"
        },
        {
            "introduction": "A crucial requirement for any physical model of identical particles is permutation invariance: swapping the labels of two identical atoms should not change the system's energy. This coding exercise demonstrates the critical importance of enforcing this symmetry in an MLIP by asking you to build and compare a \"good\" (invariant) model with a \"bad\" (variant) one . By quantifying the artificial energy splitting caused by the flawed model, you will gain a practical appreciation for why symmetry-preserving architectures are non-negotiable for building reliable interatomic potentials.",
            "id": "3886545",
            "problem": "You are asked to formalize and quantify the consequences of violating permutation invariance among identical atoms in Machine Learning (ML) interatomic potentials within computational catalysis and chemical engineering. The goal is to construct a scenario in which index-dependent features cause artificial energy splitting and to quantify the resulting prediction errors against a physically grounded reference. Start from a physically motivated, permutation-invariant reference energy and use it to analyze a deliberately permutation-variant surrogate model. Your program must produce a single line containing the aggregated numerical results for a test suite of configurations in dimensionless reduced units, rounded to eight decimal places.\n\nFundamental base:\n- Identical atoms are indistinguishable in classical mechanics and quantum mechanics; the total energy must be invariant under any permutation of atom labels. Formally, if there are $N$ identical atoms and a configuration is described by the set of pairwise distances $\\{r_{ij}\\}$, any permutation $\\pi$ in the symmetric group $S_N$ of indices must satisfy $E(\\{r_{ij}\\}) = E(\\{r_{\\pi(i)\\pi(j)}\\})$.\n- A standard, well-tested pairwise energy function for nonbonded interactions is the Lennard-Jones (LJ) potential. In reduced units where the characteristic energy and length scales are set to unity, the total energy for a configuration is computed as\n$$\nE_{\\text{LJ}}(\\mathbf{R}) = \\sum_{1 \\leq i < j \\leq N} 4 \\varepsilon \\left[\\left(\\frac{\\sigma}{r_{ij}}\\right)^{12} - \\left(\\frac{\\sigma}{r_{ij}}\\right)^6\\right],\n$$\nwith $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$, $\\varepsilon$ and $\\sigma$ the energy and length scales, and where the sum over unordered pairs ensures permutation invariance. Use reduced units with $\\varepsilon = 1$ and $\\sigma = 1$, so that energies and distances are dimensionless.\n\nIndex-dependent surrogate model:\n- Define per-atom descriptors that depend on local distances,\n$$\nd_i = \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} \\exp\\left(-\\frac{r_{ij}}{\\sigma}\\right), \\quad e_i = \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} \\frac{r_{ij}}{\\sigma}.\n$$\n- Construct a deliberately permutation-variant surrogate energy by using index-dependent weights,\n$$\nE_{\\text{bad}}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left[a_i \\, d_i + b_i \\, e_i\\right],\n$$\nwhere $\\mathbf{a} = (a_1, \\dots, a_N)$ and $\\mathbf{b} = (b_1, \\dots, b_N)$ depend on the atom index. Under a permutation $\\pi \\in S_N$ of labels, the predicted energy becomes\n$$\nE_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left[a_{\\pi(i)} \\, d_i + b_{\\pi(i)} \\, e_i\\right],\n$$\nwhich can differ for identical atoms if the $d_i$ and $e_i$ are not all equal.\n- For comparison, construct a permutation-invariant surrogate with shared weights,\n$$\nE_{\\text{good}}(\\mathbf{R}; a, b) = \\sum_{i=1}^{N} \\left[a \\, d_i + b \\, e_i\\right].\n$$\n\nQuantities to compute per test case:\n- Artificial energy splitting magnitude across a set of label permutations $\\mathcal{P}$,\n$$\n\\Delta_{\\text{split}} = \\max_{\\pi \\in \\mathcal{P}} E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) - \\min_{\\pi \\in \\mathcal{P}} E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}).\n$$\n- Maximum absolute prediction error of the index-dependent model across $\\mathcal{P}$, relative to the LJ energy,\n$$\n\\text{Err}_{\\text{bad,max}} = \\max_{\\pi \\in \\mathcal{P}} \\left|E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) - E_{\\text{LJ}}(\\mathbf{R})\\right|.\n$$\n- Absolute prediction error of the permutation-invariant surrogate (shared weights),\n$$\n\\text{Err}_{\\text{good}} = \\left|E_{\\text{good}}(\\mathbf{R}; a, b) - E_{\\text{LJ}}(\\mathbf{R})\\right|.\n$$\n\nAngle units are irrelevant because only distances are used. All energies and distances must be expressed in dimensionless reduced units with $\\varepsilon = 1$ and $\\sigma = 1$. Round all outputs to eight decimal places.\n\nTest suite:\n- Use the following four configuration cases. Coordinates are given as Cartesian positions in $3$-dimensional space, in reduced units. Use $\\varepsilon = 1$ and $\\sigma = 1$. For each case, apply the set of permutations $\\mathcal{P}$ consisting of the identity and the reverse-index permutation. Shared weights are $a = 0.9$, $b = -0.15$.\n\nCase $1$ (non-symmetric linear triatomic, happy path):\n- $N = 3$,\n- positions: $\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.2, 0.0, 0.0\\right)$, $\\left(2.5, 0.0, 0.0\\right)$,\n- index-dependent weights: $\\mathbf{a} = (0.8, 1.4, 0.5)$, $\\mathbf{b} = (-0.3, 0.2, 0.1)$.\n\nCase $2$ (equilateral triangle, symmetry boundary condition):\n- $N = 3$,\n- side length: $L = 1.6$,\n- positions: $\\left(0.0, 0.0, 0.0\\right)$, $\\left(L, 0.0, 0.0\\right)$, $\\left(\\frac{L}{2}, \\frac{\\sqrt{3}}{2} L, 0.0\\right)$,\n- index-dependent weights: $\\mathbf{a} = (0.8, 1.4, 0.5)$, $\\mathbf{b} = (-0.3, 0.2, 0.1)$.\n\nCase $3$ (diatomic pair, edge case):\n- $N = 2$,\n- positions: $\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.1, 0.0, 0.0\\right)$,\n- index-dependent weights: $\\mathbf{a} = (1.2, 0.7)$, $\\mathbf{b} = (-0.25, 0.05)$.\n\nCase $4$ (four atoms in a non-symmetric rectangular layout):\n- $N = 4$,\n- positions: $\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.4, 0.0, 0.0\\right)$, $\\left(0.0, 2.2, 0.0\\right)$, $\\left(2.1, 2.3, 0.0\\right)$,\n- index-dependent weights: $\\mathbf{a} = (0.7, 1.1, 0.6, 1.5)$, $\\mathbf{b} = (-0.2, 0.25, -0.05, 0.3)$.\n\nRequired final output format:\n- For each case, compute the triple $\\left[\\Delta_{\\text{split}}, \\text{Err}_{\\text{bad,max}}, \\text{Err}_{\\text{good}}\\right]$ as floats. Your program should produce a single line of output containing the list of these per-case triples, rounded to eight decimal places, as a comma-separated list of Python-style lists enclosed in square brackets, for example, $\\left[[x_1,y_1,z_1],[x_2,y_2,z_2],\\dots\\right]$.",
            "solution": "The solution requires implementing the functions for the reference Lennard-Jones (LJ) energy, the \"good\" permutation-invariant surrogate model, and the \"bad\" index-dependent surrogate model. For each test case, we perform the following steps:\n1.  Calculate the matrix of all pairwise distances $r_{ij}$ from the input coordinates.\n2.  Compute the reference energy $E_{\\text{LJ}}$ by summing the LJ potential over all unique pairs of atoms.\n3.  Calculate the per-atom descriptors $d_i$ and $e_i$ for each atom.\n4.  Evaluate the energy of the \"bad\" model for two label permutations: the identity permutation ($\\pi_{id}$) and the reverse-index permutation ($\\pi_{rev}$). This gives $E_{\\text{bad}}^{(\\pi_{id})}$ and $E_{\\text{bad}}^{(\\pi_{rev})}$.\n5.  Compute the energy splitting $\\Delta_{\\text{split}}$ as the difference between the maximum and minimum energies from the \"bad\" model's predictions. For symmetric configurations where all atomic environments are identical, this splitting will be zero.\n6.  Evaluate the \"good\" model's energy, $E_{\\text{good}}$, which is invariant to permutations.\n7.  Calculate the final metrics: $\\Delta_{\\text{split}}$, the maximum error of the bad model $\\text{Err}_{\\text{bad,max}}$, and the error of the good model $\\text{Err}_{\\text{good}}$.\n\nA Python script that implements these steps is provided below.\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes metrics for permutation variance in ML interatomic potentials.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {   # Case 1\n            \"N\": 3,\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], \n                [1.2, 0.0, 0.0], \n                [2.5, 0.0, 0.0]\n            ]),\n            \"a_bad\": np.array([0.8, 1.4, 0.5]),\n            \"b_bad\": np.array([-0.3, 0.2, 0.1]),\n        },\n        {   # Case 2\n            \"N\": 3,\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], \n                [1.6, 0.0, 0.0], \n                [1.6/2, np.sqrt(3)/2 * 1.6, 0.0]\n            ]),\n            \"a_bad\": np.array([0.8, 1.4, 0.5]),\n            \"b_bad\": np.array([-0.3, 0.2, 0.1]),\n        },\n        {   # Case 3\n            \"N\": 2,\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], \n                [1.1, 0.0, 0.0]\n            ]),\n            \"a_bad\": np.array([1.2, 0.7]),\n            \"b_bad\": np.array([-0.25, 0.05]),\n        },\n        {   # Case 4\n            \"N\": 4,\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], \n                [1.4, 0.0, 0.0], \n                [0.0, 2.2, 0.0], \n                [2.1, 2.3, 0.0]\n            ]),\n            \"a_bad\": np.array([0.7, 1.1, 0.6, 1.5]),\n            \"b_bad\": np.array([-0.2, 0.25, -0.05, 0.3]),\n        },\n    ]\n\n    # Shared parameters\n    a_good = 0.9\n    b_good = -0.15\n    epsilon = 1.0\n    sigma = 1.0\n    \n    final_results = []\n\n    for case in test_cases:\n        N = case[\"N\"]\n        positions = case[\"positions\"]\n        a_bad = case[\"a_bad\"]\n        b_bad = case[\"b_bad\"]\n\n        # 1. Calculate the distance matrix\n        dist_matrix = np.zeros((N, N))\n        if N > 1:\n            for i in range(N):\n                for j in range(i + 1, N):\n                    dist = np.linalg.norm(positions[i] - positions[j])\n                    dist_matrix[i, j] = dist\n                    dist_matrix[j, i] = dist\n\n        # 2. Calculate Lennard-Jones reference energy (E_LJ)\n        e_lj = 0.0\n        if N > 1:\n            # np.triu_indices gives upper triangle indices to sum over pairs once\n            i_upper, j_upper = np.triu_indices(N, k=1)\n            r_ij = dist_matrix[i_upper, j_upper]\n            \n            # Filter out zero distances to prevent division by zero\n            r_ij_nonzero = r_ij[r_ij > 0]\n            if r_ij_nonzero.size > 0:\n                inv_r6 = (sigma / r_ij_nonzero)**6\n                inv_r12 = inv_r6**2\n                e_lj = np.sum(4 * epsilon * (inv_r12 - inv_r6))\n\n        # 3. Calculate per-atom descriptors\n        d = np.zeros(N)\n        e = np.zeros(N)\n        if N > 1:\n            for i in range(N):\n                # Distances from atom i to all other atoms j\n                r_i_others = dist_matrix[i, np.arange(N) != i]\n                d[i] = np.sum(np.exp(-r_i_others / sigma))\n                e[i] = np.sum(r_i_others / sigma)\n\n        # 4. Calculate E_bad for identity and reverse permutations\n        # Identity permutation\n        e_bad_id = np.sum(a_bad * d + b_bad * e)\n\n        # Reverse-index permutation\n        pi_rev_indices = np.arange(N - 1, -1, -1)\n        a_bad_rev = a_bad[pi_rev_indices]\n        b_bad_rev = b_bad[pi_rev_indices]\n        e_bad_rev = np.sum(a_bad_rev * d + b_bad_rev * e)\n        \n        e_bad_energies = np.array([e_bad_id, e_bad_rev])\n\n        # 5. Calculate artificial energy splitting (Delta_split)\n        delta_split = np.max(e_bad_energies) - np.min(e_bad_energies)\n\n        # 6. Calculate maximum absolute prediction error for E_bad\n        err_bad_max = np.max(np.abs(e_bad_energies - e_lj))\n\n        # 7. Calculate error for the permutation-invariant model (E_good)\n        e_good = a_good * np.sum(d) + b_good * np.sum(e)\n        err_good = np.abs(e_good - e_lj)\n\n        final_results.append([delta_split, err_bad_max, err_good])\n    \n    return final_results\n\n# The problem requires the program to *produce* the output.\n# The code above calculates the results. Here we format and present the final answer.\nresults = solve()\nresult_strings = []\nfor res in results:\n    sublist_str = f\"[{res[0]:.8f},{res[1]:.8f},{res[2]:.8f}]\"\n    result_strings.append(sublist_str)\nfinal_output_str = f\"[{','.join(result_strings)}]\"\n# The string below is the output produced by the code.\n# print(final_output_str)\n\n```",
            "answer": "[[0.13943617,1.56953372,0.24636657],[0.00000000,0.59666014,0.30129061],[0.00000000,0.73887019,0.31505318],[0.99222625,1.95475306,0.37050541]]"
        }
    ]
}