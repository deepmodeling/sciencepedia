{
    "hands_on_practices": [
        {
            "introduction": "At the heart of any atomistic simulation lies the calculation of the system's total energy and the resulting forces on each atom. This first exercise provides direct, hands-on practice with these fundamental computations using a simplified potential energy function. By working through this problem , you will solidify your understanding of how a total energy, constructed from local atomic contributions, directly yields the forces through the principle of $\\mathbf{F}_k = -\\nabla_{\\mathbf{R}_k} E_{\\mathrm{tot}}$, a cornerstone of molecular dynamics.",
            "id": "3822117",
            "problem": "Consider a one-dimensional three-atom configuration used to illustrate a simple Machine Learning Interatomic Potential (MLIP). The per-atom energy is defined by\n$$\\varepsilon(\\mathcal{N}_i)=\\sum_{j\\in \\mathcal{N}_i} a \\exp(-b r_{ij})$$,\nwhere $r_{ij}$ is the Euclidean distance between atoms $i$ and $j$, $a$ and $b$ are positive constants, and $\\mathcal{N}_i$ is the neighbor set of atom $i$ containing all other atoms. The total energy of the system is the sum of per-atom energies over all atoms. The classical force on atom $k$ is defined as $\\mathbf{F}_k=-\\nabla_{\\mathbf{R}_k} E_{\\mathrm{tot}}$, where $\\mathbf{R}_k$ is the position of atom $k$ and $E_{\\mathrm{tot}}$ is the total energy.\n\nTake three atoms placed collinearly along the $x$-axis with positions $x_1=0\\,\\mathrm{\\AA}$, $x_2=2.0\\,\\mathrm{\\AA}$, and $x_3=3.5\\,\\mathrm{\\AA}$. Use parameters $a=0.25\\,\\mathrm{eV}$ and $b=1.0\\,\\mathrm{\\AA}^{-1}$. Assume $\\mathcal{N}_i=\\{j\\neq i\\}$ (that is, all other atoms are neighbors), and neglect any boundary conditions.\n\nCompute the total energy $E_{\\mathrm{tot}}$ and the forces on each atom along the $x$-direction, $F_{1x}$, $F_{2x}$, and $F_{3x}$. Express the final energy in electronvolts (eV) and the forces in electronvolts per ångström ($\\mathrm{eV}/\\mathrm{\\AA}$). Round your final numerical values to four significant figures.",
            "solution": "The user wants me to solve a physics problem.\n\n### Step 1: Extract Givens\n- Per-atom energy for atom $i$: $\\varepsilon(\\mathcal{N}_i)=\\sum_{j\\in \\mathcal{N}_i} a \\exp(-b r_{ij})$\n- Total energy of the system: $E_{\\mathrm{tot}}=\\sum_{i} \\varepsilon(\\mathcal{N}_i)$\n- Force on atom $k$: $\\mathbf{F}_k=-\\nabla_{\\mathbf{R}_k} E_{\\mathrm{tot}}$\n- Number of atoms: $3$\n- Positions of atoms along the $x$-axis: $x_1=0\\,\\mathrm{\\AA}$, $x_2=2.0\\,\\mathrm{\\AA}$, $x_3=3.5\\,\\mathrm{\\AA}$\n- Parameter $a$: $0.25\\,\\mathrm{eV}$\n- Parameter $b$: $1.0\\,\\mathrm{\\AA}^{-1}$\n- Neighbor set definition: $\\mathcal{N}_i=\\{j\\neq i\\}$\n- The problem is one-dimensional.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem uses a simplified, but physically plausible, form for an interatomic potential energy, reminiscent of the repulsive part of potentials like the Born-Mayer potential or components used in machine learning potentials (e.g., Behler-Parrinello symmetry functions). The definition of force as the negative gradient of the potential energy is a fundamental principle of classical mechanics. The setup is a standard toy model for computational materials science.\n- **Well-Posed**: The problem provides all necessary information (positions, functional form of energy, parameters) to compute a unique set of values for the total energy and forces. The solution is stable with respect to small changes in the inputs.\n- **Objective**: The problem is stated using precise mathematical definitions and objective numerical data. There are no subjective or ambiguous terms.\n- **Conclusion**: The problem is scientifically sound, well-posed, objective, and contains no internal contradictions or missing information. It is therefore valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will now proceed with providing a complete and reasoned solution.\n\n### Solution\n\nThe total energy of the three-atom system is the sum of the per-atom energies for atoms $1$, $2$, and $3$.\n$$E_{\\mathrm{tot}} = \\varepsilon_1 + \\varepsilon_2 + \\varepsilon_3$$\nThe per-atom energy for atom $i$ is $\\varepsilon_i = \\sum_{j \\neq i} a \\exp(-b r_{ij})$.\n- For atom $1$, $\\varepsilon_1 = a \\exp(-b r_{12}) + a \\exp(-b r_{13})$.\n- For atom $2$, $\\varepsilon_2 = a \\exp(-b r_{21}) + a \\exp(-b r_{23})$.\n- For atom $3$, $\\varepsilon_3 = a \\exp(-b r_{31}) + a \\exp(-b r_{32})$.\n\nSince the distance $r_{ij} = r_{ji}$, the total energy is:\n$$E_{\\mathrm{tot}} = (a \\exp(-b r_{12}) + a \\exp(-b r_{13})) + (a \\exp(-b r_{12}) + a \\exp(-b r_{23})) + (a \\exp(-b r_{13}) + a \\exp(-b r_{23}))$$\n$$E_{\\mathrm{tot}} = 2a (\\exp(-b r_{12}) + \\exp(-b r_{13}) + \\exp(-b r_{23}))$$\nThis form correctly accounts for the contribution of each pair of atoms to the energy of both atoms in the pair.\n\nFirst, we calculate the pairwise distances $r_{ij} = |x_i - x_j|$ from the given positions $x_1=0\\,\\mathrm{\\AA}$, $x_2=2.0\\,\\mathrm{\\AA}$, and $x_3=3.5\\,\\mathrm{\\AA}$.\n$$r_{12} = |x_1 - x_2| = |0 - 2.0| = 2.0\\,\\mathrm{\\AA}$$\n$$r_{13} = |x_1 - x_3| = |0 - 3.5| = 3.5\\,\\mathrm{\\AA}$$\n$$r_{23} = |x_2 - x_3| = |2.0 - 3.5| = 1.5\\,\\mathrm{\\AA}$$\n\nNow, we can compute the total energy $E_{\\mathrm{tot}}$ using the given parameters $a=0.25\\,\\mathrm{eV}$ and $b=1.0\\,\\mathrm{\\AA}^{-1}$.\n$$E_{\\mathrm{tot}} = 2(0.25\\,\\mathrm{eV}) (\\exp(-1.0 \\times 2.0) + \\exp(-1.0 \\times 3.5) + \\exp(-1.0 \\times 1.5))$$\n$$E_{\\mathrm{tot}} = 0.5 (\\exp(-2.0) + \\exp(-3.5) + \\exp(-1.5))\\,\\mathrm{eV}$$\nUsing a calculator for the exponential terms:\n$$E_{\\mathrm{tot}} \\approx 0.5 (0.135335 + 0.030197 + 0.223130)\\,\\mathrm{eV}$$\n$$E_{\\mathrm{tot}} \\approx 0.5 (0.388662)\\,\\mathrm{eV} \\approx 0.194331\\,\\mathrm{eV}$$\nRounding to four significant figures, $E_{\\mathrm{tot}} \\approx 0.1943\\,\\mathrm{eV}$.\n\nNext, we calculate the forces. Since the system is one-dimensional, the force on atom $k$ is $F_{kx} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_k}$. The total energy expressed in terms of coordinates is:\n$$E_{\\mathrm{tot}} = 2a (\\exp(-b|x_1-x_2|) + \\exp(-b|x_1-x_3|) + \\exp(-b|x_2-x_3|))$$\nWe use the chain rule and the fact that $\\frac{d|u|}{du} = \\mathrm{sgn}(u)$ for $u \\neq 0$:\n$\\frac{\\partial}{\\partial x_k} \\exp(-b|x_i-x_j|) = -b \\exp(-b|x_i-x_j|) \\frac{\\partial|x_i-x_j|}{\\partial x_k}$.\nThe derivative of the absolute value term is:\n$\\frac{\\partial|x_i-x_j|}{\\partial x_k} = \\begin{cases} \\mathrm{sgn}(x_i-x_j) & \\text{if } k=i \\\\ -\\mathrm{sgn}(x_i-x_j) & \\text{if } k=j \\\\ 0 & \\text{if } k \\neq i,j \\end{cases}$\n\nForce on atom $1$, $F_{1x}$:\n$$F_{1x} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_1} = -2a \\left[ \\frac{\\partial}{\\partial x_1}\\exp(-b|x_1-x_2|) + \\frac{\\partial}{\\partial x_1}\\exp(-b|x_1-x_3|) \\right]$$\n$$F_{1x} = -2a \\left[ -b \\exp(-b r_{12}) \\mathrm{sgn}(x_1-x_2) -b \\exp(-b r_{13}) \\mathrm{sgn}(x_1-x_3) \\right]$$\n$$F_{1x} = 2ab \\left[ \\mathrm{sgn}(x_1-x_2) \\exp(-b r_{12}) + \\mathrm{sgn}(x_1-x_3) \\exp(-b r_{13}) \\right]$$\nGiven $x_1<x_2$ and $x_1<x_3$, we have $\\mathrm{sgn}(x_1-x_2)=-1$ and $\\mathrm{sgn}(x_1-x_3)=-1$.\n$$F_{1x} = 2ab \\left[ -\\exp(-b r_{12}) - \\exp(-b r_{13}) \\right]$$\nSubstituting values $2ab = 2(0.25)(1.0) = 0.5\\,\\mathrm{eV}/\\mathrm{\\AA}$:\n$$F_{1x} = -0.5 (\\exp(-2.0) + \\exp(-3.5)) \\approx -0.5(0.135335 + 0.030197) \\approx -0.5(0.165532) \\approx -0.082766\\,\\mathrm{eV}/\\mathrm{\\AA}$$\nRounding to four significant figures, $F_{1x} \\approx -0.08277\\,\\mathrm{eV}/\\mathrm{\\AA}$.\n\nForce on atom $2$, $F_{2x}$:\n$$F_{2x} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_2} = -2a \\left[ \\frac{\\partial}{\\partial x_2}\\exp(-b|x_1-x_2|) + \\frac{\\partial}{\\partial x_2}\\exp(-b|x_2-x_3|) \\right]$$\n$$F_{2x} = -2a \\left[ -b \\exp(-b r_{12})(-\\mathrm{sgn}(x_1-x_2)) -b \\exp(-b r_{23})\\mathrm{sgn}(x_2-x_3) \\right]$$\nSince $\\mathrm{sgn}(x_1-x_2) = -1$, $-\\mathrm{sgn}(x_1-x_2) = 1$. Since $x_2<x_3$, $\\mathrm{sgn}(x_2-x_3)=-1$.\n$$F_{2x} = 2ab \\left[ \\exp(-b r_{12}) - \\exp(-b r_{23}) \\right]$$\n$$F_{2x} = 0.5 (\\exp(-2.0) - \\exp(-1.5)) \\approx 0.5(0.135335 - 0.223130) \\approx 0.5(-0.087795) \\approx -0.0438975\\,\\mathrm{eV}/\\mathrm{\\AA}$$\nRounding to four significant figures, $F_{2x} \\approx -0.04390\\,\\mathrm{eV}/\\mathrm{\\AA}$.\n\nForce on atom $3$, $F_{3x}$:\n$$F_{3x} = -\\frac{\\partial E_{\\mathrm{tot}}}{\\partial x_3} = -2a \\left[ \\frac{\\partial}{\\partial x_3}\\exp(-b|x_1-x_3|) + \\frac{\\partial}{\\partial x_3}\\exp(-b|x_2-x_3|) \\right]$$\n$$F_{3x} = -2a \\left[ -b \\exp(-b r_{13})(-\\mathrm{sgn}(x_1-x_3)) -b \\exp(-b r_{23})(-\\mathrm{sgn}(x_2-x_3)) \\right]$$\nSince $\\mathrm{sgn}(x_1-x_3) = -1$ and $\\mathrm{sgn}(x_2-x_3) = -1$:\n$$F_{3x} = 2ab \\left[ \\exp(-b r_{13}) + \\exp(-b r_{23}) \\right]$$\n$$F_{3x} = 0.5 (\\exp(-3.5) + \\exp(-1.5)) \\approx 0.5(0.030197 + 0.223130) \\approx 0.5(0.253327) \\approx 0.1266635\\,\\mathrm{eV}/\\mathrm{\\AA}$$\nRounding to four significant figures, $F_{3x} \\approx 0.1267\\,\\mathrm{eV}/\\mathrm{\\AA}$.\n\nAs a check, the sum of internal forces on a closed system must be zero.\n$F_{1x} + F_{2x} + F_{3x} = 2ab [-\\exp(-b r_{12}) - \\exp(-b r_{13})] + 2ab [\\exp(-b r_{12}) - \\exp(-b r_{23})] + 2ab [\\exp(-b r_{13}) + \\exp(-b r_{23})]$\nThe terms cancel out pairwise, so the sum is zero, confirming the consistency of our calculations.\nNumerically (before rounding): $-0.082766 - 0.0438975 + 0.1266635 = 0$.\n\nThe final results, rounded to four significant figures, are:\n- Total energy $E_{\\mathrm{tot}} = 0.1943\\,\\mathrm{eV}$\n- Force on atom 1, $F_{1x} = -0.08277\\,\\mathrm{eV}/\\mathrm{\\AA}$\n- Force on atom 2, $F_{2x} = -0.04390\\,\\mathrm{eV}/\\mathrm{\\AA}$\n- Force on atom 3, $F_{3x} = 0.1267\\,\\mathrm{eV}/\\mathrm{\\AA}$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1943 & -0.08277 & -0.04390 & 0.1267\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Modern Machine Learning Interatomic Potentials (MLIPs) advance beyond simple pairwise functions by mapping the complex local environment of each atom to its energy contribution. This is typically done using descriptors that numerically represent the environment and a neural network that learns the mapping. This exercise  demystifies this process by guiding you through a forward pass to compute energy and a backward pass using the chain rule—the principle behind automatic differentiation—to derive the corresponding atomic forces.",
            "id": "3822094",
            "problem": "In multiscale materials simulation, Machine Learning (ML) interatomic potentials represent a system’s potential energy as a sum of per-atom energy contributions obtained from a learned mapping between symmetry-preserving descriptors and scalar energies. Forces follow from the negative gradient of the total energy with respect to atomic coordinates. Consider a minimal two-layer atomic neural network with quadratic activation that maps local, rotationally and translationally invariant descriptors built from pairwise distances to per-atom energies. Three atoms lie in a two-dimensional plane at positions $\\mathbf{r}_1 = (0, 0)$, $\\mathbf{r}_2 = (1, 0)$, and $\\mathbf{r}_3 = (0, 1)$. Let $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ denote the Euclidean distance between atoms $i$ and $j$. For each atom $i$, define the two scalar descriptors\n$$\ns_i = \\sum_{j \\neq i} r_{ij}, \\qquad t_i = \\sum_{j \\neq i} r_{ij}^{2}.\n$$\nThe atomic network has two hidden units with preactivations\n$$\nz_{i1} = w_{11}\\, s_i + w_{12}\\, t_i + b_1,\\qquad z_{i2} = w_{21}\\, s_i + w_{22}\\, t_i + b_2,\n$$\na pointwise activation $\\phi(x) = x^{2}$ applied to each hidden unit, and a scalar output per-atom energy\n$$\ne_i = v_1\\, \\phi(z_{i1}) + v_2\\, \\phi(z_{i2}) + b.\n$$\nThe total energy is $E = \\sum_{i=1}^{3} e_i$. Use Newton’s second law in its potential form that forces are given by the negative gradient of the energy, $ \\mathbf{F}_i = - \\nabla_{\\mathbf{r}_i} E$, and carry out the differentiation through the descriptors using the chain rule as in Automatic Differentiation (AD). The network parameters are\n$$\nw_{11} = 1,\\quad w_{12} = -1,\\quad b_1 = 0,\\qquad w_{21} = 2,\\quad w_{22} = 1,\\quad b_2 = -1,\\\\\nv_1 = \\frac{1}{2},\\quad v_2 = -\\frac{1}{4},\\quad b = 0.\n$$\nAll quantities are dimensionless. Compute the total energy $E$ for the given three-atom configuration and the forces $\\mathbf{F}_1$, $\\mathbf{F}_2$, and $\\mathbf{F}_3$. Express your final answer as a single row matrix in the order\n$$\n\\left(E,\\; F_{1x},\\; F_{1y},\\; F_{2x},\\; F_{2y},\\; F_{3x},\\; F_{3y}\\right),\n$$\nusing exact values and no rounding.",
            "solution": "The fundamental base is that a conservative force is the negative gradient of the potential energy with respect to position, and that for any differentiable composition of functions, the chain rule gives the derivative of the composite. Specifically, for the total energy $E(\\{\\mathbf{r}_i\\})$,\n$$\n\\mathbf{F}_i = - \\nabla_{\\mathbf{r}_i} E.\n$$\nWith descriptors depending on pairwise distances, we will need $\\frac{\\partial r_{ij}}{\\partial \\mathbf{r}_i} = \\frac{\\mathbf{r}_i - \\mathbf{r}_j}{r_{ij}}$ for $i \\neq j$, which follows from $r_{ij} = \\sqrt{(\\mathbf{r}_i - \\mathbf{r}_j) \\cdot (\\mathbf{r}_i - \\mathbf{r}_j)}$ by direct differentiation.\n\nFirst compute the pairwise distances for $\\mathbf{r}_1 = (0, 0)$, $\\mathbf{r}_2 = (1, 0)$, and $\\mathbf{r}_3 = (0, 1)$:\n$$\nr_{12} = \\| (0,0) - (1,0)\\| = 1,\\quad r_{13} = \\|(0,0) - (0,1)\\| = 1,\\quad r_{23} = \\|(1,0) - (0,1)\\| = \\sqrt{2}.\n$$\nThe descriptors for each atom are\n$$\ns_1 = r_{12} + r_{13} = 1 + 1 = 2,\\qquad t_1 = r_{12}^{2} + r_{13}^{2} = 1 + 1 = 2,\\\\\ns_2 = r_{21} + r_{23} = 1 + \\sqrt{2},\\qquad t_2 = r_{21}^{2} + r_{23}^{2} = 1 + 2 = 3,\\\\\ns_3 = r_{31} + r_{32} = 1 + \\sqrt{2},\\qquad t_3 = r_{31}^{2} + r_{32}^{2} = 1 + 2 = 3.\n$$\nCompute the hidden preactivations and activated values. Using the given weights and biases,\n$$\nz_{i1} = 1 \\cdot s_i + (-1) \\cdot t_i + 0 = s_i - t_i,\\qquad \\phi(z_{i1}) = (s_i - t_i)^{2},\\\\\nz_{i2} = 2 \\cdot s_i + 1 \\cdot t_i - 1 = 2 s_i + t_i - 1,\\qquad \\phi(z_{i2}) = (2 s_i + t_i - 1)^{2}.\n$$\nPer-atom energy is\n$$\ne_i = \\frac{1}{2}(s_i - t_i)^{2} - \\frac{1}{4}(2 s_i + t_i - 1)^{2}.\n$$\nEvaluate $e_i$ for each atom:\nFor $i=1$, $s_1 = 2$, $t_1 = 2$, so\n$$\n(s_1 - t_1)^{2} = 0,\\qquad (2 s_1 + t_1 - 1)^{2} = (4 + 2 - 1)^{2} = 5^{2} = 25,\\\\\ne_1 = \\frac{1}{2} \\cdot 0 - \\frac{1}{4} \\cdot 25 = -\\frac{25}{4}.\n$$\nFor $i=2$, $s_2 = 1 + \\sqrt{2}$, $t_2 = 3$, so\n$$\n(s_2 - t_2)^{2} = (1 + \\sqrt{2} - 3)^{2} = (\\sqrt{2} - 2)^{2} = 2 - 4 \\sqrt{2} + 4 = 6 - 4 \\sqrt{2},\\\\\n(2 s_2 + t_2 - 1)^{2} = \\left(2(1 + \\sqrt{2}) + 3 - 1\\right)^{2} = (4 + 2 \\sqrt{2})^{2} = 24 + 16 \\sqrt{2},\\\\\ne_2 = \\frac{1}{2}(6 - 4 \\sqrt{2}) - \\frac{1}{4}(24 + 16 \\sqrt{2}) = 3 - 2 \\sqrt{2} - 6 - 4 \\sqrt{2} = -3 - 6 \\sqrt{2}.\n$$\nFor $i=3$, $s_3 = 1 + \\sqrt{2}$, $t_3 = 3$, giving the same values as for $i=2$,\n$$\ne_3 = -3 - 6 \\sqrt{2}.\n$$\nTherefore, the total energy is\n$$\nE = e_1 + e_2 + e_3 = -\\frac{25}{4} + \\left(-3 - 6 \\sqrt{2}\\right) + \\left(-3 - 6 \\sqrt{2}\\right) = -\\frac{49}{4} - 12 \\sqrt{2}.\n$$\nNext, derive the forces via differentiation. Since $e_i$ depends on $(s_i, t_i)$ and $s_i$ and $t_i$ depend on the distances $r_{ij}$, use the chain rule. Compute the partial derivatives $\\frac{\\partial e_i}{\\partial s_i}$ and $\\frac{\\partial e_i}{\\partial t_i}$ symbolically:\n$$\n\\frac{\\partial e_i}{\\partial s_i} = \\frac{1}{2} \\cdot 2 (s_i - t_i) \\cdot 1 \\;+\\; \\left(-\\frac{1}{4}\\right) \\cdot 2 (2 s_i + t_i - 1) \\cdot 2\n= (s_i - t_i) - (2 s_i + t_i - 1) = - s_i - 2 t_i + 1,\\\\\n\\frac{\\partial e_i}{\\partial t_i} = \\frac{1}{2} \\cdot 2 (s_i - t_i) \\cdot (-1) \\;+\\; \\left(-\\frac{1}{4}\\right) \\cdot 2 (2 s_i + t_i - 1) \\cdot 1\n= - (s_i - t_i) - \\frac{1}{2}(2 s_i + t_i - 1) = - 2 s_i + \\frac{1}{2} t_i + \\frac{1}{2}.\n$$\nFor a single pair $r_{ij}$, it contributes to $(s_i, t_i)$ and $(s_j, t_j)$, with\n$$\n\\frac{\\partial s_i}{\\partial r_{ij}} = 1,\\quad \\frac{\\partial t_i}{\\partial r_{ij}} = 2 r_{ij},\\qquad\n\\frac{\\partial s_j}{\\partial r_{ij}} = 1,\\quad \\frac{\\partial t_j}{\\partial r_{ij}} = 2 r_{ij}.\n$$\nThus\n$$\n\\frac{\\partial E}{\\partial r_{ij}} = \\frac{\\partial e_i}{\\partial s_i} \\cdot 1 + \\frac{\\partial e_i}{\\partial t_i} \\cdot 2 r_{ij} + \\frac{\\partial e_j}{\\partial s_j} \\cdot 1 + \\frac{\\partial e_j}{\\partial t_j} \\cdot 2 r_{ij}\n= \\left(\\frac{\\partial e_i}{\\partial s_i} + \\frac{\\partial e_j}{\\partial s_j}\\right) + \\left(\\frac{\\partial e_i}{\\partial t_i} + \\frac{\\partial e_j}{\\partial t_j}\\right) 2 r_{ij}.\n$$\nWe next evaluate $\\frac{\\partial e_i}{\\partial s_i}$ and $\\frac{\\partial e_i}{\\partial t_i}$ at the computed $(s_i, t_i)$. For $i=1$ with $s_1 = 2$, $t_1 = 2$,\n$$\n\\frac{\\partial e_1}{\\partial s_1} = -2 - 4 + 1 = -5,\\qquad \\frac{\\partial e_1}{\\partial t_1} = -4 + \\frac{1}{2}\\cdot 2 + \\frac{1}{2} = -\\frac{5}{2}.\n$$\nFor $i=2$ with $s_2 = 1 + \\sqrt{2}$, $t_2 = 3$,\n$$\n\\frac{\\partial e_2}{\\partial s_2} = - (1 + \\sqrt{2}) - 2 \\cdot 3 + 1 = - \\sqrt{2} - 6,\\\\\n\\frac{\\partial e_2}{\\partial t_2} = - 2 (1 + \\sqrt{2}) + \\frac{1}{2} \\cdot 3 + \\frac{1}{2} = - 2 \\sqrt{2}.\n$$\nFor $i=3$ with $s_3 = 1 + \\sqrt{2}$, $t_3 = 3$,\n$$\n\\frac{\\partial e_3}{\\partial s_3} = - \\sqrt{2} - 6,\\qquad \\frac{\\partial e_3}{\\partial t_3} = - 2 \\sqrt{2}.\n$$\nNow compute $\\frac{\\partial E}{\\partial r_{12}}$, $\\frac{\\partial E}{\\partial r_{13}}$, and $\\frac{\\partial E}{\\partial r_{23}}$:\nFor the pair $(1,2)$ with $r_{12} = 1$,\n$$\n\\frac{\\partial E}{\\partial r_{12}} = \\left(\\frac{\\partial e_1}{\\partial s_1} + \\frac{\\partial e_2}{\\partial s_2}\\right) + \\left(\\frac{\\partial e_1}{\\partial t_1} + \\frac{\\partial e_2}{\\partial t_2}\\right) 2 r_{12}\n= \\left(-5 + (- \\sqrt{2} - 6)\\right) + \\left(-\\frac{5}{2} - 2 \\sqrt{2}\\right) 2\\\\\n= \\left(-11 - \\sqrt{2}\\right) + \\left(-5 - 4 \\sqrt{2}\\right) = -16 - 5 \\sqrt{2}.\n$$\nFor the pair $(1,3)$ with $r_{13} = 1$,\n$$\n\\frac{\\partial E}{\\partial r_{13}} = \\left(\\frac{\\partial e_1}{\\partial s_1} + \\frac{\\partial e_3}{\\partial s_3}\\right) + \\left(\\frac{\\partial e_1}{\\partial t_1} + \\frac{\\partial e_3}{\\partial t_3}\\right) 2 r_{13}\\\\\n= \\left(-5 + (- \\sqrt{2} - 6)\\right) + \\left(-\\frac{5}{2} - 2 \\sqrt{2}\\right) 2 = -16 - 5 \\sqrt{2}.\n$$\nFor the pair $(2,3)$ with $r_{23} = \\sqrt{2}$,\n$$\n\\frac{\\partial E}{\\partial r_{23}} = \\left(\\frac{\\partial e_2}{\\partial s_2} + \\frac{\\partial e_3}{\\partial s_3}\\right) + \\left(\\frac{\\partial e_2}{\\partial t_2} + \\frac{\\partial e_3}{\\partial t_3}\\right) 2 r_{23}\\\\\n= \\left(- \\sqrt{2} - 6 + (- \\sqrt{2} - 6)\\right) + \\left(- 2 \\sqrt{2} - 2 \\sqrt{2}\\right) 2 \\sqrt{2}\\\\\n= \\left(- 2 \\sqrt{2} - 12\\right) + \\left(- 4 \\sqrt{2} \\cdot 2 \\sqrt{2}\\right) = - 2 \\sqrt{2} - 12 - 16 = - 2 \\sqrt{2} - 28.\n$$\nFinally, convert the derivatives with respect to distances into forces on coordinates using\n$$\n\\nabla_{\\mathbf{r}_i} r_{ij} = \\frac{\\mathbf{r}_i - \\mathbf{r}_j}{r_{ij}},\\qquad \\mathbf{F}_i = - \\sum_{j \\neq i} \\frac{\\partial E}{\\partial r_{ij}} \\frac{\\mathbf{r}_i - \\mathbf{r}_j}{r_{ij}}.\n$$\nCompute each force vector component.\n\nFor atom $1$,\n$$\n\\frac{\\mathbf{r}_1 - \\mathbf{r}_2}{r_{12}} = \\frac{(-1, 0)}{1} = (-1, 0),\\qquad\n\\frac{\\mathbf{r}_1 - \\mathbf{r}_3}{r_{13}} = \\frac{(0, -1)}{1} = (0, -1),\n$$\nso\n$$\n\\mathbf{F}_1 = - \\frac{\\partial E}{\\partial r_{12}} (-1, 0) - \\frac{\\partial E}{\\partial r_{13}} (0, -1) = \\left(\\frac{\\partial E}{\\partial r_{12}},\\; \\frac{\\partial E}{\\partial r_{13}}\\right) = \\left(-16 - 5 \\sqrt{2},\\; -16 - 5 \\sqrt{2}\\right).\n$$\nFor atom $2$,\n$$\n\\frac{\\mathbf{r}_2 - \\mathbf{r}_1}{r_{21}} = \\frac{(1, 0)}{1} = (1, 0),\\qquad\n\\frac{\\mathbf{r}_2 - \\mathbf{r}_3}{r_{23}} = \\frac{(1, -1)}{\\sqrt{2}},\n$$\nso\n$$\n\\mathbf{F}_2 = - \\frac{\\partial E}{\\partial r_{12}} (1, 0) - \\frac{\\partial E}{\\partial r_{23}} \\frac{(1, -1)}{\\sqrt{2}}\n= \\left(- \\frac{\\partial E}{\\partial r_{12}} - \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}},\\; \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}}\\right).\n$$\nSubstitute the exact values,\n$$\n- \\frac{\\partial E}{\\partial r_{12}} = 16 + 5 \\sqrt{2},\\qquad - \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}} = - \\frac{- 2 \\sqrt{2} - 28}{\\sqrt{2}} = 2 + 14 \\sqrt{2},\\qquad \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}} = - 2 - 14 \\sqrt{2},\n$$\ngiving\n$$\n\\mathbf{F}_2 = \\left(16 + 5 \\sqrt{2} + 2 + 14 \\sqrt{2},\\; - 2 - 14 \\sqrt{2}\\right) = \\left(18 + 19 \\sqrt{2},\\; - 2 - 14 \\sqrt{2}\\right).\n$$\nFor atom $3$,\n$$\n\\frac{\\mathbf{r}_3 - \\mathbf{r}_1}{r_{31}} = \\frac{(0, 1)}{1} = (0, 1),\\qquad\n\\frac{\\mathbf{r}_3 - \\mathbf{r}_2}{r_{32}} = \\frac{(-1, 1)}{\\sqrt{2}},\n$$\nso\n$$\n\\mathbf{F}_3 = - \\frac{\\partial E}{\\partial r_{13}} (0, 1) - \\frac{\\partial E}{\\partial r_{23}} \\frac{(-1, 1)}{\\sqrt{2}}\n= \\left(\\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}},\\; - \\frac{\\partial E}{\\partial r_{13}} - \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}}\\right).\n$$\nSubstitute the values,\n$$\n\\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}} = - 2 - 14 \\sqrt{2},\\qquad - \\frac{\\partial E}{\\partial r_{13}} = 16 + 5 \\sqrt{2},\\qquad - \\frac{1}{\\sqrt{2}} \\frac{\\partial E}{\\partial r_{23}} = 2 + 14 \\sqrt{2},\n$$\nto obtain\n$$\n\\mathbf{F}_3 = \\left(- 2 - 14 \\sqrt{2},\\; 16 + 5 \\sqrt{2} + 2 + 14 \\sqrt{2}\\right) = \\left(- 2 - 14 \\sqrt{2},\\; 18 + 19 \\sqrt{2}\\right).\n$$\nAs a consistency check, conservation of momentum implies $\\sum_{i=1}^{3} \\mathbf{F}_i = \\mathbf{0}$. Summing the $x$-components,\n$$\n\\left(-16 - 5 \\sqrt{2}\\right) + \\left(18 + 19 \\sqrt{2}\\right) + \\left(- 2 - 14 \\sqrt{2}\\right) = 0,\n$$\nand the $y$-components,\n$$\n\\left(-16 - 5 \\sqrt{2}\\right) + \\left(- 2 - 14 \\sqrt{2}\\right) + \\left(18 + 19 \\sqrt{2}\\right) = 0,\n$$\nconfirming internal consistency. Therefore, the requested energy and force components are\n$$\nE = - \\frac{49}{4} - 12 \\sqrt{2},\\quad \\mathbf{F}_1 = \\left(-16 - 5 \\sqrt{2},\\; -16 - 5 \\sqrt{2}\\right),\\quad \\mathbf{F}_2 = \\left(18 + 19 \\sqrt{2},\\; - 2 - 14 \\sqrt{2}\\right),\\quad \\mathbf{F}_3 = \\left(- 2 - 14 \\sqrt{2},\\; 18 + 19 \\sqrt{2}\\right).\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}-\\frac{49}{4}-12\\sqrt{2} & -16-5\\sqrt{2} & -16-5\\sqrt{2} & 18+19\\sqrt{2} & -2-14\\sqrt{2} & -2-14\\sqrt{2} & 18+19\\sqrt{2}\\end{pmatrix}}$$"
        },
        {
            "introduction": "A physically meaningful interatomic potential must respect the fundamental symmetries of nature. Perhaps the most crucial among these for MLIPs is permutation invariance: the energy of a system of identical particles cannot change if we simply swap their labels. This practice  powerfully illustrates the unphysical consequences of violating this principle, tasking you with quantifying the artificial energy differences that arise from a poorly designed, index-dependent model and contrasting it with a correctly invariant one.",
            "id": "3886545",
            "problem": "You are asked to formalize and quantify the consequences of violating permutation invariance among identical atoms in Machine Learning (ML) interatomic potentials within computational catalysis and chemical engineering. The goal is to construct a scenario in which index-dependent features cause artificial energy splitting and to quantify the resulting prediction errors against a physically grounded reference. Start from a physically motivated, permutation-invariant reference energy and use it to analyze a deliberately permutation-variant surrogate model. Your program must produce a single line containing the aggregated numerical results for a test suite of configurations in dimensionless reduced units, rounded to eight decimal places.\n\nFundamental base:\n- Identical atoms are indistinguishable in classical mechanics and quantum mechanics; the total energy must be invariant under any permutation of atom labels. Formally, if there are $N$ identical atoms and a configuration is described by the set of pairwise distances $\\{r_{ij}\\}$, any permutation $\\pi$ in the symmetric group $S_N$ of indices must satisfy $E(\\{r_{ij}\\}) = E(\\{r_{\\pi(i)\\pi(j)}\\})$.\n- A standard, well-tested pairwise energy function for nonbonded interactions is the Lennard-Jones (LJ) potential. In reduced units where the characteristic energy and length scales are set to unity, the total energy for a configuration is computed as\n$$\nE_{\\text{LJ}}(\\mathbf{R}) = \\sum_{1 \\leq i < j \\leq N} 4 \\varepsilon \\left[\\left(\\frac{\\sigma}{r_{ij}}\\right)^{12} - \\left(\\frac{\\sigma}{r_{ij}}\\right)^6\\right],\n$$\nwith $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$, $\\varepsilon$ and $\\sigma$ the energy and length scales, and where the sum over unordered pairs ensures permutation invariance. Use reduced units with $\\varepsilon = 1$ and $\\sigma = 1$, so that energies and distances are dimensionless.\n\nIndex-dependent surrogate model:\n- Define per-atom descriptors that depend on local distances,\n$$\nd_i = \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} \\exp\\left(-\\frac{r_{ij}}{\\sigma}\\right), \\quad e_i = \\sum_{\\substack{j=1 \\\\ j \\neq i}}^{N} \\frac{r_{ij}}{\\sigma}.\n$$\n- Construct a deliberately permutation-variant surrogate energy by using index-dependent weights,\n$$\nE_{\\text{bad}}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left[a_i \\, d_i + b_i \\, e_i\\right],\n$$\nwhere $\\mathbf{a} = (a_1, \\dots, a_N)$ and $\\mathbf{b} = (b_1, \\dots, b_N)$ depend on the atom index. Under a permutation $\\pi \\in S_N$ of labels, the predicted energy becomes\n$$\nE_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left[a_{\\pi(i)} \\, d_i + b_{\\pi(i)} \\, e_i\\right],\n$$\nwhich can differ for identical atoms if the $d_i$ and $e_i$ are not all equal.\n- For comparison, construct a permutation-invariant surrogate with shared weights,\n$$\nE_{\\text{good}}(\\mathbf{R}; a, b) = \\sum_{i=1}^{N} \\left[a \\, d_i + b \\, e_i\\right].\n$$\n\nQuantities to compute per test case:\n- Artificial energy splitting magnitude across a set of label permutations $\\mathcal{P}$,\n$$\n\\Delta_{\\text{split}} = \\max_{\\pi \\in \\mathcal{P}} E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) - \\min_{\\pi \\in \\mathcal{P}} E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}).\n$$\n- Maximum absolute prediction error of the index-dependent model across $\\mathcal{P}$, relative to the LJ energy,\n$$\n\\text{Err}_{\\text{bad,max}} = \\max_{\\pi \\in \\mathcal{P}} \\left|E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) - E_{\\text{LJ}}(\\mathbf{R})\\right|.\n$$\n- Absolute prediction error of the permutation-invariant surrogate (shared weights),\n$$\n\\text{Err}_{\\text{good}} = \\left|E_{\\text{good}}(\\mathbf{R}; a, b) - E_{\\text{LJ}}(\\mathbf{R})\\right|.\n$$\n\nAngle units are irrelevant because only distances are used. All energies and distances must be expressed in dimensionless reduced units with $\\varepsilon = 1$ and $\\sigma = 1$. Round all outputs to eight decimal places.\n\nTest suite:\n- Use the following four configuration cases. Coordinates are given as Cartesian positions in $3$-dimensional space, in reduced units. Use $\\varepsilon = 1$ and $\\sigma = 1$. For each case, apply the set of permutations $\\mathcal{P}$ consisting of the identity and the reverse-index permutation. Shared weights are $a = 0.9$, $b = -0.15$.\n\nCase $1$ (non-symmetric linear triatomic, happy path):\n- $N = 3$,\n- positions: $\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.2, 0.0, 0.0\\right)$, $\\left(2.5, 0.0, 0.0\\right)$,\n- index-dependent weights: $\\mathbf{a} = (0.8, 1.4, 0.5)$, $\\mathbf{b} = (-0.3, 0.2, 0.1)$.\n\nCase $2$ (equilateral triangle, symmetry boundary condition):\n- $N = 3$,\n- side length: $L = 1.6$,\n- positions: $\\left(0.0, 0.0, 0.0\\right)$, $\\left(L, 0.0, 0.0\\right)$, $\\left(\\frac{L}{2}, \\frac{\\sqrt{3}}{2} L, 0.0\\right)$,\n- index-dependent weights: $\\mathbf{a} = (0.8, 1.4, 0.5)$, $\\mathbf{b} = (-0.3, 0.2, 0.1)$.\n\nCase $3$ (diatomic pair, edge case):\n- $N = 2$,\n- positions: $\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.1, 0.0, 0.0\\right)$,\n- index-dependent weights: $\\mathbf{a} = (1.2, 0.7)$, $\\mathbf{b} = (-0.25, 0.05)$.\n\nCase $4$ (four atoms in a non-symmetric rectangular layout):\n- $N = 4$,\n- positions: $\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.4, 0.0, 0.0\\right)$, $\\left(0.0, 2.2, 0.0\\right)$, $\\left(2.1, 2.3, 0.0\\right)$,\n- index-dependent weights: $\\mathbf{a} = (0.7, 1.1, 0.6, 1.5)$, $\\mathbf{b} = (-0.2, 0.25, -0.05, 0.3)$.\n\nRequired final output format:\n- For each case, compute the triple $\\left[\\Delta_{\\text{split}}, \\text{Err}_{\\text{bad,max}}, \\text{Err}_{\\text{good}}\\right]$ as floats. Your program should produce a single line of output containing the list of these per-case triples, rounded to eight decimal places, as a comma-separated list of Python-style lists enclosed in square brackets, for example, $\\left[[x_1,y_1,z_1],[x_2,y_2,z_2],\\dots\\right]$.",
            "solution": "The user-provided problem is assessed as **valid**. It is scientifically grounded, well-posed, and objective. The problem statement provides a clear, self-contained set of definitions, data, and constraints that permit a unique and meaningful solution. It establishes a pedagogically valuable exercise in computational chemistry by formalizing the consequences of violating a fundamental physical principle—permutation invariance—in the context of machine learning interatomic potentials. All required data for the four test cases are provided, and the quantities to be computed are mathematically unambiguous.\n\nProceeding with the solution, the core of the problem is to quantify the errors introduced by a machine learning model that fails to respect the physical indistinguishability of identical atoms. This principle, permutation invariance, dictates that the total energy of a system of $N$ identical atoms must remain unchanged regardless of how we label them. Mathematically, for any permutation $\\pi$ of the atom indices $\\{1, \\dots, N\\}$, the energy function $E$ must satisfy $E(\\{\\mathbf{r}_i\\}) = E(\\{\\mathbf{r}_{\\pi(i)}\\})$.\n\nThe solution is structured as follows:\n1.  A reference, physically correct energy is calculated using the Lennard-Jones (LJ) potential. This serves as the \"ground truth.\" In the specified reduced units where the characteristic energy $\\varepsilon=1$ and length $\\sigma=1$, the LJ potential is:\n    $$E_{\\text{LJ}}(\\mathbf{R}) = \\sum_{1 \\leq i < j \\leq N} 4 \\left(r_{ij}^{-12} - r_{ij}^{-6}\\right)$$\n    where $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ is the distance between atoms $i$ and $j$. This formulation, summing over unique pairs, is inherently permutation-invariant.\n\n2.  Two surrogate models are constructed based on local atomic environment descriptors. For each atom $i$, we define descriptors $d_i$ and $e_i$ that summarize its neighborhood:\n    $$d_i = \\sum_{j \\neq i} \\exp(-r_{ij})$$\n    $$e_i = \\sum_{j \\neq i} r_{ij}$$\n    These descriptors are themselves permutation-invariant in the sense that they are a property of the local geometry around a point in space, regardless of the label assigned to the atom at that point.\n\n3.  The first surrogate model, $E_{\\text{good}}$, is constructed to be permutation-invariant by assigning the same weights, $a$ and $b$, to the descriptors of every atom:\n    $$E_{\\text{good}}(\\mathbf{R}; a, b) = \\sum_{i=1}^{N} \\left(a \\, d_i + b \\, e_i\\right)$$\n    Under a permutation of atom labels, the set of descriptor values $\\{d_i, e_i\\}$ is merely reordered, but their sum over all atoms remains constant, ensuring $E_{\\text{good}}$ is invariant.\n\n4.  The second surrogate model, $E_{\\text{bad}}$, is deliberately constructed to violate permutation invariance by assigning index-dependent weights, $a_i$ and $b_i$:\n    $$E_{\\text{bad}}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left(a_i \\, d_i + b_i \\, e_i\\right)$$\n    If we permute the atom labels according to a permutation $\\pi$, atom $i$ (with its fixed descriptors $d_i, e_i$) is now assigned the label $\\pi(i)$ and thus receives weights $a_{\\pi(i)}$ and $b_{\\pi(i)}$. The energy under this new labeling, as defined in the problem, is:\n    $$E_{\\text{bad}}^{(\\pi)}(\\mathbf{R}; \\mathbf{a}, \\mathbf{b}) = \\sum_{i=1}^{N} \\left(a_{\\pi(i)} \\, d_i + b_{\\pi(i)} \\, e_i\\right)$$\n    If the atomic environments (and thus descriptors $d_i, e_i$) are not all identical, this energy will in general depend on the permutation $\\pi$, which is unphysical.\n\nThe algorithmic procedure for each test case is as follows:\nFirst, the $N \\times N$ matrix of pairwise distances $r_{ij}$ is computed from the given atomic coordinates. Using these distances, the reference energy $E_{\\textLJ}$ is calculated. Then, the descriptor vectors $\\mathbf{d}=(d_1, \\dots, d_N)$ and $\\mathbf{e}=(e_1, \\dots, e_N)$ are computed.\n\nTo quantify the violation, we consider two permutations: the identity ($\\pi_{id}(i) = i$) and the reverse-index permutation ($\\pi_{rev}(i) = N-1-i$ for $0$-based indices). The two corresponding energies, $E_{\\text{bad}}^{(\\pi_{id})}$ and $E_{\\text{bad}}^{(\\pi_{rev})}$, are calculated.\n\nFrom these values, we compute the required metrics:\n-   The artificial energy splitting, $\\Delta_{\\text{split}} = |E_{\\text{bad}}^{(\\pi_{id})} - E_{\\text{bad}}^{(\\pi_{rev})}|$. This directly measures the magnitude of the invariance violation. In symmetric configurations (e.g., a diatomic molecule or an equilateral trimer), the descriptors $\\{d_i, e_i\\}$ are identical for all atoms, causing $\\Delta_{\\text{split}}$ to be zero, as expected.\n-   The maximum absolute prediction error of the bad model, $\\text{Err}_{\\text{bad,max}} = \\max(|E_{\\text{bad}}^{(\\pi_{id})} - E_{\\text{LJ}}|, |E_{\\text{bad}}^{(\\pi_{rev})} - E_{\\text{LJ}}|)$. This reflects the worst-case error of the flawed model for the given labelings.\n-   The absolute prediction error of the good model, $\\text{Err}_{\\text{good}} = |E_{\\text{good}}(\\mathbf{R}; a, b) - E_{\\text{LJ}}|$. This isolates the model's intrinsic representational error from the error caused by broken symmetry.\n\nBy computing the triplet $[\\Delta_{\\text{split}}, \\text{Err}_{\\text{bad,max}}, \\text{Err}_{\\text{good}}]$ for each case, we systematically analyze and quantify the consequences of violating a core physical principle in a computational model.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes metrics for permutation variance in ML interatomic potentials.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {   # Case 1\n            \"N\": 3,\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], \n                [1.2, 0.0, 0.0], \n                [2.5, 0.0, 0.0]\n            ]),\n            \"a_bad\": np.array([0.8, 1.4, 0.5]),\n            \"b_bad\": np.array([-0.3, 0.2, 0.1]),\n        },\n        {   # Case 2\n            \"N\": 3,\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], \n                [1.6, 0.0, 0.0], \n                [1.6/2, np.sqrt(3)/2 * 1.6, 0.0]\n            ]),\n            \"a_bad\": np.array([0.8, 1.4, 0.5]),\n            \"b_bad\": np.array([-0.3, 0.2, 0.1]),\n        },\n        {   # Case 3\n            \"N\": 2,\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], \n                [1.1, 0.0, 0.0]\n            ]),\n            \"a_bad\": np.array([1.2, 0.7]),\n            \"b_bad\": np.array([-0.25, 0.05]),\n        },\n        {   # Case 4\n            \"N\": 4,\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], \n                [1.4, 0.0, 0.0], \n                [0.0, 2.2, 0.0], \n                [2.1, 2.3, 0.0]\n            ]),\n            \"a_bad\": np.array([0.7, 1.1, 0.6, 1.5]),\n            \"b_bad\": np.array([-0.2, 0.25, -0.05, 0.3]),\n        },\n    ]\n\n    # Shared parameters\n    a_good = 0.9\n    b_good = -0.15\n    epsilon = 1.0\n    sigma = 1.0\n    \n    final_results = []\n\n    for case in test_cases:\n        N = case[\"N\"]\n        positions = case[\"positions\"]\n        a_bad = case[\"a_bad\"]\n        b_bad = case[\"b_bad\"]\n\n        # 1. Calculate the-distance matrix\n        dist_matrix = np.zeros((N, N))\n        if N > 1:\n            for i in range(N):\n                for j in range(i + 1, N):\n                    dist = np.linalg.norm(positions[i] - positions[j])\n                    dist_matrix[i, j] = dist\n                    dist_matrix[j, i] = dist\n\n        # 2. Calculate Lennard-Jones reference energy (E_LJ)\n        e_lj = 0.0\n        if N > 1:\n            # np.triu_indices gives upper triangle indices to sum over pairs once\n            i_upper, j_upper = np.triu_indices(N, k=1)\n            r_ij = dist_matrix[i_upper, j_upper]\n            \n            # Filter out zero distances to prevent division by zero\n            r_ij_nonzero = r_ij[r_ij > 0]\n            if r_ij_nonzero.size > 0:\n                inv_r6 = (sigma / r_ij_nonzero)**6\n                inv_r12 = inv_r6**2\n                e_lj = np.sum(4 * epsilon * (inv_r12 - inv_r6))\n\n        # 3. Calculate per-atom descriptors\n        d = np.zeros(N)\n        e = np.zeros(N)\n        if N > 1:\n            for i in range(N):\n                # Distances from atom i to all other atoms j\n                r_i_others = dist_matrix[i, np.arange(N) != i]\n                d[i] = np.sum(np.exp(-r_i_others / sigma))\n                e[i] = np.sum(r_i_others / sigma)\n\n        # 4. Calculate E_bad for identity and reverse permutations\n        # Identity permutation\n        e_bad_id = np.sum(a_bad * d + b_bad * e)\n\n        # Reverse-index permutation\n        pi_rev_indices = np.arange(N - 1, -1, -1)\n        a_bad_rev = a_bad[pi_rev_indices]\n        b_bad_rev = b_bad[pi_rev_indices]\n        e_bad_rev = np.sum(a_bad_rev * d + b_bad_rev * e)\n        \n        e_bad_energies = np.array([e_bad_id, e_bad_rev])\n\n        # 5. Calculate artificial energy splitting (Delta_split)\n        delta_split = np.max(e_bad_energies) - np.min(e_bad_energies)\n\n        # 6. Calculate maximum absolute prediction error for E_bad\n        err_bad_max = np.max(np.abs(e_bad_energies - e_lj))\n\n        # 7. Calculate error for the permutation-invariant model (E_good)\n        e_good = a_good * np.sum(d) + b_good * np.sum(e)\n        err_good = np.abs(e_good - e_lj)\n\n        final_results.append([delta_split, err_bad_max, err_good])\n\n    # Format the final output string as specified\n    result_strings = []\n    for res in final_results:\n        # Create string for each sublist, e.g., \"[val1,val2,val3]\"\n        sublist_str = f\"[{res[0]:.8f},{res[1]:.8f},{res[2]:.8f}]\"\n        result_strings.append(sublist_str)\n    \n    # Join sublist strings and wrap in the final brackets\n    final_output_str = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}