{
    "hands_on_practices": [
        {
            "introduction": "这个练习将带你深入迭代玻尔兹曼反演（IBI）算法的核心：势能更新法则。通过一个简化的情景，你将直接应用基本原理，即径向分布函数（$g(r)$）的偏差与对势（$U(r)$）的必要修正之间的关系。这次实践旨在为你建立一个坚实的基础，理解IBI方法如何逐步迭代优化势函数。",
            "id": "3771866",
            "problem": "考虑一个由组分 $A$ 和 $B$ 组成的二元粗粒化流体，其处于温度为 $T$ 的正则系综中，具有对加性相互作用 $U_{AA}(r)$、$U_{AB}(r)$ 和 $U_{BB}(r)$。对于组分 $\\alpha,\\beta \\in \\{A,B\\}$，径向分布函数 (RDF) $g_{\\alpha\\beta}(r)$ 定义为在间距 $r$ 处，局域对密度与理想气体对密度的比值。假设系统在固定的数密度和组分下进行模拟。您正在使用迭代玻尔兹曼反演 (IBI) 方法进行势函数优化，混合参数为 $\\eta \\in (0,1)$。\n\n在当前第 $n$ 次迭代中，测得的 RDF 满足 $g_{AA,n}(r) = g_{AA}^{*}(r)$ 对所有 $r$ 成立，其中 $g_{\\alpha\\beta}^{*}(r)$ 表示目标 RDF。对于交叉相互作用，您观察到测得的 RDF 与目标 RDF 的比值为如下分段常数：\n- 当 $0.85\\,\\mathrm{nm} \\le r \\le 0.95\\,\\mathrm{nm}$ 时，$g_{AB,n}(r)/g_{AB}^{*}(r) = 1.25$。\n- 当 $1.35\\,\\mathrm{nm} \\le r \\le 1.55\\,\\mathrm{nm}$ 时，$g_{AB,n}(r)/g_{AB}^{*}(r) = 1.10$。\n- 在其他区域（对于所有其他 $r$），$g_{AB,n}(r)/g_{AB}^{*}(r) = 1$。\n\n假设对势函数的变化，在领头阶上，会引起 RDF 对数的局域变化，且该变化与平衡统计力学一致。从第一性原理推导 IBI 更新规则，该规则能减少 $g_{AB}(r)$ 与 $g_{AB}^{*}(r)$ 之间的偏差，同时保持 $U_{AA}(r)$ 不变。并用此规则计算无量纲更新量 $\\Delta U_{AB}(r)/(k_{B}T)$ 作为 $r$ 的函数的显式解析表达式，其中 $\\Delta U_{AB}(r) := U_{AB}^{(n+1)}(r) - U_{AB}^{(n)}(r)$，$k_{B}$ 是玻尔兹曼常数，$T$ 是绝对温度。取混合参数为 $\\eta = 0.40$。\n\n将您得到的 $\\Delta U_{AB}(r)/(k_{B}T)$ 的最终表达式写为关于 $r$ 的单个分段定义的解析函数。无需进行数值取整。由于所求量已由 $k_{B}T$ 归一化，因此它是无量纲的；在您的推导中，当确定径向区间时，请使用纳米作为 $r$ 的单位。",
            "solution": "用户要求我首先验证问题陈述。\n\n### 第1步：提取已知条件\n- **系统：** 由组分 $A$ 和 $B$ 组成的二元粗粒化流体。\n- **热力学系综：** 正则系综（恒定 $N$、$V$、$T$）。\n- **温度：** $T$。\n- **相互作用：** 对加性势函数 $U_{AA}(r)$、$U_{AB}(r)$ 和 $U_{BB}(r)$。\n- **定义：** 径向分布函数 (RDF) $g_{\\alpha\\beta}(r)$ 是局域对密度与理想气体对密度的比值。\n- **条件：** 固定的数密度和组分。\n- **方法：** 迭代玻尔兹曼反演 (IBI)。\n- **混合参数：** $\\eta = 0.40$。\n- **第 n 次迭代时的状态：**\n  - 对于所有 $r$，$g_{AA,n}(r) = g_{AA}^{*}(r)$，其中 $g_{\\alpha\\beta}^{*}(r)$ 是目标 RDF。\n  - 比率 $g_{AB,n}(r)/g_{AB}^{*}(r)$ 是一个分段常数函数：\n    - 当 $0.85\\,\\mathrm{nm} \\le r \\le 0.95\\,\\mathrm{nm}$ 时为 $1.25$。\n    - 当 $1.35\\,\\mathrm{nm} \\le r \\le 1.55\\,\\mathrm{nm}$ 时为 $1.10$。\n    - 对于所有其他 $r$ 值为 $1$。\n- **基本假设：** “对势函数的变化，在领头阶上，会引起 RDF 对数的局域变化，且该变化与平衡统计力学一致。”\n- **目标：**\n  1. 从第一性原理推导 IBI 更新规则，以修正 $g_{AB}(r)$ 中的偏差。\n  2. 势函数 $U_{AA}(r)$ 必须保持不变。\n  3. 计算无量纲更新量 $\\Delta U_{AB}(r)/(k_{B}T)$ 的显式解析表达式，其中 $\\Delta U_{AB}(r) := U_{AB}^{(n+1)}(r) - U_{AB}^{(n)}(r)$。\n- **常数：** $k_{B}$ 是玻尔兹曼常数。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学上成立：** 该问题牢固地植根于统计力学和计算化学的原理。迭代玻尔兹曼反演 (IBI) 方法是开发粗粒化势函数的标准技术。平均力势与径向分布函数之间的关系是一个基本概念。所有给定的条件在科学上都是合理的。\n- **提法明确：** 问题提供了所有必要的信息：通过 RDF 得到的系统当前状态、目标 RDF（通过比率隐含给出）、具体的算法 (IBI)、混合参数和物理常数。目标是计算一个明确定义的数学表达式。存在唯一解。\n- **目标：** 问题以精确、明确的科学语言表述。没有主观或基于观点的条款。\n- **缺陷检查表：**\n  1. **科学上不合理：** 物理原理是正确的。没有违反科学原则。\n  2. **无法形式化/不相关：** 该问题与多尺度建模中的 IBI 直接相关，并且易于形式化。\n  3. **不完整/矛盾：** 数据充分且一致。条件 $g_{AA,n}(r) = g_{AA}^{*}(r)$ 正确地暗示了 $U_{AA}(r)$ 不需要更新，这与要求保持其不变的请求一致。\n  4. **不切实际/不可行：** 给定的 RDF 比率和距离尺度在分子模拟中是典型的。\n  5. **提法不当：** 问题结构良好，能导出一个唯一的、稳定的解。\n  6. **伪深刻/琐碎：** 问题需要对一个非平凡的算法进行正确的推导和应用，考验了概念理解。\n  7. **超出科学可验证范围：** 结果可以通过数学推导和验证。\n\n### 第3步：结论和行动\n问题是有效的。现在开始求解过程。\n\n迭代玻尔兹曼反演（IBI）的基本原理是正则系综中径向分布函数（RDF）$g(r)$ 与平均力势（PMF）$W(r)$ 之间的关系。该关系由下式给出：\n$$ g(r) = \\exp\\left(-\\frac{W(r)}{k_{B}T}\\right) $$\n其中 $k_{B}$ 是玻尔兹曼常数，$T$ 是绝对温度。这个方程可以反演，用来以 RDF 表示 PMF：\n$$ W(r) = -k_{B}T \\ln(g(r)) $$\n在稀疏系统中，PMF 近似等于对势，$W(r) \\approx U(r)$。在稠密系统中，$W(r)$ 包含多体关联的贡献，因此 $U(r) \\neq W(r)$。IBI 方法是一种启发式的迭代过程，旨在优化对势 $U(r)$，使得使用该势函数的模拟能够再现目标 RDF $g^{*}(r)$。\n\nIBI 更新规则的推导基于这样一个假设：对势函数的修正 $\\Delta U(r)$ 将导致对 PMF 的相应修正。目标是驱动第 $n$ 次迭代的模拟 RDF $g_{n}(r)$ 趋向于目标 RDF $g^{*}(r)$。\n\n与模拟 RDF 对应的 PMF 是 $W_{n}(r) = -k_{B}T \\ln(g_{n}(r))$。能够产生目标 RDF 的 PMF 是 $W^{*}(r) = -k_{B}T \\ln(g^{*}(r))$。当前势函数与理想势函数之间的差异被假定为与当前 PMF 和目标 PMF 之间的差异相关。一个简单的反演表明势函数修正为：\n$$ \\Delta U(r) \\approx W^{*}(r) - W_{n}(r) = -k_{B}T \\ln(g^{*}(r)) - \\left(-k_{B}T \\ln(g_{n}(r))\\right) = k_{B}T \\ln\\left(\\frac{g_{n}(r)}{g^{*}(r)}\\right) $$\n如果 $g_{n}(r) > g^{*}(r)$，则在间距 $r$ 处发现粒子的概率过高。为了修正这一点，势函数 $U(r)$ 应该增加（变得更排斥），从而导致一个正的更新 $\\Delta U(r) > 0$。当 $g_n(r) > g^*(r)$ 时，表达式 $\\ln(g_n(r)/g^*(r))$ 为正，因此这种形式的修正在物理上是一致的。\n\n为确保稳定性并防止过度修正，更新量会通过一个混合参数 $\\eta$ 进行缩放，其中 $0 < \\eta \\le 1$。因此，从第 $n$ 次迭代到第 $n+1$ 次迭代的势函数 IBI 更新规则是：\n$$ \\Delta U_{\\alpha\\beta}(r) = U_{\\alpha\\beta}^{(n+1)}(r) - U_{\\alpha\\beta}^{(n)}(r) = \\eta \\, k_{B} T \\ln\\left(\\frac{g_{\\alpha\\beta,n}(r)}{g_{\\alpha\\beta}^{*}(r)}\\right) $$\n问题要求的是交叉相互作用势的无量纲更新量 $\\frac{\\Delta U_{AB}(r)}{k_{B}T}$。将通用更新规则除以 $k_{B}T$，我们得到：\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\eta \\ln\\left(\\frac{g_{AB,n}(r)}{g_{AB}^{*}(r)}\\right) $$\n我们已知混合参数 $\\eta = 0.40$ 和比率 $\\frac{g_{AB,n}(r)}{g_{AB}^{*}(r)}$ 的分段定义。我们可以将 $\\eta$ 表示为精确分数，$\\eta = \\frac{40}{100} = \\frac{2}{5}$。现在我们将此公式应用于 $r$ 的每个区间。\n\n对于区间 $0.85\\,\\mathrm{nm} \\le r \\le 0.95\\,\\mathrm{nm}$：\n比率给定为 $1.25$，即 $\\frac{5}{4}$。\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\frac{2}{5} \\ln\\left(1.25\\right) = \\frac{2}{5} \\ln\\left(\\frac{5}{4}\\right) $$\n由于比率大于1，势函数被增加以降低对概率。\n\n对于区间 $1.35\\,\\mathrm{nm} \\le r \\le 1.55\\,\\mathrm{nm}$：\n比率给定为 $1.10$，即 $\\frac{11}{10}$。\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\frac{2}{5} \\ln\\left(1.10\\right) = \\frac{2}{5} \\ln\\left(\\frac{11}{10}\\right) $$\n这里比率也大于1，所以势函数被增加。\n\n对于所有其他 $r$ 值（“其他情况”）：\n比率给定为 $1$。\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\frac{2}{5} \\ln(1) = \\frac{2}{5} \\times 0 = 0 $$\n正如预期的那样，在模拟 RDF 与目标 RDF 匹配的地方，不对势函数应用任何修正。\n\n问题还指出，对于所有 $r$，$g_{AA,n}(r) = g_{AA}^{*}(r)$。对于 $A-A$ 相互作用，更新将是：\n$$ \\frac{\\Delta U_{AA}(r)}{k_{B}T} = \\eta \\ln\\left(\\frac{g_{AA,n}(r)}{g_{AA}^{*}(r)}\\right) = \\eta \\ln(1) = 0 $$\n这证实了 $U_{AA}(r)$ 确实保持不变，与问题的约束条件一致。\n\n综合这些结果，我们得到交叉相互作用势的无量纲更新量的完整分段定义解析函数：\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\begin{cases} \\frac{2}{5} \\ln\\left(\\frac{5}{4}\\right)  \\text{对于 } 0.85 \\le r \\le 0.95 \\, (\\text{nm}) \\\\ \\frac{2}{5} \\ln\\left(\\frac{11}{10}\\right)  \\text{对于 } 1.35 \\le r \\le 1.55 \\, (\\text{nm}) \\\\ 0  \\text{其他情况} \\end{cases} $$\n此表达式代表了最终答案，它是从 IBI 的基本原理推导出来的。",
            "answer": "$$\n\\boxed{\n\\begin{cases}\n\\frac{2}{5} \\ln\\left(\\frac{5}{4}\\right)  \\text{对于 } 0.85 \\le r \\le 0.95 \\\\\n\\frac{2}{5} \\ln\\left(\\frac{11}{10}\\right)  \\text{对于 } 1.35 \\le r \\le 1.55 \\\\\n0  \\text{其他情况}\n\\end{cases}\n}\n$$"
        },
        {
            "introduction": "在实际的模拟中，有限的采样数据会导致数值计算上的难题，例如径向分布函数（RDF）的统计直方图中出现计数值为零的区间。本练习将探讨这一实际挑战，它会导致标准IBI更新公式中的对数发散。你将评估几种用于正则化RDF的原则性方法，以确保算法的稳健性和物理合理性。",
            "id": "3771873",
            "problem": "在通过迭代玻尔兹曼反演 (IBI) 进行的迭代粗粒化中，研究者会优化一个对势，使得模拟得到的径向分布函数 (RDF) 与目标函数相匹配。考虑一个温度为 $T$、数密度为 $\\rho$ 的均匀、各向同性流体，其目标 RDF 为 $g_{\\text{target}}(r)$。在第 $k$ 次迭代时，模拟的 RDF 是从有限的轨迹中估计得到的，产生一个在径向区间上定义的直方图估计量 $\\hat{g}_k(r)$，其中径向区间的球壳体积为 $\\Delta V(r)=4\\pi r^2 \\Delta r$。对于较小的 $r$，有限采样常常导致某些区间的 $\\hat{g}_k(r)\\approx 0$ (有时甚至精确为零)，这在标准 IBI 中会产生无界的对数更新。一种常见的正则化方法是通过以下方式，在更新中形成任何对数比之前，将任何出现的零或接近零的 RDF 值替换为一个下限值 $\\hat{g}_{\\min}0$：\n$$\n\\tilde{g}(r)\\;=\\;\\max\\!\\big(\\hat{g}_k(r),\\,\\hat{g}_{\\min}\\big),\\qquad \n\\tilde{g}_{\\text{target}}(r)\\;=\\;\\max\\!\\big(g_{\\text{target}}(r),\\,\\hat{g}_{\\min}\\big),\n$$\n请你从正则采样和计数统计的第一性原理出发，论证为何这样的下限值可以避免势能更新发散，同时保持物理行为，并评估选择 $\\hat{g}_{\\min}$ 的合理策略。\n\n选择所有正确的陈述。\n\nA. 对模拟的和目标的 RDF 都设置下限，即 $\\tilde{g}(r)=\\max(\\hat{g}_k(r),\\hat{g}_{\\min})$ 和 $\\tilde{g}_{\\text{target}}(r)=\\max(g_{\\text{target}}(r),\\hat{g}_{\\min})$，可以确保任何对数比 $\\ln\\!\\big(\\tilde{g}(r)/\\tilde{g}_{\\text{target}}(r)\\big)$ 保持有限，从而防止势能更新发散。在真实对概率趋于零的小 $r$ 区间，对结构和热力学可观测量所引起的偏差可以忽略不计，因为这些可观测量被对概率密度 $\\rho\\,4\\pi r^2 g(r)$ 加权，而后者在此处本身就极小。选择与每个区间约一个计数的贡献相当的 $\\hat{g}_{\\min}$，即与 $1/\\langle C_{\\text{ideal}}(r)\\rangle$ 成正比（其中 $\\langle C_{\\text{ideal}}(r)\\rangle$ 是理想气体预期计数），可以保持物理行为，并且该值会随着数据量的增加而消失。\n\nB. 直接对势能应用上限，即 $U_k(r)\\leftarrow \\min\\!\\big(U_k(r),U_{\\max}\\big)$（其中 $U_{\\max}$ 为一固定值），等效于对 RDF 设置下限，并且是更可取的方法，因为它在不改变直方图的情况下保留了 IBI 更新的对数结构。\n\nC. 将 $\\hat{g}_{\\min}$ 设置为一个与区间宽度 $\\Delta r$、球壳体积 $\\Delta V(r)$ 以及总帧数或粒子对数无关的固定常数，可以保证无偏收敛，因为随着迭代指数 $k$ 的增加，下限值的影响会减小。\n\nD. 下限值必须只应用于 $g_{\\text{target}}(r)$，而绝不能应用于模拟的直方图 $\\hat{g}_k(r)$；否则，分子动力学采样中的细致平衡条件将被违反。\n\nE. 为直方图实现贝叶斯伪计数是实现下限值的一种等效方法：如果 $C(r)$ 表示在球壳中观察到的对计数，并且使用一个添加了伪计数 $\\alpha0$ 的狄利克雷先验，那么对于 $C(r)=0$ 的情况，最小的非零估计量可转换为 $\\hat{g}_{\\min}(r)\\approx \\alpha/\\langle C_{\\text{ideal}}(r)\\rangle$，其中 $\\langle C_{\\text{ideal}}(r)\\rangle$ 是该球壳中的理想气体预期计数。当 $\\alpha=\\mathcal{O}(1)$ 时，这个选择可以防止发散，对于 $M$ 个独立帧，其缩放关系为 $\\hat{g}_{\\min}(r)\\propto 1/\\big(M\\,\\Delta V(r)\\big)$，并且随着收集更多数据而消失，从而保持了物理行为。",
            "solution": "问题要求评估在迭代玻尔兹曼反演 (IBI) 及相关策略中使用的一种正则化方法。IBI方法的核心是迭代地优化一个粗粒化对势 $U(r)$，以再现一个目标径向分布函数 $g_{\\text{target}}(r)$。\n\n标准的IBI更新规则，用于在第 $k$ 次迭代时从势能 $U_k(r)$ 得到下一次迭代的势能 $U_{k+1}(r)$，由下式给出：\n$$U_{k+1}(r) = U_k(r) + \\alpha_k k_B T \\ln\\left( \\frac{g_{\\text{target}}(r)}{\\hat{g}_k(r)} \\right)$$\n或等效地：\n$$U_{k+1}(r) = U_k(r) - \\alpha_k k_B T \\ln\\left( \\frac{\\hat{g}_k(r)}{g_{\\text{target}}(r)} \\right)$$\n其中 $\\hat{g}_k(r)$ 是使用势能 $U_k(r)$ 进行模拟得到的 RDF，$T$ 是温度，$k_B$ 是玻尔兹曼常数，而 $\\alpha_k$ 是一个阻尼因子，通常小于1。\n\n模拟的 RDF, $\\hat{g}_k(r)$, 是一个基于直方图的估计量。它是通过将在模拟过程中发现于体积为 $\\Delta V(r) = 4\\pi r^2 \\Delta r$ 的球壳中的粒子对数 $C_k(r)$ 计算得出的。RDF 是观察到的对计数与均匀分布（理想气体）的预期计数之比：\n$$\\hat{g}_k(r) = \\frac{C_k(r)}{\\langle C_{\\text{ideal}}(r) \\rangle}$$\n理想气体的预期计数 $\\langle C_{\\text{ideal}}(r) \\rangle$ 与粒子数 $N$、系统密度 $\\rho$、采样构型数（帧数）$M$ 以及球壳体积 $\\Delta V(r)$ 成正比。具体来说，对于体积为 $V$ 的系统中 $M$ 个帧：\n$$\\langle C_{\\text{ideal}}(r) \\rangle = M \\frac{N(N-1)}{2} \\frac{\\Delta V(r)}{V} \\approx M \\frac{N^2}{2V} \\Delta V(r) = M \\frac{N\\rho}{2} \\Delta V(r)$$\n\n当由于有限采样，在给定区间内没有观察到粒子对（即 $C_k(r)=0$）时，就会出现数值问题。这导致 $\\hat{g}_k(r)=0$。将此代入 IBI 更新公式会导致零的对数，即 $\\ln(0) \\to -\\infty$。这将导致势能更新 $\\Delta U_k(r)$ 发散，产生一个不符合物理的无限大排斥势 $U_{k+1}(r) \\to +\\infty$。\n\n提议的正则化方法是为 RDF 值设置一个“下限”：\n$$ \\tilde{g}(r) = \\max\\!\\big(\\hat{g}_k(r), \\hat{g}_{\\min}\\big) \\qquad \\text{和} \\qquad \\tilde{g}_{\\text{target}}(r) = \\max\\!\\big(g_{\\text{target}}(r), \\hat{g}_{\\min}\\big) $$\n其中 $\\hat{g}_{\\min}  0$ 是某个小的正常数。然后使用这些正则化后的函数 $\\tilde{g}(r)$ 和 $\\tilde{g}_{\\text{target}}(r)$ 进行更新。\n\n我们现在来评估每个陈述。\n\nA. 对模拟的和目标的 RDF 都设置下限，即 $\\tilde{g}(r)=\\max(\\hat{g}_k(r),\\hat{g}_{\\min})$ 和 $\\tilde{g}_{\\text{target}}(r)=\\max(g_{\\text{target}}(r),\\hat{g}_{\\min})$，可以确保任何对数比 $\\ln\\!\\big(\\tilde{g}(r)/\\tilde{g}_{\\text{target}}(r)\\big)$ 保持有限，从而防止势能更新发散。在真实对概率趋于零的小 $r$ 区间，对结构和热力学可观测量所引起的偏差可以忽略不计，因为这些可观测量被对概率密度 $\\rho\\,4\\pi r^2 g(r)$ 加权，而后者在此处本身就极小。选择与每个区间约一个计数的贡献相当的 $\\hat{g}_{\\min}$，即与 $1/\\langle C_{\\text{ideal}}(r)\\rangle$ 成正比（其中 $\\langle C_{\\text{ideal}}(r)\\rangle$ 是理想气体预期计数），可以保持物理行为，并且该值会随着数据量的增加而消失。\n\n这个陈述完全正确。\n1. 由于 $\\hat{g}_{\\min}  0$，$\\tilde{g}(r)$ 和 $\\tilde{g}_{\\text{target}}(r)$ 都保证大于或等于 $\\hat{g}_{\\min}$。因此，它们的比值是有限且严格为正的，其对数是良定义且有限的。这直接解决了发散问题。\n2. 在小 $r$ 处，核心-核心排斥作用使得真实的 $g(r)$ 趋近于零。在距离 $r$ 处找到一对粒子的径向概率与 $g(r) r^2$ 成正比。当 $r \\to 0$ 时，这两个因子都趋于零。热力学平均值，例如超额内能，是形如 $2\\pi N \\rho \\int_0^\\infty U(r) g(r) r^2 dr$ 的积分。在权重因子 $r^2g(r)$ 几乎为零的区域内，$g(r)$ 的误差对积分的影响可以忽略不计。因此，由下限值引入的偏差是最小的。\n3. $\\hat{g}_k(r)$ 可能的最小非零值对应于单个计数，$C_k(r)=1$，这给出 $\\hat{g}_k(r) = 1/\\langle C_{\\text{ideal}}(r) \\rangle$。选择与此数量级相当的 $\\hat{g}_{\\min}$ 是一个有物理动机的选择。这个值取决于采样量 ($M$) 和区间体积 ($\\Delta V(r)$)。随着收集更多的数据 ($M \\to \\infty$)，$\\langle C_{\\text{ideal}}(r) \\rangle \\to \\infty$，因此 $\\hat{g}_{\\min} \\to 0$。这确保了正则化的影响会随着数据统计质量的提高而减小。\n因此，这个陈述是**正确的**。\n\nB. 直接对势能应用上限，即 $U_k(r)\\leftarrow \\min\\!\\big(U_k(r),U_{\\max}\\big)$（其中 $U_{\\max}$ 为一固定值），等效于对 RDF 设置下限，并且是更可取的方法，因为它在不改变直方图的情况下保留了 IBI 更新的对数结构。\n\n这个陈述不正确。首先，这两种过程不等效。对 RDF 设置下限，即 $\\tilde{g}(r) = \\max(\\hat{g}_k(r), \\hat{g}_{\\min})$，是对对数的*输入*进行正则化，防止*更新量*发散。如果 $\\hat{g}_k(r)=0$ 且 $g_{\\text{target}}(r)$ 很小，更新量是有限的：$\\Delta U_k \\propto - k_B T \\ln(\\hat{g}_{\\min}/\\tilde{g}_{\\text{target}}(r))$。而对势能进行封顶，$U_{k+1}(r) = \\min(U_{k+1}^{\\text{raw}}, U_{\\max})$，是对*输出*进行事后裁剪。它并没有“保留对数结构”；它粗暴地截断了结果。其次，其优越性的理由站不住脚。对 RDF 设置下限可以说是一种更平滑的正则化方法，它作用于数值不稳定的根源，而对势能封顶则是一种简单粗暴的补救措施。\n因此，这个陈述是**不正确的**。\n\nC. 将 $\\hat{g}_{\\min}$ 设置为一个与区间宽度 $\\Delta r$、球壳体积 $\\Delta V(r)$以及总帧数或粒子对数无关的固定常数，可以保证无偏收敛，因为随着迭代指数 $k$ 的增加，下限值的影响会减小。\n\n这个陈述不正确。一个健全的正则化方案应该随着数据质量的提高而变得不那么具有侵入性。正如在对A的分析中所确立的，一个有物理动机的下限 $\\hat{g}_{\\min}$ 应该与统计量成比例，也就是说，它应该随着样本数 $M$ 或区间体积 $\\Delta V(r)$ 的增加而减小。一个固定的常数 $\\hat{g}_{\\min}$（例如，$\\hat{g}_{\\min} = 10^{-6}$）不具备此属性。如果某个区域的真实 $g(r)$ 小于这个固定的下限，算法将始终受到这个人为下限的影响，引入一个不会随着采样增加而消失的持续偏差。声称下限的影响“随着迭代指数 $k$ 的增加而减小”是一种希望，而不是保证；收敛可能会停滞在由人为下限决定的有偏结果上。无偏收敛是肯定无法保证的。\n因此，这个陈述是**不正确的**。\n\nD. 下限值必须只应用于 $g_{\\text target}(r)$，而绝不能应用于模拟的直方图 $\\hat{g}_k(r)$；否则，分子动力学采样中的细致平衡条件将被违反。\n\n这个陈述基于两个原因是不正确的。首先，关于细致平衡的推理是谬误的。IBI 更新是在模拟*之间*执行的过程，用于确定*下一次*模拟的势能。第 $k$ 次迭代的分子动力学或蒙特卡洛模拟满足关于势能 $U_k(r)$ 的细致平衡。从得到的轨迹数据计算 $U_{k+1}(r)$ 并不影响已经发生的采样的有效性。其次，仅对 $g_{\\text{target}}(r)$ 应用下限无法解决问题。发散源于 $\\hat{g}_k(r)=0$，这导致 $\\ln(\\hat{g}_k(r)) \\to -\\infty$。修改 $g_{\\text{target}}(r)$ 并不能防止这种情况。必须对 $\\hat{g}_k(r)$ 应用下限才能防止对数发散。\n因此，这个陈述是**不正确的**。\n\nE. 为直方图实现贝叶斯伪计数是实现下限值的一种等效方法：如果 $C(r)$ 表示在球壳中观察到的对计数，并且使用一个添加了伪计数 $\\alpha0$ 的狄利克雷先验，那么对于 $C(r)=0$ 的情况，最小的非零估计量可转换为 $\\hat{g}_{\\min}(r)\\approx \\alpha/\\langle C_{\\text{ideal}}(r)\\rangle$，其中 $\\langle C_{\\text{ideal}}(r)\\rangle$ 是该球壳中的理想气体预期计数。当 $\\alpha=\\mathcal{O}(1)$ 时，这个选择可以防止发散，对于 $M$ 个独立帧，其缩放关系为 $\\hat{g}_{\\min}(r)\\propto 1/\\big(M\\,\\Delta V(r)\\big)$，并且随着收集更多数据而消失，从而保持了物理行为。\n\n这个陈述是正确的。对直方图使用贝叶斯方法是一种在统计学上具有原则性的正则化计数数据的方法。将伪计数 $\\alpha$ 添加到观察到的计数 $C(r)$ 中，会得到一个修正的 RDF 估计量，例如 $\\hat{g}_{\\text{Bayes}}(r) = (C(r)+\\alpha)/\\langle C_{\\text{ideal}}(r) \\rangle$。如果 $C(r)=0$，估计量是非零的：$\\hat{g}_{\\text{Bayes}}(r) = \\alpha/\\langle C_{\\text ideal}(r) \\rangle$。这等效于有一个依赖于区间的下限 $\\hat{g}_{\\min}(r) = \\alpha/\\langle C_{\\text ideal}(r) \\rangle$。选择一个数量级为1的小数 $\\alpha$（例如，$\\alpha=1$ 或 $\\alpha=0.5$）对应于一个弱的、无信息的先验。由于 $\\langle C_{\\text{ideal}}(r) \\rangle \\propto M \\cdot \\Delta V(r)$（对于固定的 $N$ 和 $\\rho$），有效下限的缩放关系为 $\\hat{g}_{\\min}(r) \\propto 1/(M \\Delta V(r))$。这个下限会随着收集更多数据（增加 $M$）而正确地消失，使得正则化的效果在采样良好的系统中可以忽略不计。因此，该方法以统计上健全的方式防止了发散并保持了物理行为，共享了陈述A中概述的所有理想属性。\n因此，这个陈述是**正确的**。",
            "answer": "$$\\boxed{AE}$$"
        },
        {
            "introduction": "粗粒化建模中的一个核心问题是：一个能准确再现体系结构（即RDF）的势函数，是否也能同时再现其热力学性质（如压强）？本练习将直面这个“可表示性问题”。通过一个给定的目标RDF构建势函数，并用其计算体系的压强，你将亲自验证结构匹配并不能保证热力学一致性。这是多尺度建模领域一个至关重要的概念。",
            "id": "3771894",
            "problem": "在多尺度建模和分析中，一项核心任务是优化粗粒化对势，使得由其产生的结构（通过径向分布函数（RDF）$g(r)$来量化）与从更高分辨率模型中获得的目标结构相匹配。迭代玻尔兹曼反演（IBI）旨在寻找一个能够再现指定$g(r)$的对势，但匹配$g(r)$通常不能保证热力学上的一致性（例如，匹配压力$P$）。本问题要求您通过在中低密度下使用简化的IBI论证，经由维里路径计算压力，并将其与同一状态点下单另给定的父体系压力进行比较，从而构建一个物理上合理的例子来展示这种可表示性问题。\n\n您必须基于以下基本原理进行工作：\n\n- 在稀疏气体极限下，径向分布函数$g(r)$通过玻尔兹曼因子与对势$u(r)$相关联，$$g(r) = \\exp\\!\\big(-\\beta\\,u(r)\\big),$$ 其中 $\\beta = 1/(k_{\\mathrm{B}} T)$，$k_{\\mathrm{B}}$是玻尔兹曼常数，$T$是绝对温度。在此极限下，作为迭代玻尔兹曼反演（IBI）基础的单步玻尔兹曼反演得到 $$u(r) = -k_{\\mathrm{B}} T \\,\\ln g(r).$$\n- 对于具有对相互作用的各向同性流体，其压力的维里方程（维里路径）为 $$P = \\rho\\,k_{\\mathrm{B}} T - \\frac{2\\pi}{3}\\,\\rho^{2}\\int_{0}^{\\infty} r^{3} \\,u'(r)\\,g(r)\\,\\mathrm{d}r,$$ 其中 $\\rho$ 是数密度，$u'(r)$表示$u(r)$对$r$的导数。\n\n对于每个测试用例，您的程序必须执行以下操作：\n\n1. 假设一个物理上合理的目标$g(r)$，它由软核排斥和阻尼振荡组成：\n   $$g(r) = \\max\\Big(\\epsilon,\\;\\exp\\!\\big(-a\\,(\\sigma/r)^{p}\\big)\\;\\big[1 + A\\,\\exp\\!\\big(-\\alpha\\,(r-\\sigma)\\big)\\,\\sin\\!\\big(\\omega\\,(r-\\sigma)\\big)\\big]\\Big),$$\n   对于 $r \\in (0,r_{\\max}]$，其参数为 $a0$, $p0$, $A$, $\\alpha0$, $\\omega0$，核心长度尺度 $\\sigma0$，以及一个用于保持正性的小下限值 $\\epsilon0$。这种构造确保了在 $r\\ll\\sigma$ 时存在陡峭但有限的排斥，并在 $r\\gtrsim\\sigma$ 时存在物理上合理的阻尼振荡。所有测试用例使用相同的 $\\epsilon$。\n\n2. 使用稀疏气体玻尔兹曼反演构建对势\n   $$u(r) = -k_{\\mathrm{B}} T \\,\\ln g(r).$$\n\n3. 在均匀径向网格 $r_i = i\\,\\Delta r$（$i=1,2,\\ldots,N$，$\\Delta r = r_{\\max}/N$）上，使用数值微分计算$u'(r)$并使用数值积分计算加权积分，从而离散化压力的维里表达式。计算\n   $$P_{\\mathrm{IBI}} = \\rho\\,k_{\\mathrm{B}} T - \\frac{2\\pi}{3}\\,\\rho^{2}\\int_{0}^{r_{\\max}} r^{3} \\,u'(r)\\,g(r)\\,\\mathrm{d}r,$$\n   其中积分通过网格上合适的求积方法进行近似。\n\n4. 将 $P_{\\mathrm{IBI}}$ 与同一状态点的指定父体系压力 $P_{\\mathrm{parent}}$ 进行比较，该压力代表了提供目标$g(r)$的原始更高分辨率模型中测得的热力学压力。报告绝对误差\n   $$E = \\big|P_{\\mathrm{IBI}} - P_{\\mathrm{parent}}\\big|.$$\n\n物理单位：能量以 $k_{\\mathrm{B}} T$ 为单位，长度以 $\\sigma$ 为单位，压力以 $k_{\\mathrm{B}} T/\\sigma^{3}$ 为单位。所有数值答案必须是单位为 $k_{\\mathrm{B}} T/\\sigma^{3}$ 的浮点数。\n\n角度单位：正弦函数内的所有角度均以弧度为单位。\n\n测试套件：使用以下四个测试用例，每个用例由 $(k_{\\mathrm{B}} T,\\rho,\\sigma,a,p,A,\\alpha,\\omega,r_{\\max},\\Delta r,P_{\\mathrm{parent}})$ 指定。\n\n- 用例1（一般“顺利”情况）：(1.0, 0.8, 1.0, 5.0, 12, 0.2, 3.0, 7.0, 6.0, 0.002, 2.50)\n- 用例2（低密度边缘情况）：(1.0, 0.05, 1.0, 5.0, 12, 0.1, 4.0, 8.0, 6.0, 0.002, 0.05)\n- 用例3（强近接触振荡边界情况）：(1.0, 0.9, 1.0, 5.0, 12, 0.35, 2.0, 9.0, 6.0, 0.002, 3.00)\n- 用例4（长程相关尾部情况）：(1.0, 0.6, 1.0, 5.0, 12, 0.05, 0.7, 5.0, 6.0, 0.002, 1.20)\n\n最终输出格式：您的程序应生成一行输出，其中包含所有测试用例的绝对误差$E$，格式为一个逗号分隔的十进制浮点数列表，保留$5$位小数并用方括号括起来，例如 $$[e_1,e_2,e_3,e_4].$$",
            "solution": "该问题要求在粗粒化建模框架内研究可表示性问题，特别是使用迭代玻尔兹曼反演（IBI）方法。核心任务是证明，通过单步玻尔兹曼反演从目标径向分布函数$g(r)$导出的对势$u(r)$，不一定能再现原始高分辨率系统（$g(r)$的来源）的其他热力学性质，例如压力$P$。这一目标是通过使用导出的势计算压力$P_{\\mathrm{IBI}}$，并将其与给定的父体系压力$P_{\\mathrm{parent}}$进行比较来完成的。\n\n基本原理是在低密度极限下对势与径向分布函数之间的关系，以及压力的维里状态方程。该分析在一个无量纲单位体系中进行，其中能量以$k_{\\mathrm{B}} T$为单位，长度以特征尺度$\\sigma$为单位。因此，我们设定玻尔兹曼常数与温度的乘积$k_{\\mathrm{B}} T = 1$，长度尺度$\\sigma = 1$。压力则以$k_{\\mathrm{B}} T / \\sigma^3$为单位表示。\n\n**步骤1：系统定义与目标结构**\n\n系统由一个目标径向分布函数$g(r)$以及由数密度$\\rho$和温度$T$给出的状态点来定义。目标$g(r)$的函数形式如下：\n$$g(r) = \\max\\Big(\\epsilon,\\;\\exp\\!\\big(-a\\,(\\sigma/r)^{p}\\big)\\;\\big[1 + A\\,\\exp\\!\\big(-\\alpha\\,(r-\\sigma)\\big)\\,\\sin\\!\\big(\\omega\\,(r-\\sigma)\\big)\\big]\\Big)$$\n在这里，$\\epsilon$是一个很小的正常数（例如，$\\epsilon = 10^{-12}$），以确保$g(r)$严格为正，这对于后续的对数运算是必需的。项$\\exp(-a(\\sigma/r)^p)$模拟了一个软排斥核，而第二项引入了液体结构特有的阻尼振荡。参数$(a, p, A, \\alpha, \\omega, \\sigma)$控制了该函数的形状。\n\n**步骤2：通过玻尔兹曼反演推导势函数**\n\n在稀疏气体极限下，对势$u(r)$通过玻尔兹曼因子与$g(r)$相关，$g(r) = \\exp(-\\beta u(r))$，其中$\\beta = 1/(k_{\\mathrm{B}} T)$。反转此关系可得到势函数：\n$$u(r) = -k_{\\mathrm{B}} T \\ln g(r)$$\n这种单步反演是IBI方法的基础。在我们选择的无量纲单位中，$k_{\\mathrm{B}} T = 1$，因此上式简化为：\n$$u(r) = -\\ln g(r)$$\n构建此势函数的目的是在反演方法的假设范围内再现目标结构$g(r)$。\n\n**步骤3：通过维里路径计算压力**\n\n对于通过对势$u(r)$相互作用的各向同性流体，其压力可以使用维里方程计算：\n$$P = \\rho\\,k_{\\mathrm{B}} T - \\frac{2\\pi}{3}\\,\\rho^{2}\\int_{0}^{\\infty} r^{3} \\,u'(r)\\,g(r)\\,\\mathrm{d}r$$\n其中$u'(r) = \\mathrm{d}u/\\mathrm{d}r$。第一项$\\rho k_{\\mathrm{B}} T$是理想气体压力，第二项是粒子相互作用的贡献。为了计算我们导出的势$u(r)$所预测的压力$P_{\\mathrm{IBI}}$，我们将其代入维里方程。积分在截断半径$r_{\\max}$处被截断，这是模拟中的标准做法，并且在相关性衰减足够快的情况下是合理的。在我们的无量纲单位中，$P_{\\mathrm{IBI}}$的表达式变为：\n$$P_{\\mathrm{IBI}} = \\rho - \\frac{2\\pi}{3}\\,\\rho^{2}\\int_{0}^{r_{\\max}} r^{3} \\,u'(r)\\,g(r)\\,\\mathrm{d}r$$\n\n**步骤4：数值实现**\n\n该计算在离散的径向网格上以数值方式执行。\n1.  **网格生成**：为 $i=1, 2, \\ldots, N$（其中 $N = r_{\\max}/\\Delta r$）创建均匀网格 $r_i = i\\,\\Delta r$。网格从$r_1 = \\Delta r$延伸到$r_N = r_{\\max}$，以避免$r=0$处的奇点。\n2.  **函数求值**：在网格上的每个点$r_i$处，计算函数$g(r)$以及其后的$u(r) = -\\ln g(r)$。\n3.  **数值微分**：势的导数$u'(r)$通过数值方法计算。我们对内部网格点采用二阶中心差分公式 $u'(r_i) = (u(r_{i+1}) - u(r_{i-1}))/(2\\Delta r)$，对边界点采用一阶前向/后向差分。\n4.  **数值积分**：维里方程的被积函数 $F(r) = r^3 u'(r) g(r)$ 在网格上求值。然后使用梯形法则对积分进行近似：\n    $$I = \\int_{\\Delta r}^{r_{\\max}} F(r)\\,\\mathrm{d}r \\approx \\sum_{i=1}^{N-1} \\frac{F(r_i) + F(r_{i+1})}{2} \\Delta r$$\n    区间$[0, \\Delta r)$的贡献被忽略，这对于小的$\\Delta r$是合理的近似。\n\n**步骤5：误差分析**\n\n最后，对于每个测试用例，将计算出的压力$P_{\\mathrm{IBI}}$与给定的父体系压力$P_{\\mathrm{parent}}$进行比较。绝对误差$E$量化了热力学上的不一致性：\n$$E = |P_{\\mathrm{IBI}} - P_{\\mathrm{parent}}|$$\n非零误差$E$表明，通过简单的玻尔兹曼反演导出的势，虽然旨在匹配系统的结构（$g(r)$），但未能一致地再现其热力学性质（压力）。这种差异正是可表示性问题，而更高级的粗粒化技术，如带有压力校正的完整迭代IBI，正是为了解决这个问题。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the pressure inconsistency in a simplified Iterative Boltzmann Inversion (IBI)\n    framework by calculating the absolute error between the pressure derived from a \n    Boltzmann-inverted potential and a given target pressure.\n    \"\"\"\n\n    # A small positive constant to ensure g(r) > 0.\n    # It is not specified, so a standard small float is chosen.\n    epsilon = 1.0e-12\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (kBT, rho, sigma, a, p, A, alpha, omega, r_max, dr, P_parent)\n    test_cases = [\n        (1.0, 0.8, 1.0, 5.0, 12, 0.2, 3.0, 7.0, 6.0, 0.002, 2.50),\n        (1.0, 0.05, 1.0, 5.0, 12, 0.1, 4.0, 8.0, 6.0, 0.002, 0.05),\n        (1.0, 0.9, 1.0, 5.0, 12, 0.35, 2.0, 9.0, 6.0, 0.002, 3.00),\n        (1.0, 0.6, 1.0, 5.0, 12, 0.05, 0.7, 5.0, 6.0, 0.002, 1.20),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        kBT, rho, sigma, a, p, A, alpha, omega, r_max, dr, P_parent = case\n\n        # 1. Create the radial grid. The grid is r_i = i * dr for i=1,...,N.\n        # This means it starts at dr, not 0.\n        N = int(r_max / dr)\n        r = np.arange(1, N + 1) * dr\n\n        # 2. Assume a physically plausible target g(r).\n        # The equation for g(r) is:\n        # g(r) = max(eps, exp(-a(sigma/r)^p) * [1 + A*exp(-alpha*(r-sigma))*sin(omega*(r-sigma))])\n        # The angle for sin is in radians, which is numpy's default.\n        soft_core_term = np.exp(-a * (sigma / r)**p)\n        oscillatory_term = 1 + A * np.exp(-alpha * (r - sigma)) * np.sin(omega * (r - sigma))\n        g_r = np.maximum(epsilon, soft_core_term * oscillatory_term)\n\n        # 3. Use dilute-gas Boltzmann inversion to construct u(r).\n        # u(r) = -kBT * ln(g(r))\n        u_r = -kBT * np.log(g_r)\n\n        # 4. Compute u'(r) numerically.\n        # np.gradient uses second-order central differences for interior points.\n        u_prime_r = np.gradient(u_r, dr)\n\n        # 5. Compute the virial expression for pressure P_IBI.\n        # P_IBI = rho*kBT - (2*pi/3) * rho^2 * integral(r^3 * u'(r) * g(r) * dr)\n        \n        # Define the integrand for the virial integral\n        integrand = r**3 * u_prime_r * g_r\n        \n        # Perform numerical integration using the trapezoidal rule\n        virial_integral = np.trapz(integrand, r)\n        \n        # Calculate P_IBI\n        P_IBI = rho * kBT - (2 * np.pi / 3) * rho**2 * virial_integral\n\n        # 6. Report the absolute error E.\n        # E = |P_IBI - P_parent|\n        error = np.abs(P_IBI - P_parent)\n        \n        results.append(\"{:.5f}\".format(error))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}