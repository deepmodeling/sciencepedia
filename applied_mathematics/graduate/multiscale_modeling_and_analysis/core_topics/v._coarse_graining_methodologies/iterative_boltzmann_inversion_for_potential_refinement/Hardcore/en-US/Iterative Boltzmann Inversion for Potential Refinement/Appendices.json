{
    "hands_on_practices": [
        {
            "introduction": "This practice focuses on the fundamental update step at the heart of the Iterative Boltzmann Inversion (IBI) method. By working through a concrete example , you will directly apply the core principle that connects a deviation in the simulated radial distribution function, $g_n(r)$, from its target, $g^*(r)$, to a corrective adjustment in the pair potential, $U(r)$. This exercise will solidify your understanding of how IBI systematically refines the potential to make it more repulsive in regions where particle density is too high, and more attractive where it is too low.",
            "id": "3771866",
            "problem": "Consider a binary coarse-grained fluid composed of species $A$ and $B$ in the canonical ensemble at temperature $T$, with pairwise additive interactions $U_{AA}(r)$, $U_{AB}(r)$, and $U_{BB}(r)$. The radial distribution function (RDF) $g_{\\alpha\\beta}(r)$ for species $\\alpha,\\beta \\in \\{A,B\\}$ is defined as the ratio of the local pair density to the ideal-gas pair density at separation $r$. Assume the system is simulated at fixed number density and composition. You are using iterative Boltzmann inversion (IBI) for potential refinement, with a mixing parameter $\\eta \\in (0,1)$.\n\nAt the current iteration $n$, the measured RDFs satisfy $g_{AA,n}(r) = g_{AA}^{*}(r)$ for all $r$, where $g_{\\alpha\\beta}^{*}(r)$ denotes the target RDF. For the cross interaction, you observe the following piecewise-constant ratio of the measured to target RDF:\n- For $0.85\\,\\mathrm{nm} \\le r  0.95\\,\\mathrm{nm}$, $g_{AB,n}(r)/g_{AB}^{*}(r) = 1.25$.\n- For $1.35\\,\\mathrm{nm} \\le r  1.55\\,\\mathrm{nm}$, $g_{AB,n}(r)/g_{AB}^{*}(r) = 1.10$.\n- Elsewhere (for all other $r$), $g_{AB,n}(r)/g_{AB}^{*}(r) = 1$.\n\nAssume that the change in the pair potential yields, to leading order, a local change in the logarithm of the RDF consistent with equilibrium statistical mechanics. Derive from first principles the IBI update that reduces deviations in $g_{AB}(r)$ toward $g_{AB}^{*}(r)$ while leaving $U_{AA}(r)$ unchanged, and use it to compute the explicit analytic expression for the dimensionless update $\\Delta U_{AB}(r)/(k_{B}T)$ as a function of $r$, where $\\Delta U_{AB}(r) := U_{AB}^{(n+1)}(r) - U_{AB}^{(n)}(r)$, $k_{B}$ is the Boltzmann constant, and $T$ is the absolute temperature. Take the mixing parameter to be $\\eta = 0.40$.\n\nReport your final expression for $\\Delta U_{AB}(r)/(k_{B}T)$ as a single piecewise-defined analytic function of $r$. No numerical rounding is required. Since the requested quantity is normalized by $k_{B}T$, it is dimensionless; use nanometers for $r$ when identifying the radial intervals in your derivation.",
            "solution": "The user has requested that I first validate the problem statement.\n\n### Step 1: Extract Givens\n- **System:** A binary coarse-grained fluid of species $A$ and $B$.\n- **Thermodynamic Ensemble:** Canonical ensemble (constant $N$, $V$, $T$).\n- **Temperature:** $T$.\n- **Interactions:** Pairwise additive potentials $U_{AA}(r)$, $U_{AB}(r)$, and $U_{BB}(r)$.\n- **Definition:** The radial distribution function (RDF) $g_{\\alpha\\beta}(r)$ is the ratio of local pair density to ideal-gas pair density.\n- **Conditions:** Fixed number density and composition.\n- **Method:** Iterative Boltzmann Inversion (IBI).\n- **Mixing Parameter:** $\\eta = 0.40$.\n- **State at Iteration $n$:**\n  - $g_{AA,n}(r) = g_{AA}^{*}(r)$ for all $r$, where $g_{\\alpha\\beta}^{*}(r)$ is the target RDF.\n  - The ratio $g_{AB,n}(r)/g_{AB}^{*}(r)$ is a piecewise-constant function:\n    - $1.25$ for $0.85\\,\\mathrm{nm} \\le r  0.95\\,\\mathrm{nm}$.\n    - $1.10$ for $1.35\\,\\mathrm{nm} \\le r  1.55\\,\\mathrm{nm}$.\n    - $1$ for all other values of $r$.\n- **Fundamental Assumption:** \"the change in the pair potential yields, to leading order, a local change in the logarithm of the RDF consistent with equilibrium statistical mechanics.\"\n- **Objective:**\n  1. Derive the IBI update rule from first principles to correct for deviations in $g_{AB}(r)$.\n  2. The potential $U_{AA}(r)$ must remain unchanged.\n  3. Compute the explicit analytic expression for the dimensionless update $\\Delta U_{AB}(r)/(k_{B}T)$, where $\\Delta U_{AB}(r) := U_{AB}^{(n+1)}(r) - U_{AB}^{(n)}(r)$.\n- **Constants:** $k_{B}$ is the Boltzmann constant.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is firmly rooted in the principles of statistical mechanics and computational chemistry. The iterative Boltzmann inversion (IBI) method is a standard technique for developing coarse-grained potentials. The relationship between the potential of mean force and the radial distribution function is a fundamental concept. All givens are scientifically sound.\n- **Well-Posed:** The problem provides all necessary information: the current state of the system via RDFs, the target RDFs (implicitly through the ratio), the specific algorithm (IBI), the mixing parameter, and the physical constants. The objective is to compute a well-defined mathematical expression. A unique solution exists.\n- **Objective:** The problem is phrased in precise, unambiguous scientific language. There are no subjective or opinion-based clauses.\n- **Flaw Checklist:**\n  1. **Scientific Unsoundness:** The physics is correct. No violations of scientific principles.\n  2. **Non-Formalizable/Irrelevant:** The problem is directly relevant to IBI in multiscale modeling and is readily formalizable.\n  3. **Incomplete/Contradictory:** The data are sufficient and consistent. The condition $g_{AA,n}(r) = g_{AA}^{*}(r)$ correctly implies that no update is needed for $U_{AA}(r)$, which aligns with the request to leave it unchanged.\n  4. **Unrealistic/Infeasible:** The given RDF ratios and distance scales are typical for molecular simulations.\n  5. **Ill-Posed:** The problem is well-structured and leads to a unique, stable solution.\n  6. **Pseudo-Profound/Trivial:** The problem requires a correct derivation and application of a non-trivial algorithm, testing conceptual understanding.\n  7. **Outside Scientific Verifiability:** The result is mathematically derivable and verifiable.\n\n### Step 3: Verdict and Action\nThe problem is valid. The solution process will now proceed.\n\nThe fundamental principle underlying iterative Boltzmann inversion (IBI) is the relationship between the radial distribution function (RDF), $g(r)$, and the potential of mean force (PMF), $W(r)$, in the canonical ensemble. This relationship is given by:\n$$ g(r) = \\exp\\left(-\\frac{W(r)}{k_{B}T}\\right) $$\nwhere $k_{B}$ is the Boltzmann constant and $T$ is the absolute temperature. This equation can be inverted to express the PMF in terms of the RDF:\n$$ W(r) = -k_{B}T \\ln(g(r)) $$\nIn a dilute system, the PMF is approximately equal to the pair potential, $W(r) \\approx U(r)$. In dense systems, $W(r)$ includes contributions from many-body correlations, so $U(r) \\neq W(r)$. The IBI method is a heuristic, iterative procedure designed to refine the pair potential $U(r)$ such that a simulation using this potential reproduces a target RDF, $g^{*}(r)$.\n\nThe IBI update rule is derived based on the assumption that a correction to the potential, $\\Delta U(r)$, will result in a corresponding correction to the PMF. The goal is to drive the simulated RDF at iteration $n$, $g_{n}(r)$, towards the target RDF, $g^{*}(r)$.\n\nThe PMF corresponding to the simulated RDF is $W_{n}(r) = -k_{B}T \\ln(g_{n}(r))$. The PMF that would produce the target RDF is $W^{*}(r) = -k_{B}T \\ln(g^{*}(r))$. The difference between the current potential and the ideal potential is assumed to be related to the difference between the current PMF and the target PMF. A simple inversion suggests a potential correction of:\n$$ \\Delta U(r) \\approx W^{*}(r) - W_{n}(r) = -k_{B}T \\ln(g^{*}(r)) - \\left(-k_{B}T \\ln(g_{n}(r))\\right) = k_{B}T \\ln\\left(\\frac{g_{n}(r)}{g^{*}(r)}\\right) $$\nIf $g_{n}(r) > g^{*}(r)$, the probability of finding particles at separation $r$ is too high. To correct this, the potential $U(r)$ should be increased (made more repulsive), leading to a positive update $\\Delta U(r) > 0$. The expression $\\ln(g_n(r)/g^*(r))$ is positive when $g_n(r) > g^*(r)$, so this form of the correction is physically consistent.\n\nTo ensure stability and prevent over-correction, the update is scaled by a mixing parameter $\\eta$, with $0  \\eta \\le 1$. The IBI update rule for the potential from iteration $n$ to $n+1$ is therefore:\n$$ \\Delta U_{\\alpha\\beta}(r) = U_{\\alpha\\beta}^{(n+1)}(r) - U_{\\alpha\\beta}^{(n)}(r) = \\eta \\, k_{B} T \\ln\\left(\\frac{g_{\\alpha\\beta,n}(r)}{g_{\\alpha\\beta}^{*}(r)}\\right) $$\nThe problem asks for the dimensionless update $\\frac{\\Delta U_{AB}(r)}{k_{B}T}$ for the cross-interaction potential. Dividing the general update rule by $k_{B}T$, we get:\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\eta \\ln\\left(\\frac{g_{AB,n}(r)}{g_{AB}^{*}(r)}\\right) $$\nWe are given the mixing parameter $\\eta = 0.40$ and a piecewise definition for the ratio $\\frac{g_{AB,n}(r)}{g_{AB}^{*}(r)}$. We can express $\\eta$ as an exact fraction, $\\eta = \\frac{40}{100} = \\frac{2}{5}$. We now apply this formula to each interval of $r$.\n\nFor the interval $0.85\\,\\mathrm{nm} \\le r  0.95\\,\\mathrm{nm}$:\nThe ratio is given as $1.25$, which is $\\frac{5}{4}$.\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\frac{2}{5} \\ln\\left(1.25\\right) = \\frac{2}{5} \\ln\\left(\\frac{5}{4}\\right) $$\nSince the ratio is greater than $1$, the potential is increased to reduce the pair probability.\n\nFor the interval $1.35\\,\\mathrm{nm} \\le r  1.55\\,\\mathrm{nm}$:\nThe ratio is given as $1.10$, which is $\\frac{11}{10}$.\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\frac{2}{5} \\ln\\left(1.10\\right) = \\frac{2}{5} \\ln\\left(\\frac{11}{10}\\right) $$\nHere too, the ratio is greater than $1$, so the potential is increased.\n\nFor all other values of $r$ (\"elsewhere\"):\nThe ratio is given as $1$.\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\frac{2}{5} \\ln(1) = \\frac{2}{5} \\times 0 = 0 $$\nAs expected, where the simulated RDF matches the target RDF, no correction is applied to the potential.\n\nThe problem also notes that $g_{AA,n}(r) = g_{AA}^{*}(r)$ for all $r$. For the $A-A$ interaction, the update would be:\n$$ \\frac{\\Delta U_{AA}(r)}{k_{B}T} = \\eta \\ln\\left(\\frac{g_{AA,n}(r)}{g_{AA}^{*}(r)}\\right) = \\eta \\ln(1) = 0 $$\nThis confirms that $U_{AA}(r)$ is indeed left unchanged, consistent with the problem's constraints.\n\nCombining these results, we obtain the complete piecewise-defined analytic function for the dimensionless update to the cross-interaction potential:\n$$ \\frac{\\Delta U_{AB}(r)}{k_{B}T} = \\begin{cases} \\frac{2}{5} \\ln\\left(\\frac{5}{4}\\right)  \\text{for } 0.85 \\le r  0.95 \\, (\\text{in nm}) \\\\ \\frac{2}{5} \\ln\\left(\\frac{11}{10}\\right)  \\text{for } 1.35 \\le r  1.55 \\, (\\text{in nm}) \\\\ 0  \\text{otherwise} \\end{cases} $$\nThis expression represents the final answer, derived from the fundamental principles of IBI.",
            "answer": "$$\n\\frac{\\Delta U_{AB}(r)}{k_{B}T} = \n\\boxed{\n\\begin{cases}\n\\frac{2}{5} \\ln\\left(\\frac{5}{4}\\right)  \\text{for } 0.85 \\le r  0.95 \\, (\\text{in nm}) \\\\\n\\frac{2}{5} \\ln\\left(\\frac{11}{10}\\right)  \\text{for } 1.35 \\le r  1.55 \\, (\\text{in nm}) \\\\\n0  \\text{otherwise}\n\\end{cases}\n}\n$$"
        },
        {
            "introduction": "Moving from a single update to the full iterative procedure introduces the critical concept of stability. This exercise  uses a simplified, analytically tractable toy model to explore the conditions under which the IBI iteration converges to the correct solution or diverges due to an overly aggressive update step. By deriving and implementing the iterative map, you will gain a deep, practical intuition for the role of the update step size, $\\alpha$, and its interplay with the system's intrinsic sensitivity, demonstrating a core principle applicable to a wide range of iterative numerical methods.",
            "id": "3771861",
            "problem": "You are asked to construct and analyze a toy counterexample within the framework of multiscale modeling and analysis that demonstrates divergence of Iterative Boltzmann Inversion (IBI) when the step size is too large due to an overly sensitive radial distribution function response. The goal is to proceed from fundamental principles to a runnable algorithmic demonstration.\n\nConsider a system at equilibrium in the canonical ensemble with pair interactions that are dilute enough to be well approximated by two-body statistics. Let the radial distribution function be denoted by $g(r)$ and the pair potential by $u(r)$. In the dilute limit, the canonical ensemble implies that the pair correlation is governed by a Boltzmann factor. In this problem, you will work with a toy observation model that amplifies sensitivity: define a measured radial distribution function $\\tilde{g}(r)$ by a power-law sensitivity $\\tilde{g}(r) = \\left[g(r)\\right]^{\\gamma}$ with sensitivity exponent $\\gamma  0$. The intent is to create an overly sensitive $g(r)$ response that destabilizes standard potential refinement updates when the step size is too large.\n\nTo make the analysis purely mathematical and universal while retaining the statistical mechanics meaning, restrict attention to a one-parameter potential ansatz with a constant amplitude $u$ that is independent of $r$ and is measured in units of the thermal energy scale so that energies are dimensionless with respect to $k_{\\mathrm{B}}T$. The target system has a true amplitude $u_{\\text{true}}$, and an iterative estimate $u_n$ is refined by an IBI-style update using the discrepancy between the measured and target radial distribution functions. You must start from canonical ensemble definitions and the dilute-limit Boltzmann relation, and from those derive the update rule in terms of $u_n$, $u_{\\text{true}}$, the IBI step size $\\alpha > 0$, and the sensitivity exponent $\\gamma$. Do not assume any pre-given refinement formula; derive it explicitly from the fundamental definitions. You may adopt $k_{\\mathrm{B}}T = 1$ (dimensionless energy units) to simplify expressions.\n\nImplement a program that:\n- Derives and applies the correct scalar IBI update for this toy system to iteratively refine $u_n$ toward $u_{\\text{true}}$.\n- Uses an initial guess $u_0 = 0$ and a target amplitude $u_{\\text{true}} = 1$ (dimensionless, scaled by $k_{\\mathrm{B}}T$).\n- Classifies a run as convergent if the absolute error $|u_n - u_{\\text{true}}|$ becomes less than a tolerance $10^{-9}$ within a maximum number of iterations $10{,}000$, and the sequence does not blow up numerically. Otherwise classify it as divergent. Angles do not appear in this problem, and energies are dimensionless as specified, so no additional unit conversions are needed.\n\nYour test suite must include the following five parameter sets to probe different regimes:\n1. A typical convergent case: $\\alpha = 0.5$, $\\gamma = 1.0$.\n2. A boundary case exactly at the instability threshold for oscillation without decay: $\\alpha = \\tfrac{4}{3}$, $\\gamma = 1.5$.\n3. A divergent case due to excessive sensitivity and step size: $\\alpha = 2.1$, $\\gamma = 1.1$.\n4. A convergent but slow case with extremely high sensitivity mitigated by a tiny step size: $\\alpha = 0.0001$, $\\gamma = 1000$.\n5. A near-critical case with slow convergent oscillations: $\\alpha = 1.9$, $\\gamma = 1.05$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each result is a boolean indicating convergence (true) or divergence (false) for the corresponding test case, in the order listed above. For example, the output format must be exactly like $[\\mathrm{True},\\mathrm{False},\\mathrm{True},\\mathrm{False},\\mathrm{True}]$ on a single line, without any extra characters or spaces or text.",
            "solution": "The problem requires the derivation and analysis of a simplified Iterative Boltzmann Inversion (IBI) scheme to demonstrate convergence and divergence regimes. The derivation begins from fundamental principles of statistical mechanics in the canonical ensemble, specialized to a toy model.\n\nFirst, we establish the relationship between the pair potential, $u(r)$, and the radial distribution function, $g(r)$. In the dilute limit, the probability of finding a pair of particles at a separation $r$ is proportional to the Boltzmann factor, $\\exp(-u(r)/(k_{\\mathrm{B}} T))$. The radial distribution function is normalized such that $g(r) \\to 1$ as $r \\to \\infty$, where the potential $u(r) \\to 0$. This leads to the fundamental relation:\n$$g(r) = \\exp\\left(-\\frac{u(r)}{k_{\\mathrm{B}} T}\\right)$$\nThe problem specifies that energies are dimensionless with respect to the thermal energy scale, which is equivalent to setting the product of the Boltzmann constant $k_{\\mathrm{B}}$ and temperature $T$ to unity: $k_{\\mathrm{B}} T = 1$. The potential is further simplified to an ansatz that is independent of the separation $r$, having a constant amplitude $u$, i.e., $u(r) = u$. Consequently, the radial distribution function $g$ is also a constant:\n$$g = \\exp(-u)$$\nThe problem introduces a toy observation model that modifies the \"measured\" radial distribution function, denoted $\\tilde{g}(r)$, with a sensitivity exponent $\\gamma > 0$:\n$$\\tilde{g}(r) = \\left[g(r)\\right]^{\\gamma}$$\nSubstituting our constant-potential expression for $g(r)$, we find the relationship between the measured observable $\\tilde{g}$ and the underlying potential amplitude $u$:\n$$\\tilde{g} = [\\exp(-u)]^{\\gamma} = \\exp(-\\gamma u)$$\nThe core of the problem is to derive the IBI update rule. The standard IBI algorithm refines a potential estimate $u_n(r)$ to $u_{n+1}(r)$ based on the discrepancy between the RDF produced by the current potential, $g_n(r)$, and the target RDF, $g_{\\text{target}}(r)$. The update rule is:\n$$u_{n+1}(r) = u_n(r) + \\alpha k_{\\mathrm{B}} T \\ln\\left(\\frac{g_n(r)}{g_{\\text{target}}(r)}\\right)$$\nwhere $\\alpha > 0$ is the step size or learning rate. For our simplified scalar model, using the measured RDF $\\tilde{g}$ and $k_{\\mathrm{B}} T = 1$, the rule becomes:\n$$u_{n+1} = u_n + \\alpha \\ln\\left(\\frac{\\tilde{g}_n}{\\tilde{g}_{\\text{target}}}\\right)$$\nHere, $\\tilde{g}_n$ is the observable corresponding to the potential estimate $u_n$, and $\\tilde{g}_{\\text{target}}$ is the observable for the true potential $u_{\\text{true}}$. Using our derived relation $\\tilde{g} = \\exp(-\\gamma u)$, we have:\n$$\\tilde{g}_n = \\exp(-\\gamma u_n)$$\n$$\\tilde{g}_{\\text{target}} = \\exp(-\\gamma u_{\\text{true}})$$\nSubstituting these into the update rule yields:\n$$u_{n+1} = u_n + \\alpha \\ln\\left(\\frac{\\exp(-\\gamma u_n)}{\\exp(-\\gamma u_{\\text{true}})}\\right)$$\nUsing the property of logarithms $\\ln(a/b) = \\ln(a) - \\ln(b)$ and $\\ln(\\exp(x)) = x$:\n$$u_{n+1} = u_n + \\alpha \\left( \\ln(\\exp(-\\gamma u_n)) - \\ln(\\exp(-\\gamma u_{\\text{true}})) \\right)$$\n$$u_{n+1} = u_n + \\alpha (-\\gamma u_n + \\gamma u_{\\text{true}})$$\n$$u_{n+1} = u_n - \\alpha \\gamma u_n + \\alpha \\gamma u_{\\text{true}}$$\nThis simplifies to the final linear iterative map for the potential amplitude:\n$$u_{n+1} = (1 - \\alpha \\gamma) u_n + \\alpha \\gamma u_{\\text{true}}$$\nTo analyze the convergence of this iteration, we examine the evolution of the error, $e_n = u_n - u_{\\text{true}}$. Subtracting $u_{\\text{true}}$ from both sides of the update equation:\n$$u_{n+1} - u_{\\text{true}} = (1 - \\alpha \\gamma) u_n + \\alpha \\gamma u_{\\text{true}} - u_{\\text{true}}$$\n$$e_{n+1} = (1 - \\alpha \\gamma) u_n - (1 - \\alpha \\gamma) u_{\\text{true}}$$\n$$e_{n+1} = (1 - \\alpha \\gamma) (u_n - u_{\\text{true}})$$\n$$e_{n+1} = (1 - \\alpha \\gamma) e_n$$\nThis recurrence relation shows that the error at each step is multiplied by a constant factor $C = 1 - \\alpha \\gamma$. The iteration converges if and only if the magnitude of this factor is strictly less than $1$:\n$$|C| = |1 - \\alpha \\gamma|  1$$\nThis inequality is equivalent to $-1  1 - \\alpha \\gamma  1$. Subtracting $1$ from all parts gives $-2  -\\alpha \\gamma  0$. Since $\\alpha > 0$ and $\\gamma > 0$, we can multiply by $-1$ and reverse the inequalities to find the condition for convergence:\n$$0  \\alpha \\gamma  2$$\nThe condition $\\alpha \\gamma > 0$ is always met. Therefore, the iteration converges if and only if $\\alpha \\gamma  2$.\n- If $0  \\alpha \\gamma  1$, convergence is monotonic.\n- If $1 \\le \\alpha \\gamma  2$, convergence is oscillatory.\n- If $\\alpha \\gamma = 2$, the system undergoes stable oscillations and does not converge.\n- If $\\alpha \\gamma > 2$, the iteration diverges.\n\nThe implementation will simulate this iterative process for each specified parameter set $(\\alpha, \\gamma)$ with initial guess $u_0 = 0$ and target $u_{\\text{true}} = 1$. A run is classified as convergent if the absolute error $|u_n - u_{\\text{true}}|$ falls below the tolerance of $10^{-9}$ within $10,000$ iterations, and divergent otherwise. A check for numerical overflow (divergence) is also included.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the iterative Boltzmann inversion problem for five test cases.\n    \"\"\"\n\n    # Define the parameters from the problem statement.\n    test_cases = [\n        # (alpha, gamma)\n        (0.5, 1.0),\n        (4.0 / 3.0, 1.5),\n        (2.1, 1.1),\n        (0.0001, 1000.0),\n        (1.9, 1.05),\n    ]\n\n    u_initial = 0.0\n    u_true = 1.0\n    tolerance = 1e-9\n    max_iterations = 10000\n    blowup_threshold = 1e10\n\n    results = []\n\n    for alpha, gamma in test_cases:\n        u_n = u_initial\n        converged = False\n        \n        # The derived iterative update rule is:\n        # u_{n+1} = (1 - alpha * gamma) * u_n + alpha * gamma * u_true\n        # Pre-calculate the constant terms for efficiency\n        factor = 1.0 - alpha * gamma\n        addend = alpha * gamma * u_true\n\n        for _ in range(max_iterations):\n            # Check for numerical instability (divergence)\n            if abs(u_n) > blowup_threshold:\n                converged = False\n                break\n            \n            # Check for convergence\n            if abs(u_n - u_true)  tolerance:\n                converged = True\n                break\n            \n            # Apply the update rule\n            u_n = factor * u_n + addend\n        \n        results.append(converged)\n\n    # Format the final output string as required.\n    # The output must be exactly like [True,False,True,False,True]\n    output_str = f\"[{','.join(map(str, results))}]\"\n    # The required format uses \"True\" and \"False\" with capital letters.\n    # The direct string conversion of booleans in Python matches this.\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "A successful IBI procedure yields a potential that accurately reproduces the target structure, but does this guarantee that all physical properties of the original system are captured? This practice  confronts the fundamental \"representability problem\" in coarse-graining by demonstrating that matching the radial distribution function $g(r)$ does not ensure thermodynamic consistency. You will derive a potential from a target $g(r)$ and then use it to calculate the system's pressure, revealing a potential discrepancy with the true pressure and highlighting a crucial limitation of structure-based potential refinement methods.",
            "id": "3771894",
            "problem": "A central task in multiscale modeling and analysis is refining coarse-grained pair potentials so that the resulting structure, quantified by the radial distribution function (RDF) $g(r)$, matches a target structure obtained from a higher-resolution model. Iterative Boltzmann inversion (IBI) seeks a pair potential that reproduces a prescribed $g(r)$, but matching $g(r)$ does not, in general, guarantee thermodynamic consistency (for example, matching pressure $P$). This problem asks you to construct a physically plausible example demonstrating this representability issue by using a simplified IBI argument at low-to-moderate density, computing the pressure via the virial route, and comparing it to a separately specified parent pressure for the same state point.\n\nYou must work from the following fundamental base:\n\n- The radial distribution function $g(r)$ relates to the pair potential $u(r)$ in the dilute-gas limit by the Boltzmann factor, $$g(r) = \\exp\\!\\big(-\\beta\\,u(r)\\big),$$ where $\\beta = 1/(k_{\\mathrm{B}} T)$, $k_{\\mathrm{B}}$ is the Boltzmann constant, and $T$ is the absolute temperature. In this limit, the single-step Boltzmann inversion that underlies Iterative Boltzmann Inversion (IBI) yields $$u(r) = -k_{\\mathrm{B}} T \\,\\ln g(r).$$\n- The virial equation for the pressure of an isotropic fluid with pair interactions (virial route) is $$P = \\rho\\,k_{\\mathrm{B}} T - \\frac{2\\pi}{3}\\,\\rho^{2}\\int_{0}^{\\infty} r^{3} \\,u'(r)\\,g(r)\\,\\mathrm{d}r,$$ where $\\rho$ is the number density, and $u'(r)$ denotes the derivative of $u(r)$ with respect to $r$.\n\nYour program must do the following for each test case:\n\n1. Assume a physically plausible target $g(r)$ composed of a soft-core repulsion and damped oscillations:\n   $$g(r) = \\max\\Big(\\epsilon,\\;\\exp\\!\\big(-a\\,(\\sigma/r)^{p}\\big)\\;\\big[1 + A\\,\\exp\\!\\big(-\\alpha\\,(r-\\sigma)\\big)\\,\\sin\\!\\big(\\omega\\,(r-\\sigma)\\big)\\big]\\Big),$$\n   for $r \\in (0,r_{\\max}]$, with parameters $a0$, $p0$, $A$, $\\alpha0$, $\\omega0$, core length scale $\\sigma0$, and a small floor $\\epsilon0$ to maintain positivity. This construction ensures a steep but finite repulsion for $r\\ll\\sigma$ and physically plausible damped oscillations for $r\\gtrsim\\sigma$. Use the same $\\epsilon$ for all test cases.\n\n2. Use the dilute-gas Boltzmann inversion to construct a pair potential\n   $$u(r) = -k_{\\mathrm{B}} T \\,\\ln g(r).$$\n\n3. Discretize the virial expression for pressure on a uniform radial grid $r_i = i\\,\\Delta r$ for $i=1,2,\\ldots,N$ with $\\Delta r = r_{\\max}/N$ using numerical differentiation for $u'(r)$ and numerical integration for the weighted integral. Compute\n   $$P_{\\mathrm{IBI}} = \\rho\\,k_{\\mathrm{B}} T - \\frac{2\\pi}{3}\\,\\rho^{2}\\int_{0}^{r_{\\max}} r^{3} \\,u'(r)\\,g(r)\\,\\mathrm{d}r,$$\n   where the integral is approximated by a suitable quadrature on the grid.\n\n4. Compare $P_{\\mathrm{IBI}}$ to a specified parent-system pressure $P_{\\mathrm{parent}}$ for the same state point, representing the thermodynamic pressure measured in the original higher-resolution model that supplied the target $g(r)$. Report the absolute error\n   $$E = \\big|P_{\\mathrm{IBI}} - P_{\\mathrm{parent}}\\big|.$$\n\nPhysical units: Express energy in units of $k_{\\mathrm{B}} T$, length in units of $\\sigma$, and pressure in units of $k_{\\mathrm{B}} T/\\sigma^{3}$. All numerical answers must be floats in $k_{\\mathrm{B}} T/\\sigma^{3}$.\n\nAngle unit: All angles inside the sine function are in radians.\n\nTest suite: Use the following four test cases, each specified by $(k_{\\mathrm{B}} T,\\rho,\\sigma,a,p,A,\\alpha,\\omega,r_{\\max},\\Delta r,P_{\\mathrm{parent}})$.\n\n- Case $1$ (general \"happy path\"): $(1.0, 0.8, 1.0, 5.0, 12, 0.2, 3.0, 7.0, 6.0, 0.002, 2.50)$.\n- Case $2$ (low-density edge): $(1.0, 0.05, 1.0, 5.0, 12, 0.1, 4.0, 8.0, 6.0, 0.002, 0.05)$.\n- Case $3$ (strong near-contact oscillations boundary): $(1.0, 0.9, 1.0, 5.0, 12, 0.35, 2.0, 9.0, 6.0, 0.002, 3.00)$.\n- Case $4$ (long-range correlation tail): $(1.0, 0.6, 1.0, 5.0, 12, 0.05, 0.7, 5.0, 6.0, 0.002, 1.20)$.\n\nFinal output format: Your program should produce a single line of output containing the absolute errors $E$ for all test cases, as a comma-separated list of decimal floats rounded to $5$ decimal places and enclosed in square brackets, for example, $$[e_1,e_2,e_3,e_4].$$",
            "solution": "The problem requires an investigation into the representability issue within coarse-grained modeling, specifically using the Iterative Boltzmann Inversion (IBI) methodology. The core task is to demonstrate that a pair potential $u(r)$ derived from a target radial distribution function $g(r)$ via a single-step Boltzmann inversion does not necessarily reproduce other thermodynamic properties, such as pressure $P$, of the original high-resolution system from which $g(r)$ was obtained. This is accomplished by calculating the pressure $P_{\\mathrm{IBI}}$ using the derived potential and comparing it to a given parent system pressure $P_{\\mathrm{parent}}$.\n\nThe foundational principles are the relationship between the pair potential and the radial distribution function in the low-density limit, and the virial equation of state for pressure. The analysis is performed in a dimensionless unit system where energy is measured in units of $k_{\\mathrm{B}} T$ and length in units of a characteristic scale $\\sigma$. Consequently, we set the Boltzmann constant-temperature product $k_{\\mathrm{B}} T = 1$ and the length scale $\\sigma = 1$. Pressure is then expressed in units of $k_{\\mathrm{B}} T / \\sigma^3$.\n\n**Step 1: System Definition and Target Structure**\n\nThe system is defined by a target radial distribution function $g(r)$ and a state point given by number density $\\rho$ and temperature $T$. The functional form for the target $g(r)$ is provided as:\n$$g(r) = \\max\\Big(\\epsilon,\\;\\exp\\!\\big(-a\\,(\\sigma/r)^{p}\\big)\\;\\big[1 + A\\,\\exp\\!\\big(-\\alpha\\,(r-\\sigma)\\big)\\,\\sin\\!\\big(\\omega\\,(r-\\sigma)\\big)\\big]\\Big)$$\nHere, $\\epsilon$ is a small positive constant (e.g., $\\epsilon = 10^{-12}$) to ensure $g(r)$ is strictly positive, which is necessary for the subsequent logarithmic operation. The term $\\exp(-a(\\sigma/r)^p)$ models a soft repulsive core, while the second term introduces damped oscillations characteristic of liquid structures. The parameters $(a, p, A, \\alpha, \\omega, \\sigma)$ control the shape of this function.\n\n**Step 2: Potential Derivation via Boltzmann Inversion**\n\nIn the dilute-gas limit, the pair potential $u(r)$ is related to $g(r)$ by the Boltzmann factor, $g(r) = \\exp(-\\beta u(r))$, where $\\beta = 1/(k_{\\mathrm{B}} T)$. Inverting this relationship gives the potential:\n$$u(r) = -k_{\\mathrm{B}} T \\ln g(r)$$\nThis one-step inversion is the basis of the IBI method. In our chosen dimensionless units where $k_{\\mathrm{B}} T = 1$, this simplifies to:\n$$u(r) = -\\ln g(r)$$\nThis potential is constructed to reproduce the target structure $g(r)$ within the assumptions of the inversion method.\n\n**Step 3: Pressure Calculation via the Virial Route**\n\nThe pressure of an isotropic fluid interacting via a pair potential $u(r)$ can be calculated using the virial equation:\n$$P = \\rho\\,k_{\\mathrm{B}} T - \\frac{2\\pi}{3}\\,\\rho^{2}\\int_{0}^{\\infty} r^{3} \\,u'(r)\\,g(r)\\,\\mathrm{d}r$$\nwhere $u'(r) = \\mathrm{d}u/\\mathrm{d}r$. The first term, $\\rho k_{\\mathrm{B}} T$, is the ideal gas pressure, and the second term is the contribution from particle interactions. To calculate the pressure $P_{\\mathrm{IBI}}$ predicted by our derived potential $u(r)$, we substitute it into the virial equation. The integral is truncated at a cutoff radius $r_{\\max}$, which is a standard practice in simulations and justified if correlations decay sufficiently fast. In our dimensionless units, the expression for $P_{\\mathrm{IBI}}$ becomes:\n$$P_{\\mathrm{IBI}} = \\rho - \\frac{2\\pi}{3}\\,\\rho^{2}\\int_{0}^{r_{\\max}} r^{3} \\,u'(r)\\,g(r)\\,\\mathrm{d}r$$\n\n**Step 4: Numerical Implementation**\n\nThe calculation is performed numerically on a discrete radial grid.\n1.  **Grid Generation**: A uniform grid $r_i = i\\,\\Delta r$ is created for $i=1, 2, \\ldots, N$, where $N = r_{\\max}/\\Delta r$. The grid spans from $r_1 = \\Delta r$ to $r_N = r_{\\max}$, avoiding the singularity at $r=0$.\n2.  **Function Evaluation**: The functions $g(r)$ and subsequently $u(r) = -\\ln g(r)$ are evaluated for each point $r_i$ on the grid.\n3.  **Numerical Differentiation**: The derivative of the potential, $u'(r)$, is computed numerically. We employ a second-order central difference formula for interior grid points, $u'(r_i) = (u(r_{i+1}) - u(r_{i-1}))/(2\\Delta r)$, and first-order forward/backward differences for the boundaries.\n4.  **Numerical Integration**: The integrand of the virial equation, $F(r) = r^3 u'(r) g(r)$, is evaluated on the grid. The integral is then approximated using the trapezoidal rule:\n    $$I = \\int_{\\Delta r}^{r_{\\max}} F(r)\\,\\mathrm{d}r \\approx \\sum_{i=1}^{N-1} \\frac{F(r_i) + F(r_{i+1})}{2} \\Delta r$$\n    The contribution from the interval $[0, \\Delta r)$ is neglected, which is a reasonable approximation for small $\\Delta r$.\n\n**Step 5: Error Analysis**\n\nFinally, for each test case, the computed pressure $P_{\\mathrm{IBI}}$ is compared against the given parent-system pressure $P_{\\mathrm{parent}}$. The absolute error, $E$, quantifies the thermodynamic inconsistency:\n$$E = |P_{\\mathrm{IBI}} - P_{\\mathrm{parent}}|$$\nA non-zero error $E$ demonstrates that the potential derived from a simple Boltzmann inversion, while designed to match the system's structure ($g(r)$), fails to consistently reproduce its thermodynamic properties (pressure). This discrepancy is precisely the representability problem that more advanced coarse-graining techniques, like a full iterative IBI with pressure correction, aim to resolve.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the pressure inconsistency in a simplified Iterative Boltzmann Inversion (IBI)\n    framework by calculating the absolute error between the pressure derived from a \n    Boltzmann-inverted potential and a given target pressure.\n    \"\"\"\n\n    # A small positive constant to ensure g(r) > 0.\n    # It is not specified, so a standard small float is chosen.\n    epsilon = 1.0e-12\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (kBT, rho, sigma, a, p, A, alpha, omega, r_max, dr, P_parent)\n    test_cases = [\n        (1.0, 0.8, 1.0, 5.0, 12, 0.2, 3.0, 7.0, 6.0, 0.002, 2.50),\n        (1.0, 0.05, 1.0, 5.0, 12, 0.1, 4.0, 8.0, 6.0, 0.002, 0.05),\n        (1.0, 0.9, 1.0, 5.0, 12, 0.35, 2.0, 9.0, 6.0, 0.002, 3.00),\n        (1.0, 0.6, 1.0, 5.0, 12, 0.05, 0.7, 5.0, 6.0, 0.002, 1.20),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        kBT, rho, sigma, a, p, A, alpha, omega, r_max, dr, P_parent = case\n\n        # 1. Create the radial grid. The grid is r_i = i * dr for i=1,...,N.\n        # This means it starts at dr, not 0.\n        N = int(r_max / dr)\n        r = np.arange(1, N + 1) * dr\n\n        # 2. Assume a physically plausible target g(r).\n        # The equation for g(r) is:\n        # g(r) = max(eps, exp(-a(sigma/r)^p) * [1 + A*exp(-alpha*(r-sigma))*sin(omega*(r-sigma))])\n        # The angle for sin is in radians, which is numpy's default.\n        soft_core_term = np.exp(-a * (sigma / r)**p)\n        oscillatory_term = 1 + A * np.exp(-alpha * (r - sigma)) * np.sin(omega * (r - sigma))\n        g_r = np.maximum(epsilon, soft_core_term * oscillatory_term)\n\n        # 3. Use dilute-gas Boltzmann inversion to construct u(r).\n        # u(r) = -kBT * ln(g(r))\n        u_r = -kBT * np.log(g_r)\n\n        # 4. Compute u'(r) numerically.\n        # np.gradient uses second-order central differences for interior points.\n        u_prime_r = np.gradient(u_r, dr)\n\n        # 5. Compute the virial expression for pressure P_IBI.\n        # P_IBI = rho*kBT - (2*pi/3) * rho^2 * integral(r^3 * u'(r) * g(r) * dr)\n        \n        # Define the integrand for the virial integral\n        integrand = r**3 * u_prime_r * g_r\n        \n        # Perform numerical integration using the trapezoidal rule\n        virial_integral = np.trapz(integrand, r)\n        \n        # Calculate P_IBI\n        P_IBI = rho * kBT - (2 * np.pi / 3) * rho**2 * virial_integral\n\n        # 6. Report the absolute error E.\n        # E = |P_IBI - P_parent|\n        error = np.abs(P_IBI - P_parent)\n        \n        results.append(\"{:.5f}\".format(error))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}