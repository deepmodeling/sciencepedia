{
    "hands_on_practices": [
        {
            "introduction": "这项练习为设定“预烧（burn-in）”期的常见做法提供了定量依据。我们将探讨系统的弛豫时间如何决定将初始偏差减小到可接受水平所需的最短持续时间，从而为规划模拟建立一个宝贵的经验法则。通过本练习，我们将把指数收敛的抽象概念与一个实际的模拟参数联系起来。",
            "id": "3755212",
            "problem": "在一个将细尺度动力学与粗粒化描述耦合的分层多尺度模拟中，假设相空间动力学引导出一个具有谱隙的遍历马尔可夫过程，该谱隙确保了向唯一平稳平衡态的指数收敛。设在一个初始的平衡（预烧）阶段和随后的生产阶段中，监测一个标量诊断可观测量 $A(t)$。将平衡均值记为 $\\mu$，平衡标准差记为 $\\sigma$，弛豫时间记为 $\\tau$，定义为控制期望收敛的最慢模式的衰变特征时间尺度。在线性响应近平衡和遍历性假设下，假设平均偏差 $\\Delta(t) \\equiv \\mathbb{E}[A(t)] - \\mu$ 在时间尺度 $\\tau$ 上指数收缩。已知初始条件的选择使得 $|\\Delta(0)| \\leq \\sigma$。设计预烧时长 $t_{b}$ 作为弛豫时间的倍数，即 $t_{b} = m \\tau$，使得预烧结束时的残余平均偏差满足 $|\\Delta(t_{b})| \\leq \\alpha \\sigma$，其中 $\\alpha = 0.01$，这是高等研究生实践中可忽略偏差的常规阈值。\n\n仅使用所述假设和指数收敛性质，确定满足要求的最小经验倍数 $m$。只报告无量纲倍数 $m$（而非 $t_{b}$），并将您的答案四舍五入到一位有效数字。",
            "solution": "首先对问题进行验证，以确保其是适定的、有科学依据且无歧义的。\n\n**步骤1：提取的已知条件**\n- 系统动力学由一个具有谱隙的遍历马尔可夫过程描述，这意味着向唯一的平稳平衡态指数收敛。\n- 标量可观测量记为 $A(t)$。\n- 可观测量的平衡均值为 $\\mu$。\n- 平衡标准差为 $\\sigma$。\n- 弛豫时间为 $\\tau$。\n- 平均偏差定义为 $\\Delta(t) \\equiv \\mathbb{E}[A(t)] - \\mu$。\n- 假设平均偏差在时间尺度 $\\tau$ 上指数收缩：$\\Delta(t) \\propto \\exp(-t/\\tau)$。\n- 初始条件满足 $|\\Delta(0)| \\leq \\sigma$。\n- 预烧时长设为 $t_{b} = m \\tau$，其中 $m$ 是一个无量纲倍数。\n- 预烧结束的目标条件是残余平均偏差必须满足 $|\\Delta(t_{b})| \\leq \\alpha \\sigma$。\n- 可忽略偏差的阈值给定为 $\\alpha = 0.01$。\n\n**步骤2：验证**\n- **科学依据**：该问题很好地植根于统计力学和计算物理学的原理，特别是马尔可夫过程理论及其在分子模拟中的应用。遍历性、弛豫时间、平衡化以及由谱隙引起的指数收敛等概念都是标准且基础稳固的。\n- **适定性**：该问题是适定的。它提供了一个明确的目标（确定最小的 $m$），一组数学假设，以及足够的数据来得到唯一解。\n- **客观性**：该问题以该领域通用的精确、客观和定量的术语陈述。\n\n**步骤3：结论**\n问题有效。我们可以继续进行求解。\n\n**求解推导**\n问题陈述平均偏差 $\\Delta(t)$ 在时间尺度 $\\tau$ 上指数收缩。这种物理行为在数学上表示为：\n$$\n\\Delta(t) = \\Delta(0) \\exp\\left(-\\frac{t}{\\tau}\\right)\n$$\n我们关心的是偏差的大小，因此我们考虑其绝对值：\n$$\n|\\Delta(t)| = |\\Delta(0)| \\exp\\left(-\\frac{t}{\\tau}\\right)\n$$\n问题给出了初始偏差的上限：$|\\Delta(0)| \\leq \\sigma$。为了保证对于任何有效的初始状态都能满足最终条件，我们必须考虑最坏情况，这对应于可能的最大初始偏差。因此，我们的计算基于 $|\\Delta(0)| = \\sigma$ 的情况。这导出了任意时刻 $t$ 偏差的上限：\n$$\n|\\Delta(t)| \\leq \\sigma \\exp\\left(-\\frac{t}{\\tau}\\right)\n$$\n预烧阶段的时长为 $t_b$，定义为弛豫时间 $\\tau$ 的 $m$ 倍：\n$$\nt_b = m\\tau\n$$\n将 $t = t_b$ 代入偏差大小的不等式，我们得到预烧阶段结束时残余偏差的上限：\n$$\n|\\Delta(t_b)| \\leq \\sigma \\exp\\left(-\\frac{m\\tau}{\\tau}\\right) = \\sigma \\exp(-m)\n$$\n设计要求是该残余偏差不得大于平衡标准差 $\\sigma$ 的一个分数 $\\alpha$：\n$$\n|\\Delta(t_b)| \\leq \\alpha \\sigma\n$$\n为确保满足此条件， $|\\Delta(t_b)|$ 的上限必须小于或等于要求的阈值 $\\alpha \\sigma$。这就建立了以下不等式：\n$$\n\\sigma \\exp(-m) \\leq \\alpha \\sigma\n$$\n由于对于一个非平凡的可观测量，标准差 $\\sigma$ 必须为正（如果 $\\sigma = 0$，则可观测量是常数且已平衡），我们可以将不等式两边同除以 $\\sigma$ 而不改变不等式方向：\n$$\n\\exp(-m) \\leq \\alpha\n$$\n为了解出 $m$，我们对两边取自然对数。由于自然对数是一个单调遞增函数，不等式的方向保持不变：\n$$\n\\ln(\\exp(-m)) \\leq \\ln(\\alpha)\n$$\n$$\n-m \\leq \\ln(\\alpha)\n$$\n两边乘以 $-1$ 会反转不等号：\n$$\nm \\geq -\\ln(\\alpha)\n$$\n问题要求满足此条件的最小倍数 $m$。这对应于最小值，由等式给出：\n$$\nm = -\\ln(\\alpha)\n$$\n给定值为 $\\alpha = 0.01$。将其代入 $m$ 的方程：\n$$\nm = -\\ln(0.01) = -\\ln(10^{-2})\n$$\n使用对数性质 $\\ln(x^y) = y \\ln(x)$，我们得到：\n$$\nm = -(-2)\\ln(10) = 2\\ln(10)\n$$\n现在，我们计算数值。10的自然对数约为 $\\ln(10) \\approx 2.302585$。\n$$\nm \\approx 2 \\times 2.302585 = 4.60517\n$$\n问题要求答案四舍五入到一位有效数字。第一位有效数字是 $4$。下一位数字是 $6$，大于或等于 $5$，所以我们将第一位数字向上取整。\n$$\nm \\approx 5\n$$\n因此，一个常见的经验法则是，预烧期应大约为系统最长弛豫时间的 $5$ 倍，以确保系统性偏差已衰减到系统自然涨落尺度的约 $1\\%$。",
            "answer": "$$\\boxed{5}$$"
        },
        {
            "introduction": "平衡之后，就进入了生产阶段。然而，连续的数据点之间往往存在关联，这会影响我们测量的准确性。本练习将深入探讨生产阶段分析的核心，推导可观测量平均值的方差、模拟长度和积分自相关时间之间的基本关系。同时，本练习还将讨论从有限数据中估计该关联时间的实际挑战。",
            "id": "3755133",
            "problem": "在一个多尺度体系的分子模拟中，监测一个单一的可观测量 $A(t)$。在舍弃初始的平衡时间 $t_{\\mathrm{eq}}$ 后，后续的生产轨迹被假定为平稳且遍历的。以均匀步长 $\\Delta t$ 对该可观测量进行采样，生成离散序列 $\\{A_i\\}_{i=1}^{N}$，其中 $A_i \\equiv A(t_{\\mathrm{eq}} + i\\,\\Delta t)$。令样本均值为 $\\bar{A} \\equiv \\frac{1}{N}\\sum_{i=1}^{N} A_i$，总体方差为 $\\sigma_A^2 \\equiv \\mathrm{Var}(A_i)$，假定其为有限值。定义自协方差函数 $C_A(k) \\equiv \\mathrm{Cov}(A_i, A_{i+k})$ 和归一化自相关函数 $\\rho_A(k) \\equiv \\frac{C_A(k)}{\\sigma_A^2}$，其中 $k$ 为整数延迟。当序列绝对可和时，积分自相关时间 (IAT) 以采样步长为单位定义为 $\\tau_{\\mathrm{int},A} \\equiv \\frac{1}{2} + \\sum_{k=1}^{\\infty} \\rho_A(k)$。\n\n仅从这些定义以及生产阶段的平穩性和遍历性假设出发：\n1. 推导 $\\mathrm{Var}(\\bar{A})$ 关于 $N$、$\\sigma_A^2$ 和 $\\tau_{\\mathrm{int},A}$ 的领头阶渐近表达式，该表达式在 $N$ 远大于相关范围时有效。你的推导必须从 $\\bar{A}$、$C_A(k)$ 和 $\\rho_A(k)$ 的定义开始，并且必须展示积分自相关时间是如何从 $\\mathrm{Var}(\\bar{A})$ 的协方差求和中产生的。\n2. 假设生产阶段的归一化自相关函数可以很好地用单指数衰减模型 $\\rho_A(k) = \\exp\\!\\big(-k\\,\\Delta t/\\tau_c\\big)$ 来近似，其中采样步长 $\\Delta t = 5\\,\\mathrm{fs}$，相关时间 $\\tau_c = 250\\,\\mathrm{fs}$。对于一个包含 $N = 2.0 \\times 10^{5}$ 个样本、$\\sigma_A^2 = 1.6\\,u_A^2$ 的生产数据集，计算以采样步长为单位的 $\\tau_{\\mathrm{int},A}$ 的闭式表达式，然后计算由你的领头阶表达式预测的 $\\mathrm{Var}(\\bar{A})$ 的数值。将最终数值答案四舍五入至四位有效数字。最终方差以 $u_A^2$ 为单位表示。\n3. 解释一種符合统计学原理的策略，用于从平衡后的有限长度生产数据中估计 $\\tau_{\\mathrm{int},A}$，包括如何选择截断窗口以及如何验证平稳性假设。你的解释应基于标准的时间序列原理，并且必须在不使用任何快捷公式的情况下论证偏差-方差权衡。\n\n只有第2部分要求的最终数值会作为最终答案评分。然而，要获得解答的满分，需要在第1部分和第3部分中给出正确的推导和合理的论证。",
            "solution": "此问题经评估有效，因为它在科学上基于分子模拟数据的统计分析，问题陈述适定，提供了所有必要信息，并使用客观、正式的语言表达，没有矛盾或歧义。\n\n### 第1部分：样本均值方差的推导\n\n题目要求我们推导 $\\mathrm{Var}(\\bar{A})$ 的领头阶渐近表达式。我们从样本均值 $\\bar{A}$ 的定义开始：\n$$\n\\bar{A} \\equiv \\frac{1}{N}\\sum_{i=1}^{N} A_i\n$$\n样本均值的方差由下式给出：\n$$\n\\mathrm{Var}(\\bar{A}) = \\mathrm{Var}\\left(\\frac{1}{N}\\sum_{i=1}^{N} A_i\\right)\n$$\n利用方差的性质 $\\mathrm{Var}(c X) = c^2 \\mathrm{Var}(X)$，我们可以将常数 $\\frac{1}{N}$ 提出来：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\mathrm{Var}\\left(\\sum_{i=1}^{N} A_i\\right)\n$$\n随机变量之和的方差是其协方差矩阵中所有元素的总和：\n$$\n\\mathrm{Var}\\left(\\sum_{i=1}^{N} A_i\\right) = \\sum_{i=1}^{N} \\sum_{j=1}^{N} \\mathrm{Cov}(A_i, A_j)\n$$\n问题陈述生产轨迹是平稳的。这意味着协方差 $\\mathrm{Cov}(A_i, A_j)$ 仅取决于样本之间的时间延迟 $k = j-i$。我们使用给定的自协方差函数定义 $C_A(k) \\equiv \\mathrm{Cov}(A_i, A_{i+k})$。因此，$\\mathrm{Cov}(A_i, A_j) = C_A(j-i)$。将此代入双重求和中得到：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\sum_{j=1}^{N} C_A(j-i)\n$$\n为了计算这个双重和，我们将求和索引从 $(i,j)$ 更改为 $(i,k)$，其中 $k=j-i$。对于一个固定的延迟 $k$，我们计算和中 $(i,j)$ 对的数量。对于给定的延迟 $k$，项数为 $N-|k|$，其中 $k \\in \\{-(N-1), \\dots, (N-1)\\}$。因此，双重求和可以重写为关于延迟 $k$ 的单个求和：\n$$\n\\sum_{i=1}^{N} \\sum_{j=1}^{N} C_A(j-i) = \\sum_{k=-(N-1)}^{N-1} (N-|k|) C_A(k)\n$$\n将此代回 $\\mathrm{Var}(\\bar{A})$ 的表达式中：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1}{N^2} \\sum_{k=-(N-1)}^{N-1} (N-|k|) C_A(k) = \\frac{1}{N} \\sum_{k=-(N-1)}^{N-1} \\left(1-\\frac{|k|}{N}\\right) C_A(k)\n$$\n题目要求的是在 $N$ 很大时有效的领头阶渐近表达式，具体来说是当 $N$ 远大于可观测量的相关范围时。相关范围是 $C_A(k)$ 显著不为零的延迟 $k$ 的尺度。对于远大于此范围的延迟 $|k|$，$C_A(k) \\approx 0$。因为 $N$很大，所以对于相关范围内的所有 $k$，$\\frac{|k|}{N}$ 这一项是可忽略的。因此，我们可以近似 $\\left(1-\\frac{|k|}{N}\\right) \\approx 1$。此外，由于 $C_A(k)$ 在延迟 $|k| \\ll N$时衰减至零，我们可以将求和的极限扩展到 $\\pm\\infty$ 而误差可忽略不计。这得出了渐近表达式：\n$$\n\\mathrm{Var}(\\bar{A}) \\approx \\frac{1}{N} \\sum_{k=-\\infty}^{\\infty} C_A(k)\n$$\n自协方差函数是对稱的，$C_A(k) = C_A(-k)$。我们可以将求和拆分为：\n$$\n\\sum_{k=-\\infty}^{\\infty} C_A(k) = C_A(0) + \\sum_{k=1}^{\\infty} C_A(k) + \\sum_{k=-\\infty}^{-1} C_A(k) = C_A(0) + 2\\sum_{k=1}^{\\infty} C_A(k)\n$$\n根据定义，$C_A(0) = \\mathrm{Var}(A_i) = \\sigma_A^2$。我们代入此式以及归一化自相关函数的定义 $\\rho_A(k) = C_A(k)/\\sigma_A^2$：\n$$\n\\mathrm{Var}(\\bar{A}) \\approx \\frac{\\sigma_A^2}{N} \\left(\\rho_A(0) + 2\\sum_{k=1}^{\\infty} \\rho_A(k)\\right)\n$$\n由于 $\\rho_A(0) = C_A(0)/\\sigma_A^2 = 1$，表达式变为：\n$$\n\\mathrm{Var}(\\bar{A}) \\approx \\frac{\\sigma_A^2}{N} \\left(1 + 2\\sum_{k=1}^{\\infty} \\rho_A(k)\\right)\n$$\n最后，我们引入积分自相关时间 (IAT)，其定义为 $\\tau_{\\mathrm{int},A} \\equiv \\frac{1}{2} + \\sum_{k=1}^{\\infty} \\rho_A(k)$。根据这个定义，我们可以将求和部分表示为 $2\\sum_{k=1}^{\\infty} \\rho_A(k) = 2\\left(\\tau_{\\mathrm{int},A} - \\frac{1}{2}\\right) = 2\\tau_{\\mathrm{int},A} - 1$。将此代入 $\\mathrm{Var}(\\bar{A})$ 的表达式中得到：\n$$\n\\mathrm{Var}(\\bar{A}) \\approx \\frac{\\sigma_A^2}{N} \\left(1 + (2\\tau_{\\mathrm{int},A} - 1)\\right) = \\frac{\\sigma_A^2}{N} (2\\tau_{\\mathrm{int},A})\n$$\n这就是所求的领头阶渐近表达式：\n$$\n\\mathrm{Var}(\\bar{A}) \\approx \\frac{2 \\sigma_A^2 \\tau_{\\mathrm{int},A}}{N}\n$$\n\n### 第2部分：数值计算\n\n首先，我们根据自相关函数的单指数衰减模型 $\\rho_A(k) = \\exp(-k\\,\\Delta t/\\tau_c)$，求出 $\\tau_{\\mathrm{int},A}$ 的闭式表达式。\n使用 $\\tau_{\\mathrm{int},A}$ 的定义：\n$$\n\\tau_{\\mathrm{int},A} = \\frac{1}{2} + \\sum_{k=1}^{\\infty} \\rho_A(k) = \\frac{1}{2} + \\sum_{k=1}^{\\infty} \\exp\\left(-\\frac{k\\,\\Delta t}{\\tau_c}\\right)\n$$\n这个求和是一个公比为 $r = \\exp(-\\Delta t/\\tau_c)$ 的几何级数 $\\sum_{k=1}^{\\infty} r^k$。该级数的和为 $\\frac{r}{1-r}$。代入 $r$ 的表达式：\n$$\n\\sum_{k=1}^{\\infty} \\exp\\left(-\\frac{k\\,\\Delta t}{\\tau_c}\\right) = \\frac{\\exp(-\\Delta t/\\tau_c)}{1 - \\exp(-\\Delta t/\\tau_c)} = \\frac{1}{\\exp(\\Delta t/\\tau_c) - 1}\n$$\n因此，$\\tau_{\\mathrm{int},A}$ 的闭式表达式为：\n$$\n\\tau_{\\mathrm{int},A} = \\frac{1}{2} + \\frac{1}{\\exp(\\Delta t/\\tau_c) - 1}\n$$\n这可以用双曲函数重写为 $\\tau_{\\mathrm{int},A} = \\frac{1}{2}\\coth\\left(\\frac{\\Delta t}{2\\tau_c}\\right)$。\n\n接下来，我们计算数值。给定的参数是：\n$\\Delta t = 5\\,\\mathrm{fs}$\n$\\tau_c = 250\\,\\mathrm{fs}$\n$N = 2.0 \\times 10^{5}$\n$\\sigma_A^2 = 1.6\\,u_A^2$\n\n指数的参数是 $\\frac{\\Delta t}{\\tau_c} = \\frac{5}{250} = 0.02$。\n我们计算 $\\tau_{\\mathrm{int},A}$：\n$$\n\\tau_{\\mathrm{int},A} = \\frac{1}{2} + \\frac{1}{\\exp(0.02) - 1} \\approx 0.5 + \\frac{1}{1.02020134 - 1} = 0.5 + \\frac{1}{0.02020134} \\approx 0.5 + 49.501667 \\approx 50.001667\n$$\n现在，我们使用第1部分推導出的公式计算 $\\mathrm{Var}(\\bar{A})$：\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{2 \\sigma_A^2 \\tau_{\\mathrm{int},A}}{N} = \\frac{2 \\times (1.6\\,u_A^2) \\times (50.001667)}{2.0 \\times 10^{5}}\n$$\n$$\n\\mathrm{Var}(\\bar{A}) = \\frac{1.6 \\times 50.001667}{10^5} \\,u_A^2 = \\frac{80.002667}{10^5} \\,u_A^2 = 8.0002667 \\times 10^{-4} \\,u_A^2\n$$\n將最終數值結果四捨五入至四位有效數字，得到 $8.000 \\times 10^{-4}$。\n\n### 第3部分：从有限数据估计IAT的策略\n\n从有限长度的生产数据集 $\\{A_i\\}_{i=1}^N$ 估计积分自相关时间 $\\tau_{\\mathrm{int},A}$，需要一种谨慎且符合统计学原理的方法。\n\n1.  **验证平稳性**：在进行任何分析之前，必须检查生产阶段是平穩的这一假设。一个常见的实用方法是将整个时间序列分成少数几个大的、大小相等的数据块（例如3到5块）。计算每个数据块内可观測量 $A$ 的均值和方差。如果这些数据块的均值和方差在统计上彼此相似（即它们围绕全局均值和方差波动，没有任何系统性的漂移或趋势），那么在实际应用中，平稳性假设被认为是合理的。绘制数据的移动平均图也可以提供对趋势的直观检查。\n\n2.  **估计自相关函数 (ACF)**：对于延迟 $k$，样本自协方差函数 $\\hat{C}_A(k)$ 从数据中估计如下：\n    $$\n    \\hat{C}_A(k) = \\frac{1}{N-k} \\sum_{i=1}^{N-k} (A_i - \\bar{A})(A_{i+k} - \\bar{A})\n    $$\n    其中 $\\bar{A}$ 是整个数据集的样本均值。于是样本ACF为 $\\hat{\\rho}_A(k) = \\hat{C}_A(k) / \\hat{C}_A(0)$。\n\n3.  **偏差-方差权衡与截断**：通过将估计的ACF求和至其最大可能延迟 $N-1$ 来估计 $\\tau_{\\mathrm{int},A}$，即 $\\hat{\\tau}_{\\mathrm{int},A} = \\frac{1}{2} + \\sum_{k=1}^{N-1} \\hat{\\rho}_A(k)$，这种朴素的尝试是有缺陷的。估计量 $\\hat{\\rho}_A(k)$ 的统计不确定性（方差）随着延迟 $k$ 的增加而增加，因为可用于其计算的数据对 $(N-k)$ 越来越少。对于大的 $k$，$\\hat{\\rho}_A(k)$ 被噪声所主导。对这些充满噪声的项求和会给 $\\tau_{\\mathrm{int},A}$ 的估计值增加显著的方差，从而阻止求和收敛。\n\n    为了解决这个问题，求和必须在一个有限的窗口大小 $W  N-1$ 处截断：\n    $$\n    \\hat{\\tau}_{\\mathrm{int},A}(W) = \\frac{1}{2} + \\sum_{k=1}^{W} \\hat{\\rho}_A(k)\n    $$\n    选择 $W$ 涉及到一个关键的**偏差-方差权衡**：\n    *   **小 $W$**：如果 $W$ 太小，求和在真实的ACF衰减到零之前就被截断。这会引入系统误差（偏差），通常是对 $\\tau_{\\mathrm{int},A}$ 的低估，因为ACF的正尾部被排除了。\n    *   **大 $W$**：如果 $W$ 太大，求和会包含来自大延迟的充满噪声的估计值 $\\hat{\\rho}_A(k)$，这会增加最终估计值 $\\hat{\\tau}_{\\mathrm{int},A}$ 的统计误差（方差）。\n\n4.  **选择 $W$ 的原则性策略**：一種鲁棒的策略是分析 $\\hat{\\tau}_{\\mathrm{int},A}(W)$ 作为截断窗口 $W$ 的函数时的行为。可以绘制 $\\hat{\\tau}_{\\mathrm{int},A}(W)$ 对 $W$ 的图像。\n    *   对于小的 $W$，随着更多正相关项的加入，$\\hat{\\tau}_{\\mathrm{int},A}(W)$ 会增加。\n    *   理想情况下，曲线会达到一个平台区，其中 $\\hat{\\tau}_{\\mathrm{int},A}(W)$ 变得相对恒定。这是因为对于超出真实相关时间的延迟 $k$，真实的 $\\rho_A(k)$ 接近于零，所以增加更多的项不应显著改变求和结果。\n    *   对于非常大的 $W$，噪声占主导地位，$\\hat{\\tau}_{\\mathrm{int},A}(W)$ 的图像会变得不稳定，并且常常向上漂移。\n    *   $\\tau_{\\mathrm{int},A}$ 的最终估计值的良好选择是在这个平台区内的 $\\hat{\\tau}_{\\mathrm{int},A}(W)$ 的值。\n\n    一个自洽的准则是选择 $W$ 比估计的 $\\tau_{\\mathrm{int},A}$ 本身大几倍，例如，选择 $W$ 使得 $W \\ge c \\cdot \\hat{\\tau}_{\\mathrm{int},A}(W)$，其中因子 $c$ 大约在5-6之间。可以迭代寻找满足此条件的 $W$。这个过程系统地平衡了偏差-方差权衡，即在不被统计噪声淹没的前提下，尽可能延长求和以获取有意义的信号。",
            "answer": "$$\n\\boxed{8.000 \\times 10^{-4}}\n$$"
        },
        {
            "introduction": "与预先指定一个固定的预烧时间相比，更可靠的方法是监测模拟数据并自动确定系统何时达到统计稳态。这个编程练习将指导你使用分块平均法（batch means method）来构建一个多方面的决策规则。你将实现一个实用算法，通过评估数据的稳定性和精度，以算法方式区分平衡阶段和生产阶段。",
            "id": "3755177",
            "problem": "您正在研究一个由多尺度模拟产生的单变量时间序列，何时从平衡阶段过渡到生产阶段。核心目标是根据累积平均值的稳定以及通过分批均值法估计的置信区间，来形式化一个用于开始生产的停止准则。您的任务是从第一性原理出发，推导出一个有原则的决策规则并加以实现。\n\n从以下基本依据开始：\n- 大数强定律：对于一个具有有限均值的平稳遍历过程，当 $n \\to \\infty$ 时，累积平均值 $\\bar{X}_n = \\frac{1}{n}\\sum_{t=1}^{n} X_t$ 几乎必然收敛于真实均值。\n- 针对弱相关数据（例如，$\\alpha$-混合时间序列）的中心极限定理，意味着样本均值呈渐近正态分布，其方差通过一个有效的长期方差进行缩放。分批均值法通过将数据划分为连续的批次并使用批次均值的样本方差，来一致地近似这个方差。\n\n设计一个准则，在给定单变量时间序列 $(X_t)_{t=1}^{N}$ 的情况下，识别出最小的平衡指数 $t_0$，使得后缀 $S = \\{X_{t_0+1}, X_{t_0+2}, \\dots, X_N\\}$ 可被视为处于生产阶段。您的决策规则必须基于：\n- $S$ 内部的累积平均值相对于通过分批均值法构建的 $S$ 均值的置信区间的稳定性。\n- 对置信区间半宽度的相对精度要求。\n- 一项排除 $S$ 内部未解决漂移的内部一致性检查。\n\n为任意候选起始指数 $t_0$ 定义以下量：\n- 令 $n = N - t_0$ 为后缀 $S$ 的长度。\n- 令 $S$ 内的累积移动平均值为 $R_k = \\frac{1}{k}\\sum_{i=1}^{k} X_{t_0+i}$，其中 $k \\in \\{1,2,\\dots,n\\}$。\n- 令 $S$ 的总均值为 $\\hat{\\mu} = \\frac{1}{n}\\sum_{i=1}^{n} X_{t_0+i}$。\n- 将 $S$ 的前 $m b$ 个点划分为 $m$ 个长度相等的连续批次 $b$。令 $Y_j = \\frac{1}{b}\\sum_{i=1}^{b} X_{t_0+(j-1)b+i}$ 表示第 $j$ 个批次均值，其中 $j \\in \\{1,2,\\dots,m\\}$。\n- 令 $s_Y^2$ 为 $\\{Y_1,\\dots,Y_m\\}$ 的无偏样本方差。\n- 对于目标双侧置信水平 $1-\\alpha$，令 $q = t_{1-\\alpha/2,\\, m-1}$ 为具有 $m-1$ 自由度的学生t分布的分位数。将 $S$ 均值的置信区间半宽度定义为 $h = q \\sqrt{s_Y^2 / m}$。\n\n为使候选 $t_0$ 被接受，施加以下约束：\n- 分批均值法所需的数据充足性：$n \\ge m_{\\min} \\, b_{\\min}$，其中 $m_{\\min}$ 和 $b_{\\min}$ 分别是批次的最小数量和批次的最小大小。使用大小为 $b_{\\min}$ 的前 $m = \\left\\lfloor \\frac{n}{b_{\\min}} \\right\\rfloor$ 个批次来计算 $\\{Y_j\\}_{j=1}^{m}$。如果 $m  m_{\\min}$，则该候选无效。\n- 相对精度要求：$\\frac{h}{\\max(|\\hat{\\mu}|, \\delta)} \\le \\epsilon$，其中 $\\epsilon$ 是用户指定的容差，$\\delta$ 是一个小的正数，用于对接近零的均值进行正则化。\n- 两半部分的内部一致性：如果 $n$ 是偶数，将 $S$ 分为大小各为 $n/2$ 的两半 $S_1$ 和 $S_2$，并令它们的均值为 $\\hat{\\mu}_1$ 和 $\\hat{\\mu}_2$。如果 $n$ 是奇数，则丢弃最后一个点，并将前 $n-1$ 个点均等分开。要求 $|\\hat{\\mu}_1 - \\hat{\\mu}_2| \\le h$。\n- 稳定的移动平均值尾部：对于每一个 $k \\in \\{\\lceil p n \\rceil, \\lceil p n \\rceil + 1, \\dots, n\\}$，以及用户指定的分数 $p \\in (0,1)$，要求 $|R_k - \\hat{\\mu}| \\le h$。\n\n将满足上述所有约束的最小 $t_0 \\in \\{0,1,\\dots,N - m_{\\min} b_{\\min}\\}$ 定义为可接受的平衡时间。如果找不到，则返回 $N$。\n\n使用以下参数：\n- 置信水平：$1 - \\alpha$，其中 $\\alpha = 0.05$。\n- 最小批次数：$m_{\\min} = 10$。\n- 最小批次大小：$b_{\\min} = 20$。\n- 相对容差：$\\epsilon = 0.05$。\n- 接近零均值的正则化：$\\delta = 10^{-6}$。\n- 用于稳定的尾部分数：$p = 0.5$。\n\n三角函数的角度以弧度为单位。\n\n测试套件。对于每个测试用例，您将得到一个长度为 $N = 1000$ 的确定性时间序列，由 $t \\in \\{0,1,\\dots,999\\}$ 索引，并由以下公式定义。您的程序必须根据上述规则为每个用例计算平衡指数 $t_0$。\n\n- 情况 A（指数松弛至带有小幅振荡的非零均值）：\n  - $X_t^{(A)} = 2.0 + 5.0 \\exp(- t / 50.0) + 0.2 \\sin\\!\\left( 2\\pi t / 13.0 \\right)$。\n- 情况 B（带有振荡的缓慢线性漂移；故意设为非平稳）：\n  - $X_t^{(B)} = 0.001 \\, t + 0.2 \\sin\\!\\left( 2\\pi t / 50.0 \\right)$。\n- 情况 C（从一开始就近似平稳，准周期性）：\n  - $X_t^{(C)} = 1.0 + 0.3 \\sin\\!\\left( 2\\pi t / 7.0 \\right) + 0.1 \\sin\\!\\left( 2\\pi t / 5.0 \\right)$。\n- 情况 D（带有振荡并衰减至负均值的瞬态）：\n  - $X_t^{(D)} = -1.0 + 1.5 \\exp(- t / 20.0) + 0.3 \\cos\\!\\left( 2\\pi t / 15.0 \\right)$。\n\n您的程序必须：\n- 完全按照规定构建这四个序列。\n- 对于每个序列，从 $0$ 开始向上扫描 $t_0$，并选择满足所有约束的最小 $t_0$。如果没有满足条件的，则该情况返回 $N$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个结果整数，格式为逗号分隔的列表，并用方括号括起来，顺序为 $[t_0^{(A)}, t_0^{(B)}, t_0^{(C)}, t_0^{(D)}]$。",
            "solution": "该问题要求推导并实现一个决策规则，用于确定单变量时间序列中的平衡时间（由指数 $t_0$ 表示）。核心原则是确定最早的时间点 $t_0$，使得序列的剩余部分，即后缀 $S = \\{X_{t_0}, X_{t_0+1}, \\dots, X_{N-1}\\}$，可以被视为统计平稳或“处于生产阶段”。该确定过程基于一系列与累积平均值的稳定性以及后缀估计均值的精度相关的定量标准。\n\n问题陈述的验证过程如下：\n- **已知条件提取**：\n  - 时间序列：$(X_t)_{t=1}^{N}$ 是通用形式，具体测试用例为 $(X_t)_{t=0}^{999}$，其中 $N=1000$。\n  - 候选平衡指数 $t_0$ 的后缀：$S = \\{X_{t_0+1}, X_{t_0+2}, \\dots, X_N\\}$。根据提供的测试用例索引，这被解释为从索引为 0 的数组的索引 $t_0$ 开始的切片，即 $\\{X_{t_0}, \\dots, X_{N-1}\\}$。\n  - 后缀长度：$n = N - t_0$。\n  - $S$ 的累积移动平均值：$R_k = \\frac{1}{k}\\sum_{i=1}^{k} X_{t_0+i}$，其中 $k \\in \\{1,\\dots,n\\}$。这对应于后缀切片前 $k$ 个元素的均值。\n  - $S$ 的总均值：$\\hat{\\mu}$。\n  - 分批：将 $S$ 的前 $m \\cdot b$ 个点划分为 $m$ 个大小为 $b$ 的批次。第 $j$ 个批次的均值为 $Y_j$。\n  - 批次均值的方差：$s_Y^2$ 是 $\\{Y_1,\\dots,Y_m\\}$ 的无偏样本方差。\n  - 置信区间半宽度：$h = q \\sqrt{s_Y^2 / m}$，其中 $q = t_{1-\\alpha/2,\\, m-1}$ 是来自学生t分布的分位数。\n  - 参数：置信水平 $1-\\alpha=0.95$（$\\alpha=0.05$），最小批次数 $m_{\\min}=10$，最小批次大小 $b_{\\min}=20$，相对容差 $\\epsilon=0.05$，正则化 $\\delta=10^{-6}$，尾部分数 $p=0.5$。\n  - 接受 $t_0$ 的约束条件：\n    1. 充足数据：$n \\ge m_{\\min} b_{\\min}$ 且 $m = \\lfloor n/b_{\\min} \\rfloor \\ge m_{\\min}$。\n    2. 相对精度：$h / \\max(|\\hat{\\mu}|, \\delta) \\le \\epsilon$。\n    3. 内部一致性：$|\\hat{\\mu}_1 - \\hat{\\mu}_2| \\le h$，其中 $\\hat{\\mu}_1$ 和 $\\hat{\\mu}_2$ 是 $S$ 的两半的均值。\n    4. 稳定尾部：对于所有 $k \\in \\{\\lceil p n \\rceil, \\dots, n\\}$，$|R_k - \\hat{\\mu}| \\le h$。\n  - 目标：找到满足所有约束的最小 $t_0 \\in \\{0, 1, \\dots, N - m_{\\min}b_{\\min}\\}$。如果没有，则返回 $N$。\n  - 测试用例：指定了四个确定性函数 $X_t^{(A)}$、$X_t^{(B)}$、$X_t^{(C)}$ 和 $X_t^{(D)}$。\n\n- **验证结论**：该问题在科学上基于标准的时间序列分析技术（分批均值法），在数学上是适定的，具有精确的定义和约束，并且是客观的。它是完整的、一致的且计算上可行的。因此，该问题被视为**有效**。\n\n解决方案的实现方法是创建一个函数，该函数为给定的候选起始指数 $t_0$ 评估所有指定的约束。然后从 $0$ 开始迭代调用此函数，直至最大可能值 $N - m_{\\min} b_{\\min}$。第一个满足所有约束的 $t_0$ 值即为所求的平衡指数。\n\n设完整时间序列为一个长度为 $N = 1000$ 的数组 $X$，索引从 $0$ 到 $999$。对于范围 $[0, N - m_{\\min} b_{\\min}]$ 内的每个候选起始指数 $t_0$，我们对后缀 $S = X[t_0:]$ 执行以下检查：\n\n1.  **初始化和数据充足性**：\n    - 后缀的长度为 $n = N - t_0$。对 $t_0$ 的循环构造使得 $n \\ge m_{\\min} b_{\\min} = 10 \\cdot 20 = 200$，自动满足约束的第一部分。\n    - 我们计算大小为 $b_{\\min}$ 的可用批次数为 $m = \\lfloor n / b_{\\min} \\rfloor$。\n    - 我们检查是否 $m \\ge m_{\\min}$。如果不是，则候选 $t_0$ 被拒绝。\n\n2.  **分批均值和置信区间**：\n    - 如果数据充足，我们计算前 $m$ 个批次的均值。设后缀为 $S = (S_0, S_1, \\dots, S_{n-1})$。第 $j$ 个批次均值（$j \\in \\{1,\\dots,m\\}$）为 $Y_j = \\frac{1}{b_{\\min}} \\sum_{i=0}^{b_{\\min}-1} S_{(j-1)b_{\\min}+i}$。\n    - 这些批次均值的无偏样本方差计算为 $s_Y^2 = \\frac{1}{m-1} \\sum_{j=1}^{m} (Y_j - \\bar{Y})^2$，其中 $\\bar{Y} = \\frac{1}{m}\\sum_{j=1}^m Y_j$。\n    - 对于 $1-\\alpha=0.95$ 的置信水平和 $m-1$ 的自由度，获得学生t分布的分位数：$q = t_{0.975,\\, m-1}$。\n    - 置信区间的半宽度则为 $h = q \\sqrt{s_Y^2 / m}$。\n    - 整个后缀 $S$ 的总均值为 $\\hat{\\mu} = \\frac{1}{n} \\sum_{i=0}^{n-1} S_i$。\n\n3.  **约束评估**：\n    - **约束1（相对精度）**：我们测试相对半宽度是否在容差 $\\epsilon$ 内。均值 $\\hat{\\mu}$ 被正则化以避免除以零。条件是 $\\frac{h}{\\max(|\\hat{\\mu}|, \\delta)} \\le \\epsilon$。如果此条件不满足，则拒绝 $t_0$。\n    - **约束2（内部一致性）**：此检查防止后缀内存在未解决的漂移。我们将 $S$ 的前 $n_{even} = 2 \\lfloor n/2 \\rfloor$ 个点分成长度为 $n_{even}/2$ 的两半。设它们各自的均值为 $\\hat{\\mu}_1$ 和 $\\hat{\\mu}_2$。我们要求 $|\\hat{\\mu}_1 - \\hat{\\mu}_2| \\le h$。如果此条件不满足，则拒绝 $t_0$。\n    - **约束3（稳定的移动平均值尾部）**：这确保了累积平均值已经收敛。对于指定的尾部分数 $p=0.5$，我们检查从 $k_{start} = \\lceil p n \\rceil$ 到 $n$ 的移动平均值 $R_k$。条件是对于所有这些 $k$，都有 $|R_k - \\hat{\\mu}| \\le h$，其中 $R_k = \\frac{1}{k} \\sum_{i=0}^{k-1} S_i$。使用累积和方法可以高效地进行此计算。如果对于指定范围内的任何 $k$，该条件不满足，则拒绝 $t_0$。\n\n4.  **最终决策**：\n    - 如果一个候选 $t_0$ 通过了上述所有检查，则接受该 $t_0$。\n    - 算法迭代遍历 $t_0 = 0, 1, 2, \\dots, N - m_{\\min} b_{\\min}$。第一个被接受的 $t_0$ 被记录为该时间序列的结果。\n    - 如果循环完成而没有任何 $t_0$ 被接受，则根据问题规范将结果赋值为 $N$，表示在该可分析窗口内序列未根据标准达到平衡。\n\n将此过程应用于四个给定的时间序列定义中的每一个，以计算平衡指数的最终列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import t\n\ndef check_equilibration(series, t0, N, m_min, b_min, alpha, epsilon, delta, p):\n    \"\"\"\n    Checks if a candidate equilibration index t0 is valid based on the given criteria.\n\n    A 0-based indexing interpretation is used:\n    - The series is X_0, ..., X_{N-1}.\n    - The candidate equilibration index t0 means points X_0, ..., X_{t0-1} are discarded.\n    - The production suffix S starts at index t0, i.e., S = series[t0:].\n    \"\"\"\n    S = series[t0:]\n    n = len(S)\n\n    # Calculate number of batches and check for minimum data\n    m = n // b_min\n    if m  m_min:\n        return False\n\n    # 1. Compute batch means and confidence interval half-width (h)\n    S_for_batches = S[:m * b_min]\n    batches = S_for_batches.reshape((m, b_min))\n    Y = np.mean(batches, axis=1)\n    \n    # Need at least 2 batches to compute variance\n    if m  2:\n        return False\n        \n    s_Y_2 = np.var(Y, ddof=1)\n    \n    # If variance is zero (e.g., constant series), h will be 0. Avoid issues with sqrt.\n    if s_Y_2 = 0: # Check for non-positive variance\n        return False\n    \n    # Quantile from Student's t-distribution\n    q = t.ppf(1 - alpha / 2, df=m - 1)\n    \n    # Confidence interval half-width\n    h = q * np.sqrt(s_Y_2 / m)\n    \n    # Overall mean of the suffix S\n    hat_mu = np.mean(S)\n\n    # 2. Relative precision requirement\n    if h / max(abs(hat_mu), delta)  epsilon:\n        return False\n\n    # 3. Internal consistency of halves\n    n_half_len = n // 2\n    S_first_half = S[:n_half_len]\n    S_second_half = S[n_half_len : 2 * n_half_len]\n    mu1 = np.mean(S_first_half)\n    mu2 = np.mean(S_second_half)\n    if abs(mu1 - mu2)  h:\n        return False\n\n    # 4. Stabilized running mean tail\n    k_start = int(np.ceil(p * n))\n    \n    # Cumulative sum for efficient calculation of running means\n    cum_S = np.cumsum(S)\n    \n    # Check tail from k_start to n\n    k_range = np.arange(k_start, n + 1)\n    # R_k = cum_S[k-1] / k (adjusting for 0-based index of cum_S)\n    R_k_values = cum_S[k_range - 1] / k_range\n    \n    if np.any(np.abs(R_k_values - hat_mu)  h):\n        return False\n        \n    return True\n\ndef solve():\n    # Parameters\n    N = 1000\n    alpha = 0.05\n    m_min = 10\n    b_min = 20\n    epsilon = 0.05\n    delta = 1e-6\n    p = 0.5\n    \n    params = {\n        'N': N, 'm_min': m_min, 'b_min': b_min, \n        'alpha': alpha, 'epsilon': epsilon, 'delta': delta, 'p': p\n    }\n\n    t_indices = np.arange(N)\n\n    # Test cases generation\n    series_A = 2.0 + 5.0 * np.exp(-t_indices / 50.0) + 0.2 * np.sin(2 * np.pi * t_indices / 13.0)\n    series_B = 0.001 * t_indices + 0.2 * np.sin(2 * np.pi * t_indices / 50.0)\n    series_C = 1.0 + 0.3 * np.sin(2 * np.pi * t_indices / 7.0) + 0.1 * np.sin(2 * np.pi * t_indices / 5.0)\n    series_D = -1.0 + 1.5 * np.exp(-t_indices / 20.0) + 0.3 * np.cos(2 * np.pi * t_indices / 15.0)\n\n    test_series = [series_A, series_B, series_C, series_D]\n    results = []\n\n    # Maximum t0 to check ensures that the suffix has at least m_min * b_min points\n    max_t0 = N - m_min * b_min\n    \n    for series in test_series:\n        found_t0 = False\n        for t0 in range(max_t0 + 1):\n            if check_equilibration(series, t0, **params):\n                results.append(t0)\n                found_t0 = True\n                break\n        if not found_t0:\n            results.append(N)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}