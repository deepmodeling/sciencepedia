{
    "hands_on_practices": [
        {
            "introduction": "相场断裂模型的核心在于力学应变能驱动相场 $\\phi$（代表裂纹）的增长。本练习专注于在有限元方法 (FEM) 框架内实现这种耦合。通过计算来自力学贡献的残差向量 $\\mathbf{r}_{\\phi,\\text{mech}}$，您将亲身体验“热力学驱动力”这一抽象概念如何转化为驱动模拟的具体数值，这是开发或使用耦合多物理场仿真软件的一项基本技能。",
            "id": "3746916",
            "problem": "考虑一个线性弹性体的小应变、平面应变弹性响应，该弹性体通过其力学自由能密度中的一个乘性退化函数与一个标量相场变量 $\\phi$ 耦合。请从以下基本依据出发：\n\n- 小应变运动学：位移场分量 $u_x$ 和 $u_y$ 通过对称梯度定义了无穷小应变张量 $\\boldsymbol{\\varepsilon}$，且工程应变向量 $\\boldsymbol{\\varepsilon} = \\left[\\varepsilon_{xx}, \\varepsilon_{yy}, \\varepsilon_{xy}\\right]^T$ 由位移场的空间导数给出。\n- 杨氏模量为 $E$、泊松比为 $\\nu$ 的平面应变线性弹性本构律定义了四阶弹性张量。在工程向量表示法中，该张量可得到本构矩阵 $\\mathbf{C}$，该矩阵通过 $\\boldsymbol{\\sigma} = \\mathbf{C} \\boldsymbol{\\varepsilon}$ 关联应力与应变。\n- 力学自由能密度为 $\\psi_e(\\boldsymbol{\\varepsilon}) = \\tfrac{1}{2} \\boldsymbol{\\varepsilon}^T \\mathbf{C} \\boldsymbol{\\varepsilon}$。\n- 总内能密度包含退化的力学能项 $g(\\phi)\\,\\psi_e(\\boldsymbol{\\varepsilon})$，其中退化函数为 $g(\\phi) = (1 - \\phi)^2 + \\kappa$，而 $\\kappa$ 是一个与 $\\phi$ 无关的微小正常数，称为残余刚度常数。\n\n应用虚功原理和变分法，力学对 $\\phi$ 方程弱形式的耦合贡献来自于退化的力学能对 $\\phi$ 的变分导数。当使用有限元法（FEM; Finite Element Method）进行离散化时，在单元层面上，与 $\\phi$ 方程相关的残余耦合向量的各个分量，是通过在单元域上对力学耦合项与 $\\phi$ 试函数的乘积进行积分得到的。\n\n你的任务是，对于一个单位厚度（指定为 $1$ 米）的等参双线性四边形单元，使用标准的 $2 \\times 2$ 高斯积分，计算仅由力学贡献产生的 $\\phi$ 方程的单元级残余耦合向量。在父域上使用自然坐标为 $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$ 的标准双线性形函数，并通过常规的 $\\mathbf{B}$ 矩阵从位移自由度组集应变。假设为平面应变。力学耦合中所需的退化函数导数是 $g'(\\phi)$ 对 $\\phi$ 的导数。\n\n实现以下数值计算流程：\n\n- 在每个高斯点，使用等参映射的雅可比矩阵，将形函数的父空间导数映射到物理空间导数。\n- 在每个高斯点构造 $\\mathbf{B}$ 矩阵，以从节点位移计算应变向量。\n- 在每个高斯点计算 $\\psi_e(\\boldsymbol{\\varepsilon})$ 和 $g'(\\phi)$，其中高斯点处的 $\\phi$ 值是通过形函数从节点的 $\\phi$ 值插值得到。\n- 通过对所有高斯点上的试函数、力学耦合项、雅可比行列式与积分权重的乘积进行积分（求和），累加得到单元残余耦合向量的各分量。\n- 使用由 $E$ 和 $\\nu$ 定义的平面应变本构矩阵。\n\n物理单位：$E$ 的单位为帕斯卡 ($\\text{Pa}$)，坐标和位移的单位为米 ($\\text{m}$)，残余项的计算结果单位为焦耳 ($\\text{J}$)，假设单位厚度为 $1$ 米。\n\n角度单位：不适用。\n\n百分比：不适用。\n\n测试套件与参数：\n\n设节点排序为 $1$ (左下)、$2$ (右下)、$3$ (右上)、$4$ (左上)。对于以下所有测试用例，使用 $E = 2.10 \\times 10^{11}$ $\\text{Pa}$ 和 $\\nu = 0.30$，并取 $\\kappa = 1.0 \\times 10^{-6}$ (无量纲)。高斯积分使用点 $(\\xi,\\eta) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$，权重均为单位值 (1)。\n\n- 测试用例 1 (单位正方形上的均匀轴向应变，中等 $\\phi$ 值):\n  - 节点坐标（单位：米）：$\\left[(0,0), (1,0), (1,1), (0,1)\\right]$。\n  - 位移（单位：米）：指定 $u_x = \\alpha x$, $u_y = 0$，其中 $\\alpha = 1.0 \\times 10^{-4}$，得到节点位移为 $\\left[(0,0), (\\alpha,0), (\\alpha,0), (0,0)\\right]$。\n  - 节点 $\\phi$ 值：$\\left[0.20, 0.20, 0.20, 0.20\\right]$。\n\n- 测试用例 2 (单位正方形上的零应变，任意 $\\phi$ 值):\n  - 节点坐标（单位：米）：$\\left[(0,0), (1,0), (1,1), (0,1)\\right]$。\n  - 位移（单位：米）：$\\left[(0,0), (0,0), (0,0), (0,0)\\right]$。\n  - 节点 $\\phi$ 值：$\\left[0.50, 0.50, 0.50, 0.50\\right]$。\n\n- 测试用例 3 (带有剪切型位移和变化 $\\phi$ 值的扭曲单元):\n  - 节点坐标（单位：米）：$\\left[(0.0,0.0), (1.5,0.2), (1.4,1.3), (-0.1,0.9)\\right]$。\n  - 位移（单位：米）：指定 $u_x = 0$, $u_y = \\beta x$，其中 $\\beta = 2.0 \\times 10^{-4}$，得到节点位移为 $\\left[(0,0), (0, 3.0 \\times 10^{-4}), (0, 2.8 \\times 10^{-4}), (0, -2.0 \\times 10^{-5})\\right]$。\n  - 节点 $\\phi$ 值：$\\left[0.10, 0.40, 0.70, 0.20\\right]$。\n\n- 测试用例 4 (单位正方形上的均匀轴向应变，$\\phi$ 值接近 1):\n  - 节点坐标（单位：米）：$\\left[(0,0), (1,0), (1,1), (0,1)\\right]$。\n  - 位移（单位：米）：与测试用例 1 相同，$\\alpha = 1.0 \\times 10^{-4}$。\n  - 节点 $\\phi$ 值：$\\left[0.99, 0.99, 0.99, 0.99\\right]$。\n\n最终输出格式：\n\n你的程序应生成单行输出，其中包含所有测试用例的 $\\phi$ 方程的单元残余耦合向量（仅力学贡献）的逗号分隔列表，每个残余向量表示为一个包含四个浮点数的逗号分隔列表。整个输出应为用方括号括起来的单个列表之列表，例如 $\\left[[r_{1,1}, r_{1,2}, r_{1,3}, r_{1,4}], [r_{2,1}, \\dots], \\dots \\right]$。请精确打印这一行。",
            "solution": "该问题在科学上是合理的，提法恰当，且所有必要的参数都已提供。它是有限元法在耦合化学-力学或损伤-力学问题上的一个标准应用。因此，该问题被视为有效。\n\n任务是计算相场方程的单元级残余向量，具体来说是由力学储存能产生的贡献。该向量记为 $\\mathbf{r}_{\\phi,\\text{mech}}^e$，表示与节点相场变量热力学共轭的节点力，并由力学应变状态驱动。\n\n出发点是总内能密度，其包含了退化的力学能项 $g(\\phi)\\psi_e(\\boldsymbol{\\varepsilon})$。该项对相场 $\\phi$ 的变分导数给出了相场演化方程中的力学源项：\n$$\nS_{\\text{mech}} = \\frac{\\partial (g(\\phi)\\psi_e(\\boldsymbol{\\varepsilon}))}{\\partial \\phi} = g'(\\phi)\\psi_e(\\boldsymbol{\\varepsilon})\n$$\n退化函数由 $g(\\phi) = (1 - \\phi)^2 + \\kappa$ 给出，因此其对 $\\phi$ 的导数为：\n$$\ng'(\\phi) = -2(1 - \\phi)\n$$\n对于线性弹性，力学自由能密度为 $\\psi_e(\\boldsymbol{\\varepsilon}) = \\frac{1}{2} \\boldsymbol{\\varepsilon}^T \\mathbf{C} \\boldsymbol{\\varepsilon}$。在有限元法的背景下，对弱形式的贡献是通过在单元域 $\\Omega_e$ 上对源项与试函数 $v_{\\phi}$ 的乘积进行积分得到的。使用 Bubnov-Galerkin 方法，试函数与形函数 $N_i$ 相同。因此，单元残余向量的第 $i$ 个分量为：\n$$\nr_i = \\int_{\\Omega_e} N_i S_{\\text{mech}} \\, dV = \\int_{\\Omega_e} N_i \\, g'(\\phi) \\, \\psi_e(\\boldsymbol{\\varepsilon}) \\, dV\n$$\n对于一个单位厚度 $t=1$ 的二维单元，体积分变为面积分，$dV = t \\, dA = 1 \\cdot dA$。该积分使用 $2 \\times 2$ 高斯积分进行数值计算。从物理坐标 $(x,y)$ 到父坐标 $(\\xi, \\eta)$ 的变换引入了雅可比行列式 $\\det(\\mathbf{J})$，其中 $dA = \\det(\\mathbf{J}) d\\xi d\\eta$。残余向量的分量可近似为对 $N_{gp}=4$ 个高斯点的求和：\n$$\nr_i \\approx \\sum_{q=1}^{N_{gp}} w_q N_i(\\boldsymbol{\\xi}_q) \\, g'(\\phi(\\boldsymbol{\\xi}_q)) \\, \\psi_e(\\boldsymbol{\\varepsilon}(\\boldsymbol{\\xi}_q)) \\det(\\mathbf{J}(\\boldsymbol{\\xi}_q))\n$$\n其中 $\\boldsymbol{\\xi}_q$ 是第 $q$ 个高斯点的坐标，$w_q$ 是对应的权重。对于本问题，$w_q = 1$ 对所有 $q$ 成立。\n\n在每个高斯点 $\\boldsymbol{\\xi}_q = (\\xi_q, \\eta_q)$ 处的计算流程如下：\n1.  **插值场**：相场 $\\phi$ 通过形函数 $N_j(\\boldsymbol{\\xi}_q)$ 从其节点值 $\\phi_j$ 插值得到：\n    $$\n    \\phi(\\boldsymbol{\\xi}_q) = \\sum_{j=1}^4 N_j(\\boldsymbol{\\xi}_q) \\phi_j\n    $$\n    对于从 $(\\xi,\\eta)=(-1,-1)$ 开始逆时针排序节点的双线性四边形单元，其形函数为：\n    $N_1 = \\frac{1}{4}(1-\\xi)(1-\\eta)$, $N_2 = \\frac{1}{4}(1+\\xi)(1-\\eta)$, $N_3 = \\frac{1}{4}(1+\\xi)(1+\\eta)$, $N_4 = \\frac{1}{4}(1-\\xi)(1+\\eta)$。\n\n2.  **计算几何映射**：从父坐标到物理坐标的等参映射的雅可比矩阵计算如下：\n    $$\n    \\mathbf{J} = \\begin{bmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\eta} \\end{bmatrix} = \\begin{bmatrix} \\sum_j \\frac{\\partial N_j}{\\partial \\xi} x_j  \\sum_j \\frac{\\partial N_j}{\\partial \\xi} y_j \\\\ \\sum_j \\frac{\\partial N_j}{\\partial \\eta} x_j  \\sum_j \\frac{\\partial N_j}{\\partial \\eta} y_j \\end{bmatrix}\n    $$\n\n3.  **计算应变**：应变向量通过应变-位移矩阵 $\\mathbf{B}$ 从节点位移 $\\mathbf{d}^e = [u_{x1}, u_{y1}, \\dots, u_{x4}, u_{y4}]^T$ 计算得出：\n    $$\n    \\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{d}^e\n    $$\n    问题描述将“工程应变向量”指定为 $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\varepsilon_{xy}]^T$。标准的有限元实践使用工程剪切应变 $\\gamma_{xy} = 2\\varepsilon_{xy}$。我们继续假设采用标准公式，即 $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T$，这使得能量表达式 $\\frac{1}{2}\\boldsymbol{\\varepsilon}^T \\mathbf{C} \\boldsymbol{\\varepsilon}$ 与标准的平面应变本构矩阵 $\\mathbf{C}$ 相一致。$\\mathbf{B}$ 矩阵将这些应变与节点位移相关联，并包含形函数的空间导数 $\\frac{\\partial N_j}{\\partial x}$ 和 $\\frac{\\partial N_j}{\\partial y}$，这些导数通过雅可比矩阵的逆求得：\n    $$\n    \\begin{Bmatrix} \\frac{\\partial N_j}{\\partial x} \\\\ \\frac{\\partial N_j}{\\partial y} \\end{Bmatrix} = \\mathbf{J}^{-1} \\begin{Bmatrix} \\frac{\\partial N_j}{\\partial \\xi} \\\\ \\frac{\\partial N_j}{\\partial \\eta} \\end{Bmatrix}\n    $$\n    节点 $j$ 的 $\\mathbf{B}$ 矩阵为 $\\mathbf{B}_j = \\begin{bmatrix} \\frac{\\partial N_j}{\\partial x}  0 \\\\ 0  \\frac{\\partial N_j}{\\partial y} \\\\ \\frac{\\partial N_j}{\\partial y}  \\frac{\\partial N_j}{\\partial x} \\end{bmatrix}$，完整的 $\\mathbf{B}$ 矩阵为 $\\mathbf{B} = [\\mathbf{B}_1, \\mathbf{B}_2, \\mathbf{B}_3, \\mathbf{B}_4]$。\n\n4.  **计算能量密度**：平面应变的本构矩阵 $\\mathbf{C}$ 为：\n    $$\n    \\mathbf{C} = \\frac{E}{(1+\\nu)(1-2\\nu)} \\begin{bmatrix} 1-\\nu  \\nu  0 \\\\ \\nu  1-\\nu  0 \\\\ 0  0  \\frac{1-2\\nu}{2} \\end{bmatrix}\n    $$\n    弹性应变能密度随后按 $\\psi_e = \\frac{1}{2} (\\mathbf{B} \\mathbf{d}^e)^T \\mathbf{C} (\\mathbf{B} \\mathbf{d}^e)$ 计算。\n\n5.  **组集残余**：在每个高斯点组合所有项并求和，以计算最终的单元残余向量 $\\mathbf{r}_{\\phi,\\text{mech}}^e = [r_1, r_2, r_3, r_4]^T$。\n\n该流程将针对每个测试用例，使用所提供的材料属性（$E = 2.10 \\times 10^{11} \\text{ Pa}$, $\\nu = 0.30$, $\\kappa = 1.0 \\times 10^{-6}$）、几何信息和场值进行实现。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_residual_vector(coords, displacements, phis, E, nu, kappa):\n    \"\"\"\n    Computes the element-level residual coupling vector for the phi-equation.\n    \n    Args:\n        coords (list of tuples): Nodal coordinates [(x1,y1), (x2,y2), ...].\n        displacements (list of tuples): Nodal displacements [(ux1,uy1), (ux2,uy2), ...].\n        phis (list): Nodal phase-field values [phi1, phi2, ...].\n        E (float): Young's modulus.\n        nu (float): Poisson's ratio.\n        kappa (float): Residual stiffness constant.\n\n    Returns:\n        np.array: The 4-component element residual vector.\n    \"\"\"\n    # Material properties and constitutive matrix for plane strain\n    C = np.zeros((3, 3))\n    factor = E / ((1 + nu) * (1 - 2 * nu))\n    C[0, 0] = factor * (1 - nu)\n    C[1, 1] = factor * (1 - nu)\n    C[0, 1] = factor * nu\n    C[1, 0] = factor * nu\n    C[2, 2] = E / (2 * (1 + nu)) # Shear modulus G\n\n    # Gaussian quadrature points and weights for 2x2 scheme\n    a = 1.0 / np.sqrt(3.0)\n    gauss_points = [(-a, -a), (a, -a), (a, a), (-a, a)]\n    gauss_weights = [1.0, 1.0, 1.0, 1.0]\n\n    # Nodal data vectors\n    nodal_coords = np.array(coords, dtype=float)\n    nodal_displacements = np.array(displacements, dtype=float).flatten()\n    nodal_phis = np.array(phis, dtype=float)\n\n    residual_vec = np.zeros(4, dtype=float)\n\n    for q_idx in range(len(gauss_points)):\n        xi, eta = gauss_points[q_idx]\n        weight = gauss_weights[q_idx]\n\n        # Shape functions and their derivatives in parent domain\n        N = 0.25 * np.array([\n            (1 - xi) * (1 - eta),\n            (1 + xi) * (1 - eta),\n            (1 + xi) * (1 + eta),\n            (1 - xi) * (1 + eta)\n        ])\n        dN_dxi = 0.25 * np.array([\n            -(1 - eta), (1 - eta), (1 + eta), -(1 + eta)\n        ])\n        dN_deta = 0.25 * np.array([\n            -(1 - xi), -(1 + xi), (1 + xi), (1 - xi)\n        ])\n\n        # Jacobian matrix\n        J = np.zeros((2, 2))\n        J[0, 0] = np.dot(dN_dxi, nodal_coords[:, 0])\n        J[0, 1] = np.dot(dN_dxi, nodal_coords[:, 1])\n        J[1, 0] = np.dot(dN_deta, nodal_coords[:, 0])\n        J[1, 1] = np.dot(dN_deta, nodal_coords[:, 1])\n\n        detJ = np.linalg.det(J)\n        if detJ = 0:\n            raise ValueError(\"Jacobian determinant is non-positive.\")\n        invJ = np.linalg.inv(J)\n\n        # Derivatives of shape functions in physical domain\n        dN_dx_dy = invJ @ np.vstack((dN_dxi, dN_deta))\n        dN_dx = dN_dx_dy[0, :]\n        dN_dy = dN_dx_dy[1, :]\n\n        # Strain-displacement matrix (B)\n        B = np.zeros((3, 8))\n        B[0, 0::2] = dN_dx\n        B[1, 1::2] = dN_dy\n        B[2, 0::2] = dN_dy\n        B[2, 1::2] = dN_dx\n\n        # Strain vector at Gauss point\n        strain = B @ nodal_displacements\n\n        # Elastic energy density\n        psi_e = 0.5 * strain.T @ C @ strain\n        \n        # If strain is zero, no mechanical contribution\n        if np.isclose(psi_e, 0.0):\n            continue\n\n        # Phase-field value at Gauss point\n        phi_q = np.dot(N, nodal_phis)\n\n        # Derivative of degradation function\n        g_prime = -2.0 * (1.0 - phi_q)\n\n        # Accumulate residual vector\n        # Integrand = N_i * g'(phi) * psi_e. Integral over area = sum(w * integrand * detJ * t)\n        # with thickness t=1.\n        integrand_val = g_prime * psi_e * detJ * weight\n        residual_vec += N * integrand_val\n\n    return residual_vec\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print the results.\n    \"\"\"\n    E = 2.10e11\n    nu = 0.30\n    kappa = 1.0e-6\n\n    alpha = 1.0e-4\n    beta = 2.0e-4\n\n    test_cases = [\n        # Case 1\n        (\n            [(0.0, 0.0), (1.0, 0.0), (1.0, 1.0), (0.0, 1.0)],\n            [(0.0, 0.0), (alpha, 0.0), (alpha, 0.0), (0.0, 0.0)],\n            [0.20, 0.20, 0.20, 0.20]\n        ),\n        # Case 2\n        (\n            [(0.0, 0.0), (1.0, 0.0), (1.0, 1.0), (0.0, 1.0)],\n            [(0.0, 0.0), (0.0, 0.0), (0.0, 0.0), (0.0, 0.0)],\n            [0.50, 0.50, 0.50, 0.50]\n        ),\n        # Case 3\n        (\n            [(0.0, 0.0), (1.5, 0.2), (1.4, 1.3), (-0.1, 0.9)],\n            [(0.0, 0.0), (0.0, beta * 1.5), (0.0, beta * 1.4), (0.0, beta * -0.1)],\n            [0.10, 0.40, 0.70, 0.20]\n        ),\n        # Case 4\n        (\n            [(0.0, 0.0), (1.0, 0.0), (1.0, 1.0), (0.0, 1.0)],\n            [(0.0, 0.0), (alpha, 0.0), (alpha, 0.0), (0.0, 0.0)],\n            [0.99, 0.99, 0.99, 0.99]\n        )\n    ]\n\n    results = []\n    for case_data in test_cases:\n        coords, displacements, phis = case_data\n        result_vector = calculate_residual_vector(coords, displacements, phis, E, nu, kappa)\n        results.append(result_vector)\n\n    # Format output as a list of lists of floats, without spaces.\n    list_of_strings = []\n    for vec in results:\n        inner_str = f\"[{','.join(f'{x:.8e}' for x in vec)}]\"\n        list_of_strings.append(inner_str)\n    \n    print(f\"[{','.join(list_of_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "为了实现稳健高效的模拟，尤其是在处理复杂的非线性问题时，通常首选牛顿法等隐式求解方法，而这些方法需要雅可比矩阵 $\\mathbf{K}$。本练习将指导您推导一个关键的耦合项 $K_{u\\phi}$，它描述了力学残差对相场 $\\phi$ 变化的敏感度，从而揭示耦合的“另一面”：演化中的损伤场如何影响材料的力学刚度。理解如何推导和实现这些雅可比项，对于为耦合问题开发稳定且快速收敛的整体式求解器至关重要。",
            "id": "3746990",
            "problem": "考虑一个长度为 $L$、横截面积为 $A$ 的一维小应变超弹性杆。设位移场为 $u(x)$，小应变定义为 $\\varepsilon(x) = \\partial u / \\partial x$。引入一个标量相场 $ \\phi(x) \\in [0,1] $，通过无量纲退化函数 $g(\\phi)$ 和一个小的正则化参数 $\\kappa > 0$ 来模拟刚度退化。假设弹性应变能密度由 $W(\\phi,\\varepsilon) = g(\\phi)\\,\\frac{1}{2}\\,\\varepsilon\\,E\\,\\varepsilon$ 给出，其中 $E$ 表示杨氏模量，并定义 $g(\\phi)$ 为 $g(\\phi) = (1-\\phi)^2 + \\kappa$。Cauchy 应力 $\\sigma$ 根据超弹性理论定义为 $\\sigma = \\partial W / \\partial \\varepsilon$。使用有限元法 (FEM)，对于一个双节点线性单元，设形函数为 $N_1(x) = 1 - x/L$ 和 $N_2(x) = x/L$，相应的应变-位移矩阵项为 $B_1 = \\partial N_1/\\partial x = -1/L$ 和 $B_2 = \\partial N_2/\\partial x = +1/L$。假设当前状态下，相场 $\\phi$ 和应变 $\\varepsilon$ 在整个单元上是均匀的。\n\n使用上述定义，并从无牵引力边界条件的力学平衡虚功原理出发，根据第一性原理推导导数 $\\partial_{\\phi} \\sigma$ 的表达式，然后推导混合位移-相场雅可比块项 $K_{u\\phi}^{(i,j)}$ 的贡献。该项对应于与节点 $i \\in \\{1,2\\}$ 的位移自由度相关的检验函数以及与节点 $j \\in \\{1,2\\}$ 的相场自由度相关的试探函数。在所述假设下，该贡献应表示为一个包含 $B_i$、$N_j$、$\\partial_{\\phi}\\sigma$、$A$ 和适当常数的域积分。\n\n您的任务是实现一个程序，在 $\\phi$ 和 $\\varepsilon$ 均匀的假设下，为每个提供的测试用例计算单元混合雅可比块项 $K_{u\\phi}^{(i,j)}$ 的标量值。使用 $g(\\phi) = (1-\\phi)^2 + \\kappa$，并将 $E$、$\\phi$、$\\varepsilon$、$A$、$L$、$i$、$j$ 和 $\\kappa$ 视为每个测试用例的给定输入。所有输出必须以牛顿 (N) 为单位，并四舍五入到三位小数。程序必须将所有测试用例的结果汇总到一行输出中，格式为用方括号括起来的、逗号分隔的 Python 风格列表。\n\n测试套件：\n1. $E = 30 \\times 10^9$ Pa, $\\phi = 0.25$, $\\varepsilon = 1.0 \\times 10^{-3}$, $A = 1.0$ m$^2$, $L = 1.0$ m, $i = 1$, $j = 2$, $\\kappa = 1.0 \\times 10^{-6}$。\n2. $E = 70 \\times 10^9$ Pa, $\\phi = 1.0$, $\\varepsilon = 5.0 \\times 10^{-4}$, $A = 0.5$ m$^2$, $L = 2.0$ m, $i = 2$, $j = 1$, $\\kappa = 1.0 \\times 10^{-6}$。\n3. $E = 50 \\times 10^9$ Pa, $\\phi = 0.6$, $\\varepsilon = 0.0$, $A = 2.0$ m$^2$, $L = 3.0$ m, $i = 1$, $j = 1$, $\\kappa = 1.0 \\times 10^{-6}$。\n4. $E = 200 \\times 10^9$ Pa, $\\phi = 0.0$, $\\varepsilon = 2.0 \\times 10^{-3}$, $A = 3.0$ m$^2$, $L = 0.5$ m, $i = 2$, $j = 2$, $\\kappa = 1.0 \\times 10^{-6}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4]”），其中每个结果都是以牛顿为单位、四舍五入到三位小数的浮点数。",
            "solution": "该问题陈述经评估有效。它在科学上基于连续介质力学、相场建模和有限元法的原理。所有参数、函数和假设都得到了清晰的定义，构成了一个自洽且适定的问题。其中没有矛盾、歧义或事实不准确之处。因此，我们可以进行形式化的推导和求解。\n\n目标是为一个双节点线性单元推导混合雅可比块项 $K_{u\\phi}^{(i,j)}$ 的表达式。该项表示节点 $i$ 处的力学残差对节点 $j$ 处相场自由度变化的敏感度。\n\n推导始于虚功原理 (PVW)，它提供了力学平衡方程的弱形式。在没有体力且边界无牵引力的情况下，PVW 指出，对于任何运动学上容许的虚位移场 $\\delta u(x)$，其内虚功为零：\n$$ \\mathcal{R}_u = \\int_0^L \\sigma(x) \\delta\\varepsilon(x) A \\, dx = 0 $$\n此处，$\\sigma(x)$ 是 Cauchy 应力，$\\delta\\varepsilon(x) = \\partial(\\delta u)/\\partial x$ 是虚应变，$A$ 是横截面积，积分是在单元长度 $L$ 上进行的。\n\n使用有限元法，我们利用形函数 $N_k(x)$ 以及节点自由度 $u_k$ 和 $\\phi_k$ 来离散化位移场 $u(x)$ 和相场 $\\phi(x)$：\n$$ u(x) = \\sum_{k=1}^2 N_k(x) u_k \\quad \\text{and} \\quad \\phi(x) = \\sum_{k=1}^2 N_k(x) \\phi_k $$\n应变场 $\\varepsilon(x)$ 则由下式给出：\n$$ \\varepsilon(x) = \\frac{\\partial u}{\\partial x} = \\sum_{k=1}^2 \\frac{\\partial N_k}{\\partial x} u_k = \\sum_{k=1}^2 B_k(x) u_k $$\n对于单个节点 $i$ 的虚位移 $\\delta u_i$，虚位移场和虚应变场也类似地离散化：\n$$ \\delta u(x) = N_i(x) \\delta u_i \\quad \\implies \\quad \\delta\\varepsilon(x) = \\frac{\\partial N_i}{\\partial x} \\delta u_i = B_i(x) \\delta u_i $$\n将虚应变代入 PVW，我们得到力学残差向量的第 $i$ 个分量 $R_{u,i}$：\n$$ R_{u,i} = \\frac{\\partial \\mathcal{R}_u}{\\partial (\\delta u_i)} = \\int_0^L \\sigma(x) B_i(x) A \\, dx $$\n当对所有 $i$ 都有 $R_{u,i} = 0$ 时，系统处于平衡状态。\n\n混合雅可比块项 $K_{u\\phi}^{(i,j)}$ 定义为第 $i$ 个力学残差分量相对于第 $j$ 个相场节点自由度 $\\phi_j$ 的偏导数：\n$$ K_{u\\phi}^{(i,j)} = \\frac{\\partial R_{u,i}}{\\partial \\phi_j} = \\frac{\\partial}{\\partial \\phi_j} \\left( \\int_0^L \\sigma(\\phi(x), \\varepsilon(x)) B_i(x) A \\, dx \\right) $$\n假设正则性足够，我们可以将导数移到积分内部：\n$$ K_{u\\phi}^{(i,j)} = \\int_0^L \\frac{\\partial \\sigma}{\\partial \\phi_j} B_i(x) A \\, dx $$\n使用链式法则，我们将应力 $\\sigma$ 对节点变量 $\\phi_j$ 的导数表示为：\n$$ \\frac{\\partial \\sigma}{\\partial \\phi_j} = \\frac{\\partial \\sigma}{\\partial \\phi} \\frac{\\partial \\phi(x)}{\\partial \\phi_j} $$\n根据离散化 $\\phi(x) = \\sum_{k=1}^2 N_k(x) \\phi_k$，我们得到 $\\frac{\\partial \\phi(x)}{\\partial \\phi_j} = N_j(x)$。将其代入雅可比表达式，得到：\n$$ K_{u\\phi}^{(i,j)} = \\int_0^L \\frac{\\partial \\sigma}{\\partial \\phi} N_j(x) B_i(x) A \\, dx $$\n这是雅可比贡献的一般积分形式。\n\n接下来，我们推导 $\\frac{\\partial \\sigma}{\\partial \\phi}$ 项。弹性应变能密度 $W$ 和 Cauchy 应力 $\\sigma$ 由下式给出：\n$$ W(\\phi, \\varepsilon) = g(\\phi) \\frac{1}{2} E \\varepsilon^2 = \\left( (1-\\phi)^2 + \\kappa \\right) \\frac{1}{2} E \\varepsilon^2 $$\n$$ \\sigma = \\frac{\\partial W}{\\partial \\varepsilon} = g(\\phi) E \\varepsilon = \\left( (1-\\phi)^2 + \\kappa \\right) E \\varepsilon $$\n我们对 $\\sigma$ 求关于 $\\phi$ 的偏导数，将 $\\varepsilon$ 视为一个独立变量（因为在耦合问题中 $u$ 和 $\\phi$ 是独立的场）：\n$$ \\frac{\\partial \\sigma}{\\partial \\phi} = \\frac{\\partial}{\\partial \\phi} \\left[ \\left( (1-\\phi)^2 + \\kappa \\right) E \\varepsilon \\right] = E \\varepsilon \\left[ \\frac{\\partial}{\\partial \\phi} ((1-\\phi)^2 + \\kappa) \\right] $$\n$$ \\frac{\\partial \\sigma}{\\partial \\phi} = E \\varepsilon \\left[ 2(1-\\phi)(-1) + 0 \\right] = -2(1-\\phi)E\\varepsilon $$\n\n现在，我们将这个导数代回到 $K_{u\\phi}^{(i,j)}$ 的积分中：\n$$ K_{u\\phi}^{(i,j)} = \\int_0^L \\left[ -2(1-\\phi(x))E\\varepsilon(x) \\right] N_j(x) B_i(x) A \\, dx $$\n问题陈述了一个关键假设，即相场 $\\phi$ 和应变 $\\varepsilon$ 在整个单元上是均匀的。因此，$\\phi(x) = \\phi$ 和 $\\varepsilon(x) = \\varepsilon$ 是相对于积分变量 $x$ 的常数。我们可以将所有常数项移到积分之外：\n$$ K_{u\\phi}^{(i,j)} = -2(1-\\phi)E\\varepsilon B_i A \\int_0^L N_j(x) \\, dx $$\n对于线性单元，应变-位移矩阵项 $B_i$ 也是常数：$B_1 = -1/L$ 和 $B_2 = 1/L$。\n\n剩下的任务是计算形函数在单元长度 $L$ 上的积分。\n对于节点 $j=1$，$N_1(x) = 1 - x/L$：\n$$ \\int_0^L N_1(x) \\, dx = \\int_0^L \\left(1 - \\frac{x}{L}\\right) \\, dx = \\left[x - \\frac{x^2}{2L}\\right]_0^L = L - \\frac{L^2}{2L} = \\frac{L}{2} $$\n对于节点 $j=2$，$N_2(x) = x/L$：\n$$ \\int_0^L N_2(x) \\, dx = \\int_0^L \\frac{x}{L} \\, dx = \\left[\\frac{x^2}{2L}\\right]_0^L = \\frac{L^2}{2L} = \\frac{L}{2} $$\n无论 $j$ 的值如何，该积分的计算结果都是 $L/2$。这意味着 $K_{u\\phi}^{(i,j)}$ 的最终表达式将与索引 $j$ 无关。\n\n将积分结果代回到 $K_{u\\phi}^{(i,j)}$ 的表达式中：\n$$ K_{u\\phi}^{(i,j)} = -2(1-\\phi)E\\varepsilon B_i A \\left(\\frac{L}{2}\\right) = -(1-\\phi)E\\varepsilon A L B_i $$\n现在，我们代入 $B_i$ 的具体值：\n对于 $i=1$：\n$$ K_{u\\phi}^{(1,j)} = -(1-\\phi)E\\varepsilon A L \\left(-\\frac{1}{L}\\right) = (1-\\phi)E\\varepsilon A $$\n对于 $i=2$：\n$$ K_{u\\phi}^{(2,j)} = -(1-\\phi)E\\varepsilon A L \\left(+\\frac{1}{L}\\right) = -(1-\\phi)E\\varepsilon A $$\n最终公式与单元长度 $L$、相场节点索引 $j$ 以及正则化参数 $\\kappa$ 无关。这是一维线性单元公式和特定退化函数形式的直接结果。\n\n用于计算的最终公式是：\n$$ K_{u\\phi}^{(i,j)} = \\begin{cases} (1-\\phi) E \\varepsilon A  \\text{if } i=1 \\\\ -(1-\\phi) E \\varepsilon A  \\text{if } i=2 \\end{cases} $$\n单位为 $(\\text{无量纲}) \\times (\\text{N}/\\text{m}^2) \\times (\\text{无量纲}) \\times (\\text{m}^2) = \\text{N}$，符合要求。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the mixed displacement-phase Jacobian block entry K_uφ^(i,j)\n    for a single two-node linear finite element based on a phase-field model.\n    \"\"\"\n\n    test_cases = [\n        # (E, phi, epsilon, A, L, i, j, kappa)\n        (30e9, 0.25, 1.0e-3, 1.0, 1.0, 1, 2, 1.0e-6),\n        (70e9, 1.0, 5.0e-4, 0.5, 2.0, 2, 1, 1.0e-6),\n        (50e9, 0.6, 0.0, 2.0, 3.0, 1, 1, 1.0e-6),\n        (200e9, 0.0, 2.0e-3, 3.0, 0.5, 2, 2, 1.0e-6),\n    ]\n\n    results = []\n    for case in test_cases:\n        E, phi, epsilon, A, L, i, j, kappa = case\n\n        # The derived formula for the mixed Jacobian block entry is:\n        # K_uφ^(i,j) = (1-phi) * E * epsilon * A   for i = 1\n        # K_uφ^(i,j) = -(1-phi) * E * epsilon * A  for i = 2\n        # The result is independent of j, L, and kappa under the given assumptions.\n\n        common_term = (1 - phi) * E * epsilon * A\n\n        if i == 1:\n            result = common_term\n        elif i == 2:\n            result = -common_term\n        else:\n            # This case should not occur based on the problem statement (i ∈ {1,2})\n            raise ValueError(f\"Invalid node index i: {i}\")\n\n        results.append(result)\n\n    # Format the results to three decimal places as strings\n    formatted_results = [f\"{r:.3f}\" for r in results]\n\n    # Print the final output in the required single-line format\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "任何数值模型都是一种近似，而我们做出的选择（例如如何定义边界条件）可能会产生重大的，有时甚至是反物理的后果。本练习将视角从数值实现转向解析研究，探讨相场 $\\phi$ 的不同边界条件如何人为地影响裂纹的萌生。通过分析一个简化的一维模型 ，您将培养出一种批判性直觉，能够识别相场模拟中由边界引起的潜在伪影，并理解仔细论证数值选择以确保结果物理相关性的重要性。",
            "id": "3746965",
            "problem": "考虑一根长度为 $L$ 的一维弹性杆，承受小应变单轴拉伸。令 $x \\in [0,L]$ 表示空间坐标，位移场为 $u(x)$，并指定边界位移 $u(0) = 0$ 和 $u(L) = \\varepsilon_{0} L$，使得对于所有 $x \\in [0, L]$，应变为 $ \\varepsilon(x) = \\varepsilon_{0} $。该杆的特征是杨氏模量 $E$（单位为 $\\mathrm{Pa}$）。断裂由一个相场 $ \\phi(x) \\in [0,1] $ 建模，其内部长度尺度为 $l$（单位为 $\\mathrm{m}$），断裂韧性为 $G_{c}$（单位为 $\\mathrm{N}/\\mathrm{m}$）。我们考虑标准的拉压分离，其中拉伸弹性应变能密度为 $ \\psi_{+} = \\frac{1}{2} E \\varepsilon_{0}^{2} $，并与相场断裂能量泛函耦合。\n\n假设在一个准静态、小损伤、线性化的体系中，刚度退化函数可以一阶近似为 $g(\\phi) \\approx 1$。从最小势能原理和欧拉-拉格朗日方程出发，一维线性化相场的稳态条件简化为以下受迫扩散-反应常微分方程：\n$$\nG_{c}\\, l\\, \\phi''(x) \\;-\\; \\frac{G_{c}}{l}\\, \\phi(x) \\;=\\; -\\, 2\\, \\psi_{+} \\quad \\text{for } x \\in (0,L),\n$$\n其中 $ \\psi_{+} = \\frac{1}{2} E \\varepsilon_{0}^{2} $。该表达式在损伤的早期阶段有效，此时 $ \\phi \\ll 1 $，且不可逆性约束尚未导致使线性化失效的非线性。考虑在 $ x=0 $ 和 $ x=L $ 处相场 $ \\phi $ 的三种边界条件：\n\n- 狄利克雷边界条件（本质边界条件）：$ \\phi(0) = 0 $ 和 $ \\phi(L) = 0 $。\n- 诺伊曼边界条件（自然边界条件）：$ \\phi'(0) = 0 $ 和 $ \\phi'(L) = 0 $。\n- 罗宾边界条件（混合边界条件）：$ l\\, \\phi'(0) + \\beta\\, \\phi(0) = 0 $ 和 $ l\\, \\phi'(L) + \\beta\\, \\phi(L) = 0 $，其中 $ \\beta $ 是一个无量纲参数。\n\n令非齐次方程的特解表示为 $ \\phi_{p} $，其中 $ \\phi_{p} $ 在整个杆上是常数。定义伪影敏感度度量为杆中心处的相场值与体特解的比值：\n$$\nr \\;=\\; \\frac{\\phi\\left(\\frac{L}{2}\\right)}{\\phi_{p}},\n$$\n该度量用于量化边界条件相对于体值对中心处损伤的抑制或放大效应。在线性化体系中，特解为 $ \\phi_{p} = \\dfrac{2\\, \\psi_{+}\\, l}{G_{c}} = \\dfrac{E\\, \\varepsilon_{0}^{2}\\, l}{G_{c}} $。\n\n定义一个实用的裂纹萌生阈值，即中心相场达到预设阈值 $ \\phi_{\\mathrm{th}} \\in (0,1) $ 时的最小应变 $ \\varepsilon_{\\mathrm{init}} $：\n$$\n\\phi\\left(\\frac{L}{2}\\right) \\;=\\; \\phi_{\\mathrm{th}}.\n$$\n在线性关系 $ \\phi\\left(\\frac{L}{2}\\right) = r\\, \\phi_{p} = r\\, \\dfrac{E\\, \\varepsilon_{0}^{2} l}{G_{c}} $下，这给出了萌生应变\n$$\n\\varepsilon_{\\mathrm{init}} \\;=\\; \\sqrt{ \\frac{ \\phi_{\\mathrm{th}}\\, G_{c} }{ E\\, l\\, r } }.\n$$\n相应的萌生应力为 $ \\sigma_{\\mathrm{init}} = E\\, \\varepsilon_{\\mathrm{init}} $，应以 $\\mathrm{Pa}$ 为单位表示。\n\n您的任务：\n1. 从第一性原理（带有线性化力学的耦合相场断裂的变分公式）推导上述关于 $ \\phi(x) $ 的常微分方程、$ \\phi_{p} $ 的特解形式，以及每种边界条件下 $ r $、$ \\varepsilon_{\\mathrm{init}} $ 和 $ \\sigma_{\\mathrm{init}} $ 的表达式。\n2. 实现一个程序，对下面的每个测试用例，使用线性常微分方程和边界条件的精确解来计算 $ r $、$ \\varepsilon_{\\mathrm{init}} $ 和 $ \\sigma_{\\mathrm{init}} $。解必须通过解析方法计算，而不是数值离散化，以便在早期损伤体系中隔离和量化由边界条件引起的伪影。\n\n物理单位和输出要求：\n- $ E $ 的单位是 $ \\mathrm{Pa} $。\n- $ G_{c} $ 的单位是 $ \\mathrm{N}/\\mathrm{m} $。\n- $ l $ 和 $ L $ 的单位是 $ \\mathrm{m} $。\n- $ \\varepsilon_{\\mathrm{init}} $ 是无量纲的。\n- $ \\sigma_{\\mathrm{init}} $ 必须以 $ \\mathrm{Pa} $ 为单位报告。\n\n测试套件：\n- 案例 1 (理想情况，具有中等内部长度的狄利克雷条件): $ \\text{BC} = \\text{D} $, $ L = 0.1\\, \\mathrm{m} $, $ l = 0.01\\, \\mathrm{m} $, $ E = 70 \\times 10^{9}\\, \\mathrm{Pa} $, $ G_{c} = 2.7 \\times 10^{3}\\, \\mathrm{N}/\\mathrm{m} $, $ \\phi_{\\mathrm{th}} = 0.01 $。\n- 案例 2 (诺伊曼边界条件基准): $ \\text{BC} = \\text{N} $, $ L = 0.1\\, \\mathrm{m} $, $ l = 0.01\\, \\mathrm{m} $, $ E = 70 \\times 10^{9}\\, \\mathrm{Pa} $, $ G_{c} = 2.7 \\times 10^{3}\\, \\mathrm{N}/\\mathrm{m} $, $ \\phi_{\\mathrm{th}} = 0.01 $。\n- 案例 3 (狄利克雷，减小边界层的小内部长度): $ \\text{BC} = \\text{D} $, $ L = 0.1\\, \\mathrm{m} $, $ l = 0.001\\, \\mathrm{m} $, $ E = 70 \\times 10^{9}\\, \\mathrm{Pa} $, $ G_{c} = 2.7 \\times 10^{3}\\, \\mathrm{N}/\\mathrm{m} $, $ \\phi_{\\mathrm{th}} = 0.01 $。\n- 案例 4 (狄利克雷，加剧边界效应的大内部长度): $ \\text{BC} = \\text{D} $, $ L = 0.1\\, \\mathrm{m} $, $ l = 0.05\\, \\mathrm{m} $, $ E = 70 \\times 10^{9}\\, \\mathrm{Pa} $, $ G_{c} = 2.7 \\times 10^{3}\\, \\mathrm{N}/\\mathrm{m} $, $ \\phi_{\\mathrm{th}} = 0.01 $。\n- 案例 5 (罗宾边界条件，混合约束): $ \\text{BC} = \\text{R} $ 且 $ \\beta = 0.5 $, $ L = 0.1\\, \\mathrm{m} $, $ l = 0.01\\, \\mathrm{m} $, $ E = 70 \\times 10^{9}\\, \\mathrm{Pa} $, $ G_{c} = 2.7 \\times 10^{3}\\, \\mathrm{N}/\\mathrm{m} $, $ \\phi_{\\mathrm{th}} = 0.01 $。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个逗号分隔的列表的列表，每个内部列表为对应测试用例的 $ [r, \\varepsilon_{\\mathrm{init}}, \\sigma_{\\mathrm{init}}] $，并用方括号括起来，例如：$ [[r_{1}, \\varepsilon_{\\mathrm{init},1}, \\sigma_{\\mathrm{init},1}], [r_{2}, \\varepsilon_{\\mathrm{init},2}, \\sigma_{\\mathrm{init},2}], \\ldots] $。",
            "solution": "我们从一维弹性体中脆性断裂的标准相场公式开始。在拉压分离和小损伤线性化的情况下，总势能泛函可以写为\n$$\n\\Pi[u,\\phi] \\;=\\; \\int_{0}^{L} \\left( g(\\phi)\\, \\psi_{+}(u) + G_{c} \\left[ \\frac{ \\phi^{2} }{ 2\\, l } + \\frac{ l }{ 2 } \\left( \\phi'(x) \\right)^{2} \\right] \\right)\\, \\mathrm{d}x,\n$$\n其中 $g(\\phi)$ 是退化函数，$ \\psi_{+}(u) $ 是拉伸弹性应变能密度。对于一维小应变，\n$$\n\\varepsilon(x) = \\varepsilon_{0}, \\quad \\psi_{+}(u) = \\frac{1}{2}\\, E\\, \\varepsilon_{0}^{2}.\n$$\n在损伤开始时，当 $ \\phi \\ll 1 $，我们线性化 $ g(\\phi) \\approx 1 $，这样弹性场 $u$ 保持均匀且解耦，而断裂相场 $ \\phi $ 满足从 $ \\Pi $ 相对于 $ \\phi $ 变化的稳态性得到的欧拉-拉格朗日方程：\n$$\n\\delta \\Pi = 0 \\;\\;\\Rightarrow\\;\\; G_{c}\\, l\\, \\phi''(x) - \\frac{ G_{c} }{ l }\\, \\phi(x) = -\\, \\frac{ \\partial \\left( g(\\phi)\\,\\psi_{+} \\right) }{ \\partial \\phi } \\bigg|_{\\phi \\approx 0}.\n$$\n对于标准公式中常见的二次退化 $ g(\\phi) = (1 - \\phi)^{2} $，有 $ \\partial (g\\,\\psi_{+}) / \\partial \\phi \\big|_{\\phi=0} = - 2\\, \\psi_{+} $；这产生了受迫扩散-反应方程\n$$\nG_{c}\\, l\\, \\phi''(x) - \\frac{ G_{c} }{ l }\\, \\phi(x) = -\\, 2\\, \\psi_{+}, \\qquad \\psi_{+} = \\frac{1}{2} E \\varepsilon_{0}^{2}.\n$$\n这是一个具有常系数和常数强迫项的线性常微分方程。两边除以 $ G_{c} $，\n$$\nl\\, \\phi''(x) - \\frac{ 1 }{ l }\\, \\phi(x) = -\\, \\frac{ 2\\, \\psi_{+} }{ G_{c} }.\n$$\n通解是齐次解和一个常数特解的和。齐次解满足\n$$\nl\\, \\phi_{h}''(x) - \\frac{ 1 }{ l }\\, \\phi_{h}(x) = 0 \\;\\;\\Rightarrow\\;\\; \\phi_{h}(x) = A\\, \\cosh\\!\\left( \\frac{x}{l} \\right) + B\\, \\sinh\\!\\left( \\frac{x}{l} \\right),\n$$\n其中 $A$ 和 $B$ 是由边界条件决定的常数。一个常数特解 $ \\phi_{p} $ 满足\n$$\n- \\frac{ 1 }{ l }\\, \\phi_{p} = -\\, \\frac{ 2\\, \\psi_{+} }{ G_{c} } \\;\\;\\Rightarrow\\;\\; \\phi_{p} = \\frac{ 2\\, \\psi_{+}\\, l }{ G_{c} } = \\frac{ E\\, \\varepsilon_{0}^{2}\\, l }{ G_{c} }.\n$$\n因此，完整解是\n$$\n\\phi(x) = A\\, \\cosh\\!\\left( \\frac{x}{l} \\right) + B\\, \\sinh\\!\\left( \\frac{x}{l} \\right) + \\phi_{p}.\n$$\n\n我们现在施加边界条件来确定三种情况下的 $A$ 和 $B$：\n\n1. 狄利克雷边界条件：$ \\phi(0) = 0 $ 和 $ \\phi(L) = 0 $。在 $ x=0 $ 处计算可得\n$$\n\\phi(0) = A + \\phi_{p} = 0 \\;\\;\\Rightarrow\\;\\; A = -\\, \\phi_{p}.\n$$\n在 $ x = L $ 处，令 $ s = \\frac{L}{l} $，\n$$\n\\phi(L) = A\\, \\cosh(s) + B\\, \\sinh(s) + \\phi_{p} = 0 \\;\\;\\Rightarrow\\;\\; -\\, \\phi_{p}\\, \\cosh(s) + B\\, \\sinh(s) + \\phi_{p} = 0,\n$$\n可得\n$$\nB = \\phi_{p}\\, \\frac{ \\cosh(s) - 1 }{ \\sinh(s) }.\n$$\n在中心 $ x = \\frac{L}{2} $ 处，令 $ m = \\frac{ L }{ 2\\, l } $，比值为\n$$\nr_{\\mathrm{D}} = \\frac{ \\phi\\!\\left( \\frac{L}{2} \\right) }{ \\phi_{p} } = -\\, \\cosh(m) + \\frac{ \\cosh(s) - 1 }{ \\sinh(s) }\\, \\sinh(m) + 1.\n$$\n\n2. 诺伊曼边界条件：$ \\phi'(0) = 0 $ 和 $ \\phi'(L) = 0 $。导数为\n$$\n\\phi'(x) = \\frac{1}{l} \\left( A\\, \\sinh\\!\\left( \\frac{x}{l} \\right) + B\\, \\cosh\\!\\left( \\frac{x}{l} \\right) \\right).\n$$\n在 $ x=0 $ 处，\n$$\n\\phi'(0) = \\frac{ B }{ l } = 0 \\;\\;\\Rightarrow\\;\\; B = 0.\n$$\n在 $ x=L $ 处，\n$$\n\\phi'(L) = \\frac{1}{l} \\left( A\\, \\sinh(s) + B\\, \\cosh(s) \\right) = \\frac{ A }{ l }\\, \\sinh(s) = 0 \\;\\;\\Rightarrow\\;\\; A = 0.\n$$\n因此 $ \\phi(x) = \\phi_{p} $ 是一个常数，且\n$$\nr_{\\mathrm{N}} = \\frac{ \\phi\\!\\left( \\frac{L}{2} \\right) }{ \\phi_{p} } = 1.\n$$\n\n3. 罗宾边界条件：$ l\\, \\phi'(0) + \\beta\\, \\phi(0) = 0 $ 和 $ l\\, \\phi'(L) + \\beta\\, \\phi(L) = 0 $，其中 $ \\beta $ 是无量纲的。用 $A$ 和 $B$ 表示为，\n$$\nl\\, \\phi'(0) + \\beta\\, \\phi(0) = B + \\beta\\,(A + \\phi_{p}) = 0,\n$$\n$$\nl\\, \\phi'(L) + \\beta\\, \\phi(L) = A\\, \\sinh(s) + B\\, \\cosh(s) + \\beta \\left( A\\, \\cosh(s) + B\\, \\sinh(s) + \\phi_{p} \\right) = 0.\n$$\n为方便起见，用 $ \\phi_{p} $ 进行无量纲化，并求解 $ a = \\frac{A}{\\phi_{p}} $ 和 $ b = \\frac{B}{\\phi_{p}} $。线性系统变为\n$$\n\\begin{aligned}\n\\beta\\, a + b = -\\, \\beta, \\\\\n\\left( \\sinh(s) + \\beta\\, \\cosh(s) \\right)\\, a + \\left( \\cosh(s) + \\beta\\, \\sinh(s) \\right)\\, b = -\\, \\beta.\n\\end{aligned}\n$$\n求解这个 $ 2 \\times 2 $ 系统，可以得到给定 $ s $ 和 $ \\beta $ 下的 $ a $ 和 $ b $。中心处的比值为\n$$\nr_{\\mathrm{R}} = a\\, \\cosh(m) + b\\, \\sinh(m) + 1.\n$$\n\n计算出每种边界条件下的比值 $ r $ 后，通过要求 $ r\\, \\phi_{p} = \\phi_{\\mathrm{th}} $ 来获得实用的萌生应变和应力：\n$$\n\\varepsilon_{\\mathrm{init}} = \\sqrt{ \\frac{ \\phi_{\\mathrm{th}}\\, G_{c} }{ E\\, l\\, r } }, \\qquad \\sigma_{\\mathrm{init}} = E\\, \\varepsilon_{\\mathrm{init}}.\n$$\n\n算法设计：\n- 输入：$ L $、$ l $、$ E $、$ G_{c} $、$ \\phi_{\\mathrm{th}} $、边界条件类型，以及罗宾条件下的 $ \\beta $。\n- 计算 $ s = \\frac{ L }{ l } $ 和 $ m = \\frac{ L }{ 2\\, l } $。\n- 对于狄利克雷条件：使用以双曲函数 $ \\sinh(\\cdot) $ 和 $ \\cosh(\\cdot) $ 表示的 $ r_{\\mathrm{D}} $ 公式。\n- 对于诺伊曼条件：设 $ r_{\\mathrm{N}} = 1 $。\n- 对于罗宾条件：建立并求解关于 $ a $ 和 $ b $ 的 $ 2 \\times 2 $ 线性系统，然后计算 $ r_{\\mathrm{R}} $。\n- 使用上述公式计算 $ \\varepsilon_{\\mathrm{init}} $ 和 $ \\sigma_{\\mathrm{init}} $。\n- 为每个测试用例返回三元组 $ [r, \\varepsilon_{\\mathrm{init}}, \\sigma_{\\mathrm{init}}] $。\n\n物理解释与缓解策略：\n- 狄利克雷边界条件抑制了边界处的 $ \\phi $，产生了边界层，对于较大的 $ l/L $，这会人为地延迟中心处达到有限损伤阈值，表现为 $ r  1 $。这可能导致损伤萌生中出现边界引起的伪影。\n- 诺伊曼边界条件产生一个等于特解的均匀 $ \\phi $，即 $ r = 1 $，从而最小化了早期损伤萌生时的边界伪影。\n- 罗宾边界条件在狄利克雷和诺伊曼条件之间进行插值，并可通过 $ \\beta $ 进行调整，以减少边界抑制，同时保持对边界附近 $ \\phi $ 的控制。\n\n为了在耦合相场力学模拟中减轻边界伪影：\n- 在不应施加损伤物理约束的外部边界上，优先选择自然（诺伊曼）边界条件来处理 $ \\phi $。\n- 如果由于数值约束无法避免使用狄利克雷条件，可以使用带有校准 $ \\beta $ 的混合（罗宾）边界条件来近似 $ \\phi $ 的无牵引条件。\n- 采用区域填充或周期性边界条件，将人为边界移离感兴趣的区域。\n- 选择与材料微观结构和网格分辨率一致的内部长度 $ l $，以将边界层限制在相对于 $ L $ 的范围内。\n- 考虑具有弹性阈值的相场变体（例如，所谓的具有线性裂纹密度的 AT1 模型），以在材料适用时避免在均匀拉伸下立即成核。\n\n对于提供的测试套件，程序会计算 $ r $、$ \\varepsilon_{\\mathrm{init}} $（无量纲）和 $ \\sigma_{\\mathrm{init}} $（单位为 $ \\mathrm{Pa} $），并将它们作为单个列表的列表打印在一行上。",
            "answer": "```python\nimport numpy as np\n\ndef center_ratio(bc_type, L, l, beta=None):\n    \"\"\"\n    Compute r = phi(L/2)/phi_p for the linearized 1D phase-field ODE\n    under specified boundary conditions.\n    \"\"\"\n    s = L / l\n    m = L / (2.0 * l)\n    if bc_type == 'D':\n        # Dirichlet: phi(0)=0, phi(L)=0 implies A = -phi_p and\n        # B = phi_p * (cosh(s) - 1) / sinh(s)\n        cosh_s = np.cosh(s)\n        sinh_s = np.sinh(s)\n        cosh_m = np.cosh(m)\n        sinh_m = np.sinh(m)\n        r = -cosh_m + ((cosh_s - 1.0) / sinh_s) * sinh_m + 1.0\n        return r\n    elif bc_type == 'N':\n        # Neumann: phi'(0)=phi'(L)=0 => A=B=0, phi(x)=phi_p\n        return 1.0\n    elif bc_type == 'R':\n        if beta is None:\n            raise ValueError(\"Robin BC requires beta.\")\n        # Solve 2x2 system for a=A/phi_p and b=B/phi_p:\n        # Eq1: beta*a + b = -beta\n        # Eq2: (sinh(s)+beta*cosh(s))*a + (cosh(s)+beta*sinh(s))*b = -beta\n        sinh_s = np.sinh(s)\n        cosh_s = np.cosh(s)\n        M = np.array([[beta, 1.0],\n                      [sinh_s + beta * cosh_s, cosh_s + beta * sinh_s]], dtype=float)\n        rhs = np.array([-beta, -beta], dtype=float)\n        # Solve the linear system\n        a, b = np.linalg.solve(M, rhs)\n        cosh_m = np.cosh(m)\n        sinh_m = np.sinh(m)\n        r = a * cosh_m + b * sinh_m + 1.0\n        return r\n    else:\n        raise ValueError(\"Unknown boundary condition type.\")\n\ndef initiation_metrics(E, Gc, l, r, phi_th):\n    \"\"\"\n    Compute epsilon_init (dimensionless) and sigma_init (Pa)\n    from threshold condition r * phi_p = phi_th,\n    where phi_p = (E * epsilon^2 * l) / Gc.\n    \"\"\"\n    # epsilon_init = sqrt(phi_th * Gc / (E * l * r))\n    eps_init = np.sqrt(phi_th * Gc / (E * l * r))\n    sigma_init = E * eps_init\n    return eps_init, sigma_init\n\ndef solve():\n    # Define the test cases: (bc_type, L [m], l [m], E [Pa], Gc [N/m], phi_th [-], beta or None)\n    test_cases = [\n        ('D', 0.1, 0.01, 70e9, 2.7e3, 0.01, None),\n        ('N', 0.1, 0.01, 70e9, 2.7e3, 0.01, None),\n        ('D', 0.1, 0.001, 70e9, 2.7e3, 0.01, None),\n        ('D', 0.1, 0.05, 70e9, 2.7e3, 0.01, None),\n        ('R', 0.1, 0.01, 70e9, 2.7e3, 0.01, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        bc_type, L, l, E, Gc, phi_th, beta = case\n        r = center_ratio(bc_type, L, l, beta)\n        eps_init, sigma_init = initiation_metrics(E, Gc, l, r, phi_th)\n        results.append([float(r), float(eps_init), float(sigma_init)])\n\n    # Final print statement in the exact required format.\n    print(f\"{results}\")\n\nsolve()\n```"
        }
    ]
}