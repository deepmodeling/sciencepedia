{
    "hands_on_practices": [
        {
            "introduction": "To truly grasp the Jarzynski equality, it's invaluable to see how it emerges from first principles in simple, exactly solvable systems. This exercise guides you through the derivation for both a classical harmonic oscillator and a quantum two-level system under an instantaneous 'quench' protocol . By directly calculating the ensemble average of the exponentiated work, you will see how it relates to the ratio of the initial and final partition functions, thereby solidifying the connection between non-equilibrium work and equilibrium free energy.",
            "id": "3772099",
            "problem": "Consider two prototypical systems subjected to an instantaneous parameter quench at time $t=0$, each initially prepared in a canonical equilibrium ensemble at temperature $T$ with inverse temperature $\\beta = 1/(k_{B} T)$, where $k_{B}$ is the Boltzmann constant. In both cases, define the work $W$ performed on the system by the quench as the change in the Hamiltonian evaluated on the microstate at the instant of the quench, and define the dimensionless quantity $Q \\equiv -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle$ where $\\langle \\cdot \\rangle$ denotes the appropriate ensemble average over initial conditions and measurement outcomes. Your task is to derive analytic expressions for $Q$ from first principles, starting from the canonical ensemble and the definitions of work and Helmholtz free energy, without invoking any shortcut formulas. Report the two results as a single row matrix as $[Q_{\\mathrm{ho}},\\, Q_{\\mathrm{tls}}]$, where $Q_{\\mathrm{ho}}$ corresponds to the harmonic oscillator and $Q_{\\mathrm{tls}}$ to the two-level system. Express your final answers in terms of symbolic parameters only and do not include units in the final boxed answer.\n\nSystem A (classical harmonic oscillator): The Hamiltonian is $H(x,p;k)=\\frac{p^{2}}{2m} + \\frac{1}{2} k x^{2}$ for a particle of mass $m$, with spring constant $k$. The system is initially equilibrated with spring constant $k_{0}$ at temperature $T$. At $t=0$, the spring constant is suddenly quenched from $k_{0}$ to $k_{1}$, leaving the phase-space point $(x,p)$ unchanged at the instant of the quench. Using the canonical ensemble for the initial distribution and the instantaneous work definition, compute $Q_{\\mathrm{ho}}$.\n\nSystem B (quantum two-level system): The Hamiltonian $H(\\epsilon)$ has two energy eigenvalues $E_{0}(\\epsilon)=0$ and $E_{1}(\\epsilon)=\\epsilon$ with $\\epsilon \\ge 0$. The system is initially equilibrated at temperature $T$ with parameter $\\epsilon_{0}$. At $t=0$, $\\epsilon$ is suddenly quenched from $\\epsilon_{0}$ to $\\epsilon_{1}$. Adopt the standard projective energy measurement definition of work: measure the energy just before the quench, then immediately after the quench, with the instantaneous quench implying no change of the state during the quench. Under this protocol, the work takes the values $W=0$ if the system was in the ground state initially, and $W=\\epsilon_{1}-\\epsilon_{0}$ if it was initially in the excited state. Using the initial canonical distribution over energy eigenstates, compute $Q_{\\mathrm{tls}}$.\n\nAnswer specification:\n- Provide a single analytic expression for each $Q$ in terms of the parameters specified above.\n- Report your two answers together as a single row matrix $[Q_{\\mathrm{ho}},\\, Q_{\\mathrm{tls}}]$.\n- The final answers must be dimensionless. Do not include units in the final boxed answer.",
            "solution": "The problem requires the calculation of the dimensionless quantity $Q \\equiv -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle$ for two systems undergoing an instantaneous parameter quench. The initial state of each system is a canonical equilibrium ensemble at inverse temperature $\\beta = 1/(k_{B} T)$. The angle brackets $\\langle \\cdot \\rangle$ denote an average over the initial canonical distribution. We will perform the calculations from first principles for each system. The fundamental approach involves evaluating the ensemble average of the exponentiated work, $\\left\\langle \\exp(-\\beta W) \\right\\rangle$.\n\nFor a generic system with an initial Hamiltonian $H_0$ and a corresponding initial equilibrium probability distribution $\\rho_0$, the average of a quantity $A$ is given by $\\langle A \\rangle = \\int A \\rho_0 d\\Gamma$ in the classical case, or $\\langle A \\rangle = \\mathrm{Tr}(\\rho_0 A)$ in the quantum case, where $\\rho_0 = \\exp(-\\beta H_0)/Z_0$ and $Z_0$ is the initial partition function. The work $W$ is a function of the system's state during the non-equilibrium process.\n\nThe quantity to be calculated is $Q = -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle$. We can express the average as:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\frac{1}{Z_0} \\int \\exp(-\\beta H_0) \\exp(-\\beta W) d\\Gamma \\quad \\text{(Classical case)}\n$$\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\mathrm{Tr}\\left( \\frac{\\exp(-\\beta H_0)}{Z_0} \\exp(-\\beta \\hat{W}) \\right) \\quad \\text{(Quantum case, with work as an operator)}\n$$\nWe proceed by analyzing each system separately.\n\nFirst, consider System A, the classical harmonic oscillator.\nThe initial Hamiltonian is $H_0(x,p) = \\frac{p^{2}}{2m} + \\frac{1}{2} k_{0} x^{2}$. The system is initially in thermal equilibrium with this Hamiltonian.\nAt time $t=0$, the spring constant is quenched from $k_0$ to $k_1$. The final Hamiltonian is $H_1(x,p) = \\frac{p^{2}}{2m} + \\frac{1}{2} k_{1} x^{2}$.\nThe work $W$ performed during this instantaneous quench is the change in the Hamiltonian evaluated at the phase-space point $(x,p)$, which remains unchanged during the quench:\n$$\nW(x,p) = H_1(x,p) - H_0(x,p) = \\left(\\frac{p^{2}}{2m} + \\frac{1}{2} k_{1} x^{2}\\right) - \\left(\\frac{p^{2}}{2m} + \\frac{1}{2} k_{0} x^{2}\\right) = \\frac{1}{2}(k_1 - k_0)x^2\n$$\nThe initial state is described by the canonical probability density $\\rho_0(x,p) = \\frac{1}{Z_0} \\exp(-\\beta H_0(x,p))$, where $Z_0$ is the initial partition function. We compute the ensemble average of $\\exp(-\\beta W)$:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\rho_0(x,p) \\exp(-\\beta W(x,p)) \\,dx\\,dp\n$$\n$$\n= \\frac{1}{Z_0} \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp(-\\beta H_0(x,p)) \\exp(-\\beta [H_1(x,p) - H_0(x,p)]) \\,dx\\,dp\n$$\nThe terms involving $H_0$ in the exponent cancel:\n$$\n= \\frac{1}{Z_0} \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp(-\\beta H_1(x,p)) \\,dx\\,dp\n$$\nThe integral is, by definition, the partition function $Z_1$ corresponding to the final Hamiltonian $H_1$. Thus, we have the relation $\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\frac{Z_1}{Z_0}$.\nNow, we must calculate the partition functions $Z_0$ and $Z_1$. The classical partition function for a single particle in one dimension is given by the phase-space integral over the Boltzmann factor (we omit the Planck constant factor $1/h$ as it will cancel in the ratio):\n$$\nZ_k = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\frac{p^2}{2m}\\right) dp \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\frac{1}{2} k x^2\\right) dx\n$$\nThese are standard Gaussian integrals of the form $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\pi/a}$.\nThe momentum integral is $\\sqrt{\\frac{2m\\pi}{\\beta}}$.\nThe position integral is $\\sqrt{\\frac{2\\pi}{\\beta k}}$.\nSo, the partition function for a given spring constant $k$ is:\n$$\nZ_k = \\sqrt{\\frac{2m\\pi}{\\beta}} \\sqrt{\\frac{2\\pi}{\\beta k}} = \\frac{2\\pi\\sqrt{m}}{\\beta\\sqrt{k}}\n$$\nUsing this general form, we find $Z_0$ and $Z_1$:\n$$\nZ_0 = \\frac{2\\pi\\sqrt{m}}{\\beta\\sqrt{k_0}} \\quad \\text{and} \\quad Z_1 = \\frac{2\\pi\\sqrt{m}}{\\beta\\sqrt{k_1}}\n$$\nThe ratio is:\n$$\n\\frac{Z_1}{Z_0} = \\frac{2\\pi\\sqrt{m}/(\\beta\\sqrt{k_1})}{2\\pi\\sqrt{m}/(\\beta\\sqrt{k_0})} = \\frac{\\sqrt{k_0}}{\\sqrt{k_1}} = \\sqrt{\\frac{k_0}{k_1}}\n$$\nFinally, we compute $Q_{\\mathrm{ho}}$:\n$$\nQ_{\\mathrm{ho}} = -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle = -\\ln\\left(\\frac{Z_1}{Z_0}\\right) = -\\ln\\left(\\sqrt{\\frac{k_0}{k_1}}\\right) = \\ln\\left(\\left(\\frac{k_0}{k_1}\\right)^{-1/2}\\right) = \\ln\\left(\\left(\\frac{k_1}{k_0}\\right)^{1/2}\\right) = \\frac{1}{2} \\ln\\left(\\frac{k_1}{k_0}\\right)\n$$\nThis result can also be related to the Helmholtz free energy change, $\\Delta F = F_1 - F_0$. Since $F = -k_B T \\ln Z = - (1/\\beta) \\ln Z$ (up to constants), we have $\\beta \\Delta F = -\\ln(Z_1/Z_0) = Q_{\\mathrm{ho}}$, confirming the consistency of our calculation.\n\nNext, we consider System B, the quantum two-level system.\nThe initial Hamiltonian $H_0$ has energy eigenvalues $E_{0,0}=0$ and $E_{0,1}=\\epsilon_0$. The initial partition function is:\n$$\nZ_0 = \\sum_{n=0}^{1} \\exp(-\\beta E_{0,n}) = \\exp(0) + \\exp(-\\beta \\epsilon_0) = 1 + \\exp(-\\beta \\epsilon_0)\n$$\nThe system is initially in a thermal mixture of the two energy eigenstates. The probabilities of being in the ground state ($|\\psi_0\\rangle$) and excited state ($|\\psi_1\\rangle$) are given by the Boltzmann distribution:\n$$\nP_0 = \\frac{\\exp(-\\beta E_{0,0})}{Z_0} = \\frac{1}{Z_0} = \\frac{1}{1 + \\exp(-\\beta \\epsilon_0)}\n$$\n$$\nP_1 = \\frac{\\exp(-\\beta E_{0,1})}{Z_0} = \\frac{\\exp(-\\beta \\epsilon_0)}{Z_0} = \\frac{\\exp(-\\beta \\epsilon_0)}{1 + \\exp(-\\beta \\epsilon_0)}\n$$\nThe parameter $\\epsilon$ is quenched from $\\epsilon_0$ to $\\epsilon_1$. The work done, $W$, is provided for each initial state according to a two-measurement protocol. If the system is initially in the ground state, $W_0=0$. If the system is initially in the excited state, $W_1 = \\epsilon_1 - \\epsilon_0$. The ensemble average $\\left\\langle \\exp(-\\beta W) \\right\\rangle$ is an average over these measurement outcomes, weighted by the initial probabilities:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\sum_{i=0}^{1} P_i \\exp(-\\beta W_i) = P_0 \\exp(-\\beta W_0) + P_1 \\exp(-\\beta W_1)\n$$\nSubstituting the probabilities and work values:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\left(\\frac{1}{Z_0}\\right) \\exp(0) + \\left(\\frac{\\exp(-\\beta \\epsilon_0)}{Z_0}\\right) \\exp(-\\beta(\\epsilon_1 - \\epsilon_0))\n$$\n$$\n= \\frac{1}{Z_0} \\left[ 1 + \\exp(-\\beta \\epsilon_0) \\exp(-\\beta\\epsilon_1) \\exp(\\beta\\epsilon_0) \\right]\n$$\n$$\n= \\frac{1}{Z_0} [1 + \\exp(-\\beta \\epsilon_1)]\n$$\nThe final Hamiltonian $H_1$ has eigenvalues $E_{1,0}=0$ and $E_{1,1}=\\epsilon_1$. The corresponding partition function is $Z_1 = 1 + \\exp(-\\beta \\epsilon_1)$. Therefore, we again find the relation:\n$$\n\\left\\langle \\exp(-\\beta W) \\right\\rangle = \\frac{Z_1}{Z_0} = \\frac{1 + \\exp(-\\beta \\epsilon_1)}{1 + \\exp(-\\beta \\epsilon_0)}\n$$\nNow we can compute $Q_{\\mathrm{tls}}$:\n$$\nQ_{\\mathrm{tls}} = -\\ln \\left\\langle \\exp(-\\beta W) \\right\\rangle = -\\ln\\left(\\frac{1 + \\exp(-\\beta \\epsilon_1)}{1 + \\exp(-\\beta \\epsilon_0)}\\right) = \\ln\\left(\\left(\\frac{1 + \\exp(-\\beta \\epsilon_1)}{1 + \\exp(-\\beta \\epsilon_0)}\\right)^{-1}\\right)\n$$\n$$\nQ_{\\mathrm{tls}} = \\ln\\left(\\frac{1 + \\exp(-\\beta \\epsilon_0)}{1 + \\exp(-\\beta \\epsilon_1)}\\right)\n$$\nAs with the harmonic oscillator, this quantity is equal to $\\beta \\Delta F = \\beta(F_1 - F_0)$.\n\nThe two results for $Q_{\\mathrm{ho}}$ and $Q_{\\mathrm{tls}}$ are combined into a single row matrix as requested.\n$$\n[Q_{\\mathrm{ho}},\\, Q_{\\mathrm{tls}}] = \\begin{pmatrix} \\frac{1}{2}\\ln\\left(\\frac{k_1}{k_0}\\right)  \\ln\\left(\\frac{1 + \\exp(-\\beta \\epsilon_0)}{1 + \\exp(-\\beta \\epsilon_1)}\\right) \\end{pmatrix}\n$$\nThese expressions are dimensionless and given in terms of the specified symbolic parameters only.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2}\\ln\\left(\\frac{k_1}{k_0}\\right)  \\ln\\left(\\frac{1 + \\exp(-\\beta \\epsilon_0)}{1 + \\exp(-\\beta \\epsilon_1)}\\right)\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from theory to practice, this exercise puts you in the role of a computational scientist analyzing data from non-equilibrium pulling simulations. Given a set of work values from repeated experiments, your task is to compute the equilibrium free energy difference using the Jarzynski equality . This problem is not just about plugging numbers into a formula; it requires you to implement a numerically stable algorithm to handle the exponential average, a crucial skill for avoiding common pitfalls in real-world data analysis.",
            "id": "2391896",
            "problem": "You are given independent realizations of non-equilibrium pulling work values for unfolding a small peptide, obtained from many repetitions of a time-dependent driving protocol in Molecular Dynamics (MD). Each realization starts from an initial state sampled from the canonical ensemble at absolute temperature $T$ and proceeds under deterministic, microreversible dynamics with a prescribed schedule of a control parameter. Under these conditions, there exists an exact relation that connects a canonical-ensemble average of a function of the irreversible work to the equilibrium Helmholtz free energy difference between the initial and final control-parameter values. Your task is to use this relation to recover the reversible Helmholtz free energy change from finite samples of pulling work.\n\nFundamental bases you may assume:\n- The system is initially in the canonical ensemble at temperature $T$, so the initial phase-space density is proportional to $\\exp(-\\beta H)$, where $\\beta = 1/(k_\\mathrm{B} T)$ and $H$ is the Hamiltonian.\n- Microscopic dynamics are deterministic and preserve phase-space volume.\n- The molar form of the inverse temperature is $\\beta = 1/(R T)$ when energies are reported per mole, where $R$ is the molar gas constant.\n\nDefinitions and requirements:\n- Let $R$ denote the molar gas constant in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$. Use $R = 8.314462618\\times 10^{-3}\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$.\n- For each test case, you are given a temperature $T$ in $\\mathrm{K}$ and a list of $N$ independent work values $\\{W_i\\}_{i=1}^N$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$. Each $W_i$ is the total mechanical work performed on the system along one non-equilibrium trajectory of the driving protocol.\n- Using only the fundamental bases above, derive the appropriate estimator for the reversible Helmholtz free energy difference $\\Delta A$ from the set $\\{W_i\\}_{i=1}^N$ and $T$, then implement a numerically stable computation of this estimator that avoids floating-point overflow or underflow when evaluating exponentials. You must ensure numerical stability by transforming the computation so that very small or very large intermediate exponentials are not directly formed (for example, by shifting exponents before summation).\n- Report $\\Delta A$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, rounded to $3$ decimal places.\n\nTest suite:\nCompute $\\Delta A$ for the following five cases. All energies must be treated as molar quantities.\n- Case $1$: $T = 300.0\\ \\mathrm{K}$, $W = [12.0,\\ 13.5,\\ 11.2,\\ 14.1]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Case $2$: $T = 300.0\\ \\mathrm{K}$, $W = [5.0,\\ 5.0,\\ 5.0]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Case $3$: $T = 350.0\\ \\mathrm{K}$, $W = [20.0,\\ 30.0,\\ 15.0,\\ 25.0,\\ 40.0,\\ 10.0]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Case $4$: $T = 100.0\\ \\mathrm{K}$, $W = [2.0,\\ 3.0,\\ 4.0,\\ 5.0]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Case $5$: $T = 300.0\\ \\mathrm{K}$, $W = [18.0,\\ 19.0,\\ 17.0,\\ 5.0]\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain the five $\\Delta A$ values, in the order of Cases $1$ through $5$, each rounded to $3$ decimal places and expressed in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$. For example, an output line matching the required format has the form $[\\Delta A_1,\\Delta A_2,\\Delta A_3,\\Delta A_4,\\Delta A_5]$, where each $\\Delta A_i$ is a floating-point number rounded to $3$ decimal places.",
            "solution": "The problem requires the derivation and implementation of an estimator for the equilibrium Helmholtz free energy difference, $\\Delta A$, from a finite set of non-equilibrium work measurements $\\{W_i\\}$. The provided physical basis—an initial canonical ensemble and deterministic, volume-preserving dynamics—is the precise foundation for the Jarzynski equality, which is the exact relation mentioned in the problem statement.\n\nWe begin by stating this fundamental relation. The Jarzynski equality connects the work, $W$, performed on a system during a non-equilibrium process to the free energy difference, $\\Delta A$, between the equilibrium states corresponding to the initial and final values of the control parameter. The equality is given by:\n$$\n\\langle e^{-\\beta W} \\rangle = e^{-\\beta \\Delta A}\n$$\nHere, $\\beta$ is the inverse temperature. For molar energies, as specified, it is $\\beta = 1/(R T)$, where $R$ is the molar gas constant and $T$ is the absolute temperature. The angle brackets $\\langle \\dots \\rangle$ denote an average over an infinite ensemble of trajectories, where each trajectory starts from a configuration drawn from the canonical equilibrium distribution of the initial state.\n\nTo find $\\Delta A$, we take the natural logarithm of both sides of the Jarzynski equality:\n$$\n\\ln(\\langle e^{-\\beta W} \\rangle) = -\\beta \\Delta A\n$$\nSolving for $\\Delta A$ yields:\n$$\n\\Delta A = -\\frac{1}{\\beta} \\ln(\\langle e^{-\\beta W} \\rangle)\n$$\nIn any practical application, such as a computational experiment, we have access to only a finite sample of $N$ independent work values, $\\{W_i\\}_{i=1}^N$. The ensemble average $\\langle e^{-\\beta W} \\rangle$ must therefore be estimated by a sample mean:\n$$\n\\langle e^{-\\beta W} \\rangle \\approx \\frac{1}{N} \\sum_{i=1}^N e^{-\\beta W_i}\n$$\nSubstituting this sample average into the expression for $\\Delta A$ gives the practical estimator for the free energy difference from a finite data set:\n$$\n\\Delta A \\approx -\\frac{1}{\\beta} \\ln\\left(\\frac{1}{N} \\sum_{i=1}^N e^{-\\beta W_i}\\right)\n$$\nUsing $\\beta = 1/(R T)$, the final expression for the estimator in terms of the given quantities is:\n$$\n\\Delta A = -R T \\ln\\left(\\frac{1}{N} \\sum_{i=1}^N e^{-W_i / (R T)}\\right)\n$$\n\nThe next critical task is to ensure the numerical stability of this computation. The calculation involves a sum of exponentials, $\\sum_i e^{-W_i / (R T)}$. If the arguments $-W_i / (R T)$ are large and positive, their exponentiation can result in floating-point overflow. Conversely, large negative arguments lead to underflow, which is less catastrophic but can still lead to loss of precision. To prevent this, we employ a standard algebraic manipulation often called the log-sum-exp trick.\n\nLet $x_i = -W_i / (R T)$. We wish to compute $\\ln\\left(\\sum_i e^{x_i}\\right)$ robustly. Let $x_{\\max} = \\max_i\\{x_i\\}$. We can factor out $e^{x_{\\max}}$ from the sum:\n$$\n\\sum_{i=1}^N e^{x_i} = \\sum_{i=1}^N e^{x_i - x_{\\max} + x_{\\max}} = e^{x_{\\max}} \\sum_{i=1}^N e^{x_i - x_{\\max}}\n$$\nThe logarithm of the sum then becomes:\n$$\n\\ln\\left(\\sum_{i=1}^N e^{x_i}\\right) = \\ln\\left(e^{x_{\\max}} \\sum_{i=1}^N e^{x_i - x_{\\max}}\\right) = x_{\\max} + \\ln\\left(\\sum_{i=1}^N e^{x_i - x_{\\max}}\\right)\n$$\nIn our context, $x_{\\max} = \\max_i\\{-W_i / (R T)\\} = -(\\min_i\\{W_i\\}) / (R T) = -W_{\\min} / (R T)$, where $W_{\\min}$ is the minimum work value in the sample. The exponents in the new sum are $(x_i - x_{\\max}) = -(W_i - W_{\\min})/(R T)$. Since $W_i \\ge W_{\\min}$ for all $i$, these exponents are all non-positive. The largest value in the sum is $e^0 = 1$, which completely avoids overflow.\n\nSubstituting this stabilized form into our estimator for $\\Delta A$:\n$$\n\\Delta A = -R T \\left[ \\ln\\left(\\frac{1}{N}\\right) + \\ln\\left(\\sum_{i=1}^N e^{-W_i / (R T)}\\right) \\right]\n$$\n$$\n\\Delta A = -R T \\left[ -\\ln(N) + \\left( -\\frac{W_{\\min}}{R T} + \\ln\\left(\\sum_{i=1}^N e^{-(W_i - W_{\\min})/(RT)}\\right) \\right) \\right]\n$$\nSimplifying this expression gives the final, numerically stable formula for implementation:\n$$\n\\Delta A = R T \\ln(N) + W_{\\min} - R T \\ln\\left(\\sum_{i=1}^N e^{-(W_i - W_{\\min})/(RT)}\\right)\n$$\nOr, more compactly:\n$$\n\\Delta A = W_{\\min} - R T \\left[ \\ln\\left(\\sum_{i=1}^N e^{-(W_i - W_{\\min})/(RT)}\\right) - \\ln(N) \\right]\n$$\nThis is the algorithm to be implemented. For each test case, we will compute the inverse molar thermal energy $1/(RT)$, find the number of samples $N$ and the minimum work $W_{\\min}$, calculate the sum of shifted exponentials, and combine these terms as shown above to find $\\Delta A$. The result must be reported in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ rounded to $3$ decimal places.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the Helmholtz free energy difference Delta A from non-equilibrium\n    work measurements using the Jarzynski equality, with numerical stabilization.\n    \"\"\"\n    \n    # Define the molar gas constant in kJ mol^-1 K^-1\n    R = 8.314462618e-3\n\n    test_cases = [\n        {'T': 300.0, 'W': [12.0, 13.5, 11.2, 14.1]},\n        {'T': 300.0, 'W': [5.0, 5.0, 5.0]},\n        {'T': 350.0, 'W': [20.0, 30.0, 15.0, 25.0, 40.0, 10.0]},\n        {'T': 100.0, 'W': [2.0, 3.0, 4.0, 5.0]},\n        {'T': 300.0, 'W': [18.0, 19.0, 17.0, 5.0]}\n    ]\n\n    def calculate_delta_a(T, W_values, R_const):\n        \"\"\"\n        Computes Delta A for a single test case using a numerically stable formula.\n\n        Args:\n            T (float): Absolute temperature in Kelvin.\n            W_values (list of float): List of work values in kJ/mol.\n            R_const (float): Molar gas constant in kJ mol^-1 K^-1.\n\n        Returns:\n            float: The calculated Helmholtz free energy difference Delta A.\n        \"\"\"\n        N = len(W_values)\n        if N == 0:\n            return 0.0 # Or handle as an error case\n\n        # Convert to numpy array for efficient operations\n        W = np.array(W_values)\n        \n        RT = R_const * T\n        \n        # If all work values are identical, Delta A is simply that work value.\n        # This also avoids potential log(0) if N=1.\n        if np.all(W == W[0]):\n            return W[0]\n\n        # Find the minimum work value for the shifting factor\n        W_min = np.min(W)\n        \n        # Calculate shifted, unitless exponents: -(W_i - W_min) / (RT)\n        # The exponents are guaranteed to be = 0, preventing overflow.\n        shifted_exponents = -(W - W_min) / RT\n        \n        # Calculate the sum of exponentials\n        sum_of_exponentials = np.sum(np.exp(shifted_exponents))\n        \n        # Calculate Delta A using the numerically stable formula:\n        # Delta_A = W_min - RT * [ln(sum(exp(-(W_i-W_min)/RT))) - ln(N)]\n        log_term = np.log(sum_of_exponentials) - np.log(N)\n        delta_A = W_min - RT * log_term\n        \n        return delta_A\n\n    results = []\n    for case in test_cases:\n        T = case['T']\n        W = case['W']\n        delta_A = calculate_delta_a(T, W, R)\n        results.append(delta_A)\n    \n    # Format results to 3 decimal places and create the final output string\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The Jarzynski equality is a statement about an ensemble average, which can be counter-intuitive. It is common to see single events where the work performed, $W$, is less than the free energy change, $\\Delta F$, which might seem to violate the second law. This practice challenges you to dissect a hypothetical claim of such a violation and identify the fundamental misunderstandings at its core . Engaging with this thought experiment will sharpen your understanding of the statistical nature of work, the meaning of ensemble averages, and the correct interpretation of the second law in the microscopic realm.",
            "id": "2462968",
            "problem": "A research group studying an RNA hairpin uses an optical-tweezers pulling protocol to estimate the equilibrium folding free energy difference $\\Delta F$ at temperature $T$. They cite the Jarzynski equality (JE), which states\n$$\\left\\langle e^{-\\beta W}\\right\\rangle = e^{-\\beta \\Delta F},$$\nwith $\\beta = \\left(k_{\\mathrm{B}} T\\right)^{-1}$ and $W$ the work performed during the non-equilibrium pulling process. In a single realization of the pulling protocol, they measure a work value $W$ that is less than an independently reported equilibrium estimate of $\\Delta F$. They then claim a violation of the second law of thermodynamics by invoking what they call a “non-average form” of JE, namely $e^{-\\beta W} = e^{-\\beta \\Delta F}$ for each trajectory, which they interpret as $W = \\Delta F$ holding trajectory-by-trajectory. Based on first principles, which critiques correctly explain why their claim is unfounded? Choose all that apply.\n\nA. The Jarzynski equality requires an ensemble average $\\langle \\cdot \\rangle$ over many repetitions that start from canonical equilibrium and follow the same protocol; applying $e^{-\\beta W} = e^{-\\beta \\Delta F}$ to a single trajectory is not a valid use of JE, so the observed $W  \\Delta F$ does not imply any violation.\n\nB. The relevant statement of the second law of thermodynamics in this context is $\\langle W \\rangle \\ge \\Delta F$, not $W \\ge \\Delta F$ for each realization; therefore a single trial with $W  \\Delta F$ can occur due to fluctuations without violating thermodynamics.\n\nC. Work $W$ is a path-dependent quantity that depends on the pulling protocol, whereas the free energy difference $\\Delta F$ is a state function; any claim that $W$ must equal $\\Delta F$ trajectory-by-trajectory contradicts this fundamental distinction.\n\nD. The Crooks fluctuation theorem guarantees that a single forward trajectory together with a single time-reversed trajectory suffices to determine $\\Delta F$ exactly; therefore the single-trial observation decisively supports a violation.\n\nE. Replacing $e^{-\\beta W}$ by its linear approximation $1 - \\beta W$ for small $W$ is justified and leads to $W = \\Delta F$ for each realization; thus the violation is real in the small-work limit.",
            "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- System under study: an RNA hairpin.\n- Experimental technique: optical-tweezers pulling protocol.\n- Quantity to be estimated: equilibrium folding free energy difference, $\\Delta F$.\n- Temperature: $T$.\n- Physical law cited: The Jarzynski equality (JE), given as $\\left\\langle e^{-\\beta W}\\right\\rangle = e^{-\\beta \\Delta F}$.\n- Definition of $\\beta$: $\\beta = \\left(k_{\\mathrm{B}} T\\right)^{-1}$.\n- Definition of $W$: work performed during the non-equilibrium pulling process.\n- Experimental observation: A single realization of the protocol yields a work value $W$ such that $W  \\Delta F$, where $\\Delta F$ is a previously known value.\n- Claim made: This observation constitutes a violation of the second law of thermodynamics.\n- Justification for the claim: An assumed \"non-average form\" of JE, $e^{-\\beta W} = e^{-\\beta \\Delta F}$, which is interpreted as $W = \\Delta F$ for every single trajectory.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is set in the context of single-molecule biophysics and non-equilibrium statistical mechanics, which are established scientific fields. The Jarzynski equality is a fundamental theorem in this area. The experimental setup (optical tweezers on RNA) is standard. The scenario described—observing work fluctuations where a single work measurement is less than the free energy difference—is a known and expected phenomenon. The claim made by the hypothetical research group is scientifically incorrect, but the problem asks to critique this specific incorrect claim. Therefore, the premise of the problem is scientifically sound as a test of understanding.\n- **Well-Posed**: The question is unambiguous. It asks for the correct scientific critiques of a flawed argument. A unique set of correct critiques exists among the options.\n- **Objective**: The problem describes a hypothetical scenario and a flawed conclusion in objective terms. It does not contain subjective or opinion-based statements.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. It presents a clear, scientifically grounded scenario and poses a well-defined question about fundamental principles of statistical mechanics. The solution process may proceed.\n\nThe claim made by the research group is fundamentally flawed and stems from a misunderstanding of the Jarzynski equality and its relationship to the second law of thermodynamics. Let us analyze this from first principles.\n\nThe Jarzynski equality is given by:\n$$\n\\left\\langle e^{-\\beta W}\\right\\rangle = e^{-\\beta \\Delta F}\n$$\nHere, the crucial element is the ensemble average, denoted by the angle brackets $\\langle \\cdot \\rangle$. This average is taken over an infinite number of experiments, each starting from a system in thermal equilibrium with a heat bath at temperature $T$, and each subjected to the exact same non-equilibrium work protocol. The work $W$ is a stochastic variable; its value will fluctuate from one realization of the experiment to the next. The equality relates the exponential average of this fluctuating work to the exponential of a thermodynamic state function, the free energy difference $\\Delta F$.\n\nThe assertion that $e^{-\\beta W} = e^{-\\beta \\Delta F}$ for each trajectory is a gross misinterpretation. This would imply $W = \\Delta F$ for every single realization, which is only true in the idealized limit of a quasi-static (infinitely slow, reversible) process. For any finite-time, non-equilibrium process, there will be dissipation, and the work $W$ will be distributed according to some probability distribution $P(W)$.\n\nA direct consequence of the Jarzynski equality is the second law of thermodynamics for such processes. We use Jensen's inequality, which states that for any convex function $\\phi(x)$, $\\langle \\phi(x) \\rangle \\ge \\phi(\\langle x \\rangle)$. The exponential function $\\phi(x) = e^x$ is convex. Applying this to the Jarzynski equality with the variable $-\\beta W$:\n$$\n\\left\\langle e^{-\\beta W}\\right\\rangle \\ge e^{\\langle -\\beta W \\rangle}\n$$\nUsing the Jarzynski equality on the left side and the linearity of the average on the right side:\n$$\ne^{-\\beta \\Delta F} \\ge e^{-\\beta \\langle W \\rangle}\n$$\nBecause the exponential function is monotonically increasing, we can take the natural logarithm of both sides without changing the direction of the inequality:\n$$\n-\\beta \\Delta F \\ge -\\beta \\langle W \\rangle\n$$\nMultiplying by $-1$ and recalling that $\\beta = (k_{\\mathrm{B}} T)^{-1}  0$, we must reverse the inequality sign:\n$$\n\\Delta F \\le \\langle W \\rangle \\quad \\text{or} \\quad \\langle W \\rangle \\ge \\Delta F\n$$\nThis is the correct statement of the second law in this context. It states that the *average* work done on the system must be greater than or equal to the free energy difference. It does *not* constrain the work $W$ of a single trajectory. In fact, for the Jarzynski equality to hold, there *must* be trajectories for which $W  \\Delta F$. If $W \\ge \\Delta F$ were true for all trajectories, then $e^{-\\beta W} \\le e^{-\\beta \\Delta F}$ for all $W$. Averaging would give $\\langle e^{-\\beta W} \\rangle \\le e^{-\\beta \\Delta F}$, where the equality could only hold if all trajectories were non-dissipative ($W = \\Delta F$), which is the reversible limit. For any irreversible process, we would find $\\langle e^{-\\beta W} \\rangle  e^{-\\beta \\Delta F}$, which violates the Jarzynski equality. Thus, observing $W  \\Delta F$ is not a violation of the second law; it is a necessary feature of the statistical nature of work in small systems.\n\nNow we evaluate each option.\n\n**A. The Jarzynski equality requires an ensemble average $\\langle \\cdot \\rangle$ over many repetitions that start from canonical equilibrium and follow the same protocol; applying $e^{-\\beta W} = e^{-\\beta \\Delta F}$ to a single trajectory is not a valid use of JE, so the observed $W  \\Delta F$ does not imply any violation.**\nThis statement is a precise and accurate description of the requirements for applying the Jarzynski equality. It correctly identifies the central error in the researchers' reasoning: confusing an ensemble average with a single-trajectory value. It correctly concludes that this misapplication invalidates their claim of a thermodynamic violation.\n**Verdict: Correct**\n\n**B. The relevant statement of the second law of thermodynamics in this context is $\\langle W \\rangle \\ge \\Delta F$, not $W \\ge \\Delta F$ for each realization; therefore a single trial with $W  \\Delta F$ can occur due to fluctuations without violating thermodynamics.**\nThis statement correctly formulates the second law inequality as derived from the Jarzynski equality. It highlights the distinction between the constraint on the average work $\\langle W \\rangle$ and the fluctuating nature of the single-trajectory work $W$. It correctly attributes the observation of $W  \\Delta F$ to statistical fluctuations and concludes, rightly, that this is not a violation of thermodynamics.\n**Verdict: Correct**\n\n**C. Work $W$ is a path-dependent quantity that depends on the pulling protocol, whereas the free energy difference $\\Delta F$ is a state function; any claim that $W$ must equal $\\Delta F$ trajectory-by-trajectory contradicts this fundamental distinction.**\nThis critique is based on fundamental definitions in thermodynamics. Work is defined by the process path taken between two states. Free energy is a state function, meaning its change depends only on the initial and final states, not the path between them. The researchers' fallacious assumption that $W = \\Delta F$ for every path would wrongly imply that work is a state function. This is a basic conceptual error.\n**Verdict: Correct**\n\n**D. The Crooks fluctuation theorem guarantees that a single forward trajectory together with a single time-reversed trajectory suffices to determine $\\Delta F$ exactly; therefore the single-trial observation decisively supports a violation.**\nThis statement completely misrepresents the Crooks fluctuation theorem. The theorem relates the entire probability distribution of work for a forward process, $P_F(W)$, to that of the time-reversed process, $P_R(W')$: $P_F(W)/P_R(-W) = \\exp[\\beta(W - \\Delta F)]$. One cannot determine $\\Delta F$ \"exactly\" from just two work values, one from a forward and one from a reverse trajectory. Such an estimate would be subject to enormous statistical noise. The theorem requires sampling the distributions, which means many trajectories. The conclusion drawn is therefore baseless.\n**Verdict: Incorrect**\n\n**E. Replacing $e^{-\\beta W}$ by its linear approximation $1 - \\beta W$ for small $W$ is justified and leads to $W = \\Delta F$ for each realization; thus the violation is real in the small-work limit.**\nThis argument is mathematically flawed. The approximation is applied inside the ensemble average: $\\langle e^{-\\beta W} \\rangle \\approx \\langle 1 - \\beta W \\rangle = 1 - \\beta \\langle W \\rangle$. The Jarzynski equality then becomes $1 - \\beta \\langle W \\rangle \\approx e^{-\\beta \\Delta F}$. If we also approximate the right-hand side, $1 - \\beta \\langle W \\rangle \\approx 1 - \\beta \\Delta F$, which simplifies to $\\langle W \\rangle \\approx \\Delta F$. The approximation leads to a statement about the *average* work, not the work of \"each realization\". The claim that the approximation leads to $W = \\Delta F$ per trajectory is false, and therefore the conclusion is unsupported.\n**Verdict: Incorrect**",
            "answer": "$$\\boxed{ABC}$$"
        }
    ]
}