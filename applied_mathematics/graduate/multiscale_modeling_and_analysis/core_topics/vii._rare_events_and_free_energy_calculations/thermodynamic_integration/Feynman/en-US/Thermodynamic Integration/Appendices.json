{
    "hands_on_practices": [
        {
            "introduction": "This first exercise provides a foundational understanding of Thermodynamic Integration (TI) by applying it to a simple, idealized system. By analytically calculating the free energy change for a particle in a harmonic potential, you will see exactly how the TI formula connects a path integral to the principles of statistical mechanics without the complexities of a full simulation. This practice solidifies the core concepts in a perfectly tractable model .",
            "id": "2465950",
            "problem": "A single classical particle of mass $m$ moves in one spatial dimension and is held in a harmonic potential. In state $A$, the potential is $U_{A}(x) = \\frac{1}{2} k_{A} x^{2}$, and in state $B$, the potential is $U_{B}(x) = \\frac{1}{2} k_{B} x^{2}$, where $k_{A} > 0$ and $k_{B} > 0$ are the force constants. The system is at absolute temperature $T$ in the canonical ensemble. Define an alchemical coupling parameter $\\lambda \\in [0,1]$ and a path of potentials $U_{\\lambda}(x) = (1-\\lambda) U_{A}(x) + \\lambda U_{B}(x)$. Using Thermodynamic Integration (TI), determine the exact analytic expression for the Helmholtz free energy difference $\\Delta F_{A \\to B} = F_{B} - F_{A}$. Assume classical statistics and note that kinetic contributions are identical in states $A$ and $B$ and thus cancel in the free energy difference. Express your final answer symbolically in terms of $k_{A}$, $k_{B}$, the Boltzmann constant $k_{\\mathrm{B}}$, and $T$ as a single closed-form expression.",
            "solution": "The system is classical and in the canonical ensemble at temperature $T$. The Helmholtz free energy is defined by $F = - k_{\\mathrm{B}} T \\ln Z$, where $Z$ is the partition function. In Thermodynamic Integration (TI), one introduces a coupling parameter $\\lambda \\in [0,1]$ that continuously transforms the potential from $U_{A}$ to $U_{B}$ via $U_{\\lambda}(x) = (1-\\lambda) U_{A}(x) + \\lambda U_{B}(x)$. The fundamental TI relation in the canonical ensemble is\n$$\n\\Delta F_{A \\to B} \\equiv F_{B} - F_{A} = \\int_{0}^{1} \\left\\langle \\frac{\\partial U_{\\lambda}}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\, d\\lambda,\n$$\nwhere $\\langle \\cdot \\rangle_{\\lambda}$ denotes an ensemble average with respect to the canonical distribution corresponding to $U_{\\lambda}$.\n\nFor the given path,\n$$\nU_{\\lambda}(x) = \\frac{1}{2}\\left[(1-\\lambda)k_{A} + \\lambda k_{B}\\right] x^{2} \\equiv \\frac{1}{2} k(\\lambda) x^{2},\n$$\nwhere $k(\\lambda) = (1-\\lambda)k_{A} + \\lambda k_{B}$. Differentiating $U_{\\lambda}$ with respect to $\\lambda$ yields\n$$\n\\frac{\\partial U_{\\lambda}}{\\partial \\lambda} = \\frac{1}{2}\\left(k_{B} - k_{A}\\right) x^{2}.\n$$\nTherefore, the TI integrand is\n$$\n\\left\\langle \\frac{\\partial U_{\\lambda}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\frac{1}{2}\\left(k_{B} - k_{A}\\right) \\langle x^{2} \\rangle_{\\lambda}.\n$$\n\nWe now compute $\\langle x^{2} \\rangle_{\\lambda}$ for a one-dimensional harmonic potential with force constant $k(\\lambda)$. In the canonical ensemble,\n$$\n\\langle x^{2} \\rangle_{\\lambda} = \\frac{\\int_{-\\infty}^{\\infty} x^{2} \\exp\\!\\left[-\\beta \\frac{1}{2} k(\\lambda) x^{2}\\right] dx}{\\int_{-\\infty}^{\\infty} \\exp\\!\\left[-\\beta \\frac{1}{2} k(\\lambda) x^{2}\\right] dx},\n$$\nwith $\\beta = \\frac{1}{k_{\\mathrm{B}} T}$. Both numerator and denominator are Gaussian integrals. Using the standard result for such moments, one finds\n$$\n\\langle x^{2} \\rangle_{\\lambda} = \\frac{1}{\\beta k(\\lambda)} = \\frac{k_{\\mathrm{B}} T}{k(\\lambda)}.\n$$\nHence,\n$$\n\\left\\langle \\frac{\\partial U_{\\lambda}}{\\partial \\lambda} \\right\\rangle_{\\lambda} = \\frac{1}{2}\\left(k_{B} - k_{A}\\right) \\frac{k_{\\mathrm{B}} T}{k(\\lambda)}.\n$$\n\nSubstituting into the TI integral gives\n$$\n\\Delta F_{A \\to B} = \\int_{0}^{1} \\frac{1}{2}\\left(k_{B} - k_{A}\\right) \\frac{k_{\\mathrm{B}} T}{(1-\\lambda)k_{A} + \\lambda k_{B}} \\, d\\lambda.\n$$\nThis integral is elementary. Let $a = k_{A}$ and $b = k_{B}$. Then\n$$\n\\Delta F_{A \\to B} = \\frac{1}{2} k_{\\mathrm{B}} T (b - a) \\int_{0}^{1} \\frac{d\\lambda}{a + \\lambda (b - a)}.\n$$\nEvaluating the integral,\n$$\n\\int_{0}^{1} \\frac{d\\lambda}{a + \\lambda (b - a)} = \\frac{1}{b - a} \\left[ \\ln\\!\\left(a + \\lambda (b - a)\\right) \\right]_{0}^{1} = \\frac{1}{b - a} \\left( \\ln b - \\ln a \\right).\n$$\nTherefore,\n$$\n\\Delta F_{A \\to B} = \\frac{1}{2} k_{\\mathrm{B}} T \\left( \\ln b - \\ln a \\right) = \\frac{1}{2} k_{\\mathrm{B}} T \\ln\\!\\left(\\frac{k_{B}}{k_{A}}\\right).\n$$\n\nThis expression is the exact classical configurational free energy difference between the two one-dimensional harmonic states along the specified linear coupling path and is consistent with a direct partition-function calculation, noting that kinetic contributions cancel in the difference.",
            "answer": "$$\\boxed{\\frac{1}{2}\\,k_{\\mathrm{B}}\\,T\\,\\ln\\!\\left(\\frac{k_{B}}{k_{A}}\\right)}$$"
        },
        {
            "introduction": "Moving from an analytical model to a more realistic scenario, this practice simulates the final step of a TI calculation where you are given pre-computed data. You will use the fundamental TI equation to process a set of ensemble averages, $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$, obtained from a hypothetical molecular dynamics simulation. This exercise focuses on the practical application of numerical quadrature to approximate the free energy integral and provides insight into the nature of discretization error .",
            "id": "3867550",
            "problem": "In an alchemical free-energy calculation relevant to computational chemical biology, a ligand is transformed into a reference state by coupling it to a parameter $\\lambda \\in [0,1]$ at constant temperature $T$. The system is simulated in the canonical ensemble. At each discrete value of $\\lambda$, the ensemble average of the generalized force $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$ is estimated from sufficiently long equilibrium molecular dynamics, where $U(\\mathbf{x};\\lambda)$ is the potential energy of configuration $\\mathbf{x}$ at coupling parameter $\\lambda$. The following values (assumed to be statistically converged for the purposes of this exercise) are obtained on an evenly spaced grid:\n- $\\lambda = 0.0$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.000\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.1$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.229\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.2$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.512\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.3$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 1.843\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.4$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 2.216\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.5$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 2.625\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.6$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 3.064\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.7$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 3.527\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.8$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 4.008\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 0.9$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 4.501\\ \\mathrm{kJ\\,mol^{-1}}$\n- $\\lambda = 1.0$: $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda} = 5.000\\ \\mathrm{kJ\\,mol^{-1}}$\n\nUsing only foundational definitions of equilibrium statistical mechanics and numerical quadrature, derive the expression connecting the Helmholtz free energy difference $\\Delta F$ to the provided generalized force data, and then compute an approximate $\\Delta F$ over $\\lambda \\in [0,1]$ using a suitable composite Newton–Cotes rule for the evenly spaced grid. In your computation, show the explicit quadrature weights you use. Finally, briefly discuss qualitatively how the discretization error would scale with the grid spacing for the quadrature you chose, and what features of the underlying $\\lambda$-dependence of $\\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$ control this error.\n\nExpress the final numerical value of $\\Delta F$ in $\\mathrm{kJ\\,mol^{-1}}$, and round your answer to four significant figures.",
            "solution": "The Helmholtz free energy difference $\\Delta F$ is given by the fundamental thermodynamic integration (TI) formula, which connects the change in free energy to the integral of an ensemble-averaged generalized force along a path parameterized by $\\lambda$:\n$$\n\\Delta F = \\int_0^1 \\left\\langle \\frac{\\partial U}{\\partial \\lambda} \\right\\rangle_{\\lambda} \\,d\\lambda\n$$\nThis relationship is derived from the statistical mechanical definition of free energy, $F(\\lambda) = -k_B T \\ln Z(\\lambda)$, by differentiating with respect to $\\lambda$ and recognizing that the result is the ensemble average of $\\partial U / \\partial \\lambda$.\n\nTo compute the value of this integral from the provided discrete data, we can use a numerical quadrature rule. Since the data points for the integrand, $g(\\lambda) = \\langle \\partial U / \\partial \\lambda \\rangle_{\\lambda}$, are provided on an evenly spaced grid of 11 points (i.e., $n=10$ intervals), the composite Simpson's rule is an appropriate and high-accuracy method. The formula is:\n$$\n\\int_a^b g(\\lambda) \\,d\\lambda \\approx \\frac{h}{3} \\left[ g(\\lambda_0) + 4g(\\lambda_1) + 2g(\\lambda_2) + \\dots + 2g(\\lambda_{n-2}) + 4g(\\lambda_{n-1}) + g(\\lambda_n) \\right]\n$$\nHere, the integration interval is $[0, 1]$, the number of intervals is $n=10$, and the grid spacing is $h = (1-0)/10 = 0.1$. The quadrature weights for the data points $g_i = g(\\lambda_i)$ are given by the pattern $(h/3) \\times \\{1, 4, 2, 4, 2, 4, 2, 4, 2, 4, 1\\}$.\n\nLet's apply this to the data (in units of $\\mathrm{kJ\\,mol^{-1}}$):\n$g_0=1.000, g_1=1.229, g_2=1.512, g_3=1.843, g_4=2.216, g_5=2.625, g_6=3.064, g_7=3.527, g_8=4.008, g_9=4.501, g_{10}=5.000$.\n\n$\\Delta F \\approx \\frac{0.1}{3} [1.000 + 4(1.229) + 2(1.512) + 4(1.843) + 2(2.216) + 4(2.625) + 2(3.064) + 4(3.527) + 2(4.008) + 4(4.501) + 5.000]$\n$\\Delta F \\approx \\frac{0.1}{3} [1.000 + 4.916 + 3.024 + 7.372 + 4.432 + 10.500 + 6.128 + 14.108 + 8.016 + 18.004 + 5.000]$\n$\\Delta F \\approx \\frac{0.1}{3} [82.500]$\n$\\Delta F = 2.750 \\, \\mathrm{kJ\\,mol^{-1}}$\n\nRegarding the discretization error, the error of the composite Simpson's rule scales as $O(h^4)$ and depends on the fourth derivative of the integrand. A smoother integrand (smaller fourth derivative) leads to a smaller error. In this specific case, the provided data points are perfectly described by the cubic polynomial $g(\\lambda) = -\\lambda^3 + 3\\lambda^2 + 2\\lambda + 1$. Since the fourth derivative of a cubic polynomial is zero, Simpson's rule is exact for this function. Therefore, the calculated value of $2.750 \\, \\mathrm{kJ\\,mol^{-1}}$ is not an approximation but the exact integral of the function that generated the data.",
            "answer": "$$\\boxed{2.750}$$"
        },
        {
            "introduction": "This final practice bridges theory and real-world application by challenging you to design an efficient and robust alchemical free energy calculation. You will strategize how to decouple a ligand from its solvent, considering critical practical issues like simulation stability, pathway staging, and optimal allocation of computational resources. This exercise synthesizes your understanding of TI to address the complex trade-offs faced in modern computational chemistry .",
            "id": "3867509",
            "problem": "You are computing the absolute hydration free energy of a small neutral polar ligand in liquid water via an alchemical pathway using Thermodynamic Integration (TI). You will carry out the decoupling in two conceptual parts: first remove electrostatics by scaling the charges (decharging), then remove the van der Waals (nonbonded Lennard–Jones) interactions (van der Waals decoupling). The system is a solvated ligand in a cubic box of water under isothermal–isobaric conditions at $300\\,\\text{K}$ and $1\\,\\text{bar}$, using Particle Mesh Ewald (PME) for long-range electrostatics and a standard molecular dynamics integrator. The goal is to design a staged schedule for the coupling parameter $\\lambda$ for each part and to justify how to allocate sampling effort across the schedule to minimize the statistical uncertainty of the TI integral at fixed total simulation time.\n\nAs the context-appropriate fundamental base, recall the definition of the TI free energy difference between two states with potential energy function $U(\\lambda)$,\n$$\n\\Delta G \\;=\\; \\int_{0}^{1} \\left\\langle \\frac{\\partial U(\\lambda)}{\\partial \\lambda} \\right\\rangle_\\lambda \\, d\\lambda,\n$$\nwhere $\\langle \\cdot \\rangle_\\lambda$ denotes an equilibrium ensemble average at fixed $\\lambda$. In practice, you will discretize $\\lambda$ into windows $\\{\\lambda_i\\}$, estimate $\\left\\langle \\frac{\\partial U}{\\partial \\lambda}\\right\\rangle_{\\lambda_i}$ at each window by sampling, and apply a quadrature rule to approximate the integral. The sampling uncertainty at each window depends on the variance of $\\frac{\\partial U}{\\partial \\lambda}$ and on the amount of simulation time devoted to that window. It is known empirically and theoretically that removing electrostatics by scaling charges tends to yield a near-linear integrand in $\\lambda$ for small polar solutes in water (linear-response regime), whereas removing van der Waals interactions can produce pronounced curvature and large fluctuations unless a soft-core treatment is used to regularize the short-range repulsion; without soft-core, endpoint catastrophes can arise when atoms overlap upon decoupling.\n\nWhich option below presents a scientifically sound staged $\\lambda$ schedule and sampling-effort allocation across stages that is consistent with the above first principles and with known behavior of the TI integrand for decharging versus van der Waals decoupling?\n\nA. Use two stages in the order: decharge first, then van der Waals decoupling. For decharging, scale ligand partial charges as $q(\\lambda_{\\mathrm{C}}) = (1-\\lambda_{\\mathrm{C}}) q_0$ with $\\lambda_{\\mathrm{C}} \\in \\{0.00, 0.05, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.90, 0.95, 0.975, 1.00\\}$; allocate more windows near $\\lambda_{\\mathrm{C}} \\approx 0$ and $\\lambda_{\\mathrm{C}} \\approx 1$ to capture mild endpoint curvature. For van der Waals, use a soft-core Lennard–Jones potential with a standard softness parameter $\\alpha$ and exponent choice to avoid endpoint singularities, and a nonuniform $\\lambda_{\\mathrm{V}}$ schedule $\\{0.00, 0.05, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.75, 0.80, 0.85, 0.90, 0.925, 0.95, 0.975, 1.00\\}$ that is denser at larger $\\lambda_{\\mathrm{V}}$ where curvature and variance are typically greatest. Allocate a larger fraction of total time (e.g., $70\\%$) to the van der Waals stage, and distribute time across windows in each stage proportionally to an initial estimate of the per-window standard deviation of $\\frac{\\partial U}{\\partial \\lambda}$ times the quadrature weight, so that higher-variance, high-curvature windows receive more sampling.\n\nB. Use a single stage with simultaneous linear scaling of both charges and Lennard–Jones parameters as $U(\\lambda)=(1-\\lambda)U_{\\text{full}}+\\lambda U_{\\text{decoupled}}$ from $\\lambda=0$ to $\\lambda=1$ without soft-core. Employ $11$ uniformly spaced windows at $\\lambda \\in \\{0.0, 0.1, \\dots, 1.0\\}$ and allocate equal simulation time to each window because uniform spacing ensures a balanced integral.\n\nC. Use two stages in the order: van der Waals decoupling first, then decharging. For van der Waals, use a standard (non-soft-core) Lennard–Jones potential with $\\lambda_{\\mathrm{V}} \\in \\{0.00, 0.10, 0.20, \\dots, 1.00\\}$ uniformly spaced, and allocate most of the total time (e.g., $70\\%$) to the decharging stage because water reorientation dominates electrostatic removal. For decharging, scale charges linearly with $\\lambda_{\\mathrm{C}}$ and use uniform spacing and equal time per window.\n\nD. Use two stages in the correct order (decharge, then van der Waals) with a soft-core van der Waals stage. For the van der Waals stage, place most $\\lambda_{\\mathrm{V}}$ windows near $\\lambda_{\\mathrm{V}} \\approx 0$ because that is the coupled state and thus most important physically, and allocate equal time per window to avoid bias from nonuniform sampling. For the decharging stage, use a coarse schedule $\\lambda_{\\mathrm{C}} \\in \\{0.0, 0.5, 1.0\\}$ since the integrand is near-linear, and devote minimal time because electrostatic interactions decay smoothly.\n\nSelect the best option and justify your choice by reasoning from the TI definition, discretization and quadrature considerations, variance-based sampling allocation, and the physical behavior of the integrand in each stage. Only one option is most appropriate given the stated conditions.",
            "solution": "The most scientifically sound and efficient strategy is described in option A. Here is a justification based on established principles for alchemical free energy calculations:\n\n1.  **Staging Order**: The correct and stable procedure is to first remove the electrostatic interactions (decharging) and then remove the van der Waals (vdW) interactions. The reverse order (decoupling vdW first, as in option C) is numerically dangerous, as it would allow charged water molecules to approach the ligand's point charges too closely once the repulsive vdW core is removed, leading to large forces and potential simulation instability.\n\n2.  **Van der Waals Decoupling**: Removing the Lennard-Jones potential requires special care to avoid the \"endpoint catastrophe,\" where overlapping atoms cause divergent forces as the ligand becomes a ghost. Using a **soft-core potential**, as specified in options A and D, is mandatory to prevent this. Options B and C, which omit soft-core potentials, describe protocols that would fail.\n\n3.  **Lambda ($\\lambda$) Scheduling**: The computational effort should be concentrated where it is most needed.\n    *   **vdW Stage**: The integrand $\\langle \\partial U / \\partial \\lambda \\rangle$ for vdW decoupling is known to have high variance and pronounced curvature, especially as $\\lambda_{\\mathrm{V}} \\to 1$ (the decoupled state). Therefore, the $\\lambda$ windows must be spaced more densely in this region to minimize the numerical integration error. Option A correctly proposes a schedule that is denser at larger $\\lambda_{\\mathrm{V}}$. In contrast, option D incorrectly concentrates windows near $\\lambda_{\\mathrm{V}} \\approx 0$.\n    *   **Decharging Stage**: The integrand for decharging a small polar molecule is typically near-linear. A relatively coarse schedule is often sufficient, though option A's proposal to add more points near the endpoints is a good practice to capture any minor non-linearities.\n\n4.  **Allocation of Sampling Effort**: The total statistical error in $\\Delta G$ is minimized when more simulation time is allocated to the $\\lambda$ windows with the highest variance.\n    *   **Between Stages**: The vdW stage is known to be the most computationally demanding due to higher integrand variance. Therefore, allocating a larger fraction of the total simulation time (e.g., 70%) to this stage, as proposed in option A, is the correct strategy. Option C incorrectly allocates most time to the decharging stage.\n    *   **Within a Stage**: Option A correctly describes the optimal strategy for distributing time across windows: proportionally to the standard deviation of the integrand ($\\sigma_i$) and the quadrature weight ($w_i$). This ensures that the most \"difficult\" (high-variance) and most heavily weighted regions are sampled most thoroughly. Options B and D, which propose equal time per window, represent a suboptimal allocation of resources.\n\nIn summary, Option A is the only choice that correctly combines the proper staging order, the mandatory use of soft-core potentials for vdW decoupling, and an efficient, variance-aware scheduling of $\\lambda$ points and allocation of simulation time. The other options contain one or more critical methodological flaws.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}