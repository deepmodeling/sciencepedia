{
    "hands_on_practices": [
        {
            "introduction": "克鲁克斯涨落定理等非平衡关系式，为我们提供了一种通过非平衡过程计算平衡态自由能差（$\\Delta F$）的强大途径。但在领会这些方法的威力之前，我们必须首先掌握如何在简单的、可解析求解的平衡体系中直接计算 $\\Delta F$。这项练习  将指导你为一个经典谐振子（物理学中的一个基石模型）计算这一关键的基准值，为后续的非平衡分析奠定基础。",
            "id": "2677156",
            "problem": "一个质量为 $m$ 的经典粒子在一维空间 ($1$D) 中运动，受到一个刚度（弹簧常数）为 $k$ 的谐振子势的约束。其哈密顿量为 $H(x,p;\\,k)=\\frac{p^{2}}{2m}+\\frac{1}{2}k x^{2}$。该系统与一个逆温度为 $\\beta$ 的热库耦合，其中 $\\beta=\\frac{1}{k_{B}T}$，$k_{B}$ 是玻尔兹曼常数，$T$ 是绝对温度。您打算使用非平衡功的测量来检验将不可逆功的统计量与平衡态自由能差联系起来的论断，但首先您需要精确的平衡态基准。\n\n从经典正则系综和通过普朗克常数 $h$ 将经典配分函数无量纲化的基本定义出发，推导该系统的正则配分函数 $Z(k)$。然后，利用亥姆霍兹自由能 $F(k)$ 的定义 $F(k)=-\\frac{1}{\\beta}\\ln Z(k)$，计算当刚度在固定 $\\beta$ 下从 $k_{0}$ 变为 $k_{1}$ 时的平衡态自由能差 $\\Delta F=F(k_{1})-F(k_{0})$。\n\n以 $m$、$k$、$k_{0}$、$k_{1}$、$h$ 和 $\\beta$ 的闭式解析表达式形式给出 $Z(k)$ 和 $\\Delta F$ 的最终结果。不要代入数值。如果您要对 $\\Delta F$ 进行数值计算，请以焦耳为单位表示，但对于本任务，请保持您的答案为符号形式。以有序对 $\\big(Z(k),\\,\\Delta F\\big)$ 的形式报告您的最终答案。",
            "solution": "问题陈述经评估有效。这是一个在经典统计力学中提法恰当、有科学依据的问题，没有矛盾或含糊之处。我们将按要求进行推导。\n\n该系统由一个在一维空间中运动的质量为 $m$ 的经典粒子组成。其状态由位置坐标 $x$ 和动量坐标 $p$ 描述。代表粒子总能量的哈密顿量是这些坐标以及谐振子势刚度参数 $k$ 的函数：\n$$H(x, p; k) = \\frac{p^2}{2m} + \\frac{1}{2} k x^2$$\n该系统与一个恒定逆温度 $\\beta = \\frac{1}{k_B T}$ 的热库处于热平衡状态，其中 $T$ 是绝对温度，$k_B$ 是玻尔兹曼常数。该系统的性质由正则系综描述。\n\n对于一维空间中的单个经典粒子，正则配分函数 $Z$ 通过对相空间中所有可能状态的积分来定义。为了使 $Z$ 无量纲化，我们必须将相空间体积元 $dx\\,dp$ 除以一个基本作用量单位，即普朗克常数 $h$。其定义为：\n$$Z(k) = \\frac{1}{h} \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta H(x, p; k)\\right) dx \\, dp$$\n将给定的哈密顿量代入此定义，我们得到：\n$$Z(k) = \\frac{1}{h} \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\left(\\frac{p^2}{2m} + \\frac{1}{2} k x^2\\right)\\right) dx \\, dp$$\n指数项可以分离为两个函数的乘积，一个只依赖于 $p$，另一个只依赖于 $x$：\n$$\\exp\\left(-\\beta \\frac{p^2}{2m}\\right) \\exp\\left(-\\beta \\frac{1}{2} k x^2\\right)$$\n这使得二重积分可以表示为两个独立单重积分的乘积：\n$$Z(k) = \\frac{1}{h} \\left( \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta}{2m} p^2\\right) dp \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} x^2\\right) dx \\right)$$\n这两个积分都是标准高斯积分形式 $\\int_{-\\infty}^{\\infty} \\exp(-a y^2) dy = \\sqrt{\\frac{\\pi}{a}}$。\n\n对于动量积分，我们确定常数 $a_p = \\frac{\\beta}{2m}$。此积分的值为：\n$$I_p = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta}{2m} p^2\\right) dp = \\sqrt{\\frac{\\pi}{\\frac{\\beta}{2m}}} = \\sqrt{\\frac{2\\pi m}{\\beta}}$$\n对于位置积分，我们确定常数 $a_x = \\frac{\\beta k}{2}$。此积分的值为：\n$$I_x = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} x^2\\right) dx = \\sqrt{\\frac{\\pi}{\\frac{\\beta k}{2}}} = \\sqrt{\\frac{2\\pi}{\\beta k}}$$\n将这些结果相乘并包含前置因子 $\\frac{1}{h}$，我们得到正则配分函数 $Z(k)$：\n$$Z(k) = \\frac{1}{h} \\cdot \\sqrt{\\frac{2\\pi m}{\\beta}} \\cdot \\sqrt{\\frac{2\\pi}{\\beta k}} = \\frac{1}{h} \\frac{2\\pi}{\\beta} \\sqrt{\\frac{m}{k}}$$\n这是第一个所求的表达式。\n\n接下来，我们计算亥姆霍兹自由能 $F(k)$，它通过基本关系式与配分函数相关联：\n$$F(k) = -\\frac{1}{\\beta} \\ln Z(k)$$\n代入我们推导出的 $Z(k)$ 表达式：\n$$F(k) = -\\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi}{\\beta h} \\sqrt{\\frac{m}{k}}\\right)$$\n使用自然对数的性质 $\\ln(a/b) = \\ln(a) - \\ln(b)$ 和 $\\ln(\\sqrt{x}) = \\frac{1}{2}\\ln(x)$，我们可以展开这个表达式：\n$$F(k) = -\\frac{1}{\\beta} \\left[ \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right) + \\ln\\left(\\frac{1}{\\sqrt{k}}\\right) \\right] = -\\frac{1}{\\beta} \\left[ \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right) - \\frac{1}{2}\\ln(k) \\right]$$\n$$F(k) = \\frac{1}{2\\beta} \\ln(k) - \\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right)$$\n我们需要计算在恒定 $\\beta$ 下，刚度参数从初始值 $k_0$ 变为最终值 $k_1$ 时的自由能变化 $\\Delta F$。这由 $\\Delta F = F(k_1) - F(k_0)$ 给出。\n使用 $F(k)$ 的表达式：\n$$F(k_1) = \\frac{1}{2\\beta} \\ln(k_1) - \\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right)$$\n$$F(k_0) = \\frac{1}{2\\beta} \\ln(k_0) - \\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right)$$\n这些表达式中的第二项是关于参数 $k$ 的常数。因此，在相减时它会消掉：\n$$\\Delta F = F(k_1) - F(k_0) = \\left[ \\frac{1}{2\\beta} \\ln(k_1) - C \\right] - \\left[ \\frac{1}{2\\beta} \\ln(k_0) - C \\right]$$\n其中 $C = \\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right)$。\n这可以简化为：\n$$\\Delta F = \\frac{1}{2\\beta} \\ln(k_1) - \\frac{1}{2\\beta} \\ln(k_0) = \\frac{1}{2\\beta} \\left( \\ln(k_1) - \\ln(k_0) \\right)$$\n使用性质 $\\ln(a) - \\ln(b) = \\ln(a/b)$，我们得到自由能差的最终表达式：\n$$\\Delta F = \\frac{1}{2\\beta} \\ln\\left(\\frac{k_1}{k_0}\\right)$$\n这是统计力学中的一个标准结果，表示准静态地将势的刚度从 $k_0$ 变为 $k_1$ 所需的可逆功。所求的结果是 $Z(k)$ 和 $\\Delta F$ 的表达式。",
            "answer": "$$\\boxed{\\left( \\frac{2\\pi}{\\beta h}\\sqrt{\\frac{m}{k}}, \\frac{1}{2\\beta}\\ln\\left(\\frac{k_1}{k_0}\\right) \\right)}$$"
        },
        {
            "introduction": "克鲁克斯涨落定理具有普适性，但通过分析具体情形，我们能更清晰地理解其应用。这项练习  探讨了当功的分布函数为高斯分布这一常见且往往精确的假设成立时，该定理带来的深刻推论。通过这个思想实验，你将推导出一个基础的涨落-耗散关系，并得出一个异常简洁的自由能差估计量，从而加深对功、耗散与自由能之间内在联系的直观理解。",
            "id": "2677154",
            "problem": "一个经典系统最初处于正则系综平衡状态，其逆温度为 $\\beta$，控制参数 $\\lambda$ 固定为 $\\lambda_{A}$。随后，系统在一个有限时间 $\\tau$ 内，通过一个时变协议 $\\lambda(t)$ 从 $\\lambda_{A}$ 驱动到 $\\lambda_{B}$，从而脱离平衡。在此前向协议中对系统所做的随机功用随机变量 $W$ 表示，其对应的概率密度为 $P_{F}(W)$。考虑一个逆向协议 $\\tilde{\\lambda}(t)$，它在相同的时间内将系统从 $\\lambda_{B}$ 处的正则系综平衡状态带回到 $\\lambda_{A}$。定义所报告的逆向功随机变量为物理逆向功的负值，使其密度 $P_{R}(W)$ 以下列形式进入 Crooks 涨落定理：\n$$\n\\frac{P_{F}(W)}{P_{R}(W)}=\\exp\\!\\big(\\beta\\,[W-\\Delta F]\\big),\n$$\n其中 $\\Delta F$ 是在 $\\lambda_{B}$ 和 $\\lambda_{A}$ 处状态之间的平衡亥姆霍兹自由能差。\n\n假设 $P_{F}(W)$ 和 $P_{R}(W)$ 都是具有相同方差 $\\sigma^{2}$ 但可能具有不同均值 $\\mu_{F}$ 和 $\\mu_{R}$ 的高斯密度，即：\n$$\nP_{F}(W)=\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\!\\left(-\\frac{(W-\\mu_{F})^{2}}{2\\,\\sigma^{2}}\\right),\\qquad\nP_{R}(W)=\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\!\\left(-\\frac{(W-\\mu_{R})^{2}}{2\\,\\sigma^{2}}\\right).\n$$\n\n仅从上述给定的 Crooks 涨落定理和高斯形式出发，以闭合形式推导：\n1) 为保持一致性，$\\mu_{F}$、$\\mu_{R}$、$\\sigma^{2}$ 和 $\\beta$ 之间必须满足的约束条件。\n2) 交叉点 $W^{\\ast}$（在该点 $P_{F}(W^{\\ast})=P_{R}(W^{\\ast})$），并由此用 $\\mu_{F}$ 和 $\\mu_{R}$ 表示平衡自由能差 $\\Delta F$。\n\n将你的最终答案表示为一个行矩阵，按顺序包含 $\\mu_{F}-\\mu_{R}$ 和 $\\Delta F$ 的表达式。不需要进行数值计算。最终答案中不要包含单位。",
            "solution": "在进行求解之前，需要对问题进行验证。\n\n**步骤 1：提取已知条件**\n- 一个经典系统处于正则系综平衡状态，其逆温度为 $\\beta$，控制参数为 $\\lambda_A$。\n- 一个前向过程在时间 $\\tau$ 内将系统从 $\\lambda_A$ 驱动到 $\\lambda_B$。\n- 在前向过程中所做的功是一个随机变量 $W$，其概率密度为 $P_F(W)$。\n- 一个逆向过程在相同的时间 $\\tau$ 内将系统从 $\\lambda_B$ 处的平衡状态驱动到 $\\lambda_A$。\n- 所报告的逆向功随机变量的密度为 $P_R(W)$。\n- Crooks 涨落定理给出如下：\n$$\n\\frac{P_{F}(W)}{P_{R}(W)}=\\exp(\\beta[W-\\Delta F])\n$$\n- 其中 $\\Delta F$ 是亥姆霍兹自由能差 $F(\\lambda_B) - F(\\lambda_A)$。\n- 假设前向和逆向功的概率密度为具有相同方差 $\\sigma^2$ 的高斯分布：\n$$\nP_{F}(W)=\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\left(-\\frac{(W-\\mu_{F})^{2}}{2\\,\\sigma^{2}}\\right)\n$$\n$$\nP_{R}(W)=\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\left(-\\frac{(W-\\mu_{R})^{2}}{2\\,\\sigma^{2}}\\right)\n$$\n- 其中 $\\mu_F$ 和 $\\mu_R$ 分别是各自的均值。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学基础**：该问题基于 Crooks 涨落定理，这是非平衡统计力学中一个基本且已确立的结果。高斯功分布的假设是一个常见且有效的理论模型，在线性响应区域或对于具有许多自由度的系统尤其适用。该问题在科学上是合理的。\n- **适定性**：该问题提供了一套清晰的假设和方程，并要求推导特定的量。问题是精确的，可以通过直接的代数运算确定唯一的解。\n- **客观性**：问题以客观的数学语言陈述，没有歧义或主观看法。\n- **完整性与一致性**：问题是自洽的。所有必要的信息（定理、分布的函数形式）都已提供。没有内部矛盾。\n\n**步骤 3：结论与行动**\n问题有效。这是统计物理学中一个标准的理论练习。将推导解答。\n\n起始点是 Crooks 涨落定理：\n$$\n\\frac{P_{F}(W)}{P_{R}(W)} = \\exp(\\beta[W-\\Delta F])\n$$\n我们已知 $P_F(W)$ 和 $P_R(W)$ 作为高斯分布的显式形式。我们将它们代入定理的左侧：\n$$\n\\frac{P_{F}(W)}{P_{R}(W)} = \\frac{\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\left(-\\frac{(W-\\mu_{F})^{2}}{2\\,\\sigma^{2}}\\right)}{\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\left(-\\frac{(W-\\mu_{R})^{2}}{2\\,\\sigma^{2}}\\right)}\n$$\n归一化前置因子相互抵消，留下指数函数的比率。这可以简化为单个指数函数：\n$$\n\\frac{P_{F}(W)}{P_{R}(W)} = \\exp\\left(-\\frac{(W-\\mu_{F})^{2}}{2\\,\\sigma^{2}} + \\frac{(W-\\mu_{R})^{2}}{2\\,\\sigma^{2}}\\right) = \\exp\\left(\\frac{(W-\\mu_{R})^{2} - (W-\\mu_{F})^{2}}{2\\,\\sigma^{2}}\\right)\n$$\n我们展开指数中的二次项：\n$$\n(W-\\mu_{R})^{2} - (W-\\mu_{F})^{2} = (W^{2} - 2W\\mu_{R} + \\mu_{R}^{2}) - (W^{2} - 2W\\mu_{F} + \\mu_{F}^{2})\n$$\n$W^{2}$ 项相互抵消，我们剩下：\n$$\n-2W\\mu_{R} + \\mu_{R}^{2} + 2W\\mu_{F} - \\mu_{F}^{2} = 2W(\\mu_{F} - \\mu_{R}) - (\\mu_{F}^{2} - \\mu_{R}^{2})\n$$\n将此代回概率比的表达式中：\n$$\n\\frac{P_{F}(W)}{P_{R}(W)} = \\exp\\left(\\frac{2W(\\mu_{F} - \\mu_{R}) - (\\mu_{F}^{2} - \\mu_{R}^{2})}{2\\,\\sigma^{2}}\\right) = \\exp\\left(\\frac{\\mu_{F} - \\mu_{R}}{\\sigma^{2}}W - \\frac{\\mu_{F}^{2} - \\mu_{R}^{2}}{2\\,\\sigma^{2}}\\right)\n$$\n现在，我们将此结果与 Crooks 涨落定理的右侧相等：\n$$\n\\exp\\left(\\frac{\\mu_{F} - \\mu_{R}}{\\sigma^{2}}W - \\frac{\\mu_{F}^{2} - \\mu_{R}^{2}}{2\\,\\sigma^{2}}\\right) = \\exp(\\beta W - \\beta\\Delta F)\n$$\n为使该恒等式对所有功 $W$ 的值都成立，指数必须相等。这要求 $W$ 的线性项系数相等，常数项也相等。\n\n1) **参数约束**：\n通过令指数中 $W$ 项的系数相等，我们找到第一个所需的关系：\n$$\n\\frac{\\mu_{F} - \\mu_{R}}{\\sigma^{2}} = \\beta\n$$\n这可以重写为关联均值、方差和逆温度的约束条件：\n$$\n\\mu_{F} - \\mu_{R} = \\beta\\sigma^{2}\n$$\n这个结果是具有高斯功统计的系统的涨落-耗散关系的一个特例。前向和逆向平均功之间的差值与功涨落的方差成正比。\n\n2) **自由能差和交叉点**：\n接下来，我们令指数中的常数项相等：\n$$\n-\\frac{\\mu_{F}^{2} - \\mu_{R}^{2}}{2\\,\\sigma^{2}} = -\\beta\\Delta F\n$$\n解出自由能差 $\\Delta F$：\n$$\n\\Delta F = \\frac{\\mu_{F}^{2} - \\mu_{R}^{2}}{2\\beta\\sigma^{2}}\n$$\n我们可以使用第 1 部分的结果来简化此表达式。首先，我们对分子进行因式分解：$\\mu_{F}^{2} - \\mu_{R}^{2} = (\\mu_{F} - \\mu_{R})(\\mu_{F} + \\mu_{R})$。接下来，我们代入 $\\mu_{F} - \\mu_{R} = \\beta\\sigma^{2}$：\n$$\n\\Delta F = \\frac{(\\beta\\sigma^{2})(\\mu_{F} + \\mu_{R})}{2\\beta\\sigma^{2}}\n$$\n假定 $\\beta \\neq 0$ 和 $\\sigma^{2} \\neq 0$（这是物理上必需的条件，因为无限温度没有意义，而零方差意味着确定性过程，这与本题情况不符），我们可以消去分子和分母中的 $\\beta\\sigma^{2}$ 项：\n$$\n\\Delta F = \\frac{\\mu_{F} + \\mu_{R}}{2}\n$$\n问题还要求在 $P_{F}(W^{\\ast}) = P_{R}(W^{\\ast})$ 时的交叉点 $W^{\\ast}$。在这一点上，概率之比为 1：\n$$\n\\frac{P_{F}(W^{\\ast})}{P_{R}(W^{\\ast})} = 1\n$$\n从 Crooks 关系式可知，这意味着：\n$$\n\\exp(\\beta[W^{\\ast}-\\Delta F]) = 1\n$$\n对两边取自然对数得到 $\\beta(W^{\\ast}-\\Delta F) = 0$。由于 $\\beta \\neq 0$，必然有：\n$$\nW^{\\ast} = \\Delta F\n$$\n因此，两个功分布的交叉点恰好是平衡自由能差，我们已经发现它等于前向和逆向平均功的算术平均值。\n$$\nW^{\\ast} = \\frac{\\mu_{F} + \\mu_{R}}{2}\n$$\n最终答案需要 $\\mu_{F}-\\mu_{R}$ 和 $\\Delta F$ 的表达式。\n\n第一个表达式是 $\\mu_{F} - \\mu_{R} = \\beta\\sigma^{2}$。\n第二个表达式是 $\\Delta F = \\frac{\\mu_{F} + \\mu_{R}}{2}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\beta\\sigma^{2}  \\frac{\\mu_{F} + \\mu_{R}}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "检验物理定理理解程度的最终方式，往往是将其付诸于计算实现。这项练习  将挑战你从零开始为一个被驱动出平衡态的简单二态系统建立一个模拟程序。你将生成随机轨迹，计算所做的功，并利用所得数据对克鲁克斯涨落定理进行数值验证，从而将抽象理论与具体的数值证据联系起来。这项实践突出了在真实或模拟数据中应用涨落定理的实际步骤，例如进行有效的统计分析来检验理论预测的线性关系。",
            "id": "2644035",
            "problem": "考虑一个由物种 $A$ 和 $B$ 组成的双态化学反应网络（CRN），它们通过单一的可逆反应 $A \\rightleftharpoons B$ 连接。该系统被建模为连续时间马尔可夫跳跃过程（CTMC）。态 $A$ 的能量为 $E_A(t) \\equiv 0$，态 $B$ 的能量为 $E_B(t) \\equiv \\Delta E(t)$，其中外部控制的能量差 $\\Delta E(t)$ 在有限时间区间 $t \\in [0, \\tau]$ 内根据预设的协议变化。逆热能表示为 $\\beta \\equiv 1/(k_\\mathrm{B} T)$，其中 $k_\\mathrm{B}$ 是玻尔兹曼常数， $T$ 是温度。在整个过程中，使用无量纲单位，其中能量以 $k_\\mathrm{B} T$ 为单位进行度量，时间以 $1/k_0$ 为单位（如下文所述）；不需要进行物理单位转换。\n\n假设局域细致平衡在所有时刻都成立：瞬时跃迁速率 $k_{A \\to B}(t)$ 和 $k_{B \\to A}(t)$ 满足\n$$\n\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} \\;=\\; e^{-\\beta \\, \\Delta E(t)} \\, .\n$$\n固定对称的类阿伦尼乌斯参数化\n$$\nk_{A \\to B}(t) \\equiv k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E(t)} \\quad \\text{和} \\quad\nk_{B \\to A}(t) \\equiv k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E(t)} \\, ,\n$$\n其中 $k_0  0$ 是一个恒定的速率标度。\n\n对于在随时间变化的协议 $\\Delta E(t)$ 下（$t \\in [0,\\tau]$）的一条给定轨迹 $x(t) \\in \\{A,B\\}$，将协议所做的随机功定义为黎曼–斯蒂尔杰斯积分\n$$\nW[x(\\cdot)] \\;=\\; \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\, d\\Delta E(t) \\, ,\n$$\n其中 $\\mathbf{1}_{\\{x(t)=B\\}}$ 是系统在时刻 $t$ 占据态 $B$ 的指示函数。在参数值 $\\Delta E$ 下的平衡自由能为\n$$\nF(\\Delta E) \\;=\\; -\\frac{1}{\\beta} \\ln\\!\\big( 1 + e^{-\\beta \\Delta E} \\big) \\, ,\n$$\n且从 $\\Delta E(0)=\\Delta E_i$ 到 $\\Delta E(\\tau)=\\Delta E_f$ 的一个协议的自由能差为 $\\Delta F \\equiv F(\\Delta E_f) - F(\\Delta E_i)$。\n\n您将对功的 Crooks 涨落定理进行数值检验。该定理指出，对于一个正向协议 $\\Delta E_F(t)$ 及其时间反演的逆向协议 $\\Delta E_R(t) \\equiv \\Delta E_F(\\tau - t)$（初始系综分别从 $\\Delta E_i$ 和 $\\Delta E_f$ 对应的平衡态中抽样），功的分布 $P_F(W)$ 和 $P_R(W)$ 满足\n$$\n\\frac{P_F(W)}{P_R(-W)} \\;=\\; e^{\\beta \\, (W - \\Delta F)} \\, .\n$$\n\n实现一个程序，该程序：\n- 使用非时齐跳跃过程的精确抽样方法，为正向和逆向协议模拟一个独立轨迹的系综。对于正向协议，使用线性斜坡\n$$\n\\Delta E_F(t) \\;=\\; \\Delta E_i + \\frac{\\Delta E_f - \\Delta E_i}{\\tau} \\, t \\, ,\n$$\n对于逆向协议，使用时间反演的线性斜坡\n$$\n\\Delta E_R(t) \\;=\\; \\Delta E_f - \\frac{\\Delta E_f - \\Delta E_i}{\\tau} \\, t \\, .\n$$\n- 从协议起始参数值对应的正则平衡态中为每条轨迹抽取初始态。即，在参数 $\\Delta E$ 下，平衡概率为 $p_A^{\\mathrm{eq}}(\\Delta E) = \\frac{1}{1+e^{-\\beta \\Delta E}}$ 和 $p_B^{\\mathrm{eq}}(\\Delta E) = \\frac{e^{-\\beta \\Delta E}}{1+e^{-\\beta \\Delta E}}$。\n- 使用上述积分定义，计算沿每条轨迹所做的功 $W$。\n- 通过直方图估计功分布 $P_F(W)$ 和 $P_R(W)$。直方图使用固定数量的箱子 $n_b$，其公共范围覆盖正向功样本和符号翻转的逆向功样本。使用 $n_b = 60$。根据组合数据 $\\{W_F\\} \\cup \\{-W_R\\}$ 的最小值和最大值构建公共范围。如果此范围的宽度可忽略不计（例如，所有采样功在数值上重合），则将其扩展为围绕零的一个小的对称区间，以避免退化的直方图。\n- 仅在两个直方图都严格为正的箱子上，将经验对数比 $\\ln\\!\\big( P_F(W) / P_R(-W) \\big)$ 与理论预测 $\\beta (W - \\Delta F)$ 进行比较，并报告这些箱子上的最大绝对偏差是否低于预设的容差 $\\varepsilon$。\n\n为了可复现性，使用固定的随机种子。将种子设置为 $12345$。\n\n您的程序必须实现此受驱动双态过程中事件时间的精确抽样。对于上述线性协议，每个态的总出射速率是时间的指数函数，这允许对非均匀等待时间分布进行精确反演。您不得假设任何时间离散化近似。\n\n测试套件：\n模拟以下三种情况，并为每种情况返回一个布尔值，指示 Crooks 关系是否在指定的容差内成立。对所有情况使用相同的直方图设置 $(n_b = 60)$ 和相同的偏差容差 $\\varepsilon = 0.35$。\n\n- 情况 1（理想情况，中等速度）：\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 0.0$, $\\Delta E_f = 4.0$, $\\tau = 8.0$, 正向和逆向的轨迹数均为 $N = 20000$。\n\n- 情况 2（快速驱动）：\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 0.0$, $\\Delta E_f = 4.0$, $\\tau = 0.5$, 正向和逆向的轨迹数均为 $N = 20000$。\n\n- 情况 3（边界情况，参数无变化）：\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 1.0$, $\\Delta E_f = 1.0$, $\\tau = 3.0$, 正向和逆向的轨迹数均为 $N = 20000$。\n\n答案规格：\n- 对于每种情况，计算一个布尔值，指示最大绝对偏差\n$$\n\\max_{\\text{overlapping bins}} \\left| \\ln\\!\\frac{P_F(W)}{P_R(-W)} - \\beta \\, (W - \\Delta F) \\right|\n$$\n是否不超过 $\\varepsilon = 0.35$。如果没有具有严格为正密度的重叠箱子，则该情况返回布尔值 False。\n- 最终输出必须是单行，包含三个布尔结果，以逗号分隔的列表形式并用方括号括起来（例如，\"[True,False,True]\"）。\n\n您的程序必须是完整且可直接运行的，不得需要任何输入，并且必须遵守上面给出的种子、直方图和容差规范。所有量都应以指定的无量纲单位报告；不需要物理单位。",
            "solution": "所述问题已经过验证，并被认定为有效。它提出了一个在非平衡统计力学领域中定义明确、有科学依据的问题，具体是针对一个受驱动的双态系统对 Crooks 涨落定理进行数值验证。所有参数、定义和约束都已提供，构成了一个自洽且可解的问题。核心任务涉及对非时齐马尔可夫跳跃过程进行精确随机模拟，这是计算物理学中一个标准但并非无足轻重的程序。\n\n解决方案分三个阶段展开：首先，推导用于生成受驱动系统轨迹的精确模拟算法；其次，计算沿每条轨迹所做功的方法；第三，检验 Crooks 关系的统计程序。\n\n一个双态系统经历反应 $A \\rightleftharpoons B$。能量为 $E_A = 0$ 和 $E_B = \\Delta E(t)$。跃迁速率由对称参数化给出：\n$$\nk_{A \\to B}(t) = k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E(t)} \\quad \\text{和} \\quad\nk_{B \\to A}(t) = k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E(t)}\n$$\n这些速率满足局域细致平衡条件 $\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} = e^{-\\beta \\Delta E(t)}$。外部参数 $\\Delta E(t)$ 随时间线性驱动，$\\Delta E(t) = \\Delta E_{start} + v t$，其中速率 $v = (\\Delta E_{end} - \\Delta E_{start}) / \\tau$。\n\n模拟的核心是为这个非时齐过程生成跳跃时间。如果系统在时刻 $t_0$ 处于态 $X$，那么在没有发生跳跃的情况下存活到时刻 $t$ 的概率是 $P(t) = \\exp\\left(-\\int_{t_0}^t k_{exit}(s) ds\\right)$，其中 $k_{exit}(s)$ 是在时刻 $s$ 离开态 $X$ 的出射速率。下一个跳跃时间 $t_{jump}$ 可以通过求解方程 $\\int_{t_0}^{t_{jump}} k_{exit}(s) ds = R$ 来抽样得到，其中 $R$ 是从速率为 1 的指数分布中抽取的随机变量。\n\n对于给定的线性协议，出射速率的形式为 $k_{exit}(t) = C e^{\\alpha t}$，其中常数 $C$ 和 $\\alpha$ 取决于所处的态。\n如果系统处于态 $A$，出射速率为 $k_{A \\to B}(t)$。那么：\n$$\n\\alpha_A = -\\frac{\\beta v}{2} \\quad \\text{和} \\quad C_A = k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E_{start}}\n$$\n如果系统处于态 $B$，出射速率为 $k_{B \\to A}(t)$。那么：\n$$\n\\alpha_B = +\\frac{\\beta v}{2} \\quad \\text{和} \\quad C_B = k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E_{start}}\n$$\n对于非平凡情况 $v \\neq 0$（因此 $\\alpha \\neq 0$），该积分是可解析处理的：\n$$\n\\int_{t_0}^{t_0 + \\Delta t} C e^{\\alpha s} ds \\;=\\; \\frac{C}{\\alpha} \\left[ e^{\\alpha(t_0+\\Delta t)} - e^{\\alpha t_0} \\right] \\;=\\; \\frac{C e^{\\alpha t_0}}{\\alpha} \\left( e^{\\alpha \\Delta t} - 1 \\right) \\;=\\; \\frac{k_{exit}(t_0)}{\\alpha} \\left( e^{\\alpha \\Delta t} - 1 \\right)\n$$\n将此式等于 $R$ 并求解等待时间 $\\Delta t$ 可得：\n$$\n\\Delta t = \\frac{1}{\\alpha} \\ln\\left(1 + \\frac{\\alpha R}{k_{exit}(t_0)}\\right)\n$$\n此公式在对数的参数为正时有效。如果 $1 + \\frac{\\alpha R}{k_{exit}(t_0)} \\le 0$（这只可能在 $\\alpha  0$ 时发生），则意味着从 $t_0$ 到无穷大的总积分速率收敛到一个小于 $R$ 的值，表示不会发生跳跃。在这种情况下，我们设置 $\\Delta t = \\infty$。此方法提供了等待时间的精确样本。对于 $v=0$（因此 $\\alpha=0$）的特殊情况，速率是恒定的，等待时间就是 $\\Delta t = R / k_{exit}$。\n\n对于线性协议 $\\Delta E(t)$，随机功的计算显著简化。黎曼–斯蒂尔杰斯积分为：\n$$\nW = \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\, d\\Delta E(t) = \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\frac{d\\Delta E}{dt} dt = v \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} dt\n$$\n因此，功是协议速率 $v$ 与系统停留在态 $B$ 的总时间的乘积。这将计算简化为对系统处于态 $B$ 的所有区间的持续时间求和。\n\nCrooks 关系 $\\frac{P_F(W)}{P_R(-W)} = e^{\\beta (W - \\Delta F)}$ 的验证是数值上进行的。分别为正向协议（$\\Delta E_i \\to \\Delta E_f$）和逆向协议（$\\Delta E_f \\to \\Delta E_i$）生成轨迹系综，它们分别从各自的初始平衡分布开始。为每条轨迹计算功值 $W_F$ 和 $W_R$。\n\n概率分布 $P_F(W)$ 和 $P_R(W)$ 使用直方图进行估计。在组合数据 $\\{W_F\\} \\cup \\{-W_R\\}$ 的范围内构建一个公共的箱子集合。逆向过程的直方图是针对符号翻转的功值 $-W_R$ 计算的。归一化直方图提供了在箱子中心 $W_k$ 处对 $P_F(W)$ 和 $P_R(-W)$ 的经验估计。\n\n自由能差计算为 $\\Delta F = F(\\Delta E_f) - F(\\Delta E_i)$，其中自由能由 $F(\\Delta E) = -\\frac{1}{\\beta} \\ln(1 + e^{-\\beta \\Delta E})$ 给出。对于 $P_F(W_k)$ 和 $P_R(-W_k)$ 都严格为正的每个箱子 $k$，计算其偏差：\n$$\nd_k = \\left| \\ln\\left(\\frac{P_F(W_k)}{P_R(-W_k)}\\right) - \\beta (W_k - \\Delta F) \\right|\n$$\n这些偏差的最大值 $\\max_k d_k$ 与容差 $\\varepsilon=0.35$ 进行比较。如果此最大偏差在容差范围内，则认为该定理在该情况下得到了数值验证。如果两个分布之间没有箱子显示重叠，则验证失败。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the Crooks fluctuation theorem.\n    \"\"\"\n    # Fixed parameters for all test cases\n    N_TRAJECTORIES = 20000\n    N_BINS = 60\n    TOLERANCE = 0.35\n    RANDOM_SEED = 12345\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1 (happy path, moderate speed)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 0.0, 'delta_E_f': 4.0, 'tau': 8.0},\n        # Case 2 (fast driving)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 0.0, 'delta_E_f': 4.0, 'tau': 0.5},\n        # Case 3 (boundary case, no change in parameter)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 1.0, 'delta_E_f': 1.0, 'tau': 3.0},\n    ]\n\n    rng = np.random.default_rng(RANDOM_SEED)\n    results = []\n\n    for case in test_cases:\n        # Run forward and reverse simulations\n        W_F = _simulate_protocol(params=case, is_forward=True, n_traj=N_TRAJECTORIES, rng=rng)\n        W_R = _simulate_protocol(params=case, is_forward=False, n_traj=N_TRAJECTORIES, rng=rng)\n\n        # Prepare data for histogramming\n        neg_W_R = -np.array(W_R)\n        \n        # Determine common histogram range\n        combined_works = np.concatenate((W_F, neg_W_R))\n        w_min, w_max = combined_works.min(), combined_works.max()\n        \n        if w_max - w_min  1e-9:\n             w_min, w_max = -1.0, 1.0\n        else: # Add padding to avoid issues at edges\n            padding = 0.01 * (w_max-w_min) if (w_max-w_min)  0 else 0.1\n            w_min -= padding\n            w_max += padding\n\n        bins = np.linspace(w_min, w_max, N_BINS + 1)\n        bin_centers = (bins[:-1] + bins[1:]) / 2.0\n\n        # Create normalized histograms (probability densities)\n        P_F, _ = np.histogram(W_F, bins=bins, density=True)\n        P_R_neg, _ = np.histogram(neg_W_R, bins=bins, density=True)\n\n        # Calculate free energy difference\n        beta = case['beta']\n        delta_E_i = case['delta_E_i']\n        delta_E_f = case['delta_E_f']\n        \n        def free_energy(E, b):\n            return -1.0 / b * np.log(1.0 + np.exp(-b * E))\n            \n        delta_F = free_energy(delta_E_f, beta) - free_energy(delta_E_i, beta)\n\n        # Check Crooks relation\n        max_deviation = 0.0\n        found_overlap = False\n        \n        for i in range(N_BINS):\n            if P_F[i]  0 and P_R_neg[i]  0:\n                found_overlap = True\n                W_k = bin_centers[i]\n                \n                log_ratio_empirical = np.log(P_F[i] / P_R_neg[i])\n                log_ratio_theoretical = beta * (W_k - delta_F)\n                \n                deviation = np.abs(log_ratio_empirical - log_ratio_theoretical)\n                if deviation  max_deviation:\n                    max_deviation = deviation\n        \n        if not found_overlap:\n            results.append(False)\n        else:\n            results.append(max_deviation = TOLERANCE)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef _simulate_protocol(params, is_forward, n_traj, rng):\n    \"\"\"\n    Simulates trajectories for a given protocol (forward or reverse).\n    \"\"\"\n    beta, k0, tau = params['beta'], params['k0'], params['tau']\n\n    if is_forward:\n        E_start, E_end = params['delta_E_i'], params['delta_E_f']\n    else: # Reverse protocol\n        E_start, E_end = params['delta_E_f'], params['delta_E_i']\n\n    v = (E_end - E_start) / tau if tau  0 else 0.0\n\n    work_values = []\n    \n    for _ in range(n_traj):\n        # Initialize state from equilibrium at E_start\n        p_B_eq = np.exp(-beta * E_start) / (1.0 + np.exp(-beta * E_start))\n        state = 1 if rng.random()  p_B_eq else 0  # 0 for A, 1 for B\n        \n        current_time = 0.0\n        time_in_B = 0.0\n\n        while current_time  tau:\n            t_prev = current_time\n            \n            # Sample waiting time dt for the next jump\n            if v == 0: # Homogeneous process\n                rate_A_to_B = k0 * np.exp(-beta * E_start / 2.0)\n                rate_B_to_A = k0 * np.exp(beta * E_start / 2.0)\n                rate = rate_A_to_B if state == 0 else rate_B_to_A\n                dt = rng.exponential(1.0 / rate) if rate  0 else np.inf\n            else: # Inhomogeneous process\n                R = rng.exponential(1.0)\n                if state == 0: # From A\n                    alpha = -beta * v / 2.0\n                    C = k0 * np.exp(-beta * E_start / 2.0)\n                else: # From B\n                    alpha = beta * v / 2.0\n                    C = k0 * np.exp(beta * E_start / 2.0)\n                \n                rate_at_t = C * np.exp(alpha * current_time)\n                \n                arg = 1.0 + alpha * R / rate_at_t\n                if arg  0:\n                    dt = (1.0 / alpha) * np.log1p(alpha * R / rate_at_t)\n                else:\n                    dt = np.inf\n\n            t_jump = current_time + dt\n            t_final_interval = min(t_jump, tau)\n\n            if state == 1: # If in state B\n                time_in_B += t_final_interval - t_prev\n            \n            if t_jump  tau:\n                current_time = t_jump\n                state = 1 - state # Flip state\n            else:\n                current_time = tau # End of trajectory\n        \n        work = v * time_in_B\n        work_values.append(work)\n        \n    return work_values\n\nsolve()\n```"
        }
    ]
}