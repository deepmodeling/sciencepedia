{
    "hands_on_practices": [
        {
            "introduction": "Before we can appreciate the power of non-equilibrium work theorems, we must first understand how free energy differences are calculated within the traditional framework of equilibrium statistical mechanics. This provides the \"ground truth\" that methods like the Crooks fluctuation theorem aim to recover from non-equilibrium processes. This practice guides you through the foundational calculation of the canonical partition function for a simple, analytically solvable model—a classical harmonic oscillator—to find the equilibrium free energy difference $\\Delta F$ .",
            "id": "2677156",
            "problem": "A single classical particle of mass $m$ in one spatial dimension ($1$D) is confined by a harmonic potential whose stiffness (spring constant) is $k$. Its Hamiltonian is $H(x,p;\\,k)=\\frac{p^{2}}{2m}+\\frac{1}{2}k x^{2}$. The system is coupled to a thermal reservoir at inverse temperature $\\beta$, where $\\beta=1/(k_B T)$ with $k_B$ the Boltzmann constant and $T$ the absolute temperature. You intend to use nonequilibrium work measurements to test statements that connect irreversible work statistics to equilibrium free-energy differences, but first you need the exact equilibrium benchmarks.\n\nStarting from the classical canonical ensemble and the fundamental definition of the classical partition function that renders it dimensionless via Planck’s constant $h$, derive the canonical partition function $Z(k)$ for this system. Then, using the Helmholtz free energy $F(k)$ defined by $F(k)=-\\frac{1}{\\beta}\\ln Z(k)$, compute the equilibrium free-energy difference $\\Delta F=F(k_{1})-F(k_{0})$ when the stiffness is changed from $k_{0}$ to $k_{1}$ at fixed $\\beta$.\n\nProvide your final results as closed-form analytic expressions for $Z(k)$ and $\\Delta F$ in terms of $m$, $k$, $k_{0}$, $k_{1}$, $h$, and $\\beta$. Do not substitute numerical values. If you were to evaluate $\\Delta F$ numerically, express it in joules, but for this task keep your answer symbolic. Report your final answer as an ordered pair in the form $\\big(Z(k),\\,\\Delta F\\big)$.",
            "solution": "The problem statement is assessed to be valid. It is a well-posed, scientifically grounded problem in classical statistical mechanics, free of contradictions or ambiguity. We shall proceed with the derivation as requested.\n\nThe system consists of a single classical particle of mass $m$ in one spatial dimension. Its state is described by the position coordinate $x$ and momentum coordinate $p$. The Hamiltonian, which represents the total energy of the particle, is given as a function of these coordinates and a parameter $k$, the stiffness of the harmonic potential:\n$$H(x, p; k) = \\frac{p^2}{2m} + \\frac{1}{2} k x^2$$\nThe system is in thermal equilibrium with a heat reservoir at a constant inverse temperature $\\beta = 1/(k_B T)$, where $T$ is the absolute temperature and $k_B$ is the Boltzmann constant. The properties of the system are described by the canonical ensemble.\n\nThe canonical partition function, $Z$, for a single classical particle in one dimension is defined by an integral over all possible states in phase space. To render $Z$ dimensionless, we must divide the phase space volume element $dx\\,dp$ by a fundamental unit of action, which is Planck's constant $h$. The definition is:\n$$Z(k) = \\frac{1}{h} \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta H(x, p; k)\\right) dx \\, dp$$\nSubstituting the given Hamiltonian into this definition, we obtain:\n$$Z(k) = \\frac{1}{h} \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\beta \\left(\\frac{p^2}{2m} + \\frac{1}{2} k x^2\\right)\\right) dx \\, dp$$\nThe exponential term can be separated into a product of two functions, one depending only on $p$ and the other only on $x$:\n$$\\exp\\left(-\\beta \\frac{p^2}{2m}\\right) \\exp\\left(-\\beta \\frac{1}{2} k x^2\\right)$$\nThis allows the double integral to be expressed as a product of two independent single integrals:\n$$Z(k) = \\frac{1}{h} \\left( \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta}{2m} p^2\\right) dp \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} x^2\\right) dx \\right)$$\nBoth integrals are of the standard Gaussian form $\\int_{-\\infty}^{\\infty} \\exp(-a y^2) dy = \\sqrt{\\frac{\\pi}{a}}$.\n\nFor the momentum integral, we identify the constant $a_p = \\frac{\\beta}{2m}$. The value of this integral is:\n$$I_p = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta}{2m} p^2\\right) dp = \\sqrt{\\frac{\\pi}{\\frac{\\beta}{2m}}} = \\sqrt{\\frac{2\\pi m}{\\beta}}$$\nFor the position integral, we identify the constant $a_x = \\frac{\\beta k}{2}$. The value of this integral is:\n$$I_x = \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\beta k}{2} x^2\\right) dx = \\sqrt{\\frac{\\pi}{\\frac{\\beta k}{2}}} = \\sqrt{\\frac{2\\pi}{\\beta k}}$$\nMultiplying these results together and including the pre-factor $\\frac{1}{h}$, we find the canonical partition function $Z(k)$:\n$$Z(k) = \\frac{1}{h} \\cdot \\sqrt{\\frac{2\\pi m}{\\beta}} \\cdot \\sqrt{\\frac{2\\pi}{\\beta k}} = \\frac{1}{h} \\frac{2\\pi}{\\beta} \\sqrt{\\frac{m}{k}}$$\nThis is the first required expression.\n\nNext, we compute the Helmholtz free energy, $F(k)$, which is related to the partition function by the fundamental relation:\n$$F(k) = -\\frac{1}{\\beta} \\ln Z(k)$$\nSubstituting our derived expression for $Z(k)$:\n$$F(k) = -\\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi}{\\beta h} \\sqrt{\\frac{m}{k}}\\right)$$\nUsing the properties of the natural logarithm, $\\ln(a/b) = \\ln(a) - \\ln(b)$ and $\\ln(\\sqrt{x}) = \\frac{1}{2}\\ln(x)$, we can expand this expression:\n$$F(k) = -\\frac{1}{\\beta} \\left[ \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right) + \\ln\\left(\\frac{1}{\\sqrt{k}}\\right) \\right] = -\\frac{1}{\\beta} \\left[ \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right) - \\frac{1}{2}\\ln(k) \\right]$$\n$$F(k) = \\frac{1}{2\\beta} \\ln(k) - \\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right)$$\nWe are asked to compute the change in free energy, $\\Delta F$, when the stiffness parameter is changed from an initial value $k_0$ to a final value $k_1$ at constant $\\beta$. This is given by $\\Delta F = F(k_1) - F(k_0)$.\nUsing the expression for $F(k)$:\n$$F(k_1) = \\frac{1}{2\\beta} \\ln(k_1) - \\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right)$$\n$$F(k_0) = \\frac{1}{2\\beta} \\ln(k_0) - \\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right)$$\nThe second term in these expressions is a constant with respect to the parameter $k$. Therefore, it cancels upon subtraction:\n$$\\Delta F = F(k_1) - F(k_0) = \\left[ \\frac{1}{2\\beta} \\ln(k_1) - C \\right] - \\left[ \\frac{1}{2\\beta} \\ln(k_0) - C \\right]$$\nwhere $C = \\frac{1}{\\beta} \\ln\\left(\\frac{2\\pi \\sqrt{m}}{\\beta h}\\right)$.\nThis simplifies to:\n$$\\Delta F = \\frac{1}{2\\beta} \\ln(k_1) - \\frac{1}{2\\beta} \\ln(k_0) = \\frac{1}{2\\beta} \\left( \\ln(k_1) - \\ln(k_0) \\right)$$\nUsing the property $\\ln(a) - \\ln(b) = \\ln(a/b)$, we arrive at the final expression for the free energy difference:\n$$\\Delta F = \\frac{1}{2\\beta} \\ln\\left(\\frac{k_1}{k_0}\\right)$$\nThis is a standard result in statistical mechanics, representing the reversible work required to quasistatically change the stiffness of the potential from $k_0$ to $k_1$. The required results are the expressions for $Z(k)$ and $\\Delta F$.",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{2\\pi}{\\beta h}\\sqrt{\\frac{m}{k}} & \\frac{1}{2\\beta}\\ln\\left(\\frac{k_{1}}{k_{0}}\\right) \\end{pmatrix}}$$"
        },
        {
            "introduction": "The Crooks fluctuation theorem provides a powerful and exact relationship between the work distributions of a process and its time-reverse. To build intuition for its consequences, it is instructive to explore the theorem under a simplifying assumption that holds remarkably well for many systems, particularly those near equilibrium. This exercise asks you to assume that the forward and reverse work distributions are Gaussian, and by applying the Crooks relation, you will derive fundamental connections between mean work, dissipated work, work fluctuations, and the free energy difference $\\Delta F$ .",
            "id": "2677154",
            "problem": "A classical system is initially prepared in canonical equilibrium at inverse temperature $\\beta$ with control parameter $\\lambda$ fixed at $\\lambda_{A}$. It is then driven out of equilibrium by a time-dependent protocol $\\lambda(t)$ from $\\lambda_{A}$ to $\\lambda_{B}$ over a finite time $\\tau$. The stochastic work performed on the system during this forward protocol is denoted by the random variable $W$, with a corresponding probability density $P_{F}(W)$. Consider the reverse protocol $\\tilde{\\lambda}(t)$ that takes the system from $\\lambda_{B}$ back to $\\lambda_{A}$ over the same duration, starting from canonical equilibrium at $\\lambda_{B}$. Define the reported reverse-work random variable to be the negative of the physical reverse work, so that its density $P_{R}(W)$ enters the Crooks fluctuation theorem in the form\n$$\n\\frac{P_{F}(W)}{P_{R}(W)}=\\exp\\!\\big(\\beta\\,[W-\\Delta F]\\big),\n$$\nwhere $\\Delta F$ is the equilibrium Helmholtz free energy difference between the states at $\\lambda_{B}$ and $\\lambda_{A}$.\n\nAssume that both $P_{F}(W)$ and $P_{R}(W)$ are Gaussian densities with the same variance $\\sigma^{2}$ but possibly different means $\\mu_{F}$ and $\\mu_{R}$, that is,\n$$\nP_{F}(W)=\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\!\\left(-\\frac{(W-\\mu_{F})^{2}}{2\\,\\sigma^{2}}\\right),\\qquad\nP_{R}(W)=\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\!\\left(-\\frac{(W-\\mu_{R})^{2}}{2\\,\\sigma^{2}}\\right).\n$$\n\nStarting only from the stated Crooks fluctuation theorem and the Gaussian forms above, derive in closed form:\n1) The constraint relating $\\mu_{F}$, $\\mu_{R}$, $\\sigma^{2}$, and $\\beta$ that must hold for consistency.\n2) The crossing point $W^{\\ast}$ at which $P_{F}(W^{\\ast})=P_{R}(W^{\\ast})$, and thus the equilibrium free-energy difference $\\Delta F$ in terms of $\\mu_{F}$ and $\\mu_{R}$.\n\nProvide your final answer as a row matrix containing, in order, the expressions for $\\mu_{F}-\\mu_{R}$ and $\\Delta F$. No numerical evaluation is required. Do not include units in your final answer.",
            "solution": "The problem is subjected to validation before proceeding to a solution.\n\n**Step 1: Extract Givens**\n- A classical system is in canonical equilibrium at inverse temperature $\\beta$ and control parameter $\\lambda_A$.\n- A forward process drives the system from $\\lambda_A$ to $\\lambda_B$ over a time $\\tau$.\n- The work performed during the forward process is a random variable $W$ with probability density $P_F(W)$.\n- A reverse process drives the system from equilibrium at $\\lambda_B$ to $\\lambda_A$ over the same time $\\tau$.\n- The reported reverse-work random variable has density $P_R(W)$.\n- The Crooks fluctuation theorem is given as:\n$$\n\\frac{P_{F}(W)}{P_{R}(W)}=\\exp(\\beta[W-\\Delta F])\n$$\nwhere $\\Delta F$ is the Helmholtz free energy difference $F(\\lambda_B) - F(\\lambda_A)$.\n- The probability densities for the forward and reverse work are assumed to be Gaussian with the same variance $\\sigma^2$:\n$$\nP_{F}(W)=\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\left(-\\frac{(W-\\mu_{F})^{2}}{2\\,\\sigma^{2}}\\right)\n$$\n$$\nP_{R}(W)=\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\left(-\\frac{(W-\\mu_{R})^{2}}{2\\,\\sigma^{2}}\\right)\n$$\nwhere $\\mu_F$ and $\\mu_R$ are the respective means.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Groundedness**: The problem is based on the Crooks fluctuation theorem, a fundamental and well-established result in non-equilibrium statistical mechanics. The assumption of Gaussian work distributions is a common and valid theoretical model, particularly relevant in the linear response regime or for systems with many degrees of freedom. The problem is scientifically sound.\n- **Well-Posedness**: The problem provides a clear set of assumptions and equations and asks for the derivation of specific quantities. The questions are precise, and a unique solution can be determined through direct algebraic manipulation.\n- **Objectivity**: The problem is stated in objective, mathematical language, free from ambiguity or subjective claims.\n- **Completeness and Consistency**: The problem is self-contained. All necessary information (the theorem, the functional forms of the distributions) is provided. There are no internal contradictions.\n\n**Step 3: Verdict and Action**\nThe problem is valid. It is a standard theoretical exercise in statistical physics. A solution will be derived.\n\nThe starting point is the Crooks fluctuation theorem:\n$$\n\\frac{P_{F}(W)}{P_{R}(W)} = \\exp(\\beta[W-\\Delta F])\n$$\nWe are given the explicit forms for $P_F(W)$ and $P_R(W)$ as Gaussian distributions. We substitute these into the left-hand side of the theorem:\n$$\n\\frac{P_{F}(W)}{P_{R}(W)} = \\frac{\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\left(-\\frac{(W-\\mu_{F})^{2}}{2\\,\\sigma^{2}}\\right)}{\\frac{1}{\\sqrt{2\\pi\\,\\sigma^{2}}}\\,\\exp\\left(-\\frac{(W-\\mu_{R})^{2}}{2\\,\\sigma^{2}}\\right)}\n$$\nThe normalization prefactors cancel out, leaving a ratio of exponential functions. This simplifies to a single exponential:\n$$\n\\frac{P_{F}(W)}{P_{R}(W)} = \\exp\\left(-\\frac{(W-\\mu_{F})^{2}}{2\\,\\sigma^{2}} + \\frac{(W-\\mu_{R})^{2}}{2\\,\\sigma^{2}}\\right) = \\exp\\left(\\frac{(W-\\mu_{R})^{2} - (W-\\mu_{F})^{2}}{2\\,\\sigma^{2}}\\right)\n$$\nWe expand the quadratic terms in the exponent:\n$$\n(W-\\mu_{R})^{2} - (W-\\mu_{F})^{2} = (W^{2} - 2W\\mu_{R} + \\mu_{R}^{2}) - (W^{2} - 2W\\mu_{F} + \\mu_{F}^{2})\n$$\nThe $W^{2}$ terms cancel, and we are left with:\n$$\n-2W\\mu_{R} + \\mu_{R}^{2} + 2W\\mu_{F} - \\mu_{F}^{2} = 2W(\\mu_{F} - \\mu_{R}) - (\\mu_{F}^{2} - \\mu_{R}^{2})\n$$\nSubstituting this back into the expression for the ratio of probabilities:\n$$\n\\frac{P_{F}(W)}{P_{R}(W)} = \\exp\\left(\\frac{2W(\\mu_{F} - \\mu_{R}) - (\\mu_{F}^{2} - \\mu_{R}^{2})}{2\\,\\sigma^{2}}\\right) = \\exp\\left(\\frac{\\mu_{F} - \\mu_{R}}{\\sigma^{2}}W - \\frac{\\mu_{F}^{2} - \\mu_{R}^{2}}{2\\,\\sigma^{2}}\\right)\n$$\nNow, we equate this result with the right-hand side of the Crooks fluctuation theorem:\n$$\n\\exp\\left(\\frac{\\mu_{F} - \\mu_{R}}{\\sigma^{2}}W - \\frac{\\mu_{F}^{2} - \\mu_{R}^{2}}{2\\,\\sigma^{2}}\\right) = \\exp(\\beta W - \\beta\\Delta F)\n$$\nFor this identity to hold for all values of the work $W$, the exponents must be equal. This requires that the coefficients of the terms linear in $W$ are equal, and the constant terms are equal.\n\n1) **Constraint on parameters**:\nBy equating the coefficients of the $W$ term in the exponents, we find the first required relationship:\n$$\n\\frac{\\mu_{F} - \\mu_{R}}{\\sigma^{2}} = \\beta\n$$\nThis can be rewritten as the constraint relating the means, variance, and inverse temperature:\n$$\n\\mu_{F} - \\mu_{R} = \\beta\\sigma^{2}\n$$\nThis result is a specific instance of a fluctuation-dissipation relation for systems with Gaussian work statistics. The difference between the mean forward and reverse works is proportional to the variance of the work fluctuations.\n\n2) **Free energy difference and crossing point**:\nNext, we equate the constant terms in the exponents:\n$$\n-\\frac{\\mu_{F}^{2} - \\mu_{R}^{2}}{2\\,\\sigma^{2}} = -\\beta\\Delta F\n$$\nSolving for the free energy difference $\\Delta F$:\n$$\n\\Delta F = \\frac{\\mu_{F}^{2} - \\mu_{R}^{2}}{2\\beta\\sigma^{2}}\n$$\nWe can simplify this expression using the result from part 1). First, we factor the numerator: $\\mu_{F}^{2} - \\mu_{R}^{2} = (\\mu_{F} - \\mu_{R})(\\mu_{F} + \\mu_{R})$. Next, we substitute $\\mu_{F} - \\mu_{R} = \\beta\\sigma^{2}$:\n$$\n\\Delta F = \\frac{(\\beta\\sigma^{2})(\\mu_{F} + \\mu_{R})}{2\\beta\\sigma^{2}}\n$$\nProvided that $\\beta \\neq 0$ and $\\sigma^{2} \\neq 0$ (which are physically necessary conditions, as infinite temperature is meaningless and zero variance would imply a deterministic process, which is not the case), we can cancel the terms $\\beta\\sigma^{2}$ from the numerator and denominator:\n$$\n\\Delta F = \\frac{\\mu_{F} + \\mu_{R}}{2}\n$$\nThe problem also asks for the crossing point $W^{\\ast}$ at which $P_{F}(W^{\\ast}) = P_{R}(W^{\\ast})$. At this point, the ratio of probabilities is unity:\n$$\n\\frac{P_{F}(W^{\\ast})}{P_{R}(W^{\\ast})} = 1\n$$\nFrom the Crooks relation, this implies:\n$$\n\\exp(\\beta[W^{\\ast}-\\Delta F]) = 1\n$$\nTaking the natural logarithm of both sides gives $\\beta(W^{\\ast}-\\Delta F) = 0$. Since $\\beta \\neq 0$, it must be that:\n$$\nW^{\\ast} = \\Delta F\n$$\nTherefore, the crossing point of the two work distributions is precisely the equilibrium free energy difference, which we have found to be the arithmetic mean of the forward and reverse average works.\n$$\nW^{\\ast} = \\frac{\\mu_{F} + \\mu_{R}}{2}\n$$\nThe final answer requires expressions for $\\mu_{F}-\\mu_{R}$ and $\\Delta F$.\n\nThe first expression is $\\mu_{F} - \\mu_{R} = \\beta\\sigma^{2}$.\nThe second expression is $\\Delta F = \\frac{\\mu_{F} + \\mu_{R}}{2}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\beta\\sigma^{2} & \\frac{\\mu_{F} + \\mu_{R}}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The ultimate test of understanding a physical theory is to see it in action, translating abstract equations into concrete results. This computational practice guides you through the process of numerically verifying the Crooks fluctuation theorem for a simple, yet non-trivial, two-state model system driven out of equilibrium. By implementing a stochastic simulation, generating work statistics for forward and reverse protocols, and analyzing the resulting data, you will witness the precise linear relationship predicted by the theorem emerge from raw stochastic trajectories .",
            "id": "2644035",
            "problem": "Consider a two-state chemical reaction network (CRN) consisting of species $A$ and $B$ connected by a single reversible reaction $A \\rightleftharpoons B$. The system is modeled as a continuous-time Markov jump process (CTMC). The energy of state $A$ is $E_A(t) \\equiv 0$, and the energy of state $B$ is $E_B(t) \\equiv \\Delta E(t)$, where the externally controlled energy difference $\\Delta E(t)$ is varied according to a prescribed protocol over a finite time interval $t \\in [0, \\tau]$. The inverse thermal energy is denoted by $\\beta \\equiv 1/(k_B T)$, where $k_B$ is the Boltzmann constant and $T$ is the temperature. Throughout, use dimensionless units in which energies are measured in $k_B T$ units and time in units of $1/k_0$ as specified below; no physical unit conversion is required.\n\nAssume local detailed balance holds at all times: the instantaneous transition rates $k_{A \\to B}(t)$ and $k_{B \\to A}(t)$ satisfy\n$$\n\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} \\;=\\; e^{-\\beta \\, \\Delta E(t)} \\, .\n$$\nFix the symmetric Arrhenius-like parametrization\n$$\nk_{A \\to B}(t) \\equiv k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E(t)} \\quad \\text{and} \\quad\nk_{B \\to A}(t) \\equiv k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E(t)} \\, ,\n$$\nwith $k_0 > 0$ a constant rate scale.\n\nFor a given trajectory $x(t) \\in \\{A,B\\}$ under a time-dependent protocol $\\Delta E(t)$ over $t \\in [0,\\tau]$, define the stochastic work performed by the protocol as the Riemann–Stieltjes integral\n$$\nW[x(\\cdot)] \\;=\\; \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\, d\\Delta E(t) \\, ,\n$$\nwhere $\\mathbf{1}_{\\{x(t)=B\\}}$ is the indicator that the system occupies state $B$ at time $t$. The equilibrium free energy at parameter value $\\Delta E$ is\n$$\nF(\\Delta E) \\;=\\; -\\frac{1}{\\beta} \\ln\\!\\big( 1 + e^{-\\beta \\Delta E} \\big) \\, ,\n$$\nand the free energy difference across a protocol from $\\Delta E(0)=\\Delta E_i$ to $\\Delta E(\\tau)=\\Delta E_f$ is $\\Delta F \\equiv F(\\Delta E_f) - F(\\Delta E_i)$.\n\nYou will numerically test the Crooks fluctuation theorem for work, which states that for a forward protocol $\\Delta E_F(t)$ and its time-reversed reverse protocol $\\Delta E_R(t) \\equiv \\Delta E_F(\\tau - t)$ (with initial ensembles drawn from the corresponding equilibria at $\\Delta E_i$ and $\\Delta E_f$, respectively), the distributions of work $P_F(W)$ and $P_R(W)$ satisfy\n$$\n\\frac{P_F(W)}{P_R(-W)} \\;=\\; e^{\\beta \\, (W - \\Delta F)} \\, .\n$$\n\nImplement a program that:\n- Simulates an ensemble of independent trajectories for both the forward and reverse protocols using exact sampling of the time-inhomogeneous jump process. For the forward protocol, use a linear ramp\n$$\n\\Delta E_F(t) \\;=\\; \\Delta E_i + \\frac{\\Delta E_f - \\Delta E_i}{\\tau} \\, t \\, ,\n$$\nand for the reverse protocol, use the time-reversed linear ramp\n$$\n\\Delta E_R(t) \\;=\\; \\Delta E_f - \\frac{\\Delta E_f - \\Delta E_i}{\\tau} \\, t \\, .\n$$\n- Draw the initial state for each trajectory from the canonical equilibrium at the protocol’s starting parameter value. That is, at parameter $\\Delta E$, the equilibrium probabilities are $p_A^{\\mathrm{eq}}(\\Delta E) = \\frac{1}{1+e^{-\\beta \\Delta E}}$ and $p_B^{\\mathrm{eq}}(\\Delta E) = \\frac{e^{-\\beta \\Delta E}}{1+e^{-\\beta \\Delta E}}$.\n- Computes the work $W$ along each trajectory using the above integral definition.\n- Estimates the work distributions $P_F(W)$ and $P_R(W)$ by histograms with a fixed number of bins $n_b$ over a common range that covers both the forward work samples and the sign-flipped reverse work samples. Use $n_b = 60$. Construct the common range from the minimum and maximum of the combined data $\\{W_F\\} \\cup \\{-W_R\\}$. If this range has negligible width (e.g., all sampled works numerically coincide), expand it to a small symmetric interval around zero to avoid degenerate histograms.\n- Compares the empirical log-ratio $\\ln\\!\\big( P_F(W) / P_R(-W) \\big)$ against the theoretical prediction $\\beta (W - \\Delta F)$ only on bins where both histograms are strictly positive, and reports whether the maximum absolute deviation over those bins is below a prescribed tolerance $\\varepsilon$.\n\nUse a fixed random seed for reproducibility. Set the seed to $12345$.\n\nYour program must implement the exact sampling of event times for this driven two-state process. For the linear protocol above, the total exit rate from each state is an exponential function of time, which permits exact inversion of the inhomogeneous waiting-time distribution. You must not assume any time-discretization approximation.\n\nTest Suite:\nSimulate the following three cases, and for each return a boolean indicating whether the Crooks relation holds within the specified tolerance. Use the same histogram settings $(n_b = 60)$ and the same deviation tolerance $\\varepsilon = 0.35$ for all cases.\n\n- Case $1$ (happy path, moderate speed):\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 0.0$, $\\Delta E_f = 4.0$, $\\tau = 8.0$, number of trajectories $N = 20000$ for both forward and reverse.\n\n- Case $2$ (fast driving):\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 0.0$, $\\Delta E_f = 4.0$, $\\tau = 0.5$, number of trajectories $N = 20000$ for both forward and reverse.\n\n- Case $3$ (boundary case, no change in parameter):\n  - $\\beta = 1.0$, $k_0 = 1.0$, $\\Delta E_i = 1.0$, $\\Delta E_f = 1.0$, $\\tau = 3.0$, number of trajectories $N = 20000$ for both forward and reverse.\n\nAnswer Specification:\n- For each case, compute a boolean indicating whether the maximum absolute deviation\n$$\n\\max_{\\text{overlapping bins}} \\left| \\ln\\!\\frac{P_F(W)}{P_R(-W)} - \\beta \\, (W - \\Delta F) \\right|\n$$\ndoes not exceed $\\varepsilon = 0.35$. If there are no overlapping bins with strictly positive densities, return the boolean value $False$ for that case.\n- The final output must be a single line containing the three boolean results as a comma-separated list enclosed in square brackets (e.g., \"[True,False,True]\").\n\nYour program must be complete and runnable as is, must not require any input, and must adhere to the seed, histogram, and tolerance specifications given above. All quantities are to be reported in the specified dimensionless units; no physical units are required.",
            "solution": "The problem as stated is subjected to validation and is found to be valid. It presents a well-defined, scientifically grounded problem in non-equilibrium statistical mechanics, specifically the numerical verification of the Crooks fluctuation theorem for a driven two-state system. All parameters, definitions, and constraints are provided, constituting a self-contained and solvable problem. The core task involves the exact stochastic simulation of a time-inhomogeneous Markov jump process, which is a standard, albeit non-trivial, procedure in computational physics.\n\nThe solution is developed in three stages: first, the derivation of the exact simulation algorithm for generating trajectories of the driven system; second, the method for computing the work performed along each trajectory; and third, the statistical procedure for testing the Crooks relation.\n\nA two-state system undergoes the reaction $A \\rightleftharpoons B$. The energies are $E_A = 0$ and $E_B = \\Delta E(t)$. The transition rates are given by the symmetric parametrization:\n$$\nk_{A \\to B}(t) = k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E(t)} \\quad \\text{and} \\quad\nk_{B \\to A}(t) = k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E(t)}\n$$\nThese rates satisfy the local detailed balance condition $\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} = e^{-\\beta \\Delta E(t)}$. The external parameter $\\Delta E(t)$ is driven linearly in time, $\\Delta E(t) = \\Delta E_{start} + v t$, where the velocity $v = (\\Delta E_{end} - \\Delta E_{start}) / \\tau$.\n\nThe core of the simulation is the generation of jump times for this time-inhomogeneous process. If the system is in a state $X$ at time $t_0$, the probability of surviving until time $t$ without a jump is $P(t) = \\exp\\left(-\\int_{t_0}^t k_{exit}(s) ds\\right)$, where $k_{exit}(s)$ is the exit rate from state $X$ at time $s$. The next jump time $t_{jump}$ can be sampled by solving for $t_{jump}$ in the equation $\\int_{t_0}^{t_{jump}} k_{exit}(s) ds = R$, where $R$ is a random variate drawn from an exponential distribution with rate $1$.\n\nFor the given linear protocol, the exit rates take the form $k_{exit}(t) = C e^{\\alpha t}$, where the constants $C$ and $\\alpha$ depend on the state.\nIf the state is $A$, the exit rate is $k_{A \\to B}(t)$. Then:\n$$\n\\alpha_A = -\\frac{\\beta v}{2} \\quad \\text{and} \\quad C_A = k_0 \\, e^{-\\frac{\\beta}{2} \\Delta E_{start}}\n$$\nIf the state is $B$, the exit rate is $k_{B \\to A}(t)$. Then:\n$$\n\\alpha_B = +\\frac{\\beta v}{2} \\quad \\text{and} \\quad C_B = k_0 \\, e^{+\\frac{\\beta}{2} \\Delta E_{start}}\n$$\nFor the non-trivial case $v \\neq 0$, and thus $\\alpha \\neq 0$, the integral is analytically tractable:\n$$\n\\int_{t_0}^{t_0 + \\Delta t} C e^{\\alpha s} ds \\;=\\; \\frac{C}{\\alpha} \\left[ e^{\\alpha(t_0+\\Delta t)} - e^{\\alpha t_0} \\right] \\;=\\; \\frac{C e^{\\alpha t_0}}{\\alpha} \\left( e^{\\alpha \\Delta t} - 1 \\right) \\;=\\; \\frac{k_{exit}(t_0)}{\\alpha} \\left( e^{\\alpha \\Delta t} - 1 \\right)\n$$\nSetting this equal to $R$ and solving for the waiting time $\\Delta t$ yields:\n$$\n\\Delta t = \\frac{1}{\\alpha} \\ln\\left(1 + \\frac{\\alpha R}{k_{exit}(t_0)}\\right)\n$$\nThis formula is valid if the argument of the logarithm is positive. If $1 + \\frac{\\alpha R}{k_{exit}(t_0)} \\le 0$, which can only occur if $\\alpha < 0$, it implies that the total integrated rate from $t_0$ to infinity converges to a value less than $R$, meaning no jump will occur. In this case, we set $\\Delta t = \\infty$. This method provides an exact sample of the waiting time. For the special case $v=0$ (and thus $\\alpha=0$), the rates are constant, and the waiting time is simply $\\Delta t = R / k_{exit}$.\n\nThe stochastic work for a linear protocol $\\Delta E(t)$ simplifies significantly. The Riemann-Stieltjes integral is:\n$$\nW = \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\, d\\Delta E(t) = \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} \\frac{d\\Delta E}{dt} dt = v \\int_{0}^{\\tau} \\mathbf{1}_{\\{x(t)=B\\}} dt\n$$\nThe work is thus the product of the protocol velocity $v$ and the total time the system spends in state $B$. This simplifies the calculation to summing the durations of all intervals where the system is in state $B$.\n\nThe verification of the Crooks relation, $\\frac{P_F(W)}{P_R(-W)} = e^{\\beta (W - \\Delta F)}$, is performed numerically. Ensembles of trajectories are generated for both the forward protocol ($\\Delta E_i \\to \\Delta E_f$) and the reverse protocol ($\\Delta E_f \\to \\Delta E_i$), starting from their respective initial equilibrium distributions. Work values $W_F$ and $W_R$ are computed for each trajectory.\n\nThe probability distributions $P_F(W)$ and $P_R(W)$ are estimated using histograms. A common set of bins is constructed over the range of the combined data $\\{W_F\\} \\cup \\{-W_R\\}$. The histogram for the reverse process is computed for the sign-flipped work values, $-W_R$. The normalized histograms provide empirical estimates for $P_F(W)$ and $P_R(-W)$ at the bin centers $W_k$.\n\nThe free energy difference is calculated as $\\Delta F = F(\\Delta E_f) - F(\\Delta E_i)$, with the free energy given by $F(\\Delta E) = -\\frac{1}{\\beta} \\ln(1 + e^{-\\beta \\Delta E})$. For each bin $k$ where both $P_F(W_k)$ and $P_R(-W_k)$ are strictly positive, the deviation is computed:\n$$\nd_k = \\left| \\ln\\left(\\frac{P_F(W_k)}{P_R(-W_k)}\\right) - \\beta (W_k - \\Delta F) \\right|\n$$\nThe maximum of these deviations, $\\max_k d_k$, is compared against the tolerance $\\varepsilon=0.35$. If this maximum deviation is within the tolerance, the theorem is considered numerically verified for that case. If no bins show overlap between the two distributions, the verification fails.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the Crooks fluctuation theorem.\n    \"\"\"\n    # Fixed parameters for all test cases\n    N_TRAJECTORIES = 20000\n    N_BINS = 60\n    TOLERANCE = 0.35\n    RANDOM_SEED = 12345\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1 (happy path, moderate speed)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 0.0, 'delta_E_f': 4.0, 'tau': 8.0},\n        # Case 2 (fast driving)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 0.0, 'delta_E_f': 4.0, 'tau': 0.5},\n        # Case 3 (boundary case, no change in parameter)\n        {'beta': 1.0, 'k0': 1.0, 'delta_E_i': 1.0, 'delta_E_f': 1.0, 'tau': 3.0},\n    ]\n\n    rng = np.random.default_rng(RANDOM_SEED)\n    results = []\n\n    for case in test_cases:\n        # Run forward and reverse simulations\n        W_F = _simulate_protocol(params=case, is_forward=True, n_traj=N_TRAJECTORIES, rng=rng)\n        W_R = _simulate_protocol(params=case, is_forward=False, n_traj=N_TRAJECTORIES, rng=rng)\n\n        # Prepare data for histogramming\n        neg_W_R = -np.array(W_R)\n        \n        # Determine common histogram range\n        combined_works = np.concatenate((W_F, neg_W_R))\n        w_min, w_max = combined_works.min(), combined_works.max()\n        \n        if w_max - w_min < 1e-9:\n             w_min, w_max = -1.0, 1.0\n        else: # Add padding to avoid issues at edges\n            padding = 0.01 * (w_max-w_min) if (w_max-w_min) > 0 else 0.1\n            w_min -= padding\n            w_max += padding\n\n        bins = np.linspace(w_min, w_max, N_BINS + 1)\n        bin_centers = (bins[:-1] + bins[1:]) / 2.0\n\n        # Create normalized histograms (probability densities)\n        P_F, _ = np.histogram(W_F, bins=bins, density=True)\n        P_R_neg, _ = np.histogram(neg_W_R, bins=bins, density=True)\n\n        # Calculate free energy difference\n        beta = case['beta']\n        delta_E_i = case['delta_E_i']\n        delta_E_f = case['delta_E_f']\n        \n        def free_energy(E, b):\n            return -1.0 / b * np.log(1.0 + np.exp(-b * E))\n            \n        delta_F = free_energy(delta_E_f, beta) - free_energy(delta_E_i, beta)\n\n        # Check Crooks relation\n        max_deviation = 0.0\n        found_overlap = False\n        \n        for i in range(N_BINS):\n            if P_F[i] > 0 and P_R_neg[i] > 0:\n                found_overlap = True\n                W_k = bin_centers[i]\n                \n                log_ratio_empirical = np.log(P_F[i] / P_R_neg[i])\n                log_ratio_theoretical = beta * (W_k - delta_F)\n                \n                deviation = np.abs(log_ratio_empirical - log_ratio_theoretical)\n                if deviation > max_deviation:\n                    max_deviation = deviation\n        \n        if not found_overlap:\n            results.append(False)\n        else:\n            results.append(max_deviation <= TOLERANCE)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef _simulate_protocol(params, is_forward, n_traj, rng):\n    \"\"\"\n    Simulates trajectories for a given protocol (forward or reverse).\n    \"\"\"\n    beta, k0, tau = params['beta'], params['k0'], params['tau']\n\n    if is_forward:\n        E_start, E_end = params['delta_E_i'], params['delta_E_f']\n    else: # Reverse protocol\n        E_start, E_end = params['delta_E_f'], params['delta_E_i']\n\n    v = (E_end - E_start) / tau if tau > 0 else 0.0\n\n    work_values = []\n    \n    for _ in range(n_traj):\n        # Initialize state from equilibrium at E_start\n        p_B_eq = np.exp(-beta * E_start) / (1.0 + np.exp(-beta * E_start))\n        state = 1 if rng.random() < p_B_eq else 0  # 0 for A, 1 for B\n        \n        current_time = 0.0\n        time_in_B = 0.0\n\n        while current_time < tau:\n            t_prev = current_time\n            \n            # Sample waiting time dt for the next jump\n            if v == 0: # Homogeneous process\n                rate_A_to_B = k0 * np.exp(-beta * E_start / 2.0)\n                rate_B_to_A = k0 * np.exp(beta * E_start / 2.0)\n                rate = rate_A_to_B if state == 0 else rate_B_to_A\n                dt = rng.exponential(1.0 / rate) if rate > 0 else np.inf\n            else: # Inhomogeneous process\n                R = rng.exponential(1.0)\n                if state == 0: # From A\n                    alpha = -beta * v / 2.0\n                    C = k0 * np.exp(-beta * E_start / 2.0)\n                else: # From B\n                    alpha = beta * v / 2.0\n                    C = k0 * np.exp(beta * E_start / 2.0)\n                \n                rate_at_t = C * np.exp(alpha * current_time)\n                \n                arg = 1.0 + alpha * R / rate_at_t\n                if arg > 0:\n                    dt = (1.0 / alpha) * np.log1p(alpha * R / rate_at_t)\n                else:\n                    dt = np.inf\n\n            t_jump = current_time + dt\n            t_final_interval = min(t_jump, tau)\n\n            if state == 1: # If in state B\n                time_in_B += t_final_interval - t_prev\n            \n            if t_jump < tau:\n                current_time = t_jump\n                state = 1 - state # Flip state\n            else:\n                current_time = tau # End of trajectory\n        \n        work = v * time_in_B\n        work_values.append(work)\n        \n    return work_values\n\nsolve()\n```"
        }
    ]
}