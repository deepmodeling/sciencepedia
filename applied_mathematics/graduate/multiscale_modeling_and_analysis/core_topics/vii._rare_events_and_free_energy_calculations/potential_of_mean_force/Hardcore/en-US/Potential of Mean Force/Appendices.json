{
    "hands_on_practices": [
        {
            "introduction": "Understanding the Potential of Mean Force (PMF) begins with its fundamental components: direct interaction energy and solvent-mediated entropic effects. This first practice provides a foundational model for the dissociation of an ion pair, allowing you to derive the PMF from first principles . By contrasting a polar solvent (water) with a nonpolar one (hexane), you will directly quantify how the dielectric environment shapes the free energy landscape of a chemical process.",
            "id": "2460705",
            "problem": "You are asked to construct a first-principles model for the potential of mean force (PMF) governing the dissociation of sodium chloride (NaCl) into sodium and chloride ions along their scalar separation coordinate in two different solvents. The aim is to quantify and contrast the PMF in liquid water and in liquid hexane at the same temperature, thereby isolating the role of the solvent.\n\nAssumptions and definitions:\n\n- Consider a pair of nonreactive point ions with fixed charges $q_1=+e$ and $q_2=-e$ at infinite dilution in a homogeneous, isotropic dielectric continuum at temperature $T$, interacting only through classical electrostatics. Neglect any ionic screening from added electrolytes, dispersion forces, and specific short-range solvation structure.\n- The canonical ensemble at temperature $T$ is assumed. The potential of mean force $W(r)$ along the interionic separation $r$ is defined, up to an additive constant, by $W(r) = -k_{\\mathrm B} T \\ln P(r)$, where $P(r)$ is the marginal equilibrium probability density of the scalar separation coordinate $r$. The marginal density $P(r)$ reflects both the Boltzmann weight of the interaction energy and the three-dimensional measure associated with spherical coordinates.\n- For a uniform dielectric medium with relative permittivity $\\varepsilon_r$, the classical electrostatic interaction energy between two point charges separated by a distance $r$ is $U(r) = \\dfrac{q_1 q_2}{4 \\pi \\varepsilon_0 \\varepsilon_r \\, r}$.\n- Report a relative potential of mean force $\\Delta W(r) = W(r) - W(r_{\\mathrm{ref}})$ with the reference separation $r_{\\mathrm{ref}}$ specified below. This removes any additive constant.\n\nConstants and parameters (use these exact values and units):\n\n- Elementary charge: $e = 1.602176634 \\times 10^{-19}$ coulomb.\n- Vacuum permittivity: $\\varepsilon_0 = 8.8541878128 \\times 10^{-12}$ farad meter$^{-1}$.\n- Boltzmann constant: $k_{\\mathrm B} = 1.380649 \\times 10^{-23}$ joule kelvin$^{-1}$.\n- Avogadro constant: $N_{\\mathrm A} = 6.02214076 \\times 10^{23}$ mole$^{-1}$.\n- Temperature: $T = 298.15$ kelvin.\n- Relative permittivity of liquid water at $T$: $\\varepsilon_r^{\\mathrm{(water)}} = 78.37$.\n- Relative permittivity of liquid hexane at $T$: $\\varepsilon_r^{\\mathrm{(hexane)}} = 1.89$.\n\nTest suite:\n\n- Interionic separations $r$ to be evaluated: $\\{0.28, 0.50, 1.00, 2.00\\}$ nanometers.\n- Reference separation: $r_{\\mathrm{ref}} = 2.00$ nanometers.\n- Solvents to be evaluated: water with $\\varepsilon_r^{\\mathrm{(water)}}$, hexane with $\\varepsilon_r^{\\mathrm{(hexane)}}$.\n\nRequired outputs:\n\n- For each solvent and each specified separation $r$, compute the relative PMF $\\Delta W(r)$ expressed in kilojoules per mole. Express each number rounded to three decimal places. The natural logarithm must be used, and angles are not involved.\n- The final output must be a single line containing a comma-separated list enclosed in square brackets. The list must contain the values in the following order:\n  - First, for water at $r = 0.28$, $0.50$, $1.00$, $2.00$ nanometers (in this order),\n  - then, for hexane at $r = 0.28$, $0.50$, $1.00$, $2.00$ nanometers (in this order).\n  That is, the output must be of the form\n  $[\\Delta W_{\\mathrm{water}}(0.28\\,\\mathrm{nm}), \\Delta W_{\\mathrm{water}}(0.50\\,\\mathrm{nm}), \\Delta W_{\\mathrm{water}}(1.00\\,\\mathrm{nm}), \\Delta W_{\\mathrm{water}}(2.00\\,\\mathrm{nm}), \\Delta W_{\\mathrm{hexane}}(0.28\\,\\mathrm{nm}), \\Delta W_{\\mathrm{hexane}}(0.50\\,\\mathrm{nm}), \\Delta W_{\\mathrm{hexane}}(1.00\\,\\mathrm{nm}), \\Delta W_{\\mathrm{hexane}}(2.00\\,\\mathrm{nm})]$,\n  where each entry is in kilojoules per mole, rounded to three decimal places.\n\nAll quantities depending on $r$ must be computed using $r$ in meters when inserted into physical formulas. Ensure that the ratio $r/r_{\\mathrm{ref}}$ used inside any logarithm is dimensionless. Express the final answers in kilojoules per mole, rounded to three decimal places, as specified above.",
            "solution": "The problem statement has been critically examined and is found to be valid. It presents a standard, well-posed problem in statistical thermodynamics, free from scientific inconsistencies or logical flaws. We shall proceed with the derivation and solution.\n\nThe central quantity is the potential of mean force (PMF), $W(r)$, which describes the effective potential between two ions as a function of their scalar separation, $r$. It is defined via the marginal probability density $P(r)$ of finding the ions at a separation $r$. In the canonical ensemble at temperature $T$, this relationship is given by:\n$$W(r) = -k_{\\mathrm B} T \\ln P(r)$$\nwhere $k_{\\mathrm B}$ is the Boltzmann constant. $W(r)$ is defined up to an arbitrary additive constant, which is resolved by considering a relative PMF.\n\nThe probability density $P(r)$ must account for two factors: the energetic interaction between the ions and the volume of phase space available at a given separation. For two ions in three-dimensional space, where one ion is fixed at the origin, the probability of finding the second ion in an infinitesimal volume element $d\\mathbf{r}$ is proportional to the Boltzmann factor, $\\exp(-U(|\\mathbf{r}|)/k_{\\mathrm{B}}T)$, where $U(r)$ is the pair interaction energy.\n\nTo find the marginal probability $P(r)$ for the scalar separation $r$, we must integrate over all orientations at a fixed distance $r$. This corresponds to integrating over the surface of a sphere of radius $r$. The volume element in spherical coordinates is $r^2 \\sin\\theta \\, dr \\, d\\theta \\, d\\phi$. Integrating over the solid angle $\\Omega$ yields a geometric factor of $4\\pi r^2$. Thus, the marginal probability density is proportional to:\n$$P(r) \\propto 4\\pi r^2 \\exp\\left(-\\frac{U(r)}{k_{\\mathrm B} T}\\right)$$\n\nSubstituting this into the definition of $W(r)$:\n$$W(r) = -k_{\\mathrm B} T \\ln\\left[C_0 \\cdot 4\\pi r^2 \\exp\\left(-\\frac{U(r)}{k_{\\mathrm B} T}\\right)\\right]$$\nwhere $C_0$ is a normalization constant. Using the properties of the logarithm, we can separate the terms:\n$$W(r) = -k_{\\mathrm B} T \\left[\\ln(4\\pi C_0) + \\ln(r^2) - \\frac{U(r)}{k_{\\mathrm B} T}\\right]$$\n$$W(r) = U(r) - 2 k_{\\mathrm B} T \\ln r + C_1$$\nHere, $C_1 = -k_{\\mathrm B} T \\ln(4\\pi C_0)$ is a constant. This expression reveals that the PMF consists of two $r$-dependent parts: the direct interaction energy $U(r)$ and an entropic term $-2 k_{\\mathrm B} T \\ln r$, which arises from the larger phase space volume available at greater separations.\n\nThe problem requires the relative PMF, $\\Delta W(r) = W(r) - W(r_{\\mathrm{ref}})$, which eliminates the unknown constant $C_1$:\n$$\\Delta W(r) = \\left(U(r) - 2 k_{\\mathrm B} T \\ln r\\right) - \\left(U(r_{\\mathrm{ref}}) - 2 k_{\\mathrm B} T \\ln r_{\\mathrm{ref}}\\right)$$\n$$\\Delta W(r) = \\left(U(r) - U(r_{\\mathrm{ref}})\\right) - 2 k_{\\mathrm B} T \\left( \\ln r - \\ln r_{\\mathrm{ref}} \\right)$$\n$$\\Delta W(r) = U(r) - U(r_{\\mathrm{ref}}) - 2 k_{\\mathrm B} T \\ln\\left(\\frac{r}{r_{\\mathrm{ref}}}\\right)$$\n\nThe interaction energy $U(r)$ for two point charges $q_1 = +e$ and $q_2 = -e$ in a dielectric continuum with relative permittivity $\\varepsilon_r$ is given by Coulomb's law:\n$$U(r) = \\frac{q_1 q_2}{4 \\pi \\varepsilon_0 \\varepsilon_r r} = -\\frac{e^2}{4 \\pi \\varepsilon_0 \\varepsilon_r r}$$\nwhere $\\varepsilon_0$ is the vacuum permittivity and $e$ is the elementary charge.\n\nSubstituting this into the expression for $\\Delta W(r)$, we obtain the final formula for calculation:\n$$\\Delta W(r) = -\\frac{e^2}{4 \\pi \\varepsilon_0 \\varepsilon_r} \\left(\\frac{1}{r} - \\frac{1}{r_{\\mathrm{ref}}}\\right) - 2 k_{\\mathrm B} T \\ln\\left(\\frac{r}{r_{\\mathrm{ref}}}\\right)$$\nThis gives the relative PMF in Joules for a single ion pair. To express this quantity in kilojoules per mole, as required, we multiply by the Avogadro constant $N_{\\mathrm A}$ and a conversion factor of $10^{-3}$:\n$$\\Delta W_{\\text{kJ/mol}}(r) = \\Delta W(r) \\times N_{\\mathrm A} \\times 10^{-3}$$\n\nThe computational procedure is to implement this formula using the provided physical constants and parameters. All calculations involving physical formulas must use SI units (meters for distance). The parameters are:\n- Temperature: $T = 298.15$ K.\n- Reference separation: $r_{\\mathrm{ref}} = 2.00 \\times 10^{-9}$ m.\n- Solvents: water ($\\varepsilon_r^{\\mathrm{(water)}} = 78.37$) and hexane ($\\varepsilon_r^{\\mathrm{(hexane)}} = 1.89$).\n- Evaluation separations $r$: $\\{0.28, 0.50, 1.00, 2.00\\}$ nanometers.\n\nThe code will iterate through the two solvents and the four specified separations for each, calculate $\\Delta W_{\\text{kJ/mol}}(r)$, and report the values rounded to three decimal places in the specified order. The case $r = r_{\\mathrm{ref}}$ trivially yields $\\Delta W(r_{\\mathrm{ref}}) = 0$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs a model for the potential of mean force (PMF) governing NaCl \n    dissociation and computes it for water and hexane.\n    \"\"\"\n    # Define physical constants in SI units as provided.\n    E_CHARGE = 1.602176634e-19  # Elementary charge in Coulombs\n    EPSILON_0 = 8.8541878128e-12 # Vacuum permittivity in F/m\n    K_BOLTZMANN = 1.380649e-23   # Boltzmann constant in J/K\n    N_AVOGADRO = 6.02214076e23    # Avogadro constant in 1/mol\n    \n    # Define problem parameters.\n    TEMPERATURE = 298.15  # Temperature in Kelvin\n    \n    # Define solvent properties.\n    solvents = {\n        \"water\": 78.37,\n        \"hexane\": 1.89,\n    }\n    \n    # Define test suite parameters from the problem statement.\n    r_separations_nm = [0.28, 0.50, 1.00, 2.00]  # Interionic separations in nanometers\n    r_ref_nm = 2.00  # Reference separation in nanometers\n\n    # Convert separation distances to SI units (meters).\n    r_separations_m = [r * 1e-9 for r in r_separations_nm]\n    r_ref_m = r_ref_nm * 1e-9\n\n    results = []\n    \n    # The calculation is performed first for water, then for hexane.\n    solvent_order = [\"water\", \"hexane\"]\n\n    for solvent_name in solvent_order:\n        eps_r = solvents[solvent_name]\n        \n        for r_m in r_separations_m:\n            # The PMF relative to r_ref is zero at r_ref itself.\n            if r_m == r_ref_m:\n                delta_W_kj_per_mol = 0.0\n            else:\n                # Calculate the potential energy term U(r) - U(r_ref).\n                # This is the coulombic interaction part of the PMF.\n                u_term = (-E_CHARGE**2) / (4 * np.pi * EPSILON_0 * eps_r) * (1/r_m - 1/r_ref_m)\n                \n                # Calculate the entropic term -2*kB*T*ln(r/r_ref).\n                # This arises from the r^2 factor in the spherical volume element.\n                entropic_term = -2 * K_BOLTZMANN * TEMPERATURE * np.log(r_m / r_ref_m)\n                \n                # The total relative PMF in Joules per ion pair.\n                delta_W_j_per_pair = u_term + entropic_term\n                \n                # Convert the result to kilojoules per mole.\n                delta_W_kj_per_mol = delta_W_j_per_pair * N_AVOGADRO * 1e-3\n            \n            results.append(delta_W_kj_per_mol)\n\n    # Format the final list of results into the specified string format.\n    # Each value is formatted to three decimal places.\n    output_str = \"[\" + \",\".join([f\"{res:.3f}\" for res in results]) + \"]\"\n    \n    # Final print statement in the exact required format.\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Calculating a PMF accurately and efficiently using methods like umbrella sampling requires careful setup of simulation parameters. This exercise focuses on one of the most critical parameters: the harmonic spring constant, $k$, used to restrain the system in different windows . By analytically investigating its impact on the statistical overlap between adjacent windows, you will develop a quantitative intuition for how to design robust and efficient free energy calculations, a crucial skill for any computational scientist.",
            "id": "2460733",
            "problem": "You are to write a complete program that quantitatively examines how varying the harmonic spring constant $k$ in umbrella sampling affects (i) the statistical overlap between adjacent windows and (ii) a simple proxy for computational efficiency defined as the minimum number of evenly spaced windows required to ensure a specified target overlap. The system is a one-dimensional reaction coordinate $x$ with a known underlying Potential of Mean Force (PMF), sampled with harmonic umbrella potentials at absolute temperature $T$.\n\nSystem definition:\n- Underlying PMF: $U_{0}(x) = \\tfrac{1}{2}\\,k_{0}\\,(x - x_{c})^{2}$ in kJ/mol, with $k_{0} = 25$ kJ/(mol·nm$^{2}$) and $x_{c} = 0.5$ nm.\n- Umbrella potential in window $i$: $U_{b}^{(i)}(x) = \\tfrac{1}{2}\\,k\\,(x - x_{0}^{(i)})^{2}$ in kJ/mol, where $k$ is the spring constant (to be varied) in kJ/(mol·nm$^{2}$).\n- Canonical ensemble at temperature $T = 300$ K with Boltzmann constant $k_{\\mathrm{B}} = 0.008314462618$ kJ/(mol·K), so $\\beta = 1/(k_{\\mathrm{B}} T)$ in (mol/kJ).\n- Reaction coordinate domain for window placement: the interval $[0, L]$ with $L = 1.0$ nm.\n\nStatistical overlap metric:\n- For each umbrella window $i$, define the normalized canonical distribution at temperature $T$ for the biased potential $U_{0}(x) + U_{b}^{(i)}(x)$:\n$$\np_{i}(x) = \\frac{\\exp\\!\\left(-\\beta\\,[U_{0}(x) + U_{b}^{(i)}(x)]\\right)}{\\int_{-\\infty}^{\\infty}\\exp\\!\\left(-\\beta\\,[U_{0}(x) + U_{b}^{(i)}(x)]\\right)\\,dx}.\n$$\n- The statistical overlap between adjacent windows $i$ and $i+1$ is defined via the Bhattacharyya coefficient\n$$\nB_{i,i+1} = \\int_{-\\infty}^{\\infty} \\sqrt{\\,p_{i}(x)\\,p_{i+1}(x)\\,}\\;dx,\n$$\nwhich is a dimensionless quantity in $[0,1]$. Higher values indicate greater overlap.\n\nEfficiency proxy:\n- For a given target minimum overlap $B_{\\min}$ (dimensionless), define $N_{\\mathrm{req}}(k)$ as the smallest integer number of evenly spaced windows on $[0, L]$ whose adjacent-window overlaps are all at least $B_{\\min}$.\n\nProgram tasks and required outputs:\n1) Fix $N_{\\mathrm{fix}} = 5$ evenly spaced umbrella window centers $x_{0}^{(i)}$ over $[0,L]$ and, for each given $k$, compute the average adjacent-window overlap\n$$\n\\overline{B}(k) = \\frac{1}{N_{\\mathrm{fix}}-1}\\sum_{i=1}^{N_{\\mathrm{fix}}-1} B_{i,i+1}.\n$$\nReport $\\overline{B}(k)$ rounded to six decimal places (dimensionless).\n2) For each given $k$, with the same system parameters, compute the minimum required number of windows $N_{\\mathrm{req}}(k)$ so that every adjacent pair on $[0,L]$ achieves at least the target overlap $B_{\\min} = 0.3$ (dimensionless). Report $N_{\\mathrm{req}}(k)$ as an integer.\n\nTest suite:\n- Use the following three spring constants $k$ (in kJ/(mol·nm$^{2}$)): $k \\in \\{1.0, 10.0, 200.0\\}$.\n- Use $k_{0} = 25.0$ kJ/(mol·nm$^{2}$), $x_{c} = 0.5$ nm, $L = 1.0$ nm, $T = 300.0$ K, $k_{\\mathrm{B}} = 0.008314462618$ kJ/(mol·K), $N_{\\mathrm{fix}} = 5$, and $B_{\\min} = 0.3$ as specified above.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each $k$ in the order given above, output a two-element list $[\\overline{B}(k), N_{\\mathrm{req}}(k)]$, where $\\overline{B}(k)$ is rounded to six decimal places and $N_{\\mathrm{req}}(k)$ is an integer. For example, an output with three cases must look like\n$[[\\overline{B}(k_{1}),N_{\\mathrm{req}}(k_{1})],[\\overline{B}(k_{2}),N_{\\mathrm{req}}(k_{2})],[\\overline{B}(k_{3}),N_{\\mathrm{req}}(k_{3})]]$\non a single line.",
            "solution": "The problem is subjected to validation and is deemed valid. It is scientifically grounded, well-posed, objective, and contains all necessary information for a unique and meaningful solution. The analysis proceeds as follows.\n\nThe core of the problem is to compute the statistical overlap between probability distributions arising from adjacent umbrella sampling windows. The total potential energy in window $i$, centered at $x_{0}^{(i)}$, is the sum of the underlying Potential of Mean Force (PMF) $U_{0}(x)$ and the harmonic biasing potential $U_{b}^{(i)}(x)$:\n$$\nU_{i}(x) = U_{0}(x) + U_{b}^{(i)}(x) = \\frac{1}{2} k_{0} (x - x_{c})^{2} + \\frac{1}{2} k (x - x_{0}^{(i)})^{2}\n$$\nThis is a quadratic function of the reaction coordinate $x$. In the canonical ensemble, the probability distribution of $x$ is given by $p_{i}(x) \\propto \\exp(-\\beta U_{i}(x))$, where $\\beta = 1/(k_{\\mathrm{B}} T)$. Since $U_{i}(x)$ is quadratic in $x$, the resulting distribution $p_{i}(x)$ is a Gaussian (normal) distribution.\n\nTo determine the parameters of this Gaussian distribution, we complete the square for $U_{i}(x)$:\n$$\n\\begin{aligned}\nU_{i}(x) &= \\frac{1}{2} [k_{0}(x^2 - 2xx_{c} + x_{c}^2) + k(x^2 - 2xx_{0}^{(i)} + (x_{0}^{(i)})^2)] \\\\\n&= \\frac{1}{2} [(k_{0}+k)x^2 - 2(k_{0}x_{c} + kx_{0}^{(i)})x + (k_{0}x_{c}^2 + k(x_{0}^{(i)})^2)]\n\\end{aligned}\n$$\nThis can be written in the standard form $\\frac{1}{2}K(x-\\mu)^2 + C$. By comparing coefficients, we identify the effective spring constant $K = k_{0} + k$ and the mean of the distribution $\\mu_{i}$:\n$$\n\\mu_{i} = \\frac{k_{0}x_{c} + kx_{0}^{(i)}}{k_{0} + k}\n$$\nThe probability distribution for window $i$ is $p_{i}(x) \\propto \\exp(-\\beta \\frac{1}{2}(k_{0}+k)(x-\\mu_{i})^2)$. Comparing the exponent to the standard form of a Gaussian, $-\\frac{(x-\\mu)^2}{2\\sigma^2}$, we find the variance $\\sigma_{i}^2$:\n$$\n\\frac{1}{2\\sigma_{i}^2} = \\frac{\\beta(k_{0}+k)}{2} \\implies \\sigma_{i}^2 = \\frac{1}{\\beta(k_{0}+k)}\n$$\nNote that the variance, let us call it $\\sigma^2$, is independent of the window index $i$; it is the same for all windows given a fixed spring constant $k$. So, $p_{i}(x)$ is a normal distribution $\\mathcal{N}(x; \\mu_{i}, \\sigma^2)$.\n\nThe statistical overlap between adjacent windows $i$ and $i+1$ is given by the Bhattacharyya coefficient, $B_{i,i+1} = \\int_{-\\infty}^{\\infty} \\sqrt{p_{i}(x)p_{i+1}(x)} dx$. For two Gaussian distributions with means $\\mu_{i}$, $\\mu_{i+1}$ and a common variance $\\sigma^2$, this integral has a known analytical solution:\n$$\nB_{i,i+1} = \\exp\\left(-\\frac{(\\mu_{i} - \\mu_{i+1})^2}{8\\sigma^2}\\right)\n$$\nWe need to evaluate the difference in the means for adjacent windows. Let $\\Delta x_{0} = x_{0}^{(i+1)} - x_{0}^{(i)}$ be the spacing between adjacent window centers.\n$$\n\\mu_{i} - \\mu_{i+1} = \\frac{k_{0}x_{c} + kx_{0}^{(i)}}{k_{0} + k} - \\frac{k_{0}x_{c} + kx_{0}^{(i+1)}}{k_{0} + k} = \\frac{k(x_{0}^{(i)} - x_{0}^{(i+1)})}{k_{0} + k} = -\\frac{k\\,\\Delta x_{0}}{k_{0} + k}\n$$\nSubstituting this and the expression for $\\sigma^2$ into the formula for $B_{i,i+1}$:\n$$\nB_{i,i+1} = \\exp\\left(-\\frac{\\left(-\\frac{k\\,\\Delta x_{0}}{k_{0} + k}\\right)^2}{8 \\left(\\frac{1}{\\beta(k_{0}+k)}\\right)}\\right) = \\exp\\left(-\\frac{k^2 (\\Delta x_{0})^2}{(k_{0} + k)^2} \\frac{\\beta(k_{0}+k)}{8}\\right)\n$$\nThis simplifies to the final expression for the overlap, which depends on $k$ and $\\Delta x_{0}$:\n$$\nB_{i,i+1} = \\exp\\left(- \\frac{\\beta k^2 (\\Delta x_{0})^2}{8(k_{0} + k)}\\right)\n$$\nSince window centers are evenly spaced, $\\Delta x_{0}$ is constant for all adjacent pairs $i, i+1$, and thus $B_{i,i+1}$ is also constant for a given $k$ and number of windows.\n\n**Task 1: Compute the average overlap $\\overline{B}(k)$**\nFor a fixed number of windows $N_{\\mathrm{fix}}=5$ on the interval $[0, L]$, the centers are $x_0^{(i)} = \\frac{i-1}{N_{\\mathrm{fix}}-1}L$ for $i=1, \\dots, 5$. The spacing is constant: $\\Delta x_{0} = L/(N_{\\mathrm{fix}}-1)$. Since all adjacent-pair overlaps $B_{i,i+1}$ are equal, the average overlap $\\overline{B}(k)$ is simply equal to this common value.\n$$\n\\overline{B}(k) = B_{i,i+1} = \\exp\\left(- \\frac{\\beta k^2 (L/(N_{\\mathrm{fix}}-1))^2}{8(k_{0} + k)}\\right)\n$$\n\n**Task 2: Compute the required number of windows $N_{\\mathrm{req}}(k)$**\nWe need to find the minimum integer $N \\geq 2$ such that the overlap for adjacent windows is at least $B_{\\min}=0.3$. For $N$ evenly spaced windows, the spacing is $\\Delta x_{0} = L/(N-1)$. The condition is:\n$$\n\\exp\\left(- \\frac{\\beta k^2 (L/(N-1))^2}{8(k_{0} + k)}\\right) \\geq B_{\\min}\n$$\nSolving for $N$:\n$$\n- \\frac{\\beta k^2 L^2}{8(k_{0} + k)(N-1)^2} \\geq \\ln(B_{\\min})\n$$\nSince $B_{\\min} < 1$, $\\ln(B_{\\min})$ is negative. Multiplying by $-1$ reverses the inequality:\n$$\n\\frac{\\beta k^2 L^2}{8(k_{0} + k)(N-1)^2} \\leq -\\ln(B_{\\min})\n$$\nIsolating $(N-1)^2$:\n$$\n(N-1)^2 \\geq \\frac{\\beta k^2 L^2}{8(k_{0} + k) [-\\ln(B_{\\min})]}\n$$\nSince $N \\geq 2$, $N-1$ is positive, so we can take the square root:\n$$\nN-1 \\geq \\sqrt{\\frac{\\beta k^2 L^2}{8(k_{0} + k) [-\\ln(B_{\\min})]}} = \\frac{kL\\sqrt{\\beta}}{\\sqrt{8(k_{0} + k) [-\\ln(B_{\\min})]}}\n$$\n$$\nN \\geq 1 + \\frac{kL\\sqrt{\\beta}}{\\sqrt{8(k_{0} + k) [-\\ln(B_{\\min})]}}\n$$\nSince $N$ must be an integer, $N_{\\mathrm{req}}(k)$ is the ceiling of the right-hand side.\n$$\nN_{\\mathrm{req}}(k) = \\left\\lceil 1 + \\frac{kL\\sqrt{\\beta}}{\\sqrt{8(k_{0} + k) [-\\ln(B_{\\min})]}} \\right\\rceil\n$$\nThese derived analytical expressions are implemented in the provided program to compute the required values for the given test suite of spring constants $k \\in \\{1.0, 10.0, 200.0\\}$ kJ/(mol·nm$^2$), using $k_0 = 25.0$ kJ/(mol·nm$^2$), $L=1.0$ nm, $T=300.0$ K, $k_{\\mathrm{B}} = 0.008314462618$ kJ/(mol·K), $N_{\\mathrm{fix}}=5$, and $B_{\\min} = 0.3$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes overlap metrics for umbrella sampling based on an analytical model.\n    \"\"\"\n    \n    # Define constants from the problem statement.\n    k0 = 25.0  # kJ/(mol·nm^2)\n    L = 1.0  # nm\n    T = 300.0  # K\n    kB = 0.008314462618  # kJ/(mol·K)\n    beta = 1.0 / (kB * T)  # mol/kJ\n    N_fix = 5  # Fixed number of windows for task 1\n    B_min = 0.3  # Target minimum overlap for task 2\n\n    # Test cases for the harmonic spring constant k in kJ/(mol·nm^2)\n    test_cases_k = [1.0, 10.0, 200.0]\n\n    def calculate_average_overlap(k):\n        \"\"\"\n        Task 1: Computes the average adjacent-window overlap for N_fix=5 windows.\n        \n        Args:\n            k (float): The umbrella spring constant in kJ/(mol·nm^2).\n        \n        Returns:\n            float: The average Bhattacharyya coefficient.\n        \"\"\"\n        if N_fix < 2:\n            # Overlap is not defined for less than 2 windows.\n            return 0.0\n            \n        delta_x0 = L / (N_fix - 1)\n        \n        # Argument of the exponential function for the Bhattacharyya coefficient\n        exponent_arg = -(beta * k**2 * delta_x0**2) / (8 * (k0 + k))\n        \n        # For evenly spaced windows, the average overlap is equal to any single\n        # adjacent-pair overlap.\n        b_avg = np.exp(exponent_arg)\n        \n        return b_avg\n\n    def calculate_required_windows(k):\n        \"\"\"\n        Task 2: Computes the minimum number of windows to ensure overlap >= B_min.\n\n        Args:\n            k (float): The umbrella spring constant in kJ/(mol·nm^2).\n\n        Returns:\n            int: The minimum required number of windows.\n        \"\"\"\n        if B_min <= 0 or B_min > 1:\n            raise ValueError(\"B_min must be in (0, 1].\")\n        \n        # If the overlap condition is trivially met (B_min=1), it would require\n        # infinite windows unless k=0, which is not a tested case. Return based on formula.\n        # But here B_min=0.3 so -log(B_min) is well-defined and positive.\n\n        # Term under the square root in the derived formula for N\n        radicand = (beta * k**2 * L**2) / (8 * (k0 + k) * (-np.log(B_min)))\n        \n        # The minimum (non-integer) number of windows required\n        n_float = 1.0 + np.sqrt(radicand)\n        \n        # The number of windows must be an integer, so we take the ceiling.\n        # The formula inherently ensures N>=2 since k>0 and sqrt term is positive.\n        n_req = int(np.ceil(n_float))\n        \n        return n_req\n\n    results = []\n    for k in test_cases_k:\n        b_bar = calculate_average_overlap(k)\n        n_req = calculate_required_windows(k)\n        results.append((b_bar, n_req))\n\n    # Format the output as specified: [[B(k1),N_req(k1)],[B(k2),N_req(k2)],...]\n    # Using f-string formatting to control decimal places and structure.\n    output_parts = [f\"[{res[0]:.6f},{res[1]}]\" for res in results]\n    final_output = f\"[{','.join(output_parts)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "This advanced practice integrates key techniques to tackle a realistic problem in computational chemical biology: determining the binding free energy of a ligand to a receptor. You will implement a full workflow, starting from the generation of synthetic umbrella sampling data, applying the powerful Weighted Histogram Analysis Method (WHAM) to reconstruct the unbiased PMF, and accounting for crucial geometric and standard-state corrections . Completing this exercise will solidify your understanding of how to turn raw simulation data into a physically meaningful and experimentally relevant thermodynamic quantity.",
            "id": "3838259",
            "problem": "You are asked to design a computational protocol to estimate a ligand–receptor binding potential of mean force (PMF) along a scalar radial separation coordinate using umbrella sampling combined with the Weighted Histogram Analysis Method (WHAM). The ligand–receptor separation is a scalar coordinate $r$ measured in nanometers. The radial measure in three-dimensional space introduces a Jacobian factor $4\\pi r^2$ that must be explicitly accounted for in the PMF. The ultimate goal is to compute the standard-state binding free energy.\n\nStart from the following fundamental bases:\n\n- The canonical ensemble Boltzmann distribution for a coordinate $x$ with energy $U(x)$ states that the probability density is proportional to $\\exp(-\\beta U(x))$, where $\\beta = 1/(k_\\mathrm{B} T)$, $k_\\mathrm{B}$ is the Boltzmann constant, and $T$ is the temperature.\n- The probability density for a three-dimensional radial coordinate $r$ (with no angular bias) has a measure factor $4\\pi r^2$, so the probability density with respect to the scalar $r$ is proportional to $4\\pi r^2 \\exp(-\\beta G(r))$ when $G(r)$ is the PMF excluding the geometric entropic term.\n- Umbrella sampling applies a harmonic bias in window $i$: $U_i^\\mathrm{bias}(r) = \\tfrac{1}{2} k_i (r - r_i)^2$ with force constant $k_i$ and center $r_i$.\n- The Weighted Histogram Analysis Method (WHAM) combines biased histograms from multiple windows into a single unbiased distribution by enforcing self-consistency between the global distribution and window normalizations.\n\nYour program must:\n\n1. Construct synthetic umbrella sampling histograms for each window by sampling from a known underlying PMF $G_\\mathrm{true}(r)$ (to make the problem self-contained and testable). The synthetic PMF to be used for data generation in all test cases is a Morse-type function\n   $$G_\\mathrm{true}(r) = D\\left(\\exp\\big(-2 a (r - r_0)\\big) - 2 \\exp\\big(-a (r - r_0)\\big)\\right),$$\n   where $D$ is the depth parameter in $\\mathrm{kJ/mol}$, $a$ is the range parameter in $\\mathrm{nm}^{-1}$, and $r_0$ is the minimum location in $\\mathrm{nm}$. The temperature must be $T = 300$ $\\mathrm{K}$, and the Boltzmann constant must be $k_\\mathrm{B} = 0.008314462618$ $\\mathrm{kJ/(mol\\cdot K)}$, so that $\\beta$ is in units of $(\\mathrm{kJ/mol})^{-1}$. The grid for $r$ must be uniform, with $r_\\mathrm{min} = 0.05$ $\\mathrm{nm}$, $r_\\mathrm{max} = 1.50$ $\\mathrm{nm}$, and bin width $\\Delta r = 0.01$ $\\mathrm{nm}$.\n\n2. For each window $i$ and each bin centered at $r_j$, construct the expected biased histogram counts using the biased radial probability density proportional to $4\\pi r_j^2 \\exp\\big(-\\beta\\big(G_\\mathrm{true}(r_j) + U_i^\\mathrm{bias}(r_j)\\big)\\big)$, normalized over the grid so that the total counts in window $i$ equal the specified per-window sample size $N_i$.\n\n3. Implement the Weighted Histogram Analysis Method (WHAM) to iteratively recover the global unbiased probability density $\\hat{p}(r)$ over the grid from the set of window histograms and their harmonic biases. Do not use any shortcut formulas. Derive the update rules from the principles above:\n   - The unbiased distribution must be consistent with the sum of window histograms weighted by the inverse of the bias-induced reweighting factors and window normalizations.\n   - The per-window normalization constants must be updated so that the global distribution reweights back to each window’s biased ensemble normalization.\n\n   Iterate until convergence of the window free energies to a tight tolerance such that the maximum change in all window normalizations between iterations is less than $10^{-10}$ in energy units.\n\n4. Convert the unbiased scalar probability density $\\hat{p}(r)$ into the PMF $G(r)$ that excludes the Jacobian by incorporating the $4\\pi r^2$ factor explicitly. The PMF must be shifted so that it approaches zero in the bulk region, defined here as the high-$r$ tail. Use a bulk range of $r \\in [1.30, 1.50]$ $\\mathrm{nm}$ and enforce that the mean of $G(r)$ over this range is zero.\n\n5. Compute the standard-state binding free energy $\\Delta G_\\mathrm{bind}^\\circ$ by integrating the association constant over a bound region $[0, r_c]$:\n   - Compute the radial association constant $K = \\int_0^{r_c} \\exp\\big(-\\beta G(r)\\big)\\,4\\pi r^2\\,dr$ in $\\mathrm{nm}^3$.\n   - Convert to a dimensionless standard-state equilibrium constant using the standard-state volume $V^\\circ = 1.66053906660$ $\\mathrm{nm}^3$ at $1$ $\\mathrm{M}$: $K^\\circ = K / V^\\circ$.\n   - Report the binding free energy $\\Delta G_\\mathrm{bind}^\\circ = -\\beta^{-1} \\ln K^\\circ$ in $\\mathrm{kJ/mol}$.\n\nYour program must implement the above steps and produce results for the following test suite. For each case, use the specified window set, underlying PMF parameters, per-window counts, and bound-region cutoff $r_c$. Umbrella windows have centers $r_i$ uniformly spaced as specified and identical force constants $k_i$ within each case:\n\n- Test Case $1$ (general case):\n  - Window centers: $r_i \\in \\{0.20, 0.30, 0.40, \\dots, 1.20\\}$ $\\mathrm{nm}$ with step $0.10$ $\\mathrm{nm}$.\n  - Force constant: $k_i = 1200$ $\\mathrm{kJ/(mol\\cdot nm^2)}$.\n  - Per-window counts: $N_i = 50000$.\n  - Underlying PMF parameters: $D = 10$ $\\mathrm{kJ/mol}$, $a = 15$ $\\mathrm{nm}^{-1}$, $r_0 = 0.30$ $\\mathrm{nm}$.\n  - Bound-region cutoff: $r_c = 0.45$ $\\mathrm{nm}$.\n\n- Test Case $2$ (weak binding edge case):\n  - Window centers: $r_i \\in \\{0.20, 0.30, 0.40, \\dots, 1.20\\}$ $\\mathrm{nm}$ with step $0.10$ $\\mathrm{nm}$.\n  - Force constant: $k_i = 900$ $\\mathrm{kJ/(mol\\cdot nm^2)}$.\n  - Per-window counts: $N_i = 30000$.\n  - Underlying PMF parameters: $D = 4$ $\\mathrm{kJ/mol}$, $a = 12$ $\\mathrm{nm}^{-1}$, $r_0 = 0.32$ $\\mathrm{nm}$.\n  - Bound-region cutoff: $r_c = 0.45$ $\\mathrm{nm}$.\n\n- Test Case $3$ (strong binding, broader coverage):\n  - Window centers: $r_i \\in \\{0.15, 0.25, 0.35, \\dots, 1.35\\}$ $\\mathrm{nm}$ with step $0.10$ $\\mathrm{nm}$.\n  - Force constant: $k_i = 1500$ $\\mathrm{kJ/(mol\\cdot nm^2)}$.\n  - Per-window counts: $N_i = 60000$.\n  - Underlying PMF parameters: $D = 20$ $\\mathrm{kJ/mol}$, $a = 22$ $\\mathrm{nm}^{-1}$, $r_0 = 0.28$ $\\mathrm{nm}$.\n  - Bound-region cutoff: $r_c = 0.40$ $\\mathrm{nm}$.\n\nAngle units are not applicable here. Express all energies in $\\mathrm{kJ/mol}$ and all lengths in $\\mathrm{nm}$. Your program must produce a single line of output containing the three binding free energies for the test suite as a comma-separated list enclosed in square brackets, with each value rounded to three decimal places (e.g., $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]$).",
            "solution": "The objective is to compute the potential of mean force (PMF) from synthetic umbrella sampling data using the Weighted Histogram Analysis Method (WHAM), and subsequently calculate the standard-state binding free energy. This process involves several steps: generating synthetic biased histograms, applying the WHAM algorithm to recover the unbiased probability distribution, converting this distribution into a PMF, and finally integrating the PMF to obtain the binding free energy.\n\nFirst, we establish the theoretical framework. The PMF, denoted as $G(r)$, along a one-dimensional reaction coordinate $r$ is related to the equilibrium probability density $P(r)$ by the Boltzmann relation. For a radial coordinate in three-dimensional space, the volume element is $4\\pi r^2 dr$, which introduces a Jacobian factor into the probability density. The probability $P(r)dr$ of finding the system with a separation between $r$ and $r+dr$ is given by:\n$$P(r) \\propto 4\\pi r^2 \\exp(-\\beta G(r))$$\nwhere $\\beta = 1/(k_\\mathrm{B} T)$, $k_\\mathrm{B}$ is the Boltzmann constant, and $T$ is the absolute temperature. The PMF $G(r)$ as defined here represents the free energy profile excluding the geometric entropic contribution that is captured by the $4\\pi r^2$ term.\n\nUmbrella sampling enhances sampling of high-energy regions by adding a biasing potential, typically harmonic, in each simulation window $i$. The bias potential is given by $U_i^\\mathrm{bias}(r) = \\frac{1}{2} k_i (r - r_i)^2$, where $k_i$ is the force constant and $r_i$ is the center of the potential for window $i$. In a biased simulation, the observed probability density, $P_i^\\mathrm{bias}(r)$, is modulated by this potential:\n$$P_i^\\mathrm{bias}(r) \\propto 4\\pi r^2 \\exp(-\\beta [G(r) + U_i^\\mathrm{bias}(r)])$$\n\nThe Weighted Histogram Analysis Method (WHAM) is a robust statistical technique for combining data from multiple biased simulations (windows) to compute the unbiased probability distribution along the reaction coordinate. It determines the optimal combination by solving a set of self-consistent equations. Let $N_{ij}$ be the number of samples observed in coordinate bin $j$ from window $i$, and $N_i = \\sum_j N_{ij}$ be the total number of samples in window $i$. The WHAM equations relate the unbiased probability $P_j$ of being in bin $j$ to the window-specific free energy offsets $f_i$:\n$$\n\\begin{cases}\nP_j = \\left( \\sum_{k=1}^{M} N_{kj} \\right) \\left/ \\left( \\sum_{k=1}^{M} N_k \\exp(\\beta f_k) \\exp(-\\beta U_{kj}) \\right) \\right. \\\\\n\\exp(-\\beta f_i) = \\sum_{j=1}^{N_\\mathrm{bins}} P_j \\exp(-\\beta U_{ij})\n\\end{cases}\n$$\nHere, $M$ is the number of windows, $N_\\mathrm{bins}$ is the number of coordinate bins, and $U_{ij} = U_i^\\mathrm{bias}(r_j)$ is the bias potential of window $i$ evaluated at the center of bin $j$. The probabilities $P_j$ are defined up to a global normalization constant, and are typically normalized such that $\\sum_j P_j = 1$. The free energies $f_i$ are defined only relative to each other, so one is typically set to zero (e.g., $f_1=0$) for a unique solution. These equations are solved iteratively until the values of $f_i$ converge.\n\nThe algorithmic procedure is as follows:\n1.  **System Setup and Data Generation**:\n    - Define physical constants $\\beta = 1/(k_\\mathrm{B}T)$ and a discrete grid of $r$ values, $r_j$, from $r_\\mathrm{min}$ to $r_\\mathrm{max}$ with bin width $\\Delta r$.\n    - For each test case, the true underlying PMF, $G_\\mathrm{true}(r)$, is defined by a Morse potential: $G_\\mathrm{true}(r) = D(e^{-2a(r-r_0)} - 2e^{-a(r-r_0)})$.\n    - For each window $i$, a synthetic histogram $N_{ij}$ is generated. The expected number of counts in bin $j$ is proportional to the biased probability density: $N_{ij} \\propto N_i \\cdot 4\\pi r_j^2 \\exp(-\\beta[G_\\mathrm{true}(r_j) + U_i^\\mathrm{bias}(r_j)])$. The counts are normalized such that $\\sum_j N_{ij} = N_i$.\n\n2.  **WHAM Iteration**:\n    - Initialize the window free energies, e.g., $f_i = 0$ for all $i$.\n    - Iterate until the maximum change in any $f_i$ is below a tolerance ($10^{-10}$):\n      a. Calculate the unbiased probabilities $P_j$ for all bins using the current $f_i$ values. This requires computing the denominator term for each bin $j$, $D_j = \\sum_{k=1}^M N_k \\exp(\\beta f_k - \\beta U_{kj})$, and the total counts per bin, $C_j = \\sum_{k=1}^M N_{kj}$. The unnormalized probability is then $\\tilde{P}_j = C_j / D_j$. Finally, normalize so that $\\sum_j P_j = 1$.\n      b. Calculate a new set of free energies, $f_i^\\mathrm{new}$, using the updated probabilities $P_j$: $f_i^\\mathrm{new} = -\\beta^{-1} \\ln\\left(\\sum_j P_j \\exp(-\\beta U_{ij})\\right)$.\n      c. To prevent numerical drift, shift the new free energies, e.g., by subtracting the value of the first one: $f_i^\\mathrm{new} \\leftarrow f_i^\\mathrm{new} - f_i^\\mathrm{new}[0]$.\n      d. Update $f_i \\leftarrow f_i^\\mathrm{new}$ and check for convergence.\n\n3.  **PMF Reconstruction**:\n    - Once the converged unbiased probabilities $P_j$ are obtained, the PMF $G(r_j)$ is calculated. From $P_j \\propto 4\\pi r_j^2 \\exp(-\\beta G(r_j))$, we can write $G(r_j) = -\\beta^{-1} \\ln(P_j/r_j^2) + \\text{constant}$. For bins with $P_j=0$, $G(r_j)$ is infinite.\n    - The PMF is shifted by an additive constant such that its average value over a bulk region (defined as $r \\in [1.30, 1.50]$ nm) is zero. This sets the reference state to be the unbound state.\n\n4.  **Binding Free Energy Calculation**:\n    - The standard-state binding free energy $\\Delta G_\\mathrm{bind}^\\circ$ is determined from the association constant $K$. The radial association constant is integrated over a defined bound volume:\n      $$K = \\int_0^{r_c} 4\\pi r^2 \\exp(-\\beta G(r)) dr$$\n      This integral is numerically approximated by a sum over the grid bins up to the cutoff $r_c$: $K \\approx \\sum_{j: r_j \\le r_c} 4\\pi r_j^2 \\exp(-\\beta G(r_j)) \\Delta r$.\n    - The standard-state equilibrium constant $K^\\circ$ is obtained by dividing by the standard-state volume, $V^\\circ = 1.66053906660$ $\\mathrm{nm}^3$ (equivalent to a $1$ M standard concentration): $K^\\circ = K/V^\\circ$.\n    - Finally, the binding free energy is computed as:\n      $$\\Delta G_\\mathrm{bind}^\\circ = -k_\\mathrm{B} T \\ln(K^\\circ) = -\\beta^{-1} \\ln(K^\\circ)$$\n\nThis entire protocol is implemented for each of the three test cases provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the standard-state binding free energy for three test cases using WHAM.\n    \"\"\"\n\n    # --- Global Parameters and Constants ---\n    T = 300.0  # Temperature in K\n    K_B = 0.008314462618  # Boltzmann constant in kJ/(mol*K)\n    BETA = 1.0 / (K_B * T)  # In (kJ/mol)^-1\n    V_STANDARD = 1.66053906660  # Standard state volume in nm^3 (for 1 M)\n\n    # --- Grid setup ---\n    R_MIN = 0.05  # nm\n    R_MAX = 1.50  # nm\n    DR = 0.01  # nm\n    r_grid = np.arange(R_MIN, R_MAX + DR / 2.0, DR)\n    num_bins = len(r_grid)\n\n    # --- Bulk region definition for PMF shifting ---\n    BULK_MIN = 1.30\n    BULK_MAX = 1.50\n\n    # --- WHAM convergence criterion ---\n    WHAM_TOLERANCE = 1e-10\n\n    test_cases = [\n        # Test Case 1\n        {\n            \"window_centers\": np.arange(0.20, 1.20 + 0.05, 0.10),\n            \"k\": 1200.0,\n            \"N_i\": 50000,\n            \"D\": 10.0,\n            \"a\": 15.0,\n            \"r0\": 0.30,\n            \"rc\": 0.45,\n        },\n        # Test Case 2\n        {\n            \"window_centers\": np.arange(0.20, 1.20 + 0.05, 0.10),\n            \"k\": 900.0,\n            \"N_i\": 30000,\n            \"D\": 4.0,\n            \"a\": 12.0,\n            \"r0\": 0.32,\n            \"rc\": 0.45,\n        },\n        # Test Case 3\n        {\n            \"window_centers\": np.arange(0.15, 1.35 + 0.05, 0.10),\n            \"k\": 1500.0,\n            \"N_i\": 60000,\n            \"D\": 20.0,\n            \"a\": 22.0,\n            \"r0\": 0.28,\n            \"rc\": 0.40,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        window_centers = case[\"window_centers\"]\n        k = case[\"k\"]\n        N_i_val = case[\"N_i\"]\n        D = case[\"D\"]\n        a = case[\"a\"]\n        r0 = case[\"r0\"]\n        rc = case[\"rc\"]\n\n        num_windows = len(window_centers)\n        \n        # --- 1. Construct Synthetic Histograms ---\n        \n        # True PMF (Morse potential)\n        g_true = D * (np.exp(-2 * a * (r_grid - r0)) - 2 * np.exp(-a * (r_grid - r0)))\n        \n        histograms = np.zeros((num_windows, num_bins))\n        biases_matrix = np.zeros((num_windows, num_bins))\n        N_i_array = np.full(num_windows, N_i_val, dtype=float)\n\n        for i in range(num_windows):\n            r_center = window_centers[i]\n            # Harmonic bias potential for window i\n            u_bias = 0.5 * k * (r_grid - r_center)**2\n            biases_matrix[i, :] = u_bias\n            \n            # Biased energy\n            biased_energy = g_true + u_bias\n            \n            # Biased probability distribution including Jacobian\n            # Prop to 4*pi*r^2 * exp(-beta * E_biased)\n            unnorm_prob = (4 * np.pi * r_grid**2) * np.exp(-BETA * biased_energy)\n            \n            # Normalize probability for this window\n            norm_factor = np.sum(unnorm_prob)\n            if norm_factor == 0:\n                # This case shouldn't happen with the given parameters\n                # but good practice to handle.\n                norm_prob = np.zeros_like(unnorm_prob)\n            else:\n                norm_prob = unnorm_prob / norm_factor\n\n            # Generate histogram counts\n            histograms[i, :] = N_i_val * norm_prob\n            \n        # --- 3. Implement WHAM ---\n        f_i = np.zeros(num_windows)  # Initialize window free energies\n        \n        # Pre-compute terms that don't change in the loop\n        total_counts_per_bin = np.sum(histograms, axis=0) # Numerator of P_j\n        exp_minus_beta_U = np.exp(-BETA * biases_matrix) # exp(-beta*U_ij)\n        \n        for iteration in range(10000): # Max iterations to prevent infinite loop\n            f_old = f_i.copy()\n            \n            # Denominator of P_j\n            exp_beta_f = np.exp(BETA * f_i)\n            weighted_N = N_i_array * exp_beta_f\n            \n            # Sum over windows k for each bin j\n            den_P = weighted_N @ exp_minus_beta_U\n            \n            with np.errstate(divide='ignore', invalid='ignore'):\n                P_unnormalized = total_counts_per_bin / den_P\n            \n            P_unnormalized[np.isnan(P_unnormalized)] = 0.0\n\n            # Normalize probabilities\n            P = P_unnormalized / np.sum(P_unnormalized)\n            \n            # Update free energies f_i\n            with np.errstate(divide='ignore'):\n              log_arg = P @ exp_minus_beta_U.T\n            \n            f_new = -1.0 / BETA * np.log(log_arg)\n            f_new[np.isinf(f_new)] = f_i[np.isinf(f_new)] # Keep old if log_arg is 0\n\n            # Shift to prevent drift\n            f_new -= f_new[0]\n            f_i = f_new\n\n            # Check for convergence\n            max_change = np.max(np.abs(f_i - f_old))\n            if max_change < WHAM_TOLERANCE:\n                break\n        \n        # --- 4. Convert Probability to PMF and Shift ---\n        with np.errstate(divide='ignore'):\n             # G = -k_B*T * (ln(P) - ln(4*pi*r^2*dr))\n             # The constant term ln(4*pi*dr) will be absorbed into the shifting constant\n             G = -1.0 / BETA * (np.log(P) - 2.0 * np.log(r_grid))\n\n        G[np.isneginf(G)] = np.inf # Bins with P=0 have infinite free energy\n        \n        # Shift PMF so bulk region (high r) is zero\n        bulk_mask = (r_grid >= BULK_MIN) & (r_grid <= BULK_MAX)\n        G_bulk = G[bulk_mask]\n        \n        finite_G_bulk = G_bulk[np.isfinite(G_bulk)]\n        if len(finite_G_bulk) > 0:\n            shift = np.mean(finite_G_bulk)\n            G -= shift\n        \n        # --- 5. Compute Standard-State Binding Free Energy ---\n        bound_mask = r_grid <= rc\n        \n        # Integrand for association constant K\n        integrand = np.exp(-BETA * G) * (4 * np.pi * r_grid**2)\n        \n        # Numerical integration (sum over bins)\n        K = np.sum(integrand[bound_mask]) * DR\n\n        # Standard-state equilibrium constant and free energy\n        if K > 0 and V_STANDARD > 0:\n            K_standard = K / V_STANDARD\n            delta_G_bind = -1.0 / BETA * np.log(K_standard)\n        else:\n            delta_G_bind = np.inf # Should not happen\n\n        results.append(round(delta_G_bind, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}