{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在通过一个具体的晶格模型，帮助您亲手实践构型偏置蒙特卡洛（CBMC）方法的核心计算。您将计算罗森布鲁斯权重（Rosenbluth weight）并确定接受概率，从而加深对这些基本概念的理解。此练习  还引入了“损耗”（attrition）这一重要实际问题，它在某些试探位被禁止时出现，这对于理解CBMC在受限系统中的行为至关重要。",
            "id": "3745214",
            "problem": "考虑在构型偏置蒙特卡罗（CBMC）中，对于一个在具有禁入位点的格子上构象的聚合物，进行单珠位移，并将其与具有相同试验次数的非格子CBMC进行比较。在正则系综中进行研究，其目标平衡分布与玻尔兹曼因子 $ \\pi(x) \\propto \\exp(-\\beta U(x)) $ 成正比。使用约化（无量纲）能量 $ u_i = \\beta U_i $，因此玻尔兹曼权重为 $ \\exp(-u_i) $，而无限能量 $ u_i = \\infty $ 代表玻尔兹曼权重为零的禁入位点。\n\n在给定步骤中，CBMC 生成 $ K = 5 $ 个试验位置，并以与其玻尔兹曼权重成正比的偏置概率选择其中一个试验。对于格子情况，一些试验位置是禁入的（$ u_i = \\infty $）。对于非格子情况，所有试验能量都是有限的。假设除了CBMC偏置外，提议机制是对称的，并且所选的试验成为提议的新珠子位置。\n\n1. 从细致平衡和Metropolis–Hastings规则出发，用Rosenbluth和来推导单珠位移的CBMC接受概率。其中，对于在某一构象下生成的一组试验，Rosenbluth和定义为 $ W = \\sum_{i=1}^{K} \\exp(-u_i) $。明确处理某些 $ u_i = \\infty $ 的情况。\n\n2. 对于格子构象，当前（旧）珠子位置的试验能量集合为 $ u_i^{\\text{latt, old}} = [\\infty, 2.0, 0.7, \\infty, 1.2] $，提议的（新）珠子位置的试验能量集合为 $ u_i^{\\text{latt, new}} = [\\infty, 0.4, 2.3, \\infty, 0.9] $。计算相应的Rosenbluth和 $ W^{\\text{latt}}_{\\text{old}} $ 与 $ W^{\\text{latt}}_{\\text{new}} $，以及接受概率 $ \\alpha_{\\text{latt}} $。\n\n3. 对于非格子构象，当前（旧）珠子位置的试验能量集合为 $ u_i^{\\text{off, old}} = [2.0, 0.7, 1.2, 1.8, 0.5] $，提议的（新）珠子位置的试验能量集合为 $ u_i^{\\text{off, new}} = [0.4, 2.3, 0.9, 1.1, 0.2] $。计算相应的Rosenbluth和 $ W^{\\text{off}}_{\\text{old}} $ 与 $ W^{\\text{off}}_{\\text{new}} $，以及接受概率 $ \\alpha_{\\text{off}} $。\n\n4. 将CBMC生长过程中的“损耗”（attrition）定义为在某生长步骤中Rosenbluth和为零（$ W = 0 $）的事件，此时该步骤无法继续。在格子中，考虑一个被阻塞的位点，其试验能量为 $ u_i^{\\text{blocked}} = [\\infty, \\infty, \\infty, \\infty, \\infty] $。计算 $ W_{\\text{blocked}} $ 和相应的损耗指示符 $ I_{\\text{attr}} $，其中如果 $ W = 0 $，则 $ I_{\\text{attr}} = 1 $，否则 $ I_{\\text{attr}} = 0 $。\n\n将所有Rosenbluth和四舍五入到六位有效数字，所有接受概率四舍五入到四位有效数字。按顺序 $ \\left( W^{\\text{latt}}_{\\text{old}}, W^{\\text{latt}}_{\\text{new}}, \\alpha_{\\text{latt}}, W^{\\text{off}}_{\\text{old}}, W^{\\text{off}}_{\\text{new}}, \\alpha_{\\text{off}}, W_{\\text{blocked}}, I_{\\text{attr}} \\right) $ 报告您的最终结果。接受概率和指示符是无量纲的；不需要物理单位。",
            "solution": "正则系综为具有能量 $ U(x) $ 的构象 $ x $ 分配一个目标概率密度 $ \\pi(x) \\propto \\exp(-\\beta U(x)) $。在Metropolis–Hastings框架中，从 $ x $ 到 $ x' $ 的提议移动的接受概率为\n$$\n\\alpha(x \\to x') = \\min\\left( 1,\\; \\frac{\\pi(x')\\, q(x' \\mid x)}{\\pi(x)\\, q(x \\mid x')} \\right),\n$$\n其中 $ q(x' \\mid x) $ 是在给定 $ x $ 的情况下提议 $ x' $ 的概率密度（原文为 $q(x' \\mid x)$ is the proposal probability density of generating $x'$ given $x$）。\n\n在构型偏置蒙特卡洛（CBMC）中，在给定的珠子位移步骤中，我们生成 $ K $ 个试验位置 $\\{i=1,\\dots,K\\}$，并为每个试验分配一个玻尔兹曼权重 $ w_i = \\exp(-u_i) $，其中 $ u_i = \\beta U_i $ 是约化能量。此步骤的Rosenbluth和为\n$$\nW = \\sum_{i=1}^{K} w_i = \\sum_{i=1}^{K} \\exp(-u_i).\n$$\nCBMC选择规则以概率\n$$\np(i^\\star) = \\frac{w_{i^\\star}}{W} = \\frac{\\exp(-u_{i^\\star})}{\\sum_{i=1}^{K} \\exp(-u_i)}.\n$$\n从 $ K $ 个试验中选择一个 $ i^\\star $。如果一个试验的能量 $ u_i = \\infty $，则 $ \\exp(-u_i) = 0 $，因此禁入试验对 $ W $ 的贡献为零，并且选择概率也为零。如果所有 $ K $ 个试验都是禁入的，那么 $ W = 0 $，生长步骤无法继续；这就是损耗事件。\n\n为了确定单珠位移的接受概率，我们利用了CBMC移动构造的特殊性质。对于从构象 $x$ 到 $x'$ 的重构移动，提议概率 $q(x'|x)$ 与旧构象的罗森布鲁斯权重 $W_{\\text{old}}$ 相关，而逆向提议概率 $q(x|x')$ 与新构象的罗森布鲁斯权重 $W_{\\text{new}}$ 相关。将这些代入Metropolis-Hastings公式并经过简化后，与系统其余部分能量相关的项会相互抵消，最终的接受概率比简化为：\n$$\n\\frac{\\pi(x')\\, q(x \\mid x')}{\\pi(x)\\, q(x' \\mid x)} = \\frac{W_{\\text{new}}}{W_{\\text{old}}}.\n$$\n因此，CBMC移动的接受概率是\n$$\n\\alpha = \\min\\left( 1,\\; \\frac{W_{\\text{new}}}{W_{\\text{old}}} \\right).\n$$\n能量为 $ u_i = \\infty $ 的禁入试验通过移除项来减小 $ W $，如果它们移除了所有项以至于 $ W = 0 $，则该步骤因损耗而终止。\n\n我们现在计算所要求的量。\n\n格子情况（部分试验禁入）：\n旧构象试验：$ u_i^{\\text{latt, old}} = [\\infty, 2.0, 0.7, \\infty, 1.2] $。Rosenbluth和为\n$$\nW^{\\text{latt}}_{\\text{old}} = \\exp(-2.0) + \\exp(-0.7) + \\exp(-1.2)\n$$\n由于 $ \\exp(-\\infty) = 0 $，我们有：\n\\begin{align*}\nW^{\\text{latt}}_{\\text{old}}\n= 0 + \\exp(-2.0) + \\exp(-0.7) + 0 + \\exp(-1.2).\n\\end{align*}\n计算每一项，\n$ \\exp(-2.0) = 0.1353352832366127 $,\n$ \\exp(-0.7) = 0.4965853037914095 $,\n$ \\exp(-1.2) = 0.3011942119122020 $,\n所以\n$$\nW^{\\text{latt}}_{\\text{old}} = 0.9331147989402242.\n$$\n新构象试验：$ u_i^{\\text{latt, new}} = [\\infty, 0.4, 2.3, \\infty, 0.9] $。Rosenbluth和为\n$$\nW^{\\text{latt}}_{\\text{new}} = \\exp(-0.4) + \\exp(-2.3) + \\exp(-0.9)\n$$\n由于 $ \\exp(-\\infty) = 0 $，我们有：\n\\begin{align*}\nW^{\\text{latt}}_{\\text{new}}\n= 0 + \\exp(-0.4) + \\exp(-2.3) + 0 + \\exp(-0.9).\n\\end{align*}\n计算每一项，\n$ \\exp(-0.4) = 0.6703200460356393 $,\n$ \\exp(-2.3) = 0.1002588437228037 $,\n$ \\exp(-0.9) = 0.4065696597405991 $,\n所以\n$$\nW^{\\text{latt}}_{\\text{new}} = 1.1771485494990422.\n$$\n接受概率是\n\\begin{align*}\n\\alpha_{\\text{latt}} = \\min\\left(1,\\; \\frac{W^{\\text{latt}}_{\\text{new}}}{W^{\\text{latt}}_{\\text{old}}} \\right)\n= \\min\\left(1,\\; \\frac{1.1771485494990422}{0.9331147989402242} \\right) \\\\\n= \\min\\left(1,\\; 1.26152\\ldots\\right) = 1.\n\\end{align*}\n\n非格子情况（所有试验能量有限）：\n旧构象试验：$ u_i^{\\text{off, old}} = [2.0, 0.7, 1.2, 1.8, 0.5] $。Rosenbluth和为\n\\begin{align*}\nW^{\\text{off}}_{\\text{old}}\n= \\exp(-2.0) + \\exp(-0.7) + \\exp(-1.2) + \\exp(-1.8) + \\exp(-0.5) \\\\\n= 0.1353352832366127 + 0.4965853037914095 + 0.3011942119122020 + 0.1652988882215866 + 0.6065306597126334 \\\\\n= 1.7049443468744442.\n\\end{align*}\n新构象试验：$ u_i^{\\text{off, new}} = [0.4, 2.3, 0.9, 1.1, 0.2] $。Rosenbluth和为\n\\begin{align*}\nW^{\\text{off}}_{\\text{new}}\n= \\exp(-0.4) + \\exp(-2.3) + \\exp(-0.9) + \\exp(-1.1) + \\exp(-0.2) \\\\\n= 0.6703200460356393 + 0.1002588437228037 + 0.4065696597405991 + 0.3328710836980796 + 0.8187307530779818 \\\\\n= 2.3287503862751035.\n\\end{align*}\n接受概率是\n\\begin{align*}\n\\alpha_{\\text{off}} = \\min\\left(1,\\; \\frac{W^{\\text{off}}_{\\text{new}}}{W^{\\text{off}}_{\\text{old}}} \\right)\n= \\min\\left(1,\\; \\frac{2.3287503862751035}{1.7049443468744442} \\right) \\\\\n= \\min\\left(1,\\; 1.36588\\ldots\\right) = 1.\n\\end{align*}\n\n在阻塞位点的损耗：\n阻塞的格子试验：$ u_i^{\\text{blocked}} = [\\infty, \\infty, \\infty, \\infty, \\infty] $。那么\n$$\nW_{\\text{blocked}} = \\sum_{i=1}^{5} \\exp(-u_i) = \\sum_{i=1}^{5} 0 = 0,\n$$\n损耗指示符为\n$$\nI_{\\text{attr}} = 1.\n$$\n\n应用四舍五入指令：\n- Rosenbluth和保留六位有效数字：\n$ W^{\\text{latt}}_{\\text{old}} = 0.933115 $, $ W^{\\text{latt}}_{\\text{new}} = 1.17715 $, $ W^{\\text{off}}_{\\text{old}} = 1.70494 $, $ W^{\\text{off}}_{\\text{new}} = 2.32875 $, 以及 $ W_{\\text{blocked}} = 0 $（精确值）。\n- 接受概率保留四位有效数字：\n$ \\alpha_{\\text{latt}} = 1.0000 $ 和 $ \\alpha_{\\text{off}} = 1.0000 $。\n- 损耗指示符 $ I_{\\text{attr}} = 1 $（精确值）。\n\n按要求顺序报告 $ \\left( W^{\\text{latt}}_{\\text{old}}, W^{\\text{latt}}_{\\text{new}}, \\alpha_{\\text{latt}}, W^{\\text{off}}_{\\text{old}}, W^{\\text{off}}_{\\text{new}}, \\alpha_{\\text{off}}, W_{\\text{blocked}}, I_{\\text{attr}} \\right) $。",
            "answer": "$$\\boxed{\\begin{pmatrix}0.933115 & 1.17715 & 1.0000 & 1.70494 & 2.32875 & 1.0000 & 0 & 1\\end{pmatrix}}$$"
        },
        {
            "introduction": "在掌握了基本计算之后，正确地实现算法至关重要。本练习  聚焦于CBMC实现中一个常见但微妙的陷阱：在链增长过程中重复计算非键相互作用能。通过分析这个错误，您将学会如何正确地定义增量能量，确保模拟的准确性，这是编写无误的CBMC代码的关键一步。",
            "id": "3745218",
            "problem": "在构象偏置蒙特卡罗 (CBMC) 方法中，一个长度为 $S$ 的聚合物链的连续片段被逐珠地重新增长。在每个增长步骤 $i \\in \\{1,\\dots,S\\}$，会生成一组 $K$ 个试探构型，其索引为 $j \\in \\{1,\\dots,K\\}$。对于步骤 $i$ 的每个试探 $j$，会计算能量增量变化 $\\Delta U_i^{(j)}$，并用它来偏置该步骤中 $K$ 个试探构型的选择。系统在正则系综中进行采样，因此能量为 $U$ 的微观态的概率密度与 $\\exp(-\\beta U)$ 成正比，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$ 是逆热能。在步骤 $i$，已经放置的重增长珠子的集合是 $\\{1,\\dots,i-1\\}$，而系统的其余部分（链的未重增长部分和任何外部场）是环境。设 $u_{\\mathrm{nb}}(p,q)$ 表示重增长片段内珠子 $p$ 和 $q$ 之间的非键对相互作用，并假设依赖于珠子 $i$ 的键合项已包含在能量增量中。一个常见的实现陷阱是，在每一步计算 $\\Delta U_i^{(j)}$ 时，都对重增长片段内 $\\{1,\\dots,i\\}$ 珠子之间的所有非键相互作用求和，而不是仅限于放置珠子 $i$ 所引入的新相互作用，从而在不同步骤之间重复计算了重增长片段内部的非键相互作用。\n\n哪个选项正确地指出了这个错误，给出了避免重复计算的正确能量增量形式，并表达了这个错误对 $S$ 个珠子重增长的Rosenbluth权重 $W$ 的最终影响？\n\nA. 步骤 $i$ 的能量增量必须只包括添加珠子 $i$ 所引入的相互作用：依赖于珠子 $i$ 的键合项、珠子 $i$ 与已放置的重增长珠子 $\\{1,\\dots,i-1\\}$ 之间的非键相互作用，以及珠子 $i$ 与环境之间的非键相互作用；它必须排除先前已放置珠子 $\\{1,\\dots,i-1\\}$ 之间的非键相互作用，因为这些作用不依赖于试探 $j$。如果错误的实现将常数 $$U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1) \\equiv \\sum_{1 \\le m  n \\le i-1} u_{\\mathrm{nb}}(m,n)$$ 加到每个 $\\Delta U_i^{(j)}$上，那么每一步的归一化因子就会乘以 $\\exp(-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1))$，完整的Rosenbluth权重为 $$W_{\\mathrm{bug}} = \\left[\\prod_{i=1}^{S} e^{-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1)}\\right] \\, W_{\\mathrm{true}},$$ 这会使接受率产生偏差，除非进行修正。\n\nB. 因为在给定步骤 $i$ 将相同的常数加到所有 $\\Delta U_i^{(j)}$ 上不会改变归一化的试探选择概率，所以这个错误在每一步都完全抵消，得到 $$W_{\\mathrm{bug}} = W_{\\mathrm{true}},$$ 因此接受率不受影响。\n\nC. 为修正重复计算，应在每一步将 $\\Delta U_i^{(j)}$ 除以 $i$ 以重新加权重复的相互作用；在错误的实现下，Rosenbluth权重变成了真实权重的几何平均值：$$W_{\\mathrm{bug}} = \\left(W_{\\mathrm{true}}\\right)^{1/S}.$$\n\nD. 为了保持细致平衡，先前放置的珠子之间的相互作用必须计算两次（两个珠子各放置一次），因此正确的能量增量包括 $\\{1,\\dots,i\\}$ 内的所有非键相互作用；在错误的实现下，得到的Rosenbluth权重为 $$W_{\\mathrm{bug}} = \\left(W_{\\mathrm{true}}\\right)^{2}.$$",
            "solution": "问题陈述描述了在构象偏置蒙特卡罗 (CBMC) 算法中重增长聚合物片段时一个常见的实现错误。我将首先验证问题陈述，然后进行完整的解答，包括对每个选项的分析。\n\n**问题验证**\n\n**步骤1：提取已知条件**\n- **算法**：构象偏置蒙特卡罗 (CBMC)。\n- **系综**：正则系综，概率密度与 $\\exp(-\\beta U)$ 成正比，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$。\n- **过程**：一个长度为 $S$ 的连续聚合物片段被逐珠地重新增长。\n- **增长步骤**：对于每个步骤 $i \\in \\{1,\\dots,S\\}$，为新珠子 $i$ 生成 $K$ 个试探构型（索引为 $j \\in \\{1,\\dots,K\\}$）。\n- **能量增量**：对于步骤 $i$ 的每个试探 $j$，计算能量增量变化 $\\Delta U_i^{(j)}$。\n- **定义**：\n    - 在步骤 $i$ 已放置的重增长珠子集合：$\\{1,\\dots,i-1\\}$。\n    - $u_{\\mathrm{nb}}(p,q)$：珠子 $p$ 和 $q$ 之间的非键对相互作用。\n    - 依赖于珠子 $i$ 的键合项包含在 $\\Delta U_i^{(j)}$ 中。\n- **错误**：描述了一个常见陷阱，即通过“在每一步对重增长片段内 $\\{1,\\dots,i\\}$ 珠子之间的所有非键相互作用求和”来计算 $\\Delta U_i^{(j)}$，这导致了重复计算。\n- **问题**：任务是确定哪个选项正确地陈述了错误、能量增量的正确形式以及对Rosenbluth权重 $W$ 的最终影响。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题在统计力学和计算模拟领域有充分的依据。CBMC是一种标准且广泛使用的算法。对算法、正则系综、能量项和Rosenbluth权重的描述都与既定原则一致。所描述的错误是一个现实且在概念上很重要的实现错误。\n- **良态问题**：该问题是一个良态问题。它定义了一个特定的算法和一个具体的、描述清晰的错误。问题要求推导这个错误对一个关键量（Rosenbluth权重）的影响。这种结构允许一个唯一且有意义的解。\n- **客观性**：语言技术性强、精确且客观。它避免了任何模糊或主观的陈述。\n\n**步骤3：结论与行动**\n问题陈述是有效的。它科学合理、问题良态且客观。我现在将着手推导解答。\n\n**推导**\n\nCBMC方法的核心是分子链的偏置增长，其中偏置通过一个称为Rosenbluth权重 $W$ 的校正因子被精确地移除。这确保了算法能从期望的统计系综（本例中为正则系综）中正确采样。\n\n**1. 正确的公式**\n在每个增长步骤 $i$，我们是在珠子 $\\{1, \\dots, i-1\\}$ 已被放置的条件下放置珠子 $i$。对于珠子 $i$ 的一个试探构型 $j$，其能量增量变化 $\\Delta U_{i, \\mathrm{true}}^{(j)}$ 必须表示添加珠子 $i$ 后总系统能量的变化。这个变化包括：\n- 所有涉及珠子 $i$ 的键合相互作用（例如，键长、键角、二面角项）。\n- 珠子 $i$ 与系统中所有其他粒子之间的所有非键相互作用。这些其他粒子可以分为两组：\n    1.  已经放置的片段珠子：$\\{1, \\dots, i-1\\}$。\n    2.  系统中所有其他粒子，我们称之为“环境”。\n\n因此，在步骤 $i$ 对试探 $j$ 的正确能量增量是：\n$$ \\Delta U_{i, \\mathrm{true}}^{(j)} = U_{\\mathrm{bond}}^{(j)}(i) + \\sum_{m=1}^{i-1} u_{\\mathrm{nb}}(i^{(j)}, m) + U_{\\mathrm{env}}^{(j)}(i) $$\n其中 $U_{\\mathrm{bond}}^{(j)}(i)$ 代表涉及珠子 $i$ 试探位置的键合项，求和项是与片段中先前放置的珠子之间的非键能量，$U_{\\mathrm{env}}^{(j)}(i)$ 是与环境的非键能量。珠子 $\\{1, \\dots, i-1\\}$ 之间的相互作用*不*包括在内，因为它们的能量贡献已在之前的步骤中计算，并且不随珠子 $i$ 的试探位置而改变。\n\n步骤 $i$ 的单步Rosenbluth因子是所有 $K$ 个试探的玻尔兹曼因子的总和：\n$$ w_{i, \\mathrm{true}} = \\sum_{j=1}^{K} \\exp\\left(-\\beta \\Delta U_{i, \\mathrm{true}}^{(j)}\\right) $$\n$S$珠子片段的总Rosenbluth权重是这些单步因子的乘积：\n$$ W_{\\mathrm{true}} = \\prod_{i=1}^{S} w_{i, \\mathrm{true}} $$\n\n**2. 错误实现的分析**\n问题指出，错误在于通过“对 $\\{1,\\dots,i\\}$ 珠子之间的所有非键相互作用求和”来计算 $\\Delta U_i^{(j)}$。这意味着错误的代码在步骤 $i$ 计算了长度为 $i$ 的片段内部的总非键能量，并将其包含在能量增量中。珠子 $\\{1, \\dots, i\\}$ 的总内部非键能量为：\n$$ U_{\\mathrm{nb}}^{\\mathrm{total}}(i) = \\sum_{1 \\le m  n \\le i} u_{\\mathrm{nb}}(m,n) = \\left( \\sum_{m=1}^{i-1} u_{\\mathrm{nb}}(i,m) \\right) + \\left( \\sum_{1 \\le m  n \\le i-1} u_{\\mathrm{nb}}(m,n) \\right) $$\n右边的第一项取决于珠子 $i$ 的位置，是正确能量增量的一部分。第二项，我们称之为 $U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1)$，是先前步骤中已放置珠子之间的非键相互作用之和。这个项对于步骤 $i$ 的所有 $K$ 个试探构型都是一个常数。\n\n因此，错误的能量增量 $\\Delta U_{i, \\mathrm{bug}}^{(j)}$ 包含了这个额外的常数项：\n$$ \\Delta U_{i, \\mathrm{bug}}^{(j)} = \\Delta U_{i, \\mathrm{true}}^{(j)} + U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1) $$\n其中 $U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1) = \\sum_{1 \\le m  n \\le i-1} u_{\\mathrm{nb}}(m,n)$。对于 $i=1$，$U_{\\mathrm{nb}}^{\\mathrm{prev}}(0) = 0$。\n\n**3. 对Rosenbluth权重的影响**\n错误的单步Rosenbluth因子 $w_{i, \\mathrm{bug}}$ 是：\n$$ w_{i, \\mathrm{bug}} = \\sum_{j=1}^{K} \\exp\\left(-\\beta \\Delta U_{i, \\mathrm{bug}}^{(j)}\\right) = \\sum_{j=1}^{K} \\exp\\left(-\\beta \\left( \\Delta U_{i, \\mathrm{true}}^{(j)} + U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1) \\right)\\right) $$\n由于 $\\exp(-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1))$ 是一个相对于求和索引 $j$ 的常数因子：\n$$ w_{i, \\mathrm{bug}} = \\exp\\left(-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1)\\right) \\sum_{j=1}^{K} \\exp\\left(-\\beta \\Delta U_{i, \\mathrm{true}}^{(j)}\\right) $$\n$$ w_{i, \\mathrm{bug}} = \\exp\\left(-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1)\\right) \\, w_{i, \\mathrm{true}} $$\n总的错误Rosenbluth权重 $W_{\\mathrm{bug}}$ 是这些错误的单步因子的乘积：\n$$ W_{\\mathrm{bug}} = \\prod_{i=1}^{S} w_{i, \\mathrm{bug}} = \\prod_{i=1}^{S} \\left( \\exp\\left(-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1)\\right) \\, w_{i, \\mathrm{true}} \\right) $$\n$$ W_{\\mathrm{bug}} = \\left( \\prod_{i=1}^{S} \\exp\\left(-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1)\\right) \\right) \\left( \\prod_{i=1}^{S} w_{i, \\mathrm{true}} \\right) $$\n$$ W_{\\mathrm{bug}} = \\left( \\prod_{i=1}^{S} e^{-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1)} \\right) \\, W_{\\mathrm{true}} $$\n这明确显示了该错误如何修改真实的Rosenbluth权重。\n\n**逐项分析**\n\n**A.** 该选项指出，能量增量必须仅包含由珠子 $i$ 新引入的相互作用，且必须排除先前已放置珠子 $\\{1,\\dots,i-1\\}$ 之间的相互作用。这是 $\\Delta U_{i, \\mathrm{true}}^{(j)}$ 的正确定義。它正确地将错误添加的项确定为 $U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1) \\equiv \\sum_{1 \\le m  n \\le i-1} u_{\\mathrm{nb}}(m,n)$。然后，它推导出对完整Rosenbluth权重的影响为 $W_{\\mathrm{bug}} = \\left[\\prod_{i=1}^{S} e^{-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1)}\\right] W_{\\mathrm{true}}$。这与我们的推导完全吻合。这会使接受率产生偏差的结论也是正确的，因为接受概率取决于新旧构象的Rosenbluth权重之比，而这些错误项通常不会抵消。\n**结论：正确。**\n\n**B.** 该选项正确地指出，在步骤 $i$ 向所有 $\\Delta U_i^{(j)}$ 添加一个恒定能量 $U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1)$ 不会改变归一化的 $K$ 个试探选择概率。这是因为常数因子 $\\exp(-\\beta U_{\\mathrm{nb}}^{\\mathrm{prev}}(i-1))$ 在选择概率 $p_i(k) = \\exp(-\\beta \\Delta U_{i, \\mathrm{bug}}^{(k)}) / \\sum_j \\exp(-\\beta \\Delta U_{i, \\mathrm{bug}}^{(j)})$ 的分子和分母中被抵消了。然而，它错误地得出 $W_{\\mathrm{bug}} = W_{\\mathrm{true}}$ 且接受率不受影响的结论。如上所述，Rosenbluth权重本身在每一步都被乘以一个因子，这些因子在总的移动接受概率中不会抵消。\n**结论：错误。**\n\n**C.** 该选项建议通过将 $\\Delta U_i^{(j)}$ 除以 $i$ 来纠正错误。这是一个武斷且没有物理依据的过程。错误在于一个附加的能量项，而非缩放问题。所提出的公式 $W_{\\mathrm{bug}} = (W_{\\mathrm{true}})^{1/S}$ 在数学上与该错误的影响不一致，后者涉及指数因子的乘积，而不是几何平均值或开方。\n**结论：错误。**\n\n**D.** 该选项错误地声称细致平衡要求重复计算相互作用。这是对能量计算和细致平衡的根本误解。在一个有效的蒙特卡罗方案中，任何给定构象的总能量必须是唯一且明确定义的，每个对相互作用都只计算一次。CBMC算法的构造正是为了在使用正确的、能加和得到正确总能量的能量增量时满足细致平衡。公式 $W_{\\mathrm{bug}} = (W_{\\mathrm{true}})^{2}$ 是毫无根据的。\n**结论：错误。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "一个有效的模拟不仅要正确，还要高效。本练习将引导您从正确性转向性能优化，探讨CBMC的一个关键参数——试探构型的数量 $k$。您将通过一个简化的模型  分析更高接受率与更高计算成本之间的权衡，并学习如何找到最大化单位时间有效样本量的最佳 $k$ 值，这是优化蒙特卡洛模拟效率的核心技能。",
            "id": "3745279",
            "problem": "考虑一个单扭转自由度，其角度为 $\\phi \\in [0, 2\\pi)$，能量景观是分段常数，具有两个等角宽度的势阱（极小值）。具体来说，势阱 $\\mathcal{A}$ 占据了以 $\\phi = 0$ 为中心、总宽度为 $\\delta$ 的角度区间，势阱 $\\mathcal{B}$ 占据了以 $\\phi = \\pi$ 为中心、总宽度为 $\\delta$ 的角度区间。角度域 $[0, 2\\pi)$ 的其余部分能量非常高，以至于在所考虑的温度下其玻尔兹曼权重可以忽略不计。假设 $\\delta$ 的值使得两个势阱的并集占据了角度域的一半，即两个势阱共同覆盖的宽度为 $\\pi$，因此一个均匀抽取的角度落入势阱 $\\mathcal{A}$ 或 $\\mathcal{B}$ 的概率相等。设势阱 $\\mathcal{A}$ 中的能量为 $U_{\\mathcal{A}}$，势阱 $\\mathcal{B}$ 中的能量为 $U_{\\mathcal{B}}$，且 $U_{\\mathcal{B}} - U_{\\mathcal{A}} = k_{B} T \\ln(4)$，其中 $k_{B}$ 是玻尔兹曼常数，$T$ 是绝对温度。因此，玻尔兹曼权重为 $w_{\\mathcal{A}} = \\exp(-\\beta U_{\\mathcal{A}})$ 和 $w_{\\mathcal{B}} = \\exp(-\\beta U_{\\mathcal{B}})$，其中 $\\beta = 1/(k_{B} T)$，这意味着 $w_{\\mathcal{A}} = 1$ 且 $w_{\\mathcal{B}} = 1/4$。在势阱之外，玻尔兹曼权重被视为零。\n\n一次构象偏置蒙特卡洛（CBMC）移动通过从 $[0, 2\\pi)$ 中独立且均匀地抽取 $k$ 个试验角度来重新生成此扭转。对每个试验角度 $\\phi_{j}$，计算其权重 $w(\\phi_{j}) = \\exp(-\\beta U(\\phi_{j}))$，根据 $\\phi_{j}$ 是位于势阱 $\\mathcal{A}$ 还是 $\\mathcal{B}$，该权重等于 $w_{\\mathcal{A}}$ 或 $w_{\\mathcal{B}}$。新集合的 CBMC 罗森布鲁斯因子为 $W_{\\text{new}} = \\sum_{j=1}^{k} w(\\phi_{j})$，并从这 $k$ 个试验中以与 $w(\\phi_{j})$ 成正比的概率选择新的角度。为了在多次尝试的形式下维持细致平衡，旧构象的反向罗森布鲁斯因子构造为 $W_{\\text{old}} = w(\\phi_{\\text{old}}) + \\sum_{j=1}^{k-1} w(\\tilde{\\phi}_{j})$，其中 $\\tilde{\\phi}_{j}$ 是 $k-1$ 个独立的均匀试验，而 $w(\\phi_{\\text{old}})$ 是当前扭转角度的玻尔兹曼权重。再生移动的 Metropolis 接受概率为 $\\min\\!\\big(1, W_{\\text{new}}/W_{\\text{old}}\\big)$。\n\n假设在 CBMC 移动之前，当前扭转在此能量景观下处于平衡状态。对于这个定义明确的玩具模型：\n- 使用基本玻尔兹曼分布和构象偏置蒙特卡洛（CBMC）罗森布鲁斯加权，在平均场近似下（即用期望的比值 $\\mathbb{E}[W_{\\text{new}}]/\\mathbb{E}[W_{\\text{old}}]$ 替代随机的接受率），从第一性原理推导接受率作为 $k$ 的函数的解析表达式。\n- 设每次尝试移动的计算成本是 $k$ 的仿射函数，$t(k) = t_{0} + t_{1} k$，其中 $t_{0} = 1$ 和 $t_{1} = 1$（单位为任意但一致的时间单位）。定义单位时间的有效样本量为接受率除以 $t(k)$。\n- 确定使该模型单位时间的有效样本量最大化的整数 $k$ 值。\n\n提供使效率最大化的单个整数 $k$ 作为最终答案。由于该量是整数，因此无需四舍五入。最终的方框答案必须只包含该整数，方框内不得有单位。",
            "solution": "该问题要求找到试验角度的整数个数 $k$，使得对于一个简化的扭转势，构象偏置蒙特卡洛（CBMC）移动的采样效率最大化。效率 $E(k)$ 定义为接受率与每次移动计算成本的比值。\n\n首先，我们验证问题陈述。所有给定条件都已列出并检查其一致性。该问题在统计力学和蒙特卡洛方法方面具有科学依据，是一个有着明确目标的适定问题，且其所有术语都得到了形式化定义。因此，该问题被认为是有效的。\n\n解题过程分为三个主要步骤：\n1.  推导平均场接受率 $\\langle P_{\\text{acc}}(k) \\rangle$ 作为 $k$ 的函数的表达式。\n2.  使用给定的成本函数定义效率 $E(k)$。\n3.  确定使 $E(k)$ 最大化的整数 $k \\ge 1$。\n\n总角度域为 $[0, 2\\pi)$。扭转势定义了两个势阱 $\\mathcal{A}$ 和 $\\mathcal{B}$，每个的宽度为 $\\delta$。给定势阱的总宽度为 $2\\delta = \\pi$，这意味着 $\\delta = \\pi/2$。\n\n从 $[0, 2\\pi)$ 中均匀抽取一个试验角度 $\\phi$。该角度落入势阱 $\\mathcal{A}$ 的概率为 $P(\\phi \\in \\mathcal{A}) = \\frac{\\delta}{2\\pi} = \\frac{\\pi/2}{2\\pi} = \\frac{1}{4}$。类似地，其落入势阱 $\\mathcal{B}$ 的概率为 $P(\\phi \\in \\mathcal{B}) = \\frac{\\delta}{2\\pi} = \\frac{1}{4}$。这些势阱之外的能量被视为无穷大，因此玻尔兹曼权重 $w(\\phi)$ 为零。势阱内给定的玻尔兹曼权重为 $w_{\\mathcal{A}} = 1$ 和 $w_{\\mathcal{B}} = 1/4$。\n\n单个均匀抽取的试验角度的玻尔兹曼权重期望值 $\\mathbb{E}[w]$ 为：\n$$\n\\mathbb{E}[w] = P(\\phi \\in \\mathcal{A}) w_{\\mathcal{A}} + P(\\phi \\in \\mathcal{B}) w_{\\mathcal{B}} + P(\\phi \\notin \\mathcal{A} \\cup \\mathcal{B}) \\cdot 0\n$$\n$$\n\\mathbb{E}[w] = \\left(\\frac{1}{4}\\right)(1) + \\left(\\frac{1}{4}\\right)\\left(\\frac{1}{4}\\right) = \\frac{1}{4} + \\frac{1}{16} = \\frac{5}{16}\n$$\n\n问题对接受率使用平均场近似，即 $\\langle P_{\\text{acc}}(k) \\rangle \\approx \\frac{\\mathbb{E}[W_{\\text{new}}]}{\\mathbb{E}[W_{\\text{old}}]}$。我们需要计算新旧罗森布鲁斯因子 $W_{\\text{new}}$ 和 $W_{\\text{old}}$ 的期望值。\n\n新的罗森布鲁斯因子为 $W_{\\text{new}} = \\sum_{j=1}^{k} w(\\phi_{j})$，其中 $k$ 个试验角度 $\\phi_j$ 是独立且均匀抽取的。根据期望的线性性质：\n$$\n\\mathbb{E}[W_{\\text{new}}] = \\sum_{j=1}^{k} \\mathbb{E}[w(\\phi_{j})] = k \\cdot \\mathbb{E}[w] = \\frac{5k}{16}\n$$\n\n旧的罗森布鲁斯因子为 $W_{\\text{old}} = w(\\phi_{\\text{old}}) + \\sum_{j=1}^{k-1} w(\\tilde{\\phi}_{j})$，其中 $\\phi_{\\text{old}}$ 是当前角度（从平衡分布中抽取），而 $\\tilde{\\phi}_{j}$ 是 $k-1$ 个独立的均匀试验角度。其期望值为：\n$$\n\\mathbb{E}[W_{\\text{old}}] = \\mathbb{E}[w(\\phi_{\\text{old}})] + \\sum_{j=1}^{k-1} \\mathbb{E}[w(\\tilde{\\phi}_{j})] = \\mathbb{E}[w(\\phi_{\\text{old}})] + (k-1)\\mathbb{E}[w]\n$$\n为了求得 $\\mathbb{E}[w(\\phi_{\\text{old}})]$，我们需要 $\\phi_{\\text{old}}$ 的平衡概率分布。这就是玻尔兹曼分布，$P_{\\text{eq}}(\\phi) = \\frac{w(\\phi)}{Z_{\\phi}}$，其中 $Z_{\\phi}$ 是扭转自由度的配分函数。\n$$\nZ_{\\phi} = \\int_{0}^{2\\pi} w(\\phi') d\\phi' = \\int_{\\mathcal{A}} w_{\\mathcal{A}} d\\phi' + \\int_{\\mathcal{B}} w_{\\mathcal{B}} d\\phi' = w_{\\mathcal{A}} \\delta + w_{\\mathcal{B}} \\delta\n$$\n$$\nZ_{\\phi} = (1)\\left(\\frac{\\pi}{2}\\right) + \\left(\\frac{1}{4}\\right)\\left(\\frac{\\pi}{2}\\right) = \\left(1 + \\frac{1}{4}\\right)\\frac{\\pi}{2} = \\frac{5}{4} \\frac{\\pi}{2} = \\frac{5\\pi}{8}\n$$\n在势阱 $\\mathcal{A}$ 中找到系统的平衡概率为 $P_{\\text{eq}}(\\mathcal{A}) = \\frac{w_{\\mathcal{A}}\\delta}{Z_{\\phi}} = \\frac{1 \\cdot (\\pi/2)}{5\\pi/8} = \\frac{4}{5}$。\n在势阱 $\\mathcal{B}$ 中找到系统的平衡概率为 $P_{\\text{eq}}(\\mathcal{B}) = \\frac{w_{\\mathcal{B}}\\delta}{Z_{\\phi}} = \\frac{(1/4) \\cdot (\\pi/2)}{5\\pi/8} = \\frac{\\pi/8}{5\\pi/8} = \\frac{1}{5}$。\n旧构象的期望权重 $\\mathbb{E}[w(\\phi_{\\text{old}})]$ 通过对平衡分布求平均来计算：\n$$\n\\mathbb{E}[w(\\phi_{\\text{old}})] = P_{\\text{eq}}(\\mathcal{A}) \\cdot w_{\\mathcal{A}} + P_{\\text{eq}}(\\mathcal{B}) \\cdot w_{\\mathcal{B}} = \\left(\\frac{4}{5}\\right)(1) + \\left(\\frac{1}{5}\\right)\\left(\\frac{1}{4}\\right) = \\frac{4}{5} + \\frac{1}{20} = \\frac{16+1}{20} = \\frac{17}{20}\n$$\n现在我们可以计算 $\\mathbb{E}[W_{\\text{old}}]$：\n$$\n\\mathbb{E}[W_{\\text{old}}] = \\frac{17}{20} + (k-1)\\frac{5}{16}\n$$\n为了简化，我们使用公分母 $80$：\n$$\n\\mathbb{E}[W_{\\text{old}}] = \\frac{17 \\cdot 4}{80} + (k-1)\\frac{5 \\cdot 5}{80} = \\frac{68}{80} + \\frac{25(k-1)}{80} = \\frac{68 + 25k - 25}{80} = \\frac{25k + 43}{80}\n$$\n近似接受率为：\n$$\n\\langle P_{\\text{acc}}(k) \\rangle = \\frac{\\mathbb{E}[W_{\\text{new}}]}{\\mathbb{E}[W_{\\text{old}}]} = \\frac{5k/16}{(25k+43)/80} = \\frac{25k/80}{(25k+43)/80} = \\frac{25k}{25k+43}\n$$\n每次移动的计算成本给定为 $t(k) = t_0 + t_1 k$，其中 $t_0=1$ 和 $t_1=1$，因此 $t(k) = 1+k$。效率为 $E(k) = \\frac{\\langle P_{\\text{acc}}(k) \\rangle}{t(k)}$：\n$$\nE(k) = \\frac{1}{1+k} \\left( \\frac{25k}{25k+43} \\right) = \\frac{25k}{(k+1)(25k+43)} = \\frac{25k}{25k^2 + 68k + 43}\n$$\n为了找到使 $E(k)$ 最大化的整数 $k \\ge 1$，我们首先将 $k$ 视为一个连续变量，并通过将导数 $\\frac{dE}{dk}$ 设为零来求最大值。导数的符号由其分子决定。使用商法则 $\\frac{d}{dx}\\frac{u}{v} = \\frac{u'v - uv'}{v^2}$，我们将分子设为零：\n$$\n\\frac{d}{dk}(25k) (25k^2 + 68k + 43) - (25k) \\frac{d}{dk}(25k^2 + 68k + 43) = 0\n$$\n$$\n25(25k^2 + 68k + 43) - 25k(50k + 68) = 0\n$$\n两边除以 $25$：\n$$\n(25k^2 + 68k + 43) - k(50k + 68) = 0\n$$\n$$\n25k^2 + 68k + 43 - 50k^2 - 68k = 0\n$$\n$$\n43 - 25k^2 = 0 \\implies 25k^2 = 43 \\implies k^2 = \\frac{43}{25}\n$$\n$$\nk = \\sqrt{\\frac{43}{25}} = \\frac{\\sqrt{43}}{5}\n$$\n因为 $6^2=36$ 且 $7^2=49$，所以 $\\sqrt{43}$ 介于 $6$ 和 $7$ 之间。具体来说，$\\sqrt{43} \\approx 6.557$。\n$$\nk \\approx \\frac{6.557}{5} \\approx 1.311\n$$\n函数 $E(k)$ 在 $k  \\sqrt{43}/5$ 时递增，在 $k > \\sqrt{43}/5$ 时递减。$k$ 的最优整数值必须是该值两侧的整数之一，即 $k=1$ 或 $k=2$。我们计算这两个值的 $E(k)$。\n\n对于 $k=1$：\n$$\nE(1) = \\frac{25(1)}{(1+1)(25(1)+43)} = \\frac{25}{2(68)} = \\frac{25}{136}\n$$\n\n对于 $k=2$：\n$$\nE(2) = \\frac{25(2)}{(2+1)(25(2)+43)} = \\frac{50}{3(50+43)} = \\frac{50}{3(93)} = \\frac{50}{279}\n$$\n为了比较 $E(1)$ 和 $E(2)$，我们比较分数 $\\frac{25}{136}$ 和 $\\frac{50}{279}$。\n这等价于比较 $\\frac{1}{136}$ 和 $\\frac{2}{279}$。\n交叉相乘，我们比较 $1 \\times 279$ 和 $2 \\times 136$。\n$$\n279 \\quad \\text{vs} \\quad 272\n$$\n由于 $279 > 272$，我们有 $\\frac{1}{136} > \\frac{2}{279}$，这意味着 $\\frac{25}{136} > \\frac{50}{279}$。\n因此，$E(1) > E(2)$。效率在 $k=1$ 时达到最大值。\n为了完整起见，我们可以检查 $k=3$：$E(3) = \\frac{75}{4(118)} = \\frac{75}{472} \\approx 0.159$。由于 $E(2) \\approx 0.179$ 且 $E(1) \\approx 0.184$，函数在 $k \\ge 2$ 时是递减的。\n\n使单位时间的有效样本量最大化的整数 $k$ 值为 $1$。",
            "answer": "$$\\boxed{1}$$"
        }
    ]
}