{
    "hands_on_practices": [
        {
            "introduction": "Car-Parrinello分子动力学的一个核心挑战在于维持离子与赝电子自由度之间的绝热分离。此练习将引导您探索这一关键原则，通过计算赝质量 $\\mu$ 的上限，以确保电子系统的响应远快于离子的运动，从而避免非物理性的能量转移 。掌握这一计算是设置稳定可靠CPMD模拟的第一步。",
            "id": "3741059",
            "problem": "考虑 Car-Parrinello 分子动力学 (CPMD)，其中电子自由度通过一个以类质量参数 $\\mu$ 为特征的虚构动能项进行演化，以强制实现与离子运动的绝热分离。在CPMD中，从标准的拉格朗日结构出发，其中虚构电子动能与 $\\mu \\sum |\\dot{\\psi}|^{2}$ 成正比，且基态附近的电子势能曲率由 Born-Oppenheimer 能隙 $\\Delta$ 决定。利用电子变量小振荡的谐振子近似，以及特征电子角频率 $\\omega_{e}$ 至少比主导离子角频率 $\\omega_{i}$ 大十倍的分离要求，推导保证 $\\omega_{e}/\\omega_{i} \\geq 10$ 的对 $\\mu$ 的约束条件。然后，取 $\\Delta = 2\\ \\mathrm{eV}$ 和 $\\omega_{i} = 2 \\times 10^{13}\\ \\mathrm{s}^{-1}$，计算相应的上限 $\\mu_{\\max}$，单位为 $\\mathrm{J \\cdot s^{2}}$。给出 $\\mu_{\\max}$ 的数值，并据此解释满足分离判据的 $\\mu$ 的安全范围。将 $\\mu_{\\max}$ 的最终数值答案以 $\\mathrm{J \\cdot s^{2}}$ 为单位表示，并四舍五入到四位有效数字。",
            "solution": "所述问题具有科学依据，提法恰当，客观，并包含足够的信息以获得唯一解。它描述了在 Car-Parrinello 分子动力学 (CPMD) 中确保绝热性的一个标准条件，CPMD 是计算物理学中一个成熟的方法。因此，该问题是有效的，我们继续进行求解。\n\nCPMD 的核心原理是将电子波函数 $\\{\\psi_k\\}$ 视为随时间演化的经典自由度，由一个虚构的动能项控制。虚构电子动力学的拉格朗日量可以写为：\n$$L_e = \\frac{1}{2} \\mu \\sum_k \\int |\\dot{\\psi}_k(\\mathbf{r}, t)|^2 d\\mathbf{r} - E_{BO}[\\{\\psi_k\\}]$$\n其中 $\\mu$ 是虚构质量，$\\dot{\\psi}_k$ 是第 $k$ 个电子轨道的时间导数，$E_{BO}$ 是 Born-Oppenheimer 能量面，它同时作为离子和虚构电子系统的势能。问题陈述中指出动能“与 $\\mu \\sum |\\dot{\\psi}|^{2}$ 成正比”应在这种标准拉格朗日形式的背景下解释，其中因子 $\\frac{1}{2}$ 是动能项的常规写法。\n\n从此拉格朗日量导出的电子轨道运动方程为：\n$$\\mu \\ddot{\\psi}_k = -\\frac{\\delta E_{BO}}{\\delta \\psi_k^*} + \\text{constraints}$$\n为了找到电子系统的特征频率 $\\omega_e$，我们考虑围绕电子基态的小幅振荡。势能 $E_{BO}$ 可以在其最小值附近进行二次展开。问题通过说明该势能的曲率由最高占据电子态和最低未占据电子态之间的能隙 $\\Delta$ 决定，从而简化了这一点。\n\n我们可以将最低频率电子激发模式的动力学建模为一个简谐振子。这个振子的“质量”是虚构质量 $\\mu$。有效“弹簧常数” $k_e$ 与能隙 $\\Delta$ 相关。对电子轨道的线性化运动方程进行标准分析表明，对应于从一个占据态 $i$ 激发到一个未占据态 $j$（能量差为 $\\epsilon_j - \\epsilon_i$）的角频率 $\\omega_{e, i \\to j}$ 由下式给出：\n$$\\omega_{e, i \\to j}^2 = \\frac{2(\\epsilon_j - \\epsilon_i)}{\\mu}$$\n维持绝热分离的最低也是最关键的频率对应于最小的能隙，即 Born-Oppenheimer 能隙 $\\Delta$。因此，特征电子频率 $\\omega_e$ 由下式给出：\n$$\\omega_e^2 = \\frac{2\\Delta}{\\mu}$$\n\n问题要求电子和离子运动之间存在绝热分离，具体条件是电子频率必须显著大于主导离子频率 $\\omega_i$：\n$$\\frac{\\omega_e}{\\omega_i} \\geq 10$$\n将此不等式两边平方得到：\n$$\\frac{\\omega_e^2}{\\omega_i^2} \\geq 100$$\n代入我们关于 $\\omega_e^2$ 的表达式：\n$$\\frac{2\\Delta / \\mu}{\\omega_i^2} \\geq 100$$\n现在我们可以解出对虚构质量 $\\mu$ 的约束条件：\n$$\\frac{2\\Delta}{\\omega_i^2} \\geq 100 \\mu$$\n$$\\mu \\leq \\frac{2\\Delta}{100 \\omega_i^2}$$\n$$\\mu \\leq \\frac{\\Delta}{50 \\omega_i^2}$$\n这个不等式定义了确保绝热分离的 $\\mu$ 的安全范围。因此，$\\mu$ 的上限为：\n$$\\mu_{\\max} = \\frac{\\Delta}{50 \\omega_i^2}$$\n\n现在，我们使用所提供的数据计算 $\\mu_{\\max}$ 的数值。首先，所有值都必须转换为国际单位制（SI）基本单位。\n给定的能隙为 $\\Delta = 2\\ \\mathrm{eV}$。使用元电荷 $e \\approx 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$，我们将电子伏特转换为焦耳：\n$$\\Delta = 2 \\times (1.602176634 \\times 10^{-19}\\ \\mathrm{J}) = 3.204353268 \\times 10^{-19}\\ \\mathrm{J}$$\n主导离子频率为 $\\omega_i = 2 \\times 10^{13}\\ \\mathrm{s}^{-1}$。\n\n将这些值代入 $\\mu_{\\max}$ 的表达式：\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}\\ \\mathrm{J}}{50 \\times (2 \\times 10^{13}\\ \\mathrm{s}^{-1})^2}$$\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}\\ \\mathrm{J}}{50 \\times (4 \\times 10^{26}\\ \\mathrm{s}^{-2})}$$\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}\\ \\mathrm{J}}{200 \\times 10^{26}\\ \\mathrm{s}^{-2}}$$\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}}{2 \\times 10^{28}}\\ \\mathrm{J \\cdot s^2}$$\n$$\\mu_{\\max} = 1.602176634 \\times 10^{-47}\\ \\mathrm{J \\cdot s^2}$$\n按要求将结果四舍五入到四位有效数字：\n$$\\mu_{\\max} \\approx 1.602 \\times 10^{-47}\\ \\mathrm{J \\cdot s^2}$$\n\n满足分离判据的 $\\mu$ 的安全范围是 $0  \\mu \\le \\mu_{\\max}$。大于 $\\mu_{\\max}$ 的 $\\mu$ 值会导致虚构电子系统振荡过慢，从而导致绝热分离失效和离子系统的非物理性加热。一个过于接近零的 $\\mu$ 值，虽然满足绝热性条件，但会要求数值积分运动方程时采用不切实际的小时间步长，使得模拟在计算上不可行。推导出的约束条件专门针对绝热性的物理要求。",
            "answer": "$$\\boxed{1.602 \\times 10^{-47}}$$"
        },
        {
            "introduction": "理论上理解绝热条件后，通过模拟观察其被破坏的后果将极大地加深理解。本实践通过一个简化的双振子模型，让您亲手编写程序来模拟当赝质量 $\\mu$ 过大时，能量是如何从离子系统“泄漏”到赝电子系统中的 。这个练习将一个抽象的概念变得具体可见，直观地揭示了维持绝热性的重要性。",
            "id": "2451938",
            "problem": "考虑一个Car-Parrinello分子动力学（CPMD）的极简、纯粹的经典替代模型，该模型捕捉了慢的离子自由度与快的虚拟电子自由度之间的相互作用。离子坐标用 $x$ 表示，质量为 $M$；虚拟电子坐标用 $y$ 表示，虚拟质量为 $\\mu$。该系统由以下拉格朗日量控制\n$$\n\\mathcal{L}(x,\\dot{x},y,\\dot{y})=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}\\mu\\dot{y}^2-\\left[\\frac{1}{2}K x^2+\\frac{1}{2}k_e \\left(y-a x\\right)^2\\right],\n$$\n其中 $K$ 和 $k_e$ 是正常数力常数，$a$ 是一个无量纲耦合系数。这个拉格朗日量模拟了CPMD的思想，即对于每个离子构型 $x$，都存在一个由 $y=a x$ 给出的电子基态流形。在绝热机制下，电子自由度 $y$ 保持在 $a x$ 附近，储存的能量可以忽略不计；而如果绝热条件被违反（例如，通过选择一个大的虚拟质量 $\\mu$，使得电子频率不远大于离子频率），能量可以从离子运动转移或“泄漏”到虚拟电子运动中。\n\n仅从牛顿定律，即欧拉-拉格朗日方程 $d/dt(\\partial \\mathcal{L}/\\partial \\dot{q})-\\partial \\mathcal{L}/\\partial q=0$，以及动能和势能的定义出发，执行以下任务：\n\n1) 推导上述拉格朗日量所蕴含的 $x(t)$ 和 $y(t)$ 的耦合运动方程。\n\n2) 定义总守恒能量\n$$\nE_{\\text{tot}}(t)=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}\\mu\\dot{y}^2+\\frac{1}{2}K x^2+\\frac{1}{2}k_e\\left(y-a x\\right)^2,\n$$\n“离子”能量\n$$\nE_{\\text{ion}}(t)=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}K x^2,\n$$\n以及“电子”能量\n$$\nE_{\\text{el}}(t)=\\frac{1}{2}\\mu\\dot{y}^2+\\frac{1}{2}k_e\\left(y-a x\\right)^2.\n$$\n证明在精确积分下 $E_{\\text{tot}}(t)$ 是守恒的，并且如果初始条件满足 $y(0)=a x(0)$ 和 $\\dot{y}(0)=0$，则 $E_{\\text{el}}(0)=0$。\n\n3) 实现一个速度-Verlet积分器，对所有测试用例使用以下固定的初始条件来数值积分运动方程：$x(0)=1$, $\\dot{x}(0)=0$, $y(0)=a x(0)$, $\\dot{y}(0)=0$。全程使用无量纲单位，即没有物理单位。\n\n4) 对于每次模拟，报告标量泄漏度量\n$$\nr=\\max_{0\\le t\\le T}\\frac{E_{\\text{el}}(t)}{E_{\\text{tot}}(0)},\n$$\n即在轨迹上，虚拟电子子系统中所存储的能量占初始总能量的最大比例。该度量是无量纲的。使用恒定的时间步长 $\\Delta t$ 和固定的步数 $N_{\\text{steps}}$，使得最终模拟时间为 $T=N_{\\text{steps}}\\Delta t$。\n\n您的程序必须实现该算法，并为以下每个测试用例计算 $r$（所有参数均为无量纲）：\n\n- 测试用例 A（解耦基线，预期无泄漏）：\n  - $M=10$, $\\mu=0.5$, $K=1$, $k_e=100$, $a=0$, $\\Delta t=10^{-3}$, $N_{\\text{steps}}=10^5$.\n\n- 测试用例 B（强绝热分离，预期泄漏极小）：\n  - $M=10$, $\\mu=0.2$, $K=1$, $k_e=100$, $a=1$, $\\Delta t=10^{-3}$, $N_{\\text{steps}}=10^5$.\n\n- 测试用例 C（中等程度的绝热性破坏，预期有明显泄漏）：\n  - $M=10$, $\\mu=10$, $K=1$, $k_e=100$, $a=1$, $\\Delta t=10^{-3}$, $N_{\\text{steps}}=10^5$.\n\n- 测试用例 D（近共振破坏，预期有强泄漏）：\n  - $M=10$, $\\mu=1000$, $K=1$, $k_e=100$, $a=1$, $\\Delta t=10^{-3}$, $N_{\\text{steps}}=10^5$.\n\n最终输出格式必须是单行，包含一个列表，其中含有测试用例 A 到 D 的四个 $r$ 值，以逗号分隔并用方括号括起来，顺序与上文相同（例如，$[r_A,r_B,r_C,r_D]$）。要求的输出是无量纲的，并且必须严格以此单行格式打印，不得包含任何额外文本。",
            "solution": "所述问题在科学上是合理的、自洽的，并且在数学上是适定的。它提出了一个有效的经典力学问题，可作为Car-Parrinello分子动力学中相关概念的简化模型。因此，可以构建一个严谨的解。\n\n各项任务按顺序解决。\n\n**1. 运动方程的推导**\n\n系统的动力学由每个坐标 $q_i \\in \\{x, y\\}$ 的欧拉-拉格朗日方程控制：\n$$\n\\frac{d}{dt}\\left(\\frac{\\partial \\mathcal{L}}{\\partial \\dot{q}_i}\\right) - \\frac{\\partial \\mathcal{L}}{\\partial q_i} = 0\n$$\n拉格朗日量由下式给出\n$$\n\\mathcal{L}(x,\\dot{x},y,\\dot{y})=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}\\mu\\dot{y}^2-V(x,y)\n$$\n其中势能为 $V(x,y) = \\frac{1}{2}K x^2+\\frac{1}{2}k_e \\left(y-a x\\right)^2$。\n\n对于离子坐标 $x$：\n拉格朗日量的偏导数为：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\dot{x}} = M\\dot{x}\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial x} = -\\frac{\\partial V}{\\partial x} = -\\left[Kx + k_e(y-ax)(-a)\\right] = -Kx + ak_e(y-ax)\n$$\n将这些代入欧拉-拉格朗日方程，得到 $x(t)$ 的运动方程：\n$$\n\\frac{d}{dt}(M\\dot{x}) - (-Kx + ak_e(y-ax)) = 0\n$$\n$$\nM\\ddot{x} = -Kx + ak_e(y-ax)\n$$\n\n对于虚拟电子坐标 $y$：\n拉格朗日量的偏导数为：\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\dot{y}} = \\mu\\dot{y}\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial y} = -\\frac{\\partial V}{\\partial y} = -k_e(y-ax)\n$$\n将这些代入欧拉-拉格朗日方程，得到 $y(t)$ 的运动方程：\n$$\n\\frac{d}{dt}(\\mu\\dot{y}) - (-k_e(y-ax)) = 0\n$$\n$$\n\\mu\\ddot{y} = -k_e(y-ax)\n$$\n这两个耦合的二阶常微分方程，\n$$\n\\ddot{x}(t) = \\frac{1}{M}\\left[-Kx(t) - ak_e(ax(t)-y(t))\\right]\n$$\n$$\n\\ddot{y}(t) = \\frac{1}{\\mu}\\left[-k_e(y(t)-ax(t))\\right]\n$$\n描述了系统的演化。\n\n**2. 能量分析**\n\n系统的总能量是动能和势能之和，$E_{\\text{tot}} = T+V$。\n$$\nE_{\\text{tot}}(t)=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}\\mu\\dot{y}^2+\\frac{1}{2}K x^2+\\frac{1}{2}k_e\\left(y-a x\\right)^2\n$$\n拉格朗日量不是时间的显式函数，即 $\\frac{\\partial \\mathcal{L}}{\\partial t} = 0$。对于此类系统，哈密顿量 $H = \\sum_i \\dot{q}_i \\frac{\\partial \\mathcal{L}}{\\partial \\dot{q}_i} - \\mathcal{L}$ 是一个守恒量。对于这个特定的拉格朗日量，哈密顿量与总能量 $E_{\\text{tot}}$ 完全相同，因此 $E_{\\text{tot}}$ 是守恒的。\n\n或者，可以通过证明其全时间导数为零来证明守恒性，这需要使用先前推导出的运动方程：\n$$\n\\frac{dE_{\\text{tot}}}{dt} = M\\dot{x}\\ddot{x} + \\mu\\dot{y}\\ddot{y} + Kx\\dot{x} + k_e(y-ax)(\\dot{y}-a\\dot{x})\n$$\n代入 $M\\ddot{x}$ 和 $\\mu\\ddot{y}$ 的表达式：\n$$\n\\frac{dE_{\\text{tot}}}{dt} = \\dot{x}\\left(-Kx + ak_e(y-ax)\\right) + \\dot{y}\\left(-k_e(y-ax)\\right) + Kx\\dot{x} + k_e(y-ax)(\\dot{y}-a\\dot{x})\n$$\n展开并合并同类项：\n$$\n\\frac{dE_{\\text{tot}}}{dt} = \\left[-Kx\\dot{x} + Kx\\dot{x}\\right] + \\left[ak_e\\dot{x}(y-ax) - ak_e\\dot{x}(y-ax)\\right] + \\left[-k_e\\dot{y}(y-ax) + k_e\\dot{y}(y-ax)\\right] = 0\n$$\n因此，在精确动力学下，$E_{\\text{tot}}(t)$ 是一个常数。\n\n接下来，我们根据给定的初始条件 $y(0)=a x(0)$ 和 $\\dot{y}(0)=0$ 来计算初始电子能量 $E_{\\text{el}}(0)$。\n$$\nE_{\\text{el}}(t)=\\frac{1}{2}\\mu\\dot{y}^2+\\frac{1}{2}k_e\\left(y-a x\\right)^2\n$$\n在时间 $t=0$ 时：\n$$\nE_{\\text{el}}(0) = \\frac{1}{2}\\mu(\\dot{y}(0))^2 + \\frac{1}{2}k_e(y(0)-ax(0))^2 = \\frac{1}{2}\\mu(0)^2 + \\frac{1}{2}k_e(ax(0)-ax(0))^2 = 0\n$$\n这表明系统在初始化时，所有能量都分配给了离子子系统，而电子子系统处于其瞬时基态，动能为零。\n\n**3.  4. 数值积分与泄漏度量**\n\n耦合运动方程使用速度-Verlet算法进行数值积分。该方法是辛算法，并表现出良好的长期能量守恒特性。设时间 $t$ 时的位置为 $(x(t), y(t))$，速度为 $(\\dot{x}(t), \\dot{y}(t))$，加速度为 $(A_x(t), A_y(t))$。大小为 $\\Delta t$ 的单个积分步骤如下：\n\n首先，将速度更新到半步：\n$$\n\\dot{x}(t+\\frac{1}{2}\\Delta t) = \\dot{x}(t) + \\frac{1}{2} A_x(t) \\Delta t\n$$\n$$\n\\dot{y}(t+\\frac{1}{2}\\Delta t) = \\dot{y}(t) + \\frac{1}{2} A_y(t) \\Delta t\n$$\n其次，使用半步速度将位置更新到完整步长：\n$$\nx(t+\\Delta t) = x(t) + \\dot{x}(t+\\frac{1}{2}\\Delta t) \\Delta t\n$$\n$$\ny(t+\\Delta t) = y(t) + \\dot{y}(t+\\frac{1}{2}\\Delta t) \\Delta t\n$$\n第三，使用新位置 $x(t+\\Delta t)$ 和 $y(t+\\Delta t)$ 计算新的加速度 $A_x(t+\\Delta t)$ 和 $A_y(t+\\Delta t)$。\n第四，完成速度到完整步长的更新：\n$$\n\\dot{x}(t+\\Delta t) = \\dot{x}(t+\\frac{1}{2}\\Delta t) + \\frac{1}{2} A_x(t+\\Delta t) \\Delta t\n$$\n$$\n\\dot{y}(t+\\Delta t) = \\dot{y}(t+\\frac{1}{2}\\Delta t) + \\frac{1}{2} A_y(t+\\Delta t) \\Delta t\n$$\n此过程重复 $N_{\\text{steps}}$ 次。\n\n泄漏度量 $r$ 量化了向电子子系统转移的最大能量。其计算公式为：\n$$\nr = \\max_{0 \\le t \\le T} \\frac{E_{\\text{el}}(t)}{E_{\\text{tot}}(0)}\n$$\n对于每次模拟，初始总能量由初始条件 $x(0)=1$、$\\dot{x}(0)=0$、$y(0)=a$、$\\dot{y}(0)=0$ 计算得出：\n$$\nE_{\\text{tot}}(0) = \\frac{1}{2}M(0)^2 + \\frac{1}{2}\\mu(0)^2 + \\frac{1}{2}K(1)^2 + \\frac{1}{2}k_e(a-a(1))^2 = \\frac{1}{2}K\n$$\n在模拟的每个时间步 $t_i = i\\Delta t$，计算电子能量 $E_{\\text{el}}(t_i)$。将比率 $E_{\\text{el}}(t_i)/E_{\\text{tot}}(0)$ 与迄今为止找到的最大值进行比较，并相应地更新最大值。$N_{\\text{steps}}$ 步后的最终最大值即为结果 $r$。提供了一个Python程序来对指定的测试用例执行此计算。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the coupled oscillator problem for the given test cases\n    and computes the energy leakage metric.\n    \"\"\"\n\n    test_cases = [\n        # Test case A (decoupled baseline)\n        {'M': 10.0, 'mu': 0.5, 'K': 1.0, 'ke': 100.0, 'a': 0.0, 'dt': 1e-3, 'N_steps': 100000},\n        # Test case B (strong adiabatic separation)\n        {'M': 10.0, 'mu': 0.2, 'K': 1.0, 'ke': 100.0, 'a': 1.0, 'dt': 1e-3, 'N_steps': 100000},\n        # Test case C (moderate violation)\n        {'M': 10.0, 'mu': 10.0, 'K': 1.0, 'ke': 100.0, 'a': 1.0, 'dt': 1e-3, 'N_steps': 100000},\n        # Test case D (near-resonant violation)\n        {'M': 10.0, 'mu': 1000.0, 'K': 1.0, 'ke': 100.0, 'a': 1.0, 'dt': 1e-3, 'N_steps': 100000},\n    ]\n\n    results = []\n    for params in test_cases:\n        r = calculate_leakage(**params)\n        results.append(r)\n\n    # Format the output exactly as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_leakage(M, mu, K, ke, a, dt, N_steps):\n    \"\"\"\n    Implements the velocity-Verlet integrator for the CPMD toy model\n    and calculates the energy leakage metric r.\n    \"\"\"\n    # Initial conditions\n    x = 1.0\n    x_dot = 0.0\n    y = a * x\n    y_dot = 0.0\n    \n    # Calculate initial total energy, which is conserved.\n    # E_tot(0) = 0.5*M*x_dot(0)^2 + 0.5*mu*y_dot(0)^2 + 0.5*K*x(0)^2 + 0.5*ke*(y(0)-a*x(0))^2\n    # With given initial conditions, this simplifies to:\n    e_tot_initial = 0.5 * K * x**2\n    \n    # If initial total energy is zero, leakage is undefined.\n    # This happens if K=0, but problem states K>0.\n    if e_tot_initial == 0:\n        return 0.0\n\n    # Variable to store the maximum leakage ratio\n    max_leakage_ratio = 0.0\n\n    # Function to compute accelerations\n    def get_accelerations(x_pos, y_pos):\n        common_term = ke * (y_pos - a * x_pos)\n        x_accel = (-K * x_pos + a * common_term) / M\n        y_accel = (-common_term) / mu\n        return x_accel, y_accel\n\n    # Initial a(t)\n    x_ddot, y_ddot = get_accelerations(x, y)\n    \n    # Main simulation loop using velocity-Verlet\n    for _ in range(N_steps):\n        # 1. Update velocities to mid-step v(t + dt/2)\n        x_dot_half = x_dot + 0.5 * x_ddot * dt\n        y_dot_half = y_dot + 0.5 * y_ddot * dt\n        \n        # 2. Update positions to full-step x(t + dt)\n        x = x + x_dot_half * dt\n        y = y + y_dot_half * dt\n        \n        # 3. Compute new accelerations a(t + dt) at new positions\n        x_ddot_new, y_ddot_new = get_accelerations(x, y)\n        \n        # 4. Update velocities to full-step v(t + dt)\n        x_dot = x_dot_half + 0.5 * x_ddot_new * dt\n        y_dot = y_dot_half + 0.5 * y_ddot_new * dt\n        \n        # Update current accelerations for the next step\n        x_ddot, y_ddot = x_ddot_new, y_ddot_new\n        \n        # Calculate electronic energy at current step\n        e_el = 0.5 * mu * y_dot**2 + 0.5 * ke * (y - a * x)**2\n        \n        # Calculate leakage ratio and update the maximum\n        leakage_ratio = e_el / e_tot_initial\n        if leakage_ratio > max_leakage_ratio:\n            max_leakage_ratio = leakage_ratio\n            \n    return max_leakage_ratio\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "CPMD方法虽然强大，但其引入的赝动力学也会对计算结果产生系统性的影响。本练习将探讨其中一个最显著的可观测效应：分子振动频率的“红移”。通过计算，您将理解赝电子系统的惯性是如何等效地增加了原子核的有效质量，从而导致振动频率相较于真实的玻恩-奥本海默动力学有所降低。",
            "id": "2451924",
            "problem": "将一个三原子水分子建模为三个独立的一维谐振正交模：一个弯曲振动、一个对称伸缩振动和一个反对称伸缩振动。在此模型中，每个模式 $i$ 由一个有效核质量 $M_i$（单位为 $\\mathrm{kg}$）和一个谐波力常数 $k_i$（单位为 $\\mathrm{N\\ m^{-1}}$）来描述。考虑两种动力学描述：\n\n- Born–Oppenheimer 分子动力学 (BOMD)：原子核在电子基态势能面上运动，没有电子惯性；模式 $i$ 的角频率为 $\\,\\omega_i^{\\mathrm{B}} = \\sqrt{k_i/M_i}\\,$。\n- Car–Parrinello 分子动力学 (CPMD)：原子核与由虚拟电子质量 $\\mu$（单位为 $\\mathrm{kg}$）表征的虚拟电子动力学耦合。在绝热分离条件下，虚拟动力学对模式 $i$ 的影响是模式特定的质量重整化 $\\,M_i \\mapsto M_i + \\Delta M_i\\,$，其中 $\\,\\Delta M_i = \\mu\\,\\Lambda_i\\,$，$\\Lambda_i$ 是该模式给定的正无量纲绝热耦合度规。CPMD 的角频率为 $\\,\\omega_i^{\\mathrm{C}} = \\sqrt{k_i/(M_i+\\Delta M_i)}\\,$。\n\n设模式 $i$ 的波数（单位为 $\\mathrm{cm^{-1}}$）为 $\\,\\tilde{\\nu}_i = \\omega_i/(2\\pi c)\\,$，其中 $c$ 是光速。定义 CPMD 对模式 $i$ 引起的红移为 $\\,\\Delta\\tilde{\\nu}_i = \\tilde{\\nu}_i^{\\mathrm{B}} - \\tilde{\\nu}_i^{\\mathrm{C}}\\,$。使用常数 $\\,c = 2.99792458\\times 10^{10}\\ \\mathrm{cm\\ s^{-1}}\\,$ 和 $\\,m_e = 9.1093837015\\times 10^{-31}\\ \\mathrm{kg}\\,$。所有最终的波数和红移必须以 $\\mathrm{cm^{-1}}$ 表示，并四舍五入到小数点后两位。\n\n计算下列每个测试案例的 $\\,\\tilde{\\nu}_i^{\\mathrm{B}}\\,$, $\\,\\tilde{\\nu}_i^{\\mathrm{C}}\\,$ 和 $\\,\\Delta\\tilde{\\nu}_i\\,$（每个案例是一个元组 $(M_i,k_i,\\mu,\\Lambda_i)$）：\n\n- 案例 $1$（弯曲振动，正常路径）：$\\,M_1 = 5.5\\times 10^{-27}\\ \\mathrm{kg}\\,$, $\\,k_1 = 500.0\\ \\mathrm{N\\ m^{-1}}\\,$, $\\,\\mu = 400\\,m_e\\,$, $\\,\\Lambda_1 = 0.3\\,$.\n- 案例 $2$（对称伸缩振动，正常路径）：$\\,M_2 = 1.66053906660\\times 10^{-27}\\ \\mathrm{kg}\\,$, $\\,k_2 = 790.0\\ \\mathrm{N\\ m^{-1}}\\,$, $\\,\\mu = 400\\,m_e\\,$, $\\,\\Lambda_2 = 0.5\\,$.\n- 案例 $3$（反对称伸缩振动，更强耦合）：$\\,M_3 = 1.66053906660\\times 10^{-27}\\ \\mathrm{kg}\\,$, $\\,k_3 = 830.0\\ \\mathrm{N\\ m^{-1}}\\,$, $\\,\\mu = 600\\,m_e\\,$, $\\,\\Lambda_3 = 0.7\\,$.\n- 案例 $4$（边界情况，无虚拟动力学）：$\\,M_4 = 1.66053906660\\times 10^{-27}\\ \\mathrm{kg}\\,$, $\\,k_4 = 790.0\\ \\mathrm{N\\ m^{-1}}\\,$, $\\,\\mu = 0\\,\\mathrm{kg}\\,$, $\\,\\Lambda_4 = 0.5\\,$.\n\n您的程序应输出单行文本，其中包含四个案例的结果。结果为一个逗号分隔的列表，并用方括号括起来。每个案例贡献一个包含三个浮点数的子列表 $[\\tilde{\\nu}_i^{\\mathrm{B}},\\tilde{\\nu}_i^{\\mathrm{C}},\\Delta\\tilde{\\nu}_i]$，单位为 $\\mathrm{cm^{-1}}$，每个数值都四舍五入到小数点后两位。例如，整体格式必须是\n\"[[x_{1,\\mathrm{B}},x_{1,\\mathrm{C}},x_{1,\\Delta}],[x_{2,\\mathrm{B}},x_{2,\\mathrm{C}},x_{2,\\Delta}],[x_{3,\\mathrm{B}},x_{3,\\mathrm{C}},x_{3,\\Delta}],[x_{4,\\mathrm{B}},x_{4,\\mathrm{C}},x_{4,\\Delta}]]\"，不得有任何附加文本。",
            "solution": "所述问题有效。它在科学上是合理的，内容自洽，且数学上是适定的。它要求在 Born-Oppenheimer 和 Car-Parrinello 分子动力学已建立的理论框架内计算振动频率。我们开始进行解答。\n\n基本物理模型是一维简谐振子，用于描述分子的每个正交模 $i$。角频率 $\\omega$ 由振子的有效质量 $M$ 和力常数 $k$ 决定。\n\n在 Born–Oppenheimer 分子动力学 (BOMD) 中，假定原子核在由瞬时基态电子定义的势能面上运动。电子自由度没有与之关联的虚拟惯性。因此，模式 $i$ 的 BOMD 角频率由标准公式给出：\n$$ \\omega_i^{\\mathrm{B}} = \\sqrt{\\frac{k_i}{M_i}} $$\n其中 $M_i$ 是核有效质量，$k_i$ 是力常数。\n\n在 Car–Parrinello 分子动力学 (CPMD) 中，电子波函数被视为具有虚拟质量 $\\mu$ 的动力学变量。这种虚拟动力学引入了一种与核运动耦合的惯性。在良好的绝热分离极限下，这种耦合导致每个模式的核质量发生重整化。模式 $i$ 的有效质量变为：\n$$ M_i^{\\mathrm{C}} = M_i + \\Delta M_i $$\n质量修正 $\\Delta M_i$ 由以下公式给出：\n$$ \\Delta M_i = \\mu \\Lambda_i $$\n其中 $\\Lambda_i$ 是模式特定的绝热耦合度规，一个正的无量纲量。因此，模式 $i$ 的 CPMD 角频率为：\n$$ \\omega_i^{\\mathrm{C}} = \\sqrt{\\frac{k_i}{M_i^{\\mathrm{C}}}} = \\sqrt{\\frac{k_i}{M_i + \\mu \\Lambda_i}} $$\n由于 $\\mu \\ge 0$ 且 $\\Lambda_i  0$，有效质量 $M_i^{\\mathrm{C}}$ 总是大于或等于 $M_i$。这导致 $\\omega_i^{\\mathrm{C}} \\le \\omega_i^{\\mathrm{B}}$，这种现象被称为振动频率的红移。\n\n角频率 $\\omega$（单位为 $\\mathrm{s}^{-1}$）通过光速 $c$ 转换为波数 $\\tilde{\\nu}$（单位为 $\\mathrm{cm}^{-1}$）：\n$$ \\tilde{\\nu}_i = \\frac{\\omega_i}{2\\pi c} $$\n波数的红移定义为 BOMD 和 CPMD 值之间的差：\n$$ \\Delta\\tilde{\\nu}_i = \\tilde{\\nu}_i^{\\mathrm{B}} - \\tilde{\\nu}_i^{\\mathrm{C}} $$\n我们将这些原理应用于每个案例提供的数据，使用物理常数 $c = 2.99792458 \\times 10^{10}\\ \\mathrm{cm\\ s^{-1}}$ 和 $m_e = 9.1093837015 \\times 10^{-31}\\ \\mathrm{kg}$。虚拟质量 $\\mu$ 以电子质量 $m_e$ 为单位给出，计算时必须转换为千克。\n\n对于每个案例 $(M_i, k_i, \\mu, \\Lambda_i)$，我们计算：\n$1$. BOMD 波数：$\\tilde{\\nu}_i^{\\mathrm{B}} = \\frac{1}{2\\pi c} \\sqrt{\\frac{k_i}{M_i}}$\n$2$. CPMD 波数：$\\tilde{\\nu}_i^{\\mathrm{C}} = \\frac{1}{2\\pi c} \\sqrt{\\frac{k_i}{M_i + \\mu \\Lambda_i}}$\n$3$. 红移：$\\Delta\\tilde{\\nu}_i = \\tilde{\\nu}_i^{\\mathrm{B}} - \\tilde{\\nu}_i^{\\mathrm{C}}$\n\n数值评估是这些公式的直接应用。根据此程序处理所提供的测试案例，以获得所需的量，然后四舍五入到小数点后两位。案例 4 中 $\\mu = 0\\ \\mathrm{kg}$，作为一个对照组：由于没有虚拟电子质量，$\\Delta M_4=0$，因此 $M_4^{\\mathrm{C}} = M_4$。这正确地恢复了 BOMD 极限，此时 $\\tilde{\\nu}_4^{\\mathrm{C}} = \\tilde{\\nu}_4^{\\mathrm{B}}$ 且红移 $\\Delta\\tilde{\\nu}_4$ 为零。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes Born-Oppenheimer and Car-Parrinello vibrational wavenumbers and\n    the resulting red-shift for a set of harmonic normal modes.\n    \"\"\"\n    # Define physical constants from the problem statement.\n    c_cms = 2.99792458e10  # Speed of light in cm/s\n    m_e_kg = 9.1093837015e-31  # Electron mass in kg\n\n    # Define test cases as tuples: (M_i (kg), k_i (N/m), mu (in units of m_e), Lambda_i).\n    test_cases = [\n        (5.5e-27, 500.0, 400.0, 0.3),                 # Case 1: Bend\n        (1.66053906660e-27, 790.0, 400.0, 0.5),       # Case 2: Symmetric stretch\n        (1.66053906660e-27, 830.0, 600.0, 0.7),       # Case 3: Asymmetric stretch\n        (1.66053906660e-27, 790.0, 0.0, 0.5),         # Case 4: Boundary (mu=0)\n    ]\n\n    all_results_str = []\n\n    for M_i, k_i, mu_me, Lambda_i in test_cases:\n        # Convert fictitious mass mu from units of electron mass to kg.\n        mu_kg = mu_me * m_e_kg\n\n        # Calculate BOMD angular frequency and wavenumber.\n        omega_B = np.sqrt(k_i / M_i)\n        nu_B = omega_B / (2 * np.pi * c_cms)\n\n        # Calculate the CPMD mass renormalization and effective mass.\n        Delta_M_i = mu_kg * Lambda_i\n        M_i_C = M_i + Delta_M_i\n\n        # Calculate CPMD angular frequency and wavenumber.\n        omega_C = np.sqrt(k_i / M_i_C)\n        nu_C = omega_C / (2 * np.pi * c_cms)\n        \n        # Calculate the red-shift in wavenumber.\n        delta_nu = nu_B - nu_C\n        \n        # Format results to two decimal places as strings. This also handles rounding.\n        nu_B_str = f\"{nu_B:.2f}\"\n        nu_C_str = f\"{nu_C:.2f}\"\n        delta_nu_str = f\"{delta_nu:.2f}\"\n        \n        # Create the sublist string, e.g., \"[1.23,4.56,7.89]\", as required by output format.\n        case_result_str = f\"[{nu_B_str},{nu_C_str},{delta_nu_str}]\"\n        all_results_str.append(case_result_str)\n\n    # Join the sublist strings with commas and wrap in final brackets for the specified output format.\n    final_output = f\"[{','.join(all_results_str)}]\"\n    \n    # Print the final result string in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}