{
    "hands_on_practices": [
        {
            "introduction": "A successful Car-Parrinello Molecular Dynamics (CPMD) simulation hinges on maintaining adiabatic separation between the fast-moving electrons and the slower nuclei. This separation is controlled by the fictitious electronic mass, $\\mu$, which must be small enough to ensure the electronic degrees of freedom evolve much faster than the ionic ones. This practice  provides a fundamental calculation to determine the \"safe\" upper limit for $\\mu$, offering a crucial first step in setting up a stable and physically meaningful CPMD simulation.",
            "id": "3741059",
            "problem": "Consider Car-Parrinello molecular dynamics (CPMD), where the electronic degrees of freedom are evolved with a fictitious kinetic term characterized by a mass-like parameter $\\mu$ to enforce adiabatic separation from the ionic motion. In CPMD, start from the standard Lagrangian structure in which the fictitious electronic kinetic energy scales as $\\mu \\sum |\\dot{\\psi}|^{2}$ and the electronic potential energy curvature near the ground state is set by the Born-Oppenheimer energy gap $\\Delta$. Using the harmonic approximation for small oscillations of the electronic variables and the separation requirement that the characteristic electronic angular frequency $\\omega_{e}$ should be at least ten times larger than the dominant ionic angular frequency $\\omega_{i}$, derive the constraint on $\\mu$ that guarantees $\\omega_{e}/\\omega_{i} \\geq 10$. Then, taking $\\Delta = 2\\ \\mathrm{eV}$ and $\\omega_{i} = 2 \\times 10^{13}\\ \\mathrm{s}^{-1}$, compute the corresponding upper bound $\\mu_{\\max}$ in $\\mathrm{J \\cdot s^{2}}$. State the numerical value of $\\mu_{\\max}$ and, based on it, interpret the safe range of $\\mu$ that meets the separation criterion. Express your final numerical answer for $\\mu_{\\max}$ in $\\mathrm{J \\cdot s^{2}}$ and round your answer to four significant figures.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains sufficient information for a unique solution. It describes a standard condition for ensuring adiabaticity in Car-Parrinello molecular dynamics (CPMD), a well-established method in computational physics. Therefore, the problem is valid, and we proceed with the solution.\n\nThe core principle of CPMD is to treat the electronic wavefunctions, $\\{\\psi_k\\}$, as classical degrees of freedom evolving in time, governed by a fictitious kinetic energy term. The Lagrangian for the fictitious electronic dynamics can be written as:\n$$L_e = \\frac{1}{2} \\mu \\sum_k \\int |\\dot{\\psi}_k(\\mathbf{r}, t)|^2 d\\mathbf{r} - E_{BO}[\\{\\psi_k\\}]$$\nwhere $\\mu$ is the fictitious mass, $\\dot{\\psi}_k$ is the time derivative of the $k$-th electronic orbital, and $E_{BO}$ is the Born-Oppenheimer energy surface, which serves as the potential energy for both the ions and the fictitious electronic system. The problem statement indicating that the kinetic energy \"scales as $\\mu \\sum |\\dot{\\psi}|^{2}$\" is interpreted in the context of this standard Lagrangian form, where the factor of $\\frac{1}{2}$ is conventional for a kinetic energy term.\n\nThe equation of motion for the electronic orbitals derived from this Lagrangian is:\n$$\\mu \\ddot{\\psi}_k = -\\frac{\\delta E_{BO}}{\\delta \\psi_k^*} + \\text{constraints}$$\nTo find the characteristic frequency of the electronic system, $\\omega_e$, we consider small oscillations around the electronic ground state. The potential energy $E_{BO}$ can be expanded quadratically around its minimum. The problem simplifies this by stating that the curvature of this potential energy is set by the energy gap, $\\Delta$, between the highest occupied and lowest unoccupied electronic states.\n\nWe can model the dynamics of the lowest-frequency electronic excitation mode as a simple harmonic oscillator. The \"mass\" of this oscillator is the fictitious mass $\\mu$. The effective \"spring constant\" $k_e$ is related to the energy gap $\\Delta$. A standard analysis of the linearized equations of motion for the electronic orbitals shows that the angular frequencies, $\\omega_{e, i \\to j}$, corresponding to an excitation from an occupied state $i$ to an unoccupied state $j$ with energy difference $\\epsilon_j - \\epsilon_i$, are given by:\n$$\\omega_{e, i \\to j}^2 = \\frac{2(\\epsilon_j - \\epsilon_i)}{\\mu}$$\nThe lowest and most critical frequency for maintaining adiabatic separation corresponds to the smallest energy gap, which is the Born-Oppenheimer gap $\\Delta$. Thus, the characteristic electronic frequency $\\omega_e$ is given by:\n$$\\omega_e^2 = \\frac{2\\Delta}{\\mu}$$\n\nThe problem requires an adiabatic separation between the electronic and ionic motion, specified by the condition that the electronic frequency must be significantly larger than the dominant ionic frequency $\\omega_i$:\n$$\\frac{\\omega_e}{\\omega_i} \\geq 10$$\nSquaring both sides of this inequality gives:\n$$\\frac{\\omega_e^2}{\\omega_i^2} \\geq 100$$\nSubstituting our expression for $\\omega_e^2$:\n$$\\frac{2\\Delta / \\mu}{\\omega_i^2} \\geq 100$$\nWe can now solve for the constraint on the fictitious mass $\\mu$:\n$$\\frac{2\\Delta}{\\omega_i^2} \\geq 100 \\mu$$\n$$\\mu \\leq \\frac{2\\Delta}{100 \\omega_i^2}$$\n$$\\mu \\leq \\frac{\\Delta}{50 \\omega_i^2}$$\nThis inequality defines the safe range for $\\mu$ that ensures adiabatic separation. The upper bound on $\\mu$ is therefore:\n$$\\mu_{\\max} = \\frac{\\Delta}{50 \\omega_i^2}$$\n\nNow, we compute the numerical value of $\\mu_{\\max}$ using the provided data. First, all values must be converted to base SI units.\nThe energy gap is given as $\\Delta = 2\\ \\mathrm{eV}$. Using the elementary charge $e \\approx 1.602176634 \\times 10^{-19}\\ \\mathrm{C}$, we convert electron-volts to Joules:\n$$\\Delta = 2 \\times (1.602176634 \\times 10^{-19}\\ \\mathrm{J}) = 3.204353268 \\times 10^{-19}\\ \\mathrm{J}$$\nThe dominant ionic frequency is given as $\\omega_i = 2 \\times 10^{13}\\ \\mathrm{s}^{-1}$.\n\nSubstitute these values into the expression for $\\mu_{\\max}$:\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}\\ \\mathrm{J}}{50 \\times (2 \\times 10^{13}\\ \\mathrm{s}^{-1})^2}$$\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}\\ \\mathrm{J}}{50 \\times (4 \\times 10^{26}\\ \\mathrm{s}^{-2})}$$\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}\\ \\mathrm{J}}{200 \\times 10^{26}\\ \\mathrm{s}^{-2}}$$\n$$\\mu_{\\max} = \\frac{3.204353268 \\times 10^{-19}}{2 \\times 10^{28}}\\ \\mathrm{J \\cdot s^2}$$\n$$\\mu_{\\max} = 1.602176634 \\times 10^{-47}\\ \\mathrm{J \\cdot s^2}$$\nRounding the result to four significant figures as requested:\n$$\\mu_{\\max} \\approx 1.602 \\times 10^{-47}\\ \\mathrm{J \\cdot s^2}$$\n\nThe safe range for $\\mu$ that meets the separation criterion is $0  \\mu \\leq \\mu_{\\max}$. A value of $\\mu$ larger than $\\mu_{\\max}$ would cause the fictitious electronic system to oscillate too slowly, leading to a breakdown of adiabatic separation and unphysical heating of the ionic system. A value of $\\mu$ that is too close to zero, while satisfying the adiabaticity condition, would require an impractically small time step for numerical integration of the equations of motion, rendering the simulation computationally infeasible. The derived constraint specifically addresses the physical requirement of adiabaticity.",
            "answer": "$$\\boxed{1.602 \\times 10^{-47}}$$"
        },
        {
            "introduction": "While the previous exercise established the mathematical condition for adiabaticity, this practice explores the consequences of violating it. Using a simplified classical model of coupled oscillators, we can simulate the dynamics of the coupled ionic and fictitious electronic systems. This coding exercise  offers a tangible demonstration of \"energy leakage,\" where choosing too large a fictitious mass $\\mu$ causes unphysical heating of the fictitious electronic subsystem, a critical failure mode that every CPMD practitioner must learn to avoid.",
            "id": "2451938",
            "problem": "Consider a minimal, purely classical surrogate for Car-Parrinello molecular dynamics (CPMD) that captures the interplay between a slow ionic degree of freedom and a fast fictitious electronic degree of freedom. The ionic coordinate is denoted by $x$ with mass $M$, and the fictitious electronic coordinate is denoted by $y$ with fictitious mass $\\mu$. The system is governed by the Lagrangian\n$$\n\\mathcal{L}(x,\\dot{x},y,\\dot{y})=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}\\mu\\dot{y}^2-\\left[\\frac{1}{2}K x^2+\\frac{1}{2}k_e \\left(y-a x\\right)^2\\right],\n$$\nwhere $K$ and $k_e$ are positive force constants and $a$ is a dimensionless coupling coefficient. This Lagrangian mimics the CPMD idea that for each ionic configuration $x$ there is an electronic ground-state manifold given by $y=a x$. In the adiabatic regime, the electronic degree $y$ remains close to $a x$ and stores negligible energy, while if the adiabaticity condition is violated (for example, by choosing a large fictitious mass $\\mu$ so that the electronic frequency is not much larger than the ionic frequency), energy can transfer or “leak” from the ionic motion into the fictitious electronic motion.\n\nStarting only from Newton’s laws, that is, the Euler-Lagrange equations $d/dt(\\partial \\mathcal{L}/\\partial \\dot{q})-\\partial \\mathcal{L}/\\partial q=0$, and the definitions of kinetic and potential energy, perform the following tasks:\n\n1) Derive the coupled equations of motion for $x(t)$ and $y(t)$ implied by the Lagrangian above.\n\n2) Define the total conserved energy\n$$\nE_{\\text{tot}}(t)=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}\\mu\\dot{y}^2+\\frac{1}{2}K x^2+\\frac{1}{2}k_e\\left(y-a x\\right)^2,\n$$\nthe “ionic” energy\n$$\nE_{\\text{ion}}(t)=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}K x^2,\n$$\nand the “electronic” energy\n$$\nE_{\\text{el}}(t)=\\frac{1}{2}\\mu\\dot{y}^2+\\frac{1}{2}k_e\\left(y-a x\\right)^2.\n$$\nShow that $E_{\\text{tot}}(t)$ is conserved under exact integration and that $E_{\\text{el}}(0)=0$ if the initial conditions satisfy $y(0)=a x(0)$ and $\\dot{y}(0)=0$.\n\n3) Implement a velocity-Verlet integrator to numerically integrate the equations of motion with the following fixed initial conditions for all test cases: $x(0)=1$, $\\dot{x}(0)=0$, $y(0)=a x(0)$, $\\dot{y}(0)=0$. Use dimensionless units throughout, that is, there are no physical units.\n\n4) For each simulation, report the scalar leakage metric\n$$\nr=\\max_{0\\le t\\le T}\\frac{E_{\\text{el}}(t)}{E_{\\text{tot}}(0)},\n$$\nthat is, the maximum fraction of the initial total energy that is stored in the fictitious electronic subsystem over the trajectory. This metric is dimensionless. Use a constant time step $\\Delta t$ and a fixed number of steps $N_{\\text{steps}}$ so that the final simulation time is $T=N_{\\text{steps}}\\Delta t$.\n\nYour program must implement the algorithm and compute $r$ for each of the following test cases (all parameters are dimensionless):\n\n- Test case A (decoupled baseline, no leakage expected):\n  - $M=10$, $\\mu=0.5$, $K=1$, $k_e=100$, $a=0$, $\\Delta t=10^{-3}$, $N_{\\text{steps}}=10^5$.\n\n- Test case B (strong adiabatic separation, minimal leakage expected):\n  - $M=10$, $\\mu=0.2$, $K=1$, $k_e=100$, $a=1$, $\\Delta t=10^{-3}$, $N_{\\text{steps}}=10^5$.\n\n- Test case C (moderate violation of adiabaticity, noticeable leakage expected):\n  - $M=10$, $\\mu=10$, $K=1$, $k_e=100$, $a=1$, $\\Delta t=10^{-3}$, $N_{\\text{steps}}=10^5$.\n\n- Test case D (near-resonant violation, strong leakage expected):\n  - $M=10$, $\\mu=1000$, $K=1$, $k_e=100$, $a=1$, $\\Delta t=10^{-3}$, $N_{\\text{steps}}=10^5$.\n\nThe final output format must be a single line containing a list with the four values of $r$ for the test cases $A$ through $D$, as a comma-separated list enclosed in square brackets, in the same order as above (for example, $[r_A,r_B,r_C,r_D]$). The required output is dimensionless and must be printed exactly in this single-line format with no additional text.",
            "solution": "The problem as stated is scientifically sound, self-contained, and mathematically well-posed. It presents a valid classical mechanics problem that serves as a simplified model for concepts in Car-Parrinello molecular dynamics. A rigorous solution can therefore be constructed.\n\nThe tasks are addressed in sequence.\n\n**1. Derivation of the Equations of Motion**\n\nThe dynamics of the system are governed by the Euler-Lagrange equation for each coordinate $q_i \\in \\{x, y\\}$:\n$$\n\\frac{d}{dt}\\left(\\frac{\\partial \\mathcal{L}}{\\partial \\dot{q}_i}\\right) - \\frac{\\partial \\mathcal{L}}{\\partial q_i} = 0\n$$\nThe Lagrangian is given by\n$$\n\\mathcal{L}(x,\\dot{x},y,\\dot{y})=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}\\mu\\dot{y}^2-V(x,y)\n$$\nwhere the potential energy is $V(x,y) = \\frac{1}{2}K x^2+\\frac{1}{2}k_e \\left(y-a x\\right)^2$.\n\nFor the ionic coordinate $x$:\nThe partial derivatives of the Lagrangian are:\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\dot{x}} = M\\dot{x}\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial x} = -\\frac{\\partial V}{\\partial x} = -\\left[Kx + k_e(y-ax)(-a)\\right] = -Kx + ak_e(y-ax)\n$$\nSubstituting these into the Euler-Lagrange equation yields the equation of motion for $x(t)$:\n$$\n\\frac{d}{dt}(M\\dot{x}) - (-Kx + ak_e(y-ax)) = 0\n$$\n$$\nM\\ddot{x} = -Kx + ak_e(y-ax)\n$$\n\nFor the fictitious electronic coordinate $y$:\nThe partial derivatives of the Lagrangian are:\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\dot{y}} = \\mu\\dot{y}\n$$\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial y} = -\\frac{\\partial V}{\\partial y} = -k_e(y-ax)\n$$\nSubstituting these into the Euler-Lagrange equation yields the equation of motion for $y(t)$:\n$$\n\\frac{d}{dt}(\\mu\\dot{y}) - (-k_e(y-ax)) = 0\n$$\n$$\n\\mu\\ddot{y} = -k_e(y-ax)\n$$\nThese two coupled second-order ordinary differential equations,\n$$\n\\ddot{x}(t) = \\frac{1}{M}\\left[-Kx(t) - ak_e(ax(t)-y(t))\\right]\n$$\n$$\n\\ddot{y}(t) = \\frac{1}{\\mu}\\left[-k_e(y(t)-ax(t))\\right]\n$$\ndescribe the evolution of the system.\n\n**2. Energy Analysis**\n\nThe total energy of the system is the sum of kinetic and potential energies, $E_{\\text{tot}} = T+V$.\n$$\nE_{\\text{tot}}(t)=\\frac{1}{2}M\\dot{x}^2+\\frac{1}{2}\\mu\\dot{y}^2+\\frac{1}{2}K x^2+\\frac{1}{2}k_e\\left(y-a x\\right)^2\n$$\nThe Lagrangian is not an explicit function of time, i.e., $\\frac{\\partial \\mathcal{L}}{\\partial t} = 0$. For such systems, the Hamiltonian, $H = \\sum_i \\dot{q}_i \\frac{\\partial \\mathcal{L}}{\\partial \\dot{q}_i} - \\mathcal{L}$, is a conserved quantity. For this specific Lagrangian, the Hamiltonian is identical to the total energy $E_{\\text{tot}}$, hence $E_{\\text{tot}}$ is conserved.\n\nAlternatively, conservation can be proven by showing that its total time derivative is zero, using the previously derived equations of motion:\n$$\n\\frac{dE_{\\text{tot}}}{dt} = M\\dot{x}\\ddot{x} + \\mu\\dot{y}\\ddot{y} + Kx\\dot{x} + k_e(y-ax)(\\dot{y}-a\\dot{x})\n$$\nSubstituting the expressions for $M\\ddot{x}$ and $\\mu\\ddot{y}$:\n$$\n\\frac{dE_{\\text{tot}}}{dt} = \\dot{x}\\left(-Kx + ak_e(y-ax)\\right) + \\dot{y}\\left(-k_e(y-ax)\\right) + Kx\\dot{x} + k_e(y-ax)(\\dot{y}-a\\dot{x})\n$$\nExpanding and collecting terms:\n$$\n\\frac{dE_{\\text{tot}}}{dt} = \\left[-Kx\\dot{x} + Kx\\dot{x}\\right] + \\left[ak_e\\dot{x}(y-ax) - ak_e\\dot{x}(y-ax)\\right] + \\left[-k_e\\dot{y}(y-ax) + k_e\\dot{y}(y-ax)\\right] = 0\n$$\nThus, $E_{\\text{tot}}(t)$ is constant under exact dynamics.\n\nNext, we evaluate the initial electronic energy, $E_{\\text{el}}(0)$, given the specific initial conditions $y(0)=a x(0)$ and $\\dot{y}(0)=0$.\n$$\nE_{\\text{el}}(t)=\\frac{1}{2}\\mu\\dot{y}^2+\\frac{1}{2}k_e\\left(y-a x\\right)^2\n$$\nAt time $t=0$:\n$$\nE_{\\text{el}}(0) = \\frac{1}{2}\\mu(\\dot{y}(0))^2 + \\frac{1}{2}k_e(y(0)-ax(0))^2 = \\frac{1}{2}\\mu(0)^2 + \\frac{1}{2}k_e(ax(0)-ax(0))^2 = 0\n$$\nThis demonstrates that the system is initialized such that all energy is partitioned into the ionic subsystem, with the electronic subsystem being in its instantaneous ground state with zero kinetic energy.\n\n**3.  4. Numerical Integration and Leakage Metric**\n\nThe coupled equations of motion are integrated numerically using the velocity-Verlet algorithm. This method is symplectic and exhibits good long-term energy conservation properties. Let the positions at time $t$ be $(x(t), y(t))$, velocities be $(\\dot{x}(t), \\dot{y}(t))$, and accelerations be $(A_x(t), A_y(t))$. A single integration step of size $\\Delta t$ proceeds as follows:\n\nFirst, update velocities to a half-step:\n$$\n\\dot{x}(t+\\frac{1}{2}\\Delta t) = \\dot{x}(t) + \\frac{1}{2} A_x(t) \\Delta t\n$$\n$$\n\\dot{y}(t+\\frac{1}{2}\\Delta t) = \\dot{y}(t) + \\frac{1}{2} A_y(t) \\Delta t\n$$\nSecond, update positions to the full step using the half-step velocities:\n$$\nx(t+\\Delta t) = x(t) + \\dot{x}(t+\\frac{1}{2}\\Delta t) \\Delta t\n$$\n$$\ny(t+\\Delta t) = y(t) + \\dot{y}(t+\\frac{1}{2}\\Delta t) \\Delta t\n$$\nThird, compute the new accelerations $A_x(t+\\Delta t)$ and $A_y(t+\\Delta t)$ using the new positions $x(t+\\Delta t)$ and $y(t+\\Delta t)$.\nFourth, complete the velocity update to the full step:\n$$\n\\dot{x}(t+\\Delta t) = \\dot{x}(t+\\frac{1}{2}\\Delta t) + \\frac{1}{2} A_x(t+\\Delta t) \\Delta t\n$$\n$$\n\\dot{y}(t+\\Delta t) = \\dot{y}(t+\\frac{1}{2}\\Delta t) + \\frac{1}{2} A_y(t+\\Delta t) \\Delta t\n$$\nThis process is repeated for $N_{\\text{steps}}$.\n\nThe leakage metric, $r$, quantifies the maximum energy transfer to the electronic subsystem. It is calculated as:\n$$\nr = \\max_{0 \\le t \\le T} \\frac{E_{\\text{el}}(t)}{E_{\\text{tot}}(0)}\n$$\nFor each simulation, the initial total energy is calculated from the initial conditions $x(0)=1$, $\\dot{x}(0)=0$, $y(0)=a$, $\\dot{y}(0)=0$:\n$$\nE_{\\text{tot}}(0) = \\frac{1}{2}M(0)^2 + \\frac{1}{2}\\mu(0)^2 + \\frac{1}{2}K(1)^2 + \\frac{1}{2}k_e(a-a(1))^2 = \\frac{1}{2}K\n$$\nAt each time step $t_i = i\\Delta t$ of the simulation, the electronic energy $E_{\\text{el}}(t_i)$ is computed. The ratio $E_{\\text{el}}(t_i)/E_{\\text{tot}}(0)$ is compared to the maximum value found so far, and the maximum is updated accordingly. The final maximum value after $N_{\\text{steps}}$ is the result $r$. A Python program is provided to perform this calculation for the specified test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the coupled oscillator problem for the given test cases\n    and computes the energy leakage metric.\n    \"\"\"\n\n    test_cases = [\n        # Test case A (decoupled baseline)\n        {'M': 10.0, 'mu': 0.5, 'K': 1.0, 'ke': 100.0, 'a': 0.0, 'dt': 1e-3, 'N_steps': 100000},\n        # Test case B (strong adiabatic separation)\n        {'M': 10.0, 'mu': 0.2, 'K': 1.0, 'ke': 100.0, 'a': 1.0, 'dt': 1e-3, 'N_steps': 100000},\n        # Test case C (moderate violation)\n        {'M': 10.0, 'mu': 10.0, 'K': 1.0, 'ke': 100.0, 'a': 1.0, 'dt': 1e-3, 'N_steps': 100000},\n        # Test case D (near-resonant violation)\n        {'M': 10.0, 'mu': 1000.0, 'K': 1.0, 'ke': 100.0, 'a': 1.0, 'dt': 1e-3, 'N_steps': 100000},\n    ]\n\n    results = []\n    for params in test_cases:\n        r = calculate_leakage(**params)\n        results.append(r)\n\n    # Format the output exactly as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_leakage(M, mu, K, ke, a, dt, N_steps):\n    \"\"\"\n    Implements the velocity-Verlet integrator for the CPMD toy model\n    and calculates the energy leakage metric r.\n    \"\"\"\n    # Initial conditions\n    x = 1.0\n    x_dot = 0.0\n    y = a * x\n    y_dot = 0.0\n    \n    # Calculate initial total energy, which is conserved.\n    # E_tot(0) = 0.5*M*x_dot(0)^2 + 0.5*mu*y_dot(0)^2 + 0.5*K*x(0)^2 + 0.5*ke*(y(0)-a*x(0))^2\n    # With given initial conditions, this simplifies to:\n    e_tot_initial = 0.5 * K * x**2\n    \n    # If initial total energy is zero, leakage is undefined.\n    # This happens if K=0, but problem states K>0.\n    if e_tot_initial == 0:\n        return 0.0\n\n    # Variable to store the maximum leakage ratio\n    max_leakage_ratio = 0.0\n\n    # Function to compute accelerations\n    def get_accelerations(x_pos, y_pos):\n        common_term = ke * (y_pos - a * x_pos)\n        x_accel = (-K * x_pos + a * common_term) / M\n        y_accel = (-common_term) / mu\n        return x_accel, y_accel\n\n    # Initial a(t)\n    x_ddot, y_ddot = get_accelerations(x, y)\n    \n    # Main simulation loop using velocity-Verlet\n    for _ in range(N_steps):\n        # 1. Update velocities to mid-step v(t + dt/2)\n        x_dot_half = x_dot + 0.5 * x_ddot * dt\n        y_dot_half = y_dot + 0.5 * y_ddot * dt\n        \n        # 2. Update positions to full-step x(t + dt)\n        x = x + x_dot_half * dt\n        y = y + y_dot_half * dt\n        \n        # 3. Compute new accelerations a(t + dt) at new positions\n        x_ddot_new, y_ddot_new = get_accelerations(x, y)\n        \n        # 4. Update velocities to full-step v(t + dt)\n        x_dot = x_dot_half + 0.5 * x_ddot_new * dt\n        y_dot = y_dot_half + 0.5 * y_ddot_new * dt\n        \n        # Update current accelerations for the next step\n        x_ddot, y_ddot = x_ddot_new, y_ddot_new\n        \n        # Calculate electronic energy at current step\n        e_el = 0.5 * mu * y_dot**2 + 0.5 * ke * (y - a * x)**2\n        \n        # Calculate leakage ratio and update the maximum\n        leakage_ratio = e_el / e_tot_initial\n        if leakage_ratio > max_leakage_ratio:\n            max_leakage_ratio = leakage_ratio\n            \n    return max_leakage_ratio\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "The fictitious electronic mass in CPMD is not just an abstract parameter; it has real, observable consequences on the system's physical properties. By adding inertia to the electronic system that follows the nuclei, the fictitious mass effectively \"drags\" on the nuclei and alters their vibrational frequencies. In this exercise , you will quantify this well-known artifact by calculating the \"red-shift\" in the vibrational spectrum of a water molecule, directly connecting a core theoretical aspect of CPMD to a measurable spectroscopic quantity.",
            "id": "2451924",
            "problem": "A triatomic water molecule is modeled as three independent one-dimensional harmonic normal modes: a bend, a symmetric stretch, and an asymmetric stretch. In this model, each mode $i$ is described by an effective nuclear mass $M_i$ (in $\\mathrm{kg}$) and a harmonic force constant $k_i$ (in $\\mathrm{N\\ m^{-1}}$). Consider two dynamical descriptions:\n\n- Born-Oppenheimer Molecular Dynamics (BOMD): nuclei move on the electronic ground-state surface with no electronic inertia; the angular frequency of mode $i$ is $\\,\\omega_i^{\\mathrm{B}} = \\sqrt{k_i/M_i}\\,$.\n- Car-Parrinello Molecular Dynamics (CPMD): nuclei are coupled to fictitious electronic dynamics characterized by a fictitious electronic mass $\\mu$ (in $\\mathrm{kg}$). Under adiabatic separation, the effect of the fictitious dynamics on mode $i$ is a mode-specific mass renormalization $\\,M_i \\mapsto M_i + \\Delta M_i\\,$ with $\\,\\Delta M_i = \\mu\\,\\Lambda_i\\,$, where $\\Lambda_i$ is a given positive, dimensionless adiabatic coupling metric for that mode. The CPMD angular frequency is $\\,\\omega_i^{\\mathrm{C}} = \\sqrt{k_i/(M_i+\\Delta M_i)}\\,$.\n\nLet the wavenumber (in $\\mathrm{cm^{-1}}$) of mode $i$ be $\\,\\tilde{\\nu}_i = \\omega_i/(2\\pi c)\\,$, where $c$ is the speed of light. Define the red-shift induced by CPMD for mode $i$ as $\\,\\Delta\\tilde{\\nu}_i = \\tilde{\\nu}_i^{\\mathrm{B}} - \\tilde{\\nu}_i^{\\mathrm{C}}\\,$. Use the constants $\\,c = 2.99792458\\times 10^{10}\\ \\mathrm{cm\\ s^{-1}}\\,$ and $\\,m_e = 9.1093837015\\times 10^{-31}\\ \\mathrm{kg}\\,$. All final wavenumbers and red-shifts must be expressed in $\\mathrm{cm^{-1}}$, rounded to two decimal places.\n\nCompute $\\,\\tilde{\\nu}_i^{\\mathrm{B}}\\,$, $\\,\\tilde{\\nu}_i^{\\mathrm{C}}\\,$, and $\\,\\Delta\\tilde{\\nu}_i\\,$ for each of the following test cases (each case is a tuple $(M_i,k_i,\\mu,\\Lambda_i)$):\n\n- Case $1$ (bend, happy path): $\\,M_1 = 5.5\\times 10^{-27}\\ \\mathrm{kg}\\,$, $\\,k_1 = 500.0\\ \\mathrm{N\\ m^{-1}}\\,$, $\\,\\mu = 400\\,m_e\\,$, $\\,\\Lambda_1 = 0.3\\,$.\n- Case $2$ (symmetric stretch, happy path): $\\,M_2 = 1.66053906660\\times 10^{-27}\\ \\mathrm{kg}\\,$, $\\,k_2 = 790.0\\ \\mathrm{N\\ m^{-1}}\\,$, $\\,\\mu = 400\\,m_e\\,$, $\\,\\Lambda_2 = 0.5\\,$.\n- Case $3$ (asymmetric stretch, stronger coupling): $\\,M_3 = 1.66053906660\\times 10^{-27}\\ \\mathrm{kg}\\,$, $\\,k_3 = 830.0\\ \\mathrm{N\\ m^{-1}}\\,$, $\\,\\mu = 600\\,m_e\\,$, $\\,\\Lambda_3 = 0.7\\,$.\n- Case $4$ (boundary, no fictitious dynamics): $\\,M_4 = 1.66053906660\\times 10^{-27}\\ \\mathrm{kg}\\,$, $\\,k_4 = 790.0\\ \\mathrm{N\\ m^{-1}}\\,$, $\\,\\mu = 0\\,\\mathrm{kg}\\,$, $\\,\\Lambda_4 = 0.5\\,$.\n\nYour program should output a single line containing the results for the four cases as a comma-separated list enclosed in square brackets, where each case contributes a sublist of three floats $[\\tilde{\\nu}_i^{\\mathrm{B}},\\tilde{\\nu}_i^{\\mathrm{C}},\\Delta\\tilde{\\nu}_i]$ in $\\mathrm{cm^{-1}}$, each rounded to two decimal places. For example, the overall format must be\n\"[[x_{1,\\mathrm{B}},x_{1,\\mathrm{C}},x_{1,\\Delta}],[x_{2,\\mathrm{B}},x_{2,\\mathrm{C}},x_{2,\\Delta}],[x_{3,\\mathrm{B}},x_{3,\\mathrm{C}},x_{3,\\Delta}],[x_{4,\\mathrm{B}},x_{4,\\mathrm{C}},x_{4,\\Delta}]]\" with no additional text.",
            "solution": "The problem as stated is valid. It is scientifically sound, self-contained, and mathematically well-posed. It requires the calculation of vibrational frequencies within the established theoretical frameworks of Born-Oppenheimer and Car-Parrinello molecular dynamics. We proceed with the solution.\n\nThe fundamental physical model is the one-dimensional simple harmonic oscillator, which describes each normal mode $i$ of the molecule. The angular frequency $\\omega$ is determined by the effective mass $M$ and the force constant $k$ of the oscillator.\n\nIn Born-Oppenheimer Molecular Dynamics (BOMD), the nuclei are assumed to move on a potential energy surface defined by electrons in their instantaneous ground state. There is no fictitious inertia associated with the electronic degrees of freedom. The BOMD angular frequency for mode $i$ is thus given by the standard formula:\n$$ \\omega_i^{\\mathrm{B}} = \\sqrt{\\frac{k_i}{M_i}} $$\nwhere $M_i$ is the nuclear effective mass and $k_i$ is the force constant.\n\nIn Car-Parrinello Molecular Dynamics (CPMD), the electronic wavefunctions are treated as dynamical variables with a fictitious mass $\\mu$. This fictitious dynamics introduces an inertia that couples to the nuclear motion. In the limit of good adiabatic separation, this coupling results in a renormalization of the nuclear mass for each mode. The effective mass for mode $i$ becomes:\n$$ M_i^{\\mathrm{C}} = M_i + \\Delta M_i $$\nThe mass correction $\\Delta M_i$ is given by:\n$$ \\Delta M_i = \\mu \\Lambda_i $$\nwhere $\\Lambda_i$ is the mode-specific adiabatic coupling metric, a positive, dimensionless quantity. Consequently, the CPMD angular frequency for mode $i$ is:\n$$ \\omega_i^{\\mathrm{C}} = \\sqrt{\\frac{k_i}{M_i^{\\mathrm{C}}}} = \\sqrt{\\frac{k_i}{M_i + \\mu \\Lambda_i}} $$\nSince $\\mu \\ge 0$ and $\\Lambda_i > 0$, the effective mass $M_i^{\\mathrm{C}}$ is always greater than or equal to $M_i$. This leads to $\\omega_i^{\\mathrm{C}} \\le \\omega_i^{\\mathrm{B}}$, a phenomenon known as a red-shift of the vibrational frequencies.\n\nThe angular frequency $\\omega$ (in units of $\\mathrm{s}^{-1}$) is converted to wavenumber $\\tilde{\\nu}$ (in units of $\\mathrm{cm}^{-1}$) using the speed of light, $c$:\n$$ \\tilde{\\nu}_i = \\frac{\\omega_i}{2\\pi c} $$\nThe red-shift in wavenumber is defined as the difference between the BOMD and CPMD values:\n$$ \\Delta\\tilde{\\nu}_i = \\tilde{\\nu}_i^{\\mathrm{B}} - \\tilde{\\nu}_i^{\\mathrm{C}} $$\nWe apply these principles to the provided data for each case, using the physical constants $c = 2.99792458 \\times 10^{10}\\ \\mathrm{cm\\ s^{-1}}$ and $m_e = 9.1093837015 \\times 10^{-31}\\ \\mathrm{kg}$. The fictitious mass $\\mu$ is given in units of electron mass, $m_e$, and must be converted to kilograms for calculation.\n\nFor each case $(M_i, k_i, \\mu, \\Lambda_i)$, we calculate:\n$1$. BOMD wavenumber: $\\tilde{\\nu}_i^{\\mathrm{B}} = \\frac{1}{2\\pi c} \\sqrt{\\frac{k_i}{M_i}}$\n$2$. CPMD wavenumber: $\\tilde{\\nu}_i^{\\mathrm{C}} = \\frac{1}{2\\pi c} \\sqrt{\\frac{k_i}{M_i + \\mu \\Lambda_i}}$\n$3$. Red-shift: $\\Delta\\tilde{\\nu}_i = \\tilde{\\nu}_i^{\\mathrm{B}} - \\tilde{\\nu}_i^{\\mathrm{C}}$\n\nThe numerical evaluation is a direct application of these formulas. The provided test cases are processed according to this procedure to obtain the required quantities, which are then rounded to two decimal places. Case $4$, where $\\mu = 0\\ \\mathrm{kg}$, serves as a control: with no fictitious electronic mass, $\\Delta M_4=0$, so $M_4^{\\mathrm{C}} = M_4$. This correctly recovers the BOMD limit, where $\\tilde{\\nu}_4^{\\mathrm{C}} = \\tilde{\\nu}_4^{\\mathrm{B}}$ and the red-shift $\\Delta\\tilde{\\nu}_4$ is zero.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes Born-Oppenheimer and Car-Parrinello vibrational wavenumbers and\n    the resulting red-shift for a set of harmonic normal modes.\n    \"\"\"\n    # Define physical constants from the problem statement.\n    c_cms = 2.99792458e10  # Speed of light in cm/s\n    m_e_kg = 9.1093837015e-31  # Electron mass in kg\n\n    # Define test cases as tuples: (M_i (kg), k_i (N/m), mu (in units of m_e), Lambda_i).\n    test_cases = [\n        (5.5e-27, 500.0, 400.0, 0.3),                 # Case 1: Bend\n        (1.66053906660e-27, 790.0, 400.0, 0.5),       # Case 2: Symmetric stretch\n        (1.66053906660e-27, 830.0, 600.0, 0.7),       # Case 3: Asymmetric stretch\n        (1.66053906660e-27, 790.0, 0.0, 0.5),         # Case 4: Boundary (mu=0)\n    ]\n\n    all_results_str = []\n\n    for M_i, k_i, mu_me, Lambda_i in test_cases:\n        # Convert fictitious mass mu from units of electron mass to kg.\n        mu_kg = mu_me * m_e_kg\n\n        # Calculate BOMD angular frequency and wavenumber.\n        omega_B = np.sqrt(k_i / M_i)\n        nu_B = omega_B / (2 * np.pi * c_cms)\n\n        # Calculate the CPMD mass renormalization and effective mass.\n        Delta_M_i = mu_kg * Lambda_i\n        M_i_C = M_i + Delta_M_i\n\n        # Calculate CPMD angular frequency and wavenumber.\n        omega_C = np.sqrt(k_i / M_i_C)\n        nu_C = omega_C / (2 * np.pi * c_cms)\n        \n        # Calculate the red-shift in wavenumber.\n        delta_nu = nu_B - nu_C\n        \n        # Format results to two decimal places as strings. This also handles rounding.\n        nu_B_str = f\"{nu_B:.2f}\"\n        nu_C_str = f\"{nu_C:.2f}\"\n        delta_nu_str = f\"{delta_nu:.2f}\"\n        \n        # Create the sublist string, e.g., \"[1.23,4.56,7.89]\", as required by output format.\n        case_result_str = f\"[{nu_B_str},{nu_C_str},{delta_nu_str}]\"\n        all_results_str.append(case_result_str)\n\n    # Join the sublist strings with commas and wrap in final brackets for the specified output format.\n    final_output = f\"[{','.join(all_results_str)}]\"\n    \n    # Print the final result string in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}