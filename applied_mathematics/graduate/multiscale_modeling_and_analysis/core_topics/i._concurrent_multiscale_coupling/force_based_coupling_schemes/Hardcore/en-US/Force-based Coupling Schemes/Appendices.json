{
    "hands_on_practices": [
        {
            "introduction": "The primary challenge in developing force-based coupling schemes is ensuring physical consistency at the interface between different models. A common failure mode in non-conservative methods is the emergence of spurious \"ghost forces,\" which are non-physical artifacts that arise even in simple, uniform deformations. This practice  provides a rigorous, first-principles derivation of these ghost forces, allowing you to analytically dissect their origin and quantify their magnitude in terms of the blending function and the gradients of the deformation field.",
            "id": "3760812",
            "problem": "Consider an infinite one-dimensional crystalline chain with reference atomic positions $X_{i} = i a$, where $a > 0$ is the lattice spacing. The chain has linear harmonic pair interactions up to second neighbors: each nearest-neighbor bond has stiffness $k_{1} > 0$ and rest length $a$, and each next-nearest-neighbor bond has stiffness $k_{2} > 0$ and rest length $2 a$. Let the deformation be given by a smooth mapping $y(X)$ with deformation gradient $F(X) = \\frac{d y}{d X}(X)$. Assume $F$ varies on a length scale much larger than $a$ so that asymptotic Taylor expansions in powers of $a$ are valid.\n\nDefine the continuum Cauchy–Born stress as $\\sigma_{\\text{CB}}(X)$ obtained from the Cauchy–Born energy density, and define the atomistic stress $\\sigma_{\\text{A}}(X)$ as the Irving–Kirkwood traction across the mid-bond cut between sites $i$ and $i+1$, i.e., the sum of the forces in all bonds that cross that cut. Let $b(X)$ be a smooth blending function that equals one in the atomistic region and zero in the continuum region, with a smooth transition zone.\n\nThe QuasiContinuum (QC) method admits two common couplings:\n- The energy-based QuasiContinuum (EQC) coupling, which mixes stresses conservatively as $\\sigma_{\\text{mix}}(X) = b(X) \\sigma_{\\text{A}}(X) + \\bigl(1 - b(X)\\bigr) \\sigma_{\\text{CB}}(X)$ and defines forces by $f_{\\text{EQC}}(X) = - \\frac{d}{d X} \\sigma_{\\text{mix}}(X)$.\n- The QuasiContinuum force-based (QCF) coupling, which mixes nodal force residuals nonconservatively as $f_{\\text{QCF}}(X) = b(X) f_{\\text{A}}(X) + \\bigl(1 - b(X)\\bigr) f_{\\text{CB}}(X)$, with $f_{\\text{A}}(X) = - \\frac{d}{d X} \\sigma_{\\text{A}}(X)$ and $f_{\\text{CB}}(X) = - \\frac{d}{d X} \\sigma_{\\text{CB}}(X)$.\n\nStarting from Newton’s second law in static equilibrium ($f(X) = 0$), the definition of Irving–Kirkwood traction for one-dimensional chains, and the Cauchy–Born rule for harmonic pair interactions, derive the leading-order asymptotic expression for the local QCF stress error generated by nonconservative force blending in a smoothly varying strain field, defined here as the mismatch between the QCF residual and the divergence of the mixed stress,\n$$\n\\mathcal{E}_{\\text{QCF}}(X) := f_{\\text{QCF}}(X) + \\frac{d}{d X} \\sigma_{\\text{mix}}(X),\n$$\nexpressed in terms of $a$, $k_{1}$, $k_{2}$, $b'(X)$, and derivatives of $F(X)$, truncated to the lowest nonvanishing order in $a$. Then, compute the corresponding leading-order expression for the EQC coupling error defined analogously as\n$$\n\\mathcal{E}_{\\text{EQC}}(X) := f_{\\text{EQC}}(X) + \\frac{d}{d X} \\sigma_{\\text{mix}}(X),\n$$\nand compare the two.\n\nYour final answer must be a single closed-form analytic expression for $\\mathcal{E}_{\\text{QCF}}(X) - \\mathcal{E}_{\\text{EQC}}(X)$ to leading order in $a$, expressed in terms of $a$, $k_{1}$, $k_{2}$, $b'(X)$, and derivatives of $F(X)$. No numerical evaluation is required. If you introduce any quantities, define them clearly. Do not assume any special form of $F(X)$ or $b(X)$ beyond smoothness and slow variation relative to $a$. Express the final answer without units inside the box.",
            "solution": "The user wants to derive the leading-order expression for the difference in coupling errors, $\\mathcal{E}_{\\text{QCF}}(X) - \\mathcal{E}_{\\text{EQC}}(X)$, between the force-based (QCF) and energy-based (EQC) QuasiContinuum methods.\n\nThe problem provides the following definitions for the error terms:\n$$\n\\mathcal{E}_{\\text{QCF}}(X) := f_{\\text{QCF}}(X) + \\frac{d}{d X} \\sigma_{\\text{mix}}(X)\n$$\n$$\n\\mathcal{E}_{\\text{EQC}}(X) := f_{\\text{EQC}}(X) + \\frac{d}{d X} \\sigma_{\\text{mix}}(X)\n$$\nwhere the mixed stress $\\sigma_{\\text{mix}}(X)$ and the coupled forces $f_{\\text{EQC}}(X)$ and $f_{\\text{QCF}}(X)$ are defined as:\n$$\n\\sigma_{\\text{mix}}(X) = b(X) \\sigma_{\\text{A}}(X) + \\bigl(1 - b(X)\\bigr) \\sigma_{\\text{CB}}(X)\n$$\n$$\nf_{\\text{EQC}}(X) = - \\frac{d}{d X} \\sigma_{\\text{mix}}(X)\n$$\n$$\nf_{\\text{QCF}}(X) = b(X) f_{\\text{A}}(X) + \\bigl(1 - b(X)\\bigr) f_{\\text{CB}}(X)\n$$\nThe atomistic and continuum forces are defined as the negative divergence of their respective stresses:\n$$\nf_{\\text{A}}(X) = - \\frac{d}{d X} \\sigma_{\\text{A}}(X)\n$$\n$$\nf_{\\text{CB}}(X) = - \\frac{d}{d X} \\sigma_{\\text{CB}}(X)\n$$\nFirst, let's analyze the energy-based coupling error, $\\mathcal{E}_{\\text{EQC}}(X)$. By substituting the definition of $f_{\\text{EQC}}(X)$ into the expression for $\\mathcal{E}_{\\text{EQC}}(X)$:\n$$\n\\mathcal{E}_{\\text{EQC}}(X) = \\left( - \\frac{d}{d X} \\sigma_{\\text{mix}}(X) \\right) + \\frac{d}{d X} \\sigma_{\\text{mix}}(X) = 0\n$$\nThis result is definitional. The EQC coupling is constructed to be conservative, meaning the force field is exactly the negative gradient of an energy functional whose corresponding stress is $\\sigma_{\\text{mix}}(X)$. The error, as defined, is therefore identically zero.\n\nNext, we analyze the force-based coupling error, $\\mathcal{E}_{\\text{QCF}}(X)$. We substitute the definitions of $f_{\\text{QCF}}(X)$, $f_{\\text{A}}(X)$, and $f_{\\text{CB}}(X)$:\n$$\n\\mathcal{E}_{\\text{QCF}}(X) = \\left( b(X) \\left[- \\frac{d \\sigma_{\\text{A}}}{d X}\\right] + \\bigl(1 - b(X)\\bigr) \\left[- \\frac{d \\sigma_{\\text{CB}}}{d X}\\right] \\right) + \\frac{d}{d X} \\sigma_{\\text{mix}}(X)\n$$\nNow, we expand the derivative of the mixed stress, $\\sigma_{\\text{mix}}(X) = b(X) \\sigma_{\\text{A}}(X) + (1-b(X)) \\sigma_{\\text{CB}}(X)$, using the product rule:\n$$\n\\frac{d}{d X} \\sigma_{\\text{mix}}(X) = \\frac{d}{d X} \\left[ b(X) (\\sigma_{\\text{A}}(X) - \\sigma_{\\text{CB}}(X)) + \\sigma_{\\text{CB}}(X) \\right]\n$$\n$$\n\\frac{d}{d X} \\sigma_{\\text{mix}}(X) = \\frac{d b}{d X} (\\sigma_{\\text{A}}(X) - \\sigma_{\\text{CB}}(X)) + b(X) \\left(\\frac{d \\sigma_{\\text{A}}}{d X} - \\frac{d \\sigma_{\\text{CB}}}{d X}\\right) + \\frac{d \\sigma_{\\text{CB}}}{d X}\n$$\nLet's denote derivatives with respect to $X$ with a prime, e.g., $b' = db/dX$.\n$$\n\\sigma'_{\\text{mix}} = b' (\\sigma_{\\text{A}} - \\sigma_{\\text{CB}}) + b (\\sigma'_{\\text{A}} - \\sigma'_{\\text{CB}}) + \\sigma'_{\\text{CB}}\n$$\nSubstituting this back into the expression for $\\mathcal{E}_{\\text{QCF}}(X)$:\n$$\n\\mathcal{E}_{\\text{QCF}}(X) = \\left( -b \\sigma'_{\\text{A}} - (1-b)\\sigma'_{\\text{CB}} \\right) + \\left( b' (\\sigma_{\\text{A}} - \\sigma_{\\text{CB}}) + b \\sigma'_{\\text{A}} - b \\sigma'_{\\text{CB}} + \\sigma'_{\\text{CB}} \\right)\n$$\nCombining terms:\n$$\n\\mathcal{E}_{\\text{QCF}}(X) = (-b \\sigma'_{\\text{A}} + b \\sigma'_{\\text{A}}) + (-\\sigma'_{\\text{CB}} + b \\sigma'_{\\text{CB}} - b \\sigma'_{\\text{CB}} + \\sigma'_{\\text{CB}}) + b' (\\sigma_{\\text{A}} - \\sigma_{\\text{CB}})\n$$\nAll terms cancel except for one:\n$$\n\\mathcal{E}_{\\text{QCF}}(X) = b'(X) \\bigl( \\sigma_{\\text{A}}(X) - \\sigma_{\\text{CB}}(X) \\bigr)\n$$\nThis is the well-known expression for the spurious \"ghost force\" in non-conservative coupling schemes. To find its leading-order expression, we must find the leading-order difference between the atomistic stress $\\sigma_{\\text{A}}(X)$ and the Cauchy-Born stress $\\sigma_{\\text{CB}}(X)$.\n\n**1. Cauchy–Born Stress $\\sigma_{\\text{CB}}(X)$**\nThe potential energy per atom under a uniform deformation gradient $F$ is given by summing the energy of the bonds emanating from it, with a factor of $1/2$ for each bond to avoid double counting.\n$$\nE_{\\text{atom}}(F) = \\frac{1}{2} k_1 (aF-a)^2 + \\frac{1}{2} k_2 (2aF-2a)^2 = \\frac{1}{2} a^2 (k_1 + 4k_2) (F-1)^2\n$$\nThe Cauchy-Born energy density $W_{\\text{CB}}(F)$ is the energy per unit reference length, $W_{\\text{CB}}(F) = E_{\\text{atom}}(F)/a$.\n$$\nW_{\\text{CB}}(F) = \\frac{1}{2} a (k_1+4k_2)(F-1)^2\n$$\nThe stress (first Piola-Kirchhoff stress) is the derivative of the energy density with respect to the deformation gradient:\n$$\n\\sigma_{\\text{CB}}(F) = \\frac{d W_{\\text{CB}}}{dF} = a (k_1+4k_2)(F-1)\n$$\nThus, for a slowly varying field $F(X)$, $\\sigma_{\\text{CB}}(X) = a(k_1+4k_2)(F(X)-1)$.\n\n**2. Atomistic Stress $\\sigma_{\\text{A}}(X)$**\nThe atomistic stress $\\sigma_{\\text{A}}(X)$ at the mid-bond cut $X = (i+1/2)a$ is the sum of forces (tensions) in all bonds that cross this plane. These bonds are the nearest-neighbor bond $(i, i+1)$ and the next-nearest-neighbor bonds $(i, i+2)$ and $(i-1, i+1)$.\n$$\n\\sigma_{\\text{A}}(X) = k_1(y_{i+1} - y_i - a) + k_2(y_{i+2} - y_i - 2a) + k_2(y_{i+1} - y_{i-1} - 2a)\n$$\nWe use Taylor series expansions of the smooth displacement field $y(X)$ around the evaluation point $X_c = (i+1/2)a$. Let $y^{(n)} = d^n y / dX^n$.\nThe atomic positions are $X_i = X_c-a/2$, $X_{i+1} = X_c+a/2$, $X_{i-1} = X_c-3a/2$, $X_{i+2} = X_c+3a/2$.\nThe differences in positions are expanded as:\n$y_{i+1} - y_{i} = y(X_c+\\frac{a}{2}) - y(X_c-\\frac{a}{2}) = a y'(X_c) + \\frac{a^3}{24} y'''(X_c) + \\mathcal{O}(a^5)$\n$y_{i+2} - y_{i} = y(X_c+\\frac{3a}{2}) - y(X_c-\\frac{a}{2}) = 2a y'(X_c) + a^2 y''(X_c) + \\frac{7a^3}{12} y'''(X_c) + \\mathcal{O}(a^4)$\n$y_{i+1} - y_{i-1} = y(X_c+\\frac{a}{2}) - y(X_c-\\frac{3a}{2}) = 2a y'(X_c) - a^2 y''(X_c) + \\frac{7a^3}{12} y'''(X_c) + \\mathcal{O}(a^4)$\n\nSubstituting these into the expression for $\\sigma_{\\text{A}}(X_c)$ and using $F(X) = y'(X)$, $F'(X)=y''(X)$, $F''(X)=y'''(X)$:\n$$\n\\sigma_{\\text{A}}(X) = k_1 \\left( aF + \\frac{a^3}{24}F'' - a \\right) + k_2 \\left( 2aF + a^2 F' + \\frac{7a^3}{12}F'' - 2a \\right) + k_2 \\left( 2aF - a^2 F' + \\frac{7a^3}{12}F'' - 2a \\right) + \\mathcal{O}(a^5)\n$$\nGrouping terms by powers of $a$ and derivatives of $F$:\n$$\n\\sigma_{\\text{A}}(X) = a(k_1 + 2k_2 + 2k_2)(F-1) + a^2(k_2 - k_2)F' + a^3\\left(\\frac{k_1}{24} + \\frac{7k_2}{12} + \\frac{7k_2}{12}\\right)F'' + \\mathcal{O}(a^5)\n$$\n$$\n\\sigma_{\\text{A}}(X) = a(k_1+4k_2)(F-1) + a^3\\left(\\frac{k_1}{24} + \\frac{14k_2}{12}\\right)F'' + \\mathcal{O}(a^5)\n$$\nThe first term is exactly $\\sigma_{\\text{CB}}(X)$. Simplifying the second term gives:\n$$\n\\sigma_{\\text{A}}(X) = \\sigma_{\\text{CB}}(X) + a^3\\left(\\frac{k_1}{24} + \\frac{7k_2}{6}\\right)F''(X) + \\mathcal{O}(a^5)\n$$\n\n**3. Final Error Calculation**\nWe can now find the leading-order expression for the stress difference:\n$$\n\\sigma_{\\text{A}}(X) - \\sigma_{\\text{CB}}(X) = a^3\\left(\\frac{k_1}{24} + \\frac{7k_2}{6}\\right)F''(X) + \\mathcal{O}(a^5)\n$$\nThe quantity of interest is $\\mathcal{E}_{\\text{QCF}}(X) - \\mathcal{E}_{\\text{EQC}}(X)$. Since $\\mathcal{E}_{\\text{EQC}}(X)=0$, this is just $\\mathcal{E}_{\\text{QCF}}(X)$.\n$$\n\\mathcal{E}_{\\text{QCF}}(X) = b'(X) \\bigl( \\sigma_{\\text{A}}(X) - \\sigma_{\\text{CB}}(X) \\bigr)\n$$\nSubstituting the leading-order stress difference:\n$$\n\\mathcal{E}_{\\text{QCF}}(X) = b'(X) \\left[ a^3\\left(\\frac{k_1}{24} + \\frac{7k_2}{6}\\right)F''(X) + \\mathcal{O}(a^5) \\right]\n$$\nThe leading-order term is of order $a^3$. Therefore, the desired expression is:\n$$\n\\mathcal{E}_{\\text{QCF}}(X) - \\mathcal{E}_{\\text{EQC}}(X) = a^3 b'(X) F''(X) \\left(\\frac{k_1}{24} + \\frac{7k_2}{6}\\right)\n$$\nThis expression represents the spurious force generated in the blending region of a QCF simulation, which is proportional to the gradient of the blending function $b'(X)$, the third derivative of the displacement field $y'''(X) = F''(X)$, and the cube of the lattice parameter $a^3$. This force is a direct consequence of the non-conservative mixing of forces from different physical models (atomistic and continuum).",
            "answer": "$$\\boxed{a^{3} b'(X) F''(X) \\left(\\frac{k_{1}}{24} + \\frac{7k_{2}}{6}\\right)}$$"
        },
        {
            "introduction": "Beyond static consistency, a practical force-based coupling scheme must be amenable to stable and efficient time integration. When coupling is achieved through penalty forces that constrain the degrees of freedom at an interface, the method can introduce high-frequency, or \"stiff,\" modes into the system's dynamics. This exercise  challenges you to analyze the numerical stability of a representative coupled system, revealing how the choice of coupling parameters directly impacts the maximum allowable time step for an explicit solver.",
            "id": "3760758",
            "problem": "Consider the linear stability of a minimal force-based coupling between Smoothed Particle Hydrodynamics (SPH) and the Finite Element Method (FEM) under a simple shear flow. Smoothed Particle Hydrodynamics (SPH) and the Finite Element Method (FEM) are coupled at an interface by equal-and-opposite interface forces that penalize mismatch of the shear velocity across the interface. Focus on a single representative interface pair that consists of one SPH particle shear-velocity degree of freedom and one co-located FEM nodal shear-velocity degree of freedom, denoted by $u(t)$ and $v(t)$, respectively. Assume a base simple shear flow with constant shear rate $\\dot{\\gamma}$ and analyze the linearized dynamics of small perturbations $(u,v)$ about this base flow. Work in a co-moving frame so that advection by the base flow does not explicitly enter the linearized operator for these perturbations.\n\nAssume the following physically motivated model derived from Newton’s second law. The lumped masses associated with the SPH and FEM degrees of freedom are $m_{s}>0$ and $m_{f}>0$. The leading-order internal (viscous) force in each subdomain for a single shear Fourier mode of wavenumber $k>0$ is linear and of the form $- \\mu_{s} k^{2} u$ for SPH and $- \\mu_{f} k^{2} v$ for FEM, where $\\mu_{s}>0$ and $\\mu_{f}>0$ are effective viscous coefficients. The interface force is modeled as a linear penalty that enforces velocity continuity in a force-based manner: the SPH degree of freedom experiences $- \\kappa (u - v)$ and the FEM degree of freedom experiences $+ \\kappa (u - v)$, with coupling coefficient $\\kappa>0$. The linearized, homogeneous perturbation dynamics are therefore\n$$\nm_{s} \\,\\frac{d u}{d t} \\;=\\; - \\mu_{s} k^{2} \\, u \\;-\\; \\kappa (u - v), \n\\qquad\nm_{f} \\,\\frac{d v}{d t} \\;=\\; - \\mu_{f} k^{2} \\, v \\;+\\; \\kappa (u - v).\n$$\n\nYou will analyze the stability of an explicit forward Euler time integrator applied to this coupled system. Define the state vector $y(t) = \\begin{pmatrix} u(t) \\\\ v(t) \\end{pmatrix}$ and write the system in the form $\\dot{y} = A y$, identifying the constant $2 \\times 2$ matrix $A$ that depends on the parameters $(m_{s}, m_{f}, \\mu_{s}, \\mu_{f}, k, \\kappa)$. Then, by evaluating the eigenvalues of the discrete operator relevant to forward Euler stability (equivalently, the eigenvalues of $A$ for this linear, time-invariant system), determine a closed-form analytic expression for the largest time step that guarantees linear stability of forward Euler for this coupled system. Assume all parameters are strictly positive and that the system is integrated without additional stabilization.\n\nProvide your final answer as a single closed-form expression for the maximum stable time step $\\Delta t_{\\max}$ in terms of $m_{s}, m_{f}, \\mu_{s}, \\mu_{f}, k$, and $\\kappa$. Do not include units in your final boxed answer. No numerical evaluation is required; an exact analytic expression is expected.",
            "solution": "The user has requested an analysis of the linear stability of a force-based coupled system and the derivation of the maximum stable time step for the forward Euler method.\n\n### Step 1: Problem Validation\n\n**1.1. Extraction of Givens:**\n- The system consists of two degrees of freedom, an SPH particle shear velocity $u(t)$ and an FEM nodal shear velocity $v(t)$.\n- The linearized dynamics of small perturbations $(u, v)$ are given by the coupled ordinary differential equations (ODEs):\n$$ m_{s} \\,\\frac{d u}{d t} \\;=\\; - \\mu_{s} k^{2} \\, u \\;-\\; \\kappa (u - v) $$\n$$ m_{f} \\,\\frac{d v}{d t} \\;=\\; - \\mu_{f} k^{2} \\, v \\;+\\; \\kappa (u - v) $$\n- The parameters are:\n    - Lumped masses: $m_{s} > 0$, $m_{f} > 0$.\n    - Effective viscous coefficients: $\\mu_{s} > 0$, $\\mu_{f} > 0$.\n    - Wavenumber: $k > 0$.\n    - Coupling coefficient: $\\kappa > 0$.\n- The task is to analyze the stability of an explicit forward Euler time integrator for this system.\n- The state vector is defined as $y(t) = \\begin{pmatrix} u(t) \\\\ v(t) \\end{pmatrix}$.\n- The goal is to find a closed-form analytic expression for the maximum stable time step, $\\Delta t_{\\max}$, in terms of the given parameters.\n\n**1.2. Validation against Criteria:**\n- **Scientifically Grounded:** The problem presents a linearized model for a coupled physical system (SPH-FEM), which is a standard approach in multiscale modeling. The equations represent Newton's second law with linear viscous and penalty forces. The stability analysis of numerical methods for such systems is a fundamental topic in computational science and engineering. The premises are physically and mathematically sound.\n- **Well-Posed:** The problem is well-posed. It specifies a system of linear, time-invariant ODEs and asks for the stability limit of a standard numerical integrator (forward Euler). All required parameters are defined, and their positivity ensures a non-degenerate system. A unique, meaningful solution for $\\Delta t_{\\max}$ exists and can be derived.\n- **Objective:** The problem is stated in precise, unbiased, and formal language. All terms are clearly defined.\n- **Conclusion:** The problem is valid. It is scientifically sound, well-posed, and objective. It contains no contradictions, ambiguities, or fatal flaws.\n\n### Step 2: Solution Derivation\n\nThe analysis proceeds by first rewriting the system of ODEs in standard matrix form, $\\dot{y} = A y$, and then determining the stability limit of the forward Euler method based on the eigenvalues of the system matrix $A$.\n\nThe given system of equations is:\n$$ m_{s} \\frac{du}{dt} = - (\\mu_{s} k^{2} + \\kappa) u + \\kappa v $$\n$$ m_{f} \\frac{dv}{dt} = \\kappa u - (\\mu_{f} k^{2} + \\kappa) v $$\n\nDividing by the respective masses, we obtain the system in the form $\\dot{y} = A y$:\n$$ \\frac{d}{dt} \\begin{pmatrix} u \\\\ v \\end{pmatrix} = \\begin{pmatrix} -\\frac{\\mu_{s} k^{2} + \\kappa}{m_{s}} & \\frac{\\kappa}{m_{s}} \\\\ \\frac{\\kappa}{m_{f}} & -\\frac{\\mu_{f} k^{2} + \\kappa}{m_{f}} \\end{pmatrix} \\begin{pmatrix} u \\\\ v \\end{pmatrix} $$\n\nThe system matrix $A$ is therefore:\n$$ A = \\begin{pmatrix} -\\frac{\\mu_{s} k^{2} + \\kappa}{m_{s}} & \\frac{\\kappa}{m_{s}} \\\\ \\frac{\\kappa}{m_{f}} & -\\frac{\\mu_{f} k^{2} + \\kappa}{m_{f}} \\end{pmatrix} $$\n\nThe forward Euler numerical integration scheme is given by $y_{n+1} = y_n + \\Delta t A y_n = (I + \\Delta t A) y_n$. The scheme is stable if and only if all eigenvalues of the amplification matrix $G = I + \\Delta t A$ have a magnitude less than or equal to $1$. The eigenvalues of $G$, denoted $\\lambda_G$, are related to the eigenvalues of $A$, denoted $\\lambda_A$, by $\\lambda_G = 1 + \\Delta t \\lambda_A$. The stability condition is thus $|1 + \\Delta t \\lambda_A| \\le 1$ for all eigenvalues $\\lambda_A$ of $A$.\n\nTo determine the nature of the eigenvalues $\\lambda_A$, we examine the trace and determinant of $A$.\nLet $a_s = \\frac{\\mu_{s} k^{2} + \\kappa}{m_{s}}$ and $a_f = \\frac{\\mu_{f} k^{2} + \\kappa}{m_{f}}$. Both $a_s$ and $a_f$ are strictly positive since all parameters are positive.\nThe trace of $A$ is $\\text{tr}(A) = -a_s - a_f < 0$.\nThe determinant of $A$ is:\n$$ \\det(A) = (-a_s)(-a_f) - \\left(\\frac{\\kappa}{m_{s}}\\right)\\left(\\frac{\\kappa}{m_{f}}\\right) = a_s a_f - \\frac{\\kappa^2}{m_s m_f} $$\nSubstituting the expressions for $a_s$ and $a_f$:\n$$ \\det(A) = \\frac{(\\mu_{s} k^{2} + \\kappa)(\\mu_{f} k^{2} + \\kappa)}{m_{s} m_{f}} - \\frac{\\kappa^2}{m_s m_f} = \\frac{\\mu_s \\mu_f k^4 + \\kappa(\\mu_s + \\mu_f)k^2 + \\kappa^2 - \\kappa^2}{m_s m_f} = \\frac{k^2(\\mu_s \\mu_f k^2 + \\kappa(\\mu_s + \\mu_f))}{m_s m_f} > 0 $$\nSince $\\text{tr}(A)^2 - 4\\det(A) = (-a_s - a_f)^2 - 4(a_s a_f - \\frac{\\kappa^2}{m_s m_f}) = (a_s - a_f)^2 + \\frac{4\\kappa^2}{m_s m_f} > 0$, the eigenvalues are real and distinct. Since their sum $\\text{tr}(A)$ is negative and their product $\\det(A)$ is positive, both eigenvalues must be real and negative. This corresponds to a physically stable (dissipative) system.\n\nFor a real, negative eigenvalue $\\lambda_A < 0$, the stability condition $|1 + \\Delta t \\lambda_A| \\le 1$ becomes $ -1 \\le 1 + \\Delta t \\lambda_A \\le 1$. This simplifies to $-2 \\le \\Delta t \\lambda_A \\le 0$. Since $\\Delta t > 0$ and $\\lambda_A < 0$, the right inequality is always satisfied. The left inequality gives $\\Delta t \\le -2/\\lambda_A$. To ensure stability for all modes, the time step must be limited by the eigenvalue with the largest magnitude (the most negative one). Let $\\rho(A) = \\max_i|\\lambda_{A,i}|$ be the spectral radius of $A$. The stability limit is:\n$$ \\Delta t_{\\max} = \\frac{2}{\\rho(A)} $$\n\nThe eigenvalues $\\lambda_A$ are the roots of the characteristic equation $\\lambda_A^2 - \\text{tr}(A)\\lambda_A + \\det(A) = 0$:\n$$ \\lambda_A = \\frac{\\text{tr}(A) \\pm \\sqrt{\\text{tr}(A)^2 - 4\\det(A)}}{2} $$\nThe eigenvalue with the largest magnitude is the one with the minus sign before the square root:\n$$ \\lambda_{A, \\min} = \\frac{\\text{tr}(A) - \\sqrt{\\text{tr}(A)^2 - 4\\det(A)}}{2} $$\nThe spectral radius is $\\rho(A) = |\\lambda_{A, \\min}| = -\\lambda_{A, \\min}$.\n$$ \\rho(A) = -\\frac{\\text{tr}(A) - \\sqrt{\\text{tr}(A)^2 - 4\\det(A)}}{2} = \\frac{-\\text{tr}(A) + \\sqrt{\\text{tr}(A)^2 - 4\\det(A)}}{2} $$\nSubstituting the expressions for trace and determinant in terms of $a_s$ and $a_f$:\n$$ \\rho(A) = \\frac{(a_s+a_f) + \\sqrt{(-(a_s+a_f))^2 - 4(a_s a_f - \\frac{\\kappa^2}{m_s m_f})}}{2} = \\frac{(a_s+a_f) + \\sqrt{(a_s-a_f)^2 + \\frac{4\\kappa^2}{m_s m_f}}}{2} $$\nThe maximum stable time step is then:\n$$ \\Delta t_{\\max} = \\frac{2}{\\rho(A)} = \\frac{4}{(a_s+a_f) + \\sqrt{(a_s-a_f)^2 + \\frac{4\\kappa^2}{m_s m_f}}} $$\nFinally, we substitute back the definitions of $a_s$ and $a_f$:\n$$ a_s+a_f = \\frac{\\mu_{s} k^{2} + \\kappa}{m_{s}} + \\frac{\\mu_{f} k^{2} + \\kappa}{m_{f}} $$\n$$ a_s-a_f = \\frac{\\mu_{s} k^{2} + \\kappa}{m_{s}} - \\frac{\\mu_{f} k^{2} + \\kappa}{m_{f}} $$\nInserting these into the expression for $\\Delta t_{\\max}$ gives the final closed-form solution.\n\n$$ \\Delta t_{\\max} = \\frac{4}{\\left(\\frac{\\mu_{s} k^{2} + \\kappa}{m_{s}} + \\frac{\\mu_{f} k^{2} + \\kappa}{m_{f}}\\right) + \\sqrt{\\left(\\frac{\\mu_{s} k^{2} + \\kappa}{m_{s}} - \\frac{\\mu_{f} k^{2} + \\kappa}{m_{f}}\\right)^{2} + \\frac{4\\kappa^{2}}{m_{s}m_{f}}}} $$\nThis expression represents the largest time step for which the forward Euler integration of the given coupled system is linearly stable.",
            "answer": "$$\\boxed{\\frac{4}{\\left(\\frac{\\mu_{s} k^{2} + \\kappa}{m_{s}} + \\frac{\\mu_{f} k^{2} + \\kappa}{m_{f}}\\right) + \\sqrt{\\left(\\frac{\\mu_{s} k^{2} + \\kappa}{m_{s}} - \\frac{\\mu_{f} k^{2} + \\kappa}{m_{f}}\\right)^{2} + \\frac{4\\kappa^{2}}{m_{s}m_{f}}}}}$$"
        },
        {
            "introduction": "Having analyzed the sources and consequences of errors, we now turn to designing more intelligent and efficient multiscale methods. Adaptive modeling provides a powerful framework for concentrating computational effort only where it is most needed, for example, in regions of high deformation gradients. This capstone practice  guides you through the design of an adaptive refinement algorithm, where the error indicator that drives the mesh refinement is precisely the local inconsistency between the atomistic and continuum force models.",
            "id": "3760794",
            "problem": "Consider a one-dimensional chain of $N+1$ lattice sites with reference positions $X_i = i$ for $i \\in \\{0,1,\\dots,N\\}$ and a single-degree-of-freedom deformation $y_i \\in \\mathbb{R}$ at each site $i$. The internal interactions are modeled by harmonic nearest-neighbor and next-nearest-neighbor pair potentials, and the chain is clamped at the ends, so $y_0 = 0$ and $y_N = N \\lambda$ with a prescribed macroscopic stretch $\\lambda$. Assume nondimensional units. Angles supplied within trigonometric functions must be interpreted in radians.\n\nThe atomistic energy is defined from first principles as the sum over all bonds:\n$$\nE_{\\mathrm{a}}(y) = \\sum_{i=1}^{N} \\frac{k_1}{2}\\left( (y_i - y_{i-1}) - 1 \\right)^2 + \\sum_{i=2}^{N} \\frac{k_2}{2}\\left( (y_i - y_{i-2}) - 2 \\right)^2,\n$$\nwhere $k_1 > 0$ and $k_2 \\ge 0$ are stiffness parameters and the natural spacings are $1$ and $2$ in nondimensional units. The atomistic internal force at site $i$ is obtained by the negative gradient of the energy with respect to $y_i$, applied to interior sites $i \\in \\{1,\\dots,N-1\\}$.\n\nThe Cauchy–Born continuum energy density $W(F)$ for a homogeneous deformation gradient $F$ is obtained by replacing the bond stretches by their continuum counterparts. Using this energy density, define the first Piola–Kirchhoff stress $P(F) = \\partial W / \\partial F$. Discretize the continuum model on the same lattice with control volumes at half-integer locations to obtain a discrete continuum internal force at site $i \\in \\{1,\\dots,N-1\\}$ as the difference of fluxes $P$ across the faces $i \\pm \\tfrac{1}{2}$.\n\nA Quasicontinuum Force-based (QCF) coupling selects a subset of interior sites $\\mathcal{A} \\subset \\{1,\\dots,N-1\\}$ as the atomistic region and computes the force at $i$ as the fully atomistic force if $i \\in \\mathcal{A}$, and as the discretized continuum force otherwise. The residual force indicator at site $i$ is the absolute difference between the fully atomistic force and the QCF force at that site.\n\nYour tasks are:\n- From the provided energy definitions and the principle that internal force equals the negative gradient of energy, derive the explicit expressions for the atomistic internal force and the Cauchy–Born stress in one dimension for this pair-interaction model, and then derive the discretized continuum force on lattice sites.\n- Define a residual force indicator $r_i = |F^{\\mathrm{a}}_i - F^{\\mathrm{qcf}}_i|$ for $i \\in \\{1,\\dots,N-1\\}$, where $F^{\\mathrm{a}}_i$ is the fully atomistic force and $F^{\\mathrm{qcf}}_i$ is the QCF force corresponding to a given atomistic set $\\mathcal{A}$.\n- Design an adaptive refinement criterion that enlarges $\\mathcal{A}$ by including sites where the indicator exceeds a threshold $\\tau > 0$. To ensure a contiguous atomistic region and robustness near interfaces, define the updated atomistic region as the integer interval spanning the minimum and maximum indices among $\\mathcal{A}$ and the set of flagged sites $\\{ i : r_i > \\tau \\}$, then expanded by a symmetric buffer of $b \\in \\mathbb{N}$ sites on both sides, and clipped to the interior index range $\\{1,\\dots,N-1\\}$. Iterate this update up to a prescribed maximum of $M$ refinement steps or until $\\mathcal{A}$ stabilizes.\n- The deformation $y$ is not obtained by solving an equilibrium problem; instead, prescribe $y$ as a smooth inhomogeneous field combining a macroscopic stretch, a small sinusoidal modulation, and a localized defect:\n$$\ny_i = i \\lambda + A \\sin\\!\\left( \\frac{2\\pi i}{N} \\right) + G \\exp\\!\\left( -\\frac{(i - i_c)^2}{2\\sigma^2} \\right),\n$$\nfor $i \\in \\{0,1,\\dots,N\\}$, with $y_0 = 0$ and $y_N = N \\lambda$ enforced by overwriting $y_0$ and $y_N$ if needed. Here $A \\ge 0$ and $G \\ge 0$ are amplitudes, $i_c$ is the defect center index, and $\\sigma > 0$ is the defect width in lattice units.\n\nImplement a program that carries out the above derivations and the adaptive refinement, and returns, for each specified test case, the final size $\\lvert \\mathcal{A} \\rvert$ of the atomistic region after adaptivity terminates. All quantities are nondimensional; no physical unit conversion is required.\n\nUse the following test suite, each case specified as an ordered tuple $(N, k_1, k_2, \\lambda, A, G, i_c, \\sigma, a_L, a_R, \\tau, b, M)$, where the initial atomistic region is the integer interval $\\mathcal{A} = \\{ a_L, a_L+1, \\dots, a_R \\}$ clipped to $\\{1,\\dots,N-1\\}$:\n- Case $1$: $(80, 1.0, 0.3, 1.0, 0.02, 0.10, 40, 3.0, 30, 40, 0.02, 2, 5)$.\n- Case $2$: $(80, 1.0, 0.3, 1.0, 0.02, 0.10, 40, 3.0, 30, 40, 1.00, 2, 5)$.\n- Case $3$: $(80, 1.0, 0.3, 1.0, 0.02, 0.10, 40, 3.0, 30, 40, 1.0\\times 10^{-6}, 1, 5)$.\n- Case $4$: $(60, 1.0, 0.5, 1.0, 0.05, 0.08, 20, 2.0, 1, 1, 0.01, 1, 10)$.\n- Case $5$: $(100, 1.0, 0.05, 1.0, 0.03, 0.05, 50, 4.0, 45, 55, 0.005, 3, 4)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4,r_5]$), where $r_j$ is the final atomistic region size $\\lvert \\mathcal{A} \\rvert$ for case $j$ computed by your implementation.",
            "solution": "The problem is valid as it is scientifically grounded in multiscale computational mechanics, well-posed, and all terms and procedures are defined objectively and unambiguously. The following sections detail the derivation of the required physical quantities and the design of the specified adaptive algorithm.\n\n### Derivation of Internal Forces and Stress\n\nThe problem is defined on a one-dimensional lattice of $N+1$ sites with reference positions $X_i = i$ for $i \\in \\{0, 1, \\dots, N\\}$. The deformation at each site is given by $y_i$. The total atomistic potential energy $E_{\\mathrm{a}}$ is given by the sum of nearest-neighbor (NN) and next-nearest-neighbor (NNN) harmonic interactions:\n$$\nE_{\\mathrm{a}}(y) = \\sum_{i=1}^{N} \\frac{k_1}{2}\\left( (y_i - y_{i-1}) - 1 \\right)^2 + \\sum_{i=2}^{N} \\frac{k_2}{2}\\left( (y_i - y_{i-2}) - 2 \\right)^2\n$$\nwhere $k_1$ and $k_2$ are stiffness constants, and the numbers $1$ and $2$ represent the natural bond lengths for NN and NNN pairs, respectively.\n\n#### 1. Atomistic Internal Force ($F^{\\mathrm{a}}_i$)\n\nThe internal force at an interior site $i \\in \\{1, \\dots, N-1\\}$ is the negative gradient of the potential energy with respect to the displacement $y_i$: $F^{\\mathrm{a}}_i = -\\frac{\\partial E_{\\mathrm{a}}}{\\partial y_i}$. We find the derivative by identifying all terms in $E_{\\mathrm{a}}$ that depend on $y_i$. For an arbitrary interior site $i$, these are the potentials of the bonds $(i, i-1)$, $(i+1, i)$, $(i, i-2)$, and $(i+2, i)$.\n\nThe derivative is:\n$$\n-\\frac{\\partial E_{\\mathrm{a}}}{\\partial y_i} = -\\frac{\\partial}{\\partial y_i} \\left[ \\frac{k_1}{2}((y_i-y_{i-1})-1)^2 + \\frac{k_1}{2}((y_{i+1}-y_i)-1)^2 + \\frac{k_2}{2}((y_i-y_{i-2})-2)^2 + \\frac{k_2}{2}((y_{i+2}-y_i)-2)^2 \\right]\n$$\nTaking the partial derivatives term-by-term yields:\n$$\nF^{\\mathrm{a}}_i = - k_1((y_i-y_{i-1})-1) \\cdot (1) - k_1((y_{i+1}-y_i)-1) \\cdot (-1) - k_2((y_i-y_{i-2})-2) \\cdot (1) - k_2((y_{i+2}-y_i)-2) \\cdot (-1)\n$$\nRearranging terms gives the expression for the atomistic force:\n$$\nF^{\\mathrm{a}}_i = \\underbrace{k_1((y_{i+1}-y_i)-1)}_{\\text{Force from bond } (i+1,i)} - \\underbrace{k_1((y_i-y_{i-1})-1)}_{\\text{Force from bond } (i,i-1)} + \\underbrace{k_2((y_{i+2}-y_i)-2)}_{\\text{Force from bond } (i+2,i)} - \\underbrace{k_2((y_i-y_{i-2})-2)}_{\\text{Force from bond } (i,i-2)}\n$$\nThis general expression is valid for $i \\in \\{2, \\dots, N-2\\}$. For sites near the boundaries of the free domain, specifically $i=1$ and $i=N-1$, some terms are not present as they would involve sites outside the domain $\\{0, \\dots, N\\}$:\n- For $i=1$: The bond $(1, -1)$ does not exist. The NNN force involves $y_3$ and $y_1$, but not $y_{-1}$. The terms containing $y_1$ are from bonds $(1,0), (2,1), (3,1)$.\n  $$\n  F^{\\mathrm{a}}_1 = k_1((y_2-y_1)-1) - k_1((y_1-y_0)-1) + k_2((y_3-y_1)-2)\n  $$\n- For $i=N-1$: The bond $(N+1, N-1)$ does not exist. The NNN force involves $y_{N-1}$ and $y_{N-3}$, but not $y_{N+1}$.\n  $$\n  F^{\\mathrm{a}}_{N-1} = k_1((y_N-y_{N-1})-1) - k_1((y_{N-1}-y_{N-2})-1) - k_2((y_{N-1}-y_{N-3})-2)\n  $$\n\n#### 2. Cauchy–Born Stress ($P(F)$) and Discretized Continuum Force ($F^{\\mathrm{c}}_i$)\n\nThe Cauchy-Born hypothesis relates microscopic deformation to a macroscopic deformation gradient $F$. For a homogeneous deformation, $y_i = F X_i = Fi$.\nThe stretch of a NN bond $(i, i-1)$ is $y_i - y_{i-1} = F$.\nThe stretch of a NNN bond $(i, i-2)$ is $y_i - y_{i-2} = 2F$.\n\nThe continuum energy density $W(F)$ is the energy per unit reference volume (here, length). For a representative cell of unit length, the energy contributions from NN and NNN bonds are averaged.\n$$\nW(F) = \\frac{k_1}{2}(F - 1)^2 + \\frac{k_2}{2}(2F - 2)^2 = \\frac{k_1}{2}(F-1)^2 + 2k_2(F-1)^2 = \\frac{1}{2}(k_1 + 4k_2)(F-1)^2\n$$\nThe first Piola-Kirchhoff stress $P(F)$ is the derivative of the energy density with respect to the deformation gradient:\n$$\nP(F) = \\frac{\\partial W}{\\partial F} = (k_1 + 4k_2)(F-1)\n$$\nTo find the continuum force $F^{\\mathrm{c}}_i$ on site $i$, we use a finite volume discretization. The force is the difference in stress fluxes across the boundaries of the control volume centered at $i$. These boundaries are at $X=i \\pm \\frac{1}{2}$. The deformation gradient is approximated at these locations:\n- At $i-\\frac{1}{2}$: $F_{i-\\frac{1}{2}} \\approx \\frac{y_i - y_{i-1}}{X_i - X_{i-1}} = y_i - y_{i-1}$.\n- At $i+\\frac{1}{2}$: $F_{i+\\frac{1}{2}} \\approx \\frac{y_{i+1} - y_i}}{X_{i+1} - X_i} = y_{i+1} - y_i$.\n\nThe continuum force is then $F^{\\mathrm{c}}_i = P(F_{i+\\frac{1}{2}}) - P(F_{i-\\frac{1}{2}})$.\n$$\nF^{\\mathrm{c}}_i = (k_1 + 4k_2)((y_{i+1}-y_i)-1) - (k_1 + 4k_2)((y_i-y_{i-1})-1)\n$$\nThis continuum force is local, depending only on the displacements of nearest neighbors, in contrast to the non-local atomistic force.\n\n### Adaptive Refinement Algorithm\n\nThe Quasicontinuum Force-based (QCF) method combines the atomistic and continuum models.\nThe force at site $i$, $F^{\\mathrm{qcf}}_i$, is taken from the atomistic model if $i$ is in the atomistic region $\\mathcal{A}$, and from the continuum model otherwise.\n$$\nF^{\\mathrm{qcf}}_i = \\begin{cases} F^{\\mathrm{a}}_i & \\text{if } i \\in \\mathcal{A} \\\\ F^{\\mathrm{c}}_i & \\text{if } i \\notin \\mathcal{A} \\end{cases}\n$$\nThe quality of this approximation is measured by the residual force indicator $r_i = |F^{\\mathrm{a}}_i - F^{\\mathrm{qcf}}_i|$. This indicator is non-zero only in the continuum region ($i \\notin \\mathcal{A}$), where it equals $|F^{\\mathrm{a}}_i - F^{\\mathrm{c}}_i|$.\n\nThe adaptive algorithm refines the atomistic region $\\mathcal{A}$ based on this indicator. The procedure is as follows:\n\n1.  **Initialization**:\n    a. For a given set of parameters $(N, k_1, k_2, \\lambda, A, G, i_c, \\sigma)$, compute the prescribed deformation field $y_i$ for $i \\in \\{0, \\dots, N\\}$, ensuring the boundary conditions $y_0=0$ and $y_N=N\\lambda$ are enforced.\n    b. Compute the full atomistic force field $F^{\\mathrm{a}}_i$ and the full continuum force field $F^{\\mathrm{c}}_i$ for all interior sites $i \\in \\{1, \\dots, N-1\\}$.\n    c. Initialize the atomistic region $\\mathcal{A}$ as the set of integers in the interval $[a_L, a_R]$, clipped to the valid interior index range $\\{1, \\dots, N-1\\}$.\n\n2.  **Iteration**: Repeat for a maximum of $M$ steps or until $\\mathcal{A}$ no longer changes.\n    a. Calculate the residual indicator $r_i = |F^{\\mathrm{a}}_i - F^{\\mathrm{c}}_i|$ for all sites $i \\notin \\mathcal{A}$.\n    b. Identify the set of flagged sites $\\mathcal{F} = \\{ i \\mid r_i > \\tau \\}$, where $\\tau$ is a given tolerance.\n    c. If $\\mathcal{F}$ is empty, the mesh is considered adequate, and the iteration terminates.\n    d. Otherwise, update the atomistic region:\n        i.  Form a temporary set $\\mathcal{A}' = \\mathcal{A} \\cup \\mathcal{F}$.\n        ii. Find the minimum and maximum indices in this set: $i_{\\min} = \\min(\\mathcal{A}')$ and $i_{\\max} = \\max(\\mathcal{A}')$.\n        iii. Expand this range by a buffer $b$: the new interval is $[i_{\\min}-b, i_{\\max}+b]$.\n        iv. The new atomistic set $\\mathcal{A}$ consists of all integers in this expanded interval, clipped to the range $\\{1, \\dots, N-1\\}$.\n    e. If the new set $\\mathcal{A}$ is identical to the one from the previous step, the adaptivity has stabilized, and the iteration terminates.\n\n3.  **Output**: The final result for each test case is the size of the final atomistic region, $|\\mathcal{A}|$.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(case):\n    \"\"\"\n    Runs a single simulation for a given set of parameters.\n    \"\"\"\n    N, k1, k2, lam, A, G, ic, sigma, a_L, a_R, tau, b, M = case\n    \n    # 1. Initialization: Compute deformation field y\n    i_coords = np.arange(N + 1)\n    y = (i_coords * lam \n         + A * np.sin(2 * np.pi * i_coords / N)\n         + G * np.exp(-(i_coords - ic)**2 / (2 * sigma**2)))\n    \n    # Enforce boundary conditions\n    y[0] = 0.0\n    y[N] = N * lam\n\n    # 2. Compute full atomistic and continuum forces\n    Fa = np.zeros(N + 1)\n    Fc = np.zeros(N + 1)\n    \n    # Atomistic forces Fa for i in {1, ..., N-1}\n    for i in range(1, N):\n        # Nearest-neighbor contributions\n        f_nn_plus_1 = k1 * (y[i+1] - y[i] - 1.0)\n        f_nn_i = k1 * (y[i] - y[i-1] - 1.0)\n        force = f_nn_plus_1 - f_nn_i\n        \n        # Next-nearest-neighbor contributions\n        if i = N - 2:\n            f_nnn_plus_2 = k2 * (y[i+2] - y[i] - 2.0)\n            force += f_nnn_plus_2\n        if i >= 2:\n            f_nnn_i = k2 * (y[i] - y[i-2] - 2.0)\n            force -= f_nnn_i\n        Fa[i] = force\n\n    # Continuum forces Fc for i in {1, ..., N-1}\n    k_eff = k1 + 4.0 * k2\n    P_stress = k_eff * ((y[1:] - y[:-1]) - 1.0)\n    Fc[1:-1] = P_stress[1:] - P_stress[:-1]\n    \n    # 3. Initialize atomistic set A\n    # The set of integers in [a_L, a_R] clipped to [1, N-1]\n    initial_a_L = max(1, a_L)\n    initial_a_R = min(N - 1, a_R)\n    if initial_a_L > initial_a_R:\n        atomistic_indices = set()\n    else:\n        atomistic_indices = set(range(initial_a_L, initial_a_R + 1))\n\n    # 4. Adaptive refinement loop\n    for _ in range(M):\n        prev_atomistic_indices = atomistic_indices.copy()\n\n        # Calculate residual indicator r_i = |Fa_i - Fqc_i|\n        # Note: r_i is non-zero only for i not in atomistic_indices, where Fqc_i = Fc_i\n        continuum_indices = set(range(1, N)) - atomistic_indices\n        \n        flagged_indices = set()\n        if continuum_indices:\n            # Vectorized calculation for indices in the continuum region\n            cont_idx_arr = np.array(list(continuum_indices))\n            residuals = np.abs(Fa[cont_idx_arr] - Fc[cont_idx_arr])\n            flagged_mask = residuals > tau\n            flagged_indices = set(cont_idx_arr[flagged_mask])\n\n        if not flagged_indices:\n            # Convergence: no sites flagged for refinement\n            break\n\n        # Update atomistic set\n        all_indices_to_enclose = atomistic_indices.union(flagged_indices)\n        \n        new_aL_core = min(all_indices_to_enclose)\n        new_aR_core = max(all_indices_to_enclose)\n\n        # Expand by buffer b and clip to {1, ..., N-1}\n        final_aL = max(1, new_aL_core - b)\n        final_aR = min(N - 1, new_aR_core + b)\n        \n        atomistic_indices = set(range(final_aL, final_aR + 1))\n\n        if atomistic_indices == prev_atomistic_indices:\n            # Convergence: atomistic set has stabilized\n            break\n            \n    # 5. Return the final size of the atomistic region\n    return len(atomistic_indices)\n\n\ndef solve():\n    \"\"\"\n    Main solver function to process all test cases.\n    \"\"\"\n    test_cases = [\n        # (N, k1, k2, lam, A, G, ic, sigma, a_L, a_R, tau, b, M)\n        (80, 1.0, 0.3, 1.0, 0.02, 0.10, 40, 3.0, 30, 40, 0.02, 2, 5),\n        (80, 1.0, 0.3, 1.0, 0.02, 0.10, 40, 3.0, 30, 40, 1.00, 2, 5),\n        (80, 1.0, 0.3, 1.0, 0.02, 0.10, 40, 3.0, 30, 40, 1.0e-6, 1, 5),\n        (60, 1.0, 0.5, 1.0, 0.05, 0.08, 20, 2.0, 1, 1, 0.01, 1, 10),\n        (100, 1.0, 0.05, 1.0, 0.03, 0.05, 50, 4.0, 45, 55, 0.005, 3, 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(case)\n        results.append(result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}