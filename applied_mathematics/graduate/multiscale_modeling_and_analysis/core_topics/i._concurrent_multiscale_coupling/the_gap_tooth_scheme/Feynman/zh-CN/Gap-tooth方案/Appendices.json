{
    "hands_on_practices": [
        {
            "introduction": "在多尺度建模中，如何从精细的微观状态中提取出宏观可观测量是一个核心问题，这个过程被称为“约束”（Restriction）。本练习通过一个包含微观尺度振荡的假设场，引导您分析和比较两种常见的约束算子：点态约束和体积平均约束。通过计算这两种方法的偏差和方差，您将亲身体会到为何空间平均对于抑制由未解析的微观细节引起的随机误差至关重要 ()。",
            "id": "3819081",
            "problem": "考虑一个用于空间光滑宏观场的一维缺齿格式粗粒化时间步进格式。在一个中心位于 $X$、宽度为 $h$ 的单个齿内，假设微观解表现出波长为 $O(\\epsilon)$ 的齿内振荡，其在该齿上的主导阶可由以下模型描述：\n$$\nu_{\\epsilon}(x) \\;=\\; U \\;+\\; a \\,\\cos\\!\\left(\\frac{2\\pi}{\\epsilon}\\,x \\;+\\; \\Theta\\right),\n$$\n其中 $U$ 和 $a$ 是在该齿上近似为常数的宏观量，$\\epsilon>0$ 满足 $\\epsilon \\ll h$，而 $\\Theta$ 是一个未知的微观相位，被建模为一个在 $[0,2\\pi)$ 上均匀分布且在不同实现中相互独立的随机变量。定义两个约束算子，将齿内的微观解映射到一个粗观测量：\n- 齿心点值约束：$R_{\\mathrm{pt}} \\,=\\, u_{\\epsilon}(X)$。\n- 齿上体积平均约束：$R_{\\mathrm{av}} \\,=\\, \\dfrac{1}{h}\\,\\displaystyle\\int_{X-\\frac{h}{2}}^{X+\\frac{h}{2}} u_{\\epsilon}(x)\\,dx$。\n\n仅使用期望和方差的定义以及标准微积分恒等式，通过对微观相位 $\\Theta$ 进行平均，计算每个约束相对于宏观量 $U$ 的偏差和方差。具体而言，计算\n$$\nb_{\\mathrm{pt}} \\;=\\; \\mathbb{E}[R_{\\mathrm{pt}}] - U,\\quad b_{\\mathrm{av}} \\;=\\; \\mathbb{E}[R_{\\mathrm{av}}] - U,\\quad v_{\\mathrm{pt}} \\;=\\; \\mathrm{Var}(R_{\\mathrm{pt}}),\\quad v_{\\mathrm{av}} \\;=\\; \\mathrm{Var}(R_{\\mathrm{av}}),\n$$\n将其表示为 $a$、$h$ 和 $\\epsilon$ 的函数。\n\n请将最终结果以单行矩阵的形式按顺序 $\\bigl[b_{\\mathrm{pt}},\\, b_{\\mathrm{av}},\\, v_{\\mathrm{pt}},\\, v_{\\mathrm{av}}\\bigr]$ 给出。无需进行数值近似或四舍五入，且不涉及物理单位。请精确表示三角函数项；在最终答案中不要对小的 $\\epsilon/h$ 进行近似。",
            "solution": "该问题在多尺度分析领域内具有科学依据、是良定的、客观且自洽的，因此是有效的。我们可以开始求解。\n\n问题的核心是计算一个随机变量 $\\Theta$ 的函数的期望和方差，该随机变量在区间 $[0, 2\\pi)$ 上均匀分布。$\\Theta$ 的概率密度函数 (PDF) 为 $f(\\theta) = \\frac{1}{2\\pi}$（当 $\\theta \\in [0, 2\\pi)$ 时），否则为 $f(\\theta) = 0$。任意函数 $g(\\Theta)$ 的期望由下式给出\n$$\n\\mathbb{E}[g(\\Theta)] \\;=\\; \\int_{0}^{2\\pi} g(\\theta) f(\\theta) \\,d\\theta \\;=\\; \\frac{1}{2\\pi} \\int_{0}^{2\\pi} g(\\theta) \\,d\\theta.\n$$\n方差由 $\\mathrm{Var}(g(\\Theta)) = \\mathbb{E}[g(\\Theta)^2] - (\\mathbb{E}[g(\\Theta)])^2$ 给出。\n\n我们将使用两个在一个 $2\\pi$ 周期上的基本积分恒等式：\n对于任意整数 $n \\neq 0$ 和任意常数相位 $\\phi$，\n$$\n\\int_{0}^{2\\pi} \\cos(n\\theta + \\phi) \\,d\\theta = 0\n$$\n$$\n\\int_{0}^{2\\pi} \\cos^2(\\theta + \\phi) \\,d\\theta = \\int_{0}^{2\\pi} \\frac{1+\\cos(2(\\theta+\\phi))}{2} \\,d\\theta = \\frac{1}{2} \\left[ \\theta \\right]_{0}^{2\\pi} + \\frac{1}{2}\\int_{0}^{2\\pi} \\cos(2\\theta+2\\phi) \\, d\\theta = \\pi.\n$$\n由此，我们推导出期望值：\n$\\mathbb{E}[\\cos(n\\Theta + \\phi)] = \\frac{1}{2\\pi} \\cdot 0 = 0$，对于 $n \\in \\mathbb{Z}, n \\neq 0$。\n$\\mathbb{E}[\\cos^2(\\Theta + \\phi)] = \\frac{1}{2\\pi} \\cdot \\pi = \\frac{1}{2}$。\n\n### 对点值约束 $R_{\\mathrm{pt}}$ 的分析\n\n点值约束定义为 $R_{\\mathrm{pt}} = u_{\\epsilon}(X)$。代入 $u_{\\epsilon}(x)$ 的表达式：\n$$\nR_{\\mathrm{pt}} = U \\;+\\; a \\,\\cos\\!\\left(\\frac{2\\pi}{\\epsilon}\\,X \\;+\\; \\Theta\\right)\n$$\n我们定义一个常数相位 $\\phi_X = \\frac{2\\pi}{\\epsilon}X$。那么，$R_{\\mathrm{pt}} = U + a \\cos(\\phi_X + \\Theta)$。\n\n**偏差 $b_{\\mathrm{pt}}$：**\n偏差为 $b_{\\mathrm{pt}} = \\mathbb{E}[R_{\\mathrm{pt}}] - U$。我们首先计算 $R_{\\mathrm{pt}}$ 的期望：\n$$\n\\mathbb{E}[R_{\\mathrm{pt}}] = \\mathbb{E}[U + a \\cos(\\phi_X + \\Theta)] = \\mathbb{E}[U] + a \\mathbb{E}[\\cos(\\phi_X + \\Theta)]\n$$\n由于 $U$ 和 $a$ 相对于关于 $\\Theta$ 的系综是常数，并使用恒等式 $\\mathbb{E}[\\cos(\\Theta+\\phi_X)]=0$，我们得到：\n$$\n\\mathbb{E}[R_{\\mathrm{pt}}] = U + a \\cdot 0 = U\n$$\n因此，偏差为：\n$$\nb_{\\mathrm{pt}} = U - U = 0\n$$\n\n**方差 $v_{\\mathrm{pt}}$：**\n方差为 $v_{\\mathrm{pt}} = \\mathrm{Var}(R_{\\mathrm{pt}})$。\n$$\nv_{\\mathrm{pt}} = \\mathrm{Var}(U + a \\cos(\\phi_X + \\Theta))\n$$\n使用对于常数 $C$ 和 $k$ 的性质 $\\mathrm{Var}(C+kY) = k^2\\mathrm{Var}(Y)$，我们有：\n$$\nv_{\\mathrm{pt}} = a^2 \\mathrm{Var}(\\cos(\\phi_X + \\Theta))\n$$\n$\\cos(\\phi_X + \\Theta)$ 的方差为：\n$$\n\\mathrm{Var}(\\cos(\\phi_X + \\Theta)) = \\mathbb{E}[\\cos^2(\\phi_X + \\Theta)] - (\\mathbb{E}[\\cos(\\phi_X + \\Theta)])^2\n$$\n我们已经求得 $\\mathbb{E}[\\cos(\\phi_X + \\Theta)] = 0$。使用恒等式 $\\mathbb{E}[\\cos^2(\\Theta+\\phi_X)]=\\frac{1}{2}$：\n$$\n\\mathrm{Var}(\\cos(\\phi_X + \\Theta)) = \\frac{1}{2} - 0^2 = \\frac{1}{2}\n$$\n将此结果代回到 $v_{\\mathrm{pt}}$ 的表达式中：\n$$\nv_{\\mathrm{pt}} = a^2 \\cdot \\frac{1}{2} = \\frac{a^2}{2}\n$$\n\n### 对体积平均约束 $R_{\\mathrm{av}}$ 的分析\n\n体积平均约束定义为 $R_{\\mathrm{av}} = \\frac{1}{h}\\,\\displaystyle\\int_{X-\\frac{h}{2}}^{X+\\frac{h}{2}} u_{\\epsilon}(x)\\,dx$。\n$$\nR_{\\mathrm{av}} = \\frac{1}{h}\\,\\displaystyle\\int_{X-\\frac{h}{2}}^{X+\\frac{h}{2}} \\left[ U + a \\cos\\!\\left(\\frac{2\\pi}{\\epsilon}\\,x \\;+\\; \\Theta\\right) \\right] \\,dx\n$$\n我们可以将积分拆分：\n$$\nR_{\\mathrm{av}} = \\frac{1}{h} \\left( \\int_{X-\\frac{h}{2}}^{X+\\frac{h}{2}} U \\,dx + a \\int_{X-\\frac{h}{2}}^{X+\\frac{h}{2}} \\cos\\!\\left(\\frac{2\\pi}{\\epsilon}\\,x \\;+\\; \\Theta\\right) \\,dx \\right)\n$$\n第一个积分为 $\\int_{X-\\frac{h}{2}}^{X+\\frac{h}{2}} U \\,dx = U \\cdot h$。\n对于第二个积分，令 $k = \\frac{2\\pi}{\\epsilon}$：\n$$\n\\int_{X-\\frac{h}{2}}^{X+\\frac{h}{2}} \\cos(kx + \\Theta) \\,dx = \\left[ \\frac{1}{k} \\sin(kx+\\Theta) \\right]_{X-\\frac{h}{2}}^{X+\\frac{h}{2}} = \\frac{1}{k} \\left( \\sin\\left(k\\left(X+\\frac{h}{2}\\right) + \\Theta\\right) - \\sin\\left(k\\left(X-\\frac{h}{2}\\right) + \\Theta\\right) \\right)\n$$\n使用三角恒等式 $\\sin(A) - \\sin(B) = 2\\cos\\left(\\frac{A+B}{2}\\right)\\sin\\left(\\frac{A-B}{2}\\right)$，其中 $A = kX+\\frac{kh}{2}+\\Theta$ 和 $B = kX-\\frac{kh}{2}+\\Theta$，我们得到：\n$\\frac{A+B}{2} = kX+\\Theta$ 和 $\\frac{A-B}{2} = \\frac{kh}{2}$。\n积分变为：\n$$\n\\frac{1}{k} \\left( 2 \\cos(kX+\\Theta) \\sin\\left(\\frac{kh}{2}\\right) \\right)\n$$\n将此结果代回到 $R_{\\mathrm{av}}$ 的表达式中：\n$$\nR_{\\mathrm{av}} = \\frac{1}{h} \\left( Uh + a \\cdot \\frac{2}{k} \\cos(kX+\\Theta) \\sin\\left(\\frac{kh}{2}\\right) \\right) = U + a \\frac{2}{kh} \\sin\\left(\\frac{kh}{2}\\right) \\cos(kX+\\Theta)\n$$\n代入 $k = \\frac{2\\pi}{\\epsilon}$，则项 $\\frac{kh}{2} = \\frac{2\\pi}{\\epsilon}\\frac{h}{2} = \\frac{\\pi h}{\\epsilon}$。乘以余弦的因子变为：\n$$\na \\frac{2}{\\frac{2\\pi h}{\\epsilon}} \\sin\\left(\\frac{\\pi h}{\\epsilon}\\right) = a \\frac{\\epsilon}{\\pi h} \\sin\\left(\\frac{\\pi h}{\\epsilon}\\right)\n$$\n因此，我们可以将 $R_{\\mathrm{av}}$ 写为：\n$$\nR_{\\mathrm{av}} = U + \\left(a \\frac{\\epsilon}{\\pi h} \\sin\\left(\\frac{\\pi h}{\\epsilon}\\right)\\right) \\cos\\!\\left(\\frac{2\\pi}{\\epsilon}\\,X \\;+\\; \\Theta\\right)\n$$\n\n**偏差 $b_{\\mathrm{av}}$：**\n$R_{\\mathrm{av}}$ 的结构与 $R_{\\mathrm{pt}}$ 相同，只是振幅 $a$ 被一个新的常数振幅 $a' = a \\frac{\\epsilon}{\\pi h} \\sin\\left(\\frac{\\pi h}{\\epsilon}\\right)$ 所取代。\n$$\n\\mathbb{E}[R_{\\mathrm{av}}] = \\mathbb{E}\\left[ U + a' \\cos(\\phi_X + \\Theta) \\right] = U + a' \\mathbb{E}[\\cos(\\phi_X+\\Theta)] = U + a' \\cdot 0 = U\n$$\n因此，偏差为：\n$$\nb_{\\mathrm{av}} = \\mathbb{E}[R_{\\mathrm{av}}] - U = U - U = 0\n$$\n\n**方差 $v_{\\mathrm{av}}$：**\n类似地，其方差的计算过程与 $v_{\\mathrm{pt}}$ 相同，只需将 $a$ 替换为 $a'$：\n$$\nv_{\\mathrm{av}} = \\mathrm{Var}(U + a' \\cos(\\phi_X + \\Theta)) = (a')^2 \\mathrm{Var}(\\cos(\\phi_X+\\Theta)) = (a')^2 \\cdot \\frac{1}{2}\n$$\n代入 $a'$ 的表达式：\n$$\nv_{\\mathrm{av}} = \\frac{1}{2} \\left( a \\frac{\\epsilon}{\\pi h} \\sin\\left(\\frac{\\pi h}{\\epsilon}\\right) \\right)^2 = \\frac{a^2 \\epsilon^2}{2 \\pi^2 h^2} \\sin^2\\left(\\frac{\\pi h}{\\epsilon}\\right)\n$$\n\n所求的四个量为：\n$b_{\\mathrm{pt}} = 0$\n$b_{\\mathrm{av}} = 0$\n$v_{\\mathrm{pt}} = \\frac{a^2}{2}$\n$v_{\\mathrm{av}} = \\frac{a^2 \\epsilon^2}{2 \\pi^2 h^2} \\sin^2\\left(\\frac{\\pi h}{\\epsilon}\\right)$\n我们将这些结果整理成所需的最终格式。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & 0 & \\frac{a^2}{2} & \\frac{a^2 \\epsilon^2}{2 \\pi^2 h^2} \\sin^2\\left(\\frac{\\pi h}{\\epsilon}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "任何显式时间步进格式的成功实施都离不开数值稳定性。这个练习将指导您为应用于扩散过程的缺齿格式推导一个宏观尺度上的 Courant-Friedrichs-Lewy (CFL) 式稳定性条件。通过分析最快可分辨模式的衰减，您将学习如何将宏观时间步长 $\\Delta t$ 的稳定性约束与微观物理特性（如扩散系数 $D$）和粗粒化几何参数（如片区大小 $\\delta$）联系起来 ()。",
            "id": "3819099",
            "problem": "考虑用于一维($1$D)扩散过程的缺齿格式，该过程在微观上由偏微分方程(PDE) $\\partial_{t} u = D \\,\\partial_{xx} u$ 控制，其中 $D$ 是常数扩散系数。宏观求解器使用一个大小为 $\\Delta t$ 的前向欧拉宏观时间步来推进粗粒化变量 $U$（定义为片区平均的微观场），其所用的“斜率”由每个物理宽度为 $\\delta$ 的片区内部在短的微观时间 $\\tau$ 内的微观时间积分提供。在每个片区内，微观求解器施加与粗粒化场一致的狄利克雷型边界条件，以抑制片区间的伪瞬态；假设片区内的微观谱是在长度为 $\\delta$ 的区间上的拉普拉斯算子的谱。Courant-Friedrichs-Lewy (CFL) 条件是偏微分方程中显式时间步进的经典稳定性准则。\n\n从扩散的第一性原理出发，并利用片区层面的适当谱或能量论证，推导出一个粗粒化的类CFL稳定性要求，该要求用 $D$ 和 $\\delta$ 来约束 $\\Delta t$，以使显式粗粒化前向欧拉更新对于由片区闭包支持的最快可粗粒化解析的扩散模式是线性稳定的。假设粗粒化更新忠实地表示了傅里叶模式的扩散衰减率，直至片区几何支持的最高波数。\n\n以 $D$ 和 $\\delta$ 为变量，提供最大允许宏观时间步 $\\Delta t_{\\max}$ 的单一闭式解析表达式。你的最终答案应以秒为单位。没有提供数值；你的推导必须仅依赖于扩散方程、区间上拉普拉斯算子特征谱的标准性质，以及线性衰减的显式欧拉稳定性。除这些基础要素外，不要使用任何快捷公式。你的最终答案必须是单一表达式，而不是不等式或句子。",
            "solution": "问题要求为应用于一维扩散过程 $\\partial_{t} u = D \\,\\partial_{xx} u$ 的缺齿格式的宏观时间步 $\\Delta t$ 推导一个稳定性条件。该格式对粗粒化变量 $U$ 使用前向欧拉更新。\n\n在给定时间 $t$，对粗粒化变量 $U$ 的前向欧拉更新形式如下：\n$$ U(t + \\Delta t) = U(t) + \\Delta t \\cdot \\mathcal{F}(U(t)) $$\n其中 $\\mathcal{F}(U(t))$ 代表由微观求解器估计的 $U$ 的时间导数。由于底层过程是线性的，我们可以通过考虑该数值格式对粗粒化场的单个傅里叶模式的作用来分析其稳定性。设粗粒化空间变量为 $X$，粗网格的间距等于片区宽度 $\\delta$。此粗网格上的一个傅里叶模式可以写为 $U(X,t) = \\hat{U}(k, t) e^{i k X}$，其中 $k$ 是粗粒化波数。\n\n对于扩散过程，该模式预计会随时间指数衰减，形式为 $\\hat{U}(k, t) = \\hat{U}(k, 0) e^{-\\lambda(k) t}$，其中 $\\lambda(k)$ 是与波数 $k$ 相关的衰减率。因此时间导数为 $\\frac{d\\hat{U}}{dt} = -\\lambda(k) \\hat{U}$。该模式幅度的前向欧拉更新为：\n$$ \\hat{U}(k, t + \\Delta t) = \\hat{U}(k, t) - \\Delta t \\cdot \\lambda(k) \\hat{U}(k,t) = (1 - \\Delta t \\lambda(k)) \\hat{U}(k,t) $$\n此更新的放大因子为 $g(k) = 1 - \\Delta t \\lambda(k)$。为保证线性稳定性，我们要求对于所有相关波数 $k$ 都满足 $|g(k)| \\leq 1$。由于 $\\lambda(k)$ 代表被动系统的物理衰减率，它必须是非负的，即 $\\lambda(k) \\ge 0$。因此，条件 $|1 - \\Delta t \\lambda(k)| \\leq 1$ 等价于：\n$$ -1 \\leq 1 - \\Delta t \\lambda(k) \\leq 1 $$\n上界 $1 - \\Delta t \\lambda(k) \\leq 1$ 意味着 $-\\Delta t \\lambda(k) \\leq 0$，这对于 $\\Delta t > 0$ 和 $\\lambda(k) \\ge 0$ 总是成立。下界 $-1 \\leq 1 - \\Delta t \\lambda(k)$ 得出稳定性约束：\n$$ \\Delta t \\lambda(k) \\leq 2 $$\n这对于格式设计要解析的所有模式 $k$ 都必须成立。最严格的条件是由具有最大衰减率 $\\lambda_{\\max}$ 的模式施加的：\n$$ \\Delta t \\leq \\frac{2}{\\lambda_{\\max}} $$\n问题在于确定这个 $\\lambda_{\\max}$。我们得到了两条关键信息。\n首先，问题陈述“粗粒化更新忠实地表示了傅里叶模式的扩散衰减率，直至片区几何支持的最高波数。”对于连续扩散偏微分方程 $\\partial_{t} u = D \\,\\partial_{xx} u$，一个傅里叶模式 $e^{ikx}$ 以衰减率 $\\lambda(k) = D k^2$ 演化。忠实表示的假设意味着有效的粗粒化动力学也具有此色散关系，$\\lambda(k) = D k^2$。\n\n其次，我们必须确定“最快可粗粒化解析的扩散模式”。粗网格由宽度为 $\\delta$ 的片区组成，这意味着有效网格间距为 $\\delta$。根据奈奎斯特-香农采样定理，间距为 $\\delta$ 的网格可以解析的最小波长为 $2\\delta$。这对应于最大波数（奈奎斯特频率）：\n$$ k_{\\max} = \\frac{2\\pi}{2\\delta} = \\frac{\\pi}{\\delta} $$\n这个模式代表了粗网格可以支持的最振荡的模式，其中 $U$ 的值在相邻片区之间符号交替。\n\n综合这些事实，粗粒化前向欧拉格式必须处理的最大衰减率是在最大可解析波数处评估的连续偏微分方程的衰减率：\n$$ \\lambda_{\\max} = \\lambda(k_{\\max}) = D k_{\\max}^2 = D \\left(\\frac{\\pi}{\\delta}\\right)^2 = \\frac{D\\pi^2}{\\delta^2} $$\n将这个 $\\lambda_{\\max}$ 的表达式代入前向欧拉步的稳定性条件中，得到：\n$$ \\Delta t \\leq \\frac{2}{\\frac{D\\pi^2}{\\delta^2}} = \\frac{2\\delta^2}{D\\pi^2} $$\n这个结果代表了宏观时间步的粗粒化类CFL稳定性要求。最大允许时间步 $\\Delta t_{\\max}$ 是此不等式的上限。\n\n我们可以用“片区内的微观谱是在长度为 $\\delta$ 的区间上的拉普拉斯算子的谱”这一陈述来验证此结果的一致性。这意味着在片区级别的问题上施加了狄利克雷边界条件。在长度为 $\\delta$ 的区间上，具有狄利克雷边界条件的拉普拉斯算子 $\\partial_{xx}$ 的特征函数是 $\\phi_n(x) = \\sin(n\\pi x/\\delta)$，而 $-\\partial_{xx}$ 相应的特征值是 $(n\\pi/\\delta)^2$，其中 $n=1, 2, 3, \\ldots$。片区内微观扩散方程 $\\partial_t u = D \\partial_{xx} u$ 的衰减率是 $\\mu_n = D(n\\pi/\\delta)^2$。这些微观衰减率中最慢的一个（基模，$n=1$）是 $\\mu_1 = D(\\pi/\\delta)^2$。缺齿格式的构造使得粗粒化变量的演化由片区内部与粗粒化数据一致的最慢弛豫过程所控制。最快的粗粒化模式 ($k_{\\max} = \\pi/\\delta$) 激发的微观场分布与片区的基模 ($n=1$) 非常相似，这证实了粗粒化求解器所看到的衰减率 $\\lambda_{\\max}$ 确实是 $\\mu_1 = D(\\pi/\\delta)^2$。\n\n因此，最大允许宏观时间步为：\n$$ \\Delta t_{\\max} = \\frac{2\\delta^2}{D\\pi^2} $$\n该表达式的单位是 $[\\text{长度}]^2 / ([\\text{长度}]^2 / [\\text{时间}]) = [\\text{时间}]$，这与问题要求以秒为单位作答是一致的，前提是假设 $D$ 和 $\\delta$ 使用国际单位制基本单位。",
            "answer": "$$\\boxed{\\frac{2\\delta^{2}}{D\\pi^{2}}}$$"
        },
        {
            "introduction": "与“约束”算子相对应，“提升”（Lifting）算子负责根据宏观状态来初始化微观模拟。本练习将从分析推导转向编程实践，聚焦于提升步骤中一个常见的问题：未解析的微观结构所带有的随机相位会引入系统性误差。您将通过编程实现一个模型问题，量化这种由相位失配导致的误差，并验证通过对多个随机相位的模拟结果进行平均，可以有效地消除这种误差 ()。",
            "id": "3819135",
            "problem": "考虑一个标量场 $u(x,t)$ 的一维扩散，该过程由守恒定律和 Fick 扩散定律决定。守恒定律为 $\\partial_t u = -\\partial_x J$，Fick 定律将扩散通量 $J$ 指定为 $J(x,t) = -a(x)\\,\\partial_x u(x,t)$，其中 $a(x)$ 是扩散系数。在“缺齿”格式 (gap-tooth scheme) 中，一个以 $x_c$ 为中心、宽度为 $h$ 的宏观有限体积单元（“齿”）通过其边界通量的估计值来封闭。在提升 (lifting) 过程中，我们在“齿”内部构建一个微观场 $u(x,0)$，它与粗粒化值 $U_c$ 和宏观斜率 $S$ 一致，同时嵌入了未解析的微观结构。假设扩散系数在空间上均匀且恒定，为 $a(x) = 1$，并且“齿”内部提升后的微观初始条件为\n$$\nu(x,0) = U_c + S\\,(x-x_c) + b\\,\\cos\\!\\big(k\\,(x-x_c) + \\phi\\big),\n$$\n其中 $b$ 是未解析微观波动的振幅，$k = \\tfrac{2\\pi}{\\lambda}$ 是与微观波长 $\\lambda$ 相关的波数，$\\phi$ 是微观相位。“齿”平均值 $U_c$ 的瞬时时间导数的粗粒化有限体积估计值是通过“齿”宽度 $h$ 上的边界通量不平衡来计算的，公式如下\n$$\n\\left.\\frac{dU_c}{dt}\\right|_{t=0} \\approx -\\frac{J(x_c + h/2,0) - J(x_c - h/2,0)}{h}.\n$$\n当 $b=0$ 时，对于纯线性粗粒化场，此有限体积导数为零，但当提升后的场包含具有任意相位 $\\phi$ 的微观振荡时，该导数通常不为零。对相位进行平均有望减少由相位不匹配引入的系统性偏差。\n\n您的任务是实现一个程序，从守恒定律和 Fick 定律出发，使用提升后的场构建“齿”边界处的通量，并计算在 $t=0$ 时刻引起的粗粒化时间导数的量级。具体而言：\n- 将 $a(x)$ 视为 $1$（无量纲）。\n- 使用上述提升后的场 $u(x,0)$。\n- 使用 Fick 定律和 $u(x,0)$ 的空间导数计算 $J(x_c \\pm h/2,0)$。\n- 通过上述有限体积公式计算引起的粗粒化导数 $\\left.\\tfrac{dU_c}{dt}\\right|_{t=0}$。\n- 报告该引起的粗粒化导数的量级（绝对值），作为给定参数集下由相位不匹配引起的误差。\n- 对于相位平均，使用从 $[0,2\\pi]$ 均匀抽取的 $M$ 个独立相位样本，并计算在这些相位上引起的粗粒化导数的样本均值的绝对值。为增强平均的数值稳健性，您可以采用对偶配对 (antithetic pairing) 的方法，即对于每个采样的 $\\phi$，同时包含 $\\phi$ 和 $\\phi+\\pi$，前提是 $M$ 为偶数。\n\n所有量均为无量纲。每个测试用例的输出必须是浮点数。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4]$）。\n\n使用以下参数值测试套件：\n- 测试 1：$\\lambda = 0.1$, $b = 0.05$, $h = 0.07$, $S = 0.1$，单一相位 $\\phi = 0$。输出 $\\left.\\tfrac{dU_c}{dt}\\right|_{t=0}$ 的绝对值。\n- 测试 2：$\\lambda = 0.1$, $b = 0.05$, $h = 0.07$, $S = 0.1$，使用 $M = 16$ 个在 $[0,2\\pi]$ 上均匀采样的相位进行相位平均。使用相位 $\\phi$ 和 $\\phi+\\pi$ 的对偶配对来改善抵消效果。输出 $\\left.\\tfrac{dU_c}{dt}\\right|_{t=0}$ 的样本均值的绝对值。\n- 测试 3：$\\lambda = 0.1$, $b = 0.05$, $h = \\lambda$, $S = 0.1$，单一相位 $\\phi = \\pi/7$。输出 $\\left.\\tfrac{dU_c}{dt}\\right|_{t=0}$ 的绝对值。此案例探测“齿”宽度等于一个微观波长的边界条件。\n- 测试 4：$\\lambda = 0.1$, $b = 0.2$, $h = 0.07$, $S = 0.1$，单一相位 $\\phi = 0$。输出 $\\left.\\tfrac{dU_c}{dt}\\right|_{t=0}$ 的绝对值以测试振幅缩放。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[T_1,T_2,T_3,T_4]$，分别对应上述测试。",
            "solution": "问题是有效的。它在科学上基于扩散原理和多尺度系统的数值分析，特别是“缺齿”格式。问题陈述清晰，提供了所有必要的定义、方程和参数，以便为每个测试用例找到一个唯一的、可验证的解。语言客观且无歧义。\n\n任务是计算由提升后的微观场在初始时刻 $t=0$ 引起的粗粒化时间导数的量级，即 $\\left|\\left.\\frac{dU_c}{dt}\\right|_{t=0}\\right|$。推导过程如下。\n\n控制方程是守恒定律 $\\partial_t u = -\\partial_x J$ 和 Fick 通量定律 $J(x,t) = -a(x)\\,\\partial_x u(x,t)$。扩散系数为常数 $a(x) = 1$。\n\n在以 $x_c$ 为中心、宽度为 $h$ 的“齿”内，提升后的微观初始条件由下式给出：\n$$u(x,0) = U_c + S\\,(x-x_c) + b\\,\\cos\\!\\big(k\\,(x-x_c) + \\phi\\big)$$\n其中 $U_c$ 是粗粒化值，$S$ 是宏观斜率，$b$ 是微观波动的振幅，$k = \\frac{2\\pi}{\\lambda}$ 是波数，$\\phi$ 是相位。\n\n首先，我们计算 $u(x,0)$ 的空间导数以求得通量。对 $x$ 求导：\n$$\\partial_x u(x,0) = \\frac{\\partial}{\\partial x} \\left[ U_c + S\\,(x-x_c) + b\\,\\cos\\!\\big(k\\,(x-x_c) + \\phi\\big) \\right]$$\n$$= 0 + S - b\\,k\\,\\sin\\!\\big(k\\,(x-x_c) + \\phi\\big)$$\n$$\\partial_x u(x,0) = S - b\\,k\\,\\sin\\!\\big(k\\,(x-x_c) + \\phi\\big)$$\n\n接下来，我们应用 $a(x)=1$ 的 Fick 定律来求得通量 $J(x,0)$：\n$$J(x,0) = -a(x)\\,\\partial_x u(x,0) = -1 \\cdot \\left[ S - b\\,k\\,\\sin\\!\\big(k\\,(x-x_c) + \\phi\\big) \\right]$$\n$$J(x,0) = -S + b\\,k\\,\\sin\\!\\big(k\\,(x-x_c) + \\phi\\big)$$\n注意，宏观斜率 $S$ 对通量贡献了一个常数项，这对于具有恒定扩散系数的线性场是符合预期的。\n\n粗粒化时间导数使用有限体积公式进行估计，这需要“齿”边界 $x = x_c \\pm h/2$ 处的通量值：\n$$\\left.\\frac{dU_c}{dt}\\right|_{t=0} \\approx -\\frac{J(x_c + h/2, 0) - J(x_c - h/2, 0)}{h}$$\n\n我们计算右边界 $x = x_c + h/2$ 处的通量：\n$$x - x_c = (x_c + h/2) - x_c = h/2$$\n$$J(x_c + h/2, 0) = -S + b\\,k\\,\\sin\\!\\big(k(h/2) + \\phi\\big)$$\n\n以及左边界 $x = x_c - h/2$ 处的通量：\n$$x - x_c = (x_c - h/2) - x_c = -h/2$$\n$$J(x_c - h/2, 0) = -S + b\\,k\\,\\sin\\!\\big(k(-h/2) + \\phi\\big) = -S + b\\,k\\,\\sin\\!\\big(\\phi - kh/2\\big)$$\n\n现在我们计算“齿”两侧的通量不平衡：\n$$J(x_c + h/2, 0) - J(x_c - h/2, 0) = \\left[-S + b\\,k\\,\\sin\\!\\big(kh/2 + \\phi\\big)\\right] - \\left[-S + b\\,k\\,\\sin\\!\\big(\\phi - kh/2\\big)\\right]$$\n$$= b\\,k \\left[ \\sin\\!\\big(kh/2 + \\phi\\big) - \\sin\\!\\big(\\phi - kh/2\\big) \\right]$$\n使用三角恒等式 $\\sin(A) - \\sin(B) = 2 \\cos(\\frac{A+B}{2}) \\sin(\\frac{A-B}{2})$，其中 $A = \\phi + kh/2$ 且 $B = \\phi - kh/2$：\n$$\\frac{A+B}{2} = \\phi$$\n$$\\frac{A-B}{2} = kh/2$$\n通量不平衡简化为：\n$$J(x_c + h/2, 0) - J(x_c - h/2, 0) = b\\,k \\left[ 2 \\cos(\\phi) \\sin(kh/2) \\right] = 2\\,b\\,k\\,\\sin(kh/2)\\,\\cos(\\phi)$$\n\n最后，我们将其代回粗粒化时间导数的公式中：\n$$\\left.\\frac{dU_c}{dt}\\right|_{t=0} = -\\frac{2\\,b\\,k\\,\\sin(kh/2)\\,\\cos(\\phi)}{h}$$\n代入 $k = \\frac{2\\pi}{\\lambda}$：\n$$\\left.\\frac{dU_c}{dt}\\right|_{t=0} = -\\frac{2\\, b}{h} \\left(\\frac{2\\pi}{\\lambda}\\right) \\sin\\left(\\frac{2\\pi}{\\lambda}\\frac{h}{2}\\right) \\cos(\\phi) = -\\frac{4\\pi\\,b}{h\\lambda} \\sin\\left(\\frac{\\pi h}{\\lambda}\\right)\\cos(\\phi)$$\n\n问题要求的是这个量的量级：\n$$\\left|\\left.\\frac{dU_c}{dt}\\right|_{t=0}\\right| = \\left| -\\frac{4\\pi\\,b}{h\\lambda} \\sin\\left(\\frac{\\pi h}{\\lambda}\\right)\\cos(\\phi) \\right| = \\frac{4\\pi\\,b}{h\\lambda} \\left| \\sin\\left(\\frac{\\pi h}{\\lambda}\\right)\\cos(\\phi) \\right|$$\n这是用于单相位测试用例的通用公式。\n\n对于测试2，需要使用对偶配对进行相位平均。单个相位 $\\phi_i$ 引起的导数为 $D(\\phi_i) = C \\cos(\\phi_i)$，其中常数 $C = -\\frac{4\\pi\\,b}{h\\lambda} \\sin\\left(\\frac{\\pi h}{\\lambda}\\right)$。对偶配对意味着对于每个采样的相位 $\\phi_j$，其配对相位 $\\phi_j + \\pi$ 也被包括在内。一对相位的和是 $D(\\phi_j) + D(\\phi_j+\\pi) = C\\cos(\\phi_j) + C\\cos(\\phi_j+\\pi)$。由于 $\\cos(\\phi+\\pi) = -\\cos(\\phi)$，这个和是 $C\\cos(\\phi_j) - C\\cos(\\phi_j) = 0$。因此，所有 $M$ 对的和恰好为零，样本均值为零，其绝对值也为 $0$。\n\n对于测试3，“齿”的宽度等于微观波长，即 $h=\\lambda$。在这种特殊情况下，我们公式中正弦函数的参数变为 $\\frac{\\pi h}{\\lambda} = \\pi$。由于 $\\sin(\\pi) = 0$，引起的导数恰好为 $0$。这是因为通量的振荡部分在“齿”的两端具有相同的值，导致微观振荡对通量不平衡没有净贡献。\n\n基于此分析，我们可以计算每个测试用例的结果。\n测试 1：使用推导出的量级公式，参数为 $\\lambda = 0.1$, $b = 0.05$, $h = 0.07$, $\\phi = 0$。\n测试 2：由于对偶配对，解析结果为 $0.0$。\n测试 3：由于 $h=\\lambda$，解析结果为 $0.0$。\n测试 4：使用推导出的量级公式，参数为 $\\lambda = 0.1$, $b = 0.2$, $h = 0.07$, $\\phi = 0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the gap-tooth scheme problem for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Test 1: lambda = 0.1, b = 0.05, h = 0.07, S = 0.1, single phase phi = 0.\n        {'lambda_val': 0.1, 'b': 0.05, 'h': 0.07, 'phi': 0.0},\n        # Test 2: lambda = 0.1, b = 0.05, h = 0.07, S = 0.1, phase averaging with M=16, antithetic pairing.\n        {'averaging': 'antithetic'},\n        # Test 3: lambda = 0.1, b = 0.05, h = lambda, S = 0.1, single phase phi = pi/7.\n        {'lambda_val': 0.1, 'b': 0.05, 'h': 0.1, 'phi': np.pi / 7},\n        # Test 4: lambda = 0.1, b = 0.2, h = 0.07, S = 0.1, single phase phi = 0.\n        {'lambda_val': 0.1, 'b': 0.2, 'h': 0.07, 'phi': 0.0},\n    ]\n\n    def compute_induced_derivative(lambda_val, b, h, phi):\n        \"\"\"\n        Computes the magnitude of the induced coarse derivative for a single phase.\n\n        The formula derived is:\n        |dUc/dt| = |-(4*pi*b/(h*lambda)) * sin(pi*h/lambda) * cos(phi)|\n        \"\"\"\n        # Handle the special case where h is an integer multiple of lambda, making sin(pi*h/lambda)=0\n        # which results in a zero derivative.\n        if np.isclose(h / lambda_val, np.round(h / lambda_val)):\n            arg_sin = np.pi * h / lambda_val\n            if np.isclose(np.sin(arg_sin), 0.0):\n                return 0.0\n        \n        # Original derived formula:\n        # dU_c/dt = -(4*pi*b/(h*lambda)) * sin(pi*h/lambda) * cos(phi)\n        \n        term = - (4 * np.pi * b) / (h * lambda_val)\n        term *= np.sin(np.pi * h / lambda_val)\n        term *= np.cos(phi)\n        \n        derivative = term\n        \n        return np.abs(derivative)\n\n    results = []\n    \n    # Test 1\n    params1 = test_cases[0]\n    result1 = compute_induced_derivative(params1['lambda_val'], params1['b'], params1['h'], params1['phi'])\n    results.append(result1)\n    \n    # Test 2\n    # The coarse derivative has a cos(phi) dependence.\n    # Averaging with antithetic pairs (phi, phi+pi) results in a sum of\n    # cos(phi) + cos(phi+pi) = cos(phi) - cos(phi) = 0 for each pair.\n    # Thus, the sample mean is exactly 0.\n    result2 = 0.0\n    results.append(result2)\n\n    # Test 3\n    params3 = test_cases[2]\n    result3 = compute_induced_derivative(params3['lambda_val'], params3['b'], params3['h'], params3['phi'])\n    results.append(result3)\n\n    # Test 4\n    params4 = test_cases[3]\n    result4 = compute_induced_derivative(params4['lambda_val'], params4['b'], params4['h'], params4['phi'])\n    results.append(result4)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}