{
    "hands_on_practices": [
        {
            "introduction": "为了理解“鬼力（ghost forces）”的根本来源，我们从一个最简单的一维原子链模型入手。本练习将分析一个包含单个键缺陷的原子链，在均匀应变下的受力情况。通过将精确的原子受力与基于局部柯西-玻恩（Cauchy-Born）法则的准连续介质（QC）方法预测的力进行比较，你将亲手揭示局部近似的一个基本缺陷：它无法“看见”小于其网格尺度的局部非均匀性，从而导致错误的力学预测。",
            "id": "3775793",
            "problem": "考虑一个由 $N+1$ 个原子组成的一维链，其参考位置为 $X_i = i a$，$i = 0, 1, \\dots, N$，其中 $a$ 是参考晶格间距。变形后的位置由 $y_i = (1+E) X_i$ 给出，其中 $E$ 是一个给定的宏观应变。原子之间通过最近邻谐波弹簧相互作用，其刚度为 $k$，静止长度为 $a$，但在连接原子 $m$ 和 $m+1$ 的键上存在一个局域缺陷，该处的静止长度为 $a + \\delta a$。假设 $1 \\le m \\le N-1$，以确保两个相邻的键都存在。该链不受外部体力作用。\n\n局域准连续 (Local Quasicontinuum, QC) 方法假设 Cauchy-Born 法则，从原子模型中推导出连续介质能量密度，并使用间距为 $h$ 的粗网格上的分段线性位移场来计算内部节点力。在这种局域近似中，第一 Piola 应力仅取决于局域变形梯度，而不取决于诸如小于网格尺寸的孤立缺陷等非局域离散特征。\n\n您的任务是通过比较以下两项来计算局域 QC 方法在缺陷原子 $m$ 处内力预测的误差：\n- 直接从包含缺陷键的变形构型中的成对弹簧力获得的原子 $m$ 上的精确原子净力，以及\n- 在相同的宏观变形和尺寸为 $h$ 的粗网格下，从与 Cauchy-Born 均匀化相关的连续介质应力获得的、位于原子 $m$ 位置处的局域 QC 预测的内部节点力。\n\n使用以下基本原理：\n- 对于静止长度为 $r_0$ 的谐波弹簧的胡克定律：沿键方向的力的大小与伸长量 $r - r_0$ 成正比，比例常数为 $k$，并沿键方向作用。在一维中，邻居 $i+1$ 对原子 $i$ 的力等于 $-k \\left( (y_{i+1} - y_i) - r_0 \\right)$，而邻居 $i-1$ 对原子 $i$ 的力等于 $+k \\left( (y_i - y_{i-1}) - r_0 \\right)$。\n- Cauchy-Born 法则，用于从具有均匀静止长度 $a$ 和刚度 $k$ 的最近邻谐波链中推导出一维连续介质能量密度，以及在均匀变形梯度下、间距为 $h$ 的分段线性有限元离散化中计算内部节点力。\n\n将误差大小定义为 $e = \\left| f_m^{\\mathrm{A}} - f_m^{\\mathrm{QC}} \\right|$，其中 $f_m^{\\mathrm{A}}$ 是作用在原子 $m$ 上的精确原子净力，$f_m^{\\mathrm{QC}}$ 是在相同宏观变形和网格尺寸 $h$ 下，对应于原子 $m$ 位置的局域 QC 预测的内部节点力。以牛顿为单位，将最终误差值表示为浮点小数。\n\n实现一个程序，为以下每个测试用例计算 $e$。每个测试用例由元组 $(N, a, k, E, m, \\delta a, h)$ 指定：\n- 测试用例 1：$(200, 2 \\times 10^{-10}, 30, 0.01, 100, 5 \\times 10^{-12}, 1 \\times 10^{-8})$。\n- 测试用例 2：$(50, 1 \\times 10^{-10}, 100, 0.0, 25, 0, 5 \\times 10^{-9})$。\n- 测试用例 3：$(100, 1.5 \\times 10^{-10}, 5, -0.02, 60, -1 \\times 10^{-12}, 1 \\times 10^{-9})$。\n- 测试用例 4：$(1000, 1 \\times 10^{-10}, 1000, 0.005, 500, 2 \\times 10^{-12}, 5 \\times 10^{-8})$。\n\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表的结果（例如，$[r_1,r_2,r_3,r_4]$），其中每个 $r_i$ 是对应于第 $i$ 个测试用例的误差大小 $e$（单位：牛顿）。不应打印任何其他文本。",
            "solution": "该问题陈述已经过验证，被确定为具有科学依据、适定且自洽的。所提供的数据和条件足以且一致地推导出唯一且有意义的解。\n\n目标是计算精确原子力 $f_m^{\\mathrm{A}}$ 与局域准连续 (QC) 方法在同一位置预测的力 $f_m^{\\mathrm{QC}}$ 之间的误差大小 $e = |f_m^{\\mathrm{A}} - f_m^{\\mathrm{QC}}|$。该系统是一个具有单个键缺陷的一维原子链，受到均匀的宏观应变。\n\n我们将分别计算 $f_m^{\\mathrm{A}}$ 和 $f_m^{\\mathrm{QC}}$ 这两个力，然后求它们差值的绝对值。\n\n**1. 精确原子力的计算 ($f_m^{\\mathrm{A}}$)**\n\n原子上的净力是其最近邻原子对其施加的力的总和。对于位于位置 $y_m$ 的原子 $m$，其净力 $f_m^{\\mathrm{A}}$ 是来自原子 $m-1$ 的力和来自原子 $m+1$ 的力的和。\n\n在谐波弹簧模型中，原子 $j$ 对原子 $i$ 施加的力由 $F_{i \\leftarrow j} = -\\nabla_{y_i} U_{ij}$ 给出，其中 $U_{ij} = \\frac{1}{2} k \\left( (y_j - y_i) - r_0 \\right)^2$ 是它们之间键的势能。这产生一个沿键方向的力。我们可以将原子 $m$ 上的净力表示为：\n$$\nf_m^{\\mathrm{A}} = F_{m \\leftarrow m+1} + F_{m \\leftarrow m-1}\n$$\n来自邻居 $m+1$ 的力是 $F_{m \\leftarrow m+1} = -\\frac{\\partial}{\\partial y_m} \\left( \\frac{1}{2} k \\left( (y_{m+1} - y_m) - r_{m,m+1} \\right)^2 \\right) = k \\left( (y_{m+1} - y_m) - r_{m,m+1} \\right)$。\n来自邻居 $m-1$ 的力是 $F_{m \\leftarrow m-1} = -\\frac{\\partial}{\\partial y_m} \\left( \\frac{1}{2} k \\left( (y_m - y_{m-1}) - r_{m-1,m} \\right)^2 \\right) = -k \\left( (y_m - y_{m-1}) - r_{m-1,m} \\right)$。\n\n将这些力相加，得到原子 $m$ 上的总力：\n$$\nf_m^{\\mathrm{A}} = k \\left( (y_{m+1} - y_m) - r_{m,m+1} \\right) - k \\left( (y_m - y_{m-1}) - r_{m-1,m} \\right)\n$$\n\n问题陈述指出，变形后的位置被规定为 $y_i = (1+E) X_i = (1+E) i a$。因此，变形构型中任意两个相邻原子之间的距离是均匀的：\n$$\ny_{i+1} - y_i = (1+E)(i+1)a - (1+E)ia = (1+E)a\n$$\n这对 $(m-1, m)$ 和 $(m, m+1)$ 键都成立。\n\n原子 $m-1$ 和 $m$ 之间的键是常规键，因此其静止长度为 $r_{m-1,m} = a$。原子 $m$ 和 $m+1$ 之间的键是缺陷键，其静止长度为 $r_{m,m+1} = a + \\delta a$。\n\n将这些表达式代入力方程中：\n$$\nf_m^{\\mathrm{A}} = k \\left( (1+E)a - (a + \\delta a) \\right) - k \\left( (1+E)a - a \\right)\n$$\n化简括号内的项：\n$$\nf_m^{\\mathrm{A}} = k \\left( a + Ea - a - \\delta a \\right) - k \\left( a + Ea - a \\right)\n$$\n$$\nf_m^{\\mathrm{A}} = k \\left( Ea - \\delta a \\right) - k \\left( Ea \\right)\n$$\n$$\nf_m^{\\mathrm{A}} = kEa - k\\delta a - kEa\n$$\n这简化为缺陷位置处精确原子力的一个非常简洁的结果：\n$$\nf_m^{\\mathrm{A}} = -k \\delta a\n$$\n这个非零力，在 QC 文献中通常被称为“鬼力”(ghost force)，其产生的原因是所规定的均匀变形对于有缺陷的原子链而言并非平衡态。\n\n**2. 局域准连续力的计算 ($f_m^{\\mathrm{QC}}$)**\n\n局域 QC 方法建立在 Cauchy-Born 法则之上，该法则假定连续介质中某一点的宏观变形梯度局域地适用于底层的原子晶格。该法则用于从原子势能推导出连续介质应变能密度函数 $\\phi(F)$，其中 $F$ 是变形梯度。关键在于，在其局域表述中，QC 方法基于一个*完美的、无缺陷的*参考晶格来构建这个连续介质模型。它天生无法看到比粗粒化长度尺度 $h$ 更小的局域缺陷，例如单个被修改的键。\n\n对于具有均匀键刚度 $k$ 和静止长度 $a$ 的一维链，一个被梯度 $F$ 变形的单键的应变能为 $U_{\\text{bond}} = \\frac{1}{2} k (Fa - a)^2$。因此，应变能密度（单位参考长度的能量）为：\n$$\n\\phi(F) = \\frac{U_{\\text{bond}}}{a} = \\frac{k}{2a} (Fa - a)^2 = \\frac{ka}{2} (F-1)^2\n$$\n第一 Piola-Kirchhoff 应力 $P$ 是能量密度对变形梯度的导数：\n$$\nP(F) = \\frac{d\\phi}{dF} = ka(F-1)\n$$\n问题指定了一个均匀的宏观变形 $y(X) = (1+E)X$。这对应于在连续介质中各处都为常数的变形梯度 $F = \\frac{dy}{dX} = 1+E$。因此，QC 模型中产生的应力也是均匀的：\n$$\nP = ka((1+E) - 1) = kaE\n$$\n在分段线性有限元离散化中，内部节点力由应力的散度计算得出。对于一维网格中处于恒定应力场 $P$ 下且无体力的任何内部节点，净内力为零。这是因为来自左侧单元的力贡献 ($+P$) 被来自右侧单元的力贡献 ($-P$) 完全抵消。由于原子 $m$ 位于链的内部 ($1 \\le m \\le N-1$)，连续介质模型中的对应点是一个内部点。因此，预测的 QC 力为零：\n$$\nf_m^{\\mathrm{QC}} = 0\n$$\n\n**3. 误差计算**\n\n误差大小 $e$ 是原子力和 QC 力之间的绝对差值：\n$$\ne = \\left| f_m^{\\mathrm{A}} - f_m^{\\mathrm{QC}} \\right|\n$$\n代入推导出的力表达式：\n$$\ne = \\left| -k \\delta a - 0 \\right| = \\left| -k \\delta a \\right|\n$$\n因此，误差大小的最终表达式为：\n$$\ne = |k \\delta a|\n$$\n这个结果表明，局域 QC 方法在键缺陷位置的误差与键刚度 $k$ 和静止长度缺陷大小 $\\delta a$ 的乘积成正比。值得注意的是，该误差与链长 $N$、晶格间距 $a$、施加的应变 $E$、缺陷位置 $m$ 以及 QC 网格尺寸 $h$ 无关。我们现在将此公式应用于给定的测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the error in the local QC prediction of the internal force at a defect atom.\n    The error is defined as e = |f_m^A - f_m^QC|, where f_m^A is the exact atomistic force\n    and f_m^QC is the local QC predicted force.\n\n    The derivation shows:\n    1. The exact atomistic force at the defect atom m is f_m^A = -k * delta_a.\n    2. The local QC force f_m^QC is 0 because it assumes a perfect lattice and sees a uniform\n       deformation gradient, resulting in zero net force at any internal node.\n    3. The error magnitude is e = |-k * delta_a - 0| = |k * delta_a|.\n\n    This error depends only on the spring stiffness k and the defect size delta_a, and is\n    independent of N, a, E, m, and h.\n    \"\"\"\n    \n    # Each test case is a tuple: (N, a, k, E, m, delta_a, h)\n    # N: total number of atoms is N+1\n    # a: reference lattice spacing (m)\n    # k: spring stiffness (N/m)\n    # E: macroscopic strain (dimensionless)\n    # m: index of the first atom in the defective bond (m, m+1)\n    # delta_a: change in rest length for the defective bond (m)\n    # h: coarse QC mesh spacing (m)\n    test_cases = [\n        (200, 2e-10, 30, 0.01, 100, 5e-12, 1e-8),\n        (50, 1e-10, 100, 0.0, 25, 0, 5e-9),\n        (100, 1.5e-10, 5, -0.02, 60, -1e-12, 1e-9),\n        (1000, 1e-10, 1000, 0.005, 500, 2e-12, 5e-8),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack the parameters for clarity, though only k and delta_a are needed.\n        _N, _a, k, _E, _m, delta_a, _h = case\n        \n        # Calculate the error magnitude based on the derived formula e = |k * delta_a|.\n        # The result is in Newtons.\n        error = abs(k * delta_a)\n        \n        results.append(error)\n\n    # Format the final output as a comma-separated list in brackets,\n    # ensuring floating-point representation.\n    formatted_results = [f\"{res:.1e}\" if res != 0 else \"0.0\" for res in results]\n    # The problem asks for floating-point decimals. Using a more general format.\n    final_output_list = []\n    for res in results:\n        # Use a representation that avoids scientific notation for small numbers if possible\n        # but defaults to it for very small/large.\n        if res == 0.0:\n            final_output_list.append(\"0.0\")\n        else:\n            # A simple `str(res)` is sufficient to meet the \"floating-point decimal\" requirement.\n            final_output_list.append(str(res))\n            \n    print(f\"[{','.join(final_output_list)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在理解了鬼力的基本概念后，我们将问题扩展到更实际的多尺度模型：原子/连续介质界面。本练习要求你为一个包含长程相互作用的一维晶体推导在原子/连续介质界面上的鬼力，并比较局部和非局部两种耦合方案。这个实践将使你能够量化鬼力的大小，并展示非局部QC方法如何通过在界面附近引入一个“过渡区”来显式处理跨界面的相互作用，从而系统性地减小乃至消除这种非物理的力。",
            "id": "3775817",
            "problem": "考虑一个一维晶体链，其晶格间距为 $a$，原子由整数 $i \\in \\mathbb{Z}$ 索引。参考位置为 $x_i = i a$，我们考虑一个均匀应变，其特征是位移场 $u_i = \\varepsilon x_i$，其中应变参数为 $\\varepsilon$（无量纲）。原子通过有限范围的谐波对势相互作用，作用范围可达 $m = 1, 2, \\dots, M$ 个近邻壳层。原子 $i$ 和 $i+m$ 之间键的伸长量为 $(x_{i+m} + u_{i+m}) - (x_i + u_i) - m a$，对势的贡献由刚度系数 $k_m > 0$ 决定，该系数可能依赖于 $m$。\n\n在均匀应变下，无限长链的全原子模型中，由于对称性，每个原子上的净内力为零。在准连续介质（QC）耦合中，我们将区域划分为原子区域和连续介质区域，界面位于一个代表性原子上（不失一般性地记为 $i=0$）。在局部QC耦合中，连续介质区域由 Cauchy-Born 应力 $\\sigma$ 表示，该应力作为界面上的面力传递，而不是通过显式的非定域键来表示。在非定域QC耦合中，我们在连续介质一侧的界面附近引入一个桥接宽度 $h$（一个物理长度，等于晶格间距的倍数）。作用范围小于或等于 $h$ 的跨界面键以原子方式保留，而范围更长的键则由连续介质面力取代。以物理单位表示的相互作用范围是 $R = M a$。\n\n仅使用以下基本依据：\n- 作用范围为 $m$ 的键的谐波对相互作用能：能量与键伸长量成二次关系，刚度为 $k_m$。\n- 均匀应变下一维链的 Cauchy-Born 法则：连续介质能量密度通过对单位长度上的原子键能求和得到，第一 Piola 应力 $\\sigma$ 是能量密度对应变的导数。\n\n将界面处的鬼力大小定义为，在使用相应的QC耦合时，界面原子在施加的均匀应变下所受净残余力的绝对值。该残余力的产生是因为连续介质面力通常不等于缺失的跨界面键力的离散和。\n\n您的任务：\n1. 对于局部QC耦合，推导并实现界面原子处鬼力大小的计算，使其作为 $a$、$\\varepsilon$ 和 $\\{k_m\\}_{m=1}^M$ 的函数。以无量纲单位报告鬼力。\n2. 对于具有桥接宽度 $h$ 的非定域QC耦合，推导并实现界面原子处鬼力大小的计算，使其作为 $a$、$\\varepsilon$、$\\{k_m\\}_{m=1}^M$ 和 $h$ 的函数。以无量纲单位报告鬼力。\n3. 展示鬼力大小如何随相互作用范围 $R$（通过 $M$ 体现）和单元尺寸（此处取为桥接宽度 $h$）而变化。\n\n测试套件和输出规范：\n- 使用以下测试用例，每个用例由 $(a, \\varepsilon, k\\_list, h)$ 指定，其中 $k\\_list$ 是列表 $\\{k_m\\}_{m=1}^M$：\n    1. $(a = 1.0, \\varepsilon = 0.01, k\\_list = [1.0, 0.5, 0.25, 0.125], h = 1.0)$ 表示在 $M=4$ 个近邻壳层上刚度衰减，桥接宽度等于一个晶格间距。\n    2. $(a = 1.0, \\varepsilon = 0.02, k\\_list = [2.0], h = 0.0)$ 表示最近邻相互作用（$M=1$）且无桥接（纯局部QC）。\n    3. $(a = 0.5, \\varepsilon = 0.01, k\\_list = [1.0, 1.0, 1.0, 1.0, 1.0], h = 0.0)$ 表示五个近邻壳层具有均匀刚度且无桥接。\n    4. $(a = 1.0, \\varepsilon = 0.03, k\\_list = [1.0, 1.0, 1.0], h = 3.0)$ 表示三个近邻壳层具有均匀刚度，桥接宽度等于三个晶格间距（完全覆盖了相互作用范围）。\n- 对于每个测试用例，计算两个量：局部QC鬼力大小和非定域QC鬼力大小。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目是对应测试用例的双元素列表 $[G\\_{\\mathrm{local}}, G\\_{\\mathrm{nonlocal}}]$（例如，$\\texttt{[[v11,v12],[v21,v22],...]}$）。\n\n所有报告的力都必须以无量纲单位给出。不涉及角度。可接受分数或小数；输出中任何地方都不要使用百分号。",
            "solution": "该问题是有效的。它在科学上基于多尺度建模的原理，特别是准连续介质（QC）方法。该问题是适定的，提供了推导唯一解所需的所有必要定义、常数和边界条件。其语言是客观的，要求可以形式化为一个可解的数学和计算问题。\n\n我们首先推导原子区域和连续介质区域之间界面上的鬼力表达式。系统是一个一维原子链，晶格间距为 $a$。原子通过谐波对势相互作用，作用范围可达 $M$ 个近邻壳层，第 $m$ 个近邻相互作用的刚度系数为 $k_m > 0$。施加均匀应变 $\\varepsilon$，对于位于参考位置 $x_i = i a$ 的原子，产生的位移场为 $u_i = \\varepsilon x_i = \\varepsilon i a$。\n\n原子 $i$ 的当前位置是 $y_i = x_i + u_i = i a (1+\\varepsilon)$。原子 $i$ 和原子 $i+m$ 之间键的长度变化（伸长量）为：\n$$ \\Delta L_m = y_{i+m} - y_i - m a = (i+m)a(1+\\varepsilon) - ia(1+\\varepsilon) - m a = m a \\varepsilon $$\n储存在此键中的势能由谐波势给出：\n$$ U_m = \\frac{1}{2} k_m (\\Delta L_m)^2 = \\frac{1}{2} k_m (m a \\varepsilon)^2 $$\n原子 $j = i+m$ 施加在原子 $i$ 上的力为 $f_{i \\leftarrow j} = -\\frac{\\partial U_m}{\\partial y_i}$。涉及 $y_i$ 的总势能为 $U_{total} = \\dots + \\frac{1}{2} k_m(y_{i+m} - y_i - ma)^2 + \\frac{1}{2} k_m(y_i - y_{i-m} - ma)^2 + \\dots$。\n原子 $i+m$ 对原子 $i$ 的力是 $f_{i \\leftarrow i+m} = k_m(y_{i+m} - y_i - ma) = k_m (ma\\varepsilon)$。这是一个指向正方向的力。\n原子 $i-m$ 对原子 $i$ 的力是 $f_{i \\leftarrow i-m} = -k_m(y_i - y_{i-m} - ma) = -k_m (ma\\varepsilon)$。这是一个指向负方向的力。\n在无限长的全原子链中，由于对称性，任何原子 $i$ 上的总力必须为零。我们对原子 $i=0$ 进行验证：\n$$ F_0^{\\text{full}} = \\sum_{m=1}^{M} (f_{0 \\leftarrow m} + f_{0 \\leftarrow -m}) = \\sum_{m=1}^{M} (k_m(ma\\varepsilon) - k_m(ma\\varepsilon)) = 0 $$\n这个平衡状态是我们的参考。当QC近似破坏了这种平衡时，就会产生鬼力。\n\n接下来，我们使用 Cauchy-Born 法则推导第一 Piola-Kirchhoff 应力 $\\sigma$。应变能密度 $W(\\varepsilon)$ 是单位参考长度的能量。在一维链中，这是每个原子的能量除以晶格间距 $a$。\n$$ W(\\varepsilon) = \\frac{1}{a} \\left( \\frac{1}{2} \\sum_{m=1}^{M} (\\text{Energy of bonds to the right}) + \\frac{1}{2} \\sum_{m=1}^{M} (\\text{Energy of bonds to the left}) \\right) $$\n由于对称性，这可以简化为：\n$$ W(\\varepsilon) = \\frac{1}{a} \\sum_{m=1}^{M} U_m = \\frac{1}{a} \\sum_{m=1}^{M} \\frac{1}{2} k_m (m a \\varepsilon)^2 = \\frac{a \\varepsilon^2}{2} \\sum_{m=1}^{M} m^2 k_m $$\n应力是能量密度对应变的导数：\n$$ \\sigma = \\frac{\\partial W}{\\partial \\varepsilon} = a \\varepsilon \\sum_{m=1}^{M} m^2 k_m $$\n该应力代表了由连续介质区域传递的力，该区域取代了部分原子链。\n\n对于局部QC耦合，区域在原子 $i=0$ 处划分。区域 $i \\le 0$ 是原子区域，而区域 $i > 0$ 被连续介质取代。界面原子 $i=0$ 上的力是其原子邻居（$i0$）的力和来自连续介质的面力之和。\n来自原子邻居（$i0$）的力是：\n$$ F_{\\text{left}} = \\sum_{m=1}^{M} f_{0 \\leftarrow -m} = \\sum_{m=1}^{M} -k_m(ma\\varepsilon) = -a \\varepsilon \\sum_{m=1}^{M} m k_m $$\n连续介质施加一个等于 Cauchy-Born 应力 $\\sigma$ 的面力：\n$$ F_{\\text{right}} = \\sigma = a \\varepsilon \\sum_{m=1}^{M} m^2 k_m $$\n原子0上的净残余力，即鬼力 $F_{\\text{ghost}}^{\\text{local}}$，是这些力的总和：\n$$ F_{\\text{ghost}}^{\\text{local}} = F_{\\text{left}} + F_{\\text{right}} = -a \\varepsilon \\sum_{m=1}^{M} m k_m + a \\varepsilon \\sum_{m=1}^{M} m^2 k_m = a \\varepsilon \\sum_{m=1}^{M} k_m (m^2 - m) $$\n因此，局部QC鬼力的大小为：\n$$ G_{\\text{local}} = |a \\varepsilon| \\sum_{m=1}^{M} k_m m(m-1) $$\n注意，对于最近邻相互作用（$m=1$），项 $m(m-1)$ 为零，导致鬼力为零。\n\n对于非定域QC耦合，引入了一个宽度为 $h$ 的桥接区域。相互作用范围 $ma \\le h$ 的跨界面键被显式保留。令 $m_{\\text{bridge}} = \\lfloor h/a \\rfloor$ 为其相互作用完全在桥接区域内的最大整数近邻壳层指数。\n现在，原子 $i=0$ 上的力由三部分组成：\n1.  来自 $i0$ 处原子邻居的力：$F_{\\text{left}} = -a \\varepsilon \\sum_{m=1}^{M} m k_m$。\n2.  来自 $i>0$ 处且满足 $ma \\le h$（即 $m \\le m_{\\text{bridge}}$）的邻居的显式建模力：$F_{\\text{right, explicit}} = a \\varepsilon \\sum_{m=1}^{m_{\\text{bridge}}} m k_m$。\n3.  一个连续介质面力，取代了满足 $ma > h$（即 $m > m_{\\text{bridge}}$）的长程键。该面力对应的应力 $\\sigma_{\\text{long}}$ 由一个只包含这些长程键的能量密度推导而来：\n    $$ W_{\\text{long}}(\\varepsilon) = \\frac{a \\varepsilon^2}{2} \\sum_{m=m_{\\text{bridge}}+1}^{M} m^2 k_m \\implies \\sigma_{\\text{long}} = a \\varepsilon \\sum_{m=m_{\\text{bridge}}+1}^{M} m^2 k_m $$\n非定域鬼力是这些贡献的总和：\n$$ F_{\\text{ghost}}^{\\text{nonlocal}} = F_{\\text{left}} + F_{\\text{right, explicit}} + \\sigma_{\\text{long}} $$\n$$ F_{\\text{ghost}}^{\\text{nonlocal}} = \\left(-a \\varepsilon \\sum_{m=1}^{M} m k_m\\right) + \\left(a \\varepsilon \\sum_{m=1}^{m_{\\text{bridge}}} m k_m\\right) + \\left(a \\varepsilon \\sum_{m=m_{\\text{bridge}}+1}^{M} m^2 k_m\\right) $$\n将第一个求和式在 $m_{\\text{bridge}}$ 处拆分：\n$$ F_{\\text{ghost}}^{\\text{nonlocal}} = a \\varepsilon \\left[ \\left(-\\sum_{m=1}^{m_{\\text{bridge}}} m k_m - \\sum_{m=m_{\\text{bridge}}+1}^{M} m k_m\\right) + \\sum_{m=1}^{m_{\\text{bridge}}} m k_m + \\sum_{m=m_{\\text{bridge}}+1}^{M} m^2 k_m \\right] $$\n$$ F_{\\text{ghost}}^{\\text{nonlocal}} = a \\varepsilon \\left[ -\\sum_{m=m_{\\text{bridge}}+1}^{M} m k_m + \\sum_{m=m_{\\text{bridge}}+1}^{M} m^2 k_m \\right] = a \\varepsilon \\sum_{m=m_{\\text{bridge}}+1}^{M} k_m (m^2 - m) $$\n非定域QC鬼力的大小为：\n$$ G_{\\text{nonlocal}} = |a \\varepsilon| \\sum_{m=m_{\\text{bridge}}+1}^{M} k_m m(m-1) \\quad \\text{其中} \\quad m_{\\text{bridge}} = \\lfloor h/a \\rfloor $$\n该公式正确地捕捉了鬼力随相互作用范围 $R=Ma$ 和桥接宽度 $h$ 变化的行为。局部鬼力 $G_{\\text{local}}$ 通常随 $M$ 的增加而增加，因为更多的长程键对力/应力不匹配有贡献。非定域鬼力 $G_{\\text{nonlocal}}$ 随桥接宽度 $h$ 的增加而减小，因为更多的键被显式处理，从而减小了求和范围。如果 $h \\ge Ma$，则 $m_{\\text{bridge}} \\ge M$，求和项变为空，且 $G_{\\text{nonlocal}} = 0$，这正确地反映了没有进行近似，并且恢复了原子力的平衡。通过设置 $h=0$ 可恢复到局部QC的情况，此时 $m_{\\text{bridge}}=0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for local and nonlocal QC ghost forces for a set of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (a, epsilon, k_list, h)\n    test_cases = [\n        (1.0, 0.01, [1.0, 0.5, 0.25, 0.125], 1.0),\n        (1.0, 0.02, [2.0], 0.0),\n        (0.5, 0.01, [1.0, 1.0, 1.0, 1.0, 1.0], 0.0),\n        (1.0, 0.03, [1.0, 1.0, 1.0], 3.0),\n    ]\n\n    results = []\n    for a, eps, k_list, h in test_cases:\n        # Maximum neighbor shell index M\n        M = len(k_list)\n        \n        # Pre-calculate the common factor |a * epsilon|\n        abs_a_eps = abs(a * eps)\n\n        # --- Local QC Ghost Force Calculation ---\n        # G_local = |a*eps| * sum_{m=1 to M} [k_m * m * (m-1)]\n        local_sum = 0.0\n        for m_idx, k_m in enumerate(k_list):\n            m = m_idx + 1  # m is 1-based index for neighbor shell\n            local_sum += k_m * m * (m - 1)\n        G_local = abs_a_eps * local_sum\n\n        # --- Nonlocal QC Ghost Force Calculation ---\n        # m_bridge is the largest integer m such that m*a = h\n        # This is equivalent to m = h/a, so m_bridge = floor(h/a)\n        if a == 0:\n            m_bridge = float('inf') if h = 0 else 0\n        else:\n            m_bridge = int(np.floor(h / a))\n        \n        # G_nonlocal = |a*eps| * sum_{m=m_bridge+1 to M} [k_m * m * (m-1)]\n        nonlocal_sum = 0.0\n        # The sum starts from the first neighbor shell NOT covered by the bridging region.\n        # The loop range for m_idx (0-based) must correspond to m (1-based) from m_bridge + 1 to M.\n        # So, m_idx runs from m_bridge to M-1.\n        if m_bridge  M:\n            for m_idx in range(m_bridge, M):\n                 m = m_idx + 1\n                 k_m = k_list[m_idx]\n                 nonlocal_sum += k_m * m * (m - 1)\n        \n        G_nonlocal = abs_a_eps * nonlocal_sum\n        \n        results.append([G_local, G_nonlocal])\n\n    # Final print statement in the exact required format.\n    # Example: [[v11,v12],[v21,v22],...]\n    print(f\"[{','.join([f'[{v1},{v2}]' for v1, v2 in results])}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "鬼力的产生不仅源于对物理相互作用的简化，也可能来自数值计算方案本身的不一致性。本练习将探讨一个更为微妙的鬼力来源。你将分析一个完美的周期性晶格，在均匀应变下，仅因为能量计算中采用了非均匀的团簇加权求和规则，就会产生非零的鬼力。这个推导揭示了一个深刻的道理：即使物理模型是完美的，不一致的数值近似方案也会破坏系统的力学平衡，这对于开发稳健的多尺度计算方法至关重要。",
            "id": "3775834",
            "problem": "考虑一个由 $N$ 个原子组成的一维周期性链，具有周期性边界条件，其中 $N$ 是一个偶数。设参考晶格间距为 $a_0  0$，在均匀形变梯度 $F  0$ 下的原子位置为 $y_i = F a_0 i$，适用于所有整数索引 $i$ 模 $N$。假设最近邻相互作用由刚度为 $k  0$ 的谐波对势 $\\phi(r) = \\tfrac{k}{2} (r - a_0)^2$ 控制。\n\n精确的原子总能量为 $E = \\sum_{i=0}^{N-1} \\phi(y_{i+1} - y_i)$，其中索引取模 $N$，原子 $i$ 上的精确力定义为 $f_i = -\\partial E / \\partial y_i$。\n\n现在考虑一个用于非局域准连续介质 (QC) 求和方案的近似团簇求和能量：\n$$\n\\widetilde{E} = \\sum_{i=0}^{N-1} w_i \\, \\phi(y_{i+1} - y_i),\n$$\n具有周期为 2 的非均匀采样权重 $w_i$，由 $w_{2m} = 2$ 和 $w_{2m+1} = 1$ 给出，适用于所有整数 $m$。将原子 $i$ 上对应的近似力定义为 $\\widetilde{f}_i = -\\partial \\widetilde{E} / \\partial y_i$。\n\n从能量的定义、力是能量的负梯度以及均匀形变 $y_i = F a_0 i$ 出发，推导仅由非均匀权重 $\\{w_i\\}$ 引起的在原子 $i=0$ 处的非零鬼力 $\\widetilde{f}_0$ 的解析表达式。将最终答案表示为关于 $k$、$a_0$ 和 $F$ 的闭式表达式。不包括单位。不需要数值取整。",
            "solution": "我们从基本定义开始：最近邻原子链的总能量是键能的总和，而原子 $i$ 上的力是总能量相对于 $y_i$ 的负导数。对于精确的原子能量\n$$\nE = \\sum_{i=0}^{N-1} \\phi\\bigl(y_{i+1} - y_i\\bigr),\n$$\n原子 $i$ 上的精确力为\n$$\nf_i = -\\frac{\\partial E}{\\partial y_i}.\n$$\n引入团簇求和近似\n$$\n\\widetilde{E} = \\sum_{i=0}^{N-1} w_i \\, \\phi\\bigl(y_{i+1} - y_i\\bigr),\n$$\n其权重为 $w_{2m} = 2$ 和 $w_{2m+1} = 1$，该权重模式在链上以周期 2 重复。对应的近似力为\n$$\n\\widetilde{f}_i = -\\frac{\\partial \\widetilde{E}}{\\partial y_i}.\n$$\n\n我们从第一性原理计算 $\\widetilde{f}_i$。只有与原子 $i$ 相邻的键依赖于 $y_i$，即原子 $i$ 和 $i+1$ 之间的键以及原子 $i-1$ 和 $i$ 之间的键。定义键长\n$$\n\\ell_j := y_{j+1} - y_j.\n$$\n那么\n$$\n\\widetilde{E} = \\sum_{j=0}^{N-1} w_j \\, \\phi(\\ell_j),\n$$\n并且\n$$\n\\frac{\\partial \\ell_i}{\\partial y_i} = -1, \\qquad \\frac{\\partial \\ell_{i-1}}{\\partial y_i} = 1.\n$$\n因此，\n$$\n\\widetilde{f}_i = -\\left[w_i \\, \\phi'(\\ell_i) \\cdot \\frac{\\partial \\ell_i}{\\partial y_i} + w_{i-1} \\, \\phi'(\\ell_{i-1}) \\cdot \\frac{\\partial \\ell_{i-1}}{\\partial y_i}\\right]\n= -\\left[w_i \\, \\phi'(\\ell_i) \\cdot (-1) + w_{i-1} \\, \\phi'(\\ell_{i-1}) \\cdot (1)\\right].\n$$\n这可以简化为\n$$\n\\widetilde{f}_i = w_i \\, \\phi'(\\ell_i) - w_{i-1} \\, \\phi'(\\ell_{i-1}).\n$$\n\n在均匀形变 $y_i = F a_0 i$ 下，每个键长都相同：\n$$\n\\ell_i = y_{i+1} - y_i = F a_0 \\quad \\text{for all } i.\n$$\n因此 $\\phi'(\\ell_i)$ 与 $i$ 无关，我们可以写成\n$$\n\\widetilde{f}_i = \\bigl(w_i - w_{i-1}\\bigr) \\, \\phi'(F a_0).\n$$\n对于谐波势 $\\phi(r) = \\tfrac{k}{2} (r - a_0)^2$，其导数为\n$$\n\\phi'(r) = k \\, (r - a_0).\n$$\n因此，\n$$\n\\phi'(F a_0) = k \\, (F a_0 - a_0) = k a_0 (F - 1).\n$$\n\n我们现在专门研究原子 $i=0$ 的情况。根据权重周期为 2 的周期性定义，我们有 $w_0 = 2$，而 $w_{-1}$ 等于 $w_{N-1}$，又因为 $N$ 是偶数且权重模式是 $2,1,2,1,\\dots$，所以 $w_{N-1}$ 等于 $w_1$。因此 $w_{-1} = 1$，并且\n$$\n\\widetilde{f}_0 = \\bigl(w_0 - w_{-1}\\bigr) \\, \\phi'(F a_0) = (2 - 1)\\, k a_0 (F - 1) = k a_0 (F - 1).\n$$\n尽管是均匀形变，但只要 $F \\ne 1$，这个力就非零，这表明存在由非均匀团簇求和权重引起的鬼力。",
            "answer": "$$\\boxed{k\\,a_{0}\\,(F-1)}$$"
        }
    ]
}