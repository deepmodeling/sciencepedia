{
    "hands_on_practices": [
        {
            "introduction": "要成功地将原子尺度模型与连续介质模型耦合，关键的第一步是构建一个平滑的过渡区域，即“握手”区域。这可以防止在模型交界处产生伪力（通常称为“鬼力”）。本练习将指导您构建一个$C^1$光滑的单位分解函数，这是许多高级耦合方案（如准连续介质方法）的基石。通过完成此练习，您将掌握确保多尺度模型之间平滑过渡所需的基本数学工具。",
            "id": "3819449",
            "problem": "在原子子模型和连续介质子模型的并发多尺度耦合中，相互作用通过一个有限的“握手”重叠区域进行混合，以避免伪界面效应。考虑一个一维杆，其空间坐标 $x$ 以米为单位，其中重叠（握手）区域为区间 $[0,L]$，$L>0$。构建一对权重函数 $w_{\\mathrm{A}}(x)$ 和 $w_{\\mathrm{C}}(x)$，它们定义了一个用于混合的 $C^1$ 单位分解，并满足以下要求：\n- $w_{\\mathrm{A}}(x)$ 和 $w_{\\mathrm{C}}(x)$ 是 $\\mathbb{R}$ 上的非负 $C^1$ 函数，且对于所有 $x\\in\\mathbb{R}$ 都有 $w_{\\mathrm{A}}(x)+w_{\\mathrm{C}}(x)=1$，\n- 当 $x\\leq 0$ 时，$w_{\\mathrm{A}}(x)=1$ 且 $w_{\\mathrm{C}}(x)=0$，\n- 当 $x\\geq L$ 时，$w_{\\mathrm{A}}(x)=0$ 且 $w_{\\mathrm{C}}(x)=1$，\n- 在 $x\\in(0,L)$ 区间上，$w_{\\mathrm{A}}(x)$ 从 $1$ 平滑地减小到 $0$，$w_{\\mathrm{C}}(x)$ 从 $0$ 平滑地增加到 $1$，并且在端点 $x=0$ 和 $x=L$ 处的一阶导数为零。\n\n仅使用微积分的基本定义和单位分解的定义，通过一个在 $[0,L]$ 上满足 $s(0)=0$、$s(L)=1$、$s'(0)=0$ 和 $s'(L)=0$ 的平滑“升余弦”斜坡函数 $s(x)$ 来定义 $w_{\\mathrm{A}}(x)$ 和 $w_{\\mathrm{C}}(x)$。证明所得的函数对在 $\\mathbb{R}$ 上是 $C^1$ 的，并且是一个有效的单位分解。然后，计算在 $x\\in\\mathbb{R}$ 上权重的空间梯度（在一维中即为导数）的最大幅值，并将其表示为 $L$ 的函数。\n\n你的最终答案必须是关于 $L$ 的单一闭式解析表达式。如果使用物理单位，则以反米（$\\mathrm{m}^{-1}$）为单位报告梯度幅值。最终方框内的答案不要包含单位。无需四舍五入。",
            "solution": "问题陈述是适定的，有科学依据，并为构建 $C^1$ 单位分解提供了一套完整且一致的要求。这是多尺度建模领域的一个标准问题。因此，该问题是有效的，我们着手进行求解。\n\n任务是为 $x \\in \\mathbb{R}$ 构建一对权重函数 $w_{\\mathrm{A}}(x)$ 和 $w_{\\mathrm{C}}(x)$，使其在握手区域 $[0, L]$ 上满足一组混合属性。这个构造将基于一个在 $[0, L]$ 上的平滑“升余弦”斜坡函数 $s(x)$。\n\n首先，我们在区间 $[0, L]$ 上构建斜坡函数 $s(x)$。问题要求 $s(x)$ 满足四个条件：$s(0)=0$，$s(L)=1$，$s'(0)=0$ 和 $s'(L)=0$。一个“升余弦”函数的形式为 $A \\cos(kx) + B$。为了满足边界条件，我们需要一个在该区间上平滑过渡的函数。一个合适的形式是 $s(x) = A\\left(1 - \\cos\\left(\\frac{\\pi x}{L}\\right)\\right)$。这个选择的动机是余弦函数的自变量 $\\frac{\\pi x}{L}$，它将区间 $[0, L]$ 映射到 $[0, \\pi]$，即余弦函数的半个周期。\n\n让我们用 $s(x)$ 的条件来检验这个形式：我们提出 $s(x) = \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{\\pi x}{L}\\right)\\right)$。\n1.  在 $x=0$ 处：$s(0) = \\frac{1}{2}\\left(1 - \\cos(0)\\right) = \\frac{1}{2}(1 - 1) = 0$。该条件得到满足。\n2.  在 $x=L$ 处：$s(L) = \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{\\pi L}{L}\\right)\\right) = \\frac{1}{2}(1 - \\cos(\\pi)) = \\frac{1}{2}(1 - (-1)) = 1$。该条件得到满足。\n\n现在，我们检查导数条件。$s(x)$ 对 $x$ 的一阶导数是：\n$$ s'(x) = \\frac{d}{dx} \\left[ \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{\\pi x}{L}\\right)\\right) \\right] = \\frac{1}{2} \\left( \\sin\\left(\\frac{\\pi x}{L}\\right) \\cdot \\frac{\\pi}{L} \\right) = \\frac{\\pi}{2L} \\sin\\left(\\frac{\\pi x}{L}\\right) $$\n3.  在 $x=0$ 处：$s'(0) = \\frac{\\pi}{2L} \\sin(0) = 0$。该条件得到满足。\n4.  在 $x=L$ 处：$s'(L) = \\frac{\\pi}{2L} \\sin(\\pi) = 0$。该条件得到满足。\n因此，函数 $s(x) = \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{\\pi x}{L}\\right)\\right)$ 是正确的“升余弦”斜坡函数。\n\n接下来，我们使用 $s(x)$ 为所有 $x \\in \\mathbb{R}$ 定义权重函数 $w_{\\mathrmA}}(x)$ 和 $w_{\\mathrmC}}(x)$。函数 $w_{\\mathrmC}}(x)$ 应从 $0$ 增加到 $1$，而 $w_{\\mathrmA}}(x)$ 应从 $1$ 减少到 $0$。我们可以直接将在握手区域内的 $w_{\\mathrmC}}(x)$ 等同于 $s(x)$。然后，根据单位分解的要求 $w_{\\mathrmA}}(x) + w_{\\mathrmC}}(x) = 1$，定义 $w_{\\mathrmA}}(x) = 1 - w_{\\mathrm{C}}(x)$。\n完整的分段定义如下：\n$$ w_{\\mathrm{C}}(x) = \\begin{cases} 0 & \\text{若 } x \\le 0 \\\\ \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{\\pi x}{L}\\right)\\right) & \\text{若 } 0  x  L \\\\ 1  \\text{若 } x \\ge L \\end{cases} $$\n$$ w_{\\mathrm{A}}(x) = 1 - w_{\\mathrm{C}}(x) = \\begin{cases} 1  \\text{若 } x \\le 0 \\\\ 1 - \\frac{1}{2}\\left(1 - \\cos\\left(\\frac{\\pi x}{L}\\right)\\right) = \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{\\pi x}{L}\\right)\\right)  \\text{若 } 0  x  L \\\\ 0  \\text{若 } x \\ge L \\end{cases} $$\n\n现在，我们必须证明这对函数是 $C^1$ 的，并且构成一个有效的单位分解。\n1.  **单位分解**：根据构造，对所有 $x \\in \\mathbb{R}$ 都有 $w_{\\mathrmA}}(x) + w_{\\mathrmC}}(x) = 1$。这对于 $x \\le 0$（$1+0=1$）、$x \\ge L$（$0+1=1$）以及 $0  x  L$（$(1-s(x)) + s(x) = 1$）都成立。\n2.  **非负性**：对于 $x \\in (0, L)$，余弦的自变量 $\\frac{\\pi x}{L}$ 位于 $(0, \\pi)$ 内。在此范围内，$-1 \\le \\cos(\\frac{\\pi x}{L}) \\le 1$。\n    -   $w_{\\mathrmC}}(x) = \\frac{1}{2}(1 - \\cos(\\frac{\\pi x}{L}))$。因为 $\\cos(\\cdot) \\le 1$，所以 $w_{\\mathrmC}}(x) \\ge 0$。\n    -   $w_{\\mathrmA}}(x) = \\frac{1}{2}(1 + \\cos(\\frac{\\pi x}{L}))$。因为 $\\cos(\\cdot) \\ge -1$，所以 $w_{\\mathrmA}}(x) \\ge 0$。\n    在区间 $(0, L)$ 之外，这些函数的值为 $0$ 或 $1$，均为非负。\n3.  **$C^1$ 连续性**：如果一个函数及其一阶导数都是连续的，则该函数是 $C^1$ 的。我们只需在分段定义的边界点 $x=0$ 和 $x=L$ 处检查连续性。我们分析 $w_{\\mathrmC}}(x)$；由于 $w_{\\mathrm{A}}(x) = 1 - w_{\\mathrmC}}(x)$ 且 $w'_{\\mathrmA}}(x) = -w'_{\\mathrmC}}(x)$，因此 $w_{\\mathrm{A}}(x)$ 的结果也随之成立。\n    -   在 $x=0$ 处的连续性：\n        -   $\\lim_{x \\to 0^-} w_{\\mathrm{C}}(x) = 0$。\n        -   $w_{\\mathrm{C}}(0^+) = \\lim_{x \\to 0^+} \\frac{1}{2}(1 - \\cos(\\frac{\\pi x}{L})) = \\frac{1}{2}(1-1) = 0$。\n        -   函数在 $x=0$ 处是连续的。\n    -   在 $x=L$ 处的连续性：\n        -   $w_{\\mathrm{C}}(L^-) = \\lim_{x \\to L^-} \\frac{1}{2}(1 - \\cos(\\frac{\\pi x}{L})) = \\frac{1}{2}(1 - \\cos(\\pi)) = \\frac{1}{2}(1 - (-1)) = 1$。\n        -   $\\lim_{x \\to L^+} w_{\\mathrm{C}}(x) = 1$。\n        -   函数在 $x=L$ 处是连续的。\n    -   导数在 $x \\in (0,L)$ 时为 $w'_{\\mathrmC}}(x) = \\frac{\\pi}{2L} \\sin(\\frac{\\pi x}{L})$，而在 $x \\notin [0,L]$ 时为 $w'_{\\mathrmC}}(x)=0$。\n    -   导数在 $x=0$ 处的连续性：\n        -   $\\lim_{x \\to 0^-} w'_{\\mathrm{C}}(x) = 0$。\n        -   $\\lim_{x \\to 0^+} w'_{\\mathrm{C}}(x) = \\lim_{x \\to 0^+} \\frac{\\pi}{2L} \\sin(\\frac{\\pi x}{L}) = \\frac{\\pi}{2L} \\sin(0) = 0$。\n        -   导数在 $x=0$ 处是连续的。\n    -   导数在 $x=L$ 处的连续性：\n        -   $\\lim_{x \\to L^-} w'_{\\mathrm{C}}(x) = \\lim_{x \\to L^-} \\frac{\\pi}{2L} \\sin(\\frac{\\pi x}{L}) = \\frac{\\pi}{2L} \\sin(\\pi) = 0$。\n        -   $\\lim_{x \\to L^+} w'_{\\mathrm{C}}(x) = 0$。\n        -   导数在 $x=L$ 处是连续的。\n    由于 $w_{\\mathrm{C}}(x)$ 和 $w'_{\\mathrm{C}}(x)$ 在 $\\mathbb{R}$ 上都是连续的，所以 $w_{\\mathrm{C}}(x)$ 是一个 $C^1$ 函数。$w_{\\mathrm{A}}(x)$ 也同样成立。所有条件都得到满足。\n\n最后，我们计算权重空间梯度的最大幅值。$w_{\\mathrm{A}}(x)$ 和 $w_{\\mathrm{C}}(x)$ 的梯度仅在区间 $(0, L)$ 内非零。\n$ w'_{\\mathrm{A}}(x) = -\\frac{\\pi}{2L}\\sin\\left(\\frac{\\pi x}{L}\\right) $\n$ w'_{\\mathrm{C}}(x) = \\frac{\\pi}{2L}\\sin\\left(\\frac{\\pi x}{L}\\right) $\n梯度的幅值是相同的：\n$$ |w'_{\\mathrm{A}}(x)| = |w'_{\\mathrm{C}}(x)| = \\left|\\frac{\\pi}{2L}\\sin\\left(\\frac{\\pi x}{L}\\right)\\right| $$\n对于 $x \\in (0, L)$，自变量 $\\frac{\\pi x}{L} \\in (0, \\pi)$，在此区间正弦函数是非负的。因此，我们可以去掉绝对值符号：\n$$ |w'_{\\mathrm{A}}(x)| = |w'_{\\mathrm{C}}(x)| = \\frac{\\pi}{2L}\\sin\\left(\\frac{\\pi x}{L}\\right) $$\n为了找到最大幅值，我们需要找到该表达式在 $x \\in (0, L)$ 上的最大值。常数因子是 $\\frac{\\pi}{2L}$。$\\sin(\\theta)$ 的最大值是 $1$，这在 $\\theta = \\frac{\\pi}{2}$ 时出现。\n将正弦函数的自变量设为 $\\frac{\\pi}{2}$：\n$$ \\frac{\\pi x}{L} = \\frac{\\pi}{2} \\implies x = \\frac{L}{2} $$\n这个 $x$ 的值在区间 $(0, L)$ 内。在这一点，梯度幅值达到其最大值：\n$$ \\max_{x \\in \\mathbb{R}} |w'_{\\mathrm{A}}(x)| = \\max_{x \\in \\mathbb{R}} |w'_{\\mathrm{C}}(x)| = \\frac{\\pi}{2L}\\sin\\left(\\frac{\\pi (L/2)}{L}\\right) = \\frac{\\pi}{2L}\\sin\\left(\\frac{\\pi}{2}\\right) = \\frac{\\pi}{2L} \\cdot 1 = \\frac{\\pi}{2L} $$\n权重的空间梯度的最大幅值，表示为 $L$ 的函数，是 $\\frac{\\pi}{2L}$。",
            "answer": "$$\\boxed{\\frac{\\pi}{2L}}$$"
        },
        {
            "introduction": "在了解了如何创建平滑的混合函数之后，我们必须认识到它们的局限性。本练习将向您展示，即使是平滑的混合方案，如果设计得过于简单，也可能违反像通量守恒这样的基本物理定律，从而导致所谓的“泄漏”。通过诊断这个问题并设计一个修正方案，您将更深刻地理解为何构建物理上自洽的耦合方案至关重要。",
            "id": "3819446",
            "problem": "在一个连续介质求解器和细观尺度求解器的一维并行耦合中，两个模型在一个由区间 $\\left[0,L\\right]$ 定义的握手区域上重叠。令 $u_{c}(x)$ 表示重叠区中的粗尺度（连续介质）场，$u_{f}(x)$ 表示细观尺度场。假设两者都是由重叠区外的稳态驱动引起的线性函数：\n- $u_{c}(x) = u_{0} + g_{c}\\,x$，\n- $u_{f}(x) = v_{0} + g_{f}\\,x$，\n其中 $u_{0}$、$v_{0}$、$g_{c}$ 和 $g_{f}$ 是常数。设本构律为 $J(x) = -k\\,\\frac{du}{dx}$，其中 $k0$ 为常数，代表质量通量或动量通量。在稳态下，精确守恒要求在握手区域内 $\\frac{dJ}{dx} = 0$。\n\n考虑握手区域中的朴素混合场，\n$$\nu_{b}(x) = w(x)\\,u_{f}(x) + \\left(1 - w(x)\\right)\\,u_{c}(x),\n$$\n其标准线性权重为 $w(x) = \\frac{x}{L}$。将跨握手区的泄漏定义为重叠区右端和左端之间通量的净不匹配，\n$$\n\\Lambda \\equiv J_{b}(L^{-}) - J_{b}(0^{+}),\n$$\n其中 $J_{b}(x) = -k\\,\\frac{du_{b}}{dx}(x)$ 是从朴素混合场获得的通量。\n\n仅从上述定义和稳态守恒律出发，首先计算泄漏 $\\Lambda$，用 $k$、$g_{c}$ 和 $g_{f}$ 表示。\n\n然后，设计一个支撑在 $\\left[0,L\\right]$ 上的标量修正核 $\\phi(x)$，使得修正场\n$$\n\\tilde{u}(x) = u_{b}(x) + \\phi(x)\n$$\n在握手区域内具有恒定通量，即对于所有 $x \\in (0,L)$，$\\frac{d}{dx}\\left(-k\\,\\frac{d\\tilde{u}}{dx}\\right) = 0$。施加端点约束 $\\phi(0) = 0$ 和 $\\phi(L) = 0$，以使修正不改变握手区边界处的混合值。\n\n对于给定的朴素线性权重 $w(x)=\\frac{x}{L}$，请为修正核 $\\phi(x)$ 提供一个单一的、闭合形式的解析表达式作为最终答案。不需要数值近似，最终表达式中不应包含单位。",
            "solution": "用户要求我解决一个多尺度模型握手区域中的问题。\n\n### 第1步：提取已知条件\n- **区域**：由区间 $\\left[0,L\\right]$ 定义的一维握手区域。\n- **粗尺度场**：$u_{c}(x) = u_{0} + g_{c}\\,x$。\n- **细观尺度场**：$u_{f}(x) = v_{0} + g_{f}\\,x$。\n- **常数**：$u_{0}$、$v_{0}$、$g_{c}$、$g_{f}$、$L$。\n- **本构律**：通量 $J(x) = -k\\,\\frac{du}{dx}$，其中 $k0$ 是常数。\n- **守恒律**：在稳态下，$\\frac{dJ}{dx} = 0$。\n- **混合场**：$u_{b}(x) = w(x)\\,u_{f}(x) + \\left(1 - w(x)\\right)\\,u_{c}(x)$。\n- **权重函数**：$w(x) = \\frac{x}{L}$。\n- **泄漏定义**：$\\Lambda \\equiv J_{b}(L^{-}) - J_{b}(0^{+})$，其中 $J_{b}(x) = -k\\,\\frac{du_{b}}{dx}(x)$。\n- **修正场**：$\\tilde{u}(x) = u_{b}(x) + \\phi(x)$。\n- **修正条件**：与 $\\tilde{u}(x)$ 相关的通量必须是恒定的，即对于 $x \\in (0,L)$，$\\frac{d}{dx}\\left(-k\\,\\frac{d\\tilde{u}}{dx}\\right) = 0$。\n- **修正约束**：$\\phi(0) = 0$ 且 $\\phi(L) = 0$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题在多尺度建模和数值分析这一成熟领域具有科学依据，专门解决了并行耦合方案中重叠区域的“伪力”或伪源问题。其表述基于连续介质力学的标准原理（守恒律、本构关系）。该问题是适定的，所有变量、函数和条件都得到了清晰、客观的定义。它在数学上是自洽的，不包含任何矛盾或歧义。语言精确且无偏见。没有违反科学原理之处，没有信息缺失，其结构可以导出一个唯一且有意义的解。该问题是应用数学中一个有效且可形式化的练习。\n\n### 第3步：结论与行动\n问题是**有效的**。我将继续进行求解。\n\n求解过程需要两部分：首先，计算泄漏 $\\Lambda$；其次，推导修正核 $\\phi(x)$。\n\n**第1部分：计算泄漏 $\\Lambda$**\n\n首先，我们将给定的 $u_{c}(x)$、$u_{f}(x)$ 和 $w(x)$ 的形式代入，以表示混合场 $u_{b}(x)$：\n$$\nu_{b}(x) = \\frac{x}{L} (v_{0} + g_{f}\\,x) + \\left(1 - \\frac{x}{L}\\right) (u_{0} + g_{c}\\,x)\n$$\n为了求得通量 $J_{b}(x)$，我们必须先计算导数 $\\frac{du_{b}}{dx}$。我们展开 $u_{b}(x)$ 的表达式：\n$$\nu_{b}(x) = \\frac{v_{0}x}{L} + \\frac{g_{f}x^2}{L} + u_{0} + g_{c}x - \\frac{u_{0}x}{L} - \\frac{g_{c}x^2}{L}\n$$\n按 $x$ 的幂次合并同类项：\n$$\nu_{b}(x) = u_{0} + \\left(\\frac{v_{0} - u_{0}}{L} + g_{c}\\right)x + \\left(\\frac{g_{f} - g_{c}}{L}\\right)x^2\n$$\n现在，我们对 $x$ 求导：\n$$\n\\frac{du_{b}}{dx} = \\left(\\frac{v_{0} - u_{0}}{L} + g_{c}\\right) + 2\\left(\\frac{g_{f} - g_{c}}{L}\\right)x\n$$\n通量 $J_{b}(x)$ 由 $J_{b}(x) = -k\\,\\frac{du_{b}}{dx}$ 给出：\n$$\nJ_{b}(x) = -k \\left[ \\left(\\frac{v_{0} - u_{0}}{L} + g_{c}\\right) + 2\\left(\\frac{g_{f} - g_{c}}{L}\\right)x \\right]\n$$\n泄漏 $\\Lambda$ 定义为 $J_{b}(L) - J_{b}(0)$。我们在端点 $x=0$ 和 $x=L$ 处计算 $J_{b}(x)$ 的值：\n在 $x=0$ 处：\n$$\nJ_{b}(0) = -k \\left( \\frac{v_{0} - u_{0}}{L} + g_{c} \\right)\n$$\n在 $x=L$ 处：\n$$\nJ_{b}(L) = -k \\left[ \\left(\\frac{v_{0} - u_{0}}{L} + g_{c}\\right) + 2\\left(\\frac{g_{f} - g_{c}}{L}\\right)L \\right] = -k \\left[ \\frac{v_{0} - u_{0}}{L} + g_{c} + 2(g_{f} - g_{c}) \\right]\n$$\n现在，我们计算差值 $\\Lambda = J_{b}(L) - J_{b}(0)$：\n$$\n\\Lambda = -k \\left[ \\frac{v_{0} - u_{0}}{L} + g_{c} + 2(g_{f} - g_{c}) \\right] - \\left(-k \\left[ \\frac{v_{0} - u_{0}}{L} + g_{c} \\right]\\right)\n$$\n$$\n\\Lambda = -k \\left[ \\frac{v_{0} - u_{0}}{L} + g_{c} + 2g_{f} - 2g_{c} - \\left(\\frac{v_{0} - u_{0}}{L} + g_{c}\\right) \\right]\n$$\n$$\n\\Lambda = -k \\left[ 2g_{f} - 2g_{c} \\right] = 2k(g_{c} - g_{f})\n$$\n因此，泄漏为 $\\Lambda = 2k(g_{c} - g_{f})$。这个非零泄漏取决于细观场和粗观场梯度的不匹配，表明朴素混合方案违反了守恒律。\n\n**第2部分：推导修正核 $\\phi(x)$**\n\n修正场为 $\\tilde{u}(x) = u_{b}(x) + \\phi(x)$。问题要求与 $\\tilde{u}(x)$ 相关的通量在握手区域内是恒定的。通量为 $\\tilde{J}(x) = -k \\frac{d\\tilde{u}}{dx}$。通量恒定的条件等价于守恒律 $\\frac{d\\tilde{J}}{dx}=0$。\n$$\n\\frac{d}{dx} \\left(-k \\frac{d\\tilde{u}}{dx}\\right) = 0\n$$\n由于 $k$ 是一个非零常数，这可以简化为关于 $\\tilde{u}(x)$ 的一个泊松方程：\n$$\n\\frac{d^2\\tilde{u}}{dx^2} = 0\n$$\n代入 $\\tilde{u}(x) = u_{b}(x) + \\phi(x)$：\n$$\n\\frac{d^2}{dx^2} \\left[ u_{b}(x) + \\phi(x) \\right] = 0 \\implies \\frac{d^2u_{b}}{dx^2} + \\frac{d^2\\phi}{dx^2} = 0\n$$\n这就给出了修正核 $\\phi(x)$ 的一个微分方程：\n$$\n\\frac{d^2\\phi}{dx^2} = - \\frac{d^2u_{b}}{dx^2}\n$$\n我们已经求出了 $u_b(x)$ 的一阶导数。我们再次对其求导以求得二阶导数：\n$$\n\\frac{d^2u_{b}}{dx^2} = \\frac{d}{dx} \\left[ \\left(\\frac{v_{0} - u_{0}}{L} + g_{c}\\right) + 2\\left(\\frac{g_{f} - g_{c}}{L}\\right)x \\right] = 2\\left(\\frac{g_{f} - g_{c}}{L}\\right)\n$$\n因此，$\\phi(x)$ 的微分方程为：\n$$\n\\frac{d^2\\phi}{dx^2} = -2\\left(\\frac{g_{f} - g_{c}}{L}\\right) = 2\\left(\\frac{g_{c} - g_{f}}{L}\\right)\n$$\n为了解这个常微分方程，我们对 $x$ 积分两次。为简洁起见，令 $A = 2\\left(\\frac{g_{c} - g_{f}}{L}\\right)$。\n$$\n\\frac{d^2\\phi}{dx^2} = A\n$$\n积分一次得到：\n$$\n\\frac{d\\phi}{dx} = Ax + C_1\n$$\n其中 $C_1$ 是一个积分常数。再次积分得到 $\\phi(x)$ 的通解：\n$$\n\\phi(x) = \\frac{1}{2}Ax^2 + C_1x + C_2\n$$\n其中 $C_2$ 是第二个积分常数。我们使用端点约束 $\\phi(0)=0$ 和 $\\phi(L)=0$ 来确定 $C_1$ 和 $C_2$。\n\n应用 $\\phi(0)=0$：\n$$\n\\phi(0) = \\frac{1}{2}A(0)^2 + C_1(0) + C_2 = 0 \\implies C_2 = 0\n$$\n解简化为 $\\phi(x) = \\frac{1}{2}Ax^2 + C_1x$。\n\n应用 $\\phi(L)=0$：\n$$\n\\phi(L) = \\frac{1}{2}AL^2 + C_1L = 0\n$$\n因为 $L \\neq 0$，我们可以两边除以 $L$：\n$$\n\\frac{1}{2}AL + C_1 = 0 \\implies C_1 = -\\frac{1}{2}AL\n$$\n现在我们将常数 $C_1$ 和 $C_2$ 代回到 $\\phi(x)$ 的表达式中：\n$$\n\\phi(x) = \\frac{1}{2}Ax^2 - \\frac{1}{2}ALx = \\frac{A}{2} (x^2 - Lx)\n$$\n最后，我们代回 $A = 2\\left(\\frac{g_{c} - g_{f}}{L}\\right)$ 的表达式：\n$$\n\\phi(x) = \\frac{1}{2} \\left[2\\left(\\frac{g_{c} - g_{f}}{L}\\right)\\right] (x^2 - Lx)\n$$\n$$\n\\phi(x) = \\frac{g_{c} - g_{f}}{L} (x^2 - Lx)\n$$\n这就是所求的修正核，它能确保修正场具有恒定通量，同时满足在握手区域边界处为零的条件。",
            "answer": "$$\\boxed{\\frac{g_c - g_f}{L}(x^2 - Lx)}$$"
        },
        {
            "introduction": "最后的练习将我们从稳态分析带入更复杂的瞬态动力学世界。这个实践要求您实现一个完整的数值模拟，以观察波在穿过握手区域时的行为，并量化系统的能量守恒性。您将发现耦合算子的数学对称性与模拟的长期稳定性之间的关键联系，这是预测性建模中的一个核心概念。",
            "id": "3819403",
            "problem": "考虑一个一维瞬态波，该波在一个耦合了线性弹性晶格的两个模型的并发重叠（“握手”）区域中传播。左侧模型是一个粗糙一维链（模型 A），右侧模型是一个精细一维链（模型 B）。每个模型由通过最近邻线性弹簧连接的质点表示。重叠区域通过一个线性耦合算子来强制约束，该算子惩罚握手区域中两个模型之间的位移失配。您需要数值计算最终时刻 $T$ 后的累积能量误差，并将其与耦合算子不满足精确能量守恒的特性联系起来。\n\n基本原理和系统定义：\n- 对每个质点使用牛顿第二定律 $m\\,\\ddot{u} = f$，对线性弹簧使用胡克定律。\n- 模型 A：$n_A$ 个节点，位置为 $x_i^A \\in [0, L_A]$，位移为 $u_i^A(t)$，速度为 $v_i^A(t)$，每个节点的质量为 $m_A$，最近邻节点间的弹簧刚度为 $k_A$。\n- 模型 B：$n_B$ 个节点，位置为 $x_j^B \\in [x_H^{\\text{start}}, L_B]$，位移为 $u_j^B(t)$，速度为 $v_j^B(t)$，每个节点的质量为 $m_B$，弹簧刚度为 $k_B$。\n- 握手重叠区间为 $[x_H^{\\text{start}}, x_H^{\\text{end}}]$，在此区间内两个模型同时表示物理域。\n- 每条链中的内力由位移的离散拉普拉斯算子给出，边界条件为自由端：\n  - 对模型 A，节点 $i$ 上的内力为\n    $$f_{i,\\text{int}}^A = k_A\\big(u_{i-1}^A - 2u_i^A + u_{i+1}^A\\big),\\quad i=2,\\dots,n_A-1,$$\n    $$f_{1,\\text{int}}^A = k_A\\big(u_{2}^A - u_1^A\\big),\\quad f_{n_A,\\text{int}}^A = k_A\\big(u_{n_A-1}^A - u_{n_A}^A\\big).$$\n  - 对模型 B，节点 $j$ 上的内力为\n    $$f_{j,\\text{int}}^B = k_B\\big(u_{j-1}^B - 2u_j^B + u_{j+1}^B\\big),\\quad j=2,\\dots,n_B-1,$$\n    $$f_{1,\\text{int}}^B = k_B\\big(u_{2}^B - u_1^B\\big),\\quad f_{n_B,\\text{int}}^B = k_B\\big(u_{n_B-1}^B - u_{n_B}^B\\big).$$\n- 握手区域中的耦合算子：\n  - 令 $\\mathcal{I}_H^A$ 表示模型 A 中位置位于 $[x_H^{\\text{start}}, x_H^{\\text{end}}]$ 内的节点 $i$ 的索引。定义一个线性插值（投影）矩阵 $\\Phi \\in \\mathbb{R}^{|\\mathcal{I}_H^A| \\times n_B}$，使得对于 $i \\in \\mathcal{I}_H^A$，\n    $$\\hat{u}_i^A = (\\Phi u^B)_i$$\n    是模型 B 在模型 A 节点 $i$ 位置处的插值位移。\n  - 将失配 $r \\in \\mathbb{R}^{|\\mathcal{I}_H^A|}$ 定义为\n    $$r = u_H^A - \\Phi u^B,$$\n    其中 $u_H^A$ 是模型 A 在索引 $\\mathcal{I}_H^A$ 处位移的向量。\n  - 耦合力的施加方式如下：\n    $$f_{\\text{cpl}}^A[\\mathcal{I}_H^A] = -k_c\\, r,$$\n    $$f_{\\text{cpl}}^B = +k_c\\,\\gamma\\,\\Phi^\\top r,$$\n    其中 $k_c$ 是耦合刚度，$\\gamma$ 是一个无量纲的对称性参数。当 $\\gamma = 1$ 时，耦合力与对称二次罚函数势 $E_{\\text{cpl}} = \\tfrac{1}{2}k_c\\|r\\|^2$ 是伴随一致的，如果进行精确积分，则封闭系统能够实现精确的能量守恒。当 $\\gamma \\neq 1$ 时，该算子对于两个模型而言，不再是同一个标量势的梯度，因此精确能量守恒被破坏，导致伪能量漂移。\n- 时间积分：使用速度 Verlet 格式（一种辛积分器）来减少算法能量误差：\n  $$v^{n+\\tfrac{1}{2}} = v^n + \\tfrac{\\Delta t}{2} a^n,$$\n  $$u^{n+1} = u^n + \\Delta t\\, v^{n+\\tfrac{1}{2}},$$\n  $$a^{n+1} = f(u^{n+1})/m,$$\n  $$v^{n+1} = v^{n+\\tfrac{1}{2}} + \\tfrac{\\Delta t}{2} a^{n+1}.$$\n- 能量计算：\n  - 模型 A 的动能：$$K^A = \\tfrac{1}{2} m_A \\sum_{i=1}^{n_A} (v_i^A)^2.$$\n  - 模型 A 弹簧的势能：$$P^A = \\tfrac{1}{2} k_A \\sum_{i=1}^{n_A-1} (u_{i+1}^A - u_i^A)^2.$$\n  - 模型 B 的动能：$$K^B = \\tfrac{1}{2} m_B \\sum_{j=1}^{n_B} (v_j^B)^2.$$\n  - 模型 B 弹簧的势能：$$P^B = \\tfrac{1}{2} k_B \\sum_{j=1}^{n_B-1} (u_{j+1}^B - u_j^B)^2.$$\n  - 仅用于能量计算的对称耦合势：$$E_{\\text{cpl}} = \\tfrac{1}{2} k_c \\|r\\|^2.$$\n  - 用于误差测量的总能量：$$E_{\\text{tot}}(t) = K^A + P^A + K^B + P^B + E_{\\text{cpl}}.$$\n  - $T$ 时刻后的累积能量误差即为漂移量 $$\\Delta E(T) = E_{\\text{tot}}(T) - E_{\\text{tot}}(0)。$$\n- 初始条件：\n  - 位移初始化为零：$u_i^A(0) = 0$，$u_j^B(0) = 0$。\n  - 通过在模型 A 中赋予高斯速度分布来产生一个右行瞬态波：\n    $$v_i^A(0) = V_0 \\exp\\left(-\\frac{(x_i^A - x_0)^2}{2\\sigma^2}\\right),$$\n    其中 $V_0$、$x_0$ 和 $\\sigma$ 在下方指定。\n  - 模型 B 的速度初始为零：$v_j^B(0) = 0$。\n\n数值参数、单位和离散化：\n- 所有量必须采用国际单位制：长度单位为米 (m)，质量单位为千克 (kg)，时间单位为秒 (s)，刚度单位为牛顿/米 (N/m)，能量单位为焦耳 (J)，最终答案必须以焦耳表示。\n- 使用 $n_A = 101$，$n_B = 201$。\n- 使用 $m_A = m_B = 1.0\\times 10^{-3}\\,\\text{kg}$，$k_A = k_B = 10\\,\\text{N/m}$。\n- 粗糙域延伸至 $L_A = x_H^{\\text{end}}$，精细域为 $[x_H^{\\text{start}}, L_B]$，其中 $L_B = 1.0\\,\\text{m}$，$x_H^{\\text{start}} = 0.4\\,\\text{m}$。\n- 握手区域宽度 $W = x_H^{\\text{end}} - x_H^{\\text{start}}$ 因测试用例而异。\n- 时间步长 $\\Delta t = 1.0\\times 10^{-4}\\,\\text{s}$，最终时间 $T = 0.5\\,\\text{s}$。\n- 高斯参数 $V_0 = 0.01\\,\\text{m/s}$，$x_0 = 0.1\\,\\text{m}$，$\\sigma = 0.02\\,\\text{m}$。\n\n测试组与要求输出：\n实现该模拟，并针对以下五个测试用例中的每一个计算 $\\Delta E(T)$：\n1. 理想情况，伴随一致耦合：$\\gamma = 1.0$，$k_c = 100\\,\\text{N/m}$，$W = 0.2\\,\\text{m}$。\n2. 非对称耦合，轻度不守恒：$\\gamma = 0.9$，$k_c = 100\\,\\text{N/m}$，$W = 0.2\\,\\text{m}$。\n3. 另一方向的非对称耦合：$\\gamma = 1.1$，$k_c = 100\\,\\text{N/m}$，$W = 0.2\\,\\text{m}$。\n4. 窄握手区域增加失配：$\\gamma = 0.9$，$k_c = 100\\,\\text{N/m}$，$W = 0.1\\,\\text{m}$。\n5. 更强的耦合惩罚：$\\gamma = 0.9$，$k_c = 200\\,\\text{N/m}$，$W = 0.2\\,\\text{m}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个条目等于以焦耳为单位的 $\\Delta E(T)$。例如，输出格式必须为：“[$\\text{result}_1$,$\\text{result}_2$,$\\text{result}_3$,$\\text{result}_4$,$\\text{result}_5$]”。每个 $\\text{result}_i$ 必须是一个以焦耳为单位的十进制浮点数。",
            "solution": "用户提供的问题已经过验证，被确定为计算物理学（特别是在多尺度建模领域）中一个适定且科学合理的问题练习。该问题涉及模拟一个一维波在两个离散弹性链组成的耦合系统中的传播，其目标是量化由非对称耦合方案引入的能量误差。问题本身是自洽的，清晰地规定了所有必要的物理参数、初始条件和数值方法。\n\n解决方案是通过根据所提供的规格说明实现数值模拟来开发的。该方法的核心在于离散两个耦合的质点-弹簧系统的运动方程，并使用速度 Verlet 算法对它们进行时间积分。\n\n首先，我们为每个模型建立计算域。模型 A（粗糙链）包含 $n_A = 101$ 个质量点。其空间域为 $[0, L_A]$，其中 $L_A = x_H^{\\text{end}} = x_H^{\\text{start}} + W$。由于握手区域宽度 $W$ 在不同测试用例中会变化，因此域长 $L_A$ 和相应的均匀节点间距 $h_A = L_A / (n_A - 1)$ 会为每个用例重新计算。质量点的位置由 $x_i^A = (i-1)h_A$ 给出，其中 $i=1, \\dots, n_A$。模型 B（精细链）包含 $n_B = 201$ 个质量点，位于固定域 $[x_H^{\\text{start}}, L_B]$ 上，其中 $x_H^{\\text{start}} = 0.4\\,\\text{m}$，$L_B = 1.0\\,\\text{m}$。节点间距为 $h_B = (L_B - x_H^{\\text{start}}) / (n_B - 1)$，质量点的位置为 $x_j^B = x_H^{\\text{start}} + (j-1)h_B$，其中 $j=1, \\dots, n_B$。\n\n两个模型之间的耦合是通过一个线性插值矩阵 $\\Phi$ 来介导的。该矩阵的行对应于位于握手区域 $[x_H^{\\text{start}}, x_H^{\\text{end}}]$ 内的模型 A 的节点，由索引集 $\\mathcal{I}_H^A$ 表示。$\\Phi$ 的每一行都包含将模型 B 的位移场 $u^B$ 线性插值到特定节点位置 $x_i^A$（其中 $i \\in \\mathcal{I}_H^A$）的权重。对于给定的 $x_i^A$，我们在模型 B 中找到两个相邻节点 $j$ 和 $j+1$，使得 $x_j^B \\le x_i^A \\le x_{j+1}^B$。插值位移则为 $\\hat{u}_i^A = w_j u_j^B + w_{j+1} u_{j+1}^B$，其中权重为 $w_{j+1} = (x_i^A - x_j^B) / h_B$ 和 $w_j = 1 - w_{j+1}$。矩阵 $\\Phi$ 的构建方法是在其行的相应列中填入这些非零权重。\n\n系统的动力学由牛顿第二定律 $m\\ddot{u} = F_{\\text{total}}$ 控制，其中每个质量点上的总力是内力（弹簧力）和外力（耦合力）之和。每条链的内力使用所提供的离散拉普拉斯算子模板计算，这对应于自由边界条件下基于胡克定律的最近邻相互作用。耦合力源于一种罚函数方法。失配向量 $r = u_H^A - \\Phi u^B$ 量化了握手区域中粗糙模型位移与插值后的精细模型位移之间的差异。耦合力的施加方式为 $f_{\\text{cpl}}^A[\\mathcal{I}_H^A] = -k_c r$ 和 $f_{\\text{cpl}}^B = +k_c\\gamma\\Phi^\\top r$。参数 $\\gamma$ 控制了力的施加的对称性；只有当 $\\gamma=1$ 时，力才是伴随一致的，即它们是同一个标量势能函数的负梯度，这是耦合本身能量守恒的必要条件。\n\n时间演化采用速度 Verlet 算法计算，这是一种辛积分器，以其良好的长期能量守恒特性而闻名。模拟从初始条件开始：所有节点的位移为零，模型 A 具有以 $x_0=0.1\\,\\text{m}$ 为中心的高斯速度分布，而模型 B 处于静止状态。\n系统的状态由位移向量 $u^A, u^B$ 和速度向量 $v^A, v^B$ 描述。模拟循环以 $\\Delta t = 1.0 \\times 10^{-4}\\,\\text{s}$ 的离散时间步长进行，直到最终时间 $T=0.5\\,\\text{s}$。\n在每个步骤 $n$ 中：\n1.  计算半步速度：$v^{n+1/2} = v^n + (\\Delta t/2) a^n$。\n2.  更新位移：$u^{n+1} = u^n + \\Delta t \\, v^{n+1/2}$。\n3.  根据新的位移计算总力 $F(u^{n+1})$。\n4.  计算下一步的加速度：$a^{n+1} = F(u^{n+1})/m$。\n5.  将速度更新至完整步：$v^{n+1} = v^{n+1/2} + (\\Delta t/2) a^{n+1}$。\n\n为了评估能量漂移，我们将系统的总能量定义为 $E_{\\text{tot}} = K^A + P^A + K^B + P^B + E_{\\text{cpl}}$，其中 $K$ 和 $P$ 分别是各个模型的动能和势能，而 $E_{\\text{cpl}} = \\frac{1}{2} k_c \\|r\\|^2$ 是用作一致性参考的耦合能量的对称部分。在模拟开始时计算总能量 $E_{\\text{tot}}(0)$，在结束时计算 $E_{\\text{tot}}(T)$。累积能量误差是其差值 $\\Delta E(T) = E_{\\text{tot}}(T) - E_{\\text{tot}}(0)$。对五个测试用例中的每一个都重复此完整过程，这些测试用例改变了对称性参数 $\\gamma$、耦合刚度 $k_c$ 和握手区域宽度 $W$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (gamma, k_c, W)\n        (1.0, 100.0, 0.2),  # Case 1: Happy path, adjoint-consistent\n        (0.9, 100.0, 0.2),  # Case 2: Asymmetric, mild non-conservation\n        (1.1, 100.0, 0.2),  # Case 3: Asymmetric, other direction\n        (0.9, 100.0, 0.1),  # Case 4: Narrow handshake\n        (0.9, 200.0, 0.2),  # Case 5: Stronger coupling\n    ]\n\n    results = []\n    for gamma, k_c, W in test_cases:\n        delta_e = run_simulation(gamma, k_c, W)\n        results.append(delta_e)\n\n    # Format and print the final output as a single line.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\ndef run_simulation(gamma, k_c, W):\n    \"\"\"\n    Executes a single simulation for a given set of parameters.\n\n    Args:\n        gamma (float): Dimensionless symmetry parameter.\n        k_c (float): Coupling stiffness (N/m).\n        W (float): Handshake width (m).\n\n    Returns:\n        float: The cumulative energy error Delta E(T) in joules.\n    \"\"\"\n    # Fundamental constants and numerical parameters\n    nA = 101\n    nB = 201\n    mA = 1.0e-3\n    mB = 1.0e-3\n    kA = 10.0\n    kB = 10.0\n    L_B = 1.0\n    xH_start = 0.4\n    dt = 1.0e-4\n    T = 0.5\n    V0 = 0.01\n    x0 = 0.1\n    sigma = 0.02\n\n    # Geometry setup\n    xH_end = xH_start + W\n    L_A = xH_end\n    xA = np.linspace(0.0, L_A, nA)\n    xB = np.linspace(xH_start, L_B, nB)\n    hB = xB[1] - xB[0]\n\n    # Find indices of Model A nodes in the handshake region\n    I_H_A_indices = np.where((xA >= xH_start)  (xA = xH_end))[0]\n    \n    # Construct the interpolation matrix Phi\n    Phi = np.zeros((len(I_H_A_indices), nB))\n    for k, i in enumerate(I_H_A_indices):\n        pos_A = xA[i]\n        # Find the index j in Model B such that xB[j] = pos_A = xB[j+1]\n        j = np.searchsorted(xB, pos_A, side='right') - 1\n        j = np.clip(j, 0, nB - 2) # Ensure j is not out of bounds\n        \n        weight_jp1 = (pos_A - xB[j]) / hB\n        weight_j = 1.0 - weight_jp1\n        \n        Phi[k, j] = weight_j\n        Phi[k, j+1] = weight_jp1\n\n    # Initial conditions\n    uA = np.zeros(nA)\n    uB = np.zeros(nB)\n    vA = V0 * np.exp(-((xA - x0)**2) / (2 * sigma**2))\n    vB = np.zeros(nB)\n\n    def calculate_forces(uA_in, uB_in):\n        # Internal forces for Model A\n        FA_int = np.zeros(nA)\n        FA_int[1:-1] = kA * (uA_in[:-2] - 2 * uA_in[1:-1] + uA_in[2:])\n        FA_int[0] = kA * (uA_in[1] - uA_in[0])\n        FA_int[-1] = kA * (uA_in[-2] - uA_in[-1])\n        \n        # Internal forces for Model B\n        FB_int = np.zeros(nB)\n        FB_int[1:-1] = kB * (uB_in[:-2] - 2 * uB_in[1:-1] + uB_in[2:])\n        FB_int[0] = kB * (uB_in[1] - uB_in[0])\n        FB_int[-1] = kB * (uB_in[-2] - uB_in[-1])\n\n        # Coupling forces\n        uH_A = uA_in[I_H_A_indices]\n        uH_A_hat = Phi @ uB_in\n        r = uH_A - uH_A_hat\n        \n        force_on_A_handshake = -k_c * r\n        force_on_B = k_c * gamma * (Phi.T @ r)\n\n        FA_total = FA_int\n        np.add.at(FA_total, I_H_A_indices, force_on_A_handshake)\n        FB_total = FB_int + force_on_B\n        \n        return FA_total, FB_total, r\n\n    def calculate_total_energy(uA_in, vA_in, uB_in, vB_in, r_in):\n        KA = 0.5 * mA * np.sum(vA_in**2)\n        PA = 0.5 * kA * np.sum(np.diff(uA_in)**2)\n        KB = 0.5 * mB * np.sum(vB_in**2)\n        PB = 0.5 * kB * np.sum(np.diff(uB_in)**2)\n        E_cpl = 0.5 * k_c * np.sum(r_in**2)\n        return KA + PA + KB + PB + E_cpl\n    \n    # Calculate initial energy\n    _, _, r0 = calculate_forces(uA, uB)\n    E_initial = calculate_total_energy(uA, vA, uB, vB, r0)\n\n    # Time integration using Velocity Verlet\n    num_steps = int(T / dt)\n    FA, FB, _ = calculate_forces(uA, uB)\n    aA = FA / mA\n    aB = FB / mB\n\n    for _ in range(num_steps):\n        # First half of velocity update\n        vA_half = vA + 0.5 * dt * aA\n        vB_half = vB + 0.5 * dt * aB\n\n        # Position update\n        uA += dt * vA_half\n        uB += dt * vB_half\n\n        # Force calculation at new position\n        FA_new, FB_new, _ = calculate_forces(uA, uB)\n        aA_new = FA_new / mA\n        aB_new = FB_new / mB\n\n        # Second half of velocity update\n        vA = vA_half + 0.5 * dt * aA_new\n        vB = vB_half + 0.5 * dt * aB_new\n\n        # Update acceleration for next step\n        aA, aB = aA_new, aB_new\n\n    # Calculate final energy\n    _, _, r_final = calculate_forces(uA, uB)\n    E_final = calculate_total_energy(uA, vA, uB, vB, r_final)\n\n    return E_final - E_initial\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}