{
    "hands_on_practices": [
        {
            "introduction": "Before designing a numerical scheme, it is crucial to understand the underlying structure of the problem it aims to solve. Many multiscale systems with stiff relaxation are governed by a lower-dimensional \"slow manifold\" which dictates the long-term dynamics. This exercise focuses on identifying this critical structure from first principles.\n\nThis practice will sharpen your skills in applying singular perturbation theory to determine the conditions under which a slow manifold exists and to find its explicit form in the asymptotic limit . Mastering this helps clarify the target dynamics that an Asymptotic-Preserving scheme must accurately capture as the stiffness parameter $\\varepsilon \\to 0$.",
            "id": "3733745",
            "problem": "Consider the stiff source partial differential equation (PDE) $\\partial_t u + a\\,\\partial_x u = \\frac{1}{\\varepsilon} S(u)$ posed for $u(x,t) \\in \\mathbb{R}^2$, with $u = (w,v)^{\\top}$ and $a \\in \\mathbb{R}^2$ constant. Assume that $S(u)$ is smooth and represents fast relaxation toward a lower-dimensional attracting set, so that a reduced slow dynamics is expected as $\\varepsilon \\to 0$, a setting relevant for the design of Asymptotic-Preserving (AP) schemes, which are numerical methods that remain stable and consistent with the reduced model in the limit of vanishing scale-separation parameter.\n\nStarting from the foundational principles of singular perturbation theory for dynamical systems with fast relaxation and hyperbolic transport, formulate conditions on the source term $S(u)$ ensuring the existence of a well-defined, normally hyperbolic, attracting slow manifold for the PDE. Then, for the specific choice\n$$\nS(u) = \\begin{pmatrix}\n0 \\\\\n-\\lambda\\big(v - \\alpha w - \\beta w^3\\big)\n\\end{pmatrix},\n$$\nwith constants $\\lambda > 0$, $\\alpha \\in \\mathbb{R}$, and $\\beta \\in \\mathbb{R}$, determine the leading-order form of the slow manifold mapping $v = h(w)$ that captures the $\\varepsilon \\to 0$ limit of the stiff relaxation dynamics. Your final answer must be the closed-form analytical expression for $h(w)$ (do not include any equality signs). No numerical rounding is required.",
            "solution": "The PDE under consideration is\n$$\n\\partial_t u + a\\,\\partial_x u = \\frac{1}{\\varepsilon} S(u),\n$$\nwith $u = (w,v)^{\\top}$ and $a = (a_w, a_v)^{\\top}$. In the singular limit $\\varepsilon \\to 0$, the term $\\frac{1}{\\varepsilon} S(u)$ dominates and drives the solution rapidly toward the set where $S(u) = 0$. To ensure the existence of a well-defined slow manifold that is invariant (to leading order) and attracting, we invoke classical singular perturbation theory for systems with fast relaxation and transport, together with the notion of a normally hyperbolic invariant manifold.\n\nThe key foundational facts used are:\n- In stiff relaxation systems, the fast dynamics is governed by the ordinary differential equation (in fast time) $\\frac{d u}{d\\tau} = S(u)$, where $\\tau = t/\\varepsilon$. If $S(u)$ has a set of equilibria forming a smooth manifold and the linearization of $S$ transverse to this set has eigenvalues with strictly negative real parts, then the manifold is normally hyperbolic and attracting.\n- For the PDE with transport, provided transport is not strong enough to destroy normal hyperbolicity (e.g., transport acts tangentially to leading order or is of lower order in the fast time scale), the slow manifold persists and the solution rapidly approaches it; thereafter, the dynamics projects onto the manifold and evolves according to the reduced (slow) equation.\n\nTherefore, sufficient conditions on $S(u)$ for a well-defined slow manifold are:\n1. The zero set $\\{u : S(u) = 0\\}$ is a smooth manifold of dimension equal to the number of slow variables (here, one-dimensional, parameterized by $w$).\n2. The Jacobian $\\mathrm{D}S(u)$ restricted to directions transverse to the manifold has eigenvalues with strictly negative real parts uniformly in $u$ on the manifold (normal hyperbolicity and attraction).\n3. The source $S(u)$ is sufficiently smooth (e.g., continuously differentiable with bounded derivatives in the domain of interest), so that the manifold is smooth and the projection onto the manifold is well-defined.\n4. Transport $a\\,\\partial_x u$ does not alter the fast stability mechanism at leading order in the fast time scale, which is guaranteed when the stiff source dominates and acts transversely to the manifold, ensuring rapid relaxation onto the manifold before transport significantly perturbs the state.\n\nFor the specific source\n$$\nS(u) = \\begin{pmatrix}\n0 \\\\\n-\\lambda\\big(v - \\alpha w - \\beta w^3\\big)\n\\end{pmatrix},\n$$\nwe analyze the fast dynamics. The equilibrium set is given by $S(u) = 0$, i.e.,\n$$\n0 = -\\lambda\\big(v - \\alpha w - \\beta w^3\\big) \\quad \\Rightarrow \\quad v = \\alpha w + \\beta w^3.\n$$\nThis set is a smooth one-dimensional manifold parameterized by $w$. The Jacobian of $S(u)$ with respect to $u$ is\n$$\n\\mathrm{D}S(u) = \\begin{pmatrix}\n0 & 0 \\\\\n-\\lambda(\\alpha + 3\\beta w^2) & -\\lambda\n\\end{pmatrix}.\n$$\nTransverse to the manifold (in the $v$-direction), the eigenvalue is $-\\lambda$, which is strictly negative for $\\lambda > 0$, ensuring exponential attraction to the manifold. Hence, the conditions above are satisfied: the manifold is smooth, normally hyperbolic, and attracting.\n\nTo obtain the leading-order form of the slow manifold mapping $v = h(w)$ as $\\varepsilon \\to 0$, we consider an asymptotic expansion $u = u^{(0)} + \\varepsilon u^{(1)} + \\cdots$. At leading order $\\mathcal{O}(1/\\varepsilon)$, the balance is $S(u^{(0)}) = 0$, implying\n$$\nv^{(0)} = \\alpha w^{(0)} + \\beta \\big(w^{(0)}\\big)^3.\n$$\nTherefore, the leading-order slow manifold is given by $v = h(w)$ with\n$$\nh(w) = \\alpha w + \\beta w^3.\n$$\nHigher-order corrections in $\\varepsilon$ would involve transport and coupling effects, but at leading order the slow manifold coincides with the equilibrium set of the source term. This form is the one that AP schemes should preserve as $\\varepsilon \\to 0$, ensuring consistency with the reduced model.\n\nThe required final expression for the leading-order slow manifold mapping is thus $h(w) = \\alpha w + \\beta w^3$, and per the instructions, we provide the expression without an equality sign in the final answer.",
            "answer": "$$\\boxed{\\alpha w + \\beta w^{3}}$$"
        },
        {
            "introduction": "Once the asymptotic limit is understood, the central task is to construct a numerical scheme that correctly preserves this limit at the discrete level. This problem transitions from pure theory to the practical design of a conservative finite volume method for a transport equation in the diffusive scaling.\n\nHere, you will build a semi-implicit scheme, a cornerstone technique for developing AP methods, by carefully separating the stiff and non-stiff terms . By deriving the scheme's behavior as $\\varepsilon \\to 0$, you will gain hands-on experience with the design and analysis process that ensures a numerical method remains robust and accurate across different physical regimes.",
            "id": "3733720",
            "problem": "Consider a one-dimensional linear transport model in diffusive scaling on a spatial domain $[0,L]$ with periodic boundary conditions. The kinetic unknown $f(t,x,v)$ depends on time $t$, space $x$, and a discrete velocity $v \\in \\{-1,1\\}$ with equal weights. Define the parity variables $\\rho(t,x)$ and $j(t,x)$ by $\\rho = (f(t,x,1)+f(t,x,-1))/2$ and $j = (f(t,x,1)-f(t,x,-1))/(2\\varepsilon)$, where $\\varepsilon > 0$ is the scaling parameter. Let the collision frequency be a strictly positive function $\\sigma(x)$ that is piecewise constant on a uniform mesh. The parity system, derived from the transport model under standard assumptions on isotropic scattering, reads\n$$\n\\partial_t \\rho + \\partial_x j = 0, \\qquad \\varepsilon^{2}\\,\\partial_t j + \\partial_x \\rho = -\\sigma(x)\\,j.\n$$\nThe formal diffusion limit as $\\varepsilon \\to 0$ is $\\partial_t \\rho - \\partial_x\\!\\left(D(x)\\,\\partial_x \\rho\\right)=0$ with $D(x) = 1/\\sigma(x)$. Your task is to construct a conservative finite volume scheme that is Asymptotic-Preserving (AP), meaning it remains stable and consistent as $\\varepsilon \\to 0$ and recovers a discrete diffusion equation for $\\rho$. Use a uniform mesh with cell centers $x_i$ and spacing $\\Delta x$, and denote by $\\rho_i^n$ and $j_i^n$ the cell averages at time $t^n$. Assume a first-order in time semi-implicit discretization for the stiff source term and a consistent centered approximation for nonstiff terms:\n- In the $\\rho$-equation, approximate $\\partial_x j$ by a numerical flux $J_{i+1/2}$ at interfaces, consistent with local conservation.\n- In the $j$-equation, treat the relaxation term $-\\sigma(x)\\,j$ implicitly and approximate $\\partial_x \\rho$ by a centered difference at cell centers using interfacial values $\\rho_{i\\pm 1/2}$.\n\nStarting from these principles and the stated equations, derive the $\\varepsilon \\to 0$ discrete limit and show that the scheme yields a diffusive finite volume update for $\\rho_i^{n+1}$ with an interfacial flux $F_{i+1/2}^{\\mathrm{diff}}$ that is consistent with the continuous limit. Express $F_{i+1/2}^{\\mathrm{diff}}$ solely in terms of $\\rho_{i}$, $\\rho_{i+1}$, $\\Delta x$, and the piecewise constant collision frequencies $\\sigma_i$ and $\\sigma_{i+1}$ associated with cells $i$ and $i+1$. Provide the closed-form analytic expression for $F_{i+1/2}^{\\mathrm{diff}}$ that arises from your construction in the limit $\\varepsilon \\to 0$, and justify its consistency with the continuous diffusion flux $-D(x)\\,\\partial_x \\rho$.\n\nThe final answer must be the single analytic expression for $F_{i+1/2}^{\\mathrm{diff}}$. No rounding is required, and no physical units are needed. Define any acronyms you use on their first appearance, such as Asymptotic-Preserving (AP) and Finite Volume (FV).",
            "solution": "The objective is to construct an Asymptotic-Preserving (AP) Finite Volume (FV) scheme for the given system and derive the expression for the numerical flux in the diffusion limit ($\\varepsilon \\to 0$).\n\nThe governing system is:\n$$\n\\partial_t \\rho + \\partial_x j = 0 \\\\\n\\varepsilon^{2}\\,\\partial_t j + \\partial_x \\rho = -\\sigma(x)\\,j\n$$\n\nWe start by discretizing the first equation using a finite volume approach. We integrate over a cell $[x_{i-1/2}, x_{i+1/2}]$ and use a first-order implicit time discretization to ensure stability in the diffusive limit, evaluating the flux at time level $n+1$:\n$$\n\\frac{\\rho_i^{n+1} - \\rho_i^n}{\\Delta t} + \\frac{J_{i+1/2}^{n+1} - J_{i-1/2}^{n+1}}{\\Delta x} = 0\n$$\nThis is a conservative update for the cell average $\\rho_i$. To proceed, we need an expression for the numerical flux $J_{i+1/2}^{n+1}$. This is obtained by discretizing the second governing equation at the cell interface $x_{i+1/2}$, which is a standard staggered-grid approach for this type of system.\n\nThe second equation is discretized at the interface $x_{i+1/2}$ at time $t^{n+1}$.\n- The time derivative $\\partial_t j$ is approximated by a first-order difference: $\\frac{J_{i+1/2}^{n+1} - J_{i+1/2}^n}{\\Delta t}$.\n- The spatial derivative $\\partial_x \\rho$ is approximated by a centered finite difference: $\\frac{\\rho_{i+1} - \\rho_i}{\\Delta x}$. For a semi-implicit scheme, this non-stiff term is evaluated explicitly at time $t^n$.\n- The stiff relaxation term $-\\sigma j$ is evaluated implicitly at time $t^{n+1}$: $-\\sigma_{i+1/2} J_{i+1/2}^{n+1}$, where $\\sigma_{i+1/2}$ is the collision frequency at the interface. Since $\\sigma(x)$ is piecewise constant, the correct choice to model diffusion across a material interface is the arithmetic mean: $\\sigma_{i+1/2} = \\frac{\\sigma_i + \\sigma_{i+1}}{2}$.\n\nCombining these approximations, the semi-implicit discretization for the $j$-equation at the interface $x_{i+1/2}$ is:\n$$\n\\varepsilon^2 \\left(\\frac{J_{i+1/2}^{n+1} - J_{i+1/2}^n}{\\Delta t}\\right) + \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x} = -\\sigma_{i+1/2} J_{i+1/2}^{n+1}\n$$\nWe now solve for the unknown flux $J_{i+1/2}^{n+1}$:\n$$\nJ_{i+1/2}^{n+1} \\left( \\frac{\\varepsilon^2}{\\Delta t} + \\sigma_{i+1/2} \\right) = \\frac{\\varepsilon^2}{\\Delta t} J_{i+1/2}^n - \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x}\n$$\n$$\nJ_{i+1/2}^{n+1} = \\frac{\\frac{\\varepsilon^2}{\\Delta t} J_{i+1/2}^n - \\frac{1}{\\Delta x}(\\rho_{i+1}^n - \\rho_i^n)}{\\frac{\\varepsilon^2}{\\Delta t} + \\sigma_{i+1/2}} = \\frac{\\varepsilon^2 J_{i+1/2}^n - \\frac{\\Delta t}{\\Delta x}(\\rho_{i+1}^n - \\rho_i^n)}{\\varepsilon^2 + \\Delta t \\, \\sigma_{i+1/2}}\n$$\nThis expression defines the numerical flux for any value of $\\varepsilon > 0$. The scheme is AP because it provides a stable and consistent approximation for both the kinetic and diffusive regimes.\n\nTo find the discrete diffusion limit, we take the formal limit of the flux expression as $\\varepsilon \\to 0$. The problem denotes this limiting flux as $F_{i+1/2}^{\\mathrm{diff}}$.\n$$\nF_{i+1/2}^{\\mathrm{diff}} = \\lim_{\\varepsilon \\to 0} J_{i+1/2}^{n+1} = \\frac{0 \\cdot J_{i+1/2}^n - \\frac{\\Delta t}{\\Delta x}(\\rho_{i+1}^n - \\rho_i^n)}{0 + \\Delta t \\, \\sigma_{i+1/2}}\n$$\n$$\nF_{i+1/2}^{\\mathrm{diff}} = - \\frac{1}{\\sigma_{i+1/2}} \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x}\n$$\nSubstituting the expression for the interfacial collision frequency $\\sigma_{i+1/2} = \\frac{\\sigma_i + \\sigma_{i+1}}{2}$:\n$$\nF_{i+1/2}^{\\mathrm{diff}} = - \\frac{1}{\\frac{\\sigma_i + \\sigma_{i+1}}{2}} \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x} = - \\frac{2}{\\sigma_i + \\sigma_{i+1}} \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x}\n$$\nDropping the time superscript for the final expression, we get:\n$$\nF_{i+1/2}^{\\mathrm{diff}} = - \\frac{2 (\\rho_{i+1} - \\rho_i)}{(\\sigma_i + \\sigma_{i+1}) \\Delta x}\n$$\nThis flux is consistent with the continuous diffusion flux $F_{\\mathrm{diff}} = -D(x) \\partial_x \\rho = - \\frac{1}{\\sigma(x)} \\partial_x \\rho$. Our discrete flux has the form $F_{i+1/2}^{\\mathrm{diff}} = -D_{i+1/2} \\frac{\\rho_{i+1} - \\rho_i}{\\Delta x}$, where the numerical diffusion coefficient is $D_{i+1/2} = \\frac{2}{\\sigma_i + \\sigma_{i+1}}$. This is the harmonic mean of the cell-wise diffusion coefficients $D_i=1/\\sigma_i$ and $D_{i+1}=1/\\sigma_{i+1}$, which is the correct and physically consistent representation for diffusion across an interface with piecewise constant properties. Thus, the scheme correctly recovers a consistent discretization of the diffusion equation in the limit $\\varepsilon \\to 0$.",
            "answer": "$$\n\\boxed{- \\frac{2 (\\rho_{i+1} - \\rho_i)}{(\\sigma_i + \\sigma_{i+1}) \\Delta x}}\n$$"
        },
        {
            "introduction": "The ultimate validation of a numerical method lies in its implementation and testing against known behavior. This final practice provides a comprehensive, hands-on opportunity to code an Asymptotic-Preserving scheme and verify its performance through numerical experiments.\n\nYou will implement a complete Implicit-Explicit (IMEX) scheme for a hyperbolic relaxation system, a common model in kinetic theory . By running simulations for various values of the stiffness parameter $\\varepsilon$, you will numerically confirm the defining properties of AP schemes: uniform accuracy in the asymptotic limit and the correct relaxation to the equilibrium state, bridging the gap between theoretical analysis and computational science.",
            "id": "3733743",
            "problem": "Consider the hyperbolic relaxation system on a periodic domain $x \\in [0,1]$ with initial data and parameters chosen to satisfy the subcharacteristic condition:\n$$\n\\begin{cases}\n\\partial_t u + \\partial_x v = 0,\\\\\n\\partial_t v + a^2 \\partial_x u = -\\frac{1}{\\varepsilon}\\left(v - f(u)\\right),\n\\end{cases}\n$$\nwhere $f(u) = c\\,u$, constants $a>0$ and $c$ satisfy $|c| \\le a$, and $\\varepsilon > 0$ is a stiffness parameter. Let $u(x,0) = \\sin(2\\pi x)$ and $v(x,0) = f(u(x,0)) = c\\,\\sin(2\\pi x)$. The periodic boundary condition implies that all spatial derivatives are taken with wrap-around indexing over $x \\in [0,1]$.\n\nFundamental base:\n- The system is a standard hyperbolic relaxation model. In the regime $\\varepsilon \\to 0$, the relaxation enforces $v \\to f(u)$ and the limit equation for $u$ becomes the scalar conservation law $\\partial_t u + \\partial_x f(u) = 0$.\n- For the linear flux $f(u) = c\\,u$ with $|c| \\le a$, the subcharacteristic condition ensures well-posedness and stability of the relaxation system. The limit equation is linear advection $\\partial_t u + c\\,\\partial_x u = 0$, with exact solution $u(x,t) = \\sin(2\\pi(x - c t))$ under the given initial data.\n\nTask:\n1. Design an Implicit-Explicit (IMEX) Asymptotic-Preserving (AP) scheme that:\n   - Treats the hyperbolic transport terms explicitly using a consistent first-order upwind method along characteristic variables.\n   - Treats the stiff relaxation term implicitly so that the time step restriction does not depend on $\\varepsilon$.\n   - Uses a uniform spatial grid with $N$ cells and a time step $\\Delta t$ satisfying a standard Courant–Friedrichs–Lewy (CFL) condition based on the characteristic speed $a$, i.e., $\\Delta t \\le \\lambda \\Delta x / a$ for a fixed Courant number $\\lambda \\in (0,1)$, where $\\Delta x = 1/N$.\n2. Implement the scheme on the domain $[0,1]$ with periodic boundary conditions, using the given initial data, and advance the solution to final time $T$.\n3. Verify numerically two properties of asymptotic-preserving schemes:\n   - Intermediate regime relaxation: that $v$ relaxes to $f(u)$, quantified by the spatial maximum norm of the residual $r(x,t) = v(x,t) - f(u(x,t))$ at an intermediate time and at the final time.\n   - Uniform error boundedness in $\\varepsilon$: that the error in $u$ at time $T$ when compared to the exact solution of the limit equation is bounded uniformly with respect to $\\varepsilon$. Use the relative discrete $L^2$ error $\\|u^{\\text{num}}(\\cdot,T) - u^{\\text{exact}}(\\cdot,T)\\|_{2} / \\|u^{\\text{exact}}(\\cdot,T)\\|_{2}$, where $u^{\\text{exact}}(x,T) = \\sin(2\\pi(x - c T))$.\n\nImplementation requirements:\n- Use characteristic variables $w^{\\pm} = a\\,u \\pm v$ for the explicit transport part, with first-order upwind updates along speeds $\\pm a$, and periodic indexing for fluxes.\n- Use an implicit step for the stiff relaxation to update $v$ without $\\varepsilon$-dependent time step constraints, while $u$ has no relaxation source.\n- Choose the Courant number $\\lambda = 1/2$ and recompute $\\Delta t$ so that an integer number of steps reaches $T$ (i.e., use $M = \\lceil T / \\Delta t \\rceil$ steps and reset $\\Delta t = T/M$).\n\nQuantities to report for each test case:\n- The relative discrete $L^2$ error in $u$ at time $T$.\n- The spatial maximum norm (discrete $\\ell^\\infty$) of $v - f(u)$ at the final time $T$.\n- The spatial maximum norm of $v - f(u)$ at an intermediate time $t_{\\text{mid}} := \\min\\{T/2,\\,10\\,\\varepsilon\\}$.\n\nTest suite:\nUse the following list of test cases with fixed $a=1$, $c=1$, and $T=0.2$:\n*   $(\\varepsilon, N) = (1.0, 64)$: happy path with moderate stiffness.\n*   $(\\varepsilon, N) = (0.1, 64)$: increased stiffness.\n*   $(\\varepsilon, N) = (0.01, 64)$: strong stiffness.\n*   $(\\varepsilon, N) = (10^{-6}, 64)$: extreme stiffness to test asymptotic preservation.\n*   $(\\varepsilon, N) = (10^{-6}, 16)$: coarse grid edge case under extreme stiffness.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list of lists, each inner list containing three floats in the order $[\\text{error}(u;T), \\|v - f(u)\\|_{\\infty}(T), \\|v - f(u)\\|_{\\infty}(t_{\\text{mid}})]$. For example: `[[e1, rT1, rM1], [e2, rT2, rM2], ...]`.\n- No physical units are involved, and angles are not used. All reported values must be floats (decimal numbers).\n\nYour implementation must be a complete, runnable program in the specified environment, with no user input or external files. Adhere to the requirements on libraries and output format.",
            "solution": "The problem is well-posed and represents a standard validation exercise for asymptotic-preserving (AP) numerical schemes applied to hyperbolic relaxation systems. We will first design the specified Implicit-Explicit (IMEX) scheme and then implement it to verify its properties.\n\n### 1. Model System and Characteristic Variables\n\nThe given system is a linear hyperbolic relaxation model:\n$$\n\\begin{cases}\n\\partial_t u + \\partial_x v = 0 \\\\\n\\partial_t v + a^2 \\partial_x u = -\\frac{1}{\\varepsilon}\\left(v - f(u)\\right)\n\\end{cases}\n$$\nwhere $f(u) = c u$. In vector form, let $\\mathbf{U} = [u, v]^T$. The system is $\\partial_t \\mathbf{U} + \\mathbf{A} \\partial_x \\mathbf{U} = \\mathbf{S}(\\mathbf{U})$, with the advection matrix $\\mathbf{A}$ and source term $\\mathbf{S}(\\mathbf{U})$ given by:\n$$\n\\mathbf{A} = \\begin{pmatrix} 0 & 1 \\\\ a^2 & 0 \\end{pmatrix}, \\quad \\mathbf{S}(\\mathbf{U}) = \\begin{pmatrix} 0 \\\\ -\\frac{1}{\\varepsilon}(v - cu) \\end{pmatrix}\n$$\nThe hyperbolic nature is determined by the matrix $\\mathbf{A}$, which has real, distinct eigenvalues $\\lambda^{\\pm} = \\pm a$. The corresponding left eigenvectors are $l^{\\pm} = [a, \\pm 1]$. We can define characteristic variables $w^{\\pm} = l^{\\pm} \\cdot \\mathbf{U} = a u \\pm v$. These variables diagonalize the advection part of the system, leading to two uncoupled advection equations:\n$$\n\\partial_t w^{\\pm} \\pm a \\partial_x w^{\\pm} = \\text{source\\_term\\_projection}\n$$\nThe original variables can be recovered from the characteristic variables:\n$$\nu = \\frac{w^+ + w^-}{2a}, \\quad v = \\frac{w^+ - w^-}{2}\n$$\n\n### 2. IMEX Asymptotic-Preserving Scheme Design\n\nThe problem requires an IMEX scheme based on operator splitting. In one time step from $t_n$ to $t_{n+1} = t_n + \\Delta t$, we first solve the homogeneous transport part explicitly and then solve the relaxation part implicitly.\n\n**Step 2.1: Explicit Transport Step**\n\nWe first advance the solution under the action of the transport operator $\\partial_t \\mathbf{U} + \\mathbf{A} \\partial_x \\mathbf{U} = 0$ over a time step $\\Delta t$. This is most easily done in characteristic variables, where the system decouples into two scalar advection equations:\n$$\n\\begin{cases}\n\\partial_t w^+ + a \\partial_x w^+ = 0 \\\\\n\\partial_t w^- - a \\partial_x w^- = 0\n\\end{cases}\n$$\nWe discretize these using a first-order upwind method. Let $U_j^n = (u_j^n, v_j^n)$ be the numerical solution at grid point $x_j$ and time $t_n$.\n\n1.  **Transform to characteristics**: For each grid point $j$, compute the characteristic variables $w_j^{\\pm, n} = a u_j^n \\pm v_j^n$.\n2.  **Upwind advection**: Since $a > 0$, $w^+$ propagates to the right (information comes from the left), and $w^-$ propagates to the left (information comes from the right). The first-order upwind discretizations are:\n    $$\n    w_j^{+,*} = w_j^{+,n} - \\frac{a \\Delta t}{\\Delta x} (w_j^{+,n} - w_{j-1}^{+,n})\n    $$\n    $$\n    w_j^{-,*} = w_j^{-,n} + \\frac{a \\Delta t}{\\Delta x} (w_{j+1}^{-,n} - w_j^{-,n})\n    $$\n    Here, $w_j^{\\pm,*}$ are the intermediate values after the transport step. Indices are handled periodically. Let $\\nu_a = a \\Delta t / \\Delta x$ be the Courant number for the characteristic speeds.\n3.  **Transform back**: Recover the intermediate physical variables $(u_j^*, v_j^*)$ from $(w_j^{+,*}, w_j^{-,*})$:\n    $$\n    u_j^* = \\frac{w_j^{+,*} + w_j^{-,*}}{2a}, \\quad v_j^* = \\frac{w_j^{+,*} - w_j^{-,*}}{2}\n    $$\n\n**Step 2.2: Implicit Relaxation Step**\n\nNext, we solve the relaxation ODE system $\\partial_t \\mathbf{U} = \\mathbf{S}(\\mathbf{U})$ over $\\Delta t$, using $(u_j^*, v_j^*)$ as the initial condition to find the final values $(u_j^{n+1}, v_j^{n+1})$.\n$$\n\\begin{cases}\n\\partial_t u = 0 \\\\\n\\partial_t v = -\\frac{1}{\\varepsilon}(v-cu)\n\\end{cases}\n$$\nThe equation for $u$ implies $u$ is constant during this step, so $u_j^{n+1} = u_j^*$. For the $v$ equation, we use the backward (implicit) Euler method to ensure stability for small $\\varepsilon$:\n$$\n\\frac{v_j^{n+1} - v_j^*}{\\Delta t} = -\\frac{1}{\\varepsilon}(v_j^{n+1} - c u_j^{n+1})\n$$\nSubstituting $u_j^{n+1} = u_j^*$ and solving for $v_j^{n+1}$:\n$$\nv_j^{n+1} - v_j^* = -\\frac{\\Delta t}{\\varepsilon}v_j^{n+1} + \\frac{c \\Delta t}{\\varepsilon}u_j^*\n$$\n$$\nv_j^{n+1} \\left(1 + \\frac{\\Delta t}{\\varepsilon}\\right) = v_j^* + \\frac{c \\Delta t}{\\varepsilon}u_j^*\n$$\n$$\nv_j^{n+1} = \\frac{v_j^* + \\frac{c \\Delta t}{\\varepsilon}u_j^*}{1 + \\frac{\\Delta t}{\\varepsilon}} = \\frac{\\varepsilon v_j^* + c \\Delta t u_j^*}{\\varepsilon + \\Delta t}\n$$\nThis completes the update from $t_n$ to $t_{n+1}$. The time step $\\Delta t$ is constrained only by the CFL condition for the explicit transport part, $\\nu_a = a \\Delta t / \\Delta x \\le 1$, and not by $\\varepsilon$.\n\n### 3. Asymptotic Preservation Property\n\nAn AP scheme, when applied to the stiff system with $\\varepsilon \\ll 1$, should become a consistent and stable discretization of the limit system. As $\\varepsilon \\to 0$, the relaxation step yields:\n$$\nv_j^{n+1} \\to \\frac{c \\Delta t u_j^*}{\\Delta t} = c u_j^*\n$$\nSince $u_j^{n+1} = u_j^*$, this limit implies $v_j^{n+1} \\to c u_j^{n+1}$, which is a discrete version of the equilibrium condition $v = f(u)$. The scheme correctly captures the relaxed state. Substituting this into the full scheme shows that it provides a stable, first-order accurate discretization for the limit advection equation $\\partial_t u + c \\partial_x u = 0$.\n\n### 4. Implementation Details\n\nWe implement the scheme as described above.\n- **Grid and Time**: A uniform spatial grid $x_j = j \\Delta x$ with $\\Delta x = 1/N$ is used. The time step $\\Delta t$ is calculated based on the CFL number $\\lambda = 1/2$ to ensure stability and an integer number of steps to reach the final time $T$.\n- **Initial Data**: $u(x,0)=\\sin(2\\pi x)$ and $v(x,0)=c \\sin(2\\pi x)$.\n- **Diagnostics**:\n    - The relative discrete $L^2$ error in $u$ at $T$ is computed as $\\|u_{num} - u_{exact}\\|_2 / \\|u_{exact}\\|_2$, where $u_{exact}(x,T) = \\sin(2\\pi(x-cT))$, and the norm is the standard vector 2-norm.\n    - The relaxation residual $\\|v - cu\\|_{\\infty}$ is computed as the maximum absolute value of $(v_j - c u_j)$ over all grid points $j$. This is evaluated at the final time $T$ and a specified intermediate time $t_{\\text{mid}} = \\min(T/2, 10\\varepsilon)$.\nThe following code implements this procedure for the given test suite.",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Implements and tests an IMEX Asymptotic-Preserving scheme for a hyperbolic\n    relaxation system.\n    \"\"\"\n    \n    # Fixed parameters for all test cases\n    a = 1.0\n    c = 1.0\n    T = 0.2\n    cfl_lambda = 0.5\n    \n    # Test cases: (epsilon, N)\n    test_cases = [\n        (1.0, 64),\n        (0.1, 64),\n        (0.01, 64),\n        (1e-6, 64),\n        (1e-6, 16)\n    ]\n    \n    all_results = []\n    \n    for eps, N in test_cases:\n        # 1. Setup Grid and Time Step\n        dx = 1.0 / N\n        x = np.linspace(0, 1.0 - dx, N)\n        \n        # Calculate time step based on CFL condition\n        dt_cfl = cfl_lambda * dx / a\n        num_steps = math.ceil(T / dt_cfl)\n        dt = T / num_steps\n        \n        # 2. Initial Conditions\n        u = np.sin(2 * np.pi * x)\n        v = c * np.sin(2 * np.pi * x)\n        \n        # 3. Time Marching Loop\n        t_mid = min(T / 2.0, 10.0 * eps)\n        res_mid = None\n        res_mid_found = False\n        \n        # The Courant number for the upwind scheme\n        nu_a = a * dt / dx\n\n        for n in range(num_steps):\n            # Step 2.1: Explicit Transport Step\n            # (a) Convert to characteristic variables\n            w_p = a * u + v\n            w_m = a * u - v\n            \n            # (b) Upwind advection using np.roll for periodic BCs\n            w_p_star = w_p - nu_a * (w_p - np.roll(w_p, 1))\n            w_m_star = w_m + nu_a * (np.roll(w_m, -1) - w_m)\n            \n            # (c) Convert back to physical variables\n            u_star = (w_p_star + w_m_star) / (2.0 * a)\n            v_star = (w_p_star - w_m_star) / 2.0\n            \n            # Step 2.2: Implicit Relaxation Step\n            # u is unchanged in this step\n            u_next = u_star\n            # v is updated implicitly\n            v_next = (eps * v_star + c * dt * u_star) / (eps + dt)\n            \n            u, v = u_next, v_next\n            \n            # Check for intermediate time residual\n            current_time = (n + 1) * dt\n            if not res_mid_found and current_time >= t_mid:\n                res_mid = np.max(np.abs(v - c * u))\n                res_mid_found = True\n\n        # If t_mid was never reached (e.g., T is very small)\n        if not res_mid_found:\n            res_mid = np.max(np.abs(v - c * u))\n\n        # 4. Compute Final diagnostics\n        # (a) Final L2 error in u\n        u_exact_T = np.sin(2 * np.pi * (x - c * T))\n        error_u_T = np.linalg.norm(u - u_exact_T) / np.linalg.norm(u_exact_T)\n        \n        # (b) Final max norm of residual\n        res_T = np.max(np.abs(v - c * u))\n        \n        all_results.append([error_u_T, res_T, res_mid])\n        \n    # Format and print the final output\n    print(all_results)\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}