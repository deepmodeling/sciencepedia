{
    "hands_on_practices": [
        {
            "introduction": "设计渐近保持 (AP) 格式的第一步是理解其目标渐近极限。本练习  探讨了刚性弛豫系统的核心概念——慢流形。掌握如何确定慢流形，对于理解系统在刚性极限下的行为以及为何需要AP格式至关重要。",
            "id": "3733745",
            "problem": "考虑刚性源偏微分方程 (PDE) $u_t + a\\,u_x = \\frac{1}{\\varepsilon} S(u)$，其中 $u(x,t) \\in \\mathbb{R}^2$，$u = (w,v)^{\\top}$，$a \\in \\mathbb{R}^2$ 为常数。假设 $S(u)$ 是光滑的，并表示向一个低维吸引集的快速松弛，因此当 $\\varepsilon \\to 0$ 时，预计会出现一个降阶的慢动力学，这一设定与渐近保持 (Asymptotic-Preserving, AP) 格式的设计相关，AP格式是一种在尺度分离参数趋于零的极限下，仍能保持稳定并与降阶模型一致的数值方法。\n\n从具有快速松弛和双曲输运的动力系统的奇异摄动理论的基本原理出发，构建源项 $S(u)$ 需满足的条件，以确保该偏微分方程存在一个良定义的、常态双曲的、吸引的慢流形。然后，对于特定的选择\n$$\nS(u) = \\begin{pmatrix}\n0 \\\\\n-\\lambda\\big(v - \\alpha w - \\beta w^3\\big)\n\\end{pmatrix},\n$$\n其中常数 $\\lambda > 0$，$\\alpha \\in \\mathbb{R}$，$\\beta \\in \\mathbb{R}$，确定慢流形映射 $v = h(w)$ 的主阶形式，该形式能够捕捉刚性松弛动力学在 $\\varepsilon \\to 0$ 时的极限行为。你的最终答案必须是 $h(w)$ 的闭式解析表达式（不包含任何等号）。不需要进行数值舍入。",
            "solution": "所考虑的偏微分方程为\n$$\nu_t + a\\,u_x = \\frac{1}{\\varepsilon} S(u),\n$$\n其中 $u = (w,v)^{\\top}$，$a = (a_w, a_v)^{\\top}$。在奇异极限 $\\varepsilon \\to 0$下，项 $\\frac{1}{\\varepsilon} S(u)$ 占主导地位，并驱使解迅速趋向于集合 $S(u) = 0$。为确保存在一个（在主阶上）不变且吸引的良定义慢流形，我们援引具有快速松弛和输运的系统的经典奇异摄动理论，以及常态双曲不变流形的概念。\n\n所使用的关键基本事实是：\n- 在刚性松弛系统中，快动力学由常微分方程（在快时间尺度上）$u_{\\tau} = S(u)$ 控制，其中 $\\tau = t/\\varepsilon$。如果 $S(u)$ 的平衡点集构成一个光滑流形，并且 $S$ 在横截于该流形的方向上的线性化具有严格负实部的特征值，那么该流形是常态双曲且吸引的。\n- 对于带输运的偏微分方程，只要输运不足以破坏常态双曲性（例如，在主阶上输运切向作用，或在快时间尺度上是低阶项），慢流形就会持续存在，解会迅速趋近它；此后，动力学投影到流形上，并根据降阶（慢）方程演化。\n\n因此，$S(u)$ 存在良定义慢流形的充分条件是：\n1. 零点集 $\\{u : S(u) = 0\\}$ 是一个光滑流形，其维数等于慢变量的个数（此处为一维，由 $w$ 参数化）。\n2. 雅可比矩阵 $\\mathrm{D}S(u)$ 在流形上限制在横截方向上时，其特征值对于流形上的 $u$ 一致地具有严格为负的实部（常态双曲性和吸引性）。\n3. 源项 $S(u)$ 足够光滑（例如，在感兴趣的域内连续可微且导数有界），从而保证流形是光滑的，并且到流形上的投影是良定义的。\n4. 输运项 $a\\,u_x$ 在快时间尺度的主阶上不改变快速稳定性机制，这一点在刚性源占主导地位且作用于流形的横截方向时得到保证，从而确保在输运显著扰动状态之前，系统能快速松弛到流形上。\n\n对于特定源项\n$$\nS(u) = \\begin{pmatrix}\n0 \\\\\n-\\lambda\\big(v - \\alpha w - \\beta w^3\\big)\n\\end{pmatrix},\n$$\n我们分析其快动力学。平衡点集由 $S(u)=0$ 给出，即\n$$\n0 = -\\lambda\\big(v - \\alpha w - \\beta w^3\\big) \\quad \\Rightarrow \\quad v = \\alpha w + \\beta w^3.\n$$\n该集合是一个由 $w$ 参数化的光滑一维流形。$S(u)$ 关于 $u$ 的雅可比矩阵为\n$$\n\\mathrm{D}S(u) = \\begin{pmatrix}\n0  & 0 \\\\\n-\\lambda(\\alpha + 3\\beta w^2) & -\\lambda\n\\end{pmatrix}.\n$$\n在流形的横截方向（$v$ 方向）上，特征值为 $-\\lambda$，当 $\\lambda > 0$ 时，该值严格为负，确保了向流形的指数吸引。因此，上述条件得到满足：该流形是光滑、常态双曲且吸引的。\n\n为了得到当 $\\varepsilon \\to 0$ 时慢流形映射 $v = h(w)$ 的主阶形式，我们考虑渐近展开 $u = u^{(0)} + \\varepsilon u^{(1)} + \\cdots$。在主阶 $\\mathcal{O}(1/\\varepsilon)$，平衡关系为 $S(u^{(0)}) = 0$，这意味着\n$$\nv^{(0)} = \\alpha w^{(0)} + \\beta \\big(w^{(0)}\\big)^3.\n$$\n因此，主阶慢流形由 $v = h(w)$ 给出，其中\n$$\nh(w) = \\alpha w + \\beta w^3.\n$$\n$\\varepsilon$ 的高阶修正项将涉及输运和耦合效应，但在主阶上，慢流形与源项的平衡点集重合。这种形式是 AP 格式在 $\\varepsilon \\to 0$ 时应该保持的形式，从而确保与降阶模型的一致性。\n\n因此，所要求的主阶慢流形映射的最终表达式为 $h(w) = \\alpha w + \\beta w^3$，根据指示，我们在最终答案中提供不带等号的表达式。",
            "answer": "$$\\boxed{\\alpha w + \\beta w^{3}}$$"
        },
        {
            "introduction": "理解了连续极限后，下一步是设计一个在离散层面同样能“保持”该极限的数值格式。本练习  将指导你为一个在扩散尺度下的动理学模型构建一个渐近保持格式。通过应用半隐式有限体积法，你将亲手推导出一个在刚性极限下能够正确演化为离散扩散方程的格式，从而掌握AP格式设计的核心技术。",
            "id": "3733720",
            "problem": "考虑一个在一维空间域 $[0,L]$ 上的、具有周期性边界条件的线性输运模型，该模型处于扩散尺度下。动力学未知数 $f(t,x,v)$ 依赖于时间 $t$、空间 $x$ 以及具有相等权重的离散速度 $v \\in \\{-1,1\\}$。通过 $\\rho = (f(t,x,1)+f(t,x,-1))/2$ 和 $j = (f(t,x,1)-f(t,x,-1))/(2\\varepsilon)$ 定义奇偶变量 $\\rho(t,x)$ 和 $j(t,x)$，其中 $\\varepsilon > 0$ 是尺度参数。设碰撞频率为一个在均匀网格上分段常数的严格正函数 $\\sigma(x)$。在各向同性散射的标准假设下，从输运模型导出的奇偶系统为\n$$\n\\partial_t \\rho + \\partial_x j = 0, \\qquad \\varepsilon^{2}\\,\\partial_t j + \\partial_x \\rho = -\\sigma(x)\\,j.\n$$\n当 $\\varepsilon \\to 0$ 时的形式扩散极限为 $\\partial_t \\rho - \\partial_x\\!\\left(D(x)\\,\\partial_x \\rho\\right)=0$，其中 $D(x) = 1/\\sigma(x)$。您的任务是构建一个保守的、渐近保持（Asymptotic-Preserving, AP）的有限体积格式，这意味着当 $\\varepsilon \\to 0$ 时，该格式保持稳定和相容，并能恢复出一个关于 $\\rho$ 的离散扩散方程。使用一个均匀网格，其单元中心为 $x_i$，间距为 $\\Delta x$，并用 $\\rho_i^n$ 和 $j_i^n$ 表示在时间 $t^n$ 的单元平均值。假设对刚性源项采用时间上一阶的半隐式离散，对非刚性项采用相容的中心近似：\n- 在 $\\rho$ 方程中，用界面上的数值通量 $J_{i+1/2}$ 来近似 $\\partial_x j$，并与局部守恒相容。\n- 在 $j$ 方程中，隐式处理弛豫项 $-\\sigma(x)\\,j$，并使用界面值 $\\rho_{i\\pm 1/2}$，在单元中心处用中心差分来近似 $\\partial_x \\rho$。\n\n从这些原则和给定的方程出发，推导出 $\\varepsilon \\to 0$ 的离散极限，并证明该格式能得到一个关于 $\\rho_i^{n+1}$ 的扩散有限体积更新，其界面通量 $F_{i+1/2}^{\\mathrm{diff}}$ 与连续极限相容。请仅用 $\\rho_{i}$、$\\rho_{i+1}$、$\\Delta x$ 以及与单元 $i$ 和 $i+1$ 相关联的分段常数碰撞频率 $\\sigma_i$ 和 $\\sigma_{i+1}$ 来表示 $F_{i+1/2}^{\\mathrm{diff}}$。请给出在 $\\varepsilon \\to 0$ 极限下，由您的构造产生的 $F_{i+1/2}^{\\mathrm{diff}}$ 的封闭形式解析表达式，并证明其与连续扩散通量 $-D(x)\\,\\partial_x \\rho$ 的相容性。\n\n最终答案必须是 $F_{i+1/2}^{\\mathrm{diff}}$ 的单一解析表达式。无需四舍五入，也无需物理单位。在您使用的任何缩略词首次出现时，请对其进行定义，例如渐近保持（Asymptotic-Preserving, AP）和有限体积（Finite Volume, FV）。",
            "solution": "首先将根据指定标准对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n明确提供的信息如下：\n- **控制方程**：在域 $[0,L]$ 上，关于 $\\rho(t,x)$ 和 $j(t,x)$ 的奇偶系统由下式给出：\n$$\n\\partial_t \\rho + \\partial_x j = 0\n$$\n$$\n\\varepsilon^{2}\\,\\partial_t j + \\partial_x \\rho = -\\sigma(x)\\,j\n$$\n- **定义**：\n  - $\\rho = (f(t,x,1)+f(t,x,-1))/2$\n  - $j = (f(t,x,1)-f(t,x,-1))/(2\\varepsilon)$\n- **参数和函数**：\n  - $\\varepsilon > 0$ 是尺度参数。\n  - $\\sigma(x) > 0$ 是一个在均匀网格上分段常数的碰撞频率。\n- **形式极限**：当 $\\varepsilon \\to 0$ 时，该系统形式上收敛于扩散方程 $\\partial_t \\rho - \\partial_x(D(x)\\,\\partial_x \\rho)=0$，扩散系数为 $D(x) = 1/\\sigma(x)$。\n- **离散化设置**：\n  - 一个均匀网格，其单元中心为 $x_i$，间距为 $\\Delta x$。\n  - 在时间 $t^n$ 的单元平均值表示为 $\\rho_i^n$ 和 $j_i^n$。\n- **离散化指令**：\n  1. 所得格式必须是守恒的且是渐近保持（AP）的。\n  2. 使用时间上一阶的半隐式离散。\n  3. 对于 $\\rho$ 方程，使用有限体积（FV）方法，其中 $\\partial_x j$ 由单元界面上的数值通量 $J_{i+1/2}$ 近似。\n  4. 对于 $j$ 方程，隐式处理弛豫项 $-\\sigma(x)\\,j$。\n  5. 对于 $j$ 方程，使用界面值，在单元中心处用中心差分近似 $\\partial_x \\rho$。\n\n### 步骤2：使用提取的已知条件进行验证\n根据既定标准对问题进行评估：\n- **科学依据**：该问题描述了一个在扩散尺度下的标准简化动力学模型（一维、双速离散纵标模型）。关于偶宇称和奇宇称分量（$\\rho$ 和 $j$）的方程组是输运理论中的一个经典结果。扩散极限被正确陈述。整个设置是动力学方程和多尺度建模数值分析领域中一个成熟的课题。它在科学上是合理的。\n- **适定性**：该问题要求基于一组清晰的指令推导出一个数值格式，并分析其渐近极限。目标是找到极限数值通量的一个特定解析表达式。这是一个定义明确的数学任务，具有唯一的预期结果。\n- **客观性**：语言精确，没有主观论断。关于离散化的指令，尽管存在简明问题陈述中典型的微小模糊性（关于 $j$ 方程离散化的确切位置），但它指向一种标准且合理的构建方法（交错网格方法）。\n- **完整性**：为执行所需的推导，提供了所有必要的方程、定义和约束。\n- **其他标准**：该问题不违反任何其他有效性标准。它是应用数学中一个形式化的、非平凡的且可验证的练习。\n\n### 步骤3：结论与行动\n问题有效。将提供一个完整、合理的解答。\n\n### 解答推导\n目标是为给定系统构建一个渐近保持（AP）的有限体积（FV）格式，并推导在扩散极限（$\\varepsilon \\to 0$）下的数值通量表达式。\n\n控制系统为：\n$$\n\\partial_t \\rho + \\partial_x j = 0 \\\\\n\\varepsilon^{2}\\,\\partial_t j + \\partial_x \\rho = -\\sigma(x)\\,j\n$$\n\n我们首先使用有限体积方法离散化第一个方程，这是一个守恒律。我们在宽度为 $\\Delta x$ 的单元 $[x_{i-1/2}, x_{i+1/2}]$ 上进行积分：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\partial_t \\rho(t,x) \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\partial_x j(t,x) \\,dx = 0\n$$\n令 $\\rho_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\rho(t,x) \\,dx$ 为单元平均值。方程变为：\n$$\n\\Delta x \\frac{d\\rho_i}{dt} + j(t, x_{i+1/2}) - j(t, x_{i-1/2}) = 0\n$$\n引入数值通量 $J_{i\\pm 1/2}(t)$ 来近似流 $j$ 在单元界面上的点值，我们得到：\n$$\n\\frac{d\\rho_i}{dt} + \\frac{J_{i+1/2} - J_{i-1/2}}{\\Delta x} = 0\n$$\n为了确保在扩散极限下的稳定性，我们使用一阶隐式时间离散，并在时间层 $n+1$ 处计算通量：\n$$\n\\frac{\\rho_i^{n+1} - \\rho_i^n}{\\Delta t} + \\frac{J_{i+1/2}^{n+1} - J_{i-1/2}^{n+1}}{\\Delta x} = 0\n$$\n这是对 $\\rho_i$ 的一个守恒更新。为了继续，我们需要数值通量 $J_{i+1/2}^{n+1}$ 的表达式。这通过离散化第二个控制方程得到。对于此类系统，一个标准且相容的方法是在交错网格上定义通量，即在单元界面 $x_{i+1/2}$ 处对方程进行计算。\n\n第二个方程是：$\\varepsilon^{2}\\,\\partial_t j + \\partial_x \\rho = -\\sigma(x)\\,j$。我们在时间 $t^{n+1}$，在界面 $x_{i+1/2}$ 处对其进行离散化。\n- 时间导数 $\\partial_t j$ 由一阶差分近似：$\\frac{J_{i+1/2}^{n+1} - J_{i+1/2}^n}{\\Delta t}$。\n- 空间导数 $\\partial_x \\rho$ 由中心有限差分近似：$\\frac{\\rho_{i+1} - \\rho_i}{\\Delta x}$。对于半隐式格式，这个非刚性项通常在时间 $t^n$ 显式计算。\n- 刚性弛豫项 $-\\sigma j$ 按照指令在时间 $t^{n+1}$ 隐式计算：$-\\sigma_{i+1/2} J_{i+1/2}^{n+1}$。\n- 由于 $\\sigma(x)$ 是分段常数，在单元 $i$ 中 $\\sigma(x)=\\sigma_i$，其在界面 $x_{i+1/2}$ 处的值是不明确的。能够正确恢复跨材料界面扩散物理现象的选择是算术平均值：$\\sigma_{i+1/2} = \\frac{\\sigma_i + \\sigma_{i+1}}{2}$。\n\n结合这些近似，在界面 $x_{i+1/2}$ 处对 $j$ 方程的半隐式离散为：\n$$\n\\varepsilon^2 \\left(\\frac{J_{i+1/2}^{n+1} - J_{i+1/2}^n}{\\Delta t}\\right) + \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x} = -\\sigma_{i+1/2} J_{i+1/2}^{n+1}\n$$\n现在我们求解未知通量 $J_{i+1/2}^{n+1}$：\n$$\nJ_{i+1/2}^{n+1} \\left( \\frac{\\varepsilon^2}{\\Delta t} + \\sigma_{i+1/2} \\right) = \\frac{\\varepsilon^2}{\\Delta t} J_{i+1/2}^n - \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x}\n$$\n$$\nJ_{i+1/2}^{n+1} = \\frac{\\frac{\\varepsilon^2}{\\Delta t} J_{i+1/2}^n - \\frac{1}{\\Delta x}(\\rho_{i+1}^n - \\rho_i^n)}{\\frac{\\varepsilon^2}{\\Delta t} + \\sigma_{i+1/2}} = \\frac{\\varepsilon^2 J_{i+1/2}^n - \\frac{\\Delta t}{\\Delta x}(\\rho_{i+1}^n - \\rho_i^n)}{\\varepsilon^2 + \\Delta t \\, \\sigma_{i+1/2}}\n$$\n这个表达式定义了对于任意 $\\varepsilon > 0$ 值的数值通量。该格式是 AP 的，因为它为动力学区（$\\varepsilon \\sim O(1)$）和扩散区（$\\varepsilon \\to 0$）都提供了稳定且相容的近似。\n\n为了找到离散扩散极限，我们取通量表达式在 $\\varepsilon \\to 0$ 时的形式极限。问题将此极限通量记为 $F_{i+1/2}^{\\mathrm{diff}}$。\n$$\nF_{i+1/2}^{\\mathrm{diff}} = \\lim_{\\varepsilon \\to 0} J_{i+1/2}^{n+1} = \\frac{0 \\cdot J_{i+1/2}^n - \\frac{\\Delta t}{\\Delta x}(\\rho_{i+1}^n - \\rho_i^n)}{0 + \\Delta t \\, \\sigma_{i+1/2}}\n$$\n$$\nF_{i+1/2}^{\\mathrm{diff}} = - \\frac{1}{\\sigma_{i+1/2}} \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x}\n$$\n代入界面碰撞频率的表达式 $\\sigma_{i+1/2} = \\frac{\\sigma_i + \\sigma_{i+1}}{2}$：\n$$\nF_{i+1/2}^{\\mathrm{diff}} = - \\frac{1}{\\frac{\\sigma_i + \\sigma_{i+1}}{2}} \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x} = - \\frac{2}{\\sigma_i + \\sigma_{i+1}} \\frac{\\rho_{i+1}^n - \\rho_i^n}{\\Delta x}\n$$\n问题要求用不带时间索引的变量表示该表达式，因此我们去掉上标 $n$：\n$$\nF_{i+1/2}^{\\mathrm{diff}} = - \\frac{2 (\\rho_{i+1} - \\rho_i)}{(\\sigma_i + \\sigma_{i+1}) \\Delta x}\n$$\n为了验证相容性，我们注意到连续扩散通量为 $F_{\\mathrm{diff}} = -D(x) \\partial_x \\rho = - \\frac{1}{\\sigma(x)} \\partial_x \\rho$。我们的离散通量形式为 $F_{i+1/2}^{\\mathrm{diff}} = -D_{i+1/2} \\frac{\\rho_{i+1} - \\rho_i}{\\Delta x}$，其中数值扩散系数为 $D_{i+1/2} = \\frac{2}{\\sigma_i + \\sigma_{i+1}}$。\n单元扩散系数分别为 $D_i = 1/\\sigma_i$ 和 $D_{i+1} = 1/\\sigma_{i+1}$。这两个系数的调和平均值为：\n$$\n\\frac{2 D_i D_{i+1}}{D_i + D_{i+1}} = \\frac{2 (1/\\sigma_i)(1/\\sigma_{i+1})}{1/\\sigma_i + 1/\\sigma_{i+1}} = \\frac{2/(\\sigma_i\\sigma_{i+1})}{(\\sigma_i+\\sigma_{i+1})/(\\sigma_i\\sigma_{i+1})} = \\frac{2}{\\sigma_i + \\sigma_{i+1}}\n$$\n这与我们推导出的数值扩散系数 $D_{i+1/2}$ 相匹配。对于具有分段常数系数的稳态一维扩散问题，使用扩散系数的调和平均值是正确的物理和数学表示。因此，推导出的格式在 $\\varepsilon \\to 0$ 极限下正确地恢复了扩散方程的一个相容离散化。\n\n最终答案是 $F_{i+1/2}^{\\mathrm{diff}}$ 的封闭形式解析表达式。",
            "answer": "$$\n\\boxed{- \\frac{2 (\\rho_{i+1} - \\rho_i)}{(\\sigma_i + \\sigma_{i+1}) \\Delta x}}\n$$"
        },
        {
            "introduction": "理论与设计是基础，但数值格式的最终检验在于其实际表现。一个优秀的AP格式应该在数值实验中展示出其关键特性：其精度对于刚性参数 $\\varepsilon$ 是一致有界的。本练习  是一个动手编程任务，你将实现一个为双曲弛豫系统设计的IMEX-AP格式，并通过数值实验来验证其渐近保持特性，直观地感受理论在实践中的力量。",
            "id": "3733743",
            "problem": "考虑周期性区域 $x \\in [0,1]$ 上的双曲松弛系统，其初始数据和参数的选择满足次特征条件：\n$$\n\\begin{cases}\n\\partial_t u + \\partial_x v = 0,\\\\\n\\partial_t v + a^2 \\partial_x u = -\\dfrac{1}{\\varepsilon}\\left(v - f(u)\\right),\n\\end{cases}\n$$\n其中 $f(u) = c\\,u$，常数 $a>0$ 和 $c$ 满足 $|c| \\le a$，且 $\\varepsilon > 0$ 是一个刚性参数。设 $u(x,0) = \\sin(2\\pi x)$ 且 $v(x,0) = f(u(x,0)) = c\\,\\sin(2\\pi x)$。周期性边界条件意味着所有空间导数都通过在 $x \\in [0,1]$ 上的周期性索引来计算。\n\n基本原理：\n- 该系统是一个标准的双曲松弛模型。在 $\\varepsilon \\to 0$ 的极限情况下，松弛项迫使 $v \\to f(u)$，而 $u$ 的极限方程变为标量守恒律 $\\partial_t u + \\partial_x f(u) = 0$。\n- 对于线性通量 $f(u) = c\\,u$ 且 $|c| \\le a$，次特征条件确保了松弛系统的适定性和稳定性。极限方程是线性平流方程 $\\partial_t u + c\\,\\partial_x u = 0$，在给定的初始数据下，其精确解为 $u(x,t) = \\sin(2\\pi(x - c t))$。\n\n任务：\n1. 设计一个满足以下条件的隐式-显式 (IMEX) 渐近保持 (AP) 格式：\n   - 使用相容的一阶迎风方法，沿特征变量显式处理双曲输运项。\n   - 隐式处理刚性松弛项，从而使时间步长限制不依赖于 $\\varepsilon$。\n   - 使用具有 $N$ 个单元的均匀空间网格和时间步长 $\\Delta t$，该时间步长满足基于特征速度 $a$ 的标准 Courant–Friedrichs–Lewy (CFL) 条件，即 $\\Delta t \\le \\lambda \\,\\Delta x / a$，其中 Courant 数 $\\lambda \\in (0,1)$ 为固定值，且 $\\Delta x = 1/N$。\n2. 在区域 $[0,1]$ 上实现该格式，使用周期性边界条件和给定的初始数据，并将解推进到最终时刻 $T$。\n3. 数值验证渐近保持格式的两个性质：\n   - 中间状态松弛：即 $v$ 松弛到 $f(u)$，通过在中间时刻和最终时刻计算残差 $r(x,t) = v(x,t) - f(u(x,t))$ 的空间最大范数来量化。\n   - 关于 $\\varepsilon$ 的一致误差有界性：即在时刻 $T$，$u$ 与极限方程精确解的误差关于 $\\varepsilon$ 是一致有界的。使用相对离散 $L^2$ 误差 $\\|u^{\\text{num}}(\\cdot,T) - u^{\\text{exact}}(\\cdot,T)\\|_{2} / \\|u^{\\text{exact}}(\\cdot,T)\\|_{2}$ 进行衡量，其中 $u^{\\text{exact}}(x,T) = \\sin(2\\pi(x - c T))$。\n\n实现要求：\n- 对显式输运部分，使用特征变量 $w^{\\pm} = a\\,u \\pm v$，沿速度 $\\pm a$ 进行一阶迎风更新，并对通量使用周期性索引。\n- 对刚性松弛使用隐式步骤来更新 $v$，从而避免依赖于 $\\varepsilon$ 的时间步长约束，而 $u$ 没有松弛源项。\n- 选择 Courant 数 $\\lambda = 1/2$，并重新计算 $\\Delta t$，以确保通过整数步数达到 $T$（即，使用 $M = \\lceil T / \\Delta t \\rceil$ 步，并重置 $\\Delta t = T/M$）。\n\n每个测试案例需报告的量：\n- 时刻 $T$ 时 $u$ 的相对离散 $L^2$ 误差。\n- 最终时刻 $T$ 时 $v - f(u)$ 的空间最大范数（离散 $\\ell^\\infty$）。\n- 中间时刻 $t_{\\text{mid}} := \\min\\{T/2,\\,10\\,\\varepsilon\\}$ 时 $v - f(u)$ 的空间最大范数。\n\n测试套件：\n使用以下测试案例列表 $(\\varepsilon, N)$，固定参数为 $a=1$，$c=1$，$T=0.2$：\n- $(\\varepsilon, N) = (1.0, 64)$：中等刚度的常规路径。\n- $(\\varepsilon, N) = (0.1, 64)$：增加的刚度。\n- $(\\varepsilon, N) = (0.01, 64)$：强刚度。\n- $(\\varepsilon, N) = (10^{-6}, 64)$：极端刚度，用于测试渐近保持性。\n- $(\\varepsilon, N) = (10^{-6}, 16)$：极端刚度下的粗网格边缘情况。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有测试案例的结果，格式为逗号分隔的列表的列表。每个内部列表包含三个浮点数，顺序为 $[\\text{error}(u;T), \\|v - f(u)\\|_{\\infty}(T), \\|v - f(u)\\|_{\\infty}(t_{\\text{mid}})]$。例如：\"[[e1,rT1,rM1],[e2,rT2,rM2],...]\"。\n- 不涉及物理单位，也不使用角度。所有报告值必须是浮点数（十进制数）。\n\n您的实现必须是在指定环境中的一个完整、可运行的程序，无用户输入或外部文件。请遵守对库和输出格式的要求。",
            "solution": "该问题是适定的，代表了将渐近保持 (AP) 数值格式应用于双曲松弛系统的一个标准验证练习。我们将首先设计指定的隐式-显式 (IMEX) 格式，然后实现它以验证其性质。\n\n### 1. 模型系统和特征变量\n\n给定的系统是一个线性双曲松弛模型：\n$$\n\\begin{cases}\n\\partial_t u + \\partial_x v = 0 \\\\\n\\partial_t v + a^2 \\partial_x u = -\\dfrac{1}{\\varepsilon}\\left(v - f(u)\\right)\n\\end{cases}\n$$\n其中 $f(u) = c u$。以向量形式表示，令 $\\mathbf{U} = [u, v]^T$。该系统为 $\\partial_t \\mathbf{U} + \\mathbf{A} \\partial_x \\mathbf{U} = \\mathbf{S}(\\mathbf{U})$，其中平流矩阵 $\\mathbf{A}$ 和源项 $\\mathbf{S}(\\mathbf{U})$ 由下式给出：\n$$\n\\mathbf{A} = \\begin{pmatrix} 0  & 1 \\\\ a^2 & 0 \\end{pmatrix}, \\quad \\mathbf{S}(\\mathbf{U}) = \\begin{pmatrix} 0 \\\\ -\\frac{1}{\\varepsilon}(v - cu) \\end{pmatrix}\n$$\n系统的双曲性由矩阵 $\\mathbf{A}$ 决定，它有实数且不相等的特征值 $\\lambda^{\\pm} = \\pm a$。对应的左特征向量为 $l^{\\pm} = [a, \\pm 1]$。我们可以定义特征变量 $w^{\\pm} = l^{\\pm} \\cdot \\mathbf{U} = a u \\pm v$。这些变量将系统的平流部分对角化，得到两个解耦的平流方程：\n$$\n\\partial_t w^{\\pm} \\pm a \\partial_x w^{\\pm} = \\text{源项投影}\n$$\n原始变量可以从特征变量中恢复：\n$$\nu = \\frac{w^+ + w^-}{2a}, \\quad v = \\frac{w^+ - w^-}{2}\n$$\n\n### 2. IMEX 渐近保持格式设计\n\n该问题要求一个基于算子分裂的 IMEX 格式。在一个从 $t_n$到 $t_{n+1} = t_n + \\Delta t$ 的时间步内，我们首先显式求解齐次输运部分，然后隐式求解松弛部分。\n\n**步骤 2.1：显式输运步骤**\n\n我们首先在输运算子 $\\partial_t \\mathbf{U} + \\mathbf{A} \\partial_x \\mathbf{U} = 0$ 的作用下，将解推进一个时间步 $\\Delta t$。这在特征变量下最容易完成，因为系统解耦为两个标量平流方程：\n$$\n\\begin{cases}\n\\partial_t w^+ + a \\partial_x w^+ = 0 \\\\\n\\partial_t w^- - a \\partial_x w^- = 0\n\\end{cases}\n$$\n我们使用一阶迎风法对这些方程进行离散化。设 $U_j^n = (u_j^n, v_j^n)$ 为网格点 $x_j$ 和时刻 $t_n$ 的数值解。\n\n1.  **变换到特征变量**：对每个网格点 $j$，计算特征变量 $w_j^{\\pm, n} = a u_j^n \\pm v_j^n$。\n2.  **迎风平流**：由于 $a > 0$，$w^+$ 向右传播（信息来自左侧），而 $w^-$ 向左传播（信息来自右侧）。一阶迎风离散格式为：\n    $$\n    w_j^{+,*} = w_j^{+,n} - \\frac{a \\Delta t}{\\Delta x} (w_j^{+,n} - w_{j-1}^{+,n})\n    $$\n    $$\n    w_j^{-,*} = w_j^{-,n} - \\frac{(-a) \\Delta t}{\\Delta x} (w_j^{-,n} - w_{j+1}^{-,n}) = w_j^{-,n} + \\frac{a \\Delta t}{\\Delta x} (w_{j+1}^{-,n} - w_j^{-,n})\n    $$\n    此处，$w_j^{\\pm,*}$ 是输运步骤后的中间值。索引按周期性处理。令 $\\nu_a = a \\Delta t / \\Delta x$ 为特征速度的 Courant 数。\n3.  **变换回原始变量**：从 $(w_j^{+,*}, w_j^{-,*})$ 恢复中间物理变量 $(u_j^*, v_j^*)$：\n    $$\n    u_j^* = \\frac{w_j^{+,*} + w_j^{-,*}}{2a}, \\quad v_j^* = \\frac{w_j^{+,*} - w_j^{-,*}}{2}\n    $$\n\n**步骤 2.2：隐式松弛步骤**\n\n接下来，我们在 $\\Delta t$ 上求解松弛常微分方程系统 $\\partial_t \\mathbf{U} = \\mathbf{S}(\\mathbf{U})$，使用 $(u_j^*, v_j^*)$ 作为初始条件来找到最终值 $(u_j^{n+1}, v_j^{n+1})$。\n$$\n\\begin{cases}\n\\partial_t u = 0 \\\\\n\\partial_t v = -\\frac{1}{\\varepsilon}(v-cu)\n\\end{cases}\n$$\n关于 $u$ 的方程意味着 $u$ 在此步骤中是常数，因此 $u_j^{n+1} = u_j^*$。对于 $v$ 的方程，我们使用后向（隐式）欧拉法以确保对于小的 $\\varepsilon$ 的稳定性：\n$$\n\\frac{v_j^{n+1} - v_j^*}{\\Delta t} = -\\frac{1}{\\varepsilon}(v_j^{n+1} - c u_j^{n+1})\n$$\n代入 $u_j^{n+1} = u_j^*$ 并求解 $v_j^{n+1}$：\n$$\nv_j^{n+1} - v_j^* = -\\frac{\\Delta t}{\\varepsilon}v_j^{n+1} + \\frac{c \\Delta t}{\\varepsilon}u_j^*\n$$\n$$\nv_j^{n+1} \\left(1 + \\frac{\\Delta t}{\\varepsilon}\\right) = v_j^* + \\frac{c \\Delta t}{\\varepsilon}u_j^*\n$$\n$$\nv_j^{n+1} = \\frac{v_j^* + \\frac{c \\Delta t}{\\varepsilon}u_j^*}{1 + \\frac{\\Delta t}{\\varepsilon}} = \\frac{\\varepsilon v_j^* + c \\Delta t u_j^*}{\\varepsilon + \\Delta t}\n$$\n这样就完成了从 $t_n$到 $t_{n+1}$ 的更新。时间步长 $\\Delta t$ 仅受显式输运部分的 CFL 条件 $\\nu_a = a \\Delta t / \\Delta x \\le 1$ 约束，而不受 $\\varepsilon$ 的约束。\n\n### 3. 渐近保持性质\n\n一个 AP 格式，当应用于 $\\varepsilon \\ll 1$ 的刚性系统时，应成为极限系统的一个相容且稳定的离散化。当 $\\varepsilon \\to 0$ 时，松弛步骤得到：\n$$\nv_j^{n+1} \\to \\frac{c \\Delta t u_j^*}{\\Delta t} = c u_j^*\n$$\n由于 $u_j^{n+1} = u_j^*$，该极限意味着 $v_j^{n+1} \\to c u_j^{n+1}$，这是平衡条件 $v = f(u)$ 的离散版本。该格式正确地捕捉了松弛态。将此代入完整的格式表明，它为极限平流方程 $\\partial_t u + c \\partial_x u = 0$ 提供了一个稳定的一阶精确离散化。\n\n### 4. 实现细节\n\n我们按照上述描述实现该格式。\n- **网格和时间**：使用均匀空间网格 $x_j = j \\Delta x$ (其中 $\\Delta x = 1/N$)。基于 CFL 数 $\\lambda = 1/2$ 计算时间步长 $\\Delta t$，以确保稳定性并以整数步数达到最终时刻 $T$。\n- **初始数据**：$u(x,0)=\\sin(2\\pi x)$ 和 $v(x,0)=c \\sin(2\\pi x)$。\n- **诊断量**：\n    - $T$ 时刻 $u$ 的相对离散 $L^2$ 误差计算为 $\\|u_{num} - u_{exact}\\|_2 / \\|u_{exact}\\|_2$，其中 $u_{exact}(x,T) = \\sin(2\\pi(x-cT))$，范数为标准向量 2-范数。\n    - 松弛残差 $\\|v - cu\\|_{\\infty}$ 计算为所有网格点 $j$ 上 $(v_j - c u_j)$ 的最大绝对值。此值在最终时刻 $T$ 和指定的中间时刻 $t_{\\text{mid}} = \\min(T/2, 10\\varepsilon)$ 进行评估。\n以下代码为给定的测试套件实现了此过程。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Implements and tests an IMEX Asymptotic-Preserving scheme for a hyperbolic\n    relaxation system.\n    \"\"\"\n    \n    # Fixed parameters for all test cases\n    a = 1.0\n    c = 1.0\n    T = 0.2\n    cfl_lambda = 0.5\n    \n    # Test cases: (epsilon, N)\n    test_cases = [\n        (1.0, 64),\n        (0.1, 64),\n        (0.01, 64),\n        (1e-6, 64),\n        (1e-6, 16)\n    ]\n    \n    all_results = []\n    \n    for eps, N in test_cases:\n        # 1. Setup Grid and Time Step\n        dx = 1.0 / N\n        x = np.linspace(0, 1.0 - dx, N)\n        \n        # Calculate time step based on CFL condition\n        dt_cfl = cfl_lambda * dx / a\n        num_steps = math.ceil(T / dt_cfl)\n        dt = T / num_steps\n        \n        # 2. Initial Conditions\n        u = np.sin(2 * np.pi * x)\n        v = c * np.sin(2 * np.pi * x)\n        \n        # 3. Time Marching Loop\n        t_mid = min(T / 2.0, 10.0 * eps)\n        res_mid = None\n        res_mid_found = False\n        \n        # The Courant number for the upwind scheme\n        nu_a = a * dt / dx\n\n        for n in range(num_steps):\n            # Step 2.1: Explicit Transport Step\n            # (a) Convert to characteristic variables\n            w_p = a * u + v\n            w_m = a * u - v\n            \n            # (b) Upwind advection using np.roll for periodic BCs\n            w_p_star = w_p - nu_a * (w_p - np.roll(w_p, 1))\n            w_m_star = w_m + nu_a * (np.roll(w_m, -1) - w_m)\n            \n            # (c) Convert back to physical variables\n            u_star = (w_p_star + w_m_star) / (2.0 * a)\n            v_star = (w_p_star - w_m_star) / 2.0\n            \n            # Step 2.2: Implicit Relaxation Step\n            # u is unchanged in this step\n            u_next = u_star\n            # v is updated implicitly\n            v_next = (eps * v_star + c * dt * u_star) / (eps + dt)\n            \n            u, v = u_next, v_next\n            \n            # Check for intermediate time residual\n            current_time = (n + 1) * dt\n            if not res_mid_found and current_time >= t_mid:\n                res_mid = np.max(np.abs(v - c * u))\n                res_mid_found = True\n\n        # If t_mid was never reached (e.g., T is very small)\n        if not res_mid_found:\n            res_mid = np.max(np.abs(v - c * u))\n\n        # 4. Compute Final diagnostics\n        # (a) Final L2 error in u\n        u_exact_T = np.sin(2 * np.pi * (x - c * T))\n        error_u_T = np.linalg.norm(u - u_exact_T) / np.linalg.norm(u_exact_T)\n        \n        # (b) Final max norm of residual\n        res_T = np.max(np.abs(v - c * u))\n        \n        all_results.append([error_u_T, res_T, res_mid])\n        \n    # Format and print the final output\n    print(all_results)\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}