{
    "hands_on_practices": [
        {
            "introduction": "Mastering the Gillespie algorithm begins with a solid grasp of its fundamental unit: a single simulation step. This exercise provides a concrete, hands-on opportunity to execute one full iteration of the algorithm for a simple gene expression network. By manually calculating propensities, the total propensity $a_0$, the waiting time $\\tau$, and selecting the next reaction, you will build the foundational intuition required for understanding more complex stochastic simulations .",
            "id": "4388732",
            "problem": "Consider a constitutive gene expression microcircuit in a single cell with two molecular species, messenger ribonucleic acid ($M$) and protein ($P$). The system is modeled as a continuous-time Markov chain governed by the Chemical Master Equation (CME) under mass-action kinetics. The Stochastic Simulation Algorithm (SSA; Gillespie algorithm) is applied. The reaction network is:\n1. $\\varnothing \\to M$ with stochastic rate constant $c_{1}$,\n2. $M \\to M + P$ with stochastic rate constant $c_{2}$,\n3. $M \\to \\varnothing$ with stochastic rate constant $c_{3}$,\n4. $P \\to \\varnothing$ with stochastic rate constant $c_{4}$.\n\nAssume the stochastic rate constants are $c_{1} = 0.05\\,\\mathrm{s}^{-1}$, $c_{2} = 0.50\\,\\mathrm{s}^{-1}$, $c_{3} = 0.10\\,\\mathrm{s}^{-1}$, and $c_{4} = 0.02\\,\\mathrm{s}^{-1}$. The initial molecular counts at time $t(0)$ are $x_{M}(0) = 3$ and $x_{P}(0) = 10$, and the initial time is $t(0) = 0\\,\\mathrm{s}$. For a single SSA iteration, use two independent uniform random variates on $(0,1)$ given by $r_{1} = \\exp(-2)$ and $r_{2} = 0.925$.\n\nStarting from the foundational definitions of propensity functions in the CME and the memoryless property of exponential waiting times governing SSA reaction times, perform one SSA iteration: compute propensities $a_{\\mu}(x)$ for $\\mu \\in \\{1,2,3,4\\}$, the total propensity $a_{0}(x)$, the waiting time $\\tau$, the index $j$ of the next reaction, and the updated time and state after firing reaction $j$. Round the waiting time and the updated time to four significant figures, and express the updated time in seconds. Provide the final numerical values for $a_{0}$, $\\tau$, $j$, the updated time $t(0)+\\tau$, and the updated state $(x_{M}, x_{P})$.",
            "solution": "The problem requires the execution of a single iteration of the Stochastic Simulation Algorithm (SSA), also known as the Gillespie algorithm, for a given gene expression network. The state of the system is described by the vector of molecular counts $x(t) = (x_{M}(t), x_{P}(t))$, where $x_{M}$ is the number of messenger RNA molecules and $x_{P}$ is the number of protein molecules.\n\nThe four chemical reactions are:\n1. $R_1: \\varnothing \\to M$\n2. $R_2: M \\to M + P$\n3. $R_3: M \\to \\varnothing$\n4. $R_4: P \\to \\varnothing$\n\nThe initial state at time $t(0) = 0\\,\\mathrm{s}$ is given as $x(0) = (x_{M}(0), x_{P}(0)) = (3, 10)$. The stochastic rate constants are $c_{1} = 0.05\\,\\mathrm{s}^{-1}$, $c_{2} = 0.50\\,\\mathrm{s}^{-1}$, $c_{3} = 0.10\\,\\mathrm{s}^{-1}$, and $c_{4} = 0.02\\,\\mathrm{s}^{-1}$.\n\nThe first step of the SSA is to calculate the propensity function $a_{\\mu}(x)$ for each reaction $\\mu \\in \\{1, 2, 3, 4\\}$. The propensity function represents the probability, per unit time, that a specific reaction occurs given the current state $x$. For mass-action kinetics, the propensities are:\n- $a_{1}(x) = c_{1}$ (zeroth-order reaction)\n- $a_{2}(x) = c_{2} x_{M}$ (first-order reaction)\n- $a_{3}(x) = c_{3} x_{M}$ (first-order reaction)\n- $a_{4}(x) = c_{4} x_{P}$ (first-order reaction)\n\nWe evaluate these propensities at the initial state $x(0) = (3, 10)$:\n- $a_{1}(x(0)) = 0.05\\,\\mathrm{s}^{-1}$\n- $a_{2}(x(0)) = (0.50\\,\\mathrm{s}^{-1})(3) = 1.50\\,\\mathrm{s}^{-1}$\n- $a_{3}(x(0)) = (0.10\\,\\mathrm{s}^{-1})(3) = 0.30\\,\\mathrm{s}^{-1}$\n- $a_{4}(x(0)) = (0.02\\,\\mathrm{s}^{-1})(10) = 0.20\\,\\mathrm{s}^{-1}$\n\nThe total propensity, $a_{0}(x)$, is the sum of the individual propensities. It represents the rate of any reaction occurring.\n$$a_{0}(x(0)) = \\sum_{\\mu=1}^{4} a_{\\mu}(x(0)) = 0.05 + 1.50 + 0.30 + 0.20 = 2.05\\,\\mathrm{s}^{-1}$$\n\nThe second step is to generate two independent random numbers, $r_{1}$ and $r_{2}$, from a uniform distribution on $(0, 1)$. These are given as $r_{1} = \\exp(-2)$ and $r_{2} = 0.925$.\n\nThe waiting time $\\tau$ until the next reaction is an exponentially distributed random variable with rate $a_{0}(x)$. The memoryless property of the exponential distribution is fundamental here. We can generate $\\tau$ using the inversion method:\n$$\\tau = \\frac{1}{a_{0}(x)} \\ln\\left(\\frac{1}{r_{1}}\\right) = -\\frac{\\ln(r_{1})}{a_{0}(x)}$$\nSubstituting the given values for $r_{1}$ and the calculated $a_{0}(x(0))$:\n$$\\tau = -\\frac{\\ln(\\exp(-2))}{2.05} = -\\frac{-2}{2.05} = \\frac{2}{2.05} \\approx 0.975609756\\,\\mathrm{s}$$\nRounding to four significant figures as required, we get $\\tau \\approx 0.9756\\,\\mathrm{s}$.\n\nThe next reaction to occur, with index $j$, is determined using the second random number $r_{2}$. The index $j$ is the smallest integer satisfying the condition:\n$$\\sum_{\\mu=1}^{j} a_{\\mu}(x) \\ge r_{2} \\cdot a_{0}(x)$$\nFirst, we compute the target value:\n$$r_{2} \\cdot a_{0}(x(0)) = 0.925 \\cdot 2.05 = 1.89625$$\nNow we check the cumulative sum of propensities:\n- For $j=1$: $\\sum_{\\mu=1}^{1} a_{\\mu} = a_{1} = 0.05$. This is less than $1.89625$.\n- For $j=2$: $\\sum_{\\mu=1}^{2} a_{\\mu} = a_{1} + a_{2} = 0.05 + 1.50 = 1.55$. This is less than $1.89625$.\n- For $j=3$: $\\sum_{\\mu=1}^{3} a_{\\mu} = a_{1} + a_{2} + a_{3} = 1.55 + 0.30 = 1.85$. This is less than $1.89625$.\n- For $j=4$: $\\sum_{\\mu=1}^{4} a_{\\mu} = a_{1} + a_{2} + a_{3} + a_{4} = 1.85 + 0.20 = 2.05$. This is greater than or equal to $1.89625$.\n\nThe condition is satisfied for $j=4$. Thus, the next reaction to fire is $R_4$.\n\nThe final step is to update the system time and state.\nThe new time $t'$ is the sum of the old time and the waiting time $\\tau$:\n$$t' = t(0) + \\tau = 0\\,\\mathrm{s} + 0.9756\\,\\mathrm{s} = 0.9756\\,\\mathrm{s}$$\n\nThe new state $x'$ is obtained by adding the state-change vector $\\nu_j$ for reaction $j=4$ to the old state $x(0)$. The reaction $R_4: P \\to \\varnothing$ corresponds to a decrease of one molecule of protein $P$. The state-change vector is $\\nu_4 = (0, -1)$.\n$$x' = x(0) + \\nu_4 = (3, 10) + (0, -1) = (3, 9)$$\nThe updated state is $x_{M}' = 3$ and $x_{P}' = 9$.\n\nIn summary, the results of one SSA iteration are:\n- Total propensity $a_{0} = 2.05\\,\\mathrm{s}^{-1}$.\n- Waiting time $\\tau \\approx 0.9756\\,\\mathrm{s}$.\n- Index of next reaction $j=4$.\n- Updated time $t' \\approx 0.9756\\,\\mathrm{s}$.\n- Updated state $(x_{M}', x_{P}') = (3, 9)$.\n\nThese values are compiled for the final answer.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.05 & 0.9756 & 4 & 0.9756 & 3 & 9\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A full stochastic simulation is a sequence of individual reaction events that form a trajectory through the system's state space. This practice builds upon the single-step calculation by challenging you to trace the first few events of a birth-death process . By iteratively updating the system's state and re-calculating the propensities, you will gain a deeper appreciation for how the system's history (its current state) dynamically influences its future evolution.",
            "id": "2678033",
            "problem": "Consider a single-species birth–death process for a molecular population $X(t)$, with two reaction channels:\n- Birth: $X \\to X + 1$ occurring at a constant rate $\\lambda$ (this is equivalent to $\\varnothing \\to X$ with propensity $\\lambda$).\n- Death: $X \\to X - 1$ occurring at a rate proportional to the current population, with propensity $\\mu X$.\n\nAssume $\\lambda = 2\\,\\mathrm{s^{-1}}$, $\\mu = 0.25\\,\\mathrm{s^{-1}}$ per molecule, and initial condition $X(0) = 3$. Using the Gillespie direct method (also known as the Stochastic Simulation Algorithm), treat each inter-event waiting time as an exponential random variable with rate equal to the instantaneous total propensity, and select the channel of the next reaction according to probabilities proportional to the current propensities. You are provided with three independent pairs of uniform random seeds $(u_{1,k},u_{2,k})$ for $k \\in \\{1,2,3\\}$, where for each event $k$, $u_{1,k}$ is used to sample the waiting time and $u_{2,k}$ is used to select the reaction channel:\n- $(u_{1,1},u_{2,1}) = \\big(\\exp(-1.1),\\,0.8\\big)$,\n- $(u_{1,2},u_{2,2}) = \\big(\\exp(-0.05),\\,0.2\\big)$,\n- $(u_{1,3},u_{2,3}) = \\big(\\exp(-0.3),\\,0.55\\big)$.\n\nCarry out, by hand, the first three events of the Gillespie direct method, starting at time $t=0$, updating the state $X$ and the absolute time after each event. Using only the definitions stated above, determine the absolute time $t_3$ at which the third reaction event occurs. Express your final answer as an exact value in seconds. Do not round; provide an exact fraction if possible. The final answer must be a single real number.",
            "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- System: A single-species birth–death process, population $X(t)$.\n- Reactions and Propensities:\n  - Birth: $X \\to X + 1$ (or $\\varnothing \\to X$), propensity $a_1 = \\lambda$.\n  - Death: $X \\to X - 1$, propensity $a_2 = \\mu X$.\n- Rate Constants:\n  - $\\lambda = 2\\,\\mathrm{s^{-1}}$.\n  - $\\mu = 0.25\\,\\mathrm{s^{-1}}$ per molecule.\n- Initial Condition: $X(0) = 3$ at time $t=0$.\n- Algorithm: Gillespie direct method. The inter-event waiting time $\\tau$ is sampled from an exponential distribution with rate $a_{total}$, which is the sum of all propensities. The formula is given by $\\tau = \\frac{1}{a_{total}} \\ln(\\frac{1}{u_1})$. The next reaction channel is chosen based on probabilities proportional to the individual propensities, using a second uniform random number $u_2$.\n- Random Seeds: Three pairs of uniform random seeds $(u_{1,k}, u_{2,k})$ for events $k = 1, 2, 3$:\n  - $(u_{1,1}, u_{2,1}) = (\\exp(-1.1), 0.8)$.\n  - $(u_{1,2}, u_{2,2}) = (\\exp(-0.05), 0.2)$.\n  - $(u_{1,3}, u_{2,3}) = (\\exp(-0.3), 0.55)$.\n- Objective: Determine the absolute time $t_3$ of the third reaction event.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is evaluated against the validation criteria.\n- **Scientifically Grounded**: The problem describes a standard birth-death process, a fundamental model in stochastic chemical kinetics. The Gillespie algorithm is the canonical, exact simulation method for such systems. The formulation is entirely consistent with established scientific principles.\n- **Well-Posed**: The problem is well-posed. It provides all necessary parameters, initial conditions, and a specific sequence of random numbers to deterministically trace the first three events of the stochastic simulation. The objective is clear and unambiguous.\n- **Objective**: The problem is stated in precise, objective language, free of any subjective or non-scientific content.\n\n**Verdict and Action**\nThe problem is scientifically sound, self-contained, and well-posed. There are no identifiable flaws. Therefore, the problem is **valid**. A solution will be derived.\n\nThe simulation proceeds event by event, updating the system state $(t, X)$ at each step. The state at the beginning of step $k$ is $(t_{k-1}, X_{k-1})$.\n\n**Initial State ($k=0$):**\nThe system begins at time $t_0 = 0$ with an initial population of $X_0 = 3$.\n\n**Event 1 ($k=1$):**\nFirst, we calculate the propensities for the two reaction channels based on the state $(t_0, X_0)$.\n- Birth propensity: $a_1 = \\lambda = 2$.\n- Death propensity: $a_2 = \\mu X_0 = (0.25) \\cdot 3 = 0.75$.\n\nThe total propensity is the sum of the individual propensities:\n$$a_{total,0} = a_1 + a_2 = 2 + 0.75 = 2.75 = \\frac{11}{4}$$\nThe waiting time for the first event, $\\tau_1$, is calculated using the first random seed $u_{1,1} = \\exp(-1.1)$.\n$$\\tau_1 = \\frac{1}{a_{total,0}} \\ln\\left(\\frac{1}{u_{1,1}}\\right) = \\frac{1}{11/4} \\ln\\left(\\frac{1}{\\exp(-1.1)}\\right) = \\frac{4}{11} \\ln(\\exp(1.1)) = \\frac{4}{11} \\cdot (1.1) = \\frac{4.4}{11} = 0.4 = \\frac{2}{5}$$\nThe time of the first event is:\n$$t_1 = t_0 + \\tau_1 = 0 + 0.4 = 0.4$$\nNext, we determine which reaction occurs using the second random seed $u_{2,1} = 0.8$. The birth reaction (channel $1$) occurs if $u_{2,1} \\le \\frac{a_1}{a_{total,0}}$.\n$$\\frac{a_1}{a_{total,0}} = \\frac{2}{2.75} = \\frac{2}{11/4} = \\frac{8}{11} \\approx 0.727$$\nSince $u_{2,1} = 0.8 > \\frac{8}{11}$, the death reaction (channel $2$) is selected. The population is updated accordingly:\n$$X_1 = X_0 - 1 = 3 - 1 = 2$$\nThe state after the first event is $(t_1, X_1) = (0.4, 2)$.\n\n**Event 2 ($k=2$):**\nWe proceed from the state $(t_1, X_1) = (0.4, 2)$.\n- Birth propensity: $a_1 = \\lambda = 2$.\n- Death propensity: $a_2 = \\mu X_1 = (0.25) \\cdot 2 = 0.5$.\n\nThe total propensity is:\n$$a_{total,1} = a_1 + a_2 = 2 + 0.5 = 2.5 = \\frac{5}{2}$$\nThe waiting time for the second event, $\\tau_2$, is calculated using $u_{1,2} = \\exp(-0.05)$.\n$$\\tau_2 = \\frac{1}{a_{total,1}} \\ln\\left(\\frac{1}{u_{1,2}}\\right) = \\frac{1}{5/2} \\ln\\left(\\frac{1}{\\exp(-0.05)}\\right) = \\frac{2}{5} \\ln(\\exp(0.05)) = \\frac{2}{5} \\cdot (0.05) = \\frac{0.1}{5} = 0.02 = \\frac{1}{50}$$\nThe time of the second event is:\n$$t_2 = t_1 + \\tau_2 = 0.4 + 0.02 = 0.42 = \\frac{42}{100} = \\frac{21}{50}$$\nThe reaction is selected using $u_{2,2} = 0.2$. The condition for a birth reaction is $u_{2,2} \\le \\frac{a_1}{a_{total,1}}$.\n$$\\frac{a_1}{a_{total,1}} = \\frac{2}{2.5} = \\frac{4}{5} = 0.8$$\nSince $u_{2,2} = 0.2 \\le 0.8$, the birth reaction is selected. The population becomes:\n$$X_2 = X_1 + 1 = 2 + 1 = 3$$\nThe state after the second event is $(t_2, X_2) = (0.42, 3)$.\n\n**Event 3 ($k=3$):**\nWe proceed from the state $(t_2, X_2) = (0.42, 3)$. The population count has returned to its initial value.\n- Birth propensity: $a_1 = \\lambda = 2$.\n- Death propensity: $a_2 = \\mu X_2 = (0.25) \\cdot 3 = 0.75$.\n\nThe total propensity is identical to the first step:\n$$a_{total,2} = a_1 + a_2 = 2 + 0.75 = 2.75 = \\frac{11}{4}$$\nThe waiting time for the third event, $\\tau_3$, is calculated using $u_{1,3} = \\exp(-0.3)$.\n$$\\tau_3 = \\frac{1}{a_{total,2}} \\ln\\left(\\frac{1}{u_{1,3}}\\right) = \\frac{1}{11/4} \\ln\\left(\\frac{1}{\\exp(-0.3)}\\right) = \\frac{4}{11} \\ln(\\exp(0.3)) = \\frac{4}{11} \\cdot (0.3) = \\frac{1.2}{11} = \\frac{12}{110} = \\frac{6}{55}$$\nThe absolute time of the third event, $t_3$, is the cumulative sum of the waiting times:\n$$t_3 = t_2 + \\tau_3 = \\frac{21}{50} + \\frac{6}{55}$$\nTo add these fractions, we find a common denominator, which is $\\mathrm{lcm}(50, 55) = \\mathrm{lcm}(2 \\cdot 5^2, 5 \\cdot 11) = 2 \\cdot 5^2 \\cdot 11 = 550$.\n$$t_3 = \\frac{21 \\cdot 11}{50 \\cdot 11} + \\frac{6 \\cdot 10}{55 \\cdot 10} = \\frac{231}{550} + \\frac{60}{550} = \\frac{231 + 60}{550} = \\frac{291}{550}$$\nThe fraction $\\frac{291}{550}$ is irreducible because the prime factors of the numerator are $291 = 3 \\cdot 97$ and the prime factors of the denominator are $550 = 2 \\cdot 5^2 \\cdot 11$, with no factors in common.\n\nThe question only asks for the time $t_3$. For completeness, the third reaction would be a birth, since $u_{2,3} = 0.55 \\le \\frac{8}{11}$.\n\nThe final answer is the absolute time at which the third event occurs.",
            "answer": "$$\\boxed{\\frac{291}{550}}$$"
        },
        {
            "introduction": "Moving from pen-and-paper exercises to a functional computer program requires addressing key implementation details for correctness and robustness. This practice focuses on a critical edge case: the termination of a simulation when the system reaches an absorbing state, where the total propensity $a_0$ becomes zero . Implementing the logic to detect this condition is essential for creating reliable simulations that correctly model phenomena like extinction or the depletion of all reactants.",
            "id": "3935575",
            "problem": "Consider the Direct method of the Gillespie stochastic simulation algorithm (SSA) for discrete-state, continuous-time reaction networks used in synthetic biology modeling. A reaction network consists of a finite set of reaction channels, each with a propensity function that depends on the current molecular counts. At any state $\\mathbf{x}$, the total hazard of any reaction occurring is the sum of reaction propensities, denoted by $a_0(\\mathbf{x})$. A rigorous interpretation of the case $a_0(\\mathbf{x}) = 0$ is required to ensure correct modeling of absorbing states and termination behavior.\n\nStarting from first principles of continuous-time Markov jump processes and mass-action kinetics for discrete molecules, derive the conditions under which the system is absorbing and how the Direct method should stop when $a_0(\\mathbf{x}) = 0$. Then, implement a program that robustly detects and handles $a_0(\\mathbf{x}) = 0$ both initially and during the simulation, and that stops at a user-specified final time $T_{\\mathrm{end}}$ if $a_0(\\mathbf{x}) > 0$ but the next reaction time would exceed $T_{\\mathrm{end}}$.\n\nThe implementation must:\n- Use discrete mass-action kinetics with integer molecular counts. For each reaction, define a nonnegative integer reactant stoichiometry vector and a positive rate constant in $\\mathrm{s}^{-1}$. The propensity of a reaction should be computed as the rate constant multiplied by the product of binomial terms $\\binom{x_i}{r_i}$ across species, treating $\\binom{x_i}{0} = 1$ and $\\binom{x_i}{r_i} = 0$ whenever $x_i < r_i$.\n- At each step, compute $a_0(\\mathbf{x})$; if $a_0(\\mathbf{x}) = 0$, interpret the state $\\mathbf{x}$ as absorbing and stop immediately.\n- If $a_0(\\mathbf{x}) > 0$, draw an exponentially distributed waiting time by sampling with the correct hazard, and select the next reaction index by a probability proportional to individual propensities. If the proposed next reaction time would exceed $T_{\\mathrm{end}}$, do not fire any reaction and stop at $T_{\\mathrm{end}}$.\n- Return, for each test case, the number of fired reactions as an integer, whether the run ended in an absorbing state as a boolean, and the final time as a float expressed in seconds.\n\nExpress all times in $\\mathrm{s}$. Angles are not involved. There are no percentages in this problem.\n\nImplement the program to run the following test suite, each defined by a reaction network, an initial state, a final time, and a pseudorandom seed. For mass-action kinetics, use the binomial-based discrete formulation for propensities as described above.\n\nTest Suite:\n- Case $1$ (Absorption reached during simulation): Single-species degradation. Species $X$ with one reaction $X \\to \\varnothing$ having rate constant $c = 1.0\\,\\mathrm{s}^{-1}$. Initial count $x(0) = 3$. Final time $T_{\\mathrm{end}} = 2.0\\,\\mathrm{s}$. Seed $12345$.\n- Case $2$ (Initial absorbing state): Single-species dimerization to inert. Species $X$ with one reaction $2X \\to \\varnothing$ having rate constant $c = 1.0\\,\\mathrm{s}^{-1}$. Initial count $x(0) = 1$. Final time $T_{\\mathrm{end}} = 1.0\\,\\mathrm{s}$. Seed $42$.\n- Case $3$ (Never absorbing before final time): Birth-death. Species $X$ with two reactions $\\varnothing \\to X$ at rate $k_0 = 2.0\\,\\mathrm{s}^{-1}$ and $X \\to \\varnothing$ at rate $k_1 = 1.0\\,\\mathrm{s}^{-1}$. Initial count $x(0) = 0$. Final time $T_{\\mathrm{end}} = 1.0\\,\\mathrm{s}$. Seed $314159$.\n- Case $4$ (Absorption after a finite chain): Two-species chain. Species $X,Y$ with reactions $X \\to Y$ at rate $c_1 = 0.5\\,\\mathrm{s}^{-1}$ and $Y \\to \\varnothing$ at rate $c_2 = 0.7\\,\\mathrm{s}^{-1}$. Initial counts $(x(0), y(0)) = (1,0)$. Final time $T_{\\mathrm{end}} = 5.0\\,\\mathrm{s}$. Seed $2024$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test-case result must itself be a list of the form $[N_{\\mathrm{events}}, \\mathrm{absorbed}, t_{\\mathrm{final}}]$, where $N_{\\mathrm{events}}$ is an integer, $\\mathrm{absorbed}$ is a boolean, and $t_{\\mathrm{final}}$ is a float in seconds. For example, the entire output line should look like $[[\\ldots],[\\ldots],[\\ldots],[\\ldots]]$.",
            "solution": "The user has provided a valid problem statement. It is scientifically grounded, well-posed, and objective. It consists of a request to derive the theoretical basis for handling absorbing states in the Gillespie stochastic simulation algorithm (SSA) and to implement the algorithm to solve a series of test cases. All parameters, conditions, and requirements are clearly defined.\n\n### Theoretical Derivation and Algorithmic Design\n\nThe Gillespie Stochastic Simulation Algorithm (SSA) is a method for generating a statistically correct trajectory of a stochastic chemical system, modeled as a continuous-time, discrete-state Markov jump process. The state of the system is a vector $\\mathbf{X}(t) = (X_1(t), X_2(t), \\ldots, X_N(t))$ representing the integer counts of $N$ molecular species at time $t$. The system evolves through a series of $M$ reaction channels.\n\n#### Waiting Time to the Next Reaction\n\nThe core of the SSA is based on the **propensity function**, $a_j(\\mathbf{x})$, for each reaction $j \\in \\{1, \\ldots, M\\}$. The quantity $a_j(\\mathbf{x})dt$ represents the probability that reaction $j$ will occur in the infinitesimal time interval $[t, t+dt)$, given the system is in state $\\mathbf{x}$ at time $t$. The propensity function for discrete mass-action kinetics, as specified, is given by:\n$$ a_j(\\mathbf{x}) = c_j \\prod_{i=1}^{N} \\binom{x_i}{r_{ij}} $$\nwhere $c_j$ is the stochastic rate constant for reaction $j$, $x_i$ is the number of molecules of species $i$, and $r_{ij}$ is the reactant stoichiometry, i.e., the number of molecules of species $i$ consumed by one instance of reaction $j$. The binomial coefficient $\\binom{n}{k}$ is defined as $0$ if $k > n$, which naturally ensures that a reaction cannot occur if there are insufficient reactants.\n\nThe total propensity, or hazard, $a_0(\\mathbf{x})$, is the sum of the propensities of all possible reactions:\n$$ a_0(\\mathbf{x}) = \\sum_{j=1}^{M} a_j(\\mathbf{x}) $$\nThe quantity $a_0(\\mathbf{x})dt$ is the probability that *any* reaction will occur in the interval $[t, t+dt)$.\n\nTo determine *when* the next reaction occurs, we seek the probability distribution of the waiting time $\\tau$. Let $P_0(\\tau, \\mathbf{x})$ be the probability that, starting in state $\\mathbf{x}$ at time $t$, no reaction occurs in the interval $[t, t+\\tau)$. For no reaction to occur in $[t, t+\\tau+d\\tau)$, no reaction must occur in $[t, t+\\tau)$ AND no reaction must occur in $[t+\\tau, t+\\tau+d\\tau)$. Since the process is Markovian, these events are independent. The probability of no reaction in $[t+\\tau, t+\\tau+d\\tau)$ is $1 - a_0(\\mathbf{x})d\\tau$. Therefore:\n$$ P_0(\\tau+d\\tau, \\mathbf{x}) = P_0(\\tau, \\mathbf{x}) (1 - a_0(\\mathbf{x})d\\tau) $$\nRearranging gives the differential equation:\n$$ \\frac{P_0(\\tau+d\\tau, \\mathbf{x}) - P_0(\\tau, \\mathbf{x})}{d\\tau} = \\frac{dP_0(\\tau, \\mathbf{x})}{d\\tau} = -a_0(\\mathbf{x}) P_0(\\tau, \\mathbf{x}) $$\nWith the initial condition $P_0(0, \\mathbf{x}) = 1$ (the probability of no reaction in zero time is $1$), the solution is:\n$$ P_0(\\tau, \\mathbf{x}) = e^{-a_0(\\mathbf{x})\\tau} $$\nThis is the survival function for the waiting time $\\tau$. The probability density function $p(\\tau | \\mathbf{x})$ is found by differentiation:\n$$ p(\\tau | \\mathbf{x}) = -\\frac{dP_0(\\tau, \\mathbf{x})}{d\\tau} = a_0(\\mathbf{x}) e^{-a_0(\\mathbf{x})\\tau} $$\nThis is the probability density function of an exponential distribution with rate parameter $a_0(\\mathbf{x})$. To sample a value for $\\tau$, we use inverse transform sampling. We draw a uniform random number $u_1 \\in (0,1)$ and set the cumulative distribution $F(\\tau) = 1 - e^{-a_0(\\mathbf{x})\\tau}$ equal to $u_1$. Solving for $\\tau$:\n$$ \\tau = \\frac{1}{a_0(\\mathbf{x})} \\ln\\left(\\frac{1}{1-u_1}\\right) $$\nSince $1-u_1$ is also uniformly distributed on $(0,1)$, we can simplify this to:\n$$ \\tau = \\frac{1}{a_0(\\mathbf{x})} \\ln\\left(\\frac{1}{u_1}\\right) $$\n\n#### The Absorbing State Condition: $a_0(\\mathbf{x}) = 0$\n\nA critical insight arises from examining the case where $a_0(\\mathbf{x}) = 0$.\nThe mean waiting time to the next reaction is $E[\\tau] = 1/a_0(\\mathbf{x})$. If $a_0(\\mathbf{x}) = 0$, the mean waiting time becomes infinite. The probability density function $p(\\tau | \\mathbf{x})$ becomes $0$ for any finite $\\tau$, meaning the probability of a reaction occurring in any finite time interval is zero. The system will remain in state $\\mathbf{x}$ indefinitely. Such a state is called an **absorbing state**.\n\nSince all propensities $a_j(\\mathbf{x})$ are non-negative, the condition $a_0(\\mathbf{x}) = \\sum_j a_j(\\mathbf{x}) = 0$ holds if and only if $a_j(\\mathbf{x}) = 0$ for all reactions $j = 1, \\ldots, M$. Given the definition of the propensity function, $a_j(\\mathbf{x})$ becomes $0$ if, for at least one of its reactant species $i$, the number of available molecules $x_i$ is less than the number required by the reaction, $r_{ij}$. Thus, an absorbing state is reached when every reaction in the network is \"starved\" of at least one of its required reactants.\n\nThe SSA implementation must therefore check the value of $a_0(\\mathbf{x})$ at each step. If $a_0(\\mathbf{x}) = 0$, the simulation must terminate immediately, and the state must be flagged as absorbing. This condition can be met either at the beginning of the simulation (if the initial state is absorbing) or at any subsequent step.\n\n#### Selection of the Next Reaction\n\nIf $a_0(\\mathbf{x}) > 0$, a reaction will occur after time $\\tau$. To determine *which* reaction occurs, we find the probability that the event is specifically reaction $\\mu$. This is the ratio of the probability of reaction $\\mu$ occurring to the probability of any reaction occurring:\n$$ P(\\text{reaction } \\mu) = \\frac{a_\\mu(\\mathbf{x})dt}{a_0(\\mathbf{x})dt} = \\frac{a_\\mu(\\mathbf{x})}{a_0(\\mathbf{x})} $$\nThe Gillespie Direct method samples a reaction index $\\mu$ from this discrete probability distribution. This is done by drawing a second uniform random number $u_2 \\in (0,1)$ and finding the smallest integer $\\mu$ that satisfies:\n$$ \\sum_{j=1}^{\\mu} a_j(\\mathbf{x}) > u_2 \\cdot a_0(\\mathbf{x}) $$\n\n#### Algorithm and Stopping Conditions\n\nThe implemented algorithm will proceed as follows:\n$1$. Initialize time $t=0$, the state vector $\\mathbf{x} = \\mathbf{x}_0$, and number of events $N_{\\mathrm{events}}=0$.\n$2$. Begin a loop that continues as long as the simulation time $t$ is less than the final time $T_{\\mathrm{end}}$.\n$3$. At each step, calculate the propensities $a_j(\\mathbf{x})$ for all reactions and their sum $a_0(\\mathbf{x})$.\n$4$. **First stopping condition (absorption):** If $a_0(\\mathbf{x}) = 0$, the system is in an absorbing state. The loop terminates. The final time is the current time $t$, and the `absorbed` flag is set to `True`.\n$5$. If $a_0(\\mathbf{x}) > 0$, draw two random numbers $u_1, u_2$ from $U(0,1)$ and calculate the waiting time $\\tau$.\n$6$. **Second stopping condition (end time):** If the time of the next reaction, $t + \\tau$, is greater than or equal to $T_{\\mathrm{end}}$, no further reactions are processed. The simulation time is set to $T_{\\mathrm{end}}$, and the loop terminates. The `absorbed` flag is `False`.\n$7$. If the reaction occurs before $T_{\\mathrm{end}}$, update the time $t \\leftarrow t + \\tau$. Select the reaction index $\\mu$ using $u_2$. Update the state vector $\\mathbf{x} \\leftarrow \\mathbf{x} + \\mathbf{v}_{\\mu}$, where $\\mathbf{v}_{\\mu}$ is the state-change vector for reaction $\\mu$. Increment $N_{\\mathrm{events}}$.\n$8$. The loop repeats from step $3$.\n$9$. Upon termination, the algorithm returns the total number of events fired, a boolean indicating if termination was due to absorption, and the final simulation time.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import comb\n\ndef solve():\n    \"\"\"\n    Sets up and runs the test suite for the Gillespie SSA implementation.\n    \"\"\"\n\n    def run_gillespie(initial_state, reactant_stoich, state_change, rate_constants, T_end, seed):\n        \"\"\"\n        Implements the Gillespie Direct Method SSA.\n\n        Args:\n            initial_state (list or np.ndarray): Initial molecular counts.\n            reactant_stoich (np.ndarray): Matrix of reactant stoichiometries (reactions x species).\n            state_change (np.ndarray): State-change matrix (reactions x species).\n            rate_constants (list or np.ndarray): Vector of reaction rate constants.\n            T_end (float): The final simulation time.\n            seed (int): Seed for the pseudorandom number generator.\n\n        Returns:\n            list: A list containing [N_events, absorbed, t_final].\n        \"\"\"\n        rng = np.random.default_rng(seed)\n\n        num_species = len(initial_state)\n        num_reactions = len(rate_constants)\n\n        t = 0.0\n        x = np.array(initial_state, dtype=int)\n        n_events = 0\n        absorbed = False\n\n        def calculate_propensities(current_x):\n            propensities = np.zeros(num_reactions, dtype=float)\n            for j in range(num_reactions):\n                # Calculate the product of binomial terms, h_j\n                h_j = 1.0\n                possible = True\n                for i in range(num_species):\n                    r_ij = reactant_stoich[j, i]\n                    if r_ij > 0:\n                        x_i = current_x[i]\n                        if x_i < r_ij:\n                            possible = False\n                            break\n                        h_j *= comb(x_i, r_ij, exact=False)\n                \n                if possible:\n                    propensities[j] = rate_constants[j] * h_j\n            return propensities\n\n        # Main simulation loop\n        while t < T_end:\n            propensities = calculate_propensities(x)\n            a0 = np.sum(propensities)\n\n            if a0 == 0.0:\n                absorbed = True\n                break\n\n            u1, u2 = rng.random(2)\n            tau = (1.0 / a0) * np.log(1.0 / u1)\n\n            if t + tau >= T_end:\n                t = T_end\n                break\n            \n            t += tau\n\n            # Select the next reaction\n            target = u2 * a0\n            a_sum = 0.0\n            mu = -1  # reaction index\n            for j in range(num_reactions):\n                a_sum += propensities[j]\n                if a_sum >= target:\n                    mu = j\n                    break\n\n            # Update state and event count\n            x += state_change[mu]\n            n_events += 1\n\n        t_final = t\n        return [n_events, absorbed, t_final]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Absorption reached during simulation\n        {\n            \"initial_state\": [3],\n            \"reactant_stoich\": np.array([[1]]),\n            \"state_change\": np.array([[-1]]),\n            \"rate_constants\": [1.0],\n            \"T_end\": 2.0,\n            \"seed\": 12345,\n        },\n        # Case 2: Initial absorbing state\n        {\n            \"initial_state\": [1],\n            \"reactant_stoich\": np.array([[2]]),\n            \"state_change\": np.array([[-2]]),\n            \"rate_constants\": [1.0],\n            \"T_end\": 1.0,\n            \"seed\": 42,\n        },\n        # Case 3: Never absorbing before final time\n        {\n            \"initial_state\": [0],\n            \"reactant_stoich\": np.array([[0], [1]]),\n            \"state_change\": np.array([[1], [-1]]),\n            \"rate_constants\": [2.0, 1.0],\n            \"T_end\": 1.0,\n            \"seed\": 314159,\n        },\n        # Case 4: Absorption after a finite chain\n        {\n            \"initial_state\": [1, 0],\n            \"reactant_stoich\": np.array([[1, 0], [0, 1]]),\n            \"state_change\": np.array([[-1, 1], [0, -1]]),\n            \"rate_constants\": [0.5, 0.7],\n            \"T_end\": 5.0,\n            \"seed\": 2024,\n        },\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = run_gillespie(**case_params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Format: [[N_events,absorbed,t_final],[...],[...],[...]]\n    outer_list = []\n    for res in results:\n        # res is like [3, True, 1.2345]\n        inner_list_str = f\"[{res[0]},{str(res[1]).lower()},{res[2]}]\"\n        outer_list.append(inner_list_str)\n    \n    print(f\"[{','.join(outer_list)}]\")\n\nsolve()\n```"
        }
    ]
}