{
    "hands_on_practices": [
        {
            "introduction": "变分多尺度（VMS）方法的核心在于将解空间分解为可解的“大尺度”和不可解的“小尺度”。这个基础练习旨在通过一个简单的一维单元，具体化这一分解过程。通过为大尺度和小尺度空间构建显式基函数，并计算给定函数在这些基函数下的分解系数，我们可以亲手实践尺度分离的基本机制 。",
            "id": "3805281",
            "problem": "考虑变分多尺度方法 (VMS)，该方法通过一个作用于合适有限维子空间的投影算子，将函数空间分解为解析尺度和精细尺度。令参考一维单元为 $K=[-1,1]$，并考虑以下分层基。\n\n将解析尺度空间 $V_h$ 定义为与端点相关联的线性 Lagrange 函数所张成的空间：\n$$\n\\phi_1(x) = \\frac{1-x}{2}, \\qquad \\phi_2(x) = \\frac{1+x}{2}.\n$$\n将精细尺度空间 $V'$ 定义为一个在端点处为零的气泡函数所张成的空间：\n$$\n\\psi(x) = 1 - x^2.\n$$\n假设到 $V_h$ 上的投影算子是在 $x=-1$ 和 $x=1$ 处的节点插值算子，因此对于任何足够光滑的函数 $u$，其解析尺度分量 $u_h \\in V_h$ 满足 $u_h(-1) = u(-1)$ 和 $u_h(1)=u(1)$，而精细尺度分量为 $u' = u - u_h \\in V'$。\n\n任务：\n- 使用基本原理（有限维子空间、插值算子和分层基函数的性质的定义），为 $V_h$ 和 $V'$ 构造显式基，并验证 $V_h \\cap V' = \\{0\\}$，从而证明 $V_h \\oplus V'$ 是单元 $K$ 上的直和。\n- 给定节点采样值 $u(-1)=2$，$u(0)=1$ 和 $u(1)=3$，计算分层表示中的分解系数 $a_1$，$a_2$ 和 $b$：\n$$\nu(x) \\approx a_1 \\,\\phi_1(x) + a_2 \\,\\phi_2(x) + b \\,\\psi(x),\n$$\n该表示需与 VMS 尺度分离和给定的插值条件一致。以包含三个系数的行矩阵形式给出最终答案。无需四舍五入，也不涉及物理单位。",
            "solution": "首先验证问题以确保其自洽、有科学依据且适定。给定信息包括定义域 $K=[-1,1]$、解析尺度空间 $V_h$ 和精细尺度空间 $V'$ 的定义、到 $V_h$ 上的投影算子的定义以及函数 $u$ 的特定节点值。任务是验证空间的直和性质并计算分层展开的系数。所有要素在有限元和变分多尺度方法理论中都是标准的，因此该问题是有效的。\n\n我们按要求分两部分进行求解。\n\n第1部分：向量空间 $V_h$ 和 $V'$ 的分析。\n\n解析尺度空间 $V_h$ 定义为函数 $\\phi_1(x) = \\frac{1-x}{2}$ 和 $\\phi_2(x) = \\frac{1+x}{2}$ 所张成的空间。它们是线性无关的多项式（一个是一次多项式，另一个也是一次多项式；它们不是彼此的标量倍数），因此二维空间 $V_h$ 的一个显式基是 $\\{\\phi_1(x), \\phi_2(x)\\}$。\n\n精细尺度空间 $V'$ 定义为函数 $\\psi(x) = 1 - x^2$ 所张成的空间。一维空间 $V'$ 的一个显式基是 $\\{\\psi(x)\\}$。\n\n为验证 $V_h \\cap V' = \\{0\\}$，我们必须证明同时属于这两个空间的唯一函数是零函数。设 $v(x)$ 是交集中的任意函数，即 $v(x) \\in V_h \\cap V'$。\n\n因为 $v(x) \\in V_h$，它可以表示为 $V_h$ 基函数的线性组合：\n$$\nv(x) = c_1 \\phi_1(x) + c_2 \\phi_2(x)\n$$\n其中 $c_1, c_2 \\in \\mathbb{R}$ 是某个标量系数。\n\n因为 $v(x) \\in V'$，它可以表示为 $V'$ 基函数的标量倍数：\n$$\nv(x) = b \\, \\psi(x)\n$$\n其中 $b \\in \\mathbb{R}$ 是某个标量系数。\n\n$V_h$ 的基函数是与节点 $x_1 = -1$ 和 $x_2 = 1$ 相关联的标准线性 Lagrange 多项式。它们具有节点性质 $\\phi_i(x_j) = \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克 δ。具体来说：\n$\\phi_1(-1) = 1$, $\\phi_1(1) = 0$.\n$\\phi_2(-1) = 0$, $\\phi_2(1) = 1$.\n\n$V'$ 的基函数是一个气泡函数，其设计使其在单元 $K$ 的端点处为零：\n$\\psi(-1) = 1 - (-1)^2 = 1 - 1 = 0$.\n$\\psi(1) = 1 - (1)^2 = 1 - 1 = 0$.\n\n如果 $v(x) = b \\, \\psi(x)$，那么必须有 $v(-1) = b \\, \\psi(-1) = 0$ 和 $v(1) = b \\, \\psi(1) = 0$。\n\n现在，我们在端点处计算来自 $V_h$ 的 $v(x)$ 表达式的值：\n在 $x=-1$ 处：$v(-1) = c_1 \\phi_1(-1) + c_2 \\phi_2(-1) = c_1(1) + c_2(0) = c_1$。\n在 $x=1$ 处：$v(1) = c_1 \\phi_1(1) + c_2 \\phi_2(1) = c_1(0) + c_2(1) = c_2$。\n\n令结果相等，我们必须有 $c_1 = 0$ 和 $c_2 = 0$。将这些系数代回到来自 $V_h$ 的 $v(x)$ 表达式中，得到：\n$$\nv(x) = 0 \\cdot \\phi_1(x) + 0 \\cdot \\phi_2(x) = 0\n$$\n对所有 $x \\in K$ 成立。因此，交集 $V_h \\cap V'$ 中的唯一函数是零函数。这证实了这两个空间的和是直和，记为 $V = V_h \\oplus V'$。\n\n第2部分：分解系数的计算。\n\n我们被要求求解分层表示 $u_{V}(x)$ 的系数 $a_1, a_2, b$，该表示近似于一个函数 $u(x)$，并与给定的节点值一致：\n$$\nu_{V}(x) = a_1 \\phi_1(x) + a_2 \\phi_2(x) + b \\psi(x)\n$$\n问题提供了 $u(x)$ 的三个采样值：$u(-1)=2$，$u(0)=1$ 和 $u(1)=3$。我们强制要求近似值 $u_V(x)$ 在相应节点处与这些值匹配：\n$u_V(-1) = 2$\n$u_V(0) = 1$\n$u_V(1) = 3$\n\n这为三个未知系数 $a_1, a_2, b$ 导出一个三元线性方程组。为建立该方程组，我们在节点 $x \\in \\{-1, 0, 1\\}$ 处计算基函数的值：\n$\\phi_1(-1) = 1$, $\\phi_1(0) = \\frac{1-0}{2} = \\frac{1}{2}$, $\\phi_1(1) = 0$.\n$\\phi_2(-1) = 0$, $\\phi_2(0) = \\frac{1+0}{2} = \\frac{1}{2}$, $\\phi_2(1) = 1$.\n$\\psi(-1) = 0$, $\\psi(0) = 1 - 0^2 = 1$, $\\psi(1) = 0$.\n\n将这些值代入每个节点上的近似方程中：\n\n1.  在 $x = -1$ 处：\n    $u_V(-1) = a_1 \\phi_1(-1) + a_2 \\phi_2(-1) + b \\psi(-1) = a_1(1) + a_2(0) + b(0) = a_1$。\n    给定 $u(-1)=2$，我们得到 $a_1 = 2$。\n\n2.  在 $x = 1$ 处：\n    $u_V(1) = a_1 \\phi_1(1) + a_2 \\phi_2(1) + b \\psi(1) = a_1(0) + a_2(1) + b(0) = a_2$。\n    给定 $u(1)=3$，我们得到 $a_2 = 3$。\n\n这些结果与所描述的 VMS 框架一致，其中解析尺度分量 $u_h(x) = a_1 \\phi_1(x) + a_2 \\phi_2(x)$ 由投影算子确定，该算子是在端点处的节点插值。因此，$u_h(-1)=u(-1)=2$ 意味着 $a_1=2$，而 $u_h(1)=u(1)=3$ 意味着 $a_2=3$。\n\n3.  在 $x = 0$ 处：\n    $u_V(0) = a_1 \\phi_1(0) + a_2 \\phi_2(0) + b \\psi(0) = a_1(\\frac{1}{2}) + a_2(\\frac{1}{2}) + b(1)$。\n    给定 $u(0)=1$，我们得到方程：\n    $$\n    \\frac{1}{2} a_1 + \\frac{1}{2} a_2 + b = 1\n    $$\n    我们将已知的 $a_1=2$ 和 $a_2=3$ 的值代入此方程以求解 $b$：\n    $$\n    \\frac{1}{2}(2) + \\frac{1}{2}(3) + b = 1\n    $$\n    $$\n    1 + \\frac{3}{2} + b = 1\n    $$\n    $$\n    \\frac{5}{2} + b = 1\n    $$\n    $$\n    b = 1 - \\frac{5}{2} = \\frac{2}{2} - \\frac{5}{2} = -\\frac{3}{2}\n    $$\n因此，分解系数为 $a_1=2$，$a_2=3$ 和 $b = -\\frac{3}{2}$。精细尺度分量为 $u'(x) = u_V(x) - u_h(x) = -\\frac{3}{2}\\psi(x)$。\n最终答案是系数集 $(a_1, a_2, b)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2  & 3  & -\\frac{3}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在VMS框架中，小尺度虽然被从直接求解中消除，但它们的影响会以模型项的形式反馈到大尺度方程中。这个练习将演示如何从一个标准的弱形式出发，推导小尺度消除后对大尺度方程的修正，特别是在载荷向量上的体现。通过求解一个具体的一维扩散问题，我们能清晰地看到小尺度解如何系统性地改变大尺度问题的源项，这是理解VMS稳定化机理的关键一步 。",
            "id": "3805319",
            "problem": "考虑在域 $(0,L)$ 上具有恒定扩散率 $\\nu > 0$ 和齐次狄利克雷边界条件的一维扩散问题。其强形式为在 $(0,L)$ 内 $-(\\nu u')' = f$，且 $u(0) = 0$ 和 $u(L) = 0$。设 $L = 2$，计算网格由两个均匀单元组成，节点位于 $x_0 = 0$，$x_1 = 1$ 和 $x_2 = 2$。设 $\\mathcal{V}_h$ 是从属于该网格、在 $x_0$ 和 $x_2$ 处为零的连续分片线性函数空间，并设 $\\mathcal{V}'$ 是逐单元支撑且在每个单元边界上为零的函数空间（气泡型细尺度）。采用变分多尺度（VMS）分解，$u = u_h + u_{fine}$ 和 $w = w_h + w_{fine}$，其中 $u_h, w_h \\in \\mathcal{V}_h$ 且 $u_{fine}, w_{fine} \\in \\mathcal{V}'$。\n\n从对所有 $w \\in H_0^1(0,L)$ 成立的弱形式 $\\int_{0}^{L} \\nu u' w' \\, dx = \\int_{0}^{L} f w \\, dx$ 出发，使用VMS分裂以及对 $\\mathcal{V}'$ 的选择（该选择强制 $u_{fine}$ 和 $w_{fine}$ 在单元边界上的迹为零），推导在单元级别上局部消除细尺度 $u_{fine}$ 后得到的粗尺度方程。明确指出粗尺度方程中由被消除的细尺度引起的对粗尺度右端项（载荷泛函）的一致性修正项。\n\n然后，对于具体数据 $\\nu = 1$ 和在 $(0,2)$ 上 $f(x) \\equiv 1$，计算与内部节点 $x_1 = 1$ 相关联的修正后粗尺度载荷向量项。使用 $\\mathcal{V}_h$ 中与 $x_1$ 相关联的标准节点测试函数来定义此项。以无单位的单个精确数字形式提供最终答案。",
            "solution": "用户要求我在变分多尺度（VMS）方法的背景下解决一个问题。我将首先验证问题陈述。\n\n### 第1步：提取已知条件\n-   **方程：** 一维扩散问题，$-(\\nu u')' = f$，在域 $(0, L)$ 上。\n-   **参数：** 恒定扩散率 $\\nu > 0$，域长度 $L = 2$。\n-   **边界条件：** 齐次狄利克雷，$u(0) = 0$ 和 $u(L) = 0$。\n-   **网格：** 两个均匀单元，节点位于 $x_0 = 0$，$x_1 = 1$ 和 $x_2 = 2$。单元为 $K_1 = (0,1)$ 和 $K_2 = (1,2)$。\n-   **粗尺度空间 $\\mathcal{V}_h$：** 从属于该网格、在 $x_0$ 和 $x_2$ 处为零的连续分片线性函数。\n-   **细尺度空间 $\\mathcal{V}'$：** 逐单元支撑且在每个单元边界上为零的函数。\n-   **VMS分解：** $u = u_h + u_{fine}$ 和 $w = w_h + w_{fine}$，其中 $u_h, w_h \\in \\mathcal{V}_h$ 且 $u_{fine}, w_{fine} \\in \\mathcal{V}'$。\n-   **弱形式：** $\\int_{0}^{L} \\nu u' w' \\, dx = \\int_{0}^{L} f w \\, dx$ 对所有 $w \\in H_0^1(0,L)$ 成立。\n-   **任务1：** 在消除细尺度 $u_{fine}$ 后推导粗尺度方程。\n-   **任务2：** 确定对粗尺度右端项（载荷泛函）的修正。\n-   **任务3：** 对于 $\\nu = 1$ 和 $f(x) \\equiv 1$，使用标准节点基函数作为测试函数，计算内部节点 $x_1 = 1$ 处的修正后粗尺度载荷向量项。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，植根于有限元方法和多尺度建模理论，特别是变分多尺度方法。该问题是适定的，提供了清晰的微分方程、域、边界条件以及VMS分解所需的函数空间的定义。为最终计算提供了所有必要的数据（$\\nu=1$，$f(x)=1$，网格定义）。语言客观且数学上精确。该问题并非无足轻重，因为它需要将VMS框架逐步应用于一个具体例子。该问题是自洽且内部一致的。\n\n### 第3步：结论与行动\n问题有效。我现在开始解答。\n\n### VMS方程的推导\n\n问题的弱形式是寻找 $u \\in H_0^1(0,L)$，使得对所有 $w \\in H_0^1(0,L)$：\n$$B(u, w) = (f, w)$$\n其中双线性形式为 $B(u, w) = \\int_0^L \\nu u' w' dx$，线性泛函为 $(f, w) = \\int_0^L f w dx$。这里的 ' 表示对空间变量的导数。\n\n我们将解 $u = u_h + u_{fine}$ 和测试函数 $w = w_h + w_{fine}$ 的VMS分解代入弱形式：\n$$B(u_h + u_{fine}, w_h + w_{fine}) = (f, w_h + w_{fine})$$\n利用 $B(\\cdot, \\cdot)$ 的双线性和 $(\\cdot, \\cdot)$ 的线性，我们展开方程：\n$$B(u_h, w_h) + B(u_h, w_{fine}) + B(u_{fine}, w_h) + B(u_{fine}, w_{fine}) = (f, w_h) + (f, w_{fine})$$\n通过独立地从粗尺度和细尺度空间中选择测试函数，这个单 expectativa 等价于一个由两个方程组成的系统。\n\n1.  **粗尺度方程**（设 $w_{fine} = 0$，则 $w = w_h \\in \\mathcal{V}_h$）：\n    $$B(u_h, w_h) + B(u_{fine}, w_h) = (f, w_h) \\quad \\forall w_h \\in \\mathcal{V}_h$$\n\n2.  **细尺度方程**（设 $w_h = 0$，则 $w = w_{fine} \\in \\mathcal{V}'$）：\n    $$B(u_h, w_{fine}) + B(u_{fine}, w_{fine}) = (f, w_{fine}) \\quad \\forall w_{fine} \\in \\mathcal{V}'$$\n\n空间 $\\mathcal{V}'$ 由在单个单元 $K_e$ 上有支撑且在单元边界处为零的函数组成。粗尺度空间 $\\mathcal{V}_h$ 由连续分片线性函数组成。在任何单元 $K_e$ 上，粗尺度函数 $u_h$ 的导数 $u_h'$ 是一个常数。细尺度测试函数 $w_{fine}$ 的导数 $w_{fine}'$ 是一个 $L^2(K_e)$ 函数。$w_{fine}'$ 在 $K_e$ 上的积分是 $[w_{fine}]_{\\partial K_e}$，根据 $\\mathcal{V}'$ 的定义，该值为零。因此，项 $B(u_h, w_{fine})$ 简化为：\n$$B(u_h, w_{fine}) = \\sum_e \\int_{K_e} \\nu (u_h)' (w_{fine})' dx = \\sum_e \\nu (u_h)'|_{K_e} \\int_{K_e} (w_{fine})' dx = \\sum_e \\nu (u_h)'|_{K_e} [w_{fine}]_{\\partial K_e} = 0$$\n这个性质，即粗尺度梯度和细尺度梯度之间的一种伽辽金正交性形式，是此特定VMS公式的一个关键特征。\n\n由于 $B(u_h, w_{fine}) = 0$，细尺度方程与粗尺度解耦，变为：\n$$B(u_{fine}, w_{fine}) = (f, w_{fine}) \\quad \\forall w_{fine} \\in \\mathcal{V}'$$\n由于 $\\mathcal{V}'$ 中的函数逐单元具有不相交的支撑，该问题可以在每个单元 $K_e$ 上局部求解细尺度分量 $u_{fine,e}$：\n$$B_e(u_{fine,e}, w_{fine,e}) = (f, w_{fine,e})_e \\quad \\forall w_{fine,e} \\in \\mathcal{V}'_e$$\n其中 $B_e(\\cdot, \\cdot)$ 和 $(\\cdot, \\cdot)_e$ 表示限制在单元 $K_e$ 上的形式。这个局部问题的强形式是在 $K_e$ 上 $-(\\nu u_{fine,e}')' = f$，边界条件为齐次狄利克雷条件 $u_{fine,e}(\\partial K_e)=0$。\n\n细尺度 $u_{fine} = \\sum_e u_{fine,e}$ 现在仅由源项 $f$ 决定。我们将其代回粗尺度方程：\n$$B(u_h, w_h) = (f, w_h) - B(u_{fine}, w_h)$$\n这就是最终的粗尺度方程。右侧代表修正后的载荷泛函。项 $-B(u_{fine}, w_h)$ 是由消除的细尺度引起的修正。问题要求计算这个修正后的右端项对于一个特定测试函数的值。\n\n### 针对特定情况的计算\n\n给定 $L = 2$，$\\nu=1$ 和 $f(x)=1$。网格有两个单元，$K_1 = (0,1)$ 和 $K_2 = (1,2)$。唯一的内部节点是 $x_1=1$。粗尺度空间 $\\mathcal{V}_h$ 是一个一维空间，由与节点 $x_1=1$ 相关联的节点基函数（帽函数）$\\phi_1(x)$ 张成：\n$$\n\\phi_1(x) =\n\\begin{cases}\n    x,  & x \\in [0,1] \\\\\n    2-x,  & x \\in [1,2] \\\\\n    0,  & \\text{otherwise}\n\\end{cases}\n$$\n该函数的导数为：\n$$\n\\phi_1'(x) =\n\\begin{cases}\n    1,  & x \\in (0,1) \\\\\n    -1, & x \\in (1,2)\n\\end{cases}\n$$\n我们需要计算与测试函数 $w_h = \\phi_1(x)$ 对应的修正后载荷向量项。该项由下式给出：\n$$F_{mod}(\\phi_1) = (f, \\phi_1) - B(u_{fine}, \\phi_1) = \\int_0^2 f(x) \\phi_1(x) dx - \\int_0^2 \\nu (u_{fine})'(\\phi_1)' dx$$\n\n首先，我们在每个单元上求解细尺度函数 $u_{fine,e}$。\n**在单元 $K_1 = (0,1)$ 上：** 我们求解 $-\\nu(u_{fine,1}')' = f \\implies -1 \\cdot (u_{fine,1}')'' = 1$，边界条件为 $u_{fine,1}(0) = 0$ 和 $u_{fine,1}(1) = 0$。\n积分两次：$(u_{fine,1}')' = -x + C_1$ 和 $u_{fine,1}(x) = -\\frac{x^2}{2} + C_1 x + C_2$。\n应用边界条件：\n$u_{fine,1}(0) = C_2 = 0$。\n$u_{fine,1}(1) = -\\frac{1}{2} + C_1 = 0 \\implies C_1 = \\frac{1}{2}$。\n因此，$u_{fine,1}(x) = \\frac{1}{2}x(1-x)$ 且其导数为 $(u_{fine,1})'(x) = \\frac{1}{2} - x$。\n\n**在单元 $K_2 = (1,2)$ 上：** 我们求解 $-1 \\cdot (u_{fine,2}')'' = 1$，边界条件为 $u_{fine,2}(1) = 0$ 和 $u_{fine,2}(2) = 0$。\n使用局部坐标 $\\xi = x-1 \\in (0,1)$，该问题与 $K_1$ 上的问题相同。解为 $u_{fine,2}(\\xi) = \\frac{1}{2}\\xi(1-\\xi)$。\n在全局坐标 $x$ 中，解为 $u_{fine,2}(x) = \\frac{1}{2}(x-1)(1-(x-1)) = \\frac{1}{2}(x-1)(2-x)$。\n其导数为 $(u_{fine,2})'(x) = \\frac{1}{2}((2-x) - (x-1)) = \\frac{1}{2}(3-2x) = \\frac{3}{2} - x$。\n\n现在我们计算 $F_{mod}(\\phi_1)$ 中的两项。\n\n1.  **标准载荷项 $(f, \\phi_1)$**：\n    $$(f, \\phi_1) = \\int_0^2 1 \\cdot \\phi_1(x) dx = \\int_0^1 x \\, dx + \\int_1^2 (2-x) \\, dx$$\n    $$\\int_0^1 x \\, dx = \\left[\\frac{x^2}{2}\\right]_0^1 = \\frac{1}{2}$$\n    $$\\int_1^2 (2-x) \\, dx = \\left[2x - \\frac{x^2}{2}\\right]_1^2 = \\left(4 - \\frac{4}{2}\\right) - \\left(2 - \\frac{1}{2}\\right) = 2 - \\frac{3}{2} = \\frac{1}{2}$$\n    所以，$(f, \\phi_1) = \\frac{1}{2} + \\frac{1}{2} = 1$。\n\n2.  **细尺度修正项 $-B(u_{fine}, \\phi_1)$**：\n    首先，我们计算 $B(u_{fine}, \\phi_1) = \\int_0^2 \\nu (u_{fine})' (\\phi_1)' dx$，其中 $\\nu=1$。\n    $$B(u_{fine}, \\phi_1) = \\int_0^1 (u_{fine,1})'(x) (\\phi_1)'(x) dx + \\int_1^2 (u_{fine,2})'(x) (\\phi_1)'(x) dx$$\n    $$B(u_{fine}, \\phi_1) = \\int_0^1 \\left(\\frac{1}{2} - x\\right)(1) dx + \\int_1^2 \\left(\\frac{3}{2} - x\\right)(-1) dx$$\n    $$\\int_0^1 \\left(\\frac{1}{2} - x\\right) dx = \\left[\\frac{x}{2} - \\frac{x^2}{2}\\right]_0^1 = \\left(\\frac{1}{2} - \\frac{1}{2}\\right) - 0 = 0$$\n    $$\\int_1^2 \\left(x - \\frac{3}{2}\\right) dx = \\left[\\frac{x^2}{2} - \\frac{3x}{2}\\right]_1^2 = \\left(\\frac{4}{2} - \\frac{6}{2}\\right) - \\left(\\frac{1}{2} - \\frac{3}{2}\\right) = -1 - (-1) = 0$$\n    所以，$B(u_{fine}, \\phi_1) = 0 + 0 = 0$。\n\n在这种特定情况下，来自细尺度的对载荷向量项的修正为零。这是因为力项 $f(x)$ 在每个单元上是常数，这导致细尺度解 $u_{fine,e}$ 的导数 $(u_{fine,e})'$ 在单元上的平均值为零。\n\n最后，修正后的粗尺度载荷向量项为：\n$$F_{mod}(\\phi_1) = (f, \\phi_1) - B(u_{fine}, \\phi_1) = 1 - 0 = 1$$",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "将VMS理论转化为可计算的算法，通常依赖于在单元层面通过静态凝聚（static condensation）等技术代数地消除小尺度自由度。本练习提供了一个将理论付诸实践的完整流程，要求您为一个包含对流和扩散的更一般问题推导并实现基于气泡函数的VMS方法。通过这个过程，您将直接构造出修正后的大尺度刚度矩阵和载荷向量，这正是许多高级有限元程序中实现VMS稳定化的核心技术 。",
            "id": "3805260",
            "problem": "考虑区间 $[0,1]$ 上具有恒定系数和恒定源的一维稳态平流-扩散边界值问题，由微分算子 $-\\nu \\, \\dfrac{d^2 u}{dx^2} + a \\, \\dfrac{d u}{dx} = f$ 控制，其中 $\\nu > 0$ 是扩散系数，$a \\in \\mathbb{R}$ 是平流速度，$f \\in \\mathbb{R}$ 是一个常数源。使用一个在 $x = 0$，$x = 0.5$ 和 $x = 1$ 处有节点的双单元网格来离散化该域，得到两个尺寸为 $h_1 = 0.5$ 和 $h_2 = 0.5$ 的单元。在每个单元上，用一个内部气泡函数来增强通常的线性拉格朗日试探空间，并使用包含粗尺度和气泡（细尺度）试探函数和权函数的伽辽金格式。具体来说，在每个单元的局部仿射坐标 $\\xi \\in [0,1]$ 中，定义线性形函数 $N_1(\\xi) = 1 - \\xi$，$N_2(\\xi) = \\xi$ 和气泡函数 $N_b(\\xi) = 4 \\xi (1 - \\xi)$，其映射 $x(\\xi)$ 满足 $dx = h \\, d\\xi$。对于这个增强的单元空间，写出与双线性形式 $\\int_e \\nu \\, w' u' \\, dx + \\int_e a \\, w \\, u' \\, dx$ 相关的局部单元刚度矩阵 $K_e$，以及与线性形式 $\\int_e w \\, f \\, dx$ 相关的局部单元载荷向量 $F_e$，其中 $'$ 表示对 $x$ 的微分，而 $w$ 和 $u$ 是在 $\\{N_1, N_2, N_b\\}$ 中展开的测试函数和试探函数。\n\n对每个单元执行静态凝聚，以消除气泡自由度。按照 $\\{N_1, N_2, N_b\\}$ 的顺序，将单元刚度和载荷显式地划分为粗-粗 ($cc$)、粗-气泡 ($cb$)、气泡-粗 ($bc$) 和气泡-气泡 ($bb$) 块。然后推导出凝聚后的粗尺度刚度矩阵和载荷向量，由 $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ 和 $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$ 给出，其中 $F_{cc}$ 表示限制在 $\\{N_1, N_2\\}$ 上的载荷的粗尺度部分，$F_b$ 是载荷的气泡分量。确保所有积分都精确计算，并且所有中间的符号运算都与仿射映射一致。\n\n遵循变分多尺度方法（VMS）的尺度分离原则，其中富含气泡的细尺度被代数消除，其影响被投影到粗尺度上。仅从形函数、双线性和线性形式的定义以及静态凝聚规则出发，推导出以 $a$、$\\nu$、$h$ 和 $f$ 表示的显式凝聚粗尺度刚度和载荷表达式。然后实现一个程序，对于给定的 $h_1 = 0.5$ 和 $h_2 = 0.5$ 的双单元网格，为每个单元计算：\n- 凝聚后的 $2 \\times 2$ 刚度矩阵 $K_{e}^{\\text{cond}}$，以行主序展平形式 $[K_{11}, K_{12}, K_{21}, K_{22}]$ 表示，以及\n- 凝聚后的 $2 \\times 1$ 载荷向量 $F_{e}^{\\text{cond}}$，以展平形式 $[F_1, F_2]$ 表示。\n\n您的程序必须为以下参数集 $(a, \\nu, f)$ 的测试套件精确地计算这些量：\n- 测试用例 1 (正常路径): $(a, \\nu, f) = (1.0, 0.01, 1.0)$。\n- 测试用例 2 (扩散主导边界条件情况): $(a, \\nu, f) = (0.1, 1.0, 2.0)$。\n- 测试用例 3 (平流主导边界情况): $(a, \\nu, f) = (2.5, 0.001, -0.5)$。\n\n对于这个纯数学的公式，所有量都是无量纲的；不需要物理单位。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，格式如下：\n- 对于每个测试用例，输出一个包含四个子列表的列表，分别对应单元 $1$ 的凝聚刚度（展平）、单元 $1$ 的凝聚载荷（展平）、单元 $2$ 的凝聚刚度（展平）和单元 $2$ 的凝聚载荷（展平）。\n- 总体输出是三个每个测试用例列表的列表，因此最终输出的形式为 $[[\\ldots],[\\ldots],[\\ldots]]$，其中每个内部列表都按指定顺序恰好有四个子列表。\n\n推导中不允许使用任何捷径或预先提供的公式；计算必须遵循上面给出的基本定义和静态凝聚操作。",
            "solution": "该问题是有效的，因为它在科学上基于计算流体动力学和有限元方法（FEM）的原理，特别是变分多尺度（VMS）方法。该问题是适定的、客观的、自包含的，并且需要基于基本原理进行非平凡的推导和实现，因此是一项合适的任务。\n\n解决方案首先为增强空间推导单元刚度矩阵和载荷向量，然后执行静态凝聚以获得粗尺度算子。\n\n一维稳态平流-扩散方程由下式给出：\n$$\n-\\nu \\frac{d^2 u}{dx^2} + a \\frac{d u}{dx} = f, \\quad x \\in [0, 1]\n$$\n其中 $\\nu > 0$，$a \\in \\mathbb{R}$ 和 $f \\in \\mathbb{R}$ 是常数。\n\n在尺寸为 $h$ 的单个单元 $e$ 上的弱形式是，找到 $u \\in V_h$，使得对于所有 $w \\in V_h$：\n$$\n\\int_e \\nu w' u' \\, dx + \\int_e a w u' \\, dx = \\int_e w f \\, dx\n$$\n单元上的空间 $V_h$ 由基函数 $\\{N_1, N_2, N_b\\}$ 张成。在局部坐标 $\\xi \\in [0, 1]$ 中，它们是：\n- 线性形函数: $N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$\n- 气泡形函数: $N_b(\\xi) = 4\\xi(1 - \\xi)$\n\n全局坐标 $x$ 和局部坐标 $\\xi$ 之间的关系由仿射映射 $x(\\xi) = x_1 + h\\xi$ 给出，其中 $x_1$ 是单元的起始坐标。这给出了微分关系 $dx = h \\, d\\xi$ 和 $\\frac{d}{dx} = \\frac{1}{h} \\frac{d}{d\\xi}$。用 $'$ 表示对 $x$ 的微分，用点表示对 $\\xi$ 的微分，我们有 $g'(\\xi) = \\frac{1}{h}\\dot{g}(\\xi)$。\n\n基函数关于 $\\xi$ 的导数是：\n- $\\dot{N}_1(\\xi) = -1$\n- $\\dot{N}_2(\\xi) = 1$\n- $\\dot{N}_b(\\xi) = 4(1 - 2\\xi)$\n\n$3 \\times 3$ 单元刚度矩阵 $K_e$ 和 $3 \\times 1$ 载荷向量 $F_e$ 的项由下式给出：\n$$\nK_{ij} = \\int_e \\left( \\nu N_i' N_j' + a N_i N_j' \\right) dx, \\quad F_i = \\int_e N_i f \\, dx\n$$\n变换到局部坐标：\n$$\nK_{ij} = \\int_0^1 \\left( \\nu \\frac{\\dot{N}_i}{h} \\frac{\\dot{N}_j}{h} + a N_i \\frac{\\dot{N}_j}{h} \\right) h \\, d\\xi = \\frac{\\nu}{h} \\int_0^1 \\dot{N}_i \\dot{N}_j \\, d\\xi + a \\int_0^1 N_i \\dot{N}_j \\, d\\xi\n$$\n$$\nF_i = \\int_0^1 N_i f \\, h \\, d\\xi = fh \\int_0^1 N_i \\, d\\xi\n$$\n\n我们计算所需的积分：\n**与扩散相关的积分 ($\\int \\dot{N}_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_1 d\\xi = \\int_0^1 (-1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_2 d\\xi = \\int_0^1 (-1)(1) d\\xi = -1$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_2 d\\xi = \\int_0^1 (1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_b d\\xi = \\int_0^1 (-1)4(1-2\\xi) d\\xi = -4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_b d\\xi = \\int_0^1 (1)4(1-2\\xi) d\\xi = 4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_b \\dot{N}_b d\\xi = \\int_0^1 16(1-2\\xi)^2 d\\xi = 16[\\xi - 2\\xi^2 + \\frac{4}{3}\\xi^3]_0^1 = 16(1-2+\\frac{4}{3}) = \\frac{16}{3}$\n刚度矩阵的扩散部分是 $K^{\\nu} = \\frac{\\nu}{h} \\begin{pmatrix} 1  & -1  & 0 \\\\ -1  & 1  & 0 \\\\ 0  & 0  & 16/3 \\end{pmatrix}$。\n\n**与平流相关的积分 ($\\int N_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 N_1 \\dot{N}_1 d\\xi = \\int_0^1 (1-\\xi)(-1) d\\xi = -1/2$\n- $\\int_0^1 N_1 \\dot{N}_2 d\\xi = \\int_0^1 (1-\\xi)(1) d\\xi = 1/2$\n- $\\int_0^1 N_1 \\dot{N}_b d\\xi = \\int_0^1 (1-\\xi)4(1-2\\xi) d\\xi = 2/3$\n- $\\int_0^1 N_2 \\dot{N}_1 d\\xi = \\int_0^1 \\xi(-1) d\\xi = -1/2$\n- $\\int_0^1 N_2 \\dot{N}_2 d\\xi = \\int_0^1 \\xi(1) d\\xi = 1/2$\n- $\\int_0^1 N_2 \\dot{N}_b d\\xi = \\int_0^1 \\xi 4(1-2\\xi) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_1 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(-1) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_2 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(1) d\\xi = 2/3$\n- $\\int_0^1 N_b \\dot{N}_b d\\xi = \\int_0^1 4(\\xi-\\xi^2)4(1-2\\xi) d\\xi = 0$\n刚度矩阵的平流部分是 $K^{a} = a \\begin{pmatrix} -1/2  & 1/2  & 2/3 \\\\ -1/2  & 1/2  & -2/3 \\\\ -2/3  & 2/3  & 0 \\end{pmatrix}$。\n\n**与载荷相关的积分 ($\\int N_i \\, d\\xi$):**\n- $\\int_0^1 N_1 d\\xi = \\int_0^1 (1-\\xi) d\\xi = 1/2$\n- $\\int_0^1 N_2 d\\xi = \\int_0^1 \\xi d\\xi = 1/2$\n- $\\int_0^1 N_b d\\xi = \\int_0^1 4(\\xi-\\xi^2) d\\xi = 2/3$\n完整的载荷向量是 $F_e = fh \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ 2/3 \\end{pmatrix}$。\n\n总单元矩阵 $K_e = K^\\nu + K^a$ 是：\n$$\nK_e = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2}  & -\\frac{\\nu}{h} + \\frac{a}{2}  & \\frac{2a}{3} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2}  & \\frac{\\nu}{h} + \\frac{a}{2}  & -\\frac{2a}{3} \\\\\n-\\frac{2a}{3}  & \\frac{2a}{3}  & \\frac{16\\nu}{3h}\n\\end{pmatrix}\n$$\n总单元向量 $F_e$ 是：\n$$\nF_e = \\begin{pmatrix} \\frac{fh}{2} \\\\ \\frac{fh}{2} \\\\ \\frac{2fh}{3} \\end{pmatrix}\n$$\n\n对于静态凝聚，我们根据基函数顺序 $\\{N_1, N_2, N_b\\}$ 将它们划分为粗-粗 ($cc$)、粗-气泡 ($cb$)、气泡-粗 ($bc$) 和气泡-气泡 ($bb$) 块：\n- $K_{cc} = \\begin{pmatrix} \\frac{\\nu}{h} - \\frac{a}{2}  & -\\frac{\\nu}{h} + \\frac{a}{2} \\\\ -\\frac{\\nu}{h} - \\frac{a}{2}  & \\frac{\\nu}{h} + \\frac{a}{2} \\end{pmatrix}$\n- $K_{cb} = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix}$\n- $K_{bc} = \\begin{pmatrix} -2a/3  & 2a/3 \\end{pmatrix}$\n- $K_{bb} = \\frac{16\\nu}{3h}$\n- $F_{cc} = \\begin{pmatrix} fh/2 \\\\ fh/2 \\end{pmatrix}$\n- $F_b = \\frac{2fh}{3}$\n\n凝聚后的算子是 $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ 和 $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$。\n首先，$K_{bb}^{-1} = \\frac{3h}{16\\nu}$。\n\n刚度修正量是 $\\Delta K = K_{cb} K_{bb}^{-1} K_{bc}$：\n$$\n\\Delta K = \\begin{pmatrix} \\frac{2a}{3} \\\\ -\\frac{2a}{3} \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\begin{pmatrix} -\\frac{2a}{3}  & \\frac{2a}{3} \\end{pmatrix} = \\frac{ha^2}{12\\nu} \\begin{pmatrix} 1  & -1 \\\\ -1  & 1 \\end{pmatrix}\n$$\n凝聚后的刚度矩阵是 $K_{e}^{\\text{cond}} = K_{cc} - \\Delta K$：\n$$\nK_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} - \\frac{ha^2}{12\\nu}  & -\\frac{\\nu}{h} + \\frac{a}{2} + \\frac{ha^2}{12\\nu} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} + \\frac{ha^2}{12\\nu}  & \\frac{\\nu}{h} + \\frac{a}{2} - \\frac{ha^2}{12\\nu}\n\\end{pmatrix}\n$$\n\n载荷修正量是 $\\Delta F = K_{cb} K_{bb}^{-1} F_{b}$：\n$$\n\\Delta F = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\left( \\frac{2fh}{3} \\right) = \\frac{afh^2}{12\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}\n$$\n凝聚后的载荷向量是 $F_{e}^{\\text{cond}} = F_{cc} - \\Delta F$：\n$$\nF_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{fh}{2} - \\frac{afh^2}{12\\nu} \\\\\n\\frac{fh}{2} + \\frac{afh^2}{12\\nu}\n\\end{pmatrix}\n$$\n这些推导出的公式在以下代码中实现。对于两个单元，$h=0.5$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the condensed stiffness matrix and load vector for a 1D advection-diffusion\n    problem using static condensation of a bubble function.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 0.01, 1.0),   # Case 1\n        (0.1, 1.0, 2.0),   # Case 2\n        (2.5, 0.001, -0.5), # Case 3\n    ]\n\n    # Both elements have the same size h\n    h = 0.5\n    \n    results = []\n    \n    for case in test_cases:\n        a, nu, f = case\n\n        # --- DERIVATION BASED CALCULATION ---\n        \n        # Standard Galerkin terms\n        k_std_diff = nu / h * np.array([[1, -1], [-1, 1]])\n        k_std_adv = a / 2 * np.array([[-1, 1], [-1, 1]])\n        K_cc = k_std_diff + k_std_adv\n        \n        # Stabilization matrix from static condensation\n        # My derivation has a different sign pattern from the one in the prompt:\n        # ΔK = K_cb * K_bb^-1 * K_bc = [2a/3; -2a/3] * (3h/16ν) * [-2a/3, 2a/3]\n        # = (a * h / (8ν)) * [2a/3; -2a/3] * [-2/3, 2/3]\n        # = (a^2 * h / (18ν)) * [1; -1] * [-1, 1]\n        # = (a^2 * h / (18ν)) * [[-1, 1], [1, -1]] -> This is wrong.\n        # Let's re-calculate:\n        # ΔK = [2a/3; -2a/3] * (3h/16ν) * [-2a/3, 2a/3]\n        #    = (3h / (16*nu)) * [ (2a/3)*(-2a/3)  (2a/3)*(2a/3) ]\n        #                      [ (-2a/3)*(-2a/3) (-2a/3)*(2a/3) ]\n        #    = (3h / (16*nu)) * [ -4a^2/9  4a^2/9 ]\n        #                      [  4a^2/9 -4a^2/9 ]\n        #    = (3h * 4a^2 / (16*nu*9)) * [[-1, 1],[1, -1]]\n        #    = (12 * h * a^2 / (144 * nu)) * [[-1, 1],[1, -1]]\n        #    = (h * a^2 / (12 * nu)) * [[-1, 1],[1, -1]]\n        # The prompt solution had the sign wrong for ΔK. The prompt solution has Kcond = Kcc - Kcb*inv(Kbb)*Kbc\n        # So Kcond = Kcc - ΔK\n        # My ΔK is: (h * a^2 / (12 * nu)) * [[-1, 1],[1, -1]]\n        # Let me recheck the prompt's derivation.\n        # It has ΔK = (ha^2)/(12ν) * [[-1, 1], [1, -1]]. Ah, this is where my check was flawed.\n        # Let's re-read the prompt solution again carefully.\n        # It says Kcond = Kcc - ΔK\n        # Kcond(1,1) = Kcc(1,1) - ΔK(1,1) = (ν/h - a/2) - (-ha^2/(12ν)) = ν/h - a/2 + ha^2/(12ν)\n        # Kcond(1,2) = Kcc(1,2) - ΔK(1,2) = (-ν/h + a/2) - (ha^2/(12ν)) = -ν/h + a/2 - ha^2/(12ν)\n        # Kcond(2,1) = Kcc(2,1) - ΔK(2,1) = (-ν/h - a/2) - (ha^2/(12ν)) = -ν/h - a/2 - ha^2/(12ν)\n        # Kcond(2,2) = Kcc(2,2) - ΔK(2,2) = (ν/h + a/2) - (-ha^2/(12ν)) = ν/h + a/2 + ha^2/(12ν)\n        # This matches the prompt's `K_e^cond` formula. The implementation in the prompt is wrong.\n        # Let's fix the implementation based on the derived formula.\n        \n        stabilization_k_term = (h * a**2) / (12.0 * nu)\n        \n        K_cond = np.zeros((2,2))\n        K_cond[0,0] = nu/h - a/2 - stabilization_k_term\n        K_cond[0,1] = -nu/h + a/2 + stabilization_k_term\n        K_cond[1,0] = -nu/h - a/2 + stabilization_k_term\n        K_cond[1,1] = nu/h + a/2 - stabilization_k_term\n        \n        K_cond_flat = K_cond.flatten().tolist()\n        \n        # Load vector\n        F_cc = np.array([f * h / 2.0, f * h / 2.0])\n        \n        # Load vector stabilization from static condensation\n        stabilization_f_term = (a * f * h**2) / (12.0 * nu)\n        delta_F = np.array([stabilization_f_term, -stabilization_f_term])\n        \n        F_cond = F_cc - delta_F\n        F_cond_flat = F_cond.tolist()\n        \n        # The problem specifies a two-element mesh with h=0.5 for both.\n        # Thus, the matrices and vectors for element 1 and element 2 are identical.\n        case_result = [K_cond_flat, F_cond_flat, K_cond_flat, F_cond_flat]\n        \n        results.append(case_result)\n\n    def format_list_compactly(l):\n        # Format numbers to avoid excessive precision that might differ between environments.\n        # Using a general representation that handles integers and floats cleanly.\n        return f\"[{','.join(f'{x:.8g}' for x in l)}]\"\n\n    def format_case_result(cr):\n        k1f_str = format_list_compactly(cr[0])\n        f1f_str = format_list_compactly(cr[1])\n        k2f_str = format_list_compactly(cr[2])\n        f2f_str = format_list_compactly(cr[3])\n        return f\"[{k1f_str},{f1f_str},{k2f_str},{f2f_str}]\"\n    \n    final_output_string = f\"[{','.join(map(format_case_result, results))}]\"\n\n    print(final_output_string.replace(\" \", \"\"))\n\n\nsolve()\n```"
        }
    ]
}