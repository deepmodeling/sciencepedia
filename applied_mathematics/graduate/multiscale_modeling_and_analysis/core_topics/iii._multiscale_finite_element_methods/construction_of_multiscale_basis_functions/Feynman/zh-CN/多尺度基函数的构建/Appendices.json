{
    "hands_on_practices": [
        {
            "introduction": "多尺度方法的核心思想是在粗网格上表示细尺度效应。标准的有限元基函数，如线性的“帽子”函数，无法感知材料属性（例如扩散系数 $\\kappa(x)$）在网格单元内部的变化。相比之下，多尺度基函数通过求解包含这种细尺度信息的局部偏微分方程来构建。这项练习  提供了一个直接的定量比较，通过计算和对比标准有限元方法（FEM）与多尺度有限元方法（MsFEM）的粗尺度刚度矩阵项，具体揭示了MsFEM如何捕捉到标准FEM所忽略的有效属性，这一过程也称为“升尺度”。",
            "id": "3746099",
            "problem": "考虑在区域 $\\Omega=(0,2)$ 上的一个一维扩散问题，该问题使用一个双单元粗网格，其粗网格节点为 $x_0=0$、$x_1=1$ 和 $x_2=2$。设扩散系数 $\\kappa(x)$ 为分段常数，定义为当 $x\\in(0,\\frac{1}{2})\\cup(\\frac{3}{2},2)$ 时 $\\kappa(x)=1$，当 $x\\in(\\frac{1}{2},1)\\cup(1,\\frac{3}{2})$ 时 $\\kappa(x)=100$。假设所有量均为无量纲。\n\n在粗网格上使用分段线性“帽子”基函数 $\\{\\phi_0,\\phi_1,\\phi_2\\}$ 定义标准有限元方法 (FEM)。定义多尺度有限元方法 (MsFEM) 如下：在每个粗单元 $\\Omega_e=(x_{e-1},x_e)$ 上，通过求解局部齐次方程 $-(\\kappa(x)\\,\\psi'(x))'=0$ 来构建局部基函数，该方程满足插值粗网格节点值的狄利克雷(Dirichlet)边界条件。然后，以协调方法的标准方式拼接这些局部解，以组装全局多尺度基函数 $\\{\\Phi_0,\\Phi_1,\\Phi_2\\}$。\n\n对于每种方法，全局刚度矩阵的矩阵元为 $K_{ij}=\\int_{\\Omega}\\kappa(x)\\,\\psi_i'(x)\\,\\psi_j'(x)\\,dx$，其中 $\\{\\psi_i\\}$ 代表相应的全局基 $\\{\\phi_i\\}$ 或 $\\{\\Phi_i\\}$。计算两种方法的组装矩阵，并通过计算比率 $R=\\dfrac{K_{11}^{\\mathrm{MsFEM}}}{K_{11}^{\\mathrm{FEM}}}$ 来量化升尺度效应，其中 $K_{11}$ 是与内部节点 $x_1=1$ 相关联的中间对角元。\n\n以简化的精确表达式形式给出单个标量比率 $R$。如果选择近似计算，请将答案四舍五入到四位有效数字。",
            "solution": "本问题要求计算并比较标准有限元法 (FEM) 和多尺度有限元法 (MsFEM) 在一个具有高对比度介质的一维问题中的刚度矩阵中心对角元 $K_{11}$。\n\n**1. 标准有限元法 (FEM) 刚度矩阵元 $K_{11}^{\\mathrm{FEM}}$**\n\n对于内部节点 $x_1=1$，标准线性“帽子”基函数 $\\phi_1(x)$ 在单元 $(0,1)$ 上为 $x$，在单元 $(1,2)$ 上为 $2-x$。其导数 $\\phi_1'(x)$ 在 $(0,1)$ 上为 $1$，在 $(1,2)$ 上为 $-1$。\n刚度矩阵元 $K_{11}^{\\mathrm{FEM}}$ 的计算公式为：\n$$\nK_{11}^{\\mathrm{FEM}} = \\int_{0}^{2} \\kappa(x) (\\phi_1'(x))^2 \\, dx = \\int_{0}^{1} \\kappa(x) (1)^2 \\, dx + \\int_{1}^{2} \\kappa(x) (-1)^2 \\, dx\n$$\n根据题目给出的 $\\kappa(x)$ 定义：\n- 第一个积分：\n  $$ \\int_{0}^{1} \\kappa(x) \\, dx = \\int_{0}^{1/2} 1 \\, dx + \\int_{1/2}^{1} 100 \\, dx = 0.5 + 100(0.5) = 50.5 $$\n- 第二个积分：\n  $$ \\int_{1}^{2} \\kappa(x) \\, dx = \\int_{1}^{3/2} 100 \\, dx + \\int_{3/2}^{2} 1 \\, dx = 100(0.5) + 0.5 = 50.5 $$\n因此，\n$$\nK_{11}^{\\mathrm{FEM}} = 50.5 + 50.5 = 101\n$$\n\n**2. 多尺度有限元法 (MsFEM) 刚度矩阵元 $K_{11}^{\\mathrm{MsFEM}}$**\n\n多尺度基函数 $\\Phi_1(x)$ 是通过拼接两个局部问题的解得到的：\n- 在单元 $(0,1)$ 上，求解 $-(\\kappa(x)\\psi'(x))' = 0$，边界条件为 $\\psi(0)=0, \\psi(1)=1$。\n- 在单元 $(1,2)$ 上，求解 $-(\\kappa(x)\\psi'(x))' = 0$，边界条件为 $\\psi(1)=1, \\psi(2)=0$。\n\n$K_{11}^{\\mathrm{MsFEM}}$ 是这两个局部问题的能量（或刚度）之和。\n对于第一个局部问题（在 $(0,1)$ 上），通量 $\\kappa(x)\\psi'(x) = C_1$ 是常数。因此 $\\psi'(x) = C_1/\\kappa(x)$。\n利用边界条件 $\\psi(1) - \\psi(0) = 1$：\n$$\n\\int_0^1 \\psi'(x) \\, dx = C_1 \\int_0^1 \\frac{dx}{\\kappa(x)} = 1 \\implies C_1 = \\frac{1}{\\int_0^1 \\frac{dx}{\\kappa(x)}}\n$$\n计算积分：\n$$\n\\int_0^1 \\frac{dx}{\\kappa(x)} = \\int_0^{1/2} \\frac{dx}{1} + \\int_{1/2}^1 \\frac{dx}{100} = 0.5 + \\frac{0.5}{100} = 0.505\n$$\n所以 $C_1 = 1/0.505$。\n该单元的刚度贡献为：\n$$\n\\int_0^1 \\kappa(x) (\\psi'(x))^2 \\, dx = \\int_0^1 \\kappa(x) \\left(\\frac{C_1}{\\kappa(x)}\\right)^2 \\, dx = C_1^2 \\int_0^1 \\frac{dx}{\\kappa(x)} = \\frac{1}{(0.505)^2} \\cdot 0.505 = \\frac{1}{0.505}\n$$\n由于问题是对称的，单元 $(1,2)$ 上的刚度贡献同样为 $1/0.505$。\n因此，总的刚度矩阵元为：\n$$\nK_{11}^{\\mathrm{MsFEM}} = \\frac{1}{0.505} + \\frac{1}{0.505} = \\frac{2}{0.505} = \\frac{2}{505/1000} = \\frac{2000}{505} = \\frac{400}{101}\n$$\n\n**3. 计算比率 $R$**\n\n最后，我们计算比率 $R$：\n$$\nR = \\frac{K_{11}^{\\mathrm{MsFEM}}}{K_{11}^{\\mathrm{FEM}}} = \\frac{400/101}{101} = \\frac{400}{101^2} = \\frac{400}{10201}\n$$",
            "answer": "$$\\boxed{\\frac{400}{10201}}$$"
        },
        {
            "introduction": "我们已经看到MsFEM能够产生与标准方法不同的有效属性，接下来我们将研究这对求解精度的具体影响。本练习  探讨了一个具有高对比度介质的扩散问题，其特殊之处在于粗网格与材料界面不重合——在这种情况下，标准方法通常会表现不佳。通过将MsFEM近似解的能量范数误差与标准FEM的误差进行比较，我们可以清晰地看到使用基于物理的基函数的实际好处。这个编程练习展示了MsFEM的卓越精度，并强调了它在处理具有复杂、未解析介质问题时的重要性。",
            "id": "3746076",
            "problem": "考虑一维、二阶、线性椭圆边值问题\n$$\n-(\\kappa(x)\\,u'(x))' = f(x), \\quad x \\in (0,1), \\quad u(0)=0, \\quad u(1)=0,\n$$\n其中系数是具有高对比度分界面的分段常数，\n$$\n\\kappa(x)=\\begin{cases}\n1,  x\\in(0,1/2),\\\\\n\\epsilon,  x\\in(1/2,1),\n\\end{cases}\n$$\n且源项为常数，$f(x)=1$。目标是在一个与分界面不对齐的固定粗网格上，量化两种粗尺度近似的误差：\n- 一个标准的分段线性有限元法 (FEM) 基函数，以及\n- 一个通过局部单元求解构建的多尺度有限元法 (MsFEM) 谐波基函数。\n\n使用粗网格节点 $x_0=0$、$x_1=0.6$ 和 $x_2=1$，因此粗单元为 $(0,0.6)$ 和 $(0.6,1)$，而系数分界面位于第一个粗单元内部的 $x_i=0.5$ 处。设唯一的内部粗自由度与节点 $x_1=0.6$ 相关联。\n\n通过在每个粗单元上进行线性插值，定义与 $x_1$ 相关的标准有限元法帽子基函数 $\\varphi(x)$：\n$$\n\\varphi(x)=\\begin{cases}\n\\frac{x-0}{0.6-0},  x\\in[0,0.6],\\\\\n\\frac{1-x}{1-0.6},  x\\in[0.6,1],\\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\n使得 $\\varphi(0)=0$，$\\varphi(0.6)=1$ 且 $\\varphi(1)=0$。\n\n通过在每个粗单元 $K$ 上求解以下方程，定义与 $x_1$ 相关的多尺度有限元法谐波基函数 $\\psi(x)$：\n$$\n-(\\kappa(x)\\,\\psi_K'(x))'=0\\quad \\text{for }x\\in K,\n$$\n其 Dirichlet 边界条件等于 $K$ 端点处的粗网格节点值。具体而言：\n- 在 $(0,0.6)$ 上，施加 $\\psi(0)=0$ 和 $\\psi(0.6)=1$，同时在 $x=0.5$ 处强制要求 $\\psi$ 和通量 $\\kappa(x)\\psi'(x)$ 的连续性。\n- 在 $(0.6,1)$ 上，施加 $\\psi(0.6)=1$ 和 $\\psi(1)=0$。\n\n对于每个基 $\\phi\\in\\{\\varphi,\\psi\\}$，构成由 $\\phi$ 张成的一维 Galerkin 近似空间，因此粗网格解的形式为 $u_h(x)=c\\,\\phi(x)$，其中 $c$ 由单自由度 Galerkin 方程确定：\n$$\na\\,c=b,\\quad a=\\int_0^1 \\kappa(x)\\,(\\phi'(x))^2\\,dx,\\quad b=\\int_0^1 f(x)\\,\\phi(x)\\,dx.\n$$\n\n通过求解在 $(0,1/2)$ 和 $(1/2,1)$ 上的分段常微分方程，并满足 $u$ 和通量 $\\kappa(x)u'(x)$ 在 $x=1/2$ 处的连续性，来计算精确解 $u(x)$：\n- 在 $\\kappa(x)=1$ 的 $(0,1/2)$ 上，求解 $-u''(x)=1$。\n- 在 $\\kappa(x)=\\epsilon$ 的 $(1/2,1)$ 上，求解 $-\\epsilon\\,u''(x)=1$。\n应用边界条件 $u(0)=0$、$u(1)=0$，并施加 $u(1/2^-)=u(1/2^+)$ 以及 $\\kappa(1/2^-)\\,u'(1/2^-)=\\kappa(1/2^+)\\,u'(1/2^+)$ 来确定积分常数。\n\n测量每种近似的能量范数误差，\n$$\n\\mathcal{E}(\\phi;\\epsilon)=\\int_0^1 \\kappa(x)\\,\\big(u'(x)-u_h'(x)\\big)^2\\,dx,\n$$\n其中 $u_h'(x)=c\\,\\phi'(x)$。\n\n实现上述构造，并为以下对比度参数测试集计算能量范数误差：\n- $\\epsilon=1.0$ (无对比度)，\n- $\\epsilon=10^{-2}$ (中等对比度)，\n- $\\epsilon=10^{-6}$ (高对比度)。\n\n你的程序应生成一行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，顺序如下：\n$$\n[\\mathcal{E}(\\varphi;1.0),\\ \\mathcal{E}(\\psi;1.0),\\ \\mathcal{E}(\\varphi;10^{-2}),\\ \\mathcal{E}(\\psi;10^{-2}),\\ \\mathcal{E}(\\varphi;10^{-6}),\\ \\mathcal{E}(\\psi;10^{-6})].\n$$\n所有量均为无量纲；不涉及物理单位。不出现角度。将所有数值输出表示为普通十进制浮点数。",
            "solution": "用户提供了一个来自偏微分方程数值分析领域的适定问题。任务是比较标准有限元法 (FEM) 和多尺度有限元法 (MsFEM) 在求解一个具有高对比度系数的一维椭圆问题时的精度。对问题陈述的验证证实了其科学性、一致性和完整性。\n\n解题过程分为四个主要步骤：\n1.  推导精确解 $u(x)$ 的解析形式。\n2.  推导标准有限元法基函数 $\\varphi(x)$ 和多尺度有限元法谐波基函数 $\\psi(x)$ 的解析形式。\n3.  为两种基函数计算 Galerkin 方法和能量误差公式所需的项。\n4.  对每个基函数和每个指定的对比度参数 $\\epsilon$ 值，计算能量误差的数值。\n\n### 步骤1：精确解 $u(x)$\n问题为 $-(\\kappa(x)u'(x))' = 1$，定义在 $(0,1)$ 上，且有 $u(0)=u(1)=0$。\n系数为 $\\kappa(x)=1$（对于 $x \\in (0, 1/2)$）和 $\\kappa(x)=\\epsilon$（对于 $x \\in (1/2, 1)$）。\n\n在 $(0, 1/2)$ 上，方程为 $-u_1''(x)=1$。其通解为 $u_1(x) = -\\frac{1}{2}x^2 + A_1 x + B_1$。边界条件 $u(0)=0$ 意味着 $B_1=0$，因此 $u_1(x) = -\\frac{1}{2}x^2 + A_1 x$。\n\n在 $(1/2, 1)$ 上，方程为 $-\\epsilon u_2''(x)=1$，即 $u_2''(x)=-1/\\epsilon$。其通解为 $u_2(x) = -\\frac{1}{2\\epsilon}x^2 + A_2 x + B_2$。边界条件 $u(1)=0$ 意味着 $-\\frac{1}{2\\epsilon} + A_2 + B_2 = 0$，因此 $B_2 = \\frac{1}{2\\epsilon} - A_2$。\n\n在分界面 $x=1/2$ 处，我们强制要求解的连续性，$u_1(1/2)=u_2(1/2)$，和通量的连续性，$\\kappa(1/2^-)u_1'(1/2) = \\kappa(1/2^+)u_2'(1/2)$。\n-   $u_1'(x) = -x + A_1$ 且 $u_2'(x) = -x/\\epsilon + A_2$。\n-   $u$ 的连续性：$-\\frac{1}{8} + \\frac{A_1}{2} = -\\frac{1}{8\\epsilon} + \\frac{A_2}{2} + (\\frac{1}{2\\epsilon} - A_2) = \\frac{3}{8\\epsilon} - \\frac{A_2}{2}$。这可以简化为 $A_1+A_2 = \\frac{1}{4} + \\frac{3}{4\\epsilon}$。\n-   通量的连续性：$1 \\cdot (-1/2 + A_1) = \\epsilon \\cdot (-1/(2\\epsilon) + A_2)$，得到 $-1/2 + A_1 = -1/2 + \\epsilon A_2$，所以 $A_1 = \\epsilon A_2$。\n\n求解关于 $A_1$ 和 $A_2$ 的方程组：\n$(\\epsilon A_2) + A_2 = \\frac{1}{4} + \\frac{3}{4\\epsilon} \\implies A_2(1+\\epsilon) = \\frac{\\epsilon+3}{4\\epsilon}$。\n这给出 $A_2 = \\frac{3+\\epsilon}{4\\epsilon(1+\\epsilon)}$ 和 $A_1 = \\epsilon A_2 = \\frac{3+\\epsilon}{4(1+\\epsilon)}$。\n\n精确解为：\n$$\nu(x) = \\begin{cases}\n-\\frac{1}{2}x^2 + \\frac{3+\\epsilon}{4(1+\\epsilon)} x,  x \\in [0, 1/2] \\\\\n-\\frac{x^2-1}{2\\epsilon} + \\frac{3+\\epsilon}{4\\epsilon(1+\\epsilon)}(x-1),  x \\in (1/2, 1]\n\\end{cases}\n$$\n其导数为：\n$$\nu'(x) = \\begin{cases}\n-x + \\frac{3+\\epsilon}{4(1+\\epsilon)},  x \\in (0, 1/2) \\\\\n-\\frac{x}{\\epsilon} + \\frac{3+\\epsilon}{4\\epsilon(1+\\epsilon)},  x \\in (1/2, 1)\n\\end{cases}\n$$\n\n### 步骤2：基函数 $\\varphi(x)$ 和 $\\psi(x)$\n给定了标准线性基函数 $\\varphi(x)$。其导数是分段常数：\n$$\n\\varphi'(x) = \\begin{cases}\n1/0.6 = 5/3,  x \\in (0, 0.6) \\\\\n-1/0.4 = -5/2,  x \\in (0.6, 1)\n\\end{cases}\n$$\n\n多尺度有限元法基函数 $\\psi(x)$ 是通过在粗单元 $K_1=(0,0.6)$ 和 $K_2=(0.6,1)$ 上求解 $-(\\kappa \\psi')'=0$ 得到的。\n在 $K_1=(0,0.6)$ 上，给定 $\\psi(0)=0, \\psi(0.6)=1$：\n-   解是分段线性的。设在 $(0,0.5)$ 上 $\\psi(x) = C_1 x + D_1$，在 $(0.5,0.6)$ 上 $\\psi(x) = C_2 x + D_2$。\n-   $\\psi(0)=0 \\implies D_1=0$。\n-   $\\psi(0.6)=1 \\implies 0.6 C_2 + D_2 = 1$。\n-   $x=0.5$ 处的连续性：$\\psi(0.5^-)=\\psi(0.5^+) \\implies 0.5 C_1 = 0.5 C_2 + D_2$。\n-   $x=0.5$ 处的通量连续性：$1 \\cdot C_1 = \\epsilon \\cdot C_2$。\n-   解此线性方程组可得 $C_1 = \\frac{10\\epsilon}{1+5\\epsilon}$，$C_2 = \\frac{10}{1+5\\epsilon}$ 以及 $D_2 = \\frac{5\\epsilon-5}{1+5\\epsilon}$。\n\n在 $K_2=(0.6,1)$ 上，$\\kappa(x)=\\epsilon$ 是常数。谐波函数就是一个线性插值函数：$\\psi(x) = \\frac{1-x}{1-0.6} = 2.5(1-x)$。\n\n导数 $\\psi'(x)$ 是分段常数：\n$$\n\\psi'(x) = \\begin{cases}\nC_1 = \\frac{10\\epsilon}{1+5\\epsilon},  x \\in (0, 0.5) \\\\\nC_2 = \\frac{10}{1+5\\epsilon},  x \\in (0.5, 0.6) \\\\\nC_3 = -2.5,  x \\in (0.6, 1)\n\\end{cases}\n$$\n\n### 步骤3：能量误差计算\n能量范数误差由下式给出 $\\mathcal{E}(\\phi;\\epsilon) = \\int_0^1 \\kappa(x) (u'(x)-u_h'(x))^2 dx$。\n对于 Galerkin 方法，其中 $u_h = c\\,\\phi = (b/a)\\phi$，这简化为“最佳逼近”公式：\n$$\n\\mathcal{E}(\\phi;\\epsilon) = \\underbrace{\\int_0^1 \\kappa(x) (u'(x))^2 dx}_{\\text{精确解的能量}} - \\underbrace{\\frac{\\left(\\int_0^1 \\phi(x) dx\\right)^2}{\\int_0^1 \\kappa(x) (\\phi'(x))^2 dx}}_{\\text{近似解的能量}} = a(u,u) - \\frac{b^2}{a}\n$$\n第一项，即精确解的能量，可以计算为 $a(u,u) = \\int_0^1 f(x)u(x)dx = \\int_0^1 u(x)dx$。\n$$\nE_{\\text{exact}} = \\int_0^1 u(x)dx = \\frac{\\epsilon^2+14\\epsilon+1}{96\\epsilon(1+\\epsilon)}\n$$\n我们现在为每个基计算刚度项 $a$ 和载荷项 $b$。\n\n**对于 $\\phi = \\varphi$ (标准有限元法)：**\n-   刚度 $a_{\\text{fem}}$：\n    $a_{\\text{fem}} = \\int_0^{0.5} 1 \\cdot (5/3)^2 dx + \\int_{0.5}^{0.6} \\epsilon \\cdot (5/3)^2 dx + \\int_{0.6}^1 \\epsilon \\cdot (-5/2)^2 dx$\n    $a_{\\text{fem}} = \\frac{25}{9}(0.5) + \\epsilon \\frac{25}{9}(0.1) + \\epsilon \\frac{25}{4}(0.4) = \\frac{12.5}{9} + \\frac{2.5\\epsilon}{9} + 2.5\\epsilon = \\frac{25}{18}(1+2\\epsilon)$。\n-   载荷 $b_{\\text{fem}}$：\n    $b_{\\text{fem}} = \\int_0^1 \\varphi(x) dx = \\frac{1}{2} \\times \\text{底} \\times \\text{高} = \\frac{1}{2} \\times (1-0) \\times 1 = 0.5$。\n\n**对于 $\\phi = \\psi$ (多尺度有限元法)：**\n-   刚度 $a_{\\text{ms}}$：\n    $a_{\\text{ms}} = \\int_0^{0.5} 1 \\cdot (\\psi')^2 dx + \\int_{0.5}^{0.6} \\epsilon \\cdot (\\psi')^2 dx + \\int_{0.6}^1 \\epsilon \\cdot (\\psi')^2 dx$\n    $a_{\\text{ms}} = 1 \\cdot C_1^2 \\cdot (0.5) + \\epsilon \\cdot C_2^2 \\cdot (0.1) + \\epsilon \\cdot C_3^2 \\cdot (0.4)$\n    $a_{ms} = \\frac{1}{2} (\\frac{10\\epsilon}{1+5\\epsilon})^2 + \\frac{\\epsilon}{10} (\\frac{10}{1+5\\epsilon})^2 + \\frac{2\\epsilon}{5} (-2.5)^2 = \\frac{50\\epsilon^2 + 10\\epsilon}{(1+5\\epsilon)^2} + 2.5\\epsilon = \\frac{10\\epsilon(1+5\\epsilon)}{(1+5\\epsilon)^2} + 2.5\\epsilon = \\frac{10\\epsilon}{1+5\\epsilon} + 2.5\\epsilon$。\n-   载荷 $b_{\\text{ms}}$：\n    $b_{\\text{ms}} = \\int_0^{0.5} \\psi(x)dx + \\int_{0.5}^{0.6} \\psi(x)dx + \\int_{0.6}^1 \\psi(x)dx$\n    对分段线性函数进行积分后：\n    $b_{\\text{ms}} = \\frac{1.75\\epsilon+0.05}{1+5\\epsilon} + 0.2 = \\frac{2.75\\epsilon+0.25}{1+5\\epsilon}$。\n\n### 步骤4：数值计算\n对于每个 $\\epsilon \\in \\{1.0, 10^{-2}, 10^{-6}\\}$，我们计算 $\\mathcal{E}(\\varphi;\\epsilon) = E_{\\text{exact}} - b_{\\text{fem}}^2/a_{\\text{fem}}$ 和 $\\mathcal{E}(\\psi;\\epsilon) = E_{\\text{exact}} - b_{\\text{ms}}^2/a_{\\text{ms}}$。下面的实现将执行这些最终计算。对于 $\\epsilon=1$，处处有 $\\kappa(x)=1$，谐波基函数 $\\psi(x)$ 与线性基函数 $\\varphi(x)$ 完全相同，因而产生相同的误差。随着 $\\epsilon$ 的减小（对比度增加），多尺度有限元法基函数能更好地捕捉分界面附近的解行为，与标准有限元法相比，其误差显著更小。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the energy-norm error for standard FEM and MsFEM approximations\n    of a 1D elliptic problem with a high-contrast coefficient.\n    \"\"\"\n    \n    test_epsilons = [1.0, 1e-2, 1e-6]\n    results = []\n\n    for eps in test_epsilons:\n        # Step 1: Calculate the exact energy of the true solution u.\n        # E_exact = integral_0^1 kappa * (u')^2 dx = integral_0^1 f*u dx\n        # The analytical formula for integral_0^1 u(x) dx is derived in the solution text.\n        e_exact_num = eps**2 + 14 * eps + 1\n        e_exact_den = 96 * eps * (1 + eps)\n        e_exact = e_exact_num / e_exact_den\n\n        # Step 2: Calculate error for the standard FEM basis function phi.\n        # a_fem = integral_0^1 kappa * (phi')^2 dx\n        # b_fem = integral_0^1 f * phi dx, with f=1\n        a_fem = (25.0 / 18.0) * (1.0 + 2.0 * eps)\n        b_fem = 0.5\n        \n        # Energy of the FEM approximation\n        energy_fem_approx = b_fem**2 / a_fem\n        \n        # Energy norm of the error for FEM\n        error_fem = e_exact - energy_fem_approx\n        results.append(error_fem)\n        \n        # Step 3: Calculate error for the MsFEM basis function psi.\n        # a_ms = integral_0^1 kappa * (psi')^2 dx\n        # b_ms = integral_0^1 f * psi dx, with f=1\n        a_ms = (10.0 * eps) / (1.0 + 5.0 * eps) + 2.5 * eps\n        b_ms = (2.75 * eps + 0.25) / (1.0 + 5.0 * eps)\n        \n        # Energy of the MsFEM approximation\n        energy_msfem_approx = b_ms**2 / a_ms\n        \n        # Energy norm of the error for MsFEM\n        error_msfem = e_exact - energy_msfem_approx\n        results.append(error_msfem)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然基础的MsFEM功能强大，但其精度可能受到为求解局部问题而施加的人为边界条件的限制，这种限制有时会导致“共振误差”。本练习介绍了一种关键的改进技术——过采样（oversampling），以有效减轻这些人为边界效应。通过在更大的“过采样”域上求解局部问题，然后将解限制在原始粗网格单元上，所得到的基函数受人为边界条件的影响会更小。这项数值实验  让您通过比较标准基函数与过采样基函数的 $H^1$ 半范数，来量化过采样方法所带来的改善，为如何增强MsFEM框架的鲁棒性和准确性提供了实用的见解。",
            "id": "3746089",
            "problem": "考虑带周期性非均匀电导系数的一维标量椭圆算子。设全局计算域为 $[0,1]$，并固定一个粗单元 $K = [x_L,x_R] \\subset [0,1]$。多尺度有限元方法（MsFEM）的局部多尺度节点基函数定义如下。$K$ 上的非过采样左基函数 $\\phi^L$ 求解齐次局部问题\n$$\n-\\frac{d}{dx}\\left(\\kappa(x)\\frac{d\\phi^L}{dx}(x)\\right) = 0 \\quad \\text{in } K,\n$$\n其狄利克雷（Dirichlet）边界条件为\n$$\n\\phi^L(x_L) = 1, \\quad \\phi^L(x_R) = 0.\n$$\n相应的过采样左基函数 $\\phi_{\\text{os}}^L$ 通过在扩展区间 $K^+ = [x_L - \\delta, x_R + \\delta] \\cap [0,1]$ 上求解具有狄利克雷边界条件的相同齐次局部问题来定义\n$$\n\\phi_{\\text{os}}^L(x_L - \\delta) = 1, \\quad \\phi_{\\text{os}}^L(x_R + \\delta) = 0,\n$$\n然后将 $\\phi_{\\text{os}}^L$ 限制在 $K$ 上。$K$ 上的 $H^1$-半范数是\n$$\n\\left|\\phi\\right|_{H^1(K)} = \\left(\\int_{x_L}^{x_R}\\left|\\frac{d\\phi}{dx}(x)\\right|^2\\,dx\\right)^{1/2}.\n$$\n您将设计一个使用周期性 $\\kappa(x)$ 的数值实验，以比较 $\\left|\\phi^L\\right|_{H^1(K)}$ 和 $\\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)}$，并量化它们在 $K$ 上的差异。假设以下基本事实成立：(i) 局部基函数满足给定的边值问题；(ii) $\\kappa(x)$ 在 $[0,1]$ 上是严格正且周期性的；(iii) 数值积分（例如，复合梯形法则）可用于在均匀网格上近似定积分。\n\n您的程序必须对每个测试用例，在一个包含 $N$ 个区间的均匀细网格（网格尺寸 $h = 1/N$）上构建相关量，对于给定的整数 $m \\ge 0$ 设置 $\\delta = m h$，并计算差值\n$$\n\\Delta = \\left|\\phi^L\\right|_{H^1(K)} - \\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)}\n$$\n仅针对左基函数。此问题不涉及物理单位。\n\n使用以下四个测试用例，它们共同构成测试套件，并且必须完全按照规定进行评估：\n\n- 测试用例 1（正弦系数，中等对比度，非零过采样）：\n  - 全局域：$[0,1]$\n  - 粗单元：$K = [0.4,\\,0.6]$\n  - 细网格：$N = 5000$（因此 $h = 1/5000$）\n  - 过采样单元：$m = 100$（因此 $\\delta = 100 h$）\n  - 周期和参数：$\\epsilon = 0.02$, $k_0 = 2.0$, $k_1 = 1.0$\n  - 电导率：$\\kappa(x) = k_0 + k_1 \\sin\\!\\left(\\frac{2\\pi x}{\\epsilon}\\right)$\n\n- 测试用例 2（正弦系数，与测试用例 1 相同，但为零过采样）：\n  - 全局域：$[0,1]$\n  - 粗单元：$K = [0.4,\\,0.6]$\n  - 细网格：$N = 5000$\n  - 过采样单元：$m = 0$（因此 $\\delta = 0$）\n  - 周期和参数：$\\epsilon = 0.02$, $k_0 = 2.0$, $k_1 = 1.0$\n  - 电导率：$\\kappa(x) = k_0 + k_1 \\sin\\!\\left(\\frac{2\\pi x}{\\epsilon}\\right)$\n\n- 测试用例 3（正弦系数，高对比度，非零过采样）：\n  - 全局域：$[0,1]$\n  - 粗单元：$K = [0.25,\\,0.35]$\n  - 细网格：$N = 10000$\n  - 过采样单元：$m = 50$\n  - 周期和参数：$\\epsilon = 0.01$, $k_0 = 10.0$, $k_1 = 9.0$\n  - 电导率：$\\kappa(x) = k_0 + k_1 \\sin\\!\\left(\\frac{2\\pi x}{\\epsilon}\\right)$\n\n- 测试用例 4（分段常数周期系数，强对比度，非零过采样）：\n  - 全局域：$[0,1]$\n  - 粗单元：$K = [0.45,\\,0.55]$\n  - 细网格：$N = 6000$\n  - 过采样单元：$m = 60$\n  - 周期和参数：$\\epsilon = 0.05$, $k_{\\text{high}} = 10.0$, $k_{\\text{low}} = 1.0$\n  - 电导率：对于满足 $x/\\epsilon$ 的小数部分位于 $[0,\\,0.5)$ 内的 $x$，$\\kappa(x) = k_{\\text{high}}$，否则 $\\kappa(x) = k_{\\text{low}}$，在 $[0,1]$ 上周期性重复\n\n对于每个测试用例，将 $\\Delta$ 计算为浮点数。您的程序应生成单行输出，其中包含所有测试用例的结果，格式为方括号内以逗号分隔的列表，并按测试用例 1 到 4 的顺序排列（例如，$\\left[\\Delta_1,\\Delta_2,\\Delta_3,\\Delta_4\\right]$）。最终输出必须是实数。程序不应打印任何其他文本。多尺度有限元方法（MsFEM）的缩写在其首次出现时已明确定义。",
            "solution": "此问题有效。它提出了一个适定的数学任务，其理论基础是已建立的多尺度有限元方法（MsFEM）。所有需要的数据和定义都已提供，不存在科学或逻辑上的矛盾。我们将继续进行完整求解。\n\n问题的核心是求解一个一维二阶齐次常微分方程（ODE），以找到 MsFEM 基函数，然后计算它们在指定粗单元 $K = [x_L, x_R]$ 上的各自的 $H^1$-半范数。\n\n首先，我们找到局部问题的解析解：\n$$\n-\\frac{d}{dx}\\left(\\kappa(x)\\frac{d\\phi}{dx}(x)\\right) = 0\n$$\n其中 $\\kappa(x)$ 是一个严格为正的非均匀电导系数。将此方程对 $x$ 积分一次，得到：\n$$\n\\kappa(x)\\frac{d\\phi}{dx}(x) = -C_1\n$$\n其中 $C_1$ 是一个积分常数。由于 $\\kappa(x)  0$，我们可以重新整理并求解 $\\phi$ 的导数：\n$$\n\\frac{d\\phi}{dx}(x) = -\\frac{C_1}{\\kappa(x)}\n$$\n从起点 $x_a$ 到变量点 $x$ 再次积分，得到 $\\phi(x)$ 的通解：\n$$\n\\phi(x) - \\phi(x_a) = \\int_{x_a}^{x} \\left(-\\frac{C_1}{\\kappa(t)}\\right) dt = -C_1 \\int_{x_a}^{x} \\frac{dt}{\\kappa(t)}\n$$\n常数 $C_1$ 通过应用狄利克雷边界条件来确定，这些条件在区间 $[x_a, x_b]$ 上指定为 $\\phi(x_a) = y_a$ 和 $\\phi(x_b) = y_b$。令 $x=x_b$，我们得到：\n$$\n\\phi(x_b) - \\phi(x_a) = y_b - y_a = -C_1 \\int_{x_a}^{x_b} \\frac{dt}{\\kappa(t)}\n$$\n求解 $C_1$：\n$$\nC_1 = \\frac{y_a - y_b}{\\int_{x_a}^{x_b} \\frac{dt}{\\kappa(t)}}\n$$\n\n现在，我们将此通用框架应用于所需的两个特定基函数。\n\n**1. 非过采样左基函数, $\\phi^L(x)$**\n此函数定义在粗单元 $K=[x_L, x_R]$ 上，边界条件为 $\\phi^L(x_L) = 1$ 和 $\\phi^L(x_R) = 0$。这里，$x_a=x_L$，$y_a=1$，$x_b=x_R$，$y_b=0$。常数 $C_1^L$ 是：\n$$\nC_1^L = \\frac{1 - 0}{\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}} = \\frac{1}{\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}}\n$$\n因此，$\\phi^L(x)$ 的导数是：\n$$\n\\frac{d\\phi^L}{dx}(x) = - \\frac{C_1^L}{\\kappa(x)} = - \\frac{1}{\\kappa(x) \\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}}\n$$\n\n**2. 过采样左基函数, $\\phi_{\\text{os}}^L(x)$**\n此函数定义在过采样域 $K^+ = [x_L - \\delta, x_R + \\delta] \\cap [0,1]$ 上。设此有效域的边界为 $x_L' = \\max(x_L - \\delta, 0)$ 和 $x_R' = \\min(x_R + \\delta, 1)$。边界条件为 $\\phi_{\\text{os}}^L(x_L') = 1$ 和 $\\phi_{\\text{os}}^L(x_R') = 0$。\n相应的常数 $C_1^{\\text{os}}$ 是：\n$$\nC_1^{\\text{os}} = \\frac{1 - 0}{\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}} = \\frac{1}{\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}}\n$$\n$\\phi_{\\text{os}}^L(x)$ 在其定义域 $K^+$ 上的导数是：\n$$\n\\frac{d\\phi_{\\text{os}}^L}{dx}(x) = -\\frac{C_1^{\\text{os}}}{\\kappa(x)} = - \\frac{1}{\\kappa(x) \\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}}\n$$\n为了计算，我们将此函数及其导数限制在原始粗单元 $K=[x_L, x_R]$ 上。\n\n**$H^1$-半范数及其差值 $\\Delta$ 的计算**\n$K$ 上的 $H^1$-半范数由 $|\\phi|_{H^1(K)} = \\left(\\int_{x_L}^{x_R}\\left|\\frac{d\\phi}{dx}(x)\\right|^2\\,dx\\right)^{1/2}$ 给出。\n\n对于非过采样情况，我们将导数平方并在 $K$ 上积分：\n$$\n\\left|\\phi^L\\right|_{H^1(K)}^2 = \\int_{x_L}^{x_R} \\left( - \\frac{1}{\\kappa(x) \\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}} \\right)^2 dx = \\frac{\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}}{\\left(\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}\\right)^2}\n$$\n取平方根得到：\n$$\n\\left|\\phi^L\\right|_{H^1(K)} = \\frac{\\left(\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}\\right)^{1/2}}{\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}}\n$$\n对于过采样情况，过程是相同的，但导数是使用在较大域 $K^+$ 上的积分定义的。半范数仍然在 $K$ 上计算：\n$$\n\\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)}^2 = \\int_{x_L}^{x_R} \\left( - \\frac{1}{\\kappa(x) \\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}} \\right)^2 dx = \\frac{\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}}{\\left(\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}\\right)^2}\n$$\n取平方根得到：\n$$\n\\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)} = \\frac{\\left(\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}\\right)^{1/2}}{\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}}\n$$\n我们观察到分子项，我们称之为 $J = \\left(\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}\\right)^{1/2}$，是两个表达式共有的。那么，所求的差值 $\\Delta$ 是：\n$$\n\\Delta = \\left|\\phi^L\\right|_{H^1(K)} - \\left|\\phi_{\\text{os}}^L\\right|_{H^1(K)} = J \\left[ \\frac{1}{\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}} - \\frac{1}{\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}} \\right]\n$$\n对于测试用例 2，我们有 $m=0$，这意味着 $\\delta = 0$。因此，$x_L'=x_L$ 且 $x_R'=x_R$，导致方括号中的两项相同。因此，在这种情况下 $\\Delta = 0$，这符合预期。\n\n**数值实现策略**\n该问题需要数值求解。策略如下：\n1. 对于每个测试用例，定义参数 $N$、$m$、$x_L$、$x_R$ 以及 $\\kappa(x)$ 的参数。\n2. 为域 $[0,1]$ 构建一个具有 $N+1$ 个点的均匀细网格：$x_i = i h$，$i=0, \\dots, N$，其中 $h=1/N$。\n3. 在每个网格点 $x_i$ 上评估指定的 $\\kappa(x)$，以生成一个电导率值数组。\n4. 计算过采样量 $\\delta = m h$ 并确定过采样区间的边界 $x_L' = \\max(x_L - \\delta, 0)$ 和 $x_R' = \\min(x_R + \\delta, 1)$。\n5. 确定与区间边界 $x_L, x_R, x_L'$ 和 $x_R'$ 对应的网格索引。\n6. 使用复合梯形法则（例如由 `numpy.trapz` 实现）计算必要的定积分：$\\int_{x_L}^{x_R} \\frac{dt}{\\kappa(t)}$，$\\int_{x_L'}^{x_R'} \\frac{dt}{\\kappa(t)}$ 和 $\\int_{x_L}^{x_R} \\frac{dx}{\\kappa(x)^2}$。\n7. 将这些数值代入推导出的 $\\Delta$ 公式中，以获得最终结果。\n对所有四个测试用例重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the difference in H1-seminorm between standard and oversampled\n    MsFEM basis functions for several test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            'K': (0.4, 0.6), 'N': 5000, 'm': 100, \n            'kappa_type': 'sin', 'params': {'eps': 0.02, 'k0': 2.0, 'k1': 1.0}\n        },\n        {\n            'K': (0.4, 0.6), 'N': 5000, 'm': 0, \n            'kappa_type': 'sin', 'params': {'eps': 0.02, 'k0': 2.0, 'k1': 1.0}\n        },\n        {\n            'K': (0.25, 0.35), 'N': 10000, 'm': 50, \n            'kappa_type': 'sin', 'params': {'eps': 0.01, 'k0': 10.0, 'k1': 9.0}\n        },\n        {\n            'K': (0.45, 0.55), 'N': 6000, 'm': 60, \n            'kappa_type': 'pw_const', 'params': {'eps': 0.05, 'k_high': 10.0, 'k_low': 1.0}\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract parameters for the current test case\n        xL, xR = case['K']\n        N = case['N']\n        m = case['m']\n        \n        # If there is no oversampling, the difference is zero by definition.\n        if m == 0:\n            results.append(0.0)\n            continue\n\n        # Set up the fine grid and oversampling parameters\n        h = 1.0 / N\n        delta = m * h\n        x_fine = np.linspace(0.0, 1.0, N + 1)\n        \n        # Evaluate the conductivity coefficient kappa(x) on the fine grid\n        if case['kappa_type'] == 'sin':\n            eps = case['params']['eps']\n            k0 = case['params']['k0']\n            k1 = case['params']['k1']\n            kappa_fine = k0 + k1 * np.sin(2.0 * np.pi * x_fine / eps)\n        elif case['kappa_type'] == 'pw_const':\n            eps = case['params']['eps']\n            k_high = case['params']['k_high']\n            k_low = case['params']['k_low']\n            # kappa is k_high if frac(x/eps) is in [0, 0.5), k_low otherwise\n            kappa_fine = np.where(np.mod(x_fine / eps, 1.0)  0.5, k_high, k_low)\n        \n        # Prepare integrands 1/kappa and 1/kappa^2\n        inv_kappa = 1.0 / kappa_fine\n        inv_kappa_sq = 1.0 / (kappa_fine**2)\n        \n        # Determine integration limits as indices on the fine grid\n        iL = int(round(xL * N))\n        iR = int(round(xR * N))\n        \n        # Effective boundaries of the oversampled domain, clipped to [0,1]\n        xL_os = max(xL - delta, 0.0)\n        xR_os = min(xR + delta, 1.0)\n        iL_os = int(round(xL_os * N))\n        iR_os = int(round(xR_os * N))\n        \n        # Compute the required definite integrals using the composite trapezoidal rule\n        \n        # Integral of 1/kappa(t) over the non-oversampled coarse element K\n        I1_K = np.trapz(inv_kappa[iL : iR + 1], x_fine[iL : iR + 1])\n        \n        # Integral of 1/kappa(t) over the oversampled coarse element K+\n        I1_K_os = np.trapz(inv_kappa[iL_os : iR_os + 1], x_fine[iL_os : iR_os + 1])\n        \n        # Integral of 1/kappa(x)^2 over the non-oversampled coarse element K\n        I2_K = np.trapz(inv_kappa_sq[iL : iR + 1], x_fine[iL : iR + 1])\n        \n        # Compute the final difference Delta using the derived formula\n        J = np.sqrt(I2_K)\n        delta_val = J * (1.0 / I1_K - 1.0 / I1_K_os)\n        \n        results.append(delta_val)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}