{
    "hands_on_practices": [
        {
            "introduction": "The core idea of the Variational Multiscale Method (VMS) is the decomposition of a solution into coarse and fine scales. This first exercise makes the abstract decomposition $u = u_H + u'$ tangible by solving for the fine-scale component $u'$ within a single finite element for a simple 1D diffusion problem. By performing this calculation , you will explicitly see how the fine-scale component captures the part of the true solution that the coarse-scale linear approximation misses, revealing it to be a computable function that corrects the coarse solution locally.",
            "id": "3830100",
            "problem": "Consider the steady one-dimensional diffusion problem on the interval $[0,L]$ governed by the strong form\n$$-a \\dfrac{d^{2}u}{dx^{2}} = q,$$\nwhere $a>0$ is a constant diffusivity and $q$ is a constant source. In the Variational Multiscale Method (VMS), decompose the solution as $u = u_{H} + u^{\\prime}$, where $u_{H}$ belongs to the standard continuous, piecewise linear finite element space on a mesh with nodes $\\{x_{j}\\}$, and $u^{\\prime}$ is a fine-scale component that vanishes at all mesh nodes. Focus on a single element $e = [x_{i}, x_{i+1}]$ of length $h = x_{i+1} - x_{i}$.\n\nInside the element $e$, the coarse-scale field $u_{H}(x)$ is represented by the hat functions as\n$$u_{H}(x) = N_{i}(x)\\,U_{i} + N_{i+1}(x)\\,U_{i+1},$$\nwith nodal values $U_{i}$ and $U_{i+1}$, and the element-wise hat functions\n$$N_{i}(x) = \\dfrac{x_{i+1} - x}{h}, \\qquad N_{i+1}(x) = \\dfrac{x - x_{i}}{h}.$$\nAssume the fine-scale component $u^{\\prime}(x)$ satisfies homogeneous Dirichlet conditions at the element endpoints,\n$$u^{\\prime}(x_{i}) = 0, \\qquad u^{\\prime}(x_{i+1}) = 0.$$\n\nStarting from the governing equation and the VMS decomposition $u = u_{H} + u^{\\prime}$, derive the local fine-scale equation inside the element $e$ and solve it exactly under the above endpoint conditions to obtain the explicit fine-scale $u^{\\prime}(x)$ as a function of $x$, $x_{i}$, $x_{i+1}$, $a$, and $q$. Then, write the full split solution $u(x) = u_{H}(x) + u^{\\prime}(x)$ inside the element $e$ as a single closed-form expression involving $U_{i}$, $U_{i+1}$, $x$, $x_{i}$, $x_{i+1}$, $a$, and $q$.\n\nYour final answer must be that single analytic expression for $u(x)$ on $[x_{i},x_{i+1}]$. No rounding is required. Express your answer without units.",
            "solution": "The problem is governed by the steady one-dimensional diffusion equation\n$$-a \\dfrac{d^{2}u}{dx^{2}} = q,$$\nwhere $a>0$ is constant and $q$ is constant. The Variational Multiscale Method (VMS) posits a decomposition of the solution into coarse and fine scales,\n$$u = u_{H} + u^{\\prime},$$\nwhere $u_{H}$ lies in the standard continuous, piecewise linear finite element space, and $u^{\\prime}$ lies in the complementary fine-scale space that vanishes at mesh nodes. On a given element $e=[x_{i},x_{i+1}]$ with length $h = x_{i+1}-x_{i}$, the coarse-scale field is\n$$u_{H}(x) = U_{i} \\dfrac{x_{i+1}-x}{h} + U_{i+1} \\dfrac{x - x_{i}}{h}.$$\nBy construction of the piecewise linear basis, the element-wise second derivative of $u_{H}(x)$ vanishes in the interior of the element,\n$$\\dfrac{d^{2}u_{H}}{dx^{2}} = 0 \\quad \\text{for } x \\in (x_{i}, x_{i+1}).$$\n\nInsert the VMS decomposition into the strong form:\n$$-a \\dfrac{d^{2}}{dx^{2}}(u_{H} + u^{\\prime}) = q.$$\nThis yields\n$$-a \\dfrac{d^{2}u^{\\prime}}{dx^{2}} = q + a \\dfrac{d^{2}u_{H}}{dx^{2}}.$$\nUsing $\\dfrac{d^{2}u_{H}}{dx^{2}} = 0$ in the element interior, the fine-scale equation inside $e$ reduces to the constant-coefficient ordinary differential equation\n$$-a \\dfrac{d^{2}u^{\\prime}}{dx^{2}} = q \\quad \\text{for } x \\in (x_{i}, x_{i+1}).$$\nThe fine-scale satisfies homogeneous Dirichlet conditions at the element endpoints,\n$$u^{\\prime}(x_{i}) = 0, \\qquad u^{\\prime}(x_{i+1}) = 0.$$\n\nSolve the fine-scale ODE. Rewrite it as\n$$\\dfrac{d^{2}u^{\\prime}}{dx^{2}} = -\\dfrac{q}{a}.$$\nIntegrate twice:\n$$u^{\\prime}(x) = -\\dfrac{q}{2a} x^{2} + C_{1} x + C_{2}.$$\nImpose $u^{\\prime}(x_{i})=0$:\n$$0 = -\\dfrac{q}{2a} x_{i}^{2} + C_{1} x_{i} + C_{2},$$\nand $u^{\\prime}(x_{i+1})=0$:\n$$0 = -\\dfrac{q}{2a} x_{i+1}^{2} + C_{1} x_{i+1} + C_{2}.$$\nSubtract the first from the second:\n$$0 = -\\dfrac{q}{2a}(x_{i+1}^{2} - x_{i}^{2}) + C_{1}(x_{i+1} - x_{i}).$$\nSince $x_{i+1}^{2}-x_{i}^{2} = (x_{i+1}-x_{i})(x_{i+1}+x_{i})$ and $h = x_{i+1} - x_{i}$,\n$$0 = -\\dfrac{q}{2a} h (x_{i+1} + x_{i}) + C_{1} h,$$\nhence\n$$C_{1} = \\dfrac{q}{2a} (x_{i+1} + x_{i}).$$\nUse $u^{\\prime}(x_{i})=0$ to find $C_{2}$:\n$$0 = -\\dfrac{q}{2a} x_{i}^{2} + \\dfrac{q}{2a} (x_{i+1}+x_{i}) x_{i} + C_{2} \\quad \\Rightarrow \\quad C_{2} = \\dfrac{q}{2a} \\left[x_{i}^{2} - (x_{i+1}+x_{i}) x_{i}\\right] = -\\dfrac{q}{2a} x_{i} x_{i+1}.$$\nTherefore,\n$$u^{\\prime}(x) = -\\dfrac{q}{2a} x^{2} + \\dfrac{q}{2a} (x_{i+1}+x_{i}) x - \\dfrac{q}{2a} x_{i} x_{i+1}.$$\nThis can be factored as:\n$$u^{\\prime}(x) = \\dfrac{q}{2a} \\left[ -x^{2} + (x_{i+1}+x_{i}) x - x_{i} x_{i+1} \\right] = \\dfrac{q}{2a} (x - x_{i})(x_{i+1} - x).$$\nThus, the fine-scale inside the element is the quadratic bubble\n$$u^{\\prime}(x) = \\dfrac{q}{2a} (x - x_{i})(x_{i+1} - x).$$\n\nThe coarse-scale field inside the element is\n$$u_{H}(x) = U_{i} \\dfrac{x_{i+1}-x}{h} + U_{i+1} \\dfrac{x - x_{i}}{h}.$$\nCombine coarse and fine scales to obtain the full split solution inside the element:\n$$u(x) = U_{i} \\dfrac{x_{i+1}-x}{h} + U_{i+1} \\dfrac{x - x_{i}}{h} + \\dfrac{q}{2a} (x - x_{i})(x_{i+1} - x), \\qquad h = x_{i+1} - x_{i}.$$\n\nThis is a single closed-form analytic expression in terms of $U_{i}$, $U_{i+1}$, $x$, $x_{i}$, $x_{i+1}$, $a$, and $q$, as required.",
            "answer": "$$\\boxed{U_{i}\\,\\frac{x_{i+1}-x}{x_{i+1}-x_{i}} \\;+\\; U_{i+1}\\,\\frac{x-x_{i}}{x_{i+1}-x_{i}} \\;+\\; \\frac{q}{2a}\\,(x-x_{i})\\,(x_{i+1}-x)}$$"
        },
        {
            "introduction": "A key outcome of VMS is its ability to systematically generate stabilization terms that are essential for robust numerical simulations of transport-dominated phenomena. This practice demonstrates this process for the 1D advection-diffusion equation, a classic testbed for numerical stability . You will model the fine-scale behavior using a bubble function and derive the resulting stabilization parameter $\\tau_{K}$, uncovering the direct link between the underlying subgrid physics and established stabilization techniques.",
            "id": "3830072",
            "problem": "Consider the one-dimensional steady advection–diffusion model with constant coefficients on an element $K=(0,h)$:\n$$\nL u := -\\epsilon \\frac{d^{2}u}{dx^{2}} + \\beta \\frac{du}{dx}, \\quad \\epsilon>0,\\; \\beta \\in \\mathbb{R}.\n$$\nIn the residual-based Variational Multiscale Method (VMS), decompose the solution as $u = u_{h} + u'$, where $u_{h}$ lies in the continuous, piecewise-linear finite element space and the fine-scale $u'$ vanishes on the element boundaries. Use the one-bubble fine-scale model on $K$, namely assume $u'(x) = c\\, b(x)$ with the standard bubble\n$$\nb(x) = 4\\frac{x}{h}\\left(1 - \\frac{x}{h}\\right), \\quad x \\in (0,h).\n$$\nDefine the element residual as $R(u_{h}) := L u_{h} - f$. Take $f \\equiv 0$ so that $R(u_{h}) = L u_{h}$. Enforce the fine-scale equation on $K$ in the Galerkin sense with the bubble test function, that is, choose $c \\in \\mathbb{R}$ such that\n$$\n\\big(L(c\\,b),\\, b\\big)_{K} = \\big(R(u_{h}),\\, b\\big)_{K},\n$$\nwhere $(\\cdot,\\cdot)_{K}$ denotes the $L^{2}(K)$ inner product. The induced stabilization contribution in the coarse-scale weak form on $K$ is\n$$\nS_{K}(w_{h},u_{h}) := \\big(L^{*} w_{h},\\, u'\\big)_{K},\n$$\nwhere $w_{h}$ is any coarse-scale test function (piecewise-linear on $K$) and $L^{*}$ is the $L^{2}$-adjoint of $L$. Because $w_{h}''=0$ on $K$ and $R(u_{h})$ is constant on $K$ for piecewise-linear $u_{h}$, this contribution can be written in the streamline-upwind form\n$$\nS_{K}(w_{h},u_{h}) \\;=\\; -\\int_{K} \\tau_{K}\\, \\beta \\frac{dw_{h}}{dx}\\, R(u_{h}) \\, dx,\n$$\nfor a scalar stabilization parameter $\\tau_{K}$ depending only on $h$ and $\\epsilon$ under the one-bubble model above.\n\nStarting from these definitions and assumptions only, derive the closed-form expression for the element-level stabilization parameter $\\tau_{K}$ as a function of $h$ and $\\epsilon$. Your final answer must be a single analytic expression for $\\tau_{K}$.",
            "solution": "The derivation proceeds by first finding the coefficient $c$ that defines the fine-scale solution $u'$, then substituting this into the definition of the stabilization term $S_K$, and finally comparing the result to the given target form to identify $\\tau_K$.\n\n**1. Determine the fine-scale coefficient $c$**\nThe fine-scale equation is $\\big(L(c\\,b),\\, b\\big)_{K} = \\big(R(u_{h}),\\, b\\big)_{K}$. As $c$ is a constant, this gives:\n$$c = \\dfrac{\\big(R(u_{h}),\\, b\\big)_{K}}{\\big(L(b),\\, b\\big)_{K}}$$\nSince $u_h$ is piecewise-linear on element $K=(0,h)$, its second derivative $\\frac{d^2u_h}{dx^2}$ is zero and its first derivative $\\frac{du_h}{dx}$ is constant. The residual is $R(u_h) = L u_h = -\\epsilon \\frac{d^2u_h}{dx^2} + \\beta \\frac{du_h}{dx} = \\beta \\frac{du_h}{dx}$, which is a constant on $K$. Let's denote this constant value by $R_K$.\n\nThe numerator is $\\big(R(u_{h}),\\, b\\big)_{K} = \\int_0^h R_K b(x) dx = R_K \\int_0^h b(x) dx$. The integral of the bubble function is:\n$$\\int_0^h b(x) dx = \\int_0^h 4\\left(\\dfrac{x}{h} - \\dfrac{x^2}{h^2}\\right) dx = 4 \\left[\\dfrac{x^2}{2h} - \\dfrac{x^3}{3h^2}\\right]_0^h = 4 \\left(\\dfrac{h}{2} - \\dfrac{h}{3}\\right) = \\dfrac{2h}{3}$$\nSo, the numerator is $\\big(R(u_{h}),\\, b\\big)_{K} = R_K \\frac{2h}{3}$.\n\nThe denominator is $\\big(L(b),\\, b\\big)_{K} = \\int_0^h \\left(-\\epsilon \\frac{d^2b}{dx^2} + \\beta \\frac{db}{dx}\\right) b(x) dx$.\nFor the diffusion part, we use integration by parts and the fact that $b(0)=b(h)=0$:\n$$\\int_0^h -\\epsilon \\dfrac{d^2b}{dx^2} b(x) dx = -\\epsilon \\left[ \\dfrac{db}{dx} b(x) \\right]_0^h + \\epsilon \\int_0^h \\left(\\dfrac{db}{dx}\\right)^2 dx = \\epsilon \\int_0^h \\left(\\dfrac{db}{dx}\\right)^2 dx$$\nThe derivative of $b(x)$ is $\\frac{db}{dx} = \\frac{4}{h} - \\frac{8x}{h^2}$. The integral of its square is:\n$$\\int_0^h \\left(\\dfrac{db}{dx}\\right)^2 dx = \\int_0^h \\left(\\dfrac{4}{h} - \\dfrac{8x}{h^2}\\right)^2 dx = \\left[\\dfrac{16x}{h^2} - \\dfrac{32x^2}{h^3} + \\dfrac{64x^3}{3h^4}\\right]_0^h = \\dfrac{16}{h} - \\dfrac{32}{h} + \\dfrac{64}{3h} = \\dfrac{16}{3h}$$\nFor the advection part, the integral is $\\int_0^h \\beta \\frac{db}{dx} b(x) dx = \\frac{\\beta}{2} \\int_0^h \\frac{d}{dx}(b^2) dx = \\frac{\\beta}{2} [b(x)^2]_0^h = 0$.\nThe denominator is thus $\\big(L(b),\\, b\\big)_{K} = \\epsilon \\frac{16}{3h}$.\n\nNow we can find $c$:\n$$c = \\dfrac{R_K \\frac{2h}{3}}{\\frac{16\\epsilon}{3h}} = R_K \\dfrac{2h}{3} \\dfrac{3h}{16\\epsilon} = \\dfrac{R_K h^2}{8\\epsilon}$$\nThe fine-scale solution is $u'(x) = c b(x) = \\frac{R_K h^2}{8\\epsilon} b(x)$.\n\n**2. Calculate the stabilization term $S_K$**\nThe stabilization term is $S_{K}(w_{h},u_{h}) = \\big(L^{*} w_{h},\\, u'\\big)_{K}$. The formal adjoint of $L$ is $L^{*} = -\\epsilon\\frac{d^2}{dx^2} - \\beta\\frac{d}{dx}$. As the test function $w_h$ is piecewise-linear, $\\frac{d^2w_h}{dx^2}=0$, so $L^* w_h = -\\beta \\frac{dw_h}{dx}$. Let $w'_K = \\frac{dw_h}{dx}$ be this constant value on $K$.\n$$S_K = \\int_0^h \\left(-\\beta w'_K\\right) u'(x) dx = -\\beta w'_K \\int_0^h u'(x) dx$$\nWe substitute the expression for $u'(x)$:\n$$\\int_0^h u'(x) dx = \\int_0^h \\dfrac{R_K h^2}{8\\epsilon} b(x) dx = \\dfrac{R_K h^2}{8\\epsilon} \\int_0^h b(x) dx = \\dfrac{R_K h^2}{8\\epsilon} \\dfrac{2h}{3} = \\dfrac{R_K h^3}{12\\epsilon}$$\nSubstituting this back into the expression for $S_K$:\n$$S_K = -\\beta w'_K \\left(\\dfrac{R_K h^3}{12\\epsilon}\\right) = -\\beta \\dfrac{dw_h}{dx} R(u_h) \\dfrac{h^3}{12\\epsilon}$$\n\n**3. Identify the stabilization parameter $\\tau_K$**\nThe problem states that $S_K$ can be written as $S_K = -\\int_{K} \\tau_{K}\\, \\beta \\frac{dw_{h}}{dx}\\, R(u_{h}) \\, dx$.\nSince $\\tau_K$, $\\beta$, $\\frac{dw_h}{dx}$, and $R(u_h)$ are constant over the element $K$, we can take them out of the integral:\n$$S_K = - \\tau_K \\beta \\dfrac{dw_h}{dx} R(u_h) \\int_0^h dx = - \\tau_K \\beta \\dfrac{dw_h}{dx} R(u_h) h$$\nEquating the two derived expressions for $S_K$:\n$$- \\tau_K \\beta \\dfrac{dw_h}{dx} R(u_h) h = -\\beta \\dfrac{dw_h}{dx} R(u_h) \\dfrac{h^3}{12\\epsilon}$$\nAssuming $\\beta, \\frac{dw_h}{dx}, R(u_h)$ are not identically zero, we cancel these terms from both sides:\n$$\\tau_K h = \\dfrac{h^3}{12\\epsilon}$$\nSolving for $\\tau_K$ gives the final expression for the stabilization parameter:\n$$\\tau_K = \\dfrac{h^2}{12\\epsilon}$$\nThis result depends only on the element size $h$ and the diffusion coefficient $\\epsilon$, as required by the problem statement.",
            "answer": "$$\\boxed{\\frac{h^{2}}{12\\epsilon}}$$"
        },
        {
            "introduction": "To apply VMS within a finite element code, the influence of the fine scales must be incorporated into the coarse-scale system of equations. This practice guides you through the algebraic procedure of static condensation, where fine-scale \"bubble\" degrees of freedom are eliminated to produce a modified, stabilized coarse-scale system . By deriving and then implementing the computation for the condensed stiffness matrix and load vector, you will translate the VMS theory into a practical and efficient computational algorithm.",
            "id": "3805260",
            "problem": "Consider the one-dimensional steady advection–diffusion boundary value problem on the interval $[0,1]$ with constant coefficients and a constant source, governed by the differential operator $-\\nu \\, \\dfrac{d^2 u}{dx^2} + a \\, \\dfrac{d u}{dx} = f$, where $\\nu > 0$ is the diffusion coefficient, $a \\in \\mathbb{R}$ is the advection velocity, and $f \\in \\mathbb{R}$ is a constant source. Discretize the domain using a two-element mesh with nodes at $x = 0$, $x = 0.5$, and $x = 1$, yielding two elements with sizes $h_1 = 0.5$ and $h_2 = 0.5$. On each element, augment the usual linear Lagrange trial space with a single interior bubble function, and use the Galerkin formulation that includes both coarse and bubble (fine-scale) trial and weighting functions. Specifically, on each element in the local affine coordinate $\\xi \\in [0,1]$, define the linear shape functions $N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$, and the bubble function $N_b(\\xi) = 4 \\xi (1 - \\xi)$, with the mapping $x(\\xi)$ such that $dx = h \\, d\\xi$. For this augmented element space, write the local element stiffness matrix $K_e$ associated with the bilinear form $\\int_e \\nu \\, w' u' \\, dx + \\int_e a \\, w \\, u' \\, dx$, and the local element load vector $F_e$ associated with the linear form $\\int_e w \\, f \\, dx$, where $'$ denotes differentiation with respect to $x$, and $w$ and $u$ are test and trial functions expanded in $\\{N_1, N_2, N_b\\}$.\n\nPerform static condensation to eliminate the bubble degree of freedom on each element. Explicitly partition the element stiffness and load into coarse-coarse ($cc$), coarse-bubble ($cb$), bubble-coarse ($bc$), and bubble-bubble ($bb$) blocks consistent with the ordering $\\{N_1, N_2, N_b\\}$. Then derive the condensed coarse-scale stiffness matrix and load vector given by $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ and $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$, where $F_{cc}$ denotes the coarse-scale part of the load restricted to $\\{N_1, N_2\\}$, and $F_b$ is the bubble component of the load. Ensure that all integrals are evaluated exactly and that all intermediate symbolic operations are done consistently with the affine mapping.\n\nFollow the scale separation principle of the Variational Multiscale Method (VMS), where the bubble-enriched fine scale is algebraically eliminated and its effect is projected onto the coarse scale. Starting only from the definitions of the shape functions, the bilinear and linear forms, and the static condensation rule, derive the explicit condensed coarse-scale stiffness and load expressions in terms of $a$, $\\nu$, $h$, and $f$. Then implement a program that, for the given two-element mesh with $h_1 = 0.5$ and $h_2 = 0.5$, computes for each element:\n- the condensed $2 \\times 2$ stiffness matrix $K_{e}^{\\text{cond}}$ in row-major flattened form $[K_{11}, K_{12}, K_{21}, K_{22}]$, and\n- the condensed $2 \\times 1$ load vector $F_{e}^{\\text{cond}}$ in flattened form $[F_1, F_2]$.\n\nYour program must evaluate these quantities exactly for the following test suite of parameter sets $(a, \\nu, f)$:\n- Test case 1 (happy path): $(a, \\nu, f) = (1.0, 0.01, 1.0)$.\n- Test case 2 (diffusion-dominant boundary condition case): $(a, \\nu, f) = (0.1, 1.0, 2.0)$.\n- Test case 3 (advection-dominant edge case): $(a, \\nu, f) = (2.5, 0.001, -0.5)$.\n\nAll quantities are dimensionless for this purely mathematical formulation; no physical units are required. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the format:\n- For each test case, output a list containing four sublists, corresponding to element $1$ condensed stiffness (flattened), element $1$ condensed load (flattened), element $2$ condensed stiffness (flattened), and element $2$ condensed load (flattened).\n- The overall output is a list of the three per-test-case lists, so the final output has the form $[[\\ldots],[\\ldots],[\\ldots]]$ where each inner list has exactly four sublists in the specified order.\n\nNo shortcuts or pre-supplied formulas are permitted in your derivation; the computation must follow from the fundamental definitions given above and the static condensation operation.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of computational fluid dynamics and the Finite Element Method (FEM), specifically the Variational Multiscale (VMS) approach. The problem is well-posed, objective, self-contained, and requires a non-trivial derivation and implementation based on fundamental principles, making it a suitable task.\n\nThe solution proceeds by first deriving the element stiffness matrix and load vector for an augmented space, and then performing static condensation to obtain the coarse-scale operators.\n\nThe one-dimensional steady advection-diffusion equation is given by:\n$$\n-\\nu \\dfrac{d^2 u}{dx^2} + a \\dfrac{d u}{dx} = f, \\quad x \\in [0, 1]\n$$\nwhere $\\nu > 0$, $a \\in \\mathbb{R}$, and $f \\in \\mathbb{R}$ are constants.\n\nThe weak form over a single element $e$ of size $h$ is to find $u \\in V_h$ such that for all $w \\in V_h$:\n$$\n\\int_e \\nu w' u' \\, dx + \\int_e a w u' \\, dx = \\int_e w f \\, dx\n$$\nThe space $V_h$ on the element is spanned by the basis functions $\\{N_1, N_2, N_b\\}$. In the local coordinate $\\xi \\in [0, 1]$, these are:\n- Linear shape functions: $N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$\n- Bubble shape function: $N_b(\\xi) = 4\\xi(1 - \\xi)$\n\nThe relationship between the global coordinate $x$ and local coordinate $\\xi$ is given by the affine mapping $x(\\xi) = x_1 + h\\xi$, where $x_1$ is the start coordinate of the element. This gives the differential relationships $dx = h \\, d\\xi$ and $\\frac{d}{dx} = \\frac{1}{h} \\frac{d}{d\\xi}$. Denoting differentiation with respect to $x$ by $'$ and with respect to $\\xi$ by a dot, we have $g'(\\xi) = \\frac{1}{h}\\dot{g}(\\xi)$.\n\nThe derivatives of the basis functions with respect to $\\xi$ are:\n- $\\dot{N}_1(\\xi) = -1$\n- $\\dot{N}_2(\\xi) = 1$\n- $\\dot{N}_b(\\xi) = 4(1 - 2\\xi)$\n\nThe $3 \\times 3$ element stiffness matrix $K_e$ and $3 \\times 1$ load vector $F_e$ have entries given by:\n$$\nK_{ij} = \\int_e \\left( \\nu N_i' N_j' + a N_i N_j' \\right) dx, \\quad F_i = \\int_e N_i f \\, dx\n$$\nChanging to local coordinates:\n$$\nK_{ij} = \\int_0^1 \\left( \\nu \\dfrac{\\dot{N}_i}{h} \\dfrac{\\dot{N}_j}{h} + a N_i \\dfrac{\\dot{N}_j}{h} \\right) h \\, d\\xi = \\dfrac{\\nu}{h} \\int_0^1 \\dot{N}_i \\dot{N}_j \\, d\\xi + a \\int_0^1 N_i \\dot{N}_j \\, d\\xi\n$$\n$$\nF_i = \\int_0^1 N_i f \\, h \\, d\\xi = fh \\int_0^1 N_i \\, d\\xi\n$$\n\nBy computing the integrals of the products of these basis functions and their derivatives, we assemble the diffusion part $K^\\nu$, advection part $K^a$, and the load vector $F_e$. The total element matrix is $K_e = K^\\nu + K^a$:\n$$\nK_e = \\begin{pmatrix}\n\\dfrac{\\nu}{h} - \\dfrac{a}{2} & -\\dfrac{\\nu}{h} + \\dfrac{a}{2} & \\dfrac{2a}{3} \\\\\n-\\dfrac{\\nu}{h} - \\dfrac{a}{2} & \\dfrac{\\nu}{h} + \\dfrac{a}{2} & -\\dfrac{2a}{3} \\\\\n-\\dfrac{2a}{3} & \\dfrac{2a}{3} & \\dfrac{16\\nu}{3h}\n\\end{pmatrix}\n$$\nThe total element vector $F_e$ is:\n$$\nF_e = \\begin{pmatrix} \\dfrac{fh}{2} \\\\ \\dfrac{fh}{2} \\\\ \\dfrac{2fh}{3} \\end{pmatrix}\n$$\n\nFor static condensation, we partition these into coarse-coarse ($cc$), coarse-bubble ($cb$), bubble-coarse ($bc$), and bubble-bubble ($bb$) blocks, corresponding to the basis ordering $\\{N_1, N_2, N_b\\}$:\n- $K_{cc} = \\begin{pmatrix} \\dfrac{\\nu}{h} - \\dfrac{a}{2} & -\\dfrac{\\nu}{h} + \\dfrac{a}{2} \\\\ -\\dfrac{\\nu}{h} - \\dfrac{a}{2} & \\dfrac{\\nu}{h} + \\dfrac{a}{2} \\end{pmatrix}$\n- $K_{cb} = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix}$\n- $K_{bc} = \\begin{pmatrix} -2a/3 & 2a/3 \\end{pmatrix}$\n- $K_{bb} = \\dfrac{16\\nu}{3h}$\n- $F_{cc} = \\begin{pmatrix} fh/2 \\\\ fh/2 \\end{pmatrix}$\n- $F_b = \\dfrac{2fh}{3}$\n\nThe condensed operators are $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ and $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$.\nFirst, $K_{bb}^{-1} = \\dfrac{3h}{16\\nu}$.\n\nThe stiffness modification is $\\Delta K = K_{cb} K_{bb}^{-1} K_{bc}$:\n$$\n\\Delta K = \\begin{pmatrix} \\dfrac{2a}{3} \\\\ -\\dfrac{2a}{3} \\end{pmatrix} \\left( \\dfrac{3h}{16\\nu} \\right) \\begin{pmatrix} -\\dfrac{2a}{3} & \\dfrac{2a}{3} \\end{pmatrix} = \\dfrac{ha^2}{12\\nu} \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}\n$$\nThe condensed stiffness matrix is $K_{e}^{\\text{cond}} = K_{cc} - \\Delta K$:\n$$\nK_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\dfrac{\\nu}{h} - \\dfrac{a}{2} + \\dfrac{ha^2}{12\\nu} & -\\dfrac{\\nu}{h} + \\dfrac{a}{2} - \\dfrac{ha^2}{12\\nu} \\\\\n-\\dfrac{\\nu}{h} - \\dfrac{a}{2} - \\dfrac{ha^2}{12\\nu} & \\dfrac{\\nu}{h} + \\dfrac{a}{2} + \\dfrac{ha^2}{12\\nu}\n\\end{pmatrix}\n$$\n\nThe load modification is $\\Delta F = K_{cb} K_{bb}^{-1} F_{b}$:\n$$\n\\Delta F = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix} \\left( \\dfrac{3h}{16\\nu} \\right) \\left( \\dfrac{2fh}{3} \\right) = \\dfrac{afh^2}{12\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}\n$$\nThe condensed load vector is $F_{e}^{\\text{cond}} = F_{cc} - \\Delta F$:\n$$\nF_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\dfrac{fh}{2} - \\dfrac{afh^2}{12\\nu} \\\\\n\\dfrac{fh}{2} + \\dfrac{afh^2}{12\\nu}\n\\end{pmatrix}\n$$\nThese derived formulas are implemented in the following code. For both elements, $h=0.5$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the condensed stiffness matrix and load vector for a 1D advection-diffusion\n    problem using static condensation of a bubble function.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 0.01, 1.0),   # Case 1\n        (0.1, 1.0, 2.0),   # Case 2\n        (2.5, 0.001, -0.5), # Case 3\n    ]\n\n    # Both elements have the same size h\n    h = 0.5\n    \n    results = []\n    \n    for case in test_cases:\n        a, nu, f = case\n\n        # --- DERIVATION BASED CALCULATION ---\n        \n        # Intermediate terms from the derived formulas\n        nu_over_h = nu / h\n        a_over_2 = a / 2.0\n        \n        # Stabilization term for stiffness matrix (from K_cb * K_bb^-1 * K_bc)\n        stabilization_k_term = (h * a**2) / (12.0 * nu)\n        \n        # Condensed stiffness matrix components\n        k11 = nu_over_h - a_over_2 + stabilization_k_term\n        k12 = -nu_over_h + a_over_2 - stabilization_k_term\n        k21 = -nu_over_h - a_over_2 - stabilization_k_term\n        k22 = nu_over_h + a_over_2 + stabilization_k_term\n        \n        K_cond_flat = [k11, k12, k21, k22]\n        \n        # Intermediate terms for load vector\n        f_h_over_2 = f * h / 2.0\n        \n        # Stabilization term for load vector (from K_cb * K_bb^-1 * F_b)\n        stabilization_f_term = (a * f * h**2) / (12.0 * nu)\n        \n        # Condensed load vector components\n        f1 = f_h_over_2 - stabilization_f_term\n        f2 = f_h_over_2 + stabilization_f_term\n        \n        F_cond_flat = [f1, f2]\n        \n        # The problem specifies a two-element mesh with h=0.5 for both.\n        # Thus, the matrices and vectors for element 1 and element 2 are identical.\n        case_result = [K_cond_flat, F_cond_flat, K_cond_flat, F_cond_flat]\n        \n        results.append(case_result)\n    \n    def format_list_compactly(l):\n        return f\"[{','.join(f'{x:.8f}' if isinstance(x, float) else str(x) for x in l)}]\"\n\n    def format_case_result(cr):\n        k1f_str = format_list_compactly(cr[0])\n        f1f_str = format_list_compactly(cr[1])\n        k2f_str = format_list_compactly(cr[2])\n        f2f_str = format_list_compactly(cr[3])\n        return f\"[{k1f_str},{f1f_str},{k2f_str},{f2f_str}]\"\n    \n    final_output_string = f\"[{','.join(map(format_case_result, results))}]\".replace(\" \", \"\").replace(\".00000000\",\"\").replace(\"0.0,\", \"0,\").replace(\",0.0\", \",0\")\n\n\n    # Since the example output from similar problems suggests a highly compact format, we will manually build a string.\n    # The default str() for lists includes spaces, which we remove.\n    output_str = str(results).replace(\" \", \"\")\n    print(output_str)\n```"
        }
    ]
}