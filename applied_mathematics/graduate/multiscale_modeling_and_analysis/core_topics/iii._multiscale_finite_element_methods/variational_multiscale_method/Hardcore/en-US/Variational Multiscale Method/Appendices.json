{
    "hands_on_practices": [
        {
            "introduction": "The foundational principle of the Variational Multiscale Method is the decomposition of a solution into coarse and fine scales. This first exercise provides a concrete look at this separation in its simplest form. By analyzing a one-dimensional diffusion problem, we will explicitly derive the fine-scale component that is typically missed by a standard linear finite element approximation, revealing the physics captured by the subgrid scales .",
            "id": "3830100",
            "problem": "Consider the steady one-dimensional diffusion problem on the interval $[0,L]$ governed by the strong form\n$$-a \\frac{d^{2}u}{dx^{2}} = q,$$\nwhere $a>0$ is a constant diffusivity and $q$ is a constant source. In the Variational Multiscale Method (VMS), decompose the solution as $u = u_{H} + u^{\\prime}$, where $u_{H}$ belongs to the standard continuous, piecewise linear finite element space on a mesh with nodes $\\{x_{j}\\}$, and $u^{\\prime}$ is a fine-scale component that vanishes at all mesh nodes. Focus on a single element $e = [x_{i}, x_{i+1}]$ of length $h = x_{i+1} - x_{i}$.\n\nInside the element $e$, the coarse-scale field $u_{H}(x)$ is represented by the hat functions as\n$$u_{H}(x) = N_{i}(x)\\,U_{i} + N_{i+1}(x)\\,U_{i+1},$$\nwith nodal values $U_{i}$ and $U_{i+1}$, and the element-wise hat functions\n$$N_{i}(x) = \\frac{x_{i+1} - x}{h}, \\qquad N_{i+1}(x) = \\frac{x - x_{i}}{h}.$$\nAssume the fine-scale component $u^{\\prime}(x)$ satisfies homogeneous Dirichlet conditions at the element endpoints,\n$$u^{\\prime}(x_{i}) = 0, \\qquad u^{\\prime}(x_{i+1}) = 0.$$\n\nStarting from the governing equation and the VMS decomposition $u = u_{H} + u^{\\prime}$, derive the local fine-scale equation inside the element $e$ and solve it exactly under the above endpoint conditions to obtain the explicit fine-scale $u^{\\prime}(x)$ as a function of $x$, $x_{i}$, $x_{i+1}$, $a$, and $q$. Then, write the full split solution $u(x) = u_{H}(x) + u^{\\prime}(x)$ inside the element $e$ as a single closed-form expression involving $U_{i}$, $U_{i+1}$, $x$, $x_{i}$, $x_{i+1}$, $a$, and $q$.\n\nYour final answer must be that single analytic expression for $u(x)$ on $[x_{i},x_{i+1}]$. No rounding is required. Express your answer without units.",
            "solution": "The problem is governed by the steady one-dimensional diffusion equation\n$$-a \\frac{d^{2}u}{dx^{2}} = q,$$\nwhere $a>0$ is constant and $q$ is constant. The Variational Multiscale Method (VMS) posits a decomposition of the solution into coarse and fine scales,\n$$u = u_{H} + u^{\\prime},$$\nwhere $u_{H}$ lies in the standard continuous, piecewise linear finite element space, and $u^{\\prime}$ lies in the complementary fine-scale space that vanishes at mesh nodes. On a given element $e=[x_{i},x_{i+1}]$ with length $h = x_{i+1}-x_{i}$, the coarse-scale field is\n$$u_{H}(x) = N_{i}(x)\\,U_{i} + N_{i+1}(x)\\,U_{i+1},$$\nwith hat functions\n$$N_{i}(x) = \\frac{x_{i+1} - x}{h}, \\qquad N_{i+1}(x) = \\frac{x - x_{i}}{h}.$$\nBy construction of the piecewise linear basis, the element-wise second derivative of $u_{H}(x)$ vanishes in the interior of the element,\n$$\\frac{d^{2}u_{H}}{dx^{2}} = 0 \\quad \\text{for } x \\in (x_{i}, x_{i+1}).$$\n\nInsert the VMS decomposition into the strong form:\n$$-a \\frac{d^{2}}{dx^{2}}(u_{H} + u^{\\prime}) = q.$$\nThis yields\n$$-a \\frac{d^{2}u^{\\prime}}{dx^{2}} = q + a \\frac{d^{2}u_{H}}{dx^{2}}.$$\nUsing $\\frac{d^{2}u_{H}}{dx^{2}} = 0$ in the element interior, the fine-scale equation inside $e$ reduces to the constant-coefficient ordinary differential equation\n$$-a \\frac{d^{2}u^{\\prime}}{dx^{2}} = q \\quad \\text{for } x \\in (x_{i}, x_{i+1}).$$\nThe fine-scale satisfies homogeneous Dirichlet conditions at the element endpoints,\n$$u^{\\prime}(x_{i}) = 0, \\qquad u^{\\prime}(x_{i+1}) = 0.$$\n\nSolve the fine-scale ODE. Rewrite it as\n$$\\frac{d^{2}u^{\\prime}}{dx^{2}} = -\\frac{q}{a}.$$\nIntegrate twice:\n$$u^{\\prime}(x) = -\\frac{q}{2a} x^{2} + C_{1} x + C_{2}.$$\nImpose $u^{\\prime}(x_{i})=0$:\n$$0 = -\\frac{q}{2a} x_{i}^{2} + C_{1} x_{i} + C_{2},$$\nand $u^{\\prime}(x_{i+1})=0$:\n$$0 = -\\frac{q}{2a} x_{i+1}^{2} + C_{1} x_{i+1} + C_{2}.$$\nSubtract the first from the second:\n$$0 = -\\frac{q}{2a}(x_{i+1}^{2} - x_{i}^{2}) + C_{1}(x_{i+1} - x_{i}).$$\nSince $x_{i+1}^{2}-x_{i}^{2} = (x_{i+1}-x_{i})(x_{i+1}+x_{i})$ and $h = x_{i+1} - x_{i}$,\n$$0 = -\\frac{q}{2a} h (x_{i+1} + x_{i}) + C_{1} h,$$\nhence\n$$C_{1} = \\frac{q}{2a} (x_{i+1} + x_{i}).$$\nUse $u^{\\prime}(x_{i})=0$ to find $C_{2}$:\n$$0 = -\\frac{q}{2a} x_{i}^{2} + \\frac{q}{2a} (x_{i+1}+x_{i}) x_{i} + C_{2} \\quad \\Rightarrow \\quad C_{2} = \\frac{q}{2a} \\left[x_{i}^{2} - (x_{i+1}+x_{i}) x_{i}\\right] = -\\frac{q}{2a} x_{i} x_{i+1}.$$\nTherefore,\n$$u^{\\prime}(x) = -\\frac{q}{2a} x^{2} + \\frac{q}{2a} (x_{i+1}+x_{i}) x - \\frac{q}{2a} x_{i} x_{i+1}.$$\nComplete the square as a product:\n$$u^{\\prime}(x) = \\frac{q}{2a} \\left[ -x^{2} + (x_{i+1}+x_{i}) x - x_{i} x_{i+1} \\right] = \\frac{q}{2a} (x - x_{i})(x_{i+1} - x).$$\nThus, the fine-scale inside the element is the quadratic bubble\n$$u^{\\prime}(x) = \\frac{q}{2a} (x - x_{i})(x_{i+1} - x).$$\n\nThe coarse-scale field inside the element is\n$$u_{H}(x) = U_{i} \\frac{x_{i+1}-x}{h} + U_{i+1} \\frac{x - x_{i}}{h}.$$\nCombine coarse and fine scales to obtain the full split solution inside the element:\n$$u(x) = U_{i} \\frac{x_{i+1}-x}{h} + U_{i+1} \\frac{x - x_{i}}{h} + \\frac{q}{2a} (x - x_{i})(x_{i+1} - x), \\qquad h = x_{i+1} - x_{i}.$$\n\nThis is a single closed-form analytic expression in terms of $U_{i}$, $U_{i+1}$, $x$, $x_{i}$, $x_{i+1}$, $a$, and $q$, as required.",
            "answer": "$$\\boxed{U_{i}\\,\\frac{x_{i+1}-x}{x_{i+1}-x_{i}} \\;+\\; U_{i+1}\\,\\frac{x-x_{i}}{x_{i+1}-x_{i}} \\;+\\; \\frac{q}{2a}\\,(x-x_{i})\\,(x_{i+1}-x)}$$"
        },
        {
            "introduction": "Having seen how to separate scales, we now explore how this separation can be used to systematically improve our numerical methods. For advection-dominated problems, standard methods are plagued by non-physical oscillations, and the VMS framework provides a rigorous path to stabilization by modeling the effect of the fine scales on the coarse ones. This practice  challenges you to derive the exact, or 'spectral', stabilization parameter $\\tau$ that arises from the fine-scale dynamics and compare it with common heuristic forms, demonstrating the power and precision of the VMS approach.",
            "id": "3830103",
            "problem": "Consider the steady one-dimensional advection-diffusion boundary value problem on a single finite element $E=[0,h]$ with constant coefficients,\n$$ a \\,\\frac{d u}{dx} - \\nu \\,\\frac{d^{2} u}{dx^{2}} = f, $$\nwhere $a \\neq 0$ is the advection speed and $\\nu > 0$ is the diffusion coefficient. In the Variational Multiscale Method (VMS), decompose the solution as $u = \\bar{u} + u'$ into a coarse-scale part $\\bar{u}$ in the linear finite element space on $E$ and a subscale part $u'$ in the bubble space on $E$ satisfying homogeneous boundary conditions $u'(0)=u'(h)=0$. Let the coarse-scale residual be $r = a \\,\\frac{d \\bar{u}}{dx} - \\nu \\,\\frac{d^{2} \\bar{u}}{dx^{2}} - f$, which is constant on $E$ for linear $\\bar{u}$.\n\nStarting from the subscale differential equation and its exact element-level Green's function representation, derive a closed-form analytical expression for the optimal stabilization parameter $\\tau$ as a function of the Péclet number $\\mathrm{Pe} = \\frac{|a| h}{2 \\nu}$. Then compare its asymptotic behavior with a widely used heuristic algebraic Streamline Upwind/Petrov-Galerkin (SUPG) form,\n$$ \\tau_{\\mathrm{H}} = \\left[ \\left( \\frac{2 |a|}{h} \\right)^{2} + \\left( \\frac{4 \\nu}{h^{2}} \\right)^{2} \\right]^{-\\frac{1}{2}}, $$\nby analyzing the limits $\\mathrm{Pe} \\to 0$ and $\\mathrm{Pe} \\to \\infty$.\n\nFinally, for the test case with $a = 0.1$ (in $\\mathrm{m}\\,\\mathrm{s}^{-1}$), $\\nu = 0.01$ (in $\\mathrm{m}^{2}\\,\\mathrm{s}^{-1}$), and $h = 0.2$ (in $\\mathrm{m}$), compute the ratio\n$$ R = \\frac{\\tau_{\\mathrm{spectral}}}{\\tau_{\\mathrm{H}}}. $$\nRound your final answer to four significant figures. Express the final answer as a dimensionless number with no units.",
            "solution": "### Derivation of the Optimal Stabilization Parameter $\\tau_{\\mathrm{spectral}}$\n\nThe VMS framework decomposes the solution into coarse ($\\bar{u}$) and fine ($u'$) scales. Substituting $u = \\bar{u} + u'$ into the governing equation gives:\n$$ a \\frac{d}{dx}(\\bar{u} + u') - \\nu \\frac{d^2}{dx^2}(\\bar{u} + u') = f $$\n$$ \\left(a \\frac{d\\bar{u}}{dx} - \\nu \\frac{d^2\\bar{u}}{dx^2}\\right) + \\left(a \\frac{du'}{dx} - \\nu \\frac{d^2u'}{dx^2}\\right) = f $$\nRearranging the terms isolates the equation for the fine-scale component $u'$:\n$$ a \\frac{du'}{dx} - \\nu \\frac{d^2u'}{dx^2} = f - \\left(a \\frac{d\\bar{u}}{dx} - \\nu \\frac{d^2\\bar{u}}{dx^2}\\right) $$\nSince $\\bar{u}$ is linear, $\\frac{d^2\\bar{u}}{dx^2}=0$. The term in the parenthesis is the coarse-scale residual $r$ plus $f$. Therefore, the right-hand side is $f - (r+f) = -r$. The subscale problem for $u'$ is the following boundary value problem:\n$$ - \\nu \\frac{d^2u'}{dx^2} + a \\frac{du'}{dx} = -r, \\quad x \\in (0, h) $$\nwith homogeneous boundary conditions $u'(0) = 0$ and $u'(h) = 0$. Since $r$ is constant, this is a second-order linear ordinary differential equation with constant coefficients.\n\nThe general solution is the sum of the homogeneous solution $u'_h(x)$ and a particular solution $u'_p(x)$. The characteristic equation for the homogeneous part is $-\\nu \\lambda^2 + a \\lambda = 0$, which yields roots $\\lambda_1=0$ and $\\lambda_2=a/\\nu$. Thus, $u'_h(x) = C_1 + C_2 \\exp(\\frac{a}{\\nu}x)$. For the particular solution, we guess $u'_p(x) = Bx$. Substituting into the ODE gives $aB = -r$, so $B=-r/a$. The general solution is:\n$$ u'(x) = C_1 + C_2 \\exp\\left(\\frac{a}{\\nu}x\\right) - \\frac{r}{a}x $$\nApplying the boundary conditions:\n1.  $u'(0) = 0 \\implies C_1 + C_2 = 0 \\implies C_1 = -C_2$\n2.  $u'(h) = 0 \\implies C_1 + C_2 \\exp\\left(\\frac{ah}{\\nu}\\right) - \\frac{rh}{a} = 0$\n\nSubstituting $C_1 = -C_2$ into the second equation:\n$$ -C_2 + C_2 \\exp\\left(\\frac{ah}{\\nu}\\right) = \\frac{rh}{a} \\implies C_2 = \\frac{rh/a}{\\exp(ah/\\nu)-1} $$\nThe full solution for $u'(x)$ is:\n$$ u'(x) = \\frac{rh}{a} \\left( \\frac{\\exp(\\frac{a}{\\nu}x) - 1}{\\exp(\\frac{ah}{\\nu}) - 1} \\right) - \\frac{r}{a}x $$\nIn the VMS method, the stabilization parameter $\\tau_{\\mathrm{spectral}}$ is defined to relate the average of the subscale solution to the coarse-scale residual: $\\frac{1}{h}\\int_0^h u'(x) dx = -\\tau_{\\mathrm{spectral}} r$. Thus:\n$$ \\tau_{\\mathrm{spectral}} = -\\frac{1}{hr} \\int_0^h u'(x) dx $$\nWe compute the integral of $u'(x)$:\n$$ \\int_0^h u'(x) dx = \\left[ \\frac{rh}{a} \\frac{\\frac{\\nu}{a}\\exp(\\frac{a}{\\nu}x) - x}{\\exp(\\frac{ah}{\\nu}) - 1} - \\frac{r}{a}\\frac{x^2}{2} \\right]_0^h $$\n$$ = \\frac{rh}{a}\\left( \\frac{\\frac{\\nu}{a}\\exp(\\frac{ah}{\\nu}) - h - \\frac{\\nu}{a}}{\\exp(\\frac{ah}{\\nu}) - 1} \\right) - \\frac{rh^2}{2a} = \\frac{rh}{a}\\left( \\frac{\\frac{\\nu}{a}(\\exp(\\frac{ah}{\\nu}) - 1) - h}{\\exp(\\frac{ah}{\\nu}) - 1} \\right) - \\frac{rh^2}{2a} $$\n$$ = \\frac{rh}{a}\\frac{\\nu}{a} - \\frac{rh^2}{a(\\exp(\\frac{ah}{\\nu}) - 1)} - \\frac{rh^2}{2a} = \\frac{r \\nu h}{a^2} - \\frac{rh^2}{2a} - \\frac{rh^2}{a(\\exp(\\frac{ah}{\\nu})-1)} $$\nSubstituting this into the expression for $\\tau_{\\mathrm{spectral}}$:\n$$ \\tau_{\\mathrm{spectral}} = -\\frac{1}{hr} \\left( \\frac{r \\nu h}{a^2} - \\frac{rh^2}{2a} - \\frac{rh^2}{a(\\exp(\\frac{ah}{\\nu})-1)} \\right) = \\frac{h}{2a} - \\frac{\\nu}{a^2} + \\frac{h}{a(\\exp(ah/\\nu)-1)} $$\nTo express this in terms of the Péclet number $\\mathrm{Pe} = \\frac{|a|h}{2\\nu}$, let $z = \\frac{ah}{2\\nu}$. Note that $z$ is signed, while $\\mathrm{Pe}=|z|$. The expression for $\\tau_{\\mathrm{spectral}}$ can be rewritten as:\n$$ \\tau_{\\mathrm{spectral}} = \\frac{h}{2a}\\left(1 - \\frac{2\\nu}{ah} + \\frac{2}{\\exp(2z)-1}\\right) = \\frac{h}{2a}\\left(1 - \\frac{1}{z} + \\frac{2}{e^{2z}-1}\\right) $$\nUsing the identity $\\coth(z) = \\frac{e^{2z}+1}{e^{2z}-1} = 1 + \\frac{2}{e^{2z}-1}$, we get:\n$$ \\tau_{\\mathrm{spectral}} = \\frac{h}{2a} \\left(\\coth(z) - \\frac{1}{z}\\right) = \\frac{h}{2a} \\left(\\coth\\left(\\frac{ah}{2\\nu}\\right) - \\frac{2\\nu}{ah}\\right) $$\nThis expression can be made explicitly positive and dependent on $\\mathrm{Pe}$ by noting that $\\coth(z)-1/z$ is an odd function. If $a>0$, $z=\\mathrm{Pe}$, and $\\tau_{\\mathrm{spectral}} = \\frac{h}{2a}(\\coth(\\mathrm{Pe})-1/\\mathrm{Pe})$. If $a<0$, $z=-\\mathrm{Pe}$, and $\\tau_{\\mathrm{spectral}} = \\frac{h}{2a}(\\coth(-\\mathrm{Pe})-1/(-\\mathrm{Pe})) = \\frac{h}{2a}(-\\coth(\\mathrm{Pe})+1/\\mathrm{Pe}) = \\frac{h}{-2a}(\\coth(\\mathrm{Pe})-1/\\mathrm{Pe}) = \\frac{h}{2|a|}(\\coth(\\mathrm{Pe})-1/\\mathrm{Pe})$.\nThus, for any $a \\neq 0$:\n$$ \\tau_{\\mathrm{spectral}} = \\frac{h}{2|a|} \\left( \\coth\\left(\\frac{|a|h}{2\\nu}\\right) - \\frac{2\\nu}{|a|h} \\right) = \\frac{h}{2|a|} \\left( \\coth(\\mathrm{Pe}) - \\frac{1}{\\mathrm{Pe}} \\right) $$\n\n### Asymptotic Comparison\nFirst, we express $\\tau_{\\mathrm{H}}$ in terms of $\\mathrm{Pe}$:\n$$ \\tau_{\\mathrm{H}} = \\left[ \\frac{4a^2}{h^2} + \\frac{16\\nu^2}{h^4} \\right]^{-\\frac{1}{2}} = \\left[ \\frac{4a^2}{h^2} \\left( 1 + \\frac{4\\nu^2}{a^2h^2} \\right) \\right]^{-\\frac{1}{2}} = \\frac{h}{2|a|} \\left( 1 + \\frac{1}{\\mathrm{Pe}^2} \\right)^{-\\frac{1}{2}} = \\frac{h}{2|a|} \\frac{\\mathrm{Pe}}{\\sqrt{\\mathrm{Pe}^2+1}} $$\n\n**Case 1: Diffusion-dominated limit ($\\mathrm{Pe} \\to 0$)**\nFor $\\tau_{\\mathrm{spectral}}$, we use the Taylor expansion $\\coth(x) \\approx \\frac{1}{x} + \\frac{x}{3} - \\frac{x^3}{45} + \\dots$.\n$$ \\tau_{\\mathrm{spectral}} \\approx \\frac{h}{2|a|} \\left( \\left(\\frac{1}{\\mathrm{Pe}} + \\frac{\\mathrm{Pe}}{3}\\right) - \\frac{1}{\\mathrm{Pe}} \\right) = \\frac{h}{2|a|} \\frac{\\mathrm{Pe}}{3} = \\frac{h}{2|a|} \\frac{|a|h}{6\\nu} = \\frac{h^2}{12\\nu} $$\nFor $\\tau_{\\mathrm{H}}$, as $\\mathrm{Pe} \\to 0$, $\\sqrt{\\mathrm{Pe}^2+1} \\approx 1$.\n$$ \\tau_{\\mathrm{H}} \\approx \\frac{h}{2|a|} \\mathrm{Pe} = \\frac{h}{2|a|} \\frac{|a|h}{2\\nu} = \\frac{h^2}{4\\nu} $$\nIn the diffusion limit, both parameters are proportional to $h^2/\\nu$, but $\\tau_{\\mathrm{H}}$ is $3$ times larger than the optimal $\\tau_{\\mathrm{spectral}}$.\n\n**Case 2: Advection-dominated limit ($\\mathrm{Pe} \\to \\infty$)**\nFor $\\tau_{\\mathrm{spectral}}$, as $\\mathrm{Pe} \\to \\infty$, $\\coth(\\mathrm{Pe}) \\to 1$ and $1/\\mathrm{Pe} \\to 0$.\n$$ \\tau_{\\mathrm{spectral}} \\to \\frac{h}{2|a|} (1-0) = \\frac{h}{2|a|} $$\nFor $\\tau_{\\mathrm{H}}$, we have:\n$$ \\tau_{\\mathrm{H}} = \\frac{h}{2|a|} \\frac{\\mathrm{Pe}}{\\mathrm{Pe}\\sqrt{1+1/\\mathrm{Pe}^2}} = \\frac{h}{2|a|} \\frac{1}{\\sqrt{1+1/\\mathrm{Pe}^2}} \\to \\frac{h}{2|a|} $$\nIn the advection limit, both $\\tau_{\\mathrm{spectral}}$ and $\\tau_{\\mathrm{H}}$ converge to the same value, $h/(2|a|)$, which is the characteristic time scale for advection across the element.\n\n### Numerical Calculation\nGiven $a=0.1$, $\\nu=0.01$, and $h=0.2$, we first compute the Péclet number:\n$$ \\mathrm{Pe} = \\frac{|a|h}{2\\nu} = \\frac{0.1 \\times 0.2}{2 \\times 0.01} = \\frac{0.02}{0.02} = 1 $$\nNow we compute $\\tau_{\\mathrm{spectral}}$ and $\\tau_{\\mathrm{H}}$ for $\\mathrm{Pe}=1$.\n$$ \\tau_{\\mathrm{spectral}} = \\frac{h}{2|a|} \\left( \\coth(1) - \\frac{1}{1} \\right) = \\frac{0.2}{2 \\times 0.1} \\left( \\coth(1) - 1 \\right) = 1 \\cdot (\\coth(1) - 1) $$\nUsing $\\coth(1) = \\frac{e^1+e^{-1}}{e^1-e^{-1}} = \\frac{e^2+1}{e^2-1}$, we have $\\coth(1)-1 = \\frac{e^2+1 - (e^2-1)}{e^2-1} = \\frac{2}{e^2-1}$.\nSo, $\\tau_{\\mathrm{spectral}} = \\frac{2}{e^2-1}$.\nNext, we compute $\\tau_{\\mathrm{H}}$:\n$$ \\tau_{\\mathrm{H}} = \\frac{h}{2|a|} \\frac{1}{\\sqrt{1^2+1}} = 1 \\cdot \\frac{1}{\\sqrt{2}} = \\frac{1}{\\sqrt{2}} $$\nThe ratio $R$ is:\n$$ R = \\frac{\\tau_{\\mathrm{spectral}}}{\\tau_{\\mathrm{H}}} = \\frac{2/(e^2-1)}{1/\\sqrt{2}} = \\frac{2\\sqrt{2}}{e^2-1} $$\nNow, we compute the numerical value:\n$$ R = \\frac{2\\sqrt{2}}{e^2-1} \\approx \\frac{2 \\times 1.41421356}{7.3890561 - 1} \\approx \\frac{2.82842712}{6.3890561} \\approx 0.44269504 $$\nRounding to four significant figures, we get $0.4427$.",
            "answer": "$$\\boxed{0.4427}$$"
        },
        {
            "introduction": "The theoretical derivation of stabilization parameters is insightful, but a crucial step is understanding how these concepts translate into a working finite element code. The technique of static condensation provides the algebraic bridge between the continuous fine-scale problem and the discrete coarse-scale system that is actually solved. In this hands-on coding exercise , you will implement this procedure, deriving the modified (condensed) stiffness matrix and load vector that implicitly contain the stabilizing effects of the fine-scale bubble functions.",
            "id": "3805260",
            "problem": "Consider the one-dimensional steady advection-diffusion boundary value problem on the interval $[0,1]$ with constant coefficients and a constant source, governed by the differential operator $-\\nu \\, \\dfrac{d^2 u}{dx^2} + a \\, \\dfrac{d u}{dx} = f$, where $\\nu > 0$ is the diffusion coefficient, $a \\in \\mathbb{R}$ is the advection velocity, and $f \\in \\mathbb{R}$ is a constant source. Discretize the domain using a two-element mesh with nodes at $x = 0$, $x = 0.5$, and $x = 1$, yielding two elements with sizes $h_1 = 0.5$ and $h_2 = 0.5$. On each element, augment the usual linear Lagrange trial space with a single interior bubble function, and use the Galerkin formulation that includes both coarse and bubble (fine-scale) trial and weighting functions. Specifically, on each element in the local affine coordinate $\\xi \\in [0,1]$, define the linear shape functions $N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$, and the bubble function $N_b(\\xi) = 4 \\xi (1 - \\xi)$, with the mapping $x(\\xi)$ such that $dx = h \\, d\\xi$. For this augmented element space, write the local element stiffness matrix $K_e$ associated with the bilinear form $\\int_e \\nu \\, w' u' \\, dx + \\int_e a \\, w \\, u' \\, dx$, and the local element load vector $F_e$ associated with the linear form $\\int_e w \\, f \\, dx$, where $'$ denotes differentiation with respect to $x$, and $w$ and $u$ are test and trial functions expanded in $\\{N_1, N_2, N_b\\}$.\n\nPerform static condensation to eliminate the bubble degree of freedom on each element. Explicitly partition the element stiffness and load into coarse-coarse ($cc$), coarse-bubble ($cb$), bubble-coarse ($bc$), and bubble-bubble ($bb$) blocks consistent with the ordering $\\{N_1, N_2, N_b\\}$. Then derive the condensed coarse-scale stiffness matrix and load vector given by $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ and $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$, where $F_{cc}$ denotes the coarse-scale part of the load restricted to $\\{N_1, N_2\\}$, and $F_b$ is the bubble component of the load. Ensure that all integrals are evaluated exactly and that all intermediate symbolic operations are done consistently with the affine mapping.\n\nFollow the scale separation principle of the Variational Multiscale Method (VMS), where the bubble-enriched fine scale is algebraically eliminated and its effect is projected onto the coarse scale. Starting only from the definitions of the shape functions, the bilinear and linear forms, and the static condensation rule, derive the explicit condensed coarse-scale stiffness and load expressions in terms of $a$, $\\nu$, $h$, and $f$. Then implement a program that, for the given two-element mesh with $h_1 = 0.5$ and $h_2 = 0.5$, computes for each element:\n- the condensed $2 \\times 2$ stiffness matrix $K_{e}^{\\text{cond}}$ in row-major flattened form $[K_{11}, K_{12}, K_{21}, K_{22}]$, and\n- the condensed $2 \\times 1$ load vector $F_{e}^{\\text{cond}}$ in flattened form $[F_1, F_2]$.\n\nYour program must evaluate these quantities exactly for the following test suite of parameter sets $(a, \\nu, f)$:\n- Test case 1 (happy path): $(a, \\nu, f) = (1.0, 0.01, 1.0)$.\n- Test case 2 (diffusion-dominant boundary condition case): $(a, \\nu, f) = (0.1, 1.0, 2.0)$.\n- Test case 3 (advection-dominant edge case): $(a, \\nu, f) = (2.5, 0.001, -0.5)$.\n\nAll quantities are dimensionless for this purely mathematical formulation; no physical units are required. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the format:\n- For each test case, output a list containing four sublists, corresponding to element $1$ condensed stiffness (flattened), element $1$ condensed load (flattened), element $2$ condensed stiffness (flattened), and element $2$ condensed load (flattened).\n- The overall output is a list of the three per-test-case lists, so the final output has the form $[[\\ldots],[\\ldots],[\\ldots]]$ where each inner list has exactly four sublists in the specified order.\n\nNo shortcuts or pre-supplied formulas are permitted in your derivation; the computation must follow from the fundamental definitions given above and the static condensation operation.",
            "solution": "The solution proceeds by first deriving the element stiffness matrix and load vector for an augmented space, and then performing static condensation to obtain the coarse-scale operators.\n\nThe one-dimensional steady advection-diffusion equation is given by:\n$$\n-\\nu \\frac{d^2 u}{dx^2} + a \\frac{d u}{dx} = f, \\quad x \\in [0, 1]\n$$\nwhere $\\nu > 0$, $a \\in \\mathbb{R}$, and $f \\in \\mathbb{R}$ are constants.\n\nThe weak form over a single element $e$ of size $h$ is to find $u \\in V_h$ such that for all $w \\in V_h$:\n$$\n\\int_e \\nu w' u' \\, dx + \\int_e a w u' \\, dx = \\int_e w f \\, dx\n$$\nThe space $V_h$ on the element is spanned by the basis functions $\\{N_1, N_2, N_b\\}$. In the local coordinate $\\xi \\in [0, 1]$, these are:\n- Linear shape functions: $N_1(\\xi) = 1 - \\xi$, $N_2(\\xi) = \\xi$\n- Bubble shape function: $N_b(\\xi) = 4\\xi(1 - \\xi)$\n\nThe relationship between the global coordinate $x$ and local coordinate $\\xi$ is given by the affine mapping $x(\\xi) = x_1 + h\\xi$, where $x_1$ is the start coordinate of the element. This gives the differential relationships $dx = h \\, d\\xi$ and $\\frac{d}{dx} = \\frac{1}{h} \\frac{d}{d\\xi}$. Denoting differentiation with respect to $x$ by $'$ and with respect to $\\xi$ by a dot, we have $g'(\\xi) = \\frac{1}{h}\\dot{g}(\\xi)$.\n\nThe derivatives of the basis functions with respect to $\\xi$ are:\n- $\\dot{N}_1(\\xi) = -1$\n- $\\dot{N}_2(\\xi) = 1$\n- $\\dot{N}_b(\\xi) = 4(1 - 2\\xi)$\n\nThe $3 \\times 3$ element stiffness matrix $K_e$ and $3 \\times 1$ load vector $F_e$ have entries given by:\n$$\nK_{ij} = \\int_e \\left( \\nu N_i' N_j' + a N_i N_j' \\right) dx, \\quad F_i = \\int_e N_i f \\, dx\n$$\nChanging to local coordinates:\n$$\nK_{ij} = \\int_0^1 \\left( \\nu \\frac{\\dot{N}_i}{h} \\frac{\\dot{N}_j}{h} + a N_i \\frac{\\dot{N}_j}{h} \\right) h \\, d\\xi = \\frac{\\nu}{h} \\int_0^1 \\dot{N}_i \\dot{N}_j \\, d\\xi + a \\int_0^1 N_i \\dot{N}_j \\, d\\xi\n$$\n$$\nF_i = \\int_0^1 N_i f \\, h \\, d\\xi = fh \\int_0^1 N_i \\, d\\xi\n$$\n\nWe compute the required integrals:\n**Diffusion-related integrals ($\\int \\dot{N}_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_1 d\\xi = \\int_0^1 (-1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_2 d\\xi = \\int_0^1 (-1)(1) d\\xi = -1$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_2 d\\xi = \\int_0^1 (1)^2 d\\xi = 1$\n- $\\int_0^1 \\dot{N}_1 \\dot{N}_b d\\xi = \\int_0^1 (-1)4(1-2\\xi) d\\xi = -4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_2 \\dot{N}_b d\\xi = \\int_0^1 (1)4(1-2\\xi) d\\xi = 4[\\xi - \\xi^2]_0^1 = 0$\n- $\\int_0^1 \\dot{N}_b \\dot{N}_b d\\xi = \\int_0^1 16(1-2\\xi)^2 d\\xi = 16[\\xi - 2\\xi^2 + \\frac{4}{3}\\xi^3]_0^1 = 16(1-2+\\frac{4}{3}) = \\frac{16}{3}$\nThe diffusion part of the stiffness matrix is $K^{\\nu} = \\frac{\\nu}{h} \\begin{pmatrix} 1 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ 0 & 0 & 16/3 \\end{pmatrix}$.\n\n**Advection-related integrals ($\\int N_i \\dot{N}_j \\, d\\xi$):**\n- $\\int_0^1 N_1 \\dot{N}_1 d\\xi = \\int_0^1 (1-\\xi)(-1) d\\xi = -1/2$\n- $\\int_0^1 N_1 \\dot{N}_2 d\\xi = \\int_0^1 (1-\\xi)(1) d\\xi = 1/2$\n- $\\int_0^1 N_1 \\dot{N}_b d\\xi = \\int_0^1 (1-\\xi)4(1-2\\xi) d\\xi = 2/3$\n- $\\int_0^1 N_2 \\dot{N}_1 d\\xi = \\int_0^1 \\xi(-1) d\\xi = -1/2$\n- $\\int_0^1 N_2 \\dot{N}_2 d\\xi = \\int_0^1 \\xi(1) d\\xi = 1/2$\n- $\\int_0^1 N_2 \\dot{N}_b d\\xi = \\int_0^1 \\xi 4(1-2\\xi) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_1 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(-1) d\\xi = -2/3$\n- $\\int_0^1 N_b \\dot{N}_2 d\\xi = \\int_0^1 4(\\xi-\\xi^2)(1) d\\xi = 2/3$\n- $\\int_0^1 N_b \\dot{N}_b d\\xi = \\int_0^1 4(\\xi-\\xi^2)4(1-2\\xi) d\\xi = 0$\nThe advection part of the stiffness matrix is $K^{a} = a \\begin{pmatrix} -1/2 & 1/2 & 2/3 \\\\ -1/2 & 1/2 & -2/3 \\\\ -2/3 & 2/3 & 0 \\end{pmatrix}$.\n\n**Load-related integrals ($\\int N_i \\, d\\xi$):**\n- $\\int_0^1 N_1 d\\xi = \\int_0^1 (1-\\xi) d\\xi = 1/2$\n- $\\int_0^1 N_2 d\\xi = \\int_0^1 \\xi d\\xi = 1/2$\n- $\\int_0^1 N_b d\\xi = \\int_0^1 4(\\xi-\\xi^2) d\\xi = 2/3$\nThe complete load vector is $F_e = fh \\begin{pmatrix} 1/2 \\\\ 1/2 \\\\ 2/3 \\end{pmatrix}$.\n\nThe total element matrix $K_e = K^\\nu + K^a$ is:\n$$\nK_e = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} & -\\frac{\\nu}{h} + \\frac{a}{2} & \\frac{2a}{3} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} & \\frac{\\nu}{h} + \\frac{a}{2} & -\\frac{2a}{3} \\\\\n-\\frac{2a}{3} & \\frac{2a}{3} & \\frac{16\\nu}{3h}\n\\end{pmatrix}\n$$\nThe total element vector $F_e$ is:\n$$\nF_e = \\begin{pmatrix} \\frac{fh}{2} \\\\ \\frac{fh}{2} \\\\ \\frac{2fh}{3} \\end{pmatrix}\n$$\n\nFor static condensation, we partition these into coarse-coarse ($cc$), coarse-bubble ($cb$), bubble-coarse ($bc$), and bubble-bubble ($bb$) blocks, corresponding to the basis ordering $\\{N_1, N_2, N_b\\}$:\n- $K_{cc} = \\begin{pmatrix} \\frac{\\nu}{h} - \\frac{a}{2} & -\\frac{\\nu}{h} + \\frac{a}{2} \\\\ -\\frac{\\nu}{h} - \\frac{a}{2} & \\frac{\\nu}{h} + \\frac{a}{2} \\end{pmatrix}$\n- $K_{cb} = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix}$\n- $K_{bc} = \\begin{pmatrix} -2a/3 & 2a/3 \\end{pmatrix}$\n- $K_{bb} = \\frac{16\\nu}{3h}$\n- $F_{cc} = \\begin{pmatrix} fh/2 \\\\ fh/2 \\end{pmatrix}$\n- $F_b = \\frac{2fh}{3}$\n\nThe condensed operators are $K_{e}^{\\text{cond}} = K_{cc} - K_{cb} K_{bb}^{-1} K_{bc}$ and $F_{e}^{\\text{cond}} = F_{cc} - K_{cb} K_{bb}^{-1} F_{b}$.\nFirst, $K_{bb}^{-1} = \\frac{3h}{16\\nu}$.\n\nThe stiffness modification is $\\Delta K = K_{cb} K_{bb}^{-1} K_{bc}$:\n$$\n\\Delta K = \\begin{pmatrix} \\frac{2a}{3} \\\\ -\\frac{2a}{3} \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\begin{pmatrix} -\\frac{2a}{3} & \\frac{2a}{3} \\end{pmatrix} = \\frac{3ha^2}{16\\nu} \\begin{pmatrix} -4/9 & 4/9 \\\\ 4/9 & -4/9 \\end{pmatrix} = \\frac{ha^2}{12\\nu} \\begin{pmatrix} -1 & 1 \\\\ 1 & -1 \\end{pmatrix}\n$$\nThe condensed stiffness matrix is $K_{e}^{\\text{cond}} = K_{cc} - \\Delta K$:\n$$\nK_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{\\nu}{h} - \\frac{a}{2} + \\frac{ha^2}{12\\nu} & -\\frac{\\nu}{h} + \\frac{a}{2} - \\frac{ha^2}{12\\nu} \\\\\n-\\frac{\\nu}{h} - \\frac{a}{2} - \\frac{ha^2}{12\\nu} & \\frac{\\nu}{h} + \\frac{a}{2} + \\frac{ha^2}{12\\nu}\n\\end{pmatrix}\n$$\n\nThe load modification is $\\Delta F = K_{cb} K_{bb}^{-1} F_{b}$:\n$$\n\\Delta F = \\begin{pmatrix} 2a/3 \\\\ -2a/3 \\end{pmatrix} \\left( \\frac{3h}{16\\nu} \\right) \\left( \\frac{2fh}{3} \\right) = \\frac{12afh^2}{144\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\frac{afh^2}{12\\nu} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}\n$$\nThe condensed load vector is $F_{e}^{\\text{cond}} = F_{cc} - \\Delta F$:\n$$\nF_{e}^{\\text{cond}} = \\begin{pmatrix}\n\\frac{fh}{2} - \\frac{afh^2}{12\\nu} \\\\\n\\frac{fh}{2} + \\frac{afh^2}{12\\nu}\n\\end{pmatrix}\n$$\nThese derived formulas are implemented in the following code. For both elements, $h=0.5$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the condensed stiffness matrix and load vector for a 1D advection-diffusion\n    problem using static condensation of a bubble function.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 0.01, 1.0),   # Case 1\n        (0.1, 1.0, 2.0),   # Case 2\n        (2.5, 0.001, -0.5), # Case 3\n    ]\n\n    # Both elements have the same size h\n    h = 0.5\n    \n    results = []\n    \n    for case in test_cases:\n        a, nu, f = case\n\n        # --- DERIVATION BASED CALCULATION ---\n        \n        # Intermediate terms from the derived formulas\n        nu_over_h = nu / h\n        a_over_2 = a / 2\n        \n        # Stabilization term for stiffness matrix (from K_cb * K_bb^-1 * K_bc)\n        # delta_K_term = (h * a^2) / (12 * nu)\n        stabilization_k_term = (h * a**2) / (12.0 * nu)\n        \n        # Condensed stiffness matrix components\n        k11 = nu_over_h - a_over_2 + stabilization_k_term\n        k12 = -nu_over_h + a_over_2 - stabilization_k_term\n        k21 = -nu_over_h - a_over_2 - stabilization_k_term\n        k22 = nu_over_h + a_over_2 + stabilization_k_term\n        \n        K_cond_flat = [k11, k12, k21, k22]\n        \n        # Intermediate terms for load vector\n        f_h_over_2 = f * h / 2.0\n        \n        # Stabilization term for load vector (from K_cb * K_bb^-1 * F_b)\n        # delta_F_term = (a * f * h^2) / (12 * nu)\n        stabilization_f_term = (a * f * h**2) / (12.0 * nu)\n        \n        # Condensed load vector components\n        f1 = f_h_over_2 - stabilization_f_term\n        f2 = f_h_over_2 + stabilization_f_term\n        \n        F_cond_flat = [f1, f2]\n        \n        # The problem specifies a two-element mesh with h=0.5 for both.\n        # Thus, the matrices and vectors for element 1 and element 2 are identical.\n        case_result = [K_cond_flat, F_cond_flat, K_cond_flat, F_cond_flat]\n        \n        results.append(case_result)\n\n    # Custom string formatting to avoid spaces between list elements\n    # and to match the desired compact output.\n    def format_list_compactly(l):\n        return f\"[{','.join(str(x) for x in l)}]\"\n\n    def format_case_result(cr):\n        k1f_str = format_list_compactly(cr[0])\n        f1f_str = format_list_compactly(cr[1])\n        k2f_str = format_list_compactly(cr[2])\n        f2f_str = format_list_compactly(cr[3])\n        return f\"[{k1f_str},{f1f_str},{k2f_str},{f2f_str}]\"\n    \n    final_output_string = f\"[{','.join(map(format_case_result, results))}]\"\n\n    print(final_output_string)\n\n\nsolve()\n```"
        }
    ]
}