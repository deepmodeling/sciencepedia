{
    "hands_on_practices": [
        {
            "introduction": "在分析复杂的时空模式之前，我们必须首先确定系统的基准状态。这个练习将引导您计算一个反应-扩散系统的均匀稳态，在该状态下，所有反应项达到平衡，且浓度在空间上是均匀的。掌握如何求解稳态是进行任何后续稳定性分析（如图灵失稳）的基础步骤，它定义了系统可能发生分岔的出发点 。",
            "id": "4382312",
            "problem": "在系统生物医学中，活化剂-抑制剂反应扩散系统为组织中形态发生素浓度的自组织提供了机理模型。考虑一个Schnakenberg模型，该模型描述了两种无量纲化学物质，其浓度为 $u(\\mathbf{x},t)$ 和 $v(\\mathbf{x},t)$，在一个具有反射边界的有界域上随时间演化。其控制方程遵循一般的反应扩散形式 $u_t = D_u \\nabla^2 u + R_u(u,v)$ 和 $v_t = D_v \\nabla^2 v + R_v(u,v)$，其中 $D_u0$ 和 $D_v0$ 是扩散系数，$R_u$ 和 $R_v$ 是反应项，源自经过充分检验的、用于补给和自催化步骤的质量作用动力学近似。在Schnakenberg模型中，反应项由 $R_u(u,v)=a - u + u^2 v$ 和 $R_v(u,v)=b - u^2 v$ 给出，其中 $a0$ 和 $b0$ 是恒定的补给速率。\n\n写出完整的Schnakenberg反应扩散系统，并利用均匀稳态（定义为平衡反应通量的空间均匀、时间无关的解）的定义，计算以 $a$ 和 $b$ 表示的均匀稳态 $(u^*,v^*)$。将你的最终答案表示为有序对 $(u^*,v^*)$ 的单一闭式解析表达式。最终表达式无需四舍五入，也不应包含任何物理单位。",
            "solution": "该问题已经过验证，被认为是有效的。它在科学上基于已建立的反应扩散系统理论，特别是Schnakenberg模型，这是数学生物学中的一个标准课题。该问题是适定的、无歧义的，并包含计算所要求的均匀稳态所需的所有必要信息。\n\n第一个任务是写出完整的Schnakenberg反应扩散系统。问题提供了方程的一般形式：\n$$\nu_t = D_u \\nabla^2 u + R_u(u,v)\n$$\n$$\nv_t = D_v \\nabla^2 v + R_v(u,v)\n$$\n以及Schnakenberg模型的具体反应动力学：\n$$\nR_u(u,v) = a - u + u^2 v\n$$\n$$\nR_v(u,v) = b - u^2 v\n$$\n将这些反应项代入一般方程，得到完整的系统：\n$$\n\\frac{\\partial u}{\\partial t} = D_u \\nabla^2 u + a - u + u^2 v\n$$\n$$\n\\frac{\\partial v}{\\partial t} = D_v \\nabla^2 v + b - u^2 v\n$$\n其中 $u(\\mathbf{x}, t)$ 和 $v(\\mathbf{x}, t)$ 是两种化学物质的浓度，$D_u  0$ 和 $D_v  0$ 是它们各自的扩散系数，$a  0$ 和 $b  0$ 是恒定的补给速率。反射边界在区域边界上施加了无通量边界条件，$\\mathbf{n} \\cdot \\nabla u = 0$ 和 $\\mathbf{n} \\cdot \\nabla v = 0$，其中 $\\mathbf{n}$ 是向外的法向量。\n\n第二个任务是计算均匀稳态，记为 $(u^*, v^*)$。均匀稳态是一个既不依赖于时间又在空间上均匀的解。\n\n$1$. **时间无关性**：浓度不随时间变化，这意味着它们对时间的偏导数为零。\n$$\n\\frac{\\partial u}{\\partial t} = 0\n$$\n$$\n\\frac{\\partial v}{\\partial t} = 0\n$$\n\n$2$. **空间均匀性（同质性）**：浓度不随空间位置 $\\mathbf{x}$ 变化。这意味着浓度在空间上是常数，$u = u^*$ 和 $v = v^*$，其中 $u^*$ 和 $v^*$ 是常数。因此，所有空间导数均为零。特别是，拉普拉斯项为零：\n$$\n\\nabla^2 u = \\nabla \\cdot (\\nabla u) = \\nabla \\cdot (\\mathbf{0}) = 0\n$$\n$$\n\\nabla^2 v = \\nabla \\cdot (\\nabla v) = \\nabla \\cdot (\\mathbf{0}) = 0\n$$\n\n将这两个条件应用于完整的反应扩散系统，可将偏微分方程组简化为一个包含两个代数方程的方程组。扩散项和时间导数消失，只剩下必须等于零以维持稳态的反应项。\n$$\n0 = 0 + a - u^* + (u^*)^2 v^* \\quad \\implies \\quad a - u^* + (u^*)^2 v^* = 0\n$$\n$$\n0 = 0 + b - (u^*)^2 v^* \\quad \\implies \\quad b - (u^*)^2 v^* = 0\n$$\n\n我们现在求解这个由两个代数方程组成的方程组，以求出两个未知数 $u^*$ 和 $v^*$。\n从第二个方程中，我们可以用 $b$ 来表示 $(u^*)^2 v^*$ 项：\n$$\n(u^*)^2 v^* = b\n$$\n这个表达式表示一种平衡，即物质 $v$ 的自催化产生速率与恒定的补给速率 $b$ 完全匹配。\n\n接下来，我们将此结果代入第一个方程：\n$$\na - u^* + (b) = 0\n$$\n解出 $u^*$，我们得到：\n$$\nu^* = a + b\n$$\n\n最后，我们将 $u^*$ 的表达式代回到关系式 $(u^*)^2 v^* = b$ 中，以求出 $v^*$：\n$$\n(a+b)^2 v^* = b\n$$\n由于问题说明 $a  0$ 和 $b  0$，因此 $a+b \\neq 0$，所以我们可以除以 $(a+b)^2$：\n$$\nv^* = \\frac{b}{(a+b)^2}\n$$\n\n因此，均匀稳态 $(u^*, v^*)$ 由上面推导出的有序表达式对给出。由于 $a$ 和 $b$ 都是正数，所以 $u^*$ 和 $v^*$ 也都是正数，这对于化学浓度来说在物理上是一致的。\n\n解是有序对 $(u^*, v^*)$。\n$$\n(u^*, v^*) = \\left( a+b, \\frac{b}{(a+b)^2} \\right)\n$$",
            "answer": "$$\n\\boxed{\\left(a+b, \\frac{b}{(a+b)^2}\\right)}\n$$"
        },
        {
            "introduction": "反应-扩散系统最引人入胜的特性之一是从均匀状态自发产生空间模式的能力，这一现象被称为扩散驱动失稳。本练习将带您深入图灵理论的核心，通过线性稳定性分析来探索这一机制。您将推导出临界波数 $k_c$ ，它决定了新生模式的特征空间尺度，从而深刻理解系统自组织的原理 。",
            "id": "3800520",
            "problem": "考虑一个在无限长直线上的双物种反应扩散系统，其状态向量 $w(x,t) = (u(x,t), v(x,t))^{\\top}$ 服从\n$$\n\\partial_t w = D \\,\\partial_{xx} w + R(w),\n$$\n其中 $D = \\mathrm{diag}(D_u, D_v)$ 是对角扩散矩阵，$R(w)$ 是一个光滑的反应向量场。令 $w^{\\ast}$ 为反应动力学的一个空间均匀不动点，因此 $R(w^{\\ast}) = 0$。通过设 $w(x,t) = w^{\\ast} + \\eta(x,t)$ 且 $|\\eta| \\ll 1$ 在 $w^{\\ast}$ 附近进行线性化，并将 $R$ 在 $w^{\\ast}$ 处的雅可比矩阵记为 $J$，其元素为 $J = \\begin{pmatrix} f_u  f_v \\\\ g_u  g_v \\end{pmatrix}$，迹为 $\\tau = f_u + g_v$，行列式为 $\\Delta = f_u g_v - f_v g_u$。假设在没有扩散的情况下，该均匀不动点对空间均匀扰动是线性稳定的，即 $\\tau  0$ 且 $\\Delta  0$。设扩散系数为 $D_u = 1$ 和 $D_v = 10$。\n\n从线性化的偏微分方程出发，利用空间傅里叶模态，推导模态增长率的色散关系，并确定当参数调整到静态图灵（Turing）不稳定性发生时，主导特征值 $\\mathrm{Re}\\,\\lambda(k)$ 的实部首次变为正值时的临界波数 $k_c \\neq 0$。用给定的值 $D_u = 1$ 和 $D_v = 10$，将你的最终答案表示为仅包含 $f_u$ 和 $g_v$ 的闭式解析表达式。不需要进行数值计算。如果出现平方根，取其主枝。给出 $k_c$ 的答案，不带单位。不需要四舍五入。",
            "solution": "出发点是由向量方程描述的双物种反应扩散系统：\n$$\n\\partial_t w = D \\,\\partial_{xx} w + R(w)\n$$\n其中 $w(x,t) = (u(x,t), v(x,t))^{\\top}$，$D = \\mathrm{diag}(D_u, D_v)$ 是对角扩散矩阵，$R(w)$ 是反应项。\n\n给定一个空间均匀不动点 $w^{\\ast}$，使得 $R(w^{\\ast}) = 0$。为分析该不动点的线性稳定性，我们通过设 $w(x,t) = w^{\\ast} + \\eta(x,t)$ 来考虑小扰动 $\\eta(x,t)$。将此代入控制方程并在 $w^{\\ast}$ 附近进行线性化，得到扰动 $\\eta$ 的方程：\n$$\n\\partial_t \\eta = D \\,\\partial_{xx} \\eta + J \\eta\n$$\n其中 $J$ 是反应项 $R(w)$ 在不动点 $w^{\\ast}$ 处求值的雅可比矩阵：\n$$\nJ = \\begin{pmatrix} f_u  f_v \\\\ g_u  g_v \\end{pmatrix}\n$$\n此处，矩阵元素是 $R$ 各分量的偏导数，例如，$f_u = \\partial R_1 / \\partial u$ 在 $w^{\\ast}$ 处求值。\n\n为了找到色散关系，我们寻找空间傅里叶模态形式的解：\n$$\n\\eta(x,t) = \\hat{\\eta} \\exp(i k x + \\lambda t)\n$$\n其中 $k$ 是空间波数，$\\lambda$ 是时间增长率，$\\hat{\\eta}$ 是常数振幅向量。将此拟设代入线性化的偏微分方程得到：\n$$\n\\lambda \\hat{\\eta} \\exp(i k x + \\lambda t) = D (ik)^2 \\hat{\\eta} \\exp(i k x + \\lambda t) + J \\hat{\\eta} \\exp(i k x + \\lambda t)\n$$\n两边除以指数项，我们得到关于增长率 $\\lambda$ 的一个特征值问题：\n$$\n\\lambda \\hat{\\eta} = (-k^2 D + J) \\hat{\\eta}\n$$\n特征值 $\\lambda$ 是特征方程 $\\det(-k^2 D + J - \\lambda I) = 0$ 的解，其中 $I$ 是单位矩阵。该特征值问题的矩阵是 $M(k) = J - k^2 D$：\n$$\nM(k) = \\begin{pmatrix} f_u - k^2 D_u  f_v \\\\ g_u  g_v - k^2 D_v \\end{pmatrix}\n$$\n特征方程为 $\\lambda^2 - \\mathrm{Tr}(M(k))\\lambda + \\det(M(k)) = 0$。此方程即为色散关系，它将增长率 $\\lambda$ 与波数 $k$ 联系起来。\n\n$M(k)$ 的迹和行列式为：\n$$\n\\mathrm{Tr}(M(k)) = (f_u - k^2 D_u) + (g_v - k^2 D_v) = (f_u + g_v) - k^2(D_u + D_v) = \\tau - k^2(D_u + D_v)\n$$\n$$\n\\det(M(k)) = (f_u - k^2 D_u)(g_v - k^2 D_v) - f_v g_u = f_u g_v - f_v g_u - k^2(f_u D_v + g_v D_u) + k^4 D_u D_v = \\Delta - k^2(f_u D_v + g_v D_u) + k^4 D_u D_v\n$$\n其中 $\\tau = f_u + g_v$ 和 $\\Delta = f_u g_v - f_v g_u$ 分别是雅可比矩阵 $J$ 的迹和行列式。\n\n问题陈述，空间均匀不动点对空间均匀扰动（$k=0$）是稳定的。这意味着对于 $k=0$，两个特征值 $\\lambda$ 的实部均为负。在一个二维系统中，其条件是 $\\tau  0$ 和 $\\Delta  0$。\n\n当扩散对于一个非零波数 $k \\neq 0$ 使该不动点失稳时，就会发生静态图灵（Turing）不稳定性。这种不稳定性的发生是静态的，意味着特征值的虚部为零（$\\mathrm{Im}(\\lambda) = 0$）。当主导实特征值 $\\mathrm{Re}(\\lambda_+(k))$ 从负值穿过零变为正值时，不稳定性就产生了。根据特征方程，特征值为 $\\lambda_{\\pm}(k) = \\frac{1}{2}(\\mathrm{Tr}(M(k)) \\pm \\sqrt{\\mathrm{Tr}(M(k))^2 - 4\\det(M(k))})$。对于静态不稳定性，一个特征值会穿过 $\\lambda = 0$。这恰好在 $\\det(M(k)) = 0$ 时发生。\n\n当系统参数变化时，不稳定性在 $\\det(M(k))$ 首次变为负值的波数 $k$ 处出现。在不稳定的阈值处，对于 $k0$，$\\det(M(k))$ 的最小值恰好为零。临界波数 $k_c$ 就是这个最小值发生处的波数。\n\n让我们求 $\\det(M(k))$ 关于 $k$ 的最小值。为简单起见，令 $K = k^2$。行列式的表达式是关于 $K$ 的一个二次式：\n$$\nF(K) = (D_u D_v) K^2 - (f_u D_v + g_v D_u) K + \\Delta\n$$\n为了求最小值，我们计算其关于 $K$ 的导数并令其为零：\n$$\n\\frac{dF}{dK} = 2(D_u D_v)K - (f_u D_v + g_v D_u) = 0\n$$\n解出 $K$ 得到临界值 $K_c = k_c^2$：\n$$\nk_c^2 = \\frac{f_u D_v + g_v D_u}{2 D_u D_v}\n$$\n这给出了临界波数的平方，它是在图灵（Turing）不稳定性发生时最不稳定模态的波数。要发生图灵不稳定性，必须有 $k_c^2  0$，这要求 $f_u D_v + g_v D_u  0$。\n\n问题要求临界波数 $k_c$ 的表达式。取主（正）平方根，我们得到：\n$$\nk_c = \\sqrt{\\frac{f_u D_v + g_v D_u}{2 D_u D_v}}\n$$\n给定扩散系数 $D_u = 1$ 和 $D_v = 10$。将这些值代入 $k_c^2$ 的表达式中：\n$$\nk_c^2 = \\frac{f_u(10) + g_v(1)}{2(1)(10)} = \\frac{10 f_u + g_v}{20}\n$$\n取平方根，得到临界波数 $k_c$ 关于 $f_u$ 和 $g_v$ 的最终表达式：\n$$\nk_c = \\sqrt{\\frac{10 f_u + g_v}{20}}\n$$\n这也可以写成 $k_c = \\sqrt{\\frac{f_u}{2} + \\frac{g_v}{20}}$。我们将以第一种形式给出答案。",
            "answer": "$$\\boxed{\\sqrt{\\frac{10f_u + g_v}{20}}}$$"
        },
        {
            "introduction": "在生物学和材料科学中，许多系统在微观尺度上呈现出非均匀性，直接模拟这些复杂细节在计算上往往是不可行的。本练习将理论与计算相结合，指导您应用多尺度建模中的一个关键方法——均匀化理论。您将首先从第一性原理推导出描述宏观行为的有效参数，然后通过编写数值模拟程序来验证您的理论预测，这是连接解析理论与实际应用的现代建模必备技能 。",
            "id": "4382351",
            "problem": "考虑一个一维反应扩散介质，它代表一种周期性微结构的生物组织。浓度场用 $u(x,t)$ 表示，空间坐标为 $x \\in [0,L]$，时间为 $t \\ge 0$。其控制偏微分方程（PDE）由Fick定律的通量平衡项和一阶反应消耗项构成，即\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\left(D\\left(\\frac{x}{\\epsilon}\\right)\\frac{\\partial u}{\\partial x}\\right) - k\\left(\\frac{x}{\\epsilon}\\right) u,\n$$\n其中 $D\\left(\\frac{x}{\\epsilon}\\right)$ 是微尺度扩散系数，$k\\left(\\frac{x}{\\epsilon}\\right)$ 是微尺度一阶反应速率，两者在微尺度上均是周期性的，周期为 $\\epsilon \\ll L$。该微结构在每个周期内由两相组成，相1的体积分数为 $f \\in (0,1)$，相2的体积分数为 $1-f$。相1的扩散系数为 $D_1$，反应速率为 $k_1$，而相2的扩散系数为 $D_2$，反应速率为 $k_2$。所有物理量必须使用以下单位处理：$D$ 的单位为平方微米/秒（$\\mu m^2/s$），$k$ 的单位为秒的倒数（$s^{-1}$），长度（包括 $L$ 和单元长度）的单位为微米（$\\mu m$）。答案必须表示为无量纲的小数（浮点数）。\n\n您的目标是实现一个完整的、可运行的程序，该程序针对一组指定的微尺度参数，执行两次微尺度模拟以推断有效参数，然后将这些参数与从第一性原理推导出的均质化模型参数进行比较。这两次模拟是：\n\n- 稳态扩散实验（用于推断有效扩散系数）：施加固定的边界浓度 $u(0)=0$ 和 $u(L)=\\Delta$，其中 $\\Delta$ 是一个指定的常数。求解稳态问题\n$$\n\\frac{d}{dx}\\left(D\\left(\\frac{x}{\\epsilon}\\right)\\frac{d u}{dx}\\right) = 0,\n$$\n并计算由此产生的恒定通量 $J$。根据微尺度解，通过整个域上的通量与宏观梯度的关系，推断出有效扩散系数 $D_{\\mathrm{eff}}^{\\mathrm{micro}}$。使用能够解析周期性微结构的、数值上一致的一维离散化方法。\n\n- 零通量边界下的初始衰减（用于推断有效反应速率）：在 $x=0$ 和 $x=L$ 处施加零通量（Neumann）边界条件，从空间均匀的初始条件 $u(x,0)=u_0$ 开始，并将微尺度系统推进一个微小的时间增量 $dt$，使得在 $t=0$ 时空间平均值的变化主要由反应主导（对于均匀场，扩散通量初始为零）。从空间平均值的初始衰减率推断出有效反应速率 $k_{\\mathrm{eff}}^{\\mathrm{micro}}$。\n\n然后，对于每个测试用例，您必须：\n1. 基于微结构定义和反应扩散机理，从第一性原理推导均质化模型参数 $D_{\\mathrm{eff}}^{\\mathrm{hom}}$ 和 $k_{\\mathrm{eff}}^{\\mathrm{hom}}$，不得使用任何简便公式。\n2. 通过计算相对误差来量化跨尺度的模型不匹配程度\n$$\n\\text{mismatch}_D = \\left|\\frac{D_{\\mathrm{eff}}^{\\mathrm{micro}} - D_{\\mathrm{eff}}^{\\mathrm{hom}}}{D_{\\mathrm{eff}}^{\\mathrm{hom}}}\\right|,\\quad\n\\text{mismatch}_k = \\left|\\frac{k_{\\mathrm{eff}}^{\\mathrm{micro}} - k_{\\mathrm{eff}}^{\\mathrm{hom}}}{k_{\\mathrm{eff}}^{\\mathrm{hom}}}\\right|.\n$$\n将这些不匹配程度表示为无量纲的小数。\n\n必须遵循的实现细节：\n- 将域离散为能够解析微周期的单元。每个单元使用分段常数的 $D$ 和 $k$。在每个长度为 $\\ell_{\\mathrm{cell}}$ 的微周期内，将前 $f$ 部分的单元分配给相1，剩余部分分配给相2。使用足够精细的周期内分辨率来良好地近似 $f$。\n- 对于稳态扩散实验，使用Dirichlet边界条件 $u(0)=0$ 和 $u(L)=\\Delta$，其中 $\\Delta=1$（单位浓度差），并根据离散解使用Fick定律计算恒定通量 $J$。通过将通量归结为在梯度为 $\\Delta/L$ 的 $[0,L]$ 上的单个有效系数来推断 $D_{\\mathrm{eff}}^{\\mathrm{micro}}$。\n- 对于初始衰减实验，使用Neumann边界（零通量）、均匀初始条件 $u_0=1$ 和一个小的秒级时间步长 $dt = 10^{-4}$。使用离散的反应扩散算子进行一个显式步进，然后从 $t=0$ 时空间平均值的变化推断 $k_{\\mathrm{eff}}^{\\mathrm{micro}}$。\n- 均质化参数 $D_{\\mathrm{eff}}^{\\mathrm{hom}}$ 和 $k_{\\mathrm{eff}}^{\\mathrm{hom}}$ 必须从基本定律和已定义的微结构推导得出，而不是来自任何记忆的简便公式。\n\n测试套件：\n使用以下三个科学上合理的案例。在每个案例中，$L$ 是 $\\ell_{\\mathrm{cell}}$ 的整数倍，以产生整数个微周期，并且您必须将每个微周期离散为足够多的整数个单元，以精确近似 $f$。\n\n- 案例1（一般异构情况）：\n  - $L = 100\\,\\mu m$，$\\ell_{\\mathrm{cell}} = 5\\,\\mu m$，$f=0.3$，$D_1 = 100\\,\\mu m^2/s$，$D_2 = 10\\,\\mu m^2/s$，$k_1 = 0.05\\,s^{-1}$，$k_2 = 0.01\\,s^{-1}$。\n\n- 案例2（极端扩散对比度和反应局限于一相）：\n  - $L = 96\\,\\mu m$，$\\ell_{\\mathrm{cell}} = 6\\,\\mu m$，$f=0.5$，$D_1 = 1000\\,\\mu m^2/s$，$D_2 = 1\\,\\mu m^2/s$，$k_1 = 0.00\\,s^{-1}$，$k_2 = 0.10\\,s^{-1}$。\n\n- 案例3（用于验证的均质极限）：\n  - $L = 120\\,\\mu m$，$\\ell_{\\mathrm{cell}} = 4\\,\\mu m$，$f=0.4$，$D_1 = 50\\,\\mu m^2/s$，$D_2 = 50\\,\\mu m^2/s$，$k_1 = 0.02\\,s^{-1}$，$k_2 = 0.02\\,s^{-1}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含每个案例的扩散不匹配度和反应不匹配度：\n$[\\text{mismatch}_{D,1},\\text{mismatch}_{k,1},\\text{mismatch}_{D,2},\\text{mismatch}_{k,2},\\text{mismatch}_{D,3},\\text{mismatch}_{k,3}]$。\n所有条目必须是无量纲的小数（浮点数）。",
            "solution": "该问题定义明确且具有科学依据，要求推导并数值验证周期性介质中一维反应扩散系统的有效参数。解决该问题的方法是：首先从第一性原理推导均质化参数，然后执行两个指定的数值实验以找到其微尺度对应值，最后计算两组参数之间的相对误差。\n\n### 步骤1：均质化参数的推导 ($D_{\\mathrm{eff}}^{\\mathrm{hom}}, k_{\\mathrm{eff}}^{\\mathrm{hom}}$)\n\n该问题考虑一个具有周期性变化的扩散系数 $D(x/\\epsilon)$ 和反应速率 $k(x/\\epsilon)$ 的一维介质。均质化的目标是找到恒定的有效参数 $D_{\\mathrm{eff}}$ 和 $k_{\\mathrm{eff}}$，用以描述系统在宏观尺度上的行为，在宏观尺度上，微结构的变化被平均掉了。\n\n#### 有效反应速率 ($k_{\\mathrm{eff}}^{\\mathrm{hom}}$)\n\n考虑浓度场 $u$ 在空间上是均匀的，但随时间因反应而消耗的情况。宏观或空间平均的反应扩散方程为：\n$$ \\frac{\\partial \\langle u \\rangle}{\\partial t} = \\frac{\\partial}{\\partial x}\\left\\langle D\\frac{\\partial u}{\\partial x}\\right\\rangle - \\langle ku \\rangle $$\n其中 $\\langle \\cdot \\rangle$ 表示在一个代表性体积元上的空间平均，在本例中，该体积元是一个长度为 $\\ell_{\\mathrm{cell}}$ 的单周期。\n如果 $u$ 是均匀的，则扩散项消失。方程简化为 $\\frac{d\\langle u \\rangle}{dt} = -\\langle ku \\rangle$。由于 $u$ 在空间上是常数，我们可以写成 $\\langle u \\rangle = u$，方程变为 $\\frac{du}{dt} = -\\langle k \\rangle u$。\n通过将其与均质化形式 $\\frac{du}{dt} = -k_{\\mathrm{eff}} u$进行比较，我们将有效反应速率确定为微尺度反应速率的空间平均值：\n$$ k_{\\mathrm{eff}}^{\\mathrm{hom}} = \\langle k \\rangle = \\frac{1}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} k(y) dy $$\n对于给定的两相介质，其中相1以速率 $k_1$ 占据体积分数 $f$，相2以速率 $k_2$ 占据剩余的 $1-f$，该积分变成一个简单的加权和：\n$$ k_{\\mathrm{eff}}^{\\mathrm{hom}} = \\frac{1}{\\ell_{\\mathrm{cell}}} \\left( \\int_{0}^{f\\ell_{\\mathrm{cell}}} k_1 dy + \\int_{f\\ell_{\\mathrm{cell}}}^{\\ell_{\\mathrm{cell}}} k_2 dy \\right) = \\frac{1}{\\ell_{\\mathrm{cell}}} (f\\ell_{\\mathrm{cell}}k_1 + (1-f)\\ell_{\\mathrm{cell}}k_2) $$\n$$ k_{\\mathrm{eff}}^{\\mathrm{hom}} = f k_1 + (1-f) k_2 $$\n这是反应速率的算术平均值，按各自的体积分数加权。\n\n#### 有效扩散系数 ($D_{\\mathrm{eff}}^{\\mathrm{hom}}$)\n\n为了找到有效扩散系数，我们考虑稳态纯扩散问题：\n$$ \\frac{d}{dx}\\left(D(x)\\frac{du}{dx}\\right) = 0 $$\n该方程意味着通量 $J = -D(x)\\frac{du}{dx}$ 在整个介质中是恒定的。我们可以重新整理这个方程，将浓度梯度表示为 $\\frac{du}{dx} = -\\frac{J}{D(x)}$。\n宏观通量 $\\langle J \\rangle$ 就是 $J$。宏观梯度是 $\\langle \\frac{du}{dx} \\rangle$。有效扩散系数通过宏观尺度上的Fick定律将这两者联系起来：$\\langle J \\rangle = -D_{\\mathrm{eff}} \\langle \\frac{du}{dx} \\rangle$。\n一个周期内的平均梯度是 $\\langle \\frac{du}{dx} \\rangle = \\frac{1}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{du}{dx} dx = \\frac{u(\\ell_{\\mathrm{cell}}) - u(0)}{\\ell_{\\mathrm{cell}}}$。\n我们通过对微观梯度进行积分来找到一个周期内的浓度降：\n$$ u(\\ell_{\\mathrm{cell}}) - u(0) = \\int_{0}^{\\ell_{\\mathrm{cell}}} \\left(-\\frac{J}{D(x)}\\right) dx = -J \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx $$\n将此代入宏观定律的表达式中：\n$$ J = -D_{\\mathrm{eff}}^{\\mathrm{hom}} \\frac{-J}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx $$\n$$ 1 = \\frac{D_{\\mathrm{eff}}^{\\mathrm{hom}}}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx $$\n求解 $D_{\\mathrm{eff}}^{\\mathrm{hom}}$ 可得：\n$$ D_{\\mathrm{eff}}^{\\mathrm{hom}} = \\left( \\frac{1}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx \\right)^{-1} $$\n对于两相介质，积分为：\n$$ \\frac{1}{\\ell_{\\mathrm{cell}}} \\int_{0}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D(x)} dx = \\frac{1}{\\ell_{\\mathrm{cell}}} \\left( \\int_{0}^{f\\ell_{\\mathrm{cell}}} \\frac{1}{D_1} dx + \\int_{f\\ell_{\\mathrm{cell}}}^{\\ell_{\\mathrm{cell}}} \\frac{1}{D_2} dx \\right) = \\frac{f}{D_1} + \\frac{1-f}{D_2} $$\n因此，有效扩散系数是扩散系数的调和平均值，按其体积分数加权：\n$$ D_{\\mathrm{eff}}^{\\mathrm{hom}} = \\left( \\frac{f}{D_1} + \\frac{1-f}{D_2} \\right)^{-1} $$\n\n### 步骤2：微尺度参数的数值推断 ($D_{\\mathrm{eff}}^{\\mathrm{micro}}, k_{\\mathrm{eff}}^{\\mathrm{micro}}$)\n\n我们将域 $[0, L]$ 离散为 $N$ 个等宽的单元，宽度为 $h=L/N$。属性 $D$ 和 $k$ 在每个单元内被视为分段常数。\n\n#### 推断 $D_{\\mathrm{eff}}^{\\mathrm{micro}}$\n\n稳态问题 $\\frac{d}{dx}(D\\frac{du}{dx}) = 0$ 在边界条件 $u(0)=0$ 和 $u(L)=\\Delta=1$ 下求解。在节点 $x_i = ih$ 上使用有限差分格式，其中区间 $[x_i, x_{i+1}]$ 的扩散系数为基于单元的 $D_i$，内部节点 $x_i$ 处的离散方程由通量恒定性导出：$D_{i-1}\\frac{u_i-u_{i-1}}{h} = D_i\\frac{u_{i+1}-u_i}{h}$。这得到以下线性系统：\n$$ D_{i-1}u_{i-1} - (D_{i-1}+D_i)u_i + D_iu_{i+1} = 0 $$\n对于内部节点 $i=1, \\dots, N-1$。求解这个三对角系统得到浓度 $u_i$。然后根据解计算总通量 $J$，例如在第一个区间内：$J = -D_0 \\frac{u_1-u_0}{h}$。有效扩散系数由宏观形式的Fick定律推断得出：$J = -D_{\\mathrm{eff}}^{\\mathrm{micro}} \\frac{\\Delta}{L}$，这给出：\n$$ D_{\\mathrm{eff}}^{\\mathrm{micro}} = - J \\frac{L}{\\Delta} $$\n\n#### 推断 $k_{\\mathrm{eff}}^{\\mathrm{micro}}$\n\n系统从均匀初始条件 $u(x,0)=u_0=1$ 和零通量边界条件开始。对于均匀场，扩散项 $\\frac{\\partial}{\\partial x}(D\\frac{\\partial u}{\\partial x})$ 初始时处处为零。因此，在 $t=0$ 时，控制方程简化为 $\\frac{\\partial u}{\\partial t} = -k(x)u$。\n向前推进一个小的显式Euler时间步长 $dt$，在每个离散位置 $i$ 处的浓度为 $u_i(dt) = u_i(0) - dt \\cdot k_i u_i(0) = u_0(1 - k_i dt)$。在时间 $dt$ 的空间平均浓度为 $\\langle u(dt) \\rangle = \\langle u_0(1 - k(x)dt) \\rangle = u_0(1 - \\langle k(x) \\rangle dt)$。有效反应速率由空间平均值的衰减定义：$\\frac{d\\langle u \\rangle}{dt} = -k_{\\mathrm{eff}}\\langle u \\rangle$。用差分近似导数可得 $\\frac{\\langle u(dt) \\rangle - \\langle u(0) \\rangle}{dt} = -k_{\\mathrm{eff}}^{\\mathrm{micro}} \\langle u(0) \\rangle$。代入平均值的表达式可得：\n$$ k_{\\mathrm{eff}}^{\\mathrm{micro}} = -\\frac{u_0(1 - \\langle k \\rangle dt) - u_0}{dt \\cdot u_0} = \\langle k \\rangle $$\n因此，推断出的微尺度反应速率就是微观反应速率系数的数值空间平均值，$\\langle k \\rangle_{\\mathrm{num}}$。\n\n### 步骤3：模型不匹配度的计算\n\n不匹配度计算为数值推断的微尺度参数与理论推导的均质化参数之间的相对误差。\n$$ \\text{mismatch}_D = \\left|\\frac{D_{\\mathrm{eff}}^{\\mathrm{micro}} - D_{\\mathrm{eff}}^{\\mathrm{hom}}}{D_{\\mathrm{eff}}^{\\mathrm{hom}}}\\right|,\\quad \\text{mismatch}_k = \\left|\\frac{k_{\\mathrm{eff}}^{\\mathrm{micro}} - k_{\\mathrm{eff}}^{\\mathrm{hom}}}{k_{\\mathrm{eff}}^{\\mathrm{hom}}}\\right| $$\n这些量衡量了数值模拟与第一性原理均质化理论的一致性。对于一维情况，这些不匹配度预计会非常小，主要反映浮点数的不精确性和表示体积分数 $f$ 时的任何微小离散化误差。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    test_cases = [\n        # Case 1: General heterogeneous case\n        {'L': 100.0, 'l_cell': 5.0, 'f': 0.3, 'D1': 100.0, 'D2': 10.0, 'k1': 0.05, 'k2': 0.01},\n        # Case 2: Extreme diffusion contrast and localized reaction\n        {'L': 96.0, 'l_cell': 6.0, 'f': 0.5, 'D1': 1000.0, 'D2': 1.0, 'k1': 0.00, 'k2': 0.10},\n        # Case 3: Homogeneous limit for verification\n        {'L': 120.0, 'l_cell': 4.0, 'f': 0.4, 'D1': 50.0, 'D2': 50.0, 'k1': 0.02, 'k2': 0.02},\n    ]\n\n    results = []\n    for case in test_cases:\n        mismatch_D, mismatch_k = calculate_mismatches(**case)\n        results.extend([mismatch_D, mismatch_k])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_mismatches(L, l_cell, f, D1, D2, k1, k2):\n    \"\"\"\n    Performs microscale simulations to infer effective parameters and compares\n    them to analytically derived homogenized parameters.\n\n    Args:\n        L (float): Total length of the domain [micrometers].\n        l_cell (float): Length of a single micro-period [micrometers].\n        f (float): Volume fraction of phase 1 [dimensionless].\n        D1, D2 (float): Diffusion coefficients of phase 1 and 2 [micrometer^2/s].\n        k1, k2 (float): Reaction rates of phase 1 and 2 [1/s].\n\n    Returns:\n        tuple[float, float]: The relative mismatches for D and k.\n    \"\"\"\n    # 1. Derive homogenized-model parameters from first principles\n    # Effective diffusion coefficient is the harmonic mean for a 1D layered medium.\n    if D1 == 0 or D2 == 0:\n        if f > 0 and f  1:\n            D_eff_hom = 0.0\n        elif f == 0:\n            D_eff_hom = D2\n        else: # f == 1\n            D_eff_hom = D1\n    else:\n        D_eff_hom = (f / D1 + (1 - f) / D2)**-1\n\n    # Effective reaction rate is the volume-weighted arithmetic mean.\n    k_eff_hom = f * k1 + (1 - f) * k2\n\n    # 2. Setup numerical simulation parameters\n    N_cell_per_period = 100  # Discretization resolution per micro-period\n    N_periods = int(round(L / l_cell))\n    N_cells = N_periods * N_cell_per_period\n    h = L / N_cells\n    n_phase1_cells = int(round(f * N_cell_per_period))\n    \n    # 3. Microscale experiment to infer D_eff_micro\n    D_cell = np.zeros(N_cells)\n    for i in range(N_cells):\n        cell_in_period = i % N_cell_per_period\n        D_cell[i] = D1 if cell_in_period  n_phase1_cells else D2\n            \n    # Solve the steady-state diffusion problem: d/dx(D du/dx) = 0\n    # Boundary conditions: u(0)=0, u(L)=1. This creates a tridiagonal system.\n    num_unknowns = N_cells - 1\n    if num_unknowns > 0 :\n        ab = np.zeros((3, num_unknowns))\n        b = np.zeros(num_unknowns)\n        \n        # Assemble the tridiagonal matrix\n        # For unknown u_j (j=1..N-1), matrix row is j-1\n        # D_{j-1}*u_{j-1} - (D_{j-1}+D_j)*u_j + D_j*u_{j+1} = 0\n        main_diag = -(D_cell[:-1] + D_cell[1:])\n        upper_diag = D_cell[1:-1]\n        lower_diag = D_cell[1:-1]\n        \n        ab[0, 1:] = upper_diag\n        ab[1, :] = main_diag\n        ab[2, :-1] = lower_diag\n        \n        # Assemble the right-hand side vector\n        delta_u = 1.0\n        b[-1] = -D_cell[-1] * delta_u\n        \n        # Solve for interior concentrations\n        u_interior = solve_banded((1, 1), ab, b)\n        u = np.concatenate(([0.0], u_interior, [delta_u]))\n        \n        # Infer D_eff_micro from the resulting flux\n        # J = -D_eff * (u(L)-u(0))/L = -D_eff * delta_u/L\n        # J is constant, can be computed from the first cell: J = -D_0 * (u_1-u_0)/h\n        flux = -D_cell[0] * (u[1] - u[0]) / h\n        D_eff_micro = -flux * L / delta_u\n    else: # Domain has only one cell\n        flux = -D_cell[0] * (1.0 - 0.0) / L\n        D_eff_micro = -flux * L / 1.0\n\n    # 4. Microscale experiment to infer k_eff_micro\n    k_cell = np.zeros(N_cells)\n    for i in range(N_cells):\n        cell_in_period = i % N_cell_per_period\n        k_cell[i] = k1 if cell_in_period  n_phase1_cells else k2\n            \n    # As derived, k_eff_micro is the spatial average of the microscale k values\n    k_eff_micro = np.mean(k_cell)\n\n    # 5. Compute and return mismatches\n    if D_eff_hom == 0:\n        mismatch_D = 0.0 if D_eff_micro == 0.0 else float('inf')\n    else:\n        mismatch_D = abs((D_eff_micro - D_eff_hom) / D_eff_hom)\n\n    if k_eff_hom == 0:\n        mismatch_k = 0.0 if k_eff_micro == 0.0 else float('inf')\n    else:\n        mismatch_k = abs((k_eff_micro - k_eff_hom) / k_eff_hom)\n        \n    return mismatch_D, mismatch_k\n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}