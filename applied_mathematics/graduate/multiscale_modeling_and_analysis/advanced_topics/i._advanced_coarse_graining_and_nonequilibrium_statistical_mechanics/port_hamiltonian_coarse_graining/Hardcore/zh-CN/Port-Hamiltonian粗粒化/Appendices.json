{
    "hands_on_practices": [
        {
            "introduction": "动手实践的第一步是理解如何通过代数方法简化系统。此练习将状态变量分为“慢”和“快”两部分，并探讨一种基于“协能变量”（co-energy variables）和特定闭合假设的降阶方法。通过这个实践，您将推导出粗化模型的有效能量度量，并理解它如何通过舒尔补（Schur complement）的形式，体现被消除的快速动态对慢速系统的影响。",
            "id": "3796750",
            "problem": "考虑一个有限维线性哈密顿端口 (pH) 系统，其状态为 $x \\in \\mathbb{R}^{n}$，互联矩阵为 $J \\in \\mathbb{R}^{n \\times n}$，电阻矩阵为 $R \\in \\mathbb{R}^{n \\times n}$，输入矩阵为 $B \\in \\mathbb{R}^{n \\times m}$。哈密顿量是二次的，由 $H(x)=\\frac{1}{2}x^{\\top}Qx$ 给出，其中 $Q \\in \\mathbb{R}^{n \\times n}$ 是对称正定矩阵 ($Q \\succ 0$)。该 pH 系统根据以下方程演化：\n$$\n\\dot{x}=(J-R)\\nabla H(x) + Bu, \\quad y = B^{\\top}\\nabla H(x),\n$$\n其中 $u \\in \\mathbb{R}^{m}$ 是输入，$y \\in \\mathbb{R}^{m}$ 是输出。假设 $J=-J^{\\top}$ 且 $R=R^{\\top} \\succeq 0$。\n\n(a) 部分：从给定的哈密顿量出发，计算余能变量 $e := \\nabla H(x)$，并将动力学方程重写为余能形式。解释为什么这种表示形式能够得到 $e$ 和 $x$ 之间的线性本构关系。\n\n(b) 部分：考虑将状态 $x$ 进行多尺度划分为慢变量和快变量，$x=\\begin{pmatrix}x_{r} \\\\ x_{f}\\end{pmatrix}$，能量度量也相应地进行分块：\n$$\nQ = \\begin{pmatrix} Q_{rr} & Q_{rf} \\\\ Q_{fr} & Q_{ff} \\end{pmatrix},\n$$\n其中每个分块具有相容的维度，且 $Q_{ff} \\succ 0$。定义余能划分为 $e=\\begin{pmatrix} e_{r} \\\\ e_{f}\\end{pmatrix}$，满足：\n$$\ne_{r} = Q_{rr}x_{r} + Q_{rf}x_{f}, \\quad e_{f} = Q_{fr}x_{r} + Q_{ff}x_{f}.\n$$\n在通过在慢流形上施加 $e_{f}=0$ 来消除快变量的粗粒化闭合下，推导粗粒化余能映射 $e_{r} = Q_{\\mathrm{cg}} x_{r}$ 的闭式表达式，该表达式应以 $Q$ 的分块形式表示。\n\n你的最终答案必须是 $Q_{\\mathrm{cg}}$ 的一个单一闭式解析表达式。不需要数值近似，也不涉及单位。请用符号化的分块矩阵形式表示最终的 $Q_{\\mathrm{cg}}$。",
            "solution": "首先验证该问题以确保其具有科学依据、是适定的和客观的。\n\n### 步骤 1：提取已知条件\n-   系统：有限维线性哈密顿端口 (pH)。\n-   状态：$x \\in \\mathbb{R}^{n}$。\n-   矩阵：$J \\in \\mathbb{R}^{n \\times n}$ (互联)，$R \\in \\mathbb{R}^{n \\times n}$ (电阻)，$B \\in \\mathbb{R}^{n \\times m}$ (输入)。\n-   矩阵性质：$J=-J^{\\top}$ (斜对称)，$R=R^{\\top} \\succeq 0$ (对称半正定)。\n-   哈密顿量：$H(x)=\\frac{1}{2}x^{\\top}Qx$。\n-   能量度量：$Q \\in \\mathbb{R}^{n \\times n}$，对称正定 ($Q=Q^{\\top} \\succ 0$)。\n-   动力学方程：$\\dot{x}=(J-R)\\nabla H(x) + Bu$。\n-   输出：$y = B^{\\top}\\nabla H(x)$。\n-   余能变量定义：$e := \\nabla H(x)$。\n-   状态划分：$x=\\begin{pmatrix}x_{r} \\\\ x_{f}\\end{pmatrix}$。\n-   能量度量划分：$Q = \\begin{pmatrix} Q_{rr} & Q_{rf} \\\\ Q_{fr} & Q_{ff} \\end{pmatrix}$，其中 $Q_{ff} \\succ 0$。\n-   余能划分关系：$e_{r} = Q_{rr}x_{r} + Q_{rf}x_{f}$ 和 $e_{f} = Q_{fr}x_{r} + Q_{ff}x_{f}$。\n-   粗粒化闭合：$e_{f}=0$。\n-   目标：推导粗粒化余能映射 $e_{r} = Q_{\\mathrm{cg}} x_{r}$ 并求出 $Q_{\\mathrm{cg}}$ 的表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题根植于哈密顿端口系统和模型降阶技术的标准数学框架，这些是控制理论和多尺度分析中的成熟课题。所提供的定义、方程和矩阵性质 ($J=-J^{\\top}$，$R \\succeq 0$，$Q \\succ 0$) 对于此类系统是标准的。通过闭合条件 ($e_f=0$) 进行的粗粒化过程是一种定义明确的技术。条件 $Q_{ff} \\succ 0$ 被明确给出，这确保了所需的分块矩阵是可逆的，从而使问题是适定的。该问题是自洽的、无歧义的、科学上合理的，并且是可形式化的。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答\n\n**(a) 部分：余能表示**\n\n系统的哈密顿量由二次函数给出\n$$H(x) = \\frac{1}{2}x^{\\top}Qx$$\n其中 $Q$ 是一个对称正定矩阵。余能变量 $e$ 定义为哈密顿量相对于状态向量 $x$ 的梯度：\n$$e := \\nabla H(x) = \\nabla_{x} \\left(\\frac{1}{2}x^{\\top}Qx\\right)$$\n使用对称矩阵 $Q$ 的标准矩阵微积分，梯度为\n$$e = Qx$$\n该方程表示能量变量 (或流) $x$ 和余能变量 (或功) $e$ 之间的本构关系。由于 $Q$ 是一个常数矩阵，这种关系是线性的。\n由于 $Q \\succ 0$，它是可逆的，我们也可以用余能来表示状态：$x=Q^{-1}e$。\n\n为了将动力学方程重写为余能表示，我们首先将 $e=\\nabla H(x)$ 代入状态动力学方程：\n$$\\dot{x}=(J-R)e + Bu$$\n接下来，我们对本构关系 $e=Qx$ 关于时间求导，注意到 $Q$ 是一个常数矩阵：\n$$\\dot{e} = \\frac{d}{dt}(Qx) = Q\\dot{x}$$\n将 $\\dot{x}$ 的表达式代入此方程，得到用余能变量 $e$ 表示的动力学方程：\n$$\\dot{e} = Q((J-R)e + Bu) = Q(J-R)e + QBu$$\n这是哈密顿端口系统动力学方程的余能形式。$e$ 和 $x$ 之间的本构关系是线性的，因为它们由矩阵方程 $e=Qx$ 描述，这是一个线性变换。\n\n**(b) 部分：$Q_{\\mathrm{cg}}$ 的粗粒化和推导**\n\n系统的本构关系 $e=Qx$ 根据状态向量 $x$ 的慢 ($r$) 分量和快 ($f$) 分量进行划分。使用 $Q$ 的分块矩阵形式，我们有：\n$$\n\\begin{pmatrix} e_{r} \\\\ e_{f} \\end{pmatrix} = \\begin{pmatrix} Q_{rr} & Q_{rf} \\\\ Q_{fr} & Q_{ff} \\end{pmatrix} \\begin{pmatrix} x_{r} \\\\ x_{f} \\end{pmatrix}\n$$\n这个矩阵方程可以展开为两个分块方程：\n$$\ne_{r} = Q_{rr}x_{r} + Q_{rf}x_{f} \\quad (1)\n$$\n$$\ne_{f} = Q_{fr}x_{r} + Q_{ff}x_{f} \\quad (2)\n$$\n粗粒化过程涉及通过施加一个闭合条件来消除快变量。指定的闭合条件是 $e_{f}=0$。这意味着系统被约束在一个“慢流形”上，在该流形上，与快状态分量相关的余能为零。将此条件应用于方程 (2)：\n$$\n0 = Q_{fr}x_{r} + Q_{ff}x_{f}\n$$\n我们现在可以用慢状态 $x_{r}$ 来求解快状态 $x_{f}$。整理该方程得到：\n$$\nQ_{ff}x_{f} = -Q_{fr}x_{r}\n$$\n问题陈述了 $Q_{ff} \\succ 0$，这保证了 $Q_{ff}$ 是可逆的。因此，我们可以左乘 $Q_{ff}^{-1}$ 来分离出 $x_{f}$：\n$$\nx_{f} = -Q_{ff}^{-1}Q_{fr}x_{r}\n$$\n这个方程表明，在慢流形上，快状态 $x_{f}$ 在代数上“附属于”慢状态 $x_{r}$。\n\n最后一步是推导慢余能 $e_{r}$ 和慢状态 $x_{r}$ 之间的有效（或粗粒化）本构关系。这可以通过将 $x_{f}$ 的表达式代入方程 (1) 来实现：\n$$\ne_{r} = Q_{rr}x_{r} + Q_{rf} \\left( -Q_{ff}^{-1}Q_{fr}x_{r} \\right)\n$$\n提取右侧的公因子 $x_{r}$，我们得到：\n$$\ne_{r} = \\left( Q_{rr} - Q_{rf}Q_{ff}^{-1}Q_{fr} \\right) x_{r}\n$$\n这个方程具有所需的形式 $e_{r} = Q_{\\mathrm{cg}} x_{r}$，其中 $Q_{\\mathrm{cg}}$ 是粗粒化能量度量。通过比较，我们确定 $Q_{\\mathrm{cg}}$ 的表达式为：\n$$\nQ_{\\mathrm{cg}} = Q_{rr} - Q_{rf}Q_{ff}^{-1}Q_{fr}\n$$\n该矩阵是矩阵 $Q$ 中分块 $Q_{ff}$ 的舒尔补。它代表了描述慢动力学的降阶模型的有效能量度量。",
            "answer": "$$\\boxed{Q_{rr} - Q_{rf}Q_{ff}^{-1}Q_{fr}}$$"
        },
        {
            "introduction": "在掌握了基本的代数降阶后，我们转向更通用的Petrov-Galerkin投影法，并关注其结构保持特性。一个有效的降阶模型必须保持原系统的端口-哈密顿结构，特别是互联矩阵的反对称性和耗散矩阵的半正定性。此练习提供了一个具体的计算任务，要求您寻找特定的投影参数，以确保降阶后的系统满足这些关键的结构约束。",
            "id": "3796797",
            "problem": "考虑一个形式为 $ \\dot{x} = (J - R) Q x $ 的线性端口哈密顿 (pH) 系统，其状态 $ x \\in \\mathbb{R}^{3} $，其中 $ J \\in \\mathbb{R}^{3 \\times 3} $ 是斜对称矩阵，$ R \\in \\mathbb{R}^{3 \\times 3} $ 是对称半正定矩阵，而 $ Q \\in \\mathbb{R}^{3 \\times 3} $ 是对称正定矩阵。系统矩阵为\n$$\nJ = \\begin{pmatrix}\n0  & 1 & 0 \\\\\n-1 & 0 & 2 \\\\\n0  & -2 & 0\n\\end{pmatrix}, \\quad\nR = \\begin{pmatrix}\n1 & 0 & 0 \\\\\n0 & 0 & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix}, \\quad\nQ = \\begin{pmatrix}\n2 & 0 & 0 \\\\\n0 & 3 & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix}.\n$$\n我们寻求一个秩为2的 Petrov-Galerkin (PG) 粗粒化降维，其试验基 $ V(\\theta) \\in \\mathbb{R}^{3 \\times 2} $ 和测试基 $ W(\\theta) \\in \\mathbb{R}^{3 \\times 2} $ 定义为\n$$\nV(\\theta) = \\begin{pmatrix}\n\\cos\\theta & 0 \\\\\n\\sin\\theta & 0 \\\\\n0 & 1\n\\end{pmatrix}, \\quad W(\\theta) = Q V(\\theta),\n$$\n其中 $ \\theta \\in [0, \\pi) $ 是一个角度参数。降维后的互联矩阵和耗散矩阵由 $ J_{r}(\\theta) = W(\\theta)^{\\top} J V(\\theta) $ 和 $ R_{r}(\\theta) = W(\\theta)^{\\top} R V(\\theta) $ 给出。从端口哈密顿系统的定义性质（$ J $ 的斜对称性和 $ R $ 的半正定性）以及使用 $ W(\\theta) = Q V(\\theta) $ 的 Petrov-Galerkin 构造出发，确定使 $ J_{r}(\\theta) $ 为斜对称且 $ R_{r}(\\theta) $ 为对称半正定的 $ \\theta $ 的值。请用弧度表示您的最终答案 $ \\theta $，并给出精确值。",
            "solution": "该问题要求解参数 $ \\theta \\in [0, \\pi) $ 的值，使得一个特定的 Petrov-Galerkin 投影能够保持给定线性系统的端口哈密顿结构。一个端口哈密顿系统的特征是其互联矩阵 $ J_r $ 是斜对称的，且其耗散矩阵 $ R_r $ 是对称半正定的。我们将分别分析这两个条件。\n\n全阶系统由 $ \\dot{x} = (J - R) Q x $ 描述，其中矩阵 $ J, R, Q $ 已给出。粗粒化模型是通过使用试验基 $ V(\\theta) $ 和测试基 $ W(\\theta) $ 的 Petrov-Galerkin 投影得到的。降维后的矩阵由以下公式给出：\n$$ J_{r}(\\theta) = W(\\theta)^{\\top} J V(\\theta) $$\n$$ R_{r}(\\theta) = W(\\theta)^{\\top} R V(\\theta) $$\n问题指定测试基为 $ W(\\theta) = Q V(\\theta) $。将此代入降维矩阵的表达式中，得到：\n$$ J_{r}(\\theta) = (Q V(\\theta))^{\\top} J V(\\theta) = V(\\theta)^{\\top} Q^{\\top} J V(\\theta) $$\n$$ R_{r}(\\theta) = (Q V(\\theta))^{\\top} R V(\\theta) = V(\\theta)^{\\top} Q^{\\top} R V(\\theta) $$\n矩阵 $ Q $ 已知为对称矩阵，所以 $ Q^{\\top} = Q $。表达式简化为：\n$$ J_{r}(\\theta) = V(\\theta)^{\\top} Q J V(\\theta) $$\n$$ R_{r}(\\theta) = V(\\theta)^{\\top} Q R V(\\theta) $$\n我们必须找到使 $ J_r(\\theta) $ 为斜对称且 $ R_r(\\theta) $ 为对称半正定的 $ \\theta $ 的值。\n\n首先，我们分析关于 $ R_r(\\theta) $ 的条件。\n为使 $ R_r(\\theta) $ 是对称半正定的，它必须首先是对称的，即 $ R_r(\\theta)^{\\top} = R_r(\\theta) $。\n$$ R_r(\\theta)^{\\top} = \\left( V(\\theta)^{\\top} Q R V(\\theta) \\right)^{\\top} = V(\\theta)^{\\top} R^{\\top} Q^{\\top} V(\\theta) $$\n由于 $ R $ 和 $ Q $ 都已给出为对称矩阵 ($ R^{\\top} = R $，$ Q^{\\top} = Q $)，我们有：\n$$ R_r(\\theta)^{\\top} = V(\\theta)^{\\top} R Q V(\\theta) $$\n要使 $ R_r(\\theta) $ 对称，我们需要 $ V(\\theta)^{\\top} Q R V(\\theta) = V(\\theta)^{\\top} R Q V(\\theta) $，如果矩阵 $ Q $ 和 $ R $ 可交换，即 $ QR = RQ $，则此条件成立。让我们用给定的矩阵验证这个条件：\n$$ Q R = \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 3 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} = \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} $$\n$$ R Q = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 3 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} = \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 0 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} $$\n因为 $ QR = RQ $，所以对于任意选择的 $ V(\\theta) $，矩阵 $ R_r(\\theta) $ 都是对称的，因此对任意 $ \\theta $ 都成立。\n\n接下来，我们检查半正定性。对于任意向量 $ z \\in \\mathbb{R}^2 $，我们必须有 $ z^{\\top} R_r(\\theta) z \\ge 0 $。\n$$ z^{\\top} R_r(\\theta) z = z^{\\top} \\left( V(\\theta)^{\\top} Q R V(\\theta) \\right) z = (V(\\theta)z)^{\\top} (QR) (V(\\theta)z) $$\n令 $ y = V(\\theta)z \\in \\mathbb{R}^3 $。该表达式变为 $ y^{\\top} (QR) y $。矩阵 $ QR $ 是对称的，其特征值是其对角线元素，即 $ 2 $、$ 0 $ 和 $ 1 $。由于所有特征值都是非负的，矩阵 $ QR $ 是半正定的。这意味着对于所有 $ y \\in \\mathbb{R}^3 $，都有 $ y^{\\top} (QR) y \\ge 0 $。因此，对于所有 $ z \\in \\mathbb{R}^2 $，都有 $ z^{\\top} R_r(\\theta) z \\ge 0 $。\n所以，降维后的耗散矩阵 $ R_r(\\theta) $ 对所有 $ \\theta \\in [0, \\pi) $ 的值都是对称半正定的。这个条件对 $ \\theta $ 没有施加任何约束。\n\n现在，我们来分析关于 $ J_r(\\theta) $ 的条件。\n为使 $ J_r(\\theta) $ 为斜对称，必须满足 $ J_r(\\theta)^{\\top} = -J_r(\\theta) $。\n$$ J_r(\\theta)^{\\top} = \\left( V(\\theta)^{\\top} Q J V(\\theta) \\right)^{\\top} = V(\\theta)^{\\top} J^{\\top} Q^{\\top} V(\\theta) $$\n矩阵 $ J $ 是斜对称的 ($ J^{\\top} = -J $)，且 $ Q $ 是对称的 ($ Q^{\\top} = Q $)。代入这些性质可得：\n$$ J_r(\\theta)^{\\top} = V(\\theta)^{\\top} (-J) Q V(\\theta) = -V(\\theta)^{\\top} J Q V(\\theta) $$\n斜对称条件 $ J_r(\\theta)^{\\top} = -J_r(\\theta) $ 变为：\n$$ -V(\\theta)^{\\top} J Q V(\\theta) = - \\left( V(\\theta)^{\\top} Q J V(\\theta) \\right) $$\n这可以简化为 $ V(\\theta)^{\\top} J Q V(\\theta) = V(\\theta)^{\\top} Q J V(\\theta) $，可以写成：\n$$ V(\\theta)^{\\top} (Q J - J Q) V(\\theta) = \\mathbf{0}_{2 \\times 2} $$\n其中 $ \\mathbf{0}_{2 \\times 2} $ 是 $ 2 \\times 2 $ 的零矩阵。我们来计算对易矩阵 $ S = QJ - JQ $。\n$$ Q J = \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 3 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 0 & 1 & 0 \\\\ -1 & 0 & 2 \\\\ 0 & -2 & 0 \\end{pmatrix} = \\begin{pmatrix} 0 & 2 & 0 \\\\ -3 & 0 & 6 \\\\ 0 & -2 & 0 \\end{pmatrix} $$\n$$ J Q = \\begin{pmatrix} 0 & 1 & 0 \\\\ -1 & 0 & 2 \\\\ 0 & -2 & 0 \\end{pmatrix} \\begin{pmatrix} 2 & 0 & 0 \\\\ 0 & 3 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} = \\begin{pmatrix} 0 & 3 & 0 \\\\ -2 & 0 & 2 \\\\ 0 & -6 & 0 \\end{pmatrix} $$\n$$ S = Q J - J Q = \\begin{pmatrix} 0 & -1 & 0 \\\\ -1 & 0 & 4 \\\\ 0 & 4 & 0 \\end{pmatrix} $$\n现在我们使用 $ V(\\theta) = \\begin{pmatrix} \\cos\\theta & 0 \\\\ \\sin\\theta & 0 \\\\ 0 & 1 \\end{pmatrix} $ 来计算表达式 $ V(\\theta)^{\\top} S V(\\theta) $。\n$$ V(\\theta)^{\\top} S = \\begin{pmatrix} \\cos\\theta & \\sin\\theta & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 0 & -1 & 0 \\\\ -1 & 0 & 4 \\\\ 0 & 4 & 0 \\end{pmatrix} = \\begin{pmatrix} -\\sin\\theta & -\\cos\\theta & 4\\sin\\theta \\\\ 0 & 4 & 0 \\end{pmatrix} $$\n$$ V(\\theta)^{\\top} S V(\\theta) = \\begin{pmatrix} -\\sin\\theta & -\\cos\\theta & 4\\sin\\theta \\\\ 0 & 4 & 0 \\end{pmatrix} \\begin{pmatrix} \\cos\\theta & 0 \\\\ \\sin\\theta & 0 \\\\ 0 & 1 \\end{pmatrix} $$\n$$ V(\\theta)^{\\top} S V(\\theta) = \\begin{pmatrix} -\\sin\\theta\\cos\\theta - \\cos\\theta\\sin\\theta & 4\\sin\\theta \\\\ 4\\sin\\theta & 0 \\end{pmatrix} = \\begin{pmatrix} -2\\sin\\theta\\cos\\theta & 4\\sin\\theta \\\\ 4\\sin\\theta & 0 \\end{pmatrix} $$\n使用二倍角恒等式 $ \\sin(2\\theta) = 2\\sin\\theta\\cos\\theta $，我们得到：\n$$ V(\\theta)^{\\top} S V(\\theta) = \\begin{pmatrix} -\\sin(2\\theta) & 4\\sin\\theta \\\\ 4\\sin\\theta & 0 \\end{pmatrix} $$\n为了使 $ J_r(\\theta) $ 是斜对称的，这个矩阵必须是零矩阵：\n$$ \\begin{pmatrix} -\\sin(2\\theta) & 4\\sin\\theta \\\\ 4\\sin\\theta & 0 \\end{pmatrix} = \\begin{pmatrix} 0 & 0 \\\\ 0 & 0 \\end{pmatrix} $$\n这给出了一个由两个方程组成的方程组：\n1. $ 4\\sin\\theta = 0 $\n2. $ -\\sin(2\\theta) = 0 $\n\n从第一个方程 $ \\sin\\theta = 0 $ 可得。问题指定了角度的定义域为 $ \\theta \\in [0, \\pi) $。在此区间内，使 $ \\sin\\theta = 0 $ 的唯一 $ \\theta $ 值是 $ \\theta = 0 $。\n我们必须验证这个值也满足第二个方程。对于 $ \\theta = 0 $：\n$$ -\\sin(2 \\cdot 0) = -\\sin(0) = 0 $$\n第二个方程也满足。因此，在给定范围内，能确保 $ J_r(\\theta) $ 斜对称性的唯一 $ \\theta $ 值是 $ \\theta = 0 $。\n总而言之，$ R_r(\\theta) $ 的条件对所有 $ \\theta $ 都满足，而 $ J_r(\\theta) $ 的条件仅对 $ \\theta = 0 $ 满足。因此，所求的值是 $ \\theta = 0 $。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "本章的最终实践将理论与计算应用相结合。您将为一个具体的物理系统——一个多质量弹簧链——构建并实现一个完整的粗化模型。此练习涵盖了从物理建模、应用Galerkin投影（Petrov-Galerkin方法的一个特例）到使用保结构数值积分（辛积分器）进行仿真的完整流程。通过比较精细模型与粗化模型的能量轨迹，您将学会如何评估降阶模型的质量，从而将理论知识转化为实际的工程能力。",
            "id": "3796828",
            "problem": "考虑一个由 $N$ 个质点组成的一维链，这些质点通过线性弹簧连接，两端的质点各自通过一个额外的线性弹簧接地。设质量向量为 $m \\in \\mathbb{R}^N_{>0}$，相邻质量间的内部弹簧刚度为 $k \\in \\mathbb{R}^{N-1}_{>0}$，连接到地的末端弹簧刚度为 $k_{\\mathrm{L}} \\in \\mathbb{R}_{>0}$ 和 $k_{\\mathrm{R}} \\in \\mathbb{R}_{>0}$。用 $q \\in \\mathbb{R}^N$ 表示广义坐标（位置，单位为米），用 $p \\in \\mathbb{R}^N$ 表示广义动量（单位为千克·米/秒）。总哈密顿量由下式给出\n$$\nH(q,p) = \\frac{1}{2} q^\\top K q + \\frac{1}{2} p^\\top M^{-1} p,\n$$\n其中 $M = \\mathrm{diag}(m_1,\\dots,m_N)$ 是质量矩阵，$K \\in \\mathbb{R}^{N \\times N}$ 是由弹簧网络组装而成的刚度矩阵。典范端口-哈密顿表示使用结构矩阵\n$$\nJ = \\begin{bmatrix} 0 & I_N \\\\ -I_N & 0 \\end{bmatrix},\n$$\n和哈密顿梯度（策动力）$e = \\nabla H = \\begin{bmatrix} K q \\\\ M^{-1} p \\end{bmatrix}$。忽略任何耗散和外部端口，动力学方程为\n$$\n\\dot{x} = J \\nabla H(x), \\quad x = \\begin{bmatrix} q \\\\ p \\end{bmatrix},\n$$\n这等价于以下方程组\n$$\n\\dot{q} = M^{-1} p, \\quad \\dot{p} = - K q.\n$$\n你需要通过聚合相邻的自由度来构建一个粗粒化端口-哈密顿模型。设 $N$ 为偶数，定义一个聚合矩阵 $V \\in \\mathbb{R}^{N \\times r}$，其中 $r = N/2$，其第 $j$ 列在位置 $2j-1$ 和 $2j$ 处的元素为 $\\frac{1}{\\sqrt{2}}$，其他位置为零。这个矩阵 $V$ 的列是标准正交的，即 $V^\\top V = I_r$。定义降维坐标为\n$$\nQ = V^\\top q, \\quad P = V^\\top p.\n$$\n证明降维系统保持典范端口-哈密顿结构，其降维哈密顿量为\n$$\nH_r(Q,P) = \\frac{1}{2} Q^\\top K_r Q + \\frac{1}{2} P^\\top M_r^{-1} P,\n$$\n其中 $K_r = V^\\top K V$ 且 $M_r^{-1} = V^\\top M^{-1} V$，降维动力学方程为\n$$\n\\dot{Q} = M_r^{-1} P, \\quad \\dot{P} = -K_r Q,\n$$\n对应于 $J_r = \\begin{bmatrix} 0 & I_r \\\\ -I_r & 0 \\end{bmatrix}$ 和策动力 $e_r = \\nabla H_r(Q,P)$。\n\n实现一个辛时间积分器，使用相同的时间步长在给定的时间范围内推进精细尺度系统和粗糙尺度系统。对精细系统使用以下二阶 Störmer–Verlet（也称为蛙跳法）更新：\n$$\np_{n+\\frac{1}{2}} = p_n - \\frac{\\Delta t}{2} K q_n, \\quad\nq_{n+1} = q_n + \\Delta t M^{-1} p_{n+\\frac{1}{2}}, \\quad\np_{n+1} = p_{n+\\frac{1}{2}} - \\frac{\\Delta t}{2} K q_{n+1}.\n$$\n对粗糙系统使用类似的更新，将 $q,p,K,M^{-1}$ 替换为 $Q,P,K_r,M_r^{-1}$。对于两个系统，在每个时间步 $t_n = n \\Delta t$, $n=0,\\dots,N_{\\mathrm{steps}}$ 计算能量轨迹 $H(t_n)$ 和 $H_r(t_n)$。\n\n在整个仿真过程中，使用以下度量标准比较精细和粗糙的能量轨迹：\n- 粗糙能量相对于精细能量的相对 $\\ell^2$ 误差\n$$\n\\varepsilon_{\\mathrm{rel}} = \\sqrt{\\frac{\\sum_{n=0}^{N_{\\mathrm{steps}}} \\left(H_r(t_n) - H(t_n)\\right)^2}{\\sum_{n=0}^{N_{\\mathrm{steps}}} H(t_n)^2}}.\n$$\n- 能量的最大绝对偏差（单位：焦耳）\n$$\n\\Delta_{\\max} = \\max_{0 \\leq n \\leq N_{\\mathrm{steps}}} \\left| H_r(t_n) - H(t_n) \\right|.\n$$\n\n使用物理一致性来组装刚度矩阵 $K$：对于连接质量 $i$ 和 $i+1$ 的每个内部弹簧 $i=1,\\dots,N-1$（刚度为 $k_i$），加上\n$$\nK_{ii} \\mathrel{+}= k_i, \\quad K_{i+1,i+1} \\mathrel{+}= k_i, \\quad K_{i,i+1} \\mathrel{-}= k_i, \\quad K_{i+1,i} \\mathrel{-}= k_i,\n$$\n对于连接到地的左右末端弹簧（刚度为 $k_{\\mathrm{L}}$ 和 $k_{\\mathrm{R}}$），加上\n$$\nK_{11} \\mathrel{+}= k_{\\mathrm{L}}, \\quad K_{NN} \\mathrel{+}= k_{\\mathrm{R}}.\n$$\n\n使用以下测试套件。对于每个测试用例，使用时间步长 $\\Delta t$ 模拟到时间 $T$。所有物理单位必须一致：质量单位为千克，刚度单位为牛顿/米，位置单位为米，动量单位为千克·米/秒，时间单位为秒，能量单位为焦耳。初始条件必须严格按照规定设置。\n\n测试用例1（正常路径）：\n- $N = 8$, $m = [1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]$, $k = [100.0,100.0,100.0,100.0,100.0,100.0,100.0]$, $k_{\\mathrm{L}} = 50.0$, $k_{\\mathrm{R}} = 50.0$.\n- $\\Delta t = 0.001$, $T = 1.0$.\n- $q_i(0) = A \\sin\\left(\\frac{\\pi i}{N+1}\\right)$，其中 $A = 0.01$，对于 $i=1,\\dots,N$；$v(0) = 0$，因此 $p(0) = M v(0) = 0$。\n\n测试用例2（边界变化与非均匀性）：\n- $N = 4$, $m = [0.5,2.0,0.5,2.0]$, $k = [150.0,80.0,150.0]$, $k_{\\mathrm{L}} = 100.0$, $k_{\\mathrm{R}} = 120.0$.\n- $\\Delta t = 0.001$, $T = 0.5$.\n- $q(0) = A [1,-1,1,-1]^\\top$，其中 $A = 0.02$；$v(0) = [0.0,0.1,-0.1,0.0]^\\top$，因此 $p(0) = M v(0)$。\n\n测试用例3（交替参数的边缘情况）：\n- $N = 6$, $m = [1.2,0.9,1.1,0.8,1.3,1.0]$, $k = [200.0,90.0,130.0,160.0,120.0]$, $k_{\\mathrm{L}} = 180.0$, $k_{\\mathrm{R}} = 140.0$.\n- $\\Delta t = 0.0008$, $T = 0.8$.\n- $q(0) = A [1.0,0.5,-0.4,0.2,-0.1,0.0]^\\top$，其中 $A = 0.015$；$v(0) = [0.05,-0.02,0.03,-0.01,0.0,0.02]^\\top$，因此 $p(0) = M v(0)$。\n\n你的程序必须为每个测试用例计算 $\\varepsilon_{\\mathrm{rel}}$ 和 $\\Delta_{\\max}$，并生成一行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身也是一个由方括号括起来的包含两个浮点数的逗号分隔列表，顺序为测试用例1、测试用例2、测试用例3。例如，输出格式必须严格符合\n$$\n\\text{[[$\\varepsilon_{\\mathrm{rel},1}$,$\\Delta_{\\max,1}$],[$\\varepsilon_{\\mathrm{rel},2}$,$\\Delta_{\\max,2}$],[$\\varepsilon_{\\mathrm{rel},3}$,$\\Delta_{\\max,3}$]]}\n$$\n的形式，用实际数值代替符号。不应打印任何其他文本。",
            "solution": "该问题陈述经评估具有科学依据、提法恰当、客观且完整。它提供了构建一个唯一、可验证的解决方案所需的所有数据、定义和约束。弹簧-质量链的物理模型、其作为端口-哈密顿系统的表示、所提出的粗粒化技术以及指定的数值积分器，在它们各自的领域都是标准且成熟的。因此，该问题是有效的，并将提供一个解决方案。\n\n问题的核心在于证明一个特定的粗粒化过程保留了线性力学系统的典范端口-哈密顿结构，然后数值比较全阶模型与降阶模型的动力学。\n\n**1. 端口-哈密顿结构的保持**\n\n精细尺度系统的状态由向量 $x = [q^\\top, p^\\top]^\\top \\in \\mathbb{R}^{2N}$ 给出。其动力学由一个典范端口-哈密顿系统控制：\n$$\n\\dot{x} = J \\nabla H(x) \\quad \\text{其中} \\quad J = \\begin{bmatrix} 0 & I_N \\\\ -I_N & 0 \\end{bmatrix} \\quad \\text{且} \\quad H(q,p) = \\frac{1}{2} q^\\top K q + \\frac{1}{2} p^\\top M^{-1} p.\n$$\n粗粒化是一个由从降维坐标 $(Q,P)$ 到精细坐标 $(q,p)$ 的线性变换定义的 Galerkin 投影：\n$$\nq = V Q, \\quad p = V P.\n$$\n这里，$V \\in \\mathbb{R}^{N \\times r}$ 是聚合矩阵，其中 $r=N/2$，其列构成了投影子空间的标准正交基，即 $V^\\top V = I_r$。这个变换可以对整个状态向量 $x_r = [Q^\\top, P^\\top]^\\top \\in \\mathbb{R}^{2r}$ 写成：\n$$\nx = \\mathcal{V} x_r, \\quad \\text{其中} \\quad \\mathcal{V} = \\begin{bmatrix} V & 0 \\\\ 0 & V \\end{bmatrix}.\n$$\n降维哈密顿量 $H_r(Q,P)$ 是通过在该子空间上计算完整哈密顿量 $H(q,p)$ 来定义的：\n$$\n\\begin{align*}\nH_r(Q,P) & = H(VQ, VP) \\\\\n& = \\frac{1}{2} (VQ)^\\top K (VQ) + \\frac{1}{2} (VP)^\\top M^{-1} (VP) \\\\\n& = \\frac{1}{2} Q^\\top (V^\\top K V) Q + \\frac{1}{2} P^\\top (V^\\top M^{-1} V) P \\\\\n& = \\frac{1}{2} Q^\\top K_r Q + \\frac{1}{2} P^\\top M_r^{-1} P,\n\\end{align*}\n$$\n其中降维刚度矩阵为 $K_r = V^\\top K V$，降维逆质量矩阵为 $M_r^{-1} = V^\\top M^{-1} V$。\n\n为了证明降维系统保持了典范端口-哈密顿结构，我们对动力学进行投影。降维状态 $x_r$ 的时间演化是通过将精细尺度动力学投影到由 $V$ 定义的子空间上来得到的。由于 $Q = V^\\top q$ 和 $P = V^\\top p$，我们有 $x_r = \\mathcal{V}^\\top x$。求时间导数：\n$$\n\\dot{x}_r = \\mathcal{V}^\\top \\dot{x} = \\mathcal{V}^\\top J \\nabla H(x).\n$$\n对于端口-哈密顿系统的保结构模型降阶，一个关键的见解是，如果投影算子 $\\mathcal{V}$ 和结构矩阵 $J$ 以特定方式交换，则结构得以保持。我们寻求形式为 $\\dot{x}_r = J_r \\nabla_{x_r} H_r(x_r)$ 的降维动力学，其中 $J_r = \\begin{bmatrix} 0 & I_r \\\\ -I_r & 0 \\end{bmatrix}$。降维哈密顿量的梯度是 $\\nabla_{x_r} H_r = \\mathcal{V}^\\top \\nabla H(\\mathcal{V} x_r)$。完美保持结构的条件是 $J_r = \\mathcal{V}^\\top J \\mathcal{V}$。让我们验证这个条件：\n$$\n\\mathcal{V}^\\top J \\mathcal{V} = \\begin{bmatrix} V^\\top & 0 \\\\ 0 & V^\\top \\end{bmatrix} \\begin{bmatrix} 0 & I_N \\\\ -I_N & 0 \\end{bmatrix} \\begin{bmatrix} V & 0 \\\\ 0 & V \\end{bmatrix} = \\begin{bmatrix} V^\\top & 0 \\\\ 0 & V^\\top \\end{bmatrix} \\begin{bmatrix} 0 & V \\\\ -V & 0 \\end{bmatrix} = \\begin{bmatrix} 0 & V^\\top V \\\\ -V^\\top V & 0 \\end{bmatrix}.\n$$\n由于 $V$ 的列是标准正交的，所以 $V^\\top V = I_r$。因此，\n$$\n\\mathcal{V}^\\top J \\mathcal{V} = \\begin{bmatrix} 0 & I_r \\\\ -I_r & 0 \\end{bmatrix} = J_r.\n$$\n该条件成立。这证实了降维系统确实保持了具有降维哈密顿量 $H_r$ 和结构矩阵 $J_r$ 的典范端口-哈密顿结构。因此，降维系统的运动方程确实是：\n$$\n\\begin{bmatrix} \\dot{Q} \\\\ \\dot{P} \\end{bmatrix} = J_r \\nabla_{x_r} H_r(Q,P) = \\begin{bmatrix} 0 & I_r \\\\ -I_r & 0 \\end{bmatrix} \\begin{bmatrix} K_r Q \\\\ M_r^{-1} P \\end{bmatrix} = \\begin{bmatrix} M_r^{-1} P \\\\ -K_r Q \\end{bmatrix}.\n$$\n这完成了所需的证明。\n\n**2. 数值实现**\n\n实现过程对每个测试用例遵循一系列步骤。\n\n**步骤A：系统构建**\n首先，我们为精细尺度系统构建矩阵。\n- 质量矩阵 $M$ 是一个对角矩阵，其元素来自质量向量 $m \\in \\mathbb{R}^N_{>0}$。它的逆矩阵 $M^{-1}$ 是一个对角矩阵，其元素为 $1/m_i$。\n- 刚度矩阵 $K \\in \\mathbb{R}^{N \\times N}$ 是对称的，由弹簧刚度 $k \\in \\mathbb{R}^{N-1}_{>0}$、$k_{\\mathrm{L}}>0$ 和 $k_{\\mathrm{R}}>0$ 构建。对于一个 $N \\times N$ 的零矩阵，我们加上每个弹簧的贡献。对于一个连接质量 $i$ 和 $i+1$（使用基于0的索引，即质量 $i$ 和质量 $i+1$，其中 $i=0,\\dots,N-2$）的内部弹簧 $k_i$，对应的子矩阵是 $\\begin{bmatrix} k_i & -k_i \\\\ -k_i & k_i \\end{bmatrix}$。因此，我们执行更新：$K_{i,i} \\mathrel{+}= k_i$、$K_{i+1,i+1} \\mathrel{+}= k_i$、$K_{i,i+1} \\mathrel{-}= k_i$、$K_{i+1,i} \\mathrel{-}= k_i$。对于末端弹簧，我们更新 $K_{0,0} \\mathrel{+}= k_{\\mathrm{L}}$ 和 $K_{N-1,N-1} \\mathrel{+}= k_{\\mathrm{R}}$。\n\n**步骤B：粗粒化**\n接下来，我们构建粗粒化系统。\n- 构建聚合矩阵 $V \\in \\mathbb{R}^{N \\times r}$，其中 $r=N/2$。其第 $j$ 列（对于 $j=0,\\dots,r-1$）在行 $2j$ 和 $2j+1$ 处的值为 $1/\\sqrt{2}$，其他位置为 $0$。\n- 通过投影计算降维矩阵：$K_r = V^\\top K V$ 和 $M_r^{-1} = V^\\top M^{-1} V$。\n\n**步骤C：初始化**\n提供了位置 $q(0)$ 和速度 $v(0)$ 的初始条件。\n- 初始动量为 $p(0)=M v(0)$。\n- 通过投影获得初始粗粒化状态：$Q(0) = V^\\top q(0)$ 和 $P(0) = V^\\top p(0)$。\n- 模拟步数为 $N_{\\mathrm{steps}} = \\lfloor T/\\Delta t \\rfloor$。\n- 两个系统的能量轨迹 $H_{traj}$ 和 $H_{r,traj}$ 被初始化为大小为 $N_{\\mathrm{steps}}+1$ 的列表或数组。我们计算并存储初始能量 $H(0)$ 和 $H_r(0)$。\n\n**步骤D：时间积分**\n我们使用二阶 Störmer-Verlet 积分器从 $t=0$ 到 $t=T$ 模拟两个系统。对于每一步 $n=0, \\dots, N_{\\mathrm{steps}}-1$：\n- 精细系统更新：\n  $$\n  p_{n+\\frac{1}{2}} = p_n - \\frac{\\Delta t}{2} K q_n, \\quad\n  q_{n+1} = q_n + \\Delta t M^{-1} p_{n+\\frac{1}{2}}, \\quad\n  p_{n+1} = p_{n+\\frac{1}{2}} - \\frac{\\Delta t}{2} K q_{n+1}.\n  $$\n- 粗糙系统更新：\n  $$\n  P_{n+\\frac{1}{2}} = P_n - \\frac{\\Delta t}{2} K_r Q_n, \\quad\n  Q_{n+1} = Q_n + \\Delta t M_r^{-1} P_{n+\\frac{1}{2}}, \\quad\n  P_{n+1} = P_{n+\\frac{1}{2}} - \\frac{\\Delta t}{2} K_r Q_{n+1}.\n  $$\n在每个完整步骤之后，计算并存储两个系统的哈密顿量：\n$$\nH(t_{n+1}) = \\frac{1}{2} q_{n+1}^\\top K q_{n+1} + \\frac{1}{2} p_{n+1}^\\top M^{-1} p_{n+1} \\\\\nH_r(t_{n+1}) = \\frac{1}{2} Q_{n+1}^\\top K_r Q_{n+1} + \\frac{1}{2} P_{n+1}^\\top M_r^{-1} P_{n+1}\n$$\n\n**步骤E：误差计算**\n仿真循环完成后，使用能量轨迹 $H_{traj}$ 和 $H_{r,traj}$ 计算比较度量。\n- 相对 $\\ell^2$ 误差：\n$$\n\\varepsilon_{\\mathrm{rel}} = \\sqrt{\\frac{\\sum_{n=0}^{N_{\\mathrm{steps}}} \\left(H_r(t_n) - H(t_n)\\right)^2}{\\sum_{n=0}^{N_{\\mathrm{steps}}} H(t_n)^2}}.\n$$\n- 最大绝对偏差：\n$$\n\\Delta_{\\max} = \\max_{0 \\leq n \\leq N_{\\mathrm{steps}}} \\left| H_r(t_n) - H(t_n) \\right|.\n$$\n这两个值构成一个测试用例的结果。对所有测试用例重复此过程。",
            "answer": "[[0.528355694207865,0.013583623861298495],[0.3703661139418659,0.009384594191632314],[0.999661445781604,0.010156945803271168]]"
        }
    ]
}