{
    "hands_on_practices": [
        {
            "introduction": "在深入研究自适应偏置力（ABF）方法的复杂算法之前，首先必须清晰地理解其计算目标：平均力势（PMF）。本练习将通过一个简单的一维系统，引导您从统计力学的基本原理出发，直接推导其PMF。这个过程将阐明PMF与系统势能 $U(\\zeta)$ 之间的关系，并揭示在何种情况下两者是等同的，为理解更复杂系统中熵的贡献打下坚实的基础。",
            "id": "3730101",
            "problem": "考虑一个一维过阻尼系统，该系统处于正则系综的热平衡状态，其坐标为 $x$，势能为 $U(x)=a x^{4}-b x^{2}$，其中 $a>0$ 且 $b>0$。设反应坐标为恒等映射 $\\zeta=x$。自适应偏置力（ABF）方法通过统计力学的基本定义，从平衡概率密度 $\\rho(\\zeta)$ 中恢复沿反应坐标的平均力势 $A(\\zeta)$。假设对于这个没有几何约束或额外自由度的单一坐标，平衡边际密度与玻尔兹曼因子成正比，即 $\\rho(\\zeta)\\propto \\exp\\!\\left(-\\beta U(\\zeta)\\right)$，其中 $\\beta=1/(k_{B}T)$，$k_{B}$ 是玻尔兹曼常数，$T$ 是绝对温度。\n\n从正则系综的第一性原理和平均力势的定义出发，直接从 $\\rho(\\zeta)$ 推导出 $A(\\zeta)$。通过设定条件 $A(0)=0$ 来确定任意加法常数。然后，使用推导出的 $A(\\zeta)$，分析当反应坐标等于物理坐标时（无熵雅可比项），这对有限温度下的能垒高度意味着什么。你的分析应基于上述平衡原理，并且除了从 $\\rho(\\zeta)$ 得到平均力势的基本定义外，不应援引任何预先推导的ABF特有公式。\n\n将满足指定参考点 $A(0)=0$ 的 $A(\\zeta)$ 的闭式表达式作为你的最终答案报告。不需要进行数值计算。",
            "solution": "### 推导过程\n沿反应坐标 $\\zeta$ 的平均力势 $A(\\zeta)$，由平衡概率密度 $\\rho(\\zeta)$ 通过统计力学的基本关系定义：\n$$\n\\rho(\\zeta) = C \\exp(-\\beta A(\\zeta))\n$$\n其中 $C$ 是一个归一化常数，$\\beta = 1/(k_{B}T)$。\n\n这个定义可以重新整理，将 $A(\\zeta)$ 表示为 $\\rho(\\zeta)$ 的函数：\n$$\nA(\\zeta) = -\\frac{1}{\\beta} \\ln(\\rho(\\zeta)) + C_1\n$$\n其中 $C_1$ 是一个任意加法常数。\n\n问题陈述，对于该系统，平衡密度与势能 $U(\\zeta)$ 的玻尔兹曼因子成正比：\n$$\n\\rho(\\zeta) = K \\exp(-\\beta U(\\zeta))\n$$\n其中 $K$ 是一个比例常数。将这个密度表达式代入我们关于 $A(\\zeta)$ 的方程中：\n$$\nA(\\zeta) = -\\frac{1}{\\beta} \\ln \\left( K \\exp(-\\beta U(\\zeta)) \\right) + C_1\n$$\n利用对数的性质 $\\ln(xy) = \\ln(x) + \\ln(y)$ 和 $\\ln(\\exp(z)) = z$：\n$$\nA(\\zeta) = -\\frac{1}{\\beta} \\left( \\ln(K) - \\beta U(\\zeta) \\right) + C_1 = U(\\zeta) - \\frac{\\ln(K)}{\\beta} + C_1\n$$\n我们可以将所有常数项合并成一个单一的任意加法常数 $C_2$：\n$$\nA(\\zeta) = U(\\zeta) + C_2\n$$\n这个结果展示了一个关键点：对于只有一个自由度 $x$ 的系统，当反应坐标定义为 $\\zeta=x$ 时，平均力势 $A(\\zeta)$ 与势能 $U(\\zeta)$ 在一个加法常数的差异内是相同的。这是因为没有其他自由度可以进行平均，因此沿坐标 $\\zeta$ 的自由能没有熵的贡献。\n\n问题给出了势能的具体形式，$U(x) = a x^{4} - b x^{2}$。由于 $\\zeta=x$，我们有：\n$$\nU(\\zeta) = a \\zeta^{4} - b \\zeta^{2}\n$$\n因此，平均力势为：\n$$\nA(\\zeta) = a \\zeta^{4} - b \\zeta^{2} + C_2\n$$\n为了确定常数 $C_2$，我们应用指定的条件 $A(0)=0$：\n$$\nA(0) = a (0)^{4} - b (0)^{2} + C_2 = 0 \\implies C_2 = 0\n$$\n因此，平均力势的最终表达式为：\n$$\nA(\\zeta) = a \\zeta^{4} - b \\zeta^{2}\n$$\n关于有限温度下能垒高度的分析：自由能剖面的能垒高度是 $A(\\zeta)$ 在过渡态的最大值与其在稳态的最小值之差。由于我们已经发现 $A(\\zeta) = U(\\zeta)$，自由能剖面与势能剖面是相同的。$A(\\zeta)$ 的极值点可通过将其导数设为零来找到：\n$$\n\\frac{dA}{d\\zeta} = 4a\\zeta^{3} - 2b\\zeta = 2\\zeta(2a\\zeta^2 - b) = 0\n$$\n极值点位于 $\\zeta=0$（局部极大值/垒顶）和 $\\zeta = \\pm\\sqrt{\\frac{b}{2a}}$（极小值/稳态）。\n\nPMF在这些点的值为：\n-   在垒顶（$\\zeta=0$）：$A(0) = 0$。\n-   在极小值点（$\\zeta = \\pm\\sqrt{\\frac{b}{2a}}$）：$A\\left(\\pm\\sqrt{\\frac{b}{2a}}\\right) = a\\left(\\frac{b}{2a}\\right)^2 - b\\left(\\frac{b}{2a}\\right) = -\\frac{b^2}{4a}$。\n\n自由能垒高度 $\\Delta A^{\\ddagger}$ 是两者之差：\n$$\n\\Delta A^{\\ddagger} = A(0) - A\\left(\\pm\\sqrt{\\frac{b}{2a}}\\right) = 0 - \\left(-\\frac{b^2}{4a}\\right) = \\frac{b^2}{4a}\n$$\n关键的含义是，在这种简化的一维情况下，自由能垒 $\\Delta A^{\\ddagger}$ 等于势能垒 $\\Delta U^{\\ddagger}$，并且完全不依赖于温度 $T$（只要 $T>0$）。这是没有其他自由度的直接后果，意味着自由能剖面中没有依赖于温度的熵贡献。在更复杂的、多维的系统中，$A(\\zeta)$ 通常会依赖于温度。",
            "answer": "$$\n\\boxed{a \\zeta^{4} - b \\zeta^{2}}\n$$"
        },
        {
            "introduction": "理解了平均力势（PMF）这一目标后，下一步是探究自适应偏置力（ABF）方法的核心工作机制。本练习模拟了ABF计算中的关键一步：根据新采集的模拟数据来更新偏置力的运行平均值。通过这个具体的计算，您将亲身体验“自适应”偏置力是如何从瞬时力样本中逐步累积和构建的。",
            "id": "164309",
            "problem": "在增强采样模拟中，自适应偏置力（ABF）方法是一种强大的技术，用于计算沿选定集体变量（CV）$\\xi$ 的平均力势（PMF）。该方法的工作原理是估算平均热力学力 $F(\\xi) = -\\frac{d W(\\xi)}{d \\xi}$（其中 $W(\\xi)$ 为平均力势），并施加一个抵消它的偏置力。这可实现沿 CV 的均匀采样。\n\n平均力是通过对投影到 CV 上的瞬时力 $F_{inst}$ 进行平均来估算的。在实际应用中，CV 的范围被划分成一系列离散的区间。对于每个区间 $k$，系统会根据落入该区间的模拟样本，计算并维护一个力的运行平均值 $\\langle F \\rangle_k$。\n\n在处理一批新数据后，区间 $k$ 中力的运行平均值根据以下公式进行更新：\n$$\n\\langle F \\rangle_k^{\\text{new}} = \\frac{N_k^{\\text{old}} \\langle F \\rangle_k^{\\text{old}} + \\sum_{i=1}^{m_k} F_i^{\\text{new}}}{N_k^{\\text{old}} + m_k}\n$$\n其中，$N_k^{\\text{old}}$ 和 $\\langle F \\rangle_k^{\\text{old}}$ 分别是更新前区间 $k$ 中的样本总数和平均力。新数据为区间 $k$ 贡献了 $m_k$ 个新样本，其瞬时力值为 $F_i^{\\text{new}}$。\n\n考虑一个针对双原子分子的 ABF 模拟，其中 CV $\\xi$ 是键长 $r$。CV 空间从 $r=r_0$ 开始，被划分为四个宽度均为 $\\Delta r$ 的连续区间：\n- 区间 1：$[r_0, r_0 + \\Delta r)$\n- 区间 2：$[r_0 + \\Delta r, r_0 + 2\\Delta r)$\n- 区间 3：$[r_0 + 2\\Delta r, r_0 + 3\\Delta r)$\n- 区间 4：$[r_0 + 3\\Delta r, r_0 + 4\\Delta r)$\n\n经过一个初始模拟阶段后，每个区间累积的数据总结在下表中：\n\n| 区间索引 (k) | 初始样本数 ($N_k^{\\text{old}}$) | 初始平均力 ($\\langle F \\rangle_k^{\\text{old}}$) |\n|:-------------:|:------------------------------------:|:-----------------------------------------------:|\n| 1             | $C_1$                                | $f_1$                                           |\n| 2             | $C_2$                                | $f_2$                                           |\n| 3             | $C_3$                                | $f_3$                                           |\n| 4             | $C_4$                                | $f_4$                                           |\n\n随后进行的一次短时模拟运行提供了一批新的六个瞬时键长和力测量值 $(r_i, F_i^{\\text{new}})$：\n1. $(r_0 + \\frac{1}{2}\\Delta r, F_a)$\n2. $(r_0 + \\frac{5}{2}\\Delta r, F_b)$\n3. $(r_0 + \\frac{3}{2}\\Delta r, F_c)$\n4. $(r_0 + \\frac{11}{4}\\Delta r, F_d)$\n5. $(r_0 + \\frac{13}{4}\\Delta r, F_e)$\n6. $(r_0 + \\frac{9}{4}\\Delta r, F_f)$\n\n你的任务是在整合这组新的测量数据后，计算区间 3 更新后的平均力 $\\langle F \\rangle_3^{\\text{new}}$。",
            "solution": "1.  区间 3 的更新公式（来自问题描述）为：\n$$\n\\langle F \\rangle_3^{\\text{new}} = \\frac{N_3^{\\text{old}} \\langle F \\rangle_3^{\\text{old}} + \\sum_{i=1}^{m_3} F_i^{\\text{new}}}{N_3^{\\text{old}} + m_3}\n$$\n\n2.  确定六个新数据点中有哪些落入区间 3，即 $r \\in [r_0+2\\Delta r, r_0+3\\Delta r)$：\n    - $(r_0+\\frac{5}{2}\\Delta r, F_b)$\n    - $(r_0+\\frac{11}{4}\\Delta r, F_d)$\n    - $(r_0+\\frac{9}{4}\\Delta r, F_f)$\n\n    因此，新样本的数量为 $m_3=3$，这些新样本的瞬时力之和为 $F_b+F_d+F_f$。\n\n3.  将初始条件 $N_3^{\\text{old}}=C_3$ 和 $\\langle F \\rangle_3^{\\text{old}}=f_3$ 代入公式：\n$$\n\\langle F \\rangle_3^{\\text{new}} = \\frac{C_3 f_3 + (F_b+F_d+F_f)}{C_3+3}\n$$",
            "answer": "$$\\boxed{\\frac{C_3\\,f_3+F_b+F_d+F_f}{C_3+3}}$$"
        },
        {
            "introduction": "成功运行一个模拟是一回事，而判断其结果是否可靠则是另一回事，后者往往更具挑战性。本练习将探讨一个在增强采样中常见的实际问题：当模拟在达到充分收敛之前被提前终止时，会发生什么。通过分析这种非平衡情况下的预期结果，您将学会识别ABF计算中因“滞后效应”导致的典型伪影，例如对能垒的过高估计，这是批判性地评估和解释模拟结果所必需的关键技能。",
            "id": "2448538",
            "problem": "考虑一个由一维集体变量 (CV) $\\xi$ 描述的分子系统，该系统表现出两个由高峰垒隔开的、深的且不等价的自由能极小值。平均力势 (PMF) $A(\\xi)$ 由沿 $\\xi$ 的可逆功定义，其导数由下式给出\n$$\n\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi} = - \\left\\langle F_{\\xi} \\right\\rangle_{\\xi},\n$$\n其中 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 是在 $\\xi$ 固定时，瞬时广义力沿 $\\xi$ 投影的条件平衡平均值。在自适应偏置力 (ABF) 方法中，构建一个偏置势 $V_{\\mathrm{ABF}}(\\xi)$，使得 $\\mathrm{d}V_{\\mathrm{ABF}}/\\mathrm{d}\\xi$ 自适应地接近 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$，目的是通过对估计的平均力进行数值积分来改善采样并重建 $A(\\xi)$。\n\n假设一个 ABF 模拟在较低的自由能极小值处初始化，并在系统远未完成足够多次跨越能垒的双向跃迁之前终止（即，在每个区间达到局部条件平衡之前，以及沿 $\\xi$ 的可逆性建立之前）。哪个选项最能描述由此得到的估计 PMF $\\hat{A}(\\xi)$ 的定性外观？\n\nA. $\\hat{A}(\\xi)$ 近乎平坦，有两个等深的势阱和一个被严重低估的能垒，因为即使样本很少，自适应偏置也会使剖面变平。\n\nB. 对初始势阱有明显偏好：$\\hat{A}(\\xi)$ 再现了起始极小值附近的局部曲率，但能垒高度被高估，另一个极小值在自由能上显得过高；采样不足的区域充满噪声或不规则。\n\nC. 在访问过的区间内是精确的 $A(\\xi)$，在其他地方没有估计值，因为局部力平均值不论采样方向性如何都会强制得到精确梯度。\n\nD. 一个对称的双势阱 $\\hat{A}(\\xi)$，尽管极小值是不等价的，但它与真实的 $A(\\xi)$ 仅相差一个加性常数。\n\nE. 一个基本上是随机的、与真实自由能形貌不相关的 PMF $\\hat{A}(\\xi)$，因为从一开始施加的偏置就主导了动力学。",
            "solution": "自适应偏置力方法的核心原理是通过在集体变量 $\\xi$ 上的离散区间内累积瞬时力 $F_{\\xi}$ 的运行平均值来估计真实的平均力 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$。然后，通过对这个估计的平均力的负值进行积分，得到估计的 PMF $\\hat{A}(\\xi)$：\n$$\n\\hat{A}(\\xi) \\approx - \\int_{\\xi_0}^{\\xi} \\hat{\\left\\langle F_{\\xi'} \\right\\rangle}_{\\xi'} \\, \\mathrm{d}\\xi' + C\n$$\n其中 $\\hat{\\left\\langle F_{\\xi'} \\right\\rangle}_{\\xi'}$ 是对应于坐标 $\\xi'$ 的区间中的估计平均力，而 $C$ 是一个积分常数。\n\n问题指明了两个关键条件：模拟在一个势阱中初始化，并在收敛前终止。ABF 的收敛需要对于沿 $\\xi$ 的每个区间满足两个条件：\n1.  **统计收敛**：必须收集足够多的 $F_{\\xi}$ 样本，以使平均值的统计误差很小。\n2.  **正交自由度的平衡**：在某个 $\\xi$ 值上受约束的系统，必须有时间在所有其他自由度上达到平衡。这就是“条件平衡平均”$\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 的含义。这要求系统已经多次从所有相邻区域（例如，从左侧和右侧）访问过该区间，从而建立可逆性。\n\n问题明确指出，模拟在“足够多次跨越能垒的双向跃迁”发生之前就终止了。这直接违反了收敛的第二个条件，尤其是在能垒区域。\n\n让我们分析其后果：\n- **在初始势阱中**：系统在此处初始化，并在越过能垒前花费大量时间探索该区域。因此采样是密集的。力的估计值 $\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}$ 在统计上是可靠的，并且系统处于局部平衡状态。因此，积分得到的 $\\hat{A}(\\xi)$ 将能在此初始自由能阱内准确地再现 PMF $A(\\xi)$ 的真实形状和局部曲率。\n\n- **在能垒上和第二个势阱中**：随着 ABF 偏置将系统从初始极小值推向自由能垒的上方，采样变得越来越稀疏。关键的失败在于缺乏可逆性。力 $F_{\\xi}$ 几乎完全是从第一个势阱“上坡”运动的轨迹中采样的。系统被主动驱动进入一个高能区域，没有时间使其正交自由度弛豫以适应新的约束条件。这种现象被称为滞后或系统延迟，会导致系统误差。测得的恢复力通常被高估；这是拖动一个非平衡系统所需的力，它大于维持一个平衡系统所需的力。因此，在能垒区域，估计的平均力的大小 $|\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}|$ 将系统性地大于真实的平衡值 $|\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}|$。\n\n- **对 $\\hat{A}(\\xi)$ 的影响**：对一个大小被高估的平均力进行积分，会导致重建的 PMF 过于陡峭。这意味着极小值与过渡态之间的自由能差——即能垒高度——将被**高估**。在这个被高估的能垒之后，随后进入第二个势阱的过程将从一个人为的高自由能值开始。结果，相对于第一个极小值，第二个极小值将显得处于远高于其实际值的自由能上。此外，在样本极少的区域（能垒顶部和第二个势阱），力估计中的高统计不确定性将在重建的 PMF $\\hat{A}(\\xi)$ 中表现为噪声或不规则的锯齿状特征。\n\n### 逐项分析\n\n**A. $\\hat{A}(\\xi)$ 近乎平坦，有两个等深的势阱和一个被严重低估的能垒，因为即使样本很少，自适应偏置也会使剖面变平。**\n**不正确。** ABF 方法平坦化的是*修正后*的自由能面（物理势加偏置势），而不是重建的 PMF $\\hat{A}(\\xi)$。$\\hat{A}(\\xi)$ 是对原始未平坦化的 PMF 的估计。没有理由势阱会变得等深，尤其是在有偏采样的情况下。低估能垒也与预期的滞后效应相反。\n\n**B. 对初始势阱有明显偏好：$\\hat{A}(\\xi)$ 再现了起始极小值附近的局部曲率，但能垒高度被高估，另一个极小值在自由能上显得过高；采样不足的区域充满噪声或不规则。**\n**正确。** 该陈述准确地总结了在跨能垒次数不足的情况下未收敛的 ABF 模拟的后果。初始势阱中的良好采样确保了正确的局部曲率。缺乏可逆采样导致力的过高估计（滞后），从而造成能垒被高估。这反过来又使得随后的势阱能量显得被人为地抬高。在稀疏采样区域的不良统计会导致噪声。\n\n**C. 在访问过的区间内是精确的 $A(\\xi)$，在其他地方没有估计值，因为局部力平均值不论采样方向性如何都会强制得到精确梯度。**\n**不正确。** 这在根本上是错误的。局部力平均值只有在局部平衡和充分采样的条件下才会收敛到精确梯度 $-\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi}$。问题明确指出这些条件未被满足。采样的方向性对于避免系统误差至关重要。\n\n**D. 一个对称的双势阱 $\\hat{A}(\\xi)$，尽管极小值是不等价的，但它与真实的 $A(\\xi)$ 仅相差一个加性常数。**\n**不正确。** 真实的 PMF 是不对称的（“不等价的极小值”）。没有任何物理或算法上的原因可以解释为什么一个非对称开始的、未收敛的模拟会产生一个对称的结果。结果将是真实不对称剖面的一个扭曲版本，而不是一个完全对称的版本。\n\n**E. 一个基本上是随机的、与真实自由能形貌不相关的 PMF $\\hat{A}(\\xi)$，因为从一开始施加的偏置就主导了动力学。**\n**不正确。** 结果不是随机的，而是系统性地有偏。在采样良好的初始区域，与真实自由能形貌的相关性很高。偏置不会从一开始就主导；它是从零的初始值自适应地建立起来的。因此，模拟的初始部分探索的是真实的势。最终结果虽然有缺陷，但远非随机。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}