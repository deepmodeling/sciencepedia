{
    "hands_on_practices": [
        {
            "introduction": "我们首先探究并行副本动力学（ParRep）效率的理论基础。该练习将引导您推导预期的加速比，揭示该算法如何实现其加速效果，以及其性能如何关键性地依赖于系统出射时间的统计特性。理解这种关系是有效应用和分析 ParRep 的第一步。",
            "id": "3791178",
            "problem": "考虑一个在亚稳态集 $\\mathcal{S}$ 中演化的连续时间马尔可夫过程，并令单条轨迹离开 $\\mathcal{S}$ 的逃逸时间为非负随机变量 $T$。在并行副本（ParRep）动力学算法中，经过一个旨在强制实现准静态分布（QSD）的去相关和去相位阶段后，会启动 $N$ 个独立的副本，每个副本的逃逸时间为 $T_{i}$，该算法使用最小逃逸时间 $T_{\\min} = \\min\\{T_{1},\\dots,T_{N}\\}$ 来加速采样。假设这些副本是独立同分布（IID）的，并且 $T$ 的生存函数为 $S(t) = \\mathbb{P}(T>t)$。\n\n从适用于亚稳态逃逸问题和顺序统计量的基本定义出发，推导在以下两种情况下，期望加速比 $\\mathbb{E}[T]/\\mathbb{E}[T_{\\min}]$ 作为 $N$ 的函数的解析表达式：\n\n1. 在准静态分布（QSD）假设下，逃逸时间服从指数分布，其速率参数为 $\\lambda>0$，即 $S(t) = \\exp(-\\lambda t)$。\n2. 当不满足准静态分布（QSD）假设且逃逸时间为非指数分布时，用韦布尔（Weibull）分布对逃逸时间进行建模，其形状参数为 $k>0$，尺度参数为 $1/\\lambda>0$，即 $S(t) = \\exp\\!\\big(-(\\lambda t)^{k}\\big)$。\n\n基于第一性原理，简要解释为什么偏离准静态分布（QSD）假设会导致 ParRep 算法偏离线性加速定律。你的最终答案必须是 $\\mathbb{E}[T]/\\mathbb{E}[T_{\\min}]$ 关于 $N$（以及在适用时关于 $k$）的闭式解析表达式。不需要进行数值取整，并且这个无量纲比率不涉及任何物理单位。",
            "solution": "问题要求计算并行副本（ParRep）动力学算法的期望加速比，定义为比率 $\\mathbb{E}[T]/\\mathbb{E}[T_{\\min}]$，在两种关于单个副本逃逸时间 $T$ 的分布的不同假设下进行。这里，$T_1, \\dots, T_N$ 是 $N$ 个独立同分布（IID）副本的逃逸时间，$T_{\\min} = \\min\\{T_1, \\dots, T_N\\}$ 是算法中观测到的逃逸时间。\n\n概率论中的一个基本结果指出，对于任何具有生存函数 $S_X(x) = \\mathbb{P}(X > x)$ 的非负随机变量 $X$，其期望值由生存函数的积分给出：\n$$\n\\mathbb{E}[X] = \\int_{0}^{\\infty} S_X(x) \\, dx\n$$\n单个副本逃逸时间 $T$ 的生存函数为 $S(t) = \\mathbb{P}(T > t)$。$T_{\\min}$ 的生存函数（记为 $S_{\\min}(t)$）可以从独立同分布（IID）假设中推导出来。事件 $T_{\\min} > t$ 等价于所有单个副本的逃逸时间都大于 $t$ 的事件。\n$$\nS_{\\min}(t) = \\mathbb{P}(T_{\\min} > t) = \\mathbb{P}(T_1 > t, T_2 > t, \\dots, T_N > t)\n$$\n由于副本的独立性，联合概率是各个概率的乘积：\n$$\nS_{\\min}(t) = \\prod_{i=1}^{N} \\mathbb{P}(T_i > t)\n$$\n由于副本是同分布的，对所有 $i$ 都有 $\\mathbb{P}(T_i > t) = S(t)$。因此，\n$$\nS_{\\min}(t) = [S(t)]^N\n$$\n因此，期望加速比可以写成两个积分的比值：\n$$\n\\frac{\\mathbb{E}[T]}{\\mathbb{E}[T_{\\min}]} = \\frac{\\int_{0}^{\\infty} S(t) \\, dt}{\\int_{0}^{\\infty} S_{\\min}(t) \\, dt} = \\frac{\\int_{0}^{\\infty} S(t) \\, dt}{\\int_{0}^{\\infty} [S(t)]^N \\, dt}\n$$\n我们现在将此通用公式应用于两种指定情况。\n\n情况1：指数分布（QSD假设）\n在准静态分布（QSD）假设下，逃逸时间 $T$ 服从速率参数为 $\\lambda > 0$ 的指数分布。其生存函数为：\n$$\nS(t) = \\exp(-\\lambda t)\n$$\n单个副本的期望逃逸时间为：\n$$\n\\mathbb{E}[T] = \\int_{0}^{\\infty} \\exp(-\\lambda t) \\, dt = \\left[ -\\frac{1}{\\lambda} \\exp(-\\lambda t) \\right]_{0}^{\\infty} = 0 - \\left(-\\frac{1}{\\lambda}\\right) = \\frac{1}{\\lambda}\n$$\n$N$ 个副本中最小值的生存函数为：\n$$\nS_{\\min}(t) = [S(t)]^N = [\\exp(-\\lambda t)]^N = \\exp(-N\\lambda t)\n$$\n这表明 $T_{\\min}$ 也服从指数分布，但其有效速率参数为 $N\\lambda$。期望的最小逃逸时间为：\n$$\n\\mathbb{E}[T_{\\min}] = \\int_{0}^{\\infty} \\exp(-N\\lambda t) \\, dt = \\left[ -\\frac{1}{N\\lambda} \\exp(-N\\lambda t) \\right]_{0}^{\\infty} = \\frac{1}{N\\lambda}\n$$\n期望加速比是这些期望值的比率：\n$$\n\\frac{\\mathbb{E}[T]}{\\mathbb{E}[T_{\\min}]} = \\frac{1/\\lambda}{1/(N\\lambda)} = N\n$$\n这就是在QSD假设下，ParRep算法著名的线性加速结果。\n\n情况2：韦布尔分布（偏离QSD）\n当不满足QSD假设时，逃逸时间由形状参数为 $k>0$、尺度参数为 $1/\\lambda > 0$ 的韦布尔（Weibull）分布建模。其生存函数为：\n$$\nS(t) = \\exp(-(\\lambda t)^k)\n$$\n为了求期望值 $\\mathbb{E}[T]$，我们对 $S(t)$ 进行积分：\n$$\n\\mathbb{E}[T] = \\int_{0}^{\\infty} \\exp(-(\\lambda t)^k) \\, dt\n$$\n我们进行变量替换。令 $u = (\\lambda t)^k$。则 $t = \\frac{u^{1/k}}{\\lambda}$，且 $dt = \\frac{1}{\\lambda k} u^{1/k - 1} \\, du$。\n$$\n\\mathbb{E}[T] = \\int_{0}^{\\infty} \\exp(-u) \\left( \\frac{1}{\\lambda k} u^{1/k - 1} \\right) \\, du = \\frac{1}{\\lambda k} \\int_{0}^{\\infty} u^{1/k - 1} \\exp(-u) \\, du\n$$\n该积分是伽马函数（Gamma function）的定义，$\\Gamma(z) = \\int_0^\\infty x^{z-1}\\exp(-x)dx$。此处 $z = 1/k$。\n$$\n\\mathbb{E}[T] = \\frac{1}{\\lambda k} \\Gamma(1/k)\n$$\n利用性质 $\\Gamma(z+1) = z\\Gamma(z)$，这可以写成：\n$$\n\\mathbb{E}[T] = \\frac{1}{\\lambda} \\Gamma\\left(1 + \\frac{1}{k}\\right)\n$$\n现在，我们求 $T_{\\min}$ 的期望值。其生存函数为：\n$$\nS_{\\min}(t) = [S(t)]^N = [\\exp(-(\\lambda t)^k)]^N = \\exp(-N(\\lambda t)^k) = \\exp(-(N^{1/k} \\lambda t)^k)\n$$\n这表明 $T_{\\min}$ 也服从韦布尔分布，具有相同的形状参数 $k$，但有一个新的有效速率参数 $\\lambda' = N^{1/k}\\lambda$。我们可以通过在 $\\mathbb{E}[T]$ 的表达式中用 $\\lambda'$ 替换 $\\lambda$ 来求其期望值：\n$$\n\\mathbb{E}[T_{\\min}] = \\frac{1}{\\lambda'} \\Gamma\\left(1 + \\frac{1}{k}\\right) = \\frac{1}{N^{1/k}\\lambda} \\Gamma\\left(1 + \\frac{1}{k}\\right)\n$$\n期望加速比是以下比率：\n$$\n\\frac{\\mathbb{E}[T]}{\\mathbb{E}[T_{\\min}]} = \\frac{\\frac{1}{\\lambda} \\Gamma\\left(1 + \\frac{1}{k}\\right)}{\\frac{1}{N^{1/k}\\lambda} \\Gamma\\left(1 + \\frac{1}{k}\\right)} = N^{1/k}\n$$\n\n关于偏离线性加速的解释：\nQSD假设意味着逃逸过程是无记忆的。这是指数分布的特征，其风险率 $\\lambda(t) = f(t)/S(t)$ 是一个常数（$\\lambda(t) = \\lambda$）。对于无记忆过程，在小时间间隔内发生事件的概率与系统已经等待了多长时间无关。将 $N$ 个这样的过程并行化，会得到一个总的恒定风险率 $N\\lambda$，这直接导致平均逃逸时间减少了 $N$ 倍，从而产生 $N$ 的线性加速。\n\n当不满足QSD时（如用 $k \\ne 1$ 的韦布尔分布建模），该过程具有记忆性。韦布尔分布的风险率是随时间变化的：$\\lambda(t) = k\\lambda^k t^{k-1}$。\n- 当 $k > 1$ 时，风险率随时间增加。这描述了一个系统，其持续时间越长，逃逸的可能性就越大（老化）。并行加速比为 $N^{1/k}$，由于 $1/k  1$，这是次线性的。并行化的好处被削弱了，因为所有副本都需要花费时间在一个初始的、低逃逸概率的阶段，然后才能有任何一个副本达到具有更高逃逸率的状态。\n- 当 $0  k  1$ 时，风险率随时间减少。这描述了一个系统，它在初始瞬态阶段有非常高的概率快速逃逸，如果它能度过这个初始阶段，就会变得更加稳定。加速比为 $N^{1/k}$，由于 $1/k > 1$，这是超线性的。ParRep 在这里特别有效，因为有 $N$ 个副本，很可能至少有一个会在初始的高风险阶段找到快速逃逸路径，从而显著缩短观测时间。\n\n总而言之，偏离无记忆过程的恒定风险率打破了平均逃逸时间的简单标度关系，导致加速比偏离线性定律，并依赖于系统“记忆”的性质，该性质由形状参数 $k$ 捕捉。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} N  N^{1/k} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "ParRep 的威力只有在表现出亚稳态的系统中才能被释放，在这些系统中，稀有事件被长时间的局域平衡所分隔。本问题以一个双阱势为例，要求您运用统计力学原理来量化这种时间尺度分离。通过计算出射时间与弛豫时间之比，您将对 ParRep 不仅适用而且高效的物理条件获得直观的理解。",
            "id": "3791213",
            "problem": "考虑在一维空间中，逆温度为 $\\beta$ 的过阻尼朗之万动力学，其由随机微分方程 $dX_{t}=-V'(X_{t})\\,dt+\\sqrt{2\\beta^{-1}}\\,dW_{t}$ 给出，其中 $W_{t}$ 是标准维纳过程，$V(x)=\\tfrac{1}{4}x^{4}-\\tfrac{1}{2}x^{2}$ 是一个双阱势。在并行副本动力学（Parallel Replica Dynamics, ParRep）算法中，其依赖于两个时间尺度之间的明确分离：一个是向准稳态分布的快速阱内弛豫，另一个是由热激活驱动的稀有阱间穿越。从过阻尼朗之万动力学和吉布斯测度的基本定义出发，并利用关于越垒和局域弛豫的合乎物理的论证，估算在小噪声情形（大 $\\beta$）下，从右侧势阱（$x=1$ 附近）的平均逃逸时间与平均阱内弛豫时间之比。你的推导应：\n- 利用与极小值点和鞍点之间的势垒相关的阿伦尼乌斯越垒指数主项，以及在极小值点和鞍点附近的相应谐振（二次）近似，来获得主导的前置因子。\n- 利用在极小值点附近线性化的福克-普朗克生成元的谱隙启发法来估算阱内弛豫速率。\n假设动力学过程初始时局限于 $x=1$ 处的极小值点附近，且相关的鞍点位于 $x=0$。请以 $\\beta$ 的单个闭式解析表达式的形式给出该比值。将你的最终结果表示为一个无量纲量。不要进行任何数值取整。",
            "solution": "目标是确定一个在双阱势中由过阻尼朗之万方程控制的粒子的平均逃逸时间 $\\tau_{\\text{exit}}$ 与阱内弛豫时间 $\\tau_{\\text{relax}}$ 之比。在并行副本（ParRep）动力学的背景下，这个比值是一个关键量，因为其大小证明了该算法所依赖的时间尺度分离假设的合理性。分析将在小噪声极限下进行，对应于大的逆温度 $\\beta$。\n\n随机微分方程（SDE）由下式给出：\n$$\ndX_{t}=-V'(X_{t})\\,dt+\\sqrt{2\\beta^{-1}}\\,dW_{t}\n$$\n其中势为 $V(x)=\\frac{1}{4}x^{4}-\\frac{1}{2}x^{2}$。\n\n首先，我们分析势 $V(x)$ 的性质。力为 $-V'(x) = -(x^3 - x)$。通过令 $V'(x)=0$ 找到临界点：\n$$\nV'(x) = x^{3} - x = x(x-1)(x+1) = 0\n$$\n临界点为 $x=0$，$x=1$ 和 $x=-1$。为对它们进行分类，我们计算二阶导数：\n$$\nV''(x) = 3x^{2} - 1\n$$\n- 在 $x = \\pm 1$ 处，$V''(\\pm 1) = 3(1)^{2} - 1 = 2 > 0$。这些是稳定极小值点。在极小值点处的势值为 $V(\\pm 1) = \\frac{1}{4}(\\pm 1)^{4} - \\frac{1}{2}(\\pm 1)^{2} = \\frac{1}{4} - \\frac{1}{2} = -\\frac{1}{4}$。\n- 在 $x=0$ 处，$V''(0) = 3(0)^{2} - 1 = -1  0$。这是一个局域极大值点，代表了两个势阱之间的一个鞍点。在鞍点处的势值为 $V(0) = 0$。\n\n问题指明粒子从右侧势阱开始，靠近 $x_{\\text{min}}=1$ 处的极小值点，而逃逸的相关鞍点在 $x_{\\text{sad}}=0$。此跃迁的势垒为：\n$$\n\\Delta V = V(x_{\\text{sad}}) - V(x_{\\text{min}}) = V(0) - V(1) = 0 - \\left(-\\frac{1}{4}\\right) = \\frac{1}{4}\n$$\n\n接下来，我们计算平均逃逸时间 $\\tau_{\\text{exit}}$。在大 $\\beta$ 情形下，平均逃逸时间由 Kramers 速率理论决定。对于单位摩擦系数（如SDE所示）的一维过阻尼动力学，从势阱极小值点 $x_{\\text{min}}$ 越过鞍点 $x_{\\text{sad}}$ 的平均逃逸时间由带有谐振前置因子的 Arrhenius 公式给出：\n$$\n\\tau_{\\text{exit}} = \\frac{2\\pi}{\\sqrt{V''(x_{\\text{min}})|V''(x_{\\text{sad}})|}} \\exp(\\beta \\Delta V)\n$$\n我们有必要的组成部分：\n- $V''(x_{\\text{min}}) = V''(1) = 2$。\n- $|V''(x_{\\text{sad}})| = |V''(0)| = |-1| = 1$。\n- $\\Delta V = \\frac{1}{4}$。\n\n将这些值代入 $\\tau_{\\text{exit}}$ 的公式：\n$$\n\\tau_{\\text{exit}} = \\frac{2\\pi}{\\sqrt{2 \\cdot 1}} \\exp\\left(\\beta \\cdot \\frac{1}{4}\\right) = \\frac{2\\pi}{\\sqrt{2}} \\exp\\left(\\frac{\\beta}{4}\\right) = \\sqrt{2}\\pi \\exp\\left(\\frac{\\beta}{4}\\right)\n$$\n\n现在，我们估算阱内弛豫时间 $\\tau_{\\text{relax}}$。问题指示我们使用在极小值点附近线性化的福克-普朗克生成元的谱隙启发法。在极小值点 $x_{\\text{min}}=1$ 附近，势可以近似为一个谐振势：\n$$\nV(x) \\approx V(x_{\\text{min}}) + \\frac{1}{2}V''(x_{\\text{min}})(x-x_{\\text{min}})^{2}\n$$\n相应的线性化SDE描述了偏差 $y(t) = X(t) - x_{\\text{min}}$ 的 Ornstein-Uhlenbeck (OU) 过程：\n$$\ndY_{t} = -V''(x_{\\text{min}}) Y_{t}\\,dt + \\sqrt{2\\beta^{-1}}\\,dW_{t}\n$$\n阱内动力学在一个由该OU过程速率决定的时间尺度上弛豫到准稳态分布（一个局域平衡）。弛豫时间是相关福克-普朗克算子谱隙的倒数。对于漂移系数为 $-\\kappa y$ 的OU过程，其中 $\\kappa = V''(x_{\\text{min}})$，负生成元的本征值为 $\\{n\\kappa\\}_{n=0}^{\\infty}$。谱隙是第一个非零本征值，即 $\\lambda_{1} = \\kappa$。\n\n因此，弛豫速率等于势在极小值点处的曲率：\n$$\n\\lambda_{\\text{relax}} = V''(x_{\\text{min}})\n$$\n弛豫时间是该速率的倒数：\n$$\n\\tau_{\\text{relax}} = \\frac{1}{\\lambda_{\\text{relax}}} = \\frac{1}{V''(x_{\\text{min}})}\n$$\n使用我们的值 $V''(1)=2$：\n$$\n\\tau_{\\text{relax}} = \\frac{1}{2}\n$$\n\n最后，我们计算平均逃逸时间与阱内弛豫时间之比：\n$$\n\\frac{\\tau_{\\text{exit}}}{\\tau_{\\text{relax}}} = \\frac{\\sqrt{2}\\pi \\exp\\left(\\frac{\\beta}{4}\\right)}{\\frac{1}{2}} = 2\\sqrt{2}\\pi \\exp\\left(\\frac{\\beta}{4}\\right)\n$$\n这个无量纲量表明，时间尺度的比值随 $\\beta$ 指数增长，这证实了 ParRep 算法在低温情形下的有效性和效率所需的时间尺度分离。",
            "answer": "$$\\boxed{2\\sqrt{2}\\pi\\exp\\left(\\frac{\\beta}{4}\\right)}$$"
        },
        {
            "introduction": "在任何实际应用中，理论上的理想情况都会遇到现实的限制。这最后一个练习模拟了实践者面临的一个普遍挑战：在最大化加速比的愿望与保持准确性的需求之间取得平衡。您将建立一个考虑了计算开销和散相误差的模型，然后设计一个计算实验来寻找最优的副本数量，从而学习到先进模拟方法中固有的权衡取舍。",
            "id": "3791212",
            "problem": "考虑一个在亚稳阱中演化的连续时间马尔可夫过程 $X_t$，其从该阱中的逃逸时间为 $\\tau$。当从准平稳分布 (QSD) 初始化时，一个经过充分验证的事实是，$\\tau$ 服从速率为 $\\lambda$（单位：$\\mathrm{s}^{-1}$）的指数分布，因此串行期望逃逸时间为 $\\mathbb{E}[\\tau]=1/\\lambda$（单位：$\\mathrm{s}$）。并行副本 (ParRep) 算法使用 $N$ 个独立的副本以加速逃逸：在理想退相干（精确的 QSD 采样）情况下，$N$ 个速率为 $\\lambda$ 的指数逃逸时间中的最小值服从速率为 $N\\lambda$ 的指数分布，这是指数随机变量的一个标准结论。在实践中，退相干是不完美的。假设在去相关和退相干阶段之后，相对于 QSD 的初始化误差受全变分误差 $\\varepsilon(N)$ 的限制，并且由此产生的平均逃逸时间的相对偏差与此误差成正比：存在一个比例因子 $\\kappa0$，使得相对偏差的大小满足 $|\\delta(N)| \\le \\kappa\\,\\varepsilon(N)$。假设一个保守模型，在计算中使用上界 $\\delta(N)=\\kappa\\,\\varepsilon(N)$。设去相关持续时间为 $t_{\\mathrm{corr}}$（单位：$\\mathrm{s}$），退相干持续时间为 $t_{\\mathrm{deph}}$（单位：$\\mathrm{s}$）。假设使用理想的并行硬件，因此去相关和退相干阶段在挂钟时间上是累加的，并且并行逃逸阶段由 $N$ 个副本并行进行。\n\n您需要设计一个计算实验，对于每个给定的参数集，改变 $N\\in\\{1,2,\\dots,N_{\\max}\\}$ 并测量有效加速比与误差的权衡关系，以在固定的误差容限下确定最优的 $N$。请使用以下建模选择，这些选择在并行副本动力学分析中被广泛用作一阶近似，并且是科学合理的：\n- 串行期望逃逸时间为 $\\mathbb{E}[\\tau]=1/\\lambda$（单位：$\\mathrm{s}$）。\n- 在理想退相干情况下，具有 $N$ 个副本的并行阶段的逃逸时间服从速率为 $N\\lambda$ 的指数分布；因此，其均值为 $1/(N\\lambda)$（单位：$\\mathrm{s}$）。\n- 在存在相对偏差 $\\delta(N)$（根据保守上界，该值为非负）的不完美退相干情况下，并行阶段的平均逃逸时间相对于理想情况按因子 $1-\\delta(N)$ 进行缩放。\n- 退相干误差随粒子数和时间效应的组合而衰减：\n$$\n\\varepsilon(N) \\;=\\; \\frac{\\alpha}{N} \\;+\\; \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}},\n$$\n其中 $\\alpha0$ 是一个粒子数常数，$\\beta\\ge 0$ 和 $\\gamma0$ 控制退相干的时间弛豫，且 $t_{\\mathrm{deph}}0$ 在每个案例中是固定的。总的相对偏差上界为 $\\delta(N)=\\kappa\\,\\varepsilon(N)$，其中 $\\kappa0$。\n- 一个 ParRep 周期的期望挂钟时间（单位：$\\mathrm{s}$）包括去相关时间、退相干时间以及在 $N$ 个核心上并行执行的并行逃逸阶段的期望时间。\n- 有效加速比定义为串行期望时间与 ParRep 期望挂钟时间之比。\n\n您的任务：\n- 从 QSD 的标准指数逃逸时间性质、独立副本的指数分布最小值性质以及上述误差模型出发，推导 ParRep 期望挂钟时间作为 $N$ 的函数及其相应加速比的显式公式。所有时间以 $\\mathrm{s}$ 表示，所有速率以 $\\mathrm{s}^{-1}$ 表示。您的推导必须仅依赖于所提供的基本事实和定义。\n- 在固定的相对误差容限 $\\epsilon_{\\mathrm{tol}}0$ 下，强制执行 $\\delta(N)\\le \\epsilon_{\\mathrm{tol}}$。在满足此约束的所有整数 $N\\in\\{1,2,\\dots,N_{\\max}\\}$ 中，选择使加速比最大化的 $N$。如果在数值精度内加速比出现平局，选择其中最小的 $N$。\n- 如果没有 $N\\in\\{1,2,\\dots,N_{\\max}\\}$ 满足 $\\delta(N)\\le \\epsilon_{\\mathrm{tol}}$，则宣布该情况下的问题不可行，并返回一个哨兵选择 $N_{\\mathrm{opt}}=-1$，加速比为 $0.0$，同时报告可实现的最小偏差值 $\\min_{1\\le N\\le N_{\\max}}\\delta(N)$（无量纲），以量化最佳 $N$ 与容限的接近程度。\n\n每个测试案例的所需输出：\n- $N_{\\mathrm{opt}}$（一个整数）。\n- $S_{\\mathrm{opt}}$（一个浮点数），在 $N_{\\mathrm{opt}}$ 处实现的最大加速比。\n- $\\delta_{\\mathrm{opt}}$（一个浮点数），在 $N_{\\mathrm{opt}}$ 处的偏差上界；如果不可行，则报告 $\\min_{1\\le N\\le N_{\\max}}\\delta(N)$。\n\n数值和格式要求：\n- 将 $S_{\\mathrm{opt}}$ 和 $\\delta_{\\mathrm{opt}}$ 报告为小数（而非百分比），每个都四舍五入到 $6$ 位小数。\n- 程序应生成单行输出，包含所有测试案例的结果，格式为逗号分隔的列表的列表，例如 $[\\,[N_1,S_1,\\delta_1],\\,[N_2,S_2,\\delta_2]\\,]$。\n- 所有物理时间必须以 $\\mathrm{s}$ 为单位，所有速率必须以 $\\mathrm{s}^{-1}$ 为单位。\n\n测试套件（每个元组列出 $(\\lambda, t_{\\mathrm{corr}}, t_{\\mathrm{deph}}, \\alpha, \\beta, \\gamma, \\kappa, \\epsilon_{\\mathrm{tol}}, N_{\\max})$）：\n- 案例 A: $(0.05, 1.0, 2.0, 0.5, 0.01, 1.0, 1.0, 0.05, 128)$。\n- 案例 B: $(0.05, 1.0, 2.0, 0.5, 0.01, 1.0, 1.0, 0.01, 128)$。\n- 案例 C: $(0.2, 5.0, 10.0, 0.2, 0.02, 0.5, 1.5, 0.02, 64)$。\n- 案例 D: $(1.0, 0.1, 0.2, 0.05, 0.0, 1.0, 0.5, 0.001, 8)$。\n- 案例 E: $(0.01, 0.5, 0.5, 0.5, 0.005, 2.0, 1.0, 0.02, 256)$。\n\n您的程序应实现该推导，为每个测试案例评估所有 $N\\in\\{1,\\dots,N_{\\max}\\}$，并输出一行包含 5 个结果的列表 $[\\,[N_{\\mathrm{opt}},S_{\\mathrm{opt}},\\delta_{\\mathrm{opt}}],\\dots]$，其中浮点数按规定四舍五入到 6 位小数。",
            "solution": "### ParRep 挂钟时间和加速比的推导\n\n目标是推导 ParRep 期望挂钟时间 $T_{\\mathrm{ParRep}}(N)$ 和相应有效加速比 $S(N)$ 作为副本数 $N$ 的函数的显式公式。\n\n**1. 串行期望时间**\n\n串行过程对应于等待逃逸事件的系统的单次模拟。如题所述，从准平稳分布 (QSD) 的逃逸时间 $\\tau$ 服从速率为 $\\lambda$ 的指数分布。串行期望逃逸时间 $T_{\\mathrm{serial}}$ 是该分布的均值：\n$$\nT_{\\mathrm{serial}} = \\mathbb{E}[\\tau] = \\frac{1}{\\lambda}\n$$\n\n**2. ParRep 期望挂钟时间**\n\nParRep 算法周期在挂钟时间上由三个累加的阶段组成：去相关、退相干和并行逃逸。\n\n一个周期的期望挂钟时间 $T_{\\mathrm{ParRep}}(N)$ 是这些阶段持续时间的总和：\n$$\nT_{\\mathrm{ParRep}}(N) = t_{\\mathrm{corr}} + t_{\\mathrm{deph}} + T_{\\mathrm{escape}}(N)\n$$\n其中 $t_{\\mathrm{corr}}$ 是去相关时间，$t_{\\mathrm{deph}}$ 是退相干时间，$T_{\\mathrm{escape}}(N)$ 是并行逃逸阶段的期望挂钟时间。\n\n并行逃逸阶段同时运行 $N$ 个独立的副本。\n-   在理想退相干情况下，每个副本都从精确的 QSD 初始化。$N$ 个副本中首次逃逸的时间是 $N$ 个独立同分布的指数随机变量（每个速率为 $\\lambda$）的最小值。这个最小值本身是一个速率为 $N\\lambda$ 的指数随机变量。因此其期望值为 $1/(N\\lambda)$。\n-   问题指出，在不完美退相干情况下，平均逃逸时间按因子 $1 - \\delta(N)$ 缩放，其中 $\\delta(N)$ 是相对偏差。保守模型假设 $\\delta(N) \\ge 0$。因此，期望逃逸时间为：\n    $$\n    T_{\\mathrm{escape}}(N) = \\frac{1}{N\\lambda} \\left( 1 - \\delta(N) \\right)\n    $$\n\n相对偏差 $\\delta(N)$ 被建模为与全变分误差 $\\varepsilon(N)$ 成正比，比例常数为 $\\kappa$：\n$$\n\\delta(N) = \\kappa\\,\\varepsilon(N)\n$$\n退相干误差 $\\varepsilon(N)$ 由以下模型给出：\n$$\n\\varepsilon(N) = \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}}\n$$\n代入这些表达式，我们得到 $\\delta(N)$ 的完整公式：\n$$\n\\delta(N) = \\kappa \\left( \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}} \\right)\n$$\n现在，将 $T_{\\mathrm{escape}}(N)$ 和 $\\delta(N)$ 的表达式代回 $T_{\\mathrm{ParRep}}(N)$ 的方程中：\n$$\nT_{\\mathrm{ParRep}}(N) = t_{\\mathrm{corr}} + t_{\\mathrm{deph}} + \\frac{1}{N\\lambda} \\left[ 1 - \\kappa \\left( \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}} \\right) \\right]\n$$\n这就是 ParRep 期望挂钟时间的显式公式。\n\n**3. 有效加速比**\n\n有效加速比 $S(N)$ 定义为串行期望时间与 ParRep 期望挂钟时间之比：\n$$\nS(N) = \\frac{T_{\\mathrm{serial}}}{T_{\\mathrm{ParRep}}(N)}\n$$\n代入推导出的 $T_{\\mathrm{serial}}$ 和 $T_{\\mathrm{ParRep}}(N)$ 的表达式：\n$$\nS(N) = \\frac{1/\\lambda}{t_{\\mathrm{corr}} + t_{\\mathrm{deph}} + \\frac{1}{N\\lambda} \\left[ 1 - \\kappa \\left( \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}} \\right) \\right]}\n$$\n这可以重写为：\n$$\nS(N) = \\frac{1}{\\lambda(t_{\\mathrm{corr}} + t_{\\mathrm{deph}}) + \\frac{1}{N}\\left[ 1 - \\kappa \\left( \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}} \\right) \\right]}\n$$\n这就是有效加速比作为 $N$ 的函数的显式公式。\n\n### 优化过程\n\n任务是找到最优副本数 $N_{\\mathrm{opt}}$，使其在偏差 $\\delta(N)$ 的约束下最大化加速比 $S(N)$。\n\n**1. 约束优化问题**\n我们必须找到解决以下问题的 $N_{\\mathrm{opt}}$：\n$$\n\\begin{aligned}\n \\underset{N}{\\text{maximize}}\n   S(N) \\\\\n \\text{subject to}\n   \\delta(N) \\le \\epsilon_{\\mathrm{tol}} \\\\\n    N \\in \\{1, 2, \\dots, N_{\\max}\\}\n\\end{aligned}\n$$\n在最大加速比值出现平局的情况下，应选择最小的 $N$。\n\n**2. 算法**\n\n对于每个给定的参数集，执行以下算法：\n\n1.  **确定可行的副本数**：遍历从 $1$ 到 $N_{\\max}$ 的每个整数 $N$。对于每个 $N$，计算偏差 $\\delta(N) = \\kappa (\\alpha/N + \\beta e^{-\\gamma t_{\\mathrm{deph}}})$。如果 $\\delta(N) \\le \\epsilon_{\\mathrm{tol}}$，则 $N$ 是一个可行的候选值。将所有这样的可行 $N$ 收集到一个集合 $\\mathcal{N}_{\\mathrm{feasible}}$ 中。\n\n2.  **处理不可行情况**：如果集合 $\\mathcal{N}_{\\mathrm{feasible}}$ 为空，则意味着在 $N_{\\max}$ 以内的任何副本数都不能满足误差容限。在这种情况下：\n    -   $N_{\\mathrm{opt}}$ 设置为 $-1$。\n    -   相应的加速比 $S_{\\mathrm{opt}}$ 设置为 $0.0$。\n    -   报告的偏差 $\\delta_{\\mathrm{opt}}$ 是搜索范围内的最小可实现偏差，由于 $\\delta(N)$ 是 $N$ 的单调递减函数，该最小值在 $N = N_{\\max}$ 处取得。因此，$\\delta_{\\mathrm{opt}} = \\delta(N_{\\max})$。\n\n3.  **处理可行情况**：如果 $\\mathcal{N}_{\\mathrm{feasible}}$ 不为空，则按升序遍历每个 $N \\in \\mathcal{N}_{\\mathrm{feasible}}$。\n    -   对于每个可行的 $N$，使用上面推导的公式计算加速比 $S(N)$。\n    -   跟踪到目前为止找到的最大加速比 $S_{\\max}$ 和相应的副本数 $N_{\\mathrm{best}}$。第一个可行的 $N$ 为 $S_{\\max}$ 和 $N_{\\mathrm{best}}$ 提供初始值。对于后续的可行 $N$，如果其加速比 $S(N)$ 严格大于 $S_{\\max}$，则更新 $S_{\\max} = S(N)$ 和 $N_{\\mathrm{best}} = N$。严格不等式和升序迭代确保在出现平局时选择最小的 $N$。\n    -   检查完所有可行的 $N$ 后，最优值为 $N_{\\mathrm{opt}} = N_{\\mathrm{best}}$，$S_{\\mathrm{opt}} = S(N_{\\mathrm{best}})$ 和 $\\delta_{\\mathrm{opt}} = \\delta(N_{\\mathrm{best}})$。\n\n此过程保证根据问题的标准找到最优的 $N$。然后按要求格式化结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the ParRep optimization problem for a suite of test cases.\n    \"\"\"\n    # Test suite: (lambda, t_corr, t_deph, alpha, beta, gamma, kappa, eps_tol, N_max)\n    test_cases = [\n        (0.05, 1.0, 2.0, 0.5, 0.01, 1.0, 1.0, 0.05, 128),  # Case A\n        (0.05, 1.0, 2.0, 0.5, 0.01, 1.0, 1.0, 0.01, 128),  # Case B\n        (0.2, 5.0, 10.0, 0.2, 0.02, 0.5, 1.5, 0.02, 64),   # Case C\n        (1.0, 0.1, 0.2, 0.05, 0.0, 1.0, 0.5, 0.001, 8),    # Case D\n        (0.01, 0.5, 0.5, 0.5, 0.005, 2.0, 1.0, 0.02, 256),  # Case E\n    ]\n\n    results = []\n    for params in test_cases:\n        result = find_optimal_n(params)\n        results.append(result)\n\n    # Format the final output string as specified\n    output_strings = []\n    for res_tuple in results:\n        N_opt, S_opt, D_opt = res_tuple\n        S_opt_str = f\"{S_opt:.6f}\"\n        D_opt_str = f\"{D_opt:.6f}\"\n        output_strings.append(f\"[{N_opt},{S_opt_str},{D_opt_str}]\")\n\n    # The final print statement must produce only the specified single-line format.\n    print(f\"[{','.join(output_strings)}]\")\n\ndef find_optimal_n(params):\n    \"\"\"\n    For a single set of parameters, finds the optimal N that maximizes speedup\n    under the given error tolerance.\n    \"\"\"\n    lambda_, t_corr, t_deph, alpha, beta, gamma, kappa, eps_tol, N_max = params\n\n    # Pre-calculate the constant part of the error term\n    temporal_error_term = beta * np.exp(-gamma * t_deph)\n\n    def get_delta(N):\n        \"\"\"Calculates the relative bias delta for a given N.\"\"\"\n        return kappa * (alpha / N + temporal_error_term)\n\n    # 1. Identify all feasible N values\n    feasible_N_list = []\n    for N_val in range(1, N_max + 1):\n        if get_delta(N_val) = eps_tol:\n            feasible_N_list.append(N_val)\n\n    # 2. Handle the infeasible case\n    if not feasible_N_list:\n        N_opt = -1\n        S_opt = 0.0\n        # Per problem spec, report minimum achievable bias if infeasible\n        # delta(N) is monotonically decreasing, so min is at N_max\n        min_delta = get_delta(N_max)\n        delta_opt = min_delta\n        return N_opt, S_opt, delta_opt\n\n    # 3. Handle the feasible case: find N that maximizes speedup\n    max_S = -1.0\n    opt_N = -1\n\n    T_serial = 1.0 / lambda_\n\n    for N in feasible_N_list:\n        delta_N = get_delta(N)\n        \n        # Calculate ParRep wall-clock time\n        # The problem constraints on eps_tol ensure 1 - delta_N  0\n        T_parrep = t_corr + t_deph + (1.0 / (N * lambda_)) * (1.0 - delta_N)\n        \n        # Calculate speedup\n        current_S = T_serial / T_parrep\n        \n        # Update if a better speedup is found.\n        # Strict inequality ensures the smallest N is chosen in case of a tie,\n        # as we are iterating N in increasing order.\n        if current_S  max_S:\n            max_S = current_S\n            opt_N = N\n    \n    # Final optimal values\n    N_opt = opt_N\n    S_opt = max_S\n    delta_opt = get_delta(opt_N)\n\n    return N_opt, S_opt, delta_opt\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}