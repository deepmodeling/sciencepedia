{
    "hands_on_practices": [
        {
            "introduction": "并行副本动力学 (Parallel Replica Dynamics) 的有效性取决于系统的一个关键特性：亚稳态 (metastability)。这意味着系统必须表现出明显的时间尺度分离，在进行罕见的跃迁之前，会在一个状态中停留很长时间。第一个实践练习为这个抽象概念提供了坚实的基础。通过分析一个在经典双阱势中的粒子，你将使用克莱默斯速率理论 (Kramers' rate theory) 和谱分析来明确计算逃逸时间与局部弛豫时间之比，从而量化时间尺度的分离，正是这种分离使得 ParRep 成为一种可行的策略。",
            "id": "3791213",
            "problem": "考虑在逆温度 $\\beta$ 下的一维空间中的过阻尼朗之万动力学，其由随机微分方程 $dX_{t}=-V'(X_{t})\\,dt+\\sqrt{2\\beta^{-1}}\\,dW_{t}$ 给出，其中 $W_{t}$ 是标准维纳过程，$V(x)=\\tfrac{1}{4}x^{4}-\\tfrac{1}{2}x^{2}$ 是一个双阱势。在平行副本动力学（ParRep）算法中，该算法依赖于快速的阱内弛豫至准稳态分布与由热激活驱动的稀有阱间穿越之间明确的时间尺度分离。从过阻尼朗之万动力学和吉布斯测度的基本定义出发，并使用物理上合理的关于势垒穿越和局域弛豫的论据，估计在小噪声情况（大 $\\beta$）下，从右侧势阱（$x=1$ 附近）的平均出阱时间与平均阱内弛豫时间之比。您的推导应：\n- 使用与极小值点和鞍点之间的势垒相关的阿伦尼乌斯跨越势垒主导指数，以及在极小值点和鞍点附近的相应谐波（二次）近似来获得主导指前因子。\n- 使用在极小值点附近线性化的福克-普朗克算子的谱隙启发法来估计阱内弛豫速率。\n假设动力学过程初始被限制在 $x=1$ 处的极小值点附近，并且相关的鞍点在 $x=0$ 处。以 $\\beta$ 的函数形式，给出一个单一的闭式解析表达式来表示该比率。将您的最终结果表示为一个无量纲量。不要进行任何数值取整。",
            "solution": "该问题是有效的。它在科学上基于随机动力学和统计力学的原理，特别是通过过阻尼朗之万方程描述的热激活过程理论。该问题是适定的，提供了所有必要信息——势、动力学、所关注的范围以及要使用的具体理论工具——以得出一个唯一的、有意义的解析解。\n\n目标是确定对于在双阱势中受过阻尼朗之万方程支配的粒子，其从势阱中逃逸的平均时间 $\\tau_{\\text{exit}}$ 与阱内弛豫时间 $\\tau_{\\text{relax}}$ 之比。在平行副本（ParRep）动力学的背景下，这个比率是一个关键量，因为其大小证明了该算法所依赖的时间尺度分离假设的合理性。分析将在小噪声极限下进行，这对应于大的逆温度 $\\beta$。\n\n随机微分方程（SDE）由下式给出：\n$$\ndX_{t}=-V'(X_{t})\\,dt+\\sqrt{2\\beta^{-1}}\\,dW_{t}\n$$\n其中势为 $V(x)=\\frac{1}{4}x^{4}-\\frac{1}{2}x^{2}$。\n\n首先，我们对势 $V(x)$ 进行表征。力为 $-V'(x) = -(x^3 - x)$。通过令 $V'(x)=0$ 来找到临界点：\n$$\nV'(x) = x^{3} - x = x(x-1)(x+1) = 0\n$$\n临界点为 $x=0$、$x=1$ 和 $x=-1$。为了对它们进行分类，我们计算二阶导数：\n$$\nV''(x) = 3x^{2} - 1\n$$\n- 在 $x = \\pm 1$ 处，$V''(\\pm 1) = 3(1)^{2} - 1 = 2  0$。这些是稳定极小值点。在极小值点处的势值为 $V(\\pm 1) = \\frac{1}{4}(\\pm 1)^{4} - \\frac{1}{2}(\\pm 1)^{2} = \\frac{1}{4} - \\frac{1}{2} = -\\frac{1}{4}$。\n- 在 $x=0$ 处，$V''(0) = 3(0)^{2} - 1 = -1  0$。这是一个局部极大值点，代表了两个势阱之间的一个鞍点。在鞍点处的势值为 $V(0) = 0$。\n\n问题指明，粒子从右侧势阱开始，靠近 $x_{\\text{min}}=1$ 处的极小值点，而逃逸的相关鞍点位于 $x_{\\text{sad}}=0$。此跃迁的势能垒为：\n$$\n\\Delta V = V(x_{\\text{sad}}) - V(x_{\\text{min}}) = V(0) - V(1) = 0 - \\left(-\\frac{1}{4}\\right) = \\frac{1}{4}\n$$\n\n接下来，我们计算平均出阱时间 $\\tau_{\\text{exit}}$。在大 $\\beta$ 情况下，平均出阱时间由 Kramers 速率理论决定。对于具有单位摩擦（如 SDE 所暗示）的一维过阻尼动力学，从势阱极小值点 $x_{\\text{min}}$ 越过鞍点 $x_{\\text{sad}}$ 的平均出阱时间由带有谐波指前因子的阿伦尼乌斯公式给出：\n$$\n\\tau_{\\text{exit}} = \\frac{2\\pi}{\\sqrt{V''(x_{\\text{min}})|V''(x_{\\text{sad}})|}} \\exp(\\beta \\Delta V)\n$$\n我们有必要的组成部分：\n- $V''(x_{\\text{min}}) = V''(1) = 2$。\n- $|V''(x_{\\text{sad}})| = |V''(0)| = |-1| = 1$。\n- $\\Delta V = \\frac{1}{4}$。\n\n将这些值代入 $\\tau_{\\text{exit}}$ 的公式中：\n$$\n\\tau_{\\text{exit}} = \\frac{2\\pi}{\\sqrt{2 \\cdot 1}} \\exp\\left(\\beta \\cdot \\frac{1}{4}\\right) = \\frac{2\\pi}{\\sqrt{2}} \\exp\\left(\\frac{\\beta}{4}\\right) = \\sqrt{2}\\pi \\exp\\left(\\frac{\\beta}{4}\\right)\n$$\n\n现在，我们估计阱内弛豫时间 $\\tau_{\\text{relax}}$。问题指示我们使用在极小值点附近线性化的福克-普朗克算子的谱隙启发法。在极小值点 $x_{\\text{min}}=1$ 附近，势可以近似为一个谐波势：\n$$\nV(x) \\approx V(x_{\\text{min}}) + \\frac{1}{2}V''(x_{\\text{min}})(x-x_{\\text{min}})^{2}\n$$\n相应的线性化 SDE 描述了偏差 $y(t) = X(t) - x_{\\text{min}}$ 的一个奥恩斯坦-乌伦贝克（OU）过程：\n$$\ndY_{t} = -V''(x_{\\text{min}}) Y_{t}\\,dt + \\sqrt{2\\beta^{-1}}\\,dW_{t}\n$$\n阱内动力学在一个由该 OU 过程速率决定的时间尺度上弛豫至一个准稳态分布（局部平衡）。弛豫时间是相关福克-普朗克算子谱隙的倒数。对于漂移系数为 $-\\kappa y$（其中 $\\kappa = V''(x_{\\text{min}})$）的 OU 过程，负算子的本征值由 $\\{n\\kappa\\}_{n=0}^{\\infty}$ 给出。谱隙是第一个非零本征值，即 $\\lambda_{1} = \\kappa$。\n\n因此，弛豫速率等于势在极小值点处的曲率：\n$$\n\\lambda_{\\text{relax}} = V''(x_{\\text{min}})\n$$\n弛豫时间是该速率的倒数：\n$$\n\\tau_{\\text{relax}} = \\frac{1}{\\lambda_{\\text{relax}}} = \\frac{1}{V''(x_{\\text{min}})}\n$$\n使用我们的值 $V''(1)=2$：\n$$\n\\tau_{\\text{relax}} = \\frac{1}{2}\n$$\n\n最后，我们计算平均出阱时间与阱内弛豫时间之比：\n$$\n\\frac{\\tau_{\\text{exit}}}{\\tau_{\\text{relax}}} = \\frac{\\sqrt{2}\\pi \\exp\\left(\\frac{\\beta}{4}\\right)}{\\frac{1}{2}} = 2\\sqrt{2}\\pi \\exp\\left(\\frac{\\beta}{4}\\right)\n$$\n这个无量纲量表明，时间尺度的比率随 $\\beta$ 呈指数增长，这证实了在低温情况下 ParRep 算法的有效性和效率所需的时间尺度分离。",
            "answer": "$$\\boxed{2\\sqrt{2}\\pi\\exp\\left(\\frac{\\beta}{4}\\right)}$$"
        },
        {
            "introduction": "一旦确定了亚稳态，下一步就是理解 ParRep 如何实现其显著的加速效果。对于 $N$ 个副本，理想的 $N$ 倍加速是从准静态分布 (Quasi-Stationary Distribution, QSD) 中逃逸事件的无记忆特性的直接结果。本练习深入探讨了这种加速的数学核心，要求你推导出理想指数分布情况下的加速比，然后探索当逃逸时间分布为非指数（韦伯分布），即模型偏离完美 QSD 假设时，这种线性加速规律是如何被打破的。",
            "id": "3791178",
            "problem": "考虑一个在亚稳态集 $\\mathcal{S}$ 中演化的连续时间马尔可夫过程，并令单个轨迹从 $\\mathcal{S}$ 逃离的时间为非负随机变量 $T$。在并行副本 (ParRep) 动力学算法中，经过一个旨在强制实现准静态分布 (QSD) 的去相关和去相位阶段后，会启动 $N$ 个独立的副本，每个副本的逃离时间为 $T_{i}$，算法使用最小逃离时间 $T_{\\min} = \\min\\{T_{1},\\dots,T_{N}\\}$ 来加速采样。假设这些副本是独立同分布的 (IID)，且 $T$ 的生存函数为 $S(t) = \\mathbb{P}(Tt)$。\n\n从适用于亚稳态逃离问题和顺序统计量的基本定义出发，推导在以下两种情况下，期望加速比 $\\mathbb{E}[T]/\\mathbb{E}[T_{\\min}]$ 作为 $N$ 的函数的解析表达式：\n\n1. 在QSD假设下，逃离时间服从速率参数为 $\\lambda0$ 的指数分布，即 $S(t) = \\exp(-\\lambda t)$。\n2. 当不满足QSD假设且逃离时间非指数分布时，用形状参数为 $k0$、尺度参数为 $1/\\lambda0$ 的威布尔分布来建模逃离时间，即 $S(t) = \\exp\\!\\big(-(\\lambda t)^{k}\\big)$。\n\n基于第一性原理简要解释，为什么偏离QSD假设会导致ParRep中的加速偏离线性加速定律。你的最终答案必须是 $\\mathbb{E}[T]/\\mathbb{E}[T_{\\min}]$ 关于 $N$（以及在适用时关于 $k$）的闭式解析表达式。不需要进行数值四舍五入，这个无量纲比率不涉及任何物理单位。",
            "solution": "问题要求计算并行副本 (ParRep) 动力学算法的期望加速比，定义为比率 $\\mathbb{E}[T]/\\mathbb{E}[T_{\\min}]$，这需要在两种关于单个副本逃离时间 $T$ 分布的不同假设下进行。这里，$T_1, \\dots, T_N$ 是 $N$ 个独立同分布 (IID) 副本的逃离时间，而 $T_{\\min} = \\min\\{T_1, \\dots, T_N\\}$ 是算法中观测到的逃离时间。\n\n概率论的一个基本结果表明，对于任何具有生存函数 $S_X(x) = \\mathbb{P}(X  x)$ 的非负随机变量 $X$，其期望值由生存函数的积分给出：\n$$\n\\mathbb{E}[X] = \\int_{0}^{\\infty} S_X(x) \\, dx\n$$\n单个副本逃离时间 $T$ 的生存函数给定为 $S(t) = \\mathbb{P}(T  t)$。$T_{\\min}$ 的生存函数，记为 $S_{\\min}(t)$，可以从IID假设中推导出来。事件 $T_{\\min}  t$ 等价于所有单个副本的逃离时间都大于 $t$ 的事件。\n$$\nS_{\\min}(t) = \\mathbb{P}(T_{\\min}  t) = \\mathbb{P}(T_1  t, T_2  t, \\dots, T_N  t)\n$$\n由于副本的独立性，联合概率是各个概率的乘积：\n$$\nS_{\\min}(t) = \\prod_{i=1}^{N} \\mathbb{P}(T_i  t)\n$$\n由于副本是同分布的，对所有 $i$ 都有 $\\mathbb{P}(T_i  t) = S(t)$。因此，\n$$\nS_{\\min}(t) = [S(t)]^N\n$$\n因此，期望加速比可以写成两个积分的比值：\n$$\n\\frac{\\mathbb{E}[T]}{\\mathbb{E}[T_{\\min}]} = \\frac{\\int_{0}^{\\infty} S(t) \\, dt}{\\int_{0}^{\\infty} S_{\\min}(t) \\, dt} = \\frac{\\int_{0}^{\\infty} S(t) \\, dt}{\\int_{0}^{\\infty} [S(t)]^N \\, dt}\n$$\n我们现在将此通用公式应用于两种指定情况。\n\n情况1：指数分布（QSD假设）\n在准静态分布 (QSD) 假设下，逃离时间 $T$ 服从速率参数为 $\\lambda  0$ 的指数分布。生存函数为：\n$$\nS(t) = \\exp(-\\lambda t)\n$$\n单个副本的期望逃离时间为：\n$$\n\\mathbb{E}[T] = \\int_{0}^{\\infty} \\exp(-\\lambda t) \\, dt = \\left[ -\\frac{1}{\\lambda} \\exp(-\\lambda t) \\right]_{0}^{\\infty} = 0 - \\left(-\\frac{1}{\\lambda}\\right) = \\frac{1}{\\lambda}\n$$\n$N$ 个副本中最小逃离时间的生存函数为：\n$$\nS_{\\min}(t) = [S(t)]^N = [\\exp(-\\lambda t)]^N = \\exp(-N\\lambda t)\n$$\n这表明 $T_{\\min}$ 也服从指数分布，但其有效速率参数为 $N\\lambda$。期望的最小逃离时间为：\n$$\n\\mathbb{E}[T_{\\min}] = \\int_{0}^{\\infty} \\exp(-N\\lambda t) \\, dt = \\left[ -\\frac{1}{N\\lambda} \\exp(-N\\lambda t) \\right]_{0}^{\\infty} = \\frac{1}{N\\lambda}\n$$\n期望加速比是这些期望值的比率：\n$$\n\\frac{\\mathbb{E}[T]}{\\mathbb{E}[T_{\\min}]} = \\frac{1/\\lambda}{1/(N\\lambda)} = N\n$$\n这是在QSD假设下，ParRep著名的线性加速结果。\n\n情况2：威布尔分布（偏离QSD）\n当不满足QSD假设时，逃离时间由形状参数为 $k0$、尺度参数为 $1/\\lambda  0$ 的威布尔分布建模。生存函数为：\n$$\nS(t) = \\exp(-(\\lambda t)^k)\n$$\n为了求期望值 $\\mathbb{E}[T]$，我们对 $S(t)$ 进行积分：\n$$\n\\mathbb{E}[T] = \\int_{0}^{\\infty} \\exp(-(\\lambda t)^k) \\, dt\n$$\n我们进行变量替换。令 $u = (\\lambda t)^k$。则 $t = \\frac{u^{1/k}}{\\lambda}$，且 $dt = \\frac{1}{\\lambda k} u^{1/k - 1} \\, du$。\n$$\n\\mathbb{E}[T] = \\int_{0}^{\\infty} \\exp(-u) \\left( \\frac{1}{\\lambda k} u^{1/k - 1} \\right) \\, du = \\frac{1}{\\lambda k} \\int_{0}^{\\infty} u^{1/k - 1} \\exp(-u) \\, du\n$$\n该积分是伽马函数的定义，$\\Gamma(z) = \\int_0^\\infty x^{z-1}\\exp(-x)dx$。这里，$z = 1/k$。\n$$\n\\mathbb{E}[T] = \\frac{1}{\\lambda k} \\Gamma(1/k)\n$$\n利用性质 $\\Gamma(z+1) = z\\Gamma(z)$，这可以写成：\n$$\n\\mathbb{E}[T] = \\frac{1}{\\lambda} \\Gamma\\left(1 + \\frac{1}{k}\\right)\n$$\n现在，我们求 $T_{\\min}$ 的期望。其生存函数为：\n$$\nS_{\\min}(t) = [S(t)]^N = [\\exp(-(\\lambda t)^k)]^N = \\exp(-N(\\lambda t)^k) = \\exp(-(N^{1/k} \\lambda t)^k)\n$$\n这表明 $T_{\\min}$ 也服从威布尔分布，具有相同的形状参数 $k$，但新的有效速率参数为 $\\lambda' = N^{1/k}\\lambda$。我们可以通过在 $\\mathbb{E}[T]$ 的表达式中用 $\\lambda'$ 替换 $\\lambda$ 来求其期望值：\n$$\n\\mathbb{E}[T_{\\min}] = \\frac{1}{\\lambda'} \\Gamma\\left(1 + \\frac{1}{k}\\right) = \\frac{1}{N^{1/k}\\lambda} \\Gamma\\left(1 + \\frac{1}{k}\\right)\n$$\n期望加速比是其比率：\n$$\n\\frac{\\mathbb{E}[T]}{\\mathbb{E}[T_{\\min}]} = \\frac{\\frac{1}{\\lambda} \\Gamma\\left(1 + \\frac{1}{k}\\right)}{\\frac{1}{N^{1/k}\\lambda} \\Gamma\\left(1 + \\frac{1}{k}\\right)} = N^{1/k}\n$$\n\n关于偏离线性加速的解释：\nQSD假设意味着逃离过程是无记忆的。这是指数分布的特征，其风险率 $\\lambda(t) = f(t)/S(t)$ 是恒定的（$\\lambda(t) = \\lambda$）。对于一个无记忆过程，在小时间间隔内发生事件的概率与系统已经等待了多长时间无关。将 $N$ 个这样的过程并行化，会得到一个 $N\\lambda$ 的总恒定风险率，这直接导致平均逃离时间减少 $N$ 倍，从而产生 $N$ 的线性加速比。\n\n当不满足QSD时，如用 $k \\ne 1$ 的威布尔分布建模，过程就具有记忆性。威布尔分布的风险率是时间依赖的：$\\lambda(t) = k\\lambda^k t^{k-1}$。\n- 对于 $k  1$，风险率随时间增加。这描述了一个系统，其持续时间越长，逃离的可能性就越大（老化）。并行加速比为 $N^{1/k}$，这是次线性的，因为 $1/k  1$。并行化的好处被削弱了，因为所有副本都要在初始的、低逃离概率的阶段花费时间，然后才有一个副本达到具有较高逃离率的状态。\n- 对于 $0  k  1$，风险率随时间减少。这描述了一个系统，它有非常高的概率从初始瞬态快速逃离，如果它能存活过这个初始阶段，系统会变得更加稳定。加速比为 $N^{1/k}$，这是超线性的，因为 $1/k  1$。在这种情况下，ParRep非常有效，因为有 $N$ 个副本，很可能至少有一个会在初始的高风险阶段找到快速逃离路径，从而显著缩短观测时间。\n\n总而言之，对无记忆过程的恒定风险率的偏离，打破了平均逃离时间的简单缩放关系，导致加速比偏离线性定律，并依赖于系统“记忆”的性质，这种性质由形状参数 $k$ 捕获。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} N \\\\ N^{1/k} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论给出了理想的性能，但实践中则需要在各种因素之间进行权衡。使用更多的副本 ($N$) 可以改善统计特性，但会引入开销，并且可能受到我们准备初始状态能力的限制。最后一个实践练习进入了计算实验设计与优化的领域。你将建立一个模型，捕捉并行化带来的加速与不完美去相位 (dephasing) 引入的误差之间的权衡关系，然后利用这个模型来确定在给定误差容限下能最大化性能的最佳副本数。",
            "id": "3791212",
            "problem": "考虑一个在亚稳阱中演化的连续时间马尔可夫过程 $X_t$，其从该阱中的逃离时间为 $\\tau$。当从准稳态分布 (QSD) 初始化时，一个经过充分验证的事实是，$\\tau$ 服从速率为 $\\lambda$ (单位 $\\mathrm{s}^{-1}$) 的指数分布，因此串行期望逃离时间为 $\\mathbb{E}[\\tau]=1/\\lambda$ (单位 $\\mathrm{s}$)。并行副本 (ParRep) 算法使用 $N$ 个独立副本以加速逃离：在理想退相干（精确的 QSD 采样）情况下，$N$ 个速率为 $\\lambda$ 的指数逃离时间中的最小值服从速率为 $N\\lambda$ 的指数分布，这是指数随机变量的一个标准结论。在实践中，退相干并不完美。假设在去相关和退相干阶段之后，相对于 QSD 的初始化误差受一个全变分误差 $\\varepsilon(N)$ 的限制，并且由此产生的平均逃离时间的相对偏差与此误差成正比：存在一个比例因子 $\\kappa0$，使得相对偏差的幅度满足 $|\\delta(N)| \\le \\kappa\\,\\varepsilon(N)$。假设一个保守模型，在计算中使用上界 $\\delta(N)=\\kappa\\,\\varepsilon(N)$。设去相关持续时间为 $t_{\\mathrm{corr}}$ (单位 $\\mathrm{s}$)，退相干持续时间为 $t_{\\mathrm{deph}}$ (单位 $\\mathrm{s}$)。假设使用理想的并行硬件，因此去相关和退相干阶段在挂钟时间上是累加的，并且并行逃离阶段由 $N$ 个副本并行进行。\n\n您将设计一个计算实验，对于每个给定的参数集，改变 $N\\in\\{1,2,\\dots,N_{\\max}\\}$ 并测量有效加速比与误差之间的权衡，以在固定的误差容限下确定一个最优的 $N$。请使用以下建模选择，这些选择在并行副本动力学分析中被广泛用作一阶近似，并且是科学合理的：\n- 串行期望逃离时间为 $\\mathbb{E}[\\tau]=1/\\lambda$ (单位 $\\mathrm{s}$)。\n- 在理想退相干下，具有 $N$ 个副本的并行阶段的逃离时间服从速率为 $N\\lambda$ 的指数分布；因此，其平均值为 $1/(N\\lambda)$ (单位 $\\mathrm{s}$)。\n- 在具有相对偏差 $\\delta(N)$（根据保守界限为非负）的不完美退相干下，并行阶段的平均逃离时间相对于理想情况按因子 $1-\\delta(N)$ 缩放。\n- 退相干误差根据粒子数和时间效应的组合进行衰减：\n$$\n\\varepsilon(N) \\;=\\; \\frac{\\alpha}{N} \\;+\\; \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}},\n$$\n其中 $\\alpha0$ 是一个粒子数常数，$\\beta\\ge 0$ 和 $\\gamma0$ 控制退相干的时间弛豫，且 $t_{\\mathrm{deph}}0$ 对每种情况都是固定的。总的相对偏差界限为 $\\delta(N)=\\kappa\\,\\varepsilon(N)$，其中 $\\kappa0$。\n- 一个 ParRep 周期的期望挂钟时间（单位 $\\mathrm{s}$）包括去相关时间、退相干时间以及在 $N$ 个核心上并行执行的并行逃离阶段的期望时间。\n- 有效加速比定义为串行期望时间与 ParRep 期望挂钟时间之比。\n\n您的任务：\n- 从 QSD 的标准指数逃离时间属性、独立副本的指数最小值事实以及上述误差模型出发，推导期望 ParRep 挂钟时间作为 $N$ 的函数以及相应加速比的显式公式。所有时间以 $\\mathrm{s}$ 表示，所有速率以 $\\mathrm{s}^{-1}$ 表示。您的推导必须仅依赖于所提供的基本事实和定义。\n- 在固定的相对误差容限 $\\epsilon_{\\mathrm{tol}}0$ 下，强制要求 $\\delta(N)\\le \\epsilon_{\\mathrm{tol}}$。在满足此约束的所有整数 $N\\in\\{1,2,\\dots,N_{\\max}\\}$ 中，选择使加速比最大化的 $N$。如果在数值精度内加速比出现平局，选择最小的那个 $N$。\n- 如果没有 $N\\in\\{1,2,\\dots,N_{\\max}\\}$ 满足 $\\delta(N)\\le \\epsilon_{\\mathrm{tol}}$，则宣布该情况下的问题无解，并返回一个哨兵选择 $N_{\\mathrm{opt}}=-1$，加速比为 $0.0$，同时报告可实现的最小偏差值 $\\min_{1\\le N\\le N_{\\max}}\\delta(N)$（无量纲），以量化最佳 $N$ 与容限的接近程度。\n\n每个测试用例的所需输出：\n- $N_{\\mathrm{opt}}$ (一个整数)。\n- $S_{\\mathrm{opt}}$ (一个浮点数)，在 $N_{\\mathrm{opt}}$ 处实现的最大加速比。\n- $\\delta_{\\mathrm{opt}}$ (一个浮点数)，在 $N_{\\mathrm{opt}}$ 处的偏差界限；如果无解，则报告 $\\min_{1\\le N\\le N_{\\max}}\\delta(N)$。\n\n数值和格式要求：\n- 将 $S_{\\mathrm{opt}}$ 和 $\\delta_{\\mathrm{opt}}$ 报告为小数（而非百分比），每个都四舍五入到 $6$ 位小数。\n- 程序应生成单行输出，其中包含所有测试用例的结果，格式为逗号分隔的列表的列表，例如 $[\\,[N_1,S_1,\\delta_1],\\,[N_2,S_2,\\delta_2]\\,]$。\n- 所有物理时间必须以 $\\mathrm{s}$ 为单位，所有速率必须以 $\\mathrm{s}^{-1}$ 为单位。\n\n测试套件 (每个元组列出 $(\\lambda, t_{\\mathrm{corr}}, t_{\\mathrm{deph}}, \\alpha, \\beta, \\gamma, \\kappa, \\epsilon_{\\mathrm{tol}}, N_{\\max})$):\n- Case A: $(0.05, 1.0, 2.0, 0.5, 0.01, 1.0, 1.0, 0.05, 128)$.\n- Case B: $(0.05, 1.0, 2.0, 0.5, 0.01, 1.0, 1.0, 0.01, 128)$.\n- Case C: $(0.2, 5.0, 10.0, 0.2, 0.02, 0.5, 1.5, 0.02, 64)$.\n- Case D: $(1.0, 0.1, 0.2, 0.05, 0.0, 1.0, 0.5, 0.001, 8)$.\n- Case E: $(0.01, 0.5, 0.5, 0.5, 0.005, 2.0, 1.0, 0.02, 256)$.\n\n您的程序应实现该推导，对每个测试用例评估所有 $N\\in\\{1,\\dots,N_{\\max}\\}$，并输出包含 5 个结果列表的单行，格式为 $[\\,[N_{\\mathrm{opt}},S_{\\mathrm{opt}},\\delta_{\\mathrm{opt}}],\\dots]$，浮点数按要求四舍五入到 6 位小数。",
            "solution": "该问题被验证为具有科学依据、提法明确、客观和完整。所有提供的模型和参数在多尺度建模领域内是标准的，并且适合所要求的分析。\n\n### ParRep 挂钟时间和加速比的推导\n\n目标是推导期望 ParRep 挂钟时间 $T_{\\mathrm{ParRep}}(N)$ 和相应的有效加速比 $S(N)$ 作为副本数量 $N$ 的函数的显式公式。\n\n**1. 串行期望时间**\n\n串行过程对应于等待逃离事件的系统的单次模拟。如所给，从准稳态分布 (QSD) 的逃离时间 $\\tau$ 服从速率为 $\\lambda$ 的指数分布。串行期望逃离时间 $T_{\\mathrm{serial}}$ 是该分布的平均值：\n$$\nT_{\\mathrm{serial}} = \\mathbb{E}[\\tau] = \\frac{1}{\\lambda}\n$$\n\n**2. ParRep 期望挂钟时间**\n\nParRep 算法周期在挂钟时间上由三个可加的阶段组成：去相关、退相干和并行逃离。\n\n一个周期的期望挂钟时间 $T_{\\mathrm{ParRep}}(N)$ 是这些阶段持续时间的总和：\n$$\nT_{\\mathrm{ParRep}}(N) = t_{\\mathrm{corr}} + t_{\\mathrm{deph}} + T_{\\mathrm{escape}}(N)\n$$\n其中 $t_{\\mathrm{corr}}$ 是去相关时间，$t_{\\mathrm{deph}}$ 是退相干时间，而 $T_{\\mathrm{escape}}(N)$ 是并行逃离阶段的期望挂钟时间。\n\n并行逃离阶段同时运行 $N$ 个独立的副本。\n-   在理想退相干下，每个副本都从精确的 QSD 初始化。$N$ 个副本中首次逃离的时间是 $N$ 个独立同分布的指数随机变量（每个速率为 $\\lambda$）的最小值。这个最小值本身是一个速率为 $N\\lambda$ 的指数随机变量。因此其期望值为 $1/(N\\lambda)$。\n-   问题指出，在不完美退相干下，平均逃离时间按因子 $1 - \\delta(N)$ 缩放，其中 $\\delta(N)$ 是相对偏差。保守模型假设 $\\delta(N) \\ge 0$。因此，期望逃离时间为：\n    $$\n    T_{\\mathrm{escape}}(N) = \\frac{1}{N\\lambda} \\left( 1 - \\delta(N) \\right)\n    $$\n\n相对偏差 $\\delta(N)$ 被建模为与全变分误差 $\\varepsilon(N)$ 成正比，比例常数为 $\\kappa$：\n$$\n\\delta(N) = \\kappa\\,\\varepsilon(N)\n$$\n退相干误差 $\\varepsilon(N)$ 由以下模型给出：\n$$\n\\varepsilon(N) = \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}}\n$$\n代入这些表达式，我们得到 $\\delta(N)$ 的完整公式：\n$$\n\\delta(N) = \\kappa \\left( \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}} \\right)\n$$\n现在，将 $T_{\\mathrm{escape}}(N)$ 和 $\\delta(N)$ 的表达式代回到 $T_{\\mathrm{ParRep}}(N)$ 的方程中：\n$$\nT_{\\mathrm{ParRep}}(N) = t_{\\mathrm{corr}} + t_{\\mathrm{deph}} + \\frac{1}{N\\lambda} \\left[ 1 - \\kappa \\left( \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}} \\right) \\right]\n$$\n这就是期望 ParRep 挂钟时间的显式公式。\n\n**3. 有效加速比**\n\n有效加速比 $S(N)$ 定义为串行期望时间与 ParRep 期望挂钟时间之比：\n$$\nS(N) = \\frac{T_{\\mathrm{serial}}}{T_{\\mathrm{ParRep}}(N)}\n$$\n代入推导出的 $T_{\\mathrm{serial}}$ 和 $T_{\\mathrm{ParRep}}(N)$ 的表达式：\n$$\nS(N) = \\frac{1/\\lambda}{t_{\\mathrm{corr}} + t_{\\mathrm{deph}} + \\frac{1}{N\\lambda} \\left[ 1 - \\kappa \\left( \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}} \\right) \\right]}\n$$\n这可以重写为：\n$$\nS(N) = \\frac{1}{\\lambda(t_{\\mathrm{corr}} + t_{\\mathrm{deph}}) + \\frac{1}{N}\\left[ 1 - \\kappa \\left( \\frac{\\alpha}{N} + \\beta\\,e^{-\\gamma\\,t_{\\mathrm{deph}}} \\right) \\right]}\n$$\n这就是有效加速比作为 $N$ 的函数的显式公式。\n\n### 优化过程\n\n任务是找到最优副本数 $N_{\\mathrm{opt}}$，它在偏差 $\\delta(N)$ 的约束下最大化加速比 $S(N)$。\n\n**1. 约束优化问题**\n我们必须找到解出以下问题的 $N_{\\mathrm{opt}}$：\n$$\n\\begin{aligned}\n \\underset{N}{\\text{最大化}}\n  S(N) \\\\\n \\text{约束条件}\n  \\delta(N) \\le \\epsilon_{\\mathrm{tol}} \\\\\n   N \\in \\{1, 2, \\dots, N_{\\max}\\}\n\\end{aligned}\n$$\n如果最大加速比的值出现平局，则选择最小的 $N$。\n\n**2. 算法**\n\n对于每个给定的参数集，执行以下算法：\n\n1.  **识别可行副本数**：遍历从 $1$ 到 $N_{\\max}$ 的每个整数 $N$。对于每个 $N$，计算偏差 $\\delta(N) = \\kappa (\\alpha/N + \\beta e^{-\\gamma t_{\\mathrm{deph}}})$。如果 $\\delta(N) \\le \\epsilon_{\\mathrm{tol}}$，则 $N$ 是一个可行的候选项。将所有这样的可行 $N$ 收集到一个集合 $\\mathcal{N}_{\\mathrm{feasible}}$ 中。\n\n2.  **处理无解情况**：如果集合 $\\mathcal{N}_{\\mathrm{feasible}}$ 为空，这意味着在 $N_{\\max}$ 以内的副本数量都不能满足误差容限。在这种情况下：\n    -   $N_{\\mathrm{opt}}$ 被设为 $-1$。\n    -   相应的加速比 $S_{\\mathrm{opt}}$ 被设为 $0.0$。\n    -   报告的偏差 $\\delta_{\\mathrm{opt}}$ 是搜索范围内的最小可实现偏差，该偏差出现在 $N = N_{\\max}$ 处，因为 $\\delta(N)$ 是 $N$ 的单调递减函数。因此，$\\delta_{\\mathrm{opt}} = \\delta(N_{\\max})$。\n\n3.  **处理有解情况**：如果 $\\mathcal{N}_{\\mathrm{feasible}}$ 不为空，则按升序遍历每个 $N \\in \\mathcal{N}_{\\mathrm{feasible}}$。\n    -   对于每个可行的 $N$，使用上面推导的公式计算加速比 $S(N)$。\n    -   跟踪迄今为止发现的最大加速比 $S_{\\max}$ 和相应的副本数 $N_{\\mathrm{best}}$。第一个可行的 $N$ 为 $S_{\\max}$ 和 $N_{\\mathrm{best}}$ 提供初始值。对于后续的可行 $N$，如果其加速比 $S(N)$ 严格大于 $S_{\\max}$，则更新 $S_{\\max} = S(N)$ 和 $N_{\\mathrm{best}} = N$。严格不等式和升序迭代确保在出现平局时选择最小的 $N$。\n    -   检查完所有可行的 $N$ 后，最优值为 $N_{\\mathrm{opt}} = N_{\\mathrm{best}}$、$S_{\\mathrm{opt}} = S(N_{\\mathrm{best}})$ 和 $\\delta_{\\mathrm{opt}} = \\delta(N_{\\mathrm{best}})$。\n\n此过程保证了根据问题的标准找到最优的 $N$。然后按要求格式化结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the ParRep optimization problem for a suite of test cases.\n    \"\"\"\n    # Test suite: (lambda, t_corr, t_deph, alpha, beta, gamma, kappa, eps_tol, N_max)\n    test_cases = [\n        (0.05, 1.0, 2.0, 0.5, 0.01, 1.0, 1.0, 0.05, 128),  # Case A\n        (0.05, 1.0, 2.0, 0.5, 0.01, 1.0, 1.0, 0.01, 128),  # Case B\n        (0.2, 5.0, 10.0, 0.2, 0.02, 0.5, 1.5, 0.02, 64),   # Case C\n        (1.0, 0.1, 0.2, 0.05, 0.0, 1.0, 0.5, 0.001, 8),    # Case D\n        (0.01, 0.5, 0.5, 0.5, 0.005, 2.0, 1.0, 0.02, 256),  # Case E\n    ]\n\n    results = []\n    for params in test_cases:\n        result = find_optimal_n(params)\n        results.append(result)\n\n    # Format the final output string as specified\n    output_strings = []\n    for res_tuple in results:\n        N_opt, S_opt, D_opt = res_tuple\n        S_opt_str = f\"{S_opt:.6f}\"\n        D_opt_str = f\"{D_opt:.6f}\"\n        output_strings.append(f\"[{N_opt},{S_opt_str},{D_opt_str}]\")\n\n    # The final print statement must produce only the specified single-line format.\n    print(f\"[{','.join(output_strings)}]\")\n\ndef find_optimal_n(params):\n    \"\"\"\n    For a single set of parameters, finds the optimal N that maximizes speedup\n    under the given error tolerance.\n    \"\"\"\n    lambda_, t_corr, t_deph, alpha, beta, gamma, kappa, eps_tol, N_max = params\n\n    # Pre-calculate the constant part of the error term\n    temporal_error_term = beta * np.exp(-gamma * t_deph)\n\n    def get_delta(N):\n        \"\"\"Calculates the relative bias delta for a given N.\"\"\"\n        return kappa * (alpha / N + temporal_error_term)\n\n    # 1. Identify all feasible N values\n    feasible_N_list = []\n    for N_val in range(1, N_max + 1):\n        if get_delta(N_val) = eps_tol:\n            feasible_N_list.append(N_val)\n\n    # 2. Handle the infeasible case\n    if not feasible_N_list:\n        N_opt = -1\n        S_opt = 0.0\n        # Per problem spec, report minimum achievable bias if infeasible\n        # delta(N) is monotonically decreasing, so min is at N_max\n        min_delta = get_delta(N_max)\n        delta_opt = min_delta\n        return N_opt, S_opt, delta_opt\n\n    # 3. Handle the feasible case: find N that maximizes speedup\n    max_S = -1.0\n    opt_N = -1\n\n    T_serial = 1.0 / lambda_\n\n    for N in feasible_N_list:\n        delta_N = get_delta(N)\n        \n        # Calculate ParRep wall-clock time\n        # The problem constraints on eps_tol ensure 1 - delta_N > 0\n        T_parrep = t_corr + t_deph + (1.0 / (N * lambda_)) * (1.0 - delta_N)\n        \n        # Calculate speedup\n        current_S = T_serial / T_parrep\n        \n        # Update if a better speedup is found.\n        # Strict inequality ensures the smallest N is chosen in case of a tie,\n        # as we are iterating N in increasing order.\n        if current_S > max_S:\n            max_S = current_S\n            opt_N = N\n    \n    # Final optimal values\n    N_opt = opt_N\n    S_opt = max_S\n    delta_opt = get_delta(opt_N)\n\n    return N_opt, S_opt, delta_opt\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}