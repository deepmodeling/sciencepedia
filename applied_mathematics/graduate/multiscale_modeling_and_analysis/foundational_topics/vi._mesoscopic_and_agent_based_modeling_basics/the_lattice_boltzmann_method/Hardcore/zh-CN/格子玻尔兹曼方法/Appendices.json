{
    "hands_on_practices": [
        {
            "introduction": "要将格子玻尔兹曼方法（LBM）应用于实际的流体动力学问题，首要任务是在模型的介观参数与流体的宏观物理属性之间建立联系。本练习将引导你通过Chapman-Enskog展开，从离散的格子玻尔兹曼方程中推导出宏观的Navier-Stokes方程。这个过程不仅揭示了LBM作为流体求解器的理论基础，还将让你掌握如何根据给定的物理运动粘度 $\\nu_{phys}$ 来确定关键的模拟参数——松弛时间 $\\tau$ 。",
            "id": "3971752",
            "problem": "考虑应用于航空航天计算流体动力学（CFD）中三维十九速离散集 $D3Q19$ 上不可压缩流的单松弛时间 Bhatnagar–Gross–Krook (BGK) 格子玻尔兹曼方法 (LBM)。离散速度的构造方式使得迁移过程在每个时间步沿各个离散方向将粒子布居推进一个格子间距，而平衡态的二阶各向同性确保了格子声速的平方 $c_{s}^{2}$ 与 $D3Q19$ 求积格式相符。给定物理运动粘度 $ \\nu_{phys} $（单位为 $L^{2}/T$）、格子间距 $ \\Delta x $（单位为 $L$）和时间步长 $ \\Delta t $（单位为 $T$）。\n\n从带有 BGK 碰撞算子的动理学输运方程、宏观矩的定义以及粘性应力的牛顿本构关系出发，执行 Chapman–Enskog 展开，以在流体动力学极限下为 $D3Q19$ 格子推导出 Navier–Stokes 方程。通过此推导，求出离散模型在由 $ \\Delta x $ 和 $ \\Delta t $ 表征的给定格子上再现目标物理粘度 $ \\nu_{phys} $ 所需的松弛时间 $ \\tau $ 的解析表达式。使用 $D3Q19$ 的值 $ c_{s}^{2} = 1/3 $。将您的最终答案以 $ \\tau $ 的单个闭式表达式形式呈现。\n\n此外，基于相同的推导，确定确保该方法在低马赫数极限下保持耗散性和准确性的关于 $ \\tau $、$ \\Delta x $ 和 $ \\Delta t $ 的主要数值约束。您对约束的评述必须得到从流体动力学极限中出现的标度关系的支持，但最终报告的答案必须仍然是 $ \\tau $ 的单个表达式。不需要进行数值代入。最终答案无需单位。",
            "solution": "该问题被验证为具有科学依据、适定且客观。它展示了计算流体动力学领域一个标准的、非平凡的推导，特别涉及格子玻尔兹曼方法（LBM）。所有前提均符合事实，且提供了全部所需信息。\n\n目标是推导用于 $D3Q19$ 格子的 Bhatnagar–Gross–Krook (BGK) 模型的单松弛时间 $\\tau$ 与物理运动粘度 $\\nu_{phys}$ 之间的关系。这通过 Chapman–Enskog 展开从离散的格子玻尔兹曼方程中恢复宏观 Navier–Stokes 方程来实现。\n\n我们从带有 BGK 碰撞算子的离散格子玻尔兹曼方程（LBE）开始。为清晰起见，我们将首先在格子单位下进行推导，其中格子间距 $\\Delta x = 1$，时间步长 $\\Delta t = 1$。离散粒子速度记为 $\\mathbf{e}_i$，格子速度为 $c=1$。LBE 方程为：\n$$ f_i(\\mathbf{x} + \\mathbf{e}_i, t+1) - f_i(\\mathbf{x}, t) = -\\frac{1}{\\tau} [f_i(\\mathbf{x}, t) - f_i^{eq}(\\mathbf{x}, t)] $$\n其中 $f_i$ 是沿第 $i$ 个方向的粒子分布函数，$\\mathbf{x}$ 和 $t$ 是格子坐标和时间，$\\tau$ 是无量纲松弛时间。对于低马赫数流，平衡分布函数 $f_i^{eq}$ 是宏观速度 $\\mathbf{u}$ 的二阶展开：\n$$ f_i^{eq} = w_i \\rho \\left( 1 + \\frac{\\mathbf{e}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{e}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u}^2}{2c_s^2} \\right) $$\n此处，$w_i$ 是 $D3Q19$ 的格子权重，$\\rho$ 是宏观密度，$c_s$ 是格子声速，给定 $c_s^2 = 1/3$。宏观密度和动量是分布函数的矩：\n$$ \\rho = \\sum_i f_i = \\sum_i f_i^{eq} $$\n$$ \\rho \\mathbf{u} = \\sum_i f_i \\mathbf{e}_i = \\sum_i f_i^{eq} $$\nBGK 碰撞算子守恒质量和动量，这意味着 $\\sum_i (f_i - f_i^{eq}) = 0$ 和 $\\sum_i \\mathbf{e}_i (f_i - f_i^{eq}) = 0$。\n\n为恢复宏观方程，我们进行 Chapman–Enskog 展开。我们引入一个小参数 $\\epsilon$（与 Knudsen 数和 Mach 数成正比），并假设分布函数以及时间和空间导数可以在多尺度下展开：\n- $f_i = f_i^{(0)} + \\epsilon f_i^{(1)} + \\epsilon^2 f_i^{(2)} + \\mathcal{O}(\\epsilon^3)$\n- $\\partial_t = \\epsilon \\partial_{t_1} + \\epsilon^2 \\partial_{t_2}$\n- $\\nabla = \\epsilon \\nabla_1$\n\n我们首先对时间步长（在格子单位下为1）对离散 LBE 进行泰勒展开：\n$$ (\\partial_t + \\mathbf{e}_i \\cdot \\nabla)f_i + \\frac{1}{2}(\\partial_t + \\mathbf{e}_i \\cdot \\nabla)^2 f_i + \\mathcal{O}(\\Delta t^3) = -\\frac{1}{\\tau}(f_i - f_i^{eq}) $$\n按照 Chapman-Enskog 过程的惯例，我们强制要求宏观变量完全由平衡分布函数决定，即 $f_i^{(0)} = f_i^{eq}$，并且非平衡部分对质量和动量的贡献为零：对于 $k \\ge 1$，有 $\\sum_i f_i^{(k)}=0$ 和 $\\sum_i \\mathbf{e}_i f_i^{(k)}=0$。\n\n将多尺度展开式代入泰勒展开的 LBE，并按 $\\epsilon$ 的幂次收集各项：\n\n$\\epsilon^1$ 阶：\n$$ (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(1)} $$\n这给出了一阶非平衡分布的表达式：\n$$ f_i^{(1)} = -\\tau (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha}) f_i^{(0)} $$\n\n$\\epsilon^2$ 阶：\n$$ \\partial_{t_2} f_i^{(0)} + (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(1)} + \\frac{1}{2}(\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\n将 $f_i^{(1)}$ 的表达式代入第二项：\n$$ \\partial_{t_2} f_i^{(0)} - \\tau (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} + \\frac{1}{2}(\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\n简化后得到：\n$$ \\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{1}{2}\\right) (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\n现在，我们对这些标度化后的方程取矩，以求得宏观控制方程。对 $\\mathcal{O}(\\epsilon^1)$ 方程取矩得到可压缩欧拉方程（在第一个时间尺度上的质量和动量守恒）。该尺度下的动量方程为：\n$$ \\partial_{t_1}(\\rho u_\\beta) + \\partial_{1\\alpha} \\Pi_{\\alpha\\beta}^{(0)} = 0 $$\n其中 $\\Pi_{\\alpha\\beta}^{(0)} = \\sum_i e_{i\\alpha}e_{i\\beta} f_i^{(0)} = \\rho u_\\alpha u_\\beta + p \\delta_{\\alpha\\beta}$ 是平衡态动量通量张量，压力 $p = \\rho c_s^2$。\n\n为求得粘性项，我们对 $\\mathcal{O}(\\epsilon^2)$ 方程取一阶矩（乘以 $e_{i\\beta}$ 并对 $i$ 求和）。由于守恒约束，右侧的项 $\\sum_i e_{i\\beta} f_i^{(2)}$ 为零。\n$$ \\sum_i e_{i\\beta} \\left[ \\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{1}{2}\\right) (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} \\right] = 0 $$\n$$ \\partial_{t_2}(\\rho u_\\beta) - \\left(\\tau - \\frac{1}{2}\\right) \\sum_i e_{i\\beta} (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} = 0 $$\n第二项包含粘性贡献。在低马赫数极限下，时间导数是比空间导数更高阶的马赫数项，因此我们近似 $(\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 \\approx (e_{i\\alpha} \\partial_{1\\alpha})^2$。该项变为：\n$$ \\partial_{1\\gamma} \\partial_{1\\delta} \\sum_i e_{i\\beta} e_{i\\gamma} e_{i\\delta} f_i^{(0)} $$\n这是平衡分布三阶矩的导数。对于低马赫数，$\\sum_i e_{i\\beta} e_{i\\gamma} e_{i\\delta} f_i^{(0)} \\approx \\rho c_s^2 (u_\\beta \\delta_{\\gamma\\delta} + u_\\gamma \\delta_{\\beta\\delta} + u_\\delta \\delta_{\\beta\\gamma})$。\n应用导数并假设流体不可压缩（$\\nabla \\cdot \\mathbf{u} = 0$），此项计算结果为 $\\rho c_s^2 \\nabla_1^2 u_\\beta$。因此，在 $\\mathcal{O}(\\epsilon^2)$ 尺度上的动量方程为：\n$$ \\partial_{t_2}(\\rho u_\\beta) = \\left(\\tau - \\frac{1}{2}\\right) \\rho c_s^2 \\nabla_1^2 u_\\beta $$\n结合来自 $\\epsilon^1$ 和 $\\epsilon^2$ 尺度的动量方程，并恢复到物理尺度导数（$\\partial_t, \\nabla$）：\n$$ \\partial_t(\\rho u_\\beta) + \\partial_\\alpha(\\rho u_\\alpha u_\\beta) = -\\partial_\\beta p + \\rho c_s^2 \\left(\\tau - \\frac{1}{2}\\right) \\nabla^2 u_\\beta $$\n这就是不可压缩 Navier–Stokes 方程：\n$$ \\rho(\\partial_t u_\\beta + u_\\alpha \\partial_\\alpha u_\\beta) = -\\partial_\\beta p + \\mu \\nabla^2 u_\\beta $$\n其中 $\\mu$ 是动力粘度。方程两边同除以 $\\rho$ 得到用运动粘度 $\\nu = \\mu/\\rho$ 表示的方程：\n$$ \\partial_t u_\\beta + u_\\alpha \\partial_\\alpha u_\\beta = -\\frac{1}{\\rho}\\partial_\\beta p + \\nu \\nabla^2 u_\\beta $$\n通过比较粘性项，我们确定格子单位下的运动粘度：\n$$ \\nu_{latt} = c_s^2 \\left(\\tau - \\frac{1}{2}\\right) $$\n该表达式关联了格子模拟的无量纲参数。为了求得物理粘度 $\\nu_{phys}$，我们必须引入物理格子间距 $\\Delta x$ 和时间步长 $\\Delta t$。运动粘度的单位是 $[L^2/T]$。从格子单位到物理单位的转换因子是：\n$$ \\nu_{phys} = \\nu_{latt} \\frac{\\Delta x^2}{\\Delta t} $$\n代入 $\\nu_{latt}$ 的表达式和给定值 $c_s^2 = 1/3$：\n$$ \\nu_{phys} = \\frac{1}{3} \\left(\\tau - \\frac{1}{2}\\right) \\frac{\\Delta x^2}{\\Delta t} $$\n求解该方程以得到松弛时间 $\\tau$，即可获得所需表达式：\n$$ 3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} = \\tau - \\frac{1}{2} $$\n$$ \\tau = 3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} + \\frac{1}{2} $$\n\n基于此推导，我们可以确定两个关键约束。\n首先，为使方法在物理上是耗散的且数值稳定，格子粘度必须为正，即 $\\nu_{latt}  0$。由于 $c_s^2  0$，这对松弛时间施加了一个基本约束：\n$$ \\tau  \\frac{1}{2} $$\n其次，Chapman-Enskog 展开仅在流体动力学极限下有效，即平均自由程远小于特征流动长度。在 LBM 中，平均自由程与 $\\nu_{latt} \\propto (\\tau - 1/2)$ 成正比。一个较大的 $\\tau$ 值意味着偏离了这一极限，会导致不准确性。因此，$\\tau$ 必须保持在1的量级，例如 $\\tau  2$。这对网格参数的选择施加了约束：\n$$ \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} = \\frac{1}{3}\\left(\\tau - \\frac{1}{2}\\right) = \\mathcal{O}(1) $$\n这是 LBM 的扩散标度关系，它要求当网格细化（$\\Delta x \\to 0$）时，时间步长必须以平方关系减小（$\\Delta t \\propto \\Delta x^2$）以保持 $\\tau$ 为常数。这必须与对流标度约束（$\\Delta t \\propto \\Delta x$）相平衡，后者是保持低马赫数和控制可压缩性误差所必需的。",
            "answer": "$$\\boxed{3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} + \\frac{1}{2}}$$"
        },
        {
            "introduction": "在计算流体动力学中，边界条件的处理是确保模拟准确性和稳定性的关键，对于格子玻尔兹曼方法尤其如此。本练习聚焦于一个核心的实践挑战：在三维（D3Q19）模型中实现压力（或密度）边界条件 。你将通过实施一种非平衡态外推方案，学习如何重构未知的分布函数，从而在精确施加目标压力的同时，有效抑制边界处产生的非物理反射。",
            "id": "3971753",
            "problem": "实现一个程序，用于在计算流体动力学（CFD）的背景下，为三维十九速格子玻尔兹曼方法（LBM）模板（记为 D3Q19）重建平面入口边界处的未知流后粒子分布函数。该边界位于一个平面上，其外法线沿 $x$ 轴正方向，计算域占据 $x \\ge 0$ 的空间。重建过程必须在格子单位下强制执行类理想气体格子状态方程 $p = c_s^2 \\rho$（其中 $c_s^2 = 1/3$），并且应通过采用非平衡态外推策略来最小化伪反射。\n\n您必须在格子单位下工作，其中 $c = 1$ 且 $c_s^2 = 1/3$。使用 D3Q19 离散速度集 $\\{\\mathbf{e}_i\\}_{i=0}^{18}$ 及其权重 $\\{w_i\\}_{i=0}^{18}$，定义如下：一个静止方向 $\\mathbf{e}_0 = (0,0,0)$，权重 $w_0 = 1/3$；六个轴向方向，满足 $|\\mathbf{e}_i| = 1$，权重 $w_i = 1/18$；以及十二个对角线方向，满足 $|\\mathbf{e}_i| = \\sqrt{2}$，权重 $w_i = 1/36$。每个方向 $i$ 的局部麦克斯韦平衡分布为\n$$\nf_i^{\\mathrm{eq}}(\\rho,\\mathbf{u}) = w_i \\rho \\left[ 1 + \\frac{\\mathbf{e}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{e}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2 c_s^2} \\right],\n$$\n其中 $c_s^2 = 1/3$。宏观密度和速度通过以下公式从分布函数中恢复：\n$$\n\\rho = \\sum_{i=0}^{18} f_i, \\quad \\rho \\mathbf{u} = \\sum_{i=0}^{18} f_i \\mathbf{e}_i.\n$$\n\n在 $x=0$ 处的入口边界节点，经过迁移步骤后，沿 $+\\hat{\\mathbf{x}}$ 方向指向计算域的分布函数是未知的，特别是那些具有 $e_{i,x}  0$ 的分布函数。非平衡态外推策略规定这些未知的分布函数应按如下方式重建：\n$$\nf_i^{\\mathrm{bnd}} = f_i^{\\mathrm{eq}}(\\rho_{\\mathrm{b}}, \\mathbf{u}_{\\mathrm{b}}) + \\left[ f_i^{\\mathrm{int}} - f_i^{\\mathrm{eq}}(\\rho_{\\mathrm{int}}, \\mathbf{u}_{\\mathrm{int}}) \\right], \\quad \\text{for } e_{i,x}  0,\n$$\n其中 $(\\rho_{\\mathrm{b}}, \\mathbf{u}_{\\mathrm{b}})$ 是边界目标宏观场，$(\\rho_{\\mathrm{int}}, \\mathbf{u}_{\\mathrm{int}})$ 是内部邻近节点的宏观场，$f_i^{\\mathrm{int}}$ 是内部邻近节点的分布函数。对于 $e_{i,x} \\le 0$ 的方向，设置 $f_i^{\\mathrm{bnd}} = f_i^{\\mathrm{int}}$。选择 $\\mathbf{u}_{\\mathrm{b}} = \\mathbf{u}_{\\mathrm{int}}$ 以抑制伪反射，同时通过指定 $\\rho_{\\mathrm{b}}$ 来强制执行格子状态方程 $p = c_s^2 \\rho$。\n\n为了使问题自洽，将内部邻近节点的非平衡部分 $f_i^{\\mathrm{neq,int}} = f_i^{\\mathrm{int}} - f_i^{\\mathrm{eq}}(\\rho_{\\mathrm{int}}, \\mathbf{u}_{\\mathrm{int}})$ 近似为一个二阶矩模型\n$$\nf_i^{\\mathrm{neq,int}} \\approx w_i \\frac{1}{2 c_s^4} \\left( \\mathbf{e}_i \\mathbf{e}_i - c_s^2 \\mathbf{I} \\right) : \\boldsymbol{\\Pi},\n$$\n其中 $\\boldsymbol{\\Pi}$ 是一个用于模拟弱剪切的合成小振幅对角应力张量，选择为\n$$\n\\boldsymbol{\\Pi} = \\mathrm{diag} \\left( \\gamma \\rho_{\\mathrm{int}} u_{\\mathrm{int},x}, \\, \\gamma \\rho_{\\mathrm{int}} u_{\\mathrm{int},y}, \\, \\gamma \\rho_{\\mathrm{int}} u_{\\mathrm{int},z} \\right),\n$$\n对于所有测试，$\\gamma$ 是一个小的固定标量。此处 $:$ 表示在索引上的双点积，$\\mathbf{I}$ 是单位张量。这种构造保留了质量，并产生了一个与低马赫数流动一致的受控非平衡态。\n\n您的程序必须：\n- 实现 D3Q19，使用上述 $f_i^{\\mathrm{eq}}$ 和非平衡态近似。\n- 对于未知方向 $e_{i,x}  0$，使用非平衡态外推法重建边界分布 $f_i^{\\mathrm{bnd}}$，其中 $\\rho_{\\mathrm{b}}$ 已指定，且 $\\mathbf{u}_{\\mathrm{b}} = \\mathbf{u}_{\\mathrm{int}}$。\n- 从 $f_i^{\\mathrm{bnd}}$ 计算边界宏观场 $(\\rho_{\\mathrm{comp}}, \\mathbf{u}_{\\mathrm{comp}})$。\n- 为每个测试案例报告两个定量诊断指标，以表明壓力強制執行成功且反射最小：\n  1. 由绝对密度失配定义的格子压力强制执行误差 $|\\rho_{\\mathrm{comp}} - \\rho_{\\mathrm{b}}|$（在格子单位下是无量纲的）。\n  2. 由 $|u_{\\mathrm{comp},x} - u_{\\mathrm{int},x}|$ 定义的法向速度反射度量（在格子单位下是无量纲的）。\n\n使用以下测试套件。每个测试用例由格子单位下的 $(\\rho_{\\mathrm{b}}, \\rho_{\\mathrm{int}}, \\mathbf{u}_{\\mathrm{int}})$ 组成：\n- 案例 1: $(1.0, 1.0, (0.0, 0.0, 0.0))$。\n- 案例 2: $(1.02, 1.0, (0.05, 0.0, 0.0))$。\n- 案例 3: $(0.9, 0.92, (0.02, 0.03, 0.0))$。\n- 案例 4: $(1.1, 1.05, (0.0, 0.05, 0.04))$。\n- 案例 5: $(1.0, 1.0, (0.1, 0.0, 0.0))$。\n\n您的程序应生成一行输出，其中包含一个方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果是一个双元素列表 $[\\;|\\rho_{\\mathrm{comp}} - \\rho_{\\mathrm{b}}|,\\; |u_{\\mathrm{comp},x} - u_{\\mathrm{int},x}|\\;]$。例如，输出格式必须为 $[[x_1,y_1],[x_2,y_2],\\dots]$，所有条目均为格子单位下的十进制浮点数。",
            "solution": "该问题被评估为**有效**。它描述了一项基于计算流体动力学中格子玻尔兹曼方法（LBM）既定原理的适定数值任务。其设置是自洽且科学合理的。单个未指定的参数 $\\gamma$ 被描述为一个“小的固定标量”。根据数值物理学中对此类合成测试用例的常见做法，我们将选择一个合理的小值以使问题具体化。我们设定 $\\gamma = 0.01$。\n\n解决方案涉及为 D3Q19 LBM 模板实现一个非平衡态外推边界条件。以下步骤概述了每个测试用例的流程，每个测试用例提供目标边界密度 $\\rho_{\\mathrm{b}}$、内部密度 $\\rho_{\\mathrm{int}}$ 和内部速度 $\\mathbf{u}_{\\mathrm{int}}$。所有数学实体均以格子单位表示。\n\n首先，我们定义 D3Q19 模型的常数。该格子由一组 19 个离散速度矢量 $\\{\\mathbf{e}_i\\}_{i=0}^{18}$ 和相应的权重 $\\{w_i\\}_{i=0}^{18}$ 定义。该矢量集包括：\n- 一个零速度矢量 $\\mathbf{e}_0 = (0, 0, 0)$，权重 $w_0 = 1/3$。\n- 六个速度为 1 的轴对齐矢量，例如 $(\\pm 1, 0, 0)$，每个权重为 $w_i = 1/18$。\n- 十二个速度为 $\\sqrt{2}$ 的对角矢量，例如 $(\\pm 1, \\pm 1, 0)$，每个权重为 $w_i = 1/36$。\n\n格子声速的平方是一个常数，$c_s^2 = 1/3$。\n\n针对每个测试用例 $(\\rho_{\\mathrm{b}}, \\rho_{\\mathrm{int}}, \\mathbf{u}_{\\mathrm{int}})$ 的求解算法如下：\n\n**步骤 1：构建内部粒子分布函数, $f_i^{\\mathrm{int}}$**\n\n问题提供了一个用于描述与边界相邻的内部计算节点上流体状态的合成模型。总粒子分布函数 $f_i^{\\mathrm{int}}$ 是其平衡部分和非平衡部分之和：\n$$\nf_i^{\\mathrm{int}} = f_i^{\\mathrm{eq}}(\\rho_{\\mathrm{int}}, \\mathbf{u}_{\\mathrm{int}}) + f_i^{\\mathrm{neq,int}}\n$$\n平衡部分 $f_i^{\\mathrm{eq}}(\\rho_{\\mathrm{int}}, \\mathbf{u}_{\\mathrm{int}})$ 是局部麦克斯韦分布，使用所提供的内部宏观场 $(\\rho_{\\mathrm{int}}, \\mathbf{u}_{\\mathrm{int}})$ 计算得出：\n$$\nf_i^{\\mathrm{eq}}(\\rho,\\mathbf{u}) = w_i \\rho \\left[ 1 + \\frac{\\mathbf{e}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{e}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2 c_s^2} \\right]\n$$\n非平衡部分 $f_i^{\\mathrm{neq,int}}$ 由一个合成应力张量 $\\boldsymbol{\\Pi}$ 构建：\n$$\nf_i^{\\mathrm{neq,int}} \\approx w_i \\frac{1}{2 c_s^4} \\left( \\mathbf{e}_i \\mathbf{e}_i - c_s^2 \\mathbf{I} \\right) : \\boldsymbol{\\Pi}\n$$\n其中 $\\mathbf{I}$ 是单位张量， $:$ 表示双点积。合成应力张量 $\\boldsymbol{\\Pi}$ 给出为：\n$$\n\\boldsymbol{\\Pi} = \\mathrm{diag} \\left( \\gamma \\rho_{\\mathrm{int}} u_{\\mathrm{int},x}, \\, \\gamma \\rho_{\\mathrm{int}} u_{\\mathrm{int},y}, \\, \\gamma \\rho_{\\mathrm{int}} u_{\\mathrm{int},z} \\right)\n$$\n我们选择的值为 $\\gamma = 0.01$。由于 $\\boldsymbol{\\Pi}$ 是对角张量，双点积简化为 $\\sum_{\\alpha \\in \\{x,y,z\\}} (e_{i,\\alpha}^2 - c_s^2)\\Pi_{\\alpha\\alpha}$。这种构造正确地确保了非平衡部分对质量和动量没有贡献，即 $\\sum_i f_i^{\\mathrm{neq,int}} = 0$ 和 $\\sum_i f_i^{\\mathrm{neq,int}} \\mathbf{e}_i = \\mathbf{0}$。因此，从构造的 $f_i^{\\mathrm{int}}$ 中恢复的宏观场恰好是 $\\rho_{\\mathrm{int}}$ 和 $\\mathbf{u}_{\\mathrm{int}}$。\n\n**步骤 2：重建边界分布函数, $f_i^{\\mathrm{bnd}}$**\n\n在 $x=0$ 处的边界节点，分布函数 $f_i$ 被划分为两组。对于 $e_{i,x}  0$ 的分布函数在迁移步骤后是未知的，因为它们指向流体域内部。对于 $e_{i,x} \\le 0$ 的分布函数是已知的，因为它们是从内部节点迁移过来的。\n\n非平衡态外推方案通过将目标边界平衡态与从内部外推的非平衡部分相结合来重建未知分布。该方案定义如下：\n- 对于未知分布 ($e_{i,x}  0$):\n  $$\n  f_i^{\\mathrm{bnd}} = f_i^{\\mathrm{eq}}(\\rho_{\\mathrm{b}}, \\mathbf{u}_{\\mathrm{b}}) + f_i^{\\mathrm{neq,int}}\n  $$\n- 对于已知分布 ($e_{i,x} \\le 0$):\n  $$\n  f_i^{\\mathrm{bnd}} = f_i^{\\mathrm{int}}\n  $$\n如问题所述，边界速度 $\\mathbf{u}_{\\mathrm{b}}$ 被设置为等于内部速度 $\\mathbf{u}_{\\mathrm{int}}$，以最小化伪反射。目标边界密度 $\\rho_{\\mathrm{b}}$ 由测试用例给出。$f_i^{\\mathrm{eq}}(\\rho_{\\mathrm{b}}, \\mathbf{u}_{\\mathrm{b}})$ 项使用通用平衡公式以参数 $\\rho_{\\mathrm{b}}$ 和 $\\mathbf{u}_{\\mathrm{b}}$ 计算。\n\n**步骤 3：计算重建后的宏观场和诊断指标**\n\n在定义了全套 19 个边界分布 $f_i^{\\mathrm{bnd}}$ 后，边界上的实际宏观密度 $\\rho_{\\mathrm{comp}}$ 和速度 $\\mathbf{u}_{\\mathrm{comp}}$ 通过矩求和计算得出：\n$$\n\\rho_{\\mathrm{comp}} = \\sum_{i=0}^{18} f_i^{\\mathrm{bnd}}\n$$\n$$\n\\rho_{\\mathrm{comp}} \\mathbf{u}_{\\mathrm{comp}} = \\sum_{i=0}^{18} f_i^{\\mathrm{bnd}} \\mathbf{e}_i\n$$\n最后，我们计算两个所需的诊断指标：\n1. 压力强制执行误差，通过绝对密度失配来衡量：\n   $$\n   \\text{Error}_{\\rho} = |\\rho_{\\mathrm{comp}} - \\rho_{\\mathrm{b}}|\n   $$\n2. 法向速度反射度量，通过法向速度分量的偏差来衡量：\n   $$\n   \\text{Error}_{u_x} = |u_{\\mathrm{comp},x} - u_{\\mathrm{int},x}|\n   $$\n此过程将应用于所提供的五个测试用例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef setup_d3q19():\n    \"\"\"\n    Initializes the D3Q19 lattice weights and velocity vectors.\n    \"\"\"\n    w = np.array([\n        1/3.0, \n        1/18.0, 1/18.0, 1/18.0, 1/18.0, 1/18.0, 1/18.0,\n        1/36.0, 1/36.0, 1/36.0, 1/36.0, 1/36.0, 1/36.0, \n        1/36.0, 1/36.0, 1/36.0, 1/36.0, 1/36.0, 1/36.0\n    ])\n    e = np.array([\n        [0, 0, 0],\n        [1, 0, 0], [-1, 0, 0], [0, 1, 0], [0, -1, 0], [0, 0, 1], [0, 0, -1],\n        [1, 1, 0], [-1, -1, 0], [1, -1, 0], [-1, 1, 0],\n        [1, 0, 1], [-1, 0, -1], [1, 0, -1], [-1, 0, 1],\n        [0, 1, 1], [0, -1, -1], [0, 1, -1], [0, -1, 1]\n    ], dtype=np.int32)\n    return w, e\n\ndef equilibrium_distribution(rho, u, w, e, c_s_sq):\n    \"\"\"\n    Calculates the Maxwellian equilibrium distribution f_eq.\n    \"\"\"\n    e_dot_u = np.dot(e, u)\n    u_dot_u = np.dot(u, u)\n    term1 = e_dot_u / c_s_sq\n    term2 = e_dot_u**2 / (2 * c_s_sq**2)\n    term3 = u_dot_u / (2 * c_s_sq)\n    return w * rho * (1 + term1 + term2 - term3)\n\ndef synthetic_nonequilibrium(rho, u, w, e, c_s_sq, gamma):\n    \"\"\"\n    Calculates the synthetic non-equilibrium distribution f_neq.\n    \"\"\"\n    c_s_4 = c_s_sq**2\n    Pi_diag = gamma * rho * u\n    \n    # Contract (e*e - c_s^2*I) with Pi\n    # Since Pi is diagonal, this simplifies to sum_alpha (e_{i,alpha}^2 - c_s^2) * Pi_{alpha,alpha}\n    # This can be vectorized for all i.\n    e_sq_minus_cs2 = e**2 - c_s_sq\n    term_sum = np.dot(e_sq_minus_cs2, Pi_diag)\n    \n    return w * (1 / (2 * c_s_4)) * term_sum\n\ndef get_macros(f, e):\n    \"\"\"\n    Computes macroscopic density and velocity from distribution functions.\n    \"\"\"\n    rho = np.sum(f)\n    if abs(rho)  1e-12:  # Avoid division by zero for null state\n        return 0.0, np.zeros(3)\n    \n    # Momentum is sum(f_i * e_i) over i.\n    momentum = np.sum(f[:, np.newaxis] * e, axis=0)\n    u = momentum / rho\n    return rho, u\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and compute diagnostics.\n    \"\"\"\n    test_cases = [\n        (1.0, 1.0, np.array([0.0, 0.0, 0.0])),\n        (1.02, 1.0, np.array([0.05, 0.0, 0.0])),\n        (0.9, 0.92, np.array([0.02, 0.03, 0.0])),\n        (1.1, 1.05, np.array([0.0, 0.05, 0.04])),\n        (1.0, 1.0, np.array([0.1, 0.0, 0.0])),\n    ]\n\n    # Lattice and model constants\n    c_s_sq = 1/3.0\n    gamma = 0.01  # Small, fixed scalar for synthetic stress\n    w, e = setup_d3q19()\n\n    results = []\n    \n    for case in test_cases:\n        rho_b_target, rho_int, u_int = case\n        \n        # Per problem statement, boundary velocity is set to interior velocity\n        # to suppress spurious reflections.\n        u_b = u_int\n\n        # Step 1: Construct the full 'interior' distribution function f_int\n        f_eq_int = equilibrium_distribution(rho_int, u_int, w, e, c_s_sq)\n        f_neq_int = synthetic_nonequilibrium(rho_int, u_int, w, e, c_s_sq, gamma)\n        f_int = f_eq_int + f_neq_int\n\n        # Step 2: Reconstruct the boundary distributions f_bnd\n        f_eq_b_target = equilibrium_distribution(rho_b_target, u_b, w, e, c_s_sq)\n        \n        f_bnd = np.zeros_like(f_int)\n        \n        # Identify unknown populations (e_x > 0) pointing into the domain\n        # and known populations (e_x = 0) coming from the interior.\n        unknown_indices = np.where(e[:, 0] > 0)[0]\n        known_indices = np.where(e[:, 0] = 0)[0]\n\n        # Apply the non-equilibrium extrapolation rules\n        f_bnd[unknown_indices] = f_eq_b_target[unknown_indices] + f_neq_int[unknown_indices]\n        f_bnd[known_indices] = f_int[known_indices]\n\n        # Step 3: Compute the resulting macroscopic fields from the reconstructed f_bnd\n        rho_comp, u_comp = get_macros(f_bnd, e)\n\n        # Step 4: Compute the two required diagnostic metrics\n        error_rho = np.abs(rho_comp - rho_b_target)\n        # u_b is set to u_int, so the reference velocity is u_int[0]\n        error_ux = np.abs(u_comp[0] - u_int[0])\n        \n        results.append([error_rho, error_ux])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "超越简单地运行模拟，一个熟练的实践者必须理解其所用工具的局限性。本练习涉及建立一个完整的二维Couette流模拟，并设计一个数值实验来量化标准LBM模型中的伽利略不变性误差 。通过这个实践，你将学会如何评估数值方法的内在属性，并深入理解离散化误差如何影响模拟结果的物理真实性。",
            "id": "3971766",
            "problem": "您需要评估在计算流体动力学（CFD）中使用格子Boltzmann方法（LBM）模拟二维库埃特流时的伽利略不变性误差。目标是量化当在库埃特流上叠加一个均匀背景平移速度时，计算出的剪切应力会发生多大的偏差。推导和实现必须基于离散Boltzmann方程的第一性原理和单弛豫时间Bhatnagar–Gross–Krook（BGK）碰撞算子。\n\n从以下基本出发点开始：在格子Boltzmann方法（LBM）中，采用BGK弛豫的离散速度Boltzmann方程，其中，分布函数 $f_i$ 在具有离散速度 $\\mathbf{c}_i$ 和求积权重 $w_i$ 的均匀笛卡尔格子上演化。使用标准的二维九速模型（D2Q9），其离散速度为 $\\mathbf{c}_0=(0,0)$、$\\mathbf{c}_1=(1,0)$、$\\mathbf{c}_2=(0,1)$、$\\mathbf{c}_3=(-1,0)$、$\\mathbf{c}_4=(0,-1)$、$\\mathbf{c}_5=(1,1)$、$\\mathbf{c}_6=(-1,1)$、$\\mathbf{c}_7=(-1,-1)$、$\\mathbf{c}_8=(1,-1)$，权重为 $w_0=\\frac{4}{9}$、$w_{1,2,3,4}=\\frac{1}{9}$、$w_{5,6,7,8}=\\frac{1}{36}$。等温格子声速为 $c_s^2=\\frac{1}{3}$。平衡分布函数 $f_i^{\\mathrm{eq}}$ 是与离散化一致的二阶Hermite展开，弛豫时间 $\\tau$ 通过 $\\nu=c_s^2(\\tau-\\frac{1}{2})$ 与运动粘度相关。宏观密度 $\\rho$ 和速度 $\\mathbf{u}$ 分别通过 $f_i$ 的零阶矩和一阶矩恢复。\n\n建立一个高为 $N_y$ 个节点、长为 $N_x$ 个节点的二维通道，在流向上采用周期性边界条件，在两个水平壁面（$y=0$ 和 $y=N_y-1$）处采用速度边界条件。实施标准的Zou–He速度边界条件以施加壁面速度。配置一个库埃特流，其中底壁以速度 $\\mathbf{u}_\\mathrm{bottom}=(U_0,0)$ 移动，顶壁以速度 $\\mathbf{u}_\\mathrm{top}=(U_0+U_\\mathrm{rel},0)$ 移动，其中 $U_0$ 是均匀背景平移速度，$U_\\mathrm{rel}$ 是产生剪切的相对板速。将流体初始化为均匀密度 $\\rho_0=1$ 和速度 $\\mathbf{u}=(U_0,0)$。\n\n根据连续介质Navier–Stokes方程中的伽利略不变性，对于库埃特流中的牛顿流体，剪切应力应仅取决于相对速度 $U_\\mathrm{rel}$ 和通道高度，而不应在叠加均匀背景速度 $U_0$ 时发生改变。在格子Boltzmann方法中，离散化和截断误差会引入伽利略不变性的违背，当 $U_0\\neq 0$ 时，这表现为计算出的剪切应力的偏差。模拟达到稳态后，将剪切应力 $\\tau_{xy}$ 估算为 $\\tau_{xy}=\\bar{\\rho}\\,\\nu\\,\\frac{du_x}{dy}$，其中 $\\bar{\\rho}$ 是域平均密度，$\\nu$ 是运动粘度，而 $\\frac{du_x}{dy}$ 是横跨通道的平均流向速度剖面的斜率。通过对周期性方向上平均的流向速度进行最小二乘线性拟合来计算 $\\frac{du_x}{dy}$，使用内部节点以避免直接的边界效应。\n\n在格子单位下实施完整模拟，使用 $\\Delta x=1$ 和 $\\Delta t=1$，采用D2Q9模型和单弛豫时间BGK碰撞，在x方向使用周期性边界条件，在$y=0$和$y=N_y-1$处使用Zou–He速度边界条件。使用 $N_x=64$，$N_y=17$，$\\tau=0.8$，$U_\\mathrm{rel}=0.1$，并运行 $T=1500$ 个时间步。所有量均以无量纲格子单位表示；无需进行物理单位转换。\n\n设计一个包含四个测试用例的测试套件，背景速度分别为 $U_0\\in\\{0.0, 0.1, -0.1, 0.3\\}$。对每个用例，运行模拟并计算稳态剪切应力 $\\tau_{xy}(U_0)$。使用 $U_0=0.0$ 的基准用例，将归一化绝对偏差定义为 $\\epsilon(U_0)=\\left|\\tau_{xy}(U_0)-\\tau_{xy}(0.0)\\right|/\\left|\\tau_{xy}(0.0)\\right|$，这是一个无量纲小数。每个测试用例的预期结果类型是浮点数。\n\n您的程序应生成单行输出，该输出为一个用逗号分隔并包含在方括号中的列表（例如，\"[result1,result2,result3,result4]\"）。序列必须按 $U_0=0.0$、$U_0=0.1$、$U_0=-0.1$ 和 $U_0=0.3$ 的顺序对应。不应打印任何额外文本。",
            "solution": "问题陈述经评估有效。它在科学上基于格子Boltzmann方法（LBM）在计算流体动力学领域的成熟原理，特别是使用了Bhatnagar–Gross–Krook（BGK）近似。该设置描述了一个标准的数值实验，用于研究LBM中一个已知的、不容忽视的人为现象——缺乏完美的伽利略不变性。该问题是适定的，提供了所有必要的参数、初始条件、边界条件，以及一个清晰、客观的计算所需量的步骤。所选参数对于稳定且有意义的数值模拟是合理的。\n\n目标是量化二维LBM模拟库埃特流中的伽利略不变性误差。在连续介质力学中，Navier-Stokes方程是伽利略不变的，这意味着流动的物理特性（包括剪切应力）与参考系的恒定速度无关。在流场上叠加一个均匀的平移速度 $\\mathbf{U}_0$ 不应改变其内部应力。然而，LBM的离散性质引入了截断误差，从而破坏了这种不变性，尤其是在马赫数不可忽略时。这种误差表现为计算量（如剪切应力）对背景速度 $U_0$ 的依赖性。\n\n我们将在一个高为 $N_y$、长为 $N_x$ 的通道中模拟二维库埃特流。流体被限制在两个平行板之间。位于 $y=0$ 的底板以速度 $\\mathbf{u}_\\mathrm{bottom}=(U_0,0)$ 移动，位于 $y=N_y-1$ 的顶板以速度 $\\mathbf{u}_\\mathrm{top}=(U_0+U_\\mathrm{rel},0)$ 移动。所有量均以无量纲格子单位表示，其中格子间距 $\\Delta x = 1$，时间步长 $\\Delta t = 1$。\n\n该模拟由带有单弛豫时间BGK碰撞算子的离散速度Boltzmann方程控制：\n$$\nf_i(\\mathbf{x}+\\mathbf{c}_i \\Delta t, t+\\Delta t) - f_i(\\mathbf{x}, t) = -\\frac{1}{\\tau} \\left( f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right)\n$$\n其中 $f_i(\\mathbf{x}, t)$ 是在格点 $\\mathbf{x}$ 和时间 $t$，对应离散速度 $\\mathbf{c}_i$ 的粒子分布函数。$\\tau$ 是弛豫时间，它控制流体的粘度。LBM算法分为两个主要步骤：\n\n1.  **碰撞步**：在每个格点上，分布函数 $f_i$ 向局部平衡分布 $f_i^{\\mathrm{eq}}$ 弛豫。\n    $$\n    f_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau} \\left( f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\rho, \\mathbf{u}) \\right)\n    $$\n    其中 $f_i^*$ 是碰撞后的分布函数。宏观密度 $\\rho$ 和速度 $\\mathbf{u}$ 由分布函数的矩计算得出：\n    $$\n    \\rho = \\sum_{i=0}^{8} f_i \\quad \\text{和} \\quad \\rho\\mathbf{u} = \\sum_{i=0}^{8} f_i \\mathbf{c}_i\n    $$\n\n2.  **迁移步**：碰撞后的分布函数 $f_i^*$ 根据其离散速度迁移到相邻的格点：\n    $$\n    f_i(\\mathbf{x}+\\mathbf{c}_i, t+1) = f_i^*(\\mathbf{x}, t)\n    $$\n    （其中 $\\Delta x=1, \\Delta t=1$）。\n\n该模拟使用标准的D2Q9格子模型，其离散速度 $\\mathbf{c}_i$ 和权重 $w_i$ 已给出。平衡分布函数 $f_i^{\\mathrm{eq}}$ 是速度的Maxwell-Boltzmann分布的二阶多项式展开，由下式给出：\n$$\nf_i^{\\mathrm{eq}} = w_i \\rho \\left( 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2c_s^2} \\right)\n$$\n其中 $c_s=1/\\sqrt{3}$ 是格子声速。运动粘度 $\\nu$ 与弛豫时间的关系为 $\\nu = c_s^2(\\tau - 0.5)$。\n\n模拟区域是一个大小为 $N_x=64$ 乘以 $N_y=17$ 的网格。边界条件在流向（$x$）方向是周期性的。在横向（$y$）方向，壁面（$y=0$ 和 $y=N_y-1$）处应用Zou-He速度边界条件。对于一个给定速度 $\\mathbf{u}_w=(u_{wx}, u_{wy}=0)$ 的壁面节点，未知的传入分布函数在迁移步之后被重构。对于底壁（$y=0$），未知量为 $f_2, f_5, f_6$。它们的确定方式如下：\n首先，壁面密度 $\\rho_w$ 由壁面节点上已知的、迁移后的分布函数计算得出：\n$$\n\\rho_w = f_0 + f_1 + f_3 + 2(f_4 + f_7 + f_8)\n$$\n然后，使用 $\\rho_w$ 和已知的壁面速度 $u_{wx}$ 计算未知的分布函数：\n$$\nf_2 = f_4\n$$\n$$\nf_5 = f_7 - \\frac{1}{2}(f_1-f_3) + \\frac{1}{2}\\rho_w u_{wx}\n$$\n$$\nf_6 = f_8 + \\frac{1}{2}(f_1-f_3) - \\frac{1}{2}\\rho_w u_{wx}\n$$\n对于顶壁（$y=N_y-1$）使用一组对称的关系式。\n\n模拟以均匀密度 $\\rho_0=1$ 和速度 $\\mathbf{u}_{init}=(U_0, 0)$ 进行初始化。模拟运行 $T=1500$ 个时间步，以使流场达到稳态。\n\n达到稳态后，计算剪切应力 $\\tau_{xy}$。首先，将流向速度 $u_x$ 沿周期性的 $x$ 方向平均，以获得平均速度剖面 $\\bar{u}_x(y)$。对内部节点（$y \\in [1, N_y-2]$）上的该剖面进行线性最小二乘回归，以求得速度梯度 $du_x/dy$。然后使用域平均密度 $\\bar{\\rho}$ 和运动粘度 $\\nu$ 计算剪切应力：\n$$\n\\tau_{xy} = \\bar{\\rho} \\, \\nu \\, \\frac{du_x}{dy}\n$$\n对每个背景速度 $U_0 \\in \\{0.0, 0.1, -0.1, 0.3\\}$ 重复此过程。$U_0=0.0$ 的用例作为基准，提供参考剪切应力 $\\tau_{xy}(0.0)$。伽利略不变性误差被量化为归一化绝对偏差：\n$$\n\\epsilon(U_0)=\\frac{\\left|\\tau_{xy}(U_0)-\\tau_{xy}(0.0)\\right|}{\\left|\\tau_{xy}(0.0)\\right|}\n$$\n将为四个指定的 $U_0$ 值分别计算 $\\epsilon(U_0)$ 的值。根据定义，$\\epsilon(0.0) = 0$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    使用LBM模拟二维库埃特流，以评估伽利略不变性误差。\n    \"\"\"\n    \n    # Simulation Parameters\n    NX = 64\n    NY = 17\n    TAU = 0.8\n    U_REL = 0.1\n    T_STEPS = 1500\n    RHO0 = 1.0\n    \n    # D2Q9 model parameters\n    C = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1], \n                  [1, 1], [-1, 1], [-1, -1], [1, -1]])\n    W = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    CS2 = 1/3\n    NU = CS2 * (TAU - 0.5)\n\n    test_cases_U0 = [0.0, 0.1, -0.1, 0.3]\n    tau_xy_results = {}\n\n    def equilibrium_dist(rho, ux, uy):\n        \"\"\"Calculates the equilibrium distribution function.\"\"\"\n        feq = np.zeros((NY, NX, 9))\n        u_dot_u = ux**2 + uy**2\n        for i in range(9):\n            c_dot_u = C[i, 0] * ux + C[i, 1] * uy\n            term1 = c_dot_u / CS2\n            term2 = (c_dot_u**2) / (2 * CS2**2)\n            term3 = u_dot_u / (2 * CS2)\n            feq[:, :, i] = W[i] * rho * (1 + term1 + term2 - term3)\n        return feq\n\n    for u0 in test_cases_U0:\n        # Flow Parameters for the current case\n        u_bottom = u0\n        u_top = u0 + U_REL\n        \n        # Initialization\n        ux_init = np.full((NY, NX), u0)\n        uy_init = np.zeros((NY, NX))\n        rho_init = np.full((NY, NX), RHO0)\n        f = equilibrium_dist(rho_init, ux_init, uy_init)\n\n        # Main simulation loop\n        for t in range(T_STEPS):\n            # Collision\n            rho = np.sum(f, axis=2)\n            ux = np.einsum('ijk,k-ij', f, C[:, 0]) / rho\n            uy = np.einsum('ijk,k-ij', f, C[:, 1]) / rho\n            \n            feq = equilibrium_dist(rho, ux, uy)\n            f = f - (1/TAU) * (f - feq)\n\n            # Streaming\n            for i in range(9):\n                f[:, :, i] = np.roll(f[:, :, i], C[i, 0], axis=1)\n                f[:, :, i] = np.roll(f[:, :, i], C[i, 1], axis=0)\n\n            # Boundary Conditions (Zou-He)\n            # Bottom wall (y=0)\n            rho_w_bottom = f[0, :, 0] + f[0, :, 1] + f[0, :, 3] + 2 * (f[0, :, 4] + f[0, :, 7] + f[0, :, 8])\n            f[0, :, 2] = f[0, :, 4]  # Since u_y = 0\n            f[0, :, 5] = f[0, :, 7] - 0.5 * (f[0, :, 1] - f[0, :, 3]) + 0.5 * rho_w_bottom * u_bottom\n            f[0, :, 6] = f[0, :, 8] + 0.5 * (f[0, :, 1] - f[0, :, 3]) - 0.5 * rho_w_bottom * u_bottom\n\n            # Top wall (y=NY-1)\n            rho_w_top = f[-1, :, 0] + f[-1, :, 1] + f[-1, :, 3] + 2 * (f[-1, :, 2] + f[-1, :, 5] + f[-1, :, 6])\n            f[-1, :, 4] = f[-1, :, 2]  # Since u_y = 0\n            f[-1, :, 7] = f[-1, :, 5] + 0.5 * (f[-1, :, 1] - f[-1, :, 3]) - 0.5 * rho_w_top * u_top\n            f[-1, :, 8] = f[-1, :, 6] - 0.5 * (f[-1, :, 1] - f[-1, :, 3]) + 0.5 * rho_w_top * u_top\n\n        # Post-processing to calculate shear stress\n        rho_final = np.sum(f, axis=2)\n        ux_final = np.einsum('ijk,k-ij', f, C[:, 0]) / rho_final\n        \n        rho_avg = np.mean(rho_final)\n        ux_profile = np.mean(ux_final, axis=1)\n\n        # Linear fit on interior nodes\n        y_interior = np.arange(1, NY - 1)\n        ux_interior = ux_profile[1:-1]\n        \n        # scipy.stats.linregress(x, y)\n        lin_fit = linregress(y_interior, ux_interior)\n        du_dy = lin_fit.slope\n        \n        tau_xy = rho_avg * NU * du_dy\n        tau_xy_results[u0] = tau_xy\n\n    # Calculate normalized deviation\n    tau_xy_base = tau_xy_results[0.0]\n    deviations = []\n    for u0 in test_cases_U0:\n        current_tau_xy = tau_xy_results[u0]\n        if tau_xy_base == 0:\n            deviation = 0.0 if current_tau_xy == 0.0 else float('inf')\n        else:\n            deviation = abs(current_tau_xy - tau_xy_base) / abs(tau_xy_base)\n        deviations.append(deviation)\n    \n    print(f\"[{','.join(map(str, deviations))}]\")\n\nsolve()\n\n```"
        }
    ]
}