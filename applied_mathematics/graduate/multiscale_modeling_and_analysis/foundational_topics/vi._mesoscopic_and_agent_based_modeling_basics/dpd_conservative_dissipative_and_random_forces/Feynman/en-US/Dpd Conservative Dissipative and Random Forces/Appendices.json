{
    "hands_on_practices": [
        {
            "introduction": "The conservative force in DPD is responsible for giving particles their soft, repulsive character, which is crucial for defining the structure and compressibility of the simulated fluid. This exercise explores the direct relationship between the force law and the potential energy landscape. By calculating the energy change and analyzing the potential's curvature, you will develop a fundamental understanding of how the choice of repulsion parameter impacts system stiffness and sets a critical constraint on the numerical integration time step.",
            "id": "3751652",
            "problem": "Consider a pair of particles interacting via the conservative part of the Dissipative Particle Dynamics (DPD) model. The conservative pair force between particles $i$ and $j$ is given by $\\mathbf{F}_{ij}^{C} = a_{ij}\\,w^{C}(r_{ij})\\,\\hat{\\mathbf{r}}_{ij}$, where $r_{ij}$ is the interparticle separation, $\\hat{\\mathbf{r}}_{ij}$ is the unit vector along the separation, $a_{ij}$ is a positive constant setting the repulsion strength, and $w^{C}(r)$ is a smooth cutoff weight function that vanishes at the cutoff distance $r_{c}0$ and is linear on $[0,r_{c}]$. Assume the standard linear choice $w^{C}(r) = 1 - r/r_{c}$ for $0 \\le r \\le r_{c}$ and $w^{C}(r) = 0$ for $r  r_{c}$. Let the pair potential $U(r)$ be defined by $F_{r}(r) = -\\,\\mathrm{d}U/\\mathrm{d}r$ and the reference condition $U(r_{c})=0$, so that the conservative force is purely repulsive and the potential energy vanishes at $r=r_{c}$.\n\nStarting from these definitions and Newton’s second law, derive the expression for $U(r)$ on $[0,r_{c}]$ and compute the conservative potential energy change $\\Delta U = U(r_{2}) - U(r_{1})$ when two particles are moved quasi-statically from separation $r_{1}$ to separation $r_{2}$, both strictly less than $r_{c}$. Take reduced DPD units with $r_{c} = 1$ and thermal energy $k_{B}T = 1$, and use the parameter values $a_{ij} = 40$, $r_{1} = 0.80$, and $r_{2} = 0.50$. Express the final energy change in units of $k_{B}T$ and round your answer to four significant figures.\n\nSeparately, discuss the implications of the computed $\\Delta U$ for numerical stability when using explicit time integration at large time steps in the full DPD dynamics that includes dissipative and random forces. In your discussion, clearly state the forms of the dissipative and random forces, the fluctuation–dissipation relation that links their amplitudes, and how the conservative potential curvature near $r \\approx r_{c}$ informs a stiffness-based step-size constraint.",
            "solution": "### Derivation of the Potential Energy Function $U(r)$\n\nThe radial component of the conservative force, $F^C(r)$, is the magnitude of the repulsive force pushing the particles apart. From the problem definition, this force is:\n$$F_r(r) = a_{ij} w^C(r) = a_{ij} \\left(1 - \\frac{r}{r_c}\\right) \\quad \\text{for } 0 \\le r \\le r_c$$\nThe potential energy $U(r)$ is related to this force component by the relation $F_r(r) = -\\frac{\\mathrm{d}U}{\\mathrm{d}r}$. To find $U(r)$, we integrate this expression with respect to $r$ using the reference condition $U(r_c) = 0$:\n$$U(r_c) - U(r) = \\int_r^{r_c} \\frac{\\mathrm{d}U}{\\mathrm{d}r'} \\mathrm{d}r'$$\n$$0 - U(r) = \\int_r^{r_c} (-F_r(r')) \\mathrm{d}r' = -a_{ij} \\int_r^{r_c} \\left(1 - \\frac{r'}{r_c}\\right) \\mathrm{d}r'$$\n$$U(r) = a_{ij} \\left[ r' - \\frac{(r')^2}{2r_c} \\right]_r^{r_c} = a_{ij} \\left[ \\left(r_c - \\frac{r_c^2}{2r_c}\\right) - \\left(r - \\frac{r^2}{2r_c}\\right) \\right]$$\n$$U(r) = a_{ij} \\left( \\frac{r_c}{2} - r + \\frac{r^2}{2r_c} \\right) = \\frac{a_{ij}}{2r_c} (r_c - r)^2$$\nThis expression is valid for $0 \\le r \\le r_c$. For $r  r_c$, the force is zero, so $U(r)=0$.\n\n### Calculation of the Potential Energy Change $\\Delta U$\n\nWe compute the potential energy change, $\\Delta U = U(r_{2}) - U(r_{1})$, using the derived formula and the given parameters: $a_{ij} = 40$, $r_c = 1$, $r_1 = 0.80$, and $r_2 = 0.50$. The energy unit is $k_B T = 1$.\n$$\\Delta U = U(r_2) - U(r_1) = \\frac{a_{ij}}{2r_c} \\left[ (r_c - r_2)^2 - (r_c - r_1)^2 \\right]$$\n$$\\Delta U = \\frac{40}{2(1)} \\left[ (1 - 0.50)^2 - (1 - 0.80)^2 \\right]$$\n$$\\Delta U = 20 \\left[ (0.50)^2 - (0.20)^2 \\right] = 20 [ 0.25 - 0.04 ] = 20 [ 0.21 ]$$\n$$\\Delta U = 4.2$$\nRounding to four significant figures, the result is $4.200$ in units of $k_B T$.\n\n### Discussion of Numerical Stability\n\nIn a full DPD simulation, the total force is $\\mathbf{F}_{ij} = \\mathbf{F}_{ij}^C + \\mathbf{F}_{ij}^D + \\mathbf{F}_{ij}^R$. The dissipative and random forces are:\n-   **Dissipative Force**: $\\mathbf{F}_{ij}^D = -\\gamma \\, w^D(r_{ij}) (\\hat{\\mathbf{r}}_{ij} \\cdot \\mathbf{v}_{ij}) \\hat{\\mathbf{r}}_{ij}$, where $\\gamma$ is the friction coefficient.\n-   **Random Force**: $\\mathbf{F}_{ij}^R = \\sigma \\, w^R(r_{ij}) \\zeta_{ij}(t) \\hat{\\mathbf{r}}_{ij}$, where $\\sigma$ is the noise amplitude and $\\zeta_{ij}(t)$ is a random variable.\n\nThese forces are linked by the **fluctuation-dissipation theorem**: $\\sigma^2 = 2 \\gamma k_B T$ and $w^D(r) = [w^R(r)]^2$.\n\nNumerical stability of explicit integrators (e.g., Velocity Verlet) requires the time step $\\Delta t$ to be small enough to resolve the fastest motions, which are governed by the stiffest part of the potential. The stiffness is given by the potential's curvature, $k(r) = \\mathrm{d}^2U/\\mathrm{d}r^2$. For the DPD potential, the curvature for $r  r_c$ is:\n$$k(r) = \\frac{\\mathrm{d}^2U}{\\mathrm{d}r^2} = \\frac{\\mathrm{d}}{\\mathrm{d}r} \\left(\\frac{a_{ij}}{r_c}(r_c - r)\\right) = \\frac{a_{ij}}{r_c}$$\nFor the given parameters, the stiffness is a constant $k = 40/1 = 40$. The highest oscillation frequency is approximately $\\omega_{\\max} \\propto \\sqrt{k}$, so the time step must satisfy $\\Delta t \\lesssim 1/\\omega_{\\max} \\propto \\sqrt{r_c/a_{ij}}$.\n\nThe computed energy change, $\\Delta U = 4.200 \\, k_B T$, for a modest displacement of $0.3 r_c$ is large. This indicates that the potential is very steep, a direct result of the large repulsion parameter $a_{ij}=40$. A stiff potential leads to large forces and accelerations, which necessitates a small integration time step $\\Delta t$ to prevent particles from \"overshooting\" each other, which would lead to numerical blow-up. Thus, the magnitude of $\\Delta U$ serves as a direct indicator of the system's stiffness and the need for a small $\\Delta t$ to ensure a stable simulation.",
            "answer": "$$\\boxed{4.200}$$"
        },
        {
            "introduction": "While the conservative force dictates the system's equilibrium structure, the dissipative force is crucial for removing excess kinetic energy and driving the system towards thermal equilibrium. This practice isolates the dissipative component to analyze its effect on particle dynamics and numerical stability. By deriving the stability limit for a simple forward Euler integrator, you will see that strong damping, just like stiff potentials, can impose strict constraints on the simulation time step to prevent non-physical oscillations.",
            "id": "3751668",
            "problem": "Consider two identical particles interacting under Dissipative Particle Dynamics (DPD). Each particle has mass $m$, and the pairwise dissipative force between particles $i$ and $j$ is, by definition of DPD, along the line of centers and given by\n$$\n\\mathbf{F}_{ij}^{D} \\;=\\; -\\,\\gamma\\,w_{D}(r_{ij})\\,\\big(\\mathbf{v}_{ij}\\cdot \\hat{\\mathbf{r}}_{ij}\\big)\\,\\hat{\\mathbf{r}}_{ij},\n$$\nwhere $\\gamma0$ is the dissipative coefficient, $r_{ij}=|\\mathbf{r}_{i}-\\mathbf{r}_{j}|$, $\\hat{\\mathbf{r}}_{ij}=(\\mathbf{r}_{i}-\\mathbf{r}_{j})/r_{ij}$, $\\mathbf{v}_{ij}=\\mathbf{v}_{i}-\\mathbf{v}_{j}$, and $w_{D}(r)$ is a Lipschitz-continuous weight with $0\\le w_{D}(r)\\le 1$ for $0\\le r \\le r_{c}$ and $w_{D}(r)=0$ for $rr_{c}$. The random force has zero mean and variance set by the fluctuation-dissipation relation, but for the purpose of deriving a deterministic time step constraint that resolves dissipative damping, assume the instantaneous random force is zero (e.g., the zero-temperature limit) and ignore conservative forces over a single dissipative substep. Over a single explicit forward Euler substep of duration $\\Delta t$, approximate $\\hat{\\mathbf{r}}_{ij}$ and $w_{D}(r_{ij})$ as constant.\n\nStarting from Newton’s second law and the above DPD dissipative force, derive the maximal time step $\\Delta t_{\\max}$ such that the scalar relative velocity along the line of centers, $s=\\mathbf{v}_{ij}\\cdot \\hat{\\mathbf{r}}_{ij}$, decays monotonically without changing sign in one-step forward Euler time integration. Your derivation must begin from first principles (Newton’s second law and the given DPD force definition) and proceed through the linear stability of the forward Euler update for a decaying mode. Express your final answer as a closed-form analytic expression in terms of $m$, $\\gamma$, and $w_{D}(r_{ij})$. Do not insert numerical values. The final answer must be a single expression with no units attached.",
            "solution": "The objective is to find the maximum time step $\\Delta t_{\\max}$ for the explicit forward Euler integration of the motion of two particles interacting via the DPD dissipative force, subject to the condition that the relative velocity component along their line of centers decays monotonically.\n\nLet the two particles be indexed by $i$ and $j$. According to Newton's second law, the equations of motion for the two particles are:\n$$ m \\mathbf{a}_{i} = \\mathbf{F}_{ij}^{D} $$\n$$ m \\mathbf{a}_{j} = \\mathbf{F}_{ji}^{D} $$\nwhere $\\mathbf{a}_{i} = d\\mathbf{v}_{i}/dt$ and $\\mathbf{a}_{j} = d\\mathbf{v}_{j}/dt$ are the accelerations. The DPD force satisfies Newton's third law, $\\mathbf{F}_{ji}^{D} = -\\mathbf{F}_{ij}^{D}$.\n\nWe are interested in the evolution of the relative velocity $\\mathbf{v}_{ij} = \\mathbf{v}_{i} - \\mathbf{v}_{j}$. The equation of motion for the relative acceleration $\\mathbf{a}_{ij} = \\mathbf{a}_{i} - \\mathbf{a}_{j}$ is:\n$$ m \\mathbf{a}_{ij} = m(\\mathbf{a}_{i} - \\mathbf{a}_{j}) = \\mathbf{F}_{ij}^{D} - \\mathbf{F}_{ji}^{D} = 2 \\mathbf{F}_{ij}^{D} $$\nThe scalar quantity of interest is $s = \\mathbf{v}_{ij} \\cdot \\hat{\\mathbf{r}}_{ij}$. We find its time evolution, approximating $\\hat{\\mathbf{r}}_{ij}$ as constant over the time step:\n$$ \\frac{ds}{dt} = \\frac{d\\mathbf{v}_{ij}}{dt} \\cdot \\hat{\\mathbf{r}}_{ij} = \\mathbf{a}_{ij} \\cdot \\hat{\\mathbf{r}}_{ij} $$\nSubstituting the expression for $\\mathbf{a}_{ij}$ and the given DPD dissipative force, $\\mathbf{F}_{ij}^{D} = -\\gamma w_{D}(r_{ij}) (\\mathbf{v}_{ij} \\cdot \\hat{\\mathbf{r}}_{ij}) \\hat{\\mathbf{r}}_{ij} = -\\gamma w_{D}(r_{ij}) s \\hat{\\mathbf{r}}_{ij}$:\n$$ \\frac{ds}{dt} = \\left(\\frac{2}{m} \\mathbf{F}_{ij}^{D}\\right) \\cdot \\hat{\\mathbf{r}}_{ij} = \\frac{2}{m} \\left( -\\gamma w_{D}(r_{ij}) s \\hat{\\mathbf{r}}_{ij} \\right) \\cdot \\hat{\\mathbf{r}}_{ij} $$\nSince $\\hat{\\mathbf{r}}_{ij} \\cdot \\hat{\\mathbf{r}}_{ij} = 1$:\n$$ \\frac{ds}{dt} = -\\frac{2\\gamma w_{D}(r_{ij})}{m} s $$\nThis is a first-order linear ODE of the form $ds/dt = -\\lambda s$, with decay rate $\\lambda = \\frac{2\\gamma w_{D}(r_{ij})}{m}$.\n\nThe forward Euler update rule for a time step $\\Delta t$ is $s_{n+1} = s_n + \\Delta t (-\\lambda s_n) = (1 - \\lambda \\Delta t) s_n$.\nMonotonic decay without sign change requires the amplification factor $G = 1 - \\lambda \\Delta t$ to satisfy $0 \\le G \\le 1$. The non-trivial condition is $G \\ge 0$, which gives $\\lambda \\Delta t \\le 1$.\nThis imposes the stability constraint on the time step:\n$$ \\Delta t \\le \\frac{1}{\\lambda} $$\nThe maximal time step $\\Delta t_{\\max}$ is therefore:\n$$ \\Delta t_{\\max} = \\frac{1}{\\lambda} = \\frac{m}{2\\gamma w_{D}(r_{ij})} $$\nThis is the final expression for the maximal time step that guarantees monotonic decay for the forward Euler integration of the DPD dissipative force under the stated approximations.",
            "answer": "$$\\boxed{\\frac{m}{2\\gamma w_{D}(r_{ij})}}$$"
        },
        {
            "introduction": "Choosing a stable time step is necessary but not sufficient for obtaining accurate physical measurements from a simulation. Numerical integrators introduce systematic errors, or bias, causing measured properties like viscosity to depend on the chosen time step, $\\Delta t$. This advanced practice moves beyond stability to the issue of accuracy, providing a robust statistical framework based on backward error analysis to extrapolate simulation data to the continuum limit ($\\Delta t \\to 0$) and recover the true physical value.",
            "id": "3751641",
            "problem": "Consider a fluid modeled by Dissipative Particle Dynamics (DPD), where mesoscopic particles of mass $m$ interact via pairwise forces that are the sum of a conservative, a dissipative, and a random component. The equations of motion for particle $i$ are Newton's second law, $m \\, \\frac{d \\mathbf{v}_i}{dt} = \\sum_{j \\ne i} \\mathbf{F}_{ij}$ and $\\frac{d \\mathbf{r}_i}{dt} = \\mathbf{v}_i$, and the DPD pairwise force $\\mathbf{F}_{ij}$ has three contributions,\n$$\n\\mathbf{F}_{ij} = \\mathbf{F}_{ij}^{\\mathrm{C}} + \\mathbf{F}_{ij}^{\\mathrm{D}} + \\mathbf{F}_{ij}^{\\mathrm{R}}.\n$$\nThe conservative force is $\\mathbf{F}_{ij}^{\\mathrm{C}} = a \\, w^{\\mathrm{C}}(r_{ij}) \\, \\hat{\\mathbf{r}}_{ij}$, the dissipative force is $\\mathbf{F}_{ij}^{\\mathrm{D}} = -\\gamma \\, w^{\\mathrm{D}}(r_{ij}) \\, (\\mathbf{v}_{ij} \\cdot \\hat{\\mathbf{r}}_{ij}) \\, \\hat{\\mathbf{r}}_{ij}$, and the random force is $\\mathbf{F}_{ij}^{\\mathrm{R}} = \\sigma \\, w^{\\mathrm{R}}(r_{ij}) \\, \\xi_{ij} \\, \\Delta t^{-1/2} \\, \\hat{\\mathbf{r}}_{ij}$, where $\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$, $r_{ij} = \\|\\mathbf{r}_{ij}\\|$, $\\hat{\\mathbf{r}}_{ij} = \\mathbf{r}_{ij}/r_{ij}$, $\\mathbf{v}_{ij} = \\mathbf{v}_i - \\mathbf{v}_j$, $a$ is the conservative amplitude, $\\gamma$ is the dissipative coefficient, $\\sigma$ is the random force amplitude satisfying the fluctuation-dissipation relation $\\sigma^2 = 2 \\gamma k_{\\mathrm{B}} T$ with Boltzmann constant $k_{\\mathrm{B}}$ and temperature $T$, $w^{\\mathrm{C}}$, $w^{\\mathrm{D}}$, and $w^{\\mathrm{R}}$ are weight functions vanishing beyond a cutoff, and $\\xi_{ij}$ are independent, zero-mean, unit-variance Gaussian random variables with $\\xi_{ij} = \\xi_{ji}$. A common numerical integrator for DPD uses a time step $\\Delta t$ to advance positions and velocities by a splitting or modified velocity Verlet scheme.\n\nWhen estimating a transport coefficient such as the dynamic viscosity $\\eta$ from DPD, either via a Non-Equilibrium Molecular Dynamics (NEMD) setup (imposing shear and measuring the shear stress) or via the Green-Kubo (GK) relation (time correlation of the off-diagonal stress components), discretization introduces bias that depends on the time step $\\Delta t$. For sufficiently small $\\Delta t$, a backward error analysis of consistent, stable integrators implies that the invariant measure of the numerical method differs from the exact invariant measure by a perturbation that is smooth in $\\Delta t$, and therefore expectations of sufficiently regular observables, including $\\eta$, admit an expansion in powers of $\\Delta t$. Consequently, one expects a model of the form\n$$\n\\eta(\\Delta t) = \\eta_0 + c_1 \\, \\Delta t + c_2 \\, (\\Delta t)^2 + \\cdots,\n$$\nwhere $\\eta_0$ is the continuum limit viscosity as $\\Delta t \\to 0$, and $c_1$, $c_2$, $\\ldots$ are coefficients determined by the integrator, thermostat, and the observable definition. The goal is to design an algorithmic procedure to quantify the dependence $\\eta(\\Delta t)$ from a finite set of measurements and to extrapolate to $\\Delta t \\to 0$ to remove discretization bias.\n\nStarting from Newton's laws and the DPD force definitions, explain why a polynomial-in-$\\Delta t$ ansatz for $\\eta(\\Delta t)$ is justified, and develop a robust extrapolation procedure that, given measured viscosities at a set of time steps and associated measurement uncertainties, returns an estimate of $\\eta_0$ by model selection among linear and quadratic bias models using cross-validation, and weighted least squares fitting consistent with measurement uncertainties.\n\nYour program must implement the following algorithmic requirements:\n\n- Accept, as fixed inputs embedded in the program, several test cases, each consisting of a list of time steps $\\{\\Delta t_i\\}$, a list of measured viscosities $\\{\\eta_i\\}$ in DPD reduced units, and a list of measurement standard deviations $\\{\\sigma_i\\}$ for each $\\eta_i$.\n- For each test case, consider two candidate models for the discretization bias: linear, $\\eta(\\Delta t) = \\eta_0 + c_1 \\, \\Delta t$, and quadratic, $\\eta(\\Delta t) = \\eta_0 + c_1 \\, \\Delta t + c_2 \\, (\\Delta t)^2$.\n- Use leave-one-out cross-validation to select the model order. For each candidate model, compute the leave-one-out predicted viscosity for each data point by fitting the model to all other points using weighted least squares with weights $w_i = 1/\\sigma_i^2$, then compute the weighted mean squared error defined by $\\mathrm{WMSE} = \\left(\\sum_i w_i (\\eta_i - \\hat{\\eta}_i)^2\\right) \\big/ \\left(\\sum_i w_i\\right)$. Select the model with the smaller $\\mathrm{WMSE}$; if the $\\mathrm{WMSE}$ values are equal within a tolerance of $10^{-12}$, select the lower-order model.\n- With the selected model, fit the full dataset using weighted least squares and return the intercept $\\eta_0$ as the extrapolated viscosity at $\\Delta t = 0$.\n- Express all viscosities in DPD reduced units, and in the final output round each extrapolated $\\eta_0$ to six decimal places.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\eta_0^{(1)},\\eta_0^{(2)},\\eta_0^{(3)}]$, where the superscript denotes the test case index.\n\nTest Suite:\n\n- Case $1$ (linear bias dominated, varying uncertainties): $\\Delta t$ values $[0.04, 0.06, 0.08, 0.10, 0.12]$, measured viscosities $\\eta$ values $[1.286, 1.304, 1.322, 1.340, 1.358]$ in DPD reduced units, uncertainties $\\sigma$ values $[0.004, 0.003, 0.003, 0.002, 0.002]$.\n- Case $2$ (quadratic bias dominated, equal uncertainties): $\\Delta t$ values $[0.02, 0.04, 0.06, 0.08, 0.10]$, measured viscosities $\\eta$ values $[0.7516, 0.7564, 0.7644, 0.7756, 0.7900]$ in DPD reduced units, uncertainties $\\sigma$ values $[0.003, 0.003, 0.003, 0.003, 0.003]$.\n- Case $3$ (mixed linear and quadratic bias, heterogeneous uncertainties): $\\Delta t$ values $[0.01, 0.03, 0.05, 0.07, 0.09]$, measured viscosities $\\eta$ values $[1.0022, 1.0078, 1.0150, 1.0238, 1.0342]$ in DPD reduced units, uncertainties $\\sigma$ values $[0.0010, 0.0020, 0.0015, 0.0020, 0.0025]$.\n\nYour task is to implement the described procedure and produce the final output line containing the three extrapolated viscosities $[\\eta_0^{(1)},\\eta_0^{(2)},\\eta_0^{(3)}]$, rounded to six decimal places, in DPD reduced units.",
            "solution": "The problem asks for two main components: first, a justification for the polynomial dependence of the measured viscosity $\\eta$ on the simulation time step $\\Delta t$, and second, the design and implementation of a robust algorithm to extrapolate a set of measured viscosities $\\{\\eta_i\\}$ at different time steps $\\{\\Delta t_i\\}$ to the continuum limit $\\Delta t \\to 0$.\n\n### Justification for Polynomial Dependence on Time Step $\\Delta t$\n\nThe dynamics of the Dissipative Particle Dynamics (DPD) system are governed by Newton's second law, which constitutes a system of second-order ordinary differential equations (ODEs):\n$$\nm \\frac{d^2 \\mathbf{r}_i}{dt^2} = \\mathbf{F}_i(\\{\\mathbf{r}_j\\}, \\{\\mathbf{v}_j\\})\n$$\nwhere $\\mathbf{F}_i = \\sum_{j \\ne i} \\mathbf{F}_{ij}$ is the total force on particle $i$. These ODEs describe the evolution of the system in continuous time.\n\nNumerical simulations, however, must discretize time, advancing the system state from time $t$ to $t+\\Delta t$ using a numerical integrator. A powerful tool for analyzing the errors introduced by this discretization is backward error analysis.\n\nFor a consistent numerical integrator of order $p$, backward error analysis demonstrates that the numerical trajectory is, to a high degree of accuracy, the *exact* trajectory of a *modified* or *shadow* system of ODEs. These modified equations differ from the original ones by a series of perturbation terms expressed in powers of the time step $\\Delta t$:\n$$\n\\frac{d \\tilde{\\mathbf{y}}}{dt} = f(\\tilde{\\mathbf{y}}) + (\\Delta t)^p f_p(\\tilde{\\mathbf{y}}) + (\\Delta t)^{p+1} f_{p+1}(\\tilde{\\mathbf{y}}) + \\dots\n$$\nwhere $f(\\mathbf{y})$ represents the original equations of motion. For many symmetric, time-reversible integrators (like the standard velocity Verlet algorithm applied to Hamiltonian systems), the expansion contains only even powers of $\\Delta t$. However, the DPD force includes non-Hamiltonian dissipative and random components, and the splitting schemes used to integrate them generally break this simple symmetry. The resulting modified equations of motion for DPD systems therefore contain error terms with both even and odd powers of $\\Delta t$.\n\nThe viscosity $\\eta$ is a transport coefficient calculated as an expectation value over the system's trajectory. When this expectation is computed using a numerical integrator, we are sampling the statistical ensemble corresponding to the *modified* equations of motion. Since the modified dynamics are a smooth perturbation of the original dynamics in powers of $\\Delta t$, the expectation values of sufficiently regular observables also admit a smooth expansion in $\\Delta t$. For small $\\Delta t$, this justifies the polynomial ansatz:\n$$\n\\eta(\\Delta t) = \\eta_0 + c_1 \\Delta t + c_2 (\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\nHere, $\\eta_0$ is the true, physical viscosity of the continuum model, which is recovered in the limit $\\Delta t \\to 0$. The goal of the extrapolation procedure is to estimate $\\eta_0$ by fitting this model to simulation data obtained at several finite $\\Delta t$.\n\n### Algorithmic Procedure for Extrapolation\n\nThe task is to determine $\\eta_0$ from a finite set of measurements $\\{(\\Delta t_i, \\eta_i, \\sigma_i)\\}_{i=1}^N$. The procedure involves model selection between a linear and a quadratic model, followed by a final parameter fit.\n\n**1. Candidate Models**\n- **Linear Bias Model:** $\\eta(\\Delta t) = p_1(\\Delta t) = \\eta_0 + c_1 \\Delta t$\n- **Quadratic Bias Model:** $\\eta(\\Delta t) = p_2(\\Delta t) = \\eta_0 + c_1 \\Delta t + c_2 (\\Delta t)^2$\n\n**2. Weighted Least Squares (WLS) Fitting**\nGiven that the measurements $\\eta_i$ have different uncertainties $\\sigma_i$, a weighted least squares (WLS) fit is appropriate, minimizing the sum of squared, weighted residuals, $\\chi^2$. The weights are the inverse of the variance: $w_i = 1/\\sigma_i^2$. For a model $f(\\Delta t; \\boldsymbol{\\beta})$ with parameters $\\boldsymbol{\\beta}$, WLS minimizes:\n$$ \\chi^2(\\boldsymbol{\\beta}) = \\sum_{i=1}^N w_i (\\eta_i - f(\\Delta t_i; \\boldsymbol{\\beta}))^2 $$\nFor polynomial models, this has a closed-form solution.\n\n**3. Model Selection using Leave-One-Out Cross-Validation (LOOCV)**\nTo choose between the models without overfitting, we use LOOCV. For each candidate model (linear and quadratic):\n1. For each data point $k \\in \\{1, \\dots, N\\}$:\n    a. Remove the $k$-th data point.\n    b. Fit the model to the remaining $N-1$ points using WLS.\n    c. Use the fitted model to predict the viscosity at the held-out time step, $\\hat{\\eta}_k$.\n2. After iterating through all $k$, compute the Weighted Mean Squared Error (WMSE):\n$$ \\mathrm{WMSE} = \\frac{\\sum_{k=1}^N w_k (\\eta_k - \\hat{\\eta}_k)^2}{\\sum_{k=1}^N w_k} $$\n3. The model with the lower WMSE is selected. In case of a tie (within a tolerance of $10^{-12}$), the simpler (linear) model is chosen.\n\n**4. Final Extrapolation**\nOnce the optimal model order is determined, a final WLS fit is performed using that model on the *entire* dataset. The intercept of this fit, $\\eta_0$, is the extrapolated continuum-limit viscosity. The result is rounded to six decimal places.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the extrapolated viscosity eta_0 for several DPD simulation test cases.\n    The method involves model selection (linear vs. quadratic) using leave-one-out\n    cross-validation with a weighted mean squared error metric, followed by a final\n    weighted least squares fit to determine eta_0.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"dt\": [0.04, 0.06, 0.08, 0.10, 0.12],\n            \"eta\": [1.286, 1.304, 1.322, 1.340, 1.358],\n            \"sigma\": [0.004, 0.003, 0.003, 0.002, 0.002],\n        },\n        {\n            \"dt\": [0.02, 0.04, 0.06, 0.08, 0.10],\n            \"eta\": [0.7516, 0.7564, 0.7644, 0.7756, 0.7900],\n            \"sigma\": [0.003, 0.003, 0.003, 0.003, 0.003],\n        },\n        {\n            \"dt\": [0.01, 0.03, 0.05, 0.07, 0.09],\n            \"eta\": [1.0022, 1.0078, 1.0150, 1.0238, 1.0342],\n            \"sigma\": [0.0010, 0.0020, 0.0015, 0.0020, 0.0025],\n        },\n    ]\n\n    extrapolated_viscosities = []\n\n    def fit_wls(x, y, w, order):\n        \"\"\"\n        Performs weighted least squares fitting for a polynomial of a given order.\n\n        Args:\n            x (np.ndarray): Independent variable data.\n            y (np.ndarray): Dependent variable data.\n            w (np.ndarray): Weights for the data points.\n            order (int): The order of the polynomial (1 for linear, 2 for quadratic).\n\n        Returns:\n            np.ndarray: The fitted polynomial coefficients [c0, c1, ...].\n                        The intercept (eta_0) is the first element.\n        \"\"\"\n        if order == 1:\n            A = np.vstack([np.ones_like(x), x]).T\n        elif order == 2:\n            A = np.vstack([np.ones_like(x), x, x**2]).T\n        else:\n            raise ValueError(\"Only order 1 (linear) and 2 (quadratic) are supported.\")\n        \n        W_sqrt = np.diag(np.sqrt(w))\n        A_prime = W_sqrt @ A\n        y_prime = W_sqrt @ y\n        \n        coeffs, _, _, _ = np.linalg.lstsq(A_prime, y_prime, rcond=None)\n        return coeffs\n\n    for case in test_cases:\n        dt = np.array(case[\"dt\"])\n        eta = np.array(case[\"eta\"])\n        sigma = np.array(case[\"sigma\"])\n        weights = 1.0 / sigma**2\n        num_points = len(dt)\n\n        wmse_results = {}\n        for order in [1, 2]:  # 1 for linear, 2 for quadratic\n            predictions = np.zeros(num_points)\n            for i in range(num_points):\n                # Create leave-one-out training set\n                dt_train = np.delete(dt, i)\n                eta_train = np.delete(eta, i)\n                weights_train = np.delete(weights, i)\n\n                # Fit model on training data\n                coeffs = fit_wls(dt_train, eta_train, weights_train, order)\n\n                # Predict value for the held-out point\n                if order == 1:\n                    predictions[i] = coeffs[0] + coeffs[1] * dt[i]\n                else:  # order == 2\n                    predictions[i] = coeffs[0] + coeffs[1] * dt[i] + coeffs[2] * dt[i]**2\n            \n            # Calculate Weighted Mean Squared Error for the out-of-sample predictions\n            weighted_squared_errors = weights * (eta - predictions)**2\n            wmse = np.sum(weighted_squared_errors) / np.sum(weights)\n            wmse_results[order] = wmse\n\n        # Model selection based on WMSE\n        # If linear WMSE is less than or equal to quadratic (with tolerance), choose linear.\n        if wmse_results[1] = wmse_results[2] + 1e-12:\n            selected_order = 1\n        else:\n            selected_order = 2\n\n        # Final fit on the full dataset with the selected model\n        final_coeffs = fit_wls(dt, eta, weights, selected_order)\n        eta_0 = final_coeffs[0]\n        \n        extrapolated_viscosities.append(eta_0)\n\n    # Format the final output as a string with results rounded to six decimal places.\n    formatted_results = [f\"{result:.6f}\" for result in extrapolated_viscosities]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}