{
    "hands_on_practices": [
        {
            "introduction": "This practice delves into the DPD conservative force, the foundation of particle interactions in this model. By deriving the corresponding potential energy, you will reinforce a core concept from classical mechanics. More importantly, this exercise  demonstrates how the mathematical form of the potential—specifically its 'softness' or curvature—directly influences the numerical stability of a simulation and guides the choice of a stable integration time step, $\\Delta t$.",
            "id": "3751652",
            "problem": "Consider a pair of particles interacting via the conservative part of the Dissipative Particle Dynamics (DPD) model. The conservative pair force between particles $i$ and $j$ is given by $\\mathbf{F}_{ij}^{C} = a_{ij}\\,w^{C}(r_{ij})\\,\\hat{\\mathbf{r}}_{ij}$, where $r_{ij}$ is the interparticle separation, $\\hat{\\mathbf{r}}_{ij}$ is the unit vector along the separation, $a_{ij}$ is a positive constant setting the repulsion strength, and $w^{C}(r)$ is a smooth cutoff weight function that vanishes at the cutoff distance $r_{c}>0$ and is linear on $[0,r_{c}]$. Assume the standard linear choice $w^{C}(r) = 1 - r/r_{c}$ for $0 \\le r \\le r_{c}$ and $w^{C}(r) = 0$ for $r > r_{c}$. Let the pair potential $U(r)$ be defined by $F_{r}(r) = -\\,\\mathrm{d}U/\\mathrm{d}r$ and the reference condition $U(r_{c})=0$, so that the conservative force is purely repulsive and the potential energy vanishes at $r=r_{c}$.\n\nStarting from these definitions and Newton’s second law, derive the expression for $U(r)$ on $[0,r_{c}]$ and compute the conservative potential energy change $\\Delta U = U(r_{2}) - U(r_{1})$ when two particles are moved quasi-statically from separation $r_{1}$ to separation $r_{2}$, both strictly less than $r_{c}$. Take reduced DPD units with $r_{c} = 1$ and thermal energy $k_{B}T = 1$, and use the parameter values $a_{ij} = 40$, $r_{1} = 0.80$, and $r_{2} = 0.50$. Express the final energy change in units of $k_{B}T$ and round your answer to four significant figures.\n\nSeparately, discuss the implications of the computed $\\Delta U$ for numerical stability when using explicit time integration at large time steps in the full DPD dynamics that includes dissipative and random forces. In your discussion, clearly state the forms of the dissipative and random forces, the fluctuation–dissipation relation that links their amplitudes, and how the conservative potential curvature near $r \\approx r_{c}$ informs a stiffness-based step-size constraint.",
            "solution": "The user wants me to solve a problem based on the Dissipative Particle Dynamics (DPD) model.\n\n### Step 1: Extract Givens\n-   **Conservative Force Law**: The conservative pair force between particles $i$ and $j$ is $\\mathbf{F}_{ij}^{C} = a_{ij}\\,w^{C}(r_{ij})\\,\\hat{\\mathbf{r}}_{ij}$.\n-   **Repulsion Strength**: $a_{ij}$ is a positive constant.\n-   **Weight Function**: $w^{C}(r) = 1 - r/r_{c}$ for $0 \\le r \\le r_{c}$, and $w^{C}(r) = 0$ for $r > r_{c}$.\n-   **Cutoff Distance**: $r_{c} > 0$.\n-   **Force-Potential Relationship**: The radial component of the force is $F_{r}(r) = -\\,\\mathrm{d}U/\\mathrm{d}r$.\n-   **Potential Reference Condition**: $U(r_{c})=0$.\n-   **Task 1**: Derive the expression for the pair potential $U(r)$ on the interval $[0, r_{c}]$.\n-   **Task 2**: Compute the potential energy change $\\Delta U = U(r_{2}) - U(r_{1})$.\n-   **Reduced Units and Parameters**: $r_{c} = 1$, $k_{B}T = 1$, $a_{ij} = 40$, $r_{1} = 0.80$, $r_{2} = 0.50$.\n-   **Output Format**: The final numerical answer for $\\Delta U$ should be in units of $k_{B}T$ and rounded to four significant figures.\n-   **Task 3**: Discuss the implications of the computed $\\Delta U$ for numerical stability in a full DPD simulation, including the forms of the dissipative and random forces, the fluctuation-dissipation relation, and the connection between potential curvature and time step constraints.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is based on the standard and widely used Dissipative Particle Dynamics (DPD) model. The definitions of the conservative force, its relation to potential energy, the fluctuation-dissipation theorem, and the principles of numerical stability for molecular dynamics are all well-established concepts in computational physics and chemistry. The problem is scientifically sound.\n-   **Well-Posed**: The problem provides all necessary definitions, constants, and parameters to derive the potential and compute the energy change. The second part of the problem, a discussion, is clearly scoped. A unique and meaningful solution exists.\n-   **Objective**: The language is formal, precise, and devoid of any subjective or ambiguous statements.\n\nThe problem does not violate any of the invalidity criteria. It is scientifically sound, well-posed, objective, and directly relevant to the specified topic.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Derivation of the Potential Energy Function $U(r)$\n\nThe radial component of the conservative force, $F^C(r)$, is the magnitude of $\\mathbf{F}_{ij}^{C}$ and is directed along $-\\hat{\\mathbf{r}}_{ij}$ for a repulsive force.\nThe problem defines $\\mathbf{F}_{ij}^{C} = a_{ij}\\,w^{C}(r_{ij})\\,\\hat{\\mathbf{r}}_{ij}$. The force on particle $i$ due to $j$ is along the vector from $j$ to $i$. A positive $a_{ij}$ and $w^C(r) > 0$ for $r < r_c$ means the force is repulsive. The radial force $F_r(r)$ acting on one particle, which tends to increase the separation $r$, is given by the magnitude of $\\mathbf{F}_{ij}^{C}$.\n$$F_r(r) = a_{ij} w^C(r) = a_{ij} \\left(1 - \\frac{r}{r_c}\\right) \\quad \\text{for } 0 \\le r \\le r_c$$\nThe potential energy $U(r)$ is related to this force component by:\n$$F_r(r) = -\\frac{\\mathrm{d}U}{\\mathrm{d}r}$$\nTherefore, we have the differential equation for the potential:\n$$\\frac{\\mathrm{d}U}{\\mathrm{d}r} = -F_r(r) = -a_{ij} \\left(1 - \\frac{r}{r_c}\\right)$$\nTo find $U(r)$, we integrate this expression with respect to $r$. We use the given reference condition $U(r_c) = 0$. We can integrate from a generic separation $r$ to the cutoff $r_c$:\n$$U(r_c) - U(r) = \\int_r^{r_c} \\frac{\\mathrm{d}U}{\\mathrm{d}r'} \\mathrm{d}r'$$\n$$0 - U(r) = \\int_r^{r_c} \\left[-a_{ij} \\left(1 - \\frac{r'}{r_c}\\right)\\right] \\mathrm{d}r'$$\n$$U(r) = a_{ij} \\int_r^{r_c} \\left(1 - \\frac{r'}{r_c}\\right) \\mathrm{d}r'$$\nPerforming the integration:\n$$U(r) = a_{ij} \\left[ r' - \\frac{(r')^2}{2r_c} \\right]_r^{r_c}$$\n$$U(r) = a_{ij} \\left( \\left(r_c - \\frac{r_c^2}{2r_c}\\right) - \\left(r - \\frac{r^2}{2r_c}\\right) \\right)$$\n$$U(r) = a_{ij} \\left( \\left(r_c - \\frac{r_c}{2}\\right) - r + \\frac{r^2}{2r_c} \\right)$$\n$$U(r) = a_{ij} \\left( \\frac{r_c}{2} - r + \\frac{r^2}{2r_c} \\right)$$\nThis can be rewritten in a more compact form:\n$$U(r) = \\frac{a_{ij}}{2r_c} \\left( r_c^2 - 2rr_c + r^2 \\right) = \\frac{a_{ij}}{2r_c} (r_c - r)^2$$\nThis expression is valid for $0 \\le r \\le r_c$. For $r > r_c$, the force is zero, and consistent with $U(r_c)=0$, we have $U(r) = 0$.\n\n### Calculation of the Potential Energy Change $\\Delta U$\n\nWe are asked to compute the change in potential energy, $\\Delta U = U(r_{2}) - U(r_{1})$, for the given parameters. Both $r_1=0.80$ and $r_2=0.50$ are less than $r_c=1$, so we can use the derived formula for $U(r)$.\n$$\\Delta U = U(r_2) - U(r_1) = \\frac{a_{ij}}{2r_c}(r_c - r_2)^2 - \\frac{a_{ij}}{2r_c}(r_c - r_1)^2$$\n$$\\Delta U = \\frac{a_{ij}}{2r_c} \\left[ (r_c - r_2)^2 - (r_c - r_1)^2 \\right]$$\nNow, we substitute the numerical values: $a_{ij} = 40$, $r_c = 1$, $r_1 = 0.80$, and $r_2 = 0.50$. The energy is in units of $k_B T = 1$.\n$$\\Delta U = \\frac{40}{2(1)} \\left[ (1 - 0.50)^2 - (1 - 0.80)^2 \\right]$$\n$$\\Delta U = 20 \\left[ (0.50)^2 - (0.20)^2 \\right]$$\n$$\\Delta U = 20 [ 0.25 - 0.04 ]$$\n$$\\Delta U = 20 [ 0.21 ]$$\n$$\\Delta U = 4.2$$\nThe problem requires the answer to be rounded to four significant figures.\n$\\Delta U = 4.200$. The units are $k_B T$.\n\n### Discussion of Numerical Stability\n\nIn a full DPD simulation, the total force $\\mathbf{F}_{ij}$ between particles $i$ and $j$ is the sum of a conservative force ($\\mathbf{F}_{ij}^C$), a dissipative force ($\\mathbf{F}_{ij}^D$), and a random force ($\\mathbf{F}_{ij}^R$):\n$$\\mathbf{F}_{ij} = \\mathbf{F}_{ij}^C + \\mathbf{F}_{ij}^D + \\mathbf{F}_{ij}^R$$\nThe conservative force $\\mathbf{F}_{ij}^C$ was given in the problem. The dissipative and random forces are:\n-   **Dissipative Force**: $\\mathbf{F}_{ij}^D = -\\gamma \\, w^D(r_{ij}) (\\hat{\\mathbf{r}}_{ij} \\cdot \\mathbf{v}_{ij}) \\hat{\\mathbf{r}}_{ij}$, where $\\gamma$ is the friction coefficient, $\\mathbf{v}_{ij} = \\mathbf{v}_i - \\mathbf{v}_j$ is the relative velocity, and $w^D(r)$ is a weight function that vanishes for $r \\ge r_c$.\n-   **Random Force**: $\\mathbf{F}_{ij}^R = \\sigma \\, w^R(r_{ij}) \\zeta_{ij}(t) \\hat{\\mathbf{r}}_{ij}$, where $\\sigma$ is the noise amplitude, $w^R(r)$ is another weight function, and $\\zeta_{ij}(t)$ is a random variable with zero mean and unit variance, representing Gaussian white noise.\n\nFor the system to correctly sample the canonical (NVT) ensemble, the dissipative and random forces must be related by the **fluctuation-dissipation theorem**:\n$$\\sigma^2 = 2 \\gamma k_B T$$\nAdditionally, the weight functions are related, a common choice being $w^D(r) = [w^R(r)]^2$.\n\nThe numerical stability of explicit time integration schemes, such as the Velocity Verlet algorithm commonly used in DPD, is limited by the time step $\\Delta t$. A stable simulation requires that $\\Delta t$ be small enough to resolve the fastest motions in the system. The highest frequency of oscillation, $\\omega_{\\max}$, is determined by the stiffest part of the potential, characterized by the curvature $k(r) = \\mathrm{d}^2U/\\mathrm{d}r^2$. The stability condition is roughly $\\Delta t \\ll 2\\pi/\\omega_{\\max}$.\n\nFor the DPD conservative potential derived earlier, $U(r) = \\frac{a_{ij}}{2r_c}(r_c - r)^2$, the curvature for $r < r_c$ is:\n$$k(r) = \\frac{\\mathrm{d}^2U}{\\mathrm{d}r^2} = \\frac{\\mathrm{d}}{\\mathrm{d}r} \\left(-\\frac{a_{ij}}{r_c}(r_c - r)\\right) = \\frac{a_{ij}}{r_c}$$\nThis reveals a key feature of the standard DPD model: the potential curvature (stiffness) is constant for all separations $r < r_c$. With the given parameters, the stiffness is $k = 40/1 = 40$ in reduced units. Contrary to the prompt's phrasing \"near $r \\approx r_{c}$\", the stiffness is not localized but uniform throughout the interaction range. At $r=r_c$, the curvature discontinuously drops to zero.\n\nThe maximum frequency of oscillation for a pair of particles of mass $m$ is approximately $\\omega_{\\max} \\approx \\sqrt{k_{\\text{eff}}/m}$, where $k_{\\text{eff}}$ is related to the potential stiffness. For a pair interaction, the relevant frequency is related to the reduced mass $\\mu = m/2$ and the potential curvature $k=a_{ij}/r_c$, giving $\\omega \\approx \\sqrt{k/\\mu} = \\sqrt{2a_{ij}/(mr_c)}$. The time step constraint is then:\n$$\\Delta t \\lesssim C \\sqrt{\\frac{m r_c}{a_{ij}}}$$\nwhere $C$ is a constant of order $1$.\n\nThe computed energy change, $\\Delta U = 4.200 \\, k_B T$, is substantial for a displacement of only $0.3 r_c$. This large energy change is a direct consequence of the large repulsion parameter $a_{ij}=40$. A large $a_{ij}$ leads to a stiff potential. The large value of $\\Delta U$ thus signals that the conservative forces are strong and can cause large accelerations, which in turn necessitates a small integration time step $\\Delta t$ to prevent numerical instabilities (e.g., energy blow-up from particles overshooting each other). If $\\Delta t$ were too large, a particle could travel a significant distance in one step, entering a region of very high potential energy, leading to an extremely large force in the next step and a catastrophic failure of the integration. Therefore, the magnitude of $\\Delta U$ serves as an indicator of the system's stiffness, which directly informs the choice of a stable $\\Delta t$.",
            "answer": "$$\\boxed{4.200}$$"
        },
        {
            "introduction": "This exercise demonstrates the emergent thermodynamic behavior that arises from the DPD force rules. By considering a hypothetical system with only dissipative and random forces, you will see how their specific coupling via the Fluctuation-Dissipation Theorem gives rise to a pairwise thermostat. This practice  connects the microscopic particle dynamics to macroscopic statistical mechanics by deriving the velocity autocorrelation function, a key quantity for understanding thermal equilibrium and transport phenomena.",
            "id": "3751682",
            "problem": "Consider Dissipative Particle Dynamics (DPD), where the pairwise force between particles $i$ and $j$ is the sum of a conservative force $F_{ij}^{C}$, a dissipative force $F_{ij}^{D}$, and a random force $F_{ij}^{R}$. The dissipative and random forces are defined by\n$$\n\\mathbf{F}_{ij}^{D} = -\\gamma\\, w^{D}(r_{ij}) \\left[ \\left( \\mathbf{v}_{i} - \\mathbf{v}_{j} \\right) \\cdot \\hat{\\mathbf{r}}_{ij} \\right] \\hat{\\mathbf{r}}_{ij}, \\quad \\mathbf{F}_{ij}^{R} = \\sigma\\, w^{R}(r_{ij})\\, \\xi_{ij}(t)\\, \\hat{\\mathbf{r}}_{ij},\n$$\nwhere $\\gamma$ is a friction parameter, $\\sigma$ is a noise amplitude, $r_{ij} = |\\mathbf{r}_{i} - \\mathbf{r}_{j}|$, $\\hat{\\mathbf{r}}_{ij} = (\\mathbf{r}_{i} - \\mathbf{r}_{j})/r_{ij}$, and $\\xi_{ij}(t)$ is a symmetric Gaussian white noise satisfying\n$$\n\\langle \\xi_{ij}(t) \\rangle = 0, \\quad \\langle \\xi_{ij}(t) \\xi_{kl}(t') \\rangle = \\left( \\delta_{ik}\\delta_{jl} + \\delta_{il}\\delta_{jk} \\right) \\delta(t - t').\n$$\nAssume that the conservative force vanishes, $F_{ij}^{C} = 0$, and DPD is operated under the Fluctuation-Dissipation Theorem (FDT) conditions, namely\n$$\n\\sigma^{2} = 2 \\gamma k_{B} T, \\quad w^{D}(r) = \\left[w^{R}(r)\\right]^{2},\n$$\nwith $k_{B}$ the Boltzmann constant and $T$ the absolute temperature. Let the random weight be the standard DPD choice\n$$\nw^{R}(r) = \\begin{cases}\n1 - \\dfrac{r}{r_{c}}, & 0 \\le r \\le r_{c}, \\\\\n0, & r > r_{c},\n\\end{cases}\n$$\nwhere $r_{c} > 0$ is a cutoff radius. Consider a spatially homogeneous system in $3$ dimensions with uniform number density $\\rho$, and neglect static and dynamic correlations beyond isotropy (ideal-gas closure), so that the pair distribution is $g(r) = 1$ and neighbor velocities are uncorrelated with $\\mathbf{v}_{i}$ and have zero mean.\n\nStarting from Newton’s second law and the definitions above, show that when $F_{ij}^{C} = 0$ the dynamics reduces to that of an ideal gas subject to a pairwise thermostat, and derive the velocity autocorrelation function $C(t) = \\langle \\mathbf{v}_{i}(t) \\cdot \\mathbf{v}_{i}(0) \\rangle$ for a tagged particle $i$ under the FDT conditions and the stated closure. Express your final answer as a closed-form analytic expression in terms of $m$, $\\gamma$, $\\rho$, $r_{c}$, $k_{B}$, $T$, and $t$. Do not substitute numerical values. You may assume isotropic angular averages where appropriate. No rounding is required. Use consistent International System of Units (SI) for any dimensional parameters if you later substitute numbers, but provide the analytic expression only.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It represents a standard theoretical derivation in the field of multiscale modeling. The omission of the particle mass $m$ from the initial list of givens is rectified by its inclusion in the list of variables for the final answer, making its role clear.\n\nFirst, we address the conceptual part of the problem. An ideal gas in statistical mechanics is a system of particles that do not exert long-range forces on each other; their interaction potential is zero. In DPD, the conservative force $\\mathbf{F}_{ij}^{C}$ is derived from a pair potential, $\\mathbf{F}_{ij}^{C} = -\\nabla_{\\mathbf{r}_i} U(r_{ij})$. The condition $\\mathbf{F}_{ij}^{C} = 0$ implies that this potential is constant, meaning the particles do not interact in the conservative sense. This establishes the \"ideal gas\" nature of the system. The remaining forces, $\\mathbf{F}_{ij}^{D}$ and $\\mathbf{F}_{ij}^{R}$, are the dissipative and random forces, respectively. These forces are not derived from a potential. Instead, they model the exchange of energy and momentum with a surrounding medium or heat bath. The combination of these two forces, constrained by the Fluctuation-Dissipation Theorem (FDT), acts as a thermostat that maintains the system at a constant average temperature $T$. Since these forces act between pairs of particles ($i, j$), they constitute a pairwise thermostat. Therefore, a DPD system with $\\mathbf{F}_{ij}^{C} = 0$ is correctly described as an ideal gas subject to a pairwise thermostat.\n\nNext, we derive the velocity autocorrelation function (VACF), $C(t) = \\langle \\mathbf{v}_{i}(t) \\cdot \\mathbf{v}_{i}(0) \\rangle$. We begin with Newton's second law for a tagged particle $i$ of mass $m$:\n$$\nm \\frac{d\\mathbf{v}_{i}(t)}{dt} = \\sum_{j \\ne i} \\mathbf{F}_{ij}(t) = \\sum_{j \\ne i} \\left( \\mathbf{F}_{ij}^{D}(t) + \\mathbf{F}_{ij}^{R}(t) \\right)\n$$\nSubstituting the expressions for the forces gives:\n$$\nm \\frac{d\\mathbf{v}_{i}}{dt} = \\sum_{j \\ne i} \\left( -\\gamma w^{D}(r_{ij}) \\left[ (\\mathbf{v}_{i} - \\mathbf{v}_{j}) \\cdot \\hat{\\mathbf{r}}_{ij} \\right] \\hat{\\mathbf{r}}_{ij} + \\sigma w^{R}(r_{ij}) \\xi_{ij}(t) \\hat{\\mathbf{r}}_{ij} \\right)\n$$\nTo find an effective equation for the tagged particle, we average the forces over the configurations and velocities of the neighboring particles $j$. This procedure, combined with the given closure approximations, will yield a Langevin equation for $\\mathbf{v}_i$. We can rewrite the dissipative force by separating terms involving $\\mathbf{v}_i$ and $\\mathbf{v}_j$:\n$$\nm \\frac{d\\mathbf{v}_{i}}{dt} = -\\gamma \\left( \\sum_{j \\ne i} w^{D}(r_{ij}) (\\hat{\\mathbf{r}}_{ij} \\otimes \\hat{\\mathbf{r}}_{ij}) \\right) \\cdot \\mathbf{v}_{i} + \\gamma \\sum_{j \\ne i} w^{D}(r_{ij}) (\\mathbf{v}_{j} \\cdot \\hat{\\mathbf{r}}_{ij}) \\hat{\\mathbf{r}}_{ij} + \\sum_{j \\ne i} \\sigma w^{R}(r_{ij}) \\xi_{ij}(t) \\hat{\\mathbf{r}}_{ij}\n$$\nThe first term on the right-hand side describes a drag force on particle $i$ due to its motion relative to its neighbors. The tensor $\\mathbf{K}(t) = \\sum_{j \\ne i} w^{D}(r_{ij}) (\\hat{\\mathbf{r}}_{ij} \\otimes \\hat{\\mathbf{r}}_{ij})$ is a fluctuating friction tensor. Under the assumption of a homogeneous, isotropic system, we can average this tensor over the positions of the neighbors. The sum becomes an integral over space weighted by the number density $\\rho$ and the pair distribution function $g(r)=1$.\n$$\n\\langle \\mathbf{K} \\rangle = \\rho \\int_{V} g(r) w^{D}(r) (\\hat{\\mathbf{r}} \\otimes \\hat{\\mathbf{r}}) d^{3}\\mathbf{r}\n$$\nDue to isotropy, the angular average of the tensor $\\hat{\\mathbf{r}} \\otimes \\hat{\\mathbf{r}}$ is $\\frac{1}{3}\\mathbf{I}$, where $\\mathbf{I}$ is the identity tensor. Thus, $\\langle \\mathbf{K} \\rangle$ is a scalar multiple of $\\mathbf{I}$:\n$$\n\\langle \\mathbf{K} \\rangle = \\rho \\int_{0}^{r_c} w^{D}(r) \\left( \\frac{1}{3} \\mathbf{I} \\right) 4\\pi r^{2} dr = \\frac{4\\pi\\rho}{3} \\left( \\int_{0}^{r_c} w^{D}(r) r^{2} dr \\right) \\mathbf{I}\n$$\nLet's compute the integral. We have $w^{D}(r) = [w^{R}(r)]^{2} = (1-r/r_c)^2$.\n$$\n\\int_{0}^{r_c} \\left(1 - \\frac{r}{r_c}\\right)^2 r^2 dr = \\int_{0}^{r_c} \\left(r^2 - \\frac{2r^3}{r_c} + \\frac{r^4}{r_c^2}\\right) dr = \\left[ \\frac{r^3}{3} - \\frac{2r^4}{4r_c} + \\frac{r^5}{5r_c^2} \\right]_0^{r_c} = r_c^3 \\left(\\frac{1}{3} - \\frac{1}{2} + \\frac{1}{5}\\right) = \\frac{r_c^3}{30}\n$$\nSubstituting this back, we get the average friction tensor:\n$$\n\\langle \\mathbf{K} \\rangle = \\frac{4\\pi\\rho}{3} \\frac{r_c^3}{30} \\mathbf{I} = \\frac{2\\pi\\rho r_c^3}{45} \\mathbf{I}\n$$\nThe mean drag force on particle $i$ is $-\\gamma \\langle \\mathbf{K} \\rangle \\cdot \\mathbf{v}_{i} = -\\zeta \\mathbf{v}_{i}$, where we define the effective friction coefficient $\\zeta$ as:\n$$\n\\zeta = \\gamma \\frac{2\\pi\\rho r_c^3}{45}\n$$\nThe equation of motion can be approximated by a simple Langevin equation for the tagged particle:\n$$\nm \\frac{d\\mathbf{v}_{i}}{dt} = -\\zeta \\mathbf{v}_{i} + \\mathbf{F}_{L}(t)\n$$\nHere, $\\mathbf{F}_{L}(t)$ is an effective random force that combines the original random force, the force due to neighbors' velocities, and the fluctuations of the friction tensor. The given closure approximations render this effective force a Gaussian white noise, uncorrelated with $\\mathbf{v}_i$. For the system to be at thermal equilibrium at temperature $T$, this effective Langevin dynamics must also satisfy the FDT, meaning $\\langle F_{L, \\alpha}(t) F_{L, \\beta}(t') \\rangle = 2\\zeta k_B T \\delta_{\\alpha\\beta}\\delta(t-t')$.\n\nNow we can compute the VACF, $C(t) = \\langle \\mathbf{v}_{i}(t) \\cdot \\mathbf{v}_{i}(0) \\rangle$. We take the derivative of $C(t)$ with respect to time:\n$$\n\\frac{dC(t)}{dt} = \\left\\langle \\frac{d\\mathbf{v}_{i}(t)}{dt} \\cdot \\mathbf{v}_{i}(0) \\right\\rangle\n$$\nSubstituting the Langevin equation:\n$$\nm\\frac{dC(t)}{dt} = \\left\\langle (-\\zeta \\mathbf{v}_{i}(t) + \\mathbf{F}_{L}(t)) \\cdot \\mathbf{v}_{i}(0) \\right\\rangle = -\\zeta \\langle \\mathbf{v}_{i}(t) \\cdot \\mathbf{v}_{i}(0) \\rangle + \\langle \\mathbf{F}_{L}(t) \\cdot \\mathbf{v}_{i}(0) \\rangle\n$$\nFor $t > 0$, the random force $\\mathbf{F}_{L}(t)$ is uncorrelated with the velocity at an earlier time $\\mathbf{v}_{i}(0)$, so $\\langle \\mathbf{F}_{L}(t) \\cdot \\mathbf{v}_{i}(0) \\rangle = 0$. The equation becomes:\n$$\nm\\frac{dC(t)}{dt} = -\\zeta C(t)\n$$\nThis is a first-order ordinary differential equation with the solution:\n$$\nC(t) = C(0) \\exp\\left(-\\frac{\\zeta}{m}t\\right)\n$$\nThe initial value $C(0)$ is the mean squared velocity, $C(0)=\\langle \\mathbf{v}_{i}(0) \\cdot \\mathbf{v}_{i}(0) \\rangle = \\langle v_i^2 \\rangle$. From the equipartition theorem for a particle in three dimensions, the average kinetic energy is $\\frac{1}{2}m\\langle v_i^2 \\rangle = \\frac{3}{2}k_B T$. This gives $\\langle v_i^2 \\rangle = \\frac{3 k_B T}{m}$.\nFinally, substituting the expressions for $C(0)$ and $\\zeta$, we obtain the velocity autocorrelation function:\n$$\nC(t) = \\frac{3 k_{B} T}{m} \\exp\\left(-\\frac{2\\pi\\gamma\\rho r_{c}^{3}}{45 m} t\\right)\n$$\nThis is the closed-form analytic expression for the VACF under the given conditions and approximations.",
            "answer": "$$\n\\boxed{\\frac{3k_{B}T}{m}\\exp\\left(-\\frac{2\\pi\\gamma\\rho r_{c}^{3}}{45m}t\\right)}\n$$"
        },
        {
            "introduction": "This final practice bridges the gap between the theoretical DPD model and its practical application in computational science. All numerical simulations introduce errors due to the discretization of time; this exercise  shows you how to systematically address this. You will develop and implement a standard data analysis procedure to quantify and extrapolate away the bias introduced by a finite time step, $\\Delta t$, enabling the recovery of accurate physical constants like viscosity from raw simulation data.",
            "id": "3751641",
            "problem": "Consider a fluid modeled by Dissipative Particle Dynamics (DPD), where mesoscopic particles of mass $m$ interact via pairwise forces that are the sum of a conservative, a dissipative, and a random component. The equations of motion for particle $i$ are Newton's second law, $m \\, \\frac{d \\mathbf{v}_i}{dt} = \\sum_{j \\ne i} \\mathbf{F}_{ij}$ and $\\frac{d \\mathbf{r}_i}{dt} = \\mathbf{v}_i$, and the DPD pairwise force $\\mathbf{F}_{ij}$ has three contributions,\n$$\n\\mathbf{F}_{ij} = \\mathbf{F}_{ij}^{\\mathrm{C}} + \\mathbf{F}_{ij}^{\\mathrm{D}} + \\mathbf{F}_{ij}^{\\mathrm{R}}.\n$$\nThe conservative force is $\\mathbf{F}_{ij}^{\\mathrm{C}} = a \\, w^{\\mathrm{C}}(r_{ij}) \\, \\hat{\\mathbf{r}}_{ij}$, the dissipative force is $\\mathbf{F}_{ij}^{\\mathrm{D}} = -\\gamma \\, w^{\\mathrm{D}}(r_{ij}) \\, (\\mathbf{v}_{ij} \\cdot \\hat{\\mathbf{r}}_{ij}) \\, \\hat{\\mathbf{r}}_{ij}$, and the random force is $\\mathbf{F}_{ij}^{\\mathrm{R}} = \\sigma \\, w^{\\mathrm{R}}(r_{ij}) \\, \\xi_{ij} \\, \\Delta t^{-1/2} \\, \\hat{\\mathbf{r}}_{ij}$, where $\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$, $r_{ij} = \\|\\mathbf{r}_{ij}\\|$, $\\hat{\\mathbf{r}}_{ij} = \\mathbf{r}_{ij}/r_{ij}$, $\\mathbf{v}_{ij} = \\mathbf{v}_i - \\mathbf{v}_j$, $a$ is the conservative amplitude, $\\gamma$ is the dissipative coefficient, $\\sigma$ is the random force amplitude satisfying the fluctuation-dissipation relation $\\sigma^2 = 2 \\gamma k_{\\mathrm{B}} T$ with Boltzmann constant $k_{\\mathrm{B}}$ and temperature $T$, $w^{\\mathrm{C}}$, $w^{\\mathrm{D}}$, and $w^{\\mathrm{R}}$ are weight functions vanishing beyond a cutoff, and $\\xi_{ij}$ are independent, zero-mean, unit-variance Gaussian random variables with $\\xi_{ij} = \\xi_{ji}$. A common numerical integrator for DPD uses a time step $\\Delta t$ to advance positions and velocities by a splitting or modified velocity Verlet scheme.\n\nWhen estimating a transport coefficient such as the dynamic viscosity $\\eta$ from DPD, either via a Non-Equilibrium Molecular Dynamics (NEMD) setup (imposing shear and measuring the shear stress) or via the Green-Kubo (GK) relation (time correlation of the off-diagonal stress components), discretization introduces bias that depends on the time step $\\Delta t$. For sufficiently small $\\Delta t$, a backward error analysis of consistent, stable integrators implies that the invariant measure of the numerical method differs from the exact invariant measure by a perturbation that is smooth in $\\Delta t$, and therefore expectations of sufficiently regular observables, including $\\eta$, admit an expansion in powers of $\\Delta t$. Consequently, one expects a model of the form\n$$\n\\eta(\\Delta t) = \\eta_0 + c_1 \\Delta t + c_2 (\\Delta t)^2 + \\cdots,\n$$\nwhere $\\eta_0$ is the continuum limit viscosity as $\\Delta t \\to 0$, and $c_1$, $c_2$, $\\ldots$ are coefficients determined by the integrator, thermostat, and the observable definition. The goal is to design an algorithmic procedure to quantify the dependence $\\eta(\\Delta t)$ from a finite set of measurements and to extrapolate to $\\Delta t \\to 0$ to remove discretization bias.\n\nStarting from Newton's laws and the DPD force definitions, explain why a polynomial-in-$\\Delta t$ ansatz for $\\eta(\\Delta t)$ is justified, and develop a robust extrapolation procedure that, given measured viscosities at a set of time steps and associated measurement uncertainties, returns an estimate of $\\eta_0$ by model selection among linear and quadratic bias models using cross-validation, and weighted least squares fitting consistent with measurement uncertainties.\n\nYour program must implement the following algorithmic requirements:\n\n- Accept, as fixed inputs embedded in the program, several test cases, each consisting of a list of time steps $\\{\\Delta t_i\\}$, a list of measured viscosities $\\{\\eta_i\\}$ in DPD reduced units, and a list of measurement standard deviations $\\{\\sigma_i\\}$ for each $\\eta_i$.\n- For each test case, consider two candidate models for the discretization bias: linear, $\\eta(\\Delta t) = \\eta_0 + c_1 \\Delta t$, and quadratic, $\\eta(\\Delta t) = \\eta_0 + c_1 \\Delta t + c_2 (\\Delta t)^2$.\n- Use leave-one-out cross-validation to select the model order. For each candidate model, compute the leave-one-out predicted viscosity for each data point by fitting the model to all other points using weighted least squares with weights $w_i = 1/\\sigma_i^2$, then compute the weighted mean squared error defined by $\\mathrm{WMSE} = \\left(\\sum_i w_i (\\eta_i - \\hat{\\eta}_i)^2\\right) \\big/ \\left(\\sum_i w_i\\right)$. Select the model with the smaller $\\mathrm{WMSE}$; if the $\\mathrm{WMSE}$ values are equal within a tolerance of $10^{-12}$, select the lower-order model.\n- With the selected model, fit the full dataset using weighted least squares and return the intercept $\\eta_0$ as the extrapolated viscosity at $\\Delta t = 0$.\n- Express all viscosities in DPD reduced units, and in the final output round each extrapolated $\\eta_0$ to six decimal places.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[\\eta_0^{(1)},\\eta_0^{(2)},\\eta_0^{(3)}]$, where the superscript denotes the test case index.\n\nTest Suite:\n\n- Case $1$ (linear bias dominated, varying uncertainties): $\\Delta t$ values $[0.04, 0.06, 0.08, 0.10, 0.12]$, measured viscosities $\\eta$ values $[1.286, 1.304, 1.322, 1.340, 1.358]$ in DPD reduced units, uncertainties $\\sigma$ values $[0.004, 0.003, 0.003, 0.002, 0.002]$.\n- Case $2$ (quadratic bias dominated, equal uncertainties): $\\Delta t$ values $[0.02, 0.04, 0.06, 0.08, 0.10]$, measured viscosities $\\eta$ values $[0.7516, 0.7564, 0.7644, 0.7756, 0.7900]$ in DPD reduced units, uncertainties $\\sigma$ values $[0.003, 0.003, 0.003, 0.003, 0.003]$.\n- Case $3$ (mixed linear and quadratic bias, heterogeneous uncertainties): $\\Delta t$ values $[0.01, 0.03, 0.05, 0.07, 0.09]$, measured viscosities $\\eta$ values $[1.0022, 1.0078, 1.0150, 1.0238, 1.0342]$ in DPD reduced units, uncertainties $\\sigma$ values $[0.0010, 0.0020, 0.0015, 0.0020, 0.0025]$.\n\nYour task is to implement the described procedure and produce the final output line containing the three extrapolated viscosities $[\\eta_0^{(1)},\\eta_0^{(2)},\\eta_0^{(3)}]$, rounded to six decimal places, in DPD reduced units.",
            "solution": "The problem asks for two main components: first, a justification for the polynomial dependence of the measured viscosity $\\eta$ on the simulation time step $\\Delta t$, and second, the design and implementation of a robust algorithm to extrapolate a set of measured viscosities $\\{\\eta_i\\}$ at different time steps $\\{\\Delta t_i\\}$ to the continuum limit $\\Delta t \\to 0$.\n\n### Justification for Polynomial Dependence on Time Step $\\Delta t$\n\nThe dynamics of the Dissipative Particle Dynamics (DPD) system are governed by Newton's second law, which constitutes a system of second-order ordinary differential equations (ODEs):\n$$\nm \\frac{d^2 \\mathbf{r}_i}{dt^2} = \\mathbf{F}_i(\\{\\mathbf{r}_j\\}, \\{\\mathbf{v}_j\\})\n$$\nwhere $\\mathbf{F}_i = \\sum_{j \\ne i} \\mathbf{F}_{ij}$ is the total force on particle $i$, and the pairwise force $\\mathbf{F}_{ij}$ is composed of conservative, dissipative, and random terms. These ODEs describe the evolution of the system in continuous time.\n\nNumerical simulations, however, must discretize time, advancing the system state from time $t$ to $t+\\Delta t$ using a numerical integrator. Common integrators for DPD, such as modified velocity Verlet schemes, approximate the solution to the continuous equations of motion. A powerful tool for analyzing the errors introduced by this discretization is backward error analysis.\n\nFor a consistent numerical integrator of order $p$, the state of the system after one time step, denoted by the map $\\mathbf{y}(t+\\Delta t) = \\Phi_{\\Delta t}(\\mathbf{y}(t))$, does not lie exactly on the true trajectory of the original ODEs. Instead, backward error analysis demonstrates that the numerical trajectory is, to a high degree of accuracy, the *exact* trajectory of a *modified* or *shadow* system of ODEs. These modified equations differ from the original ones by a series of perturbation terms expressed in powers of the time step $\\Delta t$. For an integrator of order $p$, this expansion is of the form:\n$$\n\\frac{d \\tilde{\\mathbf{y}}}{dt} = f(\\tilde{\\mathbf{y}}) + (\\Delta t)^p f_p(\\tilde{\\mathbf{y}}) + (\\Delta t)^{p+1} f_{p+1}(\\tilde{\\mathbf{y}}) + \\dots\n$$\nwhere $f(\\mathbf{y})$ represents the original equations of motion. For many symmetric, time-reversible integrators (like the standard velocity Verlet algorithm applied to Hamiltonian systems), the expansion for the modified Hamiltonian contains only even powers of $\\Delta t$, i.e., $(\\Delta t)^2, (\\Delta t)^4, \\dots$.\n\nHowever, the DPD force includes non-Hamiltonian dissipative and random components. The integrators used for DPD, typically splitting schemes that handle the various force components in sequence, break the simple time-reversal symmetry of the Verlet algorithm. The resulting modified equations of motion for DPD systems generally contain error terms with both even and odd powers of $\\Delta t$.\n\nThe viscosity $\\eta$ is a transport coefficient that can be calculated as an expectation value of a certain observable (e.g., from the stress-autocorrelation function in a Green-Kubo approach or from the steady-state stress in a non-equilibrium simulation). When this expectation value is computed over a trajectory generated by the numerical integrator, we are sampling the statistical ensemble corresponding to the *modified* equations of motion, not the original ones. Therefore, the calculated viscosity, $\\eta(\\Delta t)$, will depend on the time step $\\Delta t$. Since the modified dynamics are a smooth perturbation of the original dynamics in powers of $\\Delta t$, the expectation values of sufficiently regular observables also admit a smooth expansion in $\\Delta t$. For small $\\Delta t$, this justifies the polynomial ansatz:\n$$\n\\eta(\\Delta t) = \\eta_0 + c_1 \\Delta t + c_2 (\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\nHere, $\\eta_0$ is the true, physical viscosity of the continuum model, which is recovered in the limit $\\Delta t \\to 0$. The coefficients $c_1, c_2, \\dots$ depend on the specific integrator and the system properties. The goal of the extrapolation procedure is to estimate $\\eta_0$ by fitting this model to simulation data obtained at several finite $\\Delta t$.\n\n### Algorithmic Procedure for Extrapolation\n\nThe task is to determine $\\eta_0$ from a finite set of measurements $\\{(\\Delta t_i, \\eta_i, \\sigma_i)\\}_{i=1}^N$, where $\\sigma_i$ is the standard deviation of the measurement $\\eta_i$. The procedure involves model selection between a linear and a quadratic model, followed by a final parameter fit.\n\n**1. Candidate Models**\n\nWe consider two truncated versions of the full expansion:\n- **Linear Bias Model:** $\\eta(\\Delta t) = p_1(\\Delta t) = \\eta_0 + c_1 \\Delta t$\n- **Quadratic Bias Model:** $\\eta(\\Delta t) = p_2(\\Delta t) = \\eta_0 + c_1 \\Delta t + c_2 (\\Delta t)^2$\n\n**2. Weighted Least Squares (WLS) Fitting**\n\nGiven that the measurements $\\eta_i$ have different uncertainties $\\sigma_i$, a weighted least squares (WLS) fit is statistically appropriate. This method minimizes the sum of squared, weighted residuals, $\\chi^2$, assuming the errors are independent and normally distributed. The weights $w_i$ are chosen as the inverse of the variance of each measurement:\n$$\nw_i = \\frac{1}{\\sigma_i^2}\n$$\nThe parameters of a model $f(\\Delta t; \\boldsymbol{\\beta})$ (where $\\boldsymbol{\\beta}$ is the vector of coefficients, e.g., $\\boldsymbol{\\beta} = [\\eta_0, c_1]^T$) are found by minimizing:\n$$\n\\chi^2(\\boldsymbol{\\beta}) = \\sum_{i=1}^N w_i (\\eta_i - f(\\Delta t_i; \\boldsymbol{\\beta}))^2\n$$\nFor models that are linear in their parameters, such as our polynomial models, this minimization has a closed-form solution. Let $\\mathbf{y}$ be the vector of $\\eta_i$ values, $W$ a diagonal matrix with entries $W_{ii}=w_i$, and $A$ the design matrix. For the linear model, $A_{i,j}$ would be $[1, \\Delta t_i]$, and for the quadratic model, $[1, \\Delta t_i, (\\Delta t_i)^2]$. The parameter vector $\\boldsymbol{\\beta}$ is given by:\n$$\n\\boldsymbol{\\beta} = (A^T W A)^{-1} A^T W \\mathbf{y}\n$$\n\n**3. Model Selection using Leave-One-Out Cross-Validation (LOOCV)**\n\nTo choose between the linear and quadratic models without overfitting, we use leave-one-out cross-validation. This technique assesses a model's predictive performance on unseen data. The procedure is as follows for each candidate model (linear and quadratic):\n1. For each data point $k \\in \\{1, \\dots, N\\}$:\n    a. Remove the $k$-th data point $(\\Delta t_k, \\eta_k, \\sigma_k)$ from the dataset.\n    b. Fit the model to the remaining $N-1$ points using WLS.\n    c. Use the resulting fitted model to predict the viscosity at the held-out time step $\\Delta t_k$. Let this prediction be $\\hat{\\eta}_k$.\n2. After iterating through all $k$, we obtain a set of out-of-sample predictions $\\{\\hat{\\eta}_k\\}_{k=1}^N$.\n3. Compute the Weighted Mean Squared Error (WMSE) for the model:\n$$\n\\mathrm{WMSE} = \\frac{\\sum_{k=1}^N w_k (\\eta_k - \\hat{\\eta}_k)^2}{\\sum_{k=1}^N w_k}\n$$\nThe weights $w_k = 1/\\sigma_k^2$ are from the full original dataset.\n4. The model (linear or quadratic) with the lower WMSE is selected. The problem specifies a tie-breaking rule: if the WMSE values are equal within a tolerance of $10^{-12}$, the simpler (linear) model is chosen, adhering to the principle of parsimony (Occam's razor).\n\n**4. Final Extrapolation**\n\nOnce the optimal model order (linear or quadratic) has been determined via LOOCV, the final step is to perform a WLS fit using that model on the *entire* dataset $\\{(\\Delta t_i, \\eta_i, \\sigma_i)\\}_{i=1}^N$. The intercept of this final fit, the coefficient corresponding to the $(\\Delta t)^0$ term, is our best estimate for the continuum-limit viscosity, $\\eta_0$. The result is then rounded to six decimal places as required.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the extrapolated viscosity eta_0 for several DPD simulation test cases.\n    The method involves model selection (linear vs. quadratic) using leave-one-out\n    cross-validation with a weighted mean squared error metric, followed by a final\n    weighted least squares fit to determine eta_0.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"dt\": [0.04, 0.06, 0.08, 0.10, 0.12],\n            \"eta\": [1.286, 1.304, 1.322, 1.340, 1.358],\n            \"sigma\": [0.004, 0.003, 0.003, 0.002, 0.002],\n        },\n        {\n            \"dt\": [0.02, 0.04, 0.06, 0.08, 0.10],\n            \"eta\": [0.7516, 0.7564, 0.7644, 0.7756, 0.7900],\n            \"sigma\": [0.003, 0.003, 0.003, 0.003, 0.003],\n        },\n        {\n            \"dt\": [0.01, 0.03, 0.05, 0.07, 0.09],\n            \"eta\": [1.0022, 1.0078, 1.0150, 1.0238, 1.0342],\n            \"sigma\": [0.0010, 0.0020, 0.0015, 0.0020, 0.0025],\n        },\n    ]\n\n    extrapolated_viscosities = []\n\n    def fit_wls(x, y, w, order):\n        \"\"\"\n        Performs weighted least squares fitting for a polynomial of a given order.\n\n        Args:\n            x (np.ndarray): Independent variable data.\n            y (np.ndarray): Dependent variable data.\n            w (np.ndarray): Weights for the data points.\n            order (int): The order of the polynomial (1 for linear, 2 for quadratic).\n\n        Returns:\n            np.ndarray: The fitted polynomial coefficients [c0, c1, ...].\n                        The intercept (eta_0) is the first element.\n        \"\"\"\n        if order == 1:\n            A = np.vstack([np.ones_like(x), x]).T\n        elif order == 2:\n            A = np.vstack([np.ones_like(x), x, x**2]).T\n        else:\n            raise ValueError(\"Only order 1 (linear) and 2 (quadratic) are supported.\")\n        \n        W_sqrt = np.diag(np.sqrt(w))\n        A_prime = W_sqrt @ A\n        y_prime = W_sqrt @ y\n        \n        coeffs, _, _, _ = np.linalg.lstsq(A_prime, y_prime, rcond=None)\n        return coeffs\n\n    for case in test_cases:\n        dt = np.array(case[\"dt\"])\n        eta = np.array(case[\"eta\"])\n        sigma = np.array(case[\"sigma\"])\n        weights = 1.0 / sigma**2\n        num_points = len(dt)\n\n        wmse_results = {}\n        for order in [1, 2]:  # 1 for linear, 2 for quadratic\n            predictions = np.zeros(num_points)\n            for i in range(num_points):\n                # Create leave-one-out training set\n                dt_train = np.delete(dt, i)\n                eta_train = np.delete(eta, i)\n                weights_train = np.delete(weights, i)\n\n                # Fit model on training data\n                coeffs = fit_wls(dt_train, eta_train, weights_train, order)\n\n                # Predict value for the held-out point\n                if order == 1:\n                    predictions[i] = coeffs[0] + coeffs[1] * dt[i]\n                else:  # order == 2\n                    predictions[i] = coeffs[0] + coeffs[1] * dt[i] + coeffs[2] * dt[i]**2\n            \n            # Calculate Weighted Mean Squared Error for the out-of-sample predictions\n            weighted_squared_errors = weights * (eta - predictions)**2\n            wmse = np.sum(weighted_squared_errors) / np.sum(weights)\n            wmse_results[order] = wmse\n\n        # Model selection based on WMSE\n        # If linear WMSE is less than or equal to quadratic (with tolerance), choose linear.\n        if wmse_results[1] = wmse_results[2] + 1e-12:\n            selected_order = 1\n        else:\n            selected_order = 2\n\n        # Final fit on the full dataset with the selected model\n        final_coeffs = fit_wls(dt, eta, weights, selected_order)\n        eta_0 = final_coeffs[0]\n        \n        extrapolated_viscosities.append(eta_0)\n\n    # Format the final output as a string with results rounded to six decimal places.\n    formatted_results = [f\"{result:.6f}\" for result in extrapolated_viscosities]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}