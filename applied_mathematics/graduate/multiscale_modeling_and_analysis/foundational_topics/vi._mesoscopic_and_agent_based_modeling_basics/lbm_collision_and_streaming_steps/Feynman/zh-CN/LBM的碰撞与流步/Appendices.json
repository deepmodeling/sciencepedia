{
    "hands_on_practices": [
        {
            "introduction": "在格子玻尔兹曼方法（LBM）中，碰撞步骤模拟了粒子布居数向局部平衡态的弛豫过程。这个平衡态由平衡分布函数 $f_i^{eq}$ 描述，它的形式并非任意设定，而是经过精心构建，以确保在连续尺度上能够准确恢复宏观流体动力学方程（如纳维-斯托克斯方程）。本练习将引导您推导并数值计算 $f_i^{eq}$ ，从而加深对LBM微观模型与其所模拟的宏观流场之间关键联系的理解，这是掌握LBM碰撞模型的第一步。",
            "id": "3774257",
            "problem": "在格子玻尔兹曼方法（LBM）中，考虑一个二维九速格子（D2Q9）模型，该模型采用格子单位，其中粒子迁移速度为 $c=1$，格子声速满足 $c_{s}^{2} = 1/3$。在单松弛时间 Bhatnagar-Gross-Krook (BGK) 动力学模型中，碰撞步使单粒子分布函数向一个平衡态松弛，该平衡态必须在低马赫数区域内，当对适当的离散速度集取矩时，能够恢复流体动力学场和各向同性应力张量。从流体速度的二阶展开的连续麦克斯韦-玻尔兹曼平衡分布出发，并利用离散平衡态能够产生与 $c_{s}^{2}$ 一致的精确密度、动量和各向同性二阶矩的约束条件，推导D2Q9格子上的离散平衡分布函数 $f_{i}^{eq}$。\n\nD2Q9离散速度为\n$$\n\\mathbf{e}_{0} = (0,0),\\quad\n\\mathbf{e}_{1} = (1,0),\\quad\n\\mathbf{e}_{2} = (0,1),\\quad\n\\mathbf{e}_{3} = (-1,0),\\quad\n\\mathbf{e}_{4} = (0,-1),\\quad\n\\mathbf{e}_{5} = (1,1),\\quad\n\\mathbf{e}_{6} = (-1,1),\\quad\n\\mathbf{e}_{7} = (-1,-1),\\quad\n\\mathbf{e}_{8} = (1,-1),\n$$\n相应的高斯-埃尔米特求积权重为\n$$\nw_{0} = \\frac{4}{9},\\quad w_{1} = w_{2} = w_{3} = w_{4} = \\frac{1}{9},\\quad w_{5} = w_{6} = w_{7} = w_{8} = \\frac{1}{36}.\n$$\n\n使用您推导的公式，对密度 $\\rho = 1.2$ 和速度 $\\mathbf{u} = (0.08,-0.03)$ 的情况，数值计算平衡分布函数。验证零阶矩和一阶矩约束，并检查所有九个方向的正定性条件。最后，报告在所有 $i \\in \\{0,\\dots,8\\}$ 中 $f_{i}^{eq}$ 的最小值，作为您以格子单位表示的唯一最终结果。将您的最终答案四舍五入至六位有效数字。",
            "solution": "该问题被验证为具有科学依据、提法恰当且完整。这是格子玻尔兹曼方法（LBM）领域的一个标准问题，并提供了所有必要的数据和条件。\n\n主要目标是为二维九速（D2Q9）格子模型推导离散平衡分布函数 $f_{i}^{eq}$。推导基于对分布函数的矩施加约束。$f_{i}^{eq}$ 的标准速度二阶精度展开可以写成通用的多项式形式。然而，根据问题约束的要求，最直接的方法是通过确保 $f_{i}^{eq}$ 能够恢复正确的流体动力学矩（密度、动量和动量通量张量）来确定其形式。\n\n离散平衡分布函数 $f_{i}^{eq}$ 的矩所满足的约束条件是：\n1. 零阶矩（质量守恒）：$\\sum_{i=0}^{8} f_{i}^{eq} = \\rho$\n2. 一阶矩（动量守恒）：$\\sum_{i=0}^{8} f_{i}^{eq} \\mathbf{e}_{i} = \\rho \\mathbf{u}$\n3. 二阶矩（动量通量）：$\\sum_{i=0}^{8} f_{i}^{eq} \\mathbf{e}_{i} \\mathbf{e}_{i} = \\mathbf{\\Pi}^{eq} = \\rho c_{s}^{2} \\mathbf{I} + \\rho \\mathbf{u} \\mathbf{u}$\n此处，$\\rho$ 是流体密度，$\\mathbf{u}$ 是流体速度，$\\mathbf{e}_i$ 是离散格子速度，$c_s$ 是声速，$\\mathbf{I}$ 是单位张量。\n\n我们寻求一个关于 $\\rho$、$\\mathbf{u}$ 和 $\\mathbf{e}_i$ 的 $f_i^{eq}$ 表达式。与麦克斯韦-玻尔兹曼分布的二阶展开一致的标准方法是假设以下形式：\n$$f_{i}^{eq} = w_i \\rho \\left[ A + B(\\mathbf{e}_i \\cdot \\mathbf{u}) + C(\\mathbf{e}_i \\cdot \\mathbf{u})^2 + D u^2 \\right]$$\n其中 $w_i$ 是格子权重，$A$、$B$、$C$、$D$ 是由矩约束决定的常数。为了进行此推导，我们使用D2Q9格子的以下已知性质，其中 $\\alpha, \\beta, \\gamma, \\delta$ 是笛卡尔坐标索引：\n$$\n\\sum_{i} w_i = 1 \\\\\n\\sum_{i} w_i e_{i\\alpha} = 0 \\\\\n\\sum_{i} w_i e_{i\\alpha} e_{i\\beta} = c_s^2 \\delta_{\\alpha\\beta} \\\\\n\\sum_{i} w_i e_{i\\alpha} e_{i\\beta} e_{i\\gamma} = 0 \\\\\n\\sum_{i} w_i e_{i\\alpha} e_{i\\beta} e_{i\\gamma} e_{i\\delta} = c_s^4 (\\delta_{\\alpha\\beta}\\delta_{\\gamma\\delta} + \\delta_{\\alpha\\gamma}\\delta_{\\beta\\delta} + \\delta_{\\alpha\\delta}\\delta_{\\beta\\gamma})\n$$\n问题指定了 $c_s^2 = 1/3$。\n\n应用零阶矩约束：\n$$ \\sum_{i} f_{i}^{eq} = \\rho \\sum_{i} w_i \\left[ A + B e_{i\\alpha} u_{\\alpha} + C e_{i\\alpha}e_{i\\beta} u_{\\alpha} u_{\\beta} + D u_{\\gamma} u_{\\gamma} \\right] $$\n$$ \\rho = \\rho \\left[ A \\sum w_i + B u_{\\alpha} \\sum w_i e_{i\\alpha} + C u_{\\alpha} u_{\\beta} \\sum w_i e_{i\\alpha}e_{i\\beta} + D u^2 \\sum w_i \\right] $$\n$$ \\rho = \\rho \\left[ A(1) + B u_{\\alpha}(0) + C u_{\\alpha} u_{\\beta}(c_s^2 \\delta_{\\alpha\\beta}) + D u^2(1) \\right] $$\n$$ 1 = A + C c_s^2 u^2 + D u^2 $$\n为使此式对任意 $\\mathbf{u}$ 成立，我们必须有 $A=1$ 和 $C c_s^2 + D = 0$。\n\n应用一阶矩约束：\n$$ \\sum_{i} f_{i}^{eq} e_{i\\gamma} = \\rho \\sum_{i} w_i e_{i\\gamma} \\left[ A + B e_{i\\alpha} u_{\\alpha} + \\dots \\right] $$\n$$ \\rho u_{\\gamma} = \\rho \\left[ A \\sum w_i e_{i\\gamma} + B u_{\\alpha} \\sum w_i e_{i\\gamma}e_{i\\alpha} + \\dots \\right] $$\n$$ \\rho u_{\\gamma} = \\rho \\left[ A(0) + B u_{\\alpha} (c_s^2 \\delta_{\\gamma\\alpha}) + \\dots \\right] $$\n$$ \\rho u_{\\gamma} = \\rho B c_s^2 u_{\\gamma} \\implies B = \\frac{1}{c_s^2} $$\n\n应用二阶矩约束：\n$$ \\sum_{i} f_{i}^{eq} e_{i\\gamma} e_{i\\delta} = \\rho \\sum_{i} w_i e_{i\\gamma} e_{i\\delta} \\left[ A + B e_{i\\alpha} u_{\\alpha} + C e_{i\\alpha}e_{i\\beta} u_{\\alpha} u_{\\beta} + D u^2 \\right] $$\n$$ \\rho c_s^2 \\delta_{\\gamma\\delta} + \\rho u_{\\gamma} u_{\\delta} = \\rho \\left[ A c_s^2 \\delta_{\\gamma\\delta} + C u_{\\alpha} u_{\\beta} \\sum w_i e_{i\\gamma}e_{i\\delta}e_{i\\alpha}e_{i\\beta} + D u^2 c_s^2 \\delta_{\\gamma\\delta} \\right] $$\n使用四阶矩性质：\n$$ \\sum w_i e_{i\\gamma}e_{i\\delta}e_{i\\alpha}e_{i\\beta} = c_s^4(\\delta_{\\gamma\\delta}\\delta_{\\alpha\\beta} + \\delta_{\\gamma\\alpha}\\delta_{\\delta\\beta} + \\delta_{\\gamma\\beta}\\delta_{\\delta\\alpha}) $$\n该项变为 $C u_{\\alpha} u_{\\beta} c_s^4 (\\delta_{\\gamma\\delta}\\delta_{\\alpha\\beta} + \\delta_{\\gamma\\alpha}\\delta_{\\delta\\beta} + \\delta_{\\gamma\\beta}\\delta_{\\delta\\alpha}) = C c_s^4 (u^2 \\delta_{\\gamma\\delta} + 2 u_{\\gamma} u_{\\delta})$。\n代回原式：\n$$ c_s^2 \\delta_{\\gamma\\delta} + u_{\\gamma} u_{\\delta} = (A c_s^2 + D u^2 c_s^2) \\delta_{\\gamma\\delta} + C c_s^4 (u^2 \\delta_{\\gamma\\delta} + 2 u_{\\gamma} u_{\\delta}) $$\n$$ c_s^2 \\delta_{\\gamma\\delta} + u_{\\gamma} u_{\\delta} = (A c_s^2 + (D c_s^2 + C c_s^4)u^2) \\delta_{\\gamma\\delta} + (2 C c_s^4) u_{\\gamma} u_{\\delta} $$\n令 $u_{\\gamma}u_{\\delta}$ 的系数相等：\n$$ 1 = 2 C c_s^4 \\implies C = \\frac{1}{2c_s^4} $$\n从 $C c_s^2 + D = 0$ 可得 $D = -C c_s^2 = -\\frac{1}{2c_s^2}$。\n将这些常数代回 $f_i^{eq}$ 的假设形式中：\n$$ f_{i}^{eq} = w_i \\rho \\left[ 1 + \\frac{\\mathbf{e}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{e}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{u^2}{2c_s^2} \\right] $$\n这就是所求的离散平衡分布函数。当 $c_s^2 = 1/3$ 时：\n$$ f_{i}^{eq} = w_i \\rho \\left[ 1 + 3(\\mathbf{e}_i \\cdot \\mathbf{u}) + \\frac{9}{2}(\\mathbf{e}_i \\cdot \\mathbf{u})^2 - \\frac{3}{2}u^2 \\right] $$\n\n现在，我们用给定的数值 $\\rho = 1.2$ 和 $\\mathbf{u} = (0.08, -0.03)$ 对此进行计算。\n首先，计算 $u^2 = |\\mathbf{u}|^2 = (0.08)^2 + (-0.03)^2 = 0.0064 + 0.0009 = 0.0073$。\n方括号中的项为 $S_i = 1 + 3(\\mathbf{e}_i \\cdot \\mathbf{u}) + 4.5(\\mathbf{e}_i \\cdot \\mathbf{u})^2 - 1.5(0.0073) = 0.98905 + 3(\\mathbf{e}_i \\cdot \\mathbf{u}) + 4.5(\\mathbf{e}_i \\cdot \\mathbf{u})^2$。\n\n我们为每个方向 $i$ 计算 $\\mathbf{e}_i \\cdot \\mathbf{u}$：\n$\\mathbf{e}_0 \\cdot \\mathbf{u} = 0.0$\n$\\mathbf{e}_1 \\cdot \\mathbf{u} = 0.08$\n$\\mathbf{e}_2 \\cdot \\mathbf{u} = -0.03$\n$\\mathbf{e}_3 \\cdot \\mathbf{u} = -0.08$\n$\\mathbf{e}_4 \\cdot \\mathbf{u} = 0.03$\n$\\mathbf{e}_5 \\cdot \\mathbf{u} = 0.08 - 0.03 = 0.05$\n$\\mathbf{e}_6 \\cdot \\mathbf{u} = -0.08 - 0.03 = -0.11$\n$\\mathbf{e}_7 \\cdot \\mathbf{u} = -0.08 + 0.03 = -0.05$\n$\\mathbf{e}_8 \\cdot \\mathbf{u} = 0.08 + 0.03 = 0.11$\n\n现在为每个 $i$ 计算 $f_i^{eq} = w_i \\rho S_i = 1.2 w_i S_i$：\n$i=0$: $\\mathbf{e}_0 \\cdot \\mathbf{u}=0$。$S_0 = 0.98905$。$f_0^{eq} = \\frac{4}{9} (1.2)(0.98905) \\approx 0.52749333$\n$i=1$: $\\mathbf{e}_1 \\cdot \\mathbf{u}=0.08$。$S_1 = 0.98905 + 3(0.08) + 4.5(0.08)^2 = 1.25785$。$f_1^{eq} = \\frac{1}{9}(1.2)(1.25785) \\approx 0.16771333$\n$i=2$: $\\mathbf{e}_2 \\cdot \\mathbf{u}=-0.03$。$S_2 = 0.98905 + 3(-0.03) + 4.5(-0.03)^2 = 0.9031$。$f_2^{eq} = \\frac{1}{9}(1.2)(0.9031) \\approx 0.12041333$\n$i=3$: $\\mathbf{e}_3 \\cdot \\mathbf{u}=-0.08$。$S_3 = 0.98905 + 3(-0.08) + 4.5(-0.08)^2 = 0.77785$。$f_3^{eq} = \\frac{1}{9}(1.2)(0.77785) \\approx 0.10371333$\n$i=4$: $\\mathbf{e}_4 \\cdot \\mathbf{u}=0.03$。$S_4 = 0.98905 + 3(0.03) + 4.5(0.03)^2 = 1.0831$。$f_4^{eq} = \\frac{1}{9}(1.2)(1.0831) \\approx 0.14441333$\n$i=5$: $\\mathbf{e}_5 \\cdot \\mathbf{u}=0.05$。$S_5 = 0.98905 + 3(0.05) + 4.5(0.05)^2 = 1.1503$。$f_5^{eq} = \\frac{1}{36}(1.2)(1.1503) \\approx 0.03834333$\n$i=6$: $\\mathbf{e}_6 \\cdot \\mathbf{u}=-0.11$。$S_6 = 0.98905 + 3(-0.11) + 4.5(-0.11)^2 = 0.7135$。$f_6^{eq} = \\frac{1}{36}(1.2)(0.7135) \\approx 0.02378333$\n$i=7$: $\\mathbf{e}_7 \\cdot \\mathbf{u}=-0.05$。$S_7 = 0.98905 + 3(-0.05) + 4.5(-0.05)^2 = 0.8503$。$f_7^{eq} = \\frac{1}{36}(1.2)(0.8503) \\approx 0.02834333$\n$i=8$: $\\mathbf{e}_8 \\cdot \\mathbf{u}=0.11$。$S_8 = 0.98905 + 3(0.11) + 4.5(0.11)^2 = 1.3735$。$f_8^{eq} = \\frac{1}{36}(1.2)(1.3735) \\approx 0.04578333$\n\n约束验证：\n零阶矩：$\\sum_i f_i^{eq} \\approx 0.527493 + 0.167713 + 0.120413 + 0.103713 + 0.144413 + 0.038343 + 0.023783 + 0.028343 + 0.045783 = 1.200000$。这与 $\\rho$ 匹配。\n一阶矩（x分量）：$\\sum_i f_i^{eq} e_{ix} = f_1 - f_3 + f_5 - f_6 - f_7 + f_8 \\approx 0.167713 - 0.103713 + 0.038343 - 0.023783 - 0.028343 + 0.045783 = 0.096$。这与 $\\rho u_x = 1.2 \\times 0.08 = 0.096$ 匹配。\n一阶矩（y分量）：$\\sum_i f_i^{eq} e_{iy} = f_2 - f_4 + f_5 + f_6 - f_7 - f_8 \\approx 0.120413 - 0.144413 + 0.038343 + 0.023783 - 0.028343 - 0.045783 = -0.036$。这与 $\\rho u_y = 1.2 \\times -0.03 = -0.036$ 匹配。\n正定性条件：所有计算出的 $f_i^{eq}$ 值均为正。\n\n在计算出的平衡分布函数中，最小值为 $i=6$ 时的值：\n$f_6^{eq} \\approx 0.02378333...$\n四舍五入到六位有效数字，该值为 $0.0237833$。",
            "answer": "$$\\boxed{0.0237833}$$"
        },
        {
            "introduction": "LBM算法通过两个主要操作在离散时间上演化：碰撞和迁移。碰撞步骤在节点上局部地重新分配粒子布居间的动量和能量，而迁移步骤则将这些布居传播到相邻节点。本练习提供了一个完整LBM时间步的清晰、分步的实践 。通过追踪从单个节点出发的粒子布居，您将对信息如何在格子上传播以及局部守恒性如何得以维持获得一个直观的、机械的认识。",
            "id": "3774222",
            "problem": "考虑在二维九速 (D2Q9) 模型上使用 Bhatnagar-Gross-Krook (BGK) 碰撞模型的格子玻尔兹曼方法 (LBM)。离散粒子速度定义为 $\\,\\mathbf{e}_0=(0,0)$、$\\,\\mathbf{e}_1=(1,0)$、$\\,\\mathbf{e}_2=(0,1)$、$\\,\\mathbf{e}_3=(-1,0)$、$\\,\\mathbf{e}_4=(0,-1)$、$\\,\\mathbf{e}_5=(1,1)$、$\\,\\mathbf{e}_6=(-1,1)$、$\\,\\mathbf{e}_7=(-1,-1)$、$\\,\\mathbf{e}_8=(1,-1)$，格子速度设为1。离散权重为 $\\,w_0=\\frac{4}{9}$、$\\,w_1=w_2=w_3=w_4=\\frac{1}{9}$ 和 $\\,w_5=w_6=w_7=w_8=\\frac{1}{36}$，格子声速满足 $\\,c_s^2=\\frac{1}{3}$。BGK 弛豫时间为 $\\,\\tau=\\frac{3}{2}$，平衡态分布函数由标准的二阶展开式给出\n$$\nf_i^{\\mathrm{eq}}(\\rho,\\mathbf{u})=w_i\\,\\rho\\left[1+\\frac{\\mathbf{e}_i\\cdot\\mathbf{u}}{c_s^2}+\\frac{(\\mathbf{e}_i\\cdot\\mathbf{u})^2}{2\\,c_s^4}-\\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2\\,c_s^2}\\right].\n$$\n在时刻 $\\,t$，假设只有位置 $\\,\\mathbf{x}=\\mathbf{0}$ 处的中心节点具有非零分布函数，具体为\n$$\nf_0=\\frac{1}{3},\\quad f_1=f_2=f_3=f_4=\\frac{1}{6},\\quad f_5=f_6=f_7=f_8=\\frac{1}{12},\n$$\n并且 $\\,3\\times 3$ 模型区域内的所有其他节点上的分布函数均为零。使用带有 BGK 碰撞项的离散玻尔兹曼方程，\n$$\nf_i^{\\star}(\\mathbf{x},t)=f_i(\\mathbf{x},t)-\\frac{1}{\\tau}\\left[f_i(\\mathbf{x},t)-f_i^{\\mathrm{eq}}(\\rho(\\mathbf{x},t),\\mathbf{u}(\\mathbf{x},t))\\right],\n$$\n以及精确的迁移步骤，\n$$\nf_i(\\mathbf{x}+\\mathbf{e}_i,t+\\Delta t)=f_i^{\\star}(\\mathbf{x},t),\n$$\n从给定的中心节点状态开始，执行一次碰撞和迁移步骤。计算迁移后到达 $\\,3\\times 3$ 模型区域内每个相邻节点的分布函数。\n\n将整个模型区域内的标量守恒缺陷定义为\n$$\nD=\\sum_{j=1}^{9}\\rho_{\\mathrm{after}}(\\mathbf{x}_j,t+\\Delta t)-\\sum_{j=1}^{9}\\rho_{\\mathrm{before}}(\\mathbf{x}_j,t),\n$$\n其中求和遍及以 $\\,\\mathbf{0}$ 为中心的 $\\,3\\times 3$ 模型区域，而 $\\,\\rho(\\mathbf{x},t)=\\sum_{i=0}^{8} f_i(\\mathbf{x},t)$ 是局部密度。根据以上步骤明确地计算 $\\,D$。将最终答案表示为一个精确的实数，不进行四舍五入且不带单位。",
            "solution": "该问题被验证为具有科学依据、提法恰当且完整，是格子玻尔兹曼方法中一个基础的教学练习。解答此问题需要依次执行碰撞和迁移两个步骤，并验证整个过程中的质量守恒。\n\n**步骤 1：计算初始宏观量**\n在时刻 $t$，只有中心节点 $\\mathbf{x}=\\mathbf{0}$ 存在非零分布函数。我们首先计算该节点的宏观密度 $\\rho$ 和速度 $\\mathbf{u}$。\n密度：\n$$\n\\rho(\\mathbf{0},t) = \\sum_{i=0}^{8} f_i(\\mathbf{0},t) = f_0 + \\sum_{i=1}^{4} f_i + \\sum_{i=5}^{8} f_i = \\frac{1}{3} + 4 \\times \\frac{1}{6} + 4 \\times \\frac{1}{12} = \\frac{1}{3} + \\frac{2}{3} + \\frac{1}{3} = \\frac{4}{3}\n$$\n动量：\n$$\n\\rho\\mathbf{u}(\\mathbf{0},t) = \\sum_{i=0}^{8} f_i(\\mathbf{0},t) \\mathbf{e}_i\n$$\n由于 $f_1=f_3$, $f_2=f_4$, $f_5=f_7$, $f_6=f_8$，且对应的速度向量 $\\mathbf{e}_i$ 是相反的（例如 $\\mathbf{e}_1 = -\\mathbf{e}_3$），动量各分量相互抵消。例如，$x$方向动量为 $f_1(1) + f_3(-1) + f_5(1) + f_6(-1) + f_7(-1) + f_8(1) = \\frac{1}{6}(1-1) + \\frac{1}{12}(1-1-1+1) = 0$。因此，宏观速度 $\\mathbf{u}(\\mathbf{0},t) = \\mathbf{0}$。\n\n**步骤 2：计算平衡态分布函数**\n使用 $\\rho=4/3$ 和 $\\mathbf{u}=\\mathbf{0}$，平衡态分布函数 $f_i^{\\mathrm{eq}}$ 简化为 $f_i^{\\mathrm{eq}} = w_i \\rho$。\n$$\nf_0^{\\mathrm{eq}} = w_0 \\rho = \\frac{4}{9} \\times \\frac{4}{3} = \\frac{16}{27}\n$$\n$$\nf_{1,2,3,4}^{\\mathrm{eq}} = w_{1} \\rho = \\frac{1}{9} \\times \\frac{4}{3} = \\frac{4}{27}\n$$\n$$\nf_{5,6,7,8}^{\\mathrm{eq}} = w_{5} \\rho = \\frac{1}{36} \\times \\frac{4}{3} = \\frac{4}{108} = \\frac{1}{27}\n$$\n\n**步骤 3：计算碰撞后分布函数**\n使用BGK方程和弛豫时间 $\\tau=3/2$（即 $1/\\tau = 2/3$）：\n$$\nf_i^{\\star} = f_i - \\frac{1}{\\tau}(f_i - f_i^{\\mathrm{eq}}) = f_i - \\frac{2}{3}(f_i - f_i^{\\mathrm{eq}}) = \\frac{1}{3}f_i + \\frac{2}{3}f_i^{\\mathrm{eq}}\n$$\n代入数值：\n$$\nf_0^{\\star} = \\frac{1}{3}\\left(\\frac{1}{3}\\right) + \\frac{2}{3}\\left(\\frac{16}{27}\\right) = \\frac{1}{9} + \\frac{32}{81} = \\frac{9+32}{81} = \\frac{41}{81}\n$$\n$$\nf_{1,2,3,4}^{\\star} = \\frac{1}{3}\\left(\\frac{1}{6}\\right) + \\frac{2}{3}\\left(\\frac{4}{27}\\right) = \\frac{1}{18} + \\frac{8}{81} = \\frac{9+16}{162} = \\frac{25}{162}\n$$\n$$\nf_{5,6,7,8}^{\\star} = \\frac{1}{3}\\left(\\frac{1}{12}\\right) + \\frac{2}{3}\\left(\\frac{1}{27}\\right) = \\frac{1}{36} + \\frac{2}{81} = \\frac{9+8}{324} = \\frac{17}{324}\n$$\n由于碰撞过程是质量守恒的，碰撞后总质量应不变：$\\sum_i f_i^{\\star} = \\frac{41}{81} + 4\\left(\\frac{25}{162}\\right) + 4\\left(\\frac{17}{324}\\right) = \\frac{41}{81} + \\frac{50}{81} + \\frac{17}{81} = \\frac{108}{81} = \\frac{4}{3}$。与初始密度一致。\n\n**步骤 4：执行迁移步骤**\n在迁移步骤中，碰撞后的分布函数 $f_i^{\\star}(\\mathbf{x}, t)$ 移动到相邻节点：$f_i(\\mathbf{x} + \\mathbf{e}_i, t + \\Delta t) = f_i^{\\star}(\\mathbf{x}, t)$。\n由于只有 $\\mathbf{x}=\\mathbf{0}$ 处的 $f_i^{\\star}$ 非零，在 $t+\\Delta t$ 时刻，这些分布函数将到达它们各自的目标节点。\n- $f_0^{\\star}(\\mathbf{0},t)$ 停留在原点 $\\mathbf{0}$，成为 $f_0(\\mathbf{0}, t+\\Delta t)$。\n- $f_1^{\\star}(\\mathbf{0},t)$ 移动到 $\\mathbf{e}_1 = (1,0)$，成为 $f_1(\\mathbf{e}_1, t+\\Delta t)$。\n- ...以此类推， $f_i^{\\star}(\\mathbf{0},t)$ 移动到 $\\mathbf{e}_i$，成为 $f_i(\\mathbf{e}_i, t+\\Delta t)$。\n\n**步骤 5：计算守恒缺陷 $D$**\n首先，计算迁移前的总质量。在 $t$ 时刻，只有中心节点有质量，其余8个节点密度为0。\n$$\n\\sum_{j=1}^{9} \\rho_{\\mathrm{before}}(\\mathbf{x}_j, t) = \\rho(\\mathbf{0}, t) + \\sum_{j \\neq \\text{center}} 0 = \\frac{4}{3}\n$$\n然后，计算迁移后的总质量。在 $t+\\Delta t$ 时刻，$3 \\times 3$ 区域内每个节点 $\\mathbf{x}_j$ 的密度为 $\\rho_{\\mathrm{after}}(\\mathbf{x}_j, t+\\Delta t) = \\sum_i f_i(\\mathbf{x}_j, t+\\Delta t)$。\n在迁移之后，原来的分布函数 $f_i^{\\star}(\\mathbf{0},t)$ 已经移动到了节点 $\\mathbf{e}_i$。因此，在 $t+\\Delta t$ 时刻，整个 $3 \\times 3$ 区域内的总质量是所有迁移后分布函数的总和。\n$$\n\\sum_{j=1}^{9} \\rho_{\\mathrm{after}}(\\mathbf{x}_j, t+\\Delta t) = \\sum_{j=1}^{9} \\sum_{i=0}^{8} f_i(\\mathbf{x}_j, t+\\Delta t)\n$$\n由于迁移只是对分布函数的重新标记和位置移动，总和不变：\n$$\n\\sum_{\\text{all } \\mathbf{x}} \\sum_i f_i(\\mathbf{x}, t+\\Delta t) = \\sum_{\\text{all } \\mathbf{x}} \\sum_i f_i^{\\star}(\\mathbf{x}, t)\n$$\n在本例中，碰撞只发生在 $\\mathbf{x}=\\mathbf{0}$，所以右侧的和为 $\\sum_i f_i^{\\star}(\\mathbf{0},t)$。正如步骤3中验证的，这个和等于 $\\frac{4}{3}$。\n\n**步骤 6：计算最终缺陷**\n$$\nD = \\sum \\rho_{\\mathrm{after}} - \\sum \\rho_{\\mathrm{before}} = \\frac{4}{3} - \\frac{4}{3} = 0\n$$\n这表明LBM的碰撞-迁移过程在整个计算域内是精确质量守恒的。",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "虽然标准的BGK模型被广泛使用，但其稳定性可能受限。更先进的碰撞模型，如熵格子玻尔兹曼方法，通过强制执行动力学理论的一项基本原则来增强稳定性。这个被称为离散H定理的原则，作为热力学第二定律的类似物，规定了系统熵在碰撞过程中不应增加。本编程练习旨在挑战您实现一个熵碰撞算子，并数值验证其满足H定理 。这不仅能加深您对LBM物理基础的理解，还能提供构建更稳健、更先进模拟模型的实践经验。",
            "id": "3774260",
            "problem": "您需要实现并分析格子玻尔兹曼方法 (LBM) 的碰撞和迁移步骤，其中使用针对二维九速 (D2Q9) 离散速度模型的熵 BGK (Bhatnagar–Gross–Krook) 碰撞算子，并以格子单位对简单剪切流进行离散 $H$ 定理的数值验证。\n\n从以下基本原理开始：\n- 对于沿离散速度 $\\mathbf{c}_i$ 的布居数 $f_i$，碰撞形式的离散速度玻尔兹曼方程表达了向局部平衡态 $f_i^{\\mathrm{eq}}$ 的弛豫过程，同时保持质量和动量守恒。\n- 离散熵（也称为 $H$ 泛函）定义为\n$$\nH(\\mathbf{f}) = \\sum_{i} f_i \\ln\\left(\\frac{f_i}{w_i}\\right),\n$$\n其中 $w_i$ 是与离散速度相关联的标准求积权重；离散 $H$ 定理要求熵在碰撞过程中非增。\n- 碰撞算子是熵 BGK (Bhatnagar–Gross–Krook) 算子：从布居数 $f_i$ 和相应的局部平衡态 $f_i^{\\mathrm{eq}}$ 开始，碰撞后的布居数 $f_i^*$ 沿直线 $f_i + \\alpha \\beta (f_i^{\\mathrm{eq}} - f_i)$ 更新，其中 $\\alpha$ 是一个标量，其选择旨在确保 $H$ 的非增性和布居数的正性；$\\beta$ 是一个满足 $0 < \\beta \\leq 1$ 的弛豫参数。\n\n使用具有以下离散速度和权重的 D2Q9 模型：\n- 离散速度 $\\mathbf{c}_i \\in \\{(0,0), (1,0), (0,1), (-1,0), (0,-1), (1,1), (-1,1), (-1,-1), (1,-1)\\}$，其分量为 $\\mathbf{c}_i = (c_{ix}, c_{iy})$。\n- 权重 $w_0 = \\frac{4}{9}$，$w_{1,2,3,4} = \\frac{1}{9}$，$w_{5,6,7,8} = \\frac{1}{36}$。\n\n通过矩关系定义局部宏观密度和速度\n$$\n\\rho = \\sum_i f_i, \\quad \\rho \\mathbf{u} = \\sum_i f_i \\mathbf{c}_i,\n$$\n并将 D2Q9 局部平衡态 $f_i^{\\mathrm{eq}}$ 构建为与这些矩约束一致的二阶低马赫数近似。\n\n按如下方式实现碰撞步骤：\n1. 对每个格点，根据布居数 $f_i$ 计算局部宏观场 $(\\rho, \\mathbf{u})$。\n2. 构建与 $(\\rho, \\mathbf{u})$ 一致的局部平衡态 $f_i^{\\mathrm{eq}}$。\n3. 通过沿直线 $f_i + \\alpha (f_i^{\\mathrm{eq}} - f_i)$ 进行单调搜索，在每个格点确定熵参数 $\\alpha$，以保证所有布居数的正性及 $H$ 泛函的非增性。如果 $\\alpha = 2$ 的值违反了正性或 $H$ 的非增性，则减小 $\\alpha$ 直至 $H$ 不再增加。然后更新 $f_i^* = f_i + \\alpha \\beta (f_i^{\\mathrm{eq}} - f_i)$。\n4. 通过将布居数 $f_i^*$ 沿其离散速度移动到相邻格点来执行迁移，并在两个方向上应用周期性边界条件。\n\n在时间步 $t = 0$ 时，通过设置线性剪切剖面 $u_x(y) = U \\, y / (N_y - 1)$ 和 $u_y(y) = 0$、密度恒为 $\\rho = 1$ 来初始化一个简单剪切流，其中 $y$ 是垂直坐标的索引，$N_y$ 是垂直格子尺寸。将初始布居数构建为与该剪切场对应的局部平衡态，然后添加小的扰动，这些扰动在每个格点上保持守恒矩不变，即确保 $\\sum_i \\delta f_i = 0$，$\\sum_i \\delta f_i c_{ix} = 0$ 和 $\\sum_i \\delta f_i c_{iy} = 0$，且选择的扰动幅度应使所有布居数保持严格为正。\n\n验证任务：\n- 在每个时间步，计算碰撞前和碰撞后（但在迁移前）的全局熵 $H$（在整个格子上聚合）。通过检查 $H$ 在碰撞下是否非增来数值验证离散 $H$ 定理。迁移是布居数的重新标记，不应改变全局 $H$。\n\n所有量均采用无量纲的格子单位。不使用角度。不需要格子单位之外的物理单位。\n\n测试套件：\n提供一个程序，运行以下参数集（每个参数集作为一个测试用例），并为每个用例返回一个布尔值，指示在该用例的所有步骤中，全局熵在碰撞下是否均非增：\n- 用例1：$N_x = 32$，$N_y = 16$，$U = 0.05$，$\\beta = 0.9$，扰动幅度 $a = 10^{-4}$，步数 $T = 20$。\n- 用例2：$N_x = 32$，$N_y = 16$，$U = 0.15$，$\\beta = 0.8$，扰动幅度 $a = 5 \\cdot 10^{-4}$，步数 $T = 20$。\n- 用例3：$N_x = 8$，$N_y = 8$，$U = 0.0$，$\\beta = 0.95$，扰动幅度 $a = 10^{-3}$，步数 $T = 10$。\n- 用例4：$N_x = 16$，$N_y = 16$，$U = 0.1$，$\\beta = 0.5$，扰动幅度 $a = 0.0$，步数 $T = 5$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result1,result2,result3,result4]”），其中每个结果是对应于上述顺序的一个测试用例的布尔值。程序必须是自包含的，并且不需要用户输入。",
            "solution": "问题陈述已经过分析并被确定为**有效**。它描述了一个计算流体动力学领域中定义明确且具有科学依据的问题，特别是实现带有熵碰撞算子的格子玻尔兹曼方法 (LBM)。给定的参数、方程和验证任务是一致、完整且符合多尺度建模领域的标准。\n\n在此，我提供一个详细的、分步的解决方案。\n\n### 1. 格子玻尔兹曼方法：基本原理\n\n格子玻尔兹曼方法 (LBM) 是一种源于动理学理论的数值技术，用于模拟流体动力学。它不直接处理速度和压力等宏观变量，而是操作一组离散的粒子分布函数 $f_i(\\mathbf{x}, t)$，该函数表示在位置 $\\mathbf{x}$ 和时间 $t$ 找到具有离散速度 $\\mathbf{c}_i$ 的流体粒子的概率。这些布居数的演化由离散速度玻尔兹曼方程控制，该方程可简化为两个主要步骤：碰撞和迁移。\n\n### 2. D2Q9 模型\n\n本问题采用二维九速 (D2Q9) 模型，这是模拟二维流体动力学的常用选择。\n-   离散速度集 $\\mathbf{c}_i \\in \\mathbb{R}^2$（对于 $i \\in \\{0, 1, \\dots, 8\\}$）由下式给出：\n    $$\n    \\{\\mathbf{c}_i\\} = \\left\\{\n    \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix},\n    \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix},\n    \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix},\n    \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix},\n    \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix},\n    \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix},\n    \\begin{pmatrix} -1 \\\\ 1 \\end{pmatrix},\n    \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix},\n    \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}\n    \\right\\}\n    $$\n-   与每个速度相关联的是一个权重 $w_i$，用于数值积分。对于 D2Q9 模型，这些权重是：\n    -   $w_0 = 4/9$（对于静止粒子）\n    -   $w_{1,2,3,4} = 1/9$（对于沿坐标轴移动的粒子）\n    -   $w_{5,6,7,8} = 1/36$（对于沿对角线移动的粒子）\n-   格子声速 $c_s$ 是该模型的一个基本参数，定义为 $c_s^2 = \\sum_i w_i c_{ix}^2 = 1/3$。\n\n### 3. 宏观变量与局部平衡态\n\n每个格点上的宏观流体密度 $\\rho$ 和速度 $\\mathbf{u}$ 作为分布函数的矩进行计算：\n$$\n\\rho = \\sum_{i=0}^{8} f_i\n$$\n$$\n\\rho \\mathbf{u} = \\sum_{i=0}^{8} f_i \\mathbf{c}_i\n$$\n碰撞步骤模拟了系统向局部麦克斯韦-玻尔兹曼平衡态的弛豫过程。在低马赫数极限下，该平衡分布 $f_i^{\\mathrm{eq}}$ 由一个关于速度的二阶多项式近似：\n$$\nf_i^{\\mathrm{eq}}(\\rho, \\mathbf{u}) = w_i \\rho \\left[ 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2c_s^2} \\right]\n$$\n这种特定形式确保 $f_i^{\\mathrm{eq}}$ 的矩能精确地恢复宏观密度 $\\rho$ 和动量 $\\rho\\mathbf{u}$。\n\n### 4. 熵碰撞算子与离散 $H$ 定理\n\n碰撞过程将布居数 $f_i$ 更新为碰撞后状态 $f_i^*$。本问题指定了一个熵 BGK (Bhatnagar-Gross-Krook) 算子：\n$$\nf_i^* = f_i + \\alpha \\beta (f_i^{\\mathrm{eq}} - f_i)\n$$\n这里，$\\beta \\in (0, 1]$ 是一个与流体粘性相关的基本弛豫参数。参数 $\\alpha$ 是一个动态调整的标量，通过强制执行两个条件来确保模拟的稳定性和物理一致性：\n1.  **正性**：所有碰撞后的布居数必须为正，即 $f_i^* > 0$。\n2.  **离散 $H$ 定理**：碰撞不能增加离散熵或 $H$ 泛函。熵定义为：\n    $$\n    H(\\mathbf{f}) = \\sum_{i=0}^{8} f_i \\ln\\left(\\frac{f_i}{w_i}\\right)\n    $$\n    $H$ 定理要求在每个格点上都有 $H(\\mathbf{f}^*) \\le H(\\mathbf{f})$。该法则是热力学第二定律的离散模拟。\n\n在每个格点上寻找合适 $\\alpha$ 的数值过程是线搜索。我们从一个试验值 $\\alpha=2$ 开始。如果得到的 $f_i^*$ 违反了正性或 $H$ 定理，则迭代地减小 $\\alpha$（例如，通过折半法）直到两个条件都满足。\n\n### 5. 初始化与扰动\n\n模拟通过简单剪切流进行初始化，其中水平速度 $u_x$ 随垂直坐标 $y$ 线性变化：\n$$\n\\rho(\\mathbf{x}, t=0) = 1, \\quad u_x(y, t=0) = \\frac{U y}{N_y - 1}, \\quad u_y(y, t=0) = 0\n$$\n初始布居数 $f_i(\\mathbf{x}, t=0)$ 被设置为相应的局部平衡值 $f_i^{\\mathrm{eq}}$，外加一个幅度为 $a$ 的小扰动 $\\delta f_i$。为了从一开始就使系统脱离平衡，这个扰动必须非零（用例4除外）。至关重要的是，该扰动不能改变宏观守恒量：\n$$\n\\sum_i \\delta f_i = 0, \\quad \\sum_i \\delta f_i c_{ix} = 0, \\quad \\sum_i \\delta f_i c_{iy} = 0\n$$\n一个满足这些矩约束的有效、确定性的扰动可以通过对角方向速度对应的布居数加上或减去幅度 $a$ 来构造：\n$$\n\\delta f_5 = a, \\quad \\delta f_6 = -a, \\quad \\delta f_7 = a, \\quad \\delta f_8 = -a\n$$\n这种特定的选择扰动了分布函数的一个高阶非守恒矩。\n\n### 6. 迁移步骤\n\n碰撞之后，迁移步骤模拟粒子的平流。更新后的布居数 $f_i^*$ 根据其离散速度 $\\mathbf{c}_i$ 移动到相邻的格点：\n$$\nf_i(\\mathbf{x} + \\mathbf{c}_i, t + \\Delta t) = f_i^*(\\mathbf{x}, t)\n$$\n其中 $\\Delta t$ 是时间步长，在格子单位中取为1。这被实现为一种“拉”方案，其中每个节点 $(\\mathbf{x})$ 从其邻居 $(\\mathbf{x} - \\mathbf{c}_i)$ 收集相应的碰撞后布居数。对于指定的周期性边界条件，此操作可通过对布居数数组进行循环移位来高效执行。\n\n### 7. $H$ 定理的验证\n\n核心任务是验证在每个时间步的碰撞阶段，全局熵不会增加。\n1.  碰撞前，计算全局碰撞前熵，$H_{pre} = \\sum_{\\mathrm{nodes}} H(\\mathbf{f})$。\n2.  在所有节点上计算出 $f_i^*$ 后，计算全局碰撞后熵，$H_{post} = \\sum_{\\mathrm{nodes}} H(\\mathbf{f}^*)$。\n3.  如果在每个时间步 $t \\in [1, T]$ 都有 $H_{post} \\le H_{pre} + \\epsilon$，则该定理得到数值验证，其中 $\\epsilon$ 是用于浮点不精确性的一个小的容差。如果在一个测试用例的所有步骤中该不等式都成立，则该用例的结果为 `True`。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases for the LBM simulation.\n    \"\"\"\n    test_cases = [\n        # (Nx, Ny, U, beta, a, T)\n        (32, 16, 0.05, 0.9, 1e-4, 20),\n        (32, 16, 0.15, 0.8, 5e-4, 20),\n        (8, 8, 0.0, 0.95, 1e-3, 10),\n        (16, 16, 0.1, 0.5, 0.0, 5),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _run_lbm_case(*case)\n        results.append(str(result))\n\n    print(f\"[{','.join(results)}]\")\n\ndef _run_lbm_case(Nx, Ny, U, beta, a, T):\n    \"\"\"\n    Runs a single LBM simulation case and verifies the H-theorem.\n    \"\"\"\n    # D2Q9 model constants\n    Q = 9\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1],\n                  [1, 1], [-1, 1], [-1, -1], [1, -1]])\n    w = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    cs2 = 1.0 / 3.0\n    \n    # Numerical precision epsilon\n    epsilon = 1e-30\n\n    def f_equilibrium(rho, u):\n        \"\"\"Computes the D2Q9 equilibrium distribution.\"\"\"\n        feq = np.zeros((Ny, Nx, Q))\n        u_sq = u[..., 0]**2 + u[..., 1]**2\n        for i in range(Q):\n            cu = c[i, 0] * u[..., 0] + c[i, 1] * u[..., 1]\n            feq[..., i] = w[i] * rho * (1 + cu/cs2 + 0.5 * (cu/cs2)**2 - 0.5 * u_sq/cs2)\n        return feq\n\n    def h_discrete(f):\n        \"\"\"Computes the global discrete H-functional.\"\"\"\n        # Using [:, :, np.newaxis] for broadcasting weights w\n        return np.sum(f * np.log(f / w + epsilon))\n\n    # --- Initialization ---\n    y_coords = np.arange(Ny)\n    \n    rho = np.ones((Ny, Nx))\n    u = np.zeros((Ny, Nx, 2))\n    u[..., 0] = U * y_coords[:, np.newaxis] / (Ny - 1)\n    \n    f = f_equilibrium(rho, u)\n    \n    if a > 0:\n        # Add a moment-preserving perturbation.\n        # This choice perturbs a non-conserved higher-order moment.\n        # df such that sum(df) = 0, sum(df*cx)=0, sum(df*cy)=0\n        f[..., 5] += a\n        f[..., 6] -= a\n        f[..., 7] += a\n        f[..., 8] -= a\n    \n    # Pre-simulation check for positivity\n    if np.any(f <= 0):\n        # A large perturbation might violate positivity from the start.\n        return False\n\n    h_theorem_verified = True\n\n    # --- Main Time-Stepping Loop ---\n    for _ in range(T):\n        # Calculate pre-collision global entropy\n        H_pre = h_discrete(f)\n        \n        # --- Collision Step ---\n        \n        # 1. Macroscopic variables\n        rho = np.sum(f, axis=2)\n        rho_inv = 1.0 / (rho + epsilon)\n        u_x = np.sum(f * c[:, 0], axis=2) * rho_inv\n        u_y = np.sum(f * c[:, 1], axis=2) * rho_inv\n        u = np.stack((u_x, u_y), axis=-1)\n\n        # 2. Equilibrium populations\n        feq = f_equilibrium(rho, u)\n        \n        # 3. Vectorized search for entropic parameter alpha\n        alpha = np.full((Ny, Nx), 2.0)\n        f_diff = beta * (feq - f)\n        \n        # Pre-calculate local pre-collision entropy for comparison\n        H_local_pre = np.sum(f * np.log(f / w + epsilon), axis=2)\n        \n        for _ in range(15): # Max 15 halving iterations\n            f_post = f + alpha[..., np.newaxis] * f_diff\n            \n            # Mask for nodes where alpha needs reduction\n            positivity_violated = np.any(f_post <= 0, axis=2)\n            \n            # To avoid log errors, only compute H for positive populations\n            f_post_safe = np.maximum(f_post, epsilon)\n            H_local_post = np.sum(f_post_safe * np.log(f_post_safe / w + epsilon), axis=2)\n            \n            h_theorem_violated = (H_local_post > H_local_pre + 1e-12) & (~positivity_violated)\n            \n            mask_to_reduce = positivity_violated | h_theorem_violated\n            \n            if not np.any(mask_to_reduce):\n                break # All nodes satisfy the conditions\n                \n            alpha[mask_to_reduce] /= 2.0\n            \n        f_post = f + alpha[..., np.newaxis] * f_diff\n\n        # Calculate post-collision global entropy\n        H_post = h_discrete(f_post)\n\n        # Verify H-theorem globally\n        if H_post > H_pre + 1e-9: # Use a tolerance for floating point sums\n            h_theorem_verified = False\n            break\n\n        # --- Streaming Step ---\n        # \"Pull\" scheme with periodic BCs implemented via np.roll\n        f_streamed = np.zeros_like(f)\n        for i in range(Q):\n            f_streamed[..., i] = np.roll(f_post[..., i], shift=(c[i, 1], c[i, 0]), axis=(0, 1))\n        \n        f = f_streamed\n\n    # Return boolean converted to lowercase for JSON compatibility\n    return h_theorem_verified\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}