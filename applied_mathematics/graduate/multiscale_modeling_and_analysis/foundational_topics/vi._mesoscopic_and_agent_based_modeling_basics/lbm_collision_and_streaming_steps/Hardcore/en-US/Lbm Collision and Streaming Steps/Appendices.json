{
    "hands_on_practices": [
        {
            "introduction": "The collision step in the Lattice Boltzmann Method (LBM) guides particle populations toward a local equilibrium state, $f_i^{\\mathrm{eq}}$. This equilibrium distribution is the cornerstone of the method, as it must be carefully constructed to bridge the gap between the discrete particle world and continuum fluid dynamics. This exercise will have you derive the standard form of $f_i^{\\mathrm{eq}}$ by enforcing the physical constraints that its moments must recover the exact macroscopic density, momentum, and stress tensor, providing a foundational understanding of this crucial micro-macro link. ",
            "id": "3774257",
            "problem": "A two-dimensional nine-velocity lattice (D2Q9) model within the Lattice Boltzmann Method (LBM) is considered in lattice units, where the particle streaming speed is $c=1$ and the lattice sound speed satisfies $c_{s}^{2} = 1/3$. In the single-relaxation-time Bhatnagar-Gross-Krook (BGK) kinetic model, the collision step relaxes the one-particle distribution toward an equilibrium that must recover the hydrodynamic fields and isotropic stress tensor in the low Mach number regime when moments are taken over a suitable discrete velocity set. Starting from the continuous Maxwell-Boltzmann equilibrium distribution expanded to second order in the fluid velocity and invoking the constraints that the discrete equilibrium yields the exact density, momentum, and isotropic second-order moment consistent with $c_{s}^{2}$, derive the discrete equilibrium populations $f_{i}^{eq}$ on the D2Q9 lattice.\n\nThe D2Q9 discrete velocities are\n$$\n\\mathbf{e}_{0} = (0,0),\\quad\n\\mathbf{e}_{1} = (1,0),\\quad\n\\mathbf{e}_{2} = (0,1),\\quad\n\\mathbf{e}_{3} = (-1,0),\\quad\n\\mathbf{e}_{4} = (0,-1),\\quad\n\\mathbf{e}_{5} = (1,1),\\quad\n\\mathbf{e}_{6} = (-1,1),\\quad\n\\mathbf{e}_{7} = (-1,-1),\\quad\n\\mathbf{e}_{8} = (1,-1),\n$$\nwith corresponding Gauss-Hermite quadrature weights\n$$\nw_{0} = \\frac{4}{9},\\quad w_{1} = w_{2} = w_{3} = w_{4} = \\frac{1}{9},\\quad w_{5} = w_{6} = w_{7} = w_{8} = \\frac{1}{36}.\n$$\n\nUsing your derived formula, evaluate the equilibrium populations numerically for density $\\rho = 1.2$ and velocity $\\mathbf{u} = (0.08,-0.03)$. Verify the zeroth and first moment constraints, and check the positivity condition for all nine directions. Finally, report the minimum value of $f_{i}^{eq}$ over all $i \\in \\{0,\\dots,8\\}$ as your single final result in lattice units. Round your final answer to six significant figures.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and complete. It is a standard problem in the field of Lattice Boltzmann Methods (LBM) and all necessary data and conditions are provided.\n\nThe primary objective is to derive the discrete equilibrium distribution function, $f_{i}^{eq}$, for a two-dimensional, nine-velocity (D2Q9) lattice model. The derivation is based on enforcing constraints on the moments of the distribution function. The standard second-order-accurate-in-velocity expansion for $f_{i}^{eq}$ can be written in a general polynomial form. However, the most direct method, as required by the problem's constraints, is to determine the form of $f_{i}^{eq}$ by ensuring it recovers the correct hydrodynamic moments: density, momentum, and the momentum flux tensor.\n\nThe constraints on the moments of the discrete equilibrium distribution $f_{i}^{eq}$ are:\n1.  Zeroth moment (mass conservation): $\\sum_{i=0}^{8} f_{i}^{eq} = \\rho$\n2.  First moment (momentum conservation): $\\sum_{i=0}^{8} f_{i}^{eq} \\mathbf{e}_{i} = \\rho \\mathbf{u}$\n3.  Second moment (momentum flux): $\\sum_{i=0}^{8} f_{i}^{eq} \\mathbf{e}_{i} \\mathbf{e}_{i} = \\mathbf{\\Pi}^{eq} = \\rho c_{s}^{2} \\mathbf{I} + \\rho \\mathbf{u} \\mathbf{u}$\nHere, $\\rho$ is the fluid density, $\\mathbf{u}$ is the fluid velocity, $\\mathbf{e}_i$ are the discrete lattice velocities, $c_s$ is the sound speed, and $\\mathbf{I}$ is the identity tensor.\n\nWe seek an expression for $f_i^{eq}$ that is a function of $\\rho$, $\\mathbf{u}$, and $\\mathbf{e}_i$. The standard approach, consistent with a second-order expansion of the Maxwell-Boltzmann distribution, is to assume the following form:\n$$f_{i}^{eq} = w_i \\rho \\left[ A + B(\\mathbf{e}_i \\cdot \\mathbf{u}) + C(\\mathbf{e}_i \\cdot \\mathbf{u})^2 + D u^2 \\right]$$\nwhere $w_i$ are the lattice weights and $A$, $B$, $C$, $D$ are constants to be determined by the moment constraints. For this derivation, we use the following known properties of the D2Q9 lattice, where $\\alpha, \\beta, \\gamma, \\delta$ are Cartesian indices:\n$$\n\\sum_{i} w_i = 1 \\\\\n\\sum_{i} w_i e_{i\\alpha} = 0 \\\\\n\\sum_{i} w_i e_{i\\alpha} e_{i\\beta} = c_s^2 \\delta_{\\alpha\\beta} \\\\\n\\sum_{i} w_i e_{i\\alpha} e_{i\\beta} e_{i\\gamma} = 0 \\\\\n\\sum_{i} w_i e_{i\\alpha} e_{i\\beta} e_{i\\gamma} e_{i\\delta} = c_s^4 (\\delta_{\\alpha\\beta}\\delta_{\\gamma\\delta} + \\delta_{\\alpha\\gamma}\\delta_{\\beta\\delta} + \\delta_{\\alpha\\delta}\\delta_{\\beta\\gamma})\n$$\nThe problem specifies $c_s^2 = 1/3$.\n\nApplying the zeroth moment constraint:\n$$ \\sum_{i} f_{i}^{eq} = \\rho \\sum_{i} w_i \\left[ A + B e_{i\\alpha} u_{\\alpha} + C e_{i\\alpha}e_{i\\beta} u_{\\alpha} u_{\\beta} + D u_{\\gamma} u_{\\gamma} \\right] $$\n$$ \\rho = \\rho \\left[ A \\sum w_i + B u_{\\alpha} \\sum w_i e_{i\\alpha} + C u_{\\alpha} u_{\\beta} \\sum w_i e_{i\\alpha}e_{i\\beta} + D u^2 \\sum w_i \\right] $$\n$$ \\rho = \\rho \\left[ A(1) + B u_{\\alpha}(0) + C u_{\\alpha} u_{\\beta}(c_s^2 \\delta_{\\alpha\\beta}) + D u^2(1) \\right] $$\n$$ 1 = A + C c_s^2 u^2 + D u^2 $$\nFor this to hold for any $\\mathbf{u}$, we must have $A=1$ and $C c_s^2 + D = 0$.\n\nApplying the first moment constraint:\n$$ \\sum_{i} f_{i}^{eq} e_{i\\gamma} = \\rho \\sum_{i} w_i e_{i\\gamma} \\left[ A + B e_{i\\alpha} u_{\\alpha} + \\dots \\right] $$\n$$ \\rho u_{\\gamma} = \\rho \\left[ A \\sum w_i e_{i\\gamma} + B u_{\\alpha} \\sum w_i e_{i\\gamma}e_{i\\alpha} + \\dots \\right] $$\n$$ \\rho u_{\\gamma} = \\rho \\left[ A(0) + B u_{\\alpha} (c_s^2 \\delta_{\\gamma\\alpha}) + \\dots \\right] $$\n$$ \\rho u_{\\gamma} = \\rho B c_s^2 u_{\\gamma} \\implies B = \\frac{1}{c_s^2} $$\n\nApplying the second moment constraint:\n$$ \\sum_{i} f_{i}^{eq} e_{i\\gamma} e_{i\\delta} = \\rho \\sum_{i} w_i e_{i\\gamma} e_{i\\delta} \\left[ A + B e_{i\\alpha} u_{\\alpha} + C e_{i\\alpha}e_{i\\beta} u_{\\alpha} u_{\\beta} + D u^2 \\right] $$\n$$ \\rho c_s^2 \\delta_{\\gamma\\delta} + \\rho u_{\\gamma} u_{\\delta} = \\rho \\left[ A c_s^2 \\delta_{\\gamma\\delta} + C u_{\\alpha} u_{\\beta} \\sum w_i e_{i\\gamma}e_{i\\delta}e_{i\\alpha}e_{i\\beta} + D u^2 c_s^2 \\delta_{\\gamma\\delta} \\right] $$\nUsing the fourth-order moment property:\n$$ \\sum w_i e_{i\\gamma}e_{i\\delta}e_{i\\alpha}e_{i\\beta} = c_s^4(\\delta_{\\gamma\\delta}\\delta_{\\alpha\\beta} + \\delta_{\\gamma\\alpha}\\delta_{\\delta\\beta} + \\delta_{\\gamma\\beta}\\delta_{\\delta\\alpha}) $$\nThe term becomes $C u_{\\alpha} u_{\\beta} c_s^4 (\\delta_{\\gamma\\delta}\\delta_{\\alpha\\beta} + \\delta_{\\gamma\\alpha}\\delta_{\\delta\\beta} + \\delta_{\\gamma\\beta}\\delta_{\\delta\\alpha}) = C c_s^4 (u^2 \\delta_{\\gamma\\delta} + 2 u_{\\gamma} u_{\\delta})$.\nSubstituting back:\n$$ c_s^2 \\delta_{\\gamma\\delta} + u_{\\gamma} u_{\\delta} = (A c_s^2 + D u^2 c_s^2) \\delta_{\\gamma\\delta} + C c_s^4 (u^2 \\delta_{\\gamma\\delta} + 2 u_{\\gamma} u_{\\delta}) $$\n$$ c_s^2 \\delta_{\\gamma\\delta} + u_{\\gamma} u_{\\delta} = (A c_s^2 + (D c_s^2 + C c_s^4)u^2) \\delta_{\\gamma\\delta} + (2 C c_s^4) u_{\\gamma} u_{\\delta} $$\nEquating coefficients of $u_{\\gamma}u_{\\delta}$:\n$$ 1 = 2 C c_s^4 \\implies C = \\frac{1}{2c_s^4} $$\nFrom $C c_s^2 + D = 0$, we find $D = -C c_s^2 = -\\frac{1}{2c_s^2}$.\nSubstituting the constants back into the assumed form for $f_i^{eq}$:\n$$ f_{i}^{eq} = w_i \\rho \\left[ 1 + \\frac{\\mathbf{e}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{e}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{u^2}{2c_s^2} \\right] $$\nThis is the desired discrete equilibrium distribution function. With $c_s^2 = 1/3$:\n$$ f_{i}^{eq} = w_i \\rho \\left[ 1 + 3(\\mathbf{e}_i \\cdot \\mathbf{u}) + \\frac{9}{2}(\\mathbf{e}_i \\cdot \\mathbf{u})^2 - \\frac{3}{2}u^2 \\right] $$\n\nNow, we evaluate this for the given numerical values: $\\rho = 1.2$ and $\\mathbf{u} = (0.08, -0.03)$.\nFirst, calculate $u^2 = |\\mathbf{u}|^2 = (0.08)^2 + (-0.03)^2 = 0.0064 + 0.0009 = 0.0073$.\nThe term in the brackets is $S_i = 1 + 3(\\mathbf{e}_i \\cdot \\mathbf{u}) + 4.5(\\mathbf{e}_i \\cdot \\mathbf{u})^2 - 1.5(0.0073) = 0.98905 + 3(\\mathbf{e}_i \\cdot \\mathbf{u}) + 4.5(\\mathbf{e}_i \\cdot \\mathbf{u})^2$.\n\nWe calculate $\\mathbf{e}_i \\cdot \\mathbf{u}$ for each direction $i$:\n$\\mathbf{e}_0 \\cdot \\mathbf{u} = 0.0$\n$\\mathbf{e}_1 \\cdot \\mathbf{u} = 0.08$\n$\\mathbf{e}_2 \\cdot \\mathbf{u} = -0.03$\n$\\mathbf{e}_3 \\cdot \\mathbf{u} = -0.08$\n$\\mathbf{e}_4 \\cdot \\mathbf{u} = 0.03$\n$\\mathbf{e}_5 \\cdot \\mathbf{u} = 0.08 - 0.03 = 0.05$\n$\\mathbf{e}_6 \\cdot \\mathbf{u} = -0.08 - 0.03 = -0.11$\n$\\mathbf{e}_7 \\cdot \\mathbf{u} = -0.08 + 0.03 = -0.05$\n$\\mathbf{e}_8 \\cdot \\mathbf{u} = 0.08 + 0.03 = 0.11$\n\nNow calculate $f_i^{eq} = w_i \\rho S_i = 1.2 w_i S_i$ for each $i$:\n$i=0$: $\\mathbf{e}_0 \\cdot \\mathbf{u}=0$. $S_0 = 0.98905$. $f_0^{eq} = \\frac{4}{9} (1.2)(0.98905) \\approx 0.52749333$\n$i=1$: $\\mathbf{e}_1 \\cdot \\mathbf{u}=0.08$. $S_1 = 0.98905 + 3(0.08) + 4.5(0.08)^2 = 1.25785$. $f_1^{eq} = \\frac{1}{9}(1.2)(1.25785) \\approx 0.16771333$\n$i=2$: $\\mathbf{e}_2 \\cdot \\mathbf{u}=-0.03$. $S_2 = 0.98905 + 3(-0.03) + 4.5(-0.03)^2 = 0.9031$. $f_2^{eq} = \\frac{1}{9}(1.2)(0.9031) \\approx 0.12041333$\n$i=3$: $\\mathbf{e}_3 \\cdot \\mathbf{u}=-0.08$. $S_3 = 0.98905 + 3(-0.08) + 4.5(-0.08)^2 = 0.77785$. $f_3^{eq} = \\frac{1}{9}(1.2)(0.77785) \\approx 0.10371333$\n$i=4$: $\\mathbf{e}_4 \\cdot \\mathbf{u}=0.03$. $S_4 = 0.98905 + 3(0.03) + 4.5(0.03)^2 = 1.0831$. $f_4^{eq} = \\frac{1}{9}(1.2)(1.0831) \\approx 0.14441333$\n$i=5$: $\\mathbf{e}_5 \\cdot \\mathbf{u}=0.05$. $S_5 = 0.98905 + 3(0.05) + 4.5(0.05)^2 = 1.1503$. $f_5^{eq} = \\frac{1}{36}(1.2)(1.1503) \\approx 0.03834333$\n$i=6$: $\\mathbf{e}_6 \\cdot \\mathbf{u}=-0.11$. $S_6 = 0.98905 + 3(-0.11) + 4.5(-0.11)^2 = 0.7135$. $f_6^{eq} = \\frac{1}{36}(1.2)(0.7135) \\approx 0.02378333$\n$i=7$: $\\mathbf{e}_7 \\cdot \\mathbf{u}=-0.05$. $S_7 = 0.98905 + 3(-0.05) + 4.5(-0.05)^2 = 0.8503$. $f_7^{eq} = \\frac{1}{36}(1.2)(0.8503) \\approx 0.02834333$\n$i=8$: $\\mathbf{e}_8 \\cdot \\mathbf{u}=0.11$. $S_8 = 0.98905 + 3(0.11) + 4.5(0.11)^2 = 1.3735$. $f_8^{eq} = \\frac{1}{36}(1.2)(1.3735) \\approx 0.04578333$\n\nVerification of constraints:\nZeroth moment: $\\sum_i f_i^{eq} \\approx 0.527493 + 0.167713 + 0.120413 + 0.103713 + 0.144413 + 0.038343 + 0.023783 + 0.028343 + 0.045783 = 1.200000$. This matches $\\rho$.\nFirst moment (x-component): $\\sum_i f_i^{eq} e_{ix} = f_1 - f_3 + f_5 - f_6 - f_7 + f_8 \\approx 0.167713 - 0.103713 + 0.038343 - 0.023783 - 0.028343 + 0.045783 = 0.096$. This matches $\\rho u_x = 1.2 \\times 0.08 = 0.096$.\nFirst moment (y-component): $\\sum_i f_i^{eq} e_{iy} = f_2 - f_4 + f_5 + f_6 - f_7 - f_8 \\approx 0.120413 - 0.144413 + 0.038343 + 0.023783 - 0.028343 - 0.045783 = -0.036$. This matches $\\rho u_y = 1.2 \\times -0.03 = -0.036$.\nPositivity condition: All calculated $f_i^{eq}$ values are positive.\n\nThe minimum value among the calculated equilibrium populations is for $i=6$:\n$f_6^{eq} \\approx 0.02378333...$\nRounding to six significant figures, the value is $0.0237833$.",
            "answer": "$$\\boxed{0.0237833}$$"
        },
        {
            "introduction": "With the equilibrium state defined, we can now put the complete LBM algorithm into motion. This practice provides a step-by-step walkthrough of the two fundamental operations at the heart of LBM: the local collision step, where populations relax towards equilibrium, and the non-local streaming step, where they propagate to neighboring lattice sites. By tracking a set of populations through this full cycle and verifying the conservation of mass, you will gain a concrete, operational grasp of how the simulation evolves and maintains its physical integrity. ",
            "id": "3774222",
            "problem": "Consider the Lattice Boltzmann Method (LBM) with the Bhatnagar-Gross-Krook (BGK) collision model on the two-dimensional, nine-velocity (D2Q9) stencil. The discrete particle velocities are defined as $\\,\\mathbf{e}_0=(0,0)$, $\\,\\mathbf{e}_1=(1,0)$, $\\,\\mathbf{e}_2=(0,1)$, $\\,\\mathbf{e}_3=(-1,0)$, $\\,\\mathbf{e}_4=(0,-1)$, $\\,\\mathbf{e}_5=(1,1)$, $\\,\\mathbf{e}_6=(-1,1)$, $\\,\\mathbf{e}_7=(-1,-1)$, $\\,\\mathbf{e}_8=(1,-1)$, with lattice speed set to unity. The discrete weights are $\\,w_0=\\frac{4}{9}$, $\\,w_1=w_2=w_3=w_4=\\frac{1}{9}$, and $\\,w_5=w_6=w_7=w_8=\\frac{1}{36}$, and the lattice sound speed satisfies $\\,c_s^2=\\frac{1}{3}$. The BGK relaxation time is $\\,\\tau=\\frac{3}{2}$, and the equilibrium distribution is given by the standard second-order expansion\n$$\nf_i^{\\mathrm{eq}}(\\rho,\\mathbf{u})=w_i\\,\\rho\\left[1+\\frac{\\mathbf{e}_i\\cdot\\mathbf{u}}{c_s^2}+\\frac{(\\mathbf{e}_i\\cdot\\mathbf{u})^2}{2\\,c_s^4}-\\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2\\,c_s^2}\\right].\n$$\nAt time $\\,t$, assume that only the central node at position $\\,\\mathbf{x}=\\mathbf{0}$ has nonzero populations, specified by\n$$\nf_0=\\frac{1}{3},\\quad f_1=f_2=f_3=f_4=\\frac{1}{6},\\quad f_5=f_6=f_7=f_8=\\frac{1}{12},\n$$\nand that all other nodes in the $\\,3\\times 3$ stencil are zero. Using the discrete Boltzmann equation with BGK collision,\n$$\nf_i^{\\star}(\\mathbf{x},t)=f_i(\\mathbf{x},t)-\\frac{1}{\\tau}\\left[f_i(\\mathbf{x},t)-f_i^{\\mathrm{eq}}(\\rho(\\mathbf{x},t),\\mathbf{u}(\\mathbf{x},t))\\right],\n$$\nand the exact streaming step,\n$$\nf_i(\\mathbf{x}+\\mathbf{e}_i,t+\\Delta t)=f_i^{\\star}(\\mathbf{x},t),\n$$\nperform one collision and streaming step starting from the given central node state. Compute the resulting post-streaming distributions that arrive at each neighbor in the $\\,3\\times 3$ stencil.\n\nDefine the scalar conservation defect across the stencil as\n$$\nD=\\sum_{j=1}^{9}\\rho_{\\mathrm{after}}(\\mathbf{x}_j,t+\\Delta t)-\\sum_{j=1}^{9}\\rho_{\\mathrm{before}}(\\mathbf{x}_j,t),\n$$\nwhere the sum runs over the $\\,3\\times 3$ stencil centered at $\\,\\mathbf{0}$, and $\\,\\rho(\\mathbf{x},t)=\\sum_{i=0}^{8} f_i(\\mathbf{x},t)$ is the local density. Compute $\\,D$ explicitly from the above steps. Express the final answer as an exact real number with no rounding and no units.",
            "solution": "The problem is validated as scientifically sound and complete. The goal is to perform one full LBM time step (collision and streaming) and verify the conservation of mass within the computational stencil.\n\n**Step 1: Compute Initial Macroscopic Quantities**\nFirst, we compute the macroscopic density $\\rho$ and velocity $\\mathbf{u}$ at the central node $\\mathbf{x}=\\mathbf{0}$ at time $t$ from the given initial distributions $f_i(\\mathbf{0}, t)$.\nThe density $\\rho$ is the sum of the distributions:\n$$\n\\rho = \\sum_{i=0}^{8} f_i = f_0 + 4 \\times f_{1,2,3,4} + 4 \\times f_{5,6,7,8} = \\frac{1}{3} + 4\\left(\\frac{1}{6}\\right) + 4\\left(\\frac{1}{12}\\right) = \\frac{1}{3} + \\frac{2}{3} + \\frac{1}{3} = \\frac{4}{3}\n$$\nThe momentum $\\rho\\mathbf{u}$ is the first moment of the distributions. Due to the symmetry of the initial populations ($f_1=f_3$, $f_2=f_4$, $f_5=f_6=f_7=f_8$), the momentum is zero:\n$$\n\\rho u_x = \\sum_i f_i e_{ix} = f_1 - f_3 + f_5 - f_6 - f_7 + f_8 = \\frac{1}{6} - \\frac{1}{6} + \\frac{1}{12} - \\frac{1}{12} - \\frac{1}{12} + \\frac{1}{12} = 0\n$$\n$$\n\\rho u_y = \\sum_i f_i e_{iy} = f_2 - f_4 + f_5 + f_6 - f_7 - f_8 = \\frac{1}{6} - \\frac{1}{6} + \\frac{1}{12} + \\frac{1}{12} - \\frac{1}{12} - \\frac{1}{12} = 0\n$$\nThus, the initial state at the central node is $\\rho = 4/3$ and $\\mathbf{u} = \\mathbf{0}$.\n\n**Step 2: Calculate Equilibrium Distributions**\nWith $\\mathbf{u}=\\mathbf{0}$, the equilibrium distribution simplifies to $f_i^{\\mathrm{eq}} = w_i \\rho$:\n$$ f_0^{\\mathrm{eq}} = w_0 \\rho = \\frac{4}{9} \\times \\frac{4}{3} = \\frac{16}{81} $$\n$$ f_{1,2,3,4}^{\\mathrm{eq}} = w_{1} \\rho = \\frac{1}{9} \\times \\frac{4}{3} = \\frac{4}{27} $$\n$$ f_{5,6,7,8}^{\\mathrm{eq}} = w_{5} \\rho = \\frac{1}{36} \\times \\frac{4}{3} = \\frac{4}{108} = \\frac{1}{27} $$\n\n**Step 3: Perform the Collision Step**\nThe BGK collision operator guarantees local conservation of mass and momentum. This means the total mass at the central node after collision, $\\sum_i f_i^{\\star}(\\mathbf{0}, t)$, is identical to the mass before collision, $\\sum_i f_i(\\mathbf{0}, t) = \\rho(\\mathbf{0}, t) = 4/3$. We do not need to calculate the individual $f_i^{\\star}$ values to determine the total mass.\n\n**Step 4: Perform the Streaming Step**\nThe post-collision populations $f_i^{\\star}$ from node $\\mathbf{x}=\\mathbf{0}$ stream to the neighboring nodes $\\mathbf{x}+\\mathbf{e}_i$. So, at time $t+\\Delta t$:\n$$ f_i(\\mathbf{e}_i, t+\\Delta t) = f_i^{\\star}(\\mathbf{0}, t) $$\nAll other population values at all nodes in the stencil are zero.\n\n**Step 5: Compute Total Mass Before and After**\nThe total mass in the $3\\times3$ stencil *before* the step is simply the mass at the central node, as all other nodes have zero populations:\n$$ \\sum_{j=1}^{9} \\rho_{\\mathrm{before}}(\\mathbf{x}_j, t) = \\rho(\\mathbf{0}, t) = \\frac{4}{3} $$\nThe total mass in the $3\\times3$ stencil *after* the step is the sum of the densities at all 9 nodes. The density at each node $\\mathbf{x}_j$ is the sum of populations that have streamed to it.\n$$ \\rho_{\\mathrm{after}}(\\mathbf{0}, t+\\Delta t) = f_0(\\mathbf{0}, t+\\Delta t) = f_0^{\\star}(\\mathbf{0}, t) $$\n$$ \\rho_{\\mathrm{after}}(\\mathbf{e}_k, t+\\Delta t) = f_k(\\mathbf{e}_k, t+\\Delta t) = f_k^{\\star}(\\mathbf{0}, t) \\quad \\text{for } k \\in \\{1,...,8\\} $$\nThe total mass in the stencil after streaming is the sum of all populations that were at the central node after collision:\n$$ \\sum_{j=1}^{9} \\rho_{\\mathrm{after}}(\\mathbf{x}_j, t+\\Delta t) = \\sum_{i=0}^{8} f_i^{\\star}(\\mathbf{0}, t) $$\nBecause the collision operator conserves mass locally, this sum is equal to the pre-collision mass:\n$$ \\sum_{i=0}^{8} f_i^{\\star}(\\mathbf{0}, t) = \\sum_{i=0}^{8} f_i(\\mathbf{0}, t) = \\rho(\\mathbf{0},t) = \\frac{4}{3} $$\n\n**Step 6: Calculate the Conservation Defect**\nThe conservation defect $D$ is the difference between the total mass in the stencil after and before the time step.\n$$ D = \\left(\\sum_{j=1}^{9}\\rho_{\\mathrm{after}}(\\mathbf{x}_j,t+\\Delta t)\\right) - \\left(\\sum_{j=1}^{9}\\rho_{\\mathrm{before}}(\\mathbf{x}_j,t)\\right) = \\frac{4}{3} - \\frac{4}{3} = 0 $$\nThis demonstrates that the total mass is perfectly conserved across the collide-and-stream operation for this closed system, where mass only moves between nodes within the stencil. The defect is exactly zero.",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "The accuracy of LBM simulations depends on a precise consistency between the lattice structure (weights $w_i$) and the prescribed equilibrium function $f_i^{\\mathrm{eq}}$. This advanced exercise challenges you to investigate what happens when this delicate balance is disrupted by using incorrect parameters. By analytically deriving the error in the recovered fluid pressure, you will explore the theoretical underpinnings of the method and understand why the specific values and forms used in LBM are not arbitrary, but are essential for recovering the correct macroscopic physics. ",
            "id": "3774286",
            "problem": "Consider the Lattice Boltzmann Method (LBM) for isothermal, weakly compressible flow on the two-dimensional, nine-velocity lattice (D2Q9). The discrete velocities are grouped as follows: one rest vector with speed squared $0$, four axial vectors with speed squared $1$, and four diagonal vectors with speed squared $2$. Let the corresponding equilibrium weights be $w_0$, $w_a$, and $w_d$ for the rest, axial, and diagonal groups, respectively, with the normalization constraint $w_0 + 4 w_a + 4 w_d = 1$. The equilibrium distribution is constructed from the second-order Hermite expansion,\n$$\nf_i^{eq} = w_i \\,\\rho \\left[ 1 + \\frac{\\boldsymbol{c}_i \\cdot \\boldsymbol{u}}{c_{s,\\mathrm{eq}}^{2}} + \\frac{(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^{2}}{2\\,c_{s,\\mathrm{eq}}^{4}} - \\frac{|\\boldsymbol{u}|^{2}}{2\\,c_{s,\\mathrm{eq}}^{2}} \\right],\n$$\nwhere $\\rho$ is the mass density, $\\boldsymbol{u}$ is the fluid velocity, and $c_{s,\\mathrm{eq}}^{2}$ is the lattice sound speed parameter used inside $f_i^{eq}$. Suppose a practitioner inadvertently uses incorrect choices for $w_a$, $w_d$, and/or $c_{s,\\mathrm{eq}}^{2}$, while the physical target at the Euler scale is $p = \\rho\\,c_{s,\\mathrm{phys}}^{2}$.\n\nWorking in the low-Mach-number regime $|\\boldsymbol{u}| \\ll 1$, and assuming that non-equilibrium contributions after the collision step remain higher order in $|\\boldsymbol{u}|$ so that the pressure can be inferred from the second moment of the equilibrium distributions, define the pressure $p_{\\mathrm{LBM}}$ recovered by LBM via the trace of the second moment,\n$$\np_{\\mathrm{LBM}} \\equiv \\frac{1}{D}\\left(\\sum_{\\alpha=1}^{D}\\sum_{i} f_i^{eq}\\,c_{i\\alpha} c_{i\\alpha} - \\rho\\,|\\boldsymbol{u}|^{2}\\right), \\quad D = 2.\n$$\nDerive, from first principles of moment matching and the above equilibrium construction, a closed-form analytic expression for the error in the pressure term\n$$\n\\Delta p \\equiv p_{\\mathrm{LBM}} - \\rho\\,c_{s,\\mathrm{phys}}^{2}\n$$\nin terms of $\\rho$, $|\\boldsymbol{u}|$, $w_a$, $w_d$, $c_{s,\\mathrm{eq}}^{2}$, and $c_{s,\\mathrm{phys}}^{2}$. Express your final answer as a single analytic expression. No numerical evaluation or rounding is required.",
            "solution": "The problem has been validated and is deemed a well-posed, scientifically grounded exercise in the analysis of the Lattice Boltzmann Method (LBM). We may proceed with the derivation.\n\nThe objective is to find the error in the pressure, $\\Delta p$, defined as:\n$$\n\\Delta p \\equiv p_{\\mathrm{LBM}} - \\rho\\,c_{s,\\mathrm{phys}}^{2}\n$$\nThe pressure recovered by the LBM simulation, $p_{\\mathrm{LBM}}$, is given by the trace of the pressure tensor part of the momentum flux tensor, assuming the system is described by the equilibrium distributions $f_i^{eq}$. For a $D=2$ dimensional system, this is:\n$$\np_{\\mathrm{LBM}} \\equiv \\frac{1}{2}\\left(\\sum_{\\alpha=1}^{2}\\sum_{i} f_i^{eq}\\,c_{i\\alpha} c_{i\\alpha} - \\rho\\,|\\boldsymbol{u}|^{2}\\right)\n$$\nRecognizing that $\\sum_{\\alpha=1}^{2} c_{i\\alpha} c_{i\\alpha} = c_{ix}^2 + c_{iy}^2 = |\\boldsymbol{c}_i|^2$, the expression for $p_{\\mathrm{LBM}}$ simplifies to:\n$$\np_{\\mathrm{LBM}} = \\frac{1}{2}\\left(\\sum_{i} f_i^{eq}\\,|\\boldsymbol{c}_i|^{2} - \\rho\\,|\\boldsymbol{u}|^{2}\\right)\n$$\nOur primary task is to evaluate the sum $\\sum_{i} f_i^{eq}\\,|\\boldsymbol{c}_i|^{2}$. We substitute the provided expression for the equilibrium distribution function, $f_i^{eq}$:\n$$\nf_i^{eq} = w_i \\,\\rho \\left[ 1 + \\frac{\\boldsymbol{c}_i \\cdot \\boldsymbol{u}}{c_{s,\\mathrm{eq}}^{2}} + \\frac{(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^{2}}{2\\,c_{s,\\mathrm{eq}}^{4}} - \\frac{|\\boldsymbol{u}|^{2}}{2\\,c_{s,\\mathrm{eq}}^{2}} \\right]\n$$\nThe sum becomes:\n$$\n\\sum_{i} f_i^{eq}\\,|\\boldsymbol{c}_i|^{2} = \\sum_{i} w_i \\,\\rho \\left[ 1 + \\frac{\\boldsymbol{c}_i \\cdot \\boldsymbol{u}}{c_{s,\\mathrm{eq}}^{2}} + \\frac{(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^{2}}{2\\,c_{s,\\mathrm{eq}}^{4}} - \\frac{|\\boldsymbol{u}|^{2}}{2\\,c_{s,\\mathrm{eq}}^{2}} \\right] |\\boldsymbol{c}_i|^{2}\n$$\nWe can expand this expression and evaluate each term in the sum separately:\n$$\n\\sum_{i} f_i^{eq}\\,|\\boldsymbol{c}_i|^{2} = \\rho \\left[ \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} + \\frac{1}{c_{s,\\mathrm{eq}}^{2}} \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} (\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) + \\frac{1}{2\\,c_{s,\\mathrm{eq}}^{4}} \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} (\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^{2} - \\frac{|\\boldsymbol{u}|^{2}}{2\\,c_{s,\\mathrm{eq}}^{2}} \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} \\right]\n$$\nTo proceed, we must evaluate the lattice sums using the properties of the D2Q9 lattice. The velocities are grouped by their speed squared: $1$ rest vector with $|\\boldsymbol{c}_0|^2=0$, $4$ axial vectors with $|\\boldsymbol{c}_i|^2=1$, and $4$ diagonal vectors with $|\\boldsymbol{c}_i|^2=2$.\n\n1.  The zeroth-order term: $\\sum_{i} w_i |\\boldsymbol{c}_i|^{2}$\n    This sum is over the velocity groups:\n    $$\n    \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} = w_0(0) + 4w_a(1) + 4w_d(2) = 4w_a + 8w_d\n    $$\n\n2.  The first-order term in $\\boldsymbol{u}$: $\\sum_{i} w_i |\\boldsymbol{c}_i|^{2} (\\boldsymbol{c}_i \\cdot \\boldsymbol{u})$\n    We can write this as $\\sum_{\\alpha} u_{\\alpha} \\left( \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} c_{i\\alpha} \\right)$. The term in the parentheses is a third-rank tensor moment. Due to the point symmetry of the D2Q9 lattice (i.e., for every velocity $\\boldsymbol{c}_i$, $-\\boldsymbol{c}_i$ is also on the lattice with the same weight), all odd-order lattice tensors are zero. Thus:\n    $$\n    \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} c_{i\\alpha} = 0 \\implies \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} (\\boldsymbol{c}_i \\cdot \\boldsymbol{u}) = 0\n    $$\n\n3.  The second-order term in $\\boldsymbol{u}$: $\\sum_{i} w_i |\\boldsymbol{c}_i|^{2} (\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^{2}$\n    We expand $(\\boldsymbol{c}_i \\cdot \\boldsymbol{u})^{2} = \\sum_{\\alpha, \\beta} u_\\alpha u_\\beta c_{i\\alpha} c_{i\\beta}$. The sum becomes:\n    $$\n    \\sum_{\\alpha, \\beta} u_\\alpha u_\\beta \\left( \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} c_{i\\alpha} c_{i\\beta} \\right)\n    $$\n    Let's evaluate the fourth-rank tensor $T_{\\alpha\\beta} = \\sum_{i} w_i |\\boldsymbol{c}_i|^{2} c_{i\\alpha} c_{i\\beta}$.\n    For the diagonal components ($\\alpha=\\beta=x$):\n    $$\n    T_{xx} = \\sum_{i} w_i (c_{ix}^2+c_{iy}^2) c_{ix}^2 = 2 w_a (1^2+0^2)(1^2) + 4 w_d (1^2+1^2)(1^2) = 2 w_a + 8 w_d\n    $$\n    By symmetry, $T_{yy} = 2 w_a + 8 w_d$.\n    For the off-diagonal components ($\\alpha=x, \\beta=y$):\n    $$\n    T_{xy} = \\sum_{i} w_i (c_{ix}^2+c_{iy}^2) c_{ix} c_{iy}\n    $$\n    Only the diagonal velocities have both $c_{ix} \\neq 0$ and $c_{iy} \\neq 0$. Their contributions cancel out due to symmetry (e.g., $c_{ix}c_{iy}$ is $1$ for two vectors and $-1$ for the other two).\n    $$\n    T_{xy} = w_d(1^2+1^2)[(1)(1) + (-1)(1) + (1)(-1) + (-1)(-1)] = 2w_d[1-1-1+1] = 0\n    $$\n    So, $T_{\\alpha\\beta} = (2w_a+8w_d)\\delta_{\\alpha\\beta}$. The sum is then:\n    $$\n    \\sum_{\\alpha, \\beta} u_\\alpha u_\\beta (2w_a+8w_d)\\delta_{\\alpha\\beta} = (2w_a+8w_d) \\sum_{\\alpha} u_\\alpha^2 = (2w_a+8w_d)|\\boldsymbol{u}|^2\n    $$\n\nNow, we substitute these lattice sum evaluations back into the expression for $\\sum_{i} f_i^{eq}\\,|\\boldsymbol{c}_i|^{2}$:\n$$\n\\sum_{i} f_i^{eq}\\,|\\boldsymbol{c}_i|^{2} = \\rho \\left[ (4w_a + 8w_d) + 0 + \\frac{(2w_a+8w_d)|\\boldsymbol{u}|^2}{2\\,c_{s,\\mathrm{eq}}^{4}} - \\frac{|\\boldsymbol{u}|^{2}}{2\\,c_{s,\\mathrm{eq}}^{2}} (4w_a + 8w_d) \\right]\n$$\n$$\n\\sum_{i} f_i^{eq}\\,|\\boldsymbol{c}_i|^{2} = \\rho (4w_a + 8w_d) + \\rho |\\boldsymbol{u}|^2 \\left[ \\frac{w_a+4w_d}{c_{s,\\mathrm{eq}}^{4}} - \\frac{2w_a+4w_d}{c_{s,\\mathrm{eq}}^{2}} \\right]\n$$\nWe insert this result into the formula for $p_{\\mathrm{LBM}}$:\n$$\np_{\\mathrm{LBM}} = \\frac{1}{2}\\left( \\left( \\rho (4w_a + 8w_d) + \\rho |\\boldsymbol{u}|^2 \\left[ \\frac{w_a+4w_d}{c_{s,\\mathrm{eq}}^{4}} - \\frac{2w_a+4w_d}{c_{s,\\mathrm{eq}}^{2}} \\right] \\right) - \\rho\\,|\\boldsymbol{u}|^{2}\\right)\n$$\nDistributing the $\\frac{1}{2}$ and grouping terms with $\\rho$ and $\\rho|\\boldsymbol{u}|^2$:\n$$\np_{\\mathrm{LBM}} = \\rho(2w_a + 4w_d) + \\frac{1}{2}\\rho|\\boldsymbol{u}|^2 \\left[ \\frac{w_a+4w_d}{c_{s,\\mathrm{eq}}^{4}} - \\frac{2w_a+4w_d}{c_{s,\\mathrm{eq}}^{2}} - 1 \\right]\n$$\nFinally, we compute the pressure error $\\Delta p = p_{\\mathrm{LBM}} - \\rho\\,c_{s,\\mathrm{phys}}^{2}$:\n$$\n\\Delta p = \\left( \\rho(2w_a + 4w_d) + \\frac{1}{2}\\rho|\\boldsymbol{u}|^2 \\left[ \\frac{w_a+4w_d}{c_{s,\\mathrm{eq}}^{4}} - \\frac{2w_a+4w_d}{c_{s,\\mathrm{eq}}^{2}} - 1 \\right] \\right) - \\rho c_{s,\\mathrm{phys}}^{2}\n$$\nCombining the terms independent of velocity, we arrive at the final expression for the pressure error:\n$$\n\\Delta p = \\rho \\left( 2w_a + 4w_d - c_{s,\\mathrm{phys}}^{2} \\right) + \\frac{1}{2} \\rho |\\boldsymbol{u}|^{2} \\left[ \\frac{w_a + 4w_d}{c_{s,\\mathrm{eq}}^{4}} - \\frac{2w_a + 4w_d}{c_{s,\\mathrm{eq}}^{2}} - 1 \\right]\n$$\nThis expression shows two sources of error. The first term is a static pressure error, representing the mismatch between the lattice's inherent speed of sound (determined by weights $w_a, w_d$) and the target physical sound speed $c_{s,\\mathrm{phys}}^{2}$. The second term is a dynamic error, proportional to $|\\boldsymbol{u}|^2$, which arises from an inconsistent formulation of the second-order velocity terms in the equilibrium distribution function. For the error to be zero for any $\\rho$ and $\\boldsymbol{u}$, both terms must vanish independently.",
            "answer": "$$\\boxed{\\rho \\left( 2 w_a + 4 w_d - c_{s,\\mathrm{phys}}^{2} \\right) + \\frac{1}{2} \\rho |\\boldsymbol{u}|^{2} \\left[ \\frac{w_a + 4 w_d}{c_{s,\\mathrm{eq}}^{4}} - \\frac{2 w_a + 4 w_d}{c_{s,\\mathrm{eq}}^{2}} - 1 \\right]}$$"
        }
    ]
}