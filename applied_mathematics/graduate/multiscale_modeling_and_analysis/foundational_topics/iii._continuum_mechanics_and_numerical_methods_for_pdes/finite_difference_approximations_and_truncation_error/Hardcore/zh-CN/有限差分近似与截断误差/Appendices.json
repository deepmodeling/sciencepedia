{
    "hands_on_practices": [
        {
            "introduction": "理解数值方法的准确性始于分析其截断误差。本练习将引导你通过泰勒级数展开，从第一性原理出发，推导一个标准中心差分格式的截断误差。这个基础练习不仅揭示了误差如何依赖于网格间距，还阐明了对称性在构造高精度格式中的关键作用。",
            "id": "3758767",
            "problem": "考虑一个一维均质化宏观场 $u(x)$，它源于一个多尺度椭圆模型，其中微尺度变化已被平均化处理。设 $u$ 在一个区间上是 $C^{6}$ 光滑的，并在间距为 $h0$ 的均匀网格上进行采样。将二阶导数的三点中心有限差分近似定义为\n$$D_{h}^{2}u(x) \\equiv \\frac{u(x+h)-2u(x)+u(x-h)}{h^{2}}.$$\n仅从截断误差的定义（即离散算子作用于精确函数与相应连续算子作用于同一函数之差）和光滑函数在某点周围的泰勒展开出发，推导该模板在点 $x$ 处的局部截断误差，直到包含 $h^{4}$ 阶的项。在您的推导过程中，解释为何奇数阶导数没有出现在中心格式的最终表达式中，并结合多尺度建模与分析中的对称性和尺度分离来解释这种抵消现象。\n\n请将您的最终答案表示为点 $x$ 处截断误差的单个闭式解析表达式，该表达式保留 $h$ 的所有项，直到并包括 $h^{4}$ 阶。不需要进行数值舍入。",
            "solution": "所述问题具有科学依据，是适定且客观的。它提出了一个数值分析领域的标准、可验证的问题，并将其与多尺度建模领域紧密联系起来。所有必要信息均已提供，问题没有矛盾或含糊之处。因此，该问题是有效的，可以推导出解。\n\n局部截断误差（记为 $\\tau(x)$）定义为作用于精确光滑函数 $u(x)$ 的离散有限差分算子与其旨在近似的连续微分算子之间的差。对于给定的近似二阶导数 $u''(x) \\equiv \\frac{d^2u}{dx^2}$ 的三点中心差分算子 $D_{h}^{2}u(x)$，其截断误差为：\n$$ \\tau(x) = D_{h}^{2}u(x) - u''(x) $$\n代入算子的定义，我们得到：\n$$ \\tau(x) = \\frac{u(x+h) - 2u(x) + u(x-h)}{h^{2}} - u''(x) $$\n为了分析此表达式，我们使用泰勒定理将 $u(x+h)$ 和 $u(x-h)$ 两项在点 $x$ 附近展开。问题指明函数 $u$ 是 $C^{6}$ 光滑的，这允许我们进行泰勒展开，并保留足够的项来确定高达 $h^{4}$ 阶的误差。展开式如下：\n$$ u(x+h) = u(x) + u'(x)h + \\frac{u''(x)}{2!}h^{2} + \\frac{u'''(x)}{3!}h^{3} + \\frac{u^{(4)}(x)}{4!}h^{4} + \\frac{u^{(5)}(x)}{5!}h^{5} + \\frac{u^{(6)}(x)}{6!}h^{6} + O(h^{7}) $$\n$$ u(x-h) = u(x) - u'(x)h + \\frac{u''(x)}{2!}h^{2} - \\frac{u'''(x)}{3!}h^{3} + \\frac{u^{(4)}(x)}{4!}h^{4} - \\frac{u^{(5)}(x)}{5!}h^{5} + \\frac{u^{(6)}(x)}{6!}h^{6} + O(h^{7}) $$\n这里，$u^{(n)}(x)$ 表示 $u$ 在 $x$ 处的 $n$ 阶导数。\n\n我们将这些展开式代入 $D_{h}^{2}u(x)$ 表达式的分子中：\n$$ u(x+h) - 2u(x) + u(x-h) = \\left( \\sum_{k=0}^{6} \\frac{u^{(k)}(x)}{k!}h^{k} \\right) - 2u(x) + \\left( \\sum_{k=0}^{6} \\frac{u^{(k)}(x)}{k!}(-h)^{k} \\right) + O(h^{7}) $$\n合并两个级数的项，我们观察到一个抵消模式。对于奇数索引 $k$ 的项，我们有 $h^{k} + (-h)^{k} = h^{k} - h^{k} = 0$。对于偶数索引 $k$ 的项，我们有 $h^{k} + (-h)^{k} = h^{k} + h^{k} = 2h^{k}$。让我们明确地写出和式：\n$$ u(x+h) + u(x-h) = 2u(x) + 2\\frac{u''(x)}{2!}h^{2} + 2\\frac{u^{(4)}(x)}{4!}h^{4} + 2\\frac{u^{(6)}(x)}{6!}h^{6} + O(h^{8}) $$\n减去 $2u(x)$ 项得到完整的分子：\n$$ u(x+h) - 2u(x) + u(x-h) = 2\\frac{u''(x)}{2!}h^{2} + 2\\frac{u^{(4)}(x)}{4!}h^{4} + 2\\frac{u^{(6)}(x)}{6!}h^{6} + O(h^{8}) $$\n代入阶乘值（$2! = 2$，$4! = 24$，$6! = 720$）：\n$$ u(x+h) - 2u(x) + u(x-h) = u''(x)h^{2} + \\frac{2}{24}u^{(4)}(x)h^{4} + \\frac{2}{720}u^{(6)}(x)h^{6} + O(h^{8}) $$\n$$ u(x+h) - 2u(x) + u(x-h) = u''(x)h^{2} + \\frac{1}{12}u^{(4)}(x)h^{4} + \\frac{1}{360}u^{(6)}(x)h^{6} + O(h^{8}) $$\n现在，通过除以 $h^{2}$，我们可以写出 $D_{h}^{2}u(x)$ 的完整表达式：\n$$ D_{h}^{2}u(x) = \\frac{1}{h^{2}} \\left( u''(x)h^{2} + \\frac{1}{12}u^{(4)}(x)h^{4} + \\frac{1}{360}u^{(6)}(x)h^{6} + O(h^{8}) \\right) $$\n$$ D_{h}^{2}u(x) = u''(x) + \\frac{1}{12}u^{(4)}(x)h^{2} + \\frac{1}{360}u^{(6)}(x)h^{4} + O(h^{6}) $$\n最后，我们通过减去 $u''(x)$ 来计算截断误差 $\\tau(x)$：\n$$ \\tau(x) = D_{h}^{2}u(x) - u''(x) = \\left( u''(x) + \\frac{1}{12}u^{(4)}(x)h^{2} + \\frac{1}{360}u^{(6)}(x)h^{4} + O(h^{6}) \\right) - u''(x) $$\n问题要求表达式保留到 $h^{4}$ 阶的项。因此，我们在 $h^4$ 项后截断级数：\n$$ \\tau(x) = \\frac{1}{12}u^{(4)}(x)h^{2} + \\frac{1}{360}u^{(6)}(x)h^{4} $$\n通常习惯上将此式写成按 $h$ 的幂次分组的形式：\n$$ \\tau(x) = \\frac{h^{2}}{12}u^{(4)}(x) + \\frac{h^{4}}{360}u^{(6)}(x) $$\n\n奇数阶导数没有出现在最终表达式中的原因是中心差分模板的对称性。$D_h^2u(x)$ 的模板系数与以 $x$ 为中心的 $(1, -2, 1)$ 成比例。求值点是 $x-h$ 和 $x+h$，它们相对于 $x$ 是对称的。当 $u(x+h)$ 和 $u(x-h)$ 的泰勒级数在表达式 $u(x+h) + u(x-h)$ 中合并时，包含 $h$ 的奇数次幂的项（例如 $u'(x)h$ 和 $u'''(x)h^3/6$）符号相反，完全抵消。这些项对应于 $u(x)$ 的奇数阶导数。这种抵消发生在所有奇数阶项上，从而导致误差级数仅包含 $h$ 的偶数次幂。\n\n在多尺度建模与分析的背景下，这种对称性是一个至关重要的特性。均质化或升尺度的过程通过平均化微尺度细节来生成宏观模型。通常一个基本要求是，此过程必须保留底层微观系统的基本物理对称性。例如，如果微观物理在空间反射（宇称）下是不变的，那么得到的宏观连续模型及其数值离散化也应尊重这种对称性。非对称模板，如前向差分 $\\frac{u(x+h)-u(x)}{h}$，会引入人为的方向性，破坏反射对称性。这种被破坏的对称性将表现为一个涉及奇数阶导数的主阶误差项（例如，对于 $u'(x)$ 的前向差分近似，该项与 $u''(x)h$ 成比例），它在变换 $h \\to -h$ 下不是不变的。使用对称的中心差分格式可确保数值方法不会向模型中引入伪不对称性。这保留了尺度分离的完整性，确保计算出的宏观行为是升尺度物理的真实结果，而不是有偏的数值离散化所造成的人为产物。这一原则对于多尺度模拟的保真度至关重要。",
            "answer": "$$\\boxed{\\frac{h^{2}}{12}u^{(4)}(x) + \\frac{h^{4}}{360}u^{(6)}(x)}$$"
        },
        {
            "introduction": "在我们了解了截断误差的渐近形式之后，一个自然的问题是：我们能否利用这一知识来提高计算结果的精度？理查森外推法 (Richardson extrapolation) 为此提供了一个优雅的答案。通过本练习，你将学习如何通过对不同网格分辨率下的结果进行简单的线性组合，系统性地消除主导误差项，从而以极小的计算代价获得更高阶的精度。",
            "id": "3758782",
            "problem": "考虑一个标量$Q$，其源于一个多尺度偏微分方程(PDE)模型。对该模型，我们在间距为$h$的均匀网格上使用空间有限差分近似。假设离散化是二阶相容的，这意味着对于足够光滑的精确解和足够小的$h$，离散近似$Q_{h}$存在以下形式的渐近截断误差展开式\n$$\nQ_{h} \\;=\\; Q \\;+\\; c_{2} h^{2} \\;+\\; c_{3} h^{3} \\;+\\; c_{4} h^{4} \\;+\\; \\cdots,\n$$\n其中系数$c_{k}$可能依赖于模型参数（包括一个可能的尺度分离参数），但在$h \\to 0$时一致有界。类似地，在加密网格$h/2$上的计算得到\n$$\nQ_{h/2} \\;=\\; Q \\;+\\; c_{2} \\left(\\frac{h}{2}\\right)^{2} \\;+\\; c_{3} \\left(\\frac{h}{2}\\right)^{3} \\;+\\; c_{4} \\left(\\frac{h}{2}\\right)^{4} \\;+\\; \\cdots.\n$$\n仅使用相容性的定义和截断误差的光滑渐近结构，构造一个满足$\\alpha + \\beta = 1$的仿射组合$\\widehat{Q} \\;=\\; \\alpha\\, Q_{h/2} \\;+\\; \\beta\\, Q_{h}$，用以消除主导截断误差项。通过强制消除$h^{2}$项的贡献来推导系数$\\alpha$和$\\beta$，然后在不假定级数具有任何奇偶性的情况下，确定剩余主导截断误差的阶，以及在截断误差仅包含$h$的偶次幂的特殊情况下确定该阶。您的最终答案必须是仅用$Q_{h/2}$和$Q_{h}$表示的$\\widehat{Q}$的单个闭式解析表达式。无需四舍五入，不涉及单位。",
            "solution": "该问题要求从一个二阶有限差分格式得到的两个现有近似值$Q_h$和$Q_{h/2}$出发，构造一个改进的近似值$\\widehat{Q}$。改进的近似值是一个形如$\\widehat{Q} = \\alpha Q_{h/2} + \\beta Q_{h}$且满足约束$\\alpha + \\beta = 1$的仿射组合。目标是选择$\\alpha$和$\\beta$以消除截断误差的主导阶项。\n\n在间距为$h$和$h/2$的网格上，离散近似的渐近误差展开式如下：\n$$\nQ_{h} = Q + c_{2} h^{2} + c_{3} h^{3} + c_{4} h^{4} + \\mathcal{O}(h^{5})\n$$\n$$\nQ_{h/2} = Q + c_{2} \\left(\\frac{h}{2}\\right)^{2} + c_{3} \\left(\\frac{h}{2}\\right)^{3} + c_{4} \\left(\\frac{h}{2}\\right)^{4} + \\mathcal{O}(h^{5})\n$$\n其中$Q$是精确值，系数$c_k$与$h$无关。简化$Q_{h/2}$展开式中的幂次，得到：\n$$\nQ_{h/2} = Q + \\frac{c_{2}}{4} h^{2} + \\frac{c_{3}}{8} h^{3} + \\frac{c_{4}}{16} h^{4} + \\mathcal{O}(h^{5})\n$$\n我们将这些展开式代入，构成仿射组合$\\widehat{Q}$：\n$$\n\\widehat{Q} = \\alpha \\left( Q + \\frac{c_{2}}{4} h^{2} + \\frac{c_{3}}{8} h^{3} + \\frac{c_{4}}{16} h^{4} + \\cdots \\right) + \\beta \\left( Q + c_{2} h^{2} + c_{3} h^{3} + c_{4} h^{4} + \\cdots \\right)\n$$\n按$h$的幂次合并同类项，我们得到：\n$$\n\\widehat{Q} = (\\alpha + \\beta)Q + c_{2}\\left(\\frac{\\alpha}{4} + \\beta\\right)h^{2} + c_{3}\\left(\\frac{\\alpha}{8} + \\beta\\right)h^{3} + c_{4}\\left(\\frac{\\alpha}{16} + \\beta\\right)h^{4} + \\cdots\n$$\n为了确定系数$\\alpha$和$\\beta$，我们施加两个条件。\n首先，为了使$\\widehat{Q}$是$Q$的一个相容近似，其展开式中$Q$的系数必须为1。这得到条件：\n$$\n\\alpha + \\beta = 1\n$$\n这个问题陈述中已将此条件作为仿射组合的一个性质给出。\n\n第二，为了消除$h^2$阶的主导截断误差项，我们必须将$h^2$项的系数设为零：\n$$\n\\frac{\\alpha}{4} + \\beta = 0\n$$\n现在我们得到一个关于$\\alpha$和$\\beta$的二元线性方程组：\n1. $\\alpha + \\beta = 1$\n2. $\\frac{\\alpha}{4} + \\beta = 0$\n\n从方程(2)中，我们将$\\beta$用$\\alpha$表示：$\\beta = -\\frac{\\alpha}{4}$。\n将此代入方程(1)：\n$$\n\\alpha + \\left(-\\frac{\\alpha}{4}\\right) = 1 \\implies \\frac{3\\alpha}{4} = 1 \\implies \\alpha = \\frac{4}{3}\n$$\n现在，我们求$\\beta$：\n$$\n\\beta = -\\frac{\\alpha}{4} = -\\frac{1}{4}\\left(\\frac{4}{3}\\right) = -\\frac{1}{3}\n$$\n因此，系数为$\\alpha = \\frac{4}{3}$和$\\beta = -\\frac{1}{3}$。得到的改进近似值是$Q_h$和$Q_{h/2}$的Richardson外推，其表达式为：\n$$\n\\widehat{Q} = \\frac{4}{3} Q_{h/2} - \\frac{1}{3} Q_{h}\n$$\n接下来，我们分析这个新近似的截断误差，即$\\widehat{Q} - Q$：\n$$\n\\widehat{Q} - Q = c_{3}\\left(\\frac{\\alpha}{8} + \\beta\\right)h^{3} + c_{4}\\left(\\frac{\\alpha}{16} + \\beta\\right)h^{4} + \\cdots\n$$\n我们来计算$h^3$项的系数：\n$$\n\\text{Coeff}(h^{3}) = c_{3}\\left(\\frac{1}{8}\\left(\\frac{4}{3}\\right) - \\frac{1}{3}\\right) = c_{3}\\left(\\frac{1}{6} - \\frac{1}{3}\\right) = c_{3}\\left(\\frac{1}{6} - \\frac{2}{6}\\right) = -\\frac{c_{3}}{6}\n$$\n在一般情况下，即不假设误差展开有特定结构（即$c_3$不一定为零），$\\widehat{Q}$的截断误差主导项是$-\\frac{c_{3}}{6}h^3$。因此，近似$\\widehat{Q}$的阶为3。\n\n现在考虑一种特殊情况，即原始格式的截断误差只包含$h$的偶次幂。这在基于中心差分的数值格式中很常见。在这种情况下，所有奇数下标的系数$c_k$都为零，即$c_3 = c_5 = c_7 = \\cdots = 0$。\n$\\widehat{Q}$的误差展开式变为：\n$$\n\\widehat{Q} - Q = c_{4}\\left(\\frac{\\alpha}{16} + \\beta\\right)h^{4} + c_{6}\\left(\\frac{\\alpha}{64} + \\beta\\right)h^{6} + \\cdots\n$$\n主导误差项现在是$h^4$项。我们计算其系数：\n$$\n\\text{Coeff}(h^{4}) = c_{4}\\left(\\frac{1}{16}\\left(\\frac{4}{3}\\right) - \\frac{1}{3}\\right) = c_{4}\\left(\\frac{1}{12} - \\frac{1}{3}\\right) = c_{4}\\left(\\frac{1}{12} - \\frac{4}{12}\\right) = -\\frac{3c_{4}}{12} = -\\frac{c_{4}}{4}\n$$\n在这种特殊情况下，$\\widehat{Q}$的截断误差主导项为$-\\frac{c_{4}}{4}h^4$。因此，近似$\\widehat{Q}$的阶为4。\n\n问题要求给出仅用$Q_{h/2}$和$Q_h$表示的$\\widehat{Q}$的单个闭式解析表达式。根据我们推导出的系数，该表达式为：\n$$\n\\widehat{Q} = \\frac{4}{3}Q_{h/2} - \\frac{1}{3}Q_{h}\n$$",
            "answer": "$$\n\\boxed{\\frac{4}{3} Q_{h/2} - \\frac{1}{3} Q_{h}}\n$$"
        },
        {
            "introduction": "理论分析的最终目的是为了预测和解释在实际计算中观察到的现象。本练习将理论与实践相结合，要求你使用修正方程法来分析一个对流问题的数值格式。你不仅需要推导出该格式引入的非物理效应（如数值耗散），并据此预测全局误差，还需要编写代码进行数值模拟，以验证你的理论预测是否与计算结果相符。",
            "id": "3758731",
            "problem": "考虑一个在周期性域上由偏微分方程 $u_t + a\\,u_x = 0$ 控制的光滑多尺度信号的线性平流问题，其中 $x \\in [0,2\\pi]$，带有周期性边界条件，而 $a$ 是一个常数速度。设初始条件为 $u(x,0) = A_1 \\sin(k_1 x) + A_2 \\sin(k_2 x)$，其中 $A_1 = 0.8$，$A_2 = 0.4$，$k_1 = 7$，$k_2 = 19$，$a = 1$。角度必须以弧度为单位进行解释。精确解为 $u(x,t) = A_1 \\sin(k_1 (x - a t)) + A_2 \\sin(k_2 (x - a t))$。考虑在一个包含 $N$ 个点的均匀网格上的显式迎风有限差分近似，网格间距为 $h = 2\\pi/N$，时间步长 $k$ 的选择应维持库朗数 $C = a k / h$。该数值格式通过 $u_j^{n+1} = u_j^n - C\\,(u_j^n - u_{j-1}^n)$ 来更新解，其中周期性索引 $j-1$ 以模 $N$ 的方式解释。\n\n目标是使用修正方程法来论证预渐近误差行为。从离散更新的泰勒展开和截断误差的定义出发，推导出迎风格式所求解的主阶修正方程，识别出主修正项及其对 $h$、$C$ 和 $u$ 的导数的依赖关系，然后用此来预测给定多尺度初始条件的全局误差的主要贡献。具体来说，该预测必须量化主误差对振幅 $A_1$、$A_2$、波数 $k_1$、$k_2$、库朗数 $C$ 以及格式推进到的最终时间的依赖性。\n\n然后，您必须通过计算最终时刻数值解与精确解之间误差的离散 $L^2$ 范数，来对该预测进行经验性验证。均匀网格上的离散 $L^2$ 范数定义为 $\\|e\\|_2 = \\sqrt{h \\sum_{j=0}^{N-1} (u_j^{\\text{num}} - u(x_j,t))^2}$，其中 $x_j = j h$。使用一个固定的目标时间 $t_{\\mathrm{end}} = 0.7$，并应用整数步数 $n = \\left\\lfloor \\frac{t_{\\mathrm{end}}}{k} + 0.5 \\right\\rfloor$，使得实际推进的最终时间为 $t_{\\mathrm{final}} = n k$。计算在 $t_{\\mathrm{final}}$ 处的精确解，以便与数值解进行比较。\n\n设计一个程序，为每个测试用例执行以下操作：\n- 根据给定参数模拟迎风格式，直到 $t_{\\mathrm{final}}$。\n- 计算离散 $L^2$ 误差 $\\|e\\|_2$。\n- 根据 $t_{\\mathrm{final}}$ 处的修正方程分析，计算误差的主阶预测值。\n- 当主阶预测值 $E_{\\mathrm{pred}}$ 非零时，报告比率 $\\rho = \\|e\\|_2 / E_{\\mathrm{pred}}$；否则，当主阶预测值为零时，报告绝对误差 $\\|e\\|_2$。\n\n测试套件如下：\n1. $N = 192$，$C = 0.25$。\n2. $N = 384$，$C = 0.85$。\n3. $N = 384$，$C = 1.0$。\n\n为确保科学上的真实性，请确保模拟使用所述的格式和周期性边界条件，并且角度以弧度为单位。最终程序必须生成单行输出，包含一个由方括号括起来的逗号分隔列表的结果（例如，$[r_1,r_2,r_3]$），其中 $r_1$ 和 $r_2$ 是测试用例 1 和 2 的比率 $\\rho$，$r_3$ 是测试用例 3 的绝对误差 $\\|e\\|_2$。所有输出都必须表示为不带物理单位的浮点数。\n\n您的推导必须从截断误差和格式的泰勒展开的基本定义出发，并推导出修正方程以及傅里叶模组合的主阶误差。不应假设任何快捷公式或中间结果；逻辑必须从第一性原理推导得出。程序必须通过在所提供的测试用例中将主误差项与经验收敛行为相匹配，来对预测进行数值验证。",
            "solution": "用户提供的问题是有效的，因为它具有科学依据、是适定的、客观的且自洽的。它提出了一个偏微分方程数值分析中的标准练习，具体聚焦于将修正方程法应用于线性平流方程的一阶迎风格式。所有参数和条件都已明确定义，任务是推导理论误差预测并进行数值验证。\n\n### 修正方程与误差预测的推导\n\n问题涉及周期性域 $x \\in [0, 2\\pi]$ 上的线性平流方程 $u_t + a\\,u_x = 0$。对于正值的平流速度 $a  0$，一阶显式迎风格式由下式给出\n$$ u_j^{n+1} = u_j^n - C(u_j^n - u_{j-1}^n) $$\n其中 $u_j^n \\approx u(x_j, t_n)$，$x_j=jh$，$t_n=nk$，$h=2\\pi/N$ 是网格间距，$k$ 是时间步长，$C = ak/h$ 是库朗数。\n\n为了推导修正方程，我们对格式中的每一项在点 $(x_j, t_n)$ 附近进行泰勒级数展开。令 $u = u(x_j, t_n)$。\n左侧项为：\n$$ u_j^{n+1} = u(x_j, t_n+k) = u + k u_t + \\frac{k^2}{2} u_{tt} + \\frac{k^3}{6} u_{ttt} + \\mathcal{O}(k^4) $$\n右侧的项为：\n$$ u_j^n = u $$\n$$ u_{j-1}^n = u(x_j-h, t_n) = u - h u_x + \\frac{h^2}{2} u_{xx} - \\frac{h^3}{6} u_{xxx} + \\mathcal{O}(h^4) $$\n将这些展开式代入有限差分格式中：\n$$ u + k u_t + \\frac{k^2}{2} u_{tt} + \\ldots = u - C \\left( u - \\left(u - h u_x + \\frac{h^2}{2} u_{xx} - \\frac{h^3}{6} u_{xxx} + \\ldots \\right) \\right) $$\n$$ k u_t + \\frac{k^2}{2} u_{tt} + \\ldots = - C \\left( h u_x - \\frac{h^2}{2} u_{xx} + \\frac{h^3}{6} u_{xxx} - \\ldots \\right) $$\n使用库朗数的定义，$C=ak/h \\implies Ch=ak$：\n$$ k u_t + \\frac{k^2}{2} u_{tt} + \\ldots = -ak u_x + \\frac{akh}{2} u_{xx} - \\frac{akh^2}{6} u_{xxx} + \\ldots $$\n两边同除以时间步长 $k$：\n$$ u_t + \\frac{k}{2} u_{tt} + \\ldots = -a u_x + \\frac{ah}{2} u_{xx} - \\frac{ah^2}{6} u_{xxx} + \\ldots $$\n重新整理以匹配原始偏微分方程的形式，我们得到截断误差的表达式：\n$$ u_t + a u_x = \\frac{ah}{2} u_{xx} - \\frac{k}{2} u_{tt} - \\frac{ah^2}{6} u_{xxx} + \\mathcal{O}(k^2, h^3, kh, \\ldots) $$\n这个方程揭示了数值格式实际上求解的是哪个偏微分方程。为了进一步简化它，我们用空间导数来表示时间导数。从原始偏微分方程得到的最低阶近似是 $u_t = -a u_x$。对此求导得到 $u_{tt} = -a u_{xt} = -a (u_t)_x = -a (-a u_x)_x = a^2 u_{xx}$。将此代入上述方程：\n$$ u_t + a u_x = \\frac{ah}{2} u_{xx} - \\frac{k}{2}(a^2 u_{xx}) + \\mathcal{O}(h^2, k^2) $$\n$$ u_t + a u_x = \\left(\\frac{ah}{2} - \\frac{ka^2}{2}\\right) u_{xx} + \\mathcal{O}(h^2, k^2) $$\n提出公因子 $\\frac{ah}{2}$ 并使用 $C=ak/h$：\n$$ u_t + a u_x = \\frac{ah}{2} \\left(1 - \\frac{ka}{h}\\right) u_{xx} + \\mathcal{O}(h^2, k^2) = \\frac{ah}{2}(1-C) u_{xx} + \\mathcal{O}(h^2) $$\n这是主阶修正方程。项 $\\frac{ah}{2}(1-C) u_{xx}$ 是一个数值扩散（或耗散）项。它是主修正项，表明该格式是一阶精度的。\n\n全局误差 $e(x,t) = u^{\\text{num}}(x,t) - u(x,t)$ 近似满足通过从修正方程中减去原始偏微分方程得到的误差方程：\n$$ e_t + a e_x \\approx \\frac{ah}{2}(1-C) u_{xx} $$\n其中 $u$ 是原始偏微分方程的精确解。对于这个关于误差的非齐次平流方程（初始误差为零，$e(x,0)=0$），其解可以通过沿特征线 $x-at=\\text{const}$ 对源项进行积分来找到。在最终时间 $t_{\\mathrm{final}}$，误差近似为：\n$$ e(x, t_{\\mathrm{final}}) \\approx t_{\\mathrm{final}} \\left[ \\frac{ah}{2}(1-C) u_{xx}(x, t_{\\mathrm{final}}) \\right] $$\n这是因为对于精确解 $u(x,t) = f(x-at)$，其二阶导数 $u_{xx}(x,t) = f''(x-at)$ 也是 $x-at$ 的函数，因此沿特征线是常数。\n\n给定的初始条件是 $u(x,0) = A_1 \\sin(k_1 x) + A_2 \\sin(k_2 x)$。精确解是 $u(x,t) = A_1 \\sin(k_1(x-at)) + A_2 \\sin(k_2(x-at))$。\n它的二阶空间导数是：\n$$ u_{xx}(x,t) = -k_1^2 A_1 \\sin(k_1(x-at)) - k_2^2 A_2 \\sin(k_2(x-at)) $$\n将此代入误差表达式中：\n$$ e(x, t_{\\mathrm{final}}) \\approx -t_{\\mathrm{final}} \\frac{ah}{2}(1-C) \\left[ k_1^2 A_1 \\sin(k_1(x-at_{\\mathrm{final}})) + k_2^2 A_2 \\sin(k_2(x-at_{\\mathrm{final}})) \\right] $$\n为了找到预测的误差 $L^2$ 范数 $E_{\\mathrm{pred}}$，我们使用离散范数的定义，对于大的 $N$，它近似于连续积分范数 $\\sqrt{\\int_0^{2\\pi} e(x,t)^2 dx}$。\n$$ E_{\\mathrm{pred}}^2 = \\|e(x, t_{\\mathrm{final}})\\|_2^2 = h \\sum_{j=0}^{N-1} e(x_j, t_{\\mathrm{final}})^2 $$\n$$ E_{\\mathrm{pred}}^2 \\approx h \\sum_{j=0}^{N-1} \\left[ -t_{\\mathrm{final}} \\frac{ah}{2}(1-C) \\right]^2 \\left[ k_1^2 A_1 \\sin(\\theta_{1j}) + k_2^2 A_2 \\sin(\\theta_{2j}) \\right]^2 $$\n其中 $\\theta_{ij} = k_i(x_j-at_{\\mathrm{final}})$。根据离散网格上正弦函数的正交性（对于波数 $k_1=7, k_2=19$ 没有发生混叠），交叉项 $\\sin(\\theta_{1j})\\sin(\\theta_{2j})$ 的和可以忽略不计。我们使用离散求和恒等式 $\\sum_{j=0}^{N-1} \\sin^2(k x_j + \\phi) = N/2$，其中整数 $k$ 不是 $N/2$ 的倍数。\n$$ \\sum_{j=0}^{N-1} e(x_j, t_{\\mathrm{final}})^2 \\approx \\left[ t_{\\mathrm{final}} \\frac{ah}{2}(1-C) \\right]^2 \\left( (k_1^2 A_1)^2 \\frac{N}{2} + (k_2^2 A_2)^2 \\frac{N}{2} \\right) $$\n乘以 $h=2\\pi/N$，我们得到 $h \\cdot (N/2) = \\pi$。\n$$ E_{\\mathrm{pred}}^2 \\approx \\left[ t_{\\mathrm{final}} \\frac{ah}{2}(1-C) \\right]^2 \\pi \\left[ (k_1^2 A_1)^2 + (k_2^2 A_2)^2 \\right] $$\n取平方根，得到 $L^2$ 误差范数的最终预测值：\n$$ E_{\\mathrm{pred}} = \\left| t_{\\mathrm{final}} \\frac{ah}{2}(1-C) \\right| \\sqrt{\\pi \\left[ (k_1^2 A_1)^2 + (k_2^2 A_2)^2 \\right]} $$\n该预测依赖于最终时间 $t_{\\mathrm{final}}$、网格间距 $h$、库朗数 $C$ 以及初始条件的属性（$A_1, A_2, k_1, k_2$）。\n\n对于 $C=1$ 的特殊情况，迎风格式变为 $u_j^{n+1}=u_{j-1}^n$。这是一个精确的平移算子。经过 $n$ 步后，数值解为 $u_j^n = u_{j-n}^0 = u(x_j-nh, 0)$。在时间 $t=nk$ 处的精确解是 $u(x_j, nk) = u(x_j-ank, 0)$。由于 $C=ak/h=1$，因此 $ak=h$，所以 $ank = nh$。数值平移 $nh$ 与物理平流距离 $at$ 完全匹配。因此，数值解在网格点上是精确的，误差 $\\|e\\|_2$ 应该在浮点精度范围内为零。我们对 $E_{\\mathrm{pred}}$ 的公式也反映了这一点，因为项 $(1-C)$ 变为零。\n\n下面的程序将实现该模拟，并将测量的误差 $\\|e\\|_2$ 与预测的误差 $E_{\\mathrm{pred}}$ 进行比较。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the linear advection problem using an upwind scheme,\n    and validates the leading-order error prediction from the\n    method of modified equations.\n    \"\"\"\n\n    # Define problem parameters from the statement\n    A1 = 0.8\n    A2 = 0.4\n    k1 = 7.0\n    k2 = 19.0\n    a = 1.0\n    t_end = 0.7\n    domain_L = 2 * np.pi\n\n    # Define the test cases\n    test_cases = [\n        (192, 0.25),  # (N, C) for case 1\n        (384, 0.85),  # (N, C) for case 2\n        (384, 1.0),   # (N, C) for case 3\n    ]\n\n    results = []\n\n    # Pre-compute the amplitude/wavenumber term for the error prediction\n    # E_pred = | t_final * a * h / 2 * (1-C) | * pred_mag\n    # pred_mag = sqrt(pi * [ (k1^2 * A1)^2 + (k2^2 * A2)^2 ])\n    pred_mag_sq_term = (k1**2 * A1)**2 + (k2**2 * A2)**2\n    pred_mag = np.sqrt(np.pi * pred_mag_sq_term)\n\n    for N, C in test_cases:\n        # Calculate grid and time step parameters\n        h = domain_L / N\n        k = C * h / a\n        \n        # Calculate number of steps to reach t_end as closely as possible\n        if k > 0:\n            n_steps = int(t_end / k + 0.5)\n        else: # Avoid division by zero if k=0 (though not in test cases)\n            n_steps = 0\n            \n        t_final = n_steps * k\n\n        # Set up the spatial grid\n        x = np.linspace(0, domain_L, N, endpoint=False)\n\n        # Initial condition\n        u_initial = A1 * np.sin(k1 * x) + A2 * np.sin(k2 * x)\n        \n        # --- Run the simulation ---\n        u_numerical = u_initial.copy()\n        for _ in range(n_steps):\n            # Upwind scheme: u_j^{n+1} = u_j^n - C * (u_j^n - u_{j-1}^n)\n            # np.roll(u, 1) implements the periodic boundary for u_{j-1}\n            u_numerical = u_numerical - C * (u_numerical - np.roll(u_numerical, 1))\n            \n        # --- Compute the error ---\n        # Exact solution at t_final\n        u_exact = A1 * np.sin(k1 * (x - a * t_final)) + A2 * np.sin(k2 * (x - a * t_final))\n\n        # Error vector\n        error_vec = u_numerical - u_exact\n\n        # Discrete L2-norm of the error\n        # ||e||_2 = sqrt(h * sum(e_j^2))\n        l2_error = np.sqrt(h * np.sum(error_vec**2))\n\n        # --- Calculate the report value ---\n        if C == 1.0:\n            # Special case: prediction is zero, report absolute error\n            # For C=1, the scheme is exactly a shift, error should be near machine precision\n            report_value = l2_error\n        else:\n            # Predicted L2-error from modified equation analysis\n            E_pred = np.abs(t_final * a * h / 2.0 * (1.0 - C)) * pred_mag\n            \n            # Report the ratio of measured error to predicted error\n            if E_pred > 0:\n                report_value = l2_error / E_pred\n            else: # Should not happen for C!=1, but handle defensively\n                report_value = l2_error\n\n        results.append(report_value)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}