{
    "hands_on_practices": [
        {
            "introduction": "将单元级信息组装成一个全局系统是有限元方法 (FEM) 的核心步骤。本练习  关注其中基础的簿记工作：计算系统的自由度 (DOF)。通过一个具体的 1D 梁结构，您将实践如何根据节点数量、每个节点的自由度以及边界条件来确定最终需求解的方程组规模，这是构建任何有限元模型的第一步。",
            "id": "3728934",
            "problem": "一根具有三维微观结构的细长、线性弹性、非均质悬臂微梁，在结构尺度上采用有限元法(FEM)内的一维(1D) Timoshenko梁理想化模型进行建模。这与一个多尺度框架相符，其中横截面的剪切和弯曲刚度代表了均质化的子尺度行为。该梁位于平面内，Timoshenko梁的每个节点都带有一组节点自由度(DOF)：$\\{u_{x},u_{y},\\theta_{z}\\}$，其中$u_{x}$是轴向平移，$u_{y}$是横向平移，$\\theta_{z}$是绕平面外轴的转动。该梁被离散化为4个串联的等长Timoshenko梁单元，每个单元有2个节点，并以标准的有限元法方式进行组装，使得相邻单元共享的节点被视为一个单一的全局节点。左端完全固定，在最左侧的全局节点上施加了本质(Dirichlet)边界条件 $u_{x}=0$、$u_{y}=0$ 和 $\\theta_{z}=0$，此外没有其他运动学约束。\n\n从组装网格中节点共享、每节点自由度以及作为消除未知数的约束的本质边界条件等基本定义出发，确定：(i) 在施加任何边界条件之前，全局自由度(DOF)的总数；以及 (ii) 在左端施加固定边界条件后，最终的无约束全局自由度数。仅将第(ii)部分的数量作为你的最终答案报告，形式为一个没有单位的整数。在你的推理中，论证边界条件如何通过约束节点自由度和消除平面设定下的刚体运动来减少自由度总数。",
            "solution": "首先，将对问题陈述的科学合理性、完整性和客观性进行验证。\n\n### 步骤 1：提取已知条件\n- **模型**：一个三维($3$D)微梁的一维($1$D) Timoshenko梁理想化模型。\n- **框架**：多尺度建模；横截面属性被均质化。\n- **离散化**：4个串联的等长、2节点Timoshenko梁单元。\n- **每节点自由度 (DOF)**：$\\{u_{x}, u_{y}, \\theta_{z}\\}$，分别对应轴向平移、横向平移和绕平面外轴的转动。每节点的自由度数为$3$。\n- **组装**：标准的有限元法(FEM)组装，其中相邻单元共享的节点被视为一个单一的全局节点。\n- **边界条件**：左端完全固定，在最左侧的全局节点上施加 $u_{x}=0$，$u_{y}=0$ 和 $\\theta_{z}=0$。\n- **约束**：未施加其他运动学约束。\n- **任务**：确定 (i) 施加边界条件前的全局总自由度数，以及 (ii) 施加边界条件后的最终无约束全局自由度数。最终答案应为第(ii)部分的结果。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，是有限元法在结构力学问题（悬臂梁）中的一个标准应用。所使用的术语——Timoshenko梁、自由度、本质边界条件、有限元法组装——在计算力学领域是标准的且有精确定义。该设置是计算全局系统矩阵大小的典型教科书练习。该问题是自洽的，提供了所有必要的数据，不包含内部矛盾或科学上错误的假设。它是适定的和客观的。\n\n### 步骤 3：结论与行动\n该问题有效。将展开一个有理有据的解答。\n\n解题过程首先确定组装后无约束系统中的总自由度数，然后减去由本质边界条件所约束的自由度数。\n\n**第 (i) 部分：施加边界条件前的全局总自由度数**\n\n必须确定网格中的全局节点总数。梁被离散化为 $N_{el} = 4$ 个串联的单元。对于线性单元链，唯一全局节点数 $N_{nodes}$ 由下式给出：\n$$N_{nodes} = N_{el} + 1$$\n代入给定的单元数：\n$$N_{nodes} = 4 + 1 = 5$$\n这 $5$ 个全局节点定义了整个梁模型的几何形状和位移场。\n\n问题陈述中说明，每个节点带有 $N_{dof/node} = 3$ 个自由度：$\\{u_{x}, u_{y}, \\theta_{z}\\}$。\n\n无约束全局系统中的总自由度数 $N_{total}$ 是全局节点数与每节点自由度数的乘积：\n$$N_{total} = N_{nodes} \\times N_{dof/node}$$\n代入计算值和给定值：\n$$N_{total} = 5 \\times 3 = 15$$\n因此，在施加任何边界条件之前，该系统由 $15$ 个独立的运动学变量描述。\n\n**第 (ii) 部分：施加边界条件后最终的无约束全局自由度数**\n\n问题指定梁的左端是完全固定的。在有限元法的背景下，“固支”或“固定”支座施加了本质（Dirichlet）边界条件，这些条件预先指定了节点自由度的值。对于最左侧的全局节点（我们将其记为节点 $1$），条件如下：\n- $u_{x,1} = 0$\n- $u_{y,1} = 0$\n- $\\theta_{z,1} = 0$\n\n这些方程中的每一个都固定了一个全局自由度的值，将其从待求解的未知数集合中移除。因此，受约束的自由度数 $N_{constrained}$ 等于施加的本质边界条件数。\n$$N_{constrained} = 3$$\n\n最终的无约束（或“自由”）全局自由度数 $N_{free}$ 是总自由度数减去受约束的自由度数：\n$$N_{free} = N_{total} - N_{constrained}$$\n$$N_{free} = 15 - 3 = 12$$\n\n这个最终数字 $N_{free} = 12$ 代表了为求解未知节点位移和转动而必须求解的简化线性方程组的大小。对于一个静力学问题，这将是经过分区和缩聚后的全局刚度矩阵的维数。\n\n按要求，提供一个关于刚体运动的额外论证。一个在平面内的无约束物体拥有 $3$ 种刚体模态：沿x轴的平移、沿y轴的平移以及绕z轴的转动。一个可解的静力或动力结构问题要求这些刚体运动被足够的边界条件所抑制。指定的固定条件，通过在单个节点上固定三个自由度 $\\{u_{x}, u_{y}, \\theta_{z}\\}$，直接约束了两个正交方向的平移和平面内的转动。这组 $3$ 个约束是完全消除所有 $3$ 种可能的刚体运动所需的最小约束，从而使得结构在运动学上是稳定的。因此，系统自由度减少 $3$ 个，正好对应于从解空间中移除不确定的刚体模态，从而确保梁的弹性变形有唯一解。",
            "answer": "$$\\boxed{12}$$"
        },
        {
            "introduction": "在实践中，网格中的单元很少是完美的正方形或三角形。等参映射允许我们使用一个统一、简单的参考单元来表示这些形状各异的物理单元。本练习  探讨的雅可比行列式 $|J|$ 是评估此映射质量的关键指标，一个正的行列式值确保了单元几何的有效性，避免了扭曲或重叠。",
            "id": "3728980",
            "problem": "在一个多尺度有限元法（FEM）的微观到宏观耦合步骤中，使用一个二维、双线性、等参四边形有限元，将参数坐标系 $(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$ 中的参考正方形映射到物理平面上的一个扭曲四边形。为进行数值积分，采用每个方向两点的高斯-勒让德求积（GLQ），因此积分点为 $(\\xi,\\eta)=(\\pm 1/\\sqrt{3},\\pm 1/\\sqrt{3})$。物理节点坐标是无量纲的，并按照与标准双线性形函数一致的逆时针顺序给出：\n$(x_1,y_1)=(0,0)$、\n$(x_2,y_2)=(2.0,0.3)$、\n$(x_3,y_3)=(2.2,1.8)$、\n$(x_4,y_4)=(-0.2,1.5)$。\n从四边形单元标准双线性形函数的等参映射出发，计算在四个GLQ点上各自的雅可比行列式 $|J(\\xi,\\eta)|$。利用这些值，评估该映射在单元上是否处处有效，即在所有GLQ点上是否有 $|J(\\xi,\\eta)| > 0$。作为最终答案，请报告四个GLQ点中 $|J(\\xi,\\eta)|$ 的最小值，并以精确解析形式表示（不进行四舍五入）。",
            "solution": "用户提供了一个来自计算力学领域（特别是有限元法FEM）的有效且适定的问题。所有必要的数据都已提供，目标也已明确定义。该问题具有科学依据，可以使用等参单元构造的标准原理解答。\n\n等参映射利用用于插值位移场的相同形函数，将物理坐标 $(x, y)$ 与参数坐标 $(\\xi, \\eta)$ 关联起来。该映射由下式给出：\n$$x(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) x_i$$\n$$y(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) y_i$$\n其中 $(x_i, y_i)$ 是第 i 个节点的坐标，$N_i(\\xi, \\eta)$ 是定义在参考正方形 $[-1, 1] \\times [-1, 1]$ 上的4节点四边形单元的双线性形函数。形函数按照从节点 $(\\xi, \\eta) = (-1, -1)$ 开始的标准逆时针顺序为：\n$N_1(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$\n$N_2(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$\n$N_3(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$\n$N_4(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$\n\n此变换的雅可比矩阵定义为：\n$$J(\\xi, \\eta) = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}$$\n雅可比矩阵的分量通过对映射方程求导得到：\n$\\frac{\\partial x}{\\partial \\xi} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi} x_i$\n$\\frac{\\partial x}{\\partial \\eta} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta} x_i$\n$\\frac{\\partial y}{\\partial \\xi} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi} y_i$\n$\\frac{\\partial y}{\\partial \\eta} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta} y_i$\n\n形函数的导数为：\n$\\frac{\\partial N_1}{\\partial \\xi} = -\\frac{1}{4}(1-\\eta)$, $\\frac{\\partial N_2}{\\partial \\xi} = \\frac{1}{4}(1-\\eta)$, $\\frac{\\partial N_3}{\\partial \\xi} = \\frac{1}{4}(1+\\eta)$, $\\frac{\\partial N_4}{\\partial \\xi} = -\\frac{1}{4}(1+\\eta)$\n$\\frac{\\partial N_1}{\\partial \\eta} = -\\frac{1}{4}(1-\\xi)$, $\\frac{\\partial N_2}{\\partial \\eta} = -\\frac{1}{4}(1+\\xi)$, $\\frac{\\partial N_3}{\\partial \\eta} = \\frac{1}{4}(1+\\xi)$, $\\frac{\\partial N_4}{\\partial \\eta} = \\frac{1}{4}(1-\\xi)$\n\n使用这些导数和给定的节点坐标 $(x_1,y_1)=(0,0)$、$(x_2,y_2)=(2, 0.3)$、$(x_3,y_3)=(2.2, 1.8)$ 和 $(x_4,y_4)=(-0.2, 1.5)$，我们计算雅可比矩阵的四个分量。我们将小数值转换为分数以保持精确性：$2.0 = 2$，$0.3 = \\frac{3}{10}$，$2.2 = \\frac{11}{5}$，$1.8 = \\frac{9}{5}$，$-0.2 = -\\frac{1}{5}$，$1.5 = \\frac{3}{2}$。\n\n$\\frac{\\partial x}{\\partial \\xi} = \\frac{1}{4}[-x_1(1-\\eta) + x_2(1-\\eta) + x_3(1+\\eta) - x_4(1+\\eta)]$\n$= \\frac{1}{4}[0 + 2(1-\\eta) + \\frac{11}{5}(1+\\eta) - (-\\frac{1}{5})(1+\\eta)] = \\frac{1}{4}[2 - 2\\eta + \\frac{11}{5} + \\frac{11}{5}\\eta + \\frac{1}{5} + \\frac{1}{5}\\eta]$\n$= \\frac{1}{4}[ (2 + \\frac{12}{5}) + (-2 + \\frac{12}{5})\\eta ] = \\frac{1}{4}[ \\frac{22}{5} + \\frac{2}{5}\\eta ] = \\frac{11}{10} + \\frac{1}{10}\\eta$\n\n$\\frac{\\partial x}{\\partial \\eta} = \\frac{1}{4}[-x_1(1-\\xi) - x_2(1+\\xi) + x_3(1+\\xi) + x_4(1-\\xi)]$\n$= \\frac{1}{4}[0 - 2(1+\\xi) + \\frac{11}{5}(1+\\xi) + (-\\frac{1}{5})(1-\\xi)] = \\frac{1}{4}[(-2 + \\frac{11}{5})(1+\\xi) - \\frac{1}{5}(1-\\xi)]$\n$= \\frac{1}{4}[\\frac{1}{5}(1+\\xi) - \\frac{1}{5}(1-\\xi)] = \\frac{1}{20}[1+\\xi - 1+\\xi] = \\frac{2\\xi}{20} = \\frac{1}{10}\\xi$\n\n$\\frac{\\partial y}{\\partial \\xi} = \\frac{1}{4}[-y_1(1-\\eta) + y_2(1-\\eta) + y_3(1+\\eta) - y_4(1+\\eta)]$\n$= \\frac{1}{4}[0 + \\frac{3}{10}(1-\\eta) + \\frac{9}{5}(1+\\eta) - \\frac{3}{2}(1+\\eta)] = \\frac{1}{4}[\\frac{3}{10} - \\frac{3}{10}\\eta + (\\frac{9}{5} - \\frac{3}{2})(1+\\eta)]$\n$= \\frac{1}{4}[\\frac{3}{10} - \\frac{3}{10}\\eta + \\frac{3}{10}(1+\\eta)] = \\frac{1}{4}[\\frac{3}{10} - \\frac{3}{10}\\eta + \\frac{3}{10} + \\frac{3}{10}\\eta] = \\frac{1}{4}(\\frac{6}{10}) = \\frac{3}{20}$\n\n$\\frac{\\partial y}{\\partial \\eta} = \\frac{1}{4}[-y_1(1-\\xi) - y_2(1+\\xi) + y_3(1+\\xi) + y_4(1-\\xi)]$\n$= \\frac{1}{4}[0 - \\frac{3}{10}(1+\\xi) + \\frac{9}{5}(1+\\xi) + \\frac{3}{2}(1-\\xi)] = \\frac{1}{4}[(-\\frac{3}{10} + \\frac{18}{10})(1+\\xi) + \\frac{3}{2}(1-\\xi)]$\n$= \\frac{1}{4}[\\frac{15}{10}(1+\\xi) + \\frac{3}{2}(1-\\xi)] = \\frac{1}{4}[\\frac{3}{2}(1+\\xi) + \\frac{3}{2}(1-\\xi)] = \\frac{1}{4}\\frac{3}{2}[1+\\xi+1-\\xi] = \\frac{3}{8}(2) = \\frac{3}{4}$\n\n因此，雅可比矩阵为：\n$$J(\\xi, \\eta) = \\begin{pmatrix} \\frac{11}{10} + \\frac{1}{10}\\eta & \\frac{1}{10}\\xi \\\\ \\frac{3}{20} & \\frac{3}{4} \\end{pmatrix}$$\n雅可比行列式 $|J|$ 为：\n$$|J(\\xi, \\eta)| = \\det(J) = \\left(\\frac{11}{10} + \\frac{1}{10}\\eta\\right)\\left(\\frac{3}{4}\\right) - \\left(\\frac{1}{10}\\xi\\right)\\left(\\frac{3}{20}\\right)$$\n$$|J(\\xi, \\eta)| = \\frac{33}{40} + \\frac{3}{40}\\eta - \\frac{3}{200}\\xi$$\n一个有效的映射要求在整个单元上 $|J| > 0$。我们在四个高斯-勒让德求积（GLQ）点 $(\\xi, \\eta) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$ 上检查此条件。令 $a = 1/\\sqrt{3}$。这四个点是 $(a, a)$、$(-a, a)$、$(-a, -a)$ 和 $(a, -a)$。\n\n1.  在点 $(\\xi, \\eta) = (\\frac{1}{\\sqrt{3}}, \\frac{1}{\\sqrt{3}})$ 处：\n    $|J_1| = \\frac{33}{40} - \\frac{3}{200}\\frac{1}{\\sqrt{3}} + \\frac{3}{40}\\frac{1}{\\sqrt{3}} = \\frac{33}{40} + \\frac{1}{\\sqrt{3}}(-\\frac{3}{200} + \\frac{15}{200}) = \\frac{33}{40} + \\frac{12}{200\\sqrt{3}}$\n\n2.  在点 $(\\xi, \\eta) = (-\\frac{1}{\\sqrt{3}}, \\frac{1}{\\sqrt{3}})$ 处：\n    $|J_2| = \\frac{33}{40} - \\frac{3}{200}(-\\frac{1}{\\sqrt{3}}) + \\frac{3}{40}\\frac{1}{\\sqrt{3}} = \\frac{33}{40} + \\frac{1}{\\sqrt{3}}(\\frac{3}{200} + \\frac{15}{200}) = \\frac{33}{40} + \\frac{18}{200\\sqrt{3}}$\n\n3.  在点 $(\\xi, \\eta) = (-\\frac{1}{\\sqrt{3}}, -\\frac{1}{\\sqrt{3}})$ 处：\n    $|J_3| = \\frac{33}{40} - \\frac{3}{200}(-\\frac{1}{\\sqrt{3}}) + \\frac{3}{40}(-\\frac{1}{\\sqrt{3}}) = \\frac{33}{40} + \\frac{1}{\\sqrt{3}}(\\frac{3}{200} - \\frac{15}{200}) = \\frac{33}{40} - \\frac{12}{200\\sqrt{3}}$\n\n4.  在点 $(\\xi, \\eta) = (\\frac{1}{\\sqrt{3}}, -\\frac{1}{\\sqrt{3}})$ 处：\n    $|J_4| = \\frac{33}{40} - \\frac{3}{200}\\frac{1}{\\sqrt{3}} + \\frac{3}{40}(-\\frac{1}{\\sqrt{3}}) = \\frac{33}{40} - \\frac{1}{\\sqrt{3}}(\\frac{3}{200} + \\frac{15}{200}) = \\frac{33}{40} - \\frac{18}{200\\sqrt{3}}$\n\n常数项 $\\frac{33}{40}$ 是正的，并且显著大于变量项。例如，$\\frac{18}{200\\sqrt{3}} = \\frac{9}{100\\sqrt{3}} \\approx \\frac{9}{173.2} \\approx 0.052$，而 $\\frac{33}{40} = 0.825$。所有四个雅可比行列式的值都是正数，因此该映射在所有GLQ点上都是有效的。\n\n为了找到这四个值中的最小值，我们对它们进行比较。由于 $\\frac{18}{200\\sqrt{3}}$ 是一个正量，最小值为 $|J_4|$。\n$|J|_{min} = \\frac{33}{40} - \\frac{18}{200\\sqrt{3}} = \\frac{33}{40} - \\frac{9}{100\\sqrt{3}}$。\n为了将其表示为具有有理分母的单个分数，我们首先将第二项有理化：\n$\\frac{9}{100\\sqrt{3}} = \\frac{9\\sqrt{3}}{100 \\cdot 3} = \\frac{3\\sqrt{3}}{100}$。\n所以， $|J|_{min} = \\frac{33}{40} - \\frac{3\\sqrt{3}}{100}$。\n通分，取公分母为 $200$：\n$|J|_{min} = \\frac{33 \\cdot 5}{200} - \\frac{3\\sqrt{3} \\cdot 2}{200} = \\frac{165}{200} - \\frac{6\\sqrt{3}}{200} = \\frac{165 - 6\\sqrt{3}}{200}$。\n这是在指定的GLQ点上雅可比行列式最小值的最终精确解析值。",
            "answer": "$$\\boxed{\\frac{165 - 6\\sqrt{3}}{200}}$$"
        },
        {
            "introduction": "本练习将单元的几何质量与其数值计算结果直接联系起来。一个形状不佳的单元会导致刚度矩阵的病态（ill-conditioned），从而严重影响解的准确性。这个动手实践  通过计算逐渐倾斜的单元的刚度矩阵条件数，量化地展示了这种关系，突显了在实际有限元仿真中保持良好网格质量的至关重要性。",
            "id": "3728939",
            "problem": "考虑二维标量扩散问题，其由定义在域 $\\Omega \\subset \\mathbb{R}^2$ 上的偏微分方程 $-\\nabla \\cdot (\\kappa \\nabla u) = f$ 和在部分边界上施加的齐次狄利克雷边界条件所确定。在等参格式下，使用标准的伽辽金有限元法和双线性四边形单元（也称为 $Q_4$ 单元）。假设标量传导率 $\\kappa = 1$ 为常数。\n\n你需要分析单个 $Q_4$ 单元的几何畸变如何影响其刚度矩阵的条件数。从扩散问题的能量原理出发，该原理指出，弱形式源于泛函 $E(u) = \\int_{\\Omega} \\kappa \\nabla u \\cdot \\nabla u \\, d\\Omega - \\int_{\\Omega} fv \\, d\\Omega$ 在容许变分下的驻点。使用在自然坐标 $(\\xi,\\eta) \\in [-1, 1] \\times [-1, 1]$ 下的参考方形单元上定义的双线性形函数来推导离散形式，并通过等参插值映射到物理单元。单个单元的刚度矩阵由积分 $K_{ij} = \\int_{\\Omega_e} \\kappa \\, \\nabla N_i \\cdot \\nabla N_j \\, d\\Omega$ 给出，其中 $N_i$ 是双线性形函数。使用 $2\\times 2$ 点的张量积高斯求积法对该积分进行数值计算，并利用雅可比矩阵和链式法则计算梯度。\n\n为防止与形函数的单位分解相关的已知零空间（这使得单元级刚度矩阵奇异），通过消除节点 1 对应的自由度来施加齐次狄利克雷边界条件。也就是说，通过移除与节点 1 相关联的行和列来构造降阶刚度矩阵。\n\n通过固定三个节点并让右上角节点水平移动一个扭曲参数 $d$ 来定义一系列逐渐扭曲的四边形单元。具体来说，设置节点坐标如下：\n- $x_1 = 0$, $y_1 = 0$,\n- $x_2 = 1$, $y_2 = 0$,\n- $x_3 = 1 + d$, $y_3 = 1$,\n- $x_4 = 0$, $y_4 = 1$。\n对于每个给定的 $d$，通过在参考方块上进行 $2\\times 2$ 高斯求积来计算降阶单元刚度矩阵 $K_{\\text{red}}$，然后计算其谱条件数，定义为 $\\kappa_2(K_{\\text{red}}) = \\|K_{\\text{red}}\\|_2 \\cdot \\|K_{\\text{red}}^{-1}\\|_2$。如果映射在任何求积点处无效（即，如果雅可比行列式 $\\det J$ 非正或小于表示接近简并的某个小容差），则将刚度矩阵视为奇异矩阵，并返回条件数为 $\\infty$。\n\n你的程序必须为每个测试用例实现以下步骤：\n- 使用参考单元上的双线性形函数和到具有指定节点坐标的物理单元的等参映射，通过数值求积构建 $K$。\n- 在节点 1 处施加齐次狄利克雷边界条件，方法是移除相应的行和列以获得 $K_{\\text{red}}$。\n- 计算谱条件数 $\\kappa_2(K_{\\text{red}})$；如果基于雅可比行列式检查，矩阵是奇异的或映射是无效的，则对该情况输出 $\\infty$。\n\n使用以下扭曲参数测试套件：\n- $d = 0.0$（基准方形单元），\n- $d = 0.3$（中度扭曲），\n- $d = 0.6$（高度扭曲），\n- $d = 0.9$（非常高度扭曲），\n- $d = -0.8$（接近简并但仍为凸的负扭曲）。\n\n在此设置中，所有计算都严格无量纲。你的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_i$ 是对应 $d$ 值的条件数，四舍五入到六位小数。如果某个情况根据雅可比行列式判据被认定为奇异或无效，则用编程语言为浮点值生成的字面无穷大值（例如，$[\\infty, \\dots]$）代替数字。",
            "solution": "用户提供的问题要求分析几何畸变对二维标量扩散问题有限元刚度矩阵条件数的影响。该问题是适定的、科学上合理的，并为唯一解提供了所有必要的数据。我们将进行完整的推导和实现。\n\n该分析基于扩散方程的弱形式 $-\\nabla \\cdot (\\kappa \\nabla u) = f$，该方程使用等参双线性四边形 ($Q_4$) 单元的伽辽金有限元法进行离散化。\n\n### 1. 弱形式和伽辽金离散化\n\n控制偏微分方程是能量泛函的驻点：\n$$\nE(u) = \\frac{1}{2} \\int_{\\Omega} \\kappa (\\nabla u \\cdot \\nabla u) \\, d\\Omega - \\int_{\\Omega} f u \\, d\\Omega\n$$\n通过对 $E(u)$ 关于测试函数 $v$ 取一阶变分并将其设为零来找到弱形式：\n$$\n\\delta E = \\int_{\\Omega} \\kappa (\\nabla u \\cdot \\nabla v) \\, d\\Omega - \\int_{\\Omega} f v \\, d\\Omega = 0\n$$\n在伽辽金方法中，我们通过基函数 $N_i(x,y)$ 的线性组合来近似域上的解 $u(x,y)$：\n$$\nu(x,y) \\approx u_h(x,y) = \\sum_{j=1}^{n} u_j N_j(x,y)\n$$\n其中 $u_j$ 是未知系数（节点值），$n$ 是单元中的节点数。测试函数 $v$ 选自与基函数相同的空间，即 $v = N_i(x,y)$。将此代入单个单元域 $\\Omega_e$ 的弱形式中，得到单元级方程组：\n$$\n\\sum_{j=1}^{n} \\left( \\int_{\\Omega_e} \\kappa \\nabla N_i \\cdot \\nabla N_j \\, d\\Omega \\right) u_j = \\int_{\\Omega_e} f N_i \\, d\\Omega\n$$\n这是 $K^e \\mathbf{u} = \\mathbf{f}^e$ 的形式，其中单元刚度矩阵 $K^e$ 的项为：\n$$\nK_{ij}^e = \\int_{\\Omega_e} \\kappa \\nabla N_i \\cdot \\nabla N_j \\, d\\Omega\n$$\n对于此问题，传导率 $\\kappa$ 是设置为 1 的常数。\n\n### 2. 等参双线性单元\n\n我们使用 $Q_4$ 单元，它是一个有四个节点的四边形。该公式是等参的，意味着使用相同的基函数来插值几何形状和解场。\n\n**参考单元：**\n计算在自然坐标系 $(\\xi, \\eta)$ 中定义的参考方形单元上执行，其中 $\\xi, \\eta \\in [-1, 1]$。四个节点位于 $(\\pm 1, \\pm 1)$。双线性形函数为：\n\\begin{align*}\nN_1(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta) \\\\\nN_2(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta) \\\\\nN_3(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta) \\\\\nN_4(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)\n\\end{align*}\n\n**坐标映射：**\n单元内任意点的物理坐标 $(x,y)$ 由自然坐标 $(\\xi, \\eta)$ 使用节点坐标 $(x_i, y_i)$ 映射而来：\n$$\nx(\\xi, \\eta) = \\sum_{i=1}^{4} x_i N_i(\\xi, \\eta) \\quad \\text{和} \\quad y(\\xi, \\eta) = \\sum_{i=1}^{4} y_i N_i(\\xi, \\eta)\n$$\n\n**梯度转换：**\n为了计算刚度矩阵，我们需要形函数相对于物理坐标 $(x,y)$ 的梯度。这些梯度是使用链式法则从相对于自然坐标 $(\\xi, \\eta)$ 的梯度获得的：\n$$\n\\begin{pmatrix} \\frac{\\partial N_i}{\\partial \\xi} \\\\ \\frac{\\partial N_i}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{pmatrix} = J^T \\begin{pmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{pmatrix}\n$$\n其中 $J$ 是变换的雅可比矩阵，通常定义为 $J_{ab} = \\partial x_a / \\partial \\xi_b$。因此，上面公式中的矩阵是 $J^T$。反转此关系可得到物理梯度：\n$$\n\\nabla_{x,y} N_i = \\begin{pmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{pmatrix} = (J^T)^{-1} \\begin{pmatrix} \\frac{\\partial N_i}{\\partial \\xi} \\\\ \\frac{\\partial N_i}{\\partial \\eta} \\end{pmatrix} = J^{-T} \\nabla_{\\xi, \\eta} N_i\n$$\n\n### 3. 刚度矩阵计算与数值求积\n\n刚度矩阵的积分必须转换到参考坐标系。微分面积元变换为 $d\\Omega = dx\\,dy = \\det(J) \\, d\\xi\\, d\\eta$。刚度矩阵项变为：\n$$\nK_{ij}^e = \\int_{-1}^{1} \\int_{-1}^{1} \\kappa \\left( \\nabla_{x,y} N_i \\cdot \\nabla_{x,y} N_j \\right) \\det(J) \\, d\\xi \\, d\\eta\n$$\n点积可以写成 $(\\nabla_{x,y} N_i)^T (\\nabla_{x,y} N_j)$。对于扭曲的单元，该积分通常过于复杂，无法解析计算，因此使用数值求积进行近似。问题指定了 $2 \\times 2$ 张量积高斯求积方案。积分被近似为在特定高斯点 $(\\xi_k, \\eta_k)$ 处计算的被积函数的加权和：\n$$\nK_{ij}^e \\approx \\sum_{k=1}^{4} w_k \\kappa \\left[ (\\nabla_{x,y} N_i)^T (\\nabla_{x,y} N_j) \\det(J) \\right]_{(\\xi_k, \\eta_k)}\n$$\n对于 $2 \\times 2$ 方案，四个高斯点是 $(\\pm a, \\pm a)$，其中 $a=1/\\sqrt{3}$，并且所有权重 $w_k$ 都等于 $1$。\n\n映射的几何有效性取决于雅可比行列式 $\\det(J)$ 的符号。如果在单元内任何一点 $\\det(J) \\le 0$，则映射是简并的或方向反转的，从而使单元无效。我们在每个高斯点检查此条件。\n\n### 4. 边界条件、矩阵降阶和条件数\n\n对于扩散问题，单元刚度矩阵 $K^e$ 总是奇异的，因为它有一个对应于恒定势（即，如果 $\\mathbf{c}$ 是一个全为 1 的向量，则 $K^e \\mathbf{c} = 0$）的零空间。为了获得可解的系统，必须施加边界条件。问题规定在节点 1 处施加齐次狄利克雷条件 ($u_1 = 0$)。这是通过消除 $4 \\times 4$ 矩阵 $K^e$ 的第一行和第一列以形成一个 $3 \\times 3$ 的降阶刚度矩阵 $K_{\\text{red}}$ 来实现的。\n\n对于非简并单元，$K_{\\text{red}}$ 是对称正定的，因此是可逆的。该矩阵的条件数是其对扰动敏感性的度量。我们使用谱条件数 $\\kappa_2(A)$，定义为：\n$$\n\\kappa_2(K_{\\text{red}}) = \\|K_{\\text{red}}\\|_2 \\cdot \\|K_{\\text{red}}^{-1}\\|_2 = \\frac{\\sigma_{\\max}(K_{\\text{red}})}{\\sigma_{\\min}(K_{\\text{red}})}\n$$\n其中 $\\sigma$ 表示矩阵的奇异值。对于对称正定矩阵，这是最大特征值与最小特征值的比值。高条件数表示单元形状不良，这可能在完整的有限元模拟中导致较大的数值误差。\n\n对每个扭曲参数 $d$ 的算法如下：\n1.  根据 $d$ 定义物理节点坐标。\n2.  将一个 $4 \\times 4$ 的单元刚度矩阵 $K^e$ 初始化为零。\n3.  遍历四个 $2 \\times 2$ 高斯点 $(\\xi_k, \\eta_k)$：\n    a.  在当前高斯点计算形函数的导数 $\\nabla_{\\xi, \\eta} N_i$。\n    b.  计算雅可比矩阵 $J$ 及其行列式 $\\det(J)$。\n    c.  如果 $\\det(J)$ 非正（或低于某个小容差），则将该单元标记为无效，并终止对此 $d$ 的计算。\n    d.  计算物理梯度 $\\nabla_{x,y} N_i = J^{-T} \\nabla_{\\xi, \\eta} N_i$。\n    e.  计算此点对刚度矩阵的贡献，并将其加到 $K^e$ 中。\n4.  如果单元有效，通过从 $K^e$ 中移除第一行和第一列来形成 $3 \\times 3$ 的降阶矩阵 $K_{\\text{red}}$。\n5.  计算并存储谱条件数 $\\kappa_2(K_{\\text{red}})$。如果单元被标记为无效，则存储 $\\infty$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_condition_number(d: float) -> float:\n    \"\"\"\n    Computes the spectral condition number of the reduced stiffness matrix\n    for a single bilinear quadrilateral element with a given skew parameter d.\n\n    Args:\n        d: The horizontal skew parameter for the top-right node.\n\n    Returns:\n        The spectral condition number, or numpy.inf if the element mapping is invalid.\n    \"\"\"\n    # 1. Define nodal coordinates for the physical element\n    nodes = np.array([\n        [0.0, 0.0],          # Node 1\n        [1.0, 0.0],          # Node 2\n        [1.0 + d, 1.0],      # Node 3\n        [0.0, 1.0]           # Node 4\n    ])\n\n    # 2. Define 2x2 Gaussian quadrature points and weights\n    a = 1.0 / np.sqrt(3.0)\n    gauss_points = [(-a, -a), (a, -a), (a, a), (-a, a)]\n    gauss_weights = [1.0, 1.0, 1.0, 1.0]\n\n    # 3. Initialize the 4x4 element stiffness matrix\n    K_e = np.zeros((4, 4))\n    kappa_conductivity = 1.0  # Constant scalar conductivity\n\n    # 4. Loop over Gauss points to assemble the stiffness matrix\n    for i in range(len(gauss_points)):\n        xi, eta = gauss_points[i]\n        weight = gauss_weights[i]\n\n        # Derivatives of bilinear shape functions w.r.t. natural coordinates (xi, eta)\n        # dN/dxi at the current Gauss point\n        dN_dxi = 0.25 * np.array([-(1.0 - eta), (1.0 - eta), (1.0 + eta), -(1.0 + eta)])\n        # dN/deta at the current Gauss point\n        dN_deta = 0.25 * np.array([-(1.0 - xi), -(1.0 + xi), (1.0 + xi), (1.0 - xi)])\n        \n        # Jacobian matrix J_ij = dx_i / d_xi_j\n        J = np.zeros((2, 2))\n        J[0, 0] = np.dot(dN_dxi, nodes[:, 0]) # dx/dxi\n        J[0, 1] = np.dot(dN_deta, nodes[:, 0])# dx/deta\n        J[1, 0] = np.dot(dN_dxi, nodes[:, 1]) # dy/dxi\n        J[1, 1] = np.dot(dN_deta, nodes[:, 1])# dy/deta\n\n        # Determinant of the Jacobian\n        detJ = np.linalg.det(J)\n\n        # Check for invalid mapping (non-positive or near-zero determinant)\n        if detJ <= 1e-12:\n            return np.inf\n\n        # Inverse of the Jacobian\n        invJ = np.linalg.inv(J)\n\n        # Gradients of shape functions in physical coordinates (x, y)\n        # B = [dNi/dx, dNi/dy] for i=1..4\n        # (dNi/dxi, dNi/deta) = (dNi/dx, dNi/dy) * J\n        # so (dNi/dx, dNi/dy) = (dNi/dxi, dNi/deta) * inv(J)\n        B = np.zeros((4, 2))\n        for node_idx in range(4):\n            grad_ref = np.array([dN_dxi[node_idx], dN_deta[node_idx]])\n            B[node_idx, :] = grad_ref @ invJ\n\n        # Add contribution to the stiffness matrix\n        # K_e += B * B^T * detJ * weight * kappa\n        K_e += kappa_conductivity * (B @ B.T) * detJ * weight\n    \n    # 5. Apply homogeneous Dirichlet BC at node 1 by creating the reduced matrix\n    K_red = K_e[1:, 1:]\n\n    # 6. Compute and return the spectral condition number (p=2) of the reduced matrix\n    cond_num = np.linalg.cond(K_red, p=2)\n\n    return cond_num\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for the specified test cases and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        0.0,   # Baseline square element\n        0.3,   # Moderate skew\n        0.6,   # High skew\n        0.9,   # Very high skew\n        -0.8   # Negative skew near degeneracy\n    ]\n\n    results = []\n    for d in test_cases:\n        result = compute_condition_number(d)\n        results.append(result)\n\n    # Format the results for printing\n    results_str = []\n    for r in results:\n        if r == np.inf:\n            results_str.append(\"inf\")\n        else:\n            # Round to six decimal places\n            results_str.append(f\"{r:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}