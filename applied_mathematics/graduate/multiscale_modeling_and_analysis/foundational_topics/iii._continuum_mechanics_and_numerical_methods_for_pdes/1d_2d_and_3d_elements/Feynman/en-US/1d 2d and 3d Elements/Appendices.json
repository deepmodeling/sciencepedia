{
    "hands_on_practices": [
        {
            "introduction": "Before solving any complex engineering problem with the Finite Element Method (FEM), we must first assemble the digital model. This fundamental exercise  walks you through the process of calculating the total number of degrees of freedom (DOFs) for a simple 1D structure. Understanding how to count DOFs and apply boundary conditions is the first step in defining the size and scope of the linear system you will eventually solve.",
            "id": "3728934",
            "problem": "A slender, linearly elastic, heterogeneous cantilevered micro-beam with three-dimensional microstructure is modeled at the structural scale using a one-dimensional (1D) Timoshenko beam idealization within the Finite Element Method (FEM), consistent with a multiscale framework where the cross-sectional shear and bending stiffnesses represent homogenized subscale behavior. The beam lies in the plane, and each node of the Timoshenko beam carries the nodal degrees of freedom (DOF) set $\\{u_{x},u_{y},\\theta_{z}\\}$, where $u_{x}$ is the axial translation, $u_{y}$ is the transverse translation, and $\\theta_{z}$ is the rotation about the out-of-plane axis. The beam is discretized into $4$ equal Timoshenko beam elements connected in series, each with $2$ nodes, and assembled in the standard FEM fashion so that nodes shared by adjacent elements are identified as a single global node. The left end is perfectly clamped, enforcing the essential (Dirichlet) boundary conditions $u_{x}=0$, $u_{y}=0$, and $\\theta_{z}=0$ at the leftmost global node, and there are no other kinematic constraints elsewhere.\n\nStarting from the fundamental definitions of node sharing in assembled meshes, degrees of freedom per node, and essential boundary conditions as constraints that remove unknowns, determine: (i) the total number of global DOFs before any boundary conditions are applied, and (ii) the final number of unconstrained global DOFs after imposing the clamped boundary conditions at the left end. Report only the quantity in part (ii) as your final answer, as a single integer with no units. In your reasoning, justify how the boundary conditions reduce the count in terms of constrained nodal DOFs and the elimination of rigid-body motions in the planar setting.",
            "solution": "The problem statement will first be validated for scientific soundness, completeness, and objectivity.\n\n### Step 1: Extract Givens\n- **Model**: A one-dimensional ($1$D) Timoshenko beam idealization of a three-dimensional ($3$D) micro-beam.\n- **Framework**: Multiscale modeling; cross-sectional properties are homogenized.\n- **Discretization**: $4$ equal, $2$-node Timoshenko beam elements connected in series.\n- **Degrees of Freedom (DOF) per Node**: $\\{u_{x}, u_{y}, \\theta_{z}\\}$ corresponding to axial translation, transverse translation, and out-of-plane rotation, respectively. The number of DOFs per node is $3$.\n- **Assembly**: Standard Finite Element Method (FEM) assembly, where nodes shared by adjacent elements are identified as a single global node.\n- **Boundary Conditions**: The left end is perfectly clamped, imposing $u_{x}=0$, $u_{y}=0$, and $\\theta_{z}=0$ at the leftmost global node.\n- **Constraints**: No other kinematic constraints are applied.\n- **Task**: Determine (i) the total number of global DOFs before applying boundary conditions, and (ii) the final number of unconstrained global DOFs after applying boundary conditions. The final answer should be the result of part (ii).\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, being a standard application of the Finite Element Method to a structural mechanics problem (a cantilever beam). The terminology used—Timoshenko beam, degrees of freedom, essential boundary conditions, FEM assembly—is standard and precisely defined within the field of computational mechanics. The setup is a canonical textbook exercise for calculating the size of a global system matrix. The problem is self-contained, with all necessary data provided, and contains no internal contradictions or scientifically false premises. It is well-posed and objective.\n\n### Step 3: Verdict and Action\nThe problem is valid. A reasoned solution will be developed.\n\nThe solution proceeds by first determining the total number of degrees of freedom in the assembled, unconstrained system and then subtracting the number of degrees of freedom that are constrained by the essential boundary conditions.\n\n**Part (i): Total Number of Global DOFs Before Boundary Conditions**\n\nThe total number of global nodes in the mesh must be determined. The beam is discretized into $N_{el} = 4$ elements connected in series. For a linear chain of elements, the number of unique global nodes, $N_{nodes}$, is given by:\n$$N_{nodes} = N_{el} + 1$$\nSubstituting the given number of elements:\n$$N_{nodes} = 4 + 1 = 5$$\nThese $5$ global nodes define the geometry and displacement field of the entire beam model.\n\nThe problem states that each node carries $N_{dof/node} = 3$ degrees of freedom: $\\{u_{x}, u_{y}, \\theta_{z}\\}$.\n\nThe total number of degrees of freedom in the unconstrained global system, $N_{total}$, is the product of the number of global nodes and the number of degrees of freedom per node:\n$$N_{total} = N_{nodes} \\times N_{dof/node}$$\nSubstituting the calculated and given values:\n$$N_{total} = 5 \\times 3 = 15$$\nThus, before any boundary conditions are applied, the system is described by $15$ independent kinematic variables.\n\n**Part (ii): Final Number of Unconstrained Global DOFs After Boundary Conditions**\n\nThe problem specifies that the left end of the beam is perfectly clamped. In the context of the Finite Element Method, a \"clamped\" or \"fixed\" support imposes essential (Dirichlet) boundary conditions, which pre-specify the values of the nodal DOFs. For the leftmost global node (let us denote it as node $1$), the conditions are:\n- $u_{x,1} = 0$\n- $u_{y,1} = 0$\n- $\\theta_{z,1} = 0$\n\nEach of these equations fixes the value of one global DOF, removing it from the set of unknowns to be solved for. The number of constrained DOFs, $N_{constrained}$, is therefore equal to the number of applied essential boundary conditions.\n$$N_{constrained} = 3$$\n\nThe final number of unconstrained (or \"free\") global DOFs, $N_{free}$, is the total number of DOFs minus the number of constrained DOFs:\n$$N_{free} = N_{total} - N_{constrained}$$\n$$N_{free} = 15 - 3 = 12$$\n\nThis final number, $N_{free} = 12$, represents the size of the reduced system of linear equations that must be solved to find the unknown nodal displacements and rotations. For a static problem, this would be the dimension of the global stiffness matrix after partitioning and condensation.\n\nAs requested, an additional justification regarding rigid-body motions is provided. An unconstrained body in a plane possesses $3$ rigid-body modes: translation along the $x$-axis, translation along the $y$-axis, and rotation about the $z$-axis. A solvable static or dynamic structural problem requires that these rigid-body motions be suppressed by sufficient boundary conditions. The specified clamped condition, by fixing the three DOFs $\\{u_{x}, u_{y}, \\theta_{z}\\}$ at a single node, directly constrains translation in two orthogonal directions and rotation in the plane. This set of $3$ constraints is the minimum required to fully eliminate all $3$ possible rigid-body motions, rendering the structure kinematically stable. Therefore, the reduction of the system's DOFs by $3$ corresponds precisely to the removal of the indeterminate rigid-body modes from the solution space, ensuring a unique solution for the elastic deformation of the beam.",
            "answer": "$$\\boxed{12}$$"
        },
        {
            "introduction": "Moving from 1D to 2D, the complexity of element geometry increases significantly. Isoparametric elements are a powerful tool, mapping a simple 'parent' element to a distorted shape in the physical domain, but this mapping must be valid. This practice  focuses on the Jacobian determinant, a key quantity that governs the validity of this transformation and is essential for numerical integration. Calculating it by hand for a given element provides crucial insight into the mathematical machinery behind meshing and element formulation.",
            "id": "3728980",
            "problem": "A two-dimensional, bilinear, isoparametric quadrilateral finite element is used in a multiscale finite element method (FEM) micro-to-macro coupling step to map a reference square in parametric coordinates $(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$ to a distorted quadrilateral in the physical plane. For numerical integration, Gauss–Legendre Quadrature (GLQ) with two points per direction is employed, so the integration points are $(\\xi,\\eta)=(\\pm 1/\\sqrt{3},\\pm 1/\\sqrt{3})$. The physical nodal coordinates are dimensionless and given in counterclockwise order consistent with the standard bilinear shape functions:\n$(x_1,y_1)=(0,0)$,\n$(x_2,y_2)=(2.0,0.3)$,\n$(x_3,y_3)=(2.2,1.8)$,\n$(x_4,y_4)=(-0.2,1.5)$.\nStarting from the isoparametric mapping with the standard bilinear shape functions for a quadrilateral element, compute the Jacobian determinant $|J(\\xi,\\eta)|$ at each of the four GLQ points. Using these values, assess whether the mapping is valid everywhere on the element in the sense that $|J(\\xi,\\eta)|>0$ at all GLQ points. Report, as your final answer, the minimum value of $|J(\\xi,\\eta)|$ among the four GLQ points, expressed in an exact analytic form (no rounding).",
            "solution": "The user has provided a valid, well-posed problem from the field of computational mechanics, specifically the Finite Element Method (FEM). All necessary data are provided, and the objective is clearly defined. The problem is scientifically grounded and can be solved using standard principles of isoparametric element formulation.\n\nThe isoparametric mapping relates the physical coordinates $(x, y)$ to the parametric coordinates $(\\xi, \\eta)$ using the same shape functions that are used to interpolate the displacement field. The mapping is given by:\n$$x(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) x_i$$\n$$y(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) y_i$$\nwhere $(x_i, y_i)$ are the coordinates of the $i$-th node, and $N_i(\\xi, \\eta)$ are the bilinear shape functions for a 4-node quadrilateral element, defined on the reference square $[-1, 1] \\times [-1, 1]$. The shape functions are, in standard counterclockwise order starting from the node at $(\\xi, \\eta) = (-1, -1)$:\n$N_1(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta)$\n$N_2(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)$\n$N_3(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta)$\n$N_4(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)$\n\nThe Jacobian matrix of this transformation is defined as:\n$$J(\\xi, \\eta) = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}$$\nThe components of the Jacobian matrix are found by differentiating the mapping equations:\n$\\frac{\\partial x}{\\partial \\xi} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi} x_i$\n$\\frac{\\partial x}{\\partial \\eta} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta} x_i$\n$\\frac{\\partial y}{\\partial \\xi} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi} y_i$\n$\\frac{\\partial y}{\\partial \\eta} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta} y_i$\n\nThe derivatives of the shape functions are:\n$\\frac{\\partial N_1}{\\partial \\xi} = -\\frac{1}{4}(1-\\eta)$, $\\frac{\\partial N_2}{\\partial \\xi} = \\frac{1}{4}(1-\\eta)$, $\\frac{\\partial N_3}{\\partial \\xi} = \\frac{1}{4}(1+\\eta)$, $\\frac{\\partial N_4}{\\partial \\xi} = -\\frac{1}{4}(1+\\eta)$\n$\\frac{\\partial N_1}{\\partial \\eta} = -\\frac{1}{4}(1-\\xi)$, $\\frac{\\partial N_2}{\\partial \\eta} = -\\frac{1}{4}(1+\\xi)$, $\\frac{\\partial N_3}{\\partial \\eta} = \\frac{1}{4}(1+\\xi)$, $\\frac{\\partial N_4}{\\partial \\eta} = \\frac{1}{4}(1-\\xi)$\n\nUsing these derivatives and the given nodal coordinates $(x_1,y_1)=(0,0)$, $(x_2,y_2)=(2.0, 0.3)$, $(x_3,y_3)=(2.2, 1.8)$, and $(x_4,y_4)=(-0.2, 1.5)$, we compute the four components of the Jacobian matrix. We will convert the decimal values to fractions to preserve exactness: $2.0 = 2$, $0.3 = \\frac{3}{10}$, $2.2 = \\frac{11}{5}$, $1.8 = \\frac{9}{5}$, $-0.2 = -\\frac{1}{5}$, $1.5 = \\frac{3}{2}$.\n\n$\\frac{\\partial x}{\\partial \\xi} = \\frac{1}{4}[-x_1(1-\\eta) + x_2(1-\\eta) + x_3(1+\\eta) - x_4(1+\\eta)]$\n$= \\frac{1}{4}[0 + 2(1-\\eta) + \\frac{11}{5}(1+\\eta) - (-\\frac{1}{5})(1+\\eta)] = \\frac{1}{4}[2 - 2\\eta + \\frac{11}{5} + \\frac{11}{5}\\eta + \\frac{1}{5} + \\frac{1}{5}\\eta]$\n$= \\frac{1}{4}[ (2 + \\frac{12}{5}) + (-2 + \\frac{12}{5})\\eta ] = \\frac{1}{4}[ \\frac{22}{5} + \\frac{2}{5}\\eta ] = \\frac{11}{10} + \\frac{1}{10}\\eta$\n\n$\\frac{\\partial x}{\\partial \\eta} = \\frac{1}{4}[-x_1(1-\\xi) - x_2(1+\\xi) + x_3(1+\\xi) + x_4(1-\\xi)]$\n$= \\frac{1}{4}[0 - 2(1+\\xi) + \\frac{11}{5}(1+\\xi) + (-\\frac{1}{5})(1-\\xi)] = \\frac{1}{4}[(-2 + \\frac{11}{5})(1+\\xi) - \\frac{1}{5}(1-\\xi)]$\n$= \\frac{1}{4}[\\frac{1}{5}(1+\\xi) - \\frac{1}{5}(1-\\xi)] = \\frac{1}{20}[1+\\xi - 1+\\xi] = \\frac{2\\xi}{20} = \\frac{1}{10}\\xi$\n\n$\\frac{\\partial y}{\\partial \\xi} = \\frac{1}{4}[-y_1(1-\\eta) + y_2(1-\\eta) + y_3(1+\\eta) - y_4(1+\\eta)]$\n$= \\frac{1}{4}[0 + \\frac{3}{10}(1-\\eta) + \\frac{9}{5}(1+\\eta) - \\frac{3}{2}(1+\\eta)] = \\frac{1}{4}[\\frac{3}{10} - \\frac{3}{10}\\eta + (\\frac{9}{5} - \\frac{3}{2})(1+\\eta)]$\n$= \\frac{1}{4}[\\frac{3}{10} - \\frac{3}{10}\\eta + \\frac{3}{10}(1+\\eta)] = \\frac{1}{4}[\\frac{3}{10} - \\frac{3}{10}\\eta + \\frac{3}{10} + \\frac{3}{10}\\eta] = \\frac{1}{4}(\\frac{6}{10}) = \\frac{3}{20}$\n\n$\\frac{\\partial y}{\\partial \\eta} = \\frac{1}{4}[-y_1(1-\\xi) - y_2(1+\\xi) + y_3(1+\\xi) + y_4(1-\\xi)]$\n$= \\frac{1}{4}[0 - \\frac{3}{10}(1+\\xi) + \\frac{9}{5}(1+\\xi) + \\frac{3}{2}(1-\\xi)] = \\frac{1}{4}[(-\\frac{3}{10} + \\frac{18}{10})(1+\\xi) + \\frac{3}{2}(1-\\xi)]$\n$= \\frac{1}{4}[\\frac{15}{10}(1+\\xi) + \\frac{3}{2}(1-\\xi)] = \\frac{1}{4}[\\frac{3}{2}(1+\\xi) + \\frac{3}{2}(1-\\xi)] = \\frac{1}{4}\\frac{3}{2}[1+\\xi+1-\\xi] = \\frac{3}{8}(2) = \\frac{3}{4}$\n\nThe Jacobian matrix is thus:\n$$J(\\xi, \\eta) = \\begin{pmatrix} \\frac{11}{10} + \\frac{1}{10}\\eta & \\frac{1}{10}\\xi \\\\ \\frac{3}{20} & \\frac{3}{4} \\end{pmatrix}$$\nThe determinant of the Jacobian, $|J|$, is:\n$$|J(\\xi, \\eta)| = \\det(J) = \\left(\\frac{11}{10} + \\frac{1}{10}\\eta\\right)\\left(\\frac{3}{4}\\right) - \\left(\\frac{1}{10}\\xi\\right)\\left(\\frac{3}{20}\\right)$$\n$$|J(\\xi, \\eta)| = \\frac{33}{40} + \\frac{3}{40}\\eta - \\frac{3}{200}\\xi$$\nA valid mapping requires $|J| > 0$ throughout the element. We check this condition at the four Gauss-Legendre Quadrature (GLQ) points $(\\xi, \\eta) = (\\pm 1/\\sqrt{3}, \\pm 1/\\sqrt{3})$. Let $a = 1/\\sqrt{3}$. The four points are $(a, a)$, $(-a, a)$, $(-a, -a)$, and $(a, -a)$.\n\n1.  At $(\\xi, \\eta) = (\\frac{1}{\\sqrt{3}}, \\frac{1}{\\sqrt{3}})$:\n    $|J_1| = \\frac{33}{40} + \\frac{3}{40}\\frac{1}{\\sqrt{3}} - \\frac{3}{200}\\frac{1}{\\sqrt{3}} = \\frac{33}{40} + \\frac{1}{\\sqrt{3}}(\\frac{15}{200} - \\frac{3}{200}) = \\frac{33}{40} + \\frac{12}{200\\sqrt{3}}$\n\n2.  At $(\\xi, \\eta) = (-\\frac{1}{\\sqrt{3}}, \\frac{1}{\\sqrt{3}})$:\n    $|J_2| = \\frac{33}{40} + \\frac{3}{40}\\frac{1}{\\sqrt{3}} - \\frac{3}{200}(-\\frac{1}{\\sqrt{3}}) = \\frac{33}{40} + \\frac{1}{\\sqrt{3}}(\\frac{15}{200} + \\frac{3}{200}) = \\frac{33}{40} + \\frac{18}{200\\sqrt{3}}$\n\n3.  At $(\\xi, \\eta) = (-\\frac{1}{\\sqrt{3}}, -\\frac{1}{\\sqrt{3}})$:\n    $|J_3| = \\frac{33}{40} + \\frac{3}{40}(-\\frac{1}{\\sqrt{3}}) - \\frac{3}{200}(-\\frac{1}{\\sqrt{3}}) = \\frac{33}{40} + \\frac{1}{\\sqrt{3}}(-\\frac{15}{200} + \\frac{3}{200}) = \\frac{33}{40} - \\frac{12}{200\\sqrt{3}}$\n\n4.  At $(\\xi, \\eta) = (\\frac{1}{\\sqrt{3}}, -\\frac{1}{\\sqrt{3}})$:\n    $|J_4| = \\frac{33}{40} + \\frac{3}{40}(-\\frac{1}{\\sqrt{3}}) - \\frac{3}{200}\\frac{1}{\\sqrt{3}} = \\frac{33}{40} - \\frac{1}{\\sqrt{3}}(\\frac{15}{200} + \\frac{3}{200}) = \\frac{33}{40} - \\frac{18}{200\\sqrt{3}}$\n\nThe constant term $\\frac{33}{40}$ is positive and significantly larger than the variable terms. For instance, $\\frac{18}{200\\sqrt{3}} = \\frac{9}{100\\sqrt{3}} \\approx \\frac{9}{173.2} \\approx 0.052$, while $\\frac{33}{40} = 0.825$. All four Jacobian determinant values are positive, so the mapping is valid at all GLQ points.\n\nTo find the minimum value among these four, we compare them. Since $\\frac{18}{200\\sqrt{3}}$ is a positive quantity, the minimum value is $|J_4|$.\n$|J|_{min} = \\frac{33}{40} - \\frac{18}{200\\sqrt{3}} = \\frac{33}{40} - \\frac{9}{100\\sqrt{3}}$.\nTo express this as a single fraction with a rational denominator, we first rationalize the second term:\n$\\frac{9}{100\\sqrt{3}} = \\frac{9\\sqrt{3}}{100 \\cdot 3} = \\frac{3\\sqrt{3}}{100}$.\nSo, $|J|_{min} = \\frac{33}{40} - \\frac{3\\sqrt{3}}{100}$.\nFinding a common denominator of $200$:\n$|J|_{min} = \\frac{33 \\cdot 5}{200} - \\frac{3\\sqrt{3} \\cdot 2}{200} = \\frac{165}{200} - \\frac{6\\sqrt{3}}{200} = \\frac{165 - 6\\sqrt{3}}{200}$.\nThis is the final exact analytic value for the minimum of the Jacobian determinant at the specified GLQ points.",
            "answer": "$$\\boxed{\\frac{165 - 6\\sqrt{3}}{200}}$$"
        },
        {
            "introduction": "Building on the concept of element mapping, we now explore a critical practical issue: how does element shape affect numerical stability? While an element might have a valid mapping, severe distortion can lead to a poorly conditioned stiffness matrix, jeopardizing the accuracy of the solution. This computational exercise  directly investigates this relationship by tasking you to calculate the condition number for a series of increasingly skewed elements, revealing the tangible price of poor mesh quality.",
            "id": "3728939",
            "problem": "Consider the scalar diffusion problem in two dimensions defined by the partial differential equation $-\\nabla \\cdot (\\kappa \\nabla u) = f$ on a domain $\\Omega \\subset \\mathbb{R}^2$ with homogeneous Dirichlet boundary conditions on a portion of the boundary. Use the standard Galerkin finite element method with bilinear quadrilateral elements (also called $Q_4$ elements) in an isoparametric formulation. Assume constant scalar conductivity $\\kappa = 1$.\n\nYou are to analyze how geometric distortion of a single $Q_4$ element affects the conditioning of its stiffness matrix. Start from the energy principle for diffusion, which states that the weak form arises from the stationary point of the functional $E(u) = \\int_{\\Omega} \\kappa \\nabla u \\cdot \\nabla u \\, d\\Omega - \\int_{\\Omega} fv \\, d\\Omega$ under admissible variations. Derive the discrete form using bilinear shape functions defined over the reference square element with natural coordinates $(\\xi,\\eta) \\in [-1, 1] \\times [-1, 1]$, and map to the physical element via isoparametric interpolation. The stiffness matrix for a single element is given by the integral $K_{ij} = \\int_{\\Omega_e} \\kappa \\, \\nabla N_i \\cdot \\nabla N_j \\, d\\Omega$, where $N_i$ are the bilinear shape functions. Evaluate this integral numerically using tensor-product Gaussian quadrature with $2\\times 2$ points, and compute gradients via the chain rule using the Jacobian matrix of the isoparametric mapping.\n\nTo prevent the known nullspace associated with the partition of unity of shape functions (which makes the element-level stiffness matrix singular), impose a homogeneous Dirichlet boundary condition at node $1$ by eliminating the corresponding degree of freedom. That is, form the reduced stiffness matrix by removing the row and column associated with node $1$.\n\nDefine a family of increasingly skewed quadrilateral elements by fixing three nodes and moving the top-right node horizontally by a skew parameter $d$. Specifically, set nodal coordinates\n- $x_1 = 0$, $y_1 = 0$,\n- $x_2 = 1$, $y_2 = 0$,\n- $x_3 = 1 + d$, $y_3 = 1$,\n- $x_4 = 0$, $y_4 = 1$.\nFor each given $d$, compute the reduced element stiffness matrix $K_{\\text{red}}$ via $2\\times 2$ Gaussian quadrature on the reference square, and then compute its spectral condition number defined as $\\kappa_2(K_{\\text{red}}) = \\|K_{\\text{red}}\\|_2 \\cdot \\|K_{\\text{red}}^{-1}\\|_2$. If the mapping becomes invalid at any quadrature point (that is, if the determinant of the Jacobian $\\det J$ is nonpositive or smaller than a small tolerance indicating near-degeneracy), treat the stiffness matrix as singular and return the condition number as $\\infty$.\n\nYour program must implement the following steps for each test case:\n- Construct $K$ by numerical quadrature using bilinear shape functions on the reference element and the isoparametric mapping to the physical element with the specified nodal coordinates.\n- Apply the homogeneous Dirichlet boundary condition at node $1$ by removing the corresponding row and column to obtain $K_{\\text{red}}$.\n- Compute the spectral condition number $\\kappa_2(K_{\\text{red}})$; if the matrix is singular or the mapping is invalid based on the Jacobian determinant check, output $\\infty$ for that case.\n\nUse the following test suite of skew parameters:\n- $d = 0.0$ (baseline square element),\n- $d = 0.3$ (moderate skew),\n- $d = 0.6$ (high skew),\n- $d = 0.9$ (very high skew),\n- $d = -0.8$ (negative skew near degeneracy but still convex).\n\nAll calculations are strictly dimensionless in this setup. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[r_1,r_2,r_3,r_4,r_5]$), where each $r_i$ is the condition number for the corresponding $d$ value, rounded to six decimal places. If a case is deemed singular or invalid based on the Jacobian determinant criterion, print the literal infinity as produced by the programming language for floating-point values in place of the number (for example, $[\\infty, \\dots]$).",
            "solution": "The user-provided problem requires an analysis of the effect of geometric distortion on the conditioning of the finite element stiffness matrix for a 2D scalar diffusion problem. The problem is well-posed, scientifically sound, and provides all necessary data for a unique solution. We will proceed with a full derivation and implementation.\n\n### 1. Weak Form and Galerkin Discretization\n\nThe governing partial differential equation is the stationary point of the energy functional:\n$$\nE(u) = \\frac{1}{2} \\int_{\\Omega} \\kappa (\\nabla u \\cdot \\nabla u) \\, d\\Omega - \\int_{\\Omega} f u \\, d\\Omega\n$$\nThe weak form is found by taking the first variation of $E(u)$ with respect to a test function $v$ and setting it to zero:\n$$\n\\delta E = \\int_{\\Omega} \\kappa (\\nabla u \\cdot \\nabla v) \\, d\\Omega - \\int_{\\Omega} f v \\, d\\Omega = 0\n$$\nIn the Galerkin method, we approximate the solution $u(x,y)$ over the domain by a linear combination of basis functions $N_i(x,y)$:\n$$\nu(x,y) \\approx u_h(x,y) = \\sum_{j=1}^{n} u_j N_j(x,y)\n$$\nwhere $u_j$ are the unknown coefficients (nodal values) and $n$ is the number of nodes in the element. The test functions $v$ are chosen from the same space as the basis functions, i.e., $v = N_i(x,y)$. Substituting this into the weak form for a single element domain $\\Omega_e$ yields the element-level system of equations:\n$$\n\\sum_{j=1}^{n} \\left( \\int_{\\Omega_e} \\kappa \\nabla N_i \\cdot \\nabla N_j \\, d\\Omega \\right) u_j = \\int_{\\Omega_e} f N_i \\, d\\Omega\n$$\nThis is of the form $K^e \\mathbf{u} = \\mathbf{f}^e$, where the element stiffness matrix $K^e$ has entries:\n$$\nK_{ij}^e = \\int_{\\Omega_e} \\kappa \\nabla N_i \\cdot \\nabla N_j \\, d\\Omega\n$$\nFor this problem, the conductivity $\\kappa$ is a constant set to $1$.\n\n### 2. Isoparametric Bilinear Element\n\nWe use a $Q_4$ element, which is a quadrilateral with four nodes. The formulation is isoparametric, meaning the same basis functions are used to interpolate both the geometry and the solution field.\n\n**Reference Element:**\nThe calculations are performed on a reference square element defined in a natural coordinate system $(\\xi, \\eta)$, where $\\xi, \\eta \\in [-1, 1]$. The four nodes are at $(\\pm 1, \\pm 1)$. The bilinear shape functions are:\n\\begin{align*}\nN_1(\\xi, \\eta) &= \\frac{1}{4}(1-\\xi)(1-\\eta) \\\\\nN_2(\\xi, \\eta) &= \\frac{1}{4}(1+\\xi)(1-\\eta) \\\\\nN_3(\\xi, \\eta) &= \\frac{1}{4}(1+\\xi)(1+\\eta) \\\\\nN_4(\\xi, \\eta) &= \\frac{1}{4}(1-\\xi)(1+\\eta)\n\\end{align*}\n\n**Coordinate Mapping:**\nThe physical coordinates $(x,y)$ of any point within the element are mapped from the natural coordinates $(\\xi, \\eta)$ using the nodal coordinates $(x_i, y_i)$:\n$$\nx(\\xi, \\eta) = \\sum_{i=1}^{4} x_i N_i(\\xi, \\eta) \\quad \\text{and} \\quad y(\\xi, \\eta) = \\sum_{i=1}^{4} y_i N_i(\\xi, \\eta)\n$$\n\n**Gradient Transformation:**\nTo evaluate the stiffness matrix, we need the gradients of the shape functions with respect to the physical coordinates $(x,y)$. These are obtained from the gradients with respect to the natural coordinates $(\\xi, \\eta)$ using the chain rule:\n$$\n\\begin{pmatrix} \\frac{\\partial N_i}{\\partial \\xi} \\\\ \\frac{\\partial N_i}{\\partial \\eta} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{pmatrix} = J^T \\begin{pmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{pmatrix}\n$$\nwhere $J$ is the Jacobian matrix of the transformation. Inverting this relationship gives the physical gradients:\n$$\n\\nabla_{x,y} N_i = \\begin{pmatrix} \\frac{\\partial N_i}{\\partial x} \\\\ \\frac{\\partial N_i}{\\partial y} \\end{pmatrix} = (J^T)^{-1} \\begin{pmatrix} \\frac{\\partial N_i}{\\partial \\xi} \\\\ \\frac{\\partial N_i}{\\partial \\eta} \\end{pmatrix} = (J^T)^{-1} \\nabla_{\\xi, \\eta} N_i\n$$\nNote: A common convention is to define the Jacobian matrix as $J_{ij} = \\partial x_i / \\partial \\xi_j$. This results in the transformation $\\nabla_{x,y} N_i = J^{-1} \\nabla_{\\xi, \\eta} N_i$. The solution code uses this standard definition.\n\n### 3. Stiffness Matrix Calculation and Numerical Quadrature\n\nThe integral for the stiffness matrix must be transformed to the reference coordinate system. The differential area element transforms as $d\\Omega = dx\\,dy = \\det(J) \\, d\\xi\\, d\\eta$. The stiffness matrix entry becomes:\n$$\nK_{ij}^e = \\int_{-1}^{1} \\int_{-1}^{1} \\kappa \\left( \\nabla_{x,y} N_i \\cdot \\nabla_{x,y} N_j \\right) \\det(J) \\, d\\xi \\, d\\eta\n$$\nThe dot product can be written as $(\\nabla_{x,y} N_i)^T (\\nabla_{x,y} N_j)$. The integral is generally too complex to be evaluated analytically for a distorted element and is thus approximated using numerical quadrature. The problem specifies a $2 \\times 2$ tensor-product Gaussian quadrature scheme. The integral is approximated as a weighted sum of the integrand evaluated at specific Gauss points $(\\xi_k, \\eta_k)$:\n$$\nK_{ij}^e \\approx \\sum_{k=1}^{4} w_k \\kappa \\left[ (\\nabla_{x,y} N_i)^T (\\nabla_{x,y} N_j) \\det(J) \\right]_{(\\xi_k, \\eta_k)}\n$$\nFor a $2 \\times 2$ scheme, the four Gauss points are $(\\pm a, \\pm a)$ where $a=1/\\sqrt{3}$, and all weights $w_k$ are equal to $1$.\n\nThe geometric validity of the mapping depends on the sign of the Jacobian determinant, $\\det(J)$. If $\\det(J) \\le 0$ at any point inside the element, the mapping is degenerate or orientation-reversed, rendering the element invalid. We check this condition at each Gauss point.\n\n### 4. Boundary Conditions, Matrix Reduction, and Conditioning\n\nThe element stiffness matrix $K^e$ is always singular for a diffusion problem because it has a nullspace corresponding to a constant potential (i.e., $K^e \\mathbf{c} = 0$ if $\\mathbf{c}$ is a vector of ones). To obtain a solvable system, boundary conditions must be applied. The problem prescribes a homogeneous Dirichlet condition at node $1$ ($u_1 = 0$). This is implemented by eliminating the first row and first column of the $4 \\times 4$ matrix $K^e$ to form a $3 \\times 3$ reduced stiffness matrix, $K_{\\text{red}}$.\n\nFor a non-degenerate element, $K_{\\text{red}}$ is symmetric and positive definite, and thus invertible. The conditioning of this matrix is a measure of its sensitivity to perturbations. We use the spectral condition number, $\\kappa_2(A)$, defined as:\n$$\n\\kappa_2(K_{\\text{red}}) = \\|K_{\\text{red}}\\|_2 \\cdot \\|K_{\\text{red}}^{-1}\\|_2 = \\frac{\\sigma_{\\max}(K_{\\text{red}})}{\\sigma_{\\min}(K_{\\text{red}})}\n$$\nwhere $\\sigma$ denotes the singular values of the matrix. For a symmetric positive definite matrix, this is the ratio of the largest to the smallest eigenvalue. A high condition number indicates that the element is poorly shaped, which can lead to large numerical errors in a full FEM simulation.\n\nThe algorithm for each skew parameter $d$ is:\n1.  Define the physical nodal coordinates based on $d$.\n2.  Initialize a $4 \\times 4$ element stiffness matrix $K^e$ to zeros.\n3.  Loop through the four $2 \\times 2$ Gauss points $(\\xi_k, \\eta_k)$:\n    a.  Evaluate the derivatives of the shape functions, $\\nabla_{\\xi, \\eta} N_i$, at the current Gauss point.\n    b.  Compute the Jacobian matrix $J$ and its determinant $\\det(J)$.\n    c.  If $\\det(J)$ is non-positive (or below a small tolerance), mark the element as invalid and terminate the calculation for this $d$.\n    d.  Compute the physical gradients $\\nabla_{x,y} N_i = J^{-1} \\nabla_{\\xi, \\eta} N_i$.\n    e.  Calculate the contribution to the stiffness matrix at this point and add it to $K^e$.\n4.  If the element is valid, form the $3 \\times 3$ reduced matrix $K_{\\text{red}}$ by removing the first row and column from $K^e$.\n5.  Compute and store the spectral condition number $\\kappa_2(K_{\\text{red}})$. If the element was marked invalid, store $\\infty$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_condition_number(d: float) -> float:\n    \"\"\"\n    Computes the spectral condition number of the reduced stiffness matrix\n    for a single bilinear quadrilateral element with a given skew parameter d.\n\n    Args:\n        d: The horizontal skew parameter for the top-right node.\n\n    Returns:\n        The spectral condition number, or numpy.inf if the element mapping is invalid.\n    \"\"\"\n    # 1. Define nodal coordinates for the physical element\n    nodes = np.array([\n        [0.0, 0.0],          # Node 1\n        [1.0, 0.0],          # Node 2\n        [1.0 + d, 1.0],      # Node 3\n        [0.0, 1.0]           # Node 4\n    ])\n\n    # 2. Define 2x2 Gaussian quadrature points and weights\n    a = 1.0 / np.sqrt(3.0)\n    gauss_points = [(-a, -a), (a, -a), (a, a), (-a, a)]\n    gauss_weights = [1.0, 1.0, 1.0, 1.0]\n\n    # 3. Initialize the 4x4 element stiffness matrix\n    K_e = np.zeros((4, 4))\n    kappa = 1.0  # Constant scalar conductivity\n\n    # 4. Loop over Gauss points to assemble the stiffness matrix\n    for i in range(len(gauss_points)):\n        xi, eta = gauss_points[i]\n        weight = gauss_weights[i]\n\n        # Derivatives of bilinear shape functions w.r.t. natural coordinates (xi, eta)\n        # dN/dxi at the current Gauss point\n        dN_dxi = 0.25 * np.array([-(1.0 - eta), (1.0 - eta), (1.0 + eta), -(1.0 + eta)])\n        # dN/deta at the current Gauss point\n        dN_deta = 0.25 * np.array([-(1.0 - xi), -(1.0 + xi), (1.0 + xi), (1.0 - xi)])\n\n        # Matrix of shape function gradients in reference coordinates (4x2)\n        grad_N_ref = np.vstack((dN_dxi, dN_deta)).T\n\n        # Jacobian matrix of the isoparametric mapping\n        # J = nodes.T @ grad_N_ref. This is J_ij = dx_i/d_xi_j\n        J = nodes.T @ grad_N_ref\n        J = J.T\n\n        # Determinant of the Jacobian\n        detJ = np.linalg.det(J)\n\n        # Check for invalid mapping (non-positive or near-zero determinant)\n        if detJ <= 1e-12:\n            return np.inf\n\n        # Inverse of the Jacobian\n        invJ = np.linalg.inv(J)\n\n        # Gradients of shape functions in physical coordinates (x, y)\n        # grad_N_phys = grad_N_ref @ invJ  ( (4x2) @ (2x2) -> (4x2) )\n        grad_N_phys = grad_N_ref @ invJ\n\n        # Add contribution to the stiffness matrix\n        # The term (grad_N_phys @ grad_N_phys.T) is a 4x4 matrix\n        # where the (i, j) entry is (nabla N_i) . (nabla N_j)\n        K_e += kappa * (grad_N_phys @ grad_N_phys.T) * detJ * weight\n    \n    # 5. Apply homogeneous Dirichlet BC at node 1 by creating the reduced matrix\n    K_red = K_e[1:, 1:]\n\n    # 6. Compute and return the spectral condition number (p=2) of the reduced matrix\n    cond_num = np.linalg.cond(K_red, p=2)\n\n    return cond_num\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for the specified test cases and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        0.0,   # Baseline square element\n        0.3,   # Moderate skew\n        0.6,   # High skew\n        0.9,   # Very high skew\n        -0.8   # Negative skew near degeneracy\n    ]\n\n    results = []\n    for d in test_cases:\n        result = compute_condition_number(d)\n        results.append(result)\n\n    # Format the results for printing\n    results_str = []\n    for r in results:\n        if r == np.inf:\n            results_str.append(\"inf\")\n        else:\n            # Round to six decimal places\n            results_str.append(f\"{r:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}