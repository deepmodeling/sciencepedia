{
    "hands_on_practices": [
        {
            "introduction": "Our first practice delves into the foundational technique of homogenization, a cornerstone of multiscale analysis. This exercise challenges you to derive an effective (macroscopic) model for heat conduction through a material with rapidly oscillating properties, starting from first principles . Mastering this process of applying two-scale asymptotic analysis to formulate a well-posed effective boundary value problem is essential for modeling complex, heterogeneous systems.",
            "id": "3738062",
            "problem": "Consider steady heat conduction in one spatial dimension through a medium with rapidly oscillating but strictly positive thermal conductivity. Let the spatial domain be the interval $\\left(0,L\\right)$ with $L>0$, and let the small parameter be $\\varepsilon>0$. The microscopic temperature field $u^{\\varepsilon}(x)$ satisfies the conservation of energy and Fourier’s law in the form of the partial differential equation\n$$\n-\\frac{d}{dx}\\left(k\\!\\left(\\frac{x}{\\varepsilon}\\right)\\frac{du^{\\varepsilon}}{dx}(x)\\right)=0\\quad\\text{for }x\\in(0,L),\n$$\nwhere the conductivity is given by the $1$-periodic function\n$$\nk(y)=k_0\\left(1+\\alpha\\cos(2\\pi y)\\right),\n$$\nwith constants $k_0>0$ and $\\alpha\\in(-1,1)$. Impose mixed boundary conditions: a Dirichlet boundary condition at the left end $u^{\\varepsilon}(0)=U_0$ with prescribed temperature $U_0\\in\\mathbb{R}$, and a Neumann boundary condition at the right end stating that the outward heat flux is prescribed as $Q\\in\\mathbb{R}$:\n$$\n-k\\!\\left(\\frac{L}{\\varepsilon}\\right)\\frac{du^{\\varepsilon}}{dx}(L)=Q.\n$$\n\nUsing a rigorous multiscale formulation based on conservation of energy and Fourier’s law as fundamental starting points, and the standard periodic cell problem with periodic boundary conditions on the unit cell and a zero-mean corrector, derive the homogenized (effective) model and compute the effective (homogenized) endpoint temperature $u^0(L)$ in closed form in terms of $U_0$, $L$, $Q$, $k_0$, and $\\alpha$. You must explicitly formulate the cell problem and enforce the periodic boundary condition at the microscale in your derivation.\n\nYour final answer must be a single closed-form analytic expression for $u^0(L)$, with no numerical evaluation and no rounding. Do not include units in your final expression. Ensure all assumptions are scientifically consistent throughout your derivation.",
            "solution": "The problem requires the derivation of the homogenized model for one-dimensional steady heat conduction and the computation of the effective temperature at one endpoint. The methodology employed will be a formal two-scale asymptotic expansion.\n\nWe begin by positing a two-scale asymptotic expansion for the temperature field $u^{\\varepsilon}(x)$ in powers of the small parameter $\\varepsilon$:\n$$u^{\\varepsilon}(x) = u^0(x, y) + \\varepsilon u^1(x, y) + \\varepsilon^2 u^2(x, y) + \\dots$$\nHere, $x$ is the macroscopic (slow) variable, and $y = x/\\varepsilon$ is the microscopic (fast) variable. The functions $u^i(x,y)$ for $i \\ge 0$ are assumed to be $1$-periodic with respect to the fast variable $y$.\n\nThe spatial derivative transforms under this two-scale representation according to the chain rule:\n$$\\frac{d}{dx} = \\frac{\\partial}{\\partial x} + \\frac{1}{\\varepsilon}\\frac{\\partial}{\\partial y}$$\nApplying this to the expansion for $u^{\\varepsilon}(x)$ gives the derivative:\n$$\\frac{du^{\\varepsilon}}{dx} = \\frac{1}{\\varepsilon}\\frac{\\partial u^0}{\\partial y} + \\left(\\frac{\\partial u^0}{\\partial x} + \\frac{\\partial u^1}{\\partial y}\\right) + \\varepsilon\\left(\\frac{\\partial u^1}{\\partial x} + \\frac{\\partial u^2}{\\partial y}\\right) + \\dots$$\nThe governing equation is $-\\frac{d}{dx}\\left(k(y)\\frac{du^{\\varepsilon}}{dx}\\right) = 0$. Substituting the expansion and the transformed derivative operator, we obtain:\n$$-\\left(\\frac{\\partial}{\\partial x} + \\frac{1}{\\varepsilon}\\frac{\\partial}{\\partial y}\\right)\\left[k(y)\\left(\\frac{1}{\\varepsilon}\\frac{\\partial u^0}{\\partial y} + \\left(\\frac{\\partial u^0}{\\partial x} + \\frac{\\partial u^1}{\\partial y}\\right) + \\varepsilon\\left(\\frac{\\partial u^1}{\\partial x} + \\frac{\\partial u^2}{\\partial y}\\right) + \\dots\\right)\\right] = 0$$\nWe expand this expression and collect terms of like powers in $\\varepsilon$.\n\nAt order $\\mathcal{O}(\\varepsilon^{-2})$, we have:\n$$-\\frac{\\partial}{\\partial y}\\left(k(y)\\frac{\\partial u^0}{\\partial y}\\right) = 0$$\nIntegrating with respect to $y$ yields $k(y)\\frac{\\partial u^0}{\\partial y} = C_1(x)$. Since $k(y)$ is strictly positive, $\\frac{\\partial u^0}{\\partial y} = \\frac{C_1(x)}{k(y)}$. A second integration gives $u^0(x,y) = C_1(x)\\int \\frac{dy}{k(y)} + C_2(x)$. The function $u^0$ must be periodic in $y$. Since $\\int_0^1 \\frac{dy}{k(y)} > 0$, periodicity requires that the coefficient of the secular growth term be zero, i.e., $C_1(x) = 0$. This implies $\\frac{\\partial u^0}{\\partial y} = 0$, and thus the leading-order temperature $u^0$ is a function of the macroscopic variable $x$ only, $u^0 = u^0(x)$.\n\nAt order $\\mathcal{O}(\\varepsilon^{-1})$, we collect the terms:\n$$-\\frac{\\partial}{\\partial y}\\left(k(y)\\left(\\frac{du^0}{dx} + \\frac{\\partial u^1}{\\partial y}\\right)\\right) - \\frac{\\partial}{\\partial x}\\left(k(y)\\frac{\\partial u^0}{\\partial y}\\right) = 0$$\nSince $u^0 = u^0(x)$, the second term vanishes. The equation simplifies to:\n$$-\\frac{\\partial}{\\partial y}\\left(k(y)\\frac{\\partial u^1}{\\partial y}\\right) = \\frac{\\partial}{\\partial y}\\left(k(y)\\frac{du^0}{dx}\\right)$$\nWe seek a solution for the first-order corrector $u^1(x,y)$ using separation of variables, $u^1(x,y) = \\chi(y)\\frac{du^0}{dx}(x)$, where $\\chi(y)$ is the corrector function which must be $1$-periodic and have a zero mean as prescribed, $\\int_0^1 \\chi(y)dy = 0$. Substituting this ansatz into the equation and dividing by $\\frac{du^0}{dx}$ (assuming it is not identically zero) yields the cell problem for $\\chi(y)$ on the unit cell $Y=\\left[0,1\\right]$:\n$$-\\frac{d}{dy}\\left(k(y)\\frac{d\\chi}{dy}\\right) = \\frac{dk}{dy}(y)$$\nwith $\\chi(y)$ being $1$-periodic. Integrating once gives $-k(y)\\frac{d\\chi}{dy} = k(y) + C$, where $C$ is an integration constant. Thus, $\\frac{d\\chi}{dy} = -1 - \\frac{C}{k(y)}$. To find $C$, we integrate $\\frac{d\\chi}{dy}$ over the unit cell: $\\int_0^1 \\frac{d\\chi}{dy}dy = \\chi(1)-\\chi(0)=0$ due to periodicity. This gives $0 = \\int_0^1 \\left(-1 - \\frac{C}{k(y)}\\right)dy = -1 - C\\int_0^1 \\frac{dy}{k(y)}$. Solving for $C$ yields $C = -(\\int_0^1 \\frac{dy}{k(y)})^{-1}$.\n\nAt order $\\mathcal{O}(\\varepsilon^{0})$, the equation is:\n$$-\\frac{\\partial}{\\partial x}\\left(k(y)\\left(\\frac{du^0}{dx} + \\frac{\\partial u^1}{\\partial y}\\right)\\right) - \\frac{\\partial}{\\partial y}\\left(k(y)\\left(\\frac{\\partial u^1}{\\partial x} + \\frac{\\partial u^2}{\\partial y}\\right)\\right) = 0$$\nTo find the macroscopic (homogenized) equation for $u^0(x)$, we average this equation over the unit cell $Y$. The integral of the second term over $Y$ vanishes due to periodicity: $\\int_0^1 \\frac{\\partial}{\\partial y}(\\dots)dy = [(\\dots)]_0^1 = 0$. We are left with:\n$$\\int_0^1 -\\frac{\\partial}{\\partial x}\\left(k(y)\\left(\\frac{du^0}{dx} + \\frac{\\partial u^1}{\\partial y}\\right)\\right) dy = 0$$\nInterchanging integration and differentiation and substituting $\\frac{\\partial u^1}{\\partial y} = \\frac{d\\chi}{dy}\\frac{du^0}{dx}$, we get:\n$$-\\frac{d}{dx}\\left[\\left(\\int_0^1 k(y)\\left(1 + \\frac{d\\chi}{dy}\\right) dy\\right) \\frac{du^0}{dx}(x)\\right] = 0$$\nThis is the homogenized equation, $-\\frac{d}{dx}\\left(k^*\\frac{du^0}{dx}\\right)=0$, where the effective conductivity $k^*$ is defined as:\n$$k^* = \\int_0^1 k(y)\\left(1 + \\frac{d\\chi}{dy}\\right)dy$$\nSubstituting $\\frac{d\\chi}{dy} = -1 + \\frac{1}{k(y)}\\left(\\int_0^1 \\frac{d\\xi}{k(\\xi)}\\right)^{-1}$:\n$$k^* = \\int_0^1 k(y)\\left(1 - 1 + \\frac{1}{k(y)}\\left(\\int_0^1 \\frac{d\\xi}{k(\\xi)}\\right)^{-1}\\right)dy = \\int_0^1 \\left(\\int_0^1 \\frac{d\\xi}{k(\\xi)}\\right)^{-1} dy = \\left(\\int_0^1 \\frac{dy}{k(y)}\\right)^{-1}$$\nThe effective conductivity is the harmonic average of the microscopic conductivity. We now compute this value.\n$$k(y) = k_0\\left(1+\\alpha\\cos(2\\pi y)\\right)$$\nThe integral required is $\\int_0^1 \\frac{dy}{k(y)} = \\frac{1}{k_0}\\int_0^1 \\frac{dy}{1+\\alpha\\cos(2\\pi y)}$. Using the standard integral result $\\int_0^{2\\pi} \\frac{d\\theta}{a+b\\cos\\theta} = \\frac{2\\pi}{\\sqrt{a^2-b^2}}$ for $a>|b|$, we let $\\theta=2\\pi y$:\n$$\\int_0^1 \\frac{dy}{1+\\alpha\\cos(2\\pi y)} = \\frac{1}{2\\pi}\\int_0^{2\\pi} \\frac{d\\theta}{1+\\alpha\\cos\\theta} = \\frac{1}{2\\pi}\\frac{2\\pi}{\\sqrt{1^2-\\alpha^2}} = \\frac{1}{\\sqrt{1-\\alpha^2}}$$\nThus, $\\int_0^1 \\frac{dy}{k(y)} = \\frac{1}{k_0\\sqrt{1-\\alpha^2}}$. The effective conductivity is:\n$$k^* = \\left(\\frac{1}{k_0\\sqrt{1-\\alpha^2}}\\right)^{-1} = k_0\\sqrt{1-\\alpha^2}$$\nThe homogenized equation is $-k^*\\frac{d^2u^0}{dx^2}=0$, which has the general solution $u^0(x) = C_1 x + C_2$.\n\nNext, we establish the boundary conditions for the homogenized problem.\nAt $x=0$, the Dirichlet condition $u^{\\varepsilon}(0)=U_0$ implies $u^0(0) = U_0$ in the limit $\\varepsilon \\to 0$.\nAt $x=L$, the Neumann condition specifies the heat flux $j^{\\varepsilon} = -k(y)\\frac{du^{\\varepsilon}}{dx}$. The homogenized flux $j^0$ is the average of the leading-order part of the microscopic flux:\n$$j^0(x) = \\left\\langle -k(y)\\left(\\frac{du^0}{dx} + \\frac{\\partial u^1}{\\partial y}\\right)\\right\\rangle_y = -k^*\\frac{du^0}{dx}(x)$$\nThe boundary condition at $x=L$ is $j^{\\varepsilon}(L)=Q$. In the limit, this becomes $j^0(L)=Q$, which translates to $-k^*\\frac{du^0}{dx}(L) = Q$.\n\nWe solve the boundary value problem for $u^0(x)$:\n$$u^0(x) = C_1 x + C_2$$\n$u^0(0) = U_0 \\implies C_2 = U_0$.\n$-k^*\\frac{du^0}{dx}(L) = -k^* C_1 = Q \\implies C_1 = -\\frac{Q}{k^*} = -\\frac{Q}{k_0\\sqrt{1-\\alpha^2}}$.\nThe homogenized temperature field is:\n$$u^0(x) = U_0 - \\frac{Q}{k_0\\sqrt{1-\\alpha^2}}x$$\nFinally, we evaluate this expression at $x=L$ to find the effective endpoint temperature:\n$$u^0(L) = U_0 - \\frac{QL}{k_0\\sqrt{1-\\alpha^2}}$$\nThis is the closed-form solution for the homogenized temperature at the right boundary.",
            "answer": "$$\\boxed{U_0 - \\frac{QL}{k_0\\sqrt{1-\\alpha^2}}}$$"
        },
        {
            "introduction": "We now transition from analytical derivations to the critical task of formulating valid initial conditions for complex computational models. This practice focuses on a fundamental constraint in magnetohydrodynamics (MHD), the solenoidal condition $\\nabla \\cdot \\mathbf{B} = 0$, which is a direct consequence of Maxwell's equations . You will analyze and justify the methods used to ensure that initial data for numerical simulations are physically consistent, a non-negotiable step for achieving stable and accurate results.",
            "id": "3996400",
            "problem": "A resistive Magnetohydrodynamics (MHD) code is being prepared to simulate the evolution of the magnetic field in a toroidal plasma confined by external coils. The computational domain is the plasma region bounded by a vacuum–conducting wall interface where the normal magnetic flux $B\\cdot n$ is prescribed by the coil configuration. The governing electromagnetic laws for the magnetic field are Maxwell–Faraday’s law and Gauss’s law for magnetism. The initial value and boundary value problem requires specifying an initial magnetic field $B(x,0)$ and boundary data consistent with the physics.\n\nWhich of the following statements correctly justify the requirement on $B(x,0)$ and describe valid methods to enforce that requirement in the initialization of numerical simulations? Select all that apply.\n\nA. Gauss’s law for magnetism imposes $\\nabla\\cdot B=0$ as a physical constraint (no magnetic monopoles). Combined with Maxwell–Faraday’s law, this implies that if $\\nabla\\cdot B=0$ holds initially and the boundary data are compatible, it remains zero for all time. A practical way to enforce $\\nabla\\cdot B=0$ at initialization is to construct $B$ from a vector potential $A$ via $B=\\nabla\\times A$, choosing boundary conditions on $A$ so that $B\\cdot n$ matches the prescribed flux.\n\nB. In ideal MHD, the induction equation dynamically eliminates any initial $\\nabla\\cdot B\\neq 0$ because the curl operator drives the divergence toward zero; therefore one may set $B(x,0)$ arbitrarily and expect $\\nabla\\cdot B\\to 0$ as $t$ advances without additional enforcement.\n\nC. A Helmholtz–Hodge projection can be used to enforce $\\nabla\\cdot B=0$ at initialization: given a tentative field $B_0$, solve the scalar Poisson equation $\\nabla^2\\phi=\\nabla\\cdot B_0$ in the domain with homogeneous Neumann boundary condition $\\partial\\phi/\\partial n=0$ to preserve the normal flux, and set $B:=B_0-\\nabla\\phi$, which satisfies $\\nabla\\cdot B=0$ and $B\\cdot n=B_0\\cdot n$.\n\nD. One can always make $B$ divergence-free by defining $B=\\nabla\\psi$ for some scalar potential $\\psi$; this guarantees $\\nabla\\cdot B=0$ because scalar potentials generate conservative fields.\n\nE. Constrained Transport (CT) initialization on a staggered grid can enforce a discrete divergence-free condition: define a discrete vector potential on edges so that face-centered magnetic fluxes are computed as discrete curls, yielding a face-centered $B$ with zero discrete divergence and matching prescribed $B\\cdot n$ on boundary faces.",
            "solution": "The problem statement concerns the formulation of an initial value and boundary value problem for simulating the magnetic field $B$ in a resistive Magnetohydrodynamics (MHD) plasma. The core physical constraint is Gauss's law for magnetism, which must be satisfied by the initial data and preserved by the time evolution.\n\nThe problem statement is scientifically sound and well-posed. It describes a standard challenge in computational MHD: ensuring the initial magnetic field $B(\\mathbf{x}, 0)$ satisfies the divergence-free condition, $\\nabla \\cdot B = 0$. The governing laws mentioned, Maxwell-Faraday's law ($\\nabla \\times E = -\\frac{\\partial B}{\\partial t}$) and Gauss's law for magnetism ($\\nabla \\cdot B = 0$), are fundamental principles of electromagnetism. The setup of a toroidal plasma with prescribed normal magnetic flux at the boundary is a canonical problem in fusion research. The problem is valid.\n\nThe time evolution of the divergence of the magnetic field is governed by Maxwell-Faraday's law. Taking the divergence of this law gives:\n$$ \\nabla \\cdot \\left( \\frac{\\partial B}{\\partial t} \\right) = - \\nabla \\cdot (\\nabla \\times E) $$\nAssuming sufficient smoothness to interchange spatial and temporal derivatives, and using the vector calculus identity that the divergence of a curl is always zero ($\\nabla \\cdot (\\nabla \\times E) \\equiv 0$), we get:\n$$ \\frac{\\partial}{\\partial t} (\\nabla \\cdot B) = 0 $$\nThis equation shows that the value of $\\nabla \\cdot B$ is conserved in time. If the initial magnetic field $B(\\mathbf{x}, 0)$ is divergence-free, i.e., $\\nabla \\cdot B(\\mathbf{x}, 0) = 0$, then the analytical solution will have $\\nabla \\cdot B(\\mathbf{x}, t) = 0$ for all $t > 0$. Therefore, it is a critical requirement to start a numerical simulation with an initial condition that satisfies this constraint. Any initial non-zero divergence would be an unphysical artifact that persists and can lead to numerical instabilities.\n\nWe now evaluate each option.\n\n**Option A: Correct**\nThis statement accurately describes the theoretical foundation and a primary practical method for constructing a divergence-free initial field.\n1.  The statement that $\\nabla \\cdot B = 0$ is a physical constraint and that Maxwell-Faraday's law preserves this condition over time is correct, as shown by the derivation $\\frac{\\partial}{\\partial t}(\\nabla \\cdot B) = 0$.\n2.  The proposed method is to define the magnetic field $B$ from a vector potential $A$ as $B = \\nabla \\times A$. This is a standard technique that mathematically guarantees the divergence-free condition because of the vector identity $\\nabla \\cdot (\\nabla \\times A) \\equiv 0$.\n3.  The boundary condition on the normal magnetic flux, $B \\cdot n$, must be satisfied. Using the vector potential formulation, this condition translates into a boundary condition on $A$. Specifically, by Stokes' theorem, the magnetic flux $\\Phi_S$ through a surface $S$ is related to the line integral of $A$ around the boundary $\\partial S$ of that surface: $\\Phi_S = \\iint_S B \\cdot n \\,dS = \\oint_{\\partial S} A \\cdot dl$. Thus, by appropriately choosing the boundary conditions for $A$, one can match the prescribed normal flux $B \\cdot n$. This entire statement is correct.\n\n**Option B: Incorrect**\nThis statement claims that the induction equation dynamically eliminates any initial divergence error. This is fundamentally false. As derived above, for both ideal and resistive MHD, the governing equations imply $\\frac{\\partial}{\\partial t}(\\nabla \\cdot B) = 0$. This equation dictates that any initial divergence, $\\nabla \\cdot B(\\mathbf{x}, 0) = f(\\mathbf{x})$, is *preserved*, not eliminated. The solution at a later time would be $\\nabla \\cdot B(\\mathbf{x}, t) = f(\\mathbf{x})$. Introducing an arbitrary, non-divergence-free initial field would contaminate the simulation with unphysical \"magnetic monopoles\" that persist indefinitely and can cause severe numerical errors, such as unphysical parallel forces.\n\n**Option C: Correct**\nThis option correctly describes the Helmholtz-Hodge decomposition method, often called a projection or divergence-cleaning method.\n1.  Starting with a tentative, possibly non-divergence-free field $B_0$, one seeks a corrected field $B$ that is divergence-free. The correction is assumed to be the gradient of a scalar potential $\\phi$, so $B = B_0 - \\nabla\\phi$. This form is chosen because we wish to remove the curl-free (gradient) part of the field that is responsible for the non-zero divergence.\n2.  To enforce $\\nabla \\cdot B = 0$, we take the divergence: $\\nabla \\cdot (B_0 - \\nabla\\phi) = 0$, which leads to $\\nabla \\cdot B_0 - \\nabla^2\\phi = 0$, or $\\nabla^2\\phi = \\nabla \\cdot B_0$. This is a Poisson equation for the scalar potential $\\phi$, where the source term is the divergence of the initial tentative field.\n3.  The boundary condition must preserve the prescribed normal flux from the original field, so $B \\cdot n = B_0 \\cdot n$. Substituting the expression for $B$, we get $(B_0 - \\nabla\\phi) \\cdot n = B_0 \\cdot n$, which simplifies to $\\nabla\\phi \\cdot n = 0$ or $\\frac{\\partial\\phi}{\\partial n} = 0$. This is a homogeneous Neumann boundary condition.\nThe entire procedure described is a valid and widely used method for enforcing the divergence-free constraint.\n\n**Option D: Incorrect**\nThis statement fundamentally confuses the properties of curl-free and divergence-free fields.\n1.  Defining a magnetic field as the gradient of a scalar potential, $B = \\nabla\\psi$, results in a field that is *curl-free*, i.e., $\\nabla \\times B = \\nabla \\times (\\nabla\\psi) \\equiv 0$.\n2.  According to Ampere's law, $\\nabla \\times B = \\mu_0 J$, where $J$ is the current density. A curl-free magnetic field implies zero current ($J=0$), which is true for a vacuum but incorrect for a plasma, which is characterized by the presence of currents.\n3.  The condition $B = \\nabla\\psi$ does not guarantee $\\nabla \\cdot B = 0$. It instead implies that $\\nabla \\cdot B = \\nabla \\cdot (\\nabla\\psi) = \\nabla^2\\psi$. So, for $B$ to be divergence-free, $\\psi$ must be a harmonic function ($\\nabla^2\\psi=0$), which is not generally true. The correct way to guarantee a divergence-free field is to use a vector potential, $B = \\nabla \\times A$.\n\n**Option E: Correct**\nThis statement accurately describes the initialization procedure in the context of Constrained Transport (CT) schemes, which are designed to maintain the divergence-free condition to machine precision at the discrete level.\n1.  CT methods are typically implemented on a staggered grid (e.g., a Yee mesh), where different field components are located at different points in a grid cell (e.g., vector components on faces or edges).\n2.  In this framework, the magnetic field components are naturally defined on cell faces, representing fluxes. A discrete vector potential can be defined on cell edges.\n3.  The magnetic flux through a face is then calculated as the discrete curl (sum) of the vector potential values on the edges bounding that face.\n4.  The discrete divergence of $B$ is computed at the cell center by summing the fluxes over all faces of the cell. By construction, this sum is identically zero because each edge value of the vector potential appears twice with opposite signs, which is a discrete analogue of Stokes' theorem.\n5.  This method provides a robust way to initialize a discretely divergence-free field that can also satisfy the prescribed normal flux on the boundary faces by setting the appropriate vector potential values on the boundary.",
            "answer": "$$\\boxed{ACE}$$"
        },
        {
            "introduction": "This final practice provides a hands-on opportunity to implement a sophisticated boundary condition for hyperbolic systems, directly connecting theoretical requirements to numerical code. You are tasked with constructing a characteristic-based boundary condition for the ideal MHD equations, a method that respects the physics of information propagation . This exercise is crucial for developing an understanding of how well-posedness is enforced at the boundaries of a computational domain in advanced simulation codes.",
            "id": "3996395",
            "problem": "Consider the one-dimensional ideal Magnetohydrodynamics (MHD) conservation laws in the $x$ direction for a plasma relevant to computational fusion science and engineering. Let the conserved state vector be $U = [\\rho, \\rho u, \\rho v, \\rho w, B_y, B_z, E]^T$, with constant normal magnetic field component $B_x$. The thermodynamic pressure is $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho(u^2 + v^2 + w^2) - \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)\\right)$, and the total pressure is $p_{\\text{tot}} = p + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)$. The inviscid flux in the $x$ direction, $F(U)$, is\n$$\nF(U) =\n\\begin{bmatrix}\n\\rho u \\\\\n\\rho u^2 + p_{\\text{tot}} - B_x^2 \\\\\n\\rho u v - B_x B_y \\\\\n\\rho u w - B_x B_z \\\\\nB_y u - B_x v \\\\\nB_z u - B_x w \\\\\n(E + p_{\\text{tot}})u - B_x(B_x u + B_y v + B_z w)\n\\end{bmatrix}.\n$$\n\nWe consider a finite volume discretization on a semi-infinite domain with a physical boundary. The boundary flux must be constructed to yield a well-posed initial-boundary value problem. At the boundary, define the outward unit normal along the $x$ direction as $n_x \\in \\{-1, +1\\}$, where $n_x = -1$ denotes the left domain boundary and $n_x = +1$ denotes the right domain boundary. Let $U_L$ denote the interior state in the boundary-adjacent cell and $U_{\\text{bc}}$ denote a prescribed exterior boundary state that encodes the desired incoming characteristic content. The discrete characteristic boundary condition is constructed by projecting the state jump onto the incoming characteristic subspace determined by the flux Jacobian $A = \\partial F/\\partial U$ evaluated at $U_L$.\n\nStarting from the conservation-law base and the definition of characteristics:\n- The one-dimensional ideal MHD conservation laws define a hyperbolic system. For a given state $U_L$, the flux Jacobian $A(U_L)$ admits an eigen-decomposition $A = R \\Lambda L$, where $R$ and $L$ are the right and left eigenvector matrices, and $\\Lambda$ is the diagonal matrix of eigenvalues (characteristic speeds) $\\lambda_i$ in the $x$ direction.\n- A characteristic associated with eigenvalue $\\lambda_i$ is incoming to the domain if and only if $n_x \\lambda_i < 0$.\n\nDefine the discrete characteristic boundary construction as follows:\n- Compute $A(U_L)$ and its eigen-decomposition $A = R \\Lambda L$.\n- Compute the boundary state jump $\\Delta U_{\\text{bc}} = U_{\\text{bc}} - U_L$.\n- Compute characteristic amplitudes $\\alpha = L \\Delta U_{\\text{bc}}$.\n- Define filtered amplitudes $\\tilde{\\alpha}_i = \\alpha_i$ if $n_x \\lambda_i < 0$ (incoming), and $\\tilde{\\alpha}_i = 0$ otherwise (outgoing).\n- Reconstruct the ghost state $U_R = U_L + R \\tilde{\\alpha}$.\n- Form the boundary numerical flux via the local Lax-Friedrichs (Rusanov) flux,\n$$\nF_{\\text{bc}} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2} a_{\\max} \\left(U_R - U_L\\right),\n$$\nwhere $a_{\\max} = \\max_i |\\lambda_i|$ computed at $U_L$.\n\nThis procedure enforces that only the prescribed incoming characteristic content is introduced from the exterior, while outgoing characteristics are determined by the interior solution, thereby yielding a consistent boundary value formulation for the hyperbolic MHD system.\n\nImplement a complete, runnable program that:\n- Encodes $F(U)$ for ideal MHD in the $x$ direction.\n- Numerically approximates $A(U_L)$ using a symmetric finite difference of $F(U)$ with respect to the conserved variables.\n- Performs the characteristic projection and ghost-state reconstruction described above.\n- Returns the boundary flux $F_{\\text{bc}}$ for each test case.\n\nUse $\\gamma = \\tfrac{5}{3}$. The program must output results in a single line as a comma-separated list enclosed in square brackets. Each result must be a list of seven floats ordered as $[F_{\\rho}, F_{\\rho u}, F_{\\rho v}, F_{\\rho w}, F_{B_y}, F_{B_z}, F_E]$, where $F_{\\rho}$ denotes the first component of $F_{\\text{bc}}$ and so on.\n\nTest Suite:\n- Case $1$ (right boundary, subsonic outflow, nonreflecting): $n_x = +1$, $B_x = 0.75$, interior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.0, 0.5, 0.0, 0.0, 0.1, -0.05, 0.8]$, and $U_{\\text{bc}}$ equal to $U_L$.\n- Case $2$ (right boundary, supersonic outflow, nonreflecting): $n_x = +1$, $B_x = 0.2$, interior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.0, 3.0, 0.0, 0.0, 0.0, 0.0, 0.5]$, and $U_{\\text{bc}}$ equal to $U_L$.\n- Case $3$ (left boundary, subsonic inflow, prescribed incoming content): $n_x = -1$, $B_x = 0.5$, interior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.2, 0.2, 0.0, 0.0, 0.05, 0.1, 1.1]$, and exterior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.0, 0.1, -0.05, 0.02, 0.2, 0.05, 1.0]$.\n- Case $4$ (right boundary, zero normal velocity edge case, nonreflecting): $n_x = +1$, $B_x = 0.3$, interior primitive state $[\\rho, u, v, w, B_y, B_z, p] = [1.0, 0.0, 0.1, -0.1, 0.0, 0.2, 1.0]$, and $U_{\\text{bc}}$ equal to $U_L$.\n\nAll primitive states must be converted to conserved variables via\n$$\nE = \\frac{p}{\\gamma - 1} + \\tfrac{1}{2}\\rho(u^2 + v^2 + w^2) + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2).\n$$\n\nFinal Output Format:\n- Your program should produce a single line of output containing the four boundary flux vectors as a comma-separated list enclosed in square brackets, with each boundary flux vector represented as a list of seven floats, for example, $[[f_{1,1}, \\dots, f_{1,7}], [f_{2,1}, \\dots, f_{2,7}], [f_{3,1}, \\dots, f_{3,7}], [f_{4,1}, \\dots, f_{4,7}]]$.\n\nNo physical units or angles are involved; all values should be treated as dimensionless. The output entries must be floats. The program must be self-contained and require no input.",
            "solution": "The problem requires the implementation of a characteristic-based boundary condition for the one-dimensional ideal Magnetohydrodynamics (MHD) equations and the computation of the resulting numerical boundary flux, $F_{\\text{bc}}$, for several test cases. The methodology is based on decomposing the state jump at the boundary into characteristic waves, filtering for incoming waves, and using the result to construct a ghost-cell state for a numerical flux function.\n\nThe physical system is described by the ideal MHD conservation laws in one dimension ($x$), given by $\\partial_t U + \\partial_x F(U) = 0$, where $U$ is the vector of conserved quantities and $F(U)$ is the flux vector.\nThe state vector is $U = [\\rho, \\rho u, \\rho v, \\rho w, B_y, B_z, E]^T$. Here, $\\rho$ is the mass density, $[u, v, w]$ are the velocity components, $[B_y, B_z]$ are the transverse magnetic field components, and $E$ is the total energy density. The normal component of the magnetic field, $B_x$, is constant.\nThe flux vector is given by:\n$$\nF(U) =\n\\begin{bmatrix}\n\\rho u \\\\\n\\rho u^2 + p_{\\text{tot}} - B_x^2 \\\\\n\\rho u v - B_x B_y \\\\\n\\rho u w - B_x B_z \\\\\nB_y u - B_x v \\\\\nB_z u - B_x w \\\\\n(E + p_{\\text{tot}})u - B_x(B_x u + B_y v + B_z w)\n\\end{bmatrix}\n$$\nThe system is closed by the equation of state for an ideal gas, where the thermodynamic pressure $p$ is related to the total energy $E$ via:\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho(u^2 + v^2 + w^2) - \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)\\right)\n$$\nThe total pressure, $p_{\\text{tot}}$, is the sum of the thermodynamic and magnetic pressures: $p_{\\text{tot}} = p + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)$. The adiabatic index is given as $\\gamma = \\tfrac{5}{3}$.\n\nThe numerical procedure to compute the boundary flux $F_{\\text{bc}}$ is as follows:\n\n**Step 1: State Variable Conversion**\nThe test cases provide primitive variables $[\\rho, u, v, w, B_y, B_z, p]$. These must be converted to the conserved state vector $U$ for both the interior state ($U_L$) and the prescribed boundary state ($U_{\\text{bc}}$). The conversion is done using the definitions of the conserved variables, with the total energy $E$ calculated as:\n$$\nE = \\frac{p}{\\gamma - 1} + \\tfrac{1}{2}\\rho(u^2 + v^2 + w^2) + \\tfrac{1}{2}(B_x^2 + B_y^2 + B_z^2)\n$$\n\n**Step 2: Flux Jacobian and Eigendecomposition**\nThe characteristic-based method relies on the eigensystem of the flux Jacobian matrix, $A(U) = \\partial F/\\partial U$. As the analytical derivation of the $7 \\times 7$ Jacobian is laborious, we will approximate it numerically at the interior state $U_L$. For each element $A_{ij} = \\partial F_i / \\partial U_j$, we use a symmetric finite difference stencil:\n$$\nA_{ij}(U_L) \\approx \\frac{F_i(U_L + h \\mathbf{e}_j) - F_i(U_L - h \\mathbf{e}_j)}{2h}\n$$\nwhere $\\mathbf{e}_j$ is the $j$-th standard basis vector and $h$ is a small perturbation.\nThe computed Jacobian $A(U_L)$ is then diagonalized to find its eigenvalues $\\lambda_i$ (the characteristic wave speeds) and its right eigenvectors (the columns of matrix $R$). This yields the decomposition $A = R \\Lambda L$, where $\\Lambda$ is the diagonal matrix of eigenvalues and $L = R^{-1}$ is the matrix of left eigenvectors.\n\n**Step 3: Characteristic Filtering**\nThe core principle is to allow only information associated with incoming characteristic waves to pass from the prescribed exterior state into the computational domain. A characteristic wave $i$ is incoming if its velocity $\\lambda_i$ is directed into the domain, which is mathematically stated as $n_x \\lambda_i < 0$, where $n_x$ is the outward unit normal vector at the boundary ($n_x = -1$ for a left boundary, $n_x = +1$ for a right boundary).\n\nTo enforce this, we first compute the jump between the prescribed and interior states, $\\Delta U_{\\text{bc}} = U_{\\text{bc}} - U_L$. This jump is then projected onto the characteristic basis by calculating the wave-strength amplitudes $\\alpha = L \\Delta U_{\\text{bc}}$. A filtered set of amplitudes, $\\tilde{\\alpha}$, is constructed by keeping only the amplitudes corresponding to incoming waves:\n$$\n\\tilde{\\alpha}_i =\n\\begin{cases}\n\\alpha_i & \\text{if } n_x \\lambda_i < 0 \\text{ (incoming)} \\\\\n0 & \\text{if } n_x \\lambda_i \\geq 0 \\text{ (outgoing)}\n\\end{cases}\n$$\n\n**Step 4: Ghost State Reconstruction**\nThe filtered amplitudes are projected back to the conserved variable space to form a correction, $R \\tilde{\\alpha}$. This correction is added to the interior state $U_L$ to define a \"ghost\" state $U_R$:\n$$\nU_R = U_L + R \\tilde{\\alpha}\n$$\nThis ghost state $U_R$ now contains the outgoing information from the interior state $U_L$ and the incoming information from the prescribed exterior state $U_{\\text{bc}}$.\n\n**Step 5: Numerical Flux Calculation**\nThe final boundary flux $F_{\\text{bc}}$ is computed using the local Lax-Friedrichs (or Rusanov) numerical flux function, which is a robust, common choice for hyperbolic systems. It is defined as:\n$$\nF_{\\text{bc}} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2} a_{\\max} \\left(U_R - U_L\\right)\n$$\nwhere $F(U_L)$ and $F(U_R)$ are the physical fluxes evaluated at the interior and ghost states, respectively, and $a_{\\max} = \\max_i |\\lambda_i|$ is the maximum absolute characteristic speed evaluated at the interior state $U_L$. This completes the calculation. For non-reflecting boundary conditions where $U_{\\text{bc}} = U_L$, the state jump $\\Delta U_{\\text{bc}}$ is zero, which leads to $\\tilde{\\alpha} = 0$, $U_R = U_L$, and the flux simplifies to $F_{\\text{bc}} = F(U_L)$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# The problem statement mentions scipy but it is not needed as numpy is sufficient.\n\ndef solve():\n    # Define the constant gamma\n    GAMMA = 5.0 / 3.0\n\n    def primitive_to_conserved(prim, Bx):\n        \"\"\"Converts primitive variables [rho, u, v, w, By, Bz, p] to conserved variables.\"\"\"\n        rho, u, v, w, By, Bz, p = prim\n        \n        U = np.zeros(7)\n        U[0] = rho\n        U[1] = rho * u\n        U[2] = rho * v\n        U[3] = rho * w\n        U[4] = By\n        U[5] = Bz\n        \n        kinetic_energy = 0.5 * rho * (u**2 + v**2 + w**2)\n        magnetic_energy = 0.5 * (Bx**2 + By**2 + Bz**2)\n        internal_energy = p / (GAMMA - 1.0)\n        U[6] = internal_energy + kinetic_energy + magnetic_energy\n        \n        return U\n\n    def get_pressure_from_conserved(U, Bx):\n        \"\"\"Calculates thermodynamic pressure from the conserved state vector.\"\"\"\n        rho = U[0]\n        if rho = 1e-12:  # Avoid division by zero or negative density\n            raise ValueError(\"Density is non-positive.\")\n        \n        kinetic_energy = 0.5 * (U[1]**2 + U[2]**2 + U[3]**2) / rho\n        magnetic_energy = 0.5 * (Bx**2 + U[4]**2 + U[5]**2)\n        internal_energy = U[6] - kinetic_energy - magnetic_energy\n        \n        p = internal_energy * (GAMMA - 1.0)\n        return p\n\n    def mhd_flux(U, Bx):\n        \"\"\"Computes the 1D ideal MHD flux vector F(U).\"\"\"\n        rho = U[0]\n        if rho = 1e-12:\n            return np.zeros(7)\n\n        u = U[1] / rho\n        v = U[2] / rho\n        w = U[3] / rho\n        By = U[4]\n        Bz = U[5]\n        E = U[6]\n        \n        p = get_pressure_from_conserved(U, Bx)\n        p_tot = p + 0.5 * (Bx**2 + By**2 + Bz**2)\n        \n        F = np.zeros(7)\n        F[0] = U[1]\n        F[1] = U[1] * u + p_tot - Bx**2\n        F[2] = U[1] * v - Bx * By\n        F[3] = U[1] * w - Bx * Bz\n        F[4] = By * u - Bx * v\n        F[5] = Bz * u - Bx * w\n        F[6] = (E + p_tot) * u - Bx * (Bx * u + By * v + Bz * w)\n        \n        return F\n\n    def compute_jacobian_fd(U, Bx, h=1e-7):\n        \"\"\"Computes the flux Jacobian A = dF/dU using symmetric finite differences.\"\"\"\n        N = len(U)\n        A = np.zeros((N, N))\n        \n        for j in range(N):\n            U_plus_h = U.copy()\n            U_minus_h = U.copy()\n            \n            # Using a relative step size can be more robust, but a small\n            # absolute step is sufficient for this problem's scale.\n            step = h * (1.0 + abs(U[j]))\n            \n            U_plus_h[j] += step\n            U_minus_h[j] -= step\n            \n            F_plus_h = mhd_flux(U_plus_h, Bx)\n            F_minus_h = mhd_flux(U_minus_h, Bx)\n            \n            A[:, j] = (F_plus_h - F_minus_h) / (2.0 * step)\n            \n        return A\n\n    def calculate_boundary_flux(case):\n        \"\"\"Main function to calculate the characteristic boundary flux for a single case.\"\"\"\n        nx, Bx, prim_L_list, prim_bc_list = case\n        prim_L = np.array(prim_L_list)\n        prim_bc = np.array(prim_bc_list)\n\n        U_L = primitive_to_conserved(prim_L, Bx)\n        U_bc = primitive_to_conserved(prim_bc, Bx)\n        \n        # Shortcut for non-reflecting boundary conditions\n        if np.allclose(U_L, U_bc):\n            return mhd_flux(U_L, Bx).tolist()\n\n        A_L = compute_jacobian_fd(U_L, Bx)\n        eigenvalues, R = np.linalg.eig(A_L)\n        lambdas = np.real(eigenvalues)\n        \n        try:\n            L = np.linalg.inv(R)\n        except np.linalg.LinAlgError:\n            # If the Jacobian is singular, use pseudo-inverse\n            L = np.linalg.pinv(R)\n\n        delta_U_bc = U_bc - U_L\n        alpha = L @ delta_U_bc\n        \n        tilde_alpha = np.zeros_like(alpha, dtype=complex)\n        for i in range(len(lambdas)):\n            if nx * lambdas[i]  0:\n                tilde_alpha[i] = alpha[i]\n\n        update = R @ tilde_alpha\n        U_R = U_L + np.real(update)\n\n        F_L = mhd_flux(U_L, Bx)\n        F_R = mhd_flux(U_R, Bx)\n        \n        a_max = np.max(np.abs(lambdas))\n        \n        F_bc = 0.5 * (F_L + F_R) - 0.5 * a_max * (U_R - U_L)\n        \n        return F_bc.tolist()\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        (1.0, 0.75, [1.0, 0.5, 0.0, 0.0, 0.1, -0.05, 0.8], [1.0, 0.5, 0.0, 0.0, 0.1, -0.05, 0.8]),\n        # Case 2\n        (1.0, 0.2, [1.0, 3.0, 0.0, 0.0, 0.0, 0.0, 0.5], [1.0, 3.0, 0.0, 0.0, 0.0, 0.0, 0.5]),\n        # Case 3\n        (-1.0, 0.5, [1.2, 0.2, 0.0, 0.0, 0.05, 0.1, 1.1], [1.0, 0.1, -0.05, 0.02, 0.2, 0.05, 1.0]),\n        # Case 4\n        (1.0, 0.3, [1.0, 0.0, 0.1, -0.1, 0.0, 0.2, 1.0], [1.0, 0.0, 0.1, -0.1, 0.0, 0.2, 1.0]),\n    ]\n    \n    results = []\n    for case in test_cases:\n        result = calculate_boundary_flux(case)\n        results.append(result)\n\n    # Format the final output string to match the requested format.\n    # str() on a list of lists will produce the desired output format.\n    print(str(results))\n\nsolve()\n```"
        }
    ]
}