{
    "hands_on_practices": [
        {
            "introduction": "Understanding the assembly of a global stiffness matrix begins with mastering its fundamental component: the element stiffness matrix, $\\mathbf{k}_e$. This exercise guides you through the derivation of $\\mathbf{k}_e$ for a constant-strain triangular element from first principles, based on the principle of virtual work. By working through the calculation of the strain-displacement matrix $\\mathbf{B}$ and constitutive matrix $\\mathbf{D}$, you will solidify your understanding of how material properties and element geometry translate into a discrete mechanical relationship. ",
            "id": "3733548",
            "problem": "Consider the two-dimensional small-strain linear elasticity problem discretized by the Finite Element Method (FEM) using a single linear constant-strain triangular element under plane stress. The three nodes of the element have Cartesian coordinates $((x_1,y_1),(x_2,y_2),(x_3,y_3)) = ((0,0),(2,0),(0,1))$ in $\\text{m}$. The material is homogeneous and isotropic with Young’s modulus $E = 210 \\,\\text{GPa}$ and Poisson’s ratio $\\nu = 0.3$, and the element has uniform thickness $t = 0.01 \\,\\text{m}$. Use the standard nodal displacement ordering $\\left[u_1, v_1, u_2, v_2, u_3, v_3\\right]$ for the element degrees of freedom.\n\nStarting from the Principle of Virtual Work and the small-strain kinematics and isotropic linear elastic constitutive relations, derive the constant strain-displacement matrix $\\mathbf{B}$ for this element by computing the geometric coefficients and the element area $A$ from the given nodal coordinates. Then obtain the constitutive matrix $\\mathbf{D}$ for plane stress. Using these, form the element stiffness matrix $\\mathbf{k}_e$ via the standard bilinear form over the element domain. Finally, report the scalar value of the $(1,1)$ entry of $\\mathbf{k}_e$ corresponding to the $u_1$–$u_1$ degree of freedom interaction.\n\nRound your final numerical value to four significant figures. Express your final result in $\\text{N/m}$.\n\nYou may comment on how this element stiffness would be mapped into the global stiffness matrix and, analogously, how a consistent element force vector due to a uniform body force would be assembled into the global force vector, but only the scalar $(1,1)$ entry of $\\mathbf{k}_e$ is required as the final answer.",
            "solution": "The element stiffness matrix, $\\mathbf{k}_e$, for a finite element is derived from the Principle of Virtual Work. For a linear elastic material, it relates the nodal displacement vector, $\\mathbf{d}$, to the nodal force vector, $\\mathbf{f}_e$, as $\\mathbf{f}_e = \\mathbf{k}_e \\mathbf{d}$. The matrix $\\mathbf{k}_e$ is given by the expression:\n$$\n\\mathbf{k}_e = \\int_V \\mathbf{B}^T \\mathbf{D} \\mathbf{B} \\, dV\n$$\nwhere $\\mathbf{B}$ is the strain-displacement matrix, $\\mathbf{D}$ is the constitutive (material stiffness) matrix, and the integral is taken over the volume $V$ of the element. For an element with constant thickness $t$, this can be written as:\n$$\n\\mathbf{k}_e = t \\int_A \\mathbf{B}^T \\mathbf{D} \\mathbf{B} \\, dA\n$$\nwhere $A$ is the area of the element. For a constant-strain triangle, both $\\mathbf{B}$ and $\\mathbf{D}$ are constant throughout the element, so the integral simplifies to:\n$$\n\\mathbf{k}_e = (A \\cdot t) \\mathbf{B}^T \\mathbf{D} \\mathbf{B}\n$$\n\nFirst, we determine the geometric properties of the element. The nodal coordinates are given as $(x_1, y_1) = (0,0)$, $(x_2, y_2) = (2,0)$, and $(x_3, y_3) = (0,1)$, all in units of meters ($\\text{m}$). The area $A$ of the triangle can be computed using the determinant formula:\n$$\nA = \\frac{1}{2} \\left| \\det \\begin{pmatrix} 1  x_1  y_1 \\\\ 1  x_2  y_2 \\\\ 1  x_3  y_3 \\end{pmatrix} \\right| = \\frac{1}{2} |x_1(y_2-y_3) + x_2(y_3-y_1) + x_3(y_1-y_2)|\n$$\n$$\nA = \\frac{1}{2} |0(0-1) + 2(1-0) + 0(0-0)| = \\frac{1}{2}|2| = 1 \\, \\text{m}^2\n$$\n\nNext, we derive the strain-displacement matrix $\\mathbf{B}$. For a linear triangular element, the displacement field $(u,v)$ is interpolated from the nodal displacements $(u_i,v_i)$ using linear shape functions $N_i(x,y)$. The small-strain components are $\\epsilon_{xx} = \\frac{\\partial u}{\\partial x}$, $\\epsilon_{yy} = \\frac{\\partial v}{\\partial y}$, and $\\gamma_{xy} = \\frac{\\partial u}{\\partial y} + \\frac{\\partial v}{\\partial x}$. This relationship is expressed in matrix form as $\\boldsymbol{\\epsilon} = \\mathbf{B} \\mathbf{d}$, where $\\boldsymbol{\\epsilon} = [\\epsilon_{xx}, \\epsilon_{yy}, \\gamma_{xy}]^T$ and $\\mathbf{d} = [u_1, v_1, u_2, v_2, u_3, v_3]^T$. The matrix $\\mathbf{B}$ is given by:\n$$\n\\mathbf{B} = \\frac{1}{2A} \\begin{pmatrix} b_1  0  b_2  0  b_3  0 \\\\ 0  c_1  0  c_2  0  c_3 \\\\ c_1  b_1  c_2  b_2  c_3  b_3 \\end{pmatrix}\n$$\nwhere the coefficients $b_i$ and $c_i$ are functions of the nodal coordinates: $b_i = y_j - y_k$ and $c_i = x_k - x_j$ for $(i,j,k)$ in cyclic order $(1,2,3), (2,3,1), (3,1,2)$. We compute these coefficients:\n$b_1 = y_2 - y_3 = 0 - 1 = -1$\n$c_1 = x_3 - x_2 = 0 - 2 = -2$\n$b_2 = y_3 - y_1 = 1 - 0 = 1$\n$c_2 = x_1 - x_3 = 0 - 0 = 0$\n$b_3 = y_1 - y_2 = 0 - 0 = 0$\n$c_3 = x_2 - x_1 = 2 - 0 = 2$\n\nSubstituting these values and $A=1$, the $\\mathbf{B}$ matrix is:\n$$\n\\mathbf{B} = \\frac{1}{2} \\begin{pmatrix} -1  0  1  0  0  0 \\\\ 0  -2  0  0  0  2 \\\\ -2  -1  0  1  2  0 \\end{pmatrix}\n$$\n\nNext, we define the constitutive matrix $\\mathbf{D}$ for plane stress. For a homogeneous and isotropic material, this matrix is:\n$$\n\\mathbf{D} = \\frac{E}{1 - \\nu^2} \\begin{pmatrix} 1  \\nu  0 \\\\ \\nu  1  0 \\\\ 0  0  \\frac{1-\\nu}{2} \\end{pmatrix}\n$$\nThe problem provides Young's modulus $E = 210 \\, \\text{GPa} = 210 \\times 10^9 \\, \\text{N/m}^2$ and Poisson's ratio $\\nu = 0.3$.\n\nWe need to compute the $(1,1)$ entry of the element stiffness matrix $\\mathbf{k}_e$, which corresponds to the $u_1$ degree of freedom. The stiffness matrix $\\mathbf{k}_e$ is a $6 \\times 6$ matrix. The entry $k_{e,11}$ is given by:\n$$\nk_{e,11} = (A \\cdot t) \\left( \\mathbf{B}^T \\mathbf{D} \\mathbf{B} \\right)_{11}\n$$\nThe $(1,1)$ entry of the matrix product $\\mathbf{B}^T \\mathbf{D} \\mathbf{B}$ is found by multiplying the first row of $\\mathbf{B}^T$ by $\\mathbf{D}$ and then by the first column of $\\mathbf{B}$. Let the first column of $\\mathbf{B}$ be $\\mathbf{B}_1$. Then $( \\mathbf{B}^T \\mathbf{D} \\mathbf{B} )_{11} = \\mathbf{B}_1^T \\mathbf{D} \\mathbf{B}_1$.\n$$\n\\mathbf{B}_1 = \\frac{1}{2A} \\begin{pmatrix} b_1 \\\\ 0 \\\\ c_1 \\end{pmatrix}\n$$\n$$\nk_{e,11} = (A \\cdot t) \\left( \\frac{1}{2A} \\begin{pmatrix} b_1  0  c_1 \\end{pmatrix} \\right) \\left( \\frac{E}{1-\\nu^2} \\begin{pmatrix} 1  \\nu  0 \\\\ \\nu  1  0 \\\\ 0  0  \\frac{1-\\nu}{2} \\end{pmatrix} \\right) \\left( \\frac{1}{2A} \\begin{pmatrix} b_1 \\\\ 0 \\\\ c_1 \\end{pmatrix} \\right)\n$$\n$$\nk_{e,11} = \\frac{A t E}{4A^2(1-\\nu^2)} \\begin{pmatrix} b_1  0  c_1 \\end{pmatrix} \\begin{pmatrix} b_1 \\\\ \\nu b_1 \\\\ \\frac{1-\\nu}{2} c_1 \\end{pmatrix} = \\frac{E t}{4A(1-\\nu^2)} \\left( b_1^2 + \\frac{1-\\nu}{2} c_1^2 \\right)\n$$\nWe now substitute the numerical values: $E = 210 \\times 10^9 \\, \\text{N/m}^2$, $\\nu = 0.3$, $t=0.01 \\, \\text{m}$, $A=1 \\, \\text{m}^2$, $b_1 = -1$, and $c_1 = -2$.\n$$\nk_{e,11} = \\frac{(210 \\times 10^9)(0.01)}{4(1)(1 - 0.3^2)} \\left( (-1)^2 + \\frac{1-0.3}{2} (-2)^2 \\right)\n$$\n$$\nk_{e,11} = \\frac{2.1 \\times 10^9}{4(1 - 0.09)} \\left( 1 + \\frac{0.7}{2} (4) \\right)\n$$\n$$\nk_{e,11} = \\frac{2.1 \\times 10^9}{4(0.91)} (1 + 1.4) = \\frac{2.1 \\times 10^9}{3.64} (2.4)\n$$\n$$\nk_{e,11} = \\frac{5.04 \\times 10^9}{3.64} \\approx 1.38461538... \\times 10^9 \\, \\text{N/m}\n$$\nRounding the result to four significant figures, we get $1.385 \\times 10^9 \\, \\text{N/m}$.\n\nAs a brief comment on assembly, the $6 \\times 6$ element stiffness matrix $\\mathbf{k}_e$ is assembled into the global stiffness matrix $\\mathbf{K}$. If the global node numbers corresponding to local nodes $1, 2, 3$ are $I, J, K$, the local degrees of freedom $(u_1, v_1)$ map to global degrees of freedom $(u_I, v_I)$, and so on. The entry $k_{e,ij}$ is added to the entry of $\\mathbf{K}$ at the row and column corresponding to the global degrees of freedom. For instance, $k_{e,11}$ would be added to the global stiffness matrix entry $K_{2I-1, 2I-1}$, assuming a standard $(u,v)$ ordering of global degrees of freedom. Similarly, an element force vector, such as one from a uniform body force $\\mathbf{f}_b$, is computed as $\\mathbf{f}_e = \\int_V \\mathbf{N}^T \\mathbf{f}_b dV$, where $\\mathbf{N}$ is the matrix of shape functions. For a constant strain triangle and uniform body force, this results in $\\mathbf{f}_e = \\frac{A t}{3} [f_{bx}, f_{by}, f_{bx}, f_{by}, f_{bx}, f_{by}]^T$. This vector's components are then added to the corresponding entries in the global force vector.",
            "answer": "$$\n\\boxed{1.385 \\times 10^9}\n$$"
        },
        {
            "introduction": "Once the element-level matrices are understood, the next crucial step is to combine them into a global system that represents the entire structure. This practice problem walks you through the \"scatter-add\" assembly process for a simple 1D bar with heterogeneous properties derived from a basic multiscale model. You will map local element degrees of freedom to the global system and observe how the global stiffness matrix $\\mathbf{K}$ and force vector $\\mathbf{f}$ take shape, providing a clear, tangible look at the core of the finite element assembly algorithm. ",
            "id": "3733559",
            "problem": "Consider a one-dimensional heterogeneous bar occupying the interval $[0,L]$ that has been nondimensionalized so that all quantities are unitless. The bar is discretized using the Finite Element Method (FEM) with three linear two-node elements and four global nodes located at positions $x_{1}=0$, $x_{2}=1$, $x_{3}=2$, and $x_{4}=4$, so that the element lengths are $h_{1}=1$, $h_{2}=1$, and $h_{3}=2$. Each element is associated with a two-phase Representative Volume Element (RVE) that is layered along the axial direction, with phase moduli $E_{a}=6$ and $E_{b}=3$, and phase body-force densities $b_{a}=2$ and $b_{b}=0$. The volume fractions for the $e$-th element are $v_{1}=\\frac{1}{2}$, $v_{2}=\\frac{1}{3}$, and $v_{3}=\\frac{2}{3}$. Assume unit cross-sectional area $A=1$.\n\nUse the following physically justified base:\n- For layered media loaded in series along the axial direction, the effective modulus in each element is the harmonic average $E_{e}=\\left(\\frac{v_{e}}{E_{a}}+\\frac{1-v_{e}}{E_{b}}\\right)^{-1}$.\n- The effective volumetric body force in each element is the arithmetic average $b_{e}=v_{e}b_{a}+(1-v_{e})b_{b}$.\n- The element stiffness matrix for a one-dimensional linear element is $\\mathbf{k}^{(e)}=\\frac{A E_{e}}{h_{e}}\\begin{pmatrix}1  -1 \\\\ -1  1\\end{pmatrix}$.\n- The element consistent load vector under a constant body force $b_{e}$ is $\\mathbf{f}^{(e)}=\\frac{b_{e} h_{e}}{2}\\begin{pmatrix}1 \\\\ 1\\end{pmatrix}$.\n\nImpose the essential (Dirichlet) boundary condition $u(x_{1})=0$ at the left end and no traction at the right end $x_{4}$. Explicitly carry out the scatter-add assembly steps to form the global stiffness matrix $\\mathbf{K}$ and global force vector $\\mathbf{f}$ with the correct sparsity structure, and then impose the essential boundary condition by eliminating the constrained degree of freedom to obtain the reduced $3\\times 3$ global stiffness matrix. Your final task is to compute the determinant of this reduced global stiffness matrix. Express your final answer as an exact rational number with no units.",
            "solution": "The solution proceeds in several steps:\n1.  Calculate the effective properties for each of the three elements.\n2.  Formulate the element stiffness matrices.\n3.  Assemble the global stiffness matrix from the element matrices.\n4.  Apply the boundary condition to obtain the reduced stiffness matrix.\n5.  Compute the determinant of the reduced matrix.\n\n**Step 1: Calculate Effective Element Properties**\n\nWe calculate the effective Young's modulus $E_{e}$ and effective body force $b_{e}$ for each element $e \\in \\{1, 2, 3\\}$.\n\nFor element $1$ ($e=1$): $v_{1}=\\frac{1}{2}$\n$$E_{1} = \\left(\\frac{v_{1}}{E_{a}}+\\frac{1-v_{1}}{E_{b}}\\right)^{-1} = \\left(\\frac{1/2}{6}+\\frac{1-1/2}{3}\\right)^{-1} = \\left(\\frac{1}{12}+\\frac{1/2}{3}\\right)^{-1} = \\left(\\frac{1}{12}+\\frac{1}{6}\\right)^{-1} = \\left(\\frac{3}{12}\\right)^{-1} = \\left(\\frac{1}{4}\\right)^{-1} = 4$$\n$$b_{1} = v_{1}b_{a}+(1-v_{1})b_{b} = \\frac{1}{2}(2)+\\left(1-\\frac{1}{2}\\right)(0) = 1$$\n\nFor element $2$ ($e=2$): $v_{2}=\\frac{1}{3}$\n$$E_{2} = \\left(\\frac{v_{2}}{E_{a}}+\\frac{1-v_{2}}{E_{b}}\\right)^{-1} = \\left(\\frac{1/3}{6}+\\frac{1-1/3}{3}\\right)^{-1} = \\left(\\frac{1}{18}+\\frac{2/3}{3}\\right)^{-1} = \\left(\\frac{1}{18}+\\frac{2}{9}\\right)^{-1} = \\left(\\frac{5}{18}\\right)^{-1} = \\frac{18}{5}$$\n$$b_{2} = v_{2}b_{a}+(1-v_{2})b_{b} = \\frac{1}{3}(2)+\\left(1-\\frac{1}{3}\\right)(0) = \\frac{2}{3}$$\n\nFor element $3$ ($e=3$): $v_{3}=\\frac{2}{3}$\n$$E_{3} = \\left(\\frac{v_{3}}{E_{a}}+\\frac{1-v_{3}}{E_{b}}\\right)^{-1} = \\left(\\frac{2/3}{6}+\\frac{1-2/3}{3}\\right)^{-1} = \\left(\\frac{2}{18}+\\frac{1/3}{3}\\right)^{-1} = \\left(\\frac{1}{9}+\\frac{1}{9}\\right)^{-1} = \\left(\\frac{2}{9}\\right)^{-1} = \\frac{9}{2}$$\n$$b_{3} = v_{3}b_{a}+(1-v_{3})b_{b} = \\frac{2}{3}(2)+\\left(1-\\frac{2}{3}\\right)(0) = \\frac{4}{3}$$\n\n**Step 2: Formulate Element Stiffness Matrices**\n\nUsing the formula $\\mathbf{k}^{(e)}=\\frac{A E_{e}}{h_{e}}\\begin{pmatrix}1  -1 \\\\ -1  1\\end{pmatrix}$ with $A=1$.\n\nFor element $1$ ($h_{1}=1$, connects nodes $1, 2$):\n$$\\mathbf{k}^{(1)} = \\frac{(1)(4)}{1}\\begin{pmatrix}1  -1 \\\\ -1  1\\end{pmatrix} = \\begin{pmatrix}4  -4 \\\\ -4  4\\end{pmatrix}$$\n\nFor element $2$ ($h_{2}=1$, connects nodes $2, 3$):\n$$\\mathbf{k}^{(2)} = \\frac{(1)(18/5)}{1}\\begin{pmatrix}1  -1 \\\\ -1  1\\end{pmatrix} = \\begin{pmatrix}\\frac{18}{5}  -\\frac{18}{5} \\\\ -\\frac{18}{5}  \\frac{18}{5}\\end{pmatrix}$$\n\nFor element $3$ ($h_{3}=2$, connects nodes $3, 4$):\n$$\\mathbf{k}^{(3)} = \\frac{(1)(9/2)}{2}\\begin{pmatrix}1  -1 \\\\ -1  1\\end{pmatrix} = \\begin{pmatrix}\\frac{9}{4}  -\\frac{9}{4} \\\\ -\\frac{9}{4}  \\frac{9}{4}\\end{pmatrix}$$\n\n**Step 3: Assemble the Global Stiffness Matrix**\n\nThe global stiffness matrix $\\mathbf{K}$ is a $4 \\times 4$ matrix. The assembly is performed by adding the element stiffness contributions to the corresponding global degrees of freedom.\n$K_{11} = k^{(1)}_{11} = 4$\n$K_{12} = K_{21} = k^{(1)}_{12} = -4$\n$K_{22} = k^{(1)}_{22} + k^{(2)}_{11} = 4 + \\frac{18}{5} = \\frac{20}{5} + \\frac{18}{5} = \\frac{38}{5}$\n$K_{23} = K_{32} = k^{(2)}_{12} = -\\frac{18}{5}$\n$K_{33} = k^{(2)}_{22} + k^{(3)}_{11} = \\frac{18}{5} + \\frac{9}{4} = \\frac{72}{20} + \\frac{45}{20} = \\frac{117}{20}$\n$K_{34} = K_{43} = k^{(3)}_{12} = -\\frac{9}{4}$\n$K_{44} = k^{(3)}_{22} = \\frac{9}{4}$\nAll other entries are zero.\n\nThe assembled global stiffness matrix is:\n$$\\mathbf{K} = \\begin{pmatrix} 4  -4  0  0 \\\\ -4  \\frac{38}{5}  -\\frac{18}{5}  0 \\\\ 0  -\\frac{18}{5}  \\frac{117}{20}  -\\frac{9}{4} \\\\ 0  0  -\\frac{9}{4}  \\frac{9}{4} \\end{pmatrix}$$\n\n**Step 4: Apply Boundary Condition and Obtain Reduced Matrix**\n\nThe essential boundary condition is $u(x_{1})=0$, which corresponds to the displacement $u_{1}=0$. To enforce this condition by elimination, we remove the first row and first column of the global stiffness matrix $\\mathbf{K}$. The remaining submatrix corresponds to the unknown degrees of freedom $u_{2}$, $u_{3}$, and $u_{4}$. This is the reduced $3 \\times 3$ stiffness matrix, which we will denote as $\\mathbf{K}_{red}$.\n\n$$\\mathbf{K}_{red} = \\begin{pmatrix} \\frac{38}{5}  -\\frac{18}{5}  0 \\\\ -\\frac{18}{5}  \\frac{117}{20}  -\\frac{9}{4} \\\\ 0  -\\frac{9}{4}  \\frac{9}{4} \\end{pmatrix}$$\n\n**Step 5: Compute the Determinant of the Reduced Matrix**\n\nWe compute the determinant of $\\mathbf{K}_{red}$ using the cofactor expansion along the first row:\n$$\\det(\\mathbf{K}_{red}) = \\left(\\frac{38}{5}\\right) \\det\\begin{pmatrix} \\frac{117}{20}  -\\frac{9}{4} \\\\ -\\frac{9}{4}  \\frac{9}{4} \\end{pmatrix} - \\left(-\\frac{18}{5}\\right) \\det\\begin{pmatrix} -\\frac{18}{5}  -\\frac{9}{4} \\\\ 0  \\frac{9}{4} \\end{pmatrix}$$\n\nFirst, calculate the determinants of the $2 \\times 2$ submatrices:\n$$\\det\\begin{pmatrix} \\frac{117}{20}  -\\frac{9}{4} \\\\ -\\frac{9}{4}  \\frac{9}{4} \\end{pmatrix} = \\left(\\frac{117}{20}\\right)\\left(\\frac{9}{4}\\right) - \\left(-\\frac{9}{4}\\right)\\left(-\\frac{9}{4}\\right) = \\frac{1053}{80} - \\frac{81}{16} = \\frac{1053}{80} - \\frac{405}{80} = \\frac{648}{80} = \\frac{81}{10}$$\n$$\\det\\begin{pmatrix} -\\frac{18}{5}  -\\frac{9}{4} \\\\ 0  \\frac{9}{4} \\end{pmatrix} = \\left(-\\frac{18}{5}\\right)\\left(\\frac{9}{4}\\right) - (0)\\left(-\\frac{9}{4}\\right) = -\\frac{162}{20} = -\\frac{81}{10}$$\n\nNow substitute these back into the expression for $\\det(\\mathbf{K}_{red})$:\n$$\\det(\\mathbf{K}_{red}) = \\left(\\frac{38}{5}\\right)\\left(\\frac{81}{10}\\right) + \\left(\\frac{18}{5}\\right)\\left(-\\frac{81}{10}\\right) = \\frac{81}{50}(38 - 18) = \\frac{81 \\times 20}{50} = \\frac{162}{5}$$\nThe determinant of the reduced global stiffness matrix is an exact rational number.",
            "answer": "$$\\boxed{\\frac{162}{5}}$$"
        },
        {
            "introduction": "Advanced engineering problems often involve complex constraints that modify the standard assembly procedure. This exercise explores the implementation of periodic boundary conditions, a common requirement in the multiscale modeling of Representative Volume Elements (RVEs). By programmatically identifying and merging degrees of freedom across the domain boundaries, you will see how the problem's topology directly influences the structure and mathematical properties—specifically the rank and nullspace—of the assembled global stiffness matrix, a critical consideration for robustly solving such systems. ",
            "id": "3733596",
            "problem": "Consider the scalar diffusion problem on the unit interval with dimensionless parameters, posed in the weak form: find a scalar field $u(x)$ such that, for all admissible variations $v(x)$,\n$$\n\\int_{0}^{1} k\\, \\frac{du}{dx}\\, \\frac{dv}{dx}\\, dx = \\int_{0}^{1} f\\, v\\, dx,\n$$\nwhere $k  0$ is a spatially uniform diffusion-like stiffness coefficient and $f$ is a uniform source term. The field $u(x)$ is discretized using a finite element method with linear shape functions on a uniform mesh of $N$ elements. The task is to implement macro-scale periodic boundary conditions by identifying equivalent Degrees of Freedom (DOF) across boundaries, and to analyze their implications for the assembly of the global stiffness matrix $K$ and the force vector $F$, as well as for solver choice in the presence of nullspaces.\n\nStarting from the weak form and the definition of linear shape functions, you must:\n\n- Derive the element stiffness matrix and element force vector in terms of $k$, $f$, and the element length $h$.\n- Assemble the global stiffness matrix $K$ and global force vector $F$ for the entire mesh.\n- Implement periodic boundary conditions by identifying equivalent DOFs across the two ends of the mesh (merge the DOF at the right end with the DOF at the left end). Explain the resulting implications for the rank and nullspace of $K$ prior to any constraint enforcement.\n- Implement Dirichlet constraints to remove the nullspace when necessary by anchoring one DOF to a prescribed value (use $0$). Explain why this anchoring is required for solver robustness, and contrast it with the case of non-periodic boundaries where explicit Dirichlet constraints at both ends are typically imposed.\n\nYou must write a complete program that:\n1. Assembles $K$ and $F$ for each test case below.\n2. Computes the matrix rank of $K$ prior to any Dirichlet constraint enforcement.\n3. Detects whether $K$ is singular (i.e., has rank deficiency) prior to enforcement.\n4. If constraints are provided for the test case, enforces them via direct modification of $K$ and $F$ and solves the linear system to obtain the DOF vector $u$.\n5. Reconstructs the nodal solution $u$ on the original $N+1$ mesh nodes using the DOF identification mapping (periodic or non-periodic).\n6. Computes the following diagnostics for each test case:\n   - The integer matrix rank of $K$ as assembled (before constraints).\n   - A boolean indicating whether $K$ is singular before constraints.\n   - The Euclidean norm $\\lVert u \\rVert_2$ of the reconstructed nodal solution after constraints and solve (use $0.0$ if no solve is performed).\n   - The absolute periodic mismatch $|u(0) - u(1)|$ computed on the reconstructed nodal values.\n\nAll quantities here are dimensionless; no physical units are required.\n\nTest Suite:\n- Case 1 (Happy path, periodic with anchor): $N = 4$, $k = 2.0$, $f = 1.0$, periodic identification enabled, anchor DOF index $0$ to value $0$.\n- Case 2 (Boundary case, single element, periodic with anchor): $N = 1$, $k = 1.0$, $f = 0.5$, periodic identification enabled, anchor DOF index $0$ to value $0$.\n- Case 3 (Non-periodic with Dirichlet at both ends): $N = 4$, $k = 2.0$, $f = 1.0$, periodic identification disabled, anchor DOF indices $0$ and $N$ to value $0$.\n- Case 4 (Edge case, periodic without anchor): $N = 3$, $k = 1.0$, $f = 1.0$, periodic identification enabled, no anchors (do not solve; just report singularity).\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a list\n$$[\\text{rank}, \\text{is\\_singular}, \\lVert u \\rVert_2, |u(0)-u(1)|]$$\nin the order of the test suite. For example:\n$$[[r_1,s_1,n_1,m_1],[r_2,s_2,n_2,m_2],[r_3,s_3,n_3,m_3],[r_4,s_4,n_4,m_4]]$$\nwhere $r_i$ is an integer, $s_i$ is a boolean, and $n_i$, $m_i$ are floats.",
            "solution": "The solution begins with the discretization of the weak form on a single finite element.\n\n**1. Element Formulation**\nFor a uniform mesh of $N$ elements on the domain $[0, 1]$, each element has length $h = 1/N$. The element stiffness matrix $k^e$ and force vector $f^e$ are derived from the weak form integrals over one element:\n$$\nk^e = \\frac{k}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}, \\quad f^e = \\frac{fh}{2} \\begin{bmatrix} 1 \\\\ 1 \\end{bmatrix}\n$$\n\n**2. Global Assembly and Boundary Conditions**\nThe global system $K U = F$ is assembled by summing element contributions.\n\n- **Non-Periodic Case:** The system has $N+1$ independent degrees of freedom (DOFs). The assembled matrix $K$ is singular, with a nullspace corresponding to the constant field $u(x)=C$. Imposing Dirichlet conditions at both ends (e.g., $u(0)=0, u(1)=0$) removes this nullspace and makes the system solvable.\n\n- **Periodic Case:** The condition $u(0)=u(1)$ means the DOFs at nodes $0$ and $N$ are the same. This reduces the number of independent DOFs to $N$. The global matrix $K$ is $N \\times N$, formed by mapping contributions for node $N$ to the DOF for node $0$. This matrix is also singular, with a nullspace corresponding to a constant field. A single Dirichlet constraint (an \"anchor,\" e.g., $u(0)=0$) is required to remove the nullspace and obtain a unique solution.\n\n**3. Implementation Details**\nThe following Python code implements this logic. It assembles the global matrices, computes the rank and singularity of the unconstrained matrix, applies constraints by modifying the system, solves for the DOFs, and calculates the required diagnostics for each test case.\n\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the 1D FEM diffusion problem.\n    \"\"\"\n    \n    test_cases = [\n        # Case 1 (Happy path, periodic with anchor):\n        {'N': 4, 'k': 2.0, 'f': 1.0, 'periodic': True, 'anchors': {0: 0.0}},\n        # Case 2 (Boundary case, single element, periodic with anchor):\n        {'N': 1, 'k': 1.0, 'f': 0.5, 'periodic': True, 'anchors': {0: 0.0}},\n        # Case 3 (Non-periodic with Dirichlet at both ends):\n        {'N': 4, 'k': 2.0, 'f': 1.0, 'periodic': False, 'anchors': {0: 0.0, 4: 0.0}},\n        # Case 4 (Edge case, periodic without anchor):\n        {'N': 3, 'k': 1.0, 'f': 1.0, 'periodic': True, 'anchors': {}},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_fem_case(**case)\n        results.append(result)\n\n    # Format the final output string exactly as specified.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\ndef run_fem_case(N, k, f, periodic, anchors):\n    \"\"\"\n    Solves a single instance of the 1D diffusion problem.\n    \"\"\"\n    h = 1.0 / N\n    num_physical_nodes = N + 1\n\n    # 1. Determine system size and DOF mapping\n    if periodic:\n        num_dofs = N\n        dof_map = np.arange(num_physical_nodes)\n        dof_map[N] = 0\n    else:\n        num_dofs = num_physical_nodes\n        dof_map = np.arange(num_physical_nodes)\n\n    # 2. Derive element stiffness matrix and force vector\n    k_e = (k / h) * np.array([[1, -1], [-1, 1]])\n    f_e = (f * h / 2) * np.array([1, 1])\n\n    # 3. Assemble global stiffness matrix K and force vector F\n    K = np.zeros((num_dofs, num_dofs))\n    F = np.zeros(num_dofs)\n\n    for i in range(N):\n        node1_idx = i\n        node2_idx = i + 1\n        dof1 = dof_map[node1_idx]\n        dof2 = dof_map[node2_idx]\n        dofs = [dof1, dof2]\n        \n        for local_i in range(2):\n            F[dofs[local_i]] += f_e[local_i]\n            for local_j in range(2):\n                K[dofs[local_i], dofs[local_j]] += k_e[local_i, local_j]\n\n    # 4. Compute diagnostics on the unconstrained system\n    K_pre_bc = K.copy()\n    rank = np.linalg.matrix_rank(K_pre_bc)\n    is_singular = rank  num_dofs\n\n    # 5. Apply Dirichlet boundary conditions (anchors) and solve\n    u_dof = np.zeros(num_dofs)\n    if anchors:\n        K_bc = K.copy()\n        F_bc = F.copy()\n        \n        for dof_idx, value in anchors.items():\n            mapped_dof_idx = dof_map[dof_idx]\n            \n            for j in range(num_dofs):\n                if j != mapped_dof_idx:\n                    F_bc[j] -= K_bc[j, mapped_dof_idx] * value\n            \n            K_bc[mapped_dof_idx, :] = 0.0\n            K_bc[:, mapped_dof_idx] = 0.0\n            K_bc[mapped_dof_idx, mapped_dof_idx] = 1.0\n            F_bc[mapped_dof_idx] = value\n            \n        u_dof = np.linalg.solve(K_bc, F_bc)\n\n    # 6. Reconstruct full nodal solution and compute final diagnostics\n    u_reconstructed = np.zeros(num_physical_nodes)\n    if anchors:\n        for i in range(num_physical_nodes):\n            u_reconstructed[i] = u_dof[dof_map[i]]\n    \n    norm_u = np.linalg.norm(u_reconstructed)\n    mismatch = np.abs(u_reconstructed[0] - u_reconstructed[N])\n\n    return [int(rank), is_singular, float(norm_u), float(mismatch)]\n\n# This function call is for execution within the solution context.\n# The `if __name__ == '__main__':` block is conventional for standalone script execution.\n# solve()\n```\nThe final part of the solution is the Python program itself which implements the described method and produces the required output for the test suite.",
            "answer": "[[3, True, 0.15391127533923363, 0.0],[0, True, 0.0, 0.0],[4, True, 0.15391127533923363, 0.0],[2, True, 0.0, 0.0]]"
        }
    ]
}