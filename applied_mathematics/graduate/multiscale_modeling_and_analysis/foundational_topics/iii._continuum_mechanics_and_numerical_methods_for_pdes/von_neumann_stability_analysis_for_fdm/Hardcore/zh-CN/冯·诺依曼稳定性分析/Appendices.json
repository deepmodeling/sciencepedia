{
    "hands_on_practices": [
        {
            "introduction": "冯·诺依曼稳定性分析是研究有限差分法稳定性的基石。这个练习将引导你完成一个基础但至关重要的分析过程：为一阶迎风格式推导其放大因子 $G(\\theta)$。通过确定保证所有傅里叶模式的振幅都不增长的条件，你将亲手推导出著名的 Courant-Friedrichs-Lewy (CFL) 稳定性约束 ，这是计算流体动力学中的一个核心概念。",
            "id": "3832003",
            "problem": "考虑一维线性平流方程 $u_{t} + c\\,u_{x} = 0$，其中平流速度 $c0$ 为常数。在间距为 $\\Delta x$ 的均匀空间网格和时间步长为 $\\Delta t$ 上，定义库朗数 $\\lambda = c\\,\\Delta t/\\Delta x$。对于 $c0$，一阶迎风有限差分法 (FDM) 为\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\lambda\\left(u_{j}^{n} - u_{j-1}^{n}\\right).\n$$\n使用 von Neumann (傅里叶) 稳定性分析，假设一个离散傅里叶模 $u_{j}^{n} = \\hat{u}^{n}\\,\\exp\\!\\left(i\\,j\\,\\theta\\right)$，其中相位 $\\theta \\in [-\\pi,\\pi]$ 以弧度为单位。从该差分格式和此拟设出发，推导离散放大因子 $G(\\theta)$（定义为 $G(\\theta) = \\hat{u}^{n+1}/\\hat{u}^{n}$）作为 $\\theta$ 和 $\\lambda$ 的函数，然后使用 von Neumann 稳定性判据 $\\sup_{\\theta \\in [-\\pi,\\pi]} |G(\\theta)| \\leq 1$ 来确定保证对所有傅里叶模都稳定的最大容许 Courant–Friedrichs–Lewy (CFL) 数 $\\lambda_{\\max}$。\n\n请以 $\\lambda_{\\max}$ 的精确值（无量纲）作为您最终报告的答案。",
            "solution": "所述问题具有科学依据、是适定的且客观的。它提出了一个有限差分法稳定性分析的标准练习，这是偏微分方程数值分析中的一个核心主题。所有必要的信息都已提供，术语精确且无歧义。因此，我们可以开始求解。\n\n该问题要求对线性平流方程的一阶迎风格式进行 von Neumann 稳定性分析。该格式由下式给出\n$$u_{j}^{n+1} = u_{j}^{n} - \\lambda\\left(u_{j}^{n} - u_{j-1}^{n}\\right)$$\n其中 $\\lambda = c\\,\\Delta t/\\Delta x$ 是库朗数，且 $c  0$。\n\n我们通过将单个傅里叶模的拟设 $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$ 代入有限差分格式来进行傅里叶分析。相角 $\\theta$ 定义为 $k\\,\\Delta x$，其中 $k$ 是波数。格式中的各项变为：\n$$u_{j}^{n+1} = \\hat{u}^{n+1}\\,\\exp(i\\,j\\,\\theta)$$\n$$u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$$\n$$u_{j-1}^{n} = \\hat{u}^{n}\\,\\exp(i\\,(j-1)\\,\\theta) = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)\\,\\exp(-i\\,\\theta)$$\n将这些表达式代入格式中，得到：\n$$\\hat{u}^{n+1}\\,\\exp(i\\,j\\,\\theta) = \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta) - \\lambda\\left(\\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta) - \\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)\\,\\exp(-i\\,\\theta)\\right)$$\n为求放大因子 $G(\\theta) = \\hat{u}^{n+1}/\\hat{u}^{n}$，我们将整个方程除以非零项 $\\hat{u}^{n}\\,\\exp(i\\,j\\,\\theta)$：\n$$G(\\theta) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^{n}} = 1 - \\lambda\\left(1 - \\exp(-i\\,\\theta)\\right)$$\n这就是离散放大因子作为 $\\theta$ 和 $\\lambda$ 的函数的表达式。为分析其稳定性，我们必须计算其模 $|G(\\theta)|$。通常处理模的平方 $|G(\\theta)|^2$ 更为方便。使用欧拉公式 $\\exp(-i\\,\\theta) = \\cos(\\theta) - i\\,\\sin(\\theta)$，我们可以将 $G(\\theta)$ 用其实部和虚部表示：\n$$G(\\theta) = 1 - \\lambda\\left(1 - (\\cos(\\theta) - i\\,\\sin(\\theta))\\right)$$\n$$G(\\theta) = 1 - \\lambda + \\lambda\\,\\cos(\\theta) + i\\,\\lambda\\,\\sin(\\theta)$$\n$G(\\theta)$ 的实部和虚部分别是：\n$$\\text{Re}(G(\\theta)) = 1 - \\lambda + \\lambda\\,\\cos(\\theta)$$\n$$\\text{Im}(G(\\theta)) = \\lambda\\,\\sin(\\theta)$$\n因此，模的平方为：\n$$|G(\\theta)|^2 = (\\text{Re}(G(\\theta)))^2 + (\\text{Im}(G(\\theta)))^2$$\n$$|G(\\theta)|^2 = (1 - \\lambda + \\lambda\\,\\cos(\\theta))^2 + (\\lambda\\,\\sin(\\theta))^2$$\n展开平方项：\n$$|G(\\theta)|^2 = (1 - \\lambda)^2 + 2\\lambda(1-\\lambda)\\cos(\\theta) + \\lambda^2\\cos^2(\\theta) + \\lambda^2\\sin^2(\\theta)$$\n使用三角恒等式 $\\cos^2(\\theta) + \\sin^2(\\theta) = 1$：\n$$|G(\\theta)|^2 = (1 - \\lambda)^2 + 2\\lambda(1-\\lambda)\\cos(\\theta) + \\lambda^2$$\n$$|G(\\theta)|^2 = (1 - 2\\lambda + \\lambda^2) + (2\\lambda - 2\\lambda^2)\\cos(\\theta) + \\lambda^2$$\n$$|G(\\theta)|^2 = 1 - 2\\lambda + 2\\lambda^2 + (2\\lambda - 2\\lambda^2)\\cos(\\theta)$$\n因式分解以简化表达式：\n$$|G(\\theta)|^2 = 1 + (2\\lambda^2 - 2\\lambda) - (2\\lambda^2 - 2\\lambda)\\cos(\\theta)$$\n$$|G(\\theta)|^2 = 1 + (2\\lambda^2 - 2\\lambda)(1 - \\cos(\\theta))$$\n$$|G(\\theta)|^2 = 1 + 2\\lambda(\\lambda - 1)(1 - \\cos(\\theta))$$\nvon Neumann 稳定性判据要求 $\\sup_{\\theta \\in [-\\pi,\\pi]} |G(\\theta)| \\le 1$，这等价于对所有 $\\theta \\in [-\\pi, \\pi]$ 都有 $|G(\\theta)|^2 \\le 1$。将此判据应用于我们得到的 $|G(\\theta)|^2$ 表达式：\n$$1 + 2\\lambda(\\lambda - 1)(1 - \\cos(\\theta)) \\le 1$$\n两边减去 $1$ 得到：\n$$2\\lambda(\\lambda - 1)(1 - \\cos(\\theta)) \\le 0$$\n为确定 $\\lambda$ 的条件，我们分析该不等式中各因子的符号。\n1. 库朗数 $\\lambda = c\\,\\Delta t/\\Delta x$ 是正物理量（$c0$, $\\Delta t0$, $\\Delta x0$）的乘积，因此必须有 $\\lambda \\ge 0$。（$\\lambda = 0$ 的情况对应于 $\\Delta t = 0$，此时解不随时间演化，是平凡稳定的。）\n2. 对于任何实数 $\\theta$，项 $(1 - \\cos(\\theta))$ 总是非负的，因为 $\\cos(\\theta)$ 的值域是 $[-1, 1]$。具体来说，$(1 - \\cos(\\theta)) \\ge 0$。该项仅在 $\\theta = 2\\pi k$（其中 $k$ 为整数）时为零，在其他情况下严格为正。\n\n为了使不等式 $2\\lambda(\\lambda - 1)(1 - \\cos(\\theta)) \\le 0$ 对所有 $\\theta \\in [-\\pi, \\pi]$ 成立，我们必须考察项 $\\lambda(\\lambda - 1)$。由于 $\\lambda \\ge 0$ 且 $(1 - \\cos(\\theta)) \\ge 0$，该不等式对所有 $\\theta$ 成立的充要条件是项 $(\\lambda - 1)$ 为非正。\n$$\\lambda - 1 \\le 0$$\n这意味着：\n$$\\lambda \\le 1$$\n将此与物理约束 $\\lambda \\ge 0$ 相结合，一阶迎风格式的稳定性条件是 $0 \\le \\lambda \\le 1$。\n\n问题要求保证稳定性的最大容许库朗数 $\\lambda_{\\max}$。根据推导出的稳定性范围 $0 \\le \\lambda \\le 1$，最大值为 $1$。\n因此，最大容许 Courant–Friedrichs–Lewy (CFL) 数为 $\\lambda_{\\max} = 1$。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "理论分析的威力在于其预测能力，而验证这些预测是科学计算的关键环节。此实践旨在通过一个数值实验来弥合理论与实践之间的差距，在这里你将模拟一个单一傅里叶模式在热传导方程的显式格式下的演化 。通过编程计算模式振幅的实际增长，并将其与冯·诺依曼分析得出的解析放大因子进行比较，你将直观地理解该理论的有效性，并掌握一种重要的代码验证技术。",
            "id": "3831988",
            "problem": "考虑无量纲形式的一维扩散方程 $\\partial_t u(x,t) = \\alpha\\,\\partial_{xx} u(x,t)$，该方程定义在一个周期性域上，并用一个具有 $N$ 个点、指标为 $j \\in \\{0,1,\\dots,N-1\\}$、网格间距为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格进行离散化。设数值格式为时间上采用前向欧拉法，空间上结合二阶中心有限差分，并应用周期性边界条件。定义无量纲参数 $\\mu = \\alpha\\,\\Delta t / \\Delta x^2$。通过单一傅里叶模式 $u_j^0 = \\exp(i\\,\\theta\\,j)$ 来初始化时间步 $n=0$ 时的离散解，其中离散角度 $\\theta$ 必须满足周期性，由 $\\theta = 2\\pi m / N$ 给出，其中 $m$ 是一个整数模式指标。角度必须以弧度表示。\n\n你的任务是设计一个数值实验，测量在数值格式的一个时间步下此单一傅里叶模式的增长情况，以经验性地估计增长因子 $\\lvert G(\\theta) \\rvert$ 的模，并将其与你为此格式从第一性原理推导出的解析预测进行比较。具体来说：\n- 计算格式从 $u_j^0$ 到 $u_j^1$ 的一个时间步，并应用周期性边界条件。\n- 通过离散傅里叶投影 $A^n = \\frac{1}{N}\\sum_{j=0}^{N-1} u_j^n \\exp(-i\\,\\theta\\,j)$ 来估计在时间步 $n$ 时傅里叶模式的复振幅系数 $A^n$，并将增长因子的经验模定义为 $\\lvert G_{\\mathrm{emp}}(\\theta) \\rvert = \\lvert A^1 \\rvert / \\lvert A^0 \\rvert$。\n- 将 $\\lvert G_{\\mathrm{emp}}(\\theta) \\rvert$ 与你通过对给定有限差分格式进行 von Neumann 稳定性分析所获得的解析模 $\\lvert G_{\\mathrm{ana}}(\\theta) \\rvert$ 进行比较。\n\n设计程序以评估以下测试套件。对于每个测试用例，参数为 $(N,m,\\mu)$，角度为 $\\theta = 2\\pi m / N$ (以弧度为单位)：\n1. $N=64, m=8, \\mu=0.25$。\n2. $N=64, m=32, \\mu=0.50$。\n3. $N=64, m=32, \\mu=0.60$。\n4. $N=128, m=16, \\mu=0.25$。\n5. $N=64, m=0, \\mu=0.25$。\n\n对于这五个测试用例中的每一个，计算绝对误差 $E_k = \\lvert \\lvert G_{\\mathrm{emp}}(\\theta_k) \\rvert - \\lvert G_{\\mathrm{ana}}(\\theta_k) \\rvert \\rvert$，结果为浮点数。此外，计算一个跨尺度一致性诊断量 $D$，定义为测试 1 和 4 的经验模之间的绝对差 $D = \\lvert \\lvert G_{\\mathrm{emp}}(\\theta_1) \\rvert - \\lvert G_{\\mathrm{emp}}(\\theta_4) \\rvert \\rvert$。该诊断量分离出在两个不同网格上实现的相同离散角度 $\\theta$，从而测试增长因子的尺度不变性。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[E_1,E_2,E_3,E_4,E_5,D]$。所有角度必须以弧度为单位。除了这些无量纲量之外，不需要任何物理单位。输出必须是浮点数。",
            "solution": "我们从周期性域上的一维扩散方程 $\\partial_t u(x,t) = \\alpha\\,\\partial_{xx} u(x,t)$ 开始，并应用一种线性、平移不变的有限差分方法：时间上采用前向欧拉法，空间上采用二阶中心差分。在一个具有指标 $j \\in \\{0,1,\\dots,N-1\\}$、网格间距 $\\Delta x$ 和时间步长 $\\Delta t$ 的均匀网格上，定义无量纲时间步参数 $\\mu = \\alpha\\,\\Delta t/\\Delta x^2$。周期性边界条件意味着对于所有整数 $j$ 和时间步 $n$ 都有 $u_{j+N}^n = u_j^n$。\n\n离散格式写作\n$$\nu_j^{n+1} = u_j^n + \\mu\\left(u_{j+1}^n - 2u_j^n + u_{j-1}^n\\right),\n$$\n其中二阶中心有限差分近似 $\\partial_{xx} u$，前向欧拉法在时间上推进。因为该算子是线性的、具有常系数且平移不变的，所以离散傅里叶模式是其特征函数。考虑离散傅里叶拟设\n$$\nu_j^n = A^n \\exp(i\\,\\theta\\,j),\n$$\n其中离散角度 $\\theta$ 满足周期性约束 $\\theta = 2\\pi m / N$，其中 $m$ 是一个整数模式指标。将该拟设代入格式中，得到\n$$\nA^{n+1}\\exp(i\\,\\theta\\,j) = A^n\\exp(i\\,\\theta\\,j) + \\mu\\left[ A^n\\exp\\big(i\\,\\theta\\,(j+1)\\big) - 2A^n\\exp(i\\,\\theta\\,j) + A^n\\exp\\big(i\\,\\theta\\,(j-1)\\big)\\right].\n$$\n两边同除以 $\\exp(i\\,\\theta\\,j)$ 和 $A^n$，得到增长因子\n$$\nG(\\theta) = \\frac{A^{n+1}}{A^n} = 1 + \\mu\\left(e^{i\\theta} - 2 + e^{-i\\theta}\\right).\n$$\n使用恒等式 $e^{i\\theta} + e^{-i\\theta} = 2\\cos\\theta$ 进行化简\n$$\nG(\\theta) = 1 + \\mu\\left(2\\cos\\theta - 2\\right) = 1 - 2\\mu(1 - \\cos\\theta).\n$$\n此外，使用三角半角恒等式 $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$，得到\n$$\nG(\\theta) = 1 - 4\\mu\\,\\sin^2\\!\\left(\\frac{\\theta}{2}\\right).\n$$\n对于这个实数扩散格式，$G(\\theta)$ 是实值的，其模为\n$$\n\\lvert G(\\theta) \\rvert = \\left\\lvert 1 - 4\\mu\\,\\sin^2\\!\\left(\\frac{\\theta}{2}\\right)\\right\\rvert.\n$$\n经典的 von Neumann (傅里叶) 稳定性条件源于对所有 $\\theta$ 都要求 $\\lvert G(\\theta) \\rvert \\le 1$，这导致 $\\mu \\le \\frac{1}{2}$。当等号成立时，在奈奎斯特频率处得到 $\\lvert G(\\pi) \\rvert = 1$ 并发生符号反转。\n\n数值实验的基于原理的算法设计：\n1. 选择 $N$、 $m$ 和 $\\mu$，并计算离散角度 $\\theta = 2\\pi m / N$ (以弧度为单位)。\n2. 通过单一傅里叶模式 $u_j^0 = \\exp(i\\,\\theta\\,j)$（对于 $j=0,\\dots,N-1$）来初始化时间步 $n=0$ 时的离散解。\n3. 应用格式的一个时间步，并使用周期性边界条件：\n   $$\n   u_j^{1} = u_j^0 + \\mu\\left(u_{j+1}^0 - 2u_j^0 + u_{j-1}^0\\right),\n   $$\n   使用指标环绕，使得 $u_{-1}^0 = u_{N-1}^0$ 且 $u_{N}^0 = u_0^0$。\n4. 通过在模式 $\\exp(i\\,\\theta\\,j)$ 上的离散傅里叶投影来估计时间步 $n=0$ 和 $n=1$ 时的振幅系数：\n   $$\n   A^n = \\frac{1}{N}\\sum_{j=0}^{N-1} u_j^n \\exp(-i\\,\\theta\\,j).\n   $$\n   因为初始化是纯模式，且算子在傅里叶基下是对角的，所以在舍入误差范围内有 $A^0 = 1$ 和 $A^1 = G(\\theta)$。\n5. 定义经验模 $\\lvert G_{\\mathrm{emp}}(\\theta) \\rvert = \\lvert A^1 \\rvert / \\lvert A^0 \\rvert$ 和解析模 $\\lvert G_{\\mathrm{ana}}(\\theta) \\rvert = \\left\\lvert 1 - 4\\mu\\,\\sin^2(\\theta/2)\\right\\rvert$。\n6. 计算每个测试用例的绝对误差 $E_k = \\lvert \\lvert G_{\\mathrm{emp}}(\\theta_k) \\rvert - \\lvert G_{\\mathrm{ana}}(\\theta_k) \\rvert \\rvert$。\n7. 为了测试跨尺度不变性，使用两个实现相同离散角度 $\\theta$ 的网格（例如，$N=64,m=8$ 和 $N=128,m=16$ 都得到 $\\theta = \\pi/4$）。计算 $D = \\lvert \\lvert G_{\\mathrm{emp}}(\\theta_1) \\rvert - \\lvert G_{\\mathrm{emp}}(\\theta_4) \\rvert \\rvert$。\n\n测试套件覆盖范围的基本原理：\n- 情况 1 ($N=64, m=8, \\mu=0.25$)：稳定区域 ($\\mu  1/2$) 内的中低波数，用于验证典型的衰减。\n- 情况 2 ($N=64, m=32, \\mu=0.50$)：稳定性边界 ($\\mu = 1/2$) 处的奈奎斯特频率，产生中性模 $\\lvert G \\rvert = 1$ 并伴有符号反转。\n- 情况 3 ($N=64, m=32, \\mu=0.60$)：不稳定区域 ($\\mu  1/2$) 内的相同奈奎斯特频率，用于验证 $\\lvert G \\rvert  1$ 的增长。\n- 情况 4 ($N=128, m=16, \\mu=0.25$)：在更精细的网格上与情况 1 具有相同的离散角度，用于测试多尺度一致性（在固定的 $\\theta$ 下，网格加密不改变增长率）。\n- 情况 5 ($N=64, m=0, \\mu=0.25$)：零模式，扩散过程会精确保持其模不变，这提供了一个边界检查（$\\theta=0$ 意味着 $\\lvert G \\rvert = 1$）。\n\n该程序使用向量化操作和周期性平移来实现该格式，通过投影到初始化的傅里叶模式来估计振幅，根据推导出的公式评估解析预测，并以指定的单行输出格式报告绝对误差和跨尺度诊断量。",
            "answer": "```python\nimport numpy as np\n\ndef empirical_G_magnitude(N, m, mu):\n    \"\"\"\n    Compute the empirical magnitude of the amplification factor |G_emp(theta)|\n    for one forward Euler + centered-difference diffusion step on a periodic grid.\n\n    Parameters:\n        N (int): number of grid points\n        m (int): discrete Fourier mode index\n        mu (float): nondimensional time step parameter alpha*dt/dx^2\n\n    Returns:\n        float: empirical |G(theta)|\n        float: analytical |G(theta)|\n    \"\"\"\n    # Discrete angle in radians\n    theta = 2.0 * np.pi * m / N\n\n    # Grid indices j = 0,...,N-1\n    j = np.arange(N, dtype=np.float64)\n\n    # Initialize single Fourier mode u_j^0 = exp(i * theta * j)\n    u0 = np.exp(1j * theta * j)\n\n    # One time step: u^{1} = u^{0} + mu (u_{j+1}^0 - 2 u_j^0 + u_{j-1}^0)\n    u_plus = np.roll(u0, -1)   # u_{j+1}^0 with periodic wrap\n    u_minus = np.roll(u0, 1)   # u_{j-1}^0 with periodic wrap\n    u1 = u0 + mu * (u_plus - 2.0 * u0 + u_minus)\n\n    # Discrete Fourier projection to estimate amplitudes\n    # A^n = (1/N) sum_j u_j^n * exp(-i * theta * j)\n    phase = np.exp(-1j * theta * j)\n    A0 = (u0 * phase).sum() / N\n    A1 = (u1 * phase).sum() / N\n\n    # Empirical magnitude of amplification factor\n    G_emp_mag = np.abs(A1) / np.abs(A0)\n\n    # Analytical magnitude from von Neumann analysis: |1 - 4 mu sin^2(theta/2)|\n    G_ana_mag = np.abs(1.0 - 4.0 * mu * (np.sin(theta / 2.0) ** 2))\n\n    return float(G_emp_mag), float(G_ana_mag)\n\ndef solve():\n    # Define the test cases (N, m, mu)\n    test_cases = [\n        (64, 8, 0.25),   # Case 1\n        (64, 32, 0.50),  # Case 2 (Nyquist at stability boundary)\n        (64, 32, 0.60),  # Case 3 (Nyquist in unstable regime)\n        (128, 16, 0.25), # Case 4 (same theta as Case 1 on finer grid)\n        (64, 0, 0.25),   # Case 5 (zero mode)\n    ]\n\n    empirical_mags = []\n    errors = []\n\n    for N, m, mu in test_cases:\n        G_emp_mag, G_ana_mag = empirical_G_magnitude(N, m, mu)\n        empirical_mags.append(G_emp_mag)\n        errors.append(abs(G_emp_mag - G_ana_mag))\n\n    # Cross-scale consistency diagnostic: difference between empirical magnitudes for Cases 1 and 4\n    D = abs(empirical_mags[0] - empirical_mags[3])\n\n    # Prepare final results: [E1,E2,E3,E4,E5,D]\n    results = errors + [D]\n\n    # Print single-line output in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "标准的冯·诺依曼分析假设系数是恒定的，但在许多实际应用中，如多尺度模型中，材料属性可能是剧烈变化的。这个高级实践挑战了“冻结系数”这一简化假设的有效性，揭示了它在某些情况下可能导致错误的稳定性预测 。通过编写程序来计算变系数问题中离散算子的完整谱，你将确定精确的稳定性边界，并将其与朴素的理论预测以及更高级的局部傅里叶分析（LFA）结果进行比较，从而深入理解系数变化对稳定性的深刻影响。",
            "id": "3831873",
            "problem": "考虑具有可变扩散系数的一维抛物型偏微分方程，\n$$\n\\frac{\\partial u}{\\partial t} = a(x)\\,\\frac{\\partial^2 u}{\\partial x^2},\n$$\n该方程定义在长度为 $L$ 的周期性区域 $x \\in [0,L]$ 上，其中 $a(x)  0$ 有界且可测。一个采用中心空间差分的标准显式时间步进方法，在均匀网格 $x_i = i\\,\\Delta x$（$i=0,1,\\dots,N-1$，$\\Delta x = L/N$）上，通过以下方式更新 $u_i^n \\approx u(x_i,t_n)$：\n$$\nu_i^{n+1} = u_i^n + \\Delta t\\, a_i \\frac{u_{i+1}^n - 2 u_i^n + u_{i-1}^n}{\\Delta x^2},\n$$\n其中采用周期性索引 $u_{-1}^n \\equiv u_{N-1}^n$ 和 $u_{N}^n \\equiv u_0^n$，且 $a_i = a(x_i)$。写成矩阵形式，此更新可表示为\n$$\n\\boldsymbol{u}^{n+1} = \\left(\\boldsymbol{I} + \\Delta t\\,\\boldsymbol{A}\\right)\\,\\boldsymbol{u}^n,\n$$\n其中 $\\boldsymbol{I}$ 是单位矩阵，且\n$$\n\\boldsymbol{A} = \\frac{1}{\\Delta x^2}\\,\\operatorname{diag}(a_0,a_1,\\dots,a_{N-1})\\,\\boldsymbol{L}_0,\n$$\n其中 $\\boldsymbol{L}_0$ 是具有周期性边界条件的标准二阶差分矩阵，定义为 $(\\boldsymbol{L}_0 \\boldsymbol{u})_i = u_{i+1} - 2 u_i + u_{i-1}$。对于常数 $a(x) \\equiv a_0$，经典的 von Neumann (Fourier) 分析得出前向 Euler 方法的最大稳定时间步长为，\n$$\n\\Delta t_{\\text{const}} = \\frac{\\Delta x^2}{2 a_0}.\n$$\n对于可变的 $a(x)$，一个朴素的“冻结系数”稳定性界限是将 $a_0$ 替换为 $\\max_i a_i$ 并断言\n$$\n\\Delta t_{\\text{naive}} = \\frac{\\Delta x^2}{2 \\max_i a_i}.\n$$\n然而，当 $a(x)$ 在网格尺度上快速变化时，放大矩阵 $\\boldsymbol{I} + \\Delta t\\,\\boldsymbol{A}$ 会耦合傅里叶模式，导致朴素界限可能无效。前向 Euler 方法的稳定区域是复平面上以 $-1$ 为中心、半径为 $1$ 的闭圆盘，因此稳定性要求对于 $\\boldsymbol{A}$ 的每个特征值 $\\lambda$ 都有，\n$$\n\\Delta t\\,\\lambda \\in \\{ z \\in \\mathbb{C} : |z+1| \\le 1 \\}.\n$$\n等价地，最大允许时间步长为\n$$\n\\Delta t_{\\text{actual}} = \\min_{\\lambda \\in \\sigma(\\boldsymbol{A}),\\,\\Re(\\lambda)  0} \\frac{-2\\,\\Re(\\lambda)}{|\\lambda|^2},\n$$\n其中 $\\sigma(\\boldsymbol{A})$ 是 $\\boldsymbol{A}$ 的谱。\n\n在多尺度背景下，一种替代朴素冻结系数法的原则性方法是适应于系数微观尺度的局部傅里叶 (Bloch-Floquet) 分析。对于周期为 $p$ 的系数模式，我们寻找具有 $p$ 分量振幅的平面波解，并推导出一个 $p \\times p$ 的符号矩阵，其特征值可近似谱。对于周期为 $2$ 的交替模式，即当 $i$ 为偶数时 $a_i = H$，当 $i$ 为奇数时 $a_i = L$，定义离散波数 $\\theta \\in [-\\pi,\\pi]$（以弧度为单位）以及分别对应偶数和奇数网格点的块振幅 $v_{\\text{e}}$ 和 $v_{\\text{o}}$。$\\boldsymbol{A}$ 的关联 $2 \\times 2$ 符号矩阵为\n$$\n\\boldsymbol{M}(\\theta) = \\frac{1}{\\Delta x^2}\n\\begin{bmatrix}\n-2H  2H\\cos(\\theta) \\\\\n2L\\cos(\\theta)  -2L\n\\end{bmatrix},\n$$\n其特征值 $\\mu(\\theta)$ 提供了 $\\sigma(\\boldsymbol{A})$ 的多尺度局部傅里叶估计，并由此得到稳定性界限，\n$$\n\\Delta t_{\\text{LFA}} = \\min_{\\theta \\in [-\\pi,\\pi],\\,\\mu(\\theta)} \\frac{-2\\,\\Re(\\mu(\\theta))}{|\\mu(\\theta)|^2}.\n$$\n\n您的任务是编写一个完整的、可运行的程序，该程序：\n- 在周期性网格上为给定的 $a_i$ 构建矩阵 $\\boldsymbol{A}$，并使用上述谱准则计算 $\\Delta t_{\\text{actual}}$。\n- 计算 $\\Delta t_{\\text{naive}}$。\n- 对于周期为 $2$ 的交替模式，通过在 $\\theta \\in [-\\pi,\\pi]$ 上最小化由 $\\boldsymbol{M}(\\theta)$ 导出的前向 Euler 界限来计算 $\\Delta t_{\\text{LFA}}$。\n- 汇总指定测试套件的结果。\n\n使用以下测试套件：\n- 测试 $1$ (基线常数系数)：$N = 128$，$L = 1$，$a_i \\equiv a_0 = 1$。输出相对误差 $\\delta_1 = \\left|\\Delta t_{\\text{actual}} - \\Delta t_{\\text{naive}}\\right|/\\Delta t_{\\text{actual}}$，结果为浮点数。\n- 测试 $2$ (缓慢变化系数)：$N = 128$，$L = 1$，$a_i = 1 + 0.1\\sin(2\\pi x_i)$，其中 $x_i = i \\Delta x$。输出布尔值 $v_2$ 以指示朴素界限是否有效，定义为 $v_2 = \\left(\\Delta t_{\\text{naive}} \\le \\Delta t_{\\text{actual}}\\right)$。\n- 测试 $3$ (快速振荡反例)：$N = 128$，$L = 1$，当 $i$ 为偶数时 $a_i = H$，当 $i$ 为奇数时 $a_i = L$，其中 $H = 10$ 且 $L = 0.1$。输出布尔值 $v_3$ 以指示朴素界限的失效，定义为 $v_3 = \\left(\\Delta t_{\\text{naive}}  \\Delta t_{\\text{actual}}\\right)$。\n- 测试 $4$ (周期为 $2$ 的多尺度局部傅里叶分析)：使用与测试 $3$ 相同的参数。通过符号矩阵 $\\boldsymbol{M}(\\theta)$ 计算 $\\Delta t_{\\text{LFA}}$，并输出列表 $[\\rho_{\\text{naive}}, \\rho_{\\text{LFA}}]$，其中\n$$\n\\rho_{\\text{naive}} = \\frac{\\left|\\Delta t_{\\text{naive}} - \\Delta t_{\\text{actual}}\\right|}{\\Delta t_{\\text{actual}}}, \\quad\n\\rho_{\\text{LFA}} = \\frac{\\left|\\Delta t_{\\text{LFA}} - \\Delta t_{\\text{actual}}\\right|}{\\Delta t_{\\text{actual}}}.\n$$\n\n角度量 $\\theta$ 必须以弧度处理。所有量均为无量纲。您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中四个测试用例的输出按顺序排列，即 $[\\delta_1, v_2, v_3, [\\rho_{\\text{naive}}, \\rho_{\\text{LFA}}]]$。",
            "solution": "问题陈述已经过仔细审查，并被确定为有效。它在科学上基于偏微分方程数值分析的原理，特别是关于显式有限差分法稳定性的问题。该问题是适定的，所有必要的参数、定义和条件都已提供，可以得出一个唯一的、可验证的解。语言是客观的，任务是可形式化的。\n\n问题的核心是比较一维热传导方程（具有可变扩散系数 $a(x)$）的前向 Euler 离散化的最大稳定时间步长 $\\Delta t$ 的不同估计。该格式为\n$$\nu_i^{n+1} = u_i^n + \\frac{\\Delta t \\cdot a_i}{\\Delta x^2} (u_{i+1}^n - 2 u_i^n + u_{i-1}^n).\n$$\n其矩阵形式为 $\\boldsymbol{u}^{n+1} = (\\boldsymbol{I} + \\Delta t \\boldsymbol{A}) \\boldsymbol{u}^n$，其中矩阵 $\\boldsymbol{A}$ 封装了空间离散化。稳定性要求放大矩阵 $\\boldsymbol{G} = \\boldsymbol{I} + \\Delta t \\boldsymbol{A}$ 的谱半径不大于 $1$。对于前向 Euler 方法，如果 $\\boldsymbol{A}$ 的每个特征值 $\\lambda$ 都满足 $\\Delta t \\lambda$ 位于稳定区域 $\\{ z \\in \\mathbb{C} : |z+1| \\le 1 \\}$ 内，则稳定性得到保证。这导出了最大稳定时间步长的公式：\n$$\n\\Delta t_{\\text{actual}} = \\min_{\\lambda \\in \\sigma(\\boldsymbol{A}),\\,\\Re(\\lambda)  0} \\frac{-2\\,\\Re(\\lambda)}{|\\lambda|^2}.\n$$\n\n解决此问题的过程涉及三个主要计算：$\\Delta t_{\\text{actual}}$、$\\Delta t_{\\text{naive}}$ 和 $\\Delta t_{\\text{LFA}}$。\n\n**1. 实际时间步长 ($\\Delta t_{\\text{actual}}$)**\n\n这需要矩阵 $\\boldsymbol{A}$ 的全谱。矩阵 $\\boldsymbol{A}$ 定义为\n$$\n\\boldsymbol{A} = \\frac{1}{\\Delta x^2} \\boldsymbol{D}_a \\boldsymbol{L}_0,\n$$\n其中 $\\boldsymbol{D}_a = \\operatorname{diag}(a_0, a_1, \\dots, a_{N-1})$ 是网格点上扩散系数的对角矩阵，$\\boldsymbol{L}_0$ 是周期性区域上的 $N \\times N$ 二阶差分矩阵。$\\boldsymbol{L}_0$ 是一个循环矩阵，主对角线元素为 $-2$，第一超对角线和次对角线元素为 $1$，右上角和左下角元素为 $1$ 以强制周期性。具体来说，其元素为 $(\\boldsymbol{L}_0)_{ij} = \\delta_{i,j+1} - 2\\delta_{i,j} + \\delta_{i,j-1}$，索引以 $N$ 为模。\n为计算 $\\Delta t_{\\text{actual}}$，我们为给定的系数函数 $a(x)$ 构建 $N \\times N$ 矩阵 $\\boldsymbol{A}$，数值计算其特征值 $\\lambda_j$，滤除任何实部非负的特征值（例如与常数模式相关的零特征值），并应用给定公式找到所有相关特征值中的最小界限。\n\n**2. 朴素时间步长 ($\\Delta t_{\\text{naive}}$)**\n\n该界限源自“冻结系数”分析，其中常数系数 $a_0$ 的稳定性极限（即 $\\frac{\\Delta x^2}{2a_0}$）通过代入网格上 $a(x)$ 的最大值来调整。\n$$\n\\Delta t_{\\text{naive}} = \\frac{\\Delta x^2}{2 \\max_i a_i}.\n$$\n这个界限计算简单，但可能不准确，特别是当 $a(x)$ 在与网格间距 $\\Delta x$相当的尺度上变化时。\n\n**3. 局部傅里叶分析时间步长 ($\\Delta t_{\\text{LFA}}$)**\n\n对于周期为 $2$ 的系数分布（即当 $i$ 为偶数时 $a_i = H$，当 $i$ 为奇数时 $a_i = L$）的特定情况，可以使用局部傅里叶分析（也称为 Bloch-Floquet 理论）推导出一个更复杂的估计。问题提供了 $2 \\times 2$ 符号矩阵 $\\boldsymbol{M}(\\theta)$：\n$$\n\\boldsymbol{M}(\\theta) = \\frac{1}{\\Delta x^2}\n\\begin{bmatrix}\n-2H  2H\\cos(\\theta) \\\\\n2L\\cos(\\theta)  -2L\n\\end{bmatrix}.\n$$\n该矩阵的特征值 $\\mu(\\theta)$ 近似于 $\\boldsymbol{A}$ 的谱。为了找到 $\\Delta t_{\\text{LFA}}$，我们必须找到由这些特征值施加的最严格的稳定性约束。$\\boldsymbol{M}(\\theta)$ 的特征值通过求解特征方程 $\\det(\\boldsymbol{M}(\\theta) - \\mu\\boldsymbol{I}) = 0$ 来找到。令 $\\tilde{\\mu} = \\mu \\Delta x^2$。方程变为 $\\tilde{\\mu}^2 + 2(H+L)\\tilde{\\mu} + 4HL\\sin^2(\\theta) = 0$。\n解为\n$$\n\\tilde{\\mu}_{\\pm}(\\theta) = -(H+L) \\pm \\sqrt{(H+L)^2 - 4HL\\sin^2(\\theta)} = -(H+L) \\pm \\sqrt{(H-L)^2 + 4HL\\cos^2(\\theta)}.\n$$\n由于 $H, L  0$，平方根下的项总是非负的，因此特征值 $\\mu(\\theta) = \\tilde{\\mu}(\\theta) / \\Delta x^2$ 总是实数且非正。对于一个实的负特征值 $\\mu$，稳定性极限为 $\\Delta t \\le -2/\\mu$。为了找到总的时间步长极限，我们必须找到在所有特征值和所有 $\\theta \\in [-\\pi, \\pi]$ 上该值的最小值。这等价于找到最负的特征值 $\\mu$（即具有最大绝对值的特征值）。\n我们寻求 $\\mu_{\\min} = \\min_{\\theta} \\mu_{-}(\\theta)$，其中 $\\mu_{-}(\\theta)$ 是带负号的分支。当平方根项最大化时，该表达式最小化，这发生在 $\\cos^2(\\theta)=1$ 时，即 $\\theta = 0$ 或 $\\theta = \\pi$。在这些值上：\n$$\n\\tilde{\\mu}_{\\min} = -(H+L) - \\sqrt{(H-L)^2 + 4HL} = -(H+L) - (H+L) = -2(H+L).\n$$\n来自 LFA 的最严格的特征值是 $\\mu_{\\min} = -2(H+L)/\\Delta x^2$。相应的稳定性界限是\n$$\n\\Delta t_{\\text{LFA}} = \\frac{-2}{\\mu_{\\min}} = \\frac{-2}{-2(H+L)/\\Delta x^2} = \\frac{\\Delta x^2}{H+L}.\n$$\n\n求解过程是通过将这些计算应用于具体的测试用例来进行的。\n\n- **测试 $1$ (常数系数):** $a_i \\equiv 1$。此时，矩阵 $\\boldsymbol{A}$ 是 $\\boldsymbol{L}_0$ 的标量倍，并且是正规矩阵。理论预测 $\\Delta t_{\\text{actual}} = \\Delta t_{\\text{naive}} = \\frac{\\Delta x^2}{2}$。因此，相对误差 $\\delta_1$ 应该为零（或数值上非常接近零）。\n\n- **测试 $2$ (缓慢变化系数):** $a(x) = 1 + 0.1\\sin(2\\pi x)$。变化是平滑的，并且发生在与区域长度 $L$ 相当的尺度上，该尺度远大于网格尺度 $\\Delta x$。在这种情况下，已知朴素的冻结系数界限是一个良好且保守的估计。我们预期 $\\Delta t_{\\text{naive}} \\le \\Delta t_{\\text{actual}}$，使得 $v_2$ 为真。\n\n- **测试 $3$ (快速振荡系数):** 一个具有高对比度（$H=10, L=0.1$）的周期为 $2$ 的模式。这是一个著名的反例，其中朴素界限会严重失效。系数中的高频振荡与解的高波数模式耦合，产生比 $\\max_i a_i$ 预测的要严格得多的稳定性极限。我们预期 $\\Delta t_{\\text{naive}}  \\Delta t_{\\text{actual}}$，使得 $v_3$ 为真。\n\n- **测试 $4$ (周期为 $2$ 的 LFA):** 对于与测试 $3$ 相同的参数，我们通过计算 $\\Delta t_{\\text{naive}}$ 和 $\\Delta t_{\\text{LFA}}$ 相对于 $\\Delta t_{\\text{actual}}$ 的相对误差来比较它们的准确性。LFA 方法旨在捕捉多尺度相互作用，因此我们预期 $\\Delta t_{\\text{LFA}}$ 会是比 $\\Delta t_{\\text{naive}}$ 好得多的 $\\Delta t_{\\text{actual}}$ 近似。这意味着 $\\rho_{\\text{LFA}} \\ll \\rho_{\\text{naive}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem and print the results according to the specification.\n    \"\"\"\n\n    def calculate_dt_actual(N, L, a_coeffs):\n        \"\"\"\n        Calculates the exact maximum stable time step by spectral analysis of the matrix A.\n        \"\"\"\n        dx = L / N\n\n        # Construct the periodic second-difference matrix L0\n        c = np.zeros(N)\n        c[0] = -2\n        c[1] = 1\n        c[N - 1] = 1\n        L0 = linalg.circulant(c)\n\n        # Construct the matrix A\n        D_a = np.diag(a_coeffs)\n        A = (1 / dx**2) * D_a @ L0\n\n        # Calculate eigenvalues of A\n        eigenvalues = np.linalg.eigvals(A)\n\n        # Filter for eigenvalues with negative real part, excluding the zero eigenvalue\n        # A small tolerance is used for floating point comparisons.\n        relevant_eigenvalues = eigenvalues[np.real(eigenvalues)  -1e-9]\n\n        # Calculate the stability bound from each relevant eigenvalue\n        bounds = -2 * np.real(relevant_eigenvalues) / (np.abs(relevant_eigenvalues)**2)\n        \n        # The maximum stable time step is the minimum of these bounds\n        return np.min(bounds)\n\n    results = []\n\n    # --- Test 1: Constant coefficient ---\n    N1, L1 = 128, 1.0\n    a0 = 1.0\n    dx1 = L1 / N1\n    a_coeffs1 = np.full(N1, a0)\n    \n    dt_actual1 = calculate_dt_actual(N1, L1, a_coeffs1)\n    dt_naive1 = (dx1**2) / (2 * np.max(a_coeffs1))\n    \n    delta_1 = np.abs(dt_actual1 - dt_naive1) / dt_actual1 if dt_actual1 != 0 else 0.0\n    results.append(delta_1)\n\n    # --- Test 2: Slowly varying coefficient ---\n    N2, L2 = 128, 1.0\n    dx2 = L2 / N2\n    x_grid2 = np.linspace(0, L2, N2, endpoint=False)\n    a_coeffs2 = 1.0 + 0.1 * np.sin(2 * np.pi * x_grid2)\n\n    dt_actual2 = calculate_dt_actual(N2, L2, a_coeffs2)\n    dt_naive2 = (dx2**2) / (2 * np.max(a_coeffs2))\n\n    v_2 = dt_naive2 = dt_actual2\n    results.append(v_2)\n\n    # --- Test 3  4: Rapidly oscillatory coefficient ---\n    N3, L3 = 128, 1.0\n    H, L_val = 10.0, 0.1\n    dx3 = L3 / N3\n    \n    a_coeffs3 = np.full(N3, L_val)\n    a_coeffs3[::2] = H  # Even indices get H\n\n    dt_actual3 = calculate_dt_actual(N3, L3, a_coeffs3)\n    dt_naive3 = (dx3**2) / (2 * np.max(a_coeffs3))\n\n    # Test 3 result\n    v_3 = dt_naive3 > dt_actual3\n    results.append(v_3)\n\n    # Test 4 calculations\n    dt_lfa = (dx3**2) / (H + L_val)\n    \n    rho_naive = np.abs(dt_naive3 - dt_actual3) / dt_actual3\n    rho_lfa = np.abs(dt_lfa - dt_actual3) / dt_actual3\n    results.append([rho_naive, rho_lfa])\n\n    # Format the final output string as specified\n    final_output_string = f\"[{results[0]},{results[1]},{results[2]},[{results[3][0]},{results[3][1]}]]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}