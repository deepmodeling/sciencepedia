{
    "hands_on_practices": [
        {
            "introduction": "The first step in understanding any interatomic potential is connecting its abstract definitions to a concrete physical system. This practice grounds the Embedded Atom Method by calculating the host electron density, $\\rho_i$, for an atom in a perfect face-centered cubic (fcc) lattice. By deriving contributions from successive neighbor shells, you will develop a quantitative feel for how the local atomic environment is encoded in the EAM formalism and how the interaction range is controlled by the potential's parameters .",
            "id": "3754290",
            "problem": "Consider a monatomic crystal with face-centered cubic (fcc) structure and conventional cubic lattice parameter $a$. In the Embedded Atom Method (EAM), the host electron density at atom $i$ is defined as $\\rho_i = \\sum_{j \\neq i} f(r_{ij})$, where $r_{ij}$ is the scalar distance between atoms $i$ and $j$, and $f(r)$ is a spherically decaying electron cloud contribution from atom $j$ to atom $i$. Assume $f(r) = \\rho_s \\exp(-\\alpha r)$, where $\\rho_s$ is a constant amplitude and $\\alpha > 0$ is the decay rate. \n\nStarting from the definition of the electron density and the geometric structure of an fcc lattice, do the following:\n\n1. Determine, from first principles of the fcc geometry, the distances and coordination numbers for the first three neighbor shells around a given atom. Use these to construct the truncated host electron density $\\rho_i^{(3)}(\\alpha,a)$ that includes only contributions from the first three shells. Express $\\rho_i^{(3)}(\\alpha,a)$ in a closed form in terms of $a$, $\\alpha$, and $\\rho_s$.\n\n2. Define the shell contributions $C_k(\\alpha,a)$ for $k=1,2,3$ as the partial sums from the $k$-th shell alone. Analyze qualitatively and quantitatively how the relative weights $w_k(\\alpha,a) = C_k(\\alpha,a)\\big/\\sum_{m=1}^{3}C_m(\\alpha,a)$ vary with $\\alpha$, including their limiting behavior as $\\alpha \\to 0^{+}$ and as $\\alpha \\to +\\infty$.\n\n3. To quantify when the first shell “dominates,” enforce the constraint that the second and third shell contributions are each no more than $5\\%$ of the first-shell contribution, i.e., $C_2(\\alpha,a) \\leq 0.05\\,C_1(\\alpha,a)$ and $C_3(\\alpha,a) \\leq 0.05\\,C_1(\\alpha,a)$. Derive the minimal decay rate $\\alpha^{\\ast}(a)$ that satisfies both constraints simultaneously, and provide $\\alpha^{\\ast}(a)$ as a single, closed-form analytical expression.\n\nProvide the final answer as a single analytical expression for $\\alpha^{\\ast}(a)$, with no numerical rounding. No units are required because the answer must be expressed symbolically in terms of $a$.",
            "solution": "We begin from the Embedded Atom Method (EAM) definition of host electron density at site $i$,\n$$\n\\rho_i \\;=\\; \\sum_{j \\neq i} f(r_{ij}),\n$$\nwith $f(r) = \\rho_s \\exp(-\\alpha r)$, where $\\rho_s$ is a constant amplitude and $\\alpha > 0$ is the decay parameter. For a perfect face-centered cubic (fcc) crystal with conventional cubic lattice parameter $a$, the distances to neighbors occur in discrete shells determined by the lattice geometry. We will construct the first three shells from geometric considerations and then build $\\rho_i^{(3)}(\\alpha,a)$.\n\nFirst, we recall the geometry of the fcc lattice. In the conventional cubic cell of edge length $a$, the lattice points are at the cube corners and the face centers. Equivalently, relative position vectors connecting a site at the origin to another lattice site can be expressed with components that are either integers or half-integers, subject to fcc parity constraints. The neighbor shells are characterized by distances determined by these vectors.\n\nWe now enumerate the first three shells:\n\n1. Nearest neighbors ($k=1$): A nearest neighbor is located at a face-centered position relative to the origin. Representative vectors are $\\left(0,\\frac{a}{2},\\frac{a}{2}\\right)$ and permutations with sign. The distance is\n$$\nr_1 \\;=\\; \\sqrt{\\left(\\frac{a}{2}\\right)^{2}+\\left(\\frac{a}{2}\\right)^{2}} \\;=\\; \\frac{a}{\\sqrt{2}}.\n$$\nThere are $12$ such nearest neighbors in fcc, so the coordination number is $z_1 = 12$.\n\n2. Second neighbors ($k=2$): These lie along the cubic axes, e.g., $(a,0,0)$, $(0,a,0)$, $(0,0,a)$ and their negatives. The distance is\n$$\nr_2 \\;=\\; a,\n$$\nand there are $6$ such neighbors, so $z_2 = 6$.\n\n3. Third neighbors ($k=3$): A representative vector for the third shell is $\\left(a,\\frac{a}{2},\\frac{a}{2}\\right)$ and permutations with appropriate signs, which yields a distance\n$$\nr_3 \\;=\\; \\sqrt{a^{2}+\\left(\\frac{a}{2}\\right)^{2}+\\left(\\frac{a}{2}\\right)^{2}} \\;=\\; a\\sqrt{\\frac{3}{2}}.\n$$\nThere are $24$ such neighbors in this shell, so $z_3 = 24$.\n\nGiven $f(r) = \\rho_s \\exp(-\\alpha r)$, the shell contributions $C_k(\\alpha,a)$ and the truncated electron density $\\rho_i^{(3)}(\\alpha,a)$ are\n$$\nC_1(\\alpha,a) \\;=\\; z_1\\,\\rho_s \\exp\\!\\left(-\\alpha r_1\\right) \\;=\\; 12\\,\\rho_s \\exp\\!\\left(-\\alpha \\frac{a}{\\sqrt{2}}\\right),\n$$\n$$\nC_2(\\alpha,a) \\;=\\; z_2\\,\\rho_s \\exp\\!\\left(-\\alpha r_2\\right) \\;=\\; 6\\,\\rho_s \\exp(-\\alpha a),\n$$\n$$\nC_3(\\alpha,a) \\;=\\; z_3\\,\\rho_s \\exp\\!\\left(-\\alpha r_3\\right) \\;=\\; 24\\,\\rho_s \\exp\\!\\left(-\\alpha a\\sqrt{\\frac{3}{2}}\\right),\n$$\nand hence\n$$\n\\rho_i^{(3)}(\\alpha,a) \\;=\\; C_1(\\alpha,a) + C_2(\\alpha,a) + C_3(\\alpha,a) \\;=\\; \\rho_s\\left[12\\,\\exp\\!\\left(-\\alpha \\frac{a}{\\sqrt{2}}\\right) + 6\\,\\exp(-\\alpha a) + 24\\,\\exp\\!\\left(-\\alpha a\\sqrt{\\frac{3}{2}}\\right)\\right].\n$$\n\nWe define the relative weights $w_k(\\alpha,a)$ over the first three shells by\n$$\nw_k(\\alpha,a) \\;=\\; \\frac{C_k(\\alpha,a)}{C_1(\\alpha,a)+C_2(\\alpha,a)+C_3(\\alpha,a)}.\n$$\nQualitative and quantitative dependence on $\\alpha$ follows from monotonicity of the exponential. As $\\alpha$ increases, $\\exp(-\\alpha r)$ decays faster with $r$, so nearer neighbors contribute relatively more, meaning $w_1(\\alpha,a)$ increases while $w_2(\\alpha,a)$ and $w_3(\\alpha,a)$ decrease. In the limit $\\alpha \\to 0^{+}$, $\\exp(-\\alpha r)\\to 1$, so shell weights are proportional only to coordination numbers:\n$$\n\\lim_{\\alpha\\to 0^{+}}w_1 \\;=\\; \\frac{12}{12+6+24} \\;=\\; \\frac{12}{42} \\;=\\; \\frac{2}{7},\n$$\n$$\n\\lim_{\\alpha\\to 0^{+}}w_2 \\;=\\; \\frac{6}{42} \\;=\\; \\frac{1}{7},\n$$\n$$\n\\lim_{\\alpha\\to 0^{+}}w_3 \\;=\\; \\frac{24}{42} \\;=\\; \\frac{4}{7}.\n$$\nIn the opposite limit $\\alpha \\to +\\infty$, $\\exp(-\\alpha r)$ suppresses all but the shortest distance, yielding\n$$\n\\lim_{\\alpha\\to +\\infty}w_1 \\;=\\; 1,\\qquad \\lim_{\\alpha\\to +\\infty}w_2 \\;=\\; 0,\\qquad \\lim_{\\alpha\\to +\\infty}w_3 \\;=\\; 0.\n$$\n\nWe now quantify the condition under which the first shell “dominates” by imposing $C_2(\\alpha,a) \\leq 0.05\\, C_1(\\alpha,a)$ and $C_3(\\alpha,a) \\leq 0.05\\, C_1(\\alpha,a)$. These two inequalities yield lower bounds on $\\alpha$; the minimal $\\alpha$ satisfying both is the maximum of these bounds.\n\nFirst, compare shell $2$ to shell $1$:\n$$\n\\frac{C_2}{C_1} \\;=\\; \\frac{6\\,\\rho_s \\exp(-\\alpha a)}{12\\,\\rho_s \\exp\\!\\left(-\\alpha \\frac{a}{\\sqrt{2}}\\right)} \\;=\\; \\frac{1}{2}\\,\\exp\\!\\left(-\\alpha\\left[a - \\frac{a}{\\sqrt{2}}\\right]\\right).\n$$\nThe constraint $\\frac{C_2}{C_1} \\leq 0.05$ gives\n$$\n\\frac{1}{2}\\,\\exp\\!\\left(-\\alpha a\\left[1 - \\frac{1}{\\sqrt{2}}\\right]\\right) \\;\\leq\\; 0.05 \n\\quad\\Longrightarrow\\quad\n\\exp\\!\\left(-\\alpha a\\left[1 - \\frac{1}{\\sqrt{2}}\\right]\\right) \\;\\leq\\; 0.1 \n\\quad\\Longrightarrow\\quad\n\\alpha \\;\\geq\\; \\frac{\\ln(10)}{a\\left(1 - \\frac{1}{\\sqrt{2}}\\right)}.\n$$\n\nSecond, compare shell $3$ to shell $1$:\n$$\n\\frac{C_3}{C_1} \\;=\\; \\frac{24\\,\\rho_s \\exp\\!\\left(-\\alpha a\\sqrt{\\frac{3}{2}}\\right)}{12\\,\\rho_s \\exp\\!\\left(-\\alpha \\frac{a}{\\sqrt{2}}\\right)} \\;=\\; 2\\,\\exp\\!\\left(-\\alpha a\\left[\\sqrt{\\frac{3}{2}} - \\frac{1}{\\sqrt{2}}\\right]\\right).\n$$\nThe constraint $\\frac{C_3}{C_1} \\leq 0.05$ gives\n$$\n2\\,\\exp\\!\\left(-\\alpha a\\left[\\sqrt{\\frac{3}{2}} - \\frac{1}{\\sqrt{2}}\\right]\\right) \\;\\leq\\; 0.05 \n\\quad\\Longrightarrow\\quad\n\\exp\\!\\left(-\\alpha a\\left[\\sqrt{\\frac{3}{2}} - \\frac{1}{\\sqrt{2}}\\right]\\right) \\;\\leq\\; \\frac{0.05}{2} \\;=\\; 0.025 \n\\quad\\Longrightarrow\\quad\n\\alpha \\;\\geq\\; \\frac{\\ln\\!\\left(\\frac{40}{1}\\right)}{a\\left(\\sqrt{\\frac{3}{2}} - \\frac{1}{\\sqrt{2}}\\right)} \\;=\\; \\frac{\\ln(40)}{a\\left(\\sqrt{\\frac{3}{2}} - \\frac{1}{\\sqrt{2}}\\right)}.\n$$\n\nTherefore, the minimal decay rate $\\alpha^{\\ast}(a)$ that guarantees both constraints is\n$$\n\\alpha^{\\ast}(a) \\;=\\; \\max\\!\\left\\{\\, \\frac{\\ln(10)}{a\\left(1 - \\frac{1}{\\sqrt{2}}\\right)}\\,,\\, \\frac{\\ln(40)}{a\\left(\\sqrt{\\frac{3}{2}} - \\frac{1}{\\sqrt{2}}\\right)} \\right\\}.\n$$\nWe can determine which bound is larger without numerical rounding by comparing the two denominators and numerators. Observe that $a\\left(\\sqrt{\\frac{3}{2}} - \\frac{1}{\\sqrt{2}}\\right) \\;=\\; \\frac{a}{\\sqrt{2}}\\left(\\sqrt{3}-1\\right)$ is larger than $a\\left(1 - \\frac{1}{\\sqrt{2}}\\right)$ because $\\sqrt{3}-1 > 1 - \\frac{1}{\\sqrt{2}}$; meanwhile $\\ln(40) > \\ln(10)$. Computing the exact values of the ratios reveals\n$$\n\\frac{\\ln(10)}{1 - \\frac{1}{\\sqrt{2}}} \\;>\\; \\frac{\\ln(40)}{\\sqrt{\\frac{3}{2}} - \\frac{1}{\\sqrt{2}}},\n$$\nand thus the first term dominates the maximum. Consequently, the minimal decay rate is\n$$\n\\alpha^{\\ast}(a) \\;=\\; \\frac{\\ln(10)}{a\\left(1 - \\frac{1}{\\sqrt{2}}\\right)}.\n$$\nThis closed-form expression provides the symbolic dependence of the threshold decay rate on the lattice parameter $a$ that ensures each of the second and third shell contributions is no more than $5\\%$ of the first-shell contribution, thereby establishing first-shell dominance over the first three shells.",
            "answer": "$$\\boxed{\\frac{\\ln(10)}{a\\left(1 - \\frac{1}{\\sqrt{2}}\\right)}}$$"
        },
        {
            "introduction": "The primary purpose of an interatomic potential in molecular dynamics is to compute the forces acting on each atom. This hands-on exercise guides you through the derivation of the EAM force expression, revealing the computational challenge posed by its many-body nature. You will discover why a \"two-pass\" algorithm is essential for an efficient implementation and then apply this understanding to build a working force calculator, a cornerstone of EAM-based simulation codes .",
            "id": "3754211",
            "problem": "Consider the Embedded Atom Method (EAM) for metallic systems. The total potential energy is defined by a sum of an embedding energy and a pair interaction. Let the number of atoms be $N$. For atom $i$ at position $\\mathbf{r}_i \\in \\mathbb{R}^3$, define the per-atom host electron density as $$\\rho_i = \\sum_{j \\neq i, \\, r_{ij} < r_c} f(r_{ij}),$$ where $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$, $f$ is a scalar density contribution function, and $r_c$ is a finite cutoff radius. The embedding energy is given by a scalar function $F(\\rho_i)$, and the pair potential is $\\phi(r)$. The EAM total energy is $$E = \\sum_{i=1}^{N} F(\\rho_i) + \\frac{1}{2} \\sum_{i=1}^{N} \\sum_{j \\neq i, \\, r_{ij} < r_c} \\phi(r_{ij}).$$ You are to show, by first-principles reasoning, that computing forces $\\mathbf{F}_i = -\\nabla_{\\mathbf{r}_i} E$ requires two passes over neighbor lists: one to accumulate $\\rho_i$ values and a second to evaluate forces using $F'(\\rho_i)$ and derivatives of the radial functions. Then, design and implement a memory-efficient algorithm that reuses the computed $\\rho_i$ and avoids recalculating $f(r)$ in the force evaluation pass, while using only $f'(r)$ and $\\phi'(r)$ in the second pass.\n\nFor numerical evaluation, use the following well-tested functional forms in reduced, dimensionless units:\n- Electron density contribution: $f(r) = \\eta \\exp(-\\beta r)$.\n- Pair potential: $\\phi(r) = C \\exp(-\\mu r)$.\n- Embedding function: $F(\\rho) = a \\rho + b \\rho^2$.\nUse the derivatives $f'(r) = -\\eta \\beta \\exp(-\\beta r)$ and $\\phi'(r) = -C \\mu \\exp(-\\mu r)$, and $F'(\\rho) = a + 2 b \\rho$.\n\nAdopt the cutoff $r_c = 3.0$. Use parameters $\\eta = 1.0$, $\\beta = 1.5$, $C = 0.2$, $\\mu = 2.0$, $a = -0.5$, $b = 0.05$. Exclude all interactions with $r_{ij} \\ge r_c$ exactly.\n\nYour program must:\n1. Construct a neighbor list of unordered pairs $(i,j)$ with $i < j$ and $r_{ij} < r_c$.\n2. Perform Pass 1 to accumulate $\\rho_i$ (and $\\rho_j$) by evaluating $f(r_{ij})$ exactly once per pair $(i,j)$ and adding it to both $\\rho_i$ and $\\rho_j$.\n3. Perform Pass 2 to compute forces using only $F'(\\rho_i)$, $F'(\\rho_j)$, $f'(r_{ij})$, and $\\phi'(r_{ij})$, without any calls to $f(r)$ in this pass.\n4. Return, for each test case, two quantities:\n   - The Euclidean norm of the concatenated force vector, defined as $\\left(\\sum_{i=1}^{N} \\|\\mathbf{F}_i\\|^2\\right)^{1/2}$, as a float.\n   - The integer count of the number of evaluations of $f(r)$ performed in Pass 1. This count must be zero for any test case with an empty neighbor list.\n\nAll quantities are in reduced, dimensionless units. Angles do not appear, so no angle unit is required.\n\nTest Suite:\n- Case A (general, multiple neighbors): $N=4$ atoms at positions $(0,0,0)$, $(1.5,0,0)$, $(0,1.5,0)$, $(1.5,1.5,0)$.\n- Case B (boundary at cutoff): $N=2$ atoms at positions $(0,0,0)$, $(3.0,0,0)$.\n- Case C (no neighbors): $N=3$ atoms at positions $(0,0,0)$, $(10.0,0,0)$, $(0,10.0,0)$.\n- Case D (mixed near-cutoff): $N=3$ atoms at positions $(0,0,0)$, $(2.9,0,0)$, $(6.1,0,0)$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case contributing two items in order: the force norm (float) and the count of $f(r)$ evaluations (integer). For example, the output must look like \"[normA,countA,normB,countB,normC,countC,normD,countD]\".",
            "solution": "The problem requires a demonstration of why force calculations in the Embedded Atom Method (EAM) necessitate a two-pass algorithm, followed by an implementation of such an algorithm. The core of the problem lies in the mathematical structure of the EAM force expression, which we must first derive.\n\nThe total potential energy $E$ of a system of $N$ atoms is given as:\n$$E = \\sum_{i=1}^{N} E_i = \\sum_{i=1}^{N} \\left( F(\\rho_i) + \\frac{1}{2} \\sum_{j \\neq i, \\, r_{ij} < r_c} \\phi(r_{ij}) \\right)$$\nwhere $E_i$ is the energy of atom $i$, $F$ is the embedding function, $\\rho_i$ is the host electron density at site $i$, and $\\phi$ is the pair potential. The host density $\\rho_i$ is itself a sum over neighbors $j$:\n$$\\rho_i = \\sum_{j \\neq i, \\, r_{ij} < r_c} f(r_{ij})$$\nHere, $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ is the distance between atoms $i$ and $j$, and $f$ is the electron density contribution function. The cutoff radius is $r_c$.\n\nThe force on atom $k$, $\\mathbf{F}_k$, is the negative gradient of the total energy with respect to its position vector $\\mathbf{r}_k$:\n$$\\mathbf{F}_k = -\\nabla_{\\mathbf{r}_k} E$$\n\nWe can evaluate this gradient term by term. Let's define the vector $\\mathbf{u}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$. The gradient of the interatomic distance $r_{ij}$ with respect to $\\mathbf{r}_k$ is:\n$$\\nabla_{\\mathbf{r}_k} r_{ij} = \\frac{\\mathbf{u}_{ij}}{r_{ij}} (\\delta_{ik} - \\delta_{jk})$$\nwhere $\\delta_{ik}$ is the Kronecker delta.\n\nFirst, consider the pair potential term, which can be written as $\\frac{1}{2} \\sum_{i} \\sum_{j \\neq i} \\phi(r_{ij})$. Due to the factor of $\\frac{1}{2}$ correcting for double counting, this is equivalent to $\\sum_{i<j} \\phi(r_{ij})$. The force contribution from this term is:\n$$ \\mathbf{F}_k^{\\text{pair}} = -\\nabla_{\\mathbf{r}_k} \\left( \\frac{1}{2} \\sum_{i, j \\neq i} \\phi(r_{ij}) \\right) = -\\sum_{j \\neq k} \\nabla_{\\mathbf{r}_k} \\phi(r_{kj}) $$\nUsing the chain rule, $\\nabla_{\\mathbf{r}_k} \\phi(r_{kj}) = \\phi'(r_{kj}) \\nabla_{\\mathbf{r}_k} r_{kj} = \\phi'(r_{kj}) \\frac{\\mathbf{r}_k - \\mathbf{r}_j}{r_{kj}}$. Thus,\n$$ \\mathbf{F}_k^{\\text{pair}} = -\\sum_{j \\neq k} \\phi'(r_{kj}) \\frac{\\mathbf{r}_k - \\mathbf{r}_j}{r_{kj}} $$\n\nNext, we evaluate the embedding energy term, $\\sum_{i} F(\\rho_i)$. This is the many-body component.\n$$ \\mathbf{F}_k^{\\text{embed}} = -\\nabla_{\\mathbf{r}_k} \\sum_{i=1}^{N} F(\\rho_i) = - \\sum_{i=1}^{N} \\frac{dF}{d\\rho_i} \\nabla_{\\mathbf{r}_k} \\rho_i = - \\sum_{i=1}^{N} F'(\\rho_i) \\nabla_{\\mathbf{r}_k} \\rho_i $$\nThe gradient $\\nabla_{\\mathbf{r}_k} \\rho_i$ depends on which atom's coordinates we are differentiating.\nFor the term where $i=k$:\n$$ \\nabla_{\\mathbf{r}_k} \\rho_k = \\nabla_{\\mathbf{r}_k} \\sum_{j \\neq k} f(r_{kj}) = \\sum_{j \\neq k} f'(r_{kj}) \\nabla_{\\mathbf{r}_k} r_{kj} = \\sum_{j \\neq k} f'(r_{kj}) \\frac{\\mathbf{r}_k - \\mathbf{r}_j}{r_{kj}} $$\nFor terms where $i \\neq k$, the only part of the sum $\\rho_i = \\sum_{j \\neq i} f(r_{ij})$ that depends on $\\mathbf{r}_k$ is the term where $j=k$.\n$$ \\nabla_{\\mathbf{r}_k} \\rho_i = \\nabla_{\\mathbf{r}_k} f(r_{ik}) = f'(r_{ik}) \\nabla_{\\mathbf{r}_k} r_{ik} = f'(r_{ik}) \\frac{\\mathbf{r}_i - \\mathbf{r}_k}{r_{ik}} = -f'(r_{ik}) \\frac{\\mathbf{r}_k - \\mathbf{r}_i}{r_{ik}} $$\nSubstituting these into the expression for $\\mathbf{F}_k^{\\text{embed}}$:\n$$ \\mathbf{F}_k^{\\text{embed}} = - F'(\\rho_k) \\left( \\sum_{j \\neq k} f'(r_{kj}) \\frac{\\mathbf{r}_k - \\mathbf{r}_j}{r_{kj}} \\right) - \\sum_{i \\neq k} F'(\\rho_i) \\left( -f'(r_{ik}) \\frac{\\mathbf{r}_k - \\mathbf{r}_i}{r_{ik}} \\right) $$\nBy relabeling the summation index $i$ to $j$ in the second sum and noting $r_{jk}=r_{kj}$, we can combine the terms:\n$$ \\mathbf{F}_k^{\\text{embed}} = - \\sum_{j \\neq k} \\left( F'(\\rho_k) + F'(\\rho_j) \\right) f'(r_{kj}) \\frac{\\mathbf{r}_k - \\mathbf{r}_j}{r_{kj}} $$\n\nThe total force on atom $k$ is the sum $\\mathbf{F}_k = \\mathbf{F}_k^{\\text{pair}} + \\mathbf{F}_k^{\\text{embed}}$:\n$$ \\mathbf{F}_k = - \\sum_{j \\neq k, \\, r_{kj} < r_c} \\left[ \\phi'(r_{kj}) + (F'(\\rho_k) + F'(\\rho_j)) f'(r_{kj}) \\right] \\frac{\\mathbf{r}_k - \\mathbf{r}_j}{r_{kj}} $$\nThis derived expression reveals the computational dependency. To compute the force contribution between a pair of atoms $(k, j)$, we must know the values of $F'(\\rho_k)$ and $F'(\\rho_j)$. These values, in turn, depend on the total host electron densities $\\rho_k$ and $\\rho_j$. However, $\\rho_k$ and $\\rho_j$ are sums over all their respective neighbors. For instance, $\\rho_k = \\sum_{l \\neq k} f(r_{kl})$.\nTherefore, one cannot compute the forces in a single pass over the neighbor pairs. The values of all $\\rho_i$ must be known *before* the force calculations can begin. This naturally leads to a two-pass algorithm.\n\nThe proposed algorithm is designed as follows:\n1.  **Neighbor List Construction**: First, we identify all interacting atom pairs. To avoid redundant calculations and adhere to Newton's third law efficiently, we build a list of unique pairs $(i, j)$ such that $i < j$ and their separation $r_{ij}$ is less than the cutoff $r_c$. For each such pair, we store the indices $i$, $j$, the distance $r_{ij}$, and the vector difference $\\mathbf{r}_i - \\mathbf{r}_j$ to avoid recalculation.\n\n2.  **Pass 1: Density Accumulation**: We iterate through the generated neighbor list. For each pair $(i, j)$, we compute the density contribution $f(r_{ij})$ precisely once. This value is added to accumulators for both $\\rho_i$ and $\\rho_j$. A counter tracks the number of times $f(r)$ is evaluated. After this pass is complete, the total host electron density $\\rho_i$ is known for every atom $i$ in the system.\n\n3.  **Pass 2: Force Calculation**: We iterate through the neighbor list a second time. For each pair $(i, j)$, we now have all the necessary components to compute the pairwise force contribution, based on the derived formula.\n    - We retrieve the pre-computed densities $\\rho_i$ and $\\rho_j$.\n    - We compute the derivatives of the embedding function, $F'(\\rho_i)$ and $F'(\\rho_j)$, using the prescribed form $F'(\\rho) = a + 2b\\rho$.\n    - We compute the derivatives of the radial functions, $\\phi'(r_{ij})$ and $f'(r_{ij})$. Note that the function $f(r)$ is not called in this pass.\n    - The force vector contribution on atom $i$ from its interaction with $j$ is calculated as:\n      $$ \\mathbf{f}_{ij} = - \\left[ \\phi'(r_{ij}) + (F'(\\rho_i) + F'(\\rho_j)) f'(r_{ij}) \\right] \\frac{\\mathbf{r}_i - \\mathbf{r}_j}{r_{ij}} $$\n    - This force vector $\\mathbf{f}_{ij}$ is added to the total force accumulator for atom $i$, $\\mathbf{F}_i$. By Newton's third law for this effective pair force, the force on atom $j$ is $\\mathbf{f}_{ji} = -\\mathbf{f}_{ij}$. This is added to the accumulator $\\mathbf{F}_j$.\n\n4.  **Finalization**: After Pass 2, the array of total forces $\\{\\mathbf{F}_i\\}$ is complete. The Euclidean norm of the concatenated force vector, $\\left(\\sum_{i=1}^{N} \\|\\mathbf{F}_i\\|^2\\right)^{1/2}$, is computed. The final result for each test case consists of this norm and the count of $f(r)$ evaluations from Pass 1.\n\nThis principled design ensures scientific correctness by directly implementing the derived force expression while achieving computational efficiency by separating the many-body density calculation from the final force assembly, thus avoiding redundant calculations of $f(r_{ij})$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the EAM force calculations for all test cases.\n    \"\"\"\n    # Define EAM parameters and cutoff radius\n    params = {\n        'eta': 1.0,\n        'beta': 1.5,\n        'C': 0.2,\n        'mu': 2.0,\n        'a': -0.5,\n        'b': 0.05,\n        'rc': 3.0\n    }\n\n    # Define test cases for atomic positions\n    test_cases = {\n        'A': np.array([\n            [0.0, 0.0, 0.0],\n            [1.5, 0.0, 0.0],\n            [0.0, 1.5, 0.0],\n            [1.5, 1.5, 0.0]\n        ]),\n        'B': np.array([\n            [0.0, 0.0, 0.0],\n            [3.0, 0.0, 0.0]\n        ]),\n        'C': np.array([\n            [0.0, 0.0, 0.0],\n            [10.0, 0.0, 0.0],\n            [0.0, 10.0, 0.0]\n        ]),\n        'D': np.array([\n            [0.0, 0.0, 0.0],\n            [2.9, 0.0, 0.0],\n            [6.1, 0.0, 0.0]\n        ])\n    }\n    \n    # EAM functions and their derivatives\n    # Electron density contribution\n    f = lambda r, eta, beta: eta * np.exp(-beta * r)\n    # Derivative of electron density contribution\n    f_prime = lambda r, eta, beta: -eta * beta * np.exp(-beta * r)\n    # Derivative of pair potential\n    phi_prime = lambda r, C, mu: -C * mu * np.exp(-mu * r)\n    # Derivative of embedding function\n    F_prime = lambda rho, a, b: a + 2 * b * rho\n\n    results = []\n    \n    # Process each test case\n    for case_key in ['A', 'B', 'C', 'D']:\n        positions = test_cases[case_key]\n        norm, count = compute_eam_forces(positions, params, f, f_prime, phi_prime, F_prime)\n        results.extend([norm, count])\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_eam_forces(positions, params, f, f_prime, phi_prime, F_prime):\n    \"\"\"\n    Computes EAM forces using a two-pass algorithm.\n\n    Args:\n        positions (np.ndarray): Array of atomic positions, shape (N, 3).\n        params (dict): Dictionary of EAM parameters.\n        f, f_prime, phi_prime, F_prime (callable): Functions for EAM potentials.\n\n    Returns:\n        tuple: (force_norm, f_eval_count)\n            - force_norm (float): Euclidean norm of the concatenated force vector.\n            - f_eval_count (int): Number of evaluations of f(r).\n    \"\"\"\n    num_atoms = positions.shape[0]\n    rc = params['rc']\n    \n    # Initialize data structures\n    rho = np.zeros(num_atoms, dtype=float)\n    forces = np.zeros_like(positions, dtype=float)\n    neighbor_list = []\n    f_eval_count = 0\n\n    # 1. Neighbor List Construction\n    for i in range(num_atoms):\n        for j in range(i + 1, num_atoms):\n            r_vec_ij = positions[i] - positions[j]\n            r_ij = np.linalg.norm(r_vec_ij)\n            if r_ij < rc:\n                neighbor_list.append((i, j, r_ij, r_vec_ij))\n\n    # 2. Pass 1: Density Accumulation\n    if neighbor_list:\n        for i, j, r_ij, _ in neighbor_list:\n            density_contrib = f(r_ij, params['eta'], params['beta'])\n            f_eval_count += 1\n            rho[i] += density_contrib\n            rho[j] += density_contrib\n\n    # 3. Pass 2: Force Calculation\n    if neighbor_list:\n        for i, j, r_ij, r_vec_ij in neighbor_list:\n            # Get derivatives of embedding function for the pair\n            Fp_i = F_prime(rho[i], params['a'], params['b'])\n            Fp_j = F_prime(rho[j], params['a'], params['b'])\n            \n            # Get derivatives of radial functions\n            phip_rij = phi_prime(r_ij, params['C'], params['mu'])\n            fp_rij = f_prime(r_ij, params['eta'], params['beta'])\n\n            # Calculate the scalar part of the force interaction\n            scalar_force_term = phip_rij + (Fp_i + Fp_j) * fp_rij\n\n            # Force vector on atom i due to interaction with j\n            # The derived force is F_k = - sum_j [scalar_term] * (r_k - r_j)/r_kj\n            # Here r_vec_ij = r_i - r_j\n            force_vec_on_i = -scalar_force_term * (r_vec_ij / r_ij)\n            \n            # Apply forces based on Newton's third law\n            forces[i] += force_vec_on_i\n            forces[j] -= force_vec_on_i\n\n    # 4. Finalization\n    # Calculate the Euclidean norm of the concatenated force vector\n    total_force_norm = np.linalg.norm(forces)\n\n    return total_force_norm, f_eval_count\n\nsolve()\n```"
        },
        {
            "introduction": "For computational efficiency, interatomic potentials are truncated at a finite cutoff radius, but a naive cutoff can introduce unphysical energy and force discontinuities that corrupt simulations. This advanced practice addresses this critical implementation detail by exploring the need for smooth potential tapering. You will determine the minimal smoothness conditions required for continuous forces and virials and then construct the polynomial taper function that meets these criteria, a technique vital for developing robust and physically meaningful potentials .",
            "id": "3754243",
            "problem": "Consider a metal modeled with the Embedded Atom Method (EAM), whose total energy for a configuration of atoms at positions $\\{\\mathbf{r}_i\\}$ is defined by\n$$\nE = \\sum_{i} F(\\rho_i) + \\frac{1}{2} \\sum_{i \\neq j} \\phi(r_{ij}), \\quad \\rho_i = \\sum_{j \\neq i} g(r_{ij}),\n$$\nwhere $r_{ij} = |\\mathbf{r}_i - \\mathbf{r}_j|$, $F(\\rho)$ is the embedding energy as a function of the host electron density $\\rho_i$, $\\phi(r)$ is a pair interaction, and $g(r)$ is the electron density contribution from an atom at separation $r$. In practice, each radial function is truncated at a finite cutoff radius $r_c$ to maintain computational efficiency. A naive truncation $f(r) \\mapsto f(r) \\,\\Theta(r_c - r)$, with $\\Theta$ the Heaviside step function and $f \\in \\{\\phi,g\\}$, can induce discontinuities in forces and in the virial-based stress when atom pairs cross $r_c$ during dynamics or when the configuration is subjected to an infinitesimal homogeneous strain.\n\nTo eliminate these artifacts, one replaces $f(r)$ by a tapered form $f(r) s(r)$, where $s(r)$ transitions smoothly from $1$ to $0$ in an interval $[r_s, r_c]$ with $r_s < r_c$, and is constant outside the interval. Starting from the EAM energy definition, the force definition $\\mathbf{F}_k = -\\nabla_{\\mathbf{r}_k} E$, and the virial (Irving–Kirkwood) stress definition for pairwise central forces, argue how the differentiability of $s(r)$ near $r_c$ impacts the continuity of forces and virials, and determine the minimal smoothness requirements on $s(r)$ at $r = r_c$ and at $r = r_s$ so that both the forces and the virial are continuous functions of the atomic positions and of an infinitesimal homogeneous strain parameter.\n\nThen, constrained by these smoothness requirements and by $s(r)$ being constant outside $[r_s,r_c]$, construct the lowest-degree polynomial taper $s(r)$ on the interval $[r_s, r_c]$ that satisfies the boundary conditions implied by your analysis. Express your final result as a single closed-form analytic expression for $s(r)$ valid for $r \\in [r_s, r_c]$ in terms of $r$, $r_s$, and $r_c$ only. No numerical approximation is required for the final answer.",
            "solution": "The analysis proceeds in two parts. First, we determine the minimal smoothness requirements on the taper function $s(r)$. Second, we construct the specific polynomial form of $s(r)$ that satisfies these requirements.\n\nLet the modified, tapered potential functions be $\\tilde{\\phi}(r) = \\phi(r)s(r)$ and $\\tilde{g}(r) = g(r)s(r)$. The total energy is then:\n$$\nE = \\sum_{i} F\\left( \\sum_{j \\neq i} \\tilde{g}(r_{ij}) \\right) + \\frac{1}{2} \\sum_{i \\neq j} \\tilde{\\phi}(r_{ij})\n$$\n\n**1. Continuity of Forces**\n\nThe force on atom $k$ depends on the first derivatives of the potential functions, $\\tilde{\\phi}'(r)$ and $\\tilde{g}'(r)$. For the force to be a continuous function of atomic positions as they cross the taper boundaries at $r_s$ and $r_c$, the functions $\\tilde{\\phi}'(r)$ and $\\tilde{g}'(r)$ must be continuous. The derivative of a tapered function like $\\tilde{\\phi}(r)$ is $\\tilde{\\phi}'(r) = \\phi'(r)s(r) + \\phi(r)s'(r)$. Assuming the base functions $\\phi(r)$ and $\\phi'(r)$ are smooth, continuity of $\\tilde{\\phi}'(r)$ across the boundaries requires that both $s(r)$ and $s'(r)$ be continuous. This means $s(r)$ must be continuously differentiable, i.e., $s(r) \\in C^1$. The boundary conditions on $s(r)$ for $C^1$ continuity are:\n-   $s(r_s) = 1$ and $s(r_c) = 0$ (from the definition of the taper).\n-   $s'(r_s) = 0$ (to match $s'(r)=0$ for $r < r_s$).\n-   $s'(r_c) = 0$ (to match $s'(r)=0$ for $r > r_c$).\n\n**2. Continuity of Virial Stress and Elastic Constants**\n\nThe virial tensor, which determines the stress, involves terms proportional to $r \\tilde{\\phi}'(r)$ and $r \\tilde{g}'(r)$. Continuity of the virial as a function of atomic positions therefore imposes the same $C^1$ requirement on $s(r)$.\n\nHowever, the problem also requires continuity with respect to an \"infinitesimal homogeneous strain parameter\". Physical quantities derived from strain derivatives of the energy, such as the elastic constants, must also be continuous as atom pairs cross the cutoff boundaries. The elastic constant tensor is related to the second derivatives of the energy with respect to strain, which in turn depend on the second derivatives of the potential functions, $\\tilde{\\phi}''(r)$ and $\\tilde{g}''(r)$.\n\nLet's examine the second derivative of $\\tilde{\\phi}(r)$:\n$$\n\\tilde{\\phi}''(r) = \\frac{d}{dr}\\left[\\phi'(r)s(r) + \\phi(r)s'(r)\\right] = \\phi''(r)s(r) + 2\\phi'(r)s'(r) + \\phi(r)s''(r)\n$$\nAssuming the base functions $\\phi(r)$ and its derivatives are smooth, continuity of $\\tilde{\\phi}''(r)$ across $r_s$ and $r_c$ requires $s(r)$, $s'(r)$, and $s''(r)$ to be continuous. Therefore, the minimal smoothness requirement for a physically robust potential that yields continuous forces, stresses, and elastic constants is that the taper function $s(r)$ must be twice continuously differentiable, i.e., $s(r) \\in C^2$.\n\nThis imposes two additional boundary conditions on the derivatives of $s(r)$:\n-   $s''(r_s) = 0$ (to match $s''(r)=0$ for $r < r_s$).\n-   $s''(r_c) = 0$ (to match $s''(r)=0$ for $r > r_c$).\n\nIn summary, we have six boundary conditions for the polynomial $s(r)$ on the interval $[r_s, r_c]$:\n1.  $s(r_s) = 1$\n2.  $s(r_c) = 0$\n3.  $s'(r_s) = 0$\n4.  $s'(r_c) = 0$\n5.  $s''(r_s) = 0$\n6.  $s''(r_c) = 0$\n\n**3. Construction of the Polynomial Taper**\n\nTo satisfy these six conditions with the lowest-degree polynomial, we need a polynomial of degree $5$ (a quintic polynomial), which has six coefficients. Let's define a normalized variable $x = \\frac{r - r_s}{r_c - r_s}$, so that $x \\in [0, 1]$ as $r \\in [r_s, r_c]$. Let our polynomial be $s(r) = P(x)$. The boundary conditions in terms of $P(x)$ are:\n-   $P(0) = 1$\n-   $P(1) = 0$\n-   $P'(0) = 0$ (since $s' \\propto P'$)\n-   $P'(1) = 0$\n-   $P''(0) = 0$ (since $s'' \\propto P''$)\n-   $P''(1) = 0$\n\nLet $P(x) = a x^5 + b x^4 + c x^3 + d x^2 + e x + f$.\n-   From $P(0)=1$, $P'(0)=0$, and $P''(0)=0$, we find $f=1$, $e=0$, and $d=0$.\nSo the polynomial simplifies to $P(x) = ax^5 + bx^4 + cx^3 + 1$. Now we apply the conditions at $x=1$:\n1.  $P(1) = a+b+c+1 = 0$\n2.  $P'(1) = 5a+4b+3c = 0$\n3.  $P''(1) = 20a+12b+6c = 0$, which simplifies to $10a+6b+3c = 0$.\n\nThis is a system of three linear equations for $a, b, c$. Solving this system yields:\n$a = -6$\n$b = 15$\n$c = -10$\n\nThe polynomial in the normalized coordinate is:\n$$\nP(x) = -6x^5 + 15x^4 - 10x^3 + 1\n$$\nSubstituting back $x = \\frac{r - r_s}{r_c - r_s}$, we obtain the final expression for the taper function $s(r)$ on the interval $[r_s, r_c]$.",
            "answer": "$$\n\\boxed{-6 \\left(\\frac{r - r_s}{r_c - r_s}\\right)^5 + 15 \\left(\\frac{r - r_s}{r_c - r_s}\\right)^4 - 10 \\left(\\frac{r - r_s}{r_c - r_s}\\right)^3 + 1}\n$$"
        }
    ]
}