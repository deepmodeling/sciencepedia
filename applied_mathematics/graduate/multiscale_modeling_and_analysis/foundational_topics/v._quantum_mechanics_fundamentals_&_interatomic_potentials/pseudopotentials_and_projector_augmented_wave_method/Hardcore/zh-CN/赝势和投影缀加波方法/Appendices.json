{
    "hands_on_practices": [
        {
            "introduction": "本章的第一个实践练习将从根本上探讨赝势的构建过程。你将通过编程实现一个简化的模守恒赝势的构建算法，直接体验赝势方法的核心思想。通过数值求解径向薛定谔方程，并施加在截断半径 $r_c$ 处的连续性匹配条件和至关重要的模守恒约束，你将深入理解如何生成一个光滑且计算高效的赝波函数，以替代原子核附近行为复杂的高振荡全电子波函数。",
            "id": "3798568",
            "problem": "您的任务是为单元素参考构型形式化并实现一个简化的保范赝势构建方法，该方法需适用于多尺度电子结构建模，并与投影缀加波（PAW）方法的原理一致。目标是计算在截断半径内的光滑赝波函数，并验证每个角动量通道的范数守恒性。\n\n从以下基本基础开始：\n\n- 在中心势场中，不含时薛定谔方程由 $-\\frac{1}{2} \\nabla^2 \\psi(\\mathbf{r}) + V(r)\\psi(\\mathbf{r}) = E \\psi(\\mathbf{r})$ 给出，其中 $V(r)$ 是球对称的，$E$ 是能量。分离变量法得到约化径向函数 $u_{l}(r)=r R_{l}(r)$ 的径向方程：\n$$\n\\frac{d^2 u_{l}(r)}{dr^2} = \\left[\\frac{l(l+1)}{r^2} + 2V(r) - 2E\\right] u_{l}(r),\n$$\n其中 $l$ 是角动量量子数。\n- 对于有效核电荷为 $Z$、主量子数为 $n$ 的类氢元素，其束缚态能量在原子单位下为 $E = -\\frac{Z^2}{2 n^2}$，库仑势为 $V(r) = -\\frac{Z}{r}$。\n\n在保范赝势框架中，赝波函数 $u_{l}^{PS}(r)$ 在选定的截断半径 $r_c$ 之外必须与全电子波函数 $u_{l}^{AE}(r)$ 相同，而在 $r_c$ 内部是光滑正则的。范数守恒要求 $r_c$ 内部的径向概率积分保持不变：\n$$\n\\int_{0}^{r_c} \\left|u_{l}^{PS}(r)\\right|^2 \\, dr = \\int_{0}^{r_c} \\left|u_{l}^{AE}(r)\\right|^2 \\, dr.\n$$\n\n实现以下数学上明确定义的构建过程：\n\n1. 计算全电子约化径向函数 $u_{l}^{AE}(r)$，作为径向薛定谔方程在 $V(r) = -\\frac{Z}{r}$ 和 $E = -\\frac{Z^2}{2 n^2}$ 条件下的解，使用 $r=0$ 附近的正则初始边界条件：对于一个小的 $r_0$，有 $u_{l}(r_0) = r_0^{l+1}$ 和 $\\frac{d u_{l}}{dr}(r_0) = (l+1) r_0^{l}$。\n2. 将截断半径内的赝波函数定义为一个光滑的多项式拟设，以确保在原点的正则性：\n$$\nu_{l}^{PS}(r) =\n\\begin{cases}\nr^{l+1} \\left(a_0 + a_1 r + a_2 r^2 + a_3 r^3\\right),  0 \\le r \\le r_c, \\\\\nu_{l}^{AE}(r),  r \\ge r_c,\n\\end{cases}\n$$\n其中系数 $a_0, a_1, a_2, a_3$ 由以下四个约束条件确定：\n$$\nu_{l}^{PS}(r_c) = u_{l}^{AE}(r_c), \\quad\n\\frac{d u_{l}^{PS}}{dr}(r_c) = \\frac{d u_{l}^{AE}}{dr}(r_c), \\quad\n\\frac{d^2 u_{l}^{PS}}{dr^2}(r_c) = \\frac{d^2 u_{l}^{AE}}{dr^2}(r_c),\n$$\n以及范数守恒条件\n$$\n\\int_{0}^{r_c} \\left|u_{l}^{PS}(r)\\right|^2 \\, dr = \\int_{0}^{r_c} \\left|u_{l}^{AE}(r)\\right|^2 \\, dr.\n$$\n所有积分均以原子单位计算，因此径向坐标 $r$ 以玻尔半径为单位进行测量，积分为无量纲量。\n\n您的程序必须：\n\n- 数值积分径向薛定谔方程以获得 $u_{l}^{AE}(r)$ 直至 $r_c$，并利用径向方程计算 $\\frac{d u_{l}^{AE}}{dr}(r_c)$ 和 $\\frac{d^2 u_{l}^{AE}}{dr^2}(r_c)$。\n- 求解用于确定 $a_0, a_1, a_2, a_3$ 的非线性系统，该系统强制施加了在 $r_c$ 处的三个匹配条件和范数守恒。\n- 通过计算截断半径内的相对范数误差来验证范数守恒性：\n$$\n\\varepsilon_l = \\frac{\\left|\\int_{0}^{r_c} \\left|u_{l}^{PS}(r)\\right|^2 \\, dr - \\int_{0}^{r_c} \\left|u_{l}^{AE}(r)\\right|^2 \\, dr\\right|}{\\int_{0}^{r_c} \\left|u_{l}^{AE}(r)\\right|^2 \\, dr}.\n$$\n\n测试套件与输出规范：\n\n使用以下测试套件，每个套件包含元素有效电荷 $Z$、主量子数 $n$、以玻尔为单位的截断半径 $r_c$ 以及待评估的角动量通道 $l$ 列表：\n\n- 测试用例 1：$Z=8$, $n=2$, $r_c=1.2$, $l \\in \\{0,1\\}$。\n- 测试用例 2：$Z=14$, $n=3$, $r_c=1.8$, $l \\in \\{0,1,2\\}$。\n- 测试用例 3：$Z=29$, $n=3$, $r_c=0.8$, $l \\in \\{0,1,2\\}$。\n\n对于每个测试用例，计算每个指定 $l$ 通道的 $\\varepsilon_l$。最终程序输出必须是单行文本，包含一个由方括号括起来的逗号分隔的浮点数列表，结果按测试用例排序，并在每个测试用例内按 $l$ 递增排序。例如，预期的输出格式为 $[\\varepsilon_{1, l=0}, \\varepsilon_{1, l=1}, \\varepsilon_{2, l=0}, \\varepsilon_{2, l=1}, \\varepsilon_{2, l=2}, \\varepsilon_{3, l=0}, \\varepsilon_{3, l=1}, \\varepsilon_{3, l=2}]$。\n\n您的解决方案必须是完全自包含的，并实现所有数值计算。所有量均以原子单位表示，并返回浮点数结果；不要返回百分比。角度单位不适用于此问题。\n\n您的程序应产生单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果（例如，$[0.0000012,0.0000009,0.0000048]$）。",
            "solution": "该问题要求为类氢原子参考系统制定并实现一个简化的保范赝势构建方法。该过程涉及生成一个光滑的赝波函数 $u_{l}^{PS}(r)$，使其在截断半径 $r_c$ 之外与全电子波函数 $u_{l}^{AE}(r)$ 相匹配，并在此半径内保持范数守恒。此任务分为四个主要部分：\n1.  全电子径向波函数 $u_{l}^{AE}(r)$ 的数值解。\n2.  赝波函数 $u_{l}^{PS}(r)$ 及其约束条件的公式化。\n3.  通过强制范数守恒来数值求解赝波函数参数。\n4.  通过计算相对范数误差 $\\varepsilon_l$ 来验证该过程。\n\n需要注意的是，该问题使用了类氢原子的能量公式 $E = -Z^2/(2n^2)$，其中原子具有有效电荷 $Z$。这是一个简化，因为在真实的多电子原子中，能量本征值 $E_{nl}$ 依赖于角动量量子数 $l$。我们将根据此指定模型进行操作。所有量均采用原子单位（$\\hbar = m_e = e = 4\\pi\\epsilon_0 = 1$）。\n\n### 第1部分：全电子波函数解\n\n起点是约化径向波函数 $u_l(r) = rR_l(r)$ 的径向薛定谔方程：\n$$\n\\frac{d^2 u_{l}(r)}{dr^2} = \\left[\\frac{l(l+1)}{r^2} + 2V(r) - 2E\\right] u_{l}(r)\n$$\n对于指定的类氢系统，势函数为 $V(r) = -Z/r$，能量为 $E = -Z^2/(2n^2)$。微分方程变为：\n$$\n\\frac{d^2 u_{l}(r)}{dr^2} = g(r) u_{l}(r), \\quad \\text{其中} \\quad g(r) = \\frac{l(l+1)}{r^2} - \\frac{2Z}{r} + \\frac{Z^2}{n^2}\n$$\n这是一个二阶常微分方程（ODE）。为了进行数值求解，我们将其转换为一个一阶常微分方程组。设状态向量为 $\\mathbf{y}(r) = \\begin{pmatrix} y_0(r) \\\\ y_1(r) \\end{pmatrix} = \\begin{pmatrix} u_l(r) \\\\ u_l'(r) \\end{pmatrix}$。该系统为：\n$$\n\\frac{d\\mathbf{y}}{dr} = \\begin{pmatrix} y_1(r) \\\\ g(r) y_0(r) \\end{pmatrix}\n$$\n项 $l(l+1)/r^2$ 在 $r=0$ 处是奇异的。我们必须在一个小的半径 $r_0 > 0$ 处开始积分，利用原点附近正则解的已知渐近行为，即 $u_l(r) \\propto r^{l+1}$。问题提供了具体的初始条件：\n$$\nu_{l}(r_0) = r_0^{l+1} \\quad \\text{和} \\quad \\frac{du_{l}}{dr}(r_0) = (l+1) r_0^{l}\n$$\n我们将此系统从 $r=r_0$ 积分到截断半径 $r_c$。这将得到在区间 $[r_0, r_c]$ 上的全电子函数 $u_{l}^{AE}(r)$ 及其导数 $u_{l}'^{AE}(r)$。我们特别需要其在 $r_c$ 处的值和二阶导数：\n-   $U_0 \\equiv u_{l}^{AE}(r_c)$\n-   $U_1 \\equiv \\frac{du_{l}^{AE}}{dr}(r_c)$\n-   $U_2 \\equiv \\frac{d^2u_{l}^{AE}}{dr^2}(r_c) = g(r_c) U_0$\n\n此外，我们必须计算截断半径内全电子波函数的积分范数，这将作为范数守恒约束的目标：\n$$\nN_{AE} = \\int_{0}^{r_c} \\left| u_{l}^{AE}(r) \\right|^2 dr\n$$\n该积分使用从常微分方程积分得到的解进行数值计算。为获得高精度，对于足够小的 $r_0$，$[0, r_0]$ 区间的贡献可以忽略不计。\n\n### 第2部分：赝波函数构建\n\n赝波函数 $u_{l}^{PS}(r)$ 在 $r_c$ 内部由一个多项式拟设定义，以确保在原点处的光滑性和正则性（当 $r \\to 0$ 时，$u_{l}^{PS}(r) \\sim r^{l+1}$）：\n$$\nu_{l}^{PS}(r) = r^{l+1} \\left(a_0 + a_1 r + a_2 r^2 + a_3 r^3\\right) = r^{l+1} P(r)\n$$\n四个系数 $a_0, a_1, a_2, a_3$ 由四个约束条件确定。其中三个约束条件来自于在 $r_c$ 处将 $u_l^{PS}$ 的值、一阶导数和二阶导数与 $u_l^{AE}$ 的相应值进行匹配：\n1.  $u_{l}^{PS}(r_c) = U_0$\n2.  $\\frac{du_{l}^{PS}}{dr}(r_c) = U_1$\n3.  $\\frac{d^2u_{l}^{PS}}{dr^2}(r_c) = U_2$\n\n这三个条件对四个未知系数施加了三个线性约束，留下一个自由度。通过将 $u_l^{PS}(r)$ 的多项式形式及其导数代入这些方程，我们可以将其中三个系数（例如 $a_0, a_1, a_2$）表示为第四个系数（$a_3$）的线性函数。令 $P(r) = \\sum_{i=0}^3 a_i r^i$。可以发现在 $r_c$ 处对 $P(r)$ 的条件为：\n-   $P(r_c) = U_0 / r_c^{l+1} \\equiv P_0$\n-   $P'(r_c) = (U_1 - (l+1)U_0/r_c) / r_c^{l+1} \\equiv P_1$\n-   $P''(r_c) = (U_2 - l(l+1)r_c^{l-1}P_0 - 2(l+1)r_c^{l}P_1) / r_c^{l+1} \\equiv P_2$\n\n这些关于多项式 $P(r)$ 及其在 $r_c$ 处的导数的条件，构成了系数 $a_i$ 的一个线性系统。以 $a_3$ 为变量求解 $a_0, a_1, a_2$ 可得：\n$$\n\\begin{align*}\na_2 = \\frac{1}{2}P_2 - 3r_c a_3 \\\\\na_1 = P_1 - 2r_c a_2 - 3r_c^2 a_3 = (P_1 - r_c P_2) + 3r_c^2 a_3 \\\\\na_0 = P_0 - r_c a_1 - r_c^2 a_2 - r_c^3 a_3 = (P_0 - r_c P_1 + \\frac{1}{2}r_c^2 P_2) - r_c^3 a_3\n\\end{align*}\n$$\n这表明对于 $i=0,1,2$，每个系数 $a_i$ 都可以写成 $a_i = \\alpha_i + \\beta_i a_3$ 的形式，其中 $\\alpha_i$ 和 $\\beta_i$ 是由全电子解在 $r_c$ 处的值决定的常数。\n\n### 第3部分：强制范数守恒\n\n第四个也是最后一个约束是范数守恒条件：\n$$\nN_{PS} = \\int_{0}^{r_c} \\left| u_{l}^{PS}(r) \\right|^2 dr = N_{AE}\n$$\n将以系数 $a_i(a_3)$ 表示的 $u_{l}^{PS}(r)$ 表达式代入，这变成了一个关于单个未知变量 $a_3$ 的非线性方程：\n$$\n\\int_{0}^{r_c} \\left( r^{l+1} \\sum_{i=0}^{3} a_i(a_3) r^i \\right)^2 dr - N_{AE} = 0\n$$\n由于每个 $a_i$ 都是 $a_3$ 的线性函数，被积函数是 $a_3$ 的二次函数。因此，积分本身将是 $a_3$ 的一个二次多项式，可以解析求解。然而，一个更稳健和通用的方法是数值求解该方程。我们定义一个目标函数 $F(a_3)$：\n$$\nF(a_3) = \\int_{0}^{r_c} \\left| u_{l}^{PS}(r; a_3) \\right|^2 dr - N_{AE}\n$$\n然后我们使用数值求根算法寻找该函数的一个根 $F(a_3) = 0$。这将确定确保范数守恒的 $a_3$ 的值。一旦找到 $a_3$，其他系数 $a_0, a_1, a_2$ 就唯一确定了。\n\n### 第4部分：验证范数守恒性\n\n最后一步是通过计算相对范数误差 $\\varepsilon_l$ 来验证该过程的正确性。其定义为：\n$$\n\\varepsilon_l = \\frac{\\left| N_{PS} - N_{AE} \\right|}{N_{AE}} = \\frac{\\left|\\int_{0}^{r_c} \\left|u_{l}^{PS}(r)\\right|^2 \\, dr - \\int_{0}^{r_c} \\left|u_{l}^{AE}(r)\\right|^2 \\, dr\\right|}{\\int_{0}^{r_c} \\left|u_{l}^{AE}(r)\\right|^2 \\, dr}\n$$\n$\\varepsilon_l$ 的值量化了范数守恒执行的精度。鉴于我们使用数值求根器使 $N_{PS} - N_{AE}$ 等于零，所得到的误差 $\\varepsilon_l$ 预计是一个与求根算法容差同量级的小数，从而验证了保范约束的成功实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp, quad\nfrom scipy.optimize import root_scalar\n\ndef compute_norm_error(Z, n, rc, l):\n    \"\"\"\n    Computes the norm-conservation error for a given set of parameters.\n    \n    This function implements the entire procedure:\n    1. Solves the radial Schrödinger equation for the all-electron wavefunction.\n    2. Calculates the required values (function, derivatives, norm) at rc.\n    3. Sets up and solves the non-linear system for the pseudowavefunction coefficients.\n    4. Computes and returns the relative norm error.\n    \"\"\"\n    #\n    # Part 1: All-Electron (AE) Wavefunction Solution\n    #\n    \n    # Energy in atomic units\n    E = -Z**2 / (2 * n**2)\n\n    # Radial Schrödinger equation: u'' = g(r) * u\n    def g(r, z_val, l_val, e_val):\n        if r == 0:\n            return 0  # Avoid division by zero, though not used at r=0\n        return (l_val * (l_val + 1) / r**2) - (2 * z_val / r) - (2 * e_val)\n\n    # System of 1st order ODEs for [u, u']\n    def ode_system(r, y, z_val, l_val, e_val):\n        u, u_prime = y\n        return [u_prime, g(r, z_val, l_val, e_val) * u]\n\n    # Initial conditions at a small r0 to avoid singularity\n    r0 = 1e-7\n    u_r0 = r0**(l + 1)\n    u_prime_r0 = (l + 1) * r0**l\n    y0 = [u_r0, u_prime_r0]\n    \n    # Numerically integrate the ODE from r0 to rc\n    sol = solve_ivp(\n        ode_system, \n        [r0, rc], \n        y0, \n        args=(Z, l, E), \n        dense_output=True,\n        rtol=1e-12,\n        atol=1e-14\n    )\n\n    # Values of the AE solution at the cutoff radius rc\n    u_ae_rc, u_prime_ae_rc = sol.sol(rc)\n    u_double_prime_ae_rc = g(rc, Z, l, E) * u_ae_rc\n\n    # Integrated norm of the AE wavefunction inside rc\n    # We use the dense output from the solver for accurate integration with quad\n    u_ae_func = lambda r: sol.sol(r)[0]\n    norm_ae_integrand = lambda r: u_ae_func(r)**2\n    N_ae = quad(norm_ae_integrand, r0, rc)[0]\n\n    #\n    # Part 2  3: Pseudo-Wavefunction (PS) and Norm Conservation\n    #\n\n    # Determine P(rc), P'(rc), P''(rc) from matching conditions\n    P_rc = u_ae_rc / (rc**(l + 1))\n    P_prime_rc = (u_prime_ae_rc - (l + 1) * u_ae_rc / rc) / (rc**(l + 1))\n    P_double_prime_rc = (u_double_prime_ae_rc - l * (l + 1) * P_rc * rc**(l - 1) - 2 * (l + 1) * P_prime_rc * rc**l) / (rc**(l + 1))\n    \n    # This function takes a_3 and computes the norm of the corresponding PS wavefunction\n    def objective_function(a3):\n        # Calculate a0, a1, a2 based on a3 and the matching conditions\n        a2 = 0.5 * P_double_prime_rc - 3 * rc * a3\n        a1 = P_prime_rc - 2 * rc * a2 - 3 * rc**2 * a3\n        a0 = P_rc - rc * a1 - rc**2 * a2 - rc**3 * a3\n        \n        # Define the PS wavefunction integrand |u_ps(r)|^2\n        def ps_norm_integrand(r):\n            poly = a0 + a1 * r + a2 * r**2 + a3 * r**3\n            u_ps = r**(l + 1) * poly\n            return u_ps**2\n        \n        # Calculate the PS norm and return the difference from the AE norm\n        N_ps = quad(ps_norm_integrand, 0, rc, limit=100)[0]\n        return N_ps - N_ae\n\n    # Find the root of the objective function to determine a3\n    # A wide bracket is used to ensure the root is found.\n    try:\n        sol_a3 = root_scalar(objective_function, bracket=[-1e6, 1e6], method='brentq', xtol=1e-15)\n        a3_final = sol_a3.root\n    except ValueError:\n        # Fallback if the first bracket fails, which is unlikely for this problem\n        try:\n             sol_a3 = root_scalar(objective_function, x0=0.0, x1=1.0, rtol=1e-15, maxiter=200)\n             a3_final = sol_a3.root\n        except Exception as e:\n            print(f\"Root finding failed for Z={Z}, n={n}, rc={rc}, l={l} with error: {e}\")\n            return np.nan\n\n\n    #\n    # Part 4: Verification\n    #\n    \n    # With the final a3, recalculate the PS norm to check error\n    final_norm_diff = objective_function(a3_final)\n    \n    if N_ae == 0:\n        return 0.0\n\n    # Calculate the relative norm error\n    epsilon_l = abs(final_norm_diff) / N_ae\n    \n    return epsilon_l\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (Z, n, rc, l_values)\n        (8, 2, 1.2, [0, 1]),\n        (14, 3, 1.8, [0, 1, 2]),\n        (29, 3, 0.8, [0, 1, 2]),\n    ]\n\n    results = []\n    for Z, n, rc, l_values in test_cases:\n        for l in l_values:\n            error = compute_norm_error(Z, n, rc, l)\n            results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在数值构建了赝势之后，这个分析性练习将揭示其背后的深刻物理权衡。全电子波函数在原子核处存在一个尖点（cusp），这是库仑势奇异性的直接结果，而赝势的核心思想之一就是将这个尖点平滑化以降低计算所需的平面波截断能。本练习通过一个简化的模型，要求你精确推导并计算因波函数平滑化而导致的动能期望值的变化，从而让你从解析的角度理解赝势的“软硬”与其物理性质之间的定量关系。",
            "id": "3798496",
            "problem": "考虑一个在核电荷为 $Z$ 的类氢库仑场中的非相对论电子，其行为由不含时薛定谔方程和动能算符 $\\hat{T} = - \\frac{\\hbar^{2}}{2 m_{e}} \\nabla^{2}$ 决定。其基态全电子波函数是球对称的，由下式给出\n$$\\psi_{\\mathrm{AE}}(r) = \\frac{Z^{3/2}}{\\sqrt{\\pi} a_{0}^{3/2}} \\exp\\!\\left(-\\frac{Z r}{a_{0}}\\right),$$\n其中 $a_{0}$ 是玻尔半径。全电子波函数在原子核处的尖点条件是库仑奇点的结果。在投影缀加波（PAW）方法所基于的赝势构造中，通过在核心半径 $r_{c} > 0$ 内平滑波函数来移除此尖点。考虑以下平滑的赝波函数，\n$$\n\\psi_{\\mathrm{PS}}(r) =\n\\begin{cases}\nA + B r^{2},  0 \\le r \\le r_{c}, \\\\\n\\psi_{\\mathrm{AE}}(r),  r > r_{c},\n\\end{cases}\n$$\n其中系数 $A$ 和 $B$ 的选择需满足 $\\psi_{\\mathrm{PS}}(r)$ 及其一阶径向导数在 $r = r_{c}$ 处连续，且 $\\partial_{r} \\psi_{\\mathrm{PS}}(0) = 0$（尖点移除）。\n\n从动能期望值的定义出发，仅使用基本算符和球对称态的标准积分恒等式，推导并计算动能差的闭式表达式\n$$\\Delta T \\equiv \\langle T \\rangle_{\\mathrm{PS}} - \\langle T \\rangle_{\\mathrm{AE}}.$$\n请用哈特里单位表示你的最终答案。你的答案必须是仅含 $Z$、$a_{0}$ 和 $r_{c}$ 的单个闭式解析表达式，并且必须是精确的（无数值近似或舍入）。",
            "solution": "用户希望找出赝波函数 $\\psi_{\\mathrm{PS}}$ 与全电子波函数 $\\psi_{\\mathrm{AE}}$ 之间的动能差 $\\Delta T \\equiv \\langle T \\rangle_{\\mathrm{PS}} - \\langle T \\rangle_{\\mathrm{AE}}$。\n\n问题陈述的验证如下：\n- **已知条件**：\n    - 动能算符：$\\hat{T} = - \\frac{\\hbar^{2}}{2 m_{e}} \\nabla^{2}$。\n    - 全电子波函数：$\\psi_{\\mathrm{AE}}(r) = \\frac{Z^{3/2}}{\\sqrt{\\pi} a_{0}^{3/2}} \\exp\\!\\left(-\\frac{Z r}{a_{0}}\\right)$。\n    - 赝波函数：\n    $$\n    \\psi_{\\mathrm{PS}}(r) =\n    \\begin{cases}\n    A + B r^{2},  0 \\le r \\le r_{c}, \\\\\n    \\psi_{\\mathrm{AE}}(r),  r > r_{c}.\n    \\end{cases}\n    $$\n    - 条件：$\\psi_{\\mathrm{PS}}$ 和 $\\partial_r\\psi_{\\mathrm{PS}}$ 在 $r=r_c$ 处连续，且 $\\partial_r\\psi_{\\mathrm{PS}}(0) = 0$。\n    - 目标：推导并计算 $\\Delta T$ 的精确闭式表达式，以哈特里单位表示。\n\n- **验证**：\n    - 该问题在科学上基于非相对论量子力学和标准赝势理论。所有算符、函数和概念都是成熟的。\n    - 该问题是适定的。所提供的条件足以唯一确定未知参数并计算所需量。\n    - 该问题是客观的，使用了精确和正式的语言。\n    - 该问题不是不完整、矛盾或不适定的。其设置是计算材料科学中一个标准的教科书级问题。\n\n- **结论**：该问题有效。\n\n对于一个归一化的、实值的、球对称的波函数 $\\psi(r)$，其动能期望值由下式给出：\n$$ \\langle T \\rangle = \\int \\psi(r) \\hat{T} \\psi(r) dV = \\int \\psi(r) \\left( - \\frac{\\hbar^{2}}{2 m_{e}} \\nabla^{2} \\right) \\psi(r) dV $$\n利用分部积分法，以及波函数在无穷远处趋于零的事实，上式可以改写为更方便的形式。对于三维空间中的球对称态，体积元为 $dV = 4\\pi r^2 dr$，动能为：\n$$ \\langle T \\rangle = \\frac{\\hbar^2}{2m_e} \\int_{0}^{\\infty} \\left( \\frac{d\\psi}{dr} \\right)^2 4\\pi r^2 dr = \\frac{2\\pi\\hbar^2}{m_e} \\int_{0}^{\\infty} \\left( \\frac{d\\psi}{dr} \\right)^2 r^2 dr $$\n动能的变化量 $\\Delta T$ 是：\n$$ \\Delta T = \\langle T \\rangle_{\\mathrm{PS}} - \\langle T \\rangle_{\\mathrm{AE}} = \\frac{2\\pi\\hbar^2}{m_e} \\left[ \\int_{0}^{\\infty} \\left(\\frac{d\\psi_{\\mathrm{PS}}}{dr}\\right)^2 r^2 dr - \\int_{0}^{\\infty} \\left(\\frac{d\\psi_{\\mathrm{AE}}}{dr}\\right)^2 r^2 dr \\right] $$\n根据定义，当 $r > r_c$ 时，$\\psi_{\\mathrm{PS}}(r) = \\psi_{\\mathrm{AE}}(r)$。因此，它们的导数在此区域也相同。这使我们可以消去在区间 $[r_c, \\infty)$ 上的积分：\n$$ \\Delta T = \\frac{2\\pi\\hbar^2}{m_e} \\left[ \\left(\\int_{0}^{r_c} \\left(\\frac{d\\psi_{\\mathrm{PS}}}{dr}\\right)^2 r^2 dr + \\int_{r_c}^{\\infty} \\left(\\frac{d\\psi_{\\mathrm{PS}}}{dr}\\right)^2 r^2 dr\\right) - \\left(\\int_{0}^{r_c} \\left(\\frac{d\\psi_{\\mathrm{AE}}}{dr}\\right)^2 r^2 dr + \\int_{r_c}^{\\infty} \\left(\\frac{d\\psi_{\\mathrm{AE}}}{dr}\\right)^2 r^2 dr\\right) \\right] $$\n$$ \\Delta T = \\frac{2\\pi\\hbar^2}{m_e} \\left[ \\int_{0}^{r_c} \\left(\\frac{d\\psi_{\\mathrm{PS}}}{dr}\\right)^2 r^2 dr - \\int_{0}^{r_c} \\left(\\frac{d\\psi_{\\mathrm{AE}}}{dr}\\right)^2 r^2 dr \\right] $$\n这表明动能的变化完全局限于核心区域 $r \\le r_c$ 内。\n\n为简便起见，我们定义 $\\psi_{\\mathrm{AE}}$ 的常数部分：$C = \\frac{Z^{3/2}}{\\sqrt{\\pi} a_{0}^{3/2}}$ 和 $\\alpha = \\frac{Z}{a_0}$。因此，$\\psi_{\\mathrm{AE}}(r) = C \\exp(-\\alpha r)$。\n所需的导数是：\n当 $r \\le r_c$ 时，$\\psi_{\\mathrm{PS}}(r) = A + Br^2$，所以 $\\frac{d\\psi_{\\mathrm{PS}}}{dr} = 2Br$。\n对于任意 $r$，$\\frac{d\\psi_{\\mathrm{AE}}}{dr} = -C\\alpha \\exp(-\\alpha r) = -\\alpha \\psi_{\\mathrm{AE}}(r)$。\n\n一阶导数在 $r_c$ 处的连续性意味着：\n$$ \\left.\\frac{d\\psi_{\\mathrm{PS}}}{dr}\\right|_{r=r_c} = \\left.\\frac{d\\psi_{\\mathrm{AE}}}{dr}\\right|_{r=r_c} $$\n$$ 2Br_c = -C\\alpha \\exp(-\\alpha r_c) $$\n求解 $B$：\n$$ B = -\\frac{C\\alpha}{2r_c} \\exp(-\\alpha r_c) $$\n系数 $A$ 由波函数本身的连续性确定，但在动能计算中不需要用到。\n\n现在，我们计算 $\\Delta T$ 的两个积分。\n第一个积分（来自核心区的赝势贡献）：\n$$ T_{\\mathrm{PS-core}} = \\int_{0}^{r_c} \\left(\\frac{d\\psi_{\\mathrm{PS}}}{dr}\\right)^2 r^2 dr = \\int_{0}^{r_c} (2Br)^2 r^2 dr = 4B^2 \\int_{0}^{r_c} r^4 dr = 4B^2 \\frac{r_c^5}{5} $$\n代入 $B^2 = \\frac{C^2\\alpha^2}{4r_c^2} \\exp(-2\\alpha r_c)$ 的表达式：\n$$ T_{\\mathrm{PS-core}} = 4 \\left( \\frac{C^2\\alpha^2}{4r_c^2} \\exp(-2\\alpha r_c) \\right) \\frac{r_c^5}{5} = \\frac{1}{5} C^2\\alpha^2 r_c^3 \\exp(-2\\alpha r_c) $$\n第二个积分（来自核心区的全电子贡献）：\n$$ T_{\\mathrm{AE-core}} = \\int_{0}^{r_c} \\left(\\frac{d\\psi_{\\mathrm{AE}}}{dr}\\right)^2 r^2 dr = \\int_{0}^{r_c} (-C\\alpha \\exp(-\\alpha r))^2 r^2 dr = C^2\\alpha^2 \\int_{0}^{r_c} r^2 \\exp(-2\\alpha r) dr $$\n为计算此积分，我们使用通过分部积分得到的标准积分恒等式：\n$$ \\int r^2 e^{kx} dr = e^{kx} \\left( \\frac{r^2}{k} - \\frac{2r}{k^2} + \\frac{2}{k^3} \\right) $$\n令 $k = -2\\alpha$，定积分为：\n$$ \\int_{0}^{r_c} r^2 \\exp(-2\\alpha r) dr = \\left[ \\exp(-2\\alpha r) \\left( -\\frac{r^2}{2\\alpha} - \\frac{2r}{4\\alpha^2} - \\frac{2}{8\\alpha^3} \\right) \\right]_{0}^{r_c} $$\n$$ = \\left[ -\\exp(-2\\alpha r) \\left( \\frac{r^2}{2\\alpha} + \\frac{r}{2\\alpha^2} + \\frac{1}{4\\alpha^3} \\right) \\right]_{0}^{r_c} $$\n$$ = -\\exp(-2\\alpha r_c)\\left(\\frac{r_c^2}{2\\alpha} + \\frac{r_c}{2\\alpha^2} + \\frac{1}{4\\alpha^3}\\right) - \\left(-1 \\cdot \\left(0 + 0 + \\frac{1}{4\\alpha^3}\\right)\\right) $$\n$$ = \\frac{1}{4\\alpha^3} - \\exp(-2\\alpha r_c)\\left(\\frac{r_c^2}{2\\alpha} + \\frac{r_c}{2\\alpha^2} + \\frac{1}{4\\alpha^3}\\right) $$\n所以，$T_{\\mathrm{AE-core}} = C^2\\alpha^2\\left[\\frac{1}{4\\alpha^3} - \\exp(-2\\alpha r_c)\\left(\\frac{r_c^2}{2\\alpha} + \\frac{r_c}{2\\alpha^2} + \\frac{1}{4\\alpha^3}\\right)\\right]$。\n\n现在，组合 $\\Delta T$：\n$$ \\Delta T = \\frac{2\\pi\\hbar^2}{m_e} \\left( T_{\\mathrm{PS-core}} - T_{\\mathrm{AE-core}} \\right) $$\n$$ \\Delta T = \\frac{2\\pi\\hbar^2 C^2 \\alpha^2}{m_e} \\left[ \\frac{1}{5} r_c^3 \\exp(-2\\alpha r_c) - \\left( \\frac{1}{4\\alpha^3} - \\exp(-2\\alpha r_c)\\left(\\frac{r_c^2}{2\\alpha} + \\frac{r_c}{2\\alpha^2} + \\frac{1}{4\\alpha^3}\\right) \\right) \\right] $$\n$$ \\Delta T = \\frac{2\\pi\\hbar^2 C^2 \\alpha^2}{m_e} \\left[ -\\frac{1}{4\\alpha^3} + \\exp(-2\\alpha r_c) \\left( \\frac{r_c^3}{5} + \\frac{r_c^2}{2\\alpha} + \\frac{r_c}{2\\alpha^2} + \\frac{1}{4\\alpha^3} \\right) \\right] $$\n我们可以分离各项：\n$$ \\Delta T = -\\frac{2\\pi\\hbar^2 C^2 \\alpha^2}{m_e} \\frac{1}{4\\alpha^3} + \\frac{2\\pi\\hbar^2 C^2 \\alpha^2}{m_e} \\exp(-2\\alpha r_c) \\left( \\frac{r_c^3}{5} + \\frac{r_c^2}{2\\alpha} + \\frac{r_c}{2\\alpha^2} + \\frac{1}{4\\alpha^3} \\right) $$\n第一项是 $-\\frac{\\pi\\hbar^2 C^2}{2m_e \\alpha}$。代入 $C^2 = \\frac{Z^3}{\\pi a_0^3}$ 和 $\\alpha=\\frac{Z}{a_0}$：\n$$ -\\frac{\\pi\\hbar^2}{2m_e} \\frac{Z^3/\\pi a_0^3}{Z/a_0} = -\\frac{\\hbar^2 Z^2}{2m_e a_0^2} = -\\frac{Z^2}{2} \\left(\\frac{\\hbar^2}{m_e a_0^2}\\right) = -\\frac{Z^2}{2} E_h $$\n这恰好是全电子态总动能的负值，即 $-\\langle T \\rangle_{\\mathrm{AE}}$。这个计算是一致的，因为 $T_{\\mathrm{AE-core}}$ 的积分可以看作是 $\\langle T \\rangle_{\\mathrm{AE}} - T_{\\mathrm{AE-outer}}$。\n第二项的系数是 $\\frac{2\\pi\\hbar^2 C^2 \\alpha^2}{m_e} = \\frac{2\\pi\\hbar^2}{m_e} \\frac{Z^3}{\\pi a_0^3} \\frac{Z^2}{a_0^2} = \\frac{2\\hbar^2 Z^5}{m_e a_0^5} = \\frac{2Z^5}{a_0^3} E_h$。\n令 $x = \\alpha r_c = \\frac{Zr_c}{a_0}$。括号中的项是：\n$$ \\frac{1}{\\alpha^3}\\left(\\frac{(\\alpha r_c)^3}{5} + \\frac{(\\alpha r_c)^2}{2} + \\frac{\\alpha r_c}{2} + \\frac{1}{4}\\right) = \\frac{a_0^3}{Z^3} \\left(\\frac{x^3}{5} + \\frac{x^2}{2} + \\frac{x}{2} + \\frac{1}{4}\\right) $$\n$\\Delta T$ 的第二项变为：\n$$ \\left(\\frac{2Z^5}{a_0^3} E_h\\right) \\exp(-2x) \\left[ \\frac{a_0^3}{Z^3} \\left(\\frac{x^3}{5} + \\frac{x^2}{2} + \\frac{x}{2} + \\frac{1}{4}\\right) \\right] = 2Z^2 E_h \\exp(-2x) \\left(\\frac{x^3}{5} + \\frac{x^2}{2} + \\frac{x}{2} + \\frac{1}{4}\\right) $$\n综合所有部分：\n$$ \\Delta T = -\\frac{Z^2}{2}E_h + 2Z^2 E_h \\exp(-2x) \\left(\\frac{x^3}{5} + \\frac{x^2}{2} + \\frac{x}{2} + \\frac{1}{4}\\right) $$\n$$ \\Delta T = \\frac{Z^2}{2}E_h \\left[ -1 + 4\\exp(-2x) \\left(\\frac{x^3}{5} + \\frac{x^2}{2} + \\frac{x}{2} + \\frac{1}{4}\\right) \\right] $$\n$$ \\Delta T = \\frac{Z^2}{2}E_h \\left[ -1 + \\exp(-2x) \\left(\\frac{4x^3}{5} + 2x^2 + 2x + 1\\right) \\right] $$\n将 $x$ 替换为其定义，得到最终表达式。以哈特里单位（$E_h=1$）表示，结果是：\n$$ \\Delta T = \\frac{Z^2}{2} \\left[ -1 + \\exp\\left(-\\frac{2Zr_c}{a_0}\\right) \\left( 1 + 2\\frac{Zr_c}{a_0} + 2\\left(\\frac{Zr_c}{a_0}\\right)^2 + \\frac{4}{5}\\left(\\frac{Zr_c}{a_0}\\right)^3 \\right) \\right] $$",
            "answer": "$$ \\boxed{ \\frac{Z^2}{2} \\left[ -1 + \\exp\\left(-\\frac{2Zr_c}{a_0}\\right) \\left( 1 + 2\\frac{Zr_c}{a_0} + 2\\left(\\frac{Zr_c}{a_0}\\right)^2 + \\frac{4}{5}\\left(\\frac{Zr_c}{a_0}\\right)^3 \\right) \\right] } $$"
        },
        {
            "introduction": "最后一个实践练习将前两个练习的概念提升到实际应用的层面，解决赝势生成中的一个核心问题：如何选择最佳的截断半径 $r_c$？这个参数的选择直接决定了计算的精度（可移植性）和效率（计算成本）之间的平衡。本练习通过构建并最小化一个综合了可移植性误差和计算成本的代价函数 $J(r_c)$，指导你学习如何做出有原则的、定量的决策，从而在保证物理精度的同时，最大化计算的可行性。",
            "id": "3798516",
            "problem": "您的任务是利用赝势的核半径参数 $r_c$，构建并分析赝势的可移植性质量与平面波基组中的计算成本之间的数学上合理的权衡关系。背景是多尺度建模中的投影缀加波（PAW）方法，其中半径为 $r_c$ 的球面内的局域化缀加可以平滑全电子势和波函数，这会影响散射可移植性和平面波能量截断 $E_{cut}$ 的要求。\n\n出发点和物理基础：\n- 在原子单位制中，平面波基组中的单粒子哈密顿量意味着，解析一个局域在半径为 $r_c$ 的球面内的函数所需的最大倒易空间矢量 $G_{max}$ 的标度关系为 $G_{max} \\approx \\kappa / r_c$，其中 $\\kappa$ 是由倒易空间中指定的精度阈值决定的无量纲常数。这个标度关系通过不确定性原理和球贝塞尔变换的衰减特性，反映了紧支集径向函数的光谱内容。\n- 平面波能量截断由 $E_{cut} = \\frac{\\hbar^2 G_{max}^2}{2 m_e}$ 给出。在原子单位制中，$\\frac{\\hbar^2}{2 m_e} = 1$ Hartree，换算关系为 $1$ Hartree $= 27.211386245988$ eV。\n- 随着 $r_c$ 增大，缀加在核区域内更强地平滑了赝势，这通常会增加散射性质的可移植性误差。我们用幂律 $T(r_c) = \\eta \\left(\\frac{r_c}{r_0}\\right)^q$ 来模拟这种单调趋势，其中 $\\eta > 0$ 是一个标度因子，$r_0 > 0$ 是一个参考半径，$q > 0$ 是一个反映对核平滑敏感度的指数。\n\n定义结合了可移植性误差和计算需求的标量代价函数 $J(r_c)$：\n$$\nJ(r_c) = w_T \\, T(r_c) + w_C \\, \\left(E_{cut}(r_c)\\right)^s,\n$$\n其中 $w_T > 0$ 和 $w_C > 0$ 是权重，而 $s > 0$ 是一个反映对能量截断要求惩罚严重程度的敏感度指数。\n\n您的任务：\n1. 基于以上基础，推导出一个用 $r_c$ 和 $\\kappa$ 表示 $E_{cut}(r_c)$（以电子伏特为单位）的数学上合理的表达式，并将其用于 $J(r_c)$ 中。\n2. 证明对于 $q > 0$ 和 $s > 0$，函数 $J(r_c)$ 在 $(0,\\infty)$ 上是严格凸的，并且有唯一的最小化子，并通过求解 $\\frac{dJ}{dr_c} = 0$ 推导出闭式最小化子 $r_c^\\star$。\n3. 设计一个算法，在给定参数和 $r_c$ 的物理上可接受的区间 $[r_{min}, r_{max}]$ 的情况下，返回约束最小化子 $r_c^{opt} = \\min\\left(\\max\\left(r_c^\\star, r_{min}\\right), r_{max}\\right)$（以玻尔为单位）。\n4. 将该算法实现为一个完整的、可运行的程序，为下面的每个测试用例计算 $r_c^{opt}$，并将结果打印在单行上，形式为方括号括起来的逗号分隔列表。每个数字必须四舍五入到六位小数。\n5. 在您的解决方案中为可移植性误差和 $E_{cut}$ 要求之间的权衡选择提供数学证明，明确展示这种权衡如何在 $r_c^\\star$ 的表达式和约束解中体现出来。\n\n使用的单位和常数：\n- $r_c$ 以玻尔为单位。\n- $E_{cut}$ 以电子伏特为单位。\n- 使用换算关系 $1$ Hartree $= 27.211386245988$ eV。\n- 使用 $\\pi$作为与倒易空间分辨率相关的常数，除非测试用例指定了不同的值。\n\n测试套件（每个用例提供 $(w_T,\\eta,r_0,q,w_C,s,\\kappa,r_{min},r_{max})$）：\n- 用例 $1$：$w_T = 1.0$, $\\eta = 0.02$, $r_0 = 1.00$ 玻尔, $q = 2$, $w_C = 10^{-4}$, $s = 1$, $\\kappa = \\pi$, $r_{min} = 0.50$ 玻尔, $r_{max} = 3.00$ 玻尔。\n- 用例 $2$：$w_T = 1.0$, $\\eta = 0.02$, $r_0 = 1.00$ 玻尔, $q = 2$, $w_C = 10^{-1}$, $s = 1$, $\\kappa = \\pi$, $r_{min} = 0.50$ 玻尔, $r_{max} = 3.00$ 玻尔。\n- 用例 $3$：$w_T = 10.0$, $\\eta = 0.05$, $r_0 = 1.00$ 玻尔, $q = 2$, $w_C = 10^{-4}$, $s = 1$, $\\kappa = \\pi$, $r_{min} = 0.50$ 玻尔, $r_{max} = 3.00$ 玻尔。\n- 用例 $4$：$w_T = 0.5$, $\\eta = 0.01$, $r_0 = 1.50$ 玻尔, $q = 3$, $w_C = 10^{-6}$, $s = 1.5$, $\\kappa = 2\\pi$, $r_{min} = 0.80$ 玻尔, $r_{max} = 2.50$ 玻尔。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result_1,result_2,result_3,result_4]$），其中每个 $result_i$ 是相应测试用例的优化核心半径 $r_c^{opt}$（以玻尔为单位），四舍五入到六位小数。",
            "solution": "用户提供了一个科学上有效且定义明确的问题。所有给定条件均已提取，问题结构合理。请求继续进行。\n\n任务是通过最小化一个在可移植性误差与计算成本之间取得平衡的代价函数 $J(r_c)$，来确定一个最优的赝势核半径 $r_c$。优化在指定的区间 $[r_{min}, r_{max}]$ 内执行。\n\n解决方案主要分为三个部分：首先，我们推导代价函数 $J(r_c)$ 的显式形式；其次，在确定存在唯一最小值后，通过求解 $\\frac{dJ}{dr_c} = 0$ 来找到无约束最小化子 $r_c^\\star$；第三，我们为有约束最小化子 $r_c^{opt}$ 定义算法，并分析解中所蕴含的物理权衡。\n\n首先，我们建立核半径 $r_c$ 和平面波能量截断 $E_{cut}$ 之间的关系。问题陈述了所需的最大倒易空间矢量标度为 $G_{max} \\approx \\kappa / r_c$，其中 $r_c$ 的单位是玻尔。动能截断由 $E_{cut} = \\frac{\\hbar^2 G_{max}^2}{2 m_e}$ 给出。在原子单位制（$\\hbar=1$, $m_e=1$）中，$\\frac{\\hbar^2}{2 m_e} = \\frac{1}{2}$ Hartree，而不是 $1$ Hartree。在平面波代码中，一个更标准的约定是 $E_{cut} = \\frac{\\hbar^2 G_{max}^2}{2 m_e}$，在原子单位制中，如果 $G_{max}$ 的单位是 $a_0^{-1}$，则 $E_{cut}$ 以 Hartree 为单位的值为 $E_{cut} = \\frac{1}{2} G_{max}^2$。问题陈述中声称 $\\frac{\\hbar^2}{2m_e} = 1$ Hartree，这在量纲上是不正确的。我们将此解释为该问题的定义，即波矢为 $\\vec{k}$ 的平面波的动能为 $E(\\vec{k}) = k^2$（以 Hartree 为单位），这是理论推导中一种常见的简化，其中因子 $1/2$ 被吸收到定义中。因此，我们令 $E_{cut}[\\text{Hartree}] = G_{max}^2$。\n使用给定的标度关系，我们有：\n$$\nE_{cut}[\\text{Hartree}] = \\left(\\frac{\\kappa}{r_c}\\right)^2 = \\frac{\\kappa^2}{r_c^2}\n$$\n为了将其转换为电子伏特（eV），我们使用提供的换算因子 $C = 27.211386245988 \\text{ eV/Hartree}$。\n$$\nE_{cut}(r_c)[\\text{eV}] = C \\frac{\\kappa^2}{r_c^2}\n$$\n这就是计算成本分量的表达式。可移植性误差由幂律模型 $T(r_c) = \\eta \\left(\\frac{r_c}{r_0}\\right)^q$ 给出。\n总代价函数 $J(r_c)$ 是这两个相互竞争因素的加权和：\n$$\nJ(r_c) = w_T T(r_c) + w_C \\left(E_{cut}(r_c)\\right)^s\n$$\n代入 $T(r_c)$ 和 $E_{cut}(r_c)$ 的表达式：\n$$\nJ(r_c) = w_T \\eta \\left(\\frac{r_c}{r_0}\\right)^q + w_C \\left(C \\frac{\\kappa^2}{r_c^2}\\right)^s\n$$\n$$\nJ(r_c) = \\left(\\frac{w_T \\eta}{r_0^q}\\right) r_c^q + \\left(w_C (C \\kappa^2)^s\\right) r_c^{-2s}\n$$\n为简化符号，令 $A = \\frac{w_T \\eta}{r_0^q}$ 且 $B = w_C (C \\kappa^2)^s$。参数 $w_T, w_C, \\eta, r_0, C, \\kappa$ 均为正数，所以 $A > 0$ 且 $B > 0$。对于 $r_c \\in (0, \\infty)$，要最小化的函数是：\n$$\nJ(r_c) = A r_c^q + B r_c^{-2s}\n$$\n\n接下来，我们寻求 $J(r_c)$ 的最小值。问题要求证明对于 $q > 0$ 和 $s > 0$，$J(r_c)$ 是严格凸的。我们分析其二阶导数：\n$$\n\\frac{dJ}{dr_c} = A q r_c^{q-1} - 2s B r_c^{-2s-1}\n$$\n$$\n\\frac{d^2J}{dr_c^2} = A q(q-1) r_c^{q-2} + 2s(2s+1) B r_c^{-2s-2}\n$$\n由于 $B > 0$ 且 $s > 0$，第二项 $2s(2s+1) B r_c^{-2s-2}$ 对于 $r_c > 0$ 总是严格为正。第一项的符号取决于 $q(q-1)$。由于 $A > 0$ 且 $q > 0$，符号由 $(q-1)$ 决定。如果 $q \\ge 1$，则 $q-1 \\ge 0$，第一项为非负。在这种情况下，$J''(r_c)$ 是一个非负项与一个严格为正项之和，所以 $J''(r_c) > 0$。因此，对于 $q \\ge 1$，$J(r_c)$ 是严格凸的。所有提供的测试用例都满足 $q \\ge 2$，因此可以保证凸性。\n然而，问题中关于 $J(r_c)$ 对所有 $q > 0$ 都是严格凸的论断并非普遍成立。如果 $0  q  1$，第一项 $A q(q-1) r_c^{q-2}$ 为负，则和的凸性不确定。\n尽管如此，我们仍然可以证明对于所有 $q  0, s  0$ 存在唯一的最小化子。观察 $J(r_c)$ 的渐近行为：\n当 $r_c \\to 0^+$ 时，由于 $-2s  0$，项 $B r_c^{-2s} \\to \\infty$。\n当 $r_c \\to \\infty$ 时，由于 $q  0$，项 $A r_c^q \\to \\infty$。\n由于函数在 $(0, \\infty)$ 上为正，并在两端趋于无穷大，它必须至少有一个全局最小值。为了找到临界点，我们将一阶导数设为零：\n$$\nA q r_c^{q-1} = 2s B r_c^{-2s-1}\n$$\n$$\nr_c^{q-1 - (-2s-1)} = \\frac{2s B}{A q}\n$$\n$$\nr_c^{q+2s} = \\frac{2s B}{A q}\n$$\n这为 $r_c$ 提供了一个唯一的正实数解：\n$$\nr_c^\\star = \\left(\\frac{2s B}{A q}\\right)^{\\frac{1}{q+2s}}\n$$\n由于在定义域中只有一个临界点，并且函数在边界处趋于无穷大，因此该临界点必定是唯一的全局最小化子。将 $A$ 和 $B$ 的表达式代回：\n$$\nr_c^\\star = \\left( \\frac{2s \\cdot w_C (C \\kappa^2)^s}{q \\cdot w_T \\eta / r_0^q} \\right)^{\\frac{1}{q+2s}} = \\left( \\frac{2s}{q} \\frac{w_C}{w_T} \\frac{r_0^q}{\\eta} (C \\kappa^2)^s \\right)^{\\frac{1}{q+2s}}\n$$\n这就是无约束最优核心半径的闭式表达式。\n\n最后，我们讨论有约束优化和物理权衡问题。核心半径的物理允许范围为 $[r_{min}, r_{max}]$。因为 $J(r_c)$ 在 $r_c^\\star$ 处有唯一的全局最小值，所以函数在 $r_c \\in (0, r_c^\\star]$ 上单调递减，在 $r_c \\in [r_c^\\star, \\infty)$ 上单调递增。区间 $[r_{min}, r_{max}]$ 内的最小化子，记为 $r_c^{opt}$，通过将 $r_c^\\star$ 限制在该区间内得到：\n- 如果 $r_c^\\star  r_{min}$，则区间上的最小值出现在左边界，所以 $r_c^{opt} = r_{min}$。\n- 如果 $r_c^\\star  r_{max}$，则区间上的最小值出现在右边界，所以 $r_c^{opt} = r_{max}$。\n- 如果 $r_{min} \\le r_c^\\star \\le r_{max}$，则无约束最小值位于区间内，所以 $r_c^{opt} = r_c^\\star$。\n这个逻辑可以紧凑地表示为 $r_c^{opt} = \\min(\\max(r_c^\\star, r_{min}), r_{max})$。\n\n可移植性（准确性）和计算成本之间的权衡在 $r_c^\\star$ 的公式中是明确的。代价函数可以写成 $J = \\text{准确性惩罚} + \\text{成本惩罚}$。增加 $r_c$ 会增加准确性惩罚（$T(r_c) \\propto r_c^q$），但会减少成本惩罚（$ (E_{cut})^s \\propto (r_c^{-2})^s = r_c^{-2s}$）。最优值 $r_c^\\star$ 平衡了这些相反的趋势。比率 $\\frac{w_C}{w_T}$ 直接控制这种平衡。\n- 如果我们优先考虑低计算成本，我们会增加其权重 $w_C$ 相对于可移植性权重 $w_T$ 的值。一个更大的 $\\frac{w_C}{w_T}$ 比率会导致一个更大的 $r_c^\\star$。更大的半径 $r_c$ 使赝势变得“更软”，从而显著降低所需的能量截断 $E_{cut} \\propto 1/r_c^2$，进而节省计算时间。\n- 如果我们优先考虑高准确性（低可移植性误差），我们会增加 $w_T$ 相对于 $w_C$ 的值。一个更小的 $\\frac{w_C}{w_T}$ 比率会导致一个更小的 $r_c^\\star$。更小的半径 $r_c$ 使赝势变得“更硬”，并且在核区域内更忠实于全电子势，从而降低了 $T(r_c) \\propto r_c^q$，但代价是需要高得多的 $E_{cut}$，因而计算成本也更高。\n\n要实现的算法如下：\n1. 对于一组给定的参数 $(w_T, \\eta, r_0, q, w_C, s, \\kappa, r_{min}, r_{max})$，使用推导出的闭式表达式计算无约束最小化子 $r_c^\\star$。\n2. 将此值约束在允许的区间 $[r_{min}, r_{max}]$ 内，以找到最优的实际半径 $r_c^{opt}$。\n3. 对所有测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the optimal constrained pseudopotential core radius by minimizing a cost function\n    that balances transferability error and computational cost.\n    \"\"\"\n    \n    # Define physical constants and test cases as per the problem statement.\n    HARTREE_TO_EV = 27.211386245988  # Conversion factor C\n\n    test_cases = [\n        # Case 1: Baseline\n        {'w_T': 1.0, 'eta': 0.02, 'r_0': 1.00, 'q': 2, 'w_C': 1e-4, 's': 1.0, 'kappa_factor': 1.0, 'r_min': 0.50, 'r_max': 3.00},\n        # Case 2: High computational cost weight\n        {'w_T': 1.0, 'eta': 0.02, 'r_0': 1.00, 'q': 2, 'w_C': 1e-1, 's': 1.0, 'kappa_factor': 1.0, 'r_min': 0.50, 'r_max': 3.00},\n        # Case 3: High transferability error weight\n        {'w_T': 10.0, 'eta': 0.05, 'r_0': 1.00, 'q': 2, 'w_C': 1e-4, 's': 1.0, 'kappa_factor': 1.0, 'r_min': 0.50, 'r_max': 3.00},\n        # Case 4: Different exponents and kappa\n        {'w_T': 0.5, 'eta': 0.01, 'r_0': 1.50, 'q': 3, 'w_C': 1e-6, 's': 1.5, 'kappa_factor': 2.0, 'r_min': 0.80, 'r_max': 2.50}\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters for the current test case\n        w_T = case['w_T']\n        eta = case['eta']\n        r_0 = case['r_0']\n        q = case['q']\n        w_C = case['w_C']\n        s = case['s']\n        kappa = case['kappa_factor'] * np.pi\n        r_min = case['r_min']\n        r_max = case['r_max']\n\n        # The derived closed-form expression for the unconstrained minimizer r_c^* is:\n        # r_c^* = [ (2*s / q) * (w_C / w_T) * (r_0^q / eta) * (C * kappa^2)^s ] ^ (1 / (q + 2*s))\n        \n        # Calculate each part of the expression for clarity\n        \n        # Term 1: (2s / q)\n        term1 = (2 * s) / q\n        \n        # Term 2: (w_C / w_T)\n        term2 = w_C / w_T\n        \n        # Term 3: (r_0^q / eta)\n        term3 = (r_0 ** q) / eta\n        \n        # Term 4: (C * kappa^2)^s\n        term4 = (HARTREE_TO_EV * kappa**2) ** s\n        \n        # Power exponent: 1 / (q + 2s)\n        exponent = 1 / (q + 2 * s)\n        \n        # Combine terms to find the unconstrained minimizer r_c_star\n        inside_bracket = term1 * term2 * term3 * term4\n        rc_star = inside_bracket ** exponent\n        \n        # Apply the physical constraints [r_min, r_max] to find the optimal radius r_c_opt.\n        # np.clip(a, a_min, a_max) is equivalent to min(max(a, a_min), a_max).\n        rc_opt = np.clip(rc_star, r_min, r_max)\n        \n        results.append(rc_opt)\n\n    # Format the results for the final output as a comma-separated list\n    # of numbers rounded to six decimal places, enclosed in square brackets.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}