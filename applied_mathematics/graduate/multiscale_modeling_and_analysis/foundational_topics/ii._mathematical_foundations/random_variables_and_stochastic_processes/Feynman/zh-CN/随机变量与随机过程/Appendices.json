{
    "hands_on_practices": [
        {
            "introduction": "在多尺度建模中，一个核心任务是从微观状态中定义宏观可观测量。本练习将引导你运用测度论的语言，在一个由微尺度划分生成的 $\\sigma$-代数上，精确构建一个粗粒化随机变量 。通过这个实践，你将掌握如何将微观细节通过条件期望平均化为宏观量，这是连接不同尺度的关键数学方法。",
            "id": "3799984",
            "problem": "考虑一个如下定义的微观尺度概率空间。令 $\\Omega = [0,1]$，其上赋有Borel $\\sigma$-代数和概率测度 $\\mu$。该测度相对于Lebesgue测度是绝对连续的，其概率密度函数 (PDF) 为 $p(x) = 1 + \\sin(2\\pi x)$，其中 $x \\in [0,1]$。令 $\\mathcal{P} = \\{A_{1},A_{2},A_{3}\\}$ 为 $\\Omega$ 的一个划分，由 $A_{1} = [0,\\frac{1}{3})$, $A_{2} = [\\frac{1}{3},\\frac{2}{3})$ 和 $A_{3} = [\\frac{2}{3},1]$ 给出。令 $\\sigma(\\mathcal{P})$ 表示由划分 $\\mathcal{P}$ 生成的 $\\sigma$-代数，它在多尺度模型中代表宏观尺度的观测分辨率。\n\n定义一个微观尺度可观测量 $g:\\Omega \\to \\mathbb{R}$ 为 $g(\\omega) = \\omega^{2}$。构造一个在每个划分元素上为常数且 $\\sigma(\\mathcal{P})$-可测的随机变量 $X:\\Omega \\to \\mathbb{R}$，它代表了 $g$ 在该元素上的粗粒化平均值，即对于 $\\omega \\in A_{i}$，\n$$\nX(\\omega) = c_{i}, \\quad \\text{其中 } c_{i} = \\frac{\\int_{A_{i}} g(x)\\,p(x)\\,dx}{\\int_{A_{i}} p(x)\\,dx}.\n$$\n从 $\\sigma$-代数、可测性以及由 $\\mu$ 诱导的随机变量分布的基本定义出发，并仅使用积分的标准性质，完成以下任务：\n\n- 证明 $X$ 是 $\\sigma(\\mathcal{P})$-可测的，并且在每个 $A_{i}$ 上是常数。\n- 通过确定其支撑集 $\\{c_{1},c_{2},c_{3}\\}$ 和相应的概率 $\\mu(A_{i})$ 来计算 $X$ 的分布。\n- 根据第一性原理计算期望 $\\mathbb{E}[X]$。\n\n将 $\\mathbb{E}[X]$ 的精确值以最简闭合形式作为最终答案报告。不要求四舍五入。不要求单位。所有中间和最终的数学步骤仅使用形式化的数学符号表示。",
            "solution": "问题陈述定义了一个有效的概率空间，并在测度论概率和多尺度分析的框架内提出了一个定义明确的问题。概率密度函数 $p(x) = 1 + \\sin(2\\pi x)$ 在 $\\Omega = [0,1]$ 上是非负的，并且其在 $\\Omega$ 上的积分为 $\\int_{0}^{1} (1 + \\sin(2\\pi x))\\,dx = [x - \\frac{1}{2\\pi}\\cos(2\\pi x)]_{0}^{1} = (1 - \\frac{1}{2\\pi}) - (0 - \\frac{1}{2\\pi}) = 1$。该问题具有科学依据，内容自洽，且客观。我们可以开始求解。\n\n问题要求完成三项任务：证明随机变量 $X$ 的可测性，计算其分布，以及计算其期望 $\\mathbb{E}[X]$。\n\n首先，我们证明 $X$ 是 $\\sigma(\\mathcal{P})$-可测的。划分为 $\\mathcal{P} = \\{A_{1}, A_{2}, A_{3}\\}$，其中 $A_{1} = [0,\\frac{1}{3})$, $A_{2} = [\\frac{1}{3},\\frac{2}{3})$，$A_{3} = [\\frac{2}{3},1]$。由该划分生成的 $\\sigma$-代数 $\\sigma(\\mathcal{P})$ 包含这些集合的所有可能的并集，包括空集 $\\emptyset$ 和全空间 $\\Omega$：\n$$ \\sigma(\\mathcal{P}) = \\{\\emptyset, A_{1}, A_{2}, A_{3}, A_{1}\\cup A_{2}, A_{1}\\cup A_{3}, A_{2}\\cup A_{3}, \\Omega\\} $$\n随机变量 $X:\\Omega \\to \\mathbb{R}$ 被定义为一个简单函数，在划分 $\\mathcal{P}$ 的每个元素上为常数：\n$$\nX(\\omega) =\n\\begin{cases}\nc_1  &\\text{若 } \\omega \\in A_1 \\\\\nc_2  &\\text{若 } \\omega \\in A_2 \\\\\nc_3  &\\text{若 } \\omega \\in A_3\n\\end{cases}\n$$\n其中常数 $c_i$ 是给定的。$X$ 的值域是集合 $\\{c_1, c_2, c_3\\}$。要使 $X$ 是 $\\sigma(\\mathcal{P})$-可测的，对于任何Borel集 $B \\subseteq \\mathbb{R}$，其原像 $X^{-1}(B)$ 必须属于 $\\sigma(\\mathcal{P})$。原像 $X^{-1}(B) = \\{\\omega \\in \\Omega \\mid X(\\omega) \\in B\\}$ 可由 $c_1, c_2, c_3$ 中哪些元素属于 $B$ 来确定。对于 $\\{c_1, c_2, c_3\\}$ 的任意子集 $S$，如果 $B \\cap \\{c_1, c_2, c_3\\} = S$，那么 $X^{-1}(B)$ 就是所有满足 $c_i \\in S$ 的集合 $A_i$ 的并集。由于任何这样的并集都是 $\\sigma(\\mathcal{P})$ 的一个元素，因此 $X$ 是 $\\sigma(\\mathcal{P})$-可测的。根据其定义，$X$ 在每个 $A_i$ 上是常数。\n\n其次，我们计算 $X$ 的分布。这需要找出支撑集 $\\{c_1, c_2, c_3\\}$ 和相应的概率 $P(X=c_i) = \\mu(A_i)$。通过在每个划分元素 $A_i$ 上对 PDF $p(x)$ 进行积分来计算这些概率。\n令 $p(x)$ 的不定积分为 $F(x) = \\int (1+\\sin(2\\pi x))\\,dx = x - \\frac{1}{2\\pi}\\cos(2\\pi x)$。\n这些概率为：\n$$ \\mu(A_1) = \\int_{0}^{1/3} p(x)\\,dx = F(\\frac{1}{3}) - F(0) = \\left(\\frac{1}{3} - \\frac{1}{2\\pi}\\cos(\\frac{2\\pi}{3})\\right) - \\left(0 - \\frac{1}{2\\pi}\\cos(0)\\right) = \\frac{1}{3} - \\frac{-\\frac{1}{2}}{2\\pi} + \\frac{1}{2\\pi} = \\frac{1}{3} + \\frac{1}{4\\pi} + \\frac{2}{4\\pi} = \\frac{1}{3} + \\frac{3}{4\\pi} $$\n$$ \\mu(A_2) = \\int_{1/3}^{2/3} p(x)\\,dx = F(\\frac{2}{3}) - F(\\frac{1}{3}) = \\left(\\frac{2}{3} - \\frac{1}{2\\pi}\\cos(\\frac{4\\pi}{3})\\right) - \\left(\\frac{1}{3} - \\frac{1}{2\\pi}\\cos(\\frac{2\\pi}{3})\\right) = \\left(\\frac{2}{3} - \\frac{-\\frac{1}{2}}{2\\pi}\\right) - \\left(\\frac{1}{3} - \\frac{-\\frac{1}{2}}{2\\pi}\\right) = \\frac{1}{3} $$\n$$ \\mu(A_3) = \\int_{2/3}^{1} p(x)\\,dx = F(1) - F(\\frac{2}{3}) = \\left(1 - \\frac{1}{2\\pi}\\cos(2\\pi)\\right) - \\left(\\frac{2}{3} - \\frac{1}{2\\pi}\\cos(\\frac{4\\pi}{3})\\right) = \\left(1 - \\frac{1}{2\\pi}\\right) - \\left(\\frac{2}{3} + \\frac{1}{4\\pi}\\right) = \\frac{1}{3} - \\frac{3}{4\\pi} $$\n支撑值 $c_i$ 定义为 $c_i = \\frac{\\int_{A_i} g(x)p(x)dx}{\\mu(A_i)}$。这需要计算分子 $N_i = \\int_{A_i} x^2(1+\\sin(2\\pi x))dx$。令不定积分为 $I(x) = \\int x^2(1+\\sin(2\\pi x))dx$。\n$I(x) = \\int x^2 dx + \\int x^2 \\sin(2\\pi x) dx$。第二个积分需要两次分部积分，得到：\n$$ \\int x^2 \\sin(ax) dx = \\left(\\frac{2}{a^3}-\\frac{x^2}{a}\\right)\\cos(ax) + \\frac{2x}{a^2}\\sin(ax) $$\n对于 $a=2\\pi$，这给出：\n$$ \\int x^2 \\sin(2\\pi x) dx = \\left(\\frac{1}{4\\pi^3}-\\frac{x^2}{2\\pi}\\right)\\cos(2\\pi x) + \\frac{x}{2\\pi^2}\\sin(2\\pi x) $$\n因此，$I(x) = \\frac{x^3}{3} + \\left(\\frac{1}{4\\pi^3}-\\frac{x^2}{2\\pi}\\right)\\cos(2\\pi x) + \\frac{x}{2\\pi^2}\\sin(2\\pi x)$。\n分子为 $N_i = I(b_i) - I(a_i)$，其中 $A_i = [a_i, b_i)$。\n$N_1 = I(\\frac{1}{3}) - I(0) = \\left(\\frac{1}{81} + \\frac{\\sqrt{3}}{12\\pi^2} + \\frac{1}{36\\pi} - \\frac{1}{8\\pi^3}\\right) - \\left(\\frac{1}{4\\pi^3}\\right) = \\frac{1}{81} + \\frac{\\sqrt{3}}{12\\pi^2} + \\frac{1}{36\\pi} - \\frac{3}{8\\pi^3}$。\n$N_2 = I(\\frac{2}{3}) - I(\\frac{1}{3}) = \\left(\\frac{8}{81} - \\frac{\\sqrt{3}}{6\\pi^2} + \\frac{1}{9\\pi} - \\frac{1}{8\\pi^3}\\right) - \\left(\\frac{1}{81} + \\frac{\\sqrt{3}}{12\\pi^2} + \\frac{1}{36\\pi} - \\frac{1}{8\\pi^3}\\right) = \\frac{7}{81} - \\frac{\\sqrt{3}}{4\\pi^2} + \\frac{1}{12\\pi}$。\n$N_3 = I(1) - I(\\frac{2}{3}) = \\left(\\frac{1}{3} - \\frac{1}{2\\pi} + \\frac{1}{4\\pi^3}\\right) - \\left(\\frac{8}{81} - \\frac{\\sqrt{3}}{6\\pi^2} + \\frac{1}{9\\pi} - \\frac{1}{8\\pi^3}\\right) = \\frac{19}{81} + \\frac{\\sqrt{3}}{6\\pi^2} - \\frac{11}{18\\pi} + \\frac{3}{8\\pi^3}$。\n支撑集为 $\\{c_1, c_2, c_3\\} = \\{N_1/\\mu(A_1), N_2/\\mu(A_2), N_3/\\mu(A_3)\\}$。\n\n第三，我们计算期望 $\\mathbb{E}[X]$。根据第一性原理，这个离散随机变量的期望是：\n$$ \\mathbb{E}[X] = \\sum_{i=1}^3 c_i P(X=c_i) = \\sum_{i=1}^3 c_i \\mu(A_i) $$\n代入 $c_i$ 的定义：\n$$ \\mathbb{E}[X] = \\sum_{i=1}^3 \\left( \\frac{\\int_{A_i} g(x)p(x)dx}{\\mu(A_i)} \\right) \\mu(A_i) = \\sum_{i=1}^3 \\int_{A_i} g(x)p(x)dx $$\n由于 $\\{A_1, A_2, A_3\\}$ 是 $\\Omega=[0,1]$ 的一个划分，积分之和等于在整个空间上的积分：\n$$ \\mathbb{E}[X] = \\int_{0}^1 g(x)p(x)dx = \\int_{0}^1 x^2(1+\\sin(2\\pi x))dx $$\n这个积分恰好是 $I(1) - I(0)$，也就是分子之和 $N_1+N_2+N_3$。我们可以直接计算这个定积分，或者将分子相加。将分子相加：\n$$ N_1+N_2+N_3 = \\left(\\frac{1}{81}+\\frac{7}{81}+\\frac{19}{81}\\right) + \\left(\\frac{\\sqrt{3}}{12\\pi^2}-\\frac{\\sqrt{3}}{4\\pi^2}+\\frac{\\sqrt{3}}{6\\pi^2}\\right) + \\left(\\frac{1}{36\\pi}+\\frac{1}{12\\pi}-\\frac{11}{18\\pi}\\right) + \\left(-\\frac{3}{8\\pi^3}+\\frac{3}{8\\pi^3}\\right) $$\n$$ = \\left(\\frac{27}{81}\\right) + \\left(\\frac{1-3+2}{12\\pi^2}\\right)\\sqrt{3} + \\left(\\frac{1+3-22}{36\\pi}\\right) + 0 $$\n$$ = \\frac{1}{3} + 0 + \\frac{-18}{36\\pi} = \\frac{1}{3} - \\frac{1}{2\\pi} $$\n或者，我们直接计算定积分 $\\int_0^1 x^2(1+\\sin(2\\pi x))dx = I(1)-I(0)$：\n$$ I(1) = \\frac{1}{3} + \\left(\\frac{1}{4\\pi^3}-\\frac{1}{2\\pi}\\right)\\cos(2\\pi) + \\frac{1}{2\\pi^2}\\sin(2\\pi) = \\frac{1}{3} - \\frac{1}{2\\pi} + \\frac{1}{4\\pi^3} $$\n$$ I(0) = 0 + \\left(\\frac{1}{4\\pi^3}-0\\right)\\cos(0) + 0 = \\frac{1}{4\\pi^3} $$\n$$ \\mathbb{E}[X] = I(1) - I(0) = \\left(\\frac{1}{3} - \\frac{1}{2\\pi} + \\frac{1}{4\\pi^3}\\right) - \\left(\\frac{1}{4\\pi^3}\\right) = \\frac{1}{3} - \\frac{1}{2\\pi} $$\n两种方法得到相同的结果。所求的值为 $\\mathbb{E}[X]$。",
            "answer": "$$\\boxed{\\frac{1}{3} - \\frac{1}{2\\pi}}$$"
        },
        {
            "introduction": "随机过程通常是无限维的复杂对象，为了分析和模拟它们，我们常常需要将其表示为更简单的形式。Karhunen-Loève (KL) 展开提供了一种最优的基展开方法，它将随机过程分解为一系列不相关的随机变量和一组确定的特征函数 。在这个实践中，你将从第一性原理出发，通过求解一个积分特征值问题，推导出一个重要高斯过程的KL展开，从而掌握表示和逼近随机过程的核心技术。",
            "id": "3799980",
            "problem": "考虑一个在 $[0,1]$ 上的零均值高斯过程 $X(t)$，其协方差核为 $K(s,t) = \\min(s,t) - st$。该核通过 $(\\mathcal{K}\\varphi)(t) = \\int_{0}^{1} K(s,t) \\varphi(s) \\,\\mathrm{d}s$ 在 $L^{2}([0,1])$ 上定义了一个紧、自伴、半正定的协方差算子 $\\mathcal{K}$。本问题要求您构建 $X(t)$ 的 Karhunen–Loève 展开（KLE），并用它来近似两个时间点上的有限维分布。\n\n任务：\n1. 从协方差算子的定义及其特征值问题 $\\int_{0}^{1} K(s,t)\\,\\varphi(s)\\,\\mathrm{d}s = \\lambda\\,\\varphi(t)$ 出发，推导出特征函数必须满足的相关微分方程和边界条件。求解 $\\mathcal{K}$ 的正交归一特征函数 $\\{\\varphi_{n}\\}_{n\\geq 1}$ 和特征值 $\\{\\lambda_{n}\\}_{n\\geq 1}$。\n2. 使用 Karhunen–Loève 展开式 $X(t) = \\sum_{n=1}^{\\infty} \\sqrt{\\lambda_{n}}\\,\\xi_{n}\\,\\varphi_{n}(t)$，其中 $\\{\\xi_{n}\\}_{n\\geq 1}$ 是独立的标准正态随机变量，定义 $N$ 项截断 $X_{N}(t) = \\sum_{n=1}^{N} \\sqrt{\\lambda_{n}}\\,\\xi_{n}\\,\\varphi_{n}(t)$，并对于任意的 $t_{1}, t_{2} \\in [0,1]$，用该截断展开式表示二元高斯向量 $(X_{N}(t_{1}), X_{N}(t_{2}))$ 的协方差矩阵。\n3. 特别地，取 $t_{1} = 1/3$ 和 $t_{2} = 2/3$，计算 $(X_{N}(1/3), X_{N}(2/3))$ 的相关系数 $\\rho_{N}$。确定精确极限 $\\lim_{N\\to\\infty} \\rho_{N}$，并将此极限值作为您的最终答案。最终答案需为精确值，无需四舍五入。\n\n您的推导必须基于高斯过程的核心定义、紧自伴算子的性质以及积分方程特征值问题的 Sturm–Liouville 框架。不要调用预先计算好的特征对或快捷公式；应在此背景下从第一性原理进行推导。",
            "solution": "将按要求分三部分依次解决此问题。\n\n第一部分：特征函数和特征值的推导。\n\n出发点是协方差算子 $\\mathcal{K}$ 的特征值问题：\n$$\n\\lambda \\varphi(t) = \\int_{0}^{1} K(s,t) \\varphi(s) \\,\\mathrm{d}s\n$$\n其中核函数由 $K(s,t) = \\min(s,t) - st$ 给出。我们将核函数代入积分方程：\n$$\n\\lambda \\varphi(t) = \\int_{0}^{1} (\\min(s,t) - st) \\varphi(s) \\,\\mathrm{d}s\n$$\n为了方便求导，我们在点 $s=t$ 处将积分分开，因为 $\\min(s,t)$ 的定义在此处发生变化。\n$$\n\\lambda \\varphi(t) = \\int_{0}^{t} (s - st) \\varphi(s) \\,\\mathrm{d}s + \\int_{t}^{1} (t - st) \\varphi(s) \\,\\mathrm{d}s\n$$\n我们可以将相对于积分变量 $s$ 的常数项提取出来：\n$$\n\\lambda \\varphi(t) = (1-t) \\int_{0}^{t} s \\varphi(s) \\,\\mathrm{d}s + t \\int_{t}^{1} (1-s) \\varphi(s) \\,\\mathrm{d}s\n$$\n这是一个关于特征函数 $\\varphi(t)$ 的积分方程。为了将其转换为微分方程，我们使用乘法法则和微积分基本定理（通过莱布尼茨积分法则）对 $t$ 求导。对该方程求导一次得到：\n$$\n\\lambda \\varphi'(t) = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\left[ (1-t) \\int_{0}^{t} s \\varphi(s) \\,\\mathrm{d}s \\right] + \\frac{\\mathrm{d}}{\\mathrm{d}t} \\left[ t \\int_{t}^{1} (1-s) \\varphi(s) \\,\\mathrm{d}s \\right]\n$$\n$$\n\\lambda \\varphi'(t) = (-1) \\int_{0}^{t} s \\varphi(s) \\,\\mathrm{d}s + (1-t) (t \\varphi(t)) + (1) \\int_{t}^{1} (1-s) \\varphi(s) \\,\\mathrm{d}s + t (-(1-t)\\varphi(t))\n$$\n包含 $(1-t)t\\varphi(t)$ 的项相互抵消，表达式简化为：\n$$\n\\lambda \\varphi'(t) = \\int_{t}^{1} (1-s) \\varphi(s) \\,\\mathrm{d}s - \\int_{0}^{t} s \\varphi(s) \\,\\mathrm{d}s\n$$\n对 $t$ 进行二次求导：\n$$\n\\lambda \\varphi''(t) = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\left[ \\int_{t}^{1} (1-s) \\varphi(s) \\,\\mathrm{d}s \\right] - \\frac{\\mathrm{d}}{\\mathrm{d}t} \\left[ \\int_{0}^{t} s \\varphi(s) \\,\\mathrm{d}s \\right]\n$$\n$$\n\\lambda \\varphi''(t) = (-(1-t)\\varphi(t)) - (t\\varphi(t)) = - \\varphi(t) + t\\varphi(t) - t\\varphi(t) = -\\varphi(t)\n$$\n这给出了二阶常微分方程：\n$$\n\\varphi''(t) + \\frac{1}{\\lambda} \\varphi(t) = 0\n$$\n接下来，我们从积分方程形式推导边界条件。在 $t=0$ 处：\n$$\n\\lambda \\varphi(0) = (1-0) \\int_{0}^{0} s \\varphi(s) \\,\\mathrm{d}s + 0 \\cdot \\int_{0}^{1} (1-s) \\varphi(s) \\,\\mathrm{d}s = 0\n$$\n由于对于非平凡解，特征值 $\\lambda$ 必须为正（因为核是半正定且不恒为零的），我们必须有 $\\varphi(0) = 0$。\n在 $t=1$ 处：\n$$\n\\lambda \\varphi(1) = (1-1) \\int_{0}^{1} s \\varphi(s) \\,\\mathrm{d}s + 1 \\cdot \\int_{1}^{1} (1-s) \\varphi(s) \\,\\mathrm{d}s = 0\n$$\n这意味着 $\\varphi(1) = 0$。\n\n我们现在求解边值问题 (BVP)：\n$$\n\\varphi''(t) + k^2 \\varphi(t) = 0, \\quad \\text{其中 } \\varphi(0)=0, \\varphi(1)=0, \\quad \\text{且 } k^2 = \\frac{1}{\\lambda}\n$$\n该常微分方程的通解是 $\\varphi(t) = A \\cos(kt) + B \\sin(kt)$。\n应用第一个边界条件 $\\varphi(0)=0$：\n$$\nA \\cos(0) + B \\sin(0) = A = 0\n$$\n解简化为 $\\varphi(t) = B \\sin(kt)$。\n应用第二个边界条件 $\\varphi(1)=0$：\n$$\nB \\sin(k) = 0\n$$\n为了得到非平凡解，我们需要 $B \\neq 0$，这意味着 $\\sin(k)=0$。解为 $k_n = n\\pi$，其中 $n$ 为任意非零整数。我们取正整数 $n \\geq 1$，因为负整数会产生线性相关的特征函数。\n因此，特征值为：\n$$\n\\lambda_n = \\frac{1}{k_n^2} = \\frac{1}{(n\\pi)^2}, \\quad n=1, 2, 3, \\ldots\n$$\n相应的特征函数形式为 $\\varphi_n(t) = B_n \\sin(n\\pi t)$。\n为了完成规范化，我们必须将特征函数归一化，使其成为 $L^2([0,1])$ 中的一组标准正交基。\n$$\n\\int_{0}^{1} \\varphi_n(t)^2 \\,\\mathrm{d}t = 1 \\implies \\int_{0}^{1} B_n^2 \\sin^2(n\\pi t) \\,\\mathrm{d}t = 1\n$$\n$$\nB_n^2 \\int_{0}^{1} \\frac{1-\\cos(2n\\pi t)}{2} \\,\\mathrm{d}t = B_n^2 \\left[ \\frac{t}{2} - \\frac{\\sin(2n\\pi t)}{4n\\pi} \\right]_0^1 = B_n^2 \\left(\\frac{1}{2} - 0 \\right) = \\frac{B_n^2}{2} = 1\n$$\n这得到 $B_n^2=2$，所以我们取正根 $B_n = \\sqrt{2}$。\n标准正交特征函数和特征值为：\n$$\n\\varphi_n(t) = \\sqrt{2} \\sin(n\\pi t) \\quad \\text{和} \\quad \\lambda_n = \\frac{1}{(n\\pi)^2} \\quad \\text{对于 } n \\geq 1\n$$\n\n第二部分：截断过程的协方差矩阵。\n\nKarhunen-Loève 展开的 $N$ 项截断为 $X_N(t) = \\sum_{n=1}^{N} \\sqrt{\\lambda_n} \\xi_n \\varphi_n(t)$，其中 $\\xi_n$ 是独立同分布的标准正态随机变量（$\\xi_n \\sim \\mathcal{N}(0,1)$）。由于 $\\mathbb{E}[\\xi_n]=0$，截断过程也是零均值的：$\\mathbb{E}[X_N(t)]=0$。\n截断过程的协方差函数 $K_N(t_1, t_2)$ 由下式给出：\n$$\nK_N(t_1, t_2) = \\mathbb{E}[X_N(t_1) X_N(t_2)] = \\mathbb{E}\\left[ \\left(\\sum_{n=1}^{N} \\sqrt{\\lambda_n}\\xi_n\\varphi_n(t_1)\\right) \\left(\\sum_{m=1}^{N} \\sqrt{\\lambda_m}\\xi_m\\varphi_m(t_2)\\right) \\right]\n$$\n$$\n= \\sum_{n=1}^{N} \\sum_{m=1}^{N} \\sqrt{\\lambda_n \\lambda_m} \\varphi_n(t_1) \\varphi_m(t_2) \\mathbb{E}[\\xi_n \\xi_m]\n$$\n由于 $\\xi_n$ 的独立性和标准方差，利用性质 $\\mathbb{E}[\\xi_n \\xi_m] = \\delta_{nm}$（克罗内克 δ）：\n$$\nK_N(t_1, t_2) = \\sum_{n=1}^{N} \\sum_{m=1}^{N} \\sqrt{\\lambda_n \\lambda_m} \\varphi_n(t_1) \\varphi_m(t_2) \\delta_{nm} = \\sum_{n=1}^{N} \\lambda_n \\varphi_n(t_1) \\varphi_n(t_2)\n$$\n二元向量 $(X_N(t_1), X_N(t_2))$ 是零均值的高斯向量。其协方差矩阵 $\\Sigma_N(t_1, t_2)$ 是一个 $2 \\times 2$ 矩阵，其元素由协方差函数 $K_N$ 给出：\n$$\n\\Sigma_N(t_1, t_2) = \\begin{pmatrix} \\mathbb{E}[X_N(t_1)^2] & \\mathbb{E}[X_N(t_1) X_N(t_2)] \\\\ \\mathbb{E}[X_N(t_2) X_N(t_1)] & \\mathbb{E}[X_N(t_2)^2] \\end{pmatrix} = \\begin{pmatrix} K_N(t_1, t_1) & K_N(t_1, t_2) \\\\ K_N(t_2, t_1) & K_N(t_2, t_2) \\end{pmatrix}\n$$\n代入 $K_N$ 的表达式，我们得到用截断展开式表示的协方差矩阵：\n$$\n\\Sigma_N(t_1, t_2) = \\begin{pmatrix} \\sum_{n=1}^{N} \\lambda_n \\varphi_n(t_1)^2 & \\sum_{n=1}^{N} \\lambda_n \\varphi_n(t_1)\\varphi_n(t_2) \\\\ \\sum_{n=1}^{N} \\lambda_n \\varphi_n(t_1)\\varphi_n(t_2) & \\sum_{n=1}^{N} \\lambda_n \\varphi_n(t_2)^2 \\end{pmatrix}\n$$\n\n第三部分：相关系数及其极限。\n\n向量 $(X_N(t_1), X_N(t_2))$ 的相关系数 $\\rho_N(t_1, t_2)$ 定义为：\n$$\n\\rho_N(t_1, t_2) = \\frac{\\mathrm{Cov}(X_N(t_1), X_N(t_2))}{\\sqrt{\\mathrm{Var}(X_N(t_1)) \\mathrm{Var}(X_N(t_2))}} = \\frac{K_N(t_1, t_2)}{\\sqrt{K_N(t_1, t_1) K_N(t_2, t_2)}}\n$$\n我们被要求计算当 $N \\to \\infty$ 时，对于 $t_1 = 1/3$ 和 $t_2 = 2/3$ 的 $\\rho_N$ 的极限。\n根据 Mercer 定理，对于一个连续、对称、半正定的核 $K(s,t)$，其关于特征函数和特征值的级数展开绝对且一致地收敛于核本身：\n$$\n\\lim_{N\\to\\infty} K_N(s,t) = \\lim_{N\\to\\infty} \\sum_{n=1}^{N} \\lambda_n \\varphi_n(s) \\varphi_n(t) = \\sum_{n=1}^{\\infty} \\lambda_n \\varphi_n(s) \\varphi_n(t) = K(s,t)\n$$\n只要方差不为零，相关系数就是协方差矩阵元素的连续函数。由于对于 $t \\in (0,1)$，有 $K_N(t,t) \\to K(t,t) = t-t^2 > 0$，我们可以交换极限和函数：\n$$\n\\rho_\\infty = \\lim_{N\\to\\infty} \\rho_N(t_1, t_2) = \\frac{\\lim_{N\\to\\infty} K_N(t_1, t_2)}{\\sqrt{(\\lim_{N\\to\\infty} K_N(t_1, t_1)) (\\lim_{N\\to\\infty} K_N(t_2, t_2))}} = \\frac{K(t_1, t_2)}{\\sqrt{K(t_1, t_1) K(t_2, t_2)}}\n$$\n因此，截断过程的相关系数的极限就是原始过程 $X(t)$ 的相关系数。我们现在使用给定的核 $K(s,t) = \\min(s,t) - st$ 计算 $t_1 = 1/3$ 和 $t_2 = 2/3$ 时的这个值。\n\n协方差：\n$$\nK(1/3, 2/3) = \\min(1/3, 2/3) - (1/3)(2/3) = \\frac{1}{3} - \\frac{2}{9} = \\frac{3}{9} - \\frac{2}{9} = \\frac{1}{9}\n$$\n$t_1=1/3$ 处的方差：\n$$\nK(1/3, 1/3) = \\min(1/3, 1/3) - (1/3)(1/3) = \\frac{1}{3} - \\frac{1}{9} = \\frac{3}{9} - \\frac{1}{9} = \\frac{2}{9}\n$$\n$t_2=2/3$ 处的方差：\n$$\nK(2/3, 2/3) = \\min(2/3, 2/3) - (2/3)(2/3) = \\frac{2}{3} - \\frac{4}{9} = \\frac{6}{9} - \\frac{4}{9} = \\frac{2}{9}\n$$\n现在，我们计算相关系数的极限：\n$$\n\\rho_\\infty = \\frac{K(1/3, 2/3)}{\\sqrt{K(1/3, 1/3) K(2/3, 2/3)}} = \\frac{1/9}{\\sqrt{(2/9)(2/9)}} = \\frac{1/9}{2/9} = \\frac{1}{2}\n$$\n当 $N\\to\\infty$ 时，相关系数的精确极限是 $1/2$。",
            "answer": "$$\n\\boxed{\\frac{1}{2}}\n$$"
        },
        {
            "introduction": "许多跨尺度的物理和生物系统可以用连续时间马尔可夫链 (CTMC) 来建模，而模拟其动态演化是理解这些系统的关键。本练习要求你通过编程，利用矩阵指数精确求解描述CTMC概率演化的Kolmogorov前向方程 。更重要的是，你将通过分析生成元矩阵的谱来量化系统中的“刚度”，这是一种当系统包含多个数量级差异的时间尺度时出现的典型计算挑战，也是多尺度分析中的一个核心问题。",
            "id": "3799981",
            "problem": "考虑一个具有有限状态空间和生成元矩阵 $Q$ 的连续时间马尔可夫链 (CTMC)。生成元矩阵 $Q$ 满足以下性质：对于所有 $i \\neq j$ 的状态 $i$ 和 $j$，非对角线元素满足 $Q_{ij} \\geq 0$，且每行之和为零，即 $\\sum_{j} Q_{ij} = 0$。令 $p(t)$ 表示在时间 $t$ 的瞬态状态概率的行向量，$p(0)$ 表示初始分布。CTMC 的 Kolmogorov 前向方程是一个线性常微分方程 $\\frac{d}{dt} p(t) = p(t) Q$，其初始条件为 $p(0)$。\n\n您的任务是编写一个程序，为每个提供的测试用例，通过使用矩阵指数例程（不要对时间进行离散化）精确求解 Kolmogorov 前向方程来计算瞬态概率，然后通过谱指标分析由多尺度速率分离引起的刚性。具体来说：\n\n- 对于每个测试用例，通过将矩阵指数例程应用于 $Q$ 和 $t$，从 $p(0)$ 和 $Q$ 精确计算 $p(t)$。\n- 通过计算 $Q$ 的特征值，取其实部，排除零值，并将刚性指标 $\\sigma$ 定义为最大与最小非零实部绝对值之比，来分析由尺度分离引起的刚性。如果 $\\sigma > \\theta$（其中 $\\theta$ 是一个指定的阈值），则系统被分类为刚性系统。\n- 将 $p(t)$ 的每个分量和 $\\sigma$ 四舍五入到 $6$ 位小数。\n\n需要使用的基本依据和定义：\n- 生成元矩阵 $Q$ 满足，对于 $i \\neq j$，$Q_{ij} \\geq 0$；对于每一行 $i$，$\\sum_{j} Q_{ij} = 0$。\n- Kolmogorov 前向方程为 $\\frac{d}{dt} p(t) = p(t) Q$，其中 $p(0)$ 是状态上的一个概率分布。\n- 矩阵指数 $\\exp(Q t)$ 是求解线性系统 $\\frac{d}{dt} X(t) = X(t) Q$ 且满足 $X(0) = I$（其中 $I$ 是单位矩阵）的唯一函数。\n\n测试套件：\n使用以下三个测试用例。矩阵和向量按所写状态排序。所有数字都应解释为无量纲的速率或概率。\n\n- 测试用例 1（标准情形，4 个状态，簇内速率快，簇间速率慢）：\n  - 生成元矩阵 $Q_1$：\n    $$\n    Q_1 =\n    \\begin{bmatrix}\n    -200.05 & 200 & 0.05 & 0 \\\\\n    200 & -200.1 & 0.1 & 0 \\\\\n    0 & 0.1 & -150.1 & 150 \\\\\n    0.05 & 0 & 150 & -150.05\n    \\end{bmatrix}\n    $$\n  - 初始分布 $p_1(0) = [1, 0, 0, 0]$。\n  - 时间 $t_1 = 0.05$。\n  - 刚性阈值 $\\theta = 10^3$。\n\n- 测试用例 2（边界情况，$t = 0$，包含一个吸收态）：\n  - 生成元矩阵 $Q_2$：\n    $$\n    Q_2 =\n    \\begin{bmatrix}\n    -5 & 5 & 0 \\\\\n    5 & -5 & 0 \\\\\n    0 & 0 & 0\n    \\end{bmatrix}\n    $$\n  - 初始分布 $p_2(0) = \\left[\\frac{1}{3}, \\frac{1}{3}, \\frac{1}{3}\\right]$。\n  - 时间 $t_2 = 0$。\n  - 刚性阈值 $\\theta = 10^3$。\n\n- 测试用例 3（边缘情况，5 个状态，具有近可分簇的极端多尺度速率）：\n  - 生成元矩阵 $Q_3$：\n    $$\n    Q_3 =\n    \\begin{bmatrix}\n    -2000.001 & 1000 & 1000 & 0.001 & 0 \\\\\n    1000 & -2000.001 & 1000 & 0 & 0.001 \\\\\n    1000 & 1000 & -2000.001 & 0.001 & 0 \\\\\n    0.001 & 0 & 0 & -10.001 & 10 \\\\\n    0 & 0.001 & 0 & 10 & -10.001\n    \\end{bmatrix}\n    $$\n  - 初始分布 $p_3(0) = [0, 1, 0, 0, 0]$。\n  - 时间 $t_3 = 0.001$。\n  - 刚性阈值 $\\theta = 10^3$。\n\n每个测试用例的所需输出：\n- 通过使用矩阵指数例程精确求解 Kolmogorov 前向方程来计算 $p(t)$。\n- 计算刚性指标 $\\sigma$，即 $Q$ 的特征值中最大与最小非零实部绝对值之比。\n- 确定布尔刚性分类 $b$ 为 $b = (\\sigma > \\theta)$。\n\n数值处理要求：\n- 将 $p(t)$ 的每个分量四舍五入到 6 位小数。\n- 将 $\\sigma$ 四舍五入到 6 位小数。\n- 通过将负值裁剪为 0（以处理数值舍入误差）并重新归一化使其总和为 1，来确保 $p(t)$ 是一个有效的概率向量。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。每个测试用例的结果本身必须是一个列表，按顺序包含 $p(t)$ 的四舍五入分量，后跟四舍五入的 $\\sigma$，再后跟布尔刚性分类。例如，输出必须如下所示：\n$$\n\\text{[ [p_{1,0}, p_{1,1}, \\dots, \\sigma_1, b_1], [p_{2,0}, p_{2,1}, \\dots, \\sigma_2, b_2], [p_{3,0}, p_{3,1}, \\dots, \\sigma_3, b_3] ]}\n$$\n其中每个 $p_{k,i}$ 是一个四舍五入到 6 位小数的浮点数，每个 $\\sigma_k$ 是一个四舍五入到 6 位小数的浮点数，每个 $b_k$ 是一个布尔值。只应打印这一行。",
            "solution": "该问题要求计算连续时间马尔可夫链 (CTMC) 的瞬态概率并分析其刚性。对于每个测试用例，解决方案分两个主要部分进行：求解 Kolmogorov 前向方程和计算谱刚性指标。\n\n具有有限状态空间的 CTMC 由一个生成元矩阵 $Q$ 表征。对于 $i \\neq j$，元素 $Q_{ij}$ 表示从状态 $i$ 到状态 $j$ 的转移速率，且必须为非负值，$Q_{ij} \\geq 0$。对角线元素由每行之和为零的条件定义，即 $\\sum_{j} Q_{ij} = 0$，这意味着 $Q_{ii} = -\\sum_{j \\neq i} Q_{ij}$。状态概率 $p(t)$（表示为行向量）的演化由 Kolmogorov 前向方程控制，这是一个线性常微分方程 (ODE) 系统：\n$$\n\\frac{d}{dt} p(t) = p(t) Q\n$$\n并给定一个初始概率分布 $p(0)$。\n\n这个具有常系数的线性 ODE 系统的形式解由矩阵指数给出：\n$$\np(t) = p(0) \\exp(Qt)\n$$\n其中 $\\exp(A)$ 表示方阵 $A$ 的矩阵指数，由泰勒级数 $\\exp(A) = \\sum_{k=0}^{\\infty} \\frac{A^k}{k!}$ 定义。这提供了一个精确的解析解，可以使用诸如 Padé 近似的算法进行高精度数值计算。这种方法避免了对更复杂的非线性 ODE 通常需要的时间步进方案的需求。\n\n问题的第二部分是分析系统的刚性。ODE 系统中的刚性问题源于其动力学中存在广泛的时间尺度分离。对于 CTMC，这些时间尺度与生成元矩阵 $Q$ 的特征值有关。任何生成元矩阵 $Q$ 的特征值 $\\lambda_i$ 都具有非正实部，即 $\\operatorname{Re}(\\lambda_i) \\leq 0$。至少有一个特征值总是 0，对应于链的稳态分布。非零特征值决定了瞬态动力学。每个非零特征值 $\\lambda_i$ 对应一个特征时间尺度 $\\tau_i = -1 / \\operatorname{Re}(\\lambda_i)$。\n\n刚性是由最快和最慢时间尺度之间的巨大差异引起的。最快的瞬态过程对应于具有最大幅度实部的特征值，$\\tau_{fast} = -1 / \\max(|\\operatorname{Re}(\\lambda_i)|)$。最慢的瞬态过程对应于具有最小幅度非零实部的特征值，$\\tau_{slow} = -1 / \\min(|\\operatorname{Re}(\\lambda_i)| \\text{ for } \\operatorname{Re}(\\lambda_i) \\neq 0)$。\n\n刚性指标 $\\sigma$ 定义为最慢与最快时间尺度之比：\n$$\n\\sigma = \\frac{\\tau_{slow}}{\\tau_{fast}} = \\frac{\\max(|\\operatorname{Re}(\\lambda_i)| \\text{ where } \\operatorname{Re}(\\lambda_i) \\neq 0)}{\\min(|\\operatorname{Re}(\\lambda_i)| \\text{ where } \\operatorname{Re}(\\lambda_i) \\neq 0)}\n$$\n$\\sigma$ 值较大表示存在显著的尺度分离，因此刚性很高。问题指定了一个阈值 $\\theta$，如果 $\\sigma > \\theta$，则将系统分类为刚性系统。\n\n每个测试用例的计算流程如下：\n1. 给定生成元矩阵 $Q$、初始分布 $p(0)$、时间 $t$ 和刚性阈值 $\\theta$。\n2. 计算矩阵乘积 $Qt$。\n3. 使用数值库函数计算矩阵指数 $P(t) = \\exp(Qt)$。\n4. 计算瞬态概率向量 $p(t) = p(0) P(t)$。\n5. 对计算出的 $p(t)$ 进行数值修正：将任何小于 0 的值裁剪为 0，并重新归一化向量，使其分量之和为 1。这可以修正微小的浮点数不精确问题。\n6. 按照输出要求，将所得 $p(t)$ 向量的每个分量四舍五入到 6 位小数。\n7. 计算矩阵 $Q$ 的特征值。\n8. 提取特征值的实部。滤除数值上接近于零的值（例如，绝对值小于像 $10^{-9}$ 这样的小容差的值）。\n9. 从非零实部集合中，找到其绝对值的最大值和最小值。\n10. 计算刚性指标 $\\sigma$ 作为它们的比率。如果只有一个唯一的非零实部，则 $\\sigma = 1$。\n11. 将 $\\sigma$ 四舍五入到 6 位小数。\n12. 确定布尔刚性分类 $b = (\\sigma > \\theta)$。\n13. 将该测试用例的最终结果组合成一个列表，其中包含四舍五入的 $p(t)$ 的分量、四舍五入的 $\\sigma$ 和布尔值 $b$。\n\n此流程将应用于提供的三个测试用例中的每一个。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Solves for transient probabilities of CTMCs and analyzes stiffness for given test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"Q\": np.array([\n                [-200.05, 200, 0.05, 0],\n                [200, -200.1, 0.1, 0],\n                [0, 0.1, -150.1, 150],\n                [0.05, 0, 150, -150.05]\n            ]),\n            \"p0\": np.array([1.0, 0.0, 0.0, 0.0]),\n            \"t\": 0.05,\n            \"theta\": 1000.0\n        },\n        {\n            \"Q\": np.array([\n                [-5, 5, 0],\n                [5, -5, 0],\n                [0, 0, 0]\n            ]),\n            \"p0\": np.array([1/3, 1/3, 1/3]),\n            \"t\": 0.0,\n            \"theta\": 1000.0\n        },\n        {\n            \"Q\": np.array([\n                [-2000.001, 1000, 1000, 0.001, 0],\n                [1000, -2000.001, 1000, 0, 0.001],\n                [1000, 1000, -2000.001, 0.001, 0],\n                [0.001, 0, 0, -10.001, 10],\n                [0, 0.001, 0, 10, -10.001]\n            ]),\n            \"p0\": np.array([0.0, 1.0, 0.0, 0.0, 0.0]),\n            \"t\": 0.001,\n            \"theta\": 1000.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        Q = case[\"Q\"]\n        p0 = case[\"p0\"]\n        t = case[\"t\"]\n        theta = case[\"theta\"]\n\n        # Part 1: Compute transient probabilities p(t)\n        # The solution to dp/dt = p(t)Q is p(t) = p(0)exp(Qt)\n        if t == 0:\n            p_t = p0\n        else:\n            P_t = expm(Q * t)\n            p_t = p0 @ P_t\n\n        # Numerical handling: clip negative values and renormalize\n        p_t = np.clip(p_t, 0, None)\n        p_t_sum = np.sum(p_t)\n        if p_t_sum > 0:\n            p_t = p_t / p_t_sum\n        \n        # Round the components of p(t) to 6 decimal places\n        p_t_rounded = [round(x, 6) for x in p_t.tolist()]\n        \n        # Part 2: Analyze stiffness via spectral indicator sigma\n        eigenvalues = np.linalg.eigvals(Q)\n        \n        # Get real parts of eigenvalues, filtering out numerical zeros\n        real_parts = np.real(eigenvalues)\n        nonzero_real_parts = real_parts[np.abs(real_parts) > 1e-9]\n        \n        if len(nonzero_real_parts) == 0:\n            # If all eigenvalues are zero (e.g., for a zero matrix), system is not stiff\n            sigma = 1.0\n        else:\n            abs_nonzero_real_parts = np.abs(nonzero_real_parts)\n            max_abs_real = np.max(abs_nonzero_real_parts)\n            min_abs_real = np.min(abs_nonzero_real_parts)\n            sigma = max_abs_real / min_abs_real\n            \n        # Round sigma to 6 decimal places\n        sigma_rounded = round(sigma, 6)\n\n        # Classify stiffness\n        is_stiff = sigma > theta\n\n        # Assemble the result for this case\n        case_result = p_t_rounded + [sigma_rounded, is_stiff]\n        results.append(case_result)\n\n    # Final print statement in the exact required format\n    # Using str() on a list of lists produces the desired format with spaces\n    print(str(results).replace(\"'\", \"\").replace(\"True\", \"True\").replace(\"False\", \"False\"))\n\nsolve()\n```"
        }
    ]
}