{
    "hands_on_practices": [
        {
            "introduction": "任何分子模拟都必须首先为粒子赋予与系统温度一致的速度。对于复杂的非球形分子，这涉及到初始化平动和转动两种运动。此实践将初始化过程置于基础统计力学，特别是正则系综和能量均分定理的框架之下。通过从第一性原理推导平动和转动速度的正确联合概率分布，您将为刚体生成物理上真实的初始条件开发一个稳健而高效的算法。",
            "id": "3769280",
            "problem": "你的任务是推导、实现并验证一种算法，用于初始化处于热平衡状态的刚性分子的平移和旋转速度。目标是针对具有旋转自由度的刚体，从正则系综中推导出的联合 Maxwell–Boltzmann 分布，该分布用惯性张量表示。该初始化必须适用于多尺度建模与分析，其中平移和旋转动力学发生在不同的特征尺度上。\n\n仅从基本原理出发，使用正则系综和刚体动能表达式来推导速度的联合概率密度函数 (PDF)。正则系综指出，平衡密度与哈密顿量乘以负的热能倒数的指数成正比，并且刚体动能可加性地分解为平移和旋转两部分。具体来说，使用以下基本依据：\n- 平动的牛顿动能：$T_{\\mathrm{trans}} = \\tfrac{1}{2} m \\,\\mathbf{v}^{\\mathsf{T}} \\mathbf{v}$，其中 $m$ 是质量，$\\mathbf{v}$ 是平移速度。\n- 刚体转动动能：$T_{\\mathrm{rot}} = \\tfrac{1}{2} \\boldsymbol{\\omega}^{\\mathsf{T}} \\mathbf{I}_{\\mathrm{lab}} \\,\\boldsymbol{\\omega}$，其中 $\\boldsymbol{\\omega}$ 是角速度，$\\mathbf{I}_{\\mathrm{lab}}$ 是在实验室坐标系中表示的惯性张量。\n- 正则系综密度：$p(\\mathbf{v}, \\boldsymbol{\\omega} \\mid \\mathbf{Q}) \\propto \\exp\\!\\big(-\\beta \\, [T_{\\mathrm{trans}} + T_{\\mathrm{rot}}]\\big)$，其中 $\\beta = (k_{\\mathrm{B}} T)^{-1}$，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是绝对温度，$\\mathbf{Q} \\in \\mathrm{SO}(3)$ 是将物体坐标系映射到实验室坐标系的方向旋转矩阵。\n- 实验室坐标系中的惯性张量通过 $\\mathbf{I}_{\\mathrm{lab}} = \\mathbf{Q}\\,\\mathbf{I}_{\\mathrm{body}}\\,\\mathbf{Q}^{\\mathsf{T}}$ 与物体坐标系中的惯性张量相关，且 $\\mathbf{I}_{\\mathrm{body}}$ 是对称正定的。\n\n基于这些依据，推导出联合分布可分解为关于 $\\mathbf{v}$ 和 $\\boldsymbol{\\omega}$ 的独立高斯分布，其协方差由 $m$、$T$ 和 $\\mathbf{I}_{\\mathrm{lab}}$ 决定。展示如何利用物体坐标系惯性张量和当前方向，高效地从旋转分布中进行抽样。\n\n抽样要求和单位：\n- 平移速度 $\\mathbf{v}$ 必须以 $\\mathrm{m/s}$ 为单位进行抽样。\n- 角速度 $\\boldsymbol{\\omega}$ 必须以 $\\mathrm{rad/s}$ 为单位进行抽样。\n- 位置（如果创建）应在立方体盒子中均匀抽样，坐标单位为 $\\mathrm{m}$，但位置不属于此任务的验证标准。\n\n算法实现要求：\n- 在给定 $m$、$T$、$\\mathbf{I}_{\\mathrm{body}}$ 和 $\\mathbf{Q}$ 的情况下，根据推导出的联合麦克斯韦分布对 $\\mathbf{v}$ 和 $\\boldsymbol{\\omega}$ 进行抽样。为保证可复现性，请使用固定的随机种子。\n- 对于旋转抽样，请证明从 $\\boldsymbol{\\omega}_{\\mathrm{body}} \\sim \\mathcal{N}(\\mathbf{0},\\; k_{\\mathrm{B}} T\\, \\mathbf{I}_{\\mathrm{body}}^{-1})$ 抽样并通过 $\\boldsymbol{\\omega}_{\\mathrm{lab}} = \\mathbf{Q}\\,\\boldsymbol{\\omega}_{\\mathrm{body}}$ 映射到实验室坐标系的合理性。\n\n验证标准：\n- 对于每个测试案例，抽取 $N$ 个独立样本，并计算 $\\mathbf{v}$ 和 $\\boldsymbol{\\omega}_{\\mathrm{lab}}$ 的经验协方差矩阵。\n- 将经验协方差与理论协方差进行比较：\n  - $\\operatorname{Cov}(\\mathbf{v}) = \\dfrac{k_{\\mathrm{B}} T}{m}\\,\\mathbf{I}_3$，其中 $\\mathbf{I}_3$ 是 $3 \\times 3$ 单位矩阵。\n  - $\\operatorname{Cov}(\\boldsymbol{\\omega}_{\\mathrm{lab}}) = k_{\\mathrm{B}} T\\; \\mathbf{I}_{\\mathrm{lab}}^{-1} = k_{\\mathrm{B}} T \\; \\big(\\mathbf{Q}\\,\\mathbf{I}_{\\mathrm{body}}\\,\\mathbf{Q}^{\\mathsf{T}}\\big)^{-1}$。\n- 使用相对 Frobenius 范数误差度量 $\\varepsilon = \\dfrac{\\lVert \\widehat{\\Sigma} - \\Sigma \\rVert_{\\mathrm{F}}}{\\lVert \\Sigma \\rVert_{\\mathrm{F}}}$，如果 $\\varepsilon  0.03$，则宣布匹配。\n- 通过计算 $\\mathbf{v}$ 的任意分量与 $\\boldsymbol{\\omega}_{\\mathrm{lab}}$ 的任意分量之间的最大绝对样本相关性来验证平移速度和旋转速度的经验独立性，如果最大值小于 $0.03$，则宣布独立。\n\n测试套件：\n使用玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$。对于所有案例，使用 $N = 100000$ 个样本和固定的种子。提供四个涵盖不同情况的测试案例：\n- 案例 1（一般各向异性，非平凡方向）：\n  - $m = 4.0 \\times 10^{-15}\\,\\mathrm{kg}$,\n  - $\\mathbf{I}_{\\mathrm{body}} = \\mathrm{diag}(1.6 \\times 10^{-27},\\, 1.0 \\times 10^{-27},\\, 0.5 \\times 10^{-27})\\,\\mathrm{kg\\,m^2}$,\n  - $\\mathbf{Q}$ 来自欧拉角 $(\\alpha,\\beta,\\gamma) = (0.3,\\,-0.5,\\,1.0)$ （弧度），\n  - $T = 300.0\\,\\mathrm{K}$。\n- 案例 2（球形陀螺，单位方向）：\n  - $m = 4.0 \\times 10^{-15}\\,\\mathrm{kg}$,\n  - $\\mathbf{I}_{\\mathrm{body}} = \\mathrm{diag}(1.0 \\times 10^{-27},\\, 1.0 \\times 10^{-27},\\, 1.0 \\times 10^{-27})\\,\\mathrm{kg\\,m^2}$,\n  - $\\mathbf{Q} = \\mathbf{I}_3$,\n  - $T = 300.0\\,\\mathrm{K}$。\n- 案例 3（对称陀螺，已旋转）：\n  - $m = 4.0 \\times 10^{-15}\\,\\mathrm{kg}$,\n  - $\\mathbf{I}_{\\mathrm{body}} = \\mathrm{diag}(1.0 \\times 10^{-27},\\, 1.0 \\times 10^{-27},\\, 2.0 \\times 10^{-27})\\,\\mathrm{kg\\,m^2}$,\n  - $\\mathbf{Q}$ 来自欧拉角 $(\\alpha,\\beta,\\gamma) = (0.2,\\,0.4,\\,-0.6)$ （弧度），\n  - $T = 300.0\\,\\mathrm{K}$。\n- 案例 4（极端各向异性，已旋转）：\n  - $m = 4.0 \\times 10^{-15}\\,\\mathrm{kg}$,\n  - $\\mathbf{I}_{\\mathrm{body}} = \\mathrm{diag}(1.0 \\times 10^{-28},\\, 2.0 \\times 10^{-27},\\, 5.0 \\times 10^{-27})\\,\\mathrm{kg\\,m^2}$,\n  - $\\mathbf{Q}$ 来自欧拉角 $(\\alpha,\\beta,\\gamma) = (-0.1,\\,0.7,\\,0.5)$ （弧度），\n  - $T = 300.0\\,\\mathrm{K}$。\n\n程序输出规范：\n- 对每个案例，计算三个布尔值：$(b_{\\mathrm{trans}},\\, b_{\\mathrm{rot}},\\, b_{\\mathrm{indep}})$，其中 $b_{\\mathrm{trans}}$ 验证平移协方差，$b_{\\mathrm{rot}}$ 验证旋转协方差，$b_{\\mathrm{indep}}$ 验证独立性。\n- 你的程序应生成单行输出，包含 12 个布尔值，按案例 1 到 4 的顺序排列，每个案例按 $(b_{\\mathrm{trans}},\\, b_{\\mathrm{rot}},\\, b_{\\mathrm{indep}})$ 的顺序贡献其三个布尔值，形式为用方括号括起来的逗号分隔列表（例如，$[\\text{True},\\text{False},\\dots]$）。",
            "solution": "该问题要求推导并实现一种算法，用于在给定温度下，从正则系综对应的 Maxwell-Boltzmann 分布中抽样刚性分子的平移和旋转速度。解决方案将首先从基本原理推导目标概率分布，然后开发一种高效的抽样算法，最后描述验证过程。\n\n### 联合速度分布的推导\n\n该问题设定在经典统计力学的框架内，具体来说是正则系综。在正则系综中，系统状态的概率密度函数 $p$ 与玻尔兹曼因子成正比，$p \\propto \\exp(-\\beta H)$，其中 $H$ 是系统的哈密顿量，$\\beta = (k_{\\mathrm{B}} T)^{-1}$。对于刚性分子，哈密顿量可分为动能和势能。由于我们只关心速度的分布，我们可以对位置和方向自由度进行积分，从而得到一个仅依赖于动能 $T_{\\mathrm{kin}}$ 的动量（或速度）分布。刚体的动能是其平动动能和转动动能之和，$T_{\\mathrm{kin}} = T_{\\mathrm{trans}} + T_{\\mathrm{rot}}$。\n\n因此，平移速度 $\\mathbf{v}$ 和角速度 $\\boldsymbol{\\omega}$ 的联合概率密度函数由下式给出：\n$$p(\\mathbf{v}, \\boldsymbol{\\omega}) \\propto \\exp(-\\beta (T_{\\mathrm{trans}} + T_{\\mathrm{rot}}))$$\n\n问题给出了这些动能项的标准表达式：\n1.  平动动能：$T_{\\mathrm{trans}} = \\frac{1}{2} m \\mathbf{v}^{\\mathsf{T}} \\mathbf{v}$，其中 $m$ 是分子的总质量，$\\mathbf{v}$ 是其质心的速度。\n2.  转动动能：$T_{\\mathrm{rot}} = \\frac{1}{2} \\boldsymbol{\\omega}^{\\mathsf{T}} \\mathbf{I}_{\\mathrm{lab}} \\boldsymbol{\\omega}$，其中 $\\boldsymbol{\\omega}$ 是角速度矢量，$\\mathbf{I}_{\\mathrm{lab}}$ 是惯性张量，两者都在固定的实验室参考系中表示。\n\n将这些代入概率密度函数可得：\n$$p(\\mathbf{v}, \\boldsymbol{\\omega}) \\propto \\exp\\left(-\\beta \\left[ \\frac{1}{2} m \\mathbf{v}^{\\mathsf{T}} \\mathbf{v} + \\frac{1}{2} \\boldsymbol{\\omega}^{\\mathsf{T}} \\mathbf{I}_{\\mathrm{lab}} \\boldsymbol{\\omega} \\right]\\right)$$\n\n和的指数可以写成指数的乘积：\n$$p(\\mathbf{v}, \\boldsymbol{\\omega}) \\propto \\exp\\left(-\\frac{\\beta m}{2} \\mathbf{v}^{\\mathsf{T}} \\mathbf{v}\\right) \\exp\\left(-\\frac{\\beta}{2} \\boldsymbol{\\omega}^{\\mathsf{T}} \\mathbf{I}_{\\mathrm{lab}} \\boldsymbol{\\omega}\\right)$$\n\n这种分解形式揭示了一个关键属性：联合概率密度 $p(\\mathbf{v}, \\boldsymbol{\\omega})$ 是一个仅依赖于 $\\mathbf{v}$ 的函数与一个仅依赖于 $\\boldsymbol{\\omega}$ 的函数的乘积。这意味着平移速度和旋转速度是统计独立的。我们可以分别分析它们的分布。\n\n**平移速度分布：**\n$\\mathbf{v}$ 的分布为 $p(\\mathbf{v}) \\propto \\exp\\left(-\\frac{1}{2} \\mathbf{v}^{\\mathsf{T}} (m \\beta) \\mathbf{I}_3 \\mathbf{v}\\right)$，其中 $\\mathbf{I}_3$ 是 $3 \\times 3$ 单位矩阵。这是多元正态（高斯）分布 $\\mathcal{N}(\\boldsymbol{\\mu}, \\Sigma)$ 的函数形式，其密度与 $\\exp\\left(-\\frac{1}{2} (\\mathbf{x}-\\boldsymbol{\\mu})^{\\mathsf{T}} \\Sigma^{-1} (\\mathbf{x}-\\boldsymbol{\\mu})\\right)$ 成正比。\n通过比较，我们确定均值向量为 $\\boldsymbol{\\mu}_{\\mathbf{v}} = \\mathbf{0}$，协方差矩阵的逆为 $\\Sigma_{\\mathbf{v}}^{-1} = m \\beta \\mathbf{I}_3$。因此，协方差矩阵是：\n$$\\Sigma_{\\mathbf{v}} = (m \\beta \\mathbf{I}_3)^{-1} = \\frac{1}{m \\beta} \\mathbf{I}_3 = \\frac{k_{\\mathrm{B}} T}{m} \\mathbf{I}_3$$\n因此，平移速度遵循一个三维高斯分布：$\\mathbf{v} \\sim \\mathcal{N}\\left(\\mathbf{0}, \\frac{k_{\\mathrm{B}} T}{m} \\mathbf{I}_3\\right)$。\n\n**旋转速度分布：**\n同样，$\\boldsymbol{\\omega}$ 的分布为 $p(\\boldsymbol{\\omega}) \\propto \\exp\\left(-\\frac{1}{2} \\boldsymbol{\\omega}^{\\mathsf{T}} (\\beta \\mathbf{I}_{\\mathrm{lab}}) \\boldsymbol{\\omega}\\right)$。这也是一个多元正态分布。通过与一般形式比较，我们确定均值向量为 $\\boldsymbol{\\mu}_{\\boldsymbol{\\omega}} = \\mathbf{0}$，协方差矩阵的逆为 $\\Sigma_{\\boldsymbol{\\omega}}^{-1} = \\beta \\mathbf{I}_{\\mathrm{lab}}$。实验室坐标系角速度的协方差矩阵为：\n$$\\Sigma_{\\boldsymbol{\\omega}_{\\mathrm{lab}}} = (\\beta \\mathbf{I}_{\\mathrm{lab}})^{-1} = \\frac{1}{\\beta} \\mathbf{I}_{\\mathrm{lab}}^{-1} = k_{\\mathrm{B}} T \\, \\mathbf{I}_{\\mathrm{lab}}^{-1}$$\n因此，实验室坐标系中的角速度遵循：$\\boldsymbol{\\omega}_{\\mathrm{lab}} \\sim \\mathcal{N}\\left(\\mathbf{0}, k_{\\mathrm{B}} T\\, \\mathbf{I}_{\\mathrm{lab}}^{-1}\\right)$。\n\n### 抽样算法\n\n**平移速度抽样：**\n从 $\\mathbf{v} \\sim \\mathcal{N}\\left(\\mathbf{0}, \\frac{k_{\\mathrm{B}} T}{m} \\mathbf{I}_3\\right)$ 进行抽样很简单，因为协方差矩阵是对角的。这意味着 $\\mathbf{v}$ 的三个分量 $(v_x, v_y, v_z)$ 是独立同分布的。每个分量都从均值为 $0$、方差为 $\\sigma_v^2 = \\frac{k_{\\mathrm{B}} T}{m}$ 的一维高斯分布中抽取。抽样过程是从 $\\mathcal{N}(0, \\sigma_v^2)$ 中抽取三个独立的随机数。\n\n**旋转速度抽样（物体坐标系方法）：**\n直接从 $\\mathcal{N}(\\mathbf{0}, k_{\\mathrm{B}} T \\mathbf{I}_{\\mathrm{lab}}^{-1})$ 进行抽样在计算上可能不方便，因为实验室坐标系惯性张量 $\\mathbf{I}_{\\mathrm{lab}}$ 通常是一个稠密的非对角矩阵。这需要计算其逆矩阵，然后进行 Cholesky 分解以生成相关的随机变量。\n\n一种更高效的方法是在分子的主轴坐标系（“物体坐标系”）中进行抽样。在这个坐标系中，惯性张量 $\\mathbf{I}_{\\mathrm{body}}$ 是对角的。设 $\\mathbf{I}_{\\mathrm{body}} = \\mathrm{diag}(I_{xx}, I_{yy}, I_{zz})$。实验室坐标系和物体坐标系的张量通过分子的方向相关联，该方向由旋转矩阵 $\\mathbf{Q} \\in \\mathrm{SO}(3)$ 表示：$\\mathbf{I}_{\\mathrm{lab}} = \\mathbf{Q} \\mathbf{I}_{\\mathrm{body}} \\mathbf{Q}^{\\mathsf{T}}$。同样，两个坐标系中的角速度矢量通过 $\\boldsymbol{\\omega}_{\\mathrm{lab}} = \\mathbf{Q} \\boldsymbol{\\omega}_{\\mathrm{body}}$ 相关联。\n\n我们建议从一个适当选择的高斯分布中抽样物体坐标系中的角速度 $\\boldsymbol{\\omega}_{\\mathrm{body}}$，然后将其旋转到实验室坐标系。假设我们从多元正态分布 $\\boldsymbol{\\omega}_{\\mathrm{body}} \\sim \\mathcal{N}(\\mathbf{0}, \\Sigma_{\\mathrm{body}})$ 中抽样 $\\boldsymbol{\\omega}_{\\mathrm{body}}$。我们使用高斯随机向量的线性变换性质：如果 $\\mathbf{x} \\sim \\mathcal{N}(\\boldsymbol{\\mu}, \\Sigma)$ 且 $\\mathbf{y} = \\mathbf{A}\\mathbf{x}$，那么 $\\mathbf{y} \\sim \\mathcal{N}(\\mathbf{A}\\boldsymbol{\\mu}, \\mathbf{A}\\Sigma\\mathbf{A}^{\\mathsf{T}})$。\n将此应用于 $\\boldsymbol{\\omega}_{\\mathrm{lab}} = \\mathbf{Q} \\boldsymbol{\\omega}_{\\mathrm{body}}$，我们发现 $\\boldsymbol{\\omega}_{\\mathrm{lab}}$ 也是高斯分布的，其均值为 $\\mathbf{Q}\\mathbf{0} = \\mathbf{0}$，协方差为 $\\Sigma_{\\boldsymbol{\\omega}_{\\mathrm{lab}}} = \\mathbf{Q} \\Sigma_{\\mathrm{body}} \\mathbf{Q}^{\\mathsf{T}}$。\n\n我们需要这个得到的协方差与我们从正则系综中推导出的协方差相匹配：$\\Sigma_{\\boldsymbol{\\omega}_{\\mathrm{lab}}} = k_{\\mathrm{B}} T \\mathbf{I}_{\\mathrm{lab}}^{-1}$。\n让我们求 $\\mathbf{I}_{\\mathrm{lab}}^{-1}$：\n$$\\mathbf{I}_{\\mathrm{lab}}^{-1} = (\\mathbf{Q} \\mathbf{I}_{\\mathrm{body}} \\mathbf{Q}^{\\mathsf{T}})^{-1} = (\\mathbf{Q}^{\\mathsf{T}})^{-1} \\mathbf{I}_{\\mathrm{body}}^{-1} \\mathbf{Q}^{-1} = \\mathbf{Q} \\mathbf{I}_{\\mathrm{body}}^{-1} \\mathbf{Q}^{\\mathsf{T}}$$\n（这里我们使用了 $(\\mathbf{A}\\mathbf{B})^{-1} = \\mathbf{B}^{-1}\\mathbf{A}^{-1}$ 以及对于正交矩阵 $\\mathbf{Q}$，有 $\\mathbf{Q}^{-1} = \\mathbf{Q}^{\\mathsf{T}}$ 和 $(\\mathbf{Q}^{\\mathsf{T}})^{-1} = \\mathbf{Q}$ 的性质。）\n因此，目标协方差为 $\\Sigma_{\\boldsymbol{\\omega}_{\\mathrm{lab}}} = k_{\\mathrm{B}} T (\\mathbf{Q} \\mathbf{I}_{\\mathrm{body}}^{-1} \\mathbf{Q}^{\\mathsf{T}})$。\n将此与变换后的协方差 $\\mathbf{Q} \\Sigma_{\\mathrm{body}} \\mathbf{Q}^{\\mathsf{T}}$ 进行比较，我们可以确定物体坐标系速度所需的协方差：\n$$\\Sigma_{\\mathrm{body}} = k_{\\mathrm{B}} T \\, \\mathbf{I}_{\\mathrm{body}}^{-1}$$\n这证明了所提议的抽样程序的合理性：\n1.  从 $\\boldsymbol{\\omega}_{\\mathrm{body}} \\sim \\mathcal{N}(\\mathbf{0}, k_{\\mathrm{B}} T \\mathbf{I}_{\\mathrm{body}}^{-1})$ 进行抽样。\n2.  将抽样得到的矢量转换到实验室坐标系：$\\boldsymbol{\\omega}_{\\mathrm{lab}} = \\mathbf{Q} \\boldsymbol{\\omega}_{\\mathrm{body}}$。\n\n这个程序的主要优点是计算效率。由于 $\\mathbf{I}_{\\mathrm{body}}$ 是对角的，$\\mathbf{I}_{\\mathrm{body}} = \\mathrm{diag}(I_{xx}, I_{yy}, I_{zz})$，其逆矩阵也是对角的：$\\mathbf{I}_{\\mathrm{body}}^{-1} = \\mathrm{diag}(1/I_{xx}, 1/I_{yy}, 1/I_{zz})$。因此，物体坐标系的协方差矩阵 $\\Sigma_{\\mathrm{body}}$ 也是对角的。从 $\\mathcal{N}(\\mathbf{0}, \\Sigma_{\\mathrm{body}})$ 进行抽样简化为为 $\\boldsymbol{\\omega}_{\\mathrm{body}}$ 的分量抽取三个独立的一维高斯随机数，其方差分别为 $k_{\\mathrm{B}} T/I_{xx}$、$k_{\\mathrm{B}} T/I_{yy}$ 和 $k_{\\mathrm{B}} T/I_{zz}$。\n\n### 验证过程\n\n抽样算法的正确性通过数值方法进行验证。对于每个测试案例，我们抽取大量（$N=100000$）独立的 $(\\mathbf{v}, \\boldsymbol{\\omega}_{\\mathrm{lab}})$ 样本。\n\n1.  **协方差验证：** 我们从 $N$ 个样本中计算经验（样本）协方差矩阵 $\\widehat{\\Sigma}_{\\mathbf{v}}$ 和 $\\widehat{\\Sigma}_{\\boldsymbol{\\omega}_{\\mathrm{lab}}}$。将这些矩阵与上面推导出的理论矩阵 $\\Sigma_{\\mathbf{v}}$ 和 $\\Sigma_{\\boldsymbol{\\omega}_{\\mathrm{lab}}}$ 进行比较。比较使用相对 Frobenius 范数误差：$\\varepsilon = \\lVert \\widehat{\\Sigma} - \\Sigma \\rVert_{\\mathrm{F}} / \\lVert \\Sigma \\rVert_{\\mathrm{F}}$。如果 $\\varepsilon  0.03$，则宣布匹配。\n\n2.  **独立性验证：** 理论推导表明 $\\mathbf{v}$ 和 $\\boldsymbol{\\omega}_{\\mathrm{lab}}$ 是统计独立的。这意味着 $\\mathbf{v}$ 的任意分量与 $\\boldsymbol{\\omega}_{\\mathrm{lab}}$ 的任意分量之间的相关性应为零。我们通过计算连接向量 $(\\mathbf{v}, \\boldsymbol{\\omega}_{\\mathrm{lab}})$ 的 $6 \\times 6$ 样本相关系数矩阵来检验这一点。然后，我们找到对应于 $\\mathbf{v}$ 和 $\\boldsymbol{\\omega}_{\\mathrm{lab}}$ 分量之间互相关的 $3 \\times 3$ 非对角块中的最大绝对值。如果这个最大绝对相关性小于 $0.03$，则宣布独立。这个小的非零阈值考虑了有限样本中的统计噪声。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.spatial.transform import Rotation\n\ndef solve():\n    \"\"\"\n    Derives, implements, and validates an algorithm to initialize velocities\n    for a rigid molecule in thermal equilibrium.\n    \"\"\"\n    \n    # Constants and simulation parameters\n    k_B = 1.380649e-23  # Boltzmann constant in J/K\n    N_SAMPLES = 100000\n    SEED = 12345\n    rng = np.random.default_rng(SEED)\n\n    # Validation thresholds\n    COV_TOL = 0.03\n    INDEP_TOL = 0.03\n\n    # Test cases from the problem statement\n    test_cases = [\n        {\n            \"m\": 4.0e-15,  # kg\n            \"I_body_diag\": np.array([1.6e-27, 1.0e-27, 0.5e-27]),  # kg*m^2\n            \"euler_angles\": (0.3, -0.5, 1.0),  # radians\n            \"T\": 300.0,  # K\n        },\n        {\n            \"m\": 4.0e-15,\n            \"I_body_diag\": np.array([1.0e-27, 1.0e-27, 1.0e-27]),\n            \"euler_angles\": (0.0, 0.0, 0.0),  # Corresponds to Q = I_3\n            \"T\": 300.0,\n        },\n        {\n            \"m\": 4.0e-15,\n            \"I_body_diag\": np.array([1.0e-27, 1.0e-27, 2.0e-27]),\n            \"euler_angles\": (0.2, 0.4, -0.6),\n            \"T\": 300.0,\n        },\n        {\n            \"m\": 4.0e-15,\n            \"I_body_diag\": np.array([1.0e-28, 2.0e-27, 5.0e-27]),\n            \"euler_angles\": (-0.1, 0.7, 0.5),\n            \"T\": 300.0,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        m, I_body_diag, euler_angles, T = case.values()\n        \n        # --- Theoretical Calculations ---\n        # Construct rotation matrix Q from ZYZ Euler angles\n        # This is a standard convention for rigid body dynamics.\n        Q = Rotation.from_euler('zyz', euler_angles, degrees=False).as_matrix()\n        \n        # Body-frame inertia tensor\n        I_body = np.diag(I_body_diag)\n        \n        # Lab-frame inertia tensor\n        I_lab = Q @ I_body @ Q.T\n        \n        # Theoretical covariance matrices\n        Sigma_v_th = (k_B * T / m) * np.identity(3)\n        Sigma_omega_th = k_B * T * np.linalg.inv(I_lab)\n        \n        # --- Sampling ---\n        # 1. Sample translational velocities (v)\n        sigma_v = np.sqrt(k_B * T / m)\n        v_samples = rng.normal(loc=0.0, scale=sigma_v, size=(N_SAMPLES, 3))\n        \n        # 2. Sample rotational velocities (omega) using the body-frame method\n        sigma_omega_body = np.sqrt(k_B * T / I_body_diag)\n        omega_body_samples = rng.normal(loc=0.0, scale=sigma_omega_body, size=(N_SAMPLES, 3))\n        \n        # Transform to lab frame\n        omega_lab_samples = np.einsum('ij,kj->ki', Q, omega_body_samples)\n\n        # --- Validation ---\n        # 1. Covariance validation\n        # ddof=1 for unbiased sample covariance\n        Sigma_v_emp = np.cov(v_samples, rowvar=False, ddof=1)\n        Sigma_omega_emp = np.cov(omega_lab_samples, rowvar=False, ddof=1)\n        \n        # Relative Frobenius norm error\n        err_v = np.linalg.norm(Sigma_v_emp - Sigma_v_th, 'fro') / np.linalg.norm(Sigma_v_th, 'fro')\n        err_omega = np.linalg.norm(Sigma_omega_emp - Sigma_omega_th, 'fro') / np.linalg.norm(Sigma_omega_th, 'fro')\n\n        b_trans = err_v  COV_TOL\n        b_rot = err_omega  COV_TOL\n        \n        # 2. Independence validation\n        # Stack data for correlation calculation\n        combined_data = np.hstack((v_samples, omega_lab_samples))\n        # Correlation matrix for the 6 variables (3 v, 3 omega)\n        corr_matrix = np.corrcoef(combined_data, rowvar=False)\n        # Extract the off-diagonal block for v-omega cross-correlations\n        cross_corr_matrix = corr_matrix[0:3, 3:6]\n        # Find the maximum absolute correlation\n        max_abs_corr = np.max(np.abs(cross_corr_matrix))\n\n        b_indep = max_abs_corr  INDEP_TOL\n        \n        results.extend([b_trans, b_rot, b_indep])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在模拟晶体材料时，通常将粒子初始化在完美的晶格上。然而，简单地施加一个连续介质式的速度场可能会导致非物理行为。本练习探讨了晶格各向异性的后果，即晶体的离散简正模式（声子）与理想化的纵波或横波并不一致。通过线性稳定性分析，您将学习如何识别和量化由不当初始化激发的伪模式，这是确保固态模拟稳定性和准确性的关键技能。",
            "id": "3769272",
            "problem": "考虑一个在方形 Bravais 晶格上初始化的二维粒子系统，用于多尺度建模与分析。质量为 $m$ 的粒子占据位置 $\\mathbf{r}_{i,j} = a\\,[i, j]$，晶格间距为 $a0$，$i,j$ 为整数，且系统具有中心线性弹簧。每个粒子通过刚度为 $K_10$ 的弹簧与其沿坐标轴的 $4$ 个最近邻相连，并通过刚度为 $K_2\\ge 0$ 的弹簧与其 $4$ 个对角线方向的次近邻相连。假设位移很小且为线性弹性，因此在线性化体系中 Hooke 定律适用。施加周期性边界条件，以便平面波傅里叶分析有效。\n\n位置和速度的初始化构造如下。位置被精确地放置在晶格点 $\\mathbf{r}_{i,j}$ 上。初始速度场是具有波矢 $\\mathbf{k}=(k_x,k_y)$ 和单位极化 $\\hat{\\mathbf{k}}=\\mathbf{k}/\\|\\mathbf{k}\\|$ 的单个平面波模式，因此在时间 $t=0$ 时速度为\n$$\n\\mathbf{v}(\\mathbf{r},0)=V_0\\,\\hat{\\mathbf{k}}\\,\\cos(\\mathbf{k}\\cdot \\mathbf{r}),\n$$\n振幅为 $V_00$。此初始化的目的是在连续介质意义上激发一个纯纵向模式（速度平行于 $\\mathbf{k}$）。然而，由于晶格的各向异性，离散简正模相对于 $\\mathbf{k}$ 通常不完全是纵向或横向的，并且该初始化将投影到两个离散本征模上。对于给定的 $\\mathbf{k}$，将伪模式振幅（无量纲）定义为 $\\hat{\\mathbf{k}}$ 在与 $\\hat{\\mathbf{k}}$ 对齐程度较低的离散本征模上的投影大小（即两个绝对投影中较小的一个）。\n\n从 Newton 第二定律和中心弹簧的线性化 Hooke 定律出发，通过应用平面波拟设 $\\mathbf{u}(\\mathbf{r},t)=\\mathbf{U}\\,e^{\\mathrm{i}(\\mathbf{k}\\cdot \\mathbf{r}-\\omega t)}$ 进行线性稳定性分析，以推导晶格的 $2\\times 2$ 傅里叶空间动力学矩阵 $\\mathbf{D}(\\mathbf{k})$。$\\mathbf{D}(\\mathbf{k})$ 的本征矢量决定了离散极化。使用这些极化，计算上述定义的初始化的伪模式振幅。\n\n您的任务是编写一个程序，在给定晶格和材料参数以及波矢 $\\mathbf{k}$ 的情况下，计算定义如下的伪模式振幅\n$$\nA_{\\mathrm{spur}}(\\mathbf{k})=\\min\\left\\{\\left|\\mathbf{e}_1(\\mathbf{k})\\cdot \\hat{\\mathbf{k}}\\right|,\\;\\left|\\mathbf{e}_2(\\mathbf{k})\\cdot \\hat{\\mathbf{k}}\\right|\\right\\},\n$$\n其中 $\\mathbf{e}_1(\\mathbf{k})$ 和 $\\mathbf{e}_2(\\mathbf{k})$ 是 $\\mathbf{D}(\\mathbf{k})$ 的标准正交本征矢量（极化）。角度必须使用弧度制。振幅 $A_{\\mathrm{spur}}$ 是无量纲的，并且必须作为实数返回。\n\n使用以下参数元组 $(a,m,K_1,K_2,k_x,k_y)$ 的测试套件，单位为国际单位制（SI units），角度以弧度为单位：\n- 测试 1：$(a, m, K_1, K_2, k_x, k_y) = (0.01, 1.0, 100.0, 0.0, 200.0, 200.0)$。\n- 测试 2：$(a, m, K_1, K_2, k_x, k_y) = (0.01, 1.0, 100.0, 50.0, 200.0, 200.0)$。\n- 测试 3：$(a, m, K_1, K_2, k_x, k_y) = (0.01, 1.0, 100.0, 0.0, 200.0, 0.0)$。\n- 测试 4：$(a, m, K_1, K_2, k_x, k_y) = (0.01, 1.0, 100.0, 50.0, 10.0, 10.0)$。\n- 测试 5：$(a, m, K_1, K_2, k_x, k_y) = (0.01, 1.0, 100.0, 50.0, $0.9\\pi/a$, $0.9\\pi/a$)$。\n\n科学真实性和一致性要求：\n- 假设线性小应变动力学、中心力弹簧和周期性，以便离散傅里叶模式分析有效。\n- 振幅 $A_{\\mathrm{spur}}$ 是无量纲的。输出中不需要物理单位。\n- 所有角度量（包括任何出现的 $\\pi$）均使用弧度。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内容为按上述测试顺序排列的结果，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$，其中每个 $\\text{result}_i$ 是一个浮点数。",
            "solution": "用户提供的问题已经过验证，并被确定为晶格动力学中一个有效且适定的问题。晶格动力学是固态物理学的一个子领域，与多尺度建模相关。\n\n该问题要求计算一个“伪模式振幅”，该振幅量化了连续介质级别的纵向速度初始化与二维方形晶格的实际离散简正模之间的失准程度。解决方案涉及推导晶格的动力学矩阵，然后使用其本征矢量（极化矢量）来计算所需的量。\n\n**步骤 1：动力学矩阵的推导**\n\n我们考虑一个位于晶格点 $\\mathbf{r}_{ij} = a[i,j]$ 的质量为 $m$ 的粒子，其中 $a$ 是晶格常数。设 $\\mathbf{u}_{ij}(t)$ 是该粒子偏离其平衡位置的小位移。该系统包含连接最近邻（NN）的刚度为 $K_1$ 的中心弹簧和连接次近邻（NNN）的刚度为 $K_2$ 的中心弹簧。\n\n位于晶格点 $\\mathbf{l}$（$(i,j)$的简写）的粒子的运动方程由 Newton 第二定律给出，$m\\ddot{\\mathbf{u}}_\\mathbf{l} = \\mathbf{F}_\\mathbf{l}$，其中 $\\mathbf{F}_\\mathbf{l}$ 是作用在该粒子上的总力。对于中心势，位于 $\\mathbf{l'}$ 的邻居粒子对位于 $\\mathbf{l}$ 的粒子施加的力为 $\\mathbf{F}_{\\mathbf{l} \\leftarrow \\mathbf{l'}} = - \\nabla_{\\mathbf{u}_\\mathbf{l}} V_{\\mathbf{l}\\mathbf{l'}}$。对于小位移，单个弹簧的势能为 $V_{\\mathbf{l}\\mathbf{l'}} \\approx \\frac{1}{2} K ((\\hat{\\mathbf{R}}_{\\mathbf{l}\\mathbf{l'}}) \\cdot (\\mathbf{u}_\\mathbf{l} - \\mathbf{u}_{\\mathbf{l'}}))^2$，其中 $\\mathbf{R}_{\\mathbf{l}\\mathbf{l'}}$ 是从 $\\mathbf{l'}$ 到 $\\mathbf{l}$ 的平衡位置矢量，$K$ 是弹簧刚度。\n\n因此，$\\mathbf{l'}$ 处的粒子对 $\\mathbf{l}$ 处的粒子的力为 $\\mathbf{F}_{\\mathbf{l} \\leftarrow \\mathbf{l'}} = K ((\\hat{\\mathbf{R}}_{\\mathbf{l}\\mathbf{l'}}) \\cdot (\\mathbf{u}_{\\mathbf{l'}} - \\mathbf{u}_{\\mathbf{l}}))\\hat{\\mathbf{R}}_{\\mathbf{l}\\mathbf{l'}}$。\n设中心粒子位于原点（$\\mathbf{l}$ 对应于 $\\mathbf{r}=\\mathbf{0}$），并对其所有位于位置 $\\mathbf{R}$ 的邻居进行求和。邻居的位移为 $\\mathbf{u}(\\mathbf{R}, t)$。\n中心粒子受到的总力为 $\\mathbf{F}(\\mathbf{0}, t) = \\sum_{\\mathbf{R}} K(\\mathbf{R}) (\\hat{\\mathbf{R}} \\cdot (\\mathbf{u}(\\mathbf{R}, t) - \\mathbf{u}(\\mathbf{0}, t)))\\hat{\\mathbf{R}}$。\n运动方程为 $m\\ddot{\\mathbf{u}}(\\mathbf{0}, t) = \\sum_{\\mathbf{R}} K(\\mathbf{R}) (\\hat{\\mathbf{R}} \\cdot (\\mathbf{u}(\\mathbf{R}, t) - \\mathbf{u}(\\mathbf{0}, t)))\\hat{\\mathbf{R}}$。\n\n我们寻求形式为 $\\mathbf{u}(\\mathbf{r}, t) = \\mathbf{U} e^{\\mathrm{i}(\\mathbf{k}\\cdot\\mathbf{r} - \\omega t)}$ 的平面波解（简正模），其中 $\\mathbf{U}$ 是恒定的极化矢量，$\\mathbf{k}$ 是波矢，$\\omega$ 是角频率。\n将此拟设代入运动方程：\n$\\ddot{\\mathbf{u}}(\\mathbf{r}, t) = -\\omega^2 \\mathbf{u}(\\mathbf{r}, t)$。\n$\\mathbf{u}(\\mathbf{R}, t) = \\mathbf{U} e^{\\mathrm{i}(\\mathbf{k}\\cdot\\mathbf{R} - \\omega t)} = \\mathbf{u}(\\mathbf{0}, t) e^{\\mathrm{i}\\mathbf{k}\\cdot\\mathbf{R}}$。\n\n方程变为：\n$-m\\omega^2\\mathbf{U}e^{-\\mathrm{i}\\omega t} = \\sum_{\\mathbf{R}} K(\\mathbf{R}) (\\hat{\\mathbf{R}} \\cdot (\\mathbf{U}e^{\\mathrm{i}\\mathbf{k}\\cdot\\mathbf{R}} - \\mathbf{U}))\\hat{\\mathbf{R}} e^{-\\mathrm{i}\\omega t}$。\n消去公因式，我们得到一个关于 $\\omega^2$ 的本征值方程：\n$m\\omega^2\\mathbf{U} = \\sum_{\\mathbf{R}} K(\\mathbf{R}) (1 - e^{\\mathrm{i}\\mathbf{k}\\cdot\\mathbf{R}}) (\\hat{\\mathbf{R}} \\cdot \\mathbf{U})\\hat{\\mathbf{R}}$。\n这可以写成矩阵形式 $m\\omega^2\\mathbf{U} = \\mathbf{D}'(\\mathbf{k})\\mathbf{U}$，其中 $\\mathbf{D}'(\\mathbf{k})$ 是一个矩阵，其元素由下式给出：\n$$D'_{\\alpha\\beta}(\\mathbf{k}) = \\sum_{\\mathbf{R}} K(\\mathbf{R}) (1 - e^{\\mathrm{i}\\mathbf{k}\\cdot\\mathbf{R}}) \\hat{R}_\\alpha \\hat{R}_\\beta$$\n晶格具有反演对称性，因此对于每个位于 $\\mathbf{R}$ 的邻居，在 $-\\mathbf{R}$ 处都有另一个具有相同刚度 $K$ 的邻居。将这些对在求和中合并：\n$(1 - e^{\\mathrm{i}\\mathbf{k}\\cdot\\mathbf{R}}) + (1 - e^{-\\mathrm{i}\\mathbf{k}\\cdot\\mathbf{R}}) = 2 - 2\\cos(\\mathbf{k}\\cdot\\mathbf{R}) = 4\\sin^2(\\frac{\\mathbf{k}\\cdot\\mathbf{R}}{2})$。\n问题定义了与 $\\omega^2$ 相关的动力学矩阵 $\\mathbf{D}(\\mathbf{k})$。按照惯例，$\\omega^2 \\mathbf{U} = \\mathbf{D}(\\mathbf{k})\\mathbf{U}$。表示极化的本征矢量与质量 $m$ 无关。因此，我们可以从矩阵 $\\tilde{\\mathbf{D}}(\\mathbf{k}) = m\\mathbf{D}(\\mathbf{k})$ 中找到本征矢量。\n$$ \\tilde{\\mathbf{D}}(\\mathbf{k}) = \\sum_{\\mathbf{R}  0} 4K(\\mathbf{R})\\sin^2\\left(\\frac{\\mathbf{k}\\cdot\\mathbf{R}}{2}\\right) (\\hat{\\mathbf{R}} \\otimes \\hat{\\mathbf{R}}) $$\n其中求和是对一组非相反方向的邻居矢量进行的。\n\n对于二维方形晶格，其中 $\\mathbf{k}=(k_x, k_y)$：\n最近邻相互作用 ($K_1$)：$\\mathbf{R} \\in \\{(a,0), (0,a)\\}$。\n次近邻相互作用 ($K_2$)：$\\mathbf{R} \\in \\{(a,a), (a,-a)\\}$。\n张量积为 $\\hat{\\mathbf{R}} \\otimes \\hat{\\mathbf{R}} = \\begin{pmatrix} \\hat{R}_x^2  \\hat{R}_x \\hat{R}_y \\\\ \\hat{R}_x \\hat{R}_y  \\hat{R}_y^2 \\end{pmatrix}$。\n\n对贡献求和：\n- 最近邻：$4K_1 \\sin^2(\\frac{k_x a}{2})\\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix} + 4K_1 \\sin^2(\\frac{k_y a}{2})\\begin{pmatrix} 0  0 \\\\ 0  1 \\end{pmatrix}$\n- 次近邻：$4K_2 \\sin^2(\\frac{(k_x+k_y)a}{2})\\begin{pmatrix} 1/2  1/2 \\\\ 1/2  1/2 \\end{pmatrix} + 4K_2 \\sin^2(\\frac{(k_x-k_y)a}{2})\\begin{pmatrix} 1/2  -1/2 \\\\ -1/2  1/2 \\end{pmatrix}$\n\n这导出了矩阵 $\\tilde{\\mathbf{D}}(\\mathbf{k}) = \\begin{pmatrix} D_{xx}  D_{xy} \\\\ D_{yx}  D_{yy} \\end{pmatrix}$：\n$D_{xx} = 4K_1\\sin^2(\\frac{k_x a}{2}) + 2K_2\\left[\\sin^2(\\frac{(k_x+k_y)a}{2}) + \\sin^2(\\frac{(k_x-k_y)a}{2})\\right]$\n$D_{yy} = 4K_1\\sin^2(\\frac{k_y a}{2}) + 2K_2\\left[\\sin^2(\\frac{(k_x+k_y)a}{2}) + \\sin^2(\\frac{(k_x-k_y)a}{2})\\right]$\n$D_{xy} = D_{yx} = 2K_2\\left[\\sin^2(\\frac{(k_x+k_y)a}{2}) - \\sin^2(\\frac{(k_x-k_y)a}{2})\\right]$\n\n使用恒等式 $\\sin^2 A + \\sin^2 B = 1 - \\cos(A+B)\\cos(A-B)$ 和 $\\sin^2 A - \\sin^2 B = \\sin(A+B)\\sin(A-B)$，并令 $q_x=k_xa/2$, $q_y=k_ya/2$：\n$D_{xx} = 4K_1 \\sin^2(q_x) + 4K_2 (\\sin^2(q_x) + \\sin^2(q_y) - 2\\sin^2(q_x)\\sin^2(q_y))$\n$D_{yy} = 4K_1 \\sin^2(q_y) + 4K_2 (\\sin^2(q_x) + \\sin^2(q_y) - 2\\sin^2(q_x)\\sin^2(q_y))$\n$D_{xy} = 2K_2 \\sin(2q_x)\\sin(2q_y) = 2K_2 \\sin(k_x a)\\sin(k_y a)$\n\n**步骤 2：伪模式振幅的计算**\n\n问题要求计算伪模式振幅 $A_{\\mathrm{spur}}(\\mathbf{k})$，其定义为连续介质纵向极化矢量 $\\hat{\\mathbf{k}}=\\mathbf{k}/\\|\\mathbf{k}\\|$ 在动力学矩阵的两个离散极化本征矢量 $\\mathbf{e}_1(\\mathbf{k})$ 和 $\\mathbf{e}_2(\\mathbf{k})$ 上投影的绝对值中较小的一个。\n$$ A_{\\mathrm{spur}}(\\mathbf{k})=\\min\\left\\{\\left|\\mathbf{e}_1(\\mathbf{k})\\cdot \\hat{\\mathbf{k}}\\right|,\\;\\left|\\mathbf{e}_2(\\mathbf{k})\\cdot \\hat{\\mathbf{k}}\\right|\\right\\} $$\n本征矢量 $\\mathbf{e}_1$ 和 $\\mathbf{e}_2$ 是通过求解上面推导的 $2\\times 2$ 实对称矩阵 $\\tilde{\\mathbf{D}}(\\mathbf{k})$ 的归一化本征矢量得到的。\n\n对于每个测试用例 $(a, m, K_1, K_2, k_x, k_y)$ 的计算步骤如下：\n1.  定义参数 $a$、$K_1$、$K_2$ 和波矢 $\\mathbf{k}=(k_x, k_y)$。求解本征矢量不需要质量 $m$。\n2.  如果 $\\mathbf{k} = (0,0)$，则问题是病态的。对于所有给定的测试用例，$\\|\\mathbf{k}\\|  0$。\n3.  计算单位矢量 $\\hat{\\mathbf{k}} = (k_x, k_y) / \\sqrt{k_x^2 + k_y^2}$。\n4.  使用上面推导的公式计算矩阵 $\\tilde{\\mathbf{D}}(\\mathbf{k})$ 的元素 $D_{xx}$、$D_{yy}$ 和 $D_{xy}$。\n5.  找到矩阵 $\\tilde{\\mathbf{D}}(\\mathbf{k})$ 的两个标准正交本征矢量 $\\mathbf{e}_1$ 和 $\\mathbf{e}_2$。这是通过数值方法完成的。\n6.  计算点积的绝对值：$p_1 = |\\mathbf{e}_1 \\cdot \\hat{\\mathbf{k}}|$ 和 $p_2 = |\\mathbf{e}_2 \\cdot \\hat{\\mathbf{k}}|$。\n7.  伪模式振幅是这两个值中的最小值：$A_{\\mathrm{spur}} = \\min(p_1, p_2)$。\n\n对每个提供的测试用例执行此程序。对于高对称性方向，例如当 $k_x=k_y$ 或 $\\mathbf{k}$ 的一个分量为零时，离散模式相对于 $\\mathbf{k}$ 是纯纵向和纯横向的。在这些情况下，一个投影将为 $1$，另一个将为 $0$，从而得到伪振幅为 $0$。预计出现非零振幅的唯一情况是当波矢不沿高对称性方向时，这会导致离散本征模中纵向和横向特性的混合。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the lattice dynamics problem for a series of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (a, m, K1, K2, kx_str, ky_str)\n    # k vectors are given as strings to handle the pi/a case.\n    test_cases_str = [\n        (0.01, 1.0, 100.0, 0.0, \"200.0\", \"200.0\"),\n        (0.01, 1.0, 100.0, 50.0, \"200.0\", \"200.0\"),\n        (0.01, 1.0, 100.0, 0.0, \"200.0\", \"0.0\"),\n        (0.01, 1.0, 100.0, 50.0, \"10.0\", \"10.0\"),\n        (0.01, 1.0, 100.0, 50.0, \"0.9*pi/a\", \"0.9*pi/a\"),\n    ]\n\n    results = []\n    for case_str in test_cases_str:\n        a, m, K1, K2, kx_str, ky_str = case_str\n        \n        # Evaluate kx and ky from their string representations\n        pi = np.pi\n        kx = eval(kx_str, {\"pi\": pi, \"a\": a})\n        ky = eval(ky_str, {\"pi\": pi, \"a\": a})\n\n        result = compute_spurious_amplitude(a, K1, K2, kx, ky)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_spurious_amplitude(a, K1, K2, kx, ky):\n    \"\"\"\n    Computes the spurious mode amplitude for a given set of parameters.\n\n    Args:\n        a (float): Lattice spacing.\n        K1 (float): Nearest-neighbor spring stiffness.\n        K2 (float): Next-nearest-neighbor spring stiffness.\n        kx (float): x-component of the wavevector.\n        ky (float): y-component of the wavevector.\n\n    Returns:\n        float: The dimensionless spurious mode amplitude.\n    \"\"\"\n    k_vec = np.array([kx, ky])\n    k_norm = np.linalg.norm(k_vec)\n\n    # Handle the k=0 case, although not in tests.\n    if k_norm == 0:\n        return 0.0\n\n    k_hat = k_vec / k_norm\n\n    # Calculate terms for the dynamical matrix\n    q_x = kx * a / 2.0\n    q_y = ky * a / 2.0\n\n    s_x = np.sin(q_x)\n    s_y = np.sin(q_y)\n    \n    # Using the simplified expressions for the matrix elements\n    sin2_qx = s_x**2\n    sin2_qy = s_y**2\n    \n    # Contribution to diagonal elements from K2\n    D_diag_K2_term = 4.0 * K2 * (sin2_qx + sin2_qy - 2.0 * sin2_qx * sin2_qy)\n    \n    D_xx = 4.0 * K1 * sin2_qx + D_diag_K2_term\n    D_yy = 4.0 * K1 * sin2_qy + D_diag_K2_term\n    \n    # Off-diagonal element\n    D_xy = 2.0 * K2 * np.sin(kx * a) * np.sin(ky * a)\n\n    # Construct the dynamical matrix (proportional to it, mass is irrelevant)\n    D_matrix = np.array([\n        [D_xx, D_xy],\n        [D_xy, D_yy]\n    ])\n\n    # Find the eigenvectors (polarizations)\n    # eigh is for Hermitian matrices and returns orthonormal eigenvectors\n    _, e_vecs = np.linalg.eigh(D_matrix)\n    e1 = e_vecs[:, 0]\n    e2 = e_vecs[:, 1]\n\n    # Calculate projections\n    p1 = np.abs(np.dot(e1, k_hat))\n    p2 = np.abs(np.dot(e2, k_hat))\n\n    # The spurious amplitude is the minimum of the projections\n    A_spur = min(p1, p2)\n    \n    return A_spur\n\nsolve()\n\n```"
        },
        {
            "introduction": "在耦合粒子和连续介质区域的多尺度模拟中，或在纯流体动力学模拟中，确保所有描述场之间初始状态的一致性至关重要。一个不一致的初始化，例如一个没有相应速度或压力场的密度梯度 $\\rho(x)$，会产生虚假的、高频的波。本实践深入研究线性声学理论，展示这种不一致性如何分解为反向传播的波。您将设计一个修正的、物理上一致的初始化方法来抑制这些人为效应，这是在流体动力学和耦合多尺度模拟中获得干净且有意义结果的一项关键技术。",
            "id": "3769297",
            "problem": "考虑由欧拉偏微分方程（PDE）控制的一维可压缩无粘性气体。设空间坐标为 $x \\in [0,L]$，且具有周期性边界条件。状态变量为密度 $\\rho(x,t)$（单位：$\\mathrm{kg/m^3}$），速度 $u(x,t)$（单位：$\\mathrm{m/s}$），以及压力 $p(x,t)$（单位：$\\mathrm{Pa}$）。假设气体为多方理想气体，其绝热指数 $\\gamma1$，状态方程为 $p(\\rho) = K \\rho^\\gamma$，其中 $K0$ 是一个常数。设均匀参考态为 $(\\rho_0, u_0, p_0) = (\\rho_0, 0, K \\rho_0^\\gamma)$，并定义参考声速 $c_0 = \\sqrt{\\gamma p_0 / \\rho_0}$（单位：$\\mathrm{m/s}$）。\n\n从围绕均匀参考态线性化的控制定律（连续性方程和动量方程）出发，小扰动 $(\\eta(x,t), v(x,t)) = (\\rho(x,t)-\\rho_0, u(x,t)-0)$ 服从\n$$\n\\partial_t \\eta + \\rho_0 \\, \\partial_x v = 0, \\qquad\n\\partial_t v + \\frac{c_0^2}{\\rho_0} \\, \\partial_x \\eta = 0.\n$$\n定义线性声学黎曼变量\n$$\nr_+(x,t) = v(x,t) + \\frac{c_0}{\\rho_0}\\,\\eta(x,t), \\qquad\nr_-(x,t) = v(x,t) - \\frac{c_0}{\\rho_0}\\,\\eta(x,t),\n$$\n它们满足解耦的输运方程 $\\partial_t r_\\pm \\pm c_0 \\partial_x r_\\pm = 0$。\n\n任务第1部分（推导要求）：从上述线性化方程和定义出发，推导用均匀速度初始化非均匀密度场会产生非零的 $r_+$ 和 $r_-$ 分量，并作为左行和右行压力波传播。您的推导必须从上面给出的连续性方程和动量方程开始，仅使用给定的定义和多方理想气体关系，并且不得引用任何未经证明的简化公式。\n\n任务第2部分（初始化设计）：设计一个与位置相关的修正初始化 $u(x)$，通过在各处强制实施 $r_-(x,0) \\equiv 0$ 或 $r_+(x,0) \\equiv 0$，以在 $t=0$ 时消除其中一个声学族，从而抑制一半的伪压力波分量。请用 $\\eta(x)$、$\\rho_0$ 和 $c_0$ 明确表示 $u(x)$。\n\n计算验证：实现一个程序，针对指定的测试套件，在两种初始化条件下计算左行声学分量 $r_-(x,0)$ 的均方根（RMS）大小：\n- 均匀速度初始化：$v(x,0) = 0$，\n- 修正速度初始化：$v(x,0) = \\sigma \\, \\frac{c_0}{\\rho_0}\\, \\eta(x)$，其中 $\\sigma \\in \\{+1,-1\\}$ 的选择应使 $r_-(x,0) \\equiv 0$（取 $\\sigma=+1$）。\n\n对于每个测试用例，报告一个列表 $[R_{\\mathrm{uniform}}, R_{\\mathrm{corrected}}]$，其中每个条目是由下式定义的均方根值（单位：$\\mathrm{m/s}$）：\n$$\nR = \\sqrt{\\frac{1}{L} \\int_0^L r_-(x,0)^2 \\, dx }.\n$$\n\n科学设定和参数：使用 $L=1$（单位：$\\mathrm{m}$），$\\rho_0 = 1$（单位：$\\mathrm{kg/m^3}$），$\\gamma = 1.4$ 以及 $p_0 = 10^5$（单位：$\\mathrm{Pa}$）。计算 $c_0 = \\sqrt{\\gamma p_0 / \\rho_0}$（单位：$\\mathrm{m/s}$）。用 $N=4096$ 个点对区间 $[0,L]$ 进行均匀离散化，并使用复合梯形法则近似计算积分。\n\n测试套件（提供跨条件的覆盖）：\n- 用例 A（理想情况，平滑正弦波）：$\\eta(x) = 0.1 \\rho_0 \\sin\\left(2\\pi x / L\\right)$。\n- 用例 B（局部高斯凸起）：$\\eta(x) = 0.2 \\rho_0 \\exp\\left(-\\frac{(x - L/2)^2}{2\\sigma^2}\\right)$，其中 $\\sigma = 0.05 L$。\n- 用例 C（边界条件，零扰动）：$\\eta(x) \\equiv 0$。\n- 用例 D（边缘情况，通过双曲正切实现的陡峭过渡）：$\\eta(x) = 0.5 \\rho_0 \\cdot \\frac{1}{2}\\left[\\tanh\\left(\\frac{x - 0.3L}{\\delta}\\right) - \\tanh\\left(\\frac{x - 0.7L}{\\delta}\\right)\\right]$，其中 $\\delta = 0.01 L$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，并且本身是一个双元素列表 $[R_{\\mathrm{uniform}},R_{\\mathrm{corrected}}]$（单位：$\\mathrm{m/s}$）。例如，一个有效的输出类似于 $[[r_{A,u},r_{A,c}],[r_{B,u},r_{B,c}],[r_{C,u},r_{C,c}],[r_{D,u},r_{D,c}]]$，其中包含数值。",
            "solution": "该问题根据指定标准进行验证。\n\n**步骤1：提取的已知条件**\n- 系统：一维可压缩无粘性气体，由欧拉偏微分方程控制。\n- 域：空间坐标 $x \\in [0,L]$，具有周期性边界条件。\n- 状态变量：密度 $\\rho(x,t)$（单位：$\\mathrm{kg/m^3}$），速度 $u(x,t)$（单位：$\\mathrm{m/s}$），压力 $p(x,t)$（单位：$\\mathrm{Pa}$）。\n- 状态方程：多方理想气体，$p(\\rho) = K \\rho^\\gamma$，绝热指数 $\\gamma1$，常数 $K0$。\n- 参考态：$(\\rho_0, u_0, p_0) = (\\rho_0, 0, K \\rho_0^\\gamma)$。\n- 参考声速：$c_0 = \\sqrt{\\gamma p_0 / \\rho_0}$（单位：$\\mathrm{m/s}$）。\n- 线性化扰动：$(\\eta(x,t), v(x,t)) = (\\rho(x,t)-\\rho_0, u(x,t)-0)$。\n- 线性化控制方程：\n$$\n\\partial_t \\eta + \\rho_0 \\, \\partial_x v = 0, \\qquad\n\\partial_t v + \\frac{c_0^2}{\\rho_0} \\, \\partial_x \\eta = 0.\n$$\n- 线性声学黎曼变量：\n$$\nr_+(x,t) = v(x,t) + \\frac{c_0}{\\rho_0}\\,\\eta(x,t), \\qquad\nr_-(x,t) = v(x,t) - \\frac{c_0}{\\rho_0}\\,\\eta(x,t),\n$$\n- 黎曼变量的输运方程：$\\partial_t r_\\pm \\pm c_0 \\partial_x r_\\pm = 0$。\n- 任务1：推导用非均匀密度和均匀速度进行初始化会同时产生左行波和右行波。\n- 任务2：设计一个初始速度 $u(x)$ 以强制 $r_-(x,0) \\equiv 0$ 或 $r_+(x,0) \\equiv 0$。\n- 计算任务：对于两种初始化（$v(x,0)=0$ 和 $v(x,0)=\\frac{c_0}{\\rho_0}\\eta(x)$），计算 $r_-(x,0)$ 的均方根大小。\n- 均方根定义：$R = \\sqrt{\\frac{1}{L} \\int_0^L r_-(x,0)^2 \\, dx }$。\n- 数值参数：$L=1 \\, \\mathrm{m}$，$\\rho_0 = 1 \\, \\mathrm{kg/m^3}$，$\\gamma = 1.4$，$p_0 = 10^5 \\, \\mathrm{Pa}$，$N=4096$ 个点。\n- 测试套件：为初始密度扰动 $\\eta(x)$ 指定的四个函数。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题在根本上是合理的。它是从欧拉方程推导出的线性声波的标准分析，是流体动力学的基石。黎曼不变量的概念及其在理解波传播和设置初始条件中的应用，是物理学和计算方法中一种成熟的技术。\n- **适定性**：该问题是适定的。控制方程、初始条件、定义和任务都以数学精度进行了规定。数值参数和方法定义清晰，可得到唯一且稳定的计算结果。\n- **客观性**：语言客观、正式，没有任何主观性或歧义。\n\n**步骤3：结论与行动**\n- **结论**：该问题是有效的。它具有科学依据，内容自洽，并且是适定的。\n- **行动**：继续进行求解。\n\n**求解推导与设计**\n\n按照要求，该问题分两部分解决：理论推导和构造性设计，然后是计算验证策略。\n\n**任务第1部分：波传播的推导**\n\n我们从给定的关于扰动 $\\eta(x,t)$ 和 $v(x,t)$ 的线性化方程开始：\n$$\n\\partial_t \\eta = - \\rho_0 \\, \\partial_x v \\quad (1)\n$$\n$$\n\\partial_t v = - \\frac{c_0^2}{\\rho_0} \\, \\partial_x \\eta \\quad (2)\n$$\n线性声学黎曼变量定义为 $r_+(x,t) = v(x,t) + \\frac{c_0}{\\rho_0}\\,\\eta(x,t)$ 和 $r_-(x,t) = v(x,t) - \\frac{c_0}{\\rho_0}\\,\\eta(x,t)$。我们将推导它们所满足的输运方程。\n\n首先，考虑 $r_+$。我们对时间 $t$ 求导：\n$$\n\\partial_t r_+ = \\partial_t v + \\frac{c_0}{\\rho_0} \\partial_t \\eta\n$$\n分别从方程 (2) 和 (1) 中代入 $\\partial_t v$ 和 $\\partial_t \\eta$ 的表达式：\n$$\n\\partial_t r_+ = \\left( - \\frac{c_0^2}{\\rho_0} \\, \\partial_x \\eta \\right) + \\frac{c_0}{\\rho_0} \\left( - \\rho_0 \\, \\partial_x v \\right) = - \\frac{c_0^2}{\\rho_0} \\, \\partial_x \\eta - c_0 \\, \\partial_x v\n$$\n提出因子 $-c_0$：\n$$\n\\partial_t r_+ = -c_0 \\left( \\partial_x v + \\frac{c_0}{\\rho_0} \\, \\partial_x \\eta \\right) = -c_0 \\, \\partial_x \\left( v + \\frac{c_0}{\\rho_0} \\eta \\right)\n$$\n根据 $r_+$ 的定义，这变为：\n$$\n\\partial_t r_+ = -c_0 \\, \\partial_x r_+ \\quad \\implies \\quad \\partial_t r_+ + c_0 \\, \\partial_x r_+ = 0\n$$\n这是一个线性平流方程，描述了一个以速度 $c_0$ 向 $x$ 轴正方向（向右）传播的波形。\n\n接下来，考虑 $r_-$。对时间 $t$ 求导：\n$$\n\\partial_t r_- = \\partial_t v - \\frac{c_0}{\\rho_0} \\partial_t \\eta\n$$\n再次从方程 (2) 和 (1) 中代入：\n$$\n\\partial_t r_- = \\left( - \\frac{c_0^2}{\\rho_0} \\, \\partial_x \\eta \\right) - \\frac{c_0}{\\rho_0} \\left( - \\rho_0 \\, \\partial_x v \\right) = - \\frac{c_0^2}{\\rho_0} \\, \\partial_x \\eta + c_0 \\, \\partial_x v\n$$\n提出因子 $+c_0$：\n$$\n\\partial_t r_- = c_0 \\left( \\partial_x v - \\frac{c_0}{\\rho_0} \\, \\partial_x \\eta \\right) = c_0 \\, \\partial_x \\left( v - \\frac{c_0}{\\rho_0} \\eta \\right)\n$$\n根据 $r_-$ 的定义，这变为：\n$$\n\\partial_t r_- = c_0 \\, \\partial_x r_- \\quad \\implies \\quad \\partial_t r_- - c_0 \\, \\partial_x r_- = 0\n$$\n这是一个线性平流方程，描述了一个以速度 $c_0$ 向 $x$ 轴负方向（向左）传播的波形。\n\n现在，我们分析特定的初始化：非均匀密度 $\\eta(x,0)$ 和均匀速度。由于参考速度 $u_0=0$，均匀速度意味着扰动为常数。一个物理上静止的介质对应于对所有 $x \\in [0,L]$ 都有 $v(x,0) = 0$。在时间 $t=0$ 时，黎曼变量为：\n$$\nr_+(x,0) = v(x,0) + \\frac{c_0}{\\rho_0}\\eta(x,0) = 0 + \\frac{c_0}{\\rho_0}\\eta(x,0) = \\frac{c_0}{\\rho_0}\\eta(x,0)\n$$\n$$\nr_-(x,0) = v(x,0) - \\frac{c_0}{\\rho_0}\\eta(x,0) = 0 - \\frac{c_0}{\\rho_0}\\eta(x,0) = -\\frac{c_0}{\\rho_0}\\eta(x,0)\n$$\n由于 $\\eta(x,0)$ 是一个非均匀场（即，不恒为零），初始剖面 $r_+(x,0)$ 和 $r_-(x,0)$ 均为非零。平流方程的解决定了这些非零的初始剖面将作为波进行传播。因此，这种初始化会同时产生右行（$r_+$）和左行（$r_-$）的压力波，在慢时间尺度现象的模拟中，这些波通常被视为伪噪声。\n\n**任务第2部分：修正的初始化设计**\n\n目标是设计一个初始速度场 $u(x)$ 来抑制其中一个声学波族。我们选择消除左行波，这要求其对应的黎曼变量 $r_-(x,t)$ 在所有时间上恒为零。根据它所满足的平流方程的性质，这可以通过确保初始剖面为零来实现：$r_-(x,0) \\equiv 0$。\n\n使用 $r_-(x,0)$ 的定义：\n$$\nr_-(x,0) = v(x,0) - \\frac{c_0}{\\rho_0}\\eta(x,0)\n$$\n将其设为零可得到初始速度扰动的条件：\n$$\nv(x,0) - \\frac{c_0}{\\rho_0}\\eta(x,0) = 0\n$$\n求解 $v(x,0)$，我们得到所需的速度扰动：\n$$\nv(x,0) = \\frac{c_0}{\\rho_0}\\eta(x,0)\n$$\n完整的速度场是 $u(x,t) = u_0 + v(x,t)$。由于参考速度 $u_0=0$，所需的初始速度场就是 $u(x) = v(x,0)$。用初始密度扰动 $\\eta(x)$、$\\rho_0$ 和 $c_0$ 表示，修正后的初始化为：\n$$\nu(x) = \\frac{c_0}{\\rho_0} \\eta(x)\n$$\n这个选择确保了 $r_-(x,0)$ 为零，从而抑制了伪左行压力波。这对应于问题中给出的公式 $v(x,0) = \\sigma \\frac{c_0}{\\rho_0}\\eta(x)$，并选择 $\\sigma = +1$。\n\n**计算验证**\n\n该实现将计算在两种不同初始速度条件下，四个测试用例中 $r_-(x,0)$ 的均方根（RMS）。区域 $[0,L]$ 被离散化为 $N=4096$ 个等距点 $x_i$，间距为 $\\Delta x = L/N$。均方根值 $R = \\sqrt{\\frac{1}{L} \\int_0^L r_-(x,0)^2 \\, dx}$ 是通过使用复合梯形法则近似计算积分来得到的。\n\n1.  **均匀速度初始化**：此处，$v(x,0) = 0$。左行黎曼变量为 $r_-(x,0) = -\\frac{c_0}{\\rho_0}\\eta(x,0)$。程序将计算该场，对其进行平方，进行数值积分，除以 $L$，然后取平方根以求得 $R_{\\mathrm{uniform}}$。对于任何非零的 $\\eta(x)$，该值将为正。\n\n2.  **修正速度初始化**：此处，$v(x,0) = \\frac{c_0}{\\rho_0}\\eta(x,0)$。左行黎曼变量为 $r_-(x,0) = v(x,0) - \\frac{c_0}{\\rho_0}\\eta(x,0) = \\frac{c_0}{\\rho_0}\\eta(x,0) - \\frac{c_0}{\\rho_0}\\eta(x,0) = 0$。解析上，该场恒为零。在数值计算中，两个相同的浮点数组相减将得到一个零数组。因此，其均方根值 $R_{\\mathrm{corrected}}$ 将精确为 $0$（或在机器精度范围内为零，本例中即为精确的 $0.0$）。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the RMS magnitude of the left-moving acoustic content r_-(x,0)\n    for two different initial velocity conditions across a suite of test cases.\n    \"\"\"\n\n    # Scientific setup and parameters\n    L = 1.0  # m\n    rho0 = 1.0  # kg/m^3\n    gamma = 1.4  # Adiabatic index\n    p0 = 1.0e5  # Pa\n    N = 4096  # Number of discretization points\n\n    # Derived parameters\n    c0 = np.sqrt(gamma * p0 / rho0)  # m/s\n    \n    # Discretize the spatial domain\n    # Use endpoint=False for periodic boundary conditions.\n    x = np.linspace(0, L, N, endpoint=False)\n    dx = L / N\n\n    # Define the four test cases for the initial density perturbation eta(x)\n    sigma_B = 0.05 * L\n    delta_D = 0.01 * L\n    \n    eta_functions = [\n        # Case A: Smooth sinusoid\n        lambda x: 0.1 * rho0 * np.sin(2 * np.pi * x / L),\n        # Case B: Localized Gaussian bump\n        lambda x: 0.2 * rho0 * np.exp(-((x - L / 2)**2) / (2 * sigma_B**2)),\n        # Case C: Zero perturbation (boundary condition check)\n        lambda x: np.zeros_like(x),\n        # Case D: Steep transition (box-like bump) via tanh\n        lambda x: 0.5 * rho0 * 0.5 * (np.tanh((x - 0.3 * L) / delta_D) - np.tanh((x - 0.7 * L) / delta_D))\n    ]\n\n    results = []\n\n    for eta_func in eta_functions:\n        # Evaluate eta(x) on the grid\n        eta = eta_func(x)\n\n        # 1. Uniform velocity initialization: v(x,0) = 0\n        # For this case, r_-(x,0) = v(x,0) - (c0/rho0)*eta(x) = - (c0/rho0)*eta(x)\n        r_minus_uniform = -(c0 / rho0) * eta\n        \n        # Compute the RMS value\n        integrand_uniform = r_minus_uniform**2\n        integral_uniform = np.trapz(integrand_uniform, dx=dx)\n        rms_uniform = np.sqrt(integral_uniform / L)\n\n        # 2. Corrected velocity initialization: v(x,0) = (c0/rho0)*eta(x)\n        # This is designed to make r_-(x,0) = 0.\n        # r_-(x,0) = v(x,0) - (c0/rho0)*eta(x) = (c0/rho0)*eta(x) - (c0/rho0)*eta(x) = 0\n        v_corrected = (c0 / rho0) * eta\n        r_minus_corrected = v_corrected - (c0 / rho0) * eta\n\n        # Compute the RMS value (expected to be 0)\n        integrand_corrected = r_minus_corrected**2\n        integral_corrected = np.trapz(integrand_corrected, dx=dx)\n        rms_corrected = np.sqrt(integral_corrected / L)\n\n        # Append the pair of RMS values to the results list\n        results.append([rms_uniform, rms_corrected])\n\n    # Final print statement in the exact required format.\n    # The output format is a list of lists, e.g., [[val1, val2], [val3, val4]]\n    # The str() representation of a Python list is exactly this format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}