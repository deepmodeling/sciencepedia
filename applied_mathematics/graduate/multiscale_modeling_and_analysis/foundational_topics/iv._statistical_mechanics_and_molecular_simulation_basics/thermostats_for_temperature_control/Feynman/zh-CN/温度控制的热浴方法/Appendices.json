{
    "hands_on_practices": [
        {
            "introduction": "在分子动力学模拟中，维持系统温度的稳定至关重要。本练习将引导你从第一性原理出发，推导 Berendsen 恒温器中的速度标度因子，这是一种经典的弱耦合方法。通过一个具体的数值算例，这个实践将温度弛豫的抽象概念转化为一个实用的算法，帮助你掌握其核心工作机制。",
            "id": "5274833",
            "problem": "考虑一个具有 $N_f$ 个经典自由度的生物分子系统的恒定粒子数、恒定体积分子动力学 (MD) 模拟，其中温度由 Berendsen 类型的速度重标弱耦合控温器控制。瞬时动能温度 $T_{\\mathrm{inst}}$ 通过能量均分定理定义为 $T_{\\mathrm{inst}} = \\frac{2K}{N_f k_B}$，其中 $K$ 是总动能，$k_B$ 是玻尔兹曼常数。在每个 MD 时间步长，所有速度都按一个共同因子 $\\alpha$ 进行缩放，位置则根据 Newton 运动方程进行推进。\n\n假设目标温度为 $T_0$，控温器对动能温度施加一阶弛豫，该过程由常微分方程 $\\frac{dT}{dt} = \\frac{1}{\\tau_T}\\left(T_0 - T\\right)$ 控制，其中 $\\tau_T$ 是控温器的时间常数。在一个持续时间为 $\\Delta t$ 的 MD 时间步长内，请确保离散的速度重标 $v_i \\mapsto \\alpha v_i$ 与温度 $T$ 的弛豫方程的一阶前向欧拉积分保持一致。\n\n从基于能量均分定理的 $T_{\\mathrm{inst}}$ 定义以及速度重标对动能的影响出发，推导 $\\alpha$ 的表达式，该表达式需确保 $T_{\\mathrm{inst}}$ 的单步离散更新与弛豫方程的前向欧拉离散化结果相匹配。然后，对于 $\\tau_T = 0.1\\,\\mathrm{ps}$、$\\Delta t = 2\\,\\mathrm{fs}$、初始 $T_{\\mathrm{inst}} = 320\\,\\mathrm{K}$ 和目标 $T_0 = 300\\,\\mathrm{K}$ 的单次重标步骤，计算 $\\alpha$ 并预测重标后新的瞬时温度。\n\n将您的数值结果四舍五入至四位有效数字。最终温度以 $\\mathrm{K}$ 为单位表示。请将您的最终答案以包含 $\\alpha$ 和一步更新后的 $T_{\\mathrm{inst}}$ 的行矩阵形式提供。",
            "solution": "用户提供了一个来自计算统计力学领域的明确问题，具体涉及在分子动力学 (MD) 模拟中使用 Berendsen 控温器进行温度控制。\n\n### 第 1 步：提取已知条件\n- 系统描述：具有 $N_f$ 个经典自由度的恒定粒子数、恒定体积 MD 模拟。\n- 温度控制方法：Berendsen 类型的速度重标弱耦合控温器。\n- 瞬时温度的定义：$T_{\\mathrm{inst}} = \\frac{2K}{N_f k_B}$，其中 $K$ 是总动能，$k_B$ 是玻尔兹曼常数。\n- 速度更新：在每个时间步长，所有速度 $v_i$ 都按一个因子 $\\alpha$ 进行缩放，使得新速度为 $v_i' = \\alpha v_i$。\n- 目标温度：$T_0$。\n- 弛豫动力学：控温器根据常微分方程 (ODE) $\\frac{dT}{dt} = \\frac{1}{\\tau_T}\\left(T_0 - T\\right)$ 对动能温度 $T$ 施加一阶弛豫，其中 $\\tau_T$ 是控温器的时间常数。\n- 时间步长：$\\Delta t$。\n- 一致性要求：离散的速度重标必须与温度弛豫 ODE 在一个时间步长 $\\Delta t$ 内的一阶前向欧拉积分保持一致。\n- 用于计算的数值：\n  - 时间常数，$\\tau_T = 0.1\\,\\mathrm{ps}$。\n  - 时间步长，$\\Delta t = 2\\,\\mathrm{fs}$。\n  - 初始瞬时温度，$T_{\\mathrm{inst}} = 320\\,\\mathrm{K}$。\n  - 目标温度，$T_0 = 300\\,\\mathrm{K}$。\n- 要求输出：\n  1. 缩放因子 $\\alpha$ 的解析表达式。\n  2. $\\alpha$ 的数值以及一次重标步骤后的新瞬时温度，结果四舍五入至四位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题具有科学依据，描述了 Berendsen 控温器的标准实现，这是一种分子模拟中的常用算法。其基本原理——能量均分定理和一级动力学——是公认的。该问题是适定的，提供了推导唯一解所需的所有定义、方程和参数。语言客观精确。所有提供的数值对于生物分子模拟都是物理上现实的。因此，该问题被认为是**有效的**。\n\n### 第 3 步：推导与计算\n\n#### 第 1 部分：缩放因子 $\\alpha$ 的推导\n\n我们的任务是关联单个 MD 时间步长 $\\Delta t$ 内温度变化的两种不同描述。\n\n首先，考虑速度重标对瞬时温度的影响。设 $T$ 为时间步长开始时的瞬时温度。根据定义，$T = \\frac{2K}{N_f k_B}$，其中 $K$ 是系统的总动能。动能由 $K = \\sum_i \\frac{1}{2} m_i v_i^2$ 给出。\n\n速度按因子 $\\alpha$ 进行重标，因此新速度为 $v_i' = \\alpha v_i$。新的动能 $K'$ 为：\n$$K' = \\sum_i \\frac{1}{2} m_i (v_i')^2 = \\sum_i \\frac{1}{2} m_i (\\alpha v_i)^2 = \\alpha^2 \\left( \\sum_i \\frac{1}{2} m_i v_i^2 \\right) = \\alpha^2 K$$\n新的瞬时温度 $T'$ 与新的动能 $K'$ 相关：\n$$T' = \\frac{2K'}{N_f k_B} = \\frac{2(\\alpha^2 K)}{N_f k_B} = \\alpha^2 \\left( \\frac{2K}{N_f k_B} \\right)$$\n因此，由速度重标引起的温度变化为：\n$$T' = \\alpha^2 T$$\n\n其次，考虑由弛豫方程 $\\frac{dT}{dt} = \\frac{1}{\\tau_T}(T_0 - T)$决定的温度变化。我们使用一阶前向欧拉方案在时间间隔 $\\Delta t$ 上对该 ODE 进行离散化。导数 $\\frac{dT}{dt}$ 近似为 $\\frac{T' - T}{\\Delta t}$，其中 $T'$ 是时间步长结束时的温度。\n$$\\frac{T' - T}{\\Delta t} \\approx \\frac{1}{\\tau_T}(T_0 - T)$$\n求解新温度 $T'$ 可得：\n$$T' \\approx T + \\frac{\\Delta t}{\\tau_T}(T_0 - T)$$\n\n为确保一致性，我们将新温度 $T'$ 的两个表达式相等：\n$$\\alpha^2 T = T + \\frac{\\Delta t}{\\tau_T}(T_0 - T)$$\n为了求解 $\\alpha$，我们除以 $T$ (假设 $T \\neq 0$，这对于有限温度下的系统是一个有效的物理假设)：\n$$\\alpha^2 = 1 + \\frac{\\Delta t}{\\tau_T}\\left(\\frac{T_0 - T}{T}\\right) = 1 + \\frac{\\Delta t}{\\tau_T}\\left(\\frac{T_0}{T} - 1\\right)$$\n取正平方根（因为 $\\alpha$ 是一个缩放因子，通常为正以保持速度方向）得到 $\\alpha$ 的最终表达式：\n$$\\alpha = \\sqrt{1 + \\frac{\\Delta t}{\\tau_T}\\left(\\frac{T_0}{T} - 1\\right)}$$\n推导完成。\n\n#### 第 2 部分：数值计算\n\n我们已知以下数值：\n- $\\tau_T = 0.1\\,\\mathrm{ps} = 0.1 \\times 10^{-12}\\,\\mathrm{s}$\n- $\\Delta t = 2\\,\\mathrm{fs} = 2 \\times 10^{-15}\\,\\mathrm{s}$\n- 初始温度，$T = T_{\\mathrm{inst}} = 320\\,\\mathrm{K}$\n- 目标温度，$T_0 = 300\\,\\mathrm{K}$\n\n首先，我们计算无量纲比率 $\\frac{\\Delta t}{\\tau_T}$：\n$$\\frac{\\Delta t}{\\tau_T} = \\frac{2 \\times 10^{-15}\\,\\mathrm{s}}{0.1 \\times 10^{-12}\\,\\mathrm{s}} = \\frac{2 \\times 10^{-15}\\,\\mathrm{s}}{1 \\times 10^{-13}\\,\\mathrm{s}} = 2 \\times 10^{-2} = 0.02$$\n现在，将这个比率和温度代入 $\\alpha^2$ 的表达式中：\n$$\\alpha^2 = 1 + 0.02 \\left(\\frac{300\\,\\mathrm{K}}{320\\,\\mathrm{K}} - 1\\right)$$\n$$\\alpha^2 = 1 + 0.02 \\left(0.9375 - 1\\right)$$\n$$\\alpha^2 = 1 + 0.02(-0.0625)$$\n$$\\alpha^2 = 1 - 0.00125$$\n$$\\alpha^2 = 0.99875$$\n现在我们通过取平方根来计算 $\\alpha$：\n$$\\alpha = \\sqrt{0.99875} \\approx 0.999374811...$$\n四舍五入到四位有效数字，我们得到：\n$$\\alpha \\approx 0.9994$$\n\n接下来，我们预测重标后即刻的新瞬时温度 $T'$。我们可以使用前向欧拉表达式进行此计算，以避免传播由我们计算出的 $\\alpha$ 带来的舍入误差。\n$$T' = T + \\frac{\\Delta t}{\\tau_T}(T_0 - T)$$\n$$T' = 320\\,\\mathrm{K} + 0.02(300\\,\\mathrm{K} - 320\\,\\mathrm{K})$$\n$$T' = 320\\,\\mathrm{K} + 0.02(-20\\,\\mathrm{K})$$\n$$T' = 320\\,\\mathrm{K} - 0.4\\,\\mathrm{K}$$\n$$T' = 319.6\\,\\mathrm{K}$$\n这个结果已经有四位有效数字。\n\n要求的两个值是缩放因子 $\\alpha$ 和新的瞬时温度 $T'$。\n$\\alpha \\approx 0.9994$\n$T' = 319.6\\,\\mathrm{K}$\n\n我们按要求将这些结果表示为一个行矩阵。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.9994  319.6 \\end{pmatrix}}$$"
        },
        {
            "introduction": "一个优秀的恒温器不仅应能控制系统的平均温度，更理想的是能够生成正确的统计系综。本练习将挑战你超越简单的公式推导，深入思考一个关键问题：尽管 Berendsen 恒温器能够有效控制温度，它是否能准确再现正则系综所要求的能量涨落？通过这项实践，你将学会批判性地评估恒温算法在统计力学层面上的有效性。",
            "id": "3902150",
            "problem": "在催化界面的反应分子动力学(MD)模拟中，放热事件会使系统偏离目标热状态。一个常用的补救方法是使用速度重标度恒温器，该恒温器旨在将系统以特征耦合时间 $\\tau_T$ 与温度为 $T_0$ 的外部热浴弱耦合。考虑一个线性响应热浴模型，其中系统的动能温度 $T$ 通过在每个持续时间为 $\\Delta t$ 的时间步长内对所有粒子速度进行均匀缩放来控制。从(i)基于能量均分的动能温度定义，即对于 $f$ 个无约束自由度和玻尔兹曼常数 $k_B$，动能温度由总动能 $K$ 表示为 $T = \\dfrac{2K}{f k_B}$，以及(ii)温度 $T$ 在时间尺度 $\\tau_T$ 上向 $T_0$ 的一阶弛豫出发，推导实现预期弛豫的单步均匀速度重标度因子，并评估此过程产生的稳态速度分布是否是严格正则的。选择正确呈现推导过程和系综评估的选项。\n\nA. 从一阶弛豫定律 $\\dfrac{dT}{dt} = \\dfrac{T_0 - T}{\\tau_T}$ 开始。通过因子 $\\lambda$ 进行均匀速度重标度可实现映射 $T \\mapsto T' = \\lambda^2 T$。在 $\\Delta t$ 上的前向欧拉离散化给出 $T' = T + \\dfrac{\\Delta t}{\\tau_T} \\left( T_0 - T \\right)$，因此 $\\lambda = \\sqrt{ 1 + \\dfrac{\\Delta t}{\\tau_T} \\left( \\dfrac{T_0}{T} - 1 \\right) }$。由此产生的动力学过程不会生成正则系综：麦克斯韦-玻尔兹曼速度分布不是不变的，因为确定性比例反馈抑制了相对于正则Γ分布的动能（方差为 $\\dfrac{f}{2} (k_B T_0)^2$）的动能涨落，并且不存在涨落-耗散平衡或细致平衡。\n\nB. 施加能量守恒 $\\dfrac{dK}{dt} = 0$ 并推断出 $\\lambda = \\sqrt{ 1 - \\dfrac{\\Delta t}{\\tau_T} \\left( \\dfrac{T_0}{T} - 1 \\right) }$。因为平均温度趋近于 $T_0$，根据各遍历性，长时间速度分布是正则的。\n\nC. 使用能量均分和隐式（后向欧拉）弛豫 $T' - T = \\dfrac{\\Delta t}{\\tau_T} \\left( T_0 - T' \\right)$，因此 $\\lambda$ 可由 $\\lambda^2 = \\dfrac{T'}{T} = \\dfrac{ T + \\dfrac{\\Delta t}{\\tau_T} T_0 }{ 1 + \\dfrac{\\Delta t}{\\tau_T} } \\dfrac{1}{T}$ 得到。对于足够小的 $\\Delta t$，由于离散化误差小，所得到分布接近正则分布。\n\nD. 假设一个二阶弛豫 $\\dfrac{d^2 T}{dt^2} = \\dfrac{T_0 - T}{\\tau_T^2}$ 和均匀速度重标度 $\\lambda = 1 + \\dfrac{\\Delta t}{\\tau_T} \\left( \\dfrac{T_0}{T} - 1 \\right)$，这在 $\\Delta t$ 较小时是平方根的近似。不变分布是正则的，因为弛豫的目标是 $T_0$。\n\nE. 在每一步都通过 $\\lambda = \\sqrt{ \\dfrac{T_0}{T} }$（与 $\\Delta t$ 和 $\\tau_T$ 无关）瞬时强制执行目标温度，从而确保麦克斯韦-玻尔兹曼速度分布并因此得到正则系综。",
            "solution": "经评估，该问题陈述有效。它在科学上基于统计力学和计算化学的原理，特别是关于分子动力学模拟中的恒温算法。此问题定义明确、客观，并为唯一的推导和评估提供了充分的基础。\n\n任务是推导 Berendsen 型恒温器的速度重标度因子，并评估其生成的统计系综。\n\n### 速度重标度因子的推导\n\n1.  **连续弛豫定律**：问题假定系统动能温度 $T$ 以特征时间常数 $\\tau_T$ 向目标温度 $T_0$ 进行一阶弛豫。这由以下微分方程描述：\n    $$\n    \\frac{dT}{dt} = \\frac{T_0 - T}{\\tau_T}\n    $$\n\n2.  **离散化**：为了在分子动力学模拟中实现这一点，我们在一个有限的时间步长 $\\Delta t$ 上对该方程进行离散化。最简单直接的方法是前向欧拉格式：\n    $$\n    \\frac{T(t + \\Delta t) - T(t)}{\\Delta t} \\approx \\left. \\frac{dT}{dt} \\right|_t\n    $$\n    设 $T$ 为当前时间步的温度，$T'$ 为重标度后的温度，它代表时间 $t + \\Delta t$ 的温度。代入弛豫定律得到：\n    $$\n    \\frac{T' - T}{\\Delta t} = \\frac{T_0 - T}{\\tau_T}\n    $$\n    求解此步骤的目标温度 $T'$ 可得：\n    $$\n    T' = T + \\frac{\\Delta t}{\\tau_T} (T_0 - T)\n    $$\n\n3.  **与速度重标度的关系**：恒温器通过将所有粒子速度 $\\mathbf{v}_i$ 乘以一个因子 $\\lambda$ 进行均匀缩放来发挥作用，使得新速度为 $\\mathbf{v}'_i = \\lambda \\mathbf{v}_i$。总动能 $K = \\sum_i \\frac{1}{2} m_i v_i^2$ 因此被缩放：\n    $$\n    K' = \\sum_i \\frac{1}{2} m_i (\\lambda v_i)^2 = \\lambda^2 \\sum_i \\frac{1}{2} m_i v_i^2 = \\lambda^2 K\n    $$\n\n4.  **与动能温度的关系**：问题提供了基于能量均分的动能温度定义：$T = \\frac{2K}{f k_B}$，其中 $f$ 是无约束自由度的数量，$k_B$ 是玻尔兹曼常数。由此，新温度 $T'$ 和旧温度 $T$ 之间的关系是：\n    $$\n    T' = \\frac{2K'}{f k_B} = \\frac{2(\\lambda^2 K)}{f k_B} = \\lambda^2 \\left(\\frac{2K}{f k_B}\\right) = \\lambda^2 T\n    $$\n\n5.  **最终推导**：我们将重标度后温度 $T'$ 的两个表达式相等：\n    $$\n    \\lambda^2 T = T + \\frac{\\Delta t}{\\tau_T} (T_0 - T)\n    $$\n    两边除以 $T$ (假设 $T \\neq 0$)：\n    $$\n    \\lambda^2 = 1 + \\frac{\\Delta t}{\\tau_T} \\left( \\frac{T_0}{T} - 1 \\right)\n    $$\n    重标度因子 $\\lambda$ 是此表达式的正平方根：\n    $$\n    \\lambda = \\sqrt{1 + \\frac{\\Delta t}{\\tau_T} \\left( \\frac{T_0}{T} - 1 \\right)}\n    $$\n\n### 对所生成系综的评估\n\n如果相空间中位置和动量的稳态分布符合玻尔兹曼分布 $P(\\mathbf{r}^N, \\mathbf{p}^N) \\propto \\exp(-\\mathcal{H}(\\mathbf{r}^N, \\mathbf{p}^N) / k_B T_0)$，那么恒温器就能正确地生成正则(NVT)系综。正则系综的一个关键特征是其涨落的性质。具体来说，速度分布应为麦克斯韦-玻尔兹曼分布，总动能 $K$ 应遵循Γ分布。正则系综中动能的方差由 $\\langle (\\delta K)^2 \\rangle = \\frac{f}{2} (k_B T_0)^2$ 给出。\n\n如上所推导的 Berendsen 恒温器实现了一个确定性反馈回路。如果动能温度 $T$ 高于目标温度 $T_0$，则 $\\lambda$ 小于1，动能被移除。如果 $T$ 低于 $T_0$，则 $\\lambda$ 大于1，动能被增加。这种比例控制机制主动且确定性地抑制了动能的自然涨落。使用此恒温器模拟得到的 $K$ 的方差将小于正确的正则系综值。\n\n此外，该算法是非哈密顿的，并且不满足细致平衡，而细致平衡是系统轨迹抽样已知统计系综的必要条件。它缺乏适当的涨落-耗散定理平衡；当系统过热时它会耗散能量，但没有包含相应的随机加热项来正确模拟热浴所赋予的涨落。\n\n因此，尽管平均温度 $\\langle T \\rangle$ 会收敛到 $T_0$，但动能的分布是不正确的。由此产生的稳态不能代表一个真正的正则系综。\n\n### 逐项分析\n\n**A. 从一阶弛豫定律 $\\dfrac{dT}{dt} = \\dfrac{T_0 - T}{\\tau_T}$ 开始。通过因子 $\\lambda$ 进行均匀速度重标度可实现映射 $T \\mapsto T' = \\lambda^2 T$。在 $\\Delta t$ 上的前向欧拉离散化给出 $T' = T + \\dfrac{\\Delta t}{\\tau_T} \\left( T_0 - T \\right)$，因此 $\\lambda = \\sqrt{ 1 + \\dfrac{\\Delta t}{\\tau_T} \\left( \\dfrac{T_0}{T} - 1 \\right) }$。由此产生的动力学过程不会生成正则系综：麦克斯韦-玻尔兹曼速度分布不是不变的，因为确定性比例反馈抑制了相对于正则Γ分布的动能（方差为 $\\dfrac{f}{2} (k_B T_0)^2$）的动能涨落，并且不存在涨落-耗散平衡或细致平衡。**\n- $\\lambda$ 的推导与上面的推导完全相同，正确地解释了问题的前提。\n- 对系综的评估也是正确和详尽的。它正确地指出了动能涨落的抑制，引用了正确的正则方差，并阐明了缺乏细致平衡的问题。\n- **结论：正确**\n\n**B. 施加能量守恒 $\\dfrac{dK}{dt} = 0$ 并推断出 $\\lambda = \\sqrt{ 1 - \\dfrac{\\Delta t}{\\tau_T} \\left( \\dfrac{T_0}{T} - 1 \\right) }$。因为平均温度趋近于 $T_0$，根据各遍历性，长时间速度分布是正则的。**\n- “施加能量守恒 dK/dt = 0” 的前提是根本错误的。恒温器的目的恰恰是通过允许模拟系统与外部热浴交换能量来打破其能量守恒。\n- 推导出的 $\\lambda$ 公式符号错误，且基于一个错误的前提。\n- 认为正确的平均温度因各遍历性而意味着正则分布的理由是一个常见但深刻的谬误。各遍历性适用于给定的系综；它不保证任意的动力学过程都会生成一个特定的（例如，正则的）系综。\n- **结论：错误**\n\n**C. 使用能量均分和隐式（后向欧拉）弛豫 $T' - T = \\dfrac{\\Delta t}{\\tau_T} \\left( T_0 - T' \\right)$，因此 $\\lambda$ 可由 $\\lambda^2 = \\dfrac{T'}{T} = \\dfrac{ T + \\dfrac{\\Delta t}{\\tau_T} T_0 }{ 1 + \\dfrac{\\Delta t}{\\tau_T} } \\dfrac{1}{T}$ 得到。对于足够小的 $\\Delta t$，由于离散化误差小，所得到分布接近正则分布。**\n- 该推导使用了后向欧拉格式，这是一种有效但不同于标准前向欧拉的离散化方法。该格式的代数推导是正确的。\n- 然而，关键的缺陷在于对系综的评估。无法生成正则系综是其基础的连续弛豫模型的内在特性，而不是离散化方法的产物。减小 $\\Delta t$ 只会使模拟更好地逼近非正则的 Berendsen 动力学。\n- **结论：错误**\n\n**D. 假设一个二阶弛豫 $\\dfrac{d^2 T}{dt^2} = \\dfrac{T_0 - T}{\\tau_T^2}$ 和均匀速度重标度 $\\lambda = 1 + \\dfrac{\\Delta t}{\\tau_T} \\left( \\dfrac{T_0}{T} - 1 \\right)$，这在 $\\Delta t$ 较小时是平方根的近似。不变分布是正则的，因为弛豫的目标是 $T_0$。**\n- 二阶弛豫的前提与问题陈述相矛盾，问题陈述明确指出是“一阶弛豫”。\n- $\\lambda$ 的公式是对正确结果的不正确近似。$\\sqrt{1+x}$ 的泰勒展开是 $1 + \\frac{1}{2}x - \\dots$。该选项中的公式缺少因子 $\\frac{1}{2}$。\n- 认为以 $T_0$ 为目标就足以生成正则系综的理由是错误的，因为它忽略了涨落。\n- **结论：错误**\n\n**E. 在每一步都通过 $\\lambda = \\sqrt{ \\dfrac{T_0}{T} }$（与 $\\Delta t$ 和 $\\tau_T$ 无关）瞬时强制执行目标温度，从而确保麦克斯韦-玻尔兹曼速度分布并因此得到正则系综。**\n- 这种重标度在每一步都强制使 $T' = T_0$。这对应于 $\\tau_T \\rightarrow \\Delta t$ 的极限或“硬”耦合，与“弱耦合”的前提相矛盾。\n- 声称这“确保了麦克斯韦-玻尔兹曼速度分布并因此得到正则系综”的说法是灾难性错误的。这种方法完全消除了所有的动能涨落，这与正则系综中的行为完全相反。它产生了一个非物理的、与正则系综相去甚远的状态。\n- **结论：错误**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "理论与实践的最终桥梁在于验证。本练习将指导你设计一个统计验证程序，以检验恒温器在实际模拟中是否按预期工作。通过将模拟产生的动能分布与理论上的卡方分布（$\\chi^2$ 分布）进行比较，你将掌握一种用于验证任何恒温器实现正确性的基本计算技术。",
            "id": "5274872",
            "problem": "你的任务是设计并实现一个统计分析，用于在生物分子动力学（MD）中通过恒温器进行温度控制的验证。在正则系综下的基本预期是，总动能的分布应与速度的麦克斯韦-玻尔兹曼分布一致，这意味着动能具有一个特定的分布。你的程序必须从第一性原理构建验证过程，并对每个测试用例给出一个最终判定，判断恒温器是否与理论上预期的分布一致。\n\n从以下基本依据开始：\n- 在温度 $T$ 下的正则系综意味着每个笛卡尔速度分量 $v_i$ 都独立地服从均值为零的高斯分布，其方差由能量均分原理设定。\n- 对于一个具有 $f$ 个二次自由度的系统，总动能 $K$ 是所有独立二次模的总和。\n\n对每个测试用例，按如下方式定义测量的动能值：\n- 令 $f$ 为自由度数，$T$ 为恒温器设定温度（单位为开尔文），$k_{\\mathrm{B}}$ 为玻尔兹曼常数（单位为 $\\mathrm{J/K}$），$n$ 为样本数，$s$ 为一个无量纲比例因子，代表动能的测量或恒温器校准因子。为保证可复现性，通过以下步骤构建一个确定性的合成“测量”数据集 $\\{K_i\\}_{i=1}^n$：首先，在累积概率 $p_i = \\frac{i - 0.5}{n}$ 处，构建具有 $f$ 个自由度的卡方分布的一组无量纲分位数 $\\{Q_i\\}_{i=1}^n$，然后通过 $K_i = \\frac{1}{2} k_{\\mathrm{B}} T \\, s \\, Q_i$ 将它们映射为动能。所有 $K_i$ 必须以焦耳为单位表示。\n\n为验证恒温器：\n- 通过 $X_i = \\frac{2 K_i}{k_{\\mathrm{B}} T}$ 将每个 $K_i$ 归一化为无量纲变量 $X_i$。\n- 在正则系综所蕴含的原假设下，$X_i$ 的分布应与具有 $f$ 个自由度的理论卡方分布相匹配。\n- 执行单样本 Kolmogorov–Smirnov (KS) 检验，将 $\\{X_i\\}$ 的经验分布与具有 $f$ 个自由度的理论卡方累积分布函数进行比较。设检验的显著性水平为 $\\alpha = 0.01$（以小数形式表示）。如果 p 值 $p \\ge \\alpha$，则判定为“通过”（pass），否则判定为“失败”（fail）。\n\n使用精确值 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\,\\mathrm{J/K}$。确保任何以物理单位表示的量都与这些单位保持一致处理。本问题不使用角度。百分比（如有）必须以小数表示。\n\n实现你的解决方案，为以下参数集的测试套件生成结果：\n- 案例 A（理想情况，大 $f$）：$f = 300$, $T = 310\\,\\mathrm{K}$, $n = 1000$, $s = 1.0$。\n- 案例 B（温度校准不准，大 $f$）：$f = 300$, $T = 310\\,\\mathrm{K}$, $n = 1000$, $s = 1.1$。\n- 案例 C（边界情况，小 $f$）：$f = 2$, $T = 300\\,\\mathrm{K}$, $n = 200$, $s = 1.0$。\n- 案例 D（边缘情况，带偏差的小样本）：$f = 60$, $T = 300\\,\\mathrm{K}$, $n = 50$, $s = 1.2$。\n\n你的程序应生成单行输出，其中包含测试套件的布尔值通过/失败结果，按顺序排列，形式为方括号括起来的逗号分隔列表，例如：“[True,False,True,False]”。",
            "solution": "该问题要求设计并实现一个统计验证程序，用于生物分子模拟中的温度控制。该验证基于统计力学的基本原理，适用于正则系综中的系统。解决方案包括生成合成的动能数据，然后使用单样本 Kolmogorov-Smirnov (KS) 检验来评估其与理论分布的一致性。\n\n**理论基础**\n\n在统计力学中，一个与恒定绝对温度 $T$ 的热浴处于热平衡的系统由正则系综描述。该系综的一个关键预测是粒子速度的分布，该分布由麦克斯韦-玻尔兹曼分布决定。对于一个经典系统，每个二次自由度（例如，动能项 $\\frac{1}{2}mv_x^2$ 或势能项 $\\frac{1}{2}kx^2$）的平均能量为 $\\frac{1}{2}k_{\\mathrm{B}}T$，这个结果被称为能量均分定理，其中 $k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n\n一个具有 $f$ 个独立二次自由度的系统的总动能 $K$ 是这些模的能量之和。每个模的能量，当按 $\\frac{1}{k_{\\mathrm{B}}T}$ 缩放时，贡献一个等于标准正态变量平方的项。代表单个模贡献的变量，我们称之为 $Z$，服从自由度为1的卡方分布，即 $\\chi^2(1)$。\n\n因此，定义为变量 $X = \\frac{2K}{k_{\\mathrm{B}}T}$ 的无量纲总动能是 $f$ 个独立的 $\\chi^2(1)$ 变量之和。根据卡方分布的定义，这个和服从具有 $f$ 个自由度的卡方分布，记为 $\\chi^2(f)$。\n\n这个理论结果构成了我们统计检验的原假设（$H_0$）：\n$H_0$：观测到的、归一化的动能数据 $\\{X_i\\}$ 的分布是具有 $f$ 个自由度的卡方分布。\n\n**数据生成与检验程序**\n\n该问题指定了一种确定性方法，用于为具有 $f$ 个自由度、温度为 $T$ 的系统生成一个包含 $n$ 个样本的合成数据集 $\\{K_i\\}_{i=1}^n$。该方法使用一个无量纲比例因子 $s$ 来模拟一个完美校准的恒温器（$s=1.0$）或一个校准不准的恒温器（$s \\neq 1.0$）。\n\n1.  **分位数生成**：首先使用公式 $p_i = \\frac{i - 0.5}{n}$（其中 $i=1, 2, \\dots, n$）生成一组包含 $n$ 个累积概率的集合 $\\{p_i\\}$。这种概率选择方式对称地对分布的分位数进行采样。\n\n2.  **卡方分位数**：对于每个概率 $p_i$，计算理论 $\\chi^2(f)$ 分布对应的分位数 $Q_i$。分位数 $Q_i$ 是这样一个值，使得 $\\chi^2(f)$ 分布在 $Q_i$ 处的累积分布函数（CDF）等于 $p_i$。\n\n3.  **动能合成**：“测量”的动能 $\\{K_i\\}$ 接着通过以下关系合成：\n    $$K_i = \\frac{1}{2} k_{\\mathrm{B}} T s Q_i$$\n    在这里，$s$ 作为一个校准因子。如果 $s=1.0$，则期望动能与温度之间的关系被完美满足。如果 $s > 1.0$ 或 $s < 1.0$，则分别意味着对温度的系统性高估或低估。\n\n4.  **归一化**：为了执行统计检验，每个合成的动能值 $K_i$ 根据我们的理论预期进行归一化：\n    $$X_i = \\frac{2 K_i}{k_{\\mathrm{B}} T}$$\n    将上一步中 $K_i$ 的表达式代入，我们发现检验样本与理论分位数之间的直接关系：\n    $$X_i = \\frac{2}{k_{\\mathrm{B}} T} \\left( \\frac{1}{2} k_{\\mathrm{B}} T s Q_i \\right) = s Q_i$$\n    这揭示了待检验的样本 $\\{X_i\\}$ 就是理论分位数集合 $\\{Q_i\\}$ 按因子 $s$ 缩放后的结果。\n\n5.  **Kolmogorov-Smirnov 检验**：对生成的样本 $\\{X_i\\}$ 应用单样本 KS 检验。该检验将样本的经验累积分布函数（ECDF）$\\hat{F}_n(x)$ 与 $\\chi^2(f)$ 分布的理论累积分布函数（CDF）$F_{\\chi^2(f)}(x)$ 进行比较。检验统计量是这两个函数在 $x$ 的整个范围内的最大绝对差。根据该统计量计算出一个 p 值，它表示在原假设为真的前提下，观测到至少与测量到的偏差一样大的偏差的概率。\n\n6.  **判定**：如果计算出的 p 值 $p$ 大于或等于指定的显著性水平 $\\alpha = 0.01$，则认为恒温器与正则系综一致（“通过”，pass）。否则，为“失败”（fail）。高 p 值（$p \\ge \\alpha$）表明观测数据与原假设一致，而低 p 值（$p < \\alpha$）则为拒绝原假设提供了证据。\n\n在 $s=1.0$ 的情况下，样本 $\\{X_i\\}$ 与 $\\{Q_i\\}$ 相同，根据构造，它应该紧密地遵循 $\\chi^2(f)$ 分布，从而导致一个大的 p 值和“通过”的判定。在 $s \\neq 1.0$ 的情况下，样本分布是理论分布的一个缩放版本，KS 检验预期会检测到这种差异，从而导致一个低的 p 值和“失败”的判定，特别是当样本量 $n$ 足够大时。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Validates thermostat performance in biomolecular simulations by testing\n    if synthetic kinetic energy data conforms to the theoretical chi-square\n    distribution, as predicted by the canonical ensemble.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (f, T, n, s)\n    # f: degrees of freedom\n    # T: temperature (K)\n    # n: sample count\n    # s: dimensionless scaling factor\n    test_cases = [\n        (300, 310.0, 1000, 1.0),  # Case A: happy path, large f\n        (300, 310.0, 1000, 1.1),  # Case B: miscalibrated temperature, large f\n        (2, 300.0, 200, 1.0),    # Case C: boundary, small f\n        (60, 300.0, 50, 1.2),     # Case D: edge case, small sample with deviation\n    ]\n\n    # Physical and statistical constants\n    k_B = 1.380649e-23  # Boltzmann constant in J/K\n    alpha = 0.01        # Significance level for the KS test\n\n    results = []\n    for f, T, n, s in test_cases:\n        # Step 1: Generate synthetic \"measured\" data\n        # Create a set of n cumulative probabilities\n        probabilities = (np.arange(1, n + 1) - 0.5) / n\n\n        # Generate the corresponding quantiles of the chi-square distribution\n        # with f degrees of freedom. These are the Q_i values.\n        # ppf is the Percent Point Function (inverse of CDF).\n        q_i = stats.chi2.ppf(probabilities, df=f)\n\n        # According to the problem statement, K_i = 0.5 * k_B * T * s * q_i.\n        # The validation requires normalizing K_i to X_i = 2 * K_i / (k_B * T).\n        # Substituting K_i, we get X_i = s * q_i.\n        # This is more numerically stable than calculating K_i explicitly.\n        x_samples = s * q_i\n        \n        # Step 2: Perform the one-sample Kolmogorov-Smirnov test\n        # We test the sample `x_samples` against the theoretical chi-square\n        # distribution with `f` degrees of freedom.\n        # `stats.chi2.cdf` is the cumulative distribution function for chi-square.\n        # `args=(f,)` passes the degrees of freedom to the cdf.\n        ks_result = stats.ks_1samp(x_samples, stats.chi2.cdf, args=(f,))\n        \n        p_value = ks_result.pvalue\n\n        # Step 3: Make a decision based on the p-value\n        # \"pass\" if p-value is greater than or equal to the significance level.\n        # Python's boolean True/False corresponds to pass/fail.\n        decision = (p_value >= alpha)\n        results.append(decision)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) converts boolean True/False to \"True\"/\"False\" strings.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}