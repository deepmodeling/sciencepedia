{
    "hands_on_practices": [
        {
            "introduction": "A key feature of the Nosé-Hoover thermostat is its ability to generate states that correctly sample the canonical ensemble. This means it must not only maintain the correct average temperature but also reproduce the proper thermal fluctuations. This foundational exercise guides you through deriving two central properties from first principles: the expected variance of the kinetic energy, $\\mathrm{Var}(K)$, in the canonical ensemble, and the characteristic frequency of the thermostat, $\\omega_{Q}$, which governs its dynamical response . Mastering this connection between statistical mechanics and dynamics is the first step toward a deep understanding of how the thermostat functions.",
            "id": "3788475",
            "problem": "Consider a classical system with $f$ independent quadratic degrees of freedom in contact with a Nosé–Hoover thermostat at temperature $T$. Let $K$ denote the instantaneous kinetic energy. Assume canonical sampling is achieved at equilibrium. Starting from first principles of the canonical ensemble and the Maxwell–Boltzmann distribution, derive a closed-form expression for the variance $\\mathrm{Var}(K)$ in terms of $f$, the Boltzmann constant $k_{B}$, and $T$. Next, consider the standard Nosé–Hoover equations of motion for a system with coordinates $q_{i}$, momenta $p_{i}$, masses $m_{i}$, forces $F_{i}$, and thermostat friction variable $\\xi$ with thermostat mass parameter $Q$:\n$$\n\\dot{q}_{i}=\\frac{p_{i}}{m_{i}},\\qquad\n\\dot{p}_{i}=F_{i}-\\xi\\,p_{i},\\qquad\n\\dot{\\xi}=\\frac{1}{Q}\\left(2K-f\\,k_{B}T\\right).\n$$\nLinearize these equations about thermal equilibrium, where $K=\\langle K\\rangle$ and $\\xi=0$, to obtain the characteristic angular frequency $\\omega_{Q}$ that governs small-amplitude exchanges of kinetic energy between the system and the thermostat. Treat the reversible virial term $\\sum_{i} v_{i}F_{i}$ as rapidly fluctuating and averaging to zero on the thermostat timescale so that the leading-order coupling of $K$ to $\\xi$ dominates the slow envelope dynamics. Express $\\omega_{Q}$ in terms of $f$, $k_{B}$, $T$, and $Q$. Briefly interpret how $Q$ filters kinetic energy fluctuations in a multiscale sense by setting the exchange timescale.\n\nExpress your final answer as a two-entry row matrix $\\big[\\mathrm{Var}(K),\\ \\omega_{Q}\\big]$. Report $\\mathrm{Var}(K)$ in squared energy and $\\omega_{Q}$ in radians per unit time. Do not include units in the boxed answer. No numerical substitution is required; provide exact symbolic expressions only.",
            "solution": "The problem consists of two parts. First, we derive the variance of the kinetic energy, $\\mathrm{Var}(K)$, for a system in the canonical ensemble. Second, we linearize the Nosé-Hoover equations of motion to find the characteristic frequency of energy exchange, $\\omega_{Q}$.\n\nPart 1: Derivation of the Variance of Kinetic Energy, $\\mathrm{Var}(K)$\n\nWe begin from the principles of the canonical ensemble. For a classical system with $f$ independent quadratic degrees of freedom, the total kinetic energy is given by $K = \\sum_{j=1}^{f} \\epsilon_j$, where each $\\epsilon_j$ is the kinetic energy associated with one degree of freedom (e.g., $\\frac{p_x^2}{2m}$).\n\nIn the canonical ensemble at temperature $T$, the probability distribution of momentum for a single degree of freedom is given by the Maxwell-Boltzmann distribution, which is a Gaussian distribution. The corresponding kinetic energy $\\epsilon$ for that degree of freedom has a probability distribution that can be derived from it. This distribution is a Gamma distribution, $\\Gamma(k, \\theta)$, with shape parameter $k = 1/2$ and scale parameter $\\theta = k_B T$. The probability density function for $\\epsilon$ is:\n$$\nP(\\epsilon) = \\frac{1}{\\Gamma(1/2)(k_B T)^{1/2}} \\epsilon^{1/2 - 1} \\exp\\left(-\\frac{\\epsilon}{k_B T}\\right)\n$$\nwhere $\\Gamma(1/2) = \\sqrt{\\pi}$.\n\nThe total kinetic energy $K$ is the sum of $f$ such independent and identically distributed random variables. A key property of the Gamma distribution is that the sum of independent Gamma-distributed variables with the same scale parameter $\\theta$ is also a Gamma-distributed variable. The new shape parameter is the sum of the individual shape parameters. Therefore, $K$ follows a Gamma distribution with shape parameter $k_K = \\sum_{j=1}^{f} (1/2) = f/2$ and scale parameter $\\theta_K = k_B T$. The probability density function for $K$ is:\n$$\nP(K) = \\frac{1}{\\Gamma(f/2)(k_B T)^{f/2}} K^{f/2 - 1} \\exp\\left(-\\frac{K}{k_B T}\\right)\n$$\nFor a Gamma distribution $\\Gamma(k, \\theta)$, the mean is $\\langle X \\rangle = k\\theta$ and the variance is $\\mathrm{Var}(X) = k\\theta^2$. Applying this to the distribution of $K$, we find the mean kinetic energy:\n$$\n\\langle K \\rangle = k_K \\theta_K = \\left(\\frac{f}{2}\\right)(k_B T) = \\frac{f}{2}k_B T\n$$\nThis result is the well-known equipartition theorem. The variance of the kinetic energy is:\n$$\n\\mathrm{Var}(K) = k_K \\theta_K^2 = \\left(\\frac{f}{2}\\right)(k_B T)^2 = \\frac{f}{2}k_B^2 T^2\n$$\nThis expression gives the variance of the kinetic energy in terms of the number of degrees of freedom $f$, the Boltzmann constant $k_B$, and the temperature $T$.\n\nPart 2: Derivation of the Characteristic Frequency, $\\omega_{Q}$\n\nWe are given the standard Nosé-Hoover equations of motion:\n$$\n\\dot{q}_{i}=\\frac{p_{i}}{m_{i}}, \\qquad \\dot{p}_{i}=F_{i}-\\xi p_{i}, \\qquad \\dot{\\xi}=\\frac{1}{Q}\\left(2K-f k_{B}T\\right)\n$$\nWe need to find the equation of motion for the kinetic energy $K = \\sum_{i} \\frac{p_{i}^2}{2m_{i}}$. Taking the time derivative of $K$:\n$$\n\\dot{K} = \\sum_{i} \\frac{p_{i}}{m_{i}} \\dot{p}_{i} = \\sum_{i} v_{i} \\dot{p}_{i}\n$$\nSubstituting the expression for $\\dot{p}_{i}$:\n$$\n\\dot{K} = \\sum_{i} v_{i} (F_{i} - \\xi p_{i}) = \\sum_{i} v_{i}F_{i} - \\xi \\sum_{i} v_{i}p_{i}\n$$\nRecognizing that $v_{i} = p_{i}/m_{i}$, the second term becomes $\\xi \\sum_{i} p_{i}^2/m_{i} = 2\\xi \\sum_{i} p_{i}^2/(2m_{i}) = 2\\xi K$. Thus, the dynamics of $K$ and $\\xi$ are described by the coupled system:\n$$\n\\dot{K} = \\sum_{i} v_{i}F_{i} - 2\\xi K\n$$\n$$\n\\dot{\\xi} = \\frac{1}{Q}(2K - f k_B T)\n$$\nWe linearize this system around the thermal equilibrium fixed point, which is characterized by $\\langle \\xi \\rangle = 0$ and $\\langle K \\rangle = \\frac{f}{2}k_B T$. Let the fluctuations around this point be $\\delta\\xi = \\xi - \\langle \\xi \\rangle = \\xi$ and $\\delta K = K - \\langle K \\rangle$.\nThe equations for the fluctuations are:\n$$\n\\dot{(\\delta K)} = \\dot{K} = \\sum_{i} v_{i}F_{i} - 2(\\delta\\xi)(\\delta K + \\langle K \\rangle)\n$$\n$$\n\\dot{(\\delta\\xi)} = \\dot{\\xi} = \\frac{1}{Q}(2(\\delta K + \\langle K \\rangle) - f k_B T) = \\frac{1}{Q}(2\\delta K + 2\\langle K \\rangle - f k_B T)\n$$\nSubstituting $\\langle K \\rangle = \\frac{f}{2}k_B T$ into the second equation simplifies it:\n$$\n\\dot{(\\delta\\xi)} = \\frac{1}{Q}(2\\delta K + f k_B T - f k_B T) = \\frac{2}{Q}\\delta K\n$$\nThis is the first linearized equation. For the $\\dot{(\\delta K)}$ equation, we linearize by neglecting second-order terms in the fluctuations, i.e., the term $-2(\\delta\\xi)(\\delta K)$. The problem also states to treat the reversible virial term $\\sum_{i} v_{i}F_{i}$ as a fast fluctuating term that can be neglected when analyzing the slow dynamics of the thermostat. This yields:\n$$\n\\dot{(\\delta K)} \\approx -2\\langle K \\rangle \\delta\\xi\n$$\nSubstituting the value of $\\langle K \\rangle$:\n$$\n\\dot{(\\delta K)} = -2\\left(\\frac{f}{2}k_B T\\right)\\delta\\xi = -f k_B T \\delta\\xi\n$$\nWe now have a system of two coupled linear ordinary differential equations:\n$$\n(1) \\qquad \\dot{(\\delta K)} = -f k_B T \\delta\\xi\n$$\n$$\n(2) \\qquad \\dot{(\\delta \\xi)} = \\frac{2}{Q} \\delta K\n$$\nTo find the characteristic frequency, we combine them into a single second-order equation. Differentiating equation (2) with respect to time gives:\n$$\n\\ddot{(\\delta \\xi)} = \\frac{2}{Q} \\dot{(\\delta K)}\n$$\nSubstituting equation (1) into this expression:\n$$\n\\ddot{(\\delta \\xi)} = \\frac{2}{Q}(-f k_B T \\delta\\xi) = -\\left(\\frac{2f k_B T}{Q}\\right)\\delta\\xi\n$$\nThis is the standard form of the simple harmonic oscillator equation, $\\ddot{x} = -\\omega^2 x$. By comparison, the square of the characteristic angular frequency is:\n$$\n\\omega_{Q}^2 = \\frac{2f k_B T}{Q}\n$$\nTherefore, the characteristic angular frequency is:\n$$\n\\omega_{Q} = \\sqrt{\\frac{2f k_B T}{Q}}\n$$\nThe parameter $Q$, often called the thermostat \"mass,\" controls the timescale of energy exchange. A large value of $Q$ results in a small $\\omega_{Q}$ and a long period of oscillation, meaning the energy exchange between the system and the thermostat is slow. The thermostat is \"heavy\" and does not closely follow rapid fluctuations in the system's kinetic energy. Conversely, a small $Q$ leads to a large $\\omega_{Q}$ and a fast response, tightly coupling the system to the thermostat. In a multiscale simulation, $Q$ is chosen to set the thermostat's response timescale $\\tau_Q \\sim 1/\\omega_Q$ to be slower than the fastest physical motions in the system but faster than the timescale of the phenomena under investigation, effectively filtering the kinetic energy fluctuations at a desired frequency.\n\nCombining the two results into the requested matrix form provides the final answer.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{f}{2}k_{B}^{2}T^{2}  \\sqrt{\\frac{2f k_{B} T}{Q}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Building on the theoretical groundwork, this practice transitions to the crucial task of parameterization. The thermostat's behavior is controlled by its \"mass\" parameter, $Q$, which dictates how quickly it responds to thermal fluctuations. In this problem, you will use the method of linearizing the equations of motion to derive the direct relationship between $Q$ and the thermostat's characteristic relaxation time, $\\tau$ . This exercise provides a concrete method for tuning the thermostat to achieve a desired coupling strength, a fundamental skill for setting up stable and physically meaningful molecular dynamics simulations.",
            "id": "3827427",
            "problem": "In a concurrent multiscale materials simulation, a molecular dynamics subdomain of a three-dimensional monatomic material is weakly coupled to a continuum model. The molecular region is thermostatted by a single-variable Nosé–Hoover thermostat to maintain a target temperature while allowing proper canonical fluctuations. Consider a subsystem of $N$ identical atoms with positions $\\{\\mathbf{r}_i\\}$, momenta $\\{\\mathbf{p}_i\\}$, and mass $m$, with the total center-of-mass momentum constrained to zero. The equations of motion of the Nosé–Hoover thermostat are\n$$\n\\dot{\\mathbf{r}}_i = \\frac{\\mathbf{p}_i}{m}, \\quad\n\\dot{\\mathbf{p}}_i = \\mathbf{F}_i - \\xi \\,\\mathbf{p}_i, \\quad\n\\dot{\\xi} = \\frac{2K - g k_B T}{Q},\n$$\nwhere $K = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i^2}{2m}$ is the instantaneous kinetic energy, $g$ is the number of quadratic degrees of freedom effectively thermostatted, $k_B$ is the Boltzmann constant, $T$ is the target temperature, and $Q$ is the thermostat mass parameter. For a three-dimensional system with center-of-mass momentum constrained, take $g = 3N - 3$.\n\nAssume you are interested in selecting $Q$ to obtain a desired characteristic relaxation time for kinetic-energy fluctuations. Define the characteristic relaxation time $\\tau$ to be the inverse of the linearized angular frequency of small oscillations of $\\xi$ and $K$ about their equilibrium values.\n\nStarting only from (i) Newton’s second law, (ii) the above equations of motion, and (iii) the equipartition theorem for quadratic degrees of freedom, linearize the dynamics about the canonical equilibrium and derive an analytic expression for $Q$ in terms of $g$, $k_B$, $T$, and $\\tau$. In your derivation, justify treating the instantaneous power $\\sum_i \\mathbf{v}_i \\cdot \\mathbf{F}_i$ as negligible to first order on the thermostat timescale when extracting the characteristic frequency.\n\nThen evaluate your expression numerically for $N = 100$, $T = 300\\,\\mathrm{K}$, and $\\tau = 0.1\\,\\mathrm{ps}$, using $k_B = 1.380\\,649 \\times 10^{-23}\\,\\mathrm{J/K}$. Express the final value of $Q$ in Joule-second squared ($\\mathrm{J}\\cdot\\mathrm{s}^2$) and round your numerical answer to four significant figures.",
            "solution": "The problem requires the derivation of an expression for the Nosé-Hoover thermostat mass parameter, $Q$, and its numerical evaluation. The derivation begins by establishing the equations of motion for the system's kinetic energy, $K$, and the thermostat variable, $\\xi$.\n\nThe instantaneous kinetic energy of the system is defined as $K = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i^2}{2m}$. We find its time evolution by differentiation:\n$$\n\\dot{K} = \\frac{dK}{dt} = \\sum_{i=1}^{N} \\frac{d}{dt} \\left( \\frac{\\mathbf{p}_i \\cdot \\mathbf{p}_i}{2m} \\right) = \\sum_{i=1}^{N} \\frac{2 \\mathbf{p}_i \\cdot \\dot{\\mathbf{p}}_i}{2m} = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i}{m} \\cdot \\dot{\\mathbf{p}}_i = \\sum_{i=1}^{N} \\mathbf{v}_i \\cdot \\dot{\\mathbf{p}}_i\n$$\nSubstituting the equation of motion for the momentum, $\\dot{\\mathbf{p}}_i = \\mathbf{F}_i - \\xi \\mathbf{p}_i$, we get:\n$$\n\\dot{K} = \\sum_{i=1}^{N} \\mathbf{v}_i \\cdot (\\mathbf{F}_i - \\xi \\mathbf{p}_i) = \\sum_{i=1}^{N} \\mathbf{v}_i \\cdot \\mathbf{F}_i - \\xi \\sum_{i=1}^{N} \\mathbf{v}_i \\cdot \\mathbf{p}_i\n$$\nSince $\\mathbf{p}_i = m\\mathbf{v}_i$, the second term becomes $\\xi \\sum_{i=1}^{N} m \\mathbf{v}_i^2 = \\xi \\sum_{i=1}^{N} 2 \\left(\\frac{m\\mathbf{v}_i^2}{2}\\right) = 2\\xi \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i^2}{2m} = 2\\xi K$.\nThus, the coupled equations of motion for $K$ and $\\xi$ are:\n$$\n\\dot{K} = \\sum_{i=1}^{N} \\mathbf{v}_i \\cdot \\mathbf{F}_i - 2\\xi K\n$$\n$$\n\\dot{\\xi} = \\frac{2K - g k_B T}{Q}\n$$\nWe linearize these equations around the canonical equilibrium point. At equilibrium, the system is stationary in a statistical sense. From the equipartition theorem, the average kinetic energy is $\\langle K \\rangle = K_0 = \\frac{g}{2} k_B T$. For the thermostat to maintain this equilibrium, the average value of the thermostat variable must be zero, $\\langle \\xi \\rangle = \\xi_0 = 0$.\n\nLet's consider small fluctuations around this equilibrium:\n$$\nK(t) = K_0 + \\delta K(t)\n$$\n$$\n\\xi(t) = \\xi_0 + \\delta \\xi(t) = \\delta \\xi(t)\n$$\nSubstituting these into the equation for $\\dot{\\xi}$:\n$$\n\\dot{\\delta \\xi} = \\frac{2(K_0 + \\delta K) - g k_B T}{Q} = \\frac{2K_0 - g k_B T + 2\\delta K}{Q}\n$$\nSince $2K_0 = 2(\\frac{g}{2} k_B T) = g k_B T$, the equation simplifies to:\n$$\n\\dot{\\delta \\xi} = \\frac{2\\delta K}{Q}\n$$\nThis equation is already linear in the fluctuation variables.\n\nNext, we linearize the equation for $\\dot{K}$. Taking the time derivative of $K(t) = K_0 + \\delta K(t)$ gives $\\dot{K} = \\dot{\\delta K}$ as $K_0$ is a constant.\n$$\n\\dot{\\delta K} = \\sum_{i=1}^{N} \\mathbf{v}_i \\cdot \\mathbf{F}_i - 2(\\delta \\xi)(K_0 + \\delta K)\n$$\nTo linearize, we keep only terms of first order in the small quantities $\\delta K$ and $\\delta \\xi$. The term $2(\\delta \\xi)(\\delta K)$ is second order and is neglected.\n$$\n\\dot{\\delta K} \\approx \\sum_{i=1}^{N} \\mathbf{v}_i \\cdot \\mathbf{F}_i - 2K_0 \\delta \\xi\n$$\nThe term $P_F = \\sum_i \\mathbf{v}_i \\cdot \\mathbf{F}_i$ is the instantaneous power supplied by the internal forces. This quantity fluctuates very rapidly, on the characteristic timescale of atomic vibrations (femtoseconds). The thermostat is designed to operate on a longer characteristic timescale, $\\tau$. We are interested in the slow, collective oscillations of the coupled $K$-$\\xi$ system, which determine this timescale. When analyzing these slow dynamics, we can average over the fast microscopic fluctuations. The term $P_F$ fluctuates around a mean of zero at equilibrium and is largely uncorrelated with the slow variables $\\delta K$ and $\\delta \\xi$. Therefore, in the first-order approximation for the slow dynamics, this fast-fluctuating term acts as a noise source and can be neglected when determining the characteristic frequency of the deterministic part of the system's response. The linearized equation for $\\delta K$ thus becomes:\n$$\n\\dot{\\delta K} \\approx -2K_0 \\delta \\xi\n$$\nWe now have a system of two coupled linear ordinary differential equations:\n1. $\\dot{\\delta K} = -2K_0 \\delta \\xi$\n2. $\\dot{\\delta \\xi} = \\frac{2}{Q} \\delta K$\n\nTo solve this system, we can differentiate equation (1) with respect to time:\n$$\n\\ddot{\\delta K} = -2K_0 \\dot{\\delta \\xi}\n$$\nNow substitute equation (2) into this expression:\n$$\n\\ddot{\\delta K} = -2K_0 \\left(\\frac{2}{Q} \\delta K\\right) = -\\frac{4K_0}{Q} \\delta K\n$$\nThis is the equation of a simple harmonic oscillator, $\\ddot{x} = -\\omega^2 x$, where $x$ corresponds to $\\delta K$ and the squared angular frequency $\\omega^2$ is:\n$$\n\\omega^2 = \\frac{4K_0}{Q}\n$$\nThe problem defines the characteristic relaxation time $\\tau$ as the inverse of this angular frequency, $\\tau = \\frac{1}{\\omega}$. Therefore, $\\omega^2 = \\frac{1}{\\tau^2}$.\n$$\n\\frac{1}{\\tau^2} = \\frac{4K_0}{Q}\n$$\nSolving for $Q$ and substituting $K_0 = \\frac{g}{2} k_B T$:\n$$\nQ = 4K_0 \\tau^2 = 4\\left(\\frac{g}{2} k_B T\\right)\\tau^2 = 2g k_B T \\tau^2\n$$\nThis is the desired analytic expression for $Q$.\n\nFor the numerical evaluation, we are given:\n- Number of atoms $N = 100$\n- Target temperature $T = 300\\,\\mathrm{K}$\n- Relaxation time $\\tau = 0.1\\,\\mathrm{ps} = 0.1 \\times 10^{-12}\\,\\mathrm{s} = 10^{-13}\\,\\mathrm{s}$\n- Boltzmann constant $k_B = 1.380\\,649 \\times 10^{-23}\\,\\mathrm{J/K}$\n\nFirst, we calculate the number of degrees of freedom, $g$:\n$$\ng = 3N - 3 = 3(100) - 3 = 297\n$$\nNow, substitute the values into the expression for $Q$:\n$$\nQ = 2 \\cdot (297) \\cdot (1.380\\,649 \\times 10^{-23}\\,\\mathrm{J/K}) \\cdot (300\\,\\mathrm{K}) \\cdot (10^{-13}\\,\\mathrm{s})^2\n$$\n$$\nQ = (2 \\cdot 297 \\cdot 300) \\cdot (1.380\\,649 \\times 10^{-23}) \\cdot (10^{-26})\\,\\mathrm{J \\cdot s^2}\n$$\n$$\nQ = (178\\,200) \\cdot (1.380\\,649 \\times 10^{-49})\\,\\mathrm{J \\cdot s^2}\n$$\n$$\nQ = (1.782 \\times 10^5) \\cdot (1.380\\,649 \\times 10^{-49})\\,\\mathrm{J \\cdot s^2}\n$$\n$$\nQ = (1.782 \\cdot 1.380\\,649) \\times 10^{5-49}\\,\\mathrm{J \\cdot s^2}\n$$\n$$\nQ = 2.460\\,316518 \\times 10^{-44}\\,\\mathrm{J \\cdot s^2}\n$$\nRounding to four significant figures, we obtain:\n$$\nQ \\approx 2.460 \\times 10^{-44}\\,\\mathrm{J \\cdot s^2}\n$$",
            "answer": "$$\\boxed{2.460 \\times 10^{-44}}$$"
        },
        {
            "introduction": "This final practice integrates theory and numerical methods into a complete, realistic workflow for parameterizing the thermostat. To prevent unphysical energy transfer or numerical instability, the thermostat's response frequency, $\\omega_{\\mathrm{NH}}$, must be chosen to avoid resonance with the intrinsic vibrational frequencies of the simulated system. This coding exercise walks you through the process of extracting a system's dominant frequency from its velocity data using spectral analysis and then using this information to calculate the appropriate thermostat mass, $Q$ . Successfully completing this task demonstrates a mastery of the practical, intelligent application of the Nosé-Hoover thermostat in a computational setting.",
            "id": "3827445",
            "problem": "Consider a model system in multiscale materials simulation coupled to a Nosé-Hoover thermostat (NHT). The NHT introduces a thermostat variable that exchanges energy with the physical degrees of freedom. From first principles of mechanics and thermodynamics, the NHT can be understood to impose a characteristic energy-exchange timescale and corresponding angular frequency. In order to avoid resonant interference with the system's intrinsic vibrational modes, one commonly designs the NHT so that its natural angular frequency is a fixed fraction of the dominant physical angular frequency extracted from the system's velocity signal through spectral analysis.\n\nYour task is to write a complete, runnable program that, for each test case below, performs the following steps in a scientifically sound and numerically self-consistent manner:\n\n- Generate a synthetic single-degree-of-freedom velocity time series $v(t)$ as a sum of sinusoidal components with specified amplitudes and frequencies, sampled uniformly in time with step size $\\Delta t$ over $N$ samples. Use no noise and zero mean.\n- Compute the dominant physical angular frequency $\\omega_{\\mathrm{dom}}$ by estimating the power spectral density via a discrete Fourier transform, applying a suitable window to mitigate spectral leakage, and extracting the strongest peak frequency in hertz. Convert the peak to angular frequency using $\\omega = 2\\pi f$. Exclude any zero-frequency (direct current) contribution.\n- Choose the NHT parameter $Q$ (the thermostat \"mass\") such that the thermostat's natural angular frequency $\\omega_{\\mathrm{NH}}$ is a specified fraction $\\rho$ of the dominant physical angular frequency, that is $\\omega_{\\mathrm{NH}} = \\rho \\,\\omega_{\\mathrm{dom}}$. Here $Q$ must be derived from first principles; the final value must be expressed in International System of Units (SI) joule-seconds-squared, that is $\\mathrm{J}\\cdot\\mathrm{s}^2$.\n- Use the Boltzmann constant $k_{\\mathrm{B}} = 1.380649\\times 10^{-23}$ in SI units of joules per kelvin and treat the number of thermostat-coupled degrees of freedom $N_{\\mathrm{f}}$ and the absolute temperature $T$ (in kelvin) as given.\n\nAll numerical outputs must be in SI units. Frequencies must be in hertz when computed from the discrete Fourier transform, angles and angular frequencies must be in radians and radians per second respectively. The final $Q$ must be output in $\\mathrm{J}\\cdot\\mathrm{s}^2$.\n\nImplement careful numerical handling:\n- Use a window function to reduce leakage when computing the spectrum.\n- Exclude the zero-frequency bin when searching for the dominant peak.\n- Refine the peak location via a locally quadratic (parabolic) interpolation using the peak bin and its immediate neighbors to improve the frequency estimate.\n- Convert the refined frequency to an angular frequency and compute $Q$ accordingly from first principles.\n\nTest Suite:\nFor each case, synthesize $v(t) = \\sum_i A_i \\sin(2\\pi f_i t)$ with the parameters below. Here $A_i$ are amplitudes in $\\mathrm{m/s}$, $f_i$ are frequencies in $\\mathrm{Hz}$, $\\Delta t$ is the sample spacing in $\\mathrm{s}$, $N$ is the number of samples, $N_{\\mathrm{f}}$ is the number of coupled degrees of freedom (dimensionless), $T$ is the temperature in $\\mathrm{K}$, and $\\rho$ is the dimensionless ratio relating $\\omega_{\\mathrm{NH}}$ to $\\omega_{\\mathrm{dom}}$.\n\n- Case $1$ (happy path):\n  - $\\Delta t = 2.5\\times 10^{-16}\\ \\mathrm{s}$, $N = 16384$,\n  - Modes: $A_1 = 1.0\\ \\mathrm{m/s}$ at $f_1 = 1.0\\times 10^{12}\\ \\mathrm{Hz}$; $A_2 = 0.5\\ \\mathrm{m/s}$ at $f_2 = 3.0\\times 10^{12}\\ \\mathrm{Hz}$,\n  - $N_{\\mathrm{f}} = 12$, $T = 300$, $\\rho = 0.2$.\n- Case $2$ (close peaks coverage):\n  - $\\Delta t = 2.5\\times 10^{-16}\\ \\mathrm{s}$, $N = 16384$,\n  - Modes: $A_1 = 0.9\\ \\mathrm{m/s}$ at $f_1 = 1.0\\times 10^{12}\\ \\mathrm{Hz}$; $A_2 = 1.0\\ \\mathrm{m/s}$ at $f_2 = 1.2\\times 10^{12}\\ \\mathrm{Hz}$; $A_3 = 0.4\\ \\mathrm{m/s}$ at $f_3 = 4.0\\times 10^{12}\\ \\mathrm{Hz}$,\n  - $N_{\\mathrm{f}} = 6$, $T = 100$, $\\rho = 0.5$.\n- Case $3$ (edge case with widely separated scales):\n  - $\\Delta t = 5.0\\times 10^{-16}\\ \\mathrm{s}$, $N = 16384$,\n  - Modes: $A_1 = 0.8\\ \\mathrm{m/s}$ at $f_1 = 5.0\\times 10^{10}\\ \\mathrm{Hz}$; $A_2 = 0.3\\ \\mathrm{m/s}$ at $f_2 = 1.0\\times 10^{13}\\ \\mathrm{Hz}$,\n  - $N_{\\mathrm{f}} = 24$, $T = 1000$, $\\rho = 0.1$.\n\nYour program should produce a single line of output containing the three $Q$ values as a comma-separated list enclosed in square brackets, in the order of the cases above, for example $[q_1,q_2,q_3]$, where each $q_i$ is a floating-point number in $\\mathrm{J}\\cdot\\mathrm{s}^2$.\n\nNo external input is allowed; all parameters must be encoded in the program. The algorithm must be general and not hard-coded to the expected peak bins. The dominant angular frequency must be extracted from the synthetic signals by spectral analysis as described above, and $Q$ must be computed from first principles, not by using any pre-specified shortcut formula in the problem statement.",
            "solution": "The objective is to compute the thermostat mass parameter, $Q$, for a Nosé-Hoover thermostat (NHT) such that its natural frequency is a specified fraction of the dominant vibrational frequency of the physical system. This requires a two-part process: first, the derivation of the formula for $Q$ from the principles of statistical mechanics governing the NHT; and second, the numerical determination of the system's dominant frequency, $\\omega_{\\mathrm{dom}}$, from a synthetic velocity time series.\n\n### Step 1: Theoretical Derivation of the Thermostat Mass $Q$\n\nThe Nosé-Hoover thermostat couples a physical system to a thermal reservoir by introducing an extended phase-space variable, $\\zeta$, which can be interpreted as a friction coefficient. The dynamics of this thermostat variable are governed by the following equation of motion:\n$$ \\dot{\\zeta} = \\frac{1}{Q} \\left( \\sum_{i=1}^{N_{particles}} \\frac{\\mathbf{p}_i^2}{m_i} - N_{\\mathrm{f}} k_{\\mathrm{B}} T \\right) $$\nwhere $Q$ is the thermostat mass, $\\mathbf{p}_i$ and $m_i$ are the momenta and masses of the system's particles, $k_{\\mathrm{B}}$ is the Boltzmann constant, $T$ is the target absolute temperature, and $N_{\\mathrm{f}}$ is the number of thermostatted degrees of freedom. The sum represents the instantaneous kinetic energy of the system, which can be written as $K(t)$. The target average kinetic energy is $\\langle K \\rangle = \\frac{1}{2} N_{\\mathrm{f}} k_{\\mathrm{B}} T$. The equation is more commonly written with the factor of $2$ as:\n$$ \\dot{\\zeta} = \\frac{1}{Q} \\left( 2K(t) - N_{\\mathrm{f}} k_{\\mathrm{B}} T \\right) $$\nThis equation ensures that if the kinetic energy is higher than its target value, $\\zeta$ increases, applying a stronger drag force on the particles to cool them down, and vice versa. The parameter $Q$ controls the timescale of this response. A large $Q$ corresponds to a slow, weakly coupled thermostat, while a small $Q$ corresponds to a fast, strongly coupled thermostat.\n\nThe \"natural angular frequency\" of the thermostat, $\\omega_{\\mathrm{NH}}$, characterizes the oscillatory response of the thermostat variable around its equilibrium state. This frequency can be derived by performing a linear stability analysis of the coupled system dynamics around thermal equilibrium. This analysis yields the following fundamental relationship between the thermostat's parameters:\n$$ \\omega_{\\mathrm{NH}}^2 = \\frac{2 N_{\\mathrm{f}} k_{\\mathrm{B}} T}{Q} $$\nThis equation relates the thermostat's intrinsic frequency to its mass $Q$ and the properties of the system it thermostats ($N_{\\mathrm{f}}$ and $T$).\n\nThe problem requires us to set this natural frequency to a fixed fraction, $\\rho$, of the system's dominant physical frequency, $\\omega_{\\mathrm{dom}}$. This is a standard practice to avoid resonant coupling between the thermostat and the system's own vibrational modes, which could lead to numerical instability or unphysical energy exchange. The constraint is:\n$$ \\omega_{\\mathrm{NH}} = \\rho \\, \\omega_{\\mathrm{dom}} $$\nBy substituting this into the previous equation, we can solve for $Q$:\n$$ (\\rho \\, \\omega_{\\mathrm{dom}})^2 = \\frac{2 N_{\\mathrm{f}} k_{\\mathrm{B}} T}{Q} $$\n$$ Q = \\frac{2 N_{\\mathrm{f}} k_{\\mathrm{B}} T}{(\\rho \\, \\omega_{\\mathrm{dom}})^2} $$\nThis is the final expression used for the calculation. All quantities on the right-hand side are given, except for $\\omega_{\\mathrm{dom}}$, which must be determined numerically.\n\n### Step 2: Numerical Determination of the Dominant Frequency $\\omega_{\\mathrm{dom}}$\n\nThe dominant physical angular frequency, $\\omega_{\\mathrm{dom}}$, is extracted from the system's velocity time series, $v(t)$, through spectral analysis.\n\n**Signal Generation:**\nA discrete velocity time series, $v_k$, is synthesized at uniformly-spaced time points $t_k = k \\Delta t$ for $k = 0, 1, \\dots, N-1$. The signal is a superposition of sinusoidal modes:\n$$ v(t_k) = \\sum_i A_i \\sin(2\\pi f_i t_k) $$\nwhere $A_i$ and $f_i$ are the given amplitudes and frequencies of the modes, $\\Delta t$ is the time step, and $N$ is the total number of samples.\n\n**Spectral Analysis via DFT:**\nThe power spectrum of the signal is estimated using the Discrete Fourier Transform (DFT), which is implemented efficiently via the Fast Fourier Transform (FFT) algorithm.\n1.  **Windowing:** To mitigate spectral leakage, which arises from the implicit assumption of periodicity in the DFT of a finite-length signal, the time series $v_k$ is first multiplied by a window function, $w_k$. A Hann window is a suitable and common choice:\n    $$ w_k = 0.5 \\left(1 - \\cos\\left(\\frac{2\\pi k}{N-1}\\right)\\right) \\quad \\text{for } k=0, \\dots, N-1 $$\n    The windowed signal is $v'_k = v_k w_k$.\n\n2.  **FFT and Power Spectrum:** The DFT of the real-valued windowed signal, $v'_k$, is computed. The one-sided power spectrum, $P_j$, is then calculated as the squared magnitude of the complex-valued DFT coefficients, $V'_j$:\n    $$ P_j \\propto |V'_j|^2 $$\n    The frequencies corresponding to the DFT coefficients are $f_j = j \\cdot \\frac{1}{N \\Delta t}$ for $j=0, 1, \\dots, N/2$.\n\n3.  **Peak Identification:** The dominant frequency corresponds to the highest peak in the power spectrum. The zero-frequency (DC) component, $P_0$, is excluded from this search. The index $j_{\\text{peak}}$ of the bin with the maximum power is identified.\n\n**Peak Refinement using Parabolic Interpolation:**\nThe DFT provides a spectrum at discrete frequency bins. The true peak of a spectral component generally lies between these bins. To improve accuracy, we refine the peak's location using parabolic interpolation on the peak bin and its two immediate neighbors. Given the power values $y_{m} = P_{j_{\\text{peak}}-1}$, $y_{p} = P_{j_{\\text{peak}}}$, and $y_{p1} = P_{j_{\\text{peak}}+1}$, we fit a parabola to the three points. The vertex of this parabola gives a more precise location for the peak. The offset $\\delta_j$ from the integer index $j_{\\text{peak}}$ is given by:\n$$ \\delta_j = \\frac{1}{2} \\frac{y_{m} - y_{p1}}{y_{m} - 2y_{p} + y_{p1}} $$\nThe refined frequency index is $j_{\\text{refined}} = j_{\\text{peak}} + \\delta_j$. The refined dominant frequency $f_{\\mathrm{dom}}$ is then:\n$$ f_{\\mathrm{dom}} = j_{\\text{refined}} \\cdot \\frac{1}{N \\Delta t} $$\n\n**Final Calculation:**\nThe refined dominant frequency in hertz, $f_{\\mathrm{dom}}$, is converted to an angular frequency:\n$$ \\omega_{\\mathrm{dom}} = 2 \\pi f_{\\mathrm{dom}} $$\nThis value is then substituted into the derived formula for $Q$ to obtain the final result in SI units of $\\mathrm{J}\\cdot\\mathrm{s}^2$. This entire procedure is applied to each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Nosé-Hoover thermostat mass Q for several test cases.\n    \"\"\"\n    # The Boltzmann constant in SI units (J/K).\n    KB = 1.380649e-23\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"dt\": 2.5e-16,\n            \"N\": 16384,\n            \"modes\": [{\"A\": 1.0, \"f\": 1.0e12}, {\"A\": 0.5, \"f\": 3.0e12}],\n            \"Nf\": 12,\n            \"T\": 300,\n            \"rho\": 0.2,\n        },\n        {\n            \"dt\": 2.5e-16,\n            \"N\": 16384,\n            \"modes\": [\n                {\"A\": 0.9, \"f\": 1.0e12},\n                {\"A\": 1.0, \"f\": 1.2e12},\n                {\"A\": 0.4, \"f\": 4.0e12},\n            ],\n            \"Nf\": 6,\n            \"T\": 100,\n            \"rho\": 0.5,\n        },\n        {\n            \"dt\": 5.0e-16,\n            \"N\": 16384,\n            \"modes\": [{\"A\": 0.8, \"f\": 5.0e10}, {\"A\": 0.3, \"f\": 1.0e13}],\n            \"Nf\": 24,\n            \"T\": 1000,\n            \"rho\": 0.1,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current case\n        dt = case[\"dt\"]\n        N = case[\"N\"]\n        modes = case[\"modes\"]\n        Nf = case[\"Nf\"]\n        T = case[\"T\"]\n        rho = case[\"rho\"]\n\n        # Step 1: Generate the synthetic velocity time series v(t)\n        t = np.arange(N) * dt\n        v = np.zeros(N)\n        for mode in modes:\n            v += mode[\"A\"] * np.sin(2 * np.pi * mode[\"f\"] * t)\n\n        # Step 2: Compute the dominant physical angular frequency omega_dom\n        \n        # Apply a Hann window to mitigate spectral leakage\n        window = np.hanning(N)\n        v_windowed = v * window\n\n        # Compute the one-sided power spectral density (PSD) via real FFT\n        # rfft is used for real-valued input, which is more efficient.\n        y_fft = np.fft.rfft(v_windowed)\n        power_spectrum = np.abs(y_fft) ** 2\n        \n        # Get the frequency bins corresponding to the rfft output\n        # The frequencies are from 0 up to the Nyquist frequency.\n        freqs = np.fft.rfftfreq(N, dt)\n        \n        # Exclude the zero-frequency (DC) component and find the peak\n        # The +1 accounts for slicing from index 1 onwards.\n        peak_idx = np.argmax(power_spectrum[1:]) + 1\n        \n        # Refine the peak location via quadratic (parabolic) interpolation\n        # This uses the peak and its two immediate neighbors.\n        # This is safe as long as the peak is not at the first or last index.\n        # With N=16384, this is highly unlikely for the given signals.\n        p_minus_1 = power_spectrum[peak_idx - 1]\n        p_peak = power_spectrum[peak_idx]\n        p_plus_1 = power_spectrum[peak_idx + 1]\n        \n        # Formula for the offset of a parabolic peak from the center sample\n        delta_j = 0.5 * (p_minus_1 - p_plus_1) / (p_minus_1 - 2 * p_peak + p_plus_1)\n        \n        refined_idx = peak_idx + delta_j\n        \n        # The frequency resolution df = 1 / (N * dt)\n        # So, f_dom = refined_idx * df\n        f_dom = refined_idx / (N * dt)\n        \n        # Convert the dominant frequency to angular frequency\n        omega_dom = 2 * np.pi * f_dom\n        \n        # Step 3: Choose the NHT parameter Q\n        # The formula derived from first principles is:\n        # Q = (2 * Nf * kB * T) / (rho * omega_dom)^2\n        q_value = (2 * Nf * KB * T) / (rho * omega_dom) ** 2\n        results.append(q_value)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{q:.10e}' for q in results)}]\")\n\nsolve()\n```"
        }
    ]
}