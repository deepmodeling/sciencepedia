{
    "hands_on_practices": [
        {
            "introduction": "经典的库仑势在原点处存在一个奇点，这给理论和计算都带来了挑战。本练习探讨了一种常见的解决方案：核函数正则化。通过计算正则化点电荷的电势、能量和远场行为，您将亲身体验一项用于创建行为良好、能够桥接不同物理尺度的模型的基本技术。",
            "id": "3753379",
            "problem": "考虑一个电荷量为 $q$ 的点电荷，位于介电常数为 $\\varepsilon_{0}$ 的真空中的原点。在标准静电学中，点电荷产生的电势由一个与径向坐标 $r$ 的倒数 $1/r$ 成正比的核函数决定。为了在保持远场一致性的同时模拟微观尺度的平滑效应，我们考虑使用正则化核函数 $1/\\sqrt{r^{2}+a^{2}}$，其中 $a>0$ 是一个固定的平滑长度。定义静电势 $\\phi(\\mathbf{r})$ 为该核函数与电荷密度 $\\rho(\\mathbf{r})$ 的卷积，并定义电场 $\\mathbf{E}(\\mathbf{r})$ 为电势的负梯度。真空中的静电能是通过对能量密度 $(\\varepsilon_{0}/2)|\\mathbf{E}(\\mathbf{r})|^{2}$ 在全空间进行积分得到的。\n\n从以下基本定义出发\n- 由电荷分布 $\\rho(\\mathbf{r})$ 产生的电势为\n$$\n\\phi(\\mathbf{r})=\\frac{1}{4\\pi\\varepsilon_{0}}\\int_{\\mathbb{R}^{3}}\\frac{\\rho(\\mathbf{r}')}{\\sqrt{|\\mathbf{r}-\\mathbf{r}'|^{2}+a^{2}}}\\,\\mathrm{d}^{3}\\mathbf{r}'\\!,\n$$\n- 电场为 $\\mathbf{E}(\\mathbf{r})=-\\nabla \\phi(\\mathbf{r})$，\n- 总静电能为\n$$\nU=\\int_{\\mathbb{R}^{3}}\\frac{\\varepsilon_{0}}{2}\\,|\\mathbf{E}(\\mathbf{r})|^{2}\\,\\mathrm{d}^{3}\\mathbf{r},\n$$\n其中点电荷密度为 $\\rho(\\mathbf{r})=q\\,\\delta^{(3)}(\\mathbf{r})$，$\\delta^{(3)}(\\cdot)$ 表示三维 Dirac delta 分布，对该正则化模型进行多尺度分析，并用 $q$、$\\varepsilon_{0}$ 和 $a$ 精确计算以下物理量：\n\n1. 有限的近场电势值 $\\phi(0)$。\n2. 由正则化点电荷产生的场中存储的总静电能 $U$。\n3. 由正则化电势与库仑电势之间的渐近差异定义的主阶远场修正系数 $C$：\n$$\n\\Delta\\phi(r)=\\phi(r)-\\frac{q}{4\\pi\\varepsilon_{0}\\,r}=\\frac{C}{r^{3}}+o\\!\\left(\\frac{1}{r^{3}}\\right)\\quad\\text{as}\\quad r\\to\\infty,\n$$\n其中 $r=|\\mathbf{r}|$。\n\n报告 $\\phi(0)$（单位为伏特），$U$（单位为焦耳），和 $C$（单位为伏特·米$^{3}$），但在最终的方框答案中不要包含单位。不需要数值近似；请提供精确的封闭形式表达式。你的最终答案必须是使用 LaTeX $\\mathrm{pmatrix}$ 环境表示的单行三个表达式。",
            "solution": "本题已经过验证。\n\n### 步骤1：提取已知条件\n- 电荷分布：$\\rho(\\mathbf{r}) = q\\,\\delta^{(3)}(\\mathbf{r})$，其中 $q$ 是电荷量，$\\delta^{(3)}(\\cdot)$ 是三维 Dirac delta 分布。\n- 电荷位置：原点 $\\mathbf{r}=\\mathbf{0}$。\n- 介质：真空，介电常数为 $\\varepsilon_{0}$。\n- 正则化电势定义：$$\\phi(\\mathbf{r})=\\frac{1}{4\\pi\\varepsilon_{0}}\\int_{\\mathbb{R}^{3}}\\frac{\\rho(\\mathbf{r}')}{\\sqrt{|\\mathbf{r}-\\mathbf{r}'|^{2}+a^{2}}}\\,\\mathrm{d}^{3}\\mathbf{r}'$$ 其中 $a>0$ 是一个固定的平滑长度。\n- 电场定义：$\\mathbf{E}(\\mathbf{r})=-\\nabla \\phi(\\mathbf{r})$。\n- 总静电能定义：$$U=\\int_{\\mathbb{R}^{3}}\\frac{\\varepsilon_{0}}{2}\\,|\\mathbf{E}(\\mathbf{r})|^{2}\\,\\mathrm{d}^{3}\\mathbf{r}$$\n- 渐近差异定义：$$\\Delta\\phi(r)=\\phi(r)-\\frac{q}{4\\pi\\varepsilon_{0}\\,r}=\\frac{C}{r^{3}}+o\\!\\left(\\frac{1}{r^{3}}\\right)\\quad\\text{as}\\quad r\\to\\infty$$ 其中 $r=|\\mathbf{r}|$。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了一个静电势的正则化模型。此类正则化在经典场论、量子场论以及数值模拟（例如，粒子模拟方法）中是常见且必要的，用于消除与点电荷相关的非物理奇点。该模型是一个成熟的理论构造，用于研究场的性质，同时避免发散。它不违反基本原理，而是在受控的方式下对其进行修改以进行分析。\n- **适定性**：所有必要的函数、常数和关系都已明确定义。任务是基于所提供的框架计算特定的、明确定义的量（$\\phi(0)$, $U$, $C$）。正则化参数 $a>0$ 确保了待计算的量是有限的。\n- **客观性**：问题以精确的数学语言陈述，没有歧义或主观内容。\n\n### 步骤3：结论与行动\n该问题有效。这是一个在理论物理学中自洽、有科学依据且适定的问题。我现在将着手解答。\n\n---\n\n解答需要基于所提供的静电学正则化模型计算三个不同的量。\n\n**1. 计算近场电势 $\\phi(0)$**\n\n静电势 $\\phi(\\mathbf{r})$ 定义为电荷密度 $\\rho(\\mathbf{r}')$ 与正则化核函数的卷积。\n$$\n\\phi(\\mathbf{r})=\\frac{1}{4\\pi\\varepsilon_{0}}\\int_{\\mathbb{R}^{3}}\\frac{\\rho(\\mathbf{r}')}{\\sqrt{|\\mathbf{r}-\\mathbf{r}'|^{2}+a^{2}}}\\,\\mathrm{d}^{3}\\mathbf{r}'\n$$\n将点电荷密度 $\\rho(\\mathbf{r}')=q\\,\\delta^{(3)}(\\mathbf{r}')$ 代入此表达式，得到：\n$$\n\\phi(\\mathbf{r})=\\frac{1}{4\\pi\\varepsilon_{0}}\\int_{\\mathbb{R}^{3}}\\frac{q\\,\\delta^{(3)}(\\mathbf{r}')}{\\sqrt{|\\mathbf{r}-\\mathbf{r}'|^{2}+a^{2}}}\\,\\mathrm{d}^{3}\\mathbf{r}'\n$$\n应用 Dirac delta 分布的筛选性质，即 $\\int f(\\mathbf{x}')\\delta^{(3)}(\\mathbf{x}')\\mathrm{d}^3\\mathbf{x}' = f(\\mathbf{0})$，我们通过令 $\\mathbf{r}' = \\mathbf{0}$ 来计算该积分：\n$$\n\\phi(\\mathbf{r}) = \\frac{q}{4\\pi\\varepsilon_{0}} \\frac{1}{\\sqrt{|\\mathbf{r}-\\mathbf{0}|^{2}+a^{2}}} = \\frac{q}{4\\pi\\varepsilon_{0}\\sqrt{r^{2}+a^{2}}}\n$$\n其中 $r = |\\mathbf{r}|$ 是距原点的径向距离。\n\n为求得原点处的电势，我们令 $\\mathbf{r}=\\mathbf{0}$，即 $r=0$：\n$$\n\\phi(0) = \\frac{q}{4\\pi\\varepsilon_{0}\\sqrt{0^{2}+a^{2}}} = \\frac{q}{4\\pi\\varepsilon_{0}a}\n$$\n正则化消除了经典点电荷的无限自能，从而在原点处得到一个有限值。\n\n**2. 计算总静电能 $U$**\n\n总能量 $U$ 由能量密度在全空间的积分给出：\n$$\nU=\\int_{\\mathbb{R}^{3}}\\frac{\\varepsilon_{0}}{2}\\,|\\mathbf{E}(\\mathbf{r})|^{2}\\,\\mathrm{d}^{3}\\mathbf{r}\n$$\n首先，我们必须通过对电势 $\\phi(\\mathbf{r})$ 取负梯度来确定电场 $\\mathbf{E}(\\mathbf{r})$。由于 $\\phi$ 是径向对称的，其在球坐标系中的梯度为 $\\nabla\\phi = \\frac{\\partial\\phi}{\\partial r}\\hat{\\mathbf{r}}$。\n$$\n\\frac{\\partial\\phi}{\\partial r} = \\frac{\\partial}{\\partial r}\\left(\\frac{q}{4\\pi\\varepsilon_{0}}(r^{2}+a^{2})^{-1/2}\\right) = \\frac{q}{4\\pi\\varepsilon_{0}}\\left(-\\frac{1}{2}\\right)(r^{2}+a^{2})^{-3/2}(2r) = -\\frac{qr}{4\\pi\\varepsilon_{0}(r^{2}+a^{2})^{3/2}}\n$$\n因此，电场为：\n$$\n\\mathbf{E}(\\mathbf{r}) = -\\nabla\\phi = \\frac{qr}{4\\pi\\varepsilon_{0}(r^{2}+a^{2})^{3/2}}\\hat{\\mathbf{r}}\n$$\n电场强度的平方为：\n$$\n|\\mathbf{E}(\\mathbf{r})|^{2} = \\left(\\frac{qr}{4\\pi\\varepsilon_{0}(r^{2}+a^{2})^{3/2}}\\right)^{2} = \\frac{q^{2}r^{2}}{(4\\pi\\varepsilon_{0})^{2}(r^{2}+a^{2})^{3}}\n$$\n现在，我们将其代入能量积分中。我们使用球坐标系下的体积元 $\\mathrm{d}^{3}\\mathbf{r} = r^{2}\\sin\\theta\\,\\mathrm{d}r\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$。由于被积函数仅依赖于 $r$，角度部分的积分结果为 $4\\pi$。\n$$\nU = \\frac{\\varepsilon_{0}}{2} \\int_{0}^{2\\pi}\\int_{0}^{\\pi}\\int_{0}^{\\infty} \\frac{q^{2}r^{2}}{(4\\pi\\varepsilon_{0})^{2}(r^{2}+a^{2})^{3}} r^{2}\\sin\\theta\\,\\mathrm{d}r\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi\n$$\n$$\nU = \\frac{\\varepsilon_{0}}{2} \\frac{q^{2}}{16\\pi^{2}\\varepsilon_{0}^{2}} (4\\pi) \\int_{0}^{\\infty} \\frac{r^{4}}{(r^{2}+a^{2})^{3}}\\,\\mathrm{d}r = \\frac{q^{2}}{8\\pi\\varepsilon_{0}} \\int_{0}^{\\infty} \\frac{r^{4}}{(r^{2}+a^{2})^{3}}\\,\\mathrm{d}r\n$$\n为了计算剩下的积分 $I = \\int_{0}^{\\infty} \\frac{r^{4}}{(r^{2}+a^{2})^{3}}\\,\\mathrm{d}r$，我们进行三角代换 $r = a\\tan\\psi$，这意味着 $\\mathrm{d}r = a\\sec^{2}\\psi\\,\\mathrm{d}\\psi$。积分限从 $r\\in[0, \\infty)$ 变为 $\\psi\\in[0, \\pi/2)$。\n$$\nI = \\int_{0}^{\\pi/2} \\frac{(a\\tan\\psi)^{4}}{(a^{2}\\tan^{2}\\psi+a^{2})^{3}} (a\\sec^{2}\\psi)\\,\\mathrm{d}\\psi = \\int_{0}^{\\pi/2} \\frac{a^{4}\\tan^{4}\\psi}{(a^{2}\\sec^{2}\\psi)^{3}} (a\\sec^{2}\\psi)\\,\\mathrm{d}\\psi\n$$\n$$\nI = \\int_{0}^{\\pi/2} \\frac{a^{5}\\tan^{4}\\psi\\sec^{2}\\psi}{a^{6}\\sec^{6}\\psi}\\,\\mathrm{d}\\psi = \\frac{1}{a} \\int_{0}^{\\pi/2} \\frac{\\tan^{4}\\psi}{\\sec^{4}\\psi}\\,\\mathrm{d}\\psi = \\frac{1}{a} \\int_{0}^{\\pi/2} \\frac{\\sin^{4}\\psi/\\cos^{4}\\psi}{1/\\cos^{4}\\psi}\\,\\mathrm{d}\\psi = \\frac{1}{a} \\int_{0}^{\\pi/2} \\sin^{4}\\psi\\,\\mathrm{d}\\psi\n$$\n这是一个标准的 Wallis 积分：\n$$\n\\int_{0}^{\\pi/2} \\sin^{4}\\psi\\,\\mathrm{d}\\psi = \\frac{4-1}{4} \\cdot \\frac{4-3}{4-2} \\cdot \\frac{\\pi}{2} = \\frac{3}{4} \\cdot \\frac{1}{2} \\cdot \\frac{\\pi}{2} = \\frac{3\\pi}{16}\n$$\n因此，$I = \\frac{1}{a}\\frac{3\\pi}{16}$。将此结果代回 $U$ 的表达式中：\n$$\nU = \\frac{q^{2}}{8\\pi\\varepsilon_{0}} \\left(\\frac{3\\pi}{16a}\\right) = \\frac{3q^{2}}{128\\varepsilon_{0}a}\n$$\n这个有限的自能是正则化的直接结果。\n\n**3. 计算远场修正系数 $C$**\n\n我们需要求解电势差渐近展开式中的系数 $C$：\n$$\n\\Delta\\phi(r)=\\phi(r)-\\phi_{\\text{Coulomb}}(r)=\\frac{C}{r^{3}}+o\\!\\left(\\frac{1}{r^{3}}\\right)\n$$\n其中 $\\phi_{\\text{Coulomb}}(r) = \\frac{q}{4\\pi\\varepsilon_{0}r}$。我们从 $\\phi(r)$ 的表达式开始，并对其在 $r$ 很大时进行展开：\n$$\n\\phi(r) = \\frac{q}{4\\pi\\varepsilon_{0}\\sqrt{r^{2}+a^{2}}} = \\frac{q}{4\\pi\\varepsilon_{0}r\\sqrt{1+a^{2}/r^{2}}} = \\frac{q}{4\\pi\\varepsilon_{0}r}\\left(1+\\frac{a^{2}}{r^{2}}\\right)^{-1/2}\n$$\n使用广义二项式级数 $(1+x)^{\\alpha} = 1 + \\alpha x + \\frac{\\alpha(\\alpha-1)}{2!}x^{2} + \\dots$，其中 $x=a^{2}/r^{2}$ 且 $\\alpha=-1/2$：\n$$\n\\left(1+\\frac{a^{2}}{r^{2}}\\right)^{-1/2} = 1 + \\left(-\\frac{1}{2}\\right)\\frac{a^{2}}{r^{2}} + \\frac{(-1/2)(-3/2)}{2}\\left(\\frac{a^{2}}{r^{2}}\\right)^{2} + O\\left(\\frac{1}{r^{6}}\\right)\n$$\n$$\n= 1 - \\frac{a^{2}}{2r^{2}} + \\frac{3a^{4}}{8r^{4}} + O\\left(\\frac{1}{r^{6}}\\right)\n$$\n将此级数代回 $\\phi(r)$ 的表达式中：\n$$\n\\phi(r) = \\frac{q}{4\\pi\\varepsilon_{0}r}\\left(1 - \\frac{a^{2}}{2r^{2}} + O\\left(\\frac{1}{r^{4}}\\right)\\right) = \\frac{q}{4\\pi\\varepsilon_{0}r} - \\frac{qa^{2}}{8\\pi\\varepsilon_{0}r^{3}} + O\\left(\\frac{1}{r^{5}}\\right)\n$$\n那么，电势差为：\n$$\n\\Delta\\phi(r) = \\left(\\frac{q}{4\\pi\\varepsilon_{0}r} - \\frac{qa^{2}}{8\\pi\\varepsilon_{0}r^{3}} + \\dots\\right) - \\frac{q}{4\\pi\\varepsilon_{0}r} = -\\frac{qa^{2}}{8\\pi\\varepsilon_{0}r^{3}} + O\\left(\\frac{1}{r^{5}}\\right)\n$$\n通过将其与指定形式 $\\Delta\\phi(r) = C/r^{3} + o(1/r^{3})$进行比较，我们可以确定系数 $C$：\n$$\nC = -\\frac{qa^{2}}{8\\pi\\varepsilon_{0}}\n$$\n在远场中，对库仑电势的主阶修正具有类偶极子特性（就径向衰减而言，而非角度依赖性），其强度取决于平滑长度 $a$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{q}{4\\pi\\varepsilon_{0}a} & \\frac{3q^{2}}{128\\varepsilon_{0}a} & -\\frac{qa^{2}}{8\\pi\\varepsilon_{0}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "模拟分子等复杂系统之间的相互作用，通常需要在不丢失基本物理特性的前提下简化问题。本练习将指导您使用多极展开推导两个电荷簇之间的相互作用能，这是多尺度建模的基石。这项练习将锻炼您进行系统性近似和粗粒化的能力，使您能够将详细的微观电荷分布与其宏观相互作用规律联系起来。",
            "id": "3753430",
            "problem": "考虑真空中两个有限的点电荷团簇，记为 $C_1$ 和 $C_2$。团簇 $C_1$ 包含 $n_1$ 个点电荷 $q_{1i}$，位于位置 $\\mathbf{R}_1 + \\mathbf{r}_{1i}$（其中 $i = 1, \\dots, n_1$），团簇 $C_2$ 包含 $n_2$ 个点电荷 $q_{2j}$，位于位置 $\\mathbf{R}_2 + \\mathbf{r}_{2j}$（其中 $j = 1, \\dots, n_2$）。假设团簇内半径满足 $\\max_i |\\mathbf{r}_{1i}| \\le a_1$ 和 $\\max_j |\\mathbf{r}_{2j}| \\le a_2$，并且间距 $L = |\\mathbf{R}_2 - \\mathbf{R}_1|$ 满足 $a_1 \\ll L$ 和 $a_2 \\ll L$。定义单位矢量 $\\hat{\\mathbf{n}} = (\\mathbf{R}_2 - \\mathbf{R}_1)/L$，从 $C_1$ 中心指向 $C_2$ 中心。令 $k = \\frac{1}{4\\pi \\epsilon_0}$ 表示 Coulomb 常数，其中 $\\epsilon_0$ 是真空介电常数。\n\n该构型将通过准静态地将每个电荷从无穷远处移动到其最终位置来组建，期间已放置的电荷持续存在。使用静电势的 Coulomb 定律和叠加原理，推导组建整个构型所需的总功 $W$ 的闭合形式解析表达式。\n\n您的推导必须：\n- 从静电学的基本定义和定律出发，不使用任何非从第一性原理直接推导的目标或简化能量公式。\n- 将总功分为 $C_1$ 内部和 $C_2$ 内部的精确团簇内成对贡献之和，以及 $C_1$ 和 $C_2$ 之间的团簇间相互作用贡献。\n- 对于团簇间相互作用，使用由 $a_1, a_2 \\ll L$ 证明为合理的多尺度展开，并在系统性截断中保留所有由团簇的单极矩和偶极矩产生的项，直至 $L^{-3}$ 阶。明确忽略任何涉及四极矩和更高阶多极矩的项，这与那些更高阶矩未被解析的粗粒化描述一致。\n\n引入总电荷 $Q_1 = \\sum_{i=1}^{n_1} q_{1i}$ 和 $Q_2 = \\sum_{j=1}^{n_2} q_{2j}$，以及相对于团簇中心的偶极矩 $\\mathbf{p}_1 = \\sum_{i=1}^{n_1} q_{1i}\\,\\mathbf{r}_{1i}$ 和 $\\mathbf{p}_2 = \\sum_{j=1}^{n_2} q_{2j}\\,\\mathbf{r}_{2j}$。\n\n将 $W$ 的最终答案以单个闭合形式解析表达式给出，用 $k$、$Q_1$、$Q_2$、$\\mathbf{p}_1$、$\\mathbf{p}_2$、$\\hat{\\mathbf{n}}$、$L$ 以及团簇内电荷和位置 $\\{q_{1i}, \\mathbf{r}_{1i}\\}$ 和 $\\{q_{2j}, \\mathbf{r}_{2j}\\}$ 表示。不要假设任一团簇是电中性的。使用点电荷之间的欧几里得距离表示精确的团簇内贡献。最终答案必须是单个解析表达式。不需要数值计算或四舍五入，最终的方框表达式内不应包含任何单位。",
            "solution": "问题验证如下。\n\n### 步骤 1：提取给定条件\n- 真空中两个有限的点电荷团簇 $C_1$ 和 $C_2$。\n- 团簇 $C_1$：$n_1$ 个点电荷 $q_{1i}$，位于位置 $\\mathbf{R}_1 + \\mathbf{r}_{1i}$（其中 $i = 1, \\dots, n_1$）。\n- 团簇 $C_2$：$n_2$ 个点电荷 $q_{2j}$，位于位置 $\\mathbf{R}_2 + \\mathbf{r}_{2j}$（其中 $j = 1, \\dots, n_2$）。\n- 团簇内半径：$\\max_i |\\mathbf{r}_{1i}| \\le a_1$ 和 $\\max_j |\\mathbf{r}_{2j}| \\le a_2$。\n- 间距：$L = |\\mathbf{R}_2 - \\mathbf{R}_1|$。\n- 条件：$a_1 \\ll L$ 和 $a_2 \\ll L$。\n- 单位矢量：$\\hat{\\mathbf{n}} = (\\mathbf{R}_2 - \\mathbf{R}_1)/L$。\n- Coulomb 常数：$k = \\frac{1}{4\\pi \\epsilon_0}$。\n- 任务：推导组建构型所需的总功 $W$。\n- 方法论约束：\n    1.  从基本定义和定律出发。\n    2.  将总功分为精确的团簇内功（$W_{11}$、$W_{22}$）和团簇间功（$W_{12}$）贡献。\n    3.  对 $W_{12}$ 使用由 $a_1, a_2 \\ll L$ 证明为合理的多尺度展开。\n    4.  保留由单极矩和偶极矩产生的项，直至 $L^{-3}$ 阶。\n    5.  明确忽略四极矩和更高阶多极矩项。\n- 定义：\n    - $C_1$ 的总电荷：$Q_1 = \\sum_{i=1}^{n_1} q_{1i}$。\n    - $C_2$ 的总电荷：$Q_2 = \\sum_{j=1}^{n_2} q_{2j}$。\n    - $C_1$ 的偶极矩：$\\mathbf{p}_1 = \\sum_{i=1}^{n_1} q_{1i}\\,\\mathbf{r}_{1i}$。\n    - $C_2$ 的偶极矩：$\\mathbf{p}_2 = \\sum_{j=1}^{n_2} q_{2j}\\,\\mathbf{r}_{2j}$。\n- 最终答案要求：一个关于 $W$ 的单一闭合形式解析表达式，用 $k$、$Q_1$、$Q_2$、$\\mathbf{p}_1$、$\\mathbf{p}_2$、$\\hat{\\mathbf{n}}$、$L$ 以及团簇内电荷和位置 $\\{q_{1i}, \\mathbf{r}_{1i}\\}$ 和 $\\{q_{2j}, \\mathbf{r}_{2j}\\}$ 表示。\n\n### 步骤 2：使用提取的给定条件进行验证\n该问题是经典静电学中的一个标准练习，具体涉及电荷分布的势能及其使用多极展开的近似。\n- **科学上成立：** 该问题基于 Coulomb 定律和叠加原理，这是静电学的基础。多极展开的概念是一种标准的、数学上严谨的技术。所有前提在事实上和科学上都是合理的。\n- **适定的：** 该问题提供了所有必要的数据和约束，以得出一个唯一的解析表达式。目标陈述清晰，且求解路径以明确的方式受到约束（例如，截断阶数、排除更高阶多极）。\n- **客观性：** 语言形式化、精确，且没有任何主观或模棱两可的术语。\n- **完整性与一致性：** 该问题是自洽的。条件 $a_1, a_2 \\ll L$ 为所要求的多尺度展开提供了物理依据。忽略四极矩的指令是对所需近似水平的一个具体且一致的约束。\n- **现实性与可行性：** 该物理设置是模拟分离的分子或原子团簇之间相互作用的有效理想化模型。参数值未指定，因此不会出现不一致性。\n\n### 步骤 3：结论与行动\n该问题在科学上是合理的、适定的、客观的和自洽的。这是一个有效的物理问题，可以按所述方式求解。我将继续进行推导。\n\n### 推导\n\n准静态地从无穷远处组建一个点电荷构型所需的总功 $W$ 等于最终构型的总静电势能 $U$。对于一个离散电荷系统，该能量是所有唯一电荷对的势能之和。该系统由团簇 $C_1$ 中的 $n_1$ 个电荷和团簇 $C_2$ 中的 $n_2$ 个电荷组成。总功 $W$ 可分为三个部分：\n1.  孤立地组建团簇 $C_1$ 所需的功，$W_{11}$。\n2.  孤立地组建团簇 $C_2$ 所需的功，$W_{22}$。\n3.  将两个完全形成的团簇从无穷远分离带到其最终位置所需的功，即团簇间相互作用能 $W_{12}$。\n因此，总功为：\n$$\nW = W_{11} + W_{22} + W_{12}\n$$\n\n**团簇内功（自能）**\n\n组建团簇 $C_1$ 所需的功是其内部每对电荷的势能之和。电荷 $q_{1i}$ 的位置是 $\\mathbf{R}_1 + \\mathbf{r}_{1i}$，电荷 $q_{1k}$ 的位置是 $\\mathbf{R}_1 + \\mathbf{r}_{1k}$。它们之间的距离是 $|(\\mathbf{R}_1 + \\mathbf{r}_{1i}) - (\\mathbf{R}_1 + \\mathbf{r}_{1k})| = |\\mathbf{r}_{1i} - \\mathbf{r}_{1k}|$。按照问题要求，这是一个基于相对于其团簇中心的电荷间欧几里得距离的精确表达式。\n$$\nW_{11} = \\frac{1}{2} \\sum_{i=1}^{n_1} \\sum_{k=1, k \\ne i}^{n_1} k \\frac{q_{1i} q_{1k}}{|\\mathbf{r}_{1i} - \\mathbf{r}_{1k}|}\n$$\n因子 $\\frac{1}{2}$ 用于校正求和中对每对电荷的双重计数。\n\n类似地，组建团簇 $C_2$ 所需的功是：\n$$\nW_{22} = \\frac{1}{2} \\sum_{j=1}^{n_2} \\sum_{l=1, l \\ne j}^{n_2} k \\frac{q_{2j} q_{2l}}{|\\mathbf{r}_{2j} - \\mathbf{r}_{2l}|}\n$$\n\n**团簇间功（相互作用能）**\n\n团簇间功 $W_{12}$ 是所有由一个来自 $C_1$ 的电荷和一个来自 $C_2$ 的电荷组成的电荷对的势能之和。\n$$\nW_{12} = \\sum_{i=1}^{n_1} \\sum_{j=1}^{n_2} k \\frac{q_{1i} q_{2j}}{|(\\mathbf{R}_1 + \\mathbf{r}_{1i}) - (\\mathbf{R}_2 + \\mathbf{r}_{2j})|}\n$$\n令 $\\mathbf{L} = \\mathbf{R}_2 - \\mathbf{R}_1$，其大小为 $L$，方向为 $\\hat{\\mathbf{n}}$。分母中的矢量是 $\\mathbf{R}_1 - \\mathbf{R}_2 + \\mathbf{r}_{1i} - \\mathbf{r}_{2j} = -\\mathbf{L} + (\\mathbf{r}_{1i} - \\mathbf{r}_{2j})$。其大小为 $|\\mathbf{L} - (\\mathbf{r}_{1i} - \\mathbf{r}_{2j})|$。\n给定 $|\\mathbf{r}_{1i}| \\ll L$ 和 $|\\mathbf{r}_{2j}| \\ll L$，这意味着矢量 $\\mathbf{d}_{ij} = \\mathbf{r}_{1i} - \\mathbf{r}_{2j}$ 的大小远小于 $L$。这为逆距离的多尺度展开提供了依据：\n$$\n\\frac{1}{|\\mathbf{L} - \\mathbf{d}_{ij}|} = \\frac{1}{\\sqrt{(\\mathbf{L} - \\mathbf{d}_{ij}) \\cdot (\\mathbf{L} - \\mathbf{d}_{ij})}} = \\frac{1}{\\sqrt{L^2 - 2\\mathbf{L} \\cdot \\mathbf{d}_{ij} + |\\mathbf{d}_{ij}|^2}}\n$$\n提出 $L$，我们得到：\n$$\n\\frac{1}{L} \\left(1 - \\frac{2\\mathbf{L} \\cdot \\mathbf{d}_{ij}}{L^2} + \\frac{|\\mathbf{d}_{ij}|^2}{L^2}\\right)^{-1/2}\n$$\n使用泰勒展开 $(1+x)^{-1/2} \\approx 1 - \\frac{1}{2}x + \\frac{3}{8}x^2 - \\dots$，其中 $x = - \\frac{2\\hat{\\mathbf{n}} \\cdot \\mathbf{d}_{ij}}{L} + \\frac{|\\mathbf{d}_{ij}|^2}{L^2}$，我们展开到在最终能量 $W_{12}$ 中获得 $L^{-3}$ 阶项所必需的阶数。\n展开式为：\n$$\n\\frac{1}{|\\mathbf{L} - \\mathbf{d}_{ij}|} \\approx \\frac{1}{L} \\left( 1 - \\frac{1}{2}\\left(-\\frac{2\\hat{\\mathbf{n}} \\cdot \\mathbf{d}_{ij}}{L}\\right) + \\left[ -\\frac{1}{2}\\frac{|\\mathbf{d}_{ij}|^2}{L^2} + \\frac{3}{8}\\left(-\\frac{2\\hat{\\mathbf{n}} \\cdot \\mathbf{d}_{ij}}{L}\\right)^2 \\right] \\right)\n$$\n$$\n\\approx \\frac{1}{L} \\left( 1 + \\frac{\\hat{\\mathbf{n}} \\cdot \\mathbf{d}_{ij}}{L} + \\frac{3(\\hat{\\mathbf{n}} \\cdot \\mathbf{d}_{ij})^2 - |\\mathbf{d}_{ij}|^2}{2L^2} \\right)\n$$\n$$\n\\approx \\frac{1}{L} + \\frac{\\hat{\\mathbf{n}} \\cdot (\\mathbf{r}_{1i} - \\mathbf{r}_{2j})}{L^2} + \\frac{3(\\hat{\\mathbf{n}} \\cdot (\\mathbf{r}_{1i} - \\mathbf{r}_{2j}))^2 - |\\mathbf{r}_{1i} - \\mathbf{r}_{2j}|^2}{2L^3}\n$$\n我们将此展开式代入 $W_{12}$ 的表达式中，并按 $L^{-1}$ 的幂次对各项进行分组。\n\n第 1 项（$L^{-1}$ 阶）：单极-单极相互作用。\n$$\nW_{12}^{(0)} = \\sum_{i,j} k q_{1i} q_{2j} \\left(\\frac{1}{L}\\right) = \\frac{k}{L} \\left(\\sum_i q_{1i}\\right) \\left(\\sum_j q_{2j}\\right) = k \\frac{Q_1 Q_2}{L}\n$$\n\n第 2 项（$L^{-2}$ 阶）：单极-偶极相互作用。\n$$\nW_{12}^{(1)} = \\sum_{i,j} k q_{1i} q_{2j} \\frac{\\hat{\\mathbf{n}} \\cdot (\\mathbf{r}_{1i} - \\mathbf{r}_{2j})}{L^2} = \\frac{k}{L^2} \\left[ \\left(\\sum_j q_{2j}\\right) \\left(\\sum_i q_{1i} (\\hat{\\mathbf{n}} \\cdot \\mathbf{r}_{1i})\\right) - \\left(\\sum_i q_{1i}\\right) \\left(\\sum_j q_{2j} (\\hat{\\mathbf{n}} \\cdot \\mathbf{r}_{2j})\\right) \\right]\n$$\n使用总电荷（$Q_1, Q_2$）和偶极矩（$\\mathbf{p}_1, \\mathbf{p}_2$）的定义：\n$$\nW_{12}^{(1)} = \\frac{k}{L^2} \\left[ Q_2 (\\hat{\\mathbf{n}} \\cdot \\mathbf{p}_1) - Q_1 (\\hat{\\mathbf{n}} \\cdot \\mathbf{p}_2) \\right]\n$$\n\n第 3 项（$L^{-3}$ 阶）：此项包括偶极-偶极相互作用和单极-四极相互作用。\n$$\nW_{12}^{(2, full)} = \\sum_{i,j} k q_{1i} q_{2j} \\frac{3(\\hat{\\mathbf{n}} \\cdot (\\mathbf{r}_{1i} - \\mathbf{r}_{2j}))^2 - |\\mathbf{r}_{1i} - \\mathbf{r}_{2j}|^2}{2L^3}\n$$\n展开分子并对 $i$ 和 $j$ 求和，可以分离出依赖于不同多极矩组合的项。仅依赖于两个团簇偶极矩的项是偶极-偶极相互作用项，它来自交叉项 $-2(\\hat{\\mathbf{n}} \\cdot \\mathbf{r}_{1i})(\\hat{\\mathbf{n}} \\cdot \\mathbf{r}_{2j})$ 和 $-2\\mathbf{r}_{1i}\\cdot\\mathbf{r}_{2j}$。对这些交叉项求和得到：\n$$\n\\frac{k}{L^3} \\left[ (\\sum_i q_{1i} \\mathbf{r}_{1i}) \\cdot (\\sum_j q_{2j} \\mathbf{r}_{2j}) - 3 (\\hat{\\mathbf{n}} \\cdot \\sum_i q_{1i} \\mathbf{r}_{1i}) (\\hat{\\mathbf{n}} \\cdot \\sum_j q_{2j} \\mathbf{r}_{2j}) \\right] = \\frac{k}{L^3} \\left[ \\mathbf{p}_1 \\cdot \\mathbf{p}_2 - 3(\\mathbf{p}_1 \\cdot \\hat{\\mathbf{n}})(\\mathbf{p}_2 \\cdot \\hat{\\mathbf{n}}) \\right]\n$$\n$W_{12}^{(2, full)}$ 的其余部分包含诸如 $Q_2 \\sum_i q_{1i} (3(\\hat{\\mathbf{n}} \\cdot \\mathbf{r}_{1i})^2 - |\\mathbf{r}_{1i}|^2)$ 的项，这些项表示单极子与四极矩的相互作用。问题明确指示“忽略任何涉及四极矩和更高阶多极矩的项”。因此，我们必须截断 $L^{-3}$ 项，仅保留偶极-偶极贡献。\n\n精确到指定阶数和约束条件的截断后的团簇间功为：\n$$\nW_{12} \\approx W_{12}^{(0)} + W_{12}^{(1)} + W_{12}^{(2, \\text{dipole-dipole})}\n$$\n$$\nW_{12} \\approx k \\frac{Q_1 Q_2}{L} + \\frac{k}{L^2} \\left(Q_2(\\mathbf{p}_1 \\cdot \\hat{\\mathbf{n}}) - Q_1(\\mathbf{p}_2 \\cdot \\hat{\\mathbf{n}})\\right) + \\frac{k}{L^3} \\left[\\mathbf{p}_1 \\cdot \\mathbf{p}_2 - 3(\\mathbf{p}_1 \\cdot \\hat{\\mathbf{n}})(\\mathbf{p}_2 \\cdot \\hat{\\mathbf{n}})\\right]\n$$\n\n**总功**\n\n合并团簇内和团簇间的贡献，得到总功 $W$。这个单一表达式包括精确的团簇内项和粗粒化、截断的团簇间相互作用能。\n$$\nW = \\frac{k}{2} \\sum_{i=1}^{n_1} \\sum_{k=1, k \\ne i}^{n_1} \\frac{q_{1i} q_{1k}}{|\\mathbf{r}_{1i} - \\mathbf{r}_{1k}|} + \\frac{k}{2} \\sum_{j=1}^{n_2} \\sum_{l=1, l \\ne j}^{n_2} \\frac{q_{2j} q_{2l}}{|\\mathbf{r}_{2j} - \\mathbf{r}_{2l}|} + k \\frac{Q_1 Q_2}{L} + \\frac{k}{L^2} \\left(Q_2(\\mathbf{p}_1 \\cdot \\hat{\\mathbf{n}}) - Q_1(\\mathbf{p}_2 \\cdot \\hat{\\mathbf{n}})\\right) + \\frac{k}{L^3} \\left[\\mathbf{p}_1 \\cdot \\mathbf{p}_2 - 3(\\mathbf{p}_1 \\cdot \\hat{\\mathbf{n}})(\\mathbf{p}_2 \\cdot \\hat{\\mathbf{n}})\\right]\n$$",
            "answer": "$$\n\\boxed{\n\\frac{k}{2} \\sum_{i=1}^{n_1} \\sum_{k=1, k \\ne i}^{n_1} \\frac{q_{1i} q_{1k}}{|\\mathbf{r}_{1i} - \\mathbf{r}_{1k}|} + \\frac{k}{2} \\sum_{j=1}^{n_2} \\sum_{l=1, l \\ne j}^{n_2} \\frac{q_{2j} q_{2l}}{|\\mathbf{r}_{2j} - \\mathbf{r}_{2l}|} + k \\frac{Q_1 Q_2}{L} + \\frac{k}{L^2}(Q_2(\\mathbf{p}_1 \\cdot \\hat{\\mathbf{n}}) - Q_1(\\mathbf{p}_2 \\cdot \\hat{\\mathbf{n}})) + \\frac{k}{L^3}(\\mathbf{p}_1 \\cdot \\mathbf{p}_2 - 3(\\mathbf{p}_1 \\cdot \\hat{\\mathbf{n}})(\\mathbf{p}_2 \\cdot \\hat{\\mathbf{n}}))\n}\n$$"
        },
        {
            "introduction": "尽管牛顿第三定律等物理法则是精确的，但其数值实现可能会引入违反基本对称性的误差。这个实践性的编程练习要求您创建一个验证测试，以检查计算出的库仑力是否遵循作用力与反作用力原理。通过这个过程，您将学会诊断数值不稳定性并验证模拟的物理完整性，这是计算科学中的一项关键技能。",
            "id": "3753397",
            "problem": "您将编写一个完整、可运行的程序，对成对静电力进行数值对称性测试，以评估计算出的力是否在指定容差范围内符合牛顿第三定律。该程序必须根据叠加原理计算三维空间中点电荷之间的力，并且必须生成诊断信息，用以量化和定位因数值计算和不适定几何构型而引起的对牛顿第三定律的潜在违背。\n\n使用的基本原理和定义：点电荷之间的相互作用由库仑定律给出，该定律指出，电荷 $q_j$ 对电荷 $q_i$ 的力与乘积 $q_i q_j$ 成正比，方向沿两电荷的连线，大小与它们之间距离的平方成反比。牛顿第三定律指出作用力等于反作用力，意味着 $q_i$ 施加于 $q_j$ 的力与 $q_j$ 施加于 $q_i$ 的力大小相等，方向相反。叠加原理指出，作用于一个电荷上的总力是所有其他电荷对其施加的力的矢量和。使用国际单位制 (SI)，距离单位为米，力单位为牛顿。\n\n您的程序必须为每个测试用例实现以下步骤：\n\n- 计算电荷间所有无序的成对相互作用。对于每个无序对 $\\{i,j\\}$，计算位移矢量 $\\mathbf{r}_{ij} = \\mathbf{x}_j - \\mathbf{x}_i$ 及其欧几里得范数 $r_{ij} = \\|\\mathbf{r}_{ij}\\|_2$。如果 $r_{ij} = 0$，则将该对归类为不适定奇点。对于此类对，不计算力并将其标记为违例事件。\n- 对于每个 $r_{ij} \\neq 0$ 的有效对，使用库仑定律和叠加原理计算成对力 $\\mathbf{F}_{ij}$ 和 $\\mathbf{F}_{ji}$，其中库仑常数 $k$ 为 $k = \\frac{1}{4\\pi\\varepsilon_0}$，$\\varepsilon_0 = 8.8541878128\\times 10^{-12}$ 法拉/米。在国际单位制中使用矢量归一化和平方反比缩放，以牛顿为单位生成力。\n- 对于每个有效对，计算作用-反作用残差矢量 $\\mathbf{M}_{ij} = \\mathbf{F}_{ij} + \\mathbf{F}_{ji}$，以及相对对称性失配 $m_{ij} = \\frac{\\|\\mathbf{M}_{ij}\\|_2}{\\|\\mathbf{F}_{ij}\\|_2 + \\|\\mathbf{F}_{ji}\\|_2}$，该值为无量纲。\n- 汇总诊断信息：\n    1. 所有有效对中的最大相对失配，记为 $m_{\\max}$。\n    2. 所有粒子的总合力 $\\mathbf{F}_{\\mathrm{tot}} = \\sum_i \\mathbf{F}_i$ 及其欧几里得范数 $G = \\|\\mathbf{F}_{\\mathrm{tot}}\\|_2$，以牛顿表示。\n    3. 间距条件数 $K = \\frac{\\max\\{r_{ij}: r_{ij} > 0\\}}{\\min\\{r_{ij}: r_{ij} > 0\\}}$；如果不存在有效的非零距离，则定义 $K$ 为 $+\\infty$。\n    4. 违例对的数量 $V$，定义为 $r_{ij}=0$ 或 $m_{ij}$ 超过指定配对容差的无序对的数量。\n- 根据以下标准为每个测试用例确定一个通过/失败布尔值 $P$：当且仅当没有对存在 $r_{ij} = 0$，$m_{\\max} \\leq \\tau_{\\mathrm{pair}}$，且 $G \\leq \\tau_{\\mathrm{global}}$ 时，测试通过。其中 $\\tau_{\\mathrm{pair}}$ 和 $\\tau_{\\mathrm{global}}$ 是指定的容差。\n\n所有计算必须以国际单位制进行，距离单位为米，力以牛顿表示。最终输出必须以牛顿为单位显示 $G$。\n\n需实现和评估的测试套件：\n\n- 测试用例 1 (正常路径，中等间距和混合电荷):\n    - 位置 (单位：米): $\\left[[0,0,0],[0.01,0,0],[0,0.02,0]\\right]$.\n    - 电荷 (单位：库仑): $\\left[1\\times 10^{-6},-2\\times 10^{-6},5\\times 10^{-7}\\right]$.\n    - 配对容差 $\\tau_{\\mathrm{pair}} = 1\\times 10^{-12}$.\n    - 全局容差 $\\tau_{\\mathrm{global}} = 1\\times 10^{-12}$.\n- 测试用例 2 (边界奇点：两个重合电荷):\n    - 位置 (单位：米): $\\left[[0,0,0],[0,0,0],[0,0,0.03]\\right]$.\n    - 电荷 (单位：库仑): $\\left[1\\times 10^{-9},-1\\times 10^{-9},2\\times 10^{-9}\\right]$.\n    - 配对容差 $\\tau_{\\mathrm{pair}} = 1\\times 10^{-12}$.\n    - 全局容差 $\\tau_{\\mathrm{global}} = 1\\times 10^{-12}$.\n- 测试用例 3 (零电荷边缘情况):\n    - 位置 (单位：米): $\\left[[0,0,0],[0.01,0,0],[0,0,0.03]\\right]$.\n    - 电荷 (单位：库仑): $\\left[0,1\\times 10^{-6},-1\\times 10^{-6}\\right]$.\n    - 配对容差 $\\tau_{\\mathrm{pair}} = 1\\times 10^{-12}$.\n    - 全局容差 $\\tau_{\\mathrm{global}} = 1\\times 10^{-12}$.\n- 测试用例 4 (多尺度几何构型和电荷量级):\n    - 位置 (单位：米): $\\left[[0,0,0],[0.001,0.002,0],[0.1,0,0],[0,0.05,0.05],[0.03,0.04,0]\\right]$.\n    - 电荷 (单位：库仑): $\\left[1\\times 10^{-6},-3\\times 10^{-6},2\\times 10^{-9},-7\\times 10^{-9},5\\times 10^{-7}\\right]$.\n    - 配对容差 $\\tau_{\\mathrm{pair}} = 1\\times 10^{-12}$.\n    - 全局容差 $\\tau_{\\mathrm{global}} = 1\\times 10^{-12}$.\n\n最终输出规范：\n\n- 为每个测试用例生成有序列表 $\\left[P, m_{\\max}, G, V, K\\right]$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身也是一个列表。例如：$\\left[\\left[\\text{True},0.0,0.0,0,1.0\\right],\\left[\\text{False},\\dots\\right],\\dots\\right]$。\n- 将 $G$ 以牛顿为单位表示为十进制数。通过/失败条目必须是布尔值，计数必须是整数。所有其他条目必须是浮点数。",
            "solution": "我们设计了一个基于原理的数值测试，其根植于叠加原理、库仑定律和牛顿第三定律，并辅以诊断工具，用以量化因数值浮点计算或不适定几何构型可能引起的偏差。\n\n从叠加原理开始：对于一组位于位置 $\\{\\mathbf{x}_i\\}$ 的点电荷 $\\{q_i\\}$，作用在电荷 $q_i$ 上的总力为 $\\mathbf{F}_i = \\sum_{j\\neq i} \\mathbf{F}_{ij}$，其中 $\\mathbf{F}_{ij}$ 是电荷 $q_j$ 施加于电荷 $q_i$ 的力。点电荷的库仑定律提供了成对力。设位移矢量为 $\\mathbf{r}_{ij} = \\mathbf{x}_j - \\mathbf{x}_i$，其大小为 $r_{ij} = \\|\\mathbf{r}_{ij}\\|_2$。从 $q_i$ 指向 $q_j$ 的单位矢量为 $\\hat{\\mathbf{r}}_{ij} = \\frac{\\mathbf{r}_{ij}}{r_{ij}}$。库仑常数为 $k=\\frac{1}{4\\pi \\varepsilon_0}$，其中真空介电常数 $\\varepsilon_0 = 8.8541878128\\times 10^{-12}$ 法拉/米。在国际单位制中，力为\n$$\n\\mathbf{F}_{ij} = k\\, \\frac{q_i q_j}{r_{ij}^2}\\, \\hat{\\mathbf{r}}_{ij}.\n$$\n根据牛顿第三定律，对于每个 $r_{ij} \\neq 0$ 的对 $\\{i,j\\}$，必须有 $\\mathbf{F}_{ji} = -\\mathbf{F}_{ij}$。在精确算术和理想化的点电荷模型下，这一点由库仑定律的对称性以及 $\\hat{\\mathbf{r}}_{ij}$ 与 $\\hat{\\mathbf{r}}_{ji}$ 的构造所保证。在数值上，浮点舍入和极端的尺度差异可能导致微小的残差违背。\n\n为测试对称性，为每个无序对定义残差矢量\n$$\n\\mathbf{M}_{ij} = \\mathbf{F}_{ij} + \\mathbf{F}_{ji},\n$$\n和相对失配\n$$\nm_{ij} = \\frac{\\|\\mathbf{M}_{ij}\\|_2}{\\|\\mathbf{F}_{ij}\\|_2 + \\|\\mathbf{F}_{ji}\\|_2}.\n$$\n分子捕捉了数值建模下该对作用-反作用对称性的净失效，而分母设定了尺度，使该度量无量纲化并在不同量级间具有可解释性。如果 $r_{ij}=0$，则模型是奇异的；此类对被标记为违例，并从力的计算中排除。叠加原理得出每个粒子的合力\n$$\n\\mathbf{F}_i = \\sum_{j\\neq i} \\mathbf{F}_{ij}, \\quad \\mathbf{F}_{\\mathrm{tot}} = \\sum_i \\mathbf{F}_i.\n$$\n理想情况下，由于牛顿第三定律对所有对求和，应有 $\\mathbf{F}_{\\mathrm{tot}}=\\mathbf{0}$，但在数值上我们通过其范数 G 来量化残差\n$$\nG = \\|\\mathbf{F}_{\\mathrm{tot}}\\|_2,\n$$\n该值以牛顿表示。\n\n为量化几何多尺度敏感性，定义间距条件数\n$$\nK = \\frac{\\max\\{r_{ij}: r_{ij} > 0\\}}{\\min\\{r_{ij}: r_{ij} > 0\\}},\n$$\n它衡量了成对间距的分布范围。在跨尺度求和时，较大的 $K$ 会放大浮点敏感性。如果不存在有效的非零间距，则定义 $K=+\\infty$。\n\n诊断和通过/失败标准：\n- 计算所有 $r_{ij}>0$ 的有效对中的 $m_{\\max} = \\max\\{m_{ij}\\}$。\n- 将违例对 $V$ 计数为 $r_{ij}=0$ 或 $m_{ij} > \\tau_{\\mathrm{pair}}$ 的无序对的数量。\n- 当且仅当不存在奇异对（即没有 $r_{ij}=0$），$m_{\\max} \\leq \\tau_{\\mathrm{pair}}$，且 $G \\leq \\tau_{\\mathrm{global}}$ 时，测试通过。\n\n算法设计：\n- 遍历所有唯一的粒子对（$i  j$），计算成对的力和诊断量，并汇总结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef coulomb_constant():\n    # Vacuum permittivity (epsilon_0) in F/m\n    epsilon_0 = 8.8541878128e-12\n    # Coulomb constant k = 1/(4*pi*epsilon_0)\n    return 1.0 / (4.0 * np.pi * epsilon_0)\n\ndef pairwise_symmetry_tests(positions, charges, tol_pair, tol_global):\n    \"\"\"\n    Perform numerical symmetry tests for Coulomb forces and return diagnostics.\n    positions: (N,3) array in meters\n    charges: (N,) array in coulombs\n    tol_pair: relative tolerance for pair symmetry\n    tol_global: absolute tolerance for global net force norm (in newtons)\n    Returns: [P, m_max, G, V, K]\n    \"\"\"\n    k = coulomb_constant()\n    positions = np.asarray(positions, dtype=float)\n    charges = np.asarray(charges, dtype=float)\n    N = positions.shape[0]\n\n    # Accumulate forces on each particle\n    forces = np.zeros((N, 3), dtype=float)\n\n    # Collect diagnostics\n    rel_mismatches = []\n    distances = []\n    violating_pairs_count = 0\n    has_singular_pair = False\n\n    # Iterate over unordered pairs\n    for i in range(N):\n        for j in range(i + 1, N):\n            r_vec = positions[j] - positions[i]\n            r = np.linalg.norm(r_vec)\n            if r == 0.0:\n                # Singular pair: mark violation and skip force computation\n                violating_pairs_count += 1\n                has_singular_pair = True\n                continue\n            # Record nonzero separation for condition number\n            distances.append(r)\n            # Unit vector\n            r_hat = r_vec / r\n            # Pair forces (SI units)\n            fij = k * charges[i] * charges[j] / (r * r) * r_hat\n            fji = -fij  # Using Newton's third law symmetry\n            # Action-reaction residual and relative mismatch\n            m_vec = fij + fji\n            denom = np.linalg.norm(fij) + np.linalg.norm(fji)\n            # Protect against zero denominators (e.g., zero charges)\n            if denom == 0.0:\n                rel = 0.0\n            else:\n                rel = np.linalg.norm(m_vec) / denom\n            rel_mismatches.append(rel)\n            # Count if exceeds pair tolerance\n            if rel > tol_pair:\n                violating_pairs_count += 1\n            # Superposition accumulation\n            forces[i] += fij\n            forces[j] += fji\n\n    # Global diagnostics\n    F_tot = np.sum(forces, axis=0)\n    G = float(np.linalg.norm(F_tot))  # net force norm in newtons\n\n    # Maximum relative mismatch\n    if rel_mismatches:\n        m_max = float(np.max(rel_mismatches))\n    else:\n        m_max = 0.0\n\n    # Separation condition number\n    if distances:\n        K = float(np.max(distances) / np.min(distances))\n    else:\n        K = float('inf')\n\n    # Pass criterion\n    P = (not has_singular_pair) and (m_max = tol_pair) and (G = tol_global)\n\n    return [P, m_max, G, int(violating_pairs_count), K]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1: happy path\n        (\n            np.array([[0.0, 0.0, 0.0],\n                      [0.01, 0.0, 0.0],\n                      [0.0, 0.02, 0.0]], dtype=float),\n            np.array([1e-6, -2e-6, 5e-7], dtype=float),\n            1e-12,  # pair tolerance\n            1e-12   # global tolerance in newtons\n        ),\n        # Test case 2: singular pair (coincident charges)\n        (\n            np.array([[0.0, 0.0, 0.0],\n                      [0.0, 0.0, 0.0],\n                      [0.0, 0.0, 0.03]], dtype=float),\n            np.array([1e-9, -1e-9, 2e-9], dtype=float),\n            1e-12,\n            1e-12\n        ),\n        # Test case 3: zero-charge edge case\n        (\n            np.array([[0.0, 0.0, 0.0],\n                      [0.01, 0.0, 0.0],\n                      [0.0, 0.0, 0.03]], dtype=float),\n            np.array([0.0, 1e-6, -1e-6], dtype=float),\n            1e-12,\n            1e-12\n        ),\n        # Test case 4: multiscale geometry and charges\n        (\n            np.array([[0.0, 0.0, 0.0],\n                      [0.001, 0.002, 0.0],\n                      [0.1, 0.0, 0.0],\n                      [0.0, 0.05, 0.05],\n                      [0.03, 0.04, 0.0]], dtype=float),\n            np.array([1e-6, -3e-6, 2e-9, -7e-9, 5e-7], dtype=float),\n            1e-12,\n            1e-12\n        )\n    ]\n\n    results = []\n    for positions, charges, tol_pair, tol_global in test_cases:\n        result = pairwise_symmetry_tests(positions, charges, tol_pair, tol_global)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n    def format_item(item):\n        if isinstance(item, bool):\n            return \"True\" if item else \"False\"\n        elif isinstance(item, (int, np.integer)):\n            return str(int(item))\n        elif isinstance(item, float):\n            # Use repr-like formatting to preserve inf and small magnitudes\n            return str(item)\n        elif isinstance(item, list):\n            return \"[\" + \",\".join(format_item(x) for x in item) + \"]\"\n        else:\n            # Fallback for numpy types\n            if isinstance(item, np.bool_):\n                return \"True\" if bool(item) else \"False\"\n            elif isinstance(item, np.floating):\n                return str(float(item))\n            elif isinstance(item, np.integer):\n                return str(int(item))\n            else:\n                return str(item)\n\n    print(\"[\" + \",\".join(format_item(r) for r in results) + \"]\")\n\nsolve()\n```"
        }
    ]
}