{
    "hands_on_practices": [
        {
            "introduction": "第一个实践将我们带入分子动力学中选择时间步长最基本的约束条件。我们将探讨系统中最快的运动（例如高频键振动）如何为保证积分算法的数值稳定性而对 $\\Delta t$ 施加一个严格的上限。这个练习  提供了一个直接计算该稳定性极限的方法，将一个物理频率转化为对我们模拟参数的实用约束。",
            "id": "3742725",
            "problem": "一场多尺度分子动力学模拟将一个粗粒化区域与一个从头算反应区域耦合起来。在反应区域中，平衡点附近最硬的化学键可以被建模为一个一维谐振子，其运动由牛顿第二定律 $m\\,\\ddot{q}(t) + k\\,q(t) = 0$ 决定。其中，$m$ 是原子折合质量，$k$ 是平衡点附近势能的有效曲率，$q(t)$ 是键坐标。该振子的角频率为 $\\omega = \\sqrt{k/m}$。你采用一种显式辛算法（Störmer–Verlet算法，也称速度Verlet算法）来积分运动方程，并希望为存在的最高振动模式选择一个微观时间步长 $\\Delta t$，该步长在稳定性和长期能量行为方面是保守的。\n\n从谐振子模型和显式二阶格式的离散时间更新结构出发，论证使用一个小的无量纲积分参数 $\\eta \\equiv \\Delta t\\,\\omega$ 来解析最快振荡的必要性。为减小相位误差和能量漂移，对$\\eta$采用一个保守的上界，对于最硬的模式，取 $\\eta \\leq 0.2$。反应键的近平衡角频率估计值为 $\\omega = 5 \\times 10^{14}\\ \\text{rad/s}$。\n\n推导与$\\eta$的界限一致的最大允许微观时间步长 $\\Delta t_{\\max}$，并计算其值。最终答案以飞秒 (fs) 为单位表示，并四舍五入到三位有效数字。",
            "solution": "核心任务是确定用于数值积分系统中作为一维谐振子建模的最硬振动模式的运动方程的最大允许时间步长 $\\Delta t_{\\max}$。该积分必须满足给定的关于精度和稳定性的约束条件。\n\n谐振子的运动方程为：\n$$m\\,\\ddot{q}(t) + k\\,q(t) = 0$$\n其中 $m$ 是折合质量，$k$ 是力常数。该振子的固有角频率为 $\\omega = \\sqrt{k/m}$。\n\n这个二阶常微分方程的数值积分使用时间步长 $\\Delta t$ 来执行。显式积分格式（如 Störmer-Verlet 算法）的稳定性和精度关键取决于时间步长与系统中存在的最高频率的乘积。这种关系由无量纲参数 $\\eta$ 捕获，定义为：\n$$\\eta \\equiv \\Delta t\\,\\omega$$\n\n问题指出，为了实现长期能量守恒和减小相位误差，该参数必须有界。指定了一个保守的上界：\n$$\\eta \\leq 0.2$$\n\n此条件确保时间步长足够小，能够以足够的分辨率解析最快的振荡周期 $T = 2\\pi/\\omega$。条件 $\\Delta t\\,\\omega \\leq 0.2$ 等价于 $\\Delta t \\leq 0.2/\\omega$。由于周期是 $T = 2\\pi/\\omega$，这可以重写为 $\\Delta t \\leq 0.2 \\frac{T}{2\\pi} \\approx 0.032\\,T$。这意味着时间步长必须大约是振荡周期的 $1/30$，这是分子动力学中确保精度的常用经验法则。\n\n问题要求的是最大允许时间步长 $\\Delta t_{\\max}$。这个最大值对应于给定约束中的等式情况：\n$$\\eta_{\\max} = \\Delta t_{\\max}\\,\\omega = 0.2$$\n\n我们可以解此方程得到 $\\Delta t_{\\max}$：\n$$\\Delta t_{\\max} = \\frac{0.2}{\\omega}$$\n\n问题给出了系统中最高角频率的值：\n$$\\omega = 5 \\times 10^{14}\\ \\text{rad/s}$$\n\n将此值代入 $\\Delta t_{\\max}$ 的表达式中：\n$$\\Delta t_{\\max} = \\frac{0.2}{5 \\times 10^{14}\\ \\text{s}^{-1}}$$\n\n进行计算：\n$$\\Delta t_{\\max} = \\frac{2 \\times 10^{-1}}{5 \\times 10^{14}}\\ \\text{s} = 0.4 \\times 10^{-15}\\ \\text{s}$$\n\n最终答案必须以飞秒 (fs) 为单位表示。转换关系为 $1\\ \\text{fs} = 10^{-15}\\ \\text{s}$。因此：\n$$\\Delta t_{\\max} = 0.4\\ \\text{fs}$$\n\n最后，问题要求答案应四舍五入到三位有效数字。为了用三位有效数字表示 $0.4$，我们将其写为 $0.400$。\n\n因此，最大允许的微观时间步长是 $0.400\\ \\text{fs}$。",
            "answer": "$$\\boxed{0.400}$$"
        },
        {
            "introduction": "除了基本的稳定性，选择最佳时间步长还涉及到在不同数值误差来源之间的精妙权衡。本练习探讨了截断误差（随 $\\Delta t$ 减小而降低）与舍入误差（随积分步数增加而累积，因此会因 $\\Delta t$ 减小而加剧）之间的相互作用。通过分析这种平衡，我们可以理解模拟时长和计算机精度等因素如何影响 $\\Delta t$ 的理想选择 ，从而超越单一的硬性限制，进入更细致的优化层面。",
            "id": "3742689",
            "problem": "一个质量为 $m$、角频率为 $\\omega$ 的单自由度谐振子，可作为分子动力学 (MD) 系统中最快键合振动的近似模型。其运动满足牛顿第二定律 $m\\,\\ddot{x}=-m\\,\\omega^{2} x$。该系统在浮点运算下，使用时间步长为 $\\Delta t$ 的速度 Verlet 方法进行积分，总物理时间为 $T$。设 $N=T/\\Delta t$ 为步数，单位舍入误差为 $\\epsilon$。考虑关于振荡系统的辛积分和浮点运算的以下标准、经过充分检验的事实：\n- 速度 Verlet 方法是辛方法且具有二阶精度，因此其全局状态误差的量级为 $\\mathcal{O}(\\Delta t^{2})$，能量误差在某个附近的修正哈密顿量周围保持有界振荡，振幅与 $\\Delta t^{2}$ 成正比。\n- 浮点舍入误差表现为均值为零、近似不相关的微扰，其均方根大小与每次操作的 $\\epsilon$ 乘以一个特征尺度的积成正比；在 $N$ 个独立步骤中，此类微扰的均方根累积与 $\\sqrt{N}$ 成正比。\n\n假设存在依赖于问题和方法的常数 $K_{\\mathrm{tr}}$ 和 $K_{\\mathrm{ro}}$，使得：\n- 由截断引起的能量畸变具有特征振幅 $K_{\\mathrm{tr}}\\,\\Delta t^{2}$，对于固定的 $\\Delta t$，该值与 $T$ 无关。\n- 在 $N$ 步中，累积舍入误差对能量贡献的均方根与 $K_{\\mathrm{ro}}\\,E\\,\\epsilon\\,\\sqrt{N}$ 成比例，其中 $E$ 是谐振子的特征能量尺度。\n\n此外，对于线性谐振子，速度 Verlet 方法存在一个形式为 $\\Delta t\\,\\omega\\alpha$ 的稳定性阈值，其中 $\\alpha$ 是一个依赖于方法的常数。\n\n在长时间的 MD 模拟中，关于单精度与双精度对 $\\Delta t$ 选择的相互影响，以下哪些陈述是正确的？选择所有适用的选项。\n\nA. 平衡有界截断能量畸变 $K_{\\mathrm{tr}}\\,\\Delta t^{2}$ 与均方根舍入累积 $K_{\\mathrm{ro}}\\,E\\,\\epsilon\\,\\sqrt{T/\\Delta t}$，可得到一个最优标度关系 $\\Delta t \\sim C\\,(\\epsilon^{2}\\,T)^{1/5}$，其中 $C>0$ 为某个常数；因此，最优的 $\\Delta t$ 随 $\\epsilon$ 和 $T$ 的增大而增大。\n\nB. 对于相同的 $T$，从双精度 ($\\epsilon_{\\mathrm{dp}}\\approx 10^{-16}$) 转换到单精度 ($\\epsilon_{\\mathrm{sp}}\\approx 10^{-7}$)，会使平衡点向更大的 $\\Delta t$ 移动，因子约为 $(\\epsilon_{\\mathrm{sp}}/\\epsilon_{\\mathrm{dp}})^{2/5}$，因此单精度倾向于（在稳定性限制内）选择一个更大的 $\\Delta t$ 以减轻舍入误差的累积。\n\nC. 在一个最快角频率为 $\\omega_{\\max}$ 的多尺度 MD 系统中，任何通过平衡截断误差和舍入误差选择的 $\\Delta t$ 都必须同时满足稳定性和精度约束；一个实用的规则是 $\\Delta t^{\\star}=\\min\\{\\alpha/\\omega_{\\max},\\,C(\\epsilon^{2}T)^{1/5}\\}$，其中合适的常数 $\\alpha$ 和 $C$ 由方法和问题尺度决定。\n\nD. 如果每步的舍入误差是均值为零且不相关的，那么在时间 $T$ 之后，对能量的总舍入误差贡献与 $N$（而不是 $\\sqrt{N}$）成正比，从而得到一个最优平衡关系 $\\Delta t\\propto \\epsilon^{1/3}\\,T^{1/3}$。\n\nE. 由于辛积分器精确守恒一个修正的哈密顿量，舍入误差不会随长时间累积；因此，在双精度下，最优的 $\\Delta t$ 与 $T$ 无关。",
            "solution": "### 最优时间步长的推导\n\n能量的总误差是系统性截断误差和随机性舍入误差的组合。寻找最优时间步长 $\\Delta t$ 的一种标准方法是平衡这两种误差贡献的大小。\n\n由截断引起的能量畸变大小由下式给出：\n$$E_{\\mathrm{tr}} = K_{\\mathrm{tr}}\\,\\Delta t^{2}$$\n累积舍入误差的均方根 (RMS) 大小由下式给出：\n$$E_{\\mathrm{ro}} = K_{\\mathrm{ro}}\\,E\\,\\epsilon\\,\\sqrt{N}$$\n代入 $N=T/\\Delta t$（其中 $T$ 是总模拟时间），我们得到舍入误差对 $\\Delta t$ 的依赖关系：\n$$E_{\\mathrm{ro}} = K_{\\mathrm{ro}}\\,E\\,\\epsilon\\,\\sqrt{\\frac{T}{\\Delta t}} = K_{\\mathrm{ro}}\\,E\\,\\epsilon\\,\\sqrt{T}\\,\\Delta t^{-1/2}$$\n为了找到最小化总误差的最优 $\\Delta t$，我们令两种误差源的大小相等：\n$$E_{\\mathrm{tr}} = E_{\\mathrm{ro}}$$\n$$K_{\\mathrm{tr}}\\,\\Delta t^{2} = K_{\\mathrm{ro}}\\,E\\,\\epsilon\\,\\sqrt{T}\\,\\Delta t^{-1/2}$$\n现在，我们求解 $\\Delta t$：\n$$\\Delta t^{2 + 1/2} = \\frac{K_{\\mathrm{ro}}\\,E\\,\\epsilon\\,\\sqrt{T}}{K_{\\mathrm{tr}}}$$\n$$\\Delta t^{5/2} = \\frac{K_{\\mathrm{ro}}\\,E\\,\\epsilon\\,T^{1/2}}{K_{\\mathrm{tr}}}$$\n将两边都取 $2/5$ 次方：\n$$\\Delta t = \\left( \\frac{K_{\\mathrm{ro}}\\,E}{K_{\\mathrm{tr}}} \\right)^{2/5} (\\epsilon\\,T^{1/2})^{2/5}$$\n$$\\Delta t = \\left( \\frac{K_{\\mathrm{ro}}\\,E}{K_{\\mathrm{tr}}} \\right)^{2/5} \\epsilon^{2/5} T^{1/5}$$\n这可以写成 $\\Delta t \\sim C\\,(\\epsilon^{2}\\,T)^{1/5}$ 的形式，其中 $C = \\left( \\frac{K_{\\mathrm{ro}}\\,E}{K_{\\mathrm{tr}}} \\right)^{2/5}$ 是一个取决于问题和方法，但与 $\\epsilon$、$T$ 或 $\\Delta t$ 无关的正常数。\n标度关系为 $\\Delta t \\propto \\epsilon^{2/5} T^{1/5}$。\n\n### 逐项分析\n\n**A. 平衡有界截断能量畸变 $K_{\\mathrm{tr}}\\,\\Delta t^{2}$ 与均方根舍入累积 $K_{\\mathrm{ro}}\\,E\\,\\epsilon\\,\\sqrt{T/\\Delta t}$，可得到一个最优标度关系 $\\Delta t \\sim C\\,(\\epsilon^{2}\\,T)^{1/5}$，其中 $C>0$ 为某个常数；因此，最优的 $\\Delta t$ 随 $\\epsilon$ 和 $T$ 的增大而增大。**\n\n上面的推导得出 $\\Delta t \\propto \\epsilon^{2/5} T^{1/5}$，可以重写为 $\\Delta t \\propto (\\epsilon^2)^{1/5} (T)^{1/5} = (\\epsilon^{2}\\,T)^{1/5}$。这与选项中给出的标度律相符。比例常数 $C$ 是正的，因为它是由其他正的物理和数值常数推导出来的。\n该陈述还声称，最优的 $\\Delta t$ 随 $\\epsilon$ 和 $T$ 的增大而增大。\n-   对 $\\epsilon$ 的依赖性：$\\Delta t \\propto \\epsilon^{2/5}$。由于指数 $2/5$ 是正的，更大的 $\\epsilon$（更差的精度）导致更大的最优 $\\Delta t$。\n-   对 $T$ 的依赖性：$\\Delta t \\propto T^{1/5}$。由于指数 $1/5$ 是正的，更长的总积分时间 $T$ 也导致更大的最优 $\\Delta t$。这是长时间模拟中的一个著名结果：为了控制随机游走舍入误差的增长，必须采取更少（因此更大）的步数。\n陈述的两个部分都与推导一致。\n\n**结论：正确**\n\n**B. 对于相同的 $T$，从双精度 ($\\epsilon_{\\mathrm{dp}}\\approx 10^{-16}$) 转换到单精度 ($\\epsilon_{\\mathrm{sp}}\\approx 10^{-7}$)，会使平衡点向更大的 $\\Delta t$ 移动，因子约为 $(\\epsilon_{\\mathrm{sp}}/\\epsilon_{\\mathrm{dp}})^{2/5}$，因此单精度倾向于（在稳定性限制内）选择一个更大的 $\\Delta t$ 以减轻舍入误差的累积。**\n\n根据在固定 $T$ 下推导出的标度关系 $\\Delta t \\propto \\epsilon^{2/5}$，我们可以求出单精度（$\\Delta t_{\\mathrm{sp}}$）和双精度（$\\Delta t_{\\mathrm{dp}}$）下最优时间步长的比值：\n$$\\frac{\\Delta t_{\\mathrm{sp}}}{\\Delta t_{\\mathrm{dp}}} = \\frac{ C\\,(\\epsilon_{\\mathrm{sp}}^{2}\\,T)^{1/5} }{ C\\,(\\epsilon_{\\mathrm{dp}}^{2}\\,T)^{1/5} } = \\left( \\frac{\\epsilon_{\\mathrm{sp}}}{\\epsilon_{\\mathrm{dp}}} \\right)^{2/5}$$\n这与陈述中给出的因子相符。由于 $\\epsilon_{\\mathrm{sp}} \\approx 10^{-7}$ 远大于 $\\epsilon_{\\mathrm{dp}} \\approx 10^{-16}$，比值 $\\epsilon_{\\mathrm{sp}}/\\epsilon_{\\mathrm{dp}}$ 是一个大的正数，这意味着因子 $(\\epsilon_{\\mathrm{sp}}/\\epsilon_{\\mathrm{dp}})^{2/5}$ 大于 1。这正确地意味着 $\\Delta t_{\\mathrm{sp}}  \\Delta t_{\\mathrm{dp}}$，所以“单精度倾向于选择一个更大的 $\\Delta t$”。所提供的理由，“以减轻舍入误差的累积”，也是正确的。由于单精度下每步的舍入误差更大，对于给定的总误差容限，必须减少步数 $N$，这需要增大 $\\Delta t$。\n\n**结论：正确**\n\n**C. 在一个最快角频率为 $\\omega_{\\max}$ 的多尺度 MD 系统中，任何通过平衡截断误差和舍入误差选择的 $\\Delta t$ 都必须同时满足稳定性和精度约束；一个实用的规则是 $\\Delta t^{\\star}=\\min\\{\\alpha/\\omega_{\\max},\\,C(\\epsilon^{2}T)^{1/5}\\}$，其中合适的常数 $\\alpha$ 和 $C$ 由方法和问题尺度决定。**\n\n问题陈述指出，谐振子是最快振动的近似模型。在一个具有多种频率的真实系统中，显式积分器的稳定性受到最高频率 $\\omega_{\\max}$ 的限制。因此，一个硬性约束是 $\\Delta t  \\alpha / \\omega_{\\max}$，以避免数值发散。从平衡误差推导出的最优时间步长 $\\Delta t_{\\mathrm{opt}} = C(\\epsilon^{2}T)^{1/5}$ 代表了总误差最小的点。然而，一个实际的时间步长选择 $\\Delta t^{\\star}$ 不能违反稳定性。因此，$\\Delta t^{\\star}$ 必须小于或等于稳定性极限和理论最优值。如果 $\\Delta t_{\\mathrm{opt}}$ 大于稳定性极限，就必须使用一个更小的 $\\Delta t$，并接受误差平衡不是最优的（截断误差将远小于舍入误差）。表达式 $\\Delta t^{\\star}=\\min\\{\\alpha/\\omega_{\\max},\\,C(\\epsilon^{2}T)^{1/5}\\}$ 正确地形式化了这一逻辑：所选的时间步长是稳定性限制值和最优平衡值中较小的一个。\n\n**结论：正确**\n\n**D. 如果每步的舍入误差是均值为零且不相关的，那么在时间 $T$ 之后，对能量的总舍入误差贡献与 $N$（而不是 $\\sqrt{N}$）成正比，从而得到一个最优平衡关系 $\\Delta t\\propto \\epsilon^{1/3}\\,T^{1/3}$。**\n\n该陈述的前提与问题中提供的信息直接矛盾。问题陈述指出，对于此类微扰，均方根误差的累积与 $\\sqrt{N}$ 成正比。这是随机游走的标准结果（方差按 $N$ 累积，因此标准差或均方根误差按 $\\sqrt{N}$ 累积）。声称误差贡献与 $N$ 成正比是错误的。虽然从这个错误的前提（平衡 $K_{\\mathrm{tr}}\\Delta t^2$ 与 $K' \\epsilon T/\\Delta t$）可以推导出 $\\Delta t\\propto \\epsilon^{1/3}\\,T^{1/3}$，但这个前提本身是无效的。\n\n**结论：错误**\n\n**E. 由于辛积分器精确守恒一个修正的哈密顿量，舍入误差不会随长时间累积；因此，在双精度下，最优的 $\\Delta t$ 与 $T$ 无关。**\n\n这个陈述包含一个关键的误解。守恒修正哈密顿量的性质是精确数学算法的一个特征，它假设了无限精度运算。现实世界的计算是在浮点运算下执行的，这会在每一步引入舍入误差。这些舍入误差破坏了精确的辛性质，并阻止数值轨迹停留在修正哈密顿量的等值面上。正如问题前提中正确指出的，这些误差会累积。“舍入误差不累积”的说法是错误的，并与问题设置直接矛盾。因此，最优 $\\Delta t$ 与 $T$ 无关的结论也是错误的。对 $T$ 的依赖性正是因为更长的积分时间 $T$ 意味着更多的步数 $N$，导致更大的舍入误差累积，这必须通过调整 $\\Delta t$ 来抵消。\n\n**结论：错误**",
            "answer": "$$\\boxed{ABC}$$"
        },
        {
            "introduction": "这最后一个实践将前面的概念综合成一个具体的、算法化的时间步长选择方法，这正是在实际研究中所使用的过程。我们将设计一个方案，用一组明确的、基于物理的准则（数值稳定性、长期能量守恒和完整约束的准确性）系统地测试候选的 $\\Delta t$ 值。这个练习  将理论原则转化为一个实用的决策工具，展示了如何在计算成本和模拟保真度之间进行务实的平衡。",
            "id": "3742765",
            "problem": "您的任务是形式化并实现一个有原则的、基于物理的程序，以为温度 $T=300\\,\\mathrm{K}$ 的液态水模拟选择分子动力学时间步长 $\\Delta t$。该程序必须基于多尺度建模的考量。该程序必须从基本原理出发，并能操作化为一个算法，该算法使用基于能量漂移和完整约束偏差的指定接受标准，同时尊重与最快振动模式相关的稳定性条件，以飞秒 $\\mathrm{(fs)}$ 为单位输出推荐的 $\\Delta t$。\n\n从牛顿第二运动定律和分子动力学（MD）中使用的哈密顿动力学的标准离散化开始。假设离散化是使用时间可逆的辛算法方案进行的，并且约束（如果存在）由迭代求解器强制执行。您对 $\\Delta t$ 的选择必须通过多尺度推理来证明：最快的振动模式施加了稳定性限制，而缓慢的集体运动则促使我们使用尽可能大的 $\\Delta t$ 而不违反准确性标准。\n\n设计并实现一个算法，对于提供的测试套件中的每个参数集，计算在 $[0.1,6.0]\\,\\mathrm{fs}$ 范围内、四舍五入到两位小数的最大 $\\Delta t$，该 $\\Delta t$ 同时满足以下所有三个条件：\n- 遵守从最快模式的线性化推导出的显式稳定性界限：$\\Delta t  \\dfrac{2}{\\omega_{\\max}}$，其中 $\\omega_{\\max}$ 是从提供的振动波数 $\\tilde{\\nu}$（单位为 $\\mathrm{cm^{-1}}$）和可选的氢质量重分配因子 $s \\ge 1$（无量纲）推断出的最大角频率（单位为 $\\mathrm{rad/fs}$）。使用物理上正确的转换公式 $\\omega_{\\max} = \\dfrac{2\\pi c \\tilde{\\nu}}{\\sqrt{s}}\\times 10^{-15}$，其中光速 $c=2.99792458\\times 10^{10}\\,\\mathrm{cm/s}$。\n- 每纳秒的能量漂移不超过阈值：$D_E^{\\mathrm{ns}}(\\Delta t) \\le E_{\\mathrm{thr}}^{\\mathrm{ns}}$，其中 $E_{\\mathrm{thr}}^{\\mathrm{ns}} = 0.5\\,\\mathrm{kJ/mol}$，$D_E^{\\mathrm{ns}}(\\Delta t)$ 被建模为一个可校准的代理模型，该模型根据提供的系数 $a_E$（单位为 $\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$）和指数 $p$（无量纲）随 $\\Delta t$ 缩放。将 $D_E^{\\mathrm{ps}}(\\Delta t) = a_E\\left(\\dfrac{\\Delta t}{\\mathrm{fs}}\\right)^p$ 视为以 $\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$ 为单位的漂移率，并通过 $D_E^{\\mathrm{ns}}(\\Delta t)=1000\\,D_E^{\\mathrm{ps}}(\\Delta t)$ 将其转换为纳秒单位，然后再进行阈值判断。\n- 每个时间步的均方根（RMS）完整约束偏差不超过 $R_{\\mathrm{thr}} = 1\\times 10^{-4}\\,\\mathrm{nm}$，建模为 $R(\\Delta t) = a_C\\left(\\dfrac{\\Delta t}{\\mathrm{fs}}\\right)^r$，其中系数 $a_C$（单位为 $\\mathrm{nm}$）和指数 $r$（无量纲）已提供。如果不存在约束，则设置 $a_C=0$。\n\n该算法必须在 $[0.1,6.0]\\,\\mathrm{fs}$ 区间内，以 $0.01\\,\\mathrm{fs}$ 的粒度对候选时间步长进行离散搜索，并返回满足所有三个标准的最大候选值。如果没有候选值满足所有标准，则返回 $\\Delta t=0.00\\,\\mathrm{fs}$。\n\n所有输出必须以 $\\mathrm{fs}$ 为单位表示，并四舍五入到两位小数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[\\Delta t_1,\\Delta t_2,\\ldots]$），其中每个 $\\Delta t_i$ 都是一个四舍五入到两位小数的浮点数。\n\n测试套件：\n对于每种情况，您都将获得如上所述的 $(\\tilde{\\nu}, s, a_E, a_C, p, r)$。温度为 $T=300\\,\\mathrm{K}$，但这已隐含在 $a_E$ 的校准中。\n\n- 情况 1（无约束的柔性水）：$\\tilde{\\nu}=3600\\,\\mathrm{cm^{-1}}$, $s=1$, $a_E=1\\times 10^{-4}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=0\\,\\mathrm{nm}$, $p=2$, $r=2$。\n- 情况 2（约束 O–H 键，良好约束）：$\\tilde{\\nu}=1600\\,\\mathrm{cm^{-1}}$, $s=1$, $a_E=1\\times 10^{-4}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=2\\times 10^{-5}\\,\\mathrm{nm}$, $p=2$, $r=2$。\n- 情况 3（带约束的氢质量重分配 (HMR)）：$\\tilde{\\nu}=1600\\,\\mathrm{cm^{-1}}$, $s=3$, $a_E=5\\times 10^{-5}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=1\\times 10^{-5}\\,\\mathrm{nm}$, $p=2$, $r=2$。\n- 情况 4（有约束，求解器容差较差）：$\\tilde{\\nu}=1600\\,\\mathrm{cm^{-1}}$, $s=1$, $a_E=7\\times 10^{-5}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=5\\times 10^{-5}\\,\\mathrm{nm}$, $p=2$, $r=2$。\n- 情况 5（极端能量漂移情景）：$\\tilde{\\nu}=1600\\,\\mathrm{cm^{-1}}$, $s=1$, $a_E=1\\times 10^{-1}\\,\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$, $a_C=1\\times 10^{-5}\\,\\mathrm{nm}$, $p=2$, $r=2$。\n\n您的程序必须实现上述过程，并输出单行结果，其中包含每种情况下推荐的 $\\Delta t$（单位为 $\\mathrm{fs}$，四舍五入到两位小数），格式为 $[\\Delta t_1,\\Delta t_2,\\Delta t_3,\\Delta t_4,\\Delta t_5]$。",
            "solution": "该问题要求制定并实现一个选择分子动力学 (MD) 模拟最佳时间步长 $\\Delta t$ 的程序。该选择必须基于物理原理，平衡数值稳定性（倾向于小的 $\\Delta t$）和计算效率（倾向于大的 $\\Delta t$）这两个相互竞争的需求。该过程涉及同时满足三个不同的标准：与最快振动频率相关的稳定性界限、关于总能量守恒的准确性界限，以及关于完整约束满足情况的准确性界限。\n\n经典 MD 中的基本运动方程是牛顿第二定律，对于一个包含 $N$ 个粒子的系统：\n$$ m_i \\dfrac{d^2\\mathbf{r}_i}{dt^2} = \\mathbf{F}_i(\\mathbf{r}_1, \\dots, \\mathbf{r}_N) $$\n其中 $m_i$、$\\mathbf{r}_i$ 和 $\\mathbf{F}_i$ 分别是粒子 $i$ 的质量、位置和力。数值积分方案，例如 Verlet 算法，被用来离散化这些方程并在时间上推进系统。时间步长 $\\Delta t$ 的选择对模拟质量至关重要。我们将建立从离散搜索空间中选择最佳 $\\Delta t$ 的标准。\n\n该算法必须在区间 $[0.1, 6.0]\\,\\mathrm{fs}$ 内以 $0.01\\,\\mathrm{fs}$ 的粒度找到满足以下所有三个条件的最大 $\\Delta t$。\n\n**条件 1：数值稳定性**\n\n常见的时间可逆辛积分器（如 Velocity Verlet 算法）的稳定性受限于系统中存在的最高频率 $\\omega_{\\max}$。最快模式的动力学可以近似为一个简谐振子。对于这样的振子，如果时间步长过大，Verlet 方案会变得不稳定。稳定性条件是 $\\omega_{\\max} \\Delta t \\le 2$。问题指定了严格不等式，我们将遵守它：\n$$ \\Delta t  \\dfrac{2}{\\omega_{\\max}} $$\n最大角频率 $\\omega_{\\max}$ 由最快的振动模式决定，其特征是波数 $\\tilde{\\nu}$（单位为 $\\mathrm{cm^{-1}}$）。从波数到角频率的转换是 $\\omega = 2\\pi c \\tilde{\\nu}$，其中 $c$ 是光速。单位必须保持一致。给定 $c$ 的单位为 $\\mathrm{cm/s}$，频率 $\\omega$ 的单位是 $\\mathrm{rad/s}$。为了将 $\\omega$ 表示为 $\\mathrm{rad/fs}$，我们使用转换关系 $1\\,\\mathrm{s} = 10^{15}\\,\\mathrm{fs}$：\n$$ \\omega_{\\max} \\, [\\mathrm{rad/fs}] = (2\\pi c \\tilde{\\nu}) \\times 10^{-15} $$\n问题还引入了氢质量重分配 (HMR) 技术，该技术通过人为地将氢原子的质量增加一个因子 $s \\ge 1$ 来减慢最快的振动。由于谐振子的频率与 $1/\\sqrt{m}$ 成正比（其中 $m$ 是质量），将相关质量增加一个因子 $s$ 会使频率降低一个因子 $\\sqrt{s}$。因此，$\\omega_{\\max}$ 的公式为：\n$$ \\omega_{\\max} = \\dfrac{2\\pi c \\tilde{\\nu}}{\\sqrt{s}} \\times 10^{-15} $$\n将此代入稳定性不等式，得到对 $\\Delta t$ 的第一个约束。\n\n**条件 2：能量守恒准确性**\n\n对于一个孤立系统（微正则 NVE 系综），总能量应该是守恒的。数值积分器会引入离散化误差，导致总能量随时间漂移。这种能量漂移率是衡量模拟准确性的一个关键指标。问题提供了一个关于每皮秒漂移率（$D_E^{\\mathrm{ps}}$）作为时间步长函数的代理模型：\n$$ D_E^{\\mathrm{ps}}(\\Delta t) = a_E \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^p $$\n其中 $a_E$ 是一个校准过的系数，单位为 $\\mathrm{kJ\\,mol^{-1}\\,ps^{-1}}$，$p$ 是一个无量纲指数（对于二阶积分器，通常 $p=2$）。接受标准基于每纳秒的能量漂移 $D_E^{\\mathrm{ns}}(\\Delta t)$，它就是每皮秒漂移的一千倍：\n$$ D_E^{\\mathrm{ns}}(\\Delta t) = 1000 \\cdot D_E^{\\mathrm{ps}}(\\Delta t) = 1000 \\cdot a_E \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^p $$\n该漂移不得超过指定的阈值 $E_{\\mathrm{thr}}^{\\mathrm{ns}} = 0.5\\,\\mathrm{kJ/mol}$。因此，第二个条件是：\n$$ 1000 \\cdot a_E \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^p \\le E_{\\mathrm{thr}}^{\\mathrm{ns}} $$\n\n**条件 3：完整约束准确性**\n\n为了消除最快的振动运动（例如 O-H 键伸缩）并允许使用更大的 $\\Delta t$，通常会应用完整约束。像 SHAKE 或 RATTLE 这样的算法在每个时间步迭代地强制执行这些约束。这些求解器具有有限的容差，导致与理想约束几何形状有微小偏差。均方根 (RMS) 偏差是衡量此误差的指标。问题用一个幂律来模拟这种偏差 $R(\\Delta t)$：\n$$ R(\\Delta t) = a_C \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^r $$\n其中 $a_C$ 是一个校准过的系数，单位为 $\\mathrm{nm}$，$r$ 是一个无量纲指数。此偏差不得超过阈值 $R_{\\mathrm{thr}} = 1 \\times 10^{-4}\\,\\mathrm{nm}$。这给出了第三个条件：\n$$ a_C \\left( \\dfrac{\\Delta t}{\\mathrm{fs}} \\right)^r \\le R_{\\mathrm{thr}} $$\n如果不使用约束，$a_C=0$，此条件因为 $0 \\le R_{\\mathrm{thr}}$ 而自然满足。\n\n**算法流程**\n\n最终的算法综合了这三个条件。为了找到允许的最大 $\\Delta t$，我们在区间 $[0.1, 6.0]\\,\\mathrm{fs}$ 上以 $0.01\\,\\mathrm{fs}$ 的步长进行离散搜索。搜索从最大值 $\\Delta t = 6.00\\,\\mathrm{fs}$ 向下进行。对于每个候选的 $\\Delta t$，我们检查是否满足所有三个不等式。第一个满足所有条件的 $\\Delta t$ 就是所求的结果，因为它将是最大的一个。如果在指定范围内搜索完成仍未找到任何有效的 $\\Delta t$，则结果取为 $0.00\\,\\mathrm{fs}$。\n\n对于给定的参数集 $(\\tilde{\\nu}, s, a_E, a_C, p, r)$，流程如下：\n1. 定义常量：$c=2.99792458\\times 10^{10}\\,\\mathrm{cm/s}$，$E_{\\mathrm{thr}}^{\\mathrm{ns}} = 0.5\\,\\mathrm{kJ/mol}$，$R_{\\mathrm{thr}} = 1\\times 10^{-4}\\,\\mathrm{nm}$。\n2. 预先计算稳定性极限：$\\Delta t_{\\mathrm{stable}}^{\\max} = \\dfrac{2 \\sqrt{s}}{2\\pi c \\tilde{\\nu} \\times 10^{-15}}$。\n3. 从 $6.00\\,\\mathrm{fs}$ 向下迭代 $\\Delta t$ 到 $0.10\\,\\mathrm{fs}$，步长为 $0.01\\,\\mathrm{fs}$。\n4. 对每个 $\\Delta t$：\n    a. 检查稳定性：是否 $\\Delta t  \\Delta t_{\\mathrm{stable}}^{\\max}$？\n    b. 检查能量漂移：是否 $1000 \\cdot a_E (\\Delta t)^p \\le E_{\\mathrm{thr}}^{\\mathrm{ns}}$？（这里 $\\Delta t$ 是以 fs 为单位的数值）。\n    c. 检查约束偏差：是否 $a_C (\\Delta t)^r \\le R_{\\mathrm{thr}}$？\n5. 如果所有三个检查都通过，则此 $\\Delta t$ 是解。记录它并转到下一个测试用例。\n6. 如果循环结束，则没有找到有效的 $\\Delta t$。解为 $0.00\\,\\mathrm{fs}$。\n然后将此过程应用于所提供的五个测试用例中的每一个。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the largest valid molecular dynamics time step based on stability,\n    energy drift, and constraint deviation criteria.\n    \"\"\"\n\n    # Physical and simulation constants\n    C_LIGHT = 2.99792458e10  # Speed of light in cm/s\n    E_THR_NS = 0.5  # Energy drift threshold in kJ/mol/ns\n    R_THR = 1.0e-4  # Constraint deviation threshold in nm\n\n    # Test suite: (nu_tilde, s, a_E, a_C, p, r)\n    test_cases = [\n        # Case 1: Unconstrained flexible water\n        (3600, 1, 1e-4, 0, 2, 2),\n        # Case 2: Constrained O-H bonds, good constraints\n        (1600, 1, 1e-4, 2e-5, 2, 2),\n        # Case 3: Hydrogen Mass Repartitioning (HMR) with constraints\n        (1600, 3, 5e-5, 1e-5, 2, 2),\n        # Case 4: Constrained, poor solver tolerance\n        (1600, 1, 7e-5, 5e-5, 2, 2),\n        # Case 5: Extreme energy drift scenario\n        (1600, 1, 1e-1, 1e-5, 2, 2),\n    ]\n\n    results = []\n    \n    # Define the search space for delta_t in femtoseconds\n    # Search from largest to smallest to find the max valid dt first\n    dt_candidates = np.arange(6.00, 0.09, -0.01)\n\n    for case in test_cases:\n        nu_tilde, s, a_E, a_C, p, r = case\n        \n        found_dt = 0.00\n\n        # Condition 1: Stability\n        # omega_max is in rad/fs\n        omega_max = (2 * np.pi * C_LIGHT * nu_tilde / np.sqrt(s)) * 1e-15\n        dt_stability_limit = 2.0 / omega_max\n\n        for dt in dt_candidates:\n            # Check condition 1\n            cond1 = (dt  dt_stability_limit)\n\n            # Check condition 2: Energy drift\n            # dt is already in fs, as required by the formula's implicit unit\n            energy_drift_ns = 1000.0 * a_E * (dt ** p)\n            cond2 = (energy_drift_ns = E_THR_NS)\n\n            # Check condition 3: Constraint deviation\n            constraint_dev = a_C * (dt ** r)\n            cond3 = (constraint_dev = R_THR)\n\n            if cond1 and cond2 and cond3:\n                # Found the largest valid dt, as we are iterating downwards.\n                # Round to two decimal places as per problem spec\n                found_dt = np.round(dt, 2)\n                break\n        \n        results.append(found_dt)\n\n    # Format the final output string exactly as required.\n    # Use \"{:.2f}\".format() to ensure two decimal places are always shown (e.g., 0.00)\n    formatted_results = [f\"{res:.2f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}