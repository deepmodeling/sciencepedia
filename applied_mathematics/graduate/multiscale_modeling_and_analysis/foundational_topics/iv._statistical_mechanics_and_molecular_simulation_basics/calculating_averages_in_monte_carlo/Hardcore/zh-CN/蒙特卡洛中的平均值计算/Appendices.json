{
    "hands_on_practices": [
        {
            "introduction": "在任何蒙特卡罗模拟中，一个基本问题是如何确定为达到所需精度和置信度所需的样本数量。这个练习将引导您从第一性原理（即子高斯矩生成函数界和马尔可夫不等式）出发，推导出样本均值误差的非渐近集中不等式，从而将抽象的概率理论与具体的实验设计任务联系起来。通过这个实践，您将掌握如何量化估计器的可靠性，并为实际计算任务确定充分的样本量。",
            "id": "3739081",
            "problem": "模拟一个慢-快多尺度系统，以估计一个定义如下的粗粒化可观测量。对于一个固定的慢变量状态，设 $X$ 表示在一个从其平稳分布中抽取的快过程微观态上评估的有界利普希茨可观测量的值。假设 $X$ 具有有限均值 $\\mu$ 且为次高斯分布，其代理方差参数为 $s^{2}$，即其中心矩生成函数 (MGF) 对所有 $\\lambda \\in \\mathbb{R}$ 满足，\n$$\n\\mathbb{E}\\big[\\exp\\big(\\lambda\\,(X-\\mu)\\big)\\big] \\le \\exp\\!\\left(\\frac{s^{2}\\,\\lambda^{2}}{2}\\right).\n$$\n您运行 $M$ 次独立的微观模拟，以获得 $X$ 的独立同分布样本 $X_{1},\\dots,X_{M}$，并构建蒙特卡洛平均值 $\\overline{X}_{M} \\equiv \\frac{1}{M}\\sum_{i=1}^{M} X_{i}$。\n\n从次高斯 MGF 界和马尔可夫不等式出发，且不使用任何渐近近似，推导偏差 $\\overline{X}_{M}-\\mu$ 的非渐近双边集中界。然后，使用此界，确定保证下式的最小整数 $M$：\n$$\n\\mathbb{P}\\big(|\\overline{X}_{M}-\\mu| \\le \\varepsilon\\big) \\ge 1-\\delta\n$$\n对于具体参数 $s^{2} = 0.36$，$\\varepsilon = 0.03$ 和 $\\delta = 0.005$。将最小的 $M$ 报告为精确整数。无需按有效数字进行四舍五入。",
            "solution": "首先验证该问题，以确保其具有科学依据、良定且客观。\n\n### 步骤 1：提取已知条件\n- 随机变量 $X$ 表示在一个从其平稳分布中抽取的快过程微观态上评估的可观测量。\n- $X$ 具有有限均值 $\\mu$。\n- $X$ 是次高斯分布，代理方差参数为 $s^{2}$。\n- $X$ 的中心矩生成函数 (MGF) 对所有 $\\lambda \\in \\mathbb{R}$ 满足 $\\mathbb{E}[\\exp(\\lambda(X-\\mu))] \\le \\exp\\left(\\frac{s^{2}\\lambda^{2}}{2}\\right)$。\n- $X_{1}, \\dots, X_{M}$ 是 $X$ 的独立同分布 (i.i.d.) 样本。\n- 蒙特卡洛平均定义为 $\\overline{X}_{M} \\equiv \\frac{1}{M}\\sum_{i=1}^{M} X_{i}$。\n- 任务是从给定的 MGF 界和马尔可夫不等式出发，推导偏差 $\\overline{X}_{M}-\\mu$ 的非渐近双边集中界。\n- 随后，确定保证 $\\mathbb{P}(|\\overline{X}_{M}-\\mu| \\le \\varepsilon) \\ge 1-\\delta$ 的最小整数 $M$。\n- 具体参数为 $s^{2} = 0.36$，$\\varepsilon = 0.03$ 和 $\\delta = 0.005$。\n\n### 步骤 2：使用已知条件进行验证\n该问题在科学上是合理的。次高斯随机变量及其 MGF 界的理念是现代概率论和统计学中的标准工具。使用 i.i.d. 样本构建蒙特卡洛平均的设置是基础性的。从第一性原理（MGF 界和马尔可夫不等式）推导集中不等式（霍夫丁不等式的一种形式）的要求是一项标准的教科书练习，被称为切诺夫界方法。该问题是良定的，因为预期会有一个唯一的最小整数 $M$。语言精确客观。所有必要的数据和定义都已提供。因此，该问题是有效的。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整解答。\n\n### 解答推导\n目标是找到样本均值与真实均值偏差概率的一个界。具体来说，我们想要为某个 $\\varepsilon > 0$ 找到 $\\mathbb{P}(|\\overline{X}_{M}-\\mu| \\ge \\varepsilon)$ 的一个上界。我们将首先界定单边概率 $\\mathbb{P}(\\overline{X}_{M}-\\mu \\ge \\varepsilon)$ 和 $\\mathbb{P}(\\overline{X}_{M}-\\mu \\le -\\varepsilon)$，然后使用并集界将它们组合起来，从而推导出这个界。\n\n设 $Y_i = X_i - \\mu$。变量 $Y_i$ 是独立同分布的，其均值为 $\\mathbb{E}[Y_i] = 0$。$X_i$ 的 MGF 界意味着对于每个 $Y_i$：\n$$\n\\mathbb{E}[\\exp(\\lambda Y_i)] \\le \\exp\\left(\\frac{s^{2}\\lambda^{2}}{2}\\right)\n$$\n样本均值的偏差为 $\\overline{X}_{M} - \\mu = \\frac{1}{M}\\sum_{i=1}^{M} (X_i - \\mu) = \\frac{1}{M}\\sum_{i=1}^{M} Y_i$。\n\n我们首先界定正偏差的概率，$\\mathbb{P}(\\overline{X}_{M} - \\mu \\ge \\varepsilon)$。使用切诺夫界方法，对于任何 $\\lambda > 0$：\n$$\n\\mathbb{P}(\\overline{X}_{M} - \\mu \\ge \\varepsilon) = \\mathbb{P}\\left(\\frac{1}{M}\\sum_{i=1}^{M} Y_i \\ge \\varepsilon\\right) = \\mathbb{P}\\left(\\sum_{i=1}^{M} Y_i \\ge M\\varepsilon\\right)\n$$\n由于 $\\lambda > 0$，指数函数是单调递增的，所以事件保持不变：\n$$\n\\mathbb{P}\\left(\\sum_{i=1}^{M} Y_i \\ge M\\varepsilon\\right) = \\mathbb{P}\\left(\\exp\\left(\\lambda \\sum_{i=1}^{M} Y_i\\right) \\ge \\exp(\\lambda M\\varepsilon)\\right)\n$$\n我们应用马尔可夫不等式，该不等式指出对于非负随机变量 $Z$ 和任何 $a > 0$，有 $\\mathbb{P}(Z \\ge a) \\le \\frac{\\mathbb{E}[Z]}{a}$。设 $Z = \\exp(\\lambda \\sum Y_i)$ 和 $a = \\exp(\\lambda M\\varepsilon)$。\n$$\n\\mathbb{P}(\\overline{X}_{M} - \\mu \\ge \\varepsilon) \\le \\frac{\\mathbb{E}\\left[\\exp\\left(\\lambda \\sum_{i=1}^{M} Y_i\\right)\\right]}{\\exp(\\lambda M\\varepsilon)}\n$$\n由于 $Y_i$ 是独立的，乘积的期望等于期望的乘积：\n$$\n\\mathbb{E}\\left[\\exp\\left(\\lambda \\sum_{i=1}^{M} Y_i\\right)\\right] = \\mathbb{E}\\left[\\prod_{i=1}^{M} \\exp(\\lambda Y_i)\\right] = \\prod_{i=1}^{M} \\mathbb{E}[\\exp(\\lambda Y_i)]\n$$\n对每个 $Y_i$ 使用次高斯 MGF 界：\n$$\n\\prod_{i=1}^{M} \\mathbb{E}[\\exp(\\lambda Y_i)] \\le \\prod_{i=1}^{M} \\exp\\left(\\frac{s^{2}\\lambda^{2}}{2}\\right) = \\left(\\exp\\left(\\frac{s^{2}\\lambda^{2}}{2}\\right)\\right)^{M} = \\exp\\left(\\frac{M s^{2}\\lambda^{2}}{2}\\right)\n$$\n将此代回概率不等式中：\n$$\n\\mathbb{P}(\\overline{X}_{M} - \\mu \\ge \\varepsilon) \\le \\frac{\\exp\\left(\\frac{M s^{2}\\lambda^{2}}{2}\\right)}{\\exp(\\lambda M\\varepsilon)} = \\exp\\left(\\frac{M s^{2}\\lambda^{2}}{2} - M\\lambda\\varepsilon\\right)\n$$\n这个界对任何 $\\lambda > 0$ 都成立。为了获得最紧的界，我们对指数中的表达式关于 $\\lambda$ 求最小值。设 $f(\\lambda) = \\frac{M s^{2}\\lambda^{2}}{2} - M\\lambda\\varepsilon$。通过将其导数设为零来找到最小值：\n$$\n\\frac{df}{d\\lambda} = M s^{2}\\lambda - M\\varepsilon = 0 \\implies \\lambda = \\frac{M\\varepsilon}{Ms^{2}} = \\frac{\\varepsilon}{s^{2}}\n$$\n由于 $\\varepsilon > 0$ 且 $s^{2} > 0$，这个 $\\lambda$ 的值为正。将这个最优的 $\\lambda$ 代回指数中：\n$$\n\\frac{M s^{2}}{2}\\left(\\frac{\\varepsilon}{s^{2}}\\right)^{2} - M\\left(\\frac{\\varepsilon}{s^{2}}\\right)\\varepsilon = \\frac{M s^{2}\\varepsilon^{2}}{2s^{4}} - \\frac{M\\varepsilon^{2}}{s^{2}} = \\frac{M\\varepsilon^{2}}{2s^{2}} - \\frac{M\\varepsilon^{2}}{s^{2}} = -\\frac{M\\varepsilon^{2}}{2s^{2}}\n$$\n因此，单边界为：\n$$\n\\mathbb{P}(\\overline{X}_{M} - \\mu \\ge \\varepsilon) \\le \\exp\\left(-\\frac{M\\varepsilon^{2}}{2s^{2}}\\right)\n$$\n类似的论证也适用于另一侧的尾部概率 $\\mathbb{P}(\\overline{X}_{M} - \\mu \\le -\\varepsilon)$。这等价于 $\\mathbb{P}(-\\sum Y_i \\ge M\\varepsilon)$。我们可以对随机变量 $-Y_i$ 使用相同的技巧。由于 MGF 界 $\\mathbb{E}[\\exp(\\lambda Y_i)] \\le \\exp(s^2 \\lambda^2 / 2)$ 对所有 $\\lambda \\in \\mathbb{R}$ 成立，它关于 $\\lambda = 0$ 是对称的。$-Y_i$ 的 MGF 是 $\\mathbb{E}[\\exp(\\lambda(-Y_i))] = \\mathbb{E}[\\exp((-\\lambda)Y_i)] \\le \\exp(s^2(-\\lambda)^2/2) = \\exp(s^2\\lambda^2/2)$。因此，$-Y_i$ 具有相同的次高斯界，并且根据对称性：\n$$\n\\mathbb{P}(\\overline{X}_{M} - \\mu \\le -\\varepsilon) \\le \\exp\\left(-\\frac{M\\varepsilon^{2}}{2s^{2}}\\right)\n$$\n为了获得双边界，我们使用并集界：$\\mathbb{P}(A \\cup B) \\le \\mathbb{P}(A) + \\mathbb{P}(B)$。\n$$\n\\mathbb{P}(|\\overline{X}_{M} - \\mu| \\ge \\varepsilon) = \\mathbb{P}\\left( (\\overline{X}_{M} - \\mu \\ge \\varepsilon) \\cup (\\overline{X}_{M} - \\mu \\le -\\varepsilon) \\right)\n$$\n$$\n\\mathbb{P}(|\\overline{X}_{M} - \\mu| \\ge \\varepsilon) \\le \\mathbb{P}(\\overline{X}_{M} - \\mu \\ge \\varepsilon) + \\mathbb{P}(\\overline{X}_{M} - \\mu \\le -\\varepsilon)\n$$\n$$\n\\mathbb{P}(|\\overline{X}_{M} - \\mu| \\ge \\varepsilon) \\le \\exp\\left(-\\frac{M\\varepsilon^{2}}{2s^{2}}\\right) + \\exp\\left(-\\frac{M\\varepsilon^{2}}{2s^{2}}\\right) = 2\\exp\\left(-\\frac{M\\varepsilon^{2}}{2s^{2}}\\right)\n$$\n这就是所求的非渐近双边集中界。\n\n### 最小样本量 $M$ 的计算\n我们给定的要求是 $\\mathbb{P}(|\\overline{X}_{M}-\\mu| \\le \\varepsilon) \\ge 1-\\delta$。这等价于：\n$$\n1 - \\mathbb{P}(|\\overline{X}_{M}-\\mu| > \\varepsilon) \\ge 1-\\delta\n$$\n由于 $\\overline{X}_{M}$ 的分布可能是离散的，事件 $|\\overline{X}_{M}-\\mu| > \\varepsilon$ 是 $|\\overline{X}_{M}-\\mu| \\ge \\varepsilon$ 的一个子集。因此，$\\mathbb{P}(|\\overline{X}_{M}-\\mu| > \\varepsilon) \\le \\mathbb{P}(|\\overline{X}_{M}-\\mu| \\ge \\varepsilon)$。为满足要求，只需确保：\n$$\n\\mathbb{P}(|\\overline{X}_{M}-\\mu| \\ge \\varepsilon) \\le \\delta\n$$\n使用推导出的界，我们必须找到满足以下条件的最小整数 $M$：\n$$\n2\\exp\\left(-\\frac{M\\varepsilon^{2}}{2s^{2}}\\right) \\le \\delta\n$$\n我们现在求解 $M$。\n$$\n\\exp\\left(-\\frac{M\\varepsilon^{2}}{2s^{2}}\\right) \\le \\frac{\\delta}{2}\n$$\n对两边取自然对数（由于 $\\ln$ 是一个增函数，不等号方向不变）：\n$$\n-\\frac{M\\varepsilon^{2}}{2s^{2}} \\le \\ln\\left(\\frac{\\delta}{2}\\right)\n$$\n两边乘以 $-1$ 使不等号反向：\n$$\n\\frac{M\\varepsilon^{2}}{2s^{2}} \\ge -\\ln\\left(\\frac{\\delta}{2}\\right) = \\ln\\left(\\left(\\frac{\\delta}{2}\\right)^{-1}\\right) = \\ln\\left(\\frac{2}{\\delta}\\right)\n$$\n最后，求解 $M$：\n$$\nM \\ge \\frac{2s^{2}}{\\varepsilon^{2}}\\ln\\left(\\frac{2}{\\delta}\\right)\n$$\n现在我们代入给定的参数值：$s^{2} = 0.36$，$\\varepsilon = 0.03$ 和 $\\delta = 0.005$。\n- $\\varepsilon^{2} = (0.03)^{2} = 0.0009$。\n- $\\frac{2s^{2}}{\\varepsilon^{2}} = \\frac{2 \\times 0.36}{0.0009} = \\frac{0.72}{0.0009} = \\frac{7200}{9} = 800$。\n- $\\frac{2}{\\delta} = \\frac{2}{0.005} = \\frac{2}{5/1000} = \\frac{2000}{5} = 400$。\n因此 $M$ 的不等式变为：\n$$\nM \\ge 800 \\ln(400)\n$$\n使用计算器计算 $\\ln(400)$ 的值：\n$$\n\\ln(400) \\approx 5.991464547\n$$\n因此：\n$$\nM \\ge 800 \\times 5.991464547 \\approx 4793.171638\n$$\n由于 $M$ 必须是整数，满足此条件的最小整数 $M$ 是这个数字的向上取整。\n$$\nM = \\lceil 4793.171638 \\rceil = 4794\n$$\n因此，至少需要 $4794$ 次独立的微观模拟才能保证所需的精度和置信水平。",
            "answer": "$$\n\\boxed{4794}\n$$"
        },
        {
            "introduction": "在确定了保证结果精度的样本数量之后，下一步自然是思考如何更有效地利用计算资源。分层抽样是一种强大的方差缩减技术，它通过将总体划分为若干子层并优化各层的样本分配来提高估计效率。本练习将挑战您在固定的总计算预算下，推导出最优的样本分配策略，以最小化分层蒙特卡罗估计器的方差，这是设计高效多尺度模拟的关键技能。",
            "id": "3739095",
            "problem": "在一个双尺度多尺度系统中，慢变量 $S$ 在 $\\{1,\\ldots,K\\}$ 中取值，其概率为 $\\{p_i\\}_{i=1}^K$。在 $S=i$ 的条件下，一个快速的微观模拟器会生成同分布的样本 $\\{X_{ij}\\}_{j=1}^{n_i}$，其条件期望为 $\\mu_i=\\mathbb{E}[f(X)\\mid S=i]$，条件方差为 $\\sigma_i^2=\\mathrm{Var}(f(X)\\mid S=i)$。我们感兴趣的量是总体平均值 $\\mu=\\mathbb{E}[f(X)]=\\sum_{i=1}^K p_i \\mu_i$。在第 $i$ 层中，每个微观样本的计算成本为 $c_i0$。您构建了分层蒙特卡洛（MC）估计量 $\\hat{\\mu}=\\sum_{i=1}^K p_i \\bar{f}_i$，其中 $\\bar{f}_i=\\frac{1}{n_i}\\sum_{j=1}^{n_i} f(X_{ij})$，在满足 $\\sum_{i=1}^K c_i n_i=C$ 的固定总预算 $C0$ 下。在每个层内，样本是独立同分布的，并且不同层是独立模拟的。您计划采用一种自适应方案，该方案使用初始引导（pilot）来估计 $\\sigma_i$，然后根据比例规则 $n_i \\propto \\phi(p_i,\\sigma_i,c_i)$ 分配剩余样本，目标是在大样本情况下，在预算约束下最小化 $\\hat{\\mu}$ 的渐近方差，此时可以放宽对 $\\{n_i\\}$ 的整数约束。\n\n对于固定的总预算 $C$，以下哪种关于 $n_i$ 的比例规则能够实现渐近最小方差？\n\nA. $n_i \\propto p_i\\,\\sigma_i\\,\\sqrt{c_i}$\n\nB. $n_i \\propto p_i\\,\\sigma_i\\,/\\,\\sqrt{c_i}$\n\nC. $n_i \\propto p_i\\,\\sigma_i^{2}\\,/\\,c_i$\n\nD. $n_i \\propto p_i^{2}\\,\\sigma_i^{2}\\,/\\,\\sqrt{c_i}$\n\nE. $n_i \\propto p_i\\,/\\,\\sqrt{c_i}$",
            "solution": "用户希望我找到分层蒙特卡洛模拟中样本大小的最优分配规则，以在固定的计算预算下最小化估计量的方差。\n\n### 步骤 1：提取已知条件\n\n问题陈述提供了以下信息：\n-   一个具有慢变量 $S$ 的多尺度系统，其在 $\\{1, 2, \\ldots, K\\}$ 中取值。\n-   慢变量处于状态 $i$ 的概率为 $P(S=i) = p_i$。\n-   对于每个状态 $i$，一个微观模拟器会生成 $n_i$ 个样本 $\\{X_{ij}\\}_{j=1}^{n_i}$。\n-   给定 $S=i$ 时，函数 $f(X)$ 的条件期望为 $\\mu_i = \\mathbb{E}[f(X) \\mid S=i]$。\n-   给定 $S=i$ 时，$f(X)$ 的条件方差为 $\\sigma_i^2 = \\mathrm{Var}(f(X) \\mid S=i)$。\n-   我们感兴趣的量是总体平均值 $\\mu = \\mathbb{E}[f(X)] = \\sum_{i=1}^K p_i \\mu_i$。\n-   在第 $i$ 层中，单个样本的计算成本为 $c_i > 0$。\n-   $\\mu$ 的分层蒙特卡洛估计量为 $\\hat{\\mu} = \\sum_{i=1}^K p_i \\bar{f}_i$，其中 $\\bar{f}_i = \\frac{1}{n_i} \\sum_{j=1}^{n_i} f(X_{ij})$ 是第 $i$ 层的样本均值。\n-   存在一个固定的总计算预算 $C > 0$，导致约束 $\\sum_{i=1}^K c_i n_i = C$。\n-   在一个层内的样本是独立同分布 (i.i.d.) 的，不同层之间的样本是独立的。\n-   目标是找到样本大小 $\\{n_i\\}$ 的比例规则，以最小化 $\\hat{\\mu}$ 的渐近方差，并允许 $n_i$ 为非整数值。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n该问题在科学和数学上是合理的。它描述了一个计算统计学中的标准且适定的问题，具体来说是分层抽样中的资源最优分配。\n-   **科学基础**：该设置是分层蒙特卡洛的一个典型例子，这是数值方法、统计学和多尺度建模中的一种基本技术。所使用的所有概念（期望、方差、估计量、成本函数）都是标准的。\n-   **适定性**：该任务是一个约束优化问题：在一个线性约束（预算）下最小化一个函数（估计量的方差）。这类问题是适定的，并且通常有唯一解，可以使用拉格朗日乘子法等方法找到。问题明确允许放宽样本大小的整数约束，这使得优化问题可以用微积分来处理。\n-   **目标**：问题是用精确、无歧义的数学语言陈述的。\n\n该问题没有违反任何无效性标准。这是一个有效的、定义明确的、可解的问题。\n\n### 步骤 3：推导最优分配规则\n\n目标是在固定的总成本约束下，最小化估计量 $\\hat{\\mu}$ 的方差。\n\n**1. 构建目标函数：$\\hat{\\mu}$ 的方差**\n\n估计量由 $\\hat{\\mu} = \\sum_{i=1}^K p_i \\bar{f}_i$ 给出。\n由于不同层的模拟是独立的，和的方差等于方差的和：\n$$ \\mathrm{Var}(\\hat{\\mu}) = \\mathrm{Var}\\left(\\sum_{i=1}^K p_i \\bar{f}_i\\right) = \\sum_{i=1}^K \\mathrm{Var}(p_i \\bar{f}_i) $$\n概率 $p_i$ 是常数，所以它们以平方的形式提出：\n$$ \\mathrm{Var}(\\hat{\\mu}) = \\sum_{i=1}^K p_i^2 \\mathrm{Var}(\\bar{f}_i) $$\n项 $\\bar{f}_i$ 是 $n_i$ 个独立同分布随机变量的样本均值，每个变量的方差为 $\\sigma_i^2$。样本均值的方差等于总体方差除以样本大小：\n$$ \\mathrm{Var}(\\bar{f}_i) = \\frac{\\mathrm{Var}(f(X) \\mid S=i)}{n_i} = \\frac{\\sigma_i^2}{n_i} $$\n将其代回，我们得到总方差，这就是我们要最小化的目标函数：\n$$ V(\\{n_i\\}) = \\mathrm{Var}(\\hat{\\mu}) = \\sum_{i=1}^K \\frac{p_i^2 \\sigma_i^2}{n_i} $$\n\n**2. 构建约束条件**\n\n总计算成本固定为 $C$。第 $i$ 层的成本是 $c_i n_i$。总成本是所有层的成本之和：\n$$ \\sum_{i=1}^K c_i n_i = C $$\n这可以写成一个约束函数 $G(\\{n_i\\}) = 0$：\n$$ G(\\{n_i\\}) = \\sum_{i=1}^K c_i n_i - C = 0 $$\n\n**3. 解决约束优化问题**\n\n我们使用拉格朗日乘子法。拉格朗日函数 $\\mathcal{L}$ 定义为：\n$$ \\mathcal{L}(\\{n_i\\}, \\lambda) = V(\\{n_i\\}) + \\lambda G(\\{n_i\\}) = \\left(\\sum_{i=1}^K \\frac{p_i^2 \\sigma_i^2}{n_i}\\right) + \\lambda \\left(\\sum_{i=1}^K c_i n_i - C\\right) $$\n为了找到最小值，我们将 $\\mathcal{L}$ 对每个 $n_k$（对于 $k=1, \\ldots, K$）的偏导数设为零：\n$$ \\frac{\\partial \\mathcal{L}}{\\partial n_k} = \\frac{\\partial}{\\partial n_k} \\left( \\frac{p_k^2 \\sigma_k^2}{n_k} \\right) + \\lambda \\frac{\\partial}{\\partial n_k} (c_k n_k) = 0 $$\n$$ -\\frac{p_k^2 \\sigma_k^2}{n_k^2} + \\lambda c_k = 0 $$\n重新整理这个方程以求解 $n_k^2$：\n$$ n_k^2 = \\frac{p_k^2 \\sigma_k^2}{\\lambda c_k} $$\n由于样本大小 $n_k$ 必须为正，我们取正平方根：\n$$ n_k = \\sqrt{\\frac{p_k^2 \\sigma_k^2}{\\lambda c_k}} = \\frac{p_k \\sigma_k}{\\sqrt{\\lambda} \\sqrt{c_k}} $$\n这里，$\\lambda$ 是拉格朗日乘子，它是一个与层索引 $k$ 无关的常数。因此，$1/\\sqrt{\\lambda}$ 也是一个比例常数。这就给出了最优分配 $n_k$ 的比例规则：\n$$ n_k \\propto \\frac{p_k \\sigma_k}{\\sqrt{c_k}} $$\n这个结果是直观的：我们应该为概率更高（大的 $p_k$）、内在变异性更大（大的 $\\sigma_k$）以及模拟成本更低（小的 $c_k$）的层分配更多的样本。\n\n### 评估选项\n\n基于推导出的比例关系 $n_i \\propto p_i\\,\\sigma_i\\,/\\,\\sqrt{c_i}$，我们评估每个选项：\n\n**A. $n_i \\propto p_i\\,\\sigma_i\\,\\sqrt{c_i}$**\n该规则建议为成本较高的层分配更多样本，这是不正确的。成本项应该在分母中。\n**结论：不正确。**\n\n**B. $n_i \\propto p_i\\,\\sigma_i\\,/\\,\\sqrt{c_i}$**\n该规则与我们推导出的最优分配完全匹配。\n**结论：正确。**\n\n**C. $n_i \\propto p_i\\,\\sigma_i^{2}\\,/\\,c_i$**\n该规则中标准差 $\\sigma_i$ 和成本 $c_i$ 的幂次都是错误的。正确的幂次是 $\\sigma_i$ 为 1， $c_i$ 为 1/2（在分母中）。\n**结论：不正确。**\n\n**D. $n_i \\propto p_i^{2}\\,\\sigma_i^{2}\\,/\\,\\sqrt{c_i}$**\n该规则中概率 $p_i$ 和标准差 $\\sigma_i$ 的幂次都是错误的。这些项在方差表达式中以平方形式出现，但优化结果得出的比例关系是它们的一次幂。\n**结论：不正确。**\n\n**E. $n_i \\propto p_i\\,/\\,\\sqrt{c_i}$**\n该规则忽略了标准差 $\\sigma_i$。这种分配仅在所有层的方差都相同（即，对所有 $i$，$\\sigma_i$ 是常数）的特殊情况下才是最优的，而这通常不成立。\n**结论：不正确。**",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "为了更深入地优化蒙特卡罗方法，理解方差的来源至关重要。一个复杂模型的总方差是由哪些输入变量或它们之间的相互作用主导的？本练习将介绍方差分析（ANOVA）分解，这是一种将总方差剖析为由单个输入（主效应）和输入组合（交互效应）贡献的部分的系统性方法。通过对一个多项式被积函数进行精确的方差分解，您将学会如何进行全局敏感性分析，识别模型中最具影响力的部分。",
            "id": "3739084",
            "problem": "在多尺度建模与分析的背景下，一个宏观可观测量是作为一个平方可积被积函数在独立微观输入下的总体均值来计算的。考虑一个蒙特卡洛（MC）估计情境，其中有独立的随机输入 $X$、$Y$ 和 $Z$，它们代表相互作用的粗尺度和细尺度。输入满足 $X \\sim \\text{Uniform}([0,1])$, $Y \\sim \\text{Uniform}([0,1])$ 和 $Z \\sim \\mathcal{N}(0,1)$，并且它们相互独立。被积函数为\n$$\nf(X,Y,Z) \\;=\\; \\mu \\;+\\; \\alpha\\,(X-\\tfrac{1}{2}) \\;+\\; \\beta\\,(Y-\\tfrac{1}{2}) \\;+\\; \\gamma\\,Z \\;+\\; \\delta\\,(X-\\tfrac{1}{2})(Y-\\tfrac{1}{2}) \\;+\\; \\varepsilon\\,(X-\\tfrac{1}{2})Z \\;+\\; \\eta\\,(Y-\\tfrac{1}{2})Z \\;+\\; \\theta\\,(X-\\tfrac{1}{2})(Y-\\tfrac{1}{2})Z,\n$$\n其中系数 $\\mu, \\alpha, \\beta, \\gamma, \\delta, \\varepsilon, \\eta, \\theta$ 为固定值。对于本问题，取 $\\mu = 0, \\alpha = 1, \\beta = 2, \\gamma = 3, \\delta = 4, \\varepsilon = 5, \\eta = 6, \\theta = 7$。\n\n从第一性原理（期望、方差和独立性的定义）出发，并且仅利用平方可积函数的结构以及由独立性和中心化导出的正交性，按照方差分析（ANOVA；也称为Hoeffding–Sobol分解）的思路，按交互阶数分解 $f$ 的方差。计算 $f$ 的总方差中可归因于二阶交互作用（即对 $(X,Y)$、$(X,Z)$ 和 $(Y,Z)$ 之间的交互作用）的精确分数 $\\Phi$，并表示为单个最简有理数。不要四舍五入；请提供 $\\Phi$ 的精确值。",
            "solution": "### 步骤 1：提取已知条件\n问题提供了以下信息：\n-   独立随机变量：$X$, $Y$, 和 $Z$。\n-   分布：$X \\sim \\text{Uniform}([0,1])$, $Y \\sim \\text{Uniform}([0,1])$, 和 $Z \\sim \\mathcal{N}(0,1)$。\n-   被积函数：$f(X,Y,Z) = \\mu + \\alpha(X-\\frac{1}{2}) + \\beta(Y-\\frac{1}{2}) + \\gamma Z + \\delta(X-\\frac{1}{2})(Y-\\frac{1}{2}) + \\varepsilon(X-\\frac{1}{2})Z + \\eta(Y-\\frac{1}{2})Z + \\theta(X-\\frac{1}{2})(Y-\\frac{1}{2})Z$。\n-   系数：$\\mu = 0$, $\\alpha = 1$, $\\beta = 2$, $\\gamma = 3$, $\\delta = 4$, $\\varepsilon = 5$, $\\eta = 6$, 和 $\\theta = 7$。\n-   目标：计算 $f$ 的总方差中可归因于二阶交互作用的精确分数 $\\Phi$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，是适定且客观的。\n-   **科学依据**：该问题涉及方差分析（ANOVA）或Hoeffding-Sobol分解，这是统计学、灵敏度分析和多尺度建模中用于量化输入变量对模型输出影响的一种标准而严谨的技术。指定的概率分布是标准的。被积函数 $f(X,Y,Z)$ 是其参数的多项式，确保其相对于给定的概率分布是平方可积的。\n-   **适定性**：问题已完全指定，包含所有必要的数据和关系。函数形式和分布允许对方差分解得到一个唯一、稳定且有意义的解。\n-   **客观性**：问题以精确的数学术语陈述，没有歧义或主观陈述。\n\n该问题是有效的，因为它代表了应用数学和统计学中的一个标准练习。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解答\n这个问题的核心是函数 $f(X,Y,Z)$ 的方差分析（ANOVA）分解，它利用了输入变量 $X, Y, Z$ 的统计独立性。这种分解将 $f$ 的总方差分离为来自单个变量（主效应）及其交互作用的贡献。\n\n为方便起见，根据 $f$ 的结构，我们定义中心化的随机变量：\n令 $X' = X - \\frac{1}{2}$ 和 $Y' = Y - \\frac{1}{2}$。变量 $Z$ 已经是中心化的。\n由于 $X \\sim \\text{Uniform}([0,1])$，其期望为 $\\mathbb{E}[X] = \\frac{1}{2}$。因此，中心化变量 $X'$ 的期望为零：$\\mathbb{E}[X'] = \\mathbb{E}[X - \\frac{1}{2}] = \\frac{1}{2} - \\frac{1}{2} = 0$。类似地，$\\mathbb{E}[Y'] = 0$。变量 $Z \\sim \\mathcal{N}(0,1)$ 给定为零均值，即 $\\mathbb{E}[Z]=0$。\n\n在区间 $[a,b]$ 上的均匀分布的方差是 $\\frac{(b-a)^2}{12}$。\n对于 $X \\sim \\text{Uniform}([0,1])$，$\\text{Var}(X) = \\frac{(1-0)^2}{12} = \\frac{1}{12}$。\n$X'$ 的方差与 $X$ 的方差相同，因为方差在平移下是不变的：$\\text{Var}(X') = \\text{Var}(X) = \\frac{1}{12}$。\n类似地，$\\text{Var}(Y') = \\text{Var}(Y) = \\frac{1}{12}$。\n对于 $Z \\sim \\mathcal{N}(0,1)$，方差为 $\\text{Var}(Z) = 1$。\n\n对于任何均值为零的随机变量 $W$，其方差是其平方的期望：$\\text{Var}(W) = \\mathbb{E}[(W-\\mathbb{E}[W])^2] = \\mathbb{E}[W^2]$。\n因此，我们有：\n$\\mathbb{E}[(X')^2] = \\text{Var}(X') = \\frac{1}{12}$\n$\\mathbb{E}[(Y')^2] = \\text{Var(Y')} = \\frac{1}{12}$\n$\\mathbb{E}[Z^2] = \\text{Var}(Z) = 1$\n\n将给定的系数和中心化变量代入 $f$ 的表达式中：\n$f(X,Y,Z) = 1 \\cdot X' + 2 \\cdot Y' + 3 \\cdot Z + 4 \\cdot X'Y' + 5 \\cdot X'Z + 6 \\cdot Y'Z + 7 \\cdot X'Y'Z$.\n$f$ 的期望是 $\\mathbb{E}[f]$。根据期望的线性性和独立性，任何包含至少一个中心化变量的项的期望为零。例如，$\\mathbb{E}[X'Y'] = \\mathbb{E}[X']\\mathbb{E}[Y'] = 0 \\cdot 0 = 0$。由于 $f$ 的求和式中的所有项都至少包含一个中心化变量，所以 $\\mathbb{E}[f]=0$。\n\n$f$ 的总方差是 $\\text{Var}(f) = \\mathbb{E}[f^2] - (\\mathbb{E}[f])^2 = \\mathbb{E}[f^2]$。\n函数 $f$ 以项的和的形式给出。我们将这些项表示为：\n$f_X = \\alpha X'$, $f_Y = \\beta Y'$, $f_Z = \\gamma Z$（一阶项）\n$f_{XY} = \\delta X'Y'$, $f_{XZ} = \\varepsilon X'Z$, $f_{YZ} = \\eta Y'Z$（二阶项）\n$f_{XYZ} = \\theta X'Y'Z$（三阶项）\n所以，$f = f_X + f_Y + f_Z + f_{XY} + f_{XZ} + f_{YZ} + f_{XYZ}$。\n\n这些项是相互正交的，意味着它们乘积的期望为零。对于任意两个不同的项 $f_S$ 和 $f_U$（其中 $S, U$ 是 $\\{X,Y,Z\\}$ 的子集），$\\mathbb{E}[f_S f_U] = 0$。这是因为乘积 $f_S f_U$ 将包含至少一个变量的奇次幂（本例中为1次幂），而该中心化变量的期望为零，由于独立性，使得整个期望为零。例如：\n$\\mathbb{E}[f_X f_{XY}] = \\mathbb{E}[(\\alpha X')(\\delta X'Y')] = \\alpha\\delta \\mathbb{E}[(X')^2 Y'] = \\alpha\\delta \\mathbb{E}[(X')^2] \\mathbb{E}[Y'] = \\alpha\\delta \\mathbb{E}[(X')^2] \\cdot 0 = 0$。\n\n由于这种正交性，和的方差等于方差的和：\n$\\text{Var}(f) = \\text{Var}(\\sum f_S) = \\sum \\text{Var}(f_S)$。\n每个偏方差 $\\text{Var}(f_S)$ 等于 $\\mathbb{E}[f_S^2]$，因为 $\\mathbb{E}[f_S]=0$。\n\n让我们计算偏方差：\n$D_X = \\text{Var}(f_X) = \\text{Var}(\\alpha X') = \\alpha^2 \\text{Var}(X') = 1^2 \\cdot \\frac{1}{12} = \\frac{1}{12}$。\n$D_Y = \\text{Var}(f_Y) = \\text{Var}(\\beta Y') = \\beta^2 \\text{Var}(Y') = 2^2 \\cdot \\frac{1}{12} = \\frac{4}{12}$。\n$D_Z = \\text{Var}(f_Z) = \\text{Var}(\\gamma Z) = \\gamma^2 \\text{Var}(Z) = 3^2 \\cdot 1 = 9$。\n\n$D_{XY} = \\text{Var}(f_{XY}) = \\mathbb{E}[(\\delta X'Y')^2] = \\delta^2 \\mathbb{E}[(X')^2]\\mathbb{E}[(Y')^2] = 4^2 \\cdot \\frac{1}{12} \\cdot \\frac{1}{12} = \\frac{16}{144}$。\n$D_{XZ} = \\text{Var}(f_{XZ}) = \\mathbb{E}[(\\varepsilon X'Z)^2] = \\varepsilon^2 \\mathbb{E}[(X')^2]\\mathbb{E}[Z^2] = 5^2 \\cdot \\frac{1}{12} \\cdot 1 = \\frac{25}{12}$。\n$D_{YZ} = \\text{Var}(f_{YZ}) = \\mathbb{E}[(\\eta Y'Z)^2] = \\eta^2 \\mathbb{E}[(Y')^2]\\mathbb{E}[Z^2] = 6^2 \\cdot \\frac{1}{12} \\cdot 1 = \\frac{36}{12} = 3$。\n\n$D_{XYZ} = \\text{Var}(f_{XYZ}) = \\mathbb{E}[(\\theta X'Y'Z)^2] = \\theta^2 \\mathbb{E}[(X')^2]\\mathbb{E}[(Y')^2]\\mathbb{E}[Z^2] = 7^2 \\cdot \\frac{1}{12} \\cdot \\frac{1}{12} \\cdot 1 = \\frac{49}{144}$。\n\n可归因于二阶交互作用的总方差 $D_{order\\_2}$ 是二阶项方差之和：\n$D_{order\\_2} = D_{XY} + D_{XZ} + D_{YZ} = \\frac{16}{144} + \\frac{25}{12} + 3$。\n为了将它们相加，我们使用公分母 $144$：\n$D_{order\\_2} = \\frac{16}{144} + \\frac{25 \\cdot 12}{144} + \\frac{3 \\cdot 144}{144} = \\frac{16 + 300 + 432}{144} = \\frac{748}{144}$。\n\n总方差 $D_{total}$ 是所有偏方差之和：\n$D_{total} = D_X + D_Y + D_Z + D_{XY} + D_{XZ} + D_{YZ} + D_{XYZ}$。\n$D_{total} = \\frac{1}{12} + \\frac{4}{12} + 9 + \\frac{16}{144} + \\frac{25}{12} + 3 + \\frac{49}{144}$。\n再次使用公分母 $144$：\n$D_{total} = \\frac{12}{144} + \\frac{48}{144} + \\frac{9 \\cdot 144}{144} + \\frac{16}{144} + \\frac{25 \\cdot 12}{144} + \\frac{3 \\cdot 144}{144} + \\frac{49}{144}$\n$D_{total} = \\frac{12 + 48 + 1296 + 16 + 300 + 432 + 49}{144} = \\frac{2153}{144}$。\n\n所求的分数 $\\Phi$ 是二阶交互作用的方差与总方差之比：\n$\\Phi = \\frac{D_{order\\_2}}{D_{total}} = \\frac{748/144}{2153/144} = \\frac{748}{2153}$。\n\n为确保分数已化简，我们检查公因子。分子的质因数分解为 $748 = 4 \\cdot 187 = 2^2 \\cdot 11 \\cdot 17$。分母 $2153$ 不能被 $2$、$11$（因为 $2-1+5-3=3$）或 $17$（因为 $2153 = 17 \\cdot 126 + 11$）整除。因此，该分数是不可约的。",
            "answer": "$$\\boxed{\\frac{748}{2153}}$$"
        }
    ]
}