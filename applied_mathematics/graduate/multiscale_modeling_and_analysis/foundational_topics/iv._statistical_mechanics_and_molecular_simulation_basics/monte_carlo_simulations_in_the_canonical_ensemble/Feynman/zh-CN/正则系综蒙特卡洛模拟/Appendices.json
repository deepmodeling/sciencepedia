{
    "hands_on_practices": [
        {
            "introduction": "在实际应用中，正则系综（$NVT$）的蒙特卡洛模拟几乎总是只对粒子位置进行采样，而忽略其动量。这种简化并非理所当然。本练习将引导你从第一性原理出发，深入探讨这种简化方法的理论依据，明确在何种条件下（从可分离的哈密顿量到外加磁场），对动量自由度的积分不影响位置的概率分布，从而保证了仅对位置进行采样的有效性 。",
            "id": "3782936",
            "problem": "一个包含$N$个点粒子的经典多粒子系统，处于固定体积$V$和温度$T$下，通过正则系综（粒子数$N$、体积$V$、温度$T$，通常简称为NVT）进行建模。该系统由位置 $\\mathbf{r} \\in \\mathbb{R}^{3N}$ 和动量 $\\mathbf{p} \\in \\mathbb{R}^{3N}$ 描述，其哈密顿量为 $H(\\mathbf{r},\\mathbf{p})$。正则概率密度为 $\\rho(\\mathbf{r},\\mathbf{p}) \\propto \\exp\\!\\left(-\\beta H(\\mathbf{r},\\mathbf{p})\\right)$，其中 $\\beta = 1/(k_B T)$，$k_B$ 是玻尔兹曼常数。考虑一个只依赖于位置的可观测量 $A(\\mathbf{r})$。在实践中，正则系综中的蒙特卡洛（MC）抽样经常只对 $\\mathbf{r}$ 进行移动的提议和接受/拒绝，而并不对 $\\mathbf{p}$ 进行抽样。\n\n从第一性原理出发，分析仅位置抽样何时能为 $A(\\mathbf{r})$ 得到正确的正则系综平均值，以及何时会失效。选择下面所有正确的陈述。\n\nA. 如果在笛卡尔坐标系中，对于具有恒定粒子质量的系统，哈密顿量是可分离的，形式为 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$，其中 $K(\\mathbf{p})$ 与 $\\mathbf{r}$ 无关，那么关于位置的边际分布满足 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$。因此，使用玻尔兹曼权重 $\\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$ 的仅位置MC抽样，可以为任何 $A(\\mathbf{r})$ 得到精确的正则系综平均值。\n\nB. 当施加完整约束 $C(\\mathbf{r}) = \\mathbf{0}$，从而在笛卡尔空间中定义了一个低维构型流形时，正确的边际位置分布仍然是 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$（限制在流形上），且没有额外的测度因子。因此，在受约束的流形上，接受率仅基于 $\\Delta U(\\mathbf{r})$ 的朴素仅位置MC可以为任何 $A(\\mathbf{r})$ 得到精确的平均值。\n\nC. 在广义（曲线）坐标 $\\mathbf{q}$ 及其共轭动量 $\\mathbf{p}_q$ 下，动能通常呈二次型 $K(\\mathbf{q},\\mathbf{p}_q) = \\frac{1}{2}\\,\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q$，其中 $\\mathbf{M}(\\mathbf{q})$ 是一个依赖于位置的质量-度规张量。在边际位置分布中，对动量的积分会产生一个与 $\\sqrt{\\det \\mathbf{M}(\\mathbf{q})}$ 成正比的因子。因此，除非包含正确的测度修正，否则使用权重 $\\exp\\!\\left(-\\beta U(\\mathbf{q})\\right)$ 的朴素仅位置MC对于 $A(\\mathbf{q})$ 通常是有偏的。\n\nD. 当存在静态磁场时，通过最小耦合在经典哈密顿量中引入矢量势 $\\mathbf{A}(\\mathbf{r})$，动能项为 $K(\\mathbf{r},\\mathbf{p}) = \\sum_{i=1}^{N} \\left(\\mathbf{p}_i - q_i \\mathbf{A}(\\mathbf{r}_i)\\right)^2/(2 m_i)$。由于对动量的高斯积分相当于在 $\\mathbf{p}$ 空间中的一个平移，积分结果与 $\\mathbf{r}$ 无关。因此，边际位置分布仍然是 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$，并且仅位置MC可以为任何 $A(\\mathbf{r})$ 得到精确的平均值。\n\nE. 在低温下的量子效应会保持正则系综中位置和动量之间的经典可分离性，因此即使在经典假设失效时，仅位置MC对于任何 $A(\\mathbf{r})$ 仍然是精确的。\n\nF. 在多尺度粗粒化中，当用简化变量 $\\boldsymbol{\\xi}(\\mathbf{r})$ 替换完整坐标 $\\mathbf{r}$ 时，要通过仅位置MC对 $\\boldsymbol{\\xi}$ 的正则边际分布进行精确抽样，需要有效势是与 $\\boldsymbol{\\xi}$ 相关联的平均力势。若仅仅用一个朴素的 $U_{\\text{CG}}(\\boldsymbol{\\xi})$ 来替代 $U(\\mathbf{r})$ 而不考虑其潜在的测度，通常会导致依赖于 $\\boldsymbol{\\xi}$ 的可观测量的平均值出现偏差。\n\n选择所有适用项。",
            "solution": "问题的核心是确定在何种条件下，一个仅依赖于位置的可观测量 $A(\\mathbf{r})$ 的正则系综平均值，可以通过一个只抽样构型空间（位置 $\\mathbf{r}$）而不抽样动量空间（$\\mathbf{p}$）的蒙特卡洛（MC）模拟来正确计算。\n\n从第一性原理出发，可观测量 $A(\\mathbf{r})$ 的正则系综平均值由全相空间积分给出：\n$$ \\langle A \\rangle = \\frac{\\iint A(\\mathbf{r}) \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{r} \\, d\\mathbf{p}}{\\iint \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{r} \\, d\\mathbf{p}} $$\n其中 $\\beta = 1/(k_B T)$，积分遍及所有 $3N$ 个位置坐标和 $3N$ 个动量坐标。\n\n由于可观测量 $A$ 只依赖于 $\\mathbf{r}$，我们可以将分子重排为：\n$$ \\iint A(\\mathbf{r}) \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{r} \\, d\\mathbf{p} = \\int A(\\mathbf{r}) \\left( \\int \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{p} \\right) d\\mathbf{r} $$\n让我们通过对全相空间概率密度在所有动量上积分来定义位置的边际概率密度 $\\rho(\\mathbf{r})$：\n$$ \\rho(\\mathbf{r}) = C \\int \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{p} $$\n其中 $C$ 是一个归一化常数。然后，系综平均值可以表示为仅对位置的积分：\n$$ \\langle A \\rangle = \\frac{\\int A(\\mathbf{r}) \\rho(\\mathbf{r}) \\, d\\mathbf{r}}{\\int \\rho(\\mathbf{r}) \\, d\\mathbf{r}} $$\n一个仅位置MC模拟是有效的，如果其稳态分布与这个正确的边际密度 $\\rho(\\mathbf{r})$ 成正比。一个“朴素的”仅位置MC模拟通常假设哈密顿量是可分离的形式 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$，并使用 $\\exp(-\\beta U(\\mathbf{r}))$ 作为抽样权重。这种方法的有效性取决于 $\\rho(\\mathbf{r})$ 是否确实与 $\\exp(-\\beta U(\\mathbf{r}))$ 成正比。这要求动量积分 $\\int \\exp(-\\beta H(\\mathbf{r},\\mathbf{p})) \\, d\\mathbf{p}$ 要么是一个常数，要么可以因子化析出，且不破坏与 $\\exp(-\\beta U(\\mathbf{r}))$ 的正比关系。\n\n让我们基于这一原则来评估每个陈述。\n\n**A. 如果在笛卡尔坐标系中，对于具有恒定粒子质量的系统，哈密顿量是可分离的，形式为 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$，其中 $K(\\mathbf{p})$ 与 $\\mathbf{r}$ 无关，那么关于位置的边际分布满足 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$。因此，使用玻尔兹曼权重 $\\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$ 的仅位置MC抽样，可以为任何 $A(\\mathbf{r})$ 得到精确的正则系综平均值。**\n\n在笛卡尔坐标中，对于 $N$ 个质量为 $m_i$ 的粒子，动能为 $K(\\mathbf{p}) = \\sum_{i=1}^{N} \\frac{\\mathbf{p}_i^2}{2m_i}$。该项与位置 $\\mathbf{r}$ 无关。哈密顿量为 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + K(\\mathbf{p})$。\n边际密度 $\\rho(\\mathbf{r})$ 为：\n$$ \\rho(\\mathbf{r}) \\propto \\int \\exp(-\\beta [U(\\mathbf{r}) + K(\\mathbf{p})]) \\, d\\mathbf{p} $$\n$$ \\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r})) \\int \\exp(-\\beta K(\\mathbf{p})) \\, d\\mathbf{p} $$\n积分 $\\int \\exp(-\\beta K(\\mathbf{p})) \\, d\\mathbf{p}$ 是一个对动量的 $3N$ 维高斯积分。由于 $K(\\mathbf{p})$ 不依赖于 $\\mathbf{r}$，该积分的值是一个与 $\\mathbf{r}$ 无关的常数。\n$$ \\int \\exp\\left(-\\beta \\sum_{i=1}^{N} \\frac{p_{ix}^2+p_{iy}^2+p_{iz}^2}{2m_i}\\right) d\\mathbf{p} = \\prod_{i=1}^{N} \\left( \\int_{-\\infty}^{\\infty} e^{-\\beta p^2/(2m_i)} dp \\right)^3 = \\prod_{i=1}^{N} \\left( \\frac{2\\pi m_i}{\\beta} \\right)^{3/2} $$\n这个结果是一个常数。因此，$\\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r}))$。一个以与 $\\exp(-\\beta U(\\mathbf{r}))$ 成正比的概率进行状态抽样的仅位置MC模拟，将正确地抽样边际位置分布，并为任何 $A(\\mathbf{r})$ 得到精确的正则系综平均值。\n结论：**正确**。\n\n**B. 当施加完整约束 $C(\\mathbf{r}) = \\mathbf{0}$，从而在笛卡尔空间中定义了一个低维构型流形时，正确的边际位置分布仍然是 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$（限制在流形上），且没有额外的测度因子。因此，在受约束的流形上，接受率仅基于 $\\Delta U(\\mathbf{r})$ 的朴素仅位置MC可以为任何 $A(\\mathbf{r})$ 得到精确的平均值。**\n\n完整约束降低了组态空间的维度。设 $d$ 维流形由广义坐标 $\\mathbf{q} = (q_1, \\dots, q_d)$ 参数化。笛卡尔坐标是这些坐标的函数，$\\mathbf{r} = \\mathbf{r}(\\mathbf{q})$。动能变为 $K = \\frac{1}{2} \\sum_k m_k \\dot{\\mathbf{r}}_k^2 = \\frac{1}{2} \\sum_{i,j} M_{ij}(\\mathbf{q}) \\dot{q}_i \\dot{q}_j$，其中 $\\mathbf{M}(\\mathbf{q})$ 是质量-度规张量，其元素为 $M_{ij}(\\mathbf{q}) = \\sum_k m_k \\frac{\\partial \\mathbf{r}_k}{\\partial q_i} \\cdot \\frac{\\partial \\mathbf{r}_k}{\\partial q_j}$。通常情况下，$\\mathbf{M}(\\mathbf{q})$ 是坐标 $\\mathbf{q}$ 的函数。在这些广义坐标下的哈密顿量是 $H(\\mathbf{q}, \\mathbf{p}_q) = U(\\mathbf{q}) + \\frac{1}{2}\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q$，其中 $\\mathbf{p}_q$ 是共轭动量。\n为了找到边际分布 $\\rho(\\mathbf{q})$，我们对 $\\mathbf{p}_q$ 进行积分：\n$$ \\rho(\\mathbf{q}) \\propto \\int \\exp(-\\beta [U(\\mathbf{q}) + \\frac{1}{2}\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q]) \\, d\\mathbf{p}_q $$\n$$ \\rho(\\mathbf{q}) \\propto \\exp(-\\beta U(\\mathbf{q})) \\int \\exp(-\\frac{\\beta}{2}\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q) \\, d\\mathbf{p}_q $$\n该积分是关于 $\\mathbf{p}_q$ 的高斯积分。其值与 $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$ 成正比。因此，正确的边际分布是：\n$$ \\rho(\\mathbf{q}) \\propto \\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))} \\exp(-\\beta U(\\mathbf{q})) $$\n$\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$ 项是一个依赖于位置的测度因子，它源于约束流形的曲率。由于该因子通常不是常数，仅基于 $\\exp(-\\beta U(\\mathbf{q}))$ 的朴素MC抽样将是不正确的。该陈述声称“没有额外的测度因子”，这是错误的。\n结论：**不正确**。\n\n**C. 在广义（曲线）坐标 $\\mathbf{q}$ 及其共轭动量 $\\mathbf{p}_q$ 下，动能通常呈二次型 $K(\\mathbf{q},\\mathbf{p}_q) = \\frac{1}{2}\\,\\mathbf{p}_q^{\\top} \\mathbf{M}^{-1}(\\mathbf{q}) \\mathbf{p}_q$，其中 $\\mathbf{M}(\\mathbf{q})$ 是一个依赖于位置的质量-度规张量。在边际位置分布中，对动量的积分会产生一个与 $\\sqrt{\\det \\mathbf{M}(\\mathbf{q})}$ 成正比的因子。因此，除非包含正确的测度修正，否则使用权重 $\\exp\\!\\left(-\\beta U(\\mathbf{q})\\right)$ 的朴素仅位置MC对于 $A(\\mathbf{q})$ 通常是有偏的。**\n\n该陈述精确地描述了为选项 B 所分析的情况。如上所推导，当动能依赖于一个与位置相关的质量-度规张量 $\\mathbf{M}(\\mathbf{q})$ 时，对动量 $\\mathbf{p}_q$ 的积分会产生一个与 $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$ 成正比的因子。\n边际密度为 $\\rho(\\mathbf{q}) \\propto \\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))} \\exp(-\\beta U(\\mathbf{q}))$。MC模拟必须从此分布中抽样。仅仅使用 $\\exp(-\\beta U(\\mathbf{q}))$ 作为权重会忽略几何因子 $\\sqrt{\\det(\\mathbf{M}(\\mathbf{q}))}$，并导致有偏抽样，除非 $\\det(\\mathbf{M}(\\mathbf{q}))$ 恰好是一个常数，但这并非普遍情况。\n结论：**正确**。\n\n**D. 当存在静态磁场时，通过最小耦合在经典哈密顿量中引入矢量势 $\\mathbf{A}(\\mathbf{r})$，动能项为 $K(\\mathbf{r},\\mathbf{p}) = \\sum_{i=1}^{N} \\left(\\mathbf{p}_i - q_i \\mathbf{A}(\\mathbf{r}_i)\\right)^2/(2 m_i)$。由于对动量的高斯积分相当于在 $\\mathbf{p}$ 空间中的一个平移，积分结果与 $\\mathbf{r}$ 无关。因此，边际位置分布仍然是 $\\rho(\\mathbf{r}) \\propto \\exp\\!\\left(-\\beta U(\\mathbf{r})\\right)$，并且仅位置MC可以为任何 $A(\\mathbf{r})$ 得到精确的平均值。**\n\n哈密顿量为 $H(\\mathbf{r},\\mathbf{p}) = U(\\mathbf{r}) + \\sum_{i=1}^{N} \\frac{(\\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i))^2}{2 m_i}$。边际位置密度为：\n$$ \\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r})) \\int \\exp\\left(-\\beta \\sum_{i=1}^{N} \\frac{(\\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i))^2}{2 m_i}\\right) d\\mathbf{p} $$\n让我们分析对动量的积分。它可以分解为对每个粒子 $i$ 的积分的乘积。对于单个粒子，积分是关于其动量 $\\mathbf{p}_i$ 的：\n$$ I_i = \\int \\exp\\left(-\\frac{\\beta}{2m_i}(\\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i))^2\\right) d\\mathbf{p}_i $$\n我们进行变量替换 $\\mathbf{p}'_i = \\mathbf{p}_i - q_i\\mathbf{A}(\\mathbf{r}_i)$。由于这个线性平移的雅可比行列式为1，微分体积元 $d\\mathbf{p}_i$ 变为 $d\\mathbf{p}'_i$。$\\mathbf{p}_i$ 各分量的积分限 $(-\\infty, \\infty)$ 对于 $\\mathbf{p}'_i$ 仍然是 $(-\\infty, \\infty)$。\n$$ I_i = \\int \\exp\\left(-\\frac{\\beta}{2m_i}(\\mathbf{p}'_i)^2\\right) d\\mathbf{p}'_i $$\n这是一个标准的高斯积分，其值为 $(2\\pi m_i/\\beta)^{3/2}$，是一个与 $\\mathbf{r}_i$ 无关的常数，因此也与 $\\mathbf{A}(\\mathbf{r}_i)$ 无关。位置依赖性（体现在高斯函数中心的平移上）已经被积分掉了。完整的动量积分是这些常数的乘积，其本身也是一个与 $\\mathbf{r}$ 无关的常数。因此，$\\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r}))$。这是Bohr-van Leeuwen定理的一种体现，该定理指出经典统计力学无法解释抗磁性或顺磁性。仅位置MC抽样仍然是精确的。\n结论：**正确**。\n\n**E. 在低温下的量子效应会保持正则系综中位置和动量之间的经典可分离性，因此即使在经典假设失效时，仅位置MC对于任何 $A(\\mathbf{r})$ 仍然是精确的。**\n\n在量子力学中，位置 $\\hat{\\mathbf{r}}$ 和动量 $\\hat{\\mathbf{p}}$ 是不对易的算符：$[\\hat{x}_j, \\hat{p}_k] = i\\hbar\\delta_{jk}$。哈密顿量是一个算符 $\\hat{H} = \\hat{K}(\\hat{\\mathbf{p}}) + \\hat{U}(\\hat{\\mathbf{r}})$。因为 $\\hat{K}$ 和 $\\hat{U}$ 不对易，玻尔兹曼算符不能分解：$\\exp(-\\beta\\hat{H}) = \\exp(-\\beta(\\hat{K}+\\hat{U})) \\neq \\exp(-\\beta\\hat{K})\\exp(-\\beta\\hat{U})$。这种非对易性从根本上纠缠了位置和动量自由度。在位置表象中，给出位置概率分布的密度矩阵对角元 $\\langle \\mathbf{r} | \\exp(-\\beta \\hat{H}) | \\mathbf{r} \\rangle$，不能被简化为与 $\\exp(-\\beta U(\\mathbf{r}))$ 成正比的项。这需要像路径积分蒙特卡洛（PIMC）这样的方法，它将量子系统映射到一个具有更复杂势能的经典环状聚合物上，这表明简单的可分离性已经丧失。因此，该陈述是不正确的。\n结论：**不正确**。\n\n**F. 在多尺度粗粒化中，当用简化变量 $\\boldsymbol{\\xi}(\\mathbf{r})$ 替换完整坐标 $\\mathbf{r}$ 时，要通过仅位置MC对 $\\boldsymbol{\\xi}$ 的正则边际分布进行精确抽样，需要有效势是与 $\\boldsymbol{\\xi}$ 相关联的平均力势。若仅仅用一个朴素的 $U_{\\text{CG}}(\\boldsymbol{\\xi})$ 来替代 $U(\\mathbf{r})$ 而不考虑其潜在的测度，通常会导致依赖于 $\\boldsymbol{\\xi}$ 的可观测量的平均值出现偏差。**\n\n给定一组微观坐标 $\\mathbf{r}$ 和一个粗粒化变量 $\\boldsymbol{\\xi} = \\boldsymbol{\\xi}(\\mathbf{r})$，$\\boldsymbol{\\xi}$ 的平衡概率分布是通过对所有与给定 $\\boldsymbol{\\xi}$ 值一致的微观状态的完整概率分布进行积分得到的。假设底层的微观状态分布为 $\\rho(\\mathbf{r}) \\propto \\exp(-\\beta U(\\mathbf{r}))$，那么找到系统处于 $\\boldsymbol{\\xi}(\\mathbf{r}) = \\boldsymbol{\\xi}_0$ 的概率为：\n$$ P(\\boldsymbol{\\xi}_0) \\propto \\int \\exp(-\\beta U(\\mathbf{r})) \\delta(\\boldsymbol{\\xi}(\\mathbf{r}) - \\boldsymbol{\\xi}_0) \\, d\\mathbf{r} $$\n这个分布可以用一个有效的自由能或势来表示，称为平均力势（PMF），$W(\\boldsymbol{\\xi})$：\n$$ P(\\boldsymbol{\\xi}_0) \\propto \\exp(-\\beta W(\\boldsymbol{\\xi}_0)) $$\n根据定义，$W(\\boldsymbol{\\xi}_0) = -k_B T \\ln P(\\boldsymbol{\\xi}_0)$。PMF $W(\\boldsymbol{\\xi}_0)$ 不仅包含势能的变化，还包含了因积分掉与粗粒化变量 $\\boldsymbol{\\xi}$ 正交的微观自由度而产生的熵贡献。陈述中的“测度”一词指的是与 $\\boldsymbol{\\xi}(\\mathbf{r})=\\boldsymbol{\\xi}_0$ 相对应的构型空间体积。仅仅通过（例如）在某个代表性构型上计算 $U(\\mathbf{r})$ 来创建一个朴素的粗粒化势 $U_{\\text{CG}}(\\boldsymbol{\\xi})$，会忽略PMF中包含的这些关键的熵贡献。因此，使用基于这种朴素势的权重进行抽样通常是不正确的。为了得到精确的平均值，必须使用真实的PMF，即 $W(\\boldsymbol{\\xi})$ 进行抽样。\n结论：**正确**。",
            "answer": "$$\\boxed{ACDF}$$"
        },
        {
            "introduction": "了解了仅对位置空间进行采样的条件后，我们面临一个新的挑战：当构型空间本身受到约束时该怎么办？一个看似简单的方法是直接拒绝所有违反约束的提议移动。本练习探讨了这种“拒绝策略”对马尔可夫链基本性质（如细致平衡和遍历性）的深远影响，揭示了为何简单处理约束可能导致算法完全失效，尤其是在处理定义了低维流形的硬约束或刚性势函数时 。",
            "id": "3782885",
            "problem": "考虑一个系统，其微观状态为 $\\mathbf{x} \\in \\mathbb{R}^{n}$，势能为 $U(\\mathbf{x})$。在温度 $T$ 下，无约束的正则系综目标密度为 $\\pi_{\\mathrm{unconst}}(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x}))$，其中 $\\beta = 1/(k_{\\mathrm{B}} T)$，$k_{\\mathrm{B}}$ 为玻尔兹曼常数。假设可行集受约束网络限制，定义为 $\\Omega = \\{\\mathbf{x} \\in \\mathbb{R}^{n} : g_{i}(\\mathbf{x}) \\le 0 \\text{ for } i=1,\\dots,r, \\text{ and } h_{j}(\\mathbf{x})=0 \\text{ for } j=1,\\dots,s\\}$，其中每个 $h_{j}$ 都是光滑的，并且等式约束（如果存在）定义了一个低维子流形。我们希望对受约束正则系综 $\\pi(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x})) \\,\\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$ 进行采样，其中 $\\mathbb{I}$ 表示指示函数。\n\n提出一种马尔可夫链蒙特卡洛 (MCMC) 方法，其中通过拒绝任何违反 $\\Omega$ 的提议移动来施加约束。考虑一个 Metropolis–Hastings 提议密度 $q(\\mathbf{x}' \\mid \\mathbf{x})$，在 $\\mathbf{x}$ 的一个邻域内 $q(\\mathbf{x}' \\mid \\mathbf{x})  0$，并假设约束网络可以是“刚性-软性”的（通过附加的罚项 $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$ 建模，其中刚度 $\\kappa \\gg 1$ 且 $\\mathbf{h}=(h_{1},\\dots,h_{s})$），也可以是无罚项的精确完整等式约束 $h_{j}(\\mathbf{x})=0$。分析这种基于拒绝的施加方式对刚性方向上的细致平衡、遍历性和采样效率的影响。\n\n选择所有正确的陈述。\n\nA. 对于满足 $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$ 的对称提议，通过拒绝任何 $\\mathbf{x}' \\notin \\Omega$ 的移动并使用接受概率 $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$，会产生一个满足关于 $\\pi(\\mathbf{x})$ 的细致平衡条件的马尔可夫链。\n\nB. 如果约束包含定义了一个光滑低维子流形的完整等式约束 $h_{j}(\\mathbf{x})=0$，并且 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 相对于 $\\mathbb{R}^{n}$ 上的勒贝格测度是绝对连续的，那么一个朴素的提议正好落在约束流形上的概率为零。因此，在基于拒绝的施加方式下，接受概率几乎必然为零，从而破坏了遍历性。\n\nC. 在具有 $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$ 的“刚性-软性”情况下，如果使用一个在受约束方向上尺度为 $\\sigma$ 且不随 $\\kappa$ 调整的高斯随机游走提议，则沿这些方向的平均接受概率大致按 $\\exp(-c\\,\\beta\\,\\kappa\\,\\sigma^{2})$（对于某个 $c0$）衰减，这意味着除非将 $\\sigma$ 减小到 $\\sqrt{k_{\\mathrm{B}} T / \\kappa}$ 的量级，否则积分自相关时间会随着 $\\kappa$ 的增加而发散。\n\nD. 基于拒绝的方案保证了 $\\Omega$ 的不连通分量之间的混合，因为偶尔违反 $\\Omega$ 的提议会以小概率被接受，从而允许链穿越约束壁垒。\n\nE. 对于非对称提议，通过使用 $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$ 来维持受约束目标的细致平衡，该接受概率独立于提议密度 $q(\\mathbf{x}' \\mid \\mathbf{x})$。\n\n用所有正确选项的字母作答。",
            "solution": "首先验证描述受约束正则系综的蒙特卡洛模拟的问题陈述。\n\n### 第一步：提取已知条件\n- 系统状态: $\\mathbf{x} \\in \\mathbb{R}^{n}$\n- 势能: $U(\\mathbf{x})$\n- 温度: $T$\n- 逆温度: $\\beta = 1/(k_{\\mathrm{B}} T)$\n- 玻尔兹曼常数: $k_{\\mathrm{B}}$\n- 无约束正则密度: $\\pi_{\\mathrm{unconst}}(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x}))$\n- 可行集: $\\Omega = \\{\\mathbf{x} \\in \\mathbb{R}^{n} : g_{i}(\\mathbf{x}) \\le 0 \\text{ for } i=1,\\dots,r, \\text{ and } h_{j}(\\mathbf{x})=0 \\text{ for } j=1,\\dots,s\\}$\n- 约束的性质: 每个 $h_{j}$ 都是光滑的，并且等式约束定义了一个低维子流形。\n- 受约束正则系综密度: $\\pi(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x})) \\,\\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$，其中 $\\mathbb{I}$ 是指示函数。\n- 提议的MCMC方法: 通过拒绝任何违反 $\\Omega$ 的提议移动来施加约束。\n- 提议密度: $q(\\mathbf{x}' \\mid \\mathbf{x})$，在 $\\mathbf{x}$ 的一个邻域内 $q(\\mathbf{x}' \\mid \\mathbf{x})  0$。\n- “刚性-软性”情况模型: 一个附加的罚势 $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$，刚度 $\\kappa \\gg 1$，其中 $\\mathbf{h}=(h_{1},\\dots,h_{s})$。\n- 精确完整约束情况模型: $h_{j}(\\mathbf{x})=0$ 无罚项。\n- 问题: 分析这种基于拒绝的施加方式对细致平衡、遍历性和采样效率的影响。\n\n### 第二步：使用提取的已知条件进行验证\n该问题陈述具有科学依据、提法恰当且客观。它概述了计算统计力学和贝叶斯统计中的一个标准且重要的问题：从限制在特定域上的分布中进行采样。所有技术术语，如“正则系综”、“Metropolis–Hastings”、“细致平衡”、“遍历性”、“完整约束”和“刚性势”，都在其既定的科学背景下被正确使用。该设置是自洽的，不包含矛盾或不科学的前提。所描述的场景（硬约束、刚性罚函数）在分子动力学和约束优化等领域很常见。这是一个有效且重要的概念性问题。\n\n### 第三步：结论和行动\n问题是有效的。将对每个选项进行详细分析。\n\n---\n\n从状态 $\\mathbf{x}$ 到 $\\mathbf{x}'$ 的马尔可夫链的转移核为 $T(\\mathbf{x} \\to \\mathbf{x}') = q(\\mathbf{x}' \\mid \\mathbf{x}) \\alpha(\\mathbf{x} \\to \\mathbf{x}')$（对于 $\\mathbf{x} \\neq \\mathbf{x}'$），其中 $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ 是接受概率。平稳分布是受约束的正则密度 $\\pi(\\mathbf{x}) = Z^{-1} \\exp(-\\beta U(\\mathbf{x})) \\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$，其中 $Z$ 是归一化常数。链收敛到 $\\pi(\\mathbf{x})$ 的一个充分条件是它满足细致平衡条件：\n$$ \\pi(\\mathbf{x}) T(\\mathbf{x} \\to \\mathbf{x}') = \\pi(\\mathbf{x}') T(\\mathbf{x}' \\to \\mathbf{x}) $$\n对所有 $\\mathbf{x}, \\mathbf{x}' \\in \\mathbb{R}^n$ 成立。\n\n### 逐项分析\n\n**A. 对于满足 $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$ 的对称提议，通过拒绝任何 $\\mathbf{x}' \\notin \\Omega$ 的移动并使用接受概率 $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$，会产生一个满足关于 $\\pi(\\mathbf{x})$ 的细致平衡条件的马尔可夫链。**\n\n让我们用给定的接受概率来检验细致平衡条件。\n$$ \\pi(\\mathbf{x}) q(\\mathbf{x}' \\mid \\mathbf{x}) \\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\pi(\\mathbf{x}') q(\\mathbf{x} \\mid \\mathbf{x}') \\alpha(\\mathbf{x}' \\to \\mathbf{x}) $$\n代入 $\\pi(\\mathbf{x})$ 和 $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ 的定义：\n左边：$(Z^{-1} e^{-\\beta U(\\mathbf{x})} \\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}) \\cdot q(\\mathbf{x}' \\mid \\mathbf{x}) \\cdot (\\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, e^{-\\beta(U(\\mathbf{x}')-U(\\mathbf{x}))}\\})$\n右边：$(Z^{-1} e^{-\\beta U(\\mathbf{x}')} \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\}) \\cdot q(\\mathbf{x} \\mid \\mathbf{x}') \\cdot (\\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\} \\min\\{1, e^{-\\beta(U(\\mathbf{x})-U(\\mathbf{x}'))}\\})$\n\n如果 $\\mathbf{x} \\notin \\Omega$ 或 $\\mathbf{x}' \\notin \\Omega$，则两边的一个或多个指示函数将为零，使得左边和右边都等于零。因此，细致平衡成立。\n现在，考虑 $\\mathbf{x} \\in \\Omega$ 和 $\\mathbf{x}' \\in \\Omega$ 的情况。所有指示函数都为 $1$。条件变为：\n$e^{-\\beta U(\\mathbf{x})} q(\\mathbf{x}' \\mid \\mathbf{x}) \\min\\{1, e^{-\\beta U(\\mathbf{x}')}/e^{-\\beta U(\\mathbf{x})}\\} = e^{-\\beta U(\\mathbf{x}')} q(\\mathbf{x} \\mid \\mathbf{x}') \\min\\{1, e^{-\\beta U(\\mathbf{x})}/e^{-\\beta U(\\mathbf{x}')}\\}$\n使用恒等式 $A \\min\\{1, B/A\\} = \\min\\{A, B\\}$，这可以简化为：\n$ q(\\mathbf{x}' \\mid \\mathbf{x}) \\min\\{e^{-\\beta U(\\mathbf{x})}, e^{-\\beta U(\\mathbf{x}')}\\} = q(\\mathbf{x} \\mid \\mathbf{x}') \\min\\{e^{-\\beta U(\\mathbf{x}')}, e^{-\\beta U(\\mathbf{x})}\\} $\n由于提议是对称的，$q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$，这个方程是一个恒等式。对于所有状态对，细致平衡条件都得到满足。给定的接受概率是针对受约束目标分布和对称提议的正确 Metropolis-Hastings 接受准则。\n\n结论：**正确**。\n\n**B. 如果约束包含定义了一个光滑低维子流形的完整等式约束 $h_{j}(\\mathbf{x})=0$，并且 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 相对于 $\\mathbb{R}^{n}$ 上的勒贝格测度是绝对连续的，那么一个朴素的提议正好落在约束流形上的概率为零。因此，在基于拒绝的施加方式下，接受概率几乎必然为零，从而破坏了遍历性。**\n\n完整等式约束集合定义了一个流形 $\\mathcal{M} = \\{\\mathbf{x} \\in \\mathbb{R}^n \\mid h_j(\\mathbf{x})=0, j=1,\\dots,s\\}$。由于 $s \\ge 1$ 且约束非平凡，$\\mathcal{M}$ 是 $\\mathbb{R}^n$ 的一个子流形，其维度严格小于 $n$。任何维度小于 $n$ 的集合在 $\\mathbb{R}^n$ 中的勒贝格测度为零。\n提议密度 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 被指定为相对于 $\\mathbb{R}^n$ 上的勒贝格测度是绝对连续的。这意味着对于任何勒贝格测度为零的集合 $A \\subset \\mathbb{R}^n$，从中抽取样本的概率为零。即，$P(\\mathbf{x}' \\in A) = \\int_A q(\\mathbf{x}' \\mid \\mathbf{x}) d\\mathbf{x}' = 0$。\n可行集 $\\Omega$ 是 $\\mathcal{M}$ 的一个子集（即 $\\Omega$ 中的任何点都必须满足等式约束）。移动的接受要求提议的状态 $\\mathbf{x}'$ 在 $\\Omega$ 中，这意味着 $\\mathbf{x}' \\in \\mathcal{M}$。\n提议一个位于流形 $\\mathcal{M}$ 上的状态 $\\mathbf{x}'$ 的概率是 $P(\\mathbf{x}' \\in \\mathcal{M}) = \\int_{\\mathcal{M}} q(\\mathbf{x}' \\mid \\mathbf{x}) d\\mathbf{x}' = 0$，因为 $\\mathcal{M}$ 的勒贝格测度为零。\n因此，任何提议的状态 $\\mathbf{x}'$ 几乎必然会落在可行集 $\\Omega$ 之外。接受概率 $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ 将包含一个因子 $\\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\}$，该因子几乎必然为零。如果任何移动到不同状态的接受概率为零，链将永远不会离开其初始位置：$\\mathbf{x}_{k+1} = \\mathbf{x}_k$ 对所有 $k$ 成立。这样的链无法探索状态空间，因此不具有遍历性。\n\n结论：**正确**。\n\n**C. 在具有 $U_{\\mathrm{pen}}(\\mathbf{x}) = (\\kappa/2) \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^{2}$ 的“刚性-软性”情况下，如果使用一个在受约束方向上尺度为 $\\sigma$ 且不随 $\\kappa$ 调整的高斯随机游走提议，则沿这些方向的平均接受概率大致按 $\\exp(-c\\,\\beta\\,\\kappa\\,\\sigma^{2})$（对于某个 $c0$）衰减，这意味着除非将 $\\sigma$ 减小到 $\\sqrt{k_{\\mathrm{B}} T / \\kappa}$ 的量级，否则积分自相关时间会随着 $\\kappa$ 的增加而发散。**\n\n在“刚性-软性”情况下，总势能为 $U_{total}(\\mathbf{x}) = U(\\mathbf{x}) + U_{\\mathrm{pen}}(\\mathbf{x})$。对于大的 $\\kappa$，势能在偏离流形 $\\mathbf{h}(\\mathbf{x}) = \\mathbf{0}$ 的方向上主要由罚项 $U_{\\mathrm{pen}}(\\mathbf{x})$ 主导。分布 $\\pi(\\mathbf{x})$ 近似为以该流形为中心、方差量级为 $1/(\\beta\\kappa)$ 的高斯分布。\n设当前状态 $\\mathbf{x}$ 接近最小值，其中 $\\mathbf{h}(\\mathbf{x}) \\approx \\mathbf{0}$。提议移动为 $\\mathbf{x}' = \\mathbf{x} + \\boldsymbol{\\delta}$，其中 $\\boldsymbol{\\delta}$ 从方差为 $\\sigma^2$ 的高斯分布中抽取。势能的变化为 $\\Delta U_{total} = U_{total}(\\mathbf{x}') - U_{total}(\\mathbf{x})$。主要贡献来自罚项：\n$\\Delta U_{\\mathrm{pen}} = \\frac{\\kappa}{2} \\lVert \\mathbf{h}(\\mathbf{x}') \\rVert^2 - \\frac{\\kappa}{2} \\lVert \\mathbf{h}(\\mathbf{x}) \\rVert^2 \\approx \\frac{\\kappa}{2} \\lVert \\mathbf{h}(\\mathbf{x}') \\rVert^2$。\n通过泰勒展开，$\\mathbf{h}(\\mathbf{x}') \\approx \\mathbf{h}(\\mathbf{x}) + J_{\\mathbf{h}}(\\mathbf{x})\\boldsymbol{\\delta} \\approx J_{\\mathbf{h}}(\\mathbf{x})\\boldsymbol{\\delta}$，其中 $J_{\\mathbf{h}}$ 是 $\\mathbf{h}$ 的雅可比矩阵。$\\boldsymbol{\\delta}$ 分量的典型量级是 $\\sigma$。因此 $\\mathbf{h}(\\mathbf{x}')$ 的模平方的量级为 $\\sigma^2$。所以，$\\Delta U_{\\mathrm{pen}}$ 的量级为 $\\kappa \\sigma^2$。\nMetropolis 接受概率近似为 $\\alpha \\approx \\exp(-\\beta \\Delta U_{total}) \\approx \\exp(-\\beta \\cdot O(\\kappa \\sigma^2))$。这可以写成 $\\exp(-c\\beta\\kappa\\sigma^2)$，其中某个常数 $c0$ 与约束的几何形状有关。当 $\\sigma$ 固定时，随着 $\\kappa \\to \\infty$，这个接受概率指数级地衰减到零。\n接近于零的接受概率意味着链很少移动，导致连续状态之间具有非常高的相关性。积分自相关时间 $\\tau_{int}$，衡量生成一个独立样本所需的步数，与接受率成反比。因此，当 $\\kappa \\to \\infty$ 时，$\\tau_{int}$ 发散。\n为了保持一个恒定的接受概率（例如，使指数的量级为 $1$），我们需要 $\\beta\\kappa\\sigma^2 = O(1)$，这意味着 $\\sigma^2 \\propto 1/(\\beta\\kappa)$。这意味着提议尺度必须减小为 $\\sigma \\propto \\sqrt{1/(\\beta\\kappa)} = \\sqrt{k_{\\mathrm{B}} T / \\kappa}$。此选项中提出的分析是对刚性势采样效率的标准且正确的评估。\n\n结论：**正确**。\n\n**D. 基于拒绝的方案保证了 $\\Omega$ 的不连通分量之间的混合，因为偶尔违反 $\\Omega$ 的提议会以小概率被接受，从而允许链穿越约束壁垒。**\n\n基于拒绝的方案的核心是，任何落在可行集 $\\Omega$ 之外的提议状态 $\\mathbf{x}'$ 都会以概率 $1$ 被拒绝。如选项 A 的分析所示，接受概率公式包含项 $\\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\}$，如果 $\\mathbf{x}' \\notin \\Omega$，该项严格为零。因此，链不可能“以小概率接受”进入禁区的移动。链永远不能通过进入约束壁垒来“穿越”它。\n如果可行集 $\\Omega$ 由两个或多个不连通的分量组成，比如 $\\Omega_1$ 和 $\\Omega_2$，那么从 $\\Omega_1$ 开始的链只有在提议分布 $q(\\mathbf{x}' \\mid \\mathbf{x})$ 有非零概率从 $\\Omega_1$ 中的状态提议一个在 $\\Omega_2$ 中的状态时，才能移动到 $\\Omega_2$。对于局部提议分布（例如，小步长随机游走），如果分量之间相隔有限距离，这种跳跃的概率通常为零或指数级小。MCMC 方案不*保证*混合；事实上，对于不连通的域，遍历性通常会被破坏。该选项中提供的理由在事实上是不正确的。\n\n结论：**不正确**。\n\n**E. 对于非对称提议，通过使用 $\\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\{1, \\exp(-\\beta[U(\\mathbf{x}') - U(\\mathbf{x})])\\}$ 来维持受约束目标的细致平衡，该接受概率独立于提议密度 $q(\\mathbf{x}' \\mid \\mathbf{x})$。**\n\n这个陈述建议在提议非对称 ($q(\\mathbf{x}' \\mid \\mathbf{x}) \\neq q(\\mathbf{x} \\mid \\mathbf{x}')$) 的情况下使用 Metropolis 接受概率（该概率对对称提议 $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$ 有效）。\n对于一般提议分布，正确的接受概率由 Metropolis-Hastings 公式给出：\n$$ \\alpha_{MH}(\\mathbf{x} \\to \\mathbf{x}') = \\min\\left\\{1, \\frac{\\pi(\\mathbf{x}') q(\\mathbf{x} \\mid \\mathbf{x}')}{\\pi(\\mathbf{x}) q(\\mathbf{x}' \\mid \\mathbf{x})}\\right\\} $$\n对于我们的受约束分布 $\\pi(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x})) \\mathbb{I}\\{\\mathbf{x} \\in \\Omega\\}$，这变为（对于 $\\mathbf{x} \\in \\Omega$）：\n$$ \\alpha_{MH}(\\mathbf{x} \\to \\mathbf{x}') = \\mathbb{I}\\{\\mathbf{x}' \\in \\Omega\\} \\min\\left\\{1, \\frac{e^{-\\beta U(\\mathbf{x}')}}{e^{-\\beta U(\\mathbf{x})}} \\frac{q(\\mathbf{x} \\mid \\mathbf{x}')}{q(\\mathbf{x}' \\mid \\mathbf{x})}\\right\\} $$\n这个公式明确地依赖于提议密度的比率，$q(\\mathbf{x} \\mid \\mathbf{x}')/q(\\mathbf{x}' \\mid \\mathbf{x})$。如果这个比率不等于 $1$，在计算接受概率时省略它通常会违反细致平衡。该选项中提议的接受规则与 $q$ 无关，这正是它对于非对称提议不正确的原因。\n\n结论：**不正确**。",
            "answer": "$$\\boxed{ABC}$$"
        },
        {
            "introduction": "最后，我们将理论知识应用于解决一个真实的模拟难题。想象一个分子模拟因高能量壁垒而被困在单一的构象中，无法探索整个相空间。本练习要求你扮演一名计算科学家的角色：首先，设计一个严谨的统计诊断方法来证实非遍历性的存在；然后，设计一个既能恢复遍历性又严格遵守细致平衡条件的有效算法来修复此问题。这综合考察了你对统计诊断、增强采样技术以及在约束流形上定义有效蒙特卡洛移动（包括关键的雅可比行列式校正）的理解 。",
            "id": "3782926",
            "problem": "考虑一个分子系统，其允许的构型构成一个光滑约束流形 $\\mathcal{M} \\subset \\mathbb{R}^{3N}$，由完整约束 $C(\\boldsymbol{x}) = \\boldsymbol{0}$ 描述，其中 $\\boldsymbol{x} \\in \\mathbb{R}^{3N}$ 包含了所有笛卡尔坐标。该系统在逆温度 $\\beta = 1/(k_{\\mathrm{B}} T)$ 下，通过蒙特卡洛（MC; Monte Carlo）方法在正则系综中进行模拟，目标是得到支撑在 $\\mathcal{M}$ 上、相对于诱导曲面测度 $d\\sigma(\\boldsymbol{x})$ 的稳态分布 $\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$。当前的 MC 实现提议了能够保持约束的局部单二面角旋转，但似乎被限制在一个由一组环二面角的符号模式所定义的构象盆地中，这表明可能存在非遍历性。\n\n您的任务是：从以下选项中，选择唯一的最佳设计，该设计需同时 (i) 指定一种能够在此类带有约束二面角的正则系综 MC 模拟中检测非遍历性的、统计上合理的诊断方法，以及 (ii) 推荐一种能够在 $\\mathcal{M}$ 上保持细致平衡并恢复遍历性，且不改变目标正则分布的修正性集体移动。\n\n您可以使用的定义和基础：\n- 正则系综：在允许的构型空间上，$\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$，测度为 $d\\sigma(\\boldsymbol{x})$。\n- 对于具有提议密度 $q(\\boldsymbol{x} \\to \\boldsymbol{y})$ 和接受率 $a(\\boldsymbol{x} \\to \\boldsymbol{y})$ 的马尔可夫链的细致平衡条件：$\\pi(\\boldsymbol{x}) q(\\boldsymbol{x} \\to \\boldsymbol{y}) a(\\boldsymbol{x} \\to \\boldsymbol{y}) = \\pi(\\boldsymbol{y}) q(\\boldsymbol{y} \\to \\boldsymbol{x}) a(\\boldsymbol{y} \\to \\boldsymbol{x})$。\n- 遍历性：不可约性和非周期性意味着时间平均收敛于系综平均；如果状态空间在移动集下分解为不连通的盆地，则会违反遍历性。\n\n选项：\nA. 诊断方法：运行两个在不同盆地 $B_1$ 和 $B_2$ 中初始化的独立副本，这些盆地由一个能够区分盆地成员的序参量 $s(\\boldsymbol{x})$（例如，二面角符号的向量或其标量投影）来识别。对于每个长度为 $L$ 的副本，构建经验分布 $p_i^{(L)}(s)$，$i \\in \\{1,2\\}$，并监测 Jensen–Shannon 散度 $D_{\\mathrm{JS}}(p_1^{(L)}, p_2^{(L)})$。如果当 $L \\to \\infty$ 时，$D_{\\mathrm{JS}}(p_1^{(L)}, p_2^{(L)})$ 不衰减至 $0$，则判定为非遍历性。修正方法：引入协同旋转移动，通过使用从内坐标到 $\\mathcal{M}$ 的可逆映射 $\\boldsymbol{x} = \\boldsymbol{x}(\\boldsymbol{\\theta})$，沿环更新一组最小的耦合二面角 $\\boldsymbol{\\theta} \\in \\mathbb{R}^{m}$ 以精确地保持约束。从一个支撑在可行集上的对称密度 $q_\\theta(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = q_\\theta(\\boldsymbol{\\theta}' \\to \\boldsymbol{\\theta})$ 中提议 $\\boldsymbol{\\theta}'$，并以下列概率接受：\n$$\na(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\left\\{1, \\exp\\big(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})]\\big)\\, \\frac{\\left|J(\\boldsymbol{\\theta}')\\right|}{\\left|J(\\boldsymbol{\\theta})\\right|} \\right\\},\n$$\n其中 $\\left|J(\\boldsymbol{\\theta})\\right|$ 是与从 $\\boldsymbol{\\theta}$ 到 $\\mathcal{M}$ 上曲面测度 $d\\sigma(\\boldsymbol{x})$ 的变量变换相关的雅可比行列式的绝对值，确保相对于 $\\pi(\\boldsymbol{x})\\, d\\sigma(\\boldsymbol{x})$ 满足细致平衡。\n\nB. 诊断方法：在单个长程运行中监测全局 Metropolis 接受率 $\\alpha$，如果 $\\alpha  0.01$，则判定为非遍历性。修正方法：增加提议步长并提高温度 $T$，直到 $\\alpha > 0.3$，然后在升高的温度下使用相同的接受规则 $a(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\{1, \\exp(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})])\\}$ 继续采样。\n\nC. 诊断方法：从单个长程运行中计算势能的积分自相关时间 $\\tau_{\\mathrm{int}}(U)$，当 $\\tau_{\\mathrm{int}}(U)$ 超过预设阈值时，宣布为非遍历性。修正方法：添加具有小方差的单二面角高斯提议以改善局部迁移率；接受概率为 $a(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\{1, \\exp(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})])\\}$。\n\nD. 诊断方法：对单个副本的 $s(\\boldsymbol{x})$ 时间序列进行分块平均，以验证块均值是否稳定；如果它们达到平台期，则判定为遍历性。修正方法：使用副本交换蒙特卡洛（并行退火），设置 $K$ 个温度 $\\beta_1  \\cdots  \\beta_K$，并以 $\\min\\{1, \\exp[(\\beta_i - \\beta_j)(U(\\boldsymbol{x}_j) - U(\\boldsymbol{x}_i))]\\}$ 的接受概率在相邻副本之间提议交换，以促进盆地跳跃。\n\n选择同时满足诊断要求和修正移动要求，并严格遵守约束流形上正则系综细致平衡的选项。",
            "solution": "问题陈述需要经过验证。\n\n### 步骤1：提取已知条件\n- **系统：** 一个分子系统，其构型 $\\boldsymbol{x} \\in \\mathbb{R}^{3N}$ 被限制在一个光滑约束流形 $\\mathcal{M} \\subset \\mathbb{R}^{3N}$ 上。\n- **约束：** 完整约束，由 $C(\\boldsymbol{x}) = \\boldsymbol{0}$ 给出。\n- **系综：** 正则系综，逆温度为 $\\beta = 1/(k_{\\mathrm{B}} T)$。\n- **目标分布：** 对于 $\\boldsymbol{x} \\in \\mathcal{M}$，$\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$。\n- **测度：** 目标概率测度为 $\\pi(\\boldsymbol{x}) d\\sigma(\\boldsymbol{x})$，其中 $d\\sigma(\\boldsymbol{x})$ 是 $\\mathcal{M}$ 上的诱导曲面测度。\n- **模拟方法：** 采用蒙特卡洛（MC）模拟。\n- **现有移动：** 保持约束 $C(\\boldsymbol{x}) = \\boldsymbol{0}$ 的局部单二面角旋转。\n- **观察到的问题：** 模拟似乎是非遍历的，因为它被限制在由环二面角的符号模式定义的单个构象盆地中。\n- **任务：** 选择唯一的最佳选项，该选项需同时提供 (i) 一个用于诊断非遍历性的、统计上合理的诊断方法，以及 (ii) 一套能够恢复遍历性同时保持相对于 $\\mathcal{M}$ 上目标分布的细致平衡的修正性集体移动。\n- **提供的公理：**\n    - 正则分布形式：$\\pi(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x}))$，测度为 $d\\sigma(\\boldsymbol{x})$。\n    - 细致平衡条件：$\\pi(\\boldsymbol{x}) q(\\boldsymbol{x} \\to \\boldsymbol{y}) a(\\boldsymbol{x} \\to \\boldsymbol{y}) = \\pi(\\boldsymbol{y}) q(\\boldsymbol{y} \\to \\boldsymbol{x}) a(\\boldsymbol{y} \\to \\boldsymbol{x})$。\n    - 遍历性定义：不可约性和非周期性导致时间平均与系综平均等价。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据：** 该问题坚实地植根于计算统计力学和分子模拟领域。在约束流形上模拟系统、以正则系综为目标、以及处理由高能垒引起的非遍历性，都是标准的、完善的课题。所呈现的概念是基础性的且陈述正确。\n- **良构性：** 该问题是良构的。它要求根据明确的标准，在一组选项中确定唯一的最佳设计：一个有效的诊断方法和一个有效的修正方案，该方案需遵循统计力学原理（特别是针对正确目标测度的细致平衡）。\n- **客观性：** 问题使用精确、客观和标准的科学术语进行描述，没有主观或模糊的陈述。\n\n### 步骤3：结论与行动\n问题陈述有效。它在科学上是合理的，是良构的、客观的。没有可识别的缺陷。现在开始解题过程。\n\n### 推导与选项分析\n\n问题的核心在于如何在流形 $\\mathcal{M}$ 上正确执行 Metropolis-Hastings 蒙特卡洛模拟，特别是当提议的移动是在不同于势能定义坐标系（笛卡尔坐标 $\\boldsymbol{x}$）的另一个坐标系（内坐标 $\\boldsymbol{\\theta}$）中生成时。\n\n目标概率测度是相对于流形上的曲面测度定义的，$d\\mu(\\boldsymbol{x}) = \\pi(\\boldsymbol{x}) d\\sigma(\\boldsymbol{x}) \\propto \\exp(-\\beta U(\\boldsymbol{x})) d\\sigma(\\boldsymbol{x})$。如果我们通过映射 $\\boldsymbol{x}(\\boldsymbol{\\theta})$ 使用一组新坐标 $\\boldsymbol{\\theta}$ 来提议移动，我们必须考虑测度的变换。曲面元变换为 $d\\sigma(\\boldsymbol{x}) = |J(\\boldsymbol{\\theta})| d\\boldsymbol{\\theta}$，其中 $|J(\\boldsymbol{\\theta})|$ 是由嵌入诱导的度量的体积元，通常不严格地称为雅可比行列式。因此，在 $\\boldsymbol{\\theta}$ 坐标系中的目标概率密度，我们称之为 $p(\\boldsymbol{\\theta})$，是：\n$$p(\\boldsymbol{\\theta})d\\boldsymbol{\\theta} \\propto \\exp(-\\beta U(\\boldsymbol{x}(\\boldsymbol{\\theta}))) |J(\\boldsymbol{\\theta})| d\\boldsymbol{\\theta}$$\n$$p(\\boldsymbol{\\theta}) \\propto \\exp(-\\beta U(\\boldsymbol{x}(\\boldsymbol{\\theta}))) |J(\\boldsymbol{\\theta})|$$\n对于一个从 $\\boldsymbol{\\theta}$ 到 $\\boldsymbol{\\theta}'$ 且提议密度为 $q_{\\theta}(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}')$ 的移动，其 Metropolis-Hastings 接受概率为：\n$$a(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = \\min\\left\\{1, \\frac{p(\\boldsymbol{\\theta}') q_{\\theta}(\\boldsymbol{\\theta}' \\to \\boldsymbol{\\theta})}{p(\\boldsymbol{\\theta}) q_{\\theta}(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}')}\\right\\}$$\n如果使用对称提议密度，$q_{\\theta}(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = q_{\\theta}(\\boldsymbol{\\theta}' \\to \\boldsymbol{\\theta})$，则上式简化为：\n$$a(\\boldsymbol{\\theta} \\to \\boldsymbol{\\theta}') = \\min\\left\\{1, \\frac{p(\\boldsymbol{\\theta}')}{p(\\boldsymbol{\\theta})}\\right\\} = \\min\\left\\{1, \\frac{\\exp(-\\beta U(\\boldsymbol{x}')) |J(\\boldsymbol{\\theta}')|}{\\exp(-\\beta U(\\boldsymbol{x})) |J(\\boldsymbol{\\theta})|}\\right\\} = \\min\\left\\{1, \\exp(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})]) \\frac{|J(\\boldsymbol{\\theta}')|}{|J(\\boldsymbol{\\theta})|}\\right\\}$$\n这是正确的接受规则。任何涉及内坐标移动的修正方法都必须使用此形式，以满足相对于预期目标分布的细致平衡。省略雅可比行列式比率 $|J(\\boldsymbol{\\theta}')|/|J(\\boldsymbol{\\theta})|$ 是一个常见但致命的错误，它会导致从一个不正确的分布中采样。\n\n基于此基础，我们来评估各个选项。\n\n**选项 A 评估：**\n- **诊断方法：** 建议在不同的构象盆地中初始化两个或多个独立的模拟（副本），这些盆地由一个序参量 $s(\\boldsymbol{x})$ 表征。使用 Jensen-Shannon 散度 $D_{\\mathrm{JS}}$（Kullback-Leibler 散度的对称版本）来量化从每个副本收集的 $s(\\boldsymbol{x})$ 经验分布之间的差异。如果模拟是遍历的，所有副本最终将探索整个状态空间，使其各自的分布收敛到真实的平衡分布。因此，在长模拟时间 $L \\to \\infty$ 的极限下，$D_{\\mathrm{JS}}$ 必须衰减到 $0$。持续不为零的 $D_{\\mathrm{JS}}$ 是非遍历性（即副本被困住）的一个强有力的、符合统计学原理的指标。这是一种稳健且被广泛接受的诊断方法。\n- **修正方法：** 提议了一种涉及环二面角 $\\boldsymbol{\\theta}$ 协同旋转的集体移动。这直接针对有问题的自由度。关键在于，其提议的接受概率为 $a(\\boldsymbol{x} \\to \\boldsymbol{x}') = \\min\\left\\{1, \\exp\\big(-\\beta[U(\\boldsymbol{x}') - U(\\boldsymbol{x})]\\big)\\, \\frac{\\left|J(\\boldsymbol{\\theta}')\\right|}{\\left|J(\\boldsymbol{\\theta})\\right|} \\right\\}$。如上所述，这正是在内坐标中进行 Metropolis-Hastings 移动的精确公式，它能保持约束流形 $\\mathcal{M}$ 上正则分布的细致平衡。\n- **结论：** 诊断方法和修正方案都严谨、符合统计学原理且公式正确。**正确**。\n\n**选项 B 评估：**\n- **诊断方法：** 提议使用全局 Metropolis 接受率 $\\alpha$ 作为非遍历性的诊断指标。并建议低接受率 $(\\alpha  0.01)$ 作为指标。这是一个有缺陷的诊断指标。接受率是移动效率的度量，而非遍历性的度量。一个模拟可以有很高的接受率（例如，通过采取非常小的步长），但仍然被限制在一个盆地中。相反，一个模拟可以是完全遍历的，但如果提议经常落在高能区域，其接受率也可能很低。因此，$\\alpha$ 并非不可约性的可靠指标。\n- **修正方法：** 建议增加提议步长并提高温度 $T$。提高 $T$ 会改变逆温度 $\\beta$，这从根本上将目标分布改变为 $\\pi'(\\boldsymbol{x}) \\propto \\exp(-\\beta' U(\\boldsymbol{x}))$，其中 $\\beta'  \\beta$。问题明确要求一个*不*改变目标正则分布的修正方案。此提议违反了一个关键约束。此外，它提议使用简单的 Metropolis 接受规则，这对于内坐标移动是不正确的，因为它省略了雅可比校正项。\n- **结论：** 该诊断方法不可靠，且修正方案在两方面存在缺陷：它改变了目标系综，并且使用了不正确的接受准则。**不正确**。\n\n**选项 C 评估：**\n- **诊断方法：** 提议使用势能的积分自相关时间 $\\tau_{\\mathrm{int}}(U)$ 作为诊断指标。大的 $\\tau_{\\mathrm{int}}(U)$ 表示能量的退相关很慢，这通常是采样不佳或陷入势阱的症状。然而，它并非对非遍历性的直接或确定性检验。一个系统可以是遍历的，但表现出非常缓慢的动力学（即稀有但可能发生的跃迁），这也会导致大的 $\\tau_{\\mathrm{int}}$。它不能证明状态空间在移动集下是根本不连通的。\n- **修正方法：** 建议增加更多的“单二面角”移动。问题陈述已说明这类移动已在使用，并且是问题的原因，因为它们不足以产生跨越环翻转能垒所需的集体运动。这个修正方案没有解决核心问题。此外，它提议使用简单的 Metropolis 接受规则，如前所述，由于缺少雅可比项，这对于二面角移动是不正确的。\n- **结论：** 诊断方法薄弱且间接。修正方案不足以解决所述问题，并且采用了违反细致平衡的错误接受规则。**不正确**。\n\n**选项 D 评估：**\n- **诊断方法：** 建议对单个轨迹使用分块平均。分块平均是一种通过观察连续数据块的均值的方差来估计平均值统计误差的技术。如果块均值稳定，则表明模拟已收敛到*其正在探索的区域内*的稳态。然而，如果模拟是非遍历的且被困在一个盆地中，块均值将仅收敛到该盆地的平均值，从而给出全局收敛的危险假象。这种诊断方法无法检测到其他未探索盆地的存在。它根本不适用于诊断此类非遍历性。\n- **修正方法：** 提议使用副本交换蒙特卡洛（REMC），也称为并行退火。REMC 是一种优秀且强大的用于克服能垒的增强采样技术。它保持细致平衡，并且不改变目标温度下的目标分布（它也对其他温度进行采样，但 $\\beta_1$ 副本正确地采样了目标系综）。交换的接受规则也是正确的。因此，修正方案本身是一个有效的方法。然而，问题要求的是唯一的最佳*设计*，其中包括诊断方法。\n- **结论：** 修正方案是有效的，但诊断方法存在致命缺陷，会导致假阴性（即未能检测到非遍历性）。由于设计的诊断部分完全失败，整个选项是不可接受的。**不正确**。\n\n### 结论\n选项A是唯一一个既提出了统计上严谨的非遍历性诊断方法（比较独立副本），又提出了物理上恰当的修正性移动（协同旋转），并且使用了包含必要雅可比因子的正确 Metropolis-Hastings 接受概率，以确保在约束流形上满足细致平衡的选项。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}