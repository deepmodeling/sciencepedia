{
    "hands_on_practices": [
        {
            "introduction": "在我们深入分析Metropolis-Hastings算法的行为之前，我们必须掌握其核心的计算步骤——接受概率的计算。本练习提供了一个清晰的场景，让您亲手演练接受概率的完整公式，这是算法决策机制的心脏。",
            "id": "1343441",
            "problem": "一个模拟从非负整数集合 $\\{0, 1, 2, \\dots \\}$ 中生成状态。目标是从一个目标概率分布中进行抽样，其中处于状态 $k$ 的概率（记为 $\\pi(k)$）与 $(1/2)^k$ 成正比。\n\n该模拟使用一个在状态之间转移的马尔可夫链。在任意给定状态 $i  0$ 时，通过以 $1/2$ 的相等概率选择 $j=i-1$ 或 $j=i+1$ 来提议下一个状态 $j$。如果当前状态为 $i=0$，则总是提议转移到状态 $j=1$。从状态 $i$ 到提议状态 $j$ 的转移概率记为 $Q(j|i)$。\n\n是否接受该提议移动的决定由 Metropolis-Hastings 接受概率确定。\n\n假设该链当前处于状态 $X_t=3$，并且提议移动到候选状态 $y=4$。计算此移动被接受的概率。将您的答案表示为精确值。",
            "solution": "我们给定一个在非负整数上的目标分布，其概率与 $(1/2)^{k}$ 成正比。将目标分布写为\n$$\n\\pi(k)=C\\left(\\frac{1}{2}\\right)^{k},\n$$\n其中 $C$ 是归一化常数（它将在 Metropolis-Hastings 比率中被消去）。\n\n提议核 $Q(j\\mid i)$ 定义如下：\n- 如果 $i0$，则 $Q(i-1\\mid i)=\\frac{1}{2}$ 且 $Q(i+1\\mid i)=\\frac{1}{2}$。\n- 如果 $i=0$，则 $Q(1\\mid 0)=1$。\n\n从当前状态 $i$ 移动到提议状态 $y$ 的 Metropolis-Hastings 接受概率为\n$$\n\\alpha(i\\to y)=\\min\\left\\{1,\\ \\frac{\\pi(y)\\,Q(i\\mid y)}{\\pi(i)\\,Q(y\\mid i)}\\right\\}。\n$$\n\n这里，当前状态是 $i=3$，提议状态是 $y=4$。由于 $i=3$ 和 $y=4$ 都大于 $0$，我们有\n$$\nQ(4\\mid 3)=\\frac{1}{2},\\qquad Q(3\\mid 4)=\\frac{1}{2}。\n$$\n因此，\n$$\n\\frac{\\pi(4)\\,Q(3\\mid 4)}{\\pi(3)\\,Q(4\\mid 3)}\n=\\frac{C\\left(\\frac{1}{2}\\right)^{4}\\cdot \\frac{1}{2}}{C\\left(\\frac{1}{2}\\right)^{3}\\cdot \\frac{1}{2}}\n=\\frac{\\left(\\frac{1}{2}\\right)^{4}}{\\left(\\frac{1}{2}\\right)^{3}}\n=\\frac{1}{2}。\n$$\n因此，接受概率为\n$$\n\\alpha(3\\to 4)=\\min\\left\\{1,\\ \\frac{1}{2}\\right\\}=\\frac{1}{2}。\n$$",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "MCMC方法的一个关键挑战在于设计能够高效探索整个状态空间的提议分布。本练习通过一个典型的双峰目标分布，帮助您探讨两种移动策略的利弊：进行高接受率的“小步”局部探索，或是尝试低接受率但可能发现新模式的“大步”全局跳跃。通过比较这两种情况下的接受概率，您将直观地理解为何精心设计提议分布对采样效率至关重要。",
            "id": "1401728",
            "problem": "一位研究人员正在实现梅特罗波利斯-哈斯廷斯 (Metropolis-Hastings, MH) 算法，以从一个一维目标概率分布中生成样本。该分布的概率密度函数 $p(x)$ 已知与函数 $f(x)$ 成正比，其中 $f(x) = \\exp(8x^2 - x^4)$。该算法通过使用一个提议分布 $q(x'|x_t)$，从当前状态 $x_t$ 提议一个新状态 $x'$ 来进行。对于此特定实现，提议分布是一个对称的正态分布 $q(x'|x_t) = N(x'|x_t, \\sigma^2)$，这将 MH 过程简化为梅特罗波利斯 (Metropolis) 算法。\n\n假设采样器当前处于状态 $x_t = 2.0$，这对应于目标概率密度的一个局部最大值（一个众数）。该研究人员希望了解对于不同类型的提议移动，接受概率如何变化。他们考虑了两个具体的、假设性的提议：\n\n1.  一次小的、局部的移动，到提议状态 $x'_S = 2.1$。\n2.  一次大的、探索性的移动，到提议状态 $x'_L = -1.5$，该状态位于以 $x=0$ 为中心的低概率区域的另一侧。\n\n令 $A_S$ 为从 $x_t$ 到 $x'_S$ 的小移动的接受概率，令 $A_L$ 为从 $x_t$ 到 $x'_L$ 的大移动的接受概率。\n\n计算比率 $\\frac{A_S}{A_L}$。将您的最终答案四舍五入到三位有效数字。",
            "solution": "在梅特罗波利斯-哈斯廷斯算法中，从 $x_{t}$ 到 $x'$ 的提议的接受概率为\n$$\nA(x_{t}\\to x')=\\min\\left(1,\\frac{p(x')\\,q(x_{t}|x')}{p(x_{t})\\,q(x'|x_{t})}\\right).\n$$\n对于对称提议 $q(x'|x_{t})=q(x_{t}|x')$，这简化为梅特罗波利斯法则\n$$\nA(x_{t}\\to x')=\\min\\left(1,\\frac{p(x')}{p(x_{t})}\\right).\n$$\n给定 $p(x)\\propto f(x)$ 且 $f(x)=\\exp(8x^{2}-x^{4})$，归一化常数在比率中被消去，所以\n$$\n\\frac{p(x')}{p(x_{t})}=\\frac{f(x')}{f(x_{t})}=\\exp\\!\\left(8\\bigl(x'^{2}-x_{t}^{2}\\bigr)-\\bigl(x'^{4}-x_{t}^{4}\\bigr)\\right).\n$$\n\n对于从 $x_{t}=2.0$ 到 $x'_{S}=2.1$ 的小移动：\n- $x_{t}^{2}=4$, $x_{t}^{4}=16$; $x_{S}'^{2}=4.41$, $x_{S}'^{4}=19.4481$。\n- 指数差：\n$$\n8\\bigl(4.41-4\\bigr)-\\bigl(19.4481-16\\bigr)=8\\cdot 0.41-3.4481=3.28-3.4481=-0.1681.\n$$\n因此\n$$\n\\frac{p(x'_{S})}{p(x_{t})}=\\exp(-0.1681)  1,\\quad A_{S}=\\exp(-0.1681).\n$$\n\n对于从 $x_{t}=2.0$ 到 $x'_{L}=-1.5$ 的大移动：\n- $x_{L}'^{2}=2.25$, $x_{L}'^{4}=5.0625$。\n- 指数差：\n$$\n8\\bigl(2.25-4\\bigr)-\\bigl(5.0625-16\\bigr)=8\\cdot(-1.75)-(-10.9375)=-14+10.9375=-3.0625.\n$$\n因此\n$$\n\\frac{p(x'_{L})}{p(x_{t})}=\\exp(-3.0625)  1,\\quad A_{L}=\\exp(-3.0625).\n$$\n\n所以，接受概率的比率为\n$$\n\\frac{A_{S}}{A_{L}}=\\frac{\\exp(-0.1681)}{\\exp(-3.0625)}=\\exp(2.8944)\\approx 18.1\n$$\n四舍五入到三位有效数字。",
            "answer": "$$\\boxed{18.1}$$"
        },
        {
            "introduction": "MCMC方法的理论正确性悬于一个关键假设：马尔可夫链的遍历性（ergodicity），即从任意状态出发，链都有可能在有限步骤内到达其他任何状态。本练习精心设计了一个场景，其中由于提议分布的步长过小，这一核心性质遭到了破坏。通过这个实践，您将亲身体验一个“断裂”的链如何被困在局部，最终导致采样结果严重偏离真实的目标分布，从而深刻理解遍历性在实践中的重要性。",
            "id": "1401742",
            "problem": "一位统计学家正在使用马尔可夫链蒙特卡洛（MCMC）算法从一维目标概率密度 $p(x)$ 中抽样。\n\n随机变量 $x$ 的状态空间 $\\mathcal{X}$ 定义为两个不相交区间的并集：$\\mathcal{X} = [-2, -1] \\cup [1, 2]$。\n\n未归一化的目标密度 $f(x)$ 分段定义如下：\n$$\nf(x) = \\begin{cases}\n1  \\text{if } x \\in [-2, -1] \\\\\n3  \\text{if } x \\in [1, 2] \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\n归一化目标密度为 $p(x) = f(x) / Z$，其中 $Z = \\int_{\\mathcal{X}} f(x) dx$。\n\n该抽样器使用 Metropolis-Hastings 算法。在每一步中，给定当前状态 $x_t$，从一个对称的提议分布 $q(x'|x_t)$ 中提议一个候选状态 $x'$，该提议分布是区间 $[x_t - 0.5, x_t + 0.5]$ 上的均匀分布。如果提议的状态 $x'$ 落在状态空间 $\\mathcal{X}$ 之外，它将被自动拒绝。\n\n抽样器在状态 $x_0 = 1.5$ 处初始化。然后，它会运行非常多次迭代。根据 MCMC 的理论，样本的长期平均值 $\\frac{1}{N}\\sum_{i=1}^N x_i$ 应收敛到 $x$ 在马尔可夫链的平稳分布下的期望值。\n\n确定 $x$ 的样本均值将收敛到的数值。请用精确分数表示您的答案。",
            "solution": "未归一化的目标密度是分段常数：在 $[-2,-1]$ 上 $f(x)=1$，在 $[1,2]$ 上 $f(x)=3$，其他情况下为 $0$。归一化常数为\n$$\nZ=\\int_{\\mathcal{X}} f(x)\\,dx=\\int_{-2}^{-1} 1\\,dx+\\int_{1}^{2} 3\\,dx=[x]_{-2}^{-1}+[3x]_{1}^{2}=1+3=4.\n$$\n因此，全空间的归一化目标密度为 $p(x)=f(x)/Z$，它將总质量 $\\int_{-2}^{-1} p(x)\\,dx=\\frac{1}{4}$ 分配在 $[-2,-1]$ 上，并将总质量 $\\int_{1}^{2} p(x)\\,dx=\\frac{3}{4}$ 分配在 $[1,2]$ 上。\n\nMetropolis-Hastings 提议是对称的：$q(x'|x)$ 在 $[x-0.5,x+0.5]$ 上是均匀的。落在 $\\mathcal{X}$ 之外的提议会被拒绝，这等价于在 $\\mathcal{X}$ 之外目标密度为零的标准 MH 规则。关键在于，由于最大提议步长为 $0.5$，而两个区间之间的间隔为 $2$，因此在任意数量的接受步骤中，从一个区间移动到另一个区间的概率为零：对于任何 $x\\in[1,2]$，提议的支撑集 $[x-0.5,x+0.5]\\subset[0.5,2.5]$，因此任何提议的 $x'1$ 或 $x'>2$ 都会落在 $\\mathcal{X}$ 之外并被拒绝。因此，该马尔可夫链有两个封闭的互通类，从 $x_{0}=1.5\\in[1,2]$ 开始，它将永远停留在 $[1,2]$ 内。\n\n在 $[1,2]$ 内，$f(x)\\equiv 3$ 是常数，因此对于任何提议的 $x'\\in[1,2]$，Metropolis-Hastings 接受概率为 $\\min\\{1,f(x')/f(x)\\}=1$。限制在该类上的马尔可夫链的不变分布在 $[1,2]$ 上与 $f$ 成正比，因此是在 $[1,2]$ 上的均匀分布：\n$$\ng(x)=\\frac{f(x)}{\\int_{1}^{2} f(u)\\,du}=\\frac{3}{\\int_{1}^{2}3\\,du}=\\frac{3}{3}=1\\quad\\text{for }x\\in[1,2],\n$$\n其他情况下 $g(x)=0$。因此，长期样本均值收敛到 $X$ 在 $g$ 分布下的期望，即\n$$\n\\mathbb{E}_{g}[X]=\\int_{1}^{2} x\\,g(x)\\,dx=\\int_{1}^{2} x\\,dx=\\frac{1}{2}\\left(x^{2}\\right)\\bigg|_{1}^{2}=\\frac{1}{2}\\left(4-1\\right)=\\frac{3}{2}.\n$$\n根据封闭互通类内马尔可夫链的遍历定理，经验均值 $\\frac{1}{N}\\sum_{i=1}^{N} x_{i}$ 几乎必然收敛到 $\\mathbb{E}_{g}[X]=\\frac{3}{2}$。",
            "answer": "$$\\boxed{\\frac{3}{2}}$$"
        }
    ]
}