{"hands_on_practices": [{"introduction": "The finite element method constructs vast, complex systems by repeating simple calculations on small, manageable domains. This first practice focuses on the cornerstone of this process: assembling a global matrix from local element contributions. You will translate the weak form of the momentum equation's time-derivative term into a local mass matrix and then assemble these pieces to form a specific entry in the global system, solidifying your understanding of the foundational FEM workflow.", "problem": "Consider the incompressible Navier–Stokes equations for a Newtonian fluid with constant density $\\rho$ on a bounded polygonal domain $\\Omega \\subset \\mathbb{R}^{2}$ with homogeneous Dirichlet boundary conditions for the velocity:\n$$\n\\rho\\,\\partial_{t}\\boldsymbol{u} + \\rho\\,(\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} - \\mu\\,\\Delta \\boldsymbol{u} + \\nabla p = \\boldsymbol{f}, \\quad \\nabla\\cdot \\boldsymbol{u} = 0 \\quad \\text{in } \\Omega.\n$$\nUse the Galerkin finite element method (Finite Element Method (FEM)) with continuous piecewise-affine (i.e., $\\mathbb{P}_{1}$) vector shape functions for the velocity and let the semi-discrete (in space) velocity field be\n$$\n\\boldsymbol{u}_{h}(t,\\boldsymbol{x}) = \\sum_{a=1}^{N} U_{a}^{x}(t)\\,\\boldsymbol{e}_{x}\\,\\varphi_{a}(\\boldsymbol{x}) + \\sum_{a=1}^{N} U_{a}^{y}(t)\\,\\boldsymbol{e}_{y}\\,\\varphi_{a}(\\boldsymbol{x}),\n$$\nwhere $\\{\\varphi_{a}\\}_{a=1}^{N}$ are the scalar nodal hat functions associated with the mesh vertices, and $\\{\\boldsymbol{e}_{x},\\boldsymbol{e}_{y}\\}$ are the Cartesian basis vectors. The semi-discrete Galerkin formulation for the momentum equation contains a mass term of the form\n$$\n\\rho\\int_{\\Omega} \\boldsymbol{w}_{h}\\cdot \\partial_{t}\\boldsymbol{u}_{h}\\,d\\boldsymbol{x},\n$$\nwhere $\\boldsymbol{w}_{h}$ ranges over the same vector space as $\\boldsymbol{u}_{h}$. This term induces the global mass matrix $\\boldsymbol{M}$.\n\nStarting from the weak formulation and the definition of the $\\mathbb{P}_{1}$ nodal basis, do the following.\n\n$1.$ Derive the element-wise expression of the local mass matrix on any element $K$,\n$$\n\\boldsymbol{M}^{(K)}_{(i,\\alpha),(j,\\beta)} = \\rho \\int_{K} \\big(\\boldsymbol{e}_{\\alpha}\\,\\varphi_{i}\\big)\\cdot \\big(\\boldsymbol{e}_{\\beta}\\,\\varphi_{j}\\big)\\,d\\boldsymbol{x},\n$$\nfor node indices $i,j$ local to $K$ and component indices $\\alpha,\\beta\\in\\{x,y\\}$. Reduce this to integrals of the scalar basis functions $\\varphi_{i},\\varphi_{j}$ and identify which entries vanish by orthogonality of components.\n\n$2.$ Specialize to the mesh $\\mathcal{T}_{h}$ of the unit square $\\Omega = (0,1)\\times(0,1)$ subdivided into $2$ triangles by the diagonal from $(0,0)$ to $(1,1)$:\n$$\nK_{1} = \\operatorname{conv}\\{(0,0),(1,0),(1,1)\\}, \\qquad K_{2} = \\operatorname{conv}\\{(0,0),(1,1),(0,1)\\}.\n$$\nLet the global vertices be labeled as $N_{1}=(0,0)$, $N_{2}=(1,0)$, $N_{3}=(1,1)$, $N_{4}=(0,1)$, with associated scalar hat functions $\\{\\varphi_{1},\\varphi_{2},\\varphi_{3},\\varphi_{4}\\}$. Using only fundamental properties of barycentric coordinates on a triangle and integral identities that follow from $\\lambda_{1}+\\lambda_{2}+\\lambda_{3}\\equiv 1$ on any triangle, compute the local scalar integrals $\\int_{K}\\varphi_{i}\\varphi_{j}\\,d\\boldsymbol{x}$ needed for $K=K_{1}$ and $K=K_{2}$.\n\n$3.$ Briefly state the assembly rule that maps each local element matrix $\\boldsymbol{M}^{(K)}$ into the global mass matrix $\\boldsymbol{M}$, in terms of the global degree-of-freedom (DoF) indices corresponding to $(i,\\alpha)$ and $(j,\\beta)$.\n\nFinally, using the above, compute the single global entry of the consistent mass matrix corresponding to the $x$-component at node $N_{3}$ tested against itself, i.e.,\n$$\nM_{(N_{3},x),(N_{3},x)}.\n$$\nExpress your final answer as a simplified exact expression in terms of $\\rho$ with no units. The final answer must be a single closed-form analytic expression.", "solution": "The problem statement is valid. It is a standard, well-posed exercise in the finite element method (FEM) applied to fluid dynamics, free of any scientific or logical flaws. We proceed to the solution.\n\nThe problem asks for a step-by-step derivation culminating in a specific entry of the global consistent mass matrix for the semi-discretized Navier-Stokes equations.\n\nFirst, we derive the general expression for the local mass matrix $\\boldsymbol{M}^{(K)}$ on a triangular element $K$. The velocity field is discretized using continuous piecewise-affine ($\\mathbb{P}_{1}$) vector basis functions. A vector basis function associated with a local node $i$ and Cartesian component $\\alpha \\in \\{x,y\\}$ is $\\boldsymbol{\\psi}_{i,\\alpha}(\\boldsymbol{x}) = \\boldsymbol{e}_{\\alpha}\\varphi_{i}(\\boldsymbol{x})$, where $\\varphi_{i}$ is the scalar nodal basis function (the \"hat function\"). The semi-discrete velocity is $\\boldsymbol{u}_{h}(t,\\boldsymbol{x}) = \\sum_{j,\\beta} U_{j,\\beta}(t) \\boldsymbol{\\psi}_{j,\\beta}(\\boldsymbol{x})$. The test functions $\\boldsymbol{w}_{h}$ are chosen from the same space. A generic test function is $\\boldsymbol{w}_{h}(\\boldsymbol{x}) = \\boldsymbol{\\psi}_{i,\\alpha}(\\boldsymbol{x})$.\n\nThe mass term contribution from element $K$ is $\\rho\\int_{K} \\boldsymbol{w}_{h}\\cdot \\partial_{t}\\boldsymbol{u}_{h}\\,d\\boldsymbol{x}$. Substituting the basis functions, we obtain the local mass matrix entries:\n$$\n\\boldsymbol{M}^{(K)}_{(i,\\alpha),(j,\\beta)} = \\rho \\int_{K} \\boldsymbol{\\psi}_{i,\\alpha}(\\boldsymbol{x}) \\cdot \\boldsymbol{\\psi}_{j,\\beta}(\\boldsymbol{x}) \\,d\\boldsymbol{x}\n$$\n$$\n\\boldsymbol{M}^{(K)}_{(i,\\alpha),(j,\\beta)} = \\rho \\int_{K} \\big(\\boldsymbol{e}_{\\alpha}\\,\\varphi_{i}(\\boldsymbol{x})\\big) \\cdot \\big(\\boldsymbol{e}_{\\beta}\\,\\varphi_{j}(\\boldsymbol{x})\\big) \\,d\\boldsymbol{x}\n$$\nSince the scalar basis functions $\\varphi_{i}$ and $\\varphi_{j}$ are independent of the component indices, and the Cartesian basis vectors $\\{\\boldsymbol{e}_{x}, \\boldsymbol{e}_{y}\\}$ are constant, we can write:\n$$\n\\boldsymbol{M}^{(K)}_{(i,\\alpha),(j,\\beta)} = \\rho \\, (\\boldsymbol{e}_{\\alpha}\\cdot \\boldsymbol{e}_{\\beta}) \\int_{K} \\varphi_{i}(\\boldsymbol{x})\\varphi_{j}(\\boldsymbol{x})\\,d\\boldsymbol{x}\n$$\nThe Cartesian basis vectors are orthonormal, i.e., $\\boldsymbol{e}_{\\alpha}\\cdot \\boldsymbol{e}_{\\beta} = \\delta_{\\alpha\\beta}$, where $\\delta_{\\alpha\\beta}$ is the Kronecker delta. Thus, the expression simplifies to:\n$$\n\\boldsymbol{M}^{(K)}_{(i,\\alpha),(j,\\beta)} = \\rho \\, \\delta_{\\alpha\\beta} \\int_{K} \\varphi_{i}(\\boldsymbol{x})\\varphi_{j}(\\boldsymbol{x})\\,d\\boldsymbol{x}\n$$\nThis result shows that the entries are non-zero only if $\\alpha=\\beta$. The coupling between the $x$ and $y$ velocity components is zero within the mass matrix, meaning it is block-diagonal. The two diagonal blocks, for $x-x$ and $y-y$ components, are identical and equal to $\\rho$ times the scalar mass matrix $M^{\\text{scalar}}_{ij} = \\int_{K} \\varphi_{i}\\varphi_{j}\\,d\\boldsymbol{x}$.\n\nSecond, we compute the scalar integrals $\\int_{K}\\varphi_{i}\\varphi_{j}\\,d\\boldsymbol{x}$ for the specific mesh provided. The domain $\\Omega = (0,1)\\times(0,1)$ is divided into two triangles, $K_{1}$ and $K_{2}$, with areas $|K_1| = |K_2| = 1/2$. For a $\\mathbb{P}_{1}$ element, the scalar basis function $\\varphi_{i}$ associated with a vertex is identical to the barycentric coordinate $\\lambda_{i}$ corresponding to that vertex. We use the standard integral formula for barycentric coordinates on a triangle $K$ with area $|K|$:\n$$\n\\int_{K} \\lambda_{1}^{a}\\lambda_{2}^{b}\\lambda_{3}^{c} \\, d\\boldsymbol{x} = \\frac{a!\\,b!\\,c!}{(a+b+c+2)!} \\, 2|K|\n$$\nFor the diagonal entries of the scalar mass matrix ($i=j$), we need to compute $\\int_{K} \\varphi_{i}^{2}\\,d\\boldsymbol{x} = \\int_{K} \\lambda_{i}^{2}\\,d\\boldsymbol{x}$. Using the formula with exponents $(a,b,c)=(2,0,0)$, we get:\n$$\n\\int_{K} \\varphi_{i}^{2}\\,d\\boldsymbol{x} = \\frac{2!\\,0!\\,0!}{(2+0+0+2)!} \\, 2|K| = \\frac{2}{4!} \\, 2|K| = \\frac{4|K|}{24} = \\frac{|K|}{6}\n$$\nFor the off-diagonal entries ($i\\neq j$), we compute $\\int_{K} \\varphi_{i}\\varphi_{j}\\,d\\boldsymbol{x} = \\int_{K} \\lambda_{i}\\lambda_{j}\\,d\\boldsymbol{x}$. Using the formula with exponents $(a,b,c)=(1,1,0)$, we get:\n$$\n\\int_{K} \\varphi_{i}\\varphi_{j}\\,d\\boldsymbol{x} = \\frac{1!\\,1!\\,0!}{(1+1+0+2)!} \\, 2|K| = \\frac{1}{4!} \\, 2|K| = \\frac{2|K|}{24} = \\frac{|K|}{12}\n$$\nFor both triangles $K_1$ and $K_2$ in the given mesh, the area is $|K| = 1/2$. Therefore, for any triangle $K$ in this mesh and any local indices $i,j$:\n$$\n\\int_{K} \\varphi_{i}^{2}\\,d\\boldsymbol{x} = \\frac{1/2}{6} = \\frac{1}{12}\n$$\n$$\n\\int_{K} \\varphi_{i}\\varphi_{j}\\,d\\boldsymbol{x} = \\frac{1/2}{12} = \\frac{1}{24} \\quad (i\\neq j)\n$$\n\nThird, the assembly rule for constructing the global mass matrix $\\boldsymbol{M}$ from the local element matrices $\\boldsymbol{M}^{(K)}$ is a summation process. Each entry of the global matrix $\\boldsymbol{M}_{I,J}$ is the sum of contributions from all element matrices $\\boldsymbol{M}^{(K)}$ that have local degrees of freedom corresponding to the global degrees of freedom $I$ and $J$. Let $\\text{map}(K, i)$ be the global index of the $i$-th local node of element $K$, and let the global DoF $I$ correspond to the pair $(\\text{global node}, \\text{component})$. Then, the global entry for $(\\text{node } n, \\text{component } \\alpha)$ tested against $(\\text{node } m, \\text{component } \\beta)$ is:\n$$\nM_{(n,\\alpha),(m,\\beta)} = \\sum_{K \\in \\mathcal{T}_{h}} \\boldsymbol{M}^{(K)}_{(i_n,\\alpha),(j_m,\\beta)},\n$$\nwhere the sum is over all elements $K$ containing both global nodes $n$ and $m$, and $i_n$, $j_m$ are the corresponding local indices within $K$. If an element does not contain one of the nodes, its contribution is zero.\n\nFinally, we compute the specific global mass matrix entry $M_{(N_{3},x),(N_{3},x)}$. This is the diagonal entry corresponding to the $x$-component of velocity at global node $N_{3}=(1,1)$. According to the assembly rule, this value is the sum of the corresponding local diagonal entries from all elements that share node $N_3$. The node $N_3$ is a vertex of both triangles $K_{1}$ and $K_{2}$.\n$$\nM_{(N_{3},x),(N_{3},x)} = \\boldsymbol{M}^{(K_1)}_{(i_3,x),(i_3,x)} + \\boldsymbol{M}^{(K_2)}_{(j_3,x),(j_3,x)}\n$$\nwhere $i_3$ and $j_3$ are the local indices corresponding to global node $N_3$ in triangles $K_1$ and $K_2$, respectively.\nFrom our first result, the local matrix entry is:\n$$\n\\boldsymbol{M}^{(K)}_{(i,x),(i,x)} = \\rho \\int_{K} \\varphi_{i}^{2}(\\boldsymbol{x})\\,d\\boldsymbol{x}\n$$\nUsing the value of the integral we computed, for $K_1$:\n$$\n\\boldsymbol{M}^{(K_1)}_{(i_3,x),(i_3,x)} = \\rho \\int_{K_1} \\varphi_{i_3}^{2}\\,d\\boldsymbol{x} = \\rho \\frac{|K_1|}{6} = \\rho \\frac{1/2}{6} = \\frac{\\rho}{12}\n$$\nFor $K_2$:\n$$\n\\boldsymbol{M}^{(K_2)}_{(j_3,x),(j_3,x)} = \\rho \\int_{K_2} \\varphi_{j_3}^{2}\\,d\\boldsymbol{x} = \\rho \\frac{|K_2|}{6} = \\rho \\frac{1/2}{6} = \\frac{\\rho}{12}\n$$\nSumming these two contributions gives the final value for the global matrix entry:\n$$\nM_{(N_{3},x),(N_{3},x)} = \\frac{\\rho}{12} + \\frac{\\rho}{12} = \\frac{2\\rho}{12} = \\frac{\\rho}{6}\n$$", "answer": "$$\n\\boxed{\\frac{\\rho}{6}}\n$$", "id": "2582614"}, {"introduction": "Building on the foundational skill of matrix assembly ([@problem_id:2582614]), we now tackle a more comprehensive and realistic problem. This practice involves assembling the complete system matrix for the linearized Oseen equations, which requires handling multiple coupled fields (velocity and pressure) and a pressure-stabilization term. By constructing the distinct matrix blocks for convection, diffusion, and pressure-gradient coupling, you will gain a clear, practical understanding of how different physical effects are represented in the final discrete system.", "problem": "Consider the incompressible Navier–Stokes equations in two space dimensions in the Oseen linearized form at a given convecting velocity field $\\boldsymbol{U}$, discretized in space by the Finite Element Method (FEM) with equal-order continuous piecewise linear elements ($P_1/P_1$) for both velocity and pressure and stabilized for pressure. The computational domain is the unit square with vertices at $(0,0)$, $(1,0)$, $(1,1)$, and $(0,1)$, triangulated into two elements by the diagonal from $(0,0)$ to $(1,1)$. Denote the nodes by $1:(0,0)$, $2:(1,0)$, $3:(1,1)$, and $4:(0,1)$. The two triangles are $K_1 = \\operatorname{conv}\\{(0,0),(1,0),(1,1)\\}$ and $K_2 = \\operatorname{conv}\\{(0,0),(1,1),(0,1)\\}$. Let the kinematic viscosity be $\\nu>0$ and the density be $\\rho=1$. Let the linearization (convecting) velocity be uniform $\\boldsymbol{U}=(2,1)$.\n\nLet $\\boldsymbol{u}$ denote the velocity field and $p$ the pressure. The semi-discrete (in time) stabilized weak form seeks $\\boldsymbol{u}_h(t)$ and $p_h(t)$ in the $P_1/P_1$ spaces such that, for all test functions $\\boldsymbol{w}_h$ and $q_h$ in the same spaces,\n- the momentum balance reads\n$\\displaystyle (\\boldsymbol{w}_h,\\dot{\\boldsymbol{u}}_h) + \\nu \\sum_{K} (\\nabla \\boldsymbol{u}_h,\\nabla \\boldsymbol{w}_h)_K + \\sum_{K} ((\\boldsymbol{U}\\cdot \\nabla)\\boldsymbol{u}_h,\\boldsymbol{w}_h)_K - (p_h,\\nabla\\cdot \\boldsymbol{w}_h) = (\\boldsymbol{f},\\boldsymbol{w}_h)$,\n- the incompressibility and stabilization read\n$\\displaystyle (q_h,\\nabla\\cdot \\boldsymbol{u}_h) + \\sum_{K} \\tau_{p,K} (\\nabla p_h,\\nabla q_h)_K = 0$,\nwhere $(\\cdot,\\cdot)_K$ is the $L^2$ inner product over element $K$, and $\\tau_{p,K}$ is a pressure stabilization parameter chosen as $\\tau_{p,K}=\\alpha h_K^2$ with a constant $\\alpha>0$ and element size $h_K$ (you may assume $h_{K_1}=h_{K_2}=1$ for this mesh). No other stabilization is employed.\n\nAdopt the nodal $P_1$ scalar shape functions $\\{N_i\\}_{i=1}^4$, and the standard vector-valued velocity basis $\\{\\boldsymbol{\\phi}_{i}^{x},\\boldsymbol{\\phi}_{i}^{y}\\}_{i=1}^4$ defined by $\\boldsymbol{\\phi}_{i}^{x} = N_i \\boldsymbol{e}_x$ and $\\boldsymbol{\\phi}_{i}^{y} = N_i \\boldsymbol{e}_y$, where $\\boldsymbol{e}_x$ and $\\boldsymbol{e}_y$ are the Cartesian unit vectors. Let the global vector of unknowns be ordered as $\\big(u_1^x,u_2^x,u_3^x,u_4^x,u_1^y,u_2^y,u_3^y,u_4^y,p_1,p_2,p_3,p_4\\big)^\\top$.\n\n1. Starting from the weak form above and the definitions of the $P_1$ basis functions on each triangle, assemble the linearized semi-discrete block system matrix $\\mathbb{A}(\\boldsymbol{U})$ such that the semi-discrete system reads\n$\\displaystyle \\mathbb{M}\\,\\dot{\\mathbf{z}}(t) + \\mathbb{A}(\\boldsymbol{U})\\,\\mathbf{z}(t) = \\mathbf{F}(t),$\nwith $\\mathbf{z}(t)$ collecting the nodal values of velocity and pressure in the given order, and identify each block in $\\mathbb{M}$ and $\\mathbb{A}(\\boldsymbol{U})$ by its mathematical meaning (diffusion, linearized convection, divergence/gradient coupling, and pressure stabilization). Your assembly must be consistent with the two-element mesh described and the chosen bases.\n\n2. Using only the fundamental definitions of the element-level bilinear forms and the $P_1$ shape functions, compute explicitly the global diagonal entry in the velocity–velocity convection–diffusion block corresponding to the $x$-component at node $1$, that is, the sum over $K_1$ and $K_2$ of the element contributions to\n$\\displaystyle a^{xx}_{11}(\\boldsymbol{U}) \\equiv \\nu \\sum_{K} \\int_K \\nabla N_1 \\cdot \\nabla N_1 \\,\\mathrm{d}x + \\sum_{K} \\int_K (\\boldsymbol{U}\\cdot \\nabla N_1)\\,N_1 \\,\\mathrm{d}x.$\nExpress your final answer as a single closed-form analytic expression in terms of $\\nu$ only. No boundary conditions are enforced for this assembly. Provide no numerical rounding; give an exact expression.", "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It represents a standard exercise in the finite element analysis of the incompressible Navier-Stokes equations using a stabilized formulation for equal-order interpolation spaces. All provided information is consistent and sufficient to proceed with the solution.\n\nThe semi-discrete system is of the form $\\mathbb{M}\\,\\dot{\\mathbf{z}}(t) + \\mathbb{A}(\\boldsymbol{U})\\,\\mathbf{z}(t) = \\mathbf{F}(t)$, where the vector of unknowns $\\mathbf{z}(t)$ is partitioned into velocity and pressure components. Given the specified ordering, we have $\\mathbf{z} = [\\mathbf{u}^x, \\mathbf{u}^y, \\mathbf{p}]^\\top$, where $\\mathbf{u}^x, \\mathbf{u}^y, \\mathbf{p}$ are vectors of nodal values of size $4 \\times 1$. The system matrices $\\mathbb{M}$ and $\\mathbb{A}$ will be $12 \\times 12$ block matrices.\n\nThe velocity and pressure fields are expanded in the finite element basis:\n$$ \\boldsymbol{u}_h(t) = \\sum_{j=1}^4 u_j^x(t) (N_j \\boldsymbol{e}_x) + \\sum_{j=1}^4 u_j^y(t) (N_j \\boldsymbol{e}_y) $$\n$$ p_h(t) = \\sum_{j=1}^4 p_j(t) N_j $$\nThe test functions are chosen from the same basis: $\\boldsymbol{w}_h$ is one of $\\{N_i \\boldsymbol{e}_x\\}_{i=1}^4$ or $\\{N_i \\boldsymbol{e}_y\\}_{i=1}^4$, and $q_h$ is one of $\\{N_i\\}_{i=1}^4$.\n\n**Part 1: Block Structure of the System Matrices**\n\nWe derive the block structure of $\\mathbb{M}$ and $\\mathbb{A}$ by substituting the expansions into the weak form and testing with each basis function.\n\nThe mass matrix $\\mathbb{M}$ arises from the time derivative term $(\\boldsymbol{w}_h, \\dot{\\boldsymbol{u}}_h)$. Since the pressure equation has no time derivative, the last block row and column of $\\mathbb{M}$ are zero. The velocity-velocity blocks are identical.\nFor a test function $\\boldsymbol{w}_h = N_i \\boldsymbol{e}_x$, the term becomes $\\sum_j (\\int_\\Omega N_i N_j d\\Omega) \\dot{u}_j^x$.\nThe resulting block structure for $\\mathbb{M}$ is:\n$$ \\mathbb{M} = \\begin{pmatrix} \\mathbf{M}_s & \\mathbf{0} & \\mathbf{0} \\\\ \\mathbf{0} & \\mathbf{M}_s & \\mathbf{0} \\\\ \\mathbf{0} & \\mathbf{0} & \\mathbf{0} \\end{pmatrix} $$\nwhere $\\mathbf{M}_s$ is the $4 \\times 4$ scalar mass matrix, whose entries are $(\\mathbf{M}_s)_{ij} = \\int_\\Omega N_i N_j d\\Omega$.\n\nThe system matrix $\\mathbb{A}(\\boldsymbol{U})$ comprises contributions from diffusion, convection, gradient, divergence, and stabilization terms. We identify each block by its mathematical role.\n$$ \\mathbb{A}(\\boldsymbol{U}) = \\begin{pmatrix} \\mathbf{A}_{uu}(\\boldsymbol{U}) & \\mathbf{0} & \\mathbf{G}_x \\\\ \\mathbf{0} & \\mathbf{A}_{uu}(\\boldsymbol{U}) & \\mathbf{G}_y \\\\ \\mathbf{D}_x & \\mathbf{D}_y & \\mathbf{L}_p \\end{pmatrix} $$\nEach block is a $4 \\times 4$ matrix defined as follows:\n\n1.  **Velocity-Velocity Block $\\mathbf{A}_{uu}(\\boldsymbol{U})$**: This block combines diffusion and linearized convection effects on the velocity field. It is identical for both $x$- and $y$-momentum equations because of the scalar nature of the operators.\n    $$ \\mathbf{A}_{uu}(\\boldsymbol{U}) = \\nu \\mathbf{K}_s + \\mathbf{C}(\\boldsymbol{U}) $$\n    -   $\\mathbf{K}_s$ is the **scalar diffusion matrix** (or stiffness matrix), from the term $\\nu \\sum_K (\\nabla \\boldsymbol{u}_h, \\nabla \\boldsymbol{w}_h)_K$. Its entries are $(\\mathbf{K}_s)_{ij} = \\sum_K \\int_K \\nabla N_i \\cdot \\nabla N_j dx$.\n    -   $\\mathbf{C}(\\boldsymbol{U})$ is the **scalar convection matrix**, from the term $\\sum_K ((\\boldsymbol{U} \\cdot \\nabla)\\boldsymbol{u}_h, \\boldsymbol{w}_h)_K$. Its entries are $(\\mathbf{C}(\\boldsymbol{U}))_{ij} = \\sum_K \\int_K N_i (\\boldsymbol{U} \\cdot \\nabla N_j) dx$. The off-diagonal velocity blocks are zero because the test functions are aligned with the Cartesian axes.\n\n2.  **Velocity-Pressure Coupling Blocks ($\\mathbf{G}_x$, $\\mathbf{G}_y$)**: These blocks represent the discrete **gradient operator**. They couple the pressure field to the momentum equations.\n    -   From the term $-(p_h, \\nabla \\cdot \\boldsymbol{w}_h)$ with $\\boldsymbol{w}_h = N_i\\boldsymbol{e}_x$, we get the block $\\mathbf{G}_x$ coupling pressure to $x$-momentum. Its entries are $(\\mathbf{G}_x)_{ij} = -\\int_{\\Omega} N_j \\frac{\\partial N_i}{\\partial x} d\\Omega$.\n    -   Similarly, with $\\boldsymbol{w}_h = N_i\\boldsymbol{e}_y$, we get the block $\\mathbf{G}_y$ coupling pressure to $y$-momentum. Its entries are $(\\mathbf{G}_y)_{ij} = -\\int_{\\Omega} N_j \\frac{\\partial N_i}{\\partial y} d\\Omega$.\n\n3.  **Pressure-Velocity Coupling Blocks ($\\mathbf{D}_x$, $\\mathbf{D}_y$)**: These blocks represent the discrete **divergence operator**. They couple the velocity field to the continuity equation.\n    -   From the term $(q_h, \\nabla \\cdot \\boldsymbol{u}_h)$ with $q_h = N_i$, the coupling to the $x$-velocity component $\\boldsymbol{u}^x$ gives block $\\mathbf{D}_x$. Its entries are $(\\mathbf{D}_x)_{ij} = \\int_{\\Omega} N_i \\frac{\\partial N_j}{\\partial x} d\\Omega$.\n    -   The coupling to the $y$-velocity component $\\boldsymbol{u}^y$ gives block $\\mathbf{D}_y$. Its entries are $(\\mathbf{D}_y)_{ij} = \\int_{\\Omega} N_i \\frac{\\partial N_j}{\\partial y} d\\Omega$.\n    Note that without boundary terms from integration by parts, $\\mathbf{D}_x = -\\mathbf{G}_x^T$ and $\\mathbf{D}_y = -\\mathbf{G}_y^T$.\n\n4.  **Pressure-Pressure Block ($\\mathbf{L}_p$)**: This block arises from the pressure stabilization term $\\sum_K \\tau_{p,K} (\\nabla p_h, \\nabla q_h)_K$.\n    -   With $\\tau_{p,K} = \\alpha h_K^2$ and the given assumption $h_K=1$, the stabilization term becomes $\\alpha \\sum_K (\\nabla p_h, \\nabla q_h)_K$. This block is a **pressure Laplacian matrix** $\\mathbf{L}_p = \\alpha \\mathbf{K}_s$, where $\\mathbf{K}_s$ is the same scalar diffusion matrix defined previously.\n\n**Part 2: Explicit Computation of the Matrix Entry $a^{xx}_{11}(\\boldsymbol{U})$**\n\nWe are asked to compute the diagonal entry corresponding to the $x$-velocity at node $1$, which is located at $(0,0)$. This is the $(1,1)$ entry of the block $\\mathbf{A}_{uu}(\\boldsymbol{U})$.\n$$ a^{xx}_{11}(\\boldsymbol{U}) = \\nu \\left( \\sum_{K} \\int_K \\nabla N_1 \\cdot \\nabla N_1 \\,\\mathrm{d}x \\right) + \\left( \\sum_{K} \\int_K (\\boldsymbol{U}\\cdot \\nabla N_1)\\,N_1 \\,\\mathrm{d}x \\right) $$\nNode $1$ is a vertex of both triangles, $K_1 = \\operatorname{conv}\\{(0,0),(1,0),(1,1)\\}$ and $K_2 = \\operatorname{conv}\\{(0,0),(1,1),(0,1)\\}$. We must compute the contributions from both elements.\n\nFirst, we determine the shape function $N_1(x,y)$ and its gradient on each element.\n-   On element $K_1$ with nodes $(0,0), (1,0), (1,1)$, the shape function for node $1$ at $(0,0)$ is $N_1^{K_1}(x,y) = 1-x$. Its gradient is constant: $\\nabla N_1^{K_1} = (-1, 0)$.\n-   On element $K_2$ with nodes $(0,0), (1,1), (0,1)$, the shape function for node $1$ at $(0,0)$ is $N_1^{K_2}(x,y) = 1-y$. Its gradient is constant: $\\nabla N_1^{K_2} = (0, -1)$.\n\nNow, we compute the two parts of $a^{xx}_{11}(\\boldsymbol{U})$.\n\n**Diffusion Component:**\nThe contribution from $K_1$ is $\\int_{K_1} |\\nabla N_1^{K_1}|^2 \\,\\mathrm{d}x = \\int_{K_1} |(-1,0)|^2 \\,\\mathrm{d}x = \\int_{K_1} 1 \\,\\mathrm{d}x = \\text{Area}(K_1) = \\frac{1}{2}$.\nThe contribution from $K_2$ is $\\int_{K_2} |\\nabla N_1^{K_2}|^2 \\,\\mathrm{d}x = \\int_{K_2} |(0,-1)|^2 \\,\\mathrm{d}x = \\int_{K_2} 1 \\,\\mathrm{d}x = \\text{Area}(K_2) = \\frac{1}{2}$.\nThe total diffusion term is $\\nu (\\frac{1}{2} + \\frac{1}{2}) = \\nu$.\n\n**Convection Component:**\nThe convecting velocity is $\\boldsymbol{U}=(2,1)$.\n-   On $K_1$: $\\boldsymbol{U}\\cdot \\nabla N_1^{K_1} = (2,1) \\cdot (-1,0) = -2$. The integrand is $(-2) N_1^{K_1}(x,y) = -2(1-x)$. This is linear, so we can use a quadrature rule exact for linear functions: $\\int_K f dK = \\frac{\\text{Area}(K)}{3}\\sum_{i=1}^3 f(\\text{vertex}_i)$.\n    The vertices of $K_1$ are $(0,0), (1,0), (1,1)$. The values of the integrand $-2(1-x)$ at these vertices are $-2$, $0$, and $0$.\n    The integral is $\\frac{1/2}{3} (-2+0+0) = \\frac{1}{6}(-2) = -\\frac{1}{3}$.\n-   On $K_2$: $\\boldsymbol{U}\\cdot \\nabla N_1^{K_2} = (2,1) \\cdot (0,-1) = -1$. The integrand is $(-1) N_1^{K_2}(x,y) = -(1-y)$.\n    The vertices of $K_2$ are $(0,0), (1,1), (0,1)$. The values of the integrand $-(1-y)$ at these vertices are $-1$, $0$, and $0$.\n    The integral is $\\frac{1/2}{3} (-1+0+0) = \\frac{1}{6}(-1) = -\\frac{1}{6}$.\nThe total convection term is $(-\\frac{1}{3}) + (-\\frac{1}{6}) = -\\frac{2}{6} - \\frac{1}{6} = -\\frac{3}{6} = -\\frac{1}{2}$.\n\n**Total Value:**\nCombining the diffusion and convection components, we obtain the final value for the matrix entry:\n$$ a^{xx}_{11}(\\boldsymbol{U}) = \\nu - \\frac{1}{2} $$\nThis expression is in the required form, depending only on the parameter $\\nu$.", "answer": "$$\n\\boxed{\\nu - \\frac{1}{2}}\n$$", "id": "2582638"}, {"introduction": "While the previous exercises ([@problem_id:2582614], [@problem_id:2582638]) focused on assembling matrices from their theoretical definitions, practical computation often involves strategic simplifications. This exercise introduces mass lumping, a crucial technique for creating diagonal mass matrices that significantly simplify time integration. You will derive both the theoretically 'consistent' and the simplified 'lumped' mass matrices, and then quantify the error introduced by this approximation, providing insight into the critical balance between fidelity and computational efficiency in numerical simulations.", "problem": "Consider the semi-discrete Galerkin formulation of the velocity field using the Finite Element Method (FEM) with linear Lagrange basis functions on a simplicial mesh in spatial dimension $d \\in \\mathbb{N}$. On a single $d$-simplex element $K$ with measure $\\lvert K \\rvert$ (length for $d=1$, area for $d=2$, volume for $d=3$, and so on), let $\\{ \\varphi_{a} \\}_{a=1}^{d+1}$ denote the nodal basis functions associated with the $d+1$ vertices of $K$. The local consistent velocity mass matrix $\\mathbf{M}^{K}$ has entries $M^{K}_{ab} = \\int_{K} \\varphi_{a} \\varphi_{b} \\, \\mathrm{d}x$. The corresponding row-sum lumped mass matrix $\\mathbf{M}^{K}_{\\mathrm{L}}$ is defined by setting $(M^{K}_{\\mathrm{L}})_{ab} = 0$ for $a \\neq b$ and $(M^{K}_{\\mathrm{L}})_{aa} = \\sum_{b=1}^{d+1} M^{K}_{ab}$.\n\nUsing only fundamental properties of barycentric coordinates on a simplex and basic integral identities (e.g., affine invariance and symmetry), first determine the entries of the consistent mass matrix $\\mathbf{M}^{K}$ and the lumped mass matrix $\\mathbf{M}^{K}_{\\mathrm{L}}$ explicitly in terms of $\\lvert K \\rvert$ and $d$. Then, letting $\\Delta \\mathbf{M}^{K} := \\mathbf{M}^{K}_{\\mathrm{L}} - \\mathbf{M}^{K}$, quantify the difference between the lumped and consistent mass matrices by computing the Frobenius norm\n$$\n\\| \\Delta \\mathbf{M}^{K} \\|_{F} = \\sqrt{ \\sum_{a=1}^{d+1} \\sum_{b=1}^{d+1} \\left( \\Delta M^{K}_{ab} \\right)^{2} }.\n$$\nYour final answer must be a single closed-form analytic expression for $\\| \\Delta \\mathbf{M}^{K} \\|_{F}$ in terms of $\\lvert K \\rvert$ and $d$. Do not round or approximate your result. Express no units in the final answer.", "solution": "The semi-discrete Galerkin velocity mass matrix on an element $K$ is defined by\n$$\nM^{K}_{ab} = \\int_{K} \\varphi_{a} \\varphi_{b} \\, \\mathrm{d}x,\n$$\nwhere $\\{ \\varphi_{a} \\}_{a=1}^{d+1}$ are the linear Lagrange basis functions. On a simplex, these basis functions are precisely the barycentric coordinates $\\{ \\lambda_{a} \\}_{a=1}^{d+1}$. Therefore, we seek integrals of products of barycentric coordinates.\n\nWe use the following well-tested integral facts for barycentric coordinates on a $d$-simplex $K$ of measure $\\lvert K \\rvert$:\n- By symmetry, $\\int_{K} \\lambda_{a} \\, \\mathrm{d}x$ is the same for all $a$, and since $\\sum_{a=1}^{d+1} \\lambda_{a} \\equiv 1$, we have\n$$\n\\sum_{a=1}^{d+1} \\int_{K} \\lambda_{a} \\, \\mathrm{d}x = \\int_{K} 1 \\, \\mathrm{d}x = \\lvert K \\rvert \\quad \\Longrightarrow \\quad \\int_{K} \\lambda_{a} \\, \\mathrm{d}x = \\frac{\\lvert K \\rvert}{d+1}.\n$$\n- For second-order products, by symmetry there exist constants $a$ and $b$ such that\n$$\n\\int_{K} \\lambda_{i}^{2} \\, \\mathrm{d}x = a, \\qquad \\int_{K} \\lambda_{i} \\lambda_{j} \\, \\mathrm{d}x = b \\quad \\text{for } i \\neq j.\n$$\nWe determine $a$ and $b$ using the Dirichlet (uniform) distribution identities on a simplex, or equivalently by standard simplex-monomial integration formulas, which yield\n$$\n\\int_{K} \\lambda_{i}^{2} \\, \\mathrm{d}x = \\frac{2 \\lvert K \\rvert}{(d+1)(d+2)}, \\qquad\n\\int_{K} \\lambda_{i} \\lambda_{j} \\, \\mathrm{d}x = \\frac{\\lvert K \\rvert}{(d+1)(d+2)} \\quad (i \\neq j).\n$$\nThese follow from the general monomial integral\n$$\n\\int_{K} \\prod_{m=1}^{d+1} \\lambda_{m}^{\\alpha_{m}} \\, \\mathrm{d}x\n= \\lvert K \\rvert \\, \\frac{\\prod_{m=1}^{d+1} \\alpha_{m}!}{\\left(d + \\sum_{m=1}^{d+1} \\alpha_{m}\\right)!} \\, d!,\n$$\nspecialized to the cases $\\alpha_{i}=2$, others $0$, and $\\alpha_{i}=\\alpha_{j}=1$, others $0$, with the common factor $d!$ canceling appropriately when normalized to $\\lvert K \\rvert$.\n\nTherefore, the consistent element mass matrix entries are\n$$\nM^{K}_{ii} = \\int_{K} \\lambda_{i}^{2} \\, \\mathrm{d}x = \\frac{2 \\lvert K \\rvert}{(d+1)(d+2)}, \\qquad\nM^{K}_{ij} = \\int_{K} \\lambda_{i} \\lambda_{j} \\, \\mathrm{d}x = \\frac{\\lvert K \\rvert}{(d+1)(d+2)} \\quad (i \\neq j).\n$$\nEquivalently, in matrix form with $n = d+1$,\n$$\n\\mathbf{M}^{K} = \\frac{\\lvert K \\rvert}{(d+1)(d+2)} \\left( \\mathbf{1}\\mathbf{1}^{\\top} + \\mathbf{I} \\right),\n$$\nwhere $\\mathbf{1} \\in \\mathbb{R}^{n}$ is the vector of ones and $\\mathbf{I}$ is the $n \\times n$ identity.\n\nNext, the row-sum lumped mass matrix is defined by $(M^{K}_{\\mathrm{L}})_{ij} = 0$ for $i \\neq j$ and\n$$\n(M^{K}_{\\mathrm{L}})_{ii} = \\sum_{j=1}^{d+1} M^{K}_{ij}.\n$$\nSince each row sum of $\\mathbf{M}^{K}$ equals\n$$\n\\sum_{j=1}^{d+1} M^{K}_{ij} = M^{K}_{ii} + \\sum_{j \\neq i} M^{K}_{ij}\n= \\frac{2 \\lvert K \\rvert}{(d+1)(d+2)} + d \\cdot \\frac{\\lvert K \\rvert}{(d+1)(d+2)}\n= \\frac{\\lvert K \\rvert}{d+1},\n$$\nwe obtain\n$$\n\\mathbf{M}^{K}_{\\mathrm{L}} = \\frac{\\lvert K \\rvert}{d+1} \\, \\mathbf{I}.\n$$\n\nDefine the difference\n$$\n\\Delta \\mathbf{M}^{K} := \\mathbf{M}^{K}_{\\mathrm{L}} - \\mathbf{M}^{K}.\n$$\nIts entries are\n$$\n\\Delta M^{K}_{ii} = \\frac{\\lvert K \\rvert}{d+1} - \\frac{2 \\lvert K \\rvert}{(d+1)(d+2)} = \\frac{\\lvert K \\rvert}{d+1} \\left( 1 - \\frac{2}{d+2} \\right) = \\frac{\\lvert K \\rvert \\, d}{(d+1)(d+2)},\n$$\nand for $i \\neq j$,\n$$\n\\Delta M^{K}_{ij} = 0 - \\frac{\\lvert K \\rvert}{(d+1)(d+2)} = - \\frac{\\lvert K \\rvert}{(d+1)(d+2)}.\n$$\n\nWe now compute the Frobenius norm\n$$\n\\| \\Delta \\mathbf{M}^{K} \\|_{F}^{2}\n= \\sum_{i=1}^{d+1} \\sum_{j=1}^{d+1} \\left( \\Delta M^{K}_{ij} \\right)^{2}\n= (d+1) \\left( \\frac{\\lvert K \\rvert \\, d}{(d+1)(d+2)} \\right)^{2}\n+ (d+1)d \\left( \\frac{\\lvert K \\rvert}{(d+1)(d+2)} \\right)^{2}.\n$$\nFactor out the common term:\n$$\n\\| \\Delta \\mathbf{M}^{K} \\|_{F}^{2}\n= \\left( \\frac{\\lvert K \\rvert}{(d+1)(d+2)} \\right)^{2}\n\\left[ (d+1) d^{2} + (d+1) d \\right]\n= \\left( \\frac{\\lvert K \\rvert}{(d+1)(d+2)} \\right)^{2} (d+1) d (d+1).\n$$\nHence,\n$$\n\\| \\Delta \\mathbf{M}^{K} \\|_{F}^{2}\n= \\frac{\\lvert K \\rvert^{2} \\, d \\, (d+1)^{2}}{(d+1)^{2} (d+2)^{2}}\n= \\frac{\\lvert K \\rvert^{2} \\, d}{(d+2)^{2}}.\n$$\nTaking the square root gives the closed-form expression\n$$\n\\| \\Delta \\mathbf{M}^{K} \\|_{F} = \\frac{\\lvert K \\rvert \\, \\sqrt{d}}{d+2}.\n$$\n\nThis quantifies, in terms of the element geometry through $\\lvert K \\rvert$ and the spatial dimension $d$, the Frobenius-norm deviation incurred by row-sum mass lumping relative to the consistent local mass matrix for linear Lagrange finite elements on a $d$-simplex.", "answer": "$$\\boxed{\\frac{|K|\\,\\sqrt{d}}{d+2}}$$", "id": "2582645"}]}