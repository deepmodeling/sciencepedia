{"hands_on_practices": [{"introduction": "Understanding stochastic flows begins with tractable, fundamental examples. This exercise guides you through the analysis of a linear stochastic differential equation, a multidimensional Ornstein-Uhlenbeck process, which is one of the cornerstones of the field. By explicitly deriving the flow map and its Jacobian matrix, you will gain a concrete understanding of how the flow's derivative captures the local deformation of space and how its determinant relates to volume preservation [@problem_id:2997492].", "problem": "Consider the planar Stratonovich stochastic differential equation in $\\mathbb{R}^{2}$,\n$$\n\\mathrm{d}X_{t} \\;=\\; b(X_{t})\\,\\mathrm{d}t \\;+\\; \\sigma_{1}(X_{t}) \\circ \\mathrm{d}W_{t}^{1} \\;+\\; \\sigma_{2}(X_{t}) \\circ \\mathrm{d}W_{t}^{2},\n$$\nwhere $b(x)=-\\lambda x$ with $\\lambda \\in \\mathbb{R}$, $\\sigma_{1}(x)=\\sqrt{2\\nu}\\,e_{1}$, $\\sigma_{2}(x)=\\sqrt{2\\nu}\\,e_{2}$ with $\\nu>0$, and $e_{1},e_{2}$ are the standard basis vectors in $\\mathbb{R}^{2}$. Here $\\{W_{t}^{1}\\}_{t\\ge 0}$ and $\\{W_{t}^{2}\\}_{t\\ge 0}$ are independent standard Brownian motions, and the stochastic integrals are in the Stratonovich sense. Let $\\phi_{0,t}(x)$ denote the stochastic flow of diffeomorphisms generated by this equation at time $t$ starting from $x$ at time $0$.\n\nStarting from the definitions and basic properties of linear stochastic differential equations and stochastic flows of diffeomorphisms, carry out the following:\n\n- Derive an explicit expression for the flow map $\\phi_{0,t}(x)$.\n- Compute the Jacobian matrix $\\mathrm{D}_{x}\\phi_{0,t}(x)$ and its determinant, and justify that it is almost surely independent of $x$.\n- Use your expression to verify that when $\\lambda=0$, the flow preserves Lebesgue measure (equivalently, preserves volume) almost surely.\n\nProvide the final answer as a single closed-form analytic expression for $\\det\\big(\\mathrm{D}_{x}\\phi_{0,t}(x)\\big)$ as a function of $\\lambda$ and $t$. No rounding is required. Output only this expression in your final answer.", "solution": "The problem asks for an analysis of the stochastic flow generated by a planar Stratonovich stochastic differential equation (SDE). We will first derive the explicit form of the flow, then compute its Jacobian and determinant, and finally verify a special property for a specific parameter value.\n\nThe given SDE is:\n$$\n\\mathrm{d}X_{t} \\;=\\; b(X_{t})\\,\\mathrm{d}t \\;+\\; \\sigma_{1}(X_{t}) \\circ \\mathrm{d}W_{t}^{1} \\;+\\; \\sigma_{2}(X_{t}) \\circ \\mathrm{d}W_{t}^{2}\n$$\nwhere $X_t \\in \\mathbb{R}^2$, $\\{W_t^1\\}_{t \\ge 0}$ and $\\{W_t^2\\}_{t \\ge 0}$ are independent standard Brownian motions. The coefficients are given by $b(x)=-\\lambda x$ with $\\lambda \\in \\mathbb{R}$, $\\sigma_{1}(x)=\\sqrt{2\\nu}\\,e_{1}$, and $\\sigma_{2}(x)=\\sqrt{2\\nu}\\,e_{2}$ with $\\nu > 0$, where $e_1 = (1, 0)^T$ and $e_2 = (0, 1)^T$ are the standard basis vectors.\n\nWe can write the SDE in vector form:\n$$\n\\mathrm{d}X_{t} = -\\lambda X_{t} \\mathrm{d}t + \\sqrt{2\\nu} e_{1} \\circ \\mathrm{d}W_{t}^{1} + \\sqrt{2\\nu} e_{2} \\circ \\mathrm{d}W_{t}^{2}\n$$\nThis is a linear SDE. The stochastic integral is in the Stratonovich sense. To solve it, we can convert it to an Itô SDE. The conversion formula for an SDE $\\mathrm{d}X_t^i = b^i(X_t) \\mathrm{d}t + \\sum_{j=1}^m \\sigma_j^i(X_t) \\circ \\mathrm{d}W_t^j$ is:\n$$\n\\mathrm{d}X_t^i = \\left( b^i(X_t) + \\frac{1}{2} \\sum_{j=1}^m \\sum_{k=1}^d \\frac{\\partial \\sigma_j^i}{\\partial x_k}(X_t) \\sigma_j^k(X_t) \\right) \\mathrm{d}t + \\sum_{j=1}^m \\sigma_j^i(X_t) \\mathrm{d}W_t^j\n$$\nIn our case, the diffusion vector fields are $\\sigma_1(x) = (\\sqrt{2\\nu}, 0)^T$ and $\\sigma_2(x) = (0, \\sqrt{2\\nu})^T$. These are constant vectors, so their partial derivatives are zero:\n$$\n\\frac{\\partial \\sigma_j^i}{\\partial x_k}(x) = 0 \\quad \\forall i,j,k \\in \\{1, 2\\}\n$$\nThis means the Itô correction term is zero, and the Stratonovich SDE is identical to its Itô counterpart:\n$$\n\\mathrm{d}X_{t} = -\\lambda X_{t} \\mathrm{d}t + \\sqrt{2\\nu} e_{1} \\mathrm{d}W_{t}^{1} + \\sqrt{2\\nu} e_{2} \\mathrm{d}W_{t}^{2}\n$$\nLet $W_t = (W_t^1, W_t^2)^T$ be the vector Brownian motion and $I$ be the $2 \\times 2$ identity matrix. The SDE simplifies to:\n$$\n\\mathrm{d}X_{t} = -\\lambda X_{t} \\mathrm{d}t + \\sqrt{2\\nu} I \\mathrm{d}W_{t}\n$$\nThis is a standard vector Ornstein-Uhlenbeck process. We solve it using an integrating factor $e^{\\lambda t}$. Let $Y_t = e^{\\lambda t} X_t$. Using the Itô product rule:\n$$\n\\mathrm{d}Y_t = \\mathrm{d}(e^{\\lambda t} X_t) = (\\lambda e^{\\lambda t} X_t) \\mathrm{d}t + e^{\\lambda t} \\mathrm{d}X_t\n$$\nSubstituting the expression for $\\mathrm{d}X_t$:\n$$\n\\mathrm{d}Y_t = \\lambda e^{\\lambda t} X_t \\mathrm{d}t + e^{\\lambda t} (-\\lambda X_t \\mathrm{d}t + \\sqrt{2\\nu} \\mathrm{d}W_t) = e^{\\lambda t} \\sqrt{2\\nu} \\mathrm{d}W_t\n$$\nIntegrating from $s=0$ to $s=t$, we get:\n$$\nY_t - Y_0 = \\int_0^t e^{\\lambda s} \\sqrt{2\\nu} \\mathrm{d}W_s\n$$\nSubstituting back $Y_t = e^{\\lambda t} X_t$ and $Y_0 = X_0$:\n$$\ne^{\\lambda t} X_t - X_0 = \\sqrt{2\\nu} \\int_0^t e^{\\lambda s} \\mathrm{d}W_s\n$$\nSolving for $X_t$:\n$$\nX_t = e^{-\\lambda t} X_0 + \\sqrt{2\\nu} e^{-\\lambda t} \\int_0^t e^{\\lambda s} \\mathrm{d}W_s\n$$\nThe stochastic flow $\\phi_{0,t}(x)$ is defined as the solution at time $t$ starting from $X_0 = x$. Thus, we have derived the explicit expression for the flow map:\n$$\n\\phi_{0,t}(x) = e^{-\\lambda t} x + \\sqrt{2\\nu} e^{-\\lambda t} \\int_0^t e^{\\lambda s} \\mathrm{d}W_s\n$$\nThis completes the first part of the task.\n\nNext, we compute the Jacobian matrix $\\mathrm{D}_{x}\\phi_{0,t}(x)$. The flow map is an affine function of $x$. Let's write the components of $\\phi_{0,t}(x) = (\\phi_{0,t}^{(1)}, \\phi_{0,t}^{(2)})^T$ and $x=(x_1, x_2)^T$:\n$$\n\\phi_{0,t}^{(1)}(x_1, x_2) = e^{-\\lambda t} x_1 + \\sqrt{2\\nu} e^{-\\lambda t} \\int_0^t e^{\\lambda s} \\mathrm{d}W_s^1\n$$\n$$\n\\phi_{0,t}^{(2)}(x_1, x_2) = e^{-\\lambda t} x_2 + \\sqrt{2\\nu} e^{-\\lambda t} \\int_0^t e^{\\lambda s} \\mathrm{d}W_s^2\n$$\nThe Jacobian matrix is given by the matrix of partial derivatives $\\mathrm{D}_{x}\\phi_{0,t}(x) = \\left[\\frac{\\partial \\phi_{0,t}^{(i)}}{\\partial x_j}\\right]$. The stochastic integral terms are independent of $x$, so they vanish upon differentiation with respect to any component of $x$.\n$$\n\\frac{\\partial \\phi_{0,t}^{(1)}}{\\partial x_1} = e^{-\\lambda t}, \\quad \\frac{\\partial \\phi_{0,t}^{(1)}}{\\partial x_2} = 0\n$$\n$$\n\\frac{\\partial \\phi_{0,t}^{(2)}}{\\partial x_1} = 0, \\quad \\frac{\\partial \\phi_{0,t}^{(2)}}{\\partial x_2} = e^{-\\lambda t}\n$$\nSo, the Jacobian matrix is:\n$$\n\\mathrm{D}_{x}\\phi_{0,t}(x) = \\begin{pmatrix} e^{-\\lambda t} & 0 \\\\ 0 & e^{-\\lambda t} \\end{pmatrix} = e^{-\\lambda t} I\n$$\nwhere $I$ is the $2 \\times 2$ identity matrix.\n\nThe determinant of the Jacobian matrix is:\n$$\n\\det(\\mathrm{D}_{x}\\phi_{0,t}(x)) = \\det(e^{-\\lambda t} I) = (e^{-\\lambda t})^{2} = e^{-2\\lambda t}\n$$\nThis expression is a deterministic function of $\\lambda$ and $t$. It does not depend on the starting point $x$ or on the realization of the Brownian motion. Therefore, the determinant is almost surely independent of $x$.\n\nFinally, we verify that for $\\lambda=0$, the flow preserves Lebesgue measure. A flow is volume-preserving if the determinant of its Jacobian is identically $1$. Setting $\\lambda=0$ in our derived expression for the determinant:\n$$\n\\det(\\mathrm{D}_{x}\\phi_{0,t}(x)) \\Big|_{\\lambda=0} = e^{-2(0)t} = e^0 = 1\n$$\nSince the determinant of the Jacobian is $1$ for all $t \\ge 0$ when $\\lambda=0$, the flow $\\phi_{0,t}(x)$ preserves volume, or equivalently, preserves the Lebesgue measure. This is consistent with Liouville's theorem for stochastic flows, as for $\\lambda=0$, the generating vector fields $b(x)=0$, $\\sigma_1(x)$, and $\\sigma_2(x)$ are all divergence-free. The divergence of the drift is $\\nabla \\cdot b = \\frac{\\partial}{\\partial x_1}(-\\lambda x_1) + \\frac{\\partial}{\\partial x_2}(-\\lambda x_2) = -2\\lambda$. The general formula $\\det(\\mathrm{D}_x \\phi_{0,t}(x)) = \\exp(\\int_0^t (\\nabla \\cdot b)(\\phi_{0,s}(x)) \\mathrm{d}s)$ (for divergence-free diffusion fields) gives $\\exp(\\int_0^t -2\\lambda \\mathrm{d}s) = \\exp(-2\\lambda t)$, confirming our result.\n\nThe final answer required is the closed-form analytic expression for $\\det(\\mathrm{D}_{x}\\phi_{0,t}(x))$.", "answer": "$$\\boxed{\\exp(-2\\lambda t)}$$", "id": "2997492"}, {"introduction": "The choice between Itô and Stratonovich calculus is not merely a matter of convention; it has profound geometric implications, especially when dealing with flows on manifolds. This practice confronts this issue directly by asking you to transform a given stochastic system under a nonlinear change of coordinates using both formalisms. Performing this calculation will reveal why the Stratonovich chain rule is 'covariant'—behaving like ordinary calculus—and allows you to explicitly identify the correction term that relates the two pictures [@problem_id:2997449].", "problem": "Consider the two-dimensional Itô stochastic differential equation (SDE) driven by a one-dimensional Brownian motion (BM)\n$$\n\\mathrm{d}X_{t}^{1} \\,=\\, X_{t}^{2}\\,\\mathrm{d}t + \\sin\\!\\big(X_{t}^{1}\\big)\\,\\mathrm{d}W_{t}, \n\\qquad\n\\mathrm{d}X_{t}^{2} \\,=\\, -\\,X_{t}^{1}\\,\\mathrm{d}t + \\cos\\!\\big(X_{t}^{1}\\big)\\,\\mathrm{d}W_{t},\n$$\nwith initial condition $X_{0}=x\\in\\mathbb{R}^{2}$, where $W$ is a standard one-dimensional Brownian motion. All coefficients are $C^{\\infty}$ and globally Lipschitz. Let $\\phi:\\mathbb{R}^{2}\\to\\mathbb{R}^{2}$ be the nonlinear diffeomorphism\n$$\n\\phi(x_{1},x_{2}) \\,=\\, \\big(x_{1},\\, x_{2} + x_{1}^{2}\\big),\n$$\nand define the change of variables $Z_{t}=\\phi(X_{t})$, with components $Z_{t}^{1}=X_{t}^{1}$ and $Z_{t}^{2}=X_{t}^{2}+(X_{t}^{1})^{2}$. Write $b(x)=\\big(x_{2},-x_{1}\\big)$ and $\\sigma(x)=\\big(\\sin(x_{1}),\\cos(x_{1})\\big)$ for the original drift and diffusion.\n\nTasks:\n- Using only fundamental Itô calculus, compute explicitly the transformed Itô drift and diffusion coefficients for the SDE satisfied by $Z_{t}$.\n- Convert the original Itô SDE to its Stratonovich form and, using only the Stratonovich chain rule and the pushforward by $\\phi$, compute explicitly the transformed Stratonovich drift and diffusion coefficients for the SDE satisfied by $Z_{t}$.\n- Explain from first principles why the Stratonovich formulation is coordinate-covariant under $\\phi$ and how this compares to the Itô formulation, relating the two transformed drifts in the $Z$-coordinates via the standard Itô–Stratonovich correction expressed in the $Z$-variables.\n\nLet $g(z)$ denote the transformed diffusion vector field in the $Z$-coordinates that multiplies the Brownian increment. Define the difference between the Itô and Stratonovich transformed drifts by\n$$\n\\Delta(z)\\,=\\, b_{\\mathrm{It\\hat{o}}}^{Z}(z)\\,-\\, b_{\\mathrm{Strat}}^{Z}(z).\n$$\nCompute $\\Delta(z)$ explicitly as a closed-form expression in terms of $z=(z_{1},z_{2})\\in\\mathbb{R}^{2}$. Your final answer must be the analytic expression for $\\Delta(z)$ written as a single row vector. No rounding is required.", "solution": "The problem statement is a standard, well-posed exercise in stochastic calculus and is therefore deemed valid. It presents a two-dimensional Itô stochastic differential equation (SDE) and asks for its transformation under a nonlinear diffeomorphism using both Itô and Stratonovich calculus, and to compare the results.\n\nThe original SDE in the $X$-coordinates is given by\n$$ \\mathrm{d}X_t = b(X_t)\\,\\mathrm{d}t + \\sigma(X_t)\\,\\mathrm{d}W_t $$\nwith drift $b(x_1, x_2) = (x_2, -x_1)$ and diffusion $\\sigma(x_1, x_2) = (\\sin(x_1), \\cos(x_1))$. The change of variables is $Z_t = \\phi(X_t)$, where $\\phi(x_1, x_2) = (x_1, x_2 + x_1^2)$. The components are $Z_t^1 = X_t^1$ and $Z_t^2 = X_t^2 + (X_t^1)^2$. The inverse transformation is $X_t^1=Z_t^1$ and $X_t^2 = Z_t^2 - (Z_t^1)^2$.\n\n**1. Transformed SDE via Itô Calculus**\n\nWe apply Itô's formula to find the SDE for $Z_t = \\phi(X_t)$.\n\nFor the first component, $Z_t^1 = X_t^1$, the SDE is unchanged initially:\n$$ \\mathrm{d}Z_t^1 = \\mathrm{d}X_t^1 = X_t^2\\,\\mathrm{d}t + \\sin(X_t^1)\\,\\mathrm{d}W_t $$\nExpressing the coefficients in terms of $Z_t$:\n$$ \\mathrm{d}Z_t^1 = (Z_t^2 - (Z_t^1)^2)\\,\\mathrm{d}t + \\sin(Z_t^1)\\,\\mathrm{d}W_t $$\n\nFor the second component, $Z_t^2 = f(X_t^1, X_t^2)$ where $f(x_1, x_2) = x_2 + x_1^2$. We use the two-dimensional Itô's formula for a single Brownian motion:\n$$ \\mathrm{d}f(X_t) = \\sum_{i=1}^{2} \\frac{\\partial f}{\\partial x_i} \\mathrm{d}X_t^i + \\frac{1}{2} \\sum_{i,j=1}^{2} \\frac{\\partial^2 f}{\\partial x_i \\partial x_j} \\sigma^i(X_t) \\sigma^j(X_t) \\,\\mathrm{d}t $$\nThe partial derivatives of $f$ are:\n$$ \\frac{\\partial f}{\\partial x_1} = 2x_1, \\quad \\frac{\\partial f}{\\partial x_2} = 1, \\quad \\frac{\\partial^2 f}{\\partial x_1^2} = 2, \\quad \\frac{\\partial^2 f}{\\partial x_1 \\partial x_2} = 0, \\quad \\frac{\\partial^2 f}{\\partial x_2^2} = 0 $$\nApplying the formula:\n$$ \\mathrm{d}Z_t^2 = \\frac{\\partial f}{\\partial x_1}\\mathrm{d}X_t^1 + \\frac{\\partial f}{\\partial x_2}\\mathrm{d}X_t^2 + \\frac{1}{2}\\frac{\\partial^2 f}{\\partial x_1^2}(\\sigma^1)^2\\,\\mathrm{d}t $$\n$$ \\mathrm{d}Z_t^2 = 2X_t^1 \\mathrm{d}X_t^1 + \\mathrm{d}X_t^2 + \\frac{1}{2}(2)(\\sin(X_t^1))^2\\,\\mathrm{d}t $$\nSubstitute the expressions for $\\mathrm{d}X_t^1$ and $\\mathrm{d}X_t^2$:\n$$ \\mathrm{d}Z_t^2 = 2X_t^1(X_t^2\\,\\mathrm{d}t + \\sin(X_t^1)\\,\\mathrm{d}W_t) + (-X_t^1\\,\\mathrm{d}t + \\cos(X_t^1)\\,\\mathrm{d}W_t) + \\sin^2(X_t^1)\\,\\mathrm{d}t $$\nGrouping the $\\mathrm{d}t$ and $\\mathrm{d}W_t$ terms:\n$$ \\mathrm{d}Z_t^2 = (2X_t^1 X_t^2 - X_t^1 + \\sin^2(X_t^1))\\,\\mathrm{d}t + (2X_t^1\\sin(X_t^1) + \\cos(X_t^1))\\,\\mathrm{d}W_t $$\nExpressing the coefficients in terms of $Z_t$:\n$$ \\mathrm{d}Z_t^2 = (2Z_t^1(Z_t^2 - (Z_t^1)^2) - Z_t^1 + \\sin^2(Z_t^1))\\,\\mathrm{d}t + (2Z_t^1\\sin(Z_t^1) + \\cos(Z_t^1))\\,\\mathrm{d}W_t $$\n$$ \\mathrm{d}Z_t^2 = (2Z_t^1 Z_t^2 - 2(Z_t^1)^3 - Z_t^1 + \\sin^2(Z_t^1))\\,\\mathrm{d}t + (2Z_t^1\\sin(Z_t^1) + \\cos(Z_t^1))\\,\\mathrm{d}W_t $$\nThe Itô drift and diffusion in $Z$-coordinates are:\n$$ b_{\\mathrm{It\\hat{o}}}^{Z}(z) = (z_2 - z_1^2, \\, 2z_1 z_2 - 2z_1^3 - z_1 + \\sin^2(z_1)) $$\n$$ g(z) = (\\sin(z_1), \\, 2z_1\\sin(z_1) + \\cos(z_1)) $$\n\n**2. Transformed SDE via Stratonovich Calculus**\n\nFirst, convert the original Itô SDE for $X_t$ to its Stratonovich form, $dX_t = b_{\\mathrm{Strat}}^{X}(X_t)\\,\\mathrm{d}t + \\sigma(X_t)\\circ\\mathrm{d}W_t$. The Itô and Stratonovich drifts are related by $b_{\\mathrm{It\\hat{o}}}^i = b_{\\mathrm{Strat}}^i + \\frac{1}{2} \\sum_j \\sigma^j \\frac{\\partial \\sigma^i}{\\partial x_j}$.\nThe correction term for the drift is $K_X^i(x) = \\frac{1}{2} \\sum_j \\sigma^j(x) \\frac{\\partial \\sigma^i(x)}{\\partial x_j}$.\nWith $\\sigma(x) = (\\sin(x_1), \\cos(x_1))$, its Jacobian is $\\nabla\\sigma = \\begin{pmatrix} \\cos(x_1) & 0 \\\\ -\\sin(x_1) & 0 \\end{pmatrix}$.\nThe correction vector is $K_X(x) = \\frac{1}{2}(\\nabla\\sigma)\\sigma = \\frac{1}{2}\\begin{pmatrix} \\cos(x_1) & 0 \\\\ -\\sin(x_1) & 0 \\end{pmatrix}\\begin{pmatrix} \\sin(x_1) \\\\ \\cos(x_1) \\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix} \\sin(x_1)\\cos(x_1) \\\\ -\\sin^2(x_1) \\end{pmatrix}$.\nThe Stratonovich drift in $X$-coordinates is $b_{\\mathrm{Strat}}^{X}(x) = b(x) - K_X(x)$:\n$$ b_{\\mathrm{Strat}}^{X}(x) = \\begin{pmatrix} x_2 \\\\ -x_1 \\end{pmatrix} - \\frac{1}{2}\\begin{pmatrix} \\sin(x_1)\\cos(x_1) \\\\ -\\sin^2(x_1) \\end{pmatrix} = \\begin{pmatrix} x_2 - \\frac{1}{2}\\sin(x_1)\\cos(x_1) \\\\ -x_1 + \\frac{1}{2}\\sin^2(x_1) \\end{pmatrix} $$\nThe Stratonovich chain rule is the same as the ordinary chain rule. The transformed vector fields are the pushforwards of the original ones by $\\phi$.\nThe Jacobian of the transformation $\\phi$ is $D\\phi(x) = \\begin{pmatrix} 1 & 0 \\\\ 2x_1 & 1 \\end{pmatrix}$.\nThe transformed Stratonovich drift is $b_{\\mathrm{Strat}}^{Z}(z) = (D\\phi)_{\\phi^{-1}(z)} b_{\\mathrm{Strat}}^{X}(\\phi^{-1}(z))$:\n$$ b_{\\mathrm{Strat}}^{Z}(\\phi(x)) = \\begin{pmatrix} 1 & 0 \\\\ 2x_1 & 1 \\end{pmatrix} \\begin{pmatrix} x_2 - \\frac{1}{2}\\sin(x_1)\\cos(x_1) \\\\ -x_1 + \\frac{1}{2}\\sin^2(x_1) \\end{pmatrix} = \\begin{pmatrix} x_2 - \\frac{1}{2}\\sin(x_1)\\cos(x_1) \\\\ 2x_1x_2 - x_1\\sin(x_1)\\cos(x_1) - x_1 + \\frac{1}{2}\\sin^2(x_1) \\end{pmatrix} $$\nIn $Z$-coordinates:\n$$ b_{\\mathrm{Strat}}^{Z}(z) = (z_2 - z_1^2 - \\frac{1}{2}\\sin(z_1)\\cos(z_1), \\, 2z_1(z_2 - z_1^2) - z_1\\sin(z_1)\\cos(z_1) - z_1 + \\frac{1}{2}\\sin^2(z_1)) $$\nThe transformed diffusion is $g(z) = (D\\phi)_{\\phi^{-1}(z)} \\sigma(\\phi^{-1}(z))$, which yields the same $g(z)$ as in the Itô case.\n\n**3. Comparison and Explanation**\n\nThe Stratonovich formulation is coordinate-covariant because the Stratonovich integral is defined as a limit of midpoint Riemann sums. This definition ensures it obeys the ordinary chain rule of calculus, $d\\phi(X_t) = D\\phi(X_t) \\circ dX_t$. Consequently, drift and diffusion vector fields transform as geometric vectors via pushforward by the Jacobian of the coordinate transformation. This is the essence of covariance.\n\nThe Itô formulation is not coordinate-covariant. The Itô integral is defined via left-endpoint Riemann sums, leading to the Itô-Taylor formula, which includes a second-order term stemming from the non-zero quadratic variation of Brownian motion ($\\mathrm{d}W_t^2 = \\mathrm{d}t$). The Itô formula for $Z_t = \\phi(X_t)$ is:\n$$ \\mathrm{d}Z_t^i = \\sum_j \\frac{\\partial \\phi^i}{\\partial x_j}\\mathrm{d}X_t^j + \\frac{1}{2}\\sum_{j,k} \\frac{\\partial^2 \\phi^i}{\\partial x_j\\partial x_k}\\sigma^j\\sigma^k \\mathrm{d}t $$\nThe transformed drift contains an additional term involving second derivatives of $\\phi$, which means the drift does not transform as a geometric vector field.\n\nThe Itô and Stratonovich drifts in any coordinate system are related by a correction term. In the $Z$-coordinates, this relationship is $b_{\\mathrm{It\\hat{o}}}^{Z}(z) = b_{\\mathrm{Strat}}^{Z}(z) + K_Z(z)$, where $K_Z^i(z) = \\frac{1}{2}\\sum_k g^k(z) \\frac{\\partial g^i(z)}{\\partial z_k}$. The difference required is $\\Delta(z) = b_{\\mathrm{It\\hat{o}}}^{Z}(z) - b_{\\mathrm{Strat}}^{Z}(z) = K_Z(z)$.\nLet's compute this correction term $K_Z(z)$ directly.\nThe diffusion in $Z$-coordinates is $g(z) = (\\sin(z_1), \\, 2z_1\\sin(z_1) + \\cos(z_1))$.\nIts Jacobian is $\\nabla_z g(z) = \\begin{pmatrix} \\frac{\\partial g^1}{\\partial z_1} & \\frac{\\partial g^1}{\\partial z_2} \\\\ \\frac{\\partial g^2}{\\partial z_1} & \\frac{\\partial g^2}{\\partial z_2} \\end{pmatrix} = \\begin{pmatrix} \\cos(z_1) & 0 \\\\ \\sin(z_1) + 2z_1\\cos(z_1) & 0 \\end{pmatrix}$.\nThe correction term is $K_Z(z) = \\frac{1}{2}(\\nabla_z g)g$:\n$$ K_Z(z) = \\frac{1}{2} \\begin{pmatrix} \\cos(z_1) & 0 \\\\ \\sin(z_1) + 2z_1\\cos(z_1) & 0 \\end{pmatrix} \\begin{pmatrix} \\sin(z_1) \\\\ 2z_1\\sin(z_1) + \\cos(z_1) \\end{pmatrix} $$\n$$ K_Z(z) = \\frac{1}{2} \\begin{pmatrix} \\sin(z_1)\\cos(z_1) \\\\ (\\sin(z_1) + 2z_1\\cos(z_1))\\sin(z_1) \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2}\\sin(z_1)\\cos(z_1) \\\\ \\frac{1}{2}\\sin^2(z_1) + z_1\\sin(z_1)\\cos(z_1) \\end{pmatrix} $$\nThis vector is $\\Delta(z)$. Let's verify by subtracting the drifts we computed.\n$$ \\Delta^1(z) = b_{\\mathrm{It\\hat{o}}}^{Z,1}(z) - b_{\\mathrm{Strat}}^{Z,1}(z) = (z_2 - z_1^2) - (z_2 - z_1^2 - \\frac{1}{2}\\sin(z_1)\\cos(z_1)) = \\frac{1}{2}\\sin(z_1)\\cos(z_1) $$\n$$ \\Delta^2(z) = b_{\\mathrm{It\\hat{o}}}^{Z,2}(z) - b_{\\mathrm{Strat}}^{Z,2}(z) $$\n$$ = (2z_1 z_2 - 2z_1^3 - z_1 + \\sin^2(z_1)) - (2z_1(z_2 - z_1^2) - z_1\\sin(z_1)\\cos(z_1) - z_1 + \\frac{1}{2}\\sin^2(z_1)) $$\n$$ = (2z_1 z_2 - 2z_1^3 - z_1 + \\sin^2(z_1)) - (2z_1 z_2 - 2z_1^3 - z_1\\sin(z_1)\\cos(z_1) - z_1 + \\frac{1}{2}\\sin^2(z_1)) $$\n$$ = \\sin^2(z_1) - \\frac{1}{2}\\sin^2(z_1) + z_1\\sin(z_1)\\cos(z_1) = \\frac{1}{2}\\sin^2(z_1) + z_1\\sin(z_1)\\cos(z_1) $$\nThe results match perfectly. The difference between the transformed Itô and Stratonovich drifts is precisely the Itô-Stratonovich correction term calculated in the target $Z$-coordinates.\n\n**4. Final Computation for $\\Delta(z)$**\n\nThe required quantity is $\\Delta(z) = b_{\\mathrm{It\\hat{o}}}^{Z}(z) - b_{\\mathrm{Strat}}^{Z}(z)$. Based on the calculations above, the components are:\n$$ \\Delta^1(z) = \\frac{1}{2}\\sin(z_1)\\cos(z_1) $$\n$$ \\Delta^2(z) = z_1\\sin(z_1)\\cos(z_1) + \\frac{1}{2}\\sin^2(z_1) $$\nWriting this as a single row vector gives the final answer.\n$$ \\Delta(z) = \\left( \\frac{1}{2}\\sin(z_1)\\cos(z_1), \\quad z_1\\sin(z_1)\\cos(z_1) + \\frac{1}{2}\\sin^2(z_1) \\right) $$", "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{1}{2}\\sin(z_1)\\cos(z_1) & z_1\\sin(z_1)\\cos(z_1) + \\frac{1}{2}\\sin^2(z_1) \\end{pmatrix} } $$", "id": "2997449"}, {"introduction": "Moving from analytical theory to computational practice is a crucial step in mastering stochastic dynamics. This hands-on programming exercise challenges you to simulate a stochastic flow and its Jacobian, providing a powerful way to visualize and verify theoretical properties. By implementing a numerical scheme for a particle in a potential well, you will make concepts like the order-preserving nature of one-dimensional flows and the evolution of the Jacobian tangible and intuitive [@problem_id:3077283].", "problem": "Consider the one-dimensional Stochastic Differential Equation (SDE) driven by Brownian motion (BM)\n$$\ndX_t = -V'(X_t)\\,dt + \\sigma\\,dW_t, \\quad X_0 = x,\n$$\nwhere $V:\\mathbb{R}\\to\\mathbb{R}$ is a twice continuously differentiable potential, $V'$ denotes the first derivative of $V$, $\\sigma \\ge 0$ is the noise intensity, and $\\{W_t\\}_{t\\ge 0}$ is a standard Brownian motion (BM). Under standard regularity and growth conditions ensuring strong existence and uniqueness, the associated stochastic flow $\\{\\phi_t\\}_{t\\ge 0}$ is defined by the mapping $x \\mapsto \\phi_t(x)$, where $\\phi_t(x)$ is the solution at time $t$ starting from $x$. The Jacobian of the stochastic flow in one dimension is\n$$\nJ_t(x) := \\frac{\\partial}{\\partial x}\\phi_t(x),\n$$\nwhich evolves according to a variational equation derived from linearizing the SDE along the trajectory.\n\nTwo potentials are considered:\n- Single-well quadratic potential: $V(x) = \\tfrac{1}{2}x^2$, so $V'(x) = x$ and $V''(x) = 1$.\n- Double-well quartic potential: $V(x) = \\tfrac{1}{4}x^4 - \\tfrac{a}{2}x^2$ with parameter $a>0$, so $V'(x)=x^3 - a x$ and $V''(x)=3x^2 - a$.\n\nYour task is to write a complete, runnable program that:\n1. Simulates the SDE using the Euler–Maruyama method with time step $\\Delta t$ and fixed Gaussian increments $\\Delta W_n \\sim \\mathcal{N}(0,\\Delta t)$ generated using a specified pseudorandom seed value to ensure reproducibility.\n2. Simultaneously evolves the Jacobian $J_t(x)$ along the same path using the multiplicative update derived from the variational equation for the additive-noise case.\n3. Performs the computations for the following test suite and produces specified outputs. All Brownian increments must be generated with the given seed, and when two or more trajectories are compared, they must be driven by the exact same realization of the Brownian path (the same increments array).\n\nTest suite (each item is a separate test case):\n- Test $1$: Single-well potential with parameters $\\sigma = 0$, $T = 1$, $\\Delta t = 10^{-3}$, initial condition $x = 0.3$, seed $12345$. Output a float equal to the absolute difference\n$$\n\\left|J_T(x) - e^{-T}\\right|.\n$$\n- Test $2$: Single-well potential with parameters $\\sigma = 0.7$, $T = 2$, $\\Delta t = 10^{-3}$, initial conditions $x_1 = -1$, $x_2 = 1$, seed $67890$. Output a boolean indicating whether\n$$\n\\phi_T(x_1) < \\phi_T(x_2).\n$$\n- Test $3$: Double-well potential with parameter $a = 1$, $\\sigma = 0.5$, $T = 3$, $\\Delta t = 10^{-3}$, initial condition $x = 0.1$, seed $24680$. Let $\\varepsilon = 10^{-6}$. Compute two trajectories starting from $x$ and $x+\\varepsilon$ using the same Brownian increments, and compute the finite-difference approximation of the flow derivative at time $T$:\n$$\nD_{\\mathrm{FD}}(x) = \\frac{\\phi_T(x+\\varepsilon) - \\phi_T(x)}{\\varepsilon}.\n$$\nOutput a boolean indicating whether\n$$\n\\left|D_{\\mathrm{FD}}(x) - J_T(x)\\right| < 5\\times 10^{-3}.\n$$\n- Test $4$: Single-well potential with parameters $\\sigma = 1$, $T = 0$, $\\Delta t = 10^{-3}$, initial condition $x = 0.5$, seed $13579$. Output a float equal to the absolute difference\n$$\n\\left|J_T(x) - 1\\right|.\n$$\n\nNumerical procedure requirements:\n- Use the Euler–Maruyama scheme for the state variable:\n$$\nX_{n+1} = X_n + b(X_n)\\,\\Delta t + \\sigma\\,\\Delta W_n, \\quad b(x) := -V'(x),\n$$\nwith $N = T/\\Delta t$ steps.\n- Evolve the Jacobian using the multiplicative update\n$$\nJ_{n+1} = J_n \\exp\\left(b'(X_n)\\,\\Delta t\\right),\n$$\nwhere $b'(x)$ is the spatial derivative of $b(x)$, equal to $-V''(x)$. Initialize $J_0 = 1$.\n- For each test case, ensure $T/\\Delta t$ is an integer and that the BM increments $\\Delta W_n$ are generated as $\\sqrt{\\Delta t}\\,Z_n$ with $Z_n \\sim \\mathcal{N}(0,1)$ using the specified seed.\n\nFinal output format:\n- Your program should produce a single line of output containing the results of all test cases as a comma-separated list enclosed in square brackets, in the order of Tests $1$ to $4$. For example, an output with two floats and two booleans would look like\n$$\n[\\text{float}_1,\\text{boolean}_2,\\text{boolean}_3,\\text{float}_4].\n$$", "solution": "The problem requires the numerical simulation of a one-dimensional Itô stochastic differential equation (SDE) and the corresponding evolution of its flow Jacobian. The SDE is of the form:\n$$\ndX_t = -V'(X_t)\\,dt + \\sigma\\,dW_t, \\quad X_0 = x\n$$\nwhere $X_t$ is the state of the system at time $t \\ge 0$, $V(x)$ is a potential function, $b(x) = -V'(x)$ is the drift coefficient, $\\sigma \\ge 0$ is the constant noise intensity, and $\\{W_t\\}_{t\\ge 0}$ is a standard one-dimensional Brownian motion.\n\nThe solution to this SDE starting from $x$ at time $t=0$ is denoted by $\\phi_t(x)$. The set of maps $\\{\\phi_t\\}_{t \\ge 0}$ constitutes the stochastic flow. The Jacobian of this flow, $J_t(x) = \\frac{\\partial}{\\partial x}\\phi_t(x)$, quantifies the sensitivity of the solution at time $t$ to infinitesimal changes in the initial condition $x$. Its evolution is governed by the first variational equation. For an SDE with additive noise (i.e., $\\sigma$ is constant), this equation is an ordinary differential equation (ODE) along the random path of $X_t$:\n$$\ndJ_t(x) = b'(X_t(x)) J_t(x) \\,dt, \\quad J_0(x) = 1\n$$\nwhere $b'(x) = \\frac{d}{dx}b(x) = -V''(x)$. The solution to this ODE is\n$$\nJ_t(x) = \\exp\\left(\\int_0^t b'(X_s(x)) \\,ds\\right).\n$$\n\nWe are tasked with simulating these dynamics for two specific potentials and validating certain theoretical properties.\n\nThe numerical integration is performed using the methods specified:\n1.  **State variable $X_t$**: The Euler-Maruyama scheme is used. For a time step $\\Delta t$, the discrete-time update rule is:\n    $$\n    X_{n+1} = X_n + b(X_n)\\,\\Delta t + \\sigma\\,\\Delta W_n\n    $$\n    where $X_n \\approx X_{t_n}$ with $t_n=n\\Delta t$, and $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$ are independent Gaussian increments with mean $0$ and variance $\\Delta t$. They are generated as $\\Delta W_n = Z_n \\sqrt{\\Delta t}$, where $Z_n \\sim \\mathcal{N}(0,1)$.\n\n2.  **Jacobian $J_t$**: The update rule for the Jacobian is derived by discretizing the integral in its exact solution. Over one time step,\n    $$\n    J_{t_{n+1}} = J_{t_n} \\exp\\left(\\int_{t_n}^{t_{n+1}} b'(X_s) \\,ds\\right).\n    $$\n    Approximating the integral using the left-hand rule, $\\int_{t_n}^{t_{n+1}} b'(X_s) \\,ds \\approx b'(X_{t_n})\\,\\Delta t = b'(X_n)\\,\\Delta t$, we obtain the specified multiplicative update scheme, which preserves the positivity of the Jacobian:\n    $$\n    J_{n+1} = J_n \\exp\\left(b'(X_n)\\,\\Delta t\\right), \\quad J_0 = 1.\n    $$\n\nThe two potentials define the drift $b(x)$ and its derivative $b'(x)$:\n1.  **Single-well potential**: $V(x) = \\frac{1}{2}x^2$.\n    The derivatives are $V'(x)=x$ and $V''(x)=1$.\n    This gives $b(x) = -V'(x) = -x$ and $b'(x) = -V''(x) = -1$.\n\n2.  **Double-well potential**: $V(x) = \\frac{1}{4}x^4 - \\frac{a}{2}x^2$ for $a > 0$.\n    The derivatives are $V'(x)=x^3 - ax$ and $V''(x)=3x^2 - a$.\n    This gives $b(x) = -(x^3 - ax) = ax - x^3$ and $b'(x) = -(3x^2 - a) = a - 3x^2$.\n\nThe implementation will consist of a main script that executes the four test cases in sequence. Helper functions are defined to provide the potential derivatives $b(x)$ and $b'(x)$, and to perform the core simulation loop given the initial conditions, parameters, and a pre-generated path of Brownian increments. Generating the entire noise path at once using a specified seed ensures reproducibility and allows the same noise realization to drive different trajectories for comparison, as required by Tests 2 and 3.\n\nThe four test cases are designed to probe different aspects of the system:\n- **Test 1**: This is a deterministic case ($\\sigma=0$) where the SDE becomes an ODE $dX_t = -X_t\\,dt$. The flow is $\\phi_t(x) = x e^{-t}$, and the true Jacobian is $J_t(x) = e^{-t}$. The numerical simulation of the Jacobian for $T=1$ is compared to the exact value $e^{-1}$. Since the numerical scheme for the Jacobian is an exact discretization for constant $b'$, the computed value should be machine-precision close to the true value.\n\n- **Test 2**: This test verifies a fundamental property of one-dimensional stochastic flows: they are almost surely order-preserving. That is, if $x_1 < x_2$, then $\\phi_t(x_1) < \\phi_t(x_2)$ for all $t > 0$. The test checks if this inequality holds at the final time $T=2$ for two trajectories starting at $x_1 = -1$ and $x_2 = 1$ driven by the same noise.\n\n- **Test 3**: This test directly validates the implemented Jacobian evolution by comparing its output, $J_T(x)$, to a finite-difference approximation of the flow derivative, $D_{\\mathrm{FD}}(x) = (\\phi_T(x+\\varepsilon) - \\phi_T(x))/\\varepsilon$. For a sufficiently small perturbation $\\varepsilon$, this approximation should be close to the true derivative, and thus to the simulated Jacobian value.\n\n- **Test 4**: This is a boundary case where the total simulation time $T=0$. In this case, no steps are taken. The state remains at its initial condition, $\\phi_0(x) = x$, and the Jacobian remains at its initial value, $J_0(x) = \\frac{\\partial x}{\\partial x} = 1$. The test verifies that the implementation correctly handles this trivial case.\n\nThe final program computes the result for each test and formats them into a single comma-separated string as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef _get_potential_funcs(p_type, a=None):\n    \"\"\"\n    Returns the drift b(x) = -V'(x) and its derivative b'(x) = -V''(x)\n    for a given potential type.\n    \"\"\"\n    if p_type == 'single_well':\n        # V(x) = 0.5 * x^2 => V'(x) = x, V''(x) = 1\n        # b(x) = -x, b'(x) = -1\n        b = lambda x: -x\n        b_prime = lambda x: -1.0\n    elif p_type == 'double_well':\n        # V(x) = 0.25*x^4 - 0.5*a*x^2 => V'(x) = x^3 - ax, V''(x) = 3x^2 - a\n        # b(x) = ax - x^3, b'(x) = a - 3x^2\n        if a is None:\n            raise ValueError(\"Parameter 'a' must be provided for double_well potential.\")\n        b = lambda x: a * x - x**3\n        b_prime = lambda x: a - 3 * x**2\n    else:\n        raise ValueError(f\"Unknown potential type: {p_type}\")\n    return b, b_prime\n\ndef _perform_simulation(x0, T, dt, sigma, dW_path, b, b_prime):\n    \"\"\"\n    Performs the simulation of the SDE and its Jacobian.\n    \"\"\"\n    # Handle the T=0 case\n    if T == 0:\n        return x0, 1.0\n\n    num_steps = int(T / dt)\n    \n    # Ensure the noise path has the correct length\n    if len(dW_path) != num_steps:\n        raise ValueError(\"Length of dW_path does not match the number of simulation steps.\")\n\n    X = x0\n    J = 1.0\n    \n    for i in range(num_steps):\n        # Update Jacobian using the state at the beginning of the interval\n        J = J * np.exp(b_prime(X) * dt)\n        \n        # Update state using Euler-Maruyama\n        X = X + b(X) * dt + sigma * dW_path[i]\n        \n    return X, J\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    results = []\n\n    # --- Test 1 ---\n    # Single-well potential, deterministic case sigma = 0\n    # Expected Jacobian is exp(-T)\n    seed, T, dt, x0, sigma = 12345, 1.0, 1e-3, 0.3, 0.0\n    \n    num_steps = int(T / dt)\n    np.random.seed(seed)\n    Z = np.random.randn(num_steps)\n    dW = np.sqrt(dt) * Z\n    \n    b, b_prime = _get_potential_funcs('single_well')\n    \n    _, final_J = _perform_simulation(x0, T, dt, sigma, dW, b, b_prime)\n    result1 = abs(final_J - np.exp(-T))\n    results.append(result1)\n\n    # --- Test 2 ---\n    # Single-well potential, stochastic case.\n    # Check if flow is order-preserving: phi_T(x1) < phi_T(x2) for x1 < x2\n    seed, T, dt, sigma = 67890, 2.0, 1e-3, 0.7\n    x1, x2 = -1.0, 1.0\n    \n    num_steps = int(T / dt)\n    np.random.seed(seed)\n    Z = np.random.randn(num_steps)\n    dW = np.sqrt(dt) * Z\n\n    b, b_prime = _get_potential_funcs('single_well')\n\n    final_X1, _ = _perform_simulation(x1, T, dt, sigma, dW, b, b_prime)\n    final_X2, _ = _perform_simulation(x2, T, dt, sigma, dW, b, b_prime)\n    result2 = final_X1  final_X2\n    results.append(result2)\n\n    # --- Test 3 ---\n    # Double-well potential.\n    # Compare simulated Jacobian with finite-difference approximation.\n    seed, a, sigma, T, dt, x0, eps = 24680, 1.0, 0.5, 3.0, 1e-3, 0.1, 1e-6\n    \n    num_steps = int(T / dt)\n    np.random.seed(seed)\n    Z = np.random.randn(num_steps)\n    dW = np.sqrt(dt) * Z\n    \n    b, b_prime = _get_potential_funcs('double_well', a=a)\n    \n    phi_T_x, J_T_x = _perform_simulation(x0, T, dt, sigma, dW, b, b_prime)\n    phi_T_x_eps, _ = _perform_simulation(x0 + eps, T, dt, sigma, dW, b, b_prime)\n    \n    D_FD = (phi_T_x_eps - phi_T_x) / eps\n    result3 = abs(D_FD - J_T_x)  5e-3\n    results.append(result3)\n    \n    # --- Test 4 ---\n    # Single-well potential, T=0 case.\n    # Expected Jacobian is 1.\n    seed, sigma, T, dt, x0 = 13579, 1.0, 0.0, 1e-3, 0.5\n    \n    # For T=0, num_steps is 0, so the noise path is empty.\n    # The seed is set for consistency but won't be used.\n    np.random.seed(seed)\n    dW = np.array([])\n    \n    b, b_prime = _get_potential_funcs('single_well')\n    \n    _, final_J = _perform_simulation(x0, T, dt, sigma, dW, b, b_prime)\n    result4 = abs(final_J - 1.0)\n    results.append(result4)\n\n    # Final print statement in the exact required format.\n    # str(True) -> 'True', str(False) -> 'False'\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3077283"}]}