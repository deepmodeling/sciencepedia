{"hands_on_practices": [{"introduction": "群体遗传学的基石在于量化自然选择如何改变等位基因频率。本练习将引导你推导一个经典的单基因座、双等位基因选择模型中的平衡频率([@problem_id:2711044])。通过解决这个问题，你将深入理解显性系数（$h$）如何决定选择的最终结果，例如超显性导致的稳定多态性，从而掌握选择理论的数学基础。", "problem": "考虑一个具有两个等位基因 $A$ 和 $a$ 的单个常染色体基因座，存在于一个世代不重叠的、非常大的、随机交配的二倍体群体中。假设没有突变、没有迁移（基因流）和没有遗传漂变，因此等位基因频率的变化仅由生存力选择引起。设 $p$ 表示等位基因 $A$ 的频率，$q=1-p$ 表示等位基因 $a$ 的频率。基因型生存力由 $W_{AA}=1$、$W_{Aa}=1+s(1-2h)$ 和 $W_{aa}=1+s$ 给出，其中 $s \\neq 0$ 是一个选择系数，$h \\in \\mathbb{R}$ 是一个显性形态参数。你可以假设选择前基因型频率符合哈迪-温伯格平衡比例。\n\n仅从生存力选择下基因型频率变化的基本定义和平均适合度的定义出发，推导内部多态性平衡等位基因频率 $p^{\\ast}$（当其存在时，满足 $0 < p^{\\ast} < 1$）的表达式，仅用 $h$ 表示，并分析该平衡的稳定性。", "solution": "该问题要求在一个单基因座、双等位基因的生存力选择模型中，推导多态性平衡并进行稳定性分析。我们从群体遗传学的基本原理开始。\n\n设 $p$ 和 $q=1-p$ 分别是等位基因 $A$ 和 $a$ 的频率。在随机交配的假设下，选择前的合子基因型频率由哈迪-温伯格平衡比例给出：$AA$ 为 $p^2$，$Aa$ 为 $2pq$，$aa$ 为 $q^2$。这些基因型的相对生存力为 $W_{AA}=1$、$W_{Aa}=1+s(1-2h)$ 和 $W_{aa}=1+s$，其中 $s \\neq 0$。\n\n群体的平均适合度 $\\bar{W}$ 是个体生存力的加权平均值，权重为其频率：\n$$ \\bar{W} = p^2 W_{AA} + 2pq W_{Aa} + q^2 W_{aa} $$\n代入给定的生存力：\n$$ \\bar{W} = p^2(1) + 2p(1-p)(1+s(1-2h)) + (1-p)^2(1+s) $$\n\n下一代中等位基因 $A$ 的频率 $p'$ 是存活者中 $A$ 等位基因的频率。这通过对存活的 $AA$ 和 $Aa$ 个体的贡献求和，然后除以平均适合度来计算：\n$$ p' = \\frac{p^2 W_{AA} + pq W_{Aa}}{\\bar{W}} $$\n一代中等位基因频率的变化为 $\\Delta p = p' - p$：\n$$ \\Delta p = \\frac{p^2 W_{AA} + pq W_{Aa}}{\\bar{W}} - p = \\frac{p^2 W_{AA} + pq W_{Aa} - p \\bar{W}}{\\bar{W}} $$\n将 $\\bar{W}$ 的表达式代入分子：\n$$ \\Delta p = \\frac{p^2 W_{AA} + pq W_{Aa} - p(p^2 W_{AA} + 2pq W_{Aa} + q^2 W_{aa})}{\\bar{W}} $$\n$$ \\Delta p = \\frac{p(p W_{AA} + q W_{Aa} - (p^2 W_{AA} + 2pq W_{Aa} + q^2 W_{aa}))}{\\bar{W}} $$\n对括号内的项进行因式分解和简化：\n$$ p W_{AA} + q W_{Aa} - p^2 W_{AA} - 2pq W_{Aa} - q^2 W_{aa} $$\n$$ = p(1-p)W_{AA} + q(1-2p)W_{Aa} - q^2 W_{aa} $$\n由于 $q=1-p$ 且 $1-2p = q-p$：\n$$ = pqW_{AA} + q(q-p)W_{Aa} - q^2 W_{aa} = q[pW_{AA} + (q-p)W_{Aa} - qW_{aa}] $$\n$$ = q[p(W_{AA} - W_{Aa}) + q(W_{Aa} - W_{aa})] $$\n因此，等位基因频率变化的方程为：\n$$ \\Delta p = \\frac{pq}{\\bar{W}} [p(W_{AA} - W_{Aa}) + q(W_{Aa} - W_{aa})] $$\n\n平衡是 $\\Delta p = 0$ 的状态。当 $p=0$，$q=0$（即 $p=1$），或者方括号中的项为零时，就会出现这种情况。前两者是平凡的单态平衡（固定）。如果对于某个 $p \\in (0,1)$，方括号中的项为零，则存在一个内部多态性平衡，记为 $p^{\\ast}$：\n$$ p^{\\ast}(W_{AA} - W_{Aa}) + (1-p^{\\ast})(W_{Aa} - W_{aa}) = 0 $$\n求解 $p^{\\ast}$：\n$$ p^{\\ast}(W_{AA} - W_{Aa}) - p^{\\ast}(W_{Aa} - W_{aa}) = -(W_{Aa} - W_{aa}) $$\n$$ p^{\\ast}(W_{AA} + W_{aa} - 2W_{Aa}) = W_{aa} - W_{Aa} $$\n如果分母不为零，则内部平衡频率为：\n$$ p^{\\ast} = \\frac{W_{aa} - W_{Aa}}{W_{AA} + W_{aa} - 2W_{Aa}} $$\n现在，我们代入具体的生存力值：\n- 分子：$W_{aa} - W_{Aa} = (1+s) - (1+s(1-2h)) = s - s + 2sh = 2sh$。\n- 分母：$W_{AA} + W_{aa} - 2W_{Aa} = 1 + (1+s) - 2(1+s(1-2h)) = 2+s - 2 - 2s(1-2h) = s - 2s + 4sh = -s + 4sh = s(4h-1)$。\n\n由于题目说明 $s \\neq 0$，我们可以简化：\n$$ p^{\\ast} = \\frac{2sh}{s(4h-1)} = \\frac{2h}{4h-1} $$\n要使其成为一个有效的多态性平衡，必须满足 $0 < p^{\\ast} < 1$。\n条件 $p^{\\ast} > 0$ 要求 $\\frac{2h}{4h-1} > 0$，这在 $h < 0$ 或 $h > \\frac{1}{4}$ 时成立。\n条件 $p^{\\ast} < 1$ 要求 $\\frac{2h}{4h-1} < 1$，简化为 $\\frac{2h - (4h-1)}{4h-1} < 0$，即 $\\frac{1-2h}{4h-1} < 0$。这在 $h < \\frac{1}{4}$ 或 $h > \\frac{1}{2}$ 时成立。\n结合这两个约束条件，如果 $h < 0$ 或 $h > \\frac{1}{2}$，则存在多态性平衡。\n\n接下来，我们通过检查边界附近的局部选择梯度来分析此平衡的稳定性。边界平衡 $p=0$ 和 $p=1$ 的稳定性决定了系统的行为。如果两个边界平衡都不稳定，则内部平衡是稳定的；如果两个边界平衡都稳定，则内部平衡是不稳定的。\n\n$p=0$ 平衡的稳定性取决于等位基因 $A$ 是否能侵入一个由 $aa$ 个体组成的群体。当 $p$ 为小的正数时，如果 $\\Delta p > 0$，则侵入是可能的。在 $p=0$ 附近，$\\Delta p$ 的符号由 $W_{Aa} - W_{aa}$ 的符号决定。如果 $W_{Aa} > W_{aa}$，则 $p=0$ 处的边界是不稳定的。\n$W_{Aa} - W_{aa} = -2sh$。因此，如果 $-2sh > 0$，$p=0$ 是不稳定的。\n\n$p=1$ 平衡的稳定性取决于等位基因 $a$ 是否能侵入一个由 $AA$ 个体组成的群体。当 $q$ 为小的正数时，如果 $q$ 增加，则侵入是可能的，这对应于 $p$ 从 $1$ 减少。其条件是 $W_{Aa} > W_{AA}$。如果 $W_{Aa} > W_{AA}$，则 $p=1$ 处的边界是不稳定的。\n$W_{Aa} - W_{AA} = s(1-2h)$。因此，如果 $s(1-2h) > 0$，$p=1$ 是不稳定的。\n\n如果两个边界平衡都不稳定，则内部平衡 $p^{\\ast}$ 是局部稳定的。这对应于超显性或杂合子优势的情况（$W_{Aa} > W_{AA}$ 和 $W_{Aa} > W_{aa}$）。条件是：\n$s(1-2h) > 0$ 和 $-2sh > 0$。\n- 如果 $s>0$：$1-2h > 0 \\implies h < \\frac{1}{2}$ 并且 $-h > 0 \\implies h < 0$。合并得 $h < 0$。\n- 如果 $s<0$：$1-2h < 0 \\implies h > \\frac{1}{2}$ 并且 $-h < 0 \\implies h > 0$。合并得 $h > \\frac{1}{2}$。\n在这两种情况下，$h$ 的值都落在 $p^{\\ast}$ 存在的范围内。因此，对于 $h < 0$ 或 $h > \\frac{1}{2}$，系统表现出一个由超显性维持的稳定的多态性平衡。\n\n如果两个边界平衡都稳定，则内部平衡 $p^{\\ast}$ 是不稳定的。这对应于低显性或杂合子劣势的情况（$W_{Aa} < W_{AA}$ 和 $W_{Aa} < W_{aa}$）。条件是：\n$s(1-2h) < 0$ 和 $-2sh < 0$。\n- 如果 $s>0$：$1-2h < 0 \\implies h > \\frac{1}{2}$ 并且 $-h < 0 \\implies h > 0$。合并得 $h > \\frac{1}{2}$。\n- 如果 $s<0$：$1-2h > 0 \\implies h < \\frac{1}{2}$ 并且 $-h > 0 \\implies h < 0$。合并得 $h < 0$。\n这里在解释上存在一个微妙之处。稳定性准则取决于 $s$ 的符号。然而，$p^*$ 的存在条件被推导为 $h < 0$ 或 $h > 1/2$。稳定性分析表明，当平衡存在时，其稳定性由 $s$ 和 $h$ 的特定组合决定。例如，如果 $s>0$，当 $h<0$ 时，平衡存在且稳定，但当 $h > 1/2$ 时，平衡存在但不稳定。\n\n当杂合子的适合度恰好是两个纯合子适合度的中间值时，出现加性效应（共显性）的情况：\n$$ W_{Aa} = \\frac{W_{AA} + W_{aa}}{2} $$\n$$ 1+s(1-2h) = \\frac{1 + (1+s)}{2} = 1 + \\frac{s}{2} $$\n由于 $s \\neq 0$，我们可以用 $s$ 除：\n$$ 1-2h = \\frac{1}{2} \\implies 2h = \\frac{1}{2} \\implies h = \\frac{1}{4} $$\n在这种情况下，适合度形成一个等差数列：$W_{AA}=1$，$W_{Aa}=1+\\frac{s}{2}$，$W_{aa}=1+s$。这代表纯粹的定向选择，其中一个等位基因总是比另一个更有利，无论其频率如何。\n- 如果 $s > 0$，则 $W_{aa} > W_{Aa} > W_{AA}$，选择将驱动 $p$ 趋向于 $0$。\n- 如果 $s < 0$，则 $W_{AA} > W_{Aa} > W_{aa}$，选择将驱动 $p$ 趋向于 $1$。\n在这两种情况下，都无法维持多态性平衡。在数学上，将 $h=\\frac{1}{4}$ 代入 $p^{\\ast}$ 的表达式，会得到一个分母 $s(4(\\frac{1}{4})-1)=0$，这证实了不存在内部平衡。系统将演化至固定。\n最终要求的答案是仅用 $h$ 表示的 $p^{\\ast}$ 表达式。", "answer": "$$\\boxed{\\frac{2h}{4h-1}}$$", "id": "2711044"}, {"introduction": "虽然选择为进化提供了方向，但在任何有限的真实种群中，遗传漂变都引入了随机性。本练习探讨如何计算一个新产生的有利突变的固定概率，并比较了两种基本模型：Wright-Fisher模型（世代不重叠）和Moran模型（世代重叠）([@problem_id:2711075])。这项实践突出了模型假设在预测进化结果中的关键作用，并加深了对选择与漂变相互作用的理解。", "problem": "在一个大小恒定为 $N$、世代不重叠、无突变或迁移的随机交配二倍体种群中，一个新的有益突变等位基因以单拷贝形式出现。考虑由自然选择和遗传漂变驱动的随机演化的两个经典种群遗传学模型。\n\n模型A（赖特-费舍尔（WF）模型，二倍体，离散世代）：通过对 $2N$ 个基因拷贝进行多项式抽样来形成世代。假设存在基因选择，使得突变等位基因具有选择优势 $s$，该优势线性增加适应度（即，与野生型的相对适应度为 $1$ 相比，杂合子的相对适应度为 $1+s$）。令 $x$ 表示突变等位基因频率。在 $N$ 较大、选择和漂变较弱的扩散极限下，固定概率 $u(x)$ 的后向方程可以从基于 $x$ 的漂移 $m(x)$ 和方差 $v(x)$ 的标准扩散近似得出。\n\n模型B（基于 $2N$ 个基因拷贝的莫兰模型，重叠世代）：在每个无穷小步中，一个基因拷贝以与其相对适应度成正比的概率被选中进行繁殖，另一个基因拷贝被均匀随机地选中并替换。假设突变等位基因的相对适应度为 $1+s$，野生型的相对适应度为 $1$。令 $i$ 表示突变拷贝的数量，并将所得到的过程视为在 $\\{0,1,\\dots,2N\\}$ 上的生灭马尔可夫链，其吸收态为 $0$ 和 $2N$。\n\n从这些模型的核心定义出发，且不援引任何预先给出的固定公式，完成以下任务：\n\n1) 对模型A，写出由赖特-费舍尔抽样和基因选择所隐含的扩散近似，推导并求解满足 $u(0)=0$ 和 $u(1)=1$ 的固定概率 $u(x)$ 的后向方程。\n\n2) 对模型B，写出使突变体数量增加一或减少一的单步转移概率 $T_i^{+}$ 和 $T_i^{-}$。使用时间齐次生灭链的标准吸收概率分析，推导出满足 $U(0)=0$ 和 $U(2N)=1$ 的固定概率 $U(i)$ 的闭式解。\n\n假设突变体以单拷贝起始，因此初始频率为 $x_0=1/(2N)$，初始数量为 $i_0=1$。使用您推导的表达式，对 $N=1000$ 和 $s=0.01$ 的情况进行数值评估，并报告两种模型中固定概率的差值，\n$$\\Delta \\equiv u(x_0)\\;-\\;U(i_0).$$\n将最终数值答案表示为四舍五入到四位有效数字的小数。不要使用百分号。", "solution": "本题要求在两个经典的种群遗传学模型——赖特-费舍尔（WF）模型和莫兰模型中，推导并比较一个新的有益等位基因的固定概率。\n\n第一部分：模型A - 赖特-费舍尔扩散近似\n\n赖特-费舍尔模型描述了一个大小恒定为 $N$ 的二倍体种群。世代是离散且不重叠的。我们考虑一个有野生型和突变型两个等位基因的单位点。题目描述了基因（或加性）选择，其中杂合子适应度为 $1+s$，野生型纯合子为 $1$。这意味着突变型纯合子的适应度为 $1+2s$。\n令 $x$ 为突变等位基因的频率。在随机交配下，种群的平均适应度为 $\\bar{w} = (1-x)^2(1) + 2x(1-x)(1+s) + x^2(1+2s) = 1+2sx$。\n下一代中突变等位基因的频率 $x'$ 为：\n$$ x' = \\frac{x^2(1+2s) + x(1-x)(1+s)}{\\bar{w}} = \\frac{x(1+s+sx)}{1+2sx} $$\n由选择引起的单代等位基因频率变化为 $\\Delta x_{\\text{sel}} = x' - x$：\n$$ \\Delta x_{\\text{sel}} = \\frac{x(1+s+sx)}{1+2sx} - x = \\frac{x(1+s+sx) - x(1+2sx)}{1+2sx} = \\frac{sx(1-x)}{1+2sx} $$\n在弱选择极限下（$s \\ll 1$），分母 $1+2sx \\approx 1$。因此，由选择引起的频率变化约为 $\\Delta x_{\\text{sel}} \\approx sx(1-x)$。我们将使用这个标准近似作为扩散模型中的漂移系数。\n\n扩散近似基于每代等位基因频率变化 $\\Delta x$ 的矩。\n漂移系数（平均变化）为 $m(x) = E[\\Delta x | x] \\approx sx(1-x)$。\n方差系数（均方变化）主要由 $2N$ 个基因的二项式抽样产生的遗传漂变决定。下一代等位基因频率的方差为 $\\text{Var}(x') = \\frac{x(1-x)}{2N}$。因此，$v(x) = E[(\\Delta x)^2 | x] \\approx \\frac{x(1-x)}{2N}$。\n\n固定概率 $u(x)$ 的后向科尔莫戈罗夫方程为：\n$$ \\frac{1}{2}v(x)\\frac{d^2u}{dx^2} + m(x)\\frac{du}{dx} = 0 $$\n代入 $x \\in (0, 1)$ 的系数：\n$$ \\frac{1}{2} \\left( \\frac{x(1-x)}{2N} \\right) \\frac{d^2u}{dx^2} + sx(1-x)\\frac{du}{dx} = 0 $$\n两边除以 $x(1-x)$（对于 $x \\in (0,1)$，该项非零）：\n$$ \\frac{1}{4N} \\frac{d^2u}{dx^2} + s\\frac{du}{dx} = 0 $$\n$$ \\frac{d^2u}{dx^2} + 4Ns\\frac{du}{dx} = 0 $$\n令 $y(x) = \\frac{du}{dx}$。方程变为一阶线性常微分方程：$y' + 4Nsy = 0$。其解为 $y(x) = C_1 \\exp(-4Nsx)$。\n对 $y(x)$ 积分求 $u(x)$：\n$$ u(x) = \\int C_1 \\exp(-4Nsx) dx = -\\frac{C_1}{4Ns}\\exp(-4Nsx) + C_2 $$\n令 $A = -C_1/(4Ns)$。则 $u(x) = A\\exp(-4Nsx) + C_2$。\n我们应用边界条件 $u(0)=0$ 和 $u(1)=1$。\n$u(0) = 0 \\implies A + C_2 = 0 \\implies C_2 = -A$。\n$u(1) = 1 \\implies A\\exp(-4Ns) + C_2 = 1$。\n代入 $C_2 = -A$：\n$A(\\exp(-4Ns) - 1) = 1 \\implies A = \\frac{1}{\\exp(-4Ns)-1}$。\n因此，$C_2 = \\frac{-1}{\\exp(-4Ns)-1} = \\frac{1}{1-\\exp(-4Ns)}$。\n固定概率为：\n$$ u(x) = \\frac{\\exp(-4Nsx)}{\\exp(-4Ns)-1} + \\frac{1}{1-\\exp(-4Ns)} = \\frac{-\\exp(-4Nsx)+1}{1-\\exp(-4Ns)} $$\n$$ u(x) = \\frac{1 - \\exp(-4Nsx)}{1 - \\exp(-4Ns)} $$\n\n第二部分：模型B - 莫兰生灭过程\n\n莫兰模型考虑一个包含 $2N$ 个基因拷贝且世代重叠的种群。在每个时间步，一个拷贝被选中繁殖，另一个被选中替换。\n令 $i$ 为突变拷贝的数量。突变拷贝的适应度为 $1+s$，野生型的适应度为 $1$。\n种群的总适应度为 $i(1+s) + (2N-i)(1) = 2N+is$。\n选择一个突变体进行繁殖的概率是 $p_{\\text{birth\\_mut}} = \\frac{i(1+s)}{2N+is}$。\n选择一个野生型进行繁殖的概率是 $p_{\\text{birth\\_wt}} = \\frac{2N-i}{2N+is}$。\n被替换的拷贝是均匀随机选择的。\n\n如果一个突变体繁殖且一个野生型被替换，则突变体数量增加一（$i \\to i+1$）。其概率为：\n$$ T_i^{+} = p_{\\text{birth\\_mut}} \\times P(\\text{death of wt}) = \\frac{i(1+s)}{2N+is} \\times \\frac{2N-i}{2N} $$\n如果一个野生型繁殖且一个突变体被替换，则突变体数量减少一（$i \\to i-1$）。其概率为：\n$$ T_i^{-} = p_{\\text{birth\\_wt}} \\times P(\\text{death of mut}) = \\frac{2N-i}{2N+is} \\times \\frac{i}{2N} $$\n过程以概率 $1 - T_i^{+} - T_i^{-}$ 停留在状态 $i$。\n\n对于状态空间为 $\\{0, 1, \\dots, 2N\\}$ 的生灭过程，从状态 $i$ 开始的固定概率 $U(i)$ 由以下通用公式给出：\n$$ U(i) = \\frac{\\sum_{k=0}^{i-1} \\prod_{j=1}^{k} \\gamma_j}{\\sum_{k=0}^{2N-1} \\prod_{j=1}^{k} \\gamma_j} $$\n其中 $\\gamma_j = T_j^{-}/T_j^{+}$。当 $k=0$ 时，乘积项取值为 $1$。\n我们来计算 $i \\in \\{1, \\dots, 2N-1\\}$ 的比率 $\\gamma_i$：\n$$ \\gamma_i = \\frac{T_i^{-}}{T_i^{+}} = \\frac{\\frac{(2N-i)i}{2N(2N+is)}}{\\frac{i(1+s)(2N-i)}{2N(2N+is)}} = \\frac{1}{1+s} $$\n比率 $\\gamma_i$ 是一个常数，我们记为 $\\gamma = \\frac{1}{1+s}$。\n$U(i)$ 的公式简化为：\n$$ U(i) = \\frac{\\sum_{k=0}^{i-1} \\gamma^k}{\\sum_{k=0}^{2N-1} \\gamma^k} $$\n这些是等比级数。等比级数 $\\sum_{k=0}^{n-1} r^k$ 的和为 $\\frac{1-r^n}{1-r}$。\n$$ U(i) = \\frac{\\frac{1-\\gamma^i}{1-\\gamma}}{\\frac{1-\\gamma^{2N}}{1-\\gamma}} = \\frac{1-\\gamma^i}{1-\\gamma^{2N}} $$\n代入 $\\gamma = \\frac{1}{1+s}$：\n$$ U(i) = \\frac{1 - (1+s)^{-i}}{1 - (1+s)^{-2N}} $$\n\n第三部分：数值计算与比较\n\n给定 $N=1000$ 和 $s=0.01$。初始状态为单个突变拷贝。\n对于模型A，初始频率为 $x_0 = \\frac{1}{2N} = \\frac{1}{2000}$。\n对于模型B，初始数量为 $i_0 = 1$。\n\n模型A的固定概率：\n$$ u(x_0) = u\\left(\\frac{1}{2000}\\right) = \\frac{1-\\exp\\left(-4(1000)(0.01)\\left(\\frac{1}{2000}\\right)\\right)}{1-\\exp(-4(1000)(0.01))} = \\frac{1-\\exp(-0.02)}{1-\\exp(-40)} $$\n数值计算：\n$1-\\exp(-0.02) \\approx 0.0198013267$\n$1-\\exp(-40) \\approx 1 - 4.248 \\times 10^{-18} \\approx 1$。\n所以，$u(x_0) \\approx 0.0198013267$。\n\n模型B的固定概率：\n$$ U(i_0) = U(1) = \\frac{1-(1+0.01)^{-1}}{1-(1+0.01)^{-2(1000)}} = \\frac{1-(1.01)^{-1}}{1-(1.01)^{-2000}} $$\n数值计算：\n$1-(1.01)^{-1} = 1 - \\frac{1}{1.01} = \\frac{0.01}{1.01} = \\frac{1}{101} \\approx 0.0099009901$。\n$1-(1.01)^{-2000} \\approx 1 - 2.276 \\times 10^{-9} \\approx 1$。\n所以，$U(i_0) \\approx 0.0099009901 / (1 - 2.276 \\times 10^{-9}) \\approx 0.0099010126$。\n\n差值 $\\Delta$ 为：\n$$ \\Delta = u(x_0) - U(i_0) \\approx 0.0198013267 - 0.0099010126 = 0.0099003141 $$\n四舍五入到四位有效数字，我们得到 $0.009900$。", "answer": "$$\\boxed{0.009900}$$", "id": "2711075"}, {"introduction": "现代进化生物学利用海量的基因组数据来寻找选择留下的印记。然而，其他进化力量，如种群历史（例如瓶颈效应）和背景选择，可能会产生与正选择相似的遗传多样性模式。这项计算练习要求你建立并应用一个统计模型，以从这些混淆因素中区分出真正的正选择信号，这是当代进化基因组学研究中的一项关键技能([@problem_id:2711019])。", "problem": "您必须编写一个完整且可运行的程序，该程序实现并评估一个联合统计模型，以仅使用下面指定的模拟数据，从正选择信号中解开背景选择和种群历史。任务的核心是将背景纯化选择和种群历史以可能混淆近期正选择推断的方式降低中性遗传多样性的逻辑形式化。您的模型必须包含重组率和功能注释以控制背景选择，以及一个全局种群因子以控制种群历史，然后识别那些多样性残差减少与正选择一致的窗口。\n\n基本出发点：\n- 在突变-漂变平衡下，一个泛交群体中的中性杂合度（每位点成对多样性）满足 $ \\pi \\approx 4 N_e \\mu $，其中 $ N_e $ 是有效种群大小，$ \\mu $ 是每位点的突变率。\n- 背景选择可以被建模为 $ N_e $ 的一个乘法性减少，其因子为 $ B_i \\in (0,1] $，该因子取决于局部重组率 $ r_i $ 以及连锁的有害靶点的密度和强度。较低的 $ r_i $ 和较高的靶点密度意味着较低的 $ B_i $。\n- 全基因组共享的种群历史（例如，在整个基因组中均匀改变 $ N_e $ 的瓶颈或基因流）通过一个因子 $ D > 0 $ 来缩放 $ N_e $。\n- 近期且强烈的正选择通过一个额外的、局限于受影响窗口的乘法因子 $ S_i \\in (0,1] $ 来减少局部多态性。\n\n由 $ i $ 索引的基因组窗口的模型规范：\n- 令 $ \\pi_i $ 表示观测到的每位点成对多样性。\n- 令 $ r_i $ 为窗口 $ i $ 的重组率。\n- 令 $ A_{ik} $ 为窗口 $ i $ 的第 $ k $ 个功能注释特征，其中 $ k \\in \\{1,\\dots,K\\} $。\n- 假设一个背景选择因子模型为 $ B_i = \\exp\\!\\left(-\\dfrac{\\Phi(A_i)}{r_i}\\right) $，其中 $ \\Phi(A_i) = \\sum_{k=1}^{K} \\lambda_k A_{ik} $，_k$ 为未知的非负权重。\n- 假设一个全基因组范围的种群缩放因子 $ D > 0 $ 并定义一个基线 $ \\theta = 4 N_e \\mu $。\n- 假设一个局部选择因子 $ S_i = \\exp(-s_i) $，其中 $ s_i \\ge 0 $，用于捕捉由近期正选择引起的多样性减少。\n\n因此，期望多样性为\n$$\n\\mathbb{E}[\\pi_i] = \\theta \\, D \\, \\exp\\!\\left(-\\frac{\\Phi(A_i)}{r_i}\\right)\\, \\exp(-s_i).\n$$\n取自然对数后得到一个带有高斯噪声 $ \\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2) $ 的对数线性模型：\n$$\n\\ln \\pi_i = \\alpha - \\sum_{k=1}^{K} \\beta_k A_{ik} - \\gamma \\frac{1}{r_i} - s_i + \\varepsilon_i,\n$$\n其中 $ \\alpha = \\ln \\theta + \\ln D $，$ \\beta_k = \\lambda_k $，并且 $ \\gamma $ 是一个未知的正数缩放因子，捕捉背景选择与重组相互作用的强度。用于参数估计的零模型将所有训练窗口（非候选窗口）的 $ s_i $ 设置为 $ 0 $。\n\n您的程序必须：\n1. 根据上述模型和提供的参数值生成模拟数据集。每个数据集包含 $ n $ 个窗口，每个窗口有 $ K = 2 $ 个注释特征、重组率 $ r_i $，以及一小组可能受到正选择的候选窗口。为了数值稳定性和可测试性，所有随机抽样必须使用指定的种子和分布；对于候选窗口，加性噪声 $ \\varepsilon_i $ 必须精确设置为 $ 0 $，而对于训练窗口，则从正态分布中独立抽取。\n2. 仅在训练窗口上通过普通最小二乘法拟合零模型（$ s_i = 0 $），将 $ y_i = \\ln \\pi_i $ 对以 $ [1, A_{i1}, A_{i2}, 1/r_i] $ 为列的设计矩阵进行回归。从训练窗口中估计残差标准差 $ \\hat{\\sigma} $。\n3. 对于每个候选窗口，计算标准化残差\n$$\nz_i = \\frac{y_i - \\hat{y}_i}{\\hat{\\sigma}},\n$$\n其中 $ \\hat{y}_i $ 是在拟合的零模型下预测的对数多样性。如果 $ z_i \\le -2.0 $，则将候选窗口分类为“selected”（受选择）；否则分类为“not selected”（未受选择）。此阈值必须视为固定值，其动机是基于标准差单位下的双侧高斯尾部，未进行多重检验校正，重点在于概念验证的检测标准。\n4. 将所有数据集中所有候选窗口的布尔分类结果聚合并打印在单一行中，格式为方括号内以逗号分隔的列表，例如 $ [True,False,True] $。\n\n数据生成细节（测试套件）：\n- 所有数据集的通用设置：\n  - 窗口数量 $ n = 60 $。\n  - 注释数量 $ K = 2 $。\n  - 基线参数：$ \\beta_1 = 0.8 $，$ \\beta_2 = 1.1 $，$ \\gamma = 0.7 $，噪声标准差 $ \\sigma = 0.12 $。\n  - 对于每个数据集，给定一个种子，特征被独立抽取：\n    - 注释 $ A_{i1} \\sim \\mathrm{Uniform}(0, 0.6) $，$ A_{i2} \\sim \\mathrm{Uniform}(0, 0.3) $。\n    - 重组率 $ r_i \\sim \\mathrm{Uniform}(0.6, 3.0) $，除非下面为候选窗口明确覆盖。\n  - 对于每个窗口 $ i $，对数多样性生成如下\n    $$\n    y_i = \\alpha - \\beta_1 A_{i1} - \\beta_2 A_{i2} - \\gamma \\frac{1}{r_i} - s_i + \\varepsilon_i\n    $$\n    且 $ \\pi_i = \\exp(y_i) $。对于训练窗口（非候选窗口），从 $ \\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2) $ 中抽取。对于候选窗口，精确设置 $ \\varepsilon_i = 0 $。\n\n- 数据集 $ 1 $（理想路径）：\n  - 种子 $ 101 $。\n  - 种群历史：$ \\alpha = -6.0 $（相对于基线无瓶颈）。\n  - 候选索引：$ [5, 42] $。\n  - 选择效应：$ s_{5} = 0.0 $，$ s_{42} = 0.6 $。\n\n- 数据集 $ 2 $（通过低重组率造成的背景选择混淆因素，无正选择）：\n  - 种子 $ 202 $。\n  - 种群历史：$ \\alpha = -6.0 $。\n  - 候选索引：$ [8, 15] $。\n  - 选择效应：$ s_{8} = 0.0 $，$ s_{15} = 0.0 $。\n  - 将候选窗口的重组率覆盖为较低但在训练范围内的值：设置 $ r_{8} = 0.55 $ 和 $ r_{15} = 0.55 $。\n\n- 数据集 $ 3 $（种群瓶颈，无正选择）：\n  - 种子 $ 303 $。\n  - 种群历史：$ \\alpha = -6.7 $。\n  - 候选索引：$ [2, 49] $。\n  - 选择效应：$ s_{2} = 0.0 $，$ s_{49} = 0.0 $。\n\n- 数据集 $ 4 $（混合：中等种群历史变动加一个真正的正选择）：\n  - 种子 $ 404 $。\n  - 种群历史：$ \\alpha = -6.4 $。\n  - 候选索引：$ [7, 33] $。\n  - 选择效应：$ s_{7} = 0.6 $，$ s_{33} = 0.0 $。\n\n实现要求：\n- 直接从生成方程计算 $ y_i = \\ln \\pi_i $；不要试图通过数值方法从 $ \\pi_i $ 反向计算 $ y_i $。\n- 使用普通最小二乘法在训练集上拟合零模型：如果 $ X $ 是设计矩阵，$ y $ 是响应变量，通过最小化平方误差来估计 $ \\hat{\\beta} $。您可以使用数值稳定的求解器。然后将 $ \\hat{\\sigma} $ 计算为训练集上均方残差的平方根。\n- 对于每个数据集，仅在其训练窗口上进行拟合，然后如上所述对其候选窗口进行分类。\n- 单位：所有量均为无量纲；不需要物理单位。\n- 最终输出格式：您的程序必须生成单行输出，其中包含四个数据集中所有候选窗口的分类结果，按数据集顺序排列，在每个数据集中，按候选索引的顺序排列。该行必须是方括号内以逗号分隔的列表，例如 $ [False,True,False,False,True,False,False,True] $，包含与数据集 $ 1 $ 到 $ 4 $ 对应的恰好 $ 8 $ 个布尔条目。\n\n您的解决方案将根据代码是否能运行并产生正确格式的输出，以及实现的逻辑是否与上述模型和测试套件规范相匹配来进行评分。不需要也不允许用户输入；所有数据都必须使用指定的种子和参数在内部生成。", "solution": "所呈现的问题是统计建模和计算生物学中一个明确定义的练习。它要求实现一项模拟研究，旨在从混淆因素（即背景纯化选择和种群历史）中解开正选择的基因组信号。该问题具有科学依据，数学上精确，且算法上已明确规定。它提供了所有必要的参数和程序，使其成为一个有效且可解决的任务。我将着手解决该问题。\n\n其基本原理是，各种进化过程会调节中性遗传多样性的水平（以每位点杂合度 $ \\pi $ 表示），使其偏离在突变-漂变平衡下的基线期望值，该期望值约为 $ \\pi \\approx 4 N_e \\mu $，其中 $ N_e $ 是有效种群大小，$ \\mu $ 是突变率。正选择、背景选择和种群事件都会改变局部或全局的 $ N_e $，从而影响 $ \\pi $。我们的任务是构建一个统计模型，该模型考虑了背景选择和种群历史的影响，以正确识别那些多样性减少只能由近期正选择解释的异常值。\n\n问题为基因组窗口 $ i $ 中观察到的每位点多样性 $ \\pi_i $ 指定了一个对数线性模型：\n$$\ny_i = \\ln \\pi_i = \\alpha - \\sum_{k=1}^{K} \\beta_k A_{ik} - \\gamma \\frac{1}{r_i} - s_i + \\varepsilon_i\n$$\n在此，各项具有精确的解释：\n- $ y_i = \\ln \\pi_i $ 是响应变量，即多样性的自然对数。\n- $ \\alpha $ 是一个截距项，它捕捉了基线对数多样性以及由种群历史引起的任何全基因组范围的缩放。例如，种群瓶颈会导致较低的 $ \\alpha $ 值。\n- 项 $ -\\sum_{k=1}^{K} \\beta_k A_{ik} $ 模拟了因与功能上重要的基因组区域连锁而导致的多样性减少，其中 $ A_{ik} $ 是注释特征（例如，保守位点的密度），$ \\beta_k $ 是它们对应的效应大小。这是背景选择效应的一个组成部分。\n- 项 $ - \\gamma \\frac{1}{r_i} $ 模拟了低重组区域多样性的减少，其中 $ r_i $ 是局部重组率。这是背景选择的第二个关键组成部分，因为当重组在解开中性位点与有害突变的连锁方面效果较差时，其效应更强。该模型将注释效应和重组效应分离为加性项，这对于线性回归框架是一个有效的简化，尽管它偏离了 $ -\\frac{\\Phi(A_i)}{r_i} $ 形式的乘法交互项。我们必须使用所提供的生成模型。\n- $ s_i \\ge 0 $ 是近期正选择（“选择性清除”）的效应，它会进一步局部减少多样性。在无正选择的原假设下，$ s_i = 0 $。\n- $ \\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2) $ 是一个高斯噪声项，代表随机性和未建模的因素。\n\n分析过程的结构如下：\n\n1.  **数据模拟：** 我们将按规定生成四个不同的数据集。每个数据集包含 $ n=60 $ 个基因组窗口。对于每个窗口 $ i $，我们从指定的均匀分布中生成特征 $ A_{i1}, A_{i2} $ 和重组率 $ r_i $。少数窗口被指定为正选择的“候选”窗口；其余为“训练”窗口。然后使用给定的生成方程为每个窗口计算对数多样性 $ y_i $，其真实参数为 $ \\beta_1 = 0.8 $，$ \\beta_2 = 1.1 $，$ \\gamma = 0.7 $，噪声标准差 $ \\sigma = 0.12 $。截距 $ \\alpha $、候选窗口的选择效应 $ s_i $ 以及特定的参数覆盖对每个数据集都是唯一的。关键是，噪声 $ \\varepsilon_i $ 仅添加到训练窗口；对于候选窗口，$ \\varepsilon_i = 0 $ 以确保它们的属性完全由模型参数决定。\n\n2.  **模型拟合：** 对于每个数据集，我们仅使用训练窗口来拟合一个零模型。零模型假设没有正选择（$ s_i = 0 $），并采用多元线性回归的形式：\n    $$\n    y_i = \\beta'_0 + \\beta'_1 A_{i1} + \\beta'_2 A_{i2} + \\beta'_3 \\frac{1}{r_i} + \\varepsilon_i\n    $$\n    我们使用普通最小二乘法（OLS）来估计系数 $ \\hat{\\boldsymbol{\\beta}} = (\\hat{\\beta}'_0, \\hat{\\beta}'_1, \\hat{\\beta}'_2, \\hat{\\beta}'_3) $。这是通过求解正规方程实现的，使用数值稳定的线性代数求解器是合适的。训练集的设计矩阵 $ X_{train} $ 的列将对应于截距、$ A_{i1} $、$ A_{i2} $ 和 $ 1/r_i $。\n\n3.  **残差分析与分类：** 将模型拟合到训练数据后，我们为每个训练窗口 $ j $ 计算预测值 $ \\hat{y}_j $。从得到的残差 $ e_j = y_j - \\hat{y}_j $，我们估计误差项的标准差为 $ \\hat{\\sigma} = \\sqrt{\\frac{1}{n_{train}} \\sum_{j \\in train} e_j^2} $，其中 $ n_{train} $ 是训练窗口的数量。\n\n    接下来，对于每个候选窗口 $ i $（在拟合过程中被排除），我们使用估计的系数 $ \\hat{\\boldsymbol{\\beta}} $ 来预测其在零模型下的对数多样性：$ \\hat{y}_i = \\hat{\\beta}'_0 + \\hat{\\beta}'_1 A_{i1} + \\hat{\\beta}'_2 A_{i2} + \\hat{\\beta}'_3 \\frac{1}{r_i} $。然后我们计算标准化残差：\n    $$\n    z_i = \\frac{y_i - \\hat{y}_i}{\\hat{\\sigma}}\n    $$\n    这个 $ z_i $ 分数衡量了观察到的对数多样性 $ y_i $ 与我们的模型（该模型考虑了背景选择和种群历史）预测的值相差多少个标准差。一个大的负 $ z_i $ 分数表明多样性远低于预期。我们应用一个固定阈值：如果 $ z_i \\le -2.0 $，我们将窗口分类为“selected”（受选择）；否则，分类为“not selected”（未受选择）。\n\n对四个数据集中的每一个都重复此整个过程，并将所有 $ 2 \\times 4 = 8 $ 个候选窗口的布尔分类结果汇总到单个列表中作为最终输出。不同数据集间变化的参数旨在测试模型处理简单情况（数据集 $ 1 $）、背景选择的混淆因素（数据集 $ 2 $）、全基因组范围的种群效应（数据集 $ 3 $）以及混合场景（数据集 $ 4 $）的能力。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and evaluates a statistical model to disentangle background selection,\n    demographic history, and positive selection using simulated genomic data.\n    \"\"\"\n    \n    # Define the four test cases from the problem statement.\n    test_cases = [\n        {\n            \"seed\": 101,\n            \"alpha\": -6.0,\n            \"candidate_indices\": [5, 42],\n            \"selection_effects\": {5: 0.0, 42: 0.6},\n            \"recom_overrides\": {}\n        },\n        {\n            \"seed\": 202,\n            \"alpha\": -6.0,\n            \"candidate_indices\": [8, 15],\n            \"selection_effects\": {8: 0.0, 15: 0.0},\n            \"recom_overrides\": {8: 0.55, 15: 0.55}\n        },\n        {\n            \"seed\": 303,\n            \"alpha\": -6.7,\n            \"candidate_indices\": [2, 49],\n            \"selection_effects\": {2: 0.0, 49: 0.0},\n            \"recom_overrides\": {}\n        },\n        {\n            \"seed\": 404,\n            \"alpha\": -6.4,\n            \"candidate_indices\": [7, 33],\n            \"selection_effects\": {7: 0.6, 33: 0.0},\n            \"recom_overrides\": {}\n        }\n    ]\n\n    # Common settings for all datasets\n    n = 60  # Number of windows\n    K = 2   # Number of annotations\n    beta1_true = 0.8\n    beta2_true = 1.1\n    gamma_true = 0.7\n    sigma_true = 0.12\n    classification_threshold = -2.0\n\n    all_results = []\n\n    for case in test_cases:\n        seed = case[\"seed\"]\n        alpha = case[\"alpha\"]\n        candidate_indices = case[\"candidate_indices\"]\n        selection_effects = case[\"selection_effects\"]\n        recom_overrides = case[\"recom_overrides\"]\n        \n        # Initialize random number generator for reproducibility\n        rng = np.random.default_rng(seed)\n\n        # Generate features for all n windows\n        A1 = rng.uniform(0, 0.6, size=n)\n        A2 = rng.uniform(0, 0.3, size=n)\n        r = rng.uniform(0.6, 3.0, size=n)\n\n        # Apply overrides for candidate windows as specified\n        for idx, val in recom_overrides.items():\n            r[idx] = val\n\n        # Generate log-diversity (y_i) for all windows\n        y = np.zeros(n)\n        s = np.zeros(n)\n        \n        # Set selection effects for candidate windows\n        for idx, val in selection_effects.items():\n            s[idx] = val\n        \n        # Generate noise component (epsilon)\n        # Noise is zero for candidates, drawn from N(0, sigma^2) for training windows\n        epsilon = np.zeros(n)\n        training_indices = np.array([i for i in range(n) if i not in candidate_indices])\n        epsilon[training_indices] = rng.normal(0, sigma_true, size=len(training_indices))\n\n        # Calculate y_i using the generative model equation\n        y = alpha - beta1_true * A1 - beta2_true * A2 - gamma_true * (1 / r) - s + epsilon\n        \n        # -- Model Fitting and Prediction --\n        \n        # 1. Prepare training data\n        A1_train = A1[training_indices]\n        A2_train = A2[training_indices]\n        r_train = r[training_indices]\n        y_train = y[training_indices]\n        \n        # Construct the design matrix X for the training set\n        X_train = np.vstack([\n            np.ones(len(training_indices)), \n            A1_train, \n            A2_train, \n            1 / r_train\n        ]).T\n        \n        # 2. Fit the null model using Ordinary Least Squares (OLS)\n        # np.linalg.lstsq is a numerically stable solver\n        coeffs, _, _, _ = np.linalg.lstsq(X_train, y_train, rcond=None)\n        \n        # 3. Estimate residual standard deviation (sigma_hat) from the training data\n        y_train_pred = X_train @ coeffs\n        residuals_train = y_train - y_train_pred\n        # As per problem, use mean squared residual, not unbiased sample variance\n        sigma_hat = np.sqrt(np.mean(residuals_train**2))\n        \n        # 4. Classify candidate windows\n        # Sort candidate indices to ensure ordered output\n        sorted_candidate_indices = sorted(candidate_indices)\n        for idx in sorted_candidate_indices:\n            # Get observed y for the candidate window\n            y_cand = y[idx]\n            \n            # Construct design vector for the candidate window\n            X_cand = np.array([1, A1[idx], A2[idx], 1 / r[idx]])\n            \n            # Predict y under the null model\n            y_cand_pred = X_cand @ coeffs\n            \n            # Compute the standardized residual (z-score)\n            z_score = (y_cand - y_cand_pred) / sigma_hat\n            \n            # Classify based on the threshold\n            is_selected = z_score = classification_threshold\n            all_results.append(is_selected)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "2711019"}]}