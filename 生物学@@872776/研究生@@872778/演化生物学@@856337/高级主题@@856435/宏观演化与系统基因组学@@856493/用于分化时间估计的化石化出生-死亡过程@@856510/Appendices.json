{"hands_on_practices": [{"introduction": "这个首要练习旨在建立化石化生死（FBD）模型中的一个基本关系。我们将练习计算预期的化石数量，这个数量直接取决于总的谱系时长和化石采样率 $\\psi$。这项实践 [@problem_id:2714602] 为理解模型如何将系统发育树结构与化石记录联系起来提供了关键的第一步，并强调了在特定条件下识别相关参数的重要性。", "problem": "一个演化支在化石化生死（Fossilized Birth-Death, FBD）过程下演化，其谱系分化速率为$\\lambda$，绝灭速率为$\\mu$，化石采样速率为$\\psi$（在时间上是均匀的），现存谱系的现代采样概率为$\\rho$。沿谱系的化石采样事件遵循连续时间内的均匀泊松点过程，每个谱系的瞬时速率为$\\psi$。考虑该演化支的一个已实现的多样化历史，已知其累积谱系持续时间（该演化支中所有曾存在过的谱系的持续时间之和，每个谱系的存在时间只计算一次）为$T=100$ Myr。参数为$(\\lambda,\\mu,\\psi,\\rho)=(0.3,0.2,0.05,0.8)$，其中速率的单位均为$\\text{Myr}^{-1}$，$\\rho$为无量纲。假设沿谱系发生的每一次化石采样事件都被记录和计数，包括在不同时间对同一谱系的多次采样。\n\n仅使用均匀泊松过程的基本性质和期望的线性性，计算在该演化支中，以$T$为条件的化石样本的期望数量。将最终答案表示为一个精确的数字（无需四舍五入），并且不要在最终答案框中包含单位。", "solution": "在尝试任何解答之前，对问题陈述进行严格验证。\n\n### 步骤 1：提取已知条件\n问题陈述中明确给出的已知条件是：\n- **模型**：化石化生死（FBD）过程。\n- **每个谱系的分化速率**：$\\lambda = 0.3 \\, \\text{Myr}^{-1}$。\n- **每个谱系的绝灭速率**：$\\mu = 0.2 \\, \\text{Myr}^{-1}$。\n- **每个谱系的化石采样速率**：$\\psi = 0.05 \\, \\text{Myr}^{-1}$。\n- **现代采样概率**：$\\rho = 0.8$。\n- **已实现的累积谱系持续时间**：$T = 100 \\, \\text{Myr}$。\n- **化石采样机制**：沿每个谱系的均匀泊松点过程，瞬时速率为$\\psi$。\n- **方法限制**：解答必须仅使用均匀泊松过程的基本性质和期望的线性性。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据所需标准对问题进行评估。\n1.  **科学依据**：化石化生死过程是现代古生物学和宏观演化中用于系统发育推断和分化时间估计的基石模型。该模型的参数和化石采样过程的描述都是标准的。该问题在科学上是合理的。\n2.  **良态性与完整性**：该问题要求计算一个条件期望 $E[N_f | T]$，其中 $N_f$ 是化石总数，$T$ 是总谱系持续时间。回答此特定问题所需的所有参数都已提供。虽然给出了额外的参数（$\\lambda, \\mu, \\rho$），但必须确定它们的相关性。它们的存在并未使问题不完整或矛盾；它考验的是从无关信息中辨别必要信息的能力。该问题是良态的。\n3.  **客观性**：问题以精确、定量的术语陈述，没有主观或模糊的语言。\n\n### 步骤 3：结论与行动\n问题被判定为**有效**。这是一个形式良好的问题，需要将随机过程的基本理论应用于一个标准的演化模型。开始解答。\n\n目标是计算一个演化支的化石样本的期望数量，记为 $N_f$，条件是已知的累积谱系持续时间为 $T = 100 \\, \\text{Myr}$。\n\n设该演化支已实现的多样化历史由一组谱系 $\\mathcal{L} = \\{L_1, L_2, \\dots, L_M\\}$ 表示，其中 $M$ 是曾存在过的谱系总数。设 $t_i$ 是谱系 $L_i$ 的时间持续长度。累积谱系持续时间 $T$ 是这些单个持续时间之和：\n$$T = \\sum_{i=1}^{M} t_i$$\n我们给定的条件是 $T = 100 \\, \\text{Myr}$。\n\n问题陈述，沿任何单个谱系 $L_i$ 的化石采样遵循一个速率恒为 $\\psi$ 的均匀泊松过程。在一个持续时间为 $t_i$ 的区间上，速率为 $\\psi$ 的均匀泊松过程的一个基本性质是，事件（在此情况下为化石样本）的期望数量是速率与持续时间的乘积。设 $N_i$ 是从谱系 $L_i$ 中采样的化石数量。$N_i$ 的期望值为：\n$$E[N_i] = \\psi t_i$$\n\n整个演化支的化石样本总数 $N_f$ 是所有单个谱系的化石数量之和：\n$$N_f = \\sum_{i=1}^{M} N_i$$\n\n我们被要求计算在总谱系持续时间 $T$ 条件下 $N_f$ 的期望值。设具体的已实现历史（即，谱系及其持续时间的完整集合 $\\{t_i\\}$）表示为 $\\mathcal{H}$。总谱系持续时间是该历史的函数，$T(\\mathcal{H}) = \\sum_i t_i$。我们希望计算 $E[N_f | T(\\mathcal{H}) = T]$。\n\n我们可以使用全期望定律（或迭代期望）。在 $T$ 值条件下 $N_f$ 的期望，是给定完整历史 $\\mathcal{H}$ 后 $N_f$ 的条件期望，在所有满足条件 $T(\\mathcal{H})=T$ 的可能历史 $\\mathcal{H}$ 上的期望：\n$$E[N_f | T(\\mathcal{H}) = T] = E\\left[ E[N_f | \\mathcal{H}] \\Big| \\, T(\\mathcal{H}) = T \\right]$$\n\n首先，我们计算内层期望 $E[N_f | \\mathcal{H}]$。给定一个具体的历史 $\\mathcal{H}$，持续时间 $\\{t_i\\}$ 是固定的。代表每个谱系上化石计数的随机变量 $N_i$ 是独立的。根据期望的线性性，化石总数的期望是各个期望之和：\n$$E[N_f | \\mathcal{H}] = E\\left[\\sum_{i=1}^{M} N_i \\Bigg| \\{t_i\\}_{i=1}^M \\right] = \\sum_{i=1}^{M} E[N_i | t_i]$$\n代入 $E[N_i | t_i] = \\psi t_i$，我们得到：\n$$E[N_f | \\mathcal{H}] = \\sum_{i=1}^{M} (\\psi t_i)$$\n由于 $\\psi$ 是一个常数，我们可以将其从求和中提出来：\n$$E[N_f | \\mathcal{H}] = \\psi \\left(\\sum_{i=1}^{M} t_i\\right) = \\psi T(\\mathcal{H})$$\n这个结果表明，对于任何具体的已实现历史 $\\mathcal{H}$，化石的期望数量仅取决于与之相关的总谱系持续时间 $T(\\mathcal{H})$。\n\n现在我们评估外层期望，其条件是 $T(\\mathcal{H})$ 固定为给定值 $T$：\n$$E[N_f | T(\\mathcal{H}) = T] = E[\\psi T(\\mathcal{H}) | T(\\mathcal{H}) = T]$$\n在条件 $T(\\mathcal{H}) = T$ 下，表达式 $\\psi T(\\mathcal{H})$ 变为常数 $\\psi T$。一个常数的期望就是它本身。因此：\n$$E[N_f | T(\\mathcalH}) = T] = \\psi T$$\n\n这个结果仅使用期望的线性和泊松过程的基本性质推导得出，符合要求。参数 $\\lambda$（分化速率）、$\\mu$（绝灭速率）和 $\\rho$（现代采样概率）与此计算无关。这些参数决定了随机变量 $T(\\mathcal{H})$ 的概率分布，但由于我们是基于 $T$ 的一个特定值进行条件化，因此我们不需要知道这个分布。参数 $\\rho$ 涉及在现代对现存谱系的采样，这与贯穿所有谱系历史的化石化过程是分开的。\n\n问题提供了必要的值：\n- 化石采样速率：$\\psi = 0.05 \\, \\text{Myr}^{-1}$\n- 累积谱系持续时间：$T = 100 \\, \\text{Myr}$\n\n将这些值代入我们推导出的表达式中：\n$$E[N_f] = \\psi T = (0.05 \\, \\text{Myr}^{-1}) \\times (100 \\, \\text{Myr}) = 5$$\n化石样本的期望数量为 $5$。", "answer": "$$\\boxed{5}$$", "id": "2714602"}, {"introduction": "掌握了基本计算后，我们转向一个更复杂的概念性挑战：模型设定错误的后果。这个思想实验 [@problem_id:2714616] 要求我们从第一性原理出发，推理当一个关键参数——现存物种采样比例 $\\rho$ ——被错误地假定时，所产生的连锁性偏差。培养这种关于参数间相互作用的定性推理能力，对于解释实证研究结果和设计稳健的分析至关重要。", "problem": "一位研究人员使用恒定速率的化石化生死（FBD）过程分析一个支系，该过程的参数包括物种形成速率 $\\lambda$、灭绝速率 $\\mu$、化石取样速率 $\\psi$ 和现存物种取样比例 $\\rho$。经验数据集包含 $n$ 个现存的末端枝和 $F$ 个化石出现事件，而外部知识表明，只有一部分比例为 $\\rho^{\\star} \\in (0,1)$ 的现存物种被取样（即，现存物种的取样是不完整的）。然而，在FBD分析中，该研究人员错误地将 $\\rho$ 固定为1，并使用（除此之外）离散先验从数据中估计参数 $(\\lambda,\\mu,\\psi)$ 和分歧时间。\n\n请根据生死取样过程的第一性原理，且不借助任何捷径公式，确定这种错误设定在 (i) 推断的分歧时间、(ii) 推断的化石取样速率 $\\psi$ 和 (iii) 推断的周转率或相对灭绝率（例如，比率 $\\mu/\\lambda$）中引入的偏差最可能朝哪个方向发展。假设化石出现过程被正确地建模为沿着谱系速率为 $\\psi$ 的泊松过程，并且该支系是超临界的，即 $\\lambda\\mu$。\n\n当真实情况为 $\\rho^{\\star}  1$ 时，在错误设定假设 $\\rho=1$ 下，哪个选项最能描述预期的联合偏差模式？\n\nA. 分歧时间偏向更年轻；$\\psi$ 偏高；周转率（例如 $\\mu/\\lambda$）偏高。\n\nB. 分歧时间偏向更古老；$\\psi$ 偏低；周转率偏低。\n\nC. 分歧时间大致无偏；只有多样化速率有偏差，其中 $\\lambda$ 被高估，$\\mu$ 被低估。\n\nD. 主要偏差出现在形态钟速率上，而FBD参数和分歧时间保持大致无偏。", "solution": "在进行解答之前，对问题陈述进行验证。\n\n### 第1步：提取已知条件\n-   **模型：** 恒定速率的化石化生死（FBD）过程。\n-   **参数：** 物种形成速率 $\\lambda$，灭绝速率 $\\mu$，化石取样速率 $\\psi$，现存物种取样比例 $\\rho$。\n-   **真实条件：** 真实的现存物种取样比例为 $\\rho^{\\star} \\in (0,1)$。\n-   **模型错误设定：** 分析是在一个固定的、不正确的假设 $\\rho=1$ 下进行的。\n-   **数据：** 一个包含 $n$ 个现存末端枝和 $F$ 个化石出现事件的经验数据集。\n-   **推断：** 使用离散先验估计参数 $(\\lambda, \\mu, \\psi)$ 和分歧时间。\n-   **假设：** 化石出现过程是速率为 $\\psi$ 的泊松过程。该支系是超临界的，意味着 $\\lambda  \\mu$。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，因为化石化生死过程是现代分歧时间估计的基石。该问题探讨了模型错误设定的后果，这是统计科学中一个关键且现实的主题。所列出的参数和假设是此类模型的标准配置。该问题定义明确、客观，并包含足够的信息，可以基于原理定性地推导出参数偏差的方向。这个问题并非无足轻重，因为参数间的相互作用是复杂的。该问题可以通过对似然函数的数学分析和模拟研究进行形式化和验证。\n\n### 第3步：结论和行动\n问题陈述是**有效的**。将从第一性原理推导出解决方案。\n\n### 偏差的推导\n\n问题的核心是现存物种取样比例 $\\rho$ 的错误设定。研究人员假设完全取样（$\\rho=1$），而真实的数据生成过程涉及不完全取样（$\\rho=\\rho^{\\star}  1$）。FBD模型试图在这个错误的假设下，找到能够最好地解释所观察到的、包含 $n$ 个现存末端枝和 $F$ 个化石的重建树的参数 $(\\lambda, \\mu, \\psi)$ 和时间尺度。我们分析由此在推断的分歧时间、化石取样速率 $\\psi$ 和周转率 $\\mu/\\lambda$ 中产生的偏差。\n\n**(iii) 周转率（$\\mu/\\lambda$）的偏差**\n\n假设 $\\rho=1$ 的最直接后果是对未被取样的现存谱系的错误解释。真实的进化过程产生了一定总数的存活物种，比如说 $N_{extant}$ 个，其中只有 $n = \\rho^{\\star} N_{extant}$ 个被取样并包含在系统发育树中。剩下的 $(1-\\rho^{\\star})N_{extant}$ 个存活物种在数据中是缺失的。\n\n从错误设定的模型（其假设所有存活者都被包含在内，即 $\\rho=1$）的角度来看，任何不通向 $n$ 个观察到的末端枝之一的谱系都必定已经灭绝。因此，该模型将大量未被取样的现存谱系误认为是真正在现代之前就已经灭绝的谱系。这导致对灭绝事件数量的严重高估。为了解释这种表观上的高灭绝水平，模型将推断出远高于真实速率的灭绝速率 $\\mu$。虽然物种形成速率 $\\lambda$ 也受到影响，但主要且最强的影响是对灭绝速率的人为夸大。因此，灭绝与物种形成之比，即周转率 $\\mu/\\lambda$，被严重高估。推断的周转率**偏高**。\n\n**(i) 分歧时间的偏差**\n\n$\\rho$ 的错误设定也影响了系统发育树的感知结构。对末端枝的不完全随机取样会优先移除位于短的、近期衍生分支上的物种。对真实系统发育树的这种“修剪”留下了一个重建的树，这个树更为稀疏，尤其是在接近现代的时期，并且其中存活的内部分支显得被人为地拉长了。\n\nFBD模型必须解释这些长分支。一个谱系在时间 $T$ 内持续存在而不发生物种形成的似然与 $e^{-\\lambda T}$ 有关。一方面，模型推断出高的灭绝速率 $\\mu$（如上所述）。为了补偿并确保任何谱系都能存活到现代，模型也必须推断出相应高的物种形成速率 $\\lambda$。\n\n现在模型面临一个矛盾：它推断出了一个高的物种形成速率 $\\hat{\\lambda}$，这意味着长分支应该很少见，但它正在分析的树由于取样偏差而包含了被人为拉长的分支。在一个高的物种形成速率 $\\hat{\\lambda}$ 下，观察到一个持续时间为 $T$ 的长分支的概率是极低的。为了调和推断出的高物种形成速率与观察到的长分支，模型唯一的办法就是减少这些分支的推断持续时间 $T$。这种效应系统地应用于树中的所有分支，导致整个系统发育树在时间上被压缩。结果是，推断的分歧时间，包括支系的起源时间，都**偏向更年轻**（即，更接近现代）。\n\n**(ii) 化石取样速率（$\\psi$）的偏差**\n\n推断的化石取样速率 $\\psi$ 是每个谱系每单位时间的化石发现速率。化石总数 $F$ 是一个固定的数据。模型必须解释这 $F$ 个化石在重建树上的出现。化石化的总机会是树中所有分支的总长度在时间上的积分（即总谱系时长）。\n\n如上所述，推断的分歧时间偏向更年轻。这意味着整个树，从其起源到现代，都被压缩到一个更短的时间间隔内。这种压缩减少了树的总谱系时长。为了在一个被压缩的、提供更少累积时间来发现化石的树中解释观察到的化石数量 $F$，每单位时间的化石化速率 $\\psi$ 必须更高。模型通过推断一个更高的化石取样速率来补偿缩短的时间尺度。因此，推断的化石取样速率 $\\psi$ **偏高**。\n\n总结来说，联合偏差模式是：\n-   (i) 分歧时间偏向**更年轻**。\n-   (ii) 化石取样速率 $\\psi$ **偏高**。\n-   (iii) 周转率 $\\mu/\\lambda$ **偏高**。\n\n### 逐项分析\n\n**A. 分歧时间偏向更年轻；$\\psi$ 偏高；周转率（例如 $\\mu/\\lambda$）偏高。**\n这个选项与我们对所有三个部分的推导结论相符。\n-   分歧时间偏向更年轻：**正确**。\n-   $\\psi$ 偏高：**正确**。\n-   周转率偏高：**正确**。\n因此，这个选项是**正确的**。\n\n**B. 分歧时间偏向更古老；$\\psi$ 偏低；周转率偏低。**\n这个选项在所有三点上都与我们的发现相矛盾。\n-   分歧时间偏向更古老：**不正确**。偏差是朝向更年轻的年代。\n-   $\\psi$ 偏低：**不正确**。偏差是偏高。\n-   周转率偏低：**不正确**。偏差是偏高。\n因此，这个选项是**不正确的**。\n\n**C. 分歧时间大致无偏；只有多样化速率有偏差，其中 $\\lambda$ 被高估，$\\mu$ 被低估。**\n这个选项因多种原因而不正确。\n-   分歧时间是有偏差的，而不是大致无偏。\n-   虽然 $\\lambda$ 确实被高估，但 $\\mu$ 是被严重高估，而不是低估。\n因此，这个选项是**不正确的**。\n\n**D. 主要偏差出现在形态钟速率上，而FBD参数和分歧时间保持大致无偏。**\n这个选项引入了“形态钟速率”的概念，但这并不是问题陈述的一部分。问题严格地是关于FBD过程的参数（$\\lambda, \\mu, \\psi, \\rho$）和分歧时间。事实上，FBD参数和时间都存在严重的偏差。\n因此，这个选项是无关且**不正确的**。", "answer": "$$\\boxed{A}$$", "id": "2714616"}, {"introduction": "为了巩固我们对偏差的概念性理解，现在我们将通过模拟来定量地验证这些效应。这个编程练习 [@problem_id:2714621] 演示了如何构建一个简化的FBD模拟，以精确测量错误设定化石采样率 $\\psi$ 对分化时间估计的影响。这种实践应用弥合了理论推理与具体数据分析之间的鸿沟，使您具备亲自检验模型假设的技能。", "problem": "考虑一个化石化生灭过程（Fossilized Birth-Death (FBD)），在该过程的零滅绝简化下，每个谱系以每个谱系单位时间的恒定速率进行物种形成，并且沿着其时间范围，通过一个具有恒定化石采样速率的齐次泊松过程对其化石出现进行独立抽样。假设以下建模基础。\n\n- 物种形成被建模为一个尤尔过程：在任何时间，如果存在 $n(t)$ 个谱系，下一个物种形成事件将在一个指数等待时间后发生，其速率参数为 $\\lambda n(t)$，其中 $\\lambda$ 是每个谱系单位时间的物种形成速率。在此简化中，灭绝不存在。\n- 每个谱系上的化石出现遵循一个齐次泊松过程，其化石采样速率为 $\\psi$ 每个谱系单位时间。\n- 对于一个起源（根）年龄为 $T$（单位：百万年，Myr）的树，令 $L(T)$ 表示暴露于化石化的总谱系时长，等于从根（时间0）到现今（时间$T$）的区间上 $n(t)$ 的积分。如果 $L_0$ 表示在长度为 $1$ 的单位区间上相同树形的总谱系时长（即，在重标定所有时间以使根年龄等于 $1$ 之后），则 $L(T) = T \\, L_0$。\n\n在这个受控模拟中，您将为每次重复实验生成一个单位区间上的尤尔树形，使用物种形成速率 $\\lambda_{\\mathrm{unit}}$（每个谱系单位时间），计算相应的单位区间总谱系时长 $L_0$，然后模拟一个化石计数 $K$ 作为泊松随机变量，其均值为 $\\psi_{\\mathrm{true}} \\, T_{\\mathrm{true}} \\, L_0$，其中 $\\psi_{\\mathrm{true}}$ 是每个谱系每百万年的真实化石采样速率，而 $T_{\\mathrm{true}}$ 是真实的起源时间（根年龄），单位为百万年。\n\n您的任务是，当化石采样速率假定为 $\\psi_{\\mathrm{assumed}}$ 时，实现以下从单次重复实验中估计起源时间 $T$ 的估计量：\n- 将化石计数 $K$ 视为在总谱系时长 $L(T)$ 上以速率 $\\psi_{\\mathrm{assumed}}$ 发生的齐次泊松过程的结果。推导并实现 $T$ 的最大似然估计量 $\\widehat{T}$，用在此假设下获得的 $K$、$\\psi_{\\mathrm{assumed}}$ 和 $L_0$ 表示。然后计算无量纲偏差比 $r = \\widehat{T} / T_{\\mathrm{true}}$。\n\n您必须编写一个程序，该程序：\n- 每个测试用例模拟 $R$ 次独立重复实验。\n- 对于每次重复实验，在单位区间 $[0,1]$ 上模拟一个物种形成速率为 $\\lambda_{\\mathrm{unit}}$ 的尤尔树，计算 $L_0$ 作为 $[0,1]$ 上谱系数量随时间的积分，然后模拟 $K \\sim \\mathrm{Poisson}(\\psi_{\\mathrm{true}} \\, T_{\\mathrm{true}} \\, L_0)$。\n- 对于每次重复实验，计算三个偏差比 $r_{\\mathrm{correct}}$、$r_{\\mathrm{half}}$ 和 $r_{\\mathrm{double}}$，分别对应于 $\\psi_{\\mathrm{assumed}} = \\psi_{\\mathrm{true}}$、$\\psi_{\\mathrm{assumed}} = \\tfrac{1}{2} \\psi_{\\mathrm{true}}$ 和 $\\psi_{\\mathrm{assumed}} = 2 \\psi_{\\mathrm{true}}$。\n- 对于每个测试用例，报告 $R$ 次重复实验中每个比率的重复实验平均值，每个比率四舍五入到 $6$ 位小数。\n\n单位和约定：\n- 真实起源时间 $T_{\\mathrm{true}}$ 必须以百万年（Myr）为单位进行解释。\n- 化石采样速率 $\\psi_{\\mathrm{true}}$ 的单位是每个谱系每百万年。\n- 单位区间上的物种形成速率 $\\lambda_{\\mathrm{unit}}$ 的单位是每个谱系在 $[0,1]$ 上的单位时间。\n- 最终输出是无量纲的比率。不要在输出中包含单位。\n\n单位区间上的尤尔模拟：\n- 从时间 $t = 0$ 开始，有 $n = 1$ 个谱系。\n- 当 $t  1$ 时，抽取一个等待时间 $\\Delta \\sim \\mathrm{Exponential}(\\lambda_{\\mathrm{unit}} \\, n)$。\n- 如果 $t + \\Delta \\geq 1$，将 $n \\cdot (1 - t)$ 累加到 $L_0$ 中并终止；否则，将 $n \\cdot \\Delta$ 累加到 $L_0$ 中，更新 $t \\leftarrow t + \\Delta$ 和 $n \\leftarrow n + 1$，并重复。\n\n测试套件：\n- 您必须在以下三个测试用例上评估程序。为保证可复现性，请使用提供的种子。\n    1. 情况 A（理想情况，中等计数）：$\\lambda_{\\mathrm{unit}} = 1.0$， $T_{\\mathrm{true}} = 50$ Myr，$\\psi_{\\mathrm{true}} = 0.02$ 每个谱系每百万年，$R = 200$，种子 $= 12345$。\n    2. 情况 B（边缘情况，非常稀疏的化石）：$\\lambda_{\\mathrm{unit}} = 0.5$， $T_{\\mathrm{true}} = 5$ Myr，$\\psi_{\\mathrm{true}} = 0.005$ 每个谱系每百万年，$R = 300$，种子 $= 24680$。\n    3. 情况 C（压力情况，密集的化石）：$\\lambda_{\\mathrm{unit}} = 1.5$，$T_{\\mathrm{true}} = 200$ Myr，$\\psi_{\\mathrm{true}} = 0.05$ 每个谱系每百万年，$R = 150$，种子 $= 13579$。\n\n要求的最终输出格式：\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。该列表必须按顺序包含情况 A、然后情况 B、然后情况 C 的结果，每个情况的三个重复实验平均比率 $[r_{\\mathrm{correct}}, r_{\\mathrm{half}}, r_{\\mathrm{double}}]$ 被扁平化为单个列表。例如，总输出格式必须为：\n- $\\left[\\text{A}_{\\mathrm{correct}}, \\text{A}_{\\mathrm{half}}, \\text{A}_{\\mathrm{double}}, \\text{B}_{\\mathrm{correct}}, \\text{B}_{\\mathrm{half}}, \\text{B}_{\\mathrm{double}}, \\text{C}_{\\mathrm{correct}}, \\text{C}_{\\mathrm{half}}, \\text{C}_{\\mathrm{double}}\\right]$，\n- 其中每个条目都是一个四舍五入到 $6$ 位小数的浮点数。", "solution": "该问题要求在一个简化的化石化生死模型下，推导系统发育起源时间的最大似然估计量，并通过模拟评估其偏差。问题陈述在科学上植根于演化生物学领域，特别是系统发育定年方法，并为计算实验提供了一套定义明确、客观且完整的指令。因此，该问题被认为是有效的。我们将继续进行推导和求解。\n\n首先，我们必须推导起源时间的最大似然估计量（MLE），我们将其表示为 $T$。问题陈述指出，为了进行估计，我们应将观测到的化石计数 $K$ 视为从泊松分布中抽取的随机变量。此泊松过程的速率是假设的化石采样速率 $\\psi_{\\mathrm{assumed}}$ 与总谱系时长 $L(T)$ 的乘积。总谱系时长是谱系数量随时间的积分，从时间 $0$ 的起源到时间 $T$ 的现在。\n\n泊松分布的速率，即其均值，为 $\\Lambda(T) = \\psi_{\\mathrm{assumed}} L(T)$。问题提供了长度为 $T$ 的区间上的总谱系时长（表示为 $L(T)$）与单位区间上的总谱系时长 $L_0$ 之间的标度关系。该关系为 $L(T) = T L_0$。尽管所述标度律的物理量纲值得商榷——如果 $T$ 的单位是时间，而 $L(T)$ 的单位是谱系-时间，那么 $L_0$ 的单位必须是谱系，这可解释为单位区间上的平均谱系数量——但其数学形式是明确的。我们严格遵循所提供的公式进行推导。\n\n将标度关系代入泊松均值的表达式中，得到：\n$$\n\\Lambda(T) = \\psi_{\\mathrm{assumed}} T L_0\n$$\n对于给定的起源时间 $T$，观测到化石计数 $K$ 的似然由泊松概率质量函数描述：\n$$\n\\mathcal{L}(T | K, \\psi_{\\mathrm{assumed}}, L_0) = \\frac{e^{-\\Lambda(T)} (\\Lambda(T))^K}{K!} = \\frac{e^{-\\psi_{\\mathrm{assumed}} T L_0} (\\psi_{\\mathrm{assumed}} T L_0)^K}{K!}\n$$\n为了找到 MLE $\\widehat{T}$，我们关于 $T$ 最大化此函数。在计算上，最大化对数似然函数 $\\ell(T) = \\ln \\mathcal{L}(T)$ 更简单且等价：\n$$\n\\ell(T) = -\\psi_{\\mathrm{assumed}} T L_0 + K \\ln(\\psi_{\\mathrm{assumed}} T L_0) - \\ln(K!)\n$$\n我们通过对 $\\ell(T)$ 关于 $T$ 求导并令其为零来找到最大值。注意，$K$、$\\psi_{\\mathrm{assumed}}$ 和 $L_0$ 被视为已知量。\n$$\n\\frac{d\\ell}{dT} = \\frac{d}{dT} \\left( -\\psi_{\\mathrm{assumed}} L_0 T + K \\ln(T) + K\\ln(\\psi_{\\mathrm{assumed}} L_0) - \\ln(K!) \\right)\n$$\n$$\n\\frac{d\\ell}{dT} = -\\psi_{\\mathrm{assumed}} L_0 + \\frac{K}{T}\n$$\n将导数设为零以找到估计量 $\\widehat{T}$：\n$$\n-\\psi_{\\mathrm{assumed}} L_0 + \\frac{K}{\\widehat{T}} = 0 \\implies \\frac{K}{\\widehat{T}} = \\psi_{\\mathrm{assumed}} L_0\n$$\n解出 $\\widehat{T}$，我们得到最大似然估计量：\n$$\n\\widehat{T} = \\frac{K}{\\psi_{\\mathrm{assumed}} L_0}\n$$\n此估计量在 $\\psi_{\\mathrm{assumed}} L_0 > 0$ 的条件下有效。由于谱系数量 $n \\ge 1$，所以 $L_0 = \\int_0^1 n(t) dt > 0$。假设的速率 $\\psi_{\\mathrm{assumed}}$ 也为正，因此分母非零。\n\n任务的核心是执行蒙特卡洛模拟。对于测试用例中的 $R$ 次重复实验，我们执行两个步骤：\n1.  数据生成：我们根据“真实”模型模拟数据。首先，我们在单位时间区间 $[0, 1]$ 上用给定的物种形成速率 $\\lambda_{\\mathrm{unit}}$ 模拟一个纯生（尤尔）过程的实现，以计算单位区间的总谱系时长 $L_0$。模拟从 $t=0$ 时的 $n=1$ 个谱系开始，并在指数等待时间 $\\Delta \\sim \\mathrm{Exponential}(\\lambda_{\\mathrm{unit}} n)$ 后迭代地增加谱系，直到 $t=1$。$L_0$ 的值是谱系数量与其存在时长的乘积之和，即 $L_0 = \\sum_i n_i \\Delta t_i$。获得 $L_0$ 的值后，我们从一个泊松分布中模拟化石计数 $K$，其均值由真实参数给出：$K \\sim \\mathrm{Poisson}(\\psi_{\\mathrm{true}} T_{\\mathrm{true}} L_0)$。\n2.  估计与偏差计算：使用模拟出的 $K$ 和 $L_0$，我们针对三种不同假设的化石采样速率情景（$\\psi_{\\mathrm{assumed}} = \\psi_{\\mathrm{true}}$、$\\psi_{\\mathrm{assumed}} = \\frac{1}{2}\\psi_{\\mathrm{true}}$ 和 $\\psi_{\\mathrm{assumed}} = 2\\psi_{\\mathrm{true}}$），使用推导出的 MLE 公式计算我们的估计值 $\\widehat{T}$。对于每个估计值，我们计算无量纲偏差比 $r = \\widehat{T} / T_{\\mathrm{true}}$。\n\n每个测试用例的最终输出是这三个比率（$r_{\\mathrm{correct}}$、$r_{\\mathrm{half}}$、$r_{\\mathrm{double}}$）在所有 $R$ 次重复实验中的平均值。\n\n计算偏差比 $r$ 的理论期望值是有益的。使用全期望定律：\n$$\nE[r] = E\\left[\\frac{\\widehat{T}}{T_{\\mathrm{true}}}\\right] = E\\left[ \\frac{K/(\\psi_{\\mathrm{assumed}} L_0)}{T_{\\mathrm{true}}} \\right] = \\frac{1}{\\psi_{\\mathrm{assumed}} T_{\\mathrm{true}}} E\\left[ \\frac{K}{L_0} \\right]\n$$\n$$\nE\\left[ \\frac{K}{L_0} \\right] = E_{L_0}\\left[ E_K\\left[ \\frac{K}{L_0} \\middle| L_0 \\right] \\right] = E_{L_0}\\left[ \\frac{E_K[K|L_0]}{L_0} \\right]\n$$\n由于 $E_K[K|L_0] = \\psi_{\\mathrm{true}} T_{\\mathrm{true}} L_0$，我们有：\n$$\nE_{L_0}\\left[ \\frac{\\psi_{\\mathrm{true}} T_{\\mathrm{true}} L_0}{L_0} \\right] = E_{L_0}[\\psi_{\\mathrm{true}} T_{\\mathrm{true}}] = \\psi_{\\mathrm{true}} T_{\\mathrm{true}}\n$$\n将其代回，我们发现：\n$$\nE[r] = \\frac{1}{\\psi_{\\mathrm{assumed}} T_{\\mathrm{true}}} (\\psi_{\\mathrm{true}} T_{\\mathrm{true}}) = \\frac{\\psi_{\\mathrm{true}}}{\\psi_{\\mathrm{assumed}}}\n$$\n这个结果预测，模拟的平均值应该接近 $1.0$（对于 $r_{\\mathrm{correct}}$）、$2.0$（对于 $r_{\\mathrm{half}}$）和 $0.5$（对于 $r_{\\mathrm{double}}$），而与其他参数无关。这可以作为我们模拟逻辑的一个强有力的检验。实现将精确遵循此推导逻辑。", "answer": "```python\nimport numpy as np\n\ndef simulate_replicate(lambda_unit, T_true, psi_true, rng):\n    \"\"\"\n    Simulates one replicate of the FBD process to compute bias ratios.\n\n    Args:\n        lambda_unit (float): Speciation rate on the unit interval.\n        T_true (float): True origin time in Myr.\n        psi_true (float): True fossil sampling rate per lineage per Myr.\n        rng (numpy.random.Generator): Random number generator instance.\n\n    Returns:\n        tuple: A tuple containing the three bias ratios (r_correct, r_half, r_double).\n    \"\"\"\n    # Step 1: Simulate a Yule tree on the unit interval [0,1] to get L0.\n    L0 = 0.0\n    t = 0.0\n    n = 1\n    while t  1.0:\n        rate = lambda_unit * n\n        if rate = 0:\n            delta_t = np.inf\n        else:\n            delta_t = rng.exponential(1.0 / rate)\n\n        if t + delta_t >= 1.0:\n            L0 += n * (1.0 - t)\n            break\n        else:\n            L0 += n * delta_t\n            t += delta_t\n            n += 1\n\n    # Step 2: Simulate fossil count K using true parameters.\n    true_poisson_mean = psi_true * T_true * L0\n    K = rng.poisson(true_poisson_mean)\n\n    # Step 3: Compute the MLE of T for three assumed psi values.\n    if L0 = 0:\n        T_hat_correct, T_hat_half, T_hat_double = 0.0, 0.0, 0.0\n    else:\n        # Scenario 1: Correct psi\n        psi_assumed_correct = psi_true\n        T_hat_correct = K / (psi_assumed_correct * L0)\n\n        # Scenario 2: Half psi\n        psi_assumed_half = 0.5 * psi_true\n        T_hat_half = K / (psi_assumed_half * L0)\n\n        # Scenario 3: Double psi\n        psi_assumed_double = 2.0 * psi_true\n        T_hat_double = K / (psi_assumed_double * L0)\n\n    # Step 4: Compute the dimensionless bias ratios r = T_hat / T_true.\n    r_correct = T_hat_correct / T_true\n    r_half = T_hat_half / T_true\n    r_double = T_hat_double / T_true\n\n    return r_correct, r_half, r_double\n\ndef solve():\n    \"\"\"\n    Main function to run simulations for all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (lambda_unit, T_true, psi_true, R, seed)\n        (1.0, 50.0, 0.02, 200, 12345),   # Case A\n        (0.5, 5.0, 0.005, 300, 24680),  # Case B\n        (1.5, 200.0, 0.05, 150, 13579),  # Case C\n    ]\n\n    all_results = []\n    for lambda_unit, T_true, psi_true, R, seed in test_cases:\n        rng = np.random.default_rng(seed)\n        \n        replicate_ratios = np.array([\n            simulate_replicate(lambda_unit, T_true, psi_true, rng) for _ in range(R)\n        ])\n        \n        # Calculate the average of each ratio over the R replicates.\n        avg_ratios = np.mean(replicate_ratios, axis=0)\n        \n        all_results.extend(avg_ratios)\n\n    # Format the final output string as required.\n    formatted_results = [f\"{res:.6f}\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2714621"}]}