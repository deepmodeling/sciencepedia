{"hands_on_practices": [{"introduction": "理解新突变的适应性效应分布（Distribution of Fitness Effects, DFE）是进化生物学的核心议题。本次实践将引导你推导这一分布的两个最基本的统计量：在费雪几何模型（Fisher's Geometric Model, FGM）框架下，随机突变的选择系数的均值和方差。通过这个计算 [@problem_id:2713201]，你将揭示一个关键结论——为何平均而言突变总是有害的，以及突变效应的变异程度如何依赖于生物在适应性景观中所处的位置。", "problem": "考虑 Fisher 的适应性几何模型 (FGM)，其中表型是一个 $n$ 维向量 $\\mathbf{z} \\in \\mathbb{R}^{n}$，最适表型位于原点，马尔萨斯适应度与到最适点的距离呈二次方关系。不失一般性，采用曲率缩放，使得马尔萨斯适应度由 $m(\\mathbf{z}) = - \\frac{1}{2}\\|\\mathbf{z}\\|^{2}$ 给出。设原有基因型与最适点相距 $r = \\|\\mathbf{z}\\|$。一个新的突变增加了一个表型步长 $\\Delta$，该步长是各向同性的（方向在 $\\mathbb{R}^{n}$ 的单位球面上均匀分布），且具有固定的大小 $\\|\\Delta\\| = \\sqrt{\\mu_{2}}$，其中 $\\mu_{2}$ 表示步长分布的二阶矩。将单个突变的选择系数 $s$ 定义为马尔萨斯适应度的变化，即 $s = m(\\mathbf{z} + \\Delta) - m(\\mathbf{z})$。\n\n计算在突变方向的各向同性分布下 $s$ 的均值和方差，并用 $r$、$n$ 和 $\\mu_{2}$ 的函数表示。将您的最终结果表示为一个无单位的行矩阵 $\\big(\\mathbb{E}[s]\\ \\ \\mathrm{Var}(s)\\big)$。无需进行数值四舍五入；请提供精确的解析表达式。", "solution": "该问题陈述经核实具有科学依据、问题明确、客观且自成体系。这是理论进化生物学中关于 Fisher 几何模型的一个标准问题。我们将进行推导。\n\n选择系数 $s$ 被定义为由突变 $\\Delta$ 引起的马尔萨斯适应度的变化。马尔萨斯适应度函数为 $m(\\mathbf{z}) = - \\frac{1}{2}\\|\\mathbf{z}\\|^{2}$。原有表型为 $\\mathbf{z}$，突变表型为 $\\mathbf{z} + \\Delta$。因此，选择系数为：\n$$\ns = m(\\mathbf{z} + \\Delta) - m(\\mathbf{z})\n$$\n代入适应度函数，我们得到：\n$$\ns = - \\frac{1}{2}\\|\\mathbf{z} + \\Delta\\|^{2} - \\left( - \\frac{1}{2}\\|\\mathbf{z}\\|^{2} \\right)\n$$\n我们展开平方范数项 $\\|\\mathbf{z} + \\Delta\\|^{2} = (\\mathbf{z} + \\Delta) \\cdot (\\mathbf{z} + \\Delta) = \\|\\mathbf{z}\\|^{2} + 2(\\mathbf{z} \\cdot \\Delta) + \\|\\Delta\\|^{2}$。\n$$\ns = - \\frac{1}{2} \\left( \\|\\mathbf{z}\\|^{2} + 2(\\mathbf{z} \\cdot \\Delta) + \\|\\Delta\\|^{2} \\right) + \\frac{1}{2}\\|\\mathbf{z}\\|^{2}\n$$\n$$\ns = - \\frac{1}{2}\\|\\mathbf{z}\\|^{2} - (\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\|\\Delta\\|^{2} + \\frac{1}{2}\\|\\mathbf{z}\\|^{2}\n$$\n这可以简化为：\n$$\ns = -(\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\|\\Delta\\|^{2}\n$$\n问题陈述中指出，突变步长的大小是固定的，$\\|\\Delta\\| = \\sqrt{\\mu_{2}}$，这意味着 $\\|\\Delta\\|^{2} = \\mu_{2}$。原有表型与最适点相距 $r$，所以 $\\|\\mathbf{z}\\| = r$。$s$ 的表达式变为：\n$$\ns = -(\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\mu_{2}\n$$\n我们需要计算在突变方向的各向同性分布下选择系数的均值 $\\mathbb{E}[s]$ 和方差 $\\mathrm{Var}(s)$。在此计算中，向量 $\\mathbf{z}$ 是固定的，而 $\\Delta$ 是随机变量。\n\n首先，我们计算 $s$ 的均值。根据期望算子的线性性质：\n$$\n\\mathbb{E}[s] = \\mathbb{E}\\left[-(\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\mu_{2}\\right] = -\\mathbb{E}[\\mathbf{z} \\cdot \\Delta] - \\mathbb{E}\\left[\\frac{1}{2}\\mu_{2}\\right]\n$$\n因为 $\\mathbf{z}$ 是一个固定向量，我们可以写出 $\\mathbb{E}[\\mathbf{z} \\cdot \\Delta] = \\mathbf{z} \\cdot \\mathbb{E}[\\Delta]$。突变步长 $\\Delta$ 的大小固定为 $\\sqrt{\\mu_{2}}$，方向在 $\\mathbb{R}^{n}$ 的单位球面上均匀分布。设 $\\mathbf{u}$ 是在单位球面 $S^{n-1}$ 上均匀分布的随机向量。那么 $\\Delta = \\sqrt{\\mu_{2}} \\mathbf{u}$。$\\Delta$ 的期望是：\n$$\n\\mathbb{E}[\\Delta] = \\mathbb{E}[\\sqrt{\\mu_{2}}\\mathbf{u}] = \\sqrt{\\mu_{2}}\\mathbb{E}[\\mathbf{u}]\n$$\n由于球面上均匀分布的对称性，向量 $\\mathbf{u}$ 的期望值是零向量，即 $\\mathbb{E}[\\mathbf{u}] = \\mathbf{0}$。因此，$\\mathbb{E}[\\Delta] = \\mathbf{0}$。\n由此可得 $\\mathbb{E}[\\mathbf{z} \\cdot \\Delta] = \\mathbf{z} \\cdot \\mathbf{0} = 0$。项 $\\frac{1}{2}\\mu_{2}$ 是一个常数。因此，平均选择系数是：\n$$\n\\mathbb{E}[s] = -0 - \\frac{1}{2}\\mu_{2} = - \\frac{1}{2}\\mu_{2}\n$$\n接下来，我们计算 $s$ 的方差。方差定义为 $\\mathrm{Var}(s) = \\mathbb{E}[s^2] - (\\mathbb{E}[s])^2$。或者，我们使用性质：对于任意随机变量 $X$ 和常数 $a, b$，有 $\\mathrm{Var}(aX+b) = a^2\\mathrm{Var}(X)$。\n$$\n\\mathrm{Var}(s) = \\mathrm{Var}\\left(-(\\mathbf{z} \\cdot \\Delta) - \\frac{1}{2}\\mu_{2}\\right) = \\mathrm{Var}(-(\\mathbf{z} \\cdot \\Delta)) = (-1)^{2} \\mathrm{Var}(\\mathbf{z} \\cdot \\Delta) = \\mathrm{Var}(\\mathbf{z} \\cdot \\Delta)\n$$\n随机变量 $\\mathbf{z} \\cdot \\Delta$ 的方差由以下公式给出：\n$$\n\\mathrm{Var}(\\mathbf{z} \\cdot \\Delta) = \\mathbb{E}\\left[(\\mathbf{z} \\cdot \\Delta)^2\\right] - \\left(\\mathbb{E}[\\mathbf{z} \\cdot \\Delta]\\right)^2\n$$\n由于我们已经确定 $\\mathbb{E}[\\mathbf{z} \\cdot \\Delta] = 0$，方差简化为二阶矩：\n$$\n\\mathrm{Var}(s) = \\mathbb{E}\\left[(\\mathbf{z} \\cdot \\Delta)^2\\right]\n$$\n为了计算这个期望，我们考虑二次型 $(\\mathbf{z} \\cdot \\Delta)^2 = (\\mathbf{z}^T \\Delta)^2 = (\\mathbf{z}^T \\Delta)(\\Delta^T \\mathbf{z}) = \\mathbf{z}^T (\\Delta \\Delta^T) \\mathbf{z}$。\n取期望：\n$$\n\\mathbb{E}\\left[(\\mathbf{z} \\cdot \\Delta)^2\\right] = \\mathbb{E}\\left[\\mathbf{z}^T (\\Delta \\Delta^T) \\mathbf{z}\\right] = \\mathbf{z}^T \\mathbb{E}[\\Delta \\Delta^T] \\mathbf{z}\n$$\n矩阵 $\\mathbb{E}[\\Delta \\Delta^T]$ 是向量 $\\Delta$ 的二阶矩矩阵。由于 $\\Delta$ 是各向同性的，该矩阵必须与单位矩阵 $\\mathbf{I}$ 成比例，即 $\\mathbb{E}[\\Delta \\Delta^T] = c\\mathbf{I}$，其中 $c$ 为某个标量。我们可以通过取矩阵的迹来确定 $c$：\n$$\n\\mathrm{Tr}(\\mathbb{E}[\\Delta \\Delta^T]) = \\mathbb{E}[\\mathrm{Tr}(\\Delta \\Delta^T)]\n$$\n$\\Delta \\Delta^T$ 的迹是 $\\mathrm{Tr}(\\Delta \\Delta^T) = \\Delta^T \\Delta = \\|\\Delta\\|^2 = \\mu_{2}$。\n因此，$\\mathbb{E}[\\mathrm{Tr}(\\Delta \\Delta^T)] = \\mathbb{E}[\\mu_{2}] = \\mu_{2}$，因为 $\\mu_{2}$ 是一个常数。\n$c\\mathbf{I}$ 的迹是 $\\mathrm{Tr}(c\\mathbf{I}) = nc$。\n令这两个迹的表达式相等，得到 $nc = \\mu_{2}$，这意味着 $c = \\frac{\\mu_{2}}{n}$。\n因此，$\\mathbb{E}[\\Delta \\Delta^T] = \\frac{\\mu_{2}}{n} \\mathbf{I}$。\n将此结果代回方差的表达式中：\n$$\n\\mathrm{Var}(s) = \\mathbf{z}^T \\left(\\frac{\\mu_{2}}{n} \\mathbf{I}\\right) \\mathbf{z} = \\frac{\\mu_{2}}{n} (\\mathbf{z}^T \\mathbf{z}) = \\frac{\\mu_{2}}{n} \\|\\mathbf{z}\\|^2\n$$\n已知 $\\|\\mathbf{z}\\| = r$，我们最终得到选择系数的方差：\n$$\n\\mathrm{Var}(s) = \\frac{\\mu_{2}r^2}{n}\n$$\n所以，$s$ 的均值和方差分别为 $\\mathbb{E}[s] = -\\frac{1}{2}\\mu_{2}$ 和 $\\mathrm{Var}(s) = \\frac{\\mu_{2}r^2}{n}$。最终结果以行矩阵形式呈现。", "answer": "$$\\boxed{\\begin{pmatrix} -\\frac{\\mu_{2}}{2}  \\frac{r^{2}\\mu_{2}}{n} \\end{pmatrix}}$$", "id": "2713201"}, {"introduction": "在掌握了突变效应的基本统计特性后，我们可以提出一个更具预测性的问题。费雪几何模型不仅能描述突变效应，还能对进化过程本身做出预测。这个练习 [@problem_id:2713211] 探索了 FGM 最经典的预测之一：适应性突变的最优步长。通过解决这个优化问题，你将发现突变大小与生物体距适应性峰顶的距离之间优美的标度关系（scaling relationship），这是该模型的一个核心洞见。", "problem": "考虑Fisher的几何适应模型，其中一个生物体的表型由一个$n$维性状向量$\\mathbf{z} \\in \\mathbb{R}^{n}$表示，且唯一的表型最适点位于原点。假设马尔萨斯适应度（对数适应度）是二次的，$f(\\mathbf{z}) = -\\|\\mathbf{z}\\|^{2}/2$，因此，一个表型效应为$\\mathbf{m}$的突变的选择系数为$s = f(\\mathbf{z}+\\mathbf{m}) - f(\\mathbf{z})$。设当前表型距离最适点的距离为$r = \\|\\mathbf{z}\\|$，并考虑大小固定为$a = \\|\\mathbf{m}\\|$且方向在$(n-1)$维球面上均匀随机的突变。对于固定的$a$，将每次随机突变的预期适应度增益定义为$E[s \\mid a] P_{b}(a)$，其中$P_{b}(a)$是突变为有益的概率，而$E[s \\mid a]$是在有益条件下的平均选择系数。\n\n1. 从上述定义以及关于$(n-1)$维球面上均匀随机方向的基本事实出发，通过对$\\mathbf{m}$和$\\mathbf{z}$之间夹角的余弦进行积分，推导出一个用$n$、$r$和$a$表示$E[s \\mid a] P_{b}(a)$的积分表达式。仅使用以下事实：$s = -\\mathbf{z}\\!\\cdot\\!\\mathbf{m} - a^{2}/2$；对于$\\mathbf{z}$和$\\mathbf{m}$之间的夹角$\\psi$，有$\\mathbf{z}\\!\\cdot\\!\\mathbf{m} = r a \\cos\\psi$；以及在$\\mathbb{R}^{n}$中均匀随机方向的$u = \\cos\\psi$的边际密度在$[-1,1]$上与$(1-u^{2})^{(n-3)/2}$成正比。不要假设$E[s \\mid a] P_{b}(a)$的任何目标公式。\n\n2. 从你的积分表达式中证明，$E[s \\mid a] P_{b}(a)$的最大化因子$a^{\\ast}$必须与$r$线性相关，即$a^{\\ast} = c_{n}\\, r$，其中系数$c_{n}$仅依赖于$n$。\n\n3. 专门针对$n = 3$的情况。通过求解最大值的一阶条件，精确计算$a^{\\ast}$作为$r$的函数。以$r$的闭式表达式形式给出$a^{\\ast}$的最终结果。不需要数值近似。没有物理单位。最终答案必须是单一的解析表达式。如果你选择检查任何中间数值，请将这些检查四舍五入到四位有效数字，但最终答案必须是精确的。\n\n在你的推导过程中，简要解释优化子对$r$的依赖性通常是如何产生的，以及为什么它是线性的。", "solution": "所陈述的问题在科学上是合理的，在数学上是适定的。它在Fisher几何适应模型（进化生物学的一个基本概念）的框架内，提出了一个标准的推导和分析。所有必要的定义和数学事实都已提供，问题没有矛盾或含糊之处。因此，我们开始进行解答。\n\n该问题要求对Fisher几何模型中突变带来的预期适应度增益进行三部分分析。马尔萨斯适应度由$f(\\mathbf{z}) = -\\|\\mathbf{z}\\|^{2}/2$给出，其中$\\mathbf{z} \\in \\mathbb{R}^{n}$是表型，最适点位于原点。表型效应为$\\mathbf{m}$的突变将表型从$\\mathbf{z}$变为$\\mathbf{z}+\\mathbf{m}$。此类突变的选择系数为：\n$$ s = f(\\mathbf{z}+\\mathbf{m}) - f(\\mathbf{z}) = -\\frac{1}{2}\\|\\mathbf{z}+\\mathbf{m}\\|^{2} - \\left(-\\frac{1}{2}\\|\\mathbf{z}\\|^{2}\\right) $$\n$$ s = -\\frac{1}{2}(\\mathbf{z}\\cdot\\mathbf{z} + 2\\mathbf{z}\\cdot\\mathbf{m} + \\mathbf{m}\\cdot\\mathbf{m}) + \\frac{1}{2}\\mathbf{z}\\cdot\\mathbf{z} = -\\mathbf{z}\\cdot\\mathbf{m} - \\frac{1}{2}\\|\\mathbf{m}\\|^{2} $$\n设$r = \\|\\mathbf{z}\\|$为当前表型距离最适点的距离，$a = \\|\\mathbf{m}\\|$为突变的大小。设$\\psi$为向量$\\mathbf{z}$和$\\mathbf{m}$之间的夹角。点积可以写为$\\mathbf{z}\\cdot\\mathbf{m} = \\|\\mathbf{z}\\|\\|\\mathbf{m}\\|\\cos\\psi = ra\\cos\\psi$。选择系数于是成为夹角$\\psi$的函数：\n$$ s(\\psi) = -ra\\cos\\psi - \\frac{a^{2}}{2} $$\n突变$\\mathbf{m}$的方向被假定在$(n-1)$维球面上均匀随机分布。这意味着$u = \\cos\\psi$有一个特定的概率分布。问题给出了$u$在区间$[-1, 1]$上的边际概率密度函数（PDF）：\n$$ p(u) = C_{n} (1-u^{2})^{(n-3)/2} $$\n其中$C_{n} = \\frac{\\Gamma(n/2)}{\\sqrt{\\pi}\\Gamma((n-1)/2)}$是归一化常数。\n\n我们感兴趣的量是预期适应度增益，定义为$E[s \\mid a] P_{b}(a)$。这是选择系数在为正的条件下的期望值，乘以其为正的概率。这个乘积等价于$\\max(0, s)$的期望值，我们将其记为$G(a, r, n)$。\n$$ G(a, r, n) = E[\\max(0, s)] = \\int_{-1}^{1} \\max(0, s(u)) p(u) du $$\n\n如果$s(u)  0$，则突变是有益的。使用$s$关于$u$的表达式：\n$$ -rau - \\frac{a^{2}}{2}  0 \\implies -rau  \\frac{a^{2}}{2} $$\n因为$r  0$且$a  0$，这个不等式简化为：\n$$ u  -\\frac{a}{2r} $$\n为了使有益突变成为可能，$u$的上界必须大于其定义域的下界，即$-a/(2r) > -1$，这意味着$a  2r$。如果$a \\geq 2r$，则没有突变可以是有益的，预期增益为0。\n\n**1. 积分表达式的推导**\n\n现在我们可以通过在突变为有益的$u$的范围内对$s(u) p(u)$进行积分来写出$G(a, r, n)$的表达式。\n$$ G(a, r, n) = \\int_{-1}^{-a/(2r)} s(u) p(u) du $$\n代入$s(u)$和$p(u)$的表达式：\n$$ G(a, r, n) = \\int_{-1}^{-a/(2r)} \\left(-rau - \\frac{a^{2}}{2}\\right) C_{n} (1-u^{2})^{(n-3)/2} du $$\n将常数因子提出并代入$C_n$的表达式，我们得到所需的预期适应度增益的积分表达式：\n$$ G(a, r, n) = \\frac{\\Gamma(n/2)}{\\sqrt{\\pi}\\Gamma(\\frac{n-1}{2})} \\int_{-1}^{-a/(2r)} \\left(-rau - \\frac{a^{2}}{2}\\right) (1-u^{2})^{\\frac{n-3}{2}} du $$\n该积分在$0 \\le a  2r$时有定义。对于$a \\ge 2r$，$G(a, r, n) = 0$。\n\n**2. 最优突变大小$a^{\\ast}$的尺度关系**\n\n为了找到最大化$G(a, r, n)$的最优突变大小$a^{\\ast}$，我们必须分析$G$如何依赖于$a$和$r$。让我们引入一个无量纲变量$x = a/r$，它代表突变大小相对于离最适点距离的比例。我们可以通过代入$a = xr$来重写$G$的表达式：\n$$ G(xr, r, n) = C_{n} \\int_{-1}^{-(xr)/(2r)} \\left(-r(xr)u - \\frac{(xr)^{2}}{2}\\right) (1-u^{2})^{(n-3)/2} du $$\n$$ G(xr, r, n) = C_{n} r^{2} \\int_{-1}^{-x/2} \\left(-xu - \\frac{x^{2}}{2}\\right) (1-u^{2})^{(n-3)/2} du $$\n我们可以定义一个仅依赖于相对突变大小$x$和维度$n$的函数$H(x, n)$：\n$$ H(x, n) = C_{n} \\int_{-1}^{-x/2} \\left(-xu - \\frac{x^{2}}{2}\\right) (1-u^{2})^{(n-3)/2} du $$\n然后，预期增益可以表示为$G(a, r, n) = r^{2} H(a/r, n)$。\n\n为了找到最优突变大小$a^{\\ast}$，我们将$G$对$a$的偏导数设为零：\n$$ \\frac{\\partial G}{\\partial a} = \\frac{\\partial}{\\partial a} \\left[ r^{2} H(a/r, n) \\right] = r^{2} \\cdot \\frac{d H(x, n)}{d x} \\cdot \\frac{\\partial x}{\\partial a} \\quad \\text{其中 } x = a/r $$\n由于$\\partial x/\\partial a = 1/r$，这变为：\n$$ \\frac{\\partial G}{\\partial a} = r^{2} \\cdot H'(x, n) \\cdot \\frac{1}{r} = r H'(a/r, n) $$\n对于$r  0$，条件$\\frac{\\partial G}{\\partial a} = 0$等价于$H'(a/r, n) = 0$。这个方程的解，我们称之为$x^{\\ast}$，将只依赖于参数$n$，因为$H'$只是$x$和$n$的函数。\n$$ x^{\\ast} = c_{n} $$\n代回$x = a/r$，我们发现最优值$a^{\\ast}$满足：\n$$ \\frac{a^{\\ast}}{r} = c_{n} \\implies a^{\\ast} = c_{n} r $$\n这证明了最优突变大小$a^{\\ast}$与到最适点的距离$r$成线性比例关系。这种线性关系的原因是二次适应度景观的自相似性，或称尺度不变性。在距离为$r$的点周围的适应度曲面形状，与在所有空间维度按因子$\\lambda$缩放后、距离为$\\lambda r$的点周围的形状是相同的。因此，只要突变大小也按相同因子缩放，则突变大小的优化问题在离最适点所有距离处几何上是相同的。这意味着最优的突变大小与距离之比，$a^{\\ast}/r$，必须是一个仅依赖于空间维度$n$而不依赖于距离$r$本身的常数。\n\n**3. 计算$n=3$时的$a^{\\ast}$**\n\n对于三维情况，$n=3$，$u$的概率密度函数中的指数变为$(3-3)/2 = 0$。\n概率密度函数简化为$p(u) = C_{3}(1-u^{2})^{0} = C_{3}$。为了找到常数，我们进行归一化：\n$$ \\int_{-1}^{1} C_{3} du = 2C_{3} = 1 \\implies C_{3} = \\frac{1}{2} $$\n因此对于$n=3$，夹角的余弦在$[-1, 1]$上均匀分布。预期增益为：\n$$ G(a, r, 3) = \\int_{-1}^{-a/(2r)} \\left(-rau - \\frac{a^{2}}{2}\\right) \\frac{1}{2} du $$\n这个积分是初等的：\n$$ G(a, r, 3) = \\frac{1}{2} \\left[ -ra\\frac{u^{2}}{2} - \\frac{a^{2}}{2}u \\right]_{-1}^{-a/(2r)} $$\n$$ G(a, r, 3) = \\frac{1}{4} \\left[ -rau^{2} - a^{2}u \\right]_{-1}^{-a/(2r)} $$\n代入积分上下限：\n$$ G(a, r, 3) = \\frac{1}{4} \\left( \\left[-ra\\left(-\\frac{a}{2r}\\right)^{2} - a^{2}\\left(-\\frac{a}{2r}\\right)\\right] - \\left[-ra(-1)^{2} - a^{2}(-1)\\right] \\right) $$\n$$ G(a, r, 3) = \\frac{1}{4} \\left( \\left[-ra\\frac{a^{2}}{4r^{2}} + \\frac{a^{3}}{2r}\\right] - \\left[-ra + a^{2}\\right] \\right) $$\n$$ G(a, r, 3) = \\frac{1}{4} \\left( -\\frac{a^{3}}{4r} + \\frac{2a^{3}}{4r} + ra - a^{2} \\right) = \\frac{1}{4} \\left( \\frac{a^{3}}{4r} - a^{2} + ra \\right) $$\n为了找到最优的$a$，我们对$a$求导并将结果设为零：\n$$ \\frac{\\partial G}{\\partial a} = \\frac{1}{4} \\left( \\frac{3a^{2}}{4r} - 2a + r \\right) = 0 $$\n$$ \\frac{3a^{2}}{4r} - 2a + r = 0 $$\n两边乘以$4r$得到一个关于$a$的二次方程：\n$$ 3a^{2} - 8ra + 4r^{2} = 0 $$\n使用二次方程求根公式，$a = \\frac{-b \\pm \\sqrt{b^{2}-4ac}}{2a_{q}}$（其中$a_{q}=3$，$b=-8r$，$c=4r^2$）：\n$$ a = \\frac{8r \\pm \\sqrt{(-8r)^{2} - 4(3)(4r^{2})}}{2(3)} = \\frac{8r \\pm \\sqrt{64r^{2} - 48r^{2}}}{6} $$\n$$ a = \\frac{8r \\pm \\sqrt{16r^{2}}}{6} = \\frac{8r \\pm 4r}{6} $$\n这得到了$a^{\\ast}$的两个可能解：\n$$ a_{1} = \\frac{8r + 4r}{6} = \\frac{12r}{6} = 2r $$\n$$ a_{2} = \\frac{8r - 4r}{6} = \\frac{4r}{6} = \\frac{2}{3}r $$\n为了确定哪个是最大值，我们检查二阶导数：\n$$ \\frac{\\partial^{2} G}{\\partial a^{2}} = \\frac{1}{4} \\left( \\frac{6a}{4r} - 2 \\right) = \\frac{1}{4} \\left( \\frac{3a}{2r} - 2 \\right) $$\n在$a_{1} = 2r$处，二阶导数为$\\frac{1}{4}(\\frac{3(2r)}{2r} - 2) = \\frac{1}{4}(3-2) = \\frac{1}{4}  0$，表明是一个局部最小值。\n在$a_{2} = \\frac{2}{3}r$处，二阶导数为$\\frac{1}{4}(\\frac{3(2r/3)}{2r} - 2) = \\frac{1}{4}(1-2) = -\\frac{1}{4}  0$，表明是一个局部最大值。\n$a$的有效定义域是$[0, 2r]$。我们发现$G(0,r,3)=0$和$G(2r,r,3)=0$。由于对于$a \\in (0, 2r)$有$G(a,r,3) > 0$，因此在$a = \\frac{2}{3}r$处的局部最大值就是此区间内的全局最大值。\n因此，对于$n=3$的最优突变大小是$a^{\\ast} = \\frac{2}{3}r$。", "answer": "$$\\boxed{\\frac{2}{3}r}$$", "id": "2713211"}, {"introduction": "理论的最终价值在于其与数据的对话。一个强大的模型应当是可检验的，并能应用于真实数据。这最后一个实践练习 [@problem_id:2713195] 旨在连接抽象理论与实证科学，展示如何将从 FGM 推导出的理论 DFE 作为统计推断的基础。你将亲手实现一个最大似然估计（Maximum Likelihood Estimation, MLE）程序，从一组观测到的适应性效应数据中推断模型的关键参数——表型维度 $n$ 和与最优表型的距离 $r$，这是现代分子进化研究中的一项核心技能。", "problem": "要求您为 Fisher 适应性几何模型实现一个基于似然的推断程序，使用 Fisher 适应度效应几何分布作为生成模型。请从第一性原理出发，将表型建模为高维欧几里得空间中的一个点，将适应度建模为与最适点距离的光滑球对称函数，并假设突变步长是各向同性且效应微小。然后，推导新突变所诱导的适应度效应分布，并用它来计算观测到的适应度效应的似然。\n\n假设以下基本设置和定义：\n- 表型是一个 $n$ 维向量，最适点位于原点。驻留基因型的表型位移与最适点相距的欧几里得范数为 $r \\ge 0$。\n- 一个新突变增加了一个各向同性的效应向量 $\\mathbf{X}$，其坐标是独立同分布的高斯随机变量，均值为 $0$，方差为 $1$。因此，$\\mathbf{X} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_n)$。\n- 适应度是与最适点距离平方的光滑球对称函数，其曲率固定以设定选择系数的尺度。使用微小效应近似，将新突变的选择系数 $s$ 与距离平方的变化量 $\\Delta$ 通过 $s = - \\Delta$ 联系起来，其中\n$$\n\\Delta = \\lVert \\mathbf{z} + \\mathbf{X} \\rVert^2 - \\lVert \\mathbf{z} \\rVert^2 = \\lVert \\mathbf{X} \\rVert^2 + 2 \\, r \\, X_1,\n$$\n这是在旋转坐标系后，使 $\\mathbf{z}$ 位于第一个坐标轴上，满足 $\\lVert \\mathbf{z} \\rVert = r$，$X_1$ 是 $\\mathbf{X}$ 的第一个坐标。\n- 定义非中心性参数 $\\delta = r^2$ 和随机变量\n$$\nT = \\sum_{i=1}^n (X_i + \\mu_i)^2,\n$$\n其中 $\\mu_1 = r$，且对于 $i  1$ 有 $\\mu_i = 0$。那么 $T$ 服从自由度为 $n$、非中心性参数为 $\\delta$ 的非中心卡方分布，记作 $T \\sim \\chi^2_n(\\delta)$。我们有恒等式\n$$\n\\Delta = T - \\delta, \\quad \\text{so} \\quad s = \\delta - T.\n$$\n- 因此，对于任何候选对 $(r, n)$（其中 $\\delta = r^2$），每个观测到的选择系数 $s$ 都决定了 $T = \\delta - s$。由于 $T$ 的支撑集是 $[0, \\infty)$，任何导致 $T  0$ 的观测值在该候选对下的似然为零。\n\n您的程序必须实现以下基于似然的推断任务：\n- 对于每个观测到的选择系数数据集 $\\{s_i\\}_{i=1}^m$，将数据视为从 Fisher 适应度效应几何分布的独立同分布抽样，该分布由非中心卡方分布 $T \\sim \\chi^2_n(\\delta)$ 通过 $s = \\delta - T$ 诱导得出。\n- 候选对 $(r, n)$ 的似然是在 $T_i = \\delta - s_i$ 处计算的非中心卡方密度函数值在所有 $i$ 上的乘积：\n$$\n\\mathcal{L}(r, n \\mid \\{s_i\\}) = \\prod_{i=1}^m f_{\\chi^2_n(\\delta)}(T_i), \\quad \\delta = r^2,\n$$\n并约定如果任何 $T_i  0$，则 $\\mathcal{L}(r, n \\mid \\{s_i\\}) = 0$。\n- 在下文定义的固定搜索网格上计算最大似然对 $(\\hat{r}, \\hat{n})$。当多个对在数值容差范围内达到相同的最大似然时，通过选择最小的 $\\hat{r}$，然后选择最小的 $\\hat{n}$ 来打破平局。\n\n使用以下固定的候选网格：\n- 维度网格：$n \\in \\{1, 2, 3, 4, 5, 6\\}$。\n- 距离网格：$r \\in \\{0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0\\}$。\n\n测试套件：\n- 数据集 A: $\\{s_i\\} = \\{-1.0, -3.0, -5.0\\}$。\n- 数据集 B: $\\{s_i\\} = \\{3.8, -2.0, -6.0\\}$。\n- 数据集 C: $\\{s_i\\} = \\{0.8, -2.0, -6.0\\}$。\n\n对于每个数据集，您的程序必须：\n- 在所有网格对上评估对数似然 $\\log \\mathcal{L}(r, n \\mid \\{s_i\\})$，将任何零密度视为贡献负无穷大的对数似然，从而排除该对。\n- 返回具有指定平局打破规则的最大化对 $(\\hat{r}, \\hat{n})$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个数据集的结果表示为一个二元列表 $[\\hat{r}, \\hat{n}]$。例如，总输出必须具有确切的形式\n`[[r_A,n_A],[r_B,n_B],[r_C,n_C]]`\n，不插入任何空格。", "solution": "我们从 Fisher 几何模型的核心几何和概率结构开始。表型是 $n$ 维欧几里得空间中的点，适应度随着与最适点距离的平方平滑下降。设驻留基因型位于位移向量 $\\mathbf{z}$ 处，其欧几里得范数为 $r = \\lVert \\mathbf{z} \\rVert$。在假设每个性状轴上的效应是独立同分布、均值为零的高斯效应的情况下，一个新突变会增加一个各向同性的效应向量 $\\mathbf{X} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_n)$。\n\n在微小效应极限下，基于距离的适应度函数可以局部地用一个二次型来近似，其曲率设定了尺度。固定此曲率，使得选择系数 $s$ 等于距离平方变化的负值，即 $s = -\\Delta$。这是一种标准且方便的归一化方法，它使得 $s$ 无量纲，并且可以直接在不同曲率参数化之间进行比较。\n\n旋转坐标系，使 $\\mathbf{z}$ 位于第一个坐标轴上，即 $\\mathbf{z} = (r, 0, \\ldots, 0)$，则增加 $\\mathbf{X}$ 后距离平方的变化为\n$$\n\\Delta = \\lVert \\mathbf{z} + \\mathbf{X} \\rVert^2 - \\lVert \\mathbf{z} \\rVert^2\n= (r + X_1)^2 + \\sum_{i=2}^n X_i^2 - r^2 = X_1^2 + 2 r X_1 + \\sum_{i=2}^n X_i^2.\n$$\n定义移位后的变量 $Y_1 = X_1 + r$ 以及对于 $i \\ge 2$ 有 $Y_i = X_i$。那么\n$$\nT \\equiv \\sum_{i=1}^n Y_i^2 = (X_1 + r)^2 + \\sum_{i=2}^n X_i^2.\n$$\n根据关于具有非零均值的独立高斯随机变量平方和的标准结果，$T$ 服从自由度为 $n$、非中心性参数为 $\\delta = r^2$ 的非中心卡方分布，记作 $T \\sim \\chi^2_n(\\delta)$。此外，\n$$\n\\Delta = T - \\delta \\quad \\Longrightarrow \\quad s = -\\Delta = \\delta - T.\n$$\n因此，在给定 $(r, n)$ 的条件下，选择系数 $s$ 是 $T$ 经过平移和符号翻转后的版本，其一一变换关系为 $T = \\delta - s$，雅可比行列式的大小为 $\\lvert \\mathrm{d}T / \\mathrm{d}s \\rvert = 1$。因为 $T$ 的支撑集是 $[0, \\infty)$，所以在 $(r, n)$ 条件下 $s$ 的支撑集是 $(-\\infty, \\delta]$，即 $s \\le r^2$。\n\n给定一个观测集 $\\{s_i\\}_{i=1}^m$，观测之间的独立性意味着候选对 $(r, n)$ 的似然是相应密度函数在 $T_i = \\delta - s_i$ 处的值的乘积：\n$$\n\\mathcal{L}(r, n \\mid \\{s_i\\}) = \\prod_{i=1}^m f_{\\chi^2_n(\\delta)}(T_i),\n$$\n并约定任何 $T_i  0$ 都会产生零似然。等价地，对数似然为\n$$\n\\log \\mathcal{L}(r, n \\mid \\{s_i\\}) = \\sum_{i=1}^m \\log f_{\\chi^2_n(\\delta)}(\\delta - s_i),\n$$\n并约定如果任何密度为零，则对数似然为负无穷大。从 $s$ 到 $T$ 的变换的雅可比行列式大小为 1，对对数似然没有额外的贡献项。\n\n这就在参数 $(r, n)$ 和可观测的选择系数 $\\{s_i\\}$ 之间建立了一个显式的、基于似然的联系。为了进行推断，我们采用一个离散网格以保证计算的可行性和可识别性：\n- 距离网格是 $r \\in \\{0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0\\}$，意味着 $\\delta = r^2 \\in \\{0.0, 0.25, 1.0, 2.25, 4.0, 6.25, 9.0\\}$。\n- 维度网格是 $n \\in \\{1, 2, 3, 4, 5, 6\\}$。\n\n对于每个数据集，我们在此网格上计算对数似然，并选择使其最大化的对 $(\\hat{r}, \\hat{n})$。由于连续密度可能导致数值上无法区分的最大值，我们施加一个确定性的平局打破规则：在对数似然值处于一个小的容差范围内的几对参数中，选择最小的 $\\hat{r}$，如果仍然平局，则选择最小的 $\\hat{n}$。\n\n边界情况和约束被自然地处理：\n- 对于一个候选的 $r$，如果任何观测值满足 $s_i  r^2$，则 $T_i = \\delta - s_i  0$，该候选的似然为零。\n- 任何有益突变观测值 $s_i  0$ 的存在会立即排除 $r = 0$ 的情况，因为在 $r = 0$ 时 $s$ 的支撑集是 $s \\le 0$。\n\n每个数据集的算法步骤：\n- 对于距离网格中的每个 $r$：\n  - 计算 $\\delta = r^2$。\n  - 将每个 $s_i$ 转换为 $T_i = \\delta - s_i$；如果任何 $T_i  0$，则将对数似然赋为负无穷大并跳过。\n  - 否则，对于维度网格中的每个 $n$，将非中心卡方密度 $f_{\\chi^2_n(\\delta)}(T_i)$ 的对数值在所有 $i$ 上求和。\n- 选择使对数似然最大化的 $(\\hat{r}, \\hat{n})$，并使用指定的平局打破规则。\n\n我们现在将此方法应用于指定的测试套件：\n- 数据集 A: $\\{-1.0, -3.0, -5.0\\}$。所有条目都是非正数，因此 $r=0$ 不会被支撑集排除，并且会具有竞争力；不同 $n$ 值下的形状决定了 $\\hat{n}$。\n- 数据集 B: $\\{3.8, -2.0, -6.0\\}$。由于 $s_{\\max} = 3.8$，所有满足 $r^2  3.8$ 的 $r$（即 $r \\in \\{0.0, 0.5, 1.0, 1.5\\}$）都会因支撑集而被排除；这将似然集中在较大的 $r$ 上，而 $n$ 由转换后的 $T$ 值处的密度形状决定。\n- 数据集 C: $\\{0.8, -2.0, -6.0\\}$。这里 $s_{\\max} = 0.8$ 仅排除了满足 $r^2  0.8$ 的 $r$，即 $r \\in \\{0.0, 0.5\\}$，同样使得似然集中在允许的 $r$ 上。\n\n程序使用非中心卡方概率密度函数计算对数似然，并为每个数据集返回指定单行列表格式的最大化对 $(\\hat{r}, \\hat{n})$。", "answer": "```python\n# Fisher's geometric model: likelihood-based inference of r and n from observed DFEs\n# Execution environment: Python 3.12, numpy 1.23.5, scipy 1.11.4\nimport numpy as np\nfrom scipy.stats import ncx2\n\ndef log_likelihood_for_dataset(s_vals, r, n, tol=1e-300):\n    \"\"\"\n    Compute the log-likelihood for one dataset under candidate (r, n).\n    Transformation: s = delta - T = T = delta - s, where delta = r^2.\n    If any T  0, the likelihood is zero (log-likelihood = -inf).\n    \"\"\"\n    delta = r * r\n    T = delta - np.array(s_vals, dtype=float)\n    if np.any(T  0):\n        return -np.inf\n    # Evaluate pdf; if any zero or negative due to underflow, treat as zero-likelihood\n    pdf_vals = ncx2.pdf(T, df=int(n), nc=delta)\n    if np.any(pdf_vals = 0.0) or np.any(~np.isfinite(pdf_vals)):\n        return -np.inf\n    return float(np.sum(np.log(pdf_vals)))\n\ndef infer_mle_pair(s_vals, r_grid, n_grid, tie_tol=1e-12):\n    \"\"\"\n    Grid search for MLE (r, n) maximizing the log-likelihood for the given dataset.\n    Tie-breaking: smallest r, then smallest n, when log-likelihoods are within tie_tol.\n    \"\"\"\n    best_ll = -np.inf\n    best_r = None\n    best_n = None\n    for r in r_grid:\n        delta = r * r\n        # Quick support check: if any s_i > delta then T_i  0, zero likelihood for this r (for all n)\n        if np.any(np.array(s_vals) > delta):\n            continue\n        for n in n_grid:\n            ll = log_likelihood_for_dataset(s_vals, r, n)\n            if ll > best_ll + tie_tol:\n                best_ll = ll\n                best_r = r\n                best_n = int(n)\n            elif abs(ll - best_ll) = tie_tol:\n                # Tie-break by smallest r, then smallest n\n                if best_r is None or r  best_r or (r == best_r and int(n)  best_n):\n                    best_r = r\n                    best_n = int(n)\n    # In degenerate case where all candidates have -inf (should not happen for provided datasets),\n    - fall back to smallest r, n.\n    if best_r is None:\n        best_r = float(r_grid[0])\n        best_n = int(n_grid[0])\n    return [float(best_r), int(best_n)]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Dataset A, B, C:\n    datasets = [\n        [-1.0, -3.0, -5.0],   # A\n        [3.8, -2.0, -6.0],    # B\n        [0.8, -2.0, -6.0],    # C\n    ]\n    # Candidate grids\n    r_grid = np.array([0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0], dtype=float)\n    n_grid = np.array([1, 2, 3, 4, 5, 6], dtype=int)\n\n    results = []\n    for s_vals in datasets:\n        mle_pair = infer_mle_pair(s_vals, r_grid, n_grid)\n        results.append(mle_pair)\n\n    # Format as a single line with no spaces, as specified.\n    # Example: [[2.0,2],[0.0,3],[1.0,5]]\n    out = \"[\" + \",\".join(\"[\" + f\"{r:.1f}\".rstrip('0').rstrip('.') + (\".0\" if abs(r - round(r))  1e-12 else \"\") + f\",{n}]\" \n                         for r, n in results) + \"]\"\n    # The formatting above ensures floats like 2.0, 0.0, 1.0 keep one decimal.\n    # However, to strictly ensure one decimal place as in examples, enforce formatting explicitly:\n    out_fixed = \"[\" + \",\".join(\"[\" + f\"{r:.1f}\" + f\",{n}]\" for r, n in results) + \"]\"\n    print(out_fixed)\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2713195"}]}