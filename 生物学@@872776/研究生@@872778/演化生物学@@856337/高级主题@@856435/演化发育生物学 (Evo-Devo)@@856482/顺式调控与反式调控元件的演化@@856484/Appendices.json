{"hands_on_practices": [{"introduction": "在顺式和反式调控进化的研究中，一个核心挑战是如何量化这两种不同来源的遗传变异对基因表达差异的贡献。经典的实验设计利用品系间的杂交和对杂交后代中等位基因特异性表达（Allele-Specific Expression, ASE）的分析，来精确分离顺式和反式效应。本练习将引导你应用这一逻辑，处理一个包含亲本表达量、杂交子代ASE以及用于校正技术偏差的DNA对照组的模拟数据集，从而让你亲手实践从实验数据中拆分顺式和反式调控效应的基本方法[@problem_id:2696998]。", "problem": "您正在研究两个已分化的单倍体菌株（表示为菌株 $P$ 和菌株 $Q$）中的单个基因。在菌株 $P$ 和 $Q$ 中，通过核糖核酸测序（RNA-seq）对信使核糖核酸（mRNA）的丰度进行量化（使用重复文库且已知文库大小），在子一代（F1）杂交体中测量等位基因特异性表达（ASE），并使用一个杂合的基因组脱氧核糖核酸（gDNA）对照来量化比对偏好。假设遵循以下基本建模原则。\n\n- 中心法则和表达测量：对于给定基因，RNA-seq的读数计数与基础的mRNA丰度成正比，并受文库大小的调节。在对数尺度上，测得丰度的重复间随机性可以通过一个对该基因跨菌株的同方差对数正态模型很好地近似。\n\n- 顺式与反式效应：设 $E_{P}$ 和 $E_{Q}$ 为在相同环境中生长的菌株 $P$ 和 $Q$ 中该基因的平均mRNA丰度。在自然对数尺度上，假设一个加性模型 $\\ln(E_{P}) - \\ln(E_{Q}) = \\gamma + \\tau$，其中 $\\gamma$ 是顺式调控对数效应（等位基因特异性，共享反式环境），而 $\\tau$ 是反式调控对数效应（背景特异性，跨等位基因共享）。\n\n- F1杂交体的ASE逻辑：在F1杂交体中，两个等位基因经历相同的反式环境，因此等位基因特异性丰度的对数比率等于 $\\gamma$。由于序列比对偏好，观察到的ASE读数计数被一个未知的、偏向于一个等位基因的乘性比对偏好因子 $b$ 所扭曲，因此比对到 $P$ 等位基因与 $Q$ 等位基因的读数的期望比值乘以 $b$。\n\n- 似然假设：对于亲本样本，对数正态模型意味着 $\\ln(E_{P}/E_{Q})$ 的最大似然估计（MLE）等于 $P$ 和 $Q$ 中各重复文库大小标准化计数的对数均值之差。对于F1中的ASE，将比对的等位基因计数视为二项式抽样读数，其比值与真实等位基因特异性丰度乘以比对偏好的乘积成正比，顺式比值的MLE等于观察到的等位基因比值除以 $b$。gDNA对照（基础等位基因拷贝数相等）提供了 $b$ 的MLE，即观察到的gDNA等位基因比值。\n\n该基因的数据：\n- 亲本 $P$ 的RNA-seq数据：重复计数为 $(y_{P,1},y_{P,2},y_{P,3}) = (120, 150, 90)$，对应的文库大小为 $(L_{P,1},L_{P,2},L_{P,3}) = (10 \\times 10^{6}, 12 \\times 10^{6}, 8 \\times 10^{6})$ 总比对读数。\n- 亲本 $Q$ 的RNA-seq数据：重复计数为 $(y_{Q,1},y_{Q,2},y_{Q,3}) = (60, 70, 65)$，对应的文库大小为 $(L_{Q,1},L_{Q,2},L_{Q,3}) = (11 \\times 10^{6}, 9 \\times 10^{6}, 10 \\times 10^{6})$ 总比对读数。\n- F1杂交体中该基因的ASE计数：分配给等位基因 $P$ 的读数为 $260$，分配给等位基因 $Q$ 的读数为 $140$。\n- 该位点的杂合gDNA对照：分配给等位基因 $P$ 的读数为 $5200$，分配给等位基因 $Q$ 的读数为 $4800$。\n\n仅使用上述建模假设和第一性原理似然推理，计算由 $\\ln(E_{P}/E_{Q}) = \\gamma + \\tau$ 定义的反式调控对数效应 $\\tau$（以自然对数为底）的最大似然估计。将您的最终答案表示为单个实数。将最终答案四舍五入至四位有效数字。", "solution": "该问题是有效的。它在科学上基于演化和功能基因组学的原理，特别是将基因表达差异分解为顺式和反式调控成分。该问题提供了一套清晰、独立的假设、数据和定义，可以通过逻辑和数学推理得出一个唯一的解。\n\n目标是计算反式调控对数效应的最大似然估计（MLE），表示为 $\\tau$。提供的基本模型是在自然对数尺度上的一个加性分解：\n$$ \\ln(E_{P}) - \\ln(E_{Q}) = \\gamma + \\tau $$\n其中 $E_{P}$ 和 $E_{Q}$ 是菌株 $P$ 和 $Q$ 中的平均mRNA丰度，$\\gamma$ 是顺式调控对数效应，$\\tau$ 是反式调控对数效应。\n\n根据最大似然估计量的不变性，$\\tau$ 的MLE，表示为 $\\hat{\\tau}$，由以下公式给出：\n$$ \\hat{\\tau} = \\widehat{\\ln(E_{P}/E_{Q})} - \\hat{\\gamma} $$\n这需要我们首先计算总表达对数比率的MLE，$\\widehat{\\ln(E_{P}/E_{Q})}$，以及顺式调控对数效应的MLE，$\\hat{\\gamma}$。\n\n步骤1：估计总表达对数比率 $\\widehat{\\ln(E_{P}/E_{Q})}$。\n问题陈述 $\\ln(E_{P}/E_{Q})$ 的MLE是文库大小标准化计数的对数均值之差。设 $y_{S,i}$ 为菌株 $S \\in \\{P, Q\\}$ 的重复 $i$ 的读数计数，$L_{S,i}$ 为其文库大小。给定重复的文库大小标准化表达量为 $n_{S,i} = y_{S,i} / L_{S,i}$。\nMLE则为：\n$$ \\widehat{\\ln(E_{P}/E_{Q})} = \\frac{1}{3} \\sum_{i=1}^{3} \\ln(n_{P,i}) - \\frac{1}{3} \\sum_{i=1}^{3} \\ln(n_{Q,i}) = \\frac{1}{3} \\ln \\left( \\frac{\\prod_{i=1}^{3} n_{P,i}}{\\prod_{i=1}^{3} n_{Q,i}} \\right) $$\n菌株 $P$ 的数据为计数 $(y_{P,1}, y_{P,2}, y_{P,3}) = (120, 150, 90)$ 和文库大小 $(L_{P,1}, L_{P,2}, L_{P,3}) = (10 \\times 10^{6}, 12 \\times 10^{6}, 8 \\times 10^{6})$。其标准化计数的乘积为：\n$$ \\prod_{i=1}^{3} n_{P,i} = \\left(\\frac{120}{10 \\times 10^{6}}\\right) \\left(\\frac{150}{12 \\times 10^{6}}\\right) \\left(\\frac{90}{8 \\times 10^{6}}\\right) = 1.6875 \\times 10^{-15} $$\n菌株 $Q$ 的数据为计数 $(y_{Q,1}, y_{Q,2}, y_{Q,3}) = (60, 70, 65)$ 和文库大小 $(L_{Q,1}, L_{Q,2}, L_{Q,3}) = (11 \\times 10^{6}, 9 \\times 10^{6}, 10 \\times 10^{6})$。其标准化计数的乘积为：\n$$ \\prod_{i=1}^{3} n_{Q,i} = \\left(\\frac{60}{11 \\times 10^{6}}\\right) \\left(\\frac{70}{9 \\times 10^{6}}\\right) \\left(\\frac{65}{10 \\times 10^{6}}\\right) = \\frac{273000}{990 \\times 10^{18}} = \\frac{27300}{99} \\times 10^{-18} $$\n乘积之比为：\n$$ \\frac{\\prod n_{P,i}}{\\prod n_{Q,i}} = \\frac{1.6875 \\times 10^{-15}}{\\frac{27300}{99} \\times 10^{-18}} = \\frac{1687.5 \\times 10^{-18}}{\\frac{27300}{99} \\times 10^{-18}} = \\frac{1687.5 \\times 99}{27300} = \\frac{167062.5}{27300} = \\frac{4455}{728} $$\n因此，总表达对数比率的MLE为：\n$$ \\widehat{\\ln(E_{P}/E_{Q})} = \\frac{1}{3} \\ln\\left(\\frac{4455}{728}\\right) $$\n\n步骤2：估计顺式调控对数效应 $\\hat{\\gamma}$。\n顺式效应 $\\gamma$ 是F1杂交体中等位基因特异性丰度的对数比率。观察到的等位基因特异性读数计数受因子 $b$ 的偏好影响。问题陈述真实顺式比值 $\\exp(\\gamma)$ 的MLE等于从ASE观察到的等位基因比值除以偏好因子 $b$ 的MLE，即 $\\hat{b}$。\n首先，我们从杂合gDNA对照中估计 $\\hat{b}$。在gDNA中，真实的等位基因拷贝数比例为 $1:1$。该模型意味着 $\\hat{b}$ 等于观察到的gDNA等位基因比值。\n给定等位基因 $P$ 和 $Q$ 的gDNA计数为 $N_{P,gDNA} = 5200$ 和 $N_{Q,gDNA} = 4800$：\n$$ \\hat{b} = \\frac{N_{P,gDNA}}{N_{Q,gDNA}} = \\frac{5200}{4800} = \\frac{52}{48} = \\frac{13}{12} $$\n接下来，我们使用F1杂交体的ASE计数：$N_{P,ASE} = 260$ 和 $N_{Q,ASE} = 140$。观察到的ASE比值为：\n$$ \\frac{N_{P,ASE}}{N_{Q,ASE}} = \\frac{260}{140} = \\frac{13}{7} $$\n那么，顺式比值的MLE为：\n$$ \\exp(\\hat{\\gamma}) = \\frac{N_{P,ASE}/N_{Q,ASE}}{\\hat{b}} = \\frac{13/7}{13/12} = \\frac{13}{7} \\times \\frac{12}{13} = \\frac{12}{7} $$\n取自然对数，得到顺式调控对数效应的MLE：\n$$ \\hat{\\gamma} = \\ln\\left(\\frac{12}{7}\\right) $$\n\n步骤3：估计反式调控对数效应 $\\hat{\\tau}$。\n现在我们将总效应和顺式调控效应的估计值代入主方程：\n$$ \\hat{\\tau} = \\widehat{\\ln(E_{P}/E_{Q})} - \\hat{\\gamma} = \\frac{1}{3} \\ln\\left(\\frac{4455}{728}\\right) - \\ln\\left(\\frac{12}{7}\\right) $$\n为求数值，我们计算各项：\n$$ \\widehat{\\ln(E_{P}/E_{Q})} = \\frac{1}{3} \\ln\\left(\\frac{4455}{728}\\right) \\approx \\frac{1}{3} \\ln(6.119505...) \\approx \\frac{1.811481...}{3} \\approx 0.6038270 $$\n$$ \\hat{\\gamma} = \\ln\\left(\\frac{12}{7}\\right) \\approx \\ln(1.714285...) \\approx 0.5389965 $$\n将这些值相减得到：\n$$ \\hat{\\tau} \\approx 0.6038270 - 0.5389965 = 0.0648305 $$\n将结果四舍五入至四位有效数字，得到 $0.06483$。", "answer": "$$\\boxed{0.06483}$$", "id": "2696998"}, {"introduction": "在前一个练习计算了效应均值的基础上，本练习将视角转向调控差异的*变异*。通过分析重复实验数据，我们可以超越单一的点估计，将表达差异的总方差分解为来自顺式、反式以及两者协方差的贡献，从而更深入地揭示调控进化的动态过程。这个计算练习将帮助你理解并实现这一方差分解的逻辑，特别是让你看到补偿性进化（即顺式和反式效应向相反方向进化）等重要模式是如何通过定量分析被识别出来的[@problem_id:2696994]。", "problem": "给定一个关于两个已分化谱系及其第一代杂交体中基因表达的概念模型。任务是设计一个程序，为每个测试用例计算观测到的表达差异的一种原则性分解，将其归因于顺式调控差异、反式调控差异及其协方差的组分，仅使用调控遗传学中的基本定义和实验设计逻辑。\n\n基本原理：\n- 在分子生物学的中心法则中，转录输出由局部脱氧核糖核酸（DNA）序列特征（顺式调控元件）和可扩散的细胞因子（反式作用调节因子）之间的相互作用决定。对于一个目标基因，假设在给定的基因型-因子背景下，其表达水平是顺式贡献和反式贡献的乘积。也就是说，在来自谱系 $1$ 的亲本中，表达是谱系 $1$ 所携带的等位基因特有的顺式项与谱系 $1$ 细胞环境特有的反式项的乘积。谱系 $2$ 的情况与此类似。\n- 在谱系 $1$ 和谱系 $2$ 之间的第一代杂交体中，两个等位基因都经历相同的反式环境，但保留了它们谱系特异性的顺式调控序列。\n- 贡献的乘法模型可以通过取自然对数进行线性化，将乘法效应转换为加性效应，从而简化了对比和方差分解。\n\n需要根据第一性原理实现的定义：\n- 设 $P1_i$ 和 $P2_i$ 分别表示来自谱系 $1$ 的亲本和谱系 $2$ 的亲本的第 $i$ 次重复表达测量值。\n- 设 $A1_i$ 和 $A2_i$ 分别表示在第一代杂交体中，来自谱系 $1$ 和谱系 $2$ 的等位基因的第 $i$ 次重复等位基因特异性表达测量值。所有要使用的对数均为自然对数。\n- 对于每次重复 $i$，在对数尺度上定义三个可加数量，这些数量必须能基于上述实验设计和基本原理推导出来：\n  - 亲本间的总对数差异 $d_i$。\n  - 一个对数尺度的量，利用杂交体中两个等位基因共享相同反式环境这一事实，分离出顺式调控差异 $c_i$。\n  - 一个对数尺度的量，利用反式作用是全局性的以及总差异由顺式和反式共同引起这一事实，分离出反式调控差异 $t_i$。\n- 在所有重复实验中，使用分母为 $(n-1)$ 的标准定义计算无偏样本方差和协方差，其中 $n$ 是重复次数：\n  - $d_i$ 的样本方差为 $\\mathrm{Var}(d)$，$c_i$ 的样本方差为 $\\mathrm{Var}(c)$，$t_i$ 的样本方差为 $\\mathrm{Var}(t)$，样本协方差为 $\\mathrm{Cov}(c,t)$。\n- 使用随机变量和的方差代数，将 $\\mathrm{Var}(d)$ 表示为 $\\mathrm{Var}(c)$、$\\mathrm{Var}(t)$ 和 $\\mathrm{Cov}(c,t)$ 的函数，然后计算以下分数为小数（非百分比）：\n  - $f_{\\mathrm{cis}} = \\mathrm{Var}(c) / \\mathrm{Var}(d)$\n  - $f_{\\mathrm{trans}} = \\mathrm{Var}(t) / \\mathrm{Var}(d)$\n  - $f_{\\mathrm{cov}} = 2\\,\\mathrm{Cov}(c,t) / \\mathrm{Var}(d)$\n当 $\\mathrm{Var}(d) > 0$ 时，这三个分数的和在舍入误差范围内应为 $1$。\n\n对于每个测试用例，你的程序必须：\n- 使用自然对数和上述实验设计逻辑，计算每次重复的数量 $d_i$、$c_i$、$t_i$。\n- 计算样本均值 $\\overline{c}$ 和 $\\overline{t}$、无偏样本协方差 $\\mathrm{Cov}(c,t)$，以及如上定义的分数 $f_{\\mathrm{cis}}$、$f_{\\mathrm{trans}}$、$f_{\\mathrm{cov}}$。\n- 将所有返回的浮点数四舍五入到六位小数。\n\n角度单位不适用。不需要物理单位。\n\n测试套件：\n每个测试用例由四个等长的正数列表定义，分别代表重复 $i = 1,\\dots,n$ 的 $P1_i$、$P2_i$、$A1_i$、$A2_i$。全程使用自然对数。\n\n- 测试用例 $1$（具有中等差异的一般情况）：\n  - $P1 = [182.211, 181.2375, 173.115]$\n  - $P2 = [100, 90, 105]$\n  - $A1 = [179.018, 181.359, 169.415]$\n  - $A2 = [120, 110, 130]$\n\n- 测试用例 $2$（边界情况，基本上是纯反式调控差异，杂交体中没有等位基因特异性差异）：\n  - $P1 = [150, 160, 99]$\n  - $P2 = [100, 80, 90]$\n  - $A1 = [120, 100, 105]$\n  - $A2 = [120, 100, 105]$\n\n- 测试用例 $3$（边界情况，基本上是纯顺式调控差异，亲本差异等于杂交体中的等位基因特异性差异）：\n  - $P1 = [117, 165, 130]$\n  - $P2 = [90, 110, 100]$\n  - $A1 = [130, 180, 195]$\n  - $A2 = [100, 120, 150]$\n\n- 测试用例 $4$（具有负协方差和近似恒定总差异的补偿性顺式和反式效应）：\n  - $P1 = [149.182, 164.100, 134.264]$\n  - $P2 = [100, 110, 90]$\n  - $A1 = [255.0966, 146.600, 214.333]$\n  - $A2 = [140, 120, 130]$\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，包含一个长度为 $4$ 的列表，其中每个元素按顺序对应一个测试用例。\n- 每个元素必须是一个包含六个浮点数的列表，四舍五入到六位小数，顺序如下：$[\\,\\overline{c},\\,\\overline{t},\\,f_{\\mathrm{cis}},\\,f_{\\mathrm{trans}},\\,f_{\\mathrm{cov}},\\,\\mathrm{Cov}(c,t)\\,]$。\n- 整个输出必须打印为表示Python风格嵌套列表的单行，使用方括号，例如：$\"[[x_{11},x_{12},\\dots,x_{16}],[x_{21},\\dots,x_{26}],\\dots]\"$，不含任何附加文本。", "solution": "该问题要求将两个谱系之间基因表达的差异分解为可归因于顺式和反式调控演化的组分。所提供的概念模型是进化基因组学中的一个标准框架，它假定基因表达是顺式作用元件和反式作用因子的乘积函数。这个问题在科学上是合理的，在数学上是适定的。我们将首先形式化该模型，然后从第一性原理推导出必要的量。\n\n该模型假设，对于一个给定的基因，其表达水平 $E$ 是顺式调控贡献 $C$ 和反式调控贡献 $T$ 的乘积。\n$$E = C \\cdot T$$\n通过取自然对数，这种乘法关系被线性化，将模型转化为加法模型。\n$$\\ln(E) = \\ln(C) + \\ln(T)$$\n这种加法形式更适合于分析和方差分解。我们用小写字母表示对数转换后的量，例如 $c = \\ln(C)$。\n\n我们获得了每次重复 $i$ 来自四个来源的表达数据：谱系 $1$ 的亲本 ($P1_i$)、谱系 $2$ 的亲本 ($P2_i$)、F1 杂交体中来自谱系 $1$ 的等位基因 ($A1_i$)，以及 F1 杂交体中来自谱系 $2$ 的等位基因 ($A2_i$)。我们可以将这些实验测量值映射到对数加法模型。设 $c_1$ 和 $c_2$ 分别是来自谱系 $1$ 和谱系 $2$ 的等位基因的顺式调控效应。设 $t_1$ 和 $t_2$ 分别是亲本谱系 $1$ 和 $2$ 的反式调控环境，设 $h$ 是 F1 杂交体中的共同反式调控环境。对于给定的重复 $i$，我们可以写出：\n$$ \\ln(P1_i) = c_{1,i} + t_{1,i} $$\n$$ \\ln(P2_i) = c_{2,i} + t_{2,i} $$\n$$ \\ln(A1_i) = c_{1,i} + h_i $$\n$$ \\ln(A2_i) = c_{2,i} + h_i $$\n下标 $i$ 表明每次重复测量都有其自身的这些潜在效应的实现，这考虑了生物学和技术的变异性。\n\n问题要求为每次重复 $i$ 计算三个量：总差异 $d_i$、顺式调控差异 $c_i$ 和反式调控差异 $t_i$。\n\n$1$. 亲本间的总对数差异 $d_i$ 定义为其对数表达水平的差值。\n$$ d_i = \\ln(P1_i) - \\ln(P2_i) = (c_{1,i} - c_{2,i}) + (t_{1,i} - t_{2,i}) $$\n这个量代表了两个谱系之间累积的总差异，包括顺式和反式效应。\n\n$2$. 顺式调控差异 $c_i$ 是通过比较在相同杂交体反式环境 ($h_i$) 中的两个不同等位基因（$A1_i$ 和 $A2_i$）的表达来分离的。任何差异都必须归因于顺式调控序列。\n$$ c_i = \\ln(A1_i) - \\ln(A2_i) = (c_{1,i} + h_i) - (c_{2,i} + h_i) = c_{1,i} - c_{2,i} $$\n这个表达式正确地分离了两个等位基因顺式调控效应之间的差异。\n\n$3$. 反式调控差异 $t_i$ 是总差异中不能由顺式效应解释的部分。鉴于对数转换模型的加性性质，其中 $d_i$ 是总顺式和反式差异之和，我们有 $d_i = c_i + t_i$。因此，我们可以通过相减得到 $t_i$：\n$$ t_i = d_i - c_i = (\\ln(P1_i) - \\ln(P2_i)) - (\\ln(A1_i) - \\ln(A2_i)) $$\n代入模型组分可以证实，这分离了反式环境中的差异。\n$$ t_i = \\left( (c_{1,i} - c_{2,i}) + (t_{1,i} - t_{2,i}) \\right) - (c_{1,i} - c_{2,i}) = t_{1,i} - t_{2,i} $$\n\n计算出每次重复的向量 $\\{c_i\\}$ 和 $\\{t_i\\}$（$i=1, \\dots, n$）后，我们进行统计分析。我们计算样本均值 $\\overline{c}$ 和 $\\overline{t}$，以及使用分母为 $(n-1)$ 的无偏样本方差和协方差：\n$$ \\overline{c} = \\frac{1}{n} \\sum_{i=1}^{n} c_i \\quad\\quad \\overline{t} = \\frac{1}{n} \\sum_{i=1}^{n} t_i $$\n$$ \\mathrm{Var}(c) = \\frac{1}{n-1} \\sum_{i=1}^{n} (c_i - \\overline{c})^2 $$\n$$ \\mathrm{Var}(t) = \\frac{1}{n-1} \\sum_{i=1}^{n} (t_i - \\overline{t})^2 $$\n$$ \\mathrm{Cov}(c,t) = \\frac{1}{n-1} \\sum_{i=1}^{n} (c_i - \\overline{c})(t_i - \\overline{t}) $$\n总差异的方差 $\\mathrm{Var}(d)$ 也是必需的。由于 $d_i = c_i + t_i$，根据方差的性质，我们有：\n$$ \\mathrm{Var}(d) = \\mathrm{Var}(c+t) = \\mathrm{Var}(c) + \\mathrm{Var}(t) + 2\\mathrm{Cov}(c,t) $$\n最后一步是将这个总方差分解为来自顺式差异、反式差异及其协方差的分数贡献。这些分数定义为：\n$$ f_{\\mathrm{cis}} = \\frac{\\mathrm{Var}(c)}{\\mathrm{Var}(d)} $$\n$$ f_{\\mathrm{trans}} = \\frac{\\mathrm{Var}(t)}{\\mathrm{Var}(d)} $$\n$$ f_{\\mathrm{cov}} = \\frac{2\\mathrm{Cov}(c,t)}{\\mathrm{Var}(d)} $$\n根据定义，这些分数的和必须为 $1$。算法将为所提供的每个测试用例计算这些量。实现将使用 `numpy` 进行对数、差值、均值、方差和协方差的向量化计算，确保遵循指定的统计定义（例如，使用自由度差量为 $1$ 来获得无偏样本估计）。所有最终的浮点数结果将按要求四舍五入到六位小数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the decomposition of gene expression divergence into cis, trans,\n    and covariance components for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (\n            [182.211, 181.2375, 173.115], # P1\n            [100, 90, 105], # P2\n            [179.018, 181.359, 169.415], # A1\n            [120, 110, 130], # A2\n        ),\n        (\n            [150, 160, 99], # P1\n            [100, 80, 90], # P2\n            [120, 100, 105], # A1\n            [120, 100, 105], # A2\n        ),\n        (\n            [117, 165, 130], # P1\n            [90, 110, 100], # P2\n            [130, 180, 195], # A1\n            [100, 120, 150], # A2\n        ),\n        (\n            [149.182, 164.100, 134.264], # P1\n            [100, 110, 90], # P2\n            [255.0966, 146.600, 214.333], # A1\n            [140, 120, 130], # A2\n        ),\n    ]\n\n    all_results = []\n    for P1, P2, A1, A2 in test_cases:\n        # Convert lists to numpy arrays for vectorized operations.\n        P1_arr = np.array(P1, dtype=np.float64)\n        P2_arr = np.array(P2, dtype=np.float64)\n        A1_arr = np.array(A1, dtype=np.float64)\n        A2_arr = np.array(A2, dtype=np.float64)\n\n        # Take natural logarithms.\n        log_P1 = np.log(P1_arr)\n        log_P2 = np.log(P2_arr)\n        log_A1 = np.log(A1_arr)\n        log_A2 = np.log(A2_arr)\n\n        # Compute replicate-wise quantities d, c, and t.\n        # d: total log-divergence between parents.\n        # c: cis-regulatory log-divergence from allele-specific expression in hybrid.\n        # t: trans-regulatory log-divergence derived from the additive model.\n        d = log_P1 - log_P2\n        c = log_A1 - log_A2\n        t = d - c\n\n        # Compute sample means.\n        mean_c = np.mean(c)\n        mean_t = np.mean(t)\n        \n        # Compute unbiased sample variances (ddof=1 for n-1 denominator).\n        # Check for case with n  2, where variance is not defined.\n        n = len(P1)\n        if n  2:\n            # According to problem constraints (n=3), this block is not reached.\n            # Define behavior for this edge case if necessary.\n            # Here we can set variances to 0, which would lead to NaN for fractions.\n            var_d = 0.0\n            var_c = 0.0\n            var_t = 0.0\n            cov_ct = 0.0\n        else:\n            var_d = np.var(d, ddof=1)\n            var_c = np.var(c, ddof=1)\n            var_t = np.var(t, ddof=1)\n            # Compute unbiased sample covariance matrix.\n            cov_matrix = np.cov(c, t, ddof=1)\n            cov_ct = cov_matrix[0, 1]\n\n        # Calculate fractional contributions to variance.\n        # Handle division by zero if Var(d) is zero.\n        if var_d == 0.0:\n            # If total divergence is constant, fractions are not well-defined.\n            # This indicates either no variation or perfect compensation.\n            # Depending on context, interpretation varies. In this problem,\n            # test cases are designed to have Var(d)  0.\n            f_cis, f_trans, f_cov = np.nan, np.nan, np.nan\n        else:\n            f_cis = var_c / var_d\n            f_trans = var_t / var_d\n            f_cov = 2 * cov_ct / var_d\n\n        # Assemble the list of results for the current test case.\n        result = [mean_c, mean_t, f_cis, f_trans, f_cov, cov_ct]\n        \n        # Round all values to six decimal places.\n        rounded_result = [round(x, 6) for x in result]\n        all_results.append(rounded_result)\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list includes spaces after commas.\n    # The requirement seems to want no spaces, so we remove them.\n    # Example: \"[[v1,v2],[v3,v4]]\"\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "2696994"}, {"introduction": "最后的这个练习将我们从测量与统计分析转向了进化理论的根基，旨在回答一个根本性问题：顺式和反式效应为何会以特定的方式演化？本练习引入了稳定选择（stabilizing selection）和多效性成本（pleiotropic costs）这两个核心概念，它们是塑造基因表达水平的关键进化力量。通过在一个理论模型中推导最优的顺式调控状态，你将能够把分子机制与适应性后果联系起来，并从理论上理解杂交后代中常见的表达异常（hybrid misexpression）现象，是如何作为谱系特异性适应的必然结果而出现的[@problem_id:2697006]。", "problem": "考虑一个单个二倍体基因，其信使核糖核酸（mRNA）表达量与其谱系特异性最适值的偏差由一个顺式作用组分和一个反式作用组分加性决定。设表达量与最适值的偏差表示为 $E - E^{*}$，其中 $E^{*}$ 是维持生存能力的最适表达水平。在每个谱系 $i \\in \\{1,2\\}$ 中，设反式作用背景使表达量偏移 $t_{i}$（由于其对许多其他基因的影响所产生的约束，该值在该谱系中为常数），并设焦点基因处的可演化顺式作用修饰为 $c_{i}$。假设适合度具有以下广泛使用的结构：\n- 围绕最适值的表达量上的稳定选择呈高斯分布，曲率 $S0$，因此与表达相关的适合度组分为 $\\exp\\!\\big(-\\tfrac{S}{2}(E-E^{*})^{2}\\big)$。\n- 顺式调控变化会产生多效性代价，该代价与其大小的平方成正比，系数为 $\\alpha0$，贡献一个乘法因子 $\\exp\\!\\big(-\\tfrac{\\alpha}{2}c_{i}^{2}\\big)$。\n- 反式调控背景会产生多效性代价，该代价与其大小的平方成正比，系数为 $\\gamma0$，贡献一个乘法因子 $\\exp\\!\\big(-\\tfrac{\\gamma}{2}t_{i}^{2}\\big)$；然而，在谱系 $i$ 中，$t_{i}$ 受到对其他基因的选择的外部约束（即，在谱系 $i$ 中优化 $c_{i}$ 时，将 $t_{i}$ 视为常数）。\n\n在每个谱系 $i$ 中，表达偏差为 $E-E^{*}=c_{i}+t_{i}$，焦点基因和多效性惩罚的总适合度是上述三个因子的乘积。\n\n现在考虑两个谱系之间进行杂交，形成子一代（F1）杂种。在 F1 代中，假设：\n- 反式作用环境是共显性和加性的，产生 $(t_{1}+t_{2})/2$ 的杂种反式效应。\n- 每个等位基因保留其自身的顺式调控序列，且等位基因对总表达量的贡献在剂量上相等，因此对杂种总表达量的顺式贡献是平均值 $(c_{1}+c_{2})/2$。\n\n假设在每个亲本谱系 $i$ 中，顺式修饰因子 $c_{i}$ 已经演化到在给定 $t_{i}$ 的情况下使总适合度最大化，请仅用 $S$、$\\alpha$、$t_{1}$ 和 $t_{2}$ 导出一个关于 F1 杂种平均表达量与最适值偏差 $(E_{\\mathrm{F1}}-E^{*})$ 的闭式表达式。请以一个无单位的简化解析表达式给出最终答案。", "solution": "所给出的问题陈述具有科学依据、提法恰当且内部一致。它描述了演化遗传学中一个关于基因表达上选择力平衡的标准理论模型。我们将着手进行其形式化求解。\n\n对于谱系 $i \\in \\{1, 2\\}$ 中的一个二倍体个体，其总适合度 $W_i$ 由三个组分的乘积给出：对表达水平的稳定选择、顺式调控的多效性代价以及反式调控背景的多效性代价。其表达式为：\n$$\nW_i(c_i) = \\exp\\left(-\\frac{S}{2}(E-E^{*})^{2}\\right) \\exp\\left(-\\frac{\\alpha}{2}c_{i}^{2}\\right) \\exp\\left(-\\frac{\\gamma}{2}t_{i}^{2}\\right)\n$$\n其中 $c_i$ 是顺式作用修饰，$t_i$ 是反式作用背景效应。与最适表达的偏差由加性模型 $E-E^{*} = c_i + t_i$ 给出。将此代入适合度函数可得：\n$$\nW_i(c_i) = \\exp\\left(-\\frac{S}{2}(c_i + t_i)^{2} - \\frac{\\alpha}{2}c_{i}^{2} - \\frac{\\gamma}{2}t_{i}^{2}\\right)\n$$\n为了找到使适合度最大化的 $c_i$ 值，我们可以等价地最大化对数适合度 $w_i(c_i) = \\ln(W_i(c_i))$，因为对数是严格单调函数。\n$$\nw_i(c_i) = -\\frac{S}{2}(c_i + t_i)^{2} - \\frac{\\alpha}{2}c_{i}^{2} - \\frac{\\gamma}{2}t_{i}^{2}\n$$\n问题陈述指出，$c_i$ 的演化是为了在给定常数 $t_i$ 的情况下最大化适合度。因此，我们通过对 $w_i(c_i)$ 关于 $c_i$ 求导并令其为零来找到最大值。涉及 $\\gamma$ 的项相对于 $c_i$ 是常数，因此不影响优化过程。\n$$\n\\frac{d w_i}{d c_i} = \\frac{d}{d c_i} \\left( -\\frac{S}{2}(c_i + t_i)^{2} - \\frac{\\alpha}{2}c_{i}^{2} \\right) = -S(c_i + t_i) - \\alpha c_i\n$$\n将导数设为零，定义了最适的顺式作用修饰，我们记为 $c_i^*$：\n$$\n-S(c_i^* + t_i) - \\alpha c_i^* = 0\n$$\n$$\n-S t_i = S c_i^* + \\alpha c_i^*\n$$\n$$\n-S t_i = (S + \\alpha) c_i^*\n$$\n解出 $c_i^*$ 得：\n$$\nc_i^* = -\\frac{S}{S + \\alpha} t_i\n$$\n这个结果是一个最大值，因为在给定条件 $S  0$ 和 $\\alpha  0$ 下，二阶导数 $\\frac{d^2 w_i}{d c_i^2} = -S - \\alpha$ 是严格为负的。这个最适顺式效应的表达式适用于两个亲本谱系，即 $i=1$ 和 $i=2$。因此，我们有：\n$$\nc_1^* = -\\frac{S}{S + \\alpha} t_1 \\quad \\text{和} \\quad c_2^* = -\\frac{S}{S + \\alpha} t_2\n$$\n接下来，我们考虑子一代（F1）杂种。问题指明反式作用环境是加性的，产生的杂种反式效应为 $t_{\\mathrm{F1}} = \\frac{t_1 + t_2}{2}$。类似地，对总表达量的顺式贡献是亲本等位基因的平均值，$c_{\\mathrm{F1}} = \\frac{c_1 + c_2}{2}$。F1 杂种中总表达量与最适值的偏差是这些效应的总和：\n$$\nE_{\\mathrm{F1}}-E^{*} = c_{\\mathrm{F1}} + t_{\\mathrm{F1}} = \\frac{c_1 + c_2}{2} + \\frac{t_1 + t_2}{2}\n$$\n我们必须使用亲本顺式效应的最适值 $c_1^*$ 和 $c_2^*$，因为问题假设亲本谱系已经演化至各自的适合度最大值。代入 $c_1^*$ 和 $c_2^*$ 的表达式：\n$$\nE_{\\mathrm{F1}}-E^{*} = \\frac{1}{2}\\left(-\\frac{S}{S + \\alpha} t_1 - \\frac{S}{S + \\alpha} t_2\\right) + \\frac{t_1 + t_2}{2}\n$$\n我们可以提取公因式：\n$$\nE_{\\mathrm{F1}}-E^{*} = -\\frac{S}{2(S + \\alpha)}(t_1 + t_2) + \\frac{1}{2}(t_1 + t_2)\n$$\n$$\nE_{\\mathrm{F1}}-E^{*} = \\left(1 - \\frac{S}{S + \\alpha}\\right)\\left(\\frac{t_1 + t_2}{2}\\right)\n$$\n简化第一个括号中的表达式：\n$$\n1 - \\frac{S}{S + \\alpha} = \\frac{S + \\alpha}{S + \\alpha} - \\frac{S}{S + \\alpha} = \\frac{S + \\alpha - S}{S + \\alpha} = \\frac{\\alpha}{S + \\alpha}\n$$\n将这个简化后的项代回 F1 表达偏差的方程，得到最终结果：\n$$\nE_{\\mathrm{F1}}-E^{*} = \\left(\\frac{\\alpha}{S + \\alpha}\\right)\\left(\\frac{t_1 + t_2}{2}\\right) = \\frac{\\alpha(t_1 + t_2)}{2(S + \\alpha)}\n$$\n此表达式仅包含所要求的参数 $S$、$\\alpha$、$t_1$ 和 $t_2$。", "answer": "$$\n\\boxed{\\frac{\\alpha(t_1 + t_2)}{2(S + \\alpha)}}\n$$", "id": "2697006"}]}