{"hands_on_practices": [{"introduction": "进化拯救通常不仅仅是单个突变的结果，它可能需要多个遗传步骤。这个练习探讨了一个核心场景：一个种群如何通过一个两步突变路径实现拯救，即使中间突变体是有害的。通过应用随机过程理论的基本原理，你将推导出在这种“与时间赛跑”的情境下，种群整体的拯救概率，从而深入理解“随机隧道”这一关键概念[@problem_id:2698500]。", "problem": "一个克隆微生物种群在时间 $t=0$ 时经历了一次突发性的环境恶化，这使得祖先基因型（记作 $A_{0}$）变得适应不良。假设存在连续时间的出生-死亡动态过程，所有基因型的个体出生率固定为 $b=1$，而特定于基因型的马尔萨斯参数 $r_{i}=b-d_{i}$ 由死亡率 $d_{i}$ 决定。祖先基因型的马尔萨斯参数 $r_{0}  0$，因此在没有演化拯救的情况下，种群数量会按 $N(t)=N_{0}\\exp(r_{0} t)$ 的规律确定性地衰减，并最终灭绝。突变在细胞分裂事件中发生。\n\n演化拯救需要两次突变，并通过两条不同的突变路径表现出上位性效应和路径依赖性，这两条路径会产生具有不同增长率的不同拯救基因型：\n\n- 路径 B：$A_{0} \\xrightarrow{u_{b}} B \\xrightarrow{v_{b}} R^{(b)}$，其中中间基因型 B 的参数 $r_{B}  0$，最终拯救基因型 $R^{(b)}$ 的参数 $r_{R}^{(b)} > 0$。\n- 路径 C：$A_{0} \\xrightarrow{u_{c}} C \\xrightarrow{v_{c}} R^{(c)}$，其中中间基因型 C 的参数 $r_{C}  0$，最终拯救基因型 $R^{(c)}$ 的参数 $r_{R}^{(c)} > 0$。\n\n假设采用以下标准且经过充分检验的近似方法：（i）新突变体出现的稀有突变、独立事件（泊松）近似；（ii）在一个 $b=1$ 的线性出生-死亡过程中，一个 $r>0$ 的稀有超临界世系的精确建立概率为 $p_{\\mathrm{est}}=r$；（iii）一个 $r0$ 且 $b=1$ 的稀有亚临界世系，在其整个世系存活期间产生的预期总出生次数等于 $E[X]=\\frac{1}{-r}$。\n\n参数值如下：\n- 初始种群大小 $N_{0}=1.2\\times 10^{11}$。\n- 祖先基因型的马尔萨斯参数 $r_{0}=-0.1$。\n- 第一步突变率 $u_{b}=2.0\\times 10^{-7}$ 和 $u_{c}=5.0\\times 10^{-8}$（每次出生）。\n- 中间基因型的增长参数 $r_{B}=-0.02$ 和 $r_{C}=-0.05$。\n- 第二步突变率 $v_{b}=1.0\\times 10^{-6}$ 和 $v_{c}=1.5\\times 10^{-6}$（每次出生）。\n- 拯救基因型的增长参数 $r_{R}^{(b)}=0.04$ 和 $r_{R}^{(c)}=0.02$。\n\n仅使用上述基本原理，并忽略成功拯救世系之间的密度依赖和克隆干扰，从第一性原理推导出演化拯救总概率 $P_{\\mathrm{rescue}}$ 的闭式表达式，该表达式应考虑到所描述的两步、上位性效应和路径依赖结构。然后，根据给定的参数值计算 $P_{\\mathrm{rescue}}$。将最终数值答案以小数形式报告，并四舍五入到四位有效数字。请勿使用百分号。", "solution": "问题陈述已经过验证，被认为是科学上可靠、定义明确且客观的。它提供了一套来自演化理论的、自洽且一致的定义、参数和既定近似，从而能够得出一个严谨且唯一的解。我将开始进行推导。\n\n演化拯救的总概率 $P_{\\mathrm{rescue}}$，是至少有一个成功的拯救世系出现并建立的概率。根据所提供的稀有、独立事件近似，成功的拯救世系总数服从泊松分布。因此，拯救的概率为 $P_{\\mathrm{rescue}} = 1 - P(\\text{没有拯救})$。如果 $\\Lambda_{\\mathrm{rescue}}$ 是成功拯救世系的总预期数量，那么没有拯救的概率就是 $\\exp(-\\Lambda_{\\mathrm{rescue}})$。因此，问题简化为计算 $\\Lambda_{\\mathrm{rescue}}$。\n\n$$P_{\\mathrm{rescue}} = 1 - \\exp(-\\Lambda_{\\mathrm{rescue}})$$\n\n问题指明了 B 和 C 两条独立的突变路径，并明确说明要忽略克隆干扰。因此，成功拯救世系的总预期数量是来自每条路径的预期数量之和：\n\n$$\\Lambda_{\\mathrm{rescue}} = \\Lambda_{b} + \\Lambda_{c}$$\n\n此处，$\\Lambda_{b}$ 和 $\\Lambda_{c}$ 分别是通过路径 B 和 C 产生的成功拯救世系的预期数量。我们必须为每一个推导出表达式。\n\n考虑路径 B：$A_{0} \\xrightarrow{u_{b}} B \\xrightarrow{v_{b}} R^{(b)}$。\n在时间 $t$ 时，B 型中间突变体的产生速率由祖先种群大小 $N(t)$、个体出生率 $b=1$ 和突变率 $u_{b}$ 的乘积给出。祖先种群按 $N(t) = N_{0}\\exp(r_{0} t)$ 确定性地衰减。\n新 B 突变体出现的速率为：\n$$ \\text{Rate}_{A_{0}\\to B}(t) = N(t) \\cdot b \\cdot u_{b} = N_{0}u_{b}\\exp(r_{0}t) $$\n每个新形成的 B 突变体都会建立一个世系。该世系是亚临界的，其马尔萨斯参数 $r_{B}  0$。根据提供的近似（iii），这样一个亚临界世系在其整个生命周期内产生的预期总出生次数为 $E[X_{B}] = \\frac{1}{-r_{B}}$。\n\nB 世系内的每一次出生都是一次向拯救基因型 $R^{(b)}$ 发生第二次突变的机会，其发生率为每次出生 $v_b$。因此，单个 B 世系产生的 $R^{(b)}$ 突变体的预期数量为：\n$$ E[N_{R^{(b)}} | \\text{1 B-lineage}] = v_{b} \\cdot E[X_{B}] = \\frac{v_{b}}{-r_{B}} $$\n拯救基因型 $R^{(b)}$ 是超临界的，其马尔萨斯参数 $r_{R}^{(b)} > 0$。根据近似（ii），单个 $R^{(b)}$ 突变体建立一个成功的、增长的世系的概率为 $p_{\\mathrm{est}}^{(b)} = r_{R}^{(b)}$。\n\n综合这些结果，单个新 B 突变体产生一个成功拯救世系的概率是其产生的 $R^{(b)}$ 突变体的预期数量乘以它们的建立概率：\n$$ P(\\text{rescue} | \\text{1 B-mutant}) = E[N_{R^{(b)}} | \\text{1 B-lineage}] \\cdot p_{\\mathrm{est}}^{(b)} = \\frac{v_{b}}{-r_{B}} \\cdot r_{R}^{(b)} $$\n在时间 $t$ 通过路径 B 产生成功拯救世系的速率，记为 $\\lambda_{b}(t)$，是 B 突变体的产生速率乘以每个突变体导致拯救的概率：\n$$ \\lambda_{b}(t) = \\text{Rate}_{A_{0}\\to B}(t) \\cdot P(\\text{rescue} | \\text{1 B-mutant}) = N_{0}u_{b}\\exp(r_{0}t) \\frac{v_{b}r_{R}^{(b)}}{-r_{B}} $$\n来自路径 B 的成功拯救世系的总预期数量 $\\Lambda_{b}$，是这个速率在所有时间上（从 $t=0$ 到 $\\infty$）的积分：\n$$ \\Lambda_{b} = \\int_{0}^{\\infty} \\lambda_{b}(t) \\,dt = \\int_{0}^{\\infty} N_{0}u_{b} \\frac{v_{b}r_{R}^{(b)}}{-r_{B}} \\exp(r_{0}t) \\,dt $$\n由于项 $N_{0}u_{b}\\frac{v_{b}r_{R}^{(b)}}{-r_{B}}$ 是常数，我们可以将其从积分中提出：\n$$ \\Lambda_{b} = N_{0}u_{b} \\frac{v_{b}r_{R}^{(b)}}{-r_{B}} \\int_{0}^{\\infty} \\exp(r_{0}t) \\,dt $$\n该积分的计算结果为：\n$$ \\int_{0}^{\\infty} \\exp(r_{0}t) \\,dt = \\left[ \\frac{1}{r_{0}}\\exp(r_{0}t) \\right]_{0}^{\\infty} = 0 - \\frac{1}{r_{0}} = \\frac{-1}{r_{0}} \\quad (\\text{因为 } r_{0}  0) $$\n将此结果代回，得到 $\\Lambda_{b}$ 的表达式：\n$$ \\Lambda_{b} = N_{0}u_{b} \\frac{v_{b}r_{R}^{(b)}}{-r_{B}} \\left( \\frac{-1}{r_{0}} \\right) = \\frac{N_{0}u_{b}v_{b}r_{R}^{(b)}}{r_{0}r_{B}} $$\n根据相同的逻辑，来自路径 C 的成功拯救世系的预期数量的表达式为：\n$$ \\Lambda_{c} = \\frac{N_{0}u_{c}v_{c}r_{R}^{(c)}}{r_{0}r_{C}} $$\n拯救世系的总预期数量是这两项之和。因此，拯救总概率的闭式表达式为：\n$$ P_{\\mathrm{rescue}} = 1 - \\exp\\left( -\\left( \\frac{N_{0}u_{b}v_{b}r_{R}^{(b)}}{r_{0}r_{B}} + \\frac{N_{0}u_{c}v_{c}r_{R}^{(c)}}{r_{0}r_{C}} \\right) \\right) = 1 - \\exp\\left( -\\frac{N_{0}}{r_{0}}\\left( \\frac{u_{b}v_{b}r_{R}^{(b)}}{r_{B}} + \\frac{u_{c}v_{c}r_{R}^{(c)}}{r_{C}} \\right) \\right) $$\n现在，我们代入所提供的参数值以获得数值结果。\n参数为：\n$N_{0}=1.2\\times 10^{11}$, $r_{0}=-0.1$。\n对于路径 B：$u_{b}=2.0\\times 10^{-7}$，$r_{B}=-0.02$，$v_{b}=1.0\\times 10^{-6}$，$r_{R}^{(b)}=0.04$。\n对于路径 C：$u_{c}=5.0\\times 10^{-8}$，$r_{C}=-0.05$，$v_{c}=1.5\\times 10^{-6}$，$r_{R}^{(c)}=0.02$。\n\n首先，计算 $\\Lambda_{b}$：\n$$ \\Lambda_{b} = \\frac{(1.2\\times 10^{11})(2.0\\times 10^{-7})(1.0\\times 10^{-6})(0.04)}{(-0.1)(-0.02)} = \\frac{9.6 \\times 10^{-4}}{0.002} = 0.48 $$\n接着，计算 $\\Lambda_{c}$：\n$$ \\Lambda_{c} = \\frac{(1.2\\times 10^{11})(5.0\\times 10^{-8})(1.5\\times 10^{-6})(0.02)}{(-0.1)(-0.05)} = \\frac{1.8 \\times 10^{-4}}{0.005} = 0.036 $$\n成功的拯救世系的总预期数量是：\n$$ \\Lambda_{\\mathrm{rescue}} = \\Lambda_{b} + \\Lambda_{c} = 0.48 + 0.036 = 0.516 $$\n最后，总的拯救概率是：\n$$ P_{\\mathrm{rescue}} = 1 - \\exp(-\\Lambda_{\\mathrm{rescue}}) = 1 - \\exp(-0.516) \\approx 1 - 0.596899... \\approx 0.403100... $$\n四舍五入到四位有效数字，最终结果为 $0.4031$。", "answer": "$$\\boxed{0.4031}$$", "id": "2698500"}, {"introduction": "性繁殖的优势是演化生物学中的一个经典问题，尤其是在快速适应新环境的背景下。这个练习提供了一个定量的框架，用于比较有性生殖和无性生殖系统在利用现有遗传变异组合出“拯救”基因型方面的效率[@problem_id:2698501]。通过计算临界重组率，你将探索重组如何能够将不同个体中的有利等位基因汇集在一起，从而加速适应，这对于理解不同物种的进化潜力至关重要。", "problem": "一个初始普查规模为 $N_{0}$ 的泛交、专性异交二倍体种群，在时间 $t=0$ 时经历了一次突发的环境变化，该变化降低了绝对适应度，使得野生型纯合子的马尔萨斯增长率为负，即 $m_{00}  0$。考虑 $2$ 个不连锁的基因座，分别标记为 $A$ 和 $B$，每个基因座上都有一个衍生等位基因（$A$ 或 $B$）和一个祖先等位基因（$0$）。在环境变化之前，存留变异仅包含以低频率存在的单基因座杂合子，且处于连锁平衡状态：$A0/00$ 杂合子的频率为 $p_{A}\\ll 1$，$0B/00$ 杂合子的频率为 $p_{B}\\ll 1$，不存在携带 $AB$ 的个体。环境变化后：\n\n- 单基因座杂合子的马尔萨斯增长率分别为 $m_{A\\!h}=m_{00}+h_{A}s_{A}$ 和 $m_{B\\!h}=m_{00}+h_{B}s_{B}$，其中 $h_{A}$ 和 $h_{B}$ 是显性系数，$s_{A}$ 和 $s_{B}$ 分别是基因座 $A$ 和 $B$ 相对于野生型基线的纯合效应。假设 $m_{A\\!h}  0$ 和 $m_{B\\!h}  0$，并进一步假设 $m_{A\\!h}  m_{00}$ 且 $m_{B\\!h}  m_{00}$（即在野生型背景下，杂合子是有害的）。\n- 双基因座杂合子 $A0//0B$（反式）的增长率为 $m_{AB|t}=m_{A\\!h}+m_{B\\!h}-m_{00}$。\n- 只有一种基因型可以实现演化拯救：双基因座杂合子 $AB/00$（顺式），其马尔萨斯增长率为 $m_{AB\\!h} = m_{00}+h_{A}s_{A}+h_{B}s_{B}+\\epsilon_{h}$，其中 $\\epsilon_{h}$ 是杂合子之间的正向上位效应，使得 $m_{AB\\!h}>0$。\n\n在有性繁殖系统中，拯救基因型 $AB/00$ 是由 $A0//0B$ 个体中的重组产生的，其重组率为 $r \\in [0,0.5]$。假设 $A0//0B$ 合子的产生速率为 $n_{A\\!h}(t)n_{B\\!h}(t)/n_{00}(t)$，其中 $n_{i}(t)$ 是基因型 $i$ 在时间 $t$ 的个体数，并假设 $p_{A},p_{B}\\ll 1$。\n在无性繁殖系统中，拯救基因型是通过在任一单基因座杂合子谱系中发生第二次突变而产生的，每个位点的突变率为 $u$。\n对于二倍体，一个稀有基因型的定植概率为 $2m$，其中 $m$ 是其马尔萨斯参数。假设两种系统中的突变和重组事件都是稀有的，并且不考虑克隆干扰。\n\n从第一性原理推导临界重组率 $r_{c}$ 的封闭形式表达式，在该值下，有性繁殖系统和无性繁殖系统中已定植拯救谱系的期望数量是相等的。您的答案应仅使用参数 $u, p_{A}, p_{B}, m_{00}, h_{A}, h_{B}, s_{A}, s_{B}$ 表示。", "solution": "该问题要求推导临界重组率 $r_{c}$，在该值下，有性繁殖种群和无性繁殖种群的已定植拯救谱系的期望数量相同。基本方法是为每种繁殖系统计算这个期望数量，然后令两个表达式相等。\n\n已定植谱系的期望数量，记为 $E$，是随时间产生的拯救合子（$AB/00$）总数与其定植概率的乘积。合子总数是其产生速率的时间积分。对于一个具有正马尔萨斯增长率 $m$ 的稀有基因型，其定植概率为 $P_{est} = 2m$。对于拯救基因型 $AB/00$，此概率为 $P_{est} = 2m_{AB\\!h}$，因为已知 $m_{AB\\!h} > 0$。\n\n令 $E_{sex}$ 为有性系统中的期望定植谱系数量，$E_{asex}$ 为无性系统中的相同数量。问题要求解出 $r$ 的值，我们称之为 $r_c$，使得 $E_{sex} = E_{asex}$。\n\n首先，我们计算有性系统的期望定植谱系数量。\n在时间 $t$，$A0//0B$ 个体（反式双杂合子）产生的速率是其父母（一个 $A0/00$ 和一个 $0B/00$）相遇并交配的速率，近似为 $2 \\cdot \\frac{n_{A\\!h}(t)}{N_0} \\cdot \\frac{n_{B\\!h}(t)}{N_0} \\cdot N_0 \\approx \\frac{2 n_{A\\!h}(t)n_{B\\!h}(t)}{N_0}$。然而，问题给出了产生 $A0//0B$ *合子*的速率为 $n_{A\\!h}(t)n_{B\\!h}(t)/n_{00}(t)$。我们将遵循这个给定的速率。这些个体接着会以 $r$ 的比率产生 $AB$ 配子。因此，拯救合子 $AB/00$ 的产生速率为：\n$$ \\text{Rate}_{sex}(t) = r \\frac{n_{A\\!h}(t) n_{B\\!h}(t)}{n_{00}(t)} $$\n每种基因型的个体数量遵循指数动态：\n$n_{A\\!h}(t) = n_{A\\!h}(0)\\exp(m_{A\\!h}t) = N_{0}p_{A}\\exp(m_{A\\!h}t)$\n$n_{B\\!h}(t) = n_{B\\!h}(0)\\exp(m_{B\\!h}t) = N_{0}p_{B}\\exp(m_{B\\!h}t)$\n$n_{00}(t) \\approx N_{0}\\exp(m_{00}t)$\n\n将这些代入速率方程中得到：\n$$ \\text{Rate}_{sex}(t) = r \\frac{(N_{0}p_{A}\\exp(m_{A\\!h}t))(N_{0}p_{B}\\exp(m_{B\\!h}t))}{N_{0}\\exp(m_{00}t)} = r N_{0} p_{A} p_{B} \\exp((m_{A\\!h} + m_{B\\!h} - m_{00})t) $$\n产生的 $AB/00$ 合子总数 $N_{prod, sex}$ 是该速率从 $t=0$ 到 $t=\\infty$ 的积分：\n$$ N_{prod, sex} = \\int_{0}^{\\infty} \\text{Rate}_{sex}(t) dt = r N_{0} p_{A} p_{B} \\int_{0}^{\\infty} \\exp((m_{A\\!h} + m_{B\\!h} - m_{00})t) dt $$\n积分是收敛的，因为指数的系数为负。这是因为 $m_{A\\!h}  m_{00}$ 且 $m_{B\\!h}  m_{00}$（问题中给出的假设），这意味着 $m_{A\\!h} + m_{B\\!h}  2m_{00}$，所以 $m_{A\\!h} + m_{B\\!h} - m_{00}  m_{00}  0$。令 $k_{sex} = m_{A\\!h} + m_{B\\!h} - m_{00}$。\n$$ N_{prod, sex} = r N_{0} p_{A} p_{B} \\left[ \\frac{\\exp(k_{sex}t)}{k_{sex}} \\right]_{0}^{\\infty} = r N_{0} p_{A} p_{B} \\left( 0 - \\frac{1}{k_{sex}} \\right) = -\\frac{r N_{0} p_{A} p_{B}}{m_{A\\!h} + m_{B\\!h} - m_{00}} $$\n期望的定植谱系数量为：\n$$ E_{sex} = N_{prod, sex} \\times P_{est} = \\left(-\\frac{r N_{0} p_{A} p_{B}}{m_{A\\!h} + m_{B\\!h} - m_{00}}\\right) \\times (2m_{AB\\!h}) $$\n\n接下来，我们计算无性系统的期望定植谱系数量。\n在这个系统中，拯救基因型来自于现有单基因座杂合子谱系中的第二次突变。产生速率是两种单基因座杂合子速率的总和：\n$$ \\text{Rate}_{asex}(t) = u \\cdot n_{A\\!h}(t) + u \\cdot n_{B\\!h}(t) = u(n_{A\\!h}(t) + n_{B\\!h}(t)) $$\n代入 $n_{A\\!h}(t)$ 和 $n_{B\\!h}(t)$ 的表达式：\n$$ \\text{Rate}_{asex}(t) = u(N_{0}p_{A}\\exp(m_{A\\!h}t) + N_{0}p_{B}\\exp(m_{B\\!h}t)) $$\n产生的 $AB/00$ 合子总数 $N_{prod, asex}$ 是该速率的积分：\n$$ N_{prod, asex} = \\int_{0}^{\\infty} u N_{0}(p_{A}\\exp(m_{A\\!h}t) + p_{B}\\exp(m_{B\\!h}t)) dt $$\n$$ N_{prod, asex} = u N_{0} \\left( p_{A}\\int_{0}^{\\infty}\\exp(m_{A\\!h}t)dt + p_{B}\\int_{0}^{\\infty}\\exp(m_{B\\!h}t)dt \\right) $$\n由于 $m_{A\\!h}  0$ 和 $m_{B\\!h}  0$，积分分别计算为 $-1/m_{A\\!h}$ 和 $-1/m_{B\\!h}$。\n$$ N_{prod, asex} = u N_{0} \\left( -\\frac{p_{A}}{m_{A\\!h}} - \\frac{p_{B}}{m_{B\\!h}} \\right) = -u N_{0} \\left( \\frac{p_{A}}{m_{A\\!h}} + \\frac{p_{B}}{m_{B\\!h}} \\right) $$\n期望的定植谱系数量为：\n$$ E_{asex} = N_{prod, asex} \\times P_{est} = \\left(-u N_{0} \\left( \\frac{p_{A}}{m_{A\\!h}} + \\frac{p_{B}}{m_{B\\!h}} \\right)\\right) \\times (2m_{AB\\!h}) $$\n\n为了找到临界重组率 $r_c$，我们令 $E_{sex}$（其中 $r=r_c$）等于 $E_{asex}$：\n$$ \\left(-\\frac{r_{c} N_{0} p_{A} p_{B}}{m_{A\\!h} + m_{B\\!h} - m_{00}}\\right) (2m_{AB\\!h}) = \\left(-u N_{0} \\left( \\frac{p_{A}}{m_{A\\!h}} + \\frac{p_{B}}{m_{B\\!h}} \\right)\\right) (2m_{AB\\!h}) $$\n公共因子 $-N_{0}(2m_{AB\\!h})$ 从两边消去，这是至关重要的，因为 $m_{AB\\!h}$ 包含未指定的上位性参数 $\\epsilon_{h}$。\n$$ \\frac{r_{c} p_{A} p_{B}}{m_{A\\!h} + m_{B\\!h} - m_{00}} = u \\left( \\frac{p_{A}}{m_{A\\!h}} + \\frac{p_{B}}{m_{B\\!h}} \\right) $$\n解出 $r_c$：\n$$ r_{c} = u \\left(\\frac{m_{A\\!h} + m_{B\\!h} - m_{00}}{p_{A}p_{B}}\\right) \\left( \\frac{p_{A}m_{B\\!h} + p_{B}m_{A\\!h}}{m_{A\\!h}m_{B\\!h}} \\right) $$\n$$ r_{c} = u ( m_{A\\!h} + m_{B\\!h} - m_{00} ) \\left( \\frac{p_{A}m_{B\\!h} + p_{B}m_{A\\!h}}{p_{A}p_{B}m_{A\\!h}m_{B\\!h}} \\right) $$\n$$ r_{c} = u ( m_{A\\!h} + m_{B\\!h} - m_{00} ) \\left( \\frac{1}{p_{B}m_{A\\!h}} + \\frac{1}{p_{A}m_{B\\!h}} \\right) $$\n问题要求答案用 $u, p_{A}, p_{B}, m_{00}, h_{A}, h_{B}, s_{A}, s_{B}$ 表示。我们代入给定的马尔萨斯参数表达式：\n$m_{A\\!h} = m_{00} + h_{A}s_{A}$\n$m_{B\\!h} = m_{00} + h_{B}s_{B}$\n$m_{A\\!h} + m_{B\\!h} - m_{00}$ 项变为 $(m_{00} + h_{A}s_{A}) + (m_{00} + h_{B}s_{B}) - m_{00} = m_{00} + h_{A}s_{A} + h_{B}s_{B}$。\n将这些代入 $r_c$ 的表达式中，得到最终的解析结果：\n$$ r_{c} = u(m_{00} + h_{A}s_{A} + h_{B}s_{B}) \\left( \\frac{1}{p_{B}(m_{00}+h_{A}s_{A})} + \\frac{1}{p_{A}(m_{00}+h_{B}s_{B})} \\right) $$\n这就是临界重组率的封闭形式表达式。", "answer": "$$\\boxed{u(m_{00} + h_{A}s_{A} + h_{B}s_{B}) \\left( \\frac{1}{p_{B}(m_{00}+h_{A}s_{A})} + \\frac{1}{p_{A}(m_{00}+h_{B}s_{B})} \\right)}$$", "id": "2698501"}, {"introduction": "将理论模型转化为实际的保护策略是保护遗传学的核心挑战。这个练习将你置于一个决策者的位置，任务是在充满不确定性的情况下，设计最优的迁移管理方案[@problem_id:2698503]。你需要建立一个包含生物学收益（拯救概率）和潜在风险（遗传淹没）的效用函数，并利用数值方法找到最优的迁移数量，这体现了在现实世界中进行演化知情管理（evolution-informed management）的精髓。", "problem": "您的任务是设计一个程序，该程序使用基于群体遗传学和分支过程理论的、有原则的随机模型，在不确定性下计算最优的保育移地决策，以最大化进化拯救的概率。设定如下。\n\n一个焦点种群在时间 $t=0$ 时有普查规模 $N_0$（个体），正在经历导致确定性种群数量下降的环境变化，并拥有一个潜在的适应性等位基因 $A$。您可以在 $t=0$ 时引入 $m$ 个迁移个体，每个个体都携带适应性等位基因 $A$。数量 $m$ 必须是非负整数，并受预算限制：每个迁移个体的成本为 $c_m$ 单位，总预算为 $B$，因此 $0 \\le m \\le \\left\\lfloor B/c_m \\right\\rfloor$。所有速率都是无量纲的代际量。\n\n基本原理和假设：\n- 野生型背景的平均人均后代数为 $R_w = 1 - d$，其中 $d \\in (0,1)$ 表示种群下降的强度。适应性等位基因 $A$ 赋予一个加性优势 $s \\ge 0$，因此当其稀有时，平均人均后代数为 $R_A(s) = 1 - d + s$。\n- 当稀有时，独立的 $A$ 谱系的早期动态可以用具有泊松后代分布和均值为 $R_A(s)$ 的 Galton–Watson 分支过程来建模。分支过程理论的一个经典结果指出，单个谱系的建立（非灭绝）概率在 $R_A(s) \\le 1$ 时为 $0$，在 $R_A(s)  1$ 时为 $1 - 1/R_A(s)$。\n- 来自既存变异的 $A$ 谱系的初始数量被建模为 $K \\sim \\mathrm{Binomial}(N_0, p_0)$，其中 $p_0$ 是未知的 $A$ 的初始频率。$p_0$ 的不确定性由一个 Beta 先验分布表示，$p_0 \\sim \\mathrm{Beta}(a,b)$，其中 $a0$ 和 $b0$。\n- 选择优势 $s$ 的不确定性由一个在有限区间上的 Beta 先验分布表示：$s \\in [0, s_{\\max}]$，其密度为 $f_S(s) = \\dfrac{1}{s_{\\max}} \\mathrm{BetaPDF}\\!\\left(\\dfrac{s}{s_{\\max}}; \\alpha_s, \\beta_s \\right)$，其中 $\\alpha_s0$, $\\beta_s0$，$\\mathrm{BetaPDF}$ 是在 $[0,1]$ 上的 Beta 概率密度函数。\n\n管理目标：\n- 设单个 $A$ 谱系的建立概率为 $p_{\\mathrm{est}}(s)$，由上述分支过程的事实确定。假设当谱系稀有时彼此独立，那么给定 $K$ 个既存变异谱系和 $m$ 个迁移谱系，至少有一个谱系建立的概率是 $1 - (1 - p_{\\mathrm{est}}(s))^{K + m}$。\n- 您的目标是选择 $m$ 以最大化期望效用\n$$\nU(m) \\;=\\; \\mathbb{E}_S \\left[ \\, \\mathbb{E}_{p_0} \\left[ \\, \\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ \\, 1 - (1 - p_{\\mathrm{est}}(S))^{K + m} \\, \\right] \\, \\right] \\, \\right] \\;-\\; \\lambda \\left( \\frac{m}{N_0} \\right)^2,\n$$\n其中 $\\lambda \\ge 0$ 是一个惩罚权重，模拟了由迁移个体带来的二次方遗传淹没风险。若出现平局，则选择较小的 $m$。所有期望都是针对所述不确定性模型计算的。\n\n要求：\n- 您的推导必须仅基于所提供的基本事实（具有泊松后代均值 $R_A(s)$ 的 Galton–Watson 过程及其非灭绝概率；既存变异的二项抽样；指定的 Beta 先验分布）。\n- 您必须通过在 $[0,s_{\\max}]$ 上进行数值积分来计算关于 $s$ 的期望，使用至少包含 $n=128$ 个节点的确定性规则。您的实现必须对以下所有测试案例都保持数值稳定。除非明确说明，否则您可以假设所有随机变量和参数都是独立的。\n- 您必须通过在 $R_A(s) \\le 1$ 时遵守 $p_{\\mathrm{est}}(s) = 0$ 以及正确处理在所有 $s \\in [0,s_{\\max}]$ 上 $R_A(s) \\le 1$ 的情况，来确保科学真实性。\n- 所有速率（$d$、$s$、$p_0$）都是每代的无量纲量，不需要物理单位。输出必须是没有任何单位的整数。\n\n测试套件：\n对于下面的每个参数集，计算最优的 $m^\\star$，该值使 $U(m)$ 最大化，且满足 $m \\in \\{0,1,2,\\ldots,\\left\\lfloor B/c_m \\right\\rfloor\\}$。\n\n- 案例 A（一般可行情况）：\n  - $N_0 = 100$, $d = 0.05$, $s_{\\max} = 0.20$, $\\alpha_s = 2.0$, $\\beta_s = 5.0$。\n  - $a = 1.0$, $b = 99.0$。\n  - $B = 20$, $c_m = 1$, $\\lambda = 0.01$。\n\n- 案例 B（边界：零预算）：\n  - $N_0 = 100$, $d = 0.05$, $s_{\\max} = 0.20$, $\\alpha_s = 2.0$, $\\beta_s = 5.0$。\n  - $a = 1.0$, $b = 99.0$。\n  - $B = 0$, $c_m = 1$, $\\lambda = 0.01$。\n\n- 案例 C（边缘：不可能建立）：\n  - $N_0 = 200$, $d = 0.30$, $s_{\\max} = 0.20$, $\\alpha_s = 2.0$, $\\beta_s = 5.0$。\n  - $a = 1.0$, $b = 199.0$。\n  - $B = 50$, $c_m = 1$, $\\lambda = 0.001$。\n\n- 案例 D（权衡被惩罚项主导）：\n  - $N_0 = 300$, $d = 0.08$, $s_{\\max} = 0.25$, $\\alpha_s = 2.5$, $\\beta_s = 3.5$。\n  - $a = 1.5$, $b = 298.5$。\n  - $B = 60$, $c_m = 5$, $\\lambda = 1.5$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含案例 A、B、C 和 D 的最优整数 $m^\\star$ 的逗号分隔列表（按此顺序），并用方括号括起来，例如：“[mA,mB,mC,mD]”。", "solution": "所呈现的问题是应用进化生物学领域内一个明确定义的优化任务，具体来说是保育遗传学。它在科学上是合理的，在数学上是一致的，并且所有参数和目标都已明确定义。我将继续进行正式的求解推导。\n\n目标是找到引入的迁移个体数量 $m$，以最大化效用函数 $U(m)$。$m$ 的允许值集合为非负整数集，且不违反成本约束，即 $m \\in \\{0, 1, 2, \\ldots, \\lfloor B/c_m \\rfloor\\}$。效用函数由下式给出：\n$$\nU(m) = \\mathbb{E}_S \\left[ \\, \\mathbb{E}_{p_0} \\left[ \\, \\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ \\, 1 - (1 - p_{\\mathrm{est}}(S))^{K + m} \\, \\right] \\, \\right] \\, \\right] - \\lambda \\left( \\frac{m}{N_0} \\right)^2\n$$\n该函数由两部分组成：代表进化拯救总概率的生物学效益，以及代表与移地相关风险的二次惩罚项。我们的任务是找到 $m^\\star = \\arg\\max_m U(m)$。\n\n首先，让我们简化期望项，我将其表示为 $E_{\\text{bio}}(m)$。该期望是在三个不确定性层面上计算的：初始适应性等位基因的数量 $K$、其频率 $p_0$ 和选择系数 $s$。我们可以使用全期望定律来简化它。\n\n令 $q(s) = 1 - p_{\\mathrm{est}}(s)$ 为在给定选择系数 $s$ 的情况下，适应性等位基因 $A$ 的单个谱系灭绝的概率。期望内的表达式是至少有一个谱系建立的概率，即 $1 - q(s)^{K+m}$。\n\n最内层的期望是关于 $K$ 的，它遵循二项分布，$K \\sim \\mathrm{Binomial}(N_0, p_0)$。\n$$\n\\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ 1 - q(s)^{K+m} \\right] = 1 - \\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ q(s)^{K+m} \\right] = 1 - q(s)^m \\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ q(s)^K \\right]\n$$\n项 $\\mathbb{E}_{K \\,\\mid\\, p_0} [q(s)^K]$ 是二项分布 $\\mathrm{Binomial}(N_0, p_0)$ 的概率生成函数（PGF）在 $q(s)$ 处的值。$\\mathrm{Binomial}(n,p)$ 的 PGF 是 $G(z) = (1-p+pz)^n$。因此，\n$$\n\\mathbb{E}_{K \\,\\mid\\, p_0} \\left[ q(s)^K \\right] = (1 - p_0 + p_0 q(s))^{N_0} = (1 - p_0(1 - q(s)))^{N_0}\n$$\n回想一下 $p_{\\mathrm{est}}(s) = 1 - q(s)$，这变成了 $(1 - p_0 p_{\\mathrm{est}}(s))^{N_0}$。\n\n下一层期望是关于初始等位基因频率 $p_0$ 的，它遵循 Beta 分布，$p_0 \\sim \\mathrm{Beta}(a,b)$。我们需要计算：\n$$\n\\mathbb{E}_{p_0} \\left[ (1 - p_0 p_{\\mathrm{est}}(s))^{N_0} \\right]\n$$\n这可以通过使用二项式定理展开该项来计算：\n$$\n(1 - p_0 p_{\\mathrm{est}}(s))^{N_0} = \\sum_{k=0}^{N_0} \\binom{N_0}{k} (-p_0 p_{\\mathrm{est}}(s))^k = \\sum_{k=0}^{N_0} \\binom{N_0}{k} (-1)^k (p_{\\mathrm{est}}(s))^k p_0^k\n$$\n对 $p_0$ 取期望：\n$$\n\\mathbb{E}_{p_0} \\left[ \\sum_{k=0}^{N_0} \\binom{N_0}{k} (-1)^k (p_{\\mathrm{est}}(s))^k p_0^k \\right] = \\sum_{k=0}^{N_0} \\binom{N_0}{k} (-1)^k (p_{\\mathrm{est}}(s))^k \\mathbb{E}_{p_0}[p_0^k]\n$$\n$\\mathrm{Beta}(a,b)$ 分布的 $k$ 阶矩由 $\\mathbb{E}[p_0^k] = \\frac{\\Gamma(a+k)\\Gamma(a+b)}{\\Gamma(a+b+k)\\Gamma(a)} = \\frac{a^{\\overline{k}}}{(a+b)^{\\overline{k}}}$ 给出，其中 $x^{\\overline{k}}$ 是上升阶乘。该表达式可被识别为高斯超几何函数 ${}_2F_1$ 的定义：\n$$\n\\sum_{k=0}^{N_0} \\frac{(-N_0)^{\\overline{k}} a^{\\overline{k}}}{(a+b)^{\\overline{k}}} \\frac{(p_{\\mathrm{est}}(s))^k}{k!} = {}_2F_1(-N_0, a; a+b; p_{\\mathrm{est}}(s))\n$$\n由于 $-N_0$ 是一个负整数，这是一个截尾级数（一个关于 $p_{\\mathrm{est}}(s)$ 的多项式）。\n\n综合这些结果，对于给定的 $s$ 和 $m$，总的拯救概率是：\n$$\n\\text{Benefit}(s, m) = 1 - (1 - p_{\\mathrm{est}}(s))^m \\cdot {}_2F_1(-N_0, a; a+b; p_{\\mathrm{est}}(s))\n$$\n建立概率 $p_{\\mathrm{est}}(s)$ 定义为：\n$$\np_{\\mathrm{est}}(s) = \\max\\left(0, 1 - \\frac{1}{R_A(s)}\\right) = \\max\\left(0, 1 - \\frac{1}{1-d+s}\\right)\n$$\n这仅在 $1-d+s  1$ 时非零，简化为 $s  d$。\n\n最后，我们对选择系数 $s$ 取期望，它在 $[0, s_{\\max}]$上服从一个缩放的 Beta 分布。\n$$\nE_{\\text{bio}}(m) = \\mathbb{E}_S[\\text{Benefit}(S, m)] = \\int_0^{s_{\\max}} \\text{Benefit}(s, m) f_S(s) ds\n$$\n其中 $f_S(s) = \\frac{1}{s_{\\max}} \\mathrm{BetaPDF}\\left(\\frac{s}{s_{\\max}}; \\alpha_s, \\beta_s\\right)$。\n\n该积分没有简单的封闭形式解，必须进行数值计算。问题要求使用至少包含 $n=128$ 个节点的确定性积分规则。我们将使用高精度方法 Gauss-Legendre 积分。我们通过变量替换 $s(x) = \\frac{s_{\\max}}{2}(x+1)$ 将积分区间 $[0, s_{\\max}]$ 变换到标准的积分区间 $[-1, 1]$，其中 $x \\in [-1, 1]$。积分变为：\n$$\nE_{\\text{bio}}(m) = \\int_{-1}^{1} \\text{Benefit}(s(x), m) f_S(s(x)) \\frac{s_{\\max}}{2} dx \\approx \\frac{s_{\\max}}{2} \\sum_{i=1}^n w_i \\text{Benefit}(s(x_i), m) f_S(s(x_i))\n$$\n其中 $x_i$ 和 $w_i$ 是用于 $n$ 个点的标准 Gauss-Legendre 节点和权重。\n\n总体算法如下：\n1. 对每个测试案例，确定所有参数：$N_0, d, s_{\\max}, \\alpha_s, \\beta_s, a, b, B, c_m, \\lambda$。\n2. 确定最大迁移个体数量，$m_{\\max} = \\lfloor B/c_m \\rfloor$。\n3. 预先计算用于 $n$ 点 Gauss-Legendre 积分的节点 $x_i$ 和权重 $w_i$（$n \\ge 128$）。\n4. 初始化最优迁移个体数量 $m^\\star = 0$ 和最大效用 $U_{\\max} = U(0)$。\n5. 从 $1$ 到 $m_{\\max}$ 迭代 $m$。对于每个 $m$：\n    a. 使用积分规则评估 $E_{\\text{bio}}(m)$ 来计算效用 $U(m)$。该计算涉及在每个积分节点 $s_i$ 处评估 $p_{\\mathrm{est}}(s_i)$，然后计算超几何函数 ${}_2F_1$ 和完整的被积函数。\n    b. 如果 $U(m)  U_{\\max}$，则更新 $U_{\\max} = U(m)$ 和 $m^\\star = m$。严格不等式确保了平局时选择较小的 $m$，如规定。\n6. 最终的 $m^\\star$ 是该测试案例的解。\n这个过程必须为测试套件中的每个案例重复。如果 $s_{\\max} \\le d$，则会出现一个特殊情况，此时 $p_{\\mathrm{est}}(s)$ 始终为零。在这种情况下，对所有 $m$，都有 $E_{\\text{bio}}(m)=0$，效用简化为 $U(m) = -\\lambda (m/N_0)^2$，该值在 $m=0$ 时最大化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import hyp2f1\nfrom scipy.stats import beta as beta_dist\n\ndef calculate_utility(m, N0, d, s_max, alpha_s, beta_s, a, b, lambda_, quad_nodes, quad_weights):\n    \"\"\"\n    Calculates the utility U(m) for a given number of migrants m.\n    \"\"\"\n    # 1. Penalty Term\n    penalty = lambda_ * (m / N0)**2\n\n    # 2. Biological Benefit Term (calculated via numerical quadrature)\n    \n    # Transform quadrature nodes from [-1, 1] to [0, s_max]\n    s_nodes = 0.5 * s_max * (quad_nodes + 1.0)\n    \n    # Corresponding transformed weights for the integral over [0, s_max]\n    s_weights = 0.5 * s_max * quad_weights\n\n    # Probability density function of s at the nodes\n    # The distribution of s is a scaled Beta distribution on [0, s_max]\n    s_pdf_vals = beta_dist.pdf(s_nodes / s_max, a=alpha_s, b=beta_s, loc=0, scale=1) / s_max\n    \n    # Calculate establishment probability p_est(s) at each node\n    p_est = np.zeros_like(s_nodes)\n    # The condition for non-zero establishment probability is s > d\n    rescue_possible_mask = s_nodes > d\n    \n    if np.any(rescue_possible_mask):\n        p_est[rescue_possible_mask] = 1.0 - 1.0 / (1.0 - d + s_nodes[rescue_possible_mask])\n\n    # Calculate the hypergeometric function term\n    # E[(1-p_est)^K] = 2F1(-N0, a; a+b; p_est)\n    hyp2f1_vals = np.ones_like(s_nodes)\n    if np.any(rescue_possible_mask):\n        # hyp2f1 is vectorized over its last argument\n        hyp2f1_vals[rescue_possible_mask] = hyp2f1(\n            -N0, a, a + b, p_est[rescue_possible_mask]\n        )\n\n    # Calculate the integrand: Benefit(s, m) = 1 - (1-p_est)^m * E[(1-p_est)^K]\n    integrand = 1.0 - (1.0 - p_est)**m * hyp2f1_vals\n\n    # Compute the integral via quadrature: E_bio = integral(Benefit(s,m) * f(s) ds)\n    # This is approximated by sum(weights * integrand_values * pdf_values)\n    bio_benefit = np.sum(s_weights * integrand * s_pdf_vals)\n\n    return bio_benefit - penalty\n\ndef solve_case(params):\n    \"\"\"\n    Solves for the optimal number of migrants m* for a single parameter set.\n    \"\"\"\n    N0, d, s_max, alpha_s, beta_s, a, b, B, c_m, lambda_ = params\n\n    # Maximum possible number of migrants based on budget\n    m_max = int(B // c_m)\n    \n    # Handle the edge case where evolutionary rescue is impossible\n    if s_max = d:\n        # p_est(s) is always 0. The biological benefit is 0 for all m.\n        # Utility U(m) = -lambda * (m/N0)^2 is maximized at m=0.\n        return 0\n\n    best_m = 0\n    \n    # Set up Gauss-Legendre quadrature with n=256 nodes (more than the required 128)\n    num_nodes = 256\n    quad_nodes, quad_weights = np.polynomial.legendre.leggauss(num_nodes)\n\n    # Calculate utility for m=0 to establish a baseline\n    max_utility = calculate_utility(0, N0, d, s_max, alpha_s, beta_s, a, b, lambda_, quad_nodes, quad_weights)\n\n    # Iterate through all possible m values to find the optimum\n    for m in range(1, m_max + 1):\n        utility = calculate_utility(m, N0, d, s_max, alpha_s, beta_s, a, b, lambda_, quad_nodes, quad_weights)\n        \n        # Update best_m only if utility is strictly greater,\n        # which respects the tie-breaking rule (choose smaller m).\n        if utility > max_utility:\n            max_utility = utility\n            best_m = m\n            \n    return best_m\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final output.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: General feasible case\n        {'N0': 100, 'd': 0.05, 's_max': 0.20, 'alpha_s': 2.0, 'beta_s': 5.0, \n         'a': 1.0, 'b': 99.0, 'B': 20, 'c_m': 1, 'lambda_': 0.01},\n        # Case B: Boundary - zero budget\n        {'N0': 100, 'd': 0.05, 's_max': 0.20, 'alpha_s': 2.0, 'beta_s': 5.0, \n         'a': 1.0, 'b': 99.0, 'B': 0, 'c_m': 1, 'lambda_': 0.01},\n        # Case C: Edge - no possible establishment\n        {'N0': 200, 'd': 0.30, 's_max': 0.20, 'alpha_s': 2.0, 'beta_s': 5.0, \n         'a': 1.0, 'b': 199.0, 'B': 50, 'c_m': 1, 'lambda_': 0.001},\n        # Case D: Trade-off dominated by penalty\n        {'N0': 300, 'd': 0.08, 's_max': 0.25, 'alpha_s': 2.5, 'beta_s': 3.5, \n         'a': 1.5, 'b': 298.5, 'B': 60, 'c_m': 5, 'lambda_': 1.5},\n    ]\n\n    results = []\n    for case_params in test_cases:\n        params_tuple = tuple(case_params.values())\n        result = solve_case(params_tuple)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2698503"}]}