{"hands_on_practices": [{"introduction": "理论的基石是将可观测的遗传多样性与群体历史联系起来。这个练习将引导您从溯祖理论的第一性原理出发，推导出在恒定群体大小的理想条件下，核苷酸多样性 ($\\pi$) 与有效群体大小 ($N_e$) 之间的经典关系 [@problem_id:2700391]。然后，您将通过分析一个更现实的、群体大小随时间变化的场景，来揭示为什么这种简单方法会失效，从而理解为何我们需要更复杂的推断方法。", "problem": "一个二倍体、随机交配的群体在一个常染色体位点上进行中性演化，遵循无限位点突变模型，每个位点每代的突变率为 $\\mu$。假设以 Wright–Fisher 模型为基本基础，对大群体规模采用溯祖近似，并通过全基因组取样，使得 $\\pi$（核苷酸多样性）得到很好的估计。\n\n从溯祖理论的基本原理出发：\n- 对于一个恒定大小的群体，两条谱系的最近共同祖先的期望时间是 $E[T_{2}] = 2N_{e}$ 代。\n- 在无限位点模型下，每个位点的期望成对差异数等于 $2\\mu E[T_{2}]$。\n\n1) 利用这些原理，推导在群体动态平衡状态下，一个常染色体的 $\\pi$、$N_{e}$ 和 $\\mu$ 之间的经典关系。然后，使用测量值 $\\pi = 2.7 \\times 10^{-3}$ 和 $\\mu = 1.5 \\times 10^{-8}$，在平衡假设下计算 $N_{e}$ 的点估计值。\n\n2) 接下来，考虑一个非平衡、双阶段的群体历史，其中群体大小从现在回溯到过去的 $\\tau$ 代为 $N_{1}$，在时间 $\\tau$ 之前为 $N_{2}$。使用溯祖风险率 $\\lambda(t) = \\frac{1}{2N_{e}(t)}$ 和两条谱系溯祖时间的生存函数 $S(t) = \\exp\\!\\left(-\\int_{0}^{t}\\lambda(s)\\,ds\\right)$，推导 $\\pi$ 关于 $\\mu$、$N_{1}$、$N_{2}$ 和 $\\tau$ 的表达式。利用这个表达式，分析性地解释为什么在非平衡群体动态下，基于平衡的从 $\\pi$ 到 $N_{e}$ 的映射会失效，并将你的解释与 Bayesian Skyline Plot 和 Pairwise Sequentially Markovian Coalescent (PSMC; 逐对顺序马尔可夫溯祖) 试图推断 $N_{e}(t)$ 的内容联系起来。\n\n将第 (1) 部分的数值答案报告为二倍体个体数量，四舍五入到四位有效数字。最终答案中不要包含单位。", "solution": "该问题将按要求分两部分解决。首先，必须严格验证问题陈述。\n\n**问题验证**\n\n步骤1：提取已知条件。\n-   模型：二倍体、随机交配群体。\n-   演化动态：中性演化的常染色体位点。\n-   突变模型：无限位点模型，每个位点每代的突变率为 $\\mu$。\n-   群体模型：Wright–Fisher 模型，对大群体规模使用溯祖近似。\n-   数据：核苷酸多样性 $\\pi$ 通过全基因组取样得到很好的估计。\n-   恒定群体规模下的已知原理：两条谱系到最近共同祖先的期望时间为 $E[T_{2}] = 2N_{e}$ 代。\n-   突变积累的已知原理：每个位点的期望成对差异数 $\\pi$ 等于 $2\\mu E[T_{2}]$。\n-   第1部分的数值：$\\pi = 2.7 \\times 10^{-3}$ 和 $\\mu = 1.5 \\times 10^{-8}$。\n-   第2部分的群体动态模型：一个双阶段历史，从现在到 $\\tau$ 代前群体大小为 $N_{1}$，在时间 $\\tau$ 之前群体大小为 $N_{2}$。\n-   第2部分的数学工具：溯祖风险率 $\\lambda(t) = \\frac{1}{2N_{e}(t)}$ 和生存函数 $S(t) = \\exp\\!\\left(-\\int_{0}^{t}\\lambda(s)\\,ds\\right)$。\n\n步骤2：使用提取的已知条件进行验证。\n该问题是理论群体遗传学中的一个标准练习，特别是在溯祖理论方面。\n-   该问题具有**科学依据**。所有模型（Wright-Fisher、无限位点、溯祖过程）和原理都是该领域基础且成熟的。所提供的 $\\pi$ 和 $\\mu$ 值在生物学上是合理的。\n-   该问题**提法恰当**。它提供了足够的信息来推导所需的表达式并计算数值答案。问题明确无歧义。\n-   该问题是**客观的**。语言技术性强且精确，没有主观或不科学的主张。\n-   该问题与指定的*从基因组推断群体历史*主题以及提到的方法（Bayesian Skyline Plots, PSMC）直接且精确相关。\n-   该问题既不琐碎也不故作高深；它测试了对摘要统计量如何与潜在的群体动态过程相关，以及为什么在非平衡情景下需要更复杂方法的根本理解。\n\n步骤3：结论与行动。\n问题陈述有效。将提供解答。\n\n**解答**\n\n**第1部分：平衡群体动态**\n核苷酸多样性 $\\pi$ 定义为从群体中随机抽取的两个序列之间每个位点的平均成对差异数。问题陈述给出该量由以下表达式表示：\n$$ \\pi = 2\\mu E[T_{2}] $$\n其中 $\\mu$ 是每个位点每代的突变率， $E[T_{2}]$ 是一对谱系的最近共同祖先（TMRCA）的期望时间。\n\n在恒定大小的二倍体群体处于群体动态平衡的假设下，期望 TMRCA 为：\n$$ E[T_{2}] = 2N_{e} $$\n其中 $N_{e}$ 是有效群体大小。\n\n将 $E[T_{2}]$ 的这个表达式代入 $\\pi$ 的方程，得到二倍体常染色体位点的经典关系：\n$$ \\pi = 2\\mu (2N_{e}) = 4N_{e}\\mu $$\n这个方程将可观测的遗传多样性 ($\\pi$) 与有效群体大小 ($N_{e}$) 和突变率 ($\\mu$) 这两个基本演化参数联系起来。\n\n为了计算 $N_{e}$ 的点估计，我们重排这个公式：\n$$ N_{e} = \\frac{\\pi}{4\\mu} $$\n使用给定的值 $\\pi = 2.7 \\times 10^{-3}$ 和 $\\mu = 1.5 \\times 10^{-8}$：\n$$ N_{e} = \\frac{2.7 \\times 10^{-3}}{4 \\times (1.5 \\times 10^{-8})} = \\frac{2.7 \\times 10^{-3}}{6.0 \\times 10^{-8}} = 0.45 \\times 10^{5} = 45000 $$\n二倍体个体数量为 $45000$。四舍五入到四位有效数字得到 $4.500 \\times 10^{4}$。\n\n**第2部分：非平衡群体动态**\n对于一个规模随时间变化的群体 $N_{e}(t)$，简单的关系 $E[T_{2}] = 2N_{e}$ 不再有效。我们必须使用为溯祖时间 $T_{2}$ 提供的生存函数，从第一性原理计算 $E[T_{2}]$。一个非负随机变量的期望值是其生存函数的积分：\n$$ E[T_{2}] = \\int_{0}^{\\infty} S(t) \\,dt = \\int_{0}^{\\infty} P(T_2 > t) \\,dt $$\n其中生存函数是 $S(t) = \\exp\\!\\left(-\\int_{0}^{t}\\lambda(s)\\,ds\\right)$，溯祖风险率是 $\\lambda(s) = \\frac{1}{2N_{e}(s)}$。\n\n指定的双阶段群体动态模型具有分段恒定的群体大小：\n$$ N_{e}(t) = \\begin{cases} N_{1}  & \\text{if } 0 \\le t \\le \\tau \\\\ N_{2}  & \\text{if } t > \\tau \\end{cases} $$\n$E[T_{2}]$ 的积分必须在时间点 $\\tau$ 处分开：\n$$ E[T_{2}] = \\int_{0}^{\\tau} S(t) \\,dt + \\int_{\\tau}^{\\infty} S(t) \\,dt $$\n对于第一个区间 $0 \\le t \\le \\tau$，溯祖率是恒定的，$\\lambda(s) = \\frac{1}{2N_{1}}$。生存函数是 $S(t) = \\exp\\!\\left(-\\int_{0}^{t}\\frac{1}{2N_{1}}\\,ds\\right) = \\exp\\!\\left(-\\frac{t}{2N_{1}}\\right)$。第一个积分是：\n$$ \\int_{0}^{\\tau} \\exp\\!\\left(-\\frac{t}{2N_{1}}\\right) \\,dt = \\left[-2N_{1}\\exp\\!\\left(-\\frac{t}{2N_{1}}\\right)\\right]_{0}^{\\tau} = -2N_{1}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) - (-2N_{1}) = 2N_{1}\\left(1 - \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)\\right) $$\n对于第二个区间 $t > \\tau$，我们首先计算累积风险 $\\int_{0}^{t}\\lambda(s)\\,ds$：\n$$ \\int_{0}^{t}\\lambda(s)\\,ds = \\int_{0}^{\\tau}\\frac{1}{2N_{1}}\\,ds + \\int_{\\tau}^{t}\\frac{1}{2N_{2}}\\,ds = \\frac{\\tau}{2N_{1}} + \\frac{t-\\tau}{2N_{2}} $$\n当 $t > \\tau$ 时，生存函数是 $S(t) = \\exp\\!\\left(-\\left(\\frac{\\tau}{2N_{1}} + \\frac{t-\\tau}{2N_{2}}\\right)\\right)$。第二个积分是：\n$$ \\int_{\\tau}^{\\infty} \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) \\exp\\!\\left(-\\frac{t-\\tau}{2N_{2}}\\right) \\,dt $$\n我们可以提出常数项 $\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)$ 并进行变量替换 $u = t - \\tau$, $du = dt$：\n$$ \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) \\int_{0}^{\\infty} \\exp\\!\\left(-\\frac{u}{2N_{2}}\\right) \\,du = \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) \\left[ -2N_{2}\\exp\\!\\left(-\\frac{u}{2N_{2}}\\right) \\right]_{0}^{\\infty} = 2N_{2}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) $$\n结合这两个部分，得到总的期望 TMRCA：\n$$ E[T_{2}] = 2N_{1}\\left(1 - \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)\\right) + 2N_{2}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) $$\n最后，核苷酸多样性 $\\pi$ 的表达式为 $2\\mu E[T_{2}]$：\n$$ \\pi = 4\\mu \\left( N_{1}\\left(1 - \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)\\right) + N_{2}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) \\right) $$\n\n这个结果解释了为什么基于平衡的映射会失效。如果测量一个单一的 $\\pi$ 值并简单地使用 $N_{e, inferred} = \\frac{\\pi}{4\\mu}$ 来计算有效群体大小，结果是：\n$$ N_{e, inferred} = N_{1}\\left(1 - \\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right)\\right) + N_{2}\\exp\\!\\left(-\\frac{\\tau}{2N_{1}}\\right) $$\n这个推断出的大小既不等于当前的大小 $N_{1}$ 也不等于祖先的大小 $N_{2}$（除非 $N_{1} = N_{2}$）。相反，它是取样谱系历史上群体大小的加权平均值，其中权重与每个时期发生溯祖的概率有关。单一的摘要统计量 $\\pi$ 是溯祖时间分布的均值，它包含的信息不足以区分 $N_{1}$、$N_{2}$ 和 $\\tau$ 这三个参数。它平均掉了群体大小的时间变化。\n\n诸如 Bayesian Skyline Plot (BSP) 和 Pairwise Sequentially Markovian Coalescent (PSMC) 等方法正是为解决这个问题而设计的。它们不依赖于像 $\\pi$ 这样的单一摘要统计量，而是利用了反映在整个基因组遗传变异模式中的溯祖时间的完整分布。例如，PSMC 将单个二倍体基因组中的杂合与纯合区块序列建模为一个隐马尔可夫模型，其中隐藏状态是不同基因组片段的溯祖时间。通过估计这些时间的分布，PSMC 推断出随时间变化的溯祖率 $\\lambda(t) = \\frac{1}{2N_{e}(t)}$，从而重建有效群体大小 $N_{e}(t)$ 作为一个分段常数函数的历史轨迹。BSP 使用贝叶斯 MCMC 对与遗传数据兼容的谱系进行抽样，从中导出 $N_{e}(t)$ 的后验分布。本质上，这些方法解析基因组中包含的信息，以估计不同历史时期的群体大小，而不是将其全部压缩成一个单一的、信息量不足的平均值。", "answer": "$$\\boxed{4.500 \\times 10^{4}}$$", "id": "2700391"}, {"introduction": "在理解了为什么需要动态模型后，我们将深入探讨现代贝叶斯推断方法（如贝叶斯天空线图）的统计学核心。这个练习将带您亲手操作一个关键步骤：如何根据在特定时间区间内观察到的溯祖事件数量和总等待时间，并结合共轭先验分布，来推导该区间内有效群体大小 ($N_e$) 的后验分布 [@problem_id:2700405]。这能让您具体地理解模型是如何将原始的遗传信号转化为对群体历史的估计的。", "problem": "在贝叶斯天际线图 (BSP) 或配对顺序马尔可夫溯祖 (PSMC) 框架中，有效种群大小被建模为在多个时间区间内分段恒定。考虑一个有效种群大小 $N_e$ 恒定的单个区间。根据以代为单位的连续时间 Kingman 溯祖理论，当存在 $k$ 个祖先世系时，一个溯祖事件的瞬时风险率为 $\\binom{k}{2} \\, \\theta$，其中 $\\theta = \\frac{1}{2 N_e}$ 是每对世系的溯祖率。\n\n在该区间内，假设发生了 $m$ 次溯祖事件，总溯祖机会（世系对时间）为 $W = \\sum_{j} \\binom{k_j}{2} \\, \\Delta t_j$，其中 $\\Delta t_j$ 是在 $k_j$ 保持恒定期间连续事件之间的持续时间。假设每对世系溯祖率的先验为 $\\theta \\sim \\mathrm{Gamma}(\\alpha_0, \\beta_0)$，采用率参数化，即其密度函数为 $f(\\theta) = \\frac{\\beta_0^{\\alpha_0}}{\\Gamma(\\alpha_0)} \\, \\theta^{\\alpha_0 - 1} \\exp(-\\beta_0 \\theta)$，其中 $\\theta > 0$。\n\n从溯祖风险率的定义和指数等待时间的无记忆性出发，在此共轭设置下推导给定 $m$ 和 $W$ 时 $N_e$ 的后验分布，然后计算当 $\\alpha_0 = 2.7$、$\\beta_0 = 1.5 \\times 10^{4}$、$m = 5$ 和 $W = 1.8 \\times 10^{5}$ 时的 $N_e$ 的后验均值。将最终数值答案表示为个体数量，并四舍五入到四位有效数字。", "solution": "其基本基础是连续时间下的 Kingman 溯祖理论。当存在 $k$ 个世系时，溯祖事件的瞬时率（风险率）为 $\\lambda_k = \\binom{k}{2} \\, \\theta$，其中 $\\theta = \\frac{1}{2 N_e}$。在 $k$ 固定的情况下，到下一次事件的等待时间服从率参数为 $\\lambda_k$ 的指数分布，且由于指数分布的无记忆性，不相交的等待时间是独立的。\n\n在一个 $N_e$ 恒定但 $k$ 可以在事件发生时点改变的区间内，观测到 $m$ 次溯祖事件在未指定时间的联合似然仅通过充分统计量 $m$（事件数量）和总溯祖机会 $W = \\sum_{j} \\binom{k_j}{2} \\Delta t_j$ 依赖于 $\\theta$。具体来说，指数等待时间似然在 $k$ 恒定的子区间内以乘法方式累积，得到一个关于 $\\theta$ 的核，形式为\n$$\nL(\\theta \\mid m, W) \\propto \\theta^{m} \\exp(-\\theta W).\n$$\n这是一个标准结果，即当通过事件计数和积分强度进行总结时，具有分段恒定强度的非齐次泊松过程的率参数的似然函数会坍缩成一个关于率参数的伽马核。\n\n给定率参数化的先验 $\\theta \\sim \\mathrm{Gamma}(\\alpha_0, \\beta_0)$，\n$$\n\\pi(\\theta) = \\frac{\\beta_0^{\\alpha_0}}{\\Gamma(\\alpha_0)} \\, \\theta^{\\alpha_0 - 1} \\exp(-\\beta_0 \\theta),\n$$\n根据贝叶斯定理可得 $\\theta$ 的后验分布：\n$$\n\\pi(\\theta \\mid m, W) \\propto \\theta^{m} \\exp(-\\theta W) \\cdot \\theta^{\\alpha_0 - 1} \\exp(-\\beta_0 \\theta)\n= \\theta^{\\alpha_0 + m - 1} \\exp\\!\\big(-(\\beta_0 + W)\\theta\\big).\n$$\n因此，\n$$\n\\theta \\mid m, W \\sim \\mathrm{Gamma}\\!\\big(\\alpha_0 + m, \\, \\beta_0 + W\\big),\n$$\n同样采用率参数化。\n\n我们要求解 $N_e$ 的后验分布。变换关系为 $N_e = \\frac{1}{2 \\theta}$，所以 $\\theta = \\frac{1}{2 N_e}$，其雅可比行列式为\n$$\n\\left|\\frac{d\\theta}{dN_e}\\right| = \\frac{1}{2 N_e^{2}}.\n$$\n如果我们记 $\\alpha = \\alpha_0 + m$ 和 $\\beta = \\beta_0 + W$，则根据变量代换可得 $N_e$ 的后验密度：\n$$\np(N_e \\mid m, W)\n= \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)}\n\\left(\\frac{1}{2 N_e}\\right)^{\\alpha - 1}\n\\exp\\!\\left(-\\beta \\cdot \\frac{1}{2 N_e}\\right)\n\\cdot \\frac{1}{2 N_e^{2}},\n$$\n化简后得到\n$$\np(N_e \\mid m, W)\n= \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha) \\, 2^{\\alpha}} \\, N_e^{-(\\alpha + 1)} \\, \\exp\\!\\left(-\\frac{\\beta}{2 N_e}\\right), \\quad N_e > 0.\n$$\n这是一个形状参数为 $\\alpha$、尺度参数为 $\\frac{\\beta}{2}$ 的逆伽马分布，等价于在由 $\\theta = 1/(2 N_e)$ 引出的参数化下，形状参数为 $\\alpha$、尺度参数为 $\\beta$ 的逆伽马分布。一个方便计算的矩是 $N_e$ 的后验均值，它在 $\\alpha > 1$ 时存在，并由下式给出\n$$\n\\mathbb{E}[N_e \\mid m, W] = \\frac{\\beta}{2(\\alpha - 1)} = \\frac{\\beta_0 + W}{2(\\alpha_0 + m - 1)}.\n$$\n现在我们代入给定的值：$\\alpha_0 = 2.7$，$m = 5$，$\\beta_0 = 1.5 \\times 10^{4}$，以及 $W = 1.8 \\times 10^{5}$。首先计算\n$$\n\\alpha = \\alpha_0 + m = 2.7 + 5 = 7.7, \\quad \\alpha - 1 = 6.7,\n$$\n和\n$$\n\\beta = \\beta_0 + W = 1.5 \\times 10^{4} + 1.8 \\times 10^{5} = 1.95 \\times 10^{5}.\n$$\n因此，\n$$\n\\mathbb{E}[N_e \\mid m, W] = \\frac{1.95 \\times 10^{5}}{2 \\times 6.7} = \\frac{1.95 \\times 10^{5}}{13.4} \\approx 1.45522388 \\times 10^{4}.\n$$\n四舍五入到四位有效数字并表示为个体数量，答案是 $1.455 \\times 10^{4}$。", "answer": "$$\\boxed{1.455 \\times 10^{4}}$$", "id": "2700405"}, {"introduction": "任何实际的群体历史推断都必须伴随着对其结果不确定性的评估。由于PSMC等方法依赖于基因组上连锁的遗传信息，一种称为“区块自助法”(block bootstrap)的特殊技术被用来量化不确定性。这个实践将重点关注如何分析这些自助法产生的重复估计值，指导您计算估计值的方差，并构建更合适的对数尺度置信区间，以正确反映群体大小估计中固有的乘性误差 [@problem_id:2700401]。", "problem": "给定一个时间区间内有效群体大小的自举重复估计值，这些估计值由诸如贝叶斯天际线图 (BSP) 或成对序列马尔可夫溯祖 (PSMC) 等种群动态推断方法产生。在基于溯祖的推断中，有效群体大小用 $N_e$ 表示，通过自举法重采样产生的重复样本 $\\{\\hat N_e^{(r)}\\}_{r=1}^R$ 可近似估计量在固定时间区间内的抽样分布。您将为每个区间实现以下两个任务，这些任务基于基本统计定义，并由群体大小估计量中的乘性不确定性证明其合理性：\n\n- 使用方差的标准定义，根据自举重复样本计算原始尺度上的无偏样本方差。\n- 在对数尺度上构建名义覆盖率为 $0.95$ 的双侧置信带以捕捉乘性不确定性，然后将该置信带映射回原始尺度。\n\n基本原理：\n- 自举重复样本通过在相同数据生成过程下进行有放回的重采样，来近似估计量的抽样分布。\n- 单变量样本 $\\{x_r\\}_{r=1}^R$ 的无偏样本方差为 $s^2=\\frac{1}{R-1}\\sum_{r=1}^R (x_r-\\bar x)^2$，其中 $\\bar x=\\frac{1}{R}\\sum_{r=1}^R x_r$ 且 $R\\ge 2$。\n- 对于乘性噪声 $X=\\theta\\cdot\\eta$，对数变换 $Y=\\log X$ 将乘性偏差转换为加性偏差；如果 $Y$ 近似服从正态分布，则对数尺度上一个近似的双侧 $(1-\\alpha)$ 置信带为 $\\bar Y \\pm z_{1-\\alpha/2}\\, s_Y$，其中 $\\bar Y$ 和 $s_Y$ 是 $\\{Y_r\\}_{r=1}^R$ 的样本均值和样本标准差，而 $z_{q}$ 是标准正态分布的 $q$-分位数。映射回原始尺度得到 $\\left[\\exp(\\bar Y - z_{1-\\alpha/2}\\, s_Y),\\, \\exp(\\bar Y + z_{1-\\alpha/2}\\, s_Y)\\right]$。\n\n形式上，对于每个具有严格为正的自举重复样本 $\\{\\hat N_e^{(r)}\\}_{r=1}^R$ 的区间：\n- 计算原始尺度上的无偏样本方差，\n$$\ns_{\\text{orig}}^2 \\;=\\; \\frac{1}{R-1}\\sum_{r=1}^R \\left(\\hat N_e^{(r)} - \\bar N_e\\right)^2,\\quad\n\\bar N_e \\;=\\; \\frac{1}{R}\\sum_{r=1}^R \\hat N_e^{(r)}.\n$$\n- 定义 $Y_r=\\log \\hat N_e^{(r)}$ 对于 $r=1,\\dots,R$，并计算\n$$\n\\bar Y \\;=\\; \\frac{1}{R}\\sum_{r=1}^R Y_r,\\qquad\ns_Y \\;=\\; \\sqrt{\\frac{1}{R-1}\\sum_{r=1}^R \\left(Y_r-\\bar Y\\right)^2}.\n$$\n设 $\\alpha=0.05$，令 $z_{1-\\alpha/2}$ 表示在 $1-\\alpha/2=0.975$ 处的标准正态分位数。映射回原始尺度的对数置信带是\n$$\n\\left[L, U\\right] \\;=\\; \\left[\\exp\\!\\left(\\bar Y - z_{0.975}\\, s_Y\\right),\\ \\exp\\!\\left(\\bar Y + z_{0.975}\\, s_Y\\right)\\right].\n$$\n\n您的程序必须为以下测试区间集实现这些计算，每个区间表示为一个严格为正的实数列表 $\\{\\hat N_e^{(r)}\\}_{r=1}^R$：\n- 案例 1 (典型的中等变异性)：$[10000.0,\\, 12000.0,\\, 11000.0,\\, 10500.0,\\, 11500.0]$。\n- 案例 2 (相同的重复样本；零方差的边界情况)：$[5000.0,\\, 5000.0,\\, 5000.0,\\, 5000.0]$。\n- 案例 3 (最少重复样本 $R=2$；分布范围大)：$[10000.0,\\, 40000.0]$。\n- 案例 4 (强乘性分布)：$[10000.0,\\, 20000.0,\\, 40000.0,\\, 80000.0,\\, 160000.0]$。\n\n要求：\n- 对每个案例，使用自然对数计算如上定义的 $s_{\\text{orig}}^2$、$L$ 和 $U$。\n- 使用除数为 $R-1$ 的无偏方差和标准差。\n- 对置信带使用标准正态分位数 $z_{0.975}$。\n- 将报告的每个数字四舍五入到 $6$ 位小数。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表，每个测试案例一个结果。每个结果本身必须是按 $[s_{\\text{orig}}^2, L, U]$ 顺序排列的三个浮点数的列表。例如，整体输出必须如下所示\n$[[v_1,\\ell_1,u_1],[v_2,\\ell_2,u_2],[v_3,\\ell_3,u_3],[v_4,\\ell_4,u_4]]$\n没有多余的空格。", "solution": "问题陈述已经过评估并被确定为有效。它基于已建立的统计学和群体遗传学原理，具有科学依据，其提法明确、规范完整，且表述客观。因此，我们将着手推导解决方案。\n\n任务是为每组给定的有效群体大小的自举重复样本 $\\{\\hat N_e^{(r)}\\}_{r=1}^R$ 计算两个统计摘要。这些重复样本是针对单个时间区间的。计算将针对 $4$ 个独立的测试案例进行。\n\n第一个量是重复样本在原始尺度上的无偏样本方差。对于一组 $R$ 个重复样本，此值使用以下公式计算：\n$$\ns_{\\text{orig}}^2 = \\frac{1}{R-1}\\sum_{r=1}^R \\left(\\hat N_e^{(r)} - \\bar N_e\\right)^2\n$$\n其中 $\\bar N_e$ 是样本均值，$\\bar N_e = \\frac{1}{R}\\sum_{r=1}^R \\hat N_e^{(r)}$。此计算仅在 $R \\ge 2$ 时有定义，所有测试案例均满足此条件。\n\n第二个任务是构建一个名义覆盖率为 $0.95$ 的双侧置信带。这基于一个假设，即 $\\hat N_e$ 的不确定性是乘性的，这在该领域是一个常见且合理的模型。对数变换 $Y_r = \\log \\hat N_e^{(r)}$ 将乘性噪声转换为加性正态形式。我们使用自然对数作为 $\\log$ 函数。在这个对数变换后的尺度上，我们计算样本均值 $\\bar Y$ 和无偏样本标准差 $s_Y$：\n$$\n\\bar Y = \\frac{1}{R}\\sum_{r=1}^R Y_r, \\qquad s_Y = \\sqrt{\\frac{1}{R-1}\\sum_{r=1}^R \\left(Y_r - \\bar Y\\right)^2}\n$$\n在对数尺度上，均值的 $(1-\\alpha)$ 置信区间由 $\\bar Y \\pm z_{1-\\alpha/2} s_Y$ 给出。对于 $0.95$ 的置信水平，$\\alpha = 0.05$，因此我们需要标准正态分布的 $1 - 0.05/2 = 0.975$ 分位数，记为 $z_{0.975}$。该值约为 $z_{0.975} \\approx 1.959964$。\n\n置信区间的下界 ($L$) 和上界 ($U$) 是通过对对数尺度区间的界限取指数得到的：\n$$\nL = \\exp(\\bar Y - z_{0.975}\\, s_Y)\n$$\n$$\nU = \\exp(\\bar Y + z_{0.975}\\, s_Y)\n$$\n这会在原始尺度上产生一个非对称的置信区间 $[L, U]$，它正确地反映了不确定性的乘性特质。\n\n每个测试案例的实现将按以下步骤进行：\n$1$. 将输入的重复样本列表转换为数值数组。设重复样本数量为 $R$。\n$2$. 使用提供的公式计算无偏样本方差 $s_{\\text{orig}}^2$，采用的除数为 $R-1$。\n$3$. 使用自然对数对重复样本进行变换，因为所有提供的值都是严格为正的。\n$4$. 计算对数变换后数据的均值 $\\bar Y$ 和无偏样本标准差 $s_Y$。如果所有重复样本都相同，$s_Y$ 将正确地为 $0$。\n$5$. 从标准正态分布的逆累积分布函数的高精度实现中获取分位数 $z_{0.975}$。\n$6$. 通过在对数尺度上构建区间，然后应用指数函数将其变换回原始尺度，来计算置信界限 $L$ 和 $U$。\n$7$. 按照要求，将 $s_{\\text{orig}}^2$、$L$ 和 $U$ 的最终值四舍五入到 $6$ 位小数。\n\n此过程将应用于问题陈述中提供的所有 $4$ 个测试案例，以生成最终输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes variance and log-normal confidence intervals for bootstrap replicates\n    of effective population size.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (typical moderate variability)\n        [10000.0, 12000.0, 11000.0, 10500.0, 11500.0],\n        # Case 2 (identical replicates; boundary for zero variance)\n        [5000.0, 5000.0, 5000.0, 5000.0],\n        # Case 3 (minimal replicates R=2; large spread)\n        [10000.0, 40000.0],\n        # Case 4 (strong multiplicative spread)\n        [10000.0, 20000.0, 40000.0, 80000.0, 160000.0]\n    ]\n\n    results = []\n    \n    # Set nominal coverage and find the corresponding z-score for a two-sided interval.\n    # For a 95% confidence interval, alpha = 0.05.\n    alpha = 0.05\n    z_score = norm.ppf(1 - alpha / 2)\n\n    for case_data in test_cases:\n        # Use float64 for better precision in numerical computations.\n        replicates = np.array(case_data, dtype=np.float64)\n        R = len(replicates)\n        \n        # The problem statement ensures R >= 2, so ddof=1 is always valid.\n        \n        # Task 1: Compute the unbiased sample variance on the original scale.\n        # np.var with ddof=1 uses a divisor of (R-1).\n        s_orig_sq = np.var(replicates, ddof=1)\n        \n        # Task 2: Construct a log-normal confidence band.\n        # The problem guarantees strictly positive replicates, so log is safe.\n        log_replicates = np.log(replicates)\n        \n        # Compute the sample mean and sample standard deviation on the log scale.\n        # np.std with ddof=1 uses a divisor of (R-1).\n        y_bar = np.mean(log_replicates)\n        s_y = np.std(log_replicates, ddof=1)\n        \n        # If all replicates are identical, s_y will be 0. The subsequent\n        # calculations handle this correctly, yielding a zero-width CI.\n        \n        # Calculate the margin of error on the log scale.\n        margin_of_error = z_score * s_y\n        \n        # Construct the confidence interval on the log scale.\n        log_lower = y_bar - margin_of_error\n        log_upper = y_bar + margin_of_error\n        \n        # Map the interval back to the original scale by exponentiation.\n        L = np.exp(log_lower)\n        U = np.exp(log_upper)\n        \n        # Append the rounded results for the current case.\n        results.append([\n            round(s_orig_sq, 6),\n            round(L, 6),\n            round(U, 6)\n        ])\n\n    # Final print statement must produce a single-line string representation\n    # of the list of lists, with no spaces, as specified.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "2700401"}]}