{"hands_on_practices": [{"introduction": "系统发育动态模型，如天际线图（skyline plot），能够估算病原体种群随时间变化的基本参数。然而，对于公共卫生而言，我们最关心的流行病学指标通常是有效再生数 $R_e$。本练习将指导你如何将出生-死亡-抽样模型的直接输出（如谱系净增长率和抽样概率）转化为更具解释性的 $R_e(t)$，这是将模型结果应用于公共卫生决策的关键一步。[@problem_id:2742387]", "problem": "一个直接传播的RNA病毒通过带抽样的生死过程进行建模，该过程在持续时间分别为$\\Delta_1$、$\\Delta_2$和$\\Delta_3$（单位：天）的三个连续区间内采用分段常数（天际线）参数化。在每个区间内，每个感染谱系的传播率为$\\lambda_i$，因恢复或传染性终止而变为非传染性的速率为$\\delta$（假设在所有区间内恒定），带移除的抽样以速率$\\psi_i$发生（即，一旦被抽样，谱系即停止传染）。因此，区间$i$内的总移除率为$\\delta + \\psi_i$。区间$i$的有效再生数定义为在一个典型感染谱系变为非传染性之前产生的预期继发感染数，即$R_{e,i} = \\lambda_i / (\\delta + \\psi_i)$。区间$i$的净分化（谱系增长）率为$r_i = \\lambda_i - (\\delta + \\psi_i)$。天际线输出还报告了在区间$i$内，一个移除事件是一个抽样事件的概率，记为$p_i$，满足$p_i = \\psi_i / (\\delta + \\psi_i)$。\n\n给定以下经验估计量：\n- 恒定的变为非传染性速率 $\\delta = 0.25$ 每天。\n- 区间持续时间：$\\Delta_1 = 20$ 天, $\\Delta_2 = 30$ 天, $\\Delta_3 = 25$ 天。\n- 净分化率：$r_1 = 0.10$ 每天, $r_2 = -0.05$ 每天, $r_3 = 0.02$ 每天。\n- 移除事件中的抽样概率：$p_1 = 0.20$, $p_2 = 0.50$, $p_3 = 0.33$。\n\n假设所有量在其各自区间内都是分段常数，并且该过程可以如上所述用带抽样的生死模型很好地近似。定义在总观察窗口$T = \\Delta_1 + \\Delta_2 + \\Delta_3$上的时间平均有效再生数为\n$$\\bar{R}_e \\equiv \\frac{1}{T} \\int_0^T R_e(t)\\,dt,$$\n其中在区间$i$中，$R_e(t)$等于$R_{e,i}$。\n\n仅使用上面提供的定义和给定数据计算$\\bar{R}_e$。将最终答案表示为一个无量纲数，并将结果四舍五入到四位有效数字。", "solution": "该问题陈述已经过验证，被认为是可接受的。这是一个在系统动力学领域中的适定问题，基于标准的带抽样生死模型。所提供的定义是一致的，数据足以计算出唯一解。\n\n目标是计算在总观察窗口$T$上的时间平均有效再生数$\\bar{R}_e$。提供的定义是：\n$$\n\\bar{R}_e \\equiv \\frac{1}{T} \\int_0^T R_e(t)\\,dt\n$$\n观察窗口的总持续时间是$T = \\Delta_1 + \\Delta_2 + \\Delta_3$。给定区间持续时间$\\Delta_1 = 20$天，$\\Delta_2 = 30$天，和$\\Delta_3 = 25$天，总持续时间为：\n$$\nT = 20 + 30 + 25 = 75 \\text{ 天}\n$$\n由于有效再生数$R_e(t)$是分段常数，在区间$i$的持续时间$\\Delta_i$内，$R_e(t) = R_{e,i}$，该积分可以表示为加权和：\n$$\n\\bar{R}_e = \\frac{1}{T} \\left( \\Delta_1 R_{e,1} + \\Delta_2 R_{e,2} + \\Delta_3 R_{e,3} \\right)\n$$\n为了计算$\\bar{R}_e$，我们必须首先确定每个区间$i \\in \\{1, 2, 3\\}$的$R_{e,i}$值。问题提供了以下定义：\n1. 净分化率：$r_i = \\lambda_i - (\\delta + \\psi_i)$\n2. 有效再生数：$R_{e,i} = \\frac{\\lambda_i}{\\delta + \\psi_i}$\n3. 抽样概率：$p_i = \\frac{\\psi_i}{\\delta + \\psi_i}$\n\n根据定义(1)，我们可以将传播率$\\lambda_i$表示为$\\lambda_i = r_i + \\delta + \\psi_i$。将此代入定义(2)中$R_{e,i}$的表达式，得到：\n$$\nR_{e,i} = \\frac{r_i + \\delta + \\psi_i}{\\delta + \\psi_i} = \\frac{r_i}{\\delta + \\psi_i} + 1\n$$\n这个$R_{e,i}$的表达式依赖于总移除率$\\delta + \\psi_i$。该项可以使用定义(3)与给定的参数$\\delta$和$p_i$联系起来。具体来说，我们可以写出：\n$$\n1 - p_i = 1 - \\frac{\\psi_i}{\\delta + \\psi_i} = \\frac{(\\delta + \\psi_i) - \\psi_i}{\\delta + \\psi_i} = \\frac{\\delta}{\\delta + \\psi_i}\n$$\n重新整理这个方程，得到总移除率的直接表达式：\n$$\n\\delta + \\psi_i = \\frac{\\delta}{1 - p_i}\n$$\n现在，我们将此结果代回我们的$R_{e,i}$表达式中：\n$$\nR_{e,i} = \\frac{r_i}{\\left(\\frac{\\delta}{1 - p_i}\\right)} + 1 = \\frac{r_i (1 - p_i)}{\\delta} + 1\n$$\n这个最终方程允许使用问题陈述中提供的量：$r_i$、$p_i$和常数$\\delta = 0.25$每天，来直接计算$R_{e,i}$。\n\n我们现在计算三个区间中每个区间的$R_{e,i}$。\n\n对于区间1：\n给定$r_1 = 0.10$和$p_1 = 0.20$。\n$$\nR_{e,1} = \\frac{r_1 (1 - p_1)}{\\delta} + 1 = \\frac{0.10 \\times (1 - 0.20)}{0.25} + 1 = \\frac{0.10 \\times 0.80}{0.25} + 1 = \\frac{0.08}{0.25} + 1 = 0.32 + 1 = 1.32\n$$\n\n对于区间2：\n给定$r_2 = -0.05$和$p_2 = 0.50$。\n$$\nR_{e,2} = \\frac{r_2 (1 - p_2)}{\\delta} + 1 = \\frac{-0.05 \\times (1 - 0.50)}{0.25} + 1 = \\frac{-0.05 \\times 0.50}{0.25} + 1 = \\frac{-0.025}{0.25} + 1 = -0.10 + 1 = 0.90\n$$\n\n对于区间3：\n给定$r_3 = 0.02$和$p_3 = 0.33$。\n$$\nR_{e,3} = \\frac{r_3 (1 - p_3)}{\\delta} + 1 = \\frac{0.02 \\times (1 - 0.33)}{0.25} + 1 = \\frac{0.02 \\times 0.67}{0.25} + 1 = \\frac{0.0134}{0.25} + 1 = 0.0536 + 1 = 1.0536\n$$\n\n计算出$R_{e,1}$、$R_{e,2}$和$R_{e,3}$的值后，我们现在可以计算时间平均有效再生数$\\bar{R}_e$：\n$$\n\\bar{R}_e = \\frac{1}{75} \\left( (\\Delta_1 R_{e,1}) + (\\Delta_2 R_{e,2}) + (\\Delta_3 R_{e,3}) \\right)\n$$\n$$\n\\bar{R}_e = \\frac{1}{75} \\left( (20 \\times 1.32) + (30 \\times 0.90) + (25 \\times 1.0536) \\right)\n$$\n$$\n\\bar{R}_e = \\frac{1}{75} \\left( 26.4 + 27.0 + 26.34 \\right)\n$$\n$$\n\\bar{R}_e = \\frac{79.74}{75} = 1.0632\n$$\n问题要求最终答案四舍五入到四位有效数字。计算值为$1.0632$。将其四舍五入到四位有效数字得到$1.063$。", "answer": "$$\n\\boxed{1.063}\n$$", "id": "2742387"}, {"introduction": "从系统发育树中推断出的有效种群大小（$N_e$）下降可能具有多重含义。它可能反映了影响整个病原体种群的真实人口瓶颈，也可能是在特定基因（如耐药基因）上发生选择性清除所产生的统计假象。本练习旨在挑战你批判性地思考如何设计分析（利用连锁与非连锁的基因组区域），以区分这两种根本不同的进化情景，这是解读基因组监测数据的核心任务。[@problem_id:2414569]", "problem": "在 $T$ 个月的时间里，以近似恒定的强度进行连续采样，以监测一种 RNA 病毒的急性暴发。您从 $n$ 个受感染的宿主中获得了全基因组序列，并将序列比对划分为两个不重叠的区域组：(i) 一个中性区域组，包含许多分布在基因组片段上的推定中性基因间位点，这些片段与已知的抗药性基因不连锁；以及 (ii) 一个药物关联区域组，包含一个与抗药性基因紧密连锁的连续窗口。假设存在严格分子钟且替换速率恒定、种群为随机交配（无种群结构）、每个区域组内部的重组可忽略不计，以及区域组之间有足够频繁的重组（或重配），以至于在暴发的时间尺度上，中性区域组与抗药性基因位点实际上是不连锁的。您将贝叶斯天际线图 (BSP) 模型分别拟合到每个区域组，以推断有效种群大小随时间变化的函数 $N_e(t)$。\n\n在上述假设下，对于抗药性基因位点上发生的硬选择性清除与影响整个病原体种群的真实种群瓶颈，以下哪个选项最能描述预期的不同 BSP 特征？\n\nA. 硬选择性清除仅在药物关联区域组中（以清除时间为中心）产生推断的 $N_e(t)$ 的急剧、短暂下降，而中性区域组保持近似恒定；真实的种群瓶颈在两个区域组中产生时间相似的 $N_e(t)$ 同步下降，如果种群数量反弹，随后会恢复。\n\nB. 硬选择性清除在两个区域组中都产生 $N_e(t)$ 的同步下降，但中性区域组的下降比药物关联区域组更早、更深；真实的种群瓶颈在两个区域组中均不产生明显变化。\n\nC. 硬选择性清除导致药物关联区域组的 $N_e(t)$ 持续长期下降且无后续恢复，而真实的种群瓶颈使药物关联区域组保持不变，仅降低中性区域组的 $N_e(t)$。\n\nD. 真实的种群瓶颈会增加两个区域组中推断的 $N_e(t)$，因为谱系数量较少，而硬选择性清除会使两个区域组的 $N_e(t)$ 在较长时间内下降。\n\nE. 当药物关联区域组仅显示 $N_e(t)$ 的指数增长而无短暂下降，而中性区域组显示短暂下降时，可识别为硬选择性清除；当只有药物关联区域组下降时，可识别为真实的种群瓶颈。", "solution": "必须首先验证问题陈述的科学性和逻辑完整性。\n\n### 步骤 1：提取已知条件\n-   **系统：**一种 RNA 病毒的急性暴发。\n-   **采样：**在 $T$ 个月内以近似恒定的强度进行连续采样监测。\n-   **数据：**来自 $n$ 个受感染宿主的全基因组序列。\n-   **基因组划分：**\n    -   (i) **中性区域组：**许多推定的中性基因间位点，与抗药性基因不连锁。\n    -   (ii) **药物关联区域组：**一个与抗药性基因紧密连锁的连续窗口。\n-   **假设：**\n    1.  严格分子钟，替换速率恒定。\n    2.  随机交配（无种群结构）。\n    3.  每个区域组内部的重组可忽略不计。\n    4.  区域组之间频繁的重组/重配，使得中性区域组与抗药性基因位点实际上不连锁。\n-   **方法：**将贝叶斯天际线图 (BSP) 模型分别拟合到每个区域组，以推断有效种群大小的历史，$N_e(t)$。\n-   **问题：**描述在抗药性基因位点上发生硬选择性清除与影响整个病原体种群的真实种群瓶颈这两种情况下，预期的不同 BSP 特征。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据所需标准对问题陈述进行评估。\n\n1.  **科学性：**该问题牢固地植根于谱系动力学领域，它是计算生物学和进化生物学的一个子学科。它利用了核心且成熟的概念：有效种群大小 ($N_e$)、溯祖过程、选择性清除、种群瓶颈以及作为推断工具的贝叶斯天际线图 (BSP)。在种群遗传学中，比较连锁位点与非连锁位点以区分种群历史和选择效应是一种经典且基础合理的方法。\n2.  **问题的明确性：**问题具体且可回答。它要求在两种不同且明确定义的进化情景下，对一种标准统计方法（BSP）的输出进行定性比较。所提供的假设（随机交配、分子钟、连锁/非连锁）是必要的简化，使问题在理论上易于处理，并能导出一个概念清晰的解决方案。\n3.  **客观性：**语言技术性强、精确，没有主观或含糊的术语。\n4.  **完整性和一致性：**问题提供了所有必要的信息来推断预期的定性结果。关键信息是基因组区域组与受选择位点之间的连锁关系，以及种群事件（全基因组范围）与选择事件（位点特异性）的不同性质。内部没有矛盾。\n5.  **现实性：**该情景虽然理想化（例如，完美的非连锁、严格的分子钟），但它是用于理解真实世界数据的标准理论模型。这类情景在谱系动力学文献中经常被探讨，并非科学上不可能。\n\n### 步骤 3：结论与行动\n问题是**有效的**。它在科学上是合理的、问题明确，并为基于种群遗传学和溯祖理论的既定原则得出严谨答案提供了充分的基础。接下来进行解题推导。\n\n### 解题推导\n\n这个问题的核心在于理解进化事件如何影响谱系，以及贝叶斯天际线图 (BSP) 模型如何解释这些谱系模式来推断有效种群大小的历史 $N_e(t)$。\n\nBSP 是一种基于溯祖理论的推断方法。溯祖理论的基本原理是，任何一对谱系找到共同祖先（即溯祖合并）的速率与有效种群大小成反比。对于一个包含 $k$ 个谱系的样本，在时间 $t$ 的总溯祖速率由 $\\lambda_k(t) = \\frac{\\binom{k}{2}}{N_e(t)}$ 给出。BSP 将高的溯祖速率解释为小的 $N_e(t)$，将低的溯祖速率解释为大的 $N_e(t)$。BSP 从序列数据中重建谱系，并利用溯祖事件之间的等待时间分布来估计一个关于 $N_e(t)$ 随时间变化的分段函数。\n\n我们现在分析两种情景。\n\n**情景 1：真实的种群瓶颈**\n种群瓶颈是整个种群普查规模的减少。这一事件是系统性的，对所有个体，因此对所有基因组位点，都产生无差别的影​​响。\n\n1.  对溯祖合并的影响：种群规模的急剧下降迫使所有谱系（无论其基因组位置如何）更快地找到共同祖先。这导致溯祖事件在对应于瓶颈的时间区间内集中爆发。\n2.  对基因组区域组的影响：由于瓶颈影响整个种群，来自**中性区域组**和**药物关联区域组**的谱系的溯祖历史都将同样被这种快速溯祖的爆发所标记。\n3.  BSP 特征：当 BSP 模型分别应用于每个区域组时，它将在两个数据集中都检测到这种更高的溯祖速率。因此，它将推断出两个区域组的 $N_e(t)$ 都出现同步且急剧的下降，下降的时间和深度大致相似（考虑到随机变异）。如果种群随后恢复并扩张，溯祖速率将下降，BSP 将推断出在瓶颈之后相应的 $N_e(t)$ 增加。\n\n**情景 2：抗药性基因位点上的硬选择性清除**\n当一个单一的、新的有利突变（此处指抗药性基因上的突变）迅速增加其频率，并将其连锁的中性变异一同带到高频率或固定时，就会发生硬选择性清除。这种现象被称为遗传搭便车。\n\n1.  对溯祖合并的影响：选择效应是位点特异性的。携带有利突变的单个成功谱系的迅速传播意味着该位点上的所有其他谱系都被淘汰。因此，对于任何与受选择位点紧密连锁的位点，所有采样谱系的祖先都必须追溯到突变起源的那个单一谱系。这迫使所有谱系在清除发生时点附近的一个非常短的时间窗口内非常迅速地溯祖合并。该位点的谱系将类似于一个星状谱系。\n2.  对药物关联区域组的影响：根据定义，该区域组与选择位点紧密连锁。它将经历选择性清除的全部影响。来自该区域组的序列谱系将以溯祖事件的“爆发”为特征。BSP 会将其解释为有效种群大小 $N_e(t)$ 在清除发生时点上的一次严重但短暂的减少。\n3.  对中性区域组的影响：根据假设，该区域组与抗药性基因位点实际上不连锁。因此，该区域组中的溯祖过程与选择事件解耦。其谱系将只反映种群的背景种群历史。如果我们为作对比而假设种群规模近似恒定，那么该区域组谱系中的溯祖事件将随时间更均匀地分布，反映出恒定的 $N_e(t)$。\n4.  BSP 特征：应用于药物关联区域组的 BSP 将显示 $N_e(t)$ 的急剧、短暂下降。应用于中性区域组的 BSP 将显示反映真实种群历史的曲线，如果没有发生种群变化，该曲线将是近似恒定的 $N_e(t)$。关键特征是两个推断历史之间的不一致性。\n\n### 逐项分析\n\n**A. 硬选择性清除仅在药物关联区域组中（以清除时间为中心）产生推断的 $N_e(t)$ 的急剧、短暂下降，而中性区域组保持近似恒定；真实的种群瓶颈在两个区域组中产生时间相似的 $N_e(t)$ 同步下降，如果种群数量反弹，随后会恢复。**\n该陈述准确反映了从基本原理得出的推论。选择性清除是仅影响连锁区域组的位点特异性事件，而种群瓶颈是同步影响两个区域组的全基因组事件。**正确**。\n\n**B. 硬选择性清除在两个区域组中都产生 $N_e(t)$ 的同步下降，但中性区域组的下降比药物关联区域组更早、更深；真实的种群瓶颈在两个区域组中均不产生明显变化。**\n这是不正确的。选择性清除的影响在非连锁位点上不是同步的。关于瓶颈不产生明显变化的说法也是错误的；它会产生非常强的信号。**不正确**。\n\n**C. 硬选择性清除导致药物关联区域组的 $N_e(t)$ 持续长期下降且无后续恢复，而真实的种群瓶颈使药物关联区域组保持不变，仅降低中性区域组的 $N_e(t)$。**\n这是不正确的。从选择性清除推断出的 $N_e(t)$ 下降是短暂的，而不是持续长期的。在清除完成后，多样性通过新突变开始恢复。关于瓶颈只影响中性区域组的说法也是错误的；它影响整个基因组。**不正确**。\n\n**D. 真实的种群瓶颈会增加两个区域组中推断的 $N_e(t)$，因为谱系数量较少，而硬选择性清除会使两个区域组的 $N_e(t)$ 在较长时间内下降。**\n这是不正确的。瓶颈会*降低*真实的 $N_e$，并由于更快的溯祖合并而导致推断的 $N_e(t)$ 下降。其前提就有问题。选择性清除不影响非连锁位点，因此它不会使两个区域组的 $N_e(t)$ 都下降。**不正确**。\n\n**E. 当药物关联区域组仅显示 $N_e(t)$ 的指数增长而无短暂下降，而中性区域组显示短暂下降时，可识别为硬选择性清除；当只有药物关联区域组下降时，可识别为真实的种群瓶颈。**\n该陈述颠倒了预期的模式。选择性清除导致连锁区域组的短暂下降，而不是指数增长。瓶颈导致两个区域组都下降，而不仅仅是一个。**不正确**。", "answer": "$$\\boxed{A}$$", "id": "2414569"}, {"introduction": "现实世界中的流行病并非孤立发生，理解境外输入与本地传播的作用对于制定有效的控制策略至关重要。本练习将介绍结构化溯祖模型，这是一个研究空间结构化种群的强大框架。通过推导其内在逻辑，你将学习如何利用系统发育树中的事件计数来估算这两种传播途径的相对重要性。[@problem_id:2414525]", "problem": "考虑一个针对传染病的双种群结构溯祖模型，该模型包含一个本地种群（种群A）和一个外部种群（种群B）。在时间回溯的结构溯祖模型中，种群A中的谱系可能发生两类事件：与A中的另一谱系合并，或从A迁移到B。假设以下基本前提，这在传染病系统发生动力学中是标准做法。首先，在一个各种群有效种群大小恒定的结构溯祖模型中，在时间 $t$ 时种群A中谱系间的瞬时合并率由 $\\lambda_{\\text{coal},A}(t) = \\binom{n_A(t)}{2} / N_{e,A}$ 给出，其中 $n_A(t)$ 是时间 $t$ 时种群A中的谱系数量，$N_{e,A}$ 是种群A的溯祖有效种群大小，并假设其在观测窗口内为常数。其次，从种群A到种群B的时间回溯迁移以恒定的单位谱系速率 $m_{A\\to B}$ 发生，因此在时间 $t$ 时从A迁出的瞬时总迁移率为 $\\lambda_{\\text{mig},A}(t) = m_{A\\to B} \\, n_A(t)$。第三，在标准溯祖假设下，以谱系数量轨迹 $n_A(t)$ 为条件，合并事件和迁移事件分别作为强度为 $\\lambda_{\\text{coal},A}(t)$ 和 $\\lambda_{\\text{mig},A}(t)$ 的竞争性非齐次泊松过程出现。\n\n假设给定一个固定的、经时间定标的谱系树，其分支上标注有种群标签，并且您获得了在一个已知观测窗口内聚合的充分统计量：在种群A中发生的合并事件总数，记为 $C_A$；沿处于A状态的谱系片段从A到B的时间回溯迁移事件总数，记为 $M_{A\\to B}$；积分A谱系对时间 $L^{(\\text{pairs})}_A = \\int \\binom{n_A(t)}{2} \\, dt$；以及积分A谱系时间 $L^{(\\text{lineages})}_A = \\int n_A(t) \\, dt$。所有积分都是在相同物理时间单位（例如，年）下对时间进行的。假设 $N_{e,A}$ 和 $m_{A\\to B}$ 在该窗口内是恒定的。\n\n您的任务是，从第一性原理出发，估算在观测窗口期间，本地传播与外部输入对种群A中持续流行病的溯祖源头的相对贡献。将本地传播的相对贡献定义为分数\n$$\nf_{\\text{local}} \\equiv \\frac{\\int \\lambda_{\\text{coal},A}(t)\\, dt}{\\int \\lambda_{\\text{coal},A}(t)\\, dt + \\int \\lambda_{\\text{mig},A}(t)\\, dt},\n$$\n并将外部输入的相对贡献定义为 $f_{\\text{import}} \\equiv 1 - f_{\\text{local}}$。将 $f_{\\text{local}}$ 和 $f_{\\text{import}}$ 表示为不带任何单位的小数。\n\n从上述基本定义以及 $N_{e,A}$ 和 $m_{A\\to B}$ 恒定的假设出发，仅使用 $C_A$、$M_{A\\to B}$、$L^{(\\text{pairs})}_A$ 和 $L^{(\\text{lineages})}_A$ 推导出 $N_{e,A}$ 和 $m_{A\\to B}$ 的最大似然估计量，然后将它们代入 $f_{\\text{local}}$ 和 $f_{\\text{import}}$ 的定义中，以获得可计算的表达式。\n\n实现一个程序，对下面的每个测试用例，计算 $f_{\\text{local}}$ 和 $f_{\\text{import}}$，并四舍五入到六位小数。输出中没有物理单位，必须表示为小数。\n\n使用以下测试套件，其中每个测试用例是一个元组 $(C_A, M_{A\\to B}, L^{(\\text{pairs})}_A, L^{(\\text{lineages})}_A)$：\n- 测试用例 1：$(12, 8, 240.0, 150.0)$\n- 测试用例 2：$(0, 5, 50.0, 80.0)$\n- 测试用例 3：$(7, 0, 140.0, 100.0)$\n- 测试用例 4：$(100, 100, 5000.0, 4000.0)$\n\n为保证覆盖性，设计如下：\n- 第一个用例是同时包含合并和迁移事件的一般情况。\n- 第二个用例是在观测窗口内A中没有合并事件的边界条件。\n- 第三个用例是在观测窗口内没有从A迁出的迁移事件的边界条件。\n- 第四个用例测试当计数相等且较大时的对称性。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[f_{\\text{local}}^{(1)}, f_{\\text{import}}^{(1)}, f_{\\text{local}}^{(2)}, f_{\\text{import}}^{(2)}, f_{\\text{local}}^{(3)}, f_{\\text{import}}^{(3)}, f_{\\text{local}}^{(4)}, f_{\\text{import}}^{(4)}]$，其中上标索引测试用例。例如，格式应类似于 $[0.123456,0.876544, \\ldots]$，每个数字在小数点后恰好有六位。输出必须是小数（而非百分比）。", "solution": "问题陈述已经过严格验证。\n\n已知条件逐字提取如下：\n- 一个双种群结构溯祖模型：种群A（本地）和种群B（外部）。\n- A中谱系的时间回溯事件：在A中合并或从A迁移到B。\n- 种群A中的瞬时合并率：$\\lambda_{\\text{coal},A}(t) = \\binom{n_A(t)}{2} / N_{e,A}$，其中 $N_{e,A}$ 为常数。\n- 从种群A迁出的瞬时总迁移率：$\\lambda_{\\text{mig},A}(t) = m_{A\\to B} \\, n_A(t)$，其中 $m_{A\\to B}$ 为常数。\n- 事件是竞争性的非齐次泊松过程。\n- 充分统计量：A中的总合并事件数 $C_A$；从A到B的总迁移事件数 $M_{A\\to B}$；积分A谱系对时间 $L^{(\\text{pairs})}_A = \\int \\binom{n_A(t)}{2} \\, dt$；积分A谱系时间 $L^{(\\text{lineages})}_A = \\int n_A(t) \\, dt$。\n- 本地相对贡献的定义：$f_{\\text{local}} \\equiv \\frac{\\int \\lambda_{\\text{coal},A}(t)\\, dt}{\\int \\lambda_{\\text{coal},A}(t)\\, dt + \\int \\lambda_{\\text{mig},A}(t)\\, dt}$。\n- 外部输入相对贡献的定义：$f_{\\text{import}} \\equiv 1 - f_{\\text{local}}$。\n- 任务：推导 $N_{e,A}$ 和 $m_{A\\to B}$ 的最大似然估计量（MLEs），代入它们以找到 $f_{\\text{local}}$ 和 $f_{\\text{import}}$ 的表达式，并为给定的测试用例计算这些值。\n\n该问题被评估为 **有效**。它在科学上基于标准的结构溯祖理论，这是系统发生动力学的一个基本框架。其定义、假设和提供的数据是自洽、一致且适定的。该问题是可形式化的，并与指定主题直接相关。它没有违反任何无效标准。因此，我们可以着手解决。\n\n解决方案从第一性原理推导得出。问题的核心在于从竞争性非齐次泊松过程中观测到一定数量事件的似然性。以种群A中谱系数量的轨迹 $n_A(t)$ 为条件，在观测窗口内，合并事件的总期望数 $\\mathbb{E}[C_A]$ 和迁移事件的总期望数 $\\mathbb{E}[M_{A\\to B}]$ 由它们各自速率的时间积分给出。\n\n首先，我们用给定的参数和充分统计量来表示这些积分速率。\n积分合并率为：\n$$ \\int \\lambda_{\\text{coal},A}(t)\\, dt = \\int \\frac{\\binom{n_A(t)}{2}}{N_{e,A}} \\, dt = \\frac{1}{N_{e,A}} \\int \\binom{n_A(t)}{2} \\, dt = \\frac{L^{(\\text{pairs})}_A}{N_{e,A}} $$\n积分迁移率为：\n$$ \\int \\lambda_{\\text{mig},A}(t)\\, dt = \\int m_{A\\to B} \\, n_A(t) \\, dt = m_{A\\to B} \\int n_A(t) \\, dt = m_{A\\to B} L^{(\\text{lineages})}_A $$\n对于竞争性的、独立的泊松过程，观测到 $C_A$ 个合并事件和 $M_{A\\to B}$ 个迁移事件的似然性是它们各自泊松概率的乘积。因此，似然函数 $L(N_{e,A}, m_{A\\to B})$ 正比于：\n$$ L \\propto \\left(\\frac{L^{(\\text{pairs})}_A}{N_{e,A}}\\right)^{C_A} \\exp\\left(-\\frac{L^{(\\text{pairs})}_A}{N_{e,A}}\\right) \\times \\left(m_{A\\to B} L^{(\\text{lineages})}_A\\right)^{M_{A\\to B}} \\exp\\left(-m_{A\\to B} L^{(\\text{lineages})}_A\\right) $$\n为了找到最大似然估计量（MLEs），我们最大化对数似然函数 $\\ell = \\log L$。参数 $N_{e,A}$ 和 $m_{A\\to B}$ 出现在不同的项中，因此我们可以分别对每一个进行最大化。\n$$ \\ell(N_{e,A}, m_{A\\to B}) = \\text{const} - C_A \\log(N_{e,A}) - \\frac{L^{(\\text{pairs})}_A}{N_{e,A}} + M_{A\\to B} \\log(m_{A\\to B}) - m_{A\\to B} L^{(\\text{lineages})}_A $$\n为了找到 $N_{e,A}$ 的MLE，我们求 $\\ell$ 关于 $N_{e,A}$ 的偏导数并令其为零：\n$$ \\frac{\\partial \\ell}{\\partial N_{e,A}} = - \\frac{C_A}{N_{e,A}} + \\frac{L^{(\\text{pairs})}_A}{N_{e,A}^2} = 0 $$\n求解 $N_{e,A}$（假设 $C_A > 0$）得到MLE：\n$$ \\hat{N}_{e,A} = \\frac{L^{(\\text{pairs})}_A}{C_A} $$\n同理，对于 $m_{A\\to B}$：\n$$ \\frac{\\partial \\ell}{\\partial m_{A\\to B}} = \\frac{M_{A\\to B}}{m_{A\\to B}} - L^{(\\text{lineages})}_A = 0 $$\n求解 $m_{A\\to B}$（假设 $M_{A\\to B} > 0$）得到MLE：\n$$ \\hat{m}_{A\\to B} = \\frac{M_{A\\to B}}{L^{(\\text{lineages})}_A} $$\n问题要求我们计算相对贡献 $f_{\\text{local}}$ 和 $f_{\\text{import}}$。根据MLE的不变性，参数函数的MLE是MLE的函数。因此，我们将 $\\hat{N}_{e,A}$ 和 $\\hat{m}_{A\\to B}$ 代入 $f_{\\text{local}}$ 的定义中：\n$$ \\hat{f}_{\\text{local}} = \\frac{\\int \\hat{\\lambda}_{\\text{coal},A}(t)\\, dt}{\\int \\hat{\\lambda}_{\\text{coal},A}(t)\\, dt + \\int \\hat{\\lambda}_{\\text{mig},A}(t)\\, dt} = \\frac{L^{(\\text{pairs})}_A / \\hat{N}_{e,A}}{L^{(\\text{pairs})}_A / \\hat{N}_{e,A} + \\hat{m}_{A\\to B} L^{(\\text{lineages})}_A} $$\n现在我们代入MLE的表达式。分子变为：\n$$ \\frac{L^{(\\text{pairs})}_A}{\\hat{N}_{e,A}} = \\frac{L^{(\\text{pairs})}_A}{L^{(\\text{pairs})}_A / C_A} = C_A $$\n分母中的第二项变为：\n$$ \\hat{m}_{A\\to B} L^{(\\text{lineages})}_A = \\left(\\frac{M_{A\\to B}}{L^{(\\text{lineages})}_A}\\right) L^{(\\text{lineages})}_A = M_{A\\to B} $$\n将这些代回 $\\hat{f}_{\\text{local}}$ 的表达式中，得出一个非常简单的结果：\n$$ \\hat{f}_{\\text{local}} = \\frac{C_A}{C_A + M_{A\\to B}} $$\n这个结果在直觉上是正确的：由本地传播导致的溯祖源头估计分数，就是所有时间回溯事件（合并或迁移）中本地合并事件所占的观测分数。因此，由外部输入导致的分数为：\n$$ \\hat{f}_{\\text{import}} = 1 - \\hat{f}_{\\text{local}} = 1 - \\frac{C_A}{C_A + M_{A\\to B}} = \\frac{M_{A\\to B}}{C_A + M_{A\\to B}} $$\n只要 $C_A + M_{A\\to B} > 0$，这些表达式就有效，这对于所有提供的测试用例都成立。充分统计量 $L^{(\\text{pairs})}_A$ 和 $L^{(\\text{lineages})}_A$ 虽然对于形式化推导和估计潜在的物理参数 $N_{e,A}$ 和 $m_{A\\to B}$ 是必需的，但在计算作为速率之比的相对贡献时则不是必需的。\n\n我们现在将这些公式应用于测试用例。\n- 测试用例 1：$(C_A=12, M_{A\\to B}=8, L^{(\\text{pairs})}_A=240.0, L^{(\\text{lineages})}_A=150.0)$\n  $f_{\\text{local}} = \\frac{12}{12 + 8} = \\frac{12}{20} = 0.6$\n  $f_{\\text{import}} = \\frac{8}{12 + 8} = \\frac{8}{20} = 0.4$\n- 测试用例 2：$(C_A=0, M_{A\\to B}=5, L^{(\\text{pairs})}_A=50.0, L^{(\\text{lineages})}_A=80.0)$\n  $f_{\\text{local}} = \\frac{0}{0 + 5} = 0.0$\n  $f_{\\text{import}} = \\frac{5}{0 + 5} = 1.0$\n- 测试用例 3：$(C_A=7, M_{A\\to B}=0, L^{(\\text{pairs})}_A=140.0, L^{(\\text{lineages})}_A=100.0)$\n  $f_{\\text{local}} = \\frac{7}{7 + 0} = 1.0$\n  $f_{\\text{import}} = \\frac{0}{7 + 0} = 0.0$\n- 测试用例 4：$(C_A=100, M_{A\\to B}=100, L^{(\\text{pairs})}_A=5000.0, L^{(\\text{lineages})}_A=4000.0)$\n  $f_{\\text{local}} = \\frac{100}{100 + 100} = \\frac{100}{200} = 0.5$\n  $f_{\\text{import}} = \\frac{100}{100 + 100} = \\frac{100}{200} = 0.5$\n\n实现部分将计算这些值，并根据规格要求进行格式化。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the relative contributions of local transmission and importation\n    for a two-deme structured coalescent model based on event counts.\n    \"\"\"\n    \n    # Test suite: each tuple is (C_A, M_A_to_B, L_pairs_A, L_lineages_A)\n    test_cases = [\n        (12, 8, 240.0, 150.0),\n        (0, 5, 50.0, 80.0),\n        (7, 0, 140.0, 100.0),\n        (100, 100, 5000.0, 4000.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        C_A, M_A_to_B, _, _ = case\n        \n        # Total number of ancestry-resolving events (local coalescence or migration)\n        total_events = C_A + M_A_to_B\n        \n        # The problem statement guarantees through the test cases that total_events > 0.\n        # If total_events were 0, the fractions would be undefined (0/0).\n        if total_events == 0:\n            # This case is not present in the test suite.\n            # A robust implementation would define behavior, e.g., using NaN.\n            f_local = float('nan')\n            f_import = float('nan')\n        else:\n            # The maximum likelihood estimate for the fraction of local transmission\n            # events is the ratio of local coalescence events to total events.\n            f_local = C_A / total_events\n            \n            # The fraction of importation events is the complement.\n            f_import = M_A_to_B / total_events\n\n        # Append results formatted to six decimal places.\n        results.append(f\"{f_local:.6f}\")\n        results.append(f\"{f_import:.6f}\")\n\n    # Print the final output in the specified single-line format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2414525"}]}