{"hands_on_practices": [{"introduction": "文化演化的最基本过程之一是“文化漂变”，即由于随机抽样导致的文化变体频率的偶然波动。Wright-Fisher模型是理解这一过程的基石。这项练习将引导你推导一个中性文化变体（即没有内在优势或劣势的变体）在群体中最终被固定（频率达到100%）的概率，这是一个贯穿整个群体遗传学和文化演化理论的核心结果。通过这个练习[@problem_id:2699390]，你将掌握分析随机过程的基本技巧，并深刻理解在中性演化中，一个变体的最终命运仅仅取决于它最初的流行程度。", "problem": "考虑一个大小恒为 $N$ 的有限群体，在无创新的文化传播的赖特-费舍尔（Wright–Fisher）复制模型下演化。时间是离散的，由 $t \\in \\{0,1,2,\\dots\\}$ 索引，每一代 $t+1$ 都是通过从第 $t$ 代中有放回地抽取 $N$ 个文化亲本形成的，每次抽取都从第 $t$ 代的 $N$ 个个体中均匀地选择一个亲本。存在两种文化变体，记为 $A$ 和 $B$。令 $X_t \\in \\{0,1,\\dots,N\\}$ 为第 $t$ 代中 $A$ 变体携带者的数量，令 $x_t = X_t/N$ 为其对应的频率。假设中性和无创新：在每次抽取中，亲本都是独立且均匀地选择的，因此，在给定 $X_t=i$ 的条件下，$X_{t+1}$ 的分布是 $\\mathrm{Binomial}(N, i/N)$。\n\n定义固定概率 $\\phi(i;N)$ 为从 $X_0=i$ 开始，变体 $A$ 最终达到频率 $1$ (即，$X_t$ 达到吸收态 $N$) 的概率。等价地，定义 $\\phi(x_0;N)$，其中 $x_0=i/N$。\n\n仅使用上述基本定义，推导固定概率 $\\phi(x_0;N)$ 作为初始频率 $x_0 \\in [0,1]$ 和群体大小 $N$ 的函数的闭式表达式。将最终答案表示为单个解析表达式。无需四舍五入，也不涉及单位。", "solution": "问题要求在赖特-费舍尔 (Wright–Fisher) 模型下演化的一个大小为 $N$ 的有限群体中，一个中性文化变体的固定概率。令 $X_t$ 为第 $t$ 代携带变体 $A$ 的个体数量，令 $x_t = X_t/N$ 为该变体的频率。该过程从初始数量 $X_0=i$ 开始，对应初始频率 $x_0 = i/N$。我们的任务是找到变体 $A$ 最终被固定的概率，即其频率达到 1 的概率。这个概率记为 $\\phi(x_0;N)$。\n\n该过程的状态空间是 $\\{0, 1, \\dots, N\\}$。状态 $0$ 和 $N$ 是吸收态，分别对应变体 $A$ 的丢失和固定。该过程根据转移规则演化，即在给定 $X_t=k$ 的条件下，下一代中 $A$ 变体携带者的数量 $X_{t+1}$ 服从二项分布：\n$$ X_{t+1} | (X_t = k) \\sim \\mathrm{Binomial}(N, k/N) $$\n\n解决此问题的一个直接而严谨的方法是分析频率过程 $\\{x_t\\}_{t \\geq 0}$ 的性质。我们将证明，在指定的中性模型下，该变体的频率是一个鞅 (martingale)。如果 $\\mathbb{E}[Y_{t+1} | Y_t, Y_{t-1}, \\dots, Y_0] = Y_t$，则过程 $\\{Y_t\\}$ 是一个鞅。\n\n让我们计算给定时间 $t$ 的状态下 $x_{t+1}$ 的条件期望。假设在时间 $t$，状态为 $X_t = i$。频率为 $x_t = i/N$。时间 $t+1$ 时 $A$ 变体携带者的期望数量是一个 $\\mathrm{Binomial}(N, p=i/N)$ 随机变量的期望。二项分布 $\\mathrm{Binomial}(n,p)$ 的期望是 $np$。因此，\n$$ \\mathbb{E}[X_{t+1} | X_t = i] = N \\cdot \\left(\\frac{i}{N}\\right) = i $$\n现在我们可以求出时间 $t+1$ 的期望频率：\n$$ \\mathbb{E}[x_{t+1} | X_t = i] = \\mathbb{E}\\left[\\frac{X_{t+1}}{N} \\Big| X_t = i\\right] = \\frac{1}{N} \\mathbb{E}[X_{t+1} | X_t = i] = \\frac{i}{N} $$\n由于我们定义了 $x_t = i/N$，这表明 $\\mathbb{E}[x_{t+1} | x_t] = x_t$。这个等式证实了频率过程 $\\{x_t\\}$ 是一个鞅。\n\n当过程达到吸收边界之一，即 $x_t=0$ (丢失) 或 $x_t=1$ (固定) 时，过程停止。令 $T$ 为此过程的停止时间，定义为：\n$$ T = \\inf\\{t \\geq 0 : x_t = 0 \\text{ or } x_t = 1\\} $$\n对于一个有限群体 $N$，最终吸收到这些状态之一是必然的，意味着停止时间 $T$ 几乎必然是有限的。鞅 $\\{x_t\\}$ 是有界的，因为其值始终在区间 $[0,1]$ 内。\n\n这些条件——一个有界鞅和一个几乎必然有限的停止时间——允许我们应用可选停止定理 (Optional Stopping Theorem)。该定理指出，鞅在停止时间的期望值等于其初始值：\n$$ \\mathbb{E}[x_T] = x_0 $$\n过程在停止时间的值 $x_T$ 是一个随机变量，只能取两个值之一：如果变体 $A$ 固定，则为 $1$；如果丢失，则为 $0$。固定概率正是我们想要找到的 $\\phi(x_0;N)$。因此，\n$$ P(x_T = 1) = \\phi(x_0;N) $$\n丢失的概率是：\n$$ P(x_T = 0) = 1 - \\phi(x_0;N) $$\n期望 $\\mathbb{E}[x_T]$ 可以根据其定义计算：\n$$ \\mathbb{E}[x_T] = (1) \\cdot P(x_T = 1) + (0) \\cdot P(x_T = 0) = 1 \\cdot \\phi(x_0;N) + 0 \\cdot (1 - \\phi(x_0;N)) = \\phi(x_0;N) $$\n通过将 $\\mathbb{E}[x_T]$ 的两个表达式相等，我们得到最终结果：\n$$ \\phi(x_0;N) = x_0 $$\n这个结果展示了群体遗传学的一个基本原理：在没有选择、突变或迁移的情况下，一个中性等位基因或文化变体最终在群体中被固定的概率等于其初始频率。该结果与群体大小 $N$ 无关。给定初始频率 $x_0 = i/N$，固定概率就是 $i/N$。", "answer": "$$\\boxed{x_{0}}$$", "id": "2699390"}, {"introduction": "虽然文化漂变本身会导致多样性的丧失，但现实世界中的文化多样性往往通过创新（或突变）得以维持。这项练习将探讨漂变与创新这两种力量之间的平衡。你将使用扩散近似（diffusion approximation）方法，为存在$k$个文化变体的Wright-Fisher模型推导其稳态频率分布[@problem_id:2699366]。这个结果，即著名的狄利克雷分布（Dirichlet distribution），揭示了在复制和创新过程的长期作用下，群体中文化多样性的宏观统计模式是如何形成的。", "problem": "考虑一个大的、充分混合的、大小恒定为$N$的单倍体文化群体，在Wright–Fisher抽样方案下以离散、不重叠的世代进行演化。每个新个体从上一代中均匀随机选择一个榜样，并采用该榜样的文化变体（无偏复制）。在每个世代，每个个体有$\\mu$的概率发生创新事件，该事件会用一个从$k$个可能变体的有限集合中均匀抽取的新变体覆盖所复制的变体；也就是说，创新是亲本无关的，并且对$k$个变体是对称的。\n\n令$\\mathbf{X}(t) = (X_{1}(t), \\dots, X_{k}(t))$表示在世代$t$时$k$个变体的频率向量，其中$\\sum_{i=1}^{k} X_{i}(t) = 1$。在$N \\to \\infty$和$\\mu \\to 0$且复合参数$\\theta \\equiv 2 N \\mu$保持不变的扩散极限下，$\\mathbf{X}(t)$可以很好地由一个在$(k-1)$维单纯形上的连续扩散过程来近似。在此近似下且没有选择的情况下，漂移和扩散系数是具有亲本无关突变的中性Wright–Fisher扩散的系数：\n- 分量$i$的漂移为$m_{i}(\\mathbf{x}) = \\mu \\left(\\frac{1}{k} - x_{i} \\right)$。\n- 扩散协方差为$V_{ij}(\\mathbf{x}) = \\frac{1}{N} \\left( x_{i} \\delta_{ij} - x_{i} x_{j} \\right)$，其中$\\delta_{ij}$是Kronecker delta。\n\n为该扩散过程推导在单纯形$\\{\\mathbf{x} \\in \\mathbb{R}^{k}_{\\ge 0}: \\sum_{i=1}^{k} x_{i} = 1\\}$上的稳态概率密度$p^{\\ast}(\\mathbf{x})$，先得到其未归一化的形式，然后进行归一化。将最终答案表示为关于$k$、$N$和$\\mu$的单一闭式解析表达式，该表达式在单纯形内部有效，并已归一化，使其积分为1。最终表达式必须用Γ函数完全简化。提供$p^{\\ast}(\\mathbf{x})$的表达式；无需进行数值计算。", "solution": "首先将对问题陈述进行严格的验证程序。\n\n步骤1：提取已知条件。\n- 群体：大的、充分混合的、大小恒定为$N$的单倍体文化群体。\n- 世代：离散、不重叠。\n- 抽样方案：Wright–Fisher。\n- 文化传播：从均匀随机选择的榜样进行无偏复制。\n- 创新：每个世代中，每个个体发生创新的概率为$\\mu$。复制的变体被一个从$k$个可能变体的集合中均匀抽取的新变体覆盖。创新是亲本无关且对称的。\n- 状态向量：$\\mathbf{X}(t) = (X_{1}(t), \\dots, X_{k}(t))$，$k$个变体的频率。$\\sum_{i=1}^{k} X_{i}(t) = 1$。\n- 扩散极限：$N \\to \\infty$，$\\mu \\to 0$，且$\\theta \\equiv 2 N \\mu$为常数。\n- 漂移系数：$m_{i}(\\mathbf{x}) = \\mu \\left(\\frac{1}{k} - x_{i} \\right)$。\n- 扩散协方差：$V_{ij}(\\mathbf{x}) = \\frac{1}{N} \\left( x_{i} \\delta_{ij} - x_{i} x_{j} \\right)$，其中$\\delta_{ij}$是Kronecker delta。\n- 目标：推导在单纯形$\\{\\mathbf{x} \\in \\mathbb{R}^{k}_{\\ge 0}: \\sum_{i=1}^{k} x_{i} = 1\\}$上的归一化稳态概率密度$p^{\\ast}(\\mathbf{x})$。\n\n步骤2：使用提取的已知条件进行验证。\n该问题具有科学依据。它描述了一个标准的带亲本无关突变的Wright–Fisher模型，这是理论群体遗传学的基石，并广泛应用于文化演化。漂移和扩散系数是在扩散极限下该过程的正确、公认的形式。该问题是适定的，因为它要求一个定义明确的遍历扩散过程的稳态分布，该过程存在唯一的已知解。该问题是客观的，使用了精确的数学语言，没有主观或模糊的术语。所有必要信息均已提供，且无内部矛盾。它没有违反任何有效性标准。\n\n步骤3：结论与行动。\n问题有效。将推导解答。\n\n该问题要求解由给定漂移向量$\\mathbf{m}(\\mathbf{x})$和扩散矩阵$\\mathbf{V}(\\mathbf{x})$描述的多元扩散过程的稳态概率分布$p^{\\ast}(\\mathbf{x})$。这是群体遗传学中的一个经典问题，最早由Sewall Wright解决。该过程是具有对称、亲本无关突变的$k$等位基因中性Wright–Fisher模型。\n\n稳态分布$p^{\\ast}(\\mathbf{x})$是Fokker-Planck（或前向Kolmogorov）方程的定常解。对于这类模型，已知其稳态分布是Dirichlet分布。中性$k$等位基因Wright-Fisher模型的稳态分布的一般形式由Wright公式给出：\n$$ p^{\\ast}(\\mathbf{x}) \\propto \\prod_{i=1}^{k} x_{i}^{2Nu_{i} - 1} $$\n其中$u_{i}$是向变体$i$的突变率。\n\n我们必须根据问题描述确定有效突变率$u_{i}$。创新过程起到了突变的作用。每个个体发生创新事件的概率为$\\mu$。当此事件发生时，会从$k$种可能性中均匀选择一个新的变体。因此，一次创新导致特定变体$i$的概率是$1/k$。任何给定谱系突变为变体$i$的总速率是创新率与选择变体$i$的概率的乘积，即：\n$$ u_{i} = \\mu \\cdot \\frac{1}{k} = \\frac{\\mu}{k} $$\n由于创新过程的对称性，这个速率对于所有变体$i=1, \\dots, k$都是相同的。\n\n现在我们将这个有效突变率代入Wright公式。指数变为：\n$$ 2Nu_{i} - 1 = 2N\\left(\\frac{\\mu}{k}\\right) - 1 = \\frac{2N\\mu}{k} - 1 $$\n问题定义了复合参数$\\theta = 2N\\mu$。我们可以将指数写为$\\frac{\\theta}{k} - 1$。由于这对所有$i$都相同，未归一化的稳态分布为：\n$$ p^{\\ast}(\\mathbf{x}) \\propto \\prod_{i=1}^{k} x_{i}^{\\frac{2N\\mu}{k} - 1} $$\n该表达式定义了一个对称Dirichlet分布，其参数对所有$i=1, \\dots, k$均为$\\alpha_{i} = \\frac{2N\\mu}{k}$。\n\n为了完成解答，我们必须对该概率密度函数进行归一化。对于参数为$(\\alpha_1, \\dots, \\alpha_k)$的Dirichlet分布，其归一化常数$C$由多元Beta函数给出：\n$$ C = \\frac{\\Gamma\\left(\\sum_{i=1}^{k} \\alpha_{i}\\right)}{\\prod_{i=1}^{k} \\Gamma(\\alpha_{i})} $$\n在我们的例子中，所有的$\\alpha_{i}$都等于$\\alpha = \\frac{2N\\mu}{k}$。\n参数之和为：\n$$ \\sum_{i=1}^{k} \\alpha_{i} = \\sum_{i=1}^{k} \\frac{2N\\mu}{k} = k \\cdot \\frac{2N\\mu}{k} = 2N\\mu $$\n参数的Γ函数之积为：\n$$ \\prod_{i=1}^{k} \\Gamma(\\alpha_{i}) = \\prod_{i=1}^{k} \\Gamma\\left(\\frac{2N\\mu}{k}\\right) = \\left[\\Gamma\\left(\\frac{2N\\mu}{k}\\right)\\right]^k $$\n因此，归一化常数为：\n$$ C = \\frac{\\Gamma(2N\\mu)}{\\left[\\Gamma\\left(\\frac{2N\\mu}{k}\\right)\\right]^k} $$\n将归一化常数与未归一化的密度相结合，我们得到在单纯形上的稳态概率密度$p^{\\ast}(\\mathbf{x})$的最终表达式：\n$$ p^{\\ast}(\\mathbf{x}) = \\frac{\\Gamma(2N\\mu)}{\\left[\\Gamma\\left(\\frac{2N\\mu}{k}\\right)\\right]^k} \\prod_{i=1}^{k} x_{i}^{\\frac{2N\\mu}{k} - 1} $$\n该表达式在单纯形内部（即对所有$i$有$x_i  0$）有效，并已正确归一化，使其在单纯形上的积分为1。", "answer": "$$\\boxed{\\frac{\\Gamma(2N\\mu)}{\\left[\\Gamma\\left(\\frac{2N\\mu}{k}\\right)\\right]^k} \\prod_{i=1}^{k} x_{i}^{\\frac{2N\\mu}{k} - 1}}$$", "id": "2699366"}, {"introduction": "理论模型为我们提供了关于文化演化动力学的深刻见解，但我们如何从真实的观测数据中量化不同的演化力量呢？这项练习将让你亲手实现一个强大的分析工具——普赖斯方程（Price equation），来分解世代间文化性状均值的变化[@problem_id:2699362]。你将编写代码，把观察到的总体变化精确地划分为“文化选择”（由个体影响力差异导致）和“传递偏误”（由学习过程中的系统性改变导致）两个部分。这个实践将理论与数据分析紧密结合，让你掌握从原始数据中识别和量化文化演化驱动力的核心技能。", "problem": "给定一个群体在一个代际步骤中的个体层面文化数据，该群体包含一组文化榜样（父代）和一组学习者。每个学习者选择一个榜样进行学习，并获得一个可能被修改的特质值。你的任务是计算群体层面文化变迁的两个分量，这两个分量将平均特质值的变化分解为一个可归因于文化选择（榜样的差异化影响）的分量和一个可归因于传递偏差（学习过程中系统性的谱系内变化）的分量。\n\n基本原理和定义：\n- 设有 $N$ 个榜样，索引为 $i \\in \\{1,\\dots,N\\}$，每个榜样的特质值为 $z_i \\in \\mathbb{R}$。设平均榜样特质为 $\\bar{z} = \\frac{1}{N} \\sum_{i=1}^N z_i$。\n- 设有 $M$ 个学习者，索引为 $j \\in \\{1,\\dots,M\\}$。每个学习者 $j$ 精确选择一个榜样 $m(j) \\in \\{1,\\dots,N\\}$，并在学习后获得特质 $z'_j \\in \\mathbb{R}$。\n- 榜样 $i$ 的文化影响力（学习者数量）是 $w_i = \\left| \\{ j : m(j) = i \\} \\right|$。平均影响力为 $\\bar{w} = \\frac{1}{N} \\sum_{i=1}^N w_i$。注意 $\\sum_{i=1}^N w_i = M$ 意味着 $\\bar{w} = M / N$。\n- 定义每个榜样的学习者平均值 $\\mu_i$ 如下：如果 $w_i  0$，则 $\\mu_i = \\frac{1}{w_i} \\sum_{j : m(j) = i} z'_j$；如果 $w_i = 0$，则采用约定 $\\mu_i = z_i$，这样 $\\mu_i - z_i = 0$ 对传递偏差没有贡献。\n\n你的程序必须为每个提供的数据集计算：\n1. 文化选择协方差项 $S$，定义为相对影响力与榜样特质之间的协方差，\n$$\nS \\equiv \\operatorname{Cov}\\!\\left(\\frac{w_i}{\\bar{w}}, z_i\\right) \\;=\\; \\frac{1}{N}\\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}} - 1\\right)\\left(z_i - \\bar{z}\\right).\n$$\n2. 传递偏差项 $T$，定义为由相对影响力加权的谱系内预期变化，\n$$\nT \\equiv \\frac{1}{N}\\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right)\\left(\\mu_i - z_i\\right).\n$$\n3. 跨代际步骤的平均特质总变化，\n$$\n\\Delta \\bar{z} \\equiv \\left(\\frac{1}{M}\\sum_{j=1}^M z'_j\\right) - \\bar{z}.\n$$\n4. 一个解释代码，指示哪个分量的幅度更大。设 $\\varepsilon = 10^{-9}$。定义\n$$\nd \\equiv \\left|S\\right| - \\left|T\\right|.\n$$\n为每个数据集返回一个整数代码，如下所示：如果 $d  \\varepsilon$，返回 $1$（选择的幅度超过传递）；如果 $d  -\\varepsilon$，返回 $-1$（传递的幅度超过选择）；否则返回 $0$（幅度在容差范围内相当）。\n\n每个数据集的输入规范：\n- $N$ 和榜样特质向量 $\\mathbf{z} = [z_1,\\dots,z_N]$。\n- 学习者到榜样的索引向量 $\\mathbf{m} = [m(1),\\dots,m(M)]$，其索引从零开始，属于 $\\{0,\\dots,N-1\\}$。\n- 学习后学习者的特质向量 $\\mathbf{z}' = [z'_1,\\dots,z'_M]$。\n所有量均为无量纲实数。\n\n测试套件：\n为以下四个数据集提供结果。$\\mathbf{m}$ 中的索引是从零开始的。\n\n- 数据集 A：\n  - $N = 4$。\n  - $\\mathbf{z} = [0.0, 1.0, 2.0, 3.0]$。\n  - $\\mathbf{m} = [0, 1, 1, 2, 2, 3, 3, 3, 3, 3]$。\n  - $\\mathbf{z}' = [0.2, 1.0, 1.0, 1.9, 1.9, 2.8, 2.8, 2.8, 2.9, 2.9]$。\n\n- 数据集 B：\n  - $N = 3$。\n  - $\\mathbf{z} = [1.0, 2.0, 3.0]$。\n  - $\\mathbf{m} = [0, 0, 1, 1, 2, 2]$。\n  - $\\mathbf{z}' = [1.3, 1.3, 2.0, 2.0, 2.8, 2.8]$。\n\n- 数据集 C：\n  - $N = 3$。\n  - $\\mathbf{z} = [0.0, 1.0, 3.0]$。\n  - $\\mathbf{m} = [0, 1, 1, 2, 2, 2]$。\n  - $\\mathbf{z}' = [0.0, 1.0, 1.0, 3.0, 3.0, 3.0]$。\n\n- 数据集 D：\n  - $N = 4$。\n  - $\\mathbf{z} = [1.0, 2.0, 3.0, 4.0]$。\n  - $\\mathbf{m} = [1, 2, 3, 3]$。\n  - $\\mathbf{z}' = [1.9, 3.2, 3.7, 3.9]$。\n\n输出规范：\n- 对于每个数据集，输出一个形式为 $[S, T, \\Delta\\bar{z}, \\text{code}]$ 的列表，其中 $S$、$T$ 和 $\\Delta\\bar{z}$ 是四舍五入到六位小数的浮点数，而 $\\text{code}$ 是如上定义的整数。\n- 你的程序应生成单行输出，其中包含所有数据集的结果，形式为用方括号括起来的、由逗号分隔的列表所组成的列表。例如，输出格式必须是\n$[[S_A,T_A,\\Delta\\bar{z}_A,\\text{code}_A],[S_B,T_B,\\Delta\\bar{z}_B,\\text{code}_B],[S_C,T_C,\\Delta\\bar{z}_C,\\text{code}_C],[S_D,T_D,\\Delta\\bar{z}_D,\\text{code}_D]]$\n并应用了所需的四舍五入。", "solution": "所陈述的问题已经过严格验证。它被认为是一个有效、适定且有科学依据的练习。所要求的定义和计算是 Price 方程框架的直接应用，该框架是演化分析的基石，并被应用于文化演化的研究。所有术语都经过了精确的数学定义，所提供的数据是自包含的，目标是明确的。不存在逻辑矛盾或事实错误。我们将着手推导解决方案。\n\n核心任务是将群体平均特质值的总变化 $\\Delta\\bar{z}$ 分解为两个分量：一个选择分量 $S$ 和一个传递偏差分量 $T$。问题为这三个量提供了定义。一个基本的一致性检验是证明总变化实际上是这两个分量之和，即 $\\Delta\\bar{z} = S + T$。这个恒等式构成了我们分析的基础。\n\n我们从给出的定义开始。$N$ 个榜样的平均特质是 $\\bar{z} = \\frac{1}{N} \\sum_{i=1}^N z_i$。下一代 $M$ 个学习者的平均特质是 $\\bar{z}' = \\frac{1}{M}\\sum_{j=1}^M z'_j$。总变化是 $\\Delta\\bar{z} = \\bar{z}' - \\bar{z}$。\n\n我们可以通过根据学习者选择的榜样 $m(j)$ 对他们进行分组来表达 $\\bar{z}'$。选择榜样 $i$ 的学习者数量是其影响力 $w_i$。选择榜样 $i$ 的学习者的特质值之和是 $\\sum_{j : m(j) = i} z'_j$。根据定义，对于 $w_i  0$ 的情况，每个榜样的学习者平均值是 $\\mu_i = \\frac{1}{w_i} \\sum_{j : m(j) = i} z'_j$。因此，$\\sum_{j : m(j) = i} z'_j = w_i \\mu_i$。这个关系即使在 $w_i=0$ 时也成立，因为两边都为零。学习者特质的总和是 $\\sum_{j=1}^M z'_j = \\sum_{i=1}^N \\sum_{j : m(j) = i} z'_j = \\sum_{i=1}^N w_i \\mu_i$。\n\n将此代入 $\\bar{z}'$ 的表达式中：\n$$\n\\bar{z}' = \\frac{1}{M} \\sum_{i=1}^N w_i \\mu_i\n$$\n平均影响力是 $\\bar{w} = \\sum_{i=1}^N w_i / N = M/N$。因此，$M = N\\bar{w}$。将此代入 $M$：\n$$\n\\bar{z}' = \\frac{1}{N\\bar{w}} \\sum_{i=1}^N w_i \\mu_i = \\frac{1}{N} \\sum_{i=1}^N \\frac{w_i}{\\bar{w}} \\mu_i\n$$\n现在，我们可以将总变化 $\\Delta\\bar{z}$ 写为：\n$$\n\\Delta\\bar{z} = \\bar{z}' - \\bar{z} = \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) \\mu_i - \\bar{z}\n$$\n为了分解这个变化，我们通过加上并减去项 $\\frac{1}{N} \\sum_{i=1}^N (\\frac{w_i}{\\bar{w}}) z_i$ 来引入它：\n$$\n\\Delta\\bar{z} = \\left( \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) \\mu_i - \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) z_i \\right) + \\left( \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) z_i - \\bar{z} \\right)\n$$\n我们来分析这两个括号中的项。第一项可以写成：\n$$\n\\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) (\\mu_i - z_i)\n$$\n这正是传递偏差项 $T$ 的定义。它表示从榜样到学习者的特质值平均变化，由每个榜样的相对影响力加权。当 $w_i = 0$ 时，约定 $\\mu_i = z_i$ 确保了没有学习者的榜样对该项没有贡献。\n\n第二项可以被识别为相对影响力 $\\frac{w_i}{\\bar{w}}$ 与榜样特质 $z_i$ 之间的协方差。变量 $X_i$ 在榜样群体上的期望是 $E[X] = \\frac{1}{N}\\sum_{i=1}^N X_i$。协方差是 $\\operatorname{Cov}(X, Y) = E[(X-E[X])(Y-E[Y])]$。\n设 $X_i = \\frac{w_i}{\\bar{w}}$ 且 $Y_i = z_i$。那么 $E[Y] = \\bar{z}$。$X_i$ 的期望是 $E[X] = \\frac{1}{N}\\sum_{i=1}^N \\frac{w_i}{\\bar{w}} = \\frac{1}{N\\bar{w}}\\sum_{i=1}^N w_i = \\frac{M}{N(M/N)} = 1$。\n第二项是 $E[XY] - \\bar{z} = E[XY] - E[X]E[Y]$，也就是 $\\operatorname{Cov}(X,Y)$。展开此式得到：\n$$\n\\operatorname{Cov}\\left(\\frac{w_i}{\\bar{w}}, z_i\\right) = \\frac{1}{N}\\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}} - 1\\right) (z_i - \\bar{z})\n$$\n这正是文化选择项 $S$ 的定义。它衡量了榜样的特质值与其文化影响力之间的统计关联。\n\n因此，我们证明了恒等式 $\\Delta\\bar{z} = S + T$。总变化被完美地分解了。计算过程如下：\n\n对于每个数据集（$N$, $\\mathbf{z}$, $\\mathbf{m}$, $\\mathbf{z}'$）：\n1.  计算平均榜样特质 $\\bar{z} = \\frac{1}{N}\\sum z_i$。\n2.  根据 $\\mathbf{m}$ 的长度确定学习者数量 $M$。\n3.  计算影响力向量 $\\mathbf{w}$，其中 $w_i$ 是 $\\mathbf{m}$ 中榜样索引 $i$ 的计数。$\\mathbf{m}$ 中的索引是从零开始的，属于 $\\{0, \\dots, N-1\\}$。\n4.  计算平均影响力 $\\bar{w} = M/N$。\n5.  确定每个榜样的学习者平均值向量 $\\boldsymbol{\\mu}$。对于每个榜样 $i$，如果 $w_i  0$，$\\mu_i$ 是所有选择榜样 $i$ 的学习者 $j$ 的 $z'_j$ 的平均值。如果 $w_i = 0$，则将 $\\mu_i$ 设为 $z_i$。\n6.  计算选择项 $S = \\frac{1}{N}\\sum_{i=0}^{N-1} (\\frac{w_i}{\\bar{w}} - 1)(z_i - \\bar{z})$。\n7.  计算传递偏差项 $T = \\frac{1}{N}\\sum_{i=0}^{N-1} (\\frac{w_i}{\\bar{w}})(\\mu_i - z_i)$。\n8.  计算总变化 $\\Delta\\bar{z} = (\\frac{1}{M}\\sum z'_j) - \\bar{z}$。作为验证，必须确认 $S + T$ 近似等于 $\\Delta\\bar{z}$。\n9.  计算幅度差异 $d = |S| - |T|$ 并根据给定的容差 $\\varepsilon = 10^{-9}$ 确定解释代码。如果 $d  \\varepsilon$，代码为 $1$；如果 $d  -\\varepsilon$，代码为 $-1$；否则，代码为 $0$。\n10. 将结果格式化为一个列表 $[S, T, \\Delta\\bar{z}, \\text{code}]$，其中浮点数四舍五入到六位小数。\n\n此算法将被实现以处理所提供的测试套件。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the cultural evolution problem for all given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Dataset A\n        {\n            \"N\": 4,\n            \"z_models\": [0.0, 1.0, 2.0, 3.0],\n            \"m_learners\": [0, 1, 1, 2, 2, 3, 3, 3, 3, 3],\n            \"z_prime_learners\": [0.2, 1.0, 1.0, 1.9, 1.9, 2.8, 2.8, 2.8, 2.9, 2.9],\n        },\n        # Dataset B\n        {\n            \"N\": 3,\n            \"z_models\": [1.0, 2.0, 3.0],\n            \"m_learners\": [0, 0, 1, 1, 2, 2],\n            \"z_prime_learners\": [1.3, 1.3, 2.0, 2.0, 2.8, 2.8],\n        },\n        # Dataset C\n        {\n            \"N\": 3,\n            \"z_models\": [0.0, 1.0, 3.0],\n            \"m_learners\": [0, 1, 1, 2, 2, 2],\n            \"z_prime_learners\": [0.0, 1.0, 1.0, 3.0, 3.0, 3.0],\n        },\n        # Dataset D\n        {\n            \"N\": 4,\n            \"z_models\": [1.0, 2.0, 3.0, 4.0],\n            \"m_learners\": [1, 2, 3, 3],\n            \"z_prime_learners\": [1.9, 3.2, 3.7, 3.9],\n        },\n    ]\n\n    results_str_list = []\n    for case in test_cases:\n        s, t, delta_z, code = calculate_components(\n            case[\"N\"],\n            case[\"z_models\"],\n            case[\"m_learners\"],\n            case[\"z_prime_learners\"]\n        )\n        \n        # Format the output for the current case\n        s_str = f\"{s:.6f}\"\n        t_str = f\"{t:.6f}\"\n        delta_z_str = f\"{delta_z:.6f}\"\n        \n        result_str = f\"[{s_str},{t_str},{delta_z_str},{code}]\"\n        results_str_list.append(result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str_list)}]\")\n\ndef calculate_components(N_models, z_models_list, m_learners_list, z_prime_learners_list):\n    \"\"\"\n    Computes S, T, delta_z, and the interpretation code for a single dataset.\n    \"\"\"\n    \n    # Convert lists to numpy arrays for vectorized operations\n    z_models = np.array(z_models_list, dtype=float)\n    m_learners = np.array(m_learners_list, dtype=int)\n    z_prime_learners = np.array(z_prime_learners_list, dtype=float)\n    \n    # Number of learners\n    M_learners = len(m_learners)\n\n    # 1. Compute model-level quantities\n    z_bar = np.mean(z_models)\n\n    # 2. Compute learner-level and linking quantities\n    # Influence of each model (number of learners choosing each model)\n    w = np.bincount(m_learners, minlength=N_models)\n    \n    # Mean influence\n    if N_models > 0:\n        w_bar = M_learners / N_models\n    else:\n        w_bar = 0\n\n    # 3. Calculate per-model learner mean mu\n    mu = np.zeros(N_models, dtype=float)\n    for i in range(N_models):\n        if w[i] > 0:\n            learners_of_model_i = z_prime_learners[m_learners == i]\n            mu[i] = np.mean(learners_of_model_i)\n        else:\n            # Convention: if w_i = 0, mu_i = z_i\n            mu[i] = z_models[i]\n\n    # Handle case where all models have zero influence\n    if w_bar == 0:\n        rel_w = np.zeros(N_models, dtype=float)\n    else:\n        rel_w = w / w_bar\n\n    # 4. Calculate S (Selection)\n    # S = (1/N) * sum((w_i/w_bar - 1) * (z_i - z_bar))\n    s_term_per_model = (rel_w - 1) * (z_models - z_bar)\n    S = np.mean(s_term_per_model)\n\n    # 5. Calculate T (Transmission)\n    # T = (1/N) * sum((w_i/w_bar) * (mu_i - z_i))\n    t_term_per_model = rel_w * (mu - z_models)\n    T = np.mean(t_term_per_model)\n\n    # 6. Calculate Delta z_bar (Total Change)\n    if M_learners > 0:\n        z_prime_bar = np.mean(z_prime_learners)\n    else:\n        z_prime_bar = z_bar # No learners, no change\n    delta_z_bar = z_prime_bar - z_bar\n\n    # 7. Calculate the interpretation code\n    epsilon = 1e-9\n    d = abs(S) - abs(T)\n    if d > epsilon:\n        code = 1\n    elif d  -epsilon:\n        code = -1\n    else:\n        code = 0\n        \n    return S, T, delta_z_bar, code\n\n# Execute the main function\nsolve()\n```", "id": "2699362"}]}