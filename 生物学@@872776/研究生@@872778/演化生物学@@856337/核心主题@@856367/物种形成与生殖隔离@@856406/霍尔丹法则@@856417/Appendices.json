{"hands_on_practices": [{"introduction": "霍尔丹法则通常被理解为一个普适性的规律，但杂交后代的功能障碍并非总是在所有条件下都表现出来。这个练习将探讨一个更为微妙的场景，其中杂交不亲和性是环境依赖的。通过分析这个案例[@problem_id:1935970]，你将学会认识到霍尔丹法则的核心在于异配性别（heterogametic sex）表现出不成比例的脆弱性，即便这种脆弱性仅在特定胁迫下才显现，这有助于加深对基因型与环境相互作用 ($G \\times E$) 在物种形成中作用的理解。", "problem": "霍尔丹法则（Haldane's rule）是演化生物学中的一个观察结果，它指出如果在一个物种的杂交后代中只有一个性别是不存活或不育的，那么这个性别更有可能是异配性别（即拥有两种不同性染色体的性别，例如哺乳动物和许多昆虫中的XY型）。\n\n考虑两种亲缘关系很近的河流鱼类，它们采用XY性别决定系统，其中雄性是异配性别（XY），雌性是同配性别（XX）。在实验室环境中，科学家通过将物种A的雄性与物种B的雌性杂交，成功地培育出了F1代杂交后代。\n\n产生的杂交后代表现出一种特殊的生存能力模式。在充气良好、高氧的水中饲养时，雄性和雌性杂交后代都能完全存活并且看起来很健康。然而，当水中的溶解氧水平降低以模拟其自然栖息地静止水池中的压力条件时，所有的杂交雄性在达到成熟期前都会死亡。而杂交雌性在同样低的氧气条件下，死亡率没有增加，仍然完全存活。\n\n根据这个情景，以下哪个陈述提供了最准确的评估？\n\nA. 是的，这是霍尔丹法则的一个例子，因为负面的适应性效应（不存活）只在异配性别中表现出来，尽管它受环境条件限制。\n\nB. 不，这不是霍尔丹法则的一个例子，因为该法则要求杂交后代的不存活或不育是绝对的，不依赖于环境因素。\n\nC. 不，这不是霍尔丹法则的一个例子，因为不存活是由环境压力源（低氧）引起的，而不是由遗传不相容性引起的。\n\nD. 是的，这是霍尔丹法则的一个部分例子，但只有当雌性杂交后代在更极端的低氧条件下也变得不存活时，才算是一个完整的例子。\n\nE. 在没有首先确定这些鱼类中负责氧气代谢的具体基因的情况下，无法判断这是否是霍尔丹法则的一个例子。", "solution": "我们首先回顾一下霍尔丹法则：在种间杂交后代中，当只有一个性别遭受适应性降低（不育或不存活）时，这个性别通常是异配性别。在具有$XY$系统的分类群中，雄性是异配性别（$XY$），雌性是同配性别（$XX$）。该法则阐述了杂交功能障碍的模式，并且对于表型是否在不同环境中保持恒定并没有做出规定；许多有记载的案例显示，杂交不相容性的表达是依赖于环境或背景的。\n\n在这个情景中，物种A的雄性与物种B的雌性杂交产生了$F_{1}$代杂交后代。在高氧环境下，两种性别的杂交后代都能存活。在低氧环境下，杂交雄性（异配性别$XY$）在成熟前死亡（不存活），而杂交雌性（$XX$）仍然存活。因此，杂交后代的不存活性是性别特异性的，并且针对异配性别。\n\n霍尔丹法则关注的是异配性别更有可能表现出杂交不育或不存活的模式。它不要求这种效应在所有环境中都是绝对的；有条件的或依赖于环境的表达仍然符合该法则，因为限于某一性别的杂交功能障碍模式才是相关的标准。从机制上讲，这与X染色体上的隐性或部分隐性不相容性在$XY$杂交后代中被揭示出来是一致的，并且可能被环境压力（一种基因型与环境的交互作用）所加剧。因此：\n- 陈述A是准确的：它认识到负面的适应性效应仅限于异配性别，并允许环境条件性。\n- 陈述B是不正确的：霍尔丹法则不要求不依赖环境的、绝对的不存活或不育。\n- 陈述C是不正确的：在压力下观察到的性别特异性杂交不存活现象，与遗传不相容性的效应被环境条件揭示或放大是一致的；对环境的依赖性并不能否定霍尔丹法则。\n- 陈述D是不正确的：霍尔丹法则不要求雌性在更极端的条件下也变得不存活；这将与该法则的核心预测相矛盾。\n- 陈述E是不正确的：要评估观察到的模式是否符合霍尔丹法则，并不需要鉴定出具体的基因。\n\n因此，最准确的评估是A。", "answer": "$$\\boxed{A}$$", "id": "1935970"}, {"introduction": "观察到一种模式后，下一步是理解其背后的机制。“显性理论”（dominance theory）是解释 Haldane 法则最有力的遗传学假说之一。这项练习[@problem_id:2721024]提供了一个通过数学推导来量化该理论核心预测的机会，你将亲自证明为何位于 X 染色体上的隐性不相容等位基因在异配性别中会完全表达，从而导致更严重的适合度下降。", "problem": "在经典的Dobzhansky–Muller不相容性（DMI）框架中，合子后隔离源于在不同谱系中固定的衍生等位基因之间的上位性相互作用。考虑一对谱系，它们在整个基因组中积累了许多衍生替换。设有一部分比例为 $\\alpha \\in [0,1]$ 的衍生替换位于 $X$ 染色体上，一部分比例为 $(1-\\alpha)$ 的位于常染色体上。假设：\n- 所有成对的DMI都是通过将一个谱系的一个衍生等位基因与另一个谱系的一个衍生等位基因配对而形成的，在所有位点上概率均等，并且当两个相互作用的衍生等位基因都完全表达时，每个DMI的效应大小相等。\n- 异配性别为 $XY$，我们评估的是母本来自谱系1、父本来自谱系2的杂交产生的 $F_{1}$ 代雄性中的功能障碍。\n- 在 $F_{1}$ 代中，常染色体上的衍生等位基因为杂合状态，其表达效应是其完全表达效应的一小部分 $h \\in [0,1]$（显性系数为 $h$），而 $F_{1}$ 代雄性中的 $X$ 连锁衍生等位基因为半合子状态，因此完全表达（有效显性等于 $1$）。假设 $X$–$X$ DMI在 $F_{1}$ 代雄性中不起作用，因为只有一个来自母本的 $X$ 染色体存在。\n- 设完全表达下每个DMI的效应大小归一化为 $1$，因此预期功能障碍与所有已实现的DMI的表达因子之和成正比。\n\n在这些假设下：\n- 一个随机DMI是常染色体–常染色体（$A\\!-\\!A$）的概率是 $(1-\\alpha)^{2}$，其在 $F_{1}$ 代雄性中的表达因子是 $h^{2}$。\n- 一个随机DMI是 $X\\!-\\!A$ 的概率是 $2\\alpha(1-\\alpha)$，其在 $F_{1}$ 代雄性中的表达因子是 $h$。\n- 一个随机DMI是 $X\\!-\\!X$ 的概率是 $\\alpha^{2}$，其在 $F_{1}$ 代雄性中的表达因子是 $0$。\n\n将隐性 $X$ 连锁DMI对 $F_{1}$ 代雄性功能障碍的预期分数贡献定义为，归因于 $X\\!-\\!A$ DMI的功能障碍占 $X\\!-\\!A$ 和 $A\\!-\\!A$ 两类DMI所致总功能障碍的比例。推导这个分数作为 $\\alpha$ 和 $h$ 的函数的闭式表达式。仅以 $\\alpha$ 和 $h$ 的形式提供一个简化的解析表达式作为最终答案。不需要数值计算，也不需要单位。", "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于已确立的Dobzhansky-Muller遗传不相容性模型，问题设定良好，提供了所有必要信息，并使用客观、明确的语言进行表述。该问题是演化遗传学中的一个标准理论练习，适合进行严谨的分析。\n\n目标是推导 $X$-常染色体（$X-A$）不相容性对 $F_{1}$ 代雄性总杂种功能障碍的分数贡献的表达式。\n\n设 $D$ 表示预期的功能障碍。根据题意，这与所有已实现的DMI的表达因子之和成正比。我们可以通过将各类DMI的概率乘以其相应的表达因子来表示其贡献。设 $D_{A-A}$、$D_{X-A}$ 和 $D_{X-X}$ 分别为来自常染色体-常染色体、$X$-常染色体和 $X-X$ DMI的预期功能障碍贡献。对于分数贡献而言，比例常数是无关紧要的，可以设为 $1$。\n\n一个 $A-A$ DMI的概率为 $(1-\\alpha)^{2}$，其在 $F_1$ 代雄性中的表达因子是 $h^2$。因此，这类DMI的预期功能障碍是：\n$$D_{A-A} = (1-\\alpha)^{2} h^{2}$$\n\n一个 $X-A$ DMI的概率是 $2\\alpha(1-\\alpha)$，其表达因子是 $h$，因为常染色体等位基因是杂合的，而 $X$ 连锁等位基因是半合子（完全表达）。预期的功能障碍是：\n$$D_{X-A} = 2\\alpha(1-\\alpha)h$$\n\n一个 $X-X$ DMI的概率是 $\\alpha^{2}$，但其在 $F_1$ 代雄性中的表达因子是 $0$，因为雄性只有一个来自母本谱系的 $X$ 染色体。因此：\n$$D_{X-X} = \\alpha^{2} \\cdot 0 = 0$$\n\n$F_1$ 代雄性中的总预期功能障碍 $D_{total}$ 是所有类别贡献的总和：\n$$D_{total} = D_{A-A} + D_{X-A} + D_{X-X}$$\n$$D_{total} = (1-\\alpha)^{2} h^{2} + 2\\alpha(1-\\alpha)h + 0$$\n$$D_{total} = (1-\\alpha)^{2} h^{2} + 2\\alpha(1-\\alpha)h$$\n\n问题将目标量（我们称之为 $F$）定义为归因于 $X-A$ DMI的功能障碍占 $X-A$ 和 $A-A$ 两类DMI所致总功能障碍的比例。这在数学上表示为 $X-A$ DMI引起的功能障碍与总功能障碍的比率。\n$$F = \\frac{D_{X-A}}{D_{total}} = \\frac{D_{X-A}}{D_{A-A} + D_{X-A}}$$\n\n代入 $D_{X-A}$ 和 $D_{total}$ 的表达式：\n$$F = \\frac{2\\alpha(1-\\alpha)h}{(1-\\alpha)^{2} h^{2} + 2\\alpha(1-\\alpha)h}$$\n\n为简化此表达式，我们可以从分子和分母中提出公因式 $h(1-\\alpha)$。这在生物学相关的参数空间 $\\alpha \\in [0, 1)$ 和 $h \\in (0, 1]$ 中是允许的。如果 $h=0$ 或 $\\alpha=1$，总功能障碍为零，分数为未定义的 $\\frac{0}{0}$。简化后的表达式将代表一般情况。\n$$F = \\frac{h(1-\\alpha)(2\\alpha)}{h(1-\\alpha)[(1-\\alpha)h + 2\\alpha]}$$\n\n消去公因式 $h(1-\\alpha)$ 得到最终的简化表达式：\n$$F = \\frac{2\\alpha}{(1-\\alpha)h + 2\\alpha}$$\n\n这就是 $X-A$ DMI对 $F_1$ 代雄性总功能障碍的分数贡献的闭式表达式，它是 $X$ 连锁替换的比例 $\\alpha$ 和常染色体位点显性系数 $h$ 的函数。", "answer": "$$\\boxed{\\frac{2\\alpha}{(1-\\alpha)h + 2\\alpha}}$$", "id": "2721024"}, {"introduction": "在当代进化生物学中，理论模型需要通过真实的基因组数据进行检验。这个计算练习[@problem_id:2720969]将带你进入物种形成基因组学的前沿，你将学习如何利用基因组溯祖信息，通过建立统计模型并使用最大似然估计（MLE）来量化不同性别中针对渐渗基因片段的选择压力。这不仅能让你以定量的方式检验 Haldane 法则，还能锻炼你在进化分析中必备的计算和统计建模技能。", "problem": "您将获得一个简化但有原则的模型，用于根据霍尔丹法则推断X染色体（表示为X）上渗入祖源的性别特异性选择。该推断基于全基因组祖源比例、性别标签以及在X连锁基因座上观测到的单倍体祖源状态。您必须使用的核心原理是群体遗传学中关于等位基因频率的标准确定性生存力选择模型。\n\n基本原理：\n- 设 $p$ 为一个个体中随机选择的单倍体X连锁等位基因来源于源群体 $\\mathsf{A}$ 的选择前概率。在中性条件下，$p$ 等于该个体的全基因组中来自群体 $\\mathsf{A}$ 的祖源比例 $q$。\n- 在生存力选择下，存活的单倍体等位基因中的选择后等位基因频率 $p^{\\prime}$ 由 $p^{\\prime} = \\dfrac{p \\, w_{\\mathsf{A}}}{p \\, w_{\\mathsf{A}} + (1 - p) \\, w_{\\mathsf{B}}}$ 给出，其中 $w_{\\mathsf{A}}$ 和 $w_{\\mathsf{B}}$ 分别是与来自群体 $\\mathsf{A}$ 和 $\\mathsf{B}$ 的等位基因相关的相对适应度值。这是基础群体遗传学中的典型选择加权归一化方法。假设 $w_{\\mathsf{B}} = 1$ 且 $w_{\\mathsf{A}} = 1 - s_{z}$，其中 $z \\in \\{0,1\\}$ 编码性别，$z = 0$ 代表雌性，$z = 1$ 代表雄性。\n- 因此，对于一个个体，其全基因组祖源为 $q$、性别为 $z$，其携带的一个经过选择的单倍体X连锁等位基因来自群体 $\\mathsf{A}$ 的概率为\n$$\n\\pi(q,z;s_f,s_m) \\equiv \\frac{q \\, (1 - s_z)}{q \\, (1 - s_z) + (1 - q)},\n$$\n其中 $s_0 = s_f$ 和 $s_1 = s_m$ 是未知的、针对来自群体 $\\mathsf{A}$ 的渗入性X连锁祖源的性别特异性选择系数。\n\n统计模型：\n- 对于每个单倍体X连锁观测值 $j$，您将获得个体的全基因组祖源比例 $q_j \\in [0,1]$、性别 $z_j \\in \\{0,1\\}$，以及一个X连锁基因座的二元单倍体祖源指示符 $y_j \\in \\{0,1\\}$，其中 $y_j = 1$ 表示祖源来自群体 $\\mathsf{A}$，$y_j = 0$ 表示祖源来自群体 $\\mathsf{B}$。\n- 假设独立的伯努利抽样，成功概率为 $\\pi(q_j,z_j;s_f,s_m)$。需要最大化的对数似然函数是\n$$\n\\ell(s_f,s_m) = \\sum_{j=1}^{n} \\left[ y_j \\, \\log \\pi(q_j,z_j;s_f,s_m) + (1 - y_j) \\, \\log \\left(1 - \\pi(q_j,z_j;s_f,s_m)\\right) \\right].\n$$\n- 参数必须满足 $0 \\le s_f  1$ 和 $0 \\le s_m  1$。\n\n任务：\n- 通过在上述边界条件下最大化 $\\ell(s_f,s_m)$ 来实现最大似然估计（MLE），以获得估计值 $\\hat{s}_f$ 和 $\\hat{s}_m$。请使用带边界约束的数值优化器。\n- 判断估计值是否与雄性异配性的霍尔丹法则一致（雄性是异配性别），该法则预测雄性中针对渗入的X祖源的选择比雌性更强。定义决策阈值 $\\tau = 0.05$，当且仅当 $\\hat{s}_m - \\hat{s}_f  \\tau$ 时，宣布数据与霍尔丹法则一致。\n\n数值和输出要求：\n- 报告 $\\hat{s}_m$ 和 $\\hat{s}_f$ 的值，四舍五入至三位小数。不涉及物理单位。\n- 对于每个测试用例，返回一个包含三个元素的列表：四舍五入后的 $\\hat{s}_m$（浮点数）、四舍五入后的 $\\hat{s}_f$（浮点数）以及根据上述规定得出的霍尔丹决策布尔值。\n- 您的程序应生成单行输出，其中包含由三个逐案例列表组成的逗号分隔列表，并用方括号括起来（例如，\"[[sm1,sf1,flag1],[sm2,sf2,flag2],[sm3,sf3,flag3]]\"）。不应打印任何其他文本。\n- 您的程序不得读取任何输入；必须使用下面嵌入的测试套件。\n\n测试套件：\n- 在所有案例中，性别编码为 $z = 0$（雌性）和 $z = 1$（雄性）。列表按索引对齐，因此三个列表中第 $j$ 个条目对应于同一个观测值。\n\n案例1（雄性中X染色体渗入减少；霍尔丹法则的代表性情况）：\n- $q$ 列表: $[0.3,\\, 0.3,\\, 0.4,\\, 0.4,\\, 0.5,\\, 0.5,\\, 0.6,\\, 0.6,\\, 0.7,\\, 0.7,\\, 0.8,\\, 0.8,\\, 0.9,\\, 0.9]$\n- $z$ 列表: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ 列表: $[0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\n案例2（无性别差异；近中性行为）：\n- $q$ 列表: $[0.2,\\, 0.2,\\, 0.4,\\, 0.4,\\, 0.5,\\, 0.5,\\, 0.6,\\, 0.6,\\, 0.8,\\, 0.8]$\n- $z$ 列表: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ 列表: $[0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\n案例3（类边界行为；强的雄性特异性选择）：\n- $q$ 列表: $[0.1,\\, 0.1,\\, 0.49,\\, 0.49,\\, 0.51,\\, 0.51,\\, 0.9,\\, 0.9,\\, 0.96,\\, 0.96,\\, 0.98,\\, 0.98]$\n- $z$ 列表: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ 列表: $[0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\n定义和决策规则：\n- 令 $\\widehat{s}_m$ 和 $\\widehat{s}_f$ 分别表示雄性和雌性的最大似然估计；定义 $\\tau = 0.05$。如果 $\\widehat{s}_m - \\widehat{s}_f  \\tau$，则宣布“与霍尔丹法则一致”；否则，宣布“不一致”。\n- 在最终输出中将 $\\widehat{s}_m$ 和 $\\widehat{s}_f$ 四舍五入至三位小数。\n\n您的程序必须实现最大似然估计，将其应用于所有三个案例，并打印指定聚合输出格式的单行内容。", "solution": "问题陈述已经过验证。\n\n### 步骤1：提取已知信息\n- **选择后概率模型 ($\\pi$)**：对于一个全基因组祖源为 $q$、性别为 $z$ 的个体，其携带的一个采样单倍体X连锁等位基因来自群体 $\\mathsf{A}$ 的概率为：\n$$\n\\pi(q,z;s_f,s_m) = \\frac{q \\, (1 - s_z)}{q \\, (1 - s_z) + (1 - q)}\n$$\n- **性别特异性选择系数 ($s_z$)**：$s_z$ 是针对来自群体 $\\mathsf{A}$ 的渗入祖源的选择系数。它取决于性别 $z$，其中 $z=0$ 为雌性，$z=1$ 为雄性。因此，$s_0 = s_f$ 和 $s_1 = s_m$。\n- **参数约束**：$0 \\le s_f  1$ 和 $0 \\le s_m  1$。\n- **数据**：对于每个观测值 $j=1, \\dots, n$，数据由一个三元组 $(q_j, z_j, y_j)$ 组成，其中 $q_j \\in [0,1]$ 是全基因组祖源比例，$z_j \\in \\{0,1\\}$ 是性别，$y_j \\in \\{0,1\\}$ 是X连锁基因座的观测单倍体祖源指示符（$y_j=1$ 表示祖源 $\\mathsf{A}$，$y_j=0$ 表示祖源 $\\mathsf{B}$）。\n- **统计模型**：观测值 $y_j$ 被假定为独立的伯努利试验，成功概率为 $\\pi_j = \\pi(q_j,z_j;s_f,s_m)$。\n- **目标函数**：需要最大化的对数似然函数为：\n$$\n\\ell(s_f,s_m) = \\sum_{j=1}^{n} \\left[ y_j \\, \\log \\pi(q_j,z_j;s_f,s_m) + (1 - y_j) \\, \\log \\left(1 - \\pi(q_j,z_j;s_f,s_m)\\right) \\right]\n$$\n- **任务**：执行最大似然估计（MLE）以找到 $\\hat{s}_f$ 和 $\\hat{s}_m$。\n- **霍尔丹法则决策**：给定阈值 $\\tau = 0.05$。当且仅当 $\\hat{s}_m - \\hat{s}_f  \\tau$ 时，数据被宣布为与霍尔丹法则一致。\n- **测试套件**：提供了三个特定的数据集（案例1、案例2、案例3）。\n- **输出格式**：对于每个案例，生成一个列表 `[rounded_sm, rounded_sf, boolean_decision]`。最终输出是包含这些列表的单行列表。\n\n### 步骤2：使用提取的已知信息进行验证\n根据验证标准对问题进行评估。\n\n- **科学依据**：该问题基于群体遗传学中的标准确定性生存力选择模型。使用伯努利似然进行二元性状分析的统计框架是统计推断的基石。霍尔丹法则是演化生物学中一个公认的经验模式。该模型提供了一种简化但有原则的方法来检验与此法则相关的假设。该问题在科学上是合理的。\n- **适定性**：任务是在边界约束下找到对数似然函数的最大值。这是一个标准且定义明确的数值优化问题。伯努利分布的对数似然函数在其概率的logit变换上是凹的，这确保了参数通常存在唯一的最大值。该问题是适定的。\n- **客观性**：所有术语都经过数学上的精确定义。数据是定量的，决策规则基于清晰、客观的数值阈值。问题没有主观或含糊不清的语言。\n\n问题陈述未表现出任何已定义的缺陷（例如，科学上不合理、不完整、矛盾或模糊）。这是一个形式化、自洽且可解的计算统计学和生物学问题。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整的解决方案。\n\n### 解决方案推导\n目标是通过最大化对数似然函数 $\\ell(s_f, s_m)$ 来找到 $s_f$ 和 $s_m$ 的最大似然估计（MLE）。标准的数值优化器旨在最小化一个函数，因此我们将等价地最小化负对数似然函数 $L(s_f, s_m) = -\\ell(s_f, s_m)$。\n\n一个关键的观察是，对数似然函数关于参数 $s_f$ 和 $s_m$ 是可分的。概率 $\\pi(q, z; s_f, s_m)$ 在 $z=0$（雌性）时仅依赖于 $s_f$，在 $z=1$（雄性）时仅依赖于 $s_m$。\n令 $J_f = \\{j \\mid z_j = 0\\}$ 为雌性观测值的索引集，$J_m = \\{j \\mid z_j = 1\\}$ 为雄性观测值的索引集。对数似然可以写成两个独立分量的和：\n$$\n\\ell(s_f, s_m) = \\ell_f(s_f) + \\ell_m(s_m)\n$$\n其中\n$$\n\\ell_f(s_f) = \\sum_{j \\in J_f} \\left[ y_j \\, \\log \\pi(q_j,0;s_f,s_m) + (1-y_j) \\log(1 - \\pi(q_j,0;s_f,s_m)) \\right]\n$$\n$$\n\\ell_m(s_m) = \\sum_{j \\in J_m} \\left[ y_j \\, \\log \\pi(q_j,1;s_f,s_m) + (1-y_j) \\log(1 - \\pi(q_j,1;s_f,s_m)) \\right]\n$$\n这种可分性使我们能够通过解决两个一维优化问题来独立地优化 $s_f$ 和 $s_m$。\n\n让我们为一个通用的选择系数 $s$ 及其对应的数据子集 $(q_k, y_k)$ 简化目标函数。概率为 $\\pi_k = \\frac{q_k (1 - s)}{q_k (1 - s) + (1 - q_k)} = \\frac{q_k(1-s)}{1-q_k s}$。因此，$1-\\pi_k = \\frac{1-q_k}{1-q_k s}$。\n来自观测值 $k$ 的对数似然贡献是：\n$$\ny_k \\log(\\pi_k) + (1-y_k) \\log(1-\\pi_k) = y_k \\log\\left(\\frac{q_k(1-s)}{1-q_k s}\\right) + (1-y_k) \\log\\left(\\frac{1-q_k}{1-q_k s}\\right)\n$$\n$$\n= y_k (\\log q_k + \\log(1-s) - \\log(1-q_k s)) + (1-y_k)(\\log(1-q_k) - \\log(1-q_k s))\n$$\n$$\n= (y_k \\log q_k + (1-y_k)\\log(1-q_k)) + y_k \\log(1-s) - \\log(1-q_k s)\n$$\n为了关于 $s$ 进行最大化，项 $(y_k \\log q_k + (1-y_k)\\log(1-q_k))$ 是一个常数，可以忽略。对所有相关观测值求和，任务是最大化 $\\sum_k \\left[ y_k \\log(1-s) - \\log(1-q_k s) \\right]$。\n这等价于最小化该表达式的相反数：\n$$\nL(s) = \\sum_k \\left[ \\log(1-q_k s) - y_k \\log(1-s) \\right]\n$$\n这个简化的负对数似然函数数值稳定且计算高效。我们将使用雌性数据对 $s_f$ 最小化此函数，并使用雄性数据对 $s_m$ 最小化此函数。优化将使用带有边界 $(0, 1)$ 的数值标量优化器进行，因为约束条件是 $0 \\le s  1$。边界情况 $s=0$ 对应于中性。$s \\ge 1$ 的值在生物学上是无意义的，因为它意味着零适应度或负适应度，而 $s0$ 的值意味着对渗入等位基因的正选择。所提供的边界是合适的。\n\n对于每个测试用例，算法如下：\n1.  将数据 $(q, z, y)$ 划分为雌性子集 $(q_f, y_f)$ 和雄性子集 $(q_m, y_m)$。\n2.  定义目标函数 $L(s; q_{\\text{data}}, y_{\\text{data}}) = \\sum_k [\\log(1-q_k s) - y_k \\log(1-s)]$。\n3.  在区间 $[0, 1)$ 上对 $s_f$ 数值最小化 $L(s_f; q_f, y_f)$，以找到最大似然估计 $\\hat{s}_f$。\n4.  在区间 $[0, 1)$ 上对 $s_m$ 数值最小化 $L(s_m; q_m, y_m)$，以找到最大似然估计 $\\hat{s}_m$。\n5.  使用未四舍五入的估计值来评估霍尔丹法则条件：$\\hat{s}_m - \\hat{s}_f  \\tau = 0.05$。\n6.  将 $\\hat{s}_m$ 和 $\\hat{s}_f$ 四舍五入到三位小数。\n7.  将结果编译成指定的列表格式 `[rounded_sm, rounded_sf, boolean_decision]`。\n对所有测试用例重复此过程，并将最终结果汇总到一个列表中。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the Haldane's rule inference problem for the given test cases.\n    \"\"\"\n    # Test cases as provided in the problem statement.\n    test_cases = [\n        # Case 1: reduced X introgression in males; representative of Haldane's rule\n        {\n            \"q\": [0.3, 0.3, 0.4, 0.4, 0.5, 0.5, 0.6, 0.6, 0.7, 0.7, 0.8, 0.8, 0.9, 0.9],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1]\n        },\n        # Case 2: no sex difference; near-neutral behavior\n        {\n            \"q\": [0.2, 0.2, 0.4, 0.4, 0.5, 0.5, 0.6, 0.6, 0.8, 0.8],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 0, 0, 1, 1, 1, 1]\n        },\n        # Case 3: boundary-like behavior; strong male-specific selection\n        {\n            \"q\": [0.1, 0.1, 0.49, 0.49, 0.51, 0.51, 0.9, 0.9, 0.96, 0.96, 0.98, 0.98],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1]\n        }\n    ]\n\n    tau = 0.05\n    results = []\n\n    for case_data in test_cases:\n        q = np.array(case_data[\"q\"])\n        z = np.array(case_data[\"z\"])\n        y = np.array(case_data[\"y\"])\n\n        # Partition data into female (z=0) and male (z=1) subsets\n        female_mask = (z == 0)\n        male_mask = (z == 1)\n\n        q_f, y_f = q[female_mask], y[female_mask]\n        q_m, y_m = q[male_mask], y[male_mask]\n\n        def neg_log_lik(s, q_arr, y_arr):\n            \"\"\"\n            Calculates the simplified negative log-likelihood to be minimized.\n            L(s) = sum(log(1 - q_k*s) - y_k*log(1 - s))\n            \"\"\"\n            # If no data for a sex, likelihood is flat, s=0 is the neutral default.\n            if len(q_arr) == 0:\n                return 0.0\n            \n            # log(1-s) -> -inf as s->1. If any y_k=1, -y_k*log(1-s) -> +inf,\n            # which correctly penalizes s=1.\n            # np.log handles the vectorization automatically.\n            term1 = np.sum(np.log(1 - q_arr * s))\n            term2 = np.sum(y_arr * np.log(1 - s))\n            return term1 - term2\n\n        # --- Estimate s_f for females ---\n        # If no female data, MLE for s_f is taken as 0 (neutrality).\n        if len(q_f) > 0:\n            res_f = minimize_scalar(\n                lambda s: neg_log_lik(s, q_f, y_f),\n                bounds=(0, 1),\n                method='bounded'\n            )\n            s_f_hat = res_f.x\n        else:\n            s_f_hat = 0.0\n\n        # --- Estimate s_m for males ---\n        # If no male data, MLE for s_m is taken as 0.\n        if len(q_m) > 0:\n            res_m = minimize_scalar(\n                lambda s: neg_log_lik(s, q_m, y_m),\n                bounds=(0, 1),\n                method='bounded'\n            )\n            s_m_hat = res_m.x\n        else:\n            s_m_hat = 0.0\n            \n        # Decision for Haldane's rule using unrounded estimates\n        is_haldane = (s_m_hat - s_f_hat) > tau\n\n        # Round estimates for reporting\n        s_m_rounded = round(s_m_hat, 3)\n        s_f_rounded = round(s_f_hat, 3)\n\n        results.append([s_m_rounded, s_f_rounded, is_haldane])\n\n    # Format the final output string exactly as specified.\n    # The default str() representation of a list of lists matches the required format.\n    # e.g., [[0.1, 0.2, True], [0.3, 0.4, False]]\n    # However, to be certain about no extra spaces, we build it manually.\n    sub_lists_str = [f\"[{r[0]},{r[1]},{str(r[2]).lower()}]\" for r in results]\n    final_output_str = f\"[{','.join(sub_lists_str)}]\"\n\n    print(final_output_str)\n\nsolve()\n```", "id": "2720969"}]}