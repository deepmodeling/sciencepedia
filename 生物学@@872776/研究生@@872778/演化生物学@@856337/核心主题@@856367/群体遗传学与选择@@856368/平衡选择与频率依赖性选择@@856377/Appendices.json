{"hands_on_practices": [{"introduction": "超显性是维持等位基因多态性的一个核心机制。这个练习旨在通过严格的数学推导，巩固理论群体遗传学的基本技能：首先求解平衡状态下的等位基因频率，然后利用局部稳定性分析来证明该平衡点是稳定的。通过这个实践（[@problem_id:2693410]），你将能深刻理解为何杂合子优势能够在一个种群中主动维持遗传变异。", "problem": "考虑一个具有两个等位基因 $A$ 和 $a$ 的单一位点，在一个离散时间生存力选择下的随机交配种群中。设基因型适合度为 $w_{AA}=1-s$，$w_{Aa}=1$ 和 $w_{aa}=1-t$，其中 $0  s, t  1$。首先，推导出等位基因 $A$ 的平衡频率 $p^*$。然后，通过计算迭代函数 $p' = F(p)$ 在 $p^*$ 处的导数 $F'(p^*)$ 来分析该平衡点的局部稳定性。将 $F'(p^*)$ 的表达式作为最终答案。", "solution": "所述问题定义明确，并基于群体遗传学的标准原理。我们开始推导。\n\n等位基因 $A$ 的频率递推关系由下式给出\n$$\np' = F(p) = \\frac{p^2 w_{AA} + p(1-p) w_{Aa}}{\\bar{w}}\n$$\n其中种群的平均适合度为\n$$\n\\bar{w} = p^2 w_{AA} + 2p(1-p) w_{Aa} + (1-p)^2 w_{aa}\n$$\n代入基因型适合度 $w_{AA}=1-s$、$w_{Aa}=1$ 和 $w_{aa}=1-t$，我们得到：\n$$\n\\bar{w}(p) = p^2(1-s) + 2p(1-p) + (1-p)^2(1-t) = 1 - sp^2 - t(1-p)^2\n$$\n平衡点 $p^*$ 出现在 $p' = p$ 时，或者更容易地，当两个等位基因的边际适合度相等时：$w_A(p^*) = w_a(p^*)$。\n$$\nw_A(p) = p w_{AA} + (1-p) w_{Aa} = p(1-s) + (1-p) = 1-sp\n$$\n$$\nw_a(p) = p w_{Aa} + (1-p) w_{aa} = p + (1-p)(1-t) = 1 - t + tp\n$$\n令 $w_A(p^*) = w_a(p^*)$：\n$$\n1-sp^* = 1 - t + tp^* \\implies t = p^*(s+t) \\implies p^* = \\frac{t}{s+t}\n$$\n接下来，我们计算 $p' = F(p)$ 在 $p^*$ 处的导数。一个有用的公式是，对于常数适合度，$F'(p) = \\frac{d}{dp} \\frac{p w_A(p)}{\\bar{w}(p)}$。在平衡点处，一个更简单的公式是：\n$$\nF'(p^*) = 1 + \\frac{p^*(1-p^*)}{\\bar{w}(p^*)} \\left( \\frac{d(w_A(p) - w_a(p))}{dp} \\right)_{p=p^*}\n$$\n我们有 $w_A(p) - w_a(p) = (1-sp) - (1-t+tp) = t - (s+t)p$。因此，其导数为：\n$$\n\\frac{d(w_A(p) - w_a(p))}{dp} = -(s+t)\n$$\n在平衡点，平均适合度为 $\\bar{w}(p^*) = w_A(p^*) = 1 - sp^* = 1 - s\\frac{t}{s+t} = \\frac{s+t-st}{s+t}$。\n我们还需要 $p^*(1-p^*) = \\frac{t}{s+t} \\left(1 - \\frac{t}{s+t}\\right) = \\frac{t}{s+t} \\frac{s}{s+t} = \\frac{st}{(s+t)^2}$。\n将这些项代入导数公式：\n$$\nF'(p^*) = 1 + \\frac{st/(s+t)^2}{(s+t-st)/(s+t)} \\cdot (-(s+t))\n$$\n$$\n= 1 - \\frac{st}{(s+t)^2} \\cdot \\frac{s+t}{s+t-st} \\cdot (s+t) = 1 - \\frac{st}{s+t-st}\n$$\n将上式通分，我们得到最终答案：\n$$\nF'(p^*) = \\frac{s+t-st - st}{s+t-st} = \\frac{s+t-2st}{s+t-st}\n$$\n对于 $0  s, t  1$，可以证明 $|F'(p^*)|  1$，因此平衡点是局部稳定的。", "answer": "$$\n\\boxed{\\frac{s+t-2st}{s+t-st}}\n$$", "id": "2693410"}, {"introduction": "平衡选择并非仅限于超显性，负频率依赖选择是另一种维持生物多样性的强大力量。这个练习（[@problem_id:2693426]）将经典的“石头-剪刀-布”博弈作为模型，来探讨这种非传递性的相互作用。你将运用复制子动态方程来分析，证明没有任何单一策略能永久占据优势，从而导致种群在策略频率上呈现周期性振荡，这揭示了一种与稳定点完全不同的动态平衡。", "problem": "在一个混合均匀、无限大的种群中，存在三种可遗传的策略，它们受到频率依赖性选择。假设相互作用是对称的，其收益由矩阵给出\n$$\nA=\\begin{pmatrix}\n0  -1  1 \\\\\n1  0  -1 \\\\\n-1  1  0\n\\end{pmatrix},\n$$\n该矩阵编码了石头-剪刀-布的相互作用。令 $\\mathbf{x}=(x_{1},x_{2},x_{3})$ 表示这三种策略的频率，其中 $x_{i}\\ge 0$ 且 $x_{1}+x_{2}+x_{3}=1$。假设类型 $i$ 的马尔萨斯适应度为 $w_{i}(\\mathbf{x})=(A\\mathbf{x})_{i}$，种群平均适应度为 $\\bar{w}(\\mathbf{x})=\\sum_{i=1}^{3}x_{i}w_{i}(\\mathbf{x})$。从这些定义和“在连续时间内频率变化与相对适应度成正比”的原则出发，执行以下操作：\n\n- 根据连续时间中的比例选择第一原理，推导单纯形上关于 $\\dot{\\mathbf{x}}$ 的动力系统，并针对给定的 $A$ 明确写出该系统。\n- 仅使用从 $A$ 和上述定义得出的性质，确定单纯形内的内部不动点 $\\mathbf{x}^{\\ast}$。\n- 通过在 $\\mathbf{x}^{\\ast}$ 处对系统进行线性化，并确定一个守恒量来证明在单纯形内部存在围绕 $\\mathbf{x}^{\\ast}$ 的闭合轨道，从而对 $\\mathbf{x}^{\\ast}$ 的局部稳定性进行分类。\n- 对于初始条件 $\\mathbf{x}(0)=\\left(\\frac{1}{2},\\frac{1}{3},\\frac{1}{6}\\right)$，计算你确定的守恒量的值。\n\n将你的最终答案表示为内部不动点频率向量 $\\mathbf{x}^{\\ast}$，使用 $\\begin{pmatrix}\\cdot  \\cdot  \\cdot\\end{pmatrix}$ 的单行矩阵形式。无需四舍五入，不涉及单位。", "solution": "问题陈述是有效的。这是一个在演化博弈论领域中提法恰当、有科学依据的问题。所有必要的数据和定义都已提供，没有矛盾或模糊之处。我们将按要求进行推导和分析。\n\n在连续时间选择下，一个大型、混合均匀的种群中策略 $i$ 的频率 $x_i$ 变化率的基本原理由复制子方程给出：\n$$\n\\dot{x_i} = x_i \\left( w_i(\\mathbf{x}) - \\bar{w}(\\mathbf{x}) \\right)\n$$\n其中 $\\dot{x_i}$ 是 $x_i$ 的时间导数，$w_i(\\mathbf{x})$ 是策略 $i$ 的适应度，$\\bar{w}(\\mathbf{x})$ 是种群的平均适应度。\n\n首先，我们计算每个策略 $i$ 的适应度，由 $w_i(\\mathbf{x}) = (A\\mathbf{x})_i$ 给出，其中收益矩阵为\n$$\nA=\\begin{pmatrix}\n0  -1  1 \\\\\n1  0  -1 \\\\\n-1  1  0\n\\end{pmatrix}\n$$\n频率向量为 $\\mathbf{x}=(x_{1},x_{2},x_{3})^T$。\n适应度分量为：\n$$\nw_1(\\mathbf{x}) = (0)x_1 + (-1)x_2 + (1)x_3 = x_3 - x_2\n$$\n$$\nw_2(\\mathbf{x}) = (1)x_1 + (0)x_2 + (-1)x_3 = x_1 - x_3\n$$\n$$\nw_3(\\mathbf{x}) = (-1)x_1 + (1)x_2 + (0)x_3 = x_2 - x_1\n$$\n接下来，我们计算种群的平均适应度，$\\bar{w}(\\mathbf{x}) = \\sum_{i=1}^{3}x_{i}w_{i}(\\mathbf{x})$：\n$$\n\\bar{w}(\\mathbf{x}) = x_1(x_3 - x_2) + x_2(x_1 - x_3) + x_3(x_2 - x_1)\n$$\n$$\n\\bar{w}(\\mathbf{x}) = x_1x_3 - x_1x_2 + x_1x_2 - x_2x_3 + x_2x_3 - x_1x_3 = 0\n$$\n平均适应度恒为零。这是具有反对称收益矩阵（$A = -A^T$）的博弈的一个已知性质，因为 $\\bar{w}(\\mathbf{x}) = \\mathbf{x}^T A \\mathbf{x}$。其转置为 $(\\mathbf{x}^T A \\mathbf{x})^T = \\mathbf{x}^T A^T \\mathbf{x} = -\\mathbf{x}^T A \\mathbf{x}$，这意味着 $\\bar{w}(\\mathbf{x})=0$。\n\n当 $\\bar{w}(\\mathbf{x}) = 0$ 时，复制子方程简化为 $\\dot{x_i} = x_i w_i(\\mathbf{x})$。频率的动力系统为：\n$$\n\\dot{x}_1 = x_1 (x_3 - x_2)\n$$\n$$\n\\dot{x}_2 = x_2 (x_1 - x_3)\n$$\n$$\n\\dot{x}_3 = x_3 (x_2 - x_1)\n$$\n该系统在单纯形 $S_3 = \\{ \\mathbf{x} \\in \\mathbb{R}^3 \\mid x_1+x_2+x_3=1, x_i \\ge 0 \\}$ 上演化。\n\n为了找到内部不动点，记为 $\\mathbf{x}^{\\ast}$，我们令所有 $i \\in \\{1, 2, 3\\}$ 的 $\\dot{x}_i = 0$。对于一个内部点，必须有对所有 $i$ 都有 $x_i^{\\ast} > 0$。条件变为：\n$$\nx_1^{\\ast} (x_3^{\\ast} - x_2^{\\ast}) = 0 \\implies x_3^{\\ast} - x_2^{\\ast} = 0 \\implies x_2^{\\ast} = x_3^{\\ast}\n$$\n$$\nx_2^{\\ast} (x_1^{\\ast} - x_3^{\\ast}) = 0 \\implies x_1^{\\ast} - x_3^{\\ast} = 0 \\implies x_1^{\\ast} = x_3^{\\ast}\n$$\n$$\nx_3^{\\ast} (x_2^{\\ast} - x_1^{\\ast}) = 0 \\implies x_2^{\\ast} - x_1^{\\ast} = 0 \\implies x_1^{\\ast} = x_2^{\\ast}\n$$\n这些共同意味着 $x_1^{\\ast} = x_2^{\\ast} = x_3^{\\ast}$。使用频率总和必须为 1 的约束条件：\n$$\nx_1^{\\ast} + x_2^{\\ast} + x_3^{\\ast} = 1 \\implies 3x_1^{\\ast} = 1 \\implies x_1^{\\ast} = \\frac{1}{3}\n$$\n因此，唯一的内部不动点是 $\\mathbf{x}^{\\ast} = \\left(\\frac{1}{3}, \\frac{1}{3}, \\frac{1}{3}\\right)$。\n\n为了对 $\\mathbf{x}^{\\ast}$ 的稳定性进行分类，我们通过计算雅可比矩阵 $J(\\mathbf{x})$ 来对系统进行线性化：\n$$\nJ(\\mathbf{x}) = \\begin{pmatrix}\n\\frac{\\partial \\dot{x}_1}{\\partial x_1}  \\frac{\\partial \\dot{x}_1}{\\partial x_2}  \\frac{\\partial \\dot{x}_1}{\\partial x_3} \\\\\n\\frac{\\partial \\dot{x}_2}{\\partial x_1}  \\frac{\\partial \\dot{x}_2}{\\partial x_2}  \\frac{\\partial \\dot{x}_2}{\\partial x_3} \\\\\n\\frac{\\partial \\dot{x}_3}{\\partial x_1}  \\frac{\\partial \\dot{x}_3}{\\partial x_2}  \\frac{\\partial \\dot{x}_3}{\\partial x_3}\n\\end{pmatrix} = \\begin{pmatrix}\nx_3 - x_2  -x_1  x_1 \\\\\nx_2  x_1 - x_3  -x_2 \\\\\n-x_3  x_3  x_2 - x_1\n\\end{pmatrix}\n$$\n在不动点 $\\mathbf{x}^{\\ast} = \\left(\\frac{1}{3}, \\frac{1}{3}, \\frac{1}{3}\\right)$ 处求值：\n$$\nJ(\\mathbf{x}^{\\ast}) = \\begin{pmatrix}\n0  -1/3  1/3 \\\\\n1/3  0  -1/3 \\\\\n-1/3  1/3  0\n\\end{pmatrix}\n$$\n特征值 $\\lambda$ 是特征方程 $\\det(J(\\mathbf{x}^{\\ast}) - \\lambda I) = 0$ 的根：\n$$\n\\det\\begin{pmatrix}\n-\\lambda  -1/3  1/3 \\\\\n1/3  -\\lambda  -1/3 \\\\\n-1/3  1/3  -\\lambda\n\\end{pmatrix} = -\\lambda(\\lambda^2 + \\frac{1}{9}) - (-\\frac{1}{3})(-\\frac{\\lambda}{3} - \\frac{1}{9}) + \\frac{1}{3}(\\frac{1}{9} - \\frac{\\lambda}{3})\n$$\n$$\n= -\\lambda^3 - \\frac{\\lambda}{9} - \\frac{\\lambda}{9} - \\frac{1}{27} + \\frac{1}{27} - \\frac{\\lambda}{9} = -\\lambda^3 - \\frac{3\\lambda}{9} = -\\lambda^3 - \\frac{\\lambda}{3} = -\\lambda(\\lambda^2 + \\frac{1}{3}) = 0\n$$\n特征值为 $\\lambda_1 = 0$, $\\lambda_2 = i\\frac{1}{\\sqrt{3}}$ 和 $\\lambda_3 = -i\\frac{1}{\\sqrt{3}}$。一个零特征值（由于频率总和的守恒性）和一对纯虚数特征值的存在表明该不动点是一个中心点。它是李雅普诺夫稳定的，但不是渐近稳定的，被动力系统的闭合轨道所环绕。\n\n为了直接证明闭合轨道的存在，我们确定一个守恒量。让我们测试一个形式为 $K(\\mathbf{x}) = x_1^{c_1} x_2^{c_2} x_3^{c_3}$ 的函数。为了使 $K$ 守恒，其时间导数必须为零。证明 $\\ln(K)$ 的导数为零更为方便：\n$$\n\\frac{d}{dt} \\ln(K) = \\frac{d}{dt} (c_1 \\ln x_1 + c_2 \\ln x_2 + c_3 \\ln x_3) = c_1 \\frac{\\dot{x}_1}{x_1} + c_2 \\frac{\\dot{x}_2}{x_2} + c_3 \\frac{\\dot{x}_3}{x_3}\n$$\n代入 $\\frac{\\dot{x}_i}{x_i} = w_i(\\mathbf{x})$：\n$$\n\\frac{d}{dt} \\ln(K) = c_1 w_1 + c_2 w_2 + c_3 w_3 = c_1(x_3 - x_2) + c_2(x_1 - x_3) + c_3(x_2 - x_1)\n$$\n$$\n= x_1(c_2 - c_3) + x_2(c_3 - c_1) + x_3(c_1 - c_2)\n$$\n要使该表达式对于单纯形内部的任何 $\\mathbf{x}$ 都为零， $x_i$ 的系数之和必须等于一个常数乘以 $\\sum x_i$，或者更简单地说，它们必须全部为零。将它们设为零得到 $c_1=c_2$, $c_2=c_3$, $c_3=c_1$。我们可以选择最简单的非平凡情况，$c_1=c_2=c_3=1$。\n因此，一个守恒量是 $K(\\mathbf{x}) = x_1 x_2 x_3$。其水平集 $x_1 x_2 x_3 = \\text{常数}$ 定义了相空间内部的闭合轨道，从而证实了 $\\mathbf{x}^{\\ast}$ 是一个中心点。\n\n最后，我们计算给定初始条件 $\\mathbf{x}(0) = \\left(\\frac{1}{2}, \\frac{1}{3}, \\frac{1}{6}\\right)$ 下该守恒量的值。\n$$\nK(\\mathbf{x}(0)) = x_1(0) x_2(0) x_3(0) = \\left(\\frac{1}{2}\\right) \\left(\\frac{1}{3}\\right) \\left(\\frac{1}{6}\\right) = \\frac{1}{36}\n$$\n从该点开始的整个轨迹上，这个值保持不变。\n\n问题要求将内部不动点频率向量作为最终答案。\n$$\n\\mathbf{x}^{\\ast} = \\left(\\frac{1}{3}, \\frac{1}{3}, \\frac{1}{3}\\right)\n$$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\end{pmatrix}}\n$$", "id": "2693426"}, {"introduction": "经典的演化模型通常假设种群无限大，但现实世界中的种群规模是有限的，不可避免地会受到遗传漂变等随机因素的影响。本计算练习（[@problem_id:2693398]）要求你将具有确定性混合策略均衡的“鹰-鸽博弈”置于一个有限种群的Moran过程中进行建模。通过计算系统在选择、突变和漂变共同作用下的稳态分布，你将深入理解随机性如何改变确定性模型的预测，并量化有限种群的平均行为与理论上的演化稳定策略（ESS）之间的偏差。", "problem": "要求您形式化并计算一个有限种群频率依赖的 Moran 过程的平稳分布，该过程用于一个包含选择强度和对称点突变的双策略鹰鸽博弈，并量化随机漂变如何扰动无限种群的演化稳定策略 (ESS)。该问题必须通过编写一个程序来解决，该程序直接构建鹰数量马尔可夫过程的单步转移概率，并使用它们计算唯一的平稳分布，然后总结鹰的平均平稳频率与确定性混合 ESS 的偏差。\n\n使用的建模假设，这些都是种群遗传学和演化博弈论的标准基础：\n\n- 种群和策略：\n  - 一个大小为 $N$ 的有限、均匀混合的种群包含 $i$ 只鹰和 $N-i$ 只鸽，其中 $i \\in \\{0,1,\\dots,N\\}$。\n  - 互动遵循鹰鸽博弈，资源价值为 $V$，冲突成本为 $C$，且 $V  C$ 以确保在无限种群极限下存在混合演化稳定策略 (ESS)。标准的收益矩阵（行参与者的收益）为：\n    - 鹰 vs. 鹰：$(V - C)/2$。\n    - 鹰 vs. 鸽：$V$。\n    - 鸽 vs. 鹰：$0$。\n    - 鸽 vs. 鸽：$V/2$。\n- 在有 $i$ 只鹰的种群状态下的期望收益：\n  - 鹰的期望收益为\n    $$\\pi_H(i) = \\frac{i-1}{N-1} \\cdot \\frac{V-C}{2} + \\frac{N-i}{N-1} \\cdot V.$$\n  - 鸽的期望收益为\n    $$\\pi_D(i) = \\frac{i}{N-1} \\cdot 0 + \\frac{N-i-1}{N-1} \\cdot \\frac{V}{2} = \\frac{N-i-1}{N-1} \\cdot \\frac{V}{2}.$$\n  这些期望是基于无自我互动的随机匹配。\n- 适应度映射和选择强度：\n  - 使用指数映射将收益映射到繁殖适应度\n    $$f_H(i) = \\exp(\\beta \\, \\pi_H(i)), \\quad f_D(i) = \\exp(\\beta \\, \\pi_D(i)),$$\n    其中 $\\beta \\ge 0$ 是选择强度，$\\exp(\\cdot)$ 表示指数函数。这保证了所有状态和参数的适应度都严格为正。\n- 带突变的 Moran 生死过程步骤：\n  - 繁殖：根据适应度按比例选择一个个体进行繁殖（即，鹰为 $i \\cdot f_H(i)$，鸽为 $(N-i) \\cdot f_D(i)$）。\n  - 出生时以概率 $\\mu \\in (0,1)$ 发生对称点突变：后代的策略从鹰翻转为鸽，或从鸽翻转为鹰的概率为 $\\mu$，保持不变的概率为 $1-\\mu$。\n  - 死亡：独立于繁殖，均匀随机选择一个个体死亡。\n  - 一步中鹰数量的净变化：如果后代是鹰且死亡的是鸽，则为 $+1$；如果后代是鸽且死亡的是鹰，则为 $-1$；否则为 $0$。\n- 状态空间和转移：\n  - 该过程是状态空间 $\\{0,1,\\dots,N\\}$ 上的一个一维生死链，其转移概率为\n    $$T_i^+ = \\Pr(i \\to i+1), \\quad T_i^- = \\Pr(i \\to i-1), \\quad T_i^0 = 1 - T_i^+ - T_i^-,$$\n    其中 $T_i^+$ 和 $T_i^-$ 由上述繁殖-突变-死亡机制确定。对于 $\\mu  0$，该链是不可约的，并具有唯一的平稳分布在 $\\{0,\\dots,N\\}$ 上。\n\n基础确定性基准：\n- 在复制子动态下的无限种群极限中，混合 ESS 的鹰频率为\n  $$p^\\star = \\frac{V}{C},$$\n  前提是 $0  V  C$。有限的种群大小和随机漂变将使平均平稳频率偏离 $p^\\star$。\n\n您的任务：\n- 根据上述模型，从第一性原理构建所有 $i \\in \\{0,\\dots,N\\}$ 的 $T_i^+$ 和 $T_i^-$。\n- 通过求解 $\\{0,\\dots,N\\}$ 上生死链的平稳条件，计算唯一的平稳分布 $\\{\\pi_i\\}_{i=0}^N$。\n- 从 $\\{\\pi_i\\}$ 计算平均平稳鹰频率\n  $$\\bar{p} = \\sum_{i=0}^N \\pi_i \\cdot \\frac{i}{N},$$\n  及其方差\n  $$\\mathrm{Var}(p) = \\sum_{i=0}^N \\pi_i \\cdot \\left(\\frac{i}{N}\\right)^2 - \\bar{p}^2.$$\n- 通过绝对偏差量化 ESS 的扰动\n  $$\\Delta = \\left| \\bar{p} - p^\\star \\right|.$$\n\n数值稳定性要求：\n- 您必须以数值稳定的方式为给定的测试用例计算平稳分布。可使用对数来累积转移概率比率的乘积。\n\n测试套件：\n- 对于每个测试用例，参数以 $(N,\\beta,\\mu,V,C)$ 的形式给出。\n- 按此确切顺序使用以下参数集：\n  1. $(10, 0.0, 0.01, 1.0, 3.0)$\n  2. $(10, 1.0, 0.01, 1.0, 3.0)$\n  3. $(100, 1.0, 0.001, 1.0, 3.0)$\n  4. $(5, 2.0, 0.01, 1.0, 3.0)$\n  5. $(2, 1.0, 0.05, 1.0, 3.0)$\n\n程序输出规范：\n- 对于每个测试用例，程序必须按 $[\\bar{p}, \\Delta, \\mathrm{Var}(p)]$ 的顺序输出一个包含三个实数的列表，其中每个数字都是小数（而不是百分比）。\n- 将所有测试用例的输出聚合到一个列表中，保持测试用例的顺序，因此最终输出是单行上的一个列表的列表。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的三元组也用方括号括起来，例如：\n  - $[[x_{1,1},x_{1,2},x_{1,3}],[x_{2,1},x_{2,2},x_{2,3}],\\dots]$", "solution": "所提出的问题是理论演化生物学中一个标准的、定义明确的练习。它具有科学依据，不需要主观解释，并提供了构建解决方案所需的所有必要参数。因此，该问题被认为是有效的。我们继续进行推导和计算解决方案。\n\n问题的核心是分析一个一维生死马尔可夫过程，该过程模拟了有限种群中鹰和鸽策略的演化。系统的状态是固定大小为 $N$ 的种群中鹰的数量 $i$。因此，状态空间是整数集合 $\\{0, 1, \\dots, N\\}$。\n\n首先，我们按照规定形式化模型的各个组成部分。\n\n**1. 收益和适应度**\n\n在一个有 $i$ 只鹰和 $N-i$ 只鸽的种群中，一个个体与其他 $N-1$ 个个体互动。\n鹰的期望收益 $\\pi_H(i)$ 为：\n$$ \\pi_H(i) = \\frac{i-1}{N-1} \\left( \\frac{V-C}{2} \\right) + \\frac{N-i}{N-1} V $$\n鸽的期望收益 $\\pi_D(i)$ 为：\n$$ \\pi_D(i) = \\frac{i}{N-1} (0) + \\frac{N-i-1}{N-1} \\left( \\frac{V}{2} \\right) = \\frac{N-i-1}{N-1} \\frac{V}{2} $$\n这些收益是在策略存在的状态下定义的（即，鹰为 $i \\in \\{1, \\dots, N\\}$，鸽为 $i \\in \\{0, \\dots, N-1\\}$）。对于 $N=1$，没有互动，收益未定义；然而，所有测试用例都满足 $N \\ge 2$。\n适应度是收益的指数函数，由选择强度 $\\beta \\ge 0$ 控制：\n$$ f_H(i) = \\exp(\\beta \\pi_H(i)), \\quad f_D(i) = \\exp(\\beta \\pi_D(i)) $$\n\n**2. 转移概率**\n\nMoran 过程在每个时间步长中包含一次出生和一次死亡事件。\n状态 $i$ 下种群的总适应度是 $F(i) = i f_H(i) + (N-i) f_D(i)$。\n根据适应度按比例选择一个个体进行繁殖。选择鹰作为亲本的概率是 $\\frac{i f_H(i)}{F(i)}$，选择鸽作为亲本的概率是 $\\frac{(N-i) f_D(i)}{F(i)}$。\n在对称突变率 $\\mu$ 下，后代的策略以 $1-\\mu$ 的概率与其亲本相同，以 $\\mu$ 的概率翻转。\n新生儿是鹰的概率 $P(\\text{新生儿=鹰}|i)$，是鹰产生非突变鹰和鸽产生突变鹰的概率之和：\n$$ P(\\text{newborn=H}|i) = \\frac{i f_H(i)}{F(i)}(1-\\mu) + \\frac{(N-i) f_D(i)}{F(i)}\\mu $$\n类似地，新生儿是鸽的概率是：\n$$ P(\\text{newborn=D}|i) = \\frac{(N-i) f_D(i)}{F(i)}(1-\\mu) + \\frac{i f_H(i)}{F(i)}\\mu $$\n一个个体被均匀随机地选择死亡。一只鸽死亡的概率是 $\\frac{N-i}{N}$，一只鹰死亡的概率是 $\\frac{i}{N}$。\n\n如果一只鹰出生并且一只鸽死亡，鹰的数量从 $i$ 增加到 $i+1$。转移概率是：\n$$ T_i^+ = \\Pr(i \\to i+1) = P(\\text{newborn=H}|i) \\cdot \\frac{N-i}{N} \\quad \\text{对于 } i \\in \\{0, \\dots, N-1\\} $$\n如果一只鸽出生并且一只鹰死亡，鹰的数量从 $i$ 减少到 $i-1$。转移概率是：\n$$ T_i^- = \\Pr(i \\to i-1) = P(\\text{newborn=D}|i) \\cdot \\frac{i}{N} \\quad \\text{对于 } i \\in \\{1, \\dots, N\\} $$\n根据定义，$T_N^+ = 0$ 且 $T_0^- = 0$。对于 $\\mu \\in (0, 1)$，所有其他转移概率 $T_i^+$（对于 $i  N$）和 $T_i^-$（对于 $i > 0$）均严格为正，这使得马尔可夫链是不可约的。\n\n**3. 平稳分布**\n\n对于一个不可约的生死过程，存在一个唯一的平稳分布 $\\{\\pi_i\\}_{i=0}^N$，它满足细致平衡条件：\n$$ \\pi_i T_i^+ = \\pi_{i+1} T_{i+1}^- \\quad \\text{对于 } i \\in \\{0, \\dots, N-1\\} $$\n这产生了一个概率的递推关系：\n$$ \\pi_{i+1} = \\pi_i \\frac{T_i^+}{T_{i+1}^-} $$\n我们可以用 $\\pi_0$ 表示每个 $\\pi_i$：\n$$ \\pi_i = \\pi_0 \\prod_{j=0}^{i-1} \\frac{T_j^+}{T_{j+1}^-} \\quad \\text{对于 } i \\ge 1 $$\n为了以数值稳定的方式计算这个乘积，我们使用对数。设 $L_i = \\ln(\\pi_i / \\pi_0)$。那么 $L_0 = 0$，对于 $i \\ge 1$：\n$$ L_i = L_{i-1} + \\ln\\left(\\frac{T_{i-1}^+}{T_i^-}\\right) = \\sum_{j=0}^{i-1} \\ln\\left(\\frac{T_j^+}{T_{j+1}^-}\\right) $$\n概率 $\\pi_i$ 接着由 $\\pi_i = \\pi_0 \\exp(L_i)$ 给出。使用归一化条件 $\\sum_{k=0}^N \\pi_k = 1$，我们解出 $\\pi_0$：\n$$ \\pi_0 = \\frac{1}{\\sum_{k=0}^N \\exp(L_k)} $$\n因此，对于任何 $i$：\n$$ \\pi_i = \\frac{\\exp(L_i)}{\\sum_{k=0}^N \\exp(L_k)} $$\n这可以使用 log-sum-exp 技巧稳定地计算，即在求幂之前从所有指数中减去 $L_k$ 的最大值，以防止数值溢出。\n\n**4. 最终量**\n\n计算出平稳分布 $\\{\\pi_i\\}_{i=0}^N$ 后，我们计算所需的度量：\n平均平稳鹰频率 $\\bar{p}$ 是频率 $p = i/N$ 在平稳分布下的期望值：\n$$ \\bar{p} = E[p] = \\sum_{i=0}^N \\pi_i \\left(\\frac{i}{N}\\right) $$\n平稳鹰频率的方差，此处记为 $\\mathrm{Var}(p)$，是：\n$$ \\mathrm{Var}(p) = E[p^2] - (E[p])^2 = \\left(\\sum_{i=0}^N \\pi_i \\left(\\frac{i}{N}\\right)^2\\right) - \\bar{p}^2 $$\n确定性混合 ESS 的鹰频率是 $p^\\star = V/C$。有限种群均值与此基准的绝对偏差是：\n$$ \\Delta = |\\bar{p} - p^\\star| $$\n将对测试套件中提供的每个参数集执行这些计算。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It orchestrates the calculation for each case and formats the output.\n    \"\"\"\n    \n    def solve_case(N, beta, mu, V, C):\n        \"\"\"\n        Computes the stationary distribution and related metrics for the hawk-dove game\n        in a finite population for a single set of parameters.\n\n        Args:\n            N (int): Population size.\n            beta (float): Selection intensity.\n            mu (float): Symmetric mutation rate.\n            V (float): Resource value.\n            C (float): Cost of conflict.\n\n        Returns:\n            list: A list containing [mean_hawk_frequency, deviation_from_ESS, variance_of_frequency].\n        \"\"\"\n        # 1. Deterministic ESS and helper arrays\n        p_star = V / C\n        i_vals = np.arange(N + 1, dtype=np.float64)\n        freqs = i_vals / N\n\n        # 2. Payoff calculations\n        # Based on interactions with N-1 other individuals. Valid for N > 1.\n        if N > 1:\n            pi_H_vals = ((i_vals - 1) / (N - 1)) * (V - C) / 2 + ((N - i_vals) / (N - 1)) * V\n            pi_D_vals = ((N - i_vals - 1) / (N - 1)) * V / 2\n            pi_H_vals[0] = 0.0  # Payoff is not used for non-existent strategies.\n            pi_D_vals[N] = 0.0\n        else: # N=1 case (not in tests, but for robustness)\n            pi_H_vals = np.zeros(N + 1)\n            pi_D_vals = np.zeros(N + 1)\n\n        # 3. Fitness mapping\n        f_H_vals = np.exp(beta * pi_H_vals)\n        f_D_vals = np.exp(beta * pi_D_vals)\n\n        # 4. Total fitness of the population in each state i\n        F_vals = i_vals * f_H_vals + (N - i_vals) * f_D_vals\n\n        # 5. Transition probabilities for the birth-death process\n        with np.errstate(divide='ignore', invalid='ignore'):\n            # Probability that a newborn is a hawk\n            prob_H_birth = (i_vals * f_H_vals * (1 - mu) + (N - i_vals) * f_D_vals * mu) / F_vals\n            # Probability that a newborn is a dove\n            prob_D_birth = ((N - i_vals) * f_D_vals * (1 - mu) + i_vals * f_H_vals * mu) / F_vals\n        \n        # Handle edge cases where F_vals could be zero if not for exp() fitness\n        # For i=0, prob_H_birth = mu. For i=N, prob_D_birth = mu. The vectorized form is correct.\n        \n        # T_i^+ = P(new=H) * P(death=D) = P(new=H) * (N-i)/N\n        T_plus = prob_H_birth * (N - i_vals) / N\n        # T_i^- = P(new=D) * P(death=H) = P(new=D) * i/N\n        T_minus = prob_D_birth * i_vals / N\n        \n        # 6. Stationary distribution calculation using logarithms\n        # pi_i is proportional to product_{j=0 to i-1} (T_j^+ / T_{j+1}^-)\n        log_pi_ratios = np.zeros(N + 1)\n        for i in range(1, N + 1):\n            # For mu in (0,1), T_plus[i-1] and T_minus[i] are positive.\n            log_term = np.log(T_plus[i-1]) - np.log(T_minus[i])\n            log_pi_ratios[i] = log_pi_ratios[i-1] + log_term\n\n        # Normalize using the log-sum-exp trick for numerical stability\n        log_pi_max = np.max(log_pi_ratios)\n        pi_unnormalized = np.exp(log_pi_ratios - log_pi_max)\n        pi_dist = pi_unnormalized / np.sum(pi_unnormalized)\n\n        # 7. Compute final metrics\n        p_bar = np.sum(pi_dist * freqs)\n        var_p = np.sum(pi_dist * (freqs**2)) - p_bar**2\n        delta = np.abs(p_bar - p_star)\n\n        return [p_bar, delta, var_p]\n\n    # --- Main execution ---\n    test_cases = [\n        (10, 0.0, 0.01, 1.0, 3.0),\n        (10, 1.0, 0.01, 1.0, 3.0),\n        (100, 1.0, 0.001, 1.0, 3.0),\n        (5, 2.0, 0.01, 1.0, 3.0),\n        (2, 1.0, 0.05, 1.0, 3.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        result = solve_case(*case)\n        results.append(result)\n\n    # Format the final output string exactly as specified.\n    print(f\"[{','.join(f'[{r[0]:.8f},{r[1]:.8f},{r[2]:.8f}]' for r in results)}]\")\n\nsolve()\n```", "id": "2693398"}]}