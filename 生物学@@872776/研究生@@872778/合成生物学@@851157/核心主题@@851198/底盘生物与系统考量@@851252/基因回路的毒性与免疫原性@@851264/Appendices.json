{"hands_on_practices": [{"introduction": "合成基因线路在细胞内运行时，其表达产物或代谢副产物可能对宿主细胞产生毒性，这构成了“代谢负荷”的核心问题。为了定量评估这种风险，我们可以构建基于质量守恒原理的数学模型。这项实践旨在通过一个典型场景，练习如何建立和求解描述有毒中间产物浓度的动力学方程，其中综合考虑了常数速率的产生、遵循米氏动力学的酶促降解以及一级动力学的跨膜转运过程，最终通过求解稳态浓度来判断其是否超过细胞毒性阈值 [@problem_id:2740837]。", "problem": "在哺乳动物细胞中，一个合成基因线路会产生一种活性醛中间体（浓度记为 $S(t)$），它是转录激活级联反应中不可避免的副产物。由于持续的启动子活性，该线路以恒定速率 $r_{p}$ 输出这种醛。为减轻毒性，细胞表达一种解毒脱氢酶，该酶遵循米氏动力学，其最大催化速率为 $V_{\\max}$，米氏常数为 $K_{M}$。此外，由工程组分触发的低水平免疫原性信号会诱导一个转运蛋白，该转运蛋白以一级动力学输出醛，其速率常数为 $k_{\\text{imm}}$。假设细胞内是一个体积恒定且混合均匀的区室，$S$ 对 $r_{p}$ 没有反馈作用，并且酶-底物复合物处于准稳态。\n\n以质量守恒和米氏动力学框架为基本原理，通过令生成通量与总清除通量相等来推导稳态浓度 $S^{\\ast}$，并精确求解 $S^{\\ast}$。然后，使用以下参数对 $S^{\\ast}$ 进行数值计算：\n- $V_{\\max} = 5.0\\,\\text{nM}\\,\\text{s}^{-1}$，\n- $K_{M} = 50\\,\\text{nM}$，\n- $k_{\\text{imm}} = 0.020\\,\\text{s}^{-1}$，\n- $r_{p} = 3.50\\,\\text{nM}\\,\\text{s}^{-1}$。\n\n最后，判断 $S^{\\ast}$ 是否超过细胞毒性阈值 $C_{\\text{tox}} = 1.20 \\times 10^{2}\\,\\text{nM}$，并从第一性原理出发简要论证你的结论。将 $S^{\\ast}$ 的最终数值以 $\\text{nM}$ 为单位表示，并将答案四舍五入到四位有效数字。", "solution": "本问题要求推导并计算一个合成基因线路中活性醛的稳态浓度 $S^{\\ast}$。该分析基于醛物质的质量守恒基本原理，其浓度记为 $S(t)$。\n\n醛浓度的变化率 $\\frac{dS}{dt}$ 由其生成通量和清除通量之间的平衡决定。问题指明了以下几项：\n$1$. 恒定的生成速率 $r_{p}$。\n$2$. 遵循米氏动力学的酶促清除速率，由函数 $v_{\\text{enz}}(S) = \\frac{V_{\\max} S}{K_{M} + S}$ 描述。\n$3$. 由转运引起的一级清除速率，由 $v_{\\text{trans}}(S) = k_{\\text{imm}} S$ 给出。\n\n应用质量守恒原理，我们为 $S(t)$ 建立控制性常微分方程：\n$$ \\frac{dS}{dt} = \\text{生成速率} - \\text{总清除速率} $$\n$$ \\frac{dS}{dt} = r_{p} - v_{\\text{enz}}(S) - v_{\\text{trans}}(S) $$\n代入具体的速率定律得到：\n$$ \\frac{dS}{dt} = r_{p} - \\frac{V_{\\max} S}{K_{M} + S} - k_{\\text{imm}} S $$\n\n在稳态下，根据定义，系统变量不随时间变化。因此，醛的浓度不再变化，这在数学上意味着其时间导数为零。令 $S^{\\ast}$ 表示此稳态浓度。我们设 $\\frac{dS}{dt} = 0$：\n$$ 0 = r_{p} - \\frac{V_{\\max} S^{\\ast}}{K_{M} + S^{\\ast}} - k_{\\text{imm}} S^{\\ast} $$\n该方程表达了平衡条件：总生成通量与总清除通量完全平衡。\n$$ r_{p} = \\frac{V_{\\max} S^{\\ast}}{K_{M} + S^{\\ast}} + k_{\\text{imm}} S^{\\ast} $$\n\n为了求解 $S^{\\ast}$，需要将此代数方程重排为标准多项式形式。我们将所有项乘以分母 $(K_{M} + S^{\\ast})$：\n$$ r_{p} (K_{M} + S^{\\ast}) = V_{\\max} S^{\\ast} + k_{\\text{imm}} S^{\\ast} (K_{M} + S^{\\ast}) $$\n展开方程两边的乘积得到：\n$$ r_{p} K_{M} + r_{p} S^{\\ast} = V_{\\max} S^{\\ast} + k_{\\text{imm}} K_{M} S^{\\ast} + k_{\\text{imm}} (S^{\\ast})^{2} $$\n现在我们按 $S^{\\ast}$ 的幂次合并项，构建一个标准形式为 $a(S^{\\ast})^{2} + bS^{\\ast} + c = 0$ 的二次方程：\n$$ k_{\\text{imm}} (S^{\\ast})^{2} + (V_{\\max} + k_{\\text{imm}} K_{M} - r_{p}) S^{\\ast} - r_{p} K_{M} = 0 $$\n该二次方程的系数可确定为：\n$a = k_{\\text{imm}}$\n$b = V_{\\max} + k_{\\text{imm}} K_{M} - r_{p}$\n$c = -r_{p} K_{M}$\n\n$S^{\\ast}$ 的解可以通过二次公式得到：\n$$ S^{\\ast} = \\frac{-b \\pm \\sqrt{b^{2} - 4ac}}{2a} $$\n代入系数 $a$、$b$ 和 $c$ 的表达式：\n$$ S^{\\ast} = \\frac{-(V_{\\max} + k_{\\text{imm}} K_{M} - r_{p}) \\pm \\sqrt{(V_{\\max} + k_{\\text{imm}} K_{M} - r_{p})^{2} - 4(k_{\\text{imm}})(-r_{p} K_{M})}}{2 k_{\\text{imm}}} $$\n$$ S^{\\ast} = \\frac{-(V_{\\max} + k_{\\text{imm}} K_{M} - r_{p}) \\pm \\sqrt{(V_{\\max} + k_{\\text{imm}} K_{M} - r_{p})^{2} + 4 k_{\\text{imm}} r_{p} K_{M}}}{2 k_{\\text{imm}}} $$\n浓度必须是一个非负的物理量，因此 $S^{\\ast} \\ge 0$。由于所有动力学参数（$k_{\\text{imm}}$、$r_{p}$、$K_{M}$、$V_{\\max}$）均为正值，项 $4 k_{\\text{imm}} r_{p} K_{M}$ 严格为正。这保证了判别式为正，并且存在实数解。平方根项的绝对值将大于 $-b$ 项的绝对值。为确保 $S^{\\ast}$ 为正值（鉴于 $a = k_{\\text{imm}} > 0$），我们必须从 $\\pm$ 运算符中选择正根。\n$$ S^{\\ast} = \\frac{-(V_{\\max} + k_{\\text{imm}} K_{M} - r_{p}) + \\sqrt{(V_{\\max} + k_{\\text{imm}} K_{M} - r_{p})^{2} + 4 k_{\\text{imm}} r_{p} K_{M}}}{2 k_{\\text{imm}}} $$\n这就是稳态浓度的精确解析解。\n\n我们现在使用给定的参数进行数值计算：\n$V_{\\max} = 5.0\\,\\text{nM}\\,\\text{s}^{-1}$\n$K_{M} = 50\\,\\text{nM}$\n$k_{\\text{imm}} = 0.020\\,\\text{s}^{-1}$\n$r_{p} = 3.50\\,\\text{nM}\\,\\text{s}^{-1}$\n\n首先，我们计算系数 $a$、$b$ 和 $c$ 的数值：\n$a = k_{\\text{imm}} = 0.020$\n$b = V_{\\max} + k_{\\text{imm}} K_{M} - r_{p} = 5.0 + (0.020)(50) - 3.50 = 5.0 + 1.0 - 3.50 = 2.50$\n$c = -r_{p} K_{M} = -(3.50)(50) = -175$\n\n因此，$S^{\\ast}$ 的具体二次方程为：\n$$ 0.020(S^{\\ast})^{2} + 2.50 S^{\\ast} - 175 = 0 $$\n应用带有这些数值的二次公式：\n$$ S^{\\ast} = \\frac{-2.50 + \\sqrt{(2.50)^{2} - 4(0.020)(-175)}}{2(0.020)} $$\n$$ S^{\\ast} = \\frac{-2.50 + \\sqrt{6.25 + 14}}{0.040} $$\n$$ S^{\\ast} = \\frac{-2.50 + \\sqrt{20.25}}{0.040} $$\n$$ S^{\\ast} = \\frac{-2.50 + 4.5}{0.040} = \\frac{2.0}{0.040} = 50 $$\n计算得出的精确值为 $S^{\\ast} = 50\\,\\text{nM}$。根据问题要求四舍五入到四位有效数字，结果写为 $S^{\\ast} = 50.00\\,\\text{nM}$。\n\n最后，我们必须确定该浓度是否超过细胞毒性阈值 $C_{\\text{tox}} = 1.20 \\times 10^{2}\\,\\text{nM}$，即 $120\\,\\text{nM}$。\n直接比较显示：\n$$ S^{\\ast} = 50.00\\,\\text{nM}  120\\,\\text{nM} = C_{\\text{tox}} $$\n稳态浓度低于细胞毒性阈值。\n\n基于第一性原理的论证：稳态的概念规定系统已稳定在所有通量都平衡的状态。对于醛浓度而言，这意味着其生成速率 $r_p$ 被其通过酶降解和主动转运的清除速率之和精确抵消。我们的推导和计算确定了达到这种动态平衡的唯一、物理上可实现的浓度 $S^{\\ast}$。由于计算出的该浓度 $S^{\\ast} = 50.00\\,\\text{nM}$ 在数值上小于给定的细胞毒性阈值 $C_{\\text{tox}} = 120\\,\\text{nM}$，我们必须得出结论：在指定的生成速率和动力学参数下，细胞的联合解毒机制足以将醛维持在非毒性水平。", "answer": "$$\n\\boxed{50.00}\n$$", "id": "2740837"}, {"introduction": "基因表达的随机性导致了细胞群体内部的显著异质性，即使在遗传背景和外部环境完全相同的细胞群体中，各细胞的蛋白表达水平也可能存在巨大差异。这种变异通常可以用对数正态分布进行有效建模。本练习将指导你如何利用实验测得的群体平均值和方差，来估计表达水平超过特定功能阈值（例如触发细胞凋亡的阈值）的细胞比例 [@problem_id:2740904]。这项技能对于设计在群体水平上表现稳健的合成生物学系统至关重要，因为它将群体统计特性与单细胞的命运决策直接联系起来。", "problem": "一个合成基因线路被设计用于通过在过表达病毒模拟传感器的细胞中触发程序性细胞死亡（细胞凋亡）来减轻炎症。为限制慢性传感器激活引起的免疫原性，当传感器的转录输出超过预设阈值时，该线路会驱动一个促凋亡效应子。在携带该线路的稳定细胞系中，对与效应子共转录的荧光报告基因进行的单细胞测量，在准稳态下得到以下群体统计数据：测得的平均荧光强度为 $\\mu = 1.2 \\times 10^{5}$ 任意单位，测得的方差为 $\\sigma^{2} = 3.6 \\times 10^{9}$ 任意单位的平方。经验上，该线路基因表达的波动主要由乘性步骤（例如，转录爆发、翻译、成熟）主导，并且由于中心极限定理在对数空间中的作用，单细胞输出的瞬时分布可以被建模为对数正态分布。\n\n假设单细胞输出 $X$（荧光强度）服从对数正态分布，即 $\\ln X$ 服从正态分布。细胞凋亡模块被设计为在测量时刻当 $X$ 超过阈值 $T = 1.3 \\times 10^{5}$ 任意单位时激活。在这些假设和稳态条件下，计算在该时间点将激活细胞凋亡的细胞的期望比例。\n\n将您的答案四舍五入到四位有效数字，并以无单位小数表示。", "solution": "问题陈述已经过验证，被认为是合理的。它在科学上基于合成生物学和随机基因表达的原理，是适定的，并包含得出唯一解所需的所有信息。\n\n目标是计算将激活细胞凋亡的细胞的期望比例。这对应于单细胞输出荧光强度 $X$ 超过给定阈值 $T$ 的概率。我们已知 $X$ 服从对数正态分布。设 $X$ 的均值为 $\\mu$，方差为 $\\sigma^2$。给定的值为：\n$$ \\mu = 1.2 \\times 10^{5} $$\n$$ \\sigma^2 = 3.6 \\times 10^{9} $$\n$$ T = 1.3 \\times 10^{5} $$\n\n如果一个随机变量 $X$ 的自然对数 $Y = \\ln(X)$ 服从正态分布，那么 $X$ 就服从对数正态分布。设 $Y$ 的均值为 $\\mu_{\\ln}$，方差为 $\\sigma^2_{\\ln}$，因此 $Y \\sim \\mathcal{N}(\\mu_{\\ln}, \\sigma^2_{\\ln})$。基础正态分布的参数 $\\mu_{\\ln}$ 和 $\\sigma^2_{\\ln}$ 可以通过对数正态变量 $X$ 的均值 $\\mu$ 和方差 $\\sigma^2$ 使用以下标准关系式来确定：\n$$ \\mu = \\mathbb{E}[X] = \\exp\\left(\\mu_{\\ln} + \\frac{\\sigma^2_{\\ln}}{2}\\right) $$\n$$ \\sigma^2 = \\text{Var}(X) = \\left[\\exp(\\sigma^2_{\\ln}) - 1\\right] \\exp(2\\mu_{\\ln} + \\sigma^2_{\\ln}) $$\n第二个方程可以通过代入 $\\mu^2$ 的表达式来重写：\n$$ \\sigma^2 = \\left[\\exp(\\sigma^2_{\\ln}) - 1\\right] \\mu^2 $$\n由此，我们可以解出 $\\sigma^2_{\\ln}$：\n$$ \\frac{\\sigma^2}{\\mu^2} = \\exp(\\sigma^2_{\\ln}) - 1 $$\n$$ \\sigma^2_{\\ln} = \\ln\\left(\\frac{\\sigma^2}{\\mu^2} + 1\\right) $$\n在求出 $\\sigma^2_{\\ln}$ 后，我们可以使用 $\\mu$ 的方程来解出 $\\mu_{\\ln}$：\n$$ \\ln(\\mu) = \\mu_{\\ln} + \\frac{\\sigma^2_{\\ln}}{2} $$\n$$ \\mu_{\\ln} = \\ln(\\mu) - \\frac{\\sigma^2_{\\ln}}{2} $$\n我们需要计算概率 $P(X  T)$。这等价于计算荧光强度的对数超过阈值的对数的概率：\n$$ P(X  T) = P(\\ln(X)  \\ln(T)) = P(Y  \\ln(T)) $$\n为了计算正态变量 $Y$ 的这个概率，我们将其标准化为一个标准正态变量 $Z \\sim \\mathcal{N}(0, 1)$，其中 $Z = (Y - \\mu_{\\ln}) / \\sigma_{\\ln}$。\n$$ P(Y  \\ln(T)) = P\\left(\\frac{Y - \\mu_{\\ln}}{\\sigma_{\\ln}}  \\frac{\\ln(T) - \\mu_{\\ln}}{\\sigma_{\\ln}}\\right) = P\\left(Z  \\frac{\\ln(T) - \\mu_{\\ln}}{\\sigma_{\\ln}}\\right) $$\n这个概率可以用标准正态分布的累积分布函数 (CDF) $\\Phi(z)$ 表示为 $1 - \\Phi(z)$，或者等价地使用互补误差函数 $\\text{erfc}(z)$ 表示。\n$$ P(Z  z) = 1 - \\Phi(z) = \\frac{1}{2} \\text{erfc}\\left(\\frac{z}{\\sqrt{2}}\\right) $$\n现在，我们代入所提供的数值。首先，我们计算正态分布的参数：\n$$ \\frac{\\sigma^2}{\\mu^2} = \\frac{3.6 \\times 10^{9}}{(1.2 \\times 10^{5})^2} = \\frac{3.6 \\times 10^{9}}{1.44 \\times 10^{10}} = 0.25 $$\n$$ \\sigma^2_{\\ln} = \\ln(1 + 0.25) = \\ln(1.25) $$\n然后我们求出 CDF 的自变量，我们将其表示为 $z_{score}$：\n$$ z_{score} = \\frac{\\ln(T) - \\mu_{\\ln}}{\\sigma_{\\ln}} = \\frac{\\ln(T) - \\left[\\ln(\\mu) - \\frac{1}{2}\\sigma^2_{\\ln}\\right]}{\\sigma_{\\ln}} = \\frac{\\ln(T) - \\ln(\\mu) + \\frac{1}{2}\\sigma^2_{\\ln}}{\\sigma_{\\ln}} $$\n代入 $\\sigma^2_{\\ln}$ 和比率 $T/\\mu$ 的表达式：\n$$ z_{score} = \\frac{\\ln\\left(\\frac{T}{\\mu}\\right) + \\frac{1}{2}\\ln\\left(\\frac{\\sigma^2}{\\mu^2} + 1\\right)}{\\sqrt{\\ln\\left(\\frac{\\sigma^2}{\\mu^2} + 1\\right)}} $$\n$$ z_{score} = \\frac{\\ln\\left(\\frac{1.3 \\times 10^{5}}{1.2 \\times 10^{5}}\\right) + \\frac{1}{2}\\ln(1.25)}{\\sqrt{\\ln(1.25)}} = \\frac{\\ln\\left(\\frac{13}{12}\\right) + \\frac{1}{2}\\ln(1.25)}{\\sqrt{\\ln(1.25)}} $$\n对这些项进行数值计算：\n$$ \\ln(1.25) \\approx 0.22314355 $$\n$$ \\ln\\left(\\frac{13}{12}\\right) \\approx 0.08004271 $$\n对数转换后数据的标准差是：\n$$ \\sigma_{\\ln} = \\sqrt{\\ln(1.25)} \\approx 0.47238073 $$\n因此，$z_{score}$ 为：\n$$ z_{score} \\approx \\frac{0.08004271 + \\frac{1}{2}(0.22314355)}{0.47238073} \\approx \\frac{0.08004271 + 0.11157178}{0.47238073} = \\frac{0.19161449}{0.47238073} \\approx 0.405638 $$\n所求概率为 $P(Z  0.405638)$。使用标准正态分布表或计算工具：\n$$ P(Z  0.405638) = 1 - \\Phi(0.405638) \\approx 1 - 0.6575099 \\approx 0.3424901 $$\n按照要求将结果四舍五入到四位有效数字，我们得到 $0.3425$。这就是将激活细胞凋亡的细胞的期望比例。", "answer": "$$\n\\boxed{0.3425}\n$$", "id": "2740904"}, {"introduction": "除了代谢毒性，合成基因线路表达的外源蛋白本身也可能触发宿主的免疫反应，即免疫原性。预测蛋白质的免疫原性是合成生物学设计中的一个关键挑战，它依赖于对MHC I类抗原呈递途径的深入理解。这项实践是一个计算生物学练习，旨在指导你从基本原理出发，构建一个预测蛋白质免疫原性的计算模型，该模型整合了蛋白酶体切割、TAP转运和MHC结合这三个关键步骤 [@problem_id:2740915]。通过完成这项练习，你将能够量化评估蛋白质序列的免疫原性，并分析单个氨基酸突变可能带来的影响。", "problem": "要求您从抗原处理的第一性原理出发，形式化一个可计算的替代指标，用以量化蛋白酶体切割偏好和抗原加工相关转运体 (TAP) 转运如何塑造由合成基因线路编码的蛋白质的表位景观，然后估计单个氨基酸替换对预测免疫原性的影响。您的方法必须从分子生物学的中心法则和抗原处理通路的核心定义开始：细胞内蛋白质被蛋白酶体降解成肽，肽由 TAP 复合物转运至内质网，然后加载到I类主要组织相容性复合体 (MHC) 分子上进行呈递。假设一个 $9$-聚体表位模型，并在不使用任何外部数据库或预训练模型的情况下，形式化以下建模决策。\n\n1. 基本基础和因子分解假设。\n   - 在抗原处理的各个步骤之间使用独立性近似。具体来说，对于长度为 $L$ 的蛋白质中跨越索引 $s$ 到 $s+8$ 的任何长度为 $9$ 的候选肽，将以下各项视为独立因子：\n     - 在索引 $s$ 处的残基之前立即发生蛋白酶体切割的概率（N端切割）。\n     - 在索引 $s+8$ 处的残基之后立即发生蛋白酶体切割的概率（C端切割）。\n     - 肽被 TAP 转运到内质网的概率。\n     - 肽与I类 MHC 分子结合的相对倾向性。\n   - 假设一个肽对免疫原性的总体贡献是这些步骤因子的乘积，而一个蛋白质的总预测免疫原性是所有重叠的 $9$-聚体肽贡献的总和。\n   - 边界处理：如果 $s = 0$，则将N端切割因子定义为 $1$；如果 $s+8 = L-1$，则将C端切割因子定义为 $1$。\n\n2. 蛋白酶体切割和 TAP 转运所需的数据。\n   - 使用以下残基特异性的蛋白酶体切割倾向性。对于残基 $X$ 之前的N端切割，使用 $c_N(X)$；对于残基 $X$ 之后的C端切割，使用 $c_C(X)$。这些是 $[0,1]$ 范围内的无量纲值，应被视为概率。\n     - $c_C$: A:$0.55$, R:$0.45$, N:$0.40$, D:$0.35$, C:$0.60$, Q:$0.45$, E:$0.35$, G:$0.50$, H:$0.45$, I:$0.85$, L:$0.90$, K:$0.40$, M:$0.75$, F:$0.85$, P:$0.10$, S:$0.50$, T:$0.55$, W:$0.70$, Y:$0.80$, V:$0.80$。\n     - $c_N$: A:$0.65$, R:$0.50$, N:$0.45$, D:$0.45$, C:$0.55$, Q:$0.50$, E:$0.45$, G:$0.70$, H:$0.50$, I:$0.60$, L:$0.65$, K:$0.55$, M:$0.60$, F:$0.60$, P:$0.15$, S:$0.60$, T:$0.60$, W:$0.55$, Y:$0.55$, V:$0.60$。\n   - 使用一个残基加性的 TAP 转运分数，其中每个残基的贡献为 $w_{\\mathrm{TAP}}(X)$，并使用S形变换将总贡献映射到 $[0,1]$。每个残基的权重如下：\n     - $w_{\\mathrm{TAP}}$: A:$0.2$, R:$0.1$, N:$-0.1$, D:$-0.3$, C:$0.2$, Q:$0.0$, E:$-0.3$, G:$0.0$, H:$0.1$, I:$0.4$, L:$0.5$, K:$0.1$, M:$0.3$, F:$0.5$, P:$-0.2$, S:$0.0$, T:$0.0$, W:$0.4$, Y:$0.3$, V:$0.4$。\n     - 使用斜率参数为 $1$、截距为 $0$ 的标准逻辑函数将总 TAP 权重转换为 $[0,1]$ 范围内的概率。\n\n3. I类 MHC 结合倾向性所需的数据。\n   - 考虑一个简单的位置特异性评分矩阵 (PSSM)，用于与一个I类 MHC 等位基因相容的 $9$-聚体，该等位基因偏好在位置 $2$ 和 $9$ 具有疏水性锚定残基（例如，类似于人类白细胞抗原 (HLA)-A$^\\ast 02:01$ 的基序）。设 PSSM 在位置和残基上是加性的。对于位置 $2$ 和 $9$ 以外的位置，为脯氨酸和甘氨酸分配一个小的惩罚分数，其他情况为零。具体如下：\n     - 位置 $2$ 偏好（分数单位是任意的）： L:$1.0$, I:$0.8$, V:$0.7$, M:$0.6$, A:$0.3$, T:$0.2$, S:$0.1$；作为惩罚，P:$-1.0$, D:$-0.8$, E:$-0.8$；位置 $2$ 的所有其他残基分数为 $-0.4$。\n     - 位置 $9$ 偏好： L:$1.0$, V:$0.8$, I:$0.6$, A:$0.5$, M:$0.5$, F:$0.5$, Y:$0.6$, W:$0.4$；作为惩罚，P:$-1.0$, D:$-0.8$, E:$-0.8$；位置 $9$ 的所有其他残基分数为 $-0.3$。\n     - 对于 $\\{1,3,4,5,6,7,8\\}$ 中的位置，应用背景惩罚：P:$-0.2$，G:$-0.1$，所有其他残基为 $0$。\n   - 使用指数变换将一个 $9$-聚体的总加性 PSSM 分数映射到一个正的结合倾向性。\n\n4. 肽贡献和蛋白质免疫原性。\n   - 对于一个从索引 $s$ 开始到 $s+8$ 结束的 $9$-聚体，将其贡献定义为：N端切割因子、C端切割因子、TAP 转运概率以及根据上述 PSSM 获得的 MHC 结合倾向性的乘积。\n   - 一个蛋白质的总预测免疫原性 $I$ 是所有重叠 $9$-聚体的贡献之和。\n\n5. 单个氨基酸替换效应。\n   - 对于下面的每个测试用例，计算野生型序列的 $I_{\\text{wt}}$ 和在指定索引处（使用 $0$ 基索引）有单个氨基酸替换的序列的 $I_{\\text{mut}}$。将分数变化 $\\Delta = (I_{\\text{mut}} - I_{\\text{wt}})/I_{\\text{wt}}$ 报告为十进制数。\n   - 边缘情况约定：如果 $I_{\\text{wt}} = 0$，则定义 $\\Delta = 0.0$。\n\n6. 测试套件和所需的输出格式。\n   - 使用以下测试用例。每个测试用例是一个元组：$(\\text{sequence}, p, X \\rightarrow Y)$，其中 $0$ 基索引 $p$ 表示将位置 $p$ 的残基 $X$ 替换为残基 $Y$。\n     - 用例 $1$：$\\left(\"MALWMRLLPLLALLALWGPDPAAA\",\\; 10,\\; \\text{L} \\rightarrow \\text{P}\\right)$。\n     - 用例 $2$：$\\left(\"GAGAGAGAG\",\\; 0,\\; \\text{G} \\rightarrow \\text{P}\\right)$。\n     - 用例 $3$：$\\left(\"SYFPEITHIQLL\",\\; 11,\\; \\text{L} \\rightarrow \\text{D}\\right)$。\n     - 用例 $4$：$\\left(\"ACDEFGHI\",\\; 1,\\; \\text{C} \\rightarrow \\text{W}\\right)$。\n   - 对每个用例，计算 $\\Delta$ 并四舍五入到 $6$ 位小数。\n   - 您的程序应产生单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4\\right]$）。不应打印任何其他文本。", "solution": "问题陈述是有效的。它提出了一个定义明确、自成体系的计算建模任务，该任务基于免疫学和分子生物学中简化但科学上合理的原理。所有必要的数据、模型和边界条件都已明确提供，从而可以得到唯一且可验证的解决方案。该问题与合成生物学的特定领域直接相关，因为预测合成蛋白质的免疫原性是一项关键的设计考虑因素。\n\n任务是形式化并实现一个用于预测蛋白质免疫原性的模型，并用它来评估单个氨基酸替换的影响。该模型基于I类抗原呈递的核心通路。\n\n设一个蛋白质由长度为 $L$ 的氨基酸序列 $S$ 表示。一个候选表位是一个 $9$-聚体肽，它是 $S$ 的一个子序列。一个从基于 $0$ 的索引 $s$ 开始的通用 $9$-聚体记为 $P_s$，跨越索引 $s$ 到 $s+8$。此类肽的全集为 $\\{P_s\\}_{s=0}^{L-9}$。\n\n单个肽 $P_s$ 的免疫原性贡献（我们记作 $C(s)$）被假定为四个独立的概率或倾向性类因子的乘积：\n$$ C(s) = F_{N-term}(s) \\cdot F_{C-term}(s) \\cdot F_{TAP}(P_s) \\cdot F_{MHC}(P_s) $$\n\n这些因子根据问题陈述中指定的第一性原理定义如下：\n\n1.  **N端切割因子, $F_{N-term}(s)$**: 该量模拟在残基 $S[s]$ 之前立即发生蛋白酶体切割的可能性，这会产生肽的N端。此事件的倾向性由N端残基本身 $S[s]$ 的函数 $c_N$ 给出。对于位于蛋白质N端的肽（即 $s=0$），不需要切割来产生N端，因此该因子定义为 $1$。\n    $$ F_{N-term}(s) = \\begin{cases} 1.0  \\text{if } s = 0 \\\\ c_N(S[s])  \\text{if } s  0 \\end{cases} $$\n\n2.  **C端切割因子, $F_{C-term}(s)$**: 类似地，该因子模拟在残基 $S[s+8]$ 之后立即发生切割的可能性，这会产生肽的C端。此倾向性由C端残基 $S[s+8]$ 的函数 $c_C$ 给出。对于位于蛋白质C端的肽（即 $s+8 = L-1$），此因子定义为 $1$。\n    $$ F_{C-term}(s) = \\begin{cases} 1.0  \\text{if } s+8 = L-1 \\\\ c_C(S[s+8])  \\text{if } s+8  L-1 \\end{cases} $$\n\n3.  **TAP 转运因子, $F_{TAP}(P_s)$**: 该因子是肽 $P_s$ 被抗原加工相关转运体 (TAP) 成功转运到内质网的概率。此概率源自一个加性分数。对于肽 $P_s = p_1p_2...p_9$，其分数为残基特异性权重的总和，$W_{TAP}(P_s) = \\sum_{i=1}^{9} w_{TAP}(p_i)$。然后使用标准逻辑函数 $\\sigma(x) = (1 + e^{-x})^{-1}$（斜率为 $1$，截距为 $0$）将此总分转换为 $[0, 1]$ 范围内的概率。\n    $$ F_{TAP}(P_s) = \\sigma\\left(\\sum_{i=1}^{9} w_{TAP}(p_i)\\right) = \\frac{1}{1 + \\exp\\left(-\\sum_{i=1}^{9} w_{TAP}(p_i)\\right)} $$\n\n4.  **MHC 结合因子, $F_{MHC}(P_s)$**: 该因子代表肽 $P_s$ 与I类主要组织相容性复合体 (MHC) 分子的结合倾向性。它使用位置特异性评分矩阵 (PSSM) 计算。对于肽 $P_s = p_1p_2...p_9$，PSSM 分数是一个加性总和 $S_{MHC}(P_s) = \\sum_{i=1}^{9} M(p_i, i)$，其中 $M(p_i, i)$ 是氨基酸 $p_i$ 在位置 $i$（肽内基于 $1$ 的索引）的分数。问题为锚定位置（$2$ 和 $9$）提供了具体分数，并为其他位置提供了背景惩罚。然后使用指数变换将此分数映射到一个正的倾向性值。\n    $$ F_{MHC}(P_s) = \\exp(S_{MHC}(P_s)) $$\n\n蛋白质 $S$ 的总预测免疫原性 $I$ 是所有可能的重叠 $9$-聚体肽贡献的线性总和。\n$$ I(S) = \\sum_{s=0}^{L-9} C(s) $$\n如果蛋白质长度 $L$ 小于 $9$，则无法形成 $9$-聚体肽，因此总和是基于一个空集，得到 $I(S)=0$。\n\n最终需要计算的是由单个氨基酸替换引起的免疫原性分数变化 $\\Delta$。给定一个野生型序列 $S_{\\text{wt}}$ 和一个相应的突变型序列 $S_{\\text{mut}}$，我们计算它们各自的免疫原性 $I_{\\text{wt}} = I(S_{\\text{wt}})$ 和 $I_{\\text{mut}} = I(S_{\\text{mut}})$。分数变化则为：\n$$ \\Delta = \\frac{I_{\\text{mut}} - I_{\\text{wt}}}{I_{\\text{wt}}} $$\n对于分母为零的边缘情况，提供了一个特定规则：如果 $I_{\\text{wt}} = 0$，那么 $\\Delta$ 定义为 $0.0$。\n\n实现将包含一个主函数，该函数通过遍历所有可能的 $9$-聚体，为每个 $9$-聚体计算四因子乘积，并对结果求和，从而计算任意序列 $S$ 的 $I(S)$。对于每个测试用例，将为野生型和突变型序列调用此函数以确定 $\\Delta$。参数（$c_N, c_C, w_{TAP}$, PSSM 分数）将存储在适当的数据结构中，以便高效查找。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It calculates the fractional change in predicted immunogenicity for single amino acid substitutions.\n    \"\"\"\n    \n    # ------------------ Data Initialization ------------------\n    # Proteasomal Cleavage Propensities\n    C_C = {'A': 0.55, 'R': 0.45, 'N': 0.40, 'D': 0.35, 'C': 0.60, 'Q': 0.45, 'E': 0.35, 'G': 0.50, 'H': 0.45, 'I': 0.85, 'L': 0.90, 'K': 0.40, 'M': 0.75, 'F': 0.85, 'P': 0.10, 'S': 0.50, 'T': 0.55, 'W': 0.70, 'Y': 0.80, 'V': 0.80}\n    C_N = {'A': 0.65, 'R': 0.50, 'N': 0.45, 'D': 0.45, 'C': 0.55, 'Q': 0.50, 'E': 0.45, 'G': 0.70, 'H': 0.50, 'I': 0.60, 'L': 0.65, 'K': 0.55, 'M': 0.60, 'F': 0.60, 'P': 0.15, 'S': 0.60, 'T': 0.60, 'W': 0.55, 'Y': 0.55, 'V': 0.60}\n\n    # TAP Transport Weights\n    W_TAP = {'A': 0.2, 'R': 0.1, 'N': -0.1, 'D': -0.3, 'C': 0.2, 'Q': 0.0, 'E': -0.3, 'G': 0.0, 'H': 0.1, 'I': 0.4, 'L': 0.5, 'K': 0.1, 'M': 0.3, 'F': 0.5, 'P': -0.2, 'S': 0.0, 'T': 0.0, 'W': 0.4, 'Y': 0.3, 'V': 0.4}\n\n    # MHC Class I Binding PSSM Scores\n    PSSM_P2 = {'L': 1.0, 'I': 0.8, 'V': 0.7, 'M': 0.6, 'A': 0.3, 'T': 0.2, 'S': 0.1, 'P': -1.0, 'D': -0.8, 'E': -0.8}\n    PSSM_P2_DEFAULT = -0.4\n    PSSM_P9 = {'L': 1.0, 'V': 0.8, 'I': 0.6, 'A': 0.5, 'M': 0.5, 'F': 0.5, 'Y': 0.6, 'W': 0.4, 'P': -1.0, 'D': -0.8, 'E': -0.8}\n    PSSM_P9_DEFAULT = -0.3\n    PSSM_OTHER = {'P': -0.2, 'G': -0.1}\n    PSSM_OTHER_DEFAULT = 0.0\n\n    # ------------------ Helper Functions ------------------\n    def calculate_immunogenicity(sequence: str) -> float:\n        \"\"\"\n        Calculates the total predicted immunogenicity for a given protein sequence.\n        \"\"\"\n        L = len(sequence)\n        peptide_length = 9\n        if L  peptide_length:\n            return 0.0\n\n        total_immunogenicity = 0.0\n\n        for s in range(L - peptide_length + 1):\n            peptide = sequence[s : s + peptide_length]\n\n            # 1. N-terminal Cleavage Factor\n            if s == 0:\n                f_nterm = 1.0\n            else:\n                f_nterm = C_N[sequence[s]]\n\n            # 2. C-terminal Cleavage Factor\n            if s + peptide_length - 1 == L - 1:\n                f_cterm = 1.0\n            else:\n                f_cterm = C_C[sequence[s + peptide_length - 1]]\n\n            # 3. TAP Transport Factor\n            tap_score = sum(W_TAP[res] for res in peptide)\n            f_tap = 1.0 / (1.0 + np.exp(-tap_score))\n            \n            # 4. MHC Binding Factor\n            mhc_score = 0.0\n            for i, res in enumerate(peptide):\n                pos = i + 1 # 1-based position\n                if pos == 2:\n                    mhc_score += PSSM_P2.get(res, PSSM_P2_DEFAULT)\n                elif pos == 9:\n                    mhc_score += PSSM_P9.get(res, PSSM_P9_DEFAULT)\n                else: # Positions 1, 3, 4, 5, 6, 7, 8\n                    mhc_score += PSSM_OTHER.get(res, PSSM_OTHER_DEFAULT)\n            f_mhc = np.exp(mhc_score)\n            \n            # Combine factors for peptide contribution\n            peptide_contribution = f_nterm * f_cterm * f_tap * f_mhc\n            total_immunogenicity += peptide_contribution\n            \n        return total_immunogenicity\n\n    # ------------------ Test Cases and Main Logic ------------------\n    test_cases = [\n        (\"MALWMRLLPLLALLALWGPDPAAA\", 10, 'L', 'P'),\n        (\"GAGAGAGAG\", 0, 'G', 'P'),\n        (\"SYFPEITHIQLL\", 11, 'L', 'D'),\n        (\"ACDEFGHI\", 1, 'C', 'W'),\n    ]\n\n    results = []\n    for case in test_cases:\n        wt_seq, pos, old_aa, new_aa = case\n        \n        # Construct mutant sequence\n        mut_seq_list = list(wt_seq)\n        mut_seq_list[pos] = new_aa\n        mut_seq = \"\".join(mut_seq_list)\n\n        # Calculate immunogenicity for wt and mut\n        i_wt = calculate_immunogenicity(wt_seq)\n        i_mut = calculate_immunogenicity(mut_seq)\n\n        # Calculate fractional change delta\n        if i_wt == 0.0:\n            delta = 0.0\n        else:\n            delta = (i_mut - i_wt) / i_wt\n\n        results.append(round(delta, 6))\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2740915"}]}