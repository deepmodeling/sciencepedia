{"hands_on_practices": [{"introduction": "基于液滴的微流控技术是现代高通量单细胞分析的核心。然而，将细胞封装到液滴中的过程本质上是随机的，可以通过泊松分布进行有效建模。通过这项实践，您将推导出“双细胞”率的解析表达式，这是一个在实验设计中决定细胞通量与数据质量之间权衡的关键参数 [@problem_id:2773333]。", "problem": "在用于单细胞测量的基于液滴的单细胞封装流程中，细胞以浓度 $c$（单位为细胞数/单位体积）悬浮，并使用微流控生成器被分配到体积为 $V$ 的相同大小的液滴中。假设细胞是均匀混合并独立地进入液滴的，因此每个液滴中的细胞数 $N$ 服从均值为 $\\lambda=cV$ 的泊松分布。将“双细胞体”定义为恰好包含 $2$ 个细胞的液滴。在典型的单细胞流程中，包含 $0$ 个细胞的液滴在下游通过筛选被移除，只留下 $N \\geq 1$ 的液滴用于测量。从泊松分布的定义、归一化以及基本概率法则出发，推导被占据的液滴（即 $N \\geq 1$ 的液滴）中双细胞体所占的期望分数 $f_{\\mathrm{dbl}}(c,V)$ 的解析表达式。将你的最终答案表示为关于 $c$ 和 $V$ 的单一简化解析表达式。以小数形式（而不是百分比）报告您的结果。不要进行四舍五入。", "solution": "问题陈述需经过验证。\n\n**步骤 1：提取已知条件**\n- 细胞浓度：$c$（细胞数/单位体积）。\n- 液滴体积：$V$。\n- 每个液滴中的细胞数 $N$ 服从泊松分布。\n- 泊松分布的均值为 $\\lambda = cV$。\n- “双细胞体”定义为 $N=2$ 的液滴。\n- “被占据的液滴”是指 $N \\ge 1$ 的液滴。\n- 目标是推导被占据液滴中双细胞体所占比例 $f_{\\mathrm{dbl}}(c,V)$ 的解析表达式。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据。在微流控学和单细胞生物学中，使用泊松分布来为大小均一液滴中颗粒（如细胞）的封装过程建模，是一个标准的且经过充分验证的模型。均匀混合和独立到达的假设是该模型的基础。这个问题提法恰当，提供了推导所求量 $f_{\\mathrm{dbl}}(c,V)$ 所需的所有定义和参数（$c, V$）。其语言客观而精确。问题是自洽、一致的，并且需要基于基础概率论进行一个不平凡的推导。它没有违反任何无效性标准。\n\n**步骤 3：结论与行动**\n问题被判定为**有效**。将推导解答。\n\n给定液滴中的细胞数 $N$ 是一个服从均值为 $\\lambda = cV$ 的泊松分布的随机变量。泊松分布的概率质量函数 (PMF) 由下式给出：\n$$P(N=k) = \\frac{\\lambda^{k} \\exp(-\\lambda)}{k!}$$\n将均值的给定表达式 $\\lambda = cV$ 代入，我们得到：\n$$P(N=k) = \\frac{(cV)^{k} \\exp(-cV)}{k!}$$\n其中 $k$ 是一个非负整数，表示液滴中的细胞数。\n\n我们的任务是找出*被占据*的液滴中“双细胞体”所占的比例。一个被占据的液滴是含有一个或多个细胞（$N \\ge 1$）的液滴。一个双细胞体是恰好含有两个细胞（$N=2$）的液滴。这个比例是一个条件概率：即在一个液滴含有至少一个细胞的条件下，它含有两个细胞的概率。我们将其表示为 $f_{\\mathrm{dbl}}(c,V) = P(N=2 | N \\ge 1)$。\n\n使用条件概率的定义，$P(A|B) = \\frac{P(A \\cap B)}{P(B)}$，我们得到：\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{P(\\{N=2\\} \\cap \\{N \\ge 1\\})}{P(N \\ge 1)}$$\n事件 $\\{N=2\\}$ 是事件 $\\{N \\ge 1\\}$ 的一个子集。因此，它们的交集就是事件 $\\{N=2\\}$ 本身。该表达式简化为：\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{P(N=2)}{P(N \\ge 1)}$$\n\n现在，我们必须计算分子和分母中的概率。\n\n首先，通过在 PMF 中设置 $k=2$，可以找到液滴是双细胞体（$N=2$）的概率：\n$$P(N=2) = \\frac{(cV)^{2} \\exp(-cV)}{2!} = \\frac{(cV)^{2} \\exp(-cV)}{2}$$\n\n接下来，液滴被占据（$N \\ge 1$）的概率是液滴为空（$N=0$）的概率的补集。\n$$P(N \\ge 1) = 1 - P(N=0)$$\n通过在 PMF 中设置 $k=0$，可以找到液滴为空的概率：\n$$P(N=0) = \\frac{(cV)^{0} \\exp(-cV)}{0!} = \\frac{1 \\cdot \\exp(-cV)}{1} = \\exp(-cV)$$\n因此，液滴被占据的概率是：\n$$P(N \\ge 1) = 1 - \\exp(-cV)$$\n\n最后，我们将这些概率代回到 $f_{\\mathrm{dbl}}(c,V)$ 的表达式中：\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{P(N=2)}{P(N \\ge 1)} = \\frac{\\frac{(cV)^{2} \\exp(-cV)}{2}}{1 - \\exp(-cV)}$$\n\n为了简化这个表达式，我们可以将分子和分母同乘以 $\\exp(cV)$：\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{\\left(\\frac{(cV)^{2} \\exp(-cV)}{2}\\right) \\exp(cV)}{(1 - \\exp(-cV)) \\exp(cV)} = \\frac{\\frac{(cV)^{2}}{2}}{\\exp(cV) - 1}$$\n这就得出了被占据的液滴中双细胞体所占期望分数的最终简化解析表达式。\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{(cV)^{2}}{2(\\exp(cV) - 1)}$$\n推导完毕。", "answer": "$$\\boxed{\\frac{(cV)^{2}}{2(\\exp(cV) - 1)}}$$", "id": "2773333"}, {"introduction": "虽然液滴法很流行，但其他平台如基于微孔板的捕获方法也同样被使用，而每种方法都有其潜在的偏差来源。这项练习将引导您通过思想实验，探索如沉降和粘附等基本物理原理如何导致非随机的细胞捕获，从而系统性地扭曲实验结果。通过评估不同的定量策略，您将培养识别、建模和校正实验偏差的关键技能，以确保数据的可靠性 [@problem_id:2773291]。", "problem": "一种基于平板的单细胞捕获方案依赖于在有限的加载时间内，细胞通过重力沉降到孔中，然后粘附到孔底。考虑在静止介质中的两种哺乳动物细胞亚群的混合物：半径为 $r_{\\mathrm{s}} = 5\\,\\mu\\mathrm{m}$ 的“小”细胞类和半径为 $r_{\\mathrm{l}} = 10\\,\\mu\\mathrm{m}$ 的“大”细胞类。细胞与介质的密度差为 $\\Delta \\rho = 50\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，动态粘度为 $\\eta = 1.0 \\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$，重力加速度为 $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$，孔内液体高度为 $H = 2.0\\,\\mathrm{mm}$，加载时间窗口为 $T = 600\\,\\mathrm{s}$。假设沉降过程为蠕动流（低雷诺数），并且接触时的粘附倾向随细胞-表面接触面积的增加而增加。输入的混合物中小细胞和大细胞的数量比为 $50$–$50$，不同尺寸细胞的活力相同，悬浮液混合均匀且无对流。\n\n从第一性原理出发，解释为什么依赖于尺寸的沉降和粘附会在捕获的细胞群体中引入组成偏差，并提出可以在实验中检测和归因这种偏差的定量指标。您可以使用低雷诺数沉降的标准物理定律、标准概率定义以及单细胞分析中常用的统计工具，但不要假设任何特殊的特定于设备的技巧。\n\n下列哪些分析计划是检测和归因该偏差的适当且定量合理的方法？选择所有适用项。\n\nA. 通过估计特定尺寸的捕获概率 $p_{\\mathrm{cap}}(r)$（即在时间 $T$ 内到达底部的概率与随接触面积变化的粘附倾向的乘积）来构建一个基于机理的尺寸富集曲线，然后在不同尺寸分组上计算富集函数 $E(r) = p_{\\mathrm{cap}}(r)/p_{\\mathrm{in}}(r)$。检验 $E(r)$ 是否随 $r$ 增加，并使用输入和捕获的尺寸分布之间的双样本柯尔莫哥洛夫-斯米尔诺夫（KS）统计量来量化分布的偏移。\n\nB. 对每孔细胞数拟合泊松孔板占有模型以估计平均加载量 $\\lambda$，如果空孔的比例接近 $\\exp(-\\lambda)$，则断定没有尺寸偏差；无需进行尺寸分层或使用协变量。\n\nC. 使用逻辑回归，将二元捕获结果对流式细胞术前向散射（FSC）尺寸代理指标进行回归，其中加载时间作为已知的暴露偏移量，并检验尺寸系数是否为正。通过结合低雷诺数沉降的标度关系和一个随接触面积增加的粘附项，来校准该系数的预期符号和近似大小。\n\nD. 将捕获的细胞计数按每板捕获的总数进行归一化，并确认归一化后富集现象消失；如果归一化后的组成与输入混合物匹配，则断定不存在粘附驱动的偏差。\n\nE. 掺入已知半径范围覆盖细胞半径的聚苯乙烯微球，并记录到达孔底的延时摄影事件。根据微球数据估计到达率的尺寸指数，并将其与通过对细胞捕获时间进行生存分析推断出的指数进行比较；如果该指数与低雷诺数预测相匹配，则将偏差归因于沉降。\n\n选择所有适用项。", "solution": "首先应对问题陈述进行严格验证。\n\n### 步骤1：提取已知条件\n问题陈述中提供了以下数据和假设：\n- **系统：** 通过重力沉降和后续粘附实现的基于平板的单细胞捕获。\n- **细胞群体：** 两种亚群的混合物。\n  - 小细胞：半径 $r_{\\mathrm{s}} = 5\\,\\mu\\mathrm{m}$。\n  - 大细胞：半径 $r_{\\mathrm{l}} = 10\\,\\mu\\mathrm{m}$。\n- **输入组成：** 小细胞和大细胞数量各占 $50\\%$。\n- **物理参数：**\n  - 细胞与介质的密度差：$\\Delta \\rho = 50\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n  - 介质的动态粘度：$\\eta = 1.0 \\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$。\n  - 重力加速度：$g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$。\n- **几何与时间参数：**\n  - 孔内液体高度：$H = 2.0\\,\\mathrm{mm} = 2.0 \\times 10^{-3}\\,\\mathrm{m}$。\n  - 加载时间间隔：$T = 600\\,\\mathrm{s}$。\n- **假设：**\n  1. 沉降在蠕动流条件（低雷诺数）下发生。\n  2. 粘附倾向随细胞-表面接触面积的增加而增加。\n  3. 介质是静止的（无对流）。\n  4. 初始细胞悬浮液混合均匀（空间分布均匀）。\n  5. 不同尺寸细胞的活力相同。\n\n### 步骤2：使用提取的已知条件进行验证\n根据所需标准对问题进行评估。\n- **科学依据：** 该问题基于成熟的斯托克斯定律，该定律描述了球体在低雷诺数下在粘性流体中的沉降。物理参数对于水性介质中的哺乳动物细胞是符合实际的。粘附倾向随接触面积变化的假设是一个合理的物理假设。\n- **良态问题：** 该问题提供了足够的信息来分析物理过程及其统计后果。问题清晰，要求基于第一性原理进行解释并评估所提出的方法。\n- **客观性：** 问题使用精确、定量的语言陈述，不含主观性。\n\n让我们验证低雷诺数假设。沉降球体的终端速度 $v_t$ 由平衡净重力 $F_g = (\\rho_{cell} - \\rho_{medium}) V g = \\Delta \\rho (\\frac{4}{3}\\pi r^3) g$ 和斯托克斯阻力 $F_d = 6\\pi\\eta r v_t$ 决定。这得出：\n$$v_t = \\frac{2 \\Delta \\rho g}{9 \\eta} r^2$$\n对于较大的细胞（$r_{\\mathrm{l}} = 10 \\times 10^{-6}\\,\\mathrm{m}$），速度为：\n$$v_{t,l} = \\frac{2 (50\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}) (9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2})}{9 (1.0 \\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s})} (10 \\times 10^{-6}\\,\\mathrm{m})^2 \\approx 1.09 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$\n雷诺数是 $Re = \\frac{\\rho_{medium} v_t (2r)}{\\eta}$。假设介质密度约等于水的密度，$\\rho_{medium} \\approx 1000\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$：\n$$Re_l = \\frac{(1000\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}) (1.09 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}) (2 \\times 10 \\times 10^{-6}\\,\\mathrm{m})}{1.0 \\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}} \\approx 2.2 \\times 10^{-4}$$\n由于 $Re_l \\ll 1$，蠕动流假设是完全合理的。该问题没有科学上的不健全、不完整或含糊之处。\n\n### 步骤3：结论与行动\n问题陈述是**有效**的。将推导解答。\n\n---\n### 偏差的第一性原理分析\n\n组成偏差源于任何捕获概率依赖于细胞内在属性（在此案例中是其尺寸，即半径 $r$）的过程。总捕获概率 $p_{\\mathrm{cap}}(r)$ 可以建模为两个独立概率的乘积：在加载时间 $T$ 内到达孔底的概率 $P_{\\mathrm{reach}}(r, T)$ 和接触后粘附的概率 $P_{\\mathrm{adhere}}(r)$。\n\n$$p_{\\mathrm{cap}}(r) = P_{\\mathrm{reach}}(r, T) \\cdot P_{\\mathrm{adhere}}(r)$$\n\n我们分析每一项对尺寸的依赖性。\n\n**1. 沉降偏差（$P_{\\mathrm{reach}}$）：**\n终端沉降速度为 $v_t(r) = \\frac{2 \\Delta \\rho g}{9 \\eta} r^2$。这显示出对尺寸的强依赖性：$v_t \\propto r^2$。一个从初始高度 $h$（$0 \\le h \\le H$）开始的细胞将在时间 $t = h/v_t(r)$ 到达底部。为了成为被捕获的候选者，细胞必须在加载时间 $T$ 内到达底部，即 $h/v_t(r) \\le T$。这意味着细胞必须从一个高度 $h \\le v_t(r) T$ 开始。设 $h_{\\mathrm{max}}(r) = v_t(r) T$ 为半径为 $r$ 的细胞能够成功沉降的最大初始高度。\n由于初始悬浮液是混合均匀的，细胞从成功体积（高度）内开始的概率是该高度与总高度的比率：\n$$P_{\\mathrm{reach}}(r, T) = \\min\\left(1, \\frac{h_{\\mathrm{max}}(r)}{H}\\right) = \\min\\left(1, \\frac{v_t(r) T}{H}\\right)$$\n让我们为这两种细胞类型计算这个值：\n- **大细胞（$r_{\\mathrm{l}} = 10\\,\\mu\\mathrm{m}$）：**\n  $v_{t,l} \\approx 1.09 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。从最大高度 $H$ 沉降所需时间为 $t_{settle,l} = H/v_{t,l} = (2.0 \\times 10^{-3}\\,\\mathrm{m}) / (1.09 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}) \\approx 184\\,\\mathrm{s}$。\n  由于 $t_{settle,l}  T = 600\\,\\mathrm{s}$，所有大细胞，无论其初始位置如何，都将到达底部。因此，$P_{\\mathrm{reach}}(r_{\\mathrm{l}}, T) = 1$。\n- **小细胞（$r_{\\mathrm{s}} = 5\\,\\mu\\mathrm{m}$）：**\n  速度与 $r^2$ 成正比，因此 $v_{t,s} = v_{t,l} (\\frac{r_s}{r_l})^2 = v_{t,l} (\\frac{5}{10})^2 = v_{t,l}/4 \\approx 2.73 \\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n  从高度 $H$ 沉降所需时间为 $t_{settle,s} = H/v_{t,s} \\approx (2.0 \\times 10^{-3}\\,\\mathrm{m}) / (2.73 \\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}) \\approx 734\\,\\mathrm{s}$。\n  由于 $t_{settle,s} > T = 600\\,\\mathrm{s}$，只有一部分小细胞会到达底部。最大高度为 $h_{\\mathrm{max}}(r_s) = v_{t,s} T = (2.73 \\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1})(600\\,\\mathrm{s}) = 1.64 \\times 10^{-3}\\,\\mathrm{m}$。\n  概率为 $P_{\\mathrm{reach}}(r_{\\mathrm{s}}, T) = h_{\\mathrm{max}}(r_s)/H = (1.64 \\times 10^{-3}\\,\\mathrm{m}) / (2.0 \\times 10^{-3}\\,\\mathrm{m}) \\approx 0.82$。\n$P_{\\mathrm{reach}}$ 的这种差异引入了有利于捕获大细胞的显著偏差。\n\n**2. 粘附偏差（$P_{\\mathrm{adhere}}$）：**\n问题陈述指出，粘附倾向随细胞-表面接触面积的增加而增加。对于球形细胞，在平坦表面上轻微变形时的接触面积 $A_c$ 是其半径 $r$ 的增函数。一个简单的模型可以是 $A_c \\propto r^2$。如果我们假设 $P_{\\mathrm{adhere}}(r)$ 与该接触面积成正比（或与其成某个其他单调递增函数关系），那么到达底部的大细胞将比小细胞有更高的粘附概率。因此，$P_{\\mathrm{adhere}}(r)$ 是 $r$ 的增函数。\n\n**综合效应：**\n$P_{\\mathrm{reach}}(r, T)$ 和 $P_{\\mathrm{adhere}}(r)$ 都是 $r$ 的非递减函数，并且至少有一个在相关半径范围内是严格递增的。因此，总捕获概率 $p_{\\mathrm{cap}}(r)$ 是 $r$ 的严格增函数。这将导致与输入的 $50$-$50$ 混合物相比，捕获的细胞群体中大细胞更为富集。\n\n### 分析计划评估\n\n**A. 构建一个基于机理的尺寸富集曲线...**\n该提议涉及将捕获概率 $p_{\\mathrm{cap}}(r)$ 建模为沉降和粘附概率的乘积，这与第一性原理分析完全一致。富集函数通常定义为输出尺寸分布与输入尺寸分布之比，它将与此 $p_{\\mathrm{cap}}(r)$ 成正比。检验此函数是否随 $r$ 增加是偏差假说的直接检验。此外，采用双样本柯尔莫哥洛夫-斯米尔诺夫（KS）检验是一种标准的非参数方法，用于正式检验输入和捕获的尺寸分布是否存在统计学上的差异。该计划在机理上合理且在统计上严谨。\n**结论：正确。**\n\n**B. 拟合泊松孔板占有模型...**\n泊松孔板占有模型描述了在孔中发现 $k$ 个细胞的概率，$P(k) = \\frac{\\lambda^k e^{-\\lambda}}{k!}$，其中 $\\lambda$ 是每孔的平均细胞数。该模型可用于评估细胞加载质量（例如，区分随机加载和聚集）和估计总体捕获效率。然而，该模型完全忽略了细胞尺寸等属性。参数 $\\lambda$ 聚合了所有细胞类型。每孔细胞数的分布可能完全遵循泊松分布，但捕获的群体可能全部是100%的大细胞。该方法从根本上无法检测或量化组成偏差。声称不需要尺寸分层是错误的。\n**结论：不正确。**\n\n**C. 将二元捕获结果对流式细胞术前向散射（FSC）尺寸代理指标进行回归...**\n这描述了一种强大的统计方法。对于输入群体中的每个细胞（可在加载前通过FSC表征），结果是二元的：捕获（$1$）或未捕获（$0$）。逻辑回归是用于将此二元结果建模为协变量函数的适当统计工具。模型将是 $\\mathrm{logit}(p_{\\mathrm{cap}}) = \\beta_0 + \\beta_1 \\cdot \\mathrm{FSC}$。FSC是细胞尺寸的常用代理指标。一个为正且统计显著的系数 $\\beta_1$ 将提供定量证据，表明较大的细胞有更高的捕获概率。该提议的第二部分，即通过将估计的系数与从物理模型（$v_t \\propto r^2$ 和粘附 $\\propto r^x$）推导出的期望值进行比较来“校准”模型，代表了统计推断和物理建模的绝佳结合。它将分析从单纯的相关性提升为一个经过验证的定量模型。\n**结论：正确。**\n\n**D. 将捕获的细胞计数归一化...**\n该提议基于对“归一化”和“富集”在此背景下含义的误解。将捕获的细胞计数按捕获的总数进行归一化，仅能得出*捕获*群体的分数组成。例如，如果捕获了 $N_s$ 个小细胞和 $N_l$ 个大细胞，归一化后的计数为 $N_s/(N_s+N_l)$ 和 $N_l/(N_s+N_l)$。这是输出分布。声称“归一化后富集现象消失”是一个无意义的同义反复。分析需要将此归一化的输出组成与已知的输入组成（$50\\%$-$50\\%$）进行比较。最后有缺陷的一步是结论：“如果归一化后的组成与输入混合物匹配，则断定不存在粘附驱动的偏差”。这是不正确的，因为（1）它忽略了显著的沉降偏差，以及（2）缺乏*净*偏差并不意味着不存在组成偏差，这些偏差原则上可能相互抵消。整个计划在方法上是有缺陷的。\n**结论：不正确。**\n\n**E. 掺入聚苯乙烯微球...**\n这描述了一种精密的实验设计，用于解构两个偏差来源：沉降和粘附。聚苯乙烯微球是生物粘附的绝佳阴性对照；它们根据其尺寸和密度沉降，但与表面的相互作用方式与细胞不同。使用延时成像记录到达事件可以直接测量沉降动力学。通过测量到达率作为微球半径的函数，可以确定实验标度指数，并验证其是否与斯托克斯定律的理论 $r^2$ 相匹配。将相同的分析（例如，对到达/捕获时间的生存分析）应用于细胞，可以进行直接比较。如果细胞到达的尺寸依赖性与微球和理论相匹配，那么过程中的沉降部分就得到了很好的理解。*到达*底部的细胞组成与最终*捕获*的细胞组成之间的任何进一步偏差，则可归因于尺寸依赖的粘附。这是一种将偏差归因于其物理起源的强大方法。\n**结论：正确。**", "answer": "$$\\boxed{ACE}$$", "id": "2773291"}, {"introduction": "单细胞转录组学中一个普遍的挑战是如何解读零计数：一个零代表基因未表达（生物学零），还是仅仅因为技术原因未能检测到（技术性零）？本练习利用外参（spike-in）控制和贝叶斯推断，为此问题建立了一个定量模型。您将学习如何估计实验的技术检测效率，并用它来计算观测到的零计数值属于生物学零的后验概率，这是进行稳健下游分析的关键一步 [@problem_id:2773320]。", "problem": "您正在设计一种基于spike-in的、有原则的计算测试方法，用于在单细胞转录测量中区分技术性未检出和真正的生物性缺失，并量化批次特异性的检测效率。假设以下基本前提。第一，由于稀释和分配，每个细胞中引入的spike-in分子是独立分布的，遵循泊松定律；具体来说，对于spike-in种类 $j$，每个细胞中引入的分子数 $N_j$ 服从均值为 $\\mu_j$ 的泊松分布。第二，每个单独的分子（spike-in或内源性的）被捕获和检测的过程是独立的，其批次特异性检测效率为 $\\eta_b \\in [0,1]$，这是批次 $b$ 中单个分子的捕获和检测概率。第三，泊松稀疏化成立：如果 $N \\sim \\mathrm{Poisson}(\\mu)$ 并且每个事件以概率 $\\eta$被独立保留，那么保留的计数 $K$ 服从 $\\mathrm{Poisson}(\\eta \\mu)$ 分布。第四，对于给定细胞中的一个内源性基因，将其“开-关”生物学行为建模为一个混合模型：基因有先验概率 $\\pi$ 处于关闭状态（生物性零，真实分子数恰好为零），并有先验概率 $(1-\\pi)$ 处于开启状态，在该细胞中其期望输入（技术损失前）固定为 $\\mu_{\\mathrm{on}}$ 个分子。第五，使用贝叶斯法则，根据观测到一个内源性基因的测量计数为零的情况，计算后验概率。\n\n您的任务是实现一个程序，对于每个提供的测试用例，从第一性原理出发完成以下所有任务：\n- 仅使用上述基本前提，从该批次的spike-in测量值 $(\\mu_j, k_j)$（跨越不同spike-in种类 $j$）中，推导并计算批次检测效率 $\\eta_b$ 的最大似然估计。\n- 对于每个提供的观测到的内源性零值，使用该批次估计的 $\\eta_b$、基因的 $\\mu_{\\mathrm{on}}$ 和先验概率 $\\pi$，推导并计算其为技术性零（即基因处于开启状态但未检测到分子）与生物性零（即基因确实处于关闭状态）的后验概率。\n- 对于任何包含多个批次的测试用例，计算批次间的相对效率，即比率 $\\eta_{b_2}/\\eta_{b_1}$，其中 $b_1$ 是该测试用例中列出的第一个批次，$b_2$ 是第二个。\n\n本问题中的所有量纲都是一致且科学上真实的。分子数量 $\\mu$ 的单位是“分子/细胞”；检测效率和概率是位于 $[0,1]$ 区间的无量纲值。您必须将所有报告的概率和效率表示为小数（而非百分比）。将所有报告的输出四舍五入到 $6$ 位小数。\n\n将您的解决方案实现为一个完整的、可运行的程序，不需要用户输入。硬编码以下测试套件，并按指定的确切顺序生成所需输出。对于每个测试用例，输入是一组spike-in，其每个细胞的已知泊松均值和观测到的检测计数，以及一个内源性零观测列表，每个都带有其 $(\\mu_{\\mathrm{on}}, \\pi)$。\n\n测试用例 #1（单批次）：\n- 批次 $B_1$ 的spike-in：均值 $\\{\\mu_j\\} = \\{50, 100, 200\\}$ 分子/细胞；观测到的检测计数 $\\{k_j\\} = \\{18, 40, 83\\}$ 分子。\n- $B_1$ 中待分类的内源性零值：$(\\mu_{\\mathrm{on}}, \\pi)$ 对 $\\{(5.0, 0.2), (0.5, 0.8)\\}$。\n\n测试用例 #1 的要求输出：\n$[\\eta_{B_1}, \\; P_{\\mathrm{tech}}(\\text{first zero in } B_1), \\; P_{\\mathrm{tech}}(\\text{second zero in } B_1)]$。\n\n测试用例 #2（具有极端计数的单批次）：\n- 批次 $B_1$ 的spike-in：均值 $\\{\\mu_j\\} = \\{80, 160\\}$ 分子/细胞；观测到的检测计数 $\\{k_j\\} = \\{0, 0\\}$ 分子。\n- $B_1$ 中待分类的内源性零值：$(\\mu_{\\mathrm{on}}, \\pi)$ 对 $\\{(2.0, 0.5), (10.0, 0.1)\\}$。\n\n测试用例 #2 的要求输出：\n$[\\eta_{B_1}, \\; P_{\\mathrm{tech}}(\\text{first zero in } B_1), \\; P_{\\mathrm{tech}}(\\text{second zero in } B_1)]$。\n\n测试用例 #3（两个批次与跨批次比较）：\n- 批次 $B_1$ 的spike-in：均值 $\\{\\mu_j\\} = \\{20, 60, 120\\}$ 分子/细胞；观测到的检测计数 $\\{k_j\\} = \\{12, 34, 65\\}$ 分子。\n- 批次 $B_2$ 的spike-in：均值 $\\{\\mu_j\\} = \\{20, 60, 120\\}$ 分子/细胞；观测到的检测计数 $\\{k_j\\} = \\{8, 18, 40\\}$ 分子。\n- 待分类的内源性零值：对于 $B_1$ 使用 $(\\mu_{\\mathrm{on}}, \\pi) = (3.0, 0.3)$；对于 $B_2$ 使用 $(\\mu_{\\mathrm{on}}, \\pi) = (3.0, 0.3)$。\n\n测试用例 #3 的要求输出：\n$[\\eta_{B_1}, \\; \\eta_{B_2}, \\; \\eta_{B_2}/\\eta_{B_1}, \\; P_{\\mathrm{tech}}(\\text{zero in } B_1), \\; P_{\\mathrm{tech}}(\\text{zero in } B_2)]$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含所有测试用例的结果，按顺序串联，形式为方括号内由逗号分隔的列表：\n$[\\text{TC1 outputs}, \\text{TC2 outputs}, \\text{TC3 outputs}]$。\n每个条目必须是四舍五入到 $6$ 位小数的小数。例如，您的输出必须具有以下结构\n$[\\eta_{B_1}^{(1)}, P_{\\mathrm{tech},1}^{(1)}, P_{\\mathrm{tech},2}^{(1)}, \\eta_{B_1}^{(2)}, P_{\\mathrm{tech},1}^{(2)}, P_{\\mathrm{tech},2}^{(2)}, \\eta_{B_1}^{(3)}, \\eta_{B_2}^{(3)}, \\eta_{B_2}^{(3)}/\\eta_{B_1}^{(3)}, P_{\\mathrm{tech}}^{(3,B_1)}, P_{\\mathrm{tech}}^{(3,B_2)}]$。", "solution": "问题陈述已经过评估，被认为是有效的。它具有科学依据、自成体系且定义明确。先验假设，包括spike-in分布的泊松性质和泊松稀疏化原理，对于建模单细胞计数实验是标准且正确的。内源性基因表达模型，一个零膨胀混合模型，是一种常规且适当的简化。关于内源性基因‘开启’状态分布的一个微小模糊之处，通过在此背景下采用最合乎逻辑和标准的解释得以解决：即分子数量遵循指定均值为 $\\mu_{\\mathrm{on}}$ 的泊松分布。这一假设使得严谨而完整的解决方案成为可能。我们从第一性原理开始推导。\n\n解决方案分为三部分构建：首先，推导批次特异性检测效率 $\\eta_b$ 的最大似然估计；其次，使用贝叶斯法则推导技术性零的后验概率；第三，相对效率的简单计算。\n\n**第1部分：批次检测效率的最大似然估计 ($\\hat{\\eta}_b$)**\n\n给定对于一个spike-in种类 $j$，输入分子数是一个随机变量 $N_j \\sim \\mathrm{Poisson}(\\mu_j)$。这些分子中的每一个都以概率 $\\eta_b$ 被独立检测。因此，根据所提供的泊松稀疏化特性，得到的观测计数 $k_j$ 是一个遵循均值为 $\\eta_b \\mu_j$ 的泊松分布的随机变量。\n$$ k_j \\sim \\mathrm{Poisson}(\\eta_b \\mu_j) $$\n单个观测值 $k_j$ 的概率质量函数为：\n$$ P(k_j | \\eta_b, \\mu_j) = \\frac{e^{-\\eta_b \\mu_j} (\\eta_b \\mu_j)^{k_j}}{k_j!} $$\n假设对 $J$ 个不同spike-in种类的测量是独立事件，那么对于一组观测值 $\\{k_1, k_2, \\dots, k_J\\}$，在已知均值 $\\{\\mu_1, \\mu_2, \\dots, \\mu_J\\}$ 的条件下，其联合似然函数 $L$ 是各个概率的乘积：\n$$ L(\\eta_b) = \\prod_{j=1}^{J} P(k_j | \\eta_b, \\mu_j) = \\prod_{j=1}^{J} \\frac{e^{-\\eta_b \\mu_j} (\\eta_b \\mu_j)^{k_j}}{k_j!} $$\n为便于分析，我们使用对数似然函数 $\\ln L(\\eta_b)$：\n$$ \\ln L(\\eta_b) = \\sum_{j=1}^{J} \\ln \\left( \\frac{e^{-\\eta_b \\mu_j} (\\eta_b \\mu_j)^{k_j}}{k_j!} \\right) $$\n$$ \\ln L(\\eta_b) = \\sum_{j=1}^{J} \\left( -\\eta_b \\mu_j + k_j \\ln(\\eta_b \\mu_j) - \\ln(k_j!) \\right) $$\n$$ \\ln L(\\eta_b) = \\sum_{j=1}^{J} \\left( -\\eta_b \\mu_j + k_j \\ln(\\eta_b) + k_j \\ln(\\mu_j) - \\ln(k_j!) \\right) $$\n$$ \\ln L(\\eta_b) = -\\eta_b \\sum_{j=1}^{J} \\mu_j + \\ln(\\eta_b) \\sum_{j=1}^{J} k_j + \\sum_{j=1}^{J} (k_j \\ln(\\mu_j) - \\ln(k_j!)) $$\n为了找到最大似然估计 $\\hat{\\eta}_b$，我们将 $\\ln L(\\eta_b)$ 对 $\\eta_b$求导，并令结果为零。不依赖于 $\\eta_b$ 的项会消失。\n$$ \\frac{d}{d\\eta_b} \\ln L(\\eta_b) = - \\sum_{j=1}^{J} \\mu_j + \\frac{1}{\\eta_b} \\sum_{j=1}^{J} k_j $$\n令导数为零以找到临界点：\n$$ - \\sum_{j=1}^{J} \\mu_j + \\frac{1}{\\hat{\\eta}_b} \\sum_{j=1}^{J} k_j = 0 $$\n求解 $\\hat{\\eta}_b$ 得到估计量：\n$$ \\hat{\\eta}_b = \\frac{\\sum_{j=1}^{J} k_j}{\\sum_{j=1}^{J} \\mu_j} $$\n该结果表明，最可能的检测效率是计数的分子总数与预期的分子总数之比。二阶导数 $\\frac{d^2}{d\\eta_b^2} \\ln L(\\eta_b) = -\\frac{1}{\\eta_b^2} \\sum_{j=1}^{J} k_j$ 对于任何非零计数均为负，这证实了该解对应一个最大值。\n\n**第2部分：技术性零的后验概率**\n\n我们被要求计算一个内源性基因的观测零计数是“技术性零”（基因开启，但未检测到分子）与“生物性零”（基因关闭）的后验概率。\n\n我们来定义相关事件：\n- $S_{\\mathrm{on}}$：基因处于‘开启’状态。其先验概率为 $P(S_{\\mathrm{on}}) = 1 - \\pi$。\n- $S_{\\mathrm{off}}$：基因处于‘关闭’状态。其先验概率为 $P(S_{\\mathrm{off}}) = \\pi$。\n- $K=0$：基因的观测计数为零。\n\n我们寻求后验概率 $P(S_{\\mathrm{on}} | K=0)$，即技术性零的概率。使用贝叶斯定理：\n$$ P(S_{\\mathrm{on}} | K=0) = \\frac{P(K=0 | S_{\\mathrm{on}}) P(S_{\\mathrm{on}})}{P(K=0)} $$\n分母是观测到零的总概率，由全概率公式给出：\n$$ P(K=0) = P(K=0 | S_{\\mathrm{on}}) P(S_{\\mathrm{on}}) + P(K=0 | S_{\\mathrm{off}}) P(S_{\\mathrm{off}}) $$\n我们必须确定条件概率（似然）：\n1.  $P(K=0 | S_{\\mathrm{off}})$：如果基因是关闭的，真实的分子数恰好为 $0$。因此，观测到的计数也必须是 $0$。所以，$P(K=0 | S_{\\mathrm{off}}) = 1$。\n2.  $P(K=0 | S_{\\mathrm{on}})$：如果基因是开启的，我们假设初始分子数遵循均值为 $\\mu_{\\mathrm{on}}$ 的泊松分布。经过以检测效率 $\\eta_b$ 为特征的技术损失后，观测到的计数 $K$ 遵循一个稀疏化的泊松分布，$K \\sim \\mathrm{Poisson}(\\eta_b \\mu_{\\mathrm{on}})$。那么观测到 $K=0$ 的概率是：\n    $$ P(K=0 | S_{\\mathrm{on}}) = \\frac{e^{-\\eta_b \\mu_{\\mathrm{on}}} (\\eta_b \\mu_{\\mathrm{on}})^0}{0!} = e^{-\\eta_b \\mu_{\\mathrm{on}}} $$\n\n将这些组成部分代回到 $P(K=0)$ 的公式中：\n$$ P(K=0) = (e^{-\\eta_b \\mu_{\\mathrm{on}}})(1 - \\pi) + (1)(\\pi) = e^{-\\eta_b \\mu_{\\mathrm{on}}} (1-\\pi) + \\pi $$\n最后，我们将所有项代入贝叶斯定理，以求得技术性零的后验概率，我们将其表示为 $P_{\\mathrm{tech}}$：\n$$ P_{\\mathrm{tech}} = P(S_{\\mathrm{on}} | K=0) = \\frac{e^{-\\eta_b \\mu_{\\mathrm{on}}} (1 - \\pi)}{e^{-\\eta_b \\mu_{\\mathrm{on}}} (1 - \\pi) + \\pi} $$\n该表达式将使用第1部分中估计出的效率 $\\hat{\\eta}_b$ 进行计算。\n\n**第3部分：相对效率**\n\n对于涉及两个批次 $b_1$ 和 $b_2$ 的测试用例，相对检测效率计算为它们估计效率的简单比率：\n$$ \\text{Relative Efficiency} = \\frac{\\hat{\\eta}_{b_2}}{\\hat{\\eta}_{b_1}} $$\n仅当 $\\hat{\\eta}_{b_1}  0$ 时，该比率才有意义。\n\n下面实现了这些推导出的公式，以解决指定的测试用例。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the quantitative biology problem based on first principles for spike-in analysis.\n    The solution is structured by test case as specified in the problem statement.\n    \"\"\"\n\n    results = []\n\n    # Helper function to calculate the posterior probability of a technical zero.\n    # P_tech = P(gene is ON | observed count is 0)\n    def calculate_p_tech(eta, mu_on, pi):\n        \"\"\"\n        Calculates the posterior probability of a technical zero given an observed zero count.\n\n        Args:\n            eta (float): The estimated detection efficiency for the batch.\n            mu_on (float): The expected molecule count when the gene is 'on'.\n            pi (float): The prior probability that the gene is 'off' (biological zero).\n\n        Returns:\n            float: The posterior probability of a technical zero.\n        \"\"\"\n        # P(K=0 | ON) = exp(-eta * mu_on)\n        p_k0_given_on = np.exp(-eta * mu_on)\n        \n        # P(ON) = 1 - pi\n        p_on = 1.0 - pi\n        \n        # P(OFF) = pi\n        p_off = pi\n        \n        # P(K=0 | OFF) = 1\n        # Denominator P(K=0) = P(K=0|ON)P(ON) + P(K=0|OFF)P(OFF)\n        p_k0 = p_k0_given_on * p_on + 1.0 * p_off\n        \n        # Bayes' Rule: P(ON|K=0) = P(K=0|ON)P(ON) / P(K=0)\n        if p_k0 == 0:\n            # This case should not occur unless pi=0 and p_k0_given_on=0.\n            # If it does, the probability is technically undefined, but\n            # approaching this limit suggests the numerator is zero faster.\n            return 0.0\n\n        p_on_given_k0 = (p_k0_given_on * p_on) / p_k0\n        return p_on_given_k0\n\n    # --- Test Case #1 ---\n    # Batch B1 spike-ins\n    b1_mus_tc1 = [50, 100, 200]\n    b1_ks_tc1 = [18, 40, 83]\n    \n    # Calculate eta_b1\n    eta_b1_tc1 = sum(b1_ks_tc1) / sum(b1_mus_tc1)\n    results.append(round(eta_b1_tc1, 6))\n    \n    # Endogenous zeros for B1\n    # Zero 1: (mu_on=5.0, pi=0.2)\n    p_tech_1_tc1 = calculate_p_tech(eta_b1_tc1, 5.0, 0.2)\n    results.append(round(p_tech_1_tc1, 6))\n    \n    # Zero 2: (mu_on=0.5, pi=0.8)\n    p_tech_2_tc1 = calculate_p_tech(eta_b1_tc1, 0.5, 0.8)\n    results.append(round(p_tech_2_tc1, 6))\n\n    # --- Test Case #2 ---\n    # Batch B1 spike-ins (extreme counts)\n    b1_mus_tc2 = [80, 160]\n    b1_ks_tc2 = [0, 0]\n\n    # Calculate eta_b1\n    eta_b1_tc2 = sum(b1_ks_tc2) / sum(b1_mus_tc2) if sum(b1_mus_tc2) > 0 else 0.0\n    results.append(round(eta_b1_tc2, 6))\n    \n    # Endogenous zeros for B1\n    # Zero 1: (mu_on=2.0, pi=0.5)\n    p_tech_1_tc2 = calculate_p_tech(eta_b1_tc2, 2.0, 0.5)\n    results.append(round(p_tech_1_tc2, 6))\n\n    # Zero 2: (mu_on=10.0, pi=0.1)\n    p_tech_2_tc2 = calculate_p_tech(eta_b1_tc2, 10.0, 0.1)\n    results.append(round(p_tech_2_tc2, 6))\n\n    # --- Test Case #3 ---\n    # Batch B1 spike-ins\n    b1_mus_tc3 = [20, 60, 120]\n    b1_ks_tc3 = [12, 34, 65]\n    eta_b1_tc3 = sum(b1_ks_tc3) / sum(b1_mus_tc3)\n    results.append(round(eta_b1_tc3, 6))\n\n    # Batch B2 spike-ins\n    b2_mus_tc3 = [20, 60, 120]\n    b2_ks_tc3 = [8, 18, 40]\n    eta_b2_tc3 = sum(b2_ks_tc3) / sum(b2_mus_tc3)\n    results.append(round(eta_b2_tc3, 6))\n\n    # Relative efficiency\n    relative_efficiency = eta_b2_tc3 / eta_b1_tc3 if eta_b1_tc3 > 0 else 0.0\n    results.append(round(relative_efficiency, 6))\n    \n    # Endogenous zeros for B1 and B2\n    # Zero for B1: (mu_on=3.0, pi=0.3)\n    p_tech_b1_tc3 = calculate_p_tech(eta_b1_tc3, 3.0, 0.3)\n    results.append(round(p_tech_b1_tc3, 6))\n    \n    # Zero for B2: (mu_on=3.0, pi=0.3)\n    p_tech_b2_tc3 = calculate_p_tech(eta_b2_tc3, 3.0, 0.3)\n    results.append(round(p_tech_b2_tc3, 6))\n    \n    # Final combined output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2773320"}]}