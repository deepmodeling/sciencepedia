{"hands_on_practices": [{"introduction": "在对生物体进行种系基因编辑后，一个关键步骤是评估编辑后的等位基因传递给下一代的可能性。本练习将基本的概率论原理应用于模拟CRISPR介导的等位基因的遗传过程。通过推导在配子样本中找到至少一个经过编辑的配子的概率 [@problem_id:2802363]，您将巩固对嵌合体创始人中群体水平等位基因频率如何转化为遗传概率的理解，这是建立稳定编辑品系的核心概念。", "problem": "一个创始生物体经受了CRISPR-Cas9基因组编辑，该编辑靶向其生殖系中的单个常染色体基因座。发育后，对性腺组织的深度测序估计，在参与配子生成的单倍体基因组中，编辑后的等位基因所占比例为 $f$。假设减数分裂遵循随机分配定律，且抽样得到的配子是从一个非常大的配子池中独立抽取的，因此每个配子独立地携带编辑后等位基因，其概率为 $f$。一位研究人员从该池中随机抽取 $n$ 个成熟配子，以筛查是否存在该编辑。\n\n仅根据以下基本原理和定义：(i) 减数分裂产生单倍体配子，其中等位基因随机分离；(ii) 在参与配子生成的单倍体基因组中，估计的等位基因比例 $f$ 可被解释为随机选择的单个配子携带编辑后等位基因的概率；(iii) 独立试验的概率相乘；(iv) 一个事件的互补事件的概率等于一减去该事件本身的概率，请推导出一个关于 $f$ 和 $n$ 的闭式解析表达式，用于表示在 $n$ 个抽样配子中至少有一个携带编辑后等位基因的概率。\n\n将最终答案表示为关于 $f$ 和 $n$ 的单个简化解析表达式。无需单位。请勿提供数值近似值。", "solution": "该问题陈述已经过严格验证，并被认为是有效的。它具有科学依据，提法明确，客观且内部一致。它基于遗传学和概率论的既定原则，提供了一个可形式化的场景，不包含任何事实错误、歧义或矛盾。任务是从第一性原理出发推导一个表达式，这是定量科学中一个标准且有意义的练习。\n\n设 $A$ 为“$n$ 个抽样配子中至少有一个携带编辑后等位基因”的事件。目标是求出此事件的概率 $P(A)$。\n\n直接计算 $P(A)$ 需要将观察到恰好 $k$ 个编辑后配子的概率对所有从 $1$ 到 $n$ 的 $k$ 值进行求和：\n$$P(A) = \\sum_{k=1}^{n} P(\\text{exactly } k \\text{ edited gametes})$$\n这是一条正确但过于复杂的路径。一种更有效的推导方法是利用互补原理，这也是问题陈述中提供的四个基本原理之一。\n\n设 $A^c$ 是事件 $A$ 的互补事件。事件 $A^c$ 指的是“$n$ 个抽样配子中*没有一个*携带编辑后的等位基因”。根据原理(iv)，一个事件与其互补事件的概率之间的关系是：\n$$P(A) = 1 - P(A^c)$$\n我们现在来推导 $P(A^c)$ 的表达式。\n\n设 $E_i$ 表示第 $i$ 个抽样配子携带编辑后等位基因的事件，其中 $i \\in \\{1, 2, \\dots, n\\}$。\n根据原理(ii)，对于任何单个配子，此事件的概率为 $f$：\n$$P(E_i) = f$$\n$E_i$ 的互补事件，记为 $E_i^c$，是指第 $i$ 个配子*不*携带编辑后等位基因的事件。对单次试验应用原理(iv)：\n$$P(E_i^c) = 1 - P(E_i) = 1 - f$$\n事件 $A^c$（大小为 $n$ 的样本中没有编辑后的配子）是所有 $n$ 个独立事件 $E_1^c, E_2^c, \\dots, E_n^c$ 同时发生。这可以写成这些事件的交集：\n$$A^c = E_1^c \\cap E_2^c \\cap \\dots \\cap E_n^c$$\n问题陈述指出配子是独立抽取的。这使我们可以应用原理(iii)，该原理指出一系列独立事件的概率是它们各自概率的乘积。因此：\n$$P(A^c) = P(E_1^c) \\times P(E_2^c) \\times \\dots \\times P(E_n^c)$$\n由于对于所有 $n$ 次试验，概率 $P(E_i^c) = 1 - f$ 都是相同的，这个乘积可以简化为：\n$$P(A^c) = (1 - f) \\times (1 - f) \\times \\dots \\times (1 - f) \\quad (n \\text{ times})$$\n$$P(A^c) = (1 - f)^{n}$$\n最后，我们将 $P(A^c)$ 的这个表达式代回到 $P(A)$ 的方程中：\n$$P(A) = 1 - (1 - f)^{n}$$\n这就是严格根据所提供的基本原理推导出的、$n$ 个抽样配子中至少有一个携带编辑后等位基因的概率的闭式解析表达式。", "answer": "$$\\boxed{1 - (1-f)^{n}}$$", "id": "2802363"}, {"introduction": "在任何CRISPR实验中，设计高效且特异的单链导向RNA（sgRNA）都是至关重要的一步，其中一个主要关注点是最大限度地减少脱靶切割。这项练习旨在挑战您构建一个简化的sgRNA特异性定量模型，并批判性地评估其基本假设。通过这个练习 [@problem_id:2626133]，您将锻炼自己将复杂生物现象转化为可处理模型的能力，更重要的是，认识到简化假设所带来的局限性，这是科研人员必备的一项关键技能。", "problem": "一个发育生物学实验室计划在小鼠早期原肠胚形成期间，使用CRISPR-Cas9系统和单链导向RNA (sgRNA) 来破坏一个转录因子基因座。该sgRNA的标准长度为$20$个核苷酸，其鸟嘌呤-胞嘧啶 (GC) 含量为$g=0.62$。通过与小鼠参考基因组进行全基因组比对，识别出$m=7$个基因座（不包括预期的靶向基因座），这些基因座与邻近经典原型间隔子邻近基序 (PAM) 的$10$个核苷酸的原型间隔子“种子”区域完全匹配，因此在一个基于种子的朴素模型下，它们是可能的脱靶位点。为构建一个刻意简化的模型，假设在任何给定的编辑事件中，每个与种子匹配的基因座（包括靶向基因座）被CRISPR-Cas9核糖核蛋白结合和切割的可能性均相等，并且这些事件在各个基因座上是独立且同分布的。仅使用概率归一化和此等概率事件假设，推导一个朴素特异性分数$S(m)$的符号表达式，该分数定义为任何给定的切割事件发生在预期靶向基因座的概率，并仅用$m$表示。然后，计算当$m=7$时该表达式的值。将最终数值答案以无单位小数形式报告，并四舍五入到四位有效数字。在你的推理中，从第一性原理出发解释该表达式是如何从假设中得出的，并简要阐述在发育基因组编辑背景下，这种评分方法的两个具体生物学局限性，在相关处引用给定的GC含量$g$。", "solution": "分析问题陈述的有效性。\n\n逐字提取已知条件：\n1.  系统：在小鼠早期原肠胚形成中使用带单链导向RNA (sgRNA) 的CRISPR-Cas9。\n2.  sgRNA长度：$20$个核苷酸。\n3.  sgRNA鸟嘌呤-胞嘧啶(GC)含量：$g=0.62$。\n4.  已识别的脱靶基因座数量：$m=7$。\n5.  脱靶标准：与经典原型间隔子邻近基序 (PAM) 相邻的$10$个核苷酸原型间隔子“种子”区域完全匹配。这$m=7$个基因座不包括预期的靶向基因座。\n6.  假设1：每个与种子匹配的基因座（靶向基因座和$m$个脱靶基因座）被结合和切割的可能性相等。\n7.  假设2：事件在各个基因座上是独立且同分布的。\n8.  定义：朴素特异性分数$S(m)$是任何给定切割事件发生在预期靶向基因座上的概率。\n9.  约束：$S(m)$的表达式必须只用$m$表示。\n10. 任务：计算当$m=7$时$S(m)$的值，并四舍五入到四位有效数字。\n11. 任务：阐述该模型的两个具体生物学局限性。\n\n验证结论：\n问题有效。它提出了一个基于分子生物学（CRISPR-Cas9基因组编辑）既定概念的简化但定义明确的理论模型。这些假设虽然在生物学上是朴素的，但为了模型的目的被明确陈述，这是定量问题解决中的标准做法。该问题是自洽的、逻辑一致的，并且需要数学推导和概念性的生物学推理。它在科学上并非不健全、不完整或模棱两可。因此，将提供解答。\n\n该问题要求在一组刻意简化的假设下推导特异性分数$S(m)$。让我们从第一性原理出发。\n\n问题的核心在于为单个切割事件定义可能结果的样本空间。该模型假定切割只能发生在与$10$个核苷酸的种子区域完全匹配且邻近经典PAM的基因座上。我们已知有$1$个这样的预期靶向基因座和$m$个这样的脱靶基因座。\n\n设$N$为该模型下易受切割的基因座总数。这个集合包括单个靶向基因座和$m$个脱靶基因座。因此，潜在切割位点的总数是：\n$$N = 1 + m$$\n问题陈述“每个与种子匹配的基因座……被结合和切割的可能性相等”。这是对有限样本空间上均匀概率分布的经典假设。样本空间$\\Omega$由所有可能的切割事件集合组成，每个易受切割的基因座对应一个事件。该样本空间的大小为$|\\Omega| = N = 1+m$。\n\n特异性分数$S(m)$被定义为给定切割事件发生在预期靶向基因座的概率。设$A$为切割发生在靶向基因座的事件。在我们的样本空间中，只有一个这样的结果。因此，对事件$A$有利的结果数量是$|A|=1$。\n\n根据等概率结果的概率基本定义，一个事件的概率是该事件的有利结果数与所有可能结果总数的比值。\n$$P(A) = \\frac{\\text{有利结果数}}{\\text{所有可能结果总数}}$$\n将此应用于我们的问题，特异性分数$S(m)$的表达式为：\n$$S(m) = \\frac{|A|}{|\\Omega|} = \\frac{1}{1+m}$$\n该表达式仅用$m$表示，符合问题陈述的要求。\n\n接下来，我们必须计算当给定值$m=7$时该表达式的值。\n将$m=7$代入我们推导的公式中：\n$$S(7) = \\frac{1}{1+7} = \\frac{1}{8}$$\n为了将其报告为四舍五入到四位有效数字的小数，我们进行除法运算：\n$$\\frac{1}{8} = 0.125$$\n为了用四位有效数字表示，我们在末尾追加一个零，这在这种情况下是有效的。\n$$S(7) = 0.1250$$\n\n最后，问题要求阐述这种简单评分方法的两个具体生物学局限性。其核心缺陷在于假设所有与种子匹配的位点的切割概率相等。\n\n1.  **染色质可及性**：该模型将基因组视为裸露的、均一可及的DNA聚合物。这在生物学上是不正确的。在真核细胞核中，DNA与组蛋白复合形成染色质，染色质以不同的压缩状态存在。位于高度浓缩的异染色质区域内的潜在脱靶位点，对于庞大的CRISPR-Cas9核糖核蛋白复合物来说存在空间位阻，因此无论其序列同一性如何，都极不可能被切割。相反，位于开放的常染色质内的位点则更容易接近。在像小鼠原肠胚形成这样的动态发育过程中，染色质景观会活跃地重塑，使得可及性成为Cas9活性的一个关键且可变的决定因素，而该模型完全忽略了这一点。\n\n2.  **种子区域外错配和双链稳定性的影响**：该模型判断一个可能的脱靶位点的标准仅仅是$10$个核苷酸种子区域的完美匹配。它完全忽略了$20$个核苷酸sgRNA结合位点的其余部分。实际上，sgRNA与DNA靶标在种子区域外的错配数量、位置和类型，都会深刻影响切割效率。虽然种子区域对初始结合至关重要，但非种子部分的大量错配会破坏sgRNA-DNA双链的稳定性，并阻止Cas9蛋白发生核酸酶激活所需的构象变化。此外，RNA-DNA杂交链的热力学稳定性，受其整体GC含量（给定为$g=0.62$）的影响，会影响结合亲和力和动力学。一个具有完美种子区，但在其他位置GC含量较低或存在不稳定错配的位点，其切割效率将远低于在整个$20$个核苷酸长度上完全匹配的靶向位点。该模型的等概率假设错误地将这些截然不同的情况等同起来。", "answer": "$$\\boxed{0.1250}$$", "id": "2626133"}, {"introduction": "许多基因编辑实验的最终目标是实现功能性基因敲除，但非同源末端连接（NHEJ）修复途径产生的多样化结果使得预测这一结果成为一个复杂的概率问题。这个高级计算问题 [@problem_id:2725970] 整合了分子生物学原理（如移码突变、蛋白质结构域）和给定的插入或删除（indel）图谱，以构建一个预测基因功能敲除的综合模型。通过实施该模型，您将对修复结果、切割位点和基因结构之间的相互作用如何决定CRISPR-Cas9编辑的功能性后果获得深刻的定量理解。", "problem": "编写一个完整、可运行的程序，从分子生物学和概率论的基本定义出发，在给定插入或删除谱 (indel spectrum) 和源自蛋白质结构域结构的基因特异性截短耐受性的情况下，计算一个基因在经过CRISPR-Cas9介导的编辑后被功能性敲除的概率。该程序必须实现以下有科学依据的假设和定义，且不使用任何外部数据或用户输入。\n\n使用的基本原理：\n- 分子生物学中心法则：脱氧核糖核酸 (DNA) 转录为核糖核酸 (RNA)，然后以大小为 $3$ 个核苷酸的密码子为单位翻译成蛋白质；开放阅读框由模 $3$ 的相位决定。导致编码序列长度变化不是 $3$ 的倍数的插入或删除会引发移码，通常会导致提前终止。\n- 在移码后的阅读框中，当遇到终止密码子时会发生提前终止。根据一个简化且广泛使用的模型，在随机阅读框中，终止密码子以每个密码子概率 $s$（在每个测试中视为常数）出现，这导致在终止前可以翻译的额外氨基酸数量服从几何分布。\n- 蛋白质结构域是结构和功能单元；基因的功能可能要求在任何截短或框内编辑后，每个必需结构域至少保留其氨基酸的指定部分。在结构域内的插入如果超过特定于该结构域的大小阈值，则是破坏性的。\n\n要实现的模型定义：\n- 编码序列长度 $L$ 以核苷酸为单位指定，且 $L$ 可被 $3$ 整除。令 $L_{\\mathrm{aa}} = L/3$ 为以氨基酸为单位的蛋白质长度。\n- Cas$9$ 切割位点被建模在氨基酸索引 $p$（基于 1）处，意味着可能受插入或删除影响的第一个氨基酸位于位置 $p$。位置小于 $p$ 的氨基酸在任何切割后效应发生前是完整的。\n- 该基因有一组必需结构域，每个结构域表示为一个四元组 $(a_i, b_i, f_i, g_i)$：\n  - $a_i$ 和 $b_i$ 是基于 1 的氨基酸索引，满足 $1 \\le a_i \\le b_i \\le L_{\\mathrm{aa}}$。\n  - $f_i \\in [0,1]$ 是为保持功能而必须保持完整的结构域 $i$ 的最小比例。\n  - $g_i \\in \\mathbb{N}_0$ 是在不丧失功能的情况下，可以在结构域 $i$ 内某一位点插入的最大氨基酸数量。\n- 移码后阅读框中每个密码子的终止概率为 $s \\in (0,1)$，这导致在遇到终止密码子之前，切割后翻译的额外氨基酸数量服从几何分布。\n\n插入或删除谱：\n- 每个编辑结果是一个元组 $(\\text{type}, \\ell, q)$，其中 $\\text{type} \\in \\{\\text{\"ins\"}, \\text{\"del\"}, \\text{\"none\"}\\}$，$\\ell$ 是插入或删除的长度（以核苷酸为单位）（对于 $\\text{\"none\"}$，设 $\\ell = 0$），$q$ 是其概率，所有 $q$ 的总和为 $1$。\n- $\\ell \\bmod 3 \\ne 0$ 的结果是移码（包括插入或删除），而 $\\ell \\bmod 3 = 0$ 的结果是框内（同样包括插入或删除）。$\\text{\"none\"}$ 结果使蛋白质保持不变。\n\n要实现的功能丧失规则：\n- 移码结果：\n  - 令 $T$ 为在移码后的阅读框中，切割后、遇到终止密码子前翻译的额外氨基酸的非负整数数量；在参数为 $s$ 的几何模型下，$T$ 的支撑集为 $\\{0,1,2,\\dots\\}$。\n  - 截短蛋白质的长度（以氨基酸为单位）为 $L_{\\text{trunc}} = \\min\\{L_{\\mathrm{aa}}, (p-1) + T\\}$。\n  - 对于每个长度为 $n_i = b_i - a_i + 1$ 的结构域 $i$，为保持功能，该结构域中必须至少有 $\\lceil f_i \\cdot n_i \\rceil$ 个氨基酸存在于 $L_{\\text{trunc}}$ 中。如果 $b_i \\le p-1$，则该结构域完全完整；如果 $a_i \\ge p$，则该结构域完全位于下游；否则它跨越切割位点。\n  - 从第一性原理推导每个结构域满足其完整性分数所需的最小 $L_{\\text{trunc}}$，从而得出所有结构域的最低要求；使用几何分布的尾部概率计算移码保留功能的概率。移码结果的功能丧失概率是 1 减去此保留概率。\n- 框内缺失结果（$\\ell \\bmod 3 = 0$, 类型 $\\text{\"del\"}$）：\n  - 令 $D_{\\mathrm{aa}} = \\ell/3$ 为缺失的氨基酸数量，假定为从 $p$ 开始并延伸至 $p + D_{\\mathrm{aa}} - 1$（含）的连续片段。\n  - 对于每个结构域 $i$，计算缺失片段与 $[a_i,b_i]$ 之间的重叠长度。如果对于任何结构域，完整部分 $(n_i - \\text{overlap})/n_i$ 严格小于 $f_i$，则此结果为功能丧失；否则不是。\n- 框内插入结果（$\\ell \\bmod 3 = 0$, 类型 $\\text{\"ins\"}$）：\n  - 令 $I_{\\mathrm{aa}} = \\ell/3$ 为在位置 $p$ 插入的氨基酸数量。\n  - 如果对于任何结构域 $i$，$p \\in [a_i,b_i]$ 且 $I_{\\mathrm{aa}} > g_i$，则结果为功能丧失；否则不是。\n- 无编辑结果（$\\text{\"none\"}$）不会导致功能丧失。\n\n总敲除概率：\n- 功能性敲除的总概率是整个插入或删除谱中功能丧失指标的概率加权和。对每个测试用例，将最终答案表示为小数。\n\n测试套件：\n提供代码以计算以下 5 个案例的敲除概率。每个案例都是独立的，必须完全按照规定进行评估。\n\n- 案例 1：\n  - $L = 1500$, $p = 100$, $s = 0.05$。\n  - 结构域： $\\{(50, 150, 0.9, 2), (300, 400, 0.5, 5)\\}$。\n  - 插入或删除谱（每个条目为 $(\\text{type}, \\ell, q)$）：\n    - $(\\text{\"del\"}, 1, 0.2)$,\n    - $(\\text{\"del\"}, 3, 0.15)$,\n    - $(\\text{\"del\"}, 9, 0.05)$,\n    - $(\\text{\"ins\"}, 1, 0.1)$,\n    - $(\\text{\"ins\"}, 3, 0.1)$,\n    - $(\\text{\"ins\"}, 6, 0.1)$,\n    - $(\\text{\"none\"}, 0, 0.3)$。\n- 案例 2：\n  - $L = 300$, $p = 95$, $s = 0.05$。\n  - 结构域： $\\{(1, 90, 0.8, 3)\\}$。\n  - 插入或删除谱：\n    - $(\\text{\"del\"}, 1, 0.4)$,\n    - $(\\text{\"ins\"}, 2, 0.4)$,\n    - $(\\text{\"ins\"}, 3, 0.2)$。\n- 案例 3：\n  - $L = 900$, $p = 1$, $s = 0.05$。\n  - 结构域： $\\{\\}$ (无必需结构域)。\n  - 插入或删除谱：\n    - $(\\text{\"del\"}, 1, 0.5)$,\n    - $(\\text{\"ins\"}, 1, 0.2)$,\n    - $(\\text{\"ins\"}, 3, 0.3)$。\n- 案例 4：\n  - $L = 1200$, $p = 50$, $s = 0.06$。\n  - 结构域： $\\{(1, 120, 1.0, 0)\\}$。\n  - 插入或删除谱：\n    - $(\\text{\"del\"}, 1, 0.25)$,\n    - $(\\text{\"ins\"}, 2, 0.25)$,\n    - $(\\text{\"ins\"}, 5, 0.1)$,\n    - $(\\text{\"ins\"}, 3, 0.1)$,\n    - $(\\text{\"del\"}, 6, 0.3)$。\n- 案例 5：\n  - $L = 1800$, $p = 350$, $s = 0.04$。\n  - 结构域： $\\{(100, 200, 0.7, 3), (320, 500, 0.8, 2)\\}$。\n  - 插入或删除谱：\n    - $(\\text{\"del\"}, 3, 0.2)$,\n    - $(\\text{\"ins\"}, 3, 0.2)$,\n    - $(\\text{\"del\"}, 30, 0.1)$,\n    - $(\\text{\"ins\"}, 6, 0.1)$,\n    - $(\\text{\"del\"}, 1, 0.2)$,\n    - $(\\text{\"ins\"}, 2, 0.2)$。\n\n要求输出：\n- 您的程序必须为每个案例计算一个浮点数形式的敲除概率。\n- 将每个概率表示为小数点后精确到 6 位的小数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[\\text{result}_1,\\text{result}_2,\\dots,\\text{result}_5]$），且不含空格。\n\n角度单位不适用。不涉及物理单位。所有概率必须是小数，而不是百分比。", "solution": "问题陈述在计算合成生物学领域提出了一个定义明确且有科学依据的问题。它是自洽的、一致的，并且没有使其无效的缺陷。我们将从所提供的第一性原理出发推导解决方案。\n\n功能性敲除的总概率，记为 $P(\\text{KO})$，是通过对所有导致功能丧失 (LoF) 的单个编辑结果的概率求和来计算的。对于一个由概率为 $q_j$ 的结果 $j$ 组成的插入或删除谱，总敲除概率为：\n$$ P(\\text{KO}) = \\sum_j q_j \\cdot \\mathbb{I}(\\text{outcome } j \\text{ causes LoF}) $$\n其中 $\\mathbb{I}(\\cdot)$ 是指示函数，如果条件为真，其值为 $1$，否则为 $0$。因此，我们必须确定每类结果的 LoF 条件。\n\n问题指定了一个编码序列长度为 $L$ 个核苷酸的基因，对应于长度为 $L_{\\mathrm{aa}} = L/3$ 个氨基酸的蛋白质。CRISPR-Cas$9$ 切割位点位于氨基酸位置 $p$（基于 1）。该基因的功能取决于一组必需结构域，每个结构域由一个元组 $(a_i, b_i, f_i, g_i)$ 描述。\n\n我们根据每种结果类型对开放阅读框的影响进行分析。\n\n**1. 移码结果**\n长度为 $\\ell$ 个核苷酸且 $\\ell \\pmod 3 \\neq 0$ 的插入或删除会导致移码。由于在新阅读框中遇到提前终止密码子的概率很高，这总是会导致产生一个截短的蛋白质产物。只有当截短的蛋白质足够长，能够保留所有必需结构域的必需部分时，蛋白质功能才得以保留。\n\n令 $T$ 为在移码后的阅读框中，遇到终止密码子之前翻译的额外氨基酸的数量。根据模型，$T$ 是一个服从几何分布的随机变量，成功概率为 $s$（其中成功指遇到终止密码子）。其概率质量函数为 $P(T=k) = (1-s)^k s$，其中 $k \\in \\{0, 1, 2, \\dots\\}$。最终得到的截短蛋白质的氨基酸长度为 $L_{\\text{trunc}} = \\min\\{L_{\\mathrm{aa}}, (p-1) + T\\}$，其中 $(p-1)$ 是蛋白质 N 端完整部分的长度。\n\n对于每个从 $a_i$ 开始到 $b_i$ 结束的必需结构域 $i$，其长度为 $n_i = b_i - a_i + 1$。功能性要求该结构域至少保留 $m_i = \\lceil f_i \\cdot n_i \\rceil$ 个氨基酸。为了使蛋白质具有功能，结构域 $i$ 的完整氨基酸数量，即交集 $[a_i, b_i] \\cap [1, L_{\\text{trunc}}]$ 的大小，必须至少为 $m_i$。这个条件当且仅当截短的蛋白质包含该结构域的前 $m_i$ 个氨基酸时才满足。因此，结构域 $i$ 所需的最后一个氨基酸位置是 $c_i = a_i + m_i - 1$。\n\n为了使整个蛋白质保持功能，这个条件必须对所有必需结构域都成立。这就要求截短的蛋白质长度 $L_{\\text{trunc}}$ 必须至少是所有这些所需位置的最大值。令 $L_{\\text{trunc,min}} = \\max_i \\{c_i\\}$。如果没有必需结构域，我们定义 $L_{\\text{trunc,min}} = 0$。如果 $L_{\\text{trunc}} \\ge L_{\\text{trunc,min}}$，则功能得以保留。代入 $L_{\\text{trunc}}$ 的表达式，我们得到：\n$$ \\min\\{L_{\\mathrm{aa}}, (p-1) + T\\} \\ge L_{\\text{trunc,min}} $$\n如果 $L_{\\text{trunc,min}} > L_{\\mathrm{aa}}$，则无法满足此条件，保留功能的概率为 $0$。否则，条件简化为 $(p-1) + T \\ge L_{\\text{trunc,min}}$，即 $T \\ge L_{\\text{trunc,min}} - (p-1)$。令 $T_{\\min} = \\max\\{0, L_{\\text{trunc,min}} - (p-1)\\}$。保留功能的概率是几何分布的尾部概率，$P(T \\ge T_{\\min})$。\n$$ P(\\text{retain function} | \\text{frameshift}) = \\sum_{k=T_{\\min}}^{\\infty} (1-s)^k s = (1-s)^{T_{\\min}} $$\n因此，任何移码结果导致功能丧失的概率为 $P(\\text{LoF} | \\text{frameshift}) = 1 - (1-s)^{T_{\\min}}$。\n\n**2. 框内缺失结果**\n长度为 $\\ell$ 且 $\\ell \\pmod 3 = 0$、$\\ell > 0$ 的缺失会导致 $D_{\\mathrm{aa}} = \\ell/3$ 个氨基酸的框内缺失。问题陈述此缺失跨越从氨基酸 $p$ 到 $p+D_{\\mathrm{aa}}-1$ 的片段，即区间 $S_{del} = [p, p+D_{\\mathrm{aa}}-1]$。\n如果此结果破坏了任何必需结构域，则会导致 LoF。对于一个跨越 $[a_i, b_i]$ 的结构域 $i$，我们计算从中丢失的氨基酸数量，即 $S_{del}$ 和 $[a_i, b_i]$ 的交集长度。重叠长度为 $\\text{overlap}_i = \\max\\{0, \\min(b_i, p+D_{\\mathrm{aa}}-1) - \\max(a_i, p) + 1 \\}$。该结构域中剩余的氨基酸数量为 $n_i - \\text{overlap}_i$。如果剩余氨基酸的比例小于所需比例 $f_i$，则该结构域被破坏，导致 LoF：\n$$ \\frac{n_i - \\text{overlap}_i}{n_i}  f_i $$\n如果此条件对任何必需结构域 $i$ 成立，则该结果被归类为 LoF。\n\n**3. 框内插入结果**\n长度为 $\\ell$ 且 $\\ell \\pmod 3 = 0$、$\\ell  0$ 的插入会在位置 $p$ 处导致 $I_{\\mathrm{aa}} = \\ell/3$ 个氨基酸的框内插入。如果插入发生在必需结构域内且其大小超过该结构域的耐受度，则会导致 LoF。对于每个参数为 $(a_i, b_i, f_i, g_i)$ 的结构域 $i$，如果插入位点 $p$ 落在该结构域的边界内 并且 插入大小 $I_{\\mathrm{aa}}$ 大于耐受大小 $g_i$，则发生 LoF。\n$$ (p \\in [a_i, b_i]) \\land (I_{\\mathrm{aa}}  g_i) $$\n如果此条件对任何必需结构域 $i$ 成立，则结果为 LoF。\n\n**4. 其他结果**\n- “none”结果，代表未经编辑的等位基因，不会导致 LoF。其对 $P(\\text{KO})$ 的贡献为 $0$。\n- 如果没有指定必需结构域（空集），那么根据给定的规则，任何结果都不会导致 LoF，总 $P(\\text{KO})$ 为 $0$。\n\n总的 $P(\\text{KO})$ 是插入或删除谱中每个结果 $j$ 的贡献 $q_j \\cdot P(\\text{LoF}_j)$ 的总和，根据上述原理计算。", "answer": "```python\nimport math\nimport numpy as np\n\ndef calculate_ko_probability(L, p, s, domains, spectrum):\n    \"\"\"\n    Computes the knockout probability based on the provided model.\n    \"\"\"\n    total_ko_prob = 0.0\n    L_aa = L / 3.0\n\n    # Pre-calculate the probability of loss of function for any frameshift event,\n    # as it is constant for a given gene and cut site configuration.\n    c_i_list = []\n    for (a_i, b_i, f_i, g_i) in domains:\n        n_i = float(b_i - a_i + 1)\n        # Required number of intact amino acids for domain i\n        m_i = np.ceil(f_i * n_i)\n        # Position of the last required amino acid for domain i\n        c_i = a_i + m_i - 1\n        c_i_list.append(c_i)\n    \n    # Minimum required length of a truncated protein to be functional.\n    # max of an empty list would error, so start with [0].\n    L_trunc_min = max([0] + c_i_list)\n\n    prob_lof_frameshift = 0.0\n    if L_trunc_min  L_aa:\n        # If the minimally required length is greater than the full protein length,\n        # retention is impossible.\n        prob_lof_frameshift = 1.0\n    else:\n        # Minimum number of additional amino acids needed after the cut.\n        # Position p is 1-based, so (p-1) amino acids precede the cut.\n        T_min = max(0, L_trunc_min - (p - 1))\n        # Probability of retention is the tail probability of the geometric distribution.\n        prob_retain = (1.0 - s)**T_min\n        prob_lof_frameshift = 1.0 - prob_retain\n\n    for (type_outcome, l, q) in spectrum:\n        is_lof = False\n        \n        if type_outcome == \"none\":\n            is_lof = False\n        elif l % 3 != 0:  # Frameshift (insertion or deletion)\n            # For frameshifts, the LoF probability is calculated once and applied here.\n            total_ko_prob += q * prob_lof_frameshift\n            continue  # Proceed to the next outcome in the spectrum\n        elif l  0:  # In-frame (insertion or deletion)\n            if type_outcome == \"del\":\n                D_aa = l // 3\n                del_start = p\n                del_end = p + D_aa - 1\n                for (a_i, b_i, f_i, g_i) in domains:\n                    n_i = float(b_i - a_i + 1)\n                    \n                    overlap_start = max(a_i, del_start)\n                    overlap_end = min(b_i, del_end)\n                    overlap_len = float(max(0, overlap_end - overlap_start + 1))\n                    \n                    # LoF if domain's intact fraction is below threshold\n                    if n_i  0 and (n_i - overlap_len) / n_i  f_i:\n                        is_lof = True\n                        break\n            elif type_outcome == \"ins\":\n                I_aa = l // 3\n                for (a_i, b_i, f_i, g_i) in domains:\n                    # LoF if insertion is in-domain and larger than tolerance\n                    if a_i = p = b_i and I_aa  g_i:\n                        is_lof = True\n                        break\n        \n        if is_lof:\n            total_ko_prob += q\n            \n    return total_ko_prob\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and compute results.\n    \"\"\"\n    test_cases = [\n        {\n            \"L\": 1500, \"p\": 100, \"s\": 0.05,\n            \"domains\": [(50, 150, 0.9, 2), (300, 400, 0.5, 5)],\n            \"spectrum\": [\n                (\"del\", 1, 0.2), (\"del\", 3, 0.15), (\"del\", 9, 0.05),\n                (\"ins\", 1, 0.1), (\"ins\", 3, 0.1), (\"ins\", 6, 0.1),\n                (\"none\", 0, 0.3)\n            ]\n        },\n        {\n            \"L\": 300, \"p\": 95, \"s\": 0.05,\n            \"domains\": [(1, 90, 0.8, 3)],\n            \"spectrum\": [(\"del\", 1, 0.4), (\"ins\", 2, 0.4), (\"ins\", 3, 0.2)]\n        },\n        {\n            \"L\": 900, \"p\": 1, \"s\": 0.05,\n            \"domains\": [],\n            \"spectrum\": [(\"del\", 1, 0.5), (\"ins\", 1, 0.2), (\"ins\", 3, 0.3)]\n        },\n        {\n            \"L\": 1200, \"p\": 50, \"s\": 0.06,\n            \"domains\": [(1, 120, 1.0, 0)],\n            \"spectrum\": [\n                (\"del\", 1, 0.25), (\"ins\", 2, 0.25), (\"ins\", 5, 0.1),\n                (\"ins\", 3, 0.1), (\"del\", 6, 0.3)\n            ]\n        },\n        {\n            \"L\": 1800, \"p\": 350, \"s\": 0.04,\n            \"domains\": [(100, 200, 0.7, 3), (320, 500, 0.8, 2)],\n            \"spectrum\": [\n                (\"del\", 3, 0.2), (\"ins\", 3, 0.2), (\"del\", 30, 0.1),\n                (\"ins\", 6, 0.1), (\"del\", 1, 0.2), (\"ins\", 2, 0.2)\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_ko_probability(\n            case[\"L\"], case[\"p\"], case[\"s\"],\n            case[\"domains\"], case[\"spectrum\"]\n        )\n        results.append(f\"{result:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2725970"}]}