{"hands_on_practices": [{"introduction": "细胞不仅将资源用于生长，还必须消耗能量以维持基本生命活动，这部分能量消耗被称为非生长相关维持(Non-Growth Associated Maintenance, NGAM)。这个实践将通过一个极简化的模型，帮助你量化理解NGAM对细胞生长预测的决定性影响，尤其是在底物供应受限的条件下。通过这个练习[@problem_id:2724005]，你将深入体会到，在对细胞代谢进行建模时，准确设定生物学约束（如NGAM）为何至关重要。", "problem": "考虑一个适用于三磷酸腺苷（ATP）生产和生长的通量平衡分析（FBA, Flux Balance Analysis）的最小约束代谢模型，重点关注非生长相关维持（NGAM, Non-Growth Associated Maintenance）的作用。该模型包含两种细胞内代谢物：底物 $S$ 和 ATP $A$，以及四种反应，其通量向量表示为 $v = (v_{\\text{upt}}, v_{\\text{cat}}, v_{\\text{ngam}}, v_{\\text{gr}})$：\n- 底物吸收：$v_{\\text{upt}}: \\varnothing \\to S$，\n- 分解代谢生成ATP：$v_{\\text{cat}}: S \\to y \\, A$，\n- NGAM ATP水解：$v_{\\text{ngam}}: A \\to \\varnothing$，\n- 生物质形成（生长相关ATP需求）：$v_{\\text{gr}}: \\gamma \\, A \\to \\text{Biomass}$。\n\n假设稳态质量平衡 $S v = 0$，化学计量约束如下\n$$\n\\begin{aligned}\nS\\text{-balance:}\\quad  v_{\\text{upt}} - v_{\\text{cat}} = 0, \\\\\nA\\text{-balance:}\\quad  y \\, v_{\\text{cat}} - v_{\\text{ngam}} - \\gamma \\, v_{\\text{gr}} = 0,\n\\end{aligned}\n$$\n以及界限\n$$\n0 \\le v_{\\text{upt}} \\le V_{\\max}, \\quad v_{\\text{cat}} \\ge 0, \\quad v_{\\text{ngam}} \\ge \\text{NGAM}, \\quad v_{\\text{gr}} \\ge 0.\n$$\nFBA 的目标是在这些线性约束条件下最大化生长速率 $v_{\\text{gr}}$。这里，$y$ 是底物的ATP产率，$\\gamma$ 是单位生长所需的ATP（生长相关维持，GAM），而 NGAM 是非生长相关的ATP消耗。\n\n您的任务是通过显式模拟来证明，在低底物条件下，低估 NGAM 会导致对生长的过高预测。使用线性规划计算两种参数设置下的最优 $v_{\\text{gr}}$：\n- 真实的NGAM值 $\\text{NGAM}_{\\text{true}}$，\n- 被低估的NGAM值 $\\text{NGAM}_{\\text{under}}$。\n\n使用以下符合科学实际的参数值和单位：\n- ATP产率 $y = 10$ $\\left(\\mathrm{mmol\\ A \\, per \\, mmol\\ S}\\right)$，\n- 生长相关ATP需求 $\\gamma = 30$ $\\left(\\mathrm{mmol\\ A \\, per \\, gDW}\\right)$，\n- 真实的非生长ATP消耗 $\\text{NGAM}_{\\text{true}} = 1.5$ $\\left(\\mathrm{mmol\\ A \\, gDW^{-1} \\, h^{-1}}\\right)$，\n- 被低估的非生长ATP消耗 $\\text{NGAM}_{\\text{under}} = 0.5$ $\\left(\\mathrm{mmol\\ A \\, gDW^{-1} \\, h^{-1}}\\right)$。\n\n测试集是一组底物吸收上限，您必须将它们作为独立的案例处理：\n$$\nV_{\\max} \\in \\{0.15, 0.16, 0.5, 1.0\\} \\ \\mathrm{mmol\\ S \\, gDW^{-1} \\, h^{-1}}.\n$$\n这些值包括一个边界情况 $V_{\\max} = \\text{NGAM}_{\\text{true}}/y = 0.15$，一个接近阈值的低底物情况 $V_{\\max} = 0.16$，以及两个较高的底物情况。对于每个 $V_{\\max}$，求解两个线性规划问题（一次使用 $\\text{NGAM}=\\text{NGAM}_{\\text{true}}$，另一次使用 $\\text{NGAM}=\\text{NGAM}_{\\text{under}}$）并报告：\n- 以 $\\mathrm{h^{-1}}$ 为单位的最优生长速率 $v_{\\text{gr,true}}$ 和 $v_{\\text{gr,under}}$，\n- 以 $\\mathrm{h^{-1}}$ 为单位的过高预测偏差 $b = v_{\\text{gr,under}} - v_{\\text{gr,true}}$。\n\n将所有生长速率和偏差表示为浮点数，四舍五入到 $6$ 位小数，并以 $\\mathrm{h^{-1}}$ 为单位报告。您的程序应生成单行输出，包含一个方括号结构内的三个列表：\n- 测试集的 $v_{\\text{gr,true}}$ 值列表，\n- 测试集的 $v_{\\text{gr,under}}$ 值列表，\n- 测试集的偏差 $b$ 列表。\n\n最终输出格式要求：\n您的程序应生成单行输出，包含一个由逗号分隔的、包含在三个方括号列表中的结果，格式完全如下：\n$$\n[ [g^{\\text{true}}_1,\\dots,g^{\\text{true}}_n], [g^{\\text{under}}_1,\\dots,g^{\\text{under}}_n], [b_1,\\dots,b_n] ]\n$$\n其中每个标量都四舍五入到 $6$ 位小数，并且打印的行中不含单位。对于指定的测试集，$n=4$。所有计算必须遵守上面给出的模型和约束，通量的单位是 $\\mathrm{mmol\\ gDW^{-1} \\, h^{-1}}$，生长速率的单位是 $\\mathrm{h^{-1}}$。", "solution": "问题陈述已经过验证，被认为是约束代谢建模领域中一个定义明确、具有科学依据的问题。我们将继续进行求解。\n\n该问题要求我们解决一个通量平衡分析（FBA）问题，这是线性规划（LP）的一个特定应用，以量化低估非生长相关维持（NGAM）能量需求对预测的微生物生长速率的影响。\n\n首先，我们将问题形式化为标准的线性规划（LP）格式。系统的状态由通量向量 $v = (v_{\\text{upt}}, v_{\\text{cat}}, v_{\\text{ngam}}, v_{\\text{gr}})^T$ 描述。为了使用标准求解器，我们将其表示为 $x = (x_1, x_2, x_3, x_4)^T$。目标是最大化生长速率 $v_{\\text{gr}}$ 或 $x_4$。在线性规划的标准最小化形式中，这等同于最小化 $-x_4$。因此，目标函数由成本向量 $c$ 定义：\n$$\n\\text{minimize } c^T x \\quad \\text{where} \\quad c = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\\\ -1 \\end{pmatrix}\n$$\n\n系统受到两类约束：质量平衡等式约束和通量界限不等式约束。\n\n稳态质量平衡方程 $S v = 0$ 构成了等式约束 $A_{eq} x = b_{eq}$：\n$$\n\\begin{aligned}\n1 \\cdot v_{\\text{upt}} - 1 \\cdot v_{\\text{cat}} + 0 \\cdot v_{\\text{ngam}} + 0 \\cdot v_{\\text{gr}} = 0 \\\\\n0 \\cdot v_{\\text{upt}} + y \\cdot v_{\\text{cat}} - 1 \\cdot v_{\\text{ngam}} - \\gamma \\cdot v_{\\text{gr}} = 0\n\\end{aligned}\n$$\n这给出了等式约束矩阵 $A_{eq}$ 和向量 $b_{eq}$：\n$$\nA_{eq} = \\begin{pmatrix} 1  -1  0  0 \\\\ 0  y  -1  -\\gamma \\end{pmatrix}, \\quad b_{eq} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n给定的参数是 $y=10$ 和 $\\gamma=30$。\n\n通量界限作为对 $x$ 元素各自的不等式约束给出：\n$$\n\\begin{aligned}\n0 \\le v_{\\text{upt}} \\le V_{\\max} \\\\\nv_{\\text{cat}} \\ge 0 \\\\\nv_{\\text{ngam}} \\ge \\text{NGAM} \\\\\nv_{\\text{gr}} \\ge 0\n\\end{aligned}\n$$\n这些是每个变量 $x_i$ 的下界和上界：$l_i \\le x_i \\le u_i$。\n- $0 \\le x_1 \\le V_{\\max}$\n- $0 \\le x_2  \\infty$\n- $\\text{NGAM} \\le x_3  \\infty$\n- $0 \\le x_4  \\infty$\n\n该问题足够简单，可以进行解析求解，这在进行数值计算之前提供了关键的见解。从第一个等式约束可知，$v_{\\text{upt}} = v_{\\text{cat}}$。由于 $0 \\le v_{\\text{upt}} \\le V_{\\max}$，因此 $0 \\le v_{\\text{cat}} \\le V_{\\max}$。\n\n从第二个等式约束，我们可以表达生长速率 $v_{\\text{gr}}$：\n$$\n\\gamma v_{\\text{gr}} = y v_{\\text{cat}} - v_{\\text{ngam}} \\implies v_{\\text{gr}} = \\frac{1}{\\gamma} (y v_{\\text{cat}} - v_{\\text{ngam}})\n$$\n为了最大化 $v_{\\text{gr}}$，我们必须在约束条件下最大化其值。通过同时最大化 $v_{\\text{cat}}$ 和最小化 $v_{\\text{ngam}}$，可以使 $v_{\\text{gr}}$ 的表达式最大化。根据界限， $v_{\\text{cat}}$ 的最大值为 $V_{\\max}$（通过将其 $v_{\\text{upt}}$ 设置为其最大值），而 $v_{\\text{ngam}}$ 的最小值为 $\\text{NGAM}$。\n\n将这些值代入 $v_{\\text{gr}}$ 的表达式中，可以得到潜在的最大生长速率。然而，我们还必须遵守非负性约束 $v_{\\text{gr}} \\ge 0$。因此，最优生长速率为：\n$$\nv_{\\text{gr,opt}} = \\max\\left(0, \\frac{y V_{\\max} - \\text{NGAM}}{\\gamma}\\right)\n$$\n这个解析公式揭示了底物吸收的一个临界阈值。只有当最大底物吸收产生的ATP速率 $y V_{\\max}$ 足以克服非生长相关维持成本 $\\text{NGAM}$ 时，生长才可能发生（$v_{\\text{gr,opt}} > 0$）。这定义了生长的最低底物吸收速率：\n$$\ny V_{\\max} > \\text{NGAM} \\implies V_{\\max} > \\frac{\\text{NGAM}}{y}\n$$\n如果 $V_{\\max} \\le \\text{NGAM}/y$，所有生成的ATP都被转移到NGAM，最优生长速率为 $0$。\n\n使用此公式，我们可以分析过高预测偏差 $b = v_{\\text{gr,under}} - v_{\\text{gr,true}}$。\n- $v_{\\text{gr,true}} = \\max\\left(0, \\frac{y V_{\\max} - \\text{NGAM}_{\\text{true}}}{\\gamma}\\right)$\n- $v_{\\text{gr,under}} = \\max\\left(0, \\frac{y V_{\\max} - \\text{NGAM}_{\\text{under}}}{\\gamma}\\right)$\n\n对于足够高的底物吸收速率，使得两个模型都预测正增长（即 $V_{\\max} > \\text{NGAM}_{\\text{true}}/y$），偏差变为：\n$$\nb = \\left(\\frac{y V_{\\max} - \\text{NGAM}_{\\text{under}}}{\\gamma}\\right) - \\left(\\frac{y V_{\\max} - \\text{NGAM}_{\\text{true}}}{\\gamma}\\right) = \\frac{\\text{NGAM}_{\\text{true}} - \\text{NGAM}_{\\text{under}}}{\\gamma}\n$$\n使用给定的参数 $\\text{NGAM}_{\\text{true}} = 1.5$、$\\text{NGAM}_{\\text{under}} = 0.5$ 和 $\\gamma = 30$，这个恒定的偏差是：\n$$\nb = \\frac{1.5 - 0.5}{30} = \\frac{1.0}{30} \\approx 0.033333 \\, \\mathrm{h^{-1}}\n$$\n此偏差代表了由于模型未能考虑全部维持能量成本而错误预测的生长部分。在低底物条件下，这种影响尤其显著，因为被低估的模型可能预测生长，而真实模型则正确地预测零生长，正如在 $V_{\\max} = 0.15$ 的边界情况下所见。\n\n对于实现部分，我们将使用 `scipy.optimize.linprog` 函数对每种情况进行数值求解。此函数接受我们已正式定义的参数 $c$、$A_{eq}$、$b_{eq}$ 和 `bounds`。对于测试集 $\\{0.15, 0.16, 0.5, 1.0\\}$ 中的每个 $V_{\\max}$ 值，我们将执行此过程两次：一次使用 $\\text{NGAM} = \\text{NGAM}_{\\text{true}} = 1.5$，另一次使用 $\\text{NGAM} = \\text{NGAM}_{\\text{under}} = 0.5$。得到的最优 $v_{\\text{gr}}$ 值及其差异将被收集并按指定格式化。数值解必须与上面推导的解析结果一致。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the FBA problem for a minimal metabolic model to demonstrate\n    how underestimating NGAM leads to overpredicted growth.\n    \"\"\"\n    \n    # Model Parameters\n    y = 10.0  # ATP yield (mmol A per mmol S)\n    gamma = 30.0  # Growth-associated ATP demand (mmol A per gDW)\n    \n    # NGAM cases\n    NGAM_true = 1.5  # True NGAM (mmol A gDW^-1 h^-1)\n    NGAM_under = 0.5  # Underestimated NGAM (mmol A gDW^-1 h^-1)\n    \n    # Test suite for substrate uptake upper bounds\n    V_max_suite = [0.15, 0.16, 0.5, 1.0]  # (mmol S gDW^-1 h^-1)\n\n    # Lists to store the results\n    g_true_list = []\n    g_under_list = []\n    bias_list = []\n\n    def solve_fba_instance(ngam_val, v_max_val):\n        \"\"\"\n        Solves the linear programming problem for a given set of parameters.\n\n        Variables are (v_upt, v_cat, v_ngam, v_gr).\n        \"\"\"\n        # Objective function: Maximize v_gr (v[3]). linprog minimizes, so minimize -v_gr.\n        c = [0, 0, 0, -1]\n        \n        # Equality constraints: S*v = 0\n        # v_upt - v_cat = 0\n        # y*v_cat - v_ngam - gamma*v_gr = 0\n        A_eq = np.array([\n            [1, -1, 0, 0],\n            [0, y, -1, -gamma]\n        ])\n        b_eq = np.array([0, 0])\n        \n        # Bounds on fluxes\n        # 0 = v_upt = v_max_val\n        # v_cat >= 0\n        # v_ngam >= ngam_val\n        # v_gr >= 0\n        bounds = [\n            (0, v_max_val),\n            (0, None),\n            (ngam_val, None),\n            (0, None)\n        ]\n        \n        # Solve the linear program using the 'highs' method for robustness.\n        res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if not res.success:\n            # For this well-posed problem, the solver should always succeed.\n            # An infeasible status (2) would imply no solution, but the analytical\n            # derivation proves a feasible solution always exists (even if v_gr=0).\n            # This check is for robust programming.\n            if res.status == 2: # Infeasible\n                return 0.0\n            raise ValueError(f\"Linear programming solver failed with status {res.status}: {res.message}\")\n        \n        # Optimal growth rate is the 4th variable in the solution vector x.\n        optimal_growth_rate = res.x[3]\n        \n        # Due to floating-point inaccuracies, the result can be a very small\n        # negative number close to zero. We enforce the non-negativity constraint.\n        return max(0.0, optimal_growth_rate)\n\n    # Iterate through each substrate uptake capacity in the test suite\n    for v_max in V_max_suite:\n        # Calculate optimal growth for the true NGAM value\n        v_gr_true = solve_fba_instance(NGAM_true, v_max)\n        \n        # Calculate optimal growth for the underestimated NGAM value\n        v_gr_under = solve_fba_instance(NGAM_under, v_max)\n        \n        # Calculate the overprediction bias\n        bias = v_gr_under - v_gr_true\n        \n        # Append results to their respective lists\n        g_true_list.append(v_gr_true)\n        g_under_list.append(v_gr_under)\n        bias_list.append(bias)\n    \n    # Format the lists into strings with 6 decimal places for each number\n    def format_list(data_list):\n        return \",\".join([f\"{x:.6f}\" for x in data_list])\n\n    g_true_str = format_list(g_true_list)\n    g_under_str = format_list(g_under_list)\n    b_str = format_list(bias_list)\n\n    # Print the final result in the exact specified format\n    print(f\"[[{g_true_str}],[{g_under_str}],[{b_str}]]\")\n\nsolve()\n```", "id": "2724005"}, {"introduction": "通量平衡分析(FBA)通常能预测一个最优的细胞生长速率，但在很多情况下，多种不同的内部通量分布都能达到同样的最优生长。这种现象被称为替代最优解。本练习[@problem_id:2723988]将指导你实现通量变异性分析(Flux Variability Analysis, FVA)，这是一种探索所有可能的最优通量分布的强大工具。你将学会如何利用FVA的结果将反应分类为必需、灵活或冗余，从而揭示代谢网络内在的鲁棒性和灵活性。", "problem": "您必须实现一个完整的程序，该程序为一个已知具有简并性的小型代谢网络计算其在生长最优点时的通量变异性分析 (FVA) 范围，然后解释在最优生长条件下哪些反应是必需的，哪些是灵活的。其科学基础是在准稳态假设下的细胞内代謝物稳态质量平衡和线性规划。您必须基于以下基本原理：(i) 化学计量矩阵 $S$ 和反应通量向量 $v$ 的稳态约束 $S \\, v = 0$；(ii) 反映不可逆性和容量限制的边界约束 $l \\le v \\le u$；(iii) 由线性泛函 $c^\\top v$ 表示的生物量产生线性目标最大化。通量平衡分析 (FBA) 通过求解一个线性规划问题来找到最大生长速率 $z^\\star$，而通量变异性分析 (FVA) 则在固定最优生长速率为 $z^\\star$ 并遵循相同约束条件的情况下，计算每个反应 $j$ 的最小和最大可行通量值。\n\n使用以下网络结构，该结构被特意设计用于在某些测试用例中展示替代最优解。存在 $m = 3$ 种细胞内代谢物和 $n = 6$ 个反应。化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$ 为\n$$\nS \\;=\\;\n\\begin{bmatrix}\n1  -1  -1  0  0  0 \\\\\n0  1   0   -1  0  -1 \\\\\n0  0   1   0   -1  1\n\\end{bmatrix},\n$$\n其行对应代谢物 $\\{A, B, C\\}$，列对应反应 $\\{R_1, R_2, R_3, R_4, R_5, R_6\\}$，定义如下：\n- $R_1$：细胞摄取 $A$（仅正向）。\n- $R_2$：转化 $A \\rightarrow B$（仅正向）。\n- $R_3$：转化 $A \\rightarrow C$（仅正向）。\n- $R_4$：$B$ 排出至生物量（仅正向）。\n- $R_5$：$C$ 排出至生物量（仅正向）。\n- $R_6$：$B \\leftrightarrow C$ 相互转化（可逆，当通量为正时定义为 $B \\rightarrow C$）。\n\n目标向量为\n$$\nc = [\\,0,\\,0,\\,0,\\,1,\\,1,\\,0\\,]^\\top,\n$$\n因此，需要最大化的生长目标是 $c^\\top v = v_4 + v_5$。在本练习中，所有通量均视为无量纲实数。数值答案必须表示为浮点数（无单位），在适用时四舍五入到三位小数。\n\n算法要求：\n1. 通过求解线性规划问题执行通量平衡分析 (FBA)\n$$\n\\max_{v \\in \\mathbb{R}^n} \\; c^\\top v \\quad \\text{subject to } S v = 0, \\; l \\le v \\le u,\n$$\n以获得最优生长值 $z^\\star = c^\\top v^\\star$。\n2. 对于通量变异性分析 (FVA)，对每个反应索引 $j \\in \\{1,\\dots,n\\}$，在以下约束条件下计算 $v_j$ 的最小和最大可行值\n$$\nS v = 0, \\quad c^\\top v = z^\\star, \\quad l \\le v \\le u,\n$$\n通过求解两个线性规划问题：\n$$\n\\min_{v} \\; v_j \\quad \\text{和} \\quad \\max_{v} \\; v_j,\n$$\n并遵循上述约束。通过最小化 $-v_j$ 来实现 $\\max v_j$。在施加 $c^\\top v = z^\\star$ 时，使用数值相等容差 $\\tau = 10^{-9}$；在您的求解器中将其实现为等式约束 $c^\\top v = z^\\star$，并在后处理中将任何小于 $\\tau$ 的绝对偏差视为零。\n3. 使用在 $z^\\star$ 处的 FVA 范围和分类容差 $\\epsilon = 10^{-7}$ 对每个反应进行分类：\n   - 在最优生长条件下被阻断（Blocked）如果 $\\max_j \\le \\epsilon$ 且 $\\min_j \\ge -\\epsilon$。\n   - 在最优生长条件下为必需（Essential）如果 $\\min_j \\ge \\epsilon$ 或 $\\max_j \\le -\\epsilon$（即，在所有最优解中，通量均为非零且符号相同）。\n   - 否则为在最优生长条件下为灵活（Flexible）（即，在至少一个最优解中通量可以为零）。\n4. 将所有报告的 FVA 边界四舍五入到三位小数以供输出。对分类标签使用精确整数。\n\n测试套件：\n实现三个测试用例，每个用例由下界和上界 $l, u \\in \\mathbb{R}^n$ 指定：\n\n- 测试用例 1（简并最优解）：\n  - $l = [\\,0,\\,0,\\,0,\\,0,\\,0,\\,-1000\\,]^\\top$\n  - $u = [\\,10,\\,1000,\\,1000,\\,1000,\\,1000,\\,1000\\,]^\\top$\n\n- 测试用例 2（一条途径被禁用；消除简并性）：\n  - $l = [\\,0,\\,0,\\,0,\\,0,\\,0,\\,-1000\\,]^\\top$\n  - $u = [\\,10,\\,1000,\\,0,\\,1000,\\,0,\\,1000\\,]^\\top$\n\n- 测试用例 3（两个内部分支容量受限；可逆相互转化被禁用）：\n  - $l = [\\,0,\\,0,\\,0,\\,0,\\,0,\\,0\\,]^\\top$\n  - $u = [\\,5,\\,3,\\,3,\\,1000,\\,1000,\\,0\\,]^\\top$\n\n对于每个测试用例，您的程序必须：\n- 通过 FBA 计算 $z^\\star$。\n- 在 $z^\\star$ 处为每个反应 $j \\in \\{1,\\dots,6\\}$ 计算 FVA 边界 $\\min_j$ 和 $\\max_j$。\n- 根据上述规则，用标签 $0$（阻断）、$1$（灵活）和 $2$（必需）对每个反应进行分类。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个测试用例的聚合结果，格式为逗号分隔的嵌套列表。对于每个测试用例，输出一个包含两个列表的列表：\n- 第一个列表是展平的序列 $[\\,\\min_1, \\max_1, \\min_2, \\max_2, \\dots, \\min_6, \\max_6\\,]$，由四舍五入到三位小数的浮点数组成。\n- 第二个列表是分类列表 $[\\,\\kappa_1, \\kappa_2, \\dots, \\kappa_6\\,]$，由整数组成。\n\n因此，最终输出必须是以下形式的单行：\n\"[ [ [min_1,max_1,min_2,max_2,...,min_6,max_6], [kappa_1,kappa_2,...,kappa_6] ], [ ... for case 2 ... ], [ ... for case 3 ... ] ]\"\n不含任何附加文本。确保所有输出中反应的顺序为 $[R_1,R_2,R_3,R_4,R_5,R_6]$。", "solution": "问题陈述要求针对给定的代谢网络实现通量平衡分析 (FBA) 和通量变异性分析 (FVA)，然后对反应进行分类。该问题具有科学依据，提法明确，并且所有必要的数据和算法都已指定。这是一个有效的问题。\n\n将遵循所需的算法步骤来开发解决方案。\n首先，我们定义化学计量矩阵 $S$ 和目标向量 $c$。\n$$\nS = \\begin{bmatrix}\n1  -1  -1  0  0  0 \\\\\n0  1   0   -1  0  -1 \\\\\n0  0   1   0   -1  1\n\\end{bmatrix} \\in \\mathbb{R}^{3 \\times 6}\n$$\n$$\nc = [\\,0,\\,0,\\,0,\\,1,\\,1,\\,0\\,]^\\top \\in \\mathbb{R}^{6}\n$$\n线性规划问题将使用 `scipy.optimize.linprog` 函数求解，该函数解决形如 $\\min_{x} c^\\top x$ subject to $A_{eq}x = b_{eq}$ and $lb \\le x \\le ub$ 的问题。\n\n**第1步：通量平衡分析 (FBA)**\n\n为了找到最大生长速率 $z^\\star$，我们求解以下线性规划 (LP) 问题：\n$$\n\\max_{v} z = c^\\top v \\quad \\text{subject to} \\quad S v = 0, \\quad l \\le v \\le u\n$$\n这等同于最小化 $-c^\\top v$。我们为 `scipy.optimize.linprog` 求解器构建此问题：\n- 目标函数系数：$-c$\n- 等式约束矩阵：$A_{eq} = S$\n- 等式约束向量：$b_{eq} = [\\,0,\\,0,\\,0\\,]^\\top$\n- 边界：每个通量 $v_i$ 对应 $(l_i, u_i)$。\n\n求解器返回的最优目标值（我们称之为 $z_{min}$）将是 $-c^\\top v$ 的最小值。因此，最大生长速率为 $z^\\star = -z_{min}$。对三个测试用例中的每一个都执行此计算，使用它们特定的下界 ($l$) 和上界 ($u$)。\n\n**第2步：通量变異性分析 (FVA)**\n\nFVA 在总生长速率固定为其最优值 $z^\\star$ 时，确定每个反应通量 $v_j$ 的可行范围。对于每个反应 $j \\in \\{1,\\dots,6\\}$，我们必须求解两个 LP 问题：一个用于求最小可能通量 $(\\min v_j)$，另一个用于求最大可能通量 $(\\max v_j)$。\n\n这些 LP 问题的约束条件是：\n1. $S v = 0$ (稳态)\n2. $l \\le v \\le u$ (热力学和容量约束)\n3. $c^\\top v = z^\\star$ (固定最优目标)\n\n第三个约束被添加到等式约束系统中。新的等式约束矩阵 $A'_{eq}$ 和向量 $b'_{eq}$ 是：\n$$\nA'_{eq} = \\begin{bmatrix} S \\\\ c^\\top \\end{bmatrix}, \\quad b'_{eq} = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ z^\\star \\end{bmatrix}\n$$\n对于每个反应 $j$，我们求解：\n- 为求 $\\min v_j$：\n  $$ \\min_{v} v_j \\quad \\text{s.t.} \\quad A'_{eq} v = b'_{eq}, \\quad l \\le v \\le u $$\n  目标向量是 $e_j$，这是一个在位置 $j$ 处为 $1$、其他位置为 $0$ 的向量。\n- 为求 $\\max v_j$：\n  $$ \\max_{v} v_j \\quad \\text{s.t.} \\quad A'_{eq} v = b'_{eq}, \\quad l \\le v \\le u $$\n  这等同于最小化 $-v_j$。目标向量是 $-e_j$。最大通量是求解器返回的最优值的相反数。\n\n对所有 $n=6$ 个反应重复此过程，为每个测试用例生成 $6$ 对 $(\\min_j, \\max_j)$ 值。\n\n**第3步：反应分类**\n\n使用计算出的 FVA 范围和分类容差 $\\epsilon = 10^{-7}$，每个反应分类如下：\n- **阻断 (0)**：如果其通量范围 $[\\min_j, \\max_j]$ 包含在 $[-\\epsilon, \\epsilon]$ 内。通过条件 $\\max_j \\le \\epsilon$ 和 $\\min_j \\ge -\\epsilon$ 来检查。\n- **必需 (2)**：如果在所有最优解中通量都是严格为正或严格为负。通过条件 $\\min_j \\ge \\epsilon$（严格为正）或 $\\max_j \\le -\\epsilon$（严格为负）来检查。\n- **灵活 (1)**：如果反应既不是阻断的也不是必需的。这意味着通量范围跨越零，但比阻断容差更宽（例如 $[-5, 5]$ 或 $[0, 10]$）。\n\n最终程序将为提供的三个测试用例系统地执行这些步骤。FVA 边界的数值结果将格式化为三位小数。然后，结果将被聚合并以指定的嵌套列表格式打印。\n\n以下是代码将计算的预期分析结果摘要：\n- **测试用例 1**：在高容量和可逆相互转化的条件下，多条途径可以实现 $z^\\star=10$ 的最大生长。这种简并性导致了灵活性。摄取反应 $R_1$ 必须承载 $10$ 的通量，使其成为必需反应。所有其他反应都是灵活的，因为通量可以在 $A \\to B \\to \\text{生物量}$ 和 $A \\to C \\to \\text{生物量}$ 两条途径之间重新分配。\n- **测试用例 2**：通过将 $v_3$ 和 $v_5$ 的上界设置为零，通过代谢物 $C$ 的途径被禁用。这消除了简并性。为了实现 $z^\\star=10$ 的最大生长，通量必须完全通过 $A \\to B \\to \\text{生物量}$ 途径。这将 $R_1, R_2, R_4$ 的通量固定为 $10$，使它们成为必需反应。被禁用的反应 $R_3, R_5, R_6$ 被阻断。\n- **测试用例 3**：摄取通量 $v_1$ 被限制为 $5$，内部分支通量 $v_2, v_3$ 各自被限制为 $3$。相互转化反应 $v_6$ 被阻断。最大生长率为 $z^\\star=v_1=5$。由于 $v_2+v_3 = v_1 = 5$ 并且 $v_2$ 和 $v_3$ 都不能超过 $3$，因此两者都必须被激活。$v_2$ 的范围是 $[2, 3]$，因此 $v_3$ 的范围也是 $[2, 3]$。由于这些范围都是严格为正的，反应 $R_1, R_2, R_3, R_4, R_5$ 对于最优生长都是必需的。$R_6$ 因其边界而被阻斷。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Computes FVA ranges and classifies reactions for a metabolic network\n    across three test cases as specified in the problem statement.\n    \"\"\"\n    S = np.array([\n        [1, -1, -1, 0, 0, 0],\n        [0, 1, 0, -1, 0, -1],\n        [0, 0, 1, 0, -1, 1]\n    ])\n    c_obj = np.array([0, 0, 0, 1, 1, 0])\n    num_reactions = 6\n    epsilon = 1e-7\n\n    test_cases = [\n        # Case 1: Degenerate optimal solutions\n        {\n            \"l\": np.array([0, 0, 0, 0, 0, -1000]),\n            \"u\": np.array([10, 1000, 1000, 1000, 1000, 1000])\n        },\n        # Case 2: One pathway disabled\n        {\n            \"l\": np.array([0, 0, 0, 0, 0, -1000]), \"u\": np.array([10, 1000, 0, 1000, 0, 1000])\n        },\n        # Case 3: Internal branches capacity-limited\n        {\n            \"l\": np.array([0, 0, 0, 0, 0, 0]),\n            \"u\": np.array([5, 3, 3, 1000, 1000, 0])\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        l_bounds, u_bounds = case[\"l\"], case[\"u\"]\n        bounds = list(zip(l_bounds, u_bounds))\n\n        # Step 1: FBA to find optimal growth rate z_star\n        res_fba = linprog(\n            c=-c_obj,\n            A_eq=S,\n            b_eq=np.zeros(S.shape[0]),\n            bounds=bounds,\n            method='highs'\n        )\n\n        if not res_fba.success:\n            # Problem setup should guarantee feasibility\n            raise RuntimeError(\"FBA optimization failed.\")\n        \n        z_star = -res_fba.fun\n\n        # Step 2: FVA for each reaction\n        fva_bounds = []\n        A_eq_fva = np.vstack([S, c_obj])\n        b_eq_fva = np.hstack([np.zeros(S.shape[0]), z_star])\n\n        for j in range(num_reactions):\n            # Minimize v_j\n            c_min = np.zeros(num_reactions)\n            c_min[j] = 1\n            res_min = linprog(\n                c=c_min,\n                A_eq=A_eq_fva,\n                b_eq=b_eq_fva,\n                bounds=bounds,\n                method='highs'\n            )\n            min_val = res_min.fun if res_min.success else np.nan\n\n            # Maximize v_j (by minimizing -v_j)\n            c_max = np.zeros(num_reactions)\n            c_max[j] = -1\n            res_max = linprog(\n                c=c_max,\n                A_eq=A_eq_fva,\n                b_eq=b_eq_fva,\n                bounds=bounds,\n                method='highs'\n            )\n            max_val = -res_max.fun if res_max.success else np.nan\n            \n            fva_bounds.append((min_val, max_val))\n\n        # Flatten and round FVA bounds\n        flat_fva_rounded = []\n        for min_v, max_v in fva_bounds:\n            flat_fva_rounded.append(f\"{min_v:.3f}\")\n            flat_fva_rounded.append(f\"{max_v:.3f}\")\n\n        # Step 3: Classify reactions\n        classifications = []\n        for min_v, max_v in fva_bounds:\n            # Blocked\n            if max_v = epsilon and min_v >= -epsilon:\n                classifications.append(0)\n            # Essential\n            elif min_v >= epsilon or max_v = -epsilon:\n                classifications.append(2)\n            # Flexible\n            else:\n                classifications.append(1)\n        \n        all_results.append(f\"[[{','.join(flat_fva_rounded)}],[{','.join(map(str, classifications))}]]\")\n\n    # Final print statement\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```", "id": "2723988"}, {"introduction": "静态的FBA模型无法捕捉细胞与其动态变化的环境之间的相互作用。为了解决这个问题，我们可以将FBA嵌入到动态仿真框架中，构建动态通量平衡分析(dynamic Flux Balance Analysis, dFBA)模型。在本练习[@problem_id:2723964]中，你将亲手编写一个dFBA程序，模拟微生物在分批培养条件下的生长过程。这个实践的核心目标是预测并理解关键的动态代谢现象，例如，当资源（如氧气）变得有限时，细胞如何切换代谢模式并产生副产物（溢流代谢）。", "problem": "要求您编写一个完整、可运行的程序，该程序使用流平衡分析 (FBA) 为一个最小的、用于教学的代谢网络执行动态的、基于约束的分批培养模拟。目标是根据初始胞外底物浓度和摄取上限，确定生长阶段并检测溢出代谢（一种溢出代谢物的分泌）的开始。您的程序必须为每个测试案例计算一组定量输出，以总结动态行为。答案必须在执行结束时以指定格式打印。\n\n模拟必须基于以下基本原理和定义构建：\n\n- 质量守恒和准稳态胞内代谢：如果 $S$ 表示胞内化学计量矩阵，$v$ 表示反应通量向量，则对于准稳态下的胞内代谢物，$S v = 0$ 成立。\n- 流平衡分析 (FBA)：一个线性优化问题，其在胞内化学计量等式和反应界限的约束下，最大化一个细胞目标（此处为生物质形成速率）。\n- 分批培养中的动态胞外质量平衡：对于每种胞外物质 $i$，其浓度为 $C_i(t)$（单位：毫摩尔/升），则有 $dC_i/dt = - v_i(t) X(t)$，其中 $v_i(t)$ 是单位生物质的摄取或分泌通量（单位：毫摩尔/克干重/小时），$X(t)$ 是生物质浓度（单位：克干重/升）。对于分泌，$v_i(t)$ 在从胞内到胞外的方向上取正值。\n- 生物质动态：比生长速率等于生物质反应通量，因此 $dX/dt = \\mu(t) X(t)$，其中 $\\mu(t) = v_{\\text{biomass}}(t)$（单位：/小时）。\n\n为一个最小网络建模，该网络包含以下胞内代谢物：胞内葡萄糖 ($\\text{glc}_c$)、胞内氧气 ($\\text{o}_2{}_c$)、三磷酸腺苷 ($\\text{ATP}_c$) 和胞内乙酸 ($\\text{ac}_c$)。胞外代谢物为葡萄糖 ($\\text{glc}_e$)、氧气 ($\\text{o}_2{}_e$) 和乙酸 ($\\text{ac}_e$)。要使用的反应集、通量变量和化学计量如下：\n\n- 葡萄糖摄取：$v_{\\text{glc\\_in}} \\ge 0$, $\\text{glc}_e \\rightarrow \\text{glc}_c$。胞内平衡对 $\\text{glc}_c$ 的贡献为 $+1$。\n- 氧气摄取：$v_{\\text{o2\\_in}} \\ge 0$, $\\text{o}_2{}_e \\rightarrow \\text{o}_2{}_c$。胞内平衡对 $\\text{o}_2{}_c$ 的贡献为 $+1$。\n- 呼吸作用：$v_{\\text{resp}} \\ge 0$, $\\text{glc}_c + 6\\,\\text{o}_2{}_c \\rightarrow 30\\,\\text{ATP}_c$。胞内平衡对 $\\text{glc}_c$ 的贡献为 $-1$，对 $\\text{o}_2{}_c$ 为 $-6$，对 $\\text{ATP}_c$ 为 $+30$。\n- 发酵作用：$v_{\\text{ferm}} \\ge 0$, $\\text{glc}_c \\rightarrow 2\\,\\text{ac}_c + 2\\,\\text{ATP}_c$。胞内平衡对 $\\text{glc}_c$ 的贡献为 $-1$，对 $\\text{ac}_c$ 为 $+2$，对 $\\text{ATP}_c$ 为 $+2$。\n- 生物质形成：$v_{\\text{biomass}} \\ge 0$, $10\\,\\text{ATP}_c \\rightarrow \\text{biomass}$。胞内平衡对 $\\text{ATP}_c$ 的贡献为 $-10$。\n- 非生长相关维持：$v_{\\text{maint}} \\ge m$, $\\text{ATP}_c \\rightarrow \\emptyset$。胞内平衡对 $\\text{ATP}_c$ 的贡献为 $-1$。参数 $m$ 是一个给定的非负下界，单位为毫摩尔/克干重/小时。\n- 乙酸分泌：$v_{\\text{ac\\_ex}} \\ge 0$, $\\text{ac}_c \\rightarrow \\text{ac}_e$。胞内平衡对 $\\text{ac}_c$ 的贡献为 $-1$。\n\n胞内稳态约束是以下线性等式：\n- 葡萄糖平衡：$v_{\\text{glc\\_in}} - v_{\\text{resp}} - v_{\\text{ferm}} = 0$。\n- 氧气平衡：$v_{\\text{o2\\_in}} - 6 v_{\\text{resp}} = 0$。\n- 三磷酸腺苷平衡：$30 v_{\\text{resp}} + 2 v_{\\text{ferm}} - 10 v_{\\text{biomass}} - v_{\\text{maint}} = 0$。\n- 乙酸平衡：$2 v_{\\text{ferm}} - v_{\\text{ac\\_ex}} = 0$。\n\n交换通量的界限取决于胞外浓度和单位生物质的摄取限制：\n- 如果胞外葡萄糖浓度 $C_{\\text{glc}}(t)  0$，则 $0 \\le v_{\\text{glc\\_in}} \\le V_{\\text{glc}}$；如果 $C_{\\text{glc}}(t) = 0$，则 $v_{\\text{glc\\_in}} = 0$。\n- 如果胞外氧气浓度 $C_{\\text{o2}}(t)  0$，则 $0 \\le v_{\\text{o2\\_in}} \\le V_{\\text{o2}}$；如果 $C_{\\text{o2}}(t) = 0$，则 $v_{\\text{o2\\_in}} = 0$。\n- 所有其他通量的下界为 $0$（对于 $v_{\\text{maint}}$ 为 $m$），其上界足够大，以不约束解。\n\n在每个时间点 $t$，求解 FBA 线性规划问题，该问题在上述等式和界限的约束下最大化 $v_{\\text{biomass}}$。使用最优通量，通过显式时间步进方案来推进胞外浓度和生物质。具体来说，如果步长为 $\\Delta t$ 小时，当前生物质为 $X(t)$ 克干重/升，则更新：\n- $C_{\\text{glc}}(t + \\Delta t) = \\max\\{0, C_{\\text{glc}}(t) - v_{\\text{glc\\_in}}(t)\\, X(t)\\, \\Delta t\\}$（单位：毫摩尔/升）。\n- $C_{\\text{o2}}(t + \\Delta t) = \\max\\{0, C_{\\text{o2}}(t) - v_{\\text{o2\\_in}}(t)\\, X(t)\\, \\Delta t\\}$（单位：毫摩尔/升）。\n- $C_{\\text{ac}}(t + \\Delta t) = C_{\\text{ac}}(t) + v_{\\text{ac\\_ex}}(t)\\, X(t)\\, \\Delta t$（单位：毫摩尔/升）。\n- $X(t + \\Delta t) = X(t) + v_{\\text{biomass}}(t)\\, X(t)\\, \\Delta t$（单位：克干重/升）。\n\n将溢出开始时间定义为满足最优乙酸分泌通量 $v_{\\text{ac\\_ex}}(t)  \\varepsilon$ 的最早时间 $t$，其中 $\\varepsilon$ 是一个小的正公差。如果在模拟结束前没有这样的时间发生，则报告 $-1$ 作为开始时间。\n\n当 $t$ 达到指定的最终时间 $T_{\\text{end}}$ 或葡萄糖耗尽时停止模拟，以先到者为准。将葡萄糖耗尽时间定义为 $C_{\\text{glc}}(t) \\le \\delta$ 的最早时间 $t$，其中 $\\delta$ 是一个小的正公差。\n\n单位和数值要求：\n- 时间单位必须是小时，浓度单位是毫摩尔/升，生物质单位是克干重/升。\n- 报告时间（单位：小时）和浓度（单位：毫摩尔/升）。\n- 使用固定时间步长 $\\Delta t$（单位：小时）。\n- 使用一个正公差 $\\varepsilon$ 来检测溢出开始，使用 $\\delta$ 来检测葡萄糖耗尽。\n\n您的程序必须使用上述确切的网络和规则，并为以下每个测试案例生成输出。对于每个测试案例，参数以元组 $(C_{\\text{glc}}(0), C_{\\text{o2}}(0), V_{\\text{glc}}, V_{\\text{o2}}, m, X(0), T_{\\text{end}}, \\Delta t)$ 的形式给出，单位如上所述。使用 $\\varepsilon = 10^{-9}$ 和 $\\delta = 10^{-9}$。\n\n测试套件（三个案例）：\n- 案例 A（氧气非限制性，预计无溢出）：$(100.0, 1000.0, 10.0, 60.0, 1.0, 0.1, 5.0, 0.005)$。\n- 案例 B（氧气摄取强限制性，从一开始就溢出）：$(100.0, 50.0, 10.0, 10.0, 1.0, 0.1, 5.0, 0.005)$。\n- 案例 C（初始单位生物质的氧气充足但会有限耗尽，延迟的溢出开始）：$(100.0, 20.0, 10.0, 60.0, 1.0, 0.1, 5.0, 0.005)$。\n\n对于每个测试案例，您的程序必须计算并返回列表 $[t_{\\text{overflow}}, t_{\\text{glc\\_dep}}, C_{\\text{ac}}(t_{\\text{stop}}), X(t_{\\text{stop}})]$，其中 $t_{\\text{overflow}}$ 是溢出开始时间（单位：小时，如果从未发生则报告-1），$t_{\\text{glc\\_dep}}$ 是葡萄糖耗尽时间（单位：小时，如果在 $T_{\\text{end}}$ 之前葡萄糖从未耗尽，则报告模拟停止的时间），$C_{\\text{ac}}(t_{\\text{stop}})$ 是最终乙酸浓度（单位：毫摩尔/升），$X(t_{\\text{stop}})$ 是最终生物质（单位：克干重/升）。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有测试案例的结果，格式为以逗号分隔的各案例列表的列表，用方括号括起来，没有多余的空格。例如：\"[[a,b,c,d],[e,f,g,h],[i,j,k,l]]\"。\n- 输出中的每个浮点数必须精确到小数点后六位。\n\n模型规范中的所有数值都是明确提供的；除了上面列出的规则外，不需要其他领域知识。重点是正确编码线性约束，在每个时间步求解线性规划问题，并对胞外和生物质动态进行积分。确保葡萄糖和氧气的使用遵循指定的界限，并且溢出检测的实现与此处定义完全一致。", "solution": "我们从基于约束的动态模拟所需的基本原理开始。\n\n首先，胞内通量必须满足稳态质量守恒，表示为 $S v = 0$，其中 $S$ 是胞内代谢物的化学计量矩阵，$v$ 是反应通量向量。在这个简化的网络中，我们追踪 $\\text{glc}_c$、$\\text{o}_2{}_c$、$\\text{ATP}_c$ 和 $\\text{ac}_c$ 的胞内平衡。所选的反应和化学计量具有生化合理性，并编码了两种能量生成模式：呼吸作用和发酵作用。呼吸作用每单位葡萄糖的 ATP 产率高且消耗氧气，而发酵作用每单位葡萄糖的 ATP 产率低，并产生乙酸（一种溢出代谢物）。非生长相关维持消耗确保了即使在零增长时，ATP 需求也非零。\n\n设胞内通量向量的顺序为 $v = [v_{\\text{glc\\_in}}, v_{\\text{o2\\_in}}, v_{\\text{resp}}, v_{\\text{ferm}}, v_{\\text{biomass}}, v_{\\text{maint}}, v_{\\text{ac\\_ex}}]^T$。$S v = 0$ 等式对应于以下平衡：\n\n- 葡萄糖：$v_{\\text{glc\\_in}} - v_{\\text{resp}} - v_{\\text{ferm}} = 0$，因为胞内葡萄糖通过摄取产生，并通过呼吸作用和发酵作用消耗。\n- 氧气：$v_{\\text{o2\\_in}} - 6 v_{\\text{resp}} = 0$，因为呼吸作用每单位葡萄糖消耗六个氧气，而氧气通过摄取进入。\n- 三磷酸腺苷：$30 v_{\\text{resp}} + 2 v_{\\text{ferm}} - 10 v_{\\text{biomass}} - v_{\\text{maint}} = 0$，反映了由能量生成途径的生产以及生物质合成和维持的消耗。\n- 乙酸：$2 v_{\\text{ferm}} - v_{\\text{ac\\_ex}} = 0$，强制在稳态下，发酵产生的乙酸通过分泌离开细胞。\n\n界限源于胞外可用性和单位生物质的转运能力。对于葡萄糖，如果胞外浓度 $C_{\\text{glc}}(t)$ 为正，则单位生物质的摄取界限为 $0 \\le v_{\\text{glc\\_in}} \\le V_{\\text{glc}}$，否则 $v_{\\text{glc\\_in}} = 0$。类似地，对于氧气，如果 $C_{\\text{o2}}(t)  0$，则 $0 \\le v_{\\text{o2\\_in}} \\le V_{\\text{o2}}$，否则 $v_{\\text{o2\\_in}} = 0$。所有其他通量都是非负的，维持反应有一个下界 $v_{\\text{maint}} \\ge m$。流平衡分析 (FBA) 的优化目标是在这些等式和界限的约束下，最大化生物质形成速率 $v_{\\text{biomass}}$。在代码中，我们可以通过使用线性规划求解器最小化 $v_{\\text{biomass}}$ 的相反数来解决这个问题。\n\n给定时间 $t$ 的最优通量，胞外代谢物的动态演变遵循单位体积的物料平衡，并采用摄取通量进入细胞为正的约定。对于葡萄糖和氧气：\n- $dC_{\\text{glc}}/dt = - v_{\\text{glc\\_in}}(t) X(t)$,\n- $dC_{\\text{o2}}/dt = - v_{\\text{o2\\_in}}(t) X(t)$.\n\n对于乙酸，分泌会增加胞外浓度：\n- $dC_{\\text{ac}}/dt = + v_{\\text{ac\\_ex}}(t) X(t)$.\n\n生物质以速率 $\\mu(t) = v_{\\text{biomass}}(t)$ 指数增长：\n- $dX/dt = \\mu(t) X(t)$.\n\n这些通过大小为 $\\Delta t$ 的显式欧拉步进行积分：对于每个胞外物质 $i$，$C_i(t+\\Delta t) = C_i(t) + (dC_i/dt)\\, \\Delta t$，其浓度被限制在零以上，以及 $X(t+\\Delta t) = X(t) + (dX/dt)\\, \\Delta t$。\n\n当发酵作用活跃且乙酸被分泌时，即识别为溢出代谢；在这个稳态模型中，由于乙酸平衡 $2 v_{\\text{ferm}} - v_{\\text{ac\\_ex}} = 0$，当且仅当 $v_{\\text{ferm}}  0$ 时，$v_{\\text{ac\\_ex}}  0$。将溢出开始时间定义为 $v_{\\text{ac\\_ex}}(t)  \\varepsilon$ 的最小时间 $t$，其中 $\\varepsilon$ 是一个小的正公差；如果这从未发生，则报告 -1。葡萄糖耗尽时间是 $C_{\\text{glc}}(t) \\le \\delta$ 的最小时间 $t$，其中 $\\delta$ 是一个小的正公差。模拟在 $t = T_{\\text{end}}$ 或葡萄糖耗尽时停止，以先到者为准。所要求的输出是：\n- $t_{\\text{overflow}}$（单位：小时），\n- $t_{\\text{glc\\_dep}}$（单位：小时），\n- $C_{\\text{ac}}(t_{\\text{stop}})$（单位：毫摩尔/升），\n- $X(t_{\\text{stop}})$（单位：克干重/升）。\n\n适合实现的算法步骤：\n1. 对每个测试案例，初始化 $t = 0$, $C_{\\text{glc}}(0)$, $C_{\\text{o2}}(0)$, $C_{\\text{ac}}(0) = 0$ 和 $X(0)$。\n2. 在每个时间步：\n   - 根据 $C_{\\text{glc}}(t)$ 和 $C_{\\text{o2}}(t)$ 设置 $v_{\\text{glc\\_in}}$ 和 $v_{\\text{o2\\_in}}$ 的界限。\n   - 用等式和界限构建线性规划问题，并最大化 $v_{\\text{biomass}}$（等效于最小化其相反数）。\n   - 从解中提取 $v_{\\text{biomass}}$、$v_{\\text{glc\\_in}}$、$v_{\\text{o2\\_in}}$ 和 $v_{\\text{ac\\_ex}}$。\n   - 如果 $v_{\\text{ac\\_ex}}  \\varepsilon$ 且溢出开始时间尚未设置，则将其设置为当前的 $t$。\n   - 使用显式欧拉步更新 $C_{\\text{glc}}$、$C_{\\text{o2}}$、$C_{\\text{ac}}$ 和 $X$，利用当前的 $X(t)$ 计算消耗和生产速率。\n   - 如果 $C_{\\text{glc}}$ 首次低于 $\\delta$，将当前的 $t$ 记录为 $t_{\\text{glc\\_dep}}$。\n   - $t$ 增加 $\\Delta t$。\n3. 当 $t \\ge T_{\\text{end}}$ 或 $C_{\\text{glc}} \\le \\delta$ 时停止。如果 $t_{\\text{glc\\_dep}}$ 未被设置并且模拟因达到 $T_{\\text{end}}$ 而停止，则设置 $t_{\\text{glc\\_dep}} = t$。\n4. 如果从未检测到溢出开始，则设置 $t_{\\text{overflow}} = -1$。\n5. 按指定的顺序和单位返回四个要求的输出。\n\n给定网络下各阶段的科学解释：\n- 当单位生物质的氧气摄取能力相对于葡萄糖摄取充足（$V_{\\text{o2}} \\ge 6 V_{\\text{glc}}$）且氧气仍然可用时，优化器偏好呼吸作用，因为它每单位葡萄糖产生更多的 ATP。发酵作用保持不活跃，乙酸分泌保持为零：无溢出。\n- 如果氧气摄取能力相对于葡萄糖摄取不足，或氧气耗尽，优化器可以通过将葡萄糖转向发酵来增加 ATP 供应，从而激活乙酸分泌：溢出立即开始（如果氧气从一开始就受限）或在氧气耗尽的时刻开始。\n- 生长速率受 ATP 可用性的限制：在最优条件下，当 ATP 平衡活跃且 $v_{\\text{maint}}$ 处于其下界 $m$ 时，$\\mu = v_{\\text{biomass}} = \\left(30 v_{\\text{resp}} + 2 v_{\\text{ferm}} - v_{\\text{maint}}\\right) / 10$。\n\n测试套件涵盖了不同的机制：\n- 案例 A：$V_{\\text{o2}} = 60$ 和 $V_{\\text{glc}} = 10$ 满足 $V_{\\text{o2}} \\ge 6 V_{\\text{glc}}$，氧气池充足；严格的呼吸生长，无溢出。\n- 案例 B：$V_{\\text{o2}} = 10$ 远小于 $6 V_{\\text{glc}} = 60$；溢出立即发生，并持续到葡萄糖耗尽或结束时间。\n- 案例 C：$V_{\\text{o2}} = 60$ 允许在氧气存在时进行完全的呼吸性摄取；有限的氧气池耗尽，溢出在耗尽时开始。\n\n最后，程序必须将每个案例的结果汇总成单行，格式为列表的列表，每个浮点数按要求精确打印到小数点后六位。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef fba_step(C_glc, C_o2, V_glc, V_o2, m_lb):\n    \"\"\"\n    Solve the instantaneous FBA given extracellular concentrations and uptake bounds.\n    Returns the optimal flux vector and status flag.\n    Variable order:\n    0: v_glc_in\n    1: v_o2_in\n    2: v_resp\n    3: v_ferm\n    4: v_biomass\n    5: v_maint\n    6: v_ac_ex\n    \"\"\"\n    # Bounds depend on extracellular availability\n    # If pool is depleted (> 0.0), set uptake bound to exactly zero.\n    ub_glc = V_glc if C_glc > 0.0 else 0.0\n    ub_o2 = V_o2 if C_o2 > 0.0 else 0.0\n\n    # Equality constraints matrix A_eq * v = 0\n    # Rows: [glc_c, o2_c, ATP_c, ac_c]\n    A_eq = np.array([\n        [1.0, 0.0, -1.0, -1.0,  0.0,  0.0,  0.0],  # glc balance\n        [0.0, 1.0, -6.0,  0.0,  0.0,  0.0,  0.0],  # o2 balance\n        [0.0, 0.0, 30.0,  2.0, -10.0, -1.0,  0.0], # ATP balance\n        [0.0, 0.0,  0.0,  2.0,  0.0,  0.0, -1.0],  # acetate balance\n    ])\n    b_eq = np.zeros(4)\n\n    # Bounds for variables\n    bounds = [\n        (0.0, ub_glc),      # v_glc_in\n        (0.0, ub_o2),       # v_o2_in\n        (0.0, None),        # v_resp\n        (0.0, None),        # v_ferm\n        (0.0, None),        # v_biomass\n        (m_lb, None),       # v_maint (lower bound m)\n        (0.0, None),        # v_ac_ex\n    ]\n\n    # Objective: maximize v_biomass -> minimize -v_biomass\n    c = np.array([0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 0.0])\n\n    res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n    return res\n\ndef simulate_case(params, eps_overflow=1e-9, delta_glc=1e-9):\n    \"\"\"\n    Simulate one test case.\n    params: (C_glc0, C_o20, V_glc, V_o2, m, X0, T_end, dt)\n    Returns [t_overflow, t_glc_dep, C_ac_final, X_final]\n    \"\"\"\n    C_glc, C_o2, V_glc, V_o2, m, X, T_end, dt = params\n    C_ac = 0.0\n    t = 0.0\n    t_overflow = None\n    t_glc_dep = None\n\n    # Run until time end or glucose depletion\n    while t  T_end and C_glc > delta_glc:\n        # Solve FBA at current state\n        res = fba_step(C_glc, C_o2, V_glc, V_o2, m)\n        if not res.success:\n            # Infeasible or failed optimization; treat as zero growth and no fluxes\n            v = np.zeros(7)\n            v[5] = m  # attempt to respect maintenance bound; but no ATP => growth 0\n        else:\n            v = res.x\n\n        v_glc_in = max(0.0, v[0])\n        v_o2_in = max(0.0, v[1])\n        v_resp = max(0.0, v[2])\n        v_ferm = max(0.0, v[3])\n        v_bio = max(0.0, v[4])\n        v_maint = max(m, v[5])\n        v_ac_ex = max(0.0, v[6])\n\n        # Detect overflow onset\n        if v_ac_ex > eps_overflow and t_overflow is None:\n            t_overflow = t\n\n        # Store previous concentrations for depletion time detection\n        C_glc_prev = C_glc\n\n        # Euler updates using current X\n        glc_cons = v_glc_in * X * dt\n        o2_cons = v_o2_in * X * dt\n        ac_prod = v_ac_ex * X * dt\n        growth = v_bio * X * dt\n\n        C_glc = max(0.0, C_glc - glc_cons)\n        C_o2 = max(0.0, C_o2 - o2_cons)\n        C_ac = C_ac + ac_prod\n        X = X + growth\n\n        t += dt\n\n        # Record glucose depletion time when it first crosses below delta_glc\n        if C_glc = delta_glc and C_glc_prev > delta_glc and t_glc_dep is None:\n            t_glc_dep = t\n\n    # If simulation ended due to time, set t_glc_dep accordingly if not set\n    if t_glc_dep is None:\n        t_glc_dep = t\n\n    if t_overflow is None:\n        t_overflow_out = -1.0\n    else:\n        t_overflow_out = t_overflow\n\n    return [t_overflow_out, t_glc_dep, C_ac, X]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (C_glc0, C_o20, V_glc, V_o2, m, X0, T_end, dt)\n    test_cases = [\n        (100.0, 1000.0, 10.0, 60.0, 1.0, 0.1, 5.0, 0.005),  # Case A\n        (100.0, 50.0,   10.0, 10.0, 1.0, 0.1, 5.0, 0.005),  # Case B\n        (100.0, 20.0,   10.0, 60.0, 1.0, 0.1, 5.0, 0.005),  # Case C\n    ]\n\n    results = []\n    for case in test_cases:\n        t_overflow, t_glc_dep, C_ac_final, X_final = simulate_case(case, eps_overflow=1e-9, delta_glc=1e-9)\n        # Format to six decimals as strings; final assembly without spaces\n        formatted = [\n            f\"{t_overflow:.6f}\",\n            f\"{t_glc_dep:.6f}\",\n            f\"{C_ac_final:.6f}\",\n            f\"{X_final:.6f}\",\n        ]\n        results.append(f\"[{','.join(formatted)}]\")\n\n    # Final print statement in the exact required format: list of lists, no spaces\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2723964"}]}