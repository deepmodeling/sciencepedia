{"hands_on_practices": [{"introduction": "这个练习是理解基因驱动的基石。我们将从细胞层面开始，研究基于CRISPR的驱动元件如何在配子形成过程中操控自然的同源重组过程。通过推导杂合子个体产生的配子的预期分布，我们可以量化“归巢”效应，并理解它是如何导致偏向性遗传的——这正是基因驱动的根本动力。[@problem_id:2749933]", "problem": "一个经过工程改造的成簇规律间隔短回文重复序列（CRISPR）基因驱动等位基因（记为 $D$）被插入到一个基因座中，其编码一个CRISPR相关（Cas）核酸酶和一个向导，该向导靶向同源基因座上的野生型等位基因（记为 $W$）。$D$ 等位基因在靶点位置被重编码，因此它不会被自身表达的核酸酶识别和切割。考虑一个在该基因座上为杂合型 $D/W$ 的二倍体生殖系细胞。假设以下经过充分检验的事实为您推理的基础：(i) 根据孟德尔分离定律，每条同源染色体以 $1/2$ 的概率传递给一个配子；(ii) 当CRISPR在 $W$ 等位基因上诱导的双链断裂发生在减数分裂之前时，其修复方式有两种：要么是通过以 $D$ 等位基因为模板的同源定向修复（Homology-Directed Repair, HDR），要么是通过非同源末端连接（Non-Homologous End Joining, NHEJ）。HDR会将 $W$ 转化为 $D$，而NHEJ会在靶点产生一个对进一步切割具有抗性的突变；将这种突变等位基因称为 $R$。\n\n将该过程建模如下。在一个配子遗传了 $D/W$ 生殖系细胞中最初携带 $W$ 的染色体的条件下：\n- 概率为 $c$ 时，$W$ 上在减数分裂前会发生双链断裂。在发生断裂的条件下，修复以概率 $h$ 通过HDR进行（将 $W$ 转化为 $D$），或以概率 $n$ 通过NHEJ进行（将 $W$ 转化为 $R$）。假设 $h+n=1$。\n- 概率为 $1-c$ 时，不发生断裂，等位基因保持为 $W$。\n\n假设携带 $D$ 的染色体在遗传时从未被切割并完整传递。请仅使用全概率定律结合上述孟德尔分离定律的事实，推导出该 $D/W$ 生殖系细胞产生的单倍体配子基因型 $(D,R,W)$ 的期望分布，并用包含 $c$、$h$ 和 $n$ 的概率行向量表示。\n\n将您的最终答案表示为一个按 $(D,R,W)$ 顺序排列的、完全简化的单行向量。不需要进行数值计算或四舍五入，也不涉及单位。", "solution": "必须首先对问题陈述进行严格的验证。\n\n步骤1：提取已知条件。\n- 等位基因定义为 $D$ (驱动)、$W$ (野生型) 和 $R$ (抗性)。\n- 初始有机体是一个二倍体生殖系细胞，杂合型为 $D/W$。\n- 事实 (i)：孟德尔分离定律规定，每条同源染色体以 $1/2$ 的概率传递给一个配子。\n- 携带 $D$ 等位基因的染色体完整地传递。\n- 对于最初携带 $W$ 等位基因的染色体，其过程如下：\n- 概率为 $c$ 时，基因座发生双链断裂。\n- 在发生断裂的条件下，以概率 $h$ 通过同源定向修复 (HDR) 进行修复，将 $W$ 转化为 $D$。\n- 在发生断裂的条件下，以概率 $n$ 通过非同源末端连接 (NHEJ) 进行修复，将 $W$ 转化为 $R$。\n- 已知 $h+n=1$。\n- 概率为 $1-c$ 时，不发生断裂，等位基因保持为 $W$。\n- 目标是推导出单倍体配子基因型 $(D, R, W)$ 的期望分布，用 $c$、$h$ 和 $n$ 表示。\n\n步骤2：使用提取的已知条件进行验证。\n- 科学依据：该问题描述了一个基于CRISPR的归巢基因驱动的简化但标准且科学上公认的模型。HDR、NHEJ、等位基因转换和抗性的概念是基因驱动技术的基础。该模型是合成生物学和群体遗传学中使用的有效抽象。它不基于伪科学或事实错误。\n- 适定性：该问题是适定的。它提供了所有必要的参数（$c$、$h$、$n$）和一个明确的目标：计算概率分布。在理论建模中，使用符号参数而非数值是标准做法。问题结构允许基于概率论原理得出唯一解。\n- 客观性：语言精确、技术性强，没有主观或含糊的术语。\n\n步骤3：结论与行动。\n该问题具有科学依据、适定、客观且内部一致。这是将基础概率论应用于合成生物学模型的一个有效练习。因此，我将着手推导解决方案。\n\n从一个杂合的 $D/W$ 个体推导配子基因型分布的过程如下。我们必须计算一个配子遗传三种可能等位基因中每一种（$D$、$R$ 或 $W$）的总概率。这需要应用全概率定律，考虑配子的两种可能的染色体来源。\n\n设 $C_D$ 为配子遗传了最初携带 $D$ 等位基因的染色体的事件。\n设 $C_W$ 为配子遗传了最初携带 $W$ 等位基因的染色体的事件。\n\n根据孟德尔分离定律，这些事件的概率是：\n$$P(C_D) = \\frac{1}{2}$$\n$$P(C_W) = \\frac{1}{2}$$\n\n问题陈述指出，在其原始染色体上的 $D$ 等位基因是稳定的。因此，如果一个配子遗传了这条染色体（事件 $C_D$），其等位基因将是 $D$。条件概率是：\n$$P(\\text{配子是 } D \\mid C_D) = 1$$\n$$P(\\text{配子是 } R \\mid C_D) = 0$$\n$$P(\\text{配子是 } W \\mid C_D) = 0$$\n\n现在，我们必须考虑当一个配子遗传了最初携带 $W$ 等位基因的染色体（事件 $C_W$）时的结果。$W$ 等位基因可以被转换为 $D$ 或 $R$，或者保持为 $W$。该等位基因最终状态的概率由问题中描述的事件序列给出。\n- $C_W$ 染色体上的等位基因变为 $D$ 当且仅当发生断裂（概率为 $c$）并通过HDR修复（概率为 $h$）。这个联合事件的概率是各概率的乘积：\n$$P(\\text{配子是 } D \\mid C_W) = c \\times h = ch$$\n- $C_W$ 染色体上的等位基因变为 $R$ 当且仅当发生断裂（概率为 $c$）并通过NHEJ修复（概率为 $n$）。这个联合事件的概率是：\n$$P(\\text{配子是 } R \\mid C_W) = c \\times n = cn$$\n- $C_W$ 染色体上的等位基因保持为 $W$ 当且仅当不发生断裂（概率为 $1-c$）：\n$$P(\\text{配子是 } W \\mid C_W) = 1-c$$\n注意，$C_W$ 染色体的这三种结果是互斥且穷尽的：$ch + cn + (1-c) = c(h+n) + 1-c = c(1) + 1-c = 1$。\n\n我们现在可以使用全概率定律找到每种配子基因型的总概率：$P(G) = P(G \\mid C_D)P(C_D) + P(G \\mid C_W)P(C_W)$，其中 $G$ 是配子基因型。\n\n1.  $D$ 配子的概率，$P(D)$：\n$$P(D) = P(\\text{配子是 } D \\mid C_D)P(C_D) + P(\\text{配子是 } D \\mid C_W)P(C_W)$$\n$$P(D) = (1) \\times \\frac{1}{2} + (ch) \\times \\frac{1}{2} = \\frac{1+ch}{2}$$\n\n2.  $R$ 配子的概率，$P(R)$：\n$$P(R) = P(\\text{配子是 } R \\mid C_D)P(C_D) + P(\\text{配子是 } R \\mid C_W)P(C_W)$$\n$$P(R) = (0) \\times \\frac{1}{2} + (cn) \\times \\frac{1}{2} = \\frac{cn}{2}$$\n\n3.  $W$ 配子的概率，$P(W)$：\n$$P(W) = P(\\text{配子是 } W \\mid C_D)P(C_D) + P(\\text{配子是 } W \\mid C_W)P(C_W)$$\n$$P(W) = (0) \\times \\frac{1}{2} + (1-c) \\times \\frac{1}{2} = \\frac{1-c}{2}$$\n\n单倍体配子基因型 $(D, R, W)$ 的期望分布是这些概率组成的行向量。\n最终分布是 $\\left( \\frac{1+ch}{2}, \\frac{cn}{2}, \\frac{1-c}{2} \\right)$。\n这些概率之和为 $\\frac{1+ch}{2} + \\frac{cn}{2} + \\frac{1-c}{2} = \\frac{1+ch+cn+1-c}{2} = \\frac{2+c(h+n)-c}{2} = \\frac{2+c(1)-c}{2} = \\frac{2}{2} = 1$，这证实了该分布的有效性。\n问题要求答案用 $c$、$h$ 和 $n$ 表示，因此不需要进一步代换。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{1+ch}{2} & \\frac{cn}{2} & \\frac{1-c}{2} \\end{pmatrix}}$$", "id": "2749933"}, {"introduction": "在量化了驱动机制之后，我们现在将尺度放大到种群层面。这个实践探讨了一个关键问题：基因驱动是会传播开来，还是会被淘汰？我们将建立一个种群遗传学模型，该模型权衡了驱动的超孟德尔式遗传与其给宿主带来的任何适合度代价，从而推导出“入侵阈值”——驱动成功入侵种群所需的最低转换效率。[@problem_id:2749889]", "problem": "一位种群遗传学家正在为一个基于归巢（homing-based）的CRISPR（Clustered Regularly Interspaced Short Palindromic Repeats）基因驱动建立模型。该基因驱动通过在配子发生过程中切割野生型等位基因并复制自身来使遗传发生偏向。考虑一个大的、随机交配的泛交二倍体种群，在单个基因座上有两个等位基因：一个驱动等位基因 $D$ 和一个野生型等位基因 $W$。设 $p_t$ 为第 $t$ 代成年个体中 $D$ 的频率。假设以下机制和适合度细节：\n\n- 生命周期：成年个体产生配子，配子随机结合形成合子，然后在成年之前经历生存力选择。\n- 杂合的成年个体（$W D$）中的基因驱动机制：在生殖系中，野生型等位基因以概率 $c \\in [0,1]$ 被切割并转化为 $D$。如果发生转化，则该次减数分裂产生的所有配子都携带 $D$；如果转化失败，则遵循孟德尔分离定律。\n- 不会形成抗性等位基因，没有胚胎切割，也没有性别特异性。\n- 生存力选择：成年个体的适合度分别为 $W W$ 是 $1$，$W D$ 是 $1 - h s$，$D D$ 是 $1 - s$。其中 $s \\in [0,1)$ 是纯合子适合度代价，$h \\in [0,1]$ 是显性参数。\n\n基于这些假设和标准的随机交配种群遗传学（选择前的哈代-温伯格比例，以及生存力选择下基因型按比例存活），推导出临界转化概率 $c^{\\ast}$ 作为 $h$ 和 $s$ 的函数，使得当驱动等位基因 $D$ 稀有时其频率会增加，即当 $p_t \\to 0$ 时，$p_{t+1} > p_t$ 成立的充要条件是 $c > c^{\\ast}$。请用一个关于 $h$ 和 $s$ 的单一闭式解析表达式来表示你的最终结果。不需要进行数值近似或四舍五入。", "solution": "所述问题具有科学依据，在数学上是适定的，并且没有矛盾或歧义。它提出了一个理论种群遗传学中关于归巢式基因驱动的标准模型。因此，我们将着手解决它。\n\n目标是推导临界转化概率 $c^{\\ast}$，该概率允许驱动等位基因 $D$ 在稀有时频率增加。这是一个围绕不动点（其中 $D$ 的频率，记为 $p_t$，为零）的局部稳定性分析问题。当且仅当平凡平衡点 $p_t = 0$ 是不稳定的时，等位基因 $D$ 才能入侵种群。\n\n设 $p_t$ 为第 $t$ 代成年个体中驱动等位基因 $D$ 的频率，$1-p_t$ 为野生型等位基因 $W$ 的频率。假设种群是一个大的泛交群体，在生命周期开始时（第 $t$ 代成年个体）的基因型频率由哈代-温伯格比例给出：\n- $WW$ 成年个体的频率：$(1-p_t)^2$\n- $WD$ 成年个体的频率：$2p_t(1-p_t)$\n- $DD$ 成年个体的频率：$p_t^2$\n\n第一步是确定这些成年个体产生的配子库中 $D$ 等位基因的频率。\n- $DD$ 成年个体只产生 $D$ 配子。\n- $WW$ 成年个体只产生 $W$ 配子。\n- 在杂合的 $WD$ 成年个体中，基因驱动机制起作用。以概率 $c$，$W$ 等位基因被转化为 $D$，该个体产生 $100\\%$ 的 $D$ 配子。以概率 $1-c$，发生标准的孟德尔分离，该个体产生 $50\\%$ 的 $D$ 配子和 $50\\%$ 的 $W$ 配子。\n因此，$WD$ 杂合子产生的 $D$ 配子的平均比例是 $c \\cdot 1 + (1-c) \\cdot \\frac{1}{2} = \\frac{1+c}{2}$。\n\n配子库中 $D$ 等位基因的频率，我们记为 $p'$，是来自每种基因型的贡献之和，按其频率加权：\n$$p' = (p_t^2) \\cdot (1) + (2p_t(1-p_t)) \\cdot \\left(\\frac{1+c}{2}\\right) + ((1-p_t)^2) \\cdot (0)$$\n$$p' = p_t^2 + p_t(1-p_t)(1+c)$$\n$$p' = p_t^2 + p_t(1+c) - p_t^2(1+c)$$\n$$p' = p_t + c p_t - c p_t^2 = p_t + c p_t (1-p_t)$$\n这个方程给出了驱动机制作用后、选择发生前的等位基因频率。\n\n接下来，第 $t+1$ 代的合子由这些配子随机结合形成。合子中的基因型频率再次由哈代-温伯格比例给出，基于配子频率 $p'$：\n- $WW$ 合子的频率：$(1-p')^2$\n- $WD$ 合子的频率：$2p'(1-p')$\n- $DD$ 合子的频率：$(p')^2$\n\n这些合子受到生存力选择的影响，其适合度分别为 $w_{WW}=1$，$w_{WD}=1-hs$ 和 $w_{DD}=1-s$。第 $t+1$ 代成年个体中的基因型频率与其合子频率乘以各自的适合度成正比。\n种群的平均适合度 $\\bar{w}$ 是这些加权频率的总和：\n$$\\bar{w} = (1-p')^2 w_{WW} + 2p'(1-p') w_{WD} + (p')^2 w_{DD}$$\n$$\\bar{w} = (1-p')^2 + 2p'(1-p')(1-hs) + (p')^2(1-s)$$\n\n第 $t+1$ 代成年个体中 $D$ 等位基因的频率，记为 $p_{t+1}$，是根据选择后的基因型频率计算的。$D$ 等位基因的数量与 $2 \\times (\\text{freq } DD) + 1 \\times (\\text{freq } WD)$ 成正比。等位基因的总数与 $2 \\times \\bar{w}$ 成正比。\n$$p_{t+1} = \\frac{(p')^2(1-s) + p'(1-p')(1-hs)}{\\bar{w}}$$\n$$p_{t+1} = \\frac{p'(p'(1-s) + (1-p')(1-hs))}{\\bar{w}}$$\n$$p_{t+1} = \\frac{p'(1-hs + p'(hs-s))}{\\bar{w}}$$\n这是等位基因频率的完整递推关系。\n\n为了找到驱动在稀有时增加的条件，我们分析平衡点 $p_t=0$ 的稳定性。如果映射 $p_t \\mapsto p_{t+1}$ 在 $p_t=0$ 处求得的雅可比行列式（在此为导数）大于 $1$，则驱动能够入侵。这个雅可比行列式就是特征值 $\\lambda = \\left. \\frac{dp_{t+1}}{dp_t} \\right|_{p_t=0}$。\n\n使用链式法则，$\\frac{dp_{t+1}}{dp_t} = \\frac{dp_{t+1}}{dp'} \\frac{dp'}{dp_t}$。我们在 $p_t=0$ 处对它求值。\n首先，我们求 $\\frac{dp'}{dp_t}$：\n$$p' = p_t + cp_t - cp_t^2$$\n$$\\frac{dp'}{dp_t} = 1+c-2cp_t$$\n在 $p_t=0$ 处，我们有 $\\left. \\frac{dp'}{dp_t} \\right|_{p_t=0} = 1+c$。同时注意，在 $p_t=0$ 时，$p'=0$。\n\n接下来，我们求 $\\frac{dp_{t+1}}{dp'}$。令 $N(p') = p'(1-hs + p'(hs-s))$ 和 $D(p')=\\bar{w}$。那么 $p_{t+1} = \\frac{N(p')}{D(p')}$。\n根据商法则，$\\frac{dp_{t+1}}{dp'} = \\frac{N'(p')D(p') - N(p')D'(p')}{[D(p')]^2}$。\n我们在 $p'=0$ 处求值（因为 $p_t=0 \\implies p'=0$）。\n在 $p'=0$ 时：\n$N(0) = 0$。\n$D(0) = (1-0)^2 + 2(0)(1)(1-hs) + (0)^2(1-s) = 1$。\n导数的表达式简化为 $\\left. \\frac{dp_{t+1}}{dp'} \\right|_{p'=0} = \\frac{N'(0)D(0) - N(0)D'(0)}{[D(0)]^2} = \\frac{N'(0) \\cdot 1 - 0}{1^2} = N'(0)$。\n\n我们计算 $N'(p')$：\n$N'(p') = \\frac{d}{dp'}\\left[ p'(1-hs) + (p')^2(hs-s) \\right] = (1-hs) + 2p'(hs-s)$。\n在 $p'=0$ 时，$N'(0) = 1-hs$。\n因此，$\\left. \\frac{dp_{t+1}}{dp'} \\right|_{p'=0} = 1-hs$。\n\n结合这些结果，特征值 $\\lambda$ 是：\n$$\\lambda = \\left. \\frac{dp_{t+1}}{dp_t} \\right|_{p_t=0} = \\left( \\left. \\frac{dp_{t+1}}{dp'} \\right|_{p'=0} \\right) \\left( \\left. \\frac{dp'}{dp_t} \\right|_{p_t=0} \\right) = (1-hs)(1+c)$$\n\n当且仅当 $\\lambda > 1$ 时，$D$ 等位基因在稀有时频率增加。\n$$(1-hs)(1+c) > 1$$\n鉴于 $h \\in [0,1]$ 且 $s \\in [0,1)$，我们有 $hs  1$，这意味着 $1-hs$ 是一个正量。因此，我们可以用它来除不等式两边而不改变不等号的方向。\n$$1+c  \\frac{1}{1-hs}$$\n$$c  \\frac{1}{1-hs} - 1$$\n$$c  \\frac{1 - (1-hs)}{1-hs}$$\n$$c  \\frac{hs}{1-hs}$$\n这个不等式定义了驱动入侵的条件。临界转化概率 $c^{\\ast}$ 是使这个条件变为等式的阈值。\n$$c^{\\ast} = \\frac{hs}{1-hs}$$\n因此，当且仅当其转化概率 $c$ 超过这个临界值 $c^{\\ast}$ 时，驱动等位基因才会在稀有时频率增加。", "answer": "$$\\boxed{\\frac{hs}{1 - hs}}$$", "id": "2749889"}, {"introduction": "基因驱动的强大力量使其必须配备强大的安全与遏制措施。最后一个计算实践将我们从解析理论带到实际模拟，使我们能够评估高级遏制策略（如分裂驱动和菊花链驱动）的有效性。通过进行敏感性分析，我们可以了解生物学参数的不确定性如何影响这些安全机制的可靠性，这是任何基因驱动系统负责任设计中的关键一步。[@problem_id:2749949]", "problem": "考虑一个单一的、随机交配的二倍体种群，其在一个基因座上有两个等位基因：一个基于CRISPR的归巢基因驱动等位基因（表示为 $D$）和一个野生型等位基因（表示为 $W$）。设 $x_t$ 为第 $t$ 代合子中等位基因 $D$ 的频率。假设合子中存在经典的哈代-温伯格平衡，并且生存力选择由选择系数 $s$ 和显性系数 $h$ 表征，使得基因型适应度为 $w_{DD} = 1 - s$、$w_{DW} = 1 - h s$ 和 $w_{WW} = 1$。选择之后，假设在配子发生过程中，$D/W$ 杂合子以随时间变化的转换概率 $c_t \\in [0,1]$ 进行归巢（转换），从而导致 $D$ 的超孟德尔式遗传。在这些假设下，等位基因频率的更新 $x_{t} \\mapsto x_{t+1}$ 是通过首先计算选择后的基因型频率，然后计算每个基因型类别中 $D$ 的预期传递率来定义的。目标是实现这个动力学系统，并用它来评估通过调节 $c_t$ 的时间变化来实施的遏制策略。\n\n您需要实现三种遏制策略，每种策略将 $c_t$ 定义为时间及辅助状态变量的函数，并通过基于网格的敏感性分析来评估其对 $c$、$h$ 和 $s$ 不确定性的鲁棒性。所有表示比例或概率的量（包括等位基因频率和转换概率）都必须作为 $[0,1]$ 范围内的无单位小数处理。\n\n使用的基本定义：\n- 第 $t$ 代选择前的基因型频率为 $f_{DD} = x_t^2$、$f_{DW} = 2 x_t (1 - x_t)$ 和 $f_{WW} = (1 - x_t)^2$。\n- 选择后，未标准化的基因型频率为 $g_{DD} = w_{DD} f_{DD}$、$g_{DW} = w_{DW} f_{DW}$、$g_{WW} = w_{WW} f_{WW}$，平均适应度为 $\\overline{w} = g_{DD} + g_{DW} + g_{WW}$。标准化的选择后频率为 $p_{DD} = g_{DD}/\\overline{w}$、$p_{DW} = g_{DW}/\\overline{w}$ 和 $p_{WW} = g_{WW}/\\overline{w}$。\n- $D/W$ 杂合子传递等位基因 $D$ 的预期比例为 $\\frac{1}{2} (1 + c_t)$，而 $D/D$ 纯合子以概率 $1$ 传递等位基因 $D$，$W/W$ 纯合子以概率 $0$ 传递等位基因 $D$。\n- 因此，等位基因频率的更新公式为\n$$\nx_{t+1} \\;=\\; p_{DD} \\cdot 1 \\;+\\; p_{DW} \\cdot \\frac{1}{2} (1 + c_t) \\;+\\; p_{WW} \\cdot 0 \\, .\n$$\n\n要建模的遏制策略：\n- 策略S1（分离式驱动归巢）：释放两个不连锁的组件。设 $q_t$ 为归巢所需的核酸内切酶组件的频率。假设 $q_{t+1} = (1 - \\lambda)\\, q_t$，其中 $q_0 = x_0$，$\\lambda \\in [0,1]$ 代表因分离和任何额外负担造成的总损失。有效转换概率为 $c_t = c \\cdot q_t$。\n- 策略S2（菊花链式归巢）：使用长度为 $L \\in \\mathbb{N}$ 的菊花链来逐步限制归巢。归巢活性的确定性线性衰减近似为：对于整数 $t \\ge 0$，$c_t = c \\cdot \\max\\{0,\\, 1 - t/L\\}$。\n- 策略S3（阈值依赖型归巢）：归巢活性恒定为 $c_t = c$，遏制通过在名义入侵阈值 $\\hat{x}^{(0)}$ 以下释放来实现。该阈值是在名义参数 $(c_0,h_0,s_0)$ 下计算的，作为映射 $x \\mapsto x_{t+1}$ 的任何内部不动点（即在 $(c_0,h_0,s_0)$ 条件下 $x_{t+1} - x = 0$ 的一个解 $\\hat{x}^{(0)} \\in (0,1)$）。如果不存在这样的内部不动点，则取 $\\hat{x}^{(0)} = 0$。\n\n对于每个具有特定 $(c,h,s)$ 的模拟运行，需要检测的失效模式：\n- FM1（意外固定）：$\\max_{0 \\le t \\le G} x_t \\ge x_{\\mathrm{fix}}$。\n- FM2（不期望的持续存在）：$x_G \\ge x_{\\mathrm{persist}}$ 且FM1为假。\n- FM3（阈值突破；仅适用于S3）：使用在 $(c_0,h_0,s_0)$ 下计算的名义阈值 $\\hat{x}^{(0)}$，如果 $x_0  \\hat{x}^{(0)}$ 但存在 $t \\in \\{0,\\dots,G\\}$ 使得 $x_t \\ge \\hat{x}^{(0)}$。\n\n如果任何适用的失效模式为真，则该模拟运行被视为一次失效。\n\n敏感性分析规范：\n- 对每个测试用例，为 $(c,h,s)$ 定义矩形不确定性范围，形式为 $[c_{\\min}, c_{\\max}] \\times [h_{\\min}, h_{\\max}] \\times [s_{\\min}, s_{\\max}]$。\n- 使用全因子网格，每个参数在其对应区间上取 $N_c = N_h = N_s = 5$ 个均匀间隔的值，从而产生 $5 \\times 5 \\times 5 = 125$ 个参数三元组。\n- 对于每个三元组，使用指定的策略及其辅助参数和初始条件，模拟 $G$ 代的动力学过程，并评估是否失效。\n- 将失效概率报告为一个浮点数，等于失效次数除以 $125$。\n\n所有测试用例通用的数值规范：\n- 使用 $x_{\\mathrm{fix}} = 0.95$ 和 $x_{\\mathrm{persist}} = 0.05$。\n- 将 $x_t$ 和所有概率用作 $[0,1]$ 范围的小数。\n- 为避免数值问题，模拟必须在每一步将 $x_t$ 裁剪到闭区间 $[10^{-12}, 1 - 10^{-12}]$ 内。\n- 对于S3，通过在 $x \\in [10^{-6}, 1 - 10^{-6}]$ 上使用细网格扫描来数值计算 $\\hat{x}^{(0)}$，以检测 $x_{t+1} - x$ 的符号变化，并通过对第一个检测到的内部根进行二分法来精确求解。如果未找到根，则设 $\\hat{x}^{(0)} = 0$。\n\n测试套件：\n- 案例1（S1：分离式驱动，中等参数）：\n  - 策略：S1，其中 $\\lambda = 0.2$，$G = 150$，$x_0 = 0.05$。\n  - 不确定性范围：$c \\in [0.80, 0.95]$，$h \\in [0.00, 0.60]$，$s \\in [0.05, 0.20]$。\n- 案例2（S2：菊花链，中到高归巢效率）：\n  - 策略：S2，其中 $L = 6$，$G = 150$，$x_0 = 0.10$。\n  - 不确定性范围：$c \\in [0.85, 0.99]$，$h \\in [0.30, 0.70]$，$s \\in [0.10, 0.30]$。\n- 案例3（S3：高成本下的阈值依赖）：\n  - 策略：S3，其中 $G = 300$，$x_0 = 0.10$，并使用名义参数 $(c_0,h_0,s_0) = (0.55, 0.80, 0.90)$ 计算 $\\hat{x}^{(0)}$。\n  - 不确定性范围：$c \\in [0.45, 0.65]$，$h \\in [0.60, 1.00]$，$s \\in [0.70, 1.00]$。\n- 案例4（S1：分离式驱动，弱归巢和高成本的边界情况）：\n  - 策略：S1，其中 $\\lambda = 0.30$，$G = 150$，$x_0 = 0.05$。\n  - 不确定性范围：$c \\in [0.05, 0.25]$，$h \\in [0.00, 0.50]$，$s \\in [0.40, 0.60]$。\n\n您的程序必须：\n- 根据上述第一性原理实现等位基因频率更新。\n- 实现所定义的三种遏制策略。\n- 对每个测试用例，执行 $5 \\times 5 \\times 5$ 网格敏感性分析并计算失效概率（一个浮点数）。\n- 生成单行输出，其中包含案例1到4的四个失效概率，按顺序排列，四舍五入到3位小数，格式为方括号括起来的逗号分隔列表。例如，输出格式必须与 $[r_1,r_2,r_3,r_4]$ 完全一样，其中每个 $r_i$ 是格式化为3位小数的浮点数。", "solution": "该问题要求对基于CRISPR的基因驱动的遏制策略进行计算分析。此分析的基础是一个种群遗传学模型，该模型描述了驱动等位基因频率 $x_t$ 在离散世代 $t$ 中的演化。我们将首先推导控制方程，然后概述指定策略的实现方法和敏感性分析。\n\n**1. 等位基因频率更新方程的推导**\n\n我们为一个大的、随机交配的二倍体种群建模，该种群有两个等位基因：驱动等位基因 $D$ 和野生型等位基因 $W$。系统在第 $t$ 代的状态是 $D$ 等位基因的频率 $x_t$。\n\n生命周期被建模为两个阶段：生存力选择，然后是带有归巢的配子形成。\n\n**阶段1：生存力选择**\n在合子阶段，假设哈代-温伯格平衡，基因型频率为：\n-   $f_{DD} = x_t^2$\n-   $f_{DW} = 2 x_t (1 - x_t)$\n-   $f_{WW} = (1 - x_t)^2$\n\n这些合子受到生存力选择。相对适应度由 $w_{DD} = 1 - s$、$w_{DW} = 1 - h s$ 和 $w_{WW} = 1$ 给出，其中 $s$ 是选择系数，$h$ 是显性系数。存活到成年的基因型频率与其初始频率和适应度的乘积成正比。种群的平均适应度 $\\overline{w}_t$ 用于标准化这些频率：\n$$ \\overline{w}_t = f_{DD} w_{DD} + f_{DW} w_{DW} + f_{WW} w_{WW} = x_t^2 (1-s) + 2 x_t (1 - x_t) (1-hs) + (1 - x_t)^2 $$\n因此，选择后的基因型频率为：\n-   $p_{DD} = \\frac{x_t^2 (1-s)}{\\overline{w}_t}$\n-   $p_{DW} = \\frac{2 x_t (1 - x_t) (1-hs)}{\\overline{w}_t}$\n-   $p_{WW} = \\frac{(1 - x_t)^2}{\\overline{w}_t}$\n\n**阶段2：配子发生与归巢**\n在配子形成过程中，个体产生单倍体配子。由于归巢机制，杂合子中 $D$ 等位基因的传递存在偏向。\n-   $DD$ 个体只产生 $D$ 配子。$D$ 的比例为 $1$。\n-   $WW$ 个体只产生 $W$ 配子。$D$ 的比例为 $0$。\n-   $DW$ 杂合子以随时间变化的概率 $c_t$ 进行归巢。如果没有归巢，它将以 $1:1$ 的比例产生 $D$ 和 $W$ 配子。归巢将 $W$ 等位基因转换为 $D$ 等位基因，因此 $D$ 配子以更高的概率产生。来自 $DW$ 个体的 $D$ 配子的预期比例是 $\\frac{1+c_t}{2}$。\n\n**递推关系**\n下一代等位基因频率 $x_{t+1}$ 是来自每个选择后基因型类别的贡献的总和，按其频率加权：\n$$ x_{t+1} = p_{DD} \\cdot 1 + p_{DW} \\cdot \\frac{1+c_t}{2} + p_{WW} \\cdot 0 $$\n代入 $p_{DD}$ 和 $p_{DW}$ 的表达式，得到完整的更新方程：\n$$ x_{t+1} = \\frac{x_t^2 (1-s) + 2 x_t (1 - x_t) (1-hs) \\left( \\frac{1+c_t}{2} \\right)}{\\overline{w}_t} $$\n$$ x_{t+1} = \\frac{x_t^2 (1-s) + x_t (1 - x_t) (1-hs) (1+c_t)}{x_t^2 (1-s) + 2 x_t (1 - x_t) (1-hs) + (1 - x_t)^2} $$\n该方程是模拟的核心。每一步都会应用一个数值裁剪机制，确保 $x_t \\in [10^{-12}, 1 - 10^{-12}]$，以防止在 $0$ 和 $1$ 边界附近出现浮点错误。\n\n**2. 遏制策略与敏感性分析**\n\n问题指定了三种遏制策略，它们是关于转换概率 $c_t$ 时间演化的不同模型：\n-   **S1（分离式驱动）：**转换效率取决于共同释放的、不连锁的核酸内切酶组件的频率 $q_t$。$c_t = c \\cdot q_t$，其中 $c$ 是基础转换率，$q_t$ 按 $q_{t+1} = (1-\\lambda)q_t$ 衰减，初始条件为 $q_0=x_0$。\n-   **S2（菊花链）：**驱动构件被设计为在固定的 $L$ 代内丧失其归巢能力。这被建模为线性衰减：$c_t = c \\cdot \\max\\{0, 1 - t/L\\}$。\n-   **S3（阈值依赖）：**转换率恒定为 $c_t=c$。通过在理论入侵阈值 $\\hat{x}^{(0)}$ 以下的频率 $x_0$ 释放驱动来尝试遏制。该阈值是名义参数集 $(c_0, h_0, s_0)$ 下动力学的一个不稳定的内部不动点。它是通过数值求解 $x_{t+1}(x) - x = 0$ 在 $x \\in (0,1)$ 上的根找到的。我们将实现一个基于扫描后跟二分法的数值求根程序。如果没有找到内部根，则 $\\hat{x}^{(0)} = 0$。\n\n对于每种策略，都会进行敏感性分析以评估其鲁棒性。在指定的不确定性范围内生成一个 $5 \\times 5 \\times 5$ 的参数 $(c, h, s)$ 网格。对于这 $125$ 个参数集中的每一个，都对系统进行模拟，并根据以下标准将结果分类为“失效”：\n-   **FM1（固定）：** $\\max_{0 \\le t \\le G} x_t \\ge x_{\\mathrm{fix}} = 0.95$。\n-   **FM2（持续存在）：** $x_G \\ge x_{\\mathrm{persist}} = 0.05$ 且未满足FM1。\n-   **FM3（阈值突破，仅S3）：**如果 $x_0  \\hat{x}^{(0)}$，当 $\\max_{0 \\le t \\le G} x_t \\ge \\hat{x}^{(0)}$ 时发生失效。\n\n如果任何适用的模式被触发，则模拟运行为一次失效。每个测试用例的最终结果是失效概率，即总失效运行次数除以 $125$。\n\n实现将遵循模块化结构。一个核心函数将从 $x_t$ 计算 $x_{t+1}$。辅助函数将管理每种策略的模拟循环并检查失效模式。一个顶层函数将协调四个测试用例的敏感性分析并格式化最终输出。", "answer": "```python\nimport numpy as np\n\n# --- Global Constants and Numerical Specifications ---\nX_FIX = 0.95\nX_PERSIST = 0.05\nCLIP_MIN = 1e-12\nCLIP_MAX = 1.0 - 1e-12\n\ndef update_xt(xt, ct, s, h):\n    \"\"\"\n    Calculates the allele frequency for the next generation, x_{t+1}.\n    This function implements the core recurrence relation.\n    \"\"\"\n    if xt == 0.0:\n        return 0.0\n    if xt >= 1.0:\n        return 1.0\n\n    # Hardy-Weinberg frequencies\n    f_DD = xt**2\n    f_DW = 2 * xt * (1 - xt)\n    f_WW = (1 - xt)**2\n\n    # Fitnesses\n    w_DD = 1 - s\n    w_DW = 1 - h * s\n    w_WW = 1\n\n    # Mean fitness\n    w_bar = f_DD * w_DD + f_DW * w_DW + f_WW * w_WW\n\n    if w_bar == 0:\n        return xt\n    \n    # Post-selection frequencies\n    p_DD = (f_DD * w_DD) / w_bar\n    p_DW = (f_DW * w_DW) / w_bar\n    \n    # Homing and allele transmission\n    xt_plus_1 = p_DD * 1.0 + p_DW * 0.5 * (1.0 + ct)\n    \n    # Numerical clipping\n    xt_plus_1 = np.clip(xt_plus_1, CLIP_MIN, CLIP_MAX)\n    \n    return xt_plus_1\n\ndef bisection(func, a, b, tol=1e-9, max_iter=100):\n    \"\"\"\n    A simple bisection method to find a root of func in [a, b].\n    \"\"\"\n    fa = func(a)\n    fb = func(b)\n    if fa * fb >= 0:\n        # This should not happen if the interval is chosen correctly from scanning.\n        return None\n\n    for _ in range(max_iter):\n        c = (a + b) / 2.0\n        fc = func(c)\n        if abs(fc)  tol or (b - a) / 2.0  tol:\n            return c\n        if fa * fc  0:\n            b, fb = c, fc\n        else:\n            a, fa = c, fc\n    return (a + b) / 2.0\n\ndef compute_s3_threshold(c0, h0, s0):\n    \"\"\"\n    Computes the nominal invasion threshold for Strategy S3.\n    \"\"\"\n    def fixed_point_func(x):\n        return update_xt(x, c0, s0, h0) - x\n\n    # Scan for an interior root\n    scan_points = np.linspace(1e-6, 1.0 - 1e-6, 10001)\n    f_vals = np.array([fixed_point_func(x) for x in scan_points])\n    \n    # Find first sign change from positive to negative, indicating an unstable fixed point\n    # Drive increases if f(x) > 0 for small x.\n    for i in range(len(scan_points) - 1):\n        if f_vals[i] > 0 and f_vals[i+1] = 0:\n            root = bisection(fixed_point_func, scan_points[i], scan_points[i+1])\n            if root is not None:\n                return root\n            \n    return 0.0\n\ndef run_simulation(strategy, params, c, h, s, x_hat0=None):\n    \"\"\"\n    Runs a single simulation for a given strategy and parameter set.\n    Returns True if a failure occurs, False otherwise.\n    \"\"\"\n    x0 = params['x0']\n    G = params['G']\n\n    x_hist = np.zeros(G + 1)\n    x_hist[0] = x0\n    \n    # Strategy-specific initialization\n    if strategy == 'S1':\n        q_hist = np.zeros(G + 1)\n        q_hist[0] = x0\n        lambda_val = params['lambda']\n    \n    for t in range(G):\n        # Determine current conversion probability ct\n        if strategy == 'S1':\n            ct = c * q_hist[t]\n        elif strategy == 'S2':\n            L = params['L']\n            ct = c * max(0.0, 1.0 - t / L)\n        elif strategy == 'S3':\n            ct = c\n        else:\n            raise ValueError(f\"Unknown strategy: {strategy}\")\n\n        # Update allele frequency\n        x_hist[t+1] = update_xt(x_hist[t], ct, s, h)\n\n        # Update auxiliary variables\n        if strategy == 'S1':\n            q_hist[t+1] = (1.0 - lambda_val) * q_hist[t]\n\n    # Check for failure modes\n    max_x = np.max(x_hist)\n    x_G = x_hist[G]\n\n    fm1 = (max_x >= X_FIX)\n    fm2 = (x_G >= X_PERSIST) and not fm1\n    \n    failure = fm1 or fm2\n\n    if strategy == 'S3':\n        if x_hat0 and x0  x_hat0:\n            fm3 = max_x >= x_hat0\n            failure = failure or fm3\n            \n    return failure\n\ndef analyze_case(case_data):\n    \"\"\"\n    Performs sensitivity analysis for a single test case.\n    \"\"\"\n    strategy = case_data['strategy']\n    params = case_data['params']\n    c_range, h_range, s_range = case_data['ranges']\n    \n    c_vals = np.linspace(c_range[0], c_range[1], 5)\n    h_vals = np.linspace(h_range[0], h_range[1], 5)\n    s_vals = np.linspace(s_range[0], s_range[1], 5)\n    \n    x_hat0 = None\n    if strategy == 'S3':\n        c0, h0, s0 = case_data['nominal_params']\n        x_hat0 = compute_s3_threshold(c0, h0, s0)\n\n    failure_count = 0\n    total_runs = 125  # 5*5*5\n    \n    for c_i in c_vals:\n        for h_j in h_vals:\n            for s_k in s_vals:\n                if run_simulation(strategy, params, c_i, h_j, s_k, x_hat0=x_hat0):\n                    failure_count += 1\n    \n    return failure_count / total_runs\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run analyses, and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"id\": 1,\n            \"strategy\": \"S1\",\n            \"params\": {\"lambda\": 0.2, \"G\": 150, \"x0\": 0.05},\n            \"ranges\": ([0.80, 0.95], [0.00, 0.60], [0.05, 0.20]),\n        },\n        {\n            \"id\": 2,\n            \"strategy\": \"S2\",\n            \"params\": {\"L\": 6, \"G\": 150, \"x0\": 0.10},\n            \"ranges\": ([0.85, 0.99], [0.30, 0.70], [0.10, 0.30]),\n        },\n        {\n            \"id\": 3,\n            \"strategy\": \"S3\",\n            \"params\": {\"G\": 300, \"x0\": 0.10},\n            \"nominal_params\": (0.55, 0.80, 0.90),\n            \"ranges\": ([0.45, 0.65], [0.60, 1.00], [0.70, 1.00]),\n        },\n        {\n            \"id\": 4,\n            \"strategy\": \"S1\",\n            \"params\": {\"lambda\": 0.30, \"G\": 150, \"x0\": 0.05},\n            \"ranges\": ([0.05, 0.25], [0.00, 0.50], [0.40, 0.60]),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        failure_prob = analyze_case(case)\n        results.append(failure_prob)\n        \n    print(f\"[{','.join(f'{r:.3f}' for r in results)}]\")\n\nsolve()\n```", "id": "2749949"}]}