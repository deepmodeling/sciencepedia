{"hands_on_practices": [{"introduction": "生物圈的层级组织始于一个基本单元：物种。在比较动植物学研究中，准确界定物种边界是理解和量化生物多样性的基础。此练习将带您深入探讨物种划分问题，使用现代群体遗传学和贝叶斯统计中的一个强大工具——贝叶斯因子（Bayes factor），来量化评估关于物种形成的两种对立假设。通过分析一个经典的环状物种情景下的多基因座基因型数据 ([@problem_id:2580969])，您将亲手实践如何利用基因证据来推断生物组织的基本结构。", "problem": "您正在物种层面上研究生物圈的层级组织，通过比较两种关于蝾螈环物种情景中二倍体基因型如何在空间上组织的备择假说。这两种假说是：$H_1$（单一物种）：两个地理种群是单个随机交配的物种，在每个基因座上共享相同的等位基因频率；$H_2$（两个物种）：两个地理种群是不同的物种，在每个基因座上具有独立的等位基因频率。使用群体遗传学建模的基本假设，即在每个物种内，二倍体个体符合哈代-温伯格平衡（Hardy–Weinberg Equilibrium, HWE），并且在非连锁的基因座之间，给定等位基因频率，数据是独立的。在HWE下，等位基因计数是基因型数据的充分统计量。假设每个物种在每个基因座上的等位基因频率服从贝塔先验 $\\mathrm{Beta}(\\alpha,\\beta)$，其中 $\\alpha=\\beta=1$（等位基因频率的均匀先验）。对于每个基因座 $\\ell$，设数据为：在种群1中，总共 $m_{1\\ell}$ 次伯努利试验（染色体）中，有 $k_{1\\ell}$ 次成功（等位基因 $A$）；在种群2中，总共 $m_{2\\ell}$ 次试验中，有 $k_{2\\ell}$ 次成功。\n\n仅从以下基础出发：\n- 哈代-温伯格平衡（HWE）下等位基因计数的二项抽样模型。\n- 等位基因频率参数 $p$ 的贝塔先验 $\\mathrm{Beta}(\\alpha,\\beta)$。\n- 贝塔函数恒等式 $\\mathrm{B}(x,y)=\\dfrac{\\Gamma(x)\\Gamma(y)}{\\Gamma(x+y)}$ 及其在共轭贝塔-二项积分中的作用。\n- 非连锁基因座间的条件独立性。\n\n通过解析地对等位基因频率进行积分，推导单个基因座在 $H_1$ 和 $H_2$ 下的边际似然，然后推导多个基因座上的贝叶斯因子（BF），定义为 $B_{21}=\\dfrac{P(D\\mid H_2)}{P(D\\mid H_1)}$，其形式为各基因座比率的乘积。您的程序必须为每个测试用例计算所有基因座上的总证据，即 $\\log_{10} B_{21}$。\n\n测试套件。对于下面的每个测试用例，每个基因座由一个四元组 $(k_1,m_1,k_2,m_2)$ 指定，使用等位基因计数（对于二倍体，$m_i$ 是抽样个体数量的两倍）。所有基因座都是非连锁的，并使用 $\\alpha=\\beta=1$。计算每个用例的 $\\log_{10} B_{21}$，并四舍五入到 $6$ 位小数。\n\n- 测试用例 $1$（强烈的末端分化，与环物种中不同的末端形态一致）：\n  - 基因座：$(4,4,0,4)$, $(4,4,0,4)$, $(3,4,1,4)$, $(4,4,0,4)$, $(3,4,1,4)$。\n- 测试用例 $2$（分化很小，与环内部的单一物种一致）：\n  - 基因座：$(2,4,2,4)$, $(1,4,1,4)$, $(3,4,3,4)$, $(2,4,2,4)$, $(2,4,2,4)$。\n- 测试用例 $3$（中等分化，代表接触区的部分分化）：\n  - 基因座：$(3,4,2,4)$, $(2,4,1,4)$, $(3,4,2,4)$, $(2,4,1,4)$, $(2,4,2,4)$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目是对应测试用例的 $\\log_{10} B_{21}$ 值，四舍五入到 $6$ 位小数。例如，一个可接受的格式是 [$x_1,x_2,x_3$]，其中每个 $x_i$ 是一个小数点后恰好有 $6$ 位数字的浮点数。不允许有其他输出。", "solution": "所述问题经过了严格的验证。所有给定的假设和数据都是明确且自洽的。该框架基于群体遗传学和贝叶斯统计学的基本原理，特别是利用了贝塔-二项共轭模型，这是分析等位基因计数数据的标准方法。该问题是适定的，可以从所提供的信息中推导出唯一的解。待比较的假说 $H_1$ 和 $H_2$ 是针对观测数据的明确定义且相互排斥的模型。目标明确，需要进行贝叶斯模型选择中的标准计算。因此，该问题被认为是有效的，现在将推导其形式化解。\n\n任务是计算贝叶斯因子 $B_{21}$，它用于比较两种关于种群结构的假说。设 $D$ 为观测数据，它包含 $L$ 个非连锁基因座上的等位基因计数。对于每个基因座 $\\ell \\in \\{1, \\dots, L\\}$，数据为 $D_\\ell = (k_{1\\ell}, m_{1\\ell}, k_{2\\ell}, m_{2\\ell})$，其中 $k_{i\\ell}$ 是从地理种群 $i$ 抽样的 $m_{i\\ell}$ 个总等位基因中等位基因“A”的计数。\n\n贝叶斯因子定义为两种假说下数据的边际似然之比：\n$$ B_{21} = \\frac{P(D \\mid H_2)}{P(D \\mid H_1)} $$\n由于基因座非连锁，在给定一个假说的情况下，数据在基因座之间是条件独立的。因此，总贝叶斯因子是每个基因座贝叶斯因子的乘积：\n$$ B_{21} = \\prod_{\\ell=1}^{L} \\frac{P(D_\\ell \\mid H_2)}{P(D_\\ell \\mid H_1)} = \\prod_{\\ell=1}^{L} B_{21, \\ell} $$\n要求的输出是该数量以10为底的对数，即各基因座对数贝叶斯因子的总和：\n$$ \\log_{10}(B_{21}) = \\sum_{\\ell=1}^{L} \\log_{10}(B_{21, \\ell}) $$\n我们接下来推导单个基因座 $\\ell$ 的边际似然。为清晰起见，本节将省略下标 $\\ell$。\n\n一个模型的边际似然（或证据）是通过对参数的先验分布上的似然函数进行积分得到的。一般形式为 $P(D \\mid H) = \\int P(D \\mid \\theta, H) P(\\theta \\mid H) d\\theta$。\n等位基因计数的抽样分布是二项分布。对于一个大小为 $m$、等位基因频率为 $p$ 的样本，观测到 $k$ 个该等位基因拷贝的概率是：\n$$ P(k \\mid m, p) = \\binom{m}{k} p^k (1-p)^{m-k} $$\n等位基因频率 $p$ 的先验分布是贝塔分布：\n$$ P(p \\mid \\alpha, \\beta) = \\frac{p^{\\alpha-1} (1-p)^{\\beta-1}}{B(\\alpha, \\beta)} $$\n其中 $B(\\alpha, \\beta) = \\frac{\\Gamma(\\alpha)\\Gamma(\\beta)}{\\Gamma(\\alpha+\\beta)}$ 是贝塔函数。问题指定了均匀先验，这对应于设置超参数 $\\alpha=1$ 和 $\\beta=1$。\n\n**$H_1$（单一物种）下的边际似然：**\n在 $H_1$ 下，两个种群共享一个单一的等位基因频率 $p$。来自两个种群的数据 $D = (k_1, m_1, k_2, m_2)$ 可以合并。总成功次数为 $k_{tot} = k_1 + k_2$，总试验次数为 $m_{tot} = m_1 + m_2$。给定 $p$ 的数据似然为：\n$$ P(D \\mid p, H_1) = P(k_1 \\mid m_1, p) P(k_2 \\mid m_2, p) = \\binom{m_1}{k_1} p^{k_1} (1-p)^{m_1-k_1} \\binom{m_2}{k_2} p^{k_2} (1-p)^{m_2-k_2} $$\n$$ P(D \\mid p, H_1) = \\binom{m_1}{k_1} \\binom{m_2}{k_2} p^{k_{tot}} (1-p)^{m_{tot}-k_{tot}} $$\n边际似然是对 $p$ 的先验上的似然函数进行积分：\n$$ P(D \\mid H_1) = \\int_0^1 \\binom{m_1}{k_1} \\binom{m_2}{k_2} p^{k_{tot}} (1-p)^{m_{tot}-k_{tot}} \\frac{p^{\\alpha-1} (1-p)^{\\beta-1}}{B(\\alpha, \\beta)} dp $$\n$$ P(D \\mid H_1) = \\frac{\\binom{m_1}{k_1} \\binom{m_2}{k_2}}{B(\\alpha, \\beta)} \\int_0^1 p^{k_{tot}+\\alpha-1} (1-p)^{m_{tot}-k_{tot}+\\beta-1} dp $$\n将该积分识别为贝塔函数的定义，我们得到贝塔-二项概率：\n$$ P(D \\mid H_1) = \\binom{m_1}{k_1} \\binom{m_2}{k_2} \\frac{B(k_{tot}+\\alpha, m_{tot}-k_{tot}+\\beta)}{B(\\alpha, \\beta)} $$\n\n**$H_2$（两个物种）下的边际似然：**\n在 $H_2$ 下，两个种群具有独立的等位基因频率 $p_1$ 和 $p_2$，每个频率都有独立的先验 $P(p_i \\mid \\alpha, \\beta) = \\mathrm{Beta}(\\alpha, \\beta)$。似然函数因此分解，边际似然积分也随之分解：\n$$ P(D \\mid H_2) = \\left( \\int_0^1 P(k_1 \\mid m_1, p_1) P(p_1) dp_1 \\right) \\times \\left( \\int_0^1 P(k_2 \\mid m_2, p_2) P(p_2) dp_2 \\right) $$\n每一项都是一个独立的贝塔-二项计算：\n$$ P(D \\mid H_2) = \\left( \\binom{m_1}{k_1} \\frac{B(k_1+\\alpha, m_1-k_1+\\beta)}{B(\\alpha, \\beta)} \\right) \\times \\left( \\binom{m_2}{k_2} \\frac{B(k_2+\\alpha, m_2-k_2+\\beta)}{B(\\alpha, \\beta)} \\right) $$\n\n**单个基因座的贝叶斯因子：**\n我们现在构建 $B_{21, \\ell}$ 的比率。二项式系数项 $\\binom{m_1}{k_1}$ 和 $\\binom{m_2}{k_2}$ 被约掉，一个 $B(\\alpha, \\beta)$ 项也被约掉：\n$$ B_{21} = \\frac{P(D \\mid H_2)}{P(D \\mid H_1)} = \\frac{B(k_1+\\alpha, m_1-k_1+\\beta) \\cdot B(k_2+\\alpha, m_2-k_2+\\beta)}{B(\\alpha, \\beta) \\cdot B(k_1+k_2+\\alpha, m_1+m_2-k_1-k_2+\\beta)} $$\n对于指定的均匀先验，$\\alpha=1$ 和 $\\beta=1$。这简化了表达式，因为 $B(1, 1) = \\frac{\\Gamma(1)\\Gamma(1)}{\\Gamma(2)} = 1$。\n$$ B_{21} = \\frac{B(k_1+1, m_1-k_1+1) \\cdot B(k_2+1, m_2-k_2+1)}{B(k_1+k_2+1, m_1+m_2-k_1-k_2+1)} $$\n为避免由阶乘产生极大或极小数值而导致的数值不稳定性，必须使用对数伽马函数 $\\ln \\Gamma(x)$ 在对数空间中进行计算。贝塔函数的自然对数是 $\\ln B(x, y) = \\ln \\Gamma(x) + \\ln \\Gamma(y) - \\ln \\Gamma(x+y)$。每个基因座贝叶斯因子的自然对数是：\n$$ \\ln(B_{21, \\ell}) = \\ln B(k_{1\\ell}+1, m_{1\\ell}-k_{1\\ell}+1) + \\ln B(k_{2\\ell}+1, m_{2\\ell}-k_{2\\ell}+1) - \\ln B(k_{1\\ell}+k_{2\\ell}+1, m_{1\\ell}+m_{2\\ell}-k_{1\\ell}-k_{2\\ell}+1) $$\n所有基因座上的总对数贝叶斯因子是这些单位点项的总和：\n$$ \\ln(B_{21}) = \\sum_{\\ell=1}^{L} \\ln(B_{21, \\ell}) $$\n最后，为了得到以10为底的结果，我们使用换底公式：\n$$ \\log_{10}(B_{21}) = \\frac{\\ln(B_{21})}{\\ln(10)} $$\n算法是遍历每个测试用例，并对每个用例，遍历其基因座。对于每个基因座，使用带有对数伽马函数的上述公式计算 $\\ln(B_{21, \\ell})$。将这些值求和，转换为以10为底的对数，并报告结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gammaln\n\ndef solve():\n    \"\"\"\n    Computes the log10 Bayes Factor (B_21) for species delimitation\n    based on allele count data across multiple loci.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each locus is a tuple (k1, m1, k2, m2).\n    test_cases = [\n        # Test case 1 (strong terminal divergence)\n        [\n            (4, 4, 0, 4),\n            (4, 4, 0, 4),\n            (3, 4, 1, 4),\n            (4, 4, 0, 4),\n            (3, 4, 1, 4),\n        ],\n        # Test case 2 (little divergence)\n        [\n            (2, 4, 2, 4),\n            (1, 4, 1, 4),\n            (3, 4, 3, 4),\n            (2, 4, 2, 4),\n            (2, 4, 2, 4),\n        ],\n        # Test case 3 (intermediate divergence)\n        [\n            (3, 4, 2, 4),\n            (2, 4, 1, 4),\n            (3, 4, 2, 4),\n            (2, 4, 1, 4),\n            (2, 4, 2, 4),\n        ],\n    ]\n\n    # Hyperparameters for the Beta prior. a=b=1 corresponds to a uniform prior.\n    alpha = 1.0\n    beta = 1.0\n\n    def calculate_ln_B21_for_locus(k1, m1, k2, m2, a, b):\n        \"\"\"\n        Calculates the natural logarithm of the Bayes Factor B_21 for a single locus.\n        B_21 = P(Data|H2) / P(Data|H1)\n        \"\"\"\n        # Calculate log of Beta function, ln B(x, y) = gammaln(x) + gammaln(y) - gammaln(x+y)\n\n        # Numerator of B_21: Product of Beta functions for H2 (two independent species)\n        # ln( B(k1+a, m1-k1+b) * B(k2+a, m2-k2+b) )\n        ln_num = (gammaln(k1 + a) + gammaln(m1 - k1 + b) - gammaln(m1 + a + b)) + \\\n                 (gammaln(k2 + a) + gammaln(m2 - k2 + b) - gammaln(m2 + a + b))\n\n        # Denominator of B_21: Product of Beta functions for H1 (one species, pooled data)\n        # ln( B(a,b) * B(k1+k2+a, m1+m2-k1-k2+b) )\n        k_tot = k1 + k2\n        m_tot = m1 + m2\n        ln_den = (gammaln(a) + gammaln(b) - gammaln(a + b)) + \\\n                 (gammaln(k_tot + a) + gammaln(m_tot - k_tot + b) - gammaln(m_tot + a + b))\n        \n        # ln(B_21) = ln(numerator) - ln(denominator)\n        ln_B21 = ln_num - ln_den\n        return ln_B21\n\n    results = []\n    for case_loci in test_cases:\n        total_ln_B21 = 0.0\n        for locus in case_loci:\n            k1, m1, k2, m2 = locus\n            total_ln_B21 += calculate_ln_B21_for_locus(k1, m1, k2, m2, alpha, beta)\n        \n        # Convert total natural log Bayes Factor to log base 10\n        log10_B21 = total_ln_B21 / np.log(10)\n        \n        # Format the result to 6 decimal places\n        results.append(f\"{log10_B21:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2580969"}, {"introduction": "从物种层面向上，我们进入由多物种相互作用构成的群落。群落并非物种的简单堆砌，其结构与稳定性源于捕食、竞争等复杂的生态关系网。该练习将引导您从第一性原理出发，构建一个异速生长营养网络，其中物种间的相互作用强度由其身体质量（body mass）比决定。通过将个体层面的基本特征（身体质量）与群落层面的涌现属性（稳定性）联系起来 ([@problem_id:2580979])，您将深入理解等级组织中“部分之和大于整体”的生态学原理。", "problem": "要求您形式化一个异速生长营养网络，并评估一个由广义 Lotka–Volterra 动力学支配的群落的某个可行平衡点的局部稳定性。请根据下文给出的第一性原理从头开始构建所有内容，并实现一个程序，为多个测试用例计算群落雅可比矩阵的主导实部特征值以及一个布尔值的稳定性判断。\n\n基本基础：\n- 广义 Lotka–Volterra (GLV) 种群动力学：对于每个物种索引 $i \\in \\{1,\\dots,S\\}$，其丰度为 $x_i(t)$，动力学方程为\n$$\n\\frac{d x_i}{d t} \\;=\\; x_i \\left( r_i + \\sum_{j=1}^{S} a_{ij} x_j \\right).\n$$\n- 一个满足 $x_i^\\ast  0$ 的平衡点 $(x_1^\\ast,\\dots,x_S^\\ast)$ 的局部稳定性要求该平衡点处雅可比矩阵的所有特征值都具有严格为负的实部。\n- GLV 系统在可行平衡点处的雅可比矩阵满足\n$$\nJ \\;=\\; \\mathrm{diag}(x^\\ast) \\, A,\n$$\n因为在平衡点处，对于每个 $i$ 都有 $r_i + \\sum_{j} a_{ij} x_j^\\ast = 0$，因此对所有 $i,j$ 都有 $J_{ij} = x_i^\\ast a_{ij}$。\n\n相互作用矩阵的异速生长构建：\n- 给定物种 $i \\in \\{1,\\dots,S\\}$ 的体重 $M_i$（单位为千克）。通过体重比率规则定义一个有向营养邻接关系 $L_{ij} \\in \\{0,1\\}$\n$$\nL_{ij} \\;=\\; \\begin{cases}\n1,  \\text{如果 } i \\neq j \\text{ 且 } \\dfrac{M_i}{M_j} \\ge \\theta,\\\\\n0,  \\text{否则,}\n\\end{cases}\n$$\n意味着物种 $i$ 捕食物种 $j$ 当且仅当满足体重比率阈值 $\\theta$。\n- 设 $b_0  0$ 为基础相互作用尺度，$\\alpha \\in \\mathbb{R}$ 为异速生长指数，$e \\in (0,1]$ 为生物量转换效率。对于每个满足 $L_{ij}=1$ 且比率为 $R_{ij} = M_i/M_j$ 的消费者-资源链接，定义人均效应强度\n$$\nb_{ij} \\;=\\; b_0 \\, R_{ij}^{\\alpha}.\n$$\n- 组装具有捕食者-猎物符号结构的相互作用矩阵 $A \\in \\mathbb{R}^{S \\times S}$：\n$$\na_{ij} \\;=\\; \\begin{cases}\n+ e \\, b_{ij},  \\text{如果 } L_{ij}=1 \\text{（猎物 } j \\text{ 对捕食者 } i \\text{ 的影响）},\\\\\n- b_{ji},  \\text{如果 } L_{ji}=1 \\text{（捕食者 } j \\text{ 对猎物 } i \\text{ 的影响）},\\\\\n0,  \\text{否则,}\n\\end{cases}\n$$\n以及种内自我调节\n$$\na_{ii} \\;=\\; - s,\n$$\n对于给定的 $s  0$（在本问题中假定所有物种的该值相同）。\n\n异速生长平衡点锚定：\n- 假设一个受 Damuth 定律启发的、可行的平衡丰度标度关系：对于常数 $c0$ 和 $\\beta0$，\n$$\nx_i^\\ast \\;=\\; c \\, M_i^{-\\beta}.\n$$\n- 通过在 $x^\\ast$ 处强制可行性来定义内禀增长率 $r \\in \\mathbb{R}^S$：设置\n$$\nr \\;=\\; - A \\, x^\\ast,\n$$\n从而通过构造使得 $x^\\ast$ 成为 GLV 系统的一个平衡点。\n\n稳定性目标：\n- 计算 $J = \\mathrm{diag}(x^\\ast) A$，然后计算 $J$ 的谱。令 $\\lambda_{\\max}$ 表示 $J$ 所有特征值中的最大实部。该平衡点是局部渐近稳定的当且仅当 $\\lambda_{\\max}  0$。\n\n算法任务：\n- 对于下面的每个测试用例，依次构建 $L$、$A$、$x^\\ast$、$r$ 和 $J$，最后计算 $\\lambda_{\\max}$ 和一个布尔稳定性判断 $S$。$S$ 定义为：如果 $\\lambda_{\\max}  -\\varepsilon$ 则 $S=\\text{True}$，否则 $S=\\text{False}$，其中 $\\varepsilon = 10^{-9}$ 是一个严格的数值容差。\n- 为每个用例报告序对 $[S, \\lambda_{\\max}]$，其中 $\\lambda_{\\max}$ 四舍五入到 6 位小数。\n\n物理和数值单位：\n- 体重输入 $M_i$ 的单位是千克。没有输出量需要物理单位。\n\n角度单位：\n- 不涉及角度。\n\n输出格式：\n- 您的程序应生成单行输出，其中包含一个顶层列表，其长度等于测试用例的数量。每个元素必须是一个包含两个元素的列表 $[S_i,\\lambda_i]$，其中 $S_i$ 是一个布尔值，$\\lambda_i$ 是一个四舍五入到 6 位小数的浮点数。例如：$[[\\text{True},-0.123456],[\\text{False},0.010000]]$。\n\n测试套件：\n使用以下四个测试用例。每个用例都提供了 $S$、以千克为单位的质量 $\\{M_i\\}_{i=1}^S$ 以及参数 $(\\theta, b_0, \\alpha, e, s, c, \\beta)$。\n\n- 用例 1（基线链，中等耦合）：\n  - $S = 4$\n  - $M = [\\,0.01,\\,0.1,\\,1,\\,10\\,]$\n  - $\\theta = 10$, $b_0 = 0.05$, $\\alpha = 0.25$, $e = 0.2$, $s = 1.0$, $c = 1000$, $\\beta = 0.75$\n- 用例 2（相同拓扑上的更强耦合）：\n  - $S = 4$\n  - $M = [\\,0.01,\\,0.1,\\,1,\\,10\\,]$\n  - $\\theta = 10$, $b_0 = 0.5$, $\\alpha = 0.25$, $e = 0.2$, $s = 1.0$, $c = 1000$, $\\beta = 0.75$\n- 用例 3（通过更高阈值产生的更稀疏的营养链接）：\n  - $S = 4$\n  - $M = [\\,0.01,\\,0.1,\\,1,\\,10\\,]$\n  - $\\theta = 100$, $b_0 = 0.5$, $\\alpha = 0.25$, $e = 0.2$, $s = 1.0$, $c = 1000$, $\\beta = 0.75$\n- 用例 4（更宽的质量谱，修改了指数和自调节）：\n  - $S = 5$\n  - $M = [\\,0.002,\\,0.02,\\,0.2,\\,2,\\,20\\,]$\n  - $\\theta = 10$, $b_0 = 0.2$, $\\alpha = 0.5$, $e = 0.3$, $s = 1.2$, $c = 800$, $\\beta = 0.75$\n\n程序必须完全按照所述方式实现构建，并输出包含列表 $[[S_1,\\lambda_1], [S_2,\\lambda_2], [S_3,\\lambda_3], [S_4,\\lambda_4]]$ 的单行结果，其中每个 $\\lambda_i$ 都四舍五入到 6 位小数。", "solution": "问题陈述经过验证。\n\n已知条件提取如下：\n1.  **系统动力学**：广义 Lotka–Volterra (GLV) 方程描述了 $S$ 个物种的种群动力学，其丰度为 $x_i(t)$：\n    $$ \\frac{d x_i}{d t} = x_i \\left( r_i + \\sum_{j=1}^{S} a_{ij} x_j \\right) $$\n    对于每个物种 $i \\in \\{1, \\dots, S\\}$。\n2.  **平衡点与稳定性**：一个所有 $x_i^\\ast  0$ 的平衡点 $x^\\ast = (x_1^\\ast, \\dots, x_S^\\ast)$ 是局部渐近稳定的，如果其在 $x^\\ast$ 处评估的雅可比矩阵 $J$ 的所有特征值都具有严格为负的实部。\n3.  **雅可比矩阵**：在可行平衡点处，雅可比矩阵由 $J = \\mathrm{diag}(x^\\ast) A$ 给出，其中 $A$ 是相互作用矩阵。这源于平衡条件 $r_i + \\sum_{j=1}^{S} a_{ij} x_j^\\ast = 0$。\n4.  **营养网络结构**：使用体重 $M_i$ 和阈值 $\\theta$ 定义了一个有向邻接矩阵 $L \\in \\{0, 1\\}^{S \\times S}$：\n    $$ L_{ij} = \\begin{cases} 1,  \\text{如果 } i \\neq j \\text{ 且 } \\frac{M_i}{M_j} \\ge \\theta \\\\ 0,  \\text{否则} \\end{cases} $$\n5.  **相互作用矩阵的构建**：\n    -   对于一个链接 $L_{ij}=1$，人均相互作用强度为 $b_{ij} = b_0 (M_i/M_j)^{\\alpha}$，其中 $b_0  0$ 且 $\\alpha \\in \\mathbb{R}$。\n    -   相互作用矩阵 $A \\in \\mathbb{R}^{S \\times S}$ 定义如下：\n        $$ a_{ij} = \\begin{cases} + e \\, b_{ij},  \\text{如果 } L_{ij}=1 \\\\ - b_{ji},  \\text{如果 } L_{ji}=1 \\\\ 0,  \\text{否则} \\end{cases} \\quad \\text{对于 } i \\neq j $$\n        对于给定的 $s  0$，种内竞争为 $a_{ii} = -s$。参数 $e \\in (0,1]$ 是生物量转换效率。\n6.  **平衡丰度**：假设一个可行的平衡点 $x^\\ast$ 遵循异速生长标度律：\n    $$ x_i^\\ast = c \\, M_i^{-\\beta} $$\n    对于常数 $c  0$ 和 $\\beta  0$。内禀增长率被设置为 $r = -A x^\\ast$ 以确保 $x^\\ast$ 是一个平衡点。\n7.  **计算目标**：\n    -   计算雅可比矩阵 $J = \\mathrm{diag}(x^\\ast) A$。\n    -   确定 $J$ 的特征值的最大实部，记为 $\\lambda_{\\max}$。\n    -   如果 $\\lambda_{\\max}  -\\varepsilon$，稳定性判断 $S$ 为 $\\text{True}$，否则为 $\\text{False}$，数值容差为 $\\varepsilon = 10^{-9}$。\n    -   为每个测试用例报告序对 $[S, \\lambda_{\\max}]$，其中 $\\lambda_{\\max}$ 四舍五入到 6 位小数。\n8.  **测试用例**：提供了四个不同的测试用例，指定了所有必要的参数 $(S, \\{M_i\\}, \\theta, b_0, \\alpha, e, s, c, \\beta)$。\n\n验证表明该问题具有科学依据、适定且客观。它基于理论生态学（Lotka-Volterra 动力学、异速生长标度）和动力系统理论（局部稳定性分析）的既定原则。该问题提供了一套完整、明确且自洽的指令和参数，构成了一个定义明确的计算任务。未检测到科学、逻辑或数学上的缺陷。因此，该问题被认为是**有效的**。\n\n解决方案按照指定的方式，逐步构建所需的数学对象。\n\n该过程从每个测试用例给定的体重 $\\{M_i\\}_{i=1}^S$ 和参数开始。\n\n首先，我们构建营养邻接矩阵 $L$。对于每对不同的物种 $(i, j)$，我们计算质量比 $R_{ij} = M_i/M_j$。如果 $R_{ij} \\ge \\theta$，则物种 $i$ 捕食物种 $j$，我们设置矩阵元素 $L_{ij} = 1$。否则，$L_{ij} = 0$。条件 $i \\neq j$ 确保没有自我消耗。对于给定的测试集，其中所有质量都是不同的且 $\\theta  1$，任何一对 $(i, j)$ 不可能同时满足 $L_{ij}=1$ 和 $L_{ji}=1$。\n\n其次，我们构建群落相互作用矩阵 $A \\in \\mathbb{R}^{S \\times S}$。对角元素被设置为表示种内竞争：$a_{ii} = -s$。对于非对角元素，我们首先为所有存在营养链接的物种对 $(i, j)$（即 $L_{ij} = 1$）计算人均相互作用强度 $b_{ij} = b_0 R_{ij}^{\\alpha}$。然后根据捕食者-猎物动力学填充 $A$ 的元素：\n-   如果 $L_{ij} = 1$（物种 $i$ 吃物种 $j$），猎物 $j$ 对捕食者 $i$ 的影响是正的：$a_{ij} = +e \\cdot b_{ij}$。\n-   反之，捕食者 $i$ 对猎物 $j$ 的影响是负的。这对应于元素 $a_{ji}$，其相关的营养链接是 $L_{ij}=1$。问题陈述暗示，对于项 $a_{ji}$，链接是从 $i$ 到 $j$，即 $L_{ij}=1$。规则表述为：如果 $L_{ji}=1$，则 $a_{ij} = -b_{ji}$。因此，对于 $i$ 捕食 $j$ 的一对 $(i, j)$，我们有 $a_{ij} = e b_{ij}$ 和 $a_{ji} = -b_{ij}$。\n\n第三，我们确定平衡丰度向量 $x^\\ast$。这是根据异速生长标度律 $x_i^\\ast = c M_i^{-\\beta}$ 直接为每个物种 $i$ 计算得出的。\n\n第四，我们构建系统在平衡点 $x^\\ast$ 处的雅可比矩阵 $J$。如指定， $J = \\mathrm{diag}(x^\\ast) A$。因此，雅可比矩阵的第 $(i, j)$ 个元素是 $J_{ij} = x_i^\\ast a_{ij}$。对角元素是 $J_{ii} = x_i^\\ast a_{ii} = -s x_i^\\ast$。非对角元素是 $J_{ij} = x_i^\\ast a_{ij}$（对于 $i \\neq j$）。\n\n最后，我们进行稳定性分析。我们计算矩阵 $J$ 的特征值集合 $\\{\\lambda_k\\}_{k=1}^S$。平衡点的局部稳定性由这些特征值的最大实部的符号决定，即 $\\lambda_{\\max} = \\max_k \\{ \\mathrm{Re}(\\lambda_k) \\}$。当且仅当 $\\lambda_{\\max}  0$ 时，该平衡点是局部渐近稳定的。我们应用所提供的严格数值标准：如果 $\\lambda_{\\max}  -10^{-9}$，则稳定性判断 $S$ 为 $\\text{True}$，否则为 $\\text{False}$。\n\n将此程序应用于四个测试用例中的每一个，以获得最终结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the stability of allometric trophic networks for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"S\": 4,\n            \"M\": np.array([0.01, 0.1, 1, 10]),\n            \"params\": {\"theta\": 10.0, \"b0\": 0.05, \"alpha\": 0.25, \"e\": 0.2, \"s\": 1.0, \"c\": 1000.0, \"beta\": 0.75}\n        },\n        {\n            \"case_id\": 2,\n            \"S\": 4,\n            \"M\": np.array([0.01, 0.1, 1, 10]),\n            \"params\": {\"theta\": 10.0, \"b0\": 0.5, \"alpha\": 0.25, \"e\": 0.2, \"s\": 1.0, \"c\": 1000.0, \"beta\": 0.75}\n        },\n        {\n            \"case_id\": 3,\n            \"S\": 4,\n            \"M\": np.array([0.01, 0.1, 1, 10]),\n            \"params\": {\"theta\": 100.0, \"b0\": 0.5, \"alpha\": 0.25, \"e\": 0.2, \"s\": 1.0, \"c\": 1000.0, \"beta\": 0.75}\n        },\n        {\n            \"case_id\": 4,\n            \"S\": 5,\n            \"M\": np.array([0.002, 0.02, 0.2, 2, 20]),\n            \"params\": {\"theta\": 10.0, \"b0\": 0.2, \"alpha\": 0.5, \"e\": 0.3, \"s\": 1.2, \"c\": 800.0, \"beta\": 0.75}\n        }\n    ]\n\n    results = []\n    epsilon = 1e-9\n\n    for case in test_cases:\n        S = case[\"S\"]\n        M = case[\"M\"]\n        p = case[\"params\"]\n        \n        # Step 1: Construct trophic adjacency matrix L\n        # R_ij = M_i / M_j. Using numpy broadcasting for efficiency.\n        R = M[:, np.newaxis] / M\n        L = (R >= p[\"theta\"]).astype(float)\n        np.fill_diagonal(L, 0) # Enforce i != j\n\n        # Step 2: Construct interaction matrix A\n        A = np.zeros((S, S))\n        \n        # Calculate per-capita interaction magnitudes b_ij\n        b = p[\"b0\"] * (R ** p[\"alpha\"])\n        \n        # Populate off-diagonal elements of A based on L\n        # a_ij = +e * b_ij for predator i on prey j (L_ij = 1)\n        # a_ji = -b_ij for predator i on prey j (L_ij = 1)\n        # We can vectorize this: A_predator_gain = e * (b * L)\n        # A_prey_loss = -(b * L).T\n        A = p[\"e\"] * (b * L) - (b * L).T\n\n        # Set diagonal elements for intraspecific self-regulation\n        np.fill_diagonal(A, -p[\"s\"])\n\n        # Step 3: Construct equilibrium abundance vector x*\n        x_star = p[\"c\"] * (M ** -p[\"beta\"])\n\n        # Step 4: Construct the Jacobian matrix J = diag(x*) @ A\n        J = np.diag(x_star) @ A\n        \n        # Step 5: Compute eigenvalues and determine stability\n        eigenvalues = np.linalg.eigvals(J)\n        lambda_max = np.max(np.real(eigenvalues))\n        \n        is_stable = lambda_max  -epsilon\n        \n        results.append([is_stable, round(lambda_max, 6)])\n\n    # Format output as a single string\n    output_str = \"[\" + \",\".join([f\"[{str(r[0]).lower()},{r[1]:.6f}]\" for r in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```", "id": "2580979"}, {"introduction": "在生态系统尺度上，宏观生态学模式（macroecological patterns）揭示了生命系统的普适性组织规律。生物量大小谱（biomass size spectrum）是其中一个核心模式，它描述了生态系统中总生物量如何跨越从微生物到大型动物的所有生物，在不同体型等级间进行分配。此练习将让您扮演一位定量生态学家，处理一个整合了浮游植物和微型浮游动物的假想调查数据 ([@problem_id:2581030])。您将学习如何计算归一化生物量谱，并检验其是否遵循幂律（power-law）分布，从而掌握分析生态系统功能结构的关键技能。", "problem": "生物圈层级组织的一个中心主题是生物量按生物体型大小的跨营养级聚集，这一现象横跨自养（植物性）和异养（动物性）的分类单元。在大小谱生态学中，归一化生物量谱将总生物量在对数体质量分组内进行汇总，并按对数质量的组宽进行归一化，从而得到一个可以在不同分组和生态系统之间进行比较的量。一个普遍的经验观察是，归一化生物量谱在不同大小等级上呈现幂律标度关系。现给定一项在温带大陆架上综合了浮游植物和微型浮游动物数据的按大小分级的调查。该调查对所有分组的采样面积范围相同，并报告了每个分组中的总生物量，以及体质量的分组界限。\n\n六个连续的质量分组（单位为克）由以下边界定义：$m_{0} = 10^{-7}$，$m_{1} = 10^{-6.5}$，$m_{2} = 10^{-6}$，$m_{3} = 10^{-5.5}$，$m_{4} = 10^{-5}$，$m_{5} = 10^{-4.5}$ 和 $m_{6} = 10^{-4}$。对于每个分组 $i \\in \\{1,\\dots,6\\}$，其下边界和上边界为 $[m_{i-1}, m_{i}]$。每个分组的总调查面积为 $A = 2$ 平方千米。在每个分组中观测到的总生物量（汇总了该分组内的所有分类单元）为：\n- 分组 $1$ ($[10^{-7}, 10^{-6.5}]$ g): $10^{1.0}$ kg\n- 分组 $2$ ($[10^{-6.5}, 10^{-6}]$ g): $10^{0.8}$ kg\n- 分组 $3$ ($[10^{-6}, 10^{-5.5}]$ g): $10^{0.6}$ kg\n- 分组 $4$ ($[10^{-5.5}, 10^{-5}]$ g): $10^{0.4}$ kg\n- 分组 $5$ ($[10^{-5}, 10^{-4.5}]$ g): $10^{0.2}$ kg\n- 分组 $6$ ($[10^{-4.5}, 10^{-4}]$ g): $10^{0.0}$ kg\n\n任务：\n1) 对每个分组 $i$，计算归一化生物量谱值 $B^{\\ast}_{i}$，即每单位面积每单位十倍程体质量的生物量，单位为千克每平方千米每十倍程。使用以10为底的对数将组宽定义为 $\\Delta_{i} = \\log_{10}(m_{i}/m_{i-1})$（单位：十倍程）。那么 $B^{\\ast}_{i}$ 是分组 $i$ 中的面生物量密度除以 $\\Delta_{i}$。\n2) 令 $m^{\\mathrm{mid}}_{i}$ 为分组 $i$ 的几何中点。假设存在幂律标度关系 $B^{\\ast} \\propto m^{b}$。使用以10为底的对数，通过六个分组的 $\\log_{10} B^{\\ast}_{i}$ 与 $\\log_{10} m^{\\mathrm{mid}}_{i}$ 之间的线性关系，用普通最小二乘法 (OLS) 估计标度指数 $b$。\n\n报告估计的指数 $b$，作为一个无量纲数，四舍五入到三位有效数字。整个计算过程均使用以10为底的对数。不要报告任何中间量；只报告 $b$。", "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 体质量分组边界：$m_0 = 10^{-7}$ g, $m_1 = 10^{-6.5}$ g, $m_2 = 10^{-6}$ g, $m_3 = 10^{-5.5}$ g, $m_4 = 10^{-5}$ g, $m_5 = 10^{-4.5}$ g, $m_6 = 10^{-4}$ g。\n- 分组 $i$ 由区间 $[m_{i-1}, m_{i}]$ 定义，其中 $i \\in \\{1,\\dots,6\\}$。\n- 每个分组的总调查面积：$A = 2$ 平方千米。\n- 每个分组中观测到的总生物量：\n  - 分组 $1$：$M_1 = 10^{1.0}$ kg\n  - 分组 $2$：$M_2 = 10^{0.8}$ kg\n  - 分组 $3$：$M_3 = 10^{0.6}$ kg\n  - 分组 $4$：$M_4 = 10^{0.4}$ kg\n  - 分组 $5$：$M_5 = 10^{0.2}$ kg\n  - 分组 $6$：$M_6 = 10^{0.0}$ kg\n- 分组 $i$ 的归一化生物量谱的定义：$B^{\\ast}_{i}$，即每单位面积每单位十倍程体质量的生物量。\n- 组宽的定义（单位：十倍程）：$\\Delta_{i} = \\log_{10}(m_{i}/m_{i-1})$。\n- $B^{\\ast}_{i}$ 的公式：分组 $i$ 中的面生物量密度除以 $\\Delta_{i}$。\n- 分组中点的定义：$m^{\\mathrm{mid}}_{i}$ 是分组 $i$ 的几何中点。\n- 假设的标度定律：$B^{\\ast} \\propto m^{b}$。\n- 任务：通过 $\\log_{10} B^{\\ast}_{i}$ 与 $\\log_{10} m^{\\mathrm{mid}}_{i}$ 的线性关系，用普通最小二乘法 (OLS) 估计标度指数 $b$。\n- 报告要求：报告 $b$，四舍五入到三位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n根据验证标准对问题进行评估。\n- **科学依据**：该问题基于大小谱生态学（定量生态学的一个子领域）的既定原则。归一化生物量谱、对数分箱和幂律标度的概念在该领域是标准概念。该问题是这些原则的直接应用。\n- **适定性**：该问题是适定的。它提供了执行所需计算的所有必要数据和清晰定义。任务具体，并能导出唯一解。\n- **客观性**：问题陈述客观，使用了精确的科学和数学术语。没有主观或含糊不清的陈述。\n- **完整性和一致性**：数据是自洽且一致的。明确提供了组宽和归一化生物量的定义。\n- **真实性**：质量、生物量和面积的数值在一个海洋生态系统浮游生物调查的合理范围内。\n- **结构**：问题结构逻辑清晰，首先要求计算一个派生量（$B^{\\ast}_{i}$），然后使用这些值进行统计估计（$b$）。\n\n**步骤3：结论与行动**\n问题被判定为有效。它具有科学合理性、适定性和客观性。可以开始求解过程。\n\n**解题过程**\n\n解题过程按问题任务的要求分为两部分。\n\n**第一部分：计算归一化生物量谱 ($B^{\\ast}_{i}$)**\n\n第 $i$ 个分组的归一化生物量谱 $B^{\\ast}_{i}$ 定义为该分组中的总生物量 $M_i$ 除以调查面积 $A$ 和该分组的对数宽度 $\\Delta_i$。\n$$ B^{\\ast}_{i} = \\frac{M_i / A}{\\Delta_{i}} = \\frac{M_i}{A \\cdot \\Delta_{i}} $$\n组宽（以十倍程为单位）由 $\\Delta_{i} = \\log_{10}(m_{i}/m_{i-1})$ 给出。分组边界由 $m_i = 10^{-7+0.5i}$ 给出，其中 $i \\in \\{0, 1, \\dots, 6\\}$。\n我们来计算 $\\Delta_i$：\n$$ \\Delta_i = \\log_{10}(m_i) - \\log_{10}(m_{i-1}) $$\n分组 $i$ 上边界的对数是 $\\log_{10}(m_i) = -7 + 0.5i$。\n分组 $i$ 下边界的对数是 $\\log_{10}(m_{i-1}) = -7 + 0.5(i-1) = -7.5 + 0.5i$。\n因此，所有分组的组宽是恒定的：\n$$ \\Delta_i = (-7 + 0.5i) - (-7.5 + 0.5i) = 0.5 $$\n$\\Delta_i$ 的单位是十倍程。调查面积给定为 $A = 2 \\text{ km}^2$。\n$B^{\\ast}_{i}$ 表达式的分母是恒定的：\n$$ A \\cdot \\Delta_i = (2 \\text{ km}^2) \\cdot (0.5 \\text{ decades}) = 1 \\text{ km}^2 \\cdot \\text{decade} $$\n因此，每个分组的归一化生物量谱简化为：\n$$ B^{\\ast}_{i} = \\frac{M_i}{1 \\text{ km}^2 \\cdot \\text{decade}} $$\n数值上，$B^{\\ast}_{i}$ 的值等于 $M_i$ 的值，单位为 $\\text{kg} \\cdot \\text{km}^{-2} \\cdot \\text{decade}^{-1}$。给定的 $M_i$ 值直接得出 $B^{\\ast}_{i}$ 的值：\n- $B^{\\ast}_1 = 10^{1.0}$\n- $B^{\\ast}_2 = 10^{0.8}$\n- $B^{\\ast}_3 = 10^{0.6}$\n- $B^{\\ast}_4 = 10^{0.4}$\n- $B^{\\ast}_5 = 10^{0.2}$\n- $B^{\\ast}_6 = 10^{0.0}$\n\n**第二部分：估计标度指数 ($b$)**\n\n问题假设存在幂律关系 $B^{\\ast} \\propto m^b$，可以写成 $B^{\\ast} = C \\cdot m^{b}$，其中 $C$ 是某个常数。对此方程取以10为底的对数，得到一个线性关系：\n$$ \\log_{10}(B^{\\ast}) = \\log_{10}(C) + b \\cdot \\log_{10}(m) $$\n这是一个 $y = c + bx$ 形式的方程，其中 $y = \\log_{10}(B^{\\ast})$，$x = \\log_{10}(m)$，截距是 $c=\\log_{10}(C)$，斜率是所求的指数 $b$。我们将对数据点 $(x_i, y_i)$ 进行线性回归，其中 $x_i = \\log_{10}(m^{\\mathrm{mid}}_{i})$ 且 $y_i = \\log_{10}(B^{\\ast}_{i})$。\n\n首先，我们计算每个分组 $i \\in \\{1, \\dots, 6\\}$ 的 $y_i = \\log_{10}(B^{\\ast}_{i})$ 值：\n- $y_1 = \\log_{10}(10^{1.0}) = 1.0$\n- $y_2 = \\log_{10}(10^{0.8}) = 0.8$\n- $y_3 = \\log_{10}(10^{0.6}) = 0.6$\n- $y_4 = \\log_{10}(10^{0.4}) = 0.4$\n- $y_5 = \\log_{10}(10^{0.2}) = 0.2$\n- $y_6 = \\log_{10}(10^{0.0}) = 0.0$\n\n接下来，我们计算 $x_i = \\log_{10}(m^{\\mathrm{mid}}_{i})$ 的值。几何中点 $m^{\\mathrm{mid}}_{i}$ 是 $\\sqrt{m_{i-1}m_i}$。其对数是分组边界对数的算术平均值：\n$$ x_i = \\log_{10}(\\sqrt{m_{i-1}m_i}) = \\frac{1}{2}\\left(\\log_{10}(m_{i-1}) + \\log_{10}(m_i)\\right) $$\n- $x_1 = \\frac{1}{2}(\\log_{10}(10^{-7}) + \\log_{10}(10^{-6.5})) = \\frac{1}{2}(-7 - 6.5) = -6.75$\n- $x_2 = \\frac{1}{2}(\\log_{10}(10^{-6.5}) + \\log_{10}(10^{-6})) = \\frac{1}{2}(-6.5 - 6) = -6.25$\n- $x_3 = \\frac{1}{2}(\\log_{10}(10^{-6}) + \\log_{10}(10^{-5.5})) = \\frac{1}{2}(-6 - 5.5) = -5.75$\n- $x_4 = \\frac{1}{2}(\\log_{10}(10^{-5.5}) + \\log_{10}(10^{-5})) = \\frac{1}{2}(-5.5 - 5) = -5.25$\n- $x_5 = \\frac{1}{2}(\\log_{10}(10^{-5}) + \\log_{10}(10^{-4.5})) = \\frac{1}{2}(-5 - 4.5) = -4.75$\n- $x_6 = \\frac{1}{2}(\\log_{10}(10^{-4.5}) + \\log_{10}(10^{-4})) = \\frac{1}{2}(-4.5 - 4) = -4.25$\n\n现在我们有 $N=6$ 对数据点 $(x_i, y_i)$：\n$(-6.75, 1.0)$, $(-6.25, 0.8)$, $(-5.75, 0.6)$, $(-5.25, 0.4)$, $(-4.75, 0.2)$, $(-4.25, 0.0)$。\n\n普通最小二乘回归线的斜率 $b$ 由下式给出：\n$$ b = \\frac{\\sum_{i=1}^{N} (x_i - \\bar{x})(y_i - \\bar{y})}{\\sum_{i=1}^{N} (x_i - \\bar{x})^2} $$\n我们观察到 $x_i$ 和 $y_i$ 的值都构成等差数列。$x_i$ 值以 $0.5$ 的恒定步长增加，而 $y_i$ 值以 $0.2$ 的恒定步长减少。这意味着数据点完全位于一条直线上。对于这类数据，OLS拟合是精确的，斜率可以从任意两点计算得出。让我们使用前两个点 $(x_1, y_1)$ 和 $(x_2, y_2)$：\n$$ b = \\frac{\\Delta y}{\\Delta x} = \\frac{y_2 - y_1}{x_2 - x_1} = \\frac{0.8 - 1.0}{-6.25 - (-6.75)} = \\frac{-0.2}{0.5} = -0.4 $$\n为了验证，使用第一个和最后一个点：\n$$ b = \\frac{y_6 - y_1}{x_6 - x_1} = \\frac{0.0 - 1.0}{-4.25 - (-6.75)} = \\frac{-1.0}{2.5} = -0.4 $$\n结果是精确的。标度指数为 $b = -0.4$。问题要求答案四舍五入到三位有效数字。\n\n估计的指数是 $b = -0.400$。", "answer": "$$ \\boxed{-0.400} $$", "id": "2581030"}]}