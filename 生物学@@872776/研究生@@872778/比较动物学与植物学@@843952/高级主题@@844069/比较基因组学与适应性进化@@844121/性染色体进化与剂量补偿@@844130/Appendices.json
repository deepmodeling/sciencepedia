{"hands_on_practices": [{"introduction": "理解剂量补偿机制始于建立清晰的定量预测。本练习将通过从第一性原理出发，推导不同剂量补偿模型下X连锁基因在雄性和雌性间的预期表达差异，来帮助您构建这一基础。掌握这些理论预期是在解释真实、复杂的转录组数据之前至关重要的一步，它能够让您明确在不同生物学情景下应该寻找何种信号。 [@problem_id:2609734]", "problem": "在许多动植物中，性染色体的进化导致了独特的剂量补偿机制，这些机制改变了雄性和雌性之间的有效基因剂量。考虑一个物种中的X连锁基因，其中雄性为XY（一条X染色体），雌性为XX（两条X染色体）。设一个X连锁基因的每个活性拷贝的基础表达量为 $e_X$，定义为在没有剂量调节的情况下，每个活性X连锁基因拷贝的预期表达产出。对于一个给定的基因，雄性与雌性之间以2为底的对数倍数变化（log2 fold-change (LFC)）定义为 $Y = \\log_{2}\\!\\left(M/F\\right)$，其中 $M$ 和 $F$ 分别是该基因在雄性和雌性中的预期表达水平。\n\n使用以下经过充分检验的出发点：\n- 基因表达产出与活性基因拷贝数乘以每个拷贝的转录产出成正比。\n- 在独立性假设下，混合的期望等于期望的混合（全期望定律）。\n- 以2为底的对数倍数变化为 $Y = \\log_{2}\\!\\left(M\\right) - \\log_{2}\\!\\left(F\\right)$。\n\n考虑三种经典的剂量机制：\n1) 完全上调：雄性的单条X染色体表达上调两倍，以匹配雌性两条活性X拷贝的产出；雌性不使X染色体失活，也不上调X染色体表达。\n2) X染色体失活：雌性使一条X染色体失活，从而只剩下一条活性X染色体，两性均无表达上调。\n3) 无补偿：雌性保留两条活性X拷贝，两性均不对X染色体表达进行上调或下调。\n\na) 根据第一性原理和上述定义，推导在每种机制（1-3）下，一个X连锁基因的预期雄性-雌性log2倍数变化 $Y$ 的表达式，仅用 $e_X$ 和数值常数表示。\n\nb) 在一个来自近缘进化枝的包含 $n$ 个X连锁基因的经验数据集中，观测到的 $Y$ 值在基因间的分布近似为正态分布，样本均值为 $\\bar{Y} = -0.1$，样本方差为 $s^{2} = 0.25$。假设每个基因属于两个潜在类别之一：“补偿”（意味着其预期 $Y$ 等于您为机制1或2推导出的值）的概率为 $1-p$，或“无补偿”（意味着其预期 $Y$ 等于您为机制3推导出的值）的概率为 $p$。假设存在一个可加的、零均值的、基因特异性的噪声项，其在所有基因中具有共同方差 $\\sigma^{2}$，且与类别无关，其中 $\\sigma^{2} = 0.16$。使用全期望定律，将混合期望 $\\mathbb{E}[Y]$ 用 $p$ 和(a)部分中特定机制下的期望来表示。然后，使用经验均值 $\\bar{Y}$ 作为 $\\mathbb{E}[Y]$ 的估计值，计算出 $\\hat{p}$ 的估计值。\n\n将 $\\hat{p}$ 的最终数值估计表示为小数，并四舍五入到四位有效数字。", "solution": "该问题具有科学依据、良定且客观。所有参数和条件都得到了充分定义，可以得到唯一解。术语“补偿”中的潜在模糊性在计算后得以解决，因为两种指定的机制都得出相同的预期对数倍数变化。该问题被宣布为有效。\n\n(a)部分：预期Log2倍数变化($Y$)的推导\n\n雄性-雌性以2为底的对数倍数变化定义为 $Y = \\log_{2}(M/F)$，其中 $M$ 和 $F$ 分别是雄性和雌性中的预期基因表达水平。基因表达与活性基因拷贝数乘以每个拷贝的转录产出 $e_X$ 成正比。我们按如下方式分析每种剂量补偿机制。\n\n1) 机制1：完全上调。\n在此机制下，雄性拥有一条X染色体，其表达上调两倍。因此，每个拷贝的表达量为 $2e_X$。雄性的总表达量为：\n$$M = 1 \\times (2e_X) = 2e_X$$\n雌性有两条X染色体，没有失活也没有上调。每个拷贝的表达量是基础值 $e_X$。雌性的总表达量为：\n$$F = 2 \\times e_X = 2e_X$$\n因此，预期的log2倍数变化 $Y_1$ 为：\n$$Y_1 = \\log_{2}\\left(\\frac{M}{F}\\right) = \\log_{2}\\left(\\frac{2e_X}{2e_X}\\right) = \\log_{2}(1) = 0$$\n\n2) 机制2：X染色体失活。\n在此机制下，两性都没有表达上调。所有活性拷贝的每个拷贝表达量为 $e_X$。雄性有一条活性X染色体：\n$$M = 1 \\times e_X = e_X$$\n雌性使其两条X染色体中的一条失活，只留下一条活性拷贝：\n$$F = 1 \\times e_X = e_X$$\n预期的log2倍数变化 $Y_2$ 为：\n$$Y_2 = \\log_{2}\\left(\\frac{M}{F}\\right) = \\log_{2}\\left(\\frac{e_X}{e_X}\\right) = \\log_{2}(1) = 0$$\n\n3) 机制3：无补偿。\n在此机制下，两性都没有表达调控。每个拷贝的表达量为 $e_X$。雄性有一条活性X染色体：\n$$M = 1 \\times e_X = e_X$$\n雌性有两条活性X染色体：\n$$F = 2 \\times e_X = 2e_X$$\n预期的log2倍数变化 $Y_3$ 为：\n$$Y_3 = \\log_{2}\\left(\\frac{M}{F}\\right) = \\log_{2}\\left(\\frac{e_X}{2e_X}\\right) = \\log_{2}\\left(\\frac{1}{2}\\right) = -1$$\n\n总之，对于补偿机制（1和2），预期的log2倍数变化为 $Y=0$，对于无补偿机制（3），预期的log2倍数变化为 $Y=-1$。\n\n(b)部分：无补偿基因比例（$p$）的估计\n\n给定一个混合模型，其中每个基因属于两个潜在类别之一。设 $C$ 是一个表示基因类别的随机变量。\n- “补偿”类别（$C_{\\text{comp}}$）：预期的log2倍数变化为 $\\mathbb{E}[Y | C=C_{\\text{comp}}] = 0$。这种情况发生的概率为 $P(C=C_{\\text{comp}}) = 1-p$。\n- “无补偿”类别（$C_{\\text{no-comp}}$）：预期的log2倍数变化为 $\\mathbb{E}[Y | C=C_{\\text{no-comp}}] = -1$。这种情况发生的概率为 $P(C=C_{\\text{no-comp}}) = p$。\n\n任何基因的 $Y$ 的观测值是其类条件期望和一个零均值噪声项的和。根据全期望定律，$Y$ 的无条件期望，记为 $\\mathbb{E}[Y]$，是条件期望的加权平均：\n$$\\mathbb{E}[Y] = \\mathbb{E}[Y | C=C_{\\text{comp}}] \\cdot P(C=C_{\\text{comp}}) + \\mathbb{E}[Y | C=C_{\\text{no-comp}}] \\cdot P(C=C_{\\text{no-comp}})$$\n代入(a)部分推导出的值和给定的概率：\n$$\\mathbb{E}[Y] = (0) \\cdot (1-p) + (-1) \\cdot p = -p$$\n问题指出，经验样本均值 $\\bar{Y} = -0.1$ 将用作真实混合期望 $\\mathbb{E}[Y]$ 的估计值。因此，我们可以写出：\n$$\\hat{\\mathbb{E}}[Y] = \\bar{Y} = -0.1$$\n通过将理论期望与其经验估计相等，我们可以求解 $p$ 的估计值，记为 $\\hat{p}$：\n$$- \\hat{p} = -0.1$$\n$$\\hat{p} = 0.1$$\n问题要求答案四舍五入到四位有效数字。因此，估计值为 $\\hat{p} = 0.1000$。根据问题的明确指示，即只使用全期望定律和样本均值，关于样本方差（$s^2=0.25$）和噪声方差（$\\sigma^2=0.16$）的额外信息在此计算中是不需要的。", "answer": "$$\\boxed{0.1000}$$", "id": "2609734"}, {"introduction": "理论模型为我们提供了清晰的预期，但真实的生物学数据总是伴随着技术噪音和生物学变异。本练习将引导您完成一个模拟的计算生物信息学工作流程，从原始的RNA测序读数出发，通过数据标准化和统计检验，来判断是否存在雄性X染色体的表达上调。通过这个实践，您将掌握分析真实基因组数据以验证剂量补偿假说的核心计算技能。 [@problem_id:2609729]", "problem": "您将执行一项基于比较动物学和植物学的计算任务，重点关注节肢动物，特别是果蝇（Drosophila）的性染色体演化和剂量补偿机制。请使用以下基本依据：(i) 一个基因的核糖核酸测序（RNA-seq）读取计数与其转录本丰度乘以文库大小成正比；(ii) 在雄性异配子中，X染色体剂量失衡可通过提高雄性X连锁表达的调控机制来抵消；(iii) 必须进行跨样本标准化才能比较两性之间的表达，这可以通过常染色体基线法来解决，以控制非剂量补偿引起的全局文库大小和性别特异性偏移。\n\n任务。给定一个基因列表，每个基因都标明为X连锁或常染色体，并附有相关的雄性和雌性读取计数，请计算每个基因的雄性对雌性表达差异，通过常染色体基线对该差异进行标准化，并使用参数检验来检验雄性X染色体是否上调。\n\n定义和要求步骤：\n- 对于每个基因索引 $i$，设 $M_i$ 和 $F_i$ 分别表示观察到的雄性和雌性读取计数。为处理零值并避免除以零，在计算比率前，对 $M_i$ 和 $F_i$ 均加上一个伪计数 $c = 0.5$。\n- 定义每个基因的对数差异为 $L_i = \\log_2\\left(\\dfrac{M_i + c}{F_i + c}\\right)$。\n- 设 $\\mathcal{A}$ 为常染色体基因集合，$\\mathcal{X}$ 为X连锁基因集合。计算常染色体基线 $b$，其值为 $\\{L_i: i \\in \\mathcal{A}\\}$ 的中位数。\n- 为每个基因 $i$ 定义校正后的差异 $C_i = L_i - b$。此步骤基于常染色体表达不受性别系统性剂量补偿的假设，将常染色体中心设定在零附近。\n- 计算X连锁汇总统计量 $\\mu_X = \\dfrac{1}{|\\mathcal{X}|} \\sum_{i \\in \\mathcal{X}} C_i$。\n- 对 $\\{C_i: i \\in \\mathcal{X}\\}$ 执行单样本学生t检验，检验零假设 $H_0: \\mathbb{E}[C_i] = 0$ 与单侧备择假设 $H_1: \\mathbb{E}[C_i] > 0$。设单侧p值表示为 $p_+$，使用 $|\\mathcal{X}| - 1$ 的自由度计算。使用显著性阈值 $\\alpha = 0.05$。\n- 报告 $\\mu_X$ 和 $p_+$，以及一个决策 $D$，定义为：如果 $p_+ < \\alpha$，则 $D = \\text{True}$，否则 $D = \\text{False}$。\n\n角度单位不适用。计数没有物理单位。所有报告的实值输出必须四舍五入到恰好 $6$ 位小数。\n\n测试套件：\n实现您的程序以处理以下三个测试用例。每个测试用例都是一个基因列表；对于每个基因，提供其染色体标签以及雄性和雌性计数，格式为 $(\\text{chromosome}, M, F)$，其中 chromosome 为 $\\text{\"X\"}$ 或 $\\text{\"A\"}$（代表常染色体）。以下所有数值均为计数，必须完全按所提供的值使用。\n\n- 测试用例 $1$（具有强雄性X染色体上调的典型案例）：\n  - 常染色体： $\\{(\\text{\"A\"}, 100, 102), (\\text{\"A\"}, 210, 205), (\\text{\"A\"}, 90, 95), (\\text{\"A\"}, 400, 410), (\\text{\"A\"}, 150, 148), (\\text{\"A\"}, 80, 79)\\}$.\n  - X染色体： $\\{(\\text{\"X\"}, 200, 100), (\\text{\"X\"}, 300, 150), (\\text{\"X\"}, 120, 60), (\\text{\"X\"}, 500, 250)\\}$.\n\n- 测试用例 $2$（无雄性X染色体上调的案例）：\n  - 常染色体： $\\{(\\text{\"A\"}, 100, 100), (\\text{\"A\"}, 200, 210), (\\text{\"A\"}, 160, 155), (\\text{\"A\"}, 300, 295), (\\text{\"A\"}, 90, 94)\\}$.\n  - X染色体： $\\{(\\text{\"X\"}, 110, 112), (\\text{\"X\"}, 220, 215), (\\text{\"X\"}, 140, 138)\\}$.\n\n- 测试用例 $3$（具有稀疏计数和零值的边缘案例，伴有轻度至中度的雄性X染色体上调）：\n  - 常染色体： $\\{(\\text{\"A\"}, 0, 0), (\\text{\"A\"}, 5, 5), (\\text{\"A\"}, 1, 2), (\\text{\"A\"}, 0, 3), (\\text{\"A\"}, 10, 8)\\}$.\n  - X染色体： $\\{(\\text{\"X\"}, 3, 1), (\\text{\"X\"}, 0, 0), (\\text{\"X\"}, 4, 2), (\\text{\"X\"}, 1, 0)\\}$.\n\n输出规格：\n- 对每个测试用例，生成一个包含三个元素的列表 $[\\mu_X, p_+, D]$，其中 $\\mu_X$ 和 $p_+$ 是四舍五入到恰好 $6$ 位小数的浮点数，而 $D$ 是一个布尔值。\n- 您的程序应生成单行输出，包含一个逗号分隔的、针对每个测试用例的列表的列表，并用方括号括起来，不含空格。例如，格式为 $[[\\mu_X^{(1)},p_+^{(1)},D^{(1)}],[\\mu_X^{(2)},p_+^{(2)},D^{(2)}],[\\mu_X^{(3)},p_+^{(3)},D^{(3)}]]$，其中上标表示测试用例索引。\n- 不应打印任何其他文本。\n\n假设与约束：\n- 为进行t检验，假设各基因之间相互独立。\n- 必须使用伪计数 $c = 0.5$，且在计算任何比率之前必须统一应用于雄性和雌性计数。\n- 对数的底数必须是 $2$，以便在 $\\mu_X \\approx 1$ 时将剂量补偿解释为加倍。[@problem_id:482]", "solution": "所呈现的问题是生物信息学领域一个明确定义的计算练习，特别是在差异基因表达分析领域。它要求实施一个标准的统计流程，以检验异配子系统中的X染色体剂量补偿。该问题具有科学依据，逻辑上一致，并为获得唯一解提供了所有必要信息。因此，该问题是有效的，我们将着手解决。\n\n此分析的核心原则是比较两种条件下的基因表达水平，在本例中是雄性和雌性生物。由于测序深度（文库大小）和其他系统性偏差的变化，来自RNA测序的原始读取计数（基因 $i$ 的 $M_i$ 和 $F_i$）不具有直接可比性。为解决此问题，我们为每个基因计算一个对数比率，这将乘法效应转换为加法效应。使用以2为底的对数是标准做法，因为它提供了直观的解释：值为1对应于两倍的变化。\n\n程序如下：\n\n首先，对于每个基因 $i$，我们得到雄性读取计数 $M_i$ 和雌性读取计数 $F_i$。为缓解零计数问题（这会使比率未定义或无穷大），我们向所有读取计数中添加一个小的伪计数 $c = 0.5$。这是一种常见的正则化技术。然后，每个基因的雄性对雌性对数差异 $L_i$ 定义为：\n$$L_i = \\log_2\\left(\\frac{M_i + c}{F_i + c}\\right)$$\n\n其次，我们必须对这些差异进行标准化。该问题假设，平均而言，常染色体基因不受性别特异性剂量补偿的影响。因此，常染色体基因对数差异中任何系统性偏离零的情况，都可能源于技术偏差（例如，文库大小差异），而非我们关注的生物学调控。我们通过计算常染色体基线 $b$ 来量化这种系统性偏差，$b$ 是所有常染色体基因对数差异的中位数。中位数是一种稳健估计量，意味着它不受离群基因的严重影响。\n$$b = \\text{中位数}\\{L_i : i \\in \\mathcal{A}\\}$$\n其中 $\\mathcal{A}$ 是常染色体基因的索引集合。\n\n第三，我们通过减去该基线来校正所有对数差异。此标准化步骤将常染色体差异的分布中心置于零附近，从而有效地校准了两种性别间的表达测量值。任何基因 $i$ 的校正后差异为：\n$$C_i = L_i - b$$\n经过此校正后，对于一个X连锁基因，若 $C_i \\approx 1$ 则表明雄性相对于雌性有两倍的上调，这是在XY系统中完全剂量补偿的期望，该系统中X染色体在雄性中为单拷贝，在雌性中为双拷贝。\n\n第四，为总结X连锁基因的总体趋势，我们计算其校正后差异的均值。该汇总统计量 $\\mu_X$ 代表了标准化后X连锁基因的平均对数倍数变化。\n$$\\mu_X = \\frac{1}{|\\mathcal{X}|} \\sum_{i \\in \\mathcal{X}} C_i$$\n其中 $\\mathcal{X}$ 是X连锁基因的索引集合，而 $|\\mathcal{X}|$ 是其基数。\n\n最后，为确定观察到的雄性X连锁基因上调是否具有统计显著性，我们执行单样本学生t检验。我们检验零假设 $H_0$，即X连锁基因校正后差异的真实均值为零（$H_0: \\mathbb{E}[C_i] = 0$），以及单侧备择假设 $H_1$，即真实均值大于零（$H_1: \\mathbb{E}[C_i] > 0$）。t统计量的计算公式为：\n$$t = \\frac{\\mu_X - 0}{s_X / \\sqrt{|\\mathcal{X}|}}$$\n其中 $s_X$ 是校正后差异 $\\{C_i : i \\in \\mathcal{X}\\}$ 的样本标准差，使用 $|\\mathcal{X}| - 1$ 的自由度计算。得到的t统计量与具有 $df = |\\mathcal{X}| - 1$ 自由度的t分布进行比较，以获得单侧p值 $p_+$。\n\n根据预定义的显著性水平 $\\alpha = 0.05$ 作出决策 $D$。如果 $p_+ < \\alpha$，我们拒绝零假设，并得出结论认为存在雄性X染色体上调的显著证据（$D = \\text{True}$）。否则，我们未能拒绝零假设（$D = \\text{False}$）。\n\n我们现在将此严谨的程序应用于每个测试用例。\n\n**测试用例 1：**\n1.  常染色体对数差异 $\\{L_i\\}_{i \\in \\mathcal{A}}$: $[\\log_2(\\frac{100.5}{102.5}), \\log_2(\\frac{210.5}{205.5}), \\dots] \\approx [-0.02846, 0.03450, -0.07725, -0.03541, 0.01931, 0.01809]$.\n2.  常染色体基线 $b$: $\\text{中位数}(\\{-0.07725, -0.03541, -0.02846, 0.01809, 0.01931, 0.03450\\}) = \\frac{-0.02846 + 0.01809}{2} \\approx -0.005185$.\n3.  X连锁校正后差异 $\\{C_i\\}_{i \\in \\mathcal{X}}$: $[\\log_2(\\frac{200.5}{100.5}) - b, \\dots] \\approx [0.998015, 0.999785, 0.996365, 1.000675]$.\n4.  汇总统计量 $\\mu_X$: $\\text{均值}(\\{C_i\\}) \\approx 0.998710$.\n5.  $t$检验: $s_X \\approx 0.001946$, $n=4$, $df=3$。$t = \\frac{0.998710}{0.001946 / \\sqrt{4}} \\approx 1026.4$。得到的 $p_+$ 极小，实际上为 $0$。\n6.  决策: $p_+ < 0.05$，因此 $D = \\text{True}$。\n7.  结果: $[\\text{0.998710, 0.000000, True}]$.\n\n**测试用例 2：**\n1.  常染色体对数差异 $\\{L_i\\}_{i \\in \\mathcal{A}}$: $[\\log_2(\\frac{100.5}{100.5}), \\dots] \\approx [0.0, -0.06995, 0.04543, 0.02417, -0.06109]$.\n2.  常染色体基线 $b$: $\\text{中位数}(\\{-0.06995, -0.06109, 0.0, 0.02417, 0.04543\\}) = 0.0$.\n3.  X连锁校正后差异 $\\{C_i\\}_{i \\in \\mathcal{X}}$ (由于 $b=0$, $C_i = L_i$): $[\\log_2(\\frac{110.5}{112.5}), \\dots] \\approx [-0.02562, 0.03310, 0.02073]$.\n4.  汇总统计量 $\\mu_X$: $\\text{均值}(\\{C_i\\}) \\approx 0.009403$.\n5.  $t$检验: $s_X \\approx 0.030578$, $n=3$, $df=2$。$t = \\frac{0.009403}{0.030578 / \\sqrt{3}} \\approx 0.5327$。得到的 $p_+ \\approx 0.327499$.\n6.  决策: $p_+ \\ge 0.05$，因此 $D = \\text{False}$。\n7.  结果: $[\\text{0.009403, 0.327499, False}]$.\n\n**测试用例 3：**\n1.  常染色体对数差异 $\\{L_i\\}_{i \\in \\mathcal{A}}$: $[\\log_2(\\frac{0.5}{0.5}), \\dots] \\approx [0.0, 0.0, -0.73697, -2.80735, 0.29887]$.\n2.  常染色体基线 $b$: $\\text{中位数}(\\{-2.80735, -0.73697, 0.0, 0.0, 0.29887\\}) = 0.0$.\n3.  X连锁校正后差异 $\\{C_i\\}_{i \\in \\mathcal{X}}$: $[\\log_2(\\frac{3.5}{1.5}), \\dots] \\approx [1.22239, 0.0, 0.84799, 1.58496]$.\n4.  汇总统计量 $\\mu_X$: $\\text{均值}(\\{C_i\\}) \\approx 0.913835$.\n5.  $t$检验: $s_X \\approx 0.692340$, $n=4$, $df=3$。$t = \\frac{0.913835}{0.692340 / \\sqrt{4}} \\approx 2.6399$。得到的 $p_+ \\approx 0.039230$.\n6.  决策: $p_+ < 0.05$，因此 $D = \\text{True}$。\n7.  结果: $[\\text{0.913835, 0.039230, True}]$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef solve():\n    \"\"\"\n    Solves the computational biology problem for the given test cases.\n\n    The function processes gene expression data to test for male X chromosome\n    upregulation in Drosophila, following a specified statistical pipeline.\n    \"\"\"\n\n    test_cases = [\n        # Test case 1\n        [\n            (\"A\", 100, 102), (\"A\", 210, 205), (\"A\", 90, 95), (\"A\", 400, 410),\n            (\"A\", 150, 148), (\"A\", 80, 79),\n            (\"X\", 200, 100), (\"X\", 300, 150), (\"X\", 120, 60), (\"X\", 500, 250)\n        ],\n        # Test case 2\n        [\n            (\"A\", 100, 100), (\"A\", 200, 210), (\"A\", 160, 155), (\"A\", 300, 295),\n            (\"A\", 90, 94),\n            (\"X\", 110, 112), (\"X\", 220, 215), (\"X\", 140, 138)\n        ],\n        # Test case 3\n        [\n            (\"A\", 0, 0), (\"A\", 5, 5), (\"A\", 1, 2), (\"A\", 0, 3), (\"A\", 10, 8),\n            (\"X\", 3, 1), (\"X\", 0, 0), (\"X\", 4, 2), (\"X\", 1, 0)\n        ]\n    ]\n\n    results = []\n    \n    # Constants defined in the problem\n    c = 0.5  # Pseudocount\n    alpha = 0.05  # Significance threshold\n\n    for case in test_cases:\n        autosomal_genes = [g for g in case if g[0] == \"A\"]\n        x_linked_genes = [g for g in case if g[0] == \"X\"]\n\n        # Extract male (M) and female (F) counts\n        m_autosomal = np.array([g[1] for g in autosomal_genes])\n        f_autosomal = np.array([g[2] for g in autosomal_genes])\n        \n        m_x_linked = np.array([g[1] for g in x_linked_genes])\n        f_x_linked = np.array([g[2] for g in x_linked_genes])\n        \n        # Step 1: Compute per-gene log contrast (L_i)\n        # Using a small epsilon to avoid log2(0) in case M_i+c or F_i+c is 0,\n        # although with c=0.5 this won't happen for non-negative counts.\n        # This is a stability measure.\n        epsilon = 1e-9\n        L_autosomal = np.log2((m_autosomal + c) / (f_autosomal + c + epsilon))\n\n        # Step 2: Compute autosomal baseline (b)\n        b = np.median(L_autosomal)\n\n        # Step 3: Compute corrected contrast (C_i) for X-linked genes\n        L_x_linked = np.log2((m_x_linked + c) / (f_x_linked + c + epsilon))\n        C_x_linked = L_x_linked - b\n\n        # Step 4: Compute X-linked summary statistic (mu_X)\n        mu_X = np.mean(C_x_linked)\n\n        # Step 5: Perform one-sample Student's t-test\n        n = len(C_x_linked)\n        if n  2:\n            # Cannot perform t-test with less than 2 samples\n            # This case is not in the test suite, but is good practice to handle.\n            p_plus = np.nan\n        else:\n            sample_std = np.std(C_x_linked, ddof=1)\n            # If standard deviation is zero (all C_i are identical)\n            if sample_std == 0:\n                t_stat = np.inf if mu_X > 0 else -np.inf\n            else:\n                t_stat = mu_X / (sample_std / np.sqrt(n))\n            \n            df = n - 1\n            # One-sided p-value for H1: mean > 0\n            p_plus = stats.t.sf(t_stat, df)\n\n        # Step 6: Determine decision (D)\n        D = p_plus  alpha\n\n        results.append([mu_X, p_plus, D])\n\n    # Final print statement in the exact required format.\n    # We construct the string manually to avoid spaces introduced by str(list).\n    formatted_results = []\n    for res in results:\n        mu_str = f\"{res[0]:.6f}\"\n        p_str = f\"{res[1]:.6f}\"\n        d_str = str(res[2])\n        formatted_results.append(f\"[{mu_str},{p_str},{d_str}]\")\n    \n    final_output_string = f\"[{','.join(formatted_results)}]\"\n    print(final_output_string)\n\nsolve()\n```", "id": "2609729"}, {"introduction": "剂量补偿不仅影响个体层面的基因表达，更在宏观的演化尺度上塑造了性染色体的命运。本练习将剂量补偿与群体遗传学理论相结合，通过建立一个数学模型来模拟非重组Y染色体的退化过程。您将通过计算来探索突变、选择和剂量补偿等因素如何共同作用，决定基因在Y染色体上是丢失还是保留，从而深入理解性染色体演化的长期动态。 [@problem_id:2750911]", "problem": "您的任务是实现一个程序，该程序在一个包含针对基因丢失的纯化选择和剂量补偿因子的机制性群体遗传学模型下，计算非重组Y染色体在指定时间范围内功能性基因发生固定性丢失的期望数量。该模型和任务纯粹以数学术语定义如下。\n\n生物学和数学基础：\n- 考虑一个非重组Y染色体，其初始功能性基因数量为 $G$。每个功能性基因都可能因新突变而假基因化，每个基因每代的突变率为 $\\mu_p$。\n- 对于一个基因，其丢失的选择系数为 $s_l \\ge 0$（因此，在未补偿的情况下，一个丢失突变会导致相对适合度下降 $s_l$），设其有效逆向选择为 $s_l^{\\mathrm{eff}} = (1 - d) s_l$，其中 $d \\in [0,1]$ 是剂量补偿因子。这里，$d = 0$ 表示无补偿，$d = 1$ 表示完全补偿。\n- 假设Y染色体遵循单倍体Wright–Fisher扩散近似，有效群体大小为 $N_e$。对于一个以单拷贝形式出现、基因选择系数为 $s$ 的新突变，其在单倍体中的固定概率由经典扩散解给出\n$$\nu(x) \\;=\\; \\frac{1 - e^{-2 N_e s x}}{1 - e^{-2 N_e s}} \\, ,\n$$\n对于单拷贝突变体 $x = \\frac{1}{N_e}$，这变为\n$$\nu(s) \\;=\\; \\frac{1 - e^{-2 s}}{1 - e^{-2 N_e s}} \\, .\n$$\n当 $s_l^{\\mathrm{eff}}  0$ 时，假基因化突变是有害的，即其选择系数为 $s = - s_l^{\\mathrm{eff}}  0$。因此，其固定概率为\n$$\nu_{\\mathrm{loss}}(N_e, s_l^{\\mathrm{eff}}) \\;=\\; \\frac{e^{2 s_l^{\\mathrm{eff}}} - 1}{e^{2 N_e s_l^{\\mathrm{eff}}} - 1} \\quad \\text{for} \\quad s_l^{\\mathrm{eff}}  0 \\, ,\n$$\n并且根据连续性，使用洛必达法则，在中性极限 $s_l^{\\mathrm{eff}} \\to 0$ 时，我们得到\n$$\nu_{\\mathrm{loss}}(N_e, 0) \\;=\\; \\frac{1}{N_e} \\, .\n$$\n- 在连续时间内，对于稀有固定和基因间的独立性，一个剩余功能性基因发生固定性丢失的风险率为\n$$\n\\lambda \\;=\\; \\mu_p \\, u_{\\mathrm{loss}}(N_e, s_l^{\\mathrm{eff}}) \\, .\n$$\n令 $E(t)$ 表示到时间 $t$ 为止的固定性丢失的期望数量。因为只有剩余的功能性基因会丢失，根据质量作用论证可得常微分方程\n$$\n\\frac{dE}{dt} \\;=\\; \\bigl( G - E(t) \\bigr) \\, \\lambda \\, , \\quad E(0) \\;=\\; 0 \\, ,\n$$\n其解为\n$$\nE(T) \\;=\\; G \\left( 1 - e^{ - \\lambda T } \\right) \\;=\\; G \\left( 1 - e^{ - \\mu_p \\, u_{\\mathrm{loss}}(N_e, s_l^{\\mathrm{eff}}) \\, T } \\right) \\, .\n$$\n\n您的任务：\n- 实现一个程序，对于每个测试用例，使用上述方程以数值稳定的方式计算 $E(T)$。使用 $s_l^{\\mathrm{eff}} = (1 - d) s_l$。对于 $s_l^{\\mathrm{eff}} = 0$，使用中性固定概率 $u_{\\mathrm{loss}} = 1/N_e$。对于 $s_l^{\\mathrm{eff}}  0$，使用\n$$\nu_{\\mathrm{loss}}(N_e, s_l^{\\mathrm{eff}}) \\;=\\; \\frac{e^{2 s_l^{\\mathrm{eff}}} - 1}{e^{2 N_e s_l^{\\mathrm{eff}}} - 1} \\, .\n$$\n- 通过使用能够避免在参数较小时发生灾难性抵消的函数来评估指数的差值，并通过防范在参数非常大时发生溢出来确保数值稳定性。您必须处理边界条件 $G = 0$、$\\mu_p = 0$ 或 $T = 0$，这些条件意味着 $E(T) = 0$。\n\n输入通过以下测试套件固定。对于每个元组，参数顺序为 $(G, N_e, \\mu_p, s_l, d, T)$：\n- 测试 1：$(100, 1000, 10^{-6}, 10^{-3}, 0, 5 \\times 10^{6})$\n- 测试 2：$(50, 10000, 10^{-5}, 10^{-2}, 1, 5 \\times 10^{8})$\n- 测试 3：$(200, 100, 10^{-5}, 5 \\times 10^{-2}, 0, 2 \\times 10^{9})$\n- 测试 4：$(80, 5000, 0, 2 \\times 10^{-2}, 0.5, 10^{7})$\n- 测试 5：$(10, 1000, 10^{-3}, 5 \\times 10^{-3}, 1, 10^{8})$\n- 测试 6：$(0, 1000, 10^{-6}, 10^{-2}, 0.3, 10^{7})$\n\n输出规格：\n- 您的程序应为每个测试用例计算 $E(T)$ 作为浮点数，并输出一行包含方括号内的逗号分隔列表，顺序与测试用例相同。每个值必须四舍五入到恰好六位小数。例如，输出应如下所示：\n$[x_1,x_2,x_3,x_4,x_5,x_6]$\n其中每个 $x_i$ 是一个小数点后恰好有六位数的小数。", "solution": "问题陈述经过验证，被认为是科学上合理的、定义明确的，并且没有矛盾或歧义。它提出了一个群体遗传学中关于非重组染色体上基因丢失的标准模型，通常称为Y染色体退化。所提供的方程是扩散理论和质量作用动力学的经典结果。因此，可以推导出一个解决方案。\n\n任务是计算在时间段 $T$ 内固定基因丢失的期望数量 $E(T)$。计算过程遵循从所提供模型推导出来的一系列逻辑步骤。\n\n首先，我们确定基因丢失事件的有效逆向选择系数 $s_l^{\\mathrm{eff}}$。该系数模拟了丢失一个基因的净选择劣势，同时考虑了潜在的剂量补偿机制。其定义为：\n$$\ns_l^{\\mathrm{eff}} = (1 - d) s_l\n$$\n其中 $s_l \\ge 0$ 是基础的逆向选择系数，$d \\in [0,1]$ 是剂量补偿因子。如果 $d=1$（完全补偿）或 $s_l=0$（基因丢失本身是中性的），则 $s_l^{\\mathrm{eff}}=0$，基因丢失突变是选择中性的。否则，对于 $d  1$ 和 $s_l > 0$，突变是有害的，即 $s_l^{\\mathrm{eff}}  0$。\n\n其次，我们计算单个新基因丢失突变的固定概率 $u_{\\mathrm{loss}}$。此概率取决于有效选择 $s_l^{\\mathrm{eff}}$ 和有效群体大小 $N_e$。\n\n情况1：中性基因丢失（$s_l^{\\mathrm{eff}} = 0$）。\n在这种情况下，固定概率就是群体大小的倒数，这是单倍体群体中任何中性突变的标准情况：\n$$\nu_{\\mathrm{loss}}(N_e, 0) = \\frac{1}{N_e}\n$$\n\n情况2：有害基因丢失（$s_l^{\\mathrm{eff}}  0$）。\n对于一个有效选择劣势为 $s_l^{\\mathrm{eff}}$ 的有害突变，其固定概率由经典扩散公式给出：\n$$\nu_{\\mathrm{loss}}(N_e, s_l^{\\mathrm{eff}}) = \\frac{e^{2 s_l^{\\mathrm{eff}}} - 1}{e^{2 N_e s_l^{\\mathrm{eff}}} - 1}\n$$\n为了数值稳定性，尤其是在指数的参数很小时，必须小心评估此表达式。对小的 $x$直接计算 $e^x - 1$ 会导致灾难性抵消。一个标准的、数值稳定的函数，通常表示为 `expm1(x)`，能为所有 $x$ 精确计算 $e^x - 1$。使用这个函数，公式变为：\n$$\nu_{\\mathrm{loss}}(N_e, s_l^{\\mathrm{eff}}) = \\frac{\\text{expm1}(2 s_l^{\\mathrm{eff}})}{\\text{expm1}(2 N_e s_l^{\\mathrm{eff}})}\n$$\n这个公式能正确地过渡到中性极限。使用洛必达法则，当 $s_l^{\\mathrm{eff}} \\to 0$ 时，我们有 $\\text{expm1}(2 s_l^{\\mathrm{eff}}) \\approx 2 s_l^{\\mathrm{eff}}$ 和 $\\text{expm1}(2 N_e s_l^{\\mathrm{eff}}) \\approx 2 N_e s_l^{\\mathrm{eff}}$，因此它们的比值趋近于 $1/N_e$。此外，如果参数 $2 N_e s_l^{\\mathrm{eff}}$ 非常大，`expm1` 将评估为无穷大，从而正确地使 $u_{\\mathrm{loss}}$ 趋于零，这是强纯化选择下的预期行为。\n\n第三，我们计算风险率 $\\lambda$，它代表染色体上每个剩余功能基因的固定基因丢失率。假设固定是稀有事件，该率是新功能丧失突变出现率（$\\mu_p$）与其固定概率（$u_{\\mathrm{loss}}$）的乘积：\n$$\n\\lambda = \\mu_p \\, u_{\\mathrm{loss}}(N_e, s_l^{\\mathrm{eff}})\n$$\n\n第四，我们计算在时间 $T$ 后的期望丢失数量 $E(T)$。丢失率与可供丢失的基因数量成正比，即 $G - E(t)$。这导致了微分方程 $\\frac{dE}{dt} = (G - E(t))\\lambda$，初始条件为 $E(0) = 0$。其解是剩余功能基因的指数衰减模型：\n$$\nE(T) = G \\left( 1 - e^{ - \\lambda T } \\right)\n$$\n该表达式描述了丢失的累积过程，当 $T \\to \\infty$ 时，其最大值接近 $G$。与计算 $u_{\\mathrm{loss}}$ 类似，如果指数 $-\\lambda T$ 接近于零，也存在数值稳定性问题。对于小的 $x$，表达式 $1 - e^{-x}$ 可以更精确地计算为 $-(\\text{expm1}(-x))$。因此，稳定的评估方法是：\n$$\nE(T) = -G \\cdot \\text{expm1}(-\\lambda T)\n$$\n最后，我们必须考虑平凡的边界条件。如果初始基因数 $G=0$、突变率 $\\mu_p=0$ 或时间范围 $T=0$，则不会有任何丢失累积。在所有这些情况下，公式都正确地得出 $E(T)=0$。如果 $\\mu_p=0$，则 $\\lambda=0$，且 $E(T)=G(1-e^0)=0$。如果 $T=0$，$E(T)=G(1-e^0)=0$。如果 $G=0$，$E(T)=0$。\n\n实现将针对每个测试用例遵循这四个步骤，并采用数值稳健的函数以确保在所有参数范围内的准确性。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the expected number of fixed functional gene losses on a \n    nonrecombining Y chromosome for a set of test cases.\n    \"\"\"\n    # Test cases: tuples of (G, Ne, mu_p, s_l, d, T)\n    test_cases = [\n        # G, Ne, mu_p, s_l, d, T\n        (100, 1000, 1e-6, 1e-3, 0, 5e6),\n        (50, 10000, 1e-5, 1e-2, 1, 5e8),\n        (200, 100, 1e-5, 5e-2, 0, 2e9),\n        (80, 5000, 0, 2e-2, 0.5, 1e7),\n        (10, 1000, 1e-3, 5e-3, 1, 1e8),\n        (0, 1000, 1e-6, 1e-2, 0.3, 1e7)\n    ]\n\n    results = []\n    for case in test_cases:\n        G, Ne, mu_p, s_l, d, T = case\n\n        # Trivial cases where no losses can accumulate\n        if G == 0 or mu_p == 0 or T == 0:\n            E_T = 0.0\n            results.append(E_T)\n            continue\n\n        # Step 1: Calculate effective selection coefficient\n        s_eff = (1 - d) * s_l\n\n        # Step 2: Calculate fixation probability u_loss\n        if s_eff = 0:  # Neutral or advantageous gene loss (s_l >= 0, so unlikely)\n            # Handle the neutral case s_eff = 0\n            u_loss = 1.0 / Ne\n        else: # Deleterious gene loss (s_eff > 0)\n            # Use np.expm1 for numerical stability, which computes exp(x) - 1.\n            # This avoids catastrophic cancellation when the argument is small\n            # and gracefully handles overflow by returning inf.\n            # u_loss = (exp(2*s_eff) - 1) / (exp(2*Ne*s_eff) - 1)\n            numerator = np.expm1(2 * s_eff)\n            denominator = np.expm1(2 * Ne * s_eff)\n            \n            # If denominator is zero (can happen if 2*Ne*s_eff is extremely small),\n            # it might lead to division by zero. However, in that regime,\n            # the fraction is well-approximated by the L'Hopital rule limit 1/Ne.\n            # if s_eff is small, we should be in neutral case.\n            # Here, since s_eff > 0, denominator will be > 0.\n            # If denominator is inf (overflow), u_loss becomes 0, which is correct.\n            if denominator == 0:\n                # This case is practically unreachable given s_eff > 0, but as a safeguard:\n                u_loss = 1.0 / Ne\n            else:\n                u_loss = numerator / denominator\n\n        # Step 3: Calculate the hazard rate lambda\n        lambda_rate = mu_p * u_loss\n\n        # Step 4: Calculate the expected number of losses E(T)\n        # Use E(T) = G * (1 - exp(-lambda*T))\n        # For numerical stability, 1 - exp(-x) is better computed as -expm1(-x)\n        exponent_term = -lambda_rate * T\n        E_T = G * (-np.expm1(exponent_term))\n        \n        results.append(E_T)\n\n    # Format output to exactly six decimal places per value.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2750911"}]}