{"hands_on_practices": [{"introduction": "在神经科学中，更符合生物物理学直觉的模型是二项分布模型，它假设存在有限数量的独立释放位点。泊松分布通常被用作其在特定条件下的简化近似。这项练习将引导你直接比较这两种分布，并计算一个关键的诊断指标——法诺因子（Fano factor），以量化它们的差异。通过这个实践[@problem_id:2738674]，你将深刻理解泊松模型作为突触传递模型的理论基础及其适用范围。", "problem": "一个突触末梢包含 $n=5$ 个独立的、功能相同的释放位点。为响应一个短暂的突触前动作电位，每个位点最多释放一个突触小泡，其概率为 $p=0.2$，且与其他位点和试验相互独立。令 $K$ 表示单次试验（一次动作电位）中释放的囊泡数量。假设突触后检测是完美的，因此 $K$ 可以作为每次试验的囊泡计数被直接观测到。\n\n从适用于细胞和分子神经科学以及概率论的第一性原理出发——即每个位点释放的独立伯努利试验、微观状态的组合计数、以及期望、方差和定义为 $\\mathrm{Var}(K)/\\mathbb{E}[K]$ 的法诺因子的定义——推导出 $K$ 在 $k=0,1,2,3,4,5$ 时的精确计数分布，并计算其均值、方差和法诺因子。然后，考虑一个具有相同均值 $\\lambda = n p$ 的神经递质释放的泊松过程模型。将二项位点模型的均值、方差和法诺因子与泊松模型的这些值进行比较。\n\n将二项位点模型的法诺因子与均值匹配的泊松模型的法诺因子之间的绝对差作为您的最终答案。将您的答案四舍五入到 $4$ 位有效数字，并以无单位的纯数字形式报告。", "solution": "对问题陈述进行验证。\n\n逐字提取的已知条件如下：\n- 独立的、功能相同的释放位点数量：$n=5$。\n- 每次试验中每个位点的释放概率：$p=0.2$。\n- $K$ 是单次试验中释放的囊泡数量。\n- 需要考虑一个均值为 $\\lambda = n p$ 的泊松过程模型。\n- 法诺因子定义为 $\\mathrm{Var}(K)/\\mathbb{E}[K]$。\n- 最终答案是二项位点模型的法诺因子与均值匹配的泊松模型的法诺因子之间的绝对差，四舍五入到 $4$ 位有效数字。\n\n验证评估：\n- **科学依据：**该问题使用了突触传递的二项模型，这是由 Katz 及其同事建立的细胞神经科学中的一个基本概念。与泊松分布的比较是该领域中一种标准且信息丰富的分析方法。参数 $n=5$ 和 $p=0.2$ 对于某些类型的突触来说处于现实范围内。该问题在科学上是合理的。\n- **适定性：**所有必要的参数和定义都已提供。任务是明确的，并能导出一个唯一、稳定且有意义的解。\n- **客观性：**语言正式、精确，没有主观或推测性内容。\n\n结论：该问题有效。它提出了一个在定量神经科学和概率论中的标准、定义明确的练习。可以继续求解过程。\n\n该问题描述了一个包含 $n=5$ 次独立伯努利试验的过程，其中每次试验（一个位点的潜在释放）的成功概率为 $p=0.2$。因此，总成功次数（释放的囊泡数）$K$ 服从二项分布，$K \\sim \\mathrm{Binomial}(n, p)$。\n\n二项分布的概率质量函数 (PMF) 由下式给出：\n$$P(K=k) = \\binom{n}{k} p^k (1-p)^{n-k}$$\n其中 $k$ 是成功次数，其取值范围为从 $0$ 到 $n$。\n\n首先，我们计算在给定 $n=5$ 和 $p=0.2$ 时 $K$ 的精确计数分布。这需要计算 $k \\in \\{0, 1, 2, 3, 4, 5\\}$ 时 的 $P(K=k)$。注意 $1-p = 1 - 0.2 = 0.8$。\n\n- 对于 $k=0$: $P(K=0) = \\binom{5}{0} (0.2)^0 (0.8)^5 = 1 \\times 1 \\times 0.32768 = 0.32768$\n- 对于 $k=1$: $P(K=1) = \\binom{5}{1} (0.2)^1 (0.8)^4 = 5 \\times 0.2 \\times 0.4096 = 0.4096$\n- 对于 $k=2$: $P(K=2) = \\binom{5}{2} (0.2)^2 (0.8)^3 = 10 \\times 0.04 \\times 0.512 = 0.2048$\n- 对于 $k=3$: $P(K=3) = \\binom{5}{3} (0.2)^3 (0.8)^2 = 10 \\times 0.008 \\times 0.64 = 0.0512$\n- 对于 $k=4$: $P(K=4) = \\binom{5}{4} (0.2)^4 (0.8)^1 = 5 \\times 0.0016 \\times 0.8 = 0.0064$\n- 对于 $k=5$: $P(K=5) = \\binom{5}{5} (0.2)^5 (0.8)^0 = 1 \\times 0.00032 \\times 1 = 0.00032$\n\n接下来，我们计算这个二项模型的均值、方差和法诺因子。\n二项分布的期望（均值）由下式给出：\n$$\\mathbb{E}[K] = np$$\n代入给定值：\n$$\\mathbb{E}[K] = 5 \\times 0.2 = 1$$\n\n二项分布的方差由下式给出：\n$$\\mathrm{Var}(K) = np(1-p)$$\n代入给定值：\n$$\\mathrm{Var}(K) = 5 \\times 0.2 \\times (1 - 0.2) = 1 \\times 0.8 = 0.8$$\n\n二项模型的法诺因子 $\\mathrm{FF}_{\\text{Binomial}}$ 是方差与均值的比率：\n$$\\mathrm{FF}_{\\text{Binomial}} = \\frac{\\mathrm{Var}(K)}{\\mathbb{E}[K]} = \\frac{np(1-p)}{np} = 1-p$$\n使用给定的 $p$ 值：\n$$\\mathrm{FF}_{\\text{Binomial}} = 1 - 0.2 = 0.8$$\n\n现在，我们考虑一个均值 $\\lambda$ 与二项模型均值相匹配的泊松过程模型。令 $K_{\\text{Poisson}}$ 为该模型的随机变量。\n匹配条件是：\n$$\\lambda = \\mathbb{E}[K] = np = 1$$\n因此，我们考虑一个参数为 $\\lambda=1$ 的泊松分布。\n\n泊松分布的基本性质是其均值和方差都等于其参数 $\\lambda$。\n泊松模型的均值为：\n$$\\mathbb{E}[K_{\\text{Poisson}}] = \\lambda = 1$$\n泊松模型的方差为：\n$$\\mathrm{Var}(K_{\\text{Poisson}}) = \\lambda = 1$$\n\n因此，泊松模型的法诺因子 $\\mathrm{FF}_{\\text{Poisson}}$ 为：\n$$\\mathrm{FF}_{\\text{Poisson}} = \\frac{\\mathrm{Var}(K_{\\text{Poisson}})}{\\mathbb{E}[K_{\\text{Poisson}}]} = \\frac{\\lambda}{\\lambda} = 1$$\n这个结果对于任何泊松过程都是定义性的；其方差总是等于其均值，从而得到一个为 1 的法诺因子。\n\n最后的任务是计算二项位点模型的法诺因子与均值匹配的泊松模型的法诺因子之间的绝对差。\n$$\\Delta \\mathrm{FF} = |\\mathrm{FF}_{\\text{Binomial}} - \\mathrm{FF}_{\\text{Poisson}}|$$\n代入计算出的值：\n$$\\Delta \\mathrm{FF} = |0.8 - 1| = |-0.2| = 0.2$$\n\n题目要求答案四舍五入到 $4$ 位有效数字。\n$$0.2 \\rightarrow 0.2000$$\n\n这个差异突出了二项释放模型的一个关键特征：因为释放位点的数量 $n$ 是有限的，所以方差相对于均值被抑制了。释放过程是“亚泊松”的，其法诺因子严格小于 $1$（对于 $p>0$）。这种与泊松法诺因子 $1$ 的偏离程度就是释放概率 $p$。", "answer": "$$\\boxed{0.2000}$$", "id": "2738674"}, {"introduction": "泊松分布的一个标志性特征是其方差等于均值。那么，我们如何用实验数据来检验这一关键假设呢？本练习将介绍色散检验（dispersion test），这是一种正式的统计方法，用于判断观测数据的方差-均值比是否显著偏离1。掌握这个工具[@problem_id:2738672]将使你能够验证简单的泊松模型是否足以描述你的数据，或者是否存在更复杂的现象，如过度色散（overdispersion）。", "problem": "在一次电压钳实验中，你在固定的细胞外钙浓度和刺激强度下，记录了单个突触的囊泡计数。在 $n = 100$ 次相同的试验中，你每次都对释放的突触囊泡数量进行计数，得到了独立同分布 (i.i.d.) 的整数值随机变量 $\\{X_{i}\\}_{i=1}^{n}$。观测到的样本均值为 $\\bar{X} = 3.2$，无偏样本方差为 $s^{2} = 5.8$。你希望检验原假设，即试验间的变异性与一个具有共同均值 $\\mu$ 的均一泊松释放模型一致，也就是说，$H_{0}: X_{i} \\sim \\text{Poisson}(\\mu)$ i.i.d.；同时检验备择假设 $H_{1}$，即计数相对于泊松模型是过度离散的。\n\n请仅从泊松过程和计数分布的基本性质出发——即对于均一泊松计数，方差等于均值；独立泊松变量之和服从泊松分布；以及在总计数给定的条件下，泊松分量呈多项式分布——为 $H_{0}$ 构建一个离散度检验。在不引用任何现成公式的情况下，推导你的检验统计量在 $H_{0}$ 下的零假设渐近分布，然后根据上述数据计算该统计量的值。使用 $\\alpha = 0.01$ 的显著性水平，判断是否应拒绝 $H_{0}$ 而支持过度离散的结论，并结合神经递质释放机制，从生物学角度简要解释拒绝原假设的意义。\n\n最终答案只报告离散度检验统计量的数值。将你的答案四舍五入到四位有效数字。最终答案以纯数字形式表示（无单位）。", "solution": "问题要求构建并应用一个泊松离散度的统计检验。在继续之前，我们必须验证其前提。\n\n步骤1：提取已知条件。\n问题提供了以下数据和条件：\n- 试验次数：$n = 100$。\n- 观测值 $\\{X_{i}\\}_{i=1}^{n}$ 是独立同分布 (i.i.d.) 的整数值随机变量。\n- 样本均值为 $\\bar{X} = 3.2$。\n- 无偏样本方差为 $s^{2} = 5.8$。\n- 原假设 $H_{0}: X_{i} \\sim \\text{Poisson}(\\mu)$ i.i.d.，其中 $\\mu$ 为共同均值。\n- 备择假设 $H_{1}$：计数相对于泊松模型表现出过度离散（即方差大于均值）。\n- 检验的显著性水平为 $\\alpha = 0.01$。\n- 推导必须从泊松分布的基本性质出发。\n\n步骤2：使用提取的已知条件进行验证。\n该问题具有科学依据。泊松模型是描述突触囊泡释放的典型起点，而检验过度离散等偏差在定量神经科学中是一个标准且有意义的程序。问题陈述清晰，提供了构建检验统计量、确定其零分布和做出决策所需的所有信息（$n$, $\\bar{X}$, $s^{2}$, $\\alpha$）。语言客观而精确。数值对于突触记录而言在物理上是合理的。该问题没有违反科学有效性、逻辑性或适定性的任何原则。\n\n步骤3：结论与行动。\n问题有效。我们将进行完整的推导和求解。\n\n均值为 $\\mu$ 的泊松分布的一个基本性质是其方差也等于 $\\mu$。原假设 $H_{0}$ 指出，所有观测值 $X_i$ 都来自一个共同的泊松分布 $\\text{Poisson}(\\mu)$。这意味着在 $H_0$ 下，数据生成过程的真实方差等于其真实均值。因此，我们预期样本方差 $s^2$ 应该接近样本均值 $\\bar{X}$。过度离散的备择假设 $H_1$ 表明真实方差大于真实均值，这将表现为 $s^2 > \\bar{X}$。\n\n为了将此比较形式化，我们构建一个检验统计量，通常称为离散指数或方差均值比检验统计量。设该统计量为 $T$。一个合乎逻辑的选择是样本方差与样本均值之比的缩放形式。我们将其定义为：\n$$T = \\frac{(n-1)s^2}{\\bar{X}}$$\n其中 $s^2 = \\frac{1}{n-1}\\sum_{i=1}^{n}(X_i - \\bar{X})^2$ 是无偏样本方差。代入 $s^2$ 的定义，得到：\n$$T = \\frac{\\sum_{i=1}^{n}(X_i - \\bar{X})^2}{\\bar{X}}$$\n\n现在我们必须按照要求，从第一性原理出发，推导在原假设 $H_0$ 下 $T$ 的分布。设 $X_i \\sim \\text{Poisson}(\\mu)$，对于 $i=1, 2, \\dots, n$。令 $N = \\sum_{i=1}^{n} X_i$ 为所有试验中观测到的事件总数。泊松分布的一个基本性质是，独立泊松变量之和也服从泊松分布。具体来说，$N \\sim \\text{Poisson}(n\\mu)$。\n\n关键的见解（作为提示给出）来自于考虑在总计数 $N$ 的条件下，单个计数 $X_i$ 的分布。对于独立的泊松变量，在给定 $\\sum_{i=1}^{n} X_i = k$ 的条件下，向量 $(X_1, X_2, \\dots, X_n)$ 的条件分布是多项式分布：\n$$(X_1, \\dots, X_n) \\, | \\, \\sum_{i=1}^{n} X_i = k \\sim \\text{Multinomial}(k; p_1, \\dots, p_n)$$\n其中第 $i$ 个类别的概率是 $p_i = \\frac{\\mu_i}{\\sum_{j=1}^{n} \\mu_j}$。在我们的原假设 $H_0$ 下，所有均值都相等，即 $\\mu_i = \\mu$，所以对所有 $i$ 都有 $p_i = \\frac{\\mu}{n\\mu} = \\frac{1}{n}$。\n\n因此，在总计数 $N = k$ 的条件下，问题等价于将 $k$ 个项目分配到 $n$ 个箱子中，每个箱子被选中的概率相等，为 $1/n$。每个箱子中的期望计数为 $E[X_i | N=k] = k \\cdot p_i = \\frac{k}{n}$。\n注意 $\\frac{k}{n} = \\frac{\\sum X_i}{n} = \\bar{X}$。所以，每个 $X_i$ 的条件期望值就是样本均值 $\\bar{X}$。\n\n我们的检验统计量 $T$ 可以改写为：\n$$T = \\sum_{i=1}^{n} \\frac{(X_i - \\bar{X})^2}{\\bar{X}}$$\n这正是皮尔逊卡方拟合优度统计量的形式，即 $\\sum \\frac{(\\text{观测值} - \\text{期望值})^2}{\\text{期望值}}$。在这里，“观测值”是 $X_i$，“期望值”是 $\\bar{X}$。该统计量检验观测到的计数 $X_i$ 是否与从均匀多项式模型中得出的期望计数一致。\n\n对于这样一个有 $n$ 个类别的检验，皮尔逊统计量渐近服从卡方（$\\chi^2$）随机变量。自由度由类别数减1，再减去从数据中估计用于计算期望值的参数个数给出。在这里，我们有 $n$ 个类别（即试验次数）。期望值 $\\bar{X}$ 由总计数 $N$ 决定，这对 $X_i$ 施加了一个线性约束（$\\sum X_i = n\\bar{X}$）。因此，自由度为 $n-1$。\n\n所以，在给定 $N$ 的条件下，统计量 $T$ 渐近服从 $\\chi^2_{n-1}$ 分布。这个结果的一个重要特点是，其极限分布不依赖于条件变量 $N$ 的值（只要 $N$ 足够大以使渐近近似有效）。因为无论 $N$ 的值是多少，条件分布都相同，所以 $T$ 的无条件分布也是渐近 $\\chi^2_{n-1}$ 分布。这依赖于总试验次数 $n$ 足够大。当 $n=100$ 时，使用渐近近似是合适的。\n\n在 $H_0$ 下：$T = \\frac{(n-1)s^2}{\\bar{X}} \\xrightarrow{d} \\chi^2_{n-1}$ 当 $n \\to \\infty$ 时。\n\n现在，我们为给定的数据计算检验统计量的值：\n- $n = 100$\n- $\\bar{X} = 3.2$\n- $s^2 = 5.8$\n\n我们的检验统计量的值是：\n$$T_{obs} = \\frac{(100-1) \\times 5.8}{3.2} = \\frac{99 \\times 5.8}{3.2} = \\frac{574.2}{3.2} = 179.4375$$\n四舍五入到四位有效数字，我们得到 $T_{obs} = 179.4$。\n\n为了决定是否拒绝 $H_0$，我们将 $T_{obs}$ 与显著性水平为 $\\alpha = 0.01$ 的 $\\chi^2_{n-1} = \\chi^2_{99}$ 分布的临界值进行比较。备择假设是过度离散（$s^2 > \\bar{X}$），所以我们进行单尾（上尾）检验。我们需要找到值 $c$ 使得 $P(\\chi^2_{99} > c) = 0.01$。\n$\\chi^2_{99}$ 分布的 $0.99$ 分位点大约是 $c \\approx 134.64$。\n我们观测到的统计量是 $T_{obs} \\approx 179.4$。由于 $179.4 > 134.64$，我们观测到的统计量落在了拒绝域内。因此，我们在 $\\alpha=0.01$ 的显著性水平下拒绝原假设 $H_0$。\n\n拒绝 $H_0$ 意味着观测到的囊泡计数变异性显著大于简单泊松过程所预期的变异性。一个简单的泊松模型假设囊泡是以一个恒定且低的概率在试验间独立释放的。观测到的过度离散（$s^2 > \\bar{X}$）表明这一假设不成立。从生物学上讲，这表明存在一个额外的试验间变异来源。这可能是由于关键的突触前参数波动造成的，例如：\n1.  “易释放池”（RRP）中可供释放的囊泡数量不是恒定的。\n2.  每个囊泡的释放概率（$p_{ves}$）在不同试验间不是恒定的，这可能是由于突触前钙内流或释放机制敏感性的波动所致。\n在神经科学中，拒绝简单泊松模型而支持过度离散模型是一个常见的发现，这指向了控制神经递质释放的更复杂、异质性的机制。\n\n问题要求只报告离散度检验统计量的数值。\n$T_{obs} = 179.4375$。\n四舍五入到四位有效数字，最终值为 $179.4$。", "answer": "$$\\boxed{179.4}$$", "id": "2738672"}, {"introduction": "当数据表现出过度色散时，一个常见的原因是潜在的释放率在不同试验间发生波动。本练习利用蒙特卡洛模拟，通过编写代码来直观地探索这一现象。你将对比一个恒定速率的泊松模型和一个速率变化的伽马-泊松（负二项）模型[@problem_id:2738723]，从而理解潜在参数的变异性是如何导致过度色散的，以及这对实验数据的解释有何影响。", "problem": "您正在研究在固定时长窗口内记录为计数的突触囊泡释放事件。假设在每个窗口内，释放事件源于一个速率为 $\\,\\lambda\\,$（单位为赫兹，赫兹表示每秒事件数）的齐次泊松过程。在重复的窗口（扫描）中，考虑了两种竞争性的生成模型来描述潜速率 $\\,\\lambda\\,$：(i) 恒定速率泊松模型，其中 $\\,\\lambda\\,$ 在各次扫描中固定为一个已知的平均值 $\\,\\bar{\\lambda}\\,$；以及 (ii) 伽马-泊松混合（负二项）模型，其中 $\\,\\lambda\\,$ 在各次扫描中是随机的，并且每次扫描都独立地从一个均值为 $\\,\\bar{\\lambda}\\,$、形状参数为 $\\,k\\,$（无量纲离散度）的伽马分布中抽取，在对 $\\,\\lambda\\,$ 进行边缘化后产生过度离散的计数。在两种模型中，给定 $\\,\\lambda\\,$ 的条件下，时长为 $\\,T\\,$ 秒的窗口内的计数服从泊松分布。\n\n您将通过蒙特卡洛模拟比较估计量 $\\,\\hat{\\lambda} = N/T\\,$ 的抽样分布，其中 $\\,N\\,$ 是在时长为 $\\,T\\,$ 秒的窗口内记录的计数。比较必须在由恒定速率泊松模型生成的数据和由伽马-泊松混合模型生成的数据之间进行，并匹配相同的平均速率 $\\,\\bar{\\lambda}\\,$ 和相同的窗口时长 $\\,T\\,$。使用固定的随机数生成器种子，以便结果能够完全复现。\n\n您可以使用的基本原理：\n- 对于速率为 $\\,\\lambda\\,$ 的齐次泊松过程，在时长为 $\\,T\\,$ 秒的窗口内的计数 $\\,N\\,$ 服从均值为 $\\,\\lambda T\\,$ 的泊松分布。\n- 伽马-泊松混合模型通过以下方式获得：在各次扫描中独立地从一个均值为 $\\,k\\theta = \\bar{\\lambda}\\,$ 的伽马分布 $\\,\\lambda \\sim \\mathrm{Gamma}(k,\\theta)\\,$ 中抽样，然后 $\\,N \\mid \\lambda \\sim \\mathrm{Poisson}(\\lambda T)\\,$。\n\n您的任务：\n- 对于下面指定的每个测试用例，在每种模型下模拟 $\\,R\\,$ 次独立扫描，为每次扫描计算 $\\,\\hat{\\lambda}\\,$，并估计每种模型下 $\\,\\hat{\\lambda}\\,$ 的蒙特卡洛样本均值和方差。同时，为每个测试用例计算两组 $\\,\\hat{\\lambda}\\,$ 值之间的双样本柯尔莫哥洛夫-斯米尔诺夫（KS）统计量，以量化分布差异。\n- 单位：均值以赫兹报告，方差以赫兹的平方报告。窗口时长 $\\,T\\,$ 必须以秒为单位。KS 统计量是无单位的。\n- 精确实现以下模拟设计：\n  - 平均速率： $\\,\\bar{\\lambda} = 5\\,\\mathrm{Hz}\\,$。\n  - 记录时长： $\\,T \\in \\{1, 10, 60\\}\\,$ 秒。\n  - 伽马-泊松混合模型的伽马形状参数： $\\,k \\in \\{1, 5, 1000\\}\\,$。\n  - 伽马尺度参数 $\\,\\theta = \\bar{\\lambda}/k\\,$，以使 $\\,\\mathbb{E}[\\lambda] = \\bar{\\lambda}\\,$。\n  - 每个测试用例中每个模型的蒙特卡洛扫描次数： $\\,R = 100000\\,$。\n  - 伪随机数生成器的随机种子：精确设置为 $\\,20231117\\,$。\n- 对于 $\\,T\\,$ 和 $\\,k\\,$ 的每个组合，执行以下操作：\n  - 生成 $\\,R\\,$ 个泊松模型样本： $\\,N^{(P)} \\sim \\mathrm{Poisson}(\\bar{\\lambda} T)\\,$，然后计算 $\\,\\hat{\\lambda}^{(P)} = N^{(P)}/T\\,$。\n  - 通过伽马-泊松混合生成 $\\,R\\,$ 个负二项模型样本：抽取 $\\,\\lambda^{(G)} \\sim \\mathrm{Gamma}(k,\\bar{\\lambda}/k)\\,$，然后 $\\,N^{(NB)} \\sim \\mathrm{Poisson}(\\lambda^{(G)} T)\\,$，再计算 $\\,\\hat{\\lambda}^{(NB)} = N^{(NB)}/T\\,$。\n  - 计算蒙特卡洛估计值：$\\,\\hat{\\lambda}^{(P)}\\,$ 和 $\\,\\hat{\\lambda}^{(NB)}\\,$ 的均值和方差（作为 $\\,R\\,$ 次重复的总体矩）。同时计算方差比 $\\,\\mathrm{Var}(\\hat{\\lambda}^{(NB)}) / \\mathrm{Var}(\\hat{\\lambda}^{(P)})\\,$ 和两组集合 $\\,\\{\\hat{\\lambda}^{(P)}\\}\\,$ 与 $\\,\\{\\hat{\\lambda}^{(NB)}\\}\\,$ 之间的双样本柯尔莫哥洛夫-斯米尔诺夫统计量。\n- 测试套件：\n  - 用例 $\\,1\\,$: $\\,T=1\\,$, $\\,k=1\\,$。\n  - 用例 $\\,2\\,$: $\\,T=1\\,$, $\\,k=5\\,$。\n  - 用例 $\\,3\\,$: $\\,T=1\\,$, $\\,k=1000\\,$。\n  - 用例 $\\,4\\,$: $\\,T=10\\,$, $\\,k=1\\,$。\n  - 用例 $\\,5\\,$: $\\,T=10\\,$, $\\,k=5\\,$。\n  - 用例 $\\,6\\,$: $\\,T=10\\,$, $\\,k=1000\\,$。\n  - 用例 $\\,7\\,$: $\\,T=60\\,$, $\\,k=1\\,$。\n  - 用例 $\\,8\\,$: $\\,T=60\\,$, $\\,k=5\\,$。\n  - 用例 $\\,9\\,$: $\\,T=60\\,$, $\\,k=1000\\,$。\n- 要求的最终输出格式：\n  - 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。\n  - 对于按上述顺序列出的每个测试用例，附加一个包含八个条目的列表：\n    - $\\,T\\,$（秒），\n    - $\\,k\\,$，\n    - $\\,\\hat{\\lambda}^{(P)}\\,$ 的均值（赫兹），\n    - $\\,\\hat{\\lambda}^{(P)}\\,$ 的方差（赫兹的平方），\n    - $\\,\\hat{\\lambda}^{(NB)}\\,$ 的均值（赫兹），\n    - $\\,\\hat{\\lambda}^{(NB)}\\,$ 的方差（赫兹的平方），\n    - 方差比 $\\,\\mathrm{Var}(\\hat{\\lambda}^{(NB)}) / \\mathrm{Var}(\\hat{\\lambda}^{(P)})\\,$，\n    - $\\,\\{\\hat{\\lambda}^{(P)}\\}\\,$ 和 $\\,\\{\\hat{\\lambda}^{(NB)}\\}\\,$ 之间的双样本柯尔莫哥洛夫-斯米尔诺夫统计量。\n  - 因此，输出必须是包含一个由 $\\,9\\,$ 个内部列表组成的列表的单行，每个内部列表包含 $\\,8\\,$ 个十进制数，例如： $\\,[[\\cdots],[\\cdots],\\ldots]\\,$。不要打印任何附加文本。", "solution": "我们将囊泡释放事件建模为在时长为 $\\,T\\,$ 秒的固定窗口内的计数。在一个速率为 $\\,\\lambda\\,$（单位为赫兹）的齐次泊松过程下，时长为 $\\,T\\,$ 的窗口内的计数 $\\,N\\,$ 服从均值为 $\\,\\lambda T\\,$ 的泊松分布。窗口内速率的规范估计量是 $\\,\\hat{\\lambda} = N/T\\,$，在泊松过程下，该估计量对于 $\\,\\lambda\\,$ 是无偏的，因为 $\\,\\mathbb{E}[\\hat{\\lambda}] = \\mathbb{E}[N]/T = (\\lambda T)/T = \\lambda\\,$。在泊松模型下，其方差源于泊松计数的方差： $\\,\\mathrm{Var}(\\hat{\\lambda}) = \\mathrm{Var}(N)/T^{2} = (\\lambda T)/T^{2} = \\lambda/T\\,$。\n\n由于突触前释放概率的波动以及细胞和分子机制中其他变异来源，真实的突触记录在各次扫描中常常表现出过度离散。在统计上对此进行建模的一种标准方法是伽马-泊松混合模型：对每次扫描独立地抽取一个潜速率 $\\,\\lambda \\sim \\mathrm{Gamma}(k,\\theta)\\,$，其均值为 $\\,k\\theta = \\bar{\\lambda}\\,$，然后在给定 $\\,\\lambda\\,$ 的条件下抽取 $\\,N \\mid \\lambda \\sim \\mathrm{Poisson}(\\lambda T)\\,$。$\\,N\\,$ 的最终边缘分布是负二项分布，其均值为 $\\,\\bar{\\lambda} T\\,$，方差为 $\\,\\bar{\\lambda} T + (\\bar{\\lambda} T)^{2}/k\\,$，这反映了相对于泊松分布的过度离散。对估计量 $\\,\\hat{\\lambda} = N/T\\,$ 应用全方差定律可得\n$$\n\\mathrm{Var}(\\hat{\\lambda})\n= \\mathbb{E}\\!\\left[\\mathrm{Var}(\\hat{\\lambda}\\mid \\lambda)\\right] + \\mathrm{Var}\\!\\left(\\mathbb{E}[\\hat{\\lambda}\\mid \\lambda]\\right)\n= \\mathbb{E}\\!\\left[\\frac{\\lambda}{T}\\right] + \\mathrm{Var}(\\lambda)\n= \\frac{\\bar{\\lambda}}{T} + \\frac{\\bar{\\lambda}^{2}}{k}\n$$\n其中我们使用了对于均值为 $\\,\\bar{\\lambda}\\,$、形状参数为 $\\,k\\,$ 的伽马分布，其性质为 $\\,\\mathbb{E}[\\lambda] = \\bar{\\lambda}\\,$ 和 $\\,\\mathrm{Var}(\\lambda) = \\bar{\\lambda}^{2}/k\\,$。这种分解揭示了一个关键的科学洞见：在跨扫描的速率波动下，贡献项 $\\,\\bar{\\lambda}^{2}/k\\,$ 充当了一个方差下限，它不会随着记录时长 $\\,T\\,$ 的增加而缩小，而扫描内的泊松噪声 $\\,\\bar{\\lambda}/T\\,$ 则随着 $\\,T\\,$ 的增加而减小。相比之下，在恒定速率泊松模型下，$\\,\\mathrm{Var}(\\hat{\\lambda}) = \\bar{\\lambda}/T\\,$ 会在 $\\,T\\to\\infty\\,$ 时趋于零。\n\n我们现在设计一个蒙特卡洛算法，以在相同的平均速率 $\\,\\bar{\\lambda}\\,$ 和相同的 $\\,T\\,$ 下，经验性地比较两种模型下 $\\,\\hat{\\lambda}\\,$ 的抽样分布：\n- 为保证可复现性，固定一个高质量伪随机数生成器的种子。我们使用种子为 $\\,20231117\\,$ 的默认位生成器。\n- 对于由 $\\,T\\in\\{1,10,60\\}\\,$ 秒和 $\\,k\\in\\{1,5,1000\\}\\,$ 定义的每个测试用例，在两种模型下模拟 $\\,R=100000\\,$ 次独立扫描：\n  - 泊松模型：抽取 $\\,N^{(P)} \\sim \\mathrm{Poisson}(\\bar{\\lambda} T)\\,$ 并计算 $\\,\\hat{\\lambda}^{(P)} = N^{(P)}/T\\,$。\n  - 负二项模型（通过伽马-泊松混合）：抽取 $\\,\\lambda^{(G)} \\sim \\mathrm{Gamma}(k,\\theta)\\,$，其中 $\\,\\theta = \\bar{\\lambda}/k\\,$，然后抽取 $\\,N^{(NB)} \\sim \\mathrm{Poisson}(\\lambda^{(G)} T)\\,$ 并计算 $\\,\\hat{\\lambda}^{(NB)} = N^{(NB)}/T\\,$。\n- 对于每个模型和测试用例，计算 $\\,\\hat{\\lambda}\\,$ 的蒙特卡洛估计均值和方差，即在 $\\,R\\,$ 次重复中计算样本均值和总体矩样本方差（即，除以 $\\,R\\,$ 而不是 $\\,R-1\\,$，以近似 $\\,\\mathbb{E}[(\\hat{\\lambda}-\\mathbb{E}\\hat{\\lambda})^{2}]\\,$）。\n- 使用以下方法比较两个抽样分布：\n  - 方差比 $\\,\\mathrm{Var}(\\hat{\\lambda}^{(NB)}) / \\mathrm{Var}(\\hat{\\lambda}^{(P)})\\,$。\n  - $\\,\\{\\hat{\\lambda}^{(P)}\\}\\,$ 和 $\\,\\{\\hat{\\lambda}^{(NB)}\\}\\,$ 之间的双样本柯尔莫哥洛夫-斯米尔诺夫（KS）统计量，其定义为它们的经验累积分布函数之间绝对差值在所有实数阈值上的上确界。\n\n算法考虑：\n- 对随机变量生成和算术运算进行向量化，以确保计算效率和数值稳定性。\n- 伽马形状参数 $\\,k=1000\\,$ 产生的过度离散可忽略不计；负二项模型下的蒙特卡洛结果应近似于泊松模型的结果，这提供了一个边界条件检查。\n- 对于小的 $\\,k\\,$ 和小的 $\\,T\\,$，过度离散项占主导地位，导致更大的方差和更大的 KS 统计量。\n\n实现细节：\n- 使用 $\\,\\bar{\\lambda} = 5\\,\\mathrm{Hz}\\,$。\n- 每个模型每个测试用例使用 $\\,R=100000\\,$ 次重复。\n- 使用指定的时长 $\\,T\\,$ 和形状参数 $\\,k\\,$。\n- 使用指定的随机种子 $\\,20231117\\,$。\n- 输出格式：生成单行，打印一个包含 $\\,9\\,$ 个内部列表的列表（每个测试用例一个，按指定顺序排列），每个内部列表按此顺序包含：$\\,T\\,$（秒）、$\\,k\\,$、$\\,\\hat{\\lambda}^{(P)}\\,$ 的均值（赫兹）、$\\,\\hat{\\lambda}^{(P)}\\,$ 的方差（赫兹的平方）、$\\,\\hat{\\lambda}^{(NB)}\\,$ 的均值（赫兹）、$\\,\\hat{\\lambda}^{(NB)}\\,$ 的方差（赫兹的平方）、方差比和 KS 统计量。\n\n科学预期：\n- 在泊松模型下，方差应大致按 $\\,\\bar{\\lambda}/T\\,$ 缩放，并随着 $\\,T\\,$ 的增加而减小。\n- 在负二项模型下，方差应近似为 $\\,\\bar{\\lambda}/T + \\bar{\\lambda}^{2}/k\\,$，因此随着 $\\,T\\,$ 的增加，它会接近一个下限 $\\,\\bar{\\lambda}^{2}/k\\,$。\n- 方差比应接近 $\\,1 + \\bar{\\lambda}T/k\\,$，反映了由跨扫描速率变异性贡献的相对膨胀。\n- KS 统计量应随着 $\\,T\\,$ 或 $\\,k\\,$ 的增加而减小，因为在过度离散减小或平均窗口更长的情况下，两个分布会变得更加相似。\n\n所提供的程序精确地实现了这些步骤，并按指定格式打印所需的单行输出。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import ks_2samp\n\ndef simulate_case(rng, lam_bar, T, k, R):\n    # Poisson model: fixed rate lam_bar\n    counts_p = rng.poisson(lam=lam_bar * T, size=R)\n    hat_lambda_p = counts_p / T\n\n    # Negative binomial via gamma-poisson mixture: lambda ~ Gamma(k, scale=lam_bar/k)\n    # Then counts ~ Poisson(lambda * T)\n    rates_nb = rng.gamma(shape=k, scale=lam_bar / k, size=R)\n    counts_nb = rng.poisson(lam=rates_nb * T, size=R)\n    hat_lambda_nb = counts_nb / T\n\n    # Monte Carlo estimates: use population-moment variance (ddof=0)\n    mean_p = float(hat_lambda_p.mean())\n    var_p = float(hat_lambda_p.var(ddof=0))\n\n    mean_nb = float(hat_lambda_nb.mean())\n    var_nb = float(hat_lambda_nb.var(ddof=0))\n\n    # Variance ratio\n    variance_ratio = float(var_nb / var_p) if var_p  0 else float('inf')\n\n    # Two-sample KS statistic\n    ks_stat = float(ks_2samp(hat_lambda_p, hat_lambda_nb, alternative='two-sided', mode='auto').statistic)\n\n    return [float(T), float(k), mean_p, var_p, mean_nb, var_nb, variance_ratio, ks_stat]\n\ndef solve():\n    # Parameters as specified in the problem\n    lam_bar = 5.0  # Hz\n    durations = [1.0, 10.0, 60.0]  # seconds\n    k_values = [1.0, 5.0, 1000.0]  # gamma shape parameters\n    R = 100000  # Monte Carlo replicates\n    seed = 20231117  # fixed seed for reproducibility\n\n    rng = np.random.default_rng(seed)\n\n    # Generate results in the specified order\n    results = []\n    for T in durations:\n        for k in k_values:\n            res = simulate_case(rng, lam_bar, T, k, R)\n            results.append(res)\n\n    # Print single line output in the exact required format\n    print(\"[\" + \",\".join(str(item) for item in results) + \"]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2738723"}]}