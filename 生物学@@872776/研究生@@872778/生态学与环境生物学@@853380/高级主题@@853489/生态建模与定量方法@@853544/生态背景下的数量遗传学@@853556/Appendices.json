{"hands_on_practices": [{"introduction": "在数量遗传学中，准确地划分表型方差是理解性状演化潜力的基石。这个练习将带你直面一个普遍的实践挑战：测量误差。通过这个思想实验 [@problem_id:2526721]，你将推导出测量误差如何系统性地影响遗传力估算，并学会量化这种偏差，这是任何经验生态学家和遗传学家都必须掌握的关键技能。", "problem": "一位田野生态学家正在研究一个野生植物种群中的一个数量性状。设个体的潜在（真实、无误差的）表型由随机变量 $Y$ 表示，其表型方差为 $V_{P}$，加性遗传方差为 $V_{A}$。窄义遗传力定义为 $h^{2} = V_{A}/V_{P}$。该性状在田野中使用一种仪器进行测量，该仪器会引入独立的、均值为零的测量误差 $E$，其方差为 $V_{m}$，因此观测到的表型为 $Y_{\\text{obs}} = Y + E$。该研究者未意识到测量误差的存在，通过将加性遗传方差除以观测表型方差来估计遗传力，从而得到一个观测遗传力 $h^{2}_{\\text{obs}}$。\n\n仅使用窄义遗传力的定义以及独立随机变量之和的方差等于其方差之和的性质，推导 $h^{2}$、$h^{2}_{\\text{obs}}$、$V_{P}$ 和 $V_{m}$ 之间的关系，并用它来量化 $h^{2}_{\\text{obs}}$ 中的向下偏差，并计算从 $h^{2}_{\\text{obs}}$ 恢复 $h^{2}$ 所需的校正。\n\n假设该种群的以下经验估计方差分量为：$V_{A} = 0.24$，$V_{P} = 0.60$ 和 $V_{m} = 0.15$（所有单位均为性状单位的平方）。将校正后的遗传力 $h^{2}$ 以 $0$ 和 $1$ 之间的小数形式报告。将您的答案四舍五入至三位有效数字。", "solution": "该问题要求分析测量误差如何影响窄义遗传力 $h^{2}$ 的估计。我们将首先验证问题陈述的有效性，如果有效，则继续进行严格的推导。\n\n**问题验证**\n\n**步骤1：提取已知条件**\n- 潜在表型：随机变量 $Y$。\n- $Y$ 的表型方差：$V_{P}$。\n- 加性遗传方差：$V_{A}$。\n- 窄义遗传力的定义：$h^{2} = V_{A}/V_{P}$。\n- 测量误差：随机变量 $E$，独立于 $Y$，均值为零，方差为 $V_{m}$。\n- 观测表型：$Y_{\\text{obs}} = Y + E$。\n- 观测遗传力：$h^{2}_{\\text{obs}}$，通过将加性遗传方差除以观测表型方差计算得出。\n- 方差性质：独立随机变量之和的方差等于其方差之和。\n- 经验估计的方差分量：$V_{A} = 0.24$，$V_{P} = 0.60$，$V_{m} = 0.15$。\n- 任务：推导 $h^{2}$、$h^{2}_{\\text{obs}}$、$V_{P}$ 和 $V_{m}$ 之间的关系。量化偏差。计算校正值。将校正后的遗传力 $h^{2}$ 报告为保留三位有效数字的结果。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，植根于数量遗传学的基本原理。所描述的定义和关系（例如，方差分解、遗传力的定义）在该领域是标准的。测量误差导致表型方差增加的情景是经验生态学和遗传学中一个现实且常见的问题。该问题是适定的，为获得唯一解提供了所有必要的信息和定义。数值是一致且合理的（$V_{A}  V_{P}$，所有方差均为正）。该问题是可形式化的，需要直接应用统计学和遗传学原理。它不是主观的、形而上学的或微不足道的。\n\n**步骤3：结论与行动**\n问题有效。我们将继续进行求解。\n\n**推导与求解**\n\n真实的窄义遗传力 $h^{2}$ 定义为加性遗传方差 $V_{A}$ 与总潜在表型方差 $V_{P}$ 的比值：\n$$h^{2} = \\frac{V_{A}}{V_{P}}$$\n观测表型 $Y_{\\text{obs}}$ 是真实表型 $Y$ 和测量误差 $E$ 的和。\n$$Y_{\\text{obs}} = Y + E$$\n研究者使用观测表型的方差（我们记为 $V_{P, \\text{obs}}$）来计算观测遗传力 $h^{2}_{\\text{obs}}$。\n$$h^{2}_{\\text{obs}} = \\frac{V_{A}}{V_{P, \\text{obs}}}$$\n为了找到 $h^{2}$ 和 $h^{2}_{\\text{obs}}$ 之间的关系，我们必须首先用基本方差分量来表示 $V_{P, \\text{obs}}$。观测表型的方差为 $V_{P, \\text{obs}} = \\text{Var}(Y_{\\text{obs}})$。鉴于 $Y$ 和 $E$ 是独立的随机变量，它们之和的方差等于它们各自方差的和：\n$$V_{P, \\text{obs}} = \\text{Var}(Y + E) = \\text{Var}(Y) + \\text{Var}(E)$$\n根据定义，$\\text{Var}(Y) = V_{P}$ 且 $\\text{Var}(E) = V_{m}$。因此，观测表型方差因测量误差方差而增大：\n$$V_{P, \\text{obs}} = V_{P} + V_{m}$$\n现在，将此表达式代入 $h^{2}_{\\text{obs}}$ 的公式中：\n$$h^{2}_{\\text{obs}} = \\frac{V_{A}}{V_{P} + V_{m}}$$\n为了将其与真实遗传力 $h^{2}$ 联系起来，我们使用定义 $V_{A} = h^{2}V_{P}$。代入 $V_{A}$ 即可得到真实遗传力与观测遗传力之间的关系：\n$$h^{2}_{\\text{obs}} = \\frac{h^{2}V_{P}}{V_{P} + V_{m}} = h^{2} \\left( \\frac{V_{P}}{V_{P} + V_{m}} \\right)$$\n这个方程建立了 $h^{2}$、$h^{2}_{\\text{obs}}$、$V_{P}$ 和 $V_{m}$ 之间的关系。\n\n为了量化向下偏差，我们考察比例因子 $\\frac{V_{P}}{V_{P} + V_{m}}$。由于方差不能为负，所以 $V_{P} > 0$ 且 $V_{m} \\ge 0$。在这个问题中，存在测量误差，因此 $V_{m} > 0$。由此直接得出 $V_{P}  V_{P} + V_{m}$，因此该因子严格小于 $1$：\n$$\\frac{V_{P}}{V_{P} + V_{m}}  1$$\n这表明 $h^{2}_{\\text{obs}}  h^{2}$（对于任何 $h^2 > 0$），证实了当测量误差存在但被忽略时，遗传力估计值存在系统性的向下偏差。偏差为差值 $h^{2}_{\\text{obs}} - h^{2}$。\n\n为了找到从观测值 $h^{2}_{\\text{obs}}$ 恢复真实遗传力 $h^{2}$ 所需的校正，我们重新整理推导出的关系式以求解 $h^{2}$：\n$$h^{2} = h^{2}_{\\text{obs}} \\left( \\frac{V_{P} + V_{m}}{V_{P}} \\right) = h^{2}_{\\text{obs}} \\left( 1 + \\frac{V_{m}}{V_{P}} \\right)$$\n这个公式提供了必要的校正。为了获得真实的遗传力，观测遗传力必须乘以因子 $(1 + V_{m}/V_{P})$ 进行放大。\n\n最后，题目要求我们使用提供的经验方差分量来报告校正后的遗传力 $h^{2}$。“校正后的遗传力”就是真实的遗传力，可以直接根据所提供的真实方差分量计算出来。\n已知：\n$V_{A} = 0.24$\n$V_{P} = 0.60$\n$V_{m} = 0.15$\n\n使用窄义遗传力的基本定义：\n$$h^{2} = \\frac{V_{A}}{V_{P}} = \\frac{0.24}{0.60}$$\n计算过程如下：\n$$h^{2} = \\frac{24}{60} = \\frac{2}{5} = 0.4$$\n为了验证一致性，我们可以先计算有偏估计值 $h^{2}_{\\text{obs}}$，然后应用校正。\n$V_{P, \\text{obs}} = V_{P} + V_{m} = 0.60 + 0.15 = 0.75$。\n$h^{2}_{\\text{obs}} = \\frac{V_{A}}{V_{P, \\text{obs}}} = \\frac{0.24}{0.75} = 0.32$。\n应用校正因子：\n$h^{2} = h^{2}_{\\text{obs}} \\left( 1 + \\frac{V_{m}}{V_{P}} \\right) = 0.32 \\left( 1 + \\frac{0.15}{0.60} \\right) = 0.32 (1 + 0.25) = 0.32(1.25) = 0.4$。\n结果相同，符合预期。题目要求答案四舍五入到三位有效数字。\n\n校正后的遗传力为 $h^2 = 0.400$。", "answer": "$$\\boxed{0.400}$$", "id": "2526721"}, {"introduction": "生物体的性状很少孤立地演化；它们通常是相互关联的。本练习 [@problem_id:2526726] 将我们从单变量视角提升至更符合现实的多变量框架。你将应用作为演化理论核心的多元育种家方程（multivariate breeder's equation），来预测一个种群对选择的响应。通过将演化响应向量分解，我们可以直观地看到遗传相关（由 $\\mathbf{G}$ 矩阵描述）如何引导演化沿着特定的路径前进，揭示“遗传上阻力最小的路径”。", "problem": "一个栖息于异质环境中的多年生植物物种表现出三个数量性状：开花期 ($z_{1}$)、叶片厚度 ($z_{2}$) 和最大根深 ($z_{3}$)。假设在单代内，在弱且恒定的定向选择下，其联合进化响应受性状间的加性遗传协方差和定向选择梯度的控制。加性遗传方差-协方差矩阵（$\\mathbf{G}$ 矩阵）和定向选择梯度向量 $\\boldsymbol{\\beta}$ 通过一项大型田野研究估计如下\n$$\n\\mathbf{G} \\;=\\; \n\\begin{pmatrix}\n2  1  0 \\\\\n1  2  0 \\\\\n0  0  1\n\\end{pmatrix},\n\\qquad\n\\boldsymbol{\\beta} \\;=\\;\n\\begin{pmatrix}\n0.5 \\\\\n0.5 \\\\\n1\n\\end{pmatrix}.\n$$\n仅使用数量遗传学和线性代数的基本定义，对单代选择完成以下任务：\n1) 计算性状均值向量的预期变化 $\\Delta \\bar{\\mathbf{z}}$。\n2) 将 $\\Delta \\bar{\\mathbf{z}}$ 分解为与 $\\mathbf{G}$ 的特征向量对齐的正交分量，并明确指出与 $\\mathbf{G}$ 最大特征值对应的特征向量所贡献的分量。\n\n将 $\\Delta \\bar{\\mathbf{z}}$ 的模方中可由沿 $\\mathbf{G}$ 主特征向量的分量所解释的比例作为最终答案，以小数形式表示并四舍五入到四位有效数字。不包含任何单位。", "solution": "问题陈述具有科学依据，提法恰当，并包含了获得唯一解所需的所有信息。它基于数量遗传学的基石——多变量育种家方程。所提供的加性遗传方差-协方差矩阵 $\\mathbf{G}$ 是对称的，并且如下文所示，是正定的，这是此类矩阵的一个必要属性。该问题是有效的。\n\n平均性状值向量的预期进化响应 $\\Delta \\bar{\\mathbf{z}}$ 由多变量育种家方程给出：\n$$\n\\Delta \\bar{\\mathbf{z}} = \\mathbf{G} \\boldsymbol{\\beta}\n$$\n其中 $\\mathbf{G}$ 是加性遗传方差-协方差矩阵，$\\boldsymbol{\\beta}$ 是定向选择梯度向量。\n\n首先，我们使用给定的矩阵计算 $\\Delta \\bar{\\mathbf{z}}$：\n$$\n\\mathbf{G} = \\begin{pmatrix} 2  1  0 \\\\ 1  2  0 \\\\ 0  0  1 \\end{pmatrix}, \\qquad \\boldsymbol{\\beta} = \\begin{pmatrix} 0.5 \\\\ 0.5 \\\\ 1 \\end{pmatrix}\n$$\n矩阵-向量积为：\n$$\n\\Delta \\bar{\\mathbf{z}} = \\begin{pmatrix} 2  1  0 \\\\ 1  2  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 0.5 \\\\ 0.5 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 2(0.5) + 1(0.5) + 0(1) \\\\ 1(0.5) + 2(0.5) + 0(1) \\\\ 0(0.5) + 0(0.5) + 1(1) \\end{pmatrix} = \\begin{pmatrix} 1.5 \\\\ 1.5 \\\\ 1 \\end{pmatrix}\n$$\n接下来，我们将此响应向量 $\\Delta \\bar{\\mathbf{z}}$ 分解为与 $\\mathbf{G}$ 的特征向量对齐的分量。由于 $\\mathbf{G}$ 是一个实对称矩阵，其特征向量构成一个正交基。我们必须找到这些特征向量和相应的特征值。特征值 $\\lambda$ 是特征方程 $\\det(\\mathbf{G} - \\lambda\\mathbf{I}) = 0$ 的根。\n$$\n\\det\\left(\\begin{pmatrix} 2  1  0 \\\\ 1  2  0 \\\\ 0  0  1 \\end{pmatrix} - \\lambda\\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix}\\right) = \\det\\begin{pmatrix} 2-\\lambda  1  0 \\\\ 1  2-\\lambda  0 \\\\ 0  0  1-\\lambda \\end{pmatrix} = 0\n$$\n沿第三行展开行列式可得：\n$$\n(1-\\lambda) \\det\\begin{pmatrix} 2-\\lambda  1 \\\\ 1  2-\\lambda \\end{pmatrix} = (1-\\lambda) \\left[(2-\\lambda)^{2} - 1\\right] = 0\n$$\n$$\n(1-\\lambda) (\\lambda^{2} - 4\\lambda + 4 - 1) = (1-\\lambda) (\\lambda^{2} - 4\\lambda + 3) = (1-\\lambda)(\\lambda-1)(\\lambda-3) = 0\n$$\n特征值为 $\\lambda_1 = 3$、$\\lambda_2 = 1$ 和 $\\lambda_3 = 1$。它们都是正数，证实了 $\\mathbf{G}$ 是正定的。主特征值，即对应于最大遗传方差轴（称为 $g_{max}$）的特征值，是 $\\lambda_{max} = 3$。\n\n现在我们求解对应于 $\\lambda_{max} = 3$ 的特征向量 $\\mathbf{e}_{max}$。我们求解方程 $(\\mathbf{G} - 3\\mathbf{I})\\mathbf{v} = \\mathbf{0}$：\n$$\n\\begin{pmatrix} 2-3  1  0 \\\\ 1  2-3  0 \\\\ 0  0  1-3 \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix} = \\begin{pmatrix} -1  1  0 \\\\ 1  -1  0 \\\\ 0  0  -2 \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n这得到方程组 $-v_1 + v_2 = 0$（因此 $v_1=v_2$）和 $-2v_3 = 0$（因此 $v_3=0$）。一个代表性的特征向量是 $\\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix}$。为获得单位化特征向量，我们将其除以其模长 $||\\mathbf{v}|| = \\sqrt{1^2 + 1^2 + 0^2} = \\sqrt{2}$。\n单位化主特征向量为：\n$$\n\\mathbf{e}_{max} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n$\\Delta \\bar{\\mathbf{z}}$ 沿 $\\mathbf{e}_{max}$ 方向的分量由 $\\Delta \\bar{\\mathbf{z}}$ 在 $\\mathbf{e}_{max}$ 上的投影给出：\n$$\n(\\Delta \\bar{\\mathbf{z}})_{max} = (\\Delta \\bar{\\mathbf{z}} \\cdot \\mathbf{e}_{max}) \\mathbf{e}_{max}\n$$\n投影系数是标量积：\n$$\nc_{max} = \\Delta \\bar{\\mathbf{z}} \\cdot \\mathbf{e}_{max} = \\begin{pmatrix} 1.5 \\\\ 1.5 \\\\ 1 \\end{pmatrix} \\cdot \\left(\\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix}\\right) = \\frac{1}{\\sqrt{2}} (1.5 \\times 1 + 1.5 \\times 1 + 1 \\times 0) = \\frac{3}{\\sqrt{2}}\n$$\n响应向量沿 $\\mathbf{e}_{max}$ 的分量明确为 $(\\Delta \\bar{\\mathbf{z}})_{max} = \\frac{3}{\\sqrt{2}} \\left( \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix} \\right) = \\frac{3}{2} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1.5 \\\\ 1.5 \\\\ 0 \\end{pmatrix}$。\n\n问题要求计算该分量在 $\\Delta \\bar{\\mathbf{z}}$ 模方中所占的比例。首先，我们计算总响应向量 $\\Delta \\bar{\\mathbf{z}}$ 的模方：\n$$\n||\\Delta \\bar{\\mathbf{z}}||^2 = (1.5)^2 + (1.5)^2 + 1^2 = 2.25 + 2.25 + 1 = 5.5\n$$\n接下来，我们计算沿 $\\mathbf{e}_{max}$ 分量的模方。由于 $\\mathbf{e}_{max}$ 是单位向量，该值就是投影系数的平方 $c_{max}^2$：\n$$\n||(\\Delta \\bar{\\mathbf{z}})_{max}||^2 = c_{max}^2 = \\left(\\frac{3}{\\sqrt{2}}\\right)^2 = \\frac{9}{2} = 4.5\n$$\n所求比例是这些模方的比值：\n$$\n\\text{比例} = \\frac{||(\\Delta \\bar{\\mathbf{z}})_{max}||^2}{||\\Delta \\bar{\\mathbf{z}}||^2} = \\frac{4.5}{5.5} = \\frac{45}{55} = \\frac{9}{11}\n$$\n最后，我们将此分数表示为小数，并四舍五入到四位有效数字：\n$$\n\\frac{9}{11} \\approx 0.818181...\n$$\n四舍五入后得到 $0.8182$。这个结果表明，就变化的平方而言，总进化响应中大约有 $81.82\\%$ 被约束在最大遗传方差轴上。", "answer": "$$\n\\boxed{0.8182}\n$$", "id": "2526726"}, {"introduction": "理论模型只有在能够与真实数据相结合时才显示出其全部力量。这个实践练习 [@problem_id:2526754] 为你搭建了一座从理论通往实践的桥梁。你将模拟一项生态学研究，处理关于生存和繁殖成功的原始数据，以估算作用于性状上的选择梯度。这个过程将阐明如何从野外观察到的适合度差异中提炼出定量的选择参数，从而将它们代入育种家方程（breeder's equation）中，做出具体的演化预测。", "problem": "给定一个野生种群在单个繁殖季节中的个体层面数据，其中在选择前测量了一个目标性状，并记录了两个阶段性适合度组分：交配成功率和生存力。您的任务是分别为生存力和交配阶段估计目标性状上的定向选择，并在一个加性遗传框架下，预测标准化性状均值的单代净进化变化。\n\n您的推理仅能基于以下核心定义和经过充分检验的数量遗传学事实：\n- 对于每个个体 $i$，其绝对适合度是可测量的、乘法性组分的乘积（例如，存活率和交配成功率）。如果 $V_i$ 是生存力（存活至繁殖；$V_i \\in \\{0,1\\}$），而 $M_i$ 是交配成功率（一个非负整数计数），那么绝对适合度为 $W_i = V_i \\times M_i$。\n- 对于任何组分 $C_i$，其相对适合度是 $c_i = C_i / \\bar{C}$，其中 $\\bar{C}$ 是该组分在参考集中的均值（对于生存力：所有个体；对于交配：仅存活者）。总相对适合度是 $w_i = W_i / \\bar{W}$，其中 $\\bar{W}$ 是种群中的平均绝对适合度。\n- 选择差定义为表型与相对适合度之间的协方差。对单个性状的定向选择可以通过使用普通最小二乘法（OLS）对相对适合度与标准化性状进行回归得到的斜率来估计，其中性状在种群层面上被标准化为均值 $0$ 和方差 $1$。\n\n您必须执行以下步骤：\n1. 性状标准化：给定原始性状值 $z_i$，计算标准化值 $z_i' = (z_i - \\bar{z}) / \\sigma_z$，其中 $\\bar{z}$ 是样本均值，$\\sigma_z$ 是使用除数 $N$（而非 $N-1$）计算的性状的总体标准差。\n2. 生存力阶段：对所有个体计算生存力相对适合度 $v_i = V_i / \\bar{V}$，其中 $\\bar{V}$ 是所有个体中 $V_i$ 的样本均值。通过将 $v_i$ 对 $z_i'$ 进行回归（包括截距），将得到的 OLS 斜率作为定向生存力梯度的估计值。\n3. 交配阶段：仅限于 $V_i = 1$ 的存活者。计算交配相对适合度 $m_i = M_i / \\bar{M}_S$，其中 $\\bar{M}_S$ 是存活者中 $M_i$ 的样本均值。通过在存活者中将 $m_i$ 对 $z_i'$ 进行回归（包括截距），将得到的 OLS 斜率作为定向交配梯度的估计值。使用在种群层面上计算的相同标准化性状值 $z_i'$。\n4. 总选择：对所有个体计算 $W_i = V_i \\times M_i$ 和总相对适合度 $w_i = W_i / \\bar{W}$。通过将 $w_i$ 对 $z_i'$ 进行回归（包括截距），将得到的 OLS 斜率作为净定向选择梯度的估计值。\n5. 进化预测：给定标准化尺度上的性状加性遗传方差，记为 $G'$，这是在表型方差等于 $1$ 的单位下表示的加性遗传方差。使用定向选择下的标准加性遗传响应，预测标准化性状均值的单代变化，并以性状标准差单位报告。\n\n您的程序必须对以下测试套件执行上述计算，并按所列顺序为每个案例生成结果。在每个案例中，所有数组均按个体索引对齐。\n\n案例 A（两个阶段均有贡献的一般情况）：\n- 性状值 $z$：$[-0.7,-0.4,-0.2,0.0,0.1,0.3,0.6,0.8,1.1,1.3]$\n- 生存力 $V$：$[0,1,1,1,1,1,1,1,1,0]$\n- 交配次数 $M$：$[0,1,1,2,2,3,3,4,5,0]$\n- 加性遗传方差（标准化尺度）$G'$：$0.4$\n\n案例 B（无选择的边界情况：恒定生存力和恒定交配）：\n- 性状值 $z$：$[-1.0,-0.5,0.0,0.5,1.0]$\n- 生存力 $V$：$[1,1,1,1,1]$\n- 交配次数 $M$：$[2,2,2,2,2]$\n- 加性遗传方差（标准化尺度）$G'$：$0.3$\n\n案例 C（阶段作用相反：生存力不利于高性状值，交配偏好高性状值）：\n- 性状值 $z$：$[-1.5,-1.0,-0.8,-0.5,-0.2,0.0,0.2,0.5,0.8,1.0,1.2,1.5]$\n- 生存力 $V$：$[1,1,1,1,1,1,1,1,0,0,0,0]$\n- 交配次数 $M$：$[1,1,1,2,2,3,3,4,0,0,0,0]$\n- 加性遗传方差（标准化尺度）$G'$：$0.5$\n\n每个案例的所需输出：\n- 一个包含四个浮点数的列表 $[b_V, b_M, b_T, \\Delta]$，其中 $b_V$ 是生存力定向梯度，$b_M$ 是交配定向梯度，$b_T$ 是总定向梯度，$\\Delta$ 是预测的标准化性状均值的单代变化。\n- 将所有四个数字表示为小数点后保留六位的小数。由于性状是标准化的，这些值以性状标准差为单位。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含所有案例的结果，形式为列表的列表，顺序为 A、B、C。例如：\"[[a1,a2,a3,a4],[b1,b2,b3,b4],[c1,c2,c3,c4]]\"。不得有其他打印文本。", "solution": "所呈现的问题是进化数量遗传学中的一个标准练习。该问题定义明确，有科学依据，并为获得唯一解提供了所有必要信息。其定义和程序与 Lande and Arnold (1983) 建立的衡量自然选择的基础框架一致。因此，该问题是有效的，我们着手求解。\n\n目标是计算两个适合度阶段——生存力（$V$）和交配成功率（$M$）——以及总适合度（$W$）的定向选择梯度（$b$），然后预测对选择的进化响应（$\\Delta$）。性状的选择梯度定义为相对适合度对标准化性状值进行线性回归的斜率。\n\n首先，我们形式化选择梯度的计算。对于因变量 $y$（相对适合度）对自变量 $x$（标准化性状 $z'$）的简单线性回归，我们记为 $b$ 的普通最小二乘法（OLS）斜率由下式给出：\n$$\nb = \\frac{\\text{cov}(x, y)}{\\text{var}(x)}\n$$\n在这个问题中，性状 $z$ 被标准化为 $z'$，使得在整个大小为 $N$ 的初始种群中，其均值为 $\\bar{z}' = 0$，方差为 $\\text{var}(z') = 1$。\n\n程序执行如下：\n\n步骤 1：性状标准化\n对于一组原始性状值 $\\{z_i\\}$，我们计算总体均值 $\\bar{z}$ 和总体标准差 $\\sigma_z$（使用除数 $N$）。每个个体 $i$ 的标准化性状值为：\n$$\nz'_i = \\frac{z_i - \\bar{z}}{\\sigma_z}\n$$\n根据定义，完整的 $\\{z'_i\\}$ 集合的均值为 $0$，方差为 $1$。\n\n步骤 2：生存力选择梯度 ($b_V$)\n生存力相对适合度为 $v_i = V_i / \\bar{V}$，为所有 $N$ 个个体计算。生存力选择梯度 $b_V$ 是将 $v_i$ 对 $z'_i$ 进行回归得到的 OLS 斜率。由于此回归是在整个种群上进行的，其中 $\\text{var}(z') = 1$，公式简化为：\n$$\nb_V = \\frac{\\text{cov}(z', v)}{\\text{var}(z')} = \\text{cov}(z', v)\n$$\n此外，由于 $\\bar{z}' = 0$，协方差简化为乘积的均值：$\\text{cov}(z', v) = E[z'v] - E[z']E[v] = E[z'v]$。因此：\n$$\nb_V = \\frac{1}{N} \\sum_{i=1}^{N} z'_i v_i\n$$\n\n步骤 3：交配选择梯度 ($b_M$)\n此分析仅限于存活下来的 $N_S$ 个个体（即 $V_i = 1$ 的个体）。交配相对适合度为 $m_i = M_i / \\bar{M}_S$，其中 $\\bar{M}_S$ 是存活者中的平均交配成功率。交配选择梯度 $b_M$ 是将此存活者子集中的 $m_i$ 对 $z'_i$ 进行回归得到的 OLS 斜率。\n关键在于，存活者子集内标准化性状值的方差 $\\text{var}(z'_{survivors})$ 不一定等于 $1$。因此，我们必须使用完整的 OLS 斜率公式，并仅应用于 $N_S$ 个存活者：\n$$\nb_M = \\frac{\\text{cov}(z'_{survivors}, m_{survivors})}{\\text{var}(z'_{survivors})}\n$$\n其中协方差和方差是在存活者子集上计算的。\n\n步骤 4：总选择梯度 ($b_T$)\n总绝对适合度是 $W_i = V_i \\times M_i$。总相对适合度是 $w_i = W_i / \\bar{W}$。总选择梯度 $b_T$ 是通过在整个初始种群 $N$ 个个体上将 $w_i$ 对 $z'_i$ 进行回归计算得出的。与生存力梯度一样，$\\text{var}(z') = 1$，因此计算简化为：\n$$\nb_T = \\frac{\\text{cov}(z', w)}{\\text{var}(z')} = \\text{cov}(z', w) = \\frac{1}{N} \\sum_{i=1}^{N} z'_i w_i\n$$\n量 $b_T$ 代表了在所有适合度阶段中作用于该性状的净定向选择压力。\n\n步骤 5：预测的进化变化 ($\\Delta$)\n标准化性状均值的单代变化由育种家方程预测。选择响应（$\\Delta$）是性状遗传力（$h^2$）与选择差（$S$）的乘积。在标准化尺度上，表型方差为 $1$，因此遗传力在数值上等于标准化加性遗传方差，即 $h^2 = G'/P' = G'/1 = G'$。标准化性状的选择差等于总选择梯度，即 $S' = b_T$。因此，预测方程为：\n$$\n\\Delta = G' \\times b_T\n$$\n这个预测的变化 $\\Delta$ 以表型标准差为单位。\n\n下面的Python代码为每个给定的测试用例精确地实现了这一逻辑。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to execute the analysis for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        {\n            \"z\": [-0.7, -0.4, -0.2, 0.0, 0.1, 0.3, 0.6, 0.8, 1.1, 1.3],\n            \"V\": [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],\n            \"M\": [0, 1, 1, 2, 2, 3, 3, 4, 5, 0],\n            \"G_prime\": 0.4\n        },\n        {\n            \"z\": [-1.0, -0.5, 0.0, 0.5, 1.0],\n            \"V\": [1, 1, 1, 1, 1],\n            \"M\": [2, 2, 2, 2, 2],\n            \"G_prime\": 0.3\n        },\n        {\n            \"z\": [-1.5, -1.0, -0.8, -0.5, -0.2, 0.0, 0.2, 0.5, 0.8, 1.0, 1.2, 1.5],\n            \"V\": [1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0],\n            \"M\": [1, 1, 1, 2, 2, 3, 3, 4, 0, 0, 0, 0],\n            \"G_prime\": 0.5\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_selection(case[\"z\"], case[\"V\"], case[\"M\"], case[\"G_prime\"])\n        results.append(result)\n\n    # Format the output string exactly as specified.\n    sub_strings = []\n    for r in results:\n        # Format each number to 6 decimal places.\n        formatted_numbers = [f\"{val:.6f}\" for val in r]\n        sub_strings.append(f\"[{','.join(formatted_numbers)}]\")\n    \n    final_output = f\"[{','.join(sub_strings)}]\"\n    print(final_output)\n\ndef calculate_selection(z, V, M, G_prime):\n    \"\"\"\n    Calculates selection gradients and evolutionary response for a single case.\n\n    Args:\n        z (list): Raw trait values.\n        V (list): Viability data (0 or 1).\n        M (list): Mating success counts.\n        G_prime (float): Additive genetic variance on the standardized scale.\n\n    Returns:\n        list: A list containing [b_V, b_M, b_T, delta].\n    \"\"\"\n    z_raw = np.array(z, dtype=np.float64)\n    V_raw = np.array(V, dtype=np.float64)\n    M_raw = np.array(M, dtype=np.float64)\n\n    # 1. Trait standardization\n    z_mean = np.mean(z_raw)\n    z_std = np.std(z_raw)  # Uses N in the denominator by default (ddof=0)\n    # Handle case where trait has no variance\n    if z_std == 0:\n        return [0.0, 0.0, 0.0, 0.0]\n    z_prime = (z_raw - z_mean) / z_std\n\n    # 2. Viability gradient (b_V)\n    b_V = 0.0\n    V_mean = np.mean(V_raw)\n    if V_mean > 0:\n        v_rel = V_raw / V_mean\n        # For regressions on the full dataset, var(z')=1, so gradient is cov(z', y_rel),\n        # which simplifies to mean(z' * y_rel) because mean(z')=0.\n        b_V = np.mean(z_prime * v_rel)\n\n    # 3. Mating gradient (b_M)\n    b_M = 0.0\n    survivors_mask = V_raw == 1\n    num_survivors = np.sum(survivors_mask)\n    if num_survivors >= 2: # OLS regression requires at least 2 data points\n        z_prime_survivors = z_prime[survivors_mask]\n        M_survivors = M_raw[survivors_mask]\n        \n        M_S_mean = np.mean(M_survivors)\n        if M_S_mean > 0:\n            m_rel = M_survivors / M_S_mean\n            \n            # Regression is on a subset, so var(z') is not 1. Use full OLS slope formula.\n            var_z_survivors = np.var(z_prime_survivors) # ddof=0 for population variance of the subset\n            if var_z_survivors > 0:\n                cov_zm_survivors = np.cov(z_prime_survivors, m_rel, ddof=0)[0, 1]\n                b_M = cov_zm_survivors / var_z_survivors\n\n    # 4. Total gradient (b_T)\n    b_T = 0.0\n    W_raw = V_raw * M_raw\n    W_mean = np.mean(W_raw)\n    if W_mean > 0:\n        w_rel = W_raw / W_mean\n        # Regression on full dataset, so simplified formula applies.\n        b_T = np.mean(z_prime * w_rel)\n\n    # 5. Evolutionary prediction (Delta)\n    delta = G_prime * b_T\n    \n    return [b_V, b_M, b_T, delta]\n\nsolve()\n```", "id": "2526754"}]}