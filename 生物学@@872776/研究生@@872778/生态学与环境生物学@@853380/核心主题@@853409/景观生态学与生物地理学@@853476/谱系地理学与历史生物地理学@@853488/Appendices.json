{"hands_on_practices": [{"introduction": "有效种群大小（$N_e$）是谱系地理学中的一个关键参数，因为它决定了遗传漂变的速度和祖先多态性的保留程度。本练习将提供从核苷酸多样性（$\\pi$）——一个通过序列数据普遍测量的汇总统计量——来估算 $N_e$ 的实践机会。通过应用溯祖理论中的一个基本方程 ([@problem_id:2521267])，您将把可观察的遗传变异与种群深时人口历史的一个关键方面直接联系起来。", "problem": "正在研究一个全交配的岛屿蜥蜴谱系，以在系统地理学背景下推断其种群历史。您从该物种分布范围内采样的 $n$ 个二倍体个体中，测序了一个长度为 $L$ 个碱基对的、假定为中性且不重组的单核基因座。经过严格的质量控制以排除有选择证据的位点后，观测到的单位点平均成对核苷酸多样性（所有染色体对之间单位点成对差异的平均分数），记为 $\\pi$，其值为 $\\pi = 0.0087$。对该基因座的单位点、每代突变率的独立谱系估计值为 $\\mu = 1.1 \\times 10^{-8}$。\n\n假设一个在突变-漂变平衡状态下的 Wright–Fisher 种群模型，该模型具有恒定的种群大小、二倍体遗传、中性以及无限位点突变模型。在这些假设下，估计该谱系的二倍体有效种群大小 $N_{e}$。将您的最终答案四舍五入到 $3$ 位有效数字。将您的最终答案表示为二倍体个体的数量。", "solution": "该问题陈述已经过严格验证，被认为是有效的。它科学地基于群体遗传学原理，问题阐述清晰，提供了足够的信息以获得唯一解，并且陈述客观。该问题要求应用基本理论，根据遗传数据估计一个关键的种群统计学参数。\n\n这个问题的核心在于，在突变-漂变平衡状态下 Wright–Fisher 模型的特定假设下，核苷酸多样性、有效种群大小和突变率之间的关系。对于一个恒定大小的二倍体、全交配种群，单位点预期平均成对核苷酸多样性，记为 $E[\\pi]$，等于种群突变参数 $\\theta$。\n\n二倍体种群中种群突变参数 $\\theta$ 的公式由下式给出：\n$$\n\\theta = 4 N_{e} \\mu\n$$\n其中 $N_{e}$ 是二倍体有效种群大小，$\\mu$ 是单位点每代的中性突变率。\n\n在突变-漂变平衡状态下，预期的核苷酸多样性等于这个参数：\n$$\nE[\\pi] = \\theta = 4 N_{e} \\mu\n$$\n问题给出了观测到的平均成对核苷酸多样性 $\\pi = 0.0087$，这是我们对理论期望值 $E[\\pi]$ 的经验估计。我们还得到了单位点、每代突变率 $\\mu = 1.1 \\times 10^{-8}$。提供的其他参数，如基因座长度 $L$ 和样本量 $n$，是真实研究的背景信息，但对于本次具体计算并非必需，因为 $\\pi$ 已经作为单位点的平均值给出。\n\n我们可以使用所提供的数据建立以下方程：\n$$\n\\pi = 4 N_{e} \\mu\n$$\n我们的目标是求解二倍体有效种群大小 $N_{e}$。我们可以对该方程进行代数重排：\n$$\nN_{e} = \\frac{\\pi}{4 \\mu}\n$$\n现在，我们将给定的数值代入这个表达式中：\n$$\n\\pi = 0.0087\n$$\n$$\n\\mu = 1.1 \\times 10^{-8}\n$$\n将这些值代入我们关于 $N_{e}$ 的方程中：\n$$\nN_{e} = \\frac{0.0087}{4 \\times (1.1 \\times 10^{-8})}\n$$\n首先，计算分母：\n$$\n4 \\times 1.1 \\times 10^{-8} = 4.4 \\times 10^{-8}\n$$\n现在，进行除法运算：\n$$\nN_{e} = \\frac{0.0087}{4.4 \\times 10^{-8}} = \\frac{8.7 \\times 10^{-3}}{4.4 \\times 10^{-8}}\n$$\n$$\nN_{e} = \\left(\\frac{8.7}{4.4}\\right) \\times 10^{-3 - (-8)} = \\left(\\frac{8.7}{4.4}\\right) \\times 10^{5}\n$$\n系数的除法结果是：\n$$\n\\frac{8.7}{4.4} \\approx 1.977272...\n$$\n因此，有效种群大小为：\n$$\nN_{e} \\approx 1.977272... \\times 10^{5} \\approx 197727.27...\n$$\n问题要求最终答案四舍五入到 $3$ 位有效数字。前三位有效数字是 $1$、$9$ 和 $7$。第四位有效数字是 $7$，大于或等于 $5$，所以我们必须将第三位有效数字向上取整。\n$$\nN_{e} \\approx 1.98 \\times 10^{5}\n$$\n这对应于估计的二倍体有效种群大小为 $198,000$ 个个体。", "answer": "$$\\boxed{1.98 \\times 10^{5}}$$", "id": "2521267"}, {"introduction": "在基因组学时代，我们常常发现不同基因座的基因树在物种关系上讲述着相互矛盾的故事，这一现象主要由不完全谱系分选（ILS）驱动。理解产生 ILS 的条件对于准确重建物种树和解释谱系地理学模式至关重要。本练习 ([@problem_id:2521228]) 将指导您计算基因树不一致的预期频率，阐明物种形成时间间隔过短是如何导致高水平 ILS 的。", "problem": "考虑一个拓扑结构为 $((A,B),C)$ 的有根三分类单元物种树，该物种树在标准多物种溯祖模型下随二倍体生物演化。假设以下条件成立：每个谱系内随机交配，中性选择，物种形成后无基因流，基因座内无重组，以及基因座之间相互独立。每个祖先分支上的有效种群大小是恒定的，等于 $N_e$。设 $A$ 和 $B$ 的分化发生在时间 $\\tau_{AB}$（以代为单位），$(A,B)$ 与 $C$ 的分化发生在时间 $\\tau_{ABC}$（以代为单位），且 $\\tau_{ABC} \\gt \\tau_{AB}$。这两个物种形成事件之间的内部自分支长度为 $\\Delta T = \\tau_{ABC} - \\tau_{AB}$。给定 $\\Delta T$ 等于 $1.2\\,N_e$ 代。\n\n仅使用溯祖理论的基本性质（具体而言，在一个大小为 $N_e$ 的恒定大小二倍体种群中，两个谱系的溯祖等待时间呈指数分布，其速率为 $1/(2N_e)$；并且当三个谱系进入一个单一的恒定大小种群时，首个溯祖对的身份在三个谱系对之间是可交换的），计算在大量独立基因座中，纯粹由不完全谱系分选（ILS）导致的基因树与物种树拓扑不一致的期望比例。\n\n将最终答案表示为一个无单位的小数，并四舍五入到 $4$ 位有效数字。", "solution": "该问题提出了一个系统发育学中的经典情景，用于计算因不完全谱系分选（ILS）导致的基因树-物种树不一致性的概率。该问题定义明确，科学上合理，并包含了获得唯一解所需的所有信息。\n\n我们分别将从物种 $A$、$B$ 和 $C$ 中抽样的三个基因谱系表示为 $a$、$b$ 和 $c$。物种树的拓扑结构为 $((A,B),C)$。这意味着物种 $A$ 和 $B$ 拥有比它们中任何一个与物种 $C$ 更近的共同祖先。\n\n我们向后追溯这三个谱系的历史。从现在到时间 $\\tau_{AB}$，这些谱系在各自物种的祖先种群中独立演化。在时间 $\\tau_{AB}$，谱系 $a$ 和 $b$ 进入它们的共同祖先种群，我们将其表示为 $AB$。谱系 $c$ 仍然在一个独立的祖先谱系中。这种状态在内部自分支的持续时间 $\\Delta T = \\tau_{ABC} - \\tau_{AB}$ 内保持不变。在时间 $\\tau_{ABC}$，祖先种群 $AB$ 和 $C$ 的祖先谱系合并成一个单一的共同祖先种群，我们将其表示为 $ABC$。此时，进入种群 $ABC$ 的谱系数量为两个或三个，具体取决于在时间间隔 $\\Delta T$ 内发生了什么。\n\n基因树的拓扑结构由溯祖事件的顺序决定。一个与物种树一致的基因树，即拓扑结构为 $((A,B),C)$，当且仅当谱系 $a$ 和 $b$ 在它们任何一个与谱系 $c$ 发生溯祖之前，首先相互发生溯祖时形成。\n\n在时间间隔 $\\Delta T$ 内，谱系 $a$ 和 $b$ 有两种互斥的情况：\n$1$. 两个谱系 $a$ 和 $b$ 在种群 $AB$ 内发生溯祖。\n$2$. 两个谱系 $a$ 和 $b$ 未能在种群 $AB$ 内发生溯祖，并作为独立的谱系与谱系 $c$ 一同进入更深层的祖先种群 $ABC$。\n\n我们来分析这些情况的概率。问题陈述，在有效种群大小为 $N_e$ 的恒定大小二倍体种群中，任何两个谱系发生溯祖的等待时间呈指数分布，速率参数为 $\\lambda = \\frac{1}{2N_e}$ 每代。内部自分支的持续时间给定为 $\\Delta T$。\n\n两个谱系在时间间隔 $\\Delta T$ 内未能发生溯祖的概率由指数分布的生存函数给出：\n$$P(\\text{no coalescence in } \\Delta T) = \\exp\\left(-\\lambda \\Delta T\\right) = \\exp\\left(-\\frac{\\Delta T}{2N_e}\\right)$$\n因此，它们在此时间间隔内确实发生溯祖的概率是：\n$$P(\\text{coalescence in } \\Delta T) = 1 - \\exp\\left(-\\frac{\\Delta T}{2N_e}\\right)$$\n\n如果在时间间隔 $\\Delta T$ 内发生溯祖（情况1），那么谱系 $a$ 和 $b$ 合并。由此产生的祖先谱系和谱系 $c$ 进入种群 $ABC$。此时只有两个谱系，它们将不可避免地在更早的某个时间点发生溯祖。在这种情况下，基因树的拓扑结构保证是 $((A,B),C)$，这与物种树一致。\n\n只有当情况2发生时，才会产生不一致的基因树。也就是说，谱系 $a$ 和 $b$ 必须未能在内部自分支中发生溯祖。此事件的概率是 $P(\\text{no coalescence in } \\Delta T)$。如果发生这种情况，三个独立的谱系（$a$、$b$ 和 $c$）在时间 $\\tau_{ABC}$ 进入祖先种群 $ABC$。\n\n问题陈述，在这个单一的、随机交配的种群 $ABC$ 中，首个发生溯祖的谱系对的身份是可交换的。这意味着三种可能的配对——$(a,b)$、$(a,c)$ 或 $(b,c)$——作为首个溯祖对的可能性是相等的。任何特定配对首先发生溯祖的概率是 $\\frac{1}{3}$。\n最终的基因树拓扑取决于哪个配对首先发生溯祖：\n- 如果 $(a,b)$ 首先发生溯祖，拓扑结构是 $((A,B),C)$（一致）。这以条件概率 $\\frac{1}{3}$ 发生。\n- 如果 $(a,c)$ 首先发生溯祖，拓扑结构是 $((A,C),B)$（不一致）。这以条件概率 $\\frac{1}{3}$ 发生。\n- 如果 $(b,c)$ 首先发生溯祖，拓扑结构是 $((B,C),A)$（不一致）。这以条件概率 $\\frac{1}{3}$ 发生。\n\n因此，在三个谱系进入种群 $ABC$ 的条件下，获得不一致拓扑的概率是后两种结果的概率之和：\n$$P(\\text{discordant} | \\text{no coalescence in } \\Delta T) = \\frac{1}{3} + \\frac{1}{3} = \\frac{2}{3}$$\n观察到不一致基因树的总概率 $P_d$ 是情况2发生的概率乘以在情况2发生条件下出现不一致的条件概率。\n$$P_d = P(\\text{no coalescence in } \\Delta T) \\times P(\\text{discordant} | \\text{no coalescence in } \\Delta T)$$\n$$P_d = \\exp\\left(-\\frac{\\Delta T}{2N_e}\\right) \\times \\frac{2}{3}$$\n\n问题提供了内部自分支长度的具体值：$\\Delta T = 1.2 N_e$ 代。我们将其代入方程：\n$$P_d = \\frac{2}{3} \\exp\\left(-\\frac{1.2 N_e}{2 N_e}\\right)$$\n$N_e$ 项被消去，简化了指数部分：\n$$P_d = \\frac{2}{3} \\exp(-0.6)$$\n现在，我们必须计算数值。\n$$P_d \\approx \\frac{2}{3} \\times 0.548811636$$\n$$P_d \\approx 0.365874424$$\n问题要求答案四舍五入到 $4$ 位有效数字。这得到 $0.3659$。\n\n在大量独立基因座中，不一致基因树的期望比例等同于这个概率 $P_d$。", "answer": "$$\\boxed{0.3659}$$", "id": "2521228"}, {"introduction": "历史生物地理学的一个主要目标是推断谱系的地理历史，包括祖先分布区以及扩散、地理隔离和绝灭的过程。研究人员将相互竞争的假说构建为统计模型（例如 DEC、DIVA-like），并利用系统发育和地理数据对其进行检验。这项高级实践 ([@problem_id:2521298]) 介绍了模型选择的核心任务，您将使用信息论（AICc）和贝叶斯方法来比较不同生物地理学模型的表现，这是得出稳健历史推论的一项关键技能。", "problem": "给定三个拟合到同一谱系地理学数据集的历史生物地理学模型：Dispersal–Extinction–Cladogenesis (DEC)、Dispersal–Vicariance Analysis-like (DIVA-like) 和 BAYAREALIKE。对于每个模型和测试用例，您将获得最大对数似然和在模型上采用均匀先验的对数边缘似然（对数证据）。假设自由参数的数量为 $k_{\\text{DEC}} = 2$、$k_{\\text{DIVA-like}} = 1$ 和 $k_{\\text{BAYAREALIKE}} = 1$。假设有效样本量为每个案例中给出的 $n$。\n\n您的任务是实现一个程序，为每个测试用例执行以下操作：\n- 应用基于 Kullback–Leibler 散度最小化的信息论模型选择方法，计算小样本校正的赤池信息准则 (AICc)。选择 AICc 最低的模型。然后，通过将 AICc 差异转换为三个模型上的归一化权重，计算所选模型的赤池权重。\n- 应用贝叶斯模型比较，通过使用贝叶斯定理，将在模型上采用均匀先验的给定对数边缘似然（对数证据）转换为后验模型概率。选择后验概率最高的模型。为保证数值稳定性，在对对数值进行指数运算时，请使用避免下溢的方法。\n- 报告每个测试用例的 AICc 选择模型的索引、后验选择模型的索引、两种选择是否一致、后验选择模型的后验概率（四舍五入到四位小数）以及 AICc 选择模型的赤池权重（四舍五入到四位小数）。\n\n按如下方式使用索引解释三个模型名称：DEC $\\rightarrow$ 索引 $0$，DIVA-like $\\rightarrow$ 索引 $1$，BAYAREALIKE $\\rightarrow$ 索引 $2$。\n\n使用以下涵盖多种情况的测试套件：\n- 案例 A（一般情况，中等 $n$）：$n = 50$；最大对数似然 ($\\ell_{\\text{DEC}}, \\ell_{\\text{DIVA-like}}, \\ell_{\\text{BAYAREALIKE}}$) = $(-120.5, -119.2, -121.0)$；对数边缘似然 ($\\log Z_{\\text{DEC}}, \\log Z_{\\text{DIVA-like}}, \\log Z_{\\text{BAYAREALIKE}}$) = $(-123.0, -122.1, -124.5)$。\n- 案例 B（DEC 模型具有明显拟合优势，较大 $n$）：$n = 80$；最大对数似然 ($\\ell_{\\text{DEC}}, \\ell_{\\text{DIVA-like}}, \\ell_{\\text{BAYAREALIKE}}$) = $(-100.0, -106.0, -104.0)$；对数边缘似然 ($\\log Z_{\\text{DEC}}, \\log Z_{\\text{DIVA-like}}, \\log Z_{\\text{BAYAREALIKE}}$) = $(-101.5, -109.0, -106.0)$。\n- 案例 C（小 $n$，更强的小样本惩罚）：$n = 8$；最大对数似然 ($\\ell_{\\text{DEC}}, \\ell_{\\text{DIVA-like}}, \\ell_{\\text{BAYAREALIKE}}$) = $(-15.0, -15.2, -15.25)$；对数边缘似然 ($\\log Z_{\\text{DEC}}, \\log Z_{\\text{DIVA-like}}, \\log Z_{\\text{BAYAREALIKE}}$) = $(-16.5, -16.0, -16.1)$。\n- 案例 D（似然值接近，信息论方法与贝叶斯方法可能存在分歧）：$n = 40$；最大对数似然 ($\\ell_{\\text{DEC}}, \\ell_{\\text{DIVA-like}}, \\ell_{\\text{BAYAREALIKE}}$) = $(-80.0, -79.7, -79.8)$；对数边缘似然 ($\\log Z_{\\text{DEC}}, \\log Z_{\\text{DIVA-like}}, \\log Z_{\\text{BAYAREALIKE}}$) = $(-81.2, -81.5, -82.0)$。\n\n要求和约定：\n- 您的推导应基于核心定义，即赤池信息准则通过参数数量惩罚来近似拟合模型与数据生成过程之间的预期 Kullback–Leibler 散度，并且小样本校正调整了有限样本偏差；以及后验模型概率与模型先验和边缘似然的乘积成正比。\n- 不涉及角度。\n- 概率必须以小数（而非百分比表示法）报告，并四舍五入到四位小数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。每个测试用例的结果必须是 [$a$, $b$, $c$, $d$, $e$] 形式的列表，其中 $a$ 是 AICc 选择模型的索引（整数），$b$ 是后验选择模型的索引（整数），$c$ 是一个布尔值，表示是否一致，$d$ 是后验选择模型的后验概率（浮点数，四舍五入到四位小数），$e$ 是 AICc 选择模型的赤池权重（浮点数，四舍五入到四位小数）。例如，一个包含两个假设案例的有效输出可能看起来像“[[0,1,False,0.6123,0.7011],[2,2,True,0.8450,0.7732]]”。", "solution": "所提出的问题是计算统计学在历史生物地理学领域应用的一个标准练习。它具有科学依据、提法明确，并包含了获得唯一解所需的所有信息。引用的模型——Dispersal–Extinction–Cladogenesis (DEC)、Dispersal–Vicariance Analysis-like (DIVA-like) 和 BAYAREALIKE——是在系统发育树上推断祖先分布区和生物地理历史的既定工具。使用信息论和贝叶斯框架比较这些模型是现代科学实践的基石。因此，该问题被认为是有效的。\n\n我们将对模型选择所需的量进行严谨、分步的推导。目的不仅仅是计算数字，而是理解支持这些计算的基本原理。\n\n科学模型是对现实的近似。当面对多个相互竞争的模型时，我们需要一个客观的标准来选择在拟合优度与复杂性之间提供最佳权衡的模型。我们将研究两种这样的标准。\n\n首先是基于 Kullback–Leibler 散度的信息论方法。赤池信息准则 (AIC) 是当使用一个给定模型来表示生成数据的过程时，预期相对信息损失的估计量。对于模型 $i$，AIC 定义为：\n$$\n\\mathrm{AIC}_i = -2\\ell_i + 2k_i\n$$\n其中 $\\ell_i$ 是模型的最大对数似然，$k_i$ 是可估计参数的数量。然而，这个公式假设样本量 $n$ 很大。当 $n$ 不显著大于 $k$ 时，需要进行二阶校正以考虑小样本偏差。这得到了小样本校正的赤池信息准则 ($\\mathrm{AICc}$):\n$$\n\\mathrm{AICc}_i = \\mathrm{AIC}_i + \\frac{2k_i(k_i+1)}{n-k_i-1} = -2\\ell_i + 2k_i + \\frac{2k_i(k_i+1)}{n-k_i-1}\n$$\n这个校正项增加了对参数的惩罚，尤其是在 $n$ 较小的时候。$\\mathrm{AICc}$ 值最小的模型被选为该集合中的最佳近似模型。\n\n为了量化每个模型 $i$ 成为最佳模型的合理性，我们使用赤池权重 ($w_i$)。首先，我们计算每个模型的 $\\mathrm{AICc}$ 与集合中最小 $\\mathrm{AICc}$ 之间的差值：$\\Delta_i = \\mathrm{AICc}_i - \\min_j(\\mathrm{AICc}_j)$。然后，模型 $i$ 的赤池权重为：\n$$\nw_i = \\frac{\\exp(-\\frac{1}{2}\\Delta_i)}{\\sum_{j=1}^{M} \\exp(-\\frac{1}{2}\\Delta_j)}\n$$\n其中 $M$ 是被比较的模型的数量。权重 $w_i$ 可以解释为在给定数据和模型集合的情况下，模型 $i$ 是集合中最佳模型的概率。\n\n其次是贝叶斯模型选择方法。该框架使用贝叶斯定理，根据观测到的数据来更新我们对模型的先验信念。给定数据 $D$ 的模型 $M_i$ 的后验概率为：\n$$\nP(M_i | D) = \\frac{P(D | M_i) P(M_i)}{P(D)}\n$$\n这里，$P(M_i)$ 是模型的先验概率。问题指定了均匀先验，因此对于所有 $i$，$P(M_i) = 1/M$。项 $P(D | M_i)$ 是模型的边缘似然，或称证据，我们记作 $Z_i$。它表示在模型的整个参数空间上积分得到的数据的概率。分母 $P(D) = \\sum_{j=1}^{M} P(D|M_j)P(M_j)$ 是一个归一化常数，确保后验概率之和为 $1$。在均匀先验下，后验概率简化为：\n$$\nP(M_i | D) = \\frac{Z_i}{\\sum_{j=1}^{M} Z_j}\n$$\n选择后验概率最高的模型。在计算上，我们得到的是对数边缘似然 ($\\log Z_i$)，因此我们必须小心处理指数运算以避免数值下溢。令 $L_j = \\log Z_i$ 且 $L_{\\max} = \\max_j(L_j)$。后验概率计算如下：\n$$\nP(M_i | D) = \\frac{\\exp(L_i)}{\\sum_{j=1}^{M} \\exp(L_j)} = \\frac{\\exp(L_i - L_{\\max})}{\\sum_{j=1}^{M} \\exp(L_j - L_{\\max})}\n$$\n这种被称为 log-sum-exp 技巧的操作确保了数值稳定性。\n\n程序将为每个测试用例实现这两个不同的过程。对于每个案例，它将输入有效样本量 $n$、最大对数似然向量 ($\\ell_{\\text{DEC}}, \\ell_{\\text{DIVA-like}}, \\ell_{\\text{BAYAREALIKE}}$) 和对数边缘似然向量 ($\\log Z_{\\text{DEC}}, \\log Z_{\\text{DIVA-like}}, \\log Z_{\\text{BAYAREALIKE}}$)。每个模型的参数数量是常数：$k_{\\text{DEC}} = 2$、$k_{\\text{DIVA-like}} = 1$ 和 $k_{\\text{BAYAREALIKE}} = 1$。程序将计算每个模型的 $\\mathrm{AICc}$，确定最佳模型（最小 $\\mathrm{AICc}$），并计算其赤池权重。同时，它将计算每个模型的后验概率，确定最佳模型（最大后验概率），并记录该概率。最后，它将报告所选模型的索引、两种选择是否一致，以及相应的权重和概率指标，按规定进行四舍五入。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs model selection using AICc and Bayesian posterior probabilities\n    for phylogeographic models.\n    \"\"\"\n    # Define the number of free parameters for each model.\n    # Index 0: DEC, Index 1: DIVA-like, Index 2: BAYAREALIKE\n    k_params = np.array([2, 1, 1])\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"n\": 50,\n            \"log_L\": np.array([-120.5, -119.2, -121.0]),\n            \"log_Z\": np.array([-123.0, -122.1, -124.5])\n        },\n        {\n            \"name\": \"Case B\",\n            \"n\": 80,\n            \"log_L\": np.array([-100.0, -106.0, -104.0]),\n            \"log_Z\": np.array([-101.5, -109.0, -106.0])\n        },\n        {\n            \"name\": \"Case C\",\n            \"n\": 8,\n            \"log_L\": np.array([-15.0, -15.2, -15.25]),\n            \"log_Z\": np.array([-16.5, -16.0, -16.1])\n        },\n        {\n            \"name\": \"Case D\",\n            \"n\": 40,\n            \"log_L\": np.array([-80.0, -79.7, -79.8]),\n            \"log_Z\": np.array([-81.2, -81.5, -82.0])\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        n = case['n']\n        log_L = case['log_L']\n        log_Z = case['log_Z']\n\n        # --- Information-Theoretic (AICc) Model Selection ---\n        \n        # Calculate AICc for each model.\n        # AICc = -2*logL + 2*k + (2*k*(k+1))/(n-k-1)\n        aicc = -2 * log_L + 2 * k_params + (2 * k_params * (k_params + 1)) / (n - k_params - 1)\n        \n        # Select the model with the minimum AICc.\n        aicc_selected_idx = int(np.argmin(aicc))\n        \n        # Calculate Akaike weights.\n        min_aicc = aicc[aicc_selected_idx]\n        delta_aicc = aicc - min_aicc\n        \n        # Numerator of Akaike weights formula\n        exp_delta_half = np.exp(-0.5 * delta_aicc)\n        \n        # Denominator (sum over all models)\n        sum_exp_delta_half = np.sum(exp_delta_half)\n        \n        akaike_weights = exp_delta_half / sum_exp_delta_half\n        aicc_selected_weight = round(akaike_weights[aicc_selected_idx], 4)\n\n        # --- Bayesian Model Selection ---\n        \n        # Select the model with the maximum log marginal likelihood (log-evidence).\n        posterior_selected_idx = int(np.argmax(log_Z))\n        \n        # Calculate posterior model probabilities using the log-sum-exp trick for stability.\n        log_Z_max = np.max(log_Z)\n        rel_log_Z = log_Z - log_Z_max\n        \n        # Exponentiate relative log-evidences\n        exp_rel_log_Z = np.exp(rel_log_Z)\n        \n        # Sum is the normalization constant\n        sum_exp_rel_log_Z = np.sum(exp_rel_log_Z)\n        \n        posterior_probs = exp_rel_log_Z / sum_exp_rel_log_Z\n        posterior_selected_prob = round(posterior_probs[posterior_selected_idx], 4)\n        \n        # --- Final Reporting ---\n        \n        # Check if the two selection methods agree.\n        agreement = (aicc_selected_idx == posterior_selected_idx)\n        \n        # Assemble the result for the current test case.\n        result = [\n            aicc_selected_idx,\n            posterior_selected_idx,\n            agreement,\n            posterior_selected_prob,\n            aicc_selected_weight\n        ]\n        all_results.append(result)\n\n    # Final print statement in the exact required format.\n    # The str(all_results) representation includes spaces, which we remove.\n    # The default str() for booleans (e.g., 'True', 'False') matches the example format.\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "2521298"}]}