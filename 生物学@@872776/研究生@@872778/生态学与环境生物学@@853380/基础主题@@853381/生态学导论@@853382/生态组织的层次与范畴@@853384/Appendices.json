{"hands_on_practices": [{"introduction": "我们从种群组织层次的基础开始：一个具有内部结构的种群的动态。当种群中的个体经历不同的生命阶段时，我们如何从个体的存活率、生长率和繁殖率等生命节律数据，上升到对整个种群长期趋势的预测？此练习将指导你构建一个Lefkovitch矩阵，这是一个核心的种群生态学工具，并用它来计算和解释如种群增长率（$\\lambda$）和稳定阶段分布等关键的涌现属性。[@problem_id:2502393]", "problem": "一个阶段结构化种群在种群水平（一种生态组织层次）上受到监测，其包含三个生命阶段：幼苗（$L$）、幼体（$J$）和成体（$A$）。普查间隔为一年。在两次普查之间，个体可以停留在当前阶段或生长到下一个阶段；不存在退化现象。成体进行繁殖，其后代在下一次普查时进入幼苗阶段。以下年度生命率是根据长期人口统计数据估算的：\n\n- 幼苗存留：幼苗以 $0.4$ 的概率保持为幼苗。\n- 幼苗生长：幼苗以 $0.3$ 的概率成长为幼体。\n- 幼体存留：幼体以 $0.6$ 的概率保持为幼体。\n- 幼体生长：幼体以 $0.2$ 的概率成长为成体。\n- 成体存留（存活）：成体以 $0.8$ 的概率保持为成体。\n- 生育率：每个成体平均产生 $4$ 个新成员，这些新成员能存活到在下一次普查时被计为幼苗；幼体和幼苗不繁殖。\n\n1) 仅使用核心定义，即下一年的种群向量 $\\mathbf{n}_{t+1}$ 是通过将阶段投影矩阵 $\\mathbf{A}$ 应用于当前种群向量 $\\mathbf{n}_{t}$ 得到的，即 $\\mathbf{n}_{t+1}=\\mathbf{A}\\mathbf{n}_{t}$，并且 $\\mathbf{A}$ 的元素 $a_{ij}$ 是指在时间 $t$ 的一个 $j$ 阶段个体在时间 $t+1$ 产生的 $i$ 阶段个体的期望数量，构建一个阶段顺序为 $(L,J,A)$ 的 $3\\times 3$ Lefkovitch 矩阵 $\\mathbf{A}$。\n\n2) 根据线性种群模型的基本原理以及关于非负本原矩阵的 Perron–Frobenius 定理，计算 $\\mathbf{A}$ 的主特征值 $\\lambda$，该值是种群的渐近年均倍增率。将 $\\lambda$ 的最终数值答案四舍五入到四位有效数字。将 $\\lambda$ 表示为一个无量纲的年均乘数。\n\n3) 确定稳定阶段分布（与 $\\lambda$ 相关的右特征向量，归一化使其和为 $1$）和繁殖价值向量（与 $\\lambda$ 相关的左特征向量，归一化使成体繁殖价值等于 $1$）。用生态学术语简要解释这些向量，并将它们与种群水平的推断范围联系起来。\n\n最终答案只需要 $\\lambda$ 的数值。所有中间步骤和解释都必须在您的解答中展示。", "solution": "所提出的问题是线性种群动态学中的一个标准练习，特别是关于阶段结构模型。该问题具有科学依据、提法明确、客观，并包含了获得唯一解所需的所有信息。我们将着手进行分析。\n\n该问题需要一个由三部分组成的解答：1) 构建阶段投影矩阵，2) 计算其主特征值，以及 3) 确定并解释相关的右特征向量和左特征向量。\n\n第 1 部分：构建 Lefkovitch 矩阵 $\\mathbf{A}$\n\n种群被划分为三个阶段：幼苗（$L$）、幼体（$J$）和成体（$A$）。在时间 $t$ 的种群状态由向量 $\\mathbf{n}_{t} = \\begin{pmatrix} n_L(t) \\\\ n_J(t) \\\\ n_A(t) \\end{pmatrix}$ 给出。动态由线性递推关系 $\\mathbf{n}_{t+1} = \\mathbf{A} \\mathbf{n}_{t}$ 控制，其中 $\\mathbf{A}$ 是 $3 \\times 3$ 的 Lefkovitch 矩阵。$\\mathbf{A}$ 的元素 $a_{ij}$ 表示在时间 $t$ 处于阶段 $j$ 的个体对时间 $t+1$ 处于阶段 $i$ 的个体的平均贡献。阶段顺序指定为 ($L, J, A$)。\n\n我们使用提供的生命率构建矩阵 $\\mathbf{A}$：\n-   $a_{11}$：从幼苗到幼苗的贡献。这是幼苗存留概率，给定为 $0.4$。\n-   $a_{12}$：从幼体到幼苗的贡献。幼体不繁殖，所以此项为 $0$。\n-   $a_{13}$：从成体到幼苗的贡献。这是生育率，给定为每个成体平均产生 $4$ 个新幼苗。\n-   $a_{21}$：从幼苗到幼体的贡献。这是幼苗生长概率，给定为 $0.3$。\n-   $a_{22}$：从幼体到幼体的贡献。这是幼体存留概率，给定为 $0.6$。\n-   $a_{23}$：从成体到幼体的贡献。不存在退化现象，因此成体不能变回幼体。此项为 $0$。\n-   $a_{31}$：从幼苗到成体的贡献。幼苗必须经过幼体阶段，因此它们不能在一个时间步内成长为成体。此项为 $0$。\n-   $a_{32}$：从幼体到成体的贡献。这是幼体生长概率，给定为 $0.2$。\n-   $a_{33}$：从成体到成体的贡献。这是成体存留（存活）概率，给定为 $0.8$。\n\n结合这些元素，Lefkovitch 矩阵 $\\mathbf{A}$ 为：\n$$\n\\mathbf{A} = \\begin{pmatrix} 0.4  0  4 \\\\ 0.3  0.6  0 \\\\ 0  0.2  0.8 \\end{pmatrix}\n$$\n\n第 2 部分：计算主特征值 $\\lambda$\n\n种群的长期渐近增长率由 $\\mathbf{A}$ 的主特征值给出。特征值 $\\lambda$ 是特征方程 $\\det(\\mathbf{A} - \\lambda\\mathbf{I}) = 0$ 的根，其中 $\\mathbf{I}$ 是单位矩阵。\n\n$$\n\\det\\left( \\begin{pmatrix} 0.4  0  4 \\\\ 0.3  0.6  0 \\\\ 0  0.2  0.8 \\end{pmatrix} - \\lambda \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} \\right) = 0\n$$\n$$\n\\det\\begin{pmatrix} 0.4-\\lambda  0  4 \\\\ 0.3  0.6-\\lambda  0 \\\\ 0  0.2  0.8-\\lambda \\end{pmatrix} = 0\n$$\n我们使用沿第一行的代数余子式展开来计算行列式：\n$$\n(0.4-\\lambda) \\begin{vmatrix} 0.6-\\lambda  0 \\\\ 0.2  0.8-\\lambda \\end{vmatrix} - 0 \\cdot \\begin{vmatrix} 0.3  0 \\\\ 0  0.8-\\lambda \\end{vmatrix} + 4 \\cdot \\begin{vmatrix} 0.3  0.6-\\lambda \\\\ 0  0.2 \\end{vmatrix} = 0\n$$\n$$\n(0.4-\\lambda)((0.6-\\lambda)(0.8-\\lambda) - 0) + 4((0.3)(0.2) - 0) = 0\n$$\n$$\n(0.4-\\lambda)(0.48 - 1.4\\lambda + \\lambda^2) + 0.24 = 0\n$$\n$$\n0.192 - 0.56\\lambda + 0.4\\lambda^2 - 0.48\\lambda + 1.4\\lambda^2 - \\lambda^3 + 0.24 = 0\n$$\n这简化为特征多项式：\n$$\n-\\lambda^3 + 1.8\\lambda^2 - 1.04\\lambda + 0.432 = 0\n$$\n或者，乘以 $-1$：\n$$\n\\lambda^3 - 1.8\\lambda^2 + 1.04\\lambda - 0.432 = 0\n$$\n矩阵 $\\mathbf{A}$ 是非负且本原的（因为 $\\mathbf{A}^2$ 的所有元素都严格为正），因此 Perron-Frobenius 定理保证存在一个唯一的、简单的、实数的、正的特征值 $\\lambda_1$，其绝对值严格大于所有其他特征值。这个 $\\lambda_1$ 就是渐近种群增长率。该三次方程必须通过数值方法求解。其实数根被发现为：\n$$\n\\lambda \\approx 1.2428\n$$\n另外两个根是一对共轭复数，其模小于 $\\lambda$。按要求四舍五入到四位有效数字，主特征值为 $1.243$。\n\n第 3 部分：稳定阶段分布与繁殖价值\n\n稳定阶段分布是对应于主特征值 $\\lambda$ 的右特征向量 $\\mathbf{w}$。它满足 $\\mathbf{A}\\mathbf{w} = \\lambda\\mathbf{w}$。$\\mathbf{w}$ 的分量代表每个阶段中个体的稳定比例。\n$$\n\\begin{pmatrix} 0.4  0  4 \\\\ 0.3  0.6  0 \\\\ 0  0.2  0.8 \\end{pmatrix} \\begin{pmatrix} w_L \\\\ w_J \\\\ w_A \\end{pmatrix} = \\lambda \\begin{pmatrix} w_L \\\\ w_J \\\\ w_A \\end{pmatrix}\n$$\n这产生一个线性方程组。我们可以求解各分量的比率。例如，从第三行，$0.2w_J + 0.8w_A = \\lambda w_A$，得出 $w_J = \\frac{\\lambda - 0.8}{0.2} w_A$。使用 $\\lambda \\approx 1.2428$，我们发现 $w_J \\approx 2.214 w_A$。从第二行，$0.3w_L + 0.6w_J = \\lambda w_J$，得出 $w_L = \\frac{\\lambda - 0.6}{0.3} w_J$。这给出 $w_L \\approx 2.143 w_J \\approx 4.745 w_A$。特征向量与 $\\begin{pmatrix} 4.745 \\\\ 2.214 \\\\ 1 \\end{pmatrix}$ 成比例。归一化使各分量之和为 $1$：\n$$\n\\mathbf{w} = \\frac{1}{4.745 + 2.214 + 1} \\begin{pmatrix} 4.745 \\\\ 2.214 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0.596 \\\\ 0.278 \\\\ 0.126 \\end{pmatrix}\n$$\n从生态学上讲，这个向量描述了种群在平衡状态下的结构：它将由大约 $59.6\\%$ 的幼苗、$27.8\\%$ 的幼体和 $12.6\\%$ 的成体组成。这是一个种群水平的涌现特性。\n\n繁殖价值向量是对应于 $\\lambda$ 的左特征向量 $\\mathbf{v}$。它满足 $\\mathbf{v}^T\\mathbf{A} = \\lambda\\mathbf{v}^T$。其分量衡量每个阶段的个体对未来种群增长的相对贡献。\n$$\n\\begin{pmatrix} v_L  v_J  v_A \\end{pmatrix} \\begin{pmatrix} 0.4  0  4 \\\\ 0.3  0.6  0 \\\\ 0  0.2  0.8 \\end{pmatrix} = \\lambda \\begin{pmatrix} v_L  v_J  v_A \\end{pmatrix}\n$$\n这给出另一个方程组。归一化使成体的繁殖价值为 $1$（$v_A = 1$），我们使用第二个方程：$0.6v_J + 0.2v_A = \\lambda v_J$，得出 $v_J = \\frac{0.2}{\\lambda - 0.6} v_A \\approx 0.311$。从第三个方程：$4v_L + 0.8v_A = \\lambda v_A$，得出 $v_L = \\frac{\\lambda - 0.8}{4} v_A \\approx 0.111$。\n繁殖价值向量为：\n$$\n\\mathbf{v} = \\begin{pmatrix} 0.111 \\\\ 0.311 \\\\ 1 \\end{pmatrix}\n$$\n从生态学上讲，就其各自对后代期望贡献而言，一个幼体的价值大约相当于一个成体的 $31.1\\%$，一个幼苗的价值大约相当于一个成体的 $11.1\\%$。这反映了它们存活并达到繁殖成体阶段的概率。这也是一个种群水平的概念，由所有阶段的生命史权衡所决定。\n\n最终所需的答案是主特征值 $\\lambda$ 的数值。\n$$\n\\lambda \\approx 1.243\n$$", "answer": "$$\\boxed{1.243}$$", "id": "2502393"}, {"introduction": "生态学分析中的一个核心挑战是尺度依赖性，即在一个组织层次上观察到的模式可能在另一个层次上消失甚至逆转。本练习通过一个关于物种-生境关联的案例，让你直面著名的辛普森悖论。你将通过计算分层和汇总的关联统计量来揭示这一悖论，并利用因果图（DAG）的逻辑来解决它，从而深刻理解在处理跨层级数据时，识别和控制混淆变量的重要性。[@problem_id:2502384]", "problem": "在一项于两个不同景观层内进行的群落水平实地研究中，调查了一个目标鸟类物种在两种生境类型中的存在情况。这两个景观层记为 $S \\in \\{A,B\\}$，它们在非生物条件和可达性方面有所不同，这也影响了抽样力度。在每个层内，两种生境类型为 $H \\in \\{\\text{Forest}, \\text{Meadow}\\}$。响应变量是物种的存在与否，$Y \\in \\{1,0\\}$，按样方记录。以下计数是每个层和生境内独立样方的总数：\n\n- 层 $S=A$：森林中有 $19$ 例存在和 $1$ 例不存在；草地中有 $900$ 例存在和 $100$ 例不存在。\n- 层 $S=B$：森林中有 $60$ 例存在和 $940$ 例不存在；草地中有 $1$ 例存在和 $19$ 例不存在。\n\n假设 $S$ 通过可达性和可利用性因果影响生境分配 $H$，并通过非生物条件因果影响物种存在 $Y$，并且 $H$ 可能因果影响 $Y$。你将评估在层内和跨层的种群水平上的物种-生境关联，然后使用因果有向无环图 (DAG) 来调和任何悖论。\n\n任务：\n\n1. 根据定义，比较 $\\text{Forest}$ 和 $\\text{Meadow}$ 的优势比是在 $\\text{Forest}$ 中 $Y=1$ 的优势与在 $\\text{Meadow}$ 中 $Y=1$ 的优势之比，计算 $S=A$ 和 $S=B$ 的特定于层的优势比。\n2. 汇总跨层数据，并计算比较 $\\text{Forest}$ 和 $\\text{Meadow}$ 的边际优势比。确定关联方向是否相对于两个特定于层的关联都发生了反转，从而证明辛普森悖论。\n3. 指明一个包含节点 $S$、$H$ 和 $Y$ 的因果有向无环图，该图与上述口头假设一致。根据因果识别的基本原则，陈述估计 $H$ 对 $Y$ 的因果效应所需的最小充分调整集。\n4. 假设在根据你的DAG进行适当调整后，各层之间存在一个共同的因果优势比，请使用一致的分层估计量，计算一个单一的、经层调整的比较 $\\text{Forest}$ 和 $\\text{Meadow}$ 的优势比。将你最终的调整后优势比四舍五入到四位有效数字，并将其报告为一个无单位的纯数字。\n\n只有任务4的结果应作为你的最终答案。", "solution": "该问题要求对一项生态学研究的计数数据进行系统性分析，以评估物种-生境关联，证明辛普森悖论，并使用因果推断的原则来解决它。分析分四个步骤进行。\n\n首先，我们定义我们的符号。设 $Y \\in \\{1, 0\\}$ 分别表示物种的存在和不存在。设 $H \\in \\{\\text{Forest}, \\text{Meadow}\\}$ 为生境类型。研究按景观层 $S \\in \\{A, B\\}$ 进行分层。对于每个层 $i \\in \\{A, B\\}$，数据可以用一个 $2 \\times 2$ 列联表表示：\n- $a_i$：在森林 ($H=\\text{Forest}$) 中存在 ($Y=1$) 的计数。\n- $b_i$：在森林 ($H=\\text{Forest}$) 中不存在 ($Y=0$) 的计数。\n- $c_i$：在草地 ($H=\\text{Meadow}$) 中存在 ($Y=1$) 的计数。\n- $d_i$：在草地 ($H=\\text{Meadow}$) 中不存在 ($Y=0$) 的计数。\n\n对于给定的生境，存在的优势定义为存在数与不存在数之比。比较森林和草地的优势比 ($OR$) 是它们各自优势的比率。\n$$ OR = \\frac{\\text{Odds}(Y=1|H=\\text{Forest})}{\\text{Odds}(Y=1|H=\\text{Meadow})} = \\frac{a/b}{c/d} = \\frac{ad}{bc} $$\n\n任务1：计算特定于层的优势比。\n对于层 $A$，数据为 $a_A = 19$，$b_A = 1$，$c_A = 900$ 和 $d_A = 100$。\n层 $A$ 的优势比是：\n$$ OR_A = \\frac{a_A d_A}{b_A c_A} = \\frac{19 \\times 100}{1 \\times 900} = \\frac{1900}{900} = \\frac{19}{9} $$\n由于 $OR_A \\approx 2.11  1$，在层 $A$ 中，森林生境与物种存在之间存在正相关。\n\n对于层 $B$，数据为 $a_B = 60$，$b_B = 940$，$c_B = 1$ 和 $d_B = 19$。\n层 $B$ 的优势比是：\n$$ OR_B = \\frac{a_B d_B}{b_B c_B} = \\frac{60 \\times 19}{940 \\times 1} = \\frac{1140}{940} = \\frac{114}{94} = \\frac{57}{47} $$\n由于 $OR_B \\approx 1.21  1$，在层 $B$ 中也存在正相关。\n\n任务2：计算边际优势比并证明辛普森悖论。\n为计算边际优势比，我们汇总两个层的数据。\n森林中的总计数：$a = a_A + a_B = 19 + 60 = 79$ 例存在；$b = b_A + b_B = 1 + 940 = 941$ 例不存在。\n草地中的总计数：$c = c_A + c_B = 900 + 1 = 901$ 例存在；$d = d_A + d_B = 100 + 19 = 119$ 例不存在。\n边际优势比 $OR_M$ 是根据这个汇总表计算的：\n$$ OR_M = \\frac{a d}{b c} = \\frac{79 \\times 119}{941 \\times 901} = \\frac{9401}{847841} $$\n在数值上，$OR_M \\approx 0.011$。这个值小于 $1$，表明当数据汇总时，森林生境与物种存在之间存在负相关。与特定于层的关联（$OR_A  1$ 和 $OR_B  1$）相比，关联方向发生了反转。这种反转就是辛普森悖论的定义。\n\n任务3：指明因果有向无环图 (DAG) 和调整集。\n问题陈述提供了以下因果关系：1. $S$ 因果影响 $H$ ($S \\to H$)。2. $S$ 因果影响 $Y$ ($S \\to Y$)。3. $H$ 可能因果影响 $Y$ ($H \\to Y$)。\n这些关系定义了一个DAG，其中 $S$ 是 $H$ 和 $Y$ 的一个共同原因：\n$$ H \\leftarrow S \\to Y $$\n路径 $H \\leftarrow S \\to Y$ 是从 $H$ 到 $Y$ 的一条非因果“后门”路径，它导致了一个伪相关。为了估计 $H$ 对 $Y$ 的因果效应（路径 $H \\to Y$），必须通过对混淆变量 $S$ 进行条件化来阻断这条后门路径。因此，最小充分调整集是 $\\{S\\}$。这证明了使用分层分析的合理性。\n\n任务4：计算经层调整的优势比。\n为了获得一个对 $S$ 的混淆效应进行调整后的 $H$ 对 $Y$ 效应的单一优势比估计值，我们使用Mantel-Haenszel估计量。该估计量计算特定于层的优势比的加权平均值。公式为：\n$$ OR_{MH} = \\frac{\\sum_{i=A,B} \\frac{a_i d_i}{n_i}}{\\sum_{i=A,B} \\frac{b_i c_i}{n_i}} $$\n其中 $n_i = a_i + b_i + c_i + d_i$ 是层 $i$ 的总样本量。\n\n首先，我们计算每个层的总样本量：\n$n_A = 19 + 1 + 900 + 100 = 1020$。\n$n_B = 60 + 940 + 1 + 19 = 1020$。\n\n现在，我们计算 $OR_{MH}$ 公式中的分子和分母：\n分子：\n$$ \\sum_{i} \\frac{a_i d_i}{n_i} = \\frac{19 \\times 100}{1020} + \\frac{60 \\times 19}{1020} = \\frac{1900}{1020} + \\frac{1140}{1020} = \\frac{3040}{1020} $$\n分母：\n$$ \\sum_{i} \\frac{b_i c_i}{n_i} = \\frac{1 \\times 900}{1020} + \\frac{940 \\times 1}{1020} = \\frac{900}{1020} + \\frac{940}{1020} = \\frac{1840}{1020} $$\nMantel-Haenszel优势比是这两个量的比值：\n$$ OR_{MH} = \\frac{3040/1020}{1840/1020} = \\frac{3040}{1840} = \\frac{304}{184} = \\frac{38}{23} $$\n调整后优势比的精确值为 $\\frac{38}{23}$。将其转换为小数约等于 $1.6521739$。按要求四舍五入到四位有效数字，得到 $1.652$。这个调整后的优势比大于 $1$，与特定于层的分析结果一致，并且代表了在控制了层 $S$ 的混淆效应后，森林生境对物种存在优势的因果效应的估计值。", "answer": "$$\\boxed{1.652}$$", "id": "2502384"}, {"introduction": "景观连通性是连接从个体到生态系统等多个组织层次的关键过程，但我们如何对其进行量化？本练习将引导你实现并对比两种主流的连通性建模方法：最小成本路径（LCP），它反映了“有目的”的个体行为；以及电路理论（ECT），它模拟了种群水平上随机扩散者的整体流动。通过这个计算实践，你将探索模型选择如何反映我们对生态范围（individual vs. population scope）的假设，并直接影响保护规划的结论。[@problem_id:2502429]", "problem": "给定一个离散景观，表示为非负移动成本的二维栅格，以及两个栖息地斑块，表示为不相交的栅格单元集。您的任务是，从基本原理出发，实现两种对应于不同生态组织和范围水平的连通性预测，然后在一小组测试景观上计算配对输出。\n\n生态学解释和组织水平：\n- 在个体水平上，一个使其累积移动成本最小化的生物体所遵循的路径，近似于将局部移动成本乘以步长后求和的最小值。这被操作化为最小成本路径（Least-Cost Path, LCP），即在加权网格图上的一条路径，其边权重由相邻单元之间的穿越成本给出。在指数型扩散核下，从源斑块到目标斑块的预测人均移动概率可以建模为 $P_{\\mathrm{LCP}} = \\exp(-\\alpha \\, C_{\\min})$，其中 $C_{\\min}$ 是最小成本路径的累积成本，$\\alpha > 0$ 是一个尺度参数。\n- 在种群水平（集合种群连通性）上，大量的个体通过景观中的许多可能路径进行扩散。电路理论（Electrical Circuit Theory, ECT）基于随机游走和电阻网络之间的等价性，为这种多路径流提供了一个有原则的表示方法。通过为每个图的边分配一个等于其穿越成本倒数的电导来构建一个电阻网络。将源斑块中所有单元的电势固定为 $1$，目标斑块中所有单元的电势固定为 $0$，并求解由欧姆定律（Ohm’s Law, OL）和基尔霍夫电流定律（Kirchhoff’s Current Law, KCL）所隐含的狄利克雷边界值问题。离开源斑块的总电流等于两个斑块之间的等效电导 $C_{\\mathrm{eq}}$。一个与更高级别流相一致的有界移动概率可以建模为 $P_{\\mathrm{ECT}} = 1 - \\exp(-\\beta \\, C_{\\mathrm{eq}})$，其中 $\\beta > 0$。\n\n您实现的基础：\n- 将栅格表示为一个加权无向图，其中每个有效单元是一个节点，边连接 $8$-邻域（水平、垂直和对角线）。水平和垂直步长为 $1$，对角线步长为 $\\sqrt{2}$。\n- 从成本为 $c_i$ 的单元 $i$ 移动到成本为 $c_j$ 的相邻单元 $j$，步长为 $\\ell_{ij}$ 的穿越成本是算术平均成本乘以步长，即 $(c_i + c_j)/2 \\cdot \\ell_{ij}$。如果 $c_i$ 或 $c_j$ 不是有限值，则省略该边。\n- 最小成本路径（LCP）：使用 Dijkstra 算法在上述图上计算从任何源单元到任何目标单元的最小累积成本 $C_{\\min}$，将所有源单元视为初始距离为 $0$ 的多源点。如果不存在路径，则按约定定义 $C_{\\min} = +\\infty$ 和 $P_{\\mathrm{LCP}} = 0$。\n- 电路理论（ECT）：为每条边分配一个电导 $g_{ij} = 1 / \\left( (c_i + c_j)/2 \\cdot \\ell_{ij} \\right)$。在源斑块单元上施加狄利克雷电势 $V=1$，在目标斑块单元上施加 $V=0$；所有其他有效单元都是未知的。令 $L$ 表示由电导组装的图拉普拉斯矩阵。求解在每个内部节点 $u$ 处由 KCL 隐含的内部节点电势的线性系统：$\\sum_{v} g_{uv} (V_u - V_v) = 0$，其中求和是对 $u$ 的邻居 $v$ 进行的，对于边界节点 $V_v$ 是已知的。等效电导 $C_{\\mathrm{eq}}$ 等于离开源边界的总电流，$C_{\\mathrm{eq}} = \\sum_{s \\in S} \\sum_{v \\sim s} g_{sv} (V_s - V_v)$，其中 $V_s=1$。如果源和目标组分之间没有路径连接，则按约定 $C_{\\mathrm{eq}} = 0$ 且 $P_{\\mathrm{ECT}} = 0$。\n\n图构建和数值细节：\n- 使用 $8$-邻域连通性，步长为 $1$（正交）和 $\\sqrt{2}$（对角线）。\n- 一个单元是有效的当且仅当其成本是有限的。与任何无效单元关联的边都被省略。\n- 对于 LCP，运行多源 Dijkstra 算法，一旦任何目标单元从优先队列中弹出，即终止以获得 $C_{\\min}$。\n- 对于 ECT，为有效单元组装稀疏拉普拉斯矩阵，对两个斑块施加狄利克雷约束，并求解内部电势的简化线性系统。然后计算 $C_{\\mathrm{eq}}$ 作为离开源斑块的总电流。\n\n要计算的预测移动概率：\n- 如果 $C_{\\min}$ 是有限的，则 $P_{\\mathrm{LCP}} = \\exp(-\\alpha \\, C_{\\min})$，否则为 $0$。\n- $P_{\\mathrm{ECT}} = 1 - \\exp(-\\beta \\, C_{\\mathrm{eq}})$。\n\n此问题不需要角度。不需要物理单位；所有成本都以抽象成本单位表示，距离以单元长度单位表示。\n\n测试集：\n实现您的程序，为以下每个测试用例计算 $[P_{\\mathrm{LCP}}, P_{\\mathrm{ECT}}]$。所有坐标均为零基 $(\\text{row}, \\text{col})$。\n\n- 案例 A（一般景观，单单元斑块，连通）：\n  - 成本为\n    $\n    \\begin{bmatrix}\n    1  1  2  2  3 \\\\\n    1  2  2  3  3 \\\\\n    2  2  3  4  4 \\\\\n    2  3  4  5  5 \\\\\n    3  4  5  5  6\n    \\end{bmatrix}\n    $\n    的 $5 \\times 5$ 栅格\n  - 源斑块 $S = \\{(0,0)\\}$，目标斑块 $T = \\{(4,4)\\}$。\n  - 参数：$\\alpha = 0.2$，$\\beta = 1$。\n- 案例 B（均匀景观上相邻斑块的边界条件）：\n  - 所有条目均为 $1$ 的 $3 \\times 3$ 栅格。\n  - 源斑块 $S = \\{(1,1)\\}$，目标斑块 $T = \\{(1,2)\\}$。\n  - 参数：$\\alpha = 1$，$\\beta = 1$。\n- 案例 C（被不可逾越的障碍完全断开）：\n  - $5 \\times 5$ 的栅格，所有条目均为 $1$，但中间一整行均为 $+\\infty$（不可逾越），即对于所有列 $j$，单元 $(2,j)$ 的成本为 $+\\infty$。\n  - 源斑块 $S = \\{(0,0), (0,4)\\}$，目标斑块 $T = \\{(4,0), (4,4)\\}$。\n  - 参数：$\\alpha = 1$，$\\beta = 1$。\n- 案例 D（两条平行廊道；多单元斑块）：\n  - $6 \\times 6$ 的栅格，初始化为 $10$，然后将第 $1$ 行和第 $4$ 行所有列的成本设置为 $1$，其他单元保持为 $10$。\n  - 源斑块 $S = \\{(1,0), (4,0)\\}$，目标斑块 $T = \\{(1,5), (4,5)\\}$。\n  - 参数：$\\alpha = 0.5$，$\\beta = 1$。\n\n程序行为要求：\n- 将上述测试集硬编码到您的程序中。\n- 对于每个案例，完全按照上述规定计算 $P_{\\mathrm{LCP}}$ 和 $P_{\\mathrm{ECT}}$。\n- 使用标准四舍五入将每个概率舍入到 $6$ 位小数。\n- 最终输出格式：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果本身应该是一个双元素列表。例如，输出必须是以下形式\n  $\n  \\left[ [p\\_1, q\\_1], [p\\_2, q\\_2], [p\\_3, q\\_3], [p\\_4, q\\_4] \\right]\n  $\n  其中 $p_k$ 和 $q_k$ 分别是案例 $k$（按 A、B、C、D 的顺序）的 $P_{\\mathrm{LCP}}$ 和 $P_{\\mathrm{ECT}}$ 的舍入值。", "solution": "该问题要求实现两种不同的生态连通性模型——最小成本路径（LCP）和电路理论（ECT）——并将它们应用于一系列测试景观。解决方案首先将景观栅格转换为一个加权无向图，然后为每个模型应用指定的算法。\n\n**1. 图的构建**\n景观栅格被转换为一个加权无向图 $G = (V, E)$，其中节点集 $V$ 对应于具有有限移动成本的栅格单元，边 $E$ 连接8邻域内的相邻节点。对于任何两个相邻的单元 $i$ 和 $j$，其成本分别为 $c_i$ 和 $c_j$，它们之间边的穿越成本 $w_{ij}$ 由公式 $w_{ij} = \\frac{c_i + c_j}{2} \\ell_{ij}$ 给出，其中 $\\ell_{ij}$ 是单元中心之间的距离（水平/垂直为1，对角线为$\\sqrt{2}$）。\n\n**2. 最小成本路径 (LCP) 模型**\n该模型代表个体水平的移动，旨在找到累积成本最低的路径。\n- **算法**: 采用Dijkstra算法的多源变体。源斑块中所有节点的初始距离设为0。算法迭代探索图，直到找到到达目标斑块中任一节点的最短路径。\n- **计算**: 找到的最小累积成本为 $C_{\\min}$。如果源和目标不连通，则 $C_{\\min} = \\infty$。移动概率计算为 $P_{\\mathrm{LCP}} = \\exp(-\\alpha \\, C_{\\min})$。\n\n**3. 电路理论 (ECT) 模型**\n该模型代表种群水平的连通性，考虑所有可能的扩散路径。\n- **算法**: 景观图被视为一个电阻网络。每条边的电导 $g_{ij}$ 是其穿越成本的倒数：$g_{ij} = 1/w_{ij}$。源斑块的所有节点电势设为1，目标斑块设为0。根据基尔霍夫电流定律，所有内部节点的净电流为零，这形成一个线性方程组 $A\\mathbf{x} = \\mathbf{b}$，其中 $\\mathbf{x}$ 是内部节点的未知电势。\n- **计算**: 求解该线性系统得到所有节点的电势。网络的等效电导 $C_{\\mathrm{eq}}$ 等于从源斑块流出的总电流。如果源和目标不连通，则 $C_{\\mathrm{eq}} = 0$。移动概率计算为 $P_{\\mathrm{ECT}} = 1 - \\exp(-\\beta \\, C_{\\mathrm{eq}})$。\n\n以下是实现这些计算的Python代码。\n\n```python\nimport numpy as np\nimport heapq\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\nimport math\n\ndef solve():\n    \"\"\"\n    协调所有测试案例的求解。\n    \"\"\"\n    # 案例 A: 一般景观, 单单元斑块, 连通\n    cost_a = np.array([\n        [1, 1, 2, 2, 3],\n        [1, 2, 2, 3, 3],\n        [2, 2, 3, 4, 4],\n        [2, 3, 4, 5, 5],\n        [3, 4, 5, 5, 6]\n    ], dtype=float)\n    source_a = {(0, 0)}\n    dest_a = {(4, 4)}\n    alpha_a, beta_a = 0.2, 1.0\n\n    # 案例 B: 均匀景观上相邻斑块的边界条件\n    cost_b = np.ones((3, 3), dtype=float)\n    source_b = {(1, 1)}\n    dest_b = {(1, 2)}\n    alpha_b, beta_b = 1.0, 1.0\n\n    # 案例 C: 被不可逾越的障碍完全断开\n    cost_c = np.ones((5, 5), dtype=float)\n    cost_c[2, :] = np.inf\n    source_c = {(0, 0), (0, 4)}\n    dest_c = {(4, 0), (4, 4)}\n    alpha_c, beta_c = 1.0, 1.0\n\n    # 案例 D: 两条平行廊道; 多单元斑块\n    cost_d = np.full((6, 6), 10.0)\n    cost_d[1, :] = 1.0\n    cost_d[4, :] = 1.0\n    source_d = {(1, 0), (4, 0)}\n    dest_d = {(1, 5), (4, 5)}\n    alpha_d, beta_d = 0.5, 1.0\n\n    test_cases = [\n        (cost_a, source_a, dest_a, alpha_a, beta_a),\n        (cost_b, source_b, dest_b, alpha_b, beta_b),\n        (cost_c, source_c, dest_c, alpha_c, beta_c),\n        (cost_d, source_d, dest_d, alpha_d, beta_d),\n    ]\n\n    results = []\n    for case in test_cases:\n        p_lcp, p_ect = compute_connectivity(*case)\n        results.append([round(p_lcp, 6), round(p_ect, 6)])\n    \n    # 格式化最终输出字符串\n    output_str = \"[\" + \", \".join([f\"[{p[0]}, {p[1]}]\" for p in results]) + \"]\"\n    return output_str\n\ndef compute_connectivity(cost_raster, source_patch, dest_patch, alpha, beta):\n    \"\"\"\n    为给定的景观配置计算 P_LCP 和 P_ECT。\n    \"\"\"\n    rows, cols = cost_raster.shape\n    \n    valid_cells = {(r, c) for r in range(rows) for c in range(cols) if np.isfinite(cost_raster[r, c])}\n    \n    coord_to_node_id = {coord: i for i, coord in enumerate(valid_cells)}\n    node_id_to_coord = {i: coord for coord, i in coord_to_node_id.items()}\n    num_nodes = len(valid_cells)\n    \n    adj = {i: [] for i in range(num_nodes)}\n    \n    for r_idx in range(rows):\n        for c_idx in range(cols):\n            if (r_idx, c_idx) not in valid_cells:\n                continue\n            \n            node1_id = coord_to_node_id[(r_idx, c_idx)]\n            c1 = cost_raster[r_idx, c_idx]\n            \n            for dr in [-1, 0, 1]:\n                for dc in [-1, 0, 1]:\n                    if dr == 0 and dc == 0:\n                        continue\n                        \n                    nr, nc = r_idx + dr, c_idx + dc\n                    \n                    if (nr, nc) in valid_cells:\n                        node2_id = coord_to_node_id[(nr, nc)]\n                        if node1_id > node2_id: continue\n                        \n                        c2 = cost_raster[nr, nc]\n                        step_len = math.sqrt(dr**2 + dc**2)\n                        \n                        edge_cost = (c1 + c2) / 2.0 * step_len\n                        if edge_cost > 0:\n                            conductance = 1.0 / edge_cost\n                            adj[node1_id].append((node2_id, edge_cost, conductance))\n                            adj[node2_id].append((node1_id, edge_cost, conductance))\n\n    source_nodes = {coord_to_node_id[c] for c in source_patch if c in coord_to_node_id}\n    dest_nodes = {coord_to_node_id[c] for c in dest_patch if c in coord_to_node_id}\n\n    distances = {i: np.inf for i in range(num_nodes)}\n    pq = []\n    for s_node in source_nodes:\n        distances[s_node] = 0.0\n        heapq.heappush(pq, (0.0, s_node))\n\n    c_min = np.inf\n    visited = set()\n\n    while pq:\n        dist, u = heapq.heappop(pq)\n        \n        if u in visited:\n            continue\n        visited.add(u)\n        \n        if u in dest_nodes:\n            c_min = dist\n            break\n\n        if dist > distances[u]:\n             continue\n\n        for v, edge_cost, _ in adj[u]:\n            if distances[u] + edge_cost  distances[v]:\n                distances[v] = distances[u] + edge_cost\n                heapq.heappush(pq, (distances[v], v))\n    \n    p_lcp = math.exp(-alpha * c_min) if np.isfinite(c_min) else 0.0\n\n    q = list(source_nodes)\n    reachable = set(source_nodes)\n    head = 0\n    connected = False\n    while head  len(q):\n        u = q[head]\n        head += 1\n        if u in dest_nodes:\n            connected = True\n            break\n        for v, _, _ in adj[u]:\n            if v not in reachable:\n                reachable.add(v)\n                q.append(v)\n    \n    if not connected:\n        c_eq = 0.0\n    else:\n        interior_nodes = sorted(list(set(range(num_nodes)) - source_nodes - dest_nodes))\n        num_interior = len(interior_nodes)\n        global_to_interior_id = {node_id: i for i, node_id in enumerate(interior_nodes)}\n        \n        A = lil_matrix((num_interior, num_interior), dtype=float)\n        b = np.zeros(num_interior, dtype=float)\n        \n        for i, u_id in enumerate(interior_nodes):\n            for v_id, _, g_uv in adj[u_id]:\n                A[i, i] += g_uv\n                if v_id in global_to_interior_id:\n                    j = global_to_interior_id[v_id]\n                    A[i, j] = -g_uv\n                elif v_id in source_nodes:\n                    b[i] += g_uv # V_s = 1\n        \n        A = A.tocsc()\n        try:\n            interior_potentials = spsolve(A, b)\n            V = np.zeros(num_nodes, dtype=float)\n            for s in source_nodes: V[s] = 1.0\n            for i, u_id in enumerate(interior_nodes): V[u_id] = interior_potentials[i]\n            \n            c_eq = 0.0\n            for s_node in source_nodes:\n                for v_node, _, g_sv in adj[s_node]:\n                    c_eq += g_sv * (1.0 - V[v_node])\n        except Exception: \n            c_eq = 0.0\n            \n    p_ect = 1.0 - math.exp(-beta * c_eq)\n    \n    return p_lcp, p_ect\n```", "answer": "[[0.088613, 0.505791], [0.367879, 0.527633], [0.0, 0.0], [0.082085, 0.720163]]", "id": "2502429"}]}