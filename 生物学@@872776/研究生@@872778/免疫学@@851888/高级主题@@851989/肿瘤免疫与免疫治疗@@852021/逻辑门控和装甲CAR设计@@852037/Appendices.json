{"hands_on_practices": [{"introduction": "构建逻辑门控CAR-T细胞的第一步是理解如何将生物学事件与逻辑运算（如“与”逻辑）联系起来。一个“与”门要求同时存在两种不同的输入信号（例如，两种不同的肿瘤抗原）才能触发细胞活化，这极大地提高了治疗的特异性。本练习旨在通过一个基础的概率模型来阐明这一核心原理：我们将推导当CAR-T细胞的活化依赖于两个独立的CAR模块与各自抗原结合时的总活化概率 [@problem_id:2864928]。这个模型是设计更复杂逻辑回路的基石。", "problem": "一个T细胞被设计成带有双模块嵌合抗原受体（CAR）系统，以实现“与”型逻辑门，并被进一步“武装”以在激活时分泌白细胞介素-12（IL-12）。第一个模块表示为CAR$\\zeta$，当它与抗原$A_{\\zeta}$结合时，通过CD3$\\zeta$链传递主激活信号。第二个模块表示为CAR28，当它与另一个不同的抗原$A_{28}$结合时，通过CD28传递共刺激信号。在与靶细胞形成的突触中，设游离的有效抗原浓度分别为$[A_{\\zeta}]$和$[A_{28}]$。每个模块与其同源抗原的结合是单价的，在充分混合的条件下发生，并达到平衡。平衡解离常数分别为CAR$\\zeta$:$A_{\\zeta}$的$K_{D\\zeta}$和CAR28:$A_{28}$的$K_{D28}$，它们按常规方式由质量作用定律定义。假设抗原相对于受体过量充足，因此游离抗原浓度$[A_{\\zeta}]$和$[A_{28}]$可以被视为固定值。\n\n定义细胞激活的条件是：两个模块在同一信号微域内同时接合。假设CAR$\\zeta$和CAR28的接合事件是独立的，并且信号以下述方式乘法整合：激活概率等于每个模块在平衡状态下贡献的边际接合概率的乘积。\n\n仅从平衡解离常数的定义和单价结合的标准质量作用平衡出发，推导激活概率$P_{\\mathrm{act}}$作为$[A_{\\zeta}]$、$[A_{28}]$、$K_{D\\zeta}$和$K_{D28}$的函数的解析表达式。将最终答案表示为单一的封闭形式表达式。不要进行数值近似；不需要四舍五入。将最终结果表述为无量纲的概率。", "solution": "问题陈述经评估有效。它具有科学依据，问题明确，客观，并包含了所有必要信息，可以根据生物化学动力学的基本原理推导出唯一解。任务是推导逻辑门控CAR-T细胞的激活概率，这需要应用质量作用定律来模拟平衡状态下的受体-配体结合。\n\n问题将激活概率$P_{\\mathrm{act}}$定义为两个独立CAR模块CAR$\\zeta$和CAR28的边际接合概率的乘积。表示为：\n$$P_{\\mathrm{act}} = P_{\\zeta} \\cdot P_{28}$$\n其中$P_{\\zeta}$是一个CAR$\\zeta$模块接合的概率，$P_{28}$是一个CAR28模块接合的概率。对于给定的受体类型，其接合概率等同于在平衡状态下该受体群体与其同源抗原结合的比例。\n\n首先，我们推导在平衡状态下单价结合反应中已结合受体比例的一般表达式。设$R$代表通用受体，$A$为其同源抗原，$RA$为受体-抗原复合物。结合反应为：\n$$R + A \\rightleftharpoons RA$$\n平衡解离常数$K_{D}$由质量作用定律定义为：\n$$K_D = \\frac{[R] [A]}{[RA]}$$\n其中$[R]$、$[A]$和$[RA]$分别是游离受体、游离抗原和复合物的平衡浓度。\n\n受体总浓度$[R]_{\\mathrm{total}}$是游离受体浓度和已结合受体浓度之和：\n$$[R]_{\\mathrm{total}} = [R] + [RA]$$\n接合概率是已结合受体占总受体的比例，我们将其表示为$\\theta$：\n$$\\theta = \\frac{[RA]}{[R]_{\\mathrm{total}}}$$\n为了用可测量量来表示$\\theta$，我们首先重排$K_D$表达式以求解游离受体浓度$[R]$：\n$$[R] = \\frac{K_D [RA]}{[A]}$$\n将此代入总受体浓度的方程中，得到：\n$$[R]_{\\mathrm{total}} = \\frac{K_D [RA]}{[A]} + [RA]$$\n提出$[RA]$因子：\n$$[R]_{\\mathrm{total}} = [RA] \\left( \\frac{K_D}{[A]} + 1 \\right) = [RA] \\left( \\frac{K_D + [A]}{[A]} \\right)$$\n现在我们可以求解已结合受体的比例$\\theta$：\n$$\\theta = \\frac{[RA]}{[R]_{\\mathrm{total}}} = \\frac{[RA]}{[RA] \\left( \\frac{K_D + [A]}{[A]} \\right)} = \\frac{[A]}{[A] + K_D}$$\n这就是Hill-Langmuir方程，它描述了被配体占据的受体位点比例作为配体浓度的函数。问题指明游离抗原浓度$[A_{\\zeta}]$和$[A_{28}]$可被视为固定值，这与在本推导中使用$[A]$是一致的。\n\n现在我们将这个通用结果应用于两个CAR模块。\n\n对于CAR$\\zeta$模块，受体是CAR$\\zeta$，抗原是$A_{\\zeta}$，解离常数是$K_{D\\zeta}$。因此，接合概率$P_{\\zeta}$为：\n$$P_{\\zeta} = \\frac{[A_{\\zeta}]}{[A_{\\zeta}] + K_{D\\zeta}}$$\n\n对于CAR28模块，受体是CAR28，抗原是$A_{28}$，解离常数是$K_{D28}$。接合概率$P_{28}$为：\n$$P_{28} = \\frac{[A_{28}]}{[A_{28}] + K_{D28}}$$\n\n最后，根据问题的“与”门模型，总激活概率$P_{\\mathrm{act}}$是这两个独立概率的乘积：\n$$P_{\\mathrm{act}} = P_{\\zeta} \\cdot P_{28} = \\left( \\frac{[A_{\\zeta}]}{[A_{\\zeta}] + K_{D\\zeta}} \\right) \\left( \\frac{[A_{28}]}{[A_{28}] + K_{D28}} \\right)$$\n这就是激活概率作为给定参数的函数的最终封闭形式解析表达式。该表达式是无量纲的，符合概率的要求。", "answer": "$$\n\\boxed{\\left( \\frac{[A_{\\zeta}]}{[A_{\\zeta}] + K_{D\\zeta}} \\right) \\left( \\frac{[A_{28}]}{[A_{28}] + K_{D28}} \\right)}\n$$", "id": "2864928"}, {"introduction": "在“与”门的基础上，我们可以引入抑制性信号来构建更精密的逻辑，例如“否决”门，以进一步避免对健康组织的误伤。本练习探讨了一个同时表达激活型CAR和抑制型CAR（iCAR）的T细胞的信号整合机制 [@problem_id:2864949]。通过建立一个动力学模型，我们将量化激活信号（ITAM磷酸化）和抑制信号（ITAM去磷酸化）之间的竞争平衡，从而计算出抑制性信号对最终细胞活化概率的精确影响。这个练习揭示了T细胞决策过程中的一个关键特征：活化是多种正负信号定量整合的结果。", "problem": "一个经过工程改造的T细胞同时表达一个激活型嵌合抗原受体 (CAR) 和一个抑制型CAR (iCAR)，与一个靶细胞形成一个单一的免疫突触。70 kDa Z链相关蛋白激酶 (ZAP-70) 的净触发取决于激活型CAR的CD3$\\zeta$模块上免疫受体酪氨酸激活基序 (ITAM) 位点的磷酸化状态。假设以下基本前提：\n- 在突触处，受体-配体结合遵循平衡质量作用定律，解离常数为 $K_{d}$，因此结合受体的分数等于配体浓度除以配体浓度与 $K_{d}$ 之和。\n- ITAM的磷酸化和去磷酸化遵循线性质量作用动力学，其速率分别与结合的激活型CAR和结合的iCAR的数量成正比，此外还有一个即使在没有iCAR结合时也存在的基础去磷酸化项。\n- ITAM被磷酸化的稳态概率等于稳态磷酸化分数，这被视为突触处的ZAP-70净激活概率。\n\n突触斑包含 $N_{A}^{\\text{tot}} = 120$ 条激活型CAR链和 $N_{I}^{\\text{tot}} = 60$ 条iCAR链。靶细胞展示的激活型CAR抗原的有效突触浓度为 $L_{A} = 20$ nM，其 $K_{d,A} = 10$ nM；iCAR的抗原有效突触浓度为 $L_{I} = 15$ nM，其 $K_{d,I} = 5$ nM。每个结合的激活型CAR贡献一个磷酸化速率常数 $k_{p} = 0.15$ s$^{-1}$（每个ITAM）。每个结合的iCAR招募磷酸酶活性，贡献一个去磷酸化速率常数 $k_{d} = 0.40$ s$^{-1}$（每个ITAM）。一个基础去磷酸化速率 $k_{0} = 0.03$ s$^{-1}$ 的作用独立于iCAR的结合。\n\n仅使用这些假设和参数，从第一性原理推导并计算由于iCAR的共同结合导致的稳态ZAP-70激活概率的倍数变化，定义为比率\n$R = \\dfrac{\\text{激活型CAR和iCAR共结合时的ZAP-70激活}}{\\text{仅激活型CAR结合时的ZAP-70激活}}$。\n将您的最终答案表示为四舍五入到四位有效数字的小数。最终答案不需要单位。", "solution": "在尝试求解之前，需要对问题的前提进行验证。\n\n首先，我将逐字提取给定的信息。\n- 总激活型CAR链数：$N_{A}^{\\text{tot}} = 120$\n- 总抑制型CAR链数：$N_{I}^{\\text{tot}} = 60$\n- 激活型配体浓度：$L_{A} = 20$ nM\n- 激活型CAR解离常数：$K_{d,A} = 10$ nM\n- 抑制型配体浓度：$L_{I} = 15$ nM\n- 抑制型CAR解离常数：$K_{d,I} = 5$ nM\n- 每个结合的激活型CAR的磷酸化速率常数：$k_{p} = 0.15$ s$^{-1}$\n- 每个结合的iCAR的去磷酸化速率常数：$k_{d} = 0.40$ s$^{-1}$\n- 基础去磷酸化速率常数：$k_{0} = 0.03$ s$^{-1}$\n- 结合受体的分数由公式 $\\frac{L}{L + K_{d}}$ 给出。\n- ITAM的磷酸化和去磷酸化由线性质量作用动力学建模。\n- ZAP-$70$激活概率等同于稳态磷酸化ITAM的分数。\n- 目标量是比率 $R = \\dfrac{\\text{激活型CAR和iCAR共结合时的ZAP-}70\\text{激活}}{\\text{仅激活型CAR结合时的ZAP-}70\\text{激活}}$。\n\n现在，我将验证该问题。该问题是生物化学动力学和系统生物学中的一个标准练习。它使用了诸如质量作用动力学和受体-配体结合平衡等已建立的概念。该模型是一个复杂生物过程的简化，但其内部一致、有科学依据且适定。提供了解出唯一解所需的所有参数，且不存在矛盾。语言客观而精确。因此，该问题被认为是有效的。\n\n我现在开始解题。\n\n问题要求计算ITAM磷酸化的稳态概率，我们记为 $p$。这个概率表示在稳态下，激活型CAR上总ITAM中处于磷酸化状态的分数。设 $I_{p}$ 和 $I_{u}$ 分别表示磷酸化和未磷酸化的ITAM数量。磷酸化ITAM分数 $p = \\frac{I_p}{I_p + I_u}$ 的演化由以下微分方程描述：\n$$ \\frac{dp}{dt} = k_{f} (1 - p) - k_{r} p $$\n其中 $k_{f}$ 是总磷酸化速率常数，$k_{r}$ 是总去磷酸化速率常数。这个方程源于线性质量作用动力学，其中磷酸化速率与未磷酸化位点的分数 $(1-p)$ 成正比，去磷酸化速率与磷酸化位点的分数 $p$ 成正比。\n\n在稳态下，$\\frac{dp}{dt} = 0$。这得到：\n$$ k_{f} (1 - p_{ss}) = k_{r} p_{ss} $$\n求解稳态分数 $p_{ss}$：\n$$ k_{f} = k_{f} p_{ss} + k_{r} p_{ss} = (k_{f} + k_{r}) p_{ss} $$\n$$ p_{ss} = \\frac{k_{f}}{k_{f} + k_{r}} $$\n\n问题陈述总磷酸化速率与结合的激活型CAR数量 $N_{A}$ 成正比。每个结合的CAR贡献一个速率常数 $k_p$。因此，总磷酸化速率常数为：\n$$ k_{f} = k_{p} N_{A} $$\n总去磷酸化速率包括一个基础组分 $k_{0}$ 和一个与结合的iCAR数量 $N_{I}$ 成正比的组分。每个结合的iCAR贡献一个速率常数 $k_d$。因此，总去磷酸化速率常数为：\n$$ k_{r} = k_{0} + k_{d} N_{I} $$\n\n结合的受体数量由配体浓度 $L$ 和解离常数 $K_d$ 决定。结合受体的分数为 $f = \\frac{L}{L + K_d}$。\n结合的激活型CAR数量 $N_{A}$ 为：\n$$ N_{A} = N_{A}^{\\text{tot}} \\cdot \\frac{L_{A}}{L_{A} + K_{d,A}} $$\n结合的抑制型CAR数量 $N_{I}$ 为：\n$$ N_{I} = N_{I}^{\\text{tot}} \\cdot \\frac{L_{I}}{L_{I} + K_{d,I}} $$\n\n我们现在代入给定的数值：\n$$ N_{A} = 120 \\cdot \\frac{20}{20 + 10} = 120 \\cdot \\frac{20}{30} = 120 \\cdot \\frac{2}{3} = 80 $$\n$$ N_{I} = 60 \\cdot \\frac{15}{15 + 5} = 60 \\cdot \\frac{15}{20} = 60 \\cdot \\frac{3}{4} = 45 $$\n\n有了这些值，我们可以计算有效速率常数：\n磷酸化项为 $k_{p} N_{A} = 0.15 \\, \\text{s}^{-1} \\cdot 80 = 12 \\, \\text{s}^{-1}$。\niCAR依赖的去磷酸化项为 $k_{d} N_{I} = 0.40 \\, \\text{s}^{-1} \\cdot 45 = 18 \\, \\text{s}^{-1}$。\n基础去磷酸化速率常数为 $k_{0} = 0.03 \\, \\text{s}^{-1}$。\n\n我们必须计算两种情况下的ZAP-$70$激活概率。\n\n情况1：激活型CAR和iCAR共同结合。\n在这种情况下，$N_A$ 和 $N_I$ 均非零。激活概率 $p_{\\text{with-iCAR}}$ 为：\n$$ p_{\\text{with-iCAR}} = \\frac{k_{f}}{k_{f} + k_{r}} = \\frac{k_{p} N_{A}}{k_{p} N_{A} + k_{0} + k_{d} N_{I}} $$\n代入计算出的值：\n$$ p_{\\text{with-iCAR}} = \\frac{12}{12 + 0.03 + 18} = \\frac{12}{30.03} $$\n\n情况2：仅激活型CAR结合。\n这意味着没有来自iCARs的信号，因此我们将其贡献设为零。这对应于 $N_I=0$。激活概率 $p_{\\text{no-iCAR}}$ 为：\n$$ p_{\\text{no-iCAR}} = \\frac{k_{p} N_{A}}{k_{p} N_{A} + k_{0}} $$\n代入计算出的值：\n$$ p_{\\text{no-iCAR}} = \\frac{12}{12 + 0.03} = \\frac{12}{12.03} $$\n\n问题要求计算倍数变化 $R$，即这两个概率的比率：\n$$ R = \\frac{p_{\\text{with-iCAR}}}{p_{\\text{no-iCAR}}} = \\frac{\\frac{k_{p} N_{A}}{k_{p} N_{A} + k_{0} + k_{d} N_{I}}}{\\frac{k_{p} N_{A}}{k_{p} N_{A} + k_{0}}} $$\n对该表达式进行代数简化：\n$$ R = \\frac{k_{p} N_{A} + k_{0}}{k_{p} N_{A} + k_{0} + k_{d} N_{I}} $$\n现在，我们代入各项的值：\n$$ R = \\frac{12 + 0.03}{12 + 0.03 + 18} = \\frac{12.03}{30.03} $$\n计算最终数值：\n$$ R \\approx 0.40059940059... $$\n问题要求答案四舍五入到四位有效数字。\n$$ R \\approx 0.4006 $$\n这个结果小于1，正确地反映了共同结合的iCAR系统的抑制功能。", "answer": "$$\\boxed{0.4006}$$", "id": "2864949"}, {"introduction": "即便设计精良，逻辑门控CAR-T疗法在临床上仍面临肿瘤逃逸的挑战，其中最常见的机制是抗原丢失。为了理解并预测这一过程，我们需要将视角从单个细胞的信号处理扩展到整个肿瘤细胞群体的动态演化。本练习将引导你建立一个随机模型，来模拟CAR-T细胞杀伤与肿瘤细胞丢失抗原这两个相互竞争的过程 [@problem_id:2864958]。通过这个模型，我们可以定量评估治疗失败的风险，并分析不同抗原丢失速率对肿瘤逃逸路径的影响，从而为优化治疗策略提供理论依据。", "problem": "您的任务是，在逻辑门控嵌合抗原受体（CAR）T细胞设计的背景下，形式化并分析一个肿瘤逃逸的随机模型。在一种“与”门（AND-gated）CAR设计中，一个肿瘤细胞当且仅当它共表达两种独立的抗原，记为$A$和$B$时，才对CAR介导的杀伤敏感。丢失$A$或$B$抗原的肿瘤细胞会对“与”门CAR的杀伤产生抗性。目标是量化非对称性抗原丢失（即丢失$A$与丢失$B$的差异）如何影响肿瘤逃逸，并计算在一个随机丢失模型下，逃逸的预期时间。\n\n基本和模型假设：\n- 最初的$N$个肿瘤细胞均为双阳性，并独立地经历三个相互竞争的无记忆过程：CAR介导的杀伤、抗原$A$的丢失和抗原$B$的丢失。每个过程的首次事件发生时间服从指数分布，其恒定风险率分别为$k$（每天）、$\\lambda_A$（每天）和$\\lambda_B$（每天）。\n- 对每个细胞，定义$r = k + \\lambda_A + \\lambda_B$。根据指数分布的无记忆性，该细胞首次事件的发生时间服从速率为$r$的指数分布，且首次事件的类型是根据与$k$、$\\lambda_A$和$\\lambda_B$成比例的概率选择的。\n- 被杀伤的细胞被移除。丢失$A$（或$B$）的细胞变为抗性细胞，并被标记为$A$丢失逃逸者（或$B$丢失逃逸者）。\n- 将肿瘤逃逸定义为以下事件：在所有$N$个细胞被杀伤之前，至少出现一个抗性细胞（$A$丢失或$B$丢失），以及双阳性细胞群体完全耗尽的时间（即$N$个细胞各自首次事件发生时间的最大值）。逃逸的预期时间定义为，在逃逸事件发生的条件下，双阳性细胞完全耗尽的预期时间。如果在给定参数下逃逸概率为零，则按惯例将逃逸的预期时间定义为$0$。\n- 所有速率的单位均为每天，所有预期时间必须以天为单位报告。\n\n每个测试用例所需的输出：\n1. 逃逸概率，以$[0,1]$区间内的小数表示。\n2. 在发生逃逸的条件下，逃逸的预期时间（以天为单位），以小数表示。\n3. 逃逸完全由抗原$A$丢失引起的概率，即至少有一个$A$丢失逃逸者且没有$B$丢失逃逸者，以$[0,1]$区间内的小数表示。\n4. 逃逸完全由抗原$B$丢失引起的概率，即至少有一个$B$丢失逃逸者且没有$A$丢失逃逸者，以$[0,1]$区间内的小数表示。\n5. 逃逸发生时，在$N$个最终结果中同时存在$A$丢失和$B$丢失逃逸者的概率，以$[0,1]$区间内的小数表示。\n\n您的程序必须根据第一性原理实现上述模型，使用以下经过充分检验的事实，不得引入任何额外的建模假设：\n- 对于速率为$k$、$\\lambda_A$和$\\lambda_B$的独立指数时钟，最短时间服从速率为$r = k + \\lambda_A + \\lambda_B$的指数分布，且任何一个给定时钟成为最短时间的概率等于其速率除以$r$。\n- 对于$N$个速率为$r$的独立同分布指数随机变量，其最大值的期望等于第$N$个调和数除以$r$，即$\\mathbb{E}[\\max\\{T_1,\\dots,T_N\\}] = H_N / r$，其中$H_N = \\sum_{i=1}^{N} 1/i$。\n- 对于$N$个独立的细胞，每个细胞的结果（被杀伤、$A$丢失、$B$丢失）是互斥的，发生概率分别为$p_K = k/r$、$p_A = \\lambda_A/r$和$p_B = \\lambda_B/r$，则$N$个细胞的各类结果计数的联合分布服从参数为$(N; p_K, p_A, p_B)$的多项分布。\n\n测试套件：\n对于每组参数，将$k$、$\\lambda_A$、$\\lambda_B$解释为每日速率，将$N$解释为整数细胞计数。为以下六个测试用例计算上述所有五个输出：\n\n1. $(N, k, \\lambda_A, \\lambda_B) = (100, 0.5, 0.05, 0.05)$\n2. $(N, k, \\lambda_A, \\lambda_B) = (100, 0.5, 0.2, 0.01)$\n3. $(N, k, \\lambda_A, \\lambda_B) = (100, 0.5, 0.01, 0.2)$\n4. $(N, k, \\lambda_A, \\lambda_B) = (50, 0.5, 0.0, 0.0)$\n5. $(N, k, \\lambda_A, \\lambda_B) = (20, 0.0, 0.05, 0.08)$\n6. $(N, k, \\lambda_A, \\lambda_B) = (1, 0.3, 0.2, 0.05)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个以逗号分隔的子列表列表，顺序与测试用例相同。每个子列表必须为$[x_1,x_2,x_3,x_4,x_5]$的形式，其中$x_1$是逃逸概率，$x_2$是逃逸的预期时间（以天为单位，以逃逸为条件），$x_3$是仅$A$丢失的逃逸概率，$x_4$是仅$B$丢失的逃逸概率，$x_5$是同时存在$A$和$B$丢失的逃逸概率。每个子列表中的所有五个值都必须四舍五入到六位小数。例如，一个包含两个假设案例的输出行将如下所示：\n[[x11,x12,x13,x14,x15],[x21,x22,x23,x24,x25]]\n\n所有代表概率的输出必须是$[0,1]$区间内的小数，所有时间单位必须是天。不允许使用百分号。此问题不涉及角度。", "solution": "所述问题是在概率论应用于肿瘤在治疗下演化的随机模型方面一个定义明确的练习。它具有科学依据，没有矛盾，并包含了唯一解所需的所有信息。我们将从第一性原理出发进行形式化推导。\n\n该模型考虑了$N$个独立且相同的肿瘤细胞。对于每个细胞，可能发生三个互斥事件：被杀伤、丢失抗原$A$或丢失抗原$B$。这些事件的发生时间被建模为独立的指数随机变量，其恒定速率分别为$k$、$\\lambda_A$和$\\lambda_B$。\n\n对于任何给定细胞，首次事件的发生时间$T$是三个指数分布时间的最小值。因此，它本身也服从指数分布，总速率为$r = k + \\lambda_A + \\lambda_B$。\n首次事件的类型由哪个过程“赢得竞争”决定。每种结果的概率与其速率成正比：\n-   被杀伤的概率，$p_K = \\frac{k}{k + \\lambda_A + \\lambda_B} = \\frac{k}{r}$。\n-   成为$A$丢失逃逸者的概率，$p_A = \\frac{\\lambda_A}{k + \\lambda_A + \\lambda_B} = \\frac{\\lambda_A}{r}$。\n-   成为$B$丢失逃逸者的概率，$p_B = \\frac{\\lambda_B}{k + \\lambda_A + \\lambda_B} = \\frac{\\lambda_B}{r}$。\n显然，$p_K + p_A + p_B = 1$。\n\n$N$个细胞的最终结果是独立的试验。设$N_K$、$N_A$和$N_B$为随机变量，分别代表被杀伤、丢失抗原$A$和丢失抗原$B$的细胞数量。这些计数$(N_K, N_A, N_B)$的联合分布服从参数为$(N; p_K, p_A, p_B)$的多项分布。\n\n我们现在推导所需的五个量。\n\n1.  **逃逸概率，$P(\\text{Escape})$**\n    当至少有一个细胞变得具有抗性时，肿瘤逃逸发生，这意味着并非所有$N$个细胞都被杀伤。其互补事件是“无逃逸”，即所有$N$个细胞都被杀伤。这对应于结果$N_K = N$、$N_A = 0$和$N_B = 0$。\n    无逃逸的概率是$N$个独立的“杀伤”事件的概率：\n    $$P(\\text{No Escape}) = P(N_K=N) = p_K^N = \\left(\\frac{k}{r}\\right)^N$$\n    因此，逃逸的概率为：\n    $$P(\\text{Escape}) = 1 - P(\\text{No Escape}) = 1 - \\left(\\frac{k}{r}\\right)^N$$\n\n2.  **逃逸的预期时间，以逃逸为条件**\n    初始双阳性细胞群体的耗尽时间是$N$个个体首次事件发生时间的最大值，$T_{\\text{depletion}} = \\max\\{T_1, \\dots, T_N\\}$。每个$T_i$都是一个速率为$r$的独立同分布指数随机变量。问题正确地指出，这个最大值的期望为$\\mathbb{E}[T_{\\text{depletion}}] = H_N / r$，其中$H_N = \\sum_{i=1}^{N} \\frac{1}{i}$是第$N$个调和数。\n    指数竞争模型的一个关键特性是，首次事件的时间（最小值）与获胜者的身份是独立的。因此，对于每个细胞$i$，其时间$T_i$与其结果（被杀伤、$A$丢失或$B$丢失）是独立的。这种独立性扩展到整个群体：耗尽时间$T_{\\text{depletion}}$与集体结果（包括逃逸事件）是独立的。\n    因此，只要逃逸是可能的，以逃逸为条件并不改变耗尽时间的期望值。\n    $$\\mathbb{E}[T_{\\text{depletion}} | \\text{Escape}] = \\mathbb{E}[T_{\\text{depletion}}] = \\frac{H_N}{r}$$\n    根据问题的定义，如果逃逸概率为零（当且仅当$\\lambda_A = 0$且$\\lambda_B = 0$时发生），则预期时间定义为$0$。\n\n3.  **仅$A$丢失的逃逸概率，$P(A\\text{-only})$**\n    该事件定义为至少有一个$A$丢失逃逸者且没有$B$丢失逃逸者。用计数表示，即事件$\\{N_A \\ge 1 \\text{ and } N_B = 0\\}$。\n    我们可以使用全概率律来计算：$P(N_A \\ge 1 \\text{ and } N_B = 0) = P(N_B = 0) - P(N_A = 0 \\text{ and } N_B = 0)$。\n    事件$\\{N_B=0\\}$意味着所有$N$个细胞的结果必须是被杀伤或丢失抗原$A$。单个细胞出现这种结果的概率是$p_K+p_A$。对于$N$个独立细胞，其概率为：\n    $$P(N_B = 0) = (p_K + p_A)^N = \\left(\\frac{k+\\lambda_A}{r}\\right)^N$$\n    事件$\\{N_A = 0 \\text{ and } N_B = 0\\}$正是“无逃逸”事件，即所有细胞都被杀伤。其概率为$p_K^N$。\n    因此，仅$A$丢失的逃逸概率为：\n    $$P(A\\text{-only}) = (p_K + p_A)^N - p_K^N = \\left(\\frac{k+\\lambda_A}{r}\\right)^N - \\left(\\frac{k}{r}\\right)^N$$\n\n4.  **仅$B$丢失的逃逸概率，$P(B\\text{-only})$**\n    根据对称性，存在至少一个$B$丢失逃逸者且没有$A$丢失逃逸者（$\\{N_B \\ge 1 \\text{ and } N_A = 0\\}$）的概率为：\n    $$P(B\\text{-only}) = (p_K + p_B)^N - p_K^N = \\left(\\frac{k+\\lambda_B}{r}\\right)^N - \\left(\\frac{k}{r}\\right)^N$$\n\n5.  **混合逃逸（同时丢失$A$和$B$）的概率，$P(A,B\\text{-both})$**\n    这是指至少存在一个$A$丢失逃逸者和至少一个$B$丢失逃逸者的事件，即$\\{N_A \\ge 1 \\text{ and } N_B \\ge 1\\}$。\n    总逃逸事件是三个不相交事件的并集：仅$A$丢失的逃逸、仅$B$丢失的逃逸和混合逃逸。因此：\n    $$P(\\text{Escape}) = P(A\\text{-only}) + P(B\\text{-only}) + P(A,B\\text{-both})$$\n    整理可得：\n    $$P(A,B\\text{-both}) = P(\\text{Escape}) - P(A\\text{-only}) - P(B\\text{-only})$$\n    代入先前推导的表达式：\n    $$P(A,B\\text{-both}) = \\left(1 - p_K^N\\right) - \\left((p_K + p_A)^N - p_K^N\\right) - \\left((p_K + p_B)^N - p_K^N\\right)$$\n    $$P(A,B\\text{-both}) = 1 - (p_K + p_A)^N - (p_K + p_B)^N + p_K^N$$\n    $$P(A,B\\text{-both}) = 1 - \\left(\\frac{k+\\lambda_A}{r}\\right)^N - \\left(\\frac{k+\\lambda_B}{r}\\right)^N + \\left(\\frac{k}{r}\\right)^N$$\n    至此，所有要求量的推导完成。实现将通过将这些公式应用于给定的测试用例来进行。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the stochastic tumor escape problem for a suite of test cases.\n    \"\"\"\n\n    def calculate_results_for_case(N, k, lambda_A, lambda_B):\n        \"\"\"\n        Calculates the five required outputs based on the derived formulas.\n\n        Args:\n            N (int): Initial number of tumor cells.\n            k (float): Hazard rate for CAR-mediated killing.\n            lambda_A (float): Hazard rate for antigen A loss.\n            lambda_B (float): Hazard rate for antigen B loss.\n\n        Returns:\n            list: A list containing the five calculated metrics, rounded to 6 decimal places.\n        \"\"\"\n        # Calculate the total rate r.\n        # Based on problem constraints (rates >= 0), r can only be 0 if all rates are 0.\n        # Test cases do not include r=0, so no division by zero will occur.\n        r = k + lambda_A + lambda_B\n\n        # Handle the trivial case where no escape is possible.\n        if lambda_A == 0 and lambda_B == 0:\n            return [0.0, 0.0, 0.0, 0.0, 0.0]\n\n        # Calculate single-cell outcome probabilities.\n        p_K = k / r\n        p_A = lambda_A / r\n        p_B = lambda_B / r\n\n        # To avoid repeated calculations, compute necessary powers.\n        # Use float(N) for compatibility with numpy's power function.\n        Nf = float(N)\n        p_K_pow_N = np.power(p_K, Nf)\n        p_KA_pow_N = np.power(p_K + p_A, Nf)\n        p_KB_pow_N = np.power(p_K + p_B, Nf)\n\n        # 1. Escape probability, P(Escape)\n        # P(Escape) = 1 - P(No Escape) = 1 - p_K^N\n        prob_escape = 1.0 - p_K_pow_N\n\n        # 2. Expected time to escape, conditioned on escape\n        # E[T_escape | Escape] = E[T_depletion] = H_N / r\n        # H_N is calculated only if needed.\n        if N == 0:\n            H_N = 0.0\n        else:\n            H_N = np.sum(1.0 / np.arange(1, N + 1))\n        expected_time_escape = H_N / r\n        \n        # 3. Probability of A-only escape, P(A-only)\n        # P(A-only) = P(N_B=0) - P(N_A=0, N_B=0) = (p_K + p_A)^N - p_K^N\n        prob_A_only = p_KA_pow_N - p_K_pow_N\n\n        # 4. Probability of B-only escape, P(B-only)\n        # P(B-only) = P(N_A=0) - P(N_A=0, N_B=0) = (p_K + p_B)^N - p_K^N\n        prob_B_only = p_KB_pow_N - p_K_pow_N\n\n        # 5. Probability of mixed escape (both A and B loss), P(A,B-both)\n        # P(A,B-both) = P(Escape) - P(A-only) - P(B-only)\n        # This simplifies to 1 - (p_K+p_A)^N - (p_K+p_B)^N + p_K^N\n        prob_mixed = prob_escape - prob_A_only - prob_B_only\n\n        return [\n            round(prob_escape, 6),\n            round(expected_time_escape, 6),\n            round(prob_A_only, 6),\n            round(prob_B_only, 6),\n            round(prob_mixed, 6)\n        ]\n\n    # Test suite from the problem statement.\n    test_cases = [\n        (100, 0.5, 0.05, 0.05),\n        (100, 0.5, 0.2, 0.01),\n        (100, 0.5, 0.01, 0.2),\n        (50, 0.5, 0.0, 0.0),\n        (20, 0.0, 0.05, 0.08),\n        (1, 0.3, 0.2, 0.05)\n    ]\n\n    results = []\n    for case in test_cases:\n        N, k, lambda_A, lambda_B = case\n        result = calculate_results_for_case(N, k, lambda_A, lambda_B)\n        results.append(result)\n\n    # Format the final output string exactly as specified.\n    # e.g., [[val1, val2, ...], [val1, val2, ...]]\n    # map(str, results) converts each sublist to its string representation.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```", "id": "2864958"}]}