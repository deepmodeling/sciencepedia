{"hands_on_practices": [{"introduction": "时间免疫学研究的第一步是可靠地识别和量化生物数据中的节律。本练习将提供余弦分析（cosinor analysis）的动手实践，这是一种将节律模式拟合到时间序列数据的基石方法。通过实施该分析，你将学习如何估计关键的节律参数，如峰时（acrophase，即峰值时间），并对显著的昼夜节律振荡的存在进行统计检验，这是该领域任何研究人员都应具备的基本技能。", "problem": "给定单个$24$小时内通过流式细胞术测量的时间戳循环T细胞计数。假设循环T细胞的昼夜节律变化（如果存在）可以建模为具有固定$24$小时周期的单分量余弦振荡，并叠加在恒定均值（中值）上。您的任务是实现一个程序，对每个提供的数据集，在余弦模型（cosinor model）下估计峰值时间（acrophase，即$[0,24)$小时内的高峰时间），并通过将余弦模型与常数模型（无节律模型）进行比较，来执行显著节律性的正式统计检验。\n\n基本和建模假设：\n- 生物学假设是，某些免疫变量表现出近似$24$小时周期的昼夜节律，这是哺乳动物生理学中经过充分检验和广泛观察的现象。\n- 采用固定周期 $T = 24$ 小时的余弦回归模型。使用角频率 $\\omega = 2\\pi/T$，单位为弧度/小时。\n- 余弦模型为\n$$\ny_i = M + A \\cos(\\omega t_i) + B \\sin(\\omega t_i) + \\varepsilon_i,\n$$\n其中 $y_i$ 是在时间 $t_i$（以小时为单位）测量的T细胞计数，$M$ 是中值（mesor，平均水平），$A$ 和 $B$ 是回归系数，$\\varepsilon_i$ 是独立的、均值为零的噪声项。\n- 零模型（无节律性）为\n$$\ny_i = M_0 + \\varepsilon_i.\n$$\n- 通过普通最小二乘法（OLS）估计参数。\n- 将振幅定义为 $C = \\sqrt{A^2 + B^2}$，并通过恒等式 $M + A\\cos(\\omega t) + B\\sin(\\omega t) \\equiv M + C \\cos(\\omega t + \\phi)$ 定义相位参数 $\\phi$，这得出 $\\phi = \\operatorname{atan2}(-B, A)$（以弧度为单位）。峰值时间（acrophase）是\n$$\nt_{\\text{peak}} = \\frac{(-\\phi) \\bmod 2\\pi}{\\omega},\n$$\n以小时表示，在 $[0,24)$ 范围内。\n\n显著性检验：\n- 使用方差分析（ANOVA; Analysis of Variance）$F$-检验来比较完整余弦模型和零模型。设 $\\text{RSS}_{\\text{full}}$ 为余弦模型的残差平方和，$\\text{RSS}_{\\text{null}}$ 为零模型的残差平方和。对于 $N$ 个观测值，完整模型使用 $p_{\\text{full}} = 3$ 个参数，零模型使用 $p_{\\text{null}} = 1$ 个参数。检验统计量为\n$$\nF = \\frac{\\left(\\text{RSS}_{\\text{null}} - \\text{RSS}_{\\text{full}}\\right)/(p_{\\text{full}} - p_{\\text{null}})}{\\text{RSS}_{\\text{full}}/(N - p_{\\text{full}})} = \\frac{\\left(\\text{RSS}_{\\text{null}} - \\text{RSS}_{\\text{full}}\\right)/2}{\\text{RSS}_{\\text{full}}/(N - 3)}.\n$$\n- 使用自由度为 $\\text{df}_1 = 2$ 和 $\\text{df}_2 = N - 3$ 的 $F$ 分布，通过右尾概率（生存函数）计算 $p$-值。\n- 如果 $p  0.05$，则判定为具有显著节律性。\n\n角度单位要求：\n- 所有三角函数计算必须使用弧度作为角度单位。峰值时间必须以小时为单位表示。\n\n所需输出：\n- 对于每个数据集，输出一个双元素列表 $[t_{\\text{peak}}, \\text{is\\_rhythmic}]$，其中 $t_{\\text{peak}}$ 是以小时为单位的峰值时间，四舍五入到 $2$ 位小数，而 $\\text{is\\_rhythmic}$ 是使用 $p  0.05$ 标准计算出的布尔值。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[result1,result2,result3]$）。每个 $resultk$ 都必须是上述的双元素列表。\n\n测试套件（时间单位：小时，计数单位：细胞/微升）。请使用以下确切的数组：\n\n- 案例 $1$（强昼夜节律信号，峰值约在 $4$ 小时附近）：\n  - 时间：$[0,3,6,9,12,15,18,21]$\n  - 计数 (细胞$/\\mu$L)：$[560,616,604,531,440,384,396,469]$\n\n- 案例 $2$（近似无节律，计数接近恒定）：\n  - 时间：$[0,4,8,12,16,20]$\n  - 计数 (细胞$/\\mu$L)：$[498,505,492,501,499,504]$\n\n- 案例 $3$（不规则采样，峰值在边界附近，约在 $23$ 小时）：\n  - 时间：$[1,5,7,10,13,17,19,22]$\n  - 计数 (细胞$/\\mu$L)：$[369,300,260,222,231,300,340,377]$\n\n数值和单位要求：\n- 以小时表示 $t_{\\text{peak}}$，四舍五入到 $2$ 位小数。\n- 三角函数内部使用弧度。\n- 节律性布尔标志必须使用 $p  0.05$ 进行计算。\n\n您的程序必须实现上述逻辑，并以指定的确切格式生成最终的单行输出。", "solution": "问题陈述需经过验证。\n\n步骤1：提取已知条件\n- **模型**：昼夜节律变化被建模为具有固定周期T=24小时的单分量余弦振荡，并叠加在平均水平M上。\n- **完整余弦模型**：$y_i = M + A \\cos(\\omega t_i) + B \\sin(\\omega t_i) + \\varepsilon_i$，其中 $\\omega = 2\\pi/T$。\n- **零模型（无节律）**：$y_i = M_0 + \\varepsilon_i$。\n- **估计方法**：普通最小二乘法（OLS）。\n- **参数定义**：\n    - 振幅：$C = \\sqrt{A^2 + B^2}$。\n    - 相位参数：$\\phi = \\operatorname{atan2}(-B, A)$。\n    - 峰值时间（acrophase）：$t_{\\text{peak}} = \\frac{(-\\phi) \\bmod 2\\pi}{\\omega}$，单位为小时，范围在 $[0,24)$ 内。\n- **显著性检验**：比较完整模型和零模型的方差分析（$F$-检验）。\n    - 检验统计量：$F = \\frac{\\left(\\text{RSS}_{\\text{null}} - \\text{RSS}_{\\text{full}}\\right)/2}{\\text{RSS}_{\\text{full}}/(N - 3)}$。\n    - 参数数量：$p_{\\text{full}} = 3$, $p_{\\text{null}} = 1$。观测数量：$N$。\n    - 自由度：$\\text{df}_1 = 2$, $\\text{df}_2 = N - 3$。\n    - 显著性标准：$p  0.05$，其中 $p$-值来自 $F$-分布的右尾。\n- **数据（测试套件）**：\n    - 案例1：时间 = $[0,3,6,9,12,15,18,21]$，计数 = $[560,616,604,531,440,384,396,469]$。\n    - 案例2：时间 = $[0,4,8,12,16,20]$，计数 = $[498,505,492,501,499,504]$。\n    - 案例3：时间 = $[1,5,7,10,13,17,19,22]$，计数 = $[369,300,260,222,231,300,340,377]$。\n- **输出格式**：对于每个数据集，一个双元素列表 $[t_{\\text{peak}}, \\text{is\\_rhythmic}]$，其中 $t_{\\text{peak}}$ 四舍五入到2位小数，$\\text{is\\_rhythmic}$ 是一个布尔值。最终输出为单行：用方括号括起来的这些结果的逗号分隔列表。\n\n步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题具有科学依据。余弦分析是时间生物学中用于分析节律性数据的标准、广泛使用的技术。免疫细胞计数的昼夜节律调控假说是免疫学中一个成熟的研究领域。\n- **适定性**：该问题是适定的。它提供了清晰的数学模型、用于参数估计（OLS）和假设检验（$F$-检验）的明确统计程序以及完整的数据集。目标明确无歧义。\n- **客观性**：问题以精确、客观和定量的术语陈述。\n- **完整性和一致性**：问题是自洽的。所有必要的方程、参数、数据和标准都已提供，且没有矛盾。\n- **其他标准**：该问题是可形式化的，与其所述领域相关，是现实的，并提出了一个非平凡但可解决的挑战。它不是不适定的、伪深刻的或不可验证的。\n\n步骤3：结论与行动\n问题是有效的。必须开发一个严谨的解决方案。\n\n解决方案将基于线性回归和统计模型比较的原理来构建。\n\n**矩阵形式的模型公式**\n\n余弦模型是一个线性模型。对于一组 $N$ 个观测值 $(t_i, y_i)$，我们可以用矩阵形式表示完整模型：\n$$\n\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol{\\varepsilon}\n$$\n其中 $\\mathbf{y}$ 是T细胞计数的 $N \\times 1$ 向量，$\\mathbf{X}$ 是 $N \\times 3$ 的设计矩阵，$\\boldsymbol{\\beta}$ 是 $3 \\times 1$ 的参数向量，$\\boldsymbol{\\varepsilon}$ 是 $N \\times 1$ 的误差向量。\n\n各部分为：\n$$\n\\mathbf{y} = \\begin{pmatrix} y_1 \\\\ y_2 \\\\ \\vdots \\\\ y_N \\end{pmatrix}, \\quad\n\\mathbf{X} = \\begin{pmatrix}\n1  \\cos(\\omega t_1)  \\sin(\\omega t_1) \\\\\n1  \\cos(\\omega t_2)  \\sin(\\omega t_2) \\\\\n\\vdots  \\vdots  \\vdots \\\\\n1  \\cos(\\omega t_N)  \\sin(\\omega t_N)\n\\end{pmatrix}, \\quad\n\\boldsymbol{\\beta} = \\begin{pmatrix} M \\\\ A \\\\ B \\end{pmatrix}\n$$\n角频率为 $\\omega = 2\\pi/T$，周期 $T=24$ 小时。\n\n代表无节律的零模型是 $y_i = M_0 + \\varepsilon_i$。其中值 $M_0$ 的OLS估计是样本均值，$\\hat{M}_0 = \\bar{y} = \\frac{1}{N}\\sum_{i=1}^{N} y_i$。\n\n**通过普通最小二乘法（OLS）进行参数估计**\n\n参数向量 $\\boldsymbol{\\beta}$ 的OLS估计 $\\hat{\\boldsymbol{\\beta}}$ 使残差平方和 $\\text{RSS} = ||\\mathbf{y} - \\mathbf{X}\\boldsymbol{\\beta}||_2^2$ 最小化。解由正规方程给出：\n$$\n\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^T\\mathbf{X})^{-1}\\mathbf{X}^T\\mathbf{y}\n$$\n这提供了估计值 $[\\hat{M}, \\hat{A}, \\hat{B}]^T$。在计算上，这通过稳健的线性代数程序（例如实现QR分解的程序）来解决。\n\n**峰值时间计算**\n\n峰值时间 $t_{\\text{peak}}$ 是拟合的余弦曲线达到峰值的时间。节律分量是 $f(t) = \\hat{A} \\cos(\\omega t) + \\hat{B} \\sin(\\omega t)$。我们将其重写为 $C \\cos(\\omega t + \\phi)$ 的形式。\n使用余弦和角公式，$C \\cos(\\omega t + \\phi) = C(\\cos(\\omega t)\\cos(\\phi) - \\sin(\\omega t)\\sin(\\phi))$。通过与 $f(t)$ 比较系数，我们得到：\n$$\n\\hat{A} = C \\cos(\\phi) \\quad \\text{和} \\quad \\hat{B} = -C \\sin(\\phi)\n$$\n由此，相位参数 $\\phi$ 由 $\\tan(\\phi) = \\sin(\\phi)/\\cos(\\phi) = (-\\hat{B}/C)/(\\hat{A}/C) = -\\hat{B}/\\hat{A}$ 确定。`atan2` 函数正确解决了象限模糊性：\n$$\n\\phi = \\operatorname{atan2}(-\\hat{B}, \\hat{A})\n$$\n余弦函数的最大值出现在其参数是 $2\\pi$ 的整数倍时。我们寻找第一个峰值时间 $t_{\\text{peak}} \\in [0, T)$。我们求解 $\\omega t_{\\text{peak}} + \\phi = 0 \\pmod{2\\pi}$，这意味着 $\\omega t_{\\text{peak}} = (-\\phi) \\pmod{2\\pi}$。这给出了峰值时间的公式：\n$$\nt_{\\text{peak}} = \\frac{(-\\phi) \\pmod{2\\pi}}{\\omega} = \\frac{T}{2\\pi} \\left( (-\\phi) \\pmod{2\\pi} \\right)\n$$\n结果以小时表示，四舍五入到2位小数。\n\n**节律性假设检验**\n\n为了检验显著的节律性，我们将完整的余弦模型（$H_1$）与恒定均值的零模型（$H_0$）进行比较。零假设陈述了节律振幅为零（$A=B=0$）。\n\n此比较使用 $F$-检验进行。我们计算两个模型的残差平方和（RSS）：\n- $\\text{RSS}_{\\text{null}} = \\sum_{i=1}^N (y_i - \\bar{y})^2$\n- $\\text{RSS}_{\\text{full}} = \\sum_{i=1}^N (y_i - (\\hat{M} + \\hat{A}\\cos(\\omega t_i) + \\hat{B}\\sin(\\omega t_i)))^2$\n\n$F$-统计量是每个附加参数解释的方差与完整模型未解释方差的比率：\n$$\nF = \\frac{(\\text{RSS}_{\\text{null}} - \\text{RSS}_{\\text{full}}) / (p_{\\text{full}} - p_{\\text{null}})}{\\text{RSS}_{\\text{full}} / (N - p_{\\text{full}})}\n$$\n这里，$p_{\\text{full}}=3$（对于 $M, A, B$），$p_{\\text{null}}=1$（对于 $M_0$），$N$ 是数据点的数量。$F$-分布的自由度是 $\\text{df}_1 = p_{\\text{full}} - p_{\\text{null}} = 2$ 和 $\\text{df}_2 = N - p_{\\text{full}} = N-3$。\n\n大的 $F$ 值表明余弦模型提供的拟合显著优于简单的恒定均值模型，这表明存在节律。我们计算 $p$-值，它是在假设零假设为真的情况下，观察到等于或大于计算出的 $F$-统计量的概率。这由 $F_{2, N-3}$ 分布的生存函数（右尾概率）给出。\n\n如果 $p$-值小于传统阈值 $\\alpha=0.05$，则宣布该节律具有统计显著性。结果 $\\text{is\\_rhythmic}$ 是基于此检验（$p  0.05$）的布尔值。\n\n现在将应用此已验证的方法论到提供的测试案例上，进行实现。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import f as f_dist\n\ndef cosinor_analysis(times, counts):\n    \"\"\"\n    Performs cosinor analysis to estimate acrophase and test for rhythmicity.\n\n    Args:\n        times (np.ndarray): Array of measurement times in hours.\n        counts (np.ndarray): Array of corresponding cell counts.\n\n    Returns:\n        list: A two-element list containing the acrophase [hours] rounded\n              to 2 decimals and a boolean indicating significant rhythmicity.\n    \"\"\"\n    # 1. Define constants and variables\n    N = len(times)\n    T = 24.0  # Period in hours\n    omega = 2 * np.pi / T  # Angular frequency in radians per hour\n\n    # 2. Set up and solve the full cosinor model using Ordinary Least Squares (OLS)\n    # The model is y = M + A*cos(omega*t) + B*sin(omega*t)\n    # This is a linear regression problem: y = X * beta\n    X = np.c_[np.ones(N), np.cos(omega * times), np.sin(omega * times)]\n    y = counts\n\n    # np.linalg.lstsq solves for beta in y = X*beta and returns RSS\n    # solution is beta = [M, A, B]\n    # residuals[0] is the residual sum of squares (RSS_full)\n    beta, residuals, _, _ = np.linalg.lstsq(X, y, rcond=None)\n    M_hat, A_hat, B_hat = beta\n    \n    # Check if a valid solution was found. residuals is empty if N == 3.\n    if N == 3:\n        rss_full = np.sum((y - X @ beta)**2)\n    else:\n        rss_full = residuals[0]\n\n    # 3. Calculate parameters for the null model (no rhythm)\n    # The model is y = M0. The OLS estimate for M0 is the mean of y.\n    y_mean = np.mean(y)\n    rss_null = np.sum((y - y_mean)**2)\n\n    # 4. Perform the F-test for rhythmicity\n    p_full = 3  # Number of parameters in the full model (M, A, B)\n    p_null = 1  # Number of parameters in the null model (M0)\n    \n    # Degrees of freedom for the F-test\n    df1 = p_full - p_null\n    df2 = N - p_full\n    \n    is_rhythmic = False\n    p_value = 1.0 # Default to non-rhythmic\n    \n    # The F-test is only valid if RSS_full > 0 and the denominator df > 0\n    if df2 > 0 and rss_full > 1e-9: # Avoid division by zero\n        F_statistic = ((rss_null - rss_full) / df1) / (rss_full / df2)\n        \n        # Calculate p-value from the survival function (right-tail prob) of the F-distribution\n        p_value = f_dist.sf(F_statistic, df1, df2)\n        \n        # Check for significance\n        if p_value  0.05:\n            is_rhythmic = True\n\n    # 5. Calculate the acrophase (time of peak)\n    # phi = atan2(-B, A)\n    # t_peak = ((-phi) mod 2pi) / omega\n    phi = np.arctan2(-B_hat, A_hat)\n    \n    # The modulo operator % in Python correctly handles negative numbers for this purpose.\n    # It ensures the result is in [0, 2*pi) for a positive divisor.\n    t_peak_rad = (-phi) % (2 * np.pi)\n    t_peak = t_peak_rad / omega\n    \n    t_peak_rounded = round(t_peak, 2)\n\n    return [t_peak_rounded, is_rhythmic]\n\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on the provided test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (strong circadian signal)\n        {'times': np.array([0, 3, 6, 9, 12, 15, 18, 21]),\n         'counts': np.array([560, 616, 604, 531, 440, 384, 396, 469])},\n        \n        # Case 2 (approximately arrhythmic)\n        {'times': np.array([0, 4, 8, 12, 16, 20]),\n         'counts': np.array([498, 505, 492, 501, 499, 504])},\n        \n        # Case 3 (irregular sampling, peak near boundary)\n        {'times': np.array([1, 5, 7, 10, 13, 17, 19, 22]),\n         'counts': np.array([369, 300, 260, 222, 231, 300, 340, 377])}\n    ]\n\n    results = []\n    for case in test_cases:\n        result = cosinor_analysis(case['times'], case['counts'])\n        results.append(result)\n\n    # Format the final output string as specified\n    # e.g., [[4.0, True],[12.23, False]]\n    results_str =','.join(map(str, results))\n    print(f\"[{results_str}]\")\n\nsolve()\n\n```", "id": "2841150"}, {"introduction": "一旦节律得到证实，接下来的问题就是理解其潜在机制。本练习将挑战你将核心分子钟机制与整个生物体的生理反应联系起来。通过推断在免疫细胞中删除主时钟基因 $Bmal1$ 的后果 [@problem_id:2841077]，你将对生物钟如何“门控”（gate）炎症反应，从而导致疾病严重程度的日夜差异，有更深刻的理解。", "problem": "一个夜行性小鼠品系在对脂多糖（LPS）攻击的全身性反应中表现出强烈的因时依赖性。在野生型动物中，于授时因子时间（$ZT12$）腹腔内快速注射剂量为$D$的LPS，比在授时因子时间（$ZT0$）注射相同剂量，会产生更大的平均动脉压（MAP）降幅。假设以下基本事实和定义成立。\n\n- 髓系细胞中的分子生物钟建立在一个转录-翻译反馈回路上，其中Circadian Locomotor Output Cycles Kaput（CLOCK）和Brain and Muscle ARNT-Like 1（BMAL1）驱动Period（$Per$）和Cryptochrome（$Cry$）基因以及核受体亚家族1 D组成员1（NR$1$D$1$，又称REV-ERB$\\alpha$）的转录，而REV-ERB$\\alpha$反过来以近$24$小时的周期性抑制时钟控制的输出。\n- LPS对Toll样受体4（TLR$4$）的刺激会激活活化B细胞的核因子κB（NF-κB）通路，并诱导促炎细胞因子（例如，肿瘤坏死因子-α（TNF-$\\alpha$）、白细胞介素-6（IL-$6$））和诱导型一氧化氮合酶（iNOS，又称NOS$2$）。髓系细胞中由iNOS产生的一氧化氮（NO）在内毒素血症中导致血管舒张和低血压。\n- 从血流动力学角度看，平均动脉压满足$P_{\\mathrm{MAP}}(t) = Q(t)\\cdot R(t)$，其中$Q(t)$是心输出量，$R(t)$是全身血管阻力。增加的NO会降低$R(t)$；形式上表示为$\\dfrac{\\partial R}{\\partial \\text{NO}}  0$。\n- 在野生型髓系细胞中，昼夜节律门控通过BMAL1驱动的输出（例如，通过REV-ERB$\\alpha$）以因时依赖的方式调节依赖于NF-κB的转录，这些输出在特定时相抑制特定的炎症基因。\n\n你构建了一只髓系特异性Bmal$1$基因敲除小鼠（例如，使用LysM-Cre驱动），而不改变中枢起搏器或光暗周期。你在$ZT0$和$ZT12$时刻，使用相同的剂量$D$以及相当的麻醉和液体支持，重复了LPS实验。请预测，与野生型相比，髓系Bmal$1$基因敲除小鼠中LPS诱导的低血压的昼夜差异会如何变化，并提供机制上最准确的解释。\n\n哪个选项最能描述预期的结果和机制？\n\nA. 低血压的因时差异基本消除，并且在$ZT0$和$ZT12$两个时间点，整体低血压都被加剧，因为BMAL1的缺失移除了对NF-κB靶标（包括$Nos2$）的细胞自主的昼夜节律性抑制，从而在整个周期内增加了NO和促炎细胞因子。\n\nB. 昼夜差异的相位发生反转，但幅度不变，因为BMAL1的缺失翻转了髓系细胞时钟的相位，使iNOS的表达峰值从$ZT12$转移到$ZT0$。\n\nC. 因时差异被放大，在$ZT12$时出现更深的血压低谷，而在$ZT0$时MAP更高，因为BMAL1通常缓冲血管活性细胞因子的输出；其缺失增加了NF-κB昼夜节律振荡的幅度。\n\nD. 没有有意义的变化，因为LPS诱导的低血压几乎完全由内皮型一氧化氮合酶（eNOS）和心输出量决定；髓系特异性时钟破坏不影响$P_{\\mathrm{MAP}}(t) = Q(t)\\cdot R(t)$中的$R(t)$。\n\nE. 因时差异被消除，并且在$ZT0$和$ZT12$两个时间点，低血压均被减弱，因为BMAL1是$Nos2$诱导所必需的，其缺失会减少NO的产生，而与时间无关。", "solution": "首先将对问题陈述的科学性和逻辑完整性进行验证。\n\n### 步骤1：提取已知条件\n- 使用的是一个夜行性小鼠品系。\n- 在野生型（WT）动物中，于授时因子时间（$ZT12$）腹腔内快速注射剂量为$D$的脂多糖（LPS），比在授时因子时间（$ZT0$）注射相同剂量，会产生更大的平均动脉压（MAP）降幅。\n- 分子时钟涉及一个转录-翻译反馈回路：\n    - Circadian Locomotor Output Cycles Kaput (CLOCK) 和 Brain and Muscle ARNT-Like 1 (BMAL1) 驱动 Period ($Per$)、Cryptochrome ($Cry$) 和核受体亚家族1 D组成员1（$NR1D1$，又称REV-ERB$\\alpha$）的转录。\n    - REV-ERB$\\alpha$ 抑制时钟控制的输出。\n- LPS信号通路：\n    - Toll样受体4 (TLR$4$) 被LPS刺激。\n    - 这激活了活化B细胞的核因子κB（NF-κB）通路。\n    - NF-κB 诱导促炎细胞因子（例如，肿瘤坏死因子-α (TNF-$\\alpha$)、白细胞介素-6 (IL-$6$)）和诱导型一氧化氮合酶 (iNOS, 或 NOS$2$)。\n    - 来自iNOS的一氧化氮 (NO) 导致血管舒张和低血压。\n- 血流动力学：\n    - 平均动脉压：$P_{\\mathrm{MAP}}(t) = Q(t)\\cdot R(t)$，其中$Q(t)$为心输出量，$R(t)$为全身血管阻力。\n    - NO对阻力的影响：$\\frac{\\partial R}{\\partial \\text{NO}}  0$。\n- 昼夜节律-免疫相互作用：\n    - 在野生型髓系细胞中，昼夜节律门控通过BMAL1驱动的输出（例如，REV-ERB$\\alpha$）调节依赖于NF-κB的转录，这些输出在特定时相抑制特定的炎症基因。\n- 实验模型：\n    - 构建了一只髓系特异性$Bmal1$基因敲除小鼠。\n    - 中枢起搏器和光暗周期未被改变。\n    - 在这些基因敲除小鼠中，于$ZT0$和$ZT12$重复LPS实验。\n- 问题：\n    - 预测髓系$Bmal1$基因敲除小鼠与野生型相比，LPS诱导的低血压的昼夜差异如何变化。\n    - 提供机制上最准确的解释。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准对问题陈述进行评估。\n\n- **科学依据充分：** 该问题牢固地建立在时间生物学和免疫学的既定原理之上。$BMAL1$、REV-ERB$\\alpha$、TLR$4$、NF-κB和iNOS在昼夜节律和内毒素血症中的作用在科学文献中有充分记载。所描述的相互作用是该领域的标准模型。\n- **问题定义明确：** 问题提供了清晰的初始状态（野生型反应）、一个特定的扰动（髓系$Bmal1$基因敲除）和一个定义明确的问题（预测昼夜反应的变化）。所提供的机制细节足以推导出唯一且合乎逻辑的结果。\n- **客观性：** 语言技术性强、精确且不含主观性。\n- **自洽且一致：** 已知条件内部是一致的。LPS反应在$ZT12$（活动期开始）更强的观察结果，与已知机制一致，即由$BMAL1$（在休息期达到峰值）驱动的抑制性时钟元件会抑制炎症。因此，在休息期（约$ZT0$），抑制作用强；而在活动期（约$ZT12$），抑制作用弱。这些前提相互支持，形成了一个无矛盾的逻辑框架。\n- **可行且现实：** 所描述的实验设置（髓系特异性基因敲除、在不同授时因子时间的LPS攻击）是生物医学研究中的标准且可行的程序。\n\n问题陈述没有可识别的缺陷。它在科学上是合理的，逻辑上是连贯的，并且定义明确。\n\n### 步骤3：结论与行动\n该问题是**有效的**。开始进行求解推导。\n\n### 基于原理的推导\n 目标是预测髓系特异性$Bmal1$缺失对LPS诱导的低血压昼夜变化的影响。\n\n1.  **分析野生型（WT）的昼夜节律反应：**\n    问题陈述指出，在WT小鼠中，于$ZT12$进行的LPS攻击比在$ZT0$时诱导更大的平均动脉压（$P_{\\mathrm{MAP}}$）降幅。$P_{\\mathrm{MAP}}$的下降即为低血压。这种低血压是由血管舒张引起的，而血管舒张是全身血管阻力$R(t)$下降的结果。在内毒素血症的背景下，这种血管舒张的主要驱动因素是髓系细胞中由iNOS酶（由$Nos2$基因编码）产生的一氧化氮（NO）。形式上，更大的$P_{\\mathrm{MAP}}$降幅意味着更大的$R(t)$降幅，这又意味着更多的NO产生，从而通过NF-κB通路更强地诱导$Nos2$和其他促炎基因。\n    因此，对LPS的炎症反应在$ZT12$时更强，在$ZT0$时更弱。\n\n    所提供的机制是“昼夜节律门控通过BMAL1驱动的输出（例如，通过REV-ERB$\\alpha$）......抑制特定的炎症基因”。\n    - BMAL1是时钟的核心转录激活因子。它的表达和活性在休息期（对于夜行性啮齿动物，这是从$ZT0$开始的光照期）达到峰值。\n    - BMAL1驱动抑制因子REV-ERB$\\alpha$的表达。其蛋白质产物REV-ERB$\\alpha$会延迟累积，并在主观白天达到峰值水平。\n    - 高水平的REV-ERB$\\alpha$会抑制靶基因，包括像$Nos2$这样的炎症基因。这解释了为什么在$ZT0$（休息期开始）时的炎症反应受到抑制。\n    - 相反，在$ZT12$（活动期开始）时，BMAL1活性低，导致其靶标REV-ERB$\\alpha$水平低。对炎症基因的抑制性制动被解除。这解释了为什么在$ZT12$时的炎症反应很强。\n    该模型与已知条件完全一致。\n\n2.  **分析髓系特异性$Bmal1$基因敲除（KO）小鼠：**\n    在这种小鼠中，$Bmal1$基因在髓系细胞中被特异性删除。\n    - 其后果是这些细胞中细胞自主的分子时钟被消除。没有BMAL1，整个转录-翻译反馈回路，包括$Per$、$Cry$以及重要的抑制因子$REV-ERB\\alpha$的节律性表达，都会丧失。\n    - 依赖于像REV-ERB$\\alpha$这样的抑制因子节律性水平的炎症反应的节律性门控因此被消除。\n    - 在WT小鼠中，系统在$ZT0$处于“抑制”状态，在$ZT12$处于“去抑制”或“允许”状态。在$Bmal1$ KO小鼠中，抑制因子（$REV-ERB\\alpha$）的主要驱动者（BMAL1）消失了。因此，系统将处于一种持续的去抑制状态。\n    - **在$ZT0$时**：KO小鼠缺乏WT小鼠中抑制炎症反应的抑制机制。因此，对LPS的反应将远强于WT小鼠在$ZT0$时的反应，并应接近在$ZT12$时观察到的高水平反应。\n    - **在$ZT12$时**：WT小鼠已经处于去抑制状态，炎症反应强烈。在KO小鼠中，反应也将很强。它将与WT在$ZT12$时的反应相似，甚至可能更强，因为时钟的任何残余抑制功能现在都完全消失了。\n    - **总体变化**：$ZT0$和$ZT12$之间LPS反应的差异将大部分或完全被消除。在整个$24$小时周期内，反应的总体水平将被加剧，导致与WT小鼠的基线反应曲线相比，两个时间点的低血压都更严重（具体来说，$ZT0$时大幅增加，并在$ZT12$时维持高水平）。\n\n### 逐项分析选项\n\n**A. 低血压的因时差异基本消除，并且在$ZT0$和$ZT12$两个时间点，整体低血压都被加剧，因为BMAL1的缺失移除了对NF-κB靶标（包括$Nos2$）的细胞自主的昼夜节律性抑制，从而在整个周期内增加了NO和促炎细胞因子。**\n- **评估：** 这一陈述与推导完全一致。BMAL1的缺失消除了髓系细胞中的时钟，移除了对炎症基因的节律性抑制。这导致一个持续的去抑制状态，在$ZT0$和$ZT12$都引起过度炎症反应（加剧的低血压），从而消除了因时差异。所提供的机制是正确的。\n- **结论：** **正确**。\n\n**B. 昼夜差异的相位发生反转，但幅度不变，因为BMAL1的缺失翻转了髓系细胞时钟的相位，使iNOS的表达峰值从$ZT12$转移到$ZT0$。**\n- **评估：** 敲除像BMAL1这样的核心、非冗余时钟组件会消除时钟，而不会引起相位反转。当振荡器的核心驱动组件被移除时，它不能“翻转其相位”；它会停止振荡。从时间生物学的角度来看，所提出的机制是根本错误的。\n- **结论：** **错误**。\n\n**C. 因时差异被放大，在$ZT12$时出现更深的血压低谷，而在$ZT0$时MAP更高，因为BMAL1通常缓冲血管活性细胞因子的输出；其缺失增加了NF-κB昼夜节律振荡的幅度。**\n- **评估：** 这是错误的。BMAL1的缺失会消除昼夜节律振荡；它不会增加其幅度。髓系细胞中炎症基因表达的昼夜节律幅度将减少到接近零。一个非振荡系统不可能有放大的因时差异。\n- **结论：** **错误**。\n\n**D. 没有有意义的变化，因为LPS诱导的低血压几乎完全由内皮型一氧化氮合酶（eNOS）和心输出量决定；髓系特异性时钟破坏不影响$P_{\\mathrm{MAP}}(t) = Q(t)\\cdot R(t)$中的$R(t)$。**\n- **评估：** 这一陈述直接与问题的前提相矛盾。问题明确指出“髓系细胞中由iNOS产生的一氧化氮（NO）导致血管舒张和低血压”。它还指出，髓系细胞中的昼夜节律门控调节依赖于NF-κB的转录。因此，髓系特异性时钟破坏必须影响iNOS，并进而影响全身血管阻力$R(t)$。\n- **结论：** **错误**。\n\n**E. 因时差异被消除，并且在$ZT0$和$ZT12$两个时间点，低血压均被减弱，因为BMAL1是$Nos2$诱导所必需的，其缺失会减少NO的产生，而与时间无关。**\n- **评估：** 这个选项正确地预测了因时差异的消除，但错误地预测了整体反应变化的方向。它提出低血压被减弱。这将意味着BMAL1是$Nos2$诱导的直接且必需的激活剂。然而，所提供的WT数据（在BMAL1活性低时，$ZT12$反应更强；在BMAL1活性高时，$ZT0$反应更弱）与此机制相矛盾。数据强烈支持一个模型，即BMAL1驱动的时钟的净效应是在休息期起抑制作用。因此，BMAL1的缺失应导致去抑制和加剧的反应，而不是减弱的反应。\n- **结论：** **错误**。", "answer": "$$\\boxed{A}$$", "id": "2841077"}, {"introduction": "昼夜节律系统和免疫系统之间的相互作用通常是复杂的，涉及双向反馈回路。这项高级练习介绍了格兰杰因果关系（Granger causality），这是一种从时间序列数据中推断方向性影响的强大统计方法。通过分析时钟基因 $Per2$ 和细胞因子 $Il1b$ 的合成数据 [@problem_id:2841109]，你将学习如何通过计算来探究这个问题：“是生物钟调节炎症，还是炎症反馈给生物钟，亦或是两者兼而有之？”", "problem": "给定一个概念模型，描述了昼夜节律调控如何通过 Period Circadian Regulator $2$ ($\\mathrm{Per2}$) 和 Interleukin $1$ beta ($\\mathrm{Il1b}$) 之间的相互作用来塑造炎症反应。在炎症损伤后，$\\mathrm{Per2}$ 和 $\\mathrm{Il1b}$ 都会表现出随时间变化的表达动态。假设在所分析的时间窗口内，这些动态可以被一个联合平稳、线性、时不变、高斯的固定阶数 $k$ 的二元自回归过程（$k$ 阶向量自回归）局部近似。根据 Granger causality (GC) 的定义，如果在线性高斯模型假设下，使用变量 $Y$ 的过去值对 $Y$ 进行预测的准确性，可以通过同时纳入变量 $X$ 的过去值而得到改善，那么变量 $X$ 就是变量 $Y$ 的 Granger 原因。这与免疫学中的一种机理学解释相符：方向性影响可以反映生物钟对炎症通路的调控门控，或炎症对时钟基因表达的反馈。请以此为基础（平稳线性高斯自回归以及 Granger 因果关系作为基于过去值的预测能力提升的定义），实现一个算法来推斷 $\\mathrm{Per2}$ 和 $\\mathrm{Il1b}$ 之间的方向性。\n\n您的任务是：\n- 根据下面给出的参数集，在平稳线性高斯自回归假设下，以编程方式生成合成的二元时间序列 $(\\mathrm{Per2}_t, \\mathrm{Il1b}_t)$。\n- 对于每个合成数据集，在固定的滞后阶数 $k$ 下，对 $\\mathrm{Per2}$ 和 $\\mathrm{Il1b}$ 进行双向 Granger 因果检验。使用嵌套线性模型方法，在高斯噪声假设和标准线性回归理论下，量化纳入假定原因的过去值是否能显著改善对结果的预测。\n- 使用双边决策规则，显著性水平为 $\\alpha = 0.01$，以确定是 $\\mathrm{Per2}$ Granger-导致 $\\mathrm{Il1b}$，还是 $\\mathrm{Il1b}$ Granger-导致 $\\mathrm{Per2}$，或两者兼有，或两者皆无。\n- 每个测试用例报告一个整数，用于编码推斷出的方向性：如果仅支持 $\\mathrm{Per2} \\to \\mathrm{Il1b}$，则为 $1$；如果仅支持 $\\mathrm{Il1b} \\to \\mathrm{Per2}$，则为 $-1$；如果双向都支持，则为 $2$；如果两个方向都不支持，则为 $0$。\n\n您必须实现的自回归生成器如下。对于下述所有情况，令 $k \\in \\{2\\}$。对每个时间步长 $t$ 生成\n- $\\mathrm{Per2}_t$ 由一个截距 $c_1$、$\\mathrm{Per2}$ 的过去 $k$ 个滞后项（系数为 $\\{a_{11,\\ell}\\}_{\\ell=1}^k$）、$\\mathrm{Il1b}$ 的过去 $k$ 个滞后项（系数为 $\\{a_{12,\\ell}\\}_{\\ell=1}^k$）以及一个标准差为 $\\sigma_1$ 的独立高斯新息生成，\n- $\\mathrm{Il1b}_t$ 由一个截距 $c_2$、$\\mathrm{Il1b}$ 的过去 $k$ 个滞后项（系数为 $\\{a_{22,\\ell}\\}_{\\ell=1}^k$）、$\\mathrm{Per2}$ 的过去 $k$ 个滞后项（系数为 $\\{a_{21,\\ell}\\}_{\\ell=1}^k$）以及一个标准差为 $\\sigma_2$ 的独立高斯新息生成，\n确保模拟从初始值 $0$ 开始，并在收集所要求的样本长度之前，包含一个足够长的“预烧期”（burn-in）以达到平稳状态。时间单位为小时，表達量为标准化的任意单位；您无需输出任何单位，因为最终输出为整数。\n\n测试套件（每个元组指定 $(T, k, c_1, c_2, [a_{11,1}, a_{11,2}], [a_{22,1}, a_{22,2}], [a_{21,1}, a_{21,2}], [a_{12,1}, a_{12,2}], \\sigma_1, \\sigma_2)$，其中 $[a_{21,\\ell}]$ 是 $\\mathrm{Per2}$ 影响 $\\mathrm{Il1b}$ 的系数，$[a_{12,\\ell}]$ 是 $\\mathrm{Il1b}$ 影响 $\\mathrm{Per2}$ 的系数）：\n- 情况 A（理想路径, $\\mathrm{Per2} \\to \\mathrm{Il1b}$）：$(T = 240, k = 2, c_1 = 0, c_2 = 0, [a_{11,1}, a_{11,2}] = [ 1.5, -0.75 ], [a_{22,1}, a_{22,2}] = [ 1.2, -0.6 ], [a_{21,1}, a_{21,2}] = [ 0.5, 0.0 ], [a_{12,1}, a_{12,2}] = [ 0.0, 0.0 ], \\sigma_1 = 0.2, \\sigma_2 = 0.2)$。\n- 情况 B（零假設，无方向性）：$(T = 240, k = 2, c_1 = 0, c_2 = 0, [a_{11,1}, a_{11,2}] = [ 1.5, -0.75 ], [a_{22,1}, a_{22,2}] = [ 1.2, -0.6 ], [a_{21,1}, a_{21,2}] = [ 0.0, 0.0 ], [a_{12,1}, a_{12,2}] = [ 0.0, 0.0 ], \\sigma_1 = 0.3, \\sigma_2 = 0.3)$。\n- 情况 C（反向, $\\mathrm{Il1b} \\to \\mathrm{Per2}$）：$(T = 240, k = 2, c_1 = 0, c_2 = 0, [a_{11,1}, a_{11,2}] = [ 1.5, -0.75 ], [a_{22,1}, a_{22,2}] = [ 1.2, -0.6 ], [a_{21,1}, a_{21,2}] = [ 0.0, 0.0 ], [a_{12,1}, a_{12,2}] = [ 0.35, 0.0 ], \\sigma_1 = 0.2, \\sigma_2 = 0.2)$。\n- 情况 D（边界情况，短时间序列和弱耦合）：$(T = 40, k = 2, c_1 = 0, c_2 = 0, [a_{11,1}, a_{11,2}] = [ 1.5, -0.75 ], [a_{22,1}, a_{22,2}] = [ 1.2, -0.6 ], [a_{21,1}, a_{21,2}] = [ 0.0, 0.0 ], [a_{12,1}, a_{12,2}] = [ 0.15, 0.0 ], \\sigma_1 = 0.6, \\sigma_2 = 0.6)$。\n\n算法要求：\n- 使用普通最小二乘法拟合线性模型，仅使用过去的 $k$ 个滞后项。对每个方向都使用一个受限模型（不包含另一个变量的滞后项）和一个非受限模型（包含两个变量的滞后项）进行处理。使用高斯线性模型假设来构建一个有效的嵌套模型检验来判定 GC。\n- 在每种情况下，对两个方向独立使用固定的显著性水平 $\\alpha = 0.01$。\n- 为保证可复现性，模拟必须使用固定的随机种子，并在收集长度为 $T$ 的所需样本前，包含一个超过 $200$ 个时间步长的预烧期。\n\n角度单位不适用。\n无需进行物理单位转换；所有最终输出均为整数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，`[1,0,-1,2]`），按顺序对应情况 A–D 的结果。每个元素必须是上面定义的 $-1$、$0$、$1$ 或 $2$ 之一。", "solution": "该问题要求开发并实现一种算法，以推断代表 Period Circadian Regulator $2$ ($\\mathrm{Per2}$) 和 Interleukin $1$ beta ($\\mathrm{Il1b}$) 表达的两个时间序列之间的方向性 Granger 因果关系。该分析基于一个二元、平稳、线性、时不变的高斯向量自回归 k 阶模型，记为 VAR($k$)。\n\n**问题验证**\n\n首先，对问题陈述进行验证。\n\n**步骤1：提取的既定条件**\n- **模型**：用于 $\\mathbf{X}_t = [\\mathrm{Per2}_t, \\mathrm{Il1b}_t]^T$ 的二元 VAR($k$) 过程。\n- **$\\mathrm{Per2}_t$ 的方程**：$\\mathrm{Per2}_t = c_1 + \\sum_{\\ell=1}^k a_{11,\\ell} \\mathrm{Per2}_{t-\\ell} + \\sum_{\\ell=1}^k a_{12,\\ell} \\mathrm{Il1b}_{t-\\ell} + \\epsilon_{1,t}$，其中 $\\epsilon_{1,t} \\sim \\mathcal{N}(0, \\sigma_1^2)$。\n- **$\\mathrm{Il1b}_t$ 的方程**：$\\mathrm{Il1b}_t = c_2 + \\sum_{\\ell=1}^k a_{21,\\ell} \\mathrm{Per2}_{t-\\ell} + \\sum_{\\ell=1}^k a_{22,\\ell} \\mathrm{Il1b}_{t-\\ell} + \\epsilon_{2,t}$，其中 $\\epsilon_{2,t} \\sim \\mathcal{N}(0, \\sigma_2^2)$。\n- **Granger 因果关系 (GC) 定义**：基于线性回归框架内过去值的预测能力提升。\n- **任务**：对四个给定的参数集，生成合成数据，执行双向 GC 检验，并报告一个编码的整数结果（$1$ 表示 $\\mathrm{Per2} \\to \\mathrm{Il1b}$，$-1$ 表示 $\\mathrm{Il1b} \\to \\mathrm{Per2}$， $2$ 表示双向，$0$ 表示无）。\n- **参数**：所有情况下 $k=2$。为四个测试用例提供了样本长度 $T$、截距 $c_1, c_2$、自回归系数 $\\{a_{ij,\\ell}\\}$ 和新息标准差 $\\sigma_1, \\sigma_2$ 的具体值。\n- **统计检验**：使用源自普通最小二乘 (OLS) 拟合的 $F$ 检验进行嵌套线性模型比较。显著性水平 $\\alpha = 0.01$。\n- **模拟要求**：使用固定的随机种子、初始值 $0$ 以及大于 $200$ 步的预烧期。\n\n**步骤2：使用提取的既定条件进行验证**\n- **科学依据**：该问题具有科学依据。向量自回归和 Granger 因果关系是时间序列分析的标准方法，将其应用于模拟生物钟基因和炎症介质之间的相互作用，是对一个真实生物学研究问题的概念上有效的简化。\n- **适定性**：该问题是适定的。它指定了数据生成过程、分析方法（基于OLS的F检验）、显著性水平和确切的输出格式。一个关键的检查点是指定 VAR 过程的平稳性。如果一个 VAR($k$) 过程的伴随矩阵的所有特征值的模都小于 $1$，则该过程是平稳的。对于给定的参数，系数矩阵 $\\mathbf{A}_\\ell$ 是对角或三角矩阵。这种结构意味着系统伴随矩阵的特征值是各个自回归过程伴随矩阵特征值的并集。对于 $\\mathrm{Per2}$ 过程，与伴随矩阵特征值相关的特征方程为 $\\lambda^2 - 1.5\\lambda + 0.75 = 0$，其根的模为 $\\sqrt{0.75}  1$。对于 $\\mathrm{Il1b}$ 过程，方程为 $\\lambda^2 - 1.2\\lambda + 0.6 = 0$，其根的模为 $\\sqrt{0.6}  1$。由于非耦合过程的所有特征值都在单位圆内，因此指定的耦合 VAR 系统是平穩的，这与问题的假设一致。\n- **客观性**：问题以精确、客观的数学和统计术语陈述。\n- **完整性和一致性**：问题是自洽的，提供了所有必要的参数和方法论约束。没有矛盾之处。\n\n**步骤3：结论与行动**\n问题有效。将提供一个解决方案。\n\n**理论框架与算法设计**\n\n该解决方案通过遵循数据生成和统计分析的原则性序列来实现。\n\n**1. 向量自回归模型**\n这两个序列 $X_{1,t} = \\mathrm{Per2}_t$ 和 $X_{2,t} = \\mathrm{Il1b}_t$ 的动态由一个二元 VAR($k$) 模型描述：\n$$\n\\begin{pmatrix} X_{1,t} \\\\ X_{2,t} \\end{pmatrix}\n=\n\\begin{pmatrix} c_1 \\\\ c_2 \\end{pmatrix}\n+\n\\sum_{\\ell=1}^{k}\n\\begin{pmatrix} a_{11,\\ell}  a_{12,\\ell} \\\\ a_{21,\\ell}  a_{22,\\ell} \\end{pmatrix}\n\\begin{pmatrix} X_{1,t-\\ell} \\\\ X_{2,t-\\ell} \\end{pmatrix}\n+\n\\begin{pmatrix} \\epsilon_{1,t} \\\\ \\epsilon_{2,t} \\end{pmatrix}\n$$\n其中 $\\mathbf{X}_t = [X_{1,t}, X_{2,t}]^T$ 是时间 $t$ 的状态向量，$\\mathbf{c}$ 是截距向量，$\\mathbf{A}_\\ell$ 是滞后 $\\ell$ 的 $2 \\times 2$ 系数矩阵，$\\mathbf{\\epsilon}_t$ 是独立同分布的高斯白噪声向量，其协方差矩阵为对角矩阵 $\\mathbf{\\Sigma} = \\mathrm{diag}(\\sigma_1^2, \\sigma_2^2)$。\n\n**2. 数据生成**\n对于每个测试用例，都会生成一个长度为 $T$ 的合成数据集。为确保过程已达到其平稳分布，模拟以零值初始化，并运行 $500$ 步的预烧期（大于所要求的 $200$ 步），然后才收集 $T$ 个数据点。采用固定的随机种子以保证可复现性。\n\n**3. 通过嵌套模型进行 Granger 因果检验**\nGranger 因果关系通过检验一个变量的滞后值在预测另一个变量时的统计显著性来评估。我们以检验假设 $X_2 \\to X_1$（即 $\\mathrm{Il1b} \\to \\mathrm{Per2}$）为例。\n\n用于 $X_{1,t}$ 的 **非受限模型** 包括 $X_1$ 和 $X_2$ 的过去值：\n$$\nX_{1,t} = \\beta_0 + \\sum_{\\ell=1}^{k} \\beta_{1,\\ell} X_{1,t-\\ell} + \\sum_{\\ell=1}^{k} \\gamma_{2,\\ell} X_{2,t-\\ell} + u_t\n$$\n$X_2$ 对 $X_1$ 不存在 Granger 因果关系的零假设为 $H_0: \\gamma_{2,1} = \\gamma_{2,2} = \\dots = \\gamma_{2,k} = 0$。\n\n**受限模型** 在此零假设下进行估计：\n$$\nX_{1,t} = \\beta'_0 + \\sum_{\\ell=1}^{k} \\beta'_{1,\\ell} X_{1,t-\\ell} + v_t\n$$\n两个模型都使用普通最小二乘法 (OLS) 对 $n = T-k$ 个可用观测值进行拟合。从这些拟合中，我们得到受限模型 ($SSR_{res}$) 和非受限模型 ($SSR_{unres}$) 的残差平方和。\n\n计算 $F$ 统计量来比较模型：\n$$\nF = \\frac{(SSR_{res} - SSR_{unres}) / q}{SSR_{unres} / (n - p)}\n$$\n- $q = k$ 是约束的数量（滞后的 $X_2$ 项的系数数量）。\n- $p = 1 + 2k$ 是非受限模型中的参数数量（一个截距、$k$ 个 $X_1$ 的滞后项和 $k$ 个 $X_2$ 的滞后项）。\n- 分母自由度为 $n-p = (T-k) - (1+2k) = T-3k-1$。\n\n将计算出的 $F$ 统计量与在显著性水平 $\\alpha = 0.01$ 下，自由度为 $q$ 和 $n-p$ 的 F 分布的临界值 $F_{crit}$ 进行比较。如果 $F > F_{crit}$，我们拒绝 $H_0$ 并得出结论：$X_2$ Granger-导致 $X_1$。\n\n**4. 双向分析与输出编码**\n对两个潜在的因果方向都执行此过程：\n- 检验 1: $H_0: \\mathrm{Il1b}$ 不 Granger-导致 $\\mathrm{Per2}$。\n- 检验 2: $H_0: \\mathrm{Per2}$ 不 Granger-导致 $\\mathrm{Il1b}$。\n\n这两个独立检验的结果被组合起来，为每个案例生成一个单一的整数代码，如问题陈述中所指定：\n- $1$：仅 $\\mathrm{Per2} \\to \\mathrm{Il1b}$ 显著。\n- $-1$：仅 $\\mathrm{Il1b} \\to \\mathrm{Per2}$ 显著。\n- $2$：双向均显著。\n- $0$：双向均不显著。\n\n最终的 Python 实现封装了这整个逻辑。它遍历所提供的测试用例，为每个用例生成数据，执行双向 Granger 因果分析，确定整数代码，并以所需格式打印收集到的结果。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import f as f_dist\n\ndef solve():\n    \"\"\"\n    Main function to solve the Granger causality problem.\n    It iterates through predefined test cases, simulates VAR(k) data,\n    performs bidirectional Granger causality tests, and reports the results.\n    \"\"\"\n\n    # Set a fixed random seed for reproducibility of simulations.\n    np.random.seed(42)\n\n    # Test suite from the problem statement.\n    # Format: (T, k, c1, c2, a11, a22, a21, a12, sigma1, sigma2)\n    test_cases = [\n        # Case A: Per2 -> Il1b\n        (240, 2, 0.0, 0.0, [1.5, -0.75], [1.2, -0.6], [0.5, 0.0], [0.0, 0.0], 0.2, 0.2),\n        # Case B: Null\n        (240, 2, 0.0, 0.0, [1.5, -0.75], [1.2, -0.6], [0.0, 0.0], [0.0, 0.0], 0.3, 0.3),\n        # Case C: Il1b -> Per2\n        (240, 2, 0.0, 0.0, [1.5, -0.75], [1.2, -0.6], [0.0, 0.0], [0.35, 0.0], 0.2, 0.2),\n        # Case D: Boundary (short T, weak coupling)\n        (40, 2, 0.0, 0.0, [1.5, -0.75], [1.2, -0.6], [0.0, 0.0], [0.15, 0.0], 0.6, 0.6),\n    ]\n\n    alpha = 0.01\n    burn_in = 500\n    results = []\n\n    for case in test_cases:\n        T, k, c1, c2, a11, a22, a21, a12, sigma1, sigma2 = case\n        \n        # 1. Generate synthetic data from the VAR(k) model\n        total_len = T + burn_in\n        per2 = np.zeros(total_len)\n        il1b = np.zeros(total_len)\n        \n        # Generate Gaussian innovations\n        innovations1 = np.random.normal(0, sigma1, total_len)\n        innovations2 = np.random.normal(0, sigma2, total_len)\n        \n        # VAR simulation loop\n        for t in range(k, total_len):\n            lagged_per2 = per2[t-k:t][::-1]\n            lagged_il1b = il1b[t-k:t][::-1]\n            \n            per2[t] = c1 + np.dot(a11, lagged_per2) + np.dot(a12, lagged_il1b) + innovations1[t]\n            il1b[t] = c2 + np.dot(a21, lagged_per2) + np.dot(a22, lagged_il1b) + innovations2[t]\n\n        # Discard burn-in period\n        per2_final = per2[burn_in:]\n        il1b_final = il1b[burn_in:]\n\n        # 2. Perform bidirectional Granger causality testing\n        # Test if Per2 Granger-causes Il1b\n        gc_per2_to_il1b = is_granger_cause(\n            y_ts=il1b_final, x_ts=per2_final, k=k, alpha=alpha\n        )\n\n        # Test if Il1b Granger-causes Per2\n        gc_il1b_to_per2 = is_granger_cause(\n            y_ts=per2_final, x_ts=il1b_final, k=k, alpha=alpha\n        )\n\n        # 3. Encode the result\n        if gc_per2_to_il1b and not gc_il1b_to_per2:\n            results.append(1)\n        elif not gc_per2_to_il1b and gc_il1b_to_per2:\n            results.append(-1)\n        elif gc_per2_to_il1b and gc_il1b_to_per2:\n            results.append(2)\n        else:\n            results.append(0)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef is_granger_cause(y_ts, x_ts, k, alpha):\n    \"\"\"\n    Performs a Granger causality test to see if x_ts Granger-causes y_ts.\n    \n    Args:\n        y_ts (np.ndarray): The target time series (the \"effect\").\n        x_ts (np.ndarray): The source time series (the \"cause\").\n        k (int): The lag order.\n        alpha (float): The significance level.\n        \n    Returns:\n        bool: True if x_ts Granger-causes y_ts, False otherwise.\n    \"\"\"\n    T = len(y_ts)\n    n_obs = T - k\n    \n    # Target variable for regression\n    y_target = y_ts[k:]\n\n    # --- Restricted Model (lags of y only) ---\n    X_res = np.ones((n_obs, 1 + k))\n    for i in range(k):\n        X_res[:, i + 1] = y_ts[k-(i+1) : T-(i+1)]\n    \n    _, ssr_res, _, _ = np.linalg.lstsq(X_res, y_target, rcond=None)\n    ssr_res = ssr_res[0] if isinstance(ssr_res, np.ndarray) and ssr_res.size > 0 else 0\n\n    # --- Unrestricted Model (lags of y and x) ---\n    X_unres = np.ones((n_obs, 1 + 2 * k))\n    X_unres[:, :1+k] = X_res\n    for i in range(k):\n        X_unres[:, 1 + k + i] = x_ts[k-(i+1) : T-(i+1)]\n        \n    _, ssr_unres, _, _ = np.linalg.lstsq(X_unres, y_target, rcond=None)\n    ssr_unres = ssr_unres[0] if isinstance(ssr_unres, np.ndarray) and ssr_unres.size > 0 else 0\n    \n    # --- F-test ---\n    # Number of restrictions\n    q = k \n    # Number of parameters in unrestricted model\n    p_unres = 1 + 2 * k\n    \n    # Degrees of freedom for the F-statistic\n    df_num = q\n    df_den = n_obs - p_unres\n    \n    if df_den = 0:\n        # Not enough data to perform the test\n        return False\n\n    # Avoid division by zero if SSR_unres is zero (perfect fit)\n    if ssr_unres  1e-9:\n        # If unrestricted model is a perfect fit and restricted is not,\n        # it implies a very strong causal link.\n        return ssr_res > 1e-9\n    \n    f_stat = ((ssr_res - ssr_unres) / df_num) / (ssr_unres / df_den)\n    \n    # Critical value from F-distribution\n    f_crit = f_dist.ppf(1 - alpha, dfn=df_num, dfd=df_den)\n    \n    return f_stat > f_crit\n\nsolve()\n\n```", "id": "2841109"}]}