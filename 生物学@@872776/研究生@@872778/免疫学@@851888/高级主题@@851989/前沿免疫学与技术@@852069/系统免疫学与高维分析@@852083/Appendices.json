{"hands_on_practices": [{"introduction": "系统免疫学研究的成功在很大程度上取决于严谨的实验设计。在规划高通量实验（如单细胞测序）时，一个基本问题是如何确定足够的样本量以确保能够检测到我们感兴趣的稀有细胞群体。本练习将引导你从基本的概率论第一性原理出发，推导出在单细胞实验中检测稀有细胞群所需的最小样本量公式[@problem_id:2892322]，这对于在资源限制下优化实验方案至关重要。", "problem": "一个系统免疫学小组设计了一项单细胞RNA测序 (scRNA-seq) 研究，用以检测一个大的、充分混合的组织中以真实频率 $f \\in (0,1)$ 存在的一种稀有免疫细胞群。该实验将得到恰好 $n$ 个成功分析的单细胞，这些细胞是从组织中独立抽样的，因此适用二项分布模型。如果在这 $n$ 个分析的细胞中至少有一个属于该稀有细胞群，则该小组将认定成功检测到该细胞群。设 $\\alpha \\in (0,1)$ 为预先指定的容错率，即在细胞群以频率 $f$ 存在的情况下，检测失败的可容忍概率。\n\n请仅从基本概率模型——即从一个成功概率为 $f$ 的大群体中独立抽样，其成功次数服从二项分布——出发，推导一个用于计算最小整数样本量 $n^{\\ast}(f,\\alpha)$ 的闭式表达式，该样本量需保证检测到稀有细胞群（即在 $n$ 个分析的细胞中观察到至少一个此类细胞）的概率至少为 $1-\\alpha$。\n\n你的最终答案应该是一个用 $f$ 和 $\\alpha$ 表示 $n^{\\ast}(f,\\alpha)$ 的单一解析表达式。无需进行数值计算或四舍五入。", "solution": "合适的出发点是用于从大群体中进行独立抽样的二项分布模型。定义指示随机变量 $X_{i}$，其中 $i \\in \\{1,\\dots,n\\}$。如果第 $i$ 个分析的细胞属于稀有细胞群体，则 $X_{i}=1$；否则 $X_{i}=0$。在所述假设下，$X_{i}$ 是独立同分布的，且 $\\mathbb{P}(X_{i}=1)=f$ 以及 $\\mathbb{P}(X_{i}=0)=1-f$。在 $n$ 个分析的细胞中，稀有细胞的总数为\n$$\nS_{n} \\equiv \\sum_{i=1}^{n} X_{i} \\sim \\mathrm{Binomial}(n,f).\n$$\n检测到该群体的事件对应于观察到至少一个稀有细胞，即事件 $\\{S_{n} \\ge 1\\}$。其概率为\n$$\n\\mathbb{P}(S_{n} \\ge 1) \\;=\\; 1 - \\mathbb{P}(S_{n} = 0) \\;=\\; 1 - (1-f)^{n},\n$$\n其中最后的等式成立是因为根据独立性有 $\\mathbb{P}(S_{n}=0)=\\mathbb{P}(X_{1}=0,\\dots,X_{n}=0)=(1-f)^{n}$。\n\n我们要求这个检测概率至少为 $1-\\alpha$，即\n$$\n1 - (1-f)^{n} \\;\\ge\\; 1 - \\alpha.\n$$\n重新整理可得\n$$\n(1-f)^{n} \\;\\le\\; \\alpha,\n$$\n其中 $\\alpha \\in (0,1)$ 且 $f \\in (0,1)$。对两边取自然对数，并利用在 $(0,1)$ 上 $\\ln(1-f)  0$ 这一事实，可得\n$$\nn \\,\\ln(1-f) \\;\\le\\; \\ln(\\alpha).\n$$\n由于 $\\ln(1-f)  0$，用 $\\ln(1-f)$ 除以两边会使不等号反向：\n$$\nn \\;\\ge\\; \\frac{\\ln(\\alpha)}{\\ln(1-f)}.\n$$\n因此，满足该不等式的最小整数 $n^{\\ast}(f,\\alpha)$ 可通过对结果上取整得到：\n$$\nn^{\\ast}(f,\\alpha) \\;=\\; \\left\\lceil \\frac{\\ln(\\alpha)}{\\ln(1-f)} \\right\\rceil.\n$$\n\n这是精确的二项分布结果。为了在 $f$ 值很小的稀有事件情况下获得直观理解，可以注意到近似式 $\\ln(1-f) \\approx -f$，这会得到 $n^{\\ast}(f,\\alpha) \\approx \\left\\lceil \\ln(\\alpha^{-1})/f \\right\\rceil$。但题目所要求的精确表达式是上面给出的那个。", "answer": "$$\\boxed{\\left\\lceil \\frac{\\ln(\\alpha)}{\\ln(1 - f)} \\right\\rceil}$$", "id": "2892322"}, {"introduction": "流式细胞术（Flow Cytometry）是免疫学中用于多参数单细胞分析的基石技术，但其数据质量严重依赖于精确的荧光补偿。本练习探讨了当荧光补偿不完美时，信号溢出误差如何传播并导致假阳性的共表达结果[@problem_id:2892450]。通过对误差传播进行建模，你将学习如何量化这些技术伪影，并推导出一个校正程序，这对于确保高维细胞数据的分析结论的可靠性至关重要。", "problem": "一项双参数流式细胞术实验测量单个细胞上的两种标记物，使用索引为 $1$ 和 $2$ 的通道测量两种荧光团。假设存在线性光学混合，其溢出矩阵 $S$ 为一个 $2 \\times 2$ 矩阵，对角线元素为1，非对角线溢出 $s_{12}$ 和 $s_{21}$ 很小，因此原始观测强度满足 $y = S x + \\eta$。其中，$x \\in \\mathbb{R}^{2}$ 是单个细胞的真实标记物强度向量，$y \\in \\mathbb{R}^{2}$ 是测量强度向量，而 $\\eta \\sim \\mathcal{N}(0, \\sigma^{2} I_{2})$ 表示每个通道中独立的、方差为 $\\sigma^{2}$ 的高斯测量噪声。软件补偿使用一个估计的溢出矩阵 $\\hat{S}$ 的逆来产生 $\\hat{x} = \\hat{S}^{-1} y$，其中 $\\hat{S}$ 的对角线元素为1，非对角线元素为 $\\hat{s}_{12}$ 和 $\\hat{s}_{21}$。定义估计误差为 $\\epsilon_{12} = \\hat{s}_{12} - s_{12}$ 和 $\\epsilon_{21} = \\hat{s}_{21} - s_{21}$。假设 $|s_{12}|, |s_{21}|, |\\epsilon_{12}|, |\\epsilon_{21}| \\ll 1$。\n\n考虑一个同质的单阳性细胞群，其真实强度为 $x = (\\mu, 0)^{\\top}$，其中 $\\mu  0$ 为某个固定值。如果两个补偿后的强度都超过一个共同的门控阈值 $\\tau  0$，即 $\\hat{x}_{1} \\ge \\tau$ 且 $\\hat{x}_{2} \\ge \\tau$，则称细胞为共表达。假设 $\\mu \\gg \\tau$，因此 $P(\\hat{x}_{1} \\ge \\tau) \\approx 1$，并且该细胞群中假性共表达的主要贡献来自于事件 $\\hat{x}_{2} \\ge \\tau$。\n\n仅使用线性混合模型、关于 $s_{12}, s_{21}, \\epsilon_{12}, \\epsilon_{21}$ 的一阶近似以及高斯随机变量的标准性质，完成以下任务：\n\n1. 对于一个真实强度为 $x = (\\mu, 0)^{\\top}$ 的细胞，推导补偿后强度 $\\hat{x}_{2}$ 的近似均值和方差，精确到 $s_{12}, s_{21}, \\epsilon_{12}, \\epsilon_{21}$ 的一阶。\n\n2. 使用您的结果和标准正态分布的累积分布函数 $\\Phi$，推导假性共表达概率的解析近似式 $p_{\\mathrm{fp}}(\\mu, \\tau, s_{12}, s_{21}, \\epsilon_{12}, \\epsilon_{21}, \\sigma) \\approx P(\\hat{x}_{2} \\ge \\tau)$。\n\n3. 提出一个校正程序，通过调整通道2上的门控来实现目标假性共表达概率 $\\alpha \\in (0, 1)$。设调整后的门控为 $\\tau' = \\tau + \\Delta$。推导所需门控偏移 $\\Delta^{\\ast}(\\alpha)$ 的闭式符号表达式，该表达式应使用 $\\mu, \\tau, s_{12}, s_{21}, \\epsilon_{12}, \\epsilon_{21}, \\sigma$ 以及标准正态分布的分位数函数 $\\Phi^{-1}$ 表示。将您的最终答案表示为 $\\Delta^{\\ast}(\\alpha)$ 的单个符号表达式。\n\n无需进行数值评估；请提供精确的符号表达式。最终答案必须是 $\\Delta^{\\ast}(\\alpha)$ 的单个解析表达式，不带单位。", "solution": "补偿后的强度向量 $\\hat{x}$ 由下式给出：\n$$ \\hat{x} = \\hat{S}^{-1} y = \\hat{S}^{-1} (S x + \\eta) $$\n我们必须首先计算乘积 $\\hat{S}^{-1}S$ 和变换后的噪声项 $\\hat{S}^{-1}\\eta$，精确到小参数 $s_{12}, s_{21}, \\epsilon_{12}, \\epsilon_{21}$ 的一阶。\n\n估计的溢出矩阵 $\\hat{S}$ 的逆是：\n$$ \\hat{S}^{-1} = \\frac{1}{1 - \\hat{s}_{12}\\hat{s}_{21}} \\begin{pmatrix} 1  -\\hat{s}_{12} \\\\ -\\hat{s}_{21}  1 \\end{pmatrix} $$\n由于 $|\\hat{s}_{12}|$ 和 $|\\hat{s}_{21}|$ 很小，乘积 $\\hat{s}_{12}\\hat{s}_{21}$ 是一个二阶项。对于小的 $z$，使用近似式 $(1 - z)^{-1} \\approx 1 + z$，我们有 $\\frac{1}{1 - \\hat{s}_{12}\\hat{s}_{21}} \\approx 1$。因此，一阶近似为：\n$$ \\hat{S}^{-1} \\approx \\begin{pmatrix} 1  -\\hat{s}_{12} \\\\ -\\hat{s}_{21}  1 \\end{pmatrix} $$\n现在我们计算乘积 $\\hat{S}^{-1}S$：\n$$ \\hat{S}^{-1}S \\approx \\begin{pmatrix} 1  -\\hat{s}_{12} \\\\ -\\hat{s}_{21}  1 \\end{pmatrix} \\begin{pmatrix} 1  s_{12} \\\\ s_{21}  1 \\end{pmatrix} = \\begin{pmatrix} 1 - \\hat{s}_{12}s_{21}  s_{12} - \\hat{s}_{12} \\\\ s_{21} - \\hat{s}_{21}  1 - \\hat{s}_{21}s_{12} \\end{pmatrix} $$\n使用误差的定义 $\\epsilon_{12} = \\hat{s}_{12} - s_{12}$ 和 $\\epsilon_{21} = \\hat{s}_{21} - s_{21}$，我们将它们代入矩阵中：\n$$ \\hat{S}^{-1}S \\approx \\begin{pmatrix} 1 - (s_{12}+\\epsilon_{12})s_{21}  -\\epsilon_{12} \\\\ -\\epsilon_{21}  1 - (s_{21}+\\epsilon_{21})s_{12} \\end{pmatrix} $$\n舍去所有二阶项（如 $s_{12}s_{21}$、$\\epsilon_{12}s_{21}$ 等小参数的乘积），我们得到一阶近似：\n$$ \\hat{S}^{-1}S \\approx \\begin{pmatrix} 1  -\\epsilon_{12} \\\\ -\\epsilon_{21}  1 \\end{pmatrix} $$\n补偿后强度的表达式变为：\n$$ \\hat{x} \\approx \\begin{pmatrix} 1  -\\epsilon_{12} \\\\ -\\epsilon_{21}  1 \\end{pmatrix} x + \\hat{S}^{-1}\\eta $$\n对于给定的单阳性细胞群，$x = (\\mu, 0)^{\\top}$：\n$$ \\hat{x} \\approx \\begin{pmatrix} 1  -\\epsilon_{12} \\\\ -\\epsilon_{21}  1 \\end{pmatrix} \\begin{pmatrix} \\mu \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 1  -\\hat{s}_{12} \\\\ -\\hat{s}_{21}  1 \\end{pmatrix} \\begin{pmatrix} \\eta_1 \\\\ \\eta_2 \\end{pmatrix} = \\begin{pmatrix} \\mu \\\\ -\\epsilon_{21}\\mu \\end{pmatrix} + \\begin{pmatrix} \\eta_1 - \\hat{s}_{12}\\eta_2 \\\\ -\\hat{s}_{21}\\eta_1 + \\eta_2 \\end{pmatrix} $$\n我们关注通道2中的补偿后强度 $\\hat{x}_2$：\n$$ \\hat{x}_2 \\approx -\\epsilon_{21}\\mu - \\hat{s}_{21}\\eta_1 + \\eta_2 $$\n\n**1. $\\hat{x}_2$ 的均值和方差**\n噪声分量 $\\eta_1$ 和 $\\eta_2$ 的均值为零，即 $E[\\eta_1] = E[\\eta_2] = 0$。$\\hat{x}_2$ 的期望值为：\n$$ E[\\hat{x}_2] \\approx E[-\\epsilon_{21}\\mu - \\hat{s}_{21}\\eta_1 + \\eta_2] = -\\epsilon_{21}\\mu - \\hat{s}_{21}E[\\eta_1] + E[\\eta_2] = -\\epsilon_{21}\\mu $$\n$\\hat{x}_2$ 的方差是利用 $\\eta_1$ 和 $\\eta_2$ 的独立性计算的，其中 $\\mathrm{Var}(\\eta_1) = \\mathrm{Var}(\\eta_2) = \\sigma^2$。项 $-\\epsilon_{21}\\mu$ 是一个常数，不影响方差。\n$$ \\mathrm{Var}(\\hat{x}_2) \\approx \\mathrm{Var}(-\\hat{s}_{21}\\eta_1 + \\eta_2) = (-\\hat{s}_{21})^2 \\mathrm{Var}(\\eta_1) + (1)^2 \\mathrm{Var}(\\eta_2) = \\hat{s}_{21}^2 \\sigma^2 + \\sigma^2 = \\sigma^2(1 + \\hat{s}_{21}^2) $$\n由于 $|\\hat{s}_{21}|$ 很小，$\\hat{s}_{21}^2$ 是一个二阶项，可以忽略不计。因此，一阶近似的方差为：\n$$ \\mathrm{Var}(\\hat{x}_2) \\approx \\sigma^2 $$\n由于 $\\hat{x}_2$ 是高斯随机变量的线性组合，它本身也是高斯分布的。因此，$\\hat{x}_2$ 的近似分布为：\n$$ \\hat{x}_2 \\sim \\mathcal{N}(-\\epsilon_{21}\\mu, \\sigma^2) $$\n\n**2. 假性共表达概率**\n假阳性概率 $p_{\\mathrm{fp}}$ 近似为 $P(\\hat{x}_2 \\ge \\tau)$。为计算此概率，我们对随机变量 $\\hat{x}_2$ 进行标准化：\n$$ Z = \\frac{\\hat{x}_2 - E[\\hat{x}_2]}{\\sqrt{\\mathrm{Var}(\\hat{x}_2)}} = \\frac{\\hat{x}_2 - (-\\epsilon_{21}\\mu)}{\\sigma} \\sim \\mathcal{N}(0, 1) $$\n该概率可以用标准正态变量 $Z$ 表示：\n$$ P(\\hat{x}_2 \\ge \\tau) = P\\left(\\frac{\\hat{x}_2 + \\epsilon_{21}\\mu}{\\sigma} \\ge \\frac{\\tau + \\epsilon_{21}\\mu}{\\sigma}\\right) = P\\left(Z \\ge \\frac{\\tau + \\epsilon_{21}\\mu}{\\sigma}\\right) $$\n使用标准正态累积分布函数 $\\Phi(z) = P(Z \\le z)$，我们知道 $P(Z \\ge a) = 1 - \\Phi(a)$。因此：\n$$ p_{\\mathrm{fp}}(\\mu, \\tau, s_{12}, s_{21}, \\epsilon_{12}, \\epsilon_{21}, \\sigma) \\approx 1 - \\Phi\\left(\\frac{\\tau + \\epsilon_{21}\\mu}{\\sigma}\\right) $$\n\n**3. 门控校正程序**\n我们希望找到一个门控偏移 $\\Delta$，使得使用新门控 $\\tau' = \\tau + \\Delta$ 时，假阳性概率等于目标值 $\\alpha$。设这个特定的偏移为 $\\Delta^{\\ast}(\\alpha)$。条件是：\n$$ P(\\hat{x}_2 \\ge \\tau + \\Delta^{\\ast}(\\alpha)) = \\alpha $$\n使用第2部分的结果，这可以转化为：\n$$ 1 - \\Phi\\left(\\frac{(\\tau + \\Delta^{\\ast}(\\alpha)) + \\epsilon_{21}\\mu}{\\sigma}\\right) = \\alpha $$\n重新整理方程得到：\n$$ \\Phi\\left(\\frac{\\tau + \\Delta^{\\ast}(\\alpha) + \\epsilon_{21}\\mu}{\\sigma}\\right) = 1 - \\alpha $$\n为了解出 $\\Delta^{\\ast}(\\alpha)$，我们应用逆CDF，即分位数函数 $\\Phi^{-1}$：\n$$ \\frac{\\tau + \\Delta^{\\ast}(\\alpha) + \\epsilon_{21}\\mu}{\\sigma} = \\Phi^{-1}(1 - \\alpha) $$\n现在，我们分离出 $\\Delta^{\\ast}(\\alpha)$：\n$$ \\tau + \\Delta^{\\ast}(\\alpha) + \\epsilon_{21}\\mu = \\sigma \\Phi^{-1}(1 - \\alpha) $$\n$$ \\Delta^{\\ast}(\\alpha) = \\sigma \\Phi^{-1}(1 - \\alpha) - \\epsilon_{21}\\mu - \\tau $$\n这就是所需门控偏移的闭式符号表达式。", "answer": "$$\\boxed{\\sigma \\Phi^{-1}(1 - \\alpha) - \\epsilon_{21}\\mu - \\tau}$$", "id": "2892450"}, {"introduction": "系统免疫学的一个核心目标是比较不同生物学条件下（例如，健康与疾病）的细胞状态分布，并推断它们之间的对应关系。本练习将介绍熵正则化最优传输（Entropic-regularized Optimal Transport），这是一种强大的计算方法，用于学习两个细胞群体之间的随机映射[@problem_id:2892437]。通过从拉格朗日分析推导出核心的Sinkhorn算法，你将掌握一个前沿工具的理论基础，该工具被广泛用于在单细胞水平上对齐和比较复杂的生物系统。", "problem": "考虑通过单细胞RNA测序（scRNA-seq）测量的两个细胞群，每个细胞群被概括为一个离散概率分布，该分布作用于由变分自编码器学习到的共同潜在嵌入空间中的粗粒度细胞状态。您希望使用熵正则化最优输运来耦合这些分布，以推断两种条件之间的随机映射，同时考虑到生物随机性，避免过于尖锐的耦合。设源分布为 $a \\in \\mathbb{R}_{+}^{n}$，目标分布为 $b \\in \\mathbb{R}_{+}^{m}$，且满足 $\\sum_{i=1}^{n} a_{i} = 1$ 和 $\\sum_{j=1}^{m} b_{j} = 1$。设 $C \\in \\mathbb{R}^{n \\times m}$ 是一个非负成本矩阵，其源于状态间的转录差异性，并设 $\\varepsilon  0$ 为熵正则化强度。\n\n任务 A (构建)：仅使用概率分布和Kullback–Leibler散度 (KLD) 的核心定义，定义熵正则化最优输运问题，该问题旨在寻找一个耦合矩阵 $\\Pi \\in \\mathbb{R}_{+}^{n \\times m}$，使其在满足边缘分布 $a$ 和 $b$ 的约束下，最小化输运成本与熵惩罚项之和。您的定义必须写成一个关于 $\\Pi$ 的约束优化问题，该问题依赖于 $C$、$a$、$b$ 和 $\\varepsilon$。\n\n任务 B (推导)：从任务 A 中的约束优化问题出发，进行拉格朗日分析，并推导出在严格正值情况下表征唯一最优解的不动点缩放方程。证明最优耦合允许分解为 $\\Pi^{\\star} = \\operatorname{diag}(u)\\,K\\,\\operatorname{diag}(v)$ 的形式，其中吉布斯核 $K$ 由 $C$ 和 $\\varepsilon$ 决定，并为强制满足边缘约束的缩放向量 $u \\in \\mathbb{R}_{+}^{n}$ 和 $v \\in \\mathbb{R}_{+}^{m}$ 推导出迭代更新方程。除了正性和可行性之外，不要对 $a$、$b$ 或 $C$ 作任何特定形式的假设。\n\n任务 C (计算)：现在将问题具体化到一个最小的免疫学场景，其中 $n = m = 2$ 个粗粒度状态分别代表两种条件下静息和活化的T细胞表型。假设\n$$\na = \\begin{pmatrix} 0.6 \\\\ 0.4 \\end{pmatrix}, \n\\quad\nb = \\begin{pmatrix} 0.5 \\\\ 0.5 \\end{pmatrix},\n\\quad\nC = \\begin{pmatrix} 0  \\ln(2) \\\\ \\ln(2)  0 \\end{pmatrix},\n\\quad\n\\varepsilon = 1.\n$$\n利用您推导出的缩放更新迭代至收敛，计算通过任务A和B中的熵正则化最优输运得到的最优耦合 $\\,\\Pi^{\\star}\\,$ 的 $(1,2)$ 元素。将您的最终数值答案四舍五入到四位有效数字。只给出数值，不带单位。", "solution": "**任务 A：构建**\n\n经典最优输运问题旨在最小化总输运成本 $\\langle C, \\Pi \\rangle = \\sum_{i,j} C_{ij} \\Pi_{ij}$，并满足边缘约束。熵正则化向该目标函数引入一个惩罚项，以鼓励更平滑、非确定性更强的耦合。正则化问题可以使用Kullback-Leibler (KL) 散度进行优雅地构建。\n\n令 $U(a,b)$ 表示输运多胞体，它是所有满足边缘约束的矩阵 $\\Pi \\in \\mathbb{R}_{+}^{n \\times m}$ 的集合：\n$$\nU(a,b) = \\left\\{ \\Pi \\in \\mathbb{R}_{+}^{n \\times m} \\mid \\sum_{j=1}^{m} \\Pi_{ij} = a_i, \\forall i; \\quad \\sum_{i=1}^{n} \\Pi_{ij} = b_j, \\forall j \\right\\}\n$$\n熵正则化最优输运问题等价于在 KL 散度的意义下，寻找一个耦合 $\\Pi \\in U(a,b)$，使其最接近由成本矩阵 $C$ 和正则化强度 $\\varepsilon$ 定义的吉布斯核矩阵 $K \\in \\mathbb{R}_{+}^{n \\times m}$。吉布斯核定义为：\n$$\nK_{ij} = \\exp\\left(-\\frac{C_{ij}}{\\varepsilon}\\right)\n$$\n两个离散分布 $P$ 和 $Q$ 之间的 KL 散度为 $\\text{KL}(P || Q) = \\sum_{k} P_k \\ln(P_k/Q_k)$。将其应用于矩阵，问题就变成了最小化 $\\text{KL}(\\Pi || K)$。\n\n因此，约束优化问题为：\n$$\n\\min_{\\Pi \\in U(a,b)} \\text{KL}(\\Pi || K) = \\min_{\\Pi \\in U(a,b)} \\sum_{i=1}^{n} \\sum_{j=1}^{m} \\Pi_{ij} \\ln\\left(\\frac{\\Pi_{ij}}{K_{ij}}\\right)\n$$\n展开此目标函数揭示了其与输运成本和熵的联系：\n$$\n\\sum_{i,j} \\Pi_{ij} \\ln\\left(\\frac{\\Pi_{ij}}{K_{ij}}\\right) = \\sum_{i,j} \\Pi_{ij} \\ln(\\Pi_{ij}) - \\sum_{i,j} \\Pi_{ij} \\ln(K_{ij}) = \\sum_{i,j} \\Pi_{ij} \\ln(\\Pi_{ij}) + \\frac{1}{\\varepsilon} \\sum_{i,j} C_{ij} \\Pi_{ij}\n$$\n最小化此式等价于最小化 $\\frac{1}{\\varepsilon}\\langle C, \\Pi \\rangle + \\sum_{i,j} \\Pi_{ij} \\ln(\\Pi_{ij})$，即缩放后的输运成本和一个负熵项之和，这与问题描述中的“输运成本与熵惩罚项之和”一致。\n\n**任务 B：推导**\n\n我们通过使用拉格朗日乘子分析任务 A 中的优化问题，来推导最优耦合 $\\Pi^{\\star}$ 的结构。目标函数是 $J(\\Pi) = \\text{KL}(\\Pi || K)$。约束条件是边缘分布 $\\sum_{j} \\Pi_{ij} = a_i$ 和 $\\sum_{i} \\Pi_{ij} = b_j$。设 $f_i \\in \\mathbb{R}$ 和 $g_j \\in \\mathbb{R}$ 分别是与源边缘分布和目标边缘分布相关的拉格朗日乘子。拉格朗日函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(\\Pi, f, g) = \\sum_{i,j} \\Pi_{ij} \\ln\\left(\\frac{\\Pi_{ij}}{K_{ij}}\\right) - \\sum_{i=1}^{n} f_i \\left(\\sum_{j=1}^{m} \\Pi_{ij} - a_i\\right) - \\sum_{j=1}^{m} g_j \\left(\\sum_{i=1}^{n} \\Pi_{ij} - b_j\\right)\n$$\n通过将 $\\mathcal{L}$ 关于 $\\Pi_{ij}$ 的偏导数设为零，可以找到最优性条件。非负性约束 $\\Pi_{ij} \\ge 0$ 已被对数函数的定义域隐式满足。\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\Pi_{ij}} = \\ln\\left(\\frac{\\Pi_{ij}}{K_{ij}}\\right) + 1 - f_i - g_j = 0\n$$\n求解 $\\Pi_{ij}$：\n$$\n\\ln\\left(\\frac{\\Pi_{ij}}{K_{ij}}\\right) = f_i + g_j - 1 \\implies \\frac{\\Pi_{ij}}{K_{ij}} = \\exp(f_i + g_j - 1)\n$$\n$$\n\\Pi_{ij} = K_{ij} \\exp(f_i-1) \\exp(g_j)\n$$\n常数 $\\exp(-1)$ 如何分配是任意的。为了对称性，我们可以写作 $\\Pi_{ij} = K_{ij} \\exp(f_i-1/2) \\exp(g_j-1/2)$。我们定义两个缩放向量 $u \\in \\mathbb{R}_{+}^{n}$ 和 $v \\in \\mathbb{R}_{+}^{m}$ 如下：\n$$\nu_i = \\exp(f_i - 1/2) \\quad \\text{和} \\quad v_j = \\exp(g_j - 1/2)\n$$\n因此，最优耦合 $\\Pi^{\\star}$ 必须具有以下结构：\n$$\n\\Pi^{\\star}_{ij} = u_i K_{ij} v_j\n$$\n这等价于矩阵形式 $\\Pi^{\\star} = \\operatorname{diag}(u)\\,K\\,\\operatorname{diag}(v)$，其中 $\\operatorname{diag}(u)$ 和 $\\operatorname{diag}(v)$ 是对角矩阵，其对角线元素分别为 $u$ 和 $v$ 的元素。\n\n缩放向量 $u$ 和 $v$ 是通过对 $\\Pi^{\\star}$ 的这种形式强制施加边缘约束来确定的：\n1.  源边缘约束：$\\sum_{j=1}^{m} \\Pi^{\\star}_{ij} = a_i$\n$$\n\\sum_{j=1}^{m} u_i K_{ij} v_j = a_i \\implies u_i \\left( \\sum_{j=1}^{m} K_{ij} v_j \\right) = a_i \\implies u_i = \\frac{a_i}{\\sum_{j=1}^{m} K_{ij} v_j}\n$$\n用向量符号表示，即为 $u = a \\oslash (Kv)$，其中 $\\oslash$ 表示逐元素除法。\n2.  目标边缘约束：$\\sum_{i=1}^{n} \\Pi^{\\star}_{ij} = b_j$\n$$\n\\sum_{i=1}^{n} u_i K_{ij} v_j = b_j \\implies v_j \\left( \\sum_{i=1}^{n} u_i K_{ij} \\right) = b_j \\implies v_j = \\frac{b_j}{\\sum_{i=1}^{n} K_{ij} u_i}\n$$\n用向量符号表示，即为 $v = b \\oslash (K^T u)$。\n\n这两个耦合方程定义了缩放向量。它们可以使用 Sinkhorn 算法进行迭代求解。从一个初始猜测值开始，通常是 $v^{(0)} = \\mathbf{1}_m$（一个全为1的向量），对 $k \\ge 1$ 迭代以下更新直至收敛：\n$$\nu^{(k)} = a \\oslash (K v^{(k-1)})\n$$\n$$\nv^{(k)} = b \\oslash (K^T u^{(k)})\n$$\n\n**任务 C：计算**\n\n给定 $n=m=2$，$\\varepsilon=1$，以及：\n$$\na = \\begin{pmatrix} 0.6 \\\\ 0.4 \\end{pmatrix}, \\quad b = \\begin{pmatrix} 0.5 \\\\ 0.5 \\end{pmatrix}, \\quad C = \\begin{pmatrix} 0  \\ln(2) \\\\ \\ln(2)  0 \\end{pmatrix}\n$$\n首先，我们计算吉布斯核 $K = \\exp(-C/\\varepsilon) = \\exp(-C)$：\n$$\nK_{11} = \\exp(-0) = 1\n$$\n$$\nK_{12} = \\exp(-\\ln(2)) = \\frac{1}{2} = 0.5\n$$\n$$\nK_{21} = \\exp(-\\ln(2)) = \\frac{1}{2} = 0.5\n$$\n$$\nK_{22} = \\exp(-0) = 1\n$$\n所以，核矩阵为 $K = \\begin{pmatrix} 1  0.5 \\\\ 0.5  1 \\end{pmatrix}$。\n\n接下来，我们应用 Sinkhorn 迭代更新。我们初始化 $v^{(0)} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n\n**迭代 $k=1$**：\n- 更新 $u$：\n$u_1^{(1)} = \\frac{a_1}{K_{11} v_1^{(0)} + K_{12} v_2^{(0)}} = \\frac{0.6}{1(1) + 0.5(1)} = \\frac{0.6}{1.5} = 0.4$\n$u_2^{(1)} = \\frac{a_2}{K_{21} v_1^{(0)} + K_{22} v_2^{(0)}} = \\frac{0.4}{0.5(1) + 1(1)} = \\frac{0.4}{1.5} = \\frac{4}{15} \\approx 0.266667$\n- 更新 $v$：\n$v_1^{(1)} = \\frac{b_1}{K_{11} u_1^{(1)} + K_{21} u_2^{(1)}} = \\frac{0.5}{1(0.4) + 0.5(4/15)} = \\frac{0.5}{0.4 + 2/15} = \\frac{0.5}{8/15} = \\frac{15}{16} = 0.9375$\n$v_2^{(1)} = \\frac{b_2}{K_{12} u_1^{(1)} + K_{22} u_2^{(1)}} = \\frac{0.5}{0.5(0.4) + 1(4/15)} = \\frac{0.5}{0.2 + 4/15} = \\frac{0.5}{7/15} = \\frac{15}{14} \\approx 1.071429$\n\n**迭代 $k=2$**：\n- 更新 $u$：\n$u_1^{(2)} = \\frac{0.6}{1(15/16) + 0.5(15/14)} = \\frac{0.6}{15/16 + 15/28} \\approx 0.407273$\n$u_2^{(2)} = \\frac{0.4}{0.5(15/16) + 1(15/14)} = \\frac{0.4}{15/32 + 15/14} \\approx 0.259710$\n- 更新 $v$：\n$v_1^{(2)} = \\frac{0.5}{1(0.407273) + 0.5(0.259710)} \\approx 0.930870$\n$v_2^{(2)} = \\frac{0.5}{0.5(0.407273) + 1(0.259710)} \\approx 1.079137$\n\n继续此过程直至收敛（前5-6位小数稳定）：\n$k=3: u^{(3)} \\approx \\begin{pmatrix} 0.408284 \\\\ 0.258828 \\end{pmatrix}, v^{(3)} \\approx \\begin{pmatrix} 0.930066 \\\\ 1.079822 \\end{pmatrix}$\n$k=4: u^{(4)} \\approx \\begin{pmatrix} 0.408401 \\\\ 0.258728 \\end{pmatrix}, v^{(4)} \\approx \\begin{pmatrix} 0.929986 \\\\ 1.079901 \\end{pmatrix}$\n$k=5: u^{(5)} \\approx \\begin{pmatrix} 0.408415 \\\\ 0.258716 \\end{pmatrix}, v^{(5)} \\approx \\begin{pmatrix} 0.929978 \\\\ 1.079910 \\end{pmatrix}$\n$k=6: u^{(6)} \\approx \\begin{pmatrix} 0.408417 \\\\ 0.258714 \\end{pmatrix}, v^{(6)} \\approx \\begin{pmatrix} 0.929977 \\\\ 1.079911 \\end{pmatrix}$\n数值已充分收敛。设收敛后的缩放向量为 $u^{\\star} \\approx \\begin{pmatrix} 0.408417 \\\\ 0.258714 \\end{pmatrix}$ 和 $v^{\\star} \\approx \\begin{pmatrix} 0.929977 \\\\ 1.079911 \\end{pmatrix}$。\n\n任务是计算最优耦合矩阵的 $(1,2)$ 元素 $\\Pi^{\\star}_{12}$。\n$$\n\\Pi^{\\star}_{12} = u^{\\star}_1 K_{12} v^{\\star}_2\n$$\n代入收敛值和 $K_{12}=0.5$：\n$$\n\\Pi^{\\star}_{12} \\approx (0.408417) \\times (0.5) \\times (1.079911)\n$$\n$$\n\\Pi^{\\star}_{12} \\approx 0.22052825\n$$\n四舍五入到四位有效数字，我们得到 $0.2205$。", "answer": "$$\\boxed{0.2205}$$", "id": "2892437"}]}