{"hands_on_practices": [{"introduction": "MHC基因座的高度多态性并非随机分布在其编码的蛋白质上，而是集中在对功能至关重要的特定区域。这项练习旨在通过将氨基酸变异定位到MHC I类分子的特定结构域，来巩固对结构与功能之间关系的理解。通过这项实践，你将学会如何基于第一性原理，预测哪些突变最有可能改变肽结合沟的特性，从而影响抗原呈递 [@problem_id:2899461]。", "problem": "一位研究人员正在分析人类白细胞抗原 (HLA) I 类重链基因 HLA-A 内的多态性，重点研究特定的错义变体可能如何改变肽呈递。请使用以下核心定义和事实作为您推理的基础：(i) I 类主要组织相容性复合体 (MHC) 分子包含一条与 $\\beta_2$-微球蛋白非共价结合的多态性重链；(ii) HLA-A 重链具有三个胞外域（$\\alpha_1$、$\\alpha_2$ 和 $\\alpha_3$），其后是一个跨膜片段和一个胞质尾；(iii) 肽结合槽由 $\\alpha_1$ 和 $\\alpha_2$ 域形成，由一个 $\\beta$-折叠片底板和两个 $\\alpha$-螺旋壁构成，可容纳长度约 $8$–$10$ 个氨基酸的肽；(iv) 大多数改变肽结合特异性的功能性多态性聚集在构成 $\\alpha_1$ 和 $\\alpha_2$ 域内肽结合槽的残基中。为了进行结构域分配，假设成熟重链的经典残基边界如下：$\\alpha_1$ 是残基 $25$–$114$，$\\alpha_2$ 是残基 $115$–$206$，$\\alpha_3$ 是残基 $207$–$297$，跨膜片段是残基 $298$–$336$，胞质尾是残基 $337$–$365$。\n\n给定以下 HLA-A 中的错义变体（氨基酸单字母代码、位置编号和变体）：\n- K66N, Y74C, D77N, T80A, Y116F, Q152E, E156K, K146N, W147R, M228T, W253R, L290P, I314T, S343P.\n\n任务：\n- 首先，使用给定的边界按结构域对每个变体进行分类。\n- 然后，基于 MHC I 类结构-功能关系的第一性原理，预测这些变体中的哪个子集最有可能改变肽结合槽。\n\n哪个选项最能概括最有可能改变肽结合槽的变体集？\n\nA. K66N, Y74C, D77N, T80A, Y116F, Q152E, E156K\n\nB. K146N, W147R, Y116F, Q152E\n\nC. M228T, W253R, L290P\n\nD. I314T, S343P\n\nE. K66N, D77N, L290P", "solution": "问题陈述具有科学依据、提法得当且客观。它提供了一套清晰的定义和一个基于免疫学和蛋白质结构既定原则的可验证任务。所有必要信息均已提供，且没有内部矛盾。因此，该问题是有效的，可以推导出解决方案。\n\n中心任务是预测哪些错义变体最有可能改变 HLA-A 分子的肽结合槽。问题为这一判断提供了基本原则：\n$1$. I 类主要组织相容性复合体 (MHC) 分子的肽结合槽由重链的 $\\alpha_1$ 和 $\\alpha_2$ 域形成。\n$2$. 因此，改变肽结合特异性的多态性主要位于这两个域内。\n\n问题提供了成熟重链每个结构域的精确残基边界：\n- $\\alpha_1$ 域：残基 $25$–$114$\n- $\\alpha_2$ 域：残基 $115$–$206$\n- $\\alpha_3$ 域：残基 $207$–$297$\n- 跨膜片段：残基 $298$–$336$\n- 胞质尾：残基 $337$–$365$\n\n逻辑步骤是首先根据每个给定变体的位置编号将其分类到各自的结构域中，然后选择落在 $\\alpha_1$ 和 $\\alpha_2$ 域内的变体集合。\n\n以下是每个变体的分类：\n- K66N：位置 $66$ 在范围 [$25$, $114$] 内。此变体位于 $\\alpha_1$ 域。\n- Y74C：位置 $74$ 在范围 [$25$, $114$] 内。此变体位于 $\\alpha_1$ 域。\n- D77N：位置 $77$ 在范围 [$25$, $114$] 内。此变体位于 $\\alpha_1$ 域。\n- T80A：位置 $80$ 在范围 [$25$, $114$] 内。此变体位于 $\\alpha_1$ 域。\n- Y116F：位置 $116$ 在范围 [$115$, $206$] 内。此变体位于 $\\alpha_2$ 域。\n- Q152E：位置 $152$ 在范围 [$115$, $206$] 内。此变体位于 $\\alpha_2$ 域。\n- E156K：位置 $156$ 在范围 [$115$, $206$] 内。此变体位于 $\\alpha_2$ 域。\n- K146N：位置 $146$ 在范围 [$115$, $206$] 内。此变体位于 $\\alpha_2$ 域。\n- W147R：位置 $147$ 在范围 [$115$, $206$] 内。此变体位于 $\\alpha_2$ 域。\n- M228T：位置 $228$ 在范围 [$207$, $297$] 内。此变体位于 $\\alpha_3$ 域。\n- W253R：位置 $253$ 在范围 [$207$, $297$] 内。此变体位于 $\\alpha_3$ 域。\n- L290P：位置 $290$ 在范围 [$207$, $297$] 内。此变体位于 $\\alpha_3$ 域。\n- I314T：位置 $314$ 在范围 [$298$, $336$] 内。此变体位于跨膜片段。\n- S343P：位置 $343$ 在范围 [$337$, $365$] 内。此变体位于胞质尾。\n\n基于此分类，位于肽结合槽域（$\\alpha_1$ 和 $\\alpha_2$）的完整变体集是：\n{K66N, Y74C, D77N, T80A, Y116F, Q152E, E156K, K146N, W147R}。\n\n现在，我们对照这个推导出的集合来评估每个选项。\n\nA. K66N, Y74C, D77N, T80A, Y116F, Q152E, E156K\n此选项中的所有变体都位于 $\\alpha_1$ 域（K66N, Y74C, D77N, T80A）或 $\\alpha_2$ 域（Y116F, Q152E, E156K）。此选项正确地识别了构成肽结合槽的变体的一个大子集（$9$ 个中的 $7$ 个）。它不包含任何来自这些域之外的变体。尽管这个集合不完整（它省略了 $\\alpha_2$ 域的 K146N 和 W147R），但它是选项中最全面和最准确的。\n结论：**正确**\n\nB. K146N, W147R, Y116F, Q152E\n此选项中的所有变体都位于 $\\alpha_2$ 域。这是一个可以改变肽结合槽的正确的变体子集。然而，与选项 A 相比，它的完整性要差得多，因为它省略了所有四个来自 $\\alpha_1$ 域的变体，以及选项 A 中列出的另外三个来自 $\\alpha_2$ 域的变体。\n结论：**不正确**。虽然其组成在事实上是正确的，但与选项 A 相比，它没有“最能概括”该集合。\n\nC. M228T, W253R, L290P\n此选项中的所有变体（M228T, W253R, L290P）都位于 $\\alpha_3$ 域。$\\alpha_3$ 域与 CD8 和 $\\beta_2$-微球蛋白相互作用，但不形成肽结合槽。因此，这些变体不是最有可能直接改变肽呈递的。\n结论：**不正确**\n\nD. I314T, S343P\n变体 I314T 位于跨膜片段中，S343P 位于胞质尾中。这两个部分都不是胞外肽结合结构的一部分。这些变体将影响膜锚定或胞内信号传导，而非肽结合。\n结论：**不正确**\n\nE. K66N, D77N, L290P\n此选项包含混合的变体。K66N 和 D77N 被正确地识别为位于 $\\alpha_1$ 域。然而，L290P 位于 $\\alpha_3$ 域。包含了一个位于肽结合槽域之外的变体使得这个选项不正确。\n结论：**不正确**\n\n总之，选项 A 是唯一一个只包含来自 $\\alpha_1$ 和 $\\alpha_2$ 域的变体的选项，并且是所提供的最广泛的此类列表。因此，它是最佳答案。", "answer": "$$\\boxed{A}$$", "id": "2899461"}, {"introduction": "理解了多态性在结构上的位置后，下一步是量化其功能优势。MHC杂合性的一个关键优势是能够呈递更广泛的肽谱，从而增强对病原体的免疫应答。这项练习将引导你使用概率论的基本原理，特别是包容-排斥原则，来构建一个模型，以估算MHC杂合性如何扩大了个体所能呈递的独特肽的比例 [@problem_id:2899414]。", "problem": "主要组织相容性复合体（MHC）中编码的人类白细胞抗原（HLA）I类分子向细胞毒性T淋巴细胞呈递胞内肽。考虑一个模型，其中每个不同的HLA I类等位基因以一个很小的概率呈递一个给定的随机肽，该概率反映了其肽结合基序的广度。假设存在$3$个经典的I类基因座（HLA-A、HLA-B、HLA-C），并对从一个巨大的、充分混合的潜在9聚体肽池中随机抽样的一个肽作出如下假设：\n(1) 对于一个在某基因座上为纯合子的个体，该基因座上实际上有$1$个独特的等位基因；对于一个杂合子个体，该基因座上有$2$个不同的等位基因。\n(2) 对于基因座 $\\ell \\in \\{A,B,C\\}$ 上的任何单个等位基因，其呈递该肽的概率为 $p_{\\ell}$。使用 $p_{A} = 0.010$，$p_{B} = 0.015$ 和 $p_{C} = 0.005$。\n(3) 对于同一基因座上的两个不同等位基因，两者都呈递相同肽的概率等于 $\\lambda_{\\mathrm{within}}\\,p_{\\ell}^{2}$，其中 $\\lambda_{\\mathrm{within}} = 1.4$。对于来自不同基因座 $\\ell \\neq m$ 的两个等位基因，两者都呈递相同肽的概率等于 $\\lambda_{\\mathrm{between}}\\,p_{\\ell}\\,p_{m}$，其中 $\\lambda_{\\mathrm{between}} = 1.1$。\n(4) 事件“等位基因 $i$ 呈递该肽”是稀有事件，并且在由 $\\lambda_{\\mathrm{within}}$ 和 $\\lambda_{\\mathrm{between}}$ 捕捉的两两相关性之外近似独立。您可以通过将容斥展开式在 $p_{\\ell}$ 的二阶截断来近似计算至少有一个等位基因呈递该肽的概率。\n\n仅使用概率论的第一性原理（稀有事件并集的容斥原理）和上述假设，计算当基因型从所有$3$个基因座均为完全纯合（HLA-A、HLA-B、HLA-C 各有一个独特等位基因）变为所有$3$个基因座均为完全杂合（每个基因座有两个不同等位基因）时，所呈递的独特肽的期望分数的倍数变化 $\\mathcal{F}$。也就是说，设 $P_{\\mathrm{hom}}$ 为在纯合子情况下，一个随机肽被至少一个等位基因呈递的近似概率，设 $P_{\\mathrm{het}}$ 为在杂合子情况下的相应概率；报告 $\\mathcal{F} = P_{\\mathrm{het}}/P_{\\mathrm{hom}}$。将您的最终答案四舍五入到$4$位有效数字。\n\n在您的推理中，从事件并集的概率定义开始，并证明二阶截断的合理性。解释单个基因座的杂合性如何扩大其基因座水平的呈递概率，以及为什么在跨基因座时，随着更多等位基因的加入，两两重叠会导致收益递减。最终报告的 $\\mathcal{F}$ 必须是如上所述的单个实数。", "solution": "所述问题具有科学依据，是良定且客观的。这是应用概率论中的一个有效练习，模拟了免疫遗传学中的一个基本概念。唯一解所需的所有数据和约束都已提供。因此，我们可以进行推导。\n\n这个问题的核心在于计算事件并集的概率。设 $\\{E_i\\}_{i=1}^N$ 为 $N$ 个事件的集合，其中 $E_i$ 是等位基因 $i$ 呈递给定肽的事件。这些等位基因中至少有一个呈递该肽的概率是它们并集的概率，即 $P(\\cup_{i=1}^N E_i)$。容斥原理（Principle of Inclusion-Exclusion, PIE）为此概率提供了一个精确的公式：\n$$ P\\left(\\bigcup_{i=1}^N E_i\\right) = \\sum_{i=1}^N P(E_i) - \\sum_{1 \\le i  j \\le N} P(E_i \\cap E_j) + \\sum_{1 \\le i  j  k \\le N} P(E_i \\cap E_j \\cap E_k) - \\dots + (-1)^{N-1} P\\left(\\bigcap_{i=1}^N E_i\\right) $$\n问题指明，单个呈递概率 $p_{\\ell}$ 很小，且事件是“稀有”的。这证明了在二阶项处截断PIE级数是合理的。高阶项涉及三个或更多个小概率的乘积（例如 $p_A p_B p_C$），与一阶项（$p_\\ell$）和二阶项（$p_\\ell p_m$）相比可以忽略不计。因此，近似公式为：\n$$ P\\left(\\bigcup_{i=1}^N E_i\\right) \\approx \\sum_{i=1}^N P(E_i) - \\sum_{1 \\le i  j \\le N} P(E_i \\cap E_j) $$\n该近似表明，总概率是个体概率之和，并为避免重复计算而对两两重叠部分进行了修正。\n\n我们必须为两种情况计算这个概率：完全纯合子个体和完全杂合子个体。\n\n情况1：完全纯合子个体 ($P_{\\mathrm{hom}}$)\n一个完全纯合子个体在三个基因座（HLA-A、HLA-B和HLA-C）上各有一个独特的等位基因。我们将这些等位基因表示为 $A_1$、$B_1$ 和 $C_1$。我们关心的事件是 $E_{A_1}$、$E_{B_1}$ 和 $E_{C_1}$。至少有一个等位基因呈递该肽的概率是 $P_{\\mathrm{hom}} = P(E_{A_1} \\cup E_{B_1} \\cup E_{C_1})$。\n\n应用二阶PIE近似：\n$$ P_{\\mathrm{hom}} \\approx P(E_{A_1}) + P(E_{B_1}) + P(E_{C_1}) - \\left( P(E_{A_1} \\cap E_{B_1}) + P(E_{A_1} \\cap E_{C_1}) + P(E_{B_1} \\cap E_{C_1}) \\right) $$\n根据问题陈述：\n- 一阶概率为 $P(E_{A_1}) = p_A$，$P(E_{B_1}) = p_B$ 和 $P(E_{C_1}) = p_C$。\n- 二阶（交集）概率涉及来自不同基因座的等位基因。因此，我们使用基因座间相互作用的规则：\n$P(E_{A_1} \\cap E_{B_1}) = \\lambda_{\\mathrm{between}} p_A p_B$\n$P(E_{A_1} \\cap E_{C_1}) = \\lambda_{\\mathrm{between}} p_A p_C$\n$P(E_{B_1} \\cap E_{C_1}) = \\lambda_{\\mathrm{between}} p_B p_C$\n\n将这些代入 $P_{\\mathrm{hom}}$ 的表达式中：\n$$ P_{\\mathrm{hom}} \\approx (p_A + p_B + p_C) - \\lambda_{\\mathrm{between}}(p_A p_B + p_A p_C + p_B p_C) $$\n\n情况2：完全杂合子个体 ($P_{\\mathrm{het}}$)\n一个完全杂合子个体在每个基因座上有两个不同的等位基因：$\\{A_1, A_2\\}$、$\\{B_1, B_2\\}$ 和 $\\{C_1, C_2\\}$。这总共得到 $N=6$ 个等位基因。至少有一个等位基因呈递该肽的概率是 $P_{\\mathrm{het}} = P(E_{A_1} \\cup E_{A_2} \\cup E_{B_1} \\cup E_{B_2} \\cup E_{C_1} \\cup E_{C_2})$。\n\n应用二阶PIE近似：\n$$ P_{\\mathrm{het}} \\approx \\sum_{i=1}^6 P(E_i) - \\sum_{1 \\le i  j \\le 6} P(E_i \\cap E_j) $$\n我们分别计算这两个和。\n\n一阶概率之和：\n$$ \\sum P(E_i) = P(E_{A_1}) + P(E_{A_2}) + P(E_{B_1}) + P(E_{B_2}) + P(E_{C_1}) + P(E_{C_2}) $$\n$$ \\sum P(E_i) = p_A + p_A + p_B + p_B + p_C + p_C = 2(p_A + p_B + p_C) $$\n这种线性尺度关系表明，将等位基因数量加倍会使其各自呈递概率的总和也加倍。\n\n二阶（两两）交集概率之和：\n这个和有 $\\binom{6}{2}=15$ 项。我们按相互作用的类型对它们进行分组。\n- **基因座内对**：这些是来自同一基因座的等位基因对。共有$3$对这样的组合：$(A_1, A_2)$、$(B_1, B_2)$ 和 $(C_1, C_2)$。\n它们的交集概率之和为：\n$P(E_{A_1} \\cap E_{A_2}) + P(E_{B_1} \\cap E_{B_2}) + P(E_{C_1} \\cap E_{C_2}) = \\lambda_{\\mathrm{within}}p_A^2 + \\lambda_{\\mathrm{within}}p_B^2 + \\lambda_{\\mathrm{within}}p_C^2 = \\lambda_{\\mathrm{within}}(p_A^2 + p_B^2 + p_C^2)$。\n- **基因座间对**：这些是来自不同基因座的等位基因对。\n    - 基因座A和B之间的对：共有 $2 \\times 2 = 4$ 对。对于每一对，其交集概率为 $\\lambda_{\\mathrm{between}}p_A p_B$。总贡献为 $4\\lambda_{\\mathrm{between}}p_A p_B$。\n    - 基因座A和C之间的对：类似地，有$4$对，总贡献为 $4\\lambda_{\\mathrm{between}}p_A p_C$。\n    - 基因座B和C之间的对：类似地，有$4$对，总贡献为 $4\\lambda_{\\mathrm{between}}p_B p_C$。\n基因座间对的总和为 $4\\lambda_{\\mathrm{between}}(p_A p_B + p_A p_C + p_B p_C)$。\n\n合并所有二阶项：\n$$ \\sum_{1 \\le i  j \\le 6} P(E_i \\cap E_j) = \\lambda_{\\mathrm{within}}(p_A^2 + p_B^2 + p_C^2) + 4\\lambda_{\\mathrm{between}}(p_A p_B + p_A p_C + p_B p_C) $$\n\n将这些和代回 $P_{\\mathrm{het}}$ 的表达式中：\n$$ P_{\\mathrm{het}} \\approx 2(p_A + p_B + p_C) - \\left[ \\lambda_{\\mathrm{within}}(p_A^2 + p_B^2 + p_C^2) + 4\\lambda_{\\mathrm{between}}(p_A p_B + p_A p_C + p_B p_C) \\right] $$\n这个表达式揭示了增加更多等位基因的“收益递减”效应。虽然与纯合子情况相比，一阶项加倍了，但作为减数的二阶修正项的增长超过了平方级别（从3个两两配对项增加到15个），这阻止了总概率加倍。一个基因座（例如A）的杂合性将其基因座水平的呈递概率从 $p_A$ 增加到 $2p_A - \\lambda_{\\mathrm{within}}p_A^2$，由于肽识别中的重叠，这个值小于 $2p_A$。\n\n倍数变化 $\\mathcal{F}$ 的计算\n给定值为：$p_A = 0.010$, $p_B = 0.015$, $p_C = 0.005$, $\\lambda_{\\mathrm{within}} = 1.4$, 和 $\\lambda_{\\mathrm{between}} = 1.1$。\n\n首先，计算中间和：\n- $S_1 = p_A + p_B + p_C = 0.010 + 0.015 + 0.005 = 0.030$\n- $S_{2,\\mathrm{cross}} = p_A p_B + p_A p_C + p_B p_C = (0.010)(0.015) + (0.010)(0.005) + (0.015)(0.005) = 0.00015 + 0.00005 + 0.000075 = 0.000275$\n- $S_{2,\\mathrm{sq}} = p_A^2 + p_B^2 + p_C^2 = (0.010)^2 + (0.015)^2 + (0.005)^2 = 0.0001 + 0.000225 + 0.000025 = 0.00035$\n\n现在计算 $P_{\\mathrm{hom}}$：\n$$ P_{\\mathrm{hom}} \\approx S_1 - \\lambda_{\\mathrm{between}}S_{2,\\mathrm{cross}} = 0.030 - (1.1)(0.000275) = 0.030 - 0.0003025 = 0.0296975 $$\n\n接下来，计算 $P_{\\mathrm{het}}$：\n$$ P_{\\mathrm{het}} \\approx 2S_1 - \\left[ \\lambda_{\\mathrm{within}}S_{2,\\mathrm{sq}} + 4\\lambda_{\\mathrm{between}}S_{2,\\mathrm{cross}} \\right] $$\n$$ P_{\\mathrm{het}} \\approx 2(0.030) - \\left[ (1.4)(0.00035) + 4(1.1)(0.000275) \\right] $$\n$$ P_{\\mathrm{het}} \\approx 0.060 - \\left[ 0.00049 + 4(0.0003025) \\right] $$\n$$ P_{\\mathrm{het}} \\approx 0.060 - \\left[ 0.00049 + 0.00121 \\right] $$\n$$ P_{\\mathrm{het}} \\approx 0.060 - 0.0017 = 0.0583 $$\n\n最后，计算倍数变化 $\\mathcal{F}$：\n$$ \\mathcal{F} = \\frac{P_{\\mathrm{het}}}{P_{\\mathrm{hom}}} = \\frac{0.0583}{0.0296975} \\approx 1.963116... $$\n按要求四舍五入到$4$位有效数字，我们得到 $\\mathcal{F} = 1.963$。\n这一结果量化了MHC杂合性在可呈递的肽库广度方面所赋予的显著（尽管未达到两倍）的免疫优势。", "answer": "$$ \\boxed{1.963} $$", "id": "2899414"}, {"introduction": "MHC多态性的维持是一个动态的进化过程，通常由宿主与病原体之间持续的“军备竞赛”驱动。这项计算练习模拟了这种动态，让你探索等位基因频率如何在随时间波动的选择压力下演变。通过编写程序来实现一个经典的群体遗传学模型，你将亲身验证在周期性变化的环境中（例如病原体季节性流行），多态性是如何通过平衡选择得以维持的 [@problem_id:2899427]。", "problem": "考虑一个单基因座、双等位基因（$A$ 和 $a$）、二倍体的种群，其世代离散、不重叠，并进行随机交配。由于病原体更替（建模为周期性环境序列），特定基因型的生存力随时间变化。设 $p_t$ 为第 $t$ 代选择后等位基因 $A$ 的频率。假设每代在选择前符合哈迪-温伯格比例。如果在第 $t$ 代的环境为 $e_t$，基因型生存力为 $w_{AA}(t)$、$w_{Aa}(t)$ 和 $w_{aa}(t)$，则标准离散时间生存力选择更新公式成立：\n$$\n\\bar{w}_t \\equiv p_t^2\\,w_{AA}(t) + 2\\,p_t\\,(1-p_t)\\,w_{Aa}(t) + (1-p_t)^2\\,w_{aa}(t),\n$$\n$$\np_{t+1} \\;=\\; \\frac{p_t^2\\,w_{AA}(t) + p_t\\,(1-p_t)\\,w_{Aa}(t)}{\\bar{w}_t}.\n$$\n\n假设由病原体更替引起的时间异质性选择是周期性的，周期为 $L$，因此 $e_{t+L}=e_t$ 且 $w_{XY}(t+L)=w_{XY}(t)$，其中 $XY\\in\\{AA,Aa,aa\\}$。如果在一个完整的环境变化周期内，每个等位基因在稀有时其频率都会增加，则称受保护的多态性得以持续。假设当一个等位基因稀有时，其几乎所有拷贝都存在于杂合子中，则在一个周期内稀有等位基因 $A$ 的入侵乘数为\n$$\nG_A \\;=\\; \\prod_{k=0}^{L-1} \\frac{w_{Aa}(k)}{w_{aa}(k)},\n$$\n稀有等位基因 $a$ 的入侵乘数为\n$$\nG_a \\;=\\; \\prod_{k=0}^{L-1} \\frac{w_{Aa}(k)}{w_{AA}(k)}.\n$$\n在这种周期性、确定性的设定下，受保护多态性的充分必要条件是 $G_A  1$ 和 $G_a  1$。\n\n任务：编写一个完整的程序，对下方的每个测试用例执行以下两项操作：\n- 使用离散时间更新公式预测 $p_t$ 在 $T$ 个世代内的轨迹，并报告四舍五入到 $6$ 位小数的 $p_T$。\n- 通过评估严格不等式 $G_A  1$ 和 $G_a  1$ 来判断是否存在受保护的多态性；将结果报告为一个整数，$1$ 表示存在受保护的多态性，否则为 $0$。\n\n重要的实现细节：\n- 环境序列是周期性的，并以一个有序的不同环境状态列表给出。时间每推进一步，就进入列表中的下一个状态，最后一个状态之后，序列从头开始重复。\n- 所有基因型生存力均为严格正实数。\n- 为保证数值稳定性，您可以使用 $\\varepsilon = 10^{-12}$ 的容差来处理严格不等式；即检验 $G_A  1 + \\varepsilon$ 和 $G_a  1 + \\varepsilon$。\n- 本问题中没有物理单位。\n- 本问题中不涉及角度和百分比。\n\n测试套件（四个用例），每个用例由其周期为 $L$ 的环境列表、初始频率 $p_0$ 和世代数 $T$ 指定：\n- 用例 $1$（无单状态杂合子优势的时间变异）：周期 $L=2$，其中\n  - 环境 $E_1$：$(w_{AA}, w_{Aa}, w_{aa}) = (0.9, 1.0, 1.1)$，\n  - 环境 $E_2$：$(w_{AA}, w_{Aa}, w_{aa}) = (1.1, 1.0, 0.9)$。\n  使用 $p_0 = 0.2$ 和 $T = 100$。\n- 用例 $2$（中性边界情况）：周期 $L=1$，其中\n  - 环境 $E$：$(w_{AA}, w_{Aa}, w_{aa}) = (1.0, 1.0, 1.0)$。\n  使用 $p_0 = 0.3$ 和 $T = 100$。\n- 用例 $3$（在整个周期内偏向 $A$ 的定向选择）：周期 $L=3$，其中\n  - 环境 $E_1$：$(w_{AA}, w_{Aa}, w_{aa}) = (1.2, 1.05, 0.8)$，\n  - 环境 $E_2$：$(w_{AA}, w_{Aa}, w_{aa}) = (1.1, 1.0, 0.9)$，\n  - 环境 $E_3$：$(w_{AA}, w_{Aa}, w_{aa}) = (1.3, 1.05, 0.7)$。\n  使用 $p_0 = 0.4$ 和 $T = 100$。\n- 用例 $4$（所有状态均为超显性）：周期 $L=2$，其中\n  - 环境 $E_1$：$(w_{AA}, w_{Aa}, w_{aa}) = (0.9, 1.2, 0.8)$，\n  - 环境 $E_2$：$(w_{AA}, w_{Aa}, w_{aa}) = (0.8, 1.2, 0.9)$。\n  使用 $p_0 = 0.01$ 和 $T = 80$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个用例的结果，格式为用方括号括起来的逗号分隔列表。每个用例的结果本身必须是一个双元素列表，格式为 $[p_T,flag]$，其中 $p_T$ 四舍五入到 $6$ 位小数，$flag$ 为 $1$ 或 $0$。输出中任何地方都不要包含空格。\n- 例如，整体格式必须是\n  $[[p_{T,1},flag_1],[p_{T,2},flag_2],[p_{T,3},flag_3],[p_{T,4},flag_4]]$。", "solution": "所呈现的问题陈述是理论群体遗传学中的一个标准练习，涉及在时间波动的生存力选择下单一位点二倍体基因座的动态。所有提供的方程、定义和参数在内部都是一致的，并且基于已建立的科学原理。该模型是周期性环境中选择的经典表示，并且通过入侵分析得出的受保护多态性的条件是正确的。因此，该问题被认为是有效、适定且科学合理的。我将继续提供完整解答。\n\n解决方案要求对每个测试用例进行两种不同的计算：确定长期稳定性，以及直接模拟系统的轨迹。\n\n首先，我们分析受保护多态性的条件。这个条件确保了两个等位基因 $A$ 和 $a$ 在稀有时频率会增加，从而防止它们从种群中丢失并维持遗传多样性。该分析依赖于在状态空间（其中一个等位基因几乎固定，例如 $p_t \\to 0$ 或 $p_t \\to 1$）的边界处对动力学进行线性化。一个稀有等位基因在长度为 $L$ 的一个完整环境周期内的增长率由其入侵乘数给出。\n\n对于等位基因 $A$ 要入侵一个由 $aa$ 个体组成的种群，其几何平均适应度（在其出现于杂合子 $Aa$ 中时评估）必须超过该周期内常驻纯合子 $aa$ 的几何平均适应度。当 $A$ 稀有（$p_t \\to 0$）时，每代的增长因子约为 $\\lambda_A(t) = w_{Aa}(t) / w_{aa}(t)$。一个周期内的入侵乘数是这些增长因子的乘积：\n$$\nG_A = \\prod_{k=0}^{L-1} \\lambda_A(k) = \\prod_{k=0}^{L-1} \\frac{w_{Aa}(k)}{w_{aa}(k)}\n$$\n对称地，对于等位基因 $a$ 要入侵一个由 $AA$ 个体组成的种群，其入侵乘数 $G_a$ 必须大于一：\n$$\nG_a = \\prod_{k=0}^{L-1} \\lambda_a(k) = \\prod_{k=0}^{L-1} \\frac{w_{Aa}(k)}{w_{AA}(k)}\n$$\n当且仅当两个等位基因在稀有时都能入侵，受保护的多态性才能得以维持，这转化为条件 $G_A  1$ 和 $G_a  1$。问题指定使用数值容差 $\\varepsilon = 10^{-12}$ 来处理这个严格不等式。算法将计算这两个乘积，并检查是否同时满足 $G_A  1 + \\varepsilon$ 和 $G_a  1 + \\varepsilon$，从而相应地设置一个二进制标志。\n\n其次，我们必须计算 $T$ 个世代的等位基因频率轨迹。这是一个离散时间动力系统的直接数值模拟。给定第 $t$ 代选择前等位基因 $A$ 的频率为 $p_t$，随机交配下的合子基因型频率由哈迪-温伯格比例给出：$AA$ 为 $p_t^2$，$Aa$ 为 $2p_t(1-p_t)$，$aa$ 为 $(1-p_t)^2$。在使用特定基因型生存力 $w_{AA}(t)$、$w_{Aa}(t)$ 和 $w_{aa}(t)$ 进行选择后，下一代 $p_{t+1}$ 中等位基因 $A$ 的频率由以下递推关系给出：\n$$\np_{t+1} = \\frac{p_t^2 w_{AA}(t) + p_t(1-p_t)w_{Aa}(t)}{p_t^2 w_{AA}(t) + 2p_t(1-p_t)w_{Aa}(t) + (1-p_t)^2w_{aa}(t)}\n$$\n生存力 $w_{XY}(t)$ 由第 $t$ 代的环境状态决定，该状态遵循长度为 $L$ 的周期性序列。第 $t$ 代的环境对应于状态 $k = t \\pmod L$。\n\n这部分的算法如下：\n1. 用给定的值 $p_0$ 初始化等位基因频率。\n2. 从 $t = 0$ 到 $T-1$ 进行迭代。\n3. 在每一代 $t$ 中，确定环境状态 $k = t \\pmod L$ 并检索相应的生存力 $\\{w_{AA}(k), w_{Aa}(k), w_{aa}(k)\\}$。\n4. 将当前等位基因频率 $p_t$ 和生存力代入递推关系以计算 $p_{t+1}$。\n5. 更新频率：$p_t \\leftarrow p_{t+1}$。\n6. 经过 $T$ 次迭代后，最终频率为 $p_T$。该值将报告出来，并四舍五入到六位小数。\n\n实现将通过执行这两种计算来处理每个测试用例，并按规定格式化结果。所有浮点运算都将使用 $64$ 位精度执行，以确保数值准确性。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the population genetics problem for a series of test cases.\n    For each case, it determines if a protected polymorphism persists and\n    simulates the allele frequency trajectory.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Temporal variation without per-state heterozygote advantage\n        {\n            \"L\": 2,\n            \"environments\": [(0.9, 1.0, 1.1), (1.1, 1.0, 0.9)],\n            \"p0\": 0.2,\n            \"T\": 100\n        },\n        # Case 2: Neutral boundary case\n        {\n            \"L\": 1,\n            \"environments\": [(1.0, 1.0, 1.0)],\n            \"p0\": 0.3,\n            \"T\": 100\n        },\n        # Case 3: Directional selection favoring A over the full cycle\n        {\n            \"L\": 3,\n            \"environments\": [(1.2, 1.05, 0.8), (1.1, 1.0, 0.9), (1.3, 1.05, 0.7)],\n            \"p0\": 0.4,\n            \"T\": 100\n        },\n        # Case 4: Overdominance across all states\n        {\n            \"L\": 2,\n            \"environments\": [(0.9, 1.2, 0.8), (0.8, 1.2, 0.9)],\n            \"p0\": 0.01,\n            \"T\": 80\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        p0 = case[\"p0\"]\n        T = case[\"T\"]\n        L = case[\"L\"]\n        environments = case[\"environments\"]\n        epsilon = 1e-12\n\n        # Part 1: Determine if a protected polymorphism persists.\n        # This requires calculating the invasion multipliers G_A and G_a.\n        ratios_A = [np.float64(env[1]) / np.float64(env[2]) for env in environments]\n        G_A = np.prod(ratios_A)\n        \n        ratios_a = [np.float64(env[1]) / np.float64(env[0]) for env in environments]\n        G_a = np.prod(ratios_a)\n\n        polymorphism_flag = 1 if (G_A > 1.0 + epsilon and G_a > 1.0 + epsilon) else 0\n\n        # Part 2: Predict the trajectory of p_t using discrete-time updates.\n        p_t = np.float64(p0)\n        \n        for t in range(T):\n            env_idx = t % L\n            w_AA, w_Aa, w_aa = environments[env_idx]\n            \n            w_AA_np, w_Aa_np, w_aa_np = np.float64(w_AA), np.float64(w_Aa), np.float64(w_aa)\n            \n            # Calculate mean fitness (w_bar).\n            p_t_sq = p_t * p_t\n            one_minus_p = 1.0 - p_t\n            w_bar = p_t_sq * w_AA_np + 2.0 * p_t * one_minus_p * w_Aa_np + one_minus_p * one_minus_p * w_aa_np\n            \n            # Update allele frequency p_{t+1}.\n            if w_bar == 0.0:\n                # This case is not expected as viabilities are strictly positive.\n                # If it occurred, the frequency would not change.\n                p_t = p_t\n            else:\n                numerator = p_t_sq * w_AA_np + p_t * one_minus_p * w_Aa_np\n                p_t = numerator / w_bar\n        \n        p_T = p_t\n        \n        # Format the result string for the current case.\n        # The p_T:.6f format specifier rounds the value to 6 decimal places.\n        result_str = f\"[{p_T:.6f},{polymorphism_flag}]\"\n        results.append(result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[[{','.join(results)}]]\")\n\nsolve()\n```", "id": "2899427"}]}