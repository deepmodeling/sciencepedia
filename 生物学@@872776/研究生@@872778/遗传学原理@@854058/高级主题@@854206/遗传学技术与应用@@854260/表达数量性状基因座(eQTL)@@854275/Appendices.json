{"hands_on_practices": [{"introduction": "在表达数量性状基因座（eQTL）分析中，校正由批次效应或细胞组成等因素引起的隐藏混杂变量至关重要。主成分分析（PCA）是一种常用的数据驱动方法，用于捕获和移除这些不需要的变异来源。然而，如果真实遗传信号本身对主成分（PCs）有贡献，那么草率地将这些主成分作为协变量进行校正可能会导致有偏的结果。这项练习将引导你分析这种“过度校正”的后果，并从第一性原理出发，推导导出一种无偏的校正程序，从而加深对 eQTL 分析中协变量选择的理解 [@problem_id:2810275]。", "problem": "一项关于表达数量性状基因座（eQTLs）的研究旨在评估遗传变异如何影响个体间的信使核糖核酸（mRNA）表达水平，这与分子生物学的中心法则一致。考虑一个由 $n$ 个无亲缘关系的个体组成的队列，以及一个单一基因，其中心化的表达向量为 $y \\in \\mathbb{R}^{n}$。设 $g \\in \\mathbb{R}^{n}$ 为在某个候选顺式作用变体处的中心化基因型剂量向量（例如，次要等位基因计数），其经过缩放以满足 $g^{\\top} g = n$。假设该基因的表达由一个线性模型生成\n$$\ny = \\beta\\, g + \\gamma\\, z + \\varepsilon,\n$$\n其中 $\\beta \\in \\mathbb{R}$ 是真实的 eQTL 效应， $z \\in \\mathbb{R}^{n}$ 是一个未观测到的单一批次混杂因素，满足 $z^{\\top} z = n$ 和 $z^{\\top} g = 0$，$\\gamma \\in \\mathbb{R}$ 是混杂因素载荷，$\\varepsilon \\in \\mathbb{R}^{n}$ 是零均值噪声，满足 $\\mathbb{E}[\\varepsilon] = 0$ 和 $\\operatorname{Cov}(\\varepsilon) = \\sigma^{2} I_{n}$，且独立于 $g$ 和 $z$。在实践中，研究人员通常会计算 $y$ 的主成分（PCs）以移除混杂效应。假设从 $y$ 中提取的第一主成分（PC）是一个单位向量 $p \\in \\mathbb{R}^{n}$，它位于 $z$ 和 $g$ 的张成空间内，并由一个角度 $\\theta \\in \\mathbb{R}$ 参数化为\n$$\np \\;=\\; \\cos(\\theta)\\,\\frac{z}{\\sqrt{n}} \\;+\\; \\sin(\\theta)\\,\\frac{g}{\\sqrt{n}},\n$$\n从而 $p^{\\top}p=1$。考虑在表达分析中常用的以下两步“朴素”校正法：\n1. 通过第一主成分对表达量进行残差化：$y_{\\mathrm{res}} = (I_{n} - p p^{\\top}) y$。\n2. 通过普通最小二乘法（OLS）估计 eQTL 效应：$\\widehat{\\beta}_{\\mathrm{naive}} = \\dfrac{g^{\\top} y_{\\mathrm{res}}}{g^{\\top} g}$。\n\n仅从欧几里得空间中线性回归和正交投影的定义出发，推导朴素估计量 $\\widehat{\\beta}_{\\mathrm{naive}}$ 在大样本极限下（当 $n \\to \\infty$ 时忽略 $\\varepsilon$）的期望，并用 $\\beta$、$\\gamma$ 和 $\\theta$ 表示。然后，提出一种方法，通过构建一个与 $g$ 正交的 PC 方向 $p_{\\perp g}$，并在相同的两步校正中使用它来代替 $p$，从而在移除混杂因素的同时避免衰减真实的 eQTL 效应；简要说明为什么这一改变能解决衰减问题。\n\n将衰减因子 $A_{\\mathrm{naive}} \\equiv \\mathbb{E}[\\widehat{\\beta}_{\\mathrm{naive}}]/\\beta$ 作为 $\\theta$、$\\beta$ 和 $\\gamma$ 的函数的闭式解析表达式作为你的最终答案。无需进行数值计算。最终答案必须是单个无单位的闭式表达式。", "solution": "所述问题具有科学依据、良构且客观。它提出了一个简化但典型的模型，用于研究混杂效应对表达数量性状基因座（eQTL）分析的影响。我们将进行严谨的推导。\n\n按照要求，分析分为两部分。首先，我们推导朴素估计量的大样本期望。其次，我们提出并论证一个校正后的程序。\n\n第一部分：$\\widehat{\\beta}_{\\mathrm{naive}}$ 的大样本期望推导\n\neQTL效应 $\\beta$ 的朴素估计量由下式给出\n$$\n\\widehat{\\beta}_{\\mathrm{naive}} = \\frac{g^{\\top} y_{\\mathrm{res}}}{g^{\\top} g}\n$$\n其中 $y_{\\mathrm{res}} = (I_{n} - p p^{\\top}) y$。矩阵 $P_p = p p^{\\top}$ 是到由单位向量 $p$ 张成的一维子空间上的投影矩阵，而 $(I_n - P_p)$ 是到其正交补上的投影矩阵。分母由 $g^{\\top} g = n$ 给出。\n\n将 $y_{\\mathrm{res}}$ 的表达式代入估计量中，我们得到：\n$$\n\\widehat{\\beta}_{\\mathrm{naive}} = \\frac{g^{\\top} (I_{n} - p p^{\\top}) y}{n} = \\frac{g^{\\top}y - g^{\\top}p p^{\\top} y}{n} = \\frac{g^{\\top}y - (g^{\\top}p)(p^{\\top}y)}{n}\n$$\n问题要求的是大样本期望，忽略噪声项 $\\varepsilon$。该期望是关于噪声分布的。\n$$\n\\mathbb{E}[\\widehat{\\beta}_{\\mathrm{naive}}] = \\frac{g^{\\top}\\mathbb{E}[y] - (g^{\\top}p)(p^{\\top}\\mathbb{E}[y])}{n}\n$$\n表达向量的模型为 $y = \\beta g + \\gamma z + \\varepsilon$。给定 $\\mathbb{E}[\\varepsilon]=0$，$y$ 的期望值为：\n$$\n\\mathbb{E}[y] = \\beta g + \\gamma z\n$$\n我们将此代入 $\\mathbb{E}[\\widehat{\\beta}_{\\mathrm{naive}}]$ 的表达式中。为清晰起见，令 $y^{*} = \\mathbb{E}[y]$。\n$$\n\\mathbb{E}[\\widehat{\\beta}_{\\mathrm{naive}}] = \\frac{g^{\\top}y^{*} - (g^{\\top}p)(p^{\\top}y^{*})}{n}\n$$\n我们现在必须计算标量积 $g^{\\top}p$ 和 $p^{\\top}y^{*}$。向量 $p$ 定义为 $p = \\cos(\\theta)\\,\\frac{z}{\\sqrt{n}} + \\sin(\\theta)\\,\\frac{g}{\\sqrt{n}}$。\n\n首先，我们计算 $g^{\\top}p$：\n$$\ng^{\\top}p = g^{\\top} \\left( \\cos(\\theta)\\frac{z}{\\sqrt{n}} + \\sin(\\theta)\\frac{g}{\\sqrt{n}} \\right) = \\frac{\\cos(\\theta)}{\\sqrt{n}} (g^{\\top}z) + \\frac{\\sin(\\theta)}{\\sqrt{n}} (g^{\\top}g)\n$$\n使用给定条件 $g^{\\top}z = 0$ 和 $g^{\\top}g = n$，我们发现：\n$$\ng^{\\top}p = \\frac{\\cos(\\theta)}{\\sqrt{n}}(0) + \\frac{\\sin(\\theta)}{\\sqrt{n}}(n) = \\sqrt{n}\\sin(\\theta)\n$$\n\n接下来，我们计算 $p^{\\top}y^{*}$：\n$$\np^{\\top}y^{*} = p^{\\top}(\\beta g + \\gamma z) = \\beta (p^{\\top}g) + \\gamma (p^{\\top}z)\n$$\n我们已有 $p^{\\top}g = g^{\\top}p = \\sqrt{n}\\sin(\\theta)$。现在我们需要计算 $p^{\\top}z$：\n$$\np^{\\top}z = \\left( \\cos(\\theta)\\frac{z}{\\sqrt{n}} + \\sin(\\theta)\\frac{g}{\\sqrt{n}} \\right)^{\\top} z = \\frac{\\cos(\\theta)}{\\sqrt{n}}(z^{\\top}z) + \\frac{\\sin(\\theta)}{\\sqrt{n}}(g^{\\top}z)\n$$\n使用条件 $z^{\\top}z = n$ 和 $g^{\\top}z = 0$：\n$$\np^{\\top}z = \\frac{\\cos(\\theta)}{\\sqrt{n}}(n) + \\frac{\\sin(\\theta)}{\\sqrt{n}}(0) = \\sqrt{n}\\cos(\\theta)\n$$\n代回 $p^{\\top}y^{*}$ 的表达式中：\n$$\np^{\\top}y^{*} = \\beta(\\sqrt{n}\\sin(\\theta)) + \\gamma(\\sqrt{n}\\cos(\\theta)) = \\sqrt{n}(\\beta\\sin(\\theta) + \\gamma\\cos(\\theta))\n$$\n\n现在我们组合 $\\mathbb{E}[\\widehat{\\beta}_{\\mathrm{naive}}]$ 的分子：$g^{\\top}y^{*} - (g^{\\top}p)(p^{\\top}y^{*})$。第一项是 $g^{\\top}y^{*} = g^{\\top}(\\beta g + \\gamma z) = \\beta(g^{\\top}g) + \\gamma(g^{\\top}z) = \\beta n$。\n$$\n\\text{分子} = \\beta n - (\\sqrt{n}\\sin(\\theta)) \\cdot (\\sqrt{n}(\\beta\\sin(\\theta) + \\gamma\\cos(\\theta)))\n$$\n$$\n= \\beta n - n(\\beta\\sin^{2}(\\theta) + \\gamma\\sin(\\theta)\\cos(\\theta))\n$$\n$$\n= n(\\beta - \\beta\\sin^{2}(\\theta) - \\gamma\\sin(\\theta)\\cos(\\theta))\n$$\n使用恒等式 $1 - \\sin^{2}(\\theta) = \\cos^{2}(\\theta)$：\n$$\n= n(\\beta\\cos^{2}(\\theta) - \\gamma\\sin(\\theta)\\cos(\\theta))\n$$\n最后，我们除以分母 $n$ 得到大样本期望：\n$$\n\\mathbb{E}[\\widehat{\\beta}_{\\mathrm{naive}}] = \\beta\\cos^{2}(\\theta) - \\gamma\\sin(\\theta)\\cos(\\theta)\n$$\n这个结果表明朴素估计量是有偏的。项 $\\beta\\cos^{2}(\\theta)$ 表示对真实效应 $\\beta$ 的衰减，因为 $\\cos^{2}(\\theta) \\leq 1$。项 $-\\gamma\\sin(\\theta)\\cos(\\theta)$ 表示一个依赖于混杂效应 $\\gamma$ 的偏差，即使真实遗传效应 $\\beta$ 为零，该项也可能非零，从而导致假阳性发现。\n\n第二部分：避免衰减的校正程序\n\n衰减和偏差的原因是主成分 $p$ 与基因型向量 $g$ 相关（因为只要 $\\sin(\\theta) \\neq 0$，就有 $g^{\\top}p \\neq 0$）。校正程序必须在不移除感兴趣的遗传信号的情况下，移除混杂变异。这可以通过确保用于校正的向量与基因型向量 $g$ 正交来实现。\n\n提议的程序如下：\n1. 从原始 PC $p$ 构建一个新向量 $p_{\\perp g}$，使其与 $g$ 正交。这可以通过格拉姆-施密特正交化方法，移除 $p$ 沿 $g$ 方向的分量来实现。未归一化的向量是：\n$$\np'_{\\perp g} = p - \\frac{p^{\\top}g}{g^{\\top}g}g\n$$\n根据构造，该向量 $p'_{\\perp g}$ 与 $g$ 正交，因为 $g^{\\top}p'_{\\perp g} = g^{\\top}p - \\frac{(p^{\\top}g)(g^{\\top}g)}{g^{\\top}g} = 0$。为了在投影矩阵中使用，它必须被归一化为单位向量：\n$$\np_{\\perp g} = \\frac{p'_{\\perp g}}{\\|p'_{\\perp g}\\|}\n$$\n2. 在相同的两步程序中用这个新向量 $p_{\\perp g}$ 代替 $p$：\n   a. 对表达量进行残差化：$y_{\\mathrm{res,corr}} = (I_{n} - p_{\\perp g} p_{\\perp g}^{\\top}) y$。\n   b. 估计 eQTL 效应：$\\widehat{\\beta}_{\\mathrm{corr}} = \\dfrac{g^{\\top} y_{\\mathrm{res,corr}}}{g^{\\top} g}$。\n\n为了证明此校正的合理性，我们分析 $\\widehat{\\beta}_{\\mathrm{corr}}$ 的期望。\n$$\n\\mathbb{E}[\\widehat{\\beta}_{\\mathrm{corr}}] = \\mathbb{E}\\left[\\frac{g^{\\top}(I_{n} - p_{\\perp g} p_{\\perp g}^{\\top}) y}{n}\\right] = \\frac{g^{\\top}y^{*} - (g^{\\top}p_{\\perp g})(p_{\\perp g}^{\\top}y^{*})}{n}\n$$\n根据构造，$g^{\\top}p_{\\perp g} = 0$。因此，第二项消失了。\n$$\n\\mathbb{E}[\\widehat{\\beta}_{\\mathrm{corr}}] = \\frac{g^{\\top}y^{*}}{n} = \\frac{g^{\\top}(\\beta g + \\gamma z)}{n} = \\frac{\\beta (g^{\\top}g) + \\gamma (g^{\\top}z)}{n}\n$$\n使用 $g^{\\top}g = n$ 和 $g^{\\top}z = 0$，我们得到：\n$$\n\\mathbb{E}[\\widehat{\\beta}_{\\mathrm{corr}}] = \\frac{\\beta n + 0}{n} = \\beta\n$$\n估计量 $\\widehat{\\beta}_{\\mathrm{corr}}$ 是 $\\beta$ 的无偏估计。此程序成功地移除了与混杂因素相关的变异（由 $p$ 与 $g$ 正交的分量捕获），而没有衰减或偏倚真实 eQTL 效应的估计。这是一个普遍原则：在线性模型中，对与感兴趣的回归量正交的协变量进行调整，不会使该回归量的系数产生偏差。\n\n最后，我们计算朴素估计量所要求的衰减因子，假设 $\\beta \\neq 0$。\n$$\nA_{\\mathrm{naive}} = \\frac{\\mathbb{E}[\\widehat{\\beta}_{\\mathrm{naive}}]}{\\beta} = \\frac{\\beta\\cos^{2}(\\theta) - \\gamma\\sin(\\theta)\\cos(\\theta)}{\\beta} = \\cos^{2}(\\theta) - \\frac{\\gamma}{\\beta}\\sin(\\theta)\\cos(\\theta)\n$$\n这就是所要求的闭式表达式。", "answer": "$$\n\\boxed{\\cos^{2}(\\theta) - \\frac{\\gamma}{\\beta} \\sin(\\theta) \\cos(\\theta)}\n$$", "id": "2810275"}, {"introduction": "在顺式 eQTL 作图（cis-eQTL mapping）中，我们通常会检验一个基因附近区域（例如 $1$ Mb 窗口）内的所有遗传变异。这会带来多重检验问题，尤其是当这些变异由于连锁不平衡（LD）而高度相关时，经典的 Bonferroni 校正会过于保守。置换检验（Permutation testing）提供了一种优雅的非参数解决方案，它通过经验性地构建基因水平的零分布来校正多重检验，同时自然地保留了变异间的相关结构。这项练习将帮助你理解置换检验的原理，并推导如何基于置换结果计算经验 $p$ 值 [@problem_id:2810319]。", "problem": "一个实验室正在使用来自 $n$ 个无亲缘关系个体的基因型和信使核糖核酸 (mRNA) 表达数据，为一个单基因绘制顺式表达数量性状基因座 (cis-eQTLs; expression quantitative trait loci)。顺式窗口被定义为转录起始位点上游和下游各 $1$ 兆碱基 (Mb) 的区域。对于该基因，其顺式窗口内有 $m$ 个单核苷酸多态性 (SNPs)。变异 $k$ 的关联统计量通过拟合一个线性模型 $Y = \\alpha + \\beta_{k} G_{k} + \\boldsymbol{\\gamma}^{\\top} \\mathbf{C} + \\varepsilon$ 来计算，其中 $Y$ 是经过对数转换的表达量，$G_{k}$ 是变异 $k$ 处的基因型剂量，$\\mathbf{C}$ 是测得的协变量，$\\varepsilon$ 是误差项。检验统计量 $T_{k}$ 取为 $\\beta_{k}$ 的 $t$-统计量的绝对值。领头变异是具有最大 $T_{k}$ 值的变异，其观测统计量为 $T_{\\max}^{\\mathrm{obs}} = \\max_{1 \\leq k \\leq m} T_{k}$。\n\n为了校准该基因的零分布，同时考虑到 $m$ 个 SNP 之间的连锁不平衡 (LD) 引起的相关性结构以及对这 $m$ 个 SNP 进行多重检验的问题，该实验室执行了一个置换程序：他们首先将 $Y$ 对 $\\mathbf{C}$ 进行回归，以获得个体 $i = 1, \\dots, n$ 的残差 $\\hat{\\varepsilon}_{i}$。在原假设（即经过协变量校正后，没有顺式变异影响表达）下，残差与基因型无关，并且在个体之间是可交换的。然后，实验室对残差向量进行 $B$ 次独立置换，得到 $\\pi_{1}, \\dots, \\pi_{B}$，并对于每次置换 $j$，使用置换后的残差与原始的基因型和协变量配对，重新计算变异水平的检验统计量 $\\{T_{k}^{(j)}\\}_{k=1}^{m}$，并记录置换后的基因水平最大值 $M^{(j)} = \\max_{1 \\leq k \\leq m} T_{k}^{(j)}$。\n\n请从第一性原理出发，解释为什么这种基于置换的校准方法能够为该基因的 cis-eQTL 作图中的 $T_{\\max}$ 提供一个有效的经验零分布。然后，令 $b$ 表示在 $B$ 次抽样中，满足 $M^{(j)} \\geq T_{\\max}^{\\mathrm{obs}}$ 的置换次数（为保守起见，将相等情况计为超出）。仅使用这些要素，不引用任何外部公式，推导基于 $B$ 次置换和 $b$ 次超出的观测领头变异统计量 $T_{\\max}^{\\mathrm{obs}}$ 的有限样本经验 $p$-值。请将您的最终答案表示为仅含 $B$ 和 $b$ 的单个闭式解析表达式。最终表达式无需四舍五入，也无需单位。", "solution": "所提出的问题是统计遗传学领域一个有效且定义明确的问题。它描述了一个标准且统计学上合理的程序，用于评估顺式表达数量性状基因座 (cis-eQTL) 的显著性，同时恰当地考虑了混杂因素以及对相关遗传变异进行多重检验带来的负担。我将首先从第一性原理出发解释该置换方案的有效性，然后推导所要求的经验 $p$-值。\n\n第一步是正式陈述原假设 $H_{0}$。对于一个给定的基因，原假设是在考虑了一组协变量 $\\mathbf{C}$ 的效应后，基因表达与顺式窗口内 $m$ 个单核苷酸多态性 (SNPs) 中任何一个的基因型之间都没有关联。更正式地，对于每个变异 $k \\in \\{1, \\dots, m\\}$ 的线性模型 $Y = \\alpha + \\beta_{k} G_{k} + \\boldsymbol{\\gamma}^{\\top} \\mathbf{C} + \\varepsilon$，原假设为 $H_{0}: \\beta_{1} = \\beta_{2} = \\dots = \\beta_{m} = 0$。\n\n在此原假设下，基因表达 $Y$ 的模型简化为 $Y = \\alpha + \\boldsymbol{\\gamma}^{\\top} \\mathbf{C} + \\varepsilon$。该模型意味着 $Y$ 中任何不能被协变量 $\\mathbf{C}$ 解释的变异都被误差项 $\\varepsilon$ 捕获，且假定该误差项独立于基因型 $\\{G_{k}\\}_{k=1}^{m}$。所述程序首先将 $Y$ 对 $\\mathbf{C}$ 进行回归，以获得残差向量 $\\hat{\\boldsymbol{\\varepsilon}}$。该向量的每个元素 $\\hat{\\varepsilon}_{i}$ 代表个体 $i$ 基因表达中不能被测得的协变量线性预测的部分。关键在于，在 $H_{0}$ 下，这些残差与个体的基因型是独立的。\n\n因为题目说明 $n$ 个个体是无亲缘关系的，并且在残差独立于基因型的假设下，残差向量 $(\\hat{\\varepsilon}_{1}, \\dots, \\hat{\\varepsilon}_{n})$ 是*可交换的*。可交换性意味着对残差的索引进行任何置换，所得到的联合概率分布都与原始向量的相同。因此，通过打乱残差向量，并将其元素与固定的基因型和协变量矩阵重新配对，可以创建一个新的、与原假设在统计上一致的合成数据集。\n\n所述的程序利用了这一原理。对于 $B$ 次置换中的每一次，都会生成一个置换后的残差向量 $\\hat{\\boldsymbol{\\varepsilon}}^{(\\pi_{j})}$。然后用它来构建一个置換后的表达向量，我们称之为 $Y^{(j)}$，其中协变量的效应被加回到置换后的残差上。接着，通过检验 $Y^{(j)}$ 与每个基因型向量 $G_{k}$ 之间的关联来重新计算检验统计量 $\\{T_{k}^{(j)}\\}_{k=1}^{m}$。由于表达与基因型之间的任何真实关联都已通过置换被有意地打破，因此在这个置换数据集中出现的任何大的检验统计量都纯粹是在零模型下的偶然结果。\n\n与更简单的解析方法相比，这种置换方法具有两个关键优势。首先，它非参数地考虑了检验统计量 $\\{T_{k}\\}_{k=1}^{m}$ 之间复杂的关联系构。这种相关性源于 SNP 之间的连锁不平衡 (LD)；染色体上邻近的变异不是独立遗传的。通过保持每个个体的基因型数据完整，仅在个体间置换表型（残差），该程序在每次置换中都正确地保留了 LD 结构。\n\n其次，它直接解决了多重检验问题。我们感兴趣的基因水平统计量是 $T_{\\max} = \\max_{1 \\leq k \\leq m} T_{k}$，即 $m$ 个相关统计量的最大值。这个最大值的理论分布通常是难以处理的。通过为 $B$ 个置换数据集中的每一个计算最大统计量 $M^{(j)} = \\max_{1 \\leq k \\leq m} T_{k}^{(j)}$，我们从 $T_{\\max}$ 的正确零分布中生成了一个经验样本 $\\{M^{(j)}\\}_{j=1}^{B}$。这 $B$ 个值的集合代表了在没有遗传效应的原假设下，我们期望为该基因观察到的最大关联统计量的分布，同时完全尊重了现有的协变量效应和 SNP 关联系构。因此，该程序为 $T_{\\max}$ 产生了一个有效的经验零分布。\n\n我们现在推导经验 $p$-值。$p$-值被定义为在原假设为真的前提下，观测到至少与实际观测值一样极端的检验统计量的概率。在这里，观测到的统计量是 $T_{\\max}^{\\mathrm{obs}}$，我们想要计算 $p = \\mathbb{P}(T_{\\max} \\geq T_{\\max}^{\\mathrm{obs}} | H_{0})$。\n\n我们的置换程序提供了一个来自零分布的大小为 $B$ 的样本：$\\{M^{(1)}, M^{(2)}, \\dots, M^{(B)}\\}$。为了计算经验 $p$-值，我们必须将我们观测到的统计量 $T_{\\max}^{\\mathrm{obs}}$ 与这个经验零分布进行比较。在一个有限样本置换检验的框架中，观测到的数据配置（即“恒等置换”）被认为是原假设下可能的结果之一。因此，我们用于参考分布的检验统计量总集合是置换统计量和观测统计量本身的并集：$\\{T_{\\max}^{\\mathrm}^{\\mathrm{obs}}, M^{(1)}, M^{(2)}, \\dots, M^{(B)}\\}$。这个参考集中同等可能性的统计量总数为 $B+1$。\n\n问题陈述中，$b$ 是置换最大值 $M^{(j)}$ 大于或等于观测最大值 $T_{\\max}^{\\mathrm{obs}}$ 的置换次数。也就是说，$b = \\sum_{j=1}^{B} \\mathbb{I}(M^{(j)} \\geq T_{\\max}^{\\mathrm{obs}})$，其中 $\\mathbb{I}(\\cdot)$ 是指示函数。这 $b$ 个结果至少与观测结果一样极端。除了这 $b$ 个值之外，观测统计量 $T_{\\max}^{\\mathrm{obs}}$ 本身总是大于或等于其自身（$T_{\\max}^{\\mathrm{obs}} \\geq T_{\\max}^{\\mathrm{obs}}$）。因此，我们必须将观测统计量计为一个“极端”结果。这使得我们的参考集中总共有 $b+1$ 个统计量至少与 $T_{\\max}^{\\mathrm{obs}}$ 一样极端。\n\n经验 $p$-值是完整参考集中至少与观测值一样极端的统计量所占的比例。这是极端结果计数与总结果计数的比率。\n\n$$\np_{\\text{empirical}} = \\frac{\\text{Number of statistics } \\geq T_{\\max}^{\\mathrm{obs}}}{\\text{Total number of statistics}}\n$$\n\n代入上面推导出的计数：\n\n$$\np_{\\text{empirical}} = \\frac{b + 1}{B + 1}\n$$\n\n这个公式是蒙特卡洛检验和置换检验的标准形式，因为它避免了 $p$-值为 $0$ 的情况——这在有限次置换下从哲学上难以解释，而且它比替代方案 $b/B$ 具有更优的统计特性。可能的最小 $p$-值是 $1/(B+1)$，正确地反映了检验的分辨率。", "answer": "$$\\boxed{\\frac{b+1}{B+1}}$$", "id": "2810319"}, {"introduction": "全基因组范围的 eQTL 研究可能涉及数百万甚至数十亿次的假设检验，这使得多重检验校正成为一个核心挑战。在这种大规模检验的背景下，控制伪发现率（False Discovery Rate, FDR）是一种比控制族错误率（Family-Wise Error Rate, FWER）更为强大和实际的策略。Benjamini-Hochberg (BH) 程序是控制 FDR 的奠基性方法，理解其背后的统计原理对于任何进行大规模数据分析的研究者都至关重要。这项练习将要求你从基本定义出发，推导 BH 程序的决策规则，并理解其在实践中的应用 [@problem_id:2810282]。", "problem": "在一项关于表达数量性状基因座 (eQTL) 定位的群体遗传学研究中，你对 $m$ 个独立的变异-基因对，使用线性模型检验了基因型与信使核糖核酸 (mRNA) 表达之间的关联。对于每次检验，你都计算出一个 $p$ 值，记为 $p_{1},\\dots,p_{m}$。当一个变异-基因对显示出基因型与表达之间存在关联的统计学证据时，就称其为一个表达数量性状基因座 (eQTL)。你希望将错误发现率 (False Discovery Rate, FDR) 控制在目标水平 $q \\in (0,1)$。FDR 定义为在所有报告的 eQTL 中，错误的 eQTL 所占的期望比例。\n\n从以下基本事实出发：\n- 在原假设为真的情况下，$p$ 值在 $[0,1]$ 上服从均匀分布，并且在各检验之间是独立的。\n- 错误发现率 (FDR) 定义为 $\\mathrm{FDR} = \\mathbb{E}\\!\\left[\\frac{V}{R}\\right]$，其中 $V$ 是错误报告的 eQTL 数量，$R$ 是报告的 eQTL 总数，并约定 $\\frac{0}{0}=0$。\n\n任务：\n1) 根据这些原则，推导出一个决策规则。该规则将 $p$ 值向量 $(p_{1},\\dots,p_{m})$ 映射到一组发现，并能将 FDR 控制在目标水平 $q$。你的答案必须是一个明确的解析条件，用 $m$、$q$ 和 $p$ 值的顺序统计量来表示，一个 $p$ 值必须满足该条件才能被认为是显著的。\n\n2) 假设在某次特定实验中，第 1 部分的决策规则恰好得出了 $r \\ge 0$ 个 eQTL。在所述条件（独立的、连续的零假设 $p$ 值）下，假设达到的错误发现率等于设计目标 $q$，请给出一个关于 $q$ 和 $r$ 的、表示预期错误 eQTL 数量的封闭形式表达式。你的最终答案必须是单个解析表达式，无需四舍五入，也无需单位。", "solution": "所述问题在科学上是合理的、自洽的，并且在数学上是适定的。它描述了使用错误发现率 (FDR) 进行多重假设检验校正的典型问题，这是现代统计遗传学和其他涉及大规模数据分析领域的一个基本概念。因此，我们开始求解。\n\n该问题包含两个部分。首先，我们必须推导一个控制 FDR 的决策规则。其次，我们必须计算在给定特定结果的情况下，错误发现的期望数量。\n\n第 1 部分：FDR 控制程序的推导\n\n设有 $m$ 个独立的假设检验，其对应的 $p$ 值为 $p_{1}, \\dots, p_{m}$。令 $p_{(1)} \\le p_{(2)} \\le \\dots \\le p_{(m)}$ 为按非递减顺序排列的 $p$ 值。目标是设计一个程序，用于识别一组“发现”（被拒绝的原假设），使得 FDR 被控制在预设水平 $q \\in (0,1)$。\n\nFDR 定义为 $\\mathrm{FDR} = \\mathbb{E}\\!\\left[\\frac{V}{R}\\right]$，其中 $V$ 是错误发现的数量（被错误拒绝的真原假设），$R$ 是发现的总数。约定 $\\frac{0}{0}=0$。一个基本事实是，对于一个为真的原假设，其 $p$ 值服从 $[0,1]$ 上的均匀分布。\n\n实现这种控制的决策规则是 Benjamini-Hochberg (BH) 程序。我们推导这个规则并证明其控制性质。\n\nBH 程序如下：\n1.  找到满足 $p_{(k)} \\le \\frac{k}{m}q$ 的最大整数 $k$。\n2.  如果存在这样的 $k$，则拒绝与 $p$ 值 $p_{(1)}, p_{(2)}, \\dots, p_{(k)}$ 相对应的 $k$ 个原假设。\n3.  如果不存在这样的 $k$，则不拒绝任何假设。\n\n现在，我们必须证明该程序将 FDR 控制在水平 $q$。令 $R$ 表示被拒绝的假设总数。根据程序的定义，$R=k$。令 $\\mathcal{H}_0$ 为对应于真原假设的索引集合，令 $m_0 = |\\mathcal{H}_0|$ 为（未知的）真原假设的数量。错误拒绝的数量为 $V = \\sum_{i \\in \\mathcal{H}_0} \\mathbf{1}\\{H_i \\text{ is rejected}\\}$。量 $\\frac{V}{R}$ 是错误发现比例 (False Discovery Proportion, FDP)。\n\n如果 $R=0$，则 $V=0$ 且 $\\frac{V}{R}=0$。考虑 $R > 0$ 的情况。每个被拒绝的假设 $H_i$ 都有一个 $p$ 值 $p_i \\le p_{(R)}$。根据程序的定义，阈值 $p_{(R)}$ 满足 $p_{(R)} \\le \\frac{R}{m}q$。因此，对于任何被拒绝的假设 $H_i$，其 $p$ 值必须满足 $p_i \\le \\frac{R}{m}q$。\n\n这使我们可以为错误拒绝的指示函数写出一个不等式：\n$$ \\mathbf{1}\\{H_i \\text{ is rejected}, i \\in \\mathcal{H}_0\\} \\le \\mathbf{1}\\{p_i \\le \\frac{R}{m}q, i \\in \\mathcal{H}_0\\} $$\nFDP 可以被界定为：\n$$ \\frac{V}{R} = \\frac{1}{R} \\sum_{i \\in \\mathcal{H}_0} \\mathbf{1}\\{H_i \\text{ is rejected}\\} \\le \\frac{1}{R} \\sum_{i \\in \\mathcal{H}_0} \\mathbf{1}\\left\\{p_i \\le \\frac{R}{m}q\\right\\} $$\n我们现在取期望来求 FDR。利用以 $R$ 为条件的全期望定律：\n$$ \\mathrm{FDR} = \\mathbb{E}\\left[\\frac{V}{R}\\right] \\le \\mathbb{E}\\left[ \\mathbb{E}\\left[ \\frac{1}{R} \\sum_{i \\in \\mathcal{H}_0} \\mathbf{1}\\left\\{p_i \\le \\frac{R}{m}q\\right\\} \\Bigg| R \\right] \\right] $$\n在条件期望内部，$R$ 被视为一个固定值。令 $t_R = \\frac{R}{m}q$。表达式变为：\n$$ \\mathbb{E}\\left[ \\frac{1}{R} \\sum_{i \\in \\mathcal{H}_0} \\mathbf{1}\\{p_i \\le t_R\\} \\Bigg| R \\right] = \\frac{1}{R} \\sum_{i \\in \\mathcal{H}_0} P(p_i \\le t_R \\mid R) $$\n在所述的检验独立假设下，一个零假设 $p$ 值 $p_i$ 的分布独立于其他检验的结果，因此以 $R$ 为条件不会改变其边际概率。对于任何为真的原假设 $H_i$，$p_i \\sim U[0,1]$，所以 $P(p_i \\le t_R) = t_R$。\n$$ \\frac{1}{R} \\sum_{i \\in \\mathcal{H}_0} t_R = \\frac{1}{R} \\cdot m_0 \\cdot t_R = \\frac{m_0}{R} \\cdot \\frac{R}{m}q = \\frac{m_0}{m}q $$\n这个结果不依赖于 $R$ 的值。因此，外层期望也是 $\\frac{m_0}{m}q$。\n$$ \\mathrm{FDR} \\le \\frac{m_0}{m}q $$\n因为真原假设的数量 $m_0$ 不能超过检验总数 $m$，我们有 $m_0 \\le m$，这意味着 $\\frac{m_0}{m}q \\le q$。因此，该程序将 FDR 控制在不大于 $q$ 的水平。\n\n对于给定的 $p$ 值 $p_j$ 被宣布为显著的明确解析条件是，它必须小于或等于被拒绝的最大 $p$ 值。令 $t_{BH}$ 为这个依赖于数据的阈值。\n$$ t_{BH} = \\max\\left\\{ p_{(k)} \\mid k \\in \\{1,\\dots,m\\} \\text{ and } p_{(k)} \\le \\frac{k q}{m} \\right\\} $$\n其中空集上的最大值定义为 $0$。一个 $p$ 值 $p_j$ 导致一个发现，当且仅当 $p_j \\le t_{BH}$。第一部分到此结束。\n\n第 2 部分：错误发现的期望数量\n\n我们已知一个实验恰好产生了 $R=r$ 个发现，其中 $r \\ge 0$ 是一个固定数值。我们必须求出在观测到此结果的条件下，错误发现的期望数量：$\\mathbb{E}[V | R=r]$。\n\n我们还得到了一个关键假设，即达到的 FDR 等于设计目标 $q$，即 $\\mathbb{E}\\left[\\frac{V}{R}\\right] = q$。\nFDR 是 FDP（$\\frac{V}{R}$）的期望值。这个期望可以通过以 $R$ 的值为条件进行分解：\n$$ \\mathbb{E}\\left[\\frac{V}{R}\\right] = \\sum_{k=1}^{m} \\mathbb{E}\\left[\\frac{V}{R} \\Bigg| R=k\\right] P(R=k) + \\mathbb{E}\\left[\\frac{V}{R} \\Bigg| R=0\\right] P(R=0) $$\n按照约定，$R=0$ 的项为 $0$。对于 $k > 0$，在条件期望内部，随机变量 $R$ 被固定为值 $k$，所以 $\\mathbb{E}\\left[\\frac{V}{R} \\Big| R=k\\right] = \\frac{\\mathbb{E}[V|R=k]}{k}$。\n\n达到的 FDR 恰好为 $q$ 的假设是一个很强的简化。它意味着对所有可能结果 $k$ 的复杂平均值等于 $q$。在这种情况下，对此陈述最直接和实际的解释是，对于任何非零的发现数量，错误发现的期望比例都是 $q$。这意味着假设对于任何特定的结果 $r0$，条件 FDR，即 $\\mathbb{E}\\left[\\frac{V}{R} \\Big| R=r\\right]$，等于 $q$。\n\n在这种解释下，对于给定的发现数量 $r  0$，我们有：\n$$ \\mathbb{E}\\left[\\frac{V}{R} \\Bigg| R=r\\right] = q $$\n$$ \\frac{\\mathbb{E}[V|R=r]}{r} = q $$\n解出错误发现的期望数量为：\n$$ \\mathbb{E}[V|R=r] = qr $$\n当有 $r$ 个发现时，该表达式给出了假阳性的期望数量。我们还必须检查 $r=0$ 的情况。如果没有做出任何发现（$r=0$），那么错误发现的数量 $V$ 必须为 $0$。其期望为 $\\mathbb{E}[V|R=0] = 0$。我们的公式 $qr$ 给出 $q \\cdot 0 = 0$，因此它对所有 $r \\ge 0$ 都成立。\n问题要求一个单一的解析表达式，这个结果满足了该要求。", "answer": "$$\\boxed{qr}$$", "id": "2810282"}]}