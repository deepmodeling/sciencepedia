{"hands_on_practices": [{"introduction": "肿瘤样本通常是癌细胞和正常细胞的混合物，这使得解读基因测序数据变得复杂。本练习将引导你通过数学推导，将可观测的变异等位基因频率（Variant Allele Frequency, VAF）与肿瘤纯度、局部拷贝数和癌细胞分数等关键生物学参数联系起来。掌握这种关系是推断肿瘤克隆结构和量化突变丰度的基础。[@problem_id:2858056]", "problem": "肿瘤活检是癌细胞和正常细胞的混合物。令 $p$ 表示肿瘤纯度，定义为样本中癌细胞所占的比例，因此正常细胞的比例为 $(1 - p)$。假设在感兴趣的基因座上，正常细胞是二倍体，总拷贝数为 $2$，并且不携带该突变。在癌细胞群体中，该基因座的局部总拷贝数为 $C$（假设所有癌细胞都具有相同的局部总拷贝数），并且在携带单核苷酸变异（SNV）的每个癌细胞中，该变异是杂合的，这意味着在这类细胞中，$C$ 个染色体拷贝中只有一个携带突变等位基因。令 $\\phi$ 表示癌症细胞分数（CCF），即携带SNV的癌细胞所占的比例；在克隆性情况下 $\\phi = 1$，而亚克隆情况下则有 $0 < \\phi < 1$。变异等位基因频率（VAF），记为 $v$，定义为在细胞和等位基因间无偏抽样以及无等位基因特异性扩增偏倚的假设下，覆盖该基因座的测序读段中携带SNV的预期比例。\n\n从这些定义以及对样本各部分贡献的等位基因拷贝数的基本计数出发，推导预期VAF $v$ 作为 $p$、$C$ 和 $\\phi$ 的函数表达式。将您的最终答案表示为关于 $p$、$C$ 和 $\\phi$ 的单个简化解析表达式。不需要进行数值近似或四舍五入，也不应报告单位。", "solution": "该问题陈述已经过有效性分析，并被确定为定量生物学中一个适定、有科学依据的问题。它没有矛盾、歧义和伪科学。我们现在将进行其形式化推导。\n\n变异等位基因频率 $v$ 定义为在特定基因座上所有等位基因中携带突变等位基因的预期比例。假设抽样无偏，该频率可以表示为整个细胞样本群体中该基因座上突变等位基因总数与等位基因总数的比值。\n$$v = \\frac{N_{\\text{mutant}}}{N_{\\text{total}}}$$\n其中，$N_{\\text{mutant}}$ 是突变等位基因的总数，$N_{\\text{total}}$ 是该基因座上所有等位基因（突变型和野生型）的总数。\n\n为了推导 $v$ 的表达式，我们将考虑一个包含任意总数 $N$ 个细胞的代表性组织样本。数量 $N$ 是一个比例因子，它将而且必须从最终表达式中消除，因为 $v$ 是一个强度性质。\n\n样本由两个不同的细胞群体组成：正常细胞和癌细胞。\n样本中正常细胞的数量由 $N_{\\text{normal}} = (1 - p)N$ 给出，其中 $p$ 是肿瘤纯度。\n癌细胞的数量由 $N_{\\text{cancer}} = pN$ 给出。\n\n首先，我们计算分母 $N_{\\text{total}}$。这是由正常细胞和癌细胞部分贡献的等位基因之和。\n问题指明正常细胞在目标基因座上是二倍体，意味着每个正常细胞贡献 $2$ 个等位基因。来自正常细胞群体的等位基因总数为：\n$$N_{\\text{alleles, normal}} = N_{\\text{normal}} \\times 2 = (1 - p)N \\times 2 = 2(1 - p)N$$\n问题指明癌细胞在该基因座上的总拷贝数为 $C$。因此，每个癌细胞贡献 $C$ 个等位基因。来自癌细胞群体的等位基因总数为：\n$$N_{\\text{alleles, cancer}} = N_{\\text{cancer}} \\times C = (pN) \\times C = pCN$$\n整个样本中的等位基因总数 $N_{\\text{total}}$ 是这两部分贡献之和：\n$$N_{\\text{total}} = N_{\\text{alleles, normal}} + N_{\\text{alleles, cancer}} = 2(1 - p)N + pCN = N(2(1 - p) + pC)$$\n\n接下来，我们计算分子 $N_{\\text{mutant}}$。这是携带单核苷酸变异（SNV）的等位基因总数。\n问题陈述中说明正常细胞不携带该突变。因此，它们对突变等位基因计数的贡献为零。\n突变等位基因仅存在于癌细胞的一个亚群中。携带SNV的癌细胞比例由癌症细胞分数 $\\phi$ 表示。携带SNV的癌细胞绝对数量为：\n$$N_{\\text{cancer, with SNV}} = N_{\\text{cancer}} \\times \\phi = pN\\phi$$\n在每个携带SNV的癌细胞中，该突变是杂合的。根据定义，这意味着 $C$ 个染色体拷贝中恰好有一个携带突变等位基因。因此，这些 $N_{\\text{cancer, with SNV}}$ 细胞中的每一个都为总计数贡献了恰好 $1$ 个突变等位基因。\n样本中突变等位基因的总数为：\n$$N_{\\text{mutant}} = N_{\\text{cancer, with SNV}} \\times 1 = pN\\phi$$\n\n最后，我们构建 $v$ 的比率：\n$$v = \\frac{N_{\\text{mutant}}}{N_{\\text{total}}} = \\frac{pN\\phi}{N(2(1 - p) + pC)}$$\n任意的总细胞数 $N$ 从表达式中消去，从而得到VAF与样本内在生物学参数之间的关系：\n$$v = \\frac{p\\phi}{2(1 - p) + pC}$$\n这就是所要求的简化解析表达式。它为在肿瘤纯度、拷贝数变异和亚克隆结构的背景下解释变异等位基因频率提供了一个基本模型。", "answer": "$$\\boxed{\\frac{p\\phi}{2(1 - p) + pC}}$$", "id": "2858056"}, {"introduction": "在癌症基因组中，突变并非均匀分布，有时会以“kataegis”的形式局部聚集，这通常与APOBEC等特定突变过程有关。本练习是一个实用的生物信息学编程任务，要求你设计一个算法来识别这些超突变簇，并利用统计模型估计其中由APOBEC驱动的突变比例。这项实践有助于深入理解驱动基因组不稳定的突变特征和机制。[@problem_id:2857997]", "problem": "对于每个测试用例，给定一个以碱基对（bp）为单位的突变间基因组距离序列，以及每个突变对应的三核苷酸上下文序列，该序列已根据以嘧啶为中心的约定（中间的碱基是嘧啶链上的突变碱基）进行归一化。您必须实现一个程序，用于识别kataegis（骤雨现象）事件，并估计可归因于载脂蛋白B mRNA编辑催化多肽样蛋白（APOBEC）酶的聚集性突变所占的比例。\n\n需要使用的基本依据和假设：\n- 在一个沿基因组的基准均匀随机突变过程中，沿坐标轴的突变事件可以建模为泊松点过程。事件间的距离是独立同分布的指数随机变量。因此，持续出现的短突变间距离是局部超突变的证据。\n- 一个kataegis簇在操作上由一个最小簇大小阈值和一个最大突变间距离阈值定义。\n- APOBEC催化的胞嘧啶脱氨作用在特定的三核苷酸上下文中产生突变的特征性富集。在以嘧啶为中心的表示法中，与APOBEC相关的上下文在此定义为两个基序“TCA”和“TCT”。出于此问题的目的，任何其他上下文，包括那些不以“C”为中心的上下文，均被视为非APOBEC。\n- 设一个聚集性突变具有APOBEC上下文的概率由两个过程的混合决定：APOBEC驱动过程（概率参数为 $p_A$）和背景过程（概率参数为 $p_B$），其中 $p_A \\gt p_B$。如果由APOBEC产生的聚集性突变比例为 $f \\in [0,1]$，则该混合模型意味着一个聚集性突变表现出APOBEC上下文的边缘概率为 $q(f) = f \\, p_A + (1-f) \\, p_B$。\n\n所需任务：\n1. Kataegis簇识别：\n   - 设一个染色体片段上有 $N$ 个突变，其突变间距离为 $d_1, d_2, \\ldots, d_{N-1}$（以碱基对为单位）。给定这些距离和相应的 $N$ 个三核苷酸上下文。\n   - 给定一个最大距离阈值 $d_0$（以碱基对为单位）和一个最小簇大小 $m$（以突变数为单位），将一个簇定义为任何长度为 $L \\ge m$ 的最大连续突变区块，使得该区块内所有内部突变间距离都 $\\le d_0$。等效地，一个跨越突变索引 $i$ 到 $j$（含两端，从零开始）的区块是一个簇，当且仅当 $j - i + 1 \\ge m$ 且对于所有 $k \\in \\{i, i+1, \\ldots, j-1\\}$ 都有 $d_k \\le d_0$，并且该区块不能在不违反距离条件或与另一区块合并的情况下向左或向右扩展。只计算满足此性质的最大的、不重叠的区块。\n   - 计算簇的总数。\n\n2. APOBEC归因比例的估计：\n   - 将所有位于已识别簇内的突变汇集起来。设 $n$ 是聚集性突变的总数，设 $k$ 是其中上下文为“TCA”或“TCT”的突变数量。\n   - 假设聚集性突变中APOBEC上下文指示符之间条件独立，并根据混合概率 $q(f) = f \\, p_A + (1-f) \\, p_B$（其中 $f \\in [0,1]$，$p_A \\in (0,1)$，$p_B \\in (0,1)$ 且 $p_A \\gt p_B$）构建在 $n$ 个突变中观察到 $k$ 个APOBEC上下文突变的二项式似然。通过最大化此似然来估计 $f$，约束条件为 $f \\in [0,1]$。如果 $n = 0$，按惯例将估计值定义为 $0$。\n\n每个测试用例的输入规格：\n- 一个以碱基对为单位的突变间距离数组：[$d_1, d_2, \\ldots, d_{N-1}$]，其中每个 $d_i$ 是一个正整数（单位：碱基对，bp）。所有 $d_i$ 和 $d_0$ 的单位都是碱基对（bp）。\n- 一个相应的包含 $N$ 个三核苷酸上下文的数组，每个突变一个，每个上下文是包含三个大写核苷酸的字符串。其长度必须满足 $N = (\\text{距离数组长度}) + 1$。\n- 一个最小簇大小 $m$（一个整数，单位：突变数）。\n- 一个最大突变间距离阈值 $d_0$（一个整数，单位：碱基对）。\n- 混合参数 $p_A$ 和 $p_B$（位于 $(0,1)$ 的实数，且 $p_A \\gt p_B$）。\n\n角度单位不适用。除碱基对外，不涉及其他物理量；所有答案都是无量纲的计数或比例。比例必须以小数形式报告。\n\n您的程序必须实现上述逻辑并在以下测试套件上运行。对于每个测试用例，生成一个由簇的数量和估计的APOBEC比例组成的对，后者四舍五入到三位小数。\n\n测试套件：\n- 测试用例 $1$：\n  - 距离 (bp): [$800$, $900$, $700$, $500$, $750$, $5000$, $1200$, $800$, $900$, $700$, $600$, $300$, $200$, $1500$]\n  - 上下文 (长度 $15$): [\"TCA\",\"TCT\",\"ACA\",\"TCA\",\"TCG\",\"TCT\",\"GCG\",\"TCA\",\"TCT\",\"TCT\",\"GCG\",\"TCA\",\"TCT\",\"TCA\",\"ACA\"]\n  - $m = 6$\n  - $d_0 = 1000$ bp\n  - $p_A = 0.7$, $p_B = 0.2$\n\n- 测试用例 $2$ (边界在阈值上，簇大小恰好为最小值):\n  - 距离 (bp): [$1000$, $1000$, $1000$, $1000$, $1500$, $999$, $1001$, $1000$]\n  - 上下文 (长度 $9$): [\"TCA\",\"TCT\",\"GCG\",\"ACA\",\"TCG\",\"TCA\",\"GCG\",\"TCT\",\"ACA\"]\n  - $m = 5$\n  - $d_0 = 1000$ bp\n  - $p_A = 0.7$, $p_B = 0.2$\n\n- 测试用例 $3$ (没有簇):\n  - 距离 (bp): [$1500$, $2000$, $3000$]\n  - 上下文 (长度 $4$): [\"ACA\",\"GCG\",\"TTA\",\"GCA\"]\n  - $m = 6$\n  - $d_0 = 1000$ bp\n  - $p_A = 0.7$, $p_B = 0.2$\n\n- 测试用例 $4$ (两个簇，APOBEC计数中等):\n  - 距离 (bp): [$900$, $900$, $900$, $900$, $900$, $2000$, $900$, $900$, $900$, $900$, $900$]\n  - 上下文 (长度 $12$): [\"TCA\",\"GCG\",\"TCT\",\"ACA\",\"TCA\",\"TCG\",\"GCG\",\"ACA\",\"TCT\",\"GCG\",\"TCA\",\"ACA\"]\n  - $m = 6$\n  - $d_0 = 1000$ bp\n  - $p_A = 0.7$, $p_B = 0.2$\n\n- 测试用例 $5$ (边界情况：突变数量少于形成任何簇所需的数量):\n  - 距离 (bp): []\n  - 上下文 (长度 $1$): [\"TCA\"]\n  - $m = 3$\n  - $d_0 = 1000$ bp\n  - $p_A = 0.7$, $p_B = 0.2$\n\n输出规格：\n- 对每个测试用例，输出一个包含两个元素的列表：第一个是识别出的簇的数量（一个整数），第二个是估计的APOBEC比例 $f$ 四舍五入到三位小数（一个浮点数）。\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，例如：\"[[clusters_1,f_1],[clusters_2,f_2],...]\"，其中每个 \"clusters_i\" 是一个整数，每个 \"f_i\" 是一个四舍五入到三位小数的浮点数。", "solution": "该问题陈述经评估是有效的。它在科学上基于癌症基因组学原理，特别是关于突变印记和诸如kataegis等超突变现象。其定义和任务在数学上和算法上都是良构的，为获得唯一解提供了一条清晰客观的路径。所有必要的数据和参数都已提供，没有内部矛盾或歧义。该问题是算法数据处理和统计估计的一个非平凡应用。\n\n解决方案按要求分为两个主要阶段构建：首先，识别kataegis簇；其次，对这些簇内突变的APOBEC归因比例进行统计估计。\n\n一个kataegis簇是基于一个包含 $N$ 个突变 $M_0, M_1, \\ldots, M_{N-1}$ 的序列来定义的。基因组位置没有直接给出，但突变间的距离以一个长度为 $N-1$ 的数组 $D$ 的形式提供，其中 $D[i]$ 是突变 $M_i$ 和 $M_{i+1}$ 之间的距离（以碱基对为单位），$i \\in \\{0, 1, \\ldots, N-2\\}$。一个簇是一个最大的连续突变区块 $M_i, M_{i+1}, \\ldots, M_j$，其中区块大小 $L = j-i+1$ 至少为最小簇大小 $m$，并且区块内所有突变间距离，即对于所有 $k \\in \\{i, i+1, \\ldots, j-1\\}$ 的 $D[k]$，都小于或等于最大距离阈值 $d_0$。\n\n为了识别这些簇，我们首先将距离数组 $D$ 转换为一个布尔数组 $B$，其中如果 $D[i] \\le d_0$ 则 $B[i]$ 为真，否则为假。然后，我们在 $B$ 中识别所有最大的连续真值序列。每个这样的序列，例如在 $D$（或 $B$）中从索引 $i$ 到 $j-1$ 的序列，对应于从突变 $M_i$ 到 $M_j$ 的一个区块。此区块中的突变数量为 $L = j - i + 1$。如果 $L \\ge m$，则该区块符合kataegis簇的条件。算法遍历距离数组，识别这些最大序列，检查其对应的突变计数是否满足 $m$ 的要求，并计算有效、不重叠的簇的数量。使用最大序列确保了簇是不可扩展且不会合并的。\n\n对于第二项任务，我们估计由APOBEC过程导致的聚集性突变的比例 $f$。所有位于已识别簇内的突变都被汇集起来。设 $n$ 为此类突变的总数，设 $k$ 为这些突变中发生在APOBEC相关三核苷酸上下文（定义为“TCA”或“TCT”）中的子集。\n\n问题提出了一个双组分混合模型，用于描述一个聚集性突变具有APOBEC印记的概率。这个概率 $q(f)$ 是由APOBEC过程产生的APOBEC上下文概率 $p_A$ 和由背景过程产生的概率 $p_B$ 的线性组合：\n$$q(f) = f \\cdot p_A + (1-f) \\cdot p_B$$\n其中 $f \\in [0, 1]$ 是由于APOBEC导致的聚集性突变的比例。我们已知 $p_A > p_B$。在 $n$ 个聚集性突变中观察到的APOBEC上下文突变数 $k$ 假定服从二项分布，$k \\sim \\text{Binomial}(n, q(f))$。\n\n在 $n$ 次试验中观察到 $k$ 次成功的似然函数是：\n$$L(f; k, n) = \\binom{n}{k} [q(f)]^k [1-q(f)]^{n-k}$$\n为了找到 $f$ 的最大似然估计（MLE），我们最大化对数似然函数 $\\ell(f) = \\log L(f; k, n)$：\n$$\\ell(f) = \\text{const} + k \\log(q(f)) + (n-k) \\log(1-q(f))$$\n$\\ell(f)$ 对 $f$ 的导数是：\n$$\\frac{d\\ell}{df} = k \\frac{q'(f)}{q(f)} - (n-k) \\frac{q'(f)}{1-q(f)} = (p_A - p_B) \\left( \\frac{k}{q(f)} - \\frac{n-k}{1-q(f)} \\right)$$\n其中 $q'(f) = p_A - p_B$。由于 $p_A > p_B$，令导数为零意味着：\n$$\\frac{k}{q(f)} = \\frac{n-k}{1-q(f)} \\implies k(1-q(f)) = (n-k)q(f) \\implies k = n q(f)$$\n这得出了标准结果，即二项概率参数的MLE是样本比例，$\\hat{q} = k/n$。然后我们可以解出 $f$ 的估计值，记为 $\\hat{f}$：\n$$f p_A + (1-f) p_B = k/n \\implies \\hat{f} = \\frac{k/n - p_B}{p_A - p_B}$$\n这个无约束的估计值必须投影到有效区间 $[0, 1]$ 上。函数 $q(f)$ 在 $f$ 上是单调的，将 $[0, 1]$ 映射到 $[p_B, p_A]$。\n- 如果观察到的比例 $k/n \\le p_B$，似然在边界处最大化，因此 $\\hat{f} = 0$。\n- 如果 $k/n \\ge p_A$，似然在另一边界处最大化，因此 $\\hat{f} = 1$。\n- 否则，无约束的估计值位于 $[0, 1]$ 内，是有效的MLE。\n\n因此，$f$ 的最终估计量是：\n$$\\hat{f}_{MLE} = \\max\\left(0, \\min\\left(1, \\frac{k/n - p_B}{p_A - p_B}\\right)\\right)$$\n如果没有找到簇，则 $n=0$。在这种情况下，根据问题约定，我们定义 $\\hat{f} = 0$。\n\n对每个测试用例实施这个由两部分组成的程序，以产生所需的输出。", "answer": "[[2,1.000],[1,0.400],[0,0.000],[2,0.433],[0,0.000]]", "id": "2857997"}, {"introduction": "癌症基因组学研究的一个核心目标是区分促进癌症发展的“驱动”突变和随机发生的“乘客”突变。这项挑战性的练习将指导你构建一个完整的统计分析流程，用于在整个患者队列中识别显著突变的基因。你将学习如何构建一个考虑了样本间背景突变率差异和基因长度等混杂因素的零假设模型，并应用多重检验校正来控制假阳性发现。[@problem_id:2858052]", "problem": "您将执行一项统计建模任务，其动机源于癌症的遗传学基础：检测体细胞突变中受到正向选择的基因，同时考虑到覆盖度不均和超突变样本的影响。构建一个完整的程序，该程序需针对每个提供的测试用例，在一个中性突变的无效模型下计算每个基因的单边显著性，然后应用多重假设校正，将错误发现率（FDR）控制在 $q=0.1$ 的水平。您的程序必须按照下述格式，将每个测试用例中被判定为显著突变的基因索引聚合在一行中输出。\n\n需使用的基本原理：\n- 将脱氧核糖核酸（DNA）上的突变建模为在可调用碱基上发生的稀有且近似独立的事件。根据稀有事件定律，大量具有很小 $p$ 值的独立伯努利（Bernoulli($p$)）试验的总和近似于一个泊松分布，其参数等于期望计数。\n- 独立泊松变量的可加性：如果 $X_1 \\sim \\mathrm{Poisson}(\\lambda_1)$ 和 $X_2 \\sim \\mathrm{Poisson}(\\lambda_2)$ 是独立的，那么 $X_1 + X_2 \\sim \\mathrm{Poisson}(\\lambda_1 + \\lambda_2)$。\n- 使用 Benjamini–Hochberg (BH) 程序，在目标水平 $q$ 控制错误发现的期望比例（错误发现率，FDR）。\n\n每个测试用例的输入：\n- 一个包含 $S$ 个肿瘤样本和 $G$ 个基因的队列。\n- 一个样本特异性的背景单位碱基突变率向量 $\\mu = [\\mu_1, \\ldots, \\mu_S]$，其中 $\\mu_s$ 是样本 $s$ 中每个可调用碱基的期望中性突变概率。\n- 一个可调用碱基矩阵 $C \\in \\mathbb{R}^{G \\times S}$，其中 $C_{g,s}$ 是基因 $g$ 在样本 $s$ 中的可调用编码碱基数。\n- 一个基因特异性的突变性修饰因子向量 $r = [r_1, \\ldots, r_G]$，它根据基因层面的特征（例如，核苷酸上下文或复制时间）对期望突变进行乘法调整。\n- 一个队列中每个基因的观测突变计数向量 $M = [M_1, \\ldots, M_G]$。\n\n无效模型与检验：\n- 在中性和样本间独立的假设下，为每个基因 $g$ 定义期望突变计数\n$$\nE_g \\;=\\; r_g \\sum_{s=1}^{S} C_{g,s} \\,\\mu_s \\, .\n$$\n- 无效假设下的总观测突变计数 $X_g$ 被建模为\n$$\nX_g \\sim \\mathrm{Poisson}(E_g) \\, .\n$$\n- 计算富集的单边 $p$ 值如下\n$$\np_g \\;=\\; \\mathbb{P}\\!\\left( X_g \\ge M_g \\,\\middle|\\, X_g \\sim \\mathrm{Poisson}(E_g) \\right) \\, .\n$$\n- 特殊情况：如果 $E_g = 0$，当 $M_g = 0$ 时定义 $p_g = 1$，当 $M_g \\ge 1$ 时定义 $p_g = 0$。\n\n多重检验：\n- 对集合 $\\{p_g\\}_{g=1}^{G}$ 应用 Benjamini–Hochberg 程序，水平为 $q = 0.1$：\n  1. 将 $p$ 值按升序排序得到 $p_{(1)} \\le \\cdots \\le p_{(m)}$，其中 $m = G$，并设 $p_{(i)}$ 在原始排序中的索引为 $j(i)$。\n  2. 找到满足 $p_{(k)} \\le \\frac{k}{m} q$ 的最大 $k$。\n  3. 宣布所有满足 $p_g \\le p_{(k)}$ 的基 क्योंकि显著。如果不存在这样的 $k$，则不选择任何基因。\n- 使用从零开始的索引报告显著基因的索引。\n\n您的程序必须实现上述过程，并对以下测试套件运行。对于每个测试用例，您必须完全按照给定的参数进行操作。\n\n测试用例 1 （理想路径，包含不均匀覆盖度和一个超突变样本）：\n- $q = 0.1$。\n- $S = 5$, $G = 6$。\n- 样本突变率 $\\mu$：\n$$\n\\mu = [\\,1\\times 10^{-6},\\; 2\\times 10^{-6},\\; 5\\times 10^{-6},\\; 1\\times 10^{-6},\\; 1\\times 10^{-5}\\,] \\, .\n$$\n- 基因修饰因子 $r$：\n$$\nr = [\\,1.0,\\; 1.0,\\; 1.5,\\; 1.0,\\; 0.5,\\; 1.0\\,] \\, .\n$$\n- 可调用碱基矩阵 $C$（行为基因 $g=0,\\ldots,5$，列为样本 $s=0,\\ldots,4$）：\n$$\nC = \\begin{bmatrix}\n1500  1400  1600  1300  1500\\\\\n2000  2000  2000  2000  2000\\\\\n3000  1000  500   1500  2500\\\\\n0     0     0     0     0\\\\\n10000 10000 10000 10000 10000\\\\\n500   500   500   500   500\n\\end{bmatrix} \\, .\n$$\n- 观测计数 $M$：\n$$\nM = [\\,3,\\; 0,\\; 1,\\; 0,\\; 0,\\; 1\\,] \\, .\n$$\n\n测试用例 2 （边界条件，包括零覆盖度的基因和期望值极低但有一个突变的基因）：\n- $q = 0.1$。\n- $S = 3$, $G = 4$。\n- 样本突变率 $\\mu$：\n$$\n\\mu = [\\,1\\times 10^{-7},\\; 2\\times 10^{-7},\\; 1\\times 10^{-6}\\,] \\, .\n$$\n- 基因修饰因子 $r$：\n$$\nr = [\\,1.0,\\; 1.0,\\; 1.0,\\; 0.5\\,] \\, .\n$$\n- 可调用碱基矩阵 $C$：\n$$\nC = \\begin{bmatrix}\n0      0      0\\\\\n10     0      0\\\\\n100000 100000 100000\\\\\n5000   0      0\n\\end{bmatrix} \\, .\n$$\n- 观测计数 $M$：\n$$\nM = [\\,0,\\; 1,\\; 0,\\; 0\\,] \\, .\n$$\n\n测试用例 3 （超突变样本和样本间非均匀覆盖）：\n- $q = 0.1$。\n- $S = 4$, $G = 5$。\n- 样本突变率 $\\mu$：\n$$\n\\mu = [\\,3\\times 10^{-6},\\; 3\\times 10^{-6},\\; 3\\times 10^{-6},\\; 5\\times 10^{-5}\\,] \\, .\n$$\n- 基因修饰因子 $r$：\n$$\nr = [\\,1.0,\\; 1.0,\\; 1.0,\\; 1.0,\\; 10.0\\,] \\, .\n$$\n- 可调用碱基矩阵 $C$：\n$$\nC = \\begin{bmatrix}\n2000  2000  2000  2000\\\\\n5000  5000  5000  5000\\\\\n50000 50000 50000 50000\\\\\n10000 10000 10000 0\\\\\n2000  2000  2000  2000\n\\end{bmatrix} \\, .\n$$\n- 观测计数 $M$：\n$$\nM = [\\,0,\\; 4,\\; 3,\\; 2,\\; 0\\,] \\, .\n$$\n\n计算与报告要求：\n- 对于每个测试用例，计算 $E_g$，然后计算 $p_g$，再应用 Benjamini–Hochberg 程序（$q=0.1$）来选择显著基因。基因索引使用从零开始的索引。\n- 您的程序应生成单行输出，其中包含所有测试用例的结果，格式为一个由方括号括起来、由逗号分隔的整数列表的列表，且不含空格。例如，如果三个结果分别是列表 $[\\,0,2,5\\,]$、$[\\,1\\,]$ 和 $[\\,1,3\\,]$，则确切的输出应为\n“[ [0,2,5],[1],[1,3] ]” 但不含空格，即：\n$$\n[\\,[0,2,5],[1],[1,3]\\,] \\, .\n$$\n您的程序必须以该格式精确打印一行。", "solution": "问题陈述是计算统计学和生物信息学领域一项有效且定义明确的任务。它要求实现一个标准统计模型，用于在癌症队列中识别受正向选择的基因。所有必要的参数和数学过程均已明确提供，无歧义或矛盾之处。该模型基于群体遗传学和统计学的既定原则，具有科学依据。它是可形式化的、可验证的，并且不含主观内容。我将继续提供解决方案。\n\n目标是与一个中性突变背景模型相比，识别出那些携带统计上显著过量体细胞突变的基因。此过程将为多个测试用例执行，并报告显著基因的索引。整个过程涉及三个主要阶段：\n$1$. 在无效模型下计算期望突变计数。\n$2$. 通过泊松分布进行统计检验，为每个基因推导出一个 $p$ 值。\n$3$. 使用 Benjamini-Hochberg 程序进行多重假设检验校正，以控制错误发现率。\n\n我将详细说明算法的每个阶段。\n\n**阶段 1：计算期望突变计数 ($E_g$)**\n\n无效假设假定突变在整个基因组中是中性发生的。基因 $g$ 中的期望突变数（记为 $E_g$）由基因的大小、其内在突变性以及队列中样本的背景突变率共同决定。\n\n已知：\n- 一个包含 $S$ 个样本和 $G$ 个基因的队列。\n- 一个样本特异性的单位碱基突变率向量 $\\mu = [\\mu_1, \\ldots, \\mu_S]$。\n- 一个可调用编码碱基矩阵 $C \\in \\mathbb{R}^{G \\times S}$，其中 $C_{g,s}$ 是基因 $g$ 在样本 $s$ 中可供突变的碱基数量。\n- 一个基因特异性的突变性修饰因子向量 $r = [r_1, \\ldots, r_G]$。\n\n对于单个样本 $s$ 中的单个基因 $g$，其期望突变数是可调用碱基数、样本特异性突变率和基因特异性修饰因子的乘积：$r_g C_{g,s} \\mu_s$。\n\n该问题基于突变事件在样本间是独立的这一原则。这使我们能够利用期望的可加性（以及稍后将用到的泊松变量的可加性）。基因 $g$ 在所有 $S$ 个样本中的总期望突变计数是来自每个样本的期望值之和：\n$$\nE_g = r_g \\sum_{s=1}^{S} C_{g,s} \\mu_s\n$$\n对每个基因 $g \\in \\{1, \\ldots, G\\}$ 都执行此计算。在矩阵表示法中，设 $\\mu$ 为列向量，此计算等同于向量 $r$ 与矩阵-向量积 $C\\mu$ 的结果进行逐元素相乘。\n\n**阶段 2：P 值计算**\n\n问题陈述指出，在无效假设下，基因中观测到的突变数 $X_g$ 服从泊松分布，其速率参数等于期望计数 $E_g$。即 $X_g \\sim \\mathrm{Poisson}(E_g)$。这是由稀有事件定律所支持的，因为突变是沿 DNA 序列的稀疏事件。\n\n给定观测突变计数的向量 $M = [M_1, \\ldots, M_G]$。对于每个基因 $g$，我们通过计算单边 $p$ 值来检验突变的富集情况。$p$ 值 $p_g$ 是在无效分布下观测到至少 $M_g$ 个突变的概率：\n$$\np_g = \\mathbb{P}(X_g \\ge M_g \\,|\\, X_g \\sim \\mathrm{Poisson}(E_g))\n$$\n该概率使用泊松分布的生存函数（SF）进行计算。生存函数定义为 $\\mathrm{SF}(k-1, \\lambda) = \\mathbb{P}(X \\ge k \\text{ for } X \\sim \\mathrm{Poisson}(\\lambda))$。\n\n定义了两种特殊情况：\n- 如果 $E_g > 0$：$p_g = \\sum_{k=M_g}^{\\infty} \\frac{e^{-E_g} E_g^k}{k!}$。\n- 如果 $E_g = 0$：观测到任何突变的概率为 $0$。因此，如果 $M_g=0$，观测结果与期望完全一致，$p_g=1$。如果 $M_g > 0$，观测结果在无效模型下是不可能的，这代表了一种极端的偏差，因此 $p_g=0$。\n\n**阶段 3：多重假设检验校正**\n\n当同时进行许多统计检验时（$G$ 个基因中的每一个都进行一次检验），需要进行多重比较校正以避免假阳性数量的膨胀。该问题规定使用 Benjamini-Hochberg (BH) 程序将错误发现率（FDR）控制在 $q = 0.1$ 的水平。FDR 是被拒绝的无效假设中被错误拒绝的期望比例。\n\nBH 程序如下：\n$1$. 收集所有 $G$ 个基因的 $p$ 值：$\\{p_1, p_2, \\ldots, p_G\\}$。令 $m=G$。\n$2$. 将这些 $p$ 值按升序排序：$p_{(1)} \\le p_{(2)} \\le \\cdots \\le p_{(m)}$。设 $p$ 值为 $p_{(i)}$ 的基因的原始索引为 $j(i)$。\n$3$. 找到最大的整数 $k \\in \\{1, \\ldots, m\\}$，使得排序后的 $p$ 值 $p_{(k)}$ 满足以下条件：\n$$\np_{(k)} \\le \\frac{k}{m} q\n$$\n$4$. 如果存在这样的 $k$，则所有原始 $p$ 值小于或等于阈值 $p_{(k)}$ 的基因都被宣布为统计显著。也就是说，我们识别所有满足 $p_g \\le p_{(k)}$ 的基因 $g$。\n$5$. 如果不存在这样的 $k$（即对于所有 $i$都有 $p_{(i)} > \\frac{i}{m} q$），则没有基因被宣布为显著。\n\n每个测试用例的最终输出是一个列表，其中包含通过此程序被宣布为显著的基因的从零开始的索引。然后，所有测试用例的列表被聚合成一个单一的列表的列表。", "answer": "[[0,2,5],[1],[1,3]]", "id": "2858052"}]}