{"hands_on_practices": [{"introduction": "要真正理解霍尔丹法则，我们必须首先对其底层的遗传机制进行建模。本练习将引导您运用经典的 Dobzhansky-Muller 不相容性（DMI）模型，该模型涉及一个 X 连锁基因座和一个常染色体基因座。通过推导正反交的遗传结果，您将亲眼见证霍尔丹法则所描述的杂种适合度不对称性，是如何从孟德尔遗传和显性等基本原理中产生的。[@problem_id:2820483]", "problem": "两个物种 $\\mathrm{S}_1$ 和 $\\mathrm{S}_2$，在形成杜布赞斯基-马勒不相容性 (DMI) 的两个位点上，分别固定了不同的等位基因。一个位点位于 $X$ 染色体上（等位基因为 $X^{a}$ 祖先型，$X^{d}$ 衍生型），另一个位点是常染色体位点（等位基因为 $A^{a}$ 祖先型，$A^{d}$ 衍生型）。物种 $\\mathrm{S}_1$ 在 $X$ 连锁位点上固定为 $X^{d}$，在常染色体位点上固定为 $A^{a}$；物种 $\\mathrm{S}_2$ 在相应位点上分别固定为 $X^{a}$ 和 $A^{d}$。假设采用 $XY$ 型性别决定系统，雄性为异配性别 ($XY$)，雌性为同配性别 ($XX$)。子一代 (F1) 由正反交产生，遵循标准的孟德尔式遗传，且每次杂交的后代性别比为 $1{:}1$。\n\n当衍生等位基因相遇且不被显性所掩盖时，会表现出 DMI 表型（不存活或不育）。考虑 DMI 的两种显性模型：\n\n- 模型 A（经典的 $X$ 连锁隐性与常染色体显性相互作用）：衍生的 $X$ 连锁等位基因 $X^{d}$ 在二倍体雌性中完全隐性，在半合子雄性中完全表达；衍生的常染色体等位基因 $A^{d}$ 在相互作用中完全显性（一个拷贝即可）。当且仅当一个个体同时携带 $A^{d}$（处于任何 $A^{a}/A^{d}$ 或 $A^{d}/A^{d}$ 状态）并且 $X^{d}$ 处于表达状态（雄性为半合子 $X^{d}/Y$ 或雌性为纯合子 $X^{d}/X^{d}$）时，该个体才表现出 DMI 表型。\n- 模型 B（两个衍生等位基因均为完全隐性）：衍生的 $X$ 连锁等位基因 $X^{d}$ 在二倍体雌性中完全隐性，在半合子雄性中完全表达；衍生的常染色体等位基因 $A^{d}$ 完全隐性，需要 $A^{d}/A^{d}$ 才会导致 DMI。当且仅当一个个体为 $A^{d}/A^{d}$ 并且 $X^{d}$ 处于表达状态（半合子 $X^{d}/Y$ 或纯合子 $X^{d}/X^{d}$）时，该个体才表现出 DMI 表型。\n\n任务：\n1. 构建两个正反交组合 $\\mathrm{S}_1 \\, \\female \\times \\mathrm{S}_2 \\, \\male$ 和 $\\mathrm{S}_2 \\, \\female \\times \\mathrm{S}_1 \\, \\male$ 在 $X$ 连锁和常染色体 DMI 位点上的预期 F1 基因型，分别列出 F1 雌性和 F1 雄性的基因型。\n2. 对于每种显性模型（模型 A 和模型 B），确定在每个正反交组合和每种性别中，哪些 F1 基因型（如果有的话）会表现出 DMI 表型，并根据孟德尔遗传和显性/半合性的基本原理证明你的判断。\n3. 假设两个正反交方向的发生概率相等，且每个 F1 家系的性别比为 $1{:}1$，仅在模型 A 下，计算所有 F1 个体（包括两个杂交方向和两种性别）中将表现出 DMI 表型的预期比例。将你的最终答案表示为最简分数。", "solution": "该问题陈述具有科学依据，提法严谨且客观。它提供了一套完整且一致的既定条件，用以模拟杜布赞斯基-马勒不相容性 (DMI) 的一个经典案例，这是物种形成遗传学中的一个基本概念。所有关于亲本基因型、遗传模式以及 DMI 表型表达的具体条件的必要信息都得到了明确定义。因此，可以从基本原理推导出一个严谨的解答。\n\n解答分为三部分，对应问题陈述中指定的任务。\n\n### 任务 1：确定 F1 基因型\n\n我们必须确定物种 $\\mathrm{S}_1$ 和 $\\mathrm{S}_2$ 之间正反交产生的子一代 ($F_1$) 的基因型。性别决定系统为 $XY$ 型，其中雄性为异配性别 ($XY$)，雌性为同配性别 ($XX$)。$X$ 染色体携带一个 DMI 位点，一条常染色体携带第二个位点。\n\n亲本物种 ($\\mathrm{P}$) 具有以下基因型：\n-   物种 $\\mathrm{S}_1$：雌性为 $X^{d}X^{d}; A^{a}A^{a}$，雄性为 $X^{d}Y; A^{a}A^{a}$。\n-   物种 $\\mathrm{S}_2$：雌性为 $X^{a}X^{a}; A^{d}A^{d}$，雄性为 $X^{a}Y; A^{d}A^{d}$。\n\n我们分别分析每个正反交组合。\n\n**杂交组合 1：$\\mathrm{S}_1$ 雌性 $\\times$ $\\mathrm{S}_2$ 雄性**\n-   亲本基因型：$\\mathrm{S}_1 \\, \\female (X^{d}X^{d}; A^{a}A^{a}) \\times \\mathrm{S}_2 \\, \\male (X^{a}Y; A^{d}A^{d})$。\n-   配子产生：\n    -   $\\mathrm{S}_1$ 雌性只产生一种类型的配子：$X^{d}; A^{a}$。\n    -   $\\mathrm{S}_2$ 雄性以相等比例产生两种类型的配子：$X^{a}; A^{d}$ 和 $Y; A^{d}$。\n-   产生的 $F_1$ 后代：\n    -   $F_1$ 雌性：一个 $X^{d}; A^{a}$ 卵细胞被一个 $X^{a}; A^{d}$ 精子受精，产生基因型 $X^{d}X^{a}; A^{a}A^{d}$。\n    -   $F_1$ 雄性：一个 $X^{d}; A^{a}$ 卵细胞被一个 $Y; A^{d}$ 精子受精，产生基因型 $X^{d}Y; A^{a}A^{d}$。\n\n**杂交组合 2：$\\mathrm{S}_2$ 雌性 $\\times$ $\\mathrm{S}_1$ 雄性**\n-   亲本基因型：$\\mathrm{S}_2 \\, \\female (X^{a}X^{a}; A^{d}A^{d}) \\times \\mathrm{S}_1 \\, \\male (X^{d}Y; A^{a}A^{a})$。\n-   配子产生：\n    -   $\\mathrm{S}_2$ 雌性只产生一种类型的配子：$X^{a}; A^{d}$。\n    -   $\\mathrm{S}_1$ 雄性以相等比例产生两种类型的配子：$X^{d}; A^{a}$ 和 $Y; A^{a}$。\n-   产生的 $F_1$ 后代：\n    -   $F_1$ 雌性：一个 $X^{a}; A^{d}$ 卵细胞被一个 $X^{d}; A^{a}$ 精子受精，产生基因型 $X^{a}X^{d}; A^{d}A^{a}$。\n    -   $F_1$ 雄性：一个 $X^{a}; A^{d}$ 卵细胞被一个 $Y; A^{a}$ 精子受精，产生基因型 $X^{a}Y; A^{d}A^{a}$。\n\n$F_1$ 基因型总结：\n-   来自杂交组合 $\\mathrm{S}_1 \\, \\female \\times \\mathrm{S}_2 \\, \\male$：\n    -   雌性：$X^{d}X^{a}; A^{a}A^{d}$\n    -   雄性：$X^{d}Y; A^{a}A^{d}$\n-   来自杂交组合 $\\mathrm{S}_2 \\, \\female \\times \\mathrm{S}_1 \\, \\male$：\n    -   雌性：$X^{a}X^{d}; A^{d}A^{a}$ (注意：这与杂交组合 1 的雌性基因型相同)\n    -   雄性：$X^{a}Y; A^{d}A^{a}$\n\n### 任务 2：确定 F1 的不存活/不育性\n\n我们现在将每种指定模型下 DMI 表型的条件应用于上面推导出的 $F_1$ 基因型。\n\n**模型 A 的分析：**\n当且仅当一个个体满足以下条件时，表现出 DMI 表型：\n$1$. 携带至少一个衍生的常染色体等位基因 $A^{d}$（显性）。\n$2$. 衍生的 $X$ 连锁等位基因 $X^{d}$ 处于表达状态，即雄性为半合子 ($X^{d}Y$) 或雌性为纯合子 ($X^{d}X^{d}$)，因为 $X^{d}$ 是隐性的。\n\n-   **$F_1$ 雌性 (来自两个杂交组合的 $X^{d}X^{a}; A^{a}A^{d}$)：**\n    -   条件 $1$：她们是杂合子 $A^{a}A^{d}$，因此携带 $A^{d}$ 等位基因。条件满足。\n    -   条件 $2$：她们是杂合子 $X^{d}X^{a}$。由于 $X^{d}$ 对 $X^{a}$ 是隐性的，该等位基因不处于表达状态。条件不满足。\n    -   结论：在模型 A 下，$F_1$ 雌性**不受** DMI 影响。\n\n-   **来自杂交组合 1 ($\\mathrm{S}_1\\female \\times \\mathrm{S}_2\\male$) 的 $F_1$ 雄性，基因型 $X^{d}Y; A^{a}A^{d}$：**\n    -   条件 $1$：他们是杂合子 $A^{a}A^{d}$，因此携带 $A^{d}$ 等位基因。条件满足。\n    -   条件 $2$：他们是半合子 $X^{d}Y$。$X^{d}$ 等位基因处于表达状态。条件满足。\n    -   结论：来自该杂交组合的 $F_1$ 雄性在模型 A 下**受** DMI 影响。\n\n-   **来自杂交组合 2 ($\\mathrm{S}_2\\female \\times \\mathrm{S}_1\\male$) 的 $F_1$ 雄性，基因型 $X^{a}Y; A^{d}A^{a}$：**\n    -   条件 $1$：他们是杂合子 $A^{d}A^{a}$，因此携带 $A^{d}$ 等位基因。条件满足。\n    -   条件 $2$：他们是半合子 $X^{a}Y$。他们不携带 $X^{d}$ 等位基因。条件不满足。\n    -   结论：来自该杂交组合的 $F_1$ 雄性在模型 A 下**不受** DMI 影响。\n\n**模型 B 的分析：**\n当且仅当一个个体满足以下条件时，表现出 DMI 表型：\n$1$. 是衍生的常染色体等位基因的纯合子 $A^{d}A^{d}$（隐性）。\n$2$. 衍生的 $X$ 连锁等位基因 $X^{d}$ 处于表达状态 ($X^{d}Y$ 或 $X^{d}X^{d}$)。\n\n-   **$F_1$ 雌性 (来自两个杂交组合的 $X^{d}X^{a}; A^{a}A^{d}$)：**\n    -   条件 $1$：她们是杂合子 $A^{a}A^{d}$。她们不是纯合子 $A^{d}A^{d}$。条件不满足。\n    -   结论：在模型 B 下，$F_1$ 雌性**不受** DMI 影响。\n\n-   **来自杂交组合 1 的 $F_1$ 雄性 ($X^{d}Y; A^{a}A^{d}$)：**\n    -   条件 $1$：他们是杂合子 $A^{a}A^{d}$。他们不是纯合子 $A^{d}A^{d}$。条件不满足。\n    -   结论：来自该杂交组合的 $F_1$ 雄性在模型 B 下**不受** DMI 影响。\n\n-   **来自杂交组合 2 的 $F_1$ 雄性 ($X^{a}Y; A^{d}A^{a}$)：**\n    -   条件 $1$：他们是杂合子 $A^{d}A^{a}$。他们不是纯合子 $A^{d}A^{d}$。条件不满足。\n    -   结论：来自该杂交组合的 $F_1$ 雄性在模型 B 下**不受** DMI 影响。\n\n总之，在模型 B 下，没有任何 $F_1$ 基因型表现出 DMI 表型。不相容性仅在模型 A 下的 $F_1$ 代中出现，并且仅出现在其中一个正反交组合的雄性中。这种在异配性别中的不对称结果是霍尔丹法则 (Haldane's rule) 的一个经典例子。\n\n### 任务 3：模型 A 下受影响 F1 个体的比例\n\n我们被要求计算在模型 A 下表现出 DMI 表型的所有 $F_1$ 个体的预期比例。问题陈述假设两个正反交方向的发生概率相等，且每次杂交产生 $1:1$ 的性别比。\n\n设 $F_1$ 后代的总群体数量为 $N$。\n-   来自杂交组合 1 ($\\mathrm{S}_1\\female \\times \\mathrm{S}_2\\male$) 的后代数量为 $\\frac{1}{2}N$。\n-   来自杂交组合 2 ($\\mathrm{S}_2\\female \\times \\mathrm{S}_1\\male$) 的后代数量为 $\\frac{1}{2}N$。\n\n在每个杂交组合中，后代一半是雌性，一半是雄性。因此，总的 $F_1$ 群体由四个大小相等的组构成，每组占总数的 $\\frac{1}{4}$：\n$1$. 来自杂交组合 1 的雌性：比例 $\\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n$2$. 来自杂交组合 1 的雄性：比例 $\\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n$3$. 来自杂交组合 2 的雌性：比例 $\\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n$4$. 来自杂交组合 2 的雄性：比例 $\\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n\n根据任务 2 中对模型 A 的分析：\n-   组 1（雌性，杂交组合 1）：全部不受影响。对受影响比例的贡献为 $0$。\n-   组 2（雄性，杂交组合 1）：全部受影响。对受影响比例的贡献为 $\\frac{1}{4}$。\n-   组 3（雌性，杂交组合 2）：全部不受影响。对受影响比例的贡献为 $0$。\n-   组 4（雄性，杂交组合 2）：全部不受影响。对受影响比例的贡献为 $0$。\n\n受影响个体的总预期比例是来自这四个组的受影响个体比例的总和：\n$$ \\text{Total Proportion Affected} = 0 + \\frac{1}{4} + 0 + 0 = \\frac{1}{4} $$\n\n因此，在模型 A 下，预计总 $F_1$ 后代中恰好有四分之一会表现出 DMI 表型。", "answer": "$$\\boxed{\\frac{1}{4}}$$", "id": "2820483"}, {"introduction": "在模拟了单个不相容性位点后，下一步是思考其在全基因组范围内的后果。本练习旨在挑战您将霍尔丹法则的显性理论与“大 X 效应”联系起来，即 X 染色体在杂种不相容性中往往起着不成比例的巨大作用这一现象。此练习需要进行定性推理和简单的定量表述，从而加深您对遗传理论与可观测基因组模式之间联系的理解。[@problem_id:2720963]", "problem": "在 `Drosophila simulans` 物种复合体中，`Drosophila simulans` 与其姐妹种之间的种间杂交常常产生不育的 $F_{1}$ 代杂种雄性，这与Haldane法则（即异配性别更常出现不育或不存活现象）相符。设想一个研究项目，使用基因渗入系、数量性状基因座（QTL）定位和缺失定位来确定杂种雄性不育基因座的位置。该研究报告了X染色体和常染色体上存在多个杂种雄性不育基因座。请你根据物种形成遗传学的基本原理，论证为什么预期X染色体对杂种雄性不育有不成比例的贡献（即巨大的X效应），然后计算已定位基因座的基因组分布的一个汇总统计量。\n\n使用以下基本原理和事实：\n- Haldane法则：在杂种中，异配性别更可能不育或不存活。\n- Dobzhansky–Muller不相容性：杂种功能障碍源于在隔离状态下演化出的不同等位基因之间的负向上位性相互作用。\n- 针对Haldane法则的显性理论：如果许多不相容性等位基因是部分隐性的，那么在异配性别中，X染色体的半合子性会暴露隐性的X连锁不相容性，从而增加X连锁不育的发生率和表现度。\n- 来自 `Drosophila simulans` 复合体的证据表明，杂种雄性不育定位于X染色体上的多个区间；半合子的X片段在其他方面均为同种遗传背景下足以导致雄性不育；以及在可比较的基因组尺度上测量时，检测到的常染色体区间效应较少或较弱。\n\n首先，用不超过几句话的篇幅，阐述一个基于机理的论证，解释为什么在该系统中，X连锁的杂种雄性不育现象预计会很普遍。然后，设 $n_{X}$ 为定位于X染色体上的杂种雄性不育基因座的数量，设 $n_{A}$ 为定位于常染色体上的数量。将已定位的基因座总数定义为 $N$，将定位于X连锁的不育基因座的比例定义为 $f_{X}$。推导一个以 $n_{X}$ 和 $n_{A}$ 为函数的 $f_{X}$ 表达式，并以最简代数形式报告此比例。你的最终答案必须是仅含 $n_{X}$ 和 $n_{A}$ 的单个闭式表达式。不需要进行数值计算，也不涉及单位。", "solution": "该问题以物种形成遗传学和杂种功能障碍的成因为背景，援引了Haldane法则和Dobzhansky–Muller模型。我们从公认的原理和观察出发，然后计算所要求的比例。\n\n巨大X效应的机理论证：\n- 根据Dobzhansky–Muller模型，杂种功能障碍是由在不同谱系中独立演化出的等位基因之间的负向上位性造成的。如果许多这类不相容性等位基因是部分隐性的，那么它们在杂合子中的效应会被掩盖，但在纯合或半合状态下会表达出来。\n- 在果蝇中，雄性是异配性别（$X Y$）。雄性中的X连锁等位基因是半合子的，因此任何部分隐性的X连锁不相容性在 $F_{1}$ 代雄性中都会完全暴露出来，而常染色体不相容性则保持被掩盖状态，除非处于适当的纯合状态或特定的上位性组合中。这就是对Haldane法则的显性理论解释。\n- 在 `Drosophila simulans` 复合体中的经验证据表明，基因渗入和缺失定位已反复证明，将一个物种的小段X连锁片段替换到另一个物种的遗传背景中，就足以导致雄性不育，并且许多不同的X连锁区间都有贡献，而在定位分辨率和基因组覆盖度相当的情况下，检测到的常染色体区间效应较少或较弱。这些观察结果强化了X连锁杂种雄性不育基因座数量众多且效应显著的预期。\n\nX连锁基因座比例的计算：\n- 设 $n_{X}$ 表示定位于X染色体上的杂种雄性不育基因座的数量，设 $n_{A}$ 表示定位于常染色体上的数量。已定位的基因座总数是两者的和\n$$\nN = n_{X} + n_{A}.\n$$\n- X连锁的已定位不育基因座的比例（记作 $f_{X}$）定义为X连锁基因座的数量除以已定位基因座的总数。因此，\n$$\nf_{X} = \\frac{n_{X}}{N} = \\frac{n_{X}}{n_{X} + n_{A}}.\n$$\n该表达式已为最简代数形式，并满足题目要求，即仅含 $n_{X}$ 和 $n_{A}$ 的单个闭式表达式。", "answer": "$$\\boxed{\\frac{n_{X}}{n_{X}+n_{A}}}$$", "id": "2720963"}, {"introduction": "从理论走向应用，这最后一个练习让您扮演一位现代物种形成基因组学家的角色。您将使用一个给定的统计模型和假设的基因组数据，通过最大似然估计来量化雄性和雌性中针对渗入的 X 染色体片段的选择强度。这个练习展示了如何利用真实世界的数据来检验和参数化杂种不相容性的理论模型，为进化遗传学中的定量分析提供了实践入门。[@problem_id:2720969]", "problem": "您将获得一个简化但有原则的模型，用于推断与霍尔丹法则（Haldane's rule）一致的、针对X染色体（记为X）上渗入祖源的性别特异性选择。该推断基于全基因组祖源比例、性别标签以及在一个X连锁基因座上观察到的单倍体祖源状态。您必须使用的核心原则是标准的、基于等位基因频率的确定性生存力选择。\n\n基本原理：\n- 设 $p$ 为个体中随机选择的一个单倍体X连锁等位基因来源于来源群体 $\\mathsf{A}$ 的选择前概率。在中性条件下，$p$ 等于该个体来源于群体 $\\mathsf{A}$ 的全基因组祖源比例 $q$。\n- 在生存力选择下，存活的单倍体等位基因中的选择后等位基因频率 $p^{\\prime}$ 由 $p^{\\prime} = \\dfrac{p \\, w_{\\mathsf{A}}}{p \\, w_{\\mathsf{A}} + (1 - p) \\, w_{\\mathsf{B}}}$ 给出，其中 $w_{\\mathsf{A}}$ 和 $w_{\\mathsf{B}}$ 分别是与来自群体 $\\mathsf{A}$ 和 $\\mathsf{B}$ 的等位基因相关的相对适应度值。这是基础群体遗传学中经典的选择加权归一化。假设 $w_{\\mathsf{B}} = 1$ 且 $w_{\\mathsf{A}} = 1 - s_{z}$，其中 $z \\in \\{0,1\\}$ 编码性别，$z = 0$ 代表雌性，$z = 1$ 代表雄性。\n- 因此，对于一个全基因组祖源比例为 $q$、性别为 $z$ 的个体，其携带的被抽样单倍体X连锁等位基因在选择后来源于群体 $\\mathsf{A}$ 的概率为\n$$\n\\pi(q,z;s_f,s_m) \\equiv \\frac{q \\, (1 - s_z)}{q \\, (1 - s_z) + (1 - q)},\n$$\n其中 $s_0 = s_f$ 和 $s_1 = s_m$ 是针对来自群体 $\\mathsf{A}$ 的渗入性X连锁祖源的未知性别特异性选择系数。\n\n统计模型：\n- 对于每个单倍体X连锁观测值 $j$，您将获得个体的全基因组祖源比例 $q_j \\in [0,1]$、性别 $z_j \\in \\{0,1\\}$，以及一个X连锁基因座的二元单倍体祖源指示符 $y_j \\in \\{0,1\\}$，其中 $y_j = 1$ 表示祖源来自群体 $\\mathsf{A}$，$y_j = 0$ 表示祖源来自群体 $\\mathsf{B}$。\n- 假设独立的伯努利抽样，成功概率为 $\\pi(q_j,z_j;s_f,s_m)$。需要最大化的对数似然函数为\n$$\n\\ell(s_f,s_m) = \\sum_{j=1}^{n} \\left[ y_j \\, \\log \\pi(q_j,z_j;s_f,s_m) + (1 - y_j) \\, \\log \\left(1 - \\pi(q_j,z_j;s_f,s_m)\\right) \\right].\n$$\n- 参数必须满足 $0 \\le s_f  1$ 和 $0 \\le s_m  1$。\n\n任务：\n- 通过在上述边界条件下最大化 $\\ell(s_f,s_m)$，实现最大似然估计（MLE）以获得估计值 $\\hat{s}_f$ 和 $\\hat{s}_m$。使用带边界约束的数值优化器。\n- 判断这些估计值是否与针对雄性异配（雄性为异配性别）的霍尔丹法则一致，该法则预测雄性中针对渗入性X祖源的选择比雌性更强。定义一个决策阈值 $\\tau = 0.05$，并且当且仅当 $\\hat{s}_m - \\hat{s}_f  \\tau$ 时，宣布数据与霍尔丹法则一致。\n\n数值和输出要求：\n- 报告 $\\hat{s}_m$ 和 $\\hat{s}_f$，四舍五入到三位小数。不涉及物理单位。\n- 对于每个测试用例，返回一个包含三个元素的列表：四舍五入的 $\\hat{s}_m$（浮点数）、四舍五入的 $\\hat{s}_f$（浮点数），以及一个如上指定的霍尔丹决策的布尔值。\n- 您的程序应生成单行输出，其中包含结果，形式为由三个“每个用例的列表”组成的、以逗号分隔的列表，并用方括号括起来（例如，“[[sm1,sf1,flag1],[sm2,sf2,flag2],[sm3,sf3,flag3]]”）。不应打印任何其他文本。\n- 您的程序不得读取任何输入；它必须使用下面嵌入的测试套件。\n\n测试套件：\n- 在所有情况下，性别编码为 $z = 0$（雌性）和 $z = 1$（雄性）。这些列表按索引对齐，因此三个列表中第 $j$ 个条目对应于同一个观测值。\n\n情况1（雄性中X染色体渗入减少；代表霍尔丹法则）：\n- $q$ 列表: $[0.3,\\, 0.3,\\, 0.4,\\, 0.4,\\, 0.5,\\, 0.5,\\, 0.6,\\, 0.6,\\, 0.7,\\, 0.7,\\, 0.8,\\, 0.8,\\, 0.9,\\, 0.9]$\n- $z$ 列表: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ 列表: $[0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\n情况2（无性别差异；近中性行为）：\n- $q$ 列表: $[0.2,\\, 0.2,\\, 0.4,\\, 0.4,\\, 0.5,\\, 0.5,\\, 0.6,\\, 0.6,\\, 0.8,\\, 0.8]$\n- $z$ 列表: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ 列表: $[0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\n情况3（类边界行为；强烈的雄性特异性选择）：\n- $q$ 列表: $[0.1,\\, 0.1,\\, 0.49,\\, 0.49,\\, 0.51,\\, 0.51,\\, 0.9,\\, 0.9,\\, 0.96,\\, 0.96,\\, 0.98,\\, 0.98]$\n- $z$ 列表: $[0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1]$\n- $y$ 列表: $[0,\\, 0,\\, 0,\\, 0,\\, 1,\\, 0,\\, 1,\\, 0,\\, 1,\\, 1,\\, 1,\\, 1]$\n\n定义和决策规则：\n- 令 $\\widehat{s}_m$ 和 $\\widehat{s}_f$ 分别表示雄性和雌性的最大似然估计值；定义 $\\tau = 0.05$。如果 $\\widehat{s}_m - \\widehat{s}_f  \\tau$，则宣布“与霍尔丹法则一致”；否则，宣布“不一致”。\n- 在最终输出中将 $\\widehat{s}_m$ 和 $\\widehat{s}_f$ 四舍五入到三位小数。\n\n您的程序必须实现最大似然估计，将其应用于所有三种情况，并打印出指定聚合输出格式的单行内容。", "solution": "问题陈述已经过验证。\n\n### 第1步：提取给定信息\n- **选择后概率模型 ($\\pi$)**：对于一个全基因组祖源比例为 $q$、性别为 $z$ 的个体，其采样的单倍体X连锁等位基因来源于群体 $\\mathsf{A}$ 的概率由以下公式给出：\n$$\n\\pi(q,z;s_f,s_m) = \\frac{q \\, (1 - s_z)}{q \\, (1 - s_z) + (1 - q)}\n$$\n- **性别特异性选择系数 ($s_z$)**：$s_z$ 是针对来自群体 $\\mathsf{A}$ 的渗入祖源的选择系数。它取决于性别 $z$，其中 $z=0$ 为雌性，$z=1$ 为雄性。因此，$s_0 = s_f$ 和 $s_1 = s_m$。\n- **参数约束**：$0 \\le s_f  1$ 且 $0 \\le s_m  1$。\n- **数据**：对于每个观测值 $j=1, \\dots, n$，数据由一个三元组 $(q_j, z_j, y_j)$ 组成，其中 $q_j \\in [0,1]$ 是全基因组祖源比例，$z_j \\in \\{0,1\\}$ 是性别，$y_j \\in \\{0,1\\}$ 是一个X连锁基因座上观测到的单倍体祖源指示符（$y_j=1$ 代表祖源 $\\mathsf{A}$，$y_j=0$ 代表祖源 $\\mathsf{B}$）。\n- **统计模型**：假设观测值 $y_j$ 是独立的伯努利试验，其成功概率为 $\\pi_j = \\pi(q_j,z_j;s_f,s_m)$。\n- **目标函数**：需要最大化的对数似然函数为：\n$$\n\\ell(s_f,s_m) = \\sum_{j=1}^{n} \\left[ y_j \\, \\log \\pi(q_j,z_j;s_f,s_m) + (1 - y_j) \\, \\log \\left(1 - \\pi(q_j,z_j;s_f,s_m)\\right) \\right]\n$$\n- **任务**：执行最大似然估计（MLE）以找到 $\\hat{s}_f$ 和 $\\hat{s}_m$。\n- **霍尔丹法则决策**：给定一个阈值 $\\tau = 0.05$。当且仅当 $\\hat{s}_m - \\hat{s}_f  \\tau$ 时，数据被判定为与霍尔丹法则一致。\n- **测试套件**：提供了三个特定的数据集（情况1、情况2、情况3）。\n- **输出格式**：对于每种情况，生成一个列表 `[rounded_sm, rounded_sf, boolean_decision]`。最终输出是包含这些列表的单行列表。\n\n### 第2步：使用提取的给定信息进行验证\n根据验证标准评估问题。\n\n- **科学基础**：该问题基于群体遗传学中标准的确定性生存力选择模型。使用伯努利似然处理二元性状的统计框架是统计推断的基石。霍尔丹法则是演化生物学中一个公认的经验模式。该模型提供了一种简化但有原则的方法来检验与此法则相关的假设。该问题在科学上是合理的。\n- **适定性**：任务是在边界约束下找到对数似然函数的最大值。这是一个标准的、定义明確的数值优化问题。伯努利分布的对数似然函数在其概率的logit变换上是凹函数，这确保了参数的唯一最大值通常存在。该问题是适定的。\n- **客观性**：所有术语都经过了精确的数学定义。数据是定量的，决策规则基于清晰、客观的数值阈值。该问题没有主观或模糊的语言。\n\n问题陈述没有表现出任何已定义的缺陷（例如，科学上不合理、不完整、矛盾或模糊）。这是一个在计算统计学和生物学领域内形式化、自洽且可解的问题。\n\n### 第3步：结论与行动\n该问题有效。将提供完整的解决方案。\n\n### 求解推导\n目标是通过最大化对数似然函数 $\\ell(s_f, s_m)$ 来找到 $s_f$ 和 $s_m$ 的最大似然估计（MLEs）。标准的数值优化器设计为最小化一个函数，因此我们等价地最小化负对数似然函数 $L(s_f, s_m) = -\\ell(s_f, s_m)$。\n\n一个关键的观察是，对数似然函数关于参数 $s_f$ 和 $s_m$ 是可分离的。概率 $\\pi(q, z; s_f, s_m)$ 在 $z=0$（雌性）时仅依赖于 $s_f$，在 $z=1$（雄性）时仅依赖于 $s_m$。\n设 $J_f = \\{j \\mid z_j = 0\\}$ 为雌性观测值的索引集，$J_m = \\{j \\mid z_j = 1\\}$ 为雄性观测值的索引集。对数似然可以写成两个独立分量的和：\n$$\n\\ell(s_f, s_m) = \\ell_f(s_f) + \\ell_m(s_m)\n$$\n其中\n$$\n\\ell_f(s_f) = \\sum_{j \\in J_f} \\left[ y_j \\, \\log \\pi(q_j,0;s_f,s_m) + (1-y_j) \\log(1 - \\pi(q_j,0;s_f,s_m)) \\right]\n$$\n$$\n\\ell_m(s_m) = \\sum_{j \\in J_m} \\left[ y_j \\, \\log \\pi(q_j,1;s_f,s_m) + (1-y_j) \\log(1 - \\pi(q_j,1;s_f,s_m)) \\right]\n$$\n这种可分离性允许我们通过解决两个一维优化问题来独立地优化 $s_f$ 和 $s_m$。\n\n让我们为一个通用的选择系数 $s$ 及其对应的数据子集 $(q_k, y_k)$ 简化目标函数。概率为 $\\pi_k = \\frac{q_k (1 - s)}{q_k (1 - s) + (1 - q_k)} = \\frac{q_k(1-s)}{1-q_k s}$。因此，$1-\\pi_k = \\frac{1-q_k}{1-q_k s}$。\n来自观测值 $k$ 的对数似然贡献是：\n$$\ny_k \\log(\\pi_k) + (1-y_k) \\log(1-\\pi_k) = y_k \\log\\left(\\frac{q_k(1-s)}{1-q_k s}\\right) + (1-y_k) \\log\\left(\\frac{1-q_k}{1-q_k s}\\right)\n$$\n$$\n= y_k (\\log q_k + \\log(1-s) - \\log(1-q_k s)) + (1-y_k)(\\log(1-q_k) - \\log(1-q_k s))\n$$\n$$\n= (y_k \\log q_k + (1-y_k)\\log(1-q_k)) + y_k \\log(1-s) - \\log(1-q_k s)\n$$\n为了对 $s$ 进行最大化，项 $(y_k \\log q_k + (1-y_k)\\log(1-q_k))$ 是一个常数，可以忽略。对所有相关观测值求和，任务是最大化 $\\sum_k \\left[ y_k \\log(1-s) - \\log(1-q_k s) \\right]$。\n这等价于最小化该表达式的负数：\n$$\nL(s) = \\sum_k \\left[ \\log(1-q_k s) - y_k \\log(1-s) \\right]\n$$\n这个简化的负对数似然函数在数值上是稳定的，并且计算效率高。我们将使用雌性数据对 $s_f$ 最小化此函数，并使用雄性数据对 $s_m$ 最小化此函数。优化将使用带有边界 $(0, 1)$ 的数值标量优化器进行，因为约束条件是 $0 \\le s  1$。边界情况 $s=0$ 对应于中性选择。$s \\ge 1$ 的值在生物学上是无意义的，因为它意味着零适应度或负适应度，而 $s  0$ 的值则意味着对渗入等位基因的正选择。所提供的边界是合适的。\n\n每个测试用例的算法如下：\n1.  将数据 $(q, z, y)$ 划分为雌性子集 $(q_f, y_f)$ 和雄性子集 $(q_m, y_m)$。\n2.  定义目标函数 $L(s; q_{\\text{data}}, y_{\\text{data}}) = \\sum_k [\\log(1-q_k s) - y_k \\log(1-s)]$。\n3.  在区间 $[0, 1)$ 上对 $L(s_f; q_f, y_f)$ 关于 $s_f$ 进行数值最小化，以找到最大似然估计值 $\\hat{s}_f$。\n4.  在区间 $[0, 1)$ 上对 $L(s_m; q_m, y_m)$ 关于 $s_m$ 进行数值最小化，以找到最大似然估计值 $\\hat{s}_m$。\n5.  使用未四舍五入的估计值来评估霍尔丹法则条件：$\\hat{s}_m - \\hat{s}_f  \\tau = 0.05$。\n6.  将 $\\hat{s}_m$ 和 $\\hat{s}_f$ 四舍五入到三位小数。\n7.  将结果编译成指定的列表格式 `[rounded_sm, rounded_sf, boolean_decision]`。\n对所有测试用例重复此过程，并将最终结果汇总到一个单一列表中。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the Haldane's rule inference problem for the given test cases.\n    \"\"\"\n    # Test cases as provided in the problem statement.\n    test_cases = [\n        # Case 1: reduced X introgression in males; representative of Haldane's rule\n        {\n            \"q\": [0.3, 0.3, 0.4, 0.4, 0.5, 0.5, 0.6, 0.6, 0.7, 0.7, 0.8, 0.8, 0.9, 0.9],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1]\n        },\n        # Case 2: no sex difference; near-neutral behavior\n        {\n            \"q\": [0.2, 0.2, 0.4, 0.4, 0.5, 0.5, 0.6, 0.6, 0.8, 0.8],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 0, 0, 1, 1, 1, 1]\n        },\n        # Case 3: boundary-like behavior; strong male-specific selection\n        {\n            \"q\": [0.1, 0.1, 0.49, 0.49, 0.51, 0.51, 0.9, 0.9, 0.96, 0.96, 0.98, 0.98],\n            \"z\": [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],\n            \"y\": [0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1]\n        }\n    ]\n\n    tau = 0.05\n    results = []\n\n    for case_data in test_cases:\n        q = np.array(case_data[\"q\"])\n        z = np.array(case_data[\"z\"])\n        y = np.array(case_data[\"y\"])\n\n        # Partition data into female (z=0) and male (z=1) subsets\n        female_mask = (z == 0)\n        male_mask = (z == 1)\n\n        q_f, y_f = q[female_mask], y[female_mask]\n        q_m, y_m = q[male_mask], y[male_mask]\n\n        def neg_log_lik(s, q_arr, y_arr):\n            \"\"\"\n            Calculates the simplified negative log-likelihood to be minimized.\n            L(s) = sum(log(1 - q_k*s) - y_k*log(1 - s))\n            \"\"\"\n            # If no data for a sex, likelihood is flat, s=0 is the neutral default.\n            if len(q_arr) == 0:\n                return 0.0\n            \n            # Use a small epsilon to avoid log(0) at boundary s=1\n            epsilon = 1e-9\n            if s >= 1.0:\n                s = 1.0 - epsilon\n            \n            term1 = np.sum(np.log(1 - q_arr * s))\n            term2 = np.sum(y_arr * np.log(1 - s))\n            return term1 - term2\n\n        # --- Estimate s_f for females ---\n        # If no female data, MLE for s_f is taken as 0 (neutrality).\n        if len(q_f) > 0:\n            res_f = minimize_scalar(\n                lambda s: neg_log_lik(s, q_f, y_f),\n                bounds=(0, 1),\n                method='bounded'\n            )\n            s_f_hat = res_f.x\n        else:\n            s_f_hat = 0.0\n\n        # --- Estimate s_m for males ---\n        # If no male data, MLE for s_m is taken as 0.\n        if len(q_m) > 0:\n            res_m = minimize_scalar(\n                lambda s: neg_log_lik(s, q_m, y_m),\n                bounds=(0, 1),\n                method='bounded'\n            )\n            s_m_hat = res_m.x\n        else:\n            s_m_hat = 0.0\n            \n        # Decision for Haldane's rule using unrounded estimates\n        is_haldane = (s_m_hat - s_f_hat) > tau\n\n        # Round estimates for reporting\n        s_m_rounded = round(s_m_hat, 3)\n        s_f_rounded = round(s_f_hat, 3)\n\n        results.append([s_m_rounded, s_f_rounded, is_haldane])\n\n    # Format the final output string exactly as specified.\n    # The default str() representation of a list of lists might add spaces.\n    # To be certain, build it manually.\n    sub_lists_str = [f\"[{r[0]},{r[1]},{str(r[2]).lower()}]\" for r in results]\n    final_output_str = f\"[{','.join(sub_lists_str)}]\"\n\n    print(final_output_str)\n\nsolve()\n```", "id": "2720969"}]}