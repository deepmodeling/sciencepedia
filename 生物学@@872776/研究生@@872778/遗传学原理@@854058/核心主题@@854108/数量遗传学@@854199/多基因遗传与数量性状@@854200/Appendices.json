{"hands_on_practices": [{"introduction": "理论的价值在于其预测能力。本练习将从基本原理出发，推导数量遗传学中最核心的公式之一——育种家方程。通过这个练习[@problem_id:2838165]，你将理解狭义遗传力（$h^2$）如何将选择压力（以选择强度 $i$ 量化）与可预测的世代间表型变化（选择响应 $R$）联系起来，这是人工选择和自然选择理论的基石。", "problem": "一个大的、随机交配的二倍体群体表现出一个数量性状，该性状受纯加性基因作用控制，涉及许多效应微小的基因座。设表型模型为 $P = A + E$，其中 $A$ 是加性遗传（育种）值，$E$ 是环境离差，且 $\\operatorname{Cov}(A,E)=0$。表型方差为 $V_{P}=\\sigma_{P}^{2}$，加性遗传方差为 $V_{A}$。窄义遗传力为 $h^{2}=V_{A}/V_{P}$。在选择之前，该性状近似呈正态分布。\n\n在一代中，育种计划对上尾部分进行表型截断选择。对于此截断选择，该计划报告了选择强度 $i$（从截断的正态模型中获得）。假设选择的亲本之间随机交配，无显性，无上位性，并且环境分布在世代间保持不变，因此后代平均表型等于后代平均育种值。\n\n仅使用上述基本定义和加性模型下线性预测的标准属性，从基本原理出发，推导在该截断选择下群体均值的预期单代变化，用 $i$、$h^{2}$ 和 $\\sigma_{P}$ 表示。然后，当 $i=1.755$，$h^{2}=0.36$ 和 $\\sigma_{P}=8.4$（性状单位）时，计算你推导出的表达式的值。用性状单位表示你的最终答案，并将答案四舍五入到 $4$ 位有效数字。", "solution": "问题要求从基本原理出发，推导截断选择下群体均值的单代变化，然后用给定的具体参数计算这个变化量。这个量被称为选择响应，记为 $R$。\n\n设 $\\mu_P$ 和 $\\mu_A$ 分别为选择前亲代群体的平均表型和平均加性遗传（育种）值。不失一般性，我们可以将所有性状值度量为与其初始均值的离差，因此 $\\mu_P = 0$ 且 $\\mu_A = 0$。表型模型为 $P = A + E$，其中 $P$ 是表型，$A$ 是育种值，$E$ 是环境离差。取期望值得到 $\\mu_P = \\mu_A + \\mu_E$。根据我们的约定，这意味着 $\\mu_E=0$。\n\n选择是根据表型 $P$进行的。设被选择的亲本群体用下标 $S$ 表示。这个被选群体的平均表型是 $\\mu_{P,S}$。选择差 $S$ 是指被选亲本的平均表型与选择前亲代群体的平均表型之差：\n$$S = \\mu_{P,S} - \\mu_P$$\n当 $\\mu_P=0$ 时，这简化为 $S = \\mu_{P,S}$。\n\n后代是由这些被选亲本随机交配产生的。设 $\\mu_{P'}$ 和 $\\mu_{A'}$ 分别表示后代群体的平均表型和平均育种值。选择响应 $R$ 是指从亲代到子代群体平均表型的变化：\n$$R = \\mu_{P'} - \\mu_P$$\n当 $\\mu_P=0$ 时，这变为 $R = \\mu_{P'}$。\n\n问题指出，后代的平均表型等于后代的平均育种值。这意味着 $\\mu_{P'} = \\mu_{A'}$。这个假设基于环境分布不变的事实，因此后代的平均环境效应 $\\mu_{E'}$ 与亲代的相同，我们已设定 $\\mu_E=0$。\n此外，在随机交配下，后代的平均育种值是被选亲本平均育种值的平均值。设 $\\mu_{A,S}$ 为被选亲本的平均育种值。那么，$\\mu_{A'} = \\mu_{A,S}$。\n综合这些事实，选择响应为：\n$$R = \\mu_{P'} = \\mu_{A'} = \\mu_{A,S}$$\n我们现在的任务是找到 $\\mu_{A,S}$（即 $R$）和 $\\mu_{P,S}$（即 $S$）之间的关系。这个关系可以从线性回归的原理中推导出。\n\n我们希望根据个体的表型 $P$ 来预测其育种值 $A$。$A$ 对 $P$ 的线性回归给出了从 $P$ 预测 $A$ 的最佳线性预测。回归方程是：\n$$E[A | P] - \\mu_A = b_{A,P} (P - \\mu_P)$$\n其中 $b_{A,P}$ 是 $A$ 对 $P$ 的回归系数。根据我们初始均值为零的约定，这简化为 $E[A|P] = b_{A,P} P$。\n\n回归系数 $b_{A,P}$ 定义为：\n$$b_{A,P} = \\frac{\\operatorname{Cov}(A, P)}{\\operatorname{Var}(P)}$$\n问题提供了模型 $P = A + E$ 及 $\\operatorname{Cov}(A, E) = 0$。分子中的协方差项可以展开为：\n$$\\operatorname{Cov}(A, P) = \\operatorname{Cov}(A, A+E) = \\operatorname{Cov}(A, A) + \\operatorname{Cov}(A, E)$$\n根据定义，$\\operatorname{Cov}(A, A) = \\operatorname{Var}(A) = V_A$。我们已知 $\\operatorname{Cov}(A, E) = 0$。因此，$\\operatorname{Cov}(A, P) = V_A$。\n分母是表型方差，$\\operatorname{Var}(P) = V_P$。\n将这些代入回归系数的表达式中：\n$$b_{A,P} = \\frac{V_A}{V_P}$$\n根据定义，这个比率是窄义遗传力 $h^2$。所以，$b_{A,P} = h^2$。\n\n因此，回归方程为 $E[A|P] = h^2 P$。预期育种值和表型之间的这种关系也适用于群体中任何亚群的均值。具体来说，对于被选亲本群体：\n$$E[A | \\text{selected}] = h^2 E[P | \\text{selected}]$$\n左边是被选群体的平均育种值 $\\mu_{A,S}$。右边包含被选群体的平均表型 $\\mu_{P,S}$。\n$$\\mu_{A,S} = h^2 \\mu_{P,S}$$\n回顾我们的定义，$R = \\mu_{A,S}$ 和 $S = \\mu_{P,S}$。将它们代入方程得到育种家方程：\n$$R = h^2 S$$\n问题提供的是选择强度 $i$，而不是选择差 $S$。选择强度的定义是用表型标准差 $\\sigma_P = \\sqrt{V_P}$ 标准化后的选择差：\n$$i = \\frac{S}{\\sigma_P}$$\n这个定义来自于正态分布的性质，即对于截断选择，被选择（截断）部分的均值与分布的标准差成正比，比例常数为 $i$。\n根据这个定义，我们可以将选择差表示为 $S = i \\sigma_P$。\n\n将 $S$ 的这个表达式代入育种家方程，得到选择响应的最终推导关系：\n$$R = h^2 (i \\sigma_P) = i h^2 \\sigma_P$$\n该方程按要求用选择强度 $i$、窄义遗传力 $h^2$ 和表型标准差 $\\sigma_P$ 预测了群体均值的单代变化。\n\n现在我们用给定的数值来计算这个表达式：\n$i = 1.755$\n$h^2 = 0.36$\n$\\sigma_P = 8.4$ 性状单位。\n\n预期的选择响应是：\n$$R = (1.755) \\times (0.36) \\times (8.4)$$\n$$R = (0.6318) \\times (8.4)$$\n$$R = 5.30712$$\n问题要求将答案四舍五入到 $4$ 位有效数字。\n前四位有效数字是 $5$、$3$、$0$ 和 $7$。第五位数字是 $1$，所以我们舍去后面的数字。\n$$R \\approx 5.307$$\n选择响应为 $5.307$ 性状单位。", "answer": "$$\\boxed{5.307}$$", "id": "2838165"}, {"introduction": "上一个练习展示了可遗传变异的重要性，但表型相似性背后的遗传结构更为复杂。本练习[@problem_id:2838200]将深入探讨遗传方差的组成部分，通过比较全同胞和半同胞之间的表型相关性，你将亲自揭示加性遗传方差（$V_A$）和显性遗传方差（$V_D$）如何以不同方式影响亲缘个体间的相似度。这清晰地阐明了为何狭义遗传力（仅包含 $V_A$）是预测选择响应的关键。", "problem": "一个大型、随机交配的二倍体群体在影响某个数量性状的多个不连锁的双等位基因座上处于哈代-温伯格平衡（HWE）和连锁平衡（LE）状态。不存在上位性、选择性交配和近亲繁殖。该性状的个体表型可以写为 $P = A + D + E$，其中 $A$ 是加性遗传值（育种值），$D$ 是显性离差，$E$ 是环境离差，且 $E$ 在个体间独立，并与基因型不相关。表型方差分解为 $V_{P} = V_{A} + V_{D} + V_{E}$，并且该性状已被标准化，使得 $V_{P} = 1$。\n\n仅使用孟德尔分离的第一性原理和随机交配下的同源IBD（identity-by-descent）推理，推导一对全同胞和一对父系半同胞（同父但母本无亲缘关系）之间表型的期望相关性。将每个相关性仅用 $V_{A}$ 和 $V_{D}$ 表示。清楚地展示在这些假设下，显性如何导致全同胞相关性相对于半同胞相关性的增加。\n\n将您的最终结果以行矩阵 $\\begin{pmatrix} r_{\\mathrm{FS}}  r_{\\mathrm{HS}} \\end{pmatrix}$ 的形式报告，其中 $r_{\\mathrm{FS}}$ 是期望的全同胞相关性，$r_{\\mathrm{HS}}$ 是期望的半同胞相关性。无需数值四舍五入，也无需单位，因为相关性根据其构造是无量纲的。", "solution": "该问题陈述经核实具有科学依据、提法明确且客观。它代表了基于既定原则的数量遗传学中的一个标准练习。我们将开始推导。\n\n两个个体（记为 $1$ 和 $2$）的表型之间的相关性定义为：\n$$\nr = \\text{Corr}(P_{1}, P_{2}) = \\frac{\\text{Cov}(P_{1}, P_{2})}{\\sqrt{V(P_{1})V(P_{2})}}\n$$\n问题陈述该群体处于平衡状态，因此所有个体具有相同的表型方差 $V_{P}$。此外，该方差已被标准化为 $V_{P} = 1$。因此，相关性简化为协方差：\n$$\nr = \\text{Cov}(P_{1}, P_{2})\n$$\n表型 $P$ 由线性模型 $P = A + D + E$ 给出，其中 $A$ 是加性遗传值，$D$ 是显性离差，$E$ 是环境离差。两个亲属表型之间的协方差为：\n$$\n\\text{Cov}(P_{1}, P_{2}) = \\text{Cov}(A_{1} + D_{1} + E_{1}, A_{2} + D_{2} + E_{2})\n$$\n使用协方差的性质展开上式，得到：\n$$\n\\text{Cov}(P_{1}, P_{2}) = \\text{Cov}(A_{1}, A_{2}) + \\text{Cov}(D_{1}, D_{2}) + \\text{Cov}(E_{1}, E_{2}) + \\text{Cov}(A_{1}, D_{2}) + \\text{Cov}(A_{2}, D_{1}) + \\text{Cov}(A_{1}, E_{2}) + \\text{Cov}(A_{2}, E_{1}) + \\text{Cov}(D_{1}, E_{2}) + \\text{Cov}(D_{2}, E_{1})\n$$\n我们根据问题的假设来评估交叉项：\n1.  环境离差 $E$ 在个体间是独立的，因此 $\\text{Cov}(E_{1}, E_{2}) = 0$。\n2.  环境离差与基因型不相关，这意味着它们与基因型组分 $A$ 和 $D$ 不相关。因此，所有 $\\text{Cov}(A, E)$ 和 $\\text{Cov}(D, E)$ 项均为零。\n3.  在一个处于哈代-温伯格和连锁平衡的随机交配群体中，加性遗传值和显性离差是不相关的。这在个体内部和个体之间都成立，因此 $\\text{Cov}(A_{1}, D_{2}) = 0$ 和 $\\text{Cov}(A_{2}, D_{1}) = 0$。\n\n因此，表型协方差简化为遗传协方差之和：\n$$\n\\text{Cov}(P_{1}, P_{2}) = \\text{Cov}(A_{1}, A_{2}) + \\text{Cov}(D_{1}, D_{2})\n$$\n我们的任务简化为使用同源IBD（identity-by-descent）的第一性原理，为全同胞和半同胞推导这两个遗传协方差项。\n\n两个亲属之间的遗传协方差是群体遗传方差（$V_{A}$ 和 $V_{D}$）以及它们共享同源等位基因概率的函数。我们为一对个体定义两个关键系数：\n- 亲缘系数 $\\theta_{12}$，是指从个体1的某个基因座上随机抽取一个等位基因，与从个体2的同一基因座上随机抽取一个等位基因为同源IBD的概率。\n- 同胞系数 $\\Delta_{12}$，是指两个个体在某个基因座上共享的两个等位基因均为同源IBD的概率（即它们的基因型是同源的）。\n\n加性值的协方差为 $\\text{Cov}(A_{1}, A_{2}) = 2\\theta_{12}V_{A}$。这是因为加性值 $A$ 是单个等位基因效应的总和。两个亲属的加性值之间的协方差与它们的等位基因是同源IBD的概率成正比。具体来说，对于单个基因座，$A = g_{m} + g_{p}$，其中 $g$ 代表一个等位基因的加性效应。$\\text{Cov}(A_1, A_2) = \\text{Cov}(g_{1m}+g_{1p}, g_{2m}+g_{2p}) = 4\\theta_{12}\\text{Var}(g)$。由于在随机交配下，$V_{A,locus} = 2\\text{Var}(g)$，这得出 $\\text{Cov}(A_1, A_2) = 2\\theta_{12}V_{A,locus}$。对所有不连锁的基因座求和，得到总协方差。\n\n显性离差的协方差是 $\\text{Cov}(D_{1}, D_{2}) = \\Delta_{12}V_{D}$。显性离差 $D$ 是二倍体基因型（一个基因座上两个等位基因之间的互作）的一个属性。协方差 $\\text{Cov}(D_{1}, D_{2}) = \\mathbb{E}[D_{1}D_{2}]$（因为 $\\mathbb{E}[D]=0$）仅当两个个体的基因型相关时才非零。这种相关性是由于IBD造成的。如果基因型是同源的（概率为 $\\Delta_{12}$），则期望 $\\mathbb{E}[D_{1}D_{2}]$ 等于 $V_{D}$，否则（假设随机交配）为零。因此，协方差恰好是 $\\Delta_{12}V_{D}$。\n\n现在，我们为指定的关系计算 $\\theta$ 和 $\\Delta$。\n\n**全同胞 (FS)**\n全同胞共享双亲，即一个父亲（F）和一个母亲（M），他们非近交且无亲缘关系。设IBD状态由 $k_{i}$ 描述，即在一个基因座上共享 $i$ 个同源IBD等位基因的概率。\n- 共享两个同源IBD等位基因的概率（$k_{2}$）要求继承相同的父本等位基因（概率 $1/2$）并且继承相同的母本等位基因（概率 $1/2$）。这些是独立事件。因此，$\\Delta_{FS} = k_{2} = \\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n- 不共享任何同源IBD等位基因的概率（$k_{0}$）要求继承不同的父本等位基因（$1/2$）并且继承不同的母本等位基因（$1/2$）。因此，$k_{0} = \\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$。\n- 共享一个同源IBD等位基因的概率是 $k_{1} = 1 - k_{0} - k_{2} = 1 - \\frac{1}{4} - \\frac{1}{4} = \\frac{1}{2}$。\n亲缘系数由这些概率导出：$\\theta_{FS} = \\frac{1}{4}k_{1} + \\frac{1}{2}k_{2} = \\frac{1}{4}(\\frac{1}{2}) + \\frac{1}{2}(\\frac{1}{4}) = \\frac{1}{8} + \\frac{1}{8} = \\frac{1}{4}$。\n全同胞的表型相关性为：\n$$\nr_{FS} = \\text{Cov}(P_{1}, P_{2}) = 2\\theta_{FS}V_{A} + \\Delta_{FS}V_{D} = 2(\\frac{1}{4})V_{A} + \\frac{1}{4}V_{D} = \\frac{1}{2}V_{A} + \\frac{1}{4}V_{D}\n$$\n\n**父系半同胞 (HS)**\n父系半同胞共享一个共同的父亲（F），但有不同的、无亲缘关系的母亲。\n- 他们不可能共享两个同源IBD等位基因，因为他们只有一个共同的亲本。因此，$\\Delta_{HS} = k_{2} = 0$。\n- 如果他们从共同的父亲那里继承了相同的等位基因，他们就共享一个同源IBD等位基因。这个概率是 $k_{1} = 1/2$。\n- 如果他们从共同的父亲那里继承了不同的等位基因，他们就不共享任何同源IBD等位基因，概率为 $k_{0} = 1/2$。\n亲缘系数为：$\\theta_{HS} = \\frac{1}{4}k_{1} + \\frac{1}{2}k_{2} = \\frac{1}{4}(\\frac{1}{2}) + \\frac{1}{2}(0) = \\frac{1}{8}$。\n半同胞的表型相关性为：\n$$\nr_{HS} = \\text{Cov}(P_{1}, P_{2}) = 2\\theta_{HS}V_{A} + \\Delta_{HS}V_{D} = 2(\\frac{1}{8})V_{A} + (0)V_{D} = \\frac{1}{4}V_{A}\n$$\n\n**显性的贡献**\n推导出的相关性为 $r_{FS} = \\frac{1}{2}V_{A} + \\frac{1}{4}V_{D}$ 和 $r_{HS} = \\frac{1}{4}V_{A}$。比较揭示了显性的作用。半同胞之间的相关性仅取决于加性遗传方差 $V_{A}$。这是因为他们不可能共享一个同源IBD的二倍体基因型（$\\Delta_{HS} = 0$），因此由基因座内等位基因互作产生的方差组分（$V_{D}$）对他们的相似性没有贡献。相比之下，全同胞有 $1/4$ 的概率共享相同的同源IBD基因型（$\\Delta_{FS} = 1/4$）。这使得显性效应对他们的相似性产生贡献，使其相关性增加了 $\\frac{1}{4}V_{D}$ 的量。全同胞的相关性不仅仅是半同胞相关性的两倍（如果只存在加性效应，情况会是这样，因为 $2\\theta_{FS} = 2(2\\theta_{HS})$）；它比两倍还多出了这个显性项。全同胞之间这种超出的相似性是在随机交配群体中非加性遗传方差（特别是显性方差）的典型标志。\n\n最终结果按要求以行矩阵的形式呈现。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{2}V_{A} + \\frac{1}{4}V_{D}  \\frac{1}{4}V_{A} \\end{pmatrix}}\n$$", "id": "2838200"}, {"introduction": "传统的数量遗传学理论如何在全基因组数据时代得到应用？本高级练习[@problem_id:2838198]将连接经典理论与现代基因组学。你将推导在一个存在连锁不平衡（LD）的群体中，通过全基因组关联分析（GWAS）观察到的单个遗传标记的边际效应（marginal effect）与真实的因果效应（causal effect）之间的数学关系。这个推导是理解LD谱回归等前沿统计遗传学方法的关键，这些方法能够利用GWAS摘要数据估计遗传力。", "problem": "一个数量性状由通过单核苷酸多态性 (SNP) 起作用的高度多基因结构所决定。考虑一个大小为 $N$ 的群体样本，该样本在 $M$ 个 SNP 位点上进行了基因分型。设 $\\mathbf{X} \\in \\mathbb{R}^{N \\times M}$ 是标准化基因型矩阵，其列均值为 $0$，方差为 $1$。设 $\\mathbf{R} = \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{X}$ 表示样本连锁不平衡 (LD) 矩阵，您可以将其视为固定的，且等于群体 LD 矩阵。表型向量 $\\mathbf{y} \\in \\mathbb{R}^{N}$ 服从一个加性线性模型\n$$\n\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\gamma} + \\mathbf{e},\n$$\n其中 $\\boldsymbol{\\gamma} \\in \\mathbb{R}^{M}$ 是等位基因的因果效应向量，$\\mathbf{e} \\sim \\mathcal{N}(\\mathbf{0}, \\sigma_{e}^{2}\\mathbf{I}_{N})$ 是独立的环境噪声。假设该性状已被标准化，因此 $\\operatorname{Var}(\\mathbf{y})=1$。对于每个 SNP $j$，通过将 $\\mathbf{y}$ 回归到第 $j$ 个基因型列来定义单变量边际效应估计量：用向量形式表示为，\n$$\n\\hat{\\boldsymbol{\\beta}} \\equiv \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{y} \\in \\mathbb{R}^{M}.\n$$\n假设一个可交换的高斯随机效应先验 $\\boldsymbol{\\gamma} \\sim \\mathcal{N}(\\mathbf{0}, \\sigma_{\\gamma}^{2}\\mathbf{I}_{M})$，且与 $\\mathbf{e}$ 独立。将 SNP $j$ 的 LD 得分定义为 $l_{j} \\equiv \\sum_{k=1}^{M} r_{jk}^{2}$，其中 $r_{jk}$ 是 $\\mathbf{R}$ 的 $(j,k)$ 项。最后，在性状标准化 $\\operatorname{Var}(\\mathbf{y})=1$ 的条件下，将 SNP 遗传力 $h_{g}^{2}$ 定义为 $h_{g}^{2} \\equiv \\operatorname{Var}(\\mathbf{X}\\boldsymbol{\\gamma})$。\n\n仅使用这些定义以及多元高斯随机变量和使用标准化预测变量的线性回归的性质，推导条件期望\n$$\n\\mathbb{E}\\!\\left[\\,N\\,\\hat{\\beta}_{j}^{2} \\,\\middle|\\, \\mathbf{R} \\right]\n$$\n的显式闭式表达式，该表达式是关于 $N$、$M$、$h_{g}^{2}$ 和 $l_{j}$ 的函数。您的推导必须从上述模型和定义出发，不得引用任何关于 LD 得分回归的既有结果。以最简闭式形式提供最终表达式。无需进行数值评估。最终答案必须是无单位的单个解析表达式。", "solution": "目标是计算条件期望 $\\mathbb{E}\\!\\left[\\,N\\,\\hat{\\beta}_{j}^{2} \\,\\middle|\\, \\mathbf{R} \\right]$。期望是针对随机变量 $\\boldsymbol{\\gamma}$ 和 $\\mathbf{e}$ 计算的。LD 矩阵 $\\mathbf{R}$（并延伸到基因型矩阵 $\\mathbf{X}$）被视为固定的。\n\n首先，我们用模型分量来表示边际效应估计量 $\\hat{\\boldsymbol{\\beta}}$。\n$$\n\\hat{\\boldsymbol{\\beta}} = \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{y} = \\frac{1}{N}\\mathbf{X}^{\\top}(\\mathbf{X}\\boldsymbol{\\gamma} + \\mathbf{e})\n$$\n使用定义 $\\mathbf{R} = \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{X}$，上式变为：\n$$\n\\hat{\\boldsymbol{\\beta}} = \\left(\\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{X}\\right)\\boldsymbol{\\gamma} + \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{e} = \\mathbf{R}\\boldsymbol{\\gamma} + \\frac{1}{N}\\mathbf{X}^{\\top}\\mathbf{e}\n$$\n该向量的第 $j$ 个分量 $\\hat{\\beta}_{j}$ 是：\n$$\n\\hat{\\beta}_{j} = (\\mathbf{R}\\boldsymbol{\\gamma})_{j} + \\frac{1}{N}(\\mathbf{X}^{\\top}\\mathbf{e})_{j}\n$$\n我们需要求 $N\\hat{\\beta}_{j}^{2}$ 的期望：\n$$\n\\mathbb{E}\\!\\left[\\,N\\,\\hat{\\beta}_{j}^{2} \\,\\middle|\\, \\mathbf{R} \\right] = N\\,\\mathbb{E}\\!\\left[\\, \\left( (\\mathbf{R}\\boldsymbol{\\gamma})_{j} + \\frac{1}{N}(\\mathbf{X}^{\\top}\\mathbf{e})_{j} \\right)^{2} \\,\\middle|\\, \\mathbf{R} \\right]\n$$\n展开平方项：\n$$\n\\mathbb{E}\\!\\left[\\,N\\,\\hat{\\beta}_{j}^{2} \\,\\middle|\\, \\mathbf{R} \\right] = N\\,\\mathbb{E}\\!\\left[\\, (\\mathbf{R}\\boldsymbol{\\gamma})_{j}^{2} + \\frac{1}{N^2}(\\mathbf{X}^{\\top}\\mathbf{e})_{j}^{2} + \\frac{2}{N}(\\mathbf{R}\\boldsymbol{\\gamma})_{j}(\\mathbf{X}^{\\top}\\mathbf{e})_{j} \\,\\middle|\\, \\mathbf{R} \\right]\n$$\n根据期望的线性性质：\n$$\n= N\\,\\mathbb{E}\\!\\left[\\,(\\mathbf{R}\\boldsymbol{\\gamma})_{j}^{2}\\,\\right] + \\frac{1}{N}\\mathbb{E}\\!\\left[\\,(\\mathbf{X}^{\\top}\\mathbf{e})_{j}^{2}\\,\\right] + 2\\,\\mathbb{E}\\!\\left[\\,(\\mathbf{R}\\boldsymbol{\\gamma})_{j}(\\mathbf{X}^{\\top}\\mathbf{e})_{j}\\,\\right]\n$$\n随机向量 $\\boldsymbol{\\gamma}$ 和 $\\mathbf{e}$ 是独立的，并且均值为零。因此，交叉项的期望为零：\n$$\n\\mathbb{E}\\!\\left[\\,(\\mathbf{R}\\boldsymbol{\\gamma})_{j}(\\mathbf{X}^{\\top}\\mathbf{e})_{j}\\,\\right] = \\mathbb{E}\\!\\left[\\,(\\mathbf{R}\\boldsymbol{\\gamma})_{j}\\,\\right] \\mathbb{E}\\!\\left[\\,(\\mathbf{X}^{\\top}\\mathbf{e})_{j}\\,\\right] = 0\n$$\n我们分别计算剩下的两项。\n\n第 1 项：$\\mathbb{E}\\!\\left[\\,(\\mathbf{R}\\boldsymbol{\\gamma})_{j}^{2}\\,\\right]$\n$\\mathbf{R}\\boldsymbol{\\gamma}$ 的第 $j$ 个分量是 $\\sum_{k=1}^{M} r_{jk}\\gamma_{k}$。\n$$\n\\mathbb{E}\\!\\left[\\,(\\mathbf{R}\\boldsymbol{\\gamma})_{j}^{2}\\,\\right] = \\mathbb{E}\\!\\left[\\,\\left(\\sum_{k=1}^{M} r_{jk}\\gamma_{k}\\right)^{2}\\,\\right] = \\mathbb{E}\\!\\left[\\,\\sum_{k=1}^{M}\\sum_{l=1}^{M} r_{jk}r_{jl}\\gamma_{k}\\gamma_{l}\\,\\right]\n$$\n$$\n= \\sum_{k=1}^{M}\\sum_{l=1}^{M} r_{jk}r_{jl}\\,\\mathbb{E}\\!\\left[\\,\\gamma_{k}\\gamma_{l}\\,\\right]\n$$\n给定 $\\boldsymbol{\\gamma} \\sim \\mathcal{N}(\\mathbf{0}, \\sigma_{\\gamma}^{2}\\mathbf{I}_{M})$，我们有 $\\mathbb{E}[\\gamma_{k}\\gamma_{l}] = \\sigma_{\\gamma}^{2}\\delta_{kl}$，其中 $\\delta_{kl}$ 是克罗内克 δ。\n$$\n= \\sum_{k=1}^{M}\\sum_{l=1}^{M} r_{jk}r_{jl}\\sigma_{\\gamma}^{2}\\delta_{kl} = \\sigma_{\\gamma}^{2}\\sum_{k=1}^{M} r_{jk}^{2}\n$$\n使用 LD 得分的定义 $l_{j} = \\sum_{k=1}^{M} r_{jk}^{2}$，该项简化为 $\\sigma_{\\gamma}^{2}l_{j}$。\n\n第 2 项：$\\mathbb{E}\\!\\left[\\,(\\mathbf{X}^{\\top}\\mathbf{e})_{j}^{2}\\,\\right]$\n$\\mathbf{X}^{\\top}\\mathbf{e}$ 的第 $j$ 个分量是 $\\mathbf{x}_{j}^{\\top}\\mathbf{e}$，其中 $\\mathbf{x}_{j}$ 是 $\\mathbf{X}$ 的第 $j$ 列。这是一个均值为零的标量随机变量。其期望的平方即为其方差。\n$$\n\\mathbb{E}\\!\\left[\\,(\\mathbf{x}_{j}^{\\top}\\mathbf{e})^{2}\\,\\right] = \\operatorname{Var}(\\mathbf{x}_{j}^{\\top}\\mathbf{e}) = \\mathbf{x}_{j}^{\\top}\\operatorname{Cov}(\\mathbf{e})\\mathbf{x}_{j}\n$$\n给定 $\\mathbf{e} \\sim \\mathcal{N}(\\mathbf{0}, \\sigma_{e}^{2}\\mathbf{I}_{N})$，协方差矩阵 $\\operatorname{Cov}(\\mathbf{e})$ 为 $\\sigma_{e}^{2}\\mathbf{I}_{N}$。\n$$\n= \\mathbf{x}_{j}^{\\top}(\\sigma_{e}^{2}\\mathbf{I}_{N})\\mathbf{x}_{j} = \\sigma_{e}^{2}(\\mathbf{x}_{j}^{\\top}\\mathbf{x}_{j})\n$$\n$\\mathbf{X}$ 的列被标准化为均值为 $0$、方差为 $1$。列 $\\mathbf{x}_{j}$ 的样本方差为 $\\frac{1}{N}\\sum_{i=1}^{N}(X_{ij} - \\bar{X}_{j})^{2} = 1$。由于均值 $\\bar{X}_{j}$ 为 $0$，这等于 $\\frac{1}{N}\\sum_{i=1}^{N}X_{ij}^{2} = \\frac{1}{N}\\mathbf{x}_{j}^{\\top}\\mathbf{x}_{j} = 1$。因此，$\\mathbf{x}_{j}^{\\top}\\mathbf{x}_{j} = N$。\n代入此结果，我们得到 $\\mathbb{E}\\!\\left[\\,(\\mathbf{X}^{\\top}\\mathbf{e})_{j}^{2}\\,\\right] = N\\sigma_{e}^{2}$。\n\n合并各项，$\\hat{\\beta}_{j}^{2}$ 的期望为：\n$$\n\\mathbb{E}\\!\\left[\\,\\hat{\\beta}_{j}^{2}\\,\\right] = \\mathbb{E}\\!\\left[\\,(\\mathbf{R}\\boldsymbol{\\gamma})_{j}^{2}\\,\\right] + \\frac{1}{N^2}\\mathbb{E}\\!\\left[\\,(\\mathbf{X}^{\\top}\\mathbf{e})_{j}^{2}\\,\\right] = \\sigma_{\\gamma}^{2}l_{j} + \\frac{1}{N^2}(N\\sigma_{e}^{2}) = \\sigma_{\\gamma}^{2}l_{j} + \\frac{\\sigma_{e}^{2}}{N}\n$$\n因此，所求的量是：\n$$\n\\mathbb{E}\\!\\left[\\,N\\,\\hat{\\beta}_{j}^{2} \\,\\middle|\\, \\mathbf{R} \\right] = N\\,\\mathbb{E}\\!\\left[\\,\\hat{\\beta}_{j}^{2}\\,\\right] = N\\left( \\sigma_{\\gamma}^{2}l_{j} + \\frac{\\sigma_{e}^{2}}{N} \\right) = N\\sigma_{\\gamma}^{2}l_{j} + \\sigma_{e}^{2}\n$$\n最后一步是用给定的参数 $h_{g}^{2}$ 和 $M$ 来表示 $\\sigma_{\\gamma}^{2}$ 和 $\\sigma_{e}^{2}$。\n总表型方差 $\\operatorname{Var}(\\mathbf{y})$ 给定为 $1$。该方差可以分解为遗传和环境分量。\n$$\n\\operatorname{Var}(\\mathbf{y}) = \\operatorname{Var}(\\mathbf{X}\\boldsymbol{\\gamma} + \\mathbf{e}) = \\operatorname{Var}(\\mathbf{X}\\boldsymbol{\\gamma}) + \\operatorname{Var}(\\mathbf{e})\n$$\n环境分量的平均方差是 $\\sigma_{e}^{2}$。遗传方差由 $h_{g}^{2} \\equiv \\operatorname{Var}(\\mathbf{X}\\boldsymbol{\\gamma})$ 给出。因此，$\\operatorname{Var}(\\mathbf{y}) = h_{g}^{2} + \\sigma_{e}^{2}$。\n由于 $\\operatorname{Var}(\\mathbf{y})=1$，我们有 $1 = h_{g}^{2} + \\sigma_{e}^{2}$，这得出 $\\sigma_{e}^{2} = 1 - h_{g}^{2}$。\n\n现在我们将 $h_{g}^{2}$ 与 $\\sigma_{\\gamma}^{2}$ 联系起来。遗传方差是群体中遗传值的期望方差。\n$$\nh_{g}^{2} = \\operatorname{Var}(\\mathbf{X}\\boldsymbol{\\gamma}) = \\mathbb{E}_{\\boldsymbol{\\gamma}}\\!\\left[\\frac{1}{N}(\\mathbf{X}\\boldsymbol{\\gamma})^{\\top}(\\mathbf{X}\\boldsymbol{\\gamma})\\right] = \\frac{1}{N}\\mathbb{E}\\!\\left[\\boldsymbol{\\gamma}^{\\top}\\mathbf{X}^{\\top}\\mathbf{X}\\boldsymbol{\\gamma}\\right]\n$$\n使用 $\\mathbf{X}^{\\top}\\mathbf{X} = N\\mathbf{R}$：\n$$\nh_{g}^{2} = \\mathbb{E}\\!\\left[\\boldsymbol{\\gamma}^{\\top}\\mathbf{R}\\boldsymbol{\\gamma}\\right] = \\mathbb{E}\\!\\left[\\operatorname{Tr}(\\mathbf{R}\\boldsymbol{\\gamma}\\boldsymbol{\\gamma}^{\\top})\\right] = \\operatorname{Tr}(\\mathbf{R}\\,\\mathbb{E}[\\boldsymbol{\\gamma}\\boldsymbol{\\gamma}^{\\top}])\n$$\n由于 $\\mathbb{E}[\\boldsymbol{\\gamma}\\boldsymbol{\\gamma}^{\\top}] = \\operatorname{Cov}(\\boldsymbol{\\gamma}) = \\sigma_{\\gamma}^{2}\\mathbf{I}_{M}$：\n$$\nh_{g}^{2} = \\operatorname{Tr}(\\mathbf{R}\\sigma_{\\gamma}^{2}\\mathbf{I}_{M}) = \\sigma_{\\gamma}^{2}\\operatorname{Tr}(\\mathbf{R})\n$$\n$\\mathbf{R}$ 的对角线元素为 $r_{jj} = \\frac{1}{N}\\mathbf{x}_{j}^{\\top}\\mathbf{x}_{j} = \\frac{1}{N}(N) = 1$。\n迹是主对角线元素之和：$\\operatorname{Tr}(\\mathbf{R}) = \\sum_{j=1}^{M} r_{jj} = \\sum_{j=1}^{M} 1 = M$。\n所以，$h_{g}^{2} = M\\sigma_{\\gamma}^{2}$，这得出 $\\sigma_{\\gamma}^{2} = \\frac{h_{g}^{2}}{M}$。\n\n将 $\\sigma_{\\gamma}^{2}$ 和 $\\sigma_{e}^{2}$ 的表达式代入我们的结果：\n$$\n\\mathbb{E}\\!\\left[\\,N\\,\\hat{\\beta}_{j}^{2} \\,\\middle|\\, \\mathbf{R} \\right] = N\\left(\\frac{h_{g}^{2}}{M}\\right)l_{j} + (1 - h_{g}^{2})\n$$\n此表达式是所要求形式的最终结果。", "answer": "$$\n\\boxed{\\frac{N h_{g}^{2}}{M} l_{j} + 1 - h_{g}^{2}}\n$$", "id": "2838198"}]}