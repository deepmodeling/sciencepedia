## 引言
随着[单细胞测序](@entry_id:198847)技术的革命性发展，我们现在能够以前所未有的分辨率捕捉到复杂生物系统中单个细胞的转录状态。然而，这些数据本质上是静态的“快照”，捕捉的是特定时间点的细胞状态。在发育、再生和疾病等动态过程中，理解细胞如何做出命运决定、它们遵循何种谱系路径，仍然是一个核心的科学挑战。如何从这些离散的、高维度的快照中重建出连续的、动态的生命故事，正是现代[计算生物学](@entry_id:146988)面临的关键问题。

本文旨在系统性地介绍利用[单细胞转录组学](@entry_id:274799)进行谱系示踪和[细胞命运分析](@entry_id:200315)的核心定量方法和应用。我们将带领读者深入探索这一前沿领域，从根本的[统计模型](@entry_id:165873)到复杂的生物学应用。在**“原理与机制”**一章中，我们将奠定分析的数学和计算基础，揭示如何从原始测[序数](@entry_id:150084)据中推断出细胞的动态行为和亲缘关系。接着，在**“应用与跨学科交叉”**一章，我们将展示这些原理如何在[发育生物学](@entry_id:141862)、癌症研究和神经科学等多个领域中解决关键的科学问题。最后，通过**“动手实践”**部分，读者将有机会将理论知识应用于实际的数据分析挑战中。

本系列文章将从最基本的科学原理出发，逐步构建起一个完整的分析框架，帮助读者不仅学会“如何做”，更理解“为什么这么做”。现在，让我们首先进入第一章，深入探讨其背后的核心原理与机制。

## 原理与机制

本章旨在深入探讨利用[单细胞转录组学](@entry_id:274799)进行谱系示踪和[细胞命运分析](@entry_id:200315)的核心科学原理与计算机制。我们将从数据产生的统计基础出发，逐步构建起用于推断细胞动态过程、重建谱系结构、识别关键生物学事件以及检验发育生物学核心假设的数学模型。本章内容假定读者已对[单细胞转录组学](@entry_id:274799)技术有基本了解，因此我们将直接进入其背后的定量框架。

### 从原始数据到表达矩阵：[单细胞测序](@entry_id:198847)的定量基础

任何谱系和命运分析的起点都是一个数值矩阵，即基因在每个细胞中的表达计数。理解这个矩阵是如何产生的，以及它所固有的统计特性，对于后续所有分析的严谨性至关重要。[单细胞RNA测序](@entry_id:142269)（scRNA-seq）本质上是一个多阶段的采样过程。

在基于液滴的scRNA-seq技术中，细胞悬液与带有条形码的凝胶珠在微流控设备中被包裹形成油包水液滴。这是一个[随机过程](@entry_id:159502)，理想情况下，我们希望每个液滴只含一个细胞（**单细胞体，singlet**）。然而，如果细胞上样浓度过高，一个液滴可能捕获多个细胞（**多细胞体，multiplet**），这会混淆下游分析。相反，如果浓度过低，大多数液滴将是空的，导致测序资源的浪费。细胞进入液滴的过程可以被精确地建模为一个**泊松分布 (Poisson distribution)**。如果细胞上样浓度对应的平均每个液滴的细胞数为 $\lambda$，那么一个液滴中恰好含有 $k$ 个细胞的概率为：

$$P(K=k) = \frac{\lambda^k \exp(-\lambda)}{k!}$$

为了最大限度地减少多细胞体（$k \ge 2$）并获得足够多的单细胞体（$k=1$），实验通常选择一个较小的 $\lambda$ 值（例如，$\lambda < 0.1$）。这意味着单细胞体的概率 $P(K=1) = \lambda \exp(-\lambda)$ 远大于多细胞体的概率。因此，从一个生成了 $D$ 个液滴的实验中，我们预期能获得的单细胞体液滴数量为 $D \times \lambda \exp(-\lambda)$ [@problem_id:2672350]。

细胞被捕获后，其内部的[信使RNA](@entry_id:262893)（mRNA）分子需要被[逆转录](@entry_id:141572)并加上**[唯一分子标识符](@entry_id:192673) (Unique Molecular Identifier, UMI)**。UMI是一段短的随机序列，它能够在测序后区分哪些读长（reads）来源于最初的同一个mRNA分子，从而消除PCR扩增偏好，实现对原始mRNA分子的精确计数。然而，并非细胞中的所有mRNA分子都能被成功捕获和测序。每个mRNA分子的捕获可以被视为一个独立的**[伯努利试验](@entry_id:268355) (Bernoulli trial)**，其成功概率为 $p_c$。如果一个细胞中某个基因的mRNA平均有 $m_B$ 个分子，那么根据**泊松稀疏化 (Poisson thinning)** 原理，我们最终能观测到的该基因的UMI计数将服从一个新的[泊松分布](@entry_id:147769)，其均值为 $\mu = m_B p_c$ [@problem_id:2672350]。这个简单的模型揭示了一个关键点：即使一个基因在细胞中高表达，如果其捕获效率 $p_c$ 很低，最终的UMI计数也可能很小，甚至为零。对于谱系示踪应用，如果需要通过检测一个表达的条形码来分配细胞谱系，那么成功分配的前提是观测到足够数量（例如，至少 $r$ 个）的条形码UMI。这个成功的概率 $P(X \ge r)$ 可以直接从[泊松分布](@entry_id:147769)计算得出。

综合这些步骤——从细胞上样到UMI计数——我们可以构建一个端到端的模型，来预测一个scRNA-seq实验最终能产出多少个通过了质量控制且被成功分配了谱系的单细胞[转录组](@entry_id:274025)，这是评估实验设计和成本效益的基础 [@problem_id:2672350]。

### 基因表达与细胞状态的建模

获得了单细胞基因表达计数矩阵后，下一步就是如何利用这些数据来理解细胞的生物学状态。一个细胞的“转录状态”可以被想象为在一个以所有基因表达水平为坐标轴的高维空间中的一个点。细胞在分化或响应刺激时，会沿着这个高维空间中的特定路径移动。

对UMI计数的建模是所有下游分析的基石。两种概率模型尤为重要：

1.  **泊松模型 (Poisson Model)**：对于单个基因或一小组功能相关的基因模块，其UMI计数可以近似地看作服从[泊松分布](@entry_id:147769)。这在理论上是合理的，因为UMI计数可以被看作是在一个大的mRNA分子池中对特定基因进行稀疏采样，符合泊松分布的“稀有事件”特性。例如，在评估一个细胞对特定命运（如命运A或命运B）的偏好时，我们可以假设与命运A相关的基因模块的计数 $x_A$ 服从 $\text{Poisson}(\lambda_{f,A})$，其中 $\lambda_{f,A}$ 是该细胞真实命运为 $f$ 时模块A的平均表达率 [@problem_id:2672365]。

2.  **[多项式模型](@entry_id:752298) (Multinomial Model)**：当我们考虑一个细胞的整个[转录组](@entry_id:274025)时，一个更精确的模型是多项式[分布](@entry_id:182848)。一个细胞的总UMI计数（即**文库大小**）是有限的。因此，每个基因的UMI计数可以被看作是从一个代表该细胞内所有mRNA相对丰度的池中进行抽样。如果一个细胞属于类型 $t$，其参考[转录组](@entry_id:274025)（即各基因的真实比例）为向量 $\mathbf{p}_t = (p_{t,0}, \dots, p_{t,G-1})$，那么在一个总文库大小为 $L$ 的细胞中观测到基因计数向量 $\mathbf{c} = (c_0, \dots, c_{G-1})$ 的[似然性](@entry_id:167119)就由多项式[分布](@entry_id:182848)给出 [@problem_id:2672369]。这个模型是许多细胞类型注释和[差异表达分析](@entry_id:266370)方法的基础。

在实践中，由于技术噪音和内在的生物变异，原始计数的[方差](@entry_id:200758)通常与其均值相关。为了稳定[方差](@entry_id:200758)并使许多下游算法（特别是那些基于线性模型和欧氏距离的算法）表现更好，通常会对原始计数矩阵 $X$ 进行对数转换。一个标准的操作是**log1p**变换，即计算 $Y = \ln(1+X)$，其中 $\ln$ 是自然对数 [@problem_id:2672390]。这种变换可以将[乘性](@entry_id:187940)效应（例如，批次间的捕获效率差异）转化为加性效应，使其更易于建模和校正。

### 时间维度：从静态快照推断动态过程

发育生物学的核心是理解随时间变化的动态过程。然而，[scRNA-seq](@entry_id:155798)本身提供的是在特定时间点捕获的细胞“快照”。一个核心挑战是如何从这些静态快照中重建出连续的动态过程。

#### [伪时间](@entry_id:262363) (Pseudotime)

**[伪时间](@entry_id:262363)**是解决这一挑战的核心概念。其基本思想是，即使细胞是在同一时间点被捕获的，它们在发育或分化过程中也处于不同的阶段。这些阶段的差异体现在它们的转录组上。处于连续过程中的细胞，其[转录组](@entry_id:274025)在状态空间中也应该是连续变化的。因此，我们可以通过计算细胞间[转录组](@entry_id:274025)的相似性来对它们进行排序，从而构建一个代表发育进程的轨迹。这个轨迹上的顺序就被称为[伪时间](@entry_id:262363)。

一个常见的方法是，首先将高维的基因表达数据[降维](@entry_id:142982)（例如使用PCA或UMAP），然后在降维空间中构建一个细胞图（cell graph）。在这个图中，节点是细胞或细胞群，边表示它们在转录上的邻近关系。如果我们能确定一个“起始”或“根”细胞（例如，一个已知的干细胞群体），那么其他细胞的[伪时间](@entry_id:262363)就可以被定义为它们在图上到根节点的[最短路径距离](@entry_id:754797) [@problem_id:2672359]。

#### [代谢标记](@entry_id:177447) (Metabolic Labeling)

虽然[伪时间](@entry_id:262363)是一个强大的概念，但它毕竟是一个推断量。**[代谢标记](@entry_id:177447)**技术，如scSLAM-seq、scNT-seq或RNA-tailing，提供了一种更直接的方式来测量细胞内的RNA动态。这些方法通过向细胞培养基中添加经过修饰的[核苷酸](@entry_id:275639)（如4sU），让新合成的RNA在一段时间（脉冲，pulse）内被标记。在测序时，这些标记可以被识别出来，从而区分出“新的”（有标记的）RNA和“旧的”（无标记的）RNA。

这种方法背后的定量原理基于RNA的**[一级动力学](@entry_id:183701) (first-order kinetics)**。假设一个基因在时刻 $t=-\tau$ 从关闭状态转为开启状态，其合成速率为常数 $k$，降解速率为 $\gamma$。在 $t=0$ 时刻捕获细胞，并在此前的 $t_p$ 时段内（即从 $-t_p$ 到 $0$）进行脉冲标记，标记效率为 $\eta$。我们可以精确地推导出在 $t=0$ 时，总RNA分子数 $M(\tau)$ 和标记RNA分子数 $L(\tau)$ 的[期望值](@entry_id:153208)。由此，我们可以得到预期标记RNA的比例 $p(\tau)$ 作为一个关于细胞年龄 $\tau$ （即基因开启至今的时间）的函数 [@problem_id:2672361]：

$$p(\tau) = \frac{L(\tau)}{M(\tau)} = \begin{cases} \eta,  & \text{if } \tau \le t_p \\ \eta \frac{1 - \exp(-\gamma t_p)}{1 - \exp(-\gamma \tau)}, & \text{if } \tau > t_p \end{cases}$$

这个公式直观地反映了：如果一个细胞的基因开启时间 $\tau$ 小于或等于标记时长 $t_p$，那么它所有的RNA都是在标记窗口内合成的，因此标记比例就是标记效率 $\eta$。如果 $\tau > t_p$，那么细胞中还存在一些在标记前合成的“旧”RNA，它们会稀释标记比例。通过在单个细胞中观测到的总UMI数 $m$ 和标记UMI数 $\ell$，我们可以将 $\ell$ 建模为二项分布 $\text{Binomial}(m, p(\tau))$。然后，通过**最大似然估计 (Maximum Likelihood Estimation, MLE)**，我们就可以反解出每个细胞的年龄 $\hat{\tau}$。这个基于动力学的“真实”时间为[伪时间分析](@entry_id:267953)提供了强大的验证和补充 [@problem_id:2672361]。

### 重建谱系结构

谱系分析的目标是重建细胞间的[亲缘关系](@entry_id:172505)，即构建一个谱系树。这可以通过两种主要策略实现。

#### 基于转录相似性的[轨迹推断](@entry_id:176370)

如前所述，通过计算细胞间的[转录组](@entry_id:274025)相似性，我们可以构建一个图来近似发育[流形](@entry_id:153038)。这种方法虽然广泛使用，但其基本假设是“转录相似性等同于发育上的邻近性”。这在大多数情况下是合理的，但当细胞状态发生[振荡](@entry_id:267781)或存在多个不相关的[趋同演化](@entry_id:263490)路径时，可能会产生误导。尽管如此，这种方法是探索未知发育过程、发现细胞轨迹和分支点的标准工具 [@problem_id:2672359]。

#### 基于遗传条形码的谱系重建

一种更直接、更可靠的谱系重建方法是利用细胞内可遗传的标记，即**遗传条形码 (genetic barcodes)**。通过CRISPR/Cas9等[基因编辑技术](@entry_id:274420)，可以在细胞基因组的特定位点引入随机的、累[积性](@entry_id:187940)的突变（“伤疤”）。当一个细胞分裂时，它的子代会继承其所有的伤疤，并可能获得新的伤疤。通过在实验终点对单个细胞的条形码序列进行测序，我们就可以像考古一样，根据共享和独特的伤疤模式来重建它们的亲缘关系。

这种重建的理论基础是系统发育学中的**无限位点模型 (infinite-sites model)**。该模型假设每个可编辑的位点在整个谱系树的演化历史中最多只发生一次不可逆的突变。这意味着不会出现[回复突变](@entry_id:163326)（编辑状态变回未编辑状态）或在同一位点发生多次独立的编辑事件。在这个模型下，我们可以通过一个简单的测试来判断一组观测到的条形码是否与一个完美的谱系树兼容。这就是**四配子检验 (four-gamete test)**：对于任意两个位点，如果在细胞群体中同时观察到了所有四种可能的组合（`00`, `01`, `10`, `11`，其中`0`代表未编辑，`1`代表编辑），那么就不可能存在一个满足无限位点模型的完美谱系树 [@problem_id:2672323]。

当数据与模型兼容时，我们可以通过计算细胞间条形码的**[汉明距离](@entry_id:157657) (Hamming distance)**（即不同位点的数量）来量化它们的[演化距离](@entry_id:177968)。然后，在以细胞为节点、[汉明距离](@entry_id:157657)为边权重的完全图上构建一个**[最小生成树](@entry_id:264423) (Minimum Spanning Tree, MST)**。这棵MST的总权重为解释所有观测到的条形码所需的最少编辑事件数量提供了一个下界，并且当数据完美符合模型时，它本身就是一种最简约的谱系树重建 [@problem_id:2672323]。

### 分析轨迹：识别关键生物学事件

一旦重建了谱系轨迹（无论是基于相似性还是条形码），我们就可以开始从中提取生物学洞见，其中最重要的就是识别[细胞命运决定](@entry_id:196591)的关键事件。

#### 分支点的识别与量化

在发育轨迹中，**[分支点](@entry_id:166575) (branch point)** 代表了祖细胞群体开始向多种不同命运分化的时刻。在基于转录相似性构建的细胞图上，这些点通常对应于图中的[分叉](@entry_id:270606)结构。我们可以用**[吸收马尔可夫链](@entry_id:185661) (absorbing Markov chains)** 的框架来严格地定义和识别它们 [@problem_id:2672359]。

首先，我们将细胞图转化为一个有向的马尔可夫链，其中转移方向由[伪时间](@entry_id:262363)决定（即细胞只能从伪时间早的状态转移到伪时间晚的状态）。轨迹的终点，即完全分化的细胞类型，对应于这个马尔可夫链的**[吸收态](@entry_id:161036) (absorbing states)**。对于图中的任何一个非终点细胞 $i$，我们可以计算它最终到达每一个终点命运 $t$ 的**[吸收概率](@entry_id:265511) (absorption probability)** $h_{i,t}$。这个[概率向量](@entry_id:200434) $(h_{i,1}, h_{i,2}, \dots)$ 捕捉了细胞 $i$ 的命运潜能。

一个真正的分支点应该是一个命运不确定性最大的地方。我们可以使用**[香农熵](@entry_id:144587) (Shannon entropy)** 来量化这种不确定性。对于细胞 $i$，其归一化的分支熵可以定义为：

$$S_i^* = -\frac{1}{\ln |T|} \sum_{t \in T} h_{i,t} \ln h_{i,t}$$

其中 $T$ 是终点命运的集合。$S_i^*$ 的值在0到1之间，值越高表示命运越不确定。因此，我们可以将[分支点](@entry_id:166575)定义为那些同时满足拓扑结构（例如，图中的度 $\ge 3$）和高熵（$S_i^* \ge \theta$）的细胞。此外，我们还可以根据对每个终点命运的[吸收概率](@entry_id:265511)是否超过某个阈值 $\beta$，来定义一个分支点的**[分叉](@entry_id:270606)阶数 (bifurcation order)**，即它能显著分化为几种不同的命运 [@problem_id:2672359]。

#### 量化早期命运偏好与谱系启动

在细胞到达明确的[分支点](@entry_id:166575)之前，它们可能已经表现出对某种命运的“偏好”或“启动”。我们可以设计一个贝叶斯框架来量化这种早期信号 [@problem_id:2672365]。假设有两个最终命运A和B，以及两个分别与这两个命运相关的基因模块。对于一个早期的祖细胞，我们可以基于它在这两个模块上的基因表达计数 $(x_A, x_B)$，来计算它属于命运A的[后验概率](@entry_id:153467) $p_A = \mathbb{P}(\text{A} \mid x_A, x_B)$。这个概率可以用来定义一个**命运偏好指数 (fate bias index)**，$B = \max\{p_A, 1-p_A\}$，它衡量了细胞命运的确定性。

同时，我们可以定义一个**谱系启动分数 (lineage priming score)**，$S$。它衡量的是观测数据支持命运A相对于命运B的证据强度，这通常通过[对数似然比](@entry_id:274622)来计算。这个分数反映了细胞在转录层面“准备”朝向某个特定谱系的程度，即使其最终的命运概率还不确定 [@problem_id:2672365]。

#### 将命运选择建模为[随机游走](@entry_id:142620)

我们可以将细胞在命运决定过程中的状态变化抽象为一个更简单的模型：一维[随机游走](@entry_id:142620) [@problem_id:2672337]。想象一个潜在的转录状态空间，从状态 $0$（命运B）到状态 $M$（命运A）。一个祖细胞起始于中间的某个状态 $i$。在每个时间步，它有概率 $p$ 向状态 $M$ 移动一步，有概率 $q=1-p$ 向状态 $0$ 移动一步。状态 $0$ 和 $M$ 是[吸收边界](@entry_id:201489)，一旦到达就无法离开。

这个问题在概率论中被称为**赌徒破产问题 (Gambler's Ruin problem)**。通过求解相应的递推关系，我们可以得到两个重要的解析解：
1.  从状态 $i$ 出发，最终被命运A（状态 $M$）吸收的概率 $H_i$。
2.  从状态 $i$ 出发，到达任一命运边界所需的平均步数 $T_i$，即预期的分化时间。

当 $p=0.5$（无偏[随机游走](@entry_id:142620)）时，$H_i = i/M$，$T_i = i(M-i)$。当 $p \ne 0.5$ 时，解会依赖于比值 $q/p$。这个看似简单的模型为我们思考命运决定的随机性、偏好性以及所需时间提供了一个强大的理论框架 [@problem_id:2672337]。

### 检验机制性假设：选择与指令

除了描述发育过程，scRNA-seq数据还能被用来检验关于其背后机制的核心假设。发育生物学中一个经典的问题是**选择 (selection)** 与 **指令 (instruction)** 模型之争。
- **选择模型**认为，祖细胞群体内部已经存在[异质性](@entry_id:275678)，一部分细胞已经“内定”了未来的命运，后续的环境信号只是选择并扩增这些预先确定的细胞。
- **指令模型**则认为，祖细胞群体是同质的，所有细胞都有相同的潜能，是后续的环境信号“指令”它们走向不同的命运。

我们可以使用**[贝叶斯模型选择](@entry_id:147207) (Bayesian model selection)** 的方法，通过[scRNA-seq](@entry_id:155798)数据来判断哪个模型能更好地解释观测结果 [@problem_id:2672362]。具体做法是，对于一个与命运相关的基因，我们比较两个模型：
- $M_{\text{sel}}$：在早期时间点，注定走向命运A和命运B的细胞群体已经具有不同的基因表达均值（$\mu_A \ne \mu_B$）。
- $M_{\text{ins}}$：在早期时间点，这两个群体是无法区分的，共享同一个基因表达均值（$\mu_A = \mu_B = \mu$）。

通过计算每个模型下的**边缘似然 (marginal likelihood)** $p(\mathbf{y} \mid M)$，我们可以得到**[贝叶斯因子](@entry_id:143567) (Bayes Factor)**，$\text{BF} = p(\mathbf{y} \mid M_{\text{sel}}) / p(\mathbf{y} \mid M_{\text{ins}})$。边缘[似然](@entry_id:167119)是通过对模型中的所有未知参数（这里是表达均值 $\mu$）进行积分得到的，它自然地惩罚了更复杂的模型（$M_{\text{sel}}$ 有两个参数，而 $M_{\text{ins}}$ 只有一个）。如果 $\text{BF} \gg 1$，则数据强烈支持选择模型；如果 $\text{BF} \ll 1$，则数据支持指令模型。在给定观测数据和[先验分布](@entry_id:141376)（例如，使用共轭的Gamma[分布](@entry_id:182848)作为泊松率的先验）后，[贝叶斯因子](@entry_id:143567)可以被精确计算出来，从而为这个经典的生物学问题提供了定量的答案 [@problem_id:2672362]。

### 实践考量与高级主题

最后，一个严谨的分析必须考虑到现实世界中的技术挑战，并对分析结果的不确定性进行量化。

#### 处理批次效应

scRNA-seq实验通常分多个批次进行，不同批次间的技术差异（如试剂、仪器、操作员的差异）会导致系统性的、非生物学的变异，即**[批次效应](@entry_id:265859) (batch effects)**。这些效应会严重干扰对真实生物学信号的分析，例如，来自不同批次的相同类型细胞可能会因为技术原因而在表达空间中分开，而不是因为生物学差异。

一个简单而有效的模型是将[批次效应](@entry_id:265859)视为在对数转换后的表达值上的一个加性偏移 [@problem_id:2672390]。为了校正这种效应，我们可以利用**锚定基因 (anchor genes)**，即那些被认为在不同生物学条件下表达稳定的管家基因。通过计算这些锚定基因在不同批次间的平均表达差异，我们可以估算出批次偏移量 $\hat{d}$，然后从受影响的批次数据中减去这个偏移量。

校正的效果需要被量化评估。一个好的评估指标是**跨批次最近邻标签一致性 (cross-batch nearest-neighbor label agreement)**。这个指标衡量的是：在整合后的表达空间中，一个批次中的细胞，其最近的邻居在另一个批次中具有相同细胞类型（或谱系）标签的比例。如果批次校正成功，这个一致[性比](@entry_id:172643)例应该会显著提高 [@problem_id:2672390]。

#### 量化轨迹拓扑的不确定性

任何通过计算推断出的发育轨迹都只是一个[统计估计](@entry_id:270031)，它受到数据噪音和有限样本量的影响。因此，报告单一的、确定的[轨迹图](@entry_id:756083)是不完整的，我们必须评估其稳健性。**[自助法](@entry_id:139281) (Bootstrap)**，或称自举法，是一种强大的统计工具，可用于此目的 [@problem_id:2672358]。其思想是从原始细胞样本中有放回地[重复抽样](@entry_id:274194)，每次抽样都构建一个新的[轨迹图](@entry_id:756083)。通过分析这一系列（例如，几百个）自助法生成的图，我们可以量化原始推断轨迹中各种特征的稳定性。

我们可以定义一系列指标来评估不确定性：
- **无环概率 ($P_{\text{acyc}}$)**：在多少比例的自助法生成的图中，轨迹是无环的（有向无环图，DAG）。发育过程通常是单向的，环的存在往往是噪音的产物。
- **双命运概率 ($P_{2\text{fate}}$)**：在多少比例的图中，我们观察到恰好两个终点命运。
- **分叉置信度 ($P_{\text{bifurc}}(s)$)**：对于一个推断出的分支点 $s$，它在多少比例的自助法生成的图中同时满足[分支点](@entry_id:166575)的拓扑和命运分离条件。这个值直接量化了我们对该分支事件的信心。
- **平均[边集](@entry_id:267160)相似度 ($\overline{J}$)**：通过计算所有成对的自助法生成图之间的[边集](@entry_id:267160)相似度（如Jaccard或Dice系数），我们可以得到一个衡量整体轨迹[结构稳定性](@entry_id:147935)的全局指标 [@problem_id:2672358]。

#### 概率化细胞类型注释

最后，细胞状态通常是连续变化的，将它们强制分配到离散的类型标签中有时会过于简化。一个更精细的方法是进行概率化的注释。使用前面提到的贝叶斯框架，我们可以为每个[细胞计算](@entry_id:267237)它属于每一种已知细胞类型的[后验概率](@entry_id:153467) [@problem_id:2672369]。这种方法不仅能给出最可能的注释（**最大后验估计，MAP**），还能提供一个置信度分数。通过设定一个[置信度](@entry_id:267904)阈值 $\tau$，我们可以将那些[最大后验概率](@entry_id:268939)低于此阈值的细胞标记为“未分配 (unassigned)”。这对于识别处于过渡状态的细胞或全新的、未曾定义的细胞类型非常有价值，它承认并量化了我们认知中的不确定性 [@problem_id:2672369]。