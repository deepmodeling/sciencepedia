{"hands_on_practices": [{"introduction": "许多细胞信号通路依赖于蛋白质的可逆磷酸化，这一过程由激酶和磷酸酶的拮抗活性所控制。理解这些酶活性的平衡如何决定目标蛋白的稳态磷酸化水平，是分析调控回路的基础。本实践问题将引导您通过第一性原理推导，量化底物的磷酸化分数，从而对这一普遍存在的生物开关进行定量审视。[@problem_id:2523650]", "problem": "一种具有单个磷酸化位点的细菌响应调节蛋白，在未磷酸化形式（表示为 $S$）和磷酸化形式（表示为 $S_p$）之间循环。一种特异性激酶（表示为 $K$）催化 $S \\to S_p$ 反应，而一种特异性磷酸酶（表示为 $P$）催化 $S_p \\to S$ 反应。假设细胞质充分混合且体积恒定，在所考虑的时间尺度内，底物蛋白没有合成或降解。进一步假设，两种酶都在底物浓度远低于其米氏常数的条件下运行 ($[S] \\ll K_M$)，因此催化效率（定义为转换数与米氏常数的比值 $k_{\\mathrm{cat}}/K_M$）是相应双分子步骤的合适的二级速率常数。设总底物浓度为 $[S]_{\\mathrm{tot}} = [S] + [S_p]$。系统在磷酸化方面处于稳态，这意味着 $[S_p]$ 的净变化率为零。\n\n测得的催化效率和细胞内浓度如下：\n- 激酶催化效率 $(k_{\\mathrm{cat}}/K_M)_{\\mathrm{kin}} = 2.5 \\times 10^{5}\\ \\mathrm{M}^{-1}\\ \\mathrm{s}^{-1}$，\n- 磷酸酶催化效率 $(k_{\\mathrm{cat}}/K_M)_{\\mathrm{pho}} = 1.0 \\times 10^{6}\\ \\mathrm{M}^{-1}\\ \\mathrm{s}^{-1}$，\n- 激酶浓度 $[K] = 30\\ \\mathrm{nM}$，\n- 磷酸酶浓度 $[P] = 12.5\\ \\mathrm{nM}$，\n- 总底物浓度 $[S]_{\\mathrm{tot}} = 5\\ \\mu\\mathrm{M}$。\n\n仅从质量作用动力学、非饱和状态下催化效率 $k_{\\mathrm{cat}}/K_M$ 的定义以及稳态条件出发，推导磷酸化位点分数占据率 $f$（定义为 $f = [S_p]/[S]_{\\mathrm{tot}}$）的表达式，该表达式用 $(k_{\\mathrm{cat}}/K_M)_{\\mathrm{kin}}$、$(k_{\\mathrm{cat}}/K_M)_{\\mathrm{pho}}$、$[K]$ 和 $[P]$ 表示。然后使用所提供的数值计算其值。\n\n将 $f$ 的最终数值表示为无单位的小数。如果需要四舍五入，保留四位有效数字。不要以百分比形式报告。", "solution": "基本依据是在非饱和状态下将质量作用动力学应用于酶催化反应，以及中间产物的稳态条件。当给定酶的 $[S] \\ll K_M$ 时，米氏-门腾速率定律简化为双分子速率定律，其中二级速率常数为 $k_{\\mathrm{cat}}/K_M$。具体来说，对于激酶催化的步骤 $S \\to S_p$，\n$$\nv_{\\mathrm{kin}} = \\left(\\frac{k_{\\mathrm{cat}}}{K_M}\\right)_{\\mathrm{kin}} [K][S],\n$$\n对于磷酸酶催化的步骤 $S_p \\to S$，\n$$\nv_{\\mathrm{pho}} = \\left(\\frac{k_{\\mathrm{cat}}}{K_M}\\right)_{\\mathrm{pho}} [P][S_p].\n$$\n在磷酸化稳态下，磷酸化形式的净变化率为零，因此\n$$\n\\frac{d[S_p]}{dt} = v_{\\mathrm{kin}} - v_{\\mathrm{pho}} = 0 \\quad \\Rightarrow \\quad v_{\\mathrm{kin}} = v_{\\mathrm{pho}}.\n$$\n设分数占据率为 $f = [S_p]/[S]_{\\mathrm{tot}}$，其中 $[S]_{\\mathrm{tot}} = [S] + [S_p]$。那么 $[S_p] = f\\,[S]_{\\mathrm{tot}}$ 且 $[S] = (1 - f)\\,[S]_{\\mathrm{tot}}$。将这些代入稳态等式中，得到\n$$\n\\left(\\frac{k_{\\mathrm{cat}}}{K_M}\\right)_{\\mathrm{kin}} [K]\\,(1 - f)\\,[S]_{\\mathrm{tot}} \\;=\\; \\left(\\frac{k_{\\mathrm{cat}}}{K_M}\\right)_{\\mathrm{pho}} [P]\\; f\\; [S]_{\\mathrm{tot}}.\n$$\n消去 $[S]_{\\mathrm{tot}}$（其为正值）得到\n$$\n\\left(\\frac{k_{\\mathrm{cat}}}{K_M}\\right)_{\\mathrm{kin}} [K]\\,(1 - f) \\;=\\; \\left(\\frac{k_{\\mathrm{cat}}}{K_M}\\right)_{\\mathrm{pho}} [P]\\; f.\n$$\n定义伪一级速率常数\n$$\n\\alpha \\equiv \\left(\\frac{k_{\\mathrm{cat}}}{K_M}\\right)_{\\mathrm{kin}} [K], \\qquad \\beta \\equiv \\left(\\frac{k_{\\mathrm{cat}}}{K_M}\\right)_{\\mathrm{pho}} [P].\n$$\n那么方程变为\n$$\n\\alpha (1 - f) = \\beta f \\quad \\Rightarrow \\quad \\alpha = f(\\alpha + \\beta) \\quad \\Rightarrow \\quad f = \\frac{\\alpha}{\\alpha + \\beta}.\n$$\n该表达式表明，在所述假设下，$f$ 与 $[S]_{\\mathrm{tot}}$ 无关。\n\n现在根据给定的数值计算 $\\alpha$ 和 $\\beta$，注意单位换算。将纳摩尔浓度转换为摩尔浓度：$30\\ \\mathrm{nM} = 30 \\times 10^{-9}\\ \\mathrm{M}$ 且 $12.5\\ \\mathrm{nM} = 12.5 \\times 10^{-9}\\ \\mathrm{M}$。于是\n$$\n\\alpha = \\left(2.5 \\times 10^{5}\\ \\mathrm{M}^{-1}\\ \\mathrm{s}^{-1}\\right)\\left(30 \\times 10^{-9}\\ \\mathrm{M}\\right)\n= (2.5 \\times 30)\\times 10^{5-9}\\ \\mathrm{s}^{-1}\n= 75 \\times 10^{-4}\\ \\mathrm{s}^{-1}\n= 7.5 \\times 10^{-3}\\ \\mathrm{s}^{-1},\n$$\n以及\n$$\n\\beta = \\left(1.0 \\times 10^{6}\\ \\mathrm{M}^{-1}\\ \\mathrm{s}^{-1}\\right)\\left(12.5 \\times 10^{-9}\\ \\mathrm{M}\\right)\n= (1.0 \\times 12.5)\\times 10^{6-9}\\ \\mathrm{s}^{-1}\n= 12.5 \\times 10^{-3}\\ \\mathrm{s}^{-1}.\n$$\n因此，\n$$\nf = \\frac{7.5 \\times 10^{-3}}{7.5 \\times 10^{-3} + 12.5 \\times 10^{-3}}\n= \\frac{7.5}{7.5 + 12.5}\n= \\frac{7.5}{20}\n= 0.375.\n$$\n鉴于所选的数值，该值为精确的小数形式，因此不需要进行超出所示的四舍五入。该结果是无单位的，代表在所述假设下磷酸化位点的稳态分数占据率。", "answer": "$$\\boxed{0.375}$$", "id": "2523650"}, {"introduction": "翻译后修饰不仅能改变蛋白质的活性，还能将其标记以降解，从而直接控制其在细胞内的寿命。N-端法则通路是一个经典例子，其中N-末端的加工过程会产生用于靶向蛋白水解的信号。本练习让您计算一个经历不同加工结果的蛋白质的期望寿命，展示了一个概率性的分子事件如何转化为对蛋白质稳定性的确定性度量。[@problem_id:2523688]", "problem": "在细菌细胞中，由 Methionine aminopeptidase (MetAP) 介导的 N-terminal methionine excision (NME) 是一个共翻译加工事件，其发生与否取决于倒数第二个残基的大小。在细菌的 N-end rule pathway 中，N-末端暴露出一个大体积的疏水残基（如苯丙氨酸）会形成一个主要的去稳定化残基，该残基被 ClpS adaptor 识别，并被靶向至依赖三磷酸腺苷 (ATP) 的 ClpAP 蛋白酶解作用，以降解速率很高的一级反应速率进行降解。当这种暴露的残基被 N-acetyltransferase (NAT) 进行 N-末端乙酰化时，会阻断 ClpS 的识别，并产生一个不同的、通常较慢的一级降解速率。考虑一个 Escherichia coli 表达系统，其生产的一种蛋白质的前两个残基是甲硫氨酸，然后是苯丙氨酸。假设如下：\n\n- 共翻译加工在与后续降解相比可忽略不计的时间尺度内完成，因此每个新合成的分子在时间 $t=0$ 时瞬时分配到不同的加工状态。\n- 每种加工状态都以一级动力学 $dN/dt=-kN$ 独立降解，其中 $k$ 是特定于状态的常数。\n- 如果 N-末端保留为甲硫氨酸（未切割），降解速率常数为 $k_{\\mathrm{Met}}=1.2\\times 10^{-3}\\ \\mathrm{min}^{-1}$。\n- 如果甲硫氨酸被切割且苯丙氨酸暴露（未乙酰化），降解速率常数为 $k_{\\mathrm{Phe}}=1.2\\times 10^{-1}\\ \\mathrm{min}^{-1}$。\n- 如果甲硫氨酸被切割且新的 N-末端苯丙氨酸被 N-乙酰化，降解速率常数为 $k_{\\mathrm{Ac}}=2.5\\times 10^{-3}\\ \\mathrm{min}^{-1}$。\n\n比较两种条件：\n\n- 条件 A（基线）：由于倒数第二个残基体积较大，NME 发生的概率为 $p_{A}=0.01$。在被切割的分子中，由 NAT 介导的 N-末端乙酰化发生的概率为 $a_{A}=0.10$。\n- 条件 B（工程化）：一个工程化的 MetAP variant 将 NME 的概率增加到 $p_{B}=0.80$，并且一个共表达的 NAT 在被切割的分子中以 $a_{B}=0.90$ 的概率乙酰化暴露的 N-末端。\n\n根据上述假设，将新合成分子的稳定性度量 $S$ 定义为其期望平均寿命 $E[T]$。仅使用一级动力学和期望的定义，推导出每种条件下 $S$ 的表达式，并计算从条件 A 到条件 B 稳定性的倍数变化，即计算 $S_{B}/S_{A}$。将最终答案表示为无单位小数，并四舍五入到四位有效数字。", "solution": "该问题要求计算新合成的蛋白质分子的期望平均寿命。在 $t=0$ 时，分子群体被划分为三个不同的、不可相互转换的亚群，每个亚群都有自己的一级降解动力学。总期望寿命由全期望定律决定，该定律指出，一个随机变量的期望是样本空间划分上的条件期望的加权平均值。\n\n设 $T$ 是表示分子寿命的随机变量。稳定性度量为 $S = E[T]$。三种状态是：Met-retained (Met)、Phe-exposed (Phe) 和 Ac-Phe (Ac)。\n$$S = E[T] = P(\\mathrm{Met}) E[T|\\mathrm{Met}] + P(\\mathrm{Phe}) E[T|\\mathrm{Phe}] + P(\\mathrm{Ac}) E[T|\\mathrm{Ac}]$$\n条件期望 $E[T|\\mathrm{State}]$ 是处于该特定状态的分子的平均寿命。对于由一级动力学 $dN/dt = -kN$ 控制的过程，在时间 $t$ 剩余的分子数为 $N(t) = N_0 \\exp(-kt)$。任何给定分子的寿命遵循指数概率分布，其概率密度函数为 $f(t) = k \\exp(-kt)$。平均寿命 $\\tau$ 是该分布的期望：\n$$\\tau = E[T] = \\int_{0}^{\\infty} t \\cdot f(t) dt = \\int_{0}^{\\infty} tk \\exp(-kt) dt$$\n使用分部积分法，这是一个标准结果，该积分的计算结果为：\n$$\\tau = \\frac{1}{k}$$\n因此，每种状态的平均寿命是其降解速率常数的倒数：\n$\\tau_{\\mathrm{Met}} = \\frac{1}{k_{\\mathrm{Met}}}$，$\\tau_{\\mathrm{Phe}} = \\frac{1}{k_{\\mathrm{Phe}}}$，以及 $\\tau_{\\mathrm{Ac}} = \\frac{1}{k_{\\mathrm{Ac}}}$。\n\n接下来，我们根据给定的参数 $p$（NME 的概率）和 $a$（在 NME 发生的前提下，乙酰化的概率）来定义分子处于每种状态的概率。\n- N-末端甲硫氨酸被保留的概率是 NME 不发生的概率：\n$$P(\\mathrm{Met}) = 1 - p$$\n- 具有暴露的 N-末端苯丙氨酸的概率是 NME 发生且乙酰化不发生的概率：\n$$P(\\mathrm{Phe}) = p \\cdot (1 - a)$$\n- 具有 N-乙酰化的 N-末端苯丙氨酸的概率是 NME 发生且乙酰化发生的概率：\n$$P(\\mathrm{Ac}) = p \\cdot a$$\n注意，$P(\\mathrm{Met}) + P(\\mathrm{Phe}) + P(\\mathrm{Ac}) = (1 - p) + p(1 - a) + pa = 1 - p + p - pa + pa = 1$，符合要求。\n\n将这些概率和平均寿命的表达式代入 $S$ 的方程，我们得到稳定性的通用公式：\n$$S(p, a) = (1 - p)\\frac{1}{k_{\\mathrm{Met}}} + p(1 - a)\\frac{1}{k_{\\mathrm{Phe}}} + pa\\frac{1}{k_{\\mathrm{Ac}}}$$\n现在我们将此公式应用于条件 A 和条件 B。\n\n对于条件 A：$p_{A} = 0.01$ 且 $a_{A} = 0.10$。\n每种状态的概率为：\n$P_{A}(\\mathrm{Met}) = 1 - 0.01 = 0.99$\n$P_{A}(\\mathrm{Phe}) = 0.01 \\cdot (1 - 0.10) = 0.01 \\cdot 0.90 = 0.009$\n$P_{A}(\\mathrm{Ac}) = 0.01 \\cdot 0.10 = 0.001$\n稳定性 $S_A$ 为：\n$$S_{A} = \\frac{0.99}{k_{\\mathrm{Met}}} + \\frac{0.009}{k_{\\mathrm{Phe}}} + \\frac{0.001}{k_{\\mathrm{Ac}}}$$\n代入给定的速率常数：\n$$S_{A} = \\frac{0.99}{1.2 \\times 10^{-3}} + \\frac{0.009}{1.2 \\times 10^{-1}} + \\frac{0.001}{2.5 \\times 10^{-3}}$$\n$$S_{A} = 0.99 \\cdot \\left(\\frac{1000}{1.2}\\right) + 0.009 \\cdot \\left(\\frac{10}{1.2}\\right) + 0.001 \\cdot \\left(\\frac{1000}{2.5}\\right)$$\n$$S_{A} = 825 + 0.075 + 0.4 = 825.475\\ \\mathrm{min}$$\n\n对于条件 B：$p_{B} = 0.80$ 且 $a_{B} = 0.90$。\n每种状态的概率为：\n$P_{B}(\\mathrm{Met}) = 1 - 0.80 = 0.20$\n$P_{B}(\\mathrm{Phe}) = 0.80 \\cdot (1 - 0.90) = 0.80 \\cdot 0.10 = 0.08$\n$P_{B}(\\mathrm{Ac}) = 0.80 \\cdot 0.90 = 0.72$\n稳定性 $S_B$ 为：\n$$S_{B} = \\frac{0.20}{k_{\\mathrm{Met}}} + \\frac{0.08}{k_{\\mathrm{Phe}}} + \\frac{0.72}{k_{\\mathrm{Ac}}}$$\n代入给定的速率常数：\n$$S_{B} = \\frac{0.20}{1.2 \\times 10^{-3}} + \\frac{0.08}{1.2 \\times 10^{-1}} + \\frac{0.72}{2.5 \\times 10^{-3}}$$\n$$S_{B} = 0.20 \\cdot \\left(\\frac{1000}{1.2}\\right) + 0.08 \\cdot \\left(\\frac{10}{1.2}\\right) + 0.72 \\cdot \\left(\\frac{1000}{2.5}\\right)$$\n$$S_{B} = \\frac{200}{1.2} + \\frac{0.8}{1.2} + \\frac{720}{2.5} = \\frac{500}{3} + \\frac{2}{3} + 288$$\n$$S_{B} = \\frac{502}{3} + 288 = 167.333... + 288 = 455.333...\\ \\mathrm{min}$$\n\n最后，我们计算所需的倍数变化 $S_{B} / S_{A}$：\n$$\\frac{S_{B}}{S_{A}} = \\frac{455.333...}{825.475} \\approx 0.551596...$$\n按照问题陈述的要求，将此结果四舍五入到四位有效数字，得到 $0.5516$。\n尽管在被切割的产物中，稳定化修饰（乙酰化）的概率增加了，但系统的工程化改造导致了蛋白质整体稳定性的净下降。这是因为条件 B 中 NME 的高概率使分子群体从条件 A 中占主导地位的极其稳定的 Met-retained 状态转移开。", "answer": "$$\\boxed{0.5516}$$", "id": "2523688"}, {"introduction": "在拥挤的细胞环境中，介导翻译后修饰和蛋白水解的酶必须精确识别其底物。这种特异性通常编码在修饰位点或切割位点周围的氨基酸序列中。这项计算实践要求您根据动力学数据建立一个预测模型，以破译蛋白酶的序列偏好，从而向您介绍一种在现代系统生物学中至关重要的数据分析框架。[@problem_id:2523668]", "problem": "要求您编写一个完整、可运行的程序，根据多个肽底物的动力学测量结果，推断蛋白酶的序列特异性。该蛋白酶识别一个由两个非撇端亚位点（P2 和 P1）和两个撇端亚位点（P1' 和 P2'）组成的四位切割基序。每个位置可被三类氨基酸之一占据：疏水性（H）、极性不带电（P）或碱性（B）。用索引 $p \\in \\{1,2,3,4\\}$ 依次表示位置 $\\mathrm{P2}, \\mathrm{P1}, \\mathrm{P1'}, \\mathrm{P2'}$，用索引 $c \\in \\{1,2,3\\}$ 依次表示类别 $\\mathrm{H}, \\mathrm{P}, \\mathrm{B}$。\n\n基本原理。在 Michaelis–Menten 动力学的稀底物极限下，其中 $[S] \\ll K_M$，初始速度满足 $v_0 \\approx (k_{\\mathrm{cat}}/K_M)[E]_0[S]_0$。特异性常数 $k_{\\mathrm{cat}}/K_M$ 近似于过渡态复合物形成的二级速率常数，并与 $\\exp(-\\beta \\Delta G^\\ddagger_{\\mathrm{eff}})$ 成正比，其中 $\\beta = 1/(k_B T)$，$\\Delta G^\\ddagger_{\\mathrm{eff}}$ 是一个有效的自由能垒，包括结合和过渡态稳定化的贡献。一个被广泛使用且经过充分检验的物理模型假设，每个亚位点-残基相互作用对过渡态稳定化的贡献在自由能上跨亚位点近似线性相加。在这种可加性假设下，得到了一个用于测量催化效率的对数线性模型：\n$$\n\\ln\\!\\left(\\frac{k_{\\mathrm{cat}}}{K_M}\\right)_j = b_0 + \\sum_{p=1}^{4} w_{p, c_{j,p}} + \\varepsilon_j,\n$$\n其中 $j$ 是底物的索引，$b_0$ 是一个截距（吸收了诸如 $\\ln A - \\beta \\Delta G^\\ddagger_0$ 之类的常数），$w_{p,c}$ 是类别 $c$ 在位置 $p$ 对对数效率的贡献，$\\varepsilon_j$ 是由于实验不确定性和模型不匹配导致的以自然对数为单位的零均值噪声。为了使参数可识别，您必须对每个位置施加零和约束：\n$$\n\\sum_{c=1}^{3} w_{p,c} = 0 \\quad \\text{for each } p \\in \\{1,2,3,4\\}.\n$$\n\n您的任务：\n- 实现一个线性估计器，通过最小化 $\\ln(k_{\\mathrm{cat}}/K_M)$ 的平方误差来拟合参数 $\\{b_0, w_{p,c}\\}$，并对 $w_{p,c}$ 进行 Tikhonov 正则化，但不对 $b_0$ 进行正则化：\n$$\n\\min_{\\{b_0, w\\}} \\ \\sum_{j=1}^{N} \\left(y_j - b_0 - \\sum_{p=1}^{4} w_{p, c_{j,p}}\\right)^2 + \\lambda \\sum_{p=1}^{4}\\sum_{c=1}^{3} w_{p,c}^2,\n$$\n约束条件为每个位置 $p$ 满足 $\\sum_{c=1}^{3} w_{p,c} = 0$。这里 $y_j = \\ln\\!\\left((k_{\\mathrm{cat}}/K_M)_j\\right)$ 是以自然对数为单位的（无量纲）。使用精确的等式约束解法，例如通过用于带 Tikhonov 正则化的等式约束最小二乘法的 Karush–Kuhn–Tucker (KKT) 线性系统。不要通过删除列来强制实现可识别性；相反，应显式地强制执行零和约束。\n- 拟合后，将特异性的主导位置决定因素确定为位置 $p^\\star$，该位置的三个拟合类别贡献值具有最大标准差：\n$$\np^\\star = \\arg\\max_{p \\in \\{1,2,3,4\\}} \\ \\mathrm{StdDev}\\left(\\{w_{p,1}, w_{p,2}, w_{p,3}\\}\\right).\n$$\n- 通过比较非撇端亚位点与撇端亚位点上贡献的绝对值大小来量化撇端偏好：\n$$\nS_{\\mathrm{nonprime}} = \\sum_{p \\in \\{1,2\\}} \\sum_{c=1}^{3} |w_{p,c}|, \\quad S_{\\mathrm{prime}} = \\sum_{p \\in \\{3,4\\}} \\sum_{c=1}^{3} |w_{p,c}|.\n$$\n报告模型是否偏好撇端，其定义为布尔值 $\\mathsf{prime\\_preferred} = \\left(S_{\\mathrm{prime}} > S_{\\mathrm{nonprime}}\\right)$，并报告差值 $\\Delta S = S_{\\mathrm{prime}} - S_{\\mathrm{nonprime}}$。\n- 报告样本内均方根误差：\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N}\\sum_{j=1}^{N} \\left(y_j - \\hat{y}_j \\right)^2},\n$$\n其中 $\\hat{y}_j$ 是拟合的预测值。\n\n数据生成协议。对于下述每个测试案例，您必须按如下方式合成一个独立的数据集。\n- 位置 $p \\in \\{1,2,3,4\\}$ 对应于 $\\mathrm{P2}, \\mathrm{P1}, \\mathrm{P1'}, \\mathrm{P2'}$。\n- 类别 $c \\in \\{1,2,3\\}$ 对应于 $\\mathrm{H}, \\mathrm{P}, \\mathrm{B}$。\n- 对于给定案例，使用提供的伪随机种子初始化随机数生成器，在 $3^4$ 种可能的类别分配中均匀随机抽取 $N$ 个底物。对于每个底物 $j$，计算无噪声的对数效率 $y_j^{(0)} = b_0 + \\sum_{p=1}^{4} w^{\\mathrm{true}}_{p, c_{j,p}}$。采样 $\\varepsilon_j \\sim \\mathcal{N}(0,\\sigma^2)$ 并设置 $y_j = y_j^{(0)} + \\varepsilon_j$。如果您也以物理单位模拟 $(k_{\\mathrm{cat}}/K_M)_j$，请使用 $(k_{\\mathrm{cat}}/K_M)_j = \\exp(y_j)$，单位为 $\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$，但拟合必须使用以自然对数为单位的 $y_j$（无量纲）。\n- 使用指定的 $\\lambda$ 拟合模型。\n\n测试套件。精确实现以下三个案例，使用给定的自然对数贡献值 $\\{w^{\\mathrm{true}}_{p,c}\\}$、截距 $b_0$、样本大小 $N$、噪声标准差 $\\sigma$、正则化参数 $\\lambda$ 和种子。所有数值均以自然对数单位给出，必须严格按照规定使用。\n\n- 案例 A（非撇端主导）：\n  - 截距：$b_0 = 14.0$。\n  - 每个位置按 $[\\mathrm{H}, \\mathrm{P}, \\mathrm{B}]$ 顺序排列的真实贡献值：\n    - $\\mathrm{P2}$: $[0.30, -0.10, -0.20]$,\n    - $\\mathrm{P1}$: $[0.50, -0.30, -0.20]$,\n    - $\\mathrm{P1'}$: $[0.10, -0.05, -0.05]$,\n    - $\\mathrm{P2'}$: $[0.00, 0.05, -0.05]$。\n  - 样本大小：$N = 180$。\n  - 噪声：$\\sigma = 0.05$（自然对数单位）。\n  - 正则化：$\\lambda = 0.01$。\n  - 种子：$42$。\n\n- 案例 B（撇端主导）：\n  - 截距：$b_0 = 13.0$。\n  - 真实贡献值：\n    - $\\mathrm{P2}$: $[0.00, 0.00, 0.00]$,\n    - $\\mathrm{P1}$: $[0.10, -0.05, -0.05]$,\n    - $\\mathrm{P1'}$: $[0.40, -0.10, -0.30]$,\n    - $\\mathrm{P2'}$: $[0.30, -0.20, -0.10]$。\n  - 样本大小：$N = 120$。\n  - 噪声：$\\sigma = 0.08$（自然对数单位）。\n  - 正则化：$\\lambda = 0.02$。\n  - 种子：$31415$。\n\n- 案例 C（近平衡，低噪声）：\n  - 截距：$b_0 = 13.5$。\n  - 真实贡献值：\n    - $\\mathrm{P2}$: $[0.05, -0.05, 0.00]$,\n    - $\\mathrm{P1}$: $[0.05, 0.00, -0.05]$,\n    - $\\mathrm{P1'}$: $[0.05, -0.05, 0.00]$,\n    - $\\mathrm{P2'}$: $[0.05, 0.00, -0.05]$。\n  - 样本大小：$N = 90$。\n  - 噪声：$\\sigma = 0.02$（自然对数单位）。\n  - 正则化：$\\lambda = 0.05$。\n  - 种子：$27182$。\n\n程序要求。\n- 为每个位置的类别构建一个独热编码设计矩阵，并包含一个截距项。使用等式约束的 Tikhonov 估计器（例如，通过 KKT 系统）精确地强制执行四个零和约束。不要通过删除列来强制可识别性。\n- 对于每个案例，按顺序输出一个列表，包含以下项目：样本内 $\\mathrm{RMSE}$（四舍五入到 4 位小数）；主导决定因素的整数位置索引 $p^\\star \\in \\{1,2,3,4\\}$；布尔值 $\\mathsf{prime\\_preferred}$；以及差值 $\\Delta S$（四舍五入到 4 位小数）。使用基于 1 的索引，使得 $\\mathrm{P2}$ 为 $1$，$\\mathrm{P1}$ 为 $2$，$\\mathrm{P1'}$ 为 $3$，$\\mathrm{P2'}$ 为 $4$。\n- 您的程序应生成单行输出，其中包含案例 A、B 和 C 的结果，形式为一个逗号分隔的列表，包含三个按案例排列的子列表，并用方括号括起来，例如 $[[\\dots],[\\dots],[\\dots]]$。\n\n所有结果均以 $y_j$ 的自然对数单位（无量纲）计算。如果在内部显示或使用 $(k_{\\mathrm{cat}}/K_M)_j$ 的任何物理单位，它们必须是 $\\mathrm{M}^{-1}\\,\\mathrm{s}^{-1}$，但所要求的输出是无单位或布尔值，如指定。不涉及角度。百分比（若有）必须以小数形式报告。", "solution": "该问题在于找到参数向量 $\\boldsymbol{\\theta}$，使其在满足线性等式约束的条件下，最小化一个正则化的二次目标函数。这可以表述为：\n$$ \\min_{\\boldsymbol{\\theta}} (\\mathbf{y} - \\mathbf{X}\\boldsymbol{\\theta})^T (\\mathbf{y} - \\mathbf{X}\\boldsymbol{\\theta}) + \\lambda \\boldsymbol{\\theta}^T \\mathbf{R} \\boldsymbol{\\theta} \\quad \\text{subject to} \\quad \\mathbf{C}\\boldsymbol{\\theta} = \\mathbf{0} $$\n\n参数向量 $\\boldsymbol{\\theta}$ 是一个 $13 \\times 1$ 的列向量，包含截距 $b_0$ 和十二个权重 $w_{p,c}$：\n$$ \\boldsymbol{\\theta} = [b_0, w_{1,1}, w_{1,2}, w_{1,3}, w_{2,1}, \\dots, w_{4,3}]^T $$\n\n设计矩阵 $\\mathbf{X}$ 是一个 $N \\times 13$ 的矩阵。每一行 $j$ 对应一个底物，并使用独热编码构建。第一列全为 $1$，用于截距 $b_0$。对于四个位置 $p$ 中的每一个，都有三列对应于类别 $c \\in \\{1,2,3\\}$。对于给定的底物，在每个位置上存在的氨基酸类别所对应的列中放置一个 $1$。\n\n正则化项 $\\lambda \\sum_{p,c} w_{p,c}^2$ 不适用于截距 $b_0$。这通过矩阵 $\\mathbf{R}$ 来实现，它是一个 $13 \\times 13$ 的对角矩阵，其中 $R_{0,0}=0$ 且对于 $i=1, \\dots, 12$，$R_{i,i}=1$。因此，正则化项为 $\\lambda \\boldsymbol{\\theta}^T \\mathbf{R} \\boldsymbol{\\theta}$。\n\n四个线性约束 $\\sum_{c=1}^{3} w_{p,c} = 0$ 表示为 $\\mathbf{C}\\boldsymbol{\\theta} = \\mathbf{0}$，其中 $\\mathbf{C}$ 是一个 $4 \\times 13$ 的矩阵。$\\mathbf{C}$ 的每一行对应一个位置 $p$，并在对应于权重 $\\{w_{p,1}, w_{p,2}, w_{p,3}\\}$ 的列中具有值为 $1$ 的条目，其他位置为 $0$。\n\n这个约束优化问题使用拉格朗日乘子法求解。拉格朗日函数是：\n$$ \\mathcal{L}(\\boldsymbol{\\theta}, \\boldsymbol{\\mu}) = (\\mathbf{y} - \\mathbf{X}\\boldsymbol{\\theta})^T (\\mathbf{y} - \\mathbf{X}\\boldsymbol{\\theta}) + \\lambda \\boldsymbol{\\theta}^T \\mathbf{R} \\boldsymbol{\\theta} + \\boldsymbol{\\mu}^T (\\mathbf{C}\\boldsymbol{\\theta}) $$\n其中 $\\boldsymbol{\\mu}$ 是一个 $4 \\times 1$ 的拉格朗日乘子向量。通过将关于 $\\boldsymbol{\\theta}$ 和 $\\boldsymbol{\\mu}$ 的梯度设置为零，可以得到 Karush-Kuhn-Tucker (KKT) 条件：\n$$ \\nabla_{\\boldsymbol{\\theta}}\\mathcal{L} = 2\\mathbf{X}^T(\\mathbf{X}\\boldsymbol{\\theta} - \\mathbf{y}) + 2\\lambda\\mathbf{R}\\boldsymbol{\\theta} + \\mathbf{C}^T\\boldsymbol{\\mu} = \\mathbf{0} $$\n$$ \\nabla_{\\boldsymbol{\\mu}}\\mathcal{L} = \\mathbf{C}\\boldsymbol{\\theta} = \\mathbf{0} $$\n重新整理第一个方程得到 $( \\mathbf{X}^T\\mathbf{X} + \\lambda\\mathbf{R})\\boldsymbol{\\theta} + \\frac{1}{2}\\mathbf{C}^T\\boldsymbol{\\mu} = \\mathbf{X}^T\\mathbf{y}$。令 $\\boldsymbol{\\nu} = -\\frac{1}{2}\\boldsymbol{\\mu}$。KKT 条件构成一个分块矩阵形式的线性方程组：\n$$\n\\begin{pmatrix}\n\\mathbf{X}^T\\mathbf{X} + \\lambda\\mathbf{R} & \\mathbf{C}^T \\\\\n\\mathbf{C} & \\mathbf{0}_{4 \\times 4}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\boldsymbol{\\theta} \\\\\n-\\boldsymbol{\\nu}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\mathbf{X}^T\\mathbf{y} \\\\\n\\mathbf{0}_{4 \\times 1}\n\\end{pmatrix}\n$$\n求解这个 $(13+4) \\times (13+4)$ 的线性系统，得到包含 $\\boldsymbol{\\theta}$ 和拉格朗日乘子的增广向量。解向量的前 $13$ 个元素即为估计的参数 $\\hat{\\boldsymbol{\\theta}}$。\n\n每个测试案例的计算过程如下：\n1.  使用指定的随机种子，通过为每个底物均匀随机抽取四个类别索引（实现时为 $\\{0, 1, 2\\}$），生成 $N$ 个底物。\n2.  计算真实的对数效率 $y_j^{(0)}$，并加入高斯噪声 $\\varepsilon_j \\sim \\mathcal{N}(0,\\sigma^2)$ 以获得观测向量 $\\mathbf{y}$。\n3.  根据生成的底物和模型结构，构建矩阵 $\\mathbf{X}$、$\\mathbf{R}$ 和 $\\mathbf{C}$。\n4.  组装并求解 KKT 线性系统，以获得估计的参数向量 $\\hat{\\boldsymbol{\\theta}}$。\n5.  计算预测值 $\\hat{\\mathbf{y}} = \\mathbf{X} \\hat{\\boldsymbol{\\theta}}$。\n6.  根据 $\\hat{\\boldsymbol{\\theta}}$ 和 $\\hat{\\mathbf{y}}$ 计算所需的指标：$\\mathrm{RMSE}$、$p^\\star$、$\\mathsf{prime\\_preferred}$ 和 $\\Delta S$，并按要求进行四舍五入。", "answer": "```python\nimport numpy as np\n\ndef run_case(case_params: dict) -> list:\n    \"\"\"\n    Generates data, fits the model, and computes results for a single test case.\n    \"\"\"\n    # Unpack case parameters\n    b0_true = case_params[\"b0\"]\n    w_true = np.array(case_params[\"w_true\"])\n    N = case_params[\"N\"]\n    sigma = case_params[\"sigma\"]\n    lambda_reg = case_params[\"lambda\"]\n    seed = case_params[\"seed\"]\n\n    # 1. Data Generation\n    rng = np.random.default_rng(seed)\n    num_positions = 4\n    num_classes = 3\n    # Substrates: N x 4 matrix with random class indices (0, 1, or 2)\n    substrates_classes = rng.integers(0, num_classes, size=(N, num_positions))\n\n    # Calculate noise-free log-efficiencies\n    y_true = np.full(N, b0_true)\n    for j in range(N):\n        for p in range(num_positions):\n            class_idx = substrates_classes[j, p]\n            y_true[j] += w_true[p, class_idx]\n\n    # Add Gaussian noise\n    noise = rng.normal(0, sigma, N)\n    y = y_true + noise\n\n    # 2. Construct matrices for the KKT system\n    num_params = 1 + num_positions * num_classes  # 1 (b0) + 4*3 (w_pc) = 13\n    \n    # Design matrix X (N x 13)\n    X = np.zeros((N, num_params))\n    X[:, 0] = 1  # Intercept column\n    for j in range(N):\n        for p in range(num_positions):\n            class_idx = substrates_classes[j, p]\n            w_col_idx = 1 + p * num_classes + class_idx\n            X[j, w_col_idx] = 1\n\n    # Regularization matrix R (13x13)\n    R = np.diag([0] + [1] * (num_params - 1))\n    \n    # Constraint matrix C (4x13)\n    C = np.zeros((num_positions, num_params))\n    for p in range(num_positions):\n        start_col = 1 + p * num_classes\n        end_col = start_col + num_classes\n        C[p, start_col:end_col] = 1\n\n    # 3. Assemble and solve the KKT system\n    # KKT_A * sol = KKT_b\n    # [[X'X + lambda*R, C'], [C, 0]] * [theta, mu] = [X'y, 0]\n    \n    KKT_A_UL = X.T @ X + lambda_reg * R # Upper-left block\n    KKT_A_UR = C.T                      # Upper-right block\n    KKT_A_LL = C                        # Lower-left block\n    KKT_A_LR = np.zeros((num_positions, num_positions))\n    \n    KKT_A = np.block([[KKT_A_UL, KKT_A_UR], [KKT_A_LL, KKT_A_LR]])\n    \n    KKT_b = np.concatenate([X.T @ y, np.zeros(num_positions)])\n\n    solution = np.linalg.solve(KKT_A, KKT_b)\n    theta_hat = solution[:num_params]\n\n    # 4. Extract parameters and compute metrics\n    b0_hat = theta_hat[0]\n    w_hat = theta_hat[1:].reshape((num_positions, num_classes))\n\n    # RMSE\n    y_hat = X @ theta_hat\n    rmse = np.sqrt(np.mean((y - y_hat)**2))\n\n    # Dominant position p*\n    # Population standard deviation for the 3 class weights at each position\n    std_devs = np.std(w_hat, axis=1, ddof=0)\n    p_star = np.argmax(std_devs) + 1  # Use 1-based indexing for output\n\n    # Prime-side preference\n    # positions 0,1 -> P2, P1 (non-prime); positions 2,3 -> P1', P2' (prime)\n    s_nonprime = np.sum(np.abs(w_hat[0:2, :]))\n    s_prime = np.sum(np.abs(w_hat[2:4, :]))\n    prime_preferred = s_prime > s_nonprime\n    delta_s = s_prime - s_nonprime\n\n    return [rmse, p_star, prime_preferred, delta_s]\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        { # Case A\n            \"b0\": 14.0,\n            \"w_true\": [[0.30, -0.10, -0.20], [0.50, -0.30, -0.20],\n                       [0.10, -0.05, -0.05], [0.00, 0.05, -0.05]],\n            \"N\": 180, \"sigma\": 0.05, \"lambda\": 0.01, \"seed\": 42\n        },\n        { # Case B\n            \"b0\": 13.0,\n            \"w_true\": [[0.00, 0.00, 0.00], [0.10, -0.05, -0.05],\n                       [0.40, -0.10, -0.30], [0.30, -0.20, -0.10]],\n            \"N\": 120, \"sigma\": 0.08, \"lambda\": 0.02, \"seed\": 31415\n        },\n        { # Case C\n            \"b0\": 13.5,\n            \"w_true\": [[0.05, -0.05, 0.00], [0.05, 0.00, -0.05],\n                       [0.05, -0.05, 0.00], [0.05, 0.00, -0.05]],\n            \"N\": 90, \"sigma\": 0.02, \"lambda\": 0.05, \"seed\": 27182\n        }\n    ]\n\n    all_results = []\n    for case_params in test_cases:\n        results = run_case(case_params)\n        all_results.append(results)\n\n    # Format the final output string as specified: [[...],[...],[...]]\n    result_strings = []\n    for r in all_results:\n        # r[0]: rmse, r[1]: p_star, r[2]: prime_preferred, r[3]: delta_s\n        s = f\"[{r[0]:.4f},{r[1]},{str(r[2]).lower()},{r[3]:.4f}]\" # Boolean to lowercase string\n        result_strings.append(s)\n    \n    final_output = f\"[{','.join(result_strings)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "2523668"}]}