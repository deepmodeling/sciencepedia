{"hands_on_practices": [{"introduction": "mRNA疫苗的功效取决于mRNA分子本身的完整性。其化学稳定性，特别是对温度的敏感性，是生产、储存和分发过程中的一个关键瓶颈。本练习将运用化学动力学原理来模拟mRNA的降解过程，帮助您量化储存温度对疫苗保质期的影响 [@problem_id:2469058]。", "problem": "一种先进的信使核糖核酸（mRNA）疫苗储存在水性缓冲液中，在相关时间窗口内，其骨架水解是主要的降解模式。假设水解遵循一级动力学，且一级速率常数的温度依赖性由一个经过充分检验的指数定律决定，该定律由活化能和普适气体常数表征。在 $T_1=277\\,\\mathrm{K}$ 的冷藏条件下，实验测得的半衰期为 $t_{1/2}=10\\,\\mathrm{天}$。水解的活化能为 $E_a=85{,}000\\,\\mathrm{J\\,mol^{-1}}$，普适气体常数为 $R=8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。考虑一个较暖的储存条件 $T_2=293\\,\\mathrm{K}$。设在温度 $T$ 下，经过时间 $t$ 后的已降解分数为：到时间 $t$ 时已反应（水解）的完整 mRNA 分子占总数的比例，此过程中 pH 和离子强度保持不变，并忽略配方的任何变化。\n\n仅使用一级衰变的第一性原理以及由 $E_a$ 和 $R$ 表征的速率常数的指数温度依赖性，从这些基础出发，推导在 $T_2$ 和 $T_1$ 温度下，经过 $t=5\\,\\mathrm{天}$ 后的已降解分数之比的表达式，然后对此比率进行数值计算。将最终数值结果四舍五入至三位有效数字。答案是无量纲的，报告时无需单位。", "solution": "在尝试做出任何解答之前，首先将对所述问题进行严格的验证过程。\n\n逐字提取的已知条件如下：\n- 降解机制为骨架水解，遵循一级动力学。\n- 速率常数的温度依赖性遵循指数定律。\n- 在温度 $T_1 = 277\\,\\mathrm{K}$ 时，半衰期为 $t_{1/2} = 10\\,\\mathrm{天}$。\n- 活化能为 $E_a = 85{,}000\\,\\mathrm{J\\,mol^{-1}}$。\n- 普适气体常数为 $R = 8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$。\n- 给定第二个温度：$T_2 = 293\\,\\mathrm{K}$。\n- 关注的时间点为 $t = 5\\,\\mathrm{天}$。\n- 已降解分数定义为已反应的完整 mRNA 分子的比例。\n- 分析要求推导在 $T_2$ 和 $T_1$ 温度下，经过 $t=5\\,\\mathrm{天}$ 后的已降解分数之比的表达式，然后对其进行求值。\n\n问题陈述的验证：\n- **科学依据**：该问题基于化学动力学的基本原理。对于像 mRNA 这样的大分子在水性缓冲液中的水解，假设其为一级动力学是一个标准且有效的动力学模型。使用阿伦尼乌斯方程来描述速率常数的温度依赖性是物理化学的基石。所提供的活化能、温度和物理常数值是现实的且量纲一致。该问题与生物制药产品（特别是 mRNA 疫苗）的稳定性直接相关。该问题在科学上是合理的。\n- **适定性**：该问题是适定的。它提供了所有必要的数据和一个明确的目标：计算一个特定的、无量纲的比率。定义是无歧义的。存在唯一且稳定的解，并且可以从所提供的信息中推导出来。\n- **客观性**：该问题以精确、客观的语言陈述，不含任何主观或非科学的论断。\n\n经检验，该问题是有效、自洽且科学合理的。它不符合任何无效标准。因此，我将从第一性原理出发，进行完整的求解。\n\n设 $C(t)$ 表示在时间 $t$ 时完整 mRNA 分子的浓度。水解过程由一级速率定律描述：\n$$\n\\frac{dC}{dt} = -k C\n$$\n其中 $k$ 是一级速率常数，依赖于温度 $T$。从此微分方程对时间从 $t=0$ 时的初始浓度 $C_0$ 积分，得到时间 $t$ 时的浓度：\n$$\nC(t) = C_0 \\exp(-kt)\n$$\n在时间 $t$ 时已降解的 mRNA 分数，记作 $f_d(t)$，是初始量减去完整量，再全部除以初始量：\n$$\nf_d(t) = \\frac{C_0 - C(t)}{C_0} = 1 - \\frac{C(t)}{C_0} = 1 - \\exp(-kt)\n$$\n半衰期 $t_{1/2}$ 是浓度降至 $C(t_{1/2}) = C_0 / 2$ 所需的时间。将此代入积分速率定律：\n$$\n\\frac{C_0}{2} = C_0 \\exp(-k t_{1/2}) \\implies \\frac{1}{2} = \\exp(-k t_{1/2})\n$$\n解出速率常数 $k$ 得到：\n$$\nk = \\frac{\\ln(2)}{t_{1/2}}\n$$\n在温度 $T_1 = 277\\,\\mathrm{K}$ 时，给定的半衰期为 $t_{1/2,1} = 10\\,\\mathrm{天}$。因此，此温度下的速率常数 $k_1$ 为：\n$$\nk_1 = \\frac{\\ln(2)}{10\\,\\mathrm{days}}\n$$\n速率常数的温度依赖性由阿伦尼乌斯方程描述：\n$$\nk(T) = A \\exp\\left(-\\frac{E_a}{RT}\\right)\n$$\n其中 $A$ 是指前因子，$E_a$ 是活化能，$R$ 是普适气体常数。为了关联两个不同温度 $T_1$ 和 $T_2$ 下的速率常数，我们构建一个比率，以消除未知的指前因子 $A$：\n$$\n\\frac{k(T_2)}{k(T_1)} = \\frac{A \\exp\\left(-\\frac{E_a}{RT_2}\\right)}{A \\exp\\left(-\\frac{E_a}{RT_1}\\right)} = \\exp\\left(-\\frac{E_a}{RT_2} + \\frac{E_a}{RT_1}\\right)\n$$\n令 $k_1 = k(T_1)$ 和 $k_2 = k(T_2)$，上式简化为：\n$$\n\\frac{k_2}{k_1} = \\exp\\left[\\frac{E_a}{R}\\left(\\frac{1}{T_1} - \\frac{1}{T_2}\\right)\\right]\n$$\n我们要求解的是在时间 $t=5\\,\\mathrm{天}$ 时，两个温度 $T_2 = 293\\,\\mathrm{K}$ 和 $T_1 = 277\\,\\mathrm{K}$ 下已降解分数之比 $\\mathcal{R}$：\n$$\n\\mathcal{R} = \\frac{f_{d,2}(t=5)}{f_{d,1}(t=5)} = \\frac{1 - \\exp(-k_2 t)}{1 - \\exp(-k_1 t)} \\quad \\text{for } t=5\\,\\mathrm{days}\n$$\n首先，我们计算分母。指数的参数是 $-k_1 t$：\n$$\n-k_1 t = -\\left(\\frac{\\ln(2)}{10\\,\\mathrm{days}}\\right) \\times (5\\,\\mathrm{days}) = -\\frac{\\ln(2)}{2} = \\ln(2^{-1/2}) = \\ln\\left(\\frac{1}{\\sqrt{2}}\\right)\n$$\n所以，分母是：\n$$\n1 - \\exp(-k_1 t) = 1 - \\exp\\left(\\ln\\left(\\frac{1}{\\sqrt{2}}\\right)\\right) = 1 - \\frac{1}{\\sqrt{2}}\n$$\n接下来，我们计算分子。指数的参数是 $-k_2 t$。我们可以用 $-k_1 t$ 来表示它：\n$$\n-k_2 t = -(k_1 t) \\frac{k_2}{k_1} = -\\frac{\\ln(2)}{2} \\exp\\left[\\frac{E_a}{R}\\left(\\frac{1}{T_1} - \\frac{1}{T_2}\\right)\\right]\n$$\n因此，分子是：\n$$\n1 - \\exp(-k_2 t) = 1 - \\exp\\left(-\\frac{\\ln(2)}{2} \\exp\\left[\\frac{E_a}{R}\\left(\\frac{1}{T_1} - \\frac{1}{T_2}\\right)\\right]\\right)\n$$\n综合这些，比率 $\\mathcal{R}$ 的解析表达式是：\n$$\n\\mathcal{R} = \\frac{1 - \\exp\\left(-\\frac{\\ln(2)}{2} \\exp\\left[\\frac{E_a}{R}\\left(\\frac{1}{T_1} - \\frac{1}{T_2}\\right)\\right]\\right)}{1 - \\frac{1}{\\sqrt{2}}}\n$$\n现在，我们代入给定的数值：$E_a = 85000\\,\\mathrm{J\\,mol^{-1}}$，$R = 8.314\\,\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，$T_1 = 277\\,\\mathrm{K}$ 和 $T_2 = 293\\,\\mathrm{K}$。\n首先，计算阿伦尼乌斯关系中的指数项：\n$$\n\\frac{E_a}{R}\\left(\\frac{1}{T_1} - \\frac{1}{T_2}\\right) = \\frac{85000}{8.314} \\left(\\frac{1}{277} - \\frac{1}{293}\\right) = \\frac{85000}{8.314} \\left(\\frac{293 - 277}{277 \\times 293}\\right)\n$$\n$$\n\\approx (10223.72\\,\\mathrm{K}) \\left(\\frac{16}{81161}\\,\\mathrm{K}^{-1}\\right) \\approx (10223.72) \\times (1.97139 \\times 10^{-4}) \\approx 2.01553\n$$\n速率常数之比为 $\\frac{k_2}{k_1} = \\exp(2.01553) \\approx 7.5048$。\n现在，我们计算已降解分数表达式中指数的参数。对于分母：\n$$\n-k_1 t = -\\frac{\\ln(2)}{2} \\approx -0.34657\n$$\n分母为 $1 - \\exp(-0.34657) \\approx 1 - 0.70711 = 0.29289$。这证实了其精确形式为 $1 - 1/\\sqrt{2}$。\n对于分子，其参数是：\n$$\n-k_2 t = -k_1 t \\times \\frac{k_2}{k_1} \\approx -0.34657 \\times 7.5048 \\approx -2.6009\n$$\n分子为 $1 - \\exp(-2.6009) \\approx 1 - 0.07421 = 0.92579$。\n最后，比率 $\\mathcal{R}$ 是：\n$$\n\\mathcal{R} \\approx \\frac{0.92579}{0.29289} \\approx 3.16075\n$$\n按要求将结果四舍五入至三位有效数字，我们得到 $3.16$。", "answer": "$$\n\\boxed{3.16}\n$$", "id": "2469058"}, {"introduction": "mRNA分子进入细胞后，便成为抗原生产的模板。理解这一过程的动态变化——即抗原产生的速度和持续时间——对于预测由此产生的免疫反应至关重要。在这个问题中，您将构建一个数学模型来描述抗原表达的时间进程，这是药物动力学和系统生物学中的一项核心技能 [@problem_id:2469082]。", "problem": "一种由脂质纳米颗粒递送的信使核糖核酸（mRNA）疫苗，其编码的亚基抗原在细胞质中被翻译，然后被降解。假设细胞内mRNA的量为 $M(t)$，细胞内抗原（蛋白质）的量为 $P(t)$。从分子生物学的中心法则（以mRNA为模板翻译成蛋白质）以及mRNA和蛋白质降解的一级动力学出发，构建一个最小的双室表达模型。在该模型中，mRNA以一级速率常数 $k_m$ 降解，蛋白质以与 $M(t)$ 成正比的速率常数 $k_t$ 从mRNA翻译而来，蛋白质以一级速率常数 $k_p$ 降解。使用此模型，在初始条件为 $M(0)=M_0$ 和 $P(0)=0$ 且假设 $k_m \\neq k_p$ 的情况下，推导 $P(t)$ 的解析表达式。然后，使用推导出的 $P(t)$，确定达到峰值抗原量的时间（即 $P(t)$ 达到其最大值的时间 $t_{\\mathrm{peak}}$）。\n\n对于一个真实的mRNA疫苗场景，使用 $M_0=2.0\\times 10^5$ 个分子/细胞, $k_m=0.35\\ \\mathrm{h}^{-1}$, $k_p=0.05\\ \\mathrm{h}^{-1}$, 以及 $k_t=120\\ \\mathrm{h}^{-1}$。将您的最终答案表示为 $t_{\\mathrm{peak}}$ 的数值（单位为小时），并四舍五入到四位有效数字。", "solution": "问题陈述需经过验证。\n\n**第一步：提取已知条件**\n- 细胞内mRNA量：$M(t)$\n- 细胞内抗原（蛋白质）量：$P(t)$\n- mRNA一级降解速率常数：$k_m$\n- 与 $M(t)$ 成正比的蛋白质翻译速率常数：$k_t$\n- 蛋白质一级降解速率常数：$k_p$\n- 初始条件：$M(0) = M_0$ 和 $P(0) = 0$\n- 约束条件：$k_m \\neq k_p$\n- 用于数值计算的具体参数：$M_0 = 2.0 \\times 10^{5}$ 个分子/细胞, $k_m = 0.35 \\ \\mathrm{h}^{-1}$, $k_p = 0.05 \\ \\mathrm{h}^{-1}$, 以及 $k_t = 120 \\ \\mathrm{h}^{-1}$。\n- 目标：\n  1. 推导 $P(t)$ 的解析表达式。\n  2. 确定达到峰值抗原量的时间 $t_{\\mathrm{peak}}$。\n  3. 提供 $t_{\\mathrm{peak}}$ 的数值，并四舍五入到四位有效数字。\n\n**第二步：使用提取的已知条件进行验证**\n对问题的有效性进行评估。\n- **科学依据**：该问题描述了一个简化的基因表达动力学模型，这是分子生物学和药理学中的一个基本概念。使用一级动力学是模拟mRNA和蛋白质周转的标准且合适的近似方法。该模型是一个经典的双室系统，科学上合理且符合实际。\n- **适定性**：该问题被表述为一个带有指定初始条件的线性一阶常微分方程组。所有必要的参数都已提供，且约束条件 $k_m \\neq k_p$ 确保了一个非退化的唯一解。目标明确且在数学上是可解的。\n- **客观性**：该问题以精确、定量和客观的语言陈述，没有歧义或主观论断。\n\n**第三步：结论与行动**\n该问题是**有效的**。它具有科学依据，是适定的，并且是客观的。没有缺陷。我们继续进行求解。\n\nmRNA和蛋白质浓度的动力学由一个包含两个耦合常微分方程的方程组描述。\n\n首先，我们建立关于mRNA量 $M(t)$ 的方程。问题指出mRNA以一级速率常数 $k_m$ 降解。这给出了微分方程：\n$$\n\\frac{dM(t)}{dt} = -k_m M(t)\n$$\n这是一个标准的指数衰减过程。在初始条件 $M(0) = M_0$ 下，通过分离变量法或直接观察法可以得到解：\n$$\nM(t) = M_0 \\exp(-k_m t)\n$$\n接下来，我们建立关于蛋白质数量 $P(t)$ 的方程。蛋白质以与 $M(t)$ 成正比的速率从mRNA翻译而来，速率常数为 $k_t$，并以一级速率常数 $k_p$ 降解。因此，$P(t)$ 的变化率是生产速率减去降解速率：\n$$\n\\frac{dP(t)}{dt} = k_t M(t) - k_p P(t)\n$$\n将 $M(t)$ 的表达式代入此方程：\n$$\n\\frac{dP(t)}{dt} = k_t M_0 \\exp(-k_m t) - k_p P(t)\n$$\n这是一个线性一阶常微分方程。我们可以将其写成标准形式 $\\frac{dy}{dx} + P(x)y = Q(x)$：\n$$\n\\frac{dP(t)}{dt} + k_p P(t) = k_t M_0 \\exp(-k_m t)\n$$\n为了求解这个方程，我们使用积分因子法。积分因子 $I(t)$ 由下式给出：\n$$\nI(t) = \\exp\\left(\\int k_p dt\\right) = \\exp(k_p t)\n$$\n将微分方程两边乘以 $I(t)$，得到：\n$$\n\\exp(k_p t) \\frac{dP(t)}{dt} + k_p \\exp(k_p t) P(t) = k_t M_0 \\exp(-k_m t) \\exp(k_p t)\n$$\n方程的左边是乘积 $P(t) I(t)$ 的导数：\n$$\n\\frac{d}{dt} \\left[ P(t) \\exp(k_p t) \\right] = k_t M_0 \\exp((k_p - k_m)t)\n$$\n我们对两边关于时间 $t$ 积分：\n$$\nP(t) \\exp(k_p t) = \\int k_t M_0 \\exp((k_p - k_m)t) dt\n$$\n由于 $k_m \\neq k_p$，项 $k_p - k_m$ 非零。积分为：\n$$\nP(t) \\exp(k_p t) = \\frac{k_t M_0}{k_p - k_m} \\exp((k_p - k_m)t) + C\n$$\n其中 $C$ 是积分常数。为了求出 $P(t)$，我们将等式两边除以 $\\exp(k_p t)$：\n$$\nP(t) = \\frac{k_t M_0}{k_p - k_m} \\exp(-k_m t) + C \\exp(-k_p t)\n$$\n我们应用初始条件 $P(0) = 0$ 来确定 $C$：\n$$\nP(0) = 0 = \\frac{k_t M_0}{k_p - k_m} \\exp(0) + C \\exp(0)\n$$\n$$\n0 = \\frac{k_t M_0}{k_p - k_m} + C\n$$\n$$\nC = -\\frac{k_t M_0}{k_p - k_m}\n$$\n将 $C$ 代回 $P(t)$ 的表达式中，我们得到解析解：\n$$\nP(t) = \\frac{k_t M_0}{k_p - k_m} \\exp(-k_m t) - \\frac{k_t M_0}{k_p - k_m} \\exp(-k_p t)\n$$\n$$\nP(t) = \\frac{k_t M_0}{k_p - k_m} \\left( \\exp(-k_m t) - \\exp(-k_p t) \\right)\n$$\n这就是所要求的蛋白质数量随时间变化的解析表达式。\n\n为了找到抗原量达到最大值的时间 $t_{\\mathrm{peak}}$，我们必须找到 $P(t)$ 的变化率为零的时间。即，我们令 $\\frac{dP(t)}{dt} = 0$。\n根据 $P(t)$ 的微分方程，我们有：\n$$\n\\frac{dP(t)}{dt} = k_t M(t) - k_p P(t) = k_t M_0 \\exp(-k_m t) - k_p P(t)\n$$\n在 $t = t_{\\mathrm{peak}}$ 时令 $\\frac{dP(t)}{dt}=0$：\n$$\nk_t M_0 \\exp(-k_m t_{\\mathrm{peak}}) = k_p P(t_{\\mathrm{peak}})\n$$\n代入 $P(t_{\\mathrm{peak}})$ 的表达式：\n$$\nk_t M_0 \\exp(-k_m t_{\\mathrm{peak}}) = k_p \\left[ \\frac{k_t M_0}{k_p - k_m} \\left( \\exp(-k_m t_{\\mathrm{peak}}) - \\exp(-k_p t_{\\mathrm{peak}}) \\right) \\right]\n$$\n我们可以消去项 $k_t M_0$ (因为 $k_t>0, M_0>0$)：\n$$\n\\exp(-k_m t_{\\mathrm{peak}}) = \\frac{k_p}{k_p - k_m} \\left( \\exp(-k_m t_{\\mathrm{peak}}) - \\exp(-k_p t_{\\mathrm{peak}}) \\right)\n$$\n$$\n(k_p - k_m) \\exp(-k_m t_{\\mathrm{peak}}) = k_p \\exp(-k_m t_{\\mathrm{peak}}) - k_p \\exp(-k_p t_{\\mathrm{peak}})\n$$\n$$\nk_p \\exp(-k_m t_{\\mathrm{peak}}) - k_m \\exp(-k_m t_{\\mathrm{peak}}) = k_p \\exp(-k_m t_{\\mathrm{peak}}) - k_p \\exp(-k_p t_{\\mathrm{peak}})\n$$\n$$\n-k_m \\exp(-k_m t_{\\mathrm{peak}}) = -k_p \\exp(-k_p t_{\\mathrm{peak}})\n$$\n$$\nk_m \\exp(-k_m t_{\\mathrm{peak}}) = k_p \\exp(-k_p t_{\\mathrm{peak}})\n$$\n现在，我们求解 $t_{\\mathrm{peak}}$：\n$$\n\\frac{k_m}{k_p} = \\frac{\\exp(-k_p t_{\\mathrm{peak}})}{\\exp(-k_m t_{\\mathrm{peak}})} = \\exp((-k_p - (-k_m)) t_{\\mathrm{peak}}) = \\exp((k_m - k_p) t_{\\mathrm{peak}})\n$$\n对两边取自然对数：\n$$\n\\ln\\left(\\frac{k_m}{k_p}\\right) = (k_m - k_p) t_{\\mathrm{peak}}\n$$\n最后，我们分离出 $t_{\\mathrm{peak}}$：\n$$\nt_{\\mathrm{peak}} = \\frac{\\ln\\left(\\frac{k_m}{k_p}\\right)}{k_m - k_p}\n$$\n这就是达到峰值时间的符号表达式。\n\n现在，我们代入给定的数值：$k_m = 0.35 \\ \\mathrm{h}^{-1}$ 和 $k_p = 0.05 \\ \\mathrm{h}^{-1}$。\n$$\nt_{\\mathrm{peak}} = \\frac{\\ln\\left(\\frac{0.35}{0.05}\\right)}{0.35 - 0.05} \\ \\mathrm{h}\n$$\n$$\nt_{\\mathrm{peak}} = \\frac{\\ln(7)}{0.30} \\ \\mathrm{h}\n$$\n使用计算器计算 $\\ln(7)$ 的值：\n$$\n\\ln(7) \\approx 1.9459101\n$$\n$$\nt_{\\mathrm{peak}} \\approx \\frac{1.9459101}{0.30} \\ \\mathrm{h} \\approx 6.486367 \\ \\mathrm{h}\n$$\n根据问题陈述的要求，将结果四舍五入到四位有效数字：\n$$\nt_{\\mathrm{peak}} \\approx 6.486 \\ \\mathrm{h}\n$$\n参数 $M_0$ 和 $k_t$ 影响峰值蛋白质数量 $P(t_{\\mathrm{peak}})$ 的大小，但它们不影响达到此峰值的时间 $t_{\\mathrm{peak}}$。", "answer": "$$\n\\boxed{6.486}\n$$", "id": "2469082"}, {"introduction": "一款有效的疫苗必须能在遗传多样性的人群中提供保护。其中一个主要挑战是人类白细胞抗原（Human Leukocyte Antigen, HLA）系统的高度多态性，该系统负责向T细胞呈递疫苗抗原。这项高级练习介绍了一种计算方法，通过结合抗原表位与HLA等位基因的结合数据及人群频率，来估算疫苗在人群中的有效覆盖率，从而将分子设计与公共卫生影响联系起来 [@problem_id:2469070]。", "problem": "您正在设计一种算法，用于在涉及亚单位或信使核糖核酸 (mRNA) 抗原设计的高级背景下，估算基于表位的疫苗的预测人群覆盖率。目标是量化从目标人群中随机抽取的个体中，至少一个指定肽集合中的肽被至少一个人体白细胞抗原 (HLA) 基因座呈递的概率。您的计算必须整合跨基因座的肽-HLA结合预测和等位基因频率数据。\n\n仅使用以下基础原则：\n- 概率论的基本公理，包括全概率定律、独立性和互补法则。\n- 使用 Hardy–Weinberg 平衡 (HWE) 从等位基因频率计算基因座上的基因型概率。\n- 不同 HLA 基因座之间独立的标准假设。\n- 一个独立性模型，其中在一个基因座内，二倍体基因型中的两个等位基因根据其各自的单等位基因呈递概率，独立地提供呈递机会。\n- 在计算给定等位基因不呈递任何肽的概率时，肽之间的独立性。\n\n使用的定义：\n- 设基因座集合为 $\\mathcal{L}$。\n- 对于每个基因座 $\\ell \\in \\mathcal{L}$，设等位基因集合为 $\\mathcal{A}_{\\ell}$，其单等位基因频率为 $\\{f_{a}\\}_{a \\in \\mathcal{A}_{\\ell}}$，满足 $\\sum_{a \\in \\mathcal{A}_{\\ell}} f_{a} = 1$ 和 $f_{a} \\ge 0$。\n- 假设每个基因座都符合 HWE，因此纯合子 $(a/a)$ 的基因型概率为 $f_{a}^{2}$，杂合子 $(a_{i}/a_{j})$（其中 $i \\ne j$）的基因型概率为 $2 f_{a_{i}} f_{a_{j}}$。\n- 设肽集合为 $S$，令 $b_{p,a} \\in [0,1]$ 为肽 $p \\in S$ 被等位基因 $a$ 呈递的单等位基因概率。\n- 对于每个等位基因 $a$，集合 $S$ 中没有任何肽被呈递的概率是 $q_{a}(S) = \\prod_{p \\in S} (1 - b_{p,a})$。\n- 对于基因座 $\\ell$ 上的一个二倍体基因型 $(a_{i}, a_{j})$，在该基因座上至少有一个 $S$ 中的肽被呈递的概率是 $1 - q_{a_{i}}(S)\\,q_{a_{j}}(S)$。\n- 通过对该基因座上的 HWE 基因型分布进行基因型水平概率的平均，可以获得群体平均的基因座水平呈递概率。\n- 假设基因座之间是独立的，则集合 $S$ 在所有基因座上的总人群覆盖率是至少有一个基因座呈递 $S$ 中至少一个肽的概率。\n\n您的任务是实现一个程序，为以下每个测试用例计算总覆盖率。您必须将任何缺失的 $b_{p,a}$ 值视为 $0$。共有 $4$ 个测试用例。对于每个测试用例，计算总人群覆盖率，结果为浮点数，精确到 $6$ 位小数。\n\n测试套件：\n\n- 测试用例 1（多基因座，多肽，一般情况）：\n  - 基因座和等位基因频率：\n    - 基因座 $\\mathrm{A}$：等位基因 $\\mathrm{A{*}01{:}01}$ 频率 $f = 0.3$，$\\mathrm{A{*}02{:}01}$ 频率 $f = 0.5$，$\\mathrm{A{*}03{:}01}$ 频率 $f = 0.2$。\n    - 基因座 $\\mathrm{B}$：等位基因 $\\mathrm{B{*}07{:}02}$ 频率 $f = 0.6$，$\\mathrm{B{*}08{:}01}$ 频率 $f = 0.4$。\n  - 肽集合 $S = \\{p_{1}, p_{2}\\}$，其单等位基因结合概率为 $b_{p,a}$：\n    - 对于基因座 $\\mathrm{A}$：\n      - $b_{p_{1},\\mathrm{A{*}01{:}01}} = 0.7$, $b_{p_{2},\\mathrm{A{*}01{:}01}} = 0.2$。\n      - $b_{p_{1},\\mathrm{A{*}02{:}01}} = 0.1$, $b_{p_{2},\\mathrm{A{*}02{:}01}} = 0.6$。\n      - $b_{p_{1},\\mathrm{A{*}03{:}01}} = 0.0$, $b_{p_{2},\\mathrm{A{*}03{:}01}} = 0.1$。\n    - 对于基因座 $\\mathrm{B}$：\n      - $b_{p_{1},\\mathrm{B{*}07{:}02}} = 0.3$, $b_{p_{2},\\mathrm{B{*}07{:}02}} = 0.4$。\n      - $b_{p_{1},\\mathrm{B{*}08{:}01}} = 0.8$, $b_{p_{2},\\mathrm{B{*}08{:}01}} = 0.2$。\n\n- 测试用例 2（单基因座，包含一个零频率等位基因的单态边界情况）：\n  - 基因座和等位基因频率：\n    - 基因座 $\\mathrm{A}$：等位基因 $\\mathrm{A{*}01{:}01}$ 频率 $f = 1.0$，$\\mathrm{A{*}02{:}01}$ 频率 $f = 0.0$。\n  - 肽集合 $S = \\{p_{3}\\}$：\n    - $b_{p_{3},\\mathrm{A{*}01{:}01}} = 0.5$。\n    - $b_{p_{3},\\mathrm{A{*}02{:}01}} = 0.0$。\n\n- 测试用例 3（两个基因座，一个单态基因座主导覆盖率）：\n  - 基因座和等位基因频率：\n    - 基因座 $\\mathrm{A}$：等位基因 $\\mathrm{A1}$ 频率 $f = 0.5$，$\\mathrm{A2}$ 频率 $f = 0.5$。\n    - 基因座 $\\mathrm{B}$：等位基因 $\\mathrm{B1}$ 频率 $f = 1.0$。\n  - 肽集合 $S = \\{p_{4}, p_{5}\\}$：\n    - $b_{p_{4},\\mathrm{A1}} = 0.0$, $b_{p_{5},\\mathrm{A1}} = 0.0$。\n    - $b_{p_{4},\\mathrm{A2}} = 0.0$, $b_{p_{5},\\mathrm{A2}} = 0.0$。\n    - $b_{p_{4},\\mathrm{B1}} = 0.9$, $b_{p_{5},\\mathrm{B1}} = 0.0$。\n\n- 测试用例 4（一个罕见的高结合性等位基因和另一个基因座上的中等结合体）：\n  - 基因座和等位基因频率：\n    - 基因座 $\\mathrm{A}$：等位基因 $\\mathrm{A1}$ 频率 $f = 0.01$，$\\mathrm{A2}$ 频率 $f = 0.99$。\n    - 基因座 $\\mathrm{B}$：等位基因 $\\mathrm{B1}$ 频率 $f = 0.5$，$\\mathrm{B2}$ 频率 $f = 0.5$。\n  - 肽集合 $S = \\{p_{6}\\}$：\n    - $b_{p_{6},\\mathrm{A1}} = 1.0$, $b_{p_{6},\\mathrm{A2}} = 0.0$, $b_{p_{6},\\mathrm{B1}} = 0.2$, $b_{p_{6},\\mathrm{B2}} = 0.0$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，按测试用例 $1$ 到 $4$ 的顺序排列，例如 $\\big[$$r_{1}$,$r_{2}$,$r_{3}$,$r_{4}$$\\big]$。\n- 每个 $r_{i}$ 必须精确到 $6$ 位小数。", "solution": "该问题经评估有效。它在科学上是合理的，问题定义清晰，并基于群体遗传学和免疫学的既定原则。所有必要的数据和定义都已提供，可得出唯一解。\n\n目标是计算总人群覆盖率 $C_{total}$，其定义为从群体中随机选择的个体，在至少一个来自集合 $\\mathcal{L}$ 的人体白细胞抗原 (HLA) 基因座上，呈递至少一个来自给定集合 $S$ 的肽的概率。\n\n解决方案从第一性原理推导如下。总覆盖率 $C_{total}$ 是个体在 $\\mathcal{L}$ 中任何基因座上都未能呈递 $S$ 中任何肽这一事件的补集。设 $E$ 为在任何基因座上发生呈递的事件，$E^c$ 为在所有基因座上都未发生呈递的事件。那么，$C_{total} = P(E) = 1 - P(E^c)$。\n\n问题指明，不同 HLA 基因座上的呈递事件在统计上是独立的。因此，在所有基因座上都未发生呈递的概率是每个单独基因座上未发生呈递概率的乘积。设 $Q_{\\ell}$ 为在基因座 $\\ell \\in \\mathcal{L}$ 上未能呈递 $S$ 中任何肽的概率。总的未呈递概率为：\n$$\nP(E^c) = \\prod_{\\ell \\in \\mathcal{L}} Q_{\\ell}\n$$\n因此，总覆盖率为：\n$$\nC_{total} = 1 - \\prod_{\\ell \\in \\mathcal{L}} Q_{\\ell}\n$$\n问题的核心是确定群体平均的基因座水平未呈递概率 $Q_{\\ell}$。这通过考虑基因座 $\\ell$ 上所有可能的二倍体基因型及其频率来计算，这些频率由 Hardy-Weinberg Equilibrium (HWE) 原理确定。\n\n设 $\\mathcal{A}_{\\ell}$ 为基因座 $\\ell$ 上的等位基因集合，其相应频率为 $\\{f_{a}\\}_{a \\in \\mathcal{A}_{\\ell}}$。根据 HWE，纯合子基因型 $(a/a)$ 的频率为 $f_{a}^{2}$，而杂合子基因型 $(a_i/a_j)$（其中 $a_i \\neq a_j$）的频率为 $2 f_{a_i} f_{a_j}$。\n\n首先，我们定义单个等位基因 $a$ 未能呈递集合 $S$ 中任何肽的概率。问题指出，一个肽 $p$ 被一个等位基因 $a$ 呈递的单等位基因概率是 $b_{p,a}$。假设肽之间是独立的，等位基因 $a$ 未能呈递肽 $p$ 的概率是 $(1 - b_{p,a})$。等位基因 $a$ 未能呈递*任何*肽从 $S$ 的概率由 $q_a(S)$ 给出：\n$$\nq_{a}(S) = \\prod_{p \\in S} (1 - b_{p,a})\n$$\n接下来，考虑一个个体，其在基因座 $\\ell$ 上的二倍体基因型为 $(a_i, a_j)$。问题假设两个等位基因独立地贡献于呈递。因此，这个完整基因型未能呈递 $S$ 中任何肽的概率是其每个组成等位基因未呈递概率的乘积：\n$$\nP(\\text{failure} \\mid \\text{genotype } (a_i, a_j)) = q_{a_i}(S) \\, q_{a_j}(S)\n$$\n为了找到群体平均的未呈递概率 $Q_{\\ell}$，我们将所有可能基因型的基因型水平未呈递概率，按其 HWE 频率加权求和。这是全概率定律的一个应用。\n$$\nQ_{\\ell} = \\sum_{a_i \\in \\mathcal{A}_{\\ell}} \\sum_{a_j \\in \\mathcal{A}_{\\ell}} P(\\text{genotype } (a_i, a_j)) \\cdot q_{a_i}(S) \\, q_{a_j}(S)\n$$\n通过将总和划分为纯合子（$i=j$）和杂合子（$i \\neq j$）项，我们得到：\n$$\nQ_{\\ell} = \\sum_{i} f_{a_i}^2 \\cdot q_{a_i}(S)^2 + \\sum_{i \\neq j} 2 f_{a_i} f_{a_j} \\cdot q_{a_i}(S) \\, q_{a_j}(S)\n$$\n这个表达式是一个平方和的展开式：\n$$\nQ_{\\ell} = \\left( \\sum_{a \\in \\mathcal{A}_{\\ell}} f_{a} \\, q_{a}(S) \\right)^2\n$$\n设 $\\bar{q}_{\\ell} = \\sum_{a \\in \\mathcal{A}_{\\ell}} f_{a} \\, q_{a}(S)$ 是基因座 $\\ell$ 上按等位基因频率加权的单等位基因未呈递概率的平均值。那么，$Q_{\\ell} = (\\bar{q}_{\\ell})^2$。这个简洁的结果意味着，在 HWE 条件下，一个二倍体生物体在基因座水平上未呈递的概率，是该群体中平均单倍体（单等位基因）未呈递概率的平方。\n\n结合这些结果，总人群覆盖率的最终公式为：\n$$\nC_{total} = 1 - \\prod_{\\ell \\in \\mathcal{L}} \\left( \\sum_{a \\in \\mathcal{A}_{\\ell}} f_{a} \\prod_{p \\in S} (1 - b_{p,a}) \\right)^2\n$$\n对于每个测试用例，计算算法按以下步骤进行：\n$1$. 对于每个基因座 $\\ell$，计算平均单等位基因未呈递概率 $\\bar{q}_{\\ell}$。\n    a. 对于每个等位基因 $a \\in \\mathcal{A}_{\\ell}$，通过对所有肽 $p \\in S$ 的 $(1 - b_{p,a})$ 进行乘积来计算其未呈递概率 $q_{a}(S)$。任何缺失的 $b_{p,a}$ 都被视为 $0$。\n    b. 通过对所有等位基因 $a \\in \\mathcal{A}_{\\ell}$ 求和 $f_{a} \\cdot q_{a}(S)$ 来计算 $\\bar{q}_{\\ell}$。\n$2$. 对于每个基因座 $\\ell$，计算基因座水平的未呈递概率 $Q_{\\ell} = (\\bar{q}_{\\ell})^2$。\n$3$. 通过将所有 $Q_{\\ell}$ 值相乘来计算总未呈递概率 $Q_{total}$。\n$4$. 最终的覆盖率是 $C_{total} = 1 - Q_{total}$。\n$5$. 然后按要求将结果四舍五入到 $6$ 位小数。\n为每个提供的测试用例实施此程序。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the predicted population coverage for epitope-based vaccines\n    for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"peptides\": [\"p1\", \"p2\"],\n            \"loci\": [\n                {\n                    \"name\": \"A\",\n                    \"alleles\": {\"A*01:01\": 0.3, \"A*02:01\": 0.5, \"A*03:01\": 0.2},\n                    \"bindings\": {\n                        \"p1\": {\"A*01:01\": 0.7, \"A*02:01\": 0.1, \"A*03:01\": 0.0},\n                        \"p2\": {\"A*01:01\": 0.2, \"A*02:01\": 0.6, \"A*03:01\": 0.1},\n                    },\n                },\n                {\n                    \"name\": \"B\",\n                    \"alleles\": {\"B*07:02\": 0.6, \"B*08:01\": 0.4},\n                    \"bindings\": {\n                        \"p1\": {\"B*07:02\": 0.3, \"B*08:01\": 0.8},\n                        \"p2\": {\"B*07:02\": 0.4, \"B*08:01\": 0.2},\n                    },\n                },\n            ],\n        },\n        {\n            \"peptides\": [\"p3\"],\n            \"loci\": [\n                {\n                    \"name\": \"A\",\n                    \"alleles\": {\"A*01:01\": 1.0, \"A*02:01\": 0.0},\n                    \"bindings\": {\"p3\": {\"A*01:01\": 0.5, \"A*02:01\": 0.0}},\n                }\n            ],\n        },\n        {\n            \"peptides\": [\"p4\", \"p5\"],\n            \"loci\": [\n                {\n                    \"name\": \"A\",\n                    \"alleles\": {\"A1\": 0.5, \"A2\": 0.5},\n                    \"bindings\": {\n                        \"p4\": {\"A1\": 0.0, \"A2\": 0.0},\n                        \"p5\": {\"A1\": 0.0, \"A2\": 0.0},\n                    },\n                },\n                {\n                    \"name\": \"B\",\n                    \"alleles\": {\"B1\": 1.0},\n                    \"bindings\": {\"p4\": {\"B1\": 0.9}, \"p5\": {\"B1\": 0.0}},\n                },\n            ],\n        },\n        {\n            \"peptides\": [\"p6\"],\n            \"loci\": [\n                {\n                    \"name\": \"A\",\n                    \"alleles\": {\"A1\": 0.01, \"A2\": 0.99},\n                    \"bindings\": {\"p6\": {\"A1\": 1.0, \"A2\": 0.0}},\n                },\n                {\n                    \"name\": \"B\",\n                    \"alleles\": {\"B1\": 0.5, \"B2\": 0.5},\n                    \"bindings\": {\"p6\": {\"B1\": 0.2}}, # Missing b_p6,B2 is treated as 0\n                },\n            ],\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        locus_failure_probabilities = []\n        \n        for locus_data in case[\"loci\"]:\n            peptides = case[\"peptides\"]\n            alleles = locus_data[\"alleles\"]\n            bindings = locus_data.get(\"bindings\", {})\n\n            # Calculate the population-averaged per-allele failure probability, q_bar_l\n            avg_allele_failure_prob = 0.0\n            \n            for allele_name, allele_freq in alleles.items():\n                # Calculate the per-allele probability of non-presentation, q_a(S)\n                per_allele_failure_prob = 1.0\n                for peptide in peptides:\n                    binding_prob = bindings.get(peptide, {}).get(allele_name, 0.0)\n                    per_allele_failure_prob *= (1.0 - binding_prob)\n                \n                avg_allele_failure_prob += allele_freq * per_allele_failure_prob\n            \n            # The locus-level failure probability Q_l is (q_bar_l)^2\n            locus_failure_prob = avg_allele_failure_prob ** 2\n            locus_failure_probabilities.append(locus_failure_prob)\n            \n        # Total failure probability is the product of locus-level failure probabilities\n        total_failure_prob = np.prod(locus_failure_probabilities)\n        \n        # Overall coverage is 1 - total failure probability\n        coverage = 1.0 - total_failure_prob\n        results.append(coverage)\n        \n    # Format the output string as required\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2469070"}]}