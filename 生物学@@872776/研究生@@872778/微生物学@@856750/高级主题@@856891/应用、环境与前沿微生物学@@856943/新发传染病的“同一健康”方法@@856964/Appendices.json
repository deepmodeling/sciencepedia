{"hands_on_practices": [{"introduction": "评估一种新发人兽共患病威胁的关键第一步是确定其传播潜力。基本再生数（$R_0$）是衡量这一潜力的核心指标，它代表在完全易感的种群中，一个典型感染者所能传染的平均人数。此练习提供了一个动手实践机会，让学生为一个包含人类和动物宿主的系统计算 $R_0$ [@problem_id:2539214]，这是“同一健康”方法中理解跨物种传播动态的基础。", "problem": "一种新型人兽共患病毒在一个区域出现，该区域中的人类和同域动物宿主物种通过环境接触和偶尔的直接暴露相互作用。遵循“同一健康”（One Health, OH）框架，考虑一个包含两个宿主种群（人类和动物）的最简易感-感染-恢复模型。假设在短暂的流行时间范围内，传播是频率依赖性的，包括种间和种内传播，感染期服从指数分布，且不考虑生命动力学。设 $S_h$、$I_h$、$R_h$ 分别表示人类的易感、感染和恢复人群，而 $S_a$、$I_a$、$R_a$ 为相应的动物仓室。总宿主种群大小恒定为 $N_h$ 和 $N_a$，无病平衡点值为 $S_h^{\\ast} = N_h$ 和 $S_a^{\\ast} = N_a$。\n\n人类的感染力由下式给出\n$$\n\\lambda_h = \\beta_{hh}\\frac{I_h}{N_h} + \\beta_{ha}\\frac{I_a}{N_a},\n$$\n动物的感染力由下式给出\n$$\n\\lambda_a = \\beta_{aa}\\frac{I_a}{N_a} + \\beta_{ah}\\frac{I_h}{N_h},\n$$\n其中 $\\beta_{ij}$ 是从感染性宿主类型 $j$ 到易感宿主类型 $i$ 的有效传播系数。感染个体的恢复率（人均）分别为 $\\gamma_h$（人类）和 $\\gamma_a$（动物）。\n\n从仓室流行病模型中下一代算子的基本定义出发，利用无病平衡点，为感染子系统 $(I_h, I_a)$ 构建下一代矩阵（NGM）$K$，并计算作为 $K$ 的谱半径（主特征值）的基本再生数（$R_0$）。\n\n使用以下科学上合理的参数值，这些值反映了与新发人兽共患病一致的不对称跨物种传播：\n- $N_h = 1.2 \\times 10^{6}$，\n- $N_a = 1.0 \\times 10^{6}$，\n- $\\beta_{hh} = 0.08 \\text{ day}^{-1}$，\n- $\\beta_{aa} = 0.20 \\text{ day}^{-1}$，\n- $\\beta_{ha} = 0.10 \\text{ day}^{-1}$ (动物到人)，\n- $\\beta_{ah} = 0.02 \\text{ day}^{-1}$ (人到动物)，\n- 人类平均感染期 $= 7 \\text{ 天}$ (所以 $\\gamma_h = 1/7 \\text{ day}^{-1}$)，\n- 动物平均感染期 $= 5 \\text{ 天}$ (所以 $\\gamma_a = 1/5 \\text{ day}^{-1}$)。\n\n将 $R_0$ 的最终数值四舍五入至四位有效数字。将最终答案表示为不带单位的纯数。", "solution": "问题陈述需进行验证。\n\n逐字提取给定条件：\n- 针对人类 (h) 和动物 (a) 的双宿主易感-感染-恢复 (SIR) 模型。\n- 总种群大小：$N_h$, $N_a$。\n- 无病平衡点 (DFE)：$S_h^{\\ast} = N_h$, $S_a^{\\ast} = N_a$。\n- 人类的感染力：$\\lambda_h = \\beta_{hh}\\frac{I_h}{N_h} + \\beta_{ha}\\frac{I_a}{N_a}$。\n- 动物的感染力：$\\lambda_a = \\beta_{aa}\\frac{I_a}{N_a} + \\beta_{ah}\\frac{I_h}{N_h}$。\n- 传播系数：$\\beta_{hh}$, $\\beta_{aa}$, $\\beta_{ha}$, $\\beta_{ah}$。\n- 人均恢复率：$\\gamma_h$, $\\gamma_a$。\n- 参数值：\n  - $N_h = 1.2 \\times 10^{6}$\n  - $N_a = 1.0 \\times 10^{6}$\n  - $\\beta_{hh} = 0.08 \\text{ day}^{-1}$\n  - $\\beta_{aa} = 0.20 \\text{ day}^{-1}$\n  - $\\beta_{ha} = 0.10 \\text{ day}^{-1}$\n  - $\\beta_{ah} = 0.02 \\text{ day}^{-1}$\n  - $\\gamma_h = 1/7 \\text{ day}^{-1}$\n  - $\\gamma_a = 1/5 \\text{ day}^{-1}$\n- 任务是为感染子系统 $(I_h, I_a)$ 构建下一代矩阵 (NGM) $K$，并计算基本再生数 $R_0 = \\rho(K)$（$K$ 的谱半径），结果四舍五入至四位有效数字。\n\n验证结论：\n该问题具有科学依据，采用了标准的 SIR 框架和成熟的用于计算基本再生数的下一代矩阵方法。这是一个良定的问题，提供了所有必需的参数和明确的目标。语言客观而精确。该模型是自洽且内部一致的。参数值被陈述为合理的，并且不会造成科学或逻辑上的矛盾。该问题是数理流行病学中的一个标准的、非平凡的练习。因此，该问题被认定为有效，并将提供解答。\n\n双宿主模型中感染仓室的动力学由以下微分方程组描述：\n$$\n\\frac{dI_h}{dt} = \\lambda_h S_h - \\gamma_h I_h = \\left(\\beta_{hh}\\frac{I_h}{N_h} + \\beta_{ha}\\frac{I_a}{N_a}\\right)S_h - \\gamma_h I_h\n$$\n$$\n\\frac{dI_a}{dt} = \\lambda_a S_a - \\gamma_a I_a = \\left(\\beta_{aa}\\frac{I_a}{N_a} + \\beta_{ah}\\frac{I_h}{N_h}\\right)S_a - \\gamma_a I_a\n$$\n为计算基本再生数 $R_0$，我们使用下一代方法。这需要围绕无病平衡点 (DFE) $(S_h, I_h, R_h, S_a, I_a, R_a) = (N_h, 0, 0, N_a, 0, 0)$ 对系统进行线性化。\n\n我们将感染仓室 $\\mathbf{I} = (I_h, I_a)^T$ 的线性化系统分解为两部分：$\\frac{d\\mathbf{I}}{dt} = \\mathcal{F} - \\mathcal{V}$，其中 $\\mathcal{F}$ 表示新感染率，$\\mathcal{V}$ 表示仓室间的转移率（在本例中为恢复）。\n\n新感染率向量为：\n$$\n\\mathcal{F} = \\begin{pmatrix} \\left(\\beta_{hh}\\frac{I_h}{N_h} + \\beta_{ha}\\frac{I_a}{N_a}\\right)S_h \\\\ \\left(\\beta_{aa}\\frac{I_a}{N_a} + \\beta_{ah}\\frac{I_h}{N_h}\\right)S_a \\end{pmatrix}\n$$\n转移率向量为：\n$$\n\\mathcal{V} = \\begin{pmatrix} \\gamma_h I_h \\\\ \\gamma_a I_a \\end{pmatrix}\n$$\n下一代方法将矩阵 $F$ 和 $V$ 定义为 $\\mathcal{F}$ 和 $\\mathcal{V}$ 关于感染变量在无病平衡点 (DFE) 处求值的雅可比矩阵。\n$$\nF = \\frac{\\partial \\mathcal{F}}{\\partial \\mathbf{I}}\\bigg|_{\\text{DFE}} \\quad \\text{和} \\quad V = \\frac{\\partial \\mathcal{V}}{\\partial \\mathbf{I}}\\bigg|_{\\text{DFE}}\n$$\n在 DFE 处，$S_h = N_h$ 且 $S_a = N_a$。\n计算 $F$ 的偏导数：\n$$\nF_{11} = \\frac{\\partial \\mathcal{F}_h}{\\partial I_h}\\bigg|_{\\text{DFE}} = \\frac{\\beta_{hh}}{N_h}S_h\\bigg|_{\\text{DFE}} = \\beta_{hh}\n$$\n$$\nF_{12} = \\frac{\\partial \\mathcal{F}_h}{\\partial I_a}\\bigg|_{\\text{DFE}} = \\frac{\\beta_{ha}}{N_a}S_h\\bigg|_{\\text{DFE}} = \\beta_{ha}\\frac{N_h}{N_a}\n$$\n$$\nF_{21} = \\frac{\\partial \\mathcal{F}_a}{\\partial I_h}\\bigg|_{\\text{DFE}} = \\frac{\\beta_{ah}}{N_h}S_a\\bigg|_{\\text{DFE}} = \\beta_{ah}\\frac{N_a}{N_h}\n$$\n$$\nF_{22} = \\frac{\\partial \\mathcal{F}_a}{\\partial I_a}\\bigg|_{\\text{DFE}} = \\frac{\\beta_{aa}}{N_a}S_a\\bigg|_{\\text{DFE}} = \\beta_{aa}\n$$\n因此，矩阵 $F$ 为：\n$$\nF = \\begin{pmatrix} \\beta_{hh} & \\beta_{ha}\\frac{N_h}{N_a} \\\\ \\beta_{ah}\\frac{N_a}{N_h} & \\beta_{aa} \\end{pmatrix}\n$$\n矩阵 $V$ 是一个由恢复率构成的对角矩阵：\n$$\nV = \\begin{pmatrix} \\gamma_h & 0 \\\\ 0 & \\gamma_a \\end{pmatrix}\n$$\n下一代矩阵 (NGM) 定义为 $K = FV^{-1}$。\n$$\nV^{-1} = \\begin{pmatrix} \\frac{1}{\\gamma_h} & 0 \\\\ 0 & \\frac{1}{\\gamma_a} \\end{pmatrix}\n$$\n$$\nK = \\begin{pmatrix} \\beta_{hh} & \\beta_{ha}\\frac{N_h}{N_a} \\\\ \\beta_{ah}\\frac{N_a}{N_h} & \\beta_{aa} \\end{pmatrix} \\begin{pmatrix} \\frac{1}{\\gamma_h} & 0 \\\\ 0 & \\frac{1}{\\gamma_a} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\beta_{hh}}{\\gamma_h} & \\frac{\\beta_{ha}}{\\gamma_a}\\frac{N_h}{N_a} \\\\ \\frac{\\beta_{ah}}{\\gamma_h}\\frac{N_a}{N_h} & \\frac{\\beta_{aa}}{\\gamma_a} \\end{pmatrix}\n$$\n基本再生数 $R_0$ 是 $K$ 的谱半径，记为 $\\rho(K)$。这是 $K$ 的主特征值。特征值 $\\lambda$ 通过求解特征方程 $\\det(K - \\lambda I) = 0$ 得到。\n$$\n\\det \\begin{pmatrix} \\frac{\\beta_{hh}}{\\gamma_h} - \\lambda & \\frac{\\beta_{ha}}{\\gamma_a}\\frac{N_h}{N_a} \\\\ \\frac{\\beta_{ah}}{\\gamma_h}\\frac{N_a}{N_h} & \\frac{\\beta_{aa}}{\\gamma_a} - \\lambda \\end{pmatrix} = 0\n$$\n$$\n\\left(\\frac{\\beta_{hh}}{\\gamma_h} - \\lambda\\right)\\left(\\frac{\\beta_{aa}}{\\gamma_a} - \\lambda\\right) - \\left(\\frac{\\beta_{ha}}{\\gamma_a}\\frac{N_h}{N_a}\\right)\\left(\\frac{\\beta_{ah}}{\\gamma_h}\\frac{N_a}{N_h}\\right) = 0\n$$\n这可以简化为：\n$$\n\\lambda^2 - \\left(\\frac{\\beta_{hh}}{\\gamma_h} + \\frac{\\beta_{aa}}{\\gamma_a}\\right)\\lambda + \\frac{\\beta_{hh}\\beta_{aa}}{\\gamma_h\\gamma_a} - \\frac{\\beta_{ha}\\beta_{ah}}{\\gamma_h\\gamma_a} = 0\n$$\n这个二次方程的解 $\\lambda$ 由二次公式给出。$R_0$ 是两个根中较大的一个：\n$$\nR_0 = \\frac{1}{2} \\left[ \\left(\\frac{\\beta_{hh}}{\\gamma_h} + \\frac{\\beta_{aa}}{\\gamma_a}\\right) + \\sqrt{\\left(\\frac{\\beta_{hh}}{\\gamma_h} + \\frac{\\beta_{aa}}{\\gamma_a}\\right)^2 - 4\\left(\\frac{\\beta_{hh}\\beta_{aa}}{\\gamma_h\\gamma_a} - \\frac{\\beta_{ha}\\beta_{ah}}{\\gamma_h\\gamma_a}\\right)} \\right]\n$$\n简化平方根下的项：\n$$\n\\sqrt{\\left(\\frac{\\beta_{hh}}{\\gamma_h} - \\frac{\\beta_{aa}}{\\gamma_a}\\right)^2 + 4\\frac{\\beta_{ha}\\beta_{ah}}{\\gamma_h\\gamma_a}}\n$$\n所以，$R_0$ 的符号表达式为：\n$$\nR_0 = \\frac{1}{2} \\left( \\frac{\\beta_{hh}}{\\gamma_h} + \\frac{\\beta_{aa}}{\\gamma_a} + \\sqrt{\\left(\\frac{\\beta_{hh}}{\\gamma_h} - \\frac{\\beta_{aa}}{\\gamma_a}\\right)^2 + 4\\frac{\\beta_{ha}\\beta_{ah}}{\\gamma_h\\gamma_a}} \\right)\n$$\n现在我们代入给定的数值：\n- $\\gamma_h = \\frac{1}{7} \\text{ day}^{-1}$, $\\gamma_a = \\frac{1}{5} \\text{ day}^{-1}$。\n- $\\frac{N_h}{N_a} = \\frac{1.2 \\times 10^6}{1.0 \\times 10^6} = 1.2$。\n\n首先，我们计算各个分量：\n- $R_{hh} = \\frac{\\beta_{hh}}{\\gamma_h} = \\frac{0.08}{1/7} = 0.56$。\n- $R_{aa} = \\frac{\\beta_{aa}}{\\gamma_a} = \\frac{0.20}{1/5} = 1.0$。\n- 交叉感染项：$4\\frac{\\beta_{ha}\\beta_{ah}}{\\gamma_h\\gamma_a} = 4\\frac{(0.10)(0.02)}{(1/7)(1/5)} = 4 \\times 0.002 \\times 35 = 4 \\times 0.07 = 0.28$。\n\n将这些代入 $R_0$ 的公式：\n$$\nR_0 = \\frac{1}{2} \\left( 0.56 + 1.0 + \\sqrt{(0.56 - 1.0)^2 + 0.28} \\right)\n$$\n$$\nR_0 = \\frac{1}{2} \\left( 1.56 + \\sqrt{(-0.44)^2 + 0.28} \\right)\n$$\n$$\nR_0 = \\frac{1}{2} \\left( 1.56 + \\sqrt{0.1936 + 0.28} \\right)\n$$\n$$\nR_0 = \\frac{1}{2} \\left( 1.56 + \\sqrt{0.4736} \\right)\n$$\n$$\nR_0 \\approx \\frac{1}{2} \\left( 1.56 + 0.688186 \\right)\n$$\n$$\nR_0 \\approx \\frac{1}{2} (2.248186)\n$$\n$$\nR_0 \\approx 1.124093\n$$\n四舍五入到四位有效数字，结果是 $1.124$。", "answer": "$$\n\\boxed{1.124}\n$$", "id": "2539214"}, {"introduction": "疾病风险不仅取决于病原体本身，还取决于其所在的生态群落。在“同一健康”研究中，一个重要的生态学概念是“稀释效应”，即生物多样性的增加可能会降低疾病传播风险。此练习 [@problem_id:2539179] 建立在 $R_0$ 计算的基础上，通过模拟向生态系统中引入一个新的低传播能力宿主，让学生定量地探索这一概念，并评估这如何改变整个系统的传播风险。", "problem": "在一个与“同一健康”理念相关的乡村农业生态系统中，考虑一种由兼食性蚊子在多种宿主物种间传播的媒介传播型人兽共患病。起初，该群落由一个野生动物水库宿主和人类组成。随后，引入一个传播能力较低的牲畜物种，这可能会转移媒介的叮咬（一种假定的稀释效应）。假设以下经过充分检验的基础和标准建模假设。\n\n- 频率依赖性叮咬：每个媒介每天以速率 $a$ 进行叮咬，分配给宿主 $i$ 的叮咬比例为 $q_i = \\dfrac{w_i N_i}{\\sum_{k} w_k N_k}$，其中 $w_i$ 是一个恒定的宿主偏好权重，$N_i$ 是宿主丰度。\n- 通过叮咬传播：每次叮咬时，从媒介传播到宿主 $i$ 的概率为 $b_i$，从宿主 $i$ 传播到媒介的概率为 $c_i$。\n- 宿主感染清除：宿主 $i$ 的感染期呈指数分布，恢复速率为 $\\gamma_i$（每天）。\n- 媒介感染：媒介一旦被感染，就不会恢复，并以速率 $\\mu_V$（每天）死亡。假设相对于媒介的寿命，外在潜伏期可以忽略不计，因此媒介在感染后几乎立即具有传染性。\n- 无病平衡点（DFE）：此时所有宿主和媒介均为易感状态。基本再生数（$R_0$）定义为在DFE处线性化的下一代矩阵（NGM）的谱半径。\n\n使用适用于二分宿主-媒介系统的下一代矩阵框架：通过在DFE处组合宿主到媒介和媒介到宿主的感染映射来构建宿主到宿主的下一代矩阵，并回顾对于一个包含宿主和媒介的二分NGM，基本再生数的平方，$R_0^2$，等于宿主到宿主下一代矩阵的主特征值。\n\n参数值（所有 $w_i = 1$）：\n- 媒介种群：$N_V = 100000$，叮咬率 $a = 0.25$ /天，媒介死亡率 $\\mu_V = 0.1$ /天。\n- 野生动物水库 ($R$)：$N_R = 500$, $b_R = 0.4$, $c_R = 0.6$, $\\gamma_R = 0.05$ /天。\n- 人类 ($H$)：$N_H = 5000$, $b_H = 0.2$, $c_H = 0.3$, $\\gamma_H = \\dfrac{1}{7}$ /天。\n- 牲畜 ($L$，后引入)：$N_L = 10000$, $b_L = 0.05$, $c_L = 0.05$, $\\gamma_L = 0.2$ /天。\n\n计算引入牲畜后的基本再生数与引入前的基本再生数之比，$R_{0,\\mathrm{after}}/R_{0,\\mathrm{before}}$，其中“引入前”仅包括野生动物水库和人类，“引入后”则包括牲畜作为第三种宿主。将最终答案表示为四舍五入到四位有效数字的小数。最终答案无需单位。", "solution": "该问题要求计算在一个媒介传播疾病系统中，引入牲畜宿主种群前后的基本再生数 $R_0$ 之比。该问题表述清晰且科学上合理，基于标准的Ross-Macdonald媒介传播疾病框架。\n\n我们首先按照指定的方法，使用下一代矩阵（NGM）法来形式化基本再生数 $R_0$ 的表达式。对于一个二分宿主-媒介系统，$R_0^2$ 是宿主到宿主下一代矩阵的谱半径，我们将推导这个矩阵。\n\n假设有 $n$ 个宿主物种，索引为 $k \\in \\{1, 2, \\dots, n\\}$。\n由单个受感染的媒介在其整个传染期（$1/\\mu_V$）内产生的 $i$ 型宿主的新增感染数，等于叮咬 $i$ 型宿主的速率（$a q_i$）乘以传播概率（$b_i$）和媒介的传染期寿命（$1/\\mu_V$）。这构成了媒介到宿主的感染矩阵（一个列向量 $K_{HV}$）：\n$$ (K_{HV})_i = \\frac{a q_i b_i}{\\mu_V} $$\n\n由单个受感染的 $j$ 型宿主在其整个传染期（$1/\\gamma_j$）内产生的媒介新增感染数，等于其被叮咬的速率（$\\frac{a N_V q_j}{N_j}$）乘以传播概率（$c_j$）和宿主的传染期（$1/\\gamma_j$）。这构成了宿主到媒介的感染矩阵（一个行向量 $K_{VH}$）：\n$$ (K_{VH})_j = \\frac{a N_V q_j c_j}{N_j \\gamma_j} $$\n\n宿主到宿主的下一代矩阵 $K_{HH}$ 是 $K_{HV}$ 和 $K_{VH}$ 的乘积，$K_{HH} = K_{HV} K_{VH}$。元素 $(K_{HH})_{ij}$ 表示由 $j$ 型宿主的单个原发感染，通过媒介种群，在 $i$ 型宿主中引起的继发感染数。\n$$ (K_{HH})_{ij} = (K_{HV})_i (K_{VH})_j = \\left( \\frac{a q_i b_i}{\\mu_V} \\right) \\left( \\frac{a N_V q_j c_j}{N_j \\gamma_j} \\right) = \\frac{a^2 N_V}{\\mu_V} \\frac{q_i b_i q_j c_j}{N_j \\gamma_j} $$\n\n问题指出，$R_0^2$ 是 $K_{HH}$ 的主特征值（谱半径）。矩阵 $K_{HH}$ 是一个秩为1的矩阵，因为它是两个向量的外积。这种矩阵的主特征值等于其迹，也等于构成向量的逆序标量积，即 $\\rho(K_{HH}) = K_{VH} K_{HV}$。\n$$ R_0^2 = \\sum_{k=1}^n (K_{VH})_k (K_{HV})_k = \\sum_{k=1}^n \\left( \\frac{a N_V q_k c_k}{N_k \\gamma_k} \\right) \\left( \\frac{a q_k b_k}{\\mu_V} \\right) = \\frac{a^2 N_V}{\\mu_V} \\sum_{k=1}^n \\frac{q_k^2 b_k c_k}{N_k \\gamma_k} $$\n\n对宿主 $k$ 的叮咬比例 $q_k$ 由 $q_k = \\frac{w_k N_k}{\\sum_j w_j N_j}$ 给出。当所有偏好权重 $w_k=1$ 时，这简化为 $q_k = \\frac{N_k}{\\sum_j N_j} = \\frac{N_k}{N_{tot}}$，其中 $N_{tot}$ 是总宿主种群大小。\n将此代入 $R_0^2$ 的表达式中：\n$$ R_0^2 = \\frac{a^2 N_V}{\\mu_V} \\sum_{k=1}^n \\frac{1}{N_k \\gamma_k} \\left( \\frac{N_k}{N_{tot}} \\right)^2 b_k c_k = \\frac{a^2 N_V}{\\mu_V} \\frac{1}{N_{tot}^2} \\sum_{k=1}^n \\frac{N_k b_k c_k}{\\gamma_k} $$\n令常数前因子为 $C = \\frac{a^2 N_V}{\\mu_V}$，并定义一个宿主特异性贡献项 $A_k = N_k \\frac{b_k c_k}{\\gamma_k}$。$R_0^2$ 的表达式变为：\n$$ R_0^2 = C \\frac{\\sum_k A_k}{N_{tot}^2} $$\n\n我们现在将此公式应用于两种情景。\n首先，我们为每种宿主计算 $A_k$ 项：\n- 野生动物水库 (R)：$A_R = N_R \\frac{b_R c_R}{\\gamma_R} = 500 \\times \\frac{0.4 \\times 0.6}{0.05} = 500 \\times \\frac{0.24}{0.05} = 500 \\times 4.8 = 2400$。\n- 人类 (H)：$A_H = N_H \\frac{b_H c_H}{\\gamma_H} = 5000 \\times \\frac{0.2 \\times 0.3}{1/7} = 5000 \\times 0.06 \\times 7 = 5000 \\times 0.42 = 2100$。\n- 牲畜 (L)：$A_L = N_L \\frac{b_L c_L}{\\gamma_L} = 10000 \\times \\frac{0.05 \\times 0.05}{0.2} = 10000 \\times \\frac{0.0025}{0.2} = 10000 \\times 0.0125 = 125$。\n\n**情景1：引入牲畜前**\n宿主为野生动物 (R) 和人类 (H)。\n- 总宿主种群：$N_{tot, \\mathrm{before}} = N_R + N_H = 500 + 5000 = 5500$。\n- 贡献总和：$\\sum A_k = A_R + A_H = 2400 + 2100 = 4500$。\n- 基本再生数的平方为：\n$$ R_{0,\\mathrm{before}}^2 = C \\frac{4500}{(5500)^2} $$\n\n**情景2：引入牲畜后**\n宿主为野生动物 (R)、人类 (H) 和牲畜 (L)。\n- 总宿主种群：$N_{tot, \\mathrm{after}} = N_R + N_H + N_L = 500 + 5000 + 10000 = 15500$。\n- 贡献总和：$\\sum A_k = A_R + A_H + A_L = 2400 + 2100 + 125 = 4625$。\n- 基本再生数的平方为：\n$$ R_{0,\\mathrm{after}}^2 = C \\frac{4625}{(15500)^2} $$\n\n**比率计算**\n我们必须计算比率 $\\frac{R_{0,\\mathrm{after}}}{R_{0,\\mathrm{before}}}$。首先计算平方的比率会更方便：\n$$ \\frac{R_{0,\\mathrm{after}}^2}{R_{0,\\mathrm{before}}^2} = \\frac{C \\frac{4625}{(15500)^2}}{C \\frac{4500}{(5500)^2}} = \\frac{4625}{4500} \\times \\left(\\frac{5500}{15500}\\right)^2 $$\n简化分数：\n$$ \\frac{4625}{4500} = \\frac{185 \\times 25}{180 \\times 25} = \\frac{185}{180} = \\frac{37 \\times 5}{36 \\times 5} = \\frac{37}{36} $$\n$$ \\frac{5500}{15500} = \\frac{55}{155} = \\frac{11 \\times 5}{31 \\times 5} = \\frac{11}{31} $$\n将这些代回平方的比率中：\n$$ \\frac{R_{0,\\mathrm{after}}^2}{R_{0,\\mathrm{before}}^2} = \\frac{37}{36} \\times \\left(\\frac{11}{31}\\right)^2 = \\frac{37}{36} \\times \\frac{121}{961} = \\frac{4477}{34596} $$\n所需比率为该值的平方根：\n$$ \\frac{R_{0,\\mathrm{after}}}{R_{0,\\mathrm{before}}} = \\sqrt{\\frac{4477}{34596}} $$\n现在，我们计算数值并四舍五入到四位有效数字：\n$$ \\sqrt{\\frac{4477}{34596}} \\approx \\sqrt{0.129408024...} \\approx 0.359733267... $$\n四舍五入到四位有效数字得到 $0.3597$。", "answer": "$$ \\boxed{0.3597} $$", "id": "2539179"}, {"introduction": "在疫情调查中，一项核心任务是重建“谁感染了谁”的传播链，尤其是在涉及跨物种传播时。现代“同一健康”调查通过整合病原体基因组学和传统的流行病学数据来实现这一目标。此练习 [@problem_id:2539206] 提供了一个实用的贝叶斯推断框架，让学生能够综合利用系统发育和流行病学信息，量化跨物种传播事件的可能性，从而深入理解疫情的传播细节。", "problem": "您将获得小型的、程式化的暴发数据集，这些数据集通过最近共同祖先（MRCA）时间的对称矩阵和每个抽样病例的宿主元数据来编码一个有年代的系统发育。对于每个数据集，您必须重建可能的跨物种传播结构，方法是为每个受体病例计算其可能供体的后验概率分布，这些供体是较早的病例。然后，您必须汇总每个受体的这些后验概率，以获得跨物种传播事件的期望数量。此任务通过使用贝叶斯原理，将多宿主序列间隔信息与系统发育时间约束相结合，从而形式化了一个“同一健康”推断问题。\n\n基本原理：\n- 贝叶斯法则：对于假设 $H_i$ 和数据 $D$，$P(H_i \\mid D) \\propto P(H_i) \\, P(D \\mid H_i)$。\n- 序列间隔（SI）是指从供体症状发作（或采样）到受体症状发作（或采样）的时间。我们使用对数正态分布对 SI 进行建模，其参数由每个宿主到宿主对的指定均值和标准差值导出。\n- 一个有年代的系统发育通过 MRCA 时间来约束传播：MRCA 相对于供体采样时间越近，该对与直接传播的兼容性就越高。\n\n模型假设和定义：\n- 令 $i$ 和 $j$ 为病例索引，其采样时间分别为 $t_i$ 和 $t_j$（单位：天）。令 $s_i$ 和 $s_j$ 表示它们的宿主物种，令 $m_{ij}$ 为对 $\\{i,j\\}$ 的 MRCA 时间（单位：天）。\n- 受体 $j$ 的候选供体仅限于满足 $t_i < t_j$ 的病例 $i$。\n- 对于每个有序宿主对 $(s_i \\rightarrow s_j)$，序列间隔模型为具有均值 $\\mu_{s_i \\rightarrow s_j}$ 和标准差 $\\sigma_{s_i \\rightarrow s_j}$（单位均为天）的对数正态分布。对于一个实现的采样间隔时间 $\\tau_{ij} = t_j - t_i$，时间似然为 $L_{\\text{time}}(i \\rightarrow j) = f_{\\text{LN}}(\\tau_{ij} \\,;\\, \\mu_{s_i \\rightarrow s_j}, \\sigma_{s_i \\rightarrow s_j})$，其中 $f_{\\text{LN}}$ 表示由其均值和标准差参数化的对数正态概率密度函数（见下文）。\n- 系统发育兼容性权重会对那些谱系合并时间远早于供体采样时间的供体进行惩罚。定义一个容忍窗口 $\\Delta$（天）和一个衰减率 $\\alpha$（每天）。系统发育权重为\n$$\nL_{\\text{phylo}}(i \\rightarrow j) \\;=\\; \\exp\\!\\Big(-\\alpha \\, \\max\\!\\big(0,\\; (t_i - m_{ij}) - \\Delta\\big)\\Big).\n$$\n- 候选供体的先验结合了一个跨物种屏障因子 $b \\in (0,1]$：对于受体 $j$ 的候选供体 $i$，\n$$\nP_0(i \\rightarrow j) \\;\\propto\\; \\begin{cases}\n1,  \\text{若 } s_i = s_j,\\\\\nb,  \\text{若 } s_i \\neq s_j.\n\\end{cases}\n$$\n- 对于 $i \\rightarrow j$ 的未归一化后验权重为\n$$\nw_{ij} \\;=\\; P_0(i \\rightarrow j)\\, L_{\\text{time}}(i \\rightarrow j)\\, L_{\\text{phylo}}(i \\rightarrow j).\n$$\n对所有候选者 $i$ 的 $\\{w_{ij}\\}_{i: t_i < t_j}$ 进行归一化，以获得后验概率 $P(i \\rightarrow j \\mid \\text{data})$，对于每个至少有一个候选供体的 $j$，这些概率总和为 $1$。如果某个 $j$ 没有候选者，它对下文的跨物种期望贡献为 $0$。\n\n目标：\n- 对于每个数据集，通过对所有受体 $j$ 的其供体来自不同物种的后验概率求和，计算跨物种传播事件的期望数量：\n$$\n\\mathbb{E}[\\text{跨物种事件}] \\;=\\; \\sum_{j} \\sum_{i: t_i < t_j,\\, s_i \\neq s_j} P(i \\rightarrow j \\mid \\text{data}).\n$$\n\n对数正态分布参数化：\n- 给定一个实时均值为 $\\mu > 0$ 和标准差为 $\\sigma > 0$ 的对数正态分布，$\\ln X$ 对应的正态分布参数为\n$$\n\\tilde{\\mu} \\;=\\; \\ln\\!\\Big(\\frac{\\mu^2}{\\sqrt{\\sigma^2 + \\mu^2}}\\Big),\\quad\n\\tilde{\\sigma} \\;=\\; \\sqrt{\\ln\\!\\Big(1 + \\frac{\\sigma^2}{\\mu^2}\\Big)}.\n$$\n在 $x > 0$ 处的对数正态密度为\n$$\nf_{\\text{LN}}(x;\\mu,\\sigma) \\;=\\; \\frac{1}{x \\, \\tilde{\\sigma}\\,\\sqrt{2\\pi}} \\exp\\!\\Big(-\\frac{(\\ln x - \\tilde{\\mu})^2}{2\\,\\tilde{\\sigma}^2}\\Big).\n$$\n对于 $x \\le 0$，设 $f_{\\text{LN}}(x;\\mu,\\sigma)=0$。\n\n数据和测试套件（所有时间单位为天；物种为人类（H）和猪（S））：\n\n- 测试用例 1：\n  - $n = 5$ 个病例，采样时间 $t = [\\,2.0,\\,6.0,\\,9.5,\\,12.0,\\,15.0\\,]$，物种为 $[\\,\\mathrm{H},\\,\\mathrm{H},\\,\\mathrm{S},\\,\\mathrm{S},\\,\\mathrm{H}\\,]$，对应索引 1 到 5。\n  - 对称的 MRCA 时间矩阵 $M^{(1)}$（$i < j$ 的条目为 $m^{(1)}_{ij}$）：\n    - $m^{(1)}_{12}=1.5$, $m^{(1)}_{13}=1.0$, $m^{(1)}_{14}=0.8$, $m^{(1)}_{15}=1.2$,\n    - $m^{(1)}_{23}=3.0$, $m^{(1)}_{24}=2.5$, $m^{(1)}_{25}=3.5$,\n    - $m^{(1)}_{34}=8.0$, $m^{(1)}_{35}=6.0$,\n    - $m^{(1)}_{45}=10.0$。\n    对角线上的条目 $m^{(1)}_{ii}$ 未被使用。\n  - 序列间隔的均值和标准差 $(\\mu,\\sigma)$，单位为天：\n    - $\\mathrm{H}\\rightarrow \\mathrm{H}$: $(4.0,\\,2.0)$,\n    - $\\mathrm{H}\\rightarrow \\mathrm{S}$: $(6.0,\\,2.5)$,\n    - $\\mathrm{S}\\rightarrow \\mathrm{H}$: $(7.0,\\,3.0)$,\n    - $\\mathrm{S}\\rightarrow \\mathrm{S}$: $(5.0,\\,2.0)$。\n  - 跨物种屏障 $b = 0.5$，系统发育容忍度 $\\Delta = 3.0$，衰减率 $\\alpha = 0.25$。\n\n- 测试用例 2：\n  - $n = 5$ 个病例，采样时间 $t = [\\,1.0,\\,4.0,\\,7.0,\\,10.0,\\,11.0\\,]$，物种为 $[\\,\\mathrm{H},\\,\\mathrm{S},\\,\\mathrm{H},\\,\\mathrm{S},\\,\\mathrm{S}\\,]$。\n  - 对称的 MRCA 时间矩阵 $M^{(2)}$：\n    - $m^{(2)}_{12}=0.9$, $m^{(2)}_{13}=0.8$, $m^{(2)}_{14}=0.7$, $m^{(2)}_{15}=0.7$,\n    - $m^{(2)}_{23}=3.8$, $m^{(2)}_{24}=3.2$, $m^{(2)}_{25}=3.5$,\n    - $m^{(2)}_{34}=6.0$, $m^{(2)}_{35}=6.2$,\n    - $m^{(2)}_{45}=9.0$。\n  - 序列间隔与测试用例 1 相同。\n  - 跨物种屏障 $b = 0.7$，系统发育容忍度 $\\Delta = 2.0$，衰减率 $\\alpha = 0.4$。\n\n- 测试用例 3（边界条件）：\n  - $n = 4$ 个病例，采样时间 $t = [\\,3.0,\\,3.0,\\,9.0,\\,20.0\\,]$，物种为 $[\\,\\mathrm{H},\\,\\mathrm{S},\\,\\mathrm{H},\\,\\mathrmS\\,]$。\n  - 对称的 MRCA 时间矩阵 $M^{(3)}$：\n    - $m^{(3)}_{12}=2.5$, $m^{(3)}_{13}=2.0$, $m^{(3)}_{14}=2.0$,\n    - $m^{(3)}_{23}=2.2$, $m^{(3)}_{24}=2.1$,\n    - $m^{(3)}_{34}=8.0$。\n  - 序列间隔与测试用例 1 相同。\n  - 跨物种屏障 $b = 0.3$，系统发育容忍度 $\\Delta = 4.0$，衰减率 $\\alpha = 0.2$。\n\n任务：\n- 实现对所有满足 $t_i < t_j$ 的有效供体-受体对 $(i,j)$ 计算后验概率 $P(i \\rightarrow j \\mid \\text{data})$ 的过程，如上定义。\n- 对于每个测试用例，计算跨物种事件的期望，即对所有受体 $j$ 的其供体满足 $s_i \\neq s_j$ 的后验概率之和。\n\n单位和输出：\n- 所有时间单位均为天。没有角度单位。最终输出是无单位的实数。\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[x_1,x_2,x_3]$），其中 $x_k$ 是测试用例 $k$ 的跨物种传播事件的期望数量，每个值都四舍五入到恰好六位小数。", "solution": "该问题提出了一个科学上合理的贝叶斯推断框架，用于整合流行病学和系统发育数据来重建传播链。该模型和目标定义清晰、数学上适定，并提供了完整的数据集以供计算。该问题将通过仔细实现指定的算法来解决。\n\n总体算法如下：\n1.  对于每个测试用例，将跨物种事件期望数量的总和 $\\mathbb{E}_{\\text{total}}$ 初始化为 $0$。\n2.  遍历数据集中的每个病例 $j$，将其视为一个潜在的受体。\n3.  识别受体 $j$ 的候选供体集合，即所有采样时间 $t_i < t_j$ 的病例 $i$。\n4.  如果 $j$ 没有候选供体，则继续处理下一个受体。\n5.  对于每个候选供体 $i$，计算一个未归一化的后验权重 $w_{ij}$，该权重是三个部分的乘积：\n    a. **先验权重 $P_0(i \\rightarrow j)$**：如果供体 $i$ 和受体 $j$ 属于同一物种，则为 $1$；如果物种不同，则为跨物种屏障因子 $b$。\n    b. **时间似然 $L_{\\text{time}}(i \\rightarrow j)$**：这被计算为对数正态分布的概率密度函数（PDF），$f_{\\text{LN}}(\\tau_{ij} \\,;\\, \\mu_{s_i \\rightarrow s_j}, \\sigma_{s_i \\rightarrow s_j})$，其中 $\\tau_{ij} = t_j - t_i$ 是采样间隔。首先使用问题中提供的公式，将给定的均值 $\\mu$ 和标准差 $\\sigma$ 转换为其基础正态分布的参数 $\\tilde{\\mu}$ 和 $\\tilde{\\sigma}$。\n    c. **系统发育权重 $L_{\\text{phylo}}(i \\rightarrow j)$**：该项对那些进化关系与传播假设不一致的对进行惩罚。它使用以下公式计算：\n    $$ L_{\\text{phylo}}(i \\rightarrow j) = \\exp\\!\\Big(-\\alpha \\, \\max\\!\\big(0,\\; (t_i - m_{ij}) - \\Delta\\big)\\Big) $$\n    其中 $m_{ij}$ 是 MRCA 时间，$\\Delta$ 是容忍窗口，$\\alpha$ 是衰减率。\n\n6.  在计算了给定受体 $j$ 的所有候选供体 $i$ 的权重 $w_{ij}$ 之后，对权重进行归一化以获得后验概率：\n$$ P(i \\rightarrow j \\mid \\text{data}) = \\frac{w_{ij}}{\\sum_{k: t_k < t_j} w_{kj}} $$\n分母是受体 $j$ 的所有候选供体的权重之和。\n\n7.  受体 $j$ 对跨物种事件总期望数量的贡献是其所有跨物种供体的后验概率之和：\n$$ \\mathbb{E}_{j} = \\sum_{i: t_i < t_j,\\, s_i \\neq s_j} P(i \\rightarrow j \\mid \\text{data}) $$\n8.  将此贡献 $\\mathbb{E}_j$ 添加到总和 $\\mathbb{E}_{\\text{total}}$ 中。\n9.  在遍历所有可能的受体 $j$ 之后，$\\mathbb{E}_{\\text{total}}$ 的最终值就是该测试用例的结果。\n\n此过程将对三个测试用例中的每一个，使用它们各自的特定参数和数据进行计算，得出最终的数值结果。", "answer": "$$ \\boxed{[1.328330,0.916960,1.077271]} $$", "id": "2539206"}]}