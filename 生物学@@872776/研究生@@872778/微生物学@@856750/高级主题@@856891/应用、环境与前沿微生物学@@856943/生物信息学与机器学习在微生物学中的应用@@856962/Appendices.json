{"hands_on_practices": [{"introduction": "任何微生物基因组学项目的基石都是测序数据的生成。然而，仅仅产生读长（reads）是不够的；我们必须理解测序深度（coverage）与我们检测基因组中每个碱基的能力之间的关系。本练习将引导您从第一性原理出发，推导鸟枪法测序中的核心统计量，阐明如何使用泊松（Poisson）模型来量化测序实验的完整性。通过这个实践[@problem_id:2479969]，您将掌握评估测序数据覆盖度的基本技能，这对于实验设计和后续分析至关重要。", "problem": "在一个使用新一代测序（NGS）的全基因组鸟枪法实验中，考虑一个长度为 $G = 4.6 \\times 10^{6}$ 个碱基对（bp）的环状细菌基因组。实验测序了固定长度为 $L = 150$ bp 的单端读段，并在基因组上独立且均匀随机地生成了 $N = 153{,}334$ 个读段起始位置。如果一个碱基位于某个读段起始坐标下游的跨度内，则称该碱基被该读段覆盖，由于基因组是环状的，需要考虑环绕效应。\n\n仅从核心抽样模型（环状基因组上独立同分布的均匀读段起始）、单个读段是否覆盖一个固定碱基的伯努利指示变量、在 $N$ 次试验中覆盖读段数量的二项分布，以及著名的针对稀有事件的二项分布到泊松分布的极限出发，从第一性原理推导：\n1) 一个随机选择的碱基上的期望测序深度（覆盖度），以及\n2) 在泊松模型下，一个随机选择的碱基未被覆盖的概率。\n\n按期望覆盖度、零覆盖概率的顺序将您的最终结果报告为两个数字。将两个数字均四舍五入到四位有效数字。将覆盖度表示为无量纲的倍数值，将概率表示为小数。", "solution": "该问题要求从第一性原理推导两个量：期望测序深度（覆盖度）和一个碱基未被覆盖的概率。\n\n首先，我们定义给定的参数：\n- 基因组长度为 $G = 4.6 \\times 10^{6}$ 个碱基对。\n- 读段长度为 $L = 150$ 个碱基对。\n- 测序的读段数量为 $N = 153{,}334$。\n\n模型假设读段的起始位置在环状基因组上是独立且均匀分布的。\n\n**1. 期望测序深度（$\\lambda$）的推导**\n\n让我们考虑基因组上一个任意固定的碱基。为了使这个碱基被一个长度为 $L$ 的单次读段所覆盖，该读段的起始位置必须落在该碱基“上游”一个长度为 $L$ 的特定窗口内。由于基因组的环状特性，可能的起始位置总数为 $G$。导致我们选择的碱基被覆盖的起始位置区间长度为 $L$。\n\n因此，一个随机放置的读段覆盖我们所选碱基的概率 $p$ 是有利区域长度与总基因组长度的比值：\n$$p = \\frac{L}{G}$$\n\n现在，我们为每个读段 $i \\in \\{1, 2, \\ldots, N\\}$ 定义一个伯努利指示随机变量 $I_i$。如果读段 $i$ 覆盖了该固定碱基，则该变量取值为 $1$，否则为 $0$。\n$$I_i = \\begin{cases} 1  \\text{如果读段 } i \\text{ 覆盖该碱基} \\\\ 0  \\text{否则} \\end{cases}$$\n这个伯努利试验的成功概率是 $P(I_i=1) = p = \\frac{L}{G}$。该指示变量的期望值是 $E[I_i] = 1 \\cdot P(I_i=1) + 0 \\cdot P(I_i=0) = p$。\n\n特定碱基上的总覆盖深度 $C$ 是覆盖它的读段总数。这是所有 $N$ 个读段的指示变量之和：\n$$C = \\sum_{i=1}^{N} I_i$$\n期望测序深度，我们记为 $\\lambda$，是 $C$ 的期望值。根据期望的线性性质，我们有：\n$$\\lambda = E[C] = E\\left[\\sum_{i=1}^{N} I_i\\right] = \\sum_{i=1}^{N} E[I_i]$$\n由于读段是独立同分布的（i.i.d.），对所有的 $i$，$E[I_i]$ 的期望都是相同的。因此：\n$$\\lambda = N \\cdot E[I_1] = N \\cdot p = \\frac{NL}{G}$$\n这个表达式给出了在任何随机选择的碱基上的期望覆盖度。\n\n代入给定的数值：\n$$\\lambda = \\frac{153{,}334 \\times 150}{4.6 \\times 10^{6}} = \\frac{23{,}000{,}100}{4{,}600{,}000} \\approx 5.000021739$$\n四舍五入到四位有效数字，期望覆盖度为 $5.000$。这是一个无量纲的量，表示一个碱基被测序的平均次数，通常称为“覆盖倍数”。\n\n**2. 碱基未被覆盖概率的推导**\n\n题目指定我们必须使用二项分布到泊松分布的极限。覆盖数 $C = \\sum_{i=1}^{N} I_i$ 是 $N$ 次独立同分布的伯努利试验之和。因此，$C$ 服从二项分布，$C \\sim \\text{Binomial}(N, p)$。\n其概率质量函数（PMF）为：\n$$P(C=k) = \\binom{N}{k} p^k (1-p)^{N-k}$$\n二项分布的泊松近似在 $N$ 很大，$p$ 很小，并且它们的乘积 $\\lambda = Np$ 是一个有限的、中等大小的值时是有效的。让我们验证这些条件：\n- $N = 153{,}334$ 很大。\n- $p = \\frac{L}{G} = \\frac{150}{4.6 \\times 10^6} \\approx 3.26 \\times 10^{-5}$ 很小。\n- $\\lambda = Np \\approx 5.000$ 是一个中等大小的常数。\n\n条件得到满足。因此，我们可以用参数为 $\\lambda = \\frac{NL}{G}$ 的泊松分布来近似覆盖数 $C$ 的二项分布。\n$$P(C=k) \\approx \\frac{e^{-\\lambda} \\lambda^k}{k!}$$\n一个随机选择的碱基未被覆盖的概率是其覆盖数为零的概率，即 $P(C=0)$。\n使用 $k=0$ 的泊松概率质量函数：\n$$P(C=0) = \\frac{e^{-\\lambda} \\lambda^0}{0!}$$\n由于 $\\lambda^0 = 1$ 且 $0! = 1$，这可以简化为：\n$$P(C=0) = e^{-\\lambda}$$\n使用先前计算的 $\\lambda$ 值：\n$$P(C=0) = \\exp\\left(-\\frac{NL}{G}\\right) \\approx \\exp(-5.000021739)$$\n$$P(C=0) \\approx 0.00673780$$\n将此概率四舍五入到四位有效数字，我们得到 $0.006738$。\n\n总结如下：\n期望覆盖度为 $\\lambda = \\frac{NL}{G} \\approx 5.000021739$，四舍五入为 $5.000$。\n零覆盖概率为 $e^{-\\lambda} \\approx 0.00673780$，四舍五入为 $0.006738$。", "answer": "$$\\boxed{\\begin{pmatrix} 5.000 & 0.006738 \\end{pmatrix}}$$", "id": "2479969"}, {"introduction": "从数百万条短读长中拼接出完整的基因组序列，是生物信息学中的一项核心挑战。得到的拼接结果只是对真实基因组结构的一个计算假设，因此，评估其质量至关重要。本练习将向您介绍评估基因组拼接连续性和准确性的行业标准指标，如 $N50$ 和 $NG50$。通过计算这些关键统计数据[@problem_id:2479883]，您将亲身体会到在拼接过程中，连续性（contiguity）与准确性（accuracy）之间固有的权衡，并学会如何定量地描述一个拼接草图的质量。", "problem": "一个具有中等复杂度基因组的细菌分离株，通过短读长和长读长进行组装，然后使用图神经网络 (GNN) 支架构建工具进行支架构建。给定一个草图组装，其中包含多个重叠群及其以碱基对 (bp) 为单位的长度，以及每个重叠群中被一个基于比对的评估工具标记为错误组装的碱基数。估计的单倍体基因组大小为 $G = 6{,}400{,}000$ bp。该组装包含以下重叠群 (每项列出了该重叠群的长度及其错误组装的碱基数)：\n- $980{,}000$ bp，其中 $2{,}100$ bp 为错误组装\n- $760{,}000$ bp，其中 $1{,}900$ bp 为错误组装\n- $610{,}000$ bp，其中 $1{,}600$ bp 为错误组装\n- $540{,}000$ bp，其中 $1{,}200$ bp 为错误组装\n- $480{,}000$ bp，其中 $1{,}000$ bp 为错误组装\n- $420{,}000$ bp，其中 $800$ bp 为错误组装\n- $360{,}000$ bp，其中 $700$ bp 为错误组装\n- $300{,}000$ bp，其中 $500$ bp 为错误组装\n- $240{,}000$ bp，其中 $400$ bp 为错误组装\n- $180{,}000$ bp，其中 $300$ bp 为错误组装\n- $120{,}000$ bp，其中 $200$ bp 为错误组装\n- $80{,}000$ bp，其中 $150$ bp 为错误组装\n\n遵循以下标准且广泛使用的定义：\n- 组装 $N50$ 是指这样一个重叠群长度 $L$，使得所有长度不小于 $L$ 的重叠群的长度总和至少是总组装长度的一半。\n- 基于基因组的 $NG50$ 的定义与此类似，但使用参考基因组大小的一半 $G/2$ 来代替总组装长度的一半。\n- 在本问题中，错误组装率 $r$ 定义为被标记为错误组装的碱基占总组装碱基的比例，即 $r = \\left(\\sum m_i\\right) \\big/ \\left(\\sum \\ell_i\\right)$，其中 $\\ell_i$ 和 $m_i$ 分别是重叠群 $i$ 的长度和错误组装的碱基数。\n\n任务：\n1. 计算总组装长度，然后根据上述定义确定 $N50$ 和 $NG50$。\n2. 根据上述定义计算错误组装率 $r$。\n3. 从基本原理出发，简要分析在机器学习支架构建的背景下，$N50$、$NG50$ 和 $r$ 如何共同反映连续性与准确性之间的权衡，并解释当组装相对于 $G$ 不完整时，为什么 $NG50$ 会与 $N50$ 不同。\n4. 定义连续性得分 $S_c = \\dfrac{N50 + NG50}{2G}$ 和准确性得分 $S_a = 1 - r$。然后将综合质量指数定义为调和平均数 $Q = \\dfrac{2}{\\dfrac{1}{S_c} + \\dfrac{1}{S_a}}$。计算 $Q$。\n\n将 $Q$ 的最终答案表示为四舍五入到四位有效数字的小数。最终答案中不包含任何单位。", "solution": "该问题要求计算几个组装质量指标和一个综合质量指数。设重叠群集合由 $i$ 索引，其中 $\\ell_i$ 是重叠群 $i$ 的长度，$m_i$ 是其中的错误组装碱基数。给定的估计基因组大小为 $G = 6{,}400{,}000$ 碱基对 (bp)。\n\n首先，我们必须计算总组装长度，即所有重叠群长度的总和 $\\sum_{i} \\ell_i$。给定的重叠群长度为： $980{,}000$、$760{,}000$、$610{,}000$、$540{,}000$、$480{,}000$、$420{,}000$、$360{,}000$、$300{,}000$、$240{,}000$、$180{,}000$、$120{,}000$ 和 $80{,}000$。\n$$\n\\sum_{i} \\ell_i = 980{,}000 + 760{,}000 + \\dots + 80{,}000 = 5{,}070{,}000 \\text{ bp}\n$$\n组装好的重叠群的总长度为 $5{,}070{,}000$ bp。\n\n任务1：计算 $N50$ 和 $NG50$。\n为了计算 $N50$ 值，我们首先确定阈值，即总组装长度的一半：\n$$\n\\frac{1}{2} \\sum_{i} \\ell_i = \\frac{5{,}070{,}000}{2} = 2{,}535{,}000 \\text{ bp}\n$$\n接下来，我们将重叠群按长度降序排列（它们已经按此顺序提供），并计算其长度的累积和。\n1. $\\ell_1 = 980{,}000$\n2. $\\sum_{i=1}^{2} \\ell_i = 980{,}000 + 760{,}000 = 1{,}740{,}000$\n3. $\\sum_{i=1}^{3} \\ell_i = 1{,}740{,}000 + 610{,}000 = 2{,}350{,}000$\n4. $\\sum_{i=1}^{4} \\ell_i = 2{,}350{,}000 + 540{,}000 = 2{,}890{,}000$\n在包含第四个重叠群后，累积和首次超过 $2{,}535{,}000$ bp 的阈值。$N50$ 即为该重叠群的长度 $\\ell_4$。\n$$\nN50 = 540{,}000 \\text{ bp}\n$$\n为了计算 $NG50$ 值，阈值是估计基因组大小 $G$ 的一半：\n$$\n\\frac{G}{2} = \\frac{6{,}400{,}000}{2} = 3{,}200{,}000 \\text{ bp}\n$$\n使用相同的累积和：\n4. $\\sum_{i=1}^{4} \\ell_i = 2{,}890{,}000$\n5. $\\sum_{i=1}^{5} \\ell_i = 2{,}890{,}000 + 480{,}000 = 3{,}370{,}000$\n在包含第五个重叠群后，累积和首次超过 $3{,}200{,}000$ bp 的阈值。$NG50$ 即为该重叠群的长度 $\\ell_5$。\n$$\nNG50 = 480{,}000 \\text{ bp}\n$$\n\n任务2：计算错误组装率 $r$。\n首先，我们对错误组装的碱基数 $m_i$ 求和：\n$$\n\\sum_{i} m_i = 2{,}100 + 1{,}900 + 1{,}600 + 1{,}200 + 1{,}000 + 800 + 700 + 500 + 400 + 300 + 200 + 150 = 10{,}850 \\text{ bp}\n$$\n错误组装率 $r$ 是错误组装碱基总数与总组装长度的比值：\n$$\nr = \\frac{\\sum_{i} m_i}{\\sum_{i} \\ell_i} = \\frac{10{,}850}{5{,}070{,}000}\n$$\n\n任务3：分析连续性与准确性之间的权衡。\n在基因组组装中，特别是在使用像 GNN 这样的机器学习模型进行支架构建时，存在一个基本的权衡。以 $N50$ 和 $NG50$ 等指标衡量的连续性，反映了短重叠群被连接成更长序列的程度。一个激进的支架构建算法可能会在重叠群之间提出许多连接，从而增加最终支架的长度，进而提高 $N50/NG50$。然而，这种激进性增加了产生错误连接（即错误组装）的风险。错误组装的增加会提高错误组装率 $r$，这标志着准确性的下降。因此，追求最大的连续性可能会损害准确性，反之，为避免错误组装而采取的保守方法可能导致组装更碎片化，连续性更低。指标对 $(N50, r)$ 或 $(NG50, r)$ 定量地捕捉了这种二元性。\n$N50$ 和 $NG50$ 之间的差异源于它们的归一化基准不同。$N50$ 是一个内部质量度量，相对于组装本身的大小 ($\\sum \\ell_i$)。$NG50$ 是一个外部度量，相对于一个独立的基因组大小估计值 ($G$)。当组装不完整时，如此处 $\\sum \\ell_i = 5{,}070{,}000  G = 6{,}400{,}000$，$N50$ 的阈值 ($\\frac{1}{2}\\sum \\ell_i$) 会低于 $NG50$ 的阈值 ($\\frac{G}{2}$)。这可能导致 $N50 \\ge NG50$，正如本例所观察到的 ($540{,}000 > 480{,}000$)。\n\n任务4：计算综合质量指数 $Q$。\n首先，我们计算连续性得分 $S_c$ 和准确性得分 $S_a$。\n连续性得分 $S_c$ 定义为：\n$$\nS_c = \\frac{N50 + NG50}{2G} = \\frac{540{,}000 + 480{,}000}{2 \\times 6{,}400{,}000} = \\frac{1{,}020{,}000}{12{,}800{,}000} = \\frac{102}{1280} = \\frac{51}{640}\n$$\n数值上，$S_c = 0.0796875$。\n\n准确性得分 $S_a$ 定义为 $1 - r$：\n$$\nS_a = 1 - r = 1 - \\frac{10{,}850}{5{,}070{,}000} = \\frac{5{,}070{,}000 - 10{,}850}{5{,}070{,}000} = \\frac{5{,}059{,}150}{5{,}070{,}000} = \\frac{101183}{101400}\n$$\n数值上，$S_a \\approx 0.9978609467$。\n\n最后，综合质量指数 $Q$ 是 $S_c$ 和 $S_a$ 的调和平均数：\n$$\nQ = \\frac{2}{\\frac{1}{S_c} + \\frac{1}{S_a}} = \\frac{2S_c S_a}{S_c + S_a}\n$$\n代入分数值：\n$$\nQ = \\frac{2}{\\frac{640}{51} + \\frac{101400}{101183}}\n$$\n我们进行数值计算：\n$$\nQ = \\frac{2}{12.5490196\\dots + 1.0021446\\dots} = \\frac{2}{13.5511642\\dots} \\approx 0.1475880\n$$\n按要求将此结果四舍五入到四位有效数字，我们得到：\n$$\nQ \\approx 0.1476\n$$", "answer": "$$\n\\boxed{0.1476}\n$$", "id": "2479883"}, {"introduction": "一旦基因组被成功拼接和注释，我们就可以开始回答更深层次的生物学问题，例如微生物如何适应其环境。分子进化分析提供了一套强大的工具来探索基因层面的选择压力。本练习将重点关注 $d_N/d_S$ 比率（即 $\\omega$），这是检测基因编码区自然选择印记的经典指标。您将实现一个基于 Nei-Gojobori 模型的简化方法来计算此比率[@problem_id:2479914]，并学习如何根据其值（$\\omega \\lt 1$, $\\omega = 1$, 或 $\\omega \\gt 1$）来推断纯化选择、中性进化或正选择。", "problem": "给定一个存在于多个细菌菌株中的基因家族。对于每个基因，我们已经分析了其在各菌株间的比对，以计算观察到的非同义替换和同义替换的数量，并根据密码子结构估算非同义位点和同义位点的数量（机会）。假设遵循分子生物学中心法则，即脱氧核糖核酸（DNA）中的密码子编码氨基酸，非同义替换会改变编码的氨基酸，而同义替换则不会。在一个均一、时间可逆、所有核苷酸之间碱基频率相等且替换速率相等的核苷酸替换过程中，$1969$ 年的 Jukes–Cantor 模型为同一位点上发生的多次替换（multiple hits）提供了校正。在 $1986$ 年 Nei–Gojobori 的近似密码子计数框架中，非同义和同义类别的距离是通过将 Jukes–Cantor 校正分别应用于各类别的每个位点上观察到的差异比例来推导的。\n\n您必须实现一个程序，该程序为每个测试用例计算非同义距离 $d_N$、同义距离 $d_S$ 以及它们的比率 $\\omega = d_N/d_S$。设 $x_N$ 为观察到的非同义替换数，$x_S$ 为观察到的同义替换数，$n_N$ 为非同义位点总数，$n_S$ 为同义位点总数。当计数值很小或为零时，应用 Haldane–Anscombe 连续性校正来稳健地估计比例，方法如下：\n$$\n\\hat{p}_N = \\frac{x_N + 0.5}{n_N + 1}, \\qquad \\hat{p}_S = \\frac{x_S + 0.5}{n_S + 1}.\n$$\n然后为每个类别计算 Jukes–Cantor 校正距离：\n$$\nd_N = -\\frac{3}{4}\\ln\\left(1 - \\frac{4}{3}\\hat{p}_N\\right), \\qquad d_S = -\\frac{3}{4}\\ln\\left(1 - \\frac{4}{3}\\hat{p}_S\\right).\n$$\n使用围绕中性状态的对称容差参数 $\\tau$ 来定义选择模式：\n- 纯化选择，如果 $\\omega \\leq 1 - \\tau$，\n- 中性选择，如果 $1 - \\tau  \\omega  1 + \\tau$，\n- 正选择，如果 $\\omega \\geq 1 + \\tau$。\n\n为确保数值稳定性，如果 $\\hat{p}_N$ 或 $\\hat{p}_S$ 使得 Jukes–Cantor 公式的对数参数为非正数，则将相应的 $\\hat{p}$ 值限制在一个比 $\\frac{3}{4}$ 略小一个可忽略差值的值，以确保对数有定义。\n\n您的程序必须实现上述逻辑，并将其应用于以下测试套件。每个测试用例都是一个四元组 $(x_N, x_S, n_N, n_S)$，容差参数为 $\\tau = 0.1$：\n- 测试用例 $1$：$(x_N, x_S, n_N, n_S) = (12, 25, 5000, 1500)$。\n- 测试用例 $2$：$(x_N, x_S, n_N, n_S) = (80, 5, 4000, 2000)$。\n- 测试用例 $3$：$(x_N, x_S, n_N, n_S) = (30, 10, 3000, 1000)$。\n- 测试用例 $4$：$(x_N, x_S, n_N, n_S) = (0, 0, 500, 500)$。\n- 测试用例 $5$：$(x_N, x_S, n_N, n_S) = (14, 10, 20, 300)$。\n\n输出规范：\n- 对于每个测试用例，生成一个形式为 $[\\omega, d_N, d_S, r]$ 的列表，其中 $\\omega$、$d_N$ 和 $d_S$ 是四舍五入到 6 位小数的浮点数，而 $r$ 是一个整数模式代码，-1 代表纯化选择，0 代表中性选择，+1 代表正选择。\n- 您的程序应生成单行输出，包含所有测试用例的结果。该输出是一个用方括号括起来的逗号分隔列表，其中每个元素是上面定义的每个测试用例的列表（例如，一个列表的列表，中间没有任何文本）。不涉及角度计算，也无需报告物理单位。所有数值答案均为不带百分号的纯数字。", "solution": "目标是计算非同义与同义替换速率的比率 $\\omega$，并对作用于基因的自然选择模式进行分类。这是通过对每个测试用例遵循一个精确的算法流程来实现的。\n\n计算过程分为四个步骤：\n\n首先，根据原始计数估计非同义差异的比例 $\\hat{p}_N$ 和同义差异的比例 $\\hat{p}_S$，并应用 Haldane–Anscombe 连续性校正以避免因计数值小或为零而产生的问题：\n$$\n\\hat{p}_N = \\frac{x_N + 0.5}{n_N + 1}\n$$\n$$\n\\hat{p}_S = \\frac{x_S + 0.5}{n_S + 1}\n$$\n\n其次，我们使用 Jukes–Cantor 模型对这些观察到的比例进行校正，以考虑多次替换。进化距离 $d_N$ 和 $d_S$ 分别为：\n$$\nd_N = -\\frac{3}{4}\\ln\\left(1 - \\frac{4}{3}\\hat{p}_N\\right)\n$$\n$$\nd_S = -\\frac{3}{4}\\ln\\left(1 - \\frac{4}{3}\\hat{p}_S\\right)\n$$\n为保证数值稳定性，如果 $\\hat{p}$ 大于或等于饱和阈值 $\\frac{3}{4}$，则将其值限制在一个略小于该阈值的值。\n\n第三，我们计算比率 $\\omega = d_N/d_S$。该比率是衡量作用于蛋白质编码基因选择压力的指标。$\\omega=1$ 表示中性进化，$\\omega  1$ 表示纯化选择，$\\omega > 1$ 表示正选择。\n\n第四，我们根据 $\\omega$ 值和容差参数 $\\tau = 0.1$ 对选择模式进行分类：\n- 纯化选择 (代码-1)：如果 $\\omega \\leq 0.9$。\n- 中性进化 (代码0)：如果 $0.9  \\omega  1.1$。\n- 正选择 (代码+1)：如果 $\\omega \\geq 1.1$。\n\n将此流程应用于所有测试用例，即可得到最终结果。", "answer": "[[0.126584,0.002501,0.019757,-1],[5.309038,0.021078,0.00397,1],[0.998495,0.01006,0.010076,0],[1.0,0.00075,0.00075,0],[14.28828,0.496224,0.03473,1]]", "id": "2479914"}]}