{"hands_on_practices": [{"introduction": "我们的实践探索始于一个奠基性的生态学模型。通过推导MacArthur-Wilson的岛屿生物地理学平衡模型，我们能深入理解决定一个地区物种丰富度的基本力量——即迁入和灭绝之间的动态平衡。这项练习旨在训练你从一个描述系统动态的微分方程出发，解析出其稳态解，并解读模型参数如何影响生物多样性的能力 [@problem_id:2805206]。", "problem": "在一个岛屿上，根据 MacArthur–Wilson 的岛屿生物地理学框架，有来自大陆物种库的物种进行定殖。设 $S(t)$ 表示在时间 $t$ 岛上的物种数量，$S_{max}$ 表示岛屿可及的大陆物种库的大小，$I$ 表示当岛屿为空时的最大迁入率，$E$ 表示当岛屿被物种库中的物种饱和时的最大灭绝率。假设迁入率随 $S$ 线性下降，灭绝率随 $S$ 线性增加，得到以下常微分方程\n$$\n\\frac{dS}{dt} \\;=\\; I\\!\\left(1 - \\frac{S}{S_{max}}\\right) \\;-\\; E\\,\\frac{S}{S_{max}}.\n$$\n仅从平衡态的定义（即 $\\frac{dS}{dt}=0$ 的状态）和线性函数的代数性质出发，推导平衡态物种丰富度 $S^{*}$ 关于 $I$、$E$ 和 $S_{max}$ 的封闭形式表达式。然后，利用第一性原理，定性解释当 $I$、$E$ 和 $S_{max}$ 中每一个参数在其他参数保持不变的情况下增加时，$S^{*}$ 如何变化，明确说明响应是增加还是减少，以及它是否表现出收益递减或成比例缩放。以其最简封闭形式给出 $S^{*}$ 的最终表达式。不需要进行数值计算。", "solution": "对问题陈述进行验证。\n\n步骤 1：提取已知条件。\n- 岛上在时间 $t$ 的物种数量表示为 $S(t)$。\n- 岛屿可及的大陆物种库的大小为 $S_{max}$。\n- 当岛屿为空（$S=0$）时的最大迁入率为 $I$。\n- 当岛屿饱和（$S=S_{max}$）时的最大灭绝率为 $E$。\n- 控制常微分方程为：\n$$\n\\frac{dS}{dt} = I\\left(1 - \\frac{S}{S_{max}}\\right) - E\\frac{S}{S_{max}}\n$$\n- 平衡态的定义是 $\\frac{dS}{dt}=0$ 的状态。\n- 任务是推导平衡态物种丰富度 $S^{*}$ 关于 $I$、$E$ 和 $S_{max}$ 的封闭形式表达式。\n- 任务还要求定性解释当 $I$、$E$ 和 $S_{max}$ 单独增加时，$S^{*}$ 如何变化。\n\n步骤 2：使用提取的已知条件进行验证。\n根据验证标准对问题进行评估。\n- **科学依据**：该问题基于 MacArthur–Wilson 的岛屿生物地理学模型，这是生态学中一个基础且成熟的理论。迁入率和灭绝率对物种丰富度的线性依赖关系是该模型最初、最简单的表述。因此，该问题在科学上是合理的。\n- **适定性**：该问题提供了一个一阶常微分方程，并要求求解其平衡点。寻找平衡点需要将导数设为零并解一个代数方程。所得方程对于目标变量 $S^{*}$ 是线性的，保证了唯一解的存在。该问题是适定的。\n- **客观性**：该问题使用精确的数学语言陈述，变量和参数定义清晰。它没有主观或含糊的术语。\n- **完整性与一致性**：该问题是自洽的。推导平衡表达式和分析其性质所需的所有信息都已提供。没有矛盾之处。\n\n步骤 3：结论与行动。\n该问题在科学上有效、适定、客观且完整。这是理论生态学中的一个标准练习。现在开始求解过程。\n\n推导从给定的微分方程开始，该方程模拟了岛上物种丰富度 $S$ 的变化率：\n$$\n\\frac{dS}{dt} = I\\left(1 - \\frac{S}{S_{max}}\\right) - E\\frac{S}{S_{max}}\n$$\n第一项 $I\\left(1 - \\frac{S}{S_{max}}\\right)$ 代表新物种的迁入率。当岛屿为空（$S=0$）时，它达到最大值 $I$，并随着物种数量接近大陆物种库大小（$S=S_{max}$）而线性下降至 $0$。第二项 $E\\frac{S}{S_{max}}$ 代表已存在物种的灭绝率。当岛屿为空（$S=0$）时，它为 $0$，并随着岛屿被物种饱和（$S=S_{max}$）而线性增加至最大值 $E$。\n\n平衡态被定义为物种数量不再变化的状态，即变化率为零。在平衡态下，物种丰富度表示为 $S^{*}$。我们应用这个条件：\n$$\n\\frac{dS}{dt} \\bigg|_{S=S^{*}} = 0\n$$\n这意味着迁入率必须与灭绝率完全平衡。将控制方程的右侧设为 $0$：\n$$\nI\\left(1 - \\frac{S^{*}}{S_{max}}\\right) - E\\frac{S^{*}}{S_{max}} = 0\n$$\n这是一个关于 $S^{*}$ 的线性代数方程。我们现在必须用给定的参数 $I$、$E$ 和 $S_{max}$ 来求解 $S^{*}$。首先，展开项 $I$：\n$$\nI - \\frac{I S^{*}}{S_{max}} - \\frac{E S^{*}}{S_{max}} = 0\n$$\n分离不含 $S^{*}$ 的项：\n$$\nI = \\frac{I S^{*}}{S_{max}} + \\frac{E S^{*}}{S_{max}}\n$$\n在右侧提取公因式 $S^{*}$：\n$$\nI = S^{*} \\left( \\frac{I}{S_{max}} + \\frac{E}{S_{max}} \\right)\n$$\n通过提取 $\\frac{1}{S_{max}}$ 进一步简化：\n$$\nI = S^{*} \\frac{I + E}{S_{max}}\n$$\n最后，为了得到 $S^{*}$ 的表达式，我们将两边同时乘以 $S_{max}$ 并除以 $(I+E)$：\n$$\nS^{*} = \\frac{I S_{max}}{I + E}\n$$\n这就是平衡态物种丰富度的封闭形式表达式。\n\n任务的第二部分是定性解释 $S^{*}$ 如何响应每个参数的变化。我们使用推导出的 $S^{*}$ 表达式并分析其偏导数。\n\n1.  **对迁入率 ($I$) 的依赖性**：\n    为了确定 $S^{*}$ 如何随 $I$ 变化，我们计算偏导数 $\\frac{\\partial S^{*}}{\\partial I}$：\n    $$\n    \\frac{\\partial S^{*}}{\\partial I} = \\frac{\\partial}{\\partial I} \\left( \\frac{I S_{max}}{I + E} \\right)\n    $$\n    使用导数的商法则，$\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u'v - uv'}{v^2}$：\n    $$\n    \\frac{\\partial S^{*}}{\\partial I} = \\frac{(S_{max})(I+E) - (I S_{max})(1)}{(I+E)^2} = \\frac{I S_{max} + E S_{max} - I S_{max}}{(I+E)^2} = \\frac{E S_{max}}{(I+E)^2}\n    $$\n    由于参数 $E$ 和 $S_{max}$ 代表物理量（灭绝率和物种库大小），它们必须是正的（$E>0$, $S_{max}>0$）。分母 $(I+E)^2$ 也严格为正。因此，$\\frac{\\partial S^{*}}{\\partial I} > 0$，这意味着 **$S^{*}$ 是 $I$ 的增函数**。\n    为了确定这种增加的性质（例如，收益递减），我们考察二阶偏导数 $\\frac{\\partial^2 S^{*}}{\\partial I^2}$：\n    $$\n    \\frac{\\partial^2 S^{*}}{\\partial I^2} = \\frac{\\partial}{\\partial I} \\left( \\frac{E S_{max}}{(I+E)^2} \\right) = E S_{max} \\frac{\\partial}{\\partial I} (I+E)^{-2} = E S_{max} \\left( -2(I+E)^{-3} \\cdot 1 \\right) = \\frac{-2 E S_{max}}{(I+E)^3}\n    $$\n    由于 $E>0, S_{max}>0$ 且 $I+E>0$，二阶导数为负。一阶导数为正且二阶导数为负表示一个凹函数。这表明存在**收益递减**：最大迁入率 $I$ 的每一次增量增加，都会导致平衡态物种丰富度 $S^{*}$ 的增量越来越小。\n\n2.  **对灭绝率 ($E$) 的依赖性**：\n    我们计算偏导数 $\\frac{\\partial S^{*}}{\\partial E}$：\n    $$\n    \\frac{\\partial S^{*}}{\\partial E} = \\frac{\\partial}{\\partial E} \\left( \\frac{I S_{max}}{I + E} \\right) = I S_{max} \\frac{\\partial}{\\partial E} (I+E)^{-1} = I S_{max} \\left( -1(I+E)^{-2} \\cdot 1 \\right) = \\frac{-I S_{max}}{(I+E)^2}\n    $$\n    由于 $I>0$ 且 $S_{max}>0$，分子为负，分母为正。因此，$\\frac{\\partial S^{*}}{\\partial E}  0$，这意味着 **$S^{*}$ 是 $E$ 的减函数**。\n    为了评估这种减少的性质，我们考察二阶偏导数 $\\frac{\\partial^2 S^{*}}{\\partial E^2}$：\n    $$\n    \\frac{\\partial^2 S^{*}}{\\partial E^2} = \\frac{\\partial}{\\partial E} \\left( \\frac{-I S_{max}}{(I+E)^2} \\right) = -I S_{max} \\frac{\\partial}{\\partial E} (I+E)^{-2} = -I S_{max} \\left( -2(I+E)^{-3} \\cdot 1 \\right) = \\frac{2 I S_{max}}{(I+E)^3}\n    $$\n    由于 $I0, S_{max}0$ 且 $I+E0$，这个二阶导数为正。一阶导数为负且二阶导数为正表示一个凸函数。$E$ 的增加导致 $S^{*}$ 的减少，但随着 $E$ 变大，这种减少的幅度变小。这也是一种对灭绝负面影响的**收益递减**形式。\n\n3.  **对大陆物种库大小 ($S_{max}$) 的依赖性**：\n    我们计算偏导数 $\\frac{\\partial S^{*}}{\\partial S_{max}}$：\n    $$\n    \\frac{\\partial S^{*}}{\\partial S_{max}} = \\frac{\\partial}{\\partial S_{max}} \\left( \\frac{I S_{max}}{I + E} \\right) = \\frac{I}{I+E}\n    $$\n    项 $\\frac{I}{I+E}$ 相对于 $S_{max}$ 被视为常数。由于 $I0$ 且 $E \\ge 0$，该导数是一个正常数。因此，**$S^{*}$ 是 $S_{max}$ 的增函数**。\n    二阶偏导数为：\n    $$\n    \\frac{\\partial^2 S^{*}}{\\partial S_{max}^2} = \\frac{\\partial}{\\partial S_{max}} \\left( \\frac{I}{I+E} \\right) = 0\n    $$\n    二阶导数为零表示线性关系。这意味着 $S^{*}$ 相对于 $S_{max}$ 表现出**成比例缩放**。平衡态物种数量是总可用物种库的一个固定比例，即 $\\frac{I}{I+E}$。\n\n总而言之，平衡态物种丰富度随着迁入率的增大而增加（但有收益递减），随着灭绝率的增大而减少（负面影响有收益递减），并随着大陆物种库的大小成比例增加。", "answer": "$$\n\\boxed{\\frac{I S_{max}}{I + E}}\n$$", "id": "2805206"}, {"introduction": "在理解了物种分布的宏观模式后，我们转向演化过程的微观层面，即区分同源性与同功性（趋同演化）。本练习通过一个精确的概率模型，向你展示如何量化一个关键的演化事件：两个谱系独立演化出相同衍生性状的概率。掌握这个基于马尔可夫模型的计算，对于在系统发育背景下严谨地定义和识别趋同演化至关重要 [@problem_id:2805187]。", "problem": "某个蜥蜴分支的两个岛屿谱系表现出一个具有状态 $0$ 或 $1$ 的二元形态特征。来自这两个谱系最近共同祖先 (MRCA) 的一块年代明确的化石表明，在分化之时（发生于 $t$ 个时间单位之前），祖先状态为 $0$。假设沿着每个后代谱系，该特征在对称马尔可夫 $k$ 状态 (Mk) 模型（其中 $k=2$）下，作为一个时间同质的连续时间马尔可夫过程演化，状态间的瞬时谱系转变速率为 $q$。两个后代分支的长度相等，均为 $t$，并且在以 MRCA 的祖先状态为条件下，两个分支上的演化历史是独立的。\n\n为了在生物地理学背景下区分同源性与趋同性，将“因趋同而非遗传导致的相同状态”定义为这样一个事件：观察到两个末端分类单元在当前时刻共享相同的衍生状态 $1$，尽管它们的 MRCA 在分化时的状态为 $0$。\n\n在上述假设下，推导该事件的概率，以 $q$ 和 $t$ 的闭式表达式表示。\n\n你的最终答案必须是单一的解析表达式。不要进行近似或四舍五入。", "solution": "对所述问题进行验证。\n\n**步骤 1：提取已知条件**\n- 某个蜥蜴分支的两个岛屿谱系。\n- 一个具有状态 {$0$, $1$} 的二元形态特征。\n- 分化时最近共同祖先 (MRCA) 的状态：状态 $0$。\n- 自上次分化以来的时间：$t$ 个时间单位。\n- 演化模型：时间同质的连续时间马尔可夫过程。\n- 具体模型：对称马尔可夫 $k$ 状态 (Mk) 模型，其中 $k=2$。\n- 状态间的瞬时谱系转变速率：$q$。\n- 分支长度：两个后代分支的长度相等，均为 $t$。\n- 独立性：在 MRCA 状态的条件下，两个分支上的演化历史是独立的。\n- 关注事件：“因趋同而非遗传导致的相同状态”，其定义为“观察到两个末端分类单元在当前时刻共享相同的衍生状态 $1$，尽管它们的 MRCA 在分化时的状态为 $0$。”\n- 目标：推导该事件的概率，以 $q$ 和 $t$ 的闭式表达式表示。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题使用了连续时间马尔可夫链，特别是对称 2 状态 (Mk) 模型，这是系统发育比较方法和分子演化中的一个标准和基础工具。该框架在科学上是合理的。\n- **适定性**：该问题是适定的。它提供了所有必要的参数（$q$，$t$）、初始条件（祖先状态为 $0$），以及一个精确定义的需要计算的概率事件。可以确定唯一的解。\n- **客观性**：该问题以精确、客观的语言陈述，没有歧义或主观论断。为了计算的目的，对“趋同”的概念给出了一个严格、形式化的定义。\n\n**步骤 3：结论与行动**\n问题有效。这是随机过程在演化生物学中应用的一个标准练习。将推导解答。\n\n单个谱系上二元特征的演化由一个对称的 2 状态连续时间马尔可夫过程描述。状态为 {$0, 1$}。从状态 $i$ 到状态 $j$ ($i \\neq j$) 的瞬时变化速率为 $q$。因此，无穷小生成元矩阵（或称速率矩阵）$Q$ 为：\n$$\nQ = \\begin{pmatrix} -q  q \\\\ q  -q \\end{pmatrix}\n$$\n在长度为 $t$ 的时间间隔内，从状态 $i$ 转变到状态 $j$ 的概率由矩阵项 $[P(t)]_{ij}$ 给出，其中 $P(t) = \\exp(Qt)$ 是转变概率矩阵。\n\n为了计算 $P(t)$，我们可以对 $Q$ 进行对角化或使用其他矩阵指数化的方法。通过求解特征方程 $\\det(Q - \\lambda I) = 0$ 来找到 $Q$ 的特征值 $\\lambda$：\n$$\n\\det\\begin{pmatrix} -q - \\lambda  q \\\\ q  -q - \\lambda \\end{pmatrix} = (-q - \\lambda)^2 - q^2 = 0\n$$\n这得到 $(\\lambda + q)^2 = q^2$，从而得出 $\\lambda + q = \\pm q$。特征值为 $\\lambda_1 = 0$ 和 $\\lambda_2 = -2q$。\n\n转变矩阵 $P(t)$ 可以表示为：\n$$\nP(t) = \\begin{pmatrix} P_{00}(t)  P_{01}(t) \\\\ P_{10}(t)  P_{11}(t) \\end{pmatrix}\n$$\n其中 $P_{ij}(t)$ 是在时间 $0$ 时过程从状态 $i$ 开始，在时间 $t$ 处于状态 $j$ 的概率。对于一个对称的 2 状态模型，这些概率是众所周知的：\n$$\nP_{01}(t) = P_{10}(t) = \\frac{1}{2}(1 - \\exp(-2qt))\n$$\n$$\nP_{00}(t) = P_{11}(t) = \\frac{1}{2}(1 + \\exp(-2qt))\n$$\n我们将两个后代谱系表示为谱系 $A$ 和谱系 $B$。令 $X_A(s)$ 和 $X_B(s)$ 分别为分化事件后 $s$ 时刻（$0 \\le s \\le t$）谱系 $A$ 和谱系 $B$ 中该特征的状态。\n\n问题提供了 MRCA 处于状态 $0$ 的初始条件。这意味着 $X_A(0) = 0$ 且 $X_B(0) = 0$。\n我们关注的事件定义为两个末端分类单元在当前时刻 $t$ 都具有衍生状态 $1$。这对应于事件 $\\{X_A(t)=1 \\text{ and } X_B(t)=1\\}$。\n\n我们需要计算这个联合事件在祖先状态为条件下的概率：\n$$\n\\text{Prob}\\{X_A(t)=1, X_B(t)=1 \\mid X_A(0)=0, X_B(0)=0 \\}\n$$\n问题陈述，在祖先状态的条件下，两个分支上的演化历史是独立的。因此，联合概率是每个谱系各自概率的乘积：\n$$\n\\text{Prob}\\{X_A(t)=1 \\mid X_A(0)=0 \\} \\times \\text{Prob}\\{X_B(t)=1 \\mid X_B(0)=0 \\}\n$$\n这些概率中的每一个都是在长度为 $t$ 的时间段内从状态 $0$ 转变到状态 $1$ 的转变概率，即 $P_{01}(t)$。\n$$\n\\text{Prob}\\{X_A(t)=1 \\mid X_A(0)=0 \\} = P_{01}(t) = \\frac{1}{2}(1 - \\exp(-2qt))\n$$\n$$\n\\text{Prob}\\{X_B(t)=1 \\mid X_B(0)=0 \\} = P_{01}(t) = \\frac{1}{2}(1 - \\exp(-2qt))\n$$\n所指定的趋同事件的概率是这两个相同概率的乘积：\n$$\nP(\\text{convergence}) = [P_{01}(t)]^2 = \\left[ \\frac{1}{2}(1 - \\exp(-2qt)) \\right]^2\n$$\n展开这个表达式得到最终的闭式结果：\n$$\nP(\\text{convergence}) = \\frac{1}{4} (1 - \\exp(-2qt))^2\n$$\n该表达式正确地捕捉了两个谱系在时间间隔 $t$ 内，都从一个祖先状态（$0$）开始，独立演化到一个共享的衍生状态（$1$）的概率。这就是所指定的趋同事件的形式化、概率性定义。", "answer": "$$\\boxed{\\frac{1}{4}(1 - \\exp(-2qt))^{2}}$$", "id": "2805187"}, {"introduction": "最后的这项练习将系统发育、生物地理学和统计模型选择融为一体，代表了历史生物地理学研究的前沿方法。你将通过比较DEC和DEC+J模型，学习如何利用现生种群的地理分布和系统发育关系，来推断祖先的地理范围并检验关于物种形成模式（如奠基者事件）的假说。这是一个综合性练习，旨在让你亲身体验如何使用复杂的似然模型，从当今的格局中重构过去的演化历史 [@problem_id:2805198]。", "problem": "给定一个历史生物地理学中最小化的、完全指定的模型比较问题，用于评估跨越华莱士线重建的祖先分布区是否需要奠基者事件成种。比较的对象是扩散-灭绝-谱系分化 (DEC) 模型与带奠基者事件成种的 DEC (DEC+J) 模型，在一个固定的、跨越华莱士线具有按时间分层的扩散邻接性的三分类单元系统发育树上进行。任务是，对于一组给定的参数值，计算 DEC+J 模型是否比 DEC 模型更受赤池信息准则 (AIC) 的支持。\n\n使用的基本和核心定义：\n- 连续时间马尔可夫链 (CTMC) 用于渐变进化：对于一个时间同质生成矩阵 $Q$，时间-$t$ 的转移概率矩阵为 $P(t) = \\exp(Q t)$ (矩阵指数)。对于在绝对时间上分段恒定的按时间分层的速率，一个时间区间上的分支转移矩阵是该区间内重叠的时间层上各指数的时间有序乘积。\n- Felsenstein 的树上离散性状剪枝算法：父节点的条件似然向量通过将转移矩阵乘以子节点的似然向量获得，并在节点处使用谱系分化事件概率张量进行合并。\n- 通过赤池信息准则 (AIC) 进行模型选择：$\\mathrm{AIC} = 2k - 2 \\ln \\hat{L}$，其中 $k$ 是自由参数的数量，$\\hat{L}$ 是模型下的最大化似然值。在本任务中，您将在提供的参数值下评估 AIC (将它们视为固定的拟合值)。选择 AIC 值较低的模型。如果 $\\mathrm{AIC}_{\\mathrm{DEC}} - \\mathrm{AIC}_{\\mathrm{DEC+J}} \\geq 2$，我们将声明 DEC+J 模型受到支持。\n\n场景和定义：\n- 区域与华莱士线：两个区域，$A$ (Sunda) 和 $B$ (Sahul)，由华莱士线分隔。分布区是区域的非空子集：$\\{A\\}$、$\\{B\\}$ 和 $\\{A,B\\}$，分别编码为状态 $0、1、2$。状态空间中不包括空分布区。\n- 时间单位：所有时间单位均为百万年 (Myr)。所有速率单位均为每百万年 (per Myr)。所有对数均为自然对数。\n- 跨越华莱士线的按时间分层的扩散邻接性：\n  - 时间切片 $\\left[0,2\\right)$ 百万年：邻接乘数 $m = 0$ (无跨越华莱士线的渐变扩散)。\n  - 时间切片 $\\left[2,10\\right)$ 百万年：邻接乘数 $m = 0.2$ (渐变扩散减少)。\n- 对于给定的邻接乘数 $m$、扩散速率 $d$ (每百万年) 和灭绝速率 $e$ (每百万年)，三个状态的渐变 CTMC 生成矩阵 $Q(m; d,e)$：\n  - 允许的转移和速率：\n    - $\\{A\\} \\to \\{A,B\\}$，速率为 $d \\cdot m$，\n    - $\\{B\\} \\to \\{A,B\\}$，速率为 $d \\cdot m$，\n    - $\\{A,B\\} \\to \\{A\\}$，速率为 $e$，\n    - $\\{A,B\\} \\to \\{B\\}$，速率为 $e$。\n  - 不允许其他瞬时转移。对角线元素被设置以使每行总和为 $0$。\n- 从绝对时间 $t_{\\mathrm{younger}}$ 到 $t_{\\mathrm{older}}$ (其中 $t_{\\mathrm{older}}  t_{\\mathrm{younger}}$) 的分支上的分支转移矩阵是区间内重叠时间切片 $i$ 上的 $\\exp(Q(m_i; d,e)\\, \\Delta t_i)$ 的有序乘积，按从旧到新的时间顺序相乘。\n- 系统发育树和观察到的末端分布区：\n  - 树拓扑结构：$((t1, t2), t3)$。\n  - 末端年龄：所有末端年龄均为 0 百万年。\n  - 内部节点 $n_1$ 年龄为 1 百万年 (t1 和 t2 的父节点)。\n  - 根节点年龄为 4 百万年 ($n_1$ 和 t3 的父节点)。\n  - 分支和持续时间 (单位：百万年)：$t1 \\to n_1$：1；$t2 \\to n_1$：1；$n_1 \\to \\text{root}$：3；$t3 \\to \\text{root}$：4。\n  - 观察到的末端分布区：$t1 = \\{A\\}$， $t2 = \\{A\\}$， $t3 = \\{B\\}$。\n- 节点处的谱系分化事件概率张量 $G[a, x, y]$，给出在成种事件中，处于状态 $a$ 的祖先产生左、右后代分布区 $x$ 和 $y$ 的条件概率。\n  - DEC (无奠基者事件, $j=0$)：\n    - 如果 $a=\\{A\\}$：只允许 $(x,y) = (\\{A\\}, \\{A\\})$，概率为 $1$。\n    - 如果 $a=\\{B\\}$：只允许 $(x,y) = (\\{B\\}, \\{B\\})$，概率为 $1$。\n    - 如果 $a=\\{A,B\\}$：允许的等概率模式包括隔离分布 $(\\{A\\},\\{B\\})$ 和 $(\\{B\\},\\{A\\})$，同域分布 $(\\{A,B\\},\\{A,B\\})$，以及子集同域分布 $(\\{A,B\\},\\{A\\}), (\\{A\\},\\{A,B\\}), (\\{A,B\\},\\{B\\}), (\\{B\\},\\{A,B\\})$。这 $7$ 种模式中的每一种都具有相同的权重，并且该行被归一化以使总和为 $1$。\n  - DEC+J (带参数 $j \\ge 0$ 的奠基者事件成种)：\n    - 对于 $a=\\{A\\}$：在 DEC 基线模式 $(\\{A\\},\\{A\\})$ (权重为 1) 的基础上，添加奠基者跳跃模式 $(\\{A\\},\\{B\\})$ 和 $(\\{B\\},\\{A\\})$，每种权重为 $j$。将该行归一化以使总和为 $1$。\n    - 对于 $a=\\{B\\}$：类似地，添加权重为 $j$ 的 $(\\{A\\},\\{B\\})$ 和 $(\\{B\\},\\{A\\})$，并保留权重为 1 的 $(\\{B\\},\\{B\\})$，然后进行归一化。\n    - 对于 $a=\\{A,B\\}$：使用与上述相同的 $7$ 种等概率 DEC 模式 (不添加奠基者模式)，并进行归一化。\n- 根节点先验概率：在状态 $\\{A\\}, \\{B\\}, \\{A,B\\}$ 上均匀分布，即 $\\pi = [1/3, 1/3, 1/3]$。\n\n树上似然值的计算：\n- 对于每个观察到状态为 $s$ 的末端，使用一个长度为 $3$ 的似然向量 $L$，其中 $L[s]=1$，其余为 $0$。\n- 从每个末端向上传播到其父节点，使用 $L_{\\mathrm{parent}} = P \\, L_{\\mathrm{child}}$，其中 $P$ 是从父节点 (较老)到子节点 (较年轻) 的分支转移矩阵。\n- 在每个内部节点，使用谱系分化张量合并左、右子节点的似然向量：对于祖先状态 $a$，$L_{\\mathrm{node}}[a] = \\sum_{x}\\sum_{y} G[a,x,y] \\, L_{\\mathrm{left}}[x] \\, L_{\\mathrm{right}}[y]$。\n- 在根节点，计算总似然值 $L_{\\mathrm{total}} = \\sum_{a} \\pi[a] \\sum_{x}\\sum_{y} G[a,x,y] \\, L_{\\mathrm{left\\_at\\_root}}[x] \\, L_{\\mathrm{right\\_at\\_root}}[y]$。\n- 对数似然值为 $\\ln L_{\\mathrm{total}}$。\n\n模型比较：\n- 在提供的参数值下，计算 DEC 模型 (有 $k=2$ 个参数，$d$ 和 $e$) 和 DEC+J 模型 (有 $k=3$ 个参数，$d$、$e$ 和 $j$) 的 $\\ln L$。\n- 为每个模型计算 $\\mathrm{AIC} = 2k - 2 \\ln L$。\n- 如果 $\\mathrm{AIC}_{\\mathrm{DEC}} - \\mathrm{AIC}_{\\mathrm{DEC+J}} \\ge 2$，则声明 DEC+J 模型受到支持；否则，不受支持。\n\n单位和数值约定：\n- 时间以 Myr 表示，速率以每 Myr 表示。\n- 使用自然对数。\n- 如果任何模型下的 $L_{\\mathrm{total}}$ 在数值上计算为 0，则为了数值稳定性，在计算对数时将其视为一个非常小的正值 $\\epsilon = 10^{-300}$。\n\n测试套件：\n- 固定的树和时间分层如上所述。\n- 要评估的参数集 $(d, e, j)$：\n  1. $(d = 0.05, e = 0.02, j = 0.05)$\n  2. $(d = 0.05, e = 0.02, j = 0)$\n  3. $(d = 0.005, e = 0.005, j = 0.2)$\n  4. $(d = 0.2, e = 0.2, j = 0.001)$\n\n要求的最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目都是一个布尔值，按给定顺序对应一个测试用例，指示 DEC+J 是否受到上述定义的 AIC 准则的支持。例如：\"[True,False,True,False]\"。", "solution": "该问题根据规定的标准进行验证。\n\n**步骤 1：提取给定条件**\n\n- **模型**：扩散-灭绝-谱系分化 (DEC) 和带奠基者事件成种的 DEC (DEC+J)。\n- **比较准则**：赤池信息准则 (AIC)，定义为 $\\mathrm{AIC} = 2k - 2 \\ln \\hat{L}$。$k$ 是自由参数的数量，$\\hat{L}$ 是最大化似然值。\n- **支持条件**：如果 $\\mathrm{AIC}_{\\mathrm{DEC}} - \\mathrm{AIC}_{\\mathrm{DEC+J}} \\ge 2$，则 DEC+J 受到支持。\n- **状态空间**：区域 $\\{A\\}$ (Sunda)、$\\{B\\}$ (Sahul)。分布区是非空子集 $\\{A\\}$、$\\{B\\}$、$\\{A,B\\}$，分别编码为状态 $0$、$1$、$2$。\n- **时间和速率单位**：时间单位为百万年 (Myr)，速率单位为每百万年 (per Myr)。\n- **按时间分层的扩散**：邻接乘数 $m$。\n  - 时间切片 $[0, 2)$ 百万年：$m = 0$。\n  - 时间切片 $[2, 10)$ 百万年：$m = 0.2$。\n- **渐变速率矩阵 $Q$**：对于扩散速率 $d$ 和灭绝速率 $e$，生成矩阵 $Q(m; d,e)$ 具有以下转移：$\\{A\\} \\to \\{A,B\\}$ (速率 $d \\cdot m$)、$\\{B\\} \\to \\{A,B\\}$ (速率 $d \\cdot m$)、$\\{A,B\\} \\to \\{A\\}$ (速率 $e$)、$\\{A,B\\} \\to \\{B\\}$ (速率 $e$)。对角线元素确保行和为 $0$。\n- **分支转移矩阵 $P(t)$**：对于一个时间区间上的分支，$P(t)$ 是每个时间切片 $i$ 的矩阵指数 $\\exp(Q_i \\Delta t_i)$ 的时间有序乘积，按从旧到新的时间顺序相乘。\n- **系统发育树**：\n  - 拓扑结构：$((t1, t2), t3)$。\n  - 节点年龄：末端 $t1, t2, t3$ 位于 0 百万年；节点 $n_1$ ($t1, t2$ 的父节点) 位于 1 百万年；根节点 ($n_1, t3$ 的父节点) 位于 4 百万年。\n  - 分支持续时间：$t1 \\to n_1$: 1 百万年；$t2 \\to n_1$: 1 百万年；$n_1 \\to \\text{root}$: 3 百万年；$t3 \\to \\text{root}$: 4 百万年。\n- **末端数据**：观察到的分布区为 $t1 = \\{A\\}$，$t2 = \\{A\\}$，$t3 = \\{B\\}$。\n- **谱系分化张量 $G[a, x, y]$**：\n  - **DEC 模型 ($j=0$)**：\n    - $a=\\{A\\}$: $P(x=\\{A\\}, y=\\{A\\}) = 1$。\n    - $a=\\{B\\}$: $P(x=\\{B\\}, y=\\{B\\}) = 1$。\n    - $a=\\{A,B\\}$: 七种等概率结果 (隔离分布、同域分布、子集同域分布)，每种概率为 $1/7$。\n  - **DEC+J 模型 ($j \\ge 0$)**：\n    - $a=\\{A\\}$: 模式 $(\\{A\\},\\{A\\})$ 的权重为 $1$；$(\\{A\\},\\{B\\})$ 和 $(\\{B\\},\\{A\\})$ 的权重各为 $j$。概率被归一化。\n    - $a=\\{B\\}$: 模式 $(\\{B\\},\\{B\\})$ 的权重为 $1$；$(\\{A\\},\\{B\\})$ 和 $(\\{B\\},\\{A\\})$ 的权重各为 $j$。概率被归一化。\n    - $a=\\{A,B\\}$: 与 DEC 模型相同。\n- **根节点先验概率**：在三个状态上的均匀分布：$\\pi = [1/3, 1/3, 1/3]$。\n- **似然值计算**：指定使用 Felsenstein 的剪枝算法。\n- **数值稳定性**：如果总似然值 $L_{total} = 0$，则将其视为 $\\epsilon = 10^{-300}$。\n- **参数**：$k_{DEC} = 2$ ($d, e$)，$k_{DEC+J} = 3$ ($d, e, j$)。\n- **测试用例**：\n  1. $(d = 0.05, e = 0.02, j = 0.05)$\n  2. $(d = 0.05, e = 0.02, j = 0)$\n  3. $(d = 0.005, e = 0.005, j = 0.2)$\n  4. $(d = 0.2, e = 0.2, j = 0.001)$\n\n**步骤 2：验证**\n\n问题陈述经评估后被认为是有效的。\n- **科学依据充分**：该问题使用了计算生物地理学领域已建立的模型 (DEC, DEC+J)、算法 (Felsenstein 的剪枝算法) 和统计方法 (AIC)。华莱士线是一个经典的生物地理系统。其前提在事实和科学上都是合理的。\n- **定义明确**：该问题是完全指定的，有固定的系统发育树、明确的模型定义、所有必要的参数值和确定性的计算程序。它对每个测试用例都能导出一个唯一的、有意义的结果。\n- **客观性**：该问题以精确、定量和明确的语言阐述。模型支持的标准给出了严格的数学定义。\n\n该问题不存在指令中列出的无效性缺陷。它是可形式化的、完整的、一致的、计算上可行的且并非微不足道的。\n\n**步骤 3：结论与行动**\n\n该问题有效。下面提供一个完整的解决方案。\n\n**基于原理的解决方案**\n\n目标是根据赤池信息准则 (AIC)，确定对于四个给定的参数集，DEC+J 模型是否比 DEC 模型更受支持。这需要计算在每个模型和每个参数集下数据的总似然值。计算过程通过将 Felsenstein 的剪枝算法应用于给定的系统发育树来进行。\n\n**1. 状态空间和渐变模型**\n\n状态空间包括三个地理分布区：状态 $0 \\equiv \\{A\\}$，状态 $1 \\equiv \\{B\\}$，以及状态 $2 \\equiv \\{A,B\\}$。分支上分布区的渐变进化被建模为一个连续时间马尔可夫链，其生成矩阵为 $Q$。根据指定的允许转移， $Q$ 矩阵的一般形式为：\n$$\nQ(m; d, e) = \\begin{pmatrix}\n-d \\cdot m   0  d \\cdot m \\\\\n0  -d \\cdot m  d \\cdot m \\\\\ne  e  -2e\n\\end{pmatrix}\n$$\n其中 $d$ 是扩散速率，$e$ 是灭绝速率，$m$ 是区域 $A$ 和 $B$ 之间随时间变化的邻接乘数。\n\n系统发育树存在于两个具有不同邻接值的时间层中：\n- 时间层 1：$[0, 2)$ 百万年，$m_1 = 0$。生成矩阵为 $Q_1 = Q(0; d, e) = \\begin{pmatrix} 0  0  0 \\\\ 0  0  0 \\\\ e  e  -2e \\end{pmatrix}$。\n- 时间层 2：$[2, 10)$ 百万年，$m_2 = 0.2$。生成矩阵为 $Q_2 = Q(0.2; d, e) = \\begin{pmatrix} -0.2d  0  0.2d \\\\ 0  -0.2d  0.2d \\\\ e  e  -2e \\end{pmatrix}$。\n\n**2. 分支转移概率**\n\n持续时间为 $\\Delta t$ 的分支的转移概率矩阵为 $P(\\Delta t) = \\exp(Q \\Delta t)$，其中 $\\exp(\\cdot)$ 是矩阵指数。对于跨越 $t=2$ 百万年时间分层边界的分支，总转移矩阵是来自每个片段的矩阵的时间有序乘积，按从旧到新的时间顺序相乘。\n\n- **从末端 $t1, t2$ 到节点 $n_1$ 的分支**：这些分支跨越从年龄 $t=1$ 百万年到 $t=0$ 百万年，持续时间为 $\\Delta t = 1$ 百万年。此区间 $[0, 1)$ 完全位于时间层 1 内。\n$$ P_{t1, n_1} = P_{t2, n_1} = \\exp(Q_1 \\cdot 1) $$\n- **从节点 $n_1$ 到根节点的分支**：此分支跨越从年龄 $t=4$ 百万年到 $t=1$ 百万年，持续时间为 $\\Delta t = 3$ 百万年。它由时间层 2 中的一个 2 百万年片段 ($[2, 4)$) 和时间层 1 中的一个 1 百万年片段 ($[1, 2)$) 组成。\n$$ P_{n_1, \\text{root}} = \\exp(Q_1 \\cdot 1) \\cdot \\exp(Q_2 \\cdot 2) $$\n- **从末端 $t3$ 到根节点的分支**：此分支跨越从年龄 $t=4$ 百万年到 $t=0$ 百万年，持续时间为 $\\Delta t=4$ 百万年。它由时间层 2 中的一个 2 百万年片段 ($[2, 4)$) 和时间层 1 中的一个 2 百万年片段 ($[0, 2)$) 组成。\n$$ P_{t3, \\text{root}} = \\exp(Q_1 \\cdot 2) \\cdot \\exp(Q_2 \\cdot 2) $$\n\n**3. 谱系分化成种模型**\n\n在每个内部节点，发生一次成种事件，由一个 $3 \\times 3 \\times 3$ 的谱系分化张量 $G[a, x, y]$ 建模，该张量给出了一个处于状态 $a$ 的祖先产生一个处于状态 $x$ 的左后代和一个处于状态 $y$ 的右后代的概率。\n\n- **DEC 模型 ($G_{DEC}$)**：\n  - 对于祖先状态 $a=0$ (或 $a=1$)，只有同域继承 $(\\{A\\},\\{A\\})$ (或 $(\\{B\\},\\{B\\})$) 是可能的：$G[0,0,0]=1$，$G[1,1,1]=1$。\n  - 对于祖先状态 $a=2$，七种模式等概率，每种概率为 $1/7$：\n    - $G[2,0,1]=1/7$ (隔离分布)\n    - $G[2,1,0]=1/7$ (隔离分布)\n    - $G[2,2,2]=1/7$ (同域分布)\n    - $G[2,0,2]=1/7$, $G[2,2,0]=1/7$, $G[2,1,2]=1/7$, $G[2,2,1]=1/7$ (子集同域分布)\n- **DEC+J 模型 ($G_{DEC+J}$)**：\n  - 对于祖先状态 $a=0$ 和 $a=1$，允许使用参数 $j$ 进行奠基者事件成种。\n    - $a=0$: $P(\\{A\\}\\to(\\{A\\},\\{A\\})) = \\frac{1}{1+2j}$; $P(\\{A\\}\\to(\\{A\\},\\{B\\})) = \\frac{j}{1+2j}$; $P(\\{A\\}\\to(\\{B\\},\\{A\\})) = \\frac{j}{1+2j}$。\n    - $a=1$: $P(\\{B\\}\\to(\\{B\\},\\{B\\})) = \\frac{1}{1+2j}$; $P(\\{B\\}\\to(\\{A\\},\\{B\\})) = \\frac{j}{1+2j}$; $P(\\{B\\}\\to(\\{B\\},\\{A\\})) = \\frac{j}{1+2j}$。\n  - 对于祖先状态 $a=2$，概率与 DEC 模型相同。\n\n**4. 似然值计算**\n\n总似然值使用剪枝算法计算，将条件似然向量从末端传播到根节点。\n\n1.  **末端似然值**：对于观察到状态为 $s$ 的末端，似然向量 $L$ 是一个在位置 $s$ 处为 $1$、其余为零的向量。\n    - $L_{t1} = [1, 0, 0]^T$ (对于观察到的分布区 $\\{A\\}$)\n    - $L_{t2} = [1, 0, 0]^T$ (对于观察到的分布区 $\\{A\\}$)\n    - $L_{t3} = [0, 1, 0]^T$ (对于观察到的分布区 $\\{B\\}$)\n2.  **节点 $n_1$**：来自末端 $t1$ 和 $t2$ 的似然向量沿其各自的分支向上传播。\n    - $L'_{t1} = P_{t1, n_1} \\cdot L_{t1}$\n    - $L'_{t2} = P_{t2, n_1} \\cdot L_{t2}$\n    节点 $n_1$ 处的条件似然向量 $L_{n1}$ 通过根据谱系分化模型组合后代似然值来计算。对于每个祖先状态 $a$：\n    $$ L_{n_1}[a] = \\sum_{x=0}^{2} \\sum_{y=0}^{2} G[a, x, y] \\cdot L'_{t1}[x] \\cdot L'_{t2}[y] $$\n    其中 $t1$ 和 $t2$ 是 $n_1$ 的左、右后代。\n3.  **根节点**：来自节点 $n_1$ 和末端 $t3$ 的似然向量向上传播到根节点。\n    - $L'_{\\text{n1}} = P_{n_1, \\text{root}} \\cdot L_{n1}$\n    - $L'_{t3} = P_{t3, \\text{root}} \\cdot L_{t3}$\n    根节点的条件似然值 $L_{\\text{root}}$ 通过组合这些向量来计算。对于每个祖先状态 $a$：\n    $$ L_{\\text{root}}[a] = \\sum_{x=0}^{2} \\sum_{y=0}^{2} G[a, x, y] \\cdot L'_{\\text{n1}}[x] \\cdot L'_{t3}[y] $$\n    其中 $n_1$ 和 $t3$ 是根节点的左、右后代。\n4.  **总似然值**：总似然值 $L_{total}$ 是条件根似然值的加权和，权重为根节点先验概率 $\\pi = [1/3, 1/3, 1/3]$。\n    $$ L_{total} = \\sum_{a=0}^{2} \\pi[a] \\cdot L_{\\text{root}}[a] = \\frac{1}{3}\\sum_{a=0}^{2} L_{\\text{root}}[a] $$\n\n**5. 模型比较**\n\n对于每个参数集 $(d,e,j)$，计算 DEC 模型 (使用 $G_{DEC}$ 和参数 $d, e$) 和 DEC+J 模型 (使用 $G_{DEC+J}$ 和参数 $d, e, j$) 的对数似然值。设它们为 $\\ln L_{DEC}$ 和 $\\ln L_{DEC+J}$。如果任何 $L_{total}$ 在数值上为零，其对数将取为 $\\ln(10^{-300})$。\n\n每个模型的 AIC 计算如下：\n- $\\mathrm{AIC}_{DEC} = 2k_{DEC} - 2 \\ln L_{DEC} = 2(2) - 2 \\ln L_{DEC} = 4 - 2 \\ln L_{DEC}$\n- $\\mathrm{AIC}_{DEC+J} = 2k_{DEC+J} - 2 \\ln L_{DEC+J} = 2(3) - 2 \\ln L_{DEC+J} = 6 - 2 \\ln L_{DEC+J}$\n\n如果 $\\mathrm{AIC}_{DEC} - \\mathrm{AIC}_{DEC+J} \\ge 2$，则认为 DEC+J 模型受到支持。该不等式等价于：\n$$ (4 - 2 \\ln L_{DEC}) - (6 - 2 \\ln L_{DEC+J}) \\ge 2 \\implies 2(\\ln L_{DEC+J} - \\ln L_{DEC}) \\ge 4 \\implies \\ln L_{DEC+J} - \\ln L_{DEC} \\ge 2 $$\n对四个测试用例中的每一个都评估此条件，以产生最终的布尔结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Solves the biogeographic model comparison problem.\n\n    For each parameter set, it computes the log-likelihood under the DEC and\n    DEC+J models, calculates their respective AIC scores, and determines if\n    DEC+J is supported over DEC based on the criterion AIC_DEC - AIC_DEC+J >= 2.\n    \"\"\"\n\n    # Define the four test cases (d, e, j)\n    test_cases = [\n        (0.05, 0.02, 0.05),\n        (0.05, 0.02, 0.0),\n        (0.005, 0.005, 0.2),\n        (0.2, 0.2, 0.001),\n    ]\n\n    results = []\n    \n    # State encoding: 0:{A}, 1:{B}, 2:{A,B}\n    # Tip observations: t1={A}, t2={A}, t3={B}\n    L_t1 = np.array([1.0, 0.0, 0.0])\n    L_t2 = np.array([1.0, 0.0, 0.0])\n    L_t3 = np.array([0.0, 1.0, 0.0])\n    \n    # Root prior\n    root_prior = np.array([1/3, 1/3, 1/3])\n    \n    # Numerical stability for log(0)\n    LOG_ZERO_REPLACEMENT = np.log(1e-300)\n\n    for d, e, j in test_cases:\n        # Calculate log-likelihood for DEC model\n        log_L_dec = calculate_log_likelihood(d, e, 0, 'dec', L_t1, L_t2, L_t3, root_prior)\n        \n        # Calculate log-likelihood for DEC+J model\n        log_L_decj = calculate_log_likelihood(d, e, j, 'decj', L_t1, L_t2, L_t3, root_prior)\n\n        # Handle numerical underflow resulting in -inf\n        if np.isneginf(log_L_dec):\n            log_L_dec = LOG_ZERO_REPLACEMENT\n        if np.isneginf(log_L_decj):\n            log_L_decj = LOG_ZERO_REPLACEMENT\n\n        # Calculate AIC scores\n        # k_dec = 2, k_decj = 3\n        aic_dec = 2 * 2 - 2 * log_L_dec\n        aic_decj = 2 * 3 - 2 * log_L_decj\n\n        # Check for support for DEC+J\n        is_supported = (aic_dec - aic_decj) >= 2.0\n        results.append(is_supported)\n\n    # Format the final output string\n    output_str = f\"[{','.join(map(lambda x: str(x).title(), results))}]\"\n    print(output_str)\n\ndef get_Q_matrix(m, d, e):\n    \"\"\"Constructs the anagenetic rate matrix Q.\"\"\"\n    Q = np.zeros((3, 3))\n    # Transitions\n    Q[0, 2] = d * m  # A -> AB\n    Q[1, 2] = d * m  # B -> AB\n    Q[2, 0] = e      # AB -> A\n    Q[2, 1] = e      # AB -> B\n    # Diagonals\n    np.fill_diagonal(Q, -Q.sum(axis=1))\n    return Q\n\ndef get_cladogenetic_tensor(j, model_type):\n    \"\"\"Constructs the 3x3x3 cladogenetic tensor G[ancestor, left, right].\"\"\"\n    G = np.zeros((3, 3, 3))\n    \n    # --- DEC model cladogenesis ---\n    # Ancestor {A}: only {A}+{A}\n    G[0, 0, 0] = 1.0\n    # Ancestor {B}: only {B}+{B}\n    G[1, 1, 1] = 1.0\n    # Ancestor {AB}: 7 equiprobable patterns\n    prob_ab = 1.0 / 7.0\n    G[2, 0, 1] = prob_ab  # Vicariance\n    G[2, 1, 0] = prob_ab\n    G[2, 2, 2] = prob_ab  # Sympatry\n    G[2, 0, 2] = prob_ab  # Subset sympatry\n    G[2, 2, 0] = prob_ab\n    G[2, 1, 2] = prob_ab\n    G[2, 2, 1] = prob_ab\n\n    # --- DEC+J model modifications ---\n    if model_type == 'decj' and j > 0:\n        norm_j = 1.0 / (1.0 + 2.0 * j)\n        # Ancestor {A}: add founder-event\n        G[0, 0, 0] = norm_j\n        G[0, 0, 1] = j * norm_j\n        G[0, 1, 0] = j * norm_j\n        # Ancestor {B}: add founder-event\n        G[1, 1, 1] = norm_j\n        G[1, 0, 1] = j * norm_j\n        G[1, 1, 0] = j * norm_j\n    elif model_type == 'decj' and j == 0:\n        # DEC+J with j=0 is just the DEC model\n        pass # G is already the DEC tensor\n        \n    return G\n\ndef calculate_log_likelihood(d, e, j, model_type, L_t1, L_t2, L_t3, root_prior):\n    \"\"\"\n    Calculates the total log-likelihood for a given model and parameters.\n    \"\"\"\n    # 1. Get anagenetic Q matrices for the two time strata\n    Q1 = get_Q_matrix(m=0.0, d=d, e=e)    # Stratum [0, 2) Myr\n    Q2 = get_Q_matrix(m=0.2, d=d, e=e)    # Stratum [2, 10) Myr\n\n    # 2. Get cladogenetic tensor G\n    G = get_cladogenetic_tensor(j, model_type)\n\n    # 3. Calculate branch transition probability matrices (P = exp(Q*t))\n    # Branch t1/t2 -> n1: duration 1 Myr in Stratum 1\n    P_t1_n1 = expm(Q1 * 1.0)\n    # Branch n1 -> root: 1 Myr in S1, 2 Myr in S2. Order is important for matrix product.\n    P_n1_root = expm(Q1 * 1.0) @ expm(Q2 * 2.0)\n    # Branch t3 -> root: 2 Myr in S1, 2 Myr in S2\n    P_t3_root = expm(Q1 * 2.0) @ expm(Q2 * 2.0)\n    \n    # 4. Pruning algorithm: from tips to root\n    # Propagate from t1 and t2 to node n1\n    L_prime_t1 = P_t1_n1 @ L_t1\n    L_prime_t2 = P_t1_n1 @ L_t2 # Same branch as t1\n\n    # Combine at node n1\n    L_n1 = np.zeros(3)\n    for a in range(3): # For each ancestral state at n1\n        # G[a,:,:] is a 3x3 matrix for descendant states\n        # The sum is L_left.T @ G[a] @ L_right\n        L_n1[a] = L_prime_t1.T @ G[a] @ L_prime_t2\n\n    # Propagate from n1 and t3 to root\n    L_prime_n1 = P_n1_root @ L_n1\n    L_prime_t3 = P_t3_root @ L_t3\n\n    # Combine at root\n    L_root = np.zeros(3)\n    for a in range(3): # For each ancestral state at root\n        L_root[a] = L_prime_n1.T @ G[a] @ L_prime_t3\n\n    # 5. Calculate total likelihood\n    total_likelihood = root_prior @ L_root\n    \n    return np.log(total_likelihood) if total_likelihood > 0 else -np.inf\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2805198"}]}