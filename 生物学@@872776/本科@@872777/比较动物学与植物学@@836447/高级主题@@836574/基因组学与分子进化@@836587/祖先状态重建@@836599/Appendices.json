{"hands_on_practices": [{"introduction": "掌握任何一种新方法的关键在于从基础开始。这个练习将引导你完成祖先状态重建中最核心的计算：为系统发育树上的一个特定特征计算简约性分数。通过在一个假设的植物进化场景中追踪授粉方式的演变，你将学会应用最大简约性原则（也称为奥卡姆剃刀），以找到解释现有物种性状分布所需的最少进化改变次数（[@problem_id:1728712]）。", "problem": "一位植物学家正在研究一个包含六个虚构植物物种（Aurelia、Borealis、Cascadea、Dracona、Elysia 和 Fumaris）的分支中传粉策略的演化。观察到的主要传粉方式是风媒传粉或虫媒传粉。基于大量的形态学和遗传学数据，这位植物学家确定了每个物种的传粉方式，并重建了它们的系统发育关系。\n\n观察到的传粉方式如下：\n- Aurelia：风媒传粉\n- Borealis：虫媒传粉\n- Cascadea：虫媒传粉\n- Dracona：风媒传粉\n- Elysia：虫媒传粉\n- Fumaris：风媒传粉\n\n代表这些物种之间演化关系的系统发育树，由以下嵌套括号表示法描述：`((Aurelia, Borealis), (Cascadea, (Dracona, (Elysia, Fumaris))));`。在这种格式中，括号内的一对物种或类群是姐妹群，意味着它们共享一个最近的共同祖先。\n\n假设给定的系统发育是正确的，并且演化变化（从风媒传粉到虫媒传粉，或反之）是罕见事件，请计算解释这六个物种中观察到的传粉方式分布所需的最少演化变化次数。", "solution": "令 $W$ 表示风媒传粉状态，令 $I$ 表示虫媒传粉状态。在给定的固定拓扑结构 $((\\text{Aurelia}, \\text{Borealis}), (\\text{Cascadea}, (\\text{Dracona}, (\\text{Elysia}, \\text{Fumaris})))))$ 上，我们使用最大简约法（Fitch算法）计算状态变化的最小次数。定义内部节点 $v_{1}=(\\text{Aurelia}, \\text{Borealis})$，$v_{2}=(\\text{Elysia}, \\text{Fumaris})$，$v_{3}=(\\text{Dracona}, v_{2})$，$v_{4}=(\\text{Cascadea}, v_{3})$，以及根节点 $v_{5}=(v_{1}, v_{4})$。令 $S_{x}$ 为节点或叶节点 $x$ 处可能的状态集合。叶节点的状态为 $S_{\\text{Aurelia}}=\\{W\\}$, $S_{\\text{Borealis}}=\\{I\\}$, $S_{\\text{Cascadea}}=\\{I\\}$, $S_{\\text{Dracona}}=\\{W\\}$, $S_{\\text{Elysia}}=\\{I\\}$, $S_{\\text{Fumaris}}=\\{W\\}$。\n\n应用Fitch自下而上的规则：对于一个父节点，其子节点的状态集合分别为 $S_{1}$ 和 $S_{2}$，如果 $S_{1}\\cap S_{2}\\neq \\emptyset$，则父节点的状态为它们的交集，变化次数加 $0$；如果 $S_{1}\\cap S_{2}=\\emptyset$，则父节点的状态为它们的并集，变化次数加 $1$。\n\n计算内部节点的状态集合和变化次数：\n$$S_{v_{2}}=S_{\\text{Elysia}}\\cap S_{\\text{Fumaris}}=\\{I\\}\\cap \\{W\\}=\\emptyset \\Rightarrow S_{v_{2}}=\\{I,W\\}, \\text{ 变化次数加 }1$$\n$$S_{v_{3}}=S_{\\text{Dracona}}\\cap S_{v_{2}}=\\{W\\}\\cap \\{I,W\\}=\\{W\\} \\Rightarrow S_{v_{3}}=\\{W\\}, \\text{ 变化次数加 }0$$\n$$S_{v_{4}}=S_{\\text{Cascadea}}\\cap S_{v_{3}}=\\{I\\}\\cap \\{W\\}=\\emptyset \\Rightarrow S_{v_{4}}=\\{I,W\\}, \\text{ 变化次数加 }1$$\n$$S_{v_{1}}=S_{\\text{Aurelia}}\\cap S_{\\text{Borealis}}=\\{W\\}\\cap \\{I\\}=\\emptyset \\Rightarrow S_{v_{1}}=\\{I,W\\}, \\text{ 变化次数加 }1$$\n$$S_{v_{5}}=S_{v_{1}}\\cap S_{v_{4}}=\\{I,W\\}\\cap \\{I,W\\}=\\{I,W\\} \\Rightarrow \\text{ 变化次数加 }0$$\n\n将增加的变化次数相加，得到最小变化次数：\n$$1+0+1+1+0=3.$$\n\n一个能达到此计数且兼容的自上而下的分配是：选择 $S_{v_{5}}=W$，然后 $S_{v_{4}}=W$，$S_{v_{3}}=W$，$S_{v_{2}}=W$，$S_{v_{1}}=W$。这导致在通往 Borealis、Cascadea 和 Elysia 的分支上恰好有三次边变化，从而证实了计算出的最小值。", "answer": "$$\\boxed{3}$$", "id": "1728712"}, {"introduction": "计算简约性分数本身并非最终目的，它是一种强大的科学推理工具。在进化生物学研究中，科学家们常常面对关于物种间关系的多种竞争性假说（即不同的系统发育树）。这个练习将向你展示如何利用简约性分数来客观地评估这些假说，通过比较不同拓扑结构解释观察数据所需的进化改变次数，我们可以选择最简约的进化历史作为最优解释（[@problem_id:1728715]）。", "problem": "一位植物学家正在研究一个偏远岛屿上新发现的六种植物物种间的进化关系。这些物种被命名为 A、B、C、D、E 和 F。正在研究的一个关键特征是它们叶子中是否存在（状态 1）或缺失（状态 0）一种特定的生物碱化合物，这被认为是一个衍生性状。在这六个物种中观察到的该特征的状态如下：\n\n- 物种 A：缺失 (0)\n- 物种 B：存在 (1)\n- 物种 C：存在 (1)\n- 物种 D：缺失 (0)\n- 物种 E：缺失 (0)\n- 物种 F：存在 (1)\n\n基于不同的形态学数据集，已经提出了两种关于这些物种间系统发育关系的竞争性假说。\n\n**假说 1：** 这些物种形成两个主要的演化支。第一个演化支由物种 A、B 和 C 组成，其中物种 B 和 C 是彼此的最近亲。第二个演化支由物种 D、E 和 F 组成，其中物种 D 和 E 是彼此的最近亲。\n\n**假说 2：** 这些物种以一种更逐步的，或“阶梯状”的方式分化。物种 A 是从该群体的共同祖先中最早分化出来的谱系。下一个分化出来的谱系是物种 B，然后是物种 C 的分化。剩下的物种形成一个演化支，其中物种 D 是与一对关系最近的物种 E 和 F 互为姐妹群。\n\n你的任务是使用最大简约性原则来评估这两个假说。计算每个假说中给定二元特征的简约性分数。简约性分数定义为在一个给定的树上，解释物种间状态分布所需的最少进化变化次数（在这种情况下，是生物碱的获得或丢失）。\n\n以一个有序整数对的形式提供你的答案，对应于（假说 1 的简约性分数，假说 2 的简约性分数）。", "solution": "我们使用 Fitch 算法，通过最大简约性法来评估每个有根假说对于单个二元特征的情况。对于每个节点，我们分配一个可能的状态集。对于一个父节点，其子节点的状态集为 $S_{1}$ 和 $S_{2}$：\n- 如果 $S_{1} \\cap S_{2} \\neq \\varnothing$，则将父节点的状态集赋为 $S_{\\text{parent}} = S_{1} \\cap S_{2}$，并将分数加 $0$。\n- 如果 $S_{1} \\cap S_{2} = \\varnothing$，则将父节点的状态集赋为 $S_{\\text{parent}} = S_{1} \\cup S_{2}$，并将分数加 $1$。\n叶节点被赋予其观察到的状态作为单元素集：$A=\\{0\\}$, $B=\\{1\\}$, $C=\\{1\\}$, $D=\\{0\\}$, $E=\\{0\\}$, $F=\\{1\\}$。\n\n假说 1：拓扑结构为 ((A,(B,C)),((D,E),F)) 的演化支。设 $X=\\text{MRCA}(B,C)$，$Y=\\text{MRCA}(A,X)$，$Z=\\text{MRCA}(D,E)$，$W=\\text{MRCA}(Z,F)$，以及 $R=\\text{MRCA}(Y,W)$。\n- 节点 $X$ 来自 $B=\\{1\\}$ 和 $C=\\{1\\}$：$S_{X}=\\{1\\}$ 因为 $\\{1\\}\\cap\\{1\\}=\\{1\\}$，加 $0$。\n- 节点 $Y$ 来自 $A=\\{0\\}$ 和 $X=\\{1\\}$：$\\{0\\}\\cap\\{1\\}=\\varnothing$，所以 $S_{Y}=\\{0,1\\}$，加 $1$。\n- 节点 $Z$ 来自 $D=\\{0\\}$ 和 $E=\\{0\\}$：$S_{Z}=\\{0\\}$ 因为 $\\{0\\}\\cap\\{0\\}=\\{0\\}$，加 $0$。\n- 节点 $W$ 来自 $Z=\\{0\\}$ 和 $F=\\{1\\}$：$\\{0\\}\\cap\\{1\\}=\\varnothing$，所以 $S_{W}=\\{0,1\\}$，加 $1$。\n- 根节点 $R$ 来自 $Y=\\{0,1\\}$ 和 $W=\\{0,1\\}$：$S_{R}=\\{0,1\\}$ 因为 $\\{0,1\\}\\cap\\{0,1\\}=\\{0,1\\}$，加 $0$。\n假说 1 的总简约性分数为 $1+1=2$。一个达到 2 次变化的相容重构是，例如，将 $Y$ 和 $W$ 赋值为 0，并在分支 $Y\\to X$（产生 $B=C=1$）和分支 $W\\to F$（产生 $F=1$）上各放置一次 $0\\to 1$ 的变化。\n\n假说 2：阶梯状拓扑，其中 A 首先分化，然后是 B，再是 C，其余部分形成一个演化支，D 是 (E,F) 的姐妹群。设 $EF=\\text{MRCA}(E,F)$，$DEF=\\text{MRCA}(D,EF)$，$CDEF=\\text{MRCA}(C,DEF)$，$BCDEF=\\text{MRCA}(B,CDEF)$，以及 $ABCDEF=\\text{MRCA}(A,BCDEF)$。\n- 节点 $EF$ 来自 $E=\\{0\\}$ 和 $F=\\{1\\}$：$\\{0\\}\\cap\\{1\\}=\\varnothing$，所以 $S_{EF}=\\{0,1\\}$，加 $1$。\n- 节点 $DEF$ 来自 $D=\\{0\\}$ 和 $EF=\\{0,1\\}$：$S_{DEF}=\\{0\\}$ 因为 $\\{0\\}\\cap\\{0,1\\}=\\{0\\}$，加 $0$。\n- 节点 $CDEF$ 来自 $C=\\{1\\}$ 和 $DEF=\\{0\\}$：$\\{1\\}\\cap\\{0\\}=\\varnothing$，所以 $S_{CDEF}=\\{0,1\\}$，加 $1$。\n- 节点 $BCDEF$ 来自 $B=\\{1\\}$ 和 $CDEF=\\{0,1\\}$：$S_{BCDEF}=\\{1\\}$ 因为 $\\{1\\}\\cap\\{0,1\\}=\\{1\\}$，加 $0$。\n- 根节点 $ABCDEF$ 来自 $A=\\{0\\}$ 和 $BCDEF=\\{1\\}$：$\\{0\\}\\cap\\{1\\}=\\varnothing$，所以 $S_{ABCDEF}=\\{0,1\\}$，加 $1$。\n假说 2 的总简约性分数为 $1+1+1=3$。一个达到 3 次变化的相容重构是，例如，在根节点和主干上赋值为 0，然后通过在通往 B、C 和 F 的末端分支上各自的独立变化来产生 $B=1$，$C=1$ 和 $F=1$。\n\n因此，简约性分数的有序对是 $(2,3)$。", "answer": "$$\\boxed{\\begin{pmatrix}2  3\\end{pmatrix}}$$", "id": "1728715"}, {"introduction": "虽然简约性方法直观且强大，但它假设所有类型的进化改变都是等概率的，并且不考虑进化时间的长短。本练习将带你超越简约性，探索一种更精细的概率模型——最大似然法。通过分析一个甲壳类动物的进化场景，你将比较最大简约性和最大似然法这两种方法在重建祖先状态上的差异，特别是当性状转变的速率不对称时（例如，从自由生活到寄生的转变比反向转变更容易），从而理解不同模型假设如何影响我们对进化历史的推断（[@problem_id:1728708]）。", "problem": "一个进化生物学家团队正在重建一个由A、B、C、D、E五个甲壳类物种组成的小分支的寄生史。这些物种间的进化关系由系统发育树 `(((A:1.0,B:1.0):1.0,C:1.0):1.0,D:1.0):1.0,E:1.0)` 描述，其中数字代表以百万年为单位的分支长度。调查确定了每个物种的生活方式：物种A、C和E是寄生的，而物种B和D是自由生活的。为了分析目的，自由生活状态编码为0，寄生状态编码为1。\n\n你需要比较两种常用的祖先状态重建方法。\n\n首先，使用最大简约法原则，确定解释树末端观察到的生活方式分布所需的最小进化状态改变次数（即自由生活与寄生生活方式之间的双向转变次数）。令此最小次数为 $N_{MP}$。\n\n其次，使用最大似然 (ML) 框架进行分析。该性状的进化被建模为一个具有两个状态（0和1）的连续时间马尔可夫过程。根据从其他甲壳类动物获得的更广泛数据，生物学家估计瞬时转换率为：从自由生活变为寄生的速率为 $q_{01} = 0.2$ 每百万年，从寄生变为自由生活的速率为 $q_{10} = 0.8$ 每百万年。对于ML重建，你必须首先计算树中每个内部节点上每个状态的边际后验概率。根节点状态的先验概率将被设置为指定马尔可夫过程的平稳分布。然后，为每个内部节点指定具有较高边际后验概率的祖先状态。基于这个单一的最可能重建，计算整个树上发生的状态改变总数。令此数为 $N_{ML}$。\n\n计算这两种方法推断出的改变次数之间的绝对差，$|N_{MP} - N_{ML}|$。你的最终答案应为一个整数。", "solution": "给定一个有根二叉树，所有分支长度均为1，末端状态为：$A=1$，$B=0$，$C=1$，$D=0$，$E=1$。令内部节点按嵌套结构表示如下：$N_{1}=\\text{parent of }(A,B)$，$N_{2}=\\text{parent of }(N_{1},C)$，$N_{3}=\\text{parent of }(N_{2},D)$，以及$N_{4}=\\text{root, parent of }(N_{3},E)$。\n\n最大简约法。使用Fitch算法和集合。在叶节点处：$S(A)=\\{1\\}$，$S(B)=\\{0\\}$，$S(C)=\\{1\\}$，$S(D)=\\{0\\}$，$S(E)=\\{1\\}$。自底向上合并：\n- 在$N_1$处，来自$A$和$B$：$S(N_{1})=\\{1\\}\\cap\\{0\\}=\\varnothing$，所以$S(N_{1})=\\{0,1\\}$并增加一次改变。\n- 在$N_2$处，来自$N_1$和$C$：$S(N_{1})\\cap S(C)=\\{0,1\\}\\cap\\{1\\}=\\{1\\}$，所以$S(N_{2})=\\{1\\}$并增加零次改变。\n- 在$N_3$处，来自$N_2$和$D$：$S(N_{2})\\cap S(D)=\\{1\\}\\cap\\{0\\}=\\varnothing$，所以$S(N_{3})=\\{0,1\\}$并增加一次改变。\n- 在$N_4$处，来自$N_3$和$E$：$S(N_{3})\\cap S(E)=\\{0,1\\}\\cap\\{1\\}=\\{1\\}$，所以$S(N_{4})=\\{1\\}$并增加零次改变。\n因此，最小改变次数为$N_{MP}=1+0+1+0=2$。\n\n最大似然法。双态连续时间马尔可夫过程具有$q_{01}=0.2$，$q_{10}=0.8$，因此$\\lambda=q_{01}+q_{10}=1$，平稳分布为$\\pi_{0}=\\frac{q_{10}}{\\lambda}=0.8$，$\\pi_{1}=\\frac{q_{01}}{\\lambda}=0.2$。对于长度为$t=1$的分支，设$a=\\exp(-\\lambda t)=\\exp(-1)$，则转移概率为\n$$\nP_{00}=0.8+0.2 a,\\quad P_{01}=0.2(1-a),\\quad P_{10}=0.8(1-a),\\quad P_{11}=0.2+0.8 a.\n$$\n为了进行剪枝，将每个节点$X$处的条件似然向量定义为$L_{X}(s)$，即在节点$X$的状态为$s$的条件下，$X$下方子树中数据的概率。在观察到状态为$d$的叶节点上，$L_{\\text{leaf}}(s)=\\mathbf{1}[s=d]$。记$x=P_{00}$，$y=P_{01}$，$z=P_{10}$，$w=P_{11}$。然后，合并节点$v$的子节点$c_{1},c_{2}$，\n$$\nL_{v}(i)=\\prod_{m\\in\\{c_{1},c_{2}\\}}\\left(\\sum_{j\\in\\{0,1\\}}P_{ij}L_{m}(j)\\right).\n$$\n自底向上计算：\n- 在$N_1$处，从叶节点$A=1$和$B=0$：\n$$\nL_{N_{1}}(0)=y x,\\quad L_{N_{1}}(1)=w z.\n$$\n- 在$N_2$处，子节点为$N_1$和$C=1$：\n$$\nL_{N_{2}}(0)=\\big(x L_{N_{1}}(0)+y L_{N_{1}}(1)\\big)\\,y=y^{2}\\big(x^{2}+w z\\big),\\quad\nL_{N_{2}}(1)=\\big(z L_{N_{1}}(0)+w L_{N_{1}}(1)\\big)\\,w=z w\\big(x y+w^{2}\\big).\n$$\n- 在$N_3$处，子节点为$N_2$和$D=0$：\n$$\nL_{N_{3}}(0)=\\big(x L_{N_{2}}(0)+y L_{N_{2}}(1)\\big)\\,x,\\quad\nL_{N_{3}}(1)=\\big(z L_{N_{2}}(0)+w L_{N_{2}}(1)\\big)\\,z.\n$$\n- 在$N_4$处，子节点为$N_3$和$E=1$：\n$$\nL_{N_{4}}(0)=\\big(x L_{N_{3}}(0)+y L_{N_{3}}(1)\\big)\\,y,\\quad\nL_{N_{4}}(1)=\\big(z L_{N_{3}}(0)+w L_{N_{3}}(1)\\big)\\,w.\n$$\n当$a=\\exp(-1)$时，转移概率为$x=0.8+0.2 a$，$y=0.2(1-a)$，$z=0.8(1-a)$，$w=0.2+0.8 a$。对这些表达式进行数值计算（在公式中保持$\\exp(-1)$为精确值，仅使用小数近似来判断不等式），可得\n$$\nL_{N_{1}}(0)\\approx 0.1104409723,\\quad L_{N_{1}}(1)\\approx 0.2499675507,\n$$\n$$\nL_{N_{2}}(0)\\approx 0.0161941531,\\quad L_{N_{2}}(1)\\approx 0.0886828600,\n$$\n$$\nL_{N_{3}}(0)\\approx 0.0221476889,\\quad L_{N_{3}}(1)\\approx 0.0263346177,\n$$\n$$\nL_{N_{4}}(0)\\approx 0.0028667832,\\quad L_{N_{4}}(1)\\approx 0.0119660759.\n$$\n$N_4$处的根后验概率与$\\pi_{i}L_{N_{4}}(i)$成正比，得出\n$$\n\\pi_{0}L_{N_{4}}(0)\\approx 0.0022934266,\\quad \\pi_{1}L_{N_{4}}(1)\\approx 0.0023932152,\n$$\n因此$N_4$被赋予状态1。\n\n为计算其他内部节点的边际后验概率，使用向上传递的信息。令$U_{X}(s)$为在节点$X$处于状态$s$的条件下，以$X$为根的子树之外所有数据的概率。在根节点$N_4$处，$U_{N_{4}}(i)=\\pi_{i}$。对于父节点 $p$ 的子节点 $c$ 及其兄弟节点，递归关系为\n$$\nU_{c}(j)=\\sum_{i\\in\\{0,1\\}}U_{p}(i)\\left(\\sum_{k\\in\\{0,1\\}}P_{ik}L_{\\text{sibling}}(k)\\right)P_{ij}.\n$$\n首先，对于$N_3$（兄弟节点为$E=1$）：\n$$\nU_{N_{3}}(0)=\\pi_{0} y x+\\pi_{1} w z,\\quad U_{N_{3}}(1)=\\pi_{0} y^{2}+\\pi_{1} w^{2},\n$$\n其计算结果为$U_{N_{3}}(0)\\approx 0.1383462880$, $U_{N_{3}}(1)\\approx 0.0616552794$。$N_3$处的边际后验概率与$U_{N_{3}}(s)L_{N_{3}}(s)$成正比，得出\n$$\nU_{N_{3}}(0)L_{N_{3}}(0)\\approx 0.003064951,\\quad U_{N_{3}}(1)L_{N_{3}}(1)\\approx 0.001624381,\n$$\n因此$N_3$被赋予状态0。\n\n其次，对于$N_2$（父节点为$N_3$，兄弟节点为$D=0$）：\n$$\nU_{N_{2}}(0)=U_{N_{3}}(0)x^{2}+U_{N_{3}}(1)z^{2},\\quad U_{N_{2}}(1)=U_{N_{3}}(0) x y+U_{N_{3}}(1) z w,\n$$\n得到$U_{N_{2}}(0)\\approx 0.1213427854$, $U_{N_{2}}(1)\\approx 0.0306966221$，以及后验概率的分子\n$$\nU_{N_{2}}(0)L_{N_{2}}(0)\\approx 0.001967488,\\quad U_{N_{2}}(1)L_{N_{2}}(1)\\approx 0.002721979,\n$$\n因此$N_2$被赋予状态1。\n\n最后，对于$N_1$（父节点为$N_2$，兄弟节点为$C=1$）：\n$$\nU_{N_{1}}(0)=U_{N_{2}}(0) y x+U_{N_{2}}(1) w z,\\quad U_{N_{1}}(1)=U_{N_{2}}(0) y^{2}+U_{N_{2}}(1) w^{2},\n$$\n得出$U_{N_{1}}(0)\\approx 0.0210771620$, $U_{N_{1}}(1)\\approx 0.0094436715$，以及后验概率的分子\n$$\nU_{N_{1}}(0)L_{N_{1}}(0)\\approx 0.002328780,\\quad U_{N_{1}}(1)L_{N_{1}}(1)\\approx 0.002360866,\n$$\n因此$N_1$被赋予状态1。\n\n因此，ML边际最大值分配为$N_{4}=1$, $N_{3}=0$, $N_{2}=1$, $N_{1}=1$。计算沿所有分支到末端的改变次数：\n- $N_{4}\\to E$: $1\\to 1$，无改变。\n- $N_{4}\\to N_{3}$: $1\\to 0$，一次改变。\n- $N_{3}\\to D$: $0\\to 0$，无改变。\n- $N_{3}\\to N_{2}$: $0\\to 1$，一次改变。\n- $N_{2}\\to C$: $1\\to 1$，无改变。\n- $N_{2}\\to N_{1}$: $1\\to 1$，无改变。\n- $N_{1}\\to A$: $1\\to 1$，无改变。\n- $N_{1}\\to B$: $1\\to 0$，一次改变。\n\n因此$N_{ML}=3$。由于$N_{MP}=2$，绝对差为$|N_{MP}-N_{ML}|=|2-3|=1$。", "answer": "$$\\boxed{1}$$", "id": "1728708"}]}