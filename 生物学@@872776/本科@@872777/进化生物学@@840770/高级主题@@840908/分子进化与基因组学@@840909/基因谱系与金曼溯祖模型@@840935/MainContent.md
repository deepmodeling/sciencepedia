## 引言
在[群体遗传学](@entry_id:146344)领域，一个核心问题是：我们今天在物种中观察到的纷繁复杂的遗传变异，其历史根源是什么？经典的演化模型，如[Wright-Fisher模型](@entry_id:148998)，为我们提供了从现在向未来展望的视角，预测[遗传漂变](@entry_id:145594)和选择等力量如何塑造未来的[基因库](@entry_id:267957)。然而，当我们手握DNA[序列数据](@entry_id:636380)时，我们更需要一个“向后看”的工具，一个能够追溯这些[基因谱系](@entry_id:172451)，重建它们共同祖先历史的理论框架。这一知识上的需求正是[金曼溯祖](@entry_id:169191)理论（Kingman's Coalescent）所要解决的核心问题。它彻底改变了我们解读遗传数据的方式，在理论与观测之间架起了一座坚实的桥梁。

在接下来的内容中，我们将分三个部分系统地探索这一理论。第一章“原理与机制”将深入溯祖过程的数学核心，解释[基因谱系](@entry_id:172451)如何随时间向后合并，以及这一过程的节奏是如何由种群大小决定的。第二章“应用与跨学科联系”将展示这一理论的强大威力，我们将看到如何利用它从DNA序列中解读种群历史的兴衰、识别自然选择的足迹，甚至揭示[物种形成](@entry_id:147004)的复杂性。最后，在“动手实践”部分，你将通过解决具体的计算问题，亲身体验和应用[溯祖理论](@entry_id:155051)的关键概念，将抽象的原理转化为可操作的技能。

## 原理与机制

在[群体遗传学](@entry_id:146344)中，理解[等位基因频率](@entry_id:146872)如何随时间演变是核心目标之一。经典的群体遗传学模型，如[Wright-Fisher模型](@entry_id:148998)，为我们提供了从现在向未来展望的视角，预测在[遗传漂变](@entry_id:145594)等进化力量的作用下，基因库将如何变化。然而，当我们面对当今群体中观察到的遗传变异时，我们常常更关心一个“向后看”的问题：这些[基因序列](@entry_id:191077)的历史是怎样的？它们在过去的世代中是如何通过共同的祖先联系在一起的？为了回答这些问题，我们需要一个回溯性的理论框架，这就是**[金曼溯祖](@entry_id:169191)理论（Kingman's Coalescent）**所提供的。本章将深入探讨[基因谱系](@entry_id:172451)的基本原理和溯祖过程的核心机制。

### 从个体谱系到[基因谱系](@entry_id:172451)

首先，我们必须区分**个体谱系（pedigree of individuals）**和**[基因谱系](@entry_id:172451)（genealogy of genes）**。个体谱系描绘了个体间的亲缘关系，例如父母与子女。在一个有性生殖的[二倍体](@entry_id:268054)物种中，一个个体有两个父母，四个祖父母，八个曾祖父母，祖先数量呈指数级增长。然而，当我们追踪单个[基因座](@entry_id:177958)上的一个特定基因拷贝时，它的历史则完全不同。每个基因拷贝在上一代只有一个亲本基因拷贝。因此，如果我们追溯一组基因样本的祖先，这些祖先谱系最终必然会[汇合](@entry_id:148680)到一个单一的祖先基因拷贝上，即**[最近共同祖先](@entry_id:136722)（Most Recent Common Ancestor, MRCA）**。这条追溯基因拷贝起源的路径所形成的树状结构，就是[基因谱系](@entry_id:172451)。[溯祖理论](@entry_id:155051)正是描述这一回溯过程的数学模型 [@problem_id:1931567]。

### 溯祖过程的力学：合并谱系

溯祖过程的核心思想是，当我们从一个群体中抽取一组基因样本并向过去追溯它们的祖先时，这些祖先谱系会随机地两两合并。这个合并事件被称为**溯祖事件（coalescent event）**。为了理解这一过程的速率和模式，我们首先需要一个关于繁殖的基本模型。

#### [Wright-Fisher模型](@entry_id:148998)作为基础

[溯祖理论](@entry_id:155051)通常建立在经典的**[Wright-Fisher模型](@entry_id:148998)**的假设之上。该模型描述了一个理想化的群体，其大小恒定为$N$个个体（对于[二倍体](@entry_id:268054)物种，这意味着有$2N$个基因拷贝），世代不重叠，并且每个后代都是通过从上一代的所有基因拷贝中进行有放回的[随机抽样](@entry_id:175193)而产生的。

在这个框架下，我们可以计算两个特定谱系在上一代发生合并的概率。假设我们有一个大小为$N_e$的理想[二倍体](@entry_id:268054)群体（$N_e$是**有效种群大小**，代表与理想[Wright-Fisher模型](@entry_id:148998)具有相同遗传漂变效应的种群大小），那么在任何一个[基因座](@entry_id:177958)上，总共有$2N_e$个基因拷贝。当我们从当前世代中随机抽取两个基因拷贝并追溯到它们的亲本时，第一个基因拷贝可以来自上一代的$2N_e$个亲本拷贝中的任意一个。为了使第二个基因拷贝与第一个发生溯祖，它必须恰好选择了同一个亲本拷贝。由于抽样是随机且有放回的，这个事件发生的概率是$\frac{1}{2N_e}$。

#### [金曼溯祖](@entry_id:169191)的简化：成对合并

当群体规模$N_e$很大时，任何特定谱系对在单代内发生溯祖的概率都非常小。这也意味着更复杂的事件，例如三个或更[多谱](@entry_id:200847)系在同一代合并到同一个祖先，其概率将变得微不足道。

我们可以通过直接计算来验证这一点。在一个大小为$N$的单倍体群体中，任意选定的两个谱系在上一代发生溯祖的概率$P_2$是$\frac{1}{N}$。而任意选定的三个谱系在同一代溯祖的概率$P_3$是多少呢？这意味着所有三个谱系都必须独立地选择同一个亲本，其概率为$\frac{1}{N} \times \frac{1}{N} = \frac{1}{N^2}$。因此，三谱系合并事件与[双谱](@entry_id:158545)系合并事件的概率之比为$\frac{P_3}{P_2} = \frac{1/N^2}{1/N} = \frac{1}{N}$ [@problem_id:1931573]。当$N$很大时，这个比率趋近于零，这为我们忽略[多谱](@entry_id:200847)系合并事件提供了坚实的数学依据。

更复杂的合并模式，例如四条谱系形成两对独立的溯祖事件，其概率也同样很低。通过精确计算可以证明，对于一个四谱系样本，发生一次双重成对合并事件的概率与发生一次单一成对合并事件的概率之比约为$\frac{1}{2(N-2)}$。只有当种群规模$N$非常小（例如，小于53）时，这种复杂事件的概率才可能超过单一合并事件概率的1% [@problem_id:1931614]。

因此，[金曼溯祖](@entry_id:169191)模型做出了一个关键的简化：在任何时间点，只允许两个谱系发生合并。这一**成对合并（pairwise merger）**的特性极大地简化了[基因谱系](@entry_id:172451)的数学描述，使其成为一个二叉树结构。

### 溯祖的步伐：等待时间

溯祖过程可以被看作是一个等待游戏：我们等待谱系数量从$k$减少到$k-1$。这个等待时间是多久呢？

#### $k$个谱系的溯祖率

如果当前有$k$个独立的祖先谱系，那么有多少对可能的谱系可以发生合并呢？答案是组合数$\binom{k}{2} = \frac{k(k-1)}{2}$。在二倍体群体中，每一对谱系在单代内溯祖的概率是$\frac{1}{2N_e}$。因此，在有$k$个谱系的情况下，下一代发生*任何*一次溯祖事件的总概率（或称**溯祖率**）$\lambda_k$为：
$$
\lambda_k = \frac{\binom{k}{2}}{2N_e} = \frac{k(k-1)}{4N_e}
$$
这个率表示每代发生一次合并事件的概率。由于对于大的$N_e$，这个概率很小，我们可以用一个连续时间的泊松过程来近似这个离散的逐代过程。在这个[连续模](@entry_id:158807)型中，$\lambda_k$成为[指数分布](@entry_id:273894)的速[率参数](@entry_id:265473)。

#### [期望等待时间](@entry_id:274249)

在速率为$\lambda_k$的指数过程中，事件发生的[期望等待时间](@entry_id:274249)是速率的倒数。因此，从拥有$k$个谱系到发生第一次溯祖事件（剩下$k-1$个谱系）的[期望等待时间](@entry_id:274249)$\mathbb{E}[T_k]$（以世代为单位）为：
$$
\mathbb{E}[T_k] = \frac{1}{\lambda_k} = \frac{4N_e}{k(k-1)}
$$
这个简单的公式揭示了溯祖过程的一个深刻特征：**溯祖的节奏是不均匀的**。当谱系数量$k$很大时，分母$k(k-1)$也很大，导致[期望等待时间](@entry_id:274249)$\mathbb{E}[T_k]$非常短。这意味着在谱系的早期历史中（时间上离现在最近），溯祖事件会密集地、快速地发生。相反，当谱系数量减少到很少时（例如，$k=3$或$k=2$），分母变小，[期望等待时间](@entry_id:274249)会急剧增加。

为了具体感受这一点，我们可以比较一个包含$k_A=4$个[病毒基因组](@entry_id:142133)样本与一个包含$k_B=60$个样本的首次溯祖事件的[期望等待时间](@entry_id:274249)。其时间比值为$\frac{\mathbb{E}[T_{k_B}]}{\mathbb{E}[T_{k_A}]} = \frac{k_A(k_A-1)}{k_B(k_B-1)} = \frac{4 \times 3}{60 \times 59} \approx 0.00339$ [@problem_id:1931586]。这表明，拥有60个谱系的群体，其第一次合并事件的预期发生时间，比只有4个谱系的群体快了近300倍。

[基因谱系](@entry_id:172451)的大部分时间跨度实际上由最后几次溯祖事件占据。特别是从两个谱系合并为一个MRCA的最后阶段，其[期望等待时间](@entry_id:274249)为$\mathbb{E}[T_2] = \frac{4N_e}{2(1)} = 2N_e$代。我们可以分析从$n$个谱系追溯到2个谱系（“深度历史”阶段）与最后两个谱系追溯到MRCA（“最终”阶段）的期望时间之比。这个比率仅取决于样本量$n$，为$1 - \frac{2}{n}$ [@problem_id:1931612]。这意味着对于一个$n=10$的样本，从10个谱系合并到2个谱系的全部时间，也仅仅是最后两个谱系合并所需时间的$1 - \frac{2}{10} = 0.8$倍。谱系的“树干”部分（最后两支合并）在时间上占据了主导地位。

### 到达[最近共同祖先](@entry_id:136722)的时间 ([TMRCA](@entry_id:174926))

通过将各个阶段的[期望等待时间](@entry_id:274249)相加，我们可以计算出从一个样本追溯到其MRCA所需的总期望时间。

#### 计算期望[TMRCA](@entry_id:174926)

对于一个大小为$n$的样本，其期望[TMRCA](@entry_id:174926)是谱系数量从$n$减少到$n-1$，再到$n-2$，……，直到从2减少到1的各阶段[期望等待时间](@entry_id:274249)之和：
$$
\mathbb{E}[T_{\text{MRCA}}] = \sum_{k=2}^{n} \mathbb{E}[T_k] = \sum_{k=2}^{n} \frac{4N_e}{k(k-1)}
$$
这个和式有一个非常简洁的解析解。利用[部分分式分解](@entry_id:159208)$\frac{1}{k(k-1)} = \frac{1}{k-1} - \frac{1}{k}$，该级数成为一个伸缩级数：
$$
\sum_{k=2}^{n} \left(\frac{1}{k-1} - \frac{1}{k}\right) = \left(1 - \frac{1}{2}\right) + \left(\frac{1}{2} - \frac{1}{3}\right) + \dots + \left(\frac{1}{n-1} - \frac{1}{n}\right) = 1 - \frac{1}{n}
$$
因此，我们得到了一个计算二倍体群体样本期望[TMRCA](@entry_id:174926)的优雅公式：
$$
\mathbb{E}[T_{\text{MRCA}}] = 4N_e \left(1 - \frac{1}{n}\right)
$$
例如，在一个有效种群大小为$N_e=5000$的昆虫群体中，如果我们采集了7个基因拷贝，它们的MRCA的期望时间就是$4 \times 5000 \times (1 - \frac{1}{7}) \approx 17140$代 [@problem_id:1931629]。对于一个$n=4$的样本，这个公式给出的期望[TMRCA](@entry_id:174926)为$4N_e(1 - \frac{1}{4}) = 3N_e$代 [@problem_id:1931567]。

#### 样本量与[TMRCA](@entry_id:174926)

这个公式还揭示了样本量$n$对[TMRCA](@entry_id:174926)的影响。当$n$从一个很小的值增加时，$\mathbb{E}[T_{\text{MRCA}}]$迅速增加。但随着$n$变得更大，因子$(1 - 1/n)$趋近于1，$\mathbb{E}[T_{\text{MRCA}}]$渐近地接近其上限$4N_e$。这个上限代表了整个群体所有基因拷贝的期望[TMRCA](@entry_id:174926)。

这意味着即使是一个中等大小的样本，其[TMRCA](@entry_id:174926)也已经非常接近整个群体的[TMRCA](@entry_id:174926)。例如，一个包含$k=15$个个体的样本，其期望[TMRCA](@entry_id:174926)是$4N_e(1 - 1/15) \approx 0.933 \times (4N_e)$，已经达到了整个群体期望[TMRCA](@entry_id:174926)的93.3% [@problem_id:1931602]。这解释了一个重要的现象：一个物种内少数几个个体的MRCA，其年代通常远比该物种本身的起源年代要晚近得多。我们抽样的[基因谱系](@entry_id:172451)仅仅是物种漫长[进化史](@entry_id:178692)中一个较近时间点的快照。

### 融合突变：从谱系到[遗传多样性](@entry_id:201444)

到目前为止，我们的讨论都集中在没有突变的谱系结构上。然而，[溯祖理论](@entry_id:155051)的真正威力在于它能够将谱系历史与沿着谱系枝条随机发生的突变过程结合起来，从而预测我们在DNA序列数据中观察到的遗传变异模式。

#### 群体规模参数 $\theta$

想象一下，突变以每基因每代$\mu$的速率随机发生在谱系的枝条上。现在我们从群体中随机抽取两个基因拷贝。它们之间的差异数量将取决于它们分开的时间。它们的分离时间正是它们溯祖所需的时间。对于两个谱系，期望的溯祖时间是$\mathbb{E}[T_2] = 2N_e$代。在这段时间里，有两个谱系枝条在独立地积累突变，所以总的枝长是$2 \times (2N_e) = 4N_e$代。因此，两个随机抽取的序列之间的期望差异数应正比于$4N_e\mu$。

这个复合参数 $\theta = 4N_e\mu$（对于二倍体）或$\theta = 2N_e\mu$（对于单倍体）被称为**群体规模参数**或**群体突变率**。它融合了两个关键的进化参数：有效种群大小$N_e$（影响[遗传漂变](@entry_id:145594)，即溯祖速率）和[突变率](@entry_id:136737)$\mu$。$\theta$是群体遗传学中一个至关重要的量，因为它直接关联到可观测的遗传多样性。

#### 平衡漂变与突变：[期望杂合度](@entry_id:204049)

我们可以通过一个平衡论证来推[导群](@entry_id:141128)体中的遗传多样性。在一个群体中，[遗传漂变](@entry_id:145594)（通过溯祖事件）不断地消除变异，而突变则不断地引入新的变异。在**[突变-漂变平衡](@entry_id:204457)**状态下，这两种力量达到[动态平衡](@entry_id:136767)。

考虑在一个群体中随机抽取两个基因拷贝，它们是**按状态相同（identical by state, IBS）**（即序列完全一样）的概率。这可能因为它们是**按起源相同（identical by descent, IBD）**（即它们在近期[共同祖先](@entry_id:175919)之后没有发生突变）或者它们并非IBD但恰好通过[回复突变](@entry_id:163326)等变得序列相同。在**无限等位基因模型**（infinite-alleles model）的假设下（即每次突变都产生一个全新的等位基因），IBS等同于IBD。

在平衡状态下，两个随机谱系相同的概率$F$可以通过考虑上一代的状态来建立递推关系。这两个谱系在上一代以$\frac{1}{2N_e}$的概率溯祖（成为同一个拷贝），或者以$1 - \frac{1}{2N_e}$的概率没有溯祖。同时，要使它们在当前保持相同，从上一代到现在的两条路径上都不能发生突变（概率为$(1-\mu)^2$）。求解这个[平衡方程](@entry_id:172166)可以得到，两个随机抽取的基因拷贝相同的概率（纯合度）为：
$$
F_{eq} \approx \frac{1}{1 + 4N_e\mu} = \frac{1}{1 + \theta}
$$
我们更常关注的量是**[期望杂合度](@entry_id:204049)（Expected Heterozygosity, $H_e$）**，即两个随机抽取的基因拷贝不同的概率。它就是$1 - F_{eq}$：
$$
H_e = 1 - F_{eq} \approx \frac{4N_e\mu}{1 + 4N_e\mu} = \frac{\theta}{1 + \theta}
$$
[@problem_id:1931637]

#### 应用：从[核苷酸多样性](@entry_id:164565)估计$N_e$

这个理论框架具有强大的实践意义。对于DNA[序列数据](@entry_id:636380)，一个常用的多样性度量是**[核苷酸多样性](@entry_id:164565)（nucleotide diversity, $\pi$）**，它定义为从群体中随机抽取的两个序列之间每个位点的平[均差](@entry_id:138238)异数。在一个[中性演化](@entry_id:172700)、[突变-漂变平衡](@entry_id:204457)的群体中，可以证明$\pi$就是群体规模参数$\theta$的[无偏估计量](@entry_id:756290)。
$$
\pi = \theta = 4N_e\mu
$$
这个简单的关系式威力巨大。如果我们能够从[序列数据](@entry_id:636380)中计算出$\pi$，并从其他来源（如[系统发育](@entry_id:137790)比较）估计出突变率$\mu$，我们就可以反过来求解长期有效种群大小$N_e$。例如，如果在一个深海甲壳类动物群体中测得的[核苷酸多样性](@entry_id:164565)为$\pi = 0.0120$，而已知该区域的[突变率](@entry_id:136737)为$\mu = 2.50 \times 10^{-8}$每位点每代，那么我们可以估计该物种的有效种群大小为：
$$
N_e = \frac{\pi}{4\mu} = \frac{0.0120}{4 \times 2.50 \times 10^{-8}} = 120,000
$$
[@problem_id:1931593]。这展示了[溯祖理论](@entry_id:155051)如何将抽象的数学模型与具体的生物学数据联系起来，使我们能够从今天的遗传变异中洞悉一个群体深刻的进化历史。