{"hands_on_practices": [{"introduction": "要真正掌握天体测量的基本概念，将它们联系起来解决一个物理问题是至关重要的。这个练习旨在巩固你对三角视差、自行和角直径之间关系的理解。通过计算恒星穿过自身角直径所需的时间，你将把这些抽象的测量值转化为一个具体的时间尺度，从而更好地领会它们的物理意义。[@problem_id:894694]", "problem": "从太阳系观测一颗遥远的恒星。它的位置和属性由几个天体测量参数来表征。\n\n三角视差 $p$ 是由于地球轨道运动引起的恒星最大视位置角位移的一半。对于小角度，恒星的距离 $d$ 与其视差的关系为 $d = A/p$，其中 $A$ 是一个天文单位（地球轨道的半径）。按照惯例，如果 $p$ 以角秒为单位测量，则以秒差距（pc）为单位的距离 $d$ 由 $d = 1/p$ 给出。一秒差距是一个天文单位对向一角秒角度的距离。\n\n该恒星的物理半径为 $R$。从地球上看，这个物理尺寸对应于一个角半径 $\\alpha$。对于距离为 $d$ 的恒星，小角度近似给出 $\\alpha \\approx R/d$。因此，角直径为 $\\Theta_D = 2\\alpha$。\n\n该恒星也表现出自行，这是从太阳系质心看，它在天球上的角速度。自行由两个分量描述：赤经 ($\\alpha$) 增加方向的 $\\mu_\\alpha$ 和赤纬 ($\\delta$) 增加方向的 $\\mu_\\delta$。在球面天体坐标网格上，赤经的变化 $\\Delta\\alpha$ 对应于 $(\\Delta\\alpha)\\cos\\delta$ 的角弧长。因此，总自行 $\\mu$ 是两个正交速度分量矢量和的模：一个沿着赤纬圈，一个沿着子午圈。\n\n**问题：**\n\n一颗恒星位于赤纬 $\\delta$ 处。它的三角视差为 $p$，赤经方向的自行为 $\\mu_\\alpha$，赤纬方向的自行为 $\\mu_\\delta$。恒星的物理半径 $R$ 与天文单位 $A$ 的比值由无量纲量 $\\rho = R/A$ 给出。\n\n假设所有相关角度都很小，确定该恒星在天球上移动其自身视角直径的角距离所需的时间 $\\Delta t$。视差 $p$ 和自行的分量 $\\mu_\\alpha$ 和 $\\mu_\\delta$ 分别以角秒和角秒每单位时间为单位给出。用 $p, \\rho, \\mu_\\alpha, \\mu_\\delta,$ 和 $\\delta$ 将你的最终答案表示为一个符号表达式。", "solution": "问题要求计算恒星移动其自身角直径 $\\Theta_D$ 的角距离所需的时间 $\\Delta t$。这个时间可以通过将角距离除以总角速率来求得，总角速率是自行 $\\mu$ 的大小。\n\n$$\n\\Delta t = \\frac{\\Theta_D}{\\mu}\n$$\n\n我们需要根据给定的参数推导出角直径 $\\Theta_D$ 和总自行 $\\mu$ 的表达式。\n\n**第1步：计算角直径 $\\Theta_D$**\n\n恒星的角半径 $\\alpha$ 由小角度近似 $\\alpha \\approx R/d$ 给出，其中 $R$ 是恒星的物理半径， $d$ 是它与地球的距离。角直径是角半径的两倍，所以 $\\Theta_D = 2\\alpha \\approx 2R/d$。\n\n问题提供了比值 $\\rho = R/A$，其中 $A$ 是天文单位。所以，我们可以写成 $R = \\rho A$。\n\n距离 $d$ 与视差 $p$ 相关。根据定义，距离为1秒差距（pc）的恒星具有1角秒（''）的视差。因此，对于以角秒为单位的视差 $p$，以秒差距为单位的距离 $d$ 为 $d~[\\text{pc}] = 1/p~['']$。\n\n为了保持 $R$ 和 $d$ 的单位一致，我们必须用天文单位 $A$ 来表示 $d$。秒差距的定义是1个天文单位（AU）对向1角秒角度的距离。\n$$\n1~\\text{pc} = \\frac{1~A}{\\tan(1'')} \\approx \\frac{1~A}{1''~\\text{in radians}}\n$$\n让我们用天文单位来表示距离 $d$：\n$$\nd~[A] = d~[\\text{pc}] \\times \\frac{1~\\text{pc}}{1~A} = \\left(\\frac{1}{p~['']}\\right) \\times \\frac{1~A/\\tan(1'')}{1~A} = \\frac{1}{p~[''] \\tan(1'')}\n$$\n现在我们可以计算以弧度为单位的角直径：\n$$\n\\Theta_D~[\\text{rad}] = \\frac{2R}{d} = \\frac{2\\rho A}{ \\frac{A}{p~[''] \\tan(1'')} } = 2\\rho p~[''] \\tan(1'')\n$$\n为了以角秒表示角直径，我们注意到对于小角度 $\\theta$，$\\theta~[\\text{rad}] \\approx \\theta~[''] \\times \\tan(1'')$。因此，\n$$\n\\Theta_D~[''] = 2\\rho p~['']\n$$\n恒星的角直径（以角秒为单位）是 $2\\rho p$。\n\n**第2步：计算总自行 $\\mu$**\n\n自行由两个分量给出：$\\mu_\\alpha = d\\alpha/dt$ 和 $\\mu_\\delta = d\\delta/dt$。\n分量 $\\mu_\\delta$ 表示沿天球子午圈的角速度。\n分量 $\\mu_\\alpha$ 是赤经坐标的变化率。在赤纬 $\\delta$ 处，赤经的微分变化 $d\\alpha$ 对应于天球上 $ds_\\alpha = d\\alpha \\cos\\delta$ 的微分弧长。因此，沿赤纬圈的角速度分量是 $v_\\alpha = (d\\alpha/dt)\\cos\\delta = \\mu_\\alpha \\cos\\delta$。\n\n沿子午圈和沿赤纬圈的两个运动分量是正交的。总自行矢量 $\\mu$ 的大小可以用勾股定理求出：\n$$\n\\mu = \\sqrt{(\\mu_\\alpha \\cos\\delta)^2 + \\mu_\\delta^2}\n$$\n如果 $\\mu_\\alpha$ 和 $\\mu_\\delta$ 以角秒每单位时间给出，那么 $\\mu$ 也以角秒每单位时间为单位。\n\n**第3步：计算时间尺度 $\\Delta t$**\n\n现在我们结合前面步骤的结果。恒星移动其角直径所需的时间是：\n$$\n\\Delta t = \\frac{\\Theta_D~['']}{\\mu~[''/\\text{time unit}]}\n$$\n代入推导出的 $\\Theta_D$ 和 $\\mu$ 的表达式：\n$$\n\\Delta t = \\frac{2\\rho p}{\\sqrt{(\\mu_\\alpha \\cos\\delta)^2 + \\mu_\\delta^2}}\n$$\n如果自行分量以角秒/年给出，则所得的时间尺度 $\\Delta t$ 将以年为单位。", "answer": "$$ \\boxed{\\frac{2 \\rho p}{\\sqrt{(\\mu_\\alpha \\cos\\delta)^2 + \\mu_\\delta^2}}} $$", "id": "894694"}, {"introduction": "在天文学中，任何测量都伴随着不确定性，理解这些不确定性如何影响最终的科学结论是至关重要的。这个问题将引导你从理想化的测量转向更现实的情景，探索视差和自行测量中的误差如何传递到切向速度的计算中。通过确定一个“临界距离”，你将学会量化不同误差源的贡献，这是评估观测策略和数据质量的一项关键技能。[@problem_id:894652]", "problem": "一项天文巡天测量太阳邻域中恒星的性质。恒星的切向速度 $v_t$ 由其三角视差 $p$ 和自行大小 $\\mu$ 决定。该关系可以写作 $v_t = K (\\mu/p)$，其中 $K$ 是一个常数，其值取决于单位制。视差 $p$（单位为角秒）与距离 $d$（单位为秒差距）通过常规公式 $d = 1/p$ 相关联。\n\n对于一颗特定的恒星，巡天测量提供了其视差的测量值，不确定度为 $\\sigma_p$。恒星的自行 $\\mu$ 是通过比较在持续时间为 $T$ 的时间间隔的开始和结束时进行的两次角位置测量来确定的。在单个角方向（例如，赤经或赤纬）上单次位置测量的不确定度为 $\\sigma_{pos}$。\n\n假设视差和两次位置测量的测量误差在统计上是相互独立的，请确定临界距离 $d_c$。这是指在该距离上，切向速度的不确定度 $\\sigma_{v_t}$ 从视差测量的的不确定度和自行测量的不确定度中获得的贡献相等。\n\n用 $\\mu$、$\\sigma_p$、$\\sigma_{pos}$ 和 $T$ 表示你的答案 $d_c$，单位为秒差距。输入量均采用一致的单位制：$\\mu$ 的单位是角秒/年，$\\sigma_p$ 的单位是角秒，$\\sigma_{pos}$ 的单位是角秒，而 $T$ 的单位是年。", "solution": "1. 相关关系：\n   vₜ = K μ/p,   d = 1/p.\n2. 不确定度：\n   ∂vₜ/∂p = −K μ/p² ⇒ σ_{vₜ,p} = (K μ/p²) σ_p.\n   ∂vₜ/∂μ = K/p     ⇒ σ_{vₜ,μ} = (K/p) σ_μ.\n3. 当 σ_{vₜ,p} = σ_{vₜ,μ} 时的临界距离：\n   (K μ/p²) σ_p = (K/p) σ_μ\n   ⇒ μ σ_p/p² = σ_μ/p\n   ⇒ p = μ σ_p/σ_μ\n   ⇒ d_c = 1/p = σ_μ/(μ σ_p).\n4. 在两个正交方向上，经过时间 T 对两个位置（每个不确定度为 σ_{pos}）进行测量得到的自行不确定度：\n   σ_{Δθ_x} = σ_{Δθ_y} = √(σ_{pos}²+σ_{pos}²) = √2 σ_{pos},\n   μ = |Δθ|/T ⇒ σ_μ = √2 σ_{pos}/T.\n5. 代入 d_c：\n   d_c = (√2 σ_{pos}/T)/(μ σ_p)\n         = √2 σ_{pos}/(μ σ_p T).", "answer": "$$\\boxed{\\frac{\\sqrt{2}\\,\\sigma_{pos}}{\\mu\\,\\sigma_{p}\\,T}}$$", "id": "894652"}, {"introduction": "现代天文学严重依赖于复杂的计算方法从原始数据中提取物理参数。这个实践练习将让你扮演一名数据分析天文学家的角色，使用加权最小二乘法这一标准技术来拟合天体测量模型。通过处理带有不同不确定性的时间序列数据，你不仅能解出恒星的视差和自行，还将计算它们的不确定性，这完整地模拟了现代天体测量学中的核心任务。[@problem_id:2412407]", "problem": "一个单一、紧凑的线性天体测量模型将恒星在历元 $t_i$ 处测得的角坐标与三个未知参数关联起来：一个参考角偏移量 $\\theta_0$（在指定的参考历元 $t_0$ 处）、一个线性自行 $\\mu$ 和一个标量视差 $\\pi$（其乘以一个已知的无量纲视差因子 $P_i$）。该模型为\n$$\ny_i \\;=\\; \\theta_0 \\;+\\; \\mu \\,\\bigl(t_i - t_0\\bigr) \\;+\\; \\pi\\, P_i \\;+\\; \\varepsilon_i,\n$$\n其中每个 $\\varepsilon_i$ 是一个独立的零均值高斯误差，其标准差 $\\sigma_i$ 已知。所有角度 $y_i$、$\\theta_0$ 和 $\\pi$ 的单位均为毫角秒 $\\mathrm{(mas)}$，自行 $\\mu$ 的单位为 $\\mathrm{mas/yr}$，时间 $t_i$ 和 $t_0$ 的单位为 $\\mathrm{yr}$，视差因子 $P_i$ 是无量纲的。\n\n你的任务是，对下面提供的每个测试用例，确定在上述模型下使高斯似然最大化的参数三元组 $\\bigl(\\pi,\\mu,\\theta_0\\bigr)$，以及从解处的对数似然的局部曲率（逆黑塞矩阵）获得的一倍标准差不确定度。将这三个标准不确定度表示为 $\\bigl(\\sigma_\\pi,\\sigma_\\mu,\\sigma_{\\theta_0}\\bigr)$。所有报告的角度单位必须是 $\\mathrm{mas}$，自行的单位必须是 $\\mathrm{mas/yr}$。将报告的每个实数四舍五入到恰好 $6$ 位小数。\n\n给定一个所有用例共用的参考历元 $t_0$：\n- $t_0 = 2022.0 \\ \\mathrm{yr}$。\n\n测试套件。对每个用例，数组 $t$、$P$、$y$ 和 $\\sigma$ 均已明确给出。使用上述模型及指定的单位。\n\n- 用例 $1$:\n  - $t \\ \\mathrm{(yr)} = [2020.0, \\ 2020.5, \\ 2021.0, \\ 2021.5, \\ 2022.0, \\ 2022.5, \\ 2023.0, \\ 2023.5]$。(年)\n  - $P \\ \\text{(dimensionless)} = [0.1, \\ -0.5, \\ -0.9, \\ -0.2, \\ 0.3, \\ 0.8, \\ 0.2, \\ -0.6]$。(无量纲)\n  - $y \\ \\mathrm{(mas)} = [4.72, \\ 1.9, \\ 0.52, \\ 7.06, \\ 12.16, \\ 17.26, \\ 14.44, \\ 10.18]$。(毫角秒)\n  - $\\sigma \\ \\mathrm{(mas)} = [0.8, \\ 1.2, \\ 0.7, \\ 1.5, \\ 0.5, \\ 0.9, \\ 0.6, \\ 1.0]$。(毫角秒)\n\n- 用例 $2$:\n  - $t \\ \\mathrm{(yr)} = [2021.0, \\ 2021.4, \\ 2021.8, \\ 2022.2, \\ 2022.6, \\ 2023.0]$。(年)\n  - $P \\ \\text{(dimensionless)} = [0.01, \\ -0.02, \\ 0.03, \\ -0.01, \\ 0.02, \\ -0.03]$。(无量纲)\n  - $y \\ \\mathrm{(mas)} = [4.52, \\ 4.66, \\ 4.96, \\ 5.08, \\ 5.34, \\ 5.44]$。(毫角秒)\n  - $\\sigma \\ \\mathrm{(mas)} = [2.0, \\ 2.5, \\ 1.8, \\ 2.2, \\ 2.0, \\ 2.8]$。(毫角秒)\n\n- 用例 $3$:\n  - $t \\ \\mathrm{(yr)} = [2021.0, \\ 2022.0, \\ 2023.0]$。(年)\n  - $P \\ \\text{(dimensionless)} = [0.5, \\ -0.3, \\ 0.7]$。(无量纲)\n  - $y \\ \\mathrm{(mas)} = [4.5, \\ -0.2, \\ 2.3]$。(毫角秒)\n  - $\\sigma \\ \\mathrm{(mas)} = [1.0, \\ 10.0, \\ 0.2]$。(毫角秒)\n\n要求的最终输出格式。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例贡献一个子列表，顺序与上述用例相同。每个子列表必须是\n$$\n[\\ \\pi,\\ \\mu,\\ \\theta_0,\\ \\sigma_\\pi,\\ \\sigma_\\mu,\\ \\sigma_{\\theta_0}\\ ],\n$$\n其中每个实数都四舍五入到恰好 $6$ 位小数，并使用上述指定的单位。因此，整体输出必须看起来像这样\n$$\n\\bigl[ [\\cdots], [\\cdots], [\\cdots] \\bigr]\n$$\n且在单行上。", "solution": "所提出的问题是一个标准的参数估计任务，涉及带有非均匀方差高斯噪声的线性模型。这是一个经典的加权线性最小二乘问题，它具有科学依据、是良态的且信息完备。所有必要的数据和定义都已提供。因此，我们可以直接进行求解。\n\n对于每次测量 $i$，天体测量模型给出如下：\n$$\ny_i \\;=\\; \\theta_0 \\;+\\; \\mu \\,\\bigl(t_i - t_0\\bigr) \\;+\\; \\pi\\, P_i \\;+\\; \\varepsilon_i\n$$\n其中 $y_i$ 是测量值，$(\\pi, \\mu, \\theta_0)$ 是待确定的参数，$(t_i, t_0, P_i)$ 是已知系数，$\\varepsilon_i$ 是从均值为 $0$、标准差为 $\\sigma_i$ 的高斯分布中抽取的随机误差。\n\n为求解这些参数，我们将问题重写为矩阵形式。设观测次数为 $N$。这 $N$ 个线性方程组可以写成 $\\boldsymbol{y} = \\boldsymbol{A}\\boldsymbol{x} + \\boldsymbol{\\varepsilon}$，其中：\n- $\\boldsymbol{y}$ 是 $N \\times 1$ 的观测值列向量 $[y_1, y_2, \\dots, y_N]^T$。\n- $\\boldsymbol{x}$ 是 $3 \\times 1$ 的未知参数列向量。为匹配所要求的输出格式，我们定义它为 $\\boldsymbol{x} = [\\pi, \\mu, \\theta_0]^T$。\n- $\\boldsymbol{A}$ 是 $N \\times 3$ 的设计矩阵，其中每行对应一次观测，每列对应一个参数。元素 $A_{ij}$ 是第 $i$ 次观测方程中第 $j$ 个参数的系数。根据我们对 $\\boldsymbol{x}$ 的定义，设计矩阵为\n$$\n\\boldsymbol{A} = \\begin{pmatrix}\nP_1  t_1 - t_0  1 \\\\\nP_2  t_2 - t_0  1 \\\\\n\\vdots  \\vdots  \\vdots \\\\\nP_N  t_N - t_0  1\n\\end{pmatrix}\n$$\n- $\\boldsymbol{\\varepsilon}$ 是 $N \\times 1$ 的随机误差列向量 $[\\varepsilon_1, \\varepsilon_2, \\dots, \\varepsilon_N]^T$。\n\n该问题要求在给定参数的情况下，最大化数据的高斯似然。对数似然函数 $\\ln \\mathcal{L}(\\boldsymbol{x})$ 为：\n$$\n\\ln \\mathcal{L}(\\boldsymbol{x}) = -\\frac{1}{2} \\sum_{i=1}^N \\left[ \\left( \\frac{y_i - (\\boldsymbol{A}\\boldsymbol{x})_i}{\\sigma_i} \\right)^2 + \\ln(2\\pi\\sigma_i^2) \\right]\n$$\n最大化 $\\ln \\mathcal{L}(\\boldsymbol{x})$ 等价于最小化卡方统计量 $\\chi^2(\\boldsymbol{x})$，其定义为：\n$$\n\\chi^2(\\boldsymbol{x}) = \\sum_{i=1}^N \\left( \\frac{y_i - (\\boldsymbol{A}\\boldsymbol{x})_i}{\\sigma_i} \\right)^2\n$$\n这可以写成矩阵形式 $\\chi^2(\\boldsymbol{x}) = (\\boldsymbol{y} - \\boldsymbol{A}\\boldsymbol{x})^T \\boldsymbol{W} (\\boldsymbol{y} - \\boldsymbol{A}\\boldsymbol{x})$，其中 $\\boldsymbol{W}$ 是权重矩阵，一个对角矩阵，其元素为 $W_{ii} = 1/\\sigma_i^2$。\n\n为了找到使 $\\chi^2$ 最小化的参数向量 $\\boldsymbol{\\hat{x}}$，我们将 $\\chi^2$ 对 $\\boldsymbol{x}$ 的梯度设为零：\n$$\n\\frac{\\partial\\chi^2}{\\partial\\boldsymbol{x}} = -2 \\boldsymbol{A}^T \\boldsymbol{W} (\\boldsymbol{y} - \\boldsymbol{A}\\boldsymbol{x}) = \\boldsymbol{0}\n$$\n这就得到了加权最小二乘问题的正规方程：\n$$\n(\\boldsymbol{A}^T \\boldsymbol{W} \\boldsymbol{A}) \\boldsymbol{x} = \\boldsymbol{A}^T \\boldsymbol{W} \\boldsymbol{y}\n$$\n最佳拟合参数 $\\boldsymbol{\\hat{x}}$ 的解通过求解这个线性系统得到：\n$$\n\\boldsymbol{\\hat{x}} = (\\boldsymbol{A}^T \\boldsymbol{W} \\boldsymbol{A})^{-1} (\\boldsymbol{A}^T \\boldsymbol{W} \\boldsymbol{y})\n$$\n矩阵 $\\boldsymbol{C}_{\\boldsymbol{x}} = (\\boldsymbol{A}^T \\boldsymbol{W} \\boldsymbol{A})^{-1}$ 是估计参数 $\\boldsymbol{\\hat{x}}$ 的协方差矩阵。正如问题陈述所要求的，该矩阵恰好是对数似然函数的黑塞矩阵在解 $\\boldsymbol{\\hat{x}}$ 处求值的逆的负数。$\\ln\\mathcal{L}$ 的黑塞矩阵是 $\\boldsymbol{H} = \\frac{\\partial^2(\\ln\\mathcal{L})}{\\partial\\boldsymbol{x}\\partial\\boldsymbol{x}^T} = -\\boldsymbol{A}^T\\boldsymbol{W}\\boldsymbol{A}$，对于此线性模型，它是一个常数矩阵。因此，协方差矩阵为 $\\boldsymbol{C}_{\\boldsymbol{x}} = (-\\boldsymbol{H})^{-1} = (\\boldsymbol{A}^T \\boldsymbol{W} \\boldsymbol{A})^{-1}$。\n\n参数的一倍标准差不确定度是协方差矩阵 $\\boldsymbol{C}_{\\boldsymbol{x}}$ 对角元素的平方根。具体来说，如果 $\\boldsymbol{C}_{\\boldsymbol{x}}$ 的对角元素为 $C_{11}, C_{22}, C_{33}$，则：\n$$\n\\sigma_{\\pi} = \\sqrt{C_{11}}, \\quad \\sigma_{\\mu} = \\sqrt{C_{22}}, \\quad \\sigma_{\\theta_0} = \\sqrt{C_{33}}\n$$\n以下算法为每个测试用例实现了此解法。\n$1$. 根据给定数据构建设计矩阵 $\\boldsymbol{A}$ 和观测向量 $\\boldsymbol{y}$。\n$2$. 构建权重向量 $w_i = 1/\\sigma_i^2$。\n$3$. 计算矩阵 $\\boldsymbol{M} = \\boldsymbol{A}^T \\boldsymbol{W} \\boldsymbol{A}$ 和向量 $\\boldsymbol{b} = \\boldsymbol{A}^T \\boldsymbol{W} \\boldsymbol{y}$。在计算上，这是在不显式构造对角矩阵 $\\boldsymbol{W}$ 的情况下完成的。例如，$\\boldsymbol{M}$ 可计算为 $\\boldsymbol{A}^T (\\boldsymbol{A} \\odot \\boldsymbol{w})$，其中 $\\odot$ 表示与权重向量 $\\boldsymbol{w}$ 的逐行相乘。\n$4$. 求解线性系统 $\\boldsymbol{M}\\boldsymbol{x} = \\boldsymbol{b}$，得到参数向量 $\\boldsymbol{\\hat{x}}$。\n$5$. 通过计算 $\\boldsymbol{M}^{-1}$ 来得到协方差矩阵 $\\boldsymbol{C}_{\\boldsymbol{x}}$。\n$6$. 通过取 $\\boldsymbol{C}_{\\boldsymbol{x}}$ 对角元素的平方根来提取不确定度。\n$7$. 将最终结果按规定进行组装和格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the astrometric parameters and their uncertainties for a set of test cases\n    using a weighted linear least-squares method.\n    \"\"\"\n    \n    # Common reference epoch for all cases.\n    t0 = 2022.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"t\": np.array([2020.0, 2020.5, 2021.0, 2021.5, 2022.0, 2022.5, 2023.0, 2023.5]),\n            \"P\": np.array([0.1, -0.5, -0.9, -0.2, 0.3, 0.8, 0.2, -0.6]),\n            \"y\": np.array([4.72, 1.9, 0.52, 7.06, 12.16, 17.26, 14.44, 10.18]),\n            \"sigma\": np.array([0.8, 1.2, 0.7, 1.5, 0.5, 0.9, 0.6, 1.0]),\n        },\n        {\n            \"t\": np.array([2021.0, 2021.4, 2021.8, 2022.2, 2022.6, 2023.0]),\n            \"P\": np.array([0.01, -0.02, 0.03, -0.01, 0.02, -0.03]),\n            \"y\": np.array([4.52, 4.66, 4.96, 5.08, 5.34, 5.44]),\n            \"sigma\": np.array([2.0, 2.5, 1.8, 2.2, 2.0, 2.8]),\n        },\n        {\n            \"t\": np.array([2021.0, 2022.0, 2023.0]),\n            \"P\": np.array([0.5, -0.3, 0.7]),\n            \"y\": np.array([4.5, -0.2, 2.3]),\n            \"sigma\": np.array([1.0, 10.0, 0.2]),\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        t_vec = case[\"t\"]\n        P_vec = case[\"P\"]\n        y_vec = case[\"y\"]\n        sigma_vec = case[\"sigma\"]\n\n        # 1. Construct the design matrix A. The columns correspond to the parameters\n        #    pi, mu, theta_0 respectively.\n        dt_vec = t_vec - t0\n        ones_vec = np.ones_like(t_vec)\n        # Shape: (N, 3) where N is the number of observations.\n        A = np.vstack([P_vec, dt_vec, ones_vec]).T\n\n        # 2. Construct the vector of weights w = 1 / sigma^2.\n        w_vec = 1.0 / (sigma_vec**2)\n\n        # 3. Form the components of the normal equations.\n        #    (A.T @ W @ A) and (A.T @ W @ y), where W is a diagonal matrix of weights.\n        #    This is implemented efficiently without forming W explicitly.\n        \n        # M = A.T @ W @ A\n        # Multiply each row of A by its corresponding weight before the matrix products.\n        # A_weighted has shape (N, 3), w_vec[:, np.newaxis] broadcasts w_vec.\n        A_weighted = A * w_vec[:, np.newaxis]\n        M = A.T @ A_weighted\n        \n        # b = A.T @ W @ y\n        # Multiply y by weights before the matrix product.\n        y_weighted = y_vec * w_vec\n        b = A.T @ y_weighted\n\n        # 4. Solve the linear system M @ x = b for the parameter vector x.\n        x_hat = np.linalg.solve(M, b)\n        \n        # 5. Compute the covariance matrix by inverting M.\n        cov_matrix = np.linalg.inv(M)\n\n        # 6. The uncertainties are the square roots of the diagonal elements of the covariance matrix.\n        uncertainties = np.sqrt(np.diag(cov_matrix))\n        \n        # Unpack parameters and uncertainties\n        pi, mu, theta_0 = x_hat\n        sigma_pi, sigma_mu, sigma_theta_0 = uncertainties\n        \n        case_result = [pi, mu, theta_0, sigma_pi, sigma_mu, sigma_theta_0]\n        all_results.append(case_result)\n\n    # Format the final output as a comma-separated list of lists, with each number\n    # rounded to exactly 6 decimal places.\n    formatted_results = []\n    for res_list in all_results:\n        formatted_list = [f\"{x:.6f}\" for x in res_list]\n        formatted_results.append(f\"[{','.join(formatted_list)}]\")\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2412407"}]}