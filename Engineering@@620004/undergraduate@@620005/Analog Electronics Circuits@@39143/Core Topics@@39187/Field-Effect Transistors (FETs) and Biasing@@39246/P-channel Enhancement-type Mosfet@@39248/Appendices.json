{"hands_on_practices": [{"introduction": "The source follower, or common-drain amplifier, is a fundamental building block in analog circuit design, valued for its high input impedance and low output impedance. This exercise [@problem_id:1323366] explores a practical application of a PMOS source follower as a DC level shifter, which is essential for interfacing circuit blocks operating at different voltage levels. By performing a small-signal analysis, you will determine its voltage gain and input impedance, gaining insight into how key transistor parameters like transconductance ($g_m$), output resistance ($r_o$), and body-effect transconductance ($g_{mb}$) influence the performance of this versatile circuit.", "problem": "Consider a level shifter circuit built using a single p-channel enhancement-type Metal-Oxide-Semiconductor Field-Effect Transistor (PMOS), denoted as $M_1$. The drain of $M_1$ is connected to ground (0 V). The source of $M_1$ is connected to a resistor $R_S$, whose other terminal is connected to a negative DC supply voltage. The body (substrate) of the transistor is also connected to ground. The input, a small-signal AC voltage $v_{in}$, is applied to the gate of $M_1$. The output, $v_{out}$, is taken at the source of $M_1$.\n\nFor small-signal analysis, the transistor is characterized by its transconductance $g_m$, its intrinsic output resistance $r_o$, and its body-effect transconductance $g_{mb}$, which accounts for the influence of the source-to-body voltage.\n\nDetermine the input impedance $Z_{in}$ of the circuit and its small-signal voltage gain $A_v = v_{out}/v_{in}$. Present your answer for the pair $(Z_{in}, A_v)$ as a single symbolic expression in the form of a $1 \\times 2$ row matrix in terms of the given parameters.", "solution": "Let the small-signal gate, source, drain, and body voltages be denoted by $v_{g}$, $v_{s}$, $v_{d}$, and $v_{b}$, respectively. In AC small-signal, the DC supplies are AC ground, so $v_{d}=0$ (drain to ground), the negative supply is AC ground (the lower end of $R_{S}$ is at AC ground), and $v_{b}=0$ (body to ground). The input is $v_{in}=v_{g}$ and the output is $v_{out}=v_{s}$.\n\nUse the hybrid-$\\pi$ small-signal model with:\n- A resistor $r_{o}$ between drain and source.\n- A dependent current source from drain to source of value $i_{d}=g_{m}v_{gs}+g_{mb}v_{bs}$, where $v_{gs}=v_{g}-v_{s}$ and $v_{bs}=v_{b}-v_{s}$.\n\nInput impedance. The MOS gate draws no DC or low-frequency small-signal current in this model (no gate leakage or capacitances are included), so $i_{in}=0$ and therefore\n$$\nZ_{in}=\\frac{v_{in}}{i_{in}}=\\infty.\n$$\n\nVoltage gain. Write KCL at the source node. Currents from the source node to AC ground are through $R_{S}$ and $r_{o}$, equal to $v_{s}/R_{S}$ and $v_{s}/r_{o}$, respectively. The dependent current source injects $i_{d}$ from drain (ground) into the source node, with\n$$\ni_{d}=g_{m}v_{gs}+g_{mb}v_{bs}=g_{m}(v_{g}-v_{s})+g_{mb}(0-v_{s})=g_{m}v_{g}-(g_{m}+g_{mb})v_{s}.\n$$\nKCL at the source node gives\n$$\n\\frac{v_{s}}{R_{S}}+\\frac{v_{s}}{r_{o}}=i_{d}=g_{m}v_{g}-(g_{m}+g_{mb})v_{s}.\n$$\nRearrange to collect $v_{s}$ terms:\n$$\n\\left(\\frac{1}{R_{S}}+\\frac{1}{r_{o}}+g_{m}+g_{mb}\\right)v_{s}=g_{m}v_{g}.\n$$\nHence the small-signal gain is\n$$\nA_{v}=\\frac{v_{out}}{v_{in}}=\\frac{v_{s}}{v_{g}}=\\frac{g_{m}}{g_{m}+g_{mb}+\\frac{1}{R_{S}}+\\frac{1}{r_{o}}}.\n$$\nTherefore, the requested pair is\n$$\n\\left(Z_{in},\\,A_{v}\\right)=\\left(\\infty,\\,\\frac{g_{m}}{g_{m}+g_{mb}+\\frac{1}{R_{S}}+\\frac{1}{r_{o}}}\\right).\n$$", "answer": "$$\\boxed{\\begin{pmatrix}\\infty  \\dfrac{g_{m}}{g_{m}+g_{mb}+\\dfrac{1}{R_{S}}+\\dfrac{1}{r_{o}}}\\end{pmatrix}}$$", "id": "1323366"}, {"introduction": "Achieving high voltage gain is a primary objective in amplifier design. While a simple common-source amplifier is limited, its performance can be dramatically improved by using an active load with high dynamic resistance. This practice [@problem_id:1323378] challenges you to analyze a high-performance amplifier stage that combines a PMOS driver with an NMOS cascode current source, a sophisticated active load topology. Your goal is to derive the overall voltage gain, which will demonstrate how the cascode structure boosts the output impedance to deliver superior amplification.", "problem": "Consider an amplifier stage built using Metal-Oxide-Semiconductor Field-Effect Transistors (MOSFETs). This stage is designed to achieve a high voltage gain.\n\nThe primary amplifying device is a p-channel enhancement-type MOSFET, denoted as $M_1$. Its source terminal is connected to the positive power supply voltage, $V_{DD}$. Its gate terminal serves as the input port for the small-signal voltage $v_{in}$, superimposed on a DC bias. Its drain terminal is the amplifier's output port, providing the signal $v_{out}$.\n\nThe active load for this amplifier is implemented as a cascode current source, which provides a high dynamic output resistance. This load is constructed from two n-channel enhancement-type MOSFETs, denoted as $M_2$ and $M_3$. The drain of transistor $M_2$ is connected to the output node (i.e., the drain of $M_1$). The gate of $M_2$ is connected to a stable DC bias voltage $V_{B1}$. The source of $M_2$ is connected to the drain of $M_3$. Transistor $M_3$ has its source terminal connected to ground, and its gate is connected to a second stable DC bias voltage $V_{B2}$. The bulk terminal of all n-channel transistors is connected to ground.\n\nAssume that all transistors are biased to operate in the saturation region. The relevant small-signal parameters for each transistor $M_i$ (where $i=1, 2, 3$) are its transconductance, $g_{mi}$, and its finite output resistance, $r_{oi}$. Because the source of transistor $M_2$ is not connected to its bulk, it is subject to the body effect, which introduces a body-effect transconductance, $g_{mb2}$.\n\nYour task is to derive a single, closed-form analytic expression for the overall small-signal voltage gain, $A_v = v_{out} / v_{in}$, of this amplifier stage. Your final expression should be in terms of the given small-signal parameters: $g_{m1}, r_{o1}, g_{m2}, r_{o2}, g_{m3}, r_{o3}$, and $g_{mb2}$.", "solution": "Treat all DC bias sources, including $V_{DD}$, $V_{B1}$, and $V_{B2}$, as AC grounds. Use small-signal hybrid-$\\pi$ models with parameters $g_{mi}$ and $r_{oi}$ for $M_{i}$, and include $g_{mb2}$ for $M_{2}$ due to body effect. Let the output node be $v_{x} \\equiv v_{out}$ and the internal node between $M_{2}$ and $M_{3}$ be $v_{y}$. The gates of $M_{2}$ and $M_{3}$ are at AC ground.\n\nFor the p-channel device $M_{1}$ with source at AC ground, the dependent source from source to drain is $g_{m1} v_{sg1}$; thus the current leaving node $v_{x}$ due to $M_{1}$’s transconductance is $-g_{m1} v_{sg1} = g_{m1} v_{in}$ because $v_{sg1} = -v_{in}$. The current through $r_{o1}$ leaving node $v_{x}$ is $v_{x}/r_{o1}$.\n\nFor $M_{2}$ (nMOS), with $v_{gs2} = -v_{y}$, $v_{bs2} = -v_{y}$, and $v_{ds2} = v_{x} - v_{y}$, the current from drain to source (leaving node $v_{x}$) is\n$$\ni_{d2} = g_{m2} v_{gs2} + g_{mb2} v_{bs2} + \\frac{v_{ds2}}{r_{o2}} = -(g_{m2} + g_{mb2}) v_{y} + \\frac{v_{x} - v_{y}}{r_{o2}}.\n$$\nFor $M_{3}$ (nMOS), with $v_{gs3} = 0$ and $v_{ds3} = v_{y}$, the current leaving node $v_{y}$ is $v_{y}/r_{o3}$.\n\nWrite KCL at node $v_{x}$ (sum of currents leaving equals zero):\n$$\ng_{m1} v_{in} + \\frac{v_{x}}{r_{o1}} - (g_{m2} + g_{mb2}) v_{y} + \\frac{v_{x} - v_{y}}{r_{o2}} = 0,\n$$\nwhich rearranges to\n$$\n\\left( \\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} \\right) v_{x} + \\left( -\\frac{1}{r_{o2}} - g_{m2} - g_{mb2} \\right) v_{y} + g_{m1} v_{in} = 0.\n$$\nWrite KCL at node $v_{y}$ (sum of currents leaving equals zero). The current leaving via $M_{2}$ from source to drain is the negative of $i_{d2}$:\n$$\n(g_{m2} + g_{mb2}) v_{y} - \\frac{v_{x} - v_{y}}{r_{o2}} + \\frac{v_{y}}{r_{o3}} = 0,\n$$\nwhich simplifies to\n$$\n-\\frac{1}{r_{o2}} v_{x} + \\left( g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} \\right) v_{y} = 0.\n$$\nSolve for $v_{y}$ in terms of $v_{x}$:\n$$\nv_{y} = \\frac{ \\frac{1}{r_{o2}} }{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} } \\, v_{x}.\n$$\nSubstitute this into the $v_{x}$-KCL equation:\n$$\n\\left( \\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} \\right) v_{x} - \\left( \\frac{1}{r_{o2}} + g_{m2} + g_{mb2} \\right) \\frac{ \\frac{1}{r_{o2}} }{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} } v_{x} + g_{m1} v_{in} = 0.\n$$\nDefine $A \\equiv g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}}$. The coefficient of $v_{x}$ simplifies as\n$$\n\\frac{1}{r_{o1}} + \\frac{1}{r_{o2}} - \\left( \\frac{1}{r_{o2}} + g_{m2} + g_{mb2} \\right) \\frac{ \\frac{1}{r_{o2}} }{ A }\n= \\frac{1}{r_{o1}} + \\frac{ \\frac{1}{r_{o2}} \\frac{1}{r_{o3}} }{ A }.\n$$\nHence\n$$\n\\left[ \\frac{1}{r_{o1}} + \\frac{ \\frac{1}{r_{o2}} \\frac{1}{r_{o3}} }{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} } \\right] v_{x} + g_{m1} v_{in} = 0,\n$$\nso\n$$\n\\frac{v_{out}}{v_{in}} = \\frac{v_{x}}{v_{in}} = - \\frac{ g_{m1} }{ \\frac{1}{r_{o1}} + \\frac{ \\frac{1}{r_{o2}} \\frac{1}{r_{o3}} }{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} } }.\n$$\nRecognizing that the load network’s output resistance is\n$$\nR_{\\text{load}} = \\frac{ g_{m2} + g_{mb2} + \\frac{1}{r_{o2}} + \\frac{1}{r_{o3}} }{ \\frac{1}{r_{o2}} \\frac{1}{r_{o3}} } = r_{o2} + r_{o3} + (g_{m2} + g_{mb2}) r_{o2} r_{o3},\n$$\nthe overall gain can be written in a single closed form without parallel-notation as\n$$\nA_{v} = - g_{m1} \\frac{ r_{o1} \\left[ r_{o2} + r_{o3} + (g_{m2} + g_{mb2}) r_{o2} r_{o3} \\right] }{ r_{o1} + r_{o2} + r_{o3} + (g_{m2} + g_{mb2}) r_{o2} r_{o3} }.\n$$\nThis expression is exact under the stated small-signal model and includes the body-effect contribution $g_{mb2}$.", "answer": "$$\\boxed{-g_{m1}\\frac{r_{o1}\\left[r_{o2}+r_{o3}+\\left(g_{m2}+g_{mb2}\\right)r_{o2}r_{o3}\\right]}{r_{o1}+r_{o2}+r_{o3}+\\left(g_{m2}+g_{mb2}\\right)r_{o2}r_{o3}}}$$", "id": "1323378"}, {"introduction": "PMOS transistors are not just for amplification; their properties can be cleverly exploited to create new functionalities. A fascinating example is the gyrator, a circuit that can simulate an inductor—a component that is notoriously difficult and costly to implement on an integrated circuit. In this thought-provoking exercise [@problem_id:1323383], you will analyze a gyrator built from two PMOS transistors and a capacitor. By deriving its input impedance, you will discover how this configuration transforms the capacitive behavior into an inductive one, a cornerstone technique in modern on-chip filter design.", "problem": "A gyrator is a crucial circuit in modern analog integrated circuit design, allowing for the simulation of a large inductor using small, on-chip components like transistors and capacitors. Consider a gyrator circuit constructed from two p-channel enhancement-type MOSFETs (PMOS), labeled M1 and M2, and a single capacitor, C.\n\nThe circuit is configured as follows:\n- Transistor M1 is set up as a source follower. Its drain is connected to the main supply voltage, $V_{DD}$. Its gate serves as the primary input terminal for the entire circuit. Its source is connected to an internal node, which we will call Node X.\n- Transistor M2 is set up as a common-source amplifier. Its source is connected to $V_{DD}$. Its gate is connected to Node X. Its drain is connected back to the gate of M1, which is the circuit's input terminal.\n- A capacitor of capacitance C is connected between Node X and the supply voltage $V_{DD}$.\n- The input impedance, $Z_{in}$, is defined at the circuit's input terminal (the gate of M1), where a small-signal test voltage $v_{in}$ results in a small-signal input current $i_{in}$.\n\nAssume that both transistors are biased to operate in the saturation region. Let their transconductances be $g_{m1}$ and $g_{m2}$ for M1 and M2, respectively. For this analysis, you must neglect the body effect and the channel-length modulation effect (i.e., assume the transistor output resistance $r_o$ is infinite) for both devices.\n\nBased on this configuration, the circuit's input impedance simulates that of a resistor in series with an inductor. Determine the symbolic expression for the equivalent inductance, $L_{eq}$, that this circuit presents at its input terminal.", "solution": "Let the small-signal input voltage be $v_{in}$ (at the gate of M1 and drain of M2), and the small-signal voltage at Node X be $v_{x}$. The supply voltage $V_{DD}$ is treated as an AC ground. We use the small-signal model for a PMOS where the current from source to drain is $i_{sd} = g_{m} v_{sg}$, where $v_{sg} = v_{s} - v_{g}$. We assume $r_o \\to \\infty$ and no body effect.\n\nFirst, apply Kirchhoff’s Current Law (KCL) at Node X. The currents leaving Node X are:\n1.  Through the source of M1: M1 has its source at Node X, gate at $v_{in}$, and drain at AC ground. The current leaving Node X through M1 is $i_{sd1} = g_{m1}v_{sg1} = g_{m1}(v_{x} - v_{in})$.\n2.  Through the capacitor C: The current leaving Node X through C to AC ground is $sCv_{x}$.\n      \nKCL at Node X (sum of currents leaving is zero):\n$$\ng_{m1}(v_{x} - v_{in}) + sCv_{x} = 0\n$$\nSolving for $v_{x}$ in terms of $v_{in}$:\n$$\nv_{x}(g_{m1} + sC) = g_{m1}v_{in} \\implies v_{x} = \\frac{g_{m1}}{sC + g_{m1}}v_{in}\n$$\n\nNext, find the input current $i_{in}$. The input current is the current flowing into the circuit's input terminal, which is the drain of M2.\nM2 has its source at AC ground, gate at $v_x$, and drain at $v_{in}$. The current flowing from its source to its drain is $i_{sd2} = g_{m2}v_{sg2} = g_{m2}(0 - v_{x}) = -g_{m2}v_{x}$. This current flows from ground *to* the drain, so it is the current flowing *into* the input terminal.\nTherefore, the input current is:\n$$\ni_{in} = i_{sd2} = -g_{m2}v_{x}\n$$\nSubstitute the expression for $v_{x}$:\n$$\ni_{in} = -g_{m2}\\left(\\frac{g_{m1}}{sC + g_{m1}}\\right)v_{in}\n$$\nThe input impedance $Z_{in}$ is $v_{in}/i_{in}$:\n$$\nZ_{in} = \\frac{v_{in}}{i_{in}} = -\\frac{sC + g_{m1}}{g_{m1}g_{m2}} = -\\frac{1}{g_{m2}} - s\\frac{C}{g_{m1}g_{m2}}\n$$\nThis impedance is of the form $R_{eq} + sL_{eq}$, representing a resistor in series with an inductor. By comparison, the equivalent inductance is:\n$$\nL_{eq} = -\\frac{C}{g_{m1}g_{m2}}\n$$", "answer": "$$\\boxed{-\\frac{C}{g_{m1}g_{m2}}}$$", "id": "1323383"}]}