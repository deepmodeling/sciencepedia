{"hands_on_practices": [{"introduction": "The primary function of an amplifier is to provide gain. This first exercise establishes the fundamental relationship between the properties of the amplifying transistor and the overall circuit performance. By calculating the required transconductance ($g_m$) to achieve a specific voltage gain, you will engage in a core design task that connects device-level physics to system-level specifications [@problem_id:1297526].", "problem": "An engineer is designing the input stage of an audio preamplifier using a standard differential amplifier with an active current mirror load. The amplifier is constructed using Metal-Oxide-Semiconductor Field-Effect Transistor (MOSFET) technology and is configured to convert a differential input voltage to a single-ended output voltage. The two input MOSFETs forming the differential pair are considered to be perfectly matched.\n\nThe design specification requires a voltage gain magnitude of $|A_v| = 40$ from the differential input to the single-ended output. The total effective output resistance at the single-ended output node, which accounts for the characteristics of both the driver transistor and the active load, is known to be $R_{out} = 125 \\text{ k}\\Omega$.\n\nTo meet this gain specification, what is the required transconductance, $g_m$, for each of the input MOSFETs? Express your answer in millisiemens (mS), rounded to two significant figures.", "solution": "For a matched MOS differential pair with a current mirror active load converting differential input to a single-ended output, let the differential input be $v_{id} = v_{1} - v_{2}$ with symmetrical drive so that $v_{1} = +\\frac{v_{id}}{2}$ and $v_{2} = -\\frac{v_{id}}{2}$. With an ideal tail source, the source node is an AC ground, so the small-signal drain currents of the input transistors are $\\Delta i_{1} = g_{m}\\frac{v_{id}}{2}$ and $\\Delta i_{2} = -g_{m}\\frac{v_{id}}{2}$. The current mirror copies $\\Delta i_{1}$ to the output branch, so the net small-signal current injected into the output node is\n$$\n\\Delta i_{o} = \\Delta i_{\\text{mirror}} - \\Delta i_{2} = \\Delta i_{1} - \\Delta i_{2} = g_{m}\\frac{v_{id}}{2} - \\left(-g_{m}\\frac{v_{id}}{2}\\right) = g_{m}v_{id}.\n$$\nWith an effective output resistance $R_{out}$ at the output node, the output voltage is\n$$\nv_{o} = -\\Delta i_{o}R_{out} = -g_{m}R_{out}\\,v_{id},\n$$\nso the differential-to-single-ended voltage gain is\n$$\nA_{v} = \\frac{v_{o}}{v_{id}} = -g_{m}R_{out}, \\quad |A_{v}| = g_{m}R_{out}.\n$$\nSolving for $g_{m}$ gives\n$$\ng_{m} = \\frac{|A_{v}|}{R_{out}}.\n$$\nSubstituting $|A_{v}| = 40$ and $R_{out} = 125 \\times 10^{3}\\ \\Omega$,\n$$\ng_{m} = \\frac{40}{125 \\times 10^{3}}\\ \\text{S} = 3.2 \\times 10^{-4}\\ \\text{S} = 0.32\\ \\text{mS}.\n$$\nRounded to two significant figures, the required transconductance per input MOSFET is $0.32\\ \\text{mS}$.", "answer": "$$\\boxed{0.32}$$", "id": "1297526"}, {"introduction": "While gain is essential, an amplifier is only useful over a specific range of output voltages. This next practice explores the large-signal behavior of a differential amplifier to determine its output voltage swing. Understanding how transistor saturation and cutoff define the linear operating region is crucial for designing circuits that can process signals without introducing distortion [@problem_id:1297527].", "problem": "Consider a Bipolar Junction Transistor (BJT) differential amplifier circuit used for differential to single-ended signal conversion. The amplifier is constructed with two identical NPN transistors, $Q_1$ and $Q_2$, whose emitters are connected together and then to a negative power supply, $-V_{CC}$, through an ideal constant-current source that sinks a current $I_{EE}$. The collectors of $Q_1$ and $Q_2$ are each connected to a positive power supply, $+V_{CC}$, through identical resistors, $R_C$.\n\nA differential input voltage, $v_{id} = v_{B1} - v_{B2}$, is applied between the bases of the transistors, superimposed on a zero-volt common-mode voltage, $V_{CM} = 0.0$ V. The single-ended output, $v_o$, is taken from the collector of transistor $Q_2$.\n\nThe circuit operates with the following parameters:\n- Power supply voltage: $V_{CC} = 15.0$ V\n- Tail current: $I_{EE} = 2.00$ mA\n- Collector resistance: $R_C = 12.0$ k$\\Omega$\n- Forward-active base-emitter voltage: $V_{BE(on)} = 0.70$ V\n- Collector-emitter saturation voltage: $V_{CE(sat)} = 0.20$ V\n\nAssume the transistors are perfectly matched, the base currents are negligible (i.e., infinite current gain $\\beta$), and the tail current source is ideal.\n\nDetermine the maximum positive output voltage ($V_{O,max}$) and the minimum negative output voltage ($V_{O,min}$) that define the linear operating range of the amplifier. The linear range is defined as the range of $v_o$ for which both transistors remain in the forward-active region.\n\nExpress your answers in volts, rounded to three significant figures. Present the final answer as a row matrix in the form $\\begin{pmatrix} V_{O,max} & V_{O,min} \\end{pmatrix}$.", "solution": "The problem asks for the maximum and minimum output voltages ($V_{O,max}$ and $V_{O,min}$) at the collector of transistor $Q_2$, such that both transistors $Q_1$ and $Q_2$ remain in the forward-active region. This means neither transistor should enter cutoff or saturation.\n\nThe output voltage is given by $v_o = v_{C2} = V_{CC} - I_{C2} R_C$. The currents in the two transistors are related by Kirchhoff's current law at the common emitter node: $I_{C1} + I_{C2} \\approx I_{E1} + I_{E2} = I_{EE}$, since base currents are negligible.\n\nAn NPN BJT is in the forward-active region if $V_{BE} = V_{BE(on)}$ and $V_{CE} > V_{CE(sat)}$. The limit of this region is saturation, where $V_{CE} = V_{CE(sat)}$. The collector voltage at saturation is thus $V_{C,sat} = V_E + V_{CE(sat)}$, where $V_E$ is the emitter voltage.\n\nFor a differential amplifier, the emitter voltage $V_E$ varies slightly with the differential input $v_{id}$. However, for an introductory analysis, we can approximate the emitter voltage $V_E$ as being constant at its quiescent value, $V_{EQ}$. The quiescent emitter voltage is determined by the common-mode input voltage, $V_{CM}$.\n$$V_E \\approx V_{EQ} = V_{CM} - V_{BE(on)}$$\nGiven $V_{CM} = 0.0$ V and $V_{BE(on)} = 0.70$ V:\n$$V_E \\approx 0.0 - 0.70 = -0.70 \\text{ V}$$\n\n**Step 1: Calculating the minimum output voltage ($V_{O,min}$)**\n\nThe minimum output voltage at the collector of $Q_2$, $V_{O,min}$, occurs when the current $I_{C2}$ is at its maximum. This happens when the input voltage $v_{id}$ is sufficiently positive, steering most of the tail current $I_{EE}$ through $Q_2$. The output voltage $v_o = v_{C2}$ decreases as $I_{C2}$ increases. The lower limit is reached when transistor $Q_2$ saturates.\n\nThe saturation condition for $Q_2$ is $V_{C2} = V_{CE(sat)} + V_E$. Using our approximation for $V_E$:\n$$V_{O,min} = V_{C2,sat} = V_E + V_{CE(sat)} \\approx V_{EQ} + V_{CE(sat)}$$\nSubstituting the given values:\n$$V_{O,min} = -0.70 \\text{ V} + 0.20 \\text{ V} = -0.50 \\text{ V}$$\nRounding to three significant figures, $V_{O,min} = -0.500$ V.\n\nAt this point, the current $I_{C2}$ would be $I_{C2} = \\frac{V_{CC} - V_{O,min}}{R_C} = \\frac{15.0 - (-0.50)}{12.0 \\times 10^3} = \\frac{15.5}{12.0} \\text{ mA} \\approx 1.29$ mA. This is less than the total tail current $I_{EE} = 2.00$ mA, which is consistent, as $Q_1$ would still be conducting the remaining current ($2.00 - 1.29 = 0.71$ mA).\n\n**Step 2: Calculating the maximum output voltage ($V_{O,max}$)**\n\nThe maximum output voltage at the collector of $Q_2$, $V_{O,max}$, occurs when the current $I_{C2}$ is at its minimum. This happens when the input voltage $v_{id}$ is sufficiently negative, steering most of the tail current $I_{EE}$ through $Q_1$. As $I_{C2}$ decreases, $v_o = v_{C2}$ increases.\n\nIf $Q_2$ were to go into cutoff ($I_{C2}=0$), the output voltage would rise to $V_{CC}=15.0$ V. However, we must check the status of transistor $Q_1$. As $I_{C2}$ decreases, $I_{C1}$ increases because $I_{C1} = I_{EE} - I_{C2}$. The increasing current $I_{C1}$ causes the collector voltage of $Q_1$, $V_{C1} = V_{CC} - I_{C1}R_C$, to decrease. The upper swing of the output voltage $v_o$ is limited by the saturation of transistor $Q_1$.\n\nThe saturation condition for $Q_1$ is $V_{C1} = V_E + V_{CE(sat)}$. Using our approximation for $V_E$:\n$$V_{C1,sat} = V_E + V_{CE(sat)} \\approx V_{EQ} + V_{CE(sat)} = -0.70 \\text{ V} + 0.20 \\text{ V} = -0.50 \\text{ V}$$\nSo, $Q_1$ saturates when its collector voltage drops to $-0.50$ V. We can find the current $I_{C1}$ at this point:\n$$V_{C1,sat} = V_{CC} - I_{C1,sat} R_C$$\n$$I_{C1,sat} = \\frac{V_{CC} - V_{C1,sat}}{R_C} = \\frac{15.0 \\text{ V} - (-0.50 \\text{ V})}{12.0 \\times 10^3 \\text{ }\\Omega} = \\frac{15.5 \\text{ V}}{12.0 \\text{ k}\\Omega} \\approx 1.29167 \\text{ mA}$$\nThis current $I_{C1,sat}$ is the maximum current that can flow through $Q_1$ before it saturates.\n\nThe corresponding current in $Q_2$ is:\n$$I_{C2} = I_{EE} - I_{C1,sat} = 2.00 \\text{ mA} - 1.29167 \\text{ mA} = 0.70833 \\text{ mA}$$\nThis minimum current in $Q_2$ (while keeping $Q_1$ active) determines the maximum output voltage, $V_{O,max}$.\n$$V_{O,max} = V_{CC} - I_{C2} R_C = 15.0 \\text{ V} - (0.70833 \\times 10^{-3} \\text{ A})(12.0 \\times 10^3 \\text{ }\\Omega)$$\n$$V_{O,max} = 15.0 \\text{ V} - 8.50 \\text{ V} = 6.50 \\text{ V}$$\nRounding to three significant figures, $V_{O,max} = 6.50$ V.\n\n**Step 3: Final Answer Formulation**\n\nThe maximum and minimum output voltages are $V_{O,max} = 6.50$ V and $V_{O,min} = -0.500$ V. The result must be presented in a row matrix.\n$$ \\begin{pmatrix} V_{O,max} & V_{O,min} \\end{pmatrix} = \\begin{pmatrix} 6.50 & -0.500 \\end{pmatrix} $$", "answer": "$$\\boxed{\\begin{pmatrix} 6.50 & -0.500 \\end{pmatrix}}$$", "id": "1297527"}, {"introduction": "A defining feature of a differential amplifier is its ability to reject noise and interference that appears simultaneously on both inputs. This final exercise focuses on the Common-Mode Rejection Ratio (CMRR), a key metric that quantifies this capability. You will learn how the non-ideal nature of the tail current source directly impacts CMRR, a critical consideration in the design of high-fidelity analog systems [@problem_id:1297522].", "problem": "An analog integrated circuit designer is creating a differential-to-single-ended converter using a basic NMOS differential pair. The amplifier has a resistive load $R_D$ connected to the drain of each transistor. The output voltage is taken from the drain of one of the transistors, while the drain of the other transistor is also connected to a load resistor of the same value, $R_D$, to maintain circuit symmetry. The pair is biased by a non-ideal tail current source which provides a total direct current of $I_{TAIL}$ and has a finite output resistance $R_{SS}$.\n\nThe following parameters are provided for the circuit design:\n- Process transconductance parameter: $\\mu_n C_{ox} = 200 \\; \\mu\\text{A}/\\text{V}^2$\n- Transistor aspect ratio for both transistors: $(W/L) = 50$\n- Load resistance: $R_D = 10 \\; \\text{k}\\Omega$\n- Total tail bias current: $I_{TAIL} = 0.5 \\; \\text{mA}$\n\nThe design must achieve a minimum Common-Mode Rejection Ratio (CMRR) of 80 dB.\n\nFor your analysis, assume that both NMOS transistors are perfectly matched, operate in the saturation region, and have an infinite intrinsic output resistance ($r_o \\to \\infty$). You may also neglect the body effect.\n\nDetermine the minimum required output resistance, $R_{SS}$, of the tail current source to meet this CMRR specification. Express your answer in megaohms ($\\text{M}\\Omega$), rounded to three significant figures.", "solution": "The NMOS differential pair is analyzed in small-signal with matched transistors, $r_{o} \\to \\infty$, and negligible body effect. Let $k \\equiv \\mu_{n} C_{ox} (W/L)$ and let the quiescent drain current per transistor be $I_{D} = I_{TAIL}/2$.\n\nThe transconductance of each transistor in saturation is obtained from the square-law model:\n$$\nI_{D} = \\frac{1}{2} k V_{ov}^{2}, \\quad g_{m} = k V_{ov} = \\sqrt{2 k I_{D}}.\n$$\n\nDifferential-mode gain to a single-ended output is found by driving the gates with $v_{g1} = +v_{id}/2$ and $v_{g2} = -v_{id}/2$. For ideal differential excitation, the source node is at AC ground, so $v_{s} = 0$. The small-signal drain current of the observed side is $i_{d1} = g_{m} (v_{id}/2)$, and with the drain load $R_{D}$ to AC ground,\n$$\nA_{d} \\equiv \\frac{v_{o}}{v_{id}} = - \\frac{g_{m} R_{D}}{2}.\n$$\n\nFor common-mode excitation, $v_{g1} = v_{g2} = v_{cm}$, the source node voltage $v_{s}$ is determined by KCL at the source node including the tail resistance $R_{SS}$:\n$$\n2 g_{m} (v_{cm} - v_{s}) = \\frac{v_{s}}{R_{SS}} \\;\\;\\Rightarrow\\;\\; v_{s} = \\frac{2 g_{m} R_{SS}}{1 + 2 g_{m} R_{SS}} \\, v_{cm}.\n$$\nThe drain current on either side is $i_{d} = g_{m} (v_{cm} - v_{s}) = \\dfrac{g_{m}}{1 + 2 g_{m} R_{SS}} \\, v_{cm}$, hence the single-ended common-mode gain is\n$$\nA_{cm} \\equiv \\frac{v_{o}}{v_{cm}} = - \\frac{g_{m} R_{D}}{1 + 2 g_{m} R_{SS}}.\n$$\n\nTherefore, the single-ended CMRR magnitude is\n$$\n\\mathrm{CMRR} = \\left|\\frac{A_{d}}{A_{cm}}\\right| = \\frac{\\frac{g_{m} R_{D}}{2}}{\\frac{g_{m} R_{D}}{1 + 2 g_{m} R_{SS}}} = \\frac{1 + 2 g_{m} R_{SS}}{2}.\n$$\nThe specification requires $20 \\log_{10}(\\mathrm{CMRR}) \\geq 80$, i.e.\n$$\n\\mathrm{CMRR} \\geq 10^{\\frac{80}{20}} = 10^{4}.\n$$\nThus,\n$$\n\\frac{1 + 2 g_{m} R_{SS}}{2} \\geq 10^{4} \\;\\;\\Rightarrow\\;\\; 1 + 2 g_{m} R_{SS} \\geq 2 \\times 10^{4} \\;\\;\\Rightarrow\\;\\; R_{SS} \\geq \\frac{2 \\times 10^{4} - 1}{2 g_{m}}.\n$$\n\nNow evaluate $g_{m}$ from the given parameters. With $k = \\mu_{n} C_{ox} (W/L)$ and $I_{D} = I_{TAIL}/2$,\n$$\nk = (200 \\times 10^{-6}) \\times 50 = 0.01 \\;\\text{A/V}^{2}, \\quad I_{D} = \\frac{0.5 \\times 10^{-3}}{2} = 0.25 \\times 10^{-3} \\;\\text{A},\n$$\n$$\ng_{m} = \\sqrt{2 k I_{D}} = \\sqrt{2 \\times 0.01 \\times 0.25 \\times 10^{-3}} = \\sqrt{5} \\times 10^{-3} \\;\\text{S}.\n$$\nHence,\n$$\nR_{SS,\\min} = \\frac{2 \\times 10^{4} - 1}{2 \\sqrt{5} \\times 10^{-3}} \\;\\text{}\\Omega = \\left(\\frac{19999}{2 \\sqrt{5}}\\right) \\times 10^{3} \\;\\text{}\\Omega.\n$$\nConverting to megaohms gives\n$$\nR_{SS,\\min} = \\left(\\frac{19999}{2 \\sqrt{5}}\\right) \\times 10^{-3} \\;\\text{M}\\Omega \\approx 4.4719 \\;\\text{M}\\Omega.\n$$\nRounded to three significant figures in megaohms, this is $4.47$.", "answer": "$$\\boxed{4.47}$$", "id": "1297522"}]}