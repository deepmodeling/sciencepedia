{"hands_on_practices": [{"introduction": "The foundation of switched-capacitor (SC) technology lies in its ability to replace resistors—which are difficult to fabricate precisely on an integrated circuit—with a clever combination of capacitors and switches. This first practice delves into the fundamental principle of this \"resistor emulation.\" By calculating the average current through a simple SC circuit, you will derive the relationship between capacitance, clock frequency, and the equivalent resistance, a cornerstone concept for all SC designs [@problem_id:1335122].", "problem": "In modern integrated circuits, precise resistor values are difficult to manufacture and consume a large area. A common alternative is the switched-capacitor circuit, which can emulate a resistor using only capacitors and switches, components that are easily and accurately fabricated in silicon.\n\nConsider a fundamental switched-capacitor circuit element intended to simulate a resistor. The circuit is constructed as follows: a capacitor of capacitance $C$ has one terminal permanently connected to ground. The other terminal of the capacitor can be connected to one of two points via a set of ideal switches. Switch S1 connects this terminal to an input node held at a constant DC voltage $V_{in}$. Switch S2 connects this same terminal to ground.\n\nThe switches are controlled by a two-phase, non-overlapping clock signal that has a frequency $f_{clk}$. The clock's period is $T_{clk} = 1/f_{clk}$.\n- During the first phase, $\\phi_1$, which lasts for time $T_{clk}/2$, switch S1 is closed and switch S2 is open.\n- During the second phase, $\\phi_2$, which also lasts for time $T_{clk}/2$, switch S1 is open and switch S2 is closed.\n\nAssuming the circuit has been operating for a sufficient amount of time to reach a steady state, determine the average current, $I_{avg}$, drawn from the input voltage source $V_{in}$ over one complete clock period $T_{clk}$. Express your final answer as a symbolic expression in terms of $V_{in}$, $C$, and $f_{clk}$.", "solution": "During phase $\\phi_{1}$, switch S1 connects the top plate of the capacitor to the input source at voltage $V_{in}$, while the bottom plate remains at ground. By the capacitor constitutive relation, $Q = C V$, the charge on the capacitor at the end of $\\phi_{1}$ is\n$$\nQ_{\\phi_{1},\\,\\text{end}} = C V_{in}.\n$$\nImmediately before $\\phi_{1}$ starts, the circuit has just completed $\\phi_{2}$, during which S2 connects the top plate to ground, forcing the capacitor voltage to zero. Hence the charge at the start of $\\phi_{1}$ is\n$$\nQ_{\\phi_{1},\\,\\text{start}} = 0.\n$$\nTherefore, the net charge drawn from the source during $\\phi_{1}$ is the change in capacitor charge,\n$$\n\\Delta Q_{\\text{per cycle}} = Q_{\\phi_{1},\\,\\text{end}} - Q_{\\phi_{1},\\,\\text{start}} = C V_{in}.\n$$\nNo charge is drawn from the source during $\\phi_{2}$ because S1 is open and the capacitor discharges to ground through S2. Thus, over one complete clock period $T_{clk}$, the total charge drawn from $V_{in}$ is $C V_{in}$.\n\nBy the definition of average current over a period,\n$$\nI_{avg} = \\frac{1}{T_{clk}} \\int_{0}^{T_{clk}} i(t)\\, dt = \\frac{\\Delta Q_{\\text{per cycle}}}{T_{clk}} = \\frac{C V_{in}}{T_{clk}}.\n$$\nUsing $T_{clk} = \\frac{1}{f_{clk}}$, we obtain\n$$\nI_{avg} = C V_{in} f_{clk}.\n$$\nThis is the standard switched-capacitor result, equivalent to a resistor of value $R_{eq} = \\frac{1}{C f_{clk}}$, since $I_{avg} = \\frac{V_{in}}{R_{eq}}$.", "answer": "$$\\boxed{C f_{clk} V_{in}}$$", "id": "1335122"}, {"introduction": "Having established how an SC circuit can mimic a resistor, we can now assemble these components into functional circuits. This exercise guides you through the analysis of a basic SC integrator, a vital building block for filters and other signal processing systems. You will apply the principle of charge conservation within an active op-amp circuit, discovering the critical insight that circuit performance is determined by the ratio of capacitances, not their absolute values [@problem_id:1335129].", "problem": "A fundamental building block in modern analog signal processing is the Switched-Capacitor (SC) integrator. Consider a basic SC integrator constructed using an ideal operational amplifier (op-amp), an input capacitor of capacitance $C_1$, and a feedback capacitor of capacitance $C_2$. The circuit is driven by a two-phase, non-overlapping clock signal that completes one full cycle in a period $T_c$.\n\nThe operation within one clock cycle is as follows:\n1.  During the first phase ($\\phi_1$), a set of ideal switches connects the capacitor $C_1$ across a constant DC input voltage source of value $V_{in}$, with its positive plate connected to the voltage source and its negative plate to ground.\n2.  During the second phase ($\\phi_2$), the switches reconfigure the circuit. The capacitor $C_1$ is disconnected from the input source. Its positive plate is connected to the inverting input of the op-amp, and its negative plate remains connected to ground. Simultaneously, the capacitor $C_2$ is placed in the feedback loop, connected between the op-amp's output and its inverting input. The op-amp's non-inverting input is held at ground potential.\n\nAssume that at time $t=0$, before the first clock cycle begins, the output voltage of the op-amp is $V_{out}(0) = 0$, and both capacitors, $C_1$ and $C_2$, hold zero initial charge.\n\nDetermine the output voltage of the op-amp, $V_{out}(T_c)$, at the exact moment the first full clock cycle is completed. Express your answer as an analytic expression in terms of $V_{in}$, $C_1$, and $C_2$.", "solution": "The problem asks for the output voltage of a switched-capacitor integrator after one full clock cycle. We can solve this by analyzing the charge stored on and transferred between the capacitors during the two clock phases, using the properties of an ideal op-amp.\n\n**Step 1: Analyze the circuit during phase $\\phi_1$.**\nDuring the first phase, the capacitor $C_1$ is connected directly across the DC voltage source $V_{in}$. It charges up until the voltage across it is equal to $V_{in}$. The charge stored on capacitor $C_1$ at the end of this phase is given by the definition of capacitance:\n$$Q_1 = C_1 V_{C_1}$$\nSince $V_{C_1} = V_{in}$, the stored charge is:\n$$Q_1 = C_1 V_{in}$$\nThe problem states that the initial output voltage $V_{out}(0)$ is zero and capacitor $C_2$ has no initial charge. During phase $\\phi_1$, the feedback loop is not connected in the specified manner, so the output voltage remains at zero and $C_2$ remains uncharged.\n\n**Step 2: Analyze the circuit during phase $\\phi_2$.**\nDuring the second phase, the switch configuration changes. Capacitor $C_1$ is now connected between the inverting input of the op-amp and ground. The op-amp's non-inverting input is connected to ground. For an ideal op-amp with infinite open-loop gain, the principle of virtual ground applies: the voltage at the inverting input, $V_{-}$, must be equal to the voltage at the non-inverting input, $V_{+}$.\n$$V_{-} = V_{+} = 0 \\text{ V}$$\nSince capacitor $C_1$ is connected between the inverting input ($V_{-}=0$) and ground, the voltage across $C_1$ must become 0 V. To reach this state, $C_1$ must fully discharge.\n\n**Step 3: Apply the principle of charge conservation.**\nThe charge $Q_1 = C_1 V_{in}$ that was stored on $C_1$ cannot disappear. Because an ideal op-amp has infinite input impedance, no current can flow into its input terminals. Therefore, all the charge that flows out of $C_1$ must be transferred to the feedback capacitor $C_2$.\nThe amount of charge transferred to $C_2$ is $\\Delta Q_2 = Q_1$.\n$$\\Delta Q_2 = C_1 V_{in}$$\n\n**Step 4: Calculate the final output voltage.**\nIn this phase, capacitor $C_2$ is connected between the op-amp's output terminal (at potential $V_{out}$) and its inverting input terminal (at virtual ground, $V_{-}=0$). The voltage across the capacitor $C_2$ is therefore:\n$$V_{C_2} = V_{-} - V_{out} = 0 - V_{out} = -V_{out}$$\nThe charge stored on $C_2$ is related to the voltage across it by $Q_2 = C_2 V_{C_2}$. Since $C_2$ was initially uncharged, the charge on it at the end of phase $\\phi_2$ is $Q_2 = \\Delta Q_2$.\n$$Q_2 = C_2 (-V_{out})$$\nWe can now equate the charge transferred from $C_1$ to the charge accumulated on $C_2$:\n$$\\Delta Q_2 = Q_2$$\n$$C_1 V_{in} = C_2 (-V_{out})$$\nSolving for the output voltage $V_{out}$ gives:\n$$V_{out} = -\\frac{C_1}{C_2} V_{in}$$\nThis is the output voltage at the end of the first full clock cycle, $t=T_c$. The clock period $T_c$ itself affects the rate of integration over many cycles, but for calculating the result of a single, complete charge transfer event, its value is not needed.\n\nThe final answer is $V_{out}(T_c) = - \\frac{C_1}{C_2} V_{in}$.", "answer": "$$\\boxed{-\\frac{C_1}{C_2}V_{in}}$$", "id": "1335129"}, {"introduction": "While continuous-time equivalents offer great intuition, SC circuits are fundamentally discrete-time systems best described by difference equations. This practice introduces the powerful z-domain framework, which allows for a more precise analysis of SC filters. By deriving the filter's transfer function, you will directly link the physical capacitor ratio to the pole's location in the z-plane, revealing how these filters can be designed with high precision and tunability [@problem_id:1335132].", "problem": "A simple first-order Switched-Capacitor (SC) low-pass filter is designed using two capacitors, with capacitances $C_1$ and $C_2$, and an array of switches controlled by a two-phase non-overlapping clock signal. The operation of the filter within a single clock cycle, indexed by $n$, proceeds as follows. We assume the input voltage is sampled at the beginning of the cycle and held constant with a value of $v_{in}[n-1]$.\n\n1.  During the first clock phase, $\\phi_1$, capacitor $C_1$ is connected to the input voltage source, charging it to $v_{in}[n-1]$. During this phase, capacitor $C_2$, which holds the output voltage from the previous cycle, $v_{out}[n-1]$, is disconnected from $C_1$.\n2.  During the second clock phase, $\\phi_2$, capacitor $C_1$ is disconnected from the input source and connected in parallel with capacitor $C_2$. The charge stored on both capacitors is redistributed, establishing the new output voltage $v_{out}[n]$ across the parallel combination.\n\nThis discrete-time filtering action can be characterized by a transfer function in the z-domain, $H(z) = V_{out}(z)/V_{in}(z)$, which possesses a single real pole. For a specific application, the filter's pole must be located at $z_p = 0.820$. Determine the required ratio of the capacitances, $C_2/C_1$. Provide your answer as a real number rounded to three significant figures.", "solution": "During phase $\\phi_{1}$, $C_{1}$ is connected to the input and charged to the sampled input voltage $v_{in}[n-1]$. Thus its charge is $Q_{1,i} = C_{1} v_{in}[n-1]$. Capacitor $C_{2}$ is isolated and holds the previous output voltage $v_{out}[n-1]$, so its charge is $Q_{2,i} = C_{2} v_{out}[n-1]$.\n\nDuring phase $\\phi_{2}$, $C_{1}$ is disconnected from the input and connected in parallel with $C_{2}$. By conservation of charge (ideal switches, no loss), the total charge before and after connection is equal:\n$$\nC_{1} v_{in}[n-1] + C_{2} v_{out}[n-1] = (C_{1} + C_{2}) v_{out}[n].\n$$\nSolving for $v_{out}[n]$ gives the first-order difference equation\n$$\nv_{out}[n] = \\frac{C_{1}}{C_{1}+C_{2}} v_{in}[n-1] + \\frac{C_{2}}{C_{1}+C_{2}} v_{out}[n-1].\n$$\n\nTaking the $z$-transform with $V_{out}(z)$ and $V_{in}(z)$ denoting the transforms, and noting the one-sample delay $z^{-1}$ associated with $v_{in}[n-1]$ and $v_{out}[n-1]$, we obtain\n$$\nV_{out}(z) = \\frac{C_{1}}{C_{1}+C_{2}} z^{-1} V_{in}(z) + \\frac{C_{2}}{C_{1}+C_{2}} z^{-1} V_{out}(z).\n$$\nRearranging for the transfer function $H(z) = \\frac{V_{out}(z)}{V_{in}(z)}$ yields\n$$\nH(z) = \\frac{\\frac{C_{1}}{C_{1}+C_{2}} z^{-1}}{1 - \\frac{C_{2}}{C_{1}+C_{2}} z^{-1}}.\n$$\nThe pole $z_{p}$ satisfies\n$$\n1 - \\frac{C_{2}}{C_{1}+C_{2}} z^{-1} = 0 \\quad \\Rightarrow \\quad z_{p} = \\frac{C_{2}}{C_{1}+C_{2}}.\n$$\nLet $r = \\frac{C_{2}}{C_{1}}$. Then\n$$\nz_{p} = \\frac{r}{1 + r} \\quad \\Rightarrow \\quad r = \\frac{z_{p}}{1 - z_{p}}.\n$$\nFor the required pole location $z_{p} = 0.820$,\n$$\n\\frac{C_{2}}{C_{1}} = \\frac{0.820}{1 - 0.820} = \\frac{0.820}{0.180} = \\frac{41}{9} \\approx 4.555\\ldots\n$$\nRounded to three significant figures, this gives $4.56$.", "answer": "$$\\boxed{4.56}$$", "id": "1335132"}]}