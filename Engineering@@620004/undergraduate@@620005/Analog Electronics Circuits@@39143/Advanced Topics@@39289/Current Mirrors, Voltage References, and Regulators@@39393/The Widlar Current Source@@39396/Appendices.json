{"hands_on_practices": [{"introduction": "The primary advantage of the Widlar current source is its ability to generate a small, stable output current, often in the microampere range, from a larger, more manageable reference current. This is achieved without needing large-value resistors, which are difficult and costly to implement on an integrated circuit. This first exercise immerses you in the fundamental design task for this circuit: calculating the precise value of the emitter resistor, $R_E$, required to achieve a desired current ratio [@problem_id:1341657]. Mastering this calculation solidifies your understanding of how the logarithmic behavior of the base-emitter junction is leveraged to create a predictable and stable low-current source.", "problem": "An analog integrated circuit designer is tasked with creating a low-current bias source for an operational amplifier's input stage. To achieve a stable, small output current from a larger, more easily generated reference current, a Widlar current source is employed.\n\nThe circuit consists of two perfectly matched NPN Bipolar Junction Transistors (BJTs), $Q_1$ and $Q_2$, operating in the forward-active region. The base and collector of the reference transistor, $Q_1$, are connected together. A reference current, $I_{ref}$, is fed into this common node. The base of the output transistor, $Q_2$, is connected to the base of $Q_1$. An emitter resistor, $R_E$, is placed between the emitter of $Q_2$ and the common ground rail, which is also connected to the emitter of $Q_1$. The collector of $Q_2$ provides the desired output current, $I_{out}$.\n\nFor this design, assume the base currents are negligible compared to the collector currents. The reference current is set to $I_{ref} = 1.00\\,\\text{mA}$ and the desired output current is $I_{out} = 10.0\\,\\mu\\text{A}$. The circuit operates at a temperature where the thermal voltage is $V_T = 26.0\\,\\text{mV}$.\n\nCalculate the required value of the emitter resistance $R_E$ to achieve this current ratio. Express your answer in kilo-ohms ($\\text{k}\\Omega$) and round to three significant figures.", "solution": "Because the transistors are matched and operate in forward-active mode with negligible base currents, we can take $I_{C1} \\approx I_{E1} = I_{ref}$ and $I_{C2} \\approx I_{E2} = I_{out}$. For a BJT in forward-active operation, the collector current and base-emitter voltage satisfy $I_{C} = I_{S} \\exp\\!\\left(\\frac{V_{BE}}{V_{T}}\\right)$, which implies\n$$\nV_{BE} = V_{T} \\ln\\!\\left(\\frac{I_{C}}{I_{S}}\\right).\n$$\nSince the bases are tied together, the emitter of $Q_{2}$ is elevated by the resistor $R_{E}$, and the voltage across $R_{E}$ equals the difference in the base-emitter voltages:\n$$\nV_{R_{E}} = V_{BE1} - V_{BE2}.\n$$\nUsing the expression for $V_{BE}$ above with $I_{C1} = I_{ref}$ and $I_{C2} = I_{out}$,\n$$\nV_{BE1} - V_{BE2} = V_{T} \\ln\\!\\left(\\frac{I_{ref}}{I_{S}}\\right) - V_{T} \\ln\\!\\left(\\frac{I_{out}}{I_{S}}\\right) = V_{T} \\ln\\!\\left(\\frac{I_{ref}}{I_{out}}\\right).\n$$\nWith negligible base current, $I_{E2} \\approx I_{out}$, so the resistor satisfies\n$$\nR_{E} = \\frac{V_{R_{E}}}{I_{E2}} = \\frac{V_{T} \\ln\\!\\left(\\frac{I_{ref}}{I_{out}}\\right)}{I_{out}}.\n$$\nSubstituting the given values $V_{T} = 26.0\\,\\text{mV}$, $I_{ref} = 1.00\\,\\text{mA}$, and $I_{out} = 10.0\\,\\mu\\text{A}$,\n$$\nR_{E} = \\frac{26.0 \\times 10^{-3}}{10.0 \\times 10^{-6}} \\ln(100)\\,\\Omega = 2600 \\ln(100)\\,\\Omega.\n$$\nSince $\\ln(100) = 2 \\ln(10) \\approx 4.605170$, we get\n$$\nR_{E} \\approx 2600 \\times 4.605170\\,\\Omega \\approx 11973.4\\,\\Omega = 11.9734\\,\\text{k}\\Omega.\n$$\nRounded to three significant figures in kilo-ohms, this is $12.0\\,\\text{k}\\Omega$.", "answer": "$$\\boxed{12.0}$$", "id": "1341657"}, {"introduction": "Bridging the gap between theoretical design and practical implementation involves developing strong diagnostic skills. Real-world circuits are subject to component variations and faults that can cause them to deviate from their expected performance. This practice places you in a realistic troubleshooting scenario where a Widlar current source is not producing the correct output current [@problem_id:1341621]. By analyzing a set of possible single-component failures, you will learn to apply your knowledge of the circuit's governing equations to deduce the source of the error, a critical skill for testing and debugging analog systems.", "problem": "An electronics student is building a Widlar current source, a circuit designed to generate a small, stable output current. The design uses two matched Bipolar Junction Transistors (BJTs), $Q_1$ and $Q_2$. The circuit is powered by a supply voltage $V_{CC} = 12\\,\\text{V}$. The reference current is set by a resistor $R_1 = 22\\,\\text{k}\\Omega$ connected from $V_{CC}$ to the collector of the diode-connected transistor $Q_1$. The output current $I_{OUT}$ is the collector current of $Q_2$, which has an emitter resistor $R_2 = 1.0\\,\\text{k}\\Omega$.\n\nThe design goal is to produce a stable microampere-level current. Upon testing the prototype, the student measures an output current of $I_{OUT} = 18\\,\\mu\\text{A}$, which is significantly lower than the intended design value. Suspecting a single component was installed with an incorrect value, the student considers several possibilities.\n\nFor all calculations, assume the base-emitter voltage of the reference transistor is constant at $V_{BE1} = 0.7\\,\\text{V}$ for the purpose of calculating the reference current. The thermal voltage is $V_T = 25\\,\\text{mV}$, and base currents are negligible.\n\nWhich of the following single-component faults could account for this measurement?\n\nA. The resistor $R_1$ was mistakenly replaced with a $33\\,\\text{k}\\Omega$ resistor.\n\nB. The resistor $R_1$ was mistakenly replaced with a $15\\,\\text{k}\\Omega$ resistor.\n\nC. The resistor $R_2$ was mistakenly replaced with a $4.7\\,\\text{k}\\Omega$ resistor.\n\nD. The resistor $R_2$ was mistakenly replaced with a $470\\,\\Omega$ resistor.\n\nE. The supply voltage $V_{CC}$ has drifted down to $10\\,\\text{V}$.", "solution": "The problem asks us to identify which of the given single-component faults would result in an output current of $I_{OUT} = 18\\,\\mu\\text{A}$ in a Widlar current source. To do this, we will first analyze the intended circuit and then evaluate the effect of each proposed fault.\n\nThe core equation for a Widlar current source relates the reference current ($I_{REF}$) and the output current ($I_{OUT}$) through the emitter resistor $R_2$ and the thermal voltage $V_T$. The reference transistor $Q_1$ and the output transistor $Q_2$ are matched. The Kirchhoff's Voltage Law (KVL) loop through the base-emitter junctions of $Q_1$ and $Q_2$ gives:\n$V_{BE1} = V_{BE2} + I_{E2}R_2$\n\nAssuming high beta for the transistors, the emitter current $I_{E2}$ is approximately equal to the collector current $I_{C2}$, which is the output current $I_{OUT}$.\n$I_{E2} \\approx I_{OUT}$\nSo, $V_{BE1} - V_{BE2} = I_{OUT}R_2$.\n\nThe base-emitter voltages are related to the collector currents by the diode equation:\n$V_{BE} = V_T \\ln\\left(\\frac{I_C}{I_S}\\right)$, where $I_S$ is the saturation current.\nFor two matched transistors, $I_S$ is the same. Therefore:\n$V_{BE1} - V_{BE2} = V_T \\ln\\left(\\frac{I_{C1}}{I_S}\\right) - V_T \\ln\\left(\\frac{I_{C2}}{I_S}\\right) = V_T \\ln\\left(\\frac{I_{C1}}{I_{C2}}\\right)$\n\nSince $Q_1$ is diode-connected, its collector current $I_{C1}$ is approximately equal to the reference current $I_{REF}$ (neglecting the small base currents).\n$I_{C1} \\approx I_{REF}$\nAnd $I_{C2} = I_{OUT}$.\nCombining these equations gives the fundamental Widlar source equation:\n$I_{OUT}R_2 = V_T \\ln\\left(\\frac{I_{REF}}{I_{OUT}}\\right)$\n\nThe reference current, $I_{REF}$, is set by the supply voltage $V_{CC}$ and the resistor $R_1$.\n$I_{REF} = \\frac{V_{CC} - V_{BE1}}{R_1}$\n\nFirst, let's calculate the intended $I_{REF}$ for the original design.\nGiven: $V_{CC} = 12\\,\\text{V}$, $R_1 = 22\\,\\text{k}\\Omega$, $V_{BE1} = 0.7\\,\\text{V}$.\n$I_{REF} = \\frac{12\\,\\text{V} - 0.7\\,\\text{V}}{22\\,\\text{k}\\Omega} = \\frac{11.3\\,\\text{V}}{22 \\times 10^3\\,\\Omega} \\approx 0.5136\\,\\text{mA}$\n\nNow, we evaluate each option to see which one yields $I_{OUT} = 18\\,\\mu\\text{A}$.\n\n**A. The resistor $R_1$ was mistakenly replaced with a $33\\,\\text{k}\\Omega$ resistor.**\nIf $R_1 = 33\\,\\text{k}\\Omega$, the reference current changes. The other parameters ($R_2 = 1.0\\,\\text{k}\\Omega$, $V_{CC}=12\\,\\text{V}$) are as designed.\nNew reference current: $I_{REF}' = \\frac{12\\,\\text{V} - 0.7\\,\\text{V}}{33\\,\\text{k}\\Omega} = \\frac{11.3\\,\\text{V}}{33 \\times 10^3\\,\\Omega} \\approx 0.3424\\,\\text{mA}$.\nWe now solve for the resulting $I_{OUT}'$ using the Widlar equation:\n$I_{OUT}' \\cdot (1.0\\,\\text{k}\\Omega) = (25\\,\\text{mV}) \\ln\\left(\\frac{0.3424\\,\\text{mA}}{I_{OUT}'}\\right)$\nWe can test if $I_{OUT}' = 18\\,\\mu\\text{A}$ satisfies this equation.\nLHS = $(18 \\times 10^{-6}\\,\\text{A}) \\cdot (1000\\,\\Omega) = 18\\,\\text{mV}$.\nRHS = $(25\\,\\text{mV}) \\ln\\left(\\frac{0.3424 \\times 10^{-3}\\,\\text{A}}{18 \\times 10^{-6}\\,\\text{A}}\\right) = (25\\,\\text{mV}) \\ln(19.02) \\approx (25\\,\\text{mV}) \\cdot 2.946 = 73.6\\,\\text{mV}$.\nLHS ($18\\,\\text{mV}$) $\\neq$ RHS ($73.6\\,\\text{mV}$). So, this fault does not explain the measurement.\n\n**B. The resistor $R_1$ was mistakenly replaced with a $15\\,\\text{k}\\Omega$ resistor.**\nA decrease in $R_1$ will increase $I_{REF}$, which in turn increases $I_{OUT}$. This is the opposite of the observed effect (a lower than expected current), so this option is incorrect.\n\n**C. The resistor $R_2$ was mistakenly replaced with a $4.7\\,\\text{k}\\Omega$ resistor.**\nIn this case, $R_2 = 4.7\\,\\text{k}\\Omega$. The reference current is the original design value, $I_{REF} = 0.5136\\,\\text{mA}$.\nWe must check if this fault leads to $I_{OUT} = 18\\,\\mu\\text{A}$.\nThe equation is: $(18\\,\\mu\\text{A}) \\cdot R_2' = (25\\,\\text{mV}) \\ln\\left(\\frac{0.5136\\,\\text{mA}}{18\\,\\mu\\text{A}}\\right)$. Let's check the equality:\nLHS = $(18 \\times 10^{-6}\\,\\text{A}) \\cdot (4.7 \\times 10^3\\,\\Omega) = 84.6\\,\\text{mV}$.\nRHS = $(25\\,\\text{mV}) \\ln\\left(\\frac{0.5136 \\times 10^{-3}\\,\\text{A}}{18 \\times 10^{-6}\\,\\text{A}}\\right) = (25\\,\\text{mV}) \\ln(28.53) \\approx (25\\,\\text{mV}) \\cdot 3.351 = 83.8\\,\\text{mV}$.\nLHS ($84.6\\,\\text{mV}$) is extremely close to RHS ($83.8\\,\\text{mV}$). The small difference is due to rounding in the calculations and the simplified model. This is a very strong match.\n\n**D. The resistor $R_2$ was mistakenly replaced with a $470\\,\\Omega$ resistor.**\nA decrease in $R_2$ will increase $I_{OUT}$ to maintain the balance in the Widlar equation. This is the opposite of the observed effect, so this option is incorrect.\n\n**E. The supply voltage $V_{CC}$ has drifted down to $10\\,\\text{V}$.**\nIf $V_{CC} = 10\\,\\text{V}$, the reference current changes. The resistors are at their design values ($R_1 = 22\\,\\text{k}\\Omega$, $R_2=1.0\\,\\text{k}\\Omega$).\nNew reference current: $I_{REF}'' = \\frac{10\\,\\text{V} - 0.7\\,\\text{V}}{22\\,\\text{k}\\Omega} = \\frac{9.3\\,\\text{V}}{22 \\times 10^3\\,\\Omega} \\approx 0.4227\\,\\text{mA}$.\nWe test if this leads to $I_{OUT} = 18\\,\\mu\\text{A}$.\nLHS = $(18 \\times 10^{-6}\\,\\text{A}) \\cdot (1000\\,\\Omega) = 18\\,\\text{mV}$.\nRHS = $(25\\,\\text{mV}) \\ln\\left(\\frac{0.4227 \\times 10^{-3}\\,\\text{A}}{18 \\times 10^{-6}\\,\\text{A}}\\right) = (25\\,\\text{mV}) \\ln(23.48) \\approx (25\\,\\text{mV}) \\cdot 3.156 = 78.9\\,\\text{mV}$.\nLHS ($18\\,\\text{mV}$) $\\neq$ RHS ($78.9\\,\\text{mV}$). So, this fault does not explain the measurement.\n\nBased on the calculations, the only fault that quantitatively accounts for the measured output current of $18\\,\\mu\\text{A}$ is the incorrect installation of a $4.7\\,\\text{k}\\Omega$ resistor for $R_2$.", "answer": "$$\\boxed{C}$$", "id": "1341621"}, {"introduction": "In analog circuit analysis, we often rely on simplified models to make calculations more tractable, but it is vital to recognize their limitations. This exercise critically examines the common \"constant voltage drop\" model for a BJT's base-emitter junction and contrasts it with the more physically accurate Shockley diode equation [@problem_id:1341598]. By working through this comparison, you will discover why the simplified model fails to capture the essential behavior of the Widlar source and why understanding the exponential current-voltage relationship is non-negotiable for accurately predicting its performance. This practice reinforces the importance of selecting the appropriate analytical model for the circuit at hand.", "problem": "An analog circuit designer is analyzing a Widlar current source, which is used to generate a small, stable current. The circuit is constructed using two matched NPN Bipolar Junction Transistors (BJTs), denoted as $Q_1$ and $Q_2$.\n\nThe circuit is configured as follows: A power supply provides a voltage $V_{CC}$. The bases of both transistors are connected together. The collector of $Q_1$ is also connected to this common base node, forming a diode-connected transistor. This node is connected to the power supply $V_{CC}$ through a reference resistor, $R_{REF}$. The emitter of $Q_1$ is connected directly to ground. The collector of $Q_2$ serves as the circuit's output, providing the current $I_{OUT}$. Finally, an emitter resistor, $R_E$, is connected between the emitter of $Q_2$ and ground.\n\nYou are given the following parameters and assumptions:\n- Supply Voltage, $V_{CC} = 5.0\\,\\text{V}$\n- Reference Resistor, $R_{REF} = 8.6\\,\\text{k}\\Omega$\n- Emitter Resistor, $R_E = 1.0\\,\\text{k}\\Omega$\n- The transistors are identical, with a reverse saturation current $I_S = 1.0 \\times 10^{-14}\\,\\text{A}$.\n- The thermal voltage is $V_T = 26\\,\\text{mV}$.\n- The current gain, $\\beta$, of the transistors is large enough so that you can assume the collector current equals the emitter current ($I_C \\approx I_E$) and base currents are negligible.\n- For simplified analysis, a constant base-emitter 'on' voltage is defined as $V_{BE,on} = 0.70\\,\\text{V}$.\n\nYour task is to compare the output current calculated using two different modeling approaches. First, calculate the reference current, $I_{REF}$, which flows through $R_{REF}$. For this initial step only, you should assume the base-emitter voltage of $Q_1$ is constant, $V_{BE1} = V_{BE,on}$. Then, proceed to calculate the output current $I_{OUT}$ using two different methods:\n\n1.  **Method A (Constant Voltage Model):** Calculate the output current, which we will call $I_{OUT,A}$, by assuming that the base-emitter voltage of any conducting transistor is exactly $V_{BE,on}$.\n2.  **Method B (Shockley Model):** Calculate the output current, which we will call $I_{OUT,B}$, using the more precise Shockley relation for the base-emitter junction: $I_C = I_S \\exp(V_{BE}/V_T)$.\n\nDetermine the absolute difference $\\Delta I_{OUT} = |I_{OUT,A} - I_{OUT,B}|$. Express your final answer in microamperes ($\\mu\\text{A}$), rounded to three significant figures.", "solution": "Given the assumptions of large $\\beta$ (so $I_{C} \\approx I_{E}$ and base currents are negligible), the current through $R_{REF}$ equals the collector current of $Q_{1}$.\n\nReference current using the constant-$V_{BE}$ assumption for $Q_{1}$:\nThe base node voltage is $V_{B} = V_{BE1} = V_{BE,on}$. Hence\n$$\nI_{REF}=\\frac{V_{CC}-V_{BE,on}}{R_{REF}}.\n$$\nNumerically,\n$$\nI_{REF}=\\frac{5.0-0.70}{8.6\\times 10^{3}}=5.00\\times 10^{-4}\\,\\text{A}.\n$$\n\nMethod A (constant-voltage model for $Q_{2}$):\nAssuming $V_{BE2}=V_{BE,on}$ and the bases are common, the emitter voltage of $Q_{2}$ is\n$$\nV_{E2}=V_{B}-V_{BE2}=V_{BE,on}-V_{BE,on}=0.\n$$\nTherefore the emitter (and thus collector) current of $Q_{2}$ is\n$$\nI_{OUT,A}=\\frac{V_{E2}}{R_{E}}=0.\n$$\n\nMethod B (Shockley model):\nUse $I_{C}=I_{S}\\exp(V_{BE}/V_{T})$ for both transistors. For $Q_{1}$,\n$$\nI_{REF}=I_{S}\\exp\\!\\left(\\frac{V_{BE1}}{V_{T}}\\right)\\ \\Rightarrow\\ V_{BE1}=V_{T}\\ln\\!\\left(\\frac{I_{REF}}{I_{S}}\\right).\n$$\nFor $Q_{2}$, with common base $V_{B}=V_{BE1}$ and emitter resistor $R_{E}$,\n$$\nV_{BE2}=V_{BE1}-I_{OUT,B}R_{E}.\n$$\nThus\n$$\nI_{OUT,B}=I_{S}\\exp\\!\\left(\\frac{V_{BE2}}{V_{T}}\\right)\n=I_{S}\\exp\\!\\left(\\frac{V_{BE1}-I_{OUT,B}R_{E}}{V_{T}}\\right)\n=I_{REF}\\exp\\!\\left(-\\frac{I_{OUT,B}R_{E}}{V_{T}}\\right).\n$$\nRearranging,\n$$\nI_{OUT,B}\\exp\\!\\left(\\frac{I_{OUT,B}R_{E}}{V_{T}}\\right)=I_{REF}.\n$$\nIntroduce the Lambert $W$ function defined by $W(z)\\exp(W(z))=z$. Let $y=\\frac{I_{OUT,B}R_{E}}{V_{T}}$, then\n$$\ny\\exp(y)=\\frac{I_{REF}R_{E}}{V_{T}}\\ \\Rightarrow\\ y=W\\!\\left(\\frac{I_{REF}R_{E}}{V_{T}}\\right),\n$$\nand hence\n$$\nI_{OUT,B}=\\frac{V_{T}}{R_{E}}\\,W\\!\\left(\\frac{I_{REF}R_{E}}{V_{T}}\\right).\n$$\nNumerically,\n$$\n\\frac{I_{REF}R_{E}}{V_{T}}=\\frac{(5.00\\times 10^{-4})(1.0\\times 10^{3})}{26\\times 10^{-3}}\\approx 19.230769,\n$$\n$$\nW(19.230769)\\approx 2.17810,\n$$\n$$\nI_{OUT,B}=\\frac{26\\times 10^{-3}}{1.0\\times 10^{3}}\\times 2.17810=26\\times 10^{-6}\\times 2.17810 \\approx 5.66306\\times 10^{-5}\\,\\text{A}.\n$$\n\nAbsolute difference (expressed in microamperes):\nThe absolute difference is $\\Delta I_{OUT} = |I_{OUT,A} - I_{OUT,B}| = I_{OUT,B} \\approx 5.66306\\times 10^{-5}\\,\\text{A}$. In microamperes, this is $56.6306\\,\\mu\\text{A}$, which rounds to $56.6\\,\\mu\\text{A}$ to three significant figures.", "answer": "$$\\boxed{56.6}$$", "id": "1341598"}]}