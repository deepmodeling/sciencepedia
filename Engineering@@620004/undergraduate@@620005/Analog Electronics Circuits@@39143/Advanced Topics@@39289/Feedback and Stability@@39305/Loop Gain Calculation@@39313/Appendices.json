{"hands_on_practices": [{"introduction": "We begin our practical exploration with one of the most fundamental feedback configurations: the op-amp voltage follower. Although its overall function is simple, analyzing its loop gain provides a clear, essential illustration of how to dissect a system into its forward path gain, $A$, and its feedback factor, $\\beta$. Mastering this first example [@problem_id:1315750] is the key to building the intuition needed for the more complex circuits that follow.", "problem": "A voltage follower, also known as a unity gain buffer, is constructed using a non-ideal operational amplifier (op-amp). The input voltage signal is connected to the non-inverting terminal. The output of the op-amp is connected directly to its inverting terminal, creating a feedback path. The op-amp is characterized by a finite, real, and constant open-loop gain $A_0$, such that its output voltage $v_{out}$ is related to the differential input voltage $v_d = v_+ - v_-$, by the expression $v_{out} = A_0 v_d$, where $v_+$ and $v_-$ are the voltages at the non-inverting and inverting terminals, respectively.\n\nThis circuit can be analyzed using the standard model for a negative feedback system. In this model, the op-amp constitutes the forward path with a gain $A$. The feedback network processes the output signal to produce a feedback signal with a feedback factor $\\beta$. The loop gain of the system, denoted by $T$, is defined as the product of the forward path gain and the feedback factor.\n\nDetermine the loop gain $T$ for this voltage follower circuit. Express your answer in terms of $A_0$.", "solution": "The problem asks for the loop gain, $T$, of a voltage follower circuit built with an op-amp having a finite open-loop gain $A_0$. The loop gain is defined as the product of the forward path gain, $A$, and the feedback factor, $\\beta$.\n$$T = A \\beta$$\n\nFirst, we identify the forward path gain, $A$. The forward path of the feedback system is composed of the operational amplifier itself. According to the problem statement, the op-amp has a finite open-loop gain of $A_0$. Therefore, the forward path gain is:\n$$A = A_0$$\n\nNext, we need to determine the feedback factor, $\\beta$. The feedback factor is the ratio of the feedback signal to the output signal. The feedback network connects the output of the op-amp back to the input of the amplification stage. In this voltage follower configuration, the output terminal, with voltage $v_{out}$, is connected directly to the inverting input terminal, which receives the feedback signal. Let's call the voltage at the inverting terminal $v_f$.\n$$v_f = v_-$$\n\nDue to the direct connection (a wire), the voltage at the inverting terminal is identical to the output voltage.\n$$v_- = v_{out}$$\nTherefore, the feedback signal is equal to the output signal:\n$$v_f = v_{out}$$\n\nThe feedback factor $\\beta$ is defined by the relation $v_f = \\beta v_{out}$. By comparing this definition with our finding that $v_f = v_{out}$, we can write:\n$$\\beta v_{out} = 1 \\cdot v_{out}$$\nThis implies that the feedback factor is:\n$$\\beta = 1$$\nThis result makes intuitive sense, as the entire output signal (100% of it) is fed back to the input.\n\nFinally, we can calculate the loop gain, $T$, by multiplying the forward gain $A$ by the feedback factor $\\beta$.\n$$T = A \\beta = (A_0)(1)$$\n$$T = A_0$$\n\nThus, the loop gain of the voltage follower circuit is equal to the open-loop gain of the operational amplifier.", "answer": "$$\\boxed{A_{0}}$$", "id": "1315750"}, {"introduction": "Moving from integrated op-amps to discrete components, we now tackle a BJT amplifier with a more intricate feedback scheme. This exercise [@problem_id:1315758] showcases the versatility of loop gain analysis, applying it to a circuit with simultaneous series and shunt feedback. Successfully analyzing this configuration requires careful use of the BJT's small-signal hybrid-$\\pi$ model and demonstrates how to handle more realistic and complex amplifier designs.", "problem": "Consider a feedback amplifier constructed using a single Bipolar Junction Transistor (BJT). The transistor is configured in a common-emitter arrangement. A collector resistor, $R_C$, is connected between the DC power supply and the collector terminal. An unbypassed emitter resistor, $R_E$, connects the emitter terminal to ground. The input signal is provided by a voltage source, $v_s$, which has a series source resistance, $R_S$, connected to the base of the transistor. Global negative feedback is implemented via a feedback resistor, $R_F$, which connects the collector terminal directly to the base terminal.\n\nThe BJT is operating in its linear active region. For small-signal analysis, it can be described by the hybrid-$\\pi$ model with the following parameters: transconductance $g_m$ and base-emitter input resistance $r_{\\pi}$. You may assume that the Early voltage is infinite, which implies that the transistor's small-signal output resistance, $r_o$, can be considered infinite and thus neglected in the analysis.\n\nYour task is to determine the loop gain, $T$, associated with the primary feedback loop created by the resistor $R_F$. Express your answer as a single symbolic expression in terms of $g_m$, $r_{\\pi}$, $R_S$, $R_C$, $R_E$, and $R_F$.", "solution": "Set up the small-signal hybrid-$\\pi$ model with $r_{o}\\to\\infty$, and set the input source to zero to compute loop gain. With $v_{s}=0$, the source resistance $R_{S}$ connects the base to ground. Let $v_{b}$, $v_{e}$, and $v_{c}$ be the base, emitter, and collector small-signal voltages, and let $v_{\\pi}=v_{b}-v_{e}$. The dependent current source is $g_{m}v_{\\pi}$ from collector to emitter, $R_{C}$ connects the collector to AC ground, and $R_{E}$ connects the emitter to ground.\n\nCollector node KCL gives the output transresistance from $v_{\\pi}$:\n$$\n\\frac{v_{c}}{R_{C}}+g_{m}v_{\\pi}=0\n\\;\\;\\Rightarrow\\;\\;\nv_{c}=-g_{m}R_{C}\\,v_{\\pi}.\n$$\n\nEmitter node KCL gives $v_{e}$ in terms of $v_{\\pi}$:\n$$\n\\frac{v_{e}}{R_{E}}+\\frac{v_{e}-v_{b}}{r_{\\pi}}=g_{m}v_{\\pi}\n\\;\\;\\Rightarrow\\;\\;\n\\frac{v_{e}}{R_{E}}-\\frac{v_{\\pi}}{r_{\\pi}}=g_{m}v_{\\pi}\n\\;\\;\\Rightarrow\\;\\;\nv_{e}=R_{E}v_{\\pi}\\left(g_{m}+\\frac{1}{r_{\\pi}}\\right).\n$$\nHence\n$$\nv_{b}=v_{e}+v_{\\pi}=v_{\\pi}\\left[1+R_{E}\\left(g_{m}+\\frac{1}{r_{\\pi}}\\right)\\right].\n$$\nDefine\n$$\nK\\equiv 1+R_{E}\\left(g_{m}+\\frac{1}{r_{\\pi}}\\right).\n$$\n\nWith the feedback path open, define the input current into the base node as $i_{\\text{in}}$. KCL at the base gives\n$$\ni_{\\text{in}}=\\frac{v_{b}}{R_{S}}+\\frac{v_{\\pi}}{r_{\\pi}}.\n$$\nUsing $v_{b}=K\\,v_{\\pi}$, the input impedance seen at the base with the feedback path open is\n$$\nZ_{\\text{in}}\\equiv\\frac{v_{b}}{i_{\\text{in}}}\n=\\frac{1}{\\frac{1}{R_{S}}+\\frac{1}{r_{\\pi}K}}\n=\\frac{R_{S}K}{K+\\frac{R_{S}}{r_{\\pi}}}.\n$$\nThe forward-path transimpedance (with feedback open) from input current to collector voltage is\n$$\nA\\equiv\\frac{v_{c}}{i_{\\text{in}}}\n=\\frac{v_{c}}{v_{\\pi}}\\cdot\\frac{v_{\\pi}}{v_{b}}\\cdot\\frac{v_{b}}{i_{\\text{in}}}\n=\\left(-g_{m}R_{C}\\right)\\cdot\\frac{1}{K}\\cdot Z_{\\text{in}}\n=-\\frac{g_{m}R_{C}Z_{\\text{in}}}{K}.\n$$\n\nReconnect the feedback resistor $R_{F}$ from collector to base. The feedback network injects current into the base node\n$$\ni_{f}=\\frac{v_{c}-v_{b}}{R_{F}},\n$$\nand with the forward amplifier input port presenting $Z_{\\text{in}}$, we have $v_{b}=Z_{\\text{in}}\\,i_{f}$. Solving for $i_{f}$ in terms of $v_{c}$ yields\n$$\ni_{f}=\\frac{v_{c}}{R_{F}+Z_{\\text{in}}}\n\\;\\;\\Rightarrow\\;\\;\n\\beta\\equiv\\frac{i_{f}}{v_{c}}=\\frac{1}{R_{F}+Z_{\\text{in}}}.\n$$\n\nFor shunt-shunt feedback, the loop gain is the return ratio $T=-A\\beta$ (negative sign to account for the inversion in the forward path), hence\n$$\nT=-A\\beta=\\frac{g_{m}R_{C}Z_{\\text{in}}}{K\\left(R_{F}+Z_{\\text{in}}\\right)}.\n$$\nSubstitute $Z_{\\text{in}}=\\dfrac{R_{S}K}{K+\\dfrac{R_{S}}{r_{\\pi}}}$:\n$$\nT=\\frac{g_{m}R_{C}\\,\\dfrac{R_{S}K}{K+\\dfrac{R_{S}}{r_{\\pi}}}}{K\\left(R_{F}+\\dfrac{R_{S}K}{K+\\dfrac{R_{S}}{r_{\\pi}}}\\right)}\n=\\frac{g_{m}R_{C}R_{S}}{\\left(K+\\dfrac{R_{S}}{r_{\\pi}}\\right)R_{F}+R_{S}K}.\n$$\nUsing $K=1+R_{E}\\left(g_{m}+\\dfrac{1}{r_{\\pi}}\\right)$ and grouping terms,\n$$\nT=\\frac{g_{m}R_{C}R_{S}}{K\\left(R_{F}+R_{S}\\right)+\\dfrac{R_{F}R_{S}}{r_{\\pi}}}\n=\\frac{g_{m}R_{C}R_{S}}{\\left[1+R_{E}\\left(g_{m}+\\frac{1}{r_{\\pi}}\\right)\\right]\\left(R_{F}+R_{S}\\right)+\\frac{R_{F}R_{S}}{r_{\\pi}}}.\n$$\nThis expression is fully in terms of $g_{m}$, $r_{\\pi}$, $R_{S}$, $R_{C}$, $R_{E}$, and $R_{F}$, as required.", "answer": "$$\\boxed{\\frac{g_{m}R_{C}R_{S}}{\\left[1+R_{E}\\left(g_{m}+\\frac{1}{r_{\\pi}}\\right)\\right]\\left(R_{F}+R_{S}\\right)+\\frac{R_{F}R_{S}}{r_{\\pi}}}}$$", "id": "1315758"}, {"introduction": "Our final practice extends the concept of loop gain into the frequency domain, a crucial step for understanding stability. We will analyze a three-stage ring oscillator, a circuit whose entire operation is predicated on the principles of feedback and instability. By deriving the frequency-dependent loop gain, $L(j\\omega)$, this problem [@problem_id:1315727] directly addresses the conditions that lead to oscillation, providing a powerful insight into why loop gain is a cornerstone of amplifier and oscillator design.", "problem": "A three-stage ring oscillator is a fundamental building block in modern digital and mixed-signal integrated circuits. It is constructed by connecting three identical inverting amplifier stages in a closed loop. For this problem, consider a ring oscillator built from three identical Complementary Metal-Oxide-Semiconductor (CMOS) inverter stages.\n\nFor small-signal analysis around the DC bias point (where the inverter's input and output voltages are equal), each stage can be characterized by the following parameters:\n- An effective small-signal transconductance, $g_m$, which represents the combined effect of the NMOS and PMOS transistors.\n- An NMOS channel resistance, $r_{on}$.\n- A PMOS channel resistance, $r_{op}$.\n- A total effective load capacitance, $C_L$, present at the output node of each inverter. This capacitance accounts for the parasitic capacitances of the driving stage and the input gate capacitance of the subsequent stage.\n\nThe small-signal output resistance of a single inverter stage, $R_{out}$, is the parallel combination of $r_{on}$ and $r_{op}$.\n\nYour task is to derive a complete analytical expression for the frequency-dependent loop gain, $L(j\\omega)$, of the entire three-stage oscillator. Your final expression should be in terms of the angular frequency $\\omega$, the imaginary unit $j$, and the given physical parameters $g_m$, $r_{on}$, $r_{op}$, and $C_L$.", "solution": "We model each CMOS inverter at its operating point as a linear small-signal stage with:\n- An output node connected to AC ground through the NMOS and PMOS channel resistances in parallel, so the small-signal output resistance is $R_{out} = r_{on} \\parallel r_{op} = \\left( \\frac{1}{r_{on}} + \\frac{1}{r_{op}} \\right)^{-1} = \\frac{r_{on} r_{op}}{r_{on} + r_{op}}$.\n- A load capacitance $C_{L}$ from the output node to ground.\n- A dependent current source modeling the transconductance action of the inverter with value $g_{m} v_{in}$ oriented from the output node to ground (so that an increase in $v_{in}$ increases pull-down current and decreases $v_{out}$).\n\nWriting KCL at the output node with currents flowing to ground taken as positive gives\n$$\n\\frac{v_{out}}{R_{out}} + C_{L} \\frac{d v_{out}}{dt} + g_{m} v_{in} = 0.\n$$\nTaking Laplace transforms and defining $A(s) \\equiv \\frac{V_{out}(s)}{V_{in}(s)}$, we obtain\n$$\n\\left( \\frac{1}{R_{out}} + s C_{L} \\right) V_{out}(s) + g_{m} V_{in}(s) = 0\n\\quad \\Longrightarrow \\quad\nA(s) = - \\frac{g_{m}}{\\frac{1}{R_{out}} + s C_{L}} = - \\frac{g_{m} R_{out}}{1 + s R_{out} C_{L}}.\n$$\nFor a three-stage ring consisting of three identical inverters, the loop gain is the product of the three stage gains,\n$$\nL(s) = \\left[ A(s) \\right]^{3} = - \\frac{\\left( g_{m} R_{out} \\right)^{3}}{\\left( 1 + s R_{out} C_{L} \\right)^{3}}.\n$$\nSubstituting $s = j \\omega$ and $R_{out} = \\frac{r_{on} r_{op}}{r_{on} + r_{op}}$ yields\n$$\nL(j \\omega) = - \\frac{\\left( g_{m} \\frac{r_{on} r_{op}}{r_{on} + r_{op}} \\right)^{3}}{\\left( 1 + j \\omega C_{L} \\frac{r_{on} r_{op}}{r_{on} + r_{op}} \\right)^{3}}.\n$$\nThis expression is fully in terms of $g_{m}$, $r_{on}$, $r_{op}$, $C_{L}$, $\\omega$, and $j$ as required.", "answer": "$$\\boxed{-\\frac{\\left(g_{m}\\,\\frac{r_{on} r_{op}}{r_{on}+r_{op}}\\right)^{3}}{\\left(1+j\\omega C_{L}\\,\\frac{r_{on} r_{op}}{r_{on}+r_{op}}\\right)^{3}}}$$", "id": "1315727"}]}