{"hands_on_practices": [{"introduction": "To build a solid understanding of Total Harmonic Distortion (THD), we begin with a foundational exercise. This practice involves calculating the precise THD of an ideal square wave, a common signal in digital electronics and function generators. By applying Fourier series analysis, you will deconstruct the signal into its fundamental sine wave and its infinite series of harmonics, providing a concrete example of how THD quantifies a signal's deviation from a pure sinusoid. [@problem_id:1342909]", "problem": "In the analysis of electronic systems, it is often necessary to evaluate the purity of a signal. Consider an ideal symmetric square wave voltage, $v(t)$, produced by a function generator. This signal has a peak amplitude of $V_0$ and a period of $T$. The waveform is defined over one period as:\n$$\nv(t) = \\begin{cases}\n+V_0 & \\text{for } 0 < t < T/2 \\\\\n-V_0 & \\text{for } T/2 < t < T\n\\end{cases}\n$$\nThe signal's deviation from a pure sinusoid is quantified by its Total Harmonic Distortion (THD). The THD is defined as the ratio of the root-mean-square (RMS) value of all harmonic components combined (from the second harmonic upwards) to the RMS value of the fundamental component. This can be expressed as:\n$$THD = \\frac{\\sqrt{\\sum_{n=2}^{\\infty} V_{n, \\text{rms}}^2}}{V_{1, \\text{rms}}}$$\nwhere $V_{n, \\text{rms}}$ represents the RMS voltage of the $n$-th harmonic.\n\nCalculate the exact theoretical THD for this ideal square wave. Provide your answer as a simplified analytical expression.", "solution": "Let the square wave have angular fundamental frequency $\\omega_{0} = \\frac{2\\pi}{T}$. Its Fourier series over one period can be written as\n$$\nv(t) = \\sum_{n=1}^{\\infty} \\left[a_{n}\\cos(n\\omega_{0}t) + b_{n}\\sin(n\\omega_{0}t)\\right].\n$$\nSince $v(t+T/2) = -v(t)$ (half-wave symmetry), there is no DC component and no even harmonics. We compute the sine coefficients explicitly:\n$$\nb_{n} = \\frac{2}{T}\\int_{0}^{T} v(t)\\sin(n\\omega_{0}t)\\,dt = \\frac{2}{T}\\left[\\int_{0}^{T/2} V_{0}\\sin(n\\omega_{0}t)\\,dt + \\int_{T/2}^{T} (-V_{0})\\sin(n\\omega_{0}t)\\,dt\\right].\n$$\nEvaluating the integrals,\n$$\n\\int \\sin(n\\omega_{0}t)\\,dt = -\\frac{\\cos(n\\omega_{0}t)}{n\\omega_{0}},\n$$\nso\n$$\n\\int_{0}^{T/2} V_{0}\\sin(n\\omega_{0}t)\\,dt = \\frac{V_{0}}{n\\omega_{0}}\\left[-\\cos\\!\\left(n\\omega_{0}\\frac{T}{2}\\right) + 1\\right],\n$$\n$$\n\\int_{T/2}^{T} (-V_{0})\\sin(n\\omega_{0}t)\\,dt = \\frac{V_{0}}{n\\omega_{0}}\\left[\\cos(n\\omega_{0}T) - \\cos\\!\\left(n\\omega_{0}\\frac{T}{2}\\right)\\right].\n$$\nAdding,\n$$\n\\int_{0}^{T} v(t)\\sin(n\\omega_{0}t)\\,dt = \\frac{V_{0}}{n\\omega_{0}}\\left[2 - 2\\cos\\!\\left(n\\omega_{0}\\frac{T}{2}\\right)\\right].\n$$\nUsing $\\omega_{0} = \\frac{2\\pi}{T}$ gives $\\cos\\!\\left(n\\omega_{0}\\frac{T}{2}\\right) = \\cos(n\\pi) = (-1)^{n}$ and $\\cos(n\\omega_{0}T) = \\cos(2\\pi n) = 1$. Hence\n$$\nb_{n} = \\frac{2}{T}\\cdot \\frac{V_{0}}{n\\omega_{0}}\\cdot 2\\left[1 - \\cos(n\\pi)\\right] = \\frac{4V_{0}}{T n \\omega_{0}}\\left[1 - (-1)^{n}\\right] = \\frac{2V_{0}}{\\pi n}\\left[1 - (-1)^{n}\\right].\n$$\nTherefore $b_{n} = \\frac{4V_{0}}{\\pi n}$ for odd $n$ and $b_{n}=0$ for even $n$, while all $a_{n}=0$. The $n$-th harmonic is a sine with peak amplitude $|b_{n}|$, so its RMS value is\n$$\nV_{n,\\text{rms}} = \\frac{|b_{n}|}{\\sqrt{2}} = \n\\begin{cases}\n\\frac{4V_{0}}{\\pi n\\sqrt{2}}, & n \\text{ odd},\\\\[4pt]\n0, & n \\text{ even}.\n\\end{cases}\n$$\nIn particular, the fundamental RMS is\n$$\nV_{1,\\text{rms}} = \\frac{4V_{0}}{\\pi\\sqrt{2}}.\n$$\nThe THD is\n$$\n\\text{THD} = \\frac{\\sqrt{\\sum_{n=2}^{\\infty} V_{n,\\text{rms}}^{2}}}{V_{1,\\text{rms}}} = \\frac{\\sqrt{\\sum_{\\substack{n=3\\\\ n\\ \\text{odd}}}^{\\infty} \\left(\\frac{4V_{0}}{\\pi n\\sqrt{2}}\\right)^{2}}}{\\frac{4V_{0}}{\\pi\\sqrt{2}}} = \\sqrt{\\sum_{\\substack{n=3\\\\ n\\ \\text{odd}}}^{\\infty} \\frac{1}{n^{2}}}.\n$$\nUsing the known series $\\sum_{n=1}^{\\infty}\\frac{1}{n^{2}} = \\frac{\\pi^{2}}{6}$ and extracting the odd terms,\n$$\n\\sum_{\\substack{n=1\\\\ n\\ \\text{odd}}}^{\\infty} \\frac{1}{n^{2}} = \\sum_{n=1}^{\\infty} \\frac{1}{n^{2}} - \\sum_{n=1}^{\\infty} \\frac{1}{(2n)^{2}} = \\frac{\\pi^{2}}{6} - \\frac{1}{4}\\cdot \\frac{\\pi^{2}}{6} = \\frac{\\pi^{2}}{8}.\n$$\nTherefore,\n$$\n\\sum_{\\substack{n=3\\\\ n\\ \\text{odd}}}^{\\infty} \\frac{1}{n^{2}} = \\frac{\\pi^{2}}{8} - 1,\n$$\nand\n$$\n\\text{THD} = \\sqrt{\\frac{\\pi^{2}}{8} - 1}.\n$$\nThis is the exact theoretical THD of the ideal symmetric square wave.", "answer": "$$\\boxed{\\sqrt{\\frac{\\pi^{2}}{8}-1}}$$", "id": "1342909"}, {"introduction": "Having established the definition of THD, we now explore how distortion arises from circuit non-linearity. This exercise models a common scenario in amplifiers where the output is not perfectly proportional to the input, described by a weak cubic transfer function. This practice will guide you through using trigonometric identities to identify the harmonic frequencies generated by this specific non-linearity, illustrating how symmetric distortion characteristically produces odd harmonics. [@problem_id:1342877]", "problem": "An audio engineer is characterizing a new preamplifier stage. Through testing, they find that for a sufficiently small input signal, the amplifier's input-output voltage relationship can be modeled by a weak cubic non-linearity. The output voltage, $V_{out}$, is related to the input voltage, $V_{in}$, by the transfer function $V_{out}(t) = a_1 V_{in}(t) + a_3 V_{in}^3(t)$. Here, $a_1 > 0$ is the primary linear gain coefficient and $a_3$ is a small, non-zero cubic distortion coefficient. The condition for weak non-linearity is given by $|a_3 V_p^2| \\ll a_1$.\n\nA pure sinusoidal test signal, $V_{in}(t) = V_p \\sin(\\omega_0 t)$, is applied to the input of this preamplifier. The introduction of the non-linear term generates harmonic frequencies in the output signal.\n\nThe Total Harmonic Distortion (THD) is defined as the ratio of the root-mean-square (RMS) voltage of the sum of all harmonic components (frequencies higher than the fundamental) to the RMS voltage of the fundamental component.\n\nAssuming the weak non-linearity condition holds, derive a simplified closed-form analytic expression for the THD of the output signal $V_{out}(t)$. Your final expression should be in terms of the parameters $V_p$, $a_1$, and $a_3$.", "solution": "We start from the given transfer function with a sinusoidal input. Using $V_{in}(t) = V_{p} \\sin(\\omega_{0} t)$, the output is\n$$\nV_{out}(t) = a_{1} V_{p} \\sin(\\omega_{0} t) + a_{3} V_{p}^{3} \\sin^{3}(\\omega_{0} t).\n$$\nApply the trigonometric identity $\\sin^{3} x = \\frac{3 \\sin x - \\sin 3x}{4}$ to separate the fundamental and the third harmonic:\n$$\nV_{out}(t) = \\left(a_{1} V_{p} + \\frac{3}{4} a_{3} V_{p}^{3}\\right) \\sin(\\omega_{0} t) - \\frac{1}{4} a_{3} V_{p}^{3} \\sin(3 \\omega_{0} t).\n$$\nThus, the fundamental component at $\\omega_{0}$ has peak amplitude\n$$\nA_{1} = a_{1} V_{p} + \\frac{3}{4} a_{3} V_{p}^{3},\n$$\nand the only harmonic present is the third harmonic at $3 \\omega_{0}$ with peak amplitude\n$$\nA_{3} = -\\frac{1}{4} a_{3} V_{p}^{3}.\n$$\nFor a sinusoid $A \\sin(\\cdot)$, the RMS value is $|A|/\\sqrt{2}$. The RMS of the sum of all harmonics equals the root of the sum of their individual RMS squares; here only the third harmonic is present, so the total harmonic RMS is $|A_{3}|/\\sqrt{2}$. The fundamental RMS is $|A_{1}|/\\sqrt{2}$. Therefore, the exact THD is\n$$\n\\mathrm{THD} = \\frac{|A_{3}|/\\sqrt{2}}{|A_{1}|/\\sqrt{2}} = \\frac{|A_{3}|}{|A_{1}|} = \\frac{\\left|\\frac{1}{4} a_{3} V_{p}^{3}\\right|}{\\left|a_{1} V_{p} + \\frac{3}{4} a_{3} V_{p}^{3}\\right|} = \\frac{|a_{3}| V_{p}^{2}}{\\left|4 a_{1} + 3 a_{3} V_{p}^{2}\\right|}.\n$$\nUnder the weak non-linearity condition $|a_{3} V_{p}^{2}| \\ll a_{1}$, the cubic correction to the fundamental amplitude is negligible compared to $a_{1} V_{p}$, so $|A_{1}| \\approx a_{1} V_{p}$. Keeping only the leading term in $a_{3} V_{p}^{2}/a_{1}$ yields the simplified closed-form expression\n$$\n\\mathrm{THD} \\approx \\frac{|a_{3}| V_{p}^{3}/4}{a_{1} V_{p}} = \\frac{|a_{3}| V_{p}^{2}}{4 a_{1}}.\n$$\nThis expression is in terms of $V_{p}$, $a_{1}$, and $a_{3}$, with $a_{1} > 0$ and $a_{3}$ possibly of either sign; the absolute value guarantees a nonnegative THD.", "answer": "$$\\boxed{\\frac{|a_{3}| V_{p}^{2}}{4 a_{1}}}$$", "id": "1342877"}, {"introduction": "Our final practice delves into a more subtle, yet critical, aspect of analog circuit design: the impact of real-world component imperfections. We will analyze a BJT differential pair, a circuit topology prized for its inherent ability to cancel even-order distortion. This problem demonstrates how a small, unavoidable mismatch in transistor properties can compromise this ideal behavior, leading to the emergence of second-harmonic distortion. [@problem_id:1342939] Solving this will provide valuable insight into the practical limitations of even the most well-designed circuits.", "problem": "A critical component in high-precision measurement systems is the differential amplifier, often implemented using a Bipolar Junction Transistor (BJT) differential pair. The ideal symmetry of this circuit perfectly cancels all even-order harmonic distortion. However, in practice, unavoidable manufacturing variations lead to mismatches between the two transistors, degrading performance.\n\nConsider a BJT differential pair with transistors $Q_1$ and $Q_2$. Their emitters are connected together and biased by an ideal constant current source of magnitude $I_{EE}$. The collector currents, $i_{C1}$ and $i_{C2}$, are related to their respective base-emitter voltages, $v_{BE1}$ and $v_{BE2}$, by the simplified Ebers-Moll equation: $i_C = I_S \\exp(v_{BE}/V_T)$, where $I_S$ is the saturation current and $V_T$ is the thermal voltage. For this analysis, assume the current gain $\\beta$ is infinite, implying base currents are negligible and the emitter current $i_E$ is equal to the collector current $i_C$.\n\nDue to a systematic process gradient during fabrication, the saturation currents of the two transistors are mismatched. Let $I_{S1} = I_S$ for $Q_1$ and $I_{S2} = I_S(1+\\delta)$ for $Q_2$, where $\\delta$ is the fractional mismatch parameter, assumed to be small ($|\\delta| \\ll 1$).\n\nA sinusoidal differential voltage $v_{in} = v_{B1} - v_{B2} = V_p \\sin(\\omega t)$ is applied to the bases of the transistors. The differential output current is defined as $\\Delta i_C = i_{C1} - i_{C2}$.\n\nYour task is to quantify the nonlinearity introduced by this mismatch. Determine the Second-Harmonic Distortion (HD2), which is defined as the ratio of the amplitude of the signal component at frequency $2\\omega$ to the amplitude of the signal component at the fundamental frequency $\\omega$ present in the output current $\\Delta i_C$. Derive an expression for HD2 that is valid for both small mismatches ($|\\delta| \\ll 1$) and small input signal amplitudes ($V_p \\ll V_T$). Your final answer should be the leading-order non-zero term, expressed as a function of $|\\delta|$ and the normalized input amplitude $x = V_p / V_T$.", "solution": "Let the base-emitter voltages be $v_{BE1}=v_{B1}-v_{E}$ and $v_{BE2}=v_{B2}-v_{E}$, with collector currents given by $i_{Ck}=I_{Sk}\\exp(v_{BEk}/V_{T})$ and $I_{S1}=I_{S}$, $I_{S2}=I_{S}(1+\\delta)$. With infinite current gain, $i_{Ck}=i_{Ek}$, and the ideal tail source enforces $i_{C1}+i_{C2}=I_{EE}$. Denote the applied differential input as $v_{d}=v_{B1}-v_{B2}=V_{p}\\sin(\\omega t)$ and define $u\\equiv v_{d}/V_{T}=x\\sin(\\omega t)$, where $x\\equiv V_{p}/V_{T}$.\n\nWrite $r\\equiv \\exp(u)=\\exp(v_{d}/V_{T})$ and note that\n$$\ni_{C1}=I_{S}\\exp\\!\\left(\\frac{v_{B1}-v_{E}}{V_{T}}\\right),\\quad\ni_{C2}=I_{S}(1+\\delta)\\exp\\!\\left(\\frac{v_{B2}-v_{E}}{V_{T}}\\right).\n$$\nSolving $i_{C1}+i_{C2}=I_{EE}$ for the common factor yields the exact differential-output current as a function of $r$ and $\\delta$:\n$$\n\\frac{\\Delta i_{C}}{I_{EE}}=\\frac{i_{C1}-i_{C2}}{I_{EE}}=\\frac{r-(1+\\delta)}{r+(1+\\delta)}.\n$$\nExpanding to first order in $\\delta$ gives\n$$\n\\frac{\\Delta i_{C}}{I_{EE}}=\\frac{r-1}{r+1}-\\delta\\,\\frac{2r}{(r+1)^{2}}+O(\\delta^{2}).\n$$\nUsing $r=\\exp(u)$, the first term is $\\tanh(u/2)$, and the second term can be written via the identity\n$$\n\\mathrm{sech}^{2}\\!\\left(\\frac{u}{2}\\right)=1-\\tanh^{2}\\!\\left(\\frac{u}{2}\\right)=\\frac{4r}{(r+1)^{2}},\n$$\nso that\n$$\n\\frac{\\Delta i_{C}}{I_{EE}}=\\tanh\\!\\left(\\frac{u}{2}\\right)-\\frac{\\delta}{2}\\,\\mathrm{sech}^{2}\\!\\left(\\frac{u}{2}\\right)+O(\\delta^{2}).\n$$\nFor $x\\ll 1$, expand to the orders needed to obtain the fundamental and the second harmonic. Using $\\tanh(y)\\approx y$ and $\\mathrm{sech}^{2}(y)\\approx 1-y^{2}$ for small $y$, with $y=u/2$, gives\n$$\n\\tanh\\!\\left(\\frac{u}{2}\\right)\\approx \\frac{u}{2},\\qquad\n\\mathrm{sech}^{2}\\!\\left(\\frac{u}{2}\\right)\\approx 1-\\frac{u^{2}}{4}.\n$$\nTherefore,\n$$\n\\Delta i_{C}(t)\\approx I_{EE}\\left[\\frac{u}{2}-\\frac{\\delta}{2}+\\frac{\\delta}{8}u^{2}\\right],\\quad u=x\\sin(\\omega t).\n$$\nThe term $I_{EE}(u/2)$ provides the fundamental at $\\omega$ with amplitude $A_{1}=I_{EE}\\,x/2$. The mismatch-induced even term $I_{EE}(\\delta/8)u^{2}=I_{EE}(\\delta x^{2}/8)\\sin^{2}(\\omega t)$ contains a component at $2\\omega$ with amplitude\n$$\nA_{2}=I_{EE}\\,\\frac{|\\delta|x^{2}}{16},\n$$\nsince $\\sin^{2}(\\omega t)=(1-\\cos(2\\omega t))/2$. Hence the second-harmonic distortion ratio is\n$$\n\\mathrm{HD2}=\\frac{A_{2}}{A_{1}}=\\frac{I_{EE}\\,|\\delta|x^{2}/16}{I_{EE}\\,x/2}=\\frac{|\\delta|\\,x}{8},\n$$\nto leading non-zero order in $|\\delta|$ and $x$.", "answer": "$$\\boxed{\\frac{|\\delta|\\,x}{8}}$$", "id": "1342939"}]}