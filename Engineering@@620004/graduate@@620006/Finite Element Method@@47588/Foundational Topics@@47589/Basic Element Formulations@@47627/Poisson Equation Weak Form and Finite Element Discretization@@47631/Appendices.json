{"hands_on_practices": [{"introduction": "The heart of the finite element method is the assembly of a global stiffness matrix from local, element-wise contributions. This process involves integrating gradients of basis functions over each element, a task greatly simplified by mapping each element to a standard \"reference\" element. This practice [@problem_id:2589003] guides you through the fundamental mechanics of deriving and computing a local stiffness matrix, a cornerstone skill for understanding and implementing any finite element code.", "problem": "Consider the scalar Poisson model problem on a bounded polygonal domain $\\Omega \\subset \\mathbb{R}^{2}$ with homogeneous Dirichlet boundary condition: find $u \\in H_{0}^{1}(\\Omega)$ such that\n$$\n\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, dx \\;=\\; \\int_{\\Omega} f v \\, dx \\quad \\text{for all } v \\in H_{0}^{1}(\\Omega).\n$$\nLet $\\mathcal{T}_{h}$ be a conforming simplicial triangulation of $\\Omega$ into nondegenerate triangles $K$, and let $V_{h} \\subset H_{0}^{1}(\\Omega)$ be the standard continuous, piecewise affine (i.e., polynomial degree $1$) finite element space with the usual nodal (Lagrange) basis $\\{\\phi_{a}\\}$. For each element $K \\in \\mathcal{T}_{h}$ with local nodal basis $\\{\\phi_{1},\\phi_{2},\\phi_{3}\\}$, the element (local) stiffness matrix entries are\n$$\na_{ij}^{K} \\;=\\; \\int_{K} \\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} \\, dx, \\quad i,j \\in \\{1,2,3\\}.\n$$\nYour tasks are:\n\n1) Starting only from the weak form and the definition of the continuous, piecewise affine finite element space, derive the expression for the local stiffness entries $a_{ij}^{K}$ and explain why they depend only on $\\nabla \\phi_{i}$ and $\\nabla \\phi_{j}$ over $K$.\n\n2) Introduce the affine mapping $F_{K}: \\hat{K} \\to K$ from the reference triangle $\\hat{K} = \\operatorname{conv}\\{(0,0),(1,0),(0,1)\\}$, given by $x = F_{K}(\\hat{x}) = B_{K} \\hat{x} + x_{1}$, where $x_{1}$ is a vertex of $K$ and $B_{K}$ is the $2 \\times 2$ Jacobian matrix with columns given by the edge vectors of $K$ emanating from $x_{1}$. Using the chain rule and the change of variables formula for integrals, derive the reference-element expression for $a_{ij}^{K}$ in terms of $\\nabla_{\\hat{x}} \\hat{\\phi}_{i}$, $B_{K}^{-1}$, $B_{K}^{-T}$, and $|\\det B_{K}|$, where $\\hat{\\phi}_{i}$ are the reference-element basis functions.\n\n3) For the specific element $K$ with vertices\n$$\nx_{1} = (0,0), \\quad x_{2} = (2,0), \\quad x_{3} = (0,1),\n$$\ncompute the single entry $a_{12}^{K}$ exactly. Report your final answer as an exact number (no rounding). No units are required.", "solution": "1) The finite element space $V_{h}$ consists of continuous, piecewise affine functions. This means that on any given triangle $K$, a basis function $\\phi_i|_K$ is an affine function of the form $c_{i,1} x_1 + c_{i,2} x_2 + c_{i,3}$. The gradient of such a function, $\\nabla \\phi_i|_K$, is a constant vector over the entire element $K$. The local stiffness matrix entry is $a_{ij}^{K} = \\int_{K} \\nabla \\phi_{i} \\cdot \\nabla \\phi_{j} \\, dx$. Since both gradients are constant vectors on $K$, their dot product is also a constant scalar value over the element. Therefore, the integral simplifies to the product of this constant value and the area of the element, $|K|$:\n$$\na_{ij}^{K} = (\\nabla \\phi_i|_K \\cdot \\nabla \\phi_j|_K) |K|.\n$$\nThis shows that $a_{ij}^{K}$ depends only on the constant gradients of the basis functions over $K$ and the element's area.\n\n2) We are given the affine map $x = F_{K}(\\hat{x}) = B_{K} \\hat{x} + x_{1}$. The physical and reference basis functions are related by $\\phi_i(x) = \\hat{\\phi}_i(F_K^{-1}(x))$. Using the chain rule, the gradient transforms as $\\nabla_x \\phi_i = (J_{F_K^{-1}})^T \\nabla_{\\hat{x}} \\hat{\\phi}_i$. The Jacobian of the inverse map is the inverse of the Jacobian of the forward map, $J_{F_K^{-1}} = (J_{F_K})^{-1} = B_K^{-1}$. Thus, the gradient transformation is:\n$$\n\\nabla_x \\phi_i = B_K^{-T} \\nabla_{\\hat{x}} \\hat{\\phi}_i.\n$$\nThe dot product in physical coordinates can now be written in terms of reference quantities:\n$$\n\\nabla_x \\phi_{i} \\cdot \\nabla_x \\phi_{j} = (B_{K}^{-T} \\nabla_{\\hat{x}} \\hat{\\phi}_{i}) \\cdot (B_{K}^{-T} \\nabla_{\\hat{x}} \\hat{\\phi}_{j}) = (\\nabla_{\\hat{x}} \\hat{\\phi}_{i})^T B_K^{-1} B_K^{-T} (\\nabla_{\\hat{x}} \\hat{\\phi}_{j}).\n$$\nUsing the change of variables formula for integrals, $dx = |\\det(B_K)| \\, d\\hat{x}$, we substitute everything into the definition of $a_{ij}^{K}$:\n$$\na_{ij}^{K} = \\int_{\\hat{K}} \\left[ (\\nabla_{\\hat{x}} \\hat{\\phi}_{i})^T B_K^{-1} B_K^{-T} (\\nabla_{\\hat{x}} \\hat{\\phi}_{j}) \\right] |\\det(B_K)| \\, d\\hat{x}.\n$$\n\n3) For the element $K$ with vertices $x_{1} = (0,0)$, $x_{2} = (2,0)$, and $x_{3} = (0,1)$, we compute $a_{12}^{K} = (\\nabla \\phi_1|_K \\cdot \\nabla \\phi_2|_K) |K|$. The area of this right triangle is $|K| = \\frac{1}{2} \\times 2 \\times 1 = 1$. The basis functions $\\phi_1$ and $\\phi_2$ on $K$ are linear polynomials $\\phi_i(x,y)=ax+by+c$ defined by the conditions $\\phi_i(x_j)=\\delta_{ij}$.\n\nFor $\\phi_1(x,y)$, the conditions $\\phi_1(0,0)=1$, $\\phi_1(2,0)=0$, and $\\phi_1(0,1)=0$ yield the system: $c=1$, $2a+c=0$, $b+c=0$. Solving gives $a=-1/2$, $b=-1$, $c=1$. Thus, $\\phi_1(x,y) = -\\frac{1}{2}x - y + 1$, and its gradient is $\\nabla \\phi_1 = (-\\frac{1}{2}, -1)$.\n\nFor $\\phi_2(x,y)$, the conditions $\\phi_2(0,0)=0$, $\\phi_2(2,0)=1$, and $\\phi_2(0,1)=0$ yield the system: $c=0$, $2a+c=1$, $b+c=0$. Solving gives $a=1/2$, $b=0$, $c=0$. Thus, $\\phi_2(x,y) = \\frac{1}{2}x$, and its gradient is $\\nabla \\phi_2 = (\\frac{1}{2}, 0)$.\n\nThe dot product of the gradients is:\n$$\n\\nabla \\phi_1 \\cdot \\nabla \\phi_2 = \\begin{pmatrix} -1/2 \\\\ -1 \\end{pmatrix} \\cdot \\begin{pmatrix} 1/2 \\\\ 0 \\end{pmatrix} = \\left(-\\frac{1}{2}\\right)\\left(\\frac{1}{2}\\right) + (-1)(0) = -\\frac{1}{4}.\n$$\nFinally, we calculate $a_{12}^{K}$:\n$$\na_{12}^{K} = \\left(-\\frac{1}{4}\\right) \\times |K| = \\left(-\\frac{1}{4}\\right) \\times 1 = -\\frac{1}{4}.\n$$", "answer": "$$\n\\boxed{-\\frac{1}{4}}\n$$", "id": "2589003"}, {"introduction": "After assembling the stiffness matrix, we must consider the quality of the resulting numerical solution. For physical problems governed by the Laplace equation, we expect the solution to obey a maximum principle, meaning no new extrema are created inside the domain. This exercise [@problem_id:2588983] demonstrates that this crucial property is not automatically guaranteed and depends heavily on the geometry of the mesh, specifically whether it satisfies the Delaunay condition. By analyzing a counterexample using the famous cotangent formula, you will develop a deep appreciation for the interplay between mesh quality and the physical fidelity of the finite element solution.", "problem": "Consider the Laplace equation $-\\Delta u = 0$ on a polygonal domain $\\Omega \\subset \\mathbb{R}^{2}$ with Dirichlet boundary condition $u = g$ on $\\partial \\Omega$. Let $\\mathcal{T}_{h}$ be a conforming triangulation of $\\Omega$, and let $V_{h}$ be the space of continuous, piecewise affine functions with respect to $\\mathcal{T}_{h}$. Assume that the triangulation contains a single interior edge connecting two interior vertices $p$ and $q$, and that this edge is shared by exactly two triangles $T_{\\alpha}$ and $T_{\\beta}$. Let the angles opposite the edge $\\overline{pq}$ in these two triangles be $\\alpha$ and $\\beta$, respectively. Suppose further that $\\alpha + \\beta > \\pi$ (an interior, non-Delaunay configuration).\n\nLet $\\mathcal{N}_{p}$ denote the set of boundary vertices directly connected to $p$ by an edge, and let $\\mathcal{N}_{q}$ denote the set of boundary vertices directly connected to $q$ by an edge. Impose Dirichlet data such that $g=1$ at all vertices in $\\mathcal{N}_{p}$, $g=0$ at all vertices in $\\mathcal{N}_{q}$, and $g$ is arbitrary elsewhere on $\\partial \\Omega$ (these other boundary values do not couple directly into the equations at $p$ and $q$ because they are not adjacent to $p$ or $q$ by an edge).\n\nStarting only from the weak form and the definition of the piecewise affine basis functions, derive the $2 \\times 2$ linear system satisfied by the nodal values $u_{p}$ and $u_{q}$ in terms of cotangent weights. Introduce the notations\n$$\nw := \\frac{1}{2}\\big(\\cot \\alpha + \\cot \\beta\\big), \\quad\nA := \\sum_{b \\in \\mathcal{N}_{p}} w_{pb}, \\quad\nB := \\sum_{b \\in \\mathcal{N}_{q}} w_{qb},\n$$\nwhere for any edge $\\overline{ij}$ interior to $\\Omega$ with adjacent angles $\\theta_{1}$ and $\\theta_{2}$ in the two incident triangles, the edge weight is $w_{ij} := \\frac{1}{2}\\big(\\cot \\theta_{1} + \\cot \\theta_{2}\\big)$, and for a boundary edge $\\overline{ib}$ with interior angle $\\theta$ in its unique incident triangle, $w_{ib} := \\frac{1}{2}\\cot \\theta$.\n\nSolve the resulting $2 \\times 2$ system symbolically and provide the exact expression for $u_{p}$ in terms of $A$, $B$, and $w$. You must give your final answer as a single, closed-form analytic expression. Then, using your expression, explain why the condition $\\alpha + \\beta > \\pi$ (equivalently $w < 0$) yields $u_{p} > 1$, thereby furnishing a counterexample to the discrete maximum principle (DMP). Finally, briefly discuss two remedies grounded in mesh optimization that prevent such violations. The final answer must be the exact expression you derived for $u_{p}$.", "solution": "The discrete weak formulation for an interior vertex $p_j$ using linear finite elements leads to the equation $\\sum_{i \\in \\mathcal{N}(j)} w_{ij} (u_j - u_i) = 0$, where $w_{ij}$ are the cotangent weights and $\\mathcal{N}(j)$ is the set of neighboring vertices to $p_j$. We apply this to the two interior vertices $p$ and $q$.\n\nFor vertex $p$, the neighbors are $q$ and the boundary vertices in $\\mathcal{N}_p$. The equation is $w_{pq}(u_p - u_q) + \\sum_{b \\in \\mathcal{N}_p} w_{pb}(u_p - u_b) = 0$. Using the given definitions $w_{pq} = w$, $u_b = 1$, and $\\sum_{b \\in \\mathcal{N}_p} w_{pb} = A$, we get $w(u_p - u_q) + A(u_p - 1) = 0$. Rearranging gives:\n$$\n(w+A)u_p - w u_q = A \\quad (1)\n$$\nFor vertex $q$, the neighbors are $p$ and the boundary vertices in $\\mathcal{N}_q$. The equation is $w_{qp}(u_q - u_p) + \\sum_{b \\in \\mathcal{N}_q} w_{qb}(u_q - u_b) = 0$. Using $w_{qp} = w$, $u_b = 0$, and $\\sum_{b \\in \\mathcal{N}_q} w_{qb} = B$, we get $w(u_q - u_p) + B(u_q - 0) = 0$. Rearranging gives:\n$$\n-w u_p + (w+B) u_q = 0 \\quad (2)\n$$\nThese two equations form the $2 \\times 2$ linear system for $(u_p, u_q)^T$:\n$$\n\\begin{pmatrix}\nw+A & -w \\\\\n-w & w+B\n\\end{pmatrix}\n\\begin{pmatrix}\nu_p \\\\\nu_q\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nA \\\\\n0\n\\end{pmatrix}\n$$\nSolving this system for $u_p$ using Cramer's rule, we first find the determinant of the coefficient matrix, $\\det(K) = (w+A)(w+B) - (-w)^2 = w(A+B) + AB$. Then, the determinant for the numerator of $u_p$ is $\\det(K_p) = A(w+B) - 0 = A(w+B)$. The solution for $u_p$ is:\n$$\nu_p = \\frac{\\det(K_p)}{\\det(K)} = \\frac{A(w+B)}{w(A+B)+AB}\n$$\nNow we analyze this result. The discrete maximum principle (DMP) requires that interior nodal values be bounded by the boundary extrema, i.e., $0 \\le u_p \\le 1$. The condition $\\alpha + \\beta > \\pi$ implies $w = \\frac{1}{2}(\\cot \\alpha + \\cot \\beta)  0$. Assuming a reasonably shaped mesh, the edge weights for boundary edges are positive, so $A > 0$ and $B > 0$. Let's check if $u_p > 1$:\n$$\nu_p - 1 = \\frac{A(w+B)}{w(A+B)+AB} - 1 = \\frac{Aw + AB - (wA + wB + AB)}{w(A+B)+AB} = \\frac{-wB}{w(A+B)+AB}\n$$\nThe numerator $-wB$ is positive since $w  0$ and $B > 0$. The denominator is the determinant of the interior stiffness matrix, which must be positive for a unique solution to exist. Since both numerator and denominator are positive, $u_p - 1 > 0$, which implies $u_p > 1$. This violates the DMP. The violation is due to the non-Delaunay edge, which creates a positive off-diagonal entry $-w$ in the stiffness matrix, preventing it from being an M-matrix.\n\nTwo remedies grounded in mesh optimization are:\n1.  **Delaunay Meshing**: Generate a triangulation that is Delaunay. In a Delaunay mesh, for any interior edge, the sum of the opposite angles is $\\le \\pi$, ensuring $w \\ge 0$. This guarantees all off-diagonal entries of the stiffness matrix are non-positive, which is sufficient for the DMP to hold.\n2.  **Mesh Quality Improvement (Smoothing)**: Apply mesh smoothing algorithms (e.g., Laplacian smoothing) to reposition interior vertices. This process tends to create more equilateral triangles, improving element quality and typically removing non-Delaunay configurations, thus restoring the DMP.", "answer": "$$\n\\boxed{\\frac{A(w+B)}{w(A+B)+AB}}\n$$", "id": "2588983"}, {"introduction": "Enforcing Dirichlet boundary conditions is a critical step in solving PDEs, and the penalty method offers a powerful and easy-to-implement alternative to modifying the function space directly. This convenience, however, involves a delicate trade-off: a large penalty parameter $\\gamma$ enforces the boundary condition more strongly but can severely degrade the conditioning of the system matrix. This problem [@problem_id:2588975] provides a rigorous, analytical look into this trade-off by having you derive the exact condition number of the penalized system, revealing how a seemingly simple modification impacts the numerical stability of the entire problem.", "problem": "Consider the one-dimensional Poisson equation on the interval $\\Omega = (0,1)$,\n$$\n- u''(x) = f(x) \\quad \\text{in } (0,1),\n$$\nwith homogeneous Dirichlet boundary conditions $u(0) = 0$ and $u(1) = 0$. Instead of enforcing the Dirichlet boundary conditions strongly, use the penalty method in the weak formulation: for a penalty parameter $\\gamma  0$, augment the bilinear form by the boundary term $\\gamma \\big(u(0) v(0) + u(1) v(1)\\big)$.\n\nDiscretize with continuous, piecewise-linear finite elements on the uniform mesh with $2$ elements and nodes at $x_1 = 0$, $x_2 = \\tfrac{1}{2}$, and $x_3 = 1$. Let $\\{\\varphi_i\\}_{i=1}^3$ be the standard nodal basis. Starting from first principles (integration by parts for the weak form, the definition of the finite element space, and assembly of the element matrices), derive the $3 \\times 3$ symmetric positive definite (SPD) linear system matrix $A(\\gamma)$ that results from this penalty formulation. Then, using only fundamental definitions (eigenvalues of a symmetric matrix and the definition of the matrix two-norm condition number for SPD matrices), determine the exact closed-form expression of the two-norm condition number $\\kappa_2\\!\\left(A(\\gamma)\\right)$ as a function of $\\gamma$.\n\nYour final answer must be a single closed-form analytic expression in $\\gamma$ for $\\kappa_2\\!\\left(A(\\gamma)\\right)$. No numerical approximation or rounding is required.", "solution": "First, we assemble the system matrix $A(\\gamma)$. The weak formulation with the penalty method is to find $u_h \\in V_h$ such that for all $v_h \\in V_h$:\n$$ \\int_0^1 u'_h(x)v'_h(x) \\,dx + \\gamma u_h(0)v_h(0) + \\gamma u_h(1)v_h(1) = \\int_0^1 f(x)v_h(x) \\,dx $$\nwhere $V_h$ is the space of continuous, piecewise-linear functions on the given mesh. Setting $u_h = \\sum_j c_j \\varphi_j$ and $v_h = \\varphi_i$ yields the system $A(\\gamma)\\mathbf{c} = \\mathbf{F}$ where $A_{ij} = a_\\gamma(\\varphi_j, \\varphi_i)$. The matrix is the sum of the standard stiffness matrix $K$ and a penalty matrix $P$, $A(\\gamma) = K + P$.\n\nThe mesh has two elements of length $h=1/2$. The element stiffness matrix is $k^e = \\frac{1}{h}\\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix} = \\begin{pmatrix} 2  -2 \\\\ -2  2 \\end{pmatrix}$. Assembling these for nodes at $0, 1/2, 1$ gives the global stiffness matrix:\n$$ K = \\begin{pmatrix} 2  -2  0 \\\\ -2  4  -2 \\\\ 0  -2  2 \\end{pmatrix} $$\nThe penalty matrix $P$ comes from the term $\\gamma \\varphi_j(0)\\varphi_i(0) + \\gamma \\varphi_j(1)\\varphi_i(1)$. Since the nodal basis satisfies $\\varphi_i(x_j)=\\delta_{ij}$ and boundary nodes are $x_1=0$ and $x_3=1$, the only non-zero entries are $P_{11} = \\gamma \\varphi_1(0)^2 = \\gamma$ and $P_{33} = \\gamma \\varphi_3(1)^2 = \\gamma$. The penalty matrix is:\n$$ P = \\begin{pmatrix} \\gamma  0  0 \\\\ 0  0  0 \\\\ 0  0  \\gamma \\end{pmatrix} $$\nThe final system matrix is $A(\\gamma) = K + P$:\n$$ A(\\gamma) = \\begin{pmatrix} 2+\\gamma  -2  0 \\\\ -2  4  -2 \\\\ 0  -2  2+\\gamma \\end{pmatrix} $$\nNext, we compute the condition number $\\kappa_2(A(\\gamma)) = \\lambda_{\\max}/\\lambda_{\\min}$ by finding the eigenvalues from the characteristic equation $\\det(A(\\gamma) - \\lambda I) = 0$:\n$$ \\det \\begin{pmatrix} 2+\\gamma-\\lambda  -2  0 \\\\ -2  4-\\lambda  -2 \\\\ 0  -2  2+\\gamma-\\lambda \\end{pmatrix} = (2+\\gamma-\\lambda)[(4-\\lambda)(2+\\gamma-\\lambda) - 8] = 0 $$\nThis equation factors, yielding one eigenvalue $\\lambda_1 = 2+\\gamma$ and a quadratic equation for the other two: $\\lambda^2 - (6+\\gamma)\\lambda + 4\\gamma = 0$. The solutions to the quadratic are:\n$$ \\lambda_{2,3} = \\frac{6+\\gamma \\pm \\sqrt{(6+\\gamma)^2 - 16\\gamma}}{2} = \\frac{6+\\gamma \\pm \\sqrt{\\gamma^2 - 4\\gamma + 36}}{2} $$\nFor any $\\gamma>0$, the largest and smallest eigenvalues are $\\lambda_{\\max} = \\frac{1}{2}(6+\\gamma + \\sqrt{\\gamma^2 - 4\\gamma + 36})$ and $\\lambda_{\\min} = \\frac{1}{2}(6+\\gamma - \\sqrt{\\gamma^2 - 4\\gamma + 36})$. The condition number is their ratio:\n$$ \\kappa_2(A(\\gamma)) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} = \\frac{6+\\gamma + \\sqrt{\\gamma^2 - 4\\gamma + 36}}{6+\\gamma - \\sqrt{\\gamma^2 - 4\\gamma + 36}} $$", "answer": "$$\\boxed{\\frac{6+\\gamma + \\sqrt{\\gamma^2 - 4\\gamma + 36}}{6+\\gamma - \\sqrt{\\gamma^2 - 4\\gamma + 36}}}$$", "id": "2588975"}]}