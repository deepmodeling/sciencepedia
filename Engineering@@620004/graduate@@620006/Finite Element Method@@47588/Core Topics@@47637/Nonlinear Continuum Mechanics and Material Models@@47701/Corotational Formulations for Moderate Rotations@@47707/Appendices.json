{"hands_on_practices": [{"introduction": "A fundamental principle of mechanics is that rigid-body motion should not induce any strain or stress. This exercise powerfully illustrates a key limitation of the standard linear strain tensor, which incorrectly predicts strain for a simple rigid rotation. By working through this problem [@problem_id:2550529], you will see firsthand why more sophisticated kinematic descriptions, like the corotational formulation, are essential for accurately analyzing structures that undergo moderate to large rotations.", "problem": "Consider a $2$-dimensional (2D) rigid-body rotation of a unit square in the plane. Let the undeformed (material) coordinates be $\\mathbf{X} = (X, Y)^{\\mathsf{T}}$ and the deformed (spatial) coordinates be $\\mathbf{x} = (x, y)^{\\mathsf{T}}$. The motion is a pure rotation by angle $\\theta = 30^{\\circ}$ about the origin, so that $\\mathbf{x} = \\mathbf{R}(\\theta)\\,\\mathbf{X}$ with\n$$\n\\mathbf{R}(\\theta) \\;=\\;\n\\begin{pmatrix}\n\\cos\\theta & -\\sin\\theta \\\\\n\\sin\\theta & \\phantom{-}\\cos\\theta\n\\end{pmatrix}.\n$$\nUsing only fundamental kinematic definitions from continuum mechanics and the Finite Element Method (FEM), proceed as follows:\n- Starting from the displacement field $\\mathbf{u}(\\mathbf{X}) = \\mathbf{x} - \\mathbf{X}$, the displacement gradient $\\nabla_{\\!\\mathbf{X}}\\mathbf{u}$, and the small (linearized) strain tensor $\\boldsymbol{\\varepsilon} = \\tfrac{1}{2}\\!\\left(\\nabla_{\\!\\mathbf{X}}\\mathbf{u} + \\nabla_{\\!\\mathbf{X}}\\mathbf{u}^{\\mathsf{T}}\\right)$, compute the global linear strain tensor for this motion. From this tensor, form the engineering strain components $\\varepsilon_{xx}$, $\\varepsilon_{yy}$, and $\\gamma_{xy}$, where $\\gamma_{xy} = 2\\,\\varepsilon_{xy}$. Show that the engineering strain is nonzero for this rigid rotation.\n- Next, define a corotational strain measure appropriate for moderate rotations by removing the rigid rotation through a local frame update. Specifically, use the rotation $\\mathbf{R}(\\theta)$ extracted from the motion to define a corotated configuration via $\\tilde{\\mathbf{x}} = \\mathbf{R}(\\theta)^{\\mathsf{T}} \\mathbf{x}$ and the corresponding corotational displacement $\\tilde{\\mathbf{u}} = \\tilde{\\mathbf{x}} - \\mathbf{X}$. Compute the small strain tensor built from $\\tilde{\\mathbf{u}}$ and show it is identically zero for this rigid rotation.\n\nFor grading, report the scalar value of the global linear normal strain component $\\varepsilon_{xx}$ evaluated at $\\theta = 30^{\\circ}$ as a single closed-form expression. Strain is dimensionless; report the value without units. Do not approximate; provide the exact expression (no rounding).", "solution": "The problem as stated is a valid exercise in fundamental continuum mechanics, designed to demonstrate the deficiency of the linearized strain tensor for finite rotations and the utility of a corotational formulation. The problem is well-posed and scientifically sound. We shall proceed with the derivation.\n\nFirst, we analyze the motion using the global, or material, frame of reference. The displacement field $\\mathbf{u}$ is defined as the difference between the spatial coordinates $\\mathbf{x}$ and the material coordinates $\\mathbf{X}$.\n$$\n\\mathbf{u}(\\mathbf{X}) = \\mathbf{x} - \\mathbf{X}\n$$\nGiven the prescribed rigid body rotation, we have $\\mathbf{x} = \\mathbf{R}(\\theta)\\mathbf{X}$. Substituting this into the displacement definition yields:\n$$\n\\mathbf{u}(\\mathbf{X}) = \\mathbf{R}(\\theta)\\mathbf{X} - \\mathbf{X} = (\\mathbf{R}(\\theta) - \\mathbf{I})\\mathbf{X}\n$$\nwhere $\\mathbf{I}$ is the $2 \\times 2$ identity matrix. The displacement field is a linear function of the material coordinates $\\mathbf{X}$.\n\nThe next step is to compute the displacement gradient, which is the gradient of the vector field $\\mathbf{u}$ with respect to the material coordinates $\\mathbf{X}$, denoted as $\\nabla_{\\mathbf{X}}\\mathbf{u}$.\n$$\n\\nabla_{\\mathbf{X}}\\mathbf{u} = \\frac{\\partial \\mathbf{u}}{\\partial \\mathbf{X}} = \\frac{\\partial}{\\partial \\mathbf{X}} \\left( (\\mathbf{R}(\\theta) - \\mathbf{I})\\mathbf{X} \\right)\n$$\nSince the matrix $(\\mathbf{R}(\\theta) - \\mathbf{I})$ is constant with respect to $\\mathbf{X}$, the gradient is simply the matrix itself.\n$$\n\\nabla_{\\mathbf{X}}\\mathbf{u} = \\mathbf{R}(\\theta) - \\mathbf{I} = \\begin{pmatrix} \\cos\\theta & -\\sin\\theta \\\\ \\sin\\theta & \\cos\\theta \\end{pmatrix} - \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix} = \\begin{pmatrix} \\cos\\theta - 1 & -\\sin\\theta \\\\ \\sin\\theta & \\cos\\theta - 1 \\end{pmatrix}\n$$\nNow, we compute the small, or linearized, strain tensor $\\boldsymbol{\\varepsilon}$ using its definition:\n$$\n\\boldsymbol{\\varepsilon} = \\frac{1}{2}\\left(\\nabla_{\\mathbf{X}}\\mathbf{u} + (\\nabla_{\\mathbf{X}}\\mathbf{u})^{\\mathsf{T}}\\right)\n$$\nSubstituting the expression for the displacement gradient and its transpose:\n$$\n(\\nabla_{\\mathbf{X}}\\mathbf{u})^{\\mathsf{T}} = \\begin{pmatrix} \\cos\\theta - 1 & \\sin\\theta \\\\ -\\sin\\theta & \\cos\\theta - 1 \\end{pmatrix}\n$$\nThus, the strain tensor is:\n$$\n\\boldsymbol{\\varepsilon} = \\frac{1}{2}\\left( \\begin{pmatrix} \\cos\\theta - 1 & -\\sin\\theta \\\\ \\sin\\theta & \\cos\\theta - 1 \\end{pmatrix} + \\begin{pmatrix} \\cos\\theta - 1 & \\sin\\theta \\\\ -\\sin\\theta & \\cos\\theta - 1 \\end{pmatrix} \\right)\n$$\n$$\n\\boldsymbol{\\varepsilon} = \\frac{1}{2} \\begin{pmatrix} 2(\\cos\\theta - 1) & 0 \\\\ 0 & 2(\\cos\\theta - 1) \\end{pmatrix} = \\begin{pmatrix} \\cos\\theta - 1 & 0 \\\\ 0 & \\cos\\theta - 1 \\end{pmatrix}\n$$\nThe components of the engineering strain tensor are $\\varepsilon_{xx}$, $\\varepsilon_{yy}$, and $\\gamma_{xy}$. From the matrix $\\boldsymbol{\\varepsilon} = \\begin{pmatrix} \\varepsilon_{xx} & \\varepsilon_{xy} \\\\ \\varepsilon_{yx} & \\varepsilon_{yy} \\end{pmatrix}$, we identify:\n$$\n\\varepsilon_{xx} = \\cos\\theta - 1\n$$\n$$\n\\varepsilon_{yy} = \\cos\\theta - 1\n$$\n$$\n\\varepsilon_{xy} = 0 \\quad \\implies \\quad \\gamma_{xy} = 2\\varepsilon_{xy} = 0\n$$\nFor any rotation angle $\\theta$ for which $\\cos\\theta \\neq 1$ (i.e., $\\theta$ is not an integer multiple of $2\\pi$ radians or $360^{\\circ}$), the normal strain components $\\varepsilon_{xx}$ and $\\varepsilon_{yy}$ are nonzero. This is a non-physical artifact, as a rigid body rotation should induce zero strain. This demonstrates that the linearized strain tensor is inadequate for describing finite rotations.\n\nNext, we follow the corotational procedure. A corotated configuration $\\tilde{\\mathbf{x}}$ is defined by removing the rigid body rotation from the deformed configuration $\\mathbf{x}$.\n$$\n\\tilde{\\mathbf{x}} = \\mathbf{R}(\\theta)^{\\mathsf{T}} \\mathbf{x}\n$$\nSubstituting the kinematic relation $\\mathbf{x} = \\mathbf{R}(\\theta)\\mathbf{X}$:\n$$\n\\tilde{\\mathbf{x}} = \\mathbf{R}(\\theta)^{\\mathsf{T}} (\\mathbf{R}(\\theta)\\mathbf{X}) = (\\mathbf{R}(\\theta)^{\\mathsf{T}}\\mathbf{R}(\\theta))\\mathbf{X}\n$$\nAs $\\mathbf{R}(\\theta)$ is an orthogonal matrix, its transpose is its inverse, so $\\mathbf{R}(\\theta)^{\\mathsf{T}}\\mathbf{R}(\\theta) = \\mathbf{I}$. This simplifies the corotated configuration to:\n$$\n\\tilde{\\mathbf{x}} = \\mathbf{I}\\mathbf{X} = \\mathbf{X}\n$$\nThe corotational displacement field $\\tilde{\\mathbf{u}}$ is defined as the difference between the corotated configuration and the material configuration:\n$$\n\\tilde{\\mathbf{u}} = \\tilde{\\mathbf{x}} - \\mathbf{X} = \\mathbf{X} - \\mathbf{X} = \\mathbf{0}\n$$\nThe corotational displacement is identically the zero vector. The small strain tensor computed from this displacement field, let us call it $\\tilde{\\boldsymbol{\\varepsilon}}$, is therefore also identically zero.\n$$\n\\nabla_{\\mathbf{X}}\\tilde{\\mathbf{u}} = \\nabla_{\\mathbf{X}}(\\mathbf{0}) = \\mathbf{0}\n$$\n$$\n\\tilde{\\boldsymbol{\\varepsilon}} = \\frac{1}{2}\\left(\\nabla_{\\mathbf{X}}\\tilde{\\mathbf{u}} + (\\nabla_{\\mathbf{X}}\\tilde{\\mathbf{u}})^{\\mathsf{T}}\\right) = \\frac{1}{2}(\\mathbf{0} + \\mathbf{0}) = \\mathbf{0}\n$$\nThis demonstrates that the strain measure defined in the corotated frame correctly evaluates to zero for a pure rigid body rotation, which is the physically correct result.\n\nFinally, we are required to report the specific value of the global linear normal strain component $\\varepsilon_{xx}$ for $\\theta = 30^{\\circ}$. Using the derived expression:\n$$\n\\varepsilon_{xx} = \\cos\\theta - 1\n$$\nFor $\\theta = 30^{\\circ}$, we have $\\cos(30^{\\circ}) = \\frac{\\sqrt{3}}{2}$.\n$$\n\\varepsilon_{xx} = \\frac{\\sqrt{3}}{2} - 1 = \\frac{\\sqrt{3} - 2}{2}\n$$\nThis is the exact, closed-form expression for the spurious normal strain predicted by the linearized strain theory.", "answer": "$$\n\\boxed{\\frac{\\sqrt{3} - 2}{2}}\n$$", "id": "2550529"}, {"introduction": "Having established the need for a method to separate rigid rotation from true deformation, we now turn to the mathematical tool that enables this: the polar decomposition. This practice problem [@problem_id:2550510] guides you through a first-order approximation of the decomposition of the deformation gradient $F$ into a rotation matrix $R$ and a stretch tensor $U$. This exercise provides a concrete look at how a simple shear deformation can be additively decomposed into a pure stretch and a small rotation, a core concept underlying corotational formulations.", "problem": "A corotational finite element method (FEM) for moderate rotations extracts the rigid-body rotation from the deformation gradient by the polar decomposition. Consider the deformation gradient\n$$\nF=\\begin{bmatrix}1 & 0.3 & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix},\n$$\nwhich represents a simple shear in the $x_1$–$x_2$ plane with off-diagonal term $a=0.3$. Treat $a$ as a small parameter and work consistently to first order in $a$ (i.e., neglect all terms of order $a^2$ and higher).\n\nStarting from the definition of the right polar decomposition $F=R\\,U$ with $R\\in\\mathrm{SO}(3)$ proper orthogonal and $U$ symmetric positive definite (SPD), and using only fundamental relations\n$$\nU=(F^{T}F)^{1/2}, \\quad R=F\\,U^{-1},\n$$\nderive first-order approximations for $U$ and $R$ in terms of $a$. Then, interpret the rotation as a small rotation about the $x_3$-axis by defining the scalar angle $\\theta$ via the first-order parameterization\n$$\nR \\approx I + \\theta\\,S, \\quad S=\\begin{bmatrix}0 & 1 & 0\\\\ -1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix}.\n$$\nReport the value of the angle $\\theta$ in radians, rounded to four significant figures. Express the final angle in radians.", "solution": "The problem is subjected to validation.\n\n**Step 1: Extract Givens**\n- The deformation gradient is $F=\\begin{bmatrix}1 & 0.3 & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix}$.\n- The off-diagonal term is denoted as $a=0.3$.\n- The analysis must be consistent to the first order in $a$, neglecting terms of order $a^2$ and higher.\n- The right polar decomposition is $F=R\\,U$, where $R \\in \\mathrm{SO}(3)$ is a proper orthogonal matrix and $U$ is a symmetric positive-definite matrix.\n- The definitions for $U$ and $R$ are $U=(F^{T}F)^{1/2}$ and $R=F\\,U^{-1}$.\n- A first-order parameterization for the rotation matrix $R$ is given as $R \\approx I + \\theta\\,S$, where $I$ is the identity matrix, $\\theta$ is the scalar rotation angle, and $S=\\begin{bmatrix}0 & 1 & 0\\\\ -1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix}$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is a standard exercise in continuum mechanics, specifically the decomposition of deformation for small strains and moderate rotations, a cornerstone of corotational finite element formulations. It is scientifically sound.\n- **Well-Posedness**: The problem is well-posed. It provides all necessary definitions, data, and constraints to uniquely determine the first-order approximations of $U$ and $R$, and subsequently the angle $\\theta$.\n- **Objectivity**: The problem is stated in precise, objective mathematical language, free from ambiguity or subjective content.\n- **Conclusion**: All criteria for a valid problem are met. The problem does not exhibit any flaws such as scientific unsoundness, incompleteness, or ambiguity.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Derivation of the Solution**\nThe problem requires a first-order Taylor series expansion of the polar decomposition components $R$ and $U$ with respect to the small parameter $a$.\n\nThe deformation gradient $F$ can be written in terms of $a$ and the standard basis matrix $E_{12}$ (which has a $1$ at position $(1,2)$ and zeros elsewhere):\n$$\nF = I + a E_{12} = \\begin{bmatrix}1 & a & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix}\n$$\nWe seek first-order expansions for the rotation matrix $R$ and the right stretch tensor $U$ in the form:\n$$\nR = I + a R_1 + O(a^2)\n$$\n$$\nU = I + a U_1 + O(a^2)\n$$\nwhere $O(a^2)$ denotes terms of second order or higher in $a$.\n\nThe properties of $R$ and $U$ impose constraints on the first-order coefficient matrices $R_1$ and $U_1$.\nFrom the orthogonality of $R$, we have $R^T R = I$. Substituting the expansion:\n$$\n(I + a R_1^T + \\dots)(I + a R_1 + \\dots) = I\n$$\n$$\nI + a(R_1 + R_1^T) + O(a^2) = I\n$$\nFor this identity to hold, the first-order term in $a$ must vanish, which implies $R_1 + R_1^T = 0$. This means $R_1$ must be a skew-symmetric matrix.\n\nFrom the symmetry of $U$, we have $U^T = U$. Substituting the expansion:\n$$\n(I + a U_1 + \\dots)^T = I + a U_1 + \\dots\n$$\n$$\nI + a U_1^T + \\dots = I + a U_1 + \\dots\n$$\nThis implies $U_1^T = U_1$, meaning $U_1$ must be a symmetric matrix.\n\nNow, we substitute these expansions into the polar decomposition formula $F = R U$:\n$$\nI + a E_{12} = (I + a R_1 + O(a^2))(I + a U_1 + O(a^2))\n$$\nExpanding the right-hand side and keeping only terms up to the first order in $a$:\n$$\nI + a E_{12} \\approx I + a U_1 + a R_1\n$$\nBy comparing the coefficients of $a$ on both sides, we obtain the fundamental relation:\n$$\nE_{12} = R_1 + U_1\n$$\nThis equation shows that the matrix $E_{12}$ is decomposed into its skew-symmetric part $R_1$ and its symmetric part $U_1$. This decomposition is unique.\nThe symmetric part of a matrix $M$ is given by $\\mathrm{sym}(M) = \\frac{1}{2}(M + M^T)$, and the skew-symmetric part by $\\mathrm{skew}(M) = \\frac{1}{2}(M - M^T)$.\nApplying this to $E_{12}$:\n$$\nU_1 = \\mathrm{sym}(E_{12}) = \\frac{1}{2}(E_{12} + E_{12}^T) = \\frac{1}{2} \\left( \\begin{bmatrix}0 & 1 & 0\\\\ 0 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix} + \\begin{bmatrix}0 & 0 & 0\\\\ 1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix} \\right) = \\frac{1}{2} \\begin{bmatrix}0 & 1 & 0\\\\ 1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix}\n$$\n$$\nR_1 = \\mathrm{skew}(E_{12}) = \\frac{1}{2}(E_{12} - E_{12}^T) = \\frac{1}{2} \\left( \\begin{bmatrix}0 & 1 & 0\\\\ 0 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix} - \\begin{bmatrix}0 & 0 & 0\\\\ 1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix} \\right) = \\frac{1}{2} \\begin{bmatrix}0 & 1 & 0\\\\ -1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix}\n$$\nNow we construct the first-order approximations for $U$ and $R$:\n$$\nU \\approx I + a U_1 = \\begin{bmatrix}1 & 0 & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix} + \\frac{a}{2} \\begin{bmatrix}0 & 1 & 0\\\\ 1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix} = \\begin{bmatrix}1 & a/2 & 0\\\\ a/2 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix}\n$$\n$$\nR \\approx I + a R_1 = \\begin{bmatrix}1 & 0 & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix} + \\frac{a}{2} \\begin{bmatrix}0 & 1 & 0\\\\ -1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix} = \\begin{bmatrix}1 & a/2 & 0\\\\ -a/2 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix}\n$$\nThe problem provides a parameterization for the rotation matrix $R$ in terms of an angle $\\theta$ and a matrix $S$:\n$$\nR \\approx I + \\theta S = \\begin{bmatrix}1 & 0 & 0\\\\ 0 & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix} + \\theta \\begin{bmatrix}0 & 1 & 0\\\\ -1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix} = \\begin{bmatrix}1 & \\theta & 0\\\\ -\\theta & 1 & 0\\\\ 0 & 0 & 1\\end{bmatrix}\n$$\nWe observe that the matrix $S$ given in the problem is exactly $2 R_1$:\n$$\nS = \\begin{bmatrix}0 & 1 & 0\\\\ -1 & 0 & 0\\\\ 0 & 0 & 0\\end{bmatrix} = 2 R_1\n$$\nComparing our derived first-order approximation for $R$ with the given parameterization:\n$$\nI + a R_1 = I + \\theta S\n$$\nSubstituting $S=2R_1$:\n$$\na R_1 = \\theta (2 R_1)\n$$\nSince $R_1$ is not a zero matrix, we can equate the scalar coefficients:\n$$\na = 2 \\theta\n$$\nThis gives the expression for the angle $\\theta$:\n$$\n\\theta = \\frac{a}{2}\n$$\nThe problem specifies the numerical value $a = 0.3$. Substituting this value:\n$$\n\\theta = \\frac{0.3}{2} = 0.15\n$$\nThe question requires the answer in radians, rounded to four significant figures.\n$$\n\\theta = 0.1500 \\text{ rad}\n$$\nThis angle represents the magnitude of the small rotation about the $x_3$-axis that is extracted from the simple shear deformation.", "answer": "$$\n\\boxed{0.1500}\n$$", "id": "2550510"}, {"introduction": "The theoretical correctness of a formulation must be verified through rigorous numerical testing, and the patch test is one of the most fundamental checks in finite element analysis. This hands-on coding exercise [@problem_id:2550488] requires you to implement a corotational procedure for a patch of triangular elements and confirm that it passes the rigid-body motion test. Successfully completing this test ensures your implementation is \"objective\" and does not generate spurious internal forces, a critical quality for any nonlinear structural analysis code.", "problem": "You are to implement a corotational constant-strain triangular element patch test in two dimensions that verifies the vanishing of internal forces under a uniform rigid-body rotation and translation. The finite element patch consists of a mesh of two linear triangular elements forming a convex quadrilateral. The governing kinematics and constitutive assumptions are those of small-strain linear elasticity embedded in a corotational formulation to handle moderate rotations. Your task is to compute the global internal force vector induced by a prescribed rigid-body motion, and to report its Euclidean norm for several test cases. Under an exact extraction of the element rigid rotation, the internal forces must vanish to machine precision.\n\nFundamental base:\n- Use the Finite Element Method (FEM) for a plane-stress, isotropic, linear elastic material with thickness $t$.\n- Small strain tensor: $\\boldsymbol{\\varepsilon} = \\frac{1}{2}(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\mathsf{T}})$.\n- Hooke’s law for plane stress: $\\boldsymbol{\\sigma} = \\mathbf{D}\\,\\boldsymbol{\\varepsilon}$ with\n$$\n\\mathbf{D} = \\frac{E}{1-\\nu^2}\n\\begin{bmatrix}\n1 & \\nu & 0 \\\\\n\\nu & 1 & 0 \\\\\n0 & 0 & \\frac{1-\\nu}{2}\n\\end{bmatrix},\n$$\nwhere $E$ is Young’s modulus and $\\nu$ is Poisson’s ratio.\n- For a linear triangular element with nodes at reference positions $\\mathbf{X}_1=(X_1,Y_1)$, $\\mathbf{X}_2=(X_2,Y_2)$, $\\mathbf{X}_3=(X_3,Y_3)$, the constant strain-displacement matrix $\\mathbf{B}$ is constructed from the area $A$ and the geometry:\n$$\nA = \\frac{1}{2}\\det\\begin{bmatrix}1 & X_1 & Y_1\\\\ 1 & X_2 & Y_2\\\\ 1 & X_3 & Y_3\\end{bmatrix},\\quad\nb_i = Y_{j}-Y_{k},\\quad c_i = X_{k}-X_{j},\\quad \\{i,j,k\\}=\\{1,2,3\\}\\ \\text{cyclic},\n$$\n$$\n\\mathbf{B} = \\frac{1}{2A}\n\\begin{bmatrix}\nb_1 & 0 & b_2 & 0 & b_3 & 0 \\\\\n0 & c_1 & 0 & c_2 & 0 & c_3 \\\\\nc_1 & b_1 & c_2 & b_2 & c_3 & b_3\n\\end{bmatrix}.\n$$\n- The element stiffness is $\\mathbf{K}_e = t\\,A\\,\\mathbf{B}^{\\mathsf{T}}\\mathbf{D}\\mathbf{B}$.\n\nCorotational formulation for moderate rotations:\n- For each element, extract the best-fit rigid rotation $\\mathbf{R}\\in\\mathrm{SO}(2)$ that maps the element’s reference node positions to their current positions in the least-squares sense. Let $\\mathbf{X}_i$ denote the reference position and $\\mathbf{x}_i$ the current position of node $i$. Define the centroids\n$$\n\\bar{\\mathbf{X}} = \\frac{1}{3}\\sum_{i=1}^{3}\\mathbf{X}_i,\\quad \\bar{\\mathbf{x}} = \\frac{1}{3}\\sum_{i=1}^{3}\\mathbf{x}_i,\n$$\nand centered coordinates $\\tilde{\\mathbf{X}}_i = \\mathbf{X}_i - \\bar{\\mathbf{X}}$, $\\tilde{\\mathbf{x}}_i = \\mathbf{x}_i - \\bar{\\mathbf{x}}$. Form the covariance matrix\n$$\n\\mathbf{H} = \\sum_{i=1}^{3} \\tilde{\\mathbf{x}}_i\\,\\tilde{\\mathbf{X}}_i^{\\mathsf{T}} \\in \\mathbb{R}^{2\\times 2}.\n$$\nCompute the Singular Value Decomposition (SVD) $\\mathbf{H}=\\mathbf{U}\\mathbf{S}\\mathbf{V}^{\\mathsf{T}}$ and set $\\mathbf{R}=\\mathbf{U}\\mathbf{V}^{\\mathsf{T}}$ with $\\det(\\mathbf{R})=+1$ enforced by flipping the sign of the last column of $\\mathbf{U}$ if necessary.\n- Define the element’s corotated nodal displacement vector by removing the rigid body motion:\n$$\n\\mathbf{u}^{\\text{corr}}_i = \\mathbf{R}^{\\mathsf{T}}\\left(\\mathbf{x}_i - \\bar{\\mathbf{x}}\\right) - \\left(\\mathbf{X}_i - \\bar{\\mathbf{X}}\\right),\\quad i=1,2,3,\n$$\nand assemble $\\mathbf{u}^{\\text{corr}}_e = [u^{\\text{corr}}_1, v^{\\text{corr}}_1, u^{\\text{corr}}_2, v^{\\text{corr}}_2, u^{\\text{corr}}_3, v^{\\text{corr}}_3]^{\\mathsf{T}}$.\n- The internal force vector in the element's corotated frame is $\\mathbf{f}^{\\text{local}}_e = \\mathbf{K}_e\\,\\mathbf{u}^{\\text{corr}}_e$. These forces are then rotated by $\\mathbf{R}$ back to the global coordinate system before being assembled into the global internal force vector $\\mathbf{f}^{\\text{int}}$.\n\nPatch test description:\n- Reference mesh (coordinates in meters):\n  - Nodes: $\\mathbf{X}_0=(0.0,\\,0.0)$, $\\mathbf{X}_1=(1.0,\\,0.2)$, $\\mathbf{X}_2=(1.5,\\,1.1)$, $\\mathbf{X}_3=(0.1,\\,0.9)$.\n  - Triangles (node indices): $(0,\\,1,\\,2)$ and $(0,\\,2,\\,3)$.\n- Material and thickness:\n  - Young’s modulus $E = 2.10\\times 10^{11}\\ \\text{Pa}$, Poisson’s ratio $\\nu = 0.30$, thickness $t = 1.0\\times 10^{-2}\\ \\text{m}$.\n- Prescribed rigid-body motions (angles in radians, translations in meters):\n  - Case A: $\\theta = 0.0$, $t_x = 0.0$, $t_y = 0.0$.\n  - Case B: $\\theta = 1.0\\times 10^{-8}$, $t_x = 0.3$, $t_y = -0.2$.\n  - Case C: $\\theta = 0.5$, $t_x = 1.2$, $t_y = -0.5$.\n  - Case D: $\\theta = 1.5707963267948966$, $t_x = -0.7$, $t_y = 0.4$.\n  - Case E: $\\theta = 3.0$, $t_x = 2.0$, $t_y = 2.0$.\n\nTask:\n- For each case, construct current positions by applying the uniform rigid motion $\\mathbf{x} = \\mathbf{R}(\\theta)\\,\\mathbf{X} + \\mathbf{t}$, where\n$$\n\\mathbf{R}(\\theta) = \\begin{bmatrix}\\cos\\theta & -\\sin\\theta\\\\ \\sin\\theta & \\cos\\theta\\end{bmatrix},\\quad \\mathbf{t} = \\begin{bmatrix}t_x\\\\ t_y\\end{bmatrix}.\n$$\n- Using the corotational procedure above for each element, assemble the global internal force vector $\\mathbf{f}^{\\text{int}}$ and compute its Euclidean norm $\\|\\mathbf{f}^{\\text{int}}\\|_2$.\n- Because a uniform rigid-body motion induces zero strain, exact extraction implies $\\mathbf{u}^{\\text{corr}}_e=\\mathbf{0}$ and thus $\\mathbf{f}^{\\text{int}}=\\mathbf{0}$ up to machine precision. Report the norms to verify this.\n\nUnits and outputs:\n- Use meters for lengths, Pascals for stiffness, and Newtons for forces.\n- Angles must be in radians.\n- For each test case, output a single float equal to $\\|\\mathbf{f}^{\\text{int}}\\|_2$ in Newtons.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[rA,rB,rC,rD,rE]\"), where each entry corresponds to Cases A through E in order.\n\nTest suite (to be hard-coded in the program):\n- Case A: $(\\theta,t_x,t_y) = (0.0,\\,0.0,\\,0.0)$.\n- Case B: $(\\theta,t_x,t_y) = (1.0\\times 10^{-8},\\,0.3,\\,-0.2)$.\n- Case C: $(\\theta,t_x,t_y) = (0.5,\\,1.2,\\,-0.5)$.\n- Case D: $(\\theta,t_x,t_y) = (1.5707963267948966,\\,-0.7,\\,0.4)$.\n- Case E: $(\\theta,t_x,t_y) = (3.0,\\,2.0,\\,2.0)$.", "solution": "The problem presented is a validation exercise, commonly known as a patch test, for a corotational finite element formulation. The objective is to verify that a patch of two-dimensional linear triangular elements subjected to a rigid-body motion produces zero internal forces. This is a fundamental requirement for any continuum mechanics formulation to ensure objectivity, meaning the material response is independent of the observer's reference frame. The problem is well-posed, scientifically sound, and provides all necessary data and equations to proceed with a numerical implementation.\n\nThe solution methodology proceeds by implementing the specified corotational finite element procedure for a patch of two constant-strain triangle (CST) elements. For each given rigid-body motion case, the algorithm computes the global internal force vector and its Euclidean norm.\n\nFirst, we define the material and geometric properties. The material is linear elastic and isotropic, governed by Hooke's law for plane stress, $\\boldsymbol{\\sigma} = \\mathbf{D}\\,\\boldsymbol{\\varepsilon}$. The constitutive matrix $\\mathbf{D}$ is given by:\n$$\n\\mathbf{D} = \\frac{E}{1-\\nu^2}\n\\begin{bmatrix}\n1 & \\nu & 0 \\\\\n\\nu & 1 & 0 \\\\\n0 & 0 & \\frac{1-\\nu}{2}\n\\end{bmatrix}\n$$\nwhere $E = 2.10\\times 10^{11}\\ \\text{Pa}$ is Young's modulus and $\\nu = 0.30$ is Poisson's ratio. The element thickness is $t = 1.0\\times 10^{-2}\\ \\text{m}$.\n\nThe patch consists of four nodes in their reference configuration: $\\mathbf{X}_0=(0.0,\\,0.0)$, $\\mathbf{X}_1=(1.0,\\,0.2)$, $\\mathbf{X}_2=(1.5,\\,1.1)$, and $\\mathbf{X}_3=(0.1,\\,0.9)$. These nodes form two triangular elements: element 1 with nodes $(0,\\,1,\\,2)$ and element 2 with nodes $(0,\\,2,\\,3)$. The global internal force vector $\\mathbf{f}^{\\text{int}}$ will have $8$ components, representing the two force components for each of the four nodes. This vector is initialized to zero.\n\nThe procedure is executed for each test case, which defines a rigid-body motion through a rotation angle $\\theta$ and a translation vector $\\mathbf{t} = [t_x, t_y]^{\\mathsf{T}}$. The current position $\\mathbf{x}_i$ of each node $i$ is calculated from its reference position $\\mathbf{X}_i$ by the transformation:\n$$\n\\mathbf{x}_i = \\mathbf{R}(\\theta)\\,\\mathbf{X}_i + \\mathbf{t}, \\quad \\text{where} \\quad \\mathbf{R}(\\theta) = \\begin{bmatrix}\\cos\\theta & -\\sin\\theta\\\\ \\sin\\theta & \\cos\\theta\\end{bmatrix}.\n$$\nThe core of the solution lies in processing each element individually and then assembling the results. For each element:\n\n1.  **Element Stiffness Calculation**: The element stiffness matrix $\\mathbf{K}_e$ is constant as it depends only on the reference geometry and material properties. For a triangle with nodes $(i, j, k)$ and reference coordinates $(\\mathbf{X}_i, \\mathbf{X}_j, \\mathbf{X}_k)$, its area $A$ is computed. The geometric coefficients $b_n, c_n$ for $n \\in \\{i, j, k\\}$ are determined, which allows for the construction of the strain-displacement matrix $\\mathbf{B}$. The element stiffness matrix is then calculated as $\\mathbf{K}_e = t\\,A\\,\\mathbf{B}^{\\mathsf{T}}\\mathbf{D}\\mathbf{B}$.\n\n2.  **Corotational Analysis**: This step computes the element's deformation relative to a coordinate system that rotates with the element, thus isolating strain-inducing deformation from rigid-body motion.\n    -   The centroids of the element's reference and current nodal positions, $\\bar{\\mathbf{X}}$ and $\\bar{\\mathbf{x}}$, are computed.\n    -   The covariance matrix $\\mathbf{H} = \\sum_{n=1}^{3} (\\mathbf{x}_n - \\bar{\\mathbf{x}})(\\mathbf{X}_n - \\bar{\\mathbf{X}})^{\\mathsf{T}}$ is formed. This matrix relates the centered current positions to the centered reference positions.\n    -   A Singular Value Decomposition (SVD) of $\\mathbf{H}$ is performed: $\\mathbf{H} = \\mathbf{U}\\mathbf{S}\\mathbf{V}^{\\mathsf{T}}$. The best-fit rotation matrix for the element is then given by $\\mathbf{R}_e = \\mathbf{U}\\mathbf{V}^{\\mathsf{T}}$. To ensure $\\mathbf{R}_e$ is a pure rotation (not a reflection), we enforce $\\det(\\mathbf{R}_e) = +1$. If the initial computation yields $\\det(\\mathbf{R}_e) = -1$, the last column of $\\mathbf{U}$ is negated before re-computing $\\mathbf{R}_e$.\n    -   The corotated displacement vector for each node, $\\mathbf{u}^{\\text{corr}}_n$, is calculated. This vector represents the displacement in the rotated frame:\n        $$\n        \\mathbf{u}^{\\text{corr}}_n = \\mathbf{R}_e^{\\mathsf{T}}(\\mathbf{x}_n - \\bar{\\mathbf{x}}) - (\\mathbf{X}_n - \\bar{\\mathbf{X}}).\n        $$\n        These are assembled into a $6 \\times 1$ element vector $\\mathbf{u}^{\\text{corr}}_e$.\n\n3.  **Element Internal Force Calculation**: The element internal force vector in the corotated frame is computed using the corotated displacements and the element stiffness matrix:\n    $$\n    \\mathbf{f}^{\\text{local}}_e = \\mathbf{K}_e\\,\\mathbf{u}^{\\text{corr}}_e.\n    $$\n    Analytically, for a pure rigid-body motion, the extracted rotation $\\mathbf{R}_e$ should match the applied rotation $\\mathbf{R}(\\theta)$. This leads to $\\mathbf{u}^{\\text{corr}}_e = \\mathbf{0}$, and consequently $\\mathbf{f}^{\\text{local}}_e = \\mathbf{0}$. Numerically, these vectors will be close to zero, limited by floating-point precision. The local forces are then rotated back to the global frame.\n\n4.  **Global Assembly**: The global-frame element internal forces are added (scattered) into the global internal force vector $\\mathbf{f}^{\\text{int}}$ at the positions corresponding to the element's global node indices.\n\nAfter iterating through both elements, the Euclidean norm $\\|\\mathbf{f}^{\\text{int}}\\|_2$ of the fully assembled global internal force vector is computed. This norm represents the final result for the test case. The procedure is repeated for all five test cases. The expected outcome is that for all cases, the norm will be a very small number, confirming that the corotational formulation correctly handles rigid-body motion without generating spurious internal forces. The implemented Python code carries out these steps systematically.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a corotational constant-strain triangular element patch test\n    to verify the vanishing of internal forces under rigid-body motion.\n    \"\"\"\n    # 1. DEFINE CONSTANTS, GEOMETRY, AND MATERIAL PROPERTIES\n    \n    # Material properties\n    E = 2.10e11  # Young's modulus in Pa\n    nu = 0.30    # Poisson's ratio\n    t = 1.0e-2   # Thickness in m\n\n    # Constitutive matrix for plane stress\n    D_factor = E / (1 - nu**2)\n    D = D_factor * np.array([\n        [1, nu, 0],\n        [nu, 1, 0],\n        [0, 0, (1 - nu) / 2]\n    ])\n\n    # Reference nodal coordinates (m)\n    nodes_ref = np.array([\n        [0.0, 0.0],  # Node 0\n        [1.0, 0.2],  # Node 1\n        [1.5, 1.1],  # Node 2\n        [0.1, 0.9]   # Node 3\n    ])\n\n    # Element connectivity (0-based indexing)\n    elements = [\n        [0, 1, 2],\n        [0, 2, 3]\n    ]\n\n    # Test cases: (theta in rad, tx in m, ty in m)\n    test_cases = [\n        (0.0, 0.0, 0.0),                                  # Case A\n        (1.0e-8, 0.3, -0.2),                              # Case B\n        (0.5, 1.2, -0.5),                                 # Case C\n        (1.5707963267948966, -0.7, 0.4),                  # Case D (pi/2)\n        (3.0, 2.0, 2.0)                                   # Case E\n    ]\n    \n    results = []\n\n    # 2. RUN PATCH TEST FOR EACH CASE\n    for theta, tx, ty in test_cases:\n        # Apply rigid body motion to get current nodal coordinates\n        R_glob = np.array([\n            [np.cos(theta), -np.sin(theta)],\n            [np.sin(theta), np.cos(theta)]\n        ])\n        t_glob = np.array([tx, ty])\n        nodes_curr = (R_glob @ nodes_ref.T).T + t_glob\n\n        # Initialize global internal force vector (4 nodes, 2 DOFs each)\n        f_int_global = np.zeros(nodes_ref.size)\n\n        # 3. PROCESS EACH ELEMENT\n        for el_nodes in elements:\n            # Get reference and current coordinates for the element\n            X_e = nodes_ref[el_nodes, :]\n            x_e = nodes_curr[el_nodes, :]\n            \n            # A) Compute element stiffness matrix Ke (based on reference configuration)\n            X1, Y1 = X_e[0, 0], X_e[0, 1]\n            X2, Y2 = X_e[1, 0], X_e[1, 1]\n            X3, Y3 = X_e[2, 0], X_e[2, 1]\n\n            A = 0.5 * np.linalg.det(np.array([[1, X1, Y1], [1, X2, Y2], [1, X3, Y3]]))\n\n            b1, b2, b3 = Y2 - Y3, Y3 - Y1, Y1 - Y2\n            c1, c2, c3 = X3 - X2, X1 - X3, X2 - X1\n\n            B = (1 / (2 * A)) * np.array([\n                [b1,  0, b2,  0, b3,  0],\n                [ 0, c1,  0, c2,  0, c3],\n                [c1, b1, c2, b2, c3, b3]\n            ])\n\n            Ke = t * abs(A) * (B.T @ D @ B)\n\n            # B) Corotational procedure\n            X_bar = np.mean(X_e, axis=0)\n            x_bar = np.mean(x_e, axis=0)\n\n            X_tilde = X_e - X_bar\n            x_tilde = x_e - x_bar\n\n            H = x_tilde.T @ X_tilde\n\n            U, S, Vt = np.linalg.svd(H)\n            \n            # Ensure R is a proper rotation matrix (det(R) = +1)\n            R_e = U @ Vt\n            if np.linalg.det(R_e)  0:\n                U[:, -1] *= -1\n                R_e = U @ Vt\n\n            # Calculate corotated displacements\n            u_corr_e = np.zeros(6)\n            for i in range(3):\n                u_corr_i = R_e.T @ x_tilde[i] - X_tilde[i]\n                u_corr_e[2*i : 2*i+2] = u_corr_i\n            \n            # C) Compute element internal forces in the local (corotated) frame\n            f_int_e_local = Ke @ u_corr_e\n\n            # D) Rotate local forces to global frame and assemble\n            for i in range(3):\n                node_idx = el_nodes[i]\n                # Rotate local nodal force to global frame and add to global vector\n                f_int_global[2*node_idx : 2*node_idx+2] += R_e @ f_int_e_local[2*i : 2*i+2]\n        \n        # 4. COMPUTE NORM OF GLOBAL FORCE VECTOR\n        norm_f_int = np.linalg.norm(f_int_global)\n        results.append(norm_f_int)\n\n    # 5. FORMAT AND PRINT FINAL OUTPUT\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "2550488"}]}