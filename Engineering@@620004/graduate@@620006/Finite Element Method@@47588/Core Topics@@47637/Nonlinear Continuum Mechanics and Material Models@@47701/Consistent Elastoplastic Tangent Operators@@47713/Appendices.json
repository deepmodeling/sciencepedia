{"hands_on_practices": [{"introduction": "Mastering computational plasticity begins with a thorough understanding of its most fundamental model: associative von Mises elastoplasticity. This exercise guides you through the derivation of the consistent elastoplastic tangent operator, $C^{ep}$, directly from the rate-form constitutive equations and the consistency condition. By analyzing the spectral properties of this operator, you will discover the profound link between the mathematical structure of the tangent, the material hardening modulus $H'$, and the physical onset of material instability, a critical concept for predicting failure [@problem_id:2547052].", "problem": "Consider small-strain, rate-independent, associative von Mises elastoplasticity with linear isotropic hardening in three dimensions. The elastic response is isotropic with bulk modulus $K$ and shear modulus $G$, so that the fourth-order elastic stiffness is $C^{e} = K\\,\\mathbf{I} \\otimes \\mathbf{I} + 2G\\,\\mathbb{I}_{\\mathrm{dev}}$, where $\\mathbf{I}$ is the second-order identity tensor and $\\mathbb{I}_{\\mathrm{dev}}$ is the fourth-order deviatoric projector. The total strain is additively decomposed as $\\boldsymbol{\\varepsilon} = \\boldsymbol{\\varepsilon}^{e} + \\boldsymbol{\\varepsilon}^{p}$, and the Cauchy stress is $\\boldsymbol{\\sigma} = C^{e} : \\boldsymbol{\\varepsilon}^{e}$. The von Mises yield function is $f(\\boldsymbol{\\sigma},\\kappa) = \\sqrt{\\frac{3}{2}}\\,\\|\\mathbf{s}\\| - \\sigma_{y0} - H'\\kappa$, where $\\mathbf{s} = \\mathrm{dev}(\\boldsymbol{\\sigma})$ is the stress deviator, $\\kappa$ is the accumulated equivalent plastic strain, $\\sigma_{y0}$ is the initial yield stress, and $H' \\ge 0$ is the linear isotropic hardening modulus. The plastic flow is associative, so that $\\mathrm{d}\\boldsymbol{\\varepsilon}^{p} = \\mathrm{d}\\lambda\\,\\partial f / \\partial \\boldsymbol{\\sigma}$, and the consistency condition holds during plastic loading. Starting from these fundamental definitions and relations, derive the consistent elastoplastic tangent operator $C^{ep}$ appropriate for use in a Newton method within the Finite Element Method (FEM). Restricting attention to the plastic loading regime and to the deviatoric subspace, consider the spectral decomposition of the deviatoric part of $C^{ep}$ with respect to the plastic flow direction $\\mathbf{n} = \\partial f / \\partial \\boldsymbol{\\sigma}$ and its orthogonal complement. Determine, in closed form, the smallest eigenvalue $\\lambda_{\\min}(H',G)$ of the deviatoric part of $C^{ep}$ as a function of the hardening modulus $H'$ and the shear modulus $G$. Discuss, in words, what happens to this eigenvalue and to ellipticity as $H' \\to 0$ (the perfect plasticity limit), and explain the mechanical significance. Provide only the analytic expression for $\\lambda_{\\min}(H',G)$ as your final answer. Express your final answer in Pascals, treating $H'$ and $G$ as given in Pascals. No numerical approximation or rounding is required.", "solution": "The problem as stated is a standard, well-posed problem in the theory of computational plasticity. It is scientifically grounded, objective, and provides all necessary information for its solution. Therefore, we proceed with the derivation.\n\nThe fundamental starting point for deriving the tangent modulus in rate-independent plasticity is the Karush-Kuhn-Tucker (KKT) conditions for plastic loading, specifically the consistency condition, which states that the yield function must remain zero during a plastic state.\n$$ \\mathrm{d} f = 0 $$\nExpanding this using the chain rule gives:\n$$ \\mathrm{d}f = \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}} : \\mathrm{d}\\boldsymbol{\\sigma} + \\frac{\\partial f}{\\partial \\kappa} \\mathrm{d}\\kappa = 0 $$\nLet us denote the gradient of the yield function with respect to stress as $\\mathbf{n}$:\n$$ \\mathbf{n} = \\frac{\\partial f}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial}{\\partial \\boldsymbol{\\sigma}} \\left( \\sqrt{\\frac{3}{2}}\\,\\|\\mathbf{s}\\| - \\sigma_{y0} - H'\\kappa \\right) = \\sqrt{\\frac{3}{2}} \\frac{\\partial \\|\\mathbf{s}\\|}{\\partial \\boldsymbol{\\sigma}} $$\nThe derivative of the norm of the stress deviator $\\mathbf{s}$ with respect to the full stress tensor $\\boldsymbol{\\sigma}$ is $\\frac{\\mathbf{s}}{\\|\\mathbf{s}\\|}$. Thus, the flow direction is:\n$$ \\mathbf{n} = \\sqrt{\\frac{3}{2}} \\frac{\\mathbf{s}}{\\|\\mathbf{s}\\|} $$\nThis tensor $\\mathbf{n}$ is deviatoric, i.e., $\\mathrm{tr}(\\mathbf{n})=0$. Its squared norm is $\\mathbf{n}:\\mathbf{n} = \\frac{3}{2}$.\n\nThe derivative of the yield function with respect to the hardening variable $\\kappa$ is:\n$$ \\frac{\\partial f}{\\partial \\kappa} = -H' $$\nThe increment of the accumulated plastic strain $\\mathrm{d}\\kappa$ is related to the increment of the plastic multiplier $\\mathrm{d}\\lambda$. For the standard von Mises model, this relationship is $\\mathrm{d}\\kappa = \\mathrm{d}\\lambda$. This is derived from the work conjugacy principle, where $\\mathrm{d}\\kappa = \\sqrt{\\frac{2}{3}} \\|\\mathrm{d}\\boldsymbol{\\varepsilon}^p\\|$. Since the flow rule is $\\mathrm{d}\\boldsymbol{\\varepsilon}^p = \\mathrm{d}\\lambda \\mathbf{n}$, we have $\\|\\mathrm{d}\\boldsymbol{\\varepsilon}^p\\| = \\mathrm{d}\\lambda \\|\\mathbf{n}\\| = \\mathrm{d}\\lambda \\sqrt{\\frac{3}{2}}$, which leads to $\\mathrm{d}\\kappa = \\sqrt{\\frac{2}{3}} \\left( \\mathrm{d}\\lambda \\sqrt{\\frac{3}{2}} \\right) = \\mathrm{d}\\lambda$.\n\nSubstituting these into the consistency condition gives:\n$$ \\mathbf{n} : \\mathrm{d}\\boldsymbol{\\sigma} - H' \\mathrm{d}\\lambda = 0 \\implies \\mathbf{n} : \\mathrm{d}\\boldsymbol{\\sigma} = H' \\mathrm{d}\\lambda $$\nThe stress increment $\\mathrm{d}\\boldsymbol{\\sigma}$ is related to the total strain increment $\\mathrm{d}\\boldsymbol{\\varepsilon}$ through Hooke's law and the additive strain decomposition:\n$$ \\mathrm{d}\\boldsymbol{\\sigma} = C^e : \\mathrm{d}\\boldsymbol{\\varepsilon}^e = C^e : (\\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\boldsymbol{\\varepsilon}^p) = C^e : (\\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\lambda \\mathbf{n}) $$\nNow we substitute this expression for $\\mathrm{d}\\boldsymbol{\\sigma}$ into the consistency condition to solve for the plastic multiplier $\\mathrm{d}\\lambda$:\n$$ \\mathbf{n} : \\left[ C^e : (\\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\lambda \\mathbf{n}) \\right] = H' \\mathrm{d}\\lambda $$\n$$ \\mathbf{n} : C^e : \\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\lambda (\\mathbf{n} : C^e : \\mathbf{n}) = H' \\mathrm{d}\\lambda $$\n$$ \\mathrm{d}\\lambda = \\frac{\\mathbf{n} : C^e : \\mathrm{d}\\boldsymbol{\\varepsilon}}{H' + \\mathbf{n} : C^e : \\mathbf{n}} $$\nTo simplify the term $\\mathbf{n} : C^e : \\mathbf{n}$, we use the given form of $C^e = K\\,\\mathbf{I} \\otimes \\mathbf{I} + 2G\\,\\mathbb{I}_{\\mathrm{dev}}$ and the fact that $\\mathbf{n}$ is deviatoric. The action of $C^e$ on $\\mathbf{n}$ is:\n$$ C^e : \\mathbf{n} = (K\\,\\mathbf{I} \\otimes \\mathbf{I} + 2G\\,\\mathbb{I}_{\\mathrm{dev}}) : \\mathbf{n} = K (\\mathbf{I} : \\mathbf{n})\\mathbf{I} + 2G (\\mathbb{I}_{\\mathrm{dev}} : \\mathbf{n}) $$\nSince $\\mathrm{tr}(\\mathbf{n})=0$ and $\\mathbb{I}_{\\mathrm{dev}}$ is a projector onto the deviatoric space, this simplifies to:\n$$ C^e : \\mathbf{n} = 2G\\,\\mathbf{n} $$\nTherefore, the denominator term becomes:\n$$ H' + \\mathbf{n} : C^e : \\mathbf{n} = H' + \\mathbf{n} : (2G\\,\\mathbf{n}) = H' + 2G\\,(\\mathbf{n} : \\mathbf{n}) = H' + 2G\\,\\left(\\frac{3}{2}\\right) = H' + 3G $$\nThe elastoplastic tangent operator $C^{ep}$ is defined by $\\mathrm{d}\\boldsymbol{\\sigma} = C^{ep} : \\mathrm{d}\\boldsymbol{\\varepsilon}$. We find its expression by substituting the formula for $\\mathrm{d}\\lambda$ back into the relation for $\\mathrm{d}\\boldsymbol{\\sigma}$:\n$$ \\mathrm{d}\\boldsymbol{\\sigma} = C^e : \\mathrm{d}\\boldsymbol{\\varepsilon} - \\mathrm{d}\\lambda (C^e:\\mathbf{n}) = C^e : \\mathrm{d}\\boldsymbol{\\varepsilon} - \\frac{(C^e : \\mathbf{n}) \\otimes (\\mathbf{n} : C^e)}{H' + \\mathbf{n} : C^e : \\mathbf{n}} : \\mathrm{d}\\boldsymbol{\\varepsilon} $$\n$$ C^{ep} = C^e - \\frac{(C^e : \\mathbf{n}) \\otimes (C^e : \\mathbf{n})}{H' + 3G} $$\nUsing $C^e:\\mathbf{n} = 2G \\mathbf{n}$, this becomes:\n$$ C^{ep} = C^e - \\frac{(2G\\mathbf{n}) \\otimes (2G\\mathbf{n})}{H' + 3G} = K\\,\\mathbf{I} \\otimes \\mathbf{I} + 2G\\,\\mathbb{I}_{\\mathrm{dev}} - \\frac{4G^2}{H' + 3G} \\mathbf{n} \\otimes \\mathbf{n} $$\nThe problem asks for the eigenvalues of the deviatoric part of this operator, which we denote $C^{ep}_{\\mathrm{dev}}$. This operator maps a deviatoric strain increment $\\mathrm{d}\\boldsymbol{\\varepsilon}_{\\mathrm{dev}}$ to a deviatoric stress increment $\\mathrm{d}\\mathbf{s}$. Noting that $\\mathbf{I}\\otimes\\mathbf{I}$ maps deviatoric tensors to zero and $\\mathbb{I}_{\\mathrm{dev}}$ acts as the identity on them, we obtain:\n$$ C^{ep}_{\\mathrm{dev}} = 2G\\,\\mathbb{I}_{\\mathrm{dev}} - \\frac{4G^2}{H' + 3G} \\mathbf{n} \\otimes \\mathbf{n} $$\nTo find the eigenvalues, we solve the eigenvalue problem $C^{ep}_{\\mathrm{dev}} : \\mathbf{v} = \\lambda \\mathbf{v}$, where $\\mathbf{v}$ is a non-zero deviatoric tensor.\n$$ \\left( 2G\\,\\mathbb{I}_{\\mathrm{dev}} - \\frac{4G^2}{H' + 3G} \\mathbf{n} \\otimes \\mathbf{n} \\right) : \\mathbf{v} = \\lambda \\mathbf{v} $$\n$$ 2G\\mathbf{v} - \\frac{4G^2}{H' + 3G} (\\mathbf{n} : \\mathbf{v}) \\mathbf{n} = \\lambda \\mathbf{v} $$\nWe consider two cases for the eigenvector $\\mathbf{v}$:\n\nCase 1: The eigenvector $\\mathbf{v}$ is parallel to the flow direction $\\mathbf{n}$.\nLet $\\mathbf{v} = c\\mathbf{n}$ for some non-zero scalar $c$.\n$$ 2G(c\\mathbf{n}) - \\frac{4G^2}{H' + 3G} (\\mathbf{n} : c\\mathbf{n}) \\mathbf{n} = \\lambda (c\\mathbf{n}) $$\nDividing by $c$ and using $\\mathbf{n} : \\mathbf{n} = \\frac{3}{2}$:\n$$ \\left( 2G - \\frac{4G^2}{H' + 3G} \\left(\\frac{3}{2}\\right) \\right) \\mathbf{n} = \\lambda \\mathbf{n} $$\n$$ \\lambda_1 = 2G - \\frac{6G^2}{H' + 3G} = \\frac{2G(H' + 3G) - 6G^2}{H' + 3G} = \\frac{2GH' + 6G^2 - 6G^2}{H' + 3G} = \\frac{2GH'}{H' + 3G} $$\n\nCase 2: The eigenvector $\\mathbf{v}$ is orthogonal to the flow direction $\\mathbf{n}$ (i.e., $\\mathbf{v}$ is in the hyperplane orthogonal to $\\mathbf{n}$ within the space of deviatoric tensors).\nHere, $\\mathbf{n} : \\mathbf{v} = 0$. The eigenvalue equation simplifies to:\n$$ 2G\\mathbf{v} - \\mathbf{0} = \\lambda \\mathbf{v} $$\n$$ \\lambda_2 = 2G $$\nThis eigenvalue has a multiplicity of $4$, corresponding to the dimensionality of the orthogonal complement of $\\mathbf{n}$ in the $5$-dimensional space of symmetric deviatoric tensors.\n\nTo find the smallest eigenvalue, we compare $\\lambda_1$ and $\\lambda_2$. Since $G > 0$ and the hardening modulus $H' \\ge 0$, we have $H' \\le H' + 3G$. Consequently, the fraction $\\frac{H'}{H' + 3G} \\le 1$. Therefore, $\\lambda_1 = 2G \\left(\\frac{H'}{H' + 3G}\\right) \\le 2G = \\lambda_2$. The smallest eigenvalue is $\\lambda_{\\min} = \\lambda_1$.\n$$ \\lambda_{\\min}(H',G) = \\frac{2GH'}{H' + 3G} $$\nIn the limit of perfect plasticity, $H' \\to 0$, the smallest eigenvalue $\\lambda_{\\min}$ approaches $0$. The tangent operator $C^{ep}$ ceases to be positive definite and becomes only positive semi-definite. This loss of strong ellipticity of the governing equations of equilibrium is a critical event. The mechanical significance is that the material loses all stiffness in the direction of plastic flow, $\\mathbf{n}$. This allows for deformation to occur under constant stress, which is the definition of perfect plastic flow. This mathematical condition is a prerequisite for the physical phenomenon of strain localization, such as the formation of shear bands, which can lead to material failure. In numerical simulations using the Finite Element Method (FEM), the singularity of the tangent stiffness matrix at the element level causes severe numerical difficulties and indicates the failure of the classical continuum formulation to describe the post-localization behavior.", "answer": "$$\n\\boxed{\\frac{2GH'}{H' + 3G}}\n$$", "id": "2547052"}, {"introduction": "Building on the foundational principles, we now extend our analysis to more complex material models, such as the Drucker-Prager model, which is essential for describing the behavior of geomaterials like soil and rock. This practice challenges you to derive a specific component of the material response, the algorithmic bulk modulus $K_{\\mathrm{alg}}$, for a non-associative formulation where the yield function and plastic potential differ [@problem_id:2547037]. Successfully completing this task demonstrates your ability to generalize the derivation of tangent operators to a broader class of models and to precisely quantify how plasticity affects the material's stiffness under specific loading conditions.", "problem": "You are given a small-strain isotropic elastoplastic solid obeying linear elasticity and a nonassociative Drucker–Prager model. The elastic response is characterized by the bulk modulus $K$ and the shear modulus $G$. Adopt the tension-positive sign convention and define the mean stress $p$ and the von Mises equivalent stress $q$ by\n$$\np \\equiv \\frac{1}{3} \\operatorname{tr}(\\sigma), \n\\qquad \nq \\equiv \\sqrt{\\frac{3}{2}} \\, \\|s\\|,\n\\qquad \ns \\equiv \\sigma - p \\, \\mathbf{I},\n$$\nwhere $\\sigma$ is the Cauchy stress tensor and $\\mathbf{I}$ is the second-order identity tensor.\n\nThe Drucker–Prager yield function and plastic potential are, respectively,\n$$\nf(\\sigma,\\kappa) \\equiv q + \\alpha \\, p - k(\\kappa),\n\\qquad\ng(\\sigma) \\equiv q + \\beta \\, p,\n$$\nwhere $\\alpha$ is the friction parameter, $\\beta$ is the dilation parameter, and $k(\\kappa)$ is the hardening function of the hardening variable $\\kappa$. Consider linear isotropic hardening defined by\n$$\nk(\\kappa) = \\sigma_{y0} + H \\, \\kappa,\n$$\nwith initial yield strength $\\sigma_{y0}$ and constant plastic modulus $H \\ge 0$. Let the hardening variable be the accumulated equivalent plastic strain $\\kappa \\equiv \\bar{\\varepsilon}^{p}$ evolving as\n$$\n\\mathrm{d}\\bar{\\varepsilon}^{p} = \\sqrt{\\frac{2}{3}} \\, \\|\\mathrm{d}\\varepsilon^{p}\\|,\n\\qquad\n\\mathrm{d}\\varepsilon^{p} = \\mathrm{d}\\lambda \\, \\frac{\\partial g}{\\partial \\sigma},\n$$\nwhere $\\mathrm{d}\\lambda \\ge 0$ is the plastic consistency parameter.\n\nUsing the rate-form elastoplastic framework with the consistency condition and the consistent (algorithmic) linearization, compute the algorithmic bulk modulus $K_{\\mathrm{alg}}$, defined as the proportionality factor between $\\mathrm{d}p$ and the applied volumetric strain increment $\\mathrm{d}\\varepsilon_{v} \\equiv \\operatorname{tr}(\\mathrm{d}\\varepsilon)$ during plastic loading on the yield surface, when the imposed strain increment is purely volumetric,\n$$\n\\mathrm{d}\\varepsilon = \\frac{1}{3} \\, \\mathrm{d}\\varepsilon_{v} \\, \\mathbf{I}.\n$$\n\nExpress your answer as a single closed-form analytic expression for $K_{\\mathrm{alg}}$ in terms of $K$, $G$, $\\alpha$, $\\beta$, and $H$ only. Do not substitute numbers. No rounding is required. Do not include units in your final expression.", "solution": "The problem is valid as it is a well-posed question in continuum mechanics and computational plasticity, based on established scientific principles and formalisms of the Drucker-Prager model.\n\nThe objective is to compute the algorithmic bulk modulus, $K_{\\mathrm{alg}}$, for a material undergoing plastic loading. The algorithmic modulus is derived from the consistent linearization of the discrete stress update algorithm (return mapping). We are given a specific loading condition: a purely volumetric strain increment, $\\mathrm{d}\\varepsilon = \\frac{1}{3} \\mathrm{d}\\varepsilon_{v} \\, \\mathbf{I}$. For finite increments, this is $\\Delta\\varepsilon = \\frac{1}{3} \\Delta\\varepsilon_{v} \\, \\mathbf{I}$. The algorithmic bulk modulus is defined by the relationship $\\Delta p = K_{\\mathrm{alg}} \\Delta\\varepsilon_v$, where $\\Delta p$ is the total increment in mean stress.\n\nThe stress update procedure follows an elastic-predictor, plastic-corrector scheme. Let the state at the beginning of the increment be $(\\sigma_n, \\kappa_n)$, which lies on the yield surface, so $f(\\sigma_n, \\kappa_n) = 0$.\n\nFirst, a trial elastic stress, $\\sigma_{n+1}^{\\text{tr}}$, is computed:\n$$\n\\sigma_{n+1}^{\\text{tr}} = \\sigma_n + \\mathbf{C}^e : \\Delta\\varepsilon\n$$\nwhere $\\mathbf{C}^e$ is the isotropic elastic stiffness tensor, $\\mathbf{C}^e = 2G \\mathbf{P}_{\\text{sym}} + K \\mathbf{I} \\otimes \\mathbf{I}$. For the given purely volumetric strain increment $\\Delta\\varepsilon = \\frac{1}{3}\\Delta\\varepsilon_v \\mathbf{I}$, the trial stress increment is purely hydrostatic:\n$$\n\\Delta\\sigma^{\\text{tr}} = \\mathbf{C}^e : \\left(\\frac{1}{3}\\Delta\\varepsilon_v \\mathbf{I}\\right) = (K \\mathbf{I} \\otimes \\mathbf{I}) : \\left(\\frac{1}{3}\\Delta\\varepsilon_v \\mathbf{I}\\right) = K \\Delta\\varepsilon_v \\mathbf{I}\n$$\nThe trial stress is then $\\sigma_{n+1}^{\\text{tr}} = \\sigma_n + K \\Delta\\varepsilon_v \\mathbf{I}$. The deviatoric part of the trial stress remains unchanged, $s_{n+1}^{\\text{tr}} = s_n$, which implies the trial von Mises stress $q_{n+1}^{\\text{tr}} = q_n$. The trial mean stress is $p_{n+1}^{\\text{tr}} = p_n + K \\Delta\\varepsilon_v$.\n\nThe yield condition is checked for the trial state:\n$$\nf^{\\text{tr}} = f(\\sigma_{n+1}^{\\text{tr}}, \\kappa_n) = q_{n+1}^{\\text{tr}} + \\alpha p_{n+1}^{\\text{tr}} - k(\\kappa_n) = q_n + \\alpha (p_n + K \\Delta\\varepsilon_v) - k(\\kappa_n)\n$$\nSince the initial state is on the yield surface, $q_n + \\alpha p_n - k(\\kappa_n) = 0$. Therefore, $f^{\\text{tr}} = \\alpha K \\Delta\\varepsilon_v$. Plastic loading occurs if $f^{\\text{tr}} > 0$. We assume this condition holds.\n\nIf $f^{\\text{tr}} > 0$, a plastic correction is required. The final stress $\\sigma_{n+1}$ is obtained by returning the trial stress to the updated yield surface. The update equations are:\n$$\n\\sigma_{n+1} = \\sigma_{n+1}^{\\text{tr}} - \\Delta\\varepsilon^p_c : \\mathbf{C}^e = \\sigma_{n+1}^{\\text{tr}} - \\Delta\\lambda \\, \\mathbf{C}^e : \\frac{\\partial g}{\\partial \\sigma}\\bigg|_{\\sigma_{n+1}}\n$$\n$$\n\\kappa_{n+1} = \\kappa_n + \\Delta\\kappa\n$$\n$$\nf(\\sigma_{n+1}, \\kappa_{n+1}) = 0\n$$\nThe gradient of the plastic potential $g(\\sigma) = q + \\beta p$ is $\\frac{\\partial g}{\\partial \\sigma} = \\frac{\\partial q}{\\partial \\sigma} + \\beta \\frac{\\partial p}{\\partial \\sigma}$. With $\\frac{\\partial p}{\\partial \\sigma} = \\frac{1}{3}\\mathbf{I}$ and $\\frac{\\partial q}{\\partial \\sigma} = \\sqrt{\\frac{3}{2}} \\frac{s}{\\|s\\|} \\equiv \\sqrt{\\frac{3}{2}} \\mathbf{N}$, we have:\n$$\n\\frac{\\partial g}{\\partial \\sigma} \\equiv \\mathbf{B} = \\sqrt{\\frac{3}{2}}\\mathbf{N} + \\frac{\\beta}{3}\\mathbf{I}\n$$\nThe elastic tensor acts on $\\mathbf{B}_{n+1}$ as: $\\mathbf{C}^e : \\mathbf{B}_{n+1} = 2G \\sqrt{\\frac{3}{2}}\\mathbf{N}_{n+1} + K \\beta \\mathbf{I}$.\nThe stress update is decomposed into deviatoric and volumetric parts:\n$$\ns_{n+1} = s_{n+1}^{\\text{tr}} - \\Delta\\lambda \\, (2G \\sqrt{\\frac{3}{2}}\\mathbf{N}_{n+1}) = s_n - 3G \\Delta\\lambda \\mathbf{N}_{n+1}\n$$\n$$\np_{n+1} = p_{n+1}^{\\text{tr}} - \\Delta\\lambda \\, K \\beta = p_n + K\\Delta\\varepsilon_v - K\\beta\\Delta\\lambda\n$$\nFrom the equation for $s_{n+1}$, we can see that $s_{n+1}$ must be coaxial with $s_n$, which means the direction of the deviatoric stress does not change during the correction: $\\mathbf{N}_{n+1} = \\mathbf{N}_n \\equiv \\mathbf{N}$. This significantly simplifies the problem, as $\\mathbf{B}$ becomes constant during the return.\nThe update for the von Mises stress $q$ becomes:\n$$\nq_{n+1} = \\sqrt{\\frac{3}{2}}\\|s_{n+1}\\| = \\sqrt{\\frac{3}{2}}(\\|s_n\\| - 3G\\Delta\\lambda) = q_n - 3G\\Delta\\lambda\n$$\nThe hardening variable $\\kappa$ is updated by $\\Delta\\kappa = \\Delta\\bar{\\varepsilon}^p = \\sqrt{\\frac{2}{3}\\|\\Delta\\varepsilon^p\\|^2}$. The plastic strain increment is $\\Delta\\varepsilon^p = \\Delta\\lambda \\, \\mathbf{B}$.\n$$\n\\|\\mathbf{B}\\|^2 = \\mathbf{B}:\\mathbf{B} = \\left(\\sqrt{\\frac{3}{2}}\\mathbf{N} + \\frac{\\beta}{3}\\mathbf{I}\\right):\\left(\\sqrt{\\frac{3}{2}}\\mathbf{N} + \\frac{\\beta}{3}\\mathbf{I}\\right) = \\frac{3}{2}(\\mathbf{N}:\\mathbf{N}) + \\frac{\\beta^2}{9}(\\mathbf{I}:\\mathbf{I}) = \\frac{3}{2} + \\frac{\\beta^2}{3}\n$$\nSo, $\\Delta\\kappa = \\Delta\\lambda \\sqrt{\\frac{2}{3}\\left(\\frac{3}{2} + \\frac{\\beta^2}{3}\\right)} = \\Delta\\lambda \\sqrt{1 + \\frac{2\\beta^2}{9}}$.\nThe hardening function updates as $k_{n+1} = k_n + H\\Delta\\kappa = k_n + H\\Delta\\lambda\\sqrt{1 + \\frac{2\\beta^2}{9}}$.\n\nThe final state must satisfy the consistency condition $f(\\sigma_{n+1}, \\kappa_{n+1})=0$:\n$$\nq_{n+1} + \\alpha p_{n+1} - k_{n+1} = 0\n$$\nSubstituting the expressions for $q_{n+1}$, $p_{n+1}$, and $k_{n+1}$:\n$$\n(q_n - 3G\\Delta\\lambda) + \\alpha(p_n + K\\Delta\\varepsilon_v - K\\beta\\Delta\\lambda) - \\left(k_n + H\\Delta\\lambda\\sqrt{1 + \\frac{2\\beta^2}{9}}\\right) = 0\n$$\nGrouping terms by $\\Delta\\lambda$ and using $q_n + \\alpha p_n - k_n = f(\\sigma_n, \\kappa_n) = 0$:\n$$\n\\alpha K \\Delta\\varepsilon_v - \\Delta\\lambda \\left( 3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}} \\right) = 0\n$$\nSolving for the plastic multiplier $\\Delta\\lambda$:\n$$\n\\Delta\\lambda = \\frac{\\alpha K \\Delta\\varepsilon_v}{3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}}}\n$$\nThe increment in mean stress is $\\Delta p = p_{n+1} - p_n = K\\Delta\\varepsilon_v - K\\beta\\Delta\\lambda$.\nSubstituting the expression for $\\Delta\\lambda$:\n$$\n\\Delta p = K\\Delta\\varepsilon_v - K\\beta \\left( \\frac{\\alpha K \\Delta\\varepsilon_v}{3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}}} \\right)\n$$\nFactoring out $\\Delta\\varepsilon_v$:\n$$\n\\Delta p = \\left( K - \\frac{K^2\\alpha\\beta}{3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}}} \\right) \\Delta\\varepsilon_v\n$$\nBy definition, $K_{\\mathrm{alg}} = \\frac{\\Delta p}{\\Delta\\varepsilon_v}$. Therefore, the algorithmic bulk modulus is:\n$$\nK_{\\mathrm{alg}} = K - \\frac{K^2\\alpha\\beta}{3G + K\\alpha\\beta + H\\sqrt{1 + \\frac{2\\beta^2}{9}}}\n$$\nThis expression is in terms of the required parameters $K$, $G$, $\\alpha$, $\\beta$, and $H$.", "answer": "$$\n\\boxed{\nK - \\frac{K^{2} \\alpha \\beta}{3G + K \\alpha \\beta + H \\sqrt{1 + \\frac{2 \\beta^{2}}{9}}}\n}\n$$", "id": "2547037"}, {"introduction": "The ultimate goal of deriving a consistent tangent operator is to implement it correctly within a numerical framework like the Finite Element Method. This capstone exercise bridges the gap between theory and practice by tasking you with creating a numerical verification procedure known as a finite-difference perturbation test [@problem_id:2547062]. By implementing the return-mapping algorithm and its analytical tangent, and then comparing the analytical tangent's action against a numerical derivative, you will develop a crucial skill for debugging and validating user-defined material subroutines (UMATs), ensuring the robustness and quadratic convergence of your nonlinear simulations.", "problem": "Design and implement a self-contained program that constructs a finite-difference perturbation test to numerically verify a coded consistent elastoplastic tangent operator for small-strain, associative, isotropic, rate-independent elastoplasticity with linear isotropic hardening. The goal is to verify that the consistent elastoplastic tangent operator $C^{ep}$ satisfies the directional derivative definition\n$$\nC^{ep}_{ijkl} \\approx \\frac{\\sigma_{ij}(\\varepsilon + \\delta\\,\\Delta\\varepsilon^{(kl)}) - \\sigma_{ij}(\\varepsilon)}{\\delta}\n$$\nto within a prescribed tolerance, for each independent symmetric strain component $(k,l)$, where $\\Delta\\varepsilon^{(kl)}$ is the symmetric perturbation direction that corresponds to a unit perturbation in the $(k,l)$ component of the symmetric strain tensor.\n\nThe material model is posed in three dimensions under the small-strain assumption. Use the following fundamental base and widely accepted facts:\n\n- Kinematics: the infinitesimal strain tensor is $\\varepsilon = \\tfrac{1}{2}(\\nabla u + \\nabla u^{T})$, with trace $\\mathrm{tr}(\\varepsilon)$ and deviatoric part $\\mathrm{dev}(\\varepsilon) = \\varepsilon - \\tfrac{1}{3}\\mathrm{tr}(\\varepsilon)\\,I$, where $I$ is the second-order identity.\n- Isotropic linear elasticity: bulk modulus $K = \\dfrac{E}{3(1-2\\nu)}$, shear modulus $\\mu = \\dfrac{E}{2(1+\\nu)}$, and elastic stiffness in fourth-order notation $C^{e} = K\\,I\\otimes I + 2\\mu\\,I^{\\mathrm{dev}}$, where $I^{\\mathrm{dev}}$ is the fourth-order deviatoric projector.\n- Von Mises type yield function based on the Frobenius norm of the deviatoric stress $s$: define $q = \\|s\\| = \\sqrt{s:s}$ and the yield function $f(s,\\alpha) = q - (\\sigma_{y0} + H\\,\\alpha)$, where $\\sigma_{y0}$ is the initial yield stress and $H$ is the linear isotropic hardening modulus. The internal variable $\\alpha$ is the accumulated plastic strain with increment $\\Delta \\alpha = \\Delta \\gamma$, where $\\Delta \\gamma$ is the plastic multiplier increment.\n- Associative flow rule and standard return-mapping: in an incremental step from an initially stress-free state with $\\alpha_{n} = 0$, form the trial deviatoric stress $s^{\\mathrm{tr}} = 2\\mu\\,\\mathrm{dev}(\\varepsilon)$, its norm $r = \\|s^{\\mathrm{tr}}\\|$, and $c = \\sigma_{y0} + H\\,\\alpha_{n} = \\sigma_{y0}$. If $r \\le c$, the response is elastic. If $r > c$, plastic correction occurs with radial return: define the unit normal $n = s^{\\mathrm{tr}}/r$, the plastic multiplier $\\Delta \\gamma = \\dfrac{r - c}{2\\mu + H}$, and the corrected deviatoric stress $s = s^{\\mathrm{tr}} - 2\\mu\\,\\Delta \\gamma\\,n$. The Cauchy stress is $\\sigma = K\\,\\mathrm{tr}(\\varepsilon)\\,I + s$.\n\nYour task is to:\n\n- Implement a function that, for a given symmetric strain tensor $\\varepsilon$, returns the Cauchy stress tensor $\\sigma(\\varepsilon)$ and the consistent elastoplastic tangent operator $C^{ep}(\\varepsilon)$, obtained by linearizing the above return-mapping equations about the converged stress state.\n- Implement a finite-difference (forward difference) perturbation procedure to approximate each column $C^{ep}_{ij\\,kl}$ by perturbing the symmetric strain tensor in the $(k,l)$ component. The perturbation must preserve symmetry: for $k=l$, set $\\Delta\\varepsilon^{(kk)}_{kk} = \\delta$; for $k\\ne l$, set $\\Delta\\varepsilon^{(kl)}_{kl} = \\Delta\\varepsilon^{(kl)}_{lk} = \\delta/2$, and all other components zero, so that\n$$\n\\frac{\\sigma_{ij}(\\varepsilon + \\delta\\,\\Delta\\varepsilon^{(kl)}) - \\sigma_{ij}(\\varepsilon)}{\\delta} \\approx C^{ep}_{ij\\,kl}.\n$$\n- Quantify the verification by computing, for each test case, the maximum relative Frobenius-norm error across all independent $(k,l)$:\n$$\n\\mathrm{err} = \\max_{k\\le l} \\frac{\\left\\| \\frac{\\sigma(\\varepsilon + \\delta\\,\\Delta\\varepsilon^{(kl)}) - \\sigma(\\varepsilon)}{\\delta} - C^{ep}:\\Delta\\varepsilon^{(kl)} \\right\\|_F}{\\max\\left(\\left\\|C^{ep}:\\Delta\\varepsilon^{(kl)}\\right\\|_F,\\,1\\right)}.\n$$\nDeclare the test case as passing if $\\mathrm{err} \\le \\tau$, where $\\tau$ is the prescribed tolerance for that case.\n\nThe program must implement all fourth-order tensor operations in a basis-invariant manner using standard Kronecker deltas, the symmetric fourth-order identity $I^{\\mathrm{sym}}$, the volumetric projector $I^{\\mathrm{vol}} = \\tfrac{1}{3}I\\otimes I$, and the deviatoric projector $I^{\\mathrm{dev}} = I^{\\mathrm{sym}} - I^{\\mathrm{vol}}$, and must produce a single-line output that aggregates pass/fail booleans for a provided test suite.\n\nUse the following test suite of parameter values, designed to cover a typical elastic state, a plastic state well inside the plastic regime, and a hydrostatic elastic state. All numbers are dimensionless but consistent; the final outputs are booleans, hence unitless.\n\n- Material parameters common to all tests: Young’s modulus $E = 2.1\\times 10^{5}$, Poisson’s ratio $\\nu = 0.3$, initial yield stress $\\sigma_{y0} = 250$, hardening modulus $H = 1000$.\n- Perturbation magnitude for finite differences: $\\delta = 10^{-8}$.\n- Tolerances:\n    - Elastic regime tolerance $\\tau_{\\mathrm{el}} = 10^{-7}$.\n    - Plastic regime tolerance $\\tau_{\\mathrm{pl}} = 10^{-6}$.\n    - Hydrostatic elastic tolerance $\\tau_{\\mathrm{hy}} = 10^{-9}$.\n\n- Test cases (each is a symmetric strain tensor $\\varepsilon$):\n    - Case A (elastic, mixed deviatoric-volumetric): \n      $\n      \\varepsilon =\n      \\begin{bmatrix}\n      1\\times 10^{-5} & 2\\times 10^{-6} & -1\\times 10^{-6} \\\\\n      2\\times 10^{-6} & -5\\times 10^{-6} & 0 \\\\\n      -1\\times 10^{-6} & 0 & 0\n      \\end{bmatrix}\n      $\n      with tolerance $\\tau = \\tau_{\\mathrm{el}}$.\n    - Case B (plastic, well inside plastic regime):\n      $\n      \\varepsilon =\n      \\begin{bmatrix}\n      5\\times 10^{-3} & 2\\times 10^{-3} & -1\\times 10^{-3} \\\\\n      2\\times 10^{-3} & -3\\times 10^{-3} & 5\\times 10^{-4} \\\\\n      -1\\times 10^{-3} & 5\\times 10^{-4} & -2\\times 10^{-3}\n      \\end{bmatrix}\n      $\n      with tolerance $\\tau = \\tau_{\\mathrm{pl}}$.\n    - Case C (pure hydrostatic elastic):\n      $\n      \\varepsilon =\n      \\begin{bmatrix}\n      1\\times 10^{-3} & 0 & 0 \\\\\n      0 & 1\\times 10^{-3} & 0 \\\\\n      0 & 0 & 1\\times 10^{-3}\n      \\end{bmatrix}\n      $\n      with tolerance $\\tau = \\tau_{\\mathrm{hy}}$.\n\nProgram requirements:\n\n- The program must compute, for each test case, the boolean pass/fail result defined by the above error metric and tolerance.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[True,True,False]\") in the order of the test cases A, B, C.\n- No user input is allowed; all data must be embedded in the program.\n\nNote: All mathematical derivations and implementations must respect tensor minor and major symmetries. The perturbation for off-diagonal components must be split as $\\delta/2$ on both symmetric positions to represent a unit perturbation of the single independent component $\\varepsilon_{kl}$ with $k\\ne l$.", "solution": "The task is to design and implement a numerical test to verify the correctness of a coded consistent elastoplastic tangent operator, $C^{ep}$, for a small-strain $J_2$ plasticity model with linear isotropic hardening. The verification is based on the definition of the tangent operator as the directional derivative of the stress tensor $\\sigma$ with respect to the strain tensor $\\varepsilon$, which is approximated using a forward finite-difference scheme.\n\nThe constitutive model is first defined. The total strain $\\varepsilon$ is additively decomposed into an elastic part $\\varepsilon^e$ and a plastic part $\\varepsilon^p$. The model is defined in a rate-independent, incremental form. For a given total strain $\\varepsilon$ (relative to an initial stress-free state), the stress $\\sigma$ and the consistent tangent $C^{ep}$ are determined.\n\nThe fundamental relations are:\n- **Elastic Law**: The stress is related to the elastic strain via Hooke's law for an isotropic material. It is convenient to decompose the stress and strain into volumetric and deviatoric parts. The volumetric part of the stress (pressure $p$) is related to the volumetric strain ($\\mathrm{tr}(\\varepsilon)$) via the bulk modulus $K = \\frac{E}{3(1-2\\nu)}$. The deviatoric stress $s$ is related to the deviatoric elastic strain $\\mathrm{dev}(\\varepsilon^e)$ via the shear modulus $\\mu = \\frac{E}{2(1+\\nu)}$. The total Cauchy stress is $\\sigma = K\\,\\mathrm{tr}(\\varepsilon^e)I + 2\\mu\\,\\mathrm{dev}(\\varepsilon^e)$. Since plastic flow is assumed to be isochoric, $\\mathrm{tr}(\\varepsilon^p)=0$, which implies $\\mathrm{tr}(\\varepsilon^e) = \\mathrm{tr}(\\varepsilon)$. Thus, $\\sigma = K\\,\\mathrm{tr}(\\varepsilon)I + s$, where $s = 2\\mu\\,\\mathrm{dev}(\\varepsilon^e)$.\n\n- **Yield Criterion**: Plastic deformation occurs when the von Mises yield function $f(\\sigma, \\alpha)$ reaches zero. The function is defined as $f(s, \\alpha) = q - (\\sigma_{y0} + H\\alpha)$, where $q = \\|s\\|_F = \\sqrt{s:s}$ is the Frobenius norm of the deviatoric stress, $\\sigma_{y0}$ is the initial yield stress, $H$ is the linear isotropic hardening modulus, and $\\alpha$ is the accumulated plastic strain.\n\n- **Flow Rule and Return Mapping**: The associative flow rule dictates that the increment of plastic strain is normal to the yield surface. For the von Mises criterion, this means the deviatoric stress and the plastic strain rate are coaxial. The state update is performed using a standard radial return mapping algorithm.\n1.  A trial elastic deviatoric stress is computed: $s^{\\mathrm{tr}} = 2\\mu\\,\\mathrm{dev}(\\varepsilon)$.\n2.  The trial yield function is evaluated: $f^{\\mathrm{tr}} = \\|s^{\\mathrm{tr}}\\| - \\sigma_y$, where $\\sigma_y = \\sigma_{y0} + H\\alpha_n$. Since the problem specifies an increment from a virgin state, $\\alpha_n=0$, so $\\sigma_y = \\sigma_{y0}$.\n3.  If $f^{\\mathrm{tr}} \\le 0$, the step is elastic. The state is updated as $s = s^{\\mathrm{tr}}$ and no plastic strain occurs ($\\Delta\\alpha=0$).\n4.  If $f^{\\mathrm{tr}} > 0$, plastic flow occurs. The plastic multiplier increment $\\Delta\\gamma$ is computed as $\\Delta\\gamma = \\frac{f^{\\mathrm{tr}}}{2\\mu + H}$. The deviatoric stress is returned to the yield surface via the radial path: $s = s^{\\mathrm{tr}} - 2\\mu\\Delta\\gamma n$, where $n = s^{\\mathrm{tr}}/\\|s^{\\mathrm{tr}}\\|$ is the unit normal direction. The accumulated plastic strain is updated: $\\alpha = \\alpha_n + \\Delta\\gamma = \\Delta\\gamma$.\n\nThe consistent tangent operator $C^{ep} = \\frac{d\\sigma}{d\\varepsilon}$ is obtained by analytically linearizing this return mapping algorithm. The form of $C^{ep}$ depends on whether the step is elastic or plastic.\n- **Elastic Tangent**: If the state is elastic, the stress is linearly related to the strain, $\\sigma = C^e : \\varepsilon$, where $C^e$ is the fourth-order elastic stiffness tensor. The tangent operator is simply $C^{ep} = C^e = K(I \\otimes I) + 2\\mu I^{\\mathrm{dev}}$. Here, $I$ is the second-order identity, $I \\otimes I$ is the volumetric projection operator (scaled by $1/3$), and $I^{\\mathrm{dev}} = I^{\\mathrm{sym}} - \\frac{1}{3}I \\otimes I$ is the deviatoric projection operator, with $I^{\\mathrm{sym}}_{ijkl} = \\frac{1}{2}(\\delta_{ik}\\delta_{jl} + \\delta_{il}\\delta_{jk})$.\n\n- **Elastoplastic Tangent**: If the state is plastic, the linearization of the radial return algorithm yields the consistent tangent. The derivation involves applying the chain rule to all variables in the return mapping equations. The resulting operator is:\n$$ C^{ep} = K(I \\otimes I) + 2\\mu(1-\\beta)I^{\\mathrm{dev}} - 2\\mu\\gamma_c(n \\otimes n) $$\nwhere $r = \\|s^{\\mathrm{tr}}\\|$, $n=s^{\\mathrm{tr}}/r$, and the coefficients $\\beta$ and $\\gamma_c$ are given by:\n$$ \\beta = \\frac{2\\mu\\Delta\\gamma}{r} $$\n$$ \\gamma_c = \\frac{2\\mu}{2\\mu+H} - \\beta $$\nThis form ensures quadratic convergence in Newton-Raphson solvers for which it is designed.\n\nThe numerical verification, or perturbation test, is structured as follows:\n1.  For a given strain tensor $\\varepsilon$, compute the baseline stress $\\sigma(\\varepsilon)$ and the analytical tangent operator $C^{ep}(\\varepsilon)$ using the material model logic described above.\n2.  Define a set of six linearly independent, symmetric perturbation direction tensors, $\\{V^{(p)}\\}_{p=1}^6$. These directions correspond to unit perturbations in the independent components of the strain tensor within a Voigt notation framework. For example, a perturbation in $\\varepsilon_{11}$ corresponds to $V^{(1)}$ with a $1$ in the $(1,1)$ component. A perturbation in $\\varepsilon_{12}$ corresponds to $V^{(4)}$ with a $0.5$ in both the $(1,2)$ and $(2,1)$ components.\n3.  For each perturbation direction $V^{(p)}$, perform the following:\n    a.  Compute a perturbed strain $\\varepsilon' = \\varepsilon + \\delta V^{(p)}$, where $\\delta$ is a small number (e.g., $10^{-8}$).\n    b.  Compute the stress at the perturbed state, $\\sigma' = \\sigma(\\varepsilon')$, by re-running the full material model.\n    c.  Calculate the numerical approximation of the directional derivative: $D_{\\mathrm{num}}^{(p)} = \\frac{\\sigma' - \\sigma}{\\delta}$.\n    d.  Calculate the analytical directional derivative using the consistent tangent: $D_{\\mathrm{ana}}^{(p)} = C^{ep} : V^{(p)}$.\n    e.  Compute the relative error between the numerical and analytical results:\n        $$ \\mathrm{err}^{(p)} = \\frac{\\|D_{\\mathrm{num}}^{(p)} - D_{\\mathrm{ana}}^{(p)}\\|_F}{\\max(\\|D_{\\mathrm{ana}}^{(p)}\\|_F, 1.0)} $$\n        The floor of $1.0$ in the denominator prevents division by zero and provides a measure of absolute error when the analytical derivative is small.\n4.  The overall error for the test case is the maximum error found across all six perturbation directions, $\\mathrm{err} = \\max_{p} \\mathrm{err}^{(p)}$.\n5.  This error is compared against a prescribed tolerance, $\\tau$. The test passes if $\\mathrm{err} \\le \\tau$.\n\nThe implementation uses `numpy` for all tensor representations and operations. Second-order tensors are represented as $3 \\times 3$ arrays, and fourth-order tensors as $3 \\times 3 \\times 3 \\times 3$ arrays. Tensor contractions (dot products, outer products) are elegantly handled using `numpy.einsum`. The program iterates through the provided test cases, each with a specific strain tensor and tolerance, and reports a boolean pass/fail result for each.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the finite-difference perturbation test for the\n    consistent elastoplastic tangent operator.\n    \"\"\"\n    \n    # Material parameters (common to all tests)\n    E = 2.1e5\n    NU = 0.3\n    SIGMA_Y0 = 250.0\n    H = 1000.0\n    \n    # Numerical parameters\n    DELTA = 1e-8\n    \n    # Test cases: (strain_tensor, tolerance)\n    TOL_EL = 1e-7\n    TOL_PL = 1e-6\n    TOL_HY = 1e-9\n    \n    test_cases = [\n        (np.array([\n            [1e-5, 2e-6, -1e-6],\n            [2e-6, -5e-6, 0.0],\n            [-1e-6, 0.0, 0.0]\n        ]), TOL_EL, \"Elastic\"),\n        (np.array([\n            [5e-3, 2e-3, -1e-3],\n            [2e-3, -3e-3, 5e-4],\n            [-1e-3, 5e-4, -2e-3]\n        ]), TOL_PL, \"Plastic\"),\n        (np.array([\n            [1e-3, 0.0, 0.0],\n            [0.0, 1e-3, 0.0],\n            [0.0, 0.0, 1e-3]\n        ]), TOL_HY, \"Hydrostatic Elastic\"),\n    ]\n\n    # Pre-compute derived material properties and constant tensors\n    K_bulk = E / (3.0 * (1.0 - 2.0 * NU))\n    MU_shear = E / (2.0 * (1.0 + NU))\n\n    I = np.eye(3)\n    # Note: np.einsum is used for basis-agnostic tensor algebra\n    I_dyad_I = np.einsum('ij,kl->ijkl', I, I)\n    \n    # Symmetric fourth-order identity tensor I_sym\n    delta = np.eye(3)\n    I_sym = 0.5 * (np.einsum('ik,jl', delta, delta) + np.einsum('il,jk', delta, delta))\n    \n    # Deviatoric projection tensor\n    I_dev = I_sym - (1.0/3.0) * I_dyad_I\n\n    def get_stress_and_tangent(epsilon):\n        \"\"\"\n        Computes Cauchy stress and consistent tangent for small-strain J2 plasticity.\n        \"\"\"\n        tr_eps = np.trace(epsilon)\n        dev_eps = epsilon - (tr_eps / 3.0) * I\n        \n        s_tr = 2.0 * MU_shear * dev_eps\n        r_tr = np.linalg.norm(s_tr)\n        \n        # Machine precision epsilon for safe division\n        machine_eps = 1e-12 \n\n        # Yield condition check\n        yield_check = r_tr - SIGMA_Y0\n        \n        if yield_check <= 0.0 or r_tr < machine_eps:\n            # Elastic case\n            sigma = K_bulk * tr_eps * I + s_tr\n            C_ep = K_bulk * I_dyad_I + 2.0 * MU_shear * I_dev\n        else:\n            # Plastic case (radial return)\n            n_dir = s_tr / r_tr\n            delta_gamma = yield_check / (2.0 * MU_shear + H)\n            \n            s = s_tr - 2.0 * MU_shear * delta_gamma * n_dir\n            sigma = K_bulk * tr_eps * I + s\n            \n            # Consistent elastoplastic tangent\n            beta = 2.0 * MU_shear * delta_gamma / r_tr\n            gamma_c = (2.0 * MU_shear / (2.0 * MU_shear + H)) - beta\n            \n            n_dyad_n = np.einsum('ij,kl->ijkl', n_dir, n_dir)\n            \n            C_ep = (K_bulk * I_dyad_I + \n                    2.0 * MU_shear * (1.0 - beta) * I_dev - \n                    2.0 * MU_shear * gamma_c * n_dyad_n)\n            \n        return sigma, C_ep\n\n    # Perturbation directions corresponding to Voigt basis\n    perturb_dirs = []\n    # Diagonal components\n    for i in range(3):\n        v = np.zeros((3, 3))\n        v[i, i] = 1.0\n        perturb_dirs.append(v)\n    # Off-diagonal components\n    for i, j in [(0, 1), (0, 2), (1, 2)]:\n        v = np.zeros((3, 3))\n        v[i, j] = 0.5\n        v[j, i] = 0.5\n        perturb_dirs.append(v)\n\n    results = []\n    for epsilon_base, tolerance, _ in test_cases:\n        sigma_base, C_ep_base = get_stress_and_tangent(epsilon_base)\n        \n        max_err = 0.0\n        for v_dir in perturb_dirs:\n            # Perturb strain\n            epsilon_pert = epsilon_base + DELTA * v_dir\n            \n            # Get perturbed stress\n            sigma_pert, _ = get_stress_and_tangent(epsilon_pert)\n            \n            # Numerical directional derivative (Forward Difference)\n            D_num = (sigma_pert - sigma_base) / DELTA\n            \n            # Analytical directional derivative\n            D_ana = np.einsum('ijkl,kl->ij', C_ep_base, v_dir)\n            \n            # Error calculation\n            numerator = np.linalg.norm(D_num - D_ana)\n            denominator = max(np.linalg.norm(D_ana), 1.0)\n            \n            err = numerator / denominator\n            if err > max_err:\n                max_err = err\n        \n        results.append(max_err <= tolerance)\n        \n    print(f\"[{','.join(map(str, [r for r in results]))}]\")\n\nsolve()\n```", "id": "2547062"}]}