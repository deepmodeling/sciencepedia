{"hands_on_practices": [{"introduction": "The power of modal superposition lies in decomposing a complex, coupled system into a set of simple, independent oscillators. Before we can apply this technique to large-scale problems, it is essential to build a solid intuition for the fundamental building blocks: the natural frequencies and mode shapes. This first practice takes you back to basics, guiding you through the manual solution of the generalized eigenvalue problem for a simple two-degree-of-freedom system [@problem_id:2578908]. By working through the calculations, you will gain a concrete physical understanding of how a system's mass and stiffness properties dictate its inherent patterns of motion.", "problem": "Consider a linear, undamped, two-degree-of-freedom (DOF) mechanical system modeled within the finite element method (FEM) framework. Let the generalized coordinates be the nodal displacements $q_{1}(t)$ and $q_{2}(t)$, collected in the vector $\\mathbf{q}(t) = \\begin{pmatrix} q_{1}(t) \\\\ q_{2}(t) \\end{pmatrix}$. The equations of motion follow from Newtonâ€™s second law applied in generalized coordinates. The symmetric, positive-definite mass and stiffness matrices are given by\n$$\n\\mathbf{M} = \\begin{pmatrix} 3 & 1 \\\\ 1 & 2 \\end{pmatrix} \\ \\text{kg}, \n\\qquad\n\\mathbf{K} = \\begin{pmatrix} 5000 & -1500 \\\\ -1500 & 2500 \\end{pmatrix} \\ \\text{N/m}.\n$$\nStarting from first principles, formulate the governing equations for free vibration of this system and derive the associated generalized eigenvalue problem that determines the undamped natural circular frequencies and their mode shapes. Then, explicitly solve that eigenvalue problem for this $2$-DOF system to obtain both natural frequencies and their corresponding mass-normalized mode shapes. Provide a physical interpretation of the deformation patterns, identifying which mode is predominantly in-phase and which is out-of-phase, and explain how the coupling terms influence these patterns.\n\nAnswer specification: Report as your final answer only the lower natural circular frequency. Express it in radians per second and round your answer to four significant figures.", "solution": "The user has presented a problem in linear structural dynamics. The first mandatory step is a critical validation of the problem statement.\n\n### Step 1: Extract Givens\nThe problem statement provides the following information verbatim:\n- System type: linear, undamped, two-degree-of-freedom ($2$-DOF).\n- Modeling framework: finite element method (FEM).\n- Generalized coordinates vector: $\\mathbf{q}(t) = \\begin{pmatrix} q_{1}(t) \\\\ q_{2}(t) \\end{pmatrix}$.\n- Mass matrix: $\\mathbf{M} = \\begin{pmatrix} 3 & 1 \\\\ 1 & 2 \\end{pmatrix} \\ \\text{kg}$. It is stated to be symmetric and positive-definite.\n- Stiffness matrix: $\\mathbf{K} = \\begin{pmatrix} 5000 & -1500 \\\\ -1500 & 2500 \\end{pmatrix} \\ \\text{N/m}$. It is stated to be symmetric.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the required criteria.\n1.  **Scientific Grounding**: The problem is rooted in classical mechanics, specifically the theory of small oscillations of a conservative system, a fundamental topic in physics and engineering. The governing equation $\\mathbf{M}\\ddot{\\mathbf{q}} + \\mathbf{K}\\mathbf{q} = \\mathbf{0}$ is a standard representation. The matrices must be checked for the stated properties.\n    - The mass matrix $\\mathbf{M}$ is symmetric. Its principal minors are $\\det(3) = 3 > 0$ and $\\det(\\mathbf{M}) = (3)(2) - (1)(1) = 5 > 0$. Therefore, $\\mathbf{M}$ is positive-definite.\n    - The stiffness matrix $\\mathbf{K}$ is symmetric. Its principal minors are $\\det(5000) = 5000 > 0$ and $\\det(\\mathbf{K}) = (5000)(2500) - (-1500)^2 = 12,500,000 - 2,250,000 = 10,250,000 > 0$. Therefore, $\\mathbf{K}$ is also positive-definite.\n    The properties of the matrices are consistent with physical reality for a stable, passive mechanical system. The problem is scientifically sound.\n2.  **Well-Posedness**: For a system with symmetric, positive-definite mass ($\\mathbf{M}$) and stiffness ($\\mathbf{K}$) matrices, the theory of linear algebra and mechanical vibrations guarantees the existence of a set of real, positive natural frequencies and a corresponding set of M-orthogonal mode shapes. A unique solution exists. The problem is well-posed.\n3.  **Objectivity**: The problem is stated using precise, standard terminology from mechanical engineering. It is free of ambiguity and subjective claims.\n4.  **Completeness and Consistency**: All necessary data ($\\mathbf{M}$ and $\\mathbf{K}$ matrices) for determining the natural frequencies and mode shapes are provided. The units are physically consistent. The problem is self-contained.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, objective, and complete. It is a standard, valid problem in structural dynamics. A solution will be provided.\n\n---\n\nThe governing equation for free, undamped vibration of a linear system is given by Lagrange's equations, which for this context take the form of Newton's second law in matrix form:\n$$\n\\mathbf{M}\\ddot{\\mathbf{q}}(t) + \\mathbf{K}\\mathbf{q}(t) = \\mathbf{0}\n$$\nwhere $\\mathbf{M}$ is the mass matrix, $\\mathbf{K}$ is the stiffness matrix, and $\\mathbf{q}(t)$ is the vector of generalized displacements.\n\nTo find the natural frequencies and mode shapes, we assume a synchronous harmonic motion of the form:\n$$\n\\mathbf{q}(t) = \\mathbf{\\phi} e^{i\\omega t}\n$$\nwhere $\\mathbf{\\phi}$ is the time-independent mode shape vector (amplitude vector), $\\omega$ is the natural circular frequency, and $i = \\sqrt{-1}$. Differentiating this assumed solution with respect to time twice gives:\n$$\n\\ddot{\\mathbf{q}}(t) = -\\omega^2 \\mathbf{\\phi} e^{i\\omega t}\n$$\nSubstituting the assumed solution and its second derivative into the equation of motion yields:\n$$\n-\\mathbf{M}\\omega^2 \\mathbf{\\phi} e^{i\\omega t} + \\mathbf{K} \\mathbf{\\phi} e^{i\\omega t} = \\mathbf{0}\n$$\nSince the term $e^{i\\omega t}$ is never zero, we can divide the equation by it, which leads to the generalized eigenvalue problem:\n$$\n(\\mathbf{K} - \\omega^2 \\mathbf{M}) \\mathbf{\\phi} = \\mathbf{0}\n$$\nFor a non-trivial solution where the mode shape $\\mathbf{\\phi}$ is not the zero vector, the determinant of the coefficient matrix must be zero:\n$$\n\\det(\\mathbf{K} - \\omega^2 \\mathbf{M}) = 0\n$$\nLet $\\lambda = \\omega^2$. The equation becomes the characteristic equation in terms of $\\lambda$:\n$$\n\\det(\\mathbf{K} - \\lambda \\mathbf{M}) = 0\n$$\nSubstituting the given matrices $\\mathbf{M}$ and $\\mathbf{K}$:\n$$\n\\det\\left(\\begin{pmatrix} 5000 & -1500 \\\\ -1500 & 2500 \\end{pmatrix} - \\lambda \\begin{pmatrix} 3 & 1 \\\\ 1 & 2 \\end{pmatrix}\\right) = 0\n$$\n$$\n\\det\\begin{pmatrix} 5000 - 3\\lambda & -1500 - \\lambda \\\\ -1500 - \\lambda & 2500 - 2\\lambda \\end{pmatrix} = 0\n$$\nEvaluating the determinant gives the characteristic polynomial:\n$$\n(5000 - 3\\lambda)(2500 - 2\\lambda) - (-1500 - \\lambda)^2 = 0\n$$\n$$\n(12,500,000 - 10,000\\lambda - 7,500\\lambda + 6\\lambda^2) - (2,250,000 + 3,000\\lambda + \\lambda^2) = 0\n$$\n$$\n6\\lambda^2 - 17,500\\lambda + 12,500,000 - \\lambda^2 - 3,000\\lambda - 2,250,000 = 0\n$$\nCombining like terms results in a quadratic equation for $\\lambda$:\n$$\n5\\lambda^2 - 20,500\\lambda + 10,250,000 = 0\n$$\nDividing by $5$ simplifies the equation:\n$$\n\\lambda^2 - 4100\\lambda + 2,050,000 = 0\n$$\nWe solve this quadratic equation for the eigenvalues $\\lambda_1$ and $\\lambda_2$ using the quadratic formula, $\\lambda = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$:\n$$\n\\lambda = \\frac{4100 \\pm \\sqrt{(-4100)^2 - 4(1)(2,050,000)}}{2} = \\frac{4100 \\pm \\sqrt{16,810,000 - 8,200,000}}{2}\n$$\n$$\n\\lambda = \\frac{4100 \\pm \\sqrt{8,610,000}}{2}\n$$\nThe two eigenvalues are:\n$$\n\\lambda_1 = \\frac{4100 - \\sqrt{8,610,000}}{2} \\approx \\frac{4100 - 2934.28}{2} \\approx 582.86 \\, (\\text{rad/s})^2\n$$\n$$\n\\lambda_2 = \\frac{4100 + \\sqrt{8,610,000}}{2} \\approx \\frac{4100 + 2934.28}{2} \\approx 3517.14 \\, (\\text{rad/s})^2\n$$\nThe natural circular frequencies are the square roots of the eigenvalues, $\\omega = \\sqrt{\\lambda}$.\nThe lower natural frequency is:\n$$\n\\omega_1 = \\sqrt{\\lambda_1} = \\sqrt{\\frac{4100 - \\sqrt{8,610,000}}{2}} \\approx 24.142 \\, \\text{rad/s}\n$$\nThe higher natural frequency is:\n$$\n\\omega_2 = \\sqrt{\\lambda_2} = \\sqrt{\\frac{4100 + \\sqrt{8,610,000}}{2}} \\approx 59.305 \\, \\text{rad/s}\n$$\nNext, we find the corresponding eigenvectors (mode shapes) $\\mathbf{\\phi}_i$ by solving $(\\mathbf{K} - \\lambda_i \\mathbf{M})\\mathbf{\\phi}_i = \\mathbf{0}$ for each eigenvalue.\nFor $\\lambda_1 \\approx 582.86$, the system is:\n$$\n\\begin{pmatrix} 5000 - 3(\\lambda_1) & -1500 - \\lambda_1 \\\\ -1500 - \\lambda_1 & 2500 - 2(\\lambda_1) \\end{pmatrix} \\begin{pmatrix} \\phi_{11} \\\\ \\phi_{21} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nUsing the first row: $(5000 - 3(582.86))\\phi_{11} - (1500 + 582.86)\\phi_{21} = 0$, which simplifies to $3251.42\\phi_{11} - 2082.86\\phi_{21} = 0$. The ratio of the components is $\\frac{\\phi_{21}}{\\phi_{11}} = \\frac{3251.42}{2082.86} \\approx 1.561$. The first mode shape is $\\mathbf{\\phi}_1 \\propto \\begin{pmatrix} 1 \\\\ 1.561 \\end{pmatrix}$.\n\nFor $\\lambda_2 \\approx 3517.14$, the system is:\n$$\n\\begin{pmatrix} 5000 - 3(\\lambda_2) & -1500 - \\lambda_2 \\\\ -1500 - \\lambda_2 & 2500 - 2(\\lambda_2) \\end{pmatrix} \\begin{pmatrix} \\phi_{12} \\\\ \\phi_{22} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nUsing the first row: $(5000 - 3(3517.14))\\phi_{12} - (1500 + 3517.14)\\phi_{22} = 0$, which gives $-5551.42\\phi_{12} - 5017.14\\phi_{22} = 0$. The ratio is $\\frac{\\phi_{22}}{\\phi_{12}} = -\\frac{5551.42}{5017.14} \\approx -1.106$. The second mode shape is $\\mathbf{\\phi}_2 \\propto \\begin{pmatrix} 1 \\\\ -1.106 \\end{pmatrix}$.\n\nTo obtain the mass-normalized mode shapes, $\\mathbf{\\hat{\\phi}}_i$, we enforce the condition $\\mathbf{\\hat{\\phi}}_i^T \\mathbf{M} \\mathbf{\\hat{\\phi}}_i = 1$. Let $\\mathbf{\\hat{\\phi}}_i = c_i \\mathbf{\\phi}_i$. Then $c_i = (\\mathbf{\\phi}_i^T \\mathbf{M} \\mathbf{\\phi}_i)^{-1/2}$.\nFor $\\mathbf{\\phi}_1 = \\begin{pmatrix} 1 \\\\ 1.561 \\end{pmatrix}$: $c_1 = (3(1)^2 + 2(1)(1)(1.561) + 2(1.561)^2)^{-1/2} \\approx 0.3016$.\n$\\mathbf{\\hat{\\phi}}_1 \\approx \\begin{pmatrix} 0.3016 \\\\ 0.4708 \\end{pmatrix}$.\nFor $\\mathbf{\\phi}_2 = \\begin{pmatrix} 1 \\\\ -1.106 \\end{pmatrix}$: $c_2 = (3(1)^2 + 2(1)(1)(-1.106) + 2(-1.106)^2)^{-1/2} \\approx 0.5560$.\n$\\mathbf{\\hat{\\phi}}_2 \\approx \\begin{pmatrix} 0.5560 \\\\ -0.6150 \\end{pmatrix}$.\n\n**Physical Interpretation:**\n1.  **First Mode (Lower Frequency, $\\omega_1 \\approx 24.14$ rad/s):** The mode shape $\\mathbf{\\hat{\\phi}}_1$ has components with the same sign. This means both degrees of freedom $q_1$ and $q_2$ move in the same direction at all times. This is the **in-phase** mode. The ratio of amplitudes shows that the second coordinate moves approximately $1.561$ times as much as the first. This mode represents a collective, lower-energy motion.\n2.  **Second Mode (Higher Frequency, $\\omega_2 \\approx 59.31$ rad/s):** The mode shape $\\mathbf{\\hat{\\phi}}_2$ has components with opposite signs. This means $q_1$ and $q_2$ move in opposite directions at all times. This is the **out-of-phase** mode. It represents a higher-energy, differential motion where components move against each other.\n\n**Influence of Coupling:** The off-diagonal terms $m_{12}=1$ and $k_{12}=-1500$ represent inertial and elastic coupling, respectively. Without these terms, the system would decouple into two independent $1$-DOF oscillators. The coupling serves two main functions:\n- It mixes the motions, ensuring that neither mode involves the movement of only one coordinate. The modes are combinations of the \"pure\" single-coordinate motions.\n- It \"splits\" the natural frequencies. An uncoupled system would have frequencies of $\\sqrt{k_{11}/m_{11}} \\approx 40.8$ rad/s and $\\sqrt{k_{22}/m_{22}} \\approx 35.4$ rad/s. The coupling forces one frequency lower (the in-phase mode, $\\omega_1$) and the other higher (the out-of-phase mode, $\\omega_2$) than the uncoupled frequencies. This is a general phenomenon in coupled oscillator systems.\n\nThe problem asks for the lower natural circular frequency, $\\omega_1$, rounded to four significant figures.\n$$\n\\omega_1 = \\sqrt{\\frac{4100 - \\sqrt{8,610,000}}{2}} \\approx 24.14249 \\, \\text{rad/s}\n$$\nRounding to $4$ significant figures gives $24.14$.", "answer": "$$\n\\boxed{24.14}\n$$", "id": "2578908"}, {"introduction": "For any realistic engineering structure, using the complete set of all possible modes is computationally infeasible. We must truncate the modal series and use only a small subset, typically the lowest-frequency modes. This practice explores the theoretical consequences of this essential approximation [@problem_id:2578769]. Through a first-principles derivation, you will discover that a truncated modal solution can fail to correctly represent the system's static response to a load, leading to an un-equilibrated 'residual' force. Understanding this concept is the critical first step toward correcting for truncation errors and creating highly accurate reduced-order models.", "problem": "Consider the semi-discrete equations of motion obtained from the finite element method for a linear, time-invariant, multi-degree-of-freedom structure with $n$ degrees of freedom:\n$$\n\\boldsymbol{M}\\,\\ddot{\\boldsymbol{x}}(t)+\\boldsymbol{C}\\,\\dot{\\boldsymbol{x}}(t)+\\boldsymbol{K}\\,\\boldsymbol{x}(t)=\\boldsymbol{f}_0\\,H(t),\n$$\nwhere $\\boldsymbol{M}\\in\\mathbb{R}^{n\\times n}$ and $\\boldsymbol{K}\\in\\mathbb{R}^{n\\times n}$ are symmetric positive-definite mass and stiffness matrices, $\\boldsymbol{C}\\in\\mathbb{R}^{n\\times n}$ is a viscous damping matrix, $\\boldsymbol{f}_0\\in\\mathbb{R}^{n}$ is a constant load vector, and $H(t)$ is the Heaviside unit step function. Assume zero initial conditions $\\boldsymbol{x}(0)=\\boldsymbol{0}$ and $\\dot{\\boldsymbol{x}}(0)=\\boldsymbol{0}$. Let the generalized eigenproblem\n$$\n\\boldsymbol{K}\\,\\boldsymbol{\\phi}_r=\\omega_r^{2}\\,\\boldsymbol{M}\\,\\boldsymbol{\\phi}_r,\\quad r=1,\\dots,n,\n$$\nadmit a complete set of real eigenpairs with mass-normalized eigenvectors $\\boldsymbol{\\phi}_r$ collected in the modal matrix $\\boldsymbol{\\Phi}=\\begin{bmatrix}\\boldsymbol{\\phi}_1 & \\cdots & \\boldsymbol{\\phi}_n\\end{bmatrix}$ satisfying $\\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{M}\\boldsymbol{\\Phi}=\\boldsymbol{I}$ and natural circular frequencies $\\omega_r>0$.\n\nStarting only from these fundamental definitions and properties, and without invoking any pre-packaged modal superposition formulae, derive the exact contribution of each mode to the final static displacement $\\boldsymbol{x}_{\\infty}=\\lim_{t\\to\\infty}\\boldsymbol{x}(t)$ produced by the step load. In particular:\n\n1. Derive the closed-form expression for the modal contribution vector of the $r$-th mode to $\\boldsymbol{x}_{\\infty}$ in terms of $\\boldsymbol{\\phi}_r$, $\\omega_r$, and $\\boldsymbol{f}_0$.\n\n2. Using operator identities justified by the generalized eigenstructure, explain why truncating the expansion to the first $m<n$ modes generally fails to satisfy static equilibrium for a generic $\\boldsymbol{f}_0$, and identify the associated residual load vector that motivates a static correction when using a truncated modal basis.\n\nProvide your final answer as a single analytic expression for the contribution of the $r$-th mode requested in item $1$. No numerical evaluation is required, and no units are to be reported.", "solution": "The problem statement is subjected to validation and is found to be valid. It is scientifically grounded in the principles of linear structural dynamics, well-posed, and expressed in objective, formal language. It contains no inconsistencies, and all necessary information for the derivation is provided. We may proceed with the solution.\n\nThe problem asks for a derivation of two related results concerning the static response of a linear system under a step load, based on modal analysis.\n\nFirst, we derive the contribution of the $r$-th mode to the final static displacement, $\\boldsymbol{x}_{\\infty}$. The governing equation of motion is given by:\n$$\n\\boldsymbol{M}\\,\\ddot{\\boldsymbol{x}}(t)+\\boldsymbol{C}\\,\\dot{\\boldsymbol{x}}(t)+\\boldsymbol{K}\\,\\boldsymbol{x}(t)=\\boldsymbol{f}_0\\,H(t)\n$$\nThe final static displacement, $\\boldsymbol{x}_{\\infty}$, is the limit of the displacement as $t \\to \\infty$. For a stable system subjected to a constant load, the velocity and acceleration must vanish at equilibrium. Thus, $\\lim_{t\\to\\infty} \\dot{\\boldsymbol{x}}(t) = \\boldsymbol{0}$ and $\\lim_{t\\to\\infty} \\ddot{\\boldsymbol{x}}(t) = \\boldsymbol{0}$. For $t>0$, the Heaviside function $H(t)=1$. The equation of motion reduces to the static equilibrium equation:\n$$\n\\boldsymbol{K}\\,\\boldsymbol{x}_{\\infty} = \\boldsymbol{f}_0\n$$\nSince the stiffness matrix $\\boldsymbol{K}$ is given as positive-definite, it is invertible, and the exact static displacement is uniquely determined as $\\boldsymbol{x}_{\\infty} = \\boldsymbol{K}^{-1}\\boldsymbol{f}_0$.\n\nTo find the contribution of each mode to this result, we use the modal coordinate transformation. The displacement vector $\\boldsymbol{x}(t)$ is expressed as a linear combination of the mass-normalized eigenvectors $\\boldsymbol{\\phi}_r$:\n$$\n\\boldsymbol{x}(t) = \\sum_{r=1}^{n} \\boldsymbol{\\phi}_r q_r(t) = \\boldsymbol{\\Phi}\\boldsymbol{q}(t)\n$$\nwhere $q_r(t)$ are the modal coordinates. Substituting this expansion into the full dynamic equation and pre-multiplying by the transpose of the modal matrix, $\\boldsymbol{\\Phi}^{\\mathsf{T}}$, we obtain:\n$$\n\\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{M}\\boldsymbol{\\Phi}\\,\\ddot{\\boldsymbol{q}}(t) + \\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{C}\\boldsymbol{\\Phi}\\,\\dot{\\boldsymbol{q}}(t) + \\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{K}\\boldsymbol{\\Phi}\\,\\boldsymbol{q}(t) = \\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{f}_0\\,H(t)\n$$\nUsing the mass-orthonormality property, $\\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{M}\\boldsymbol{\\Phi}=\\boldsymbol{I}$. From the generalized eigenproblem $\\boldsymbol{K}\\boldsymbol{\\phi}_r = \\omega_r^2 \\boldsymbol{M}\\boldsymbol{\\phi}_r$, we can write $\\boldsymbol{K}\\boldsymbol{\\Phi} = \\boldsymbol{M}\\boldsymbol{\\Phi}\\boldsymbol{\\Omega}^2$, where $\\boldsymbol{\\Omega}^2$ is the diagonal matrix of squared natural frequencies, $\\boldsymbol{\\Omega}^2 = \\text{diag}(\\omega_1^2, \\dots, \\omega_n^2)$. Pre-multiplying by $\\boldsymbol{\\Phi}^{\\mathsf{T}}$ gives $\\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{K}\\boldsymbol{\\Phi} = \\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{M}\\boldsymbol{\\Phi}\\boldsymbol{\\Omega}^2 = \\boldsymbol{I}\\boldsymbol{\\Omega}^2 = \\boldsymbol{\\Omega}^2$. The system of equations in modal coordinates is:\n$$\n\\boldsymbol{I}\\,\\ddot{\\boldsymbol{q}}(t) + \\boldsymbol{C}_{\\text{modal}}\\,\\dot{\\boldsymbol{q}}(t) + \\boldsymbol{\\Omega}^2\\,\\boldsymbol{q}(t) = \\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{f}_0\\,H(t)\n$$\nwhere $\\boldsymbol{C}_{\\text{modal}} = \\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{C}\\boldsymbol{\\Phi}$. In the static limit as $t \\to \\infty$, the time derivatives $\\ddot{\\boldsymbol{q}}(t)$ and $\\dot{\\boldsymbol{q}}(t)$ vanish. The $r$-th modal equation becomes:\n$$\n\\omega_r^2 q_{r, \\infty} = \\boldsymbol{\\phi}_r^{\\mathsf{T}}\\boldsymbol{f}_0\n$$\nwhere $q_{r, \\infty} = \\lim_{t\\to\\infty} q_r(t)$. Since $\\boldsymbol{K}$ is positive-definite, all $\\omega_r^2 > 0$, so we can solve for the static modal coordinate:\n$$\nq_{r, \\infty} = \\frac{\\boldsymbol{\\phi}_r^{\\mathsf{T}}\\boldsymbol{f}_0}{\\omega_r^2}\n$$\nThe total static displacement is the sum of the contributions from all modes: $\\boldsymbol{x}_{\\infty} = \\sum_{r=1}^{n} \\boldsymbol{\\phi}_r q_{r, \\infty}$. The contribution of the $r$-th mode to this final static displacement vector, denoted $\\boldsymbol{x}_{r, \\infty}$, is therefore:\n$$\n\\boldsymbol{x}_{r, \\infty} = \\boldsymbol{\\phi}_r q_{r, \\infty} = \\boldsymbol{\\phi}_r \\left( \\frac{\\boldsymbol{\\phi}_r^{\\mathsf{T}}\\boldsymbol{f}_0}{\\omega_r^2} \\right) = \\frac{\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\boldsymbol{f}_0}{\\omega_r^2}\n$$\nThis completes the first part of the problem.\n\nSecond, we analyze the effect of truncating the modal series. If the expansion is truncated to the first $m < n$ modes, the approximated static displacement is:\n$$\n\\boldsymbol{x}_{\\infty}^{(m)} = \\sum_{r=1}^{m} \\boldsymbol{x}_{r, \\infty} = \\sum_{r=1}^{m} \\frac{\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\boldsymbol{f}_0}{\\omega_r^2}\n$$\nTo assess whether this truncated solution satisfies static equilibrium, we compute the corresponding internal restoring force, $\\boldsymbol{K}\\boldsymbol{x}_{\\infty}^{(m)}$:\n$$\n\\boldsymbol{K}\\boldsymbol{x}_{\\infty}^{(m)} = \\boldsymbol{K} \\left( \\sum_{r=1}^{m} \\frac{\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}}}{\\omega_r^2} \\right) \\boldsymbol{f}_0 = \\left( \\sum_{r=1}^{m} \\frac{\\boldsymbol{K}\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}}}{\\omega_r^2} \\right) \\boldsymbol{f}_0\n$$\nSubstituting the eigenproblem relation $\\boldsymbol{K}\\boldsymbol{\\phi}_r = \\omega_r^2 \\boldsymbol{M}\\boldsymbol{\\phi}_r$:\n$$\n\\boldsymbol{K}\\boldsymbol{x}_{\\infty}^{(m)} = \\left( \\sum_{r=1}^{m} \\frac{\\omega_r^2 \\boldsymbol{M}\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}}}{\\omega_r^2} \\right) \\boldsymbol{f}_0 = \\left( \\sum_{r=1}^{m} \\boldsymbol{M}\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\right) \\boldsymbol{f}_0\n$$\nFor static equilibrium to be satisfied, this internal force must balance the external applied load, $\\boldsymbol{f}_0$. The operator identity required here is the expansion of the identity matrix in terms of the mass-weighted projectors. Since $\\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{M}\\boldsymbol{\\Phi}=\\boldsymbol{I}$, it follows that $\\boldsymbol{\\Phi}^{-1} = \\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{M}$ (as $\\boldsymbol{\\Phi}$ is a square matrix), and therefore $\\boldsymbol{I} = \\boldsymbol{\\Phi}\\boldsymbol{\\Phi}^{-1} = \\boldsymbol{\\Phi}(\\boldsymbol{\\Phi}^{\\mathsf{T}}\\boldsymbol{M}) = \\sum_{r=1}^{n} \\boldsymbol{\\phi}_r\\boldsymbol{\\phi}_r^{\\mathsf{T}}\\boldsymbol{M}$. Applying this identity allows rewriting an arbitrary vector, here $\\boldsymbol{M}^{-1}\\boldsymbol{f}_0$, as $\\boldsymbol{M}^{-1}\\boldsymbol{f}_0 = \\sum_{r=1}^n \\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\boldsymbol{f}_0$, which after multiplying by $\\boldsymbol{M}$ gives the identity used implicitly before: $\\boldsymbol{f}_0 = \\sum_{r=1}^n \\boldsymbol{M}\\boldsymbol{\\phi}_r\\boldsymbol{\\phi}_r^{\\mathsf{T}}\\boldsymbol{f}_0$.\nThe restoring force from the truncated series is only a partial sum, $\\sum_{r=1}^{m} \\boldsymbol{M}\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\boldsymbol{f}_0$, which in general does not equal $\\boldsymbol{f}_0$.\n\nThe residual load vector, $\\boldsymbol{f}_{\\text{res}}$, is the difference between the externally applied load and the internal restoring force from the truncated modal solution:\n$$\n\\boldsymbol{f}_{\\text{res}} = \\boldsymbol{f}_0 - \\boldsymbol{K}\\boldsymbol{x}_{\\infty}^{(m)} = \\boldsymbol{f}_0 - \\left( \\sum_{r=1}^{m} \\boldsymbol{M}\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\right) \\boldsymbol{f}_0\n$$\nUsing the identity for $\\boldsymbol{f}_0$, we find:\n$$\n\\boldsymbol{f}_{\\text{res}} = \\left( \\sum_{r=1}^{n} \\boldsymbol{M}\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\right) \\boldsymbol{f}_0 - \\left( \\sum_{r=1}^{m} \\boldsymbol{M}\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\right) \\boldsymbol{f}_0 = \\left( \\sum_{r=m+1}^{n} \\boldsymbol{M}\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\right) \\boldsymbol{f}_0\n$$\nThis residual load represents the portion of the static load that is reacted by the higher-frequency modes ($r > m$) that were excluded from the truncated dynamic analysis. A static correction procedure aims to account for this imbalance by adding the static displacement caused by $\\boldsymbol{f}_{\\text{res}}$, which is approximately $\\boldsymbol{K}^{-1}\\boldsymbol{f}_{\\text{res}}$, to the truncated modal solution $\\boldsymbol{x}_{\\infty}^{(m)}$. This improves the accuracy of the static component of the overall response.", "answer": "$$\n\\boxed{\\frac{\\boldsymbol{\\phi}_r \\boldsymbol{\\phi}_r^{\\mathsf{T}} \\boldsymbol{f}_0}{\\omega_r^2}}\n$$", "id": "2578769"}, {"introduction": "Having established that simple modal truncation introduces static errors, we now move from theory to a practical, computational comparison of solutions. This exercise pits the standard Mode Displacement Method (MDM) against the more refined Mode Acceleration Method (MAM), which explicitly includes a static correction for the neglected high-frequency modes [@problem_id:2578761]. By implementing both approaches in code and quantitatively comparing their accuracy in predicting peak displacements and reaction forces, you will gain a robust understanding of why and when MAM is a superior choice for engineering analysis. This practice provides a direct demonstration of how to significantly improve the fidelity of a reduced-order dynamic model.", "problem": "You are given a linear, time-invariant second-order system obtained from the Finite Element Method (FEM) semi-discretization of structural dynamics, governed by the matrix ordinary differential equation\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{x}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{x}}(t) + \\mathbf{K}\\,\\mathbf{x}(t) = \\mathbf{f}(t),\n$$\nwith initial conditions\n$$\n\\mathbf{x}(0) = \\mathbf{0},\\quad \\dot{\\mathbf{x}}(0) = \\mathbf{0}.\n$$\nHere, $\\mathbf{M}\\in\\mathbb{R}^{n\\times n}$ is the symmetric positive-definite mass matrix, $\\mathbf{K}\\in\\mathbb{R}^{n\\times n}$ is the symmetric positive-definite stiffness matrix, $\\mathbf{C}\\in\\mathbb{R}^{n\\times n}$ is the damping matrix assumed to be Rayleigh of the form $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$, and $\\mathbf{f}(t)$ is a step load $\\mathbf{f}(t) = \\mathbf{f}_0\\,H(t)$, where $H(t)$ is the Heaviside step function, $\\mathbf{f}_0\\in\\mathbb{R}^{n}$ is a constant load vector, and $t$ is time in seconds.\n\nThe task is to compare two modal superposition truncation strategies for predicting the physical displacement response and a support reaction under a step load:\n- Mode Displacement Method (MDM): retain $r$ modes and reconstruct the physical displacement only from the retained modal displacements.\n- Mode Acceleration Method (MAM): retain $r$ modes for the modal dynamics but augment the physical displacement reconstruction by enforcing equilibrium of the residual loads through a static correction that uses the stiffness matrix.\n\nYou must:\n1. Start from the fundamental governing equation above and the definition of Rayleigh damping and derive the modal equations by solving the generalized eigenvalue problem\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_j = \\omega_j^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_j,\\quad j=1,\\dots,n,\n$$\nwith mass normalization $\\boldsymbol{\\phi}_i^{\\top}\\mathbf{M}\\,\\boldsymbol{\\phi}_j = \\delta_{ij}$. Denote $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1,\\dots,\\boldsymbol{\\phi}_n]$, $\\boldsymbol{\\Omega}^2 = \\mathrm{diag}(\\omega_1^2,\\dots,\\omega_n^2)$, and write the decoupled modal equations for the generalized coordinates $\\mathbf{q}(t)$ under the step load.\n2. Define precisely the MDM and MAM physical displacement reconstructions using only the first $r$ modes, ensuring that the MAM correction is obtained by enforcing static equilibrium of the residual loads in the physical coordinates at every time $t$. Do not assume any special structure of the load beyond being a step; derive the expressions from first principles.\n3. For a three-degree-of-freedom chain with translational degrees of freedom $\\mathbf{x}(t) = [x_1(t), x_2(t), x_3(t)]^\\top$ measured in meters, adopt the following stiffness topology: a spring with stiffness $k_1$ connects $x_1$ to ground, a spring with stiffness $k_2$ connects $x_1$ and $x_2$, and a spring with stiffness $k_3$ connects $x_2$ and $x_3$. The corresponding stiffness matrix is\n$$\n\\mathbf{K} = \\begin{bmatrix}\nk_1 + k_2 & -k_2 & 0\\\\\n-k_2 & k_2 + k_3 & -k_3\\\\\n0 & -k_3 & k_3\n\\end{bmatrix}.\n$$\nThe base reaction is defined as the elastic force in the ground spring, i.e., $R_\\text{base}(t) = k_1\\,x_1(t)$, measured in newtons.\n4. Calibrate the Rayleigh damping coefficients $\\alpha$ and $\\beta$ by enforcing target modal damping ratios $\\zeta(\\omega_a)=\\zeta_a$ and $\\zeta(\\omega_b)=\\zeta_b$ at two chosen circular frequencies $\\omega_a$ and $\\omega_b$, using the identity for mass-normalized modes\n$$\n\\zeta_j \\equiv \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{C}\\,\\boldsymbol{\\phi}_j}{2\\,\\omega_j} = \\frac{\\alpha}{2\\,\\omega_j} + \\frac{\\beta\\,\\omega_j}{2}.\n$$\nFor each test case below, use $\\omega_a=\\omega_1$, $\\omega_b=\\omega_3$, and the specified targets $\\zeta_a$ and $\\zeta_b$.\n5. Use a modal-space time integration scheme that is unconditionally stable and second-order accurate for linear systems (e.g., the Newmark average-acceleration method) to compute the time histories of the retained generalized coordinates for both the MDM and the MAM reconstructions, as well as the reference solution that uses all $n$ modes. The modal mass must be $1$ due to mass normalization. Time is in seconds, forces in newtons, masses in kilograms, and stiffnesses in newtons per meter. For all cases, initial conditions are zero. The Heaviside step is applied at $t=0^+$.\n6. For each test case, compute:\n   - The peak absolute displacement at the top degree of freedom $x_3(t)$ in meters.\n   - The peak absolute base reaction $R_\\text{base}(t)$ in newtons.\n   For both quantities, compute the absolute relative error of MDM and MAM with respect to the full-modal reference solution using all $n$ modes:\n$$\n\\varepsilon = \\left|\\frac{\\text{approximate peak}}{\\text{reference peak}} - 1\\right|.\n$$\nExpress these errors as decimals (not percentages), rounded to six decimal places.\n\nImplement a program that performs the above for the following test suite. In each case, specify the mass matrix $\\mathbf{M}$ (diagonal), stiffness parameters $(k_1,k_2,k_3)$, step load vector $\\mathbf{f}_0$, the number of retained modes $r$, the Rayleigh damping targets $(\\zeta_a,\\zeta_b)$ at $(\\omega_1,\\omega_3)$, the final time $T_\\text{end}$ in seconds, and the uniform time step $\\Delta t$ in seconds.\n\nTest Suite:\n- Case A (baseline, lightly damped, first-mode truncation):\n  - $\\mathbf{M} = \\mathrm{diag}([1000, 1200, 800])$ in kilograms.\n  - $(k_1,k_2,k_3) = (2.0\\times 10^6, 1.5\\times 10^6, 1.0\\times 10^6)$ in newtons per meter.\n  - $\\mathbf{f}_0 = [0, 0, 10000]^\\top$ in newtons.\n  - $r = 1$.\n  - $(\\zeta_a, \\zeta_b) = (0.02, 0.02)$.\n  - $T_\\text{end} = 1.2$ seconds, $\\Delta t = 5.0\\times 10^{-4}$ seconds.\n- Case B (stiffer system, first-mode truncation):\n  - $\\mathbf{M} = \\mathrm{diag}([1000, 1200, 800])$ in kilograms.\n  - $(k_1,k_2,k_3) = (5.0\\times 10^6, 5.0\\times 10^6, 5.0\\times 10^6)$ in newtons per meter.\n  - $\\mathbf{f}_0 = [5000, 0, 0]^\\top$ in newtons.\n  - $r = 1$.\n  - $(\\zeta_a, \\zeta_b) = (0.02, 0.02)$.\n  - $T_\\text{end} = 0.6$ seconds, $\\Delta t = 2.0\\times 10^{-4}$ seconds.\n- Case C (undamped, two-mode truncation):\n  - $\\mathbf{M} = \\mathrm{diag}([1000, 1200, 800])$ in kilograms.\n  - $(k_1,k_2,k_3) = (2.5\\times 10^6, 1.8\\times 10^6, 1.2\\times 10^6)$ in newtons per meter.\n  - $\\mathbf{f}_0 = [0, 8000, 0]^\\top$ in newtons.\n  - $r = 2$.\n  - $(\\zeta_a, \\zeta_b) = (0.0, 0.0)$, i.e., $\\alpha=\\beta=0$.\n  - $T_\\text{end} = 1.0$ seconds, $\\Delta t = 4.0\\times 10^{-4}$ seconds.\n\nYour program must:\n- For each case, assemble $\\mathbf{M}$ and $\\mathbf{K}$, compute the full set of mass-normalized modes, determine $\\alpha$ and $\\beta$ for Rayleigh damping (except Case C where $\\alpha=\\beta=0$), assemble $\\mathbf{C}$, and integrate the decoupled modal equations for the retained set and the full set using a consistent Newmark average-acceleration scheme for the given $\\Delta t$ and $T_\\text{end}$.\n- Reconstruct the physical displacement time histories for MDM and MAM using the retained modes only, and compute the reference physical displacement using all modes.\n- Compute the peak absolute $x_3(t)$ (in meters) and the peak absolute $R_\\text{base}(t)=k_1 x_1(t)$ (in newtons) for each of MDM, MAM, and the reference, and then compute the absolute relative errors as specified, rounded to six decimal places.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in order, for each case A, B, C: the MDM displacement error at $x_3$, the MAM displacement error at $x_3$, the MDM base reaction error, the MAM base reaction error. All values must be decimals rounded to six decimal places. For example, the output format must be\n$$\n[\\varepsilon^\\text{A}_\\text{MDM,disp},\\varepsilon^\\text{A}_\\text{MAM,disp},\\varepsilon^\\text{A}_\\text{MDM,rxn},\\varepsilon^\\text{A}_\\text{MAM,rxn},\\varepsilon^\\text{B}_\\text{MDM,disp},\\dots,\\varepsilon^\\text{C}_\\text{MAM,rxn}]\n$$\nwith exactly $12$ entries and no extra text.", "solution": "The problem presented is a standard, well-posed problem in the field of structural dynamics, specifically addressing modal analysis and model order reduction techniques. All provided data, equations, and conditions are scientifically sound, consistent, and sufficient for a unique solution. The problem is valid.\n\nThe task is to analyze a linear time-invariant structural system and compare two modal truncation methods: the Mode Displacement Method (MDM) and the Mode Acceleration Method (MAM). The system is governed by the second-order matrix ordinary differential equation:\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{x}}(t) + \\mathbf{C}\\,\\dot{\\mathbf{x}}(t) + \\mathbf{K}\\,\\mathbf{x}}(t) = \\mathbf{f}(t)\n$$\nwith zero initial conditions $\\mathbf{x}(0) = \\mathbf{0}$ and $\\dot{\\mathbf{x}}(0) = \\mathbf{0}$. The matrices $\\mathbf{M}$ and $\\mathbf{K}$ are the symmetric positive-definite mass and stiffness matrices, respectively. The damping matrix $\\mathbf{C}$ is assumed to be of the Rayleigh form, $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$. The external load is a step function $\\mathbf{f}(t) = \\mathbf{f}_0\\,H(t)$.\n\n**1. Derivation of Decoupled Modal Equations**\n\nThe core of modal analysis is to transform the system of coupled physical coordinates $\\mathbf{x}(t)$ into a set of uncoupled generalized (or modal) coordinates $\\mathbf{q}(t)$. This is achieved by solving the undamped free-vibration generalized eigenvalue problem:\n$$\n\\mathbf{K}\\,\\boldsymbol{\\phi}_j = \\omega_j^2\\,\\mathbf{M}\\,\\boldsymbol{\\phi}_j, \\quad j=1,\\dots,n\n$$\nwhere $\\omega_j$ are the natural circular frequencies and $\\boldsymbol{\\phi}_j$ are the corresponding mode shapes. The mode shapes are orthogonal with respect to both $\\mathbf{M}$ and $\\mathbf{K}$. We enforce mass-normalization, such that:\n$$\n\\boldsymbol{\\phi}_i^{\\top}\\mathbf{M}\\,\\boldsymbol{\\phi}_j = \\delta_{ij} \\quad (\\text{modal masses are unity})\n$$\n$$\n\\boldsymbol{\\phi}_i^{\\top}\\mathbf{K}\\,\\boldsymbol{\\phi}_j = \\omega_j^2 \\delta_{ij} \\quad (\\text{modal stiffnesses are } \\omega_j^2)\n$$\nLet $\\boldsymbol{\\Phi} = [\\boldsymbol{\\phi}_1, \\dots, \\boldsymbol{\\phi}_n]$ be the modal matrix and $\\boldsymbol{\\Omega}^2 = \\mathrm{diag}(\\omega_1^2, \\dots, \\omega_n^2)$ be the diagonal matrix of squared frequencies. The coordinate transformation is defined as $\\mathbf{x}(t) = \\boldsymbol{\\Phi}\\,\\mathbf{q}(t)$. Substituting this into the governing equation:\n$$\n\\mathbf{M}\\,\\boldsymbol{\\Phi}\\,\\ddot{\\mathbf{q}}(t) + \\mathbf{C}\\,\\boldsymbol{\\Phi}\\,\\dot{\\mathbf{q}}(t) + \\mathbf{K}\\,\\boldsymbol{\\Phi}\\,\\mathbf{q}(t) = \\mathbf{f}(t)\n$$\nPre-multiplying by $\\boldsymbol{\\Phi}^{\\top}$ and applying the orthogonality properties yields:\n$$\n\\boldsymbol{\\Phi}^{\\top}\\mathbf{M}\\,\\boldsymbol{\\Phi}\\,\\ddot{\\mathbf{q}}(t) + \\boldsymbol{\\Phi}^{\\top}\\mathbf{C}\\,\\boldsymbol{\\Phi}\\,\\dot{\\mathbf{q}}(t) + \\boldsymbol{\\Phi}^{\\top}\\mathbf{K}\\,\\boldsymbol{\\Phi}\\,\\mathbf{q}(t) = \\boldsymbol{\\Phi}^{\\top}\\mathbf{f}(t)\n$$\n$$\n\\mathbf{I}\\,\\ddot{\\mathbf{q}}(t) + \\mathbf{\\hat{C}}\\,\\dot{\\mathbf{q}}(t) + \\boldsymbol{\\Omega}^2\\,\\mathbf{q}(t) = \\boldsymbol{\\Phi}^{\\top}\\mathbf{f}(t)\n$$\nwhere $\\mathbf{\\hat{C}} = \\boldsymbol{\\Phi}^{\\top}\\mathbf{C}\\,\\boldsymbol{\\Phi}$ is the modal damping matrix. For Rayleigh damping, $\\mathbf{C} = \\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K}$, the modal damping matrix becomes diagonal:\n$$\n\\mathbf{\\hat{C}} = \\boldsymbol{\\Phi}^{\\top}(\\alpha\\,\\mathbf{M} + \\beta\\,\\mathbf{K})\\boldsymbol{\\Phi} = \\alpha\\,\\boldsymbol{\\Phi}^{\\top}\\mathbf{M}\\,\\boldsymbol{\\Phi} + \\beta\\,\\boldsymbol{\\Phi}^{\\top}\\mathbf{K}\\,\\boldsymbol{\\Phi} = \\alpha\\,\\mathbf{I} + \\beta\\,\\boldsymbol{\\Omega}^2\n$$\nThis results in a set of $n$ uncoupled single-degree-of-freedom (SDOF) equations. For the $j$-th mode, the equation is:\n$$\n\\ddot{q}_j(t) + (\\alpha + \\beta\\,\\omega_j^2)\\,\\dot{q}_j(t) + \\omega_j^2\\,q_j(t) = \\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)\n$$\nThe term $(\\alpha + \\beta\\,\\omega_j^2)$ is equivalent to $2\\zeta_j\\omega_j$, where $\\zeta_j$ is the modal damping ratio for mode $j$. Thus, $\\zeta_j = \\frac{\\alpha}{2\\omega_j} + \\frac{\\beta\\omega_j}{2}$. For the specified step load, the equation for each modal coordinate becomes:\n$$\n\\ddot{q}_j(t) + 2\\zeta_j\\omega_j\\,\\dot{q}_j(t) + \\omega_j^2\\,q_j(t) = \\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}_0, \\quad \\text{for } t > 0\n$$\nThe initial conditions transform to $\\mathbf{q}(0) = \\boldsymbol{\\Phi}^{-1}\\mathbf{x}(0) = \\mathbf{0}$ and $\\dot{\\mathbf{q}}(0) = \\boldsymbol{\\Phi}^{-1}\\dot{\\mathbf{x}}(0) = \\mathbf{0}$.\n\n**2. Mode Displacement Method (MDM) vs. Mode Acceleration Method (MAM)**\n\nWhen using a reduced set of $r < n$ modes (typically the ones with the lowest frequencies), we seek an approximation for $\\mathbf{x}(t)$.\n\n**Mode Displacement Method (MDM):** This method directly truncates the modal series expansion for displacement. The approximate physical displacement is reconstructed solely from the $r$ retained modal coordinates:\n$$\n\\mathbf{x}_\\text{MDM}(t) = \\sum_{j=1}^r \\boldsymbol{\\phi}_j q_j(t) = \\boldsymbol{\\Phi}_r \\mathbf{q}_r(t)\n$$\nwhere $\\boldsymbol{\\Phi}_r = [\\boldsymbol{\\phi}_1, \\dots, \\boldsymbol{\\phi}_r]$ and $\\mathbf{q}_r(t) = [q_1(t), \\dots, q_r(t)]^\\top$. The modal coordinates $q_j(t)$ for $j=1, \\dots, r$ are obtained by integrating their respective SDOF equations.\n\n**Mode Acceleration Method (MAM):** This method provides an improved approximation by including a static correction for the contribution of the truncated higher modes. We start by recasting the governing equation to express displacement statically:\n$$\n\\mathbf{x}(t) = \\mathbf{K}^{-1}[\\mathbf{f}(t) - \\mathbf{M}\\,\\ddot{\\mathbf{x}}(t) - \\mathbf{C}\\,\\dot{\\mathbf{x}}(t)]\n$$\nThe term $\\mathbf{K}^{-1}\\mathbf{f}(t)$ is the pseudo-static response. The other terms represent the dynamic correction from inertia and damping forces. The key insight of MAM is to approximate these dynamic forces using only the retained $r$ modes.\n$$\n\\ddot{\\mathbf{x}}(t) \\approx \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\ddot{q}_j(t), \\quad \\dot{\\mathbf{x}}(t) \\approx \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\dot{q}_j(t)\n$$\nSubstituting these approximations and the modal equations of motion, $\\ddot{q}_j = p_j(t) - c_j\\dot{q}_j - k_j q_j$ where $p_j(t) = \\boldsymbol{\\phi}_j^\\top \\mathbf{f}(t)$, $c_j=2\\zeta_j\\omega_j$, $k_j=\\omega_j^2$, we can derive a more convenient form. A clearer derivation is to observe that the full displacement is $\\mathbf{x}(t) = \\sum_{j=1}^n \\boldsymbol{\\phi}_j q_j(t)$. We split this into retained and truncated parts:\n$$\n\\mathbf{x}(t) = \\sum_{j=1}^r \\boldsymbol{\\phi}_j q_j(t) + \\sum_{j=r+1}^n \\boldsymbol{\\phi}_j q_j(t)\n$$\nMAM approximates the contribution of the high-frequency truncated modes ($j > r$) by their static response. From the modal equation, neglecting inertial and damping terms for high-frequency modes gives $\\omega_j^2 q_j(t) \\approx \\boldsymbol{\\phi}_j^\\top \\mathbf{f}(t)$, so $q_j(t) \\approx \\frac{\\boldsymbol{\\phi}_j^\\top \\mathbf{f}(t)}{\\omega_j^2}$. The MAM displacement is thus:\n$$\n\\mathbf{x}_\\text{MAM}(t) \\approx \\sum_{j=1}^r \\boldsymbol{\\phi}_j q_j(t) + \\sum_{j=r+1}^n \\boldsymbol{\\phi}_j \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)}{\\omega_j^2}\n$$\nThe second term is the static response of the truncated modes. This can be expressed as the difference between the total static response and the static response of the retained modes:\n$$\n\\sum_{j=r+1}^n \\boldsymbol{\\phi}_j \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)}{\\omega_j^2} = \\mathbf{K}^{-1}\\mathbf{f}(t) - \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}(t)}{\\omega_j^2}\n$$\nSubstituting this back, we obtain the final expression for the MAM displacement for a step load $\\mathbf{f}(t) = \\mathbf{f}_0 H(t)$:\n$$\n\\mathbf{x}_\\text{MAM}(t) = \\mathbf{K}^{-1}\\mathbf{f}_0 + \\sum_{j=1}^r \\boldsymbol{\\phi}_j \\left( q_j(t) - \\frac{\\boldsymbol{\\phi}_j^{\\top}\\mathbf{f}_0}{\\omega_j^2} \\right)\n$$\nHere, $q_j(t)$ is the full dynamic solution for the $j$-th modal coordinate, and the term subtracted is its static component. This formulation replaces the dynamic response of higher modes with their static response, which is often a significant improvement, especially for recovering internal forces and reactions.\n\n**3. Numerical Integration**\n\nThe SDOF modal equations are integrated numerically using the Newmark average-acceleration method. For this method, the parameters are $\\gamma = 1/2$ and $\\beta_{NM} = 1/4$. It is unconditionally stable for linear systems and second-order accurate. At each time step $t_{i+1} = t_i + \\Delta t$, for each mode $j$, given $(q_{j,i}, \\dot{q}_{j,i}, \\ddot{q}_{j,i})$, we solve for $(q_{j,i+1}, \\dot{q}_{j,i+1}, \\ddot{q}_{j,i+1})$. With initial conditions $q_j(0)=0, \\dot{q}_j(0)=0$, the initial acceleration is $\\ddot{q}_j(0) = \\boldsymbol{\\phi}_j^\\top\\mathbf{f}_0$. The update proceeds for each time step until $T_\\text{end}$.\n\n**4. Quantities of Interest and Error Metric**\n\nFor each reconstruction method (MDM, MAM) and the full-modal reference solution, we compute the time history of the physical displacements $\\mathbf{x}(t)$. From this, we extract two quantities:\n- The displacement at the top degree of freedom, $x_3(t)$.\n- The base reaction force, $R_\\text{base}(t) = k_1 x_1(t)$.\n\nFor each quantity, we find its peak absolute value over the time history. The absolute relative error $\\varepsilon$ of an approximate method (MDM or MAM) is then computed with respect to the reference solution (using all $n$ modes) as:\n$$\n\\varepsilon = \\left|\\frac{\\text{approximate peak}}{\\text{reference peak}} - 1\\right|\n$$\nThe following program implements this procedure for the specified test suite.", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for MDM vs. MAM comparison.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"M_diag\": [1000.0, 1200.0, 800.0],\n            \"k_vals\": (2.0e6, 1.5e6, 1.0e6),\n            \"f0\": np.array([0.0, 0.0, 10000.0]),\n            \"r\": 1,\n            \"zetas\": (0.02, 0.02),\n            \"Tend\": 1.2,\n            \"dt\": 5.0e-4,\n        },\n        {\n            \"name\": \"Case B\",\n            \"M_diag\": [1000.0, 1200.0, 800.0],\n            \"k_vals\": (5.0e6, 5.0e6, 5.0e6),\n            \"f0\": np.array([5000.0, 0.0, 0.0]),\n            \"r\": 1,\n            \"zetas\": (0.02, 0.02),\n            \"Tend\": 0.6,\n            \"dt\": 2.0e-4,\n        },\n        {\n            \"name\": \"Case C\",\n            \"M_diag\": [1000.0, 1200.0, 800.0],\n            \"k_vals\": (2.5e6, 1.8e6, 1.2e6),\n            \"f0\": np.array([0.0, 8000.0, 0.0]),\n            \"r\": 2,\n            \"zetas\": (0.0, 0.0),\n            \"Tend\": 1.0,\n            \"dt\": 4.0e-4,\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results = _solve_case(**case)\n        all_results.extend(results)\n\n    # Format the final output as specified.\n    print(f\"[{','.join([f'{r:.6f}' for r in all_results])}]\")\n\n\ndef _solve_case(name, M_diag, k_vals, f0, r, zetas, Tend, dt):\n    \"\"\"\n    Solves a single test case for the modal analysis comparison.\n    \"\"\"\n    n = len(M_diag)\n    M = np.diag(M_diag)\n    k1, k2, k3 = k_vals\n    K = np.array([\n        [k1 + k2, -k2, 0],\n        [-k2, k2 + k3, -k3],\n        [0, -k3, k3]\n    ])\n\n    # 1. Solve the generalized eigenvalue problem K*phi = omega^2*M*phi\n    eigvals, eigvecs = eigh(K, M)\n    omega = np.sqrt(eigvals)\n    \n    # 2. Mass-normalize the eigenvectors\n    Phi = np.zeros_like(eigvecs)\n    for j in range(n):\n        phi_j_un = eigvecs[:, j]\n        norm_factor = np.sqrt(phi_j_un.T @ M @ phi_j_un)\n        Phi[:, j] = phi_j_un / norm_factor\n\n    # 3. Determine Rayleigh damping coefficients alpha and beta\n    zeta_a, zeta_b = zetas\n    if zeta_a == 0.0 and zeta_b == 0.0:\n        alpha, beta = 0.0, 0.0\n    else:\n        # Calibrate using modes 1 and 3 (indices 0 and 2)\n        omega_a, omega_b = omega[0], omega[2]\n        A = np.array([[1, omega_a**2], [1, omega_b**2]])\n        b_vec = np.array([2 * zeta_a * omega_a, 2 * zeta_b * omega_b])\n        alpha, beta = np.linalg.solve(A, b_vec)\n    \n    # 4. Calculate modal damping ratios and modal forces\n    modal_zeta = (alpha / (2 * omega)) + (beta * omega / 2)\n    modal_forces = Phi.T @ f0\n\n    # 5. Time integration using Newmark's average-acceleration method\n    time_steps = np.arange(0, Tend + dt/2, dt)\n    num_steps = len(time_steps)\n    \n    q = np.zeros((n, num_steps))\n    q_dot = np.zeros((n, num_steps))\n    q_ddot = np.zeros((n, num_steps))\n\n    # Initial conditions: q(0) = 0, q_dot(0) = 0\n    # From EOM at t=0: M*q_ddot + C*q_dot + K*q = F => 1*q_ddot(0) = p\n    q_ddot[:, 0] = modal_forces\n\n    gamma_nm, beta_nm = 0.5, 0.25\n\n    for j in range(n):\n        c_j = 2 * modal_zeta[j] * omega[j]\n        k_j = omega[j]**2\n        p_j = modal_forces[j]\n        \n        # Pre-calculate constant denominator for acceleration update\n        denom = 1 + c_j * gamma_nm * dt + k_j * beta_nm * dt**2\n        \n        for i in range(num_steps - 1):\n            # Predictors (for average acceleration method)\n            q_pred = q[j, i] + dt * q_dot[j, i] + (dt**2 / 4) * q_ddot[j, i]\n            q_dot_pred = q_dot[j, i] + (dt / 2) * q_ddot[j, i]\n            \n            # Solve for acceleration at t_{i+1}\n            q_ddot[j, i+1] = (p_j - c_j * q_dot_pred - k_j * q_pred) / denom\n            \n            # Correctors\n            q_dot[j, i+1] = q_dot_pred + gamma_nm * dt * q_ddot[j, i+1]\n            q[j, i+1] = q_pred + beta_nm * dt**2 * q_ddot[j, i+1]\n\n    # 6. Reconstruct physical responses\n    # Reference solution (all modes)\n    x_ref = Phi @ q\n\n    # MDM solution (r modes)\n    Phi_r = Phi[:, :r]\n    q_r = q[:r, :]\n    x_mdm = Phi_r @ q_r\n\n    # MAM solution (r modes)\n    K_inv_f0 = np.linalg.solve(K, f0).reshape(-1, 1)\n    mam_dynamic_part = np.zeros((n, num_steps))\n    for j in range(r):\n        q_j_static = modal_forces[j] / omega[j]**2\n        mam_dynamic_part += Phi[:, j:j+1] @ (q_r[j:j+1, :] - q_j_static)\n    x_mam = K_inv_f0 + mam_dynamic_part\n\n    # 7. Calculate peak values and relative errors\n    # Peak displacement at x3 (DOF 3, index 2)\n    peak_x3_ref = np.max(np.abs(x_ref[2, :]))\n    peak_x3_mdm = np.max(np.abs(x_mdm[2, :]))\n    peak_x3_mam = np.max(np.abs(x_mam[2, :]))\n\n    err_disp_mdm = abs(peak_x3_mdm / peak_x3_ref - 1)\n    err_disp_mam = abs(peak_x3_mam / peak_x3_ref - 1)\n\n    # Peak base reaction R_base = k1 * x1 (DOF 1, index 0)\n    R_ref = k1 * x_ref[0, :]\n    R_mdm = k1 * x_mdm[0, :]\n    R_mam = k1 * x_mam[0, :]\n\n    peak_R_ref = np.max(np.abs(R_ref))\n    peak_R_mdm = np.max(np.abs(R_mdm))\n    peak_R_mam = np.max(np.abs(R_mam))\n\n    err_rxn_mdm = abs(peak_R_mdm / peak_R_ref - 1)\n    err_rxn_mam = abs(peak_R_mam / peak_R_ref - 1)\n\n    return [err_disp_mdm, err_disp_mam, err_rxn_mdm, err_rxn_mam]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2578761"}]}