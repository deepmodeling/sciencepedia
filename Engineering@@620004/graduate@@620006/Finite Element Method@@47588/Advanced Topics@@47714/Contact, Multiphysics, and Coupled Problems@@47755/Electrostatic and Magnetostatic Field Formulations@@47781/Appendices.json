{"hands_on_practices": [{"introduction": "The finite element method transforms differential equations into systems of algebraic equations by evaluating integrals defined by the weak formulation. In practice, these element-level integrals are computed numerically using quadrature rules, as analytical solutions are often intractable for complex geometries or variable material properties. This exercise guides you through determining the minimum required accuracy for a quadrature rule to avoid introducing integration errors, a critical step for ensuring the integrity and optimal convergence of a simulation [@problem_id:2553561].", "problem": "In electrostatics, the governing strong form for the electric potential $\\phi$ in a heterogeneous dielectric medium with permittivity $\\epsilon(\\mathbf{x})$ and free charge density $\\rho(\\mathbf{x})$ is $\\nabla\\cdot\\big(\\epsilon(\\mathbf{x})\\,\\nabla \\phi(\\mathbf{x})\\big) = -\\rho(\\mathbf{x})$. The standard weak form seeks $\\phi \\in H^{1}(\\Omega)$ such that, for all test functions $\\psi \\in H^{1}(\\Omega)$, the bilinear form $a(\\phi,\\psi) := \\int_{\\Omega} \\epsilon(\\mathbf{x})\\,\\nabla \\phi \\cdot \\nabla \\psi \\,\\mathrm{d}\\mathbf{x}$ equals the linear functional of the sources. Consider a conforming finite element discretization on a two-dimensional mesh of triangles with affine element mappings, using continuous Lagrange basis functions of polynomial order $p \\geq 1$ on each element $K$. Assume that on each element $K$ the permittivity $\\epsilon|_{K}$ is a polynomial of total degree $r \\geq 0$ in the physical coordinates. For the elementwise bilinear form\n$$\na_{K}(u,v) \\;=\\; \\int_{K} \\epsilon(\\mathbf{x})\\, \\nabla u(\\mathbf{x}) \\cdot \\nabla v(\\mathbf{x}) \\,\\mathrm{d}\\mathbf{x}\\,,\n$$\nyou will approximate the integral exactly by using a single triangle quadrature rule on $K$ whose exactness is characterized by its polynomial exactness degree $t$, meaning it integrates exactly all polynomials on $K$ of total degree up to $t$.\n\nStarting from the above foundational formulations and definitions, determine the minimal polynomial exactness degree $t$ required so that, for any pair of local basis functions $u$ and $v$ of degree $p$ on $K$, the quadrature integrates $a_{K}(u,v)$ exactly, for any coefficient field $\\epsilon|_{K}$ that is a polynomial of total degree $r$. Provide your answer as a closed-form expression in terms of $p$ and $r$. Justify your rule by rigorous degree counting based on the structure of the integrand and the affine mapping assumption. Your final answer must be a single analytical expression.", "solution": "The problem as stated requires a determination of the minimal polynomial exactness degree, denoted by the symbol $t$, for a quadrature rule used to compute an element stiffness matrix in a finite element context. The objective is to ensure exact integration of the elementwise bilinear form for any choice of polynomial basis functions and a polynomial material coefficient. The problem is well-posed, scientifically grounded, and contains sufficient information for a rigorous derivation. It is a standard problem in the analysis of the finite element method. We proceed to the solution.\n\nThe elementwise bilinear form is given by\n$$\na_{K}(u,v) = \\int_{K} \\epsilon(\\mathbf{x})\\, \\nabla u(\\mathbf{x}) \\cdot \\nabla v(\\mathbf{x}) \\,\\mathrm{d}\\mathbf{x}\n$$\nwhere $K$ is a triangular element in a two-dimensional domain. The quadrature rule must be able to integrate the integrand, $I(\\mathbf{x}) = \\epsilon(\\mathbf{x})\\, \\nabla u(\\mathbf{x}) \\cdot \\nabla v(\\mathbf{x})$, exactly. The minimal required degree of exactness, $t$, is therefore equal to the total polynomial degree of the integrand $I(\\mathbf{x})$. To find this degree, we must analyze each term in the product.\n\nLet $\\mathcal{P}_{k}(D)$ denote the space of polynomials of total degree at most $k$ on a domain $D$.\n\nFirst, consider the basis functions $u$ and $v$. The problem states these are continuous Lagrange basis functions of polynomial order $p \\ge 1$. This means that on the reference element $\\hat{K}$, the shape functions are polynomials of degree $p$. The mapping from the reference element $\\hat{K}$ to the physical element $K$ is affine. Let this mapping be $\\mathbf{F}: \\hat{K} \\to K$, such that $\\mathbf{x} = \\mathbf{F}(\\boldsymbol{\\xi})$, where $\\mathbf{x} \\in K$ are physical coordinates and $\\boldsymbol{\\xi} \\in \\hat{K}$ are reference coordinates. An affine map has the form $\\mathbf{x} = \\mathbf{J}\\boldsymbol{\\xi} + \\mathbf{b}$, where $\\mathbf{J}$ is the constant Jacobian matrix and $\\mathbf{b}$ is a constant translation vector.\n\nA basis function $u$ on the physical element $K$ is obtained by composition with the inverse mapping: $u(\\mathbf{x}) = \\hat{u}(\\mathbf{F}^{-1}(\\mathbf{x}))$, where $\\hat{u}$ is the corresponding basis function on the reference element. Since $\\mathbf{F}$ is affine, its inverse $\\mathbf{F}^{-1}$ is also affine. The composition of a polynomial of degree $p$ with an affine map results in another polynomial of degree $p$. Therefore, the basis functions $u(\\mathbf{x})$ and $v(\\mathbf{x})$ are polynomials of total degree $p$ in the physical coordinates $\\mathbf{x}$. We write $u, v \\in \\mathcal{P}_{p}(K)$.\n\nNext, we examine the gradients, $\\nabla u$ and $\\nabla v$. The gradient operator, $\\nabla$, maps a polynomial of degree $k$ to a vector field whose components are polynomials of degree $k-1$. Since $u, v \\in \\mathcal{P}_{p}(K)$, their gradients $\\nabla u$ and $\\nabla v$ are vector fields whose components are polynomials of total degree at most $p-1$. For example, $\\frac{\\partial u}{\\partial x} \\in \\mathcal{P}_{p-1}(K)$ and $\\frac{\\partial u}{\\partial y} \\in \\mathcal{P}_{p-1}(K)$.\n\nNow, consider the dot product $\\nabla u \\cdot \\nabla v$. This is given by:\n$$\n\\nabla u \\cdot \\nabla v = \\frac{\\partial u}{\\partial x}\\frac{\\partial v}{\\partial x} + \\frac{\\partial u}{\\partial y}\\frac{\\partial v}{\\partial y}\n$$\nEach term in this sum is a product of two polynomials of degree $p-1$. The degree of a product of polynomials is the sum of their degrees. Thus, the degree of $\\frac{\\partial u}{\\partial x}\\frac{\\partial v}{\\partial x}$ is at most $(p-1) + (p-1) = 2p-2$. Similarly, the degree of $\\frac{\\partial u}{\\partial y}\\frac{\\partial v}{\\partial y}$ is also at most $2p-2$. The degree of a sum of polynomials is the maximum of their individual degrees. Therefore, the total degree of the polynomial $\\nabla u \\cdot \\nabla v$ is $2p-2$.\nSo, $\\nabla u \\cdot \\nabla v \\in \\mathcal{P}_{2p-2}(K)$.\n\nFinally, we analyze the complete integrand, $I(\\mathbf{x}) = \\epsilon(\\mathbf{x})\\left(\\nabla u(\\mathbf{x}) \\cdot \\nabla v(\\mathbf{x})\\right)$. The problem states that the permittivity on the element $K$, denoted $\\epsilon|_{K}$, is a polynomial of total degree $r \\ge 0$. So, $\\epsilon(\\mathbf{x}) \\in \\mathcal{P}_{r}(K)$.\n\nThe integrand is a product of the polynomial $\\epsilon(\\mathbf{x})$ and the polynomial $\\nabla u \\cdot \\nabla v$. The degree of the resulting polynomial is the sum of the degrees of its factors:\n$$\n\\text{deg}(I) = \\text{deg}(\\epsilon) + \\text{deg}(\\nabla u \\cdot \\nabla v)\n$$\nSubstituting the degrees we found:\n$$\n\\text{deg}(I) = r + (2p-2)\n$$\nFor the quadrature rule to evaluate the integral $\\int_K I(\\mathbf{x}) \\,\\mathrm{d}\\mathbf{x}$ exactly, it must be exact for all polynomials up to the degree of the integrand. This means the minimal required degree of exactness $t$ for the quadrature rule must be equal to the degree of $I(\\mathbf{x})$.\n\nTherefore, the minimal polynomial exactness degree is:\n$$\nt = 2p - 2 + r\n$$\nThis result is fundamental for the correct implementation of the finite element method, as using a quadrature rule of insufficient degree leads to variational crimes and a potential loss of the optimal convergence rate. The assumption of an affine element mapping is critical; for isoparametric elements with non-affine mappings, the analysis would be more complex as the transformation itself would introduce rational functions, and the degree of the integrand in physical coordinates would not be a simple polynomial.", "answer": "$$\n\\boxed{2p + r - 2}\n$$", "id": "2553561"}, {"introduction": "While scalar potential formulations are common in electrostatics, modeling magnetostatic and full-wave electromagnetic phenomena requires vector-based approaches and specialized finite elements. This practice delves into the heart of $H(\\mathrm{curl})$-conforming discretizations by having you derive the element stiffness matrix for the lowest-order Nédélec edge element, a cornerstone of computational electromagnetics. By working through this fundamental calculation on a reference tetrahedron, you will gain concrete insight into the implementation of these crucial vector elements [@problem_id:2553591].", "problem": "Consider magnetostatics in a simply connected, source-free, isotropic region with constant magnetic permeability $\\mu$. Starting from the curl-curl formulation derived from Maxwell’s equations, use the Finite Element Method (FEM) with the lowest-order Nédélec (first family) edge elements on a single tetrahedral element. Let the tetrahedron be the reference simplex with vertices at $x_1=(0,0,0)$, $x_2=(1,0,0)$, $x_3=(0,1,0)$, and $x_4=(0,0,1)$, and let the local edge orientation be from the lower-numbered vertex to the higher-numbered vertex in the order $(1,2)$, $(1,3)$, $(1,4)$, $(2,3)$, $(2,4)$, $(3,4)$. Denote the barycentric coordinates by $\\lambda_a$, $a=1,2,3,4$, and use the canonical lowest-order Nédélec basis functions on edge $(a,b)$ defined by $\\mathbf{N}_{ab}=\\lambda_a\\nabla \\lambda_b-\\lambda_b\\nabla \\lambda_a$.\n\n1) Derive the element stiffness matrix $\\mathbf{K}_{e}$ with entries\n$$\nK_{(ab),(cd)} \\;=\\; \\int_{K} \\mu^{-1} \\big(\\nabla \\times \\mathbf{N}_{ab}\\big)\\cdot\\big(\\nabla \\times \\mathbf{N}_{cd}\\big)\\, \\mathrm{d}V,\n$$\nfor all local edges $(a,b)$ and $(c,d)$ in the given order.\n\n2) Suppose the global edge numbering for this single tetrahedron (with globally consistent orientation from lower-numbered to higher-numbered vertex) is given by the unordered list of edge-to-index associations\n$$\n(1,3)\\mapsto 7,\\quad (1,2)\\mapsto 4,\\quad (3,4)\\mapsto 12,\\quad (1,4)\\mapsto 9,\\quad (2,4)\\mapsto 11,\\quad (2,3)\\mapsto 8.\n$$\nSpecify the mapping from the local degrees of freedom (DOF) to the global degrees of freedom, including the orientation sign for each local edge relative to its global orientation.\n\nReport, as your final answer, the scalar quantity $S=\\mu\\, \\mathrm{tr}(\\mathbf{K}_{e})$ for this element. No rounding is required, and you should provide an exact value. The final reported scalar $S$ is dimensionless by construction and must be given as a single real number.", "solution": "The problem as stated is scientifically grounded, well-posed, and complete. It presents a standard exercise in the Finite Element Method (FEM) for magnetostatics. All necessary data, including the geometry of the element, the definition of the basis functions, and the formula for the stiffness matrix, are provided. The problem is thus deemed valid. I will proceed with the solution.\n\nThe problem asks for the derivation of the element stiffness matrix $\\mathbf{K}_e$ and the calculation of the scalar quantity $S = \\mu \\, \\mathrm{tr}(\\mathbf{K}_e)$.\n\nThe governing equation for magnetostatics in a source-free region is $\\nabla \\times (\\mu^{-1} \\nabla \\times \\mathbf{A}) = \\mathbf{0}$, where $\\mathbf{A}$ is the magnetic vector potential. The corresponding weak formulation leads to the element stiffness matrix entries:\n$$\nK_{(ab),(cd)} = \\int_{K} \\mu^{-1} (\\nabla \\times \\mathbf{N}_{ab}) \\cdot (\\nabla \\times \\mathbf{N}_{cd}) \\, \\mathrm{d}V\n$$\nwhere $K$ is the volume of the tetrahedral element and $\\mathbf{N}_{ab}$ are the lowest-order Nédélec edge basis functions. The basis function for the edge connecting vertices $a$ and $b$ is given by:\n$$\n\\mathbf{N}_{ab} = \\lambda_a \\nabla \\lambda_b - \\lambda_b \\nabla \\lambda_a\n$$\nwhere $\\lambda_i$ are the barycentric coordinates.\n\nFirst, we determine the properties of the specified reference tetrahedron. The vertices are $x_1=(0,0,0)$, $x_2=(1,0,0)$, $x_3=(0,1,0)$, and $x_4=(0,0,1)$. The barycentric coordinates $\\lambda_i(\\mathbf{x})$ are linear functions of position $\\mathbf{x}=(x,y,z)$ satisfying $\\lambda_i(x_j) = \\delta_{ij}$. For this specific tetrahedron, they are:\n$$\n\\lambda_1(\\mathbf{x}) = 1 - x - y - z\n$$\n$$\n\\lambda_2(\\mathbf{x}) = x\n$$\n$$\n\\lambda_3(\\mathbf{x}) = y\n$$\n$$\n\\lambda_4(\\mathbf{x}) = z\n$$\nThe gradients of the barycentric coordinates are constant vectors:\n$$\n\\mathbf{g}_1 = \\nabla \\lambda_1 = \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix}, \\quad\n\\mathbf{g}_2 = \\nabla \\lambda_2 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad\n\\mathbf{g}_3 = \\nabla \\lambda_3 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}, \\quad\n\\mathbf{g}_4 = \\nabla \\lambda_4 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\nThe volume of this tetrahedron is $V_K = \\frac{1}{6} |(x_2-x_1) \\cdot ((x_3-x_1) \\times (x_4-x_1))| = \\frac{1}{6}$.\n\nNext, we compute the curl of the basis function $\\mathbf{N}_{ab}$. Using the vector identity $\\nabla \\times (f \\mathbf{G}) = (\\nabla f) \\times \\mathbf{G} + f(\\nabla \\times \\mathbf{G})$ and noting that $\\nabla \\lambda_i$ are constant vectors (so their curl is zero), we have:\n$$\n\\nabla \\times \\mathbf{N}_{ab} = \\nabla \\times (\\lambda_a \\nabla \\lambda_b) - \\nabla \\times (\\lambda_b \\nabla \\lambda_a)\n= (\\nabla \\lambda_a \\times \\nabla \\lambda_b) - (\\nabla \\lambda_b \\times \\nabla \\lambda_a)\n= 2 (\\nabla \\lambda_a \\times \\nabla \\lambda_b)\n$$\nSince the gradients are constant, the curl of each basis function, $\\nabla \\times \\mathbf{N}_{ab}$, is a constant vector over the element $K$. Let us denote $\\mathbf{C}_{ab} = \\nabla \\lambda_a \\times \\nabla \\lambda_b$.\n\nThe stiffness matrix integral simplifies significantly:\n$$\nK_{(ab),(cd)} = \\int_{K} \\mu^{-1} (2 \\mathbf{C}_{ab}) \\cdot (2 \\mathbf{C}_{cd}) \\, \\mathrm{d}V = \\frac{4}{\\mu} (\\mathbf{C}_{ab} \\cdot \\mathbf{C}_{cd}) \\int_{K} \\mathrm{d}V = \\frac{4 V_K}{\\mu} (\\mathbf{C}_{ab} \\cdot \\mathbf{C}_{cd})\n$$\nSubstituting $V_K = 1/6$, we get:\n$$\nK_{(ab),(cd)} = \\frac{4}{6\\mu} (\\mathbf{C}_{ab} \\cdot \\mathbf{C}_{cd}) = \\frac{2}{3\\mu} (\\mathbf{C}_{ab} \\cdot \\mathbf{C}_{cd})\n$$\n\nThe local edges are ordered as $e_1=(1,2)$, $e_2=(1,3)$, $e_3=(1,4)$, $e_4=(2,3)$, $e_5=(2,4)$, $e_6=(3,4)$. We compute the corresponding curl vectors $\\mathbf{C}_{ab}$:\n$$\n\\mathbf{C}_{12} = \\mathbf{g}_1 \\times \\mathbf{g}_2 = \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix} \\times \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix}\n$$\n$$\n\\mathbf{C}_{13} = \\mathbf{g}_1 \\times \\mathbf{g}_3 = \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix} \\times \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix}\n$$\n$$\n\\mathbf{C}_{14} = \\mathbf{g}_1 \\times \\mathbf{g}_4 = \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix} \\times \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\mathbf{C}_{23} = \\mathbf{g}_2 \\times \\mathbf{g}_3 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} \\times \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n$$\n\\mathbf{C}_{24} = \\mathbf{g}_2 \\times \\mathbf{g}_4 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} \\times \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\mathbf{C}_{34} = \\mathbf{g}_3 \\times \\mathbf{g}_4 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} \\times \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nNow, we compute the matrix of dot products, $[\\mathbf{C}_{ab} \\cdot \\mathbf{C}_{cd}]$. Let the ordered set of curl vectors be $\\{\\mathbf{v}_1, \\dots, \\mathbf{v}_6\\} = \\{\\mathbf{C}_{12}, \\mathbf{C}_{13}, \\mathbf{C}_{14}, \\mathbf{C}_{23}, \\mathbf{C}_{24}, \\mathbf{C}_{34}\\}$. The matrix of dot products $\\mathbf{v}_i \\cdot \\mathbf{v}_j$ is:\n$$\n\\begin{pmatrix}\n2 & -1 & -1 & 1 & 1 & 0 \\\\\n-1 & 2 & -1 & -1 & 0 & 1 \\\\\n-1 & -1 & 2 & 0 & -1 & -1 \\\\\n1 & -1 & 0 & 1 & 0 & 0 \\\\\n1 & 0 & -1 & 0 & 1 & 0 \\\\\n0 & 1 & -1 & 0 & 0 & 1\n\\end{pmatrix}\n$$\n\n1) The element stiffness matrix $\\mathbf{K}_e$ is $\\frac{2}{3\\mu}$ times this matrix:\n$$\n\\mathbf{K}_{e} = \\frac{2}{3\\mu}\n\\begin{pmatrix}\n2 & -1 & -1 & 1 & 1 & 0 \\\\\n-1 & 2 & -1 & -1 & 0 & 1 \\\\\n-1 & -1 & 2 & 0 & -1 & -1 \\\\\n1 & -1 & 0 & 1 & 0 & 0 \\\\\n1 & 0 & -1 & 0 & 1 & 0 \\\\\n0 & 1 & -1 & 0 & 0 & 1\n\\end{pmatrix} = \\frac{1}{3\\mu} \\begin{pmatrix}\n4 & -2 & -2 & 2 & 2 & 0 \\\\\n-2 & 4 & -2 & -2 & 0 & 2 \\\\\n-2 & -2 & 4 & 0 & -2 & -2 \\\\\n2 & -2 & 0 & 2 & 0 & 0 \\\\\n2 & 0 & -2 & 0 & 2 & 0 \\\\\n0 & 2 & -2 & 0 & 0 & 2\n\\end{pmatrix}\n$$\n\n2) The mapping from local to global degrees of freedom (DOF) is determined.\nLocal DOFs are ordered by edges: $1 \\to (1,2)$, $2 \\to (1,3)$, $3 \\to (1,4)$, $4 \\to (2,3)$, $5 \\to (2,4)$, $6 \\to (3,4)$.\nLocal orientation for edge $(a,b)$ with $a < b$ is from $a$ to $b$.\nGlobal DOFs are given by the mapping: $(1,2) \\mapsto 4, (1,3) \\mapsto 7, (1,4) \\mapsto 9, (2,3) \\mapsto 8, (2,4) \\mapsto 11, (3,4) \\mapsto 12$.\nGlobal orientation is also from lower- to higher-numbered vertices.\nSince local and global orientations match for all edges, the orientation sign is $+1$ for all DOFs. The mapping is as follows:\n- Local DOF 1 (edge $(1,2)$) maps to Global DOF $4$ with sign $+1$.\n- Local DOF 2 (edge $(1,3)$) maps to Global DOF $7$ with sign $+1$.\n- Local DOF 3 (edge $(1,4)$) maps to Global DOF $9$ with sign $+1$.\n- Local DOF 4 (edge $(2,3)$) maps to Global DOF $8$ with sign $+1$.\n- Local DOF 5 (edge $(2,4)$) maps to Global DOF $11$ with sign $+1$.\n- Local DOF 6 (edge $(3,4)$) maps to Global DOF $12$ with sign $+1$.\n\nFinally, we calculate the scalar quantity $S = \\mu \\, \\mathrm{tr}(\\mathbf{K}_e)$. This is the trace of the matrix $\\mu \\mathbf{K}_e$.\n$$\n\\mu \\mathbf{K}_e = \\frac{2}{3}\n\\begin{pmatrix}\n2 & -1 & -1 & 1 & 1 & 0 \\\\\n-1 & 2 & -1 & -1 & 0 & 1 \\\\\n-1 & -1 & 2 & 0 & -1 & -1 \\\\\n1 & -1 & 0 & 1 & 0 & 0 \\\\\n1 & 0 & -1 & 0 & 1 & 0 \\\\\n0 & 1 & -1 & 0 & 0 & 1\n\\end{pmatrix}\n$$\nThe trace is the sum of the diagonal elements:\n$$\nS = \\mathrm{tr}(\\mu \\mathbf{K}_e) = \\frac{2}{3} (2 + 2 + 2 + 1 + 1 + 1) = \\frac{2}{3} (9) = 6\n$$\nThe problem is set on a reference element with dimensionless coordinates, rendering the calculated value $S$ dimensionless, as stated in the problem description.", "answer": "$$\\boxed{6}$$", "id": "2553591"}, {"introduction": "A successful finite element simulation hinges on choosing a discrete function space that correctly captures the underlying physics, such as the continuity of normal fluxes across element boundaries. When a non-conforming space is selected, it can introduce non-physical artifacts like spurious sources, violating local conservation laws and compromising the solution's validity. This exercise introduces the \"patch test,\" a fundamental diagnostic tool used to verify a formulation's correctness by testing its ability to reproduce simple, exact solutions and detect such critical failures [@problem_id:2553554].", "problem": "Consider a homogeneous, isotropic material with constant permittivity $\\varepsilon$ occupying a polygonal domain $\\Omega \\subset \\mathbb{R}^2$. In electrostatics the governing laws are Gauss’s law $\\nabla \\cdot \\mathbf{D} = \\rho_f$ with $\\mathbf{D} = \\varepsilon \\mathbf{E}$ and $\\mathbf{E} = - \\nabla \\phi$, where $\\rho_f$ is the free charge density and $\\phi$ is the electric potential. In magnetostatics the relevant solenoidal constraint is $\\nabla \\cdot \\mathbf{B} = 0$ with $\\mathbf{B} = \\mu \\mathbf{H}$ and $\\nabla \\times \\mathbf{H} = \\mathbf{J}$. For a charge-free electrostatic case, $\\rho_f = 0$ implies that any physically admissible flux density must satisfy $\\nabla \\cdot \\mathbf{D} = 0$ and, by the divergence theorem, the net outward flux through the boundary $\\partial P$ of any subdomain $P \\subset \\Omega$ must vanish, i.e., $\\int_{\\partial P} \\mathbf{D} \\cdot \\mathbf{n} \\, \\mathrm{d}s = 0$, where $\\mathbf{n}$ is the outward unit normal.\n\nA common failure mode in finite element method (FEM) discretizations arises when a nonconforming vector field space is used for a flux-like unknown (e.g., approximating $\\mathbf{D}$ or $\\mathbf{B}$ with a component-wise continuous Lagrange space), which does not enforce the continuity of the normal component across interelement boundaries. Such nonconformity can introduce spurious sources, observed as nonzero net flux across the boundary of a small patch of elements even when the exact physics requires zero.\n\nYou are asked to design a minimal, diagnostic “patch test” that reliably detects such spurious divergence caused by nonconforming spaces. You may assume a simplicial mesh and that a “patch” is the union of $2$ triangles forming a parallelogram-like quadrilateral. Your test must be grounded in the fundamental field laws and must specify the boundary data, the manufactured exact behavior being probed, the measurement to be computed from the discrete solution, and the criterion to declare pass or fail. Which of the following patch-test designs correctly detects violations of local charge (or flux) conservation introduced by a nonconforming space?\n\nA. Electrostatics, charge-free case. Prescribe Dirichlet data $\\phi = x$ on $\\partial \\Omega$, solve using a vector-field formulation with the electric flux density $\\mathbf{D}_h$ approximated in the component-wise continuous polynomial space $[P_1]^2$ on triangles (i.e., $\\mathbf{D}_h \\in [C^0]^2$ but not $H(\\mathrm{div})$-conforming). For the $2$-triangle patch $P$, compute the net outward flux $\\int_{\\partial P} \\mathbf{D}_h \\cdot \\mathbf{n} \\, \\mathrm{d}s$. Declare failure if this quantity does not approach $0$ under mesh refinement, since the exact solution has uniform $\\mathbf{E}$ and hence $\\nabla \\cdot \\mathbf{D} = 0$.\n\nB. Electrostatics, charge-free case. Prescribe Dirichlet data $\\phi = x$ on $\\partial \\Omega$, solve in any formulation, and for the $2$-triangle patch $P$ compute the line integral of the tangential component $\\int_{\\partial P} \\mathbf{E}_h \\cdot \\mathbf{t} \\, \\mathrm{d}s$. Declare failure if this integral is nonzero, since a nonzero tangential circulation indicates spurious charge creation on interelement faces.\n\nC. Magnetostatics, current-free case. Use the magnetic vector potential formulation with scalar potential $A_z$ in $H^1(\\Omega)$ so that $\\mathbf{B}_h = \\nabla \\times (A_{z,h} \\mathbf{e}_z)$. For the $2$-triangle patch $P$, compute $\\int_{\\partial P} \\mathbf{B}_h \\cdot \\mathbf{n} \\, \\mathrm{d}s$. Declare failure if this integral is nonzero, since $A_{z,h} \\in H^1$ is not $H(\\mathrm{div})$-conforming for $\\mathbf{B}_h$.\n\nD. Electrostatics, charge-free case. Prescribe Dirichlet data $\\phi = x$ on $\\partial \\Omega$, solve with any discrete space for $\\mathbf{D}_h$, and for each element $K$ in the $2$-triangle patch compute the elementwise divergence integral $\\int_{K} \\nabla \\cdot \\mathbf{D}_h \\, \\mathrm{d}\\Omega$. Declare success if each element integral is approximately zero, since this proves there is no spurious charge anywhere in the patch.\n\nSelect the correct option.", "solution": "The problem statement must first be validated for its scientific and logical integrity.\n\n**Step 1: Extract Givens**\n- **Material**: Homogeneous, isotropic, constant permittivity $\\varepsilon$.\n- **Domain**: Polygonal domain $\\Omega \\subset \\mathbb{R}^2$.\n- **Electrostatics Laws**: $\\nabla \\cdot \\mathbf{D} = \\rho_f$, $\\mathbf{D} = \\varepsilon \\mathbf{E}$, $\\mathbf{E} = - \\nabla \\phi$.\n- **Magnetostatics Laws**: $\\nabla \\cdot \\mathbf{B} = 0$, $\\mathbf{B} = \\mu \\mathbf{H}$, $\\nabla \\times \\mathbf{H} = \\mathbf{J}$.\n- **Charge-Free Condition**: For $\\rho_f = 0$, $\\nabla \\cdot \\mathbf{D} = 0$. By the divergence theorem, for any subdomain $P \\subset \\Omega$, $\\int_{\\partial P} \\mathbf{D} \\cdot \\mathbf{n} \\, \\mathrm{d}s = 0$.\n- **FEM Failure Mode**: Using a nonconforming vector field space for a flux unknown (e.g., $\\mathbf{D}$ or $\\mathbf{B}$), such as a component-wise continuous Lagrange space, does not enforce normal component continuity across elements. This may introduce spurious sources, quantified by a nonzero net flux $\\int_{\\partial P} \\mathbf{D}_h \\cdot \\mathbf{n} \\, \\mathrm{d}s \\neq 0$ for a patch of elements $P$.\n- **Task**: Design a minimal \"patch test\" to detect these spurious sources. The patch $P$ is the union of $2$ triangles. The test must specify boundary data, the manufactured exact behavior, the measurement, and the pass/fail criterion.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem statement is scientifically grounded in Maxwell's equations and the theory of the Finite Element Method (FEM). The concepts of function spaces such as $H(\\mathrm{div})$, conforming versus non-conforming approximations, and the patch test are standard and fundamental in computational engineering. The issue described—spurious sources arising from non-$H(\\mathrm{div})$-conforming approximations of divergence-constrained fields—is a well-known phenomenon. The problem is well-posed, objective, and self-contained, providing all necessary context to evaluate the proposed test designs. It is not trivial, as it requires a precise understanding of the mathematical origin of the numerical error.\n\n**Step 3: Verdict and Action**\nThe problem statement is **valid**. Proceeding to the solution.\n\nThe fundamental physical law at the heart of this problem is local charge conservation, which in the charge-free electrostatic case is expressed by $\\nabla \\cdot \\mathbf{D} = 0$. A finite element approximation $\\mathbf{D}_h$ for the electric flux density resides in a suitable function space. For the condition $\\nabla \\cdot \\mathbf{D} = 0$ to be well-approximated, the space for $\\mathbf{D}_h$ should ideally be a subspace of $H(\\mathrm{div}, \\Omega) = \\{ \\mathbf{v} \\in [L^2(\\Omega)]^2 \\mid \\nabla \\cdot \\mathbf{v} \\in L^2(\\Omega) \\}$. Elements in this space have continuous normal components across interelement boundaries.\n\nThe problem states that a non-conforming space is used, for example, the space of continuous piecewise linear vector fields, $[P_1]^2$. While each component of a vector in this space is continuous, the normal component $\\mathbf{D}_h \\cdot \\mathbf{n}$ across an element edge is generally discontinuous. This jump in the normal component, $[[\\mathbf{D}_h \\cdot \\mathbf{n}]]$, acts as a spurious surface charge density on the skeleton of the mesh.\n\nA proper diagnostic test must be able to detect the presence of these spurious charges. By the divergence theorem, the net flux out of a closed boundary is equal to the total charge enclosed. For a patch of elements $P$, the total spurious charge is measured by the net flux integral over its boundary: $\\int_{\\partial P} \\mathbf{D}_h \\cdot \\mathbf{n} \\, \\mathrm{d}s$. If the method is conforming and accurate, this quantity should be close to zero, just as it is for the exact solution. A non-conforming method will, in general, yield a non-zero result for this integral. The test should be based on a simple, known solution to isolate the error of the method. A uniform field is the simplest non-trivial case.\n\nNow, we evaluate each proposed option.\n\n**A. Electrostatics, charge-free case. Prescribe Dirichlet data $\\phi = x$ on $\\partial \\Omega$, solve using a vector-field formulation with the electric flux density $\\mathbf{D}_h$ approximated in the component-wise continuous polynomial space $[P_1]^2$ on triangles (i.e., $\\mathbf{D}_h \\in [C^0]^2$ but not $H(\\mathrm{div})$-conforming). For the $2$-triangle patch $P$, compute the net outward flux $\\int_{\\partial P} \\mathbf{D}_h \\cdot \\mathbf{n} \\, \\mathrm{d}s$. Declare failure if this quantity does not approach $0$ under mesh refinement, since the exact solution has uniform $\\mathbf{E}$ and hence $\\nabla \\cdot \\mathbf{D} = 0$.**\n\nThis test design is correct and robust.\n1.  **Manufactured Solution**: Prescribing $\\phi = x$ on the boundary $\\partial \\Omega$ manufactures an exact solution with potential $\\phi(x,y) = x$ throughout $\\Omega$. This corresponds to a uniform electric field $\\mathbf{E} = -\\nabla \\phi = (-1, 0)$ and a uniform flux density $\\mathbf{D} = \\varepsilon\\mathbf{E} = (-\\varepsilon, 0)$. This exact field is divergence-free, $\\nabla \\cdot \\mathbf{D} = 0$, so for any patch $P$, the exact flux is $\\int_{\\partial P} \\mathbf{D} \\cdot \\mathbf{n} \\, \\mathrm{d}s = 0$.\n2.  **FEM Space**: It correctly identifies $[P_1]^2$ (or more generally $[C^0]^2$) as a non-$H(\\mathrm{div})$-conforming space.\n3.  **Measurement**: The measurement is $\\int_{\\partial P} \\mathbf{D}_h \\cdot \\mathbf{n} \\, \\mathrm{d}s$. As established, this integral precisely measures the net spurious charge contained within the patch $P$, which arises from the non-zero jumps of the normal component of $\\mathbf{D}_h$ on the interior edge(s) of the patch.\n4.  **Criterion**: Declaring failure if this quantity is significantly different from $0$ (or does not converge to $0$ as expected) is the correct way to diagnose the violation of local charge conservation.\nThis option directly and correctly targets the failure mode described in the problem statement.\n\nVerdict: **Correct**.\n\n**B. Electrostatics, charge-free case. Prescribe Dirichlet data $\\phi = x$ on $\\partial \\Omega$, solve in any formulation, and for the $2$-triangle patch $P$ compute the line integral of the tangential component $\\int_{\\partial P} \\mathbf{E}_h \\cdot \\mathbf{t} \\, \\mathrm{d}s$. Declare failure if this integral is nonzero, since a nonzero tangential circulation indicates spurious charge creation on interelement faces.**\n\nThis test is incorrect. The integral $\\int_{\\partial P} \\mathbf{E}_h \\cdot \\mathbf{t} \\, \\mathrm{d}s$ represents the circulation of the electric field around the boundary of the patch. In electrostatics, the electric field is conservative, meaning $\\mathbf{E} = -\\nabla\\phi$, which implies its curl is zero: $\\nabla \\times \\mathbf{E} = 0$. By Stokes' theorem, the circulation around any closed loop is zero. A non-zero circulation would indicate a violation of $\\nabla \\times \\mathbf{E} = 0$, i.e., the presence of spurious curl, not spurious divergence (charge). Furthermore, the justification that non-zero circulation indicates \"spurious charge creation\" is physically incorrect. Circulation of $\\mathbf{E}$ is related to a changing magnetic field (Faraday's law), not static charges. This test diagnoses a different type of error, one relevant to $H(\\mathrm{curl})$-conformity, not $H(\\mathrm{div})$-conformity.\n\nVerdict: **Incorrect**.\n\n**C. Magnetostatics, current-free case. Use the magnetic vector potential formulation with scalar potential $A_z$ in $H^1(\\Omega)$ so that $\\mathbf{B}_h = \\nabla \\times (A_{z,h} \\mathbf{e}_z)$. For the $2$-triangle patch $P$, compute $\\int_{\\partial P} \\mathbf{B}_h \\cdot \\mathbf{n} \\, \\mathrm{d}s$. Declare failure if this integral is nonzero, since $A_{z,h} \\in H^1$ is not $H(\\mathrm{div})$-conforming for $\\mathbf{B}_h$.**\n\nThis test is ill-conceived because it is guaranteed to pass, making it useless as a diagnostic tool. The fundamental law $\\nabla \\cdot \\mathbf{B} = 0$ is satisfied identically if $\\mathbf{B}$ is defined as the curl of a vector potential $\\mathbf{A}$, since the divergence of a curl is always zero: $\\nabla \\cdot (\\nabla \\times \\mathbf{A}) = 0$. This holds true for the discrete approximation as well: $\\mathbf{B}_h = \\nabla \\times \\mathbf{A}_h$ implies that $\\nabla \\cdot \\mathbf{B}_h = 0$ is satisfied exactly (in the distributional sense). By the divergence theorem, the net flux out of any patch $P$ will therefore be identically zero: $\\int_{\\partial P} \\mathbf{B}_h \\cdot \\mathbf{n} \\, \\mathrm{d}s = \\int_P \\nabla \\cdot \\mathbf{B}_h \\, \\mathrm{d}\\Omega = \\int_P 0 \\, \\mathrm{d}\\Omega = 0$. This formulation, by its very structure, avoids spurious magnetic monopoles (spurious divergence). Therefore, this test cannot fail and cannot detect any error, including the one in question.\n\nVerdict: **Incorrect**.\n\n**D. Electrostatics, charge-free case. Prescribe Dirichlet data $\\phi = x$ on $\\partial \\Omega$, solve with any discrete space for $\\mathbf{D}_h$, and for each element $K$ in the $2$-triangle patch compute the elementwise divergence integral $\\int_{K} \\nabla \\cdot \\mathbf{D}_h \\, \\mathrm{d}\\Omega$. Declare success if each element integral is approximately zero, since this proves there is no spurious charge anywhere in the patch.**\n\nThis test is insufficient. The core of the problem with non-$H(\\mathrm{div})$-conforming spaces lies in the discontinuities of the normal flux component at interelement boundaries, which create spurious *surface* charges. This test only checks for spurious *volumetric* charge within each element. By the divergence theorem, $\\int_K \\nabla \\cdot \\mathbf{D}_h \\, \\mathrm{d}\\Omega = \\int_{\\partial K} \\mathbf{D}_h \\cdot \\mathbf{n} \\, \\mathrm{d}s$. It is possible for some FEM formulations (e.g., mixed methods with piecewise constant test functions for the divergence constraint) to enforce that this integral is zero for every element $K$. However, this only means that the total flux out of each individual element is zero. It does not prevent a large spurious flux from leaving one element across a shared edge and an unrelated flux from entering the adjacent element, thus violating local conservation. The test completely fails to probe the interface condition between elements, which is where the error manifests. Declaring success based on this measurement would lead to a false positive, as the critical error mechanism is not being measured.\n\nVerdict: **Incorrect**.\n\nIn conclusion, only option A correctly formulates a patch test that is sensitive to the specific failure mode of spurious divergence resulting from a non-$H(\\mathrm{div})$-conforming approximation of a flux field.", "answer": "$$\\boxed{A}$$", "id": "2553554"}]}