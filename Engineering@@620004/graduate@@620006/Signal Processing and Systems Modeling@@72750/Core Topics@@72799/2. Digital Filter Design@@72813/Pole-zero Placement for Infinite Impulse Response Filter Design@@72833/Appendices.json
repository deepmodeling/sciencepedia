{"hands_on_practices": [{"introduction": "One of the most powerful intuitive tools in IIR filter design is understanding how pole locations directly control filter characteristics. This exercise guides you through a fundamental derivation to uncover the approximate linear relationship between a resonator's pole radius, $r$, and its 3dB bandwidth, $\\Delta\\omega$. Mastering this approximation allows for rapid, back-of-the-envelope design and analysis of resonant systems. [@problem_id:2891849]", "problem": "Consider a causal, stable, discrete-time Infinite Impulse Response (IIR) second-order resonator with complex-conjugate poles at radius $r \\in (0,1)$ and angle $\\omega_{0} \\in (0,\\pi)$, with transfer function\n$$\nH(z) \\;=\\; \\frac{1}{1 - 2 r \\cos(\\omega_{0}) z^{-1} + r^{2} z^{-2}} \\, .\n$$\nLet $H(e^{j\\omega})$ denote its frequency response on the unit circle. The magnitude-squared response $|H(e^{j\\omega})|^{2}$ exhibits a resonance near $\\omega=\\omega_{0}$. Define the $3\\,\\mathrm{dB}$ bandwidth $\\Delta\\omega$ (in radians per sample) as the full width at half maximum of the peak, i.e., the difference between the two frequencies $\\omega_{\\pm}$ satisfying\n$$\n|H(e^{j\\omega_{\\pm}})|^{2} \\;=\\; \\frac{1}{2}\\,|H(e^{j\\omega_{0}})|^{2} \\, ,\n$$\nwith $\\omega_{+} > \\omega_{0} > \\omega_{-}$, and set $\\Delta\\omega \\triangleq \\omega_{+} - \\omega_{-}$. Assume $r$ is close to $1$ and $\\omega_{0}$ is not too close to $0$ or $\\pi$ so that any factors in $|H(e^{j\\omega})|^{2}$ that are smooth in $\\omega$ around $\\omega_{0}$ can be treated as approximately constant over the narrow resonance. Starting from first principles (the definition of $H(e^{j\\omega})$ and the small-angle approximation for the cosine), derive the leading-order asymptotic expression for $\\Delta\\omega$ as a function of $r$ only. Express your final result as a closed-form analytic expression in radians per sample, retaining only the lowest-order term in $(1-r)$ and discarding all higher-order corrections. Your final answer must be a single analytic expression.", "solution": "The problem requires the derivation of the leading-order asymptotic expression for the $3\\,\\mathrm{dB}$ bandwidth, $\\Delta\\omega$, of a second-order IIR resonator. The analysis will begin from the provided transfer function and proceed by applying stated approximations.\n\nThe transfer function of the resonator is given as:\n$$\nH(z) = \\frac{1}{1 - 2r \\cos(\\omega_{0}) z^{-1} + r^{2} z^{-2}}\n$$\nThis corresponds to a system with a pair of complex-conjugate poles at $p = r e^{j\\omega_0}$ and $p^* = r e^{-j\\omega_0}$. The denominator can be written in factored form as $D(z) = (1 - p z^{-1})(1 - p^* z^{-1})$.\n\nThe frequency response is found by substituting $z = e^{j\\omega}$:\n$$\nH(e^{j\\omega}) = \\frac{1}{(1 - r e^{j\\omega_0} e^{-j\\omega})(1 - r e^{-j\\omega_0} e^{-j\\omega})} = \\frac{1}{(1 - r e^{j(\\omega_0 - \\omega)})(1 - r e^{-j(\\omega_0 + \\omega)})}\n$$\nThe magnitude-squared response, $|H(e^{j\\omega})|^2$, is the reciprocal of the product of the squared magnitudes of the two terms in the denominator:\n$$\n|H(e^{j\\omega})|^2 = \\frac{1}{|1 - r e^{j(\\omega_0 - \\omega)}|^2 |1 - r e^{-j(\\omega_0 + \\omega)}|^2}\n$$\nUsing the identity $|1 - a e^{j\\theta}|^2 = (1 - a\\cos\\theta)^2 + (-a\\sin\\theta)^2 = 1 - 2a\\cos\\theta + a^2$, we obtain the exact expression for the magnitude-squared response:\n$$\n|H(e^{j\\omega})|^2 = \\frac{1}{(1 - 2r\\cos(\\omega - \\omega_0) + r^2)(1 - 2r\\cos(\\omega + \\omega_0) + r^2)}\n$$\nThe resonance peak occurs at $\\omega \\approx \\omega_0$. For $r$ close to $1$, the resonance is sharp, which implies that the bandwidth $\\Delta\\omega$ is small. For frequencies $\\omega$ within this narrow band, the term $(1 - 2r\\cos(\\omega + \\omega_0) + r^2)$ is slowly varying because its argument $\\omega + \\omega_0 \\approx 2\\omega_0$ is not near a minimum or maximum of the cosine function (since $\\omega_0$ is not close to $0$ or $\\pi$). Following the problem's directive, we can approximate this term as a constant by evaluating it at the center of the resonance, $\\omega = \\omega_0$:\n$$\n1 - 2r\\cos(\\omega + \\omega_0) + r^2 \\approx 1 - 2r\\cos(2\\omega_0) + r^2\n$$\nThe response near the resonance is therefore approximated by:\n$$\n|H(e^{j\\omega})|^2 \\approx \\frac{1}{(1 - 2r\\cos(\\omega - \\omega_0) + r^2)(1 - 2r\\cos(2\\omega_0) + r^2)}\n$$\nLet the frequency deviation from the resonance center be $\\delta\\omega = \\omega - \\omega_0$. For $\\omega$ near $\\omega_0$, $\\delta\\omega$ is small. We employ the small-angle approximation for the cosine function, $\\cos(\\delta\\omega) \\approx 1 - \\frac{(\\delta\\omega)^2}{2}$. The rapidly varying term in the denominator becomes:\n$$\n1 - 2r\\cos(\\delta\\omega) + r^2 \\approx 1 - 2r\\left(1 - \\frac{(\\delta\\omega)^2}{2}\\right) + r^2 = 1 - 2r + r^2 + r(\\delta\\omega)^2 = (1-r)^2 + r(\\delta\\omega)^2\n$$\nSubstituting this back into the approximate response gives:\n$$\n|H(e^{j\\omega})|^2 \\approx \\frac{1}{[(1-r)^2 + r(\\delta\\omega)^2](1 - 2r\\cos(2\\omega_0) + r^2)}\n$$\nThe peak magnitude-squared response occurs at $\\omega = \\omega_0$, or $\\delta\\omega = 0$:\n$$\n|H(e^{j\\omega_0})|^2 \\approx \\frac{1}{(1-r)^2 (1 - 2r\\cos(2\\omega_0) + r^2)}\n$$\nThe $3\\,\\mathrm{dB}$ frequencies, $\\omega_{\\pm}$, are defined by the condition $|H(e^{j\\omega_{\\pm}})|^2 = \\frac{1}{2}|H(e^{j\\omega_0})|^2$. Let $\\delta\\omega_{\\pm} = \\omega_{\\pm} - \\omega_0$ be the corresponding deviations. Applying our approximation, we get:\n$$\n\\frac{1}{[(1-r)^2 + r(\\delta\\omega_{\\pm})^2](1 - 2r\\cos(2\\omega_0) + r^2)} = \\frac{1}{2} \\left( \\frac{1}{(1-r)^2 (1 - 2r\\cos(2\\omega_0) + r^2)} \\right)\n$$\nThe slowly varying term $(1 - 2r\\cos(2\\omega_0) + r^2)$ cancels from both sides, yielding a simpler equation for $\\delta\\omega_{\\pm}$:\n$$\n(1-r)^2 + r(\\delta\\omega_{\\pm})^2 = 2(1-r)^2\n$$\n$$\nr(\\delta\\omega_{\\pm})^2 = (1-r)^2\n$$\n$$\n(\\delta\\omega_{\\pm})^2 = \\frac{(1-r)^2}{r} \\implies \\delta\\omega_{\\pm} = \\pm \\frac{1-r}{\\sqrt{r}}\n$$\nThe two half-power frequencies are $\\omega_+ = \\omega_0 + \\frac{1-r}{\\sqrt{r}}$ and $\\omega_- = \\omega_0 - \\frac{1-r}{\\sqrt{r}}$. The $3\\,\\mathrm{dB}$ bandwidth $\\Delta\\omega$ is the difference between these two frequencies:\n$$\n\\Delta\\omega = \\omega_+ - \\omega_- = \\left(\\omega_0 + \\frac{1-r}{\\sqrt{r}}\\right) - \\left(\\omega_0 - \\frac{1-r}{\\sqrt{r}}\\right) = \\frac{2(1-r)}{\\sqrt{r}}\n$$\nFinally, the problem asks for the leading-order asymptotic expression for $r$ close to $1$. As $r \\to 1$, the term $(1-r)$ becomes small. For the lowest-order term in $(1-r)$, we can approximate the term $\\sqrt{r}$ in the denominator by its value at $r=1$, which is $1$.\n$$\n\\Delta\\omega \\approx 2(1-r)\n$$\nThis is the required closed-form analytic expression for the bandwidth, valid for poles very close to the unit circle.", "answer": "$$\n\\boxed{2(1-r)}\n$$", "id": "2891849"}, {"introduction": "While poles create peaks, zeros are used to create nulls, or notches, in the frequency response. This practice explores the design of a second-order notch filter by strategically placing a zero pair near a pole pair. You will derive how the notch depth is determined not just by the poles, but by the precise radius $\\rho$ of the zeros, illustrating a practical trade-off between notch sharpness and numerical stability. [@problem_id:2891873]", "problem": "A second-order Infinite Impulse Response (IIR) notch filter is formed by placing a complex-conjugate pair of zeros at radius $\\rho$ and angle $\\pm \\omega_{0}$ and a complex-conjugate pair of poles at radius $r$ and the same angles $\\pm \\omega_{0}$, with $0\\rho1$ and $0r1$. Let the unnormalized transfer function be\n$$\nH_{0}(z)=\\frac{1-2\\rho \\cos(\\omega_{0}) z^{-1}+\\rho^{2} z^{-2}}{1-2 r \\cos(\\omega_{0}) z^{-1}+r^{2} z^{-2}},\n$$\nand define the implemented section as $H(z)=K\\,H_{0}(z)$, where the scalar $K0$ is chosen so that the direct current (DC) response is unity, that is, $|H(e^{j0})|=1$. Consider the notch centered at $\\omega_{0}=\\pi/2$ (radians).\n\nStarting only from the definitions of the $z$-transform frequency response $H(e^{j\\omega})$ and polynomial factorization into first-order terms corresponding to zeros and poles, derive a closed-form analytic expression for the linear notch depth $D(\\rho,r)$ defined as the magnitude of the frequency response at the notch frequency,\n$$\nD(\\rho,r)\\equiv \\left|H\\!\\left(e^{j\\omega_{0}}\\right)\\right| \\quad \\text{with} \\quad \\omega_{0}=\\frac{\\pi}{2}.\n$$\nYour derivation must explicitly determine $K$ from the unity-DC constraint and then evaluate the magnitude at the notch frequency. Conclude by expressing $D(\\rho,r)$ purely as a function of $\\rho$ and $r$, and explain why $\\rho1$ limits the maximum notch depth. Express the final answer as a single closed-form analytic expression. No numerical rounding is required.", "solution": "The problem statement is scientifically grounded, well-posed, objective, and self-contained. It presents a standard exercise in the analysis of digital Infinite Impulse Response (IIR) filters. All necessary parameters and constraints are provided for a unique analytical solution. Therefore, the problem is valid, and we proceed with the derivation.\n\nThe task is to derive an expression for the notch depth $D(\\rho,r)$ of a specific second-order IIR filter. The derivation will be conducted in three stages: first, determination of the normalization constant $K$; second, evaluation of the frequency response at the notch frequency $\\omega_0$; and third, combination of these results to find $D(\\rho,r)$.\n\nThe problem begins with the unnormalized transfer function $H_0(z)$. The instructions demand starting from the factorization into first-order terms. A complex-conjugate pair of zeros is located at $z = \\rho e^{\\pm j\\omega_0}$, and a pair of poles is at $p = r e^{\\pm j\\omega_0}$. The transfer function is constructed from these poles and zeros as:\n$$\nH_0(z) = \\frac{(1 - \\rho e^{j\\omega_0}z^{-1})(1 - \\rho e^{-j\\omega_0}z^{-1})}{(1 - r e^{j\\omega_0}z^{-1})(1 - r e^{-j\\omega_0}z^{-1})}\n$$\nExpanding the numerator gives $1 - \\rho(e^{j\\omega_0} + e^{-j\\omega_0})z^{-1} + \\rho^2 z^{-2} = 1 - 2\\rho\\cos(\\omega_0)z^{-1} + \\rho^2 z^{-2}$. A similar expansion of the denominator gives $1 - 2r\\cos(\\omega_0)z^{-1} + r^2 z^{-2}$. This confirms the given form of $H_0(z)$.\n\nThe problem specifies the notch frequency $\\omega_0 = \\pi/2$. For this value, $\\cos(\\omega_0) = \\cos(\\pi/2) = 0$. The unnormalized transfer function simplifies to:\n$$\nH_0(z) = \\frac{1 - 2\\rho(0)z^{-1} + \\rho^2 z^{-2}}{1 - 2r(0)z^{-1} + r^2 z^{-2}} = \\frac{1 + \\rho^2 z^{-2}}{1 + r^2 z^{-2}}\n$$\nThe implemented transfer function is $H(z) = K H_0(z)$, where $K$ is a positive scalar constant. $K$ is determined by the condition that the DC response has unity magnitude, i.e., $|H(e^{j0})|=1$. The DC response corresponds to evaluating the z-transform at $z=e^{j0}=1$.\n$$\nH(e^{j0}) = H(1) = K H_0(1) = K \\frac{1 + \\rho^2 (1)^{-2}}{1 + r^2 (1)^{-2}} = K \\frac{1 + \\rho^2}{1 + r^2}\n$$\nThe unity-DC constraint is thus $|H(1)| = 1$. Since $K0$ and the parameters $\\rho$ and $r$ are positive, the term $\\frac{1+\\rho^2}{1+r^2}$ is strictly positive. The absolute value is redundant.\n$$\nK \\frac{1 + \\rho^2}{1 + r^2} = 1\n$$\nFrom this, we solve for the normalization constant $K$:\n$$\nK = \\frac{1 + r^2}{1 + \\rho^2}\n$$\nNow we can write the full transfer function $H(z)$:\n$$\nH(z) = \\left( \\frac{1 + r^2}{1 + \\rho^2} \\right) \\frac{1 + \\rho^2 z^{-2}}{1 + r^2 z^{-2}}\n$$\nNext, we must find the linear notch depth, defined as $D(\\rho,r) \\equiv |H(e^{j\\omega_0})|$. With $\\omega_0 = \\pi/2$, we evaluate the frequency response at $z = e^{j\\pi/2} = j$.\nThe evaluation of $H(z)$ at $z=j$ requires the term $z^{-2}$.\n$$\nz^{-2} = (j)^{-2} = \\frac{1}{j^2} = \\frac{1}{-1} = -1\n$$\nSubstituting $z^{-2} = -1$ into the expression for $H(z)$:\n$$\nH(e^{j\\pi/2}) = H(j) = \\left( \\frac{1 + r^2}{1 + \\rho^2} \\right) \\frac{1 + \\rho^2 (-1)}{1 + r^2 (-1)} = \\left( \\frac{1 + r^2}{1 + \\rho^2} \\right) \\frac{1 - \\rho^2}{1 - r^2}\n$$\nThe notch depth $D(\\rho,r)$ is the magnitude of this complex number. However, the expression is entirely real. The constraints $0  \\rho  1$ and $0  r  1$ ensure that every factor in this expression is positive: $(1+r^2)0$, $(1+\\rho^2)0$, $(1-\\rho^2)0$, and $(1-r^2)0$. Therefore, the magnitude is equal to the expression itself.\n$$\nD(\\rho,r) = \\left|H(e^{j\\pi/2})\\right| = \\left| \\left( \\frac{1 + r^2}{1 + \\rho^2} \\right) \\frac{1 - \\rho^2}{1 - r^2} \\right| = \\frac{(1 + r^2)(1 - \\rho^2)}{(1 + \\rho^2)(1 - r^2)}\n$$\nThis is the final closed-form expression for the notch depth as a function of $\\rho$ and $r$.\n\nFinally, the problem asks why the condition $\\rho  1$ limits the maximum notch depth. A \"deeper\" notch corresponds to a smaller value of the transmission magnitude $D(\\rho,r)$. An ideal, infinitely deep notch would have a transmission of zero at the notch frequency, meaning $D(\\rho,r) = 0$.\nObserving the derived expression for $D(\\rho,r)$, for it to be zero, the numerator $(1+r^2)(1-\\rho^2)$ must be zero. Since $r0$, $(1+r^2)$ is always greater than $1$. Thus, we require:\n$$\n1 - \\rho^2 = 0 \\implies \\rho^2 = 1\n$$\nSince $\\rho  0$ is given, this implies $\\rho=1$. A value of $\\rho=1$ places the filter's zeros directly on the unit circle at $z = e^{\\pm j\\pi/2}$. This is the condition for perfect cancellation and zero transmission at frequency $\\omega_0 = \\pi/2$.\nThe problem, however, imposes the strict inequality $0  \\rho  1$. This constraint forces the zeros to be strictly inside the unit circle. Consequently, the numerator term $(1-\\rho^2)$ is always strictly positive. As all other terms are also positive, the notch depth $D(\\rho,r)$ is always strictly greater than zero. The condition $\\rho1$ thus prevents the achievement of a perfect null, limiting the \"depth\" of the notch. One can approach an infinitesimally small depth by choosing $\\rho$ arbitrarily close to $1$, but a depth of exactly zero is unattainable under this constraint.", "answer": "$$\n\\boxed{\\frac{(1-\\rho^2)(1+r^2)}{(1-r^2)(1+\\rho^2)}}\n$$", "id": "2891873"}, {"introduction": "Analytical methods provide crucial insights, but modern filter design often involves complex, multi-objective trade-offs that are best solved computationally. This hands-on programming challenge moves from pure theory to implementation, tasking you with optimizing a filter's phase and magnitude response simultaneously. By systematically adjusting zero locations, you will navigate the classic engineering trade-off between minimizing passband ripple and maintaining linear phase (constant group delay). [@problem_id:2891877]", "problem": "Design and implement a program that, for each specified infinite impulse response filter configuration, adjusts the placement of a single complex-conjugate zero pair relative to a fixed set of complex-conjugate pole pairs to satisfy an upper bound on group delay variation while minimizing passband magnitude deviation. The program must compute and report the selected zero-pair angle, the resulting worst-case magnitude deviation after optimal constant gain scaling, the achieved group delay variation, and a feasibility indicator.\n\nUse the following fundamental base and well-tested formulas as the starting point.\n\n1. Let the discrete-time infinite impulse response (IIR) transfer function be defined by\n$$\nH(z) \\;=\\; K \\,\\frac{\\prod_{k=1}^{N_z}\\left(1 - z_k z^{-1}\\right)}{\\prod_{\\ell=1}^{N_p}\\left(1 - p_\\ell z^{-1}\\right)},\n$$\nwhere $K$ is a real scalar gain, $\\{z_k\\}$ are zeros, and $\\{p_\\ell\\}$ are poles, with all poles strictly inside the unit circle for causality and stability. Complex-conjugate roots appear in conjugate pairs to ensure real-valued coefficients.\n\n2. The magnitude response on the unit circle $z = e^{j\\omega}$ is\n$$\n\\left|H\\!\\left(e^{j\\omega}\\right)\\right| \\;=\\; |K|\\, \\frac{\\prod_{k=1}^{N_z}\\left|e^{j\\omega} - z_k\\right|}{\\prod_{\\ell=1}^{N_p}\\left|e^{j\\omega} - p_\\ell\\right|}.\n$$\n\n3. The unwrapped phase is $\\phi(\\omega) = \\arg H\\!\\left(e^{j\\omega}\\right)$, and the group delay is defined by\n$$\n\\tau(\\omega) \\;=\\; -\\frac{d\\phi(\\omega)}{d\\omega}.\n$$\nFor a rational $H(z)$ with the above factorization and no extra sample delays, a well-tested closed-form expression for the group delay on the unit circle is\n$$\n\\tau(\\omega) \\;=\\; \\sum_{\\ell=1}^{N_p} \\frac{1 - |p_\\ell|^2}{\\left|e^{j\\omega} - p_\\ell\\right|^2} \\;-\\; \\sum_{k=1}^{N_z} \\frac{1 - |z_k|^2}{\\left|e^{j\\omega} - z_k\\right|^2}.\n$$\n\nProblem setup and design specification:\n\n- For each test case, you are given $N$ complex-conjugate pole pairs specified by polar coordinates $\\{(r_i,\\theta_i)\\}_{i=1}^{N}$ with $0r_i1$ and $\\theta_i \\in (0,\\pi)$, representing poles at $p_i = r_i e^{j\\theta_i}$ and $p_i^\\ast = r_i e^{-j\\theta_i}$, for $i = 1,\\dots,N$.\n\n- You are to place exactly one complex-conjugate zero pair at $z = r_z e^{j\\varphi}$ and $z^\\ast = r_z e^{-j\\varphi}$, where the radius $r_z$ is specified per test case and the angle $\\varphi$ (in radians) is the only design variable to be chosen by your program.\n\n- The passband frequency interval is $[0,\\omega_b]$ (in radians), discretized uniformly into $M$ samples. All angles must be in radians.\n\n- Define the group delay variation over the passband as\n$$\n\\Delta\\tau \\;=\\; \\max_{\\omega\\in[0,\\omega_b]} \\tau(\\omega) \\;-\\; \\min_{\\omega\\in[0,\\omega_b]} \\tau(\\omega).\n$$\n\n- Given an upper bound $\\Delta\\tau_{\\max}$, you must choose $\\varphi$ to satisfy $\\Delta\\tau \\le \\Delta\\tau_{\\max}$ if possible. Among all such feasible $\\varphi$, choose the one that minimizes the worst-case passband magnitude deviation after optimal constant gain scaling.\n\n- Let $A(\\omega) = \\left|H\\!\\left(e^{j\\omega}\\right)\\right|$ for $K=1$. Determine the real scalar $g^\\star$ minimizing the discrete least-squares error to unit gain over the passband samples,\n$$\ng^\\star \\;=\\; \\underset{g\\in\\mathbb{R}}{\\operatorname{argmin}} \\sum_{m=1}^{M} \\left(g\\,A(\\omega_m) - 1\\right)^2,\n$$\nand then define the worst-case passband magnitude deviation as\n$$\n\\delta_{\\infty} \\;=\\; \\max_{m=1,\\dots,M} \\left|\\, g^\\star\\,A(\\omega_m) - 1 \\,\\right|.\n$$\nShow that the minimizing gain is\n$$\ng^\\star \\;=\\; \\frac{\\sum_{m=1}^{M} A(\\omega_m)}{\\sum_{m=1}^{M} A^2(\\omega_m)}.\n$$\n\n- If no $\\varphi$ satisfies the group delay variation bound, declare the problem infeasible for that test case. In that case, choose the $\\varphi$ that minimizes $\\Delta\\tau$ (i.e., yields the smallest possible variation), and still report $\\delta_\\infty$ and the achieved $\\Delta\\tau$ for that $\\varphi$.\n\n- The search for $\\varphi$ must be conducted on a uniform grid over an interval that covers the pole angles, specifically\n$$\n\\varphi \\in [\\min_i \\theta_i - \\delta_\\theta,\\; \\max_i \\theta_i + \\delta_\\theta],\n$$\nwith $\\delta_\\theta = 0.15$ and exactly $N_\\varphi = 721$ uniformly spaced samples across this interval, clipped to the passband so that $\\varphi \\in [0,\\omega_b]$. If the clipped interval has fewer than $2$ distinct points, expand it minimally to include the nearest valid passband endpoint to ensure a well-defined search.\n\n- For each test case, output a list $[\\varphi^\\star, \\delta_\\infty, \\Delta\\tau, \\mathrm{feasible}]$ where $\\varphi^\\star$ is the selected zero angle in radians, $\\delta_\\infty$ and $\\Delta\\tau$ are real-valued floats, and $\\mathrm{feasible}$ is $1$ if $\\Delta\\tau \\le \\Delta\\tau_{\\max}$ was achieved and $0$ otherwise.\n\n- Your program must aggregate the results of all provided test cases into a single line of output as a comma-separated list of the per-case lists enclosed in square brackets, for example: \"[[phi1,mag1,gd1,flag1],[phi2,mag2,gd2,flag2],...]\" with angles in radians and no units printed.\n\nTest suite:\n\nUse radians for all angles. For all cases, compute over a uniform frequency grid of $M$ points in $[0,\\omega_b]$ inclusive.\n\n- Case A (happy path):\n    - Poles: $[(0.92,\\,0.40),\\; (0.86,\\,0.90)]$.\n    - Zero radius: $r_z = 0.95$.\n    - Passband end: $\\omega_b = 1.20$.\n    - Samples: $M = 2048$.\n    - Group delay variation bound: $\\Delta\\tau_{\\max} = 30.0$.\n\n- Case B (tighter bound, more poles):\n    - Poles: $[(0.90,\\,0.35),\\; (0.88,\\,0.75),\\; (0.82,\\,1.05)]$.\n    - Zero radius: $r_z = 0.93$.\n    - Passband end: $\\omega_b = 1.20$.\n    - Samples: $M = 2048$.\n    - Group delay variation bound: $\\Delta\\tau_{\\max} = 22.0$.\n\n- Case C (infeasible bound edge case):\n    - Poles: $[(0.95,\\,0.30),\\; (0.94,\\,0.60)]$.\n    - Zero radius: $r_z = 0.90$.\n    - Passband end: $\\omega_b = 1.00$.\n    - Samples: $M = 2048$.\n    - Group delay variation bound: $\\Delta\\tau_{\\max} = 8.0$.\n\nYour program must implement the above specification precisely and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case reported as a list $[\\varphi^\\star, \\delta_\\infty, \\Delta\\tau, \\mathrm{feasible}]$ in that order. All angles are in radians. No other text should be printed. Numerical values should be printed as decimal floats for the real-valued quantities and integers for the feasibility indicator.", "solution": "The problem has been subjected to rigorous validation and is deemed to be valid. It is a well-posed problem in the domain of digital signal processing, specifically infinite impulse response (IIR) filter design. The given formulas are correct, and the objectives are clearly specified with sufficient data to proceed. The problem constitutes a standard, albeit non-trivial, multi-objective optimization task subject to constraints.\n\nThe solution is approached as a systematic search over the design parameter space to find an optimal configuration according to the specified criteria. The core of the problem is to select the angle $\\varphi$ of a single complex-conjugate zero pair $z = r_z e^{\\pm j\\varphi}$ to balance two competing performance metrics: passband group delay flatness and passband magnitude response flatness.\n\nThe transfer function of the IIR filter for a given set of $N$ pole pairs and one zero pair is given by:\n$$\nH(z) \\;=\\; K \\frac{(1 - r_z e^{j\\varphi} z^{-1})(1 - r_z e^{-j\\varphi} z^{-1})}{\\prod_{i=1}^{N} (1 - r_i e^{j\\theta_i} z^{-1})(1 - r_i e^{-j\\theta_i} z^{-1})}\n$$\nAll poles $\\{p_i, p_i^*\\}$ are within the unit circle ($r_i  1$), ensuring stability and causality. The zeros $\\{z, z^*\\}$ also reside within the unit circle in the provided test cases ($r_z  1$), corresponding to a minimum-phase equalizer section.\n\nThe design process must be executed for each test case by implementing a numerical search algorithm. The sequence of operations is as follows.\n\nFirst, we establish the search space. The frequency axis for analysis, $\\omega$, is discretized into a uniform grid of $M$ points over the passband $[0, \\omega_b]$. The design variable, the zero angle $\\varphi$, is searched over a discrete grid of $N_\\varphi = 721$ points. The search interval for $\\varphi$ is specified as $[\\min_i \\theta_i - \\delta_\\theta, \\max_i \\theta_i + \\delta_\\theta]$ with $\\delta_\\theta = 0.15$, subsequently clipped to the passband $[0, \\omega_b]$. A specific instruction addresses the case where this clipped interval collapses to fewer than two distinct points. This occurs if the un-clipped search interval lies entirely outside one side of the passband. In this event, the problem statement is slightly ambiguous regarding the \"minimal expansion\". A robust and defensible interpretation is to expand the search to the entire passband $[0, \\omega_b]$. This ensures a well-defined search space under all conditions and represents a reasonable fallback when the heuristic of searching near the poles fails. My implementation will adopt this interpretation.\n\nFor each candidate angle $\\varphi$ in its search grid, we evaluate the two primary performance metrics.\n\n1.  **Group Delay Variation ($\\Delta\\tau$)**: The group delay $\\tau(\\omega)$ is calculated using the provided closed-form expression. For a system with complex conjugate pole pairs $\\{r_i e^{\\pm j \\theta_i}\\}$ and a zero pair $\\{r_z e^{\\pm j \\varphi}\\}$, the group delay is the sum of contributions from all poles minus the sum of contributions from all zeros. The contribution from a single root $p = re^{j\\theta}$ is $\\frac{1-r^2}{|e^{j\\omega} - p|^2} = \\frac{1-r^2}{1 - 2r\\cos(\\omega-\\theta) + r^2}$. Thus, the total group delay is:\n    $$\n    \\tau(\\omega; \\varphi) = \\sum_{i=1}^{N} \\left[ \\frac{1-r_i^2}{1-2r_i\\cos(\\omega-\\theta_i)+r_i^2} + \\frac{1-r_i^2}{1-2r_i\\cos(\\omega+\\theta_i)+r_i^2} \\right] - \\left[ \\frac{1-r_z^2}{1-2r_z\\cos(\\omega-\\varphi)+r_z^2} + \\frac{1-r_z^2}{1-2r_z\\cos(\\omega+\\varphi)+r_z^2} \\right]\n    $$\n    This function is evaluated over the discrete frequency grid. The group delay variation is then computed as $\\Delta\\tau(\\varphi) = \\max_{\\omega_m} \\tau(\\omega_m; \\varphi) - \\min_{\\omega_m} \\tau(\\omega_m; \\varphi)$.\n\n2.  **Worst-Case Magnitude Deviation ($\\delta_\\infty$)**: The magnitude response without gain scaling, $A(\\omega; \\varphi) = |H(e^{j\\omega})|_{K=1}$, is computed. Its squared value is:\n    $$\n    A^2(\\omega; \\varphi) = \\frac{[1-2r_z\\cos(\\omega-\\varphi)+r_z^2][1-2r_z\\cos(\\omega+\\varphi)+r_z^2]}{\\prod_{i=1}^{N} \\left( [1-2r_i\\cos(\\omega-\\theta_i)+r_i^2][1-2r_i\\cos(\\omega+\\theta_i)+r_i^2] \\right)}\n    $$\n    The optimal gain $g^\\star$ that minimizes the least-squares error to unity gain is correctly given as:\n    $$\n    g^\\star(\\varphi) = \\frac{\\sum_{m=1}^{M} A(\\omega_m; \\varphi)}{\\sum_{m=1}^{M} A^2(\\omega_m; \\varphi)}\n    $$\n    The worst-case magnitude deviation after applying this optimal scaling is $\\delta_\\infty(\\varphi) = \\max_{m} |g^\\star(\\varphi) A(\\omega_m; \\varphi) - 1|$.\n\nWith these metrics computed for every candidate $\\varphi$, the selection of the optimal angle $\\varphi^\\star$ proceeds according to a two-level criterion.\n\nFirst, we identify the set of \"feasible\" angles, defined as all $\\varphi$ for which the group delay variation meets the specified constraint: $\\Delta\\tau(\\varphi) \\le \\Delta\\tau_{\\max}$.\n\n-   If this set of feasible angles is non-empty, the problem is declared feasible. From this set, we select the angle $\\varphi^\\star$ that minimizes the worst-case magnitude deviation, $\\delta_\\infty(\\varphi)$.\n-   If the set of feasible angles is empty, the problem is declared infeasible. In this case, we revert to the full set of all candidate angles and select the one, $\\varphi^\\star$, that minimizes the group delay variation, $\\Delta\\tau(\\varphi)$, thereby achieving the \"best possible\" flatness.\n\nThe final output for each test case is a list containing the selected angle $\\varphi^\\star$, the corresponding magnitude deviation $\\delta_\\infty(\\varphi^\\star)$, the achieved group delay variation $\\Delta\\tau(\\varphi^\\star)$, and a binary feasibility flag ($1$ for feasible, $0$ for infeasible). The program will process all test cases and aggregate these lists into a single formatted output. The implementation will be written in Python, using the `numpy` library for efficient vectorized numerical computation.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the filter design problem for all specified test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case A: Happy path\n        {\n            \"poles\": [(0.92, 0.40), (0.86, 0.90)],\n            \"r_z\": 0.95,\n            \"omega_b\": 1.20,\n            \"M\": 2048,\n            \"delta_tau_max\": 30.0,\n        },\n        # Case B: Tighter bound, more poles\n        {\n            \"poles\": [(0.90, 0.35), (0.88, 0.75), (0.82, 1.05)],\n            \"r_z\": 0.93,\n            \"omega_b\": 1.20,\n            \"M\": 2048,\n            \"delta_tau_max\": 22.0,\n        },\n        # Case C: Infeasible bound edge case\n        {\n            \"poles\": [(0.95, 0.30), (0.94, 0.60)],\n            \"r_z\": 0.90,\n            \"omega_b\": 1.00,\n            \"M\": 2048,\n            \"delta_tau_max\": 8.0,\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = solve_case(\n            case[\"poles\"],\n            case[\"r_z\"],\n            case[\"omega_b\"],\n            case[\"M\"],\n            case[\"delta_tau_max\"],\n        )\n        all_results.append(result)\n\n    # Format the final output string exactly as specified.\n    # The string representation of a list is already in the correct format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\n\ndef solve_case(poles_r_theta, r_z, omega_b, M, delta_tau_max):\n    \"\"\"\n    Solves the optimization problem for a single filter configuration.\n    \n    Args:\n        poles_r_theta (list of tuples): List of (r, theta) for pole pairs.\n        r_z (float): Radius of the zero pair.\n        omega_b (float): Passband end frequency in radians.\n        M (int): Number of frequency samples.\n        delta_tau_max (float): Upper bound on group delay variation.\n\n    Returns:\n        list: A list containing [phi_star, delta_inf, delta_tau, feasible_flag].\n    \"\"\"\n\n    # --- Setup grids ---\n    omega_grid = np.linspace(0, omega_b, M)\n    \n    pole_thetas = [p[1] for p in poles_r_theta]\n    delta_theta = 0.15\n    N_phi = 721\n\n    phi_min_raw = min(pole_thetas) - delta_theta\n    phi_max_raw = max(pole_thetas) + delta_theta\n\n    phi_min = max(0.0, phi_min_raw)\n    phi_max = min(omega_b, phi_max_raw)\n\n    if phi_min >= phi_max:\n        # Per the solution text, if the search interval collapses, we expand\n        # it to the full passband as a robust recovery mechanism.\n        phi_min, phi_max = 0.0, omega_b\n    \n    phi_grid = np.linspace(phi_min, phi_max, N_phi)\n\n    # --- Pre-calculate pole contributions ---\n    def group_delay_term(r, theta, omega):\n        # Contribution of a single root at r*exp(j*theta) to group delay\n        return (1 - r**2) / (1 - 2 * r * np.cos(omega - theta) + r**2)\n\n    def mag_sq_term(r, theta, omega):\n        # Contribution of a single root at r*exp(j*theta) to magnitude squared\n        return 1 - 2 * r * np.cos(omega - theta) + r**2\n\n    pole_tau_contrib = np.zeros_like(omega_grid)\n    pole_mag_sq_contrib_inv = np.ones_like(omega_grid)\n\n    for r_p, theta_p in poles_r_theta:\n        pole_tau_contrib += group_delay_term(r_p, theta_p, omega_grid)\n        pole_tau_contrib += group_delay_term(r_p, -theta_p, omega_grid)\n        pole_mag_sq_contrib_inv /= mag_sq_term(r_p, theta_p, omega_grid)\n        pole_mag_sq_contrib_inv /= mag_sq_term(r_p, -theta_p, omega_grid)\n\n    # --- Iterate over candidate zero angles ---\n    candidate_results = []\n    for phi in phi_grid:\n        # Calculate zero contributions\n        zero_tau_contrib = group_delay_term(r_z, phi, omega_grid) + \\\n                           group_delay_term(r_z, -phi, omega_grid)\n        \n        zero_mag_sq_contrib = mag_sq_term(r_z, phi, omega_grid) * \\\n                              mag_sq_term(r_z, -phi, omega_grid)\n\n        # Total group delay for this phi\n        tau = pole_tau_contrib - zero_tau_contrib\n        delta_tau = np.max(tau) - np.min(tau)\n\n        # Total magnitude response for this phi (K=1)\n        A_sq = zero_mag_sq_contrib * pole_mag_sq_contrib_inv\n        A = np.sqrt(A_sq)\n\n        # Optimal gain and magnitude deviation\n        g_star = np.sum(A) / np.sum(A**2)\n        delta_inf = np.max(np.abs(g_star * A - 1))\n        \n        candidate_results.append((phi, delta_inf, delta_tau))\n\n    # --- Select optimal phi based on criteria ---\n    feasible_candidates = [res for res in candidate_results if res[2] = delta_tau_max]\n\n    if feasible_candidates:\n        # Feasible case: minimize magnitude deviation\n        best_res = min(feasible_candidates, key=lambda x: x[1])\n        feasible_flag = 1\n    else:\n        # Infeasible case: minimize group delay variation\n        best_res = min(candidate_results, key=lambda x: x[2])\n        feasible_flag = 0\n\n    phi_star, delta_inf_star, delta_tau_star = best_res\n    \n    return [phi_star, delta_inf_star, delta_tau_star, feasible_flag]\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2891877"}]}