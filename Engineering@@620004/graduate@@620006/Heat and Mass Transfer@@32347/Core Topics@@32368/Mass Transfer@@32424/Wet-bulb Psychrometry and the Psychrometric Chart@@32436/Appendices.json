{"hands_on_practices": [{"introduction": "Measuring air moisture content at sub-freezing temperatures presents a unique challenge rooted in the thermodynamics of phase equilibrium. While ice is the stable condensed phase below the triple point, liquid water can exist in a metastable, supercooled state, each with a different saturation vapor pressure. This practice [@problem_id:2538516] delves into the critical distinction between the dew-point and frost-point temperatures, guiding you to apply the Clausius–Clapeyron relation to understand the significant impact this has on the accurate assessment of relative humidity.", "problem": "A laboratory is calibrating two chilled-mirror hygrometers for use in a cold-room where the moist air is at subfreezing dry-bulb temperatures. In one mode, the mirror is kept just above the melting point so that the first condensate is liquid; in the other, the mirror is kept below the freezing point so that the first condensate is solid ice. The instrument can be configured to report the temperature at the onset of condensation, and the team must decide how to interpret and use these readings in calculations and on a psychrometric chart below the freezing point.\n\nStarting from the definition of phase equilibrium as equality of chemical potentials, the saturation condition for the vapor in equilibrium with a condensed phase $\\alpha\\in\\{\\text{liquid water},\\ \\text{ice}\\}$ at temperature $T$ can be written as a saturation vapor pressure $p_{\\mathrm{sat}}^{(\\alpha)}(T)$ that satisfies the Clausius–Clapeyron relation in the ideal-gas vapor limit. Let $L_{\\mathrm{v}}(T)$ denote the latent heat of vaporization, $L_{\\mathrm{f}}(T)$ the latent heat of fusion, and $L_{\\mathrm{s}}(T)=L_{\\mathrm{v}}(T)+L_{\\mathrm{f}}(T)$ the latent heat of sublimation, and let $R_{\\mathrm{v}}$ be the specific gas constant for water vapor. Assume all latent heats are weak functions of temperature over a narrow subfreezing interval so that they may be treated as approximately constant. Let $T_{\\mathrm{t}}$ denote the triple-point temperature and $p_{\\mathrm{t}}$ the corresponding saturation pressure.\n\nAn air parcel at total pressure $p$ contains water vapor at partial pressure $p_{\\mathrm{v}}$ such that it is subsaturated at its dry-bulb temperature $T_{\\mathrm{db}}<0^{\\circ}\\mathrm{C}$. The laboratory wishes to understand which saturation curve, $p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ or $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$, must be used to interpret the temperature at which condensation first appears on the mirror, and what quantitative impact that choice has on the assessment of Relative Humidity (RH), defined as $\\phi=p_{\\mathrm{v}}/p_{\\mathrm{sat}}^{(\\cdot)}(T)$, and on the humidity ratio $w=0.622\\,p_{\\mathrm{v}}/(p-p_{\\mathrm{v}})$, when $T<0^{\\circ}\\mathrm{C}$.\n\nWhich one of the following statements is correct?\n\nA. The dew-point temperature $T_{\\mathrm{dp}}$ is defined by $p_{\\mathrm{v}}=p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{dp}})$ and the frost-point temperature $T_{\\mathrm{fp}}$ is defined by $p_{\\mathrm{v}}=p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{fp}})$. For $T<0^{\\circ}\\mathrm{C}$, one must use $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$ if the first condensate is ice and $p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ if it is liquid. Because $L_{\\mathrm{s}}>L_{\\mathrm{v}}$, it follows from Clausius–Clapeyron that $p_{\\mathrm{sat}}^{(\\text{ice})}(T)<p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ for $T<T_{\\mathrm{t}}$, hence at a given $p_{\\mathrm{v}}$ one has $T_{\\mathrm{fp}}>T_{\\mathrm{dp}}$ and $\\phi$ computed with $p_{\\mathrm{sat}}^{(\\text{ice})}$ exceeds $\\phi$ computed with $p_{\\mathrm{sat}}^{(\\text{liquid})}$. Using the liquid-water saturation curve below $0^{\\circ}\\mathrm{C}$ therefore underestimates $\\phi$ and exaggerates apparent dryness; psychrometric charts intended for subfreezing air should place the $100\\%$ line on $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$. The humidity ratio $w$ depends only on $p_{\\mathrm{v}}$ and $p$, but will be biased if $p_{\\mathrm{v}}$ is inferred from a misinterpreted dew/frost point.\n\nB. The dew-point temperature $T_{\\mathrm{dp}}$ equals the frost-point temperature $T_{\\mathrm{fp}}$ for any $T<0^{\\circ}\\mathrm{C}$ because both are saturation states, so either $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$ or $p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ may be used with negligible difference in $\\phi$, and subfreezing psychrometric charts may continue to use the liquid-water saturation curve without consequence.\n\nC. The dew-point temperature $T_{\\mathrm{dp}}$ is defined by $p_{\\mathrm{v}}=p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{dp}})$ and the frost-point temperature $T_{\\mathrm{fp}}$ is defined by $p_{\\mathrm{v}}=p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{fp}})$. Because $L_{\\mathrm{s}}>L_{\\mathrm{v}}$, one has $p_{\\mathrm{sat}}^{(\\text{ice})}(T)>p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ for $T<T_{\\mathrm{t}}$, so at a given $p_{\\mathrm{v}}$ one has $T_{\\mathrm{fp}}<T_{\\mathrm{dp}}$ and using the ice curve below $0^{\\circ}\\mathrm{C}$ would underestimate $\\phi$.\n\nD. Regardless of the condensate phase, one should always use $p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ because liquid water is the thermodynamically stable condensed phase at the triple point, and the smaller latent heat $L_{\\mathrm{v}}$ ensures smaller errors; using $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$ below $0^{\\circ}\\mathrm{C}$ would artificially inflate $\\phi$ and reduce the inferred humidity ratio $w$ at a given $p$.", "solution": "The problem statement must first be validated for its scientific and logical integrity.\n\n### Step 1: Extract Givens\n- A system of moist air is considered at subfreezing dry-bulb temperatures, $T_{\\mathrm{db}}<0^{\\circ}\\mathrm{C}$.\n- A chilled-mirror hygrometer measures the temperature at which condensation (liquid or solid) first appears.\n- Phase equilibrium between vapor and a condensed phase $\\alpha\\in\\{\\text{liquid water},\\ \\text{ice}\\}$ is governed by the saturation vapor pressure $p_{\\mathrm{sat}}^{(\\alpha)}(T)$.\n- The Clausius–Clapeyron relation is applicable in the ideal-gas vapor limit.\n- $L_{\\mathrm{v}}(T)$ is the latent heat of vaporization.\n- $L_{\\mathrm{f}}(T)$ is the latent heat of fusion.\n- $L_{\\mathrm{s}}(T)$ is the latent heat of sublimation, with the relation $L_{\\mathrm{s}}(T)=L_{\\mathrm{v}}(T)+L_{\\mathrm{f}}(T)$.\n- $R_{\\mathrm{v}}$ is the specific gas constant for water vapor.\n- The latent heats are assumed to be approximately constant over the relevant temperature range.\n- $T_{\\mathrm{t}}$ and $p_{\\mathrm{t}}$ are the temperature and pressure at the triple point of water.\n- The air parcel has a total pressure $p$ and a partial pressure of water vapor $p_{\\mathrm{v}}$, and is initially subsaturated.\n- Relative Humidity (RH) is defined as $\\phi=p_{\\mathrm{v}}/p_{\\mathrm{sat}}^{(\\cdot)}(T)$.\n- Humidity ratio is defined as $w=0.622\\,p_{\\mathrm{v}}/(p-p_{\\mathrm{v}})$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in fundamental thermodynamics, specifically the principles of phase equilibrium and the Clausius-Clapeyron relation. The setup is self-contained and provides the necessary physical laws and definitions to proceed. The concept of supercooled liquid water and its higher vapor pressure compared to ice at the same subfreezing temperature is a well-established physical phenomenon. The problem is well-posed, objective, and asks for a deduction based on the provided principles. It does not violate any of the criteria for invalidity.\n\n### Step 3: Verdict and Action\nThe problem is valid. A rigorous solution can be derived.\n\n### Derivation from First Principles\n\nThe Clausius–Clapeyron relation describes the slope of a phase-equilibrium line on a pressure-temperature ($p$-$T$) diagram. For a transition from a condensed phase (liquid or solid) to a gas, the relation is:\n$$\n\\frac{dp_{\\text{sat}}}{dT} = \\frac{L}{T(v_{\\text{gas}} - v_{\\text{condensed}})}\n$$\nwhere $L$ is the latent heat of the transition, $v_{\\text{gas}}$ is the specific volume of the gas phase, and $v_{\\text{condensed}}$ is the specific volume of the condensed phase.\n\nGiven the ideal-gas vapor limit, we have $v_{\\text{gas}} \\gg v_{\\text{condensed}}$, so $v_{\\text{gas}} - v_{\\text{condensed}} \\approx v_{\\text{gas}}$. Using the ideal gas law for water vapor, $p_{\\mathrm{v}} v_{\\text{gas}} = R_{\\mathrm{v}} T$, we can write $v_{\\text{gas}} = R_{\\mathrm{v}}T/p_{\\text{sat}}$ on the saturation curve. Substituting this into the Clausius-Clapeyron equation yields:\n$$\n\\frac{dp_{\\text{sat}}}{dT} = \\frac{L p_{\\text{sat}}}{R_{\\mathrm{v}} T^2} \\quad \\implies \\quad \\frac{d(\\ln p_{\\text{sat}})}{dT} = \\frac{L}{R_{\\mathrm{v}} T^2}\n$$\n\nWe apply this relation to both vapor-liquid and vapor-solid (sublimation) equilibria:\n1.  For equilibrium with liquid water: $\\frac{d(\\ln p_{\\mathrm{sat}}^{(\\text{liquid})})}{dT} = \\frac{L_{\\mathrm{v}}}{R_{\\mathrm{v}} T^2}$\n2.  For equilibrium with ice: $\\frac{d(\\ln p_{\\mathrm{sat}}^{(\\text{ice})})}{dT} = \\frac{L_{\\mathrm{s}}}{R_{\\mathrm{v}} T^2}$\n\nThe problem states that $L_{\\mathrm{s}}(T) = L_{\\mathrm{v}}(T) + L_{\\mathrm{f}}(T)$. Since the latent heat of fusion, $L_{\\mathrm{f}}(T)$, is positive (melting requires energy input), it follows that $L_{\\mathrm{s}}(T) > L_{\\mathrm{v}}(T)$ for any temperature where all three phases can exist.\n\nComparing the two slopes at a given temperature $T$:\n$$\n\\frac{d(\\ln p_{\\mathrm{sat}}^{(\\text{ice})})}{dT} > \\frac{d(\\ln p_{\\mathrm{sat}}^{(\\text{liquid})})}{dT}\n$$\nThis means that the saturation vapor pressure curve for ice is steeper than that for supercooled liquid water on a $\\ln(p)$ vs. $T$ plot.\n\nAt the triple point temperature, $T_{\\mathrm{t}} \\approx 273.16\\,\\text{K}$ or $0.01^{\\circ}\\mathrm{C}$, all three phases (solid, liquid, vapor) coexist in equilibrium. Therefore, their saturation vapor pressures must be equal: $p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{t}}) = p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{t}}) = p_{\\mathrm{t}}$.\n\nFor any temperature $T < T_{\\mathrm{t}}$ (i.e., below the triple point), because the ice curve is steeper and originates from the same point $(T_{\\mathrm{t}}, p_{\\mathrm{t}})$, it must lie below the liquid water curve. Therefore:\n$$\np_{\\mathrm{sat}}^{(\\text{ice})}(T) < p_{\\mathrm{sat}}^{(\\text{liquid})}(T) \\quad \\text{for } T < T_{\\mathrm{t}}\n$$\nThis is a fundamental result: at any subfreezing temperature, the saturation vapor pressure over ice is lower than that over supercooled liquid water. This implies that ice is the thermodynamically stable phase, and supercooled water is metastable.\n\nNow let's examine the consequences for the measured quantities.\n- **Dew point ($T_{\\mathrm{dp}}$) and Frost point ($T_{\\mathrm{fp}}$)**: A chilled-mirror instrument measures the temperature at which the ambient vapor partial pressure $p_{\\mathrm{v}}$ becomes the saturation pressure.\n  - If liquid condensation occurs, the measured temperature is the dew point, $T_{\\mathrm{dp}}$, defined by $p_{\\mathrm{v}} = p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{dp}})$.\n  - If ice condensation (frost) occurs, the measured temperature is the frost point, $T_{\\mathrm{fp}}$, defined by $p_{\\mathrm{v}} = p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{fp}})$.\n  - For a given air parcel with a fixed $p_{\\mathrm{v}}$, we have $p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{fp}}) = p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{dp}})$.\n  We know that for any temperature $T'$, $p_{\\mathrm{sat}}^{(\\text{ice})}(T') < p_{\\mathrm{sat}}^{(\\text{liquid})}(T')$. Let's set $T' = T_{\\mathrm{fp}}$: $p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{fp}}) < p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{fp}})$. Substituting the equality for $p_{\\mathrm{v}}$, we get $p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{dp}}) < p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{fp}})$. Since $p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ is a monotonically increasing function of $T$, this inequality implies that $T_{\\mathrm{dp}} < T_{\\mathrm{fp}}$.\n\n- **Relative Humidity ($\\phi$)**: At a given dry-bulb temperature $T_{\\mathrm{db}} < T_{\\mathrm{t}}$, RH can be defined with respect to liquid or ice.\n  - $\\phi_{\\text{liquid}} = \\frac{p_{\\mathrm{v}}}{p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{db}})}$\n  - $\\phi_{\\text{ice}} = \\frac{p_{\\mathrm{v}}}{p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{db}})}$\n  Since $p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{db}}) < p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{db}})$, it follows that for the same $p_{\\mathrm{v}}$, $\\phi_{\\text{ice}} > \\phi_{\\text{liquid}}$. Using the liquid-water saturation curve as a reference (e.g., in a standard psychrometric chart extrapolated below $0^{\\circ}\\mathrm{C}$) will underestimate the relative humidity with respect to the stable phase (ice), thus exaggerating the apparent dryness of the air. The $100\\%$ saturation line for subfreezing conditions should correctly be based on $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$.\n\n- **Humidity Ratio ($w$)**: The humidity ratio $w = 0.622\\,p_{\\mathrm{v}}/(p-p_{\\mathrm{v}})$ depends directly on the actual partial pressure of water vapor, $p_{\\mathrm{v}}$. This value is independent of temperature or reference saturation curves. However, if $p_{\\mathrm{v}}$ is not measured directly but is *inferred* from a dew-point or frost-point measurement, misinterpretation will lead to errors. For example, if a frost point $T_{\\mathrm{fp}}$ is measured, but it is incorrectly interpreted as a dew point $T_{\\mathrm{dp}}$, the inferred partial pressure would be $p_{\\mathrm{v, incorrect}} = p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{fp}})$. The correct value is $p_{\\mathrm{v, correct}} = p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{fp}})$. Since $p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{fp}}) > p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{fp}})$, this misinterpretation would lead to an overestimation of $p_{\\mathrm{v}}$ and hence an overestimation of $w$.\n\n### Option-by-Option Analysis\n\n**A.** The dew-point temperature $T_{\\mathrm{dp}}$ is defined by $p_{\\mathrm{v}}=p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{dp}})$ and the frost-point temperature $T_{\\mathrm{fp}}$ is defined by $p_{\\mathrm{v}}=p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{fp}})$. For $T<0^{\\circ}\\mathrm{C}$, one must use $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$ if the first condensate is ice and $p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ if it is liquid. Because $L_{\\mathrm{s}}>L_{\\mathrm{v}}$, it follows from Clausius–Clapeyron that $p_{\\mathrm{sat}}^{(\\text{ice})}(T)<p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ for $T<T_{\\mathrm{t}}$, hence at a given $p_{\\mathrm{v}}$ one has $T_{\\mathrm{fp}}>T_{\\mathrm{dp}}$ and $\\phi$ computed with $p_{\\mathrm{sat}}^{(\\text{ice})}$ exceeds $\\phi$ computed with $p_{\\mathrm{sat}}^{(\\text{liquid})}$. Using the liquid-water saturation curve below $0^{\\circ}\\mathrm{C}$ therefore underestimates $\\phi$ and exaggerates apparent dryness; psychrometric charts intended for subfreezing air should place the $100\\%$ line on $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$. The humidity ratio $w$ depends only on $p_{\\mathrm{v}}$ and $p$, but will be biased if $p_{\\mathrm{v}}$ is inferred from a misinterpreted dew/frost point.\n- **Verdict**: **Correct**. Every statement in this option is consistent with the thermodynamic principles derived above. The definitions are correct, the inequality relation for saturation pressures is correct, the inequality for dew/frost points is correct, the comparison of RH values is correct, and the implications for psychrometric charts and humidity ratio calculations are correct.\n\n**B.** The dew-point temperature $T_{\\mathrm{dp}}$ equals the frost-point temperature $T_{\\mathrm{fp}}$ for any $T<0^{\\circ}\\mathrm{C}$ because both are saturation states, so either $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$ or $p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ may be used with negligible difference in $\\phi$, and subfreezing psychrometric charts may continue to use the liquid-water saturation curve without consequence.\n- **Verdict**: **Incorrect**. This statement contains several errors. First, $T_{\\mathrm{dp}} \\neq T_{\\mathrm{fp}}$; specifically, $T_{\\mathrm{dp}} < T_{\\mathrm{fp}}$. Second, the difference between $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$ and $p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ is not negligible and grows as temperature decreases below freezing, leading to significant differences in $\\phi$. For example, at $-20^{\\circ}\\mathrm{C}$, the difference in saturation pressure is over $20\\%$. Using the liquid curve has significant consequences.\n\n**C.** The dew-point temperature $T_{\\mathrm{dp}}$ is defined by $p_{\\mathrm{v}}=p_{\\mathrm{sat}}^{(\\text{ice})}(T_{\\mathrm{dp}})$ and the frost-point temperature $T_{\\mathrm{fp}}$ is defined by $p_{\\mathrm{v}}=p_{\\mathrm{sat}}^{(\\text{liquid})}(T_{\\mathrm{fp}})$. Because $L_{\\mathrm{s}}>L_{\\mathrm{v}}$, one has $p_{\\mathrm{sat}}^{(\\text{ice})}(T)>p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ for $T<T_{\\mathrm{t}}$, so at a given $p_{\\mathrm{v}}$ one has $T_{\\mathrm{fp}}<T_{\\mathrm{dp}}$ and using the ice curve below $0^{\\circ}\\mathrm{C}$ would underestimate $\\phi$.\n- **Verdict**: **Incorrect**. This option is flawed from the beginning. It incorrectly swaps the definitions of dew point and frost point. It also incorrectly states that $p_{\\mathrm{sat}}^{(\\text{ice})}(T)>p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$; the inequality is reversed. Consequently, all subsequent deductions are also incorrect.\n\n**D.** Regardless of the condensate phase, one should always use $p_{\\mathrm{sat}}^{(\\text{liquid})}(T)$ because liquid water is the thermodynamically stable condensed phase at the triple point, and the smaller latent heat $L_{\\mathrm{v}}$ ensures smaller errors; using $p_{\\mathrm{sat}}^{(\\text{ice})}(T)$ below $0^{\\circ}\\mathrm{C}$ would artificially inflate $\\phi$ and reduce the inferred humidity ratio $w$ at a given $p$.\n- **Verdict**: **Incorrect**. The prescription to always use the liquid water curve is physically wrong; the choice of curve must correspond to the phase of the condensate. The reasoning about the triple point is fallacious; below the triple point, ice is the stable phase, not liquid. The claim about \"smaller errors\" due to smaller latent heat is nonsensical. Using the ice curve does not \"artificially inflate\" $\\phi$; it gives the physically correct RH with respect to the stable phase. The statement that it would reduce the inferred humidity ratio is technically correct for a given measured saturation temperature, but the option's overall premise and reasoning are fundamentally unsound.", "answer": "$$\\boxed{A}$$", "id": "2538516"}, {"introduction": "The wet-bulb psychrometer provides a simple yet powerful method for measuring humidity, but its raw outputs—dry-bulb temperature $T$, wet-bulb temperature $T_w$, and pressure $p$—require a physical model for interpretation. This hands-on exercise [@problem_id:2538505] bridges the gap between measurement and application by tasking you with developing a robust algorithm to compute the humidity ratio $W$ and relative humidity $\\phi$. You will implement the core energy balance equation and further explore the model's robustness by performing a sensitivity analysis with respect to the psychrometric constant $\\gamma$.", "problem": "You are to implement a robust algorithm to compute the humidity ratio and the relative humidity of a moist air stream from dry-bulb and wet-bulb psychrometer measurements under the following assumptions and requirements.\n\nStart from the following physically grounded base:\n- The moist air mixture is modeled as an ideal mixture of a non-condensable gas (dry air) and water vapor at total pressure $p$ (in $\\mathrm{Pa}$). The water vapor partial pressure is denoted $p_v$ (in $\\mathrm{Pa}$).\n- The humidity ratio $W$ (in $\\mathrm{kg_{vapor}/kg_{dry\\_air}}$) is defined by $W = m_v/m_a$ and, under the ideal-gas approximation, relates to $p_v$ by $W = \\varepsilon \\, p_v / (p - p_v)$, where $\\varepsilon = M_v/M_a$ is the molar mass ratio of water vapor to dry air.\n- A ventilated wet-bulb psychrometer operates at steady state such that the convective sensible heat transfer from the bulk air at dry-bulb temperature $T$ (in $\\mathrm{^{\\circ}C}$) to the wetted wick at wet-bulb temperature $T_w$ (in $\\mathrm{^{\\circ}C}$) balances the latent heat required to evaporate water into the stream. Under the Lewis relation near unity and using a prescribed psychrometric constant $\\gamma(p)$ (with units $\\mathrm{Pa/K}$), this balance yields a single scalar relation that couples $T$, $T_w$, $p$, and $p_v$. Your algorithm must derive and solve this scalar relation for $p_v$ and then compute $W$ and the relative humidity $\\phi$.\n- The interfacial vapor at the wetted wick is saturated at $T_w$, and the bulk relative humidity satisfies $\\phi = p_v / p_{ws}(T)$ with $p_{ws}(T)$ the saturation vapor pressure of pure water at temperature $T$.\n\nYou must adopt the following well-tested correlation for the saturation vapor pressure (valid for liquid water for $T \\gtrsim 0\\,\\mathrm{^{\\circ}C}$) expressed in $\\mathrm{Pa}$ as a function of temperature in $\\mathrm{^{\\circ}C}$:\n$$\np_{ws}(T) = 611.21 \\,\\exp\\!\\left(\\left(18.678 - \\frac{T}{234.5}\\right)\\frac{T}{257.14 + T}\\right).\n$$\n\nUse the molar mass ratio $\\varepsilon = 0.62198$ (dimensionless). For the psychrometric constant, use the baseline function\n$$\n\\gamma_b(p) = \\frac{c_{p,a}\\,p}{\\varepsilon \\, L_{v0}},\n$$\nwith $c_{p,a} = 1006\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$ and $L_{v0} = 2.5\\times 10^{6}\\,\\mathrm{J\\,kg^{-1}}$. The function $\\gamma_b(p)$ returns $\\mathrm{Pa/K}$ when $p$ is provided in $\\mathrm{Pa}$.\n\nAlgorithmic requirements:\n- Formulate and solve the scalar equation implied by the steady heat and mass transfer coupling to recover $p_v$ from the measured triple $(T, T_w, p)$ and the assumed $\\gamma(p)$. Your implementation must enforce the physical bounds $0 \\le p_v \\le \\min\\{p,\\,p_{ws}(T)\\}$.\n- Compute $W$ in $\\mathrm{kg_{vapor}/kg_{dry\\_air}}$ and $\\phi$ as a decimal fraction (dimensionless).\n- Quantify the sensitivity of $W$ and $\\phi$ to the assumed $\\gamma$ at fixed $(T, T_w, p)$ by evaluating the normalized sensitivities\n$$\nS_W \\equiv \\frac{\\gamma}{W}\\,\\frac{\\partial W}{\\partial \\gamma}, \\qquad S_{\\phi} \\equiv \\frac{\\gamma}{\\phi}\\,\\frac{\\partial \\phi}{\\partial \\gamma},\n$$\nevaluated at $\\gamma_b(p)$. You may obtain these by principled differentiation of your governing equation for $p_v$ and the definitions of $W$ and $\\phi$.\n- Numerical robustness: your implementation must be stable for all test cases below, including near-saturation cases where $T \\approx T_w$ and cases with large wet-bulb depression where $T - T_w$ is large. If the implied $p_v$ by your model violates the physical bounds, enforce the bounds and set the corresponding local sensitivity contribution to zero consistently with an active constraint.\n\nUnits and formatting:\n- Input temperatures $T$ and $T_w$ are in $\\mathrm{^{\\circ}C}$, pressure $p$ is in $\\mathrm{Pa}$.\n- Output $W$ in $\\mathrm{kg_{vapor}/kg_{dry\\_air}}$ and $\\phi$ and the sensitivities $S_W$, $S_{\\phi}$ as decimal fractions (dimensionless). Round each reported value to exactly $6$ decimal places.\n\nTest suite:\nProvide results for the following parameter sets $(T, T_w, p)$:\n- Case $1$: $T = 30.0\\,\\mathrm{^{\\circ}C}$, $T_w = 20.0\\,\\mathrm{^{\\circ}C}$, $p = 101325\\,\\mathrm{Pa}$.\n- Case $2$: $T = 25.0\\,\\mathrm{^{\\circ}C}$, $T_w = 24.5\\,\\mathrm{^{\\circ}C}$, $p = 101325\\,\\mathrm{Pa}$.\n- Case $3$: $T = 20.0\\,\\mathrm{^{\\circ}C}$, $T_w = 10.0\\,\\mathrm{^{\\circ}C}$, $p = 80000\\,\\mathrm{Pa}$.\n- Case $4$: $T = 40.0\\,\\mathrm{^{\\circ}C}$, $T_w = 10.0\\,\\mathrm{^{\\circ}C}$, $p = 101325\\,\\mathrm{Pa}$.\n\nRequired final output format:\nYour program should produce a single line of output containing the concatenated results for all test cases as a comma-separated list enclosed in square brackets. For each case, output the four floats in the order $[W, \\phi, S_W, S_{\\phi}]$ with each value rounded to exactly $6$ decimal places. Thus the final line must look like\n[$W_1, \\phi_1, S_{W,1}, S_{\\phi,1}, \\ldots, S_{\\phi,4}$] with no extra text.", "solution": "The problem as stated is scientifically sound, self-contained, and well-posed. It presents a standard problem in psychrometry, grounded in the fundamental principles of heat and mass transfer and thermodynamics. All required constants, correlations, and definitions are provided. The task is to derive and implement a computational model based on these principles. We shall proceed with the solution.\n\nThe core of the problem lies in the steady-state energy balance on the wetted wick of a psychrometer. Convective sensible heat transfer from the warmer bulk air at dry-bulb temperature $T$ to the cooler liquid-vapor interface at the wet-bulb temperature $T_w$ is balanced by the latent heat absorbed during the evaporation of water from the wick into the air stream.\n\nThe sensible heat flux per unit area is given by $q''_{sensible} = h_c (T - T_w)$, where $h_c$ is the convective heat transfer coefficient. The latent heat flux is $q''_{latent} = \\dot{m}''_{v} L_v$, where $\\dot{m}''_{v}$ is the mass flux of evaporated water and $L_v$ is the latent heat of vaporization. The mass flux is driven by the difference in water vapor concentration between the saturated interface and the bulk air, $\\dot{m}''_{v} = h_m (W_{ws}(T_w) - W)$, where $h_m$ is the mass transfer coefficient, $W$ is the humidity ratio of the bulk air, and $W_{ws}(T_w)$ is the humidity ratio of saturated air at the wet-bulb temperature.\n\nThe energy balance is thus $h_c (T - T_w) = h_m L_v (W_{ws}(T_w) - W)$. The Lewis relation, which for the air-water system is approximately unity, states that $\\frac{h_c}{h_m c_p} \\approx 1$. Using the specific heat of moist air, which we approximate as that of dry air, $c_{p,a}$, we obtain $h_c \\approx h_m c_{p,a}$. Substituting this into the balance equation and simplifying yields the psychrometric relation:\n$$\nc_{p,a} (T - T_w) = L_v (W_{ws}(T_w) - W)\n$$\nThis equation is often expressed in terms of pressures. Using the approximate relations $W \\approx \\frac{\\varepsilon}{p} p_v$ and $W_{ws}(T_w) \\approx \\frac{\\varepsilon}{p} p_{ws}(T_w)$, which are valid when the partial pressures of vapor are small compared to the total pressure $p$, and substituting into the balance gives:\n$$\nc_{p,a} (T - T_w) \\approx L_v \\left( \\frac{\\varepsilon}{p} p_{ws}(T_w) - \\frac{\\varepsilon}{p} p_v \\right)\n$$\nRearranging to solve for the unknown partial pressure of water vapor, $p_v$, we find:\n$$\np_v \\approx p_{ws}(T_w) - \\frac{c_{p,a} p}{\\varepsilon L_v} (T - T_w)\n$$\nThe term multiplying the temperature difference is the psychrometric constant, $\\gamma(p)$. The problem provides the expression for this constant, using a reference latent heat $L_{v0}$:\n$$\n\\gamma_b(p) = \\frac{c_{p,a}\\,p}{\\varepsilon \\, L_{v0}}\n$$\nwhere $c_{p,a} = 1006\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$, $L_{v0} = 2.5\\times 10^{6}\\,\\mathrm{J\\,kg^{-1}}$, and the molar mass ratio $\\varepsilon = M_v/M_a = 0.62198$. The temperatures $T$ and $T_w$ are in $^{\\circ}\\mathrm{C}$, but their difference $(T-T_w)$ is numerically identical in Kelvin, matching the units $\\mathrm{Pa/K}$ of $\\gamma$. Thus, the governing equation to be solved for $p_v$ is:\n$$\np_v = p_{ws}(T_w) - \\gamma_b(p) (T - T_w)\n$$\nThe saturation pressure of water vapor, $p_{ws}$, as a function of temperature $T$ in $^{\\circ}\\mathrm{C}$, is given by the correlation:\n$$\np_{ws}(T) = 611.21 \\,\\exp\\!\\left(\\left(18.678 - \\frac{T}{234.5}\\right)\\frac{T}{257.14 + T}\\right)\n$$\nThe calculated $p_v$ must be physically realistic. It cannot be negative, nor can it exceed the total pressure $p$, nor can it imply supersaturation at the dry-bulb temperature $T$. This imposes the bounds $0 \\le p_v \\le \\min\\{p, p_{ws}(T)\\}$. We first calculate an unconstrained value $p_{v,\\text{calc}} = p_{ws}(T_w) - \\gamma_b(p) (T-T_w)$ and then apply the bounds:\n$$\np_v = \\max(0, \\min(p_{v,\\text{calc}}, p, p_{ws}(T)))\n$$\nOnce $p_v$ is determined, the humidity ratio $W$ and relative humidity $\\phi$ are computed from their definitions:\n$$\nW = \\frac{\\varepsilon p_v}{p - p_v} \\quad (\\mathrm{kg_{vapor}/kg_{dry\\_air}})\n$$\n$$\n\\phi = \\frac{p_v}{p_{ws}(T)} \\quad (\\text{dimensionless})\n$$\nThe problem requires the evaluation of normalized sensitivities of $W$ and $\\phi$ to the psychrometric constant $\\gamma = \\gamma_b(p)$, defined as:\n$$\nS_W \\equiv \\frac{\\gamma}{W}\\,\\frac{\\partial W}{\\partial \\gamma}, \\qquad S_{\\phi} \\equiv \\frac{\\gamma}{\\phi}\\,\\frac{\\partial \\phi}{\\partial \\gamma}\n$$\nThese sensitivities quantify the fractional change in the output variable for a fractional change in $\\gamma$. To compute them, we must find the derivatives $\\frac{\\partial W}{\\partial \\gamma}$ and $\\frac{\\partial \\phi}{\\partial \\gamma}$, holding $(T, T_w, p)$ constant. First, we find the derivative of $p_v$ with respect to $\\gamma$:\n$$\n\\frac{\\partial p_v}{\\partial \\gamma} = \\frac{\\partial}{\\partial \\gamma} \\left( p_{ws}(T_w) - \\gamma (T - T_w) \\right) = -(T - T_w)\n$$\nThis derivative is non-zero only if the calculated $p_v$ is not limited by an active physical constraint. If $p_{v,\\text{calc}}$ falls outside the allowed range $[0, \\min\\{p, p_{ws}(T)\\}]$ and is clipped, $p_v$ becomes constant at the boundary value, and its derivative with respect to $\\gamma$ is zero. Therefore:\n$$\n\\frac{\\partial p_v}{\\partial \\gamma} = \\begin{cases} -(T-T_w) & \\text{if } 0 < p_{v,\\text{calc}} < \\min\\{p, p_{ws}(T)\\} \\\\ 0 & \\text{otherwise} \\end{cases}\n$$\nUsing the chain rule, we find the derivatives for $\\phi$ and $W$:\n$$\n\\frac{\\partial \\phi}{\\partial \\gamma} = \\frac{\\partial \\phi}{\\partial p_v} \\frac{\\partial p_v}{\\partial \\gamma} = \\frac{1}{p_{ws}(T)} \\frac{\\partial p_v}{\\partial \\gamma}\n$$\n$$\n\\frac{\\partial W}{\\partial \\gamma} = \\frac{\\partial W}{\\partial p_v} \\frac{\\partial p_v}{\\partial \\gamma} = \\frac{\\varepsilon p}{(p - p_v)^2} \\frac{\\partial p_v}{\\partial \\gamma}\n$$\nSubstituting these into the sensitivity definitions yields:\n$$\nS_{\\phi} = \\frac{\\gamma}{\\phi} \\frac{1}{p_{ws}(T)} \\frac{\\partial p_v}{\\partial \\gamma} = \\frac{\\gamma}{p_v/p_{ws}(T)} \\frac{1}{p_{ws}(T)} \\frac{\\partial p_v}{\\partial \\gamma} = \\frac{\\gamma}{p_v} \\frac{\\partial p_v}{\\partial \\gamma}\n$$\n$$\nS_W = \\frac{\\gamma}{W} \\frac{\\varepsilon p}{(p-p_v)^2} \\frac{\\partial p_v}{\\partial \\gamma} = \\frac{\\gamma}{\\varepsilon p_v/(p-p_v)} \\frac{\\varepsilon p}{(p-p_v)^2} \\frac{\\partial p_v}{\\partial \\gamma} = \\frac{\\gamma p}{p_v(p-p_v)} \\frac{\\partial p_v}{\\partial \\gamma}\n$$\nIf $p_v=0$, the denominators are zero. However, in this case, $p_v$ is at an active constraint, so $\\frac{\\partial p_v}{\\partial \\gamma}=0$, which implies $\\frac{\\partial \\phi}{\\partial \\gamma}=0$ and $\\frac{\\partial W}{\\partial \\gamma}=0$. Consequently, we must define $S_{\\phi}=0$ and $S_W=0$ when $p_v=0$.\n\nThe overall algorithm is as follows:\n1.  For a given set of inputs $(T, T_w, p)$, calculate the required saturation pressures $p_{ws}(T)$ and $p_{ws}(T_w)$.\n2.  Calculate the psychrometric constant $\\gamma_b(p)$.\n3.  Calculate the unconstrained vapor pressure $p_{v,\\text{calc}} = p_{ws}(T_w) - \\gamma_b(p) (T-T_w)$.\n4.  Determine if $p_{v,\\text{calc}}$ is within the physical bounds. If not, set $\\frac{\\partial p_v}{\\partial \\gamma} = 0$; otherwise, set $\\frac{\\partial p_v}{\\partial \\gamma} = -(T-T_w)$.\n5.  Apply the physical bounds to obtain the final $p_v = \\max(0, \\min(p_{v,\\text{calc}}, p, p_{ws}(T)))$.\n6.  If $p_v = 0$, set $W=0$, $\\phi=0$, $S_W=0$, and $S_\\phi=0$.\n7.  Otherwise, calculate $W$ and $\\phi$ using the final $p_v$.\n8.  Calculate the sensitivities $S_W$ and $S_\\phi$ using the value of $\\frac{\\partial p_v}{\\partial \\gamma}$ determined in step 4.\n9.  Report all four resulting quantities, rounded to the specified precision. This procedure is applied to all test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that processes test cases and prints the final result.\n    \"\"\"\n\n    # Define constants based on the problem statement.\n    EPSILON = 0.62198  # Molar mass ratio M_v/M_a (dimensionless)\n    C_PA = 1006.0      # Specific heat of dry air (J/kg/K)\n    L_V0 = 2.5e6       # Latent heat of vaporization of water (J/kg)\n\n    def p_ws(T_celsius):\n        \"\"\"\n        Calculates saturation vapor pressure of water using the provided correlation.\n        Args:\n            T_celsius (float): Temperature in degrees Celsius.\n        Returns:\n            float: Saturation pressure in Pascals.\n        \"\"\"\n        return 611.21 * np.exp((18.678 - T_celsius / 234.5) * (T_celsius / (257.14 + T_celsius)))\n\n    def gamma_b(p_pascal):\n        \"\"\"\n        Calculates the psychrometric constant.\n        Args:\n            p_pascal (float): Total pressure in Pascals.\n        Returns:\n            float: Psychrometric constant in Pa/K.\n        \"\"\"\n        return (C_PA * p_pascal) / (EPSILON * L_V0)\n\n    def calculate_properties(T, T_w, p):\n        \"\"\"\n        Calculates humidity ratio, relative humidity, and their sensitivities.\n        Args:\n            T (float): Dry-bulb temperature in degrees Celsius.\n            T_w (float): Wet-bulb temperature in degrees Celsius.\n            p (float): Total pressure in Pascals.\n        Returns:\n            tuple: A tuple containing (W, phi, S_W, S_phi) rounded to 6 decimal places.\n        \"\"\"\n        # Step 1: Calculate saturation pressures and psychrometric constant\n        p_ws_T = p_ws(T)\n        p_ws_Tw = p_ws(T_w)\n        gamma = gamma_b(p)\n\n        # Step 2: Calculate unconstrained vapor pressure\n        p_v_calc = p_ws_Tw - gamma * (T - T_w)\n\n        # Step 3: Determine if an active constraint exists for sensitivity calculation\n        upper_bound = min(p, p_ws_T)\n        if 0.0 < p_v_calc < upper_bound:\n            dpv_dgamma = -(T - T_w)\n        else:\n            dpv_dgamma = 0.0\n\n        # Step 4: Apply physical bounds to get the final vapor pressure\n        p_v = max(0.0, min(p_v_calc, upper_bound))\n        \n        # Step 5: Handle the special case of perfectly dry air (p_v = 0)\n        if p_v <= 0.0:\n            W, phi, S_W, S_phi = 0.0, 0.0, 0.0, 0.0\n        else:\n            # Step 6: Calculate humidity ratio and relative humidity\n            W = (EPSILON * p_v) / (p - p_v)\n            phi = p_v / p_ws_T\n\n            # Step 7: Calculate sensitivities\n            S_phi = (gamma / p_v) * dpv_dgamma\n            S_W = (gamma * p) / (p_v * (p - p_v)) * dpv_dgamma\n        \n        # Step 8: Round all results to 6 decimal places\n        return (\n            round(W, 6),\n            round(phi, 6),\n            round(S_W, 6),\n            round(S_phi, 6)\n        )\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (30.0, 20.0, 101325.0), # Case 1\n        (25.0, 24.5, 101325.0), # Case 2\n        (20.0, 10.0, 80000.0),  # Case 3\n        (40.0, 10.0, 101325.0), # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        T_case, Tw_case, p_case = case\n        result_tuple = calculate_properties(T_case, Tw_case, p_case)\n        results.extend(map(str, result_tuple))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2538505"}, {"introduction": "Standard psychrometric calculations often rely on simplifying assumptions, such as a constant specific heat for moist air. This advanced practice [@problem_id:2538499] challenges you to implement a more sophisticated model where the psychrometric equation becomes non-linear, as properties like the humid-air specific heat depend on the very humidity ratio $w$ you are trying to find. You will solve this coupled system using a fixed-point iteration scheme, gaining valuable experience in the numerical methods that underpin modern engineering software and analyzing the convergence properties of your algorithm.", "problem": "Consider moist air at total pressure $P$ and dry-bulb temperature $T_d$, in contact with a wetted wick at wet-bulb temperature $T_w$, under the common modeling assumptions of well-mixed ideal gas components, negligible heat storage in the wick, and negligible radiation. Let the water vapor partial pressure be $e$ and the humidity ratio (mass of water vapor per unit mass of dry air) be $w$. Adopt the ideal mixture definition of humidity ratio\n$$\nw \\;=\\; \\frac{\\epsilon\\, e}{P - e},\n$$\nwhere $\\epsilon = 0.62198$ is the ratio of the gas constants of water vapor to dry air. The psychrometric equation consistent with an energy balance on the wetted surface and the definition of the psychrometric constant is modeled here by the $\\gamma$-corrected relation\n$$\ne \\;=\\; e_s(T_w) \\;-\\; \\gamma \\,\\Gamma(w;P,T_w)\\, \\bigl(T_d - T_w\\bigr),\n$$\nwhere $e_s(T)$ is the saturation vapor pressure of water at temperature $T$, and\n$$\n\\Gamma(w;P,T_w) \\;=\\; \\frac{\\bigl(c_{p,a} + w\\, c_{p,v}\\bigr)\\, P}{\\epsilon\\, \\lambda(T_w)}.\n$$\nHere $c_{p,a}$ and $c_{p,v}$ are the (assumed constant) specific heats at constant pressure of dry air and water vapor, respectively, and $\\lambda(T)$ is the latent heat of vaporization of water at temperature $T$. The dimensionless parameter $\\gamma \\ge 0$ scales the psychrometric constant to account for instrument- and ventilation-specific corrections while retaining its dependence on $w$ through the humid-gas heat capacity.\n\nYou will implement a fixed-point iteration to solve for the physically admissible fixed point $w^\\star$ of the mapping\n$$\ng(w) \\;=\\; \\frac{\\epsilon\\, e(w)}{P - e(w)}, \n\\qquad \ne(w) \\;=\\; e_s(T_w) \\;-\\; \\gamma \\,\\Gamma(w;P,T_w)\\, \\bigl(T_d - T_w\\bigr),\n$$\nat given $P, T_d, T_w, \\gamma$. The iteration is $w^{(k+1)} = g\\!\\bigl(w^{(k)}\\bigr)$, initialized at the saturation value at the wet-bulb temperature,\n$$\nw^{(0)} \\;=\\; \\frac{\\epsilon\\, e_s(T_w)}{P - e_s(T_w)}.\n$$\n\nUse the following well-tested empirical correlations and constants, with all quantities expressed in the specified units:\n- Saturation vapor pressure (Magnus-type correlation, valid for $T$ in the range $[0,50]$ in degrees Celsius), in $\\mathrm{kPa}$:\n$$\ne_s(T) \\;=\\; 0.61094 \\,\\exp\\!\\Bigl(\\frac{17.625\\, T}{T + 243.04}\\Bigr).\n$$\n- Latent heat of vaporization in $\\mathrm{kJ\\,kg^{-1}}$:\n$$\n\\lambda(T) \\;=\\; 2501.0 \\;-\\; 2.381\\, T.\n$$\n- Heat capacities in $\\mathrm{kJ\\,kg^{-1}\\,K^{-1}}$:\n$$\nc_{p,a} \\;=\\; 1.006, \n\\qquad\nc_{p,v} \\;=\\; 1.86.\n$$\n\nConvergence analysis. The local contraction factor that governs linear convergence of the fixed-point iteration near $w^\\star$ is the magnitude of $g'(w^\\star)$. You must:\n- Compute $w^\\star$ by fixed-point iteration with tolerance $\\lvert w^{(k+1)} - w^{(k)}\\rvert \\le 10^{-12}$ in $\\mathrm{kg\\,kg^{-1}}$ or after at most $200$ iterations (declare non-convergence otherwise).\n- Report the total iteration count used.\n- Declare convergence as a boolean that is true if and only if the tolerance is met within the iteration limit.\n- Compute the magnitude $\\lvert g'(w^\\star)\\rvert$ analytically by differentiating the expressions above and evaluating at the converged $w^\\star$.\n- Additionally, estimate the observed asymptotic linear rate by\n$$\n\\widehat{\\rho} \\;=\\; \\mathrm{mean}\\left(\\frac{\\lvert w^{(k+1)} - w^\\star\\rvert}{\\lvert w^{(k)} - w^\\star\\rvert}\\right)\n$$\nover the final $5$ available iterations before convergence; if fewer than $5$ iterations occur, average over the available steps; if any denominator is zero, omit that ratio from the mean (and if none remain, report $0$).\n\nPhysical units. Use $P$ in $\\mathrm{kPa}$, $T_d$ and $T_w$ in $\\mathrm{^\\circ C}$, $e$ and $e_s$ in $\\mathrm{kPa}$, and $w$ in $\\mathrm{kg\\,kg^{-1}}$. Express the final humidity ratio $w^\\star$ in $\\mathrm{kg\\,kg^{-1}}$ rounded to $8$ decimal places, the iteration count as an integer, the convergence boolean as true or false, the analytic contraction magnitude $\\lvert g'(w^\\star)\\rvert$ rounded to $6$ decimal places, and the observed rate $\\widehat{\\rho}$ rounded to $6$ decimal places.\n\nTest suite. For each of the following five test cases, compute and report the outputs in the exact order and format specified below:\n1. $P = 101.325$, $T_d = 30.0$, $T_w = 20.0$, $\\gamma = 0.0$.\n2. $P = 101.325$, $T_d = 30.0$, $T_w = 20.0$, $\\gamma = 0.5$.\n3. $P = 101.325$, $T_d = 30.0$, $T_w = 20.0$, $\\gamma = 1.0$.\n4. $P = 101.325$, $T_d = 30.0$, $T_w = 20.0$, $\\gamma = 3.0$.\n5. $P = 80.0$, $T_d = 25.0$, $T_w = 24.0$, $\\gamma = 1.0$.\n\nFinal output format. Your program should produce a single line of output containing a list of five elements, one per test case, where each element is itself a list\n$$\n\\bigl[w^\\star,\\ \\text{iterations},\\ \\text{converged},\\ \\lvert g'(w^\\star)\\rvert,\\ \\widehat{\\rho}\\bigr].\n$$\nFor example, a syntactically correct output would look like\n$$\n\\bigl[[0.01000000,10,True,0.012345,0.012300], \\ \\ldots \\bigr],\n$$\nwith actual numerical values corresponding to the test suite above.", "solution": "The problem requires the numerical solution of a system of psychrometric equations to determine the humidity ratio, $w$, of moist air. The solution is formulated as a fixed-point problem, where we seek a value $w^\\star$ such that $w^\\star = g(w^\\star)$ for a specified function $g(w)$.\n\nThe system is defined by the following coupled equations, with total pressure $P$, dry-bulb temperature $T_d$, and wet-bulb temperature $T_w$:\n1.  The definition of humidity ratio, $w$, as a function of the partial pressure of water vapor, $e$:\n    $$w(e) = \\frac{\\epsilon\\, e}{P - e}$$\n    where $\\epsilon = 0.62198$ is the ratio of molar masses of water to dry air.\n\n2.  The psychrometric equation, which relates $e$ to the wet-bulb temperature $T_w$ and the humidity ratio $w$:\n    $$e(w) = e_s(T_w) - \\gamma \\,\\Gamma(w;P,T_w)\\, (T_d - T_w)$$\n    Here, $e_s(T_w)$ is the saturation vapor pressure at $T_w$, $\\gamma$ is a given correction factor, and $\\Gamma(w)$ is a term related to the psychrometric constant:\n    $$\\Gamma(w;P,T_w) = \\frac{(c_{p,a} + w\\, c_{p,v})\\, P}{\\epsilon\\, \\lambda(T_w)}$$\n    The parameters $c_{p,a}=1.006\\,\\mathrm{kJ\\,kg^{-1}\\,K^{-1}}$ and $c_{p,v}=1.86\\,\\mathrm{kJ\\,kg^{-1}\\,K^{-1}}$ are the specific heats of dry air and water vapor, and $\\lambda(T_w)$ is the latent heat of vaporization at $T_w$.\n\nSubstituting the expression for $e(w)$ into the definition for $w(e)$ yields the fixed-point mapping $w = g(w)$:\n$$g(w) = \\frac{\\epsilon\\, \\left[e_s(T_w) - \\gamma \\,\\Gamma(w;P,T_w)\\, (T_d - T_w)\\right]}{P - \\left[e_s(T_w) - \\gamma \\,\\Gamma(w;P,T_w)\\, (T_d - T_w)\\right]}$$\n\nThe solution $w^\\star$ is found using fixed-point iteration, $w^{(k+1)} = g(w^{(k)})$, starting from the initial guess corresponding to saturation at the wet-bulb temperature:\n$$w^{(0)} = \\frac{\\epsilon\\, e_s(T_w)}{P - e_s(T_w)}$$\nThe iteration terminates when the change between successive iterates falls below a tolerance, $|w^{(k+1)} - w^{(k)}| \\le 10^{-12}$, or a maximum of $200$ iterations is reached. The provided empirical correlations for $e_s(T)$ and $\\lambda(T)$ are used as specified.\n\nA critical part of the task is to analyze the convergence of the iteration. The local rate of linear convergence is determined by the magnitude of the derivative of the mapping function, $|g'(w^\\star)|$, evaluated at the fixed point. To compute this, we derive $g'(w)$ analytically.\n\nFirst, applying the quotient rule to $g(w) = \\frac{\\epsilon\\, e(w)}{P - e(w)}$:\n$$g'(w) = \\frac{d}{dw} \\left( \\frac{\\epsilon\\, e(w)}{P - e(w)} \\right) = \\frac{\\epsilon\\, e'(w) (P - e(w)) - \\epsilon\\, e(w) (-e'(w))}{(P - e(w))^2} = \\frac{\\epsilon\\, P\\, e'(w)}{(P - e(w))^2}$$\n\nNext, we find the derivative of $e(w)$ with respect to $w$. The terms $e_s(T_w)$, $T_d$, and $T_w$ are constant with respect to $w$.\n$$e'(w) = \\frac{d}{dw} \\left( e_s(T_w) - \\gamma \\,(T_d - T_w)\\, \\Gamma(w) \\right) = -\\gamma \\,(T_d - T_w)\\, \\frac{d\\Gamma}{dw}$$\n\nThe derivative of $\\Gamma(w)$ is:\n$$\\frac{d\\Gamma}{dw} = \\frac{d}{dw} \\left( \\frac{(c_{p,a} + w c_{p,v})\\, P}{\\epsilon\\, \\lambda(T_w)} \\right) = \\frac{P c_{p,v}}{\\epsilon\\, \\lambda(T_w)}$$\nThis derivative is a constant with respect to $w$.\n\nSubstituting back, we find that $e'(w)$ is also a constant, which we denote by $C$:\n$$C = e'(w) = -\\gamma \\,(T_d - T_w)\\, \\frac{P c_{p,v}}{\\epsilon\\, \\lambda(T_w)}$$\n\nFinally, the expression for the derivative $g'(w)$ is:\n$$g'(w) = \\frac{\\epsilon\\, P\\, C}{(P - e(w))^2} = - \\frac{\\epsilon\\, P}{(P - e(w))^2} \\left(\\gamma \\,(T_d - T_w)\\, \\frac{P c_{p,v}}{\\epsilon\\, \\lambda(T_w)}\\right)$$\nThis expression is evaluated at the computed fixed point $w^\\star$ to find the analytical contraction factor $|g'(w^\\star)|$.\n\nIn addition to the analytical rate, an empirical rate $\\widehat{\\rho}$ is estimated by averaging the ratio of successive errors over the final steps of the iteration. For a total of $K$ iterations, the observed rate is calculated as:\n$$\\widehat{\\rho} = \\mathrm{mean}\\left( \\frac{|w^{(k+1)} - w^\\star|}{|w^{(k)} - w^\\star|} \\right) \\quad \\text{for } k \\in [K-\\min(5,K), K-1]$$\nRatios with zero denominators are excluded from the average. If no ratios can be computed, $\\widehat{\\rho}$ is reported as $0$.\n\nThe implementation consists of a function that, for each test case, performs the fixed-point iteration, stores the history of iterates $w^{(k)}$, and upon completion, calculates the required outputs: the final humidity ratio $w^\\star$, iteration count, convergence status, the analytical contraction factor $|g'(w^\\star)|$, and the observed rate $\\widehat{\\rho}$. These values are then rounded and formatted precisely as specified in the problem description.", "answer": "```python\nimport numpy as np\nimport math\n\n# This solution adheres to the specified execution environment:\n# - language: Python 3.12\n# - libraries: numpy 1.23.5, scipy 1.11.4 (scipy is allowed but not used).\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases and prints the final output.\n    \"\"\"\n\n    # Define universal constants\n    EPSILON = 0.62198  # Ratio of gas constants of water vapor to dry air\n    C_P_A = 1.006      # Specific heat of dry air (kJ/kg/K)\n    C_P_V = 1.86       # Specific heat of water vapor (kJ/kg/K)\n    MAX_ITER = 200\n    TOLERANCE = 1e-12\n\n    def e_s_func(T):\n        \"\"\"\n        Saturation vapor pressure (Magnus-type correlation).\n        T in Celsius, returns e_s in kPa.\n        \"\"\"\n        return 0.61094 * math.exp((17.625 * T) / (T + 243.04))\n\n    def lambda_func(T):\n        \"\"\"\n        Latent heat of vaporization.\n        T in Celsius, returns lambda in kJ/kg.\n        \"\"\"\n        return 2501.0 - 2.381 * T\n\n    def compute_properties(P, T_d, T_w, gamma):\n        \"\"\"\n        Computes psychrometric properties for a single test case.\n        \"\"\"\n        # Pre-compute values that are constant during iteration\n        es_Tw = e_s_func(T_w)\n        lambda_Tw = lambda_func(T_w)\n        Td_minus_Tw = T_d - T_w\n\n        # --- Fixed-point iteration ---\n        w_hist = []\n        \n        # Initial guess w^(0)\n        # Avoid division by zero if P happens to be equal to es_Tw\n        if P - es_Tw <= 0:\n            return [0.0, MAX_ITER, False, float('inf'), float('inf')]\n\n        w_k = (EPSILON * es_Tw) / (P - es_Tw)\n        w_hist.append(w_k)\n        \n        converged = False\n        k_total = 0\n        \n        for k_iter in range(1, MAX_ITER + 1):\n            \n            Gamma_wk = ((C_P_A + w_k * C_P_V) * P) / (EPSILON * lambda_Tw)\n            e_wk = es_Tw - gamma * Gamma_wk * Td_minus_Tw\n            \n            if P - e_wk <= 0:\n                k_total = k_iter - 1\n                w_hist.append(w_k) # Append last valid w\n                converged = False\n                break\n                \n            w_kp1 = (EPSILON * e_wk) / (P - e_wk)\n            w_hist.append(w_kp1)\n            \n            if abs(w_kp1 - w_k) <= TOLERANCE:\n                converged = True\n                k_total = k_iter\n                break\n            \n            w_k = w_kp1\n        else: # Loop completed without break (non-convergence)\n            k_total = MAX_ITER\n            converged = False\n\n        w_star = w_hist[-1]\n\n        # --- Convergence Analysis ---\n        \n        # 1. Analytic contraction factor |g'(w*)|\n        C = -gamma * Td_minus_Tw * (P * C_P_V) / (EPSILON * lambda_Tw)\n        \n        Gamma_w_star = ((C_P_A + w_star * C_P_V) * P) / (EPSILON * lambda_Tw)\n        e_w_star = es_Tw - gamma * Gamma_w_star * Td_minus_Tw\n        \n        denominator_g_prime = P - e_w_star\n        if abs(denominator_g_prime) < 1e-15:\n            analytic_rate = float('inf')\n        else:\n            g_prime_w_star = (EPSILON * P * C) / (denominator_g_prime**2)\n            analytic_rate = abs(g_prime_w_star)\n            \n        # 2. Observed asymptotic rate rho_hat\n        num_iters_for_rate = min(5, k_total)\n        ratios = []\n        if k_total >= 1:\n            start_k_index = k_total - num_iters_for_rate\n            for i in range(start_k_index, k_total):\n                numerator = abs(w_hist[i + 1] - w_star)\n                denominator = abs(w_hist[i] - w_star)\n                if denominator > 1e-15:\n                    ratios.append(numerator / denominator)\n        \n        rho_hat = np.mean(ratios) if ratios else 0.0\n\n        return [w_star, k_total, converged, analytic_rate, rho_hat]\n\n    # Test suite from the problem statement\n    test_cases = [\n        (101.325, 30.0, 20.0, 0.0),\n        (101.325, 30.0, 20.0, 0.5),\n        (101.325, 30.0, 20.0, 1.0),\n        (101.325, 30.0, 20.0, 3.0),\n        (80.0,   25.0, 24.0, 1.0)\n    ]\n\n    all_results = [compute_properties(*case) for case in test_cases]\n    \n    # Format the final output string as per requirements\n    formatted_results_str = []\n    for res in all_results:\n        w_star, k, conv, g_prime, rho = res\n        \n        # Round values as specified\n        w_star_r = round(w_star, 8)\n        g_prime_r = round(g_prime, 6)\n        rho_r = round(rho, 6)\n        \n        # Format strings to ensure correct decimal places and no spaces\n        w_s = f\"{w_star_r:.8f}\"\n        g_s = f\"{g_prime_r:.6f}\"\n        rho_s = f\"{rho_r:.6f}\"\n        \n        # Build the inner list string representation\n        inner_str = f\"[{w_s},{k},{str(conv)},{g_s},{rho_s}]\"\n        formatted_results_str.append(inner_str)\n        \n    final_output = f\"[{','.join(formatted_results_str)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "2538499"}]}