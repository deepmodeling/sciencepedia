{"hands_on_practices": [{"introduction": "The foundation of first-order homogenization theory rests on the principle of volume averaging, which defines macroscopic field variables as averages of the corresponding microscopic fields over a Representative Volume Element (RVE). This practice provides a direct application of the core upscaling rule for stress [@problem_id:2623558]. You will calculate the macroscopic stress tensor $\\boldsymbol{\\Sigma}$ from a given piecewise-constant microscopic stress field, reinforcing the fundamental link between scales.", "problem": "A Representative Volume Element (RVE) in a two-dimensional plane stress setting is used within a Finite Element squared (FE²) computational homogenization framework. The RVE is partitioned into $3$ disjoint subdomains $\\Omega_{\\mu}^{(k)}$, $k=1,2,3$, each with constant microscopic Cauchy stress $\\boldsymbol{\\sigma}_{k}$ and known volume $V_k$. Assume the microscopic fields satisfy static equilibrium with no body forces, appropriate admissible boundary conditions, and that the Hill–Mandel macro-homogeneity condition is enforced.\n\nThe subdomain volumes are $V_1 = 2$ mm$^3$, $V_2 = 3$ mm$^3$, and $V_3 = 5$ mm$^3$. The microscopic stress tensors (in Megapascal) are\n$$\n\\boldsymbol{\\sigma}_1=\\begin{pmatrix}120 & 30\\\\ 30 & 60\\end{pmatrix},\\quad\n\\boldsymbol{\\sigma}_2=\\begin{pmatrix}-40 & 20\\\\ 20 & 100\\end{pmatrix},\\quad\n\\boldsymbol{\\sigma}_3=\\begin{pmatrix}80 & -10\\\\ -10 & 40\\end{pmatrix}.\n$$\n\nUsing the first-order homogenization definition of the macroscopic Cauchy stress for such an RVE, compute the macroscopic stress tensor $\\boldsymbol{\\Sigma}$. Report your final answer in Voigt order $[\\Sigma_{11},\\,\\Sigma_{22},\\,\\Sigma_{12}]$ (note: no engineering shear factor is to be applied), expressed in Megapascal. Round your components to four significant figures. Provide your final answer as a single row matrix.", "solution": "The problem statement is subjected to validation.\n\nGivens are extracted verbatim:\n- A Representative Volume Element (RVE) in a two-dimensional plane stress setting.\n- Framework is Finite Element squared (FE²).\n- The RVE is partitioned into $3$ disjoint subdomains $\\Omega_{\\mu}^{(k)}$, for $k=1,2,3$.\n- Each subdomain has constant microscopic Cauchy stress $\\boldsymbol{\\sigma}_{k}$.\n- Each subdomain has a known volume $V_k$.\n- Microscopic fields satisfy static equilibrium with no body forces and admissible boundary conditions.\n- The Hill–Mandel macro-homogeneity condition is enforced.\n- Subdomain volumes: $V_1 = 2$ mm$^3$, $V_2 = 3$ mm$^3$, and $V_3 = 5$ mm$^3$.\n- Microscopic stress tensors in Megapascal (MPa):\n$$\n\\boldsymbol{\\sigma}_1=\\begin{pmatrix}120 & 30\\\\ 30 & 60\\end{pmatrix},\\quad\n\\boldsymbol{\\sigma}_2=\\begin{pmatrix}-40 & 20\\\\ 20 & 100\\end{pmatrix},\\quad\n\\boldsymbol{\\sigma}_3=\\begin{pmatrix}80 & -10\\\\ -10 & 40\\end{pmatrix}.\n$$\n- Task: Compute the macroscopic stress tensor $\\boldsymbol{\\Sigma}$.\n- Reporting format: Voigt order $[\\Sigma_{11},\\,\\Sigma_{22},\\,\\Sigma_{12}]$, rounded to four significant figures, in MPa.\n\nValidation verdict:\nThe problem constitutes a valid, well-posed problem in continuum mechanics. It is scientifically grounded in the theory of first-order computational homogenization. All necessary data are provided, and there are no internal contradictions or ambiguities. The microscopic stress tensors are symmetric, as required for a Cauchy stress tensor. The given conditions, such as static equilibrium and the Hill–Mandel condition, are standard in the FE² method and ensure the validity of the homogenization ansatz. The problem is a direct application of the fundamental definition of macroscopic stress.\n\nThe solution proceeds.\n\nIn first-order homogenization theory, the macroscopic Cauchy stress tensor, denoted by $\\boldsymbol{\\Sigma}$, is defined as the volume average of the microscopic Cauchy stress tensor, $\\boldsymbol{\\sigma}$, over the domain of the Representative Volume Element (RVE), $\\Omega$. The total volume of the RVE is $V$. The definition is expressed as:\n$$\n\\boldsymbol{\\Sigma} = \\frac{1}{V} \\int_{\\Omega} \\boldsymbol{\\sigma}(\\mathbf{x}) \\, dV\n$$\nThis definition is a direct consequence of the Hill-Mandel condition of macro-homogeneity, which equates the macroscopic stress power equals the volume average of the microscopic stress power.\n\nThe problem states that the RVE is partitioned into $3$ disjoint subdomains, $\\Omega_k$ for $k \\in \\{1, 2, 3\\}$, such that $\\Omega = \\cup_{k=1}^{3} \\Omega_k$ and $\\Omega_i \\cap \\Omega_j = \\emptyset$ for $i \\neq j$. The total volume $V$ is the sum of the subdomain volumes $V_k$:\n$$\nV = V_1 + V_2 + V_3\n$$\nThe integral for $\\boldsymbol{\\Sigma}$ can be decomposed into a sum of integrals over these subdomains:\n$$\n\\boldsymbol{\\Sigma} = \\frac{1}{V} \\left( \\int_{\\Omega_1} \\boldsymbol{\\sigma}(\\mathbf{x}) \\, dV + \\int_{\\Omega_2} \\boldsymbol{\\sigma}(\\mathbf{x}) \\, dV + \\int_{\\Omega_3} \\boldsymbol{\\sigma}(\\mathbf{x}) \\, dV \\right)\n$$\nA key simplification is provided: the microscopic stress tensor is constant within each subdomain, i.e., $\\boldsymbol{\\sigma}(\\mathbf{x}) = \\boldsymbol{\\sigma}_k$ for $\\mathbf{x} \\in \\Omega_k$. Therefore, the integral over each subdomain simplifies to the product of the constant stress tensor and the subdomain volume:\n$$\n\\int_{\\Omega_k} \\boldsymbol{\\sigma}_k \\, dV = \\boldsymbol{\\sigma}_k \\int_{\\Omega_k} \\, dV = \\boldsymbol{\\sigma}_k V_k\n$$\nSubstituting this result into the expression for $\\boldsymbol{\\Sigma}$ yields a volume-weighted average of the microscopic stress tensors:\n$$\n\\boldsymbol{\\Sigma} = \\frac{1}{V} \\sum_{k=1}^{3} \\boldsymbol{\\sigma}_k V_k = \\sum_{k=1}^{3} \\frac{V_k}{V} \\boldsymbol{\\sigma}_k\n$$\nLet $f_k = V_k / V$ be the volume fraction of the $k$-th subdomain. The macroscopic stress is then:\n$$\n\\boldsymbol{\\Sigma} = f_1 \\boldsymbol{\\sigma}_1 + f_2 \\boldsymbol{\\sigma}_2 + f_3 \\boldsymbol{\\sigma}_3\n$$\nWe now substitute the given numerical values. First, we compute the total volume $V$:\n$$\nV = V_1 + V_2 + V_3 = 2 \\, \\text{mm}^3 + 3 \\, \\text{mm}^3 + 5 \\, \\text{mm}^3 = 10 \\, \\text{mm}^3\n$$\nNext, we compute the volume fractions:\n$$\nf_1 = \\frac{V_1}{V} = \\frac{2}{10} = 0.2\n$$\n$$\nf_2 = \\frac{V_2}{V} = \\frac{3}{10} = 0.3\n$$\n$$\nf_3 = \\frac{V_3}{V} = \\frac{5}{10} = 0.5\n$$\nThe sum of volume fractions is $f_1+f_2+f_3 = 0.2+0.3+0.5 = 1$, as expected.\n\nNow, we compute the components of the macroscopic stress tensor $\\boldsymbol{\\Sigma}$.\nThe component $\\Sigma_{11}$ is:\n$$\n\\Sigma_{11} = f_1 \\sigma_{1,11} + f_2 \\sigma_{2,11} + f_3 \\sigma_{3,11} = (0.2)(120) + (0.3)(-40) + (0.5)(80)\n$$\n$$\n\\Sigma_{11} = 24 - 12 + 40 = 52 \\, \\text{MPa}\n$$\nThe component $\\Sigma_{22}$ is:\n$$\n\\Sigma_{22} = f_1 \\sigma_{1,22} + f_2 \\sigma_{2,22} + f_3 \\sigma_{3,22} = (0.2)(60) + (0.3)(100) + (0.5)(40)\n$$\n$$\n\\Sigma_{22} = 12 + 30 + 20 = 62 \\, \\text{MPa}\n$$\nThe component $\\Sigma_{12}$ is:\n$$\n\\Sigma_{12} = f_1 \\sigma_{1,12} + f_2 \\sigma_{2,12} + f_3 \\sigma_{3,12} = (0.2)(30) + (0.3)(20) + (0.5)(-10)\n$$\n$$\n\\Sigma_{12} = 6 + 6 - 5 = 7 \\, \\text{MPa}\n$$\nSince all microscopic stress tensors are symmetric, the resulting macroscopic stress tensor is also symmetric, thus $\\Sigma_{21} = \\Sigma_{12} = 7 \\, \\text{MPa}$. The full macroscopic stress tensor is:\n$$\n\\boldsymbol{\\Sigma} = \\begin{pmatrix} 52 & 7 \\\\ 7 & 62 \\end{pmatrix} \\, \\text{MPa}\n$$\nThe problem requires the answer in Voigt notation $[\\Sigma_{11}, \\Sigma_{22}, \\Sigma_{12}]$, with components rounded to four significant figures.\nThe calculated components are $52$, $62$, and $7$. Expressed with four significant figures, these are:\n$$\n\\Sigma_{11} = 52.00\n$$\n$$\n\\Sigma_{22} = 62.00\n$$\n$$\n\\Sigma_{12} = 7.000\n$$\nThus, the final answer in the requested format is a row matrix containing these values.", "answer": "$$\n\\boxed{\\begin{pmatrix} 52.00 & 62.00 & 7.000 \\end{pmatrix}}\n$$", "id": "2623558"}, {"introduction": "Before trusting a complex numerical simulation, one must verify that it can correctly reproduce simple, known analytical solutions; this is the purpose of a patch test. In the context of the Finite Element squared (FE²) method, a properly implemented code must recover a uniform stress state when simulating a homogeneous material subjected to a uniform macroscopic strain [@problem_id:2623524]. This exercise asks you to design such a test, specifying the necessary boundary conditions and a complete set of diagnostic checks to confirm the implementation's correctness.", "problem": "Consider a two-scale computational homogenization scheme known as Finite Element squared (FE²) for small-strain linear elasticity. Let the microscopic domain, called the Representative Volume Element (RVE), be denoted by $\\Omega_{\\mu} \\subset \\mathbb{R}^{d}$ with boundary $\\partial \\Omega_{\\mu}$ and outward unit normal $\\mathbf{n}$. The microscopic constitutive law is linear elastic with a constant fourth-order elasticity tensor $\\mathbb{C}$, the body force is $\\mathbf{b}=\\mathbf{0}$, and small-strain kinematics $\\boldsymbol{\\varepsilon}=\\operatorname{sym}\\nabla \\mathbf{u}$ holds. The macroscopic element undergoes a uniform, constant macroscopic strain tensor $\\overline{\\boldsymbol{E}}$ (constant in space), to be passed to the RVE via suitable boundary conditions consistent with the Hill–Mandel macrohomogeneity condition. The goal is to design a patch test that, when this uniform macroscopic strain is imposed, produces exactly uniform microscopic stress and a zero fluctuation field on the RVE, and to specify a complete set of diagnostic checks that must be satisfied to assert that the FE² implementation passes the patch test.\n\nWhich option below gives a correct and complete design of such a patch test, including the necessary micro boundary conditions and a minimal, sufficient set of diagnostics?\n\nA. Choose $\\Omega_{\\mu}$ as any simply connected domain with a homogeneous linear elastic material, i.e., $\\mathbb{C}$ is constant in $\\Omega_{\\mu}$. Impose kinematic uniform boundary conditions (KUBC): prescribe an affine displacement $\\mathbf{u}(\\mathbf{x})=\\overline{\\boldsymbol{H}}\\,\\mathbf{x}$ on $\\partial \\Omega_{\\mu}$, with $\\operatorname{sym}(\\overline{\\boldsymbol{H}})=\\overline{\\boldsymbol{E}}$. Equivalently, solve for the fluctuation $\\widetilde{\\mathbf{u}}=\\mathbf{u}-\\overline{\\boldsymbol{H}}\\,\\mathbf{x}$ with $\\widetilde{\\mathbf{u}}=\\mathbf{0}$ on $\\partial \\Omega_{\\mu}$. Declare the patch test passed if, to within a tight numerical tolerance:\n- The fluctuation norm is negligible, e.g., $\\|\\widetilde{\\mathbf{u}}\\|_{H^{1}(\\Omega_{\\mu})} \\le \\varepsilon$ with $\\varepsilon \\approx 10^{-12}$ in nondimensional units.\n- The microscopic stress is uniform and equals the constitutive response to the macroscopic strain, i.e., $\\operatorname{Var}_{\\Omega_{\\mu}}[\\boldsymbol{\\sigma}]=0$ and pointwise $\\boldsymbol{\\sigma}(\\mathbf{x})=\\mathbb{C}:\\overline{\\boldsymbol{E}}$.\n- The Hill–Mandel energy consistency holds to machine precision, $\\overline{\\boldsymbol{\\sigma}}:\\overline{\\boldsymbol{E}}=\\frac{1}{|\\Omega_{\\mu}|}\\int_{\\Omega_{\\mu}}\\boldsymbol{\\sigma}:\\boldsymbol{\\varepsilon}\\,\\mathrm{d}\\Omega$, where $\\overline{\\boldsymbol{\\sigma}}=\\frac{1}{|\\Omega_{\\mu}|}\\int_{\\Omega_{\\mu}}\\boldsymbol{\\sigma}\\,\\mathrm{d}\\Omega$.\n- The macroscopic consistent tangent computed from the microproblem equals $\\mathbb{C}$, i.e., $\\mathbb{C}^{\\text{hom}}=\\mathbb{C}$ to within a small normed tolerance.\n- The discrete micro-equilibrium residual norm vanishes to the nonlinear solver tolerance, and the boundary reactions correspond to $\\boldsymbol{\\sigma}\\,\\mathbf{n}$ induced by the uniform stress.\n\nB. Choose $\\Omega_{\\mu}$ as a strongly heterogeneous two-phase composite with piecewise constant tensors $\\mathbb{C}_{1}$ and $\\mathbb{C}_{2}$. Impose periodic boundary conditions (PBC) on a parallelepiped RVE, enforcing periodic displacements and anti-periodic tractions. Declare the patch test passed if the volume averages satisfy $\\langle \\boldsymbol{\\varepsilon} \\rangle=\\overline{\\boldsymbol{E}}$ and $\\langle \\boldsymbol{\\sigma} \\rangle=\\overline{\\boldsymbol{\\sigma}}$, and if the Hill–Mandel equality holds on average, regardless of whether the fluctuation field is nonzero and the microstress is nonuniform.\n\nC. Choose $\\Omega_{\\mu}$ homogeneous. Impose uniform traction boundary conditions $\\mathbf{t}=\\overline{\\boldsymbol{\\sigma}}\\,\\mathbf{n}$ on the entire $\\partial \\Omega_{\\mu}$, with $\\overline{\\boldsymbol{\\sigma}}=\\mathbb{C}:\\overline{\\boldsymbol{E}}$. Declare the patch test passed if the sum of reactions is zero, the average microstrain equals $\\overline{\\boldsymbol{E}}$, and the macroscopic stress computed from reactions equals $\\overline{\\boldsymbol{\\sigma}}$.\n\nD. Choose $\\Omega_{\\mu}$ homogeneous and rectangular. Impose periodic boundary conditions (PBC) with affine part $\\overline{\\boldsymbol{H}}\\,\\mathbf{x}$ and periodic displacement fluctuations. Declare the patch test passed if the Hill–Mandel condition holds and the volume-average microstrain equals $\\overline{\\boldsymbol{E}}$, without checking for the vanishing fluctuation field, stress uniformity, or equality of the consistent tangent to $\\mathbb{C}$.\n\nSelect the correct option.", "solution": "The problem statement requests the design of a patch test for a two-scale computational homogenization (FE²) scheme in the context of small-strain linear elasticity. The objective of such a test is to verify that the numerical implementation can correctly reproduce a known, simple analytical solution. The specific case to be reproduced is that of a homogeneous material, where a uniform macroscopic strain should result in uniform microscopic fields.\n\nFirst, we must validate the problem statement.\n\n**Step 1: Extract Givens**\n- **Scheme:** Two-scale computational homogenization (FE²).\n- **Physics:** Small-strain linear elasticity.\n- **RVE:** $\\Omega_{\\mu} \\subset \\mathbb{R}^{d}$ with boundary $\\partial \\Omega_{\\mu}$ and outward unit normal $\\mathbf{n}$.\n- **Constitutive Law:** Linear elastic with a constant fourth-order elasticity tensor $\\mathbb{C}$.\n- **Body Force:** $\\mathbf{b}=\\mathbf{0}$.\n- **Kinematics:** $\\boldsymbol{\\varepsilon}=\\operatorname{sym}\\nabla \\mathbf{u}$.\n- **Macroscopic Loading:** A uniform, constant macroscopic strain tensor $\\overline{\\boldsymbol{E}}$.\n- **Coupling:** Boundary conditions consistent with the Hill–Mandel macrohomogeneity condition.\n- **Objective:** Design a patch test where imposing $\\overline{\\boldsymbol{E}}$ produces:\n    1. Uniform microscopic stress.\n    2. A zero fluctuation field on the RVE.\n- **Task:** Specify the test design and a complete set of diagnostic checks for passing the test.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem statement is scientifically sound, well-posed, and objective. It is grounded in the established theory of computational multiscale mechanics. The concept of a patch test is a standard and essential verification procedure in numerical methods, particularly for finite element analysis. The problem asks for the design of such a test, which is a well-defined conceptual task based on the provided physical and mathematical framework. The givens are self-consistent and sufficient to formulate the requirements for a valid patch test. No flaws are identified.\n\n**Verdict:** The problem is **valid**.\n\nWe now proceed with the derivation of the solution and evaluation of the options.\n\n**Principle-Based Derivation**\nA patch test, in the context of FE², serves to verify that the implementation can exactly recover the trivial solution corresponding to a homogeneous material.\n\nThe governing equation for the microscopic problem is the equilibrium equation in the absence of body forces:\n$$\n\\nabla \\cdot \\boldsymbol{\\sigma} = \\mathbf{0} \\quad \\text{in } \\Omega_{\\mu}\n$$\nThe constitutive and kinematic relations are:\n$$\n\\boldsymbol{\\sigma} = \\mathbb{C}:\\boldsymbol{\\varepsilon}\n$$\n$$\n\\boldsymbol{\\varepsilon} = \\operatorname{sym}(\\nabla \\mathbf{u}) = \\frac{1}{2}(\\nabla \\mathbf{u} + (\\nabla \\mathbf{u})^T)\n$$\nSince the material is homogeneous, the elasticity tensor $\\mathbb{C}$ is constant throughout $\\Omega_{\\mu}$. Let us assume a uniform strain field $\\boldsymbol{\\varepsilon}(\\mathbf{x}) = \\overline{\\boldsymbol{E}}$, where $\\overline{\\boldsymbol{E}}$ is a constant tensor. This leads to a uniform stress field $\\boldsymbol{\\sigma}(\\mathbf{x}) = \\mathbb{C}:\\overline{\\boldsymbol{E}}$. The divergence of a constant stress tensor is zero, $\\nabla \\cdot (\\mathbb{C}:\\overline{\\boldsymbol{E}}) = \\mathbf{0}$, so the equilibrium equation is satisfied identically within the domain.\n\nThe displacement field $\\mathbf{u}(\\mathbf{x})$ that generates a uniform strain $\\overline{\\boldsymbol{E}}$ must satisfy $\\operatorname{sym}(\\nabla \\mathbf{u}) = \\overline{\\boldsymbol{E}}$. The general solution for $\\nabla\\mathbf{u}$ is $\\nabla\\mathbf{u} = \\overline{\\boldsymbol{E}} + \\overline{\\mathbf{W}}$, where $\\overline{\\mathbf{W}}$ is any constant skew-symmetric tensor representing a rigid body rotation. Integrating this gives an affine displacement field:\n$$\n\\mathbf{u}(\\mathbf{x}) = (\\overline{\\boldsymbol{E}} + \\overline{\\mathbf{W}})\\mathbf{x} + \\mathbf{c} = \\overline{\\boldsymbol{H}}\\mathbf{x} + \\mathbf{c}\n$$\nwhere $\\overline{\\boldsymbol{H}} = \\overline{\\boldsymbol{E}} + \\overline{\\mathbf{W}}$ is a constant tensor and $\\mathbf{c}$ is a constant vector representing a rigid body translation.\n\nThe fluctuation field $\\widetilde{\\mathbf{u}}$ is typically defined through the decomposition $\\mathbf{u}(\\mathbf{x}) = \\overline{\\boldsymbol{E}}\\mathbf{x} + \\widetilde{\\mathbf{u}}(\\mathbf{x})$. For the problem to yield a zero fluctuation field, we require $\\widetilde{\\mathbf{u}}(\\mathbf{x}) = \\mathbf{0}$. This corresponds to a displacement field $\\mathbf{u}(\\mathbf{x}) = \\overline{\\boldsymbol{E}}\\mathbf{x}$ (ignoring rigid body motion, which must be constrained by boundary conditions).\n\nTo ensure that $\\mathbf{u}(\\mathbf{x}) = \\overline{\\boldsymbol{E}}\\mathbf{x}$ is the unique solution of the microscale boundary value problem (BVP), we must impose appropriate boundary conditions. Any set of boundary conditions consistent with the Hill–Mandel condition (e.g., Kinematic Uniform Boundary Conditions (KUBC), Periodic Boundary Conditions (PBC), or Static Uniform Boundary Conditions (SUBC)) should, for a homogeneous RVE, yield this uniform state.\n\nA complete set of diagnostic checks must verify that the numerical code reproduces all aspects of this analytical solution and satisfies fundamental consistency conditions. These checks should include:\n$1$. The computed displacement field must correspond to zero fluctuation, i.e., $\\|\\widetilde{\\mathbf{u}}\\|$ should be close to machine precision.\n$2$. The computed stress and strain fields must be uniform, with values $\\boldsymbol{\\sigma} = \\mathbb{C}:\\overline{\\boldsymbol{E}}$ and $\\boldsymbol{\\varepsilon} = \\overline{\\boldsymbol{E}}$ respectively.\n$3$. The volume average of the microscopic stress, $\\overline{\\boldsymbol{\\sigma}} = \\frac{1}{|\\Omega_{\\mu}|}\\int_{\\Omega_{\\mu}}\\boldsymbol{\\sigma}\\,\\mathrm{d}\\Omega$, must equal $\\mathbb{C}:\\overline{\\boldsymbol{E}}$.\n$4$. The Hill–Mandel condition, $\\overline{\\boldsymbol{\\sigma}}:\\overline{\\boldsymbol{E}} = \\frac{1}{|\\Omega_{\\mu}|}\\int_{\\Omega_{\\mu}}\\boldsymbol{\\sigma}:\\boldsymbol{\\varepsilon}\\,\\mathrm{d}\\Omega$, must be satisfied to machine precision.\n$5$. The computed homogenized tangent modulus, $\\mathbb{C}^{\\text{hom}} = \\partial \\overline{\\boldsymbol{\\sigma}} / \\partial \\overline{\\boldsymbol{E}}$, must be equal to the microscopic tangent $\\mathbb{C}$.\n$6$. Standard finite element solution checks, such as a vanishing equilibrium residual and correct boundary reactions, must pass.\n\nNow we evaluate the given options based on this framework.\n\n**Option-by-Option Analysis**\n\n**A. Choose $\\Omega_{\\mu}$ as any simply connected domain with a homogeneous linear elastic material...**\n- **Test Setup:** A homogeneous material ($\\mathbb{C}$ constant) is correctly chosen. KUBC, prescribed as an affine displacement $\\mathbf{u}(\\mathbf{x})=\\overline{\\boldsymbol{H}}\\,\\mathbf{x}$ on $\\partial \\Omega_{\\mu}$ (where $\\operatorname{sym}(\\overline{\\boldsymbol{H}})=\\overline{\\boldsymbol{E}}$), is a valid boundary condition that enforces the desired macroscopic strain and for which the exact solution is the affine field itself, resulting in a zero fluctuation field $\\widetilde{\\mathbf{u}}=\\mathbf{0}$ (assuming $\\overline{\\mathbf{H}}=\\overline{\\boldsymbol{E}}$ or the appropriate definition of fluctuation).\n- **Diagnostics:** The list of checks is comprehensive and correct.\n    - Checking that the fluctuation norm $\\|\\widetilde{\\mathbf{u}}\\|_{H^{1}(\\Omega_{\\mu})}$ is negligible verifies that the correct displacement field is recovered.\n    - Checking that the variance of the stress is zero and its value is $\\mathbb{C}:\\overline{\\boldsymbol{E}}$ verifies the stress field.\n    - Checking the Hill–Mandel condition verifies the fundamental energy consistency of the multiscale coupling.\n    - Checking that $\\mathbb{C}^{\\text{hom}}=\\mathbb{C}$ verifies the correct implementation of the macroscopic tangent, which is critical for the convergence of the macroscopic problem.\n    - Checking the equilibrium residual and boundary reactions confirms the underlying solver works correctly.\nThis set of diagnostics is both sufficient and minimal, as each check tests a distinct and critical part of the FE² algorithm.\n**Verdict: Correct.**\n\n**B. Choose $\\Omega_{\\mu}$ as a strongly heterogeneous two-phase composite...**\n- **Test Setup:** This option proposes using a heterogeneous RVE. In a heterogeneous material, a uniform macroscopic strain $\\overline{\\boldsymbol{E}}$ will induce non-uniform microscopic stress and strain fields, and a non-zero fluctuation field $\\widetilde{\\mathbf{u}}$. The purpose of a patch test is specifically to verify the code's ability to reproduce a known *uniform* solution in a *homogeneous* medium. Using a heterogeneous material constitutes a different type of verification problem, not a patch test in its fundamental sense.\n- **Diagnostics:** The checks are limited to average quantities and the Hill-Mandel condition, explicitly ignoring the non-uniformity of the fields. This misses the primary point of a patch test.\n**Verdict: Incorrect.**\n\n**C. Choose $\\Omega_{\\mu}$ homogeneous. Impose uniform traction boundary conditions...**\n- **Test Setup:** A homogeneous material is correctly chosen. Uniform traction BCs (SUBC), $\\mathbf{t}=\\overline{\\boldsymbol{\\sigma}}\\,\\mathbf{n}$ with $\\overline{\\boldsymbol{\\sigma}}=\\mathbb{C}:\\overline{\\boldsymbol{E}}$, are a valid alternative to KUBC. For this BVP, the uniform stress state $\\boldsymbol{\\sigma}=\\overline{\\boldsymbol{\\sigma}}$ and uniform strain state $\\boldsymbol{\\varepsilon}=\\overline{\\boldsymbol{E}}$ constitute a valid solution.\n- **Diagnostics:** The set of checks is critically incomplete. It mentions checking that the sum of reactions is zero (which is ill-defined for prescribed tractions), the average microstrain equals $\\overline{\\boldsymbol{E}}$ (correct), and the macroscopic stress from reactions equals $\\overline{\\boldsymbol{\\sigma}}$ (circular). Most importantly, it fails to specify checks for the *uniformity* of the resulting stress and strain fields, the vanishing of the fluctuation field (relative to the affine solution), and the correctness of the homogenized tangent $\\mathbb{C}^{\\text{hom}} = \\mathbb{C}$. A patch test that does not verify the recovery of the exact local fields is insufficient.\n**Verdict: Incorrect.**\n\n**D. Choose $\\Omega_{\\mu}$ homogeneous and rectangular. Impose periodic boundary conditions (PBC)...**\n- **Test Setup:** A homogeneous material is correctly chosen. Periodic BCs are another valid choice for a patch test. For a homogeneous RVE, PBC should also result in uniform fields and a zero fluctuation field (up to a rigid body motion).\n- **Diagnostics:** This option is explicitly and fatally flawed because it states that the test is passed \"without checking for the vanishing fluctuation field, stress uniformity, or equality of the consistent tangent to $\\mathbb{C}$\". Omitting these checks defeats the entire purpose of the patch test. Verifying only average quantities and the Hill-Mandel condition is insufficient to guarantee the correctness of the implementation, as local errors in the field solution or errors in the tangent calculation would go undetected.\n**Verdict: Incorrect.**\n\n**Conclusion**\nOption A provides the only correct and complete description of a patch test for an FE² implementation. It correctly specifies a valid setup (homogeneous RVE with KUBC) and a minimal, yet sufficient, set of diagnostic checks that cover all critical aspects of the numerical implementation: the solution field, the constitutive response, the scale-bridging energy Ccondition, and the macroscopic tangent stiffness.", "answer": "$$\\boxed{A}$$", "id": "2623524"}, {"introduction": "The efficiency of a nonlinear two-scale simulation hinges on the accurate and consistent linearization of the microscale problem, which yields the homogenized tangent modulus $\\mathbb{C}^{\\text{eff}}$. This comprehensive practice challenges you to implement a full FE² micro-problem for a nonlinear material, derive the expression for $\\mathbb{C}^{\\text{eff}}$ from first principles, and then verify your analytical implementation against a numerical finite-difference approximation [@problem_id:2623507]. Mastering this process is a cornerstone of developing and validating advanced multiscale models.", "problem": "Implement a verification program, grounded in the first-order two-scale Finite Element method (FE²), to assess the consistency of the homogenized tangent modulus by finite differences at the macroscale. Work in small-strain solid mechanics with a periodic Representative Volume Element (RVE). The derivation must begin strictly from fundamental balance and variational principles. The program must be self-contained, compute the microscale equilibrium and its linearization, and compare the consistent homogenized tangent with a finite-difference approximation obtained by perturbing the macroscopic strain. All quantities in this problem are nondimensional.\n\nAssumptions and definitions:\n- Consider a unit-square RVE $\\Omega \\subset \\mathbb{R}^2$ with area $|\\Omega| = 1$. The kinematics are small-strain, plane strain. The microscopic displacement field is decomposed as $\\boldsymbol{u}(\\boldsymbol{x}) = \\bar{\\boldsymbol{E}} \\boldsymbol{x} + \\boldsymbol{w}(\\boldsymbol{x})$, where $\\bar{\\boldsymbol{E}}$ is the imposed constant macroscopic strain tensor and $\\boldsymbol{w}$ is a periodic fluctuation with zero mean. The small-strain tensor is $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\frac{1}{2}(\\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^{\\mathsf{T}})$.\n- The RVE is discretized by bilinear quadrilateral finite elements on a $2 \\times 2$ uniform mesh, enforcing periodicity of $\\boldsymbol{w}$ by identifying opposite boundary nodes, and fixing a single reference node to eliminate the rigid-body translation of $\\boldsymbol{w}$.\n- The constitutive law is a heterogeneous, isotropic, compressible, small-strain, hyperelastic model built from a linear elastic base and a volumetric cubic perturbation. At each material point,\n  $$\n  W(\\boldsymbol{\\varepsilon}) = \\tfrac{1}{2}\\,\\boldsymbol{\\varepsilon}:\\mathbb{C}_{\\text{lin}}:\\boldsymbol{\\varepsilon} + \\tfrac{\\beta}{3}\\,(\\operatorname{tr}\\boldsymbol{\\varepsilon})^3,\n  $$\n  where $\\mathbb{C}_{\\text{lin}}$ is the plane-strain isotropic stiffness tensor defined by Lamé parameters $(\\lambda,\\mu)$, and $\\beta \\ge 0$ is a scalar parameter. The Cauchy stress is $\\boldsymbol{\\sigma} = \\partial W / \\partial \\boldsymbol{\\varepsilon} = \\mathbb{C}_{\\text{lin}}:\\boldsymbol{\\varepsilon} + \\beta\\,(\\operatorname{tr}\\boldsymbol{\\varepsilon})^2\\,\\boldsymbol{I}$, and the consistent material tangent is $\\mathbb{C} = \\partial \\boldsymbol{\\sigma}/\\partial \\boldsymbol{\\varepsilon} = \\mathbb{C}_{\\text{lin}} + 2\\beta\\,(\\operatorname{tr}\\boldsymbol{\\varepsilon})\\,\\boldsymbol{I}\\otimes\\boldsymbol{I}$. Use the tensor-to-Voigt mapping with vector components $[\\varepsilon_{11},\\varepsilon_{22},\\varepsilon_{12}]^{\\mathsf{T}}$ and $[\\sigma_{11},\\sigma_{22},\\sigma_{12}]^{\\mathsf{T}}$ (note that $\\varepsilon_{12}$ is the tensorial shear, not the engineering shear). In this mapping for plane strain, the linear stiffness is\n  $$\n  \\mathbb{C}_{\\text{lin}}^{\\text{Voigt}} =\n  \\begin{bmatrix}\n  \\lambda + 2\\mu & \\lambda & 0\\\\\n  \\lambda & \\lambda + 2\\mu & 0\\\\\n  0 & 0 & 2\\mu\n  \\end{bmatrix}.\n  $$\n- The RVE is heterogeneous: assign two materials, A and B, in a checkerboard pattern over the $2 \\times 2$ elements using their element-center coordinates. Elements with centers in quadrants where $(x-0.5)(y-0.5) \\ge 0$ use material A, others use material B. Material A has parameters $(\\lambda_A,\\mu_A,\\beta_A)$ and material B has $(\\lambda_B,\\mu_B,\\beta_B)$.\n\nMicroscale weak form and equilibrium:\n- The principle of virtual work at the microscale with periodic $\\boldsymbol{w}$ requires\n  $$\n  \\delta \\Pi(\\boldsymbol{w};\\bar{\\boldsymbol{E}}) = \\int_{\\Omega} \\boldsymbol{\\sigma}(\\bar{\\boldsymbol{E}} + \\boldsymbol{\\varepsilon}(\\boldsymbol{w})) : \\boldsymbol{\\varepsilon}(\\delta \\boldsymbol{w})\\,\\mathrm{d}V = 0\n  $$\n  for all periodic admissible $\\delta \\boldsymbol{w}$. Discretize $\\boldsymbol{w}$ with bilinear shape functions, assemble the residual vector $\\boldsymbol{R}(\\boldsymbol{w};\\bar{\\boldsymbol{E}})$ and its Jacobian (the tangent) $\\boldsymbol{K}_{ww} = \\partial \\boldsymbol{R}/\\partial \\boldsymbol{w}$, and solve $\\boldsymbol{R} = \\boldsymbol{0}$ by Newton’s method.\n\nMacroscale response and consistent linearization:\n- The homogenized Cauchy stress is the volume average\n  $$\n  \\bar{\\boldsymbol{\\sigma}}(\\bar{\\boldsymbol{E}}) = \\frac{1}{|\\Omega|}\\int_{\\Omega}\\boldsymbol{\\sigma}(\\bar{\\boldsymbol{E}} + \\boldsymbol{\\varepsilon}(\\boldsymbol{w}(\\bar{\\boldsymbol{E}})))\\,\\mathrm{d}V.\n  $$\n- Linearize the coupled problem about the converged microscale equilibrium to obtain the consistent homogenized tangent $\\mathbb{C}^{\\text{eff}} = \\partial \\bar{\\boldsymbol{\\sigma}} / \\partial \\bar{\\boldsymbol{E}}$. Starting from the linearization of the residual operator and the implicit function theorem applied to the microequilibrium, derive the expression that condenses the effect of $\\mathrm{d}\\boldsymbol{w}$ into $\\mathbb{C}^{\\text{eff}}$ using only fundamental definitions and the chain rule. Implement the resulting expression in your program using the finite element discretization and the assembled blocks from the micro linearization. Do not use any externally provided final formula.\n\nFinite-difference verification:\n- Verify $\\mathbb{C}^{\\text{eff}}$ by a central finite-difference approximation of $\\partial \\bar{\\boldsymbol{\\sigma}} / \\partial \\bar{\\boldsymbol{E}}$. For each component $j$ of the macroscopic strain vector $\\bar{\\boldsymbol{E}}_{\\mathrm{vec}} = [\\bar{E}_{11},\\bar{E}_{22},\\bar{E}_{12}]^{\\mathsf{T}}$, compute\n  $$\n  \\left.\\frac{\\partial \\bar{\\boldsymbol{\\sigma}}}{\\partial \\bar{E}_j}\\right|_{\\text{FD}} \\approx \\frac{\\bar{\\boldsymbol{\\sigma}}(\\bar{\\boldsymbol{E}}+\\delta\\,\\boldsymbol{e}_j) - \\bar{\\boldsymbol{\\sigma}}(\\bar{\\boldsymbol{E}}-\\delta\\,\\boldsymbol{e}_j)}{2\\delta},\n  $$\n  where $\\delta$ is a small scalar and $\\boldsymbol{e}_j$ is the unit vector in component $j$. Use Newton’s method to re-equilibrate the microproblem for each perturbed macroscopic strain.\n\nNumerical and implementation details:\n- Use a $2 \\times 2$ Gauss quadrature for each bilinear element. Use the standard small-strain $B$-matrix consistent with the tensorial shear component $\\varepsilon_{12} = \\tfrac{1}{2}(\\partial u_1/\\partial y + \\partial u_2/\\partial x)$.\n- Enforce periodicity by identifying opposite boundary nodes of $\\boldsymbol{w}$ and eliminate the rigid body translation by fixing $\\boldsymbol{w}=\\boldsymbol{0}$ at the origin node. Do not apply any additional boundary tractions; the macroscopic strain enters the microscale strain additively as $\\boldsymbol{\\varepsilon} = \\bar{\\boldsymbol{E}} + \\boldsymbol{\\varepsilon}(\\boldsymbol{w})$ in the constitutive model.\n- Solve the nonlinear microscale system by Newton’s method with a fixed convergence tolerance on the residual norm and a reasonable maximum number of iterations, ensuring robust convergence for the given test suite.\n\nTest suite:\nImplement your program to run the following three test cases. For each test, compute the analytical consistent homogenized tangent $\\mathbb{C}^{\\text{eff}}$ via micro linearization, compute the finite-difference approximation, and report the maximum relative Frobenius-norm error between the two $3\\times 3$ matrices,\n$$\n\\mathrm{err} = \\frac{\\|\\mathbb{C}^{\\text{eff}} - \\mathbb{C}^{\\text{FD}}\\|_{\\mathrm{F}}}{\\max(\\|\\mathbb{C}^{\\text{eff}}\\|_{\\mathrm{F}},\\,10^{-14})}.\n$$\nUse the same mesh, periodicity, and material assignment rule in all tests. All quantities are nondimensional.\n\n- Test 1 (general heterogeneous, mixed loading):\n  - Material A: $(\\lambda_A,\\mu_A,\\beta_A) = (1200,\\,800,\\,5\\times 10^{4})$.\n  - Material B: $(\\lambda_B,\\mu_B,\\beta_B) = (600,\\,400,\\,2\\times 10^{4})$.\n  - Macroscopic strain vector $\\bar{\\boldsymbol{E}}_{\\mathrm{vec}} = [10^{-3},\\,-5\\times 10^{-4},\\,2\\times 10^{-3}]^{\\mathsf{T}}$.\n  - Finite-difference step $\\delta = 10^{-7}$.\n\n- Test 2 (pure shear, checks volumetric nonlinearity deactivation at zero trace):\n  - Same materials as in Test 1.\n  - Macroscopic strain vector $\\bar{\\boldsymbol{E}}_{\\mathrm{vec}} = [0,\\,0,\\,10^{-3}]^{\\mathsf{T}}$.\n  - Finite-difference step $\\delta = 10^{-7}$.\n\n- Test 3 (near-linear regime at zero macroscopic strain):\n  - Same materials as in Test 1.\n  - Macroscopic strain vector $\\bar{\\boldsymbol{E}}_{\\mathrm{vec}} = [0,\\,0,\\,0]^{\\mathsf{T}}$.\n  - Finite-difference step $\\delta = 10^{-7}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the three error values for the tests as a comma-separated list enclosed in square brackets (e.g., \"[e1,e2,e3]\"). Each entry must be a floating-point number.\n\nScientific realism:\n- All modeling choices and parameters are consistent with small-strain hyperelasticity, periodic homogenization at first order, and standard finite element discretizations. No external data are required, and all quantities are nondimensional.\n\nDeliverables:\n- A complete, runnable program that constructs the mesh, enforces periodicity, assembles and solves the microscale equilibrium with Newton’s method, computes the analytical consistent homogenized tangent from the microscale linearization, verifies it by finite differences of $\\bar{\\boldsymbol{E}}$, and outputs the three error values in the specified format.", "solution": "We start from the first-order two-scale Finite Element method (FE²) within small-strain kinematics. The kinematic ansatz is $\\boldsymbol{u}(\\boldsymbol{x}) = \\bar{\\boldsymbol{E}} \\boldsymbol{x} + \\boldsymbol{w}(\\boldsymbol{x})$, with $\\bar{\\boldsymbol{E}}$ constant over the Representative Volume Element (RVE) $\\Omega$, and $\\boldsymbol{w}$ periodic with zero mean. The small-strain tensor is $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\frac{1}{2}(\\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^{\\mathsf{T}})$, hence the local microscopic strain field reads $\\boldsymbol{\\varepsilon}(\\boldsymbol{x}) = \\bar{\\boldsymbol{E}} + \\boldsymbol{\\varepsilon}(\\boldsymbol{w}(\\boldsymbol{x}))$. The choice of periodic fluctuations ensures Hill–Mandel macro-homogeneity.\n\nConstitutive model and its consistent tangent:\nWe adopt a hyperelastic energy density\n$$\nW(\\boldsymbol{\\varepsilon}) = \\tfrac{1}{2}\\,\\boldsymbol{\\varepsilon}:\\mathbb{C}_{\\text{lin}}:\\boldsymbol{\\varepsilon} + \\tfrac{\\beta}{3}\\,(\\operatorname{tr}\\boldsymbol{\\varepsilon})^3,\n$$\nwhere $\\mathbb{C}_{\\text{lin}}$ is the isotropic plane-strain stiffness tensor parametrized by Lamé constants $(\\lambda,\\mu)$, and $\\beta \\ge 0$ introduces a volumetric cubic nonlinearity. The Cauchy stress and consistent tangent follow from differentiation:\n$$\n\\boldsymbol{\\sigma} = \\frac{\\partial W}{\\partial \\boldsymbol{\\varepsilon}} = \\mathbb{C}_{\\text{lin}}:\\boldsymbol{\\varepsilon} + \\beta\\,(\\operatorname{tr}\\boldsymbol{\\varepsilon})^2\\,\\boldsymbol{I},\\quad\n\\mathbb{C} = \\frac{\\partial \\boldsymbol{\\sigma}}{\\partial \\boldsymbol{\\varepsilon}} = \\mathbb{C}_{\\text{lin}} + 2\\beta\\,(\\operatorname{tr}\\boldsymbol{\\varepsilon})\\,\\boldsymbol{I}\\otimes\\boldsymbol{I}.\n$$\nIn Voigt notation with tensorial shear, the plane-strain linear stiffness is\n$$\n\\mathbb{C}_{\\text{lin}}^{\\text{Voigt}} =\n\\begin{bmatrix}\n\\lambda + 2\\mu & \\lambda & 0\\\\\n\\lambda & \\lambda + 2\\mu & 0\\\\\n0 & 0 & 2\\mu\n\\end{bmatrix},\n$$\nand the nonlinear addition is\n$$\n\\mathbb{C}_{\\text{nl}}^{\\text{Voigt}} =\n\\begin{bmatrix}\n2\\beta\\,\\operatorname{tr}\\boldsymbol{\\varepsilon} & 2\\beta\\,\\operatorname{tr}\\boldsymbol{\\varepsilon} & 0\\\\\n2\\beta\\,\\operatorname{tr}\\boldsymbol{\\varepsilon} & 2\\beta\\,\\operatorname{tr}\\boldsymbol{\\varepsilon} & 0\\\\\n0 & 0 & 0\n\\end{bmatrix}.\n$$\n\nMicroscale weak form and discretization:\nThe microscopic equilibrium arises from the stationarity of the total potential with periodic variations $\\delta \\boldsymbol{w}$:\n$$\n\\delta \\Pi(\\boldsymbol{w};\\bar{\\boldsymbol{E}}) = \\int_{\\Omega}\\boldsymbol{\\sigma}(\\bar{\\boldsymbol{E}} + \\boldsymbol{\\varepsilon}(\\boldsymbol{w})):\\boldsymbol{\\varepsilon}(\\delta \\boldsymbol{w})\\,\\mathrm{d}V = 0.\n$$\nDiscretize $\\boldsymbol{w}$ with bilinear quadrilateral elements and associated $C^0$ shape functions. Let $\\boldsymbol{w}_h$ denote the vector of nodal fluctuation unknowns (after periodic identification and fixing a reference node). The finite element residual is\n$$\n\\boldsymbol{R}(\\boldsymbol{w}_h; \\bar{\\boldsymbol{E}}) = \\sum_{e}\\int_{\\Omega_e} \\boldsymbol{B}_e^{\\mathsf{T}}(\\boldsymbol{x})\\,\\boldsymbol{\\sigma}(\\bar{\\boldsymbol{E}} + \\boldsymbol{B}_e(\\boldsymbol{x})\\boldsymbol{w}_{e})\\,\\mathrm{d}V,\n$$\nwhere $\\boldsymbol{B}_e$ is the standard small-strain matrix mapping element nodal displacements to the vector of strains $[\\varepsilon_{11},\\varepsilon_{22},\\varepsilon_{12}]^{\\mathsf{T}}$ with tensorial shear $\\varepsilon_{12} = \\tfrac{1}{2}\\left(\\partial u_1/\\partial y + \\partial u_2/\\partial x\\right)$. The Newton linearization yields the tangent\n$$\n\\boldsymbol{K}_{ww} = \\frac{\\partial \\boldsymbol{R}}{\\partial \\boldsymbol{w}_h} = \\sum_e \\int_{\\Omega_e}\\boldsymbol{B}_e^{\\mathsf{T}}\\,\\mathbb{C}(\\bar{\\boldsymbol{E}} + \\boldsymbol{B}_e\\boldsymbol{w}_e)\\,\\boldsymbol{B}_e\\,\\mathrm{d}V,\n$$\nand Newton’s method iterates $\\boldsymbol{K}_{ww}\\,\\Delta \\boldsymbol{w}_h = -\\boldsymbol{R}$ to equilibrium.\n\nMacroscale stress and consistent tangent:\nThe homogenized Cauchy stress is the volume average\n$$\n\\bar{\\boldsymbol{\\sigma}}(\\bar{\\boldsymbol{E}}) = \\frac{1}{|\\Omega|}\\int_{\\Omega}\\boldsymbol{\\sigma}\\left(\\bar{\\boldsymbol{E}} + \\boldsymbol{B}(\\boldsymbol{x})\\boldsymbol{w}_h(\\bar{\\boldsymbol{E}})\\right)\\,\\mathrm{d}V,\n$$\nwith the element-level contribution computed by quadrature. To obtain the macroscopic consistent tangent $\\mathbb{C}^{\\text{eff}} = \\partial \\bar{\\boldsymbol{\\sigma}}/\\partial \\bar{\\boldsymbol{E}}$, we linearize $\\bar{\\boldsymbol{\\sigma}}$:\n$$\n\\mathrm{d}\\bar{\\boldsymbol{\\sigma}} = \\frac{1}{|\\Omega|}\\int_{\\Omega}\\mathbb{C}\\,\\mathrm{d}\\boldsymbol{\\varepsilon}\\,\\mathrm{d}V\n= \\frac{1}{|\\Omega|}\\int_{\\Omega}\\mathbb{C}\\left(\\mathrm{d}\\bar{\\boldsymbol{E}} + \\boldsymbol{B}\\,\\mathrm{d}\\boldsymbol{w}_h\\right)\\mathrm{d}V.\n$$\nThe fluctuation increment $\\mathrm{d}\\boldsymbol{w}_h$ is not independent because the microscale residual must remain zero under the perturbation. Linearizing the microscale residual gives\n$$\n\\mathrm{d}\\boldsymbol{R} = \\boldsymbol{K}_{ww}\\,\\mathrm{d}\\boldsymbol{w}_h + \\boldsymbol{K}_{wE}\\,\\mathrm{d}\\bar{\\boldsymbol{E}} = \\boldsymbol{0},\n$$\nwith\n$$\n\\boldsymbol{K}_{wE} = \\frac{\\partial \\boldsymbol{R}}{\\partial \\bar{\\boldsymbol{E}}} = \\sum_e \\int_{\\Omega_e}\\boldsymbol{B}_e^{\\mathsf{T}}\\,\\mathbb{C}\\,\\mathrm{d}V,\n$$\nso that $\\mathrm{d}\\boldsymbol{w}_h = -\\boldsymbol{K}_{ww}^{-1}\\boldsymbol{K}_{wE}\\,\\mathrm{d}\\bar{\\boldsymbol{E}}$. Substituting back into $\\mathrm{d}\\bar{\\boldsymbol{\\sigma}}$ gives\n$$\n\\mathrm{d}\\bar{\\boldsymbol{\\sigma}} = \\left[\\frac{1}{|\\Omega|}\\int_{\\Omega}\\mathbb{C}\\,\\mathrm{d}V\\right]\\mathrm{d}\\bar{\\boldsymbol{E}}\n-\n\\left[\\frac{1}{|\\Omega|}\\int_{\\Omega}\\mathbb{C}\\,\\boldsymbol{B}\\,\\mathrm{d}V\\right]\\boldsymbol{K}_{ww}^{-1}\\left[\\sum_e \\int_{\\Omega_e}\\boldsymbol{B}_e^{\\mathsf{T}}\\,\\mathbb{C}\\,\\mathrm{d}V\\right]\\mathrm{d}\\bar{\\boldsymbol{E}}.\n$$\nThis provides a computable expression for the consistent homogenized tangent once the microscale equilibrium is solved. In matrix-block notation, define\n$$\n\\boldsymbol{S}_E = \\frac{1}{|\\Omega|}\\int_{\\Omega}\\mathbb{C}\\,\\mathrm{d}V,\\quad\n\\boldsymbol{S}_w = \\frac{1}{|\\Omega|}\\int_{\\Omega}\\mathbb{C}\\,\\boldsymbol{B}\\,\\mathrm{d}V,\\quad\n\\boldsymbol{K}_{wE} = \\int_{\\Omega}\\boldsymbol{B}^{\\mathsf{T}}\\,\\mathbb{C}\\,\\mathrm{d}V,\n$$\nto obtain\n$$\n\\mathbb{C}^{\\text{eff}} = \\boldsymbol{S}_E - \\boldsymbol{S}_w\\,\\boldsymbol{K}_{ww}^{-1}\\,\\boldsymbol{K}_{wE}.\n$$\nAll terms are assembled by finite elements at the converged microscale state.\n\nFinite-difference verification:\nFor a given $\\bar{\\boldsymbol{E}}$, perform a central finite-difference approximation of $\\partial \\bar{\\boldsymbol{\\sigma}}/\\partial \\bar{E}_j$ by solving the microscale equilibrium at $\\bar{\\boldsymbol{E}}\\pm \\delta \\boldsymbol{e}_j$ and forming\n$$\n\\left.\\frac{\\partial \\bar{\\boldsymbol{\\sigma}}}{\\partial \\bar{E}_j}\\right|_{\\text{FD}} \\approx \\frac{\\bar{\\boldsymbol{\\sigma}}(\\bar{\\boldsymbol{E}}+\\delta \\boldsymbol{e}_j) - \\bar{\\boldsymbol{\\sigma}}(\\bar{\\boldsymbol{E}}-\\delta \\boldsymbol{e}_j)}{2\\delta}.\n$$\nCollect these columns to form $\\mathbb{C}^{\\text{FD}}$ and compare with $\\mathbb{C}^{\\text{eff}}$ using the relative Frobenius-norm error\n$$\n\\mathrm{err} = \\frac{\\|\\mathbb{C}^{\\text{eff}} - \\mathbb{C}^{\\text{FD}}\\|_{\\mathrm{F}}}{\\max(\\|\\mathbb{C}^{\\text{eff}}\\|_{\\mathrm{F}},\\,10^{-14})}.\n$$\n\nAlgorithmic design:\n- Build a uniform $2\\times 2$ mesh on the unit square, assemble element connectivity and coordinates.\n- Implement periodic identification by mapping nodes with $x=1$ to $x=0$ and $y=1$ to $y=0$ to form master nodes; eliminate the rigid-body mode by fixing the fluctuation at the master node at the origin.\n- For each test case, set the heterogeneous material parameters by checkerboard assignment using element-center coordinates.\n- Given $\\bar{\\boldsymbol{E}}$, solve the microscale equilibrium by Newton’s method:\n  1. Assemble the residual $\\boldsymbol{R}$ and tangent $\\boldsymbol{K}_{ww}$ using Gaussian quadrature and the current $\\boldsymbol{w}_h$.\n  2. Solve $\\boldsymbol{K}_{ww}\\,\\Delta \\boldsymbol{w}_h = -\\boldsymbol{R}$ and update $\\boldsymbol{w}_h$.\n  3. Stop when the residual norm falls below a prescribed tolerance or a maximum number of iterations is reached.\n- At convergence, assemble $\\boldsymbol{S}_E$, $\\boldsymbol{S}_w$, $\\boldsymbol{K}_{wE}$, compute $\\mathbb{C}^{\\text{eff}} = \\boldsymbol{S}_E - \\boldsymbol{S}_w\\,\\boldsymbol{K}_{ww}^{-1}\\,\\boldsymbol{K}_{wE}$, and compute $\\bar{\\boldsymbol{\\sigma}}$.\n- For finite differences, perturb each component of $\\bar{\\boldsymbol{E}}$ by $\\pm \\delta$, re-solve the microscale equilibrium, and assemble $\\mathbb{C}^{\\text{FD}}$ from the central differences of $\\bar{\\boldsymbol{\\sigma}}$.\n- Report the relative error $\\mathrm{err}$ for each test as a floating-point number. Aggregate the three errors into a single line in the prescribed format.\n\nCoverage of the test suite:\n- Test $1$ exercises a general heterogeneous, nonlinear, mixed-loading state and validates the full condensation procedure.\n- Test $2$ is a pure shear state with zero volumetric strain, deactivating the cubic volumetric nonlinearity (since $\\operatorname{tr}\\boldsymbol{\\varepsilon}=0$), stressing the shear consistency and the mapping of tensorial shear.\n- Test $3$ is at zero macroscopic strain, probing the near-linear regime and ensuring that the periodic microfluctuation solution and linearization are handled correctly.\n\nAll computations are nondimensional, angles do not appear, and no physical units are required. The final output must be a single line with the three error values in a list format.", "answer": "[4.523473e-08,3.891120e-08,1.987451e-08]", "id": "2623507"}]}