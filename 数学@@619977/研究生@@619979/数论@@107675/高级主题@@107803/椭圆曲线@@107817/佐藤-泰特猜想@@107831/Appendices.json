{"hands_on_practices": [{"introduction": "要真正掌握佐藤-泰特猜想，第一步是熟悉其核心对象——弗罗贝尼乌斯迹 $a_p(E)$。本练习提供了一个基础的计算实践，通过对一个具体的椭圆曲线在小素数域上直接数点，让您亲手计算出 $a_p(E)$ 的值。这个过程不仅能加深您对 $a_p(E)$ 定义的理解，还能让您直观地验证哈塞界这一基本不等式。[@problem_id:3029366]", "problem": "设 $E$ 是定义在 $\\mathbb{Q}$ 上的椭圆曲线，由 $E: y^2 = x^3 - x$ 给出。对于一个好约化素数 $p$（即 $p \\nmid \\Delta(E)$），其弗罗贝尼乌斯迹 $a_p(E)$ 由关系式 $a_p(E) := p + 1 - \\#E(\\mathbb{F}_p)$ 定义，其中 $\\#E(\\mathbb{F}_p)$ 表示 $E$ 上 $\\mathbb{F}_p$-有理点的个数。佐藤-泰特猜想关注的是当 $p$ 变化时，归一化量 $a_p(E)/(2\\sqrt{p})$ 的统计分布，并且对于任何定义在 $\\mathbb{Q}$ 上的椭圆曲线，哈塞界 $|a_p(E)| \\leq 2\\sqrt{p}$ 都成立。该曲线 $E$ 具有被 $\\mathbb{Z}[i]$ 的复乘（Complex Multiplication, CM），因此其佐藤-泰特行为是非典型的，但哈塞界仍然有效。\n\n从椭圆曲线在有限域上的基本定义以及通过二次剩余计算点数的方法出发，计算素数 $p \\in \\{3, 5, 7, 11, 13\\}$ 对应的 $a_p(E)$，所有这些素数都是 $E$ 的好约化素数。通过计算 $y^2 = x^3 - x$ 的解 $(x,y) \\in \\mathbb{F}_p \\times \\mathbb{F}_p$ 的数量并加上无穷远点，来明确确定 $\\#E(\\mathbb{F}_p)$，然后计算 $a_p(E) = p + 1 - \\#E(\\mathbb{F}_p)$。对每个素数数值验证哈塞界 $|a_p(E)| \\leq 2\\sqrt{p}$ 是否成立。\n\n将您计算出的值以单行向量 $\\bigl(a_3(E), a_5(E), a_7(E), a_{11}(E), a_{13}(E)\\bigr)$ 的形式报告。", "solution": "问题是为椭圆曲线 $E: y^2 = x^3 - x$ 和一组素数 $p \\in \\{3, 5, 7, 11, 13\\}$ 计算弗罗贝尼乌斯迹 $a_p(E)$。\n\n首先，我们验证问题陈述。曲线为 $E: y^2 = x^3 - x$。判别式为 $\\Delta = -16(4A^3 + 27B^2)$，其中 $A=-1$，$B=0$。因此，$\\Delta = -16(4(-1)^3) = 64 = 2^6$。坏约化素数是 $\\Delta$ 的素因子，这里只有 $p=2$。给定集合 $\\{3, 5, 7, 11, 13\\}$ 中的所有素数都是好约化素数。问题陈述是科学上合理的、自洽的且提法得当的。我们可以继续进行解答。\n\n$E$ 上的 $\\mathbb{F}_p$-有理点个数，记为 $\\#E(\\mathbb{F}_p)$，是满足曲线方程的数对 $(x, y) \\in \\mathbb{F}_p \\times \\mathbb{F}_p$ 的数量，再加上无穷远点 $\\mathcal{O}$。对于每个 $x \\in \\mathbb{F}_p$，我们计算 $f(x) = x^3 - x$ 的值。方程 $y^2 = f(x)$ 中 $y$ 的解的数量取决于 $f(x)$ 是模 $p$ 的二次剩余、二次非剩余还是零。\n- 如果 $f(x) = 0$，则 $y$ 有一个解，即 $y=0$。\n- 如果 $f(x)$ 是模 $p$ 的非零二次剩余，则 $y$ 有两个解。\n- 如果 $f(x)$ 是模 $p$ 的二次非剩余，则 $y$ 没有解。\n\n仿射点的数量是对于所有可能的 $x \\in \\mathbb{F}_p$ 值，$y$ 的解的数量之和。\n$\\#E(\\mathbb{F}_p) = 1 + (\\text{仿射点的数量})$。\n然后弗罗贝尼乌斯迹按 $a_p(E) = p + 1 - \\#E(\\mathbb{F}_p)$ 计算。\n\n我们现在为每个指定的素数计算 $a_p(E)$。\n\n**情况 1: $p=3$**\n我们在 $\\mathbb{F}_3 = \\{0, 1, 2\\}$ 中进行计算。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0^3 - 0 = 0$。这给出一个 $y$ 的解，$y=0$。点：$(0,0)$。\n- $x=1: f(1)=1^3 - 1 = 0$。这给出一个 $y$ 的解，$y=0$。点：$(1,0)$。\n- $x=2: f(2)=2^3 - 2 = 8-2 = 6 \\equiv 0 \\pmod 3$。这给出一个 $y$ 的解，$y=0$。点：$(2,0)$。\n仿射点的数量为 $1+1+1=3$。\n$\\#E(\\mathbb{F}_3) = 1 + 3 = 4$。\n$a_3(E) = 3 + 1 - \\#E(\\mathbb{F}_3) = 4 - 4 = 0$。\n哈塞界验证：$|a_3(E)| \\leq 2\\sqrt{3} \\implies 0 \\leq 2\\sqrt{3} \\approx 3.46$。此式成立。\n\n**情况 2: $p=5$**\n我们在 $\\mathbb{F}_5 = \\{0, 1, 2, 3, 4\\}$ 中进行计算。二次剩余为 $\\{1^2, 2^2\\} \\pmod 5 = \\{1, 4\\}$。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0$。一个 $y$ 的解：$(0,0)$。\n- $x=1: f(1)=0$。一个 $y$ 的解：$(1,0)$。\n- $x=2: f(2)=2^3 - 2 = 6 \\equiv 1 \\pmod 5$。二次剩余。两个 $y$ 的解：$y=\\pm 1 \\equiv 1, 4$。点：$(2,1), (2,4)$。\n- $x=3: f(3)=3^3 - 3 = 24 \\equiv 4 \\pmod 5$。二次剩余。两个 $y$ 的解：$y=\\pm 2 \\equiv 2, 3$。点：$(3,2), (3,3)$。\n- $x=4: f(4)=4^3 - 4 = 60 \\equiv 0 \\pmod 5$。一个 $y$ 的解：$(4,0)$。\n仿射点的数量为 $1+1+2+2+1=7$。\n$\\#E(\\mathbb{F}_5) = 1 + 7 = 8$。\n$a_5(E) = 5 + 1 - \\#E(\\mathbb{F}_5) = 6 - 8 = -2$。\n哈塞界验证：$|a_5(E)| \\leq 2\\sqrt{5} \\implies |-2| \\leq 2\\sqrt{5} \\implies 2 \\leq 2(2.236...) \\approx 4.47$。此式成立。\n\n**情况 3: $p=7$**\n我们在 $\\mathbb{F}_7 = \\{0, ..., 6\\}$ 中进行计算。二次剩余为 $\\{1^2, 2^2, 3^2\\} \\pmod 7 = \\{1, 4, 2\\}$。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0$。一个 $y$ 的解。\n- $x=1: f(1)=0$。一个 $y$ 的解。\n- $x=2: f(2)=2^3 - 2 = 6$。二次非剩余。无解。\n- $x=3: f(3)=3^3 - 3 = 24 \\equiv 3 \\pmod 7$。二次非剩余。无解。\n- $x=4: f(4)=4^3 - 4 = 60 \\equiv 4 \\pmod 7$。二次剩余。两个 $y$ 的解。\n- $x=5: f(5)=5^3 - 5 = 120 \\equiv 1 \\pmod 7$。二次剩余。两个 $y$ 的解。\n- $x=6: f(6)=6^3 - 6 = 210 \\equiv 0 \\pmod 7$。一个 $y$ 的解。\n仿射点的数量为 $1+1+0+0+2+2+1=7$。\n$\\#E(\\mathbb{F}_7) = 1 + 7 = 8$。\n$a_7(E) = 7 + 1 - \\#E(\\mathbb{F}_7) = 8 - 8 = 0$。\n哈塞界验证：$|a_7(E)| \\leq 2\\sqrt{7} \\implies 0 \\leq 2\\sqrt{7} \\approx 5.29$。此式成立。\n\n**情况 4: $p=11$**\n我们在 $\\mathbb{F}_{11}$ 中进行计算。二次剩余为 $\\{1^2, 2^2, 3^2, 4^2, 5^2\\} \\pmod{11} = \\{1, 4, 9, 5, 3\\}$。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0$。一个 $y$ 的解。\n- $x=1: f(1)=0$。一个 $y$ 的解。\n- $x=2: f(2)=6$。非剩余。无解。\n- $x=3: f(3)=24 \\equiv 2$。非剩余。无解。\n- $x=4: f(4)=60 \\equiv 5$。剩余。两个解。\n- $x=5: f(5)=120 \\equiv 10$。非剩余。无解。\n- $x=6: f(6)=210 \\equiv 1$。剩余。两个解。\n- $x=7: f(7)=336 \\equiv 6$。非剩余。无解。\n- $x=8: f(8)=504 \\equiv 9$。剩余。两个解。\n- $x=9: f(9)=720 \\equiv 5$。剩余。两个解。\n- $x=10: f(10)=990 \\equiv 0$。一个 $y$ 的解。\n仿射点的数量为 $1+1+0+0+2+0+2+0+2+2+1=11$。\n$\\#E(\\mathbb{F}_{11}) = 1 + 11 = 12$。\n$a_{11}(E) = 11 + 1 - \\#E(\\mathbb{F}_{11}) = 12 - 12 = 0$。\n哈塞界验证：$|a_{11}(E)| \\leq 2\\sqrt{11} \\implies 0 \\leq 2\\sqrt{11} \\approx 6.63$。此式成立。\n\n**情况 5: $p=13$**\n我们在 $\\mathbb{F}_{13}$ 中进行计算。二次剩余为 $\\{1^2,...,6^2\\} \\pmod{13} = \\{1, 4, 9, 3, 12, 10\\}$。\n$f(x) = x^3 - x$ 的值为：\n- $x=0: f(0)=0$。一个解。\n- $x=1: f(1)=0$。一个解。\n- $x=2: f(2)=6$。非剩余。无解。\n- $x=3: f(3)=24 \\equiv 11$。非剩余。无解。\n- $x=4: f(4)=60 \\equiv 8$。非剩余。无解。\n- $x=5: f(5)=120 \\equiv 3$。剩余。两个解。\n- $x=6: f(6)=210 \\equiv 2$。非剩余。无解。\n- $x=7: f(7)=336 \\equiv 11$。非剩余。无解。\n- $x=8: f(8)=504 \\equiv 10$。剩余。两个解。\n- $x=9: f(9)=720 \\equiv 5$。非剩余。无解。\n- $x=10: f(10)=990 \\equiv 2$。非剩余。无解。\n- $x=11: f(11)=1320 \\equiv 11$。非剩余。无解。\n- $x=12: f(12)=(-1)^3 - (-1)=0$。一个解。\n仿射点的数量为 $1+1+0+0+0+2+0+0+2+0+0+0+1=7$。\n$\\#E(\\mathbb{F}_{13}) = 1 + 7 = 8$。\n$a_{13}(E) = 13 + 1 - \\#E(\\mathbb{F}_{13}) = 14 - 8 = 6$。\n哈塞界验证：$|a_{13}(E)| \\leq 2\\sqrt{13} \\implies |6| \\leq 2\\sqrt{13} \\implies 6 \\leq 2(3.605...) \\approx 7.21$。此式成立。\n\n计算出的值为：\n$a_3(E) = 0$\n$a_5(E) = -2$\n$a_7(E) = 0$\n$a_{11}(E) = 0$\n$a_{13}(E) = 6$\n\n最终结果是行向量 $(a_3(E), a_5(E), a_7(E), a_{11}(E), a_{13}(E))$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & -2 & 0 & 0 & 6\n\\end{pmatrix}\n}\n$$", "id": "3029366"}, {"introduction": "具有复乘（CM）的椭圆曲线在数论中扮演着特殊的角色，它们的弗罗贝尼乌斯迹分布并不遵循标准的佐藤-泰特定律。本练习将引导您深入探索 CM 曲线的一个独特算术性质：计算 $a_p=0$ 的素数所占的密度。通过将该问题与 CM 域中素数的分解行为联系起来，并运用深刻的切博塔廖夫密度定理，您将体会到代数数论工具在分析椭圆曲线算术性质时的强大威力。[@problem_id:3029344]", "problem": "设 $E/\\mathbb{Q}$ 是一条椭圆曲线，其复乘(CM)环为虚二次域 $K$ 的全整数环 $\\mathcal{O}_{K}$。记 $N$ 为 $E$ 的导子，对每个不整除 $N$ 的有理素数 $p$，记 $a_{p} := p + 1 - \\#E(\\mathbb{F}_{p})$，它是弗罗贝尼乌斯自同态作用在第一étale上同调群 $H^{1}_{\\text{et}}(E_{\\overline{\\mathbb{Q}}}, \\mathbb{Q}_{\\ell})$ (对任意素数 $\\ell \\neq p$) 上的迹。考虑自然密度\n$$\nd := \\lim_{x \\to \\infty} \\frac{\\#\\{\\, p \\leq x \\text{ prime} : p \\nmid N \\text{ and } a_{p} = 0 \\,\\}}{\\#\\{\\, p \\leq x \\text{ prime} \\,\\}}.\n$$\n从关于 CM 椭圆曲线、K 的 Hecke (Grössen-) 特征以及域扩张 $K/\\mathbb{Q}$ 的切博塔廖夫密度定理等基本事实出发，通过将条件 $a_{p} = 0$ 与 $p$ 在 $K/\\mathbb{Q}$ 中的分裂行为联系起来，然后通过切博塔廖夫定理计算该密度，来确定 $d$ 的精确值。将最终答案表示为最简形式的单个有理数。无需四舍五入，也无需报告单位。", "solution": "题目要求计算有理素数 $p$ 的自然密度 $d$，对于这些素数 $p$，具有虚二次域 $K$ 全整数环 $\\mathcal{O}_K$ 复乘(CM)的椭圆曲线 $E/\\mathbb{Q}$ 的弗罗贝尼乌斯迹 $a_p$ 为零。素数集合被限制为 $E$ 具有良好约化 (good reduction) 的那些素数，即 $p \\nmid N$，其中 $N$ 是 $E$ 的导子。\n\n弗罗贝尼乌斯迹 $a_p$ 定义为 $a_p = p + 1 - \\#E(\\mathbb{F}_p)$，其中 $E(\\mathbb{F}_p)$ 是 $E$ 模 $p$ 约化后的曲线上点的群。复乘理论中的一个基本结果，由马克斯·丢番图的理论阐明，将 $a_p$ 的值与 CM 域 $K$ 的算术联系起来。\n\n对于 $E$ 具有良好约化的素数 $p$，条件 $a_p = 0$ 等价于有限域 $\\mathbb{F}_p$ 上的约化曲线 $E_p := E \\pmod{p}$ 是超奇异的 (supersingular)。\n\n丢番图的超奇异性判别法指出，对于一个 CM 环为虚二次域 $K$ 中某个整环 (order) 的椭圆曲线，其在良好约化素数 $p$ 处的约化 $E_p$ 是超奇异的，当且仅当素数 $p$ 在域 $K$ 中不分裂。\n\n我们所考虑的素数 $p$ 不整除导子 $N$。CM 椭圆曲线理论中的一个标准结果是，域 $K$ 的判别式的任何素因子都必须是导子 $N$ 的因子。因此，如果 $p \\nmid N$，那么 $p$ 在扩张 $K/\\mathbb{Q}$ 中是未分歧的 (unramified)。\n\n对于二次扩张 $K/\\mathbb{Q}$ 中的一个未分歧素数 $p$，其行为有两种可能性：要么 $p$ 在 $\\mathcal{O}_K$ 中分裂成两个不同的素理想，要么 $p$ 保持为素数（即它是惰性的, inert）。因此，对于一个未分歧素数，$p$ 不分裂的条件等价于 $p$ 在 $K$ 中是惰性的。\n\n综合这些事实，对于素数 $p \\nmid N$，条件 $a_p = 0$ 等价于 $p$ 在二次扩张 $K/\\mathbb{Q}$ 中是惰性素数。问题因此简化为计算在 $K$ 中惰性的素数的密度。\n\n这个密度可以用切博塔廖夫密度定理来确定。扩张 $K/\\mathbb{Q}$ 是一个伽罗瓦扩张，因为它是一个二次扩张。其次数为 $[K:\\mathbb{Q}] = 2$。相关的伽罗瓦群 $G := \\text{Gal}(K/\\mathbb{Q})$ 是一个 2 阶群，包含单位元 $e$ 和一个非平凡元 $\\sigma$，$\\sigma$ 对应于复共轭。\n\n切博塔廖夫密度定理指出，对于数域的伽罗瓦扩张 $L/F$ 及其伽罗瓦群 $G$，F 的未分歧素数 $\\mathfrak{p}$ 中，其弗罗贝尼乌斯共轭类为 $G$ 中给定类 $C$ 的素数集合，具有等于 $|C|/|G|$ 的自然密度。\n\n在我们的例子中，$F = \\mathbb{Q}$ 且 $L = K$。群 $G$ 是阿贝尔群，所以每个共轭类只包含一个元素。群 $G$ 有两个这样的类：$\\{e\\}$ 和 $\\{\\sigma\\}$。\n一个未分歧有理素数 $p$ 在 $K$ 中的分裂行为由其弗罗贝尼乌斯元 $\\text{Frob}_p \\in G$ 决定：\n- 素数 $p$ 在 $K$ 中分裂，当且仅当其弗罗贝尼乌斯元是单位元：$\\text{Frob}_p = e$。\n- 素数 $p$ 在 $K$ 中是惰性的，当且仅当其弗罗贝尼乌斯元是非平凡元：$\\text{Frob}_p = \\sigma$。\n\n根据切博塔廖夫密度定理，惰性素数的密度就是满足 $\\text{Frob}_p = \\sigma$ 的素数 $p$ 的密度。该密度由下式给出：\n$$\n\\text{惰性素数的密度} = \\frac{|\\{\\sigma\\}|}{|G|} = \\frac{1}{2}\n$$\n类似地，分裂素数的密度是 $\\frac{|\\{e\\}|}{|G|} = \\frac{1}{2}$。分歧素数构成一个有限集，因此其密度为 0。\n\n题目说明 $E$ 定义在 $\\mathbb{Q}$ 上，并且其 CM 环为全整数环 $\\mathcal{O}_K$。这意味着 $K$ 的希尔伯特类域包含在 $\\mathbb{Q}(j(E))$ 中，而后者即为 $\\mathbb{Q}$。这仅在 $K$ 的类数 $h_K$ 为 1 时才可能。类数为 1 的虚二次域是 $K = \\mathbb{Q}(\\sqrt{-m})$，其中 $m \\in \\{1, 2, 3, 7, 11, 19, 43, 67, 163\\}$。然而，惰性素数密度的计算仅取决于扩张 $K/\\mathbb{Q}$ 的次数，对于任何虚二次域，该次数均为 2。$K$ 的具体选择（从允许的列表中）不影响结果。\n\n密度 $d$ 是使得 $a_p=0$ 的素数 $p$（不包括整除 $N$ 的有限集）的密度。这等价于在 $K$ 中惰性的素数的密度。因此，$d$ 的值为 $1/2$。", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "3029344"}, {"introduction": "在现代数论研究中，数值实验是提出和检验猜想不可或缺的工具。本综合练习将指导您设计并实施一个完整的计算项目，以经验性地检验非 CM 椭圆曲线的佐藤-泰特猜想。您将学习如何生成数据、实现不同的分箱策略，并使用 Kolmogorov-Smirnov 检验和卡方检验等统计方法来评估拟合优度，从而获得近似于真实研究的实践体验。[@problem_id:3029347]", "problem": "您将实现一个完整的、可运行的程序，以数值方式检验与椭圆曲线的归一化弗罗贝尼乌斯迹相关的角度的经验分布是否符合理论上的佐藤-泰特分布。您的实现必须基于以下基本定义和经过充分检验的事实：\n\n1. 有限域上的椭圆曲线在短 Weierstrass 形式下由仿射方程 $E : y^2 = x^3 + a x + b$ 给出，其中系数 $a$ 和 $b$ 为整数，且判别式 $\\Delta = -16 (4 a^3 + 27 b^2)$ 非零。对于一个具有良好约化（good reduction）的素数 $p \\geq 5$（即 $p \\nmid \\Delta$），$E$ 上的 $\\mathbb{F}_p$-点数满足哈塞界，且弗罗贝尼乌斯迹 $a_p$ 定义为 $a_p = p + 1 - \\#E(\\mathbb{F}_p)$。\n\n2. 对于非复乘（non-CM）椭圆曲线，佐藤-泰特猜想（现已在许多情况下成为定理）描述了角度 $\\theta_p \\in [0,\\pi]$ 的渐近均匀分布。这些角度是通过 $a_p / (2 \\sqrt{p}) = \\cos(\\theta_p)$ 对 $a_p$ 进行归一化定义的，其中角度在区间 $[0,\\pi]$ 上以密度函数 $f(\\theta) = \\frac{2}{\\pi} \\sin^2(\\theta)$ 分布。相应的累积分布函数（CDF）是\n$$\nF(\\theta) = \\int_0^\\theta \\frac{2}{\\pi} \\sin^2(t) \\, dt = \\frac{\\theta}{\\pi} - \\frac{\\sin(2\\theta)}{2\\pi}.\n$$\n\n3. 对于 $p \\geq 5$，$E(\\mathbb{F}_p)$ 上的点数可以通过以下恒等式高效计算：\n$$\n\\#E(\\mathbb{F}_p) = 1 + \\sum_{x \\in \\mathbb{F}_p} \\left(1 + \\chi\\big(x^3 + a x + b\\big)\\right),\n$$\n其中 $\\chi$ 是勒让德符号，并扩展定义 $\\chi(0) = 0$。如果 $u$ 是模 $p$ 的二次剩余，则 $\\chi(u)$ 等于 $1$；如果 $u$ 是非二次剩余，则等于 $-1$；如果 $u \\equiv 0 \\pmod{p}$，则等于 $0$。此公式计算了对于每个 $x \\in \\mathbb{F}_p$，满足 $y^2 = x^3 + a x + b$ 的 $y$ 的数量，并加上无穷远点。\n\n您的程序必须：\n- 在给定范围 $[P_{\\min}, P_{\\max}]$ 内生成素数，排除整除判别式 $\\Delta$ 的素数，并对剩余的素数计算 $a_p$，然后在弧度制下通过 $\\theta_p = \\arccos\\!\\left(\\frac{a_p}{2\\sqrt{p}}\\right)$ 计算 $\\theta_p$。\n- 实现两种对区间 $[0,\\pi]$ 的分箱策略：\n  1. 均匀角度分箱（Uniform-angle binning）：$B$ 个等宽度的分箱，其边界为 $\\left\\{0, \\frac{\\pi}{B}, \\frac{2\\pi}{B}, \\ldots, \\pi\\right\\}$。\n  2. 佐藤-泰特等质量分箱（Sato–Tate equal-mass binning）：$B$ 个分箱，其边界由 $F(\\theta)$ 的分位数定义，即边界为 $\\{\\theta_k\\}_{k=0}^B$，满足 $F(\\theta_k) = k/B$。这些边界必须对每个 $k$ 在 $[0,\\pi]$ 上使用确定性方法（如二分法）进行单调求根来数值计算。\n- 对每个 $\\{\\theta_p\\}$ 样本实现计算：\n  1. 柯尔莫哥洛夫-斯米尔诺夫 (Kolmogorov–Smirnov, KS) 统计量，定义为经验累积分布函数（CDF）与理论佐藤-泰特 CDF $F(\\theta)$ 之间绝对差的上确界。具体来说，如果 $\\theta_{(1)} \\leq \\theta_{(2)} \\leq \\cdots \\leq \\theta_{(n)}$ 是排序后的角度，则定义经验 CDF $\\widehat{F}_n$ 为 $\\widehat{F}_n(\\theta_{(j)}) = j/n$（对于 $j=1,\\ldots,n$），并计算\n  $$\n  D_n = \\max\\Bigg\\{\\max_{1 \\leq j \\leq n}\\left(\\frac{j}{n} - F(\\theta_{(j)})\\right), \\; \\max_{1 \\leq j \\leq n}\\left(F(\\theta_{(j)}) - \\frac{j-1}{n}\\right)\\Bigg\\}.\n  $$\n  2. 皮尔逊卡方统计量，用于比较分箱计数与在佐藤-泰特定律下的期望计数。如果观测计数为 $O_i$，期望计数为 $E_i = n \\cdot p_i$，其中 $p_i$ 是第 $i$ 个分箱的精确佐藤-泰特质量，通过 $p_i = F(\\text{右边界}) - F(\\text{左边界})$ 计算，则\n  $$\n  \\chi^2 = \\sum_{i=1}^B \\frac{(O_i - E_i)^2}{E_i}.\n  $$\n  3. 跨分箱的最大标准化残差，定义为\n  $$\n  R_{\\max} = \\max_{1 \\leq i \\leq B} \\frac{|O_i - E_i|}{\\sqrt{E_i}}.\n  $$\n\n所有角度必须以弧度计算和报告。不涉及物理单位。不得使用百分比；所有概率必须表示为十进制小数（浮点数）。\n\n您必须设计程序以生成一行输出，其中包含一个固定测试套件的结果列表。对于每个测试用例，程序必须输出一个浮点数列表 $[D_n, \\chi^2, R_{\\max}]$。在最终输出中，将每个测试用例的列表聚合到一个单一列表中。\n\n测试套件：\n- 测试用例 1（理想路径，非 CM 曲线，均匀分箱）：$a = 0$，$b = -2$（曲线 $y^2 = x^3 - 2$），$P_{\\min} = 5$，$P_{\\max} = 1500$，$B = 20$，分箱策略 = uniform-angle。\n- 测试用例 2（小样本边界，非 CM 曲线，均匀分箱）：$a = 0$，$b = -2$，$P_{\\min} = 5$，$P_{\\max} = 100$，$B = 10$，分箱策略 = uniform-angle。\n- 测试用例 3（等质量分箱覆盖，非 CM 曲线）：$a = 0$，$b = -2$，$P_{\\min} = 5$，$P_{\\max} = 1500$，$B = 20$，分箱策略 = Sato–Tate equal-mass。\n- 测试用例 4（说明 CM 下失败的边缘案例，均匀分箱）：$a = -1$，$b = 0$（曲线 $y^2 = x^3 - x$，具有复乘），$P_{\\min} = 5$，$P_{\\max} = 1500$，$B = 20$，分箱策略 = uniform-angle。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔的结果列表。每个测试用例对应一个包含三个浮点数 $[D_n, \\chi^2, R_{\\max}]$ 的子列表，因此最终输出必须如下所示：\n\"[[d1,chi1,r1],[d2,chi2,r2],[d3,chi3,r3],[d4,chi4,r4]]\"\n其中 $d_i$、$chi_i$ 和 $r_i$ 是按上述规定精确计算的第 $i$ 个测试用例的浮点数。", "solution": "所给问题要求实现一个用于检验椭圆曲线的佐藤-泰特猜想的数值程序。该解决方案涉及从一条椭圆曲线在不同有限域 $\\mathbb{F}_p$ 上生成佐藤-泰特角度样本 $\\{\\theta_p\\}$，然后应用拟合优度统计检验，将这些角度的经验分布与理论上的佐藤-泰特分布进行比较。实现将分为模块化组件，每个组件对应一个特定的数学原理。\n\n### 原理1：佐藤-泰特角度的生成\n\n第一步是生成数据样本。对于由整数系数 $a$ 和 $b$ 的 Weierstrass 方程 $y^2 = x^3 + ax + b$ 定义的给定椭圆曲线 $E$，我们为一组素数 $p$ 计算佐藤-泰特角度 $\\theta_p$。\n\n**1.1. 椭圆曲线和良好约化素数**\n曲线由 $E: y^2 = x^3 + ax + b$ 定义。为使其成为一条有效的椭圆曲线，其判别式 $\\Delta = -16(4a^3 + 27b^2)$ 必须非零。佐藤-泰特猜想适用于良好约化的素数 $p$，即不整除判别式 $\\Delta$ 的素数。问题指定考虑素数 $p \\geq 5$。我们首先使用埃拉托斯特尼筛法生成给定范围 $[P_{\\min}, P_{\\max}]$ 内的所有素数列表。然后从该列表中排除任何满足 $p | \\Delta$ 的素数 $p$。\n\n**1.2. 点计数与弗罗贝尼乌斯迹**\n对于每个良好约化的素数 $p$，我们必须计算在有限域 $\\mathbb{F}_p$ 上的点数，记为 $\\#E(\\mathbb{F}_p)$。这可以通过涉及勒让德符号的公式完成：\n$$\n\\#E(\\mathbb{F}_p) = 1 + \\sum_{x \\in \\mathbb{F}_p} \\left(1 + \\chi_p(x^3 + ax + b)\\right)\n$$\n这里的求和是对 $\\mathbb{F}_p = \\{0, 1, \\ldots, p-1\\}$ 中的所有元素 $x$ 进行的。求和外的 $1$ 代表无穷远点。勒让德符号 $\\chi_p(u)$ 确定 $u$ 是否为模 $p$ 的二次剩余。其计算方式为：\n$$\n\\chi_p(u) =\n\\begin{cases}\n1 & \\text{如果 } u \\text{ 是模 } p \\text{ 的非零二次剩余} \\\\\n-1 & \\text{如果 } u \\text{ 是模 } p \\text{ 的二次非剩余} \\\\\n0 & \\text{如果 } u \\equiv 0 \\pmod p\n\\end{cases}\n$$\n在计算上，这可以通过欧拉判据高效求得：$\\chi_p(u) \\equiv u^{(p-1)/2} \\pmod p$。模 $p$ 的结果将是 $1$、$p-1$（等价于 $-1$）或 $0$。\n\n一旦知道 $\\#E(\\mathbb{F}_p)$，弗罗贝尼乌斯迹 $a_p$ 定义为：\n$$\na_p = p + 1 - \\#E(\\mathbb{F}_p)\n$$\n\n**1.3. 归一化与角度计算**\n哈塞界保证了 $|a_p| \\leq 2\\sqrt{p}$。这允许对迹进行归一化，以定义一个角度 $\\theta_p \\in [0, \\pi]$：\n$$\n\\cos(\\theta_p) = \\frac{a_p}{2\\sqrt{p}} \\implies \\theta_p = \\arccos\\left(\\frac{a_p}{2\\sqrt{p}}\\right)\n$$\n对于范围内所有有效素数 $p$，这些角度 $\\{\\theta_p\\}$ 的集合构成了我们的统计样本。\n\n### 原理2：拟合优度统计\n\n第二步是将收集到的角度 $\\{\\theta_p\\}$ 的经验分布与理论上的佐藤-泰特分布进行比较。对于非复乘（non-CM）椭圆曲线，猜想其角度遵循概率密度函数 $f(\\theta) = \\frac{2}{\\pi}\\sin^2(\\theta)$ 进行分布。相应的累积分布函数（CDF）是：\n$$\nF(\\theta) = \\int_0^\\theta \\frac{2}{\\pi}\\sin^2(t)\\,dt = \\frac{\\theta}{\\pi} - \\frac{\\sin(2\\theta)}{2\\pi}\n$$\n我们使用这个理论 CDF 来计算三个统计量。设 $n$ 为我们样本中角度的总数。\n\n**2.1. 柯尔莫哥洛夫-斯米尔诺夫 (KS) 统计量 ($D_n$)**\nKS 检验是一种非参数检验，用于比较样本与参考概率分布。它量化了样本的经验 CDF 与理论 CDF 之间的距离。首先，对 $n$ 个角度进行排序：$\\theta_{(1)} \\leq \\theta_{(2)} \\leq \\cdots \\leq \\theta_{(n)}$。经验 CDF $\\widehat{F}_n(\\theta)$ 是一个阶跃函数，在每个数据点上增加 $1/n$。KS 统计量 $D_n$ 是 $\\widehat{F}_n$ 和 $F$ 之间的最大差异：\n$$\nD_n = \\max\\Bigg\\{\\max_{1 \\leq j \\leq n}\\left(\\frac{j}{n} - F(\\theta_{(j)})\\right), \\; \\max_{1 \\leq j \\leq n}\\left(F(\\theta_{(j)}) - \\frac{j-1}{n}\\right)\\Bigg\\}\n$$\n该值捕捉了两个 CDF 之间的最大垂直偏差。较小的 $D_n$ 表示拟合得更好。\n\n**2.2. 卡方 ($\\chi^2$) 统计量与最大标准化残差 ($R_{\\max}$)**\n这些统计量基于对数据进行分箱。区间 $[0, \\pi]$ 被分割成 $B$ 个分箱。\n- **分箱策略：** 需要两种方法：\n    1.  **均匀角度分箱：** 将区间 $[0, \\pi]$ 分成 $B$ 个等宽（宽度为 $\\pi/B$）的分箱。边界为 $\\{0, \\pi/B, 2\\pi/B, \\ldots, \\pi\\}$。\n    2.  **佐藤-泰特等质量分箱：** 选择分箱使得每个分箱包含相等的理论概率质量，即 $1/B$。分箱边界 $\\{\\theta_k\\}_{k=0}^B$ 通过求解方程 $F(\\theta_k) = k/B$ 来确定，其中 $k \\in \\{0, 1, \\ldots, B\\}$。这是一个求根问题。由于 $F(\\theta)$ 在 $[0, \\pi]$ 上是严格单调递增的，因此像二分法这样的稳健方法是合适的。我们对每个 $k$ 求解 $g_k(\\theta) = F(\\theta) - k/B = 0$ 的根。\n\n- **计算统计量：**\n    一旦确定了分箱边界，我们计算落入每个分箱 $i$ 的观测角度数 $O_i$。对于分箱 $i$（其左边界为 $\\theta_{L,i}$，右边界为 $\\theta_{R,i}$），期望角度数 $E_i$ 由下式给出：\n    $$\n    E_i = n \\cdot p_i = n \\cdot \\left(F(\\theta_{R,i}) - F(\\theta_{L,i})\\right)\n    $$\n    然后，皮尔逊卡方统计量计算为观测计数与期望计数之间平方归一化差异的总和：\n    $$\n    \\chi^2 = \\sum_{i=1}^B \\frac{(O_i - E_i)^2}{E_i}\n    $$\n    最大标准化残差 $R_{\\max}$ 确定了与期望偏差最大的分箱，并通过期望标准差进行缩放：\n    $$\n    R_{\\max} = \\max_{1 \\leq i \\leq B} \\frac{|O_i - E_i|}{\\sqrt{E_i}}\n    $$\n    较小的 $\\chi^2$ 和 $R_{\\max}$ 值表明与理论分布的拟合更好。\n\n### 算法实现\n\n该解决方案以 Python 程序实现。一个主函数通过顺序执行上述步骤来处理每个测试用例。\n1.  将测试用例的输入参数（$a, b, P_{\\min}, P_{\\max}, B$, 分箱策略）传递给一个核心计算函数。\n2.  一个辅助函数使用筛法生成高达 $P_{\\max}$ 的素数。\n3.  一个循环遍历素数，筛选出良好约化的素数。对每个这样的素数 $p$，调用一个点计数函数。\n4.  点计数函数从 $0$ 到 $p-1$ 迭代 $x$，计算 $u = x^3+ax+b \\pmod p$，并使用 `pow(u, (p-1)//2, p)` 计算勒让德符号 $\\chi_p(u)$。它对所有贡献求和以找到 $\\#E(\\mathbb{F}_p)$。\n5.  这用于计算 $a_p$，然后计算 $\\theta_p = \\arccos(a_p/(2\\sqrt{p}))$。所有有效的角度都被收集起来。\n6.  使用排序后的角度列表计算 KS 统计量 $D_n$。\n7.  根据指定策略生成分箱边界。对于等质量分箱，实现一个二分求根器来解出佐藤-泰特 CDF 的分位数。\n8.  定义好分箱后，`numpy.histogram` 计算观测计数 $O_i$。期望计数 $E_i$ 从佐藤-泰特 CDF 计算得出。\n9.  从 $O_i$ 和 $E_i$ 计算 $\\chi^2$ 和 $R_{\\max}$ 统计量。\n10. 返回三个统计量 $[D_n, \\chi^2, R_{\\max}]$。主函数收集所有测试用例的这些结果，并将它们格式化为所需的单行字符串输出。\n\n第四个测试用例使用一条 CM 曲线（$y^2 = x^3 - x$），它是一个关键的对照组。已知其角度分布与通用的佐藤-泰特定律不同。预期该实现会对此案例产生较大的统计值，正确地表明拟合不佳，从而验证整个方法的有效性。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the Sato-Tate conjecture.\n    \"\"\"\n\n    def generate_primes(min_val, max_val):\n        \"\"\"Generates primes in [min_val, max_val] using a sieve.\"\"\"\n        if max_val  2:\n            return []\n        sieve = np.ones(max_val + 1, dtype=bool)\n        sieve[0:2] = False\n        for i in range(2, int(np.sqrt(max_val)) + 1):\n            if sieve[i]:\n                sieve[i*i::i] = False\n        return [p for p in range(min_val, max_val + 1) if sieve[p]]\n\n    def legendre_symbol(n, p):\n        \"\"\"Computes the Legendre symbol (n/p).\"\"\"\n        ls = pow(n, (p - 1) // 2, p)\n        if ls == p - 1:\n            return -1\n        return ls\n\n    def count_points(a, b, p):\n        \"\"\"Counts the number of F_p-points on y^2 = x^3 + ax + b.\"\"\"\n        count = 1  # For the point at infinity\n        for x in range(p):\n            y_squared = (pow(x, 3, p) + a * x + b) % p\n            count += (1 + legendre_symbol(y_squared, p))\n        return count\n\n    def sato_tate_cdf(theta):\n        \"\"\"Computes the Sato-Tate CDF F(theta).\"\"\"\n        return theta / np.pi - np.sin(2 * theta) / (2 * np.pi)\n\n    def bisection_solve(func, x_min, x_max, tol=1e-12, max_iter=100):\n        \"\"\"Finds a root of func(x)=0 in [x_min, x_max] via bisection.\"\"\"\n        f_min = func(x_min)\n        if np.abs(f_min)  tol:\n            return x_min\n        f_max = func(x_max)\n        if np.abs(f_max)  tol:\n            return x_max\n\n        for _ in range(max_iter):\n            x_mid = (x_min + x_max) / 2\n            if (x_max - x_min) / 2  tol:\n                return x_mid\n            f_mid = func(x_mid)\n            if np.sign(f_mid) == np.sign(f_min):\n                x_min = x_mid\n                f_min = f_mid\n            else:\n                x_max = x_mid\n        return (x_min + x_max) / 2\n\n    def compute_statistics(a, b, p_min, p_max, B, binning_strategy):\n        \"\"\"\n        Computes the KS, Chi-Square, and max residual statistics.\n        \"\"\"\n        delta = -16 * (4 * a**3 + 27 * b**2)\n        if delta == 0:\n            return [np.nan, np.nan, np.nan]\n\n        primes = generate_primes(p_min, p_max)\n        if not primes:\n            return [0.0, 0.0, 0.0]\n\n        angles = []\n        for p in primes:\n            if p  5 or delta % p == 0:\n                continue\n            \n            num_points = count_points(a, b, p)\n            ap = p + 1 - num_points\n            ratio = ap / (2 * np.sqrt(p))\n            \n            # Clamp ratio to [-1, 1] to handle potential float precision errors\n            ratio = np.clip(ratio, -1.0, 1.0)\n            \n            theta_p = np.arccos(ratio)\n            angles.append(theta_p)\n\n        n = len(angles)\n        if n == 0:\n            return [0.0, 0.0, 0.0]\n        \n        angles = np.array(angles)\n\n        # 1. Kolmogorov-Smirnov (KS) statistic D_n\n        sorted_angles = np.sort(angles)\n        F_values = sato_tate_cdf(sorted_angles)\n        j_values = np.arange(1, n + 1)\n        \n        term1 = np.max(j_values / n - F_values)\n        term2 = np.max(F_values - (j_values - 1) / n)\n        D_n = np.max([term1, term2])\n\n        # 2. Chi-square and Max Residual\n        # Generate bin edges\n        if binning_strategy == 'uniform-angle':\n            bin_edges = np.linspace(0, np.pi, B + 1)\n        elif binning_strategy == 'Sato–Tate equal-mass':\n            bin_edges = [0.0]\n            for k in range(1, B):\n                target_prob = k / B\n                func_to_solve = lambda theta: sato_tate_cdf(theta) - target_prob\n                edge = bisection_solve(func_to_solve, 0, np.pi)\n                bin_edges.append(edge)\n            bin_edges.append(np.pi)\n            bin_edges = np.array(bin_edges)\n        else:\n            raise ValueError(\"Unknown binning strategy\")\n\n        # Observed counts O_i\n        O_i, _ = np.histogram(angles, bins=bin_edges)\n        \n        # Expected counts E_i\n        bin_probabilities = sato_tate_cdf(bin_edges[1:]) - sato_tate_cdf(bin_edges[:-1])\n        E_i = n * bin_probabilities\n\n        # Filter out bins where E_i is zero to avoid division by zero\n        valid_bins = E_i  1e-9 # Use a small tolerance for floating point\n        O_i_valid = O_i[valid_bins]\n        E_i_valid = E_i[valid_bins]\n        \n        if len(E_i_valid) == 0:\n            chi2_stat = 0.0\n            R_max = 0.0\n        else:\n            standardized_residuals = (O_i_valid - E_i_valid) / np.sqrt(E_i_valid)\n            chi2_stat = np.sum(standardized_residuals**2)\n            R_max = np.max(np.abs(standardized_residuals))\n\n        return [D_n, chi2_stat, R_max]\n\n    # Test suite from the problem statement\n    test_cases = [\n        {'a': 0, 'b': -2, 'p_min': 5, 'p_max': 1500, 'B': 20, 'binning_strategy': 'uniform-angle'},\n        {'a': 0, 'b': -2, 'p_min': 5, 'p_max': 100, 'B': 10, 'binning_strategy': 'uniform-angle'},\n        {'a': 0, 'b': -2, 'p_min': 5, 'p_max': 1500, 'B': 20, 'binning_strategy': 'Sato–Tate equal-mass'},\n        {'a': -1, 'b': 0, 'p_min': 5, 'p_max': 1500, 'B': 20, 'binning_strategy': 'uniform-angle'}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        stats = compute_statistics(**case)\n        all_results.append(stats)\n    \n    # Python's default float formatting matches the required precision.\n    # The final output format is a string representation of a list of lists.\n    output_str = str(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```", "id": "3029347"}]}