{"hands_on_practices": [{"introduction": "掌握如何从给定的度规中计算联络系数，是黎曼几何中的一项基本功。本练习将引导你使用球坐标——一个在物理学和数学诸多领域都至关重要的坐标系——来完成这一核心计算过程。通过为平直欧几里得空间推导其在该曲线坐标系下的克氏符（Christoffel symbols），你不仅能亲手实践其定义公式，还能体会到即使在平直几何中，坐标本身的弯曲也会产生不可忽略的联络系数 [@problem_id:2972201]。", "problem": "考虑三维欧几里得空间 $\\mathbb{R}^{3}$，其在球坐标 $(r,\\theta,\\phi)$ 下表示，其中 $r>0$，$0<\\theta<\\pi$ 且 $0\\leq \\phi<2\\pi$。度规由 $g=dr^2+r^2\\,d\\theta^2+r^2\\sin^2\\theta\\,d\\phi^2$ 给出。仅使用 Levi-Civita 联络的定义性质，即无挠性（$\\Gamma^{i}_{jk}=\\Gamma^{i}_{kj}$）和度规相容性（$\\nabla_{k}g_{ij}=0$），计算在坐标基 $\\{\\partial_{r},\\partial_{\\theta},\\partial_{\\phi}\\}$ 下的联络系数（Christoffel 符号）$\\Gamma^{i}_{jk}$，并找出所有非零分量。\n\n您的推导必须从上述基本定义出发，通过确定度规分量 $g_{ij}$、其逆 $g^{ij}$ 以及度规相容性对联络系数坐标表达式的蕴涵来进行。您不得假定或引用任何现成的 Christoffel 符号公式；必须从第一性原理推导出所需内容。\n\n将您的最终答案以单行矩阵的形式给出，按下方所示的确切顺序列出非零分量的值：\n$\\big[\\Gamma^{r}_{\\theta\\theta},\\ \\Gamma^{r}_{\\phi\\phi},\\ \\Gamma^{\\theta}_{r\\theta},\\ \\Gamma^{\\theta}_{\\theta r},\\ \\Gamma^{\\theta}_{\\phi\\phi},\\ \\Gamma^{\\phi}_{r\\phi},\\ \\Gamma^{\\phi}_{\\phi r},\\ \\Gamma^{\\phi}_{\\theta\\phi},\\ \\Gamma^{\\phi}_{\\phi\\theta}\\big]$。\n\n无需四舍五入，答案应为精确的符号表达式。", "solution": "该问题是有效的，因为它在科学上基于 Riemannian 几何，是适定的、客观的，并包含获得唯一解所需的所有信息。我们从 Levi-Civita 联络的定义性质出发，推导联络系数。\n\nLevi-Civita 联络 $\\nabla$ 的两个基本性质是：\n1. 它是无挠的，这在坐标基中意味着联络系数（Christoffel 符号）的对称性：\n$$\n\\Gamma^{i}_{jk} = \\Gamma^{i}_{kj}\n$$\n2. 它与度规 $g$ 相容，意味着度规张量的协变导数为零：\n$$\n\\nabla_{k}g_{ij} = 0\n$$\n在坐标基中，此条件展开为：\n$$\n\\partial_{k}g_{ij} - \\Gamma^{l}_{ki}g_{lj} - \\Gamma^{l}_{kj}g_{il} = 0\n$$\n其中 $\\partial_{k}$ 表示对坐标 $x^{k}$ 的偏导数。这可以改写为：\n$$\n\\partial_{k}g_{ij} = \\Gamma^{l}_{ki}g_{lj} + \\Gamma^{l}_{kj}g_{il}\n$$\n为了求解联络系数，我们将此方程再写两次，并循环置换指标 $i, j, k$：\n$$\n\\partial_{j}g_{ik} = \\Gamma^{l}_{ji}g_{lk} + \\Gamma^{l}_{jk}g_{il}\n$$\n$$\n\\partial_{i}g_{jk} = \\Gamma^{l}_{ij}g_{lk} + \\Gamma^{l}_{ik}g_{lj}\n$$\n现在，我们构造组合 $(\\partial_{j}g_{ik} + \\partial_{i}g_{jk} - \\partial_{k}g_{ij})$：\n$$\n\\partial_{j}g_{ik} + \\partial_{i}g_{jk} - \\partial_{k}g_{ij} = (\\Gamma^{l}_{ji}g_{lk} + \\Gamma^{l}_{jk}g_{il}) + (\\Gamma^{l}_{ij}g_{lk} + \\Gamma^{l}_{ik}g_{lj}) - (\\Gamma^{l}_{ki}g_{lj} + \\Gamma^{l}_{kj}g_{il})\n$$\n使用无挠性质（$\\Gamma^{l}_{ji} = \\Gamma^{l}_{ij}$，$\\Gamma^{l}_{ki} = \\Gamma^{l}_{ik}$，$\\Gamma^{l}_{kj} = \\Gamma^{l}_{jk}$），我们可以简化右侧：\n$$\n\\partial_{j}g_{ik} + \\partial_{i}g_{jk} - \\partial_{k}g_{ij} = (\\Gamma^{l}_{ij}g_{lk} + \\Gamma^{l}_{jk}g_{il}) + (\\Gamma^{l}_{ij}g_{lk} + \\Gamma^{l}_{ik}g_{lj}) - (\\Gamma^{l}_{ik}g_{lj} + \\Gamma^{l}_{jk}g_{il})\n$$\n$$\n\\partial_{j}g_{ik} + \\partial_{i}g_{jk} - \\partial_{k}g_{ij} = 2\\Gamma^{l}_{ij}g_{lk}\n$$\n为了分离出 $\\Gamma^{m}_{ij}$，我们用逆度规张量 $g^{km}$ 缩并两边。逆度规满足 $g^{km}g_{lk} = \\delta^{m}_{l}$，其中 $\\delta^{m}_{l}$ 是 Kronecker delta。\n$$\ng^{km}(\\partial_{j}g_{ik} + \\partial_{i}g_{jk} - \\partial_{k}g_{ij}) = 2 g^{km} \\Gamma^{l}_{ij}g_{lk} = 2 \\Gamma^{l}_{ij} \\delta^{m}_{l} = 2 \\Gamma^{m}_{ij}\n$$\n这就得到了根据要求从第一性原理推导出的联络系数的显式公式：\n$$\n\\Gamma^{m}_{ij} = \\frac{1}{2} g^{mk}(\\partial_{i}g_{jk} + \\partial_{j}g_{ik} - \\partial_{k}g_{ij})\n$$\n现在我们将此应用于给定问题。令球坐标为 $(x^1, x^2, x^3) = (r, \\theta, \\phi)$。度规由 $g = dr^{2} + r^{2}\\,d\\theta^{2} + r^{2}\\sin^{2}\\theta\\,d\\phi^{2}$ 给出。度规张量分量 $g_{ij}$ 是 $dx^i dx^j$ 的系数，因此度规是对角的：\n$$\ng_{rr} = 1, \\quad g_{\\theta\\theta} = r^{2}, \\quad g_{\\phi\\phi} = r^{2}\\sin^{2}\\theta\n$$\n当 $i \\neq j$ 时，所有非对角分量 $g_{ij}$ 均为零。\n逆度规张量 $g^{ij}$ 也是对角的，其分量是 $g_{ij}$ 对角分量的倒数：\n$$\ng^{rr} = 1, \\quad g^{\\theta\\theta} = \\frac{1}{r^{2}}, \\quad g^{\\phi\\phi} = \\frac{1}{r^{2}\\sin^{2}\\theta}\n$$\n接下来，我们计算度规分量的必要偏导数。只有依赖于坐标的分量才会有非零导数。\n$$\n\\partial_{r}g_{\\theta\\theta} = \\partial_{r}(r^{2}) = 2r\n$$\n$$\n\\partial_{r}g_{\\phi\\phi} = \\partial_{r}(r^{2}\\sin^{2}\\theta) = 2r\\sin^{2}\\theta\n$$\n$$\n\\partial_{\\theta}g_{\\phi\\phi} = \\partial_{\\theta}(r^{2}\\sin^{2}\\theta) = r^{2}(2\\sin\\theta\\cos\\theta) = 2r^{2}\\sin\\theta\\cos\\theta\n$$\n度规分量的所有其他偏导数都为零（例如，对于所有 $i,j$，$\\partial_{\\phi}g_{ij}=0$，以及 $\\partial_{r}g_{rr}=0$，$\\partial_{\\theta}g_{rr}=0$，$\\partial_{\\theta}g_{\\theta\\theta}=0$）。\n\n由于度规是对角的，$\\Gamma^{m}_{ij}$ 的公式得以简化。对 $k$ 的求和简化为 $k=m$ 的单项：\n$$\n\\Gamma^{m}_{ij} = \\frac{1}{2} g^{mm}(\\partial_{i}g_{jm} + \\partial_{j}g_{im} - \\partial_{m}g_{ij}) \\quad (\\text{对 } m \\text{ 不求和})\n$$\n我们现在计算所需的非零分量：\n\n$\\Gamma^{r}_{\\theta\\theta}$ ($m=r, i=\\theta, j=\\theta$)：\n$$\n\\Gamma^{r}_{\\theta\\theta} = \\frac{1}{2}g^{rr}(\\partial_{\\theta}g_{\\theta r} + \\partial_{\\theta}g_{\\theta r} - \\partial_{r}g_{\\theta\\theta}) = \\frac{1}{2}(1)(0 + 0 - 2r) = -r\n$$\n\n$\\Gamma^{r}_{\\phi\\phi}$ ($m=r, i=\\phi, j=\\phi$)：\n$$\n\\Gamma^{r}_{\\phi\\phi} = \\frac{1}{2}g^{rr}(\\partial_{\\phi}g_{\\phi r} + \\partial_{\\phi}g_{\\phi r} - \\partial_{r}g_{\\phi\\phi}) = \\frac{1}{2}(1)(0 + 0 - 2r\\sin^{2}\\theta) = -r\\sin^{2}\\theta\n$$\n\n$\\Gamma^{\\theta}_{r\\theta}$ ($m=\\theta, i=r, j=\\theta$)：\n$$\n\\Gamma^{\\theta}_{r\\theta} = \\frac{1}{2}g^{\\theta\\theta}(\\partial_{r}g_{\\theta\\theta} + \\partial_{\\theta}g_{r\\theta} - \\partial_{\\theta}g_{r\\theta}) = \\frac{1}{2}\\left(\\frac{1}{r^{2}}\\right)(2r + 0 - 0) = \\frac{1}{r}\n$$\n\n$\\Gamma^{\\theta}_{\\theta r}$：根据对称性，$\\Gamma^{\\theta}_{\\theta r} = \\Gamma^{\\theta}_{r\\theta} = \\frac{1}{r}$。\n\n$\\Gamma^{\\theta}_{\\phi\\phi}$ ($m=\\theta, i=\\phi, j=\\phi$)：\n$$\n\\Gamma^{\\theta}_{\\phi\\phi} = \\frac{1}{2}g^{\\theta\\theta}(\\partial_{\\phi}g_{\\phi\\theta} + \\partial_{\\phi}g_{\\phi\\theta} - \\partial_{\\theta}g_{\\phi\\phi}) = \\frac{1}{2}\\left(\\frac{1}{r^{2}}\\right)(0 + 0 - 2r^{2}\\sin\\theta\\cos\\theta) = -\\sin\\theta\\cos\\theta\n$$\n\n$\\Gamma^{\\phi}_{r\\phi}$ ($m=\\phi, i=r, j=\\phi$)：\n$$\n\\Gamma^{\\phi}_{r\\phi} = \\frac{1}{2}g^{\\phi\\phi}(\\partial_{r}g_{\\phi\\phi} + \\partial_{\\phi}g_{r\\phi} - \\partial_{\\phi}g_{r\\phi}) = \\frac{1}{2}\\left(\\frac{1}{r^{2}\\sin^{2}\\theta}\\right)(2r\\sin^{2}\\theta + 0 - 0) = \\frac{1}{r}\n$$\n\n$\\Gamma^{\\phi}_{\\phi r}$：根据对称性，$\\Gamma^{\\phi}_{\\phi r} = \\Gamma^{\\phi}_{r\\phi} = \\frac{1}{r}$。\n\n$\\Gamma^{\\phi}_{\\theta\\phi}$ ($m=\\phi, i=\\theta, j=\\phi$)：\n$$\n\\Gamma^{\\phi}_{\\theta\\phi} = \\frac{1}{2}g^{\\phi\\phi}(\\partial_{\\theta}g_{\\phi\\phi} + \\partial_{\\phi}g_{\\theta\\phi} - \\partial_{\\phi}g_{\\theta\\phi}) = \\frac{1}{2}\\left(\\frac{1}{r^{2}\\sin^{2}\\theta}\\right)(2r^{2}\\sin\\theta\\cos\\theta + 0 - 0) = \\frac{\\cos\\theta}{\\sin\\theta} = \\cot\\theta\n$$\n\n$\\Gamma^{\\phi}_{\\phi\\theta}$：根据对称性，$\\Gamma^{\\phi}_{\\phi\\theta} = \\Gamma^{\\phi}_{\\theta\\phi} = \\cot\\theta$。\n\n任何其他未列出（或通过对称性相关）的分量 $\\Gamma^m_{ij}$ 都为零，因为在它们的公式中，度规分量的导数将全部为零。例如，$\\Gamma^{r}_{r\\theta}=0$，$\\Gamma^{\\theta}_{rr}=0$ 等。\n\n所要求的非零分量是：\n$\\Gamma^{r}_{\\theta\\theta} = -r$\n$\\Gamma^{r}_{\\phi\\phi} = -r\\sin^{2}\\theta$\n$\\Gamma^{\\theta}_{r\\theta} = \\frac{1}{r}$\n$\\Gamma^{\\theta}_{\\theta r} = \\frac{1}{r}$\n$\\Gamma^{\\theta}_{\\phi\\phi} = -\\sin\\theta\\cos\\theta$\n$\\Gamma^{\\phi}_{r\\phi} = \\frac{1}{r}$\n$\\Gamma^{\\phi}_{\\phi r} = \\frac{1}{r}$\n$\\Gamma^{\\phi}_{\\theta\\phi} = \\cot\\theta$\n$\\Gamma^{\\phi}_{\\phi\\theta} = \\cot\\theta$", "answer": "$$\n\\boxed{\\begin{pmatrix} -r & -r\\sin^{2}\\theta & \\frac{1}{r} & \\frac{1}{r} & -\\sin\\theta\\cos\\theta & \\frac{1}{r} & \\frac{1}{r} & \\cot\\theta & \\cot\\theta \\end{pmatrix}}\n$$", "id": "2972201"}, {"introduction": "在学会如何计算联络系数之后，理解如何正确地解读它们则更为关键。由于克氏符不是张量，它们的数值乃至奇点都有可能依赖于所选择的坐标卡。本练习旨在挑战你分析球体在两极出现的联络系数发散现象，并运用几何不变量来辨别这究竟是坐标失效产生的假象，还是一个真实的几何奇点 [@problem_id:2972210]。", "problem": "考虑单位 $2$-球面 $S^{2}\\subset\\mathbb{R}^{3}$，其上赋予了由 $\\mathbb{R}^{3}$ 中的欧几里得度量诱导的标准黎曼度量。设 $(\\theta,\\phi)$ 表示 $S^{2}\\setminus\\{\\text{北极},\\text{南极}\\}$ 上的常规球坐标，其中 $\\theta\\in(0,\\pi)$ 为极角，$\\phi\\in(0,2\\pi)$ 为方位角。Levi-Civita 联络被定义为与该黎曼度量相关联的唯一的无挠、度量兼容的协变导数算子 $\\nabla$。联络系数（Christoffel 符号）是 $\\nabla$ 在选定的局部标架下的坐标分量，它们不具有张量性。\n\n从第一性原理出发，分析 Christoffel 符号在 $\\theta=0$ 和 $\\theta=\\pi$ 处的坐标奇点附近的行为，并评估任何明显的发散是代表了真正的几何奇点还是坐标卡的人为产物。下列陈述中哪些是正确的？选择所有适用项。\n\nA. 当 $\\theta\\to 0$ 或 $\\theta\\to\\pi$ 时，Christoffel 符号 $\\Gamma^{\\phi}_{\\theta\\phi}$ 和 $\\Gamma^{\\phi}_{\\phi\\theta}$ 像 $\\cot\\theta$ 一样发散，这反映了 Levi-Civita 联络在两极处的真实几何奇点。\n\nB. 虽然在 $(\\theta,\\phi)$ 坐标系下，一些 Christoffel 符号在两极附近会发散，但对于 $S^{2}$ 上的任意光滑向量场 $X, Y$，其协变导数 $\\nabla_{X}Y$ 都能光滑地延拓通过两极。\n\nC. 切换到以某极点为中心的光滑坐标卡（例如，从另一极点出发的球极投影坐标），Levi-Civita 联络的 Christoffel 符号在该坐标卡中处处光滑。\n\nD. 由球坐标度量计算出的标量曲率 $R$ 因为奇异的 Christoffel 符号而在 $\\theta=0$ 和 $\\theta=\\pi$ 处发散。\n\nE. 某些 Christoffel 符号的明显发散是由于坐标向量 $\\partial_{\\phi}$ 的退化所致，其长度平方 $\\|\\partial_{\\phi}\\|^{2}$ 在两极处像 $\\sin^{2}\\theta$ 一样趋于零，导致 $g_{\\phi\\phi}$ 的导数与 $g_{\\phi\\phi}$ 本身的比值趋于无穷。", "solution": "该问题是黎曼几何中的一个标准练习，涉及区分 $2$-球面 $S^2$ 上的坐标奇点和真实几何奇点。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n- **流形：** 单位 $2$-球面，$S^2$，作为欧几里得空间 $\\mathbb{R}^3$ 的子集。\n- **度量：** 由 $\\mathbb{R}^3$ 中的欧几里得度量诱导的标准黎曼度量。\n- **坐标：** 开集 $S^2 \\setminus \\{\\text{北极}, \\text{南极}\\}$ 上的球坐标 $(\\theta, \\phi)$。\n- **坐标范围：** 极角 $\\theta \\in (0, \\pi)$ 和方位角 $\\phi \\in (0, 2\\pi)$。\n- **联络：** Levi-Civita 联络 $\\nabla$，其特征为无挠和度量兼容。\n- **任务：** 分析 Christoffel 符号在坐标奇点 $(\\theta=0, \\theta=\\pi)$ 附近的行为，并确定明显的发散是几何奇点还是坐标卡的人为产物。\n\n**第 2 步：使用提取的已知条件进行验证**\n- **科学基础：** 该问题牢固地植根于微分几何和黎曼几何的既定原理。$2$-球面、诱导度量、球坐标和 Levi-Civita 联络都是标准的、定义明确的数学对象。\n- **适定性：** 该问题是适定的。待分析的量（Christoffel 符号、曲率）由给定信息唯一确定。问题要求基于这些计算进行评估，这会得出一个明确的结论。\n- **客观性：** 问题以精确、客观的数学语言陈述。\n- **完备性：** 问题是自洽的。对流形和度量的描述足以执行所有必要的计算。\n- **其他标准：** 该问题并非不切实际、不适定、微不足道或无法验证。它探讨了几何学和物理学中的一个核心概念点。\n\n**第 3 步：结论与行动**\n问题陈述是有效的。我将继续推导解答。\n\n### 从第一性原理推导\n\n**1. 球坐标系下的度量张量**\n\n单位 $2$-球面在 $\\mathbb{R}^3$ 中的嵌入由以下参数化给出：\n$$ \\vec{r}(\\theta, \\phi) = (\\sin\\theta\\cos\\phi, \\sin\\theta\\sin\\phi, \\cos\\theta) $$\n坐标基矢是 $\\vec{r}$ 的偏导数：\n$$ \\partial_\\theta = \\frac{\\partial\\vec{r}}{\\partial\\theta} = (\\cos\\theta\\cos\\phi, \\cos\\theta\\sin\\phi, -\\sin\\theta) $$\n$$ \\partial_\\phi = \\frac{\\partial\\vec{r}}{\\partial\\phi} = (-\\sin\\theta\\sin\\phi, \\sin\\theta\\cos\\phi, 0) $$\n度量张量 $g_{ij}$ 的分量是这些基矢在 $\\mathbb{R}^3$ 的欧几里得度量下的内积：\n$$ g_{\\theta\\theta} = \\langle \\partial_\\theta, \\partial_\\theta \\rangle = (\\cos\\theta\\cos\\phi)^2 + (\\cos\\theta\\sin\\phi)^2 + (-\\sin\\theta)^2 = \\cos^2\\theta + \\sin^2\\theta = 1 $$\n$$ g_{\\phi\\phi} = \\langle \\partial_\\phi, \\partial_\\phi \\rangle = (-\\sin\\theta\\sin\\phi)^2 + (\\sin\\theta\\cos\\phi)^2 + 0^2 = \\sin^2\\theta(\\sin^2\\phi+\\cos^2\\phi) = \\sin^2\\theta $$\n$$ g_{\\theta\\phi} = \\langle \\partial_\\theta, \\partial_\\phi \\rangle = -\\cos\\theta\\sin\\theta\\cos\\phi\\sin\\phi + \\cos\\theta\\sin\\theta\\sin\\phi\\cos\\phi + 0 = 0 $$\n所以，度量张量及其逆矩阵是：\n$$ g_{ij} = \\begin{pmatrix} 1 & 0 \\\\ 0 & \\sin^2\\theta \\end{pmatrix}, \\quad g^{ij} = \\begin{pmatrix} 1 & 0 \\\\ 0 & \\frac{1}{\\sin^2\\theta} \\end{pmatrix} $$\n\n**2. 计算 Christoffel 符号**\n\n第二类 Christoffel 符号由以下公式给出：\n$$ \\Gamma^k_{ij} = \\frac{1}{2} g^{kl} \\left( \\frac{\\partial g_{jl}}{\\partial x^i} + \\frac{\\partial g_{il}}{\\partial x^j} - \\frac{\\partial g_{ij}}{\\partial x^l} \\right) $$\n设 $x^1=\\theta$ 和 $x^2=\\phi$。度量分量中唯一不为零的偏导数是：\n$$ \\frac{\\partial g_{\\phi\\phi}}{\\partial \\theta} = \\frac{\\partial (\\sin^2\\theta)}{\\partial \\theta} = 2\\sin\\theta\\cos\\theta $$\n我们来计算非零的 Christoffel 符号：\n- $\\Gamma^\\theta_{\\phi\\phi} = \\frac{1}{2}g^{\\theta l}(\\partial_\\phi g_{\\phi l} + \\partial_\\phi g_{\\phi l} - \\partial_l g_{\\phi\\phi}) = \\frac{1}{2}g^{\\theta\\theta}(0+0-\\partial_\\theta g_{\\phi\\phi}) = \\frac{1}{2}(1)(-2\\sin\\theta\\cos\\theta) = -\\sin\\theta\\cos\\theta$\n- $\\Gamma^\\phi_{\\theta\\phi} = \\Gamma^\\phi_{\\phi\\theta} = \\frac{1}{2}g^{\\phi l}(\\partial_\\theta g_{\\phi l} + \\partial_\\phi g_{\\theta l} - \\partial_l g_{\\theta\\phi}) = \\frac{1}{2}g^{\\phi\\phi}(\\partial_\\theta g_{\\phi\\phi} + \\partial_\\phi g_{\\theta\\phi}) = \\frac{1}{2}\\frac{1}{\\sin^2\\theta}(2\\sin\\theta\\cos\\theta+0) = \\frac{\\cos\\theta}{\\sin\\theta} = \\cot\\theta$\n\n非零的 Christoffel 符号是：\n$$ \\Gamma^\\theta_{\\phi\\phi} = -\\sin\\theta\\cos\\theta, \\quad \\Gamma^\\phi_{\\theta\\phi} = \\Gamma^\\phi_{\\phi\\theta} = \\cot\\theta $$\n当 $\\theta \\to 0$ 或 $\\theta \\to \\pi$ 时，$\\sin\\theta \\to 0$，导致 $\\cot\\theta$ 发散。符号 $\\Gamma^\\theta_{\\phi\\phi}$ 在两极处为零。\n\n**3. 奇点分析**\n\nChristoffel 符号的发散可能是坐标系的人为产物。要确定是否存在真实的几何奇点，我们必须计算一个坐标不变量，例如标量曲率 $R$。对于一个 2 维流形，标量曲率是 $R=2K$，其中 $K$ 是高斯曲率。对于对角度量 $ds^2 = g_{11}(dx^1)^2 + g_{22}(dx^2)^2$，高斯曲率由以下公式给出：\n$$ K = -\\frac{1}{2\\sqrt{g_{11}g_{22}}} \\left[ \\frac{\\partial}{\\partial x^1}\\left(\\frac{1}{\\sqrt{g_{11}}}\\frac{\\partial\\sqrt{g_{22}}}{\\partial x^1}\\right) + \\frac{\\partial}{\\partial x^2}\\left(\\frac{1}{\\sqrt{g_{22}}}\\frac{\\partial\\sqrt{g_{11}}}{\\partial x^2}\\right) \\right] $$\n此处，$x^1=\\theta, x^2=\\phi, g_{11}=1, g_{22}=\\sin^2\\theta$。所以 $\\sqrt{g_{11}}=1$ 且 $\\sqrt{g_{22}}=\\sin\\theta$。\n$$ K = -\\frac{1}{2\\sin\\theta} \\left[ \\frac{\\partial}{\\partial\\theta}\\left(\\frac{1}{1}\\frac{\\partial(\\sin\\theta)}{\\partial\\theta}\\right) + \\frac{\\partial}{\\partial\\phi}\\left(\\frac{1}{\\sin\\theta}\\frac{\\partial(1)}{\\partial\\phi}\\right) \\right] $$\n$$ K = -\\frac{1}{2\\sin\\theta} \\left[ \\frac{\\partial}{\\partial\\theta}(\\cos\\theta) + 0 \\right] = -\\frac{1}{2\\sin\\theta}(-\\sin\\theta) = \\frac{1}{2} $$\n此处的公式实现似乎与标准定义相差一个因子 2。让我使用 Ricci 张量公式。Ricci 张量的非零分量是 $R_{\\theta\\theta}=1$ 和 $R_{\\phi\\phi}=\\sin^2\\theta$。标量曲率是 $R=g^{ij}R_{ij} = g^{\\theta\\theta}R_{\\theta\\theta} + g^{\\phi\\phi}R_{\\phi\\phi} = (1)(1) + (\\frac{1}{\\sin^2\\theta})(\\sin^2\\theta) = 1+1=2$。高斯曲率是 $K=R/2=1$。\n对于单位球面，曲率确实是 $K=1/r^2 = 1/1^2=1$。标量曲率是 $R=2$。\n\n由于标量曲率 $R=2$ 在球面上处处为常数且有限，因此在两极处没有几何奇点。$\\Gamma^\\phi_{\\theta\\phi}$ 的发散纯粹是球坐标系的人为产物，该坐标系在 $\\theta=0$ 和 $\\theta=\\pi$ 处定义不良。\n\n### 逐项分析\n\n**A. Christoffel 符号 $\\Gamma^{\\phi}_{\\theta\\phi}$ 和 $\\Gamma^{\\phi}_{\\phi\\theta}$ 像 $\\cot\\theta$ 一样发散，当 $\\theta\\to 0$ 或 $\\theta\\to\\pi$ 时，这反映了 Levi-Civita 联络在两极处的真实几何奇点。**\n陈述的第一部分是正确的；我们的计算表明 $\\Gamma^\\phi_{\\theta\\phi} = \\cot\\theta$，它在两极处发散。然而，其结论——这反映了一个真实的几何奇点——是错误的。如标量曲率（一个几何不变量）的计算所示（$R=2$），球面的几何在两极处是完全正则的。\n**结论：错误。**\n\n**B. 虽然在 $(\\theta,\\phi)$ 坐标系下，一些 Christoffel 符号在两极附近会发散，但对于 $S^{2}$ 上的任意光滑向量场 $X, Y$，其协变导数 $\\nabla_{X}Y$ 都能光滑地延拓通过两极。**\n该陈述正确地描述了坐标奇点的本质。Levi-Civita 联络 $\\nabla$ 是光滑流形 $S^2$ 上的一个光滑张量场。协变导数 $\\nabla_X Y$ 是一个与坐标无关的几何运算。如果 $X$ 和 $Y$ 是定义在整个球面上的光滑向量场，那么得到的向量场 $\\nabla_X Y$ 也必须是整个球面上的光滑向量场。Christoffel 符号仅仅是 $\\nabla$ 的坐标分量；它们的奇异行为反映了坐标卡的失效，而不是底层几何结构的失效。\n**结论：正确。**\n\n**C. 切换到以某极点为中心的光滑坐标卡（例如，从另一极点出发的球极投影坐标），Levi-Civita 联络的 Christoffel 符号在该坐标卡中处处光滑。**\n这是证明一个奇点是坐标人为产物的标准程序。我们考虑从南极点出发的球极投影。这个坐标卡覆盖了除南极点以外的整个球面，因此对于北极的一个邻域来说，它是一个完全有效的光滑坐标卡。在这些 $(u,v)$ 坐标下，度量为 $ds^2 = \\frac{4(du^2 + dv^2)}{(1+u^2+v^2)^2}$。度量分量是 $u$ 和 $v$ 的光滑（$C^\\infty$）函数（分母永不为零）。由于 Christoffel 符号是通过度量分量的导数计算出来的，因此在这个坐标卡中它们也将是光滑函数。在北极点 $(u=0, v=0)$，Christoffel 符号是有限的。这证实了该奇点是依赖于坐标卡的。\n**结论：正确。**\n\n**D. 由球坐标度量计算出的标量曲率 $R$ 因为奇异的 Christoffel 符号而在 $\\theta=0$ 和 $\\theta=\\pi$ 处发散。**\n这在事实上是错误的。我们的计算表明标量曲率是常数，$R=2$。标量曲率是一个几何不变量，在像球面这样的光滑流形上必须是有限的，无论使用什么坐标系进行计算。发散的曲率将意味着一个真实的几何奇点，而球面没有这种奇点。\n**结论：错误。**\n\n**E. 某些 Christoffel 符号的明显发散是由于坐标向量 $\\partial_{\\phi}$ 的退化所致，其长度平方 $\\|\\partial_{\\phi}\\|^{2}$ 在两极处像 $\\sin^{2}\\theta$ 一样趋于零，导致 $g_{\\phi\\phi}$ 的导数与 $g_{\\phi\\phi}$ 本身的比值趋于无穷。**\n该陈述为观察到的坐标奇点提供了一个精确的机理上的解释。基矢 $\\partial_\\phi$ 的长度平方是 $\\|\\partial_\\phi\\|^2 = g_{\\phi\\phi} = \\sin^2\\theta$。当 $\\theta \\to 0$ 和 $\\theta \\to \\pi$ 时，这个量趋于零，表明坐标向量场 $\\partial_\\phi$ 在两极处退化。我们发现奇异的 Christoffel 符号是 $\\Gamma^\\phi_{\\theta\\phi} = \\frac{1}{2}g^{\\phi\\phi}(\\partial_\\theta g_{\\phi\\phi}) = \\frac{1}{2g_{\\phi\\phi}}(\\partial_\\theta g_{\\phi\\phi})$。这是一个分母中包含 $g_{\\phi\\phi}$ 的比率。具体来说，它是 $\\frac{2\\sin\\theta\\cos\\theta}{2\\sin^2\\theta} = \\cot\\theta$。分子像 $\\sin\\theta$ 一样趋于零，而分母则像 $\\sin^2\\theta$ 一样更快地趋于零。它们的比值发散。该陈述完全准确地诊断了发散的数学根源。\n**结论：正确。**", "answer": "$$\\boxed{BCE}$$", "id": "2972210"}, {"introduction": "联络系数最深刻的应用体现在描述弯曲空间中运动的测地线方程中。这个高级实践通过要求你对这些方程进行数值积分，从而架起了理论与计算之间的桥梁。你将实现并比较不同的积分方案，直面数值稳定性和物理量守恒等实际问题，从而通过模拟将抽象的流形几何赋予生命 [@problem_id:2972192]。", "problem": "要求您设计并实现一个程序，用于探究二维黎曼流形上测地线方程数值积分的稳定性问题，并实现一个约束维持策略，以强制保持相对于给定度规的速率恒定。其数学核心始于 Levi-Civita 联络的定义性质：无挠性和度规兼容性。具有仿射参数的测地线满足二阶系统 $ \\ddot{x}^k + \\Gamma^k_{ij}(x)\\,\\dot{x}^i \\dot{x}^j = 0 $，其中 $ \\Gamma^k_{ij} $ 是与黎曼度规 $ g $ 相关联的 Levi-Civita 联络的 Christoffel 符号。对于仿射参数化的测地线，量 $ g_{ij}(x)\\,\\dot{x}^i \\dot{x}^j $ 沿轨迹是恒定的。在有限精度算术和显式时间步进格式中，这种不变性通常会被破坏，可能导致不稳定性或长期漂移。您的任务是推导、实现并比较两种积分器：一种是不强制执行速率约束的基准显式 Runge–Kutta 方法，以及另一种通过在每个时间步后使用更新点处的度规来投影速度，从而强制执行恒定速率约束的变体。\n\n根据无挠和度规兼容性条件，用度规 $ g $ 及其一阶导数推导 Christoffel 符号 $ \\Gamma^k_{ij} $。实现一个例程，该例程在给定坐标图、度规 $ g_{ij}(x) $ 及其一阶导数 $ \\partial_\\ell g_{ij}(x) $ 的情况下，计算 $ \\Gamma^k_{ij}(x) $。然后，实现与坐标表示下的测地线方程等价的一阶系统：引入 $ v^k = \\dot{x}^k $，使得 $ \\dot{x}^k = v^k $ 和 $ \\dot{v}^k = -\\Gamma^k_{ij}(x)\\,v^i v^j $。为此系统实现两种数值积分器：\n- 基准积分器：经典的四阶 Runge–Kutta 方法，使用固定步长。\n- 约束投影积分器：采用相同的格式，但在每一步结束时，通过投影重新缩放 $ v $，使得 $ g_{ij}(x)\\,v^i v^j $ 等于其初始值（恒定速率约束）。\n\n角度必须以弧度为单位。不涉及物理单位。您的程序必须使用以下测试套件。在每种情况下，对于两种积分器，计算 $ g_{ij}(x(t))\\,v^i(t)\\,v^j(t) $ 在所有时间步上与其初始值的最大绝对偏差，并报告一对浮点数 $ [\\text{baseline\\_max\\_error}, \\text{projected\\_max\\_error}] $。\n\n使用指定的坐标图和度规：\n- 在标准球坐标 $ (\\theta,\\phi) $ 下的球面 $ \\mathbb{S}^2 $（远离极点），度规为 $ g = \\mathrm{diag}(1,\\sin^2\\theta) $。角度 $ \\theta $ 和 $ \\phi $ 以弧度为单位。\n- Poincaré 上半平面 $ \\mathbb{H}^2 = \\{(x,y)\\,|\\,y>0\\} $，在坐标 $ (x,y) $ 下的度规为 $ g = \\frac{1}{y^2}\\,\\mathrm{diag}(1,1) $。\n- 极坐标 $ (r,\\theta) $下的欧几里得平面，度规为 $ g = \\mathrm{diag}(1,r^2) $。角度 $ \\theta $ 以弧度为单位。\n\n为每个度规实现返回 $ g_{ij}(x) $ 和 $ \\partial_k g_{ij}(x) $ 的解析例程。\n\n测试套件（角度以弧度为单位）：\n- 情况 $ 1 $ （球面，中等步长）：初始 $ (\\theta,\\phi)=(\\pi/2,0) $，初始 $ v=(0,1) $，总时间 $ T=10.0 $，步长 $ h=0.05 $。\n- 情况 $ 2 $ （球面，大步长）：初始 $ (\\theta,\\phi)=(\\pi/2,0) $，初始 $ v=(0,1) $，总时间 $ T=10.0 $，步长 $ h=0.25 $。\n- 情况 $ 3 $ （Poincaré，中等）：初始 $ (x,y)=(0,1) $，初始 $ v=(0,1) $，总时间 $ T=5.0 $，步长 $ h=0.05 $。\n- 情况 $ 4 $ （Poincaré，靠近边界）：初始 $ (x,y)=(0,0.2) $，初始 $ v=(0,0.2) $，总时间 $ T=3.0 $，步长 $ h=0.05 $。\n- 情况 $ 5 $ （极坐标平面，中等）：初始 $ (r,\\theta)=(1.0,0.0) $，初始 $ v=(0,1.0) $，总时间 $ T=1.0 $，步长 $ h=0.05 $。\n- 情况 $ 6 $ （极坐标平面，大步长）：初始 $ (r,\\theta)=(1.0,0.0) $，初始 $ v=(0,1.0) $，总时间 $ T=1.0 $，步长 $ h=0.20 $。\n\n对于每种情况，初始速度的选择使得初始度规速率 $ g_{ij}(x_0)\\,v_0^i v_0^j $ 等于 $ 1 $。对于基准积分器和约束投影积分器，计算度规速率在所有步数上与其初始值的最大绝对偏差。您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，列表中的每个条目是对应于上述顺序测试的双元素列表 $ [\\text{baseline\\_max\\_error}, \\text{projected\\_max\\_error}] $。例如，输出格式必须类似于 $ [[e_{1,\\mathrm{base}},e_{1,\\mathrm{proj}}],[e_{2,\\mathrm{base}},e_{2,\\mathrm{proj}}],\\dots] $。", "solution": "用户的请求是数值微分几何学中一个适定的问题。它要求在指定的二维黎曼流形上推导并实现测地线积分器，比较一种标准的显式方法和一个强制执行已知不变量的变体。\n\n### 第 1 步：理论基础\n\n问题的核心在于具有度规 $g$ 的黎曼流形上的测地线方程。对于仿射参数化路径 $x(t)$，方程为：\n$$ \\ddot{x}^k + \\Gamma^k_{ij}(x)\\,\\dot{x}^i \\dot{x}^j = 0 $$\n其中 $x^k$ 是局部坐标，$\\dot{x}^k = dx^k/dt$，$\\Gamma^k_{ij}$ 是 Levi-Civita 联络的第二类 Christoffel 符号。这些符号由度规张量 $g_{ij}$ 及其导数确定。Levi-Civita 联络的定义性质——无挠和度规兼容——导出了 Christoffel 符号的显式公式：\n$$ \\Gamma^k_{ij} = \\frac{1}{2} g^{k\\ell} \\left( \\frac{\\partial g_{j\\ell}}{\\partial x^i} + \\frac{\\partial g_{i\\ell}}{\\partial x^j} - \\frac{\\partial g_{ij}}{\\partial x^\\ell} \\right) $$\n这里，$g^{k\\ell}$ 是逆度规张量，满足 $g^{k\\ell}g_{\\ell m} = \\delta^k_m$。仿射参数化测地线的一个关键性质是“速率”平方 $S^2 = g_{ij}(x(t))\\,\\dot{x}^i(t)\\,\\dot{x}^j(t)$ 的守恒，它沿轨迹是恒定的。\n\n### 第 2 步：数值格式\n\n为了数值求解二阶测地线方程，我们将其转换为一阶系统。设状态向量为 $Y = (x^1, x^2, v^1, v^2)$，其中 $v^k = \\dot{x}^k$。该常微分方程组 (ODE) 为：\n$$ \\dot{Y} = \\begin{pmatrix} \\dot{x}^k \\\\ \\dot{v}^k \\end{pmatrix} = \\begin{pmatrix} v^k \\\\ -\\Gamma^k_{ij}(x) v^i v^j \\end{pmatrix} $$\n我们将使用两种方法来积分该系统：\n\n1.  **基准积分器**：经典的四阶 Runge-Kutta (RK4) 方法。给定 $\\dot{Y} = f(Y)$，从 $Y_n$ 到 $Y_{n+1}$，步长为 $h$ 的一步是：\n    $$\n    k_1 = f(Y_n) \\\\\n    k_2 = f(Y_n + \\frac{h}{2}k_1) \\\\\n    k_3 = f(Y_n + \\frac{h}{2}k_2) \\\\\n    k_4 = f(Y_n + h k_3) \\\\\n    Y_{n+1} = Y_n + \\frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4)\n    $$\n    该方法是显式的，并且本身不保持速率不变量 $S^2$ 守恒，从而导致数值漂移。\n\n2.  **约束投影积分器**：此方法首先执行一个 RK4 步骤，得到一个原始的新状态 $(x_{n+1}, v_{n+1, \\text{raw}})$。然后，它投影速度向量以强制执行约束。初始速率平方为 $S_0^2 = g_{ij}(x_0) v_0^i v_0^j$。原始步骤后的速率平方为 $S^2_{n+1, \\text{raw}} = g_{ij}(x_{n+1}) v_{n+1, \\text{raw}}^i v_{n+1, \\text{raw}}^j$。通过缩放获得校正后的速度：\n    $$ v_{n+1} = \\alpha \\cdot v_{n+1, \\text{raw}} \\quad \\text{其中} \\quad \\alpha = \\sqrt{\\frac{S_0^2}{S^2_{n+1, \\text{raw}}}} $$\n    这确保了在每个步骤结束时，$g_{ij}(x_{n+1}) v_{n+1}^i v_{n+1}^j = S_0^2$ 在机器精度范围内成立。\n\n### 第 3 步：特定流形的实现细节\n\n实现需要为每个流形提供函数，以计算度规 $g_{ij}$、其逆 $g^{ij}$ 及其偏导数 $\\partial_k g_{ij}$。所有度规都是二维且对角的，这简化了计算。\n\n-   **球面 ($\\mathbb{S}^2$)**：坐标 $(\\theta, \\phi)$，度规 $g = \\mathrm{diag}(1, \\sin^2\\theta)$。\n    -   $g_{11}=1, g_{22}=\\sin^2\\theta$。\n    -   $g^{11}=1, g^{22}=1/\\sin^2\\theta$。\n    -   唯一的非零偏导数是 $\\partial_\\theta g_{22} = 2\\sin\\theta\\cos\\theta$。\n-   **Poincaré 上半平面 ($\\mathbb{H}^2$)**：坐标 $(x, y)$，度规 $g = (1/y^2)\\,\\mathrm{diag}(1,1)$。\n    -   $g_{11}=1/y^2, g_{22}=1/y^2$。\n    -   $g^{11}=y^2, g^{22}=y^2$。\n    -   非零导数：$\\partial_y g_{11} = \\partial_y g_{22} = -2/y^3$。\n-   **极坐标平面**：坐标 $(r, \\theta)$，度规 $g=\\mathrm{diag}(1, r^2)$。\n    -   $g_{11}=1, g_{22}=r^2$。\n    -   $g^{11}=1, g^{22}=1/r^2$。\n    -   唯一的非零偏导数是 $\\partial_r g_{22} = 2r$。\n\n这些组件用于计算 RK4 积分器在每个点上所需的 Christoffel 符号。主程序遍历测试用例，为每个用例运行两种积分方案，计算 $S^2$ 与其初始值（所有情况下 $S_0^2=1$）的最大绝对偏差，并报告结果。\n\n### 第 4 步：算法结构\n\n代码结构如下：\n1.  一个抽象基类 `RiemannianMetric` 定义了与度规相关计算的接口。具体类 `SphereMetric`、`PoincareMetric` 和 `PolarMetric` 实现了此接口。\n2.  函数 `get_christoffel(g_inv, g_deriv)` 以通用的、与坐标无关的方式实现了 $\\Gamma^k_{ij}$ 的公式。\n3.  函数 `geodesic_rhs(y, metric)` 计算一阶 ODE 系统的右侧，代表测地流的向量场。\n4.  主要的积分逻辑封装在 `run_integration(..., do_projection)` 中，它执行 RK4 时间步进，可选地应用速度投影，并跟踪速率不变量的最大误差。\n5.  顶层函数 `solve()` 定义了测试套件，遍历每种情况，为基准方法和投影方法调用 `run_integration`，并按规定格式化最终输出。", "answer": "```python\nimport numpy as np\nimport math\n\nclass RiemannianMetric:\n    \"\"\"Abstract base class for a Riemannian metric.\"\"\"\n    def g(self, x):\n        raise NotImplementedError\n    def g_inv(self, x):\n        raise NotImplementedError\n    def g_deriv(self, x):\n        raise NotImplementedError\n\nclass SphereMetric(RiemannianMetric):\n    \"\"\"Metric for a 2-sphere in spherical coordinates (theta, phi).\"\"\"\n    def g(self, x):\n        theta, _ = x\n        return np.array([[1.0, 0.0], [0.0, np.sin(theta)**2]])\n\n    def g_inv(self, x):\n        theta, _ = x\n        sin_theta_sq = np.sin(theta)**2\n        # Avoid division by zero at poles. Test cases are at the equator.\n        if sin_theta_sq < 1e-12:\n            sin_theta_sq = 1e-12\n        return np.array([[1.0, 0.0], [0.0, 1.0 / sin_theta_sq]])\n\n    def g_deriv(self, x):\n        # Returns d_k g_ij as a tensor of shape (2,2,2) -> (k, i, j)\n        theta, _ = x\n        derivs = np.zeros((2, 2, 2))\n        # d_theta g_phi_phi = 2*sin(theta)*cos(theta)\n        derivs[0, 1, 1] = 2.0 * np.sin(theta) * np.cos(theta)\n        return derivs\n\nclass PoincareMetric(RiemannianMetric):\n    \"\"\"Metric for the Poincaré upper half-plane in Cartesian coordinates (x, y).\"\"\"\n    def g(self, x):\n        _, y = x\n        val = 1.0 / y**2\n        return np.array([[val, 0.0], [0.0, val]])\n\n    def g_inv(self, x):\n        _, y = x\n        val = y**2\n        return np.array([[val, 0.0], [0.0, val]])\n\n    def g_deriv(self, x):\n        # Returns d_k g_ij as a tensor of shape (2,2,2) -> (k, i, j)\n        _, y = x\n        derivs = np.zeros((2, 2, 2))\n        d_val = -2.0 / y**3\n        # d_y g_xx\n        derivs[1, 0, 0] = d_val\n        # d_y g_yy\n        derivs[1, 1, 1] = d_val\n        return derivs\n\nclass PolarMetric(RiemannianMetric):\n    \"\"\"Metric for the Euclidean plane in polar coordinates (r, theta).\"\"\"\n    def g(self, x):\n        r, _ = x\n        return np.array([[1.0, 0.0], [0.0, r**2]])\n\n    def g_inv(self, x):\n        r, _ = x\n        r_sq = r**2\n        if r_sq < 1e-12:\n            r_sq = 1e-12\n        return np.array([[1.0, 0.0], [0.0, 1.0 / r_sq]])\n\n    def g_deriv(self, x):\n        # Returns d_k g_ij as a tensor of shape (2,2,2) -> (k, i, j)\n        r, _ = x\n        derivs = np.zeros((2, 2, 2))\n        # d_r g_theta_theta = 2*r\n        derivs[0, 1, 1] = 2.0 * r\n        return derivs\n\ndef get_christoffel(g_inv, g_deriv):\n    \"\"\"Computes Christoffel symbols Gamma^k_ij from metric derivatives.\"\"\"\n    dim = g_inv.shape[0]\n    gamma = np.zeros((dim, dim, dim))  # shape (k, i, j) -> Gamma^k_ij\n    # Formula: Gamma^k_ij = 0.5 * g^kl * (d_i g_jl + d_j g_il - d_l g_ij)\n    # Our g_deriv has shape (l, i, j) for d_l g_ij.\n    for k in range(dim):\n        for i in range(dim):\n            for j in range(dim):\n                term = 0.0\n                for l_idx in range(dim):\n                    term += g_inv[k, l_idx] * (g_deriv[i, j, l_idx] + g_deriv[j, i, l_idx] - g_deriv[l_idx, i, j])\n                gamma[k, i, j] = 0.5 * term\n    return gamma\n\ndef geodesic_rhs(y, metric):\n    \"\"\"Computes the RHS of the first-order geodesic ODE system.\"\"\"\n    dim = 2\n    x = y[:dim]\n    v = y[dim:]\n    gamma = get_christoffel(metric.g_inv(x), metric.g_deriv(x))\n    \n    accel = np.zeros(dim)\n    for k in range(dim):\n        accel[k] = -v.T @ gamma[k, :, :] @ v\n        \n    return np.concatenate((v, accel))\n\ndef run_integration(x0, v0, T, h, metric, do_projection):\n    \"\"\"Integrates the geodesic equation and returns max speed deviation.\"\"\"\n    dim = len(x0)\n    y = np.concatenate((np.array(x0, dtype=float), np.array(v0, dtype=float)))\n    \n    g_initial = metric.g(y[:dim])\n    speed_sq_initial = y[dim:] @ g_initial @ y[dim:]\n    \n    num_steps = int(round(T / h))\n    max_error = 0.0\n    \n    for _ in range(num_steps):\n        # Standard RK4 step\n        k1 = geodesic_rhs(y, metric)\n        k2 = geodesic_rhs(y + 0.5 * h * k1, metric)\n        k3 = geodesic_rhs(y + 0.5 * h * k2, metric)\n        k4 = geodesic_rhs(y + h * k3, metric)\n        \n        y_raw = y + (h / 6.0) * (k1 + 2*k2 + 2*k3 + k4)\n        \n        if do_projection:\n            x_new = y_raw[:dim]\n            v_raw = y_raw[dim:]\n            \n            g_new = metric.g(x_new)\n            speed_sq_raw = v_raw @ g_new @ v_raw\n            \n            if speed_sq_raw > 1e-12:\n                scale_factor = math.sqrt(speed_sq_initial / speed_sq_raw)\n                v_new = v_raw * scale_factor\n            else:\n                v_new = v_raw\n            y = np.concatenate((x_new, v_new))\n        else:\n            y = y_raw\n            \n        g_current = metric.g(y[:dim])\n        v_current = y[dim:]\n        current_speed_sq = v_current @ g_current @ v_current\n        \n        error = abs(current_speed_sq - speed_sq_initial)\n        if error > max_error:\n            max_error = error\n            \n    return max_error\n\ndef solve():\n    \"\"\"Main function to run all test cases and print results.\"\"\"\n    test_cases = [\n        {'metric': SphereMetric(), 'x0': [np.pi/2, 0.0], 'v0': [0.0, 1.0], 'T': 10.0, 'h': 0.05},\n        {'metric': SphereMetric(), 'x0': [np.pi/2, 0.0], 'v0': [0.0, 1.0], 'T': 10.0, 'h': 0.25},\n        {'metric': PoincareMetric(), 'x0': [0.0, 1.0], 'v0': [0.0, 1.0], 'T': 5.0, 'h': 0.05},\n        {'metric': PoincareMetric(), 'x0': [0.0, 0.2], 'v0': [0.0, 0.2], 'T': 3.0, 'h': 0.05},\n        {'metric': PolarMetric(), 'x0': [1.0, 0.0], 'v0': [0.0, 1.0], 'T': 1.0, 'h': 0.05},\n        {'metric': PolarMetric(), 'x0': [1.0, 0.0], 'v0': [0.0, 1.0], 'T': 1.0, 'h': 0.20},\n    ]\n\n    results = []\n    for case in test_cases:\n        baseline_max_error = run_integration(case['x0'], case['v0'], case['T'], case['h'], case['metric'], do_projection=False)\n        projected_max_error = run_integration(case['x0'], case['v0'], case['T'], case['h'], case['metric'], do_projection=True)\n        results.append([baseline_max_error, projected_max_error])\n\n    # Format the output string exactly as required\n    result_strings = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```", "id": "2972192"}]}