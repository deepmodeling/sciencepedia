{"hands_on_practices": [{"introduction": "本练习将最优传输理论置于一个具体的物流场景中，帮助你将其付诸实践。你将学习如何将货物从供应商运输到消费者的问题，形式化为一个离散的最优传输问题。这个练习对于理解核心的 Kantorovich 公式至关重要，你将通过定义成本矩阵和设置约束条件，来找到最具成本效益的运输方案 [@problem_id:1424977]。", "problem": "一家公司经营两家面包店 $B_1$ 和 $B_2$，以及两家咖啡馆 $C_1$ 和 $C_2$，它们都位于一条笔直的道路上。它们的位置以公里为单位，从一个参考点算起：\n- 面包店 $B_1$ 位于位置 $a_1 = 1$。\n- 面包店 $B_2$ 位于位置 $a_2 = 2$。\n- 咖啡馆 $C_1$ 位于位置 $b_1 = 5$。\n- 咖啡馆 $C_2$ 位于位置 $b_2 = 8$。\n\n每天早上，两家面包店生产等量的货物，每家正好提供总供应量的一半。同样，两家咖啡馆有相等的需求，每家需要总供应量的一半送达。供应和需求可以被建模为离散概率测度：供应测度为 $\\mu = \\frac{1}{2}\\delta_{a_1} + \\frac{1}{2}\\delta_{a_2}$，需求测度为 $\\nu = \\frac{1}{2}\\delta_{b_1} + \\frac{1}{2}\\delta_{b_2}$，其中 $\\delta_x$ 表示位于位置 $x$ 的单位质量。\n\n将单位货物从位置 $x$ 运输到位置 $y$ 的成本由平方欧几里得距离 $c(x, y) = (x-y)^2$ 给出。公司旨在确定一个运输计划，将所有货物从面包店运送到咖啡馆，同时最小化总运输成本。这样的计划，称为输运方案，可以用一个矩阵 $\\Pi = (\\pi_{ij})$ 来表示，其中 $\\pi_{ij}$ 是从面包店 $i$ 运输到咖啡馆 $j$ 的货物占总供应量的比例（对于 $i,j \\in \\{1,2\\}$）。\n\n确定能够实现最小可能总成本的最优输运方案 $\\Pi$。将您的答案以行矩阵的形式呈现，其中包含方案的各分量，顺序为 $\\begin{pmatrix} \\pi_{11} & \\pi_{12} & \\pi_{21} & \\pi_{22} \\end{pmatrix}$。", "solution": "这个问题是针对离散测度的最优输运问题的 Kantorovich 范式的一个实例。我们需要找到一个输运方案 $\\Pi = (\\pi_{ij})$，该方案在满足其边缘分布约束的条件下，最小化总成本。\n\n输运方案是一个具有非负项的 $2 \\times 2$ 矩阵：\n$$\n\\Pi = \\begin{pmatrix} \\pi_{11} & \\pi_{12} \\\\ \\pi_{21} & \\pi_{22} \\end{pmatrix}\n$$\n其中 $\\pi_{ij}$ 是从位于 $a_i$ 的面包店 $B_i$ 运输到位于 $b_j$ 的咖啡馆 $C_j$ 的质量量。\n\n首先，我们计算成本矩阵 $C = (c_{ij})$，其中 $c_{ij} = c(a_i, b_j) = (a_i - b_j)^2$。\n- $c_{11} = (a_1 - b_1)^2 = (1 - 5)^2 = (-4)^2 = 16$。\n- $c_{12} = (a_1 - b_2)^2 = (1 - 8)^2 = (-7)^2 = 49$。\n- $c_{21} = (a_2 - b_1)^2 = (2 - 5)^2 = (-3)^2 = 9$。\n- $c_{22} = (a_2 - b_2)^2 = (2 - 8)^2 = (-6)^2 = 36$。\n所以成本矩阵为：\n$$\nC = \\begin{pmatrix} 16 & 49 \\\\ 9 & 36 \\end{pmatrix}\n$$\n\n总运输成本是要最小化的目标函数：\n$$\nJ(\\Pi) = \\sum_{i=1}^{2} \\sum_{j=1}^{2} c_{ij} \\pi_{ij} = 16\\pi_{11} + 49\\pi_{12} + 9\\pi_{21} + 36\\pi_{22}\n$$\n\n约束条件是输运方案 $\\Pi$ 的边缘分布必须与给定的测度 $\\mu$ 和 $\\nu$ 相匹配。\n$\\Pi$ 的行和必须等于源位置（面包店）的质量：\n1.  $\\pi_{11} + \\pi_{12} = \\mu(\\{a_1\\}) = \\frac{1}{2}$ （来自 $B_1$ 的总质量）\n2.  $\\pi_{21} + \\pi_{22} = \\mu(\\{a_2\\}) = \\frac{1}{2}$ （来自 $B_2$ 的总质量）\n\n$\\Pi$ 的列和必须等于目标位置（咖啡馆）的质量：\n3.  $\\pi_{11} + \\pi_{21} = \\nu(\\{b_1\\}) = \\frac{1}{2}$ （运往 $C_1$ 的总质量）\n4.  $\\pi_{12} + \\pi_{22} = \\nu(\\{b_2\\}) = \\frac{1}{2}$ （运往 $C_2$ 的总质量）\n\n此外，输运方案的所有项都必须是非负的：\n5.  $\\pi_{ij} \\ge 0$ 对于所有 $i,j \\in \\{1,2\\}$。\n\n这是一个线性规划问题。我们可以通过参数化有效输运方案的空间来解决它。让我们用一个变量来表示所有变量，比如 $\\pi_{11} = x$。\n根据约束 (1)：$\\pi_{12} = \\frac{1}{2} - \\pi_{11} = \\frac{1}{2} - x$。\n根据约束 (3)：$\\pi_{21} = \\frac{1}{2} - \\pi_{11} = \\frac{1}{2} - x$。\n使用这些，我们从约束 (2) 中找到 $\\pi_{22}$：\n$\\pi_{22} = \\frac{1}{2} - \\pi_{21} = \\frac{1}{2} - (\\frac{1}{2} - x) = x$。\n我们可以检查这也满足约束 (4)：$\\pi_{12} + \\pi_{22} = (\\frac{1}{2} - x) + x = \\frac{1}{2}$。这是一致的。\n\n所以任何有效的输运方案都可以写成：\n$$\n\\Pi(x) = \\begin{pmatrix} x & \\frac{1}{2} - x \\\\ \\frac{1}{2} - x & x \\end{pmatrix}\n$$\n现在我们应用非负性约束 (5)：\n- $\\pi_{11} = x \\ge 0$。\n- $\\pi_{12} = \\frac{1}{2} - x \\ge 0 \\implies x \\le \\frac{1}{2}$。\n- $\\pi_{21} = \\frac{1}{2} - x \\ge 0 \\implies x \\le \\frac{1}{2}$。\n- $\\pi_{22} = x \\ge 0$。\n综合这些，参数 $x$ 的有效范围是 $0 \\le x \\le \\frac{1}{2}$。\n\n现在我们将总成本 $J$ 表示为 $x$ 的函数：\n$$\nJ(x) = 16x + 49\\left(\\frac{1}{2} - x\\right) + 9\\left(\\frac{1}{2} - x\\right) + 36x\n$$\n$$\nJ(x) = 16x + \\frac{49}{2} - 49x + \\frac{9}{2} - 9x + 36x\n$$\n$$\nJ(x) = (16 - 49 - 9 + 36)x + \\left(\\frac{49}{2} + \\frac{9}{2}\\right)\n$$\n$$\nJ(x) = (52 - 58)x + \\frac{58}{2}\n$$\n$$\nJ(x) = -6x + 29\n$$\n我们需要在区间 $x \\in [0, \\frac{1}{2}]$ 上最小化这个线性函数 $J(x)$。由于该函数的斜率为负 ($-6$)，其在区间上的最小值将在 $x$ 的最大可能值处取得，即 $x = \\frac{1}{2}$。\n\n$x$ 的最优值是 $x_{opt} = \\frac{1}{2}$。\n将此值代回参数化的方案 $\\Pi(x)$ 中：\n- $\\pi_{11} = x_{opt} = \\frac{1}{2}$。\n- $\\pi_{12} = \\frac{1}{2} - x_{opt} = \\frac{1}{2} - \\frac{1}{2} = 0$。\n- $\\pi_{21} = \\frac{1}{2} - x_{opt} = \\frac{1}{2} - \\frac{1}{2} = 0$。\n- $\\pi_{22} = x_{opt} = \\frac{1}{2}$。\n\n所以最优输运方案是：\n$$\n\\Pi^* = \\begin{pmatrix} \\frac{1}{2} & 0 \\\\ 0 & \\frac{1}{2} \\end{pmatrix}\n$$\n这个方案对应于将面包店 $B_1$ 的所有供应发送到咖啡馆 $C_1$，并将面包店 $B_2$ 的所有供应发送到咖啡馆 $C_2$，这是一种非交叉匹配。\n\n最终答案应以行矩阵的形式呈现：$\\begin{pmatrix} \\pi_{11} & \\pi_{12} & \\pi_{21} & \\pi_{22} \\end{pmatrix}$。\n即 $\\begin{pmatrix} \\frac{1}{2} & 0 & 0 & \\frac{1}{2} \\end{pmatrix}$。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{1}{2} & 0 & 0 & \\frac{1}{2} \\end{pmatrix}}$$", "id": "1424977"}, {"introduction": "在探索了离散情况之后，我们现在转向连续的世界。本问题将展示在一维空间中，如何利用累积分布函数（CDF）这一优雅而强大的方法来寻找最优传输映射。通过将一个均匀分布变换为一个指数分布，你将看到“前推测度”这一抽象概念如何转化为具体的计算，从而揭示最优传输与统计学中分位数函数之间的直接联系 [@problem_id:1424962]。", "problem": "考虑一个资源分配问题。一个连续资源最初在区间 $I = [0, 1]$上均匀分布。该初始分布的概率密度函数为当 $x \\in I$ 时$f(x)=1$，否则为零。需要移动和重排此资源，以匹配区间 $J = [0, \\infty)$ 上的一个目标分布。目标分布由概率密度函数 $g(y) = \\exp(-y)$ 描述，其中 $y \\in J$。\n\n将一小部分资源从点 $x \\in I$ 运输到点 $y \\in J$ 的成本与它们之间距离的平方成正比。目标是找到一个传输映射 $T: I \\to J$，它是一个严格递增的函数，为每个初始点 $x$ 分配一个唯一的终点 $y = T(x)$，使得此次重排的总成本最小化。\n\n确定这个最优传输映射 $T(x)$ 的显式函数形式。", "solution": "我们寻求从源概率密度 $f(x)=1$（在 $I=[0,1]$ 上）到目标概率密度 $g(y)=\\exp(-y)$（在 $J=[0,\\infty)$ 上）的二次成本函数 $c(x,y)=(x-y)^{2}$ 下的最优传输映射。在一维情况下，对于凸成本函数，最优 Monge 映射是单调重排，它由推前条件唯一确定（在测度为零的集合上除外），并且是严格递增的。对于一个严格递增的传输映射 $T$，推前条件可以等价地用累积分布函数来表示：如果 $F$ 和 $G$ 分别是 $f$ 和 $g$ 的累积分布函数 (CDF)，那么\n$$\nF(x)=G(T(x)) \\quad \\text{对所有 } x \\in [0,1].\n$$\n这源于区间上的质量守恒：对于任何 $x \\in [0,1]$，在 $f$ 下 $[0,x]$ 的质量等于在 $g$ 下 $[0,T(x)]$ 的质量。因此，最优映射由分位数公式给出\n$$\nT(x)=G^{-1}(F(x)).\n$$\n我们来计算累积分布函数。对于在 $[0,1]$ 上的 $f(x)=1$，其累积分布函数是\n$$\nF(x)=x \\quad \\text{对 } x \\in [0,1].\n$$\n对于在 $[0,\\infty)$ 上的 $g(y)=\\exp(-y)$，其累积分布函数是\n$$\nG(y)=\\int_{0}^{y}\\exp(-t)\\,dt=1-\\exp(-y) \\quad \\text{对 } y \\geq 0.\n$$\n为了得到分位数函数，求解 $u=G(y)=1-\\exp(-y)$ 以得出 $y$：\n$$\n\\exp(-y)=1-u \\quad \\Longrightarrow \\quad y=-\\ln(1-u),\n$$\n所以\n$$\nG^{-1}(u)=-\\ln(1-u) \\quad \\text{对 } u \\in [0,1).\n$$\n因此，最优传输映射为\n$$\nT(x)=G^{-1}(F(x))=-\\ln(1-x) \\quad \\text{对 } x \\in [0,1).\n$$\n此 $T$ 是严格递增的，因为在 $[0,1)$ 上有 $T'(x)=\\frac{1}{1-x}>0$，它满足边界条件 $T(0)=0$，并且当 $x \\uparrow 1$ 时，$T(x)\\to+\\infty$，这与指数目标分布的无界支撑集相匹配。我们也可以验证推前密度恒等式 $g(T(x))\\,T'(x)=f(x)$：\n$$\ng(T(x))\\,T'(x)=\\exp\\bigl(-T(x)\\bigr)\\cdot \\frac{1}{1-x}=\\exp\\bigl(\\ln(1-x)\\bigr)\\cdot \\frac{1}{1-x}=1=f(x).\n$$\n根据针对凸成本的一维单调重排定理，这个 $T$ 是唯一的最优传输映射。", "answer": "$$\\boxed{-\\ln(1-x)}$$", "id": "1424962"}, {"introduction": "最后的这个练习探讨了最优传输理论中一个更深刻的方面：成本函数对解的结构所起的关键影响。通过比较凸成本函数（如平方距离 $c(x,y)=(x-y)^2$）和凹成本函数的结果，你将发现为什么某些运输问题会产生有序的、不交叉的映射，而另一些则会导致反单调的、交叉丰富的方案 [@problem_id:1424951]。这个练习将加深你对支配最优传输几何形态基本原则的直觉。", "problem": "考虑两个一维最优输运问题。在这两个问题中，目标都是将一个源概率测度 $\\mu$ 输运到一个目标概率测度 $\\nu$。源测度 $\\mu$ 是区间 $[0, 1]$ 上的均匀概率测度，目标测度 $\\nu$ 是区间 $[1, 2]$ 上的均匀概率测度。\n\n这两个问题仅在代价函数 $c(x, y)$ 上有所不同，该函数表示将单位质量从点 $x \\in [0, 1]$ 移动到点 $y \\in [1, 2]$ 的代价。\n\n1.  **问题 1：** 代价函数为 $c_1(x, y) = (x - y)^2$。令 $\\pi_1$ 为在所有有效的输运方案 $\\pi$ 上最小化总代价 $\\int_{[0,1]\\times[1,2]} c_1(x, y) \\, d\\pi(x, y)$ 的最优输运方案。令 $S_1$ 为 $\\pi_1$ 的支撑集。\n\n2.  **问题 2：** 代价函数为 $c_2(x, y) = \\sqrt{|x - y|}$。令 $\\pi_2$ 为在所有有效的输运方案 $\\pi$ 上最小化总代价 $\\int_{[0,1]\\times[1,2]} c_2(x, y) \\, d\\pi(x, y)$ 的最优输运方案。令 $S_2$ 为 $\\pi_2$ 的支撑集。\n\n一个函数 $T:[0,1] \\to [1,2]$ 被称为“递增”的，如果对于 $[0,1]$ 中的任意 $x_1 < x_2$，都有 $T(x_1) \\leq T(x_2)$。它被称为“递减”的，如果对于 $[0,1]$ 中的任意 $x_1 < x_2$，都有 $T(x_1) \\geq T(x_2)$。一个输运方案的支撑集是 $[0,1] \\times [1,2]$ 中测度所集中的最小闭集。\n\n下列哪个陈述正确地描述了支撑集 $S_1$ 和 $S_2$ 的几何性质？\n\nA. $S_1$ 和 $S_2$ 都是一维集合，各自对应于一个从 $[0,1]$ 到 $[1,2]$ 的唯一递增函数的图像。\nB. $S_1$ 和 $S_2$ 都是一维集合，各自对应于一个从 $[0,1]$ 到 $[1,2]$ 的唯一递减函数的图像。\nC. $S_1$ 是一个一维集合，对应于一个唯一递增函数的图像，而 $S_2$ 是一个一维集合，对应于一个唯一递减函数的图像。\nD. $S_1$ 是一个对应于一个函数图像的一维集合，而 $S_2$ 是二维集合 $[0,1] \\times [1,2]$。\nE. $S_1$ 是一个一维集合，对应于一个唯一递减函数的图像，而 $S_2$ 是一个一维集合，对应于一个唯一递增函数的图像。\nF. $S_1$ 和 $S_2$ 都是二维集合 $[0,1] \\times [1,2]$，因为这些方案不是确定性的。", "solution": "我们考虑在 $[0,1] \\times [1,2]$ 上的两个一维最优输运问题，其中源测度 $\\mu$ 在 $[0,1]$ 上均匀分布，目标测度 $\\nu$ 在 $[1,2]$ 上均匀分布。\n\n问题 1：$c_{1}(x,y)=(x-y)^{2}$。在一维情况下，对于形式为 $c(x,y)=h(y-x)$ 且 $h$ 严格凸的代价函数，最优方案由单调重排映射 $T_{1}=F_{\\nu}^{-1}\\circ F_{\\mu}$ 导出；此外，该方案是唯一的且单调递增的。这里，对于 $x\\in[0,1]$ 有 $F_{\\mu}(x)=x$，对于 $y\\in[1,2]$ 有 $F_{\\nu}(y)=y-1$，因此对于 $u\\in[0,1]$ 有 $F_{\\nu}^{-1}(u)=u+1$。所以\n$$\nT_{1}(x)=F_{\\nu}^{-1}(F_{\\mu}(x))=x+1,\n$$\n它在 $[0,1]$ 上是递增的。最优方案 $\\pi_{1}$ 是确定性的，其支撑集是图像\n$$\nS_{1}=\\{(x,T_{1}(x)):(x\\in[0,1])\\}=\\{(x,x+1):x\\in[0,1]\\},\n$$\n这是一个一维集合。唯一性由严格凸性和扭转条件保证。\n\n问题 2：$c_{2}(x,y)=\\sqrt{|x-y|}$。由于 $x\\in[0,1]$ 且 $y\\in[1,2]$，对于所有可行对，我们有 $y\\ge x$，因此 $|x-y|=y-x$。定义 $h(r)=r^{1/2}$ 对于 $r\\ge 0$。那么 $h$ 是严格凹且递增的。对于具有边际分布 $\\mu$ 和 $\\nu$ 的任意耦合 $(X,Y)$，其平均距离满足\n$$\n\\mathbb{E}[Y-X]=\\mathbb{E}[Y]-\\mathbb{E}[X]=1,\n$$\n这对于所有耦合都是固定的。为了在 $h$ 严格凹且 $Y-X$ 的均值固定的情况下最小化 $\\mathbb{E}[h(Y-X)]$，应当最大化 $Y-X$ 的离散度。这可以通过一个两点交换论证来形式化：取 $x_{1}<x_{2}$ 和 $y_{1}<y_{2}$。记 $r=y_{1}-x_{1}$ 和 $s=y_{2}-x_{2}$，两者均为非负。单调配对使用 $(x_{1},y_{1})$ 和 $(x_{2},y_{2})$，总代价为 $h(r)+h(s)$。反单调配对使用 $(x_{1},y_{2})$ 和 $(x_{2},y_{1})$，距离为 $r+\\delta$ 和 $s-\\delta$，其中\n$$\n\\delta=(y_{2}-y_{1})-(x_{2}-x_{1}).\n$$\n注意，由于 $y_{1}\\ge 1\\ge x_{2}$，我们有 $r+\\delta=y_{2}-x_{1}\\ge 0$ 和 $s-\\delta=y_{1}-x_{2}\\ge 0$。两组距离之和相等：\n$$\n(r+\\delta)+(s-\\delta)=r+s=(y_{1}-x_{1})+(y_{2}-x_{2}).\n$$\n由于 $h$ 是严格凹的，在和固定的配对中，除非 $\\delta=0$，否则对于分布更广的配对，$h$ 的和会严格更小。因此\n$$\nh(y_{1}-x_{1})+h(y_{2}-x_{2})>h(y_{2}-x_{1})+h(y_{1}-x_{2})\n$$\n只要 $\\delta\\ne 0$。迭代这个交换论证表明，任何不是完全反单调的方案都可以被改进，因此最优方案必须支撑在一个递减关系上。因为边际分布在等长区间上是连续且均匀的，所以唯一保持测度的递减输运映射是\n$$\nT_{2}(x)=2-x,\n$$\n它确实将 $\\mu$ 推向 $\\nu$。导出的方案是确定性的，严格最优的（根据严格凹性，任何偏离都会增加代价），并且在 $\\mu$-零测集上是唯一的。其支撑集是图像\n$$\nS_{2}=\\{(x,T_{2}(x)):(x\\in[0,1])\\}=\\{(x,2-x):x\\in[0,1]\\},\n$$\n这是一个一维集合，并且 $T_{2}$ 是递减的。\n\n综上所述：$S_{1}$ 是一个对应于唯一递增函数的一维图像，而 $S_{2}$ 是一个对应于唯一递减函数的一维图像。这对应于选项 C。", "answer": "$$\\boxed{C}$$", "id": "1424951"}]}