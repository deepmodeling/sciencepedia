{"hands_on_practices": [{"introduction": "哈代-利特尔伍德圆法的核心思想在于建立分析（积分）与数论（解计数）之间的桥梁。第一个练习将通过一个最简洁、最优美的例子来展示这一原理。我们将计算一个指数和的均方值，并揭示其结果如何直接对应于一个简单丢番图方程的“对角解”数量 [@problem_id:3091491]。", "problem": "设 $N$ 是一个固定的正整数，并定义指数和\n$$\nS(\\alpha) \\;=\\; \\sum_{n=1}^{N} \\exp\\!\\big(2\\pi i\\, \\alpha\\, n^{2}\\big),\n$$\n其中 $\\alpha \\in [0,1]$。考虑其均方值\n$$\nI(N) \\;=\\; \\int_{0}^{1} \\big|S(\\alpha)\\big|^{2}\\, d\\alpha.\n$$\n求 $I(N)$ 作为 $N$ 的函数的精确闭式表达式。然后，给出 $I(N)$ 的一个组合解释，将其解释为一个通过展开 $\\big|S(\\alpha)\\big|^{2}$ 自然产生的丢番图方程的解的个数，从而说明该解析均值是如何本着 Hardy–Littlewood 圆法的精神与“对角”解的计数联系起来的。最终报告的答案必须是 $I(N)$ 的精确表达式（无需四舍五入）。", "solution": "该问题要求计算指数和 $S(\\alpha)$ 的均方值并给出其组合解释。\n\n指数和定义为\n$$\nS(\\alpha) = \\sum_{n=1}^{N} \\exp(2\\pi i \\alpha n^2)\n$$\n其中 $N$ 是一个固定的正整数且 $\\alpha \\in [0,1]$。\n\n均方值由以下积分给出\n$$\nI(N) = \\int_{0}^{1} |S(\\alpha)|^2 \\, d\\alpha.\n$$\n为计算该积分，我们首先将模的平方 $|S(\\alpha)|^2$ 表示为 $S(\\alpha)$ 与其复共轭 $\\overline{S(\\alpha)}$ 的乘积。\n$$\n|S(\\alpha)|^2 = S(\\alpha) \\overline{S(\\alpha)}\n$$\n$S(\\alpha)$ 的复共轭是\n$$\n\\overline{S(\\alpha)} = \\overline{\\sum_{m=1}^{N} \\exp(2\\pi i \\alpha m^2)} = \\sum_{m=1}^{N} \\exp(-2\\pi i \\alpha m^2).\n$$\n我们使用不同的求和指标 $m$ 以区别于原始和中的指标 $n$。因此，乘积变为一个二重和：\n$$\n|S(\\alpha)|^2 = \\left( \\sum_{n=1}^{N} \\exp(2\\pi i \\alpha n^2) \\right) \\left( \\sum_{m=1}^{N} \\exp(-2\\pi i \\alpha m^2) \\right) = \\sum_{n=1}^{N} \\sum_{m=1}^{N} \\exp\\left(2\\pi i \\alpha (n^2 - m^2)\\right).\n$$\n现在我们将此表达式代回到 $I(N)$ 的积分中：\n$$\nI(N) = \\int_{0}^{1} \\sum_{n=1}^{N} \\sum_{m=1}^{N} \\exp\\left(2\\pi i \\alpha (n^2 - m^2)\\right) d\\alpha.\n$$\n由于求和是针对有限项的，我们可以交换积分和求和的顺序：\n$$\nI(N) = \\sum_{n=1}^{N} \\sum_{m=1}^{N} \\int_{0}^{1} \\exp\\left(2\\pi i \\alpha (n^2 - m^2)\\right) d\\alpha.\n$$\n积分的求值取决于 $n^2 - m^2$ 的整数值。令 $k = n^2 - m^2$。积分为 $\\int_{0}^{1} \\exp(2\\pi i k \\alpha) d\\alpha$。这是圆群 $\\mathbb{R}/\\mathbb{Z}$ 的特征标的一个基本正交关系。\n\n情况1：$k=0$。这在 $n^2 - m^2 = 0$ 时发生。在这种情况下，被积函数为 $\\exp(0) = 1$。积分为：\n$$\n\\int_{0}^{1} 1 \\, d\\alpha = [\\alpha]_{0}^{1} = 1.\n$$\n\n情况2：$k \\neq 0$。在这种情况下，$k$ 是一个非零整数。积分为：\n$$\n\\int_{0}^{1} \\exp(2\\pi i k \\alpha) d\\alpha = \\left[ \\frac{\\exp(2\\pi i k \\alpha)}{2\\pi i k} \\right]_{0}^{1} = \\frac{\\exp(2\\pi i k) - \\exp(0)}{2\\pi i k}.\n$$\n由于 $k$ 是非零整数，根据欧拉公式，$\\exp(2\\pi i k) = \\cos(2\\pi k) + i\\sin(2\\pi k) = 1$。因此，积分的计算结果为：\n$$\n\\frac{1 - 1}{2\\pi i k} = 0.\n$$\n总而言之，当 $n^2 - m^2 = 0$ 时，积分 $\\int_{0}^{1} \\exp(2\\pi i \\alpha (n^2 - m^2)) d\\alpha$ 等于 $1$，否则等于 $0$。这可以用克罗内克 delta 符号写为 $\\delta_{n^2, m^2}$。\n\n$I(N)$ 的表达式简化为对满足 $n^2 - m^2 = 0$ 的数对 $(n, m)$ 的求和：\n$$\nI(N) = \\sum_{n=1}^{N} \\sum_{m=1}^{N} \\delta_{n^2, m^2}.\n$$\n条件 $n^2 = m^2$ 以及 $n$ 和 $m$ 是正整数（因为 $n,m \\in \\{1, 2, \\dots, N\\}$）的约束意味着 $n = m$。\n因此，二重和中唯一的非零项是那些位于“对角线”上，即 $n=m$ 的项。该和变为：\n$$\nI(N) = \\sum_{n=1}^{N} 1.\n$$\n这是对从 $1$ 到 $N$ 的每个整数求和 $1$。该和的值为 $N$。\n所以，该积分的精确闭式表达式为：\n$$\nI(N) = N.\n$$\n\n$I(N)$ 的组合解释直接源于此推导。展开 $|S(\\alpha)|^2$ 并逐项积分的过程表明，积分 $I(N)$ 的值恰好是丢番图方程\n$$\nn^2 - m^2 = 0 \\quad \\text{或} \\quad n^2 = m^2\n$$\n在约束条件 $1 \\le n \\le N$ 和 $1 \\le m \\le N$ 下的整数解的个数。正如已确定的，对于正整数 $n$ 和 $m$，该方程仅在 $n=m$ 时成立。因此，解对 $(n,m)$ 为 $(1,1), (2,2), \\dots, (N,N)$。恰好有 $N$ 个这样的解。这证实了 $I(N) = N$。\n\n此问题是 Hardy-Littlewood 圆法的一个简单模型。在该方法中，指数和乘积的积分用于对丢番图方程的解进行计数。积分 $I(N) = \\int_0^1 |S(\\alpha)|^2 d\\alpha$ 对 $n^2=m^2$ 的解进行计数。解 $n=m$ 被称为“对角”解。在更复杂的问题中，例如对 $n_1^k + n_2^k = m_1^k + m_2^k$ 的解进行计数时，对角解（其中 $\\{n_1, n_2\\}$ 是 $\\{m_1, m_2\\}$ 的一个排列）预计会对相应的积分做出主要贡献。$I(N)$ 的计算在一个对角解是唯一存在的解的情境中展示了这一原理。因此，解析均值 $I(N)$ 与这个计数问题直接相关。", "answer": "$$\\boxed{N}$$", "id": "3091491"}, {"introduction": "圆法预测，丢番图方程解的数量与一个被称为“奇异级数”的算术密度因子成正比。然而，这个因子有时可能为零，这直接预示着方程无整数解。本练习将通过研究一个同余方程，来探讨这种“局部障碍”如何导致全局性的问题，并最终使得奇异级数归零 [@problem_id:3091481]。", "problem": "令 $s\\in\\mathbb{N}$ 且 $k\\in\\mathbb{N}$，并考虑丢番图同余式 $x_1^k+\\cdots+x_s^k\\equiv n\\ (\\mathrm{mod}\\ q)$，其中 $x_1,\\dots,x_s$ 为整数，模 $q\\in\\mathbb{N}$ 是固定的。在 Hardy-Littlewood 圆法中，奇异级数 $\\mathfrak{S}_{s,k}(n)$ 定义为局部密度在所有素数 $p$ 上的乘积，其中在素数 $p$ 处的局部密度是当 $t\\to\\infty$ 时，模 $p^t$ 的解的归一化计数的极限。如果对于某个素数 $p$，对于所有足够大的 $t$，该同余式在模 $p^t$ 下没有解，那么在 $p$ 处的局部密度为 $0$，因此 $\\mathfrak{S}_{s,k}(n)=0$。\n\n考虑 $s=2$, $k=3$ 且 $q=9$ 的具体情况。你的任务是确定哪些同余类 $n\\ (\\mathrm{mod}\\ 9)$ 使得同余式 $x_1^3+x_2^3\\equiv n\\ (\\mathrm{mod}\\ 9)$ 无解，并解释这一障碍如何导致奇异级数 $\\mathfrak{S}_{2,3}(n)$ 为零。选择正确的陈述。\n\nA. 对于 $n\\equiv 3,4,5,6\\ (\\mathrm{mod}\\ 9)$，同余式 $x_1^3+x_2^3\\equiv n\\ (\\mathrm{mod}\\ 9)$ 无解；此外，这种无解性在模 $3^t$（对于所有 $t\\ge 2$）下持续存在，因此在 $p=3$ 处的局部密度为 $0$，从而 $\\mathfrak{S}_{2,3}(n)=0$。\n\nB. 对于 $n\\equiv 0\\ (\\mathrm{mod}\\ 9)$，同余式 $x_1^3+x_2^3\\equiv n\\ (\\mathrm{mod}\\ 9)$ 无解；因此，在 $p=3$ 处的局部密度为 $0$ 且 $\\mathfrak{S}_{2,3}(n)=0$。\n\nC. 对于每个 $n\\ (\\mathrm{mod}\\ 9)$，同余式 $x_1^3+x_2^3\\equiv n\\ (\\mathrm{mod}\\ 9)$ 都有解；因此不存在同余障碍，且对于所有 $n$，都有 $\\mathfrak{S}_{2,3}(n)>0$。\n\nD. 障碍恰好在 $n$ 为奇数时出现，因此只要 $n$ 是奇数，就有 $\\mathfrak{S}_{2,3}(n)=0$。\n\nE. 这种同余障碍只能在素数模下出现，而不能在像 $9$ 这样的合数模下出现，因此 $\\mathfrak{S}_{2,3}(n)$ 不会因模 $9$ 的条件而为零。", "solution": "用户要求分析丢番图同余式 $x_1^3 + x_2^3 \\equiv n \\pmod{9}$ 及其对 Hardy-Littlewood 圆法中奇异级数 $\\mathfrak{S}_{2,3}(n)$ 的影响。\n\n### 步骤 1：验证问题陈述\n\n我将首先根据要求的协议验证问题陈述。\n\n#### 已知条件\n*   该问题涉及丢番图同余式 $x_1^k+\\cdots+x_s^k\\equiv n\\ (\\mathrm{mod}\\ q)$，其中 $x_1, \\dots, x_s$ 是整数，模 $q \\in \\mathbb{N}$ 是固定的，且 $s, k \\in \\mathbb{N}$。\n*   奇异级数定义为 $\\mathfrak{S}_{s,k}(n) = \\prod_{p} \\chi_p(n)$，其中 $\\chi_p(n)$ 是在素数 $p$ 处的局部密度。\n*   局部密度 $\\chi_p(n)$ 是当 $t \\rightarrow \\infty$ 时，模 $p^t$ 的解的归一化计数的极限。\n*   如果对于某个素数 $p$，对于所有足够大的 $t$，同余式 $x_1^k+\\cdots+x_s^k\\equiv n\\ (\\mathrm{mod}\\ p^t)$ 无解，则 $\\chi_p(n)=0$，因此 $\\mathfrak{S}_{s,k}(n)=0$。\n*   需要分析的具体情况是 $s=2, k=3$，模为 $q=9$。\n*   任务是确定哪些同余类 $n \\pmod{9}$ 使得 $x_1^3+x_2^3\\equiv n\\ (\\mathrm{mod}\\ 9)$ 无解，并解释其对 $\\mathfrak{S}_{2,3}(n)$ 的影响。\n\n#### 验证\n1.  **科学或事实不健全**：问题陈述在科学上是健全的。它正确地描述了华林问题（Waring's problem）的设定、奇异级数的定义以及局部障碍的概念。这些都是解析数论中的标准主题。\n2.  **无法形式化或不相关**：该问题是形式化的，并且与数论中的 Hardy-Littlewood 圆法主题直接相关。\n3.  **不完整或矛盾的设定**：问题是自洽的，并提供了进行分析所需的所有必要信息（$s=2, k=3$，模 $9$）。没有矛盾之处。\n4.  **不切实际或不可行**：该问题是数论中的一个标准理论练习，与物理现实无关。\n5.  **不适定或结构不良**：问题是适定的。它要求一个特定的同余类集合和一个特定的解释，对此存在一个唯一且正确的答案。\n6.  **伪深刻、琐碎或同义反复**：问题并非琐碎；它需要直接计算和对基础理论的理解。\n7.  **超出科学可验证性范围**：这些主张在数学上是可验证的。\n\n#### 结论\n问题陈述是有效的。我将继续进行解答。\n\n### 步骤 2：推导解答\n\n问题的核心是确定对于哪些 $n$ 值，同余式 $x_1^3 + x_2^3 \\equiv n \\pmod{9}$ 有解。为此，我们首先需要确定单个立方数 $x^3$ 模 $9$ 的所有可能值。我们可以对每个剩余类 $x \\pmod{9}$ 进行计算。\n\n令 $x$ 为一个整数。我们考察 $x^3 \\pmod{9}$。\n*   如果 $x \\equiv 0 \\pmod{3}$，那么 $x=3m$（其中 $m$ 为某个整数）。因此，$x^3 = (3m)^3 = 27m^3 = 3 \\cdot 9 \\cdot m^3 \\equiv 0 \\pmod{9}$。这涵盖了 $x \\equiv 0, 3, 6 \\pmod{9}$。\n    *   $0^3 \\equiv 0 \\pmod{9}$\n    *   $3^3 = 27 \\equiv 0 \\pmod{9}$\n    *   $6^3 = 216 = 24 \\times 9 \\equiv 0 \\pmod{9}$\n*   如果 $x \\equiv 1 \\pmod{3}$，那么 $x=3m+1$（其中 $m$ 为某个整数）。因此，$x^3 = (3m+1)^3 = (3m)^3 + 3(3m)^2(1) + 3(3m)(1)^2 + 1^3 = 27m^3 + 27m^2 + 9m + 1 \\equiv 1 \\pmod{9}$。这涵盖了 $x \\equiv 1, 4, 7 \\pmod{9}$。\n    *   $1^3 \\equiv 1 \\pmod{9}$\n    *   $4^3 = 64 = 7 \\times 9 + 1 \\equiv 1 \\pmod{9}$\n    *   $7^3 = 343 = 38 \\times 9 + 1 \\equiv 1 \\pmod{9}$\n*   如果 $x \\equiv 2 \\pmod{3}$，那么 $x=3m+2$（其中 $m$ 为某个整数）。因此，$x^3 = (3m+2)^3 = (3m)^3 + 3(3m)^2(2) + 3(3m)(2)^2 + 2^3 = 27m^3 + 54m^2 + 36m + 8 \\equiv 8 \\pmod{9}$。这涵盖了 $x \\equiv 2, 5, 8 \\pmod{9}$。\n    *   $2^3 = 8 \\pmod{9}$\n    *   $5^3 = 125 = 13 \\times 9 + 8 \\equiv 8 \\pmod{9}$\n    *   $8^3 = 512 = 56 \\times 9 + 8 \\equiv 8 \\pmod{9}$\n\n所以，一个立方数模 $9$ 的所有可能值的集合是 $C = \\{0, 1, 8\\}$。\n\n接下来，我们找出两个立方数之和 $x_1^3 + x_2^3$ 模 $9$ 的可能值。我们需要计算集合 $C$ 中两个元素的所有可能和：\n*   $0+0 = 0$\n*   $0+1 = 1$\n*   $0+8 = 8$\n*   $1+1 = 2$\n*   $1+8 = 9 \\equiv 0$\n*   $8+8 = 16 \\equiv 7$\n\n$x_1^3 + x_2^3 \\pmod{9}$ 的所有可能值的集合是 $S = \\{0, 1, 2, 7, 8\\}$。\n\n如果 $n$ 不在集合 $S$ 中，则同余式 $x_1^3 + x_2^3 \\equiv n \\pmod{9}$ 无解。模 $9$ 的所有余数的集合是 $\\{0, 1, 2, 3, 4, 5, 6, 7, 8\\}$。不在 $S$ 中的余数是 $\\{3, 4, 5, 6\\}$。\n因此，对于 $n \\equiv 3, 4, 5, 6 \\pmod{9}$，该同余式无解。\n\n这一发现与奇异级数 $\\mathfrak{S}_{2,3}(n)$ 相关。奇异级数是局部密度的乘积，$\\mathfrak{S}_{2,3}(n) = \\prod_p \\chi_p(n)$。在素数 $p$ 处的局部密度是 $\\chi_p(n) = \\sum_{a=0}^\\infty M_p(n, a)$，其中 $M_p(n, a)$ 与模 $p$ 的幂的解的数量有关。一个更直接的定义是 $\\chi_p(n) = \\lim_{t\\to\\infty} \\frac{N(p^t; n)}{p^{t(s-1)}}$，其中 $N(p^t; n)$ 是模 $p^t$ 的同余式的解的数量。\n如果对于某个 $t_0$，$N(p^{t_0}; n) = 0$，那么对于任何 $t > t_0$，$N(p^t; n) = 0$。这是因为任何模 $p^t$ 的解也必须是模 $p^{t_0}$ 的解。如果模 $p^{t_0}$ 没有解，那么模 $p^t$ 也不可能有解。\n在我们的例子中，$s=2, k=3$，模为 $9=3^2$，我们正在考察素数 $p=3$ 处的局部行为。我们发现对于 $n \\equiv 3, 4, 5, 6 \\pmod{9}$，同余式 $x_1^3+x_2^3\\equiv n\\ (\\mathrm{mod}\\ 3^2)$ 的解的数量为 $N(3^2; n) = 0$。\n这意味着对于任何 $t \\ge 2$，对于这些 $n$ 值，$N(3^t; n)=0$。\n因此，在 $p=3$ 处的局部密度为\n$$ \\chi_3(n) = \\lim_{t\\to\\infty} \\frac{N(3^t; n)}{3^{t(2-1)}} = \\lim_{t\\to\\infty} \\frac{0}{3^t} = 0 $$\n由于乘积 $\\mathfrak{S}_{2,3}(n) = \\chi_2(n) \\chi_3(n) \\chi_5(n) \\cdots$ 中的一个因子为零，整个奇异级数都为零：$\\mathfrak{S}_{2,3}(n) = 0$。这就是所谓的在素数 $3$ 处的“局部障碍”。\n\n### 步骤 3：逐项分析\n\nA. **对于 $n\\equiv 3,4,5,6\\ (\\mathrm{mod}\\ 9)$，同余式 $x_1^3+x_2^3\\equiv n\\ (\\mathrm{mod}\\ 9)$ 无解；此外，这种无解性在模 $3^t$（对于所有 $t\\ge 2$）下持续存在，因此在 $p=3$ 处的局部密度为 $0$，从而 $\\mathfrak{S}_{2,3}(n)=0$。**\n这个陈述准确地反映了我们的推导。我们发现同余式恰好在 $n \\equiv 3, 4, 5, 6 \\pmod{9}$ 时无解。它正确地指出，这意味着对于任何更高的 $3$ 的幂次都无解，导致在 $p=3$ 处的局部密度为零，并且奇异级数为零。这个陈述是**正确的**。\n\nB. **对于 $n\\equiv 0\\ (\\mathrm{mod}\\ 9)$，同余式 $x_1^3+x_2^3\\equiv n\\ (\\mathrm{mod}\\ 9)$ 无解；因此，在 $p=3$ 处的局部密度为 $0$ 且 $\\mathfrak{S}_{2,3}(n)=0$。**\n这个陈述是错误的。我们发现 $n \\equiv 0 \\pmod{9}$ 是一个可以达到的值。例如，$x_1=3, x_2=6$ 得到 $3^3+6^3 = 27+216=243$，这与 $0 \\pmod{9}$ 同余。此外，$x_1=1, x_2=2$ 得到 $1^3+2^3=9\\equiv 0\\ (\\mathrm{mod}\\ 9)$。因此，对于 $n \\equiv 0 \\pmod{9}$ 是有解的。这个陈述是**错误的**。\n\nC. **对于每个 $n\\ (\\mathrm{mod}\\ 9)$，同余式 $x_1^3+x_2^3\\equiv n\\ (\\mathrm{mod}\\ 9)$ 都有解；因此不存在同余障碍，且对于所有 $n$，都有 $\\mathfrak{S}_{2,3}(n)>0$。**\n这个陈述是错误的。正如我们的推导所示，对于 $n \\equiv 3, 4, 5, 6 \\pmod{9}$ 无解。因此，存在同余障碍。这个陈述是**错误的**。\n\nD. **障碍恰好在 $n$ 为奇数时出现，因此只要 $n$ 是奇数，就有 $\\mathfrak{S}_{2,3}(n)=0$。**\n这个陈述是错误的。受阻值的集合是 $\\{3, 4, 5, 6\\}$，其中既包含奇数（$3, 5$），也包含偶数（$4, 6$）。此外，存在奇数值的 $n$，如 $n=1$ 和 $n=7$，它们是有解的。将障碍描述为“奇数 $n$”是不正确的。这个陈述是**错误的**。\n\nE. **这种同余障碍只能在素数模下出现，而不能在像 $9$ 这样的合数模下出现，因此 $\\mathfrak{S}_{2,3}(n)$ 不会因模 $9$ 的条件而为零。**\n这个陈述从根本上误解了华林问题中局部可解性的理论。局部障碍是在素数幂模 $p^t$ 下进行研究的。在许多情况下，特别是当 $p$ 整除 $k$ 时，必须研究模为 $p^t$ 且 $t>1$ 的情况才能找到障碍。模 $9=3^2$ 正是对于 $k=3$ 必须检查的那种模。我们的分析已明确表明，在模 $9$ 下存在一个障碍。这个陈述是**错误的**。", "answer": "$$\\boxed{A}$$", "id": "3091481"}, {"introduction": "“圆法”得名于其将积分路径（单位圆）分解为“主弧”和“劣弧”的策略。其核心思想是，解数目的主项贡献完全来自于主弧——那些围绕着简分数的微小邻域。本练习将从理论推导转向计算机实践，通过数值计算来验证主弧的支配地位，从而对圆法的运作方式获得更直观的感受 [@problem_id:3091469]。", "problem": "你将通过数值验证，在 Hardy-Littlewood 圆法的框架内，证明对于一个模型指数和，主弧的贡献在总积分中占主导地位。考虑二次 Weyl 和\n$$\nS(\\alpha) \\;=\\; \\sum_{n=1}^{X} e^{2\\pi i \\alpha n^2},\n$$\n其中 $X$ 是一个正整数，$\\alpha \\in [0,1)$，$i$ 表示虚数单位。对于一个固定的正整数 $k$，定义积分\n$$\nI_{\\mathrm{total}} \\;=\\; \\int_{0}^{1} \\left|S(\\alpha)\\right|^{k} \\, d\\alpha.\n$$\n将主弧定义为围绕小分母有理点的有限个弧的并集。对于给定的参数 $Q \\in \\mathbb{N}$ 和 $\\Delta > 0$，为每个满足 $1 \\le q \\le Q$ 和 $\\gcd(a,q) = 1$ 的既约分数 $a/q$ 定义弧\n$$\n\\mathfrak{M}\\left(\\tfrac{a}{q}\\right) \\;=\\; \\left\\{ \\alpha \\in [0,1) \\,\\colon\\, \\min\\left(\\left|\\alpha - \\tfrac{a}{q}\\right|,\\, 1 - \\left|\\alpha - \\tfrac{a}{q}\\right|\\right) \\le \\frac{\\Delta}{q X} \\right\\}.\n$$\n令 $\\mathfrak{M}$ 表示所有满足 $1 \\le q \\le Q$ 的既约分数 $a/q$ 对应的弧 $\\mathfrak{M}\\left(\\tfrac{a}{q}\\right)$ 的并集。定义主弧积分近似\n$$\nI_{\\mathrm{major}} \\;=\\; \\int_{\\mathfrak{M}} \\left|S(\\alpha)\\right|^{k} \\, d\\alpha.\n$$\n你的任务是通过对 $M$ 个等距采样点进行均匀黎曼求和，来数值近似 $I_{\\mathrm{total}}$ 和 $I_{\\mathrm{major}}$，然后计算比率\n$$\nR \\;=\\; \\frac{I_{\\mathrm{major}}}{I_{\\mathrm{total}}}.\n$$\n使用以下数值方案：\n- 使用 $M$ 个等距采样点 $\\alpha_{j} = \\frac{j}{M}$（其中 $j = 0, 1, \\dots, M-1$）通过以下形式的黎曼和来近似 $[0,1)$ 上的积分\n$$\n\\frac{1}{M}\\sum_{j=0}^{M-1} f(\\alpha_{j}).\n$$\n- 通过以下方式近似 $I_{\\mathrm{total}}$\n$$\nI_{\\mathrm{total}} \\approx \\frac{1}{M}\\sum_{j=0}^{M-1} \\left|S\\left(\\alpha_{j}\\right)\\right|^{k}.\n$$\n- 通过将求和限制在并集 $\\mathfrak{M}$ 内的那些 $\\alpha_{j}$ 上来近似 $I_{\\mathrm{major}}$。单位圆上的距离应通过以下方式实现\n$$\n\\mathrm{dist}\\left(\\alpha, \\tfrac{a}{q}\\right) \\;=\\; \\min\\!\\left(\\left|\\alpha - \\tfrac{a}{q}\\right|,\\, 1 - \\left|\\alpha - \\tfrac{a}{q}\\right|\\right).\n$$\n- 将 $R$ 计算为这两个近似值的商。请注意，根据构造，$0 \\le R \\le 1$。\n\n复指数 $e^{2\\pi i \\alpha n^2}$ 中的角度以弧度为单位。所有数值结果均无单位。\n\n使用的基本依据和约束：\n- 仅使用上面给出的定义和在 $[0,1)$ 上积分的数值黎曼和近似。\n- 不要假设任何未经证明的 $S(\\alpha)$ 渐近公式；你的代码必须根据其定义为每个采样点直接计算 $S(\\alpha)$。\n- 距离 $\\mathrm{dist}(\\cdot,\\cdot)$ 必须按规定在单位圆上计算。\n- 并集 $\\mathfrak{M}$ 可能有重叠的弧；将其视为集合的并集（即，包含任何至少位于一个主弧中的采样点 $\\alpha_{j}$）。\n\n要实现的测试套件：\n- 在所有测试用例中均使用 $M = 16384$。\n- 为以下参数集 $(X,k,Q,\\Delta)$ 计算比率 $R$：\n    - 测试 1：$(X,k,Q,\\Delta) = (180,4,8,2)$，\n    - 测试 2：$(X,k,Q,\\Delta) = (180,8,8,2)$，\n    - 测试 3：$(X,k,Q,\\Delta) = (180,4,1,2)$，\n    - 测试 4：$(X,k,Q,\\Delta) = (90,4,6,1)$。\n每个测试用例应产生一个实数 $R$。\n\n要求的最终输出格式：\n- 你的程序应产生单行输出，其中包含按上述测试用例顺序排列的结果，形式为方括号括起来的逗号分隔列表。例如，\n$$\n[\\!r_{1},r_{2},r_{3},r_{4}\\!]\n$$\n其中每个 $r_{j}$ 是一个格式化为小数点后恰好 $6$ 位的浮点数。", "solution": "该问题要求对 Hardy-Littlewood 圆法中的一个关键原则进行数值验证：对于某些指数和，在“主弧”上的积分构成了在单位区间上总积分的主要部分。我们将为二次 Weyl 和 $S(\\alpha) = \\sum_{n=1}^{X} e^{2\\pi i \\alpha n^2}$ 计算比率 $R = \\frac{I_{\\mathrm{major}}}{I_{\\mathrm{total}}}$。\n\n计算过程通过使用黎曼和来数值近似积分 $I_{\\mathrm{total}}$ 和 $I_{\\mathrm{major}}$。积分域，即单位区间 $[0,1)$，被离散化为 $M$ 个等距点 $\\alpha_j = \\frac{j}{M}$，其中 $j=0, 1, \\dots, M-1$。\n\n整体计算流程如下：\n\n- **定义域的离散化**：我们在区间 $[0,1)$ 上定义一个包含 $M$ 个点的均匀网格 $\\alpha_j = \\frac{j}{M}$，其中 $j \\in \\{0, 1, \\dots, M-1\\}$。对于所有测试用例，采样点数量为 $M=16384$。\n\n- **Weyl 和的求值**：对于每个采样点 $\\alpha_j$，我们计算二次 Weyl 和 $S(\\alpha_j) = \\sum_{n=1}^{X} e^{2\\pi i \\alpha_j n^2}$ 的值。为高效地同时对所有 $\\alpha_j$ 进行此操作，我们采用向量化计算。我们构建一个采样点向量 $\\alpha_j$ 和一个整数平方向量 $n^2$（其中 $n \\in \\{1, 2, \\dots, X\\}$）。利用广播机制，我们可以计算一个 $M \\times X$ 的相位角矩阵 $2\\pi \\alpha_j n^2$，取每个元素的复指数，然后沿对应于 $n$ 的轴求和，从而得到所有 $M$ 个 $S(\\alpha_j)$ 的值。\n\n- **被积函数的计算**：$I_{\\mathrm{total}}$ 和 $I_{\\mathrm{major}}$ 的被积函数都是 $|S(\\alpha)|^k$。计算出复数值 $S(\\alpha_j)$ 后，我们求其绝对值并提升到 $k$ 次幂，得到一组 $M$ 个实数 $|S(\\alpha_j)|^k$。\n\n- **总积分 $I_{\\mathrm{total}}$ 的近似**：积分 $I_{\\mathrm{total}} = \\int_0^1 |S(\\alpha)|^k \\, d\\alpha$ 通过对全套采样点进行黎曼和来近似。该近似由被积函数值的平均值给出：\n$$\nI_{\\mathrm{total}} \\approx \\frac{1}{M} \\sum_{j=0}^{M-1} |S(\\alpha_j)|^k.\n$$\n\n- **主弧 $\\mathfrak{M}$ 的识别**：主弧集合 $\\mathfrak{M}$ 定义为以分母较小的有理数 $\\tfrac{a}{q}$ 为中心的较小弧的并集。\n    - 首先，我们生成所有满足 $1 \\le q \\le Q$ 和 $1 \\le a \\le q$ 且 $\\gcd(a,q)=1$ 的既约分数 $\\tfrac{a}{q}$ 的集合。\n    - 对于每个采样点 $\\alpha_j$，我们必须确定它是否属于 $\\mathfrak{M}$。如果一个点 $\\alpha_j$ 至少位于一个弧 $\\mathfrak{M}(\\tfrac{a}{q})$ 中，那么它就在 $\\mathfrak{M}$ 中。这意味着必须存在一个我们生成的集合中的分数 $\\tfrac{a}{q}$，使得 $\\alpha_j$ 和 $\\tfrac{a}{q}$ 在单位圆上的距离小于或等于一个指定的半径。条件是：\n    $$\n    \\mathrm{dist}(\\alpha_j, \\tfrac{a}{q}) = \\min\\left(|\\alpha_j - \\tfrac{a}{q}|, 1 - |\\alpha_j - \\tfrac{a}{q}|\\right) \\le \\frac{\\Delta}{qX}.\n    $$\n    - 我们通过创建一个大小为 $M$ 的布尔数组来实现这一点，该数组初始化为表示一个空集。对于每个分数 $\\tfrac{a}{q}$，我们识别所有满足距离条件的点 $\\alpha_j$，并执行逻辑或运算来更新布尔数组。这正确地实现了集合并集 $\\mathfrak{M} = \\bigcup_{a,q} \\mathfrak{M}(\\tfrac{a}{q})$。\n\n- **主弧积分 $I_{\\mathrm{major}}$ 的近似**：积分 $I_{\\mathrm{major}} = \\int_{\\mathfrak{M}} |S(\\alpha)|^k \\, d\\alpha$ 通过类似的黎曼和来近似，但仅限于那些被识别为属于主弧 $\\mathfrak{M}$ 的点 $\\alpha_j$：\n$$\nI_{\\mathrm{major}} \\approx \\frac{1}{M} \\sum_{j \\, \\text{s.t.} \\, \\alpha_j \\in \\mathfrak{M}} |S(\\alpha_j)|^k.\n$$\n\n- **比率 $R$ 的计算**：最后，通过将两个近似积分值相除来计算比率 $R$：\n$$\nR = \\frac{I_{\\mathrm{major}}}{I_{\\mathrm{total}}}.\n$$\n这个比率表示总积分的贡献中来自主弧的比例，展示了圆法的一个基本启发式思想。最终结果是为所提供的四个测试用例中的每一个计算的。", "answer": "```python\nimport numpy as np\n\ndef compute_ratio(X, k, Q, Delta, M):\n    \"\"\"\n    Computes the ratio R = I_major / I_total for a given set of parameters.\n\n    Args:\n        X (int): Upper limit for the Weyl sum.\n        k (int): Exponent for the absolute value of the Weyl sum.\n        Q (int): Upper limit for the denominators of rational points.\n        Delta (float): Parameter for the width of the major arcs.\n        M (int): Number of sample points for the Riemann sum.\n\n    Returns:\n        float: The computed ratio R.\n    \"\"\"\n    # 1. Generate reduced fractions a/q\n    fractions = []\n    for q_val in range(1, Q + 1):\n        for a_val in range(1, q_val + 1):\n            if np.gcd(a_val, q_val) == 1:\n                fractions.append((a_val, q_val))\n\n    # 2. Generate sample points on the interval [0, 1)\n    alpha_j = np.arange(M) / M\n\n    # 3. Calculate all S(alpha_j) values using vectorized operations\n    n_sq = np.arange(1, X + 1, dtype=np.int64)**2\n    # Use broadcasting for efficiency.\n    # The `angles` matrix will have shape (M, X).\n    angles = 2 * np.pi * alpha_j[:, np.newaxis] * n_sq\n    # Sum over the 'n' axis to get a vector of S(alpha_j) values of shape (M,).\n    S_values = np.sum(np.exp(1j * angles), axis=1)\n\n    # 4. Calculate the integrand values |S(alpha_j)|^k\n    f_values = np.abs(S_values)**k\n\n    # 5. Calculate the total integral approximation\n    I_total_approx = np.sum(f_values) / M\n    if I_total_approx == 0:\n        # This case is unlikely because S(0) = X > 0, making the sum non-zero.\n        return 0.0\n\n    # 6. Identify sample points that lie in the major arcs\n    is_major = np.zeros(M, dtype=bool)\n    for a_val, q_val in fractions:\n        center = a_val / q_val\n        radius = Delta / (q_val * X)\n        \n        # Calculate distance on the unit circle for all alpha_j to the center\n        diff = np.abs(alpha_j - center)\n        dist = np.minimum(diff, 1 - diff)\n        \n        # Find points within the arc radius\n        mask = dist = radius\n        # Use logical OR to build the union of all major arcs\n        is_major |= mask\n\n    # 7. Calculate the major-arc integral approximation\n    I_major_approx = np.sum(f_values[is_major]) / M\n\n    # 8. Calculate the final ratio\n    R = I_major_approx / I_total_approx\n    \n    return R\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Number of sample points for the Riemann sums\n    M = 16384\n    \n    # Define the test cases from the problem statement\n    test_cases = [\n        # (X, k, Q, Delta)\n        (180, 4, 8, 2),\n        (180, 8, 8, 2),\n        (180, 4, 1, 2),\n        (90, 4, 6, 1),\n    ]\n\n    results = []\n    for X, k, Q, Delta in test_cases:\n        ratio = compute_ratio(X, k, Q, Delta, M)\n        # Format the result to exactly 6 digits after the decimal point\n        results.append(f\"{ratio:.6f}\")\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solution\nsolve()\n\n```", "id": "3091469"}]}