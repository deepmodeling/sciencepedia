{"hands_on_practices": [{"introduction": "埃拉托斯特尼筛法（Sieve of Eratosthenes）的核心在于系统地标记合数。本练习将这个核心操作分解为其本质，要求您精确计算在特定整数区间 $[L, R]$ 内，有多少个数会被某个给定的素数 $p$ 标记。掌握这一基本计算，对于理解和实现更高级的分段式筛法至关重要。[@problem_id:3093465]", "problem": "在 Eratosthenes 筛法的算法步骤中，我们固定一个质数 $p$，并在一个给定的整数区间 $[L,R]$（其中 $1 \\leq L \\leq R$）内，标记所有是 $p$ 的倍数的位置。假设区间 $[L,R]$ 包含至少一个 $p$ 的倍数，并令 $a$ 表示 $[L,R]$ 中 $p$ 的最小倍数。请仅使用核心定义（质数的定义、Eratosthenes 筛法的操作原理，以及地板函数 $\\lfloor \\cdot \\rfloor$ 和天花板函数 $\\lceil \\cdot \\rceil$ 的定义与基本性质），推导出一个关于 $p$、$L$、$R$ 和 $a$ 的精确封闭形式表达式，用以表示 $[L,R]$ 中被标记位置的数量。\n\n然后，应用你推导的公式，计算当 $p=9973$、$L=1{,}234{,}567$ 和 $R=1{,}345{,}678$ 时，被标记位置的确切数量。你的最终数值计数必须为精确值，不得进行四舍五入。", "solution": "Eratosthenes 筛法的过程是，对每个质数 $p$，在工作范围内标记其所有倍数。在一个固定的正整数区间 $[L,R]$ 中，由给定质数 $p$ 产生的被标记位置，正是所有形如 $pm$ 的整数，其中 $m \\in \\mathbb{Z}$ 且满足 $L \\leq pm \\leq R$。根据假设，在 $[L,R]$ 中至少存在一个 $p$ 的倍数，我们定义 $a$ 为其中最小的那个倍数：\n$$\na = \\min\\{ pm : m \\in \\mathbb{Z},\\, L \\leq pm \\leq R \\}.\n$$\n等价地，根据天花板函数的定义，不小于 $L$ 的 $p$ 的最小倍数是\n$$\na = p \\cdot \\left\\lceil \\frac{L}{p} \\right\\rceil ,\n$$\n而不大于 $R$ 的 $p$ 的最大倍数是\n$$\nb = p \\cdot \\left\\lfloor \\frac{R}{p} \\right\\rfloor .\n$$\n$[L,R]$ 中的被标记位置构成一个首项为 $a$、公差为 $p$ 的等差数列：\n$$\na,\\; a+p,\\; a+2p,\\; \\dots,\\; a+kp \\leq R,\n$$\n其中整数 $k \\geq 0$。令 $K$ 表示满足 $a + kp \\leq R$ 的最大整数 $k$。根据地板函数的定义，不等式 $a + kp \\leq R$ 等价于 $k \\leq \\frac{R-a}{p}$，因此\n$$\nK = \\left\\lfloor \\frac{R-a}{p} \\right\\rfloor .\n$$\n由于该数列从 $k=0$ 开始，到 $k=K$ 结束，所以项数（也就是 $[L,R]$ 中被标记位置的数量）为\n$$\n\\left\\lfloor \\frac{R-a}{p} \\right\\rfloor + 1.\n$$\n这就从第一性原理出发，确立了封闭形式的计数公式。\n\n将此表达式与使用端点的补充计数方法联系起来是很有启发性的。将 $a = p \\cdot \\left\\lceil \\frac{L}{p} \\right\\rceil$ 代入可得\n$$\n\\left\\lfloor \\frac{R-a}{p} \\right\\rfloor + 1\n= \\left\\lfloor \\frac{R}{p} - \\left\\lceil \\frac{L}{p} \\right\\rceil \\right\\rfloor + 1.\n$$\n对任意实数 $x$ 和整数 $n$，地板函数满足 $\\lfloor x - n \\rfloor = \\lfloor x \\rfloor - n$。将此性质应用于 $x = \\frac{R}{p}$ 和 $n = \\left\\lceil \\frac{L}{p} \\right\\rceil$ 可得\n$$\n\\left\\lfloor \\frac{R}{p} \\right\\rfloor - \\left\\lceil \\frac{L}{p} \\right\\rceil + 1.\n$$\n对于整数 $L$ 和正实数 $p$，我们有恒等式\n$$\n\\left\\lceil \\frac{L}{p} \\right\\rceil = \\left\\lfloor \\frac{L-1}{p} \\right\\rfloor + 1,\n$$\n该恒等式成立，因为满足 $m \\geq \\frac{L}{p}$ 的最小整数 $m$ 恰好比满足 $n \\leq \\frac{L}{p} - 1 = \\frac{L-1}{p}$ 的最大整数 $n$ 大 1。代入此恒等式，得到等价形式\n$$\n\\left\\lfloor \\frac{R}{p} \\right\\rfloor - \\left( \\left\\lfloor \\frac{L-1}{p} \\right\\rfloor + 1 \\right) + 1\n= \\left\\lfloor \\frac{R}{p} \\right\\rfloor - \\left\\lfloor \\frac{L-1}{p} \\right\\rfloor,\n$$\n这就是直接通过端点计算 $[L,R]$ 中 $p$ 的倍数数量的标准方法。\n\n我们现在来计算当 $p=9973$、$L=1{,}234{,}567$ 和 $R=1{,}345{,}678$ 时所要求的数值计数。\n\n首先，计算 $\\left\\lfloor \\frac{R}{p} \\right\\rfloor$：\n$$\n\\left\\lfloor \\frac{1{,}345{,}678}{9{,}973} \\right\\rfloor = 134,\n$$\n因为 $9{,}973 \\cdot 134 = 1{,}336{,}382 \\leq 1{,}345{,}678$ 且 $9{,}973 \\cdot 135 = 1{,}346{,}355  1{,}345{,}678$。\n\n接下来，计算 $\\left\\lfloor \\frac{L-1}{p} \\right\\rfloor$：\n$$\n\\left\\lfloor \\frac{1{,}234{,}566}{9{,}973} \\right\\rfloor = 123,\n$$\n因为 $9{,}973 \\cdot 123 = 1{,}226{,}679 \\leq 1{,}234{,}566$ 且 $9{,}973 \\cdot 124 = 1{,}236{,}652  1{,}234{,}566$。\n\n因此，被标记位置的确切数量是\n$$\n\\left\\lfloor \\frac{R}{p} \\right\\rfloor - \\left\\lfloor \\frac{L-1}{p} \\right\\rfloor = 134 - 123 = 11.\n$$\n等价地，我们可以计算 $a = p \\cdot \\left\\lceil \\frac{L}{p} \\right\\rceil = 9{,}973 \\cdot 124 = 1{,}236{,}652$，然后\n$$\n\\left\\lfloor \\frac{R-a}{p} \\right\\rfloor + 1\n= \\left\\lfloor \\frac{1{,}345{,}678 - 1{,}236{,}652}{9{,}973} \\right\\rfloor + 1\n= \\left\\lfloor \\frac{109{,}026}{9{,}973} \\right\\rfloor + 1\n= \\left\\lfloor 10.935\\ldots \\right\\rfloor + 1\n= 10 + 1\n= 11,\n$$\n这个结果与端点计算的结果相匹配，并验证了我们推导的公式。", "answer": "$$\\boxed{11}$$", "id": "3093465"}, {"introduction": "初学筛法时一个常见的问题是，为什么像 $30$ 这样的数被多个素数（如 $2, 3, 5$）重复标记并不会导致错误。本练习将正面回答这个问题，证明该算法的稳健性。在此基础上，练习将进一步要求您量化这些标记的最大“冗余度”，这有助于我们深入理解筛法的计算工作量。[@problem_id:3093460]", "problem": "考虑经典的埃拉托斯特尼筛法（Sieve of Eratosthenes）过程，该过程用于枚举所有小于等于一个固定界限 $N \\in \\mathbb{N}$ 的素数：初始化一个由整数 $2$ 到 $N$ 索引的数组，所有条目都未标记。对于从 $2$ 到 $\\lfloor \\sqrt{N} \\rfloor$ 的每个整数 $p$，如果 $p$ 的条目未被标记（因此在此阶段 $p$ 被视作素数），则标记 $p$ 的所有从 $p^2$ 开始、步长为 $p$ 的倍数（即，标记 $p^{2}, p^{2} + p, p^{2} + 2p, \\dots$ 直到 $N$）。最后，未被标记的条目被声明为素数。\n\n仅使用算术基本定理（FTA）和整除性的基本性质，完成以下任务：\n- 给出一个严谨的论证，说明在此筛法中，如果某个合数 $n \\leq N$ 因为是几个不同素数的倍数而被标记了多次，那么这种重复标记不会对筛法输出的正确性产生不利影响（即，未标记数的集合等于小于等于 $N$ 的素数集合）。\n- 量化此筛法中每个整数被标记的最坏情况下的次数。具体来说，定义 $M(N)$ 为在所有 $n \\leq N$ 中，使得 $n$ 在素数 $q$ 的标记轮次中被标记的、不同素数 $q$ 的数量的最大值。确定 $M(N)$ 的一个精确的闭式表达式，该表达式是关于 $N$ 和素数序列 $\\{p_{i}\\}_{i \\geq 1}$ 的函数，其中 $p_{i}$ 表示第 $i$ 个素数。\n\n你的最终答案必须是 $M(N)$ 的一个单一闭式解析表达式。不需要进行数值舍入。", "solution": "问题陈述经解析和验证，是自洽的、有数论科学依据且定义明确的。问题包括两部分：关于埃拉托斯特尼筛法正确性的证明，以及最坏情况下标记次数表达式的推导。\n\n**第一部分：正确性的严谨论证**\n\n目标是证明在埃拉托斯特尼筛法过程结束时，未标记数的集合恰好是小于等于 $N$ 的素数集合。这需要证明两个论断：\n1. 每个小于等于 $N$ 的素数 $p$ 都保持未标记状态。\n2. 每个小于等于 $N$ 的合数 $n$ 都被标记。\n\n**论断1：素数保持未标记**\n设 $p$ 是一个满足 $p \\leq N$ 的素数。要使 $p$ 被标记，它必须是某个素数 $q$ 的倍数，而筛法会对这个 $q$ 执行标记轮次。用于标记的素数 $q$ 满足 $q \\le \\lfloor \\sqrt{N} \\rfloor$。\n\n情况1：$p  \\lfloor \\sqrt{N} \\rfloor$。\n如果 $p$ 要被标记，它必须是某个素数 $q \\le \\lfloor \\sqrt{N} \\rfloor$ 的倍数。由于 $p$ 是素数，这将意味着 $p=q$。然而，这与我们的假设 $p  \\lfloor \\sqrt{N} \\rfloor$ 相矛盾。因此，$p$ 不可能是任何素数 $q \\le \\lfloor \\sqrt{N} \\rfloor$ 的倍数，所以不会被标记。\n\n情况2：$p \\le \\lfloor \\sqrt{N} \\rfloor$。\n在这种情况下，$p$ 本身就是执行标记轮次的素数之一。算法规定，对于一个素数 $p$，我们从 $p^2$ 开始标记它的倍数。被标记的数是 $p^2, p^2+p, p^2+2p, \\dots$。由于对于任何素数 $p \\ge 2$ 都有 $p  p^2$，数字 $p$ 本身不在要标记的数字列表中。此外，$p$ 也不能被任何其他素数 $q  p$ 标记，因为 $p$ 是素数，因此不是 $q$ 的倍数。所以，$p$ 将保持未标记状态。\n\n综合这两种情况，没有任何素数 $p \\leq N$ 会被埃拉托斯特尼筛法标记。\n\n**论断2：合数被标记**\n设 $n$ 是一个满足 $2 \\le n \\le N$ 的合数。根据算术基本定理（FTA），$n$ 可以写成素数的乘积。设 $p$ 是 $n$ 的最小素因子。我们可以将 $n$ 写成 $n = p \\cdot k$，其中 $k$ 是某个整数。由于 $p$ 是 $n$ 的最小素因子，$k$ 的任何素因子都必须大于或等于 $p$。这意味着 $k \\ge p$。\n\n从 $n = pk$ 和 $k \\ge p$，我们推导出 $n \\ge p^2$，这又意味着 $p \\le \\sqrt{n}$。由于 $n \\le N$，我们有 $\\sqrt{n} \\le \\sqrt{N}$，因此 $p \\le \\sqrt{N}$。因为 $p$ 是一个整数，这意味着 $p \\le \\lfloor \\sqrt{N} \\rfloor$。\n\n这表明任何合数 $n \\le N$ 的最小素因子 $p$ 都包含在用于标记的素数集合中。算法会为 $p$ 执行一个标记轮次。在这个轮次中，从 $p^2$ 开始标记 $p$ 的倍数。由于 $n$ 是 $p$ 的倍数，并且我们已经证明了 $n \\ge p^2$，因此 $n$ 肯定在为 $p$ 进行标记的轮次中被标记的数字序列 $p^2, p^2+p, \\dots$ 中。\n\n因此，每个合数 $n \\le N$ 至少被标记一次。\n\n**重复标记的影响**\n筛法中每个数的状态是二元的：未标记或已标记。标记操作是幂等的；标记一个已经标记过的数字不会改变其状态。我们的论证已经表明，所有合数最终都将处于“已标记”状态至少一次，而所有素数将始终保持“未标记”状态。一个合数（例如，$12$，它被 $2$ 和 $3$ 同时标记）在多个标记轮次中被处理这一事实，与最终结果无关。最终未标记数的集合将正确地是小于等于 $N$ 的素数集合。\n\n**第二部分：最坏情况下的标记次数，$M(N)$**\n\n我们被要求求出 $M(N)$，即任何整数 $n \\le N$ 被标记的最大次数。一个整数 $n$ 在筛法过程中被素数 $q$ 标记，当且仅当满足三个条件：\n1. $q$ 是一个素数，且 $q \\le \\lfloor \\sqrt{N} \\rfloor$。\n2. $q$ 是 $n$ 的一个因子（即，$q | n$）。\n3. $n$ 是从 $q^2$ 开始的 $q$ 的倍数，这意味着 $n \\ge q^2$。\n\n设 $m$ 是给定 $n \\le N$ 的标记次数。设标记 $n$ 的不同素数为 $\\{q_1, q_2, \\dots, q_m\\}$。为了最大化 $m$，我们需要找到一个整数 $n \\le N$，它能被尽可能多的不同素数整除，且每个素数都满足标记条件。\n\n为了使一个不超过 $N$ 的数的素因子数量最大化，我们应该用最小的素数来构造这个数。因此，我们尝试构造一个被前 $m$ 个素数 $\\{p_1, p_2, \\dots, p_m\\}$ 标记的数 $n$。\n对于某个整数 $m$，要存在这样一个 $n$，它必须满足以下条件：\na) $n \\le N$。\nb) $n$ 必须能被 $p_1, \\dots, p_m$ 中的每一个整除。满足此条件的最小正整数是它们的乘积，即素数阶乘 $P_m = \\prod_{i=1}^m p_i$。所以，$n$ 必须是 $P_m$ 的倍数。\nc) 为了使这个集合中的每个 $p_i$ 都能标记 $n$，必须有 $n \\ge p_i^2$。这对最大的素数 $p_m$ 的约束最强。所以，我们要求 $n \\ge p_m^2$。\nd) 为了使每个 $p_i$ 成为对 $N$ 进行筛分时的标记素数，我们必须有 $p_i \\le \\lfloor \\sqrt{N} \\rfloor$。这等价于 $p_m \\le \\lfloor \\sqrt{N} \\rfloor$。\n\n综合这些条件，对于一个给定的 $m$，一个被前 $m$ 个素数标记 $m$ 次的数能够存在，当且仅当存在一个整数 $n \\le N$，它是 $P_m$ 的倍数且满足 $n \\ge p_m^2$。让我们找出满足条件的最小整数 $n_m^*$，并检查它是否小于或等于 $N$。\n$P_m$ 的倍数是 $P_m, 2P_m, 3P_m, \\dots$。大于或等于 $p_m^2$ 的 $P_m$ 的最小倍数由 $n_m^* = k \\cdot P_m$ 给出，其中 $k = \\lceil \\frac{p_m^2}{P_m} \\rceil$。所以，$n_m^* = \\left\\lceil \\frac{p_m^2}{\\prod_{i=1}^m p_i} \\right\\rceil \\left(\\prod_{i=1}^m p_i\\right)$。\n\n当且仅当 $n_m^* \\le N$ 时，（被前 $m$ 个素数）标记 $m$ 次的次数是可实现的。如果我们能找到这样一个 $n_m^* \\le N$，那么条件 $p_m \\le \\lfloor \\sqrt{N} \\rfloor$ 就自动满足了，因为 $p_m^2 \\le n_m^* \\le N$ 意味着 $p_m \\le \\sqrt{N}$。\n\n因此，$M(N)$ 就是使这个条件成立的最大整数 $m$。任何其他 $m$ 个素数的选择都会导致更大的乘积和更大的 $n^*$ 值，使其小于等于 $N$ 的可能性更小。因此，我们不需要考虑除前 $m$ 个素数之外的任何标记素数组合。\n\n最大标记次数 $M(N)$ 是满足以下不等式的最大整数 $m$：\n$$ \\left\\lceil \\frac{p_m^2}{\\prod_{i=1}^m p_i} \\right\\rceil \\left(\\prod_{i=1}^m p_i\\right) \\le N $$\n这可以表示为：\n$$ M(N) = \\max\\left\\{m \\in \\mathbb{N} \\mid \\left\\lceil \\frac{p_m^2}{\\prod_{i=1}^m p_i} \\right\\rceil \\left(\\prod_{i=1}^m p_i\\right) \\le N\\right\\} $$\n其中 $\\mathbb{N}$ 是自然数集合 $\\{1, 2, 3, \\dots\\}$，如果该集合为空（例如，对于 $N  4$），则最大值取为 $0$。该表达式是 $M(N)$ 作为 $N$ 和素数序列 $\\{p_i\\}$ 的函数的精确闭式定义。\n对于 $m=1$，其值为 $\\lceil \\frac{2^2}{2} \\rceil \\cdot 2 = 4$。对于 $m=2$，其值为 $\\lceil \\frac{3^2}{6} \\rceil \\cdot 6 = 12$。对于 $m \\ge 3$，可以证明 $\\prod_{i=1}^m p_i > p_m^2$，所以向上取整项为 $1$，条件简化为 $\\prod_{i=1}^m p_i \\le N$。\n该通用表达式对所有 $m \\ge 1$ 均有效。", "answer": "$$\\boxed{\\max\\left\\{m \\in \\mathbb{N} \\mid \\left\\lceil \\frac{p_m^2}{\\prod_{i=1}^m p_i} \\right\\rceil \\left(\\prod_{i=1}^m p_i\\right) \\le N\\right\\}}$$", "id": "3093460"}, {"introduction": "标准的筛法算法为其筛选素数设定了一个特定的上界：$\\lfloor \\sqrt{n} \\rfloor$。为什么恰好是这个值？本练习通过探讨如果我们提前一步停止筛选（即上界为 $\\lfloor \\sqrt{n} \\rfloor - 1$）会发生什么，来提供一个深刻的教训。您将发现，对算法参数的微小改动可能导致其完全失效，从而理解为何经典的上界对于保证算法的正确性是必不可少的。[@problem_id:3093455]", "problem": "考虑埃拉托斯特尼筛法的一个变体。给定一个整数上界 $n \\geq 2$，初始化一个以整数 $2,3,\\dots,n$ 为索引的布尔数组，其所有元素均为“潜在素数”。对于每个当前为“潜在素数”且满足 $2 \\leq p \\leq B(n)$ 的整数 $p$，将所有形如 $p^{2}, p^{2}+p, p^{2}+2p, \\dots$（且不超过 $n$）的整数标记为“合数”。最后，将所有仍然是“潜在素数”的整数声明为“素数”。在经典的筛法中，我们取 $B(n)=\\lfloor \\sqrt{n} \\rfloor$。在此处考虑的变体中，筛法过早地停止于\n$$\nB(n)=\\lfloor \\sqrt{n} \\rfloor - 1.\n$$\n你的任务是：\n- 构建一个明确的反例 $n$，证明这种提前停止会导致筛法将一个合数错误地分类为素数，并确定最小的此类 $n$。\n- 推导出现这种失效时 $n$ 必须满足的充分必要条件，并将此条件压缩成一个单一的解析表达式 $f(n)$，当使用 $B(n)=\\lfloor \\sqrt{n} \\rfloor - 1$ 的筛法发生失效时 $f(n)$ 等于 $1$，否则等于 $0$。\n\n你可以使用以下关于整除性的基本事实：\n- 如果一个整数 $m \\geq 2$ 是合数，那么它有一个素数因子 $p$ 满足 $p \\leq \\sqrt{m}$。\n- 在埃拉托斯特尼筛法中，当以 $B(n)=\\lfloor \\sqrt{n} \\rfloor$ 正确实现时，每个合数 $m \\leq n$ 都会在其最小素因子的对应步骤中被标记。\n\n定义素数集合的特征函数为\n$$\n\\chi_{\\mathbb{P}}(k)=\\begin{cases}\n1  \\text{如果 $k$ 是素数},\\\\\n0  \\text{如果 $k$ 是合数或 $k  2$}.\n\\end{cases}\n$$\n将你的最终答案表示为一个包含两个条目的行矩阵：第一个条目是出现失效的最小整数 $n$，第二个条目是关于 $n$ 的封闭形式解析表达式 $f(n)$。不需要四舍五入，也不涉及单位。", "solution": "该问题描述了用于寻找直至整数 $n \\geq 2$ 的所有素数的埃拉托斯特尼筛法的一个变体。该过程涉及标记“潜在素数”的倍数。此变体的关键特征是筛分过程提前停止。在经典的筛法中，我们会标记直至 $\\lfloor \\sqrt{n} \\rfloor$ 的素数的倍数。在此变体中，我们只标记在范围 $2 \\leq p \\leq B(n)$ 内的“潜在素数” $p$ 的倍数，其中上界为 $B(n) = \\lfloor \\sqrt{n} \\rfloor - 1$。如果一个合数 $m \\leq n$ 未被标记为“合数”，从而被错误地分类为“素数”，则算法发生失效。\n\n让我们建立这种失效的充分必要条件。设 $k = \\lfloor \\sqrt{n} \\rfloor$。用于筛分的整数集合是满足 $2 \\leq p \\leq k-1$ 的“潜在素数” $p$。在筛分过程中顺序使用的、小于或等于 $k-1$ 的“潜在素数”实际上就是素数。任何合数 $c \\le k-1$ 都会有一个素因子 $p' \\le \\sqrt{c} \\le \\sqrt{k-1}  \\sqrt{\\sqrt{n}-1}$，并且已经被一个更小的素数标记为合数。因此，用于筛分的数字集合正是满足 $p \\leq k-1$ 的素数集合。\n\n如果一个合数 $m \\leq n$ 是这些筛分素数中至少一个的倍数，那么它就会被正确标记（“筛除”）。反之，一个合数 $m$ 被遗漏（错误地分类为素数）当且仅当它的所有素因子都严格大于 $k-1$。设 $p_{lpf}(m)$ 表示 $m$ 的最小素因子。$m$ 被遗漏的条件是 $p_{lpf}(m)  k-1$。由于 $p_{lpf}(m)$ 必须是一个素数，这等价于条件 $p_{lpf}(m) \\geq k$。\n\n因此，对于给定的 $n$，算法失效当且仅当存在一个合数 $m$ 满足 $m \\leq n$，且其最小素因子 $p_{lpf}(m)$ 满足 $p_{lpf}(m) \\geq k = \\lfloor \\sqrt{n} \\rfloor$。\n\n让我们找出可能被遗漏的最小合数。如果存在这样一个合数 $m$，它的最小素因子 $p=p_{lpf}(m)$ 必须满足 $p \\geq k$。$m$ 的任何其他素因子 $q$ 也必须满足 $q \\geq p \\geq k$。满足此条件的最小合数将由满足此条件的最小可能素因子的乘积构成。设 $p_k$ 是满足 $p_k \\geq k$ 的最小素数。满足 $p_{lpf}(m) \\geq k$ 的最小合数是 $m_{min} = p_k^2$。\n\n因此，筛法失效当且仅当这个可能被遗漏的最小候选合数 $m_{min} = p_k^2$ 在指定范围内，即 $p_k^2 \\leq n$。所以，失效的条件是：\n$$\n(\\min\\{p \\in \\mathbb{P} \\mid p \\geq \\lfloor \\sqrt{n} \\rfloor\\})^2 \\leq n\n$$\n其中 $\\mathbb{P}$ 是素数集合。\n\n让我们通过考虑 $k = \\lfloor \\sqrt{n} \\rfloor$ 的两种情况来分析这个条件。\n情况1：$k$ 是一个素数。\n在这种情况下，大于或等于 $k$ 的最小素数 $p_k$ 是 $k$ 本身。所以，$p_k=k$。失效条件变为 $k^2 \\leq n$。根据向下取整函数的定义，$k = \\lfloor \\sqrt{n} \\rfloor$ 意味着 $k \\leq \\sqrt{n}$，两边平方得到 $k^2 \\leq n$。因此，当 $k = \\lfloor \\sqrt{n} \\rfloor$ 是素数时，该条件总是满足的。\n\n情况2：$k$ 是一个合数。\n在这种情况下，大于或等于 $k$ 的最小素数 $p_k$ 必须严格大于 $k$，所以 $p_k \\geq k+1$。失效条件要求 $p_k^2 \\leq n$。然而，根据向下取整函数的定义，$k = \\lfloor \\sqrt{n} \\rfloor$ 意味着 $\\sqrt{n}  k+1$，两边平方得到 $n  (k+1)^2$。结合这些不等式，我们有 $n  (k+1)^2 \\leq p_k^2$。这意味着 $n  p_k^2$，所以当 $k = \\lfloor \\sqrt{n} \\rfloor$ 是合数时，失效条件 $p_k^2 \\leq n$ 永远无法满足。\n\n从这两种情况，我们推断出算法失效当且仅当 $k = \\lfloor \\sqrt{n} \\rfloor$ 是一个素数。\n\n这就建立了充分必要条件。现在我们可以解决具体的任务。\n\n任务1：找到出现失效的最小整数 $n \\geq 2$。\n我们寻找最小的 $n \\geq 2$ 使得 $\\lfloor \\sqrt{n} \\rfloor$ 是一个素数。\n- 对于 $n=2, 3$：$\\lfloor \\sqrt{2} \\rfloor = 1$，$\\lfloor \\sqrt{3} \\rfloor = 1$。数字 $1$ 不是素数。没有失效。\n- 对于 $n=4$：$\\lfloor \\sqrt{4} \\rfloor = 2$。数字 $2$ 是素数。因此，发生失效。让我们验证一下：对于 $n=4$，$B(4) = \\lfloor \\sqrt{4} \\rfloor - 1 = 2-1 = 1$。筛分循环 `for p from 2 to 1` 不会执行。从 $2$ 到 $4$ 的所有数字都被声明为“素数”。这对于合数 $4$ 是不正确的。\n由于 $n=2$ 或 $n=3$ 时不会发生失效，所以筛法失效的最小整数 $n$ 是 $n=4$。\n\n任务2：推导充分必要条件并将其表示为函数 $f(n)$。\n如上所述，失效发生当且仅当 $\\lfloor \\sqrt{n} \\rfloor$ 是一个素数。我们被要求将此条件表示为一个解析函数 $f(n)$，当失效发生时其值为 $1$，否则为 $0$。问题定义了素数的特征函数：\n$$\n\\chi_{\\mathbb{P}}(j)=\\begin{cases}\n1  \\text{如果 } j \\text{ 是素数},\\\\\n0  \\text{如果 } j \\text{ 是合数或 } j  2.\n\\end{cases}\n$$\n如果其参数是素数，该函数的值为 $1$，否则为 $0$（对于整数 $\\ge 2$）。失效的条件是整数 $j = \\lfloor \\sqrt{n} \\rfloor$ 是素数。这可以通过将函数 $\\chi_{\\mathbb{P}}$ 应用于 $j$ 来直接捕捉。\n因此，函数 $f(n)$ 是：\n$$\nf(n) = \\chi_{\\mathbb{P}}(\\lfloor \\sqrt{n} \\rfloor)\n$$\n如果 $\\lfloor \\sqrt{n} \\rfloor$ 是一个素数（失效的条件），该函数等于 $1$，否则等于 $0$。\n\n最终答案包括出现失效的最小整数 $n$ 和 $f(n)$ 的表达式。\n最小的 $n$：$4$。\n函数 $f(n)$：$\\chi_{\\mathbb{P}}(\\lfloor \\sqrt{n} \\rfloor)$。\n我们按照要求将它们呈现在一个行矩阵中。", "answer": "$$\\boxed{\\begin{pmatrix} 4  \\chi_{\\mathbb{P}}(\\lfloor \\sqrt{n} \\rfloor) \\end{pmatrix}}$$", "id": "3093455"}]}