{"hands_on_practices": [{"introduction": "要真正领会重复平方法的威力，我们需要深入其内部一探究竟。这项练习的目的并非计算模幂的最终结果，而是理解驱动其高效运作的“引擎”。通过分析一个大指数的二进制表示，你将能精确计算出所需的运算次数，从而对该算法的卓越效率有一个具体而深刻的认识。[@problem_id:3087339]", "problem": "设 $e = 10^{6}$ 为模幂问题 $a^{e} \\pmod n$ 中的指数，其中 $a$ 和 $n$ 是满足 $n \\geq 2$ 和 $a \\geq 1$ 的固定整数。\n\n首先，计算 $e$ 的二进制展开，即，将 $e$ 唯一地写成 $e = \\sum_{i=0}^{t-1} b_{i} 2^{i}$ 的形式，其中 $b_{i} \\in \\{0,1\\}$ 且 $b_{t-1} = 1$。然后，考虑标准的从左到右平方-乘法模幂算法，其定义如下：初始化 $r \\leftarrow a$，然后从次高有效位到最低有效位扫描 $e$ 的剩余比特；在每一步，将 $r$ 替换为 $r^{2} \\pmod n$，如果当前比特为 $1$，则额外将 $r$ 替换为 $r \\cdot a \\pmod n$。\n\n假设成本模型中，每次模平方和每次与 $a$ 的模乘都计为一次模乘法。使用 $e$ 的二进制展开，确定用此方法计算 $a^{e} \\pmod n$ 所需的模乘法总次数。将最终答案表示为一个整数。不要计算 $a^{e} \\pmod n$ 本身。", "solution": "该问题是有效的，因为它在科学上基于计算数论，提法明确，具有清晰的算法描述和成本模型，并且陈述客观。\n\n该问题要求我们对于指数 $e = 10^{6}$，使用一个特定版本的从左到右平方-乘法算法，来确定计算 $a^{e} \\pmod n$ 所需的模乘法总次数。成本模型将每次模平方和每次与 $a$ 的模乘都计为一次模乘法。\n\n首先，让我们分析给定的算法及其相关成本。指数 $e$ 有一个唯一的二进制展开 $e = \\sum_{i=0}^{t-1} b_{i} 2^{i}$，其中 $b_{i} \\in \\{0,1\\}$ 且最高有效位是 $b_{t-1} = 1$。此表示中的比特数是 $t$。该数由 $t = \\lfloor \\log_{2}(e) \\rfloor + 1$ 给出。\n\n算法定义如下：\n1. 初始化 $r \\leftarrow a$。此步骤对应于最高有效位 $b_{t-1}=1$，根据问题描述，这是一个不产生开销的初始化。\n2. 从次高有效位到最低有效位扫描 $e$ 的剩余比特。这些比特是 $b_{t-2}, b_{t-3}, \\dots, b_0$。这些比特的数量是 $(t-2) - 0 + 1 = t-1$。\n3. 在每一步中，执行一次模平方：$r$ 被替换为 $r^{2} \\pmod n$。因为循环中有 $t-1$ 步（从 $b_{t-2}$ 到 $b_0$ 的每个比特对应一步），所以模平方的总次数是 $t-1$。\n4. 在每一步中，如果当前比特为 $1$，则执行一次额外的模乘法：$r$ 被替换为 $r \\cdot a \\pmod n$。这些额外乘法的次数等于 $b_{t-2}, b_{t-3}, \\dots, b_0$ 中置位比特（等于 $1$ 的比特）的数量。\n\n设 $H(e)$ 表示 $e$ 的汉明权重，即其二进制展开中等于 $1$ 的比特总数。因为我们知道 $b_{t-1}=1$，所以展开式剩余部分（$b_{t-2}, \\dots, b_0$）的置位比特数是 $H(e)-1$。\n\n模乘法的总次数，记为 $C$，是平方次数与和 $a$ 的额外乘法次数之和。\n平方次数 = $t-1 = (\\lfloor \\log_{2}(e) \\rfloor + 1) - 1 = \\lfloor \\log_{2}(e) \\rfloor$。\n与 $a$ 的乘法次数 = $H(e)-1$。\n因此，总成本为 $C = (\\lfloor \\log_{2}(e) \\rfloor) + (H(e)-1)$。\n\n给定指数 $e = 10^{6}$。为了求出成本 $C$，我们需要计算 $\\lfloor \\log_{2}(10^{6}) \\rfloor$ 和 $H(10^{6})$。\n\n首先，我们来计算 $\\lfloor \\log_{2}(10^{6}) \\rfloor$:\n$\\log_{2}(10^{6}) = 6 \\log_{2}(10)$。我们知道 $2^{3} = 8$ 且 $2^{4} = 16$，所以 $3  \\log_{2}(10)  4$。因此，$6 \\times 3  6 \\log_{2}(10)  6 \\times 4$，这意味着 $18  \\log_{2}(10^{6})  24$。\n为了更精确地计算：\n$2^{19} = 524288$\n$2^{20} = 1048576$\n因为 $2^{19}  10^{6}  2^{20}$，所以 $19  \\log_{2}(10^{6})  20$。\n因此，向下取整为 $\\lfloor \\log_{2}(10^{6}) \\rfloor = 19$。\n这意味着 $e=10^6$ 的二进制表示有 $t = 19+1 = 20$ 位。平方次数为 $t-1 = 19$。\n\n接下来，我们需要找到 $e=10^{6}$ 的二进制表示以确定其汉明权重 $H(10^{6})$。我们可以通过重复除以 2 来做到这一点：\n$1000000 = 2 \\times 500000 + 0$\n$500000 = 2 \\times 250000 + 0$\n$250000 = 2 \\times 125000 + 0$\n$125000 = 2 \\times 62500 + 0$\n$62500 = 2 \\times 31250 + 0$\n$31250 = 2 \\times 15625 + 0$\n$15625 = 2 \\times 7812 + 1$\n$7812 = 2 \\times 3906 + 0$\n$3906 = 2 \\times 1953 + 0$\n$1953 = 2 \\times 976 + 1$\n$976 = 2 \\times 488 + 0$\n$488 = 2 \\times 244 + 0$\n$244 = 2 \\times 122 + 0$\n$122 = 2 \\times 61 + 0$\n$61 = 2 \\times 30 + 1$\n$30 = 2 \\times 15 + 0$\n$15 = 2 \\times 7 + 1$\n$7 = 2 \\times 3 + 1$\n$3 = 2 \\times 1 + 1$\n$1 = 2 \\times 0 + 1$\n从下往上读取余数，$10^{6}$ 的二进制表示是：\n$e = (11110100001001000000)_2$。\n这是一个 20 位的数，这与我们计算出的 $t=20$ 一致。\n汉明权重 $H(10^{6})$ 是此表示中 1 的数量：\n$H(10^{6}) = 1+1+1+1+1+1+1 = 7$。\n\n现在我们可以用我们的公式计算模乘法总次数：\n$C = (\\lfloor \\log_{2}(10^{6}) \\rfloor) + (H(10^{6})-1)$。\n$C = 19 + (7 - 1) = 19 + 6 = 25$。\n\n所需的模乘法总次数是 $19$ 次平方和 $6$ 次与 $a$ 的乘法之和。总共为 $25$ 次运算。", "answer": "$$\n\\boxed{25}\n$$", "id": "3087339"}, {"introduction": "一个强大的算法是个好工具，但敏锐的数学头脑更懂得何时可以另辟蹊径。这项练习将挑战你在投入计算前，先洞察问题中的结构性规律。通过考察底数在模 $n$ 下与 $1$ 或 $-1$ 同余的特殊情况，你将发现能够以极小代价解决看似复杂问题的捷径，从而体会到模式识别在数论中的重要性。[@problem_id:3087411]", "problem": "考虑整数 $a$、$e$ 和 $n$，其中 $n \\geq 2$。从模 $n$ 同余的定义和重复平方的模幂运算算法出发，分析在 $a \\equiv 1 \\pmod{n}$ 和 $a \\equiv -1 \\pmod{n}$ 这两种特殊情况下 $a^{e} \\bmod n$ 的结构。在每种情况下，推导出区分偶数和奇数指数 $e$ 结果的闭式模式，并使用重复平方作为计算框架，而非任何特设的捷径。\n\n然后，应用这些结论，使用 $n = 2026$ 计算以下大的模表达式：\n$$\n(n - 1)^{\\,3^{100} + 2^{300} + 7} \\cdot (n + 1)^{\\,5^{120} - 1} \\pmod n.\n$$\n将最终答案表示为模 $n$ 的最小非负余数。不需要四舍五入。", "solution": "基础是同余的定义和重复平方模幂运算的结构。我们将使用两个经过充分检验的事实：\n1. 如果 $x \\equiv y \\pmod{n}$，那么对于任何整数 $k \\geq 1$，都有 $x^{k} \\equiv y^{k} \\pmod{n}$。\n2. 重复平方算法通过将 $e$ 写成二进制形式 $e = \\sum_{j=0}^{m} b_{j} 2^{j}$（其中 $b_{j} \\in \\{0,1\\}$）来计算 $a^{e} \\pmod n$，然后构成\n$$\na^{e} \\equiv \\prod_{j=0}^{m} \\left(a^{2^{j}}\\right)^{b_{j}} \\pmod{n},\n$$\n其中每个 $a^{2^{j}} \\bmod n$ 是通过模 $n$ 的连续平方得到的。\n\n我们首先分析特殊底数 $a \\equiv 1 \\pmod{n}$ 和 $a \\equiv -1 \\pmod{n}$。\n\n情况1：$a \\equiv 1 \\pmod{n}$。根据第一个事实，\n$$\na^{e} \\equiv 1^{e} \\equiv 1 \\pmod{n}\n$$\n对于每个整数 $e \\geq 1$。在重复平方下，$a^{2^{j}} \\equiv 1$ 对所有 $j$ 成立，所以无论 $e$ 的比特 $b_{j}$ 是什么，所选因子的乘积都是 $1$。因此，闭式模式是 $a^{e} \\equiv 1 \\pmod{n}$ 对所有 $e$ 成立。\n\n情况2：$a \\equiv -1 \\pmod{n}$。使用重复平方结构，计算\n$$\na^{2} \\equiv (-1)^{2} \\equiv 1 \\pmod{n}, \\quad a^{4} \\equiv \\left(a^{2}\\right)^{2} \\equiv 1^{2} \\equiv 1 \\pmod{n},\n$$\n并且通过归纳法，对所有 $j \\geq 1$，$a^{2^{j}} \\equiv 1 \\pmod{n}$，而 $a^{2^{0}} = a \\equiv -1 \\pmod{n}$。因此，对于 $e = \\sum_{j=0}^{m} b_{j} 2^{j}$，\n$$\na^{e} \\equiv \\prod_{j=0}^{m} \\left(a^{2^{j}}\\right)^{b_{j}} \\equiv \\left((-1)^{1}\\right)^{b_{0}} \\cdot \\prod_{j=1}^{m} 1^{b_{j}} \\equiv (-1)^{b_{0}} \\pmod{n}.\n$$\n因为 $b_{0}$ 是 $e$ 的最低有效位，它编码了 $e$ 的奇偶性：如果 $e$ 是偶数，$b_{0} = 0$；如果 $e$ 是奇数，$b_{0} = 1$。因此闭式模式是\n$$\na^{e} \\equiv \\begin{cases}\n1 \\pmod{n},  \\text{如果 $e$ 是偶数},\\\\\n-1 \\pmod{n},  \\text{如果 $e$ 是奇数}.\n\\end{cases}\n$$\n等价地，$a^{e} \\equiv (-1)^{e} \\pmod{n}$。\n\n我们现在将这些结论应用于 $n = 2026$ 的特定表达式：\n$$\n(n - 1)^{\\,3^{100} + 2^{300} + 7} \\cdot (n + 1)^{\\,5^{120} - 1} \\pmod n \\quad \\text{其中} \\quad n = 2026.\n$$\n观察到 $n - 1 = 2025 \\equiv -1 \\pmod{2026}$ 并且 $n + 1 = 2027 \\equiv 1 \\pmod{2026}$。\n\n第一个因子：$(n - 1)^{\\,3^{100} + 2^{300} + 7} \\pmod n$，其底数同余于 $-1$。根据该模式，其值仅取决于指数 $E_{1} = 3^{100} + 2^{300} + 7$ 的奇偶性。确定 $E_{1} \\pmod 2$：\n- $3$ 是奇数，所以 $3^{100}$ 是奇数；因此 $3^{100} \\equiv 1 \\pmod{2}$。\n- $2$ 是偶数，所以 $2^{300}$ 是偶数；因此 $2^{300} \\equiv 0 \\pmod{2}$。\n- $7$ 是奇数；因此 $7 \\equiv 1 \\pmod{2}$。\n因此，\n$$\nE_{1} \\equiv 1 + 0 + 1 \\equiv 0 \\pmod{2},\n$$\n所以 $E_{1}$ 是偶数，且 $(n - 1)^{E_{1}} \\equiv 1 \\pmod{n}$。\n\n第二个因子：$(n + 1)^{\\,5^{120} - 1} \\pmod n$，其底数同余于 $1$。根据 $a \\equiv 1 \\pmod{n}$ 的模式，对于任何指数，这都模 $n$ 等于 $1$。具体来说，\n$$\n(n + 1)^{\\,5^{120} - 1} \\equiv 1 \\pmod{n}.\n$$\n\n结合两个因子，\n$$\n\\left[(n - 1)^{\\,3^{100} + 2^{300} + 7}\\right] \\cdot \\left[(n + 1)^{\\,5^{120} - 1}\\right] \\equiv 1 \\cdot 1 \\equiv 1 \\pmod{n}.\n$$\n因此，模 $n = 2026$ 的最小非负余数是 $1$。", "answer": "$$\\boxed{1}$$", "id": "3087411"}, {"introduction": "模幂运算常常与欧拉定理等强大工具结合使用以简化指数。然而，真正的专家不仅知道如何使用工具，更了解其失效的边界。这项关键练习将展示当欧拉定理的前提条件不满足时会发生什么，从而揭示一个普适算法和一个条件性捷径之间的区别。通过这个反例的演算，你将巩固对“为何检查 $\\gcd(a,n)=1$ 至关重要”这一点的理解。[@problem_id:3087438]", "problem": "设合数模 $n=45$，底数 $a=9$ 满足 $\\gcd(a,n)\\neq 1$，指数 $e=120$。使用快速幂（重复平方求幂）计算余数 $r\\equiv a^{e}\\pmod{n}$，过程中不得引用任何假定 $a$ 是模 $n$ 的单位元的定理。另外，计算 $\\varphi(n)$ 并构造约化指数 $e'\\equiv e\\pmod{\\varphi(n)}$，然后计算 $r'\\equiv a^{e'}\\pmod{n}$（同样使用快速幂）。报告整数差 $\\Delta=r-r'$ 作为你的最终答案。在你的解释中，从同余、欧拉函数 $\\varphi(n)$ 和模 $n$ 的乘法单位群的基本定义出发，论证为什么将指数 $e$ 对 $\\varphi(n)$ 取模的方法，其所依赖的假设在 $\\gcd(a,n)\\neq 1$ 的情况下不成立。", "solution": "该问题被认为是有效的，因为它内容自洽，有坚实的数论基础，且问题陈述清晰。我们开始解答。\n\n问题要求进行几项计算，并提供一个关于模幂运算的理论论证。我们系统地处理每个部分。\n\n首先，我们使用快速幂计算当 $a=9$, $e=120$, $n=45$ 时的 $r \\equiv a^e \\pmod{n}$。指数的二进制表示为 $e=120_{10} = 64 + 32 + 16 + 8 = 2^6 + 2^5 + 2^4 + 2^3$，即 $1111000_2$。我们需要计算 $a^{120} \\equiv a^{64} a^{32} a^{16} a^8 \\pmod{n}$。\n\n我们计算 $a=9$ 在模 $n=45$ 下的各次幂：\n$$9^1 \\equiv 9 \\pmod{45}$$\n$$9^2 = 81 \\equiv 36 \\pmod{45}$$\n$$9^4 = (9^2)^2 \\equiv 36^2 = 1296 \\pmod{45}$$\n为了计算 $1296 \\pmod{45}$，我们将 $1296$ 除以 $45$。$1296 = 28 \\times 45 + 36$。因此，\n$$9^4 \\equiv 36 \\pmod{45}$$\n我们观察到，一旦得到数值 $36$，重复对其平方并对 $45$ 取模将始终得到 $36$：\n$$36^2 \\equiv 36 \\pmod{45}$$\n因此，对于任何整数 $k \\ge 2$：\n$$9^{2^k} \\equiv 36 \\pmod{45}$$\n这适用于 $9^4, 9^8, 9^{16}, 9^{32}, 9^{64}$。\n$$9^8 \\equiv (9^4)^2 \\equiv 36^2 \\equiv 36 \\pmod{45}$$\n$$9^{16} \\equiv (9^8)^2 \\equiv 36^2 \\equiv 36 \\pmod{45}$$\n$$9^{32} \\equiv (9^{16})^2 \\equiv 36^2 \\equiv 36 \\pmod{45}$$\n$$9^{64} \\equiv (9^{32})^2 \\equiv 36^2 \\equiv 36 \\pmod{45}$$\n\n现在我们可以计算 $r$：\n$$r \\equiv 9^{120} \\pmod{45}$$\n$$r \\equiv 9^{64+32+16+8} \\pmod{45}$$\n$$r \\equiv 9^{64} \\cdot 9^{32} \\cdot 9^{16} \\cdot 9^8 \\pmod{45}$$\n$$r \\equiv 36 \\cdot 36 \\cdot 36 \\cdot 36 \\pmod{45}$$\n由于 $36 \\cdot 36 \\equiv 36 \\pmod{45}$，这可以简化为：\n$$r \\equiv (36 \\cdot 36) \\cdot (36 \\cdot 36) \\equiv 36 \\cdot 36 \\equiv 36 \\pmod{45}$$\n所以，正确的余数是 $r=36$。\n\n第二，我们计算 $n=45$ 的欧拉函数 $\\varphi(n)$。$n$ 的质因数分解是 $45 = 3^2 \\cdot 5^1$。欧拉函数对于互质的参数是积性的，所以：\n$$\\varphi(45) = \\varphi(3^2) \\cdot \\varphi(5)$$\n使用公式 $\\varphi(p^k) = p^k - p^{k-1}$：\n$$\\varphi(3^2) = 3^2 - 3^1 = 9 - 3 = 6$$\n$$\\varphi(5) = 5^1 - 5^0 = 5 - 1 = 4$$\n因此：\n$$\\varphi(45) = 6 \\cdot 4 = 24$$\n\n第三，我们计算约化指数 $e' \\equiv e \\pmod{\\varphi(n)}$。\n$$e' \\equiv 120 \\pmod{24}$$\n由于 $120 = 5 \\times 24 + 0$，我们有 $e' \\equiv 0 \\pmod{24}$。我们选择代表元 $e'=0$。\n\n第四，我们计算 $r' \\equiv a^{e'} \\pmod{n}$。\n$$r' \\equiv 9^0 \\pmod{45}$$\n根据定义，对于任何非零底数，有 $x^0=1$。因此：\n$$r' = 1$$\n\n第五，我们计算差值 $\\Delta = r - r'$。\n$$\\Delta = 36 - 1 = 35$$\n\n最后，我们从基本定义出发，论证为什么在这种情况下将指数 $e$ 对 $\\varphi(n)$ 取模是无效的。\n\n模 $n$ 同余关系，记作 $a \\equiv b \\pmod{n}$，表示 $n$ 整除差值 $a-b$。这个关系将整数集 $\\mathbb{Z}$ 划分为 $n$ 个等价类，构成模 $n$ 整数环，记作 $\\mathbb{Z}_n$ 或 $\\mathbb{Z}/n\\mathbb{Z}$。\n\n欧拉函数 $\\varphi(n)$ 计算小于或等于 $n$ 且与 $n$ 互质的正整数的个数。这些整数对应于 $\\mathbb{Z}_n$ 中满足 $\\gcd(a,n)=1$ 的等价类 $[a]_n$。\n\n这些特殊的等价类集合构成了模 $n$ 的乘法单位群，记作 $(\\mathbb{Z}/n\\mathbb{Z})^\\times$。一个元素 $[a]_n$ 之所以是“单位”，是因为它存在模 $n$ 的乘法逆元，这个性质当且仅当 $\\gcd(a,n)=1$ 时得到保证。这个群的阶（其元素个数）恰好是 $|\\left(\\mathbb{Z}/n\\mathbb{Z}\\right)^\\times| = \\varphi(n)$。\n\n欧拉定理是关于这个群的一个论断。它断言，对于任何满足 $\\gcd(a,n)=1$ 的整数 $a$，以下等式成立：\n$$a^{\\varphi(n)} \\equiv 1 \\pmod{n}$$\n这是群论中 Lagrange's theorem 的一个直接推论，该定理指出有限群中任何元素的阶都能整除群的阶。对于一个元素 $[a]_n \\in (\\mathbb{Z}/n\\mathbb{Z})^\\times$，它的阶必须能整除 $\\varphi(n)$，这意味着 $a^{\\varphi(n)} \\equiv 1 \\pmod n$。\n\n将指数 $e$ 对 $\\varphi(n)$ 取模的过程完全基于欧拉定理。如果我们希望计算 $a^e \\pmod n$，我们可以写出 $e = q\\varphi(n) + e'$，其中 $e' = e \\pmod{\\varphi(n)}$ 且 $q$ 是一个整数。计算过程如下：\n$$a^e = a^{q\\varphi(n) + e'} = (a^{\\varphi(n)})^q \\cdot a^{e'}$$\n如果 $\\gcd(a,n)=1$，那么 $a^{\\varphi(n)} \\equiv 1 \\pmod{n}$，我们可以将其代入方程中：\n$$a^e \\equiv 1^q \\cdot a^{e'} \\equiv a^{e'} \\pmod{n}$$\n这一代换是证明指数约化合理性的关键步骤。\n\n在给定的问题中，$a=9$ 且 $n=45$。我们计算最大公约数：\n$$\\gcd(9, 45) = 9$$\n由于 $\\gcd(9, 45) = 9 \\neq 1$，整数 $a=9$ 与模数 $n=45$ 不互质。因此，同余类 $[9]_{45}$ 不是乘法单位群 $(\\mathbb{Z}/45\\mathbb{Z})^\\times$ 的元素。欧拉定理不适用于这个底数 $a$。\n\n指数约化的前提条件 $a^{\\varphi(n)} \\equiv 1 \\pmod{n}$ 并不保证成立。事实上，我们可以证明它是错误的。我们已经计算出 $\\varphi(45)=24$。让我们计算 $9^{24} \\pmod{45}$：\n$$9^{24} = 9^{16+8} \\equiv 9^{16} \\cdot 9^8 \\pmod{45}$$\n根据我们之前的计算，$9^{16} \\equiv 36 \\pmod{45}$ 且 $9^8 \\equiv 36 \\pmod{45}$。\n$$9^{24} \\equiv 36 \\cdot 36 \\equiv 36 \\pmod{45}$$\n显然，$9^{24} \\not\\equiv 1 \\pmod{45}$。进行简化所需的基本假设不成立。因此，将指数 $e=120$ 对模 $\\varphi(45)=24$ 约化为 $e'=0$ 的过程在数学上是无效的。这就解释了为什么通过这种错误方法得到的结果 $r'=1$ 与通过直接计算得到的正确结果 $r=36$ 不同。", "answer": "$$\\boxed{35}$$", "id": "3087438"}]}