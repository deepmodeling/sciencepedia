{"hands_on_practices": [{"introduction": "本练习介绍了一个经典场景，其中总体方差是根据一个初始的随机选择来分解的。我们将分析一个过程（一次模拟的运行时间）的总变异性，该过程遵循两条不同路径中的一条，每条路径都有其固有的随机性。这个实践对于掌握全方差定律的两个基本组成部分至关重要：条件方差的期望值，以及条件期望值的方差。[@problem_id:1401027]", "problem": "一位数据科学家的计算机在运行一个复杂模拟时有两种模式：使用云资源的“快速”模式和仅使用机器自身处理器的“本地”模式。模式的选择是概率性的。设选择“快速”模式的概率为 $p$，其中 $0 < p < 1$。\n\n完成模拟所需的时间（以分钟为单位）是一个取决于所选模式的随机变量。\n- 如果选择“快速”模式，完成时间在区间 $[15, 20]$ 分钟上服从均匀分布。\n- 如果选择“本地”模式，完成时间在区间 $[20, 30]$ 分钟上服从均匀分布。\n\n设 $T$ 为表示完成模拟总时间的随机变量。确定完成时间的总方差 $\\mathrm{Var}(T)$，并将其表示为关于概率 $p$ 的解析表达式。", "solution": "设 $R$ 是一个表示所选模式的随机变量。令 $R=F$ 代表“快速”模式，$R=L$ 代表“本地”模式。我们已知的概率为 $P(R=F) = p$ 和 $P(R=L) = 1-p$。\n\n问题要求解模拟时间 $T$ 的总方差，这可以使用全方差公式（也称为夏娃定律，Eve's Law）来求解：\n$$ \\mathrm{Var}(T) = \\mathbb{E}[\\mathrm{Var}(T|R)] + \\mathrm{Var}(\\mathbb{E}[T|R]) $$\n\n我们将分别计算右侧的两项。\n\n首先，我们需要连续均匀分布 $U(a, b)$ 的均值和方差：\n均值：$\\mathbb{E}[U(a,b)] = \\frac{a+b}{2}$\n方差：$\\mathrm{Var}(U(a,b)) = \\frac{(b-a)^2}{12}$\n\n对于“快速”模式，时间 $T_F$ 服从 $U(15, 20)$ 分布。\n条件均值为 $\\mathbb{E}[T|R=F] = \\frac{15+20}{2} = \\frac{35}{2}$。\n条件方差为 $\\mathrm{Var}(T|R=F) = \\frac{(20-15)^2}{12} = \\frac{5^2}{12} = \\frac{25}{12}$。\n\n对于“本地”模式，时间 $T_L$ 服从 $U(20, 30)$ 分布。\n条件均值为 $\\mathbb{E}[T|R=L] = \\frac{20+30}{2} = \\frac{50}{2} = 25$。\n条件方差为 $\\mathrm{Var}(T|R=L) = \\frac{(30-20)^2}{12} = \\frac{10^2}{12} = \\frac{100}{12}$。\n\n**步骤1：计算 $\\mathbb{E}[\\mathrm{Var}(T|R)]$ (条件方差的均值)**\n\n随机变量 $\\mathrm{Var}(T|R)$ 以概率 $p$ 取值 $\\frac{25}{12}$，以概率 $1-p$ 取值 $\\frac{100}{12}$。其期望值为：\n$$ \\mathbb{E}[\\mathrm{Var}(T|R)] = \\mathrm{Var}(T|R=F)P(R=F) + \\mathrm{Var}(T|R=L)P(R=L) $$\n$$ \\mathbb{E}[\\mathrm{Var}(T|R)] = \\left(\\frac{25}{12}\\right)p + \\left(\\frac{100}{12}\\right)(1-p) $$\n$$ \\mathbb{E}[\\mathrm{Var}(T|R)] = \\frac{25p + 100 - 100p}{12} = \\frac{100 - 75p}{12} $$\n\n**步骤2：计算 $\\mathrm{Var}(\\mathbb{E}[T|R])$ (条件均值的方差)**\n\n随机变量 $\\mathbb{E}[T|R]$ 以概率 $p$ 取值 $\\frac{35}{2}$，以概率 $1-p$ 取值 $25$。\n为了求其方差，我们首先求其期望及期望的平方。\n\n$\\mathbb{E}[T|R]$ 的期望即为总期望 $\\mathbb{E}[T]$：\n$$ \\mathbb{E}[\\mathbb{E}[T|R]] = \\mathbb{E}[T|R=F]P(R=F) + \\mathbb{E}[T|R=L]P(R=L) $$\n$$ \\mathbb{E}[\\mathbb{E}[T|R]] = \\left(\\frac{35}{2}\\right)p + (25)(1-p) = \\frac{35}{2}p + 25 - 25p = 25 - \\frac{15}{2}p $$\n\n$(\\mathbb{E}[T|R])^2$ 的期望为：\n$$ \\mathbb{E}[(\\mathbb{E}[T|R])^2] = (\\mathbb{E}[T|R=F])^2 P(R=F) + (\\mathbb{E}[T|R=L])^2 P(R=L) $$\n$$ \\mathbb{E}[(\\mathbb{E}[T|R])^2] = \\left(\\frac{35}{2}\\right)^2 p + (25)^2 (1-p) $$\n$$ \\mathbb{E}[(\\mathbb{E}[T|R])^2] = \\frac{1225}{4}p + 625(1-p) = \\frac{1225p + 2500 - 2500p}{4} = \\frac{2500 - 1275p}{4} $$\n\n现在，使用方差公式 $\\mathrm{Var}(X) = \\mathbb{E}[X^2] - (\\mathbb{E}[X])^2$：\n$$ \\mathrm{Var}(\\mathbb{E}[T|R]) = \\mathbb{E}[(\\mathbb{E}[T|R])^2] - (\\mathbb{E}[\\mathbb{E}[T|R]])^2 $$\n$$ \\mathrm{Var}(\\mathbb{E}[T|R]) = \\left(\\frac{2500 - 1275p}{4}\\right) - \\left(25 - \\frac{15}{2}p\\right)^2 $$\n$$ \\mathrm{Var}(\\mathbb{E}[T|R]) = \\frac{2500 - 1275p}{4} - \\left(625 - 2 \\cdot 25 \\cdot \\frac{15}{2}p + \\left(\\frac{15}{2}p\\right)^2\\right) $$\n$$ \\mathrm{Var}(\\mathbb{E}[T|R]) = \\frac{2500 - 1275p}{4} - \\left(625 - 375p + \\frac{225}{4}p^2\\right) $$\n为了进行减法，我们将所有项通分，公分母为 4：\n$$ \\mathrm{Var}(\\mathbb{E}[T|R]) = \\frac{2500 - 1275p}{4} - \\frac{2500 - 1500p + 225p^2}{4} $$\n$$ \\mathrm{Var}(\\mathbb{E}[T|R]) = \\frac{(2500 - 1275p) - (2500 - 1500p + 225p^2)}{4} $$\n$$ \\mathrm{Var}(\\mathbb{E}[T|R]) = \\frac{2500 - 1275p - 2500 + 1500p - 225p^2}{4} = \\frac{225p - 225p^2}{4} $$\n\n**步骤3：合并两项**\n\n现在我们将步骤1和步骤2的结果相加，以求得总方差 $\\mathrm{Var}(T)$。\n$$ \\mathrm{Var}(T) = \\mathbb{E}[\\mathrm{Var}(T|R)] + \\mathrm{Var}(\\mathbb{E}[T|R]) $$\n$$ \\mathrm{Var}(T) = \\frac{100 - 75p}{12} + \\frac{225p - 225p^2}{4} $$\n为将这些分数相加，我们找到公分母，即 12。\n$$ \\mathrm{Var}(T) = \\frac{100 - 75p}{12} + \\frac{3(225p - 225p^2)}{12} $$\n$$ \\mathrm{Var}(T) = \\frac{100 - 75p + 675p - 675p^2}{12} $$\n$$ \\mathrm{Var}(T) = \\frac{-675p^2 + 600p + 100}{12} $$\n我们可以从分子中提取公因数 25：\n$$ \\mathrm{Var}(T) = \\frac{25(-27p^2 + 24p + 4)}{12} $$\n最后两个表达式都是有效的最终形式。我们将使用展开的多项式形式。", "answer": "$$\\boxed{\\frac{-675p^2 + 600p + 100}{12}}$$", "id": "1401027"}, {"introduction": "超越离散选择，本问题探索了一个更高级、也更常见的情景，即模型的参数本身就是一个随机变量。当根本的次品率每天变化时，我们将计算次品数量的方差。这个练习展示了如何将全方差定律应用于连续条件变量，这是贝叶斯统计和质量控制等领域的关键技术。[@problem_id:1929483]", "problem": "在一家半导体制造厂，一种新的制造工艺正在进行测试。由于环境条件（如温度和湿度）存在不可预测的日常变化，任何给定微芯片有缺陷的概率 $\\Theta$ 不是一个固定的常数。相反，它被视为一个随机变量。根据类似工艺的历史数据，工程师们将 $\\Theta$ 建模为在区间 $[0, 1]$ 上均匀分布。\n\n一名质量控制工程师从一天的生产批次中抽取了一批 $n$ 个芯片。设 $X$ 为表示在这批芯片中发现的缺陷芯片总数的随机变量。假设在给定当天 $\\Theta$ 值的条件下，每个芯片的缺陷状态是相互独立的，求 $X$ 的方差。\n\n用 $n$ 表示你的答案。", "solution": "设 $X$ 为一批大小为 $n$ 的芯片中缺陷芯片数量的随机变量，设 $\\Theta$ 为单个芯片有缺陷的概率的随机变量。\n\n问题陈述，$\\Theta$ 的分布是在区间 $[0, 1]$ 上的连续均匀分布。我们记为 $\\Theta \\sim \\text{Uniform}(0, 1)$。$\\Theta$ 的概率密度函数 (PDF) 为：当 $0 \\le \\theta \\le 1$ 时，$f(\\theta) = 1$，否则 $f(\\theta) = 0$。\n\n在缺陷概率为特定值 $\\Theta = \\theta$ 的条件下，一批 $n$ 次独立试验中缺陷芯片的数量 $X$ 服从二项分布。我们记为 $X | (\\Theta = \\theta) \\sim \\text{Binomial}(n, \\theta)$。\n\n为了求出 $X$ 的无条件方差，记作 $\\mathrm{Var}(X)$，我们使用全方差公式（也称为 Eve 法则）：\n$$\n\\mathrm{Var}(X) = \\mathbb{E}[\\mathrm{Var}(X|\\Theta)] + \\mathrm{Var}(\\mathbb{E}[X|\\Theta])\n$$\n我们需要分别计算右侧的两项。\n\n首先，我们求在给定 $\\Theta$ 的条件下 $X$ 的条件期望和条件方差。对于一个随机变量 $Y \\sim \\text{Binomial}(n, p)$，我们知道 $\\mathbb{E}[Y] = np$ 且 $\\mathrm{Var}(Y) = np(1-p)$。将此应用于我们的条件分布：\n1.  给定 $\\Theta$ 的条件下，$X$ 的条件期望是 $\\mathbb{E}[X|\\Theta] = n\\Theta$。\n2.  给定 $\\Theta$ 的条件下，$X$ 的条件方差是 $\\mathrm{Var}(X|\\Theta) = n\\Theta(1-\\Theta) = n\\Theta - n\\Theta^2$。\n\n现在，我们计算全方差公式的两项。\n\n第一项是 $\\mathbb{E}[\\mathrm{Var}(X|\\Theta)]$。这是条件方差的期望，是关于 $\\Theta$ 的分布取期望。\n$$\n\\mathbb{E}[\\mathrm{Var}(X|\\Theta)] = \\mathbb{E}[n\\Theta - n\\Theta^2] = n\\mathbb{E}[\\Theta] - n\\mathbb{E}[\\Theta^2]\n$$\n我们需要求出 $\\text{Uniform}(0, 1)$ 分布的前两阶矩。\n$\\Theta$ 的期望值为：\n$$\n\\mathbb{E}[\\Theta] = \\int_0^1 \\theta f(\\theta) \\,d\\theta = \\int_0^1 \\theta \\cdot 1 \\,d\\theta = \\left[\\frac{\\theta^2}{2}\\right]_0^1 = \\frac{1}{2}\n$$\n$\\Theta^2$ 的期望值为：\n$$\n\\mathbb{E}[\\Theta^2] = \\int_0^1 \\theta^2 f(\\theta) \\,d\\theta = \\int_0^1 \\theta^2 \\cdot 1 \\,d\\theta = \\left[\\frac{\\theta^3}{3}\\right]_0^1 = \\frac{1}{3}\n$$\n将这些值代回 $\\mathbb{E}[\\mathrm{Var}(X|\\Theta)]$ 的表达式中：\n$$\n\\mathbb{E}[\\mathrm{Var}(X|\\Theta)] = n\\left(\\frac{1}{2}\\right) - n\\left(\\frac{1}{3}\\right) = n\\left(\\frac{3-2}{6}\\right) = \\frac{n}{6}\n$$\n\n第二项是 $\\mathrm{Var}(\\mathbb{E}[X|\\Theta])$。这是条件期望的方差。\n$$\n\\mathrm{Var}(\\mathbb{E}[X|\\Theta]) = \\mathrm{Var}(n\\Theta)\n$$\n使用性质 $\\mathrm{Var}(aY) = a^2\\mathrm{Var}(Y)$，我们有：\n$$\n\\mathrm{Var}(n\\Theta) = n^2\\mathrm{Var}(\\Theta)\n$$\n$\\Theta$ 的方差由 $\\mathrm{Var}(\\Theta) = \\mathbb{E}[\\Theta^2] - (\\mathbb{E}[\\Theta])^2$ 给出。使用我们已经计算出的矩：\n$$\n\\mathrm{Var}(\\Theta) = \\frac{1}{3} - \\left(\\frac{1}{2}\\right)^2 = \\frac{1}{3} - \\frac{1}{4} = \\frac{4-3}{12} = \\frac{1}{12}\n$$\n现在，将此代入 $\\mathrm{Var}(\\mathbb{E}[X|\\Theta])$ 的表达式中：\n$$\n\\mathrm{Var}(\\mathbb{E}[X|\\Theta]) = n^2 \\left(\\frac{1}{12}\\right) = \\frac{n^2}{12}\n$$\n\n最后，我们将两项相加，求出 $X$ 的总方差：\n$$\n\\mathrm{Var}(X) = \\mathbb{E}[\\mathrm{Var}(X|\\Theta)] + \\mathrm{Var}(\\mathbb{E}[X|\\Theta]) = \\frac{n}{6} + \\frac{n^2}{12}\n$$\n为了简化，我们通分：\n$$\n\\mathrm{Var}(X) = \\frac{2n}{12} + \\frac{n^2}{12} = \\frac{n^2 + 2n}{12}\n$$\n对分子进行因式分解，得到最终表达式：\n$$\n\\mathrm{Var}(X) = \\frac{n(n+2)}{12}\n$$", "answer": "$$\\boxed{\\frac{n(n+2)}{12}}$$", "id": "1929483"}, {"introduction": "这道最后的实践问题综合了来自几何学和分层建模的概念，以展示全方差定律的全部威力。我们将确定一个圆内弦长的方差，而这个圆的半径本身就是一个随机变量。这个问题挑战你建立一个多层次的随机实验，并将定律应用于一个不那么直观的情境，从而增强你解决问题和分析的能力。[@problem_id:1929500]", "problem": "在一个宇宙弦环的统计模型中，这些环被理想化为圆形。一个给定环的半径，记为 $R$，不是一个固定的常数，而其本身是一个随机变量。主导环形成的随机过程使得半径的平方 $R^2$ 服从一个已知的率参数为 $\\lambda > 0$ 的指数分布。\n\n对于任意一个这样的圆形环，沿其圆周独立且均匀随机地选择两个点。令 $L$ 为代表连接这两点的直线弦长度的随机变量。\n\n您的任务是确定弦长 $L$ 的理论方差 $\\mathrm{Var}(L)$。请将您的最终答案表示为关于参数 $\\lambda$ 和常数 $\\pi$ 的单个闭式解析表达式。", "solution": "令 $R$ 为随机半径，并令 $X=R^{2}$。根据假设，$X\\sim \\text{Exp}(\\lambda)$，其率参数为 $\\lambda>0$，因此其密度函数为 $f_{X}(x)=\\lambda \\exp(-\\lambda x)$，其中 $x\\geq 0$。\n\n给定一个固定的半径 $R=r$，在圆周上选取两个独立的、服从均匀分布的点。令 $\\Theta$ 为它们之间较小的圆心角。因为如果 $U,V$ 是在 $[0,2\\pi)$ 上独立的均匀随机变量，那么 $W=U-V$ 模 $2\\pi$ 在 $[0,2\\pi)$ 上是均匀分布的，且 $\\Theta=\\min\\{W,2\\pi-W\\}$，由此可知 $\\Theta$ 在 $[0,\\pi]$ 上是均匀分布的，其密度为 $1/\\pi$。弦长为\n$$\nL=2r\\sin\\!\\left(\\frac{\\Theta}{2}\\right).\n$$\n因此，\n$$\n\\mathbb{E}[L\\mid R=r]=2r\\,\\mathbb{E}\\!\\left[\\sin\\!\\left(\\frac{\\Theta}{2}\\right)\\right],\\quad \\mathbb{E}[L^{2}\\mid R=r]=4r^{2}\\,\\mathbb{E}\\!\\left[\\sin^{2}\\!\\left(\\frac{\\Theta}{2}\\right)\\right].\n$$\n当 $\\Theta\\sim \\text{Unif}(0,\\pi)$ 时，计算可得\n$$\n\\mathbb{E}\\!\\left[\\sin\\!\\left(\\frac{\\Theta}{2}\\right)\\right]=\\frac{1}{\\pi}\\int_{0}^{\\pi}\\sin\\!\\left(\\frac{\\theta}{2}\\right)\\,d\\theta=\\frac{2}{\\pi},\n$$\n以及\n$$\n\\mathbb{E}\\!\\left[\\sin^{2}\\!\\left(\\frac{\\Theta}{2}\\right)\\right]=\\frac{1}{\\pi}\\int_{0}^{\\pi}\\frac{1-\\cos\\theta}{2}\\,d\\theta=\\frac{1}{2}.\n$$\n于是，\n$$\n\\mathbb{E}[L\\mid R=r]=\\frac{4r}{\\pi},\\qquad \\mathbb{E}[L^{2}\\mid R=r]=2r^{2}.\n$$\n\n根据全期望定律，\n$$\n\\mathbb{E}[L]=\\mathbb{E}\\big[\\mathbb{E}[L\\mid R]\\big]=\\frac{4}{\\pi}\\,\\mathbb{E}[R],\\qquad \\mathbb{E}[L^{2}]=\\mathbb{E}\\big[\\mathbb{E}[L^{2}\\mid R]\\big]=2\\,\\mathbb{E}[R^{2}].\n$$\n由于 $X=R^{2}\\sim \\text{Exp}(\\lambda)$，其分数阶矩对于 $\\alpha>-1$ 满足：\n$$\n\\mathbb{E}[X^{\\alpha}]=\\int_{0}^{\\infty}x^{\\alpha}\\lambda \\exp(-\\lambda x)\\,dx=\\lambda^{-\\alpha}\\Gamma(\\alpha+1).\n$$\n取 $\\alpha=\\frac{1}{2}$ 可得\n$$\n\\mathbb{E}[R]=\\mathbb{E}[X^{1/2}]=\\lambda^{-1/2}\\Gamma\\!\\left(\\frac{3}{2}\\right)=\\lambda^{-1/2}\\frac{\\sqrt{\\pi}}{2},\n$$\n而当 $\\alpha=1$ 时，\n$$\n\\mathbb{E}[R^{2}]=\\mathbb{E}[X]=\\frac{1}{\\lambda}.\n$$\n因此，\n$$\n\\mathbb{E}[L]=\\frac{4}{\\pi}\\cdot \\frac{\\sqrt{\\pi}}{2}\\lambda^{-1/2}=\\frac{2}{\\sqrt{\\pi}}\\lambda^{-1/2},\\qquad \\mathbb{E}[L^{2}]=\\frac{2}{\\lambda}.\n$$\n方差为\n$$\n\\mathrm{Var}(L)=\\mathbb{E}[L^{2}]-(\\mathbb{E}[L])^{2}=\\frac{2}{\\lambda}-\\left(\\frac{2}{\\sqrt{\\pi}}\\lambda^{-1/2}\\right)^{2}=\\frac{2}{\\lambda}-\\frac{4}{\\pi\\lambda}=\\frac{2}{\\lambda}\\left(1-\\frac{2}{\\pi}\\right).\n$$\n这是一个关于 $\\lambda$ 和 $\\pi$ 的闭式表达式。", "answer": "$$\\boxed{\\frac{2}{\\lambda}\\left(1-\\frac{2}{\\pi}\\right)}$$", "id": "1929500"}]}