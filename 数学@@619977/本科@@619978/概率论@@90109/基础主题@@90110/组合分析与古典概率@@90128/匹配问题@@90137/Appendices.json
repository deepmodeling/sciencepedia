{"hands_on_practices": [{"introduction": "我们从一个构成匹配问题核心的基础问题开始。这个练习将引导你使用简洁的指示变量法，计算在随机排列中“正确匹配”的期望数量 $E[X]$。掌握这项技巧至关重要，因为它能简化复杂问题，并常常带来出人意料的简洁而有力的结果。[@problem_id:1401448]", "problem": "在一门有50名学生的大型讲座课程中，一位教授批改完了期末考试试卷。教授有一叠50份已批改的试卷，每份试卷上都写着一名学生的名字。教授决定随机分发试卷，而不是逐一叫学生上前来领取。这叠试卷被充分洗牌，然后分发给按固定顺序就座的50名学生。每名学生正好收到一份试卷。\n\n拿到自己试卷的学生的期望数是多少？", "solution": "令有 $n=50$ 名学生和试卷。将随机分发过程建模为试卷在学生中的一个均匀随机排列。对每位学生 $i \\in \\{1,2,\\dots,50\\}$，定义指示随机变量\n$$\nX_{i}=\\begin{cases}\n1, & \\text{如果学生 } i \\text{ 拿到自己的试卷}，\\\\\n0, & \\text{否则}。\n\\end{cases}\n$$\n拿到自己试卷的学生总数是\n$$\nX=\\sum_{i=1}^{50} X_{i}.\n$$\n我们使用期望的线性性质来计算期望值：\n$$\n\\mathbb{E}[X]=\\sum_{i=1}^{50} \\mathbb{E}[X_{i}].\n$$\n对于每个 $i$，根据随机排列的对称性，学生 $i$ 拿到任何一份试卷的概率是均等的，所以\n$$\n\\mathbb{P}(X_{i}=1)=\\frac{1}{50}.\n$$\n因此\n$$\n\\mathbb{E}[X_{i}]=1 \\cdot \\mathbb{P}(X_{i}=1)+0 \\cdot \\mathbb{P}(X_{i}=0)=\\frac{1}{50}.\n$$\n所以，\n$$\n\\mathbb{E}[X]=\\sum_{i=1}^{50} \\frac{1}{50}=50 \\cdot \\frac{1}{50}=1.\n$$\n使用期望的线性性质时，不需要独立性假设。", "answer": "$$\\boxed{1}$$", "id": "1401448"}, {"introduction": "在理解了期望的基础上，我们现在来探讨不同匹配事件之间的关系。这个练习要求你计算两个独立的、不重叠的组中匹配数量的协方差 $\\text{Cov}(X_A, X_B)$。通过将指示变量法应用于二阶矩，你将更深刻地体会到随机排列中单个匹配事件之间是如何相互微弱地关联的。[@problem_id:1401440]", "problem": "在一个大型自动化仓库中，有 $n$ 个不同的物品和 $n$ 个对应的目标货箱，它们的编号都从 1 到 $n$。由于系统性故障，分拣系统根据一个从所有可能的 $n!$ 种排列中均匀随机选择的单一排列，将这 $n$ 个物品分配到 $n$ 个货箱中。如果物品 $i$ 被分配到货箱 $i$，则该物品被认为是“正确放置”的。\n\n为了监控分拣准确性，设立了两个独立的质量控制区。A区由一个包含 $k$ 个不同货箱的集合组成，B区由一个包含 $m$ 个不同货箱的集合组成。A区和B区的货箱集合是不相交的。\n\n令 $X_A$ 为随机变量，表示在A区内被正确放置到其指定货箱的物品数量。类似地，令 $X_B$ 为随机变量，表示在B区内被正确放置的物品数量。假设 $n \\ge 2$，请找出 $X_A$ 和 $X_B$ 之间的协方差（记为 $\\text{Cov}(X_A, X_B)$）关于 $n$、$k$ 和 $m$ 的一般表达式。", "solution": "该问题要求计算在一个随机排列下，两个不相交索引子集中不动点数量之间的协方差。令所有货箱编号的集合为 $S = \\{1, 2, \\dots, n\\}$。令A区的货箱编号集合为 $A \\subset S$，其中 $|A|=k$，B区的货箱编号集合为 $B \\subset S$，其中 $|B|=m$。根据题意， $A \\cap B = \\emptyset$。\n\n随机变量 $X_A$ 是A区中正确放置的物品数量，$X_B$ 是B区中正确放置的物品数量。一个排列是从 $S$ 的所有 $n!$ 个排列集合中均匀随机选出的。\n\n为解决此问题，我们将使用指示变量法。对于每个编号 $i \\in S$，定义指示随机变量 $I_i$ 如下：\n$$\nI_i = \\begin{cases} 1 & \\text{如果物品 } i \\text{ 在货箱 } i \\text{ 中（一个不动点）} \\\\ 0 & \\text{否则} \\end{cases}\n$$\n利用这些指示变量，我们可以将 $X_A$ 和 $X_B$ 表示为和的形式：\n$$\nX_A = \\sum_{i \\in A} I_i \\quad \\text{和} \\quad X_B = \\sum_{j \\in B} I_j\n$$\n协方差的定义为 $\\text{Cov}(X_A, X_B) = E[X_A X_B] - E[X_A] E[X_B]$。我们将分别计算每一项。\n\n首先，我们求指示变量 $I_i$ 的期望。指示变量的期望是它所指示事件的概率。\n$$\nE[I_i] = P(I_i = 1)\n$$\n事件 $I_i=1$ 意味着随机排列 $\\pi$ 在 $i$ 处有一个不动点，即 $\\pi(i)=i$。总排列数为 $n!$。如果我们固定 $\\pi(i)=i$，那么剩下的 $n-1$ 个物品可以有 $(n-1)!$ 种排列方式。因此，\n$$\nE[I_i] = P(\\pi(i)=i) = \\frac{(n-1)!}{n!} = \\frac{1}{n}\n$$\n这对任意 $i \\in S$ 都成立。\n\n现在，我们可以利用期望的线性性计算 $E[X_A]$ 和 $E[X_B]$：\n$$\nE[X_A] = E\\left[\\sum_{i \\in A} I_i\\right] = \\sum_{i \\in A} E[I_i] = \\sum_{i \\in A} \\frac{1}{n} = \\frac{|A|}{n} = \\frac{k}{n}\n$$\n$$\nE[X_B] = E\\left[\\sum_{j \\in B} I_j\\right] = \\sum_{j \\in B} E[I_j] = \\sum_{j \\in B} \\frac{1}{n} = \\frac{|B|}{n} = \\frac{m}{n}\n$$\n因此，期望的乘积是：\n$$\nE[X_A]E[X_B] = \\frac{k}{n} \\cdot \\frac{m}{n} = \\frac{km}{n^2}\n$$\n接下来，我们计算 $E[X_A X_B]$。\n$$\nE[X_A X_B] = E\\left[\\left(\\sum_{i \\in A} I_i\\right) \\left(\\sum_{j \\in B} I_j\\right)\\right] = E\\left[\\sum_{i \\in A} \\sum_{j \\in B} I_i I_j\\right]\n$$\n根据期望的线性性，我们可以将期望移到求和符号内部：\n$$\nE[X_A X_B] = \\sum_{i \\in A} \\sum_{j \\in B} E[I_i I_j]\n$$\n项 $E[I_i I_j]$ 是两个指示变量乘积的期望。这等于两个事件同时发生的概率：\n$$\nE[I_i I_j] = P(I_i=1 \\text{ 且 } I_j=1) = P(\\pi(i)=i \\text{ 且 } \\pi(j)=j)\n$$\n因为 $i \\in A$ 且 $j \\in B$，并且集合 $A$ 和 $B$ 不相交，所以我们知道 $i \\neq j$。为了计算同时满足 $\\pi(i)=i$ 和 $\\pi(j)=j$ 的排列数量，我们固定这两个映射。剩下的 $n-2$ 个物品可以有 $(n-2)!$ 种排列方式。\n因此，对于 $i \\neq j$：\n$$\nE[I_i I_j] = P(\\pi(i)=i, \\pi(j)=j) = \\frac{(n-2)!}{n!} = \\frac{1}{n(n-1)}\n$$\n双重求和 $\\sum_{i \\in A} \\sum_{j \\in B}$ 共有 $|A| \\times |B| = km$ 项。对每一项，其期望 $E[I_i I_j]$ 都是相同的，即 $\\frac{1}{n(n-1)}$。\n所以，\n$$\nE[X_A X_B] = \\sum_{i \\in A} \\sum_{j \\in B} \\frac{1}{n(n-1)} = km \\cdot \\frac{1}{n(n-1)} = \\frac{km}{n(n-1)}\n$$\n最后，我们可以计算协方差：\n$$\n\\text{Cov}(X_A, X_B) = E[X_A X_B] - E[X_A] E[X_B]\n$$\n$$\n\\text{Cov}(X_A, X_B) = \\frac{km}{n(n-1)} - \\frac{km}{n^2}\n$$\n为了简化，我们进行通分：\n$$\n\\text{Cov}(X_A, X_B) = km \\left( \\frac{1}{n(n-1)} - \\frac{1}{n^2} \\right) = km \\left( \\frac{n}{n^2(n-1)} - \\frac{n-1}{n^2(n-1)} \\right)\n$$\n$$\n\\text{Cov}(X_A, X_B) = km \\left( \\frac{n - (n-1)}{n^2(n-1)} \\right) = km \\left( \\frac{1}{n^2(n-1)} \\right)\n$$\n这就给出了协方差的最终表达式：\n$$\n\\text{Cov}(X_A, X_B) = \\frac{km}{n^2(n-1)}\n$$", "answer": "$$ \\boxed{\\frac{km}{n^{2}(n-1)}} $$", "id": "1401440"}, {"introduction": "当我们确定地知道*没有*任何匹配发生时，情况会是怎样？这个场景将我们引入了“错排”（derangements）这个迷人的领域。本练习要求计算在一个已知没有不动点的排列中，出现一个特定结构——一个单一长循环——的概率，从而将匹配问题与组合数学及排列群理论中的概念联系起来。[@problem_id:1401468]", "problem": "在一个安全数据分发中心，一个自动化系统负责将 $n$ 个唯一的加密密钥发送给 $n$ 个对应的用户，其中 $n \\geq 2$。一个严重的软件错误导致系统在分发密钥前对其进行了一次随机置换。系统日志显示发生了一次“完全错配”，这意味着没有用户收到他们正确的密钥。\n\n已知发生了完全错配的情况下，我们关心一种非常特定类型的错误发生的概率：即“循环链”。“循环链”是一种分配方式，在这种分配中，经过对用户和密钥的适当重新标记后，密钥 1 被发送给用户 2，密钥 2 被发送给用户 3，...，密钥 $n-1$ 被发送给用户 $n$，最后，密钥 $n$ 被发送回用户 1，从而形成一个包含所有 $n$ 个项目的单一闭合循环。\n\n观测到的完全错配实际上是一个循环链的概率是多少？请将您的答案表示为关于 $n$ 的封闭形式解析表达式。", "solution": "设 $n$ 个用户和 $n$ 个密钥被标记为 $\\{1,2,\\dots,n\\}$。一次随机分配对应于集合 $\\{1,2,\\dots,n\\}$ 上的一个均匀随机置换 $\\sigma$。“完全错配”意味着 $\\sigma$ 没有不动点，即对所有的 $i$ 都有 $\\sigma(i) \\neq i$，因此 $\\sigma$ 是一个错排。“循环链”意味着 $\\sigma$ 是一个单一的 $n$-轮换。\n\n我们寻求在 $\\sigma$ 是一个错排的条件下，$\\sigma$ 是一个单一 $n$-轮换的条件概率：\n$$\n\\mathbb{P}(\\text{单一 $n$-轮换} \\mid \\text{错排}) \\;=\\; \\frac{\\#\\{\\text{单一 $n$-轮换}\\}}{\\#\\{\\text{错排}\\}}。\n$$\n\n单一 $n$-轮换的数量：在 $n$ 个带标签的元素上，有 $(n-1)!$ 个不同的 $n$-轮换（固定元素 1 为轮换的起点以计入循环旋转；其余 $n-1$ 个元素可任意排列）。对于 $n \\geq 2$，每个 $n$-轮换都没有不动点，因此它是一个错排。\n\n错排的数量：根据容斥原理，令 $A_{i}$ 为固定 $i$ 的置换集合，\n$$\n\\#\\{\\text{错排}\\} \\;=\\; \\sum_{k=0}^{n} (-1)^{k} \\binom{n}{k} (n-k)! \\;=\\; n! \\sum_{k=0}^{n} \\frac{(-1)^{k}}{k!}。\n$$\n此简化使用了 $\\binom{n}{k}(n-k)! = \\frac{n!}{k!}$。\n\n因此，\n$$\n\\mathbb{P}(\\text{单一 $n$-轮换} \\mid \\text{错排})\n\\;=\\; \\frac{(n-1)!}{n! \\sum_{k=0}^{n} \\frac{(-1)^{k}}{k!}}\n\\;=\\; \\frac{1}{n \\displaystyle \\sum_{k=0}^{n} \\frac{(-1)^{k}}{k!}}。\n$$\n这是一个关于 $n$ 的封闭形式解析表达式。", "answer": "$$\\boxed{\\frac{1}{n \\displaystyle \\sum_{k=0}^{n} \\frac{(-1)^{k}}{k!}}}$$", "id": "1401468"}]}