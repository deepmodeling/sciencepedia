{"hands_on_practices": [{"introduction": "我们从一个基础练习开始，它将帮助你掌握计算生日问题概率的核心方法。通常，直接计算至少发生一次碰撞的概率比较复杂，一个更直接的策略是计算其对立事件——完全没有碰撞发生的概率。这个练习将引导你通过计算一系列独立随机事件都落在不同“箱子”里的概率，来为更复杂的问题打下坚实的基础 [@problem_id:1404644]。", "problem": "一名计算机科学专业的学生正在实验一个简单的哈希函数，该函数用于将数据键映射到哈希表中。该哈希表有 $M=12$ 个可用槽位，索引从0到11。该学生假设其哈希函数将键均匀且随机地分布到这些槽位中，这意味着任何键被映射到12个槽位中任意一个的概率都相等。\n\n如果该学生将 $k=5$ 个不同的键插入到初始为空的哈希表中，那么没有两个键被映射到同一个槽位（即不发生冲突）的概率是多少？\n\n将你的答案计算为小数，并四舍五入到四位有效数字。", "solution": "每个键都被独立且均匀地映射到 $M=12$ 个槽位中的一个。对于 $k=5$ 个不同的键不发生冲突的情况，第二个键必须避开第一个键的槽位，第三个键必须避开前两个键的槽位，以此类推。因此，该概率是条件概率的乘积：\n$$\nP=\\frac{12}{12}\\cdot\\frac{11}{12}\\cdot\\frac{10}{12}\\cdot\\frac{9}{12}\\cdot\\frac{8}{12}\n$$\n化简得，\n$$\nP=\\frac{12\\cdot 11\\cdot 10\\cdot 9\\cdot 8}{12^{5}}=\\frac{11\\cdot 10\\cdot 9\\cdot 8}{12^{4}}=\\frac{7920}{20736}=\\frac{55}{144}\n$$\n作为四舍五入到四位有效数字的小数，\n$$\nP=\\frac{55}{144}\\approx 0.3819\n$$", "answer": "$$\\boxed{0.3819}$$", "id": "1404644"}, {"introduction": "生日问题的魅力在于其反直觉的结论：我们只需要相对较少的元素，就能以很高的概率发现碰撞。这个练习将问题反转过来，不再是计算给定人数下的概率，而是要你找出需要多少个元素（例如数据密钥），才能使至少发生一次碰撞的概率超过 $50\\%$ [@problem_id:1404642]。通过解决这个问题，你将亲身体验到碰撞概率是如何随着元素数量的增加而迅速攀升的。", "problem": "一个大规模分布式数据库系统使用一种简单的哈希方案来将其数据键分布到各个服务器上。集群中有 $N=64$ 台服务器。当添加一个新键时，会对其应用一个哈希函数，并且该键被存储在由 `hash(key) mod N` 的结果索引的服务器上。假设该哈希函数是理想的，即它将键均匀且随机地分布到各个服务器上。必须向数据库中插入的最少键数是多少，才能使至少发生一次“冲突”（即至少有两个键被分配到同一台服务器）的概率严格大于 $0.5$？", "solution": "令 $N=64$，并令 $m$ 表示插入的键的数量。在均匀哈希的假设下，每个键的服务器索引在 $\\{0,1,\\dots,63\\}$ 上均匀分布，且与其他键独立。对于 $m \\leq N$，这 $m$ 个键被分配到不同服务器（无冲突）的概率为：\n$$\nP_{\\text{no coll}}(m)=\\prod_{i=0}^{m-1}\\frac{N-i}{N}=\\prod_{k=1}^{m-1}\\left(1-\\frac{k}{N}\\right)\n$$\n我们想要找到最小的 $m$，使得冲突概率严格大于 $0.5$，即 $1-P_{\\text{no coll}}(m)> 1/2$，或等价地，$P_{\\text{no coll}}(m)<1/2$。\n\n首先，证明当 $m=10$ 时，$P_{\\text{no coll}}(10)<1/2$。使用 $\\ln(1-x)$ 的带余项的泰勒级数，以及对于 $x\\in(0,1)$，有\n$$\n\\ln(1-x)=-x-\\frac{x^{2}}{2}-\\sum_{n=3}^{\\infty}\\frac{x^{n}}{n}\\leq -x-\\frac{x^{2}}{2},\n$$\n我们得到\n$$\n\\ln P_{\\text{no coll}}(10)=\\sum_{k=1}^{9}\\ln\\left(1-\\frac{k}{64}\\right)\\leq -\\sum_{k=1}^{9}\\frac{k}{64}-\\frac{1}{2}\\sum_{k=1}^{9}\\left(\\frac{k}{64}\\right)^{2}\n$$\n精确计算这些和：\n$$\n\\sum_{k=1}^{9}\\frac{k}{64}=\\frac{1}{64}\\cdot\\frac{9\\cdot 10}{2}=\\frac{45}{64},\n\\qquad\n\\sum_{k=1}^{9}\\left(\\frac{k}{64}\\right)^{2}=\\frac{1}{64^{2}}\\cdot\\frac{9\\cdot 10\\cdot 19}{6}=\\frac{285}{4096}\n$$\n因此\n$$\nP_{\\text{no coll}}(10)\\leq \\exp\\!\\left(-\\frac{45}{64}-\\frac{1}{2}\\cdot\\frac{285}{4096}\\right)=\\exp\\!\\left(-\\frac{6045}{8192}\\right)\n$$\n注意到 $\\frac{6045}{8192}>0.7$，并且\n$$\ne^{0.7}=\\sum_{n=0}^{\\infty}\\frac{(0.7)^{n}}{n!}>1+0.7+\\frac{(0.7)^{2}}{2}+\\frac{(0.7)^{3}}{6}\n=1+0.7+0.245+0.057... > 2\n$$\n因此 $e^{-0.7}<1/2$，并且根据 $\\exp$ 函数的单调性，\n$$\nP_{\\text{no coll}}(10)\\leq \\exp\\!\\left(-\\frac{6045}{8192}\\right)<e^{-0.7}<1/2\n$$\n因此，当 $m=10$ 时，冲突概率超过 $1/2$。\n\n接下来，证明当 $m=9$ 时，$P_{\\text{no coll}}(9) > 1/2$。我们转而证明其对数 $\\ln(P_{\\text{no coll}}(9)) > \\ln(0.5) \\approx -0.693$。\n$$ \\ln P_{\\text{no coll}}(9) = \\sum_{k=1}^{8} \\ln\\left(1 - \\frac{k}{64}\\right) $$\n使用不等式 $\\ln(1-x) > -x - \\frac{x^2}{2(1-x)}$，其中 $x=k/64 \\le 1/8$，因此 $1-x \\ge 7/8$。\n$$ \\ln P_{\\text{no coll}}(9) > \\sum_{k=1}^{8} \\left(-\\frac{k}{64} - \\frac{(k/64)^2}{2(7/8)}\\right) = -\\frac{1}{64}\\sum_{k=1}^{8} k - \\frac{4}{7 \\cdot 64^2}\\sum_{k=1}^{8} k^2 $$\n代入 $\\sum_{k=1}^{8} k = 36$ 和 $\\sum_{k=1}^{8} k^2 = 204$，可得：\n$$ \\ln P_{\\text{no coll}}(9) > -\\frac{36}{64} - \\frac{816}{28672} = -0.5625 - \\frac{816}{28672} \\approx -0.591 $$\n由于 $-0.591 > -0.693$，因此 $\\ln P_{\\text{no coll}}(9) > \\ln(0.5)$，即 $P_{\\text{no coll}}(9) > 0.5$。\n\n由于 $P_{\\text{no coll}}(m)$ 关于 $m$ 是严格递减的（每个新乘数都小于 $1$），使得 $P_{\\text{no coll}}(m)<1/2$（等价于至少发生一次冲突的概率超过 $1/2$）的最小 $m$ 是 $m=10$。", "answer": "$$\\boxed{10}$$", "id": "1404642"}, {"introduction": "除了计算“至少一次碰撞”的概率，我们还可以从另一个角度来量化碰撞的程度：计算碰撞对的期望数量。这种方法不仅在数学上常常更为简洁，而且为系统性能评估提供了不同的视角。这个练习将指导你使用期望的线性性质——一个在概率论中极其强大的工具——来计算在给定情境下，平均会发生多少次碰撞 [@problem_id:1404678]。", "problem": "一个分布式数据存储系统的简化模型涉及将数据文件哈希到不同的存储桶中。假设需要存储一批 $k=20$ 个独立的数据文件。该系统使用一个哈希函数，将每个文件伪随机地分配到 $M=12$ 个可用的存储桶之一。假设对于任何给定的文件，它被分配到 $M$ 个存储桶中任何一个的可能性是相等的，并且不同文件的分配是相互独立的。\n\n当两个或多个文件被分配到同一个存储桶时，这被称为“碰撞”。我们关心的是发生碰撞的文件对的数量。计算被分配到同一存储桶的不同文件对的期望数量。\n\n请用最简精确分数表示你的答案。", "solution": "设 $k$ 为文件数量，$M$ 为存储桶数量。为每对不同的文件 $\\{i,j\\}$ 定义指示变量 $X_{ij}$，如果文件 $i$ 和 $j$ 被分配到同一个存储桶，则 $X_{ij}=1$，否则 $X_{ij}=0$。碰撞文件对的总数是 $X=\\sum_{1 \\leq i < j \\leq k} X_{ij}$。\n\n根据分配的均匀性和独立性，对于任何固定的文件对 $\\{i,j\\}$，它们都被分配到同一个存储桶的概率是 $\\frac{1}{M}$，所以 $\\mathbb{E}[X_{ij}] = \\frac{1}{M}$。利用期望的线性性，\n$$\n\\mathbb{E}[X] \\;=\\; \\sum_{1 \\leq i < j \\leq k} \\mathbb{E}[X_{ij}] \\;=\\; \\binom{k}{2} \\cdot \\frac{1}{M} \\;=\\; \\frac{k(k-1)}{2M}\n$$\n代入 $k=20$ 和 $M=12$：\n$$\n\\mathbb{E}[X] \\;=\\; \\frac{20 \\cdot 19}{2 \\cdot 12} \\;=\\; \\frac{380}{24} \\;=\\; \\frac{190}{12} \\;=\\; \\frac{95}{6}\n$$\n这已是最简形式。", "answer": "$$\\boxed{\\frac{95}{6}}$$", "id": "1404678"}]}