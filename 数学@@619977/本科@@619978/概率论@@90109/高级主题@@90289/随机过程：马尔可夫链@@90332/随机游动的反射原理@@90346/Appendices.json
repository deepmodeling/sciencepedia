{"hands_on_practices": [{"introduction": "这个练习从一个常被称为“投票问题”(Ballot Problem)的经典而优雅的反射原理应用开始。我们将探讨一个算法交易机器人的行为，来计算在已知随机游走终点为 $S_{2n}=2k$ 的情况下，其路径始终保持在初始价格之上的条件概率。这个问题出人意料地简洁的结果，即 $\\frac{k}{n}$，完美地彰显了其背后组合论证的力量 [@problem_id:1405585]。", "problem": "一个算法交易机器人分析一种波动性大的加密货币的价格。该机器人将价格变动建模为简单对称随机游走。从一个我们设为 $0$ 的参考价格开始，在每分钟结束时，价格以相等的概率变化 +$1 或 -$1。\n\n该机器人被编程设定了一条特定的风险管理规则：只要其价格严格保持在初始购买价格之上，它就会持有该资产。如果在购买后的任何一分钟，价格回到或低于初始价格，机器人会立即出售该资产。\n\n假设机器人购买了该资产，并经过了 $2n$ 分钟。观测到在这 $2n$ 分钟结束时，资产价格恰好比初始价格高 $2k$ 美元，其中 $n$ 和 $k$ 是满足 $n \\ge k$ 的正整数。\n\n给定最终价格为 $2k$ 的观测结果，机器人在这 $2n$ 分钟的区间内任何时刻都*没有*出售该资产的概率是多少？将您的答案表示为关于 $n$ 和 $k$ 的闭式解析表达式。", "solution": "令 $\\{X_{t}\\}_{t=1}^{2n}$ 为独立同分布的步长，满足 $\\mathbb{P}(X_{t}=1)=\\mathbb{P}(X_{t}=-1)=\\frac{1}{2}$，并定义随机游走 $S_{0}=0$, $S_{t}=\\sum_{i=1}^{t}X_{i}$。机器人在这 $2n$ 分钟内没有出售资产，当且仅当其路径在所有中间时刻都严格保持在初始价格之上，即\n$$\nS_{t}>0 \\quad \\text{for all } t\\in\\{1,2,\\ldots,2n\\}.\n$$\n\n在观测到最终值为 $S_{2n}=2k$（其中 $n\\geq k\\geq 1$）的条件下。令 $U$ 和 $D$ 分别表示 +1 和 -1 步数的总数。那么\n$$\nU-D=S_{2n}=2k,\\qquad U+D=2n \\;\\;\\Rightarrow\\;\\; U=n+k,\\; D=n-k.\n$$\n在这个条件下，所有恰好有 $U=n+k$ 次向上步和 $D=n-k$ 次向下步的序列都是等可能的，其总数为\n$$\nN_{\\text{tot}}=\\binom{2n}{n+k}.\n$$\n\n令 $N_{+}$ 为在这类序列中，其部分和在所有时刻 $t=1,\\ldots,2n$ 都严格为正的序列数量。条件 $S_{t}>0$（对于所有 $t$）等价于对于序列的每一个前缀，向上步数都严格多于向下步数，即对于所有 $t$ 都有 $U_{t}>D_{t}$。根据 Bertrand 投票定理，在 $U>D$ 的条件下，对于所有 $t$ 都满足 $U_{t}>D_{t}$ 的序列数量为\n$$\nN_{+}=\\frac{U-D}{U+D}\\,N_{\\text{tot}}=\\frac{(n+k)-(n-k)}{(n+k)+(n-k)}\\,\\binom{2n}{n+k}=\\frac{2k}{2n}\\,\\binom{2n}{n+k}.\n$$\n因此，所求的条件概率为\n$$\n\\mathbb{P}\\!\\left(\\text{no sell during }2n\\ \\big|\\ S_{2n}=2k\\right)=\\frac{N_{+}}{N_{\\text{tot}}}=\\frac{2k}{2n}=\\frac{k}{n}.\n$$\n这是一个关于 $n$ 和 $k$ 的闭式表达式。", "answer": "$$\\boxed{\\frac{k}{n}}$$", "id": "1405585"}, {"introduction": "在解决了关于路径整体性质的条件概率问题后，我们现在将焦点从“是否”穿过边界转移到“何时”首次穿过边界。这个问题要求我们运用反射原理来计算路径在特定时刻 $n=9$ 首次到达某个水平位（距离原点至少5个单位）的概率。这对于理解诸如首达时间（first-passage times）等随机过程中的基本概念至关重要 [@problem_id:1405604]。", "problem": "一个粒子在整数集 $\\mathbb{Z}$ 上进行对称随机游走。它从原点出发，因此其初始位置为 $S_0=0$。在每个离散时间步，粒子以 $1/2$ 的概率向右移动一个单位，或以 $1/2$ 的概率向左移动一个单位。设 $S_n$ 表示粒子在 $n$ 步之后的位置。\n\n计算粒子与原点的距离首次达到至少 5 个单位的事件发生在第 9 步的概率。也就是说，求事件 $|S_9| \\ge 5$ 且对于所有满足 $1 \\le k < 9$ 的整数 $k$ 都有 $|S_k| < 5$ 的概率。\n\n将答案表示为最简分数形式。", "solution": "设 $T$ 表示与原点的距离首次达到至少 $5$ 的时间，即 $T=\\min\\{n\\geq 1:|S_{n}|\\geq 5\\}$。我们需要求解 $\\Pr(T=9)$。\n\n首先注意到，如果 $|S_{9}| \\geq 7$，那么由于步长为单位长度，该游走必定在某个 $k<9$ 的时刻经过了 $|S_{k}|=5$。因此，事件 $\\{T=9\\}$ 要求 $|S_{9}|=5$。所以，\n$$\n\\Pr(T=9)=\\Pr(S_{9}=5,\\ \\max_{1\\leq k<9}S_{k}\\leq 4)+\\Pr(S_{9}=-5,\\ \\min_{1\\leq k<9}S_{k}\\geq -4).\n$$\n根据对称性，\n$$\n\\Pr(T=9)=2\\,\\Pr\\big(S_{9}=5,\\ \\max_{1\\leq k<9}S_{k}\\leq 4\\big).\n$$\n\n为了计算 $\\Pr\\big(S_{9}=5,\\ \\max_{k<9}S_{k}\\leq 4\\big)$，注意到 $S_{9}=5$ 需要 7 次向右移动和 2 次向左移动，因此在 9 步内从 0 到 5 的路径总数为 $\\binom{9}{7}$。在这些路径中，首次在时间 9 到达 5（即，在时间 8 之前一直保持在 $\\leq 4$）的路径数量，由投票定理（或反射原理）给出为\n$$\n\\frac{5}{9}\\binom{9}{7}.\n$$\n因此，\n$$\n\\Pr\\big(S_{9}=5,\\ \\max_{k<9}S_{k}\\leq 4\\big)=\\frac{\\frac{5}{9}\\binom{9}{7}}{2^{9}}.\n$$\n对于终点为 $-5$ 的对称情况，将概率加倍可得\n$$\n\\Pr(T=9)=2\\cdot \\frac{\\frac{5}{9}\\binom{9}{7}}{2^{9}}=\\frac{10}{9}\\cdot \\frac{\\binom{9}{7}}{2^{9}}.\n$$\n由于 $\\binom{9}{7}=\\binom{9}{2}=36$，我们化简得：\n$$\n\\Pr(T=9)=\\frac{10}{9}\\cdot \\frac{36}{2^{9}}=\\frac{10\\cdot 4}{2^{9}}=\\frac{40}{512}=\\frac{5}{64}.\n$$\n此分数为最简形式。", "answer": "$$\\boxed{\\frac{5}{64}}$$", "id": "1405604"}, {"introduction": "这项进阶练习综合了前面的概念，要求我们计算随机游走路径所能达到的期望最大值。我们再次以随机游走的终点 $S_{10}=2L$ 为条件，但目标是计算路径在此过程中的最大位移 $\\max_{0 \\le k \\le 10} \\{x_k\\}$ 的期望值。这不仅需要进行单次计数，而是要利用反射原理推导出一个完整的概率分布，从而深入探究随机游走路径的内在属性 [@problem_id:1405583]。", "problem": "一个可编程纳米粒子被限制在一条一维轨道上移动。从定义为 $x=0$ 的原点开始，它进行一系列共 $n=10$ 步的离散运动。在每一步中，它向正方向或负方向移动一个固定距离 $L$，两种选择的概率相等，均为 $1/2$。\n\n设粒子在 $k$ 步之后的位置为 $x_k$。整个过程包含 $n=10$ 步。在过程结束时，一次测量显示该纳米粒子位于最终位置 $x_{10} = 2L$。\n\n在已知这个最终位置的条件下，该纳米粒子在其运动过程中达到的最大正位置 $\\max_{0 \\le k \\le 10} \\{x_k\\}$ 的期望值是多少？请用一个单一分数乘以 $L$ 的形式表示你的答案。", "solution": "设 $S_{k}$ 为简单对称随机游走，其中 $S_{0}=0$，每步的增量为 $\\pm 1$，概率为 $1/2$，因此 $x_{k}=L S_{k}$。我们已知 $S_{10}=2$ (等价于 $x_{10}=2L$)。定义此游走的最大值为 $M=\\max_{0\\leq k \\leq 10} S_{k}$。所求的期望值为\n$$\n\\mathbb{E}\\left[\\max_{0\\leq k\\leq 10} x_{k}\\,\\big|\\,x_{10}=2L\\right]\n= L\\,\\mathbb{E}\\left[M\\,\\big|\\,S_{10}=2\\right].\n$$\n因此，我们只需计算 $\\mathbb{E}[M\\,|\\,S_{10}=2]$。\n\n在 $S_{10}=2$ 的条件下，该游走恰好有 $6$ 次向上步和 $4$ 次向下步，并且所有 $\\binom{10}{6}$ 种这样的序列都是等可能的。为求以 $S_{10}=2$ 为条件的 $M$ 的分布，我们使用关于上边界的反射原理。对于整数 $m$，设 $N_{\\leq m}$ 表示从 $0$ 到 $2$ 的长度为 $10$ 且最大值至多为 $m$ 的路径数量。根据反射原理，至少触及一次水平线 $m+1$ 的路径数量，等于从原点 $(0,0)$ 反射后的点 $(0, 2(m+1))$ 出发到终点 $(10,2)$ 的无限制路径的数量。因此\n$$\nN_{\\leq m}\n= \\binom{10}{\\frac{10+2}{2}} - \\binom{10}{\\frac{10+(2 - 2(m+1))}{2}}\n= \\binom{10}{6} - \\binom{10}{5-m},\n$$\n约定如果 $k<0$ 或 $k>10$，则 $\\binom{10}{k}=0$。因此\n$$\n\\mathbb{P}(M \\leq m \\mid S_{10}=2)\n= \\frac{N_{\\leq m}}{\\binom{10}{6}}\n= 1 - \\frac{\\binom{10}{5-m}}{\\binom{10}{6}}.\n$$\n因为 $S_{10}=2$，必然有 $M \\in \\{2,3,4,5,6\\}$。使用 $\\binom{10}{6}=210$ 和 $\\binom{10}{3}=120$、$\\binom{10}{2}=45$、$\\binom{10}{1}=10$、$\\binom{10}{0}=1$ 这些值，计算当 $m=2,3,4,5,6$ 时 $\\mathbb{P}(M \\leq m \\mid S_{10}=2)$ 的值：\n$$\n\\mathbb{P}(M \\leq 2 \\mid S_{10}=2)=\\frac{210-120}{210}=\\frac{3}{7},\n$$\n$$\n\\mathbb{P}(M \\leq 3 \\mid S_{10}=2)=\\frac{210-45}{210}=\\frac{11}{14},\n$$\n$$\n\\mathbb{P}(M \\leq 4 \\mid S_{10}=2)=\\frac{210-10}{210}=\\frac{20}{21},\n$$\n$$\n\\mathbb{P}(M \\leq 5 \\mid S_{10}=2)=\\frac{210-1}{210}=\\frac{209}{210},\n$$\n$$\n\\mathbb{P}(M \\leq 6 \\mid S_{10}=2)=1.\n$$\n因此\n$$\n\\mathbb{P}(M=2 \\mid S_{10}=2)=\\frac{3}{7},\\quad\n\\mathbb{P}(M=3 \\mid S_{10}=2)=\\frac{11}{14}-\\frac{3}{7}=\\frac{5}{14},\n$$\n$$\n\\mathbb{P}(M=4 \\mid S_{10}=2)=\\frac{20}{21}-\\frac{11}{14}=\\frac{1}{6},\\quad\n\\mathbb{P}(M=5 \\mid S_{10}=2)=\\frac{209}{210}-\\frac{20}{21}=\\frac{3}{70},\n$$\n$$\n\\mathbb{P}(M=6 \\mid S_{10}=2)=1-\\frac{209}{210}=\\frac{1}{210}.\n$$\n因此\n$$\n\\mathbb{E}[M \\mid S_{10}=2]\n= 2\\cdot\\frac{3}{7}+3\\cdot\\frac{5}{14}+4\\cdot\\frac{1}{6}+5\\cdot\\frac{3}{70}+6\\cdot\\frac{1}{210}.\n$$\n以公分母 $210$ 计算各项：\n$$\n2\\cdot\\frac{3}{7}=\\frac{180}{210},\\quad\n3\\cdot\\frac{5}{14}=\\frac{225}{210},\\quad\n4\\cdot\\frac{1}{6}=\\frac{140}{210},\\quad\n5\\cdot\\frac{3}{70}=\\frac{45}{210},\\quad\n6\\cdot\\frac{1}{210}=\\frac{6}{210},\n$$\n所以\n$$\n\\mathbb{E}[M \\mid S_{10}=2]=\\frac{180+225+140+45+6}{210}=\\frac{596}{210}=\\frac{298}{105}.\n$$\n最后，\n$$\n\\mathbb{E}\\left[\\max_{0\\leq k\\leq 10} x_{k}\\,\\big|\\,x_{10}=2L\\right]\n= L\\,\\mathbb{E}[M \\mid S_{10}=2] = \\frac{298}{105}\\,L.\n$$", "answer": "$$\\boxed{\\frac{298}{105}L}$$", "id": "1405583"}]}