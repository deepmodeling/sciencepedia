{"hands_on_practices": [{"introduction": "Metropolis-Hastings 算法的核心在于其接受概率 $α$。这个计算决定了我们是移动到一个新提出的状态还是停留在原地，从而引导马尔可夫链的随机游走趋向于目标分布。本练习通过一个具体的数值计算，帮助你牢固掌握在给定目标分布和提议分布的情况下，如何计算这一至关重要的接受概率 [@problem_id:1371728]。", "problem": "一位数据科学家正在实现一个马尔可夫链蒙特卡洛（MCMC）模拟，以从参数 $x$ 的后验概率分布中抽取样本。目标分布 $\\pi(x)$ 与参数负绝对值的指数成正比，即 $\\pi(x) \\propto \\exp(-|x|)$。\n\n该科学家使用 Metropolis 算法，其提议分布 $q(x'|x)$ 是对称的，即在给定当前状态 $x$ 的情况下提议一个新状态 $x'$ 的概率等于在给定 $x'$ 的情况下提议 $x$ 的概率（即 $q(x'|x) = q(x|x')$）。\n\n假设在模拟的某一步，链的当前状态为 $x = 1.5$。然后，算法提议移动到一个新的候选状态 $x' = 2.0$。\n\n计算此特定移动的接受概率。您的答案应为一个无量纲实数。将您的最终答案四舍五入至四位有效数字。", "solution": "对于从 $x$ 到 $x'$ 的移动，在使用对称提议分布 $q(x'|x)=q(x|x')$ 的情况下，Metropolis 接受概率为\n$$\n\\alpha(x \\to x')=\\min\\left(1,\\frac{\\pi(x')q(x|x')}{\\pi(x)q(x'|x)}\\right)=\\min\\left(1,\\frac{\\pi(x')}{\\pi(x)}\\right).\n$$\n给定目标分布 $\\pi(x)\\propto \\exp(-|x|)$，该比率可简化为\n$$\n\\frac{\\pi(x')}{\\pi(x)}=\\frac{\\exp(-|x'|)}{\\exp(-|x|)}=\\exp\\!\\left(-\\left(|x'|-|x|\\right)\\right).\n$$\n当 $x=1.5$ 且 $x'=2.0$ 时，我们有 $|x|=1.5$ 和 $|x'|=2.0$，所以\n$$\n\\frac{\\pi(x')}{\\pi(x)}=\\exp\\!\\left(-\\left(2.0-1.5\\right)\\right)=\\exp(-0.5).\n$$\n因此，\n$$\n\\alpha(x \\to x')=\\min\\left(1,\\exp(-0.5)\\right)=\\exp(-0.5).\n$$\n数值上，$\\exp(-0.5)\\approx 0.6065$（四舍五入至四位有效数字）。", "answer": "$$\\boxed{0.6065}$$", "id": "1371728"}, {"introduction": "接下来，我们转向另一种强大的 MCMC 方法——吉布斯采样 (Gibbs sampling)。该方法的巧妙之处在于将一个复杂的多维采样问题分解为一系列更简单的一维采样步骤。实现吉布斯采样的关键是为每个变量正确推导出其“全条件分布”，这也是你将在下面的练习中实践的核心技能 [@problem_id:1932854]。", "problem": "吉布斯采样器是一种马尔可夫链蒙特卡洛 (MCMC) 算法，用于生成一系列观测值来近似目标多元概率分布，这在直接采样困难时尤其有用。实现吉布斯采样器的一个关键步骤是推导出模型中每个变量的满条件分布。\n\n考虑一个二元随机向量 $(X, Y)$，其联合概率密度函数 (PDF) $p(x, y)$ 在 $xy$ 平面上的一个三角形区域 $\\mathcal{R}$ 上是均匀的。区域 $\\mathcal{R}$ 由不等式 $x>0$、 $y>0$ 和 $x+y < 1$ 定义。因此，联合 PDF 为：\n$$\np(x, y) =\n\\begin{cases}\n2 & \\text{若 } (x,y) \\in \\mathcal{R} \\\\\n0 & \\text{其他情况}\n\\end{cases}\n$$\n为了构建此分布的吉布斯采样器，我们需要满条件分布 $p(x|y)$ 和 $p(y|x)$。\n\n下列哪个选项正确地指出了这两个条件分布？注意，$\\text{Uniform}(a,b)$ 表示在区间 $(a,b)$ 上的均匀分布。\n\nA: 当 $y \\in (0,1)$ 时，$p(x|y)$ 服从 Uniform$(0, 1-y)$ 分布；当 $x \\in (0,1)$ 时，$p(y|x)$ 服从 Uniform$(0, 1-x)$ 分布。\n\nB: 当 $y \\in (0,1)$ 时，$p(x|y)$ 服从 Uniform$(0, 1)$ 分布；当 $x \\in (0,1)$ 时，$p(y|x)$ 服从 Uniform$(0, 1)$ 分布。\n\nC: 当 $y \\in (0,1)$ 时，$p(x|y)$ 服从 Uniform$(0, y)$ 分布；当 $x \\in (0,1)$ 时，$p(y|x)$ 服从 Uniform$(0, x)$ 分布。\n\nD: 条件分布不是均匀分布。\n\nE: 当 $y \\in (0,1)$ 时，$p(x|y)$ 服从 Uniform$(y, 1)$ 分布；当 $x \\in (0,1)$ 时，$p(y|x)$ 服从 Uniform$(x, 1)$ 分布。", "solution": "给定的联合密度 $p(x,y)$ 在区域 $\\mathcal{R}=\\{(x,y): x>0,\\ y>0,\\ x+y<1\\}$ 上是均匀的，即在 $\\mathcal{R}$ 上 $p(x,y)=2$，在其他地方为 $0$。为了获得满条件分布，我们通过边缘分布使用条件分布的定义。\n\n首先，计算 $Y$ 的边缘密度。对于一个固定的 $y$，当 $0<y<1$ 时，$x$ 的取值范围满足 $0<x<1-y$。因此，\n$$\np_{Y}(y)=\\int_{-\\infty}^{\\infty} p(x,y)\\,dx=\\int_{0}^{1-y} 2\\,dx=2(1-y), \\quad \\text{对于 } 0<y<1,\n$$\n其他情况下 $p_{Y}(y)=0$。\n\n那么，给定 $Y=y$ 时 $X$ 的条件密度为\n$$\np_{X\\mid Y}(x\\mid y)=\\frac{p(x,y)}{p_{Y}(y)}=\\frac{2}{2(1-y)}=\\frac{1}{1-y},\n$$\n该式在 $p(x,y)>0$ 的支撑集上成立，即 $0<x<1-y$ (且 $0<y<1$）。这是在 $(0,1-y)$ 上的均匀分布的密度：\n$$\nX\\mid Y=y \\sim \\text{Uniform}(0,1-y), \\quad \\text{对于 } 0<y<1.\n$$\n\n根据对称性，计算 $X$ 的边缘分布：\n$$\np_{X}(x)=\\int_{-\\infty}^{\\infty} p(x,y)\\,dy=\\int_{0}^{1-x} 2\\,dy=2(1-x), \\quad \\text{对于 } 0<x<1,\n$$\n其他情况下 $p_{X}(x)=0$。\n\n那么，给定 $X=x$ 时 $Y$ 的条件密度为\n$$\np_{Y\\mid X}(y\\mid x)=\\frac{p(x,y)}{p_{X}(x)}=\\frac{2}{2(1-x)}=\\frac{1}{1-x},\n$$\n该式在 $0<y<1-x$ (且 $0<x<1$) 上成立。这是在 $(0,1-x)$ 上的均匀分布：\n$$\nY\\mid X=x \\sim \\text{Uniform}(0,1-x), \\quad \\text{对于 } 0<x<1.\n$$\n\n因此，正确的选项是，两个条件分布都在由约束 $x+y<1$ 决定的各自的截断区间上是均匀的，这对应于选项 A。", "answer": "$$\\boxed{A}$$", "id": "1932854"}, {"introduction": "一个有效的采样器不仅需要正确的实现，还必须能够遍历整个目标分布空间，这一性质称为“不可约性” (irreducibility)。本练习将通过一个思想实验，展示一个表面上看似正确的吉布斯采样器为何会因其转移核的局限性而失效。分析这种失效模式对于培养在 MCMC 应用中诊断和避免常见陷阱的直觉至关重要 [@problem_id:1932797]。", "problem": "一位统计学家正在开发一个马尔可夫链蒙特卡罗 (MCMC) 模拟，用于从一个在二维环形区域上均匀的目标概率分布中抽取样本。该环形区域记为 $A$，定义为笛卡尔平面上满足 $r_1^2 < x^2 + y^2 < r_2^2$ 的点 $(x, y)$ 的集合，其中 $r_1$ 和 $r_2$ 为两个给定的正常数，且 $r_1 < r_2$。\n\n该统计学家决定使用一个分量式吉布斯采样器。在每一步 $t$，采样器通过以下两个子步骤从当前状态 $(x_t, y_t)$ 生成一个新状态 $(x_{t+1}, y_{t+1})$：\n1.  从满条件分布 $p(x | y=y_t)$ 中抽取一个新值 $x_{t+1}$。\n2.  从满条件分布 $p(y | x=x_{t+1})$ 中抽取一个新值 $y_{t+1}$。\n\n然而，该采样器的具体实现有一个细微的缺陷。当从一个其支撑集由两个不相交的区间（一个为正，一个为负）组成的条件分布中采样时，采样器的行为取决于该坐标前一个值的符号。例如，为了在给定 $y_t$ 的情况下采样 $x_{t+1}$，该实现会检查前一个值 $x_t$ 的符号。如果 $x_t > 0$，它将只从条件支撑集的正区域中采样新的 $x_{t+1}$。如果 $x_t < 0$，它将只从负区域中采样。在采样 $y_{t+1}$ 时，会应用一个基于 $y_t$ 符号的类似规则。（假设采样器在初始化或转移时，状态坐标永远不会恰好为零）。\n\n采样器在一个位于环形区域第一象限的点 $(x_0, y_0)$（即 $x_0 > 0$ 且 $y_0 > 0$）上被初始化。在运行采样器非常多次迭代之后，下列哪个陈述最能描述所得的采样点集合？\n\nA. 样本将正确地近似整个环形区域 $A$ 上的均匀分布。\n\nB. 样本将近似环形区域在第一象限部分上的均匀分布，即由 $A \\cap \\{ (x,y) \\mid x>0, y>0 \\}$ 定义的区域。\n\nC. 样本将被限制在第一象限，但由于坐标轴对齐的移动，它们的分布将是非均匀的，并会集中在边界 $x=y$ 附近。\n\nD. 样本将收敛到环形区域上半部分的均匀分布，即由 $A \\cap \\{ (x,y) \\mid y>0 \\}$ 定义的区域。\n\nE. 该链最终会卡在一个不动点上，并停止生成新的、不同的样本。", "solution": "该问题要求我们确定一个有缺陷的吉布斯采样器的长期行为，该采样器旨在从环形区域 $A = \\{(x, y) \\mid r_1^2 < x^2 + y^2 < r_2^2\\}$ 上的均匀分布中采样。\n\n首先，让我们分析一个正确的吉布斯采样器所需的真实条件分布。目标概率密度函数 (PDF) 为 $\\pi(x,y) = C$ 对于 $(x,y) \\in A$，在其他情况下为 $0$，其中 $C = 1/(\\pi(r_2^2 - r_1^2))$ 是归一化常数。\n\n给定 $y$ 时 $x$ 的满条件分布可以通过将 $\\pi(x,y)$ 视为关于 $x$ 的函数（对于固定的 $y$）来找到：\n$p(x|y) \\propto \\pi(x,y) \\propto \\mathbf{1}_{r_1^2 < x^2+y^2 < r_2^2}$，其中 $\\mathbf{1}$ 是指示函数。\n这等价于 $p(x|y)$ 在满足 $r_1^2 - y^2 < x^2 < r_2^2 - y^2$ 的 $x$ 值集合上是均匀的。\n\n让我们分析一下这个条件分布的支撑集：\n- 如果 $|y| \\ge r_2$，没有 $x$ 满足该不等式，所以支撑集为空。\n- 如果 $r_1 \\le |y| < r_2$，条件变为 $x^2 < r_2^2 - y^2$。$x$ 的支撑集是一个单一的连通区间：$(-\\sqrt{r_2^2 - y^2}, \\sqrt{r_2^2 - y^2})$。\n- 如果 $|y| < r_1$，条件为 $\\sqrt{r_1^2 - y^2} < |x| < \\sqrt{r_2^2 - y^2}$。$x$ 的支撑集是两个不相交区间的并集：$(-\\sqrt{r_2^2 - y^2}, -\\sqrt{r_1^2 - y^2}) \\cup (\\sqrt{r_1^2 - y^2}, \\sqrt{r_2^2 - y^2})$。\n\n对于条件分布 $p(y|x)$，一个对称的分析同样成立。\n\n现在，让我们考虑这个有缺陷的采样器。缺陷在于，当条件支撑集不相交时，采样器会将其自身限制在与该坐标前一个值符号相匹配的分量上。采样器从 $x_0 > 0$ 和 $y_0 > 0$ 的点 $(x_0, y_0)$ 开始。\n\n设第 $t$ 次迭代时的状态为 $(x_t, y_t)$，并为进行归纳，假设 $x_t > 0$ 且 $y_t > 0$。\n1.  **从 $p(x | y_t)$ 中采样 $x_{t+1}$：**\n    采样器必须抽取一个新的 $x_{t+1}$。实现的缺陷决定了，由于 $x_t > 0$，采样器将只从 $p(x|y_t)$ 的支撑集的正部选择一个值。无论支撑集是一个区间还是两个区间，其正部仅包含 $x$ 的正值。因此，新的样本 $x_{t+1}$ 必须为正。此时状态为 $(x_{t+1}, y_t)$，其中 $x_{t+1} > 0$ 且 $y_t > 0$。\n\n2.  **从 $p(y | x_{t+1})$ 中采样 $y_{t+1}$：**\n    采样器必须抽取一个新的 $y_{t+1}$。由于前一个值 $y_t$ 为正，有缺陷的实现将只从 $p(y|x_{t+1})$ 支撑集的正部选择一个值。因此，新的样本 $y_{t+1}$ 必须为正。\n\n该次迭代的最终状态是 $(x_{t+1}, y_{t+1})$，其中两个分量都为正。根据归纳法，如果采样器从第一象限（$x>0, y>0$）开始，所有后续的样本也将在第一象限。\n\n这意味着马尔可夫链被限制在区域 $A_{++} = A \\cap \\{ (x,y) \\mid x>0, y>0 \\}$ 内。由于该链无法从 $A_{++}$ 转移到环形区域的任何其他部分（例如，第二象限的部分），它在整个状态空间 $A$ 上不是不可约的。一个非不可约的链无法收敛到整个状态空间上的目标分布。因此，选项A是错误的。\n\n现在我们必须确定采样器在可达集 $A_{++}$ *内部*的行为。让我们定义一个新的目标分布 $\\pi_{++}(x,y)$，它在 $A_{++}$ 上是均匀的。对于这个新目标，条件分布 $p_{++}(x|y)$ 在满足 $(x,y) \\in A_{++}$ 的 $x>0$ 集合上是均匀的。这恰好是当 $x_t > 0$ 时我们有缺陷的采样器所抽样的分布。类似地，条件分布 $p_{++}(y|x)$ 是当 $y_t > 0$ 时有缺陷的采样器所抽样的分布。\n\n因此，当被限制在第一象限时，这个有缺陷的采样器实际上是针对目标分布 $\\pi_{++}(x,y)$（在 $A_{++}$ 上均匀）的一个*正确的*吉布斯采样器。由于这是一个在连通区域上的有效吉布斯采样器，它将收敛到其平稳分布，即 $\\pi_{++}$。因此，收集到的样本将近似于环形区域在第一象限部分上的均匀分布。这对应于选项B。\n\n让我们评估其他选项：\n- C：采样器从其条件分布中进行均匀抽取。没有任何机制会导致样本在象限内以非均匀的方式集中。在可达集上的极限分布将是均匀的。\n- D：采样器被限制在第一象限，而不是整个环形区域的上半部分，因为 $x$ 的符号也被保留了。它无法到达上半部分中 $x<0$ 的区域。\n- E：抽样是从连续区间中概率性地进行的，所以链不会卡在单一的不动点上。它将继续探索整个区域 $A_{++}$。\n\n因此，对采样器长期行为的唯一正确描述是，它将探索环形区域在第一象限的部分并从中进行均匀采样。", "answer": "$$\\boxed{B}$$", "id": "1932797"}]}