{"hands_on_practices": [{"introduction": "贝叶斯推断的核心在于利用观测数据更新我们对未知参数的信念。本练习通过一个流行病学的情景，让您实践这一核心过程 [@problem_id:1379681]。我们将为一个泊松分布的率参数 $\\lambda$ 设定一个伽马先验分布，并基于几周的新增病例数据，推导出其后验分布，这展示了共轭先验在简化贝叶斯计算中的强大作用。", "problem": "一位流行病学家正在研究一种新发现的病毒在某特定城市的传播情况。每周报告的新增病例数假定服从一个泊松分布，其平均速率参数 $\\lambda$ 未知。根据对其他地区类似病毒的初步研究，该流行病学家对 $\\lambda$ 的先验信念由一个伽马分布 $\\text{Gamma}(\\alpha, \\beta)$ 建模。该先验分布的概率密度函数由下式给出：\n$$p(\\lambda) = \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} \\lambda^{\\alpha-1} \\exp(-\\beta \\lambda)$$\n对于 $\\lambda > 0$，其中 $\\Gamma(\\alpha)$ 是伽马函数。对于这种特定的病毒，该流行病学家设定先验参数为 $\\alpha=3$ 和 $\\beta=2$。\n\n在连续四周的时间里，观察到以下新增病例数：$k_1=7, k_2=4, k_3=10, k_4=5$。假定每周的病例数是独立事件，请确定在给定观测数据的情况下，速率参数 $\\lambda$ 的完整后验概率密度函数。请将您的答案表示为 $\\lambda$ 的函数。", "solution": "设给定速率参数 $\\lambda$ 时，每周的计数被建模为独立的泊松随机变量，因此对于单次观测 $k$，其似然函数为\n$$\np(k \\mid \\lambda)=\\frac{\\lambda^{k}\\exp(-\\lambda)}{k!}.\n$$\n对于有观测值 $k_{1},\\dots,k_{n}$ 的 $n$ 个独立周，其联合似然函数为\n$$\nL(\\lambda \\mid k_{1},\\dots,k_{n})=\\prod_{i=1}^{n}\\frac{\\lambda^{k_{i}}\\exp(-\\lambda)}{k_{i}!}=\\left(\\prod_{i=1}^{n}\\frac{1}{k_{i}!}\\right)\\lambda^{\\sum_{i=1}^{n}k_{i}}\\exp(-n\\lambda).\n$$\n$\\lambda$ 的先验分布是 $\\text{Gamma}(\\alpha,\\beta)$，其密度函数为\n$$\np(\\lambda)=\\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)}\\lambda^{\\alpha-1}\\exp(-\\beta\\lambda),\\quad \\lambda>0.\n$$\n根据贝叶斯定理，后验密度与似然函数和先验的乘积成正比：\n$$\np(\\lambda \\mid k_{1},\\dots,k_{n})\\propto \\lambda^{\\sum_{i=1}^{n}k_{i}}\\exp(-n\\lambda)\\cdot \\lambda^{\\alpha-1}\\exp(-\\beta\\lambda)=\\lambda^{\\alpha-1+\\sum_{i=1}^{n}k_{i}}\\exp\\bigl(-(\\beta+n)\\lambda\\bigr).\n$$\n这是一个伽马分布的核，其更新后的参数为\n$$\n\\alpha^{\\prime}=\\alpha+\\sum_{i=1}^{n}k_{i},\\qquad \\beta^{\\prime}=\\beta+n.\n$$\n因此，归一化的后验分布为\n$$\np(\\lambda \\mid k_{1},\\dots,k_{n})=\\frac{{\\beta^{\\prime}}^{\\alpha^{\\prime}}}{\\Gamma(\\alpha^{\\prime})}\\lambda^{\\alpha^{\\prime}-1}\\exp(-\\beta^{\\prime}\\lambda),\\quad \\lambda>0.\n$$\n对于给定的数据，$\\alpha=3$，$\\beta=2$，$n=4$，且 $\\sum_{i=1}^{4}k_{i}=7+4+10+5=26$，因此\n$$\n\\alpha^{\\prime}=3+26=29,\\qquad \\beta^{\\prime}=2+4=6,\n$$\n所以完整的后验密度函数为\n$$\np(\\lambda \\mid k_{1}=7,k_{2}=4,k_{3}=10,k_{4}=5)=\\frac{6^{29}}{\\Gamma(29)}\\lambda^{28}\\exp(-6\\lambda),\\quad \\lambda>0.\n$$", "answer": "$$\\boxed{\\frac{6^{29}}{\\Gamma(29)}\\,\\lambda^{28}\\,\\exp(-6\\lambda)}$$", "id": "1379681"}, {"introduction": "统计推断领域存在两大主要学派：频率学派和贝叶斯学派，它们对如何从数据中估计未知参数有着不同的看法。本练习旨在阐明这两种方法的差异 [@problem_id:1379693]。您将分别计算一个未知成功概率 $\\theta$ 的最大似然估计和后验均值，通过比较二者，您会发现即使在“无信息”的先验假设下，贝叶斯方法如何提供一个与频率学派方法有细微但重要区别的平滑估计。", "problem": "一位材料科学家正在研究一种新合成的半导体材料。一个注入该材料的电子成功穿过势垒的概率（记为 $\\theta$）是未知的。根据该材料的理论设计，该科学家对 $\\theta$ 的任何特定值没有先验偏好，因此假设 $\\theta$ 在区间 $[0, 1]$ 上服从均匀先验概率分布。\n\n在一个实验中，将 $N$ 个电子独立地注入该材料，观察到其中恰好有 $k$ 个成功穿过势垒，其中 $0 < k < N$。\n\n基于这一实验结果，提出了两种方法来估计 $\\theta$ 的值。\n\n1.  **方法 A**：找到使在 $N$ 次试验中观察到 $k$ 次成功的实验结果的概率最大化的 $\\theta$ 值。将此估计值记为 $\\hat{\\theta}_{A}$。\n2.  **方法 B**：首先，确定给定实验数据下 $\\theta$ 的更新（后验）概率分布。然后，计算 $\\theta$ 关于这个新分布的期望值。将此估计值记为 $\\hat{\\theta}_{B}$。\n\n确定这两个估计值之差 $\\hat{\\theta}_{B} - \\hat{\\theta}_{A}$。将你的最终答案表示为以 $N$ 和 $k$ 表示的单个闭式表达式。", "solution": "我们将成功概率为 $\\theta$ 的 $N$ 次独立试验中的成功次数 $k$ 建模为二项分布结果。观察到恰好 $k$ 次成功的似然函数为\n$$\nL(\\theta)\\propto \\binom{N}{k}\\,\\theta^{k}\\left(1-\\theta\\right)^{N-k}.\n$$\n方法 A 要求找到使该似然函数最大化的值。由于 $\\binom{N}{k}$ 不依赖于 $\\theta$，我们在 $(0,1)$ 上最大化 $f(\\theta)=\\theta^{k}(1-\\theta)^{N-k}$。对 $\\ln f(\\theta)=k\\ln\\theta+(N-k)\\ln(1-\\theta)$ 求导并令其为零，可得\n$$\n\\frac{d}{d\\theta}\\ln f(\\theta)=\\frac{k}{\\theta}-\\frac{N-k}{1-\\theta}=0\n\\;\\;\\Longrightarrow\\;\\;\nk(1-\\theta)=(N-k)\\theta\n\\;\\;\\Longrightarrow\\;\\;\n\\hat{\\theta}_{A}=\\frac{k}{N},\n$$\n对于 $0<k<N$，这是一个内部最大值。\n\n对于方法 B，由于在 $[0,1]$ 上有均匀先验，该先验分布为 $\\operatorname{Beta}(1,1)$。给定 $k$ 次成功和 $N-k$ 次失败，后验分布为\n$$\n\\theta\\mid k,N \\sim \\operatorname{Beta}(k+1,\\,N-k+1),\n$$\n因为后验密度与 $\\theta^{k}(1-\\theta)^{N-k}$ 成正比。后验均值为\n$$\n\\hat{\\theta}_{B}=\\mathbb{E}[\\theta\\mid k,N]=\\frac{k+1}{(k+1)+(N-k+1)}=\\frac{k+1}{N+2}.\n$$\n因此，差值为\n$$\n\\hat{\\theta}_{B}-\\hat{\\theta}_{A}\n=\\frac{k+1}{N+2}-\\frac{k}{N}\n=\\frac{N(k+1)-k(N+2)}{N(N+2)}\n=\\frac{Nk+N-kN-2k}{N(N+2)}\n=\\frac{N-2k}{N(N+2)}.\n$$", "answer": "$$\\boxed{\\frac{N-2k}{N(N+2)}}$$", "id": "1379693"}, {"introduction": "前面的练习处理的是连续参数，而许多现实世界的问题涉及对离散量（如总体中的个体数量）的估计。本练习将带您进入生态学中的一个经典情景——使用“捕捉-再捕捉”数据来估计一个未知种群的总数 $N$ [@problem_id:1379716]。您将应用贝叶斯框架处理一个超几何似然函数，并学习如何找到离散参数 $N$ 的最大后验（MAP）估计，这是一种在处理复杂模型时非常实用的技术。", "problem": "一位生态学家正在尝试估计一个孤立植物保护区内，一种稀有且难以捉摸的萤火虫物种的总种群数量 $N$。$N$ 的真实值是未知的。为了估计这个数值，她进行了一项捕捉-再捕捉实验。\n\n在实验的第一阶段，她捕捉、用无害的荧光标记物进行标记，然后释放了 $M = 100$ 只萤火虫。被标记的萤火虫有足够的时间与整个种群完全混合。\n\n在第二阶段，她捕捉了一个数量为 $k = 80$ 的新萤火虫样本。经过检查，她发现其中有 $r = 10$ 只萤火虫是被标记过的。\n\n该生态学家假设，在一个总数为 $N$、其中有 $M$ 个被标记个体的种群中，从一个大小为 $k$ 的样本里捕捉到 $r$ 只被标记萤火虫的概率，服从超几何分布。根据在相似生态系统中的研究发现，她对总种群数量 $N$ 采用了一个弱信息先验。对于所有物理上可能的 $N$ 的整数值，其先验概率被设为与 $1/N$ 成正比，即 $P(N) \\propto 1/N$。\n\n确定种群数量 $N$ 的后验众数。这个值也被称为最大后验（MAP）估计。你的答案应该是一个整数。", "solution": "我们用 $N$ 表示未知的总种群数量，并使用给定的捕捉-再捕捉数据：初始标记数量 $M=100$，第二次样本大小 $k=80$，其中有 $r=10$ 只被标记的个体被再次捕获。在超几何模型下，给定 $N$，在第二次抽样中观测到 $r$ 个标记个体的似然函数为\n$$\nP(r \\mid N,M,k)=\\frac{\\binom{M}{r}\\binom{N-M}{k-r}}{\\binom{N}{k}},\n$$\n其支撑集被限制在使组合项有定义的 $N$ 值上。特别地，为了使观测到的 $r$ 成为可能，必须有 $N-M \\geq k-r$，即 $N \\geq M+k-r=100+80-10=170$，并且还需满足 $N \\geq \\max\\{M,k\\}$；具有约束力的下界是 $N \\geq 170$。\n\n先验分布为 $P(N)\\propto 1/N$，定义在物理上可能的整数上。因此，在忽略一个与 $N$ 无关的归一化常数的情况下，后验分布为\n$$\n\\pi(N \\mid r,M,k)\\ \\propto\\ \\frac{1}{N}\\cdot \\frac{\\binom{M}{r}\\binom{N-M}{k-r}}{\\binom{N}{k}}。\n$$\n由于 $\\binom{M}{r}$ 不依赖于 $N$，MAP估计量旨在将以下函数在整数 $N \\geq 170$ 上最大化：\n$$\nf(N)\\ =\\ \\frac{1}{N}\\cdot \\frac{\\binom{N-M}{k-r}}{\\binom{N}{k}}。\n$$\n\n为了找到整数众数，我们分析比值 $f(N+1)/f(N)$。使用恒等式 $\\binom{n+1}{t}/\\binom{n}{t}=(n+1)/(n+1-t)$，我们得到\n$$\n\\frac{f(N+1)}{f(N)}=\\frac{N}{N+1}\\cdot \\frac{\\binom{N+1-M}{k-r}}{\\binom{N-M}{k-r}}\\cdot \\frac{\\binom{N}{k}}{\\binom{N+1}{k}}\n=\\frac{N}{N+1}\\cdot \\frac{N+1-M}{N+1-M-(k-r)}\\cdot \\frac{N+1-k}{N+1}。\n$$\n代入 $M=100$, $k=80$, $r=10$ 得到\n$$\n\\frac{f(N+1)}{f(N)}=\\frac{N}{N+1}\\cdot \\frac{N-99}{N-169}\\cdot \\frac{N-79}{N+1}\n=\\frac{N\\,(N-99)\\,(N-79)}{(N+1)^{2}\\,(N-169)},\n$$\n该式对 $N \\geq 170$ 成立。\n\n当 $\\frac{f(N+1)}{f(N)} \\geq 1$ 时，序列 $f(N)$ 在 $N$ 处递增；当此比值小于 1 时，序列递减。因此，转折点发生在以下条件处：\n$$\nN\\,(N-99)\\,(N-79)\\ \\geq\\ (N+1)^{2}\\,(N-169).\n$$\n展开两边，\n$$\nN\\,(N-99)\\,(N-79)=N^{3}-178N^{2}+7821N,\n$$\n$$\n(N+1)^{2}\\,(N-169)=N^{3}-167N^{2}-337N-169.\n$$\n将所有项移到一边，得到\n$$\nN^{3}-178N^{2}+7821N-\\bigl(N^{3}-167N^{2}-337N-169\\bigr)\\ \\geq\\ 0,\n$$\n可化简为以下二次不等式\n$$\n-11N^{2}+8158N+169\\ \\geq\\ 0\n\\quad\\Longleftrightarrow\\quad\n11N^{2}-8158N-169\\ \\leq\\ 0.\n$$\n设 $11N^{2}-8158N-169=0$ 的较大根为 $N_{+}$。那么对于整数 $N \\leq \\lfloor N_{+}\\rfloor$，有 $\\frac{f(N+1)}{f(N)}\\geq 1$；对于 $N \\geq \\lfloor N_{+}\\rfloor+1$，有 $\\frac{f(N+1)}{f(N)}<1$。在两个连续整数 $741$ 和 $742$ 处求值以验证转折点：\n$$\n11\\cdot 741^{2}-8158\\cdot 741-169=-5356<0\\quad\\Rightarrow\\quad \\frac{f(742)}{f(741)}>1,\n$$\n$$\n11\\cdot 742^{2}-8158\\cdot 742-169=2799>0\\quad\\Rightarrow\\quad \\frac{f(743)}{f(742)}<1.\n$$\n因此，$f(N)$ 在 $N=742$ 之前递增，之后递减。由于支撑集从 $N=170$ 开始，唯一的后验众数（MAP）是\n$$\nN_{\\text{MAP}}=742.\n$$", "answer": "$$\\boxed{742}$$", "id": "1379716"}]}