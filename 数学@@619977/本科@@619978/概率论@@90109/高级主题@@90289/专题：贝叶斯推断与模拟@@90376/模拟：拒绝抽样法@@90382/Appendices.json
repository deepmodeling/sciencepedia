{"hands_on_practices": [{"introduction": "让我们从一个基本练习开始，来掌握拒绝采样的核心机制。这个练习将带你使用一个简单的均匀分布（我们的提议分布）来从一个更复杂的Beta分布（我们的目标分布）中生成样本。关键在于理解如何确定一个关键常数$M$，并计算出采样过程的理论效率，这是衡量采样器性能的第一个重要指标。[@problem_id:1387131]", "problem": "一位数据科学家正在实现一个拒绝采样算法，用于生成服从特定目标分布的随机数。目标分布是参数为 $\\alpha = 2$ 和 $\\beta = 2$ 的Beta分布。该目标分布的概率密度函数 (PDF) 记为 $f(x)$，由下式给出：\n$$f(x) = 6x(1-x) \\quad \\text{for } x \\in [0, 1]$$\n否则 $f(x) = 0$。\n\n对于提议分布，该数据科学家使用标准均匀分布 U(0, 1)。该提议分布的PDF记为 $g(x)$，为：\n$$g(x) = 1 \\quad \\text{for } x \\in [0, 1]$$\n否则 $g(x) = 0$。\n\n拒绝采样方法需要找到一个常数 $M$，使得不等式 $f(x) \\le M g(x)$ 对所有可能的 $x$ 值都成立。为了最大化采样过程的效率，选择 $M$ 的最小可能值。然后，该算法从提议分布 $g(x)$ 中生成一个样本 $Y$，并以概率 $\\frac{f(Y)}{M g(Y)}$ 接受该样本。\n\n计算从提议分布中抽取的样本被接受的总理论概率。将你的答案表示为一个精确分数。", "solution": "我们需要找到最小的常数 $M$，使得对所有 $x$ 都有 $f(x) \\le M g(x)$。因为对于 $x \\in [0,1]$ 有 $g(x)=1$，而在其他情况下 $g(x)=0$，所以该条件在 $[0,1]$ 上简化为 $f(x) \\le M$。因此，最小的允许值 $M$ 是 $f(x)$ 在 $[0,1]$ 上的上确界。\n\n计算 $f(x)=6x(1-x)=6(x - x^{2})$ 在 $[0,1]$ 上的最大值。求导：\n$$\nf'(x)=6(1-2x), \\quad f''(x)=-12.\n$$\n令 $f'(x)=0$ 得到 $x=\\frac{1}{2}$。因为 $f''(x)<0$，所以这是一个最大值。计算\n$$\nM=\\max_{x \\in [0,1]} f(x)=f\\!\\left(\\tfrac{1}{2}\\right)=6 \\cdot \\tfrac{1}{2} \\cdot \\left(1-\\tfrac{1}{2}\\right)=\\frac{3}{2}.\n$$\n\n给定 $Y \\sim g$，在 $Y=y$ 条件下的接受概率是 $\\frac{f(y)}{M g(y)}$。总的接受概率是在分布 $g$ 下的期望值：\n$$\n\\mathbb{P}(\\text{accept})=\\mathbb{E}_{g}\\!\\left[\\frac{f(Y)}{M g(Y)}\\right]=\\int_{0}^{1} \\frac{f(x)}{M g(x)} g(x) \\, dx=\\frac{1}{M} \\int_{0}^{1} f(x) \\, dx.\n$$\n因为 $f$ 是 $[0,1]$ 上的一个概率密度函数，所以 $\\int_{0}^{1} f(x) \\, dx=1$。为完整起见：\n$$\n\\int_{0}^{1} 6x(1-x)\\,dx=6 \\int_{0}^{1} \\left(x - x^{2}\\right) dx=6 \\left(\\frac{1}{2}-\\frac{1}{3}\\right)=1.\n$$\n因此，\n$$\n\\mathbb{P}(\\text{accept})=\\frac{1}{M}=\\frac{1}{\\frac{3}{2}}=\\frac{2}{3}.\n$$", "answer": "$$\\boxed{\\frac{2}{3}}$$", "id": "1387131"}, {"introduction": "现在，让我们将拒绝采样的原理从连续世界应用到离散世界。在这个练习中，你将使用一个公平的骰子来模拟一个有偏倚的骰子，这在计算机模拟中非常常见。这个问题的精妙之处不仅在于应用算法，更在于你需要对它进行优化，通过巧妙设计接受概率来最大化整体的成功率。[@problem_id:1387122]", "problem": "一个计算机模拟需要根据目标概率分布 $P$ 从集合 $\\{1, 2, 3\\}$ 中生成随机整数，其中 $P(X=1) = 0.5$，$P(X=2) = 0.3$，$P(X=3) = 0.2$。唯一可用的随机数生成器是一个模拟公平六面骰子的函数，它以均匀概率返回一个来自集合 $\\{1, 2, 3, 4, 5, 6\\}$ 的整数。\n\n一位工程师设计了以下两步过程来从目标分布 $P$ 生成一个数：\n**第1步 (提议):** 使用公平六面骰子模拟器生成一个数 $y$。\n**第2步 (接受/拒绝):**\n- 如果 $y=1$，以概率 $c_1$ 接受该提议。\n- 如果 $y=2$，以概率 $c_2$ 接受该提议。\n- 如果 $y=3$，以概率 $c_3$ 接受该提议。\n- 如果 $y \\in \\{4, 5, 6\\}$，则总是拒绝该提议 (接受概率为0)。\n如果提议被接受，则过程终止并返回值 $y$。如果被拒绝，则过程从第1步重新开始。\n\n必须选择概率 $c_1, c_2, c_3$ 以满足以下两个条件：\n1. 被接受的数的分布必须与目标分布 $P$ 相匹配。\n2. 在两步过程的单次运行中接受一个提议的总概率必须被最大化。\n\n在这个最优配置的过程中，单次运行接受一个提议的总概率是多少？请用最简分数形式表示你的答案。", "solution": "设提议分布为 $q(y)$，其中对于 $i\\in\\{1,2,3,4,5,6\\}$，$q(i)=\\frac{1}{6}$。设对于 $i\\in\\{1,2,3\\}$，$c_i$ 是 $y=i$ 时的接受概率，而对于 $i\\in\\{4,5,6\\}$，$c_i=0$。单次运行的总体接受概率为\n$$\nA=\\sum_{i=1}^{3} q(i)c_{i}=\\frac{1}{6}\\left(c_{1}+c_{2}+c_{3}\\right).\n$$\n条件1要求被接受值的分布与目标分布 $P$ 匹配，即对于 $i\\in\\{1,2,3\\}$，\n$$\nP_{i}=\\frac{q(i)c_{i}}{A} \\quad\\Longrightarrow\\quad c_{i}=\\frac{A P_{i}}{q(i)}.\n$$\n由于接受概率必须满足 $0\\leq c_{i}\\leq 1$，我们得到以下约束条件\n$$\n\\frac{A P_{i}}{q(i)}\\leq 1 \\quad\\Longrightarrow\\quad A\\leq \\frac{q(i)}{P_{i}} \\quad (i=1,2,3).\n$$\n因此，最大可行 $A$ 为\n$$\nA_{\\max}=\\min_{i\\in\\{1,2,3\\}} \\frac{q(i)}{P_{i}}.\n$$\n已知 $q(i)=\\frac{1}{6}$ 且 $P_{1}=\\frac{1}{2}$，$P_{2}=\\frac{3}{10}$，$P_{3}=\\frac{1}{5}$，\n$$\n\\frac{q(1)}{P_{1}}=\\frac{1/6}{1/2}=\\frac{1}{3},\\quad \\frac{q(2)}{P_{2}}=\\frac{1/6}{3/10}=\\frac{5}{9},\\quad \\frac{q(3)}{P_{3}}=\\frac{1/6}{1/5}=\\frac{5}{6}.\n$$\n因此\n$$\nA_{\\max}=\\min\\left\\{\\frac{1}{3},\\frac{5}{9},\\frac{5}{6}\\right\\}=\\frac{1}{3}.\n$$\n为完整起见，相应的接受概率为\n$$\nc_{i}=\\frac{A_{\\max} P_{i}}{q(i)}=6 A_{\\max} P_{i}=2 P_{i},\n$$\n得出 $c_{1}=1$，$c_{2}=\\frac{3}{5}$，$c_{3}=\\frac{2}{5}$，均在 $[0,1]$ 范围内。因此，在最优配置下，单次运行的总体接受概率为 $\\frac{1}{3}$。", "answer": "$$\\boxed{\\frac{1}{3}}$$", "id": "1387122"}, {"introduction": "通过前面的练习，你已经学会了如何构建并评估一个拒绝采样器。现在，让我们来挑战一个“逆向工程”问题。在这个场景中，你已经知道了采样器的最终效率，任务是反向推导出所使用的提议分布的关键参数。[@problem_id:1387104] 这种练习能极大地加深你对提议分布的选择、常数$M$的计算以及采样效率之间内在联系的理解。", "problem": "在一项材料科学应用的蒙特卡洛模拟中，需要在长度为 $L$ 的一维晶体结构内生成随机的缺陷位置 $x$。在区间 $[0, L]$ 上，这些位置所期望的目标概率密度函数 (PDF) 为 $f(x) = A \\sin(\\frac{\\pi x}{L})$，其中 $A$ 是相应的归一化常数。\n\n一位工程师采用拒绝采样算法来生成这些随机变量。提议分布 $g(x)$ 是在区间 $[0, b]$ 上的一个均匀分布。为使采样过程有效，$g(x)$ 的支撑集必须包含 $f(x)$ 的支撑集。该工程师设计了一个最优拒绝采样器，这意味着对于所选的 $g(x)$，接受条件 $f(x) \\le M g(x)$ 中的常数 $M$ 被选为可能的最小值，从而最大化采样器的效率。\n\n实现后，测量得到的效率（接受一个提议样本的总概率）为 $\\eta = 0.625$。已知晶体结构的长度为 $L = 5.0$ 米，请确定均匀提议分布区间的宽度 $b$。\n\n答案以米为单位，并四舍五入到三位有效数字。", "solution": "目标密度在 $[0,L]$ 上为 $f(x)=A\\sin\\!\\left(\\frac{\\pi x}{L}\\right)$。对 $f$ 进行归一化需要\n$$\n\\int_{0}^{L} A \\sin\\!\\left(\\frac{\\pi x}{L}\\right)\\,dx = 1.\n$$\n计算该积分：\n$$\n\\int_{0}^{L} \\sin\\!\\left(\\frac{\\pi x}{L}\\right)\\,dx = \\left[-\\frac{L}{\\pi}\\cos\\!\\left(\\frac{\\pi x}{L}\\right)\\right]_{0}^{L} = -\\frac{L}{\\pi}\\left(\\cos(\\pi)-\\cos(0)\\right)=\\frac{2L}{\\pi}.\n$$\n因此 $A \\cdot \\frac{2L}{\\pi}=1$，得到\n$$\nA=\\frac{\\pi}{2L}.\n$$\n因此 $f_{\\max}=\\max_{x\\in[0,L]} f(x)=A=\\frac{\\pi}{2L}$，在 $x=\\frac{L}{2}$ 处取得。\n\n提议分布是在 $[0,b]$ 上的 $g(x)=\\frac{1}{b}$，其支撑集条件要求 $b\\geq L$。最优拒绝常数为\n$$\nM=\\sup_{x}\\frac{f(x)}{g(x)}=\\frac{f_{\\max}}{1/b}=b\\,f_{\\max}=\\frac{\\pi b}{2L}.\n$$\n对于一个最优拒绝采样器，接受效率为\n$$\n\\eta=\\int g(x)\\,\\frac{f(x)}{M g(x)}\\,dx=\\frac{1}{M}\\int f(x)\\,dx=\\frac{1}{M},\n$$\n因为 $f$ 是归一化的。所以\n$$\n\\eta=\\frac{2L}{\\pi b}\\quad\\Longrightarrow\\quad b=\\frac{2L}{\\pi \\eta}.\n$$\n当 $L=5.0$ 且 $\\eta=0.625$ 时，可得出\n$$\nb=\\frac{2\\cdot 5.0}{\\pi\\cdot 0.625}=\\frac{16}{\\pi}\\approx 5.092958\\ldots\n$$\n四舍五入到三位有效数字，得到 $b=5.09$。", "answer": "$$\\boxed{5.09}$$", "id": "1387104"}]}