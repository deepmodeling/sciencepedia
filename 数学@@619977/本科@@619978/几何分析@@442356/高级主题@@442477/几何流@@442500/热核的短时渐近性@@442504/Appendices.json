{"hands_on_practices": [{"introduction": "第一个非平凡热系数与标量曲率之间的关系，$a_{1}(p) = \\frac{1}{6} R(p)$，是热核短时渐近理论的基石。本练习将超越仅仅陈述这一事实，引导您使用法坐标系从第一性原理出发，完整地推导出这个公式 `[@problem_id:3061913]`。通过求解输运方程，您将亲手揭示流形的曲率如何直接影响热扩散的局部行为，从而获得深刻的理解。", "problem": "设 $M$ 是一个光滑 $n$ 维黎曼流形，其黎曼度量为 $g$，并设 $\\Delta$ 表示光滑函数上的 Laplace–Beltrami 算子（LBO）。热核 $K(t,x,y)$ 是热偏微分方程（PDE）$\\partial_{t} K(t,x,y) = \\Delta_{x} K(t,x,y)$ 的基本解，其初始条件为 $\\lim_{t \\to 0^{+}} K(t,x,y) = \\delta_{y}(x)$，其中 $\\delta_{y}$ 是在 $y$ 点的 Dirac 分布。固定一点 $p \\in M$，并选择以 $p$ 为中心的正规坐标系 $x = (x^{1},\\dots,x^{n})$，使得 $x=0$ 对应于 $p$ 且 $g_{ij}(0) = \\delta_{ij}$。考虑在 $p$ 点的热核的短时对角渐近展开式，其形式为\n$$\nK(t,p,p) \\sim (4\\pi t)^{-n/2} \\left( a_{0}(p) + t\\, a_{1}(p) + o(t) \\right) \\quad \\text{当 } t \\to 0^{+} \\text{ 时}.\n$$\n从 Laplace–Beltrami 算子的定义 $\\Delta f = \\frac{1}{\\sqrt{\\det g}}\\, \\partial_{i} \\!\\left( \\sqrt{\\det g}\\, g^{ij} \\partial_{j} f \\right)$ 以及在正规坐标系下欧几里得热核的启发，通过构造一个局部拟基本解并匹配各项来推导第一个非平凡的对角系数 $a_{1}(p)$。您必须从 $p$ 点附近的正规坐标展开式和基本恒等式出发进行计算，不得调用已有的热核系数公式。您可以使用以下在 $p$ 点周围的正规坐标系中经过验证的局部展开式：\n- 度量和逆度量到二阶：\n$$\ng_{ij}(x) = \\delta_{ij} - \\frac{1}{3}\\, R_{ikjl}(p)\\, x^{k} x^{l} + O(|x|^{3}), \\qquad\ng^{ij}(x) = \\delta_{ij} + \\frac{1}{3}\\, R^{i}{}_{k}{}^{j}{}_{l}(p)\\, x^{k} x^{l} + O(|x|^{3}),\n$$\n其中 $R_{ikjl}$ 是 $p$ 点的黎曼曲率张量，指标的上升和下降使用 $g(p)$。\n- 体积密度到二阶：\n$$\n\\sqrt{\\det g(x)} = 1 - \\frac{1}{6}\\, R_{ij}(p)\\, x^{i} x^{j} + O(|x|^{3}),\n$$\n其中 $R_{ij}$ 是 $p$ 点的 Ricci 曲率张量。\n- 平方测地距离函数 $\\sigma(x,0) = \\tfrac{1}{2} d(x,0)^{2}$ 具有展开式\n$$\n\\sigma(x,0) = \\frac{1}{2}\\, |x|^{2} + O(|x|^{3}), \\quad \\nabla \\sigma(x,0) = x + O(|x|^{2}),\n$$\n且其拉普拉斯算子满足\n$$\n\\Delta \\sigma(x,0) = n - \\frac{1}{3}\\, R_{ij}(p)\\, x^{i} x^{j} + O(|x|^{3}).\n$$\n使用受欧几里得核启发的拟设（ansatz），\n$$\nK(t,x,0) \\approx (4\\pi t)^{-n/2}\\, \\exp\\!\\left( - \\frac{\\sigma(x,0)}{2t} \\right)\\, \\Psi(x,t),\n$$\n其中 $\\Psi(x,t)$ 是一个待定的光滑振幅，通过代入热偏微分方程并匹配 $t$ 的幂次和 $x$ 的阶数，为 $\\Psi$ 构造一个输运方程。然后，将 $\\Psi(x,t)$ 分解为 $J(x)^{1/2}\\, U(x,t)$，其中 $J(x)^{1/2}$ 解领先的输运方程，并从得到的关于 $U$ 的方程中计算 $a_{1}(p)$。将您的最终答案仅用 $p$ 点的标量曲率 $R(p) = g^{ij}(p) R_{ij}(p)$ 表示。最终答案必须是一个没有单位的单一闭式解析表达式。", "solution": "该问题是有效的，因为它是一个基于黎曼几何和偏微分方程的既定原则的、几何分析中的标准适定问题。所有必要的定义和正规坐标下的局部展开式都已提供，并且没有矛盾或含糊之处。我们将开始推导。\n\n我们的目标是计算热核对角线上短时渐近展开式中的系数 $a_{1}(p)$：\n$$\nK(t,p,p) \\sim (4\\pi t)^{-n/2} \\left( a_{0}(p) + t\\, a_{1}(p) + o(t) \\right) \\quad \\text{当 } t \\to 0^{+} \\text{ 时}.\n$$\n我们在以点 $p$ 为中心的正规坐标系 $x=(x^1, \\dots, x^n)$ 中工作，因此 $p$ 对应于 $x=0$。问题提供了用于热核 $K(t,x,0)$ 的局部拟基本解（一个近似解）的拟设：\n$$\nK(t,x,0) = (4\\pi t)^{-n/2}\\, \\exp\\!\\left( - \\frac{\\sigma(x,0)}{2t} \\right)\\, \\Psi(x,t)\n$$\n其中 $\\sigma(x,0) = \\frac{1}{2}d(x,0)^2$ 是从 $x$ 到 $p=0$ 的测地距离平方的一半，而 $\\Psi(x,t)$ 是我们旨在确定的光滑振幅函数。我们将此拟设代入热方程 $(\\partial_t - \\Delta_x)K = 0$。\n\n我们来计算算子 $(\\partial_t - \\Delta_x)$ 作用于 $K$ 的结果。我们记 $\\sigma(x)\\equiv\\sigma(x,0)$。\n首先，时间导数：\n$$\n\\partial_t K = \\left(-\\frac{n}{2t} + \\frac{\\sigma}{2t^{2}}\\right) (4\\pi t)^{-n/2} \\exp\\left(-\\frac{\\sigma}{2t}\\right) \\Psi + (4\\pi t)^{-n/2} \\exp\\left(-\\frac{\\sigma}{2t}\\right) \\partial_t \\Psi\n$$\n接下来，拉普拉斯算子。我们使用公式 $\\Delta(fg) = f\\Delta g + g\\Delta f + 2g(\\nabla f, \\nabla g)$。令 $F = (4\\pi t)^{-n/2} \\exp(-\\sigma/2t)$。\n$$\n\\Delta_x K = \\Delta_x (F \\Psi) = (\\Delta F)\\Psi + F(\\Delta \\Psi) + 2 g(\\nabla F, \\nabla \\Psi)\n$$\n我们计算涉及 $F$ 的项：\n$$\n\\nabla F = -\\frac{1}{2t} \\nabla\\sigma \\cdot F\n$$\n$$\n\\Delta F = \\Delta\\left( (4\\pi t)^{-n/2} \\exp(-\\sigma/2t) \\right) = (4\\pi t)^{-n/2} \\left[ \\Delta\\left(\\exp(-\\sigma/2t)\\right) \\right]\n$$\n使用 $\\Delta(e^{\\phi}) = e^{\\phi}(\\Delta\\phi + |\\nabla\\phi|^2)$，其中 $\\phi = -\\sigma/2t$：\n$$\n\\Delta F = F \\left( -\\frac{1}{2t}\\Delta\\sigma + \\frac{1}{4t^2}|\\nabla\\sigma|^2 \\right)\n$$\n平方测地距离函数的一个基本性质是它满足程函方程 $|\\nabla\\sigma|^2 = 2\\sigma$。将其代入可得：\n$$\n\\Delta F = F \\left( -\\frac{1}{2t}\\Delta\\sigma + \\frac{2\\sigma}{4t^2} \\right) = F \\left( -\\frac{1}{2t}\\Delta\\sigma + \\frac{\\sigma}{2t^2} \\right)\n$$\n将这些代入 $\\Delta_x K$ 的表达式中：\n$$\n\\Delta_x K = F\\Psi\\left( -\\frac{1}{2t}\\Delta\\sigma + \\frac{\\sigma}{2t^2} \\right) + F(\\Delta \\Psi) + 2g\\left(-\\frac{1}{2t}\\nabla\\sigma \\cdot F, \\nabla\\Psi\\right)\n$$\n$$\n\\Delta_x K = F \\left[ \\Psi\\left( -\\frac{1}{2t}\\Delta\\sigma + \\frac{\\sigma}{2t^2} \\right) + \\Delta \\Psi - \\frac{1}{t}g(\\nabla\\sigma, \\nabla\\Psi) \\right]\n$$\n现在我们令 $(\\partial_t - \\Delta_x)K=0$。我们可以除以公因子 $F = (4\\pi t)^{-n/2}\\exp(-\\sigma/2t)$：\n$$\n\\left(-\\frac{n}{2t} + \\frac{\\sigma}{2t^2}\\right)\\Psi + \\partial_t\\Psi - \\left[ \\Psi\\left(-\\frac{1}{2t}\\Delta\\sigma + \\frac{\\sigma}{2t^2}\\right) + \\Delta\\Psi - \\frac{1}{t}g(\\nabla\\sigma, \\nabla\\Psi) \\right] = 0\n$$\n包含 $\\sigma/2t^2$ 的项如预期那样抵消了。这种抵消确保了方程不会过度奇异。\n$$\n\\partial_t\\Psi - \\Delta\\Psi + \\frac{1}{t}g(\\nabla\\sigma, \\nabla\\Psi) + \\left(-\\frac{n}{2t} + \\frac{1}{2t}\\Delta\\sigma\\right)\\Psi = 0\n$$\n乘以 $2t$ 得到 $\\Psi$ 的输运方程：\n$$\n2t\\,\\partial_t\\Psi - 2t\\,\\Delta\\Psi + 2g(\\nabla\\sigma, \\nabla\\Psi) + (\\Delta\\sigma - n)\\Psi = 0\n$$\n我们寻求 $\\Psi(x,t)$ 的渐近解，形式为关于 $t$ 的幂级数：\n$$\n\\Psi(x,t) = \\sum_{k=0}^{\\infty} \\Psi_k(x) t^k\n$$\n将此级数代入输运方程：\n$$\n2t \\sum_{k=1}^{\\infty} k \\Psi_k t^{k-1} - 2t \\sum_{k=0}^{\\infty} (\\Delta\\Psi_k) t^k + 2\\sum_{k=0}^{\\infty} g(\\nabla\\sigma, \\nabla\\Psi_k) t^k + \\sum_{k=0}^{\\infty} (\\Delta\\sigma - n)\\Psi_k t^k = 0\n$$\n$$\n\\sum_{k=1}^{\\infty} 2k \\Psi_k t^k - \\sum_{k=0}^{\\infty} 2(\\Delta\\Psi_k) t^{k+1} + \\sum_{k=0}^{\\infty} \\left[2g(\\nabla\\sigma, \\nabla\\Psi_k) + (\\Delta\\sigma - n)\\Psi_k\\right] t^k = 0\n$$\n通过令 $t$ 的各次幂的系数为零，我们得到一个方程等级体系。\n$t^0$ 的系数（对于 $k=0$）给出第一个输运方程：\n$$\n2g(\\nabla\\sigma, \\nabla\\Psi_0) + (\\Delta\\sigma - n)\\Psi_0 = 0\n$$\n对于 $k \\geq 1$，$t^k$ 的系数为：\n$$\n2k\\Psi_k + 2g(\\nabla\\sigma, \\nabla\\Psi_k) + (\\Delta\\sigma - n)\\Psi_k = 2\\Delta\\Psi_{k-1}\n$$\n对角展开式 $K(t,p,p)$ 的系数由 $a_k(p) = \\Psi_k(p)$ 给出。为了找到 $a_0(p)$ 和 $a_1(p)$，我们在 $x=p=0$ 处计算函数 $\\Psi_k$ 的值。\n初始条件 $\\lim_{t\\to 0} K(t,x,0) = \\delta_0(x)$ 意味着 $\\Psi_0(0) = 1$。因此，$a_0(p) = \\Psi_0(p) = 1$。\n\n现在，我们来求 $a_1(p) = \\Psi_1(p)$。我们在 $x=0$ 处计算 $k=1$ 的输运方程：\n$$\n2\\Psi_1(0) + 2g(\\nabla\\sigma(0), \\nabla\\Psi_1(0)) + (\\Delta\\sigma(0) - n)\\Psi_1(0) = 2\\Delta\\Psi_0(0)\n$$\n在以 $p=0$ 为中心的正规坐标系中，我们有 $\\sigma(x,0) = \\frac{1}{2}|x|^2$，这意味着 $\\nabla\\sigma(0) = 0$。所提供的 $\\Delta\\sigma$ 的展开式为 $\\Delta \\sigma(x,0) = n - \\frac{1}{3} R_{ij}(0) x^i x^j + O(|x|^3)$，这给出 $\\Delta\\sigma(0)=n$。\n将这些代入 $\\Psi_1(0)$ 的方程中：\n$$\n2\\Psi_1(0) + 2g(0, \\nabla\\Psi_1(0)) + (n-n)\\Psi_1(0) = 2\\Delta\\Psi_0(0)\n$$\n$$\n2\\Psi_1(0) = 2\\Delta\\Psi_0(0) \\implies \\Psi_1(0) = \\Delta\\Psi_0(0)\n$$\n所以，$a_1(p) = (\\Delta \\Psi_0)(p)$。我们的任务简化为求点 $p$ 处 $\\Psi_0$ 的拉普拉斯算子。\n\n为此，我们必须通过求解其输运方程 $2g(\\nabla\\sigma, \\nabla\\Psi_0) + (\\Delta\\sigma - n)\\Psi_0 = 0$ 来确定 $\\Psi_0(x)$ 在 $x=0$ 附近的二阶泰勒展开式。\n我们将 $\\Psi_0(x)$ 写成泰勒级数，已知 $\\Psi_0(0)=1$：\n$$\n\\Psi_0(x) = 1 + A_i x^i + \\frac{1}{2}B_{ij} x^i x^j + O(|x|^3)\n$$\n其中我们可以假设 $B_{ij}$ 是对称的。那么 $\\nabla \\Psi_0(x) = A_i + B_{ij}x^j + O(|x|^2)$。\n我们在输运方程中使用所提供的展开式：\n$g(\\nabla\\sigma, \\nabla\\Psi_0) = g^{ik}(\\partial_k\\sigma)(\\partial_i\\Psi_0)$。我们有 $\\partial_k\\sigma = x_k$。在正规坐标系中，在 $p=0$ 点，指标通过 $\\delta_{ij}$ 来提升，因此在最低阶，$x_k=x^k$。\n$g(\\nabla\\sigma, \\nabla\\Psi_0) = g^{ik}x_k (\\partial_i\\Psi_0) = (\\delta^{ik} + O(|x|^2))x_k(A_i + B_{ij}x^j + O(|x|^2)) = x^i(A_i + B_{ij}x^j) + O(|x|^3) = A_i x^i + B_{ij}x^ix^j + O(|x|^3)$。\n输运方程中的第二项是 $(\\Delta\\sigma - n)\\Psi_0 = (-\\frac{1}{3}R_{ij}x^ix^j + O(|x|^3))(1 + A_k x^k + ...) = -\\frac{1}{3}R_{ij}x^ix^j + O(|x|^3)$。\n代入输运方程中：\n$$\n2(A_i x^i + B_{ij}x^ix^j + O(|x|^3)) + (-\\frac{1}{3}R_{ij}x^ix^j + O(|x|^3)) = 0\n$$\n令 $x$ 的各次幂的系数相等：\n- $|x|$ 阶：$2A_i x^i=0 \\implies A_i = 0$。所以，$\\nabla\\Psi_0(0)=0$。\n- $|x|^2$ 阶：$2B_{ij}x^ix^j - \\frac{1}{3}R_{ij}x^ix^j = 0$。由于 $B_{ij}$ 和 $R_{ij}$ 可取为对称的，这给出 $2B_{ij} = \\frac{1}{3}R_{ij}$，所以 $B_{ij} = \\frac{1}{6}R_{ij}(p)$。\n\n因此，$\\Psi_0(x)$ 在 $x=0$ 附近的泰勒展开式为：\n$$\n\\Psi_0(x) = 1 + \\frac{1}{12}R_{ij}(p) x^i x^j + O(|x|^3)\n$$\n现在，我们计算它在 $x=0$ 处的拉普拉斯算子。Laplace-Beltrami 算子是 $\\Delta f = g^{ij}(\\partial_i\\partial_j f - \\Gamma^k_{ij}\\partial_k f)$。在正规坐标系中，Christoffel 符号在原点处为零，$\\Gamma^k_{ij}(0)=0$，且度量是欧几里得的，$g^{ij}(0)=\\delta^{ij}$。\n$$\n\\Delta\\Psi_0(0) = \\delta^{ij}\\partial_i\\partial_j\\Psi_0(0)\n$$\n我们从其展开式计算 $\\Psi_0$ 的二阶偏导数：\n$$\n\\partial_j \\Psi_0(x) = \\frac{1}{6}R_{jk}(p) x^k + O(|x|^2)\n$$\n$$\n\\partial_i \\partial_j \\Psi_0(x) = \\frac{1}{6}R_{ji}(p) + O(|x|)\n$$\n在 $x=0$ 处求值：\n$$\n\\partial_i\\partial_j\\Psi_0(0) = \\frac{1}{6}R_{ji}(p)\n$$\n最后，我们计算在 $p=0$ 处的拉普拉斯算子：\n$$\n\\Delta\\Psi_0(0) = \\delta^{ij} \\left( \\frac{1}{6}R_{ji}(p) \\right) = \\frac{1}{6} g^{ij}(p)R_{ji}(p) = \\frac{1}{6}R(p)\n$$\n其中 $R(p)$ 是点 $p$ 处的标量曲率。\n因此，系数 $a_1(p)$ 是：\n$$\na_1(p) = \\Delta\\Psi_0(p) = \\frac{1}{6}R(p)\n$$", "answer": "$$\\boxed{\\frac{1}{6} R(p)}$$", "id": "3061913"}, {"introduction": "平坦流形（如环面）是一个关键的检验案例，其标量曲率为零，这意味着系数 $a_{1}$ 也必须为零。本练习通过要求您从两个不同角度计算平坦环面上的热迹来探索这一情景 `[@problem_id:3030087]`。您将使用镜像法得到其几何表示，并利用泊松求和公式将其与谱表示联系起来，从而验证整个理论的自洽性，并清晰地看到为何高阶几何修正项会消失。", "problem": "考虑$n$维平坦长方环面 $T^{n} = \\mathbb{R}^{n} / \\prod_{i=1}^{n} L_{i} \\mathbb{Z}$，其度量由$\\mathbb{R}^{n}$上的欧几里得内积诱导，其中边长$L_{i}$对所有$i \\in \\{1,\\dots,n\\}$满足$L_{i}>0$。令$\\Delta$表示$T^{n}$上的非负拉普拉斯-贝尔特拉米算子，并定义热迹$Z(t) = \\operatorname{Tr}(\\exp(-t \\Delta))$，其中$t>0$。\n\n从$\\mathbb{R}^{n}$上的欧几里得热核出发，结合镜像法和泊松求和公式，推导短时渐近展开\n$$\nZ(t) \\sim (4\\pi t)^{-n/2}\\big(a_{0} + a_{1} t + o(t)\\big) \\quad \\text{当 } t \\downarrow 0 \\text{ 时},\n$$\n并用边长$L_{1},\\dots,L_{n}$显式计算前两个热迹系数$a_{0}$和$a_{1}$。然后，通过与$Z(t)$的傅里叶级数表示进行比较，验证您的结果与$T^{n}$上$\\Delta$的精确特征值谱及其重数的一致性。\n\n将您的最终答案表示为最简闭式形式的有序对$(a_{0},a_{1})$。不需要进行数值舍入。", "solution": "该问题要求计算$n$维平坦环面$T^n$上热迹$Z(t) = \\operatorname{Tr}(\\exp(-t \\Delta))$的短时渐近展开中的前两个系数$a_0$和$a_1$。\n\n该问题具有科学依据、是良态的且客观的，因而是有效的。这是几何分析中的一个标准问题。\n\n我们首先构造环面$T^n = \\mathbb{R}^n / \\Lambda$的热核，其中$\\Lambda = \\prod_{i=1}^{n} L_{i} \\mathbb{Z}$是由正交向量$\\{L_1 e_1, \\dots, L_n e_n\\}$生成的格。$T^n$上的度量继承自$\\mathbb{R}^n$上的欧几里得度量。平坦环面上的拉普拉斯-贝尔特拉米算子$\\Delta$是标准的拉普拉斯算子，在非负约定下，为$\\Delta = -\\sum_{i=1}^{n} \\frac{\\partial^2}{\\partial x_i^2}$。\n\n$\\mathbb{R}^n$上的热核$K_{\\mathbb{R}^n}(t, x, y)$是热方程$\\frac{\\partial u}{\\partial t} + \\Delta u = 0$的基本解。它由下式给出：\n$$\nK_{\\mathbb{R}^n}(t, x, y) = (4\\pi t)^{-n/2} \\exp\\left(-\\frac{\\|x-y\\|^2}{4t}\\right)\n$$\n其中$\\|x-y\\|^2$是欧几里得距离的平方。\n\n使用镜像法，环面上的热核$K_{T^n}(t, x, y)$通过对覆盖空间$\\mathbb{R}^n$中所有镜像源的贡献求和得到。环面上的一个点$y$对应于$\\mathbb{R}^n$中的点集$\\{y+\\lambda \\mid \\lambda \\in \\Lambda\\}$。因此，\n$$\nK_{T^n}(t, x, y) = \\sum_{\\lambda \\in \\Lambda} K_{\\mathbb{R}^n}(t, x, y+\\lambda)\n$$\n格向量的形式为$\\lambda = (k_1 L_1, \\dots, k_n L_n)$，其中$k = (k_1, \\dots, k_n) \\in \\mathbb{Z}^n$是一个整数向量。我们有：\n$$\nK_{T^n}(t, x, y) = (4\\pi t)^{-n/2} \\sum_{k \\in \\mathbb{Z}^n} \\exp\\left(-\\frac{\\|x - y - (k_1 L_1, \\dots, k_n L_n)\\|^2}{4t}\\right)\n$$\n热迹$Z(t)$是核在对角线（$y=x$）上对流形积分的结果：\n$$\nZ(t) = \\int_{T^n} K_{T^n}(t, x, x) \\, dV(x)\n$$\n对角线上的核为：\n$$\nK_{T^n}(t, x, x) = (4\\pi t)^{-n/2} \\sum_{k \\in \\mathbb{Z}^n} \\exp\\left(-\\frac{\\sum_{i=1}^n (k_i L_i)^2}{4t}\\right)\n$$\n这个表达式与点$x$无关。因此，积分就简化为乘以环面的体积，$\\operatorname{Vol}(T^n) = \\int_0^{L_1} \\dots \\int_0^{L_n} dx_1 \\dots dx_n = \\prod_{i=1}^n L_i$。\n$$\nZ(t) = \\operatorname{Vol}(T^n) \\cdot K_{T^n}(t, x, x) = \\left(\\prod_{i=1}^n L_i\\right) (4\\pi t)^{-n/2} \\sum_{k \\in \\mathbb{Z}^n} \\exp\\left(-\\frac{\\sum_{i=1}^n (k_i L_i)^2}{4t}\\right)\n$$\n这是热迹的几何表示，特别适合研究$t \\downarrow 0$时的短时行为。为了获得渐近展开，我们分析对$k \\in \\mathbb{Z}^n$的求和。我们将$k=0$的项与其余项分开：\n$$\nZ(t) = \\left(\\prod_{i=1}^n L_i\\right) (4\\pi t)^{-n/2} \\left(1 + \\sum_{k \\in \\mathbb{Z}^n \\setminus \\{0\\}} \\exp\\left(-\\frac{\\sum_{i=1}^n k_i^2 L_i^2}{4t}\\right)\\right)\n$$\n我们来分析$k \\neq 0$时的和。对于任何非零整数向量$k$，量$C_k = \\sum_{i=1}^n k_i^2 L_i^2$是严格为正的。令$L_{min} = \\min_{i} L_i > 0$。则$C_k \\ge L_{min}^2 \\|k\\|^2 \\ge L_{min}^2$。\n这个和可以写成：\n$$\nS(t) = \\sum_{k \\in \\mathbb{Z}^n \\setminus \\{0\\}} \\exp\\left(-\\frac{C_k}{4t}\\right)\n$$\n当$t \\downarrow 0$时，每一项$\\exp(-C_k/4t)$都比$t$的任何次幂更快地衰减到零。具体来说，对于任何整数$m \\ge 0$：\n$$\n\\lim_{t \\downarrow 0} \\frac{\\exp(-C_k/4t)}{t^m} = 0\n$$\n和$S(t)$也继承了这一性质。函数$S(t)$的阶为$O(\\exp(-C/t))$，其中$C > 0$。这样的函数在$t=0$处是光滑的，并且其在$t=0$处的所有导数都为零。它对以$t$的幂次表示的渐近展开的多项式部分没有贡献。\n因此，$Z(t)$的渐近展开完全由$k=0$的项决定。\n$$\nZ(t) = (4\\pi t)^{-n/2} \\left(\\prod_{i=1}^n L_i\\right) (1 + S(t)) = (4\\pi t)^{-n/2} \\left[ \\left(\\prod_{i=1}^n L_i\\right) + O(\\exp(-C/t)) \\right]\n$$\n我们被要求找到展开式中的$a_0$和$a_1$：\n$$\nZ(t) \\sim (4\\pi t)^{-n/2} (a_0 + a_1 t + o(t))\n$$\n比较这两种形式，我们识别出括号中的项：\n$$\na_0 + a_1 t + o(t) = \\left(\\prod_{i=1}^n L_i\\right) + \\left(\\prod_{i=1}^n L_i\\right) S(t)\n$$\n对于$a_0$，我们取$t \\downarrow 0$的极限：\n$$\na_0 = \\lim_{t \\downarrow 0} \\left[ \\left(\\prod_{i=1}^n L_i\\right) + \\left(\\prod_{i=1}^n L_i\\right) S(t) \\right] = \\prod_{i=1}^n L_i\n$$\n对于$a_1$，我们计算极限：\n$$\na_1 = \\lim_{t \\downarrow 0} \\frac{1}{t} \\left[ \\left(\\left(\\prod_{i=1}^n L_i\\right) + \\left(\\prod_{i=1}^n L_i\\right) S(t) \\right) - a_0 \\right] = \\lim_{t \\downarrow 0} \\frac{1}{t} \\left(\\prod_{i=1}^n L_i\\right) S(t)\n$$\n由于$S(t)$比$t$的任何次幂都衰减得快，这个极限为零。\n$$\na_1 = 0\n$$\n因此，前两个热迹系数是$a_0 = \\prod_{i=1}^n L_i$和$a_1 = 0$。这个结果与热不变量的一般理论是一致的，该理论指出$a_1$与流形的积分标量曲率成正比。由于环面是平坦的，其标量曲率处处为零，这意味着$a_1 = 0$。类似地，对于平坦流形，所有更高阶的系数$a_k$（$k \\ge 1$）也都为零。\n\n为了验证一致性，我们现在考虑$Z(t)$的谱表示。$T^n$上$\\Delta = -\\sum_i \\partial_i^2$的特征函数是复指数$\\phi_m(x) \\propto \\exp(2\\pi i \\sum_j m_j x_j / L_j)$，其中$m \\in \\mathbb{Z}^n$。对应的特征值为：\n$$\n\\lambda_m = \\sum_{j=1}^n \\frac{4\\pi^2 m_j^2}{L_j^2}\n$$\n热迹是所有特征值的和（包括重数，这通过对所有$m \\in \\mathbb{Z}^n$求和来处理）：\n$$\nZ(t) = \\sum_{m \\in \\mathbb{Z}^n} \\exp(-t \\lambda_m) = \\sum_{m \\in \\mathbb{Z}^n} \\exp\\left(-t \\sum_{j=1}^n \\frac{4\\pi^2 m_j^2}{L_j^2}\\right)\n$$\n这是热迹的谱表示。它非常适合研究长时（$t \\to \\infty$）行为。问题指出推导应使用泊松求和公式。这个公式提供了$Z(t)$的几何表示和谱表示之间的精确恒等关系。\n\n我们应用泊松求和公式，$\\sum_{k \\in \\mathbb{Z}^n} f(k) = \\sum_{m \\in \\mathbb{Z}^n} \\hat{f}(m)$，其中$\\hat{f}$是傅里叶变换$\\hat{f}(m) = \\int_{\\mathbb{R}^n} f(x) e^{-2\\pi i m \\cdot x} d^n x$。\n从我们对$Z(t)$的几何表达式中，令$f(x) = \\exp\\left(-\\frac{1}{4t} \\sum_{i=1}^n L_i^2 x_i^2\\right)$。$Z(t)$的几何公式中的和是$\\sum_{k \\in \\mathbb{Z}^n} f(k)$。\n傅里叶变换$\\hat{f}(m)$是$n$个一维高斯积分的乘积：\n$$\n\\hat{f}(m) = \\prod_{i=1}^n \\int_{-\\infty}^\\infty \\exp\\left(-\\frac{L_i^2}{4t} x_i^2 - 2\\pi i m_i x_i\\right) dx_i\n$$\n使用公式$\\int_{-\\infty}^\\infty \\exp(-Ax^2 - Bx) dx = \\sqrt{\\frac{\\pi}{A}} \\exp\\left(\\frac{B^2}{4A}\\right)$，其中$A_i = \\frac{L_i^2}{4t}$和$B_i = 2\\pi i m_i$，我们得到：\n$$\n\\int_{-\\infty}^\\infty \\dots dx_i = \\sqrt{\\frac{4\\pi t}{L_i^2}} \\exp\\left(\\frac{(2\\pi i m_i)^2}{4(L_i^2/4t)}\\right) = \\frac{2\\sqrt{\\pi t}}{L_i} \\exp\\left(-\\frac{4\\pi^2 t m_i^2}{L_i^2}\\right)\n$$\n因此，完整的傅里叶变换是：\n$$\n\\hat{f}(m) = \\prod_{i=1}^n \\frac{2\\sqrt{\\pi t}}{L_i} \\exp\\left(-\\frac{4\\pi^2 t m_i^2}{L_i^2}\\right) = \\frac{(4\\pi t)^{n/2}}{\\prod_{i=1}^n L_i} \\exp\\left(-t\\sum_{i=1}^n \\frac{4\\pi^2 m_i^2}{L_i^2}\\right)\n$$\n根据泊松求和公式：\n$$\n\\sum_{k \\in \\mathbb{Z}^n} f(k) = \\sum_{m \\in \\mathbb{Z}^n} \\hat{f}(m) = \\frac{(4\\pi t)^{n/2}}{\\prod_{i=1}^n L_i} \\sum_{m \\in \\mathbb{Z}^n} \\exp\\left(-t\\sum_{i=1}^n \\frac{4\\pi^2 m_i^2}{L_i^2}\\right)\n$$\n将此代回$Z(t)$的几何表达式中：\n$$\nZ(t) = \\left(\\prod_{i=1}^n L_i\\right) (4\\pi t)^{-n/2} \\left[ \\frac{(4\\pi t)^{n/2}}{\\prod_{i=1}^n L_i} \\sum_{m \\in \\mathbb{Z}^n} \\exp\\left(-t\\sum_{i=1}^n \\frac{4\\pi^2 m_i^2}{L_i^2}\\right) \\right] = \\sum_{m \\in \\mathbb{Z}^n} \\exp\\left(-t\\lambda_m\\right)\n$$\n这证明了几何表示和谱表示是等价的。一致性得到验证：从几何表示推导出的短时渐近系数因此与拉普拉斯算子的完整特征值谱是一致的。几何图像（对闭测地线求和，在此平坦情况下即为格向量）自然地给出了短时行为，而谱图像（对特征值求和）则自然地给出了长时行为。泊松求和公式是连接这两者之间的桥梁。\n\n计算出的系数为$a_0 = \\prod_{i=1}^n L_i$和$a_1 = 0$。", "answer": "$$\\boxed{(\\prod_{i=1}^{n} L_{i}, 0)}$$", "id": "3030087"}, {"introduction": "热核渐近式与曲率之间的理论联系在数字世界中具有深远的实际应用。本练习挑战您将理论与应用相结合，设计一种数值方法来估算离散曲面上的标量曲率 `[@problem_id:3030137]`。通过实现离散拉普拉斯算子并模拟热流，您将看到 `[@problem_id:3061913]` 中的渐近公式如何被“反转”，从而创造出一个强大的计算工具来度量几何，这是现代几何处理领域的一项基本技术。", "problem": "您的任务是设计并实现一个数值估计器，该估计器利用近似于黎曼流形 $(M,g)$ 的网格上的模拟热核数据来估计标量曲率。该估计器必须从几何分析的第一性原理推导得出，然后实现为一个可运行的程序。\n\n从以下基本依据开始：\n\n- 在光滑黎曼流形 $(M,g)$ 上的热核 $K_t(x,y)$ 满足热方程 $\\partial_t K_t(x,y) = \\Delta_x K_t(x,y)$，初始条件为 $K_0(x,y) = \\delta(x-y)$，其中 $\\Delta$ 是 Laplace–Beltrami 算子，$\\delta$ 是狄拉克 delta 函数。\n- 热核的短时对角渐近展开为 $$K_t(x,x) \\sim (4\\pi t)^{-n/2}\\left(1 + \\frac{1}{6} R(x)\\, t + O(t^2)\\right),$$ 其中 $n$ 是 $M$ 的维数，$R(x)$ 是点 $x$ 处的标量曲率。\n- 在三角网格上的有限元法 (FEM) 半离散化中，热方程被建模为矩阵微分方程 $$M\\frac{d u(t)}{dt} = - S u(t),$$ 其中 $M$ 是质量矩阵，$S$ 是刚度矩阵。使用三角网格上的余切权重离散 Laplace–Beltrami 算子，可以定义 $L = M^{-1}S$，解算子为 $u(t) = \\exp(-t L) u(0)$。\n\n使用这些事实推导一个数值方法，用以从离散热算子的对角线元素估计网格顶点 $x_i$ 处的 $R(x)$。推导过程必须证明离散近似如何对应于连续渐近式，以及如何通过对短时数据进行回归来得到 $R(x_i)$ 的估计器。\n\n通过选择一个近似于 $x_i$ 处单位质量 delta 函数的初始条件 $u(0)$，来定义顶点 $i$ 处的离散对角热核密度，并解释从 $L$ 的矩阵指数推导出的近似 $K_t(x_i,x_i)$ 的表达式。使用 $M$ 来确保相对于离散体积元的正确归一化。推导出如何根据网格几何，通过重心区域构造 $M$ 以及通过余切权重构造 $S$。\n\n设计一个程序，按如下方式实现该数值估计器：\n\n1. 为每个测试用例构造一个三角网格，并计算余切权重刚度矩阵 $S$ 和重心对角质量矩阵 $M$。\n2. 构建 $L = M^{-1} S$。\n3. 对于与平均边长平方 $h^2$ 成正比的一小组时间 $t$，计算 $U_t = \\exp(-t L)$，提取所选顶点 $i$ 的 $[U_t]_{ii}$，并近似对角热核密度 $h_t(i)$。\n4. 对于维度 $n=2$，构建缩放量 $\\psi_i(t) = (4\\pi t)^{n/2} h_t(i)$，并在 $t \\ll h^2$ 的范围内拟合线性模型 $\\psi_i(t) \\approx a + b t$。\n5. 将顶点 $i$ 处的曲率估计器定义为 $$\\widehat{R}(x_i) = 6\\,\\frac{b}{a},$$ 这可以补偿 $a$ 中的乘法离散化偏差。\n\n测试套件的网格和参数值如下：\n\n- 测试用例 1 (理想情况)：一个由嵌入在 $\\mathbb{R}^3$ 中、半径为 $r=1$ 的八面体构成的球面网格。使用顶点索引 $i=0$ 进行估计。计算平均边长 $h$ 和时间 $t \\in \\{0.02 h^2, 0.04 h^2, 0.08 h^2, 0.12 h^2\\}$。\n- 测试用例 2 (缩放检查)：与上述相同的球面网格，但半径为 $r=2$（在 2-球面上，理论标量曲率按 $R = 2/r^2$ 缩放）。使用顶点索引 $i=0$ 和按新计算的 $h$ 缩放的相同时间序列。\n- 测试用例 3 (边界/边缘情况)：一个由单位正方形上的周期性 $N\\times N$ 网格（$N=8$）表示的平坦环面，每个单元格被三角化为两个三角形，使用周期性边界条件。使用顶点索引 $i=0$，用周期性距离计算平均边长 $h$，并使用相同的时间序列。在单位正方形上使用周期性度量处理距离和面积。\n\n所有计算都是纯几何和无量纲的；不使用物理单位。根据构造，角度在内部以弧度为单位进行测量。\n\n您的程序应产生单行输出，其中包含三个测试用例的估计标量曲率值，形式为用方括号括起来的逗号分隔列表。每个值必须四舍五入到六位小数。例如：“[r1,r2,r3]”。", "solution": "该问题要求设计并实现一个数值估计器，用于估计由三角网格近似的二维黎曼流形的标量曲率。该方法基于热核的短时渐近展开。\n\n### **1. 理论基础**\n\n设 $(M,g)$ 是一个光滑的 $n$ 维黎曼流形。热核 $K_t(x,y)$ 是热方程的基本解：\n$$\n\\left(\\partial_t - \\Delta_x\\right) K_t(x,y) = 0, \\quad \\lim_{t\\to 0^+} K_t(x,y) = \\delta(x-y)\n$$\n其中 $\\Delta$ 是 $M$ 上的 Laplace-Beltrami 算子，$\\delta$ 是相对于黎曼体积测度的狄拉克 delta 函数。热核表示如果在时间 $t=0$ 时在点 $x$ 放置一个单位点热源，那么在时间 $t$ 时点 $y$ 处的热密度。\n\n对于小时间 $t > 0$，热核的对角值具有渐近展开：\n$$\nK_t(x,x) \\sim (4\\pi t)^{-n/2} \\sum_{k=0}^\\infty a_k(x) t^k = (4\\pi t)^{-n/2}\\left(a_0(x) + a_1(x)t + a_2(x)t^2 + O(t^3)\\right)\n$$\n系数 $a_k(x)$ 是局部几何不变量，称为 Seeley-DeWitt-Gilkey 系数。对于光滑流形，前两个系数是普适的：\n-   $a_0(x) = 1$\n-   $a_1(x) = \\frac{1}{6} R(x)$\n\n其中 $R(x)$ 是点 $x$ 处的标量曲率。这为我们的任务提供了关键公式：\n$$\nK_t(x,x) \\sim (4\\pi t)^{-n/2}\\left(1 + \\frac{1}{6} R(x)\\, t + O(t^2)\\right)\n$$\n\n### **2. 使用有限元法进行离散化**\n\n我们将流形 $M$ 表示为一个三角网格 $(\\mathcal{V}, \\mathcal{F})$，其中 $\\mathcal{V}$ 是顶点集合 $\\{x_i\\}$，$\\mathcal{F}$ 是三角面片集合。使用带有线性基函数的有限元法对热方程进行离散化。这导出了一个关于顶点的热值 $u(t)$ 的常微分方程组：\n$$\nM \\frac{d u(t)}{dt} = -S u(t)\n$$\n此处，$u(t)$ 是一个向量，其中 $[u(t)]_i$ 是顶点 $x_i$ 处的热值。\n-   **质量矩阵** $M$ 是一个对角矩阵，其中每个元素 $M_{ii}$ 代表顶点 $x_i$ 周围的有效面积。对于重心集中格式，$M_{ii}$ 是邻接于顶点 $x_i$ 的所有三角形面积之和的三分之一。\n-   **刚度矩阵** $S$ 是 Laplace-Beltrami 算子的离散表示。对于三角网格，最常用且具有几何意义的选择是**余切权重拉普拉斯算子**。对于连接顶点 $x_i$ 和 $x_j$ 的边，非对角元素由下式给出：\n    $$\n    S_{ij} = S_{ji} = -\\frac{1}{2}\\left(\\cot \\alpha_{ij} + \\cot \\beta_{ij}\\right) \\quad (i \\neq j)\n    $$\n    其中 $\\alpha_{ij}$ 和 $\\beta_{ij}$ 是共享边 $(i,j)$ 的两个三角形中该边的对角。对角元素的定义是为了确保行和为零：$S_{ii} = -\\sum_{j \\neq i} S_{ij}$。\n\n整理该系统得到 $\\frac{du(t)}{dt} = -M^{-1}S u(t) = -L u(t)$，其中 $L = M^{-1}S$ 是离散 Laplace-Beltrami 算子。形式解由矩阵指数给出：\n$$\nu(t) = \\exp(-tL) u(0)\n$$\n\n### **3. 曲率估计器的推导**\n\n我们的目标是通过将离散热演化与连续渐近展开联系起来，来估计 $R(x_i)$。我们需要一个对角热核 $K_t(x_i, x_i)$ 的离散模拟。这对应于在时间 $t=0$ 时在 $x_i$ 处施加一个单位点热源后，在时间 $t$ 时顶点 $x_i$ 处的热密度。\n\n在 $x_i$ 处的离散单位点源是一个初始条件 $u(0)$，它使得总热量为 1 且集中在 $x_i$。网格上的总热量由 $\\sum_j [u(0)]_j M_{jj}$ 给出。为了在 $x_i$ 处放置一个单位质量，我们设置 $[u(0)]_j = \\frac{\\delta_{ij}}{M_{ii}}$。\n\n那么，在时间 $t$ 时顶点 $x_i$ 处的热值是 $[u(t)]_i$。该值代表热密度，也就是我们对 $K_t(x_i,x_i)$ 的离散模拟，我们称之为 $h_t(i)$：\n$$\nh_t(i) = [u(t)]_i = \\left[\\exp(-tL) \\left(\\frac{1}{M_{ii}} e_i\\right)\\right]_i = \\frac{1}{M_{ii}} [\\exp(-tL)]_{ii}\n$$\n其中 $e_i$ 是顶点 $i$ 的标准基向量。\n\n对于一个二维流形（$n=2$），连续展开式为 $K_t(x,x) \\sim (4\\pi t)^{-1}\\left(1 + \\frac{1}{6} R(x) t\\right)$。我们可以重新整理它，形成一个关于 $t$ 的线性关系：\n$$\n(4\\pi t) K_t(x,x) \\approx 1 + \\left(\\frac{R(x)}{6}\\right) t\n$$\n受此启发，我们定义一个缩放后的离散量 $\\psi_i(t)$：\n$$\n\\psi_i(t) = 4\\pi t \\, h_t(i) = \\frac{4\\pi t}{M_{ii}} [\\exp(-tL)]_{ii}\n$$\n我们期望对于小时间 $t$，$\\psi_i(t)$ 也会表现出线性行为。然而，由于离散化误差，常数项可能不完全是 $1$。我们假设模型为：\n$$\n\\psi_i(t) \\approx a + b t\n$$\n通过将其与连续形式进行比较，我们可以将 $a$ 视为一个依赖于离散化的常数 $C$，并将 $b$ 视为 $C \\cdot \\frac{R(x_i)}{6}$。比值 $b/a$ 消去了未知的常数 $C$：\n$$\n\\frac{b}{a} \\approx \\frac{C \\cdot R(x_i)/6}{C} = \\frac{R(x_i)}{6}\n$$\n这为我们提供了顶点 $x_i$ 处标量曲率的一个稳健估计器：\n$$\n\\widehat{R}(x_i) = 6 \\frac{b}{a}\n$$\n\n### **4. 数值步骤**\n\n整体算法如下：\n1.  给定一个网格 $(\\mathcal{V}, \\mathcal{F})$，计算余切刚度矩阵 $S$ 和对角重心质量矩阵 $M$。\n2.  计算离散 Laplace-Beltrami 算子 $L = M^{-1}S$。\n3.  计算网格的平均边长 $h$。选择一组与 $h^2$ 成比例的小时间值 $\\{t_k\\}$，例如，$t_k = c_k h^2$（其中 $c_k$ 为小常数）。\n4.  对每个时间 $t_k$，计算矩阵指数 $U_{t_k} = \\exp(-t_k L)$。\n5.  对于选定的顶点 $i$，计算相应的值序列 $\\psi_i(t_k) = \\frac{4\\pi t_k}{M_{ii}} [U_{t_k}]_{ii}$。\n6.  对点 $(t_k, \\psi_i(t_k))$ 进行线性回归，找到最佳拟合的截距 $a$ 和斜率 $b$。\n7.  计算估计的标量曲率 $\\widehat{R}(x_i) = 6 \\, b/a$。\n\n该步骤针对指定的三个测试用例进行实现：半径为 $r=1$ 的八面体（近似于 $R=2/r^2=2$ 的球面）、半径为 $r=2$ 的八面体（近似于 $R=2/r^2=0.5$ 的球面），以及单位正方形上的周期性网格（近似于 $R=0$ 的平坦环面）。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the results.\n    \"\"\"\n    time_coeffs = np.array([0.02, 0.04, 0.08, 0.12])\n\n    # Test Case 1: Sphere of radius r=1\n    V1, F1 = get_octahedron_mesh(radius=1.0)\n    R1 = estimate_curvature(V1, F1, 0, time_coeffs, periodic_dims=None)\n\n    # Test Case 2: Sphere of radius r=2\n    V2, F2 = get_octahedron_mesh(radius=2.0)\n    R2 = estimate_curvature(V2, F2, 0, time_coeffs, periodic_dims=None)\n\n    # Test Case 3: Flat Torus\n    V3, F3 = get_torus_mesh(N=8)\n    R3 = estimate_curvature(V3, F3, 0, time_coeffs, periodic_dims=[0, 1])\n    \n    results = [R1, R2, R3]\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef get_octahedron_mesh(radius):\n    \"\"\"\n    Generates vertices and faces for an octahedron inscribed in a sphere.\n    \"\"\"\n    r = float(radius)\n    V = np.array([\n        [r, 0, 0], [-r, 0, 0], [0, r, 0], \n        [0, -r, 0], [0, 0, r], [0, 0, -r]\n    ])\n    F = np.array([\n        [0, 4, 2], [2, 4, 1], [1, 4, 3], [3, 4, 0],\n        [0, 2, 5], [2, 1, 5], [1, 3, 5], [3, 0, 5]\n    ])\n    return V, F\n\ndef get_torus_mesh(N):\n    \"\"\"\n    Generates a periodic grid mesh on the unit square.\n    \"\"\"\n    V = np.array([[i/N, j/N] for i in range(N) for j in range(N)])\n    F = []\n    for i in range(N):\n        for j in range(N):\n            v00 = i * N + j\n            v10 = ((i + 1) % N) * N + j\n            v11 = ((i + 1) % N) * N + ((j + 1) % N)\n            v01 = i * N + ((j + 1) % N)\n            F.append([v00, v10, v11])\n            F.append([v00, v11, v01])\n    return V, np.array(F)\n\ndef get_cotan_laplacian(V, F, periodic_dims):\n    \"\"\"\n    Computes the cotangent-weighted stiffness matrix S and barycentric mass matrix M.\n    \"\"\"\n    num_verts = V.shape[0]\n    S_off_diag_accumulator = np.zeros((num_verts, num_verts))\n    M_diag = np.zeros(num_verts)\n\n    def find_shortest_vec(v_to, v_from):\n        vec = v_to - v_from\n        if periodic_dims:\n            for dim in periodic_dims:\n                if vec[dim] > 0.5: vec[dim] -= 1.0\n                elif vec[dim]  -0.5: vec[dim] += 1.0\n        return vec\n\n    for i, j, k in F:\n        p_i, p_j, p_k = V[i], V[j], V[k]\n        \n        v_ij = find_shortest_vec(p_j, p_i)\n        v_ik = find_shortest_vec(p_k, p_i)\n        v_ji = find_shortest_vec(p_i, p_j)\n        v_jk = find_shortest_vec(p_k, p_j)\n        v_ki = find_shortest_vec(p_i, p_k)\n        v_kj = find_shortest_vec(p_j, p_k)\n        \n        if V.shape[1] == 2:\n            area = 0.5 * abs(np.cross(v_ij, v_ik))\n        else:\n            area = 0.5 * np.linalg.norm(np.cross(v_ij, v_ik))\n\n        if area > 1e-12:\n            M_diag[i] += area / 3.0; M_diag[j] += area / 3.0; M_diag[k] += area / 3.0\n            \n            cot_i = np.dot(v_ij, v_ik) / (2 * area)\n            S_off_diag_accumulator[j, k] += cot_i; S_off_diag_accumulator[k, j] += cot_i\n            \n            cot_j = np.dot(v_ji, v_jk) / (2 * area)\n            S_off_diag_accumulator[i, k] += cot_j; S_off_diag_accumulator[k, i] += cot_j\n            \n            cot_k = np.dot(v_ki, v_kj) / (2 * area)\n            S_off_diag_accumulator[i, j] += cot_k; S_off_diag_accumulator[j, i] += cot_k\n\n    S = -0.5 * S_off_diag_accumulator\n    np.fill_diagonal(S, -S.sum(axis=1))\n    \n    return S, np.diag(M_diag)\n\ndef estimate_curvature(V, F, target_idx, time_coeffs, periodic_dims):\n    \"\"\"\n    Estimates scalar curvature at a vertex using the heat kernel method.\n    \"\"\"\n    edge_lengths = []\n    \n    def find_shortest_dist(p1, p2):\n        vec = p2 - p1\n        if periodic_dims:\n            for dim in periodic_dims:\n                if vec[dim] > 0.5: vec[dim] -= 1.0\n                elif vec[dim]  -0.5: vec[dim] += 1.0\n        return np.linalg.norm(vec)\n\n    unique_edges = set()\n    for face in F:\n        for i in range(3):\n            u, v = face[i], face[(i + 1) % 3]\n            edge = tuple(sorted((u, v)))\n            if edge not in unique_edges:\n                edge_lengths.append(find_shortest_dist(V[u], V[v]))\n                unique_edges.add(edge)\n    h = np.mean(edge_lengths)\n    \n    S, M = get_cotan_laplacian(V, F, periodic_dims)\n    \n    M_diag_vec = np.diag(M)\n    M_diag_vec[M_diag_vec  1e-12] = 1.0\n    M_inv = np.diag(1.0 / M_diag_vec)\n    L = M_inv @ S\n\n    times = time_coeffs * h**2\n    psi_values = []\n    \n    M_ii = M[target_idx, target_idx]\n    if M_ii  1e-12: return np.nan\n\n    for t in times:\n        U_t = expm(-t * L)\n        U_ii = U_t[target_idx, target_idx]\n        h_t = U_ii / M_ii\n        psi = 4 * np.pi * t * h_t\n        psi_values.append(psi)\n\n    b, a = np.polyfit(times, psi_values, 1)\n\n    if abs(a)  1e-9:\n        return np.nan\n    R_hat = 6.0 * b / a\n    \n    return R_hat\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3030137"}]}