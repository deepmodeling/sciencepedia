{"hands_on_practices": [{"introduction": "掌握了理论知识后，首要任务是在实际情境中应用它。这个练习提供了一个经典的社会科学场景——比较两个地区选民的投票率 [@problem_id:1907971]。通过这个实践，你将直接运用双样本比例之差的置信区间公式进行计算，这是后续更复杂分析的基础。", "problem": "一位政治学研究人员正在调查两个相邻县（A县和B县）的选民投票参与情况。为了估计最近一次选举中投票率的差异，该研究人员从每个县的官方记录中抽取了登记选民的随机样本。\n\n从A县$n_A = 650$名登记选民的随机样本中，研究人员发现有$x_A = 429$人投票。\n从B县$n_B = 580$名登记选民的随机样本中，研究人员发现有$x_B = 348$人投票。\n\n研究人员旨在估计选民投票率真实比例的差异$p_A - p_B$，其中$p_A$是A县登记选民中投票的真实比例，而$p_B$是B县的真实比例。\n\n为差异$p_A - p_B$构建一个95%的置信区间。将你的最终答案表示为一个包含下限和上限的区间。将置信区间的两个界限四舍五入至四位有效数字。", "solution": "我们将真实投票率记为$p_{A}$和$p_{B}$，其样本估计值记为$\\hat{p}_{A}$和$\\hat{p}_{B}$。根据样本数据，\n$$\n\\hat{p}_{A}=\\frac{x_{A}}{n_{A}}=\\frac{429}{650}=0.66,\\quad \\hat{p}_{B}=\\frac{x_{B}}{n_{B}}=\\frac{348}{580}=0.6,\n$$\n因此，差异的点估计为\n$$\n\\hat{p}_{A}-\\hat{p}_{B}=0.66-0.6=0.06.\n$$\n对于大独立样本，$p_{A}-p_{B}$的$(1-\\alpha)$置信区间由下式给出：\n$$\n(\\hat{p}_{A}-\\hat{p}_{B}) \\pm z_{1-\\alpha/2}\\sqrt{\\frac{\\hat{p}_{A}(1-\\hat{p}_{A})}{n_{A}}+\\frac{\\hat{p}_{B}(1-\\hat{p}_{B})}{n_{B}}}.\n$$\n当$\\alpha=0.05$时，$z_{1-\\alpha/2}=z_{0.975}\\approx 1.96$。标准误差 (SE) 计算如下：\n$$\n\\mathrm{SE} = \\sqrt{\\frac{0.66(1-0.66)}{650} + \\frac{0.6(1-0.6)}{580}} = \\sqrt{\\frac{0.2244}{650} + \\frac{0.24}{580}}\n$$\n$$\n\\mathrm{SE} \\approx \\sqrt{0.00034523 + 0.00041379} = \\sqrt{0.00075902} \\approx 0.0275504\n$$\n误差范围 (ME) 为：\n$$\n\\mathrm{ME}=1.96\\times \\mathrm{SE}\\approx 1.96\\times 0.0275504\\approx 0.0539988.\n$$\n因此，$p_{A}-p_{B}$的$95\\%$置信区间为\n$$\n0.06\\pm 0.0539988 \\;\\Rightarrow\\; \\left(0.06-0.0539988,\\;0.06+0.0539988\\right)\\approx \\left(0.0060012,\\;0.1139988\\right).\n$$\n将两个界限四舍五入至四位有效数字，得到\n$$\n\\left(0.006001,\\;0.1140\\right).\n$$", "answer": "$$\\boxed{(0.006001, 0.1140)}$$", "id": "1907971"}, {"introduction": "从数据分析转向实验设计，一个核心问题是在收集数据之前，我们需要多少样本量？本练习将指导你如何确定所需的样本量，以便在给定的置信水平下达到预期的误差范围 [@problem_id:1907997]。这突显了统计公式在设计有效研究中的实际应用价值，例如在进行A/B测试前规划资源。", "problem": "一家软件开发公司正在进行一项A/B测试，以比较其移动应用程序主要“行为召唤”按钮的两种新用户界面(UI)设计的用户参与度。设 $p_1$ 是使用设计A时点击按钮的用户的真实比例，而 $p_2$ 是使用设计B时点击按钮的用户的真实比例。该公司希望估计这些比例的差异 $p_1 - p_2$。他们计划使用两个独立且大小相等的随机用户样本来进行此项测试。\n\n在98%的置信水平下，要将差异 $p_1 - p_2$ 的估计误差范围控制在最多0.03以内，每个UI设计组所需的最小整数样本量 $n$ 是多少？由于这是一项初步研究，您应该对未知比例 $p_1$ 和 $p_2$ 作出最保守的假设。", "solution": "我们需要为两个独立且每组样本量相等的比例之差构建一个双侧置信区间。设 $\\hat{p}_{1}$ 和 $\\hat{p}_{2}$ 分别是来自大小均为 $n$ 的样本的样本比例。用于 $p_{1}-p_{2}$ 的标准Wald $(1-\\alpha)$ 置信区间为\n$$\n(\\hat{p}_{1}-\\hat{p}_{2}) \\pm z_{1-\\alpha/2}\\,\\sqrt{\\frac{\\hat{p}_{1}(1-\\hat{p}_{1})}{n}+\\frac{\\hat{p}_{2}(1-\\hat{p}_{2})}{n}}.\n$$\n因此，误差范围为\n$$\n\\text{ME}=z_{1-\\alpha/2}\\,\\sqrt{\\frac{\\hat{p}_{1}(1-\\hat{p}_{1})}{n}+\\frac{\\hat{p}_{2}(1-\\hat{p}_{2})}{n}}.\n$$\n对于初步和保守的设计，我们取 $\\hat{p}_{1}=\\hat{p}_{2}=\\frac{1}{2}$ 来使方差项最大化，因为当 $p=\\frac{1}{2}$ 时，$p(1-p)$ 达到最大值 $\\frac{1}{4}$。因此\n$$\n\\text{SE}_{\\max}=\\sqrt{\\frac{\\frac{1}{4}}{n}+\\frac{\\frac{1}{4}}{n}}=\\sqrt{\\frac{1}{2n}}.\n$$\n在置信水平为 $0.98$（即 $\\alpha=0.02$ 且 $z_{1-\\alpha/2}=z_{0.99}$）时，施加所需的误差范围要求 $\\text{ME}\\leq 0.03$，可得\n$$\nz_{0.99}\\,\\sqrt{\\frac{1}{2n}} \\leq 0.03.\n$$\n求解 $n$，\n$$\n\\sqrt{\\frac{1}{2n}} \\leq \\frac{0.03}{z_{0.99}}\n\\quad\\Longrightarrow\\quad\n\\frac{1}{2n} \\leq \\left(\\frac{0.03}{z_{0.99}}\\right)^{2}\n\\quad\\Longrightarrow\\quad\nn \\geq \\frac{z_{0.99}^{2}}{2\\cdot 0.03^{2}}.\n$$\n使用 $z_{0.99}\\approx 2.3263$，我们得到\n$$\nn \\geq \\frac{(2.3263)^{2}}{2\\cdot (0.03)^{2}}\n= \\frac{5.411671}{0.0018}\n\\approx 3006.48.\n$$\n因此，每组所需的最小整数样本量为\n$$\nn=\\lceil 3006.48\\rceil=3007.\n$$", "answer": "$$\\boxed{3007}$$", "id": "1907997"}, {"introduction": "在实验规划中，我们经常面临资源限制。此练习探讨了一个更高级的优化问题：在总样本量固定的情况下，如何最优地在两组之间分配样本，以获得最精确的估计 [@problem_id:1907982]？这个实践揭示了区间宽度背后的方差结构，并展示了如何通过优化样本分配来设计更高效的实验。", "problem": "一个数据科学家团队正在比较两种专有的机器学习（ML）分类算法的性能，我们称之为算法A（Algorithm A）和算法B（Algorithm B）。目标是估计它们真实准确率之间的差异 $p_A - p_B$，其中 $p_A$ 和 $p_B$ 分别表示算法A和算法B正确分类从特定总体中随机选择的数据点的真实概率。\n\n该团队有固定的预算，允许使用总共 $N$ 个数据点进行测试。这 $N$ 个数据点必须被划分成两个不相交的集合：一个大小为 $n_A$ 用于测试算法A，另一个大小为 $n_B$ 用于测试算法B，使得 $n_A + n_B = N$。团队的目标是选择样本量 $n_A$ 和 $n_B$ 的分配方式，以最小化差异 $p_A - p_B$ 的大样本置信区间的宽度。\n\n为了进行规划，该团队依赖于先前的初步研究，这些研究为准确率提供了估计值：算法A为 $\\tilde{p}_A$，算法B为 $\\tilde{p}_B$。一个标准的 $p_A - p_B$ 的大样本 $100(1-\\alpha)\\%$ 置信区间的宽度由 $W = 2z_{\\alpha/2}\\sqrt{\\frac{p_A(1-p_A)}{n_A} + \\frac{p_B(1-p_B)}{n_B}}$ 给出。为了实验设计的目的，此公式中未知的真实比例 $p_A$ 和 $p_B$ 被其先验估计值 $\\tilde{p}_A$ 和 $\\tilde{p}_B$ 替代。\n\n假设 $N$ 足够大，使得 $n_A$ 和 $n_B$ 的最优选择非零，确定最小化置信区间预期宽度的最优分配比率 $\\frac{n_A}{n_B}$。将您的答案表示为关于 $\\tilde{p}_A$ 和 $\\tilde{p}_B$ 的符号表达式。", "solution": "目标是找到样本量 $n_A$ 和 $n_B$ 的分配，以最小化两个比例之差 $p_A - p_B$ 的置信区间宽度，同时满足约束条件 $n_A + n_B = N$。\n\n置信区间的宽度 $W$ 是已知的。为了规划，我们使用先验估计值 $\\tilde{p}_A$ 和 $\\tilde{p}_B$ 来代替真实的比例 $p_A$ 和 $p_B$。宽度的表达式变为：\n$$ W(n_A, n_B) = 2z_{\\alpha/2}\\sqrt{\\frac{\\tilde{p}_A(1-\\tilde{p}_A)}{n_A} + \\frac{\\tilde{p}_B(1-\\tilde{p}_B)}{n_B}} $$\n最小化 $W$ 等同于最小化其平方 $W^2$，因为宽度总是非负的。这也等同于最小化平方根下的项，因为 $z_{\\alpha/2}$ 是一个正常数。我们将要最小化的函数定义为：\n$$ f(n_A, n_B) = \\frac{\\tilde{p}_A(1-\\tilde{p}_A)}{n_A} + \\frac{\\tilde{p}_B(1-\\tilde{p}_B)}{n_B} $$\n为简化表示，我们记方差估计值为 $\\sigma_A^2 = \\tilde{p}_A(1-\\tilde{p}_A)$ 和 $\\sigma_B^2 = \\tilde{p}_B(1-\\tilde{p}_B)$。要最小化的函数是：\n$$ f(n_A, n_B) = \\frac{\\sigma_A^2}{n_A} + \\frac{\\sigma_B^2}{n_B} $$\n我们有约束条件 $n_A + n_B = N$，可以写成 $n_B = N - n_A$。我们可以将此代入函数 $f$ 中，以单一变量 $n_A$ 来表示它。\n$$ g(n_A) = f(n_A, N - n_A) = \\frac{\\sigma_A^2}{n_A} + \\frac{\\sigma_B^2}{N - n_A} $$\n为了找到使该函数最小化的 $n_A$ 值，我们对 $g(n_A)$ 关于 $n_A$ 求导，并令其等于零。\n$$ \\frac{dg}{dn_A} = \\frac{d}{dn_A} \\left( \\frac{\\sigma_A^2}{n_A} + \\frac{\\sigma_B^2}{N - n_A} \\right) $$\n$$ \\frac{dg}{dn_A} = -\\frac{\\sigma_A^2}{n_A^2} - \\frac{\\sigma_B^2}{(N - n_A)^2} \\cdot (-1) = -\\frac{\\sigma_A^2}{n_A^2} + \\frac{\\sigma_B^2}{(N - n_A)^2} $$\n将导数设为零以找到临界点：\n$$ -\\frac{\\sigma_A^2}{n_A^2} + \\frac{\\sigma_B^2}{(N - n_A)^2} = 0 $$\n$$ \\frac{\\sigma_B^2}{(N - n_A)^2} = \\frac{\\sigma_A^2}{n_A^2} $$\n由于样本量和方差都是正的，我们可以取两边的正平方根：\n$$ \\frac{\\sigma_B}{N - n_A} = \\frac{\\sigma_A}{n_A} $$\n现在，我们用 $N$、$\\sigma_A$ 和 $\\sigma_B$ 来求解 $n_A$。\n$$ n_A \\sigma_B = (N - n_A) \\sigma_A $$\n$$ n_A \\sigma_B = N \\sigma_A - n_A \\sigma_A $$\n$$ n_A \\sigma_A + n_A \\sigma_B = N \\sigma_A $$\n$$ n_A (\\sigma_A + \\sigma_B) = N \\sigma_A $$\n$$ n_A = N \\frac{\\sigma_A}{\\sigma_A + \\sigma_B} $$\n为检查这是否对应于一个最小值，我们可以检验 $g(n_A)$ 的二阶导数：\n$$ \\frac{d^2g}{dn_A^2} = \\frac{d}{dn_A} \\left( -\\sigma_A^2 n_A^{-2} + \\sigma_B^2 (N - n_A)^{-2} \\right) = 2\\sigma_A^2 n_A^{-3} + 2\\sigma_B^2 (N - n_A)^{-3} = \\frac{2\\sigma_A^2}{n_A^3} + \\frac{2\\sigma_B^2}{(N-n_A)^3} $$\n由于 $n_A  0$，$n_B = N - n_A  0$，且方差估计值 $\\sigma_A^2, \\sigma_B^2$ 是非负的，所以二阶导数总是正的。这证实了我们的临界点对应于一个最小值。\n\n现在我们求出 $n_B$ 对应的最优值：\n$$ n_B = N - n_A = N - N \\frac{\\sigma_A}{\\sigma_A + \\sigma_B} = N \\left( 1 - \\frac{\\sigma_A}{\\sigma_A + \\sigma_B} \\right) = N \\left( \\frac{\\sigma_A + \\sigma_B - \\sigma_A}{\\sigma_A + \\sigma_B} \\right) $$\n$$ n_B = N \\frac{\\sigma_B}{\\sigma_A + \\sigma_B} $$\n问题要求的是最优比率 $\\frac{n_A}{n_B}$。\n$$ \\frac{n_A}{n_B} = \\frac{N \\frac{\\sigma_A}{\\sigma_A + \\sigma_B}}{N \\frac{\\sigma_B}{\\sigma_A + \\sigma_B}} = \\frac{\\sigma_A}{\\sigma_B} $$\n最后，我们将 $\\sigma_A$ 和 $\\sigma_B$ 的原始表达式代回：\n$$ \\frac{n_A}{n_B} = \\frac{\\sqrt{\\tilde{p}_A(1-\\tilde{p}_A)}}{\\sqrt{\\tilde{p}_B(1-\\tilde{p}_B)}} $$\n这可以写成一个单一的平方根：\n$$ \\frac{n_A}{n_B} = \\sqrt{\\frac{\\tilde{p}_A(1-\\tilde{p}_A)}{\\tilde{p}_B(1-\\tilde{p}_B)}} $$\n这个结果表明，为了最小化置信区间的宽度，总样本量 $N$ 应该按照相应伯努利分布的标准差成比例分配。", "answer": "$$ \\boxed{\\sqrt{\\frac{\\tilde{p}_A(1-\\tilde{p}_A)}{\\tilde{p}_B(1-\\tilde{p}_B)}}} $$", "id": "1907982"}]}