{"hands_on_practices": [{"introduction": "这个练习将引导你完成一个经典的卡方同质性检验。通过分析一个假设场景中不同咖啡店分店的顾客满意度数据，你将练习计算卡方统计量并将其与临界值进行比较。这是掌握该检验核心机制，即比较多个群体在某个分类变量上的分布是否相同的绝佳实践。", "problem": "一家名为“The Daily Grind”的新特色咖啡连锁店最近在三个不同的区域开设了三家分店：Downtown、Suburbia 和 University Town。管理团队致力于确保其所有分店都能提供一致的客户体验。为评估这一点，他们进行了一项调查，从每家分店随机抽取顾客样本，请他们评价自己的满意度。调查结果汇总在下方的列联表中。\n\n| 分店 | 满意 | 中立 | 不满意 |\n| :--- | :---: | :---: | :---: |\n| Downtown | 85 | 30 | 15 |\n| Suburbia | 110 | 45 | 10 |\n| Univ. Town | 70 | 25 | 35 |\n\n管理层想要确定，这三家分店的顾客满意度评价分布是否存在统计学上的显著差异。使用 $\\alpha = 0.05$ 的显著性水平，以下哪个是最恰当的结论？\n\n在您的分析中，可以利用以下信息：在 0.05 的显著性水平下，自由度为 4 的卡方分布的临界值为 9.488。\n\nA. 有充分证据表明，所有三家分店的顾客满意度分布是相同的。\n\nB. 没有充分证据表明，三家分店的顾客满意度分布是不同的。\n\nC. 有充分证据表明，三家分店的顾客满意度分布是不同的。\n\nD. 数据不具有结论性，因为每家分店的样本量不同。\n\nE. 无法进行分析，因为给定数据未满足该统计检验的至少一个条件。", "solution": "我们检验三家分店分布的同质性。令 $O_{ij}$ 表示第 $i$ 行（分店）和第 $j$ 列（满意度类别）的观测频数，令 $E_{ij}$ 表示在原假设（即各分店的满意度分布相同）下的期望频数。\n\n计算总计。行合计：Downtown $130$ $(85+30+15)$，Suburbia $165$ $(110+45+10)$，University Town $130$ $(70+25+35)$。列合计：满意 $265$ $(85+110+70)$，中立 $100$ $(30+45+25)$，不满意 $60$ $(15+10+35)$。总计 $N=425$。\n\n在原假设下，期望频数为 $E_{ij}=\\frac{(\\text{row total})_{i}(\\text{column total})_{j}}{N}$。因此，\n对于 Downtown (行合计 $130$):\n$$ E_{D,S}=\\frac{130\\cdot 265}{425}=\\frac{1378}{17} \\approx 81.06, \\quad E_{D,N}=\\frac{130\\cdot 100}{425}=\\frac{520}{17} \\approx 30.59, \\quad E_{D,D}=\\frac{130\\cdot 60}{425}=\\frac{312}{17} \\approx 18.35 $$\n对于 Suburbia (行合计 $165$):\n$$ E_{S,S}=\\frac{165\\cdot 265}{425}=\\frac{1749}{17} \\approx 102.88, \\quad E_{S,N}=\\frac{165\\cdot 100}{425}=\\frac{660}{17} \\approx 38.82, \\quad E_{S,D}=\\frac{165\\cdot 60}{425}=\\frac{396}{17} \\approx 23.29 $$\n对于 University Town (行合计 $130$)，与 Downtown 相同:\n$$ E_{U,S}=\\frac{1378}{17} \\approx 81.06, \\quad E_{U,N}=\\frac{520}{17} \\approx 30.59, \\quad E_{U,D}=\\frac{312}{17} \\approx 18.35 $$\n所有期望频数均超过 $5$，因此卡方近似法是有效的。\n\n计算卡方统计量：\n$$ \\chi^{2}=\\sum_{i,j}\\frac{(O_{ij}-E_{ij})^{2}}{E_{ij}} $$\n各分项的贡献值近似计算如下。\nDowntown:\n$$ \\frac{(85-\\frac{1378}{17})^{2}}{\\frac{1378}{17}}\\approx 0.1917, \\quad \\frac{(30-\\frac{520}{17})^{2}}{\\frac{520}{17}}\\approx 0.0113, \\quad \\frac{(15-\\frac{312}{17})^{2}}{\\frac{312}{17}}\\approx 0.6126 $$\nSuburbia:\n$$ \\frac{(110-\\frac{1749}{17})^{2}}{\\frac{1749}{17}}\\approx 0.4927, \\quad \\frac{(45-\\frac{660}{17})^{2}}{\\frac{660}{17}}\\approx 0.9826, \\quad \\frac{(10-\\frac{396}{17})^{2}}{\\frac{396}{17}}\\approx 7.589 $$\nUniversity Town:\n$$ \\frac{(70-\\frac{1378}{17})^{2}}{\\frac{1378}{17}}\\approx 1.509, \\quad \\frac{(25-\\frac{520}{17})^{2}}{\\frac{520}{17}}\\approx 1.021, \\quad \\frac{(35-\\frac{312}{17})^{2}}{\\frac{312}{17}}\\approx 15.096 $$\n将所有贡献值求和可得：\n$$ \\chi^{2}\\approx 0.1917+0.0113+0.6126+0.4927+0.9826+7.589+1.509+1.021+15.096\\approx 27.51 $$\n\n自由度为 $(r-1)(c-1)=(3-1)(3-1)=4$。在 $\\alpha=0.05$ 的显著性水平下，临界值为 $9.488$。由于 $27.51>9.488$，我们拒绝原假设，并得出结论：三家分店的顾客满意度分布不同。因此，最恰当的结论是选项 C。样本量不同不会使检验无效，且所有期望频数均超过 $5$，因此选项 D 和 E 不适用。", "answer": "$$\\boxed{C}$$", "id": "1904292"}, {"introduction": "统计检验的有效性依赖于其基本假设，而独立性是卡方检验的关键前提。这个练习 [@problem_id:1904293] 提出了一个更贴近现实世界的挑战：在应用卡方检验之前，如何从原始数据中正确定义独立的观测单元。通过该案例，你将学会区分相关事件和独立事件，这是确保分析结论有效性的关键一步。", "problem": "一家电子商务公司的数据科学团队正在进行一项 A/B 测试，以评估一种新的推荐算法。一组用户，即处理组 ($G_T$)，接触新算法，而另一组，即对照组 ($G_C$)，继续使用旧算法。在实验期间，对照组记录了 $N_C = 20,000$ 个用户会话，处理组记录了 $N_T = 20,000$ 个用户会话。\n\n该团队的目标是确定新算法是否改变了用户行为的分布。用户行为由三个主要操作来表征：搜索 (S)、添加到购物车 (AC) 和购买 (P)。\n\n生成了原始日志数据的两种不同摘要。\n\n**数据集1：聚合操作计数**\n此表显示了在所有会话中，每个组记录的每种操作的总次数。\n| 操作类型       | 对照组 ($G_C$) | 处理组 ($G_T$) |\n|-----------------|-----------------------|-------------------------|\n| 搜索 (S)        | 45,500                | 43,580                  |\n| 添加到购物车 (AC)| 15,300                | 16,950                  |\n| 购买 (P)        | 5,950                 | 6,350                   |\n\n**数据集2：会话构成计数**\n此表将 40,000 个会话中的每一个，根据该会话中发生的一组唯一操作，划分为七个互斥类别之一。例如，一个包含三次搜索和一次“添加到购物车”操作的会话将被归类为 `{S, AC}`。\n| 会话类别         | 对照组 ($G_C$) | 处理组 ($G_T$) |\n|------------------|-----------------------|-------------------------|\n| {S}              | 12,500                | 11,800                  |\n| {AC}             | 100                   | 150                     |\n| {P}              | 50                    | 70                      |\n| {S, AC}          | 3,500                 | 3,800                   |\n| {S, P}           | 450                   | 500                     |\n| {AC, P}          | 900                   | 1,100                   |\n| {S, AC, P}       | 2,500                 | 2,580                   |\n| **会话总数**     | **20,000**              | **20,000**                  |\n\n\n您的任务是检验原假设，即对照组和处理组的用户行为分布是相同的。您的分析必须基于一种能够正确处理观测值统计独立性的方法。\n\n为此假设检验计算卡方（$\\chi^2$）检验统计量的值。将您的最终答案四舍五入到四位有效数字。", "solution": "我们必须使用统计上独立的观测单位来比较两组之间的用户行为分布。会话内的单个操作不是独立的，因此数据集1（操作计数）会违反独立性原则。数据集2将每个会话分类到七个互斥类别之一；会话是独立的，因此对 2x7 列联表进行同质性卡方检验是合适的。\n\n设 $O_{ij}$ 表示第 $i$ 行（$i \\in \\{G_{C},G_{T}\\}$）和第 $j$ 类（$j \\in \\{1,\\dots,7\\}$）的观测计数。设列总和为 $C_{j}$，总计为 $N=40000$。行总和为 $N_{C}=N_{T}=20000$。在原假设下，即两组的会话类别分布相同，期望计数为\n$$\nE_{ij}=\\frac{(\\text{row total }i)(\\text{column total }j)}{N}=\\frac{20000\\cdot C_{j}}{40000}=\\frac{C_{j}}{2}.\n$$\n根据数据集2，列总和为：\n$$\n\\begin{aligned}\nC_{1}&=12500+11800=24300, & C_{2}&=100+150=250, & C_{3}&=50+70=120, \\\\\nC_{4}&=3500+3800=7300, & C_{5}&=450+500=950, & C_{6}&=900+1100=2000, \\\\\nC_{7}&=2500+2580=5080.\n\\end{aligned}\n$$\n因此，每个组在每个类别中的期望计数为\n$$\nE_{1}=12150,\\quad E_{2}=125,\\quad E_{3}=60,\\quad E_{4}=3650,\\quad E_{5}=475,\\quad E_{6}=1000,\\quad E_{7}=2540.\n$$\n卡方统计量为\n$$\n\\chi^{2}=\\sum_{j=1}^{7}\\sum_{i\\in\\{G_{C},G_{T}\\}}\\frac{(O_{ij}-E_{ij})^{2}}{E_{ij}}.\n$$\n因为对于每个 $j$ 都有 $E_{G_{C},j}=E_{G_{T},j}$ 和 $O_{G_{C},j}-E_{j}=-(O_{G_{T},j}-E_{j})$，所以类别 $j$ 的贡献简化为\n$$\n\\frac{(O_{G_{C},j}-E_{j})^{2}}{E_{j}}+\\frac{(O_{G_{T},j}-E_{j})^{2}}{E_{j}}=2\\cdot\\frac{(O_{G_{C},j}-E_{j})^{2}}{E_{j}}.\n$$\n使用对照组的偏差 $d_{j}=O_{G_{C},j}-E_{j}$ 计算每个类别的贡献：\n- $j=1$：$d_{1}=12500-12150=350$, 贡献 $=2\\cdot\\frac{350^{2}}{12150}=\\frac{4900}{243}$。\n- $j=2$：$d_{2}=100-125=-25$, 贡献 $=2\\cdot\\frac{25^{2}}{125}=10$。\n- $j=3$：$d_{3}=50-60=-10$, 贡献 $=2\\cdot\\frac{10^{2}}{60}=\\frac{10}{3}$。\n- $j=4$：$d_{4}=3500-3650=-150$, 贡献 $=2\\cdot\\frac{150^{2}}{3650}=\\frac{900}{73}$。\n- $j=5$：$d_{5}=450-475=-25$, 贡献 $=2\\cdot\\frac{25^{2}}{475}=\\frac{50}{19}$。\n- $j=6$：$d_{6}=900-1000=-100$, 贡献 $=2\\cdot\\frac{100^{2}}{1000}=20$。\n- $j=7$：$d_{7}=2500-2540=-40$, 贡献 $=2\\cdot\\frac{40^{2}}{2540}=\\frac{160}{127}$。\n\n因此，\n$$\n\\chi^{2}=\\frac{4900}{243}+10+\\frac{10}{3}+\\frac{900}{73}+\\frac{50}{19}+20+\\frac{160}{127}\\approx 69.718130977,\n$$\n保留四位有效数字为 $69.72$。", "answer": "$$\\boxed{69.72}$$", "id": "1904293"}, {"introduction": "当一个总体的同质性检验结果显著时，我们只知道各组之间存在差异，但这并没有告诉我们差异的具体来源。这个高级练习 [@problem_id:1904284] 介绍了一种称为“卡方划分”的事后分析技术。通过将原始列联表分解为更小的、有意义的比较，你将学习如何深入挖掘数据，精确定位导致整体异质性的特定群体或类别。", "problem": "一位生物学家正在研究一种特定基因在三种不同脑细胞类型中的表达模式，这三种细胞类型是：神经元（C1）、星形胶质细胞（C2）和小胶质细胞（C3）。对于每种细胞类型，一个细胞样本根据基因的表达水平被分为四个类别之一：低（G1）、中（G2）、高（G3）或未检测到（G4）。观测到的计数汇总在下面的列联表中：\n\n| 细胞类型 | G1（低） | G2（中） | G3（高） | G4（未检测到） |\n|:---:|:---:|:---:|:---:|:---:|\n| C1 | 5 | 25 | 40 | 10 |\n| C2 | 15 | 30 | 15 | 20 |\n| C3 | 20 | 25 | 10 | 25 |\n\n一项初步分析拒绝了同质性的总零假设，这表明基因表达水平的分布在所有三种细胞类型中不相同。为了确定这种异质性的来源，一名研究人员假设神经元细胞（C1）的表达谱与胶质细胞（C2和C3）组合后的表达谱有显著不同。\n\n计算C1细胞组与C2和C3细胞组合组进行比较的皮尔逊卡方统计量。将您的最终答案四舍五入到四位有效数字。", "solution": "我们比较一个2x4的表格：第1行是$C1$，观测计数为$(5,25,40,10)$；第2行是组合后的胶质细胞$(C2+C3)$，观测计数为$(35,55,25,45)$。行总计分别为$n_{1}=80$，$n_{2}=160$，总计为$N=240$。列总计分别为$T_{1}=40$，$T_{2}=80$，$T_{3}=65$，$T_{4}=55$。\n\n在$C1$和$(C2+C3)$之间同质性的零假设下，期望计数为 $E_{ij} = \\frac{n_{i}T_{j}}{N}$。因此对于$C1$：\n$$\nE_{1\\cdot}=\\left(\\frac{80\\cdot 40}{240},\\frac{80\\cdot 80}{240},\\frac{80\\cdot 65}{240},\\frac{80\\cdot 55}{240}\\right)=\\left(\\frac{40}{3},\\frac{80}{3},\\frac{65}{3},\\frac{55}{3}\\right),\n$$\n对于 $(C2+C3)$：\n$$\nE_{2\\cdot}=\\left(\\frac{160\\cdot 40}{240},\\frac{160\\cdot 80}{240},\\frac{160\\cdot 65}{240},\\frac{160\\cdot 55}{240}\\right)=\\left(\\frac{80}{3},\\frac{160}{3},\\frac{130}{3},\\frac{110}{3}\\right).\n$$\n\n皮尔逊卡方统计量为\n$$\n\\chi^{2}=\\sum_{i=1}^{2}\\sum_{j=1}^{4}\\frac{(O_{ij}-E_{ij})^{2}}{E_{ij}}.\n$$\n计算每一项：\n$$\n\\frac{(5-\\frac{40}{3})^{2}}{\\frac{40}{3}}=\\frac{((-25/3)^{2})}{40/3}=\\frac{625}{9}\\cdot\\frac{3}{40}=\\frac{125}{24},\n$$\n$$\n\\frac{(25-\\frac{80}{3})^{2}}{\\frac{80}{3}}=\\frac{((-5/3)^{2})}{80/3}=\\frac{25}{9}\\cdot\\frac{3}{80}=\\frac{5}{48},\n$$\n$$\n\\frac{(40-\\frac{65}{3})^{2}}{\\frac{65}{3}}=\\frac{((55/3)^{2})}{65/3}=\\frac{3025}{9}\\cdot\\frac{3}{65}=\\frac{605}{39},\n$$\n$$\n\\frac{(10-\\frac{55}{3})^{2}}{\\frac{55}{3}}=\\frac{((-25/3)^{2})}{55/3}=\\frac{625}{9}\\cdot\\frac{3}{55}=\\frac{125}{33},\n$$\n$$\n\\frac{(35-\\frac{80}{3})^{2}}{\\frac{80}{3}}=\\frac{((25/3)^{2})}{80/3}=\\frac{625}{9}\\cdot\\frac{3}{80}=\\frac{125}{48},\n$$\n$$\n\\frac{(55-\\frac{160}{3})^{2}}{\\frac{160}{3}}=\\frac{((5/3)^{2})}{160/3}=\\frac{25}{9}\\cdot\\frac{3}{160}=\\frac{5}{96},\n$$\n$$\n\\frac{(25-\\frac{130}{3})^{2}}{\\frac{130}{3}}=\\frac{((-55/3)^{2})}{130/3}=\\frac{3025}{9}\\cdot\\frac{3}{130}=\\frac{605}{78},\n$$\n$$\n\\frac{(45-\\frac{110}{3})^{2}}{\\frac{110}{3}}=\\frac{((25/3)^{2})}{110/3}=\\frac{625}{9}\\cdot\\frac{3}{110}=\\frac{125}{66}.\n$$\n\n求和得出\n$$\n\\chi^{2}=\\frac{125}{24}+\\frac{5}{48}+\\frac{605}{39}+\\frac{125}{33}+\\frac{125}{48}+\\frac{5}{96}+\\frac{605}{78}+\\frac{125}{66}=\\frac{168945}{4576}\\approx 36.9197895105.\n$$\n四舍五入到四位有效数字，结果为$36.92$。", "answer": "$$\\boxed{36.92}$$", "id": "1904284"}]}