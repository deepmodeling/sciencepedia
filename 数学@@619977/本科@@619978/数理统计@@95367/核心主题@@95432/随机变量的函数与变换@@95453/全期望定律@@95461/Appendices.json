{"hands_on_practices": [{"introduction": "本练习展示了全期望定律在处理分阶段随机实验时的基本应用。通过一个两步抽样过程——首先随机选择一个总体，然后从该总体中抽样——我们可以清晰地看到如何通过对第一阶段结果进行条件化，来计算最终样本的期望。这个方法将一个复杂问题分解为几个更简单的条件期望的加权平均，是应用全期望定律的经典入门。[@problem_id:1928925]", "problem": "一家科技公司的质量控制部门将来自三个不同供应商的电子元件存放在三个独立的大箱子中。每个箱子中元件的组成如下：\n\n- 1号箱包含50个次品元件和50个合格元件。\n- 2号箱包含30个次品元件和90个合格元件。\n- 3号箱包含80个次品元件和20个合格元件。\n\n一名检验员遵循一个两阶段抽样程序。首先，检验员随机选择三个箱子中的一个，每个箱子被选中的概率相等。接着，检验员从选中的箱子中不放回地抽取40个元件作为样本进行检测。\n\n计算检验员样本中次品元件的期望数量。将最终答案四舍五入到三位有效数字。", "solution": "设 $B \\in \\{1,2,3\\}$ 表示均匀随机选择的箱子，因此对每个 $i$ 都有 $P(B=i)=\\frac{1}{3}$。设 $X$ 为大小为 $n=40$ 的样本中次品元件的数量。在选定箱子 $i$ 的条件下，样本服从一个超几何模型，其总体大小为 $N_{i}$，次品数量为 $D_{i}$。根据超几何分布的一个标准性质（或通过使用指示变量的期望线性性质），可得\n$$\n\\mathbb{E}[X \\mid B=i]=n \\cdot \\frac{D_{i}}{N_{i}}.\n$$\n根据全期望定律，\n$$\n\\mathbb{E}[X]=\\sum_{i=1}^{3} P(B=i)\\,\\mathbb{E}[X \\mid B=i]=\\frac{1}{3}\\sum_{i=1}^{3} n \\cdot \\frac{D_{i}}{N_{i}}=\\frac{n}{3}\\left(\\frac{D_{1}}{N_{1}}+\\frac{D_{2}}{N_{2}}+\\frac{D_{3}}{N_{3}}\\right).\n$$\n根据题目数据，$(N_{1},D_{1})=(100,50)$、$(N_{2},D_{2})=(120,30)$ 和 $(N_{3},D_{3})=(100,80)$，且 $n=40$。代入可得，\n$$\n\\mathbb{E}[X]=\\frac{40}{3}\\left(\\frac{50}{100}+\\frac{30}{120}+\\frac{80}{100}\\right)=\\frac{40}{3}\\left(\\frac{1}{2}+\\frac{1}{4}+\\frac{4}{5}\\right).\n$$\n计算括号内的和：\n$$\n\\frac{1}{2}+\\frac{1}{4}+\\frac{4}{5}=\\frac{10+5+16}{20}=\\frac{31}{20}.\n$$\n因此，\n$$\n\\mathbb{E}[X]=\\frac{40}{3}\\cdot \\frac{31}{20}=\\frac{2}{3}\\cdot 31=\\frac{62}{3}\\approx 20.666\\ldots\n$$\n四舍五入到三位有效数字，得到 $20.7$。", "answer": "$$\\boxed{20.7}$$", "id": "1928925"}, {"introduction": "从简单的抽样模型更进一步，本练习将全期望定律应用于一个动态的搜索过程。在许多现实场景中，例如软件调试或资源勘探，我们关心的总成本或总时间取决于一个未知但固定的“目标”位置。通过对目标位置进行条件化，全期望定律为我们提供了一个强大的框架来计算找到目标所需的预期总努力。[@problem_id:1400529]", "problem": "一家软件公司正在调试一个由 $N$ 个不同函数组成的大型计算模块，这些函数的索引从 $1$ 到 $N$。已知一个关键错误（bug）必定位于且仅位于这些函数中的某一个。\n\n错误位于函数 $i$ 中的概率与其复杂度成正比，其复杂度由一个正常数 $c_i$ 给出。调试团队采用顺序测试策略，他们按照函数的索引顺序进行测试，从函数 1 开始，然后是函数 2，以此类推，直到找到错误为止。一旦包含错误的函数被测试，该过程立即停止。\n\n测试函数 $i$ 所需的时间，记为随机变量 $S_i$，服从速率参数为 $\\lambda_i > 0$ 的指数分布。所有函数的测试时间是相互独立的，并且它们也独立于错误的位置。\n\n推导找到错误所需的总时间的期望值 $E[T]$ 的符号表达式。你的最终表达式应以 $N$ 以及参数集 $\\{c_i\\}_{i=1}^N$ 和 $\\{\\lambda_i\\}_{i=1}^N$ 的形式表示。", "solution": "令 $K$ 表示包含错误的函数的（随机）索引。由于错误位于函数 $i$ 中的概率与 $c_i$ 成正比，总权重为 $C \\equiv \\sum_{k=1}^{N} c_{k}$，因此\n$$\n\\mathbb{P}(K=i)=\\frac{c_{i}}{C}, \\quad i=1,\\ldots,N.\n$$\n找到错误的总时间是直到并包括包含错误的函数为止的所有测试时间的总和：\n$$\nT=\\sum_{j=1}^{K} S_{j}.\n$$\n根据全期望定律，\n$$\n\\mathbb{E}[T]=\\mathbb{E}\\!\\left[\\mathbb{E}\\!\\left[T \\mid K\\right]\\right]=\\sum_{i=1}^{N} \\mathbb{P}(K=i)\\,\\mathbb{E}\\!\\left[\\sum_{j=1}^{i} S_{j}\\right].\n$$\n测试时间 $\\{S_{j}\\}_{j=1}^{N}$ 相互独立且独立于 $K$，并且每个 $S_{j}$ 服从速率为 $\\lambda_{j}$ 的指数分布，所以\n$$\n\\mathbb{E}[S_{j}]=\\frac{1}{\\lambda_{j}}, \\quad j=1,\\ldots,N.\n$$\n因此，\n$$\n\\mathbb{E}[T]=\\sum_{i=1}^{N} \\frac{c_{i}}{C}\\sum_{j=1}^{i} \\frac{1}{\\lambda_{j}}.\n$$\n等价地，通过交换求和顺序，\n$$\n\\mathbb{E}[T]=\\frac{1}{C}\\sum_{j=1}^{N} \\frac{1}{\\lambda_{j}} \\sum_{i=j}^{N} c_{i}.\n$$\n以上任一表达式都是一个以 $N$、$\\{c_{i}\\}_{i=1}^{N}$ 和 $\\{\\lambda_{i}\\}_{i=1}^{N}$ 表示的有效的封闭形式。", "answer": "$$\\boxed{\\frac{1}{\\sum_{k=1}^{N} c_{k}} \\sum_{i=1}^{N} c_{i} \\sum_{j=1}^{i} \\frac{1}{\\lambda_{j}}}$$", "id": "1400529"}, {"introduction": "本练习探讨了一个更深层次的应用，其中随机性是层层嵌套的。一个随机过程的结果成为了下一个随机过程的输入参数，形成了所谓的“层级模型”。全期望定律的“塔式法则”性质在这里大放异彩，它允许我们像剥洋葱一样，逐层分解问题，从内到外计算期望，优雅地解决看似复杂的嵌套随机性问题。[@problem_id:1400554]", "problem": "一家研究机构通过一个两阶段随机过程来分配其年度预算 $L$ 美元。首先，在区间 $[0, L]$ 内均匀随机选择一个分割点，将总预算划分为两个子预算。然后，等概率地从这两个子预算中选择一个，分配给一个指定的研究部门。接着，这个被选中的子预算在其长度范围内，再次通过一个均匀随机选择的分割点，被划分为两笔最终的项目经费。\n\n确定这两笔最终项目经费中较小一笔的期望值。将答案表示为含 $L$ 的封闭形式解析表达式。", "solution": "让我们定义这个两阶段过程中涉及的随机变量。\n\n设 $L$ 为初始总预算。\n在第一阶段，预算在一个点 $X_1$ 处被划分，其中 $X_1$ 是一个在 $[0, L]$ 上均匀分布的随机变量。$X_1$ 的概率密度函数 (PDF) 为 $f_{X_1}(x_1) = 1/L$，其中 $x_1 \\in [0, L]$。这产生了两个大小分别为 $X_1$ 和 $L - X_1$ 的子预算。\n\n设 $Y_1$ 为代表从这两个子预算中选出的那一个的大小的随机变量。由于选择是等概率的，给定 $X_1 = x_1$，$Y_1$ 的值为 $x_1$ 的概率是 $1/2$，为 $L-x_1$ 的概率是 $1/2$。\n\n在第二阶段，大小为 $Y_1$ 的被选中的子预算被划分。假设 $Y_1=y_1$。划分点 $X_2$ 在 $[0, y_1]$ 上均匀随机选择。这产生了两个大小分别为 $X_2$ 和 $y_1 - X_2$ 的最终项目经费。\n\n设 $S$ 为这两笔最终经费中较小一笔的大小的随机变量。我们的目标是求 $S$ 的期望值，即 $E[S]$。\n\n我们可以使用全期望定律（也称为迭代期望定律）来解决此问题，该定律指出 $E[S] = E[E[S|Y_1]]$。我们将分两步进行计算：首先计算以 $Y_1$ 为条件的内部期望，然后计算外部期望。\n\n**步骤 1：计算内部期望, $E[S|Y_1=y_1]$**\n\n内部期望 $E[S|Y_1=y_1]$ 是当一个大小为 $y_1$ 的预算被随机分割时，较小那部分的期望值。随机分割点 $X_2$ 在 $[0, y_1]$ 上均匀分布，所以其 PDF 为 $f_{X_2}(x_2) = 1/y_1$，其中 $x_2 \\in [0, y_1]$。较小部分的大小为 $\\min(X_2, y_1-X_2)$。\n\n$$E[S|Y_1=y_1] = E[\\min(X_2, y_1-X_2)] = \\int_{0}^{y_1} \\min(x_2, y_1-x_2) f_{X_2}(x_2) dx_2$$\n\n项 $\\min(x_2, y_1-x_2)$ 在 $x_2 \\le y_1/2$ 时等于 $x_2$，在 $x_2 > y_1/2$ 时等于 $y_1-x_2$。我们在点 $y_1/2$ 处将积分分开：\n\n$$E[S|Y_1=y_1] = \\frac{1}{y_1} \\left( \\int_{0}^{y_1/2} x_2 \\,dx_2 + \\int_{y_1/2}^{y_1} (y_1-x_2) \\,dx_2 \\right)$$\n\n计算第一个积分：\n$$\\int_{0}^{y_1/2} x_2 \\,dx_2 = \\left[ \\frac{x_2^2}{2} \\right]_{0}^{y_1/2} = \\frac{(y_1/2)^2}{2} - 0 = \\frac{y_1^2}{8}$$\n\n计算第二个积分：\n$$\\int_{y_1/2}^{y_1} (y_1-x_2) \\,dx_2 = \\left[ y_1x_2 - \\frac{x_2^2}{2} \\right]_{y_1/2}^{y_1} = \\left(y_1^2 - \\frac{y_1^2}{2}\\right) - \\left(y_1\\frac{y_1}{2} - \\frac{(y_1/2)^2}{2}\\right) = \\frac{y_1^2}{2} - \\left(\\frac{y_1^2}{2} - \\frac{y_1^2}{8}\\right) = \\frac{y_1^2}{8}$$\n\n将这些结果代回到条件期望的表达式中：\n$$E[S|Y_1=y_1] = \\frac{1}{y_1} \\left( \\frac{y_1^2}{8} + \\frac{y_1^2}{8} \\right) = \\frac{1}{y_1} \\left( \\frac{2y_1^2}{8} \\right) = \\frac{y_1}{4}$$\n\n所以，我们得到了一般关系 $E[S|Y_1] = Y_1/4$。\n\n**步骤 2：计算外部期望, $E[Y_1/4]$**\n\n现在我们可以求出 $S$ 的总期望：\n$$E[S] = E[E[S|Y_1]] = E\\left[\\frac{Y_1}{4}\\right] = \\frac{1}{4} E[Y_1]$$\n\n为了求出 $E[Y_1]$，我们再次使用全期望定律，这次以第一个分割点 $X_1$ 为条件。\n$$E[Y_1] = E[E[Y_1|X_1]]$$\n\n给定第一次分割发生在 $X_1 = x_1$ 处，两个子预算的大小为 $x_1$ 和 $L-x_1$。其中一个以等概率 ($1/2$) 被选中。所选子预算大小 $Y_1$ 的条件期望为：\n$$E[Y_1|X_1=x_1] = x_1 \\cdot \\frac{1}{2} + (L-x_1) \\cdot \\frac{1}{2} = \\frac{x_1 + L - x_1}{2} = \\frac{L}{2}$$\n\n这个结果是一个常数，不依赖于 $x_1$。现在我们对 $X_1$ 的所有可能值取期望：\n$$E[Y_1] = E\\left[\\frac{L}{2}\\right]$$\n\n由于 $L/2$ 是一个常数，它的期望就是它本身：\n$$E[Y_1] = \\frac{L}{2}$$\n\n**步骤 3：合并结果**\n\n最后，将 $E[Y_1]$ 的值代回 $E[S]$ 的表达式中：\n$$E[S] = \\frac{1}{4} E[Y_1] = \\frac{1}{4} \\left(\\frac{L}{2}\\right) = \\frac{L}{8}$$\n\n两笔最终项目经费中较小一笔的期望值为 $L/8$。", "answer": "$$\\boxed{\\frac{L}{8}}$$", "id": "1400554"}]}