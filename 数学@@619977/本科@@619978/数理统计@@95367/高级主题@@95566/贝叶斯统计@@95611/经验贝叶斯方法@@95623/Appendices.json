{"hands_on_practices": [{"introduction": "我们的第一个练习将经验贝叶斯方法置于一个实际的数字营销场景中。我们将使用矩方法，从一组观察到的点击率数据中估计贝塔先验分布的参数。这个练习将帮助你掌握从数据中“借力”以学习先验分布的基本步骤，这是经验贝叶斯分析的基石。[@problem_id:1915175]", "problem": "一家数字营销公司正在分析一则新广告在几个不同都市区域的表现。在 $k$ 个区域中的每一个区域，该广告都向 $n$ 个随机选择的个体展示。设 $x_i$ 为在区域 $i$ 点击该广告的个体数量。\n\n该公司使用贝塔-二项模型（Beta-Binomial model）来建模这种情况。对于每个区域 $i$，点击次数 $X_i$ 假定服从二项分布（Binomial distribution），$X_i \\sim \\text{Bin}(n, p_i)$，其中 $p_i$ 是该区域的真实点击率（CTR）。点击率 $p_i$ 本身假定是从一个共同的贝塔分布（Beta distribution）中抽取的，$p_i \\sim \\text{Beta}(\\alpha, \\beta)$，该分布描述了广告效果在不同区域间的变化。\n\n该公司希望使用矩估计法（method of moments）来估计贝塔先验分布（Beta prior distribution）的参数 $\\alpha$ 和 $\\beta$。这包括首先根据观测数据估计先验分布的均值 $\\mu_p$ 和方差 $\\sigma_p^2$。一个标准流程将贝塔先验的矩与观测比例 $\\hat{p}_i = x_i/n$ 的样本统计量联系起来。设 $\\bar{p}$ 是样本比例的均值，$s_p^2$ 是它们的无偏样本方差。基于矩的先验均值和方差的估计量为：\n$$ \\hat{\\mu}_p = \\bar{p} $$\n$$ \\hat{\\sigma}_p^2 = \\frac{n}{n-1}\\left( s_p^2 - \\frac{\\bar{p}(1-\\bar{p})}{n} \\right) $$\n一旦计算出 $\\hat{\\mu}_p$ 和 $\\hat{\\sigma}_p^2$，就可以通过求解矩方程来找到贝塔分布的参数：\n$$ \\hat{\\mu}_p = \\frac{\\hat{\\alpha}}{\\hat{\\alpha}+\\hat{\\beta}} \\quad \\text{和} \\quad \\hat{\\sigma}_p^2 = \\frac{\\hat{\\mu}_p(1-\\hat{\\mu}_p)}{\\hat{\\alpha}+\\hat{\\beta}+1} $$\n\n假设实验在 $k=4$ 个区域进行，每个区域有 $n=50$ 次展示。观测到的点击次数为：\n$$ x_1 = 5, \\quad x_2 = 10, \\quad x_3 = 15, \\quad x_4 = 20 $$\n\n计算矩估计量 $(\\hat{\\alpha}, \\hat{\\beta})$。将最终答案表示为一对最简分数。", "solution": "目标是求出贝塔先验分布参数 $\\alpha$ 和 $\\beta$ 的矩估计量。该过程涉及三个主要步骤：\n1.  从数据中计算描述性统计量。\n2.  使用这些统计量来估计先验分布的均值 $\\mu_p$ 和方差 $\\sigma_p^2$。\n3.  使用矩方程求解贝塔分布的参数 $\\hat{\\alpha}$ 和 $\\hat{\\beta}$。\n\n**步骤 1：计算样本统计量**\n\n观测到的点击次数为 $x_1 = 5, x_2 = 10, x_3 = 15, x_4 = 20$。每个区域的试验次数为 $n=50$。\n首先，我们计算 $k=4$ 个区域中每个区域的样本比例 $\\hat{p}_i = x_i/n$：\n$$ \\hat{p}_1 = \\frac{5}{50} = 0.1 $$\n$$ \\hat{p}_2 = \\frac{10}{50} = 0.2 $$\n$$ \\hat{p}_3 = \\frac{15}{50} = 0.3 $$\n$$ \\hat{p}_4 = \\frac{20}{50} = 0.4 $$\n\n接下来，我们计算这些样本比例的均值 $\\bar{p}$：\n$$ \\bar{p} = \\frac{1}{k} \\sum_{i=1}^{k} \\hat{p}_i = \\frac{0.1 + 0.2 + 0.3 + 0.4}{4} = \\frac{1.0}{4} = 0.25 $$\n\n然后，我们计算这些比例的无偏样本方差 $s_p^2$：\n$$ s_p^2 = \\frac{1}{k-1} \\sum_{i=1}^{k} (\\hat{p}_i - \\bar{p})^2 $$\n$$ s_p^2 = \\frac{1}{3} \\left( (0.1 - 0.25)^2 + (0.2 - 0.25)^2 + (0.3 - 0.25)^2 + (0.4 - 0.25)^2 \\right) $$\n$$ s_p^2 = \\frac{1}{3} \\left( (-0.15)^2 + (-0.05)^2 + (0.05)^2 + (0.15)^2 \\right) $$\n$$ s_p^2 = \\frac{1}{3} \\left( 0.0225 + 0.0025 + 0.0025 + 0.0225 \\right) $$\n$$ s_p^2 = \\frac{1}{3} (0.05) = \\frac{0.05}{3} = \\frac{1}{20 \\times 3} = \\frac{1}{60} $$\n\n**步骤 2：估计先验分布的矩**\n\n使用问题描述中提供的公式，我们估计贝塔先验分布的均值 $\\mu_p$ 和方差 $\\sigma_p^2$。\n均值的估计量就是样本比例的均值：\n$$ \\hat{\\mu}_p = \\bar{p} = 0.25 = \\frac{1}{4} $$\n\n方差的估计量为：\n$$ \\hat{\\sigma}_p^2 = \\frac{n}{n-1}\\left( s_p^2 - \\frac{\\bar{p}(1-\\bar{p})}{n} \\right) $$\n我们代入已知值：$n=50$，$\\bar{p}=0.25$，以及 $s_p^2 = 1/60$。\n$$ \\hat{\\sigma}_p^2 = \\frac{50}{50-1}\\left( \\frac{1}{60} - \\frac{0.25 \\times (1-0.25)}{50} \\right) $$\n$$ \\hat{\\sigma}_p^2 = \\frac{50}{49}\\left( \\frac{1}{60} - \\frac{0.25 \\times 0.75}{50} \\right) = \\frac{50}{49}\\left( \\frac{1}{60} - \\frac{0.1875}{50} \\right) $$\n为了方便分数计算：$0.1875 = \\frac{3}{16}$。\n$$ \\hat{\\sigma}_p^2 = \\frac{50}{49}\\left( \\frac{1}{60} - \\frac{3/16}{50} \\right) = \\frac{50}{49}\\left( \\frac{1}{60} - \\frac{3}{800} \\right) $$\n为括号内的项找一个公分母，即 2400。\n$$ \\hat{\\sigma}_p^2 = \\frac{50}{49}\\left( \\frac{40}{2400} - \\frac{9}{2400} \\right) = \\frac{50}{49}\\left( \\frac{31}{2400} \\right) $$\n$$ \\hat{\\sigma}_p^2 = \\frac{1}{49}\\left( \\frac{31}{48} \\right) = \\frac{31}{2352} $$\n\n**步骤 3：求解贝塔分布的参数 $\\hat{\\alpha}$ 和 $\\hat{\\beta}$**\n\n现在，我们使用贝塔分布的矩方程以及我们的估计值 $\\hat{\\mu}_p$ 和 $\\hat{\\sigma}_p^2$。\n$$ \\hat{\\mu}_p = \\frac{\\hat{\\alpha}}{\\hat{\\alpha}+\\hat{\\beta}} \\quad \\text{和} \\quad \\hat{\\sigma}_p^2 = \\frac{\\hat{\\mu}_p(1-\\hat{\\mu}_p)}{\\hat{\\alpha}+\\hat{\\beta}+1} $$\n从第二个方程，我们可以解出和 $\\hat{\\alpha}+\\hat{\\beta}$：\n$$ \\hat{\\alpha}+\\hat{\\beta}+1 = \\frac{\\hat{\\mu}_p(1-\\hat{\\mu}_p)}{\\hat{\\sigma}_p^2} $$\n$$ \\hat{\\alpha}+\\hat{\\beta} = \\frac{\\hat{\\mu}_p(1-\\hat{\\mu}_p)}{\\hat{\\sigma}_p^2} - 1 $$\n我们来计算 $\\hat{\\mu}_p(1-\\hat{\\mu}_p)$：\n$$ \\hat{\\mu}_p(1-\\hat{\\mu}_p) = \\frac{1}{4} \\left(1-\\frac{1}{4}\\right) = \\frac{1}{4} \\times \\frac{3}{4} = \\frac{3}{16} $$\n现在将这个结果和 $\\hat{\\sigma}_p^2 = \\frac{31}{2352}$ 代入求和的方程中：\n$$ \\hat{\\alpha}+\\hat{\\beta} = \\frac{3/16}{31/2352} - 1 = \\frac{3}{16} \\times \\frac{2352}{31} - 1 $$\n我们简化分数：$2352 \\div 16 = 147$。\n$$ \\hat{\\alpha}+\\hat{\\beta} = \\frac{3 \\times 147}{31} - 1 = \\frac{441}{31} - \\frac{31}{31} = \\frac{410}{31} $$\n现在我们使用第一个矩方程来分别求出 $\\hat{\\alpha}$ 和 $\\hat{\\beta}$。设 $S = \\hat{\\alpha}+\\hat{\\beta} = \\frac{410}{31}$。\n$$ \\hat{\\alpha} = S \\times \\hat{\\mu}_p = \\frac{410}{31} \\times \\frac{1}{4} = \\frac{205}{62} $$\n$$ \\hat{\\beta} = S \\times (1-\\hat{\\mu}_p) = \\frac{410}{31} \\times \\frac{3}{4} = \\frac{205 \\times 3}{31 \\times 2} = \\frac{615}{62} $$\n估计值为 $(\\hat{\\alpha}, \\hat{\\beta}) = \\left(\\frac{205}{62}, \\frac{615}{62}\\right)$。这些是最简分数。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{205}{62}  \\frac{615}{62} \\end{pmatrix}}$$", "id": "1915175"}, {"introduction": "在上一个练习的基础上，本实践展示了估计先验分布的最终目标：为特定个体形成后验分布。通过将我们由数据驱动的先验与来自单个医院的数据相结合，我们将计算后验方差。这个计算量化了我们对该医院真实表现更新后的不确定性，并体现了贝叶斯推断的核心思想。[@problem_id:1915179]", "problem": "一个生物统计学家团队正在分析一项在多家医院进行的新型外科手术的成功率。对于每家医院 $i$，在总共 $n_i$ 次手术中，成功的手术次数 $X_i$ 被记录下来。该团队采用分层模型来解释医院间的变异性。\n\n该模型假设，对于每家医院 $i$，成功次数 $X_i$ 服从参数为 $n_i$ 和 $p_i$ 的二项分布，其中 $p_i$ 是该特定医院的真实成功概率。即，$X_i | p_i \\sim \\text{Binomial}(n_i, p_i)$。此外，假设真实成功率 $p_i$ 本身是从一个共同的潜在分布中抽取的随机变量，该分布被建模为形状参数为 $\\alpha$ 和 $\\beta$ 的贝塔分布。即，$p_i \\sim \\text{Beta}(\\alpha, \\beta)$。\n\n先验分布的参数 $\\alpha$ 和 $\\beta$是未知的。为了估计它们，该团队使用了基于矩估计法的经验贝叶斯方法。在一项研究中，每家医院都进行了相同数量的手术，因此对于所有 $i$，都有 $n_i = n = 50$。从所有医院收集的数据中，计算出成功次数的样本均值为 $\\bar{X} = 40.5$，样本方差为 $S^2 = 75$。\n\n考虑一家特定的医院，Hospital J，它报告了在其 $n=50$ 次手术中有 $X_J = 45$ 次成功。使用经验贝叶斯方法，首先根据汇总统计量（$\\bar{X}$、$S^2$、$n$）估计先验参数 $\\alpha$ 和 $\\beta$，然后确定 Hospital J 的成功概率 $p_J$ 的后验方差。\n\n计算该后验方差并以实数形式报告您的答案。将您的最终答案四舍五入到四位有效数字。", "solution": "我们将 $X_{i} \\mid p_{i}$ 建模为 $\\sim \\text{Binomial}(n, p_{i})$，其中 $p_{i} \\sim \\text{Beta}(\\alpha, \\beta)$。边际上，$X_{i}$ 服从贝塔-二项分布，其中\n$$\n\\mu := \\mathbb{E}[p_{i}] = \\frac{\\alpha}{\\alpha + \\beta}, \n\\quad\nA := \\alpha + \\beta,\n$$\n且对于 $X_{i}$，\n$$\n\\mathbb{E}[X_{i}] = n \\mu, \n\\quad \n\\operatorname{Var}(X_{i}) = n \\mu (1 - \\mu)\\frac{n + A}{A + 1}.\n$$\n\n矩估计法使用所有医院的 $X_i$ 的样本均值和方差。给定 $n=50$，$\\bar{X} = 40.5$ 和 $S^{2} = 75$，我们有\n$$\n\\hat{\\mu} = \\frac{\\bar{X}}{n} = \\frac{40.5}{50} = 0.81,\n\\quad\nn \\hat{\\mu}(1 - \\hat{\\mu}) = 50 \\cdot 0.81 \\cdot 0.19 = 7.695.\n$$\n令理论方差等于样本方差：\n$$\n75 = 7.695 \\cdot \\frac{50 + A}{A + 1}.\n$$\n定义 $r := \\frac{75}{7.695} = \\frac{75000}{7695} = \\frac{15000}{1539}$。 那么\n$$\n\\frac{50 + A}{A + 1} = r \n\\;\\;\\Longrightarrow\\;\\;\n50 + A = r(A + 1)\n\\;\\;\\Longrightarrow\\;\\;\nA(1 - r) = r - 50,\n$$\n所以\n$$\n\\hat{A} = \\frac{r - 50}{1 - r} = \\frac{50 - r}{r - 1}.\n$$\n使用 $r = \\frac{15000}{1539}$，\n$$\n\\hat{A} = \\frac{50 - \\frac{15000}{1539}}{\\frac{15000}{1539} - 1}\n= \\frac{50 \\cdot 1539 - 15000}{15000 - 1539}\n= \\frac{61950}{13461}\n= \\frac{20650}{4487}\n\\approx 4.60218.\n$$\n因此\n$$\n\\hat{\\alpha} = \\hat{\\mu}\\hat{A} = 0.81 \\cdot \\hat{A} = \\frac{81}{100}\\cdot\\frac{20650}{4487} = \\frac{33453}{8974} \\approx 3.72777,\n$$\n$$\n\\hat{\\beta} = (1 - \\hat{\\mu})\\hat{A} = 0.19 \\cdot \\hat{A} = \\frac{19}{100}\\cdot\\frac{20650}{4487} = \\frac{7847}{8974} \\approx 0.87441.\n$$\n\n对于 Hospital J，其 $X_{J} = 45$ 且 $n = 50$， $p_J$ 的后验分布为\n$$\np_{J} \\mid X_{J} \\sim \\text{Beta}(\\hat{\\alpha} + X_{J}, \\hat{\\beta} + n - X_{J})\n= \\text{Beta}\\left(\\hat{\\alpha} + 45, \\hat{\\beta} + 5\\right).\n$$\n于是，\n$$\na_{\\text{post}} = \\hat{\\alpha} + 45 \\approx 48.72777,\n\\quad\nb_{\\text{post}} = \\hat{\\beta} + 5 \\approx 5.87441,\n\\quad\ns_{\\text{post}} = a_{\\text{post}} + b_{\\text{post}} \\approx 54.60218.\n$$\n一个 $\\text{Beta}(a,b)$ 分布的方差为\n$$\n\\operatorname{Var}(p) = \\frac{ab}{(a + b)^{2}(a + b + 1)}.\n$$\n因此，\n$$\n\\operatorname{Var}(p_{J} \\mid X_{J})\n= \\frac{a_{\\text{post}}\\,b_{\\text{post}}}{s_{\\text{post}}^{2}(s_{\\text{post}} + 1)}\n\\approx \\frac{48.72777 \\times 5.87441}{(54.60218)^{2} \\times 55.60218}.\n$$\n数值上，\n$$\na_{\\text{post}}\\,b_{\\text{post}} \\approx 286.24708,\n\\quad\ns_{\\text{post}}^{2}(s_{\\text{post}} + 1) \\approx 165772.23163,\n$$\n所以\n$$\n\\operatorname{Var}(p_{J} \\mid X_{J}) \\approx \\frac{286.24708}{165772.23163} \\approx 0.00172675.\n$$\n四舍五入到四位有效数字，后验方差为 $0.001727$。", "answer": "$$\\boxed{0.001727}$$", "id": "1915179"}, {"introduction": "真实世界的数据并不总是像理论那样完美。最后一个问题将带你直面经验贝叶斯分析中的一个常见挑战：当方差的矩估计结果为负时该如何处理？通过这个正态-正态模型的情景，你将学习到处理这类不合理估计的标准解释和程序，这是非常关键的实践知识。[@problem_id:1915166]", "problem": "一个教育研究团队正在 $J=4$ 个不同学区评估一种新的教学方法。对于每个学区 $j$，他们获得了学生平均分数提升的估计值，记为 $Y_j$。已知该估计值具有特定的抽样方差 $\\sigma_j^2$，其大小取决于该学区研究中的学生人数。研究人员采用经验贝叶斯方法，使用正态-正态分层模型对分数提升进行建模。\n\n模型具体设定如下：\n1.  每个学区观测到的提升 $Y_j$ 是该学区真实但未知的效果 $\\theta_j$ 的估计值。其抽样分布为 $Y_j | \\theta_j \\sim N(\\theta_j, \\sigma_j^2)$。\n2.  假定不同学区的真实效果水平 $\\theta_j$ 来自一个共同的总体分布，该分布通过正态先验进行建模：$\\theta_j \\sim N(\\mu, \\tau^2)$。在这里，$\\mu$ 代表该方法的总体平均效果，$\\tau^2$ 代表各学区间效果的真实方差。\n\n收集到的数据如下：\n-   观测到的分数提升：$Y = \\{8.00, 9.00, 11.00, 12.00\\}$\n-   已知抽样方差：$\\sigma^2 = \\{5.00, 6.00, 7.00, 8.00\\}$\n\n一位分析师的任务是使用矩估计法对观测数据 $\\{Y_j\\}$ 进行分析，以估计学区间方差的超参数 $\\tau^2$。根据此估计结果，必须对模型得出一个结论。\n\n请选择正确陈述了 $\\tau^2$ 的初始矩估计估计值（保留三位有效数字），并描述了在经验贝叶斯框架下标准的解释或后续程序步骤的选项。\n\nA. 估计值为 $\\hat{\\tau}^2 = -3.17$。该估计值被截断为 0，得出的结论是，没有证据表明学区间存在真实的效果差异。\n\nB. 估计值为 $\\hat{\\tau}^2 = 3.33$。这表明学区间的真实方差为正，但小于平均抽样不确定性。\n\nC. 估计值为 $\\hat{\\tau}^2 = -3.17$。负的方差估计值使正态先验假设无效，必须选择不同的先验分布才能继续分析。\n\nD. 估计值为 $\\hat{\\tau}^2 = 6.50$。这表明学区间方差等于平均抽样方差，表示不确定性水平很高。\n\nE. 估计值为 $\\hat{\\tau}^2 = 0$。得到这个值是因为观测值的样本方差小于平均抽样方差，导致矩估计法不适用。", "solution": "我们从已知抽样方差的分层正态模型开始。对于每个学区 $j$，抽样模型为 $Y_{j} \\mid \\theta_{j} \\sim N(\\theta_{j}, \\sigma_{j}^{2})$，先验分布为 $\\theta_{j} \\sim N(\\mu, \\tau^{2})$。根据全方差公式，\n$$\n\\operatorname{Var}(Y_{j}) \\;=\\; \\operatorname{E}\\!\\left[\\operatorname{Var}(Y_{j}\\mid \\theta_{j})\\right] \\;+\\; \\operatorname{Var}\\!\\left(\\operatorname{E}[Y_{j}\\mid \\theta_{j}]\\right) \\;=\\; \\sigma_{j}^{2} \\;+\\; \\tau^{2}.\n$$\n由于各学区的 $\\sigma_{j}^{2}$ 不同，矩估计法将 $\\{Y_{j}\\}$ 的经验方差与模型方差的平均值等同起来：\n$$\n\\frac{1}{J}\\sum_{j=1}^{J}\\operatorname{Var}(Y_{j}) \\;=\\; \\tau^{2} \\;+\\; \\frac{1}{J}\\sum_{j=1}^{J}\\sigma_{j}^{2}.\n$$\n使用观测值的样本方差作为左侧的矩估计量，矩估计法的估计量为\n$$\n\\hat{\\tau}^{2} \\;=\\; s_{Y}^{2} \\;-\\; \\bar{\\sigma^{2}},\n$$\n其中\n$$\n\\bar{\\sigma^{2}} \\;=\\; \\frac{1}{J}\\sum_{j=1}^{J}\\sigma_{j}^{2}, \\qquad s_{Y}^{2} \\;=\\; \\frac{1}{J-1}\\sum_{j=1}^{J}\\left(Y_{j}-\\bar{Y}\\right)^{2}, \\qquad \\bar{Y} \\;=\\; \\frac{1}{J}\\sum_{j=1}^{J}Y_{j}.\n$$\n从数据 $Y=\\{8.00,9.00,11.00,12.00\\}$（$J=4$）计算 $\\bar{Y}$ 和 $s_{Y}^{2}$。首先，\n$$\n\\bar{Y} \\;=\\; \\frac{8+9+11+12}{4} \\;=\\; 10.\n$$\n那么偏差为 $-2,-1,1,2$，偏差的平方和为 $10$，所以\n$$\ns_{Y}^{2} \\;=\\; \\frac{10}{4-1} \\;=\\; \\frac{10}{3}.\n$$\n平均抽样方差为\n$$\n\\bar{\\sigma^{2}} \\;=\\; \\frac{5+6+7+8}{4} \\;=\\; \\frac{26}{4} \\;=\\; \\frac{13}{2}.\n$$\n因此，\n$$\n\\hat{\\tau}^{2} \\;=\\; \\frac{10}{3} \\;-\\; \\frac{13}{2} \\;=\\; \\frac{20-39}{6} \\;=\\; -\\frac{19}{6} \\;\\approx\\; -3.17,\n$$\n保留三位有效数字。在经验贝叶斯实践中，方差分量被约束为非负数，因此负的矩估计值被截断为 $0$。标准的解释是，除了抽样误差之外，没有证据表明学区之间存在真实的异质性，因此继续使用 $\\hat{\\tau}^{2}=0$ 进行分析。\n\n因此，正确选项是 A。", "answer": "$$\\boxed{A}$$", "id": "1915166"}]}