{"hands_on_practices": [{"introduction": "在应用Kaplan-Meier公式之前，最关键的第一步是将原始的事件时间数据整理成结构化的摘要。这项练习将引导你完成这个基础过程，将一系列个体观测数据转化为清晰的生存分析表 [@problem_id:1961488]。掌握这项数据整理技能，能够确保你的计算准确无误，并建立在对每个不同事件时间点的风险人数 ($Y_j$)、事件数 ($d_j$) 和删失数 ($c_j$) 正确理解的基础上。", "problem": "一项临床试验旨在评估新药“Neurostabil”在预防神经系统症状复发方面的疗效。十五名受试者参与了该项研究，研究计划持续12个月。对于每位受试者，数据均以数对 `(time, status)` 的形式记录，其中 `time` 是指直到症状复发（一个事件）或受试者被删失为止的月数，而 `status` 是一个指示变量（1表示事件，0表示删失）。如果受试者退出研究，或者在研究结束时仍未经历事件，则该受试者被视为删失。\n\n15名受试者的数据如下：\n(3, 1), (5, 1), (12, 0), (7, 1), (4, 0), (9, 1), (7, 1), (10, 0), (11, 1), (12, 0), (3, 1), (7, 1), (8, 0), (5, 0), (9, 1)\n\n为进行 Kaplan-Meier 生存分析，需要对这些数据进行总结。设 $t_1 < t_2 < \\dots < t_k$ 为唯一的、按升序排列的事件时间序列。对于每个不同的事件时间 $t_j$（其中 $j=1, \\dots, k$），我们定义以下几个量：\n- $Y_j$：在时间 $t_j$ 之前瞬间处于风险中的受试者数量。如果受试者在时间 $t_j$ 之前尚未发生事件也未被删失，则认为其处于风险中。\n- $d_j$：在时间 $t_j$ 发生事件的受试者数量。\n- $c_j$：在时间区间 $[t_{j-1}, t_j)$ 内被删失的受试者数量，其中 $t_0 = 0$。\n\n确定所有不同事件时间对应的三元组序列 $(Y_j, d_j, c_j)$。将答案表示为一个矩阵，其中第 $j$ 行是第 $j$ 个事件时间对应的三元组。", "solution": "我们总共有15名受试者。设不同的、排序后的事件时间为 $t_{1}<t_{2}<\\dots<t_{k}$。从数据中可知，发生事件（状态为1）的时间点是 $3,5,7,9,11$。排序并计算重数后得到：\n- $t_{1}=3$，有 $d_{1}=2$ 个事件，\n- $t_{2}=5$，有 $d_{2}=1$ 个事件，\n- $t_{3}=7$，有 $d_{3}=3$ 个事件，\n- $t_{4}=9$，有 $d_{4}=2$ 个事件，\n- $t_{5}=11$，有 $d_{5}=1$ 个事件。\n因此 $k=5$ 且 $(d_{1},d_{2},d_{3},d_{4},d_{5})=(2,1,3,2,1)$。\n\n删失时间（状态为0）是 $4,5,8,10,12,12$。根据定义，对于每个 $j$，$c_{j}$ 计算在区间 $[t_{j-1},t_{j})$ 内被删失的数量，其中 $t_{0}=0$。因此：\n- $c_{1}$ 计算在 $[0,3)$ 内的删失数量：没有，所以 $c_{1}=0$。\n- $c_{2}$ 计算在 $[3,5)$ 内的删失数量：只有时间点 $4$，所以 $c_{2}=1$。\n- $c_{3}$ 计算在 $[5,7)$ 内的删失数量：只有时间点 $5$，所以 $c_{3}=1$。\n- $c_{4}$ 计算在 $[7,9)$ 内的删失数量：只有时间点 $8$，所以 $c_{4}=1$。\n- $c_{5}$ 计算在 $[9,11)$ 内的删失数量：只有时间点 $10$，所以 $c_{5}=1$。\n在时间点12发生的删失位于 $[11,\\infty)$ 内，因此对 $j=1,\\dots,5$ 中的任何 $c_{j}$ 都没有贡献。\n\n根据定义，$Y_{j}$ 是在时间 $t_{j}$ 之前瞬间的风险人数。使用 $n=15$ 并应用递归更新，即减去在 $t_{j-1}$ 发生的事件和在 $[t_{j-1},t_{j})$ 内发生的删失，我们得到：\n$$\nY_{1}=n-c_{1}=15-0=15,\n$$\n并且对于 $j\\geq 2$，\n$$\nY_{j}=Y_{j-1}-d_{j-1}-c_{j}.\n$$\n依次计算：\n- $Y_{2}=Y_{1}-d_{1}-c_{2}=15-2-1=12$,\n- $Y_{3}=Y_{2}-d_{2}-c_{3}=12-1-1=10$,\n- $Y_{4}=Y_{3}-d_{3}-c_{4}=10-3-1=6$,\n- $Y_{5}=Y_{4}-d_{4}-c_{5}=6-2-1=3$。\n\n按照事件时间 $t_{j}=(3,5,7,9,11)$ 的顺序，收集 $j=1,\\dots,5$ 的三元组 $(Y_{j},d_{j},c_{j})$，得到一个矩阵，其各行为\n$(15,2,0)$, $(12,1,1)$, $(10,3,1)$, $(6,2,1)$, $(3,1,1)$。", "answer": "$$\\boxed{\\begin{pmatrix}\n15 & 2 & 0 \\\\\n12 & 1 & 1 \\\\\n10 & 3 & 1 \\\\\n6 & 2 & 1 \\\\\n3 & 1 & 1\n\\end{pmatrix}}$$", "id": "1961488"}, {"introduction": "这个练习将带你运用Kaplan-Meier的乘积极限公式 $\\hat{S}(t) = \\prod_{i: t_i \\le t} (1 - \\frac{d_i}{n_i})$ 来计算在特定时间点的生存概率。通过在一个早期的事件时间点进行计算，它让你在不被一长串计算淹没的情况下，练习该公式的迭代性质 [@problem_id:1961438]。这为计算完整的生存曲线打下了坚实的基础。", "problem": "一个材料科学研究小组正在测试一种新型可生物降解电子元件的耐久性。共有8个元件接受了加速老化测试。“事件”定义为元件发生故障。由于测试设备的限制，一些测试在元件发生故障前就停止了；这些观测值被视为“删失”观测值。该研究记录了以下数据，其中每对数据代表（时间（小时），状态），状态“1”表示发生故障，状态“0”表示在该时间点观测被删失：\n\n(15, 1), (25, 1), (40, 1), (30, 0), (50, 1), (35, 0), (55, 0), (20, 1)\n\n在该研究中第二次观测到故障事件的确切时间点，计算生存函数 $\\hat{S}(t)$ 的Kaplan-Meier估计值。将你的答案表示为保留三位有效数字的小数。", "solution": "问题要求在特定时间点计算生存函数 $\\hat{S}(t)$ 的Kaplan-Meier估计值。Kaplan-Meier估计量是一种非参数统计方法，用于根据可能包含删失数据的寿命数据来估计生存函数。该估计量的公式是乘积极限公式：\n$$ \\hat{S}(t) = \\prod_{i: t_i \\le t} \\left( 1 - \\frac{d_i}{n_i} \\right) $$\n其中 $t_i$ 是事件（故障）发生的离散时间点，$d_i$ 是在时间 $t_i$ 发生的事件数，而 $n_i$ 是在时间 $t_i$ 之前处于风险中的个体数（即仍在观测中且未发生故障的元件数）。\n\n首先，我们必须按时间顺序整理数据。数据集包含8个元件的事件/删失时间：(15, 1), (25, 1), (40, 1), (30, 0), (50, 1), (35, 0), (55, 0), (20, 1)。按时间排序后得到：\n\n1.  时间 15: 故障（事件）\n2.  时间 20: 故障（事件）\n3.  时间 25: 故障（事件）\n4.  时间 30: 删失\n5.  时间 35: 删失\n6.  时间 40: 故障（事件）\n7.  时间 50: 故障（事件）\n8.  时间 55: 删失\n\n问题要求在*第二次观测到故障事件*的时间点计算估计值 $\\hat{S}(t)$。从排序后的列表中可知，第一次故障事件发生在 $t=15$ 小时，第二次故障事件发生在 $t=20$ 小时。因此，我们需要计算 $\\hat{S}(20)$。\n\n计算过程涉及对截至 $t=20$（含）的所有离散事件时间点进行乘积运算。相关的事件时间点是 $t_1 = 15$ 和 $t_2 = 20$。\n\n在研究开始时，即 $t=0$ 时，所有8个元件都处于风险中。\n\n**步骤 1: 计算第一个事件在 $t_1 = 15$ 时的生存因子。**\n- 在 $t=15$ 之前处于风险中的元件数是 $n_1 = 8$。\n- 在 $t=15$ 时发生故障的数量是 $d_1 = 1$。\n- 在此事件之后立即计算生存概率估计值。此步骤的因子是 $\\left(1 - \\frac{d_1}{n_1}\\right) = \\left(1 - \\frac{1}{8}\\right) = \\frac{7}{8}$。\n- 对于区间 $[15, 20)$ 中的任何时间 $t$，Kaplan-Meier估计值为 $\\hat{S}(t) = \\frac{7}{8}$。\n\n**步骤 2: 计算第二个事件在 $t_2 = 20$ 时的生存因子。**\n- 为了找到在 $t=20$ 之前处于风险中的元件数，我们从上一个事件之前处于风险中的数量（$n_1=8$）开始，减去在该时间点与当前时间点之间发生事件或被删失的所有个体。在 $t=15$ 时有1个元件发生故障。在 $t=15$ 和 $t=20$ 之间没有元件被删失。\n- 因此，在 $t=20$ 之前处于风险中的元件数是 $n_2 = 8 - 1 = 7$。\n- 在 $t=20$ 时发生故障的数量是 $d_2 = 1$。\n- 此步骤的因子是 $\\left(1 - \\frac{d_2}{n_2}\\right) = \\left(1 - \\frac{1}{7}\\right) = \\frac{6}{7}$。\n\n**步骤 3: 结合各因子以求得 $\\hat{S}(20)$。**\n在 $t=20$ 时的Kaplan-Meier估计值是发生在该时间点或之前的所有事件的生存因子的乘积。\n$$ \\hat{S}(20) = \\prod_{i: t_i \\le 20} \\left( 1 - \\frac{d_i}{n_i} \\right) = \\left(1 - \\frac{d_1}{n_1}\\right) \\times \\left(1 - \\frac{d_2}{n_2}\\right) $$\n$$ \\hat{S}(20) = \\left(\\frac{7}{8}\\right) \\times \\left(\\frac{6}{7}\\right) $$\n'7' 项相互抵消：\n$$ \\hat{S}(20) = \\frac{6}{8} = \\frac{3}{4} $$\n换算成小数，结果是 $0.75$。\n\n问题要求答案保留三位有效数字。为了将 $0.75$ 表示为三位有效数字，我们在末尾加一个零。\n\n因此，Kaplan-Meier估计值为 $0.750$。", "answer": "$$\\boxed{0.750}$$", "id": "1961438"}, {"introduction": "这个练习探讨了Kaplan-Meier曲线的一个关键特性：当最后一次观测到的数据是一个“事件”（如此处材料的断裂）时，生存曲线的长期行为会如何。当最后一个处于风险中的样本经历事件时，风险集中的数量 ($n_i$) 和事件发生的数量 ($d_i$) 相等（且都为1），这导致生存概率因子 $(1 - 1/1)$ 变为 $0$，从而使总生存概率降至零 [@problem_id:1961480]。理解这一点有助于正确解读生存曲线的末端，并将其与研究结束时仍有删失个体（此时生存曲线不会降至 $0$）的情况区分开来。", "problem": "在一个材料科学实验室中，进行了一项实验来研究一种新型复合材料的疲劳寿命。十五个相同的该材料样本经受了连续的高频应力测试。记录了每个样本的断裂时间。由于实验限制，一些测试在样本断裂前被终止；这些被视为删失观测值。\n\n数据集包含15个观测值，记录为（时间，状态）对，其中时间以小时为单位，状态是一个二元指示符：1表示断裂事件，0表示删失观测。收集到的数据如下：\n\n(50, 1), (65, 0), (70, 1), (82, 0), (90, 1), (95, 0), (105, 0), (110, 1), (112, 1), (118, 0), (120, 1), (125, 0), (130, 1), (140, 0), (150, 1).\n\n您的任务是计算该材料生存函数 $\\hat{S}(t)$ 的Kaplan-Meier估计。根据您的计算，确定当时间趋于无穷大时生存函数的极限值。\n\n请以单个数值的形式提供 $\\lim_{t \\to \\infty} \\hat{S}(t)$ 的值。", "solution": "Kaplan-Meier估计量的定义为\n$$\n\\hat{S}(t)=\\prod_{t_{i}\\leq t}\\left(1-\\frac{d_{i}}{n_{i}}\\right),\n$$\n其中，$t_{i}$ 是排序后的不同事件时间，$d_{i}$ 是在 $t_{i}$ 时刻的失败数（事件数），$n_{i}$ 是在 $t_{i}$ 时刻之前的风险数。\n\n对数据进行排序，并区分事件时间和删失时间。事件时间为 $50,70,90,110,112,120,130,150$（八个事件）。删失时间为 $65,82,95,105,118,125,140$（七个删失）。开始时有 $n=15$ 个个体处于风险中。\n\n按时间顺序跟踪风险集和事件：\n- 在 $t=50$（事件）：$n_{1}=15$，$d_{1}=1$；之后剩余风险数 = $14$。\n- $t=65$（删失）：之后剩余风险数 = $13$。\n- 在 $t=70$（事件）：$n_{2}=13$，$d_{2}=1$；之后剩余风险数 = $12$。\n- $t=82$（删失）：之后剩余风险数 = $11$。\n- 在 $t=90$（事件）：$n_{3}=11$，$d_{3}=1$；之后剩余风险数 = $10$。\n- $t=95$（删失）：之后剩余风险数 = $9$。\n- $t=105$（删失）：之后剩余风险数 = $8$。\n- 在 $t=110$（事件）：$n_{4}=8$，$d_{4}=1$；之后剩余风险数 = $7$。\n- 在 $t=112$（事件）：$n_{5}=7$，$d_{5}=1$；之后剩余风险数 = $6$。\n- $t=118$（删失）：之后剩余风险数 = $5$。\n- 在 $t=120$（事件）：$n_{6}=5$，$d_{6}=1$；之后剩余风险数 = $4$。\n- $t=125$（删失）：之后剩余风险数 = $3$。\n- 在 $t=130$（事件）：$n_{7}=3$，$d_{7}=1$；之后剩余风险数 = $2$。\n- $t=140$（删失）：之后剩余风险数 = $1$。\n- 在 $t=150$（事件）：$n_{8}=1$，$d_{8}=1$；之后剩余风险数 = $0$。\n\n因此，对于 $t\\geq 150$ 的乘积包括以下因子\n$$\n\\left(1-\\frac{1}{15}\\right)\\left(1-\\frac{1}{13}\\right)\\left(1-\\frac{1}{11}\\right)\\left(1-\\frac{1}{8}\\right)\\left(1-\\frac{1}{7}\\right)\\left(1-\\frac{1}{5}\\right)\\left(1-\\frac{1}{3}\\right)\\left(1-\\frac{1}{1}\\right).\n$$\n最后一个因子等于零，因为在 $t=150$ 时，有一个处于风险中的个体发生了失败，所以 $1-1/1=0$。因此，对于所有 $t\\geq 150$，\n$$\n\\hat{S}(t)=0,\n$$\n因此\n$$\n\\lim_{t\\to\\infty}\\hat{S}(t)=0.\n$$", "answer": "$$\\boxed{0}$$", "id": "1961480"}]}