{"hands_on_practices": [{"introduction": "吉布斯采样的核心在于迭代地从全条件分布中抽取样本。这个练习将该算法分解为最基本的一步，要求你手动执行一次完整的迭代。通过使用逆变换采样法，你将具体地体会到马尔可夫链是如何从一个状态转移到下一个状态的，从而为理解更复杂的应用打下坚实的基础。", "problem": "考虑一个二维随机向量 $(X, Y)$，其联合概率分布由以下完全条件分布定义：\n- 给定 $Y=y$ 时，$X$ 的条件分布是速率参数为 $y$ 的指数分布。其概率密度函数为 $p(x|y) = y \\exp(-yx)$，其中 $x > 0$。\n- 给定 $X=x$ 时，$Y$ 的条件分布是均值参数为 $x$ 的泊松分布。其概率质量函数为 $p(y=k|x) = \\frac{x^k \\exp(-x)}{k!}$，其中 $k \\in \\{0, 1, 2, \\dots\\}$。\n\n您的任务是执行一次吉布斯采样器的完整迭代。从初始状态 $(x^{(0)}, y^{(0)}) = (2, 3)$ 开始，您将生成一个新状态 $(x^{(1)}, y^{(1)})$。迭代过程如下：首先，从分布 $p(x|y^{(0)})$ 中为 $x^{(1)}$ 抽取一个样本；然后，使用这个新值 $x^{(1)}$，从分布 $p(y|x^{(1)})$ 中为 $y^{(1)}$ 抽取一个样本。\n\n为了生成所需的随机变量，您必须使用逆变换采样法。请使用以下从 $\\text{Uniform}(0,1)$ 分布中抽取的随机数：\n- 为生成 $x^{(1)}$，使用均匀随机数 $u_x = 0.600$。\n- 为生成 $y^{(1)}$，使用均匀随机数 $u_y = 0.750$。\n\n新状态 $(x^{(1)}, y^{(1)})$ 的数值是什么？$x^{(1)}$ 的值必须四舍五入到四位有效数字。", "solution": "我们使用逆变换采样法执行一次吉布斯更新。\n\n1) 从 $p(x \\mid y^{(0)}=3)$ 中采样 $x^{(1)}$。\n对于速率为 $y$ 的指数分布，其条件累积分布函数 (CDF) 为\n$$\nF(x \\mid y)=1-\\exp(-yx), \\quad x>0.\n$$\n逆变换采样法使用 $u_{x}=F(x \\mid y)$，因此\n$$\nx^{(1)}=F^{-1}(u_{x})=-\\frac{1}{y^{(0)}}\\ln\\!\\bigl(1-u_{x}\\bigr).\n$$\n当 $y^{(0)}=3$ 且 $u_{x}=0.600$ 时，\n$$\nx^{(1)}=-\\frac{1}{3}\\ln(1-0.600)=-\\frac{1}{3}\\ln(0.4)=\\frac{1}{3}\\ln(2.5)\\approx 0.3054302439.\n$$\n四舍五入到四位有效数字：$x^{(1)}=0.3054$。\n\n2) 使用 $u_{y}=0.750$ 从 $p(y \\mid x^{(1)})$ 中采样 $y^{(1)}$。\n对于均值为 $x$ 的泊松分布，其概率质量函数 (pmf) 为\n$$\np(y=k \\mid x)=\\frac{x^{k}\\exp(-x)}{k!}, \\quad k\\in\\{0,1,2,\\dots\\}.\n$$\n对于离散分布，逆变换采样法选择满足 $F(k \\mid x)=\\sum_{j=0}^{k}p(j \\mid x)\\ge u_{y}$ 的最小 $k$。\n\n当 $x=x^{(1)}=\\frac{1}{3}\\ln(2.5)$ 时，计算\n$$\np(0 \\mid x)=\\exp(-x)=\\exp\\!\\Bigl(-\\tfrac{1}{3}\\ln(2.5)\\Bigr)=2.5^{-1/3}\\approx 0.7368.\n$$\n由于 $p(0 \\mid x)=0.7368<0.750$，继续计算 $k=1$ 的情况：\n$$\np(1 \\mid x)=x\\exp(-x)=x\\,2.5^{-1/3}\\approx 0.30543\\times 0.7368\\approx 0.2250.\n$$\n然后\n$$\nF(1 \\mid x)=p(0 \\mid x)+p(1 \\mid x)\\approx 0.7368+0.2250=0.9618>0.750,\n$$\n因此满足 $F(k \\mid x)\\ge 0.750$ 的最小 $k$ 是 $k=1$。所以 $y^{(1)}=1$。\n\n因此，新状态为 $(x^{(1)},y^{(1)})=(0.3054,1)$，其中 $x^{(1)}$ 被四舍五入到四位有效数字。", "answer": "$$\\boxed{\\begin{pmatrix}0.3054 & 1\\end{pmatrix}}$$", "id": "1920320"}, {"introduction": "在掌握了单步操作后，理解采样器在一系列步骤中的行为至关重要。这个练习探讨了目标分布中的相关性如何显著影响采样器的探索效率，即“混合”速度。通过对比高相关性和低相关性下的采样路径，你将直观地理解吉布斯采样的一个常见瓶颈及其背后的原因。[@problem_id:1363771]", "problem": "一位统计学家正在使用吉布斯采样器（一种马尔可夫链蒙特卡洛（MCMC）算法）从一个二元概率分布中抽取样本。对于一个二元分布 $p(x, y)$，其一般步骤如下：\n1.  从一个任意的起始点 $(x_0, y_0)$ 开始。\n2.  对于每次迭代 $t=1, 2, \\dots, N$：\n    a. 从全条件分布 $p(x | y = y_{t-1})$ 中抽取一个新值 $x_t$。\n    b. 从全条件分布 $p(y | x = x_t)$ 中抽取一个新值 $y_t$。\n由此得到的点序列 $\\{(x_t, y_t)\\}_{t=1}^N$ 构成一个马尔可夫链，其平稳分布是目标分布 $p(x, y)$。\n\n该统计学家对两个特定的目标分布感兴趣，它们都是均值为 $\\mu_X = \\mu_Y = 0$、标准差为 $\\sigma_X = \\sigma_Y = 1$ 的二元正态分布。这两个分布仅在相关系数 $\\rho$ 上有所不同。\n-   **分布 A**：相关系数为 $\\rho_A = 0.1$ 的二元正态分布。\n-   **分布 B**：相关系数为 $\\rho_B = 0.98$ 的二元正态分布。\n\n该统计学家对每个分布运行一个吉布斯采样器，并生成两个长的样本点序列。当在 $xy$-平面上绘制这些序列的路径时，观察到两种截然不同的定性行为，描述如下。\n\n-   **路径描述 1**：点序列在整个样本空间中自由移动。从一个点 $(x_{t-1}, y_{t-1})$ 到下一个点 $(x_t, y_t)$ 的转移可以导致大的位移，并且路径迅速覆盖了分布概率质量的主要、近圆形的区域。\n-   **路径描述 2**：点序列表现出高度自相关的增量式移动。其路径的特点是一系列小的、与坐标轴对齐的步长，形成一条独特的阶梯状轨迹，缓慢地遍历分布概率质量的狭窄、椭圆形区域。\n\n以下哪个陈述正确地将分布与观察到的采样器路径描述相匹配？\n\nA. 分布 A 对应路径 2，分布 B 对应路径 1。\nB. 两种分布都会生成类似于路径 1 的路径。\nC. 分布 A 对应路径 1，分布 B 对应路径 2。\nD. 两种分布都会生成类似于路径 2 的路径。\nE. 路径特征与相关性无关，仅取决于所使用的随机种子。", "solution": "这个问题的核心在于理解二元正态分布的相关系数 $\\rho$ 如何影响吉布斯采样器的行为。关键在于用于采样的条件分布的性质。\n\n对于一个一般的、均值为 $(\\mu_X, \\mu_Y)$、标准差为 $(\\sigma_X, \\sigma_Y)$、相关系数为 $\\rho$ 的二元正态分布 $(X, Y)$，其全条件分布也是正态分布：\n1.  在 $Y=y$ 的条件下，$X$ 的分布为 $X | (Y=y) \\sim \\mathcal{N}\\left(\\mu_X + \\rho\\frac{\\sigma_X}{\\sigma_Y}(y - \\mu_Y), \\sigma_X^2(1-\\rho^2)\\right)$。\n2.  在 $X=x$ 的条件下，$Y$ 的分布为 $Y | (X=x) \\sim \\mathcal{N}\\left(\\mu_Y + \\rho\\frac{\\sigma_Y}{\\sigma_X}(x - \\mu_X), \\sigma_Y^2(1-\\rho^2)\\right)$。\n\n在我们讨论的特定问题中，参数被简化为：$\\mu_X = \\mu_Y = 0$ 且 $\\sigma_X = \\sigma_Y = 1$。将这些值代入通用公式，我们得到该特定情况下的条件分布：\n1.  $X | (Y=y) \\sim \\mathcal{N}(\\rho y, 1-\\rho^2)$\n2.  $Y | (X=x) \\sim \\mathcal{N}(\\rho x, 1-\\rho^2)$\n\n吉布斯采样器在步骤 $t$ 从 $p(x | y_{t-1})$ 中抽取 $x_t$，然后从 $p(y | x_t)$ 中抽取 $y_t$。让我们针对给定的两个分布来分析这个过程。\n\n**情况 1：分布 A，其 $\\rho_A = 0.1$（低相关性）**\n\n对于此分布，条件分布为：\n-   $X | (Y=y) \\sim \\mathcal{N}(0.1y, 1 - 0.1^2) = \\mathcal{N}(0.1y, 0.99)$。\n-   $Y | (X=x) \\sim \\mathcal{N}(0.1x, 1 - 0.1^2) = \\mathcal{N}(0.1x, 0.99)$。\n\n$x_t$ 的条件分布的均值为 $0.1 y_{t-1}$，对于典型的 $y_{t-1}$ 值来说（因为边际方差为1），这个均值非常接近于零。该条件分布的方差为 $0.99$，这个值很大，接近于边际方差1。这意味着新值 $x_t$ 是从一个很宽的分布中抽取的，并且只弱依赖于前一个值 $y_{t-1}$。在从 $p(y|x_t)$ 中抽取 $y_t$ 时，也适用类似的逻辑。由于步长是从宽分布中抽取的，并且几乎与前一状态无关，因此采样器可以进行大的跳跃，并有效地探索状态空间。这种行为与**路径描述 1**相匹配。\n\n**情况 2：分布 B，其 $\\rho_B = 0.98$（高相关性）**\n\n对于此分布，条件分布为：\n-   $X | (Y=y) \\sim \\mathcal{N}(0.98y, 1 - 0.98^2) = \\mathcal{N}(0.98y, 0.0396)$。\n-   $Y | (X=x) \\sim \\mathcal{N}(0.98x, 1 - 0.98^2) = \\mathcal{N}(0.98x, 0.0396)$。\n\n在这里，情况截然不同。$x_t$ 的条件分布均值为 $0.98y_{t-1}$。方差为 $0.0396$，这是一个非常小的值。这意味着新值 $x_t$ 将从一个非常狭窄的分布中抽取，其中心非常接近 $y_{t-1}$ 的值。也就是说，$x_t \\approx 0.98 y_{t-1}$。\n随后，在抽取 $y_t$ 时，我们从一个以 $0.98x_t$ 为中心的狭窄分布中抽取。因此，$y_t \\approx 0.98 x_t$。\n将这些结合起来，我们看到 $y_t \\approx 0.98 (0.98 y_{t-1}) \\approx 0.96 y_{t-1}$。这表明链中的连续值高度相关且变化非常缓慢。采样器被迫采取非常小的步长。由于更新是每次一个变量地进行（首先平行于x轴移动，然后平行于y轴移动），这个过程在沿着分布的狭窄高概率区域（对于高正相关，该区域位于直线 $y=x$ 附近）缓慢移动时，会产生一种“阶梯状”或“之字形”的模式。这种行为与**路径描述 2**相匹配。\n\n**结论**\n\n-   分布 A（低相关性）导致高效的探索，步长大且相关性较低，与路径 1 相匹配。\n-   分布 B（高相关性）导致缓慢的探索，步长小且高度相关、与坐标轴对齐，与路径 2 相匹配。\n\n因此，正确的匹配是分布 A 对应于路径 1，分布 B 对应于路径 2。这与选项 C 相符。根据此分析，选项 A、B、D 和 E 均不正确。", "answer": "$$\\boxed{C}$$", "id": "1363771"}, {"introduction": "运行MCMC采样器本身并不足够，我们还必须检验其是否已经收敛到目标分布。这个问题模拟了一个典型的非收敛场景，要求你解读来自不同起始点的两条链的轨迹图。这培养了从视觉上诊断收敛性的关键技能，这是MCMC在实际应用中必不可少的一环。[@problem_id:1920355]", "problem": "一位数据科学家正在使用吉布斯采样器（一种马尔可夫链蒙特卡洛 (MCMC) 算法）从一个复杂的、一维的参数 $\\theta$ 的后验概率分布中抽取样本。为了诊断采样器是否收敛到目标分布，他们从两个截然不同的起始点初始化了两条独立的 MCMC 链。\n\n在将两条链都运行了 20,000 次迭代后，该数据科学家检查了轨迹图，这些图显示了每次迭代中 $\\theta$ 的值。对这些图的目视检查描述如下：\n\n- **链 1：** 以 $\\theta_0 = -15.0$ 初始化。在全部 20,000 次迭代中，$\\theta$ 的采样值迅速移动到并随后在近似区间 $[-8.5, -6.5]$ 内波动，表现出与以 $-7.5$ 为中心的平稳时间序列一致的行为。\n- **链 2：** 以 $\\theta_0 = 15.0$ 初始化。在全部 20,000 次迭代中，$\\theta$ 的采样值迅速移动到并随后在近似区间 $[6.5, 8.5]$ 内波动，表现出与以 $7.5$ 为中心的平稳时间序列一致的行为。\n\n根据对轨迹图的这种文字描述，关于吉布斯采样器性能的最恰当结论是什么？\n\nA. 采样器已成功收敛。$\\theta$ 的后验分布显然是双峰的，峰值在 $-7.5$ 和 $7.5$ 附近。\nB. 两条链没有混合。这强烈表明采样器未能收敛并探索整个参数空间。\nC. 采样器工作正常，但“预烧期”(burn-in)太短。从每条链中丢弃前 10,000 个样本将确保剩余样本来自真实的后验分布。\nD. $\\theta$ 的后验分布是单峰的，均值为 $0$，这是两条链均值的平均值。这些链仅仅显示了分布的范围。\nE. 起始值相距不够远。需要以 -100 和 100 为起始值重新运行，才能对收敛性做出任何有效结论。", "solution": "我们考虑马尔可夫链蒙特卡洛收敛到目标后验分布 $\\pi(\\theta)$ 的定义：对于一个在 $\\pi(\\theta)$ 下具有不变转移核的马尔可夫链，收敛要求 $\\theta_{t}$ 的边际分布在 $t \\to \\infty$ 时趋近于 $\\pi(\\theta)$，无论初始状态如何。在实践中，一个标准的诊断方法是运行多个过度分散的链，并检查它们的轨迹图是否重叠，以及这些链是否在参数空间的相同区域内混合。\n\n从描述中可知，链 1 迅速移动到并随后保持在近似区间 $[-8.5,-6.5]$ 内，表现出以 -7.5 为中心的明显平稳性，而链 2 迅速移动到并随后保持在近似区间 $[6.5,8.5]$ 内，表现出以 7.5 为中心的明显平稳性。在 20,000 次迭代中，两条链都没有在这些不相交的区域之间发生穿越。这表明每条链都被困在参数空间的不同区域，并且没有跨区域混合。\n\n一个标准的定量检查是 Gelman–Rubin 潜在尺度缩减因子。设有 $m$ 条长度为 $n$ 的链，将各链的均值表示为 $\\bar{\\theta}_{i\\cdot}$，总均值表示为 $\\bar{\\theta}_{\\cdot\\cdot}$。链间方差为\n$$\nB=\\frac{n}{m-1}\\sum_{i=1}^{m}\\left(\\bar{\\theta}_{i\\cdot}-\\bar{\\theta}_{\\cdot\\cdot}\\right)^{2},\n$$\n而链内方差为\n$$\nW=\\frac{1}{m}\\sum_{i=1}^{m}s_{i}^{2},\n$$\n其中 $s_{i}^{2}$ 是链 $i$ 内的样本方差。边际方差的估计值为\n$$\n\\hat{V}=\\frac{n-1}{n}W+\\frac{1}{n}B,\n$$\n潜在尺度缩减因子为\n$$\n\\hat{R}=\\sqrt{\\frac{\\hat{V}}{W}}.\n$$\n鉴于两条链的均值相距甚远，链内重叠很少，$B$ 相对于 $W$ 很大，这意味着 $\\hat{R}>1$，表明缺乏收敛性。\n\n关于各个选项：\n- 选项 A 不成立：尽管目标后验分布可能是双峰的，但收敛要求每条链都根据 $\\pi(\\theta)$ 探索整个支撑集。两条链持续分离且没有发生模态切换，这表明它们没有混合，也未能探索两个峰。仅凭链停留在不相交的区域这一现象，不能断定已经成功收敛。\n- 选项 C 不正确：当任何时候都没有发生区域间的转换时，丢弃早期迭代（预烧期）并不能解决缺乏转换的问题。\n- 选项 D 不正确：断言后验分布是均值为 0 的单峰分布，这与在分离区域中的不相交、平稳行为相矛盾；对链的均值进行平均并不能验证后验分布的特征。\n- 选项 E 不正确：起始值已经相距很远；增加该距离并不能解决跨峰不混合的问题。\n\n因此，正确的结论是两条链没有混合，这表明采样器未能收敛并探索整个参数空间。", "answer": "$$\\boxed{B}$$", "id": "1920355"}]}