{
    "hands_on_practices": [
        {
            "introduction": "要对辐射传输进行建模，我们首先必须理解大气对辐射的透明或不透明程度。本练习  将指导您从第一性原理出发，推导垂直光学深度 $\\tau_{\\nu}(p)$，并将其与大气压力和标高这两个基本结构属性直接联系起来。通过计算大气变得光学厚 ($\\tau \\approx 1$) 的压力层，您将对大部分恒星能量被吸收或热能被发射的区域获得具体的理解。",
            "id": "4174953",
            "problem": "考虑一个巨型系外行星上处于静力学平衡下的平行平面、等温的氢气大气层。该大气层具有恒定的标高 $H$，以及一个垂直方向上均匀分布的吸收物，其波段平均消光系数与当地的质量密度成正比。在选定的窄光谱带中，参考压力 $p_{\\mathrm{ref}}$ 下单位长度的波段平均消光系数为 $k_{\\nu,0}$，且在任意高度 $z$ 处，局地消光系数为 $k_{\\nu}(z) = k_{\\nu,0}\\,p(z)/p_{\\mathrm{ref}}$。假设波段内温度恒定，因此标高 $H$ 也为常数，并假设吸收物混合比恒定。\n\n仅从光学深度、静力平衡和等温标高关系的定义出发，推导从大气层顶部到压力为 $p$ 的高度处的垂直光学深度 $\\tau_{\\nu}(p)$ 的表达式，该表达式应使用 $k_{\\nu,0}$、$H$ 和 $p/p_{\\mathrm{ref}}$ 来表示。然后，使用此表达式：\n\n- 计算 $p = 1\\,\\mathrm{bar}$ 处的垂直光学深度。\n- 确定使 $\\tau_{\\nu}(p^{\\ast}) = 1$ 的压力层 $p^{\\ast}$。\n\n使用以下数值：$H = 27.5\\,\\mathrm{km}$，$p_{\\mathrm{ref}} = 1.0\\,\\mathrm{bar}$，以及在 $p_{\\mathrm{ref}}$ 处 $k_{\\nu,0} = 3.20 \\times 10^{-5}\\,\\mathrm{m}^{-1}$。请以 $\\mathrm{bar}$ 为单位表示 $p^{\\ast}$。将 $1\\,\\mathrm{bar}$ 处的光学深度和 $p^{\\ast}$ 均四舍五入至三位有效数字。最终答案必须是包含这两个值的一行，顺序为 $\\left(\\tau_{\\nu}(1\\,\\mathrm{bar}),\\,p^{\\ast}\\right)$。",
            "solution": "经评估，该问题有效。它科学地基于大气物理学原理，问题阐述清晰，目标明确，且没有不一致或模糊之处。\n\n目标是推导垂直光学深度 $\\tau_{\\nu}(p)$ 作为压力 $p$ 的函数的表达式，然后用它来计算两个特定的量。推导从基本定义开始。\n\n垂直光学深度 $\\tau_{\\nu}$ 由其微分定义，从大气层顶部（此处压力 $p \\to 0$ 且高度 $z \\to \\infty$）向下积分至某一特定高度。沿垂直路径 $dz$ 的光学深度微分元 $d\\tau_{\\nu}$ 由下式给出：\n$$d\\tau_{\\nu} = -k_{\\nu}(z) dz$$\n其中 $k_{\\nu}(z)$ 是高度 $z$ 处的消光系数。负号表示光学深度随着向下移动（$z$ 减小）而增加。\n\n问题指出大气处于静力学平衡状态。静力平衡方程为：\n$$\\frac{dp}{dz} = -\\rho(z) g$$\n其中 $p(z)$ 是压力，$\\rho(z)$ 是质量密度，$g$ 是重力加速度，假定在相关的大气高度范围内为常数。\n\n问题还指出大气是等温的。对于温度 $T$ 恒定的理想气体，压力和密度通过 $p = \\rho R_s T$ 相关联，其中 $R_s$ 是特定气体常数。这可以改写为 $\\rho(z) = \\frac{p(z)}{R_s T}$。将此式代入静力平衡方程，得到：\n$$\\frac{dp}{dz} = -\\frac{g}{R_s T} p(z)$$\n量 $\\frac{R_s T}{g}$ 具有长度的单位，被定义为压力标高 $H$。因此，$H = \\frac{R_s T}{g}$。方程变为：\n$$\\frac{dp}{dz} = -\\frac{p(z)}{H}$$\n由此，我们可以用压力微分元 $dp$ 来表示高度微分元 $dz$：\n$$dz = -H \\frac{dp}{p}$$\n\n现在我们可以用压力来表示光学深度微分 $d\\tau_{\\nu}$。我们已知消光系数的关系式：\n$$k_{\\nu}(z) = k_{\\nu,0} \\frac{p(z)}{p_{\\mathrm{ref}}}$$\n将 $k_{\\nu}(z)$ 和 $dz$ 的表达式代入 $d\\tau_{\\nu}$ 的定义中：\n$$d\\tau_{\\nu} = -\\left(k_{\\nu,0} \\frac{p}{p_{\\mathrm{ref}}}\\right) \\left(-H \\frac{dp}{p}\\right)$$\n分子和分母中的压力 $p$相互抵消，得到一个简化表达式：\n$$d\\tau_{\\nu} = \\frac{k_{\\nu,0} H}{p_{\\mathrm{ref}}} dp$$\n为了求出从大气层顶部（压力为 $0$）到压力为 $p$ 的高度的总光学深度 $\\tau_{\\nu}(p)$，我们对 $d\\tau_{\\nu}$ 进行积分：\n$$\\tau_{\\nu}(p) = \\int_{0}^{p} \\frac{k_{\\nu,0} H}{p_{\\mathrm{ref}}} dp'$$\n由于 $k_{\\nu,0}$、$H$ 和 $p_{\\mathrm{ref}}$ 都是常数，这个积分很简单：\n$$\\tau_{\\nu}(p) = \\frac{k_{\\nu,0} H}{p_{\\mathrm{ref}}} \\int_{0}^{p} dp' = \\frac{k_{\\nu,0} H}{p_{\\mathrm{ref}}} [p']_{0}^{p}$$\n这就得到了垂直光学深度作为压力函数的最终表达式：\n$$\\tau_{\\nu}(p) = \\frac{k_{\\nu,0} H p}{p_{\\mathrm{ref}}}$$\n这也可以写作 $\\tau_{\\nu}(p) = (k_{\\nu,0} H) \\left(\\frac{p}{p_{\\mathrm{ref}}}\\right)$。\n\n利用这个表达式，我们可以使用所提供的数据计算所需的值：$H = 27.5\\,\\mathrm{km}$，$p_{\\mathrm{ref}} = 1.0\\,\\mathrm{bar}$，以及 $k_{\\nu,0} = 3.20 \\times 10^{-5}\\,\\mathrm{m}^{-1}$。\n\n首先，我们计算 $p = 1\\,\\mathrm{bar}$ 处的垂直光学深度。\n在 $p = 1.0\\,\\mathrm{bar}$ 时，比值 $p/p_{\\mathrm{ref}} = 1.0\\,\\mathrm{bar} / 1.0\\,\\mathrm{bar} = 1$。光学深度为：\n$$\\tau_{\\nu}(1\\,\\mathrm{bar}) = k_{\\nu,0} H$$\n我们必须使用一致的单位。标高 $H$ 以千米为单位给出，所以我们将其转换为米：$H = 27.5\\,\\mathrm{km} = 27.5 \\times 10^3\\,\\mathrm{m}$。\n$$\\tau_{\\nu}(1\\,\\mathrm{bar}) = (3.20 \\times 10^{-5}\\,\\mathrm{m}^{-1}) \\times (27.5 \\times 10^3\\,\\mathrm{m})$$\n$$\\tau_{\\nu}(1\\,\\mathrm{bar}) = 3.20 \\times 27.5 \\times 10^{-2} = 88.0 \\times 10^{-2} = 0.88$$\n四舍五入到三位有效数字，结果是 $0.880$。这是一个无量纲的量，符合光学深度的预期。\n\n其次，我们确定光学深度为1时的压力层 $p^{\\ast}$，即 $\\tau_{\\nu}(p^{\\ast}) = 1$。\n使用推导出的公式：\n$$1 = \\frac{k_{\\nu,0} H p^{\\ast}}{p_{\\mathrm{ref}}}$$\n求解 $p^{\\ast}$：\n$$p^{\\ast} = p_{\\mathrm{ref}} \\frac{1}{k_{\\nu,0} H}$$\n我们已经计算出乘积 $k_{\\nu,0} H$ 的值为 $0.880$。\n$$p^{\\ast} = (1.0\\,\\mathrm{bar}) \\times \\frac{1}{0.880}$$\n$$p^{\\ast} \\approx 1.13636... \\,\\mathrm{bar}$$\n四舍五入到三位有效数字，我们得到：\n$$p^{\\ast} = 1.14\\,\\mathrm{bar}$$\n\n需要报告的两个值是 $1\\,\\mathrm{bar}$ 处的光学深度和光学深度为1时的压力 $p^{\\ast}$。\n$\\tau_{\\nu}(1\\,\\mathrm{bar}) = 0.880$\n$p^{\\ast} = 1.14\\,\\mathrm{bar}$",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.880  1.14 \\end{pmatrix}}$$"
        },
        {
            "introduction": "大气并非总是单独通过辐射来传输能量；当辐射温度梯度变得过于陡峭时，对流就会启动。这个动手编程练习  聚焦于史瓦西判据 (Schwarzschild criterion)，这是这两种能量传输机制之间的根本转换开关。您将推导辐射梯度 $\\nabla_{\\mathrm{rad}}$，并实现一个算法来精确定位不同行星大气中对流开始的确切压力层。",
            "id": "4174979",
            "problem": "考虑一个处于稳态的巨行星的一维平行平面大气层，其垂直辐射通量 $F$ 和重力加速度 $g$ 均为常数。假设局域热力学平衡成立，且辐射扩散近似适用。垂直坐标为 $z$，压力为 $P(z)$，温度为 $T(z)$，密度为 $\\rho(z)$，罗斯兰平均不透明度为 $\\kappa(P,T)$。当无量纲辐射温度梯度 $\\nabla_{\\mathrm{rad}}$ 超过无量纲绝热梯度 $\\nabla_{\\mathrm{ad}}$ 时，根据史瓦西判据，对流开始发生。\n\n仅从以下基本原理出发：\n- 流体静力学平衡：$\\dfrac{dP}{dz} = -\\rho g$。\n- 净通量的辐射扩散：$F = -\\dfrac{16 \\sigma T^3}{3 \\kappa \\rho} \\dfrac{dT}{dz}$，其中 $\\sigma$ 是斯特藩-玻尔兹曼常数。\n- 无量纲温度梯度的定义：$\\nabla \\equiv \\dfrac{d \\ln T}{d \\ln P}$。\n- 绝热指数 $\\gamma$（比热容比）为常数的理想气体绝热梯度：$\\nabla_{\\mathrm{ad}} = \\dfrac{\\gamma - 1}{\\gamma}$。\n\n推导辐射梯度 $\\nabla_{\\mathrm{rad}}$ 关于 $P$、$T$、$\\kappa$、$F$、$g$ 和物理常数的表达式，然后用它通过找到 $\\nabla_{\\mathrm{rad}} \\ge \\nabla_{\\mathrm{ad}}$ 的最浅压力层级，来确定给定测试大气中对流的起始。\n\n对于不透明度，使用压力-温度幂律：\n$$\n\\kappa(P,T) = \\kappa_0 \\left( \\dfrac{P}{P_{\\mathrm{ref}}} \\right)^{a} \\left( \\dfrac{T}{T_{\\mathrm{ref}}} \\right)^{b},\n$$\n其中 $P_{\\mathrm{ref}} = 10^5 \\ \\mathrm{Pa}$ 且 $T_{\\mathrm{ref}} = 1000 \\ \\mathrm{K}$。在每个测试案例中，绝热指数 $\\gamma$ 被视为常数。\n\n对于每个测试案例，在以下对数等距的压力网格上计算 $\\nabla_{\\mathrm{rad}}(P_i,T_i)$，并与 $\\nabla_{\\mathrm{ad}}$ 比较，以确定对流将开始的第一个（最小 $P$）层级。如果没有层级是对流不稳定的，则报告 $-1$。\n\n所有物理量必须使用以下单位：$P$ 的单位为 $\\mathrm{Pa}$，$T$ 的单位为 $\\mathrm{K}$，$F$ 的单位为 $\\mathrm{W} \\ \\mathrm{m}^{-2}$，$g$ 的单位为 $\\mathrm{m} \\ \\mathrm{s}^{-2}$，$\\kappa$ 的单位为 $\\mathrm{m}^2 \\ \\mathrm{kg}^{-1}$。本问题不使用角度。您的程序应生成一行输出，其中包含一个逗号分隔的列表，用方括号括起来（例如 $[p_1,p_2,p_3]$），其中每个 $p_i$ 是相应测试案例中对流不稳定最浅层级的压力（单位为 $\\mathrm{Pa}$），如果没有则为 $-1$。\n\n测试套件：\n- 案例 A（内部通量较弱的巨行星）：\n  - $g = 24.79 \\ \\mathrm{m} \\ \\mathrm{s}^{-2}$, $F = 6 \\ \\mathrm{W} \\ \\mathrm{m}^{-2}$, $\\gamma = 1.4$。\n  - 不透明度参数：$\\kappa_0 = 2 \\times 10^{-2} \\ \\mathrm{m}^2 \\ \\mathrm{kg}^{-1}$, $a = 0.5$, $b = 1.0$。\n  - 压力网格：$N = 12$ 个层级，从 $P_{\\min} = 10^4 \\ \\mathrm{Pa}$ 到 $P_{\\max} = 10^7 \\ \\mathrm{Pa}$ 对数等距分布。\n  - 温度剖面：$T(P) = T_0 \\left( \\dfrac{P}{P_0} \\right)^{\\alpha}$，其中 $T_0 = 130 \\ \\mathrm{K}$，$P_0 = 10^4 \\ \\mathrm{Pa}$，$\\alpha = 0.25$。\n- 案例 B（强辐照的热木星）：\n  - $g = 20 \\ \\mathrm{m} \\ \\mathrm{s}^{-2}$, $F = 1500 \\ \\mathrm{W} \\ \\mathrm{m}^{-2}$, $\\gamma = 1.42$。\n  - 不透明度参数：$\\kappa_0 = 5 \\times 10^{-2} \\ \\mathrm{m}^2 \\ \\mathrm{kg}^{-1}$, $a = 1.0$, $b = 0.0$。\n  - 压力网格：$N = 12$ 个层级，从 $P_{\\min} = 10^4 \\ \\mathrm{Pa}$ 到 $P_{\\max} = 10^7 \\ \\mathrm{Pa}$ 对数等距分布。\n  - 温度剖面：$T(P) = T_0 \\left( \\dfrac{P}{P_0} \\right)^{\\alpha}$，其中 $T_0 = 1000 \\ \\mathrm{K}$，$P_0 = 10^4 \\ \\mathrm{Pa}$，$\\alpha = 0.05$。\n- 案例 C（中等通量，混合不透明度依赖性）：\n  - $g = 30 \\ \\mathrm{m} \\ \\mathrm{s}^{-2}$, $F = 200 \\ \\mathrm{W} \\ \\mathrm{m}^{-2}$, $\\gamma = 1.35$。\n  - 不透明度参数：$\\kappa_0 = 3 \\times 10^{-2} \\ \\mathrm{m}^2 \\ \\mathrm{kg}^{-1}$, $a = 0.7$, $b = 0.7$。\n  - 压力网格：$N = 12$ 个层级，从 $P_{\\min} = 10^4 \\ \\mathrm{Pa}$ 到 $P_{\\max} = 10^7 \\ \\mathrm{Pa}$ 对数等距分布。\n  - 温度剖面：$T(P) = T_0 \\left( \\dfrac{P}{P_0} \\right)^{\\alpha}$，其中 $T_0 = 300 \\ \\mathrm{K}$，$P_0 = 10^4 \\ \\mathrm{Pa}$，$\\alpha = 0.20$。\n\n算法要求：\n- 使用提供的基本定律和定义推导 $\\nabla_{\\mathrm{rad}}$，不引入任何其他快捷公式。\n- 对于每个测试案例，使用指定的 $\\kappa(P,T)$、$P$、$T$、$F$ 和 $g$ 在每个网格层级上评估 $\\nabla_{\\mathrm{rad}}$。\n- 对于每个测试案例，根据 $\\gamma$ 计算 $\\nabla_{\\mathrm{ad}}$。\n- 确定 $\\nabla_{\\mathrm{rad}} \\ge \\nabla_{\\mathrm{ad}}$ 的最浅压力层级。如果不存在这样的层级，则该案例返回 $-1$。\n\n最终输出格式：\n- 您的程序应打印一行，包含一个含有三个条目的列表，每个测试案例一个，格式完全为 $[p_A,p_B,p_C]$，其中每个 $p_X$ 是对流起始时的压力浮点数（单位 $\\mathrm{Pa}$）（满足 $\\nabla_{\\mathrm{rad}} \\ge \\nabla_{\\mathrm{ad}}$ 的最小 $P$），如果没有任何层级不稳定，则为整数 $-1$。",
            "solution": "用户提供的问题已经过严格验证，被确定为一个有效、适定的科学问题。它在科学上基于大气物理学原理，其表述是客观的，并且是自洽的，为获得唯一解提供了所有必要信息。该问题要求推导一个关键物理量，并在指定条件下对其进行数值评估，这是行星科学中的一个标准且有意义的练习。\n\n问题的核心是确定行星大气中对流的起始。当一个气块垂直位移后，其密度变得比周围环境小并继续上升时，对流便开始。该条件由史瓦西判据描述，该判据指出，如果实际温度梯度比绝热温度梯度更陡，则大气对对流不稳定。用无量纲梯度表示，该判据为 $\\nabla_{\\mathrm{rad}} \\ge \\nabla_{\\mathrm{ad}}$。我们的任务是推导辐射梯度 $\\nabla_{\\mathrm{rad}}$ 的表达式，然后将此判据应用于给定的测试案例。\n\n首先，我们推导辐射梯度 $\\nabla_{\\mathrm{rad}}$ 的表达式。无量纲温度梯度的定义如下：\n$$\n\\nabla \\equiv \\dfrac{d \\ln T}{d \\ln P}\n$$\n当温度结构完全由辐射传输决定时，辐射梯度 $\\nabla_{\\mathrm{rad}}$ 就是这个量。使用链式法则，我们可以写出：\n$$\n\\nabla_{\\mathrm{rad}} = \\dfrac{d \\ln T}{d \\ln P} = \\dfrac{P}{T} \\dfrac{dT}{dP}\n$$\n为了求出温度对压力的导数 $\\dfrac{dT}{dP}$，我们再次使用链式法则，这次是关于垂直坐标 $z$ 的：\n$$\n\\dfrac{dT}{dP} = \\dfrac{dT}{dz} \\dfrac{dz}{dP}\n$$\n问题提供了求 $\\dfrac{dT}{dz}$ 和 $\\dfrac{dz}{dP}$ 所需的两个基本方程。\n\n从流体静力学平衡方程：\n$$\n\\dfrac{dP}{dz} = -\\rho g\n$$\n我们可以通过取倒数得到 $\\dfrac{dz}{dP}$：\n$$\n\\dfrac{dz}{dP} = -\\dfrac{1}{\\rho g}\n$$\n从净通量 $F$ 的辐射扩散方程：\n$$\nF = -\\dfrac{16 \\sigma T^3}{3 \\kappa \\rho} \\dfrac{dT}{dz}\n$$\n我们可以解出物理温度梯度 $\\dfrac{dT}{dz}$：\n$$\n\\dfrac{dT}{dz} = -\\dfrac{3 \\kappa \\rho F}{16 \\sigma T^3}\n$$\n现在，我们将这两个表达式代入 $\\dfrac{dT}{dP}$ 的方程中：\n$$\n\\dfrac{dT}{dP} = \\left( -\\dfrac{3 \\kappa \\rho F}{16 \\sigma T^3} \\right) \\left( -\\dfrac{1}{\\rho g} \\right) = \\dfrac{3 \\kappa F}{16 \\sigma g T^3}\n$$\n值得注意的是，密度 $\\rho$ 被消掉了，这简化了表达式，并且无需使用状态方程来确定 $\\rho$。\n\n最后，我们将这个 $\\dfrac{dT}{dP}$ 的结果代入我们对 $\\nabla_{\\mathrm{rad}}$ 的定义中：\n$$\n\\nabla_{\\mathrm{rad}} = \\dfrac{P}{T} \\left( \\dfrac{3 \\kappa F}{16 \\sigma g T^3} \\right)\n$$\n这给出了辐射梯度关于所需变量的最终推导表达式：\n$$\n\\nabla_{\\mathrm{rad}} = \\dfrac{3 F \\kappa P}{16 g \\sigma T^4}\n$$\n\n解决问题的算法流程如下：\n对于每个测试案例，我们都给定了一组大气参数（$g$、$F$、$\\gamma$）、不透明度参数（$\\kappa_0$、$a$、$b$）、压力网格规格（$P_{\\min}$、$P_{\\max}$、$N$）和温度-压力剖面（$T_0$、$P_0$、$\\alpha$）。\n\n1.  计算绝热梯度 $\\nabla_{\\mathrm{ad}}$。由于 $\\gamma$ 是常数，因此该值对于每个案例都是恒定的：\n    $$\n    \\nabla_{\\mathrm{ad}} = \\dfrac{\\gamma - 1}{\\gamma}\n    $$\n2.  生成一个从 $P_{\\min}$ 到 $P_{\\max}$ 的 $N$ 个点的对数等距压力网格。\n3.  按压力递增的顺序遍历压力网格点 $P_i$。\n4.  对于每个压力层级 $P_i$：\n    a. 使用给定的剖面计算相应的温度 $T_i$：\n       $$\n       T_i = T_0 \\left( \\dfrac{P_i}{P_0} \\right)^{\\alpha}\n       $$\n    b. 使用幂律公式计算该层级的罗斯兰平均不透明度 $\\kappa_i$：\n       $$\n       \\kappa_i = \\kappa_0 \\left( \\dfrac{P_i}{P_{\\mathrm{ref}}} \\right)^{a} \\left( \\dfrac{T_i}{T_{\\mathrm{ref}}} \\right)^{b}\n       $$\n    c. 使用我们推导的公式计算辐射梯度 $\\nabla_{\\mathrm{rad}, i}$：\n       $$\n       \\nabla_{\\mathrm{rad}, i} = \\dfrac{3 F \\kappa_i P_i}{16 g \\sigma T_i^4}\n       $$\n    d. 比较辐射梯度和绝热梯度。如果 $\\nabla_{\\mathrm{rad}, i} \\ge \\nabla_{\\mathrm{ad}}$，则该层级的大气对对流不稳定。\n5.  测试案例的解是满足对流判据的第一个（最浅的，即最小的）压力 $P_i$。如果循环完成仍未满足判据，则该案例的结果为 $-1$。\n\n该程序将为所提供的三个测试案例中的每一个执行此过程。斯特藩-玻尔兹曼常数 $\\sigma$ 取值为 $5.670374419 \\times 10^{-8} \\ \\mathrm{W} \\ \\mathrm{m}^{-2} \\ \\mathrm{K}^{-4}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.constants import sigma\n\ndef solve():\n    \"\"\"\n    Computes the shallowest pressure level for the onset of convection in\n    several model planetary atmospheres.\n    \"\"\"\n    \n    # Reference constants for opacity calculation\n    P_ref = 1e5  # Pa\n    T_ref = 1e3  # K\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"g\": 24.79, \"F\": 6.0, \"gamma\": 1.4,\n            \"kappa0\": 2e-2, \"a\": 0.5, \"b\": 1.0,\n            \"N\": 12, \"P_min\": 1e4, \"P_max\": 1e7,\n            \"T0\": 130.0, \"P0\": 1e4, \"alpha\": 0.25,\n        },\n        {\n            \"name\": \"Case B\",\n            \"g\": 20.0, \"F\": 1500.0, \"gamma\": 1.42,\n            \"kappa0\": 5e-2, \"a\": 1.0, \"b\": 0.0,\n            \"N\": 12, \"P_min\": 1e4, \"P_max\": 1e7,\n            \"T0\": 1000.0, \"P0\": 1e4, \"alpha\": 0.05,\n        },\n        {\n            \"name\": \"Case C\",\n            \"g\": 30.0, \"F\": 200.0, \"gamma\": 1.35,\n            \"kappa0\": 3e-2, \"a\": 0.7, \"b\": 0.7,\n            \"N\": 12, \"P_min\": 1e4, \"P_max\": 1e7,\n            \"T0\": 300.0, \"P0\": 1e4, \"alpha\": 0.20,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current case\n        g = case[\"g\"]\n        F = case[\"F\"]\n        gamma = case[\"gamma\"]\n        kappa0 = case[\"kappa0\"]\n        a = case[\"a\"]\n        b = case[\"b\"]\n        N = case[\"N\"]\n        P_min = case[\"P_min\"]\n        P_max = case[\"P_max\"]\n        T0 = case[\"T0\"]\n        P0 = case[\"P0\"]\n        alpha = case[\"alpha\"]\n\n        # 1. Calculate the constant adiabatic gradient\n        nabla_ad = (gamma - 1.0) / gamma\n\n        # 2. Create the logarithmically spaced pressure grid\n        P_grid = np.logspace(np.log10(P_min), np.log10(P_max), N)\n\n        # 3. Iterate through pressure levels to find onset of convection\n        onset_pressure = -1.0\n        for P in P_grid:\n            # 4a. Calculate temperature from the T-P profile\n            T = T0 * (P / P0)**alpha\n            \n            # 4b. Calculate opacity\n            kappa = kappa0 * (P / P_ref)**a * (T / T_ref)**b\n            \n            # 4c. Calculate the radiative gradient\n            nabla_rad_numerator = 3.0 * F * kappa * P\n            nabla_rad_denominator = 16.0 * g * sigma * T**4\n            nabla_rad = nabla_rad_numerator / nabla_rad_denominator\n            \n            # 4d. Check for convection onset (Schwarzschild criterion)\n            if nabla_rad >= nabla_ad:\n                onset_pressure = P\n                break  # Found the shallowest level, stop searching\n\n        results.append(onset_pressure)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最终目标是通过平衡辐射能量传输与对流混合，来预测行星的垂直温度结构。这个综合性问题  将挑战您从头开始构建一个完整的一维辐射-对流平衡模型。通过同时实现半灰色辐射传输方案和对流调整算法，您将探索高空云等现象如何重塑行星的整个热剖面和对流层顶结构。",
            "id": "4174946",
            "problem": "您的任务是为一个行星大气实现一个自洽的、单柱的辐射-对流平衡 (RCE) 模型，该模型基于半灰色双流近似，并量化增加一个高云层如何改变平衡状态下的温度-气压剖面 $T(p)$ 和对流层顶的高度。背景是行星科学和系外行星建模。您的程序必须计算指定测试套件的结果，并按如下所述格式生成一行输出。\n\n推导和实现的基本依据：\n- 静力平衡：$dp/dz = -\\rho g$。\n- 理想气体定律：$p = \\rho R T$，其中 $R$ 是比气体常数。\n- 大气层顶的辐射能量平衡：$\\sigma T_{\\mathrm{eff}}^{4} = (1 - A) S / 4$，其中 $\\sigma$ 是斯特藩-玻尔兹曼常数，$A$ 是邦德反照率，$S$ 是入射到大气层顶的恒星辐照度（也称为恒星常数）。\n- 用于热红外辐射平衡的双流、爱丁顿半灰色长波近似，假设存在一个均匀混合的长波吸收体。不考虑大气层内的任何短波吸收；短波仅用于设定 $T_{\\mathrm{eff}}$。\n\n建模要求：\n1. 气压坐标与光学厚度：\n   - 使用一个从大气层顶气压 $p_{\\mathrm{top}}$ 到地表气压 $p_{\\mathrm{surf}}$ 的气压网格。\n   - 假设热红外光学厚度与质量路径成正比（均匀混合吸收体），因此晴空条件下朝向太空的累积长波光学厚度随气压增加而增加。\n   - 一个高云层表示为在气压水平 $p_{\\mathrm{cloud}}$ 处的一个无限薄层，它会使所有更深层之上的累积长波光学厚度增加一个增量 $\\Delta \\tau_{\\mathrm{cloud}}$，而云层以上的高度不受影响。\n\n2. 辐射平衡剖面：\n   - 在半灰色双流爱丁顿近似下，使用由 $T_{\\mathrm{eff}}$ 定义的吸收通量，推导出辐射平衡温度剖面 $T_{\\mathrm{rad}}(p)$。\n   - 晴空情况使用基准的长波光学厚度剖面。\n   - 有云情况使用修改后的长波光学厚度剖面，其中按所述方式应用了云的增量。\n\n3. 对流调整与对流层顶识别：\n   - 用气压坐标定义干绝热递减率：$T_{\\mathrm{conv}}(p) = T_{\\mathrm{tp}} \\left( \\frac{p}{p_{\\mathrm{tp}}} \\right)^{R/c_{p}}$，其中 $T_{\\mathrm{tp}}$ 是对流层顶气压 $p_{\\mathrm{tp}}$ 处的温度，$R$ 是比气体常数，$c_{p}$ 是定压比热。\n   - 实现一个对流调整，当需要对流时（即辐射平衡剖面是超绝热的，相对于干绝热剖面会变得不稳定），用锚定在 $T_{\\mathrm{rad}}(p_{\\mathrm{tp}})$ 的干绝热线替换候选 $p_{\\mathrm{tp}}$ 以下的辐射平衡剖面。\n   - 将对流层顶识别为最高海拔（最低气压）的层，该层以上的大气保持辐射平衡，而其下的对流绝热线温度不低于辐射平衡温度（即，对于所有更深的层次，$T_{\\mathrm{conv}}(p) \\ge T_{\\mathrm{rad}}(p)$）。如果任何地方都不需要对流，则将对流层顶高度定义为 $0$。\n\n4. 高度计算：\n   - 通过对静力学关系与理想气体定律结合的方程进行数值积分，计算每个气压层相对于地表（地表处 $z=0$）的几何高度 $z(p)$：\n     $$ \\frac{dz}{dp} = -\\frac{R T(p)}{g p}。$$\n     对每种情况，使用最终的 RCE 温度剖面执行此积分。\n\n5. 每个测试用例需报告的量：\n   - 由于增加云层而引起的温度剖面 $T(p)$ 的最大绝对变化，以开尔文表示，即\n     $$ \\Delta T_{\\max} = \\max_{p} \\left| T_{\\mathrm{RCE,cloud}}(p) - T_{\\mathrm{RCE,clear}}(p) \\right|。$$\n   - 对流层顶高度的变化（有云减去晴空），以米表示，即\n     $$ \\Delta z_{\\mathrm{tp}} = z_{\\mathrm{tp,cloud}} - z_{\\mathrm{tp,clear}}。$$\n\n数值和物理细节：\n- 所有温度必须以开尔文为单位。\n- 所有高度必须以米为单位。\n- 气压必须以帕斯卡为单位。\n- 重力加速度 $g$ 以米每平方秒为单位。\n- 比热 $c_{p}$ 和比气体常数 $R$ 以焦耳每千克每开尔文为单位。\n- 光学厚度是无量纲的。\n\n实现约束：\n- 使用一个在 $p_{\\mathrm{top}}$ 和 $p_{\\mathrm{surf}}$ 之间至少有 $200$ 个层级的对数间隔气压网格（以解析高层大气）。\n- 使用斯特藩-玻尔兹曼常数 $\\sigma = 5.670374419 \\times 10^{-8}$ 瓦特每平方米每开尔文的四次方。\n- 在物理要求的地方，确保数值稳定性和单调性。\n\n测试套件：\n为以下四种情况提供计算。对于每种情况，使用指定的参数。\n- 情况 1（类地，光学厚）：$p_{\\mathrm{surf}} = 1.0 \\times 10^{5}$，$p_{\\mathrm{top}} = 100.0$，$g = 9.81$，$c_{p} = 1004.0$，$R = 287.0$，$S = 1361.0$，$A = 0.30$，$\\tau_{\\mathrm{surf}} = 3.0$，$p_{\\mathrm{cloud}} = 2.0 \\times 10^{4}$，$\\Delta \\tau_{\\mathrm{cloud}} = 1.0$。\n- 情况 2（类火星，稀薄大气）：$p_{\\mathrm{surf}} = 600.0$，$p_{\\mathrm{top}} = 1.0$，$g = 3.71$，$c_{p} = 730.0$，$R = 189.0$，$S = 586.0$，$A = 0.25$，$\\tau_{\\mathrm{surf}} = 0.2$，$p_{\\mathrm{cloud}} = 50.0$，$\\Delta \\tau_{\\mathrm{cloud}} = 0.5$。\n- 情况 3（超级地球，浓厚大气）：$p_{\\mathrm{surf}} = 2.0 \\times 10^{5}$，$p_{\\mathrm{top}} = 100.0$，$g = 15.0$，$c_{p} = 1000.0$，$R = 300.0$，$S = 1700.0$，$A = 0.20$，$\\tau_{\\mathrm{surf}} = 5.0$，$p_{\\mathrm{cloud}} = 1.0 \\times 10^{4}$，$\\Delta \\tau_{\\mathrm{cloud}} = 2.0$。\n- 情况 4（类地边界，无云增量）：$p_{\\mathrm{surf}} = 1.0 \\times 10^{5}$，$p_{\\mathrm{top}} = 100.0$，$g = 9.81$，$c_{p} = 1004.0$，$R = 287.0$，$S = 1361.0$，$A = 0.30$，$\\tau_{\\mathrm{surf}} = 3.0$，$p_{\\mathrm{cloud}} = 2.0 \\times 10^{4}$，$\\Delta \\tau_{\\mathrm{cloud}} = 0.0$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个由方括号括起来的列表的列表，格式为逗号分隔。每个内部列表对应一个测试用例，包含两个浮点数：$[\\Delta T_{\\max}, \\Delta z_{\\mathrm{tp}}]$。\n- 例如：$[[\\Delta T_{\\max,1},\\Delta z_{\\mathrm{tp},1}],[\\Delta T_{\\max,2},\\Delta z_{\\mathrm{tp},2}],[\\Delta T_{\\max,3},\\Delta z_{\\mathrm{tp},3}],[\\Delta T_{\\max,4},\\Delta z_{\\mathrm{tp},4}]]$。",
            "solution": "用户提供的问题是有效的，将按所述方式解决。这是一个行星大气物理学中适定（well-posed）的问题，具有科学依据，并包含足够的信息以得出唯一解。\n\n解决方案需要构建一个一维的辐射-对流平衡 (RCE) 模型。此任务的核心是计算行星大气的平衡温度-气压剖面 $T(p)$，首先是晴空情况，然后是带有高空云层的情况。接着，量化这两种情景下温度和对流层顶结构的差异。\n\n### 1. 理论框架\n\n该模型基于一系列大气科学中使用的基本物理原理和标准近似。\n\n#### 1.1. 辐射平衡与有效温度\n\n行星处于全局能量平衡状态。吸收的恒星辐射与向太空发射的出射长波辐射 (OLR) 相平衡。OLR 由一个有效温度 $T_{\\mathrm{eff}}$ 来表征，该温度由斯特藩-玻尔兹曼定律定义。\n入射到行星上的总太阳能与其横截面积 $\\pi R_p^2$ 成正比，其中 $R_p$ 是行星半径。该能量分布在行星的表面积 $4\\pi R_p^2$ 上。全球平均的单位面积吸收太阳通量由 $F_{solar} = (1 - A)S/4$ 给出，其中 $S$ 是行星轨道处的恒星辐照度，$A$ 是邦德反照率。在平衡状态下，OLR 必须等于此吸收通量：\n$$ \\sigma T_{\\mathrm{eff}}^{4} = \\frac{(1 - A) S}{4} $$\n其中 $\\sigma$ 是斯特藩-玻尔兹曼常数。$T_{\\mathrm{eff}}$ 是一个基本参数，它设定了大气温度结构的能量收支。\n\n#### 1.2. 辐射平衡温度剖面\n\n问题指定了热红外辐射传输的半灰色、双流、爱丁顿近似。这是一个“灰色”大气的标准模型，该大气在所有长波频率上吸收均等。在此近似下，辐射传输方程的解给出了一个著名的温度剖面，作为垂直长波光学厚度 $\\tau$ 的函数。光学厚度 $\\tau$ 在大气层顶定义为 $0$，并随气压向下增加。辐射平衡中任何高度的温度 $T_{\\mathrm{rad}}$ 由下式给出：\n$$ T_{\\mathrm{rad}}(\\tau)^4 = T_{\\mathrm{eff}}^4 \\left( \\frac{1}{2} + \\frac{3}{4}\\tau \\right) $$\n这个方程描述了温室效应：随着大气对出射热辐射变得更不透明，深层（更大的 $\\tau$）的温度会更高。\n\n#### 1.3. 光学厚度剖面\n\n问题假设存在一个均匀混合的长波吸收体，意味着其质量混合比随高度保持不变。在这种情况下，光学厚度增量 $d\\tau$ 与质量路径增量 $dp/g$ 成正比。从大气层顶（$p_{\\text{top}}$，$\\tau=0$）向下积分到某个气压水平 $p$，得到光学厚度与气压之间的线性关系：\n$$ \\tau(p) = \\tau_{\\mathrm{surf}} \\frac{p - p_{\\mathrm{top}}}{p_{\\mathrm{surf}} - p_{\\mathrm{top}}} $$\n其中 $\\tau_{\\mathrm{surf}}$ 是在地表气压 $p_{\\mathrm{surf}}$ 处大气的总光学厚度。\n\n高云层被建模为在气压 $p_{\\mathrm{cloud}}$ 处的一个无限薄层，它增加了一个光学厚度增量 $\\Delta \\tau_{\\mathrm{cloud}}$。此修改影响了云层*以下*所有高度的总光学厚度：\n$$ \\tau_{\\mathrm{mod}}(p) = \\begin{cases} \\tau_{\\mathrm{clear}}(p)  \\text{if } p \\le p_{\\mathrm{cloud}} \\\\ \\tau_{\\mathrm{clear}}(p) + \\Delta\\tau_{\\mathrm{cloud}}  \\text{if } p  p_{\\mathrm{cloud}} \\end{cases} $$\n这个修改后的光学厚度剖面 $\\tau_{\\mathrm{mod}}(p)$ 用于计算有云情况下的辐射平衡剖面。\n\n#### 1.4. 对流调整与对流层顶\n\n辐射平衡剖面并不总是稳定的。如果温度随高度下降的速度快于干绝热递减率，大气将对对流不稳定。对流有效地垂直混合热量，使温度剖面趋向于干绝热线。RCE 剖面是这种调整后产生的稳定构型。\n\n干绝热线在气压坐标下由下式给出：\n$$ T(p) = T_0 \\left(\\frac{p}{p_0}\\right)^{\\kappa} \\quad \\text{其中} \\quad \\kappa = \\frac{R}{c_p} $$\n这里，$(p_0, T_0)$ 是一个参考点，$R$ 是比气体常数，$c_p$ 是定压比热。\n\n对流层顶是较低的、对流混合的对流层与较高的、辐射控制的平流层之间的边界。它通过识别最高海拔（最低气压）的层 $p_{\\mathrm{tp}}$ 来找到，使得如果其下方的剖面遵循一条锚定于 $(p_{\\mathrm{tp}}, T_{\\mathrm{rad}}(p_{\\mathrm{tp}}))$ 的干绝热线，这条绝热剖面在所有更深层都保持比纯辐射剖面更暖或温度相同。也就是说，我们寻找最小的 $p_{\\mathrm{tp}}$ 以满足：\n$$ T_{\\mathrm{rad}}(p_{\\mathrm{tp}}) \\left(\\frac{p}{p_{\\mathrm{tp}}}\\right)^{\\kappa} \\ge T_{\\mathrm{rad}}(p) \\quad \\text{对于所有 } p  p_{\\mathrm{tp}} $$\n如果不存在这样的层，整个大气都处于辐射平衡状态，不会因对流而形成对流层顶。\n\n#### 1.5. 最终的 RCE 温度剖面\n\n一旦确定了对流层顶气压 $p_{\\mathrm{tp}}$，最终的 RCE 温度剖面 $T_{\\mathrm{RCE}}(p)$ 就被构建为一个复合剖面：\n$$ T_{\\mathrm{RCE}}(p) = \\begin{cases} T_{\\mathrm{rad}}(p)  \\text{if } p \\le p_{\\mathrm{tp}} \\quad \\text{(平流层)} \\\\ T_{\\mathrm{rad}}(p_{\\mathrm{tp}}) \\left(\\frac{p}{p_{\\mathrm{tp}}}\\right)^{\\kappa}  \\text{if } p  p_{\\mathrm{tp}} \\quad \\text{(对流层)} \\end{cases} $$\n如果没有找到对流层顶，则对所有 $p$，都有 $T_{\\mathrm{RCE}}(p) = T_{\\mathrm{rad}}(p)$。\n\n#### 1.6. 高度剖面\n\n几何高度 $z(p)$ 通过对静力平衡方程 ($dp = -\\rho g dz$) 与理想气体定律 ($p = \\rho R T$) 结合的微分关系进行积分来找到：\n$$ \\frac{dz}{dp} = -\\frac{R T(p)}{g p} $$\n从地表（$p=p_{\\mathrm{surf}}$，$z=0$）向上积分到某个气压水平 $p$ 得到高度：\n$$ z(p) = \\int_{p}^{p_{\\mathrm{surf}}} \\frac{R T_{\\mathrm{RCE}}(p')}{g p'} dp' $$\n此积分通过数值方法计算。使用对数间隔的气压网格，两个相邻层 $p_i$ 和 $p_{i+1}$ 之间的积分可以合理地近似为：\n$$ z_i - z_{i+1} = \\int_{p_i}^{p_{i+1}} -\\frac{R T(p')}{g p'} dp' \\approx \\frac{R}{g} \\left( \\frac{T_i + T_{i+1}}{2} \\right) \\ln\\left(\\frac{p_{i+1}}{p_i}\\right) $$\n从地表 $z=0$ 开始，通过累加这些增量，可以计算出每个气压层的高度。对流层顶高度 $z_{\\mathrm{tp}}$ 是对应于对流层顶气压 $p_{\\mathrm{tp}}$ 的高度。如果不存在对流层顶，则 $z_{\\mathrm{tp}} = 0$。\n\n### 2. 计算算法\n\n对于每个测试用例，通过以下步骤实现解决方案：\n\n1.  **初始化**：定义物理常数和当前测试用例的参数。建立一个从 $p_{\\mathrm{top}}$ 到 $p_{\\mathrm{surf}}$ 的具有 $N=1000$ 个层级的对数间隔气压网格。\n2.  **计算 $T_{\\mathrm{eff}}$**：根据给定的恒星辐照度 $S$ 和反照率 $A$ 计算有效温度。\n3.  **处理晴空情况**：\n    a.  计算晴空光学厚度剖面 $\\tau_{\\mathrm{clear}}(p)$。\n    b.  计算辐射平衡剖面 $T_{\\mathrm{rad,clear}}(p)$。\n    c.  通过从大气层顶向下系统搜索，找到对流层顶气压 $p_{\\mathrm{tp,clear}}$。\n    d.  构建最终的 RCE 剖面 $T_{\\mathrm{RCE,clear}}(p)$。\n    e.  如果找到对流层顶，计算完整的高度剖面 $z_{\\mathrm{clear}}(p)$ 并找到对流层顶高度 $z_{\\mathrm{tp,clear}}$。否则，$z_{\\mathrm{tp,clear}} = 0$。\n4.  **处理有云情况**：\n    a.  对于 $p  p_{\\mathrm{cloud}}$，通过加上 $\\Delta \\tau_{\\mathrm{cloud}}$ 来计算有云光学厚度剖面 $\\tau_{\\mathrm{cloud}}(p)$。\n    b.  计算辐射平衡剖面 $T_{\\mathrm{rad,cloud}}(p)$。\n    c.  找到对流层顶气压 $p_{\\mathrm{tp,cloud}}$。\n    d.  构建最终的 RCE 剖面 $T_{\\mathrm{RCE,cloud}}(p)$。\n    e.  计算对流层顶高度 $z_{\\mathrm{tp,cloud}}$。\n5.  **计算最终指标**：\n    a.  计算最大绝对温度变化：$\\Delta T_{\\max} = \\max_{p} |T_{\\mathrm{RCE,cloud}}(p) - T_{\\mathrm{RCE,clear}}(p)|$。\n    b.  计算对流层顶高度的变化：$\\Delta z_{\\mathrm{tp}} = z_{\\mathrm{tp,cloud}} - z_{\\mathrm{tp,clear}}$。\n6.  **存储并输出结果**：存储数据对 $[\\Delta T_{\\max}, \\Delta z_{\\mathrm{tp}}]$，并对所有测试用例重复此过程。将最终输出格式化为这些数据对的列表。\n\n此过程是确定性的，直接实现了问题陈述中描述的物理过程。使用精细的气压网格和稳定的数值积分方案确保了准确性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the Radiative-Convective Equilibrium problem\n    for the given test suite.\n    \"\"\"\n    \n    # Stefan-Boltzmann constant (W m^-2 K^-4)\n    SIGMA = 5.670374419e-8\n    \n    # Number of pressure levels in the model\n    N_LEVELS = 1000\n\n    test_cases = [\n        # Case 1 (Earth-like, optically thick)\n        {'p_surf': 1.0e5, 'p_top': 100.0, 'g': 9.81, 'cp': 1004.0, 'R': 287.0, \n         'S': 1361.0, 'A': 0.30, 'tau_surf': 3.0, 'p_cloud': 2.0e4, 'Delta_tau_cloud': 1.0},\n        # Case 2 (Mars-like, tenuous atmosphere)\n        {'p_surf': 600.0, 'p_top': 1.0, 'g': 3.71, 'cp': 730.0, 'R': 189.0, \n         'S': 586.0, 'A': 0.25, 'tau_surf': 0.2, 'p_cloud': 50.0, 'Delta_tau_cloud': 0.5},\n        # Case 3 (Super-Earth, thick atmosphere)\n        {'p_surf': 2.0e5, 'p_top': 100.0, 'g': 15.0, 'cp': 1000.0, 'R': 300.0, \n         'S': 1700.0, 'A': 0.20, 'tau_surf': 5.0, 'p_cloud': 1.0e4, 'Delta_tau_cloud': 2.0},\n        # Case 4 (Earth-like boundary, no cloud increment)\n        {'p_surf': 1.0e5, 'p_top': 100.0, 'g': 9.81, 'cp': 1004.0, 'R': 287.0, \n         'S': 1361.0, 'A': 0.30, 'tau_surf': 3.0, 'p_cloud': 2.0e4, 'Delta_tau_cloud': 0.0},\n    ]\n\n    results = []\n\n    for params in test_cases:\n        p_surf = params['p_surf']\n        p_top = params['p_top']\n                \n        # Create a logarithmically spaced pressure grid from p_top to p_surf\n        p_grid = np.logspace(np.log10(p_top), np.log10(p_surf), N_LEVELS)\n\n        # Calculate results for clear-sky case\n        T_rce_clear, z_tp_clear = compute_rce_profile(p_grid, params, False)\n        \n        # Calculate results for cloudy-sky case\n        T_rce_cloud, z_tp_cloud = compute_rce_profile(p_grid, params, True)\n        \n        # Compute final metrics\n        delta_T_max = np.max(np.abs(T_rce_cloud - T_rce_clear))\n        delta_z_tp = z_tp_cloud - z_tp_clear\n        \n        results.append([delta_T_max, delta_z_tp])\n\n    # Format output as specified\n    print(f\"[{','.join([f'[{r[0]:.4f},{r[1]:.4f}]' for r in results])}]\")\n\n\ndef compute_rce_profile(p_grid, params, is_cloudy):\n    \"\"\"\n    Computes the Radiative-Convective Equilibrium profile for a given\n    set of parameters and cloud state.\n    \n    Returns:\n        T_rce (np.ndarray): The final RCE temperature profile [K].\n        z_tp (float): The tropopause altitude [m].\n    \"\"\"\n    \n    # Unpack parameters\n    p_surf = params['p_surf']\n    p_top = params['p_top']\n    g = params['g']\n    cp = params['cp']\n    R = params['R']\n    S = params['S']\n    A = params['A']\n    tau_surf = params['tau_surf']\n    p_cloud = params['p_cloud']\n    Delta_tau_cloud = params['Delta_tau_cloud']\n    SIGMA = 5.670374419e-8\n    \n    # 1. Effective Temperature\n    T_eff = ((1.0 - A) * S / (4.0 * SIGMA))**0.25\n    \n    # 2. Optical Depth Profile\n    tau_clear = tau_surf * (p_grid - p_top) / (p_surf - p_top)\n    \n    tau = np.copy(tau_clear)\n    if is_cloudy and Delta_tau_cloud > 0:\n        cloud_mask = p_grid > p_cloud\n        tau[cloud_mask] += Delta_tau_cloud\n        \n    # 3. Radiative Equilibrium Temperature Profile\n    T_rad = T_eff * (0.5 + 0.75 * tau)**0.25\n    \n    # 4. Convective Adjustment and Tropopause Identification\n    kappa = R / cp\n    p_tp_idx = -1  # Index of tropopause pressure level\n    \n    for k in range(len(p_grid)):\n        p_tp_candidate = p_grid[k]\n        T_tp_candidate = T_rad[k]\n        \n        # Get pressure levels below the candidate tropopause\n        sub_trop_mask = p_grid > p_tp_candidate\n        if not np.any(sub_trop_mask):\n            continue\n\n        p_sub = p_grid[sub_trop_mask]\n        T_rad_sub = T_rad[sub_trop_mask]\n        \n        # Adiabatic profile below the candidate tropopause\n        T_conv_sub = T_tp_candidate * (p_sub / p_tp_candidate)**kappa\n        \n        # Check if the adiabat is warmer than or at the same temp as the radiative profile\n        if np.all(T_conv_sub >= T_rad_sub):\n            p_tp_idx = k\n            break\n            \n    # 5. Final RCE Profile and Altitude Calculation\n    T_rce = np.copy(T_rad)\n    z_tp = 0.0\n\n    if p_tp_idx != -1:\n        # Tropopause found, construct RCE profile\n        p_tp = p_grid[p_tp_idx]\n        T_tp = T_rad[p_tp_idx]\n        \n        troposphere_mask = p_grid > p_tp\n        p_troposphere = p_grid[troposphere_mask]\n        T_rce[troposphere_mask] = T_tp * (p_troposphere / p_tp)**kappa\n        \n        # Calculate altitude profile\n        z_grid = np.zeros_like(p_grid)\n        # z_grid[-1] is 0 at p_surf\n        for i in range(len(p_grid) - 2, -1, -1):\n            T_mean_layer = 0.5 * (T_rce[i] + T_rce[i+1])\n            z_grid[i] = z_grid[i+1] + (R / g) * T_mean_layer * np.log(p_grid[i+1] / p_grid[i])\n        \n        z_tp = z_grid[p_tp_idx]\n        \n    return T_rce, z_tp\n\n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}