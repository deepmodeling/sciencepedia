{
    "hands_on_practices": [
        {
            "introduction": "This problem explores the fundamental dynamics of a single mean-motion resonance. By analyzing a simplified Hamiltonian, we can visualize the motion in phase space and understand the crucial distinction between libration (the resonant state) and circulation. This exercise  will have you identify the equilibrium points of the system and determine their stability, which forms the theoretical backbone for understanding how planets can become trapped in and maintained in a resonant configuration.",
            "id": "4176535",
            "problem": "Consider two coplanar planets near a first-order mean-motion resonance of order one, such as the $k:(k-1)$ commensurability with integer $k \\geq 2$. After averaging over the fast angles and applying a canonical resonant transformation to a single resonant angle-action pair, the resonant dynamics of one link in a chain of such resonances can be modeled by a one-degree-of-freedom Hamiltonian of the form\n$$\nH(\\phi,p)\\;=\\;\\frac{1}{2}\\,a\\,p^{2}\\;+\\;\\delta\\,p\\;-\\;\\varepsilon\\,\\cos\\phi,\n$$\nwhere $a>0$ and $\\varepsilon>0$ are constants determined by the local curvature of the Keplerian part and the amplitude of the first-order term of the disturbing function, respectively, and $\\delta$ is a small detuning parameter measuring the offset from exact commensurability. The canonical coordinate $\\phi$ is the resonant angle, and $p$ is its conjugate momentum, proportional to the deviation of the mean motions from exact resonance. Assume a planar problem and ignore any additional slow precession terms.\n\nUsing only Hamilton’s equations and linearization of the equations of motion about equilibria, do the following:\n- Identify all equilibrium points $(\\phi^{\\star},p^{\\star})$ of the system in the $(\\phi,p)$ plane.\n- Determine the linear stability of each equilibrium by computing the eigenvalues of the Jacobian matrix of the linearized equations of motion evaluated at each equilibrium.\n\nFinally, report a single quantity: the absolute value of the eigenvalues (i.e., the linear libration frequency magnitude) at the linearly stable equilibrium, expressed as a closed-form symbolic function of $a$ and $\\varepsilon$. Provide your final answer as a symbolic expression only; do not include units or numerical values, and do not approximate. Angles are measured in radians.",
            "solution": "The problem statement is found to be valid as it is scientifically grounded in Hamiltonian mechanics and celestial dynamics, well-posed, objective, and contains all necessary information to derive a unique solution.\n\nThe dynamics of the system are governed by the Hamiltonian\n$$\nH(\\phi,p) = \\frac{1}{2} a p^{2} + \\delta p - \\varepsilon \\cos\\phi\n$$\nwhere $(\\phi, p)$ are canonical conjugate variables, and $a$, $\\delta$, $\\varepsilon$ are parameters with $a > 0$ and $\\varepsilon > 0$. The equations of motion are given by Hamilton's equations:\n$$\n\\dot{\\phi} = \\frac{\\partial H}{\\partial p}\n$$\n$$\n\\dot{p} = -\\frac{\\partial H}{\\partial \\phi}\n$$\nFirst, we compute the partial derivatives of the Hamiltonian:\n$$\n\\frac{\\partial H}{\\partial p} = a p + \\delta\n$$\n$$\n\\frac{\\partial H}{\\partial \\phi} = \\frac{\\partial}{\\partial \\phi} (-\\varepsilon \\cos\\phi) = -\\varepsilon (-\\sin\\phi) = \\varepsilon \\sin\\phi\n$$\nSubstituting these into Hamilton's equations gives the system's equations of motion:\n$$\n\\dot{\\phi} = a p + \\delta\n$$\n$$\n\\dot{p} = -\\varepsilon \\sin\\phi\n$$\nEquilibrium points, denoted by $(\\phi^{\\star}, p^{\\star})$, are the points in the phase space where the system is stationary. They are found by setting the time derivatives to zero: $\\dot{\\phi} = 0$ and $\\dot{p} = 0$.\n$$\nap^{\\star} + \\delta = 0 \\quad \\implies \\quad p^{\\star} = -\\frac{\\delta}{a}\n$$\n$$\n-\\varepsilon \\sin\\phi^{\\star} = 0\n$$\nSince $\\varepsilon > 0$, the second equation requires $\\sin\\phi^{\\star} = 0$. Over the interval $\\phi \\in [0, 2\\pi)$, this condition is satisfied for $\\phi^{\\star} = 0$ and $\\phi^{\\star} = \\pi$.\nThus, we have two distinct equilibrium points:\n$1$. $E_1: (\\phi^{\\star}, p^{\\star}) = (0, -\\frac{\\delta}{a})$\n$2$. $E_2: (\\phi^{\\star}, p^{\\star}) = (\\pi, -\\frac{\\delta}{a})$\n\nTo determine the linear stability of these equilibria, we linearize the equations of motion around each point. The system can be written in vector form as $\\dot{\\mathbf{x}} = \\mathbf{F}(\\mathbf{x})$, where $\\mathbf{x} = (\\phi, p)^T$ and $\\mathbf{F}(\\mathbf{x}) = (ap + \\delta, -\\varepsilon \\sin\\phi)^T$. The stability is determined by the eigenvalues of the Jacobian matrix of $\\mathbf{F}$ evaluated at the equilibrium point. The Jacobian matrix $J$ is:\n$$\nJ(\\phi, p) = \\begin{pmatrix} \\frac{\\partial \\dot{\\phi}}{\\partial \\phi} & \\frac{\\partial \\dot{\\phi}}{\\partial p} \\\\ \\frac{\\partial \\dot{p}}{\\partial \\phi} & \\frac{\\partial \\dot{p}}{\\partial p} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\partial}{\\partial \\phi}(ap+\\delta) & \\frac{\\partial}{\\partial p}(ap+\\delta) \\\\ \\frac{\\partial}{\\partial \\phi}(-\\varepsilon \\sin\\phi) & \\frac{\\partial}{\\partial p}(-\\varepsilon \\sin\\phi) \\end{pmatrix} = \\begin{pmatrix} 0 & a \\\\ -\\varepsilon \\cos\\phi & 0 \\end{pmatrix}\n$$\nNow, we evaluate this Jacobian at each of the two equilibrium points.\n\nFor the first equilibrium point $E_1 = (0, -\\frac{\\delta}{a})$:\nWe substitute $\\phi^{\\star} = 0$ into the Jacobian matrix:\n$$\nJ(E_1) = \\begin{pmatrix} 0 & a \\\\ -\\varepsilon \\cos(0) & 0 \\end{pmatrix} = \\begin{pmatrix} 0 & a \\\\ -\\varepsilon & 0 \\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ are found by solving the characteristic equation $\\det(J(E_1) - \\lambda I) = 0$, where $I$ is the $2 \\times 2$ identity matrix.\n$$\n\\det\\begin{pmatrix} -\\lambda & a \\\\ -\\varepsilon & -\\lambda \\end{pmatrix} = (-\\lambda)(-\\lambda) - (a)(-\\varepsilon) = \\lambda^2 + a\\varepsilon = 0\n$$\nThis gives $\\lambda^2 = -a\\varepsilon$. Since $a > 0$ and $\\varepsilon > 0$, the product $a\\varepsilon$ is positive. The eigenvalues are:\n$$\n\\lambda = \\pm \\sqrt{-a\\varepsilon} = \\pm i\\sqrt{a\\varepsilon}\n$$\nSince the eigenvalues are purely imaginary and form a complex conjugate pair, the equilibrium point $E_1$ is a center in the linearized system. It is therefore linearly stable. Physical motion in the vicinity of this point corresponds to libration.\n\nFor the second equilibrium point $E_2 = (\\pi, -\\frac{\\delta}{a})$:\nWe substitute $\\phi^{\\star} = \\pi$ into the Jacobian matrix:\n$$\nJ(E_2) = \\begin{pmatrix} 0 & a \\\\ -\\varepsilon \\cos(\\pi) & 0 \\end{pmatrix} = \\begin{pmatrix} 0 & a \\\\ -\\varepsilon(-1) & 0 \\end{pmatrix} = \\begin{pmatrix} 0 & a \\\\ \\varepsilon & 0 \\end{pmatrix}\n$$\nThe characteristic equation is $\\det(J(E_2) - \\lambda I) = 0$:\n$$\n\\det\\begin{pmatrix} -\\lambda & a \\\\ \\varepsilon & -\\lambda \\end{pmatrix} = (-\\lambda)(-\\lambda) - (a)(\\varepsilon) = \\lambda^2 - a\\varepsilon = 0\n$$\nThis gives $\\lambda^2 = a\\varepsilon$. The eigenvalues are:\n$$\n\\lambda = \\pm\\sqrt{a\\varepsilon}\n$$\nSince $a\\varepsilon > 0$, the eigenvalues are real, with one positive and one negative. This indicates that the equilibrium point $E_2$ is a saddle point, which is unstable.\n\nThe problem asks for the absolute value of the eigenvalues at the linearly stable equilibrium. The stable equilibrium is $E_1$. The eigenvalues at this point are $\\lambda = \\pm i\\sqrt{a\\varepsilon}$. The absolute value of these eigenvalues is:\n$$\n|\\lambda| = |\\pm i\\sqrt{a\\varepsilon}| = \\sqrt{a\\varepsilon}\n$$\nThis quantity represents the angular frequency of small oscillations (librations) around the stable equilibrium point. As requested, this expression is a function of $a$ and $\\varepsilon$ only.",
            "answer": "$$\n\\boxed{\\sqrt{a\\varepsilon}}\n$$"
        },
        {
            "introduction": "While individual resonances are the building blocks, many exoplanetary systems exhibit mesmerizing chains of multiple, linked resonances. This exercise shifts our focus from a single resonant pair to a trio of planets, demonstrating how adjacent resonant locks constrain the entire system's architecture. By deriving the three-body Laplace relation from the definitions of the two-body resonant angles , you will uncover the elegant mathematical harmony that governs these planetary chains, a principle famously observed in Jupiter's Galilean moons.",
            "id": "4176568",
            "problem": "Consider a star of mass so large compared to its planets that the planetary motions are well described by near-Keplerian orbits with weak mutual perturbations. Three planets, labeled $1$, $2$, and $3$, form a resonant chain in which planet $1$ and planet $2$ are trapped in a $(p+q):p$ mean-motion resonance of order $q \\geq 1$, and planet $2$ and planet $3$ are trapped in a $(p'+q'):p'$ mean-motion resonance of order $q' \\geq 1$, where $p,p',q,q'$ are positive integers. Let the mean longitude of planet $i$ be $\\lambda_i$, the longitude of pericenter be $\\varpi_i$, and the mean motion be $n_i = d\\lambda_i/dt$. Angles are measured in radians.\n\nIn the standard disturbing-function description of mean-motion resonances, each two-body resonance $(p+q):p$ admits $q+1$ distinct resonant angles that couple the mean longitudes and longitudes of pericenter. For the pair $(1,2)$, one such angle is $\\phi_{12} = (p+q)\\lambda_2 - p\\lambda_1 - q\\varpi_2$, and for the pair $(2,3)$, a corresponding angle is $\\phi_{23} = (p'+q')\\lambda_3 - p'\\lambda_2 - q'\\varpi_2$. Assume both $\\phi_{12}$ and $\\phi_{23}$ librate about constant values, so their time derivatives vanish on average in the secular sense.\n\nStarting only from these definitions and the near-Keplerian relation $n_i = d\\lambda_i/dt$, construct a single three-body angle that is independent of $\\varpi_2$ by taking an integer linear combination of $\\phi_{12}$ and $\\phi_{23}$. By differentiating this combination with respect to time and using the libration assumption, derive the Laplace-type three-body relation among the mean motions of the form of an integer linear combination that vanishes to leading order. Express the integer coefficients $k_1$, $k_2$, and $k_3$ multiplying $n_1$, $n_2$, and $n_3$ respectively, explicitly in terms of $p$, $q$, $p'$, and $q'$.\n\nYour final answer must be the ordered triple $\\left(k_1, k_2, k_3\\right)$ as a single row matrix. No numerical evaluation is required, and no units should be included in the final expression.",
            "solution": "The problem requires the derivation of a Laplace-type three-body relation for a system of three planets in a resonant chain. The relation should be a linear combination of the planets' mean motions, $k_1 n_1 + k_2 n_2 + k_3 n_3 = 0$, and the task is to find the integer coefficients $(k_1, k_2, k_3)$.\n\nThe starting point is the two resonant angles provided for the adjacent pairs of planets:\n1. For the pair $(1,2)$, in a $(p+q):p$ resonance, the angle is $\\phi_{12} = (p+q)\\lambda_2 - p\\lambda_1 - q\\varpi_2$.\n2. For the pair $(2,3)$, in a $(p'+q'):p'$ resonance, the angle is $\\phi_{23} = (p'+q')\\lambda_3 - p'\\lambda_2 - q'\\varpi_2$.\n\nA key feature of these definitions is that both resonant angles depend on the longitude of pericenter of the middle planet, $\\varpi_2$. The first step is to construct a new, three-body angle, $\\Phi$, that is independent of $\\varpi_2$. We form $\\Phi$ as an integer linear combination of $\\phi_{12}$ and $\\phi_{23}$:\n$$ \\Phi = a\\phi_{12} + b\\phi_{23} $$\nwhere $a$ and $b$ are integers. Substituting the definitions of $\\phi_{12}$ and $\\phi_{23}$:\n$$ \\Phi = a \\left( (p+q)\\lambda_2 - p\\lambda_1 - q\\varpi_2 \\right) + b \\left( (p'+q')\\lambda_3 - p'\\lambda_2 - q'\\varpi_2 \\right) $$\nTo make $\\Phi$ independent of $\\varpi_2$, the sum of the coefficients of the $\\varpi_2$ terms must be zero. Let's group the terms by the angular variables:\n$$ \\Phi = (-ap)\\lambda_1 + (a(p+q) - bp')\\lambda_2 + (b(p'+q'))\\lambda_3 - (aq + bq')\\varpi_2 $$\nThe condition for independence from $\\varpi_2$ is:\n$$ aq + bq' = 0 $$\n$$ aq = -bq' $$\nSince $p, q, p', q'$ are positive integers, the simplest non-trivial integer solution for $a$ and $b$ is to choose $a = q'$ and $b = -q$. This choice (or its negative, $a = -q'$ and $b = q$) gives the desired combination. We will proceed with $a = q'$ and $b = -q$.\n\nThe resulting three-body angle is $\\Phi = q'\\phi_{12} - q\\phi_{23}$. Let us write this explicitly in terms of the mean longitudes:\n$$ \\Phi = q'\\left( (p+q)\\lambda_2 - p\\lambda_1 - q\\varpi_2 \\right) - q\\left( (p'+q')\\lambda_3 - p'\\lambda_2 - q'\\varpi_2 \\right) $$\n$$ \\Phi = pq'\\lambda_2 + qq'\\lambda_2 - pq'\\lambda_1 - qq'\\varpi_2 - qp'\\lambda_3 - qq'\\lambda_3 + qp'\\lambda_2 + qq'\\varpi_2 $$\nThe terms involving $\\varpi_2$ cancel out as designed. Grouping the remaining terms by planet index:\n$$ \\Phi = (-pq')\\lambda_1 + (pq' + qq' + qp')\\lambda_2 + (-qp' - qq')\\lambda_3 $$\n\nThe problem states that $\\phi_{12}$ and $\\phi_{23}$ librate, which means they oscillate about a constant value. Consequently, their linear combination $\\Phi$ must also librate about a constant value. This implies that the long-term average of its time derivative must be zero: $\\langle \\dot{\\Phi} \\rangle = 0$.\n\nWe differentiate $\\Phi$ with respect to time, using the definition $n_i = \\dot{\\lambda}_i$:\n$$ \\dot{\\Phi} = \\frac{d}{dt} \\left[ (-pq')\\lambda_1 + (pq' + qq' + qp')\\lambda_2 - (qp' + qq')\\lambda_3 \\right] $$\nAssuming the mean motions $n_i$ are constant on the timescale of interest (the secular approximation), we get:\n$$ \\dot{\\Phi} = (-pq')\\dot{\\lambda}_1 + (pq' + qq' + qp')\\dot{\\lambda}_2 + (-qp' - qq')\\dot{\\lambda}_3 $$\n$$ \\dot{\\Phi} = (-pq')n_1 + (pq' + qq' + qp')n_2 + (-qp' - qq')n_3 $$\n\nThe condition $\\langle \\dot{\\Phi} \\rangle = 0$ implies that this linear combination of mean motions must vanish to leading order:\n$$ (-pq')n_1 + (pq' + qq' + qp')n_2 - (qp' + qq')n_3 = 0 $$\nThis is the Laplace-type relation of the form $k_1 n_1 + k_2 n_2 + k_3 n_3 = 0$. By comparing the two forms, we can identify the integer coefficients $k_1$, $k_2$, and $k_3$:\n$$ k_1 = -pq' $$\n$$ k_2 = pq' + qq' + qp' $$\n$$ k_3 = -qp' - qq' $$\nThese are the requested coefficients expressed in terms of the parameters of the two-body resonances.",
            "answer": "$$\\boxed{\\begin{pmatrix} -pq' & pq' + qq' + qp' & -qp' - qq' \\end{pmatrix}}$$"
        },
        {
            "introduction": "Theoretical models provide the framework for understanding resonance, but how do we confirm these states in practice from the output of N-body simulations or observational data? This computational practice  equips you with a suite of diagnostic tools to quantitatively distinguish between libration and circulation in a time series of a resonant angle. By implementing metrics from circular statistics and spectral analysis, you will develop a robust algorithm for identifying resonant behavior, a critical skill for any researcher modeling or analyzing planetary systems.",
            "id": "4176476",
            "problem": "You are provided with uniformly sampled time series of a single critical resonant angle $\\phi(t)$ for a candidate pair or chain of planets. In the context of Newtonian gravitational dynamics and near-commensurate mean motions, a resonant configuration is associated with the libration of one or more critical angles, whereas a non-resonant configuration corresponds to circulation of these angles over the full circle. Your task is to design and implement a scientifically grounded diagnostic to decide, from numerical output, whether a given angle time series $\\phi(t)$ is librating or circulating.\n\nYou must base your derivation and algorithmic design on the following fundamental laws and core definitions:\n- Newtonian mechanics governs orbital motion, and resonances arise from near-commensurate mean motions resulting in phase-protection characterized by bounded motion of a critical angle.\n- A critical angle $\\phi(t)$ is $2\\pi$-periodic and may exhibit libration (bounded oscillation about a center) or circulation (unbounded monotonic traversal modulo $2\\pi$).\n- Circular statistics on the unit circle quantify concentration versus uniformity using the mean resultant length.\n\nYou must develop quantitative diagnostics using only the time series $\\phi(t)$ sampled at $N$ uniform times $\\{t_i\\}_{i=0}^{N-1}$ with constant step $\\Delta t$. Angles must be treated as $2\\pi$-periodic and expressed in radians. The diagnostic must compute the following metrics on $\\{\\phi(t_i)\\}$:\n\n1. Circular concentration: Compute the circular mean $\\mu$ and the mean resultant length $R$ defined by\n$$\nC = \\frac{1}{N} \\sum_{i=0}^{N-1} \\cos\\left(\\phi_i\\right), \\quad S = \\frac{1}{N} \\sum_{i=0}^{N-1} \\sin\\left(\\phi_i\\right), \\quad \\mu = \\operatorname{atan2}(S, C), \\quad R = \\sqrt{C^2 + S^2}.\n$$\nLarge $R$ indicates concentration consistent with libration; small $R$ indicates dispersion consistent with circulation.\n\n2. Minimal enclosing arc width: Compute the minimal arc width $W$ in radians that contains all sample angles on the unit circle. This is obtained by sorting the angles on $[0, 2\\pi)$, computing the set of circular gaps between successive angles (including the wrap-around gap), finding the maximum gap $G_{\\max}$, and then $W = 2\\pi - G_{\\max}$.\n\n3. Robust amplitude estimate: Compute an amplitude estimate $A$ by first evaluating angular deviations relative to the circular mean, $\\delta_i = \\operatorname{wrap}(\\phi_i - \\mu)$ where $\\operatorname{wrap}$ maps angles into $(-\\pi, \\pi]$. Let $q_{0.05}$ and $q_{0.95}$ denote the $5\\%$ and $95\\%$ quantiles of $\\{\\delta_i\\}$, respectively. Define\n$$\nA = \\frac{1}{2} \\left(q_{0.95} - q_{0.05}\\right).\n$$\nThis is a robust estimate of half the angular extent of the motion about $\\mu$.\n\n4. Frequency content and spectral concentration: Form the bounded signal $x_i = \\sin(\\phi_i)$, remove its sample mean to obtain $\\tilde{x}_i = x_i - \\bar{x}$, compute its Discrete Fourier Transform (DFT), and its power spectrum $P_k = |\\hat{x}_k|^2$ for nonzero frequencies. Define the spectral peak ratio\n$$\nS_{\\mathrm{peak}} = \\frac{\\max_{k \\neq 0} P_k}{\\sum_{k \\neq 0} P_k}.\n$$\nA larger value of $S_{\\mathrm{peak}}$ indicates that the variability is dominated by a narrow-band oscillation, as expected in libration; broad-band power or weak peaks indicate circulation or complex motion.\n\n5. Libration fraction: For a chosen amplitude threshold $A_{\\mathrm{thr}}$, define the fraction of samples that lie within this angular half-width around the circular mean,\n$$\nF_{\\mathrm{lib}} = \\frac{1}{N} \\sum_{i=0}^{N-1} \\mathbf{1}\\left(|\\delta_i| \\le A_{\\mathrm{thr}}\\right),\n$$\nwhere $\\mathbf{1}(\\cdot)$ is the indicator function.\n\nDefine quantitative thresholds for declaring libration:\n- $R \\ge R_{\\mathrm{thr}}$,\n- $W \\le W_{\\mathrm{thr}}$,\n- $A \\le A_{\\mathrm{thr}}$,\n- $S_{\\mathrm{peak}} \\ge S_{\\mathrm{thr}}$,\n- $F_{\\mathrm{lib}} \\ge F_{\\mathrm{thr}}$.\n\nYou must derive defensible numerical values for $R_{\\mathrm{thr}}$, $W_{\\mathrm{thr}}$, $A_{\\mathrm{thr}}$, $S_{\\mathrm{thr}}$, and $F_{\\mathrm{thr}}$ based on first principles and simple models of libration versus circulation and then implement a decision rule that declares “libration” only when all thresholds are satisfied. All angles are in radians, and the frequency analysis uses the discrete-time index $i$ with unitless sampling; no physical time unit conversion is required beyond uniform sampling.\n\nTest suite:\nConstruct the following five synthetic test cases, each providing an array of $N=300$ samples of $\\phi(t)$ in radians and sampled at integer indices $t_i = i$:\n- Case 1 (clear libration, “happy path”): $\\phi(t) = 0 + 0.6 \\sin(2\\pi f t) + \\epsilon(t)$ with $f = 0.03$ and $\\epsilon(t)$ a Gaussian noise with standard deviation $0.05$ radians. Expected result: boolean True.\n- Case 2 (clear circulation): $\\phi(t) = \\operatorname{wrap}(0.20 t + \\epsilon(t))$ with $\\epsilon(t)$ Gaussian noise with standard deviation $0.05$ radians and $\\operatorname{wrap}(\\cdot)$ mapping to $(-\\pi, \\pi]$. Expected result: boolean False.\n- Case 3 (near-boundary wide amplitude): $\\phi(t) = 0 + 1.5 \\sin(2\\pi f t) + \\epsilon(t)$ with $f = 0.02$ and $\\epsilon(t)$ Gaussian noise with standard deviation $0.05$ radians. Expected result: boolean False.\n- Case 4 (multi-mode libration): $\\phi(t) = \\frac{\\pi}{3} + 0.4 \\sin(2\\pi f_1 t) + 0.25 \\sin(2\\pi f_2 t) + \\epsilon(t)$ with $f_1 = 0.025$, $f_2 = 0.042$, and $\\epsilon(t)$ Gaussian noise with standard deviation $0.03$ radians. Expected result: boolean True.\n- Case 5 (intermittent: half libration, half circulation): For $t \\le 150$, $\\phi(t) = 0.4 \\sin(2\\pi \\cdot 0.03 \\cdot t)$; for $t > 150$, $\\phi(t) = \\operatorname{wrap}(0.25 (t-150))$; add Gaussian noise with standard deviation $0.04$ radians to all samples, and apply $\\operatorname{wrap}$ to the full sequence. Expected result: boolean False.\n\nYour program must:\n- Implement the metrics above, choose and document thresholds strictly derived from your reasoning.\n- Apply the decision rule to each of the five test cases.\n- Produce a single line of output containing the boolean results as a comma-separated list enclosed in square brackets, for example, \"[True,False,True,False,True]\".\n\nAngles must be expressed in radians. No other physical units appear in the input or output. All angles and thresholds are in radians, and any frequency content analysis is over the discrete sample index domain with unitless frequencies.",
            "solution": "The user has requested a diagnostic algorithm to determine if a time series of a planetary resonant angle $\\phi(t)$ represents libration or circulation. The solution requires deriving a set of quantitative metrics and corresponding thresholds, implementing them, and testing them on synthetic data.\n\nFirst, the problem statement is validated.\n\n### Step 1: Extract Givens\n- **Task**: Design a diagnostic to classify a time series of a critical angle $\\phi(t)$ as either librating or circulating.\n- **Governing Principles**: Newtonian mechanics, resonant dynamics, circular statistics. Libration is bounded oscillation; circulation is unbounded monotonic traversal modulo $2\\pi$.\n- **Input**: A time series $\\{\\phi_i\\}_{i=0}^{N-1}$ of angles in radians, sampled at uniform time steps.\n- **Metrics to Compute**:\n    1.  **Circular Concentration**: Mean resultant length $R$, from $C = \\frac{1}{N} \\sum_{i=0}^{N-1} \\cos(\\phi_i)$ and $S = \\frac{1}{N} \\sum_{i=0}^{N-1} \\sin(\\phi_i)$, with $R = \\sqrt{C^2 + S^2}$ and circular mean $\\mu = \\operatorname{atan2}(S, C)$.\n    2.  **Minimal Enclosing Arc Width**: $W = 2\\pi - G_{\\max}$, where $G_{\\max}$ is the maximum circular gap between sorted angles.\n    3.  **Robust Amplitude Estimate**: $A = \\frac{1}{2} (q_{0.95} - q_{0.05})$, where $q_p$ are quantiles of deviations $\\delta_i = \\operatorname{wrap}(\\phi_i - \\mu)$ into $(-\\pi, \\pi]$.\n    4.  **Spectral Peak Ratio**: $S_{\\mathrm{peak}} = \\frac{\\max_{k \\neq 0} P_k}{\\sum_{k \\neq 0} P_k}$ from the power spectrum $P_k$ of the mean-subtracted signal $x_i = \\sin(\\phi_i)$.\n    5.  **Libration Fraction**: $F_{\\mathrm{lib}} = \\frac{1}{N} \\sum_{i=0}^{N-1} \\mathbf{1}(|\\delta_i| \\le A_{\\mathrm{thr}})$.\n- **Decision Rule**: A series is classified as librating if and only if all five conditions are met: $R \\ge R_{\\mathrm{thr}}$, $W \\le W_{\\mathrm{thr}}$, $A \\le A_{\\mathrm{thr}}$, $S_{\\mathrm{peak}} \\ge S_{\\mathrm{thr}}$, $F_{\\mathrm{lib}} \\ge F_{\\mathrm{thr}}$.\n- **Task**: Derive defensible numerical values for the thresholds $R_{\\mathrm{thr}}$, $W_{\\mathrm{thr}}$, $A_{\\mathrm{thr}}$, $S_{\\mathrm{thr}}$, and $F_{\\mathrm{thr}}$.\n- **Test Suite**: Five synthetic cases are provided with $N=300$ samples each:\n    -   Case 1 (Libration): $\\phi(t) = 0.6 \\sin(2\\pi \\cdot 0.03 \\cdot t) + \\epsilon(t)$, $\\sigma_\\epsilon=0.05$. Expected: True.\n    -   Case 2 (Circulation): $\\phi(t) = \\operatorname{wrap}(0.20 t + \\epsilon(t))$, $\\sigma_\\epsilon=0.05$. Expected: False.\n    -   Case 3 (Wide Libration): $\\phi(t) = 1.5 \\sin(2\\pi \\cdot 0.02 \\cdot t) + \\epsilon(t)$, $\\sigma_\\epsilon=0.05$. Expected: False.\n    -   Case 4 (Multi-mode Libration): $\\phi(t) = \\frac{\\pi}{3} + 0.4 \\sin(2\\pi \\cdot 0.025 \\cdot t) + 0.25 \\sin(2\\pi \\cdot 0.042 \\cdot t) + \\epsilon(t)$, $\\sigma_\\epsilon=0.03$. Expected: True.\n    -   Case 5 (Intermittent): Half libration, half circulation, with noise $\\sigma_\\epsilon=0.04$. Expected: False.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in celestial mechanics and signal processing. The concepts of resonant angles, libration, circulation, circular statistics, and Fourier analysis are standard and correctly defined. The problem is well-posed, providing all necessary mathematical definitions and data to construct a solution. The task to derive thresholds is a standard part of designing a classification algorithm. The language is objective and precise. The synthetic test cases are well-defined and serve as a reasonable, albeit simplified, proxy for real-world data, enabling a clear test of the algorithm's logic. The problem is self-contained and internally consistent.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be developed.\n\n### Principle-Based Design and Threshold Derivation\n\nThe algorithm must robustly distinguish between bounded, concentrated angular motion (libration) and unbounded, dispersed motion (circulation). The thresholds are derived by considering the idealized behaviors of each metric for these two opposing scenarios.\n\n1.  **Metric $A_{\\mathrm{thr}}$ (Amplitude Threshold)**: This threshold is central, as it defines the maximum allowable amplitude for a state to be considered libration and is also used to compute $F_{\\mathrm{lib}}$. Libration implies confinement. While libration can theoretically have amplitudes up to $\\pi$, in practice, stable, low-order resonances typically exhibit amplitudes well below this. Case 3 is a \"wide amplitude\" librator with $A_0=1.5$ rad that must be rejected, while Case 1 with $A_0=0.6$ rad must be accepted. This strongly guides the choice of $A_{\\mathrm{thr}}$. A value between these two amplitudes is required. We select a value that represents a significant fraction of $\\pi/2$, but is clearly less than $1.5$. A choice of $A_{\\mathrm{thr}} = 1.2$ radians is defensible. This value is large enough to accommodate many true librations but small enough to reject wide-amplitude cases that border on circulation.\n    The decision rule is $A \\le A_{\\mathrm{thr}}$.\n\n2.  **Metric $R_{\\mathrm{thr}}$ (Mean Resultant Length Threshold)**: For a perfect circulator, angles are uniformly distributed on $[0, 2\\pi)$, and for an infinite sample, $R=0$. For a finite sample of size $N=300$, the expected $R$ is small, of order $\\sqrt{\\pi/(4N)} \\approx 0.05$. Conversely, for a small-amplitude librator with amplitude $A_0$ about $\\mu=0$, $R \\approx \\langle \\cos(A_0 \\sin\\omega t) \\rangle \\approx 1 - A_0^2/4$. For Case 1 ($A_0=0.6$), $R \\approx 1 - 0.36/4 = 0.91$. For Case 3 ($A_0=1.5$), $R \\approx 1 - 2.25/4 \\approx 0.44$. A threshold of $R_{\\mathrm{thr}} = 0.5$ robustly separates these cases. It correctly identifies the lack of concentration in the wide-amplitude Case 3 and any circulating case, while accepting clearly concentrated cases.\n\n3.  **Metric $W_{\\mathrm{thr}}$ (Arc Width Threshold)**: For a librator with amplitude $A_0$, the data should be confined to an arc of width close to $2A_0$. For a circulator, the data should span the entire circle, thus $W \\approx 2\\pi$. The threshold must reject circulators and Case 3, for which the angular extent is $2 \\times 1.5 = 3.0$ radians. A threshold set just below this value, $W_{\\mathrm{thr}} = 2.8$ radians, achieves this. This ensures the motion is confined to a region significantly smaller than the full circle ($\\approx 6.28$ rad).\n\n4.  **Metric $S_{\\mathrm{thr}}$ (Spectral Peak Ratio Threshold)**: Libration is an oscillation, implying its power spectrum should be dominated by one or a few frequencies. The signal is $x_i = \\sin(\\phi_i)$. For small-amplitude libration $\\phi_i \\approx A_0\\sin(\\omega i)$, $x_i$ is nearly sinusoidal, concentrating all power into a single DFT peak, leading to $S_{\\mathrm{peak}} \\approx 1$. For circulation, $\\phi_i$ is a ramp, making $x_i$ a chirp-like signal with a broad spectrum and thus a small $S_{\\mathrm{peak}}$. For white noise, $S_{\\mathrm{peak}} \\approx 1/(N/2) = 2/300 \\approx 0.007$. A wide-amplitude librator, such as $\\sin(1.5\\sin(\\omega t))$, develops significant higher harmonics, spreading power and reducing $S_{\\mathrm{peak}}$. A threshold of $S_{\\mathrm{thr}} = 0.2$ is chosen. This value indicates that at least $20\\%$ of the signal's non-DC power must be contained in its single strongest frequency component, a reasonable requirement for a quasi-periodic oscillation.\n\n5.  **Metric $F_{\\mathrm{thr}}$ (Libration Fraction Threshold)**: This metric quantifies how well the data conforms to the derived amplitude threshold $A_{\\mathrm{thr}} = 1.2$ rad. For a true librator with amplitude $A < A_{\\mathrm{thr}}$ (e.g., Case 1 and 4), we expect nearly all points to lie within this bound, so $F_{\\mathrm{lib}} \\approx 1$. For a circulator, the deviations $\\delta_i$ are roughly uniform on $(-\\pi, \\pi]$, so the fraction of points satisfying $|\\delta_i| \\le 1.2$ should be approximately $2 \\times 1.2 / (2\\pi) \\approx 0.38$. For Case 3, where the actual amplitude $1.5$ exceeds the threshold $1.2$, a significant fraction of points will lie outside the bound. A stringent threshold of $F_{\\mathrm{thr}} = 0.9$ is set, demanding that at least $90\\%$ of the motion is contained within the nominal libration amplitude. This effectively rejects circulators, intermittent cases, and librations wider than deemed stable.\n\nIn summary, the derived thresholds are:\n- $R_{\\mathrm{thr}} = 0.5$\n- $W_{\\mathrm{thr}} = 2.8$\n- $A_{\\mathrm{thr}} = 1.2$\n- $S_{\\mathrm{thr}} = 0.2$\n- $F_{\\mathrm{thr}} = 0.9$\n\nThe implementation will proceed by calculating these five metrics for each test case and applying the decision rule: libration is `True` if and only if all five threshold conditions are satisfied.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to generate test cases, apply the libration diagnostic,\n    and print the results in the required format.\n    \"\"\"\n\n    def generate_test_cases():\n        \"\"\"Generates the five synthetic test cases for phi(t).\"\"\"\n        N = 300\n        t = np.arange(N)\n        np.random.seed(42)  # for reproducibility\n\n        cases = []\n\n        # Case 1: Clear libration\n        f1 = 0.03\n        noise1 = np.random.normal(0, 0.05, N)\n        phi1 = 0.6 * np.sin(2 * np.pi * f1 * t) + noise1\n        cases.append(phi1)\n\n        # Case 2: Clear circulation\n        noise2 = np.random.normal(0, 0.05, N)\n        phi2_raw = 0.20 * t + noise2\n        # Use np.angle for wrapping to (-pi, pi]\n        phi2 = np.angle(np.exp(1j * phi2_raw))\n        cases.append(phi2)\n\n        # Case 3: Near-boundary wide amplitude libration\n        f3 = 0.02\n        noise3 = np.random.normal(0, 0.05, N)\n        phi3 = 1.5 * np.sin(2 * np.pi * f3 * t) + noise3\n        cases.append(phi3)\n\n        # Case 4: Multi-mode libration\n        f4_1, f4_2 = 0.025, 0.042\n        noise4 = np.random.normal(0, 0.03, N)\n        phi4 = (np.pi / 3) + 0.4 * np.sin(2 * np.pi * f4_1 * t) + \\\n               0.25 * np.sin(2 * np.pi * f4_2 * t) + noise4\n        cases.append(phi4)\n\n        # Case 5: Intermittent\n        noise5 = np.random.normal(0, 0.04, N)\n        phi5 = np.zeros(N)\n        # Libration part\n        t_lib = t[t = 150]\n        phi5[t = 150] = 0.4 * np.sin(2 * np.pi * 0.03 * t_lib)\n        # Circulation part\n        t_circ = t[t > 150]\n        phi5[t > 150] = 0.25 * (t_circ - 150)\n        phi5_raw = phi5 + noise5\n        phi5_final = np.angle(np.exp(1j * phi5_raw))\n        cases.append(phi5_final)\n\n        return cases\n\n    def is_librating(phi, thresholds):\n        \"\"\"\n        Determines if a time series phi is librating based on a set of metrics\n        and thresholds.\n        \n        Args:\n            phi (np.ndarray): Time series of the critical angle in radians.\n            thresholds (dict): Dictionary of threshold values.\n        \n        Returns:\n            bool: True if libration is detected, False otherwise.\n        \"\"\"\n        N = len(phi)\n\n        # 1. Circular concentration\n        C = np.mean(np.cos(phi))\n        S = np.mean(np.sin(phi))\n        R = np.sqrt(C**2 + S**2)\n        mu = np.arctan2(S, C)\n\n        # 2. Minimal enclosing arc width\n        # Map angles to [0, 2*pi) for sorting\n        phi_mod_2pi = phi % (2 * np.pi)\n        phi_sorted = np.sort(phi_mod_2pi)\n        gaps = np.diff(phi_sorted)\n        # Include the wrap-around gap\n        wrap_around_gap = 2 * np.pi - (phi_sorted[-1] - phi_sorted[0])\n        G_max = np.max(np.append(gaps, wrap_around_gap))\n        W = 2 * np.pi - G_max\n\n        # Helper function to wrap angles to (-pi, pi]\n        def wrap_to_pi(x):\n            return np.angle(np.exp(1j * x))\n\n        # 3. Robust amplitude estimate\n        delta = wrap_to_pi(phi - mu)\n        q05, q95 = np.quantile(delta, [0.05, 0.95])\n        A = 0.5 * (q95 - q05)\n\n        # 4. Spectral peak ratio\n        x = np.sin(phi)\n        x_tilde = x - np.mean(x)\n        # Use rfft for real-valued signals\n        dft_x = np.fft.rfft(x_tilde)\n        # Power spectrum for non-zero frequencies\n        # rfft output corresponds to frequencies k/N for k = 0, 1, ..., N/2\n        # Index 0 is the DC component\n        power_spectrum = np.abs(dft_x[1:])**2\n        \n        if len(power_spectrum) == 0 or np.sum(power_spectrum) == 0:\n            S_peak = 0.0\n        else:\n            max_power = np.max(power_spectrum)\n            total_power = np.sum(power_spectrum)\n            S_peak = max_power / total_power\n            \n        # 5. Libration fraction\n        A_thr = thresholds['A_thr']\n        F_lib = np.mean(np.abs(delta) = A_thr)\n\n        # Decision rule\n        res_R = R >= thresholds['R_thr']\n        res_W = W = thresholds['W_thr']\n        res_A = A = thresholds['A_thr']\n        res_Speak = S_peak >= thresholds['S_thr']\n        res_Flib = F_lib >= thresholds['F_thr']\n\n        return all([res_R, res_W, res_A, res_Speak, res_Flib])\n\n    # Derived threshold values\n    thresholds = {\n        'R_thr': 0.5,\n        'W_thr': 2.8,\n        'A_thr': 1.2,\n        'S_thr': 0.2,\n        'F_thr': 0.9,\n    }\n\n    test_cases = generate_test_cases()\n    results = []\n    for phi_series in test_cases:\n        result = is_librating(phi_series, thresholds)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}