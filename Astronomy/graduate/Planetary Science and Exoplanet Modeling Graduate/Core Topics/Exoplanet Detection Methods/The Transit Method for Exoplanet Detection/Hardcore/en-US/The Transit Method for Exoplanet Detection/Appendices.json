{
    "hands_on_practices": [
        {
            "introduction": "The foundation of studying any transiting exoplanet is to establish a precise orbital ephemeris—a predictive model of its future positions. This practice focuses on the crucial first step after transit detection: determining an accurate orbital period $P$ and a reference transit time $t_0$. This exercise  guides you through fitting a linear ephemeris model to a series of transit time measurements, each with its own uncertainty, using the robust method of weighted least-squares. Mastering this technique is fundamental for scheduling follow-up observations and for studies of transit timing variations, which can reveal the presence of other planets in the system.",
            "id": "4185095",
            "problem": "You are given multiple sets of observed exoplanet transit mid-times obtained via the transit method, where repeated transits occur periodically. Under the linear ephemeris model, the mid-time of the $n$-th transit is represented as $t_n = t_0 + n P$, where $t_0$ is the reference mid-time at transit index $n=0$, and $P$ is the orbital period. Each observed mid-time $t_n$ is measured with an independent Gaussian uncertainty $\\sigma_n$. Assume the uncertainties $\\sigma_n$ are known and correct. All times are to be treated in days. You are required to perform a weighted least-squares fit under the assumption of independent Gaussian noise to estimate $P$ and $t_0$, compute their parameter covariance matrix, and propagate uncertainties to a specified future transit index $m$.\n\nStart from fundamental principles: the linear model $t_n = t_0 + n P$, the definition of Gaussian measurement errors, and the definition of the weighted least-squares objective under independent measurements. From these, derive the estimator for $P$ and $t_0$ and the parameter covariance matrix. Then, using linear uncertainty propagation, derive the uncertainty for a predicted future transit time $t_m$ at an index $m$.\n\nImplement a program that, for each provided test case, computes:\n- The fitted orbital period $P$ (in days).\n- The fitted reference mid-time $t_0$ (in days).\n- The one-standard-deviation uncertainty of $P$, denoted $\\sigma_P$ (in days).\n- The one-standard-deviation uncertainty of $t_0$, denoted $\\sigma_{t_0}$ (in days).\n- The covariance between $t_0$ and $P$, denoted $\\mathrm{Cov}(t_0,P)$ (in days$^2$).\n- The predicted future mid-time $t_m$ (in days) at the specified future transit index $m$.\n- The one-standard-deviation uncertainty of $t_m$, denoted $\\sigma_{t_m}$ (in days).\n\nAll outputs must be expressed in days, rounded to six decimal places. The angle unit is not applicable. Do not use percentages; all uncertainties must be numeric floats.\n\nUse the following test suite, where each test case supplies a list of transit indices $n$, corresponding observed mid-times $t$ (in days), corresponding uncertainties $\\sigma$ (in days), and a future index $m$ for prediction:\n\n- Test case $1$ (general, well-sampled, heteroscedastic):\n  - $n = [\\,0,\\,1,\\,2,\\,3,\\,4,\\,5,\\,6,\\,7\\,]$\n  - $t = [\\,2457000.123756,\\,2457003.64770459,\\,2457007.17305318,\\,2457010.69770177,\\,2457014.22225036,\\,2457017.74759895,\\,2457021.27184754,\\,2457024.79689613\\,]$\n  - $\\sigma = [\\,0.0010,\\,0.0012,\\,0.0009,\\,0.0011,\\,0.0010,\\,0.0008,\\,0.0013,\\,0.0009\\,]$\n  - $m = 20$\n\n- Test case $2$ (boundary case with exactly two observations, widely separated in index):\n  - $n = [\\,0,\\,10\\,]$\n  - $t = [\\,2458000.0001,\\,2458012.34547\\,]$\n  - $\\sigma = [\\,0.0003,\\,0.0005\\,]$\n  - $m = 25$\n\n- Test case $3$ (edge case with one outlier and appropriately large uncertainty):\n  - $n = [\\,0,\\,1,\\,2,\\,3,\\,4\\,]$\n  - $t = [\\,50000.002,\\,50000.799,\\,50001.65,\\,50002.4,\\,50003.198\\,]$\n  - $\\sigma = [\\,0.001,\\,0.001,\\,0.05,\\,0.0015,\\,0.001\\,]$\n  - $m = 10$\n\n- Test case $4$ (uneven weights and irregular sampling):\n  - $n = [\\,0,\\,5,\\,6,\\,12,\\,13\\,]$\n  - $t = [\\,1000.0003,\\,1009.9999,\\,1012.0002,\\,1024.0,\\,1025.9985\\,]$\n  - $\\sigma = [\\,0.01,\\,0.0002,\\,0.0002,\\,0.0003,\\,0.005\\,]$\n  - $m = 50$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list of seven floats in the order $[\\,P,\\,t_0,\\,\\sigma_P,\\,\\sigma_{t_0},\\,\\mathrm{Cov}(t_0,P),\\,t_m,\\,\\sigma_{t_m}\\,]$, rounded to six decimal places. The final output must therefore be a single list aggregating the four per-case lists, for example: $[\\,[p_1, t0_1, \\ldots],\\,[p_2, t0_2, \\ldots],\\,[p_3, t0_3, \\ldots],\\,[p_4, t0_4, \\ldots]\\,]$.",
            "solution": "We model the observed transit mid-times under a linear ephemeris. The deterministic model is $t_n = t_0 + n P$, where $t_0$ is the transit mid-time at index $n=0$ and $P$ is the orbital period. Observations are $t_n^{\\mathrm{obs}}$ with independent Gaussian errors of known standard deviations $\\sigma_n$. Under independent Gaussian errors, the likelihood is\n$$\n\\mathcal{L}(t_0,P) = \\prod_{n} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_n} \\exp\\left( -\\frac{(t_n^{\\mathrm{obs}} - t_0 - n P)^2}{2\\sigma_n^2} \\right).\n$$\nMaximizing the likelihood is equivalent to minimizing the weighted sum of squared residuals,\n$$\nS(t_0,P) = \\sum_n w_n \\left( t_n^{\\mathrm{obs}} - t_0 - n P \\right)^2,\n$$\nwhere $w_n = 1/\\sigma_n^2$ are the weights associated with each observation.\n\nIntroduce the design matrix for the linear model. For each observation index $n$, define the regressor vector $\\boldsymbol{x}_n = [\\,1,\\,n\\,]^\\top$ and the parameter vector $\\boldsymbol{\\beta} = [\\,t_0,\\,P\\,]^\\top$. The model is $t_n^{\\mathrm{obs}} \\approx \\boldsymbol{x}_n^\\top \\boldsymbol{\\beta}$. The weighted least-squares normal equations are given by\n$$\n\\left( \\sum_n w_n \\boldsymbol{x}_n \\boldsymbol{x}_n^\\top \\right) \\hat{\\boldsymbol{\\beta}} = \\sum_n w_n t_n^{\\mathrm{obs}} \\boldsymbol{x}_n,\n$$\nwhich we can write explicitly using weighted sums. Define the following weighted sums:\n$$\nS_{00} = \\sum_n w_n, \\quad S_{01} = \\sum_n w_n n, \\quad S_{11} = \\sum_n w_n n^2,\n$$\nand the weighted data sums\n$$\nY_0 = \\sum_n w_n t_n^{\\mathrm{obs}}, \\quad Y_1 = \\sum_n w_n n t_n^{\\mathrm{obs}}.\n$$\nThen the normal matrix is\n$$\n\\boldsymbol{S} = \\begin{bmatrix} S_{00}  S_{01} \\\\ S_{01}  S_{11} \\end{bmatrix}, \\quad \\boldsymbol{y} = \\begin{bmatrix} Y_0 \\\\ Y_1 \\end{bmatrix}.\n$$\nThe weighted least-squares estimator is\n$$\n\\hat{\\boldsymbol{\\beta}} = \\boldsymbol{S}^{-1} \\boldsymbol{y}.\n$$\nLet $D = S_{00} S_{11} - S_{01}^2$ denote the determinant of $\\boldsymbol{S}$. The inverse of the $2\\times 2$ matrix $\\boldsymbol{S}$ is\n$$\n\\boldsymbol{S}^{-1} = \\frac{1}{D} \\begin{bmatrix} S_{11}  -S_{01} \\\\ -S_{01}  S_{00} \\end{bmatrix}.\n$$\nTherefore, the parameter estimates are\n$$\n\\hat{t}_0 = \\frac{Y_0 S_{11} - Y_1 S_{01}}{D}, \\quad \\hat{P} = \\frac{Y_1 S_{00} - Y_0 S_{01}}{D}.\n$$\n\nUnder the assumption that the measurement variances $\\sigma_n^2$ are known and correctly specified, the parameter covariance matrix is given by the inverse of the Fisher information, which for weighted least squares equals the inverse of the normal matrix:\n$$\n\\mathrm{Cov}(\\hat{\\boldsymbol{\\beta}}) = \\boldsymbol{S}^{-1} = \\begin{bmatrix} \\mathrm{Var}(\\hat{t}_0)  \\mathrm{Cov}(\\hat{t}_0,\\hat{P}) \\\\ \\mathrm{Cov}(\\hat{t}_0,\\hat{P})  \\mathrm{Var}(\\hat{P}) \\end{bmatrix} = \\frac{1}{D} \\begin{bmatrix} S_{11}  -S_{01} \\\\ -S_{01}  S_{00} \\end{bmatrix}.\n$$\nThus,\n$$\n\\sigma_{t_0} = \\sqrt{\\mathrm{Var}(\\hat{t}_0)} = \\sqrt{\\frac{S_{11}}{D}}, \\quad \\sigma_P = \\sqrt{\\mathrm{Var}(\\hat{P})} = \\sqrt{\\frac{S_{00}}{D}}, \\quad \\mathrm{Cov}(\\hat{t}_0,\\hat{P}) = -\\frac{S_{01}}{D}.\n$$\n\nTo predict the future transit mid-time at index $m$, we use the linear model\n$$\n\\hat{t}_m = \\hat{t}_0 + m \\hat{P}.\n$$\nFor linear propagation of uncertainty from jointly Gaussian parameter estimates, the variance of $\\hat{t}_m$ is\n$$\n\\mathrm{Var}(\\hat{t}_m) = \\begin{bmatrix} 1  m \\end{bmatrix} \\mathrm{Cov}(\\hat{\\boldsymbol{\\beta}}) \\begin{bmatrix} 1 \\\\ m \\end{bmatrix} = \\mathrm{Var}(\\hat{t}_0) + 2 m \\,\\mathrm{Cov}(\\hat{t}_0,\\hat{P}) + m^2 \\,\\mathrm{Var}(\\hat{P}).\n$$\nTherefore,\n$$\n\\sigma_{t_m} = \\sqrt{\\mathrm{Var}(\\hat{t}_m)}.\n$$\n\nAlgorithmic steps for each test case:\n1. Take arrays $n$, $t$, and $\\sigma$, compute weights $w_n = 1/\\sigma_n^2$.\n2. Compute $S_{00}$, $S_{01}$, $S_{11}$, $Y_0$, and $Y_1$ via weighted sums.\n3. Compute $D = S_{00} S_{11} - S_{01}^2$ and solve for $\\hat{t}_0$ and $\\hat{P}$ using the formulas above.\n4. Compute the covariance matrix elements $\\mathrm{Var}(\\hat{t}_0)$, $\\mathrm{Var}(\\hat{P})$, and $\\mathrm{Cov}(\\hat{t}_0,\\hat{P})$ from $\\boldsymbol{S}^{-1}$.\n5. For the specified future index $m$, compute $\\hat{t}_m = \\hat{t}_0 + m \\hat{P}$ and $\\sigma_{t_m}$ using the linear propagation formula.\n6. Round all outputs to six decimal places and return the list $[\\,\\hat{P},\\,\\hat{t}_0,\\,\\sigma_P,\\,\\sigma_{t_0},\\,\\mathrm{Cov}(\\hat{t}_0,\\hat{P}),\\,\\hat{t}_m,\\,\\sigma_{t_m}\\,]$.\n7. Aggregate results for all test cases into a single list and print it as a single line as specified.\n\nThis method is scientifically grounded in maximum likelihood estimation for linear models under independent Gaussian noise and standard linear error propagation, which are well-tested and widely accepted within planetary science and exoplanet modeling for transit timing analyses.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef weighted_linear_fit(n, t, sigma):\n    \"\"\"\n    Perform weighted least-squares fit for t_n = t0 + n * P.\n    Returns estimates: P, t0, and covariance matrix elements C00, C01, C11 where\n    Cov([t0, P]) = [[C00, C01],\n                    [C01, C11]]\n    \"\"\"\n    n = np.asarray(n, dtype=float)\n    t = np.asarray(t, dtype=float)\n    sigma = np.asarray(sigma, dtype=float)\n    w = 1.0 / (sigma ** 2)\n\n    # Weighted sums for normal equations\n    S00 = np.sum(w)\n    S01 = np.sum(w * n)\n    S11 = np.sum(w * n * n)\n    Y0 = np.sum(w * t)\n    Y1 = np.sum(w * n * t)\n\n    D = S00 * S11 - S01 * S01\n    if D = 0.0:\n        raise ValueError(\"Normal matrix is singular or ill-conditioned (non-positive determinant).\")\n\n    # Parameter estimates\n    t0_hat = (Y0 * S11 - Y1 * S01) / D\n    P_hat = (Y1 * S00 - Y0 * S01) / D\n\n    # Covariance matrix elements (since Cov = (X^T W X)^-1 for known variances)\n    C00 = S11 / D           # Var(t0)\n    C01 = -S01 / D          # Cov(t0, P)\n    C11 = S00 / D           # Var(P)\n\n    return P_hat, t0_hat, C00, C01, C11\n\ndef propagate_prediction(t0_hat, P_hat, C00, C01, C11, m):\n    \"\"\"\n    Predict future transit time and its uncertainty for index m.\n    Returns t_pred, sigma_t_pred.\n    \"\"\"\n    t_pred = t0_hat + m * P_hat\n    var_pred = C00 + 2.0 * m * C01 + (m ** 2) * C11\n    # Numerical safety: variance should be non-negative; clamp small negatives due to rounding\n    if var_pred  0 and var_pred > -1e-18:\n        var_pred = 0.0\n    sigma_pred = np.sqrt(var_pred)\n    return t_pred, sigma_pred\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        (\n            [0, 1, 2, 3, 4, 5, 6, 7],\n            [2457000.123756, 2457003.64770459, 2457007.17305318, 2457010.69770177,\n             2457014.22225036, 2457017.74759895, 2457021.27184754, 2457024.79689613],\n            [0.0010, 0.0012, 0.0009, 0.0011, 0.0010, 0.0008, 0.0013, 0.0009],\n            20\n        ),\n        # Test case 2\n        (\n            [0, 10],\n            [2458000.0001, 2458012.34547],\n            [0.0003, 0.0005],\n            25\n        ),\n        # Test case 3\n        (\n            [0, 1, 2, 3, 4],\n            [50000.002, 50000.799, 50001.65, 50002.4, 50003.198],\n            [0.001, 0.001, 0.05, 0.0015, 0.001],\n            10\n        ),\n        # Test case 4\n        (\n            [0, 5, 6, 12, 13],\n            [1000.0003, 1009.9999, 1012.0002, 1024.0, 1025.9985],\n            [0.01, 0.0002, 0.0002, 0.0003, 0.005],\n            50\n        ),\n    ]\n\n    results = []\n    for n, t, sigma, m in test_cases:\n        P_hat, t0_hat, C00, C01, C11 = weighted_linear_fit(n, t, sigma)\n        sigma_P = np.sqrt(C11)\n        sigma_t0 = np.sqrt(C00)\n        cov_t0P = C01\n        t_pred, sigma_t_pred = propagate_prediction(t0_hat, P_hat, C00, C01, C11, m)\n\n        # Round to six decimal places as specified\n        formatted = [\n            f\"{P_hat:.6f}\",\n            f\"{t0_hat:.6f}\",\n            f\"{sigma_P:.6f}\",\n            f\"{sigma_t0:.6f}\",\n            f\"{cov_t0P:.6f}\",\n            f\"{t_pred:.6f}\",\n            f\"{sigma_t_pred:.6f}\",\n        ]\n        results.append(f\"[{','.join(formatted)}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "An exoplanet's radius is typically inferred from its transit depth, but this calculation often relies on the simplifying assumption that the host star is a perfectly uniform source of light. In reality, stellar surfaces are mottled by features like cool, dark starspots. This practice  investigates how the presence of unocculted starspots alters the star's total out-of-transit flux, leading to a systematic overestimation of the transit depth and, consequently, the planet's radius. By working through this derivation, you will quantify a critical systematic bias that must be considered for accurate exoplanet characterization.",
            "id": "4185160",
            "problem": "A star of radius $R_{\\star}$ hosts a transiting planet of radius $R_{p}$. The stellar photosphere is composed of two components: a \"quiet\" region of uniform temperature $T_{\\mathrm{q}}$ covering fractional area $(1 - f)$ and cooler starspots of uniform temperature $T_{\\mathrm{s}}  T_{\\mathrm{q}}$ covering fractional area $f$. Assume the planet's transit chord crosses only quiet photosphere (no spot crossings), the stellar disk emits isotropically with negligible limb darkening, and the observation is made in a narrow photometric band of central wavelength $\\lambda$ such that the measured out-of-transit flux is directly proportional to the area-weighted specific intensity at $\\lambda$.\n\nStarting from the definition that the transit depth is the ratio of blocked stellar flux to the out-of-transit stellar flux, derive an expression for the observed mid-transit depth in the spotted case, $\\delta_{\\mathrm{eff}}$, in terms of the reference mid-transit depth for a completely quiet star, $\\delta$, and the out-of-transit fluxes $F_{\\mathrm{quiet}}$ and $F_{\\mathrm{spotted}}$. Then specialize this expression to the case where the specific intensity is given by the Planck spectral radiance $B_{\\lambda}(T)$ at wavelength $\\lambda$.\n\nUsing your derived expression, compute the multiplicative bias factor $\\delta_{\\mathrm{eff}} / \\delta$ for the following parameters: $T_{\\mathrm{q}} = 5800\\ \\mathrm{K}$, $T_{\\mathrm{s}} = 4800\\ \\mathrm{K}$, $f = 0.05$, and $\\lambda = 600\\ \\mathrm{nm}$. Use the Planck function $B_{\\lambda}(T) = \\dfrac{2 h c^{2}}{\\lambda^{5}}\\left[\\exp\\!\\left(\\dfrac{h c}{\\lambda k_{B} T}\\right) - 1\\right]^{-1}$, with $h = 6.62607015 \\times 10^{-34}\\ \\mathrm{J\\cdot s}$, $c = 2.99792458 \\times 10^{8}\\ \\mathrm{m/s}$, and $k_{B} = 1.380649 \\times 10^{-23}\\ \\mathrm{J/K}$. Express the final answer as a dimensionless number and round your answer to four significant figures.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. It describes a standard problem in exoplanet transit photometry and is based on fundamental principles of radiative transfer and geometry. The problem is therefore deemed valid.\n\nThe problem asks for three results:\n1.  An expression for the observed mid-transit depth, $\\delta_{\\mathrm{eff}}$, in terms of the reference depth for a quiet star, $\\delta$, and the out-of-transit fluxes $F_{\\mathrm{quiet}}$ and $F_{\\mathrm{spotted}}$.\n2.  The specialization of this expression to the case where stellar emission follows the Planck spectral radiance, $B_{\\lambda}(T)$.\n3.  A numerical calculation of the multiplicative bias factor, $\\delta_{\\mathrm{eff}}/\\delta$, for a given set of parameters.\n\nLet $R_{\\star}$ be the stellar radius and $R_{\\mathrm{p}}$ be the planet radius. The projected disk area of the star is $A_{\\star} = \\pi R_{\\star}^{2}$ and that of the planet is $A_{\\mathrm{p}} = \\pi R_{\\mathrm{p}}^{2}$.\nThe problem states that the out-of-transit flux is proportional to the area-weighted specific intensity. Let $I_{\\mathrm{q}}$ be the specific intensity of the quiet photosphere at temperature $T_{\\mathrm{q}}$ and $I_{\\mathrm{s}}$ be the specific intensity of the starspots at temperature $T_{\\mathrm{s}}$.\n\nThe out-of-transit flux for a hypothetical, completely quiet star is denoted $F_{\\mathrm{quiet}}$. It is proportional to the total stellar area multiplied by the quiet photosphere intensity:\n$$F_{\\mathrm{quiet}} \\propto A_{\\star} I_{\\mathrm{q}}$$\nFor the spotted star, a fraction $f$ of the stellar disk is covered by spots. The out-of-transit flux, $F_{\\mathrm{spotted}}$, is therefore:\n$$F_{\\mathrm{spotted}} \\propto (1-f) A_{\\star} I_{\\mathrm{q}} + f A_{\\star} I_{\\mathrm{s}}$$\n\nThe transit depth is defined as the ratio of the blocked stellar flux to the out-of-transit stellar flux.\nThe reference transit depth, $\\delta$, corresponds to a transit across a completely quiet star. The blocked flux, $\\Delta F_{\\mathrm{quiet}}$, is the flux from the area of the planet, $A_{\\mathrm{p}}$, which has uniform intensity $I_{\\mathrm{q}}$.\n$$\\delta = \\frac{\\Delta F_{\\mathrm{quiet}}}{F_{\\mathrm{quiet}}} = \\frac{k A_{\\mathrm{p}} I_{\\mathrm{q}}}{k A_{\\star} I_{\\mathrm{q}}} = \\frac{A_{\\mathrm{p}}}{A_{\\star}} = \\left(\\frac{R_{\\mathrm{p}}}{R_{\\star}}\\right)^{2}$$\nHere, $k$ is a constant of proportionality relating specific intensity and area to observed flux.\n\nFor the spotted star, the problem states that the planet transits a region of quiet photosphere. Therefore, the blocked flux, $\\Delta F$, is due to the occultation of a surface with specific intensity $I_{\\mathrm{q}}$. The magnitude of the blocked flux is the same as in the quiet star case:\n$$\\Delta F \\propto A_{\\mathrm{p}} I_{\\mathrm{q}}$$\nWe can relate this to $F_{\\mathrm{quiet}}$ and $\\delta$:\n$$\\Delta F = \\frac{A_{\\mathrm{p}}}{A_{\\star}} (k A_{\\star} I_{\\mathrm{q}}) = \\delta F_{\\mathrm{quiet}}$$\nThe observed transit depth for the spotted star, $\\delta_{\\mathrm{eff}}$, is the ratio of this blocked flux to the total out-of-transit flux from the spotted star, $F_{\\mathrm{spotted}}$:\n$$\\delta_{\\mathrm{eff}} = \\frac{\\Delta F}{F_{\\mathrm{spotted}}} = \\frac{\\delta F_{\\mathrm{quiet}}}{F_{\\mathrm{spotted}}}$$\nThis is the first required expression. It shows that the observed depth is the geometric depth scaled by the ratio of the flux of a quiet star to that of the spotted star. Since $T_{\\mathrm{s}}  T_{\\mathrm{q}}$, we have $I_{\\mathrm{s}}  I_{\\mathrm{q}}$, which implies $F_{\\mathrm{spotted}}  F_{\\mathrm{quiet}}$. Consequently, $\\delta_{\\mathrm{eff}}  \\delta$. The presence of unocculted cool spots makes the transit appear deeper.\n\nNext, we specialize this result using the Planck function for specific intensity at a given wavelength $\\lambda$: $I_{\\lambda} = B_{\\lambda}(T)$.\nThus, $I_{\\mathrm{q}} = B_{\\lambda}(T_{\\mathrm{q}})$ and $I_{\\mathrm{s}} = B_{\\lambda}(T_{\\mathrm{s}})$. The ratio of the fluxes becomes:\n$$\\frac{F_{\\mathrm{quiet}}}{F_{\\mathrm{spotted}}} = \\frac{k A_{\\star} B_{\\lambda}(T_{\\mathrm{q}})}{k \\left[ (1-f) A_{\\star} B_{\\lambda}(T_{\\mathrm{q}}) + f A_{\\star} B_{\\lambda}(T_{\\mathrm{s}}) \\right]} = \\frac{B_{\\lambda}(T_{\\mathrm{q}})}{(1-f) B_{\\lambda}(T_{\\mathrm{q}}) + f B_{\\lambda}(T_{\\mathrm{s}})}$$\nDividing the numerator and denominator by $B_{\\lambda}(T_{\\mathrm{q}})$ gives:\n$$\\frac{F_{\\mathrm{quiet}}}{F_{\\mathrm{spotted}}} = \\frac{1}{1 - f + f \\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})}}$$\nSubstituting this into the expression for $\\delta_{\\mathrm{eff}}$ yields the second result. The multiplicative bias factor is:\n$$\\frac{\\delta_{\\mathrm{eff}}}{\\delta} = \\frac{1}{1 - f + f \\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})}}$$\n\nFinally, we compute the numerical value of this bias factor. The ratio of Planck functions is:\n$$\\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})} = \\frac{\\frac{2 h c^{2}}{\\lambda^{5}}\\left[\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T_{\\mathrm{s}}}\\right) - 1\\right]^{-1}}{\\frac{2 h c^{2}}{\\lambda^{5}}\\left[\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T_{\\mathrm{q}}}\\right) - 1\\right]^{-1}} = \\frac{\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T_{\\mathrm{q}}}\\right) - 1}{\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T_{\\mathrm{s}}}\\right) - 1}$$\nWe are given the following parameters:\n$T_{\\mathrm{q}} = 5800\\ \\mathrm{K}$\n$T_{\\mathrm{s}} = 4800\\ \\mathrm{K}$\n$f = 0.05$\n$\\lambda = 600\\ \\mathrm{nm} = 6 \\times 10^{-7}\\ \\mathrm{m}$\n$h = 6.62607015 \\times 10^{-34}\\ \\mathrm{J\\cdot s}$\n$c = 2.99792458 \\times 10^{8}\\ \\mathrm{m/s}$\n$k_{B} = 1.380649 \\times 10^{-23}\\ \\mathrm{J/K}$\n\nFirst, we compute the exponents in the Planck function ratio. Let $x_{T} = \\frac{h c}{\\lambda k_{B} T}$.\n$$x_{\\mathrm{q}} = \\frac{h c}{\\lambda k_{B} T_{\\mathrm{q}}} = \\frac{(6.62607015 \\times 10^{-34}\\ \\mathrm{J\\cdot s}) (2.99792458 \\times 10^{8}\\ \\mathrm{m/s})}{(6 \\times 10^{-7}\\ \\mathrm{m}) (1.380649 \\times 10^{-23}\\ \\mathrm{J/K}) (5800\\ \\mathrm{K})} \\approx 4.134417$$\n$$x_{\\mathrm{s}} = \\frac{h c}{\\lambda k_{B} T_{\\mathrm{s}}} = \\frac{(6.62607015 \\times 10^{-34}\\ \\mathrm{J\\cdot s}) (2.99792458 \\times 10^{8}\\ \\mathrm{m/s})}{(6 \\times 10^{-7}\\ \\mathrm{m}) (1.380649 \\times 10^{-23}\\ \\mathrm{J/K}) (4800\\ \\mathrm{K})} \\approx 4.995754$$\nNow, we calculate the ratio of the Planck functions:\n$$\\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})} = \\frac{\\exp(x_{\\mathrm{q}}) - 1}{\\exp(x_{\\mathrm{s}}) - 1} = \\frac{\\exp(4.134417) - 1}{\\exp(4.995754) - 1} \\approx \\frac{62.45210 - 1}{147.7711 - 1} = \\frac{61.45210}{146.7711} \\approx 0.418698$$\nFinally, we compute the bias factor using this ratio and the spot-covering fraction $f = 0.05$:\n$$\\frac{\\delta_{\\mathrm{eff}}}{\\delta} = \\frac{1}{1 - f + f \\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})}} = \\frac{1}{1 - 0.05 + (0.05)(0.418698)} = \\frac{1}{0.95 + 0.0209349} = \\frac{1}{0.9709349} \\approx 1.029935$$\nRounding the result to four significant figures gives $1.030$.",
            "answer": "$$\\boxed{1.030}$$"
        },
        {
            "introduction": "A periodic dip in a star's brightness is not always a planet; a common astrophysical imposter is a background eclipsing binary star system whose light blends with the foreground target. Distinguishing a genuine planet from such a \"false positive\" is a critical step in exoplanet validation. This advanced exercise  simulates this crucial validation process, where you will model the distinct wavelength-dependent signatures of a planetary transit versus a blended binary eclipse. By leveraging multi-band photometry to detect chromatic differences, you will implement a powerful technique at the heart of modern exoplanet discovery and confirmation.",
            "id": "4185129",
            "problem": "You are to model wavelength-dependent transit depths under two competing hypotheses and decide, using multi-band photometry, whether a transit-like dip is consistent with a planet transiting a single target star or more consistent with a background blended eclipsing binary. You must derive from first principles and implement a complete, runnable program that computes the band-dependent transit depths for a small opaque occulter under quadratic limb darkening and, for blends, the passband-dependent dilution from mixed stellar spectra. Then, for each test case, you must classify the event using a ratio-based criterion that isolates chromatic effects due solely to limb darkening from those introduced by spectral blending.\n\nStart from the following foundational bases and core definitions:\n\n- Radiative transfer definition of specific intensity and the small-planet occultation approximation. For a small opaque occulter of radius $R_{\\mathrm{occ}}$ transiting a star of radius $R_\\star$ at impact parameter $b$ (in units of $R_\\star$), the fractional flux loss (transit depth) $\\delta$ is the blocked area fraction weighted by the local specific intensity relative to the disk-integrated intensity. In the small-planet limit, this reduces to an expression involving the local surface brightness at the occulted $\\mu$ and the disk-averaged intensity.\n- Quadratic limb darkening law. The specific intensity as a function of $\\mu \\equiv \\cos\\theta$ is\n$$\n\\frac{I(\\mu)}{I(1)} = 1 - u_1\\,(1-\\mu) - u_2\\,(1-\\mu)^2,\n$$\nwhere $u_1$ and $u_2$ are limb darkening coefficients appropriate to a given passband, and $I(1)$ is the specific intensity at disk center. The disk-averaged intensity $\\langle I \\rangle$ must be derived by integrating $I(\\mu)$ over the visible stellar disk.\n- Blackbody spectral radiance (Planck function) for a star of effective temperature $T$,\n$$\nB_\\lambda(T) = \\frac{2 h c^2}{\\lambda^5} \\frac{1}{\\exp\\!\\left(\\frac{h c}{\\lambda k_{\\mathrm{B}} T}\\right) - 1},\n$$\nwhere $h$ is Planck's constant, $c$ is the speed of light, $k_{\\mathrm{B}}$ is Boltzmann's constant, and $\\lambda$ is wavelength. Assume each passband has a top-hat transmission $S_i(\\lambda)=1$ for $\\lambda \\in [\\lambda_{1,i}, \\lambda_{2,i}]$ and $S_i(\\lambda)=0$ otherwise. The passband flux from a star at distance $d$ and radius $R$ is proportional to\n$$\nF_i \\propto \\frac{R^2}{d^2} \\int_{\\lambda_{1,i}}^{\\lambda_{2,i}} B_\\lambda(T)\\, d\\lambda.\n$$\nYou must compute this integral numerically.\n\nModeling assumptions to be derived and implemented:\n\n1. Planet hypothesis: For a small planet of radius $R_{\\mathrm{p}}$ transiting the target star, with impact parameter $b_{\\mathrm{t}}$ and limb darkening coefficients $(u_{1,i}^{\\mathrm{t}}, u_{2,i}^{\\mathrm{t}})$ in passband $i$, derive an expression for the band-dependent transit depth $\\delta^{\\mathrm{pl}}_i$ in terms of $k \\equiv R_{\\mathrm{p}}/R_\\star$, $\\mu_{\\mathrm{t}} \\equiv \\sqrt{\\max(0, 1 - b_{\\mathrm{t}}^2)}$, $I(\\mu)$, and $\\langle I \\rangle$.\n2. Blended eclipsing binary hypothesis: Consider a background eclipsing binary composed of a primary star (subscript $1$) and a secondary star (subscript $2$) with radii $R_1$ and $R_2$, temperatures $T_1$ and $T_2$, limb darkening coefficients $(u_{1,i}^{\\mathrm{eb}}, u_{2,i}^{\\mathrm{eb}})$ in passband $i$, and distance $d_{\\mathrm{eb}}$. The target star has radius $R_{\\mathrm{t}}$, temperature $T_{\\mathrm{t}}$, limb darkening coefficients $(u_{1,i}^{\\mathrm{t}}, u_{2,i}^{\\mathrm{t}})$ and distance $d_{\\mathrm{t}}$. Under the small-occulter approximation for the eclipse of the binary’s primary by its secondary, with binary impact parameter $b_{\\mathrm{eb}}$ and $\\mu_{\\mathrm{eb}} \\equiv \\sqrt{\\max(0, 1 - b_{\\mathrm{eb}}^2)}$, derive the intrinsic fractional loss of the primary’s flux $\\delta^{\\mathrm{eb,int}}_i$ and the observed blend-diluted depth\n$$\n\\delta^{\\mathrm{blend}}_i = \\frac{F_{1,i}\\, \\delta^{\\mathrm{eb,int}}_i}{F_{\\mathrm{t},i} + F_{1,i} + F_{2,i}},\n$$\nwhere $F_{\\mathrm{t},i}$, $F_{1,i}$, and $F_{2,i}$ are the passband fluxes of the target, binary primary, and binary secondary respectively.\n\nDecision criterion to implement:\n\n- For each test case, compute the measured depths $\\delta_i$ in the three passbands. Compute the limb-darkening-only prediction for the target star,\n$$\nS_i^{\\mathrm{t}} \\equiv \\frac{I^{\\mathrm{t}}(\\mu_{\\mathrm{t}})}{\\langle I^{\\mathrm{t}} \\rangle},\n$$\nand form the depth ratios $r_i \\equiv \\delta_i / \\delta_{\\mathrm{V}}$ for $i \\in \\{\\mathrm{B}, \\mathrm{V}, \\mathrm{R}\\}$. Likewise compute predicted limb-darkening ratios $R_i^{\\mathrm{t}} \\equiv S_i^{\\mathrm{t}} / S_{\\mathrm{V}}^{\\mathrm{t}}$. Classify the event as planet-consistent if the maximum absolute deviation\n$$\n\\max_{i \\in \\{\\mathrm{B},\\mathrm{R}\\}} \\left| r_i - R_i^{\\mathrm{t}} \\right|  \\tau,\n$$\nwith tolerance $\\tau = 0.03$ (unitless). Otherwise classify as not planet-consistent.\n\nPassbands and units:\n\n- Use three top-hat passbands with wavelength intervals specified in meters:\n  - Blue (B): $\\lambda \\in [4.0 \\times 10^{-7},\\, 5.0 \\times 10^{-7}]$ m.\n  - Visual (V): $\\lambda \\in [5.0 \\times 10^{-7},\\, 6.0 \\times 10^{-7}]$ m.\n  - Red (R): $\\lambda \\in [6.0 \\times 10^{-7},\\, 7.0 \\times 10^{-7}]$ m.\n- Physical inputs must be treated in the specified International System of Units (SI): radii in meters, distances in meters, temperatures in Kelvin, and wavelengths in meters.\n- Express the final transit depths as unitless fractions rounded to six decimal places.\n\nTest suite:\n\nImplement your program to compute results for the following four parameter sets. In each case, compute the three band depths and the classification boolean.\n\n- Case $1$ (planet on a Sun-like target, central transit):\n  - Target star: $R_\\star = 6.957 \\times 10^{8}$ m, $T_{\\mathrm{t}} = 5777$ K, impact parameter $b_{\\mathrm{t}} = 0.0$.\n  - Planet: $R_{\\mathrm{p}} = 6.957 \\times 10^{7}$ m.\n  - Limb darkening coefficients for the target in each passband:\n    - B: $(u_{1,\\mathrm{B}}^{\\mathrm{t}}, u_{2,\\mathrm{B}}^{\\mathrm{t}}) = (0.55, 0.16)$.\n    - V: $(u_{1,\\mathrm{V}}^{\\mathrm{t}}, u_{2,\\mathrm{V}}^{\\mathrm{t}}) = (0.49, 0.22)$.\n    - R: $(u_{1,\\mathrm{R}}^{\\mathrm{t}}, u_{2,\\mathrm{R}}^{\\mathrm{t}}) = (0.40, 0.28)$.\n- Case $2$ (planet on a K-type target, grazing transit):\n  - Target star: $R_\\star = 0.9 \\times 6.957 \\times 10^{8}$ m, $T_{\\mathrm{t}} = 5000$ K, impact parameter $b_{\\mathrm{t}} = 0.9$.\n  - Planet: $R_{\\mathrm{p}} = 0.03 \\times 6.957 \\times 10^{8}$ m.\n  - Limb darkening coefficients for the target in each passband:\n    - B: $(u_{1,\\mathrm{B}}^{\\mathrm{t}}, u_{2,\\mathrm{B}}^{\\mathrm{t}}) = (0.80, 0.10)$.\n    - V: $(u_{1,\\mathrm{V}}^{\\mathrm{t}}, u_{2,\\mathrm{V}}^{\\mathrm{t}}) = (0.70, 0.10)$.\n    - R: $(u_{1,\\mathrm{R}}^{\\mathrm{t}}, u_{2,\\mathrm{R}}^{\\mathrm{t}}) = (0.60, 0.10)$.\n- Case $3$ (blended eclipsing binary behind a Sun-like target):\n  - Target star: $R_{\\mathrm{t}} = 6.957 \\times 10^{8}$ m, $T_{\\mathrm{t}} = 5777$ K, $d_{\\mathrm{t}} = 300 \\times 3.0857 \\times 10^{16}$ m, assumed impact parameter for classification $b_{\\mathrm{t}} = 0.4$.\n  - Target limb darkening coefficients for classification:\n    - B: $(u_{1,\\mathrm{B}}^{\\mathrm{t}}, u_{2,\\mathrm{B}}^{\\mathrm{t}}) = (0.55, 0.16)$.\n    - V: $(u_{1,\\mathrm{V}}^{\\mathrm{t}}, u_{2,\\mathrm{V}}^{\\mathrm{t}}) = (0.49, 0.22)$.\n    - R: $(u_{1,\\mathrm{R}}^{\\mathrm{t}}, u_{2,\\mathrm{R}}^{\\mathrm{t}}) = (0.40, 0.28)$.\n  - Binary primary: $R_1 = 0.7 \\times 6.957 \\times 10^{8}$ m, $T_1 = 4500$ K.\n  - Binary secondary: $R_2 = 0.3 \\times 6.957 \\times 10^{8}$ m, $T_2 = 4000$ K.\n  - Binary distance: $d_{\\mathrm{eb}} = 1500 \\times 3.0857 \\times 10^{16}$ m, impact parameter $b_{\\mathrm{eb}} = 0.2$.\n  - Binary limb darkening coefficients:\n    - B: $(u_{1,\\mathrm{B}}^{\\mathrm{eb}}, u_{2,\\mathrm{B}}^{\\mathrm{eb}}) = (0.75, 0.15)$.\n    - V: $(u_{1,\\mathrm{V}}^{\\mathrm{eb}}, u_{2,\\mathrm{V}}^{\\mathrm{eb}}) = (0.65, 0.15)$.\n    - R: $(u_{1,\\mathrm{R}}^{\\mathrm{eb}}, u_{2,\\mathrm{R}}^{\\mathrm{eb}}) = (0.55, 0.15)$.\n- Case $4$ (blended eclipsing binary with hot primary behind a cool M-dwarf target):\n  - Target star: $R_{\\mathrm{t}} = 0.4 \\times 6.957 \\times 10^{8}$ m, $T_{\\mathrm{t}} = 3500$ K, $d_{\\mathrm{t}} = 200 \\times 3.0857 \\times 10^{16}$ m, assumed impact parameter for classification $b_{\\mathrm{t}} = 0.5$.\n  - Target limb darkening coefficients for classification:\n    - B: $(u_{1,\\mathrm{B}}^{\\mathrm{t}}, u_{2,\\mathrm{B}}^{\\mathrm{t}}) = (0.90, 0.10)$.\n    - V: $(u_{1,\\mathrm{V}}^{\\mathrm{t}}, u_{2,\\mathrm{V}}^{\\mathrm{t}}) = (0.85, 0.10)$.\n    - R: $(u_{1,\\mathrm{R}}^{\\mathrm{t}}, u_{2,\\mathrm{R}}^{\\mathrm{t}}) = (0.80, 0.10)$.\n  - Binary primary: $R_1 = 1.8 \\times 6.957 \\times 10^{8}$ m, $T_1 = 9000$ K.\n  - Binary secondary: $R_2 = 0.6 \\times 6.957 \\times 10^{8}$ m, $T_2 = 6500$ K.\n  - Binary distance: $d_{\\mathrm{eb}} = 1000 \\times 3.0857 \\times 10^{16}$ m, impact parameter $b_{\\mathrm{eb}} = 0.2$.\n  - Binary limb darkening coefficients:\n    - B: $(u_{1,\\mathrm{B}}^{\\mathrm{eb}}, u_{2,\\mathrm{B}}^{\\mathrm{eb}}) = (0.30, 0.10)$.\n    - V: $(u_{1,\\mathrm{V}}^{\\mathrm{eb}}, u_{2,\\mathrm{V}}^{\\mathrm{eb}}) = (0.25, 0.10)$.\n    - R: $(u_{1,\\mathrm{R}}^{\\mathrm{eb}}, u_{2,\\mathrm{R}}^{\\mathrm{eb}}) = (0.20, 0.10)$.\n\nYour program must:\n\n- Numerically integrate the Planck function over each passband using a sufficiently fine wavelength grid to ensure stability.\n- Compute $\\mu$ as $\\mu = \\sqrt{\\max(0, 1-b^2)}$ for the specified impact parameter in each scenario.\n- Use the derived expressions to compute $\\delta^{\\mathrm{pl}}_i$ and $\\delta^{\\mathrm{blend}}_i$ for the appropriate cases.\n- For each test case, output a list containing the three depths for B, V, R (each rounded to six decimal places) and the classification boolean, in that order.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case rendered as its own bracketed list without spaces. For example: \"[[dB1,dV1,dR1,True],[dB2,dV2,dR2,False],...]\".",
            "solution": "The problem posed is a valid exercise in astrophysical modeling, specifically concerning the photometric differentiation of a transiting exoplanet from a blended eclipsing binary system. It is scientifically grounded in the principles of radiative transfer and blackbody radiation, well-posed with a complete set of parameters, and objective in its formulation. We shall proceed by first deriving the necessary theoretical expressions from first principles and then implementing them computationally to analyze the provided test cases.\n\n### 1. Derivation of Core Photometric Quantities\n\nWe begin by establishing the foundational relationships for stellar intensity and flux, which underpin the entire model.\n\n**1.1. Disk-Averaged Specific Intensity**\n\nThe specific intensity of a star with quadratic limb-darkening is given by:\n$$\n\\frac{I(\\mu)}{I(1)} = 1 - u_1(1-\\mu) - u_2(1-\\mu)^2\n$$\nwhere $\\mu = \\cos\\theta$ is the cosine of the angle between the line of sight and the emergent stellar surface normal, and $I(1)$ is the intensity at the center of the stellar disk ($\\mu=1$).\n\nTo find the transit depth, we must compare the local intensity at the point of occultation to the disk-averaged intensity, $\\langle I \\rangle$. The disk-averaged intensity is defined as the total radiant flux divided by the projected area of the stellar disk, $\\pi R_\\star^2$. The flux is obtained by integrating the specific intensity over the visible stellar disk. In terms of $\\mu$, the element of projected area is $dA = 2\\pi r dr$, where the projected radius $r = R_\\star \\sin\\theta = R_\\star \\sqrt{1-\\mu^2}$. Differentiating gives $2rdr = -2 R_\\star^2 \\mu d\\mu$. The total flux integrated over the disk is thus proportional to $\\int_0^1 I(\\mu) \\mu d\\mu$.\n\nThe disk-averaged intensity $\\langle I \\rangle$ is therefore:\n$$\n\\langle I \\rangle = \\frac{\\int_{disk} I(\\mu) dA_{proj}}{\\int_{disk} dA_{proj}} = \\frac{\\int_0^1 I(\\mu) (2\\pi R_\\star^2 \\mu d\\mu)}{\\pi R_\\star^2} = 2 \\int_0^1 I(\\mu) \\mu d\\mu\n$$\nSubstituting the expression for $I(\\mu)$:\n$$\n\\langle I \\rangle = 2 \\int_0^1 I(1) \\left[1 - u_1(1-\\mu) - u_2(1-\\mu)^2\\right] \\mu d\\mu\n$$\n$$\n\\langle I \\rangle = 2 I(1) \\int_0^1 \\left( \\mu - u_1(\\mu - \\mu^2) - u_2(\\mu - 2\\mu^2 + \\mu^3) \\right) d\\mu\n$$\nEvaluating the integral term by term:\n$$\n\\int_0^1 \\mu d\\mu = \\frac{1}{2}; \\quad \\int_0^1 (\\mu - \\mu^2)d\\mu = \\frac{1}{2} - \\frac{1}{3} = \\frac{1}{6}; \\quad \\int_0^1 (\\mu - 2\\mu^2 + \\mu^3)d\\mu = \\frac{1}{2} - \\frac{2}{3} + \\frac{1}{4} = \\frac{1}{12}\n$$\nSubstituting these results back:\n$$\n\\langle I \\rangle = 2 I(1) \\left( \\frac{1}{2} - \\frac{u_1}{6} - \\frac{u_2}{12} \\right) = I(1) \\left( 1 - \\frac{u_1}{3} - \\frac{u_2}{6} \\right)\n$$\nThis provides the denominator for our intensity ratio.\n\n**1.2. Passband-Integrated Flux**\n\nThe flux received from a star of radius $R$ at a distance $d$ in a given passband $i$ is proportional to its luminosity in that band divided by $4\\pi d^2$. The luminosity is the surface area ($4\\pi R^2$) times the emitted flux per unit area (integrated spectral radiance). We are given that the passband flux is proportional to:\n$$\nF_i \\propto \\frac{R^2}{d^2} \\int_{\\lambda_{1,i}}^{\\lambda_{2,i}} B_\\lambda(T)\\, d\\lambda\n$$\nwhere $B_\\lambda(T)$ is the Planck function:\n$$\nB_\\lambda(T) = \\frac{2 h c^2}{\\lambda^5} \\frac{1}{\\exp\\left(\\frac{h c}{\\lambda k_{\\mathrm{B}} T}\\right) - 1}\n$$\nWe define the passband-integrated blackbody emittance as $E_i(T) = \\int_{\\lambda_{1,i}}^{\\lambda_{2,i}} B_\\lambda(T)\\, d\\lambda$. This integral must be computed numerically. The relative flux contribution from any star $j$ in passband $i$ is then proportional to $f_{j,i} = (R_j/d_j)^2 E_i(T_j)$.\n\n### 2. Transit Depth Modeling\n\n**2.1. Planet Hypothesis**\n\nA small, opaque occulter (a planet of radius $R_{\\mathrm{p}}$) transiting a star of radius $R_\\star$ produces a fractional flux loss (depth, $\\delta$) given by the ratio of the blocked flux to the total stellar flux. In the small-planet approximation, this simplifies to the area ratio of the planet to the star, weighted by the relative surface brightness at the occultation location:\n$$\n\\delta = \\frac{\\text{Area}_{\\mathrm{p}} \\times I(\\mu_{\\mathrm{occ}})}{\\text{Area}_{\\star} \\times \\langle I \\rangle} = \\left(\\frac{R_{\\mathrm{p}}}{R_\\star}\\right)^2 \\frac{I(\\mu_{\\mathrm{occ}})}{\\langle I \\rangle}\n$$\nFor a transit with impact parameter $b$ (in units of stellar radii), the location of the occultation corresponds to $\\mu_t = \\sqrt{\\max(0, 1-b^2)}$. Let $k \\equiv R_{\\mathrm{p}}/R_\\star$. The band-dependent transit depth, $\\delta^{\\mathrm{pl}}_i$, is:\n$$\n\\delta^{\\mathrm{pl}}_i = k^2 \\frac{I_i^{\\mathrm{t}}(\\mu_t)}{\\langle I_i^{\\mathrm{t}} \\rangle} = k^2 \\frac{1 - u_{1,i}^{\\mathrm{t}}(1-\\mu_t) - u_{2,i}^{\\mathrm{t}}(1-\\mu_t)^2}{1 - u_{1,i}^{\\mathrm{t}}/3 - u_{2,i}^{\\mathrm{t}}/6}\n$$\nThe factor $S_i^{\\mathrm{t}} \\equiv I_i^{\\mathrm{t}}(\\mu_t) / \\langle I_i^{\\mathrm{t}} \\rangle$ encapsulates the chromatic effect of limb darkening.\n\n**2.2. Blended Eclipsing Binary Hypothesis**\n\nIn this scenario, the observed flux is the sum of contributions from the foreground target star ($t$) and the two stars of the background eclipsing binary ($1$ and $2$).\n$$\nF_{\\mathrm{total},i} = F_{\\mathrm{t},i} + F_{1,i} + F_{2,i}\n$$\nAn eclipse occurs within the binary system where the secondary (star $2$) occults the primary (star $1$). The intrinsic fractional flux loss of star $1$, using the same small-occulter approximation, is:\n$$\n\\delta^{\\mathrm{eb,int}}_i = \\left(\\frac{R_2}{R_1}\\right)^2 \\frac{I_i^{\\mathrm{eb}}(\\mu_{eb})}{\\langle I_i^{\\mathrm{eb}} \\rangle}\n$$\nwhere $\\mu_{eb} = \\sqrt{\\max(0, 1-b_{eb}^2)}$ and the intensities and limb darkening coefficients $(u_{1,i}^{\\mathrm{eb}}, u_{2,i}^{\\mathrm{eb}})$ are for the primary star of the binary. The absolute flux lost during the eclipse is $\\Delta F_i = F_{1,i} \\delta^{\\mathrm{eb,int}}_i$. The observed depth is this flux loss divided by the total system flux:\n$$\n\\delta^{\\mathrm{blend}}_i = \\frac{\\Delta F_i}{F_{\\mathrm{total},i}} = \\frac{F_{1,i} \\delta^{\\mathrm{eb,int}}_i}{F_{\\mathrm{t},i} + F_{1,i} + F_{2,i}}\n$$\nUsing the proportionality $F_{j,i} \\propto f_{j,i} = (R_j/d_j)^2 E_i(T_j)$, the expression becomes:\n$$\n\\delta^{\\mathrm{blend}}_i = \\frac{f_{1,i} \\delta^{\\mathrm{eb,int}}_i}{f_{\\mathrm{t},i} + f_{1,i} + f_{2,i}}\n$$\nThis form shows that the observed depth is a function of both the intrinsic eclipse depth and the relative fluxes of the three involved stars, which are highly wavelength-dependent due to their different effective temperatures.\n\n### 3. Classification Criterion\n\nThe classification scheme aims to distinguish between the chromatic effects of limb darkening alone (planet case) and the combined effects of limb darkening and spectral blending (blend case). We define a measured depth ratio $r_i = \\delta_i / \\delta_{\\mathrm{V}}$ for bands $i \\in \\{\\mathrm{B}, \\mathrm{R}\\}$. We compare this to the theoretical ratio expected from a planet transit on the target star, which depends only on the target's limb darkening:\n$$\nR_i^{\\mathrm{t}} = \\frac{\\delta^{\\mathrm{pl}}_i}{\\delta^{\\mathrm{pl}}_{\\mathrm{V}}} = \\frac{k^2 S_i^{\\mathrm{t}}}{k^2 S_{\\mathrm{V}}^{\\mathrm{t}}} = \\frac{S_i^{\\mathrm{t}}}{S_{\\mathrm{V}}^{\\mathrm{t}}}\n$$\nThe deviation is measured as $\\max_{i \\in \\{\\mathrm{B},\\mathrm{R}\\}} |r_i - R_i^{\\mathrm{t}}|$. If this deviation is below a tolerance $\\tau = 0.03$, the event is classified as planet-consistent. A large deviation suggests that an additional chromatic effect, such as dilution from spectrally different stars, is present, pointing towards the blend scenario.\n\nThe following program implements these derived models to analyze the provided test cases. Numerical integration of the Planck function is performed using `scipy.integrate.quad`. All calculations are performed in SI units.",
            "answer": "```python\nimport numpy as np\nfrom scipy import integrate\nfrom typing import List, Tuple, Dict, Any\n\ndef solve():\n    \"\"\"\n    Solves the exoplanet transit validation problem by modeling transit depths\n    under planet and blended eclipsing binary hypotheses and classifying events.\n    \"\"\"\n\n    # Physical constants in SI units\n    H = 6.62607015e-34  # Planck constant (J*s)\n    C = 299792458.0     # Speed of light (m/s)\n    KB = 1.380649e-23   # Boltzmann constant (J/K)\n    \n    # Pre-calculated constant terms for Planck function\n    _2HC2 = 2.0 * H * C**2\n    _HC_KB = H * C / KB\n\n    # Passband definitions in meters\n    PASSBANDS = {\n        'B': (4.0e-7, 5.0e-7),\n        'V': (5.0e-7, 6.0e-7),\n        'R': (6.0e-7, 7.0e-7),\n    }\n\n    # Test cases from the problem statement\n    R_sun = 6.957e8 # Solar radius in meters\n    pc_to_m = 3.0857e16 # Parsec to meter conversion\n    \n    test_cases: List[Dict[str, Any]] = [\n        {\n            'type': 'planet',\n            'params': {\n                'R_star': R_sun,\n                'T_target': 5777.0,\n                'b_target': 0.0,\n                'R_planet': 0.1 * R_sun,\n                'ld_target': {'B': (0.55, 0.16), 'V': (0.49, 0.22), 'R': (0.40, 0.28)},\n            }\n        },\n        {\n            'type': 'planet',\n            'params': {\n                'R_star': 0.9 * R_sun,\n                'T_target': 5000.0,\n                'b_target': 0.9,\n                'R_planet': 0.03 * R_sun,\n                'ld_target': {'B': (0.80, 0.10), 'V': (0.70, 0.10), 'R': (0.60, 0.10)},\n            }\n        },\n        {\n            'type': 'blend',\n            'params': {\n                'target': {'R': R_sun, 'T': 5777.0, 'd': 300.0 * pc_to_m},\n                'eb_primary': {'R': 0.7 * R_sun, 'T': 4500.0},\n                'eb_secondary': {'R': 0.3 * R_sun, 'T': 4000.0},\n                'eb_config': {'d': 1500.0 * pc_to_m, 'b': 0.2},\n                'ld_eb': {'B': (0.75, 0.15), 'V': (0.65, 0.15), 'R': (0.55, 0.15)},\n                'classification': {\n                    'b_target': 0.4,\n                    'ld_target': {'B': (0.55, 0.16), 'V': (0.49, 0.22), 'R': (0.40, 0.28)},\n                }\n            }\n        },\n        {\n            'type': 'blend',\n            'params': {\n                'target': {'R': 0.4 * R_sun, 'T': 3500.0, 'd': 200.0 * pc_to_m},\n                'eb_primary': {'R': 1.8 * R_sun, 'T': 9000.0},\n                'eb_secondary': {'R': 0.6 * R_sun, 'T': 6500.0},\n                'eb_config': {'d': 1000.0 * pc_to_m, 'b': 0.2},\n                'ld_eb': {'B': (0.30, 0.10), 'V': (0.25, 0.10), 'R': (0.20, 0.10)},\n                'classification': {\n                    'b_target': 0.5,\n                    'ld_target': {'B': (0.90, 0.10), 'V': (0.85, 0.10), 'R': (0.80, 0.10)},\n                }\n            }\n        },\n    ]\n\n    memoized_flux_integrals = {}\n\n    def planck_function(wl: float, T: float) - float:\n        \"\"\"Computes Planck function B_lambda(T) in SI units.\"\"\"\n        if T == 0: return 0.0\n        exponent = _HC_KB / (wl * T)\n        if exponent  np.log(np.finfo(float).max): return 0.0 # Avoid overflow in exp\n        return _2HC2 / (wl**5 * (np.exp(exponent) - 1.0))\n\n    def integrate_planck(T: float, wl_min: float, wl_max: float) - float:\n        \"\"\"Numerically integrates Planck function over a wavelength range.\"\"\"\n        key = (T, wl_min, wl_max)\n        if key in memoized_flux_integrals:\n            return memoized_flux_integrals[key]\n        \n        integral, _ = integrate.quad(planck_function, wl_min, wl_max, args=(T,))\n        memoized_flux_integrals[key] = integral\n        return integral\n\n    def compute_s_factor(u1: float, u2: float, b: float) - float:\n        \"\"\"Computes the limb-darkening factor S = I(mu)/I.\"\"\"\n        if b = 1.0:\n            return 0.0\n        mu = np.sqrt(1.0 - b**2)\n        numerator = 1.0 - u1 * (1.0 - mu) - u2 * (1.0 - mu)**2\n        denominator = 1.0 - u1 / 3.0 - u2 / 6.0\n        if denominator == 0: return 0.0 # Should not happen with physical LDCs\n        return numerator / denominator\n\n    results = []\n    \n    for case in test_cases:\n        depths = {}\n        \n        if case['type'] == 'planet':\n            p = case['params']\n            k = p['R_planet'] / p['R_star']\n            for band, (u1, u2) in p['ld_target'].items():\n                s_factor = compute_s_factor(u1, u2, p['b_target'])\n                depths[band] = k**2 * s_factor\n            \n            b_class = p['b_target']\n            ld_class = p['ld_target']\n\n        elif case['type'] == 'blend':\n            p = case['params']\n            t_params = p['target']\n            eb1_params = p['eb_primary']\n            eb2_params = p['eb_secondary']\n            eb_cfg = p['eb_config']\n            \n            k_eb = eb2_params['R'] / eb1_params['R'] if eb1_params['R'] != 0 else 0\n\n            flux_contribs = {}\n            for band_name, (wl_min, wl_max) in PASSBANDS.items():\n                E_t = integrate_planck(t_params['T'], wl_min, wl_max)\n                E_1 = integrate_planck(eb1_params['T'], wl_min, wl_max)\n                E_2 = integrate_planck(eb2_params['T'], wl_min, wl_max)\n                \n                f_t = (t_params['R'] / t_params['d'])**2 * E_t\n                f_1 = (eb1_params['R'] / eb_cfg['d'])**2 * E_1\n                f_2 = (eb2_params['R'] / eb_cfg['d'])**2 * E_2\n                \n                u1_eb, u2_eb = p['ld_eb'][band_name]\n                s_factor_eb = compute_s_factor(u1_eb, u2_eb, eb_cfg['b'])\n                \n                delta_eb_intrinsic = k_eb**2 * s_factor_eb\n                \n                total_flux = f_t + f_1 + f_2\n                if total_flux > 0:\n                    depths[band_name] = (f_1 * delta_eb_intrinsic) / total_flux\n                else:\n                    depths[band_name] = 0.0\n\n            b_class = p['classification']['b_target']\n            ld_class = p['classification']['ld_target']\n        \n        # Classification step\n        if 'V' not in depths or depths['V'] == 0:\n            is_planet = False\n        else:\n            r_B = depths['B'] / depths['V']\n            r_R = depths['R'] / depths['V']\n            \n            s_factors_target_model = {\n                band: compute_s_factor(u1, u2, b_class)\n                for band, (u1, u2) in ld_class.items()\n            }\n            \n            R_B_t = s_factors_target_model['B'] / s_factors_target_model['V']\n            R_R_t = s_factors_target_model['R'] / s_factors_target_model['V']\n            \n            deviation = max(abs(r_B - R_B_t), abs(r_R - R_R_t))\n            is_planet = deviation  0.03\n        \n        final_depths = [depths.get(b, 0.0) for b in ['B', 'V', 'R']]\n        results.append(final_depths + [is_planet])\n\n    # Format output as specified\n    case_strs = [f\"[{r[0]:.6f},{r[1]:.6f},{r[2]:.6f},{r[3]}]\" for r in results]\n    print(f\"[{','.join(case_strs)}]\")\n\nsolve()\n```"
        }
    ]
}