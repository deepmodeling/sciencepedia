{
    "hands_on_practices": [
        {
            "introduction": "凌星光变曲线的形态本质上是由几何决定的。最基础的凌星模型将恒星视为一个亮度均匀的圆盘。这个练习将通过计算两个圆盘的重叠面积，为您构建所有凌星建模的几何基础。掌握这个基本模型是理解行星大小（以半径比 $p$ 表示）和其凌星路径（以投影距离 $z$ 表示）如何直接塑造光变曲线形态的第一步。",
            "id": "4186773",
            "problem": "你的任务是，从第一性原理出发，推导并实现一个高效、数值稳定的算法，用于计算行星凌星期间任意投影分离值下的归一化恒星通量。该算法必须将几何构型划分为三种情况：无重叠、部分重叠和完全重叠，并且必须确保在情况边界附近的数值稳定性。恒星被建模为一个半径为单位1的均匀明亮圆盘，行星被建模为一个半径由行星与恒星半径比给出的均匀不透明圆盘。\n\n起点和定义（基本基础）：\n- 对于具有特定强度 $I(\\mu)$ 的恒星，其观测通量是 $I(\\mu)$ 在可见恒星盘上的面积分。对于一个均匀明亮的恒星，$I(\\mu) = I_0$（其中 $I_0$ 是一个常数），归一化通量等于未被遮挡的恒星面积的比例。\n- 设恒星半径为 $R_\\star = 1$（定义了单位长度），行星与恒星的半径比为 $p = R_p / R_\\star$，其中 $R_p$ 是行星半径。设恒星和行星中心之间的投影距离（以 $R_\\star$ 为单位）为 $z \\ge 0$。\n- 凌星期间的归一化通量 $F$ 定义为 $F = 1 - A_{\\mathrm{overlap}} / \\pi$，其中 $A_{\\mathrm{overlap}}$ 是半径为 $1$ 和 $p$、中心相距为 $z$ 的两个圆的交集面积。这个关系源于均匀明亮圆盘的归一化通量定义，因为未被遮挡的恒星面积是 $\\pi$。\n\n任务：\n1. 基于欧几里得几何，通过划分为三种情况，推导出重叠面积 $A_{\\mathrm{overlap}}$ 的表达式，用 $z$ 和 $p$ 表示：\n   - 无重叠：$z \\ge 1 + p$。\n   - 完全重叠（一个圆包含在另一个圆内）：$z \\le |1 - p|$。\n   - 部分重叠：$|1 - p|  z  1 + p$。\n   你的推导必须从归一化通量作为面积分的定义开始，并在不引入未经检验的假设的情况下，为每种情况下的 $A_{\\mathrm{overlap}}$ 推导出解析形式。\n2. 设计计算 $F(z, p)$ 的算法，通过高效地为任意 $z$ 和 $p$ 计算 $A_{\\mathrm{overlap}}$，并确保在边界 $z = 1 + p$ 和 $z = |1 - p|$ 附近的数值稳定性。你的算法必须：\n   - 避免除以零。\n   - 将反三角函数的参数裁剪到其定义域（例如 $[-1, 1]$）。\n   - 将平方根下的小负数值钳制为 $0$。\n   - 在边界决策中使用容差阈值，以避免因浮点舍入引起的振荡。\n3. 在一个程序中实现该算法，该程序不接受输入，为下面的测试套件计算通量，并按要求格式打印结果。\n\n测试套件：\n为以下无量纲的 $(p, z)$ 对计算归一化通量 $F$：\n- 覆盖无重叠、部分重叠、完全重叠和边界邻近情况的案例：\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $2.0$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $1.1$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $1.099999999999$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $0.9$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $0.900000000001$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $0.899999999999$ $\\,)$\n  - $(p, z) = (\\,$ $1.0$ $\\,,$ $\\,$ $0.0$ $\\,)$\n  - $(p, z) = (\\,$ $1.0$ $\\,,$ $\\,$ $1.9999$ $\\,)$\n  - $(p, z) = (\\,$ $0.0$ $\\,,$ $\\,$ $0.5$ $\\,)$\n  - $(p, z) = (\\,$ $0.5$ $\\,,$ $\\,$ $1.5$ $\\,)$\n\n要求输出：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，[$result_1$,$result_2$,$\\dots$]）。\n- 每个结果必须是表示相应测试用例的归一化通量 $F$ 的浮点数，使用上述算法计算得出。\n\n约束条件：\n- 仅使用圆交几何；不要使用数值像素化或蒙特卡洛积分。\n- 确保实现在 $z = 1 + p$ 和 $z = |1 - p|$ 附近是高效且数值稳定的。",
            "solution": "该问题被评估为具有科学依据、定义明确且客观，满足有效问题陈述的所有标准。它提出了一个基于基本欧几里得几何的系外行星凌星建模的标准问题。\n\n对于半径为单位1（$R_\\star = 1$）的均匀明亮恒星，其归一化恒星通量 $F$ 由未被凌星行星遮挡的可见恒星盘的面积比例给出。恒星盘的总面积为 $A_\\star = \\pi R_\\star^2 = \\pi$。如果 $A_{\\mathrm{overlap}}$ 是被行星遮挡的恒星盘面积，则归一化通量为 $F = (A_\\star - A_{\\mathrm{overlap}}) / A_\\star = 1 - A_{\\mathrm{overlap}} / \\pi$。\n\n我们的任务是推导 $A_{\\mathrm{overlap}}$ 的解析表达式，即半径为 $r_1 = 1$ 的恒星和半径为 $r_2 = p$ 的行星这两个圆的交集面积。它们中心之间的距离是 $z$。\n\n设恒星中心位于笛卡尔坐标系的原点 $(0, 0)$。设行星中心位于 $(z, 0)$。两个圆的方程分别为 $x^2 + y^2 = 1^2$ 和 $(x-z)^2 + y^2 = p^2$。\n\n两个圆的交集面积可以计算为两个弓形面积之和，每个圆各一个，由它们的公共弦定义。\n\n首先，我们通过求解两个圆的交点来找到公共弦的 $x$ 坐标：\n$$y^2 = 1 - x^2$$\n$$(x-z)^2 + (1-x^2) = p^2 \\implies x^2 - 2xz + z^2 + 1 - x^2 = p^2$$\n$$1 - 2xz + z^2 = p^2 \\implies x = \\frac{1 + z^2 - p^2}{2z}$$\n这个 $x$ 值定义了两个圆的公共竖直弦的位置。该表达式仅在圆部分相交且 $z > 0$ 时具有物理意义。\n\n一个半径为 $r$ 的圆，被距其中心距离为 $d$ 的弦所切割出的弓形面积由 $A_{\\mathrm{seg}} = r^2 \\arccos(d/r) - d\\sqrt{r^2 - d^2}$ 给出。\n\n对于恒星（半径 $r_1=1$），到弦的距离是 $d_1 = x = \\frac{1 + z^2 - p^2}{2z}$。\n对于行星（半径 $r_2=p$），到弦的距离是 $d_2 = |z-x| = z - x = z - \\frac{1 + z^2 - p^2}{2z} = \\frac{2z^2 - 1 - z^2 + p^2}{2z} = \\frac{p^2 + z^2 - 1}{2z}$。\n\n总重叠面积是两个弓形面积之和：$A_{\\mathrm{overlap}} = A_{\\mathrm{seg},1} + A_{\\mathrm{seg},2}$。\n$$A_{\\mathrm{seg},1} = 1^2 \\arccos\\left(\\frac{d_1}{1}\\right) - d_1 \\sqrt{1^2 - d_1^2}$$\n$$A_{\\mathrm{seg},2} = p^2 \\arccos\\left(\\frac{d_2}{p}\\right) - d_2 \\sqrt{p^2 - d_2^2}$$\n\n平方根下的项可以被简化。弦的半长 $y = \\sqrt{1-d_1^2}$ 可以表示为：\n$$y = \\sqrt{1 - \\left(\\frac{1+z^2-p^2}{2z}\\right)^2} = \\frac{1}{2z}\\sqrt{4z^2 - (1+z^2-p^2)^2}$$\n平方根的参数是平方差：\n$$4z^2 - (1+z^2-p^2)^2 = (2z - (1+z^2-p^2))(2z + (1+z^2-p^2))$$\n$$= (2z - 1 - z^2 + p^2)(2z + 1 + z^2 - p^2)$$\n$$= (p^2 - (z-1)^2)((z+1)^2 - p^2)$$\n$$= (p-z+1)(p+z-1)(z-p+1)(z+p+1)$$\n当可以形成边长为 $1$、$p$ 和 $z$ 的非退化三角形时，该项保证为非负，这对应于部分重叠的情况。项 $\\sqrt{p^2-d_2^2}$ 简化为相同的弦半长 $y$。\n\n将 $d_1$ 和 $d_2$ 代入弓形面积公式：\n$A_{\\mathrm{overlap}} = \\arccos(d_1) - d_1 y + p^2\\arccos(d_2/p) - d_2 y = \\arccos(d_1) + p^2\\arccos(d_2/p) - (d_1+d_2)y$。\n因为 $d_1+d_2 = x + (z-x) = z$，我们有：\n$A_{\\mathrm{overlap}} = \\arccos(d_1) + p^2\\arccos(d_2/p) - z \\cdot y$。\n$A_{\\mathrm{overlap}} = \\arccos\\left(\\frac{1+z^2-p^2}{2z}\\right) + p^2 \\arccos\\left(\\frac{p^2+z^2-1}{2pz}\\right) - \\frac{1}{2}\\sqrt{(-z+p+1)(z+p-1)(z-p+1)(z+p+1)}$。\n\n这个公式对部分重叠的情况有效。我们现在根据 $p$ 和 $z$ 分析三种不同的几何情况。\n\n**1. 无重叠：$z \\ge 1 + p$**\n两个圆不相交或外切。中心之间的距离大于或等于半径之和。\n$$A_{\\mathrm{overlap}} = 0$$\n归一化通量为 $F = 1 - 0/\\pi = 1$。\n\n**2. 完全重叠（包含）：$z \\le |1 - p|$**\n一个圆完全包含在另一个圆内，或者它们内切。中心之间的距离小于或等于半径之差。重叠面积是较小圆的面积。\n- 如果 $p \\le 1$（行星小于或等于恒星），则较小的圆是行星。条件是 $z \\le 1-p$。\n  $$A_{\\mathrm{overlap}} = \\pi p^2$$\n  通量为 $F = 1 - (\\pi p^2)/\\pi = 1 - p^2$。\n- 如果 $p > 1$（行星大于恒星），则较小的圆是恒星。条件是 $z \\le p-1$。\n  $$A_{\\mathrm{overlap}} = \\pi (1)^2 = \\pi$$\n  通量为 $F = 1 - \\pi/\\pi = 0$。\n\n**3. 部分重叠：$|1 - p|  z  1 + p$**\n两个圆在两点相交。重叠面积由上面推导的公式给出：\n$$A_{\\mathrm{overlap}} = \\arccos\\left(\\frac{1+z^2-p^2}{2z}\\right) + p^2 \\arccos\\left(\\frac{p^2+z^2-1}{2pz}\\right) - \\frac{1}{2}\\sqrt{(-z+p+1)(z+p-1)(z-p+1)(z+p+1)}$$\n通量为 $F = 1 - A_{\\mathrm{overlap}}/\\pi$。\n\n**算法设计和数值稳定性**\n该算法直接实现这三种情况。需要仔细实现以确保在情况之间的边界（$z = 1+p$ 和 $z = |1-p|$）处的数值稳定性，在这些边界处，反三角函数的参数接近 $\\pm 1$，平方根的参数接近 $0$。\n\n- **情况逻辑**：算法必须首先检查边界条件以选择正确的公式：\n  1. 如果 $z \\ge 1 + p$，使用“无重叠”公式。\n  2. 如果 $z \\le |1 - p|$，使用“完全重叠”公式，根据 $p \\le 1$ 还是 $p > 1$ 进行分支。\n  3. 否则，使用“部分重叠”公式。\n\n- **避免除以零**：\n  - 部分重叠公式的分母中包含 $z$ 和 $p$。\n  - 如果 $z=0$，这将属于完全重叠情况（对于 $p \\ne 1$，$0 \\le |1-p|$），因此不使用部分重叠公式。\n  - 如果 $p=0$，行星半径为零，所以 $A_{\\mathrm{overlap}}=0$ 且 $F=1$。这可以在算法开始时作为特殊情况处理。\n\n- **边界处的数值精度**：\n  - 在边界附近，浮点数的不精确性可能导致 `arccos` 的参数略微超出 $[-1, 1]$ 的有效域。为防止 `NaN` 结果，必须将这些参数钳制在 $[-1, 1]$ 范围内。\n  - 类似地，平方根的参数在数学上保证在部分重叠区域内为非负，但由于边界附近的舍入误差，可能变成一个小的负数。必须将此参数钳制为非负值（例如 `max(0.0, arg)`）。\n\n完整的算法流程如下：\n输入参数 $p \\ge 0$ 和 $z \\ge 0$。\n1. 处理平凡情况：如果 $p=0$，返回 $F=1$。\n2. 比较 $z$ 与 $1+p$ 和 $|1-p|$ 来确定几何情况。\n3. 应用相应的 $A_{\\mathrm{overlap}}$ 公式。\n4. 对于部分重叠情况，在计算 `arccos` 和 `sqrt` 之前，应用上述的数值钳制保护措施。\n5. 计算最终的归一化通量 $F = 1 - A_{\\mathrm{overlap}}/\\pi$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the normalized stellar flux for a set of test cases\n    based on the geometric model of a planetary transit.\n    \"\"\"\n\n    test_cases = [\n        # (p, z) pairs\n        (0.1, 2.0),\n        (0.1, 1.1),\n        (0.1, 1.099999999999),\n        (0.1, 0.9),\n        (0.1, 0.900000000001),\n        (0.1, 0.899999999999),\n        (1.0, 0.0),\n        (1.0, 1.9999),\n        (0.0, 0.5),\n        (0.5, 1.5),\n    ]\n\n    results = []\n    for p, z in test_cases:\n        flux = compute_flux(p, z)\n        results.append(flux)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_flux(p, z):\n    \"\"\"\n    Computes the normalized stellar flux for a planetary transit.\n\n    The star is a uniformly bright disk of unit radius. The planet is a\n    uniformly opaque disk.\n\n    Args:\n        p (float): The planet-to-star radius ratio (Rp / R*).\n        z (float): The projected separation between centers in units of R*.\n\n    Returns:\n        float: The normalized stellar flux F.\n    \"\"\"\n    # Trivial case: zero-radius planet. Flux is always 1.\n    if p == 0.0:\n        return 1.0\n\n    # Ensure z is non-negative, as per definition.\n    z = abs(z)\n\n    # Case 1: No overlap. The circles are separate.\n    # z >= 1 + p\n    if z >= 1.0 + p:\n        return 1.0\n\n    # Case 2: Full overlap. One circle is contained within the other.\n    # z = |1 - p|\n    if z = abs(1.0 - p):\n        if p = 1.0:\n            # The planet is fully within the star.\n            return 1.0 - p**2\n        else:\n            # The star is fully occulted by the larger planet.\n            return 0.0\n\n    # Case 3: Partial overlap.\n    # |1 - p|  z  1 + p\n    # The division-by-zero for z=0 is avoided by the full overlap case.\n    # The division-by-zero for p=0 is avoided by the initial check.\n    \n    # Arguments for the arccos functions\n    c1_arg = (1.0 + z**2 - p**2) / (2.0 * z)\n    c2_arg = (p**2 + z**2 - 1.0) / (2.0 * p * z)\n\n    # Clamp arguments to the valid domain of arccos: [-1, 1] for stability.\n    c1_arg = np.clip(c1_arg, -1.0, 1.0)\n    c2_arg = np.clip(c2_arg, -1.0, 1.0)\n\n    # Angles of the circular sectors\n    k1 = np.arccos(c1_arg)\n    k0 = np.arccos(c2_arg)\n\n    # The argument of the square root is proportional to the area of the\n    # triangle with sides 1, p, and z. This form is numerically stable.\n    sqrt_arg = (-z + p + 1.0) * (z + p - 1.0) * (z - p + 1.0) * (z + p + 1.0)\n    \n    # Clamp argument to be non-negative for sqrt.\n    sqrt_arg = np.maximum(0.0, sqrt_arg)\n    \n    # Overlap area formula for partial transit\n    A_overlap = k1 + p**2 * k0 - 0.5 * np.sqrt(sqrt_arg)\n    \n    # Normalized flux\n    F = 1.0 - A_overlap / np.pi\n    \n    return F\n\nsolve()\n```"
        },
        {
            "introduction": "在建立了基本几何模型之后，下一步是增加模型的物理真实性。真实的恒星并非亮度均匀，其边缘比中心暗，这种效应称为“临边昏暗”。本练习将超越最简单的“小行星近似”(SPA)，通过推导一阶修正项来考虑恒星表面在行星盘面范围内的非均匀亮度。这个推导将加深您对恒星物理如何影响光变曲线形状的理解，并教会您如何系统地改进理论模型。",
            "id": "4186783",
            "problem": "考虑一颗半径为 $R_{\\star}$ 的恒星，其具有径向对称的比辐射强度分布 $I(\\mu)$，遵循线性临边昏暗定律 $I(\\mu) = I_{0}\\left(1 - u\\left(1 - \\mu\\right)\\right)$，其中 $I_{0}$ 是恒星中心的比辐射强度，$u$ 是线性临边昏暗系数，$\\mu = \\sqrt{1 - \\rho^{2}}$，而 $\\rho = r/R_{\\star}$ 是以 $R_{\\star}$ 为单位的投影径向坐标。一颗半径为 $R_{p}$（$k \\equiv R_{p}/R_{\\star} \\ll 1$）的行星凌越该恒星，在某一给定时刻，行星盘的中心投影到恒星盘上距离中心为 $\\rho$ 的一点。假设行星盘完全位于恒星盘内部（即 $\\rho \\leq 1 - k$），因此被遮挡的区域是一个完整的圆盘。\n\n从流量下降的定义（即恒星强度在被行星遮挡区域上的重叠积分）出发，并利用强度函数 $I$ 在天空平面二维（2D）坐标下围绕行星中心的泰勒展开，推导超出小行星近似（SPA）的第一个非零修正项，该修正项考虑了有限行星半径 $R_{p}$ 的曲率效应。对于上述指定的线性临边昏暗定律，以闭合形式将归一化流量下降 $\\delta f(\\rho)$（定义为被遮挡流量除以未被遮挡的总恒星流量）表示到 $k^{4}$ 阶。\n\n你的最终答案必须是 $\\delta f(\\rho)$ 的一个解析表达式，用 $k$、$u$ 和 $\\mu$ 表示，并且在包括 $k^{4}$ 阶项的情况下有效。不需要进行数值计算或四舍五入，结果必须是无量纲的。",
            "solution": "该问题是有效的，因为它在科学上基于辐射转移和天体力学的原理，问题设定良好，目标明确，约束充分，并且用客观、正式的语言表达。它提出了一个在系外行星凌星建模中的标准的、非平凡的问题。\n\n归一化流量下降 $\\delta f(\\rho)$ 定义为被行星遮挡的流量 $\\Delta F$ 与来自恒星的未被遮挡的总流量 $F_{\\star}$ 之比。\n$$\n\\delta f(\\rho) = \\frac{\\Delta F}{F_{\\star}}\n$$\n我们将首先计算总恒星流量 $F_{\\star}$，然后计算被遮挡的流量 $\\Delta F$，精度要求达到指定的阶数。\n\n总流量 $F_{\\star}$ 是通过将比辐射强度 $I(\\rho)$ 在恒星的投影盘上积分得到的。使用投影径向坐标 $\\rho = r/R_{\\star}$，面元为 $dS = r dr d\\phi = R_{\\star}^2 \\rho d\\rho d\\phi$。\n$$\nF_{\\star} = \\int_{0}^{2\\pi} \\int_{0}^{R_{\\star}} I(r/R_{\\star}) r dr d\\phi = 2\\pi R_{\\star}^2 \\int_{0}^{1} I(\\rho) \\rho d\\rho\n$$\n恒星强度由线性临边昏暗定律给出：$I(\\rho) = I_{0}\\left(1 - u\\left(1 - \\mu\\right)\\right)$，其中 $\\mu = \\sqrt{1 - \\rho^{2}}$。\n将此代入 $F_{\\star}$ 的积分中：\n$$\nF_{\\star} = 2\\pi R_{\\star}^2 I_{0} \\int_{0}^{1} \\left[1 - u\\left(1 - \\sqrt{1 - \\rho^{2}}\\right)\\right] \\rho d\\rho\n$$\n$$\nF_{\\star} = 2\\pi R_{\\star}^2 I_{0} \\left[ (1-u) \\int_{0}^{1} \\rho d\\rho + u \\int_{0}^{1} \\rho\\sqrt{1-\\rho^2} d\\rho \\right]\n$$\n积分计算结果为：\n$$\n\\int_{0}^{1} \\rho d\\rho = \\left[\\frac{\\rho^2}{2}\\right]_{0}^{1} = \\frac{1}{2}\n$$\n$$\n\\int_{0}^{1} \\rho\\sqrt{1-\\rho^2} d\\rho = \\left[-\\frac{1}{3}(1-\\rho^2)^{3/2}\\right]_{0}^{1} = \\frac{1}{3}\n$$\n因此，总恒星流量为：\n$$\nF_{\\star} = 2\\pi R_{\\star}^2 I_{0} \\left( \\frac{1-u}{2} + \\frac{u}{3} \\right) = 2\\pi R_{\\star}^2 I_{0} \\left( \\frac{3-3u+2u}{6} \\right) = \\pi R_{\\star}^2 I_{0} \\left(1 - \\frac{u}{3}\\right)\n$$\n\n接下来，我们计算被遮挡的流量 $\\Delta F$。这是恒星强度在行星盘面积上的积分。行星的半径为 $R_p$，其中心距离恒星中心的投影距离为 $r_p = \\rho R_{\\star}$。我们可以在行星盘中心建立一个局部笛卡尔坐标系 $(\\xi, \\eta)$。行星盘内一点相对于恒星中心的位置是 $\\mathbf{r}' = \\mathbf{r}_p + \\mathbf{s}$，其中 $\\mathbf{s} = (\\xi, \\eta)$ 且 $\\xi^2 + \\eta^2 \\leq R_p^2$。\n$$\n\\Delta F = \\iint_{\\xi^2+\\eta^2 \\leq R_p^2} I(\\mathbf{r}_p + \\mathbf{s}) d\\xi d\\eta\n$$\n对于小行星（$R_p \\ll R_{\\star}$），我们可以在行星中心 $\\mathbf{r}_p$ 附近对强度函数 $I$ 进行泰勒展开：\n$$\nI(\\mathbf{r}_p + \\mathbf{s}) \\approx I(\\mathbf{r}_p) + (\\mathbf{s} \\cdot \\nabla)I(\\mathbf{r}_p) + \\frac{1}{2!}(\\mathbf{s} \\cdot \\nabla)^2 I(\\mathbf{r}_p) + O(|\\mathbf{s}|^3)\n$$\n被遮挡的流量是此展开式在行星盘上的积分，行星盘的面积为 $A_p = \\pi R_p^2$。由于积分区域的圆形对称性，所有包含 $\\xi$ 或 $\\eta$ 奇次幂的项积分后都为零。\n$$\n\\Delta F = \\iint_{A_p} I(\\mathbf{r}_p) dS + \\frac{1}{2} \\iint_{A_p} \\left(\\xi^2 \\frac{\\partial^2 I}{\\partial x^2} + \\eta^2 \\frac{\\partial^2 I}{\\partial y^2} + 2\\xi\\eta \\frac{\\partial^2 I}{\\partial x\\partial y}\\right)_{\\mathbf{r}_p} d\\xi d\\eta + O(R_p^6)\n$$\n在圆盘上所需的积分为：\n$$\n\\iint_{A_p} d\\xi d\\eta = \\pi R_p^2, \\quad \\iint_{A_p} \\xi^2 d\\xi d\\eta = \\iint_{A_p} \\eta^2 d\\xi d\\eta = \\frac{\\pi R_p^4}{4}, \\quad \\iint_{A_p} \\xi\\eta d\\xi d\\eta = 0\n$$\n将这些代入 $\\Delta F$ 的表达式中：\n$$\n\\Delta F = I(\\mathbf{r}_p)(\\pi R_p^2) + \\frac{1}{2} \\left( \\frac{\\partial^2 I}{\\partial x^2}\\bigg|_{\\mathbf{r}_p} \\frac{\\pi R_p^4}{4} + \\frac{\\partial^2 I}{\\partial y^2}\\bigg|_{\\mathbf{r}_p} \\frac{\\pi R_p^4}{4} \\right) + O(R_p^6)\n$$\n这可以简化为：\n$$\n\\Delta F = \\pi R_p^2 I(\\mathbf{r}_p) + \\frac{\\pi R_p^4}{8} \\nabla^2 I(\\mathbf{r}_p) + O(R_p^6)\n$$\n其中 $\\nabla^2 I$ 是在行星中心处计算的强度函数的拉普拉斯算子。第一项对应于小行星近似（SPA），第二项是第一个非零修正项。\n\n我们现在需要计算 $I(\\rho)$ 和 $\\nabla^2 I(\\rho)$。强度为 $I(\\rho) = I_0(1-u+u\\mu)$，其中 $\\mu=\\sqrt{1-\\rho^2}$。\n对于一个径向对称函数，在二维极坐标 $(r, \\phi)$ 中的拉普拉斯算子是 $\\nabla^2 I = \\frac{1}{r}\\frac{d}{dr}\\left(r\\frac{dI}{dr}\\right)$。使用 $\\rho=r/R_{\\star}$，我们有 $d/dr = (1/R_{\\star})d/d\\rho$，所以 $\\nabla^2 I = \\frac{1}{R_{\\star}^2 \\rho}\\frac{d}{d\\rho}\\left(\\rho\\frac{dI}{d\\rho}\\right)$。\n\n让我们计算 $I$ 对 $\\rho$ 的导数：\n$$\n\\frac{dI}{d\\rho} = \\frac{d}{d\\rho} \\left[ I_0(1-u+u\\sqrt{1-\\rho^2}) \\right] = I_0 u \\frac{-2\\rho}{2\\sqrt{1-\\rho^2}} = -I_0 u \\frac{\\rho}{\\sqrt{1-\\rho^2}} = -I_0 u \\frac{\\rho}{\\mu}\n$$\n然后，$\\rho \\frac{dI}{d\\rho} = -I_0 u \\frac{\\rho^2}{\\mu}$。再次求导：\n$$\n\\frac{d}{d\\rho}\\left(\\rho\\frac{dI}{d\\rho}\\right) = -I_0 u \\frac{d}{d\\rho}\\left(\\frac{\\rho^2}{\\sqrt{1-\\rho^2}}\\right) = -I_0 u \\left( \\frac{2\\rho\\sqrt{1-\\rho^2} - \\rho^2 \\frac{-\\rho}{\\sqrt{1-\\rho^2}}}{1-\\rho^2} \\right)\n$$\n$$\n= -I_0 u \\left( \\frac{2\\rho(1-\\rho^2) + \\rho^3}{(1-\\rho^2)^{3/2}} \\right) = -I_0 u \\frac{2\\rho - \\rho^3}{(1-\\rho^2)^{3/2}} = -I_0 u \\frac{\\rho(2-\\rho^2)}{\\mu^3}\n$$\n因此，拉普拉斯算子为：\n$$\n\\nabla^2 I(\\rho) = \\frac{1}{R_{\\star}^2 \\rho} \\left( -I_0 u \\frac{\\rho(2-\\rho^2)}{\\mu^3} \\right) = -\\frac{I_0 u}{R_{\\star}^2} \\frac{2-\\rho^2}{\\mu^3}\n$$\n现在将 $I(\\rho)$ 和 $\\nabla^2 I(\\rho)$ 代入 $\\Delta F$ 的表达式中，并使用 $R_p = k R_{\\star}$：\n$$\n\\Delta F = \\pi (kR_{\\star})^2 I_0(1-u+u\\mu) + \\frac{\\pi (kR_{\\star})^4}{8} \\left( -\\frac{I_0 u}{R_{\\star}^2} \\frac{2-\\rho^2}{\\mu^3} \\right)\n$$\n$$\n\\Delta F = \\pi R_{\\star}^2 I_0 \\left[ k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{2-\\rho^2}{\\mu^3} \\right]\n$$\n最后，我们计算归一化流量下降 $\\delta f(\\rho) = \\Delta F / F_{\\star}$：\n$$\n\\delta f(\\rho) = \\frac{\\pi R_{\\star}^2 I_0 \\left[ k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{2-\\rho^2}{\\mu^3} \\right]}{\\pi R_{\\star}^2 I_{0} \\left(1 - \\frac{u}{3}\\right)}\n$$\n$$\n\\delta f(\\rho) = \\frac{k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{2-\\rho^2}{\\mu^3}}{1 - \\frac{u}{3}}\n$$\n为了仅用 $k$、$u$ 和 $\\mu$ 来表示，我们代入 $\\rho^2 = 1-\\mu^2$：\n$$\n\\delta f(\\rho) = \\frac{k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{2-(1-\\mu^2)}{\\mu^3}}{1 - \\frac{u}{3}}\n$$\n$$\n\\delta f(\\rho) = \\frac{k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{1+\\mu^2}{\\mu^3}}{1 - \\frac{u}{3}}\n$$\n这是归一化流量下降到 $k^4$ 阶的完整表达式。",
            "answer": "$$\n\\boxed{\\frac{k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{1+\\mu^2}{\\mu^3}}{1 - \\frac{u}{3}}}\n$$"
        },
        {
            "introduction": "一个完美的瞬时流量理论模型只是故事的一半。真实的观测是由仪器在有限的时间段内收集光子完成的，这段时间被称为曝光时间或观测步长。本练习旨在通过分析这种时间平均过程如何影响凌星关键事件（如开始和结束）的测量时间，来弥合理论与观测之间的差距。理解这种系统性效应对于准确解读真实的凌星数据至关重要。",
            "id": "4186706",
            "problem": "考虑一颗凌日系外行星，它由一台进行有限时长积分的光度测量仪器观测。设凌日期间真实的瞬时恒星通量是一个关于时间的可微函数，记为 $F_{\\mathrm{true}}(t)$。通过条件 $F_{\\mathrm{true}}(t_{c}) = F_{c}$ 隐式地定义一个特定的接触时间 $t_{c}$（例如，第一次接触），其中 $F_{c}$ 是从凌日几何中与该接触点关联的选定参考通量水平（例如，根据包含临边昏暗的凌日模型所定义的、当行星盘面刚好触及恒星边缘时的通量水平）。\n\n仪器对每次曝光报告一个等于曝光开始时间的单一时间戳 $t_{s}$，以及一个测量通量，该通量是时长为 $\\Delta t$ 的曝光窗口内的平均值。因此，测量的通量为\n$$\nF_{\\mathrm{obs}}(t_{s}) = \\frac{1}{\\Delta t} \\int_{t_{s}}^{t_{s} + \\Delta t} F_{\\mathrm{true}}(\\tau)\\, d\\tau.\n$$\n测量的接触时间 $t_{\\mathrm{meas}}$ 在操作上定义为所报告的 $F_{\\mathrm{obs}}(t_{s})$ 首次等于参考水平 $F_{c}$ 时的时间戳 $t_{s}$。\n\n从上述定义和接触点附近的凌日曲线几何出发，假设在 $t_{c}$ 附近，函数 $F_{\\mathrm{true}}(t)$ 可以通过线性展开在主导阶上近似为\n$$\nF_{\\mathrm{true}}(t) \\approx F_{c} + S\\,(t - t_{c}),\n$$\n其中 $S = \\left.\\frac{d F_{\\mathrm{true}}}{dt}\\right|_{t = t_{c}}$ 是有限且非零的，高阶曲率项被忽略。仅使用此局部近似和有限曝光平均定义，推导出一阶修正 $\\delta t = t_{\\mathrm{meas}} - t_{c}$，用时间间隔 $\\Delta t$ 表示。\n\n将您的最终答案表示为单个闭合形式的解析表达式，单位为秒。无需进行数值代入，也无需四舍五入。",
            "solution": "问题要求在给定有限曝光时长 $\\Delta t$ 的影响下，计算测量接触时间与真实接触时间之间的一阶修正 $\\delta t = t_{\\mathrm{meas}} - t_{c}$。我们已知观测通量、真实接触时间、测量接触时间的定义，以及接触点附近真实通量的线性近似。\n\n观测通量 $F_{\\mathrm{obs}}(t_{s})$ 定义为真实通量 $F_{\\mathrm{true}}(t)$ 在从时间 $t_{s}$ 开始、时长为 $\\Delta t$ 的曝光区间上的时间平均值：\n$$F_{\\mathrm{obs}}(t_{s}) = \\frac{1}{\\Delta t} \\int_{t_{s}}^{t_{s} + \\Delta t} F_{\\mathrm{true}}(\\tau)\\, d\\tau.$$\n在真实接触时间 $t_{c}$ 附近，真实通量近似为一个线性函数：\n$$F_{\\mathrm{true}}(t) \\approx F_{c} + S\\,(t - t_{c}),$$\n其中 $F_{c} = F_{\\mathrm{true}}(t_{c})$ 是接触时间的参考通量，而 $S = \\left.\\frac{d F_{\\mathrm{true}}}{dt}\\right|_{t = t_{c}}$ 是光变曲线在该瞬间的斜率，假设其为有限且非零。\n\n为了求出观测通量，我们将 $F_{\\mathrm{true}}(t)$ 的线性近似代入 $F_{\\mathrm{obs}}(t_{s})$ 的积分定义中：\n$$F_{\\mathrm{obs}}(t_{s}) \\approx \\frac{1}{\\Delta t} \\int_{t_{s}}^{t_{s} + \\Delta t} \\left[ F_{c} + S\\,(\\tau - t_{c}) \\right] d\\tau.$$\n我们可以通过分离各项来计算这个积分：\n$$F_{\\mathrm{obs}}(t_{s}) = \\frac{1}{\\Delta t} \\left( \\int_{t_{s}}^{t_{s} + \\Delta t} F_{c}\\,d\\tau + \\int_{t_{s}}^{t_{s} + \\Delta t} S\\,(\\tau - t_{c})\\,d\\tau \\right).$$\n积分的第一部分是：\n$$\\int_{t_{s}}^{t_{s} + \\Delta t} F_{c}\\,d\\tau = F_{c} [\\tau]_{t_{s}}^{t_{s} + \\Delta t} = F_{c} ((t_{s} + \\Delta t) - t_{s}) = F_{c} \\Delta t.$$\n积分的第二部分是：\n$$S \\int_{t_{s}}^{t_{s} + \\Delta t} (\\tau - t_{c})\\,d\\tau = S \\left[ \\frac{\\tau^2}{2} - t_{c}\\tau \\right]_{t_{s}}^{t_{s} + \\Delta t} = S \\left( \\left(\\frac{(t_{s} + \\Delta t)^2}{2} - t_{c}(t_{s} + \\Delta t)\\right) - \\left(\\frac{t_{s}^2}{2} - t_{c}t_{s}\\right) \\right).$$\n展开并简化各项：\n$$S \\left( \\frac{t_{s}^2 + 2t_{s}\\Delta t + (\\Delta t)^2 - t_{s}^2}{2} - t_{c}(t_{s} + \\Delta t - t_{s}) \\right) = S \\left( \\frac{2t_{s}\\Delta t + (\\Delta t)^2}{2} - t_{c}\\Delta t \\right)$$\n$$= S \\left( t_{s}\\Delta t + \\frac{(\\Delta t)^2}{2} - t_{c}\\Delta t \\right) = S \\Delta t \\left( (t_{s} - t_{c}) + \\frac{\\Delta t}{2} \\right).$$\n将这些结果代回 $F_{\\mathrm{obs}}(t_{s})$ 的表达式中：\n$$F_{\\mathrm{obs}}(t_{s}) = \\frac{1}{\\Delta t} \\left( F_{c}\\Delta t + S \\Delta t \\left( (t_{s} - t_{c}) + \\frac{\\Delta t}{2} \\right) \\right) = F_{c} + S \\left( (t_{s} - t_{c}) + \\frac{\\Delta t}{2} \\right).$$\n这个方程将起始时间为 $t_{s}$ 的测量通量与凌日模型的参数联系起来。对此结果的一个有效检验是，认识到一个线性函数在一个区间上的时间平均值等于该函数在区间中点处的值。我们的结果等价于 $F_{\\mathrm{obs}}(t_s) = F_{\\mathrm{true}}(t_s + \\frac{\\Delta t}{2})$，这验证了积分的正确性。\n\n测量的接触时间 $t_{\\mathrm{meas}}$ 定义为观测通量 $F_{\\mathrm{obs}}(t_s)$ 等于参考通量 $F_{c}$ 时的特定曝光开始时间 $t_{s}$。我们通过设 $t_s = t_{\\mathrm{meas}}$ 和 $F_{\\mathrm{obs}}(t_{\\mathrm{meas}}) = F_{c}$ 来求 $t_{\\mathrm{meas}}$：\n$$F_{c} = F_{c} + S \\left( (t_{\\mathrm{meas}} - t_{c}) + \\frac{\\Delta t}{2} \\right).$$\n从两边减去 $F_c$ 得：\n$$0 = S \\left( (t_{\\mathrm{meas}} - t_{c}) + \\frac{\\Delta t}{2} \\right).$$\n由于斜率 $S$ 被指定为非零，我们可以将两边都除以 $S$：\n$$0 = (t_{\\mathrm{meas}} - t_{c}) + \\frac{\\Delta t}{2}.$$\n问题要求的是修正量 $\\delta t = t_{\\mathrm{meas}} - t_{c}$。重新整理方程以解出此量，我们得到：\n$$\\delta t = t_{\\mathrm{meas}} - t_{c} = -\\frac{\\Delta t}{2}.$$\n此结果表明，在一阶近似下，测量的接触时间（时间戳记录为曝光开始时刻）比真实接触时间早半个曝光时长。这种时间偏差是对曝光区间内通量进行平均的直接后果，并且只要线性近似成立，它就与光变曲线的斜率无关。",
            "answer": "$$\\boxed{-\\frac{\\Delta t}{2}}$$"
        }
    ]
}