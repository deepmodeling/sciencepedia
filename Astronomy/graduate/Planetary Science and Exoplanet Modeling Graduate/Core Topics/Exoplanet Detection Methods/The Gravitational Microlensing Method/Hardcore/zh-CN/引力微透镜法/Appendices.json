{
    "hands_on_practices": [
        {
            "introduction": "爱因斯坦半径 $\\theta_E$ 是引力微透镜事件的基本角尺度，它决定了透镜效应的范围。本练习将指导你推导并计算一个银河系中典型微透镜系统的爱因斯坦半径。理解这个尺度的大小至关重要，因为它解释了为什么天文学家通常观测到的是光度放大而非分离的透镜图像。",
            "id": "4182103",
            "problem": "银河系中的一个点质量引力微透镜根据广义相对论（GR）使光线偏转。考虑一个距离为 $D_S = 8\\,\\mathrm{kpc}$ 的源恒星，其后方有一个质量为 $M = 0.3\\,M_{\\odot}$、位于 $D_L = 6\\,\\mathrm{kpc}$ 处的透镜。在薄透镜、小角度近似下进行计算，并假设在适用于银河尺度的平坦空间中存在一个静态、弱场点质量透镜。使用以下基本要素作为出发点：(i) 点质量在冲击参数 $b$ 处根据 GR 产生的光线偏折角 $\\hat{\\alpha} = 4GM/(c^2 b)$，以及 (ii) 小角度透镜几何，其中约化偏折角为 $\\alpha = (D_{LS}/D_S)\\,\\hat{\\alpha}$，且 $D_{LS} = D_S - D_L$，所有角度通过 $b \\approx D_L \\,\\theta$ 与物理距离相关联。\n\n1. 基于这些基础，推导在源-透镜-观测者完美对齐情况下的角 Einstein 半径 $\\theta_E$ 的表达式。然后，对于 $M=0.3\\,M_{\\odot}$，$D_L=6\\,\\mathrm{kpc}$ 和 $D_S=8\\,\\mathrm{kpc}$，数值计算 $\\theta_E$。\n\n2. 将 $\\theta_E$ 的最终数值以毫角秒（milliarcsecond (mas)）为单位表示。将您的答案四舍五入到三位有效数字。\n\n3. 用文字简要评估，对于典型的地面视宁度限制角分辨率（量级为 $0.7$–$1.0\\,\\mathrm{arcsec}$ 半峰全宽（FWHM）），相应的 Einstein 环或单个微像是否能被直接分辨。您的评估不属于最终数值答案的一部分。",
            "solution": "问题陈述已经过验证，被认为是科学上合理、提法恰当且客观的。它提出了一个基于广义相对论在弱场极限下的既定原理的引力微透镜标准问题。所有必要的数据和基础方程均已提供。因此，我们可以着手求解。\n\n该问题分为三个部分：首先，推导角 Einstein 半径 $\\theta_E$ 的表达式；其次，根据给定参数计算其数值；第三，评估其可观测性。\n\n**第1部分：Einstein 半径 $\\theta_E$ 的推导和数值计算**\n\n透镜方程将源的真实角位置 $\\beta$ 与像的表观角位置 $\\theta$ 联系起来。对于点质量透镜，几何形状是轴对称的，标量透镜方程由下式给出：\n$$ \\beta = \\theta - \\alpha(\\theta) $$\n其中 $\\alpha(\\theta)$ 是约化偏折角，它依赖于像的位置 $\\theta$。\n\n源、透镜和观测者的完美对齐对应于真实源位置位于光轴上的情况，即 $\\beta=0$。在这种特定配置中，透镜成像在透镜位置周围形成一个完美的环，称为 Einstein 环。根据定义，这个环的角半径就是 Einstein 半径 $\\theta_E$。\n\n在透镜方程中令 $\\beta = 0$ 和 $\\theta = \\theta_E$，得到 Einstein 半径的条件：\n$$ \\theta_E = \\alpha(\\theta_E) $$\n问题提供了表达 $\\alpha(\\theta_E)$ 所需的关系式。约化偏折角 $\\alpha$ 与真实的 GR 偏折角 $\\hat{\\alpha}$ 通过以下关系式相联系：\n$$ \\alpha = \\frac{D_{LS}}{D_S} \\hat{\\alpha} $$\n其中 $D_S$ 是观测者-源距离，$D_L$ 是观测者-透镜距离，$D_{LS} = D_S - D_L$ 是透镜-源距离。\n\n点质量 $M$ 在冲击参数 $b$ 处的真实偏折角 $\\hat{\\alpha}$ 由下式给出：\n$$ \\hat{\\alpha} = \\frac{4GM}{c^2 b} $$\n其中 $G$ 是引力常数，$c$ 是光速。\n\n最后，在小角度近似下，对应于角度 $\\theta$ 处的像的冲击参数由 $b \\approx D_L \\theta$ 给出。对于 Einstein 环，冲击参数为 $b_E = D_L \\theta_E$。\n\n现在我们可以将这些表达式代入 $\\theta_E$ 的条件中。首先，用 $\\theta$ 表示 $\\alpha$：\n$$ \\hat{\\alpha}(\\theta) = \\frac{4GM}{c^2 (D_L \\theta)} $$\n$$ \\alpha(\\theta) = \\frac{D_{LS}}{D_S} \\left( \\frac{4GM}{c^2 D_L \\theta} \\right) = \\frac{4GM}{c^2} \\frac{D_{LS}}{D_L D_S} \\frac{1}{\\theta} $$\n现在，应用条件 $\\theta_E = \\alpha(\\theta_E)$：\n$$ \\theta_E = \\frac{4GM}{c^2} \\frac{D_{LS}}{D_L D_S} \\frac{1}{\\theta_E} $$\n解出 $\\theta_E$ 得到：\n$$ \\theta_E^2 = \\frac{4GM}{c^2} \\frac{D_{LS}}{D_L D_S} $$\n取平方根得到角 Einstein 半径的期望表达式：\n$$ \\theta_E = \\sqrt{\\frac{4GM}{c^2} \\frac{D_{LS}}{D_L D_S}} $$\n这就是推导出的表达式。我们可以代入 $D_{LS} = D_S - D_L$ 来获得等价形式：\n$$ \\theta_E = \\sqrt{\\frac{4GM}{c^2} \\frac{D_S - D_L}{D_L D_S}} $$\n\n接下来，我们对该表达式进行数值计算。给定的参数是：\n- 透镜质量：$M = 0.3\\,M_{\\odot}$\n- 透镜距离：$D_L = 6\\,\\mathrm{kpc}$\n- 源距离：$D_S = 8\\,\\mathrm{kpc}$\n\n这意味着透镜-源距离为 $D_{LS} = D_S - D_L = 2\\,\\mathrm{kpc}$。我们使用以下国际单位制（SI）中的标准物理常数：\n- 引力常数：$G \\approx 6.674 \\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}$\n- 光速：$c \\approx 2.998 \\times 10^8\\,\\mathrm{m\\,s^{-1}}$\n- 太阳质量：$M_{\\odot} \\approx 1.989 \\times 10^{30}\\,\\mathrm{kg}$\n- 千秒差距：$1\\,\\mathrm{kpc} \\approx 3.086 \\times 10^{19}\\,\\mathrm{m}$\n\n首先，我们将给定数量转换为国际单位制（SI）单位：\n- $M = 0.3 \\times (1.989 \\times 10^{30}\\,\\mathrm{kg}) = 5.967 \\times 10^{29}\\,\\mathrm{kg}$\n- $D_L = 6 \\times (3.086 \\times 10^{19}\\,\\mathrm{m}) = 1.8516 \\times 10^{20}\\,\\mathrm{m}$\n- $D_S = 8 \\times (3.086 \\times 10^{19}\\,\\mathrm{m}) = 2.4688 \\times 10^{20}\\,\\mathrm{m}$\n- $D_{LS} = 2 \\times (3.086 \\times 10^{19}\\,\\mathrm{m}) = 6.172 \\times 10^{19}\\,\\mathrm{m}$\n\n现在，我们计算 $\\theta_E^2$ 表达式中的两项：\n第一项是与透镜质量相关的特征长度尺度：\n$$ \\frac{4GM}{c^2} = \\frac{4 \\times (6.674 \\times 10^{-11}) \\times (5.967 \\times 10^{29})}{(2.998 \\times 10^8)^2} \\approx 1.772 \\times 10^3\\,\\mathrm{m} $$\n第二项是具有反长度单位的几何因子：\n$$ \\frac{D_{LS}}{D_L D_S} = \\frac{6.172 \\times 10^{19}}{(1.8516 \\times 10^{20}) \\times (2.4688 \\times 10^{20})} \\approx 1.350 \\times 10^{-22}\\,\\mathrm{m^{-1}} $$\n请注意，这个几何项也可以计算为 $\\frac{2\\,\\mathrm{kpc}}{6\\,\\mathrm{kpc} \\times 8\\,\\mathrm{kpc}} = \\frac{1}{24\\,\\mathrm{kpc}}$。将其转换为反米单位：$\\frac{1}{24 \\times 3.086 \\times 10^{19}\\,\\mathrm{m}} \\approx 1.350 \\times 10^{-21}\\,\\mathrm{m^{-1}}$。上面的计算块中有一个计算错误，我们来重新验证。使用kpc单位的计算更直接，且不易产生中间舍入误差。该项是 $\\frac{D_S - D_L}{D_L D_S} = \\frac{1}{D_L} - \\frac{1}{D_S}$。让我们重新计算距离的乘积：$D_L D_S = (1.8516 \\times 10^{20}) \\times (2.4688 \\times 10^{20}) = 4.5719 \\times 10^{41}\\,\\mathrm{m^2}$。比值为 $\\frac{6.172 \\times 10^{19}}{4.5719 \\times 10^{41}} = 1.350 \\times 10^{-22}\\,\\mathrm{m^{-1}}$。这证实了第一次的计算。我的检查一定有误。啊，错误在于认为 $(D_{LS})/(D_L D_S)$ 等于 $(2\\,\\mathrm{kpc})/(48\\,\\mathrm{kpc}^2)$，即 $(1/24)\\,\\mathrm{kpc}^{-1}$。让我们重新以米为单位计算 $1/24\\,\\mathrm{kpc}^{-1}$：$1/(24 \\times 3.086 \\times 10^{19}) = 1/(7.4064 \\times 10^{20}) = 1.350 \\times 10^{-21}\\,\\mathrm{m^{-1}}$。这个差异源于一个常见的符号混淆。该项是 $\\frac{D_{LS}}{D_L D_S}$，而不是距离以kpc为单位的 $\\frac{D_{LS}}{D_L D_S}$。我们有 $\\frac{2 \\text{ kpc}}{48 \\text{ kpc}^2} = \\frac{1}{24} \\text{kpc}^{-1}$。这才是正确的值。计算错误一定出在我最初的国际单位制距离乘积中。让我们使用更清晰的公式重新计算 $\\theta_E^2$：\n$$ \\theta_E^2 = \\left(\\frac{4GM}{c^2}\\right) \\left(\\frac{1}{24\\,\\mathrm{kpc}}\\right) = (1.772 \\times 10^3\\,\\mathrm{m}) \\times (1.350 \\times 10^{-21}\\,\\mathrm{m^{-1}}) = 2.392 \\times 10^{-18} $$\n该值是无量纲的，正如以弧度为单位的角度平方所要求的那样。\n取平方根，得到以弧度为单位的 $\\theta_E$：\n$$ \\theta_E = \\sqrt{2.392 \\times 10^{-18}} \\approx 1.547 \\times 10^{-9}\\,\\mathrm{radians} $$\n\n**第2部分：转换为毫角秒**\n\n最后一步是将这个角度从弧度转换为毫角秒（mas）并四舍五入到三位有效数字。转换因子如下：\n$1\\,\\mathrm{radian} = \\frac{180}{\\pi}\\,\\mathrm{degrees}$\n$1\\,\\mathrm{degree} = 3600\\,\\mathrm{arcseconds}$\n$1\\,\\mathrm{arcsecond} = 1000\\,\\mathrm{mas}$\n因此，$1\\,\\mathrm{radian} \\approx 206264.8\\,\\mathrm{arcseconds} = 2.062648 \\times 10^8\\,\\mathrm{mas}$。\n\n$$ \\theta_E (\\mathrm{mas}) = (1.547 \\times 10^{-9}\\,\\mathrm{rad}) \\times (2.062648 \\times 10^8\\,\\mathrm{mas/rad}) \\approx 0.31915\\,\\mathrm{mas} $$\n四舍五入到三位有效数字，我们得到：\n$$ \\theta_E \\approx 0.319\\,\\mathrm{mas} $$\n\n**第3部分：可分辨性评估**\n\n此微透镜事件的特征角尺度是 Einstein 环的直径，$2\\theta_E \\approx 2 \\times 0.319\\,\\mathrm{mas} = 0.638\\,\\mathrm{mas}$。问题陈述指出，典型的地面视宁度限制角分辨率约为 $0.7$–$1.0\\,\\mathrm{arcsec}$。将其转换为毫角秒，得到视宁盘的半峰全宽（FWHM）为 $700$–$1000\\,\\mathrm{mas}$。\n\n透镜成像的角大小（$\\sim 0.6\\,\\mathrm{mas}$）比大气视宁度极限（$\\sim 1000\\,\\mathrm{mas}$）小三个数量级以上。因此，用受视宁度限制的地面望远镜不可能分辨出单个微像或 Einstein 环。观测者将看到一个单一的、未分辨的光点，其表观亮度是源和其透镜成像亮度的总和。微透镜的主要可观测效应是这种光度放大，它随着源、透镜和观测者之间的对齐随时间变化而变化。这也正是该现象被称为*微*透镜（microlensing）的原因。",
            "answer": "$$\n\\boxed{0.319}\n$$"
        },
        {
            "introduction": "在建立了基本尺度之后，下一步是理解这种几何结构如何转化为可观测的信号。本练习将重点推导点源放大率公式 $A(u)$，该公式描述了背景源星的亮度如何随其与透镜的相对位置变化。这个公式是分析绝大多数微透镜事件光变曲线的基石。",
            "id": "4182083",
            "problem": "一个点质量引力透镜会为背景源产生两个像，其总放大率取决于源-透镜-观测者的几何结构。从广义相对论 (GR) 中点质量导致的光线偏转角 $\\hat{\\alpha}(b) = \\frac{4 G M}{c^{2} b}$，以及未经透镜效应的源角位置 $\\beta$ 与像角位置 $\\theta$ 之间的薄透镜、小角度映射关系出发。使用距离 $D_{L}$ (观测者到透镜)、$D_{S}$ (观测者到源) 和 $D_{LS}$ (透镜到源)。通过小角度薄透镜近似定义角爱因斯坦半径 $\\theta_{E}$，并引入无量纲撞击参数 $u \\equiv \\beta/\\theta_{E}$ 和无量纲像角 $y \\equiv \\theta/\\theta_{E}$。从第一性原理出发，推导点源总放大率 $A(u)$，不得引用标准的微引力透镜放大率公式。\n\n假设源的轨迹为直线，在峰值处具有最小无量纲间隔 $u_{0}$。使用您推导出的 $A(u)$，计算当 $u_{0} = 0.05$ 时的峰值放大率 $A_{\\rm max}$。将最终数值答案四舍五入至四位有效数字，并注意放大率是无量纲的。\n\n然后，用文字讨论在非常高的放大率下，有限源效应的作用。定义源尺寸参数 $\\rho \\equiv \\theta_{*}/\\theta_{E}$，其中 $\\theta_{*}$ 是源的角半径，并定性解释在 $u_{0} \\ll 1$ 的情况下，有限源效应如何以及何时会改变峰值放大率和光变曲线的形状。这部分不需要计算任何额外的数值。",
            "solution": "本题要求推导点质量引力透镜的总放大率，进行后续的数值计算，并对有限源效应进行定性讨论。我们将按照规定的顺序，从基本原理出发，依次解决每个部分。\n\n**第一部分：点源总放大率 $A(u)$ 的推导**\n\n我们从薄透镜、小角度近似下的引力透镜几何学开始。设 $D_L$ 为观测者到透镜的距离，$D_S$ 为观测者到源的距离，$D_{LS}$ 为透镜到源的距离。设 $\\vec{\\beta}$ 为源在天空中的真实角位置（在没有透镜的情况下），$\\vec{\\theta}$ 为观测到的像的角位置。透镜本身位于我们角坐标系的原点。\n\n一个质量为 $M$ 的点质量在撞击参数为 $b$ 处对光线的引力偏转角由 $\\hat{\\alpha}(b) = \\frac{4GM}{c^2 b}$ 给出。在透镜平面上，撞击参数为 $b = D_L \\theta$，其中 $\\theta = |\\vec{\\theta}|$。偏转角矢量 $\\hat{\\vec{\\alpha}}$ 从未经透镜效应的源位置指向透镜质量。\n\n源和像位置之间的基本关系，即透镜方程，是由简单的几何学推导出来的。如果将像的位置无偏转地投影回源平面，它将处于角位置 $\\vec{\\theta}$。然而，光线被偏转了一个角度 $\\hat{\\vec{\\alpha}}$。这种偏转发生在透镜平面，投影到源平面上的有效偏转角按距离比 $D_{LS}/D_S$ 进行缩放。矢量透镜方程为：\n$$ \\vec{\\beta} = \\vec{\\theta} - \\vec{\\alpha}(\\vec{\\theta}) $$\n其中 $\\vec{\\alpha}(\\vec{\\theta})$ 是约化偏转角，定义为 $\\vec{\\alpha} = \\frac{D_{LS}}{D_S} \\hat{\\vec{\\alpha}}$。约化偏转矢量 $\\vec{\\alpha}$ 从透镜中心指向像。其大小为：\n$$ \\alpha(\\theta) = \\frac{D_{LS}}{D_S} \\hat{\\alpha}(D_L \\theta) = \\frac{D_{LS}}{D_S} \\frac{4GM}{c^2 D_L \\theta} $$\n我们定义角爱因斯坦半径 $\\theta_E$，即当源与透镜完全对齐（即 $\\beta=0$）时形成像的 $\\theta$ 值。在这种情况下，$\\theta = \\alpha(\\theta)$。\n$$ \\theta_E = \\frac{D_{LS}}{D_S} \\frac{4GM}{c^2 D_L \\theta_E} \\implies \\theta_E^2 = \\frac{4GM}{c^2} \\frac{D_L D_{LS}}{D_S D_L} = \\frac{4GM}{c^2} \\frac{D_{LS}}{D_S D_L} $$\n使用这个定义，我们可以将约化偏转角的大小表示为 $\\alpha(\\theta) = \\frac{\\theta_E^2}{\\theta}$。透镜方程变为：\n$$ \\vec{\\beta} = \\vec{\\theta} - \\frac{\\theta_E^2}{\\theta^2} \\vec{\\theta} = \\vec{\\theta} \\left( 1 - \\frac{\\theta_E^2}{\\theta^2} \\right) $$\n这个矢量方程表明，源、透镜和像必须共线。因此，我们可以使用一个关联大小 $\\beta = |\\vec{\\beta}|$ 和 $\\theta = |\\vec{\\theta}|$ 的标量方程来分析此问题：\n$$ \\beta = \\left| \\theta - \\frac{\\theta_E^2}{\\theta} \\right| $$\n我们引入无量纲变量 $u \\equiv \\beta/\\theta_E$ 和 $y \\equiv \\theta/\\theta_E$。将标量透镜方程除以 $\\theta_E$ 得到：\n$$ u = \\left| y - \\frac{1}{y} \\right| $$\n对于任何给定的源位置 $u0$，此方程给出两个像位置的解。我们把像位置 $y$ 看作是沿连接源和透镜的轴上的带符号量。方程变为 $u = y - 1/y$。这是一个关于 $y$ 的二次方程：$y^2 - uy - 1 = 0$。两个解是：\n$$ y_{\\pm} = \\frac{u \\pm \\sqrt{u^2 + 4}}{2} $$\n这些代表了两个像的无量纲角位置。$y_+$ 对应于“主像”，位于透镜与源的同一侧 ($y_+  0$)，而 $y_-$ 对应于“次像”，位于另一侧 ($y_-  0$)。\n\n引力透镜效应保持表面亮度不变。因此，像的放大率 $A$ 是像的立体角与源的立体角之比。对于无穷小源，这是透镜映射的雅可比矩阵行列式的倒数，$J_{ij} = \\frac{\\partial \\beta_i}{\\partial \\theta_j}$。总放大率是各个像的放大率绝对值之和。\n一个等效的方法是计算每个像的放大率，即 $\\mu = \\frac{y}{u} \\frac{dy}{du}$。对无量纲透镜方程 $u = y - 1/y$ 直接关于 $u$ 求导并不直接。相反，我们关于 $y$ 求导：$du = (1 + 1/y^2) dy$，这给出 $\\frac{dy}{du} = \\frac{1}{1 + 1/y^2} = \\frac{y^2}{y^2+1}$。\n在位置 $y$ 处的像的带符号放大率为：\n$$ \\mu(y) = \\frac{y}{u}\\frac{dy}{du} = \\frac{y}{y - 1/y} \\frac{y^2}{y^2+1} = \\frac{y^2}{y^2 - 1} \\frac{y^2}{y^2+1} = \\frac{y^4}{y^4-1} $$\n总放大率 $A(u)$ 是两个像的放大率绝对值之和：\n$$ A(u) = |\\mu(y_+)| + |\\mu(y_-)| $$\n对于主像，$y_+ = \\frac{u + \\sqrt{u^2+4}}{2}  1$ 对任何 $u0$ 成立。因此，$y_+^4  1$，其放大率 $\\mu(y_+)$ 为正。\n$$ |\\mu(y_+)| = \\mu(y_+) = \\frac{y_+^4}{y_+^4-1} $$\n对于次像，$y_- = \\frac{u - \\sqrt{u^2+4}}{2}$。我们注意到，对于任何 $u0$，$|y_-|  1$，所以 $y_-^4  1$。其放大率 $\\mu(y_-)$ 为负。\n$$ |\\mu(y_-)| = -\\mu(y_-) = -\\frac{y_-^4}{y_-^4-1} = \\frac{y_-^4}{1-y_-^4} $$\n总放大率为 $A(u) = \\frac{y_+^4}{y_+^4-1} + \\frac{y_-^4}{1-y_-^4}$。\n利用 $y_+ y_- = -1$ 的性质，我们有 $y_-^4 = (-1/y_+)^4 = 1/y_+^4$。将此代入 $A(u)$ 的表达式中：\n$$ A(u) = \\frac{y_+^4}{y_+^4-1} + \\frac{1/y_+^4}{1-1/y_+^4} = \\frac{y_+^4}{y_+^4-1} + \\frac{1}{y_+^4-1} = \\frac{y_+^4+1}{y_+^4-1} $$\n这个表达式仍然是用 $y_+$ 表示的。一个更直接的方法是使用 $y_{\\pm}$ 对 $u$ 的导数。\n$$ \\frac{dy_{\\pm}}{du} = \\frac{1}{2} \\left( 1 \\pm \\frac{2u}{2\\sqrt{u^2+4}} \\right) = \\frac{1}{2} \\left( 1 \\pm \\frac{u}{\\sqrt{u^2+4}} \\right) $$\n两个像的放大率为：\n$$ A_{\\pm} = |\\mu_{\\pm}| = \\left|\\frac{y_{\\pm}}{u} \\frac{dy_{\\pm}}{du}\\right| = \\left| \\frac{1}{u} \\frac{u \\pm \\sqrt{u^2+4}}{2} \\frac{1}{2} \\left( \\frac{\\sqrt{u^2+4} \\pm u}{\\sqrt{u^2+4}} \\right) \\right| $$\n$$ A_{\\pm} = \\frac{1}{4u\\sqrt{u^2+4}} |(u \\pm \\sqrt{u^2+4})(\\sqrt{u^2+4} \\pm u)| $$\n对于主像（$+$ 号）：\n$$ A_+ = \\frac{(\\sqrt{u^2+4}+u)^2}{4u\\sqrt{u^2+4}} = \\frac{u^2+4+2u\\sqrt{u^2+4}+u^2}{4u\\sqrt{u^2+4}} = \\frac{2u^2+4+2u\\sqrt{u^2+4}}{4u\\sqrt{u^2+4}} = \\frac{u^2+2+u\\sqrt{u^2+4}}{2u\\sqrt{u^2+4}} $$\n对于次像（$-$ 号）：\n$$ A_- = \\frac{|(u - \\sqrt{u^2+4})(\\sqrt{u^2+4} - u)|}{4u\\sqrt{u^2+4}} = \\frac{(\\sqrt{u^2+4}-u)^2}{4u\\sqrt{u^2+4}} = \\frac{u^2+4-2u\\sqrt{u^2+4}+u^2}{4u\\sqrt{u^2+4}} = \\frac{u^2+2-u\\sqrt{u^2+4}}{2u\\sqrt{u^2+4}} $$\n总放大率是 $A(u) = A_+ + A_-$ 之和：\n$$ A(u) = \\frac{u^2+2+u\\sqrt{u^2+4}}{2u\\sqrt{u^2+4}} + \\frac{u^2+2-u\\sqrt{u^2+4}}{2u\\sqrt{u^2+4}} = \\frac{2(u^2+2)}{2u\\sqrt{u^2+4}} $$\n这就得到了点源总放大率的最终表达式：\n$$ A(u) = \\frac{u^2+2}{u\\sqrt{u^2+4}} $$\n\n**第二部分：峰值放大率的计算**\n\n题目指定了一个直线源轨迹，其最小无量纲间隔为 $u_0$。峰值放大率 $A_{\\rm max}$ 出现在最接近点，即 $u = u_0$ 时。我们已知 $u_0 = 0.05$。\n我们将这个值代入我们推导出的 $A(u)$ 公式中：\n$$ A_{\\rm max} = A(u_0) = \\frac{u_0^2+2}{u_0\\sqrt{u_0^2+4}} $$\n$$ A_{\\rm max} = \\frac{(0.05)^2+2}{0.05\\sqrt{(0.05)^2+4}} = \\frac{0.0025+2}{0.05\\sqrt{0.0025+4}} = \\frac{2.0025}{0.05\\sqrt{4.0025}} $$\n现在，我们计算数值：\n$$ \\sqrt{4.0025} \\approx 2.000624915 $$\n$$ A_{\\rm max} \\approx \\frac{2.0025}{0.05 \\times 2.000624915} = \\frac{2.0025}{0.10003124575} \\approx 20.01870 $$\n按要求四舍五入到四位有效数字，我们得到：\n$$ A_{\\rm max} \\approx 20.02 $$\n\n**第三部分：关于有限源效应的定性讨论**\n\n上述推导假设源是点状的。真实的天体物理源，例如恒星，具有有限的角尺寸。这由参数 $\\rho \\equiv \\theta_*/\\theta_E$ 来表征，其中 $\\theta_*$ 是源恒星的角半径。\n\n当透镜接近或穿过源恒星的角盘面时，有限源效应变得显著，并修正了点源模型的预测。这发生在高放大率事件中，特别是当最小撞击参数 $u_0$ 与源尺寸参数处于同一量级或更小时，即当 $u_0 \\lesssim \\rho$ 时。\n\n这些修正主要体现在两个方面：\n\n1.  **峰值放大率：** 点源放大率 $A(u)$ 在 $u \\to 0$ 时发散（因为当 $u \\ll 1$ 时，$A(u) \\approx 1/u$）。这种不符合物理实际的发散通过考虑有限的源尺寸得到解决。观测到的通量不是探测单一点 $u_0$ 的放大率，而是整个源盘面上的放大率平均值。这种平均化过程平滑了奇点。\n    因此，峰值放大率不再遵循 $A(u_0) \\approx 1/u_0$ 的标度关系。它会饱和到一个由源尺寸从根本上限制的最大值。对于透镜穿过源盘面（$u_0  \\rho$）的微引力透镜事件，峰值放大率显著低于点源模型的预测。对于穿过一个亮度均匀的源的中心凌越（$u_0=0$），峰值放大率近似为 $A_{\\rm max, finite} \\approx 2/\\rho$。对于非中心凌越（$0  u_0 \\lesssim \\rho$），相对于点源模型，峰值被抑制，但具体取决于凌越的精确几何形状。因此，有限源效应对可实现的放大率施加了一个由 $\\rho^{-1}$ 决定的上限。\n\n2.  **光变曲线形状：** 微引力透镜光变曲线在其峰值附近的形状也发生了改变。点源模型预测的尖锐、尖峰状的峰值被一个更宽、更圆或“平坦”的峰值所取代。如果透镜完全穿过源恒星，光变曲线可能会呈现出平台状的特征。这种偏离点源曲线的持续时间与透镜穿过源角直径所需的时间有关，而该时间与 $\\rho$ 成正比。\n    分析这个平坦峰值的精确形状为测量源尺寸参数 $\\rho$ 提供了一种方法。如果源恒星的角尺寸 $\\theta_*$ 可以被独立估算（例如，通过其光谱类型和距离），那么从光变曲线中对 $\\rho$ 的测量可以直接得出角爱因斯坦半径 $\\theta_E$ 的测量值，这是透镜系统的一个关键物理参数。\n\n总而言之，在高放大率区域（$u_0 \\ll 1$），当 $u_0 \\lesssim \\rho$ 时，有限源效应变得至关重要，导致峰值放大率降低和光变曲线峰值的特征性展宽。",
            "answer": "$$\\boxed{20.02}$$"
        },
        {
            "introduction": "理想化的模型是理解物理过程的起点，但真实世界的数据分析充满了挑战。本高阶计算练习将引导你直面一个关键的系统效应：混合光（blending）。你将通过编程来量化未分辨恒星的光污染如何扭曲我们对透镜系统物理参数的解读，这是从理论走向实践的关键一课。",
            "id": "4182113",
            "problem": "你的任务是量化在拟合点源点透镜（PSPL）引力微透镜光变曲线时，因忽略光通量混合而引入的参数偏差。由单个点质量引力透镜化的点源的PSPL放大率由公式 $A(u) = \\dfrac{u^2 + 2}{u \\sqrt{u^2 + 4}}$ 给出，其中 $u(t) = \\sqrt{u_0^2 + \\left(\\dfrac{t - t_0}{t_E}\\right)^2}$，$u_0$ 是最小冲击参数，$t_0$ 是峰值放大率时间，$t_E$ 是爱因斯坦时间标度。观测到的混合光通量为 $F(t) = F_s A(u(t)) + F_b$，其中 $F_s$ 是源光通量，$F_b$ 是来自无关源的混合光通量。基线光通量为 $F_0 = F_s + F_b$，表观基线归一化放大率为 $\\tilde{A}(t) = \\dfrac{F(t)}{F_0} = 1 + s \\left(A(u(t)) - 1\\right)$，其中 $s = \\dfrac{F_s}{F_s + F_b} = 1 - g$ 且 $g = \\dfrac{F_b}{F_s + F_b}$ 是混合光分数。\n\n在一个忽略混合效应的简化拟合中，假设 $\\tilde{A}(t)$ 是由一个未混合的PSPL模型生成的，并用 $A\\!\\left(\\sqrt{u_0'^2 + \\left(\\dfrac{t - t_0}{t_E'}\\right)^2}\\right)$ 来拟合 $\\tilde{A}(t)$，从而通过在时间网格上最小化未混合PSPL模型与 $\\tilde{A}(t)$ 之间的残差平方和，从混合光变曲线中估计 $u_0'$ 和 $t_E'$。目标是计算分数偏差 $(\\delta t_E/t_E)$ 和 $(\\delta u_0/u_0)$，其中 $\\delta t_E = t_E' - t_E$ 和 $\\delta u_0 = u_0' - u_0$。\n\n从基本的PSPL放大率 $A(u)$ 和光通量叠加 $F(t) = F_s A(u(t)) + F_b$ 出发，推导一个算法。对于给定的一组真实参数 $(u_0, t_E, t_0, g)$，该算法在时间网格上构建 $\\tilde{A}(t)$，然后通过最小化非线性最小二乘目标函数 $\\sum_t \\left[A\\!\\left(\\sqrt{u_0'^2 + \\left(\\dfrac{t - t_0}{t_E'}\\right)^2}\\right) - \\tilde{A}(t)\\right]^2$ 来估计 $(u_0', t_E')$。利用此结果计算 $(\\delta t_E/t_E)$ 和 $(\\delta u_0/u_0)$。\n\n将该算法实现为一个完整的、可运行的程序。必须评估以下测试套件：\n\n- 情况 1：$u_0 = 0.1$，$t_E = 20$ 天，$t_0 = 0$ 天，$g = 0.0$。\n- 情况 2：$u_0 = 0.1$，$t_E = 20$ 天，$t_0 = 0$ 天，$g = 0.5$。\n- 情况 3：$u_0 = 0.01$，$t_E = 30$ 天，$t_0 = 0$ 天，$g = 0.9$。\n- 情况 4：$u_0 = 1.0$，$t_E = 5$ 天，$t_0 = 0$ 天，$g = 0.2$。\n\n对于每种情况，构建一个包含201个样本的均匀时间网格，范围从 $t = t_0 - 5 t_E$ 到 $t = t_0 + 5 t_E$（单位：天），计算 $\\tilde{A}(t)$，并使用非线性最小二乘法拟合 $(u_0', t_E')$，约束条件为 $u_0'  0$ 和 $t_E'  0$。需要报告的分数偏差为 $(\\delta t_E/t_E)$ 和 $(\\delta u_0/u_0)$，它们是无单位的小数。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果是一个双元素列表 $[\\delta t_E/t_E,\\delta u_0/u_0]$，不含空格，并按上述用例的顺序排列。例如，格式必须为 $[[\\delta t_{E,1}/t_{E,1},\\delta u_{0,1}/u_{0,1}],[\\delta t_{E,2}/t_{E,2},\\delta u_{0,2}/u_{0,2}],\\dots]$。不应打印任何其他文本。由于分数偏差是无单位的，最终输出中不出现任何物理单位。",
            "solution": "该问题要求量化当一个混合引力微透镜事件被错误地用一个非混合的点源点透镜（PSPL）模型拟合时产生的参数偏差。这包括为一个混合事件生成合成数据，然后执行非线性最小二乘拟合，以找到与该数据最佳匹配的错误模型的参数。偏差是拟合参数与真实参数之间的分数差异。\n\n逻辑步骤如下：\n1.  为真实（混合）和拟合（未混合）的光变曲线定义数学模型。\n2.  对于每个测试用例，根据提供的“真实”参数生成合成的混合光变曲线。\n3.  通过定义要最小化的目标函数来建立优化问题。\n4.  数值求解优化问题以找到有偏差的参数。\n5.  根据真实参数和有偏差的参数计算所要求的分数偏差。\n\n**1. 数学模型**\n\n基本构成部分是PSPL放大率 $A(u)$，它取决于源和透镜星之间的无量纲投影分离 $u$：\n$$A(u) = \\frac{u^2 + 2}{u \\sqrt{u^2 + 4}}$$\n此表达式对 $u  0$ 有效。对于 $u \\to 0$，放大率发散为 $A(u) \\approx 1/u$，这对应于完美对齐。\n\n分离度 $u$ 是时间 $t$ 的函数，由下式给出：\n$$u(t) = \\sqrt{u_0^2 + \\left(\\frac{t - t_0}{t_E}\\right)^2}$$\n此处，$u_0$ 是冲击参数（以爱因斯坦半径为单位的最小分离），$t_0$ 是最接近的时间（因此是峰值放大率的时间），$t_E$ 是爱因斯坦时间标度，它表征了事件的持续时间。\n\n在现实情景中，观测到的光可能包含来自源或透镜附近未分辨恒星的光通量，称为混合光。总观测光通量 $F(t)$ 是放大的源光通量 $F_s A(u(t))$ 和恒定的混合光通量 $F_b$ 的总和：\n$$F(t) = F_s A(u(t)) + F_b$$\n在分析光变曲线时，光通量通常通过基线光通量 $F_0$ 进行归一化，基线光通量是远离透镜事件峰值时的光通量，此时 $A(u(t)) \\to 1$。因此，$F_0 = F_s + F_b$。表观的、基线归一化的放大率 $\\tilde{A}(t)$ 为：\n$$\\tilde{A}(t) = \\frac{F(t)}{F_0} = \\frac{F_s A(u(t)) + F_b}{F_s + F_b}$$\n这可以利用混合光分数 $g = F_b / (F_s + F_b)$ 和源光通量分数 $s = F_s / (F_s + F_b) = 1 - g$ 改写为：\n$$\\tilde{A}(t) = s A(u(t)) + g = (1-g)A(u(t)) + g$$\n重新整理成更标准的形式，突出了与基线1的偏差：\n$$\\tilde{A}(t) = 1 + s(A(u(t)) - 1)$$\n这就是我们将要生成的合成数据的“真实”模型。\n\n一个简化的分析忽略了混合效应（即，假设 $g=0$ 和 $s=1$），并尝试用纯PSPL模型拟合数据 $\\tilde{A}(t)$。这个我们记为 $A_{fit}$ 的拟合模型有其自身的参数 $u_0'$ 和 $t_E'$：\n$$A_{fit}(t; u_0', t_E') = A\\left(\\sqrt{u_0'^2 + \\left(\\frac{t - t_0}{t_E'}\\right)^2}\\right)$$\n问题指定峰值放大率的时间不是拟合参数，而是固定为真实值 $t_0$。\n\n**2. 合成数据生成**\n\n对于每组给定的真实参数 $(u_0, t_E, t_0, g)$，我们必须首先生成合成的“观测”数据。这包括：\n- 创建一个从 $t_{start} = t_0 - 5 t_E$ 到 $t_{end} = t_0 + 5 t_E$ 的包含201个点的时间网格。设该网格为 $\\{t_i\\}$。\n- 使用真实参数 $(u_0, t_E, t_0)$ 计算每个时间样本的真实分离度 $u(t_i)$。\n- 计算每个样本的真实PSPL放大率 $A(u(t_i))$。\n- 计算源光通量分数 $s = 1 - g$。\n- 计算所有 $t_i$ 的表观放大率 $\\tilde{A}(t_i) = 1 + s(A(u(t_i)) - 1)$。得到的数组 $\\{\\tilde{A}(t_i)\\}$ 是我们的合成数据集。\n\n**3. 优化问题**\n\n目标是找到参数 $(u_0', t_E')$，使得简化模型 $A_{fit}(t; u_0', t_E')$ 与合成数据 $\\{\\tilde{A}(t_i)\\}$ 最佳匹配。这是通过最小化残差平方和（目标函数 $\\chi^2$）来实现的：\n$$\\chi^2(u_0', t_E') = \\sum_i \\left[ A_{fit}(t_i; u_0', t_E') - \\tilde{A}(t_i) \\right]^2$$\n这是一个标准的非线性最小二乘优化问题。要优化的参数是向量 $\\mathbf{p} = [u_0', t_E']$。最小化必须在物理约束条件 $u_0'  0$ 和 $t_E'  0$ 下进行。\n\n**4. 数值解**\n\n我们使用`scipy.optimize.least_squares`函数，该函数专为此类问题设计。此函数迭代地调整参数向量 $\\mathbf{p}$，以最小化用户提供的残差函数的平方和。\n残差函数 $R(\\mathbf{p})$ 返回一个向量，其元素是每个时间步上模型和数据之间的差异：\n$$R_i(\\mathbf{p}) = A_{fit}(t_i; u_0', t_E') - \\tilde{A}(t_i)$$\n`least_squares` 算法最小化 $\\sum_i R_i^2$。\n- **初始猜测：** 一个好的优化初始猜测对于收敛至关重要。真实参数 $(u_0, t_E)$ 是一个极好的出发点。\n- **边界：** 通过向求解器提供 `bounds=([0, 0], [inf, inf])` 来强制执行约束 $u_0'  0$ 和 $t_E'  0$。\n\n求解器返回一个结果对象，我们从中提取最优参数向量 $\\mathbf{p}_{opt} = [u_0', t_E']$。\n\n**5. 偏差计算**\n\n一旦确定了最佳拟合参数 $(u_0', t_E')$，最后一步是计算相对于真实参数 $(u_0, t_E)$ 的分数偏差：\n- 爱因斯坦时间标度的分数偏差：$\\dfrac{\\delta t_E}{t_E} = \\dfrac{t_E' - t_E}{t_E}$\n- 冲击参数的分数偏差：$\\dfrac{\\delta u_0}{u_0} = \\dfrac{u_0' - u_0}{u_0}$\n\n对于混合分数为 $g=0$ 的情况，我们有 $s=1$，因此 $\\tilde{A}(t) = A(u(t))$。合成数据是一条精确的未混合PSPL曲线。因此，最小二乘拟合应该能够恢复真实参数，得到 $(u_0', t_E') = (u_0, t_E)$，从而导致零偏差（在数值精度范围内）。这为实现提供了一个有价值的健全性检查。对于 $g  0$，我们预计拟合会受到影响，导致非零偏差。通常，混合效应会使事件看起来具有较低的峰值放大率和较窄的翼部，未混合模型通过增加冲击参数（$u_0'  u_0$）和减少时间标度（$t_E'  t_E$）来对此进行补偿。这导致 $u_0$ 的正偏差和 $t_E$ 的负偏差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef pspl_magnification(u):\n    \"\"\"\n    Computes the Point Source Point Lens (PSPL) magnification.\n    Args:\n        u (float or np.ndarray): The dimensionless source-lens separation.\n    Returns:\n        float or np.ndarray: The magnification A(u).\n    \"\"\"\n    u_sq = u**2\n    return (u_sq + 2) / (u * np.sqrt(u_sq + 4))\n\ndef model_unblended(t, u0, tE, t0):\n    \"\"\"\n    Computes the unblended PSPL model light curve.\n    Args:\n        t (np.ndarray): Array of times.\n        u0 (float): Impact parameter.\n        tE (float): Einstein timescale.\n        t0 (float): Time of peak magnification.\n    Returns:\n        np.ndarray: The model magnification at each time t.\n    \"\"\"\n    u = np.sqrt(u0**2 + ((t - t0) / tE)**2)\n    # Handle u=0 case to avoid division by zero, although it's unlikely on a grid.\n    # Magnification is infinite at u=0, but we can use a very large number.\n    # For u -> 0, A(u) -> 1/u.\n    # We add a small epsilon to u to prevent division by zero.\n    epsilon = 1e-12\n    return pspl_magnification(u + epsilon)\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the validation and calculation for all test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (u0_true, tE_true, t0_true, g_true)\n        (0.1, 20.0, 0.0, 0.0),   # Case 1\n        (0.1, 20.0, 0.0, 0.5),   # Case 2\n        (0.01, 30.0, 0.0, 0.9),  # Case 3\n        (1.0, 5.0, 0.0, 0.2),    # Case 4\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        u0_true, tE_true, t0_true, g_true = case\n        \n        # 1. Generate synthetic \"observed\" data\n        s_true = 1.0 - g_true\n        \n        time_grid = np.linspace(t0_true - 5 * tE_true, t0_true + 5 * tE_true, 201)\n        \n        # True unblended magnification\n        A_true = model_unblended(time_grid, u0_true, tE_true, t0_true)\n        \n        # Apparent (blended) magnification\n        A_tilde_data = 1.0 + s_true * (A_true - 1.0)\n        \n        # 2. Set up the nonlinear least-squares fit\n        \n        def residual_function(params, t, t0, data):\n            \"\"\"\n            Residual function for the least-squares fitter.\n            The function to be minimized is the sum of squares of this residual.\n            \"\"\"\n            u0_fit, tE_fit = params\n            model_pred = model_unblended(t, u0_fit, tE_fit, t0)\n            return model_pred - data\n\n        # Initial guess for the parameters [u0_prime, tE_prime]\n        initial_guess = [u0_true, tE_true]\n        \n        # Physical bounds for the parameters: u0' > 0, tE' > 0\n        param_bounds = ([1e-9, 1e-9], [np.inf, np.inf])\n\n        # 3. Perform the fit\n        fit_result = least_squares(\n            residual_function,\n            initial_guess,\n            bounds=param_bounds,\n            args=(time_grid, t0_true, A_tilde_data)\n        )\n        \n        u0_fit, tE_fit = fit_result.x\n        \n        # 4. Calculate fractional biases\n        delta_tE_over_tE = (tE_fit - tE_true) / tE_true\n        delta_u0_over_u0 = (u0_fit - u0_true) / u0_true\n        \n        results.append([delta_tE_over_tE, delta_u0_over_u0])\n\n    # Final print statement in the exact required format.\n    # e.g., [[-0.1,0.2],[-0.3,0.4]]\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}