{
    "hands_on_practices": [
        {
            "introduction": "任何光谱测量的精确度都最终受到噪声的限制。本练习将指导您建立一个符合实际情况的光谱仪噪声模型，并计算归一化通量的方差，这是在互相关函数（CCF）中对数据进行优化加权的至关重要的一步 ()。通过从基本物理原理出发，您将学会如何将在探测器像素上产生的各种独立和相关的噪声源（如光子噪声、读出噪声和暗电流）传播到最终提取并归一化的光谱中。",
            "id": "4163453",
            "problem": "一台高分辨率阶梯光栅摄谱仪记录了一幅二维探测器图像，其中每个波长像素索引 $i$ 都在五个空间像素 $j=1,\\dots,5$ 上进行了采样。你使用总和为1的最优权重 $w_j$ 在波长像素 $i$ 处提取一维光谱。仪器增益为 $g$ 电子数/模拟数字单位 (ADU)，每个像素的读出噪声服从标准差为 $\\sigma_r$ 电子数的高斯统计，暗电流率为 $d$ 电子数/秒，曝光时间为 $t$。偏置水平从过扫描区估计，并在提取前从每个探测器像素中减去；偏置估计具有标准差为 $\\sigma_b$ 电子数的高斯不确定性，并且对于固定的 $i$，该不确定性对所有 $j$ 都是共同的。你可以假设所有光子计数过程（目标和天空）都服从泊松统计，读出噪声和偏置误差与光子噪声无关且彼此独立，并且像素 $i$ 处的天空背景已被估计并包含在计数中，未进行天空背景扣除。然后，你通过除以从平滑拟合中获得的局部连续谱估计值 $C_i$（单位为电子数）来对提取的流量 $F_i$ 进行连续谱归一化；连续谱估计值的不确定性可以忽略不计。\n\n对于一个特定的波长像素 $i$，数据和参数如下：\n- 最优提取权重：$w_1=w_5=0.06$，$w_2=w_4=0.24$，$w_3=0.40$。\n- 空间像素上的目标计数 (ADU)：对于 $j=1,\\dots,5$，有 $O_{i,j} \\in \\{120,\\,480,\\,800,\\,480,\\,120\\}$。\n- 空间像素上的天空计数 (ADU)：对于所有 $j$，有 $S_{i,j}=20$。\n- 增益：$g=1.7$ 电子数/ADU。\n- 读出噪声标准差：$\\sigma_r=3.5$ 电子数。\n- 暗电流率：$d=0.01$ 电子数/秒；曝光时间：$t=1200$ 秒。\n- 偏置估计标准差：$\\sigma_b=1.2$ 电子数。\n- 连续谱估计：$C_i=1000$ 电子数。\n\n从泊松噪声和高斯噪声的基本原理以及不确定性传播规则出发，推导用于互相关函数 (CCF) 中最优加权的归一化流量 $f_i=F_i/C_i$ 的单像素方差。计算此波长像素的数值。以无量纲单位表示最终方差，并将你的答案四舍五入到四位有效数字。",
            "solution": "该问题要求推导和计算来自高分辨率摄谱仪的连续谱归一化流量测量的方差。该过程涉及识别所有独立的和相关的噪声源，并通过流量提取和归一化步骤传播它们的不确定性。\n\n设在给定波长像素 $i$ 和空间像素 $j$ 处测得的模拟数字单位 (ADU) 信号为目标计数和天空计数的总和，记作 $D_{i,j} = O_{i,j} + S_{i,j}$。从 ADU 到电子数的转换由增益 $g$ 决定。因此，来自光子的信号（以电子数计）为 $g D_{i,j}$。此外，还有来自暗电流的贡献，它在曝光时间 $t$ 内以速率 $d$ 累积。在像素中产生的信号电子总数是光生电子和暗电流电子的总和。两者都是泊松过程。空间像素 $j$ 中的信号电子平均数由下式给出：\n$$ \\mu_j = g (O_{i,j} + S_{i,j}) + d \\times t $$\n由于光子计数和暗电流都具有泊松性质，这个信号生成过程的方差等于电子数的平均值：$\\text{Var}_{\\text{signal}} = \\mu_j$。\n\n测量过程引入了额外的噪声。设 $\\tilde{N}_j$ 为空间像素 $j$（在固定波长 $i$ 处）经过所有处理步骤（偏置扣除、增益转换）后的最终测量电子计数。该测量可以建模为一个真实信号分量和几个独立噪声分量之和。然而，我们必须正确处理偏置扣除的不确定性，这是所有像素的共同误差。\n\n让我们将像素 $j$ 的测量值 $\\tilde{N}_j$ 建模为：\n$$ \\tilde{N}_j = P_j + D_j + \\epsilon_{r,j} + \\epsilon_b $$\n其中：\n- $P_j$ 是服从泊松分布的光电子数，其均值和方差均等于 $g(O_{i,j} + S_{i,j})$。\n- $D_j$ 是服从泊松分布的暗电流电子数，其均值和方差均等于 $d \\times t$。\n- $\\epsilon_{r,j}$ 是像素 $j$ 的服从高斯分布的读出噪声，均值为 $0$，方差为 $\\sigma_r^2$。每个像素的读出噪声是独立的。\n- $\\epsilon_b$ 是偏置扣除中的高斯分布误差，均值为 $0$，方差为 $\\sigma_b^2$。对于给定的波长像素 $i$，此误差对所有空间像素 $j=1, \\dots, 5$ 都是共同的。\n\n让我们为每个像素定义一个独立噪声分量 $U_j$ 和一个公共噪声分量 $C$。总测量信号为 $\\tilde{N}_j = U_j + C$，其中：\n- $U_j = P_j + D_j + \\epsilon_{r,j}$ 代表像素间相互独立的分量。其方差为 $\\text{Var}(U_j) = \\text{Var}(P_j) + \\text{Var}(D_j) + \\text{Var}(\\epsilon_{r,j}) = g(O_{i,j} + S_{i,j}) + d \\times t + \\sigma_r^2 = \\mu_j + \\sigma_r^2$。\n- $C = \\epsilon_b$ 代表公共误差分量。其方差为 $\\text{Var}(C) = \\sigma_b^2$。\n\n提取的一维流量 $F_i$ 是来自5个空间像素信号的最优加权和：\n$$ F_i = \\sum_{j=1}^{5} w_j \\tilde{N}_j = \\sum_{j=1}^{5} w_j (U_j + C) = \\sum_{j=1}^{5} w_j U_j + C \\sum_{j=1}^{5} w_j $$\n提取流量的方差 $\\text{Var}(F_i)$ 是通过传播各分量的方差找到的。由于 $U_j$ 项彼此独立且与 $C$ 独立，和的方差是：\n$$ \\text{Var}(F_i) = \\text{Var}\\left(\\sum_{j=1}^{5} w_j U_j\\right) + \\text{Var}\\left(C \\sum_{j=1}^{5} w_j\\right) $$\n$$ \\text{Var}(F_i) = \\sum_{j=1}^{5} w_j^2 \\text{Var}(U_j) + \\left(\\sum_{j=1}^{5} w_j\\right)^2 \\text{Var}(C) $$\n代入方差的表达式，并注意到权重总和为1的给定条件 $\\sum_{j=1}^{5} w_j = 1$：\n$$ \\text{Var}(F_i) = \\sum_{j=1}^{5} w_j^2 (\\mu_j + \\sigma_r^2) + (1)^2 \\sigma_b^2 = \\sum_{j=1}^{5} w_j^2 (\\mu_j + \\sigma_r^2) + \\sigma_b^2 $$\n这是提取流量方差的通用表达式，单位是电子数的平方。\n\n然后，流量 $F_i$ 通过除以连续谱估计值 $C_i$ 进行连续谱归一化。归一化流量为 $f_i = F_i / C_i$。问题陈述 $C_i$ 的不确定性可以忽略不计，因此 $C_i$ 可被视为一个常数。归一化流量的方差因此为：\n$$ \\text{Var}(f_i) = \\text{Var}\\left(\\frac{F_i}{C_i}\\right) = \\frac{1}{C_i^2} \\text{Var}(F_i) $$\n结合这些表达式，我们得到归一化流量方差的最终公式：\n$$ \\text{Var}(f_i) = \\frac{1}{C_i^2} \\left[ \\sum_{j=1}^{5} w_j^2 (\\mu_j + \\sigma_r^2) + \\sigma_b^2 \\right] $$\n\n现在，我们使用所提供的数据计算数值。\n给定参数：\n- $g = 1.7 \\, \\text{电子数}/\\text{ADU}$\n- $\\sigma_r = 3.5 \\, \\text{电子数}$\n- $d = 0.01 \\, \\text{电子数}/\\text{秒}$\n- $t = 1200 \\, \\text{秒}$\n- $\\sigma_b = 1.2 \\, \\text{电子数}$\n- $C_i = 1000 \\, \\text{电子数}$\n- 权重：$w_1=w_5=0.06$, $w_2=w_4=0.24$, $w_3=0.40$\n- 计数 (ADU)：$O_{i,j} \\in \\{120, 480, 800, 480, 120\\}$，$S_{i,j}=20$ (对所有 $j$)。\n\n首先，计算恒定的方差项：\n- 读出噪声方差：$\\sigma_r^2 = (3.5)^2 = 12.25 \\, \\text{电子数}^2$\n- 偏置不确定性方差：$\\sigma_b^2 = (1.2)^2 = 1.44 \\, \\text{电子数}^2$\n- 暗电流对平均信号的贡献：$d \\times t = 0.01 \\times 1200 = 12 \\, \\text{电子数}$\n\n接下来，计算每个空间像素的平均信号 $\\mu_j$：\n- 对于 $j=1,5$：$O_{i,1} + S_{i,1} = 120 + 20 = 140 \\, \\text{ADU}$。\n  $\\mu_1 = \\mu_5 = g(140) + d \\times t = 1.7 \\times 140 + 12 = 238 + 12 = 250 \\, \\text{电子数}$\n- 对于 $j=2,4$：$O_{i,2} + S_{i,2} = 480 + 20 = 500 \\, \\text{ADU}$。\n  $\\mu_2 = \\mu_4 = g(500) + d \\times t = 1.7 \\times 500 + 12 = 850 + 12 = 862 \\, \\text{电子数}$\n- 对于 $j=3$：$O_{i,3} + S_{i,3} = 800 + 20 = 820 \\, \\text{ADU}$。\n  $\\mu_3 = g(820) + d \\times t = 1.7 \\times 820 + 12 = 1394 + 12 = 1406 \\, \\text{电子数}$\n\n现在，计算总和 $\\sum_{j=1}^{5} w_j^2 (\\mu_j + \\sigma_r^2)$。我们可以根据对称性将各项分组：\n- $w_1^2=w_5^2 = (0.06)^2 = 0.0036$\n- $w_2^2=w_4^2 = (0.24)^2 = 0.0576$\n- $w_3^2 = (0.40)^2 = 0.1600$\n\n- $j=1,5$ 的项：$w_1^2(\\mu_1+\\sigma_r^2) = 0.0036 \\times (250 + 12.25) = 0.0036 \\times 262.25 = 0.9441$\n- $j=2,4$ 的项：$w_2^2(\\mu_2+\\sigma_r^2) = 0.0576 \\times (862 + 12.25) = 0.0576 \\times 874.25 = 50.3568$\n- $j=3$ 的项：$w_3^2(\\mu_3+\\sigma_r^2) = 0.1600 \\times (1406 + 12.25) = 0.1600 \\times 1418.25 = 226.92$\n\n总和是：\n$$ \\sum_{j=1}^{5} w_j^2(\\mu_j + \\sigma_r^2) = 2 \\times (0.9441) + 2 \\times (50.3568) + 226.92 $$\n$$ = 1.8882 + 100.7136 + 226.92 = 329.5218 \\, \\text{电子数}^2 $$\n\n现在，计算提取流量的总方差 $\\text{Var}(F_i)$：\n$$ \\text{Var}(F_i) = 329.5218 + \\sigma_b^2 = 329.5218 + 1.44 = 330.9618 \\, \\text{电子数}^2 $$\n\n最后，计算归一化流量的方差 $\\text{Var}(f_i)$：\n$$ \\text{Var}(f_i) = \\frac{\\text{Var}(F_i)}{C_i^2} = \\frac{330.9618}{(1000)^2} = \\frac{330.9618}{1000000} = 0.0003309618 $$\n这是一个无量纲量，因为它是归一化流量的方差。四舍五入到四位有效数字得到 $0.0003310$。\n\n用科学记数法表示，即为 $3.310 \\times 10^{-4}$。",
            "answer": "$$ \\boxed{3.310 \\times 10^{-4}} $$"
        },
        {
            "introduction": "互相关是高分辨率光谱分析中的核心操作，但对于包含数百万个采样点的数据集，其计算成本可能非常高。本练习将对比两种核心算法策略：直接时域计算与基于快速傅里叶变换（FFT）的频域方法 ()。通过推导并比较它们的操作计数和在实际场景下的运行时间，您将深刻理解为何FFT在处理大规模数据集时能带来数量级的效率提升，这对于设计高效的数据分析流程至关重要。",
            "id": "4163454",
            "problem": "一台用于探测系外行星大气的高分辨率摄谱仪，在均匀波长网格上采样，生成一个观测到的、经过连续谱归一化和地球大气吸收校正的光谱，该光谱是一个包含 $N$ 个样本的实值序列 $\\{x[n]\\}_{n=0}^{N-1}$。为了探测微弱的行星信号，我们将一个模板光谱 $\\{t[n]\\}_{n=0}^{N-1}$ 与观测数据在所有对应多普勒频移的整数延迟上进行互相关运算。考虑计算所有输出索引 $k \\in \\{0,1,\\dots,2N-2\\}$ 的完整线性互相关 $\\rho[k]$，其中对于实数序列，离散互相关定义为\n$$\n\\rho[k] = \\sum_{n=0}^{N-1} x[n]\\,t[n+k]\n$$\n其中 $t[\\cdot]$ 在 $[0,N-1]$ 范围外通过补零进行扩展，因此 $\\rho[k]$ 的长度为 $2N-1$。\n\n考虑两种算法策略：\n\n1. 直接时域计算，通过显式构成每个求和项来计算 $\\rho[k]$，求和中的每一项计为一次浮点乘法和一次浮点加法。\n\n2. 使用快速傅里叶变换 (FFT) 的频域方法，该方法调用卷积定理，并通过将两个输入都补零至长度 $L$、进行两次正向 FFT、一次逐点复数乘法 $X(\\omega)\\,\\overline{T(\\omega)}$ 和一次逆向 FFT 来计算 $\\rho$。假设 $L$ 选择为满足 $L \\ge 2N-1$ 的最小的 2 的幂。对于长度为 $L$ 的基-2 复数 FFT，采用以下广泛使用的运算模型：每次变换恰好需要 $5L\\log_{2}L$ 次实数浮点运算 (flops)，而在 $L$ 个频率上的逐点复数乘法恰好需要 $6L$ 次实数 flops。\n\na) 从离散互相关的定义和补零出发，推导直接方法所需的总浮点运算次数 $F_{\\mathrm{dir}}(N)$（作为 $N$ 的函数），以及基于 FFT 的方法所需的总浮点运算次数 $F_{\\mathrm{fft}}(N)$（通过 $L(N)=2^{\\lceil \\log_{2}(2N-1)\\rceil}$ 作为 $N$ 的函数）。\n\nb) 陈述两种方法的渐进计算复杂度（用 $N$ 表示）。\n\nc) 对于一次包含 $N=10^{6}$ 个样本的系外行星互相关计算，取如上定义的 $L$。假设直接方法的持续执行速率为 $r_{\\mathrm{dir}}=8.0\\times 10^{9}$ flops/秒，而基于 FFT 的流水线（包括变换和逐点乘法）的执行速率为 $r_{\\mathrm{fft}}=4.0\\times 10^{10}$ flops/秒。使用你在 (a) 部分得到的运算次数模型，估算每种方法的墙上时钟运行时间（以秒为单位）。\n\n将你的两个运行时间估算值四舍五入到三位有效数字，并将最终的运行时间对（以秒为单位）表示为一个行矩阵，其中第一个条目是直接方法的运行时间，第二个条目是基于 FFT 的方法的运行时间。",
            "solution": "问题陈述已经过严格验证，被认为是有效的。它在科学上基于数字信号处理的原理及其在天体物理学中的应用，问题提法清晰，定义明确，数据充分，表述客观。该问题是计算复杂度分析中一个标准的、有一定难度的练习。因此，我们可以开始解题。\n\na) 浮点运算次数的推导\n\n首先，我们确定直接时域方法的总浮点运算 (flop) 次数 $F_{\\mathrm{dir}}(N)$。互相关定义为 $\\rho[k] = \\sum_{n=0}^{N-1} x[n]\\,t[n+k]$。要计算两个长度为 $N$ 的序列的完整线性互相关，结果序列的长度为 $2N-1$。延迟范围从 $-(N-1)$ 到 $N-1$。我们假设问题中的输出索引 $k$ 映射到这个范围。对于给定的延迟（我们可以表示为 $k'$，其中 $k' \\in \\{-(N-1), \\dots, N-1\\}$），求和中的非零项数量由两个序列重叠部分的大小决定。这个数量是 $N - |k'|$。\n\n所有求和中的总项数是每个延迟的项数之和：\n$$\n\\text{Total Terms} = \\sum_{k'=-(N-1)}^{N-1} (N - |k'|)\n$$\n这个和可以拆分为：\n$$\n\\text{Total Terms} = (N - |0|) + \\sum_{k'=1}^{N-1} (N - k') + \\sum_{k'=- (N-1)}^{-1} (N - (-k'))\n$$\n$$\n= N + 2 \\sum_{k'=1}^{N-1} (N - k')\n$$\n令 $j = N - k'$。当 $k'$ 从 $1$ 变到 $N-1$ 时，$j$ 从 $N-1$ 降到 $1$。\n$$\n\\text{Total Terms} = N + 2 \\sum_{j=1}^{N-1} j = N + 2 \\frac{(N-1)N}{2} = N + N^2 - N = N^2\n$$\n问题指明我们计算“求和中每一项的一次浮点乘法和一次浮点加法”。这被解释为计算和累加每个非零乘积 $x[n]t[n+k]$ 的成本为 $2$ flops。因此，总 flop 次数是总项数的两倍。\n$$\nF_{\\mathrm{dir}}(N) = 2 \\times (\\text{Total Terms}) = 2N^2\n$$\n接下来，我们确定基于 FFT 的方法的 flop 次数 $F_{\\mathrm{fft}}(N)$。该方法包括以下步骤：\n1. 对补零后的输入序列进行两次长度为 $L$ 的正向快速傅里叶变换 (FFT)。\n2. 对得到的频谱进行一次逐点复数乘法 $X(\\omega)\\overline{T(\\omega)}$。\n3.进行一次长度为 $L$ 的逆向 FFT，将结果变换回时域。\n\n长度 $L$ 被给出为 $L = 2^{\\lceil \\log_{2}(2N-1)\\rceil}$。各部分的 flop 次数如下：\n- 一次复数 FFT（正向或逆向）的成本：$5L\\log_{2}L$ flops。\n- $L$ 个点的逐点复数乘法的成本：$6L$ flops。\n\n总 flop 次数是两次正向 FFT、一次逆向 FFT 和逐点乘法成本的总和。\n$$\nF_{\\mathrm{fft}}(N) = (\\text{FFT of } x) + (\\text{FFT of } t) + (\\text{pointwise mult}) + (\\text{IFFT of product})\n$$\n$$\nF_{\\mathrm{fft}}(N) = (5L\\log_{2}L) + (5L\\log_{2}L) + 6L + (5L\\log_{2}L)\n$$\n$$\nF_{\\mathrm{fft}}(N) = 15L\\log_{2}L + 6L = L(15\\log_{2}L + 6)\n$$\n代入 $L = L(N)$ 的表达式：\n$$\nF_{\\mathrm{fft}}(N) = 2^{\\lceil \\log_{2}(2N-1)\\rceil} \\left( 15\\log_{2}\\left(2^{\\lceil \\log_{2}(2N-1)\\rceil}\\right) + 6 \\right)\n$$\n由于 $\\log_{2}(2^p) = p$，这可以简化为：\n$$\nF_{\\mathrm{fft}}(N) = 2^{\\lceil \\log_{2}(2N-1)\\rceil} \\left( 15 \\lceil \\log_{2}(2N-1)\\rceil + 6 \\right)\n$$\n\nb) 渐进计算复杂度\n\n对于直接方法，flop 次数为 $F_{\\mathrm{dir}}(N) = 2N^2$。当 $N \\to \\infty$ 时，复杂度由 $N$ 的最高次幂决定。因此，渐进复杂度为：\n$$\nO(N^2)\n$$\n对于基于 FFT 的方法，我们分析当 $N$ 很大时 $L(N) = 2^{\\lceil \\log_{2}(2N-1)\\rceil}$ 的行为。上取整函数确保了 $\\log_{2}(2N-1) \\le \\lceil \\log_{2}(2N-1)\\rceil  \\log_{2}(2N-1) + 1$。这意味着 $2N-1 \\le L  2(2N-1)$。因此，$L$ 与 $N$ 是同阶的，即 $L \\in O(N)$。相应地，$\\log_{2}L \\in O(\\log N)$。\nflop 次数 $F_{\\mathrm{fft}}(N) \\approx 15L\\log_{2}L$。因此，渐进复杂度为：\n$$\nO(N \\log N)\n$$\n\nc) 墙上时钟运行时间估算\n\n给定 $N = 10^6$，我们计算具体的 flop 次数和运行时间。\n\n对于直接方法：\n总浮点运算次数为：\n$$\nF_{\\mathrm{dir}}(10^6) = 2 \\times (10^6)^2 = 2 \\times 10^{12} \\text{ flops}\n$$\n持续执行速率为 $r_{\\mathrm{dir}} = 8.0 \\times 10^9$ flops/秒。估算的运行时间是：\n$$\nT_{\\mathrm{dir}} = \\frac{F_{\\mathrm{dir}}(10^6)}{r_{\\mathrm{dir}}} = \\frac{2 \\times 10^{12}}{8.0 \\times 10^9} \\, \\text{s} = 0.25 \\times 10^3 \\, \\text{s} = 250 \\, \\text{s}\n$$\n精确到三位有效数字，这是 $250$ 秒。\n\n对于基于 FFT 的方法：\n首先，我们确定 FFT 长度 $L$。所需长度至少为 $2N-1 = 2 \\times 10^6 - 1 = 1,999,999$。\n我们需要找到最小的 2 的幂 $L = 2^k$，使得 $L \\ge 1,999,999$。\n$$\n\\log_{2}(1,999,999) = \\frac{\\ln(1,999,999)}{\\ln(2)} \\approx \\frac{14.50865}{0.69315} \\approx 20.93\n$$\n最小的整数指数 $k$ 必须是 $\\lceil 20.93 \\rceil = 21$。\n所以，$L = 2^{21} = 2,097,152$。\n项 $\\log_{2}L$ 恰好是 $21$。\n\n现在，我们计算总浮点运算次数：\n$$\nF_{\\mathrm{fft}}(10^6) = L(15\\log_{2}L + 6) = 2^{21} (15 \\times 21 + 6)\n$$\n$$\nF_{\\mathrm{fft}}(10^6) = 2,097,152 \\times (315 + 6) = 2,097,152 \\times 321 = 673,185,792 \\text{ flops}\n$$\n持续执行速率为 $r_{\\mathrm{fft}} = 4.0 \\times 10^{10}$ flops/秒。估算的运行时间是：\n$$\nT_{\\mathrm{fft}} = \\frac{F_{\\mathrm{fft}}(10^6)}{r_{\\mathrm{fft}}} = \\frac{673,185,792}{4.0 \\times 10^{10}} \\, \\text{s} \\approx 0.0168296 \\, \\text{s}\n$$\n四舍五入到三位有效数字，我们得到 $0.0168$ 秒。\n\n运行时间对（直接方法，基于 FFT 的方法）是 $(250 \\, \\text{s}, 0.0168 \\, \\text{s})$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 250  0.0168 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "从遥远恒星的光中探测微弱的系外行星大气信号，高度依赖于我们构建的理论模型（即“模板”）的准确性。本练习探讨了当模型不完美时会发生什么，特别是当用于生成模板的温度与行星大气的实际温度不匹配时 ()。通过量化这种温度失配对互相关信号幅度的影响，您将深入了解大气表征技术的稳健性以及可能引入的系统偏差，这对于准确解读观测结果至关重要。",
            "id": "4163447",
            "problem": "你的任务是量化在高分辨率光谱学中用于探测系外行星大气时，模板温度的失配如何影响互相关函数（CCF）的振幅。假设一个温度为 $T_{\\mathrm{p}}$ 的等温系外行星大气，而用于互相关的模板光谱是在失配的温度 $T_{\\mathrm{t}} = T_{\\mathrm{p}} + \\Delta T$ 下生成的。考虑一组由波数和低能态能量表征的光谱跃迁。你的目标是计算 CCF 振幅，即在 $T_{\\mathrm{p}}$ 和 $T_{\\mathrm{t}}$ 温度下谱线强度向量的归一化加权内积，其中谱线强度根据第一性原理计算。\n\n使用以下基于物理的原理：\n\n- 在温度 $T$ 时，能量为 $E_{\\ell}$ 的低能态吸收体布居数遵循玻尔兹曼分布：$n_{\\ell}(T) \\propto g_{\\ell}\\,\\exp(-E_{\\ell}/(k_{\\mathrm{B}} T))$，其中 $g_{\\ell}$ 是能级简并度， $k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n- 跃迁吸收的比例因子与低能级布居数乘以谱线振子强度成正比，并通过因子 $\\left(1 - \\exp(-h \\nu/(k_{\\mathrm{B}} T))\\right)$ 进行受激辐射校正，其中 $h$ 是普朗克常数， $\\nu$ 是跃迁频率。\n- 总内配分函数 $Q(T)$ 对能级布居数进行归一化。对于所考虑温度范围内的单一物质，将其近似为 $Q(T) = \\alpha\\,T^{\\beta}$，其中 $\\alpha$ 和 $\\beta$ 是给定常数。\n- 为避免携带显式的转换因子，使用第二辐射常数 $c_{2} = h c / k_{\\mathrm{B}}$，其值为 $c_{2} = 1.438776877\\,\\mathrm{K\\,cm}$，并使用波数（单位为 $\\mathrm{cm}^{-1}$）来描述能量和跃迁位置。如果一个量 $\\tilde{x}$ 的单位是 $\\mathrm{cm}^{-1}$，那么 $x/(k_{\\mathrm{B}} T) = c_{2}\\,\\tilde{x}/T$。\n\n将温度 $T$ 下跃迁 $i$ 的谱线强度定义为（忽略一个在最终归一化中会抵消的总体乘法常数）：\n$$\nS_{i}(T) \\propto (g f)_{i}\\,\\exp\\!\\left(-\\frac{c_{2}\\,\\tilde{E}_{\\ell,i}}{T}\\right)\\,\\left(1 - \\exp\\!\\left(-\\frac{c_{2}\\,\\tilde{\\nu}_{i}}{T}\\right)\\right)\\,\\frac{1}{Q(T)},\n$$\n其中 $(g f)_{i}$ 是谱线 $i$ 的简并度与振子强度的乘积，$\\tilde{E}_{\\ell,i}$ 是以 $\\mathrm{cm}^{-1}$ 为单位的低能态能量，$\\tilde{\\nu}_{i}$ 是以 $\\mathrm{cm}^{-1}$ 为单位的谱线波数。取 $Q(T) = \\alpha\\,T^{\\beta}$，其中 $\\alpha$ 和 $\\beta$ 为给定值。\n\n对于给定的谱线集和权重，将 CCF 振幅定义为归一化加权内积：\n$$\n\\mathrm{CCF}(T_{\\mathrm{p}}, T_{\\mathrm{t}}) = \\frac{\\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{p}})\\,S_{i}(T_{\\mathrm{t}})}{\\sqrt{\\left(\\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{p}})^{2}\\right)\\left(\\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{t}})^{2}\\right)}}.\n$$\n这是一个无量纲量，位于区间 $\\left[0,1\\right]$ 内。分子和分母使用相同的 $w_{i}$ 计算，并且 $S_{i}(T)$ 中的任何公共乘法常数都会抵消。\n\n使用以下固定的五组跃迁，每组由 $(\\tilde{\\nu}_{i}, \\tilde{E}_{\\ell,i}, (g f)_{i})$ 定义：\n- 谱线 1：$(\\tilde{\\nu}_{1}, \\tilde{E}_{\\ell,1}, (g f)_{1}) = (3000, 0, 1.0)$\n- 谱线 2：$(\\tilde{\\nu}_{2}, \\tilde{E}_{\\ell,2}, (g f)_{2}) = (3100, 500, 0.8)$\n- 谱线 3：$(\\tilde{\\nu}_{3}, \\tilde{E}_{\\ell,3}, (g f)_{3}) = (3200, 1000, 0.6)$\n- 谱线 4：$(\\tilde{\\nu}_{4}, \\tilde{E}_{\\ell,4}, (g f)_{4}) = (5000, 2000, 0.4)$\n- 谱线 5：$(\\tilde{\\nu}_{5}, \\tilde{E}_{\\ell,5}, (g f)_{5}) = (10000, 4000, 0.2)$\n\n这里所有的波数和能量单位都是 $\\mathrm{cm}^{-1}$，而 $(g f)$ 是无量纲的。请严格按照给定的数值使用 $c_{2} = 1.438776877\\,\\mathrm{K\\,cm}$。\n\n在每个测试用例中，使用指定的 $(\\alpha,\\beta)$ 实现 $Q(T) = \\alpha\\,T^{\\beta}$。温度单位必须是 $\\mathrm{K}$。最终的 CCF 振幅是无单位的。\n\n测试套件。计算以下四组参数的 CCF 振幅：\n- 情况 A（理想情况）：$T_{\\mathrm{p}} = 1800\\,\\mathrm{K}$，$\\Delta T = 0\\,\\mathrm{K}$，$\\alpha = 1.0$，$\\beta = 1.5$，权重 $w = [1.0, 1.0, 1.0, 1.0, 1.0]$。\n- 情况 B（中度失配，模板温度较低）：$T_{\\mathrm{p}} = 1800\\,\\mathrm{K}$，$\\Delta T = -400\\,\\mathrm{K}$，$\\alpha = 1.0$，$\\beta = 1.5$，权重 $w = [1.0, 1.0, 1.0, 1.0, 1.0]$。\n- 情况 C（中度失配，模板温度较高）：$T_{\\mathrm{p}} = 1000\\,\\mathrm{K}$，$\\Delta T = 800\\,\\mathrm{K}$，$\\alpha = 1.0$，$\\beta = 1.5$，权重 $w = [1.0, 1.0, 1.0, 1.0, 1.0]$。\n- 情况 D（边界情况，强失配且权重不均匀）：$T_{\\mathrm{p}} = 500\\,\\mathrm{K}$，$\\Delta T = 1500\\,\\mathrm{K}$，$\\alpha = 1.0$，$\\beta = 1.5$，权重 $w = [1.0, 1.0, 1.0, 0.5, 0.2]$。\n\n不涉及角度单位。输出中不出现其他物理单位。以上所有输入数字必须按给定值使用。\n\n你的程序必须：\n- 实现上述物理原理，为每条谱线计算 $S_{i}(T)$，并为每种情况计算归一化的 $\\mathrm{CCF}(T_{\\mathrm{p}}, T_{\\mathrm{t}})$。\n- 确保在所有情况下 $T_{\\mathrm{t}} = T_{\\mathrm{p}} + \\Delta T$ 严格为正；所提供的测试用例满足此要求。\n- 生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个 CCF 振幅四舍五入到六位小数，顺序为 [情况 A, 情况 B, 情况 C, 情况 D]。例如，输出格式必须类似于 $[0.123456,0.234567,0.345678,0.456789]$。\n\n最终输出是无量纲的，不需要单位标签。",
            "solution": "该问题要求计算互相关函数（CCF）的振幅，该振幅用于量化当使用温度为 $T_{\\mathrm{t}}$ 的光谱模板搜索来自温度为 $T_{\\mathrm{p}}$ 的系外行星大气的信号时发生的信号衰减。该问题定义明确，其科学基础是统计力学和辐射转移原理，并为获得唯一解提供了所有必要的数据和常数。\n\n问题的核心在于为一组光谱跃迁计算与温度相关的谱线强度 $S_{i}(T)$，然后使用这些强度通过归一化加权内积来计算 CCF 振幅。\n\n首先，我们来规范化在给定绝对温度 $T$ 下跃迁 $i$ 的谱线强度 $S_{i}(T)$ 的计算。问题提供了以下源自基本原理的模型：\n$$\nS_{i}(T) \\propto (g f)_{i}\\,\\exp\\!\\left(-\\frac{c_{2}\\,\\tilde{E}_{\\ell,i}}{T}\\right)\\,\\left(1 - \\exp\\!\\left(-\\frac{c_{2}\\,\\tilde{\\nu}_{i}}{T}\\right)\\right)\\,\\frac{1}{Q(T)}\n$$\n此处，$(g f)_{i}$ 是低能级的统计权重与跃迁的振子强度的乘积，$\\tilde{E}_{\\ell,i}$ 是以波数（$\\mathrm{cm}^{-1}$）为单位的低能态能量，$\\tilde{\\nu}_{i}$ 是跃迁波数（$\\mathrm{cm}^{-1}$），而 $c_{2} = h c / k_{\\mathrm{B}}$ 是第二辐射常数，其值为 $1.438776877\\,\\mathrm{K\\,cm}$。项 $\\exp(-c_{2}\\,\\tilde{E}_{\\ell,i}/T)$ 是玻尔兹曼因子，描述了低能态的布居数。项 $(1 - \\exp(-c_{2}\\,\\tilde{\\nu}_{i}/T))$ 是对受激辐射的校正。整个表达式通过总内配分函数 $Q(T)$ 进行归一化，在本问题中，该函数近似为幂律 $Q(T) = \\alpha\\,T^{\\beta}$。由于任何总体乘法常数在最终的 CCF 计算中都会抵消，因此我们可以将用于我们目的的谱线强度定义为：\n$$\nS_{i}(T) = (g f)_{i}\\,\\frac{\\exp\\left(-\\frac{c_{2}\\,\\tilde{E}_{\\ell,i}}{T}\\right)\\left(1 - \\exp\\left(-\\frac{c_{2}\\,\\tilde{\\nu}_{i}}{T}\\right)\\right)}{\\alpha\\,T^{\\beta}}\n$$\n\n接下来，CCF 振幅被定义为对应于行星温度 $T_{\\mathrm{p}}$ 和模板温度 $T_{\\mathrm{t}}$ 的谱线强度向量的归一化加权内积。设 $\\mathbf{S}(T_{\\mathrm{p}})$ 为谱线强度向量 $[S_{1}(T_{\\mathrm{p}}), S_{2}(T_{\\mathrm{p}}), \\dots, S_{N}(T_{\\mathrm{p}})]$，$\\mathbf{S}(T_{\\mathrm{t}})$ 为向量 $[S_{1}(T_{\\mathrm{t}}), S_{2}(T_{\\mathrm{t}}), \\dots, S_{N}(T_{\\mathrm{t}})]$。CCF 振幅由下式给出：\n$$\n\\mathrm{CCF}(T_{\\mathrm{p}}, T_{\\mathrm{t}}) = \\frac{\\sum_{i=1}^{N} w_{i}\\,S_{i}(T_{\\mathrm{p}})\\,S_{i}(T_{\\mathrm{t}})}{\\sqrt{\\left(\\sum_{i=1}^{N} w_{i}\\,S_{i}(T_{\\mathrm{p}})^{2}\\right)\\left(\\sum_{i=1}^{N} w_{i}\\,S_{i}(T_{\\mathrm{t}})^{2}\\right)}}\n$$\n其中 $w_{i}$ 是每条谱线 $i$ 的权重。此表达式等价于在赋予了加权内积的向量空间中两个向量之间夹角的余弦，或一个加权的 Pearson 相关系数。其值范围从 $0$（不相关）到 $1$（完全相关）。\n\n每个测试用例的计算过程如下：\n1. 确定该用例的参数：行星温度 $T_{\\mathrm{p}}$、温度失配 $\\Delta T$、配分函数参数 $\\alpha$ 和 $\\beta$，以及权重向量 $\\mathbf{w}$。五条光谱线的固定物理数据 $(\\tilde{\\nu}_{i}, \\tilde{E}_{\\ell,i}, (g f)_{i})$ 和常数 $c_{2}$ 用于所有情况。\n2. 计算模板温度 $T_{\\mathrm{t}} = T_{\\mathrm{p}} + \\Delta T$。\n3. 对于五条光谱线中的每一条，计算在行星温度下的谱线强度 $S_{i}(T_{\\mathrm{p}})$ 和在模板温度下的谱线强度 $S_{i}(T_{\\mathrm{t}})$。这将产生两个谱线强度向量，$\\mathbf{S}(T_{\\mathrm{p}})$ 和 $\\mathbf{S}(T_{\\mathrm{t}})$。\n4. 使用这些向量和权重 $\\mathbf{w}$，计算 CCF 公式所需的三项总和：\n    - 加权交叉项总和：$\\Sigma_{\\mathrm{pt}} = \\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{p}})\\,S_{i}(T_{\\mathrm{t}})$\n    - $T_{\\mathrm{p}}$ 的加权平方和：$\\Sigma_{\\mathrm{pp}} = \\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{p}})^{2}$\n    - $T_{\\mathrm{t}}$ 的加权平方和：$\\Sigma_{\\mathrm{tt}} = \\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{t}})^{2}$\n5. 计算最终的 CCF 振幅为 $\\mathrm{CCF} = \\Sigma_{\\mathrm{pt}} / \\sqrt{\\Sigma_{\\mathrm{pp}} \\cdot \\Sigma_{\\mathrm{tt}}}$。\n6. 每个用例的结果四舍五入到六位小数。\n\n对于情况 A，我们有 $T_{\\mathrm{p}} = 1800\\,\\mathrm{K}$ 和 $\\Delta T = 0\\,\\mathrm{K}$，这意味着 $T_{\\mathrm{t}} = T_{\\mathrm{p}}$。在这种情况下，对于所有谱线 $i$，$S_{i}(T_{\\mathrm{p}}) = S_{i}(T_{\\mathrm{t}})$。CCF 公式简化为：\n$$\n\\mathrm{CCF}(T_{\\mathrm{p}}, T_{\\mathrm{p}}) = \\frac{\\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{p}})^{2}}{\\sqrt{\\left(\\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{p}})^{2}\\right)\\left(\\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{p}})^{2}\\right)}} = \\frac{\\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{p}})^{2}}{\\sum_{i} w_{i}\\,S_{i}(T_{\\mathrm{p}})^{2}} = 1\n$$\n这提供了一个有用的验证点。对于任何非零的温度失配（$\\Delta T \\neq 0$），谱线强度的比率会改变，导致 CCF 振幅小于 $1$。失配越大，预期的振幅越低，反映了相关信号的衰减。\n\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the CCF amplitude for given sets of physical parameters.\n    \"\"\"\n    \n    # Define constants and fixed line data\n    c2 = 1.438776877  # K cm\n    \n    # Line data: (wavenumber [cm^-1], lower-state energy [cm^-1], gf-value)\n    line_data = np.array([\n        [3000.0, 0.0, 1.0],      # Line 1\n        [3100.0, 500.0, 0.8],    # Line 2\n        [3200.0, 1000.0, 0.6],   # Line 3\n        [5000.0, 2000.0, 0.4],   # Line 4\n        [10000.0, 4000.0, 0.2]    # Line 5\n    ])\n\n    # Test cases: (Tp [K], delta_T [K], alpha, beta, weights)\n    test_cases = [\n        (1800.0, 0.0, 1.0, 1.5, np.array([1.0, 1.0, 1.0, 1.0, 1.0])),  # Case A\n        (1800.0, -400.0, 1.0, 1.5, np.array([1.0, 1.0, 1.0, 1.0, 1.0])), # Case B\n        (1000.0, 800.0, 1.0, 1.5, np.array([1.0, 1.0, 1.0, 1.0, 1.0])),  # Case C\n        (500.0, 1500.0, 1.0, 1.5, np.array([1.0, 1.0, 1.0, 0.5, 0.2]))  # Case D\n    ]\n\n    def calculate_line_strengths(T, alpha, beta):\n        \"\"\"\n        Calculates line strengths for all lines at a given temperature T.\n        \n        S_i(T) propto (gf)_i * exp(-c2*E_i/T) * (1 - exp(-c2*nu_i/T)) / Q(T)\n        where Q(T) = alpha * T^beta\n        \"\"\"\n        nu = line_data[:, 0]\n        E_lower = line_data[:, 1]\n        gf = line_data[:, 2]\n        \n        if T = 0:\n            return np.zeros_like(nu)\n\n        Q_T = alpha * (T ** beta)\n        \n        boltzmann_factor = np.exp(-c2 * E_lower / T)\n        stim_emission_factor = 1.0 - np.exp(-c2 * nu / T)\n        \n        strengths = gf * boltzmann_factor * stim_emission_factor / Q_T\n        return strengths\n\n    results = []\n    for case in test_cases:\n        Tp, delta_T, alpha, beta, weights = case\n        Tt = Tp + delta_T\n\n        # Calculate line strength vectors for planet and template\n        S_p = calculate_line_strengths(Tp, alpha, beta)\n        S_t = calculate_line_strengths(Tt, alpha, beta)\n        \n        # Compute the weighted inner product terms for the CCF formula\n        # Numerator: sum(w_i * S_p_i * S_t_i)\n        numerator = np.sum(weights * S_p * S_t)\n        \n        # Denominator: sqrt(sum(w_i * S_p_i^2) * sum(w_i * S_t_i^2))\n        sum_sq_p = np.sum(weights * S_p**2)\n        sum_sq_t = np.sum(weights * S_t**2)\n        \n        denominator = np.sqrt(sum_sq_p * sum_sq_t)\n\n        # Handle potential division by zero, though not expected for these cases\n        if denominator == 0:\n            ccf_amplitude = 0.0\n        else:\n            ccf_amplitude = numerator / denominator\n        \n        results.append(ccf_amplitude)\n\n    # Return the results for formatting in the answer tag\n    return results\n\n# The final answer is generated by running the solution code.\nfinal_results = solve()\nformatted_results_string = f\"[{','.join([f'{res:.6f}' for res in final_results])}]\"\n# This string is then placed into the answer tag.\n```",
            "answer": "$$ \\boxed{\\text{[1.000000,0.988023,0.697411,0.407120]}} $$"
        }
    ]
}