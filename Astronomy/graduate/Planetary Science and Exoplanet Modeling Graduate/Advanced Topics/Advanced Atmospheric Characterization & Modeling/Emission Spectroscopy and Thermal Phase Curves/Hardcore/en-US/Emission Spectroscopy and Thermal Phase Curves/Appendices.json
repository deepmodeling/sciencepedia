{
    "hands_on_practices": [
        {
            "introduction": "To interpret an exoplanet's emission spectrum or thermal phase curve, we must first have a model for its global temperature structure. This practice introduces a foundational tool in planetary climate science: the one-dimensional energy balance model. By deriving and implementing an analytical solution, you will explore how the interplay between stellar irradiation and atmospheric heat transport sets the longitudinal temperature profile, providing direct physical insight into the amplitude and phase shift of thermal phase curves .",
            "id": "4159467",
            "problem": "Consider a tidally locked exoplanet modeled with a one-dimensional longitudinal energy balance framework intended for interpreting emission spectroscopy and Thermal Phase Curves (TPC). Assume a longitudinal coordinate $\\phi \\in [-\\pi,\\pi]$ (in radians) with periodic boundary conditions. The steady-state energy balance for the longitudinally varying temperature $T(\\phi)$ is modeled by the conservation of energy with diffusive heat transport and local radiative cooling,\n$$\nD \\frac{d^2 T}{d\\phi^2} + Q(\\phi) - \\epsilon \\sigma T(\\phi)^4 = 0,\n$$\nwhere $D$ is a constant longitudinal diffusion coefficient, $\\epsilon$ is the infrared emissivity, $\\sigma$ is the Stefan–Boltzmann constant, and $Q(\\phi)$ is the absorbed stellar power per unit area.\n\nAssume a sinusoidal incoming stellar forcing with a positive offset,\n$$\nQ(\\phi) = Q_0 \\left[1 + s \\cos\\left(\\phi - \\phi_s\\right)\\right],\n$$\nwhere $Q_0$ is the mean absorbed stellar flux, $s$ is the fractional amplitude (with $0 \\le s < 1$), and $\\phi_s$ is a longitudinal phase shift of the forcing (in radians) relative to an arbitrary reference longitude.\n\nStarting from fundamental physical principles and well-tested formulas, derive the steady-state longitudinal temperature distribution $T(\\phi)$ under the following physically realistic assumptions:\n- Energy conservation at steady state as given above.\n- Radiative cooling follows the Stefan–Boltzmann law $\\epsilon \\sigma T^4$.\n- Longitudinal heat transport is represented by a constant-coefficient diffusion term $D \\, d^2T/d\\phi^2$.\n- The solution is periodic in $\\phi$ with period $2\\pi$.\n- Linearize the radiative term around the global-mean temperature $T_0$ defined by the mean energy balance, and retain only leading-order terms in the perturbation; that is, write $T(\\phi) = T_0 + \\theta(\\phi)$ with $|\\theta| \\ll T_0$ and linearize $\\epsilon \\sigma T^4$ about $T_0$.\n\nDefine a dimensionless transport efficiency parameter $\\xi$ from the ratio of diffusion to linearized radiative damping, and use it to obtain an analytic closed-form solution for $T(\\phi)$. Express $T(\\phi)$ in terms of the given physical parameters $Q_0$, $s$, $\\phi_s$, $\\epsilon$, $\\sigma$, and $\\xi$.\n\nYour program must implement this derived $T(\\phi)$ and evaluate it for a fixed set of longitudes and for multiple parameter sets. Use the following longitudes (in radians) at which to evaluate $T(\\phi)$:\n- $\\phi \\in \\{-\\pi, -\\pi/2, 0, \\pi/2, \\pi\\}$.\n\nPhysical and numerical units:\n- Angles must be treated in radians.\n- Temperatures must be reported in Kelvin (K).\n- The Stefan–Boltzmann constant is $\\sigma = 5.670374419 \\times 10^{-8} \\,\\mathrm{W\\,m^{-2}\\,K^{-4}}$.\n\nTest suite:\nCompute and output the temperatures at the five specified longitudes for each of the following parameter sets $(Q_0, \\epsilon, s, \\phi_s, \\xi)$:\n- Case A: $Q_0 = 900 \\,\\mathrm{W\\,m^{-2}}$, $\\epsilon = 0.95$, $s = 0.25$, $\\phi_s = 0.2$ (radians), $\\xi = 0.5$.\n- Case B (near-radiative limit): $Q_0 = 1200 \\,\\mathrm{W\\,m^{-2}}$, $\\epsilon = 1.0$, $s = 0.10$, $\\phi_s = -0.3$ (radians), $\\xi = 10^{-6}$.\n- Case C (strong transport, small contrast): $Q_0 = 700 \\,\\mathrm{W\\,m^{-2}}$, $\\epsilon = 0.90$, $s = 0.60$, $\\phi_s = 1.0$ (radians), $\\xi = 100$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of three lists, one per case, each inner list containing the five temperatures at the specified longitudes in Kelvin, in the order $\\{-\\pi, -\\pi/2, 0, \\pi/2, \\pi\\}$. For example, an output with placeholder numbers would look like\n$$\n[[T_{A1},T_{A2},T_{A3},T_{A4},T_{A5}],[T_{B1},T_{B2},T_{B3},T_{B4},T_{B5}],[T_{C1},T_{C2},T_{C3},T_{C4},T_{C5}]]\n$$\nwhere each $T_{\\cdot}$ is a float in Kelvin. No other text should be printed.",
            "solution": "The user wants me to solve a physics problem. I will now proceed with the solution.\n## Problem Validation\n\n### Step 1: Extract Givens\n\nThe problem provides the following information:\n1.  **Governing Equation**: The steady-state energy balance for the longitudinal temperature $T(\\phi)$ is given by:\n    $$D \\frac{d^2 T}{d\\phi^2} + Q(\\phi) - \\epsilon \\sigma T(\\phi)^4 = 0$$\n2.  **Longitudinal Coordinate**: $\\phi \\in [-\\pi, \\pi]$ with periodic boundary conditions.\n3.  **Absorbed Power**: The absorbed stellar power per unit area, $Q(\\phi)$, is given by:\n    $$Q(\\phi) = Q_0 \\left[1 + s \\cos\\left(\\phi - \\phi_s\\right)\\right]$$\n4.  **Parameters**:\n    -   $D$: constant longitudinal diffusion coefficient.\n    -   $\\epsilon$: infrared emissivity.\n    -   $\\sigma$: Stefan–Boltzmann constant.\n    -   $Q_0$: mean absorbed stellar flux.\n    -   $s$: fractional amplitude of the forcing, with $0 \\le s < 1$.\n    -   $\\phi_s$: longitudinal phase shift of the forcing in radians.\n5.  **Assumptions and Constraints**:\n    -   Energy conservation at steady state.\n    -   Radiative cooling via Stefan–Boltzmann law, $\\epsilon \\sigma T^4$.\n    -   Longitudinal heat transport as constant-coefficient diffusion, $D \\, d^2T/d\\phi^2$.\n    -   Solution is periodic in $\\phi$ with period $2\\pi$.\n    -   Linearization: $T(\\phi) = T_0 + \\theta(\\phi)$ with $|\\theta| \\ll T_0$, where $T_0$ is the global-mean temperature defined by the mean energy balance. The term $\\epsilon \\sigma T^4$ is to be linearized around $T_0$.\n6.  **Task Definition**:\n    -   Define a dimensionless transport efficiency parameter $\\xi$ as the ratio of diffusion to linearized radiative damping.\n    -   Derive an analytic closed-form solution for $T(\\phi)$ in terms of $Q_0$, $s$, $\\phi_s$, $\\epsilon$, $\\sigma$, and $\\xi$.\n    -   Implement the derived solution in a program to evaluate $T(\\phi)$ at specific longitudes $\\phi \\in \\{-\\pi, -\\pi/2, 0, \\pi/2, \\pi\\}$ for three specified parameter sets.\n7.  **Constants**:\n    -   Stefan–Boltzmann constant: $\\sigma = 5.670374419 \\times 10^{-8} \\,\\mathrm{W\\,m^{-2}\\,K^{-4}}$.\n8.  **Test Cases**:\n    -   Case A: $(Q_0, \\epsilon, s, \\phi_s, \\xi) = (900, 0.95, 0.25, 0.2, 0.5)$.\n    -   Case B: $(Q_0, \\epsilon, s, \\phi_s, \\xi) = (1200, 1.0, 0.10, -0.3, 10^{-6})$.\n    -   Case C: $(Q_0, \\epsilon, s, \\phi_s, \\xi) = (700, 0.90, 0.60, 1.0, 100)$.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientifically Grounded**: The problem is based on a simplified one-dimensional energy balance model, which is a standard and well-established tool in climate and planetary science for first-order analysis. The physics of diffusion and blackbody radiation are fundamental. The problem is scientifically sound.\n-   **Well-Posed**: The problem asks for the solution to a second-order ordinary differential equation with periodic boundary conditions. The linearization transforms it into a linear ODE, which is well-posed and guarantees a unique, stable solution for the temperature perturbation.\n-   **Objective**: The language is precise and quantitative. All terms are defined, and the task is specified without ambiguity.\n-   **Completeness**: All necessary parameters, constants, and assumptions required to derive and compute the solution are provided. The problem is self-contained.\n-   **Consistency**: The givens are internally consistent. The linearization assumption ($|\\theta| \\ll T_0$) is physically reasonable for many exoplanet scenarios and enables an analytic solution as requested.\n\n### Step 3: Verdict and Action\n\nThe problem statement is **valid**. It is scientifically grounded, well-posed, and all necessary information is provided to derive and implement a solution. I will proceed with the derivation and implementation.\n\n## Derivation of the Temperature Distribution $T(\\phi)$\n\nThe derivation proceeds in several steps: determining the mean temperature, linearizing the governing equation, solving the resulting perturbation equation, and constructing the final solution.\n\n### Step 1: Define Global-Mean Temperature $T_0$\nThe problem states that the global-mean temperature $T_0$ is defined by the mean energy balance. We obtain the mean balance by averaging the governing equation over the domain $\\phi \\in [-\\pi, \\pi]$. The integral of the diffusion term over a periodic domain is zero:\n$$ \\int_{-\\pi}^{\\pi} D \\frac{d^2 T}{d\\phi^2} d\\phi = D \\left[\\frac{dT}{d\\phi}\\right]_{-\\pi}^{\\pi} = 0 $$\nThe mean of the absorbed power $Q(\\phi)$ is:\n$$ \\langle Q(\\phi) \\rangle = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} Q_0 \\left[1 + s \\cos\\left(\\phi - \\phi_s\\right)\\right] d\\phi = Q_0 $$\nFor a planet with a uniform temperature $T_0$, the outgoing radiation is $\\epsilon \\sigma T_0^4$. Equating the mean absorbed power to this outgoing radiation gives the definition of $T_0$:\n$$ Q_0 = \\epsilon \\sigma T_0^4 $$\nFrom this, we can solve for $T_0$:\n$$ T_0 = \\left(\\frac{Q_0}{\\epsilon \\sigma}\\right)^{1/4} $$\n\n### Step 2: Linearize the Radiative Cooling Term\nWe express the temperature as a sum of the mean temperature $T_0$ and a small perturbation $\\theta(\\phi)$, where $|\\theta| \\ll T_0$:\n$$ T(\\phi) = T_0 + \\theta(\\phi) $$\nThe radiative cooling term $\\epsilon \\sigma T^4$ is linearized using a first-order Taylor expansion around $T = T_0$:\n$$ \\epsilon \\sigma T(\\phi)^4 = \\epsilon \\sigma (T_0 + \\theta)^4 = \\epsilon \\sigma T_0^4 \\left(1 + \\frac{\\theta}{T_0}\\right)^4 $$\nFor $|\\theta/T_0| \\ll 1$, we can use the binomial approximation $(1+x)^n \\approx 1+nx$:\n$$ \\epsilon \\sigma T(\\phi)^4 \\approx \\epsilon \\sigma T_0^4 \\left(1 + 4\\frac{\\theta}{T_0}\\right) = \\epsilon \\sigma T_0^4 + 4 \\epsilon \\sigma T_0^3 \\theta $$\n\n### Step 3: Formulate the Perturbation Equation\nSubstitute the expansions for $T(\\phi)$ and $T(\\phi)^4$ back into the original energy balance equation:\n$$ D \\frac{d^2 (T_0 + \\theta)}{d\\phi^2} + Q_0 \\left[1 + s \\cos\\left(\\phi - \\phi_s\\right)\\right] - \\left( \\epsilon \\sigma T_0^4 + 4 \\epsilon \\sigma T_0^3 \\theta \\right) = 0 $$\nSince $T_0$ is a constant, its second derivative is zero, $\\frac{d^2 T_0}{d\\phi^2} = 0$. Using the mean balance relation $Q_0 = \\epsilon \\sigma T_0^4$, we can cancel the constant terms:\n$$ D \\frac{d^2 \\theta}{d\\phi^2} + \\left( Q_0 + Q_0 s \\cos(\\phi - \\phi_s) \\right) - \\left( Q_0 + 4 \\epsilon \\sigma T_0^3 \\theta \\right) = 0 $$\nThis simplifies to the linear, second-order ordinary differential equation for the temperature perturbation $\\theta(\\phi)$:\n$$ D \\frac{d^2 \\theta}{d\\phi^2} - 4 \\epsilon \\sigma T_0^3 \\theta + Q_0 s \\cos(\\phi - \\phi_s) = 0 $$\n\n### Step 4: Incorporate the Transport Efficiency $\\xi$\nThe problem defines $\\xi$ as the dimensionless ratio of diffusion to linearized radiative damping. The diffusion term is $D \\frac{d^2 \\theta}{d\\phi^2}$ and the linearized radiative damping term is $4 \\epsilon \\sigma T_0^3 \\theta$. The ratio of their coefficients is:\n$$ \\xi = \\frac{D}{4 \\epsilon \\sigma T_0^3} $$\nThis parameter $\\xi$ is dimensionless. We can rearrange the perturbation equation as:\n$$ D \\frac{d^2 \\theta}{d\\phi^2} - \\frac{D}{\\xi} \\theta = - Q_0 s \\cos(\\phi - \\phi_s) $$\nDividing by $D$ gives:\n$$ \\frac{d^2 \\theta}{d\\phi^2} - \\frac{1}{\\xi} \\theta = - \\frac{Q_0 s}{D} \\cos(\\phi - \\phi_s) $$\nWe can express the forcing term's amplitude using $\\xi$. Substitute $D = \\xi (4 \\epsilon \\sigma T_0^3)$:\n$$ \\frac{Q_0 s}{D} = \\frac{Q_0 s}{\\xi (4 \\epsilon \\sigma T_0^3)} $$\nUsing $Q_0 = \\epsilon \\sigma T_0^4$, this simplifies to:\n$$ \\frac{(\\epsilon \\sigma T_0^4) s}{\\xi (4 \\epsilon \\sigma T_0^3)} = \\frac{s T_0}{4\\xi} $$\nThe final form of the perturbation equation in terms of $\\xi$ is:\n$$ \\frac{d^2 \\theta}{d\\phi^2} - \\frac{1}{\\xi} \\theta = - \\frac{s T_0}{4\\xi} \\cos(\\phi - \\phi_s) $$\n\n### Step 5: Solve the Linearized ODE\nThis is a non-homogeneous linear ODE. The solution $\\theta(\\phi)$ must be periodic. We seek a particular solution of the form $\\theta_p(\\phi) = A \\cos(\\phi - \\phi_s)$ because the forcing is sinusoidal. Substituting this ansatz into the equation:\nFirst derivative: $\\frac{d\\theta_p}{d\\phi} = -A \\sin(\\phi - \\phi_s)$.\nSecond derivative: $\\frac{d^2\\theta_p}{d\\phi^2} = -A \\cos(\\phi - \\phi_s)$.\nPlugging these into the ODE:\n$$ -A \\cos(\\phi - \\phi_s) - \\frac{1}{\\xi} A \\cos(\\phi - \\phi_s) = - \\frac{s T_0}{4\\xi} \\cos(\\phi - \\phi_s) $$\nFactoring out $\\cos(\\phi - \\phi_s)$:\n$$ -A \\left(1 + \\frac{1}{\\xi}\\right) = - \\frac{s T_0}{4\\xi} $$\n$$ A \\left(\\frac{\\xi + 1}{\\xi}\\right) = \\frac{s T_0}{4\\xi} $$\nSolving for the amplitude $A$:\n$$ A = \\frac{s T_0}{4\\xi} \\cdot \\frac{\\xi}{\\xi + 1} = \\frac{s T_0}{4(1 + \\xi)} $$\nThe homogeneous solution involves exponential terms that are non-periodic, so their coefficients must be zero to satisfy the periodic boundary condition. Thus, the solution is purely the particular solution:\n$$ \\theta(\\phi) = \\frac{s T_0}{4(1 + \\xi)} \\cos(\\phi - \\phi_s) $$\n\n### Step 6: Construct the Final Solution for $T(\\phi)$\nThe full temperature distribution is the sum of the mean and the perturbation:\n$$ T(\\phi) = T_0 + \\theta(\\phi) = T_0 + \\frac{s T_0}{4(1 + \\xi)} \\cos(\\phi - \\phi_s) $$\nFactoring out $T_0$:\n$$ T(\\phi) = T_0 \\left[ 1 + \\frac{s}{4(1 + \\xi)} \\cos(\\phi - \\phi_s) \\right] $$\nwhere $T_0 = \\left(\\frac{Q_0}{\\epsilon \\sigma}\\right)^{1/4}$. This is the final analytical solution for the longitudinal temperature distribution, expressed in terms of the given parameters. The expression is valid under the linearization assumption $|\\theta| \\ll T_0$, which holds if the amplitude $\\frac{s T_0}{4(1+\\xi)}$ is small compared to $T_0$, or $\\frac{s}{4(1+\\xi)} \\ll 1$. Given $0 \\le s < 1$ and $\\xi \\ge 0$, this is generally satisfied.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the steady-state longitudinal temperature distribution of a tidally locked\n    exoplanet based on a linearized 1D energy balance model.\n    \"\"\"\n\n    # Physical Constants\n    # Stefan-Boltzmann constant in W m^-2 K^-4\n    sigma = 5.670374419e-8\n\n    # Test cases: (Q0, epsilon, s, phi_s, xi)\n    # Q0: mean absorbed stellar flux (W m^-2)\n    # epsilon: infrared emissivity (dimensionless)\n    # s: fractional amplitude of forcing (dimensionless, 0 <= s < 1)\n    # phi_s: longitudinal phase shift of forcing (radians)\n    # xi: dimensionless transport efficiency parameter\n    test_cases = [\n        # Case A\n        (900.0, 0.95, 0.25, 0.2, 0.5),\n        # Case B (near-radiative limit)\n        (1200.0, 1.0, 0.10, -0.3, 1e-6),\n        # Case C (strong transport, small contrast)\n        (700.0, 0.90, 0.60, 1.0, 100.0)\n    ]\n\n    # Longitudes (in radians) at which to evaluate the temperature\n    phi_values = [-np.pi, -np.pi / 2.0, 0.0, np.pi / 2.0, np.pi]\n\n    all_results = []\n\n    for case in test_cases:\n        Q0, epsilon, s, phi_s, xi = case\n        \n        # Step 1: Calculate the global-mean temperature T0\n        # The mean energy balance is Q0 = epsilon * sigma * T0^4\n        T0 = (Q0 / (epsilon * sigma))**(1.0 / 4.0)\n        \n        # Step 2: Calculate the amplitude of the temperature perturbation\n        # The perturbation theta(phi) has an amplitude A = (s * T0) / (4 * (1 + xi))\n        amplitude_factor = s / (4.0 * (1.0 + xi))\n        \n        case_temperatures = []\n        for phi in phi_values:\n            # Step 3: Calculate the full temperature T(phi)\n            # T(phi) = T0 * (1 + amplitude_factor * cos(phi - phi_s))\n            cos_term = np.cos(phi - phi_s)\n            temp = T0 * (1.0 + amplitude_factor * cos_term)\n            case_temperatures.append(temp)\n        \n        all_results.append(case_temperatures)\n\n    # Format the output string as per the requirement\n    # e.g., [[T_A1,..,T_A5],[T_B1,..,T_B5],[T_C1,..,T_C5]]\n    # The default string representation of a list is already in the correct format.\n    formatted_results = \",\".join(map(str, all_results))\n    print(f\"[{formatted_results}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "With a model for the atmospheric temperature and pressure, the next step is to understand how radiation propagates through it. The observed spectrum is sculpted by the atmosphere's opacity, which is quantified by the optical depth, $\\tau_{\\tilde{\\nu}}$. This exercise guides you through building a radiative transfer code from the ground up, starting from the principles of hydrostatic equilibrium and the ideal gas law to compute the optical depth through a vertically stratified atmosphere, including the effects of pressure and temperature on spectral line shapes .",
            "id": "4159519",
            "problem": "You are modeling emission spectroscopy and thermal phase curves for a hydrogen-dominated exoplanet atmosphere. For a single absorbing species in a vertically stratified, plane-parallel atmosphere, the optical depth at wavenumber $\\tilde{\\nu}$ is defined by the Beer–Lambert law as the path integral of the absorption coefficient along the line of sight. For a vertical column, assume a nadir geometry so that the path element is $ds = dz$. The optical depth is\n$$\n\\tau_{\\tilde{\\nu}} = \\int \\alpha_{\\tilde{\\nu}}(z)\\,dz,\n$$\nwhere the absorption coefficient is $\\alpha_{\\tilde{\\nu}}(z) = \\sigma_{\\tilde{\\nu}}(P(z),T(z))\\,n_i(z)$, $\\sigma_{\\tilde{\\nu}}$ is the molecular cross-section at the wavenumber $\\tilde{\\nu}$, and $n_i$ is the number density of the absorbing molecule. Let $n_i(z) = X\\,n(z)$ with $X$ the volume mixing ratio (dimensionless), and $n(z)$ the total number density. Use the Ideal Gas Law $n(z) = P(z)/(k_B T(z))$ and hydrostatic equilibrium $dP/dz = -\\rho g$ with $\\rho(z) = \\mu m_H n(z)$, $\\mu$ the mean molecular weight (dimensionless in units of hydrogen mass), $m_H$ the mass of hydrogen, and $g$ the gravitational acceleration. Derive a working expression for $\\tau_{\\tilde{\\nu}}$ in terms of a pressure integral. You must implement a program to compute $\\tau_{\\tilde{\\nu}}$ for a specified wavenumber $\\tilde{\\nu}$, given a discrete pressure–temperature profile and a constant mixing ratio $X$, using a mid-point rule in pressure space for numerical quadrature.\n\nAdopt the following physically plausible parameterization for a single spectral line centered at wavenumber $\\tilde{\\nu}_0$ where the cross-section is modeled as a pressure-broadened Lorentzian with temperature scaling:\n- The cross-section at wavenumber $\\tilde{\\nu}$ is\n$$\n\\sigma_{\\tilde{\\nu}}(P,T) = \\frac{\\sigma_0 \\left(\\frac{T_0}{T}\\right)^{q}}{1 + \\left(\\frac{\\tilde{\\nu} - \\tilde{\\nu}_0}{\\Gamma(P,T)}\\right)^2},\n$$\nwhere $\\sigma_0$ is the reference peak cross-section at temperature $T_0$, $q$ is a dimensionless temperature exponent, and $\\Gamma(P,T)$ is the effective half-width at half-maximum (HWHM).\n- The effective HWHM combines pressure broadening and Doppler broadening additively:\n$$\n\\Gamma(P,T) = \\gamma_0 \\left(\\frac{P}{P_{\\mathrm{ref}}}\\right) + \\gamma_D(T),\n$$\nwhere $\\gamma_0$ is the pressure broadening HWHM at $P_{\\mathrm{ref}} = 10^5\\,\\mathrm{Pa}$, and $\\gamma_D(T)$ is the Doppler HWHM approximated in wavenumber units by\n$$\n\\gamma_D(T) = \\tilde{\\nu}_0 \\sqrt{\\frac{2 \\ln 2\\, k_B T}{m_i c^2}},\n$$\nwith $m_i$ the molecular mass of the absorber, $c$ the speed of light, and all wavenumbers in $\\mathrm{cm}^{-1}$. The use of half-width at half-maximum (HWHM) is explicit here.\n\nGiven constants and profiles:\n- $k_B = 1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$, $m_H = 1.6735575\\times 10^{-27}\\,\\mathrm{kg}$, $c = 2.99792458\\times 10^8\\,\\mathrm{m\\,s^{-1}}$.\n- Gravitational acceleration $g = 21\\,\\mathrm{m\\,s^{-2}}$.\n- Mean molecular weight $\\mu = 2.3$ (hydrogen-dominated atmosphere, dimensionless).\n- Absorber molecular mass $m_i = 18\\,m_H$ (water vapor as the absorber).\n- Line center $\\tilde{\\nu}_0 = 2300\\,\\mathrm{cm^{-1}}$.\n- Pressure broadening parameter $\\gamma_0 = 0.07\\,\\mathrm{cm^{-1}}$ at $P_{\\mathrm{ref}} = 10^5\\,\\mathrm{Pa}$.\n- Doppler broadening as defined above.\n- Temperature scaling parameters $T_0 = 296\\,\\mathrm{K}$, $q = 0.5$.\n- Reference cross-section amplitude $\\sigma_0 = 2.0\\times 10^{-27}\\,\\mathrm{m^2}$.\n\nUse the following discrete pressure–temperature profile, ordered from top-of-atmosphere (lowest pressure) to bottom-of-atmosphere (highest pressure), with pressure in $\\mathrm{Pa}$ and temperature in $\\mathrm{K}$:\n- Pressures $P_i$: $[1, 2, 5, 10, 20, 50, 100, 200, 500, 1000, 2000, 5000, 10^4, 2\\times 10^4, 5\\times 10^4, 10^5]$.\n- Temperatures $T_i$ at corresponding $P_i$: $[900, 920, 960, 1000, 1050, 1100, 1150, 1200, 1250, 1300, 1350, 1400, 1450, 1500, 1600, 1800]$.\n\nTask A (optical depth computation):\n- For each specified wavenumber $\\tilde{\\nu}$ and mixing ratio $X$, compute\n$$\n\\tau_{\\tilde{\\nu}} \\approx \\sum_{j=1}^{N-1} \\left[ \\frac{X}{\\mu m_H g}\\, \\sigma_{\\tilde{\\nu}}(P_{j+\\frac{1}{2}}, T_{j+\\frac{1}{2}})\\, \\Delta P_j \\right],\n$$\nwhere $P_{j+\\frac{1}{2}} = \\frac{1}{2}(P_j + P_{j+1})$, $T_{j+\\frac{1}{2}} = \\frac{1}{2}(T_j + T_{j+1})$, $\\Delta P_j = P_{j+1} - P_j$ (use the absolute value so that $\\Delta P_j > 0$), and $N$ is the number of discrete levels.\n\nTask B (sensitivity analysis):\n- Quantify the sensitivity of $\\tau_{\\tilde{\\nu}}$ to the mixing ratio by the logarithmic derivative approximation\n$$\nS_{\\tilde{\\nu}} \\equiv \\frac{d \\ln \\tau_{\\tilde{\\nu}}}{d \\ln X} \\approx \\frac{\\ln \\tau_{\\tilde{\\nu}}(2X) - \\ln \\tau_{\\tilde{\\nu}}(0.5X)}{\\ln(2X) - \\ln(0.5X)}.\n$$\n\nNumerical and output requirements:\n- Angles do not appear; no angle unit is required.\n- The optical depth $\\tau_{\\tilde{\\nu}}$ is dimensionless. The sensitivity $S_{\\tilde{\\nu}}$ is dimensionless. Report all numbers rounded to six significant figures.\n- Implement the computations in a single program.\n- Test Suite:\n  1. Case 1 (happy path): $\\tilde{\\nu} = 2295\\,\\mathrm{cm^{-1}}$, $X = 5.0\\times 10^{-4}$; compute $\\tau_{\\tilde{\\nu}}$ and $S_{\\tilde{\\nu}}$.\n  2. Case 2 (on line center): $\\tilde{\\nu} = 2300\\,\\mathrm{cm^{-1}}$, $X = 5.0\\times 10^{-4}$; compute $\\tau_{\\tilde{\\nu}}$ and $S_{\\tilde{\\nu}}$.\n  3. Case 3 (wing): $\\tilde{\\nu} = 2310\\,\\mathrm{cm^{-1}}$, $X = 5.0\\times 10^{-4}$; compute $\\tau_{\\tilde{\\nu}}$ and $S_{\\tilde{\\nu}}$.\n  4. Case 4 (boundary, very low abundance): $\\tilde{\\nu} = 2300\\,\\mathrm{cm^{-1}}$, $X = 1.0\\times 10^{-8}$; compute $\\tau_{\\tilde{\\nu}}$ only.\n  5. Case 5 (boundary, high abundance): $\\tilde{\\nu} = 2300\\,\\mathrm{cm^{-1}}$, $X = 1.0\\times 10^{-2}$; compute $\\tau_{\\tilde{\\nu}}$ only.\n- Final Output Format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n[\\tau_{2295}, S_{2295}, \\tau_{2300}, S_{2300}, \\tau_{2310}, S_{2310}, \\tau_{2300}^{X=10^{-8}}, \\tau_{2300}^{X=10^{-2}}]\n$$\nwith each entry rounded to six significant figures.",
            "solution": "The problem statement is scientifically sound, self-contained, and well-posed. All provided equations, constants, and physical scenarios are consistent with established principles of atmospheric physics and radiative transfer. The tasks are clearly defined and the parameters are physically plausible for an exoplanetary atmosphere.\n\nThe core of the problem is to compute the total vertical optical depth, $\\tau_{\\tilde{\\nu}}$, of a specific absorbing species in a plane-parallel atmosphere. We will first derive the expression for $\\tau_{\\tilde{\\nu}}$ as an integral over pressure, then describe its numerical implementation and the calculation of the related sensitivity metric.\n\n**1. Derivation of Optical Depth as a Pressure Integral**\n\nThe optical depth, $\\tau_{\\tilde{\\nu}}$, at a given wavenumber $\\tilde{\\nu}$ is defined by the integral of the absorption coefficient, $\\alpha_{\\tilde{\\nu}}(z)$, along the vertical path $z$:\n$$\n\\tau_{\\tilde{\\nu}} = \\int_{z_{top}}^{z_{bottom}} \\alpha_{\\tilde{\\nu}}(z)\\,dz\n$$\nThe absorption coefficient is given as $\\alpha_{\\tilde{\\nu}}(z) = \\sigma_{\\tilde{\\nu}}(P(z),T(z))\\,n_i(z)$, where $\\sigma_{\\tilde{\\nu}}$ is the absorption cross-section and $n_i(z)$ is the number density of the absorbing species. The number density of the absorber is related to the total number density $n(z)$ by the volume mixing ratio $X$, such that $n_i(z) = X n(z)$.\n\nUsing the Ideal Gas Law, the total number density is $n(z) = P(z) / (k_B T(z))$, where $P(z)$ is the pressure, $T(z)$ is the temperature, and $k_B$ is the Boltzmann constant. Substituting these relations into the optical depth integral gives:\n$$\n\\tau_{\\tilde{\\nu}} = \\int_{z_{top}}^{z_{bottom}} \\sigma_{\\tilde{\\nu}}(P(z), T(z)) X \\frac{P(z)}{k_B T(z)}\\,dz\n$$\nTo transform this into an integral over pressure, we use the equation of hydrostatic equilibrium:\n$$\n\\frac{dP}{dz} = -\\rho(z) g\n$$\nwhere $g$ is the gravitational acceleration and $\\rho(z)$ is the atmospheric mass density. The density is given by $\\rho(z) = \\mu m_H n(z)$, where $\\mu$ is the mean molecular weight (in units of hydrogen mass) and $m_H$ is the mass of a hydrogen atom. Substituting the Ideal Gas Law for $n(z)$ into the density expression yields $\\rho(z) = \\mu m_H P(z) / (k_B T(z))$.\n\nThe hydrostatic equilibrium equation becomes:\n$$\n\\frac{dP}{dz} = -\\frac{\\mu m_H g P(z)}{k_B T(z)}\n$$\nFrom this, we can express the path element $dz$ in terms of the pressure differential $dP$:\n$$\ndz = -\\frac{k_B T(z)}{\\mu m_H g P(z)}\\,dP\n$$\nSubstituting this expression for $dz$ into the integral for $\\tau_{\\tilde{\\nu}}$:\n$$\n\\tau_{\\tilde{\\nu}} = \\int_{P(z_{top})}^{P(z_{bottom})} \\sigma_{\\tilde{\\nu}}(P, T) X \\frac{P}{k_B T} \\left(-\\frac{k_B T}{\\mu m_H g P}\\,dP\\right)\n$$\nThe terms $P$, $k_B$, and $T$ cancel out. The negative sign in the differential reverses the limits of integration. Assuming the integration path is from the top of the atmosphere ($P_{top}$) to the bottom ($P_{bottom}$):\n$$\n\\tau_{\\tilde{\\nu}} = \\int_{P_{top}}^{P_{bottom}} \\frac{X \\sigma_{\\tilde{\\nu}}(P, T)}{\\mu m_H g} dP\n$$\nThis is the desired working expression for optical depth as an integral over pressure. The mixing ratio $X$, mean molecular weight $\\mu$, hydrogen mass $m_H$, and gravity $g$ are assumed to be constant throughout the atmospheric column.\n\n**2. Numerical Quadrature**\n\nThe problem provides a discrete pressure-temperature ($P-T$) profile with $N$ levels, $(P_j, T_j)$ for $j=1, \\dots, N$, ordered from lowest to highest pressure. The integral is approximated using a midpoint rule for numerical quadrature, summing the contributions from each atmospheric layer defined by two adjacent pressure levels. The optical depth for the layer between pressures $P_j$ and $P_{j+1}$ is approximated as:\n$$\n\\Delta\\tau_j \\approx \\frac{X \\sigma_{\\tilde{\\nu}}(P_{j+\\frac{1}{2}}, T_{j+\\frac{1}{2}})}{\\mu m_H g} (P_{j+1} - P_j)\n$$\nwhere the quantities are evaluated at the midpoints of the layer:\n- Midpoint Pressure: $P_{j+\\frac{1}{2}} = \\frac{1}{2}(P_j + P_{j+1})$\n- Midpoint Temperature: $T_{j+\\frac{1}{2}} = \\frac{1}{2}(T_j + T_{j+1})$\n- Pressure step: $\\Delta P_j = P_{j+1} - P_j$\n\nThe total optical depth is the sum over all $N-1$ layers:\n$$\n\\tau_{\\tilde{\\nu}} \\approx \\sum_{j=1}^{N-1} \\left[ \\frac{X}{\\mu m_H g}\\, \\sigma_{\\tilde{\\nu}}(P_{j+\\frac{1}{2}}, T_{j+\\frac{1}{2}})\\, \\Delta P_j \\right]\n$$\nThis matches the formula provided in the problem statement, confirming its validity and our derivation.\n\n**3. Cross-Section Calculation**\n\nThe absorption cross-section $\\sigma_{\\tilde{\\nu}}(P, T)$ is modeled as a pressure-broadened Lorentzian profile with a temperature-dependent amplitude:\n$$\n\\sigma_{\\tilde{\\nu}}(P,T) = \\frac{\\sigma_0 \\left(\\frac{T_0}{T}\\right)^{q}}{1 + \\left(\\frac{\\tilde{\\nu} - \\tilde{\\nu}_0}{\\Gamma(P,T)}\\right)^2}\n$$\nHere, $\\sigma_0$, $T_0$, and $q$ are given constants. $\\tilde{\\nu}_0$ is the line-center wavenumber. The key pressure- and temperature-dependent term is the effective half-width at half-maximum (HWHM), $\\Gamma(P,T)$. It is defined as the sum of a pressure-broadened component and a Doppler-broadened component:\n$$\n\\Gamma(P,T) = \\gamma_0 \\left(\\frac{P}{P_{\\mathrm{ref}}}\\right) + \\gamma_D(T)\n$$\nThe pressure broadening HWHM is linear in pressure, scaled by the parameter $\\gamma_0$ at a reference pressure $P_{\\mathrm{ref}}$. The Doppler broadening HWHM, $\\gamma_D(T)$, depends on temperature and is given by:\n$$\n\\gamma_D(T) = \\tilde{\\nu}_0 \\sqrt{\\frac{2 \\ln(2)\\, k_B T}{m_i c^2}}\n$$\nwhere $m_i$ is the molecular mass of the absorbing species and $c$ is the speed of light. The units for all wavenumbers ($\\tilde{\\nu}$, $\\tilde{\\nu}_0$, $\\gamma_0$, $\\gamma_D$, $\\Gamma$) must be consistent, which is specified as $\\mathrm{cm}^{-1}$. All other physical constants are in SI units, and care must be taken in the implementation.\n\n**4. Sensitivity Analysis**\n\nThe sensitivity of the optical depth to the mixing ratio, $S_{\\tilde{\\nu}}$, is defined as the logarithmic derivative:\n$$\nS_{\\tilde{\\nu}} \\equiv \\frac{d \\ln \\tau_{\\tilde{\\nu}}}{d \\ln X}\n$$\nThis is approximated using a centered finite difference scheme:\n$$\nS_{\\tilde{\\nu}} \\approx \\frac{\\ln \\tau_{\\tilde{\\nu}}(2X) - \\ln \\tau_{\\tilde{\\nu}}(0.5X)}{\\ln(2X) - \\ln(0.5X)}\n$$\nThe denominator simplifies to $\\ln(2X) - \\ln(0.5X) = \\ln(4)$. In our model, the cross-section $\\sigma_{\\tilde{\\nu}}$ and other parameters in the integral are independent of the mixing ratio $X$. Therefore, the optical depth $\\tau_{\\tilde{\\nu}}$ is directly proportional to $X$. Let $\\tau_{\\tilde{\\nu}}(X) = C \\cdot X$, where $C$ is the constant of proportionality representing the integral. Then $\\tau_{\\tilde{\\nu}}(2X) = 2CX$ and $\\tau_{\\tilde{\\nu}}(0.5X) = 0.5CX$. The numerator of the sensitivity approximation becomes $\\ln(2CX) - \\ln(0.5CX) = \\ln(2CX / (0.5CX)) = \\ln(4)$.\nThus, the sensitivity evaluates to:\n$$\nS_{\\tilde{\\nu}} \\approx \\frac{\\ln(4)}{\\ln(4)} = 1\n$$\nThis result is exact for the given model because of the linear relationship between $\\tau_{\\tilde{\\nu}}$ and $X$. The numerical implementation of the finite difference formula should yield a value of $1.0$ due to this linearity.\n\n**Computational Algorithm Summary**\n\nThe overall algorithm to compute the required values is as follows:\n1.  Define all physical constants and model parameters.\n2.  Define the discrete pressure-temperature profile arrays.\n3.  For a given test case $(\\tilde{\\nu}, X)$:\n    a. If sensitivity $S_{\\tilde{\\nu}}$ is required, calculate $\\tau_{\\tilde{\\nu}}(2X)$ and $\\tau_{\\tilde{\\nu}}(0.5X)$ and apply the finite difference formula, which will yield $1.0$.\n    b. To calculate $\\tau_{\\tilde{\\nu}}$ for a given $X$:\n        i. Initialize total optical depth $\\tau_{total} = 0$.\n        ii. Loop through the atmospheric layers from $j=1$ to $N-1$.\n        iii. For each layer, calculate $P_{j+\\frac{1}{2}}$, $T_{j+\\frac{1}{2}}$, and $\\Delta P_j$.\n        iv. At the midpoint temperature $T_{j+\\frac{1}{2}}$, compute the Doppler HWHM $\\gamma_D(T_{j+\\frac{1}{2}})$.\n        v. At the midpoint pressure and temperature, compute the total HWHM $\\Gamma(P_{j+\\frac{1}{2}}, T_{j+\\frac{1}{2}})$.\n        vi. Calculate the cross-section $\\sigma_{\\tilde{\\nu}}(P_{j+\\frac{1}{2}}, T_{j+\\frac{1}{2}})$. All wavenumbers in this step are in $\\mathrm{cm}^{-1}$.\n        vii. Calculate the layer's optical depth contribution $\\Delta\\tau_j$ using the derived formula, ensuring all units are consistently SI.\n        viii. Add $\\Delta\\tau_j$ to $\\tau_{total}$.\n    c. After the loop, the final sum is the desired optical depth $\\tau_{\\tilde{\\nu}}$.\n4.  Collect results from all test cases, format them to six significant figures, and print them in the specified comma-separated format.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes optical depth and sensitivity for an exoplanet atmosphere model\n    based on the provided problem description.\n    \"\"\"\n\n    # --- Constants ---\n    K_B = 1.380649e-23  # Boltzmann constant, J K^-1\n    M_H = 1.6735575e-27 # Mass of hydrogen, kg\n    C = 2.99792458e8    # Speed of light, m s^-1\n    G = 21.0            # Gravitational acceleration, m s^-2\n    MU = 2.3            # Mean molecular weight, dimensionless\n    M_I = 18.0 * M_H    # Absorber molecular mass (18 amu for H2O), kg\n\n    # --- Line Parameters ---\n    NU0_CM = 2300.0     # Line center, cm^-1\n    GAMMA0_CM = 0.07    # Pressure broadening HWHM at P_ref, cm^-1\n    P_REF = 1.0e5       # Reference pressure, Pa\n    T0 = 296.0          # Reference temperature for cross-section, K\n    Q = 0.5             # Temperature exponent, dimensionless\n    SIGMA0 = 2.0e-27    # Reference cross-section, m^2\n\n    # --- Pressure-Temperature Profile ---\n    P_profile = np.array([\n        1, 2, 5, 10, 20, 50, 100, 200, 500, 1000, 2000, 5000, 1e4,\n        2e4, 5e4, 1e5\n    ], dtype=float)  # Pa\n\n    T_profile = np.array([\n        900, 920, 960, 1000, 1050, 1100, 1150, 1200, 1250, 1300, 1350,\n        1400, 1450, 1500, 1600, 1800\n    ], dtype=float)  # K\n    \n    # Pre-compute denominator for optical depth calculation\n    tau_denom = MU * M_H * G\n\n    def calculate_tau(nu_cm, X, P, T):\n        \"\"\"\n        Calculates the total vertical optical depth using numerical quadrature.\n\n        Args:\n            nu_cm (float): Wavenumber in cm^-1.\n            X (float): Volume mixing ratio of the absorber.\n            P (np.array): Pressure profile in Pa.\n            T (np.array): Temperature profile in K.\n\n        Returns:\n            float: Total optical depth (dimensionless).\n        \"\"\"\n        total_tau = 0.0\n        \n        tau_prefactor = X / tau_denom\n\n        for j in range(len(P) - 1):\n            # Midpoint values for the layer\n            P_mid = 0.5 * (P[j] + P[j+1])\n            T_mid = 0.5 * (T[j] + T[j+1])\n            dP = P[j+1] - P[j]\n\n            # Doppler broadening HWHM (gamma_D)\n            # All wavenumbers are in cm^-1, as specified.\n            # The argument of sqrt is dimensionless.\n            sqrt_arg = (2 * np.log(2) * K_B * T_mid) / (M_I * C**2)\n            gamma_D_cm = NU0_CM * np.sqrt(sqrt_arg)\n\n            # Effective HWHM (Gamma)\n            gamma_P_cm = GAMMA0_CM * (P_mid / P_REF)\n            Gamma_cm = gamma_P_cm + gamma_D_cm\n\n            # Cross-section (sigma_nu)\n            temp_scaling = (T0 / T_mid)**Q\n            lorentzian_arg = (nu_cm - NU0_CM) / Gamma_cm\n            sigma_nu = (SIGMA0 * temp_scaling) / (1.0 + lorentzian_arg**2)\n\n            # Contribution of the layer to optical depth\n            layer_tau = tau_prefactor * sigma_nu * dP\n            total_tau += layer_tau\n            \n        return total_tau\n\n    def calculate_sensitivity(nu_cm, X, P, T):\n        \"\"\"\n        Calculates the sensitivity S_nu using the finite difference approximation.\n        For this model, tau is linear in X, so S_nu is exactly 1.\n        The calculation is performed as specified by the problem.\n\n        Args:\n            nu_cm (float): Wavenumber in cm^-1.\n            X (float): Volume mixing ratio of the absorber.\n            P (np.array): Pressure profile in Pa.\n            T (np.array): Temperature profile in K.\n\n        Returns:\n            float: The sensitivity S_nu.\n        \"\"\"\n        tau_2X = calculate_tau(nu_cm, 2.0 * X, P, T)\n        tau_0_5X = calculate_tau(nu_cm, 0.5 * X, P, T)\n        \n        # Denominator is log(2X) - log(0.5X) = log(4)\n        if tau_2X <= 0 or tau_0_5X <= 0:\n            return np.nan # Avoid log of non-positive number\n            \n        S_nu = (np.log(tau_2X) - np.log(tau_0_5X)) / np.log(4.0)\n        return S_nu\n\n    # --- Test Suite ---\n    test_cases = [\n        # nu (cm^-1), X, compute_tau, compute_S\n        (2295.0, 5.0e-4, True, True),\n        (2300.0, 5.0e-4, True, True),\n        (2310.0, 5.0e-4, True, True),\n        (2300.0, 1.0e-8, True, False),\n        (2300.0, 1.0e-2, True, False),\n    ]\n\n    results = []\n    \n    # Case 1\n    nu, X, _, _ = test_cases[0]\n    tau1 = calculate_tau(nu, X, P_profile, T_profile)\n    s1 = calculate_sensitivity(nu, X, P_profile, T_profile)\n    results.extend([tau1, s1])\n    \n    # Case 2\n    nu, X, _, _ = test_cases[1]\n    tau2 = calculate_tau(nu, X, P_profile, T_profile)\n    s2 = calculate_sensitivity(nu, X, P_profile, T_profile)\n    results.extend([tau2, s2])\n    \n    # Case 3\n    nu, X, _, _ = test_cases[2]\n    tau3 = calculate_tau(nu, X, P_profile, T_profile)\n    s3 = calculate_sensitivity(nu, X, P_profile, T_profile)\n    results.extend([tau3, s3])\n\n    # Case 4\n    nu, X, _, _ = test_cases[3]\n    tau4 = calculate_tau(nu, X, P_profile, T_profile)\n    results.append(tau4)\n\n    # Case 5\n    nu, X, _, _ = test_cases[4]\n    tau5 = calculate_tau(nu, X, P_profile, T_profile)\n    results.append(tau5)\n\n    # Format results to 6 significant figures\n    formatted_results = [f\"{val:.6g}\" for val in results]\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Ultimately, our models are used to interpret real observations, a process known as atmospheric retrieval. However, the data we receive is a single flux value, and our interpretation is only as good as the physical assumptions in our model. This final practice places you in the role of an observer, tasking you with quantifying how an incomplete forward model—one that neglects the contribution of reflected starlight—can lead to significant systematic biases in the retrieved atmospheric temperature .",
            "id": "4159535",
            "problem": "You will quantify the systematic bias in retrieved exoplanet dayside temperatures when reflected light is neglected in a wavelength band where both stellar residual (leakage) and planetary reflectivity are non-negligible. Work in a forward-model and inversion framework grounded in first principles of radiative transfer.\n\nAssumptions and fundamentals to use:\n- The star and the planet emit thermally as blackbodies. The specific intensity per unit wavelength is given by the Planck law, $B_{\\lambda}(T) = \\dfrac{2 h c^{2}}{\\lambda^{5}} \\left(\\exp\\left(\\dfrac{h c}{\\lambda k_B T}\\right) - 1\\right)^{-1}$, where $h$ is the Planck constant, $c$ is the speed of light, $k_B$ is the Boltzmann constant, $\\lambda$ is the wavelength, and $T$ is the temperature.\n- Consider an instrument with a top-hat spectral response over a closed wavelength interval $[\\lambda_{1}, \\lambda_{2}]$. All integrals over wavelength are to be computed over this interval.\n- Assume full phase (secondary eclipse geometry) so that the Lambertian phase function equals unity and the reflected-light term is maximized on the dayside. Take the geometric albedo $A_{\\mathrm{g}}$ to be spectrally constant across the band.\n- Define the band-integrated thermal planet-to-star flux ratio as a function of a generic planet brightness temperature $T$ by taking the ratio of the band-integrated blackbody emission of the planet and the star, scaled by the projected area ratio. Define the band-integrated reflected-light planet-to-star ratio using geometric albedo at full phase and orbital geometry. Use only these fundamentals and standard geometric definitions to construct the needed expressions; do not introduce any additional empirical shortcuts.\n- Account for stellar leakage as an additive fractional contamination of the measured planet-to-star ratio. Let the leakage fraction $f_{\\mathrm{leak}}$ denote the fraction of the stellar band flux that leaks into the planetary channel. If leakage is uncorrected, add $f_{\\mathrm{leak}}$ to the measured planet-to-star ratio; if corrected, subtract it before retrieval. In all cases, neglect any wavelength dependence of $f_{\\mathrm{leak}}$ within the band.\n- The true observed band-integrated planet-to-star ratio at full phase is the sum of thermal emission and reflected light, plus leakage if uncorrected. A retrieval that neglects reflected light interprets the observed ratio (with or without leakage correction, depending on the scenario) as purely thermal and inverts for a best-fit dayside brightness temperature.\n\nTask:\n- For each provided test case, compute the bias $\\Delta T$ in Kelvin, defined as the difference between the retrieved temperature that ignores reflected light and the true dayside temperature, $\\Delta T = T_{\\mathrm{fit}} - T_{\\mathrm{true}}$.\n- Use physically correct band-integrated expressions derived from the Planck law and geometric reflection at full phase. Numerically integrate over wavelength and numerically invert the monotonic thermal ratio function to obtain $T_{\\mathrm{fit}}$ for a given target ratio.\n- Express each final bias in Kelvin, rounded to one decimal place.\n\nConstants and units:\n- Use $h = 6.62607015 \\times 10^{-34}\\ \\mathrm{J\\ s}$, $c = 2.99792458 \\times 10^{8}\\ \\mathrm{m\\ s^{-1}}$, $k_B = 1.380649 \\times 10^{-23}\\ \\mathrm{J\\ K^{-1}}$.\n- Use the International System of Units (SI) consistently: wavelengths in meters, radii in meters, semi-major axis in meters, temperatures in Kelvin.\n- Adopt $R_{\\odot} = 6.957 \\times 10^{8}\\ \\mathrm{m}$, $R_{\\mathrm{J}} = 7.1492 \\times 10^{7}\\ \\mathrm{m}$, and $1\\ \\mathrm{AU} = 1.495978707 \\times 10^{11}\\ \\mathrm{m}$.\n\nDefinition of measured and modeled ratios for the inversion:\n- Let $I(T) = \\int_{\\lambda_{1}}^{\\lambda_{2}} B_{\\lambda}(T)\\ d\\lambda$ be the band-integrated Planck function. Define the thermal planet-to-star ratio as a function of $T$ using only geometric projection and $I(T)$ and $I(T_{\\star})$, where $T_{\\star}$ is the stellar effective temperature.\n- For full phase and constant $A_{\\mathrm{g}}$ across the band, the band-integrated reflected ratio relative to the star in the same band follows from geometric optics and reduces to a band-independent factor proportional to $A_{\\mathrm{g}}$ and the squared ratio of planetary radius to orbital distance, evaluated at full phase.\n- If leakage is uncorrected, add $f_{\\mathrm{leak}}$ to the total measured ratio before retrieval. If corrected, subtract it prior to retrieval. In the retrieval that neglects reflection, equate the thermal-only model to the chosen observed ratio and invert for $T_{\\mathrm{fit}}$.\n\nTest suite:\nProvide solutions for the following four cases. For each case, compute $\\Delta T$ in Kelvin, rounded to one decimal place.\n\n- Case $1$ (optical, high albedo, uncorrected leakage):\n    - $T_{\\star} = 5772\\ \\mathrm{K}$, $T_{\\mathrm{true}} = 1800\\ \\mathrm{K}$.\n    - $R_{\\mathrm{p}} = 1.0\\ R_{\\mathrm{J}}$, $R_{\\star} = 1.0\\ R_{\\odot}$, $a = 0.025\\ \\mathrm{AU}$.\n    - $\\lambda_{1} = 6.0 \\times 10^{-7}\\ \\mathrm{m}$, $\\lambda_{2} = 8.0 \\times 10^{-7}\\ \\mathrm{m}$.\n    - $A_{\\mathrm{g}} = 0.20$, $f_{\\mathrm{leak}} = 2.0 \\times 10^{-5}$, leakage corrected: false.\n\n- Case $2$ (optical, high albedo, corrected leakage):\n    - Same as Case $1$ except leakage corrected: true.\n\n- Case $3$ (near-infrared, modest albedo, corrected leakage):\n    - $T_{\\star} = 6000\\ \\mathrm{K}$, $T_{\\mathrm{true}} = 1800\\ \\mathrm{K}$.\n    - $R_{\\mathrm{p}} = 1.2\\ R_{\\mathrm{J}}$, $R_{\\star} = 1.0\\ R_{\\odot}$, $a = 0.03\\ \\mathrm{AU}$.\n    - $\\lambda_{1} = 3.0 \\times 10^{-6}\\ \\mathrm{m}$, $\\lambda_{2} = 5.0 \\times 10^{-6}\\ \\mathrm{m}$.\n    - $A_{\\mathrm{g}} = 0.10$, $f_{\\mathrm{leak}} = 0.0$, leakage corrected: true.\n\n- Case $4$ (optical, zero albedo, uncorrected leakage):\n    - $T_{\\star} = 5772\\ \\mathrm{K}$, $T_{\\mathrm{true}} = 1800\\ \\mathrm{K}$.\n    - $R_{\\mathrm{p}} = 1.0\\ R_{\\mathrm{J}}$, $R_{\\star} = 1.0\\ R_{\\odot}$, $a = 0.025\\ \\mathrm{AU}$.\n    - $\\lambda_{1} = 6.0 \\times 10^{-7}\\ \\mathrm{m}$, $\\lambda_{2} = 8.0 \\times 10^{-7}\\ \\mathrm{m}$.\n    - $A_{\\mathrm{g}} = 0.0$, $f_{\\mathrm{leak}} = 2.0 \\times 10^{-5}$, leakage corrected: false.\n\nProgram requirements:\n- Implement numerical wavelength integration and numerical inversion robustly for all cases, adhering to the physical definitions above.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of Cases $1$ through $4$, with each bias rounded to one decimal place in Kelvin (e.g., $[12.3,4.5,6.7,8.9]$).",
            "solution": "The problem requires the quantification of systematic bias in a retrieved exoplanet dayside temperature, where the retrieval model erroneously neglects the contribution of reflected light and potentially mismanages instrumental stellar leakage. The bias, denoted as $\\Delta T$, is the difference between the fitted temperature $T_{\\mathrm{fit}}$ and the true temperature $T_{\\mathrm{true}}$. The analysis is performed within a framework of first principles of radiative transfer for a planet observed at full phase.\n\nThe foundational principle for thermal emission is the Planck law, which describes the specific intensity $B_{\\lambda}(T)$ of a blackbody at temperature $T$ as a function of wavelength $\\lambda$:\n$$B_{\\lambda}(T) = \\frac{2 h c^{2}}{\\lambda^{5}} \\left(\\exp\\left(\\frac{h c}{\\lambda k_B T}\\right) - 1\\right)^{-1}$$\nwhere $h$ is the Planck constant, $c$ is the speed of light, and $k_B$ is the Boltzmann constant. For an instrument with a top-hat response over the wavelength interval $[\\lambda_{1}, \\lambda_{2}]$, the relevant quantity is the band-integrated radiance, $I(T)$, given by:\n$$I(T) = \\int_{\\lambda_{1}}^{\\lambda_{2}} B_{\\lambda}(T) d\\lambda$$\nThis integral is computed numerically.\n\nThe true astrophysical signal from the planet, expressed as a ratio to the stellar flux in the same band, has two components: thermal emission and reflected starlight.\n\n1.  **Thermal Emission Flux Ratio ($f_{\\mathrm{th}}$)**: This is the ratio of the planet's thermally emitted flux to the star's flux. For a spherical planet and star, this is the ratio of their band-integrated radiances scaled by their projected areas:\n    $$f_{\\mathrm{th}}(T) = \\left(\\frac{R_{\\mathrm{p}}}{R_{\\star}}\\right)^2 \\frac{I(T)}{I(T_{\\star})}$$\n    Here, $R_{\\mathrm{p}}$ is the planetary radius, $R_{\\star}$ is the stellar radius, and $T_{\\star}$ is the stellar effective temperature. The true thermal ratio uses the true planetary temperature, $T_{\\mathrm{true}}$.\n\n2.  **Reflected Light Flux Ratio ($f_{\\mathrm{refl}}$)**: At full phase, for a planet with a constant geometric albedo $A_{\\mathrm{g}}$ over the bandpass, the reflected light ratio is given by the standard geometric formula:\n    $$f_{\\mathrm{refl}} = A_{\\mathrm{g}} \\left(\\frac{R_{\\mathrm{p}}}{a}\\right)^2$$\n    where $a$ is the semi-major axis of the planet's orbit.\n\nThe true, total planet-to-star flux ratio is the sum of these two components:\n$$F_{\\mathrm{true}} = f_{\\mathrm{th}}(T_{\\mathrm{true}}) + f_{\\mathrm{refl}}$$\n\nAn instrument measures this astrophysical signal plus an additional contribution from stellar leakage, $f_{\\mathrm{leak}}$. The total instrumental signal is $F_{\\mathrm{instrument}} = F_{\\mathrm{true}} + f_{\\mathrm{leak}}$. The observer then processes this measurement to obtain a target ratio, $F_{\\mathrm{target}}$, to be used in the retrieval.\n- If leakage is not corrected, the observer mistakes the entire instrumental signal for the planet's signal: $F_{\\mathrm{target}} = F_{\\mathrm{instrument}} = f_{\\mathrm{th}}(T_{\\mathrm{true}}) + f_{\\mathrm{refl}} + f_{\\mathrm{leak}}$.\n- If leakage is corrected, the observer subtracts the known leakage value: $F_{\\mathrm{target}} = F_{\\mathrm{instrument}} - f_{\\mathrm{leak}} = f_{\\mathrm{th}}(T_{\\mathrm{true}}) + f_{\\mathrm{refl}}$.\n\nThe core of the problem lies in the inversion process. The observer uses a retrieval model that is incomplete; it assumes the entire signal is thermal and neglects the reflected light component, $f_{\\mathrm{refl}}$. The model is thus:\n$$F_{\\mathrm{model}}(T) = f_{\\mathrm{th}}(T) = \\left(\\frac{R_{\\mathrm{p}}}{R_{\\star}}\\right)^2 \\frac{I(T)}{I(T_{\\star})}$$\nThe retrieved temperature, $T_{\\mathrm{fit}}$, is the temperature that makes this model match the target ratio:\n$$f_{\\mathrm{th}}(T_{\\mathrm{fit}}) = F_{\\mathrm{target}}$$\nSubstituting the expression for $f_{\\mathrm{th}}$ and rearranging, we obtain the equation to be solved for $T_{\\mathrm{fit}}$:\n$$I(T_{\\mathrm{fit}}) = F_{\\mathrm{target}} \\cdot I(T_{\\star}) \\cdot \\left(\\frac{R_{\\star}}{R_{\\mathrm{p}}}\\right)^2$$\nSince $I(T)$ is a monotonically increasing function of $T$, this equation has a unique solution. We find $T_{\\mathrm{fit}}$ by numerically inverting this relationship, which is practically achieved by finding the root of the function $g(T) = I(T) - I_{\\mathrm{target}}$, where $I_{\\mathrm{target}}$ is the right-hand side of the equation above. A numerical root-finding algorithm, such as Brent's method, is suitable for this task.\n\nOnce $T_{\\mathrm{fit}}$ is determined, the temperature bias is calculated as:\n$$\\Delta T = T_{\\mathrm{fit}} - T_{\\mathrm{true}}$$\nThis procedure is applied to each test case, using the provided parameters and physical constants converted to SI units, to find the corresponding temperature bias.",
            "answer": "```python\nimport numpy as np\nfrom scipy import integrate, optimize\n\ndef solve():\n    \"\"\"\n    Calculates the systematic temperature bias in exoplanet retrievals\n    when reflected light and stellar leakage are accounted for in different ways.\n    \"\"\"\n\n    # Physical and astronomical constants in SI units\n    H = 6.62607015e-34  # Planck constant (J s)\n    C = 2.99792458e8    # Speed of light (m/s)\n    KB = 1.380649e-23   # Boltzmann constant (J/K)\n    R_SUN = 6.957e8     # Solar radius (m)\n    R_JUP = 7.1492e7    # Jupiter radius (m)\n    AU = 1.495978707e11 # Astronomical Unit (m)\n\n    # Pre-calculated constants for Planck's law\n    C1 = 2 * H * C**2\n    C2 = H * C / KB\n\n    def B_lambda(wav, T):\n        \"\"\"Planck's law for blackbody specific intensity per unit wavelength.\"\"\"\n        if T <= 0:\n            return 0.0\n        # The argument to exp can be large, but np.exp handles it.\n        val = C2 / (wav * T)\n        # Avoid overflow for very large val, where exp(val)-1 -> exp(val)\n        if val > 700: # np.exp(709) is ~inf.\n            return C1 / (wav**5 * np.exp(val))\n        return C1 / (wav**5 * (np.exp(val) - 1))\n\n    # Using a cache to memoize the expensive integration\n    integration_cache = {}\n    def I_band(T, lambda1, lambda2):\n        \"\"\"Band-integrated Planck function.\"\"\"\n        if T <= 0:\n            return 0.0\n        cache_key = (T, lambda1, lambda2)\n        if cache_key in integration_cache:\n            return integration_cache[cache_key]\n\n        result, _ = integrate.quad(B_lambda, lambda1, lambda2, args=(T,))\n        integration_cache[cache_key] = result\n        return result\n\n    def calculate_bias(params):\n        \"\"\"\n        Calculates the temperature bias for a single test case.\n        \"\"\"\n        # Clear cache for each new case to avoid mixing parameters\n        integration_cache.clear()\n        \n        # Unpack parameters\n        T_star = params['T_star']\n        T_true = params['T_true']\n        R_p_norm = params['R_p']\n        R_star_norm = params['R_star']\n        a_norm = params['a']\n        lambda1 = params['lambda1']\n        lambda2 = params['lambda2']\n        A_g = params['A_g']\n        f_leak = params['f_leak']\n        leakage_corrected = params['leakage_corrected']\n\n        # Convert parameters to SI units\n        R_p = R_p_norm * R_JUP\n        R_star = R_star_norm * R_SUN\n        a = a_norm * AU\n\n        # Calculate constant terms for this case\n        I_star_val = I_band(T_star, lambda1, lambda2)\n        Rp_Rs_sq = (R_p / R_star)**2\n\n        # 1. Calculate the 'true' planet-to-star flux ratio components\n        I_p_true_val = I_band(T_true, lambda1, lambda2)\n        f_th_true = Rp_Rs_sq * (I_p_true_val / I_star_val)\n        f_refl = A_g * (R_p / a)**2\n\n        # 2. Determine the target flux ratio for the flawed inversion\n        processed_ratio = f_th_true + f_refl\n        if not leakage_corrected:\n            processed_ratio += f_leak\n\n        # 3. Invert for T_fit using the flawed thermal-only model\n        # The model is f_th(T_fit) = processed_ratio\n        # This implies I(T_fit) = target_I\n        target_I = processed_ratio * I_star_val / Rp_Rs_sq\n\n        def root_function(T):\n            \"\"\"Function whose root is T_fit: I(T) - target_I = 0\"\"\"\n            return I_band(T, lambda1, lambda2) - target_I\n\n        # Find T_fit using a numerical root-finder (Brent's method)\n        # A broad search interval [10 K, 20000 K] is safe.\n        try:\n            T_fit = optimize.brentq(root_function, 10, 20000)\n        except ValueError:\n            # This would occur if the root isn't bracketed,\n            # which implies target_I is outside the range of I(T) for T in [10, 20000].\n            # This shouldn't happen for the given test cases.\n            return float('nan')\n\n        # 4. Calculate the bias\n        delta_T = T_fit - T_true\n        return delta_T\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        { # Case 1\n            'T_star': 5772, 'T_true': 1800, 'R_p': 1.0, 'R_star': 1.0, 'a': 0.025,\n            'lambda1': 6.0e-7, 'lambda2': 8.0e-7, 'A_g': 0.20, 'f_leak': 2.0e-5,\n            'leakage_corrected': False\n        },\n        { # Case 2\n            'T_star': 5772, 'T_true': 1800, 'R_p': 1.0, 'R_star': 1.0, 'a': 0.025,\n            'lambda1': 6.0e-7, 'lambda2': 8.0e-7, 'A_g': 0.20, 'f_leak': 2.0e-5,\n            'leakage_corrected': True\n        },\n        { # Case 3\n            'T_star': 6000, 'T_true': 1800, 'R_p': 1.2, 'R_star': 1.0, 'a': 0.03,\n            'lambda1': 3.0e-6, 'lambda2': 5.0e-6, 'A_g': 0.10, 'f_leak': 0.0,\n            'leakage_corrected': True\n        },\n        { # Case 4\n            'T_star': 5772, 'T_true': 1800, 'R_p': 1.0, 'R_star': 1.0, 'a': 0.025,\n            'lambda1': 6.0e-7, 'lambda2': 8.0e-7, 'A_g': 0.0, 'f_leak': 2.0e-5,\n            'leakage_corrected': False\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        bias = calculate_bias(case)\n        # Round the result to one decimal place\n        results.append(round(bias, 1))\n    \n    # Print the final output in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}