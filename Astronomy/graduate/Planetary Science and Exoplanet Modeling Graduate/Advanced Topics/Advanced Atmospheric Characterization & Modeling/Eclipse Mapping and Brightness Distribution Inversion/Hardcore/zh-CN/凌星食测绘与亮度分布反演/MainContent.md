## 引言
直接对遥远的系外行星进行成像并绘制其表面特征，是现代天文学面临的最大挑战之一。然而，通过分析行星经过其主星背后时（即“日食”或次级掩食）产生的微弱光度变化，科学家们发展出一种强大的间接成像技术——日食填图（Eclipse Mapping）。这项技术的核心，是从一维的时序光变曲线中重建出二维的行星亮度分布图，从而为我们打开一扇窥探遥远世界大气物理与气候的窗口。本文旨在系统性地阐述日食填图的理论与实践，解决从模糊的积分信号中恢复精确空间信息的关键难题。在接下来的内容中，读者将首先在“原理与机制”一章中深入学习构建[正向模型](@entry_id:148443)、理解[逆问题](@entry_id:143129)的[不适定性](@entry_id:635673)，并掌握正则化和贝叶斯推断等核心求解方法。随后，在“应用与跨学科联系”一章，我们将探索该技术在揭示[系外行星大气](@entry_id:161942)动力学、能量平衡等方面的具体应用，并讨论其与相位相曲线分析及其他成像科学的协同作用。最后，“动手实践”部分将提供三个精心设计的计算问题，帮助读者将理论知识转化为解决实际问题的能力。

## 原理与机制

本章在前一章介绍性概述的基础上，深入探讨日食填图（Eclipse Mapping）的核心物理原理和数学机制。我们的目标是建立一个从观测到的光变曲线到行星亮度分布的严谨映射。我们将首先构建“[正向模型](@entry_id:148443)”，即如何从一个已知的行星亮度图预测其日食光变曲线。然后，我们将探讨“[逆问题](@entry_id:143129)”的内在挑战，特别是其不适定性（ill-posedness）和信息内容的局限性。最后，我们将系统地阐述用于克服这些挑战的[正则化方法](@entry_id:150559)和[贝叶斯推断](@entry_id:146958)框架。

### 正向模型：从行星图谱到光变曲线

[正向模型](@entry_id:148443)是任何反演技术的基础。它精确地描述了物理系统如何将我们希望了解的未知量（行星亮度图）转换为我们能够观测到的数据（时序光度）。

#### [辐射度](@entry_id:156534)学基础

从第一性原理出发，一个遥远、空间不可分辨的源在观测者处产生的[频谱](@entry_id:276824)通量 $F_\nu$ 是对其在天空平面上可见部分的特定强度 $I_\nu$ 进行积分得到的。特定强度 $I_\nu$ 定义为单位时间、单位面积、单位[立体角](@entry_id:154756)、单位频率间隔内辐射的能量。对于一个行星源，其接收到的通量是对其在天空中所张的[立体角](@entry_id:154756) $\Omega$ 进行的积分：

$F_\nu = \int_{\text{源}} I_\nu d\Omega$

一个微小的立体角元 $d\Omega$ 对应于源上一个在天空平面上的投影[面积元](@entry_id:263205) $dA_{\perp}$，其关系为 $d\Omega = dA_{\perp} / d^2$，其中 $d$ 是观测者到源的距离。如果我们建立一个以行星盘面中心为原点的天空平面坐标系 $(x,y)$，并将坐标单位归一化为行星半径 $R_p$，那么物理投影[面积元](@entry_id:263205) $dA_{\perp}$ 可以表示为 $dA_{\perp} = (R_p dx)(R_p dy) = R_p^2 dx dy$。

因此，来自这个[面积元](@entry_id:263205)的通量贡献 $dF_\nu$ 为：

$dF_\nu = I_\nu(x,y) d\Omega = I_\nu(x,y) \frac{R_p^2}{d^2} dx dy$

这里，$I_\nu(x,y)$ 是从行星表面上投影到天空坐标 $(x,y)$ 的点的出射特定强度。在日食过程中，恒星会遮蔽行星的一部分。为了计算被遮蔽部分所产生的通量损失 $\Delta F_\nu(t)$，我们只需将被遮蔽区域的通量贡献积分起来。

我们可以使用一个遮蔽函数来描述这个过程。例如，假设恒星的边缘在行星盘面上可近似为一条直线 $x \cos\phi_c + y \sin\phi_c = s(t)$，其中 $\phi_c$ 是一个固定的方向，而 $s(t)$ 是一个随时间 $t$ 单调变化的函数。那么，被遮蔽的区域满足 $x \cos\phi_c + y \sin\phi_c \ge s(t)$。我们可以利用亥维赛德[阶跃函数](@entry_id:159192) $\Theta(\cdot)$ 将这个积分限制在被遮蔽的区域内。于是，在时刻 $t$ 被遮蔽的总通量可以写成一个在整个行星盘面（即 $x^2 + y^2 \le 1$）上的二维积分 ：

$\Delta F_\nu(t) = \frac{R_p^2}{d^2} \iint_{x^2 + y^2 \le 1} I_\nu(x,y) \Theta(x \cos\phi_c + y \sin\phi_c - s(t)) dx dy$

这个公式是日食填图最基本的[正向模型](@entry_id:148443)之一，它将行星盘面上的二维亮度分布 $I_\nu(x,y)$ 与一维的时间序列光变曲线 $\Delta F_\nu(t)$ 联系起来。

#### 日食核函数

为了更通用地表述这个问题，我们可以从行星的球体坐标系 $(\theta, \phi)$ 出发，其中 $\theta$ 是纬度，$\phi$ 是经度。一个表[面积元](@entry_id:263205) $dA$ 在观测者视线方向上的投影面积为 $dA_{\perp} = dA (\mathbf{n} \cdot \hat{\mathbf{k}})$，其中 $\mathbf{n}$ 是该表[面积元](@entry_id:263205)的法向量，$\hat{\mathbf{k}}$ 是指向观测者的[单位向量](@entry_id:165907)。点积 $\mathbf{n} \cdot \hat{\mathbf{k}}$ 是[出射角](@entry_id:264341)的余弦，通常记为 $\mu$。只有当 $\mu > 0$ 时，该表[面积元](@entry_id:263205)才朝向观测者。

考虑到这一点，以及恒星的遮蔽效应，在时刻 $t$ 观测到的总行星通量 $F_p(t)$ 可以表示为对整个行星球面 $\mathbb{S}^2$ 的积分 ：

$F_p(t) = \frac{R_p^2}{d^2} \int_{\mathbb{S}^2} I(\theta, \phi) \max\{0, \mu(\theta, \phi, t)\} O(\theta, \phi, t) d\Omega$

这里，$I(\theta, \phi)$ 是行星表面的亮度分布，$d\Omega$ 是立体角元，$O(\theta, \phi, t)$ 是一个二元遮蔽函数，当表面元可见且未被遮蔽时为1，否则为0。

这个积分形式启发我们定义一个**日食核函数**（eclipse kernel）$K(\theta, \phi, t)$ 。这个[核函数](@entry_id:145324)将所有与几何、投影和遮蔽相关的因子都包含在内。于是，正向模型可以简洁地写成一个线性[积分方程](@entry_id:138643)：

$F_p(t) = \int_{\mathbb{S}^2} I(\theta, \phi) K(\theta, \phi, t) d\Omega$

其中，[核函数](@entry_id:145324) $K$ 的定义为：

$K(\theta, \phi, t) = \frac{R_p^2}{d^2} \max\{0, \mu(\theta, \phi, t)\} O(\theta, \phi, t)$

这个核函数 $K$ 是连接未知亮度图 $I$ 和观测数据 $F_p$ 的桥梁。它编码了在特定时刻 $t$，行星表面上每个点 $(\theta, \phi)$ 对总通量的贡献权重。这个权重取决于该点是否在可见半球上、其投影缩减效应（foreshortening）以及它是否被恒星遮挡。

#### 离散化与线性系统

在实际应用中，行星亮度图 $I(\theta, \phi)$ 必须被[参数化](@entry_id:265163)。一个常用的方法是将其在一个有限的基函数集合上展开。例如，我们可以将行星表面划分为 $M$ 个不重叠的像素，每个像素具有恒定的亮度 $x_k$。或者，我们可以使用[球谐函数](@entry_id:178380) $Y_{lm}(\theta, \phi)$ 作为基函数，将亮度[图表示](@entry_id:273102)为这些函数的[线性组合](@entry_id:154743)，系数为 $x_{lm}$。

无论选择哪种基函数，亮度图都可以表示为一个系数向量 $\mathbf{x} \in \mathbb{R}^M$。相应地，观测数据是在 $N$ 个离散时刻 $t_i$ 测得的通量值，构成一个数据向量 $\mathbf{y} \in \mathbb{R}^N$。线性积分方程也随之转化为一个矩阵方程  ：

$\mathbf{y} = \mathbf{A}\mathbf{x} + \boldsymbol{\epsilon}$

其中，$\boldsymbol{\epsilon}$ 是观测噪声。矩阵 $\mathbf{A} \in \mathbb{R}^{N \times M}$ 被称为**设计矩阵**（design matrix）或**[正向算子](@entry_id:1125261)**。它的每一个元素 $A_{ik}$ 都代表了第 $k$ 个基函数（例如，第 $k$ 个像素或第 $k$ 个[球谐函数](@entry_id:178380)）对第 $i$ 个时刻观测通量的贡献。这个贡献是通过对核函数 $K(t_i; \theta, \phi)$ 与第 $k$ 个基函数在整个球面上积分得到的。例如，对于像素基，有：

$A_{ik} = \int_{\text{pixel } k} K(t_i; \theta, \phi) d\Omega$

对于[球谐函数](@entry_id:178380)基，有：

$A_{ik} = \int_{\mathbb{S}^2} Y_k(\theta, \phi) K(t_i; \theta, \phi) d\Omega$

至此，我们将一个复杂的物理过程抽象成了一个标准的线性代数问题：给定矩阵 $\mathbf{A}$ 和数据向量 $\mathbf{y}$，求解未知向量 $\mathbf{x}$。

### [逆问题](@entry_id:143129)：[不适定性](@entry_id:635673)与信息内容

虽然我们已经将问题形式化为一个[线性方程组](@entry_id:148943)，但求解 $\mathbf{x}$ 并非易事。这个[逆问题](@entry_id:143129)是典型的不适定的（ill-posed），这意味着解可能不唯一、不存在或对数据的微小扰动（噪声）极其敏感。

#### 算子的[零空间](@entry_id:171336)

[不适定性](@entry_id:635673)的一个核心来源是[正向算子](@entry_id:1125261) $\mathbf{A}$ 的**[零空间](@entry_id:171336)**（null space）。[零空间](@entry_id:171336)是由所有满足 $\mathbf{A}\mathbf{x}_{\text{null}} = \mathbf{0}$ 的非[零向量](@entry_id:156189) $\mathbf{x}_{\text{null}}$ 构成的。从物理上讲，零空间中的任何亮度图样在光变曲线中都不会产生任何信号。因此，仅凭光变曲线数据，我们永远无法恢复或约束这些图样。

一个简化的“刀锋”模型可以清晰地揭示[零空间](@entry_id:171336)的存在 。假设恒星的边缘像一把笔直的刀锋，以恒定速度 $v$ 沿 $x$ 方向扫过行星盘面。观测到的行星通量 $F(t)$ 的时间导数与沿 $y$ 方向（垂直于扫描方向）积分的亮度剖面 $L(x)$ 成正比：

$\frac{dF}{dt} = v \cdot L(x_e(t)) = v \int_{-\sqrt{R_p^2-x_e^2}}^{\sqrt{R_p^2-x_e^2}} I(x_e(t), y) dy$

这个关系表明，单次扫描只能恢复亮度图沿扫描方向的一维投影。任何对亮度图的扰动 $\delta I(x, y)$，如果其在每个 $x$ 处的弦积分都为零，那么它就位于零空间中。一个明显的例子是，任何关于 $y=0$ 轴线呈奇对称的亮度扰动（即 $\delta I(x, y) = -\delta I(x, -y)$），其弦积分恒为零，因此是完全不可见的。这揭示了日食填图在恢复垂直于轨道运动方向的行星结构时存在固有的局限性。

#### 观测局限性

除了固有的[零空间](@entry_id:171336)，其他因素也限制了我们能恢复的信息。

- **有限的曝光时间**：实际观测总是在有限的曝光时间 $\Delta t$ [内积](@entry_id:750660)分光子。这相当于对理想的瞬时光变曲线进行了一次时间平滑。在“刀锋”模型中，这会导致恢复出的亮度剖面 $L(x)$ 被一个宽度为 $v \Delta t$ 的空间核函数模糊化，从而限制了沿扫描方向的空间分辨率 。

- **观测噪声**：所有测量都不可避免地受到噪声的影响。主要噪声源包括[光子散粒噪声](@entry_id:1129630)（服从泊松分布）、探测器[读出噪声](@entry_id:900001)（通常为高斯分布）以及与仪器状态相关的时序[相关噪声](@entry_id:137358)（系统误差）。在贝叶斯框架下，这些噪声源的统计特性被编码进一个**噪声协方差矩阵** $\mathbf{C}_\epsilon$ 中。一个精确的[噪声模型](@entry_id:752540)至关重要，它通常包括对角线上的白噪声项（光子噪声和[读出噪声](@entry_id:900001)的方差之和）和非对角线上的[相关噪声](@entry_id:137358)项（通常用[高斯过程](@entry_id:182192)等方法建模） 。噪声的存在意味着我们只能在一定的[置信水平](@entry_id:182309)上确定 $\mathbf{x}$，而不是得到一个完美的解。

#### 基本假设

进行日食填图反演依赖于一系列基本假设，这些假设的有效性决定了最终结果的可信度。批判性地审视这些假设是科学实践的重要一环 。

- **不可或缺的假设**：这类假设是构建整个反演框架的基石。例如，**已知的几何构型**（$\mathsf{G}$）和**模型的线性**（$\mathsf{L}$）。如果不知道恒星在何时遮挡了行星的哪个部分，光变曲线就失去了空间信息。如果物理过程或仪器响应不是线性的，整个 $\mathbf{y} = \mathbf{A}\mathbf{x}$ 的框架就需要被更复杂的非线性模型取代。

- **可经验检验的假设**：这类假设的正确性可以通过分析数据本身或多次观测来检验。例如，**行星亮度图在日食期间不发生变化**（$\mathsf{S}$）。如果行星自转很快或天气变化剧烈，进食和出食的光变曲线（在几何校正后）将不会是简单的镜像，多次日食的观测结果也会不同。同样，**恒星基线通量的稳定性**（$\mathsf{B}$）可以通过分析日食前后的数据来评估。

- **常规但可修正的建模选择**：这类假设是为获得一个具体解而做出的选择，但可以被其他选择替代，而不会破坏整个推断框架。例如，**朗伯发射**（$\mathsf{A}$），即假设特定强度与[出射角](@entry_id:264341)无关。这可以被更复杂的、包含[临边昏暗](@entry_id:157740)或增亮的辐射模型所替代。另一个例子是**正则化先验的选择**（$\mathsf{P}$），我们将在下一节详细讨论。

### 求解[逆问题](@entry_id:143129)：正则化与贝叶斯推断

由于逆问题的[不适定性](@entry_id:635673)，直接求解 $\mathbf{A}\mathbf{x} = \mathbf{y}$（例如通过[矩阵求逆](@entry_id:636005)）会导致解被噪声严重放大，产生大量非物理的振荡。为了得到一个稳定且有意义的解，我们必须引入额外的约束信息，这一过程称为**正则化**（regularization）。

#### 蒂霍诺夫正则化

最常用的一种[正则化方法](@entry_id:150559)是**蒂霍诺夫正则化**（Tikhonov regularization）。它通过最小化一个组合[目标函数](@entry_id:267263) $J(\mathbf{x})$ 来寻找解，该函数不仅惩罚模型与数据的拟合残差，还惩罚解本身的某种范数：

$J(\mathbf{x}) = \lVert \mathbf{y} - \mathbf{A} \mathbf{x} \rVert_{2}^{2} + \lambda \lVert \mathbf{L} \mathbf{x} \rVert_{2}^{2}$

第一项是数据拟合项（$\chi^2$），第二项是正则化项。超参数 $\lambda > 0$ 控制着正则化的强度，平衡了对数据的拟合和对先验约束的遵守。算子 $\mathbf{L}$ 用于定义我们希望惩罚的解的属性。

通过对 $J(\mathbf{x})$ 求关于 $\mathbf{x}$ 的导数并令其为零，可以得到该问题的解析解，它满足如下的**[正规方程](@entry_id:142238)**（normal equations）：

$(\mathbf{A}^{\top} \mathbf{A} + \lambda \mathbf{L}^{\top} \mathbf{L})\hat{\mathbf{x}} = \mathbf{A}^{\top} \mathbf{y}$

这个线性方程组现在是良态的（well-posed），可以稳定地求解得到正则化后的解 $\hat{\mathbf{x}}$。

#### 正则化算子 L 的选择

正则化算子 $\mathbf{L}$ 的选择体现了我们对解的先验期望，不同的 $\mathbf{L}$ 会导出具有不同性质的解 。

- **零阶蒂霍诺夫正则化**（$L=I$）：此时惩罚的是解的 $\ell_2$ 范数本身，$\lVert \mathbf{x} \rVert_2^2$。这倾向于产生一个所有元素都较小的解，即一个整体较暗的图。
- **一阶蒂霍诺夫正则化**（$L \approx \nabla_{\mathbb{S}^2}$）：$\mathbf{L}$ 是一个近似球面梯度的算子。此时惩罚的是解的梯度大小，$\lVert \nabla_{\mathbb{S}^2} \mathbf{x} \rVert_2^2$。这会抑制解中的剧烈变化，从而产生一个**平滑**的亮度图。在球谐函数基下，这相当于对每个模式的系数 $a_{\ell m}$ 乘以一个与 $\ell(\ell+1)$ 成比例的权重。
- **二阶蒂霍诺夫正则化**（$L \approx \Delta_{\mathbb{S}^2}$）：$\mathbf{L}$ 是一个近似球面拉普拉斯算子。此时惩罚的是解的曲率。这会产生比一阶正则化更平滑的解。在球谐函数基下，它对系数的惩罚权重与 $[\ell(\ell+1)]^2$ 成比例。

值得注意的是，在实际的像素网格上实现这些微分算子时，必须正确处理球面的度规因子（例如，高纬度像素的面积较小），否则会导致在极区过度正则化，从而扭曲恢复出的图谱 。

#### 高级正则化：总变分

蒂霍诺夫正则化（基于 $\ell_2$ 范数）虽然能有效抑制噪声，但其“平滑”的特性会模糊图像的尖锐边缘。然而，许多天体物理场景，如[热木星](@entry_id:1126183)上的东移热点，可能具有清晰的边界。在这种情况下，**总变分**（Total Variation, TV）正则化是更优越的选择 。

TV 正则化使用 $\ell_1$ 范数来惩罚解的梯度：

$\mathcal{R}(\mathbf{x}) = \lambda \lVert \nabla_{\mathbb{S}^2} \mathbf{x} \rVert_1$

$\ell_1$ 范数的一个关键特性是它能促进**稀疏性**。在这里，它促进了梯度的[稀疏性](@entry_id:136793)，这意味着它允许在少数地方存在大的梯度（即清晰的边缘），而在大部分区域梯度为零（即平坦的区域）。因此，TV 正则化非常适合恢复由大片近乎均匀的区域和清晰边界构成的“分块常数”图像，这恰好是热点模型的特征。它能够在有效抑制平坦区域噪声的同时，完美地保持热点的锐利边缘，而这是蒂霍诺夫平滑正则化难以做到的。

#### 贝叶斯推断框架

[正则化方法](@entry_id:150559)可以被更全面、更强大的**[贝叶斯推断](@entry_id:146958)**（Bayesian inference）框架所统一。

在贝叶斯视角下，正则化项 $\lambda \lVert \mathbf{L} \mathbf{x} \rVert_2^2$ 实际上对应于为 $\mathbf{L}\mathbf{x}$ 设定了一个零均值的[高斯先验](@entry_id:749752)概率分布 $p(\mathbf{x})$。最小化蒂霍诺夫目标函数等价于在给定数据 $\mathbf{y}$ 的情况下，寻找具有[最大后验概率](@entry_id:268939)（Maximum A Posteriori, MAP）的解 $\mathbf{x}$ 。

$p(\mathbf{x}|\mathbf{y}) \propto p(\mathbf{y}|\mathbf{x}) p(\mathbf{x})$

其中，$p(\mathbf{y}|\mathbf{x})$ 是[似然函数](@entry_id:921601)，由[噪声模型](@entry_id:752540)决定；$p(\mathbf{x})$ 是先验。对于[高斯噪声](@entry_id:260752)和[高斯先验](@entry_id:749752)，后验概率 $p(\mathbf{x}|\mathbf{y})$ 也是一个高斯分布。其均值就是蒂霍诺夫解 $\hat{\mathbf{x}}$，而其协方差矩阵 $\boldsymbol{\Sigma}_{\text{post}}$ 则量化了恢复出的图谱的不确定性 ：

$\boldsymbol{\mu}_{\text{post}} = \hat{\mathbf{x}} = (\mathbf{A}^\top \mathbf{C}_\epsilon^{-1} \mathbf{A} + \mathbf{C}_0^{-1})^{-1} \mathbf{A}^\top \mathbf{C}_\epsilon^{-1} \mathbf{d}$

$\boldsymbol{\Sigma}_{\text{post}} = (\mathbf{A}^\top \mathbf{C}_\epsilon^{-1} \mathbf{A} + \mathbf{C}_0^{-1})^{-1}$

这里 $\mathbf{C}_\epsilon$ 是[噪声协方差](@entry_id:1128754)，$\mathbf{C}_0$ 是[先验协方差](@entry_id:1130174)（其逆 $\mathbf{C}_0^{-1}$ 对应于正则化矩阵 $\lambda \mathbf{L}^\top \mathbf{L}$）。这个框架不仅给出了“最佳”的图谱，还提供了对该图谱每个特征可靠性的严格量化，这是贝叶斯方法的主要优势。

此外，贝叶斯框架还提供了一个原则性的方法来选择超参数（如 $\lambda$）或比较不同的模型（例如，蒂霍诺夫 vs. 总变分，或不同的球谐函数截断阶数）。这通过计算**边缘[似然](@entry_id:167119)**（marginal likelihood）或**证据**（evidence）$p(\mathbf{y})$ 来实现，该值表示模型对观测数据的整体[拟合优度](@entry_id:176037)，并已对所有可能的图谱 $\mathbf{x}$ 进行了积分。

当使用非[高斯先验](@entry_id:749752)时，例如对应于[TV正则化](@entry_id:756242)的拉普拉斯先验，后验分布通常不再是高斯分布，也没有解析解。但这并不妨碍我们使用数值方法（如[马尔可夫链蒙特卡洛](@entry_id:138779)）来探索后验分布，从而获得解及其不确定性。贝叶斯框架的灵活性和严谨性使其成为现代日食填图及其他天体物理[逆问题](@entry_id:143129)的黄金标准。