## 引言
确定系外行星的发生率——即平均每颗恒星拥有多少颗特定类型的行星——是现代天文学的核心任务之一，它不仅是检验[行星形成](@entry_id:1129732)与演化理论的基石，也为评估生命在宇宙中的普遍性提供了关键背景。然而，从望远镜观测到的原始行星候选体列表到描绘真实行星族群的可靠蓝图，其间充满了复杂的统计挑战和微妙的系统性偏差。简单地计数探测到的行星远不足以回答科学问题，我们必须建立一个严谨的框架来量化并校正这些选择效应。

本文旨在系统性地阐述这一过程。在“原理和机制”一章中，我们将建立估算发生率的统计学基础，并深入探讨如何处理探测不完备性和[假阳性](@entry_id:197064)等核心问题。接下来的“应用与跨学科联系”一章将展示这些原理如何应用于真实世界的科学分析，例如融合不同观测方法的数据、研究行星与主星属性的关联，并指导未来的搜寻策略。最后，“动手实践”部分将提供具体的计算练习，帮助读者将理论知识转化为实践技能。

## 原理和机制

在天体物理学中，量化特定类型天体在给定体积或样本中的丰度是一项基本任务。在系外行星研究中，这项任务表现为确定**行星发生率（occurrence rate）**，即平均每颗恒星拥有多少颗具有特定属性（如半径和[轨道周期](@entry_id:182572)）的行星。这项工作不仅对我们理解行星形成和演化理论至关重要，也为我们在宇宙中寻找生命提供了背景。然而，从原始观测数据到可靠的发生率，这一过程充满了统计学上的挑战和微妙的系统性偏差。本章将系统地阐述估算系外行星发生率的核心原理和关键机制，从基本定义出发，逐步深入到处理真实巡天数据中遇到的复杂问题。

### 行星发生的统计学框架

在量化行星种群时，我们首先需要一个严谨的数学框架来描述行星的分布。我们将行星视为存在于一个由其物理参数定义的空间中的点。最常用的参数是行星半径 $R$ 和[轨道周期](@entry_id:182572) $P$。由于这些参数的取值范围可以跨越多个数量级，使用对数坐标 $(\ln R, \ln P)$ 通常更为自然和方便。

我们将行星的发生建模为一个**非均匀泊松[点过程](@entry_id:1129862)（inhomogeneous Poisson point process）**。在此框架下，我们定义一个**发生率[面密度](@entry_id:1121098)（occurrence rate surface density）**，记为 $f(R, P)$，它描述了在 $(\ln R, \ln P)$ 平面上单位面积内行星的预期数量。这个函数的正式记法是 $f(R, P) = \frac{d^2 N}{d\ln R \, d\ln P}$，单位是“每颗恒星”。

要准确理解 $f(R, P)$ 的含义，关键在于认识到它是一个**[强度函数](@entry_id:755508)（intensity function）**，而非概率密度函数（PDF）。[强度函数](@entry_id:755508)的定义性质是，它在某个区域上的积分给出了该区域内事件（在这里是行星）的**期望数量**。因此，对于 $(\ln R, \ln P)$ 平面上的任意一个区域 $\mathcal{D}$，平均每颗恒星在该区域内拥有的行星数量 $\eta_{\mathcal{D}}$ 由以下积分给出：

$$
\eta_{\mathcal{D}} = \mathbb{E}[N(\mathcal{D})] = \int_{\mathcal{D}} f(R, P) \, d\ln R \, d\ln P
$$

这个积分关系是发生率研究的基石 。由于一颗恒星可以拥有多颗行星，$\eta_{\mathcal{D}}$ 的值可以大于1，因此 $f(R, P)$ 在其整个定义域上的积分（即平均每颗恒星的总行星数）通常也大于1，这与必须归一化为1的概率密度函数有着本质的区别。

一个常见的误解是将发生率与恒星拥有行星的概率混淆。在泊松过程中，一个区域 $\mathcal{D}$ 内的行星数量 $n$ 服从[泊松分布](@entry_id:147769)，其均值为 $\lambda_{\mathcal{D}} = \eta_{\mathcal{D}}$。因此，一颗恒星在区域 $\mathcal{D}$ 内拥有至少一颗行星的概率是 $P(n \ge 1) = 1 - P(n=0) = 1 - \exp(-\lambda_{\mathcal{D}})$。这个概率通常不等于均值 $\lambda_{\mathcal{D}}$ 。

### 从探测到发生率：核心估算问题

理论定义是清晰的，但如何从实际的巡天观测中估算 $f(R, P)$ 呢？原始的行星候选体列表并不能直接反映真实的行星种群，因为它受到了两个主要选择效应的调制：

1.  **探测不完备性（Detection Incompleteness）**：即使一颗行星真实存在，我们的巡天也未必能探测到它。探测概率，即**[探测完备性](@entry_id:1123598)（detection completeness）** $C(R, P)$，取决于行星和恒星的属性，以及巡天的观测策略和数据处理流程。
2.  **候选体验证不完备性（Vetting Incompleteness）**：探测算法产生的候选体信号中，既有真实的行星，也混杂着由仪器噪声或天体物理现象（如[食双星](@entry_id:160550)）引起的**[假阳性](@entry_id:197064)（false positives）**。每个候选体的真实性需要通过验证过程来评估，其为真实行星的后验概率被称为**可靠性（reliability）** $w$。

为了从观测到的候选体中恢复真实的发生率，我们需要对这两种不完备性进行校正。一种稳健的方法是**[逆概率加权](@entry_id:1126661)（inverse-probability weighting）**。我们将参数空间划分为一个个小的矩形单元（bins），每个单元 $(i, j)$ 对应一定的半径和周期范围。我们的目标是估算每个单元内的平均行星数 $\eta_{ij}$。

假设我们对 $N_{\star}$ 颗恒星进行了巡天。对于单元 $(i, j)$，每颗目标恒星 $s$ 都有一个特定的[探测完备性](@entry_id:1123598) $C_{ij}(s)$。巡天在该单元内发现了一组候选体，每个候选体 $k$ 都有一个可靠性权重 $w_k$（例如，$w_k = 1 - \text{FPP}_k$，其中 FPP 是[假阳性](@entry_id:197064)概率）。

在这些定义下，单元 $(i, j)$ 内的行星发生率 $\eta_{ij}$ 的[无偏估计量](@entry_id:756290) $\hat{\eta}_{ij}$ 可以通过以下公式计算 ：

$$
\hat{\eta}_{ij} = \frac{\sum_{k \in \text{bin}(i,j)} w_k}{\sum_{s=1}^{N_{\star}} C_{ij}(s)}
$$

这个估计量的直观解释是：分子 $\sum w_k$ 是探测到的真实行星的期望数量。分母 $\sum C_{ij}(s)$ 是整个巡天中对该单元行星的“有效观测恒星数”。我们将每个可能真实的探测（由 $w_k$ 加权）“放大”，放大的倍数是其被探测到的概率的倒数，从而补偿那些未被探测到的行星。例如，如果一个单元的完备性总和为 $1000$，并且我们在其中发现了 $5$ 个可靠性为 $1.0$ 的行星，那么发生率估计就是 $5 / 1000 = 0.005$ 颗行星/每颗恒星。如果完备性总和为 $0$，意味着巡天对该区域完全不敏感，我们无法给出有意义的估计，通常约定 $\hat{\eta}_{ij} = 0$ 。

### 巡天完备性的表征

上述估计量的准确性严重依赖于我们对完备性 $C(R,P)$ 和可靠性 $w_k$ 的精确了解。

#### [探测完备性](@entry_id:1123598)

[探测完备性](@entry_id:1123598)通常通过**注入-恢复实验（injection-recovery experiments）**来量化。这个过程包括将大量具有已知属性的合成行星凌星信号注入到真实的观测数据（如光变曲线）中，然后运行标准的行星搜寻流程，看有多少比例的注入信号被成功恢复。

探测的成功与否通常与信号的**[信噪比](@entry_id:271861)（Signal-to-Noise Ratio, SNR）** 密切相关。因此，完备性经常被建模为 SNR 的函数。一个广泛使用的模型是S型（sigmoid）函数，例如[逻辑斯谛函数](@entry_id:634233) ：

$$
C(\text{SNR}) = \left[1 + \exp\left(-\frac{\text{SNR} - \theta}{\Delta}\right)\right]^{-1}
$$

这里，$\theta$ 是一个阈值参数，大致对应于完备性达到 $0.5$ 的 SNR 值；$\Delta$ 是一个宽度参数，描述了从低完备性到高完备性过渡的陡峭程度。这些参数可以通过对注入-恢复实验的结果进行**最大似然估计（Maximum Likelihood Estimation, MLE）**来拟合。由于在给定的 SNR 下， $n_i$ 次注入实验中恢复 $k_i$ 次的事件服从[二项分布](@entry_id:141181)，我们可以构建一个二项[似然函数](@entry_id:921601)来找到最能描述数据的 $(\theta, \Delta)$ 值 。

#### 验证完备性与候选体可靠性

验证（vetting）过程旨在区分真实的行星候选体和假阳性。其不完备性体现在两个方面：一些真正的行星可能被错误地排除，而一些假阳性可能被错误地接受。在发生率计算中，我们更关心后者，这通过为每个候选体分配一个可靠性权重 $w_k$ 来处理。

在更精细的模型中，可靠性本身可以被建模为候选体[可观测量](@entry_id:267133)的函数，如[信噪比](@entry_id:271861)和[轨道周期](@entry_id:182572) $r(\text{SNR}, P)$ 。这种连续的可靠性模型允许我们更精确地评估每个候选体对总发生率的贡献。在这种情况下，总的发生率估计可以看作是每个候选体贡献的总和，其中每个候选体的贡献由其可靠性 $r_j$ 和其特定的探测效率（用有效试验次数 $N_{\text{eff}, j}$ 表示）来加权：

$$
\hat{f} = \sum_{j=1}^{K} \frac{r_j}{N_{\text{eff}, j}}
$$

这个公式是之前分仓（binned）估计量的精细化版本，它避免了将属性相近但探测效率可能显著不同的行星放在同一个仓内平均，从而减少了信息损失 。

### 高级主题与系统效应

一个基础的发生率估算框架建立后，我们必须面对一系列更复杂的现实问题和系统效应，它们可能严重扭曲我们的结果。

#### 测量不确定性的传播

行星和其主星的参数测量总伴随着不确定性。例如，[恒星半径](@entry_id:161955) $R_{\star}$ 的不确定性会[直接传播](@entry_id:900345)到行星半径 $R_p = k^{\ast} R_{\star}$ 的计算中（$k^{\ast}$ 是[凌星深度](@entry_id:1133353)比）。这意味着一个被探测到的候选体并非精确地位于 $(R_p, P)$ 平面上的一个点，而是分布在一个概率云中。

因此，将一个候选体“归类”到一个特定的 $(R_p, P)$ 仓内不再是一个非黑即白的决定，而是一个概率问题。我们可以通过将被测参数的[联合高斯](@entry_id:636452)误差分布在仓的边界上积分，来计算该候选体真正属于该仓的**分类概率（classification probability）** $\mathcal{C}$ 。在泊松统计框架下，这个概率 $\mathcal{C}$ 可以被视为该候选体对该仓的“有效计数”。因此，对于单个候选体，发生率的估计变为：

$$
\hat{f} = \frac{\mathcal{C}}{N_{\star} q}
$$

其中 $q$ 是该仓的平均[探测完备性](@entry_id:1123598)。这种方法优雅地将测量不确定性融入了发生率的统计推断中。

#### 未分辨的恒星伴星

许多看似单颗的恒星实际上是未被望远镜分辨开的密近[双星](@entry_id:176254)或多星系统。这是一个主要的系统误差来源，尤其对凌星法探测的小行星有显著影响。其主要效应是**[凌星深度](@entry_id:1133353)稀释（transit depth dilution）**。来自伴星的额外[光通量](@entry_id:167624)使得凌星看起来比实际更浅 。

这种稀释效应导致两种偏差：
1.  **探测损失**：一些行星的[凌星深度](@entry_id:1133353)被稀释到低于探测阈值，导致它们被错过。
2.  **半径误判**：对于那些仍然被探测到的行星，其表观半径 $R_p^{\text{obs}} = R_p / \sqrt{1+\gamma}$（其中 $\gamma$ 是伴星与主星的流量比）会被低估，导致它们被错误地归入更小的半径类别。

这两个效应共同作用，通常会导致对小行星发生率的低估。我们可以通过建立一个模型来量化这种偏差。该模型需要考虑伴星在目标样本中的比例、伴星的质量比（或光度比）分布，以及这些因素如何改变行星的探测和分类边界。通过对伴星属性分布进行积分，可以推导出总体的**偏差因子（bias factor）** $B$，它量化了天真的（忽略伴星的）发生率与真实发生率之间的比例关系 。

#### [轨道离心率](@entry_id:1129190)

为简单起见，发生率研究常假设[行星轨道](@entry_id:179004)是圆形的。然而，许多行星，特别是长周期行星，具有显著的**离心率（eccentricity）** $e$。离心率会影响**几何凌星概率（geometric transit probability）**。

对于给定的[半长轴](@entry_id:164167) $a$，一个偏心轨道的行星，其平均凌星概率为 $\langle P_{\text{tr}} \rangle_e = R_{\star} / (a(1-e^2))$ 。这个概率比[圆形轨道](@entry_id:178728)的情况 $P_{\text{tr, circ}} = R_{\star}/a$ 要高，因为行星在近星点附近运动更快、距离更近，增加了凌星的可能性。

这意味着，如果我们错误地使用[圆形轨道](@entry_id:178728)假设来校正观测数据，我们会高估探测到的偏心轨道行星在总样本中的代表性，从而**高估**真实的发生率。正确的做法是，将基于[圆形轨道](@entry_id:178728)假设得到的发生率乘以一个修正因子 $C(e) = 1-e^2$。对于一个具有特定离心率分布（如Beta分布）的行星种群，总体的修正因子是 $C(e)$ 在该分布下的[期望值](@entry_id:150961)，即 $\langle C \rangle = E[1-e^2]$。对于长周期行星，这个修正可能相当显著，通常会使推断的发生率降低10-20% 。

#### 恒星变异性

恒星自身并非完美稳定的光源。它们的**光球活动（photospheric activity）**，如星斑和耀斑，会在光变曲线中引入**相关的（correlated）**或“红”噪声。这与仪器产生的、不相关的“白”噪声不同。

[相关噪声](@entry_id:137358)会显著影响凌星的探测。一个简单的模型是**[一阶自回归过程](@entry_id:746502)（AR(1)）**。在这种模型下，可以推导出[相关噪声](@entry_id:137358)如何“放大”[凌星深度](@entry_id:1133353)测量的方差。这种方差的**膨胀因子（inflation factor）** $\mathcal{I}$ 会降低给定凌星的真实[信噪比](@entry_id:271861)，从而降低其[探测完备性](@entry_id:1123598) 。

由于不同恒星的活动水平不同，一个更真实的模型需要考虑恒星变异性幅度的分布（例如，对数正态分布）。为了得到对整个恒星样本都适用的鲁棒完备性，我们需要将依赖于恒星变异性的完备性函数，在该变异性分布上进行**[边缘化](@entry_id:264637)（marginalize）**。这通常通过[数值积分](@entry_id:136578)（如[高斯-埃尔米特求积](@entry_id:145090)）来实现，从而得到一个平均的、更现实的完备性曲线 。

### [参数化建模](@entry_id:192148)与贝叶斯推断

前面讨论的分仓方法是一种[非参数估计](@entry_id:897775)。另一种更强大、更具物理洞察力的方法是**[参数化建模](@entry_id:192148)（parametric modeling）**。我们可以假设发生率面密度 $f(R, P)$ 遵循某个函数形式，例如可分离的[幂律模型](@entry_id:272028)：

$$
f(R,P \mid k,\alpha,\beta) = k \left(\frac{R}{R_0}\right)^{\alpha} \left(\frac{P}{P_0}\right)^{\beta}
$$

其中 $k, \alpha, \beta$ 是需要从数据中推断的超参数。

**[分层贝叶斯模型](@entry_id:169496)（Hierarchical Bayesian Models）**为这类问题提供了极其自然的框架。该模型将行星的产生视为一个泊松点过程，其[似然函数](@entry_id:921601)包含两部分：一部分是所有被探测到的行星 $d=1, \dots, N_d$ 处强度的乘积，另一部分是与整个可探测区域上强度积分相关的指数项 ：

$$
\mathcal{L} \propto \left( \prod_{d=1}^{N_d} \lambda(R_d, P_d) \right) \exp\left( - \iint_{\mathcal{D}} \lambda(R, P) \,d\ln R \,d\ln P \right)
$$

其中 $\lambda(R,P) = f(R,P) C(R,P)$ 是探测强度。通过为模型参数 $(k, \alpha, \beta)$ 设置先验分布，我们可以使用[贝叶斯定理](@entry_id:897366)推断它们的[后验分布](@entry_id:145605)。一个巧妙的技巧是，如果为[归一化常数](@entry_id:752675) $k$ 选择一个共轭的Gamma先验，就可以解析地将其[边缘化](@entry_id:264637)，从而大大简化了对幂律指数 $(\alpha, \beta)$ 的推断 。

然而，即使在[参数化](@entry_id:265163)模型中，我们也必须警惕**参数简并性（parameter degeneracy）**。巡天的选择函数（即完备性函数 $C(R,P)$）的特定形式可能导致不同的参数组合产生几乎相同的观测结果，使得它们无法被唯一确定。例如，一个只对满足 $R \propto P^{\gamma}$ 关系的行星敏感的巡天，将无法独立地区分幂律指数 $\alpha$ 和 $\beta$，而只能约束它们的线性组合 $\alpha + \gamma \beta$ 。**[费雪信息矩阵](@entry_id:750640)（Fisher Information Matrix）**是诊断这种简并性的有力工具。如果该[矩阵的行列式](@entry_id:148198)为零，则表明模型参数在该观测设置下是不可辨识的，这是对模型和数据之间复杂相互作用的一个深刻揭示。

总之，估算系外行星的发生率是一个多层次的[统计推断](@entry_id:172747)问题。它要求我们不仅要掌握核心的统计框架，还要对巡天仪器的特性和各种天体物理系统效应有深入的理解和精确的建模。只有这样，我们才能从稀疏的探测信号中，可靠地重构出隐藏在宇宙中的行星蓝图。