{"hands_on_practices": [{"introduction": "Pathogens have evolved numerous strategies to evade the host immune system, with one of the most elegant being the co-opting of the host's own regulatory mechanisms. This exercise explores how a bacterial pathogen can protect itself from the complement system by recruiting Factor H, a key negative regulator of complement activation. By applying fundamental principles of mass-action binding kinetics, you will quantitatively model how enhancing the affinity for Factor H directly translates into reduced complement deposition, providing a clear example of a molecular arms race between host and pathogen [@problem_id:4677573].", "problem": "A Gram-negative bacterial pathogen increases lipooligosaccharide (LOS) sialylation to recruit human complement Factor H (FH), thereby suppressing Complement component 3b (C3b) deposition on its surface. Consider a simple kinetic scheme in which FH binds to a single class of independent LOS sites, denoted by $\\mathrm{S}$, with $1:1$ stoichiometry (one FH per site). Use mass-action equilibrium as the fundamental base. The association constant is defined by $K_{a} = \\frac{k_{\\mathrm{on}}}{k_{\\mathrm{off}}} = \\frac{[\\mathrm{FH}:\\mathrm{S}]}{[\\mathrm{FH}][\\mathrm{S}]}$. Let $[\\mathrm{S}]_{\\mathrm{tot}}$ be the total concentration of LOS sites, $[\\mathrm{FH}]$ the free FH concentration in the surrounding fluid, and $\\theta$ the fraction of LOS sites occupied by FH at equilibrium. Assume $[\\mathrm{FH}]$ is held effectively constant by a large reservoir so that binding does not deplete it.\n\nComplement deposition onto an individual LOS site proceeds with a baseline first-order rate constant $k_{0}$ when the site is unoccupied. When FH is bound, the deposition rate at that site is attenuated to $\\alpha k_{0}$ with a constant attenuation factor $\\alpha \\in [0,1]$ that is independent of $K_{a}$ and $[\\mathrm{FH}]$. The effective deposition rate constant across the surface, $k_{\\mathrm{eff}}$, is the occupancy-weighted average over bound and unbound sites.\n\nBefore sialylation, the FH-LOS association constant is $K_{a,0} = 5.0 \\times 10^{6}\\ \\mathrm{M}^{-1}$. After sialylation, the affinity increases ten-fold to $K_{a,1} = 5.0 \\times 10^{7}\\ \\mathrm{M}^{-1}$. The FH concentration bathing the surface is $[\\mathrm{FH}] = 1.0 \\times 10^{-7}\\ \\mathrm{M}$. The attenuation factor is $\\alpha = 0.05$. Treat $k_{0}$, $K_{a}$, $\\alpha$, and $[\\mathrm{FH}]$ as time-independent constants.\n\nUsing only mass-action equilibrium and the definitions given, derive the closed-form expression for the fractional occupancy $\\theta$ in terms of $K_{a}$ and $[\\mathrm{FH}]$, then express $k_{\\mathrm{eff}}$ in terms of $\\theta$, $k_{0}$, and $\\alpha$. Finally, compute the fold-change $F$ in the effective complement deposition rate constant due to sialylation, defined as\n$$\nF \\equiv \\frac{k_{\\mathrm{eff}}(K_{a,1})}{k_{\\mathrm{eff}}(K_{a,0})}.\n$$\nGive your final numerical value for $F$ rounded to four significant figures. No unit is required in the final answer.", "solution": "The problem is evaluated to be valid. It is scientifically grounded in established principles of biophysical chemistry and immunology, specifically the mass-action kinetics of protein-ligand binding and a simplified model of complement evasion. The problem is well-posed, with all necessary data and definitions provided for a unique solution. The language is objective and the parameters are physically realistic.\n\nThe first task is to derive the closed-form expression for the fractional occupancy of LOS sites, $\\theta$. By definition, $\\theta$ is the ratio of the concentration of occupied sites, $[\\mathrm{FH}:\\mathrm{S}]$, to the total concentration of sites, $[\\mathrm{S}]_{\\mathrm{tot}}$.\n$$\n\\theta = \\frac{[\\mathrm{FH}:\\mathrm{S}]}{[\\mathrm{S}]_{\\mathrm{tot}}}\n$$\nThe total concentration of sites is the sum of free (unoccupied) sites, $[\\mathrm{S}]$, and occupied sites, $[\\mathrm{FH}:\\mathrm{S}]$.\n$$\n[\\mathrm{S}]_{\\mathrm{tot}} = [\\mathrm{S}] + [\\mathrm{FH}:\\mathrm{S}]\n$$\nThe binding is governed by mass-action equilibrium, defined by the association constant $K_{a}$:\n$$\nK_{a} = \\frac{[\\mathrm{FH}:\\mathrm{S}]}{[\\mathrm{FH}][\\mathrm{S}]}\n$$\nFrom this equilibrium expression, we can write the concentration of occupied sites as $[\\mathrm{FH}:\\mathrm{S}] = K_{a}[\\mathrm{FH}][\\mathrm{S}]$. Substituting this into the equation for the total site concentration gives:\n$$\n[\\mathrm{S}]_{\\mathrm{tot}} = [\\mathrm{S}] + K_{a}[\\mathrm{FH}][\\mathrm{S}] = [\\mathrm{S}](1 + K_{a}[\\mathrm{FH}])\n$$\nWe can now express the concentration of free sites, $[\\mathrm{S}]$, in terms of $[\\mathrm{S}]_{\\mathrm{tot}}$:\n$$\n[\\mathrm{S}] = \\frac{[\\mathrm{S}]_{\\mathrm{tot}}}{1 + K_{a}[\\mathrm{FH}]}\n$$\nNow, substitute this expression for $[\\mathrm{S}]$ back into the equation for $[\\mathrm{FH}:\\mathrm{S}]$:\n$$\n[\\mathrm{FH}:\\mathrm{S}] = K_{a}[\\mathrm{FH}] \\left( \\frac{[\\mathrm{S}]_{\\mathrm{tot}}}{1 + K_{a}[\\mathrm{FH}]} \\right)\n$$\nFinally, we substitute this into the definition of $\\theta$:\n$$\n\\theta = \\frac{[\\mathrm{FH}:\\mathrm{S}]}{[\\mathrm{S}]_{\\mathrm{tot}}} = \\frac{K_{a}[\\mathrm{FH}]}{1 + K_{a}[\\mathrm{FH}]}\n$$\nThis is the required closed-form expression for $\\theta$. It is a form of the Langmuir binding isotherm.\n\nThe second task is to express the effective deposition rate constant, $k_{\\mathrm{eff}}$, in terms of $\\theta$, $k_{0}$, and $\\alpha$. The problem states that $k_{\\mathrm{eff}}$ is the occupancy-weighted average of the rate constants for unbound and bound sites. The fraction of unbound sites is $(1 - \\theta)$ with rate constant $k_{0}$, and the fraction of bound sites is $\\theta$ with rate constant $\\alpha k_{0}$.\nThe weighted average is therefore:\n$$\nk_{\\mathrm{eff}} = k_{0}(1 - \\theta) + (\\alpha k_{0})\\theta\n$$\nFactoring out $k_{0}$ gives:\n$$\nk_{\\mathrm{eff}} = k_{0}(1 - \\theta + \\alpha \\theta)\n$$\nThis can be rewritten as:\n$$\nk_{\\mathrm{eff}} = k_{0}(1 - (1 - \\alpha)\\theta)\n$$\nThis is the required expression for $k_{\\mathrm{eff}}$.\n\nThe final task is to compute the fold-change $F$ in the effective complement deposition rate constant due to sialylation. This is defined as:\n$$\nF = \\frac{k_{\\mathrm{eff}}(K_{a,1})}{k_{\\mathrm{eff}}(K_{a,0})}\n$$\nLet $\\theta_{0}$ be the occupancy corresponding to the pre-sialylation association constant $K_{a,0}$, and $\\theta_{1}$ be the occupancy for the post-sialylation constant $K_{a,1}$. Using the expression for $k_{\\mathrm{eff}}$:\n$$\nF = \\frac{k_{0}(1 - (1 - \\alpha)\\theta_{1})}{k_{0}(1 - (1 - \\alpha)\\theta_{0})} = \\frac{1 - (1 - \\alpha)\\theta_{1}}{1 - (1 - \\alpha)\\theta_{0}}\n$$\nWe are given the following values:\n$K_{a,0} = 5.0 \\times 10^{6}\\ \\mathrm{M}^{-1}$\n$K_{a,1} = 5.0 \\times 10^{7}\\ \\mathrm{M}^{-1}$\n$[\\mathrm{FH}] = 1.0 \\times 10^{-7}\\ \\mathrm{M}$\n$\\alpha = 0.05$\n\nFirst, we calculate the dimensionless products $K_{a}[\\mathrm{FH}]$ for both cases:\n$$\nK_{a,0}[\\mathrm{FH}] = (5.0 \\times 10^{6}) \\times (1.0 \\times 10^{-7}) = 0.5\n$$\n$$\nK_{a,1}[\\mathrm{FH}] = (5.0 \\times 10^{7}) \\times (1.0 \\times 10^{-7}) = 5.0\n$$\nNext, we compute the fractional occupancies $\\theta_{0}$ and $\\theta_{1}$:\n$$\n\\theta_{0} = \\frac{K_{a,0}[\\mathrm{FH}]}{1 + K_{a,0}[\\mathrm{FH}]} = \\frac{0.5}{1 + 0.5} = \\frac{0.5}{1.5} = \\frac{1}{3}\n$$\n$$\n\\theta_{1} = \\frac{K_{a,1}[\\mathrm{FH}]}{1 + K_{a,1}[\\mathrm{FH}]} = \\frac{5.0}{1 + 5.0} = \\frac{5.0}{6.0} = \\frac{5}{6}\n$$\nWe also calculate the factor $(1 - \\alpha)$:\n$$\n1 - \\alpha = 1 - 0.05 = 0.95\n$$\nNow, we can substitute these values into the expression for $F$:\n$$\nF = \\frac{1 - (0.95)\\theta_{1}}{1 - (0.95)\\theta_{0}} = \\frac{1 - (0.95)(\\frac{5}{6})}{1 - (0.95)(\\frac{1}{3})}\n$$\nCalculate the numerator and denominator separately:\n$$\n\\text{Numerator} = 1 - \\frac{0.95 \\times 5}{6} = 1 - \\frac{4.75}{6} = \\frac{6 - 4.75}{6} = \\frac{1.25}{6}\n$$\n$$\n\\text{Denominator} = 1 - \\frac{0.95}{3} = \\frac{3 - 0.95}{3} = \\frac{2.05}{3}\n$$\nNow compute the ratio $F$:\n$$\nF = \\frac{\\frac{1.25}{6}}{\\frac{2.05}{3}} = \\frac{1.25}{6} \\times \\frac{3}{2.05} = \\frac{1.25}{2 \\times 2.05} = \\frac{1.25}{4.1}\n$$\nConverting to a numerical value:\n$$\nF = \\frac{1.25}{4.1} \\approx 0.30487804878...\n$$\nRounding to four significant figures as requested gives $0.3049$.", "answer": "$$\\boxed{0.3049}$$", "id": "4677573"}, {"introduction": "While antibodies are a cornerstone of adaptive immunity, their interaction with pathogens can lead to complex, and sometimes counter-intuitive, outcomes. This practice delves into the phenomenon of Antibody-Dependent Enhancement (ADE), where sub-neutralizing concentrations of antibodies can paradoxically increase viral entry into host cells. You will build a model that captures the dual role of antibodies—simultaneously blocking canonical receptor entry and facilitating uptake via Fcγ receptors—to derive the precise conditions that allow for this enhancement [@problem_id:4677543]. This analysis reveals how the balance between different binding affinities and receptor pathways determines the overall outcome of the antibody response.", "problem": "Consider a single-strain enveloped virus capable of entering host cells through two routes: a canonical receptor and the Fragment crystallizable gamma receptor (FcγR). Let the baseline entry rate via the canonical receptor in the absence of antibody be $V_{0}$ (virions per cell per unit time). Assume host immunoglobulin G (IgG) binds the virus with an equilibrium dissociation constant $K_{N}$, and that bound virions are neutralized such that only unbound virions can use the canonical receptor. Under the law of mass action at equilibrium, the fraction of virions unbound by antibody at concentration $C$ is given by the ratio of free ligand to total, based on the definition of the equilibrium dissociation constant. FcγR-mediated uptake occurs when virions are opsonized and is modeled by a saturating binding-uptake function $U(C)$ that increases with $C$ and plateaus at high $C$ due to receptor saturation. Specifically, let\n$$\nU(C) = \\frac{\\alpha\\, C}{K + C},\n$$\nwhere $\\alpha$ is the maximal FcγR-mediated uptake rate and $K$ is the half-saturation constant for FcγR-mediated uptake.\n\nDefine the total viral entry rate in the presence of antibody concentration $C$ as the sum of canonical entry by unbound virions and FcγR-mediated uptake by opsonized virions. Using only fundamental definitions of equilibrium binding and saturating receptor uptake consistent with the above, derive the condition on parameters under which subneutralizing antibody concentrations increase entry relative to $V_{0}$ and derive the exact expression for the smallest positive antibody concentration $C^{*}$ at which the total entry equals the baseline $V_{0}$. Report your final answer as a closed-form analytic expression for $C^{*}$ in terms of $\\alpha$, $K$, $K_{N}$, and $V_{0}$. No numerical evaluation is required. Do not round. Express the answer without units.", "solution": "The problem is first validated to ensure it is scientifically sound, self-contained, and well-posed.\n\n**Step 1: Extract Givens**\n- Baseline canonical entry rate (no antibody): $V_0$\n- Equilibrium dissociation constant for antibody-virus binding: $K_N$\n- Canonical entry is proportional to the fraction of unbound virions.\n- FcγR-mediated uptake rate function: $U(C) = \\frac{\\alpha C}{K + C}$\n- $\\alpha$: maximal FcγR-mediated uptake rate\n- $K$: half-saturation constant for FcγR-mediated uptake\n- Total entry rate $V_{total}(C)$ is the sum of canonical and FcγR-mediated entry rates.\n- Objective: Derive the condition for entry enhancement and find the smallest positive antibody concentration $C^*$ where $V_{total}(C^*) = V_0$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem describes Antibody-Dependent Enhancement (ADE) of viral infection, a known biological phenomenon. The model uses standard principles:\n1.  **Law of Mass Action:** The fraction of unbound virus is derived from the definition of the dissociation constant $K_N$. This is a fundamental principle in chemical kinetics.\n2.  **Saturating Kinetics:** The FcγR uptake is modeled by a Michaelis-Menten-type equation, which is standard for receptor-mediated processes.\n3.  **Model Consistency:** The problem is internally consistent and provides all necessary parameters and functions. It is a simplified but scientifically valid model for exploring the dynamics of ADE.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. It is scientifically grounded, well-posed, and objective. A complete solution will now be provided.\n\n**Derivation of the Solution**\n\nThe total viral entry rate, $V_{total}(C)$, at an antibody concentration $C$, is the sum of the entry rate through the canonical receptor and the entry rate through the FcγR.\n\n1.  **Canonical Receptor Entry:**\n    This route is only available to virions not bound by antibody. According to the law of mass action for an equilibrium binding process with dissociation constant $K_N$, the fraction of unbound virions, $f_{unbound}$, at an antibody concentration $C$ is:\n    $$f_{unbound}(C) = \\frac{K_N}{K_N + C}$$\n    The entry rate via the canonical receptor is the baseline rate $V_0$ multiplied by this fraction:\n    $$V_{canonical}(C) = V_0 \\cdot f_{unbound}(C) = V_0 \\frac{K_N}{K_N + C}$$\n\n2.  **FcγR-Mediated Entry:**\n    This route is for opsonized (antibody-bound) virions. The problem provides the functional form for this uptake rate as:\n    $$V_{Fc\\gamma R}(C) = U(C) = \\frac{\\alpha C}{K + C}$$\n\n3.  **Total Entry Rate:**\n    The total entry rate is the sum of these two pathways:\n    $$V_{total}(C) = V_{canonical}(C) + V_{Fc\\gamma R}(C) = V_0 \\frac{K_N}{K_N + C} + \\frac{\\alpha C}{K + C}$$\n    At $C=0$, the total entry rate is $V_{total}(0) = V_0 \\frac{K_N}{K_N} + \\frac{0}{K} = V_0$, which is the baseline rate, as expected.\n\n**Condition for Entry Enhancement**\nEntry is enhanced if, for small positive concentrations of antibody, the total entry rate increases above the baseline $V_0$. This means the derivative of $V_{total}(C)$ with respect to $C$ must be positive at $C=0$.\nFirst, we find the derivative of $V_{total}(C)$:\n$$\\frac{dV_{total}}{dC} = \\frac{d}{dC} \\left( V_0 \\frac{K_N}{K_N + C} \\right) + \\frac{d}{dC} \\left( \\frac{\\alpha C}{K + C} \\right)$$\nUsing the quotient rule:\n$$\\frac{dV_{total}}{dC} = V_0 K_N \\left( -\\frac{1}{(K_N + C)^2} \\right) + \\alpha \\left( \\frac{(K+C)(1) - C(1)}{(K+C)^2} \\right)$$\n$$\\frac{dV_{total}}{dC} = -\\frac{V_0 K_N}{(K_N + C)^2} + \\frac{\\alpha K}{(K + C)^2}$$\nNow, we evaluate this derivative at $C=0$:\n$$\\left. \\frac{dV_{total}}{dC} \\right|_{C=0} = -\\frac{V_0 K_N}{(K_N + 0)^2} + \\frac{\\alpha K}{(K + 0)^2} = -\\frac{V_0 K_N}{K_N^2} + \\frac{\\alpha K}{K^2}$$\n$$\\left. \\frac{dV_{total}}{dC} \\right|_{C=0} = -\\frac{V_0}{K_N} + \\frac{\\alpha}{K}$$\nFor entry enhancement to occur, this initial slope must be positive:\n$$-\\frac{V_0}{K_N} + \\frac{\\alpha}{K} > 0$$\nRearranging this inequality gives the condition on the parameters:\n$$\\frac{\\alpha}{K} > \\frac{V_0}{K_N} \\quad \\text{or} \\quad \\alpha K_N > V_0 K$$\nThis is the condition under which subneutralizing antibody concentrations increase viral entry.\n\n**Derivation of the Concentration $C^*$.**\nWe need to find the smallest positive antibody concentration $C^*$ at which the total entry rate equals the baseline rate $V_0$. We set $V_{total}(C) = V_0$ and solve for $C > 0$.\n$$V_0 = V_0 \\frac{K_N}{K_N + C} + \\frac{\\alpha C}{K + C}$$\nWe look for a solution $C \\neq 0$. Rearrange the terms:\n$$V_0 - V_0 \\frac{K_N}{K_N + C} = \\frac{\\alpha C}{K + C}$$\nFactor out $V_0$ on the left-hand side:\n$$V_0 \\left( 1 - \\frac{K_N}{K_N + C} \\right) = \\frac{\\alpha C}{K + C}$$\nFind a common denominator for the term in the parenthesis:\n$$V_0 \\left( \\frac{K_N + C - K_N}{K_N + C} \\right) = \\frac{\\alpha C}{K + C}$$\n$$V_0 \\frac{C}{K_N + C} = \\frac{\\alpha C}{K + C}$$\nSince we are seeking a positive concentration $C^* > 0$, we can divide both sides by $C$:\n$$\\frac{V_0}{K_N + C} = \\frac{\\alpha}{K + C}$$\nNow, we solve for $C$. Cross-multiplication gives:\n$$V_0 (K + C) = \\alpha (K_N + C)$$\n$$V_0 K + V_0 C = \\alpha K_N + \\alpha C$$\nGroup all terms containing $C$ on one side and constant terms on the other:\n$$V_0 C - \\alpha C = \\alpha K_N - V_0 K$$\nFactor out $C$:\n$$C (V_0 - \\alpha) = \\alpha K_N - V_0 K$$\nFinally, isolate $C$ to find the expression for $C^*$:\n$$C^* = \\frac{\\alpha K_N - V_0 K}{V_0 - \\alpha}$$\nThis is the unique non-zero concentration at which the total entry rate returns to the baseline level. For $C^*$ to be positive and physically meaningful in the context of ADE, the conditions $\\alpha K_N > V_0 K$ (numerator positive) and $V_0 > \\alpha$ (denominator positive) must hold. These conditions correspond to the case where the entry rate initially increases and then decreases to an asymptotic value $\\alpha$ which is below the baseline $V_0$.", "answer": "$$\\boxed{\\frac{\\alpha K_N - V_0 K}{V_0 - \\alpha}}$$", "id": "4677543"}, {"introduction": "The constant battle between pathogen and host immunity leaves an indelible mark on the pathogen's genome. A successful immune escape mutation can spread rapidly through the population in a process known as a selective sweep, drastically reducing genetic diversity around the selected gene. This final practice provides a computational framework to identify these evolutionary footprints from longitudinal sequence data [@problem_id:4677532]. By simulating allele frequency dynamics under selection and defining a formal criterion for sweep detection, you will learn to connect the molecular-level event of immune escape to its observable signature at the population genetics level.", "problem": "You are given a formalized longitudinal model of allele frequency dynamics in a pathogen population undergoing possible immune escape via selective sweeps. The aim is to infer signatures of selective sweeps from time series of allele frequencies and relate these signatures to immune escape events in predefined epitope regions. Your program must implement the deterministic update rules, compute diversity measures, and detect sweeps based on principled criteria derived from population genetics.\n\nStart from the following context-appropriate fundamental base:\n- The Wright–Fisher model with selection posits that under directional selection with selection coefficient $s$ at a single locus, the expected change in allele frequency $p(t)$ over one generation is proportional to $p(t)\\left(1-p(t)\\right)$. This motivates a deterministic recursion\n$$\np(t+1) \\leftarrow p(t) + s \\, p(t)\\left(1-p(t)\\right),\n$$\nwhich is a standard, well-tested approximation for expected allele frequency dynamics under selection in large populations.\n- Genetic diversity at a biallelic locus is captured by heterozygosity\n$$\nH(t) = 2\\,p(t)\\left(1-p(t)\\right),\n$$\nwhich is widely used as a measure of within-population diversity. A selective sweep reduces heterozygosity at the selected locus and, due to genetic hitchhiking, at linked loci in its genomic neighborhood.\n\nAssume a genome of length $L$ indexed by positions $i \\in \\{0,1,\\dots,L-1\\}$ and discrete sampling times $t \\in \\{0,1,\\dots,T-1\\}$. Let the focal selected locus index be $i^\\*$ and its genomic window of linkage-defined neighbors be $W \\subset \\{0,1,\\dots,L-1\\}$ with $i^\\* \\in W$. Let $p_i(t)$ denote the allele frequency at position $i$ and time $t$. The deterministic update rules are:\n\n1. Focal selected locus update:\n$$\np_{i^\\*}(t+1) = \\operatorname{clip}\\!\\Big(p_{i^\\*}(t) + s\\,p_{i^\\*}(t)\\left(1-p_{i^\\*}(t)\\right),\\,0,\\,1\\Big),\n$$\nwhere $\\operatorname{clip}(x,0,1)$ restricts values to the interval $[0,1]$.\n\n2. Linked loci update (hitchhiking approximation):\nFor each $j \\in W$ with $j \\ne i^\\*$,\n$$\np_{j}(t+1) = \\operatorname{clip}\\!\\Big(p_{j}(t) + \\alpha \\big(p_{i^\\*}(t+1) - p_{i^\\*}(t)\\big) \\cdot \\operatorname{sign}\\!\\big(p_j(t) - 0.5\\big),\\,0,\\,1\\Big),\n$$\nwhere $\\alpha$ is a hitchhiking coupling coefficient and $\\operatorname{sign}(x)$ returns $+1$ if $x \\ge 0$ and $-1$ otherwise. This deterministic approximation encodes that as the selected allele rises, linked loci are dragged toward fixation in whichever direction they initially leaned.\n\n3. Unlinked loci update:\nFor each $j \\notin W$,\n$$\np_j(t+1) = p_j(t).\n$$\n\nDefine the locus-specific heterozygosity as $H_i(t) = 2\\,p_i(t)\\left(1-p_i(t)\\right)$ and the window-averaged heterozygosity as\n$$\n\\overline{H}_W(t) = \\frac{1}{|W|}\\sum_{j \\in W} H_j(t).\n$$\n\nDefine the sweep detection criteria with three thresholds:\n- Fixation threshold $\\tau$ for the selected locus crossing event.\n- Diversity drop threshold $\\theta_H$ for the minimum window heterozygosity reduction.\n- Temporal proximity window $\\Delta t_{\\max}$ between the time of crossing and the time of minimum window heterozygosity.\n\nLet $t_{\\text{cross}}$ be the smallest $t$ such that $p_{i^\\*}(t) \\ge \\tau$, or set $t_{\\text{cross}} = -1$ if no such $t$ exists. Let $\\Delta H = \\overline{H}_W(0) - \\min_{t} \\overline{H}_W(t)$, and let $t_{\\min}$ be the smallest $t$ attaining the minimum. Declare a sweep if and only if $t_{\\text{cross}} \\ge 0$, $\\Delta H \\ge \\theta_H$, and $\\left|t_{\\min} - t_{\\text{cross}}\\right| \\le \\Delta t_{\\max}$.\n\nRelate the sweep to immune escape by assuming that immune epitopes are a known set $\\mathcal{E} \\subset \\{0,1,\\dots,L-1\\}$. An immune escape event is inferred if a sweep is detected and $i^\\* \\in \\mathcal{E}$.\n\nImplement the above and evaluate the following test suite. All indices are zero-based. For each test case, return a list with four entries in the following order: the boolean sweep detection result $b_{\\text{sweep}}$, the boolean immune escape inference $b_{\\text{escape}}$, the integer $t_{\\text{cross}}$, and the float $\\Delta H$ rounded to three decimal places.\n\nGlobal parameters used across all test cases:\n- Fixation threshold $\\tau = 0.9$.\n- Diversity drop threshold $\\theta_H = 0.15$.\n- Temporal proximity window $\\Delta t_{\\max} = 2$.\n- Epitope set $\\mathcal{E} = \\{4\\}$.\n\nTest suite:\n- Test case $1$ (happy path, clear sweep in epitope window):\n    - Genome length $L = 8$, time points $T = 10$, focal index $i^\\* = 4$, window $W = \\{3,4,5\\}$.\n    - Selection coefficient $s = 0.7$, hitchhiking coefficient $\\alpha = 0.3$.\n    - Initial allele frequencies at $t=0$: $p(0) = [0.3,\\,0.7,\\,0.5,\\,0.6,\\,0.05,\\,0.4,\\,0.5,\\,0.5]$.\n\n- Test case $2$ (neutral control, no sweep):\n    - $L = 8$, $T = 10$, $i^\\* = 4$, $W = \\{3,4,5\\}$.\n    - $s = 0.0$, $\\alpha = 0.3$.\n    - $p(0) = [0.3,\\,0.7,\\,0.5,\\,0.6,\\,0.05,\\,0.4,\\,0.5,\\,0.5]$.\n\n- Test case $3$ (edge case, crossing without sufficient diversity drop):\n    - $L = 8$, $T = 10$, $i^\\* = 4$, $W = \\{3,4,5\\}$.\n    - $s = 0.7$, $\\alpha = 0.01$.\n    - $p(0) = [0.3,\\,0.7,\\,0.5,\\,0.6,\\,0.05,\\,0.4,\\,0.5,\\,0.5]$.\n\nYour program should produce a single line of output containing the results for the three test cases as a comma-separated list enclosed in square brackets, with each case itself represented as a bracketed, comma-separated list. For example, the format must be like\n$$\n[\\,[b_{\\text{sweep}},b_{\\text{escape}},t_{\\text{cross}},\\Delta H],\\,[\\dots],\\,[\\dots]\\,].\n$$\nNo physical units are involved; all reported numbers are dimensionless. Angles are not involved.", "solution": "The problem requires the implementation of a deterministic model for allele frequency dynamics in a pathogen population to infer selective sweeps and their potential role in immune escape. The solution involves three main stages: simulating the allele frequency trajectories over time, calculating diversity metrics from these trajectories, and applying a set of formal criteria to detect a sweep event and infer immune escape.\n\nThe implementation is structured as follows:\n\nFirst, a simulation of the allele frequency dynamics is performed for a genome of length $L$ over $T$ discrete time steps. We initialize a $T \\times L$ matrix, $p$, to store the allele frequencies $p_i(t)$ for each locus $i \\in \\{0, 1, \\dots, L-1\\}$ at each time $t \\in \\{0, 1, \\dots, T-1\\}$. The initial state $p(0)$ is given by the problem-specific parameters.\n\nThe simulation proceeds iteratively from $t=0$ to $t=T-2$. In each step, the allele frequencies for time $t+1$ are calculated based on the frequencies at time $t$ according to the specified update rules:\n\n1.  For the focal selected locus $i^\\*$, the allele frequency is updated using the standard logistic growth approximation for an allele under directional selection:\n    $$\n    p_{i^\\*}(t+1) = \\operatorname{clip}\\!\\Big(p_{i^\\*}(t) + s\\,p_{i^\\*}(t)\\left(1-p_{i^\\*}(t)\\right),\\,0,\\,1\\Big)\n    $$\n    where $s$ is the selection coefficient. The $\\operatorname{clip}(x,0,1)$ function ensures the frequency remains within the valid range $[0, 1]$.\n\n2.  For all linked loci $j$ within the genomic window $W$ (where $j \\ne i^\\*$), the allele frequency change is coupled to the change at the focal locus to model genetic hitchhiking:\n    $$\n    p_{j}(t+1) = \\operatorname{clip}\\!\\Big(p_{j}(t) + \\alpha \\big(p_{i^\\*}(t+1) - p_{i^\\*}(t)\\big) \\cdot \\operatorname{sign}\\!\\big(p_j(t) - 0.5\\big),\\,0,\\,1\\Big)\n    $$\n    Here, $\\alpha$ is the hitchhiking coupling coefficient. The term $p_{i^\\*}(t+1) - p_{i^\\*}(t)$ represents the change in the selected allele's frequency. The $\\operatorname{sign}(p_j(t) - 0.5)$ term ensures that linked alleles are \"dragged\" towards fixation ($1$) if their initial frequency is above $0.5$ and towards loss ($0$) if below $0.5$. The $\\operatorname{sign}(x)$ function is implemented to return $+1$ for $x \\ge 0$ and $-1$ for $x < 0$.\n\n3.  For all unlinked loci $j \\notin W$, their frequencies remain unchanged: $p_j(t+1) = p_j(t)$.\n\nAfter the simulation completes, yielding the full frequency matrix $p$, the next step is to calculate the necessary metrics for sweep detection.\n\nThe locus-specific heterozygosity, $H_i(t)$, is calculated for all loci and time points using the formula:\n$$\nH_i(t) = 2\\,p_i(t)\\left(1-p_i(t)\\right)\n$$\nFrom this, the window-averaged heterozygosity, $\\overline{H}_W(t)$, is computed by averaging the heterozygosities of all loci within the window $W$:\n$$\n\\overline{H}_W(t) = \\frac{1}{|W|}\\sum_{j \\in W} H_j(t)\n$$\n\nWith the time series for $p_{i^\\*}(t)$ and $\\overline{H}_W(t)$ established, the key values for the detection criteria are determined:\n-   $t_{\\text{cross}}$: The first time point $t$ at which the focal allele frequency $p_{i^\\*}(t)$ meets or exceeds the fixation threshold $\\tau = 0.9$. If the threshold is never reached, $t_{\\text{cross}}$ is set to $-1$.\n-   $t_{\\min}$: The first time point $t$ at which the window-averaged heterozygosity $\\overline{H}_W(t)$ reaches its minimum value.\n-   $\\Delta H$: The total drop in diversity, calculated as the difference between the initial window-averaged heterozygosity and its minimum value over time: $\\Delta H = \\overline{H}_W(0) - \\min_{t} \\overline{H}_W(t)$.\n\nFinally, the sweep detection and immune escape inference logic is applied. A selective sweep is declared ($b_{\\text{sweep}} = \\text{True}$) if and only if all three of the following conditions are met:\n1.  The focal allele frequency crosses the fixation threshold: $t_{\\text{cross}} \\ge 0$.\n2.  The drop in window-averaged heterozygosity meets the significance threshold: $\\Delta H \\ge \\theta_H$, where $\\theta_H = 0.15$.\n3.  The time of minimum diversity is close to the time of fixation: $\\left|t_{\\min} - t_{\\text{cross}}\\right| \\le \\Delta t_{\\max}$, where $\\Delta t_{\\max} = 2$.\n\nAn immune escape event is subsequently inferred ($b_{\\text{escape}} = \\text{True}$) if a sweep has been detected and the focal locus $i^\\*$ is part of the predefined set of epitope loci $\\mathcal{E}$, which is given as $\\mathcal{E} = \\{4\\}$.\n\nThis entire procedure is encapsulated in a function that processes one set of parameters (a test case) and returns a list containing the boolean sweep result $b_{\\text{sweep}}$, the boolean immune escape result $b_{\\text{escape}}$, the integer crossing time $t_{\\text{cross}}$, and the heterozygosity drop $\\Delta H$ rounded to three decimal places. This function is then called for each test case in the suite, and the results are aggregated and printed in the required format.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    \n    def run_simulation(L, T, i_star, W, s, alpha, p0, tau, theta_H, delta_tmax, E):\n        \"\"\"\n        Runs one simulation and analysis based on the provided parameters.\n\n        Returns:\n            list: [b_sweep, b_escape, t_cross, delta_H_rounded]\n        \"\"\"\n        \n        # Helper function for sign as per problem specification\n        def custom_sign(x):\n            return 1 if x >= 0 else -1\n\n        # 1. Initialize allele frequency matrix\n        p = np.zeros((T, L))\n        p[0, :] = np.array(p0)\n        \n        W_indices = sorted(list(W))\n\n        # 2. Run time-stepping simulation\n        for t in range(T - 1):\n            p_current = p[t, :]\n            p_next = np.copy(p_current)\n\n            # Update focal locus i*\n            p_i_star_t = p_current[i_star]\n            p_i_star_t1 = p_i_star_t + s * p_i_star_t * (1 - p_i_star_t)\n            p_next[i_star] = np.clip(p_i_star_t1, 0, 1)\n\n            # Calculate change in focal locus for hitchhiking\n            change_i_star = p_next[i_star] - p_current[i_star]\n\n            # Update linked loci j in W\n            for j in W_indices:\n                if j == i_star:\n                    continue\n                p_j_t = p_current[j]\n                sign_j = custom_sign(p_j_t - 0.5)\n                p_j_t1 = p_j_t + alpha * change_i_star * sign_j\n                p_next[j] = np.clip(p_j_t1, 0, 1)\n            \n            # Unlinked loci remain unchanged, which is the default from copy.\n            p[t + 1, :] = p_next\n\n        # 3. Post-simulation analysis\n        \n        # Calculate locus-specific heterozygosity H_i(t)\n        H = 2 * p * (1 - p)\n\n        # Calculate window-averaged heterozygosity H_bar_W(t)\n        H_W = H[:, W_indices]\n        H_bar_W = np.mean(H_W, axis=1)\n\n        # Find crossing time t_cross\n        p_i_star_trajectory = p[:, i_star]\n        crossing_times = np.where(p_i_star_trajectory >= tau)[0]\n        t_cross = -1\n        if crossing_times.size > 0:\n            t_cross = int(np.min(crossing_times))\n\n        # Find diversity drop Delta_H and time of minimum t_min\n        H_bar_W_0 = H_bar_W[0]\n        min_H_bar_W = np.min(H_bar_W)\n        delta_H = H_bar_W_0 - min_H_bar_W\n        t_min = int(np.argmin(H_bar_W))\n\n        # 4. Apply sweep detection criteria\n        cond1 = (t_cross >= 0)\n        cond2 = (delta_H >= theta_H)\n        cond3 = False\n        if cond1:\n            cond3 = (abs(t_min - t_cross) <= delta_tmax)\n        \n        b_sweep = cond1 and cond2 and cond3\n\n        # 5. Infer immune escape\n        b_escape = b_sweep and (i_star in E)\n\n        # 6. Format and return results\n        delta_H_rounded = round(delta_H, 3)\n        return [b_sweep, b_escape, t_cross, delta_H_rounded]\n\n    # Global parameters\n    tau = 0.9\n    theta_H = 0.15\n    delta_tmax = 2\n    E = {4}\n\n    # Test cases\n    test_cases = [\n        # Test case 1\n        {'L': 8, 'T': 10, 'i_star': 4, 'W': {3, 4, 5}, 's': 0.7, 'alpha': 0.3, \n         'p0': [0.3, 0.7, 0.5, 0.6, 0.05, 0.4, 0.5, 0.5]},\n        # Test case 2\n        {'L': 8, 'T': 10, 'i_star': 4, 'W': {3, 4, 5}, 's': 0.0, 'alpha': 0.3,\n         'p0': [0.3, 0.7, 0.5, 0.6, 0.05, 0.4, 0.5, 0.5]},\n        # Test case 3\n        {'L': 8, 'T': 10, 'i_star': 4, 'W': {3, 4, 5}, 's': 0.7, 'alpha': 0.01,\n         'p0': [0.3, 0.7, 0.5, 0.6, 0.05, 0.4, 0.5, 0.5]}\n    ]\n    \n    results = []\n    for case in test_cases:\n        result = run_simulation(\n            case['L'], case['T'], case['i_star'], case['W'], case['s'], case['alpha'], case['p0'],\n            tau, theta_H, delta_tmax, E\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{str(results[0]).replace(' ', '')},{str(results[1]).replace(' ', '')},{str(results[2]).replace(' ', '')}]\")\n\nsolve()\n```", "id": "4677532"}]}