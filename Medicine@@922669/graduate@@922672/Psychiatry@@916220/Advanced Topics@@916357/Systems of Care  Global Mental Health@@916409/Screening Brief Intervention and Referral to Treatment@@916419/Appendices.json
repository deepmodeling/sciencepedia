{"hands_on_practices": [{"introduction": "Effective Screening, Brief Intervention, and Referral to Treatment (SBIRT) begins with accurate screening. This foundational exercise focuses on the practical application of the World Health Organization's Alcohol Use Disorders Identification Test (AUDIT), a globally recognized gold-standard tool. By translating a hypothetical patient's responses into a quantitative score and corresponding risk zone, you will practice the core skill of risk stratification that informs all subsequent clinical decisions in the SBIRT workflow [@problem_id:4756965].", "problem": "A clinician is using the Alcohol Use Disorders Identification Test (AUDIT), developed by the World Health Organization (WHO), within a Screening, Brief Intervention, and Referral to Treatment framework to stratify risk and guide care. The Alcohol Use Disorders Identification Test (AUDIT) consists of $10$ items, each scored according to standard WHO guidance. Items $1$ through $8$ use a $0$–$4$ ordinal scoring keyed to frequency or severity; items $9$ and $10$ use $0$, $2$, or $4$ based on recency. The total score is the sum of the item scores, ranging from $0$ to $40$. Risk zones are defined by WHO as follows: Zone I (low risk) for total scores $0$ through $7$, Zone II (hazardous use) for $8$ through $15$, Zone III (harmful use) for $16$ through $19$, and Zone IV (possible dependence) for $20$ through $40$. For the purpose of producing a single numeric classification, encode the patient’s risk zone as Zone I $\\to 1$, Zone II $\\to 2$, Zone III $\\to 3$, Zone IV $\\to 4$.\n\nUse the following item responses for a hypothetical adult patient, referring to the standard WHO AUDIT item content and scoring anchors:\n\n- Item $1$ (drinking frequency): “Two to three times a week.”\n- Item $2$ (typical quantity): “$5$–$6$ drinks on a typical day when drinking.”\n- Item $3$ (frequency of heavy episodic drinking, defined as six or more drinks): “Weekly.”\n- Item $4$ (inability to stop once started): “Monthly.”\n- Item $5$ (failure to meet expectations due to drinking): “Monthly.”\n- Item $6$ (morning drinking to get going): “Less than monthly.”\n- Item $7$ (guilt or remorse after drinking): “Weekly.”\n- Item $8$ (blackouts or memory loss after drinking): “Monthly.”\n- Item $9$ (injury to self or others because of drinking): “Yes, but not in the last year.”\n- Item $10$ (others concerned or suggested cutting down): “Yes, during the last year.”\n\nStarting from the standard WHO scoring anchors for each item category and the definition that the AUDIT total score is the sum of item scores, compute the total AUDIT score and determine the risk zone classification. Report your final answer as a row matrix containing two entries: first the total AUDIT score, and second the numeric zone code as defined above. No rounding is required, and there are no physical units to report. Ensure all steps in your reasoning adhere to the canonical WHO AUDIT scoring rules and the stated risk zone thresholds.", "solution": "The problem statement is evaluated as valid. It is scientifically grounded, well-posed, objective, and self-contained. The problem requires the calculation of a total score for the Alcohol Use Disorders Identification Test (AUDIT) and the corresponding risk zone classification, based on a given set of patient responses and the standard World Health Organization (WHO) scoring guidelines. The problem provides all necessary data and definitions for a unique and verifiable solution.\n\nThe task is to compute the total AUDIT score, $S_{Total}$, and determine the corresponding numeric risk zone code, $Z_{code}$. The total score is the sum of the scores for the $10$ individual items.\nLet $S_i$ be the score for item $i$, where $i \\in \\{1, 2, ..., 10\\}$.\nThe total score is given by:\n$$S_{Total} = \\sum_{i=1}^{10} S_i$$\n\nWe will now determine the score for each item based on the patient's responses and the standard WHO AUDIT scoring system.\n\n**Item 1: Drinking Frequency**\nThe patient's response is \"Two to three times a week.” According to the WHO scoring for this item:\n- \"Never\" scores $0$.\n- \"Monthly or less\" scores $1$.\n- \"Two to four times a month\" scores $2$.\n- \"Two to three times a week\" scores $3$.\n- \"Four or more times a week\" scores $4$.\nTherefore, the score for item $1$ is $S_1 = 3$.\n\n**Item 2: Typical Quantity**\nThe patient's response is “$5$–$6$ drinks on a typical day when drinking.” The WHO scoring for this item is:\n- \"$1$ or $2$ drinks\" scores $0$.\n- \"$3$ or $4$ drinks\" scores $1$.\n- \"$5$ or $6$ drinks\" scores $2$.\n- \"$7$ to $9$ drinks\" scores $3$.\n- \"$10$ or more drinks\" scores $4$.\nTherefore, the score for item $2$ is $S_2 = 2$.\n\n**Item 3: Frequency of Heavy Episodic Drinking**\nThe patient's response for drinking six or more drinks on one occasion is “Weekly.” The WHO scoring for this item is:\n- \"Never\" scores $0$.\n- \"Less than monthly\" scores $1$.\n- \"Monthly\" scores $2$.\n- \"Weekly\" scores $3$.\n- \"Daily or almost daily\" scores $4$.\nTherefore, the score for item $3$ is $S_3 = 3$.\n\n**Item 4: Inability to Stop Once Started**\nThe patient's response is “Monthly.” The WHO scoring for this item is:\n- \"Never\" scores $0$.\n- \"Less than monthly\" scores $1$.\n- \"Monthly\" scores $2$.\n- \"Weekly\" scores $3$.\n- \"Daily or almost daily\" scores $4$.\nTherefore, the score for item $4$ is $S_4 = 2$.\n\n**Item 5: Failure to Meet Expectations Due to Drinking**\nThe patient's response is “Monthly.” The WHO scoring for this item is:\n- \"Never\" scores $0$.\n- \"Less than monthly\" scores $1$.\n- \"Monthly\" scores $2$.\n- \"Weekly\" scores $3$.\n- \"Daily or almost daily\" scores $4$.\nTherefore, the score for item $5$ is $S_5 = 2$.\n\n**Item 6: Morning Drinking**\nThe patient's response is “Less than monthly.” The WHO scoring for this item is:\n- \"Never\" scores $0$.\n- \"Less than monthly\" scores $1$.\n- \"Monthly\" scores $2$.\n- \"Weekly\" scores $3$.\n- \"Daily or almost daily\" scores $4$.\nTherefore, the score for item $6$ is $S_6 = 1$.\n\n**Item 7: Guilt or Remorse After Drinking**\nThe patient's response is “Weekly.” The WHO scoring for this item is:\n- \"Never\" scores $0$.\n- \"Less than monthly\" scores $1$.\n- \"Monthly\" scores $2$.\n- \"Weekly\" scores $3$.\n- \"Daily or almost daily\" scores $4$.\nTherefore, the score for item $7$ is $S_7 = 3$.\n\n**Item 8: Blackouts or Memory Loss**\nThe patient's response is “Monthly.” The WHO scoring for this item is:\n- \"Never\" scores $0$.\n- \"Less than monthly\" scores $1$.\n- \"Monthly\" scores $2$.\n- \"Weekly\" scores $3$.\n- \"Daily or almost daily\" scores $4$.\nTherefore, the score for item $8$ is $S_8 = 2$.\n\n**Item 9: Injury Due to Drinking**\nThe patient's response is “Yes, but not in the last year.” The WHO scoring for this item uses a different scale:\n- \"No\" scores $0$.\n- \"Yes, but not in the last year\" scores $2$.\n- \"Yes, during the last year\" scores $4$.\nTherefore, the score for item $9$ is $S_9 = 2$.\n\n**Item 10: Others Concerned**\nThe patient's response is “Yes, during the last year.” The WHO scoring for this item is:\n- \"No\" scores $0$.\n- \"Yes, but not in the last year\" scores $2$.\n- \"Yes, during the last year\" scores $4$.\nTherefore, the score for item $10$ is $S_{10} = 4$.\n\nNow, we compute the total AUDIT score, $S_{Total}$, by summing the individual item scores:\n$$S_{Total} = S_1 + S_2 + S_3 + S_4 + S_5 + S_6 + S_7 + S_8 + S_9 + S_{10}$$\n$$S_{Total} = 3 + 2 + 3 + 2 + 2 + 1 + 3 + 2 + 2 + 4$$\n$$S_{Total} = 24$$\nThe total AUDIT score is $24$.\n\nNext, we determine the risk zone classification. The problem specifies the WHO risk zones:\n- Zone I: Total scores $0 - 7$\n- Zone II: Total scores $8 - 15$\n- Zone III: Total scores $16 - 19$\n- Zone IV: Total scores $20 - 40$\n\nThe calculated score $S_{Total} = 24$ falls within the range for Zone IV, as $20 \\le 24 \\le 40$.\n\nFinally, we find the numeric zone code. The problem specifies the encoding:\n- Zone I $\\to 1$\n- Zone II $\\to 2$\n- Zone III $\\to 3$\n- Zone IV $\\to 4$\n\nSince the classification is Zone IV, the numeric zone code is $Z_{code} = 4$.\n\nThe final answer is presented as a row matrix containing the total AUDIT score and the numeric zone code. The two entries are $24$ and $4$.", "answer": "$$ \\boxed{\\begin{pmatrix} 24 & 4 \\end{pmatrix}} $$", "id": "4756965"}, {"introduction": "In many clinical settings, a multi-stage screening process is more efficient and accurate than a single test. This practice explores the statistical principles behind sequential testing, a common strategy where an initial brief screen is followed by a more comprehensive assessment for those who screen positive. You will use the odds-form of Bayes’ theorem and likelihood ratios ($LR$) to model how our diagnostic certainty is updated with each piece of evidence, a powerful and flexible method for accumulating data in a clinically realistic manner [@problem_id:4756957].", "problem": "A primary care clinic is implementing Screening, Brief Intervention, and Referral to Treatment for unhealthy alcohol use. The clinic uses a two-stage sequential screen for current Alcohol Use Disorder as defined by the Diagnostic and Statistical Manual of Mental Disorders, Fifth Edition. Stage 1 uses the Alcohol Use Disorders Identification Test–Consumption (AUDIT-C), and, conditional on a positive AUDIT-C, Stage 2 uses the full Alcohol Use Disorders Identification Test (AUDIT). Assume the following are well-established for the clinic population at the chosen thresholds and administration procedures:\n\n- The pretest probability of current Alcohol Use Disorder is $0.12$.\n- The likelihood ratio for a positive test (denoted $LR_{+}$) of the AUDIT-C is $4.5$.\n- The likelihood ratio for a positive test of the full AUDIT, when administered after a positive AUDIT-C, is $9.0$.\n- Conditional on disease status (present $D$ or absent $D^{c}$), the Stage 1 and Stage 2 test outcomes are independent.\n\nUsing only the core definitions of odds, Bayes’ theorem in odds form, and the definition of the likelihood ratio for a positive test, derive from first principles how sequential testing updates odds multiplicatively across stages, and then compute the final posttest probability of current Alcohol Use Disorder for a patient who tests positive on both the AUDIT-C and the full AUDIT under the above assumptions.\n\nExpress your final answer as a decimal rounded to four significant figures. Do not use a percentage sign.", "solution": "The problem is found to be valid as it is scientifically grounded in biostatistics, well-posed with sufficient and consistent information, and objectively stated. We may therefore proceed with a solution.\n\nLet $D$ be the event that a patient has a current Alcohol Use Disorder, and $D^c$ be the event that they do not. Let $T_1^+$ be the event of a positive test on the Stage 1 screen (AUDIT-C), and $T_2^+$ be the event of a positive test on the Stage 2 screen (full AUDIT).\n\nThe problem provides the following givens:\n- The pretest probability of the disorder: $P(D) = 0.12$.\n- The likelihood ratio for a positive Stage 1 test: $LR_{+,1} = 4.5$.\n- The likelihood ratio for a positive Stage 2 test: $LR_{+,2} = 9.0$.\n- The conditional independence of the test outcomes: $P(T_1^+, T_2^+ | D) = P(T_1^+ | D) P(T_2^+ | D)$ and $P(T_1^+, T_2^+ | D^c) = P(T_1^+ | D^c) P(T_2^+ | D^c)$.\n\nThe task is to derive the multiplicative update rule for odds in sequential testing from first principles and then compute the final posttest probability for a patient who tests positive on both screens.\n\n**1. Derivation from First Principles**\n\nFirst, we define the core concepts.\nThe odds of an event $A$ are defined as the ratio of its probability to the probability of its complement:\n$$Odds(A) = \\frac{P(A)}{P(A^c)} = \\frac{P(A)}{1 - P(A)}$$\n\nThe likelihood ratio for a positive test, $LR_{+}$, is the ratio of the probability of a positive test result in individuals with the disease (sensitivity) to the probability of a positive test result in individuals without the disease ($1$ minus specificity):\n$$LR_{+} = \\frac{P(T^+|D)}{P(T^+|D^c)}$$\n\nBayes' theorem in probability form for a single test $T^+$ is:\n$$P(D|T^+) = \\frac{P(T^+|D)P(D)}{P(T^+)}$$\nand for the complement:\n$$P(D^c|T^+) = \\frac{P(T^+|D^c)P(D^c)}{P(T^+)}$$\n\nThe posttest odds, $Odds(D|T^+)$, are the ratio of these two posterior probabilities:\n$$Odds(D|T^+) = \\frac{P(D|T^+)}{P(D^c|T^+)} = \\frac{\\frac{P(T^+|D)P(D)}{P(T^+)}}{\\frac{P(T^+|D^c)P(D^c)}{P(T^+)}} = \\frac{P(T^+|D)}{P(T^+|D^c)} \\times \\frac{P(D)}{P(D^c)}$$\nRecognizing the terms on the right-hand side, we arrive at Bayes' theorem in odds form:\n$$Odds_{post} = LR_{+} \\times Odds_{pre}$$\n\nNow, we extend this to sequential testing where a patient tests positive on both $T_1$ and $T_2$. We seek the final posttest odds, $Odds(D|T_1^+, T_2^+)$.\n$$Odds(D|T_1^+, T_2^+) = \\frac{P(D|T_1^+, T_2^+)}{P(D^c|T_1^+, T_2^+)}$$\nApplying the same logic as above, where the evidence is the compound event $(T_1^+ \\cap T_2^+)$:\n$$Odds(D|T_1^+, T_2^+) = \\frac{P(T_1^+, T_2^+|D)}{P(T_1^+, T_2^+|D^c)} \\times \\frac{P(D)}{P(D^c)}$$\nThe term $\\frac{P(D)}{P(D^c)}$ is the initial pretest odds, $Odds_{pre}$. The first term is the likelihood ratio for the combined positive tests, $LR_{+, combined}$.\n\nUsing the given assumption of conditional independence of the tests:\n$P(T_1^+, T_2^+|D) = P(T_1^+|D) P(T_2^+|D)$\n$P(T_1^+, T_2^+|D^c) = P(T_1^+|D^c) P(T_2^+|D^c)$\n\nSubstituting these into the expression for $LR_{+, combined}$:\n$$LR_{+, combined} = \\frac{P(T_1^+|D) P(T_2^+|D)}{P(T_1^+|D^c) P(T_2^+|D^c)} = \\left(\\frac{P(T_1^+|D)}{P(T_1^+|D^c)}\\right) \\times \\left(\\frac{P(T_2^+|D)}{P(T_2^+|D^c)}\\right)$$\nThis simplifies to the product of the individual likelihood ratios:\n$$LR_{+, combined} = LR_{+,1} \\times LR_{+,2}$$\nTherefore, the final posttest odds after two positive tests are:\n$$Odds_{final} = (LR_{+,1} \\times LR_{+,2}) \\times Odds_{pre}$$\nThis equation demonstrates that, under conditional independence, sequential testing updates the odds multiplicatively. It can be viewed as a two-step process:\n$Odds_1 = LR_{+,1} \\times Odds_{pre}$\n$Odds_{final} = LR_{+,2} \\times Odds_1$\nwhere the posttest odds from the first stage become the pretest odds for the second stage.\n\n**2. Calculation**\n\nWe now apply this derived formula to the given values.\n\nFirst, calculate the pretest odds from the pretest probability $P(D) = 0.12$.\nThe probability of not having the disease is $P(D^c) = 1 - P(D) = 1 - 0.12 = 0.88$.\n$$Odds_{pre} = \\frac{P(D)}{P(D^c)} = \\frac{0.12}{0.88} = \\frac{12}{88} = \\frac{3}{22}$$\n\nNext, calculate the final posttest odds using the multiplicative rule and the given likelihood ratios $LR_{+,1} = 4.5$ and $LR_{+,2} = 9.0$.\n$$Odds_{final} = (LR_{+,1} \\times LR_{+,2}) \\times Odds_{pre} = (4.5 \\times 9.0) \\times \\frac{3}{22}$$\n$$Odds_{final} = 40.5 \\times \\frac{3}{22} = \\frac{81}{2} \\times \\frac{3}{22} = \\frac{243}{44}$$\n\nFinally, convert the final posttest odds back to a probability. The relationship is $P = \\frac{Odds}{1 + Odds}$.\n$$P_{final} = P(D|T_1^+, T_2^+) = \\frac{Odds_{final}}{1 + Odds_{final}}$$\n$$P_{final} = \\frac{\\frac{243}{44}}{1 + \\frac{243}{44}} = \\frac{\\frac{243}{44}}{\\frac{44}{44} + \\frac{243}{44}} = \\frac{\\frac{243}{44}}{\\frac{287}{44}} = \\frac{243}{287}$$\n\nTo provide the final answer as a decimal rounded to four significant figures, we compute the value of this fraction:\n$$P_{final} = \\frac{243}{287} \\approx 0.84668989...$$\nRounding to four significant figures gives $0.8467$.", "answer": "$$\\boxed{0.8467}$$", "id": "4756957"}, {"introduction": "Beyond diagnosing individuals, a critical skill for public health and clinical leaders is to quantify the population-level benefit of interventions like SBIRT. This advanced capstone exercise introduces health economic evaluation through the construction of a Markov model, a versatile tool for simulating cohort health outcomes over time. By building a model to project the long-term gain in Quality-Adjusted Life Years ($QALYs$) resulting from SBIRT, you will connect clinical activities to the high-level justification and analysis required for health policy and program planning [@problem_id:4756917].", "problem": "Construct a cohort-based finite Markov model to quantify the long-term impact of Screening, Brief Intervention, and Referral to Treatment (SBIRT) on Quality-Adjusted Life Years (QALYs) among individuals with unhealthy alcohol use. The Markov chain has four mutually exclusive states: risky use (RU), remission (REM), alcohol use disorder (AUD), and death (D). The model should adhere to the following fundamental base and definitions.\n\nFundamental base and core definitions:\n- A finite Markov chain with state space $\\{\\text{RU}, \\text{REM}, \\text{AUD}, \\text{D}\\}$ is defined by a transition matrix $P \\in \\mathbb{R}^{4 \\times 4}$ whose entries $P_{i,j}$ denote the probability of transitioning from state $i$ to state $j$ in one cycle. Each row of $P$ must sum to $1$, with the death state being absorbing, that is, $P_{\\text{D},\\text{D}} = 1$ and $P_{\\text{D},j} = 0$ for all $j \\ne \\text{D}$.\n- Let $p_t \\in \\mathbb{R}^{1 \\times 4}$ denote the row vector of state occupancy probabilities at cycle $t$, satisfying $p_{t+1} = p_t P$ and $\\sum_j p_{t,j} = 1$. The initial distribution is $p_0$.\n- Quality-Adjusted Life Years (QALYs) are computed using state-specific utility weights $u \\in \\mathbb{R}^{1 \\times 4}$, where $u_{\\text{D}} = 0$. For a time horizon of $T$ cycles and a constant annual discount rate $r$, the discounted QALYs for a strategy with transition matrix $P$ are\n$$\nQ(P; p_0, u, r, T) = \\sum_{t=0}^{T-1} \\frac{1}{(1+r)^t} \\left( \\sum_{j} p_{t,j} \\, u_j \\right), \\quad \\text{with } p_{t+1} = p_t P \\text{ and } p_0 \\text{ given}.\n$$\n- Screening, Brief Intervention, and Referral to Treatment (SBIRT) is modeled as a modification to selected transition probabilities in the baseline matrix $P^{\\text{BASE}}$ to form $P^{\\text{SBIRT}}$, preserving the absorbing death state and row-wise normalization. Specifically, SBIRT is assumed to:\n    - Reallocate a fraction $s_{\\text{RU}}$ from $\\text{RU} \\to \\text{AUD}$ to $\\text{RU} \\to \\text{REM}$, leaving $\\text{RU} \\to \\text{RU}$ and $\\text{RU} \\to \\text{D}$ unchanged.\n    - Reallocate a fraction $s_{\\text{AUD}}$ from $\\text{AUD} \\to \\text{AUD}$ to $\\text{AUD} \\to \\text{REM}$, leaving $\\text{AUD} \\to \\text{RU}$ and $\\text{AUD} \\to \\text{D}$ unchanged.\nFormally, for the $\\text{RU}$ row:\n$$\nP^{\\text{SBIRT}}_{\\text{RU},\\text{AUD}} = \\max\\left(0, P^{\\text{BASE}}_{\\text{RU},\\text{AUD}} - s_{\\text{RU}}\\right), \\quad\nP^{\\text{SBIRT}}_{\\text{RU},\\text{REM}} = P^{\\text{BASE}}_{\\text{RU},\\text{REM}} + s_{\\text{RU}}, \\quad\nP^{\\text{SBIRT}}_{\\text{RU},\\text{RU}} = P^{\\text{BASE}}_{\\text{RU},\\text{RU}}, \\quad\nP^{\\text{SBIRT}}_{\\text{RU},\\text{D}} = P^{\\text{BASE}}_{\\text{RU},\\text{D}}.\n$$\nSimilarly, for the $\\text{AUD}$ row:\n$$\nP^{\\text{SBIRT}}_{\\text{AUD},\\text{AUD}} = \\max\\left(0, P^{\\text{BASE}}_{\\text{AUD},\\text{AUD}} - s_{\\text{AUD}}\\right), \\quad\nP^{\\text{SBIRT}}_{\\text{AUD},\\text{REM}} = P^{\\text{BASE}}_{\\text{AUD},\\text{REM}} + s_{\\text{AUD}}, \\quad\nP^{\\text{SBIRT}}_{\\text{AUD},\\text{RU}} = P^{\\text{BASE}}_{\\text{AUD},\\text{RU}}, \\quad\nP^{\\text{SBIRT}}_{\\text{AUD},\\text{D}} = P^{\\text{BASE}}_{\\text{AUD},\\text{D}}.\n$$\nAll other entries and the entire $\\text{D}$ row remain identical to $P^{\\text{BASE}}$. Assume $s_{\\text{RU}} \\le P^{\\text{BASE}}_{\\text{RU},\\text{AUD}}$ and $s_{\\text{AUD}} \\le P^{\\text{BASE}}_{\\text{AUD},\\text{AUD}}$ so that all modified probabilities remain within $[0,1]$ and rows remain normalized.\n\nTask:\n- Implement a program that, for each specified test case, computes the discounted QALYs under $P^{\\text{BASE}}$ and $P^{\\text{SBIRT}}$ and returns the difference $\\Delta Q = Q\\left(P^{\\text{SBIRT}}; p_0, u, r, T\\right) - Q\\left(P^{\\text{BASE}}; p_0, u, r, T\\right)$.\n- Results must be expressed as floats, rounded to six decimal places, with no physical units required.\n\nTest suite:\nUse the following test cases. The state order is fixed as $\\left[\\text{RU}, \\text{REM}, \\text{AUD}, \\text{D}\\right]$ for all vectors and matrices.\n\n- Case $1$ (general case, moderate SBIRT effect):\n    - $P^{\\text{BASE}} = \\begin{bmatrix}\n    0.80 & 0.10 & 0.08 & 0.02 \\\\\n    0.06 & 0.90 & 0.02 & 0.02 \\\\\n    0.05 & 0.10 & 0.75 & 0.10 \\\\\n    0.00 & 0.00 & 0.00 & 1.00\n    \\end{bmatrix}$\n    - $p_0 = [0.60, 0.10, 0.30, 0.00]$\n    - $u = [0.85, 0.95, 0.70, 0.00]$\n    - $r = 0.03$, $T = 10$\n    - $s_{\\text{RU}} = 0.03$, $s_{\\text{AUD}} = 0.05$\n\n- Case $2$ (boundary: zero SBIRT effect):\n    - $P^{\\text{BASE}}$ identical to Case $1$\n    - $p_0 = [0.60, 0.10, 0.30, 0.00]$\n    - $u = [0.85, 0.95, 0.70, 0.00]$\n    - $r = 0.03$, $T = 10$\n    - $s_{\\text{RU}} = 0.00$, $s_{\\text{AUD}} = 0.00$\n\n- Case $3$ (edge: elevated mortality probabilities):\n    - $P^{\\text{BASE}} = \\begin{bmatrix}\n    0.78 & 0.10 & 0.07 & 0.05 \\\\\n    0.05 & 0.90 & 0.02 & 0.03 \\\\\n    0.03 & 0.12 & 0.70 & 0.15 \\\\\n    0.00 & 0.00 & 0.00 & 1.00\n    \\end{bmatrix}$\n    - $p_0 = [0.50, 0.20, 0.30, 0.00]$\n    - $u = [0.85, 0.95, 0.70, 0.00]$\n    - $r = 0.03$, $T = 10$\n    - $s_{\\text{RU}} = 0.02$, $s_{\\text{AUD}} = 0.04$\n\n- Case $4$ (boundary: short horizon):\n    - $P^{\\text{BASE}}$ identical to Case $1$\n    - $p_0 = [0.70, 0.15, 0.15, 0.00]$\n    - $u = [0.85, 0.95, 0.70, 0.00]$\n    - $r = 0.03$, $T = 1$\n    - $s_{\\text{RU}} = 0.01$, $s_{\\text{AUD}} = 0.02$\n\nAnswer specification:\n- For each case, compute $\\Delta Q$ as a float.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\text{result1},\\text{result2},\\text{result3},\\text{result4}]$). Each result must be rounded to six decimal places.", "solution": "The problem requires the construction and analysis of a cohort-based finite Markov model to evaluate the impact of a health intervention, Screening, Brief Intervention, and Referral to Treatment (SBIRT), on Quality-Adjusted Life Years (QALYs). The analysis is based on established principles of health economic evaluation and Markov modeling.\n\n### Mathematical Formulation and Principles\n\nThe system is modeled as a discrete-time, finite-state Markov chain. The state space is defined as $\\mathcal{S} = \\{\\text{RU}, \\text{REM}, \\text{AUD}, \\text{D}\\}$, representing Risky Use, Remission, Alcohol Use Disorder, and Death, respectively. The state order is fixed as $[\\text{RU}, \\text{REM}, \\text{AUD}, \\text{D}]$, corresponding to indices $[0, 1, 2, 3]$.\n\nThe evolution of a cohort's distribution across these states is governed by a transition probability matrix $P \\in \\mathbb{R}^{4 \\times 4}$. An entry $P_{i,j}$ represents the probability of transitioning from state $i$ to state $j$ in a single time cycle (e.g., one year). The state distribution at time $t$ is a row vector $p_t \\in \\mathbb{R}^{1 \\times 4}$, where $p_{t,j}$ is the proportion of the cohort in state $j$. The state distribution evolves according to the matrix equation:\n$$\np_{t+1} = p_t P\n$$\nGiven an initial state distribution $p_0$, the distribution at any subsequent time $t$ is $p_t = p_0 P^t$.\n\nThe core of the evaluation is the calculation of discounted QALYs. A utility vector $u \\in \\mathbb{R}^{1 \\times 4}$ assigns a quality-of-life weight to each state, with $u_j \\in [0, 1]$. By definition, the utility of the death state is $u_{\\text{D}} = 0$. The total discounted QALYs over a time horizon of $T$ cycles, with an annual discount rate $r$, are given by the formula:\n$$\nQ(P; p_0, u, r, T) = \\sum_{t=0}^{T-1} \\frac{1}{(1+r)^t} (p_t \\cdot u^T) = \\sum_{t=0}^{T-1} \\frac{1}{(1+r)^t} \\left( \\sum_{j=0}^{3} p_{t,j} u_j \\right)\n$$\nThis formula represents the sum of discounted, quality-weighted life-years experienced by the cohort over the specified horizon. The term $p_t \\cdot u^T$ is the total QALYs accrued by the cohort during cycle $t$.\n\n### Modeling the SBIRT Intervention\n\nThe problem models two scenarios: a baseline scenario without SBIRT, governed by the transition matrix $P^{\\text{BASE}}$, and an intervention scenario with SBIRT, governed by the matrix $P^{\\text{SBIRT}}$. The SBIRT intervention is assumed to improve outcomes by altering specific transition probabilities.\nThe matrix $P^{\\text{SBIRT}}$ is derived from $P^{\\text{BASE}}$ as follows:\n1.  A fraction $s_{\\text{RU}}$ of the cohort that would have transitioned from Risky Use (RU) to Alcohol Use Disorder (AUD) is instead redirected to Remission (REM).\n    -   $P^{\\text{SBIRT}}_{\\text{RU},\\text{AUD}} = P^{\\text{BASE}}_{\\text{RU},\\text{AUD}} - s_{\\text{RU}}$ (Index $[0,2]$)\n    -   $P^{\\text{SBIRT}}_{\\text{RU},\\text{REM}} = P^{\\text{BASE}}_{\\text{RU},\\text{REM}} + s_{\\text{RU}}$ (Index $[0,1]$)\n2.  A fraction $s_{\\text{AUD}}$ of the cohort that would have remained in the Alcohol Use Disorder (AUD) state is instead redirected to Remission (REM).\n    -   $P^{\\text{SBIRT}}_{\\text{AUD},\\text{AUD}} = P^{\\text{BASE}}_{\\text{AUD},\\text{AUD}} - s_{\\text{AUD}}$ (Index $[2,2]$)\n    -   $P^{\\text{SBIRT}}_{\\text{AUD},\\text{REM}} = P^{\\text{BASE}}_{\\text{AUD},\\text{REM}} + s_{\\text{AUD}}$ (Index $[2,1]$)\n\nAll other transition probabilities remain unchanged. The problem guarantees that $s_{\\text{RU}}$ and $s_{\\text{AUD}}$ are sufficiently small so that all resulting probabilities remain non-negative, and the row sums of $P^{\\text{SBIRT}}$ remain equal to $1$.\n\n### Algorithmic Implementation\n\nThe solution involves implementing a function to calculate $Q(P; p_0, u, r, T)$ and then applying it to both the baseline and SBIRT scenarios to find the difference.\n\n1.  **QALY Calculation Function:** A function, `calculate_qaly`, is designed to compute the total discounted QALYs. This function takes as input a transition matrix $P$, initial state vector $p_0$, utility vector $u$, discount rate $r$, and time horizon $T$.\n    -   It initializes a variable `total_qaly` to $0.0$.\n    -   It initializes the current state vector `p_t` with the initial distribution `p_0`.\n    -   It iterates for $t$ from $0$ to $T-1$. In each iteration:\n        a.  The QALYs for the current cycle are calculated via the dot product `p_t @ u`.\n        b.  This value is discounted by the factor $(1+r)^t$.\n        c.  The discounted value is added to `total_qaly`.\n        d.  The state vector for the next cycle is computed by `p_t = p_t @ P`.\n    -   The function returns `total_qaly`. The use of `numpy` is ideal for these vector and matrix operations.\n\n2.  **Main Logic for Each Test Case:** For each given test case, the program performs the following steps:\n    -   Define the numerical inputs: $P^{\\text{BASE}}$, $p_0$, $u$, $r$, $T$, $s_{\\text{RU}}$, and $s_{\\text{AUD}}$.\n    -   Call `calculate_qaly` with $P^{\\text{BASE}}$ to compute $Q^{\\text{BASE}}$.\n    -   Construct the $P^{\\text{SBIRT}}$ matrix by creating a copy of $P^{\\text{BASE}}$ and applying the specified modifications using the values of $s_{\\text{RU}}$ and $s_{\\text{AUD}}$ at the appropriate indices.\n    -   Call `calculate_qaly` with the newly constructed $P^{\\text{SBIRT}}$ matrix to compute $Q^{\\text{SBIRT}}$.\n    -   Calculate the final result as the difference $\\Delta Q = Q^{\\text{SBIRT}} - Q^{\\text{BASE}}$.\n    -   The result is rounded to six decimal places as required.\n\nThis structured approach ensures that the implementation directly reflects the mathematical model provided, leading to a correct and verifiable solution for each test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the Markov model problem for all test cases.\n    \"\"\"\n\n    # State indices correspondence, as per problem statement:\n    # RU (Risky Use): 0\n    # REM (Remission): 1\n    # AUD (Alcohol Use Disorder): 2\n    # D (Death): 3\n    RU_IDX, REM_IDX, AUD_IDX, _ = 0, 1, 2, 3\n\n    test_cases = [\n        # Case 1 (general case, moderate SBIRT effect)\n        {\n            \"P_base\": np.array([\n                [0.80, 0.10, 0.08, 0.02],\n                [0.06, 0.90, 0.02, 0.02],\n                [0.05, 0.10, 0.75, 0.10],\n                [0.00, 0.00, 0.00, 1.00]\n            ]),\n            \"p0\": np.array([0.60, 0.10, 0.30, 0.00]),\n            \"u\": np.array([0.85, 0.95, 0.70, 0.00]),\n            \"r\": 0.03,\n            \"T\": 10,\n            \"s_RU\": 0.03,\n            \"s_AUD\": 0.05,\n        },\n        # Case 2 (boundary: zero SBIRT effect)\n        {\n            \"P_base\": np.array([\n                [0.80, 0.10, 0.08, 0.02],\n                [0.06, 0.90, 0.02, 0.02],\n                [0.05, 0.10, 0.75, 0.10],\n                [0.00, 0.00, 0.00, 1.00]\n            ]),\n            \"p0\": np.array([0.60, 0.10, 0.30, 0.00]),\n            \"u\": np.array([0.85, 0.95, 0.70, 0.00]),\n            \"r\": 0.03,\n            \"T\": 10,\n            \"s_RU\": 0.00,\n            \"s_AUD\": 0.00,\n        },\n        # Case 3 (edge: elevated mortality probabilities)\n        {\n            \"P_base\": np.array([\n                [0.78, 0.10, 0.07, 0.05],\n                [0.05, 0.90, 0.02, 0.03],\n                [0.03, 0.12, 0.70, 0.15],\n                [0.00, 0.00, 0.00, 1.00]\n            ]),\n            \"p0\": np.array([0.50, 0.20, 0.30, 0.00]),\n            \"u\": np.array([0.85, 0.95, 0.70, 0.00]),\n            \"r\": 0.03,\n            \"T\": 10,\n            \"s_RU\": 0.02,\n            \"s_AUD\": 0.04,\n        },\n        # Case 4 (boundary: short horizon)\n        {\n            \"P_base\": np.array([\n                [0.80, 0.10, 0.08, 0.02],\n                [0.06, 0.90, 0.02, 0.02],\n                [0.05, 0.10, 0.75, 0.10],\n                [0.00, 0.00, 0.00, 1.00]\n            ]),\n            \"p0\": np.array([0.70, 0.15, 0.15, 0.00]),\n            \"u\": np.array([0.85, 0.95, 0.70, 0.00]),\n            \"r\": 0.03,\n            \"T\": 1,\n            \"s_RU\": 0.01,\n            \"s_AUD\": 0.02,\n        }\n    ]\n\n    results = []\n\n    def calculate_qaly(P, p0, u, r, T):\n        \"\"\"\n        Calculates the total discounted QALYs over a time horizon T.\n        \n        Args:\n            P (np.ndarray): The 4x4 transition probability matrix.\n            p0 (np.ndarray): The 1x4 initial state probability vector.\n            u (np.ndarray): The 1x4 state utility vector.\n            r (float): The annual discount rate.\n            T (int): The time horizon in cycles.\n\n        Returns:\n            float: The total discounted QALYs.\n        \"\"\"\n        total_qaly = 0.0\n        p_t = p0.copy()\n        for t in range(T):\n            # Calculate QALYs for the current cycle (p_t dot u)\n            qaly_t = np.dot(p_t, u)\n            # Apply discount factor\n            discounted_qaly = qaly_t / ((1 + r) ** t)\n            # Accumulate\n            total_qaly += discounted_qaly\n            # Update state vector for the next cycle\n            p_t = np.dot(p_t, P)\n        return total_qaly\n\n    for case in test_cases:\n        P_base = case[\"P_base\"]\n        p0 = case[\"p0\"]\n        u = case[\"u\"]\n        r = case[\"r\"]\n        T = case[\"T\"]\n        s_RU = case[\"s_RU\"]\n        s_AUD = case[\"s_AUD\"]\n\n        # Calculate QALYs for the baseline scenario\n        qaly_base = calculate_qaly(P_base, p0, u, r, T)\n\n        # Construct the P_sbirt matrix based on the intervention\n        P_sbirt = P_base.copy()\n        # Reallocate from RU -> AUD to RU -> REM\n        P_sbirt[RU_IDX, AUD_IDX] -= s_RU\n        P_sbirt[RU_IDX, REM_IDX] += s_RU\n        # Reallocate from AUD -> AUD to AUD -> REM\n        P_sbirt[AUD_IDX, AUD_IDX] -= s_AUD\n        P_sbirt[AUD_IDX, REM_IDX] += s_AUD\n\n        # Calculate QALYs for the SBIRT scenario\n        qaly_sbirt = calculate_qaly(P_sbirt, p0, u, r, T)\n\n        # Calculate the difference in QALYs and round to 6 decimal places\n        delta_q = qaly_sbirt - qaly_base\n        results.append(delta_q)\n\n    # Final print statement in the exact required format.\n    # The format specifier '.6f' handles rounding as required.\n    print(f\"[{','.join(f'{res:.6f}' for res in results)}]\")\n\nsolve()\n```", "id": "4756917"}]}