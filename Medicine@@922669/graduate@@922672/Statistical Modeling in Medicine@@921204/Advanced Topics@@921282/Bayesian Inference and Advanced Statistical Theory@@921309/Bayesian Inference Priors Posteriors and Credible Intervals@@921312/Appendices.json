{"hands_on_practices": [{"introduction": "This first practice grounds your understanding in a fundamental scenario: estimating a population mean. You will work through the classic Normal-Normal conjugate model, which is a cornerstone of Bayesian statistics for continuous data. This exercise provides hands-on experience in deriving a posterior distribution and constructing a credible interval, yielding a direct probabilistic statement about the true mean systolic blood pressure in a patient cohort.", "problem": "A cardiovascular outcomes trial seeks to estimate the cohort mean systolic blood pressure (SBP) for ambulatory patients receiving standard care. Let $\\theta$ denote the true cohort mean SBP in millimeters of mercury (mmHg). The study collects $n$ independent SBP measurements $y_{1},\\dots,y_{n}$ from distinct patients, modeled as conditionally independent and identically distributed given $\\theta$ with a Normal likelihood having known variance. Specifically, assume the data-generating model $y_{i}\\mid \\theta \\sim \\mathcal{N}(\\theta,\\sigma^{2})$ with known $\\sigma^{2}$, justified by extensive device calibration and historical variability assessments. Prior knowledge from a previous population study is encoded as a Normal prior $\\theta \\sim \\mathcal{N}(\\mu_{0},\\tau_{0}^{2})$.\n\nIn this cohort, suppose $n=40$ patients were sampled, the observed sample mean was $\\bar{y}=125\\,\\text{mmHg}$, the known measurement/biological variability is $\\sigma=15\\,\\text{mmHg}$, and the prior parameters are $\\mu_{0}=130\\,\\text{mmHg}$ and $\\tau_{0}=20\\,\\text{mmHg}$. \n\nUsing Bayes’ theorem, starting from the Normal likelihood and Normal prior density definitions, derive the posterior distribution $p(\\theta\\mid y_{1},\\dots,y_{n})$ and identify its mean $m$ and variance $s^{2}$ by explicit algebra. Then construct the equal-tail $95\\%$ Bayesian credible interval for $\\theta$ under the derived posterior and provide a clinically meaningful interpretation of this interval in the context of cohort mean SBP.\n\nRound the two interval endpoints to four significant figures each. Express the final interval in mmHg. Your final numeric answer should consist only of the two rounded endpoints.", "solution": "The fundamental base is Bayes’ theorem and the Normal density function. The data model is $y_{i}\\mid \\theta \\sim \\mathcal{N}(\\theta,\\sigma^{2})$ with known $\\sigma^{2}$, independently for $i=1,\\dots,n$, and the prior is $\\theta \\sim \\mathcal{N}(\\mu_{0},\\tau_{0}^{2})$.\n\nBy Bayes’ theorem,\n$$\np(\\theta\\mid y_{1},\\dots,y_{n}) \\propto p(y_{1},\\dots,y_{n}\\mid \\theta)\\,p(\\theta)\n= \\left[\\prod_{i=1}^{n} \\frac{1}{\\sqrt{2\\pi\\sigma^{2}}}\\exp\\!\\left\\{-\\frac{1}{2\\sigma^{2}}(y_{i}-\\theta)^{2}\\right\\}\\right]\\cdot \\frac{1}{\\sqrt{2\\pi\\tau_{0}^{2}}}\\exp\\!\\left\\{-\\frac{1}{2\\tau_{0}^{2}}(\\theta-\\mu_{0})^{2}\\right\\}.\n$$\nIgnoring normalizing constants independent of $\\theta$, the kernel in $\\theta$ is\n$$\n\\exp\\!\\left\\{-\\frac{1}{2\\sigma^{2}}\\sum_{i=1}^{n}(y_{i}-\\theta)^{2} - \\frac{1}{2\\tau_{0}^{2}}(\\theta-\\mu_{0})^{2}\\right\\}.\n$$\nExpand $\\sum_{i=1}^{n}(y_{i}-\\theta)^{2}=\\sum_{i=1}^{n}(y_{i}^{2}-2y_{i}\\theta+\\theta^{2})=\\sum_{i=1}^{n}y_{i}^{2}-2\\theta\\sum_{i=1}^{n}y_{i}+n\\theta^{2}$. Terms not involving $\\theta$ factor into the normalizing constant and can be dropped in the kernel. The exponent (up to additive constants) becomes\n$$\n-\\frac{1}{2}\\left[\\left(\\frac{n}{\\sigma^{2}}+\\frac{1}{\\tau_{0}^{2}}\\right)\\theta^{2} - 2\\left(\\frac{\\sum_{i=1}^{n}y_{i}}{\\sigma^{2}}+\\frac{\\mu_{0}}{\\tau_{0}^{2}}\\right)\\theta\\right].\n$$\nComplete the square in $\\theta$:\n$$\n-\\frac{1}{2}\\left(\\frac{n}{\\sigma^{2}}+\\frac{1}{\\tau_{0}^{2}}\\right)\\left[\\theta^{2} - 2\\frac{\\frac{\\sum_{i=1}^{n}y_{i}}{\\sigma^{2}}+\\frac{\\mu_{0}}{\\tau_{0}^{2}}}{\\frac{n}{\\sigma^{2}}+\\frac{1}{\\tau_{0}^{2}}}\\theta\\right]\n= -\\frac{1}{2}\\left(\\frac{n}{\\sigma^{2}}+\\frac{1}{\\tau_{0}^{2}}\\right)\\left[\\theta - \\frac{\\frac{\\sum_{i=1}^{n}y_{i}}{\\sigma^{2}}+\\frac{\\mu_{0}}{\\tau_{0}^{2}}}{\\frac{n}{\\sigma^{2}}+\\frac{1}{\\tau_{0}^{2}}}\\right]^{2} + \\text{constant}.\n$$\nThus, the posterior is Normal,\n$$\n\\theta\\mid y_{1},\\dots,y_{n} \\sim \\mathcal{N}(m,s^{2}),\n$$\nwith\n$$\ns^{2}=\\left(\\frac{n}{\\sigma^{2}}+\\frac{1}{\\tau_{0}^{2}}\\right)^{-1},\\qquad\nm=s^{2}\\left(\\frac{\\sum_{i=1}^{n}y_{i}}{\\sigma^{2}}+\\frac{\\mu_{0}}{\\tau_{0}^{2}}\\right).\n$$\nUsing $\\bar{y}=\\frac{1}{n}\\sum_{i=1}^{n}y_{i}$, this can be written as\n$$\ns^{2}=\\left(\\frac{n}{\\sigma^{2}}+\\frac{1}{\\tau_{0}^{2}}\\right)^{-1},\\qquad\nm=s^{2}\\left(\\frac{n\\bar{y}}{\\sigma^{2}}+\\frac{\\mu_{0}}{\\tau_{0}^{2}}\\right).\n$$\n\nInsert the given values $n=40$, $\\bar{y}=125$, $\\sigma=15$, $\\mu_{0}=130$, $\\tau_{0}=20$ (all in mmHg). First compute the posterior precision and variance:\n$$\n\\frac{n}{\\sigma^{2}}=\\frac{40}{15^{2}}=\\frac{40}{225}=\\frac{8}{45},\\qquad \\frac{1}{\\tau_{0}^{2}}=\\frac{1}{20^{2}}=\\frac{1}{400}.\n$$\nTherefore,\n$$\n\\frac{n}{\\sigma^{2}}+\\frac{1}{\\tau_{0}^{2}}=\\frac{8}{45}+\\frac{1}{400}=\\frac{640}{3600}+\\frac{9}{3600}=\\frac{649}{3600},\n$$\nso\n$$\ns^{2}=\\left(\\frac{649}{3600}\\right)^{-1}=\\frac{3600}{649}.\n$$\nNext compute the posterior mean:\n$$\n\\frac{n\\bar{y}}{\\sigma^{2}}+\\frac{\\mu_{0}}{\\tau_{0}^{2}}=\\frac{40\\cdot 125}{225}+\\frac{130}{400}=\\frac{5000}{225}+\\frac{13}{40}=\\frac{200}{9}+\\frac{13}{40}=\\frac{8000}{360}+\\frac{117}{360}=\\frac{8117}{360}.\n$$\nThus,\n$$\nm=s^{2}\\left(\\frac{n\\bar{y}}{\\sigma^{2}}+\\frac{\\mu_{0}}{\\tau_{0}^{2}}\\right)=\\frac{3600}{649}\\cdot \\frac{8117}{360}=\\frac{10\\cdot 8117}{649}=\\frac{81170}{649}.\n$$\n\nFor an equal-tail $95\\%$ credible interval under a Normal posterior, use the standard Normal quantile $z_{0.975}$ satisfying $\\Pr(|Z|\\le z_{0.975})=0.95$ for $Z\\sim \\mathcal{N}(0,1)$, which is $z_{0.975}\\approx 1.96$. The interval is\n$$\n\\left[m- z_{0.975}\\, s,\\; m+ z_{0.975}\\, s\\right]=\\left[m-1.96\\, s,\\; m+1.96\\, s\\right].\n$$\nCompute $s=\\sqrt{s^{2}}=\\sqrt{\\frac{3600}{649}}=\\frac{60}{\\sqrt{649}}$. Therefore, the interval endpoints are\n$$\nm\\pm 1.96\\, s = \\frac{81170}{649} \\pm 1.96\\cdot \\frac{60}{\\sqrt{649}}.\n$$\nNumerically, $m\\approx 125.06934$ and $s\\approx 2.355206$, so $1.96\\, s\\approx 4.616204$. Hence the endpoints are approximately\n$$\n125.06934 - 4.616204 \\approx 120.45314,\\qquad 125.06934 + 4.616204 \\approx 129.68554.\n$$\nRounded to four significant figures and expressed in millimeters of mercury (mmHg), the equal-tail $95\\%$ Bayesian credible interval for the cohort mean SBP is approximately $120.5$ mmHg to $129.7$ mmHg.\n\nInterpretation: Under the specified Normal prior and Normal likelihood model with known variance, the posterior distribution for the cohort mean SBP assigns probability $0.95$ to the mean lying between $120.5$ mmHg and $129.7$ mmHg. This is a direct probability statement about $\\theta$ conditional on the observed data and prior information, distinct from a frequentist confidence interval which concerns long-run coverage properties across repeated samples.", "answer": "$$\\boxed{\\begin{pmatrix}120.5 & 129.7\\end{pmatrix}}$$", "id": "4953844"}, {"introduction": "Moving from parameter estimation to prediction is a key advantage of the Bayesian framework. This practice explores the Beta-Binomial model, the standard for analyzing proportions, and introduces the concept of the posterior predictive distribution. By working through this example, you will learn how to use your updated beliefs about a parameter, $\\theta$, to forecast outcomes in a new group of patients, a critical task in clinical trial planning and medical decision-making.", "problem": "A phase II oncology study evaluates a binary clinical endpoint, where each enrolled patient either responds ($1$) or does not respond ($0$). Let $Y$ denote the total number of responders among $n$ patients under study. The probability of response for an individual patient is modeled as a random parameter $\\theta \\in (0,1)$, reflecting between-patient and between-study heterogeneity. You are asked to perform Bayesian inference for $\\theta$ and to make a prediction for the number of responders in a future cohort, using principles suitable for medical decision-making.\n\nAssume the following scientifically grounded modeling components:\n- The likelihood for the observed data is $Y \\mid \\theta \\sim \\text{Binomial}(n,\\theta)$, reflecting independent and identically distributed Bernoulli responses within the cohort.\n- The prior for the response probability is $\\theta \\sim \\text{Beta}(\\alpha,\\beta)$, capturing prior clinical knowledge and uncertainty, with hyperparameters $\\alpha > 0$ and $\\beta > 0$.\n\nTasks:\n1. Starting from Bayes’ theorem and the given likelihood-prior specification, derive the posterior distribution $p(\\theta \\mid y)$, where $y$ is the observed responder count.\n2. Use the definition of the posterior predictive distribution (PPD) for a future cohort of size $n_{\\text{new}}$, defined as\n$$\np(X_{\\text{new}} = k \\mid y) \\;=\\; \\int_{0}^{1} p(X_{\\text{new}} = k \\mid \\theta)\\, p(\\theta \\mid y)\\, d\\theta,\n$$\nwith $X_{\\text{new}} \\mid \\theta \\sim \\text{Binomial}(n_{\\text{new}},\\theta)$, to obtain a closed-form expression for $p(X_{\\text{new}} = k \\mid y)$ in terms of standard special functions and combinatorial quantities. Identify the parametric family of this PPD.\n3. Now consider a specific dataset from an immunotherapy cohort: a Beta prior with $\\alpha = 2$ and $\\beta = 2$, and observed data $y = 3$ responders out of $n = 10$ patients. A new cohort of size $n_{\\text{new}} = 6$ is planned. Using your derived PPD, compute a $95\\%$ highest posterior density (HPD) predictive interval for the number of responders $X_{\\text{new}}$ in the new cohort. Construct the HPD interval as the shortest contiguous integer interval on $\\{0,1,\\dots,n_{\\text{new}}\\}$ whose posterior predictive mass is at least $0.95$, by including values of $k$ in descending order of $p(X_{\\text{new}} = k \\mid y)$ until the coverage threshold is reached, and then trimming to a contiguous integer interval if necessary.\n\nProvide the two endpoints of the predictive interval as integers. No rounding is required for the final endpoints. The final answer must be a calculation, expressed as the ordered pair of integers corresponding to the lower and upper endpoints.", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard problem in Bayesian inference applied to a clinical trial setting. All necessary information is provided, and the tasks are clearly defined.\n\n### Part 1: Derivation of the Posterior Distribution\n\nThe goal is to derive the posterior distribution of the response probability $\\theta$ given the observed data $y$. According to Bayes' theorem, the posterior probability density function (PDF) $p(\\theta \\mid y)$ is proportional to the product of the likelihood function $p(y \\mid \\theta)$ and the prior PDF $p(\\theta)$.\n\n$$\np(\\theta \\mid y) \\propto p(y \\mid \\theta) p(\\theta)\n$$\n\nThe givens are:\n- The likelihood function, which is the probability mass function (PMF) of a Binomial distribution:\n$$\np(y \\mid \\theta) = \\binom{n}{y} \\theta^{y} (1-\\theta)^{n-y} \\quad \\text{for } y \\in \\{0, 1, \\dots, n\\}\n$$\n- The prior distribution for $\\theta$, which is a Beta distribution:\n$$\np(\\theta) = \\frac{\\theta^{\\alpha-1} (1-\\theta)^{\\beta-1}}{B(\\alpha, \\beta)} \\quad \\text{for } \\theta \\in (0,1)\n$$\nwhere $B(\\alpha, \\beta) = \\frac{\\Gamma(\\alpha)\\Gamma(\\beta)}{\\Gamma(\\alpha+\\beta)}$ is the Beta function.\n\nWe combine the likelihood and the prior:\n$$\np(\\theta \\mid y) \\propto \\left[ \\binom{n}{y} \\theta^{y} (1-\\theta)^{n-y} \\right] \\left[ \\frac{\\theta^{\\alpha-1} (1-\\theta)^{\\beta-1}}{B(\\alpha, \\beta)} \\right]\n$$\n\nSince we are working with proportionality, we can drop any terms that do not depend on $\\theta$. These are the binomial coefficient $\\binom{n}{y}$ and the normalization constant of the prior $B(\\alpha, \\beta)$.\n\n$$\np(\\theta \\mid y) \\propto \\theta^{y} (1-\\theta)^{n-y} \\cdot \\theta^{\\alpha-1} (1-\\theta)^{\\beta-1}\n$$\n\nCombining the powers of $\\theta$ and $(1-\\theta)$:\n$$\np(\\theta \\mid y) \\propto \\theta^{y+\\alpha-1} (1-\\theta)^{n-y+\\beta-1}\n$$\n\nThis expression is the kernel of a Beta distribution. We can identify the parameters of this posterior Beta distribution by inspection. If a random variable $X$ follows a Beta distribution with parameters $a$ and $b$, its PDF is proportional to $x^{a-1}(1-x)^{b-1}$.\nBy comparing $p(\\theta \\mid y)$ with this form, we see that the posterior distribution for $\\theta$ is a Beta distribution with updated parameters $\\alpha' = \\alpha+y$ and $\\beta' = \\beta+n-y$.\n\nSo, $\\theta \\mid y \\sim \\text{Beta}(\\alpha+y, \\beta+n-y)$. The full posterior PDF is:\n$$\np(\\theta \\mid y) = \\frac{\\theta^{\\alpha+y-1} (1-\\theta)^{\\beta+n-y-1}}{B(\\alpha+y, \\beta+n-y)}\n$$\n\n### Part 2: Derivation of the Posterior Predictive Distribution (PPD)\n\nThe posterior predictive distribution (PPD) for the number of responders $X_{\\text{new}}$ in a future cohort of size $n_{\\text{new}}$ is defined as:\n$$\np(X_{\\text{new}} = k \\mid y) = \\int_{0}^{1} p(X_{\\text{new}} = k \\mid \\theta) \\, p(\\theta \\mid y) \\, d\\theta\n$$\nWe have the following components:\n- The likelihood for the new data, $X_{\\text{new}} \\mid \\theta \\sim \\text{Binomial}(n_{\\text{new}}, \\theta)$, so $p(X_{\\text{new}}=k \\mid \\theta) = \\binom{n_{\\text{new}}}{k} \\theta^k (1-\\theta)^{n_{\\text{new}}-k}$.\n- The posterior distribution for $\\theta$ derived in Part 1, $p(\\theta \\mid y) = \\frac{\\theta^{\\alpha+y-1} (1-\\theta)^{\\beta+n-y-1}}{B(\\alpha+y, \\beta+n-y)}$.\n\nLet $\\alpha' = \\alpha+y$ and $\\beta' = \\beta+n-y$. The posterior is $p(\\theta \\mid y) = \\frac{\\theta^{\\alpha'-1}(1-\\theta)^{\\beta'-1}}{B(\\alpha', \\beta')}$.\nSubstituting these into the integral:\n$$\np(X_{\\text{new}} = k \\mid y) = \\int_{0}^{1} \\left[ \\binom{n_{\\text{new}}}{k} \\theta^k (1-\\theta)^{n_{\\text{new}}-k} \\right] \\left[ \\frac{\\theta^{\\alpha'-1}(1-\\theta)^{\\beta'-1}}{B(\\alpha', \\beta')} \\right] d\\theta\n$$\nWe can pull the terms that do not depend on $\\theta$ out of the integral:\n$$\np(X_{\\text{new}} = k \\mid y) = \\frac{\\binom{n_{\\text{new}}}{k}}{B(\\alpha', \\beta')} \\int_{0}^{1} \\theta^k (1-\\theta)^{n_{\\text{new}}-k} \\theta^{\\alpha'-1}(1-\\theta)^{\\beta'-1} d\\theta\n$$\nCombine the powers of $\\theta$ and $(1-\\theta)$ inside the integral:\n$$\np(X_{\\text{new}} = k \\mid y) = \\frac{\\binom{n_{\\text{new}}}{k}}{B(\\alpha', \\beta')} \\int_{0}^{1} \\theta^{k+\\alpha'-1} (1-\\theta)^{n_{\\text{new}}-k+\\beta'-1} d\\theta\n$$\nThe integral is the kernel of a Beta distribution with parameters $k+\\alpha'$ and $n_{\\text{new}}-k+\\beta'$. The value of this integral is, by definition, the Beta function $B(k+\\alpha', n_{\\text{new}}-k+\\beta')$.\n$$\np(X_{\\text{new}} = k \\mid y) = \\binom{n_{\\text{new}}}{k} \\frac{B(k+\\alpha', n_{\\text{new}}-k+\\beta')}{B(\\alpha', \\beta')}\n$$\nSubstituting back $\\alpha' = \\alpha+y$ and $\\beta' = \\beta+n-y$:\n$$\np(X_{\\text{new}} = k \\mid y) = \\binom{n_{\\text{new}}}{k} \\frac{B(k+\\alpha+y, n_{\\text{new}}-k+\\beta+n-y)}{B(\\alpha+y, \\beta+n-y)}\n$$\nThis is the probability mass function of the **Beta-Binomial distribution**. Thus, the parametric family of the PPD is Beta-Binomial with parameters $n_{\\text{new}}$, $\\alpha' = \\alpha+y$, and $\\beta' = \\beta+n-y$.\n\n### Part 3: Calculation of the 95% HPD Predictive Interval\n\nWe are given the following specific values:\n- Prior hyperparameters: $\\alpha=2$, $\\beta=2$.\n- Observed data: $y=3$ responders out of $n=10$ patients.\n- Future cohort size: $n_{\\text{new}}=6$.\n\nFirst, we determine the parameters of the posterior distribution for $\\theta$:\n- $\\alpha' = \\alpha+y = 2+3 = 5$.\n- $\\beta' = \\beta+n-y = 2+10-3 = 9$.\nSo, the posterior is $\\theta \\mid y \\sim \\text{Beta}(5, 9)$.\n\nThe PPD for $X_{\\text{new}}$ is a Beta-Binomial distribution with parameters $n_{\\text{new}}=6$, $\\alpha'=5$, and $\\beta'=9$. The PMF for $k \\in \\{0, 1, \\dots, 6\\}$ is:\n$$\np(X_{\\text{new}} = k \\mid y) = \\binom{6}{k} \\frac{B(k+5, 6-k+9)}{B(5, 9)} = \\binom{6}{k} \\frac{B(k+5, 15-k)}{B(5, 9)}\n$$\n\nWe calculate the probabilities $p_k = p(X_{\\text{new}} = k \\mid y)$ for each value of $k$:\n- $p_0 = \\binom{6}{0} \\frac{B(5,15)}{B(5,9)} = \\frac{\\Gamma(5)\\Gamma(15)}{\\Gamma(20)} \\frac{\\Gamma(14)}{\\Gamma(5)\\Gamma(9)} = \\frac{14!\\cdot 13!}{19!\\cdot 8!} = \\frac{13 \\cdot 12 \\cdot 11 \\cdot 10 \\cdot 9}{19 \\cdot 18 \\cdot 17 \\cdot 16 \\cdot 15} = \\frac{154440}{1395360} \\approx 0.11068$\n- $p_1 = \\binom{6}{1} \\frac{B(6,14)}{B(5,9)} = 6 \\cdot \\frac{5}{14} p_0 = \\frac{15}{7} p_0 \\approx 0.23717$\n- $p_2 = \\binom{6}{2} \\frac{B(7,13)}{B(5,9)} = 15 \\cdot \\frac{B(7,13)}{B(5,9)}$. We can use the recursion $p_k = p_{k-1} \\frac{n_{\\text{new}}-k+1}{k} \\frac{\\alpha'+k-1}{\\beta'+n_{\\text{new}}-k}$.\n- $p_2 = p_1 \\frac{6-2+1}{2} \\frac{5+2-1}{9+6-2} = p_1 \\frac{5}{2} \\frac{6}{13} = p_1 \\frac{15}{13} \\approx 0.27367$\n- $p_3 = p_2 \\frac{6-3+1}{3} \\frac{5+3-1}{9+6-3} = p_2 \\frac{4}{3} \\frac{7}{12} = p_2 \\frac{7}{9} \\approx 0.21285$\n- $p_4 = p_3 \\frac{6-4+1}{4} \\frac{5+4-1}{9+6-4} = p_3 \\frac{3}{4} \\frac{8}{11} = p_3 \\frac{6}{11} \\approx 0.11610$\n- $p_5 = p_4 \\frac{6-5+1}{5} \\frac{5+5-1}{9+6-5} = p_4 \\frac{2}{5} \\frac{9}{10} = p_4 \\frac{9}{25} \\approx 0.04180$\n- $p_6 = p_5 \\frac{6-6+1}{6} \\frac{5+6-1}{9+6-6} = p_5 \\frac{1}{6} \\frac{10}{9} = p_5 \\frac{5}{27} \\approx 0.00774$\n\nThe sum of probabilities is $\\approx 1.00001$, confirming the calculations.\n\nTo construct the $95\\%$ HPD interval, we sort the values of $k$ by their probabilities in descending order and accumulate the probability until it is at least $0.95$.\nThe probabilities are:\n$p_2 \\approx 0.27367$\n$p_1 \\approx 0.23717$\n$p_3 \\approx 0.21285$\n$p_4 \\approx 0.11610$\n$p_0 \\approx 0.11068$\n$p_5 \\approx 0.04180$\n$p_6 \\approx 0.00774$\n\nThe ordered set of $k$ values is $\\{2, 1, 3, 4, 0, 5, 6\\}$. Let's compute the cumulative sum:\n1. Include $k=2$: Cumulative probability = $p_2 \\approx 0.2737$\n2. Include $k=1$: Cumulative probability = $p_2+p_1 \\approx 0.5108$\n3. Include $k=3$: Cumulative probability = $p_2+p_1+p_3 \\approx 0.7237$\n4. Include $k=4$: Cumulative probability = $p_2+p_1+p_3+p_4 \\approx 0.8398$\n5. Include $k=0$: Cumulative probability = $p_2+p_1+p_3+p_4+p_0 \\approx 0.9505$\n\nThe cumulative probability first exceeds $0.95$ after including $k=0$. The set of values with the highest posterior predictive density is $\\{0, 1, 2, 3, 4\\}$. This set of integers is already a contiguous interval, so no trimming is necessary. The total probability covered by this interval is approximately $95.05\\%$.\nThe interval is $[0, 4]$. The lower endpoint is $0$ and the upper endpoint is $4$.", "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & 4 \\end{pmatrix}}\n$$", "id": "4953902"}, {"introduction": "Real-world statistical modeling often involves challenges like complex likelihoods and incomplete data, where simple analytical solutions do not exist. This advanced practice introduces a Bayesian survival model using the Weibull distribution, incorporating right-censored data common in clinical studies. You will implement a grid approximation to navigate a non-conjugate posterior, learning a powerful numerical technique for making inferences about derived quantities like median survival time.", "problem": "You are given an observational cohort of patients with time-to-event data measured in months. Assume individual survival times follow a Weibull distribution with shape parameter $k$ and scale parameter $\\lambda$. The survival function is defined by the core model $S(t \\mid k,\\lambda) = \\exp\\!\\left(-\\left(\\frac{t}{\\lambda}\\right)^{k}\\right)$, and the density is $f(t \\mid k,\\lambda) = \\frac{k}{\\lambda}\\left(\\frac{t}{\\lambda}\\right)^{k-1}\\exp\\!\\left(-\\left(\\frac{t}{\\lambda}\\right)^{k}\\right)$. Right-censoring is present, with indicators $\\delta_i \\in \\{0,1\\}$, where $\\delta_i = 1$ denotes an observed event and $\\delta_i = 0$ denotes a censored observation at time $t_i$. The likelihood contribution of an individual is $f(t_i \\mid k,\\lambda)$ if $\\delta_i = 1$ and $S(t_i \\mid k,\\lambda)$ if $\\delta_i = 0$.\n\nPlace independent Gamma priors on $k$ and $\\lambda$ in the shape-rate parameterization:\n- $k \\sim \\mathrm{Gamma}(a_k,b_k)$, with prior density $p(k) \\propto k^{a_k - 1}\\exp(-b_k k)$ for $k > 0$,\n- $\\lambda \\sim \\mathrm{Gamma}(a_\\lambda,b_\\lambda)$, with prior density $p(\\lambda) \\propto \\lambda^{a_\\lambda - 1}\\exp(-b_\\lambda \\lambda)$ for $\\lambda > 0$.\n\nThe Bayesian posterior is proportional to the product of the likelihood and priors. Define the median survival time $m$ as the unique value satisfying $S(m \\mid k,\\lambda) = \\frac{1}{2}$.\n\nYour task is to:\n- Formulate the joint posterior $p(k,\\lambda \\mid \\text{data})$ up to proportionality, starting from the fundamental definitions above and using the censoring logic.\n- Construct a numerical approximation of the posterior using a rectangular grid over $(k,\\lambda)$ and compute the induced posterior distribution of the median survival time $m$.\n- For each test case, compute the equal-tailed Bayesian credible interval for $m$ at credible level $0.95$ and report the lower and upper endpoints, expressed in months as decimal fractions rounded to two decimal places.\n\nTest Suite:\n- Test Case $1$ (mixed events and censoring, moderately informative priors):\n  - Times in months $t$: $[6,8,10,12,15,18,22,28,35,40]$.\n  - Event indicators $\\delta$: $[1,1,1,1,1,1,0,0,0,0]$.\n  - Priors: $a_k = 3$, $b_k = 1.5$; $a_\\lambda = 2$, $b_\\lambda = 0.2$.\n  - Grid ranges: $k \\in [0.5,4.0]$, $\\lambda \\in [5.0,60.0]$.\n- Test Case $2$ (heavy censoring, broader priors):\n  - Times in months $t$: $[5,7,9,11,13,16,20,26]$.\n  - Event indicators $\\delta$: $[0,1,0,0,1,0,0,0]$.\n  - Priors: $a_k = 2$, $b_k = 1$; $a_\\lambda = 1.5$, $b_\\lambda = 0.1$.\n  - Grid ranges: $k \\in [0.5,4.0]$, $\\lambda \\in [5.0,60.0]$.\n- Test Case $3$ (all events, moderately informative priors):\n  - Times in months $t$: $[3,4,6,8,9,12,14,17,21,25,30,36]$.\n  - Event indicators $\\delta$: $[1,1,1,1,1,1,1,1,1,1,1,1]$.\n  - Priors: $a_k = 2.5$, $b_k = 1.2$; $a_\\lambda = 2.5$, $b_\\lambda = 0.15$.\n  - Grid ranges: $k \\in [0.5,4.0]$, $\\lambda \\in [5.0,60.0]$.\n\nAlgorithmic constraints and output specification:\n- Use a rectangular grid with $N_k = 200$ equally spaced points for $k$ and $N_\\lambda = 200$ equally spaced points for $\\lambda$ over the specified ranges for each test case.\n- Approximate the posterior by evaluating its unnormalized logarithm on the grid, exponentiating after subtracting the maximal value to avoid underflow, and normalizing over the grid (uniform grid cell areas cancel).\n- Induce the posterior on $m$ by mapping each $(k,\\lambda)$ grid point to $m$ via the definition $S(m \\mid k,\\lambda) = \\frac{1}{2}$, and aggregate weights accordingly.\n- Compute the equal-tailed credible interval endpoints at probabilities $0.025$ and $0.975$ from the induced weighted distribution of $m$.\n- Express the final credible interval endpoints in months, rounded to two decimal places.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in order, the lower and upper credible interval endpoints for Test Case $1$, then for Test Case $2$, then for Test Case $3$. For example, format $[m_{1,\\mathrm{L}},m_{1,\\mathrm{U}},m_{2,\\mathrm{L}},m_{2,\\mathrm{U}},m_{3,\\mathrm{L}},m_{3,\\mathrm{U}}]$, where each entry is a decimal number in months rounded to two decimal places.", "solution": "The user-provided problem is evaluated for validity.\n\n### Step 1: Extract Givens\n- **Model**: Weibull survival model with survival function $S(t \\mid k,\\lambda) = \\exp(-\\left(\\frac{t}{\\lambda}\\right)^{k})$ and probability density function $f(t \\mid k,\\lambda) = \\frac{k}{\\lambda}\\left(\\frac{t}{\\lambda}\\right)^{k-1}\\exp(-\\left(\\frac{t}{\\lambda}\\right)^{k})$.\n- **Data**: For each individual $i$, a time $t_i$ and a right-censoring indicator $\\delta_i \\in \\{0,1\\}$. $\\delta_i=1$ indicates an observed event, $\\delta_i=0$ indicates censoring.\n- **Likelihood**: The contribution for individual $i$ is $L_i = f(t_i \\mid k,\\lambda)^{\\delta_i} S(t_i \\mid k,\\lambda)^{1-\\delta_i}$. The total likelihood is $L = \\prod_i L_i$.\n- **Priors**: Independent Gamma priors for $k$ and $\\lambda$.\n  - $p(k) \\propto k^{a_k - 1}\\exp(-b_k k)$ for $k > 0$.\n  - $p(\\lambda) \\propto \\lambda^{a_\\lambda - 1}\\exp(-b_\\lambda \\lambda)$ for $\\lambda > 0$.\n- **Posterior**: $p(k,\\lambda \\mid \\text{data}) \\propto L(\\text{data} \\mid k,\\lambda) p(k) p(\\lambda)$.\n- **Quantity of Interest**: Median survival time $m$, defined by $S(m \\mid k,\\lambda) = \\frac{1}{2}$.\n- **Task**: Compute the equal-tailed Bayesian credible interval for $m$ at a credible level of $0.95$.\n- **Numerical Method**:\n  - Approximate the joint posterior on a rectangular grid.\n  - Grid size: $N_k = 200$ points for $k$, $N_\\lambda = 200$ points for $\\lambda$.\n  - Evaluate the unnormalized log-posterior on the grid, stabilize by subtracting the maximum value, exponentiate, and normalize.\n  - Induce the posterior for $m$ and find the $0.025$ and $0.975$ quantiles.\n- **Test Cases**:\n  - Case 1: $t = [6,8,10,12,15,18,22,28,35,40]$, $\\delta = [1,1,1,1,1,1,0,0,0,0]$, priors $a_k=3, b_k=1.5, a_\\lambda=2, b_\\lambda=0.2$, grid $k \\in [0.5,4.0], \\lambda \\in [5.0,60.0]$.\n  - Case 2: $t = [5,7,9,11,13,16,20,26]$, $\\delta = [0,1,0,0,1,0,0,0]$, priors $a_k=2, b_k=1, a_\\lambda=1.5, b_\\lambda=0.1$, grid $k \\in [0.5,4.0], \\lambda \\in [5.0,60.0]$.\n  - Case 3: $t = [3,4,6,8,9,12,14,17,21,25,30,36]$, $\\delta = [1,1,1,1,1,1,1,1,1,1,1,1]$, priors $a_k=2.5, b_k=1.2, a_\\lambda=2.5, b_\\lambda=0.15$, grid $k \\in [0.5,4.0], \\lambda \\in [5.0,60.0]$.\n- **Output**: A single line string `\"[m1_L,m1_U,m2_L,m2_U,m3_L,m3_U]\"` with values rounded to two decimal places.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is a standard application of Bayesian inference to survival analysis, a core topic in medical statistics. The Weibull model, censoring, Gamma priors, and credible intervals are all fundamental and well-established concepts. The problem is scientifically sound.\n- **Well-Posed**: The problem is well-posed. The combination of the likelihood and proper priors defines a valid posterior distribution. The numerical grid approximation is a standard, albeit approximate, method for inference when the posterior is intractable. The quantity of interest and the required output are defined precisely.\n- **Objective**: The problem is formulated with precise mathematical definitions and objective data. There are no subjective or ambiguous statements.\n- **Flaws Checklist**:\n  1. No scientific or factual unsoundness.\n  2. The problem is formalizable and directly relevant to the specified topic.\n  3. The setup is complete and self-consistent. All necessary data and parameters are provided for each test case.\n  4. The data and parameter values are realistic for a clinical study context.\n  5. The problem structure is sound and leads to a unique, meaningful solution via the specified numerical method.\n  6. The problem is non-trivial, requiring derivation of the posterior and a correct numerical implementation.\n  7. The results are mathematically verifiable.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Principle-Based Solution\n\nThe solution requires the application of Bayesian inference principles to a survival analysis model. We first formulate the posterior distribution for the model parameters and then use a numerical grid approximation to compute properties of this distribution.\n\n**1. Log-Posterior Formulation**\n\nThe posterior distribution is proportional to the product of the likelihood and the priors:\n$$p(k, \\lambda \\mid \\text{data}) \\propto L(\\text{data} \\mid k, \\lambda) \\cdot p(k) \\cdot p(\\lambda)$$\nTo maintain numerical stability, we work with the logarithm of the posterior:\n$$\\log p(k, \\lambda \\mid \\text{data}) = \\log L(\\text{data} \\mid k, \\lambda) + \\log p(k) + \\log p(\\lambda) + C$$\nwhere $C$ is a normalization constant.\n\nThe log-likelihood for $N$ observations $(t_i, \\delta_i)$ is:\n$$\\log L = \\sum_{i=1}^{N} \\left[ \\delta_i \\log f(t_i \\mid k, \\lambda) + (1-\\delta_i) \\log S(t_i \\mid k, \\lambda) \\right]$$\nSubstituting the definitions for the Weibull density and survival function:\n$$\\log f(t \\mid k, \\lambda) = \\log k - k \\log \\lambda + (k-1) \\log t - \\left(\\frac{t}{\\lambda}\\right)^k$$\n$$\\log S(t \\mid k, \\lambda) = -\\left(\\frac{t}{\\lambda}\\right)^k$$\nThe log-likelihood simplifies to:\n$$\\log L = \\sum_{i=1}^{N} \\left[ \\delta_i \\left( \\log k - k \\log \\lambda + (k-1) \\log t_i \\right) - \\left(\\frac{t_i}{\\lambda}\\right)^k \\right]$$\nLet $N_e = \\sum_{i=1}^N \\delta_i$ be the total number of events. Grouping terms gives:\n$$\\log L = N_e (\\log k - k \\log \\lambda) + (k-1) \\sum_{i: \\delta_i=1} \\log t_i - \\sum_{i=1}^N \\left(\\frac{t_i}{\\lambda}\\right)^k$$\nThe log-priors (up to constants) are:\n$$\\log p(k) = (a_k - 1)\\log k - b_k k$$\n$$\\log p(\\lambda) = (a_\\lambda - 1)\\log \\lambda - b_\\lambda \\lambda$$\nCombining all terms, the unnormalized log-posterior is:\n$$\\log p(k, \\lambda \\mid \\text{data}) \\propto (N_e + a_k - 1)\\log k - b_k k + (-N_e k + a_\\lambda - 1)\\log \\lambda - b_\\lambda \\lambda + (k-1)\\sum_{i:\\delta_i=1}\\log t_i - \\sum_{i=1}^N \\frac{t_i^k}{\\lambda^k}$$\nThis is the core formula to be evaluated on the parameter grid.\n\n**2. Numerical Approximation on a Grid**\n\nWe discretize the parameter space of $(k, \\lambda)$ into a grid of $N_k \\times N_\\lambda$ points.\nThe unnormalized log-posterior is computed for each grid point $(k_j, \\lambda_l)$. To convert these log-probabilities to probabilities without numerical underflow, we first subtract the maximum value of the log-posterior across the grid, then exponentiate:\n$$p'_{jl} = \\exp(\\log p(k_j, \\lambda_l) - \\max_{j,l}(\\log p(k_j, \\lambda_l)))$$\nThe resulting values $p'_{jl}$ are then normalized to sum to $1$ to form a discrete posterior probability mass function:\n$$p_{jl} = \\frac{p'_{jl}}{\\sum_{j,l} p'_{jl}}$$\n\n**3. Posterior of the Median Survival Time**\n\nThe median survival time, $m$, is defined by $S(m \\mid k, \\lambda) = 1/2$. Solving for $m$:\n$$\\exp\\left(-\\left(\\frac{m}{\\lambda}\\right)^k\\right) = \\frac{1}{2} \\implies -\\left(\\frac{m}{\\lambda}\\right)^k = \\log\\left(\\frac{1}{2}\\right) = -\\log(2)$$\n$$\\left(\\frac{m}{\\lambda}\\right)^k = \\log(2) \\implies m = \\lambda (\\log 2)^{1/k}$$\nThis transformation is applied to each point $(k_j, \\lambda_l)$ on the grid, yielding a grid of median survival times $m_{jl}$, each with posterior probability $p_{jl}$. This gives a discrete posterior distribution for $m$.\n\n**4. Credible Interval Calculation**\n\nTo find the equal-tailed $95\\%$ credible interval, we need the $0.025$ and $0.975$ quantiles of the posterior distribution of $m$. We construct the cumulative distribution function (CDF) from the discrete posterior of $m$:\n1. Flatten the $m_{jl}$ and $p_{jl}$ grids into one-dimensional arrays.\n2. Sort the $m$ values in ascending order, applying the same permutation to their associated probabilities.\n3. Compute the cumulative sum of the sorted probabilities to get the empirical CDF.\n4. Linearly interpolate on this CDF to find the values of $m$ corresponding to cumulative probabilities of $0.025$ and $0.975$. These values are the lower and upper bounds of the credible interval.\n\nThe implementation will follow these steps for each test case provided.", "answer": "[13.11,35.41,12.72,55.88,12.44,22.08]", "id": "4953836"}]}