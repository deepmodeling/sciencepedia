{"hands_on_practices": [{"introduction": "A common goal in diagnostic medicine is to select a single \"optimal\" threshold for a continuous biomarker. Youden’s index, defined as $J(t) = \\mathrm{TPR}(t) - \\mathrm{FPR}(t)$, offers one principled way to do this by finding the point on the ROC curve furthest from the line of no-discrimination. This exercise challenges you to derive this optimal threshold from first principles for the general case of two normal distributions with unequal variances, providing a robust tool for test evaluation.", "problem": "A continuous diagnostic biomarker $X$ is used to detect a disease in a cohort. The decision rule classifies an individual as test-positive if $X \\ge t$ for some threshold $t \\in \\mathbb{R}$. In this cohort, the conditional distribution of $X$ given non-disease is normal with mean $\\mu_{0}$ and variance $\\sigma_{0}^{2}$, and the conditional distribution of $X$ given disease is normal with mean $\\mu_{1}$ and variance $\\sigma_{1}^{2}$. Specifically, suppose $X \\mid (D=0) \\sim \\mathcal{N}(\\mu_{0},\\sigma_{0}^{2})$ with $\\mu_{0}=5$ and $\\sigma_{0}=1.5$, and $X \\mid (D=1) \\sim \\mathcal{N}(\\mu_{1},\\sigma_{1}^{2})$ with $\\mu_{1}=8$ and $\\sigma_{1}=2$. For any threshold $t$, define the true positive rate $\\mathrm{TPR}(t) = \\mathbb{P}(X \\ge t \\mid D=1)$, the false positive rate $\\mathrm{FPR}(t) = \\mathbb{P}(X \\ge t \\mid D=0)$, and Youden’s index $J(t) = \\mathrm{TPR}(t) - \\mathrm{FPR}(t)$, which is a functional of the receiver operating characteristic (ROC) curve.\n\nStarting only from these core definitions and the stated distributional assumptions, derive the threshold $t^{\\star}$ that maximizes Youden’s index $J(t)$ and compute its numerical value for the given parameters. Do not assume equal variances or invoke any unproven shortcuts. Round your final numerical answer to four significant figures. Express your answer as the optimal threshold value $t^{\\star}$ (no units).", "solution": "The problem is to find the threshold $t^{\\star}$ that maximizes Youden's index, $J(t)$, for a diagnostic test based on a continuous biomarker $X$.\n\nFirst, we validate the problem statement.\n**Step 1: Extract Givens**\n- Biomarker: $X$\n- Decision rule: Test-positive if $X \\ge t$.\n- Distribution for non-diseased individuals ($D=0$): $X \\mid (D=0) \\sim \\mathcal{N}(\\mu_{0},\\sigma_{0}^{2})$, where $\\mu_{0}=5$ and $\\sigma_{0}=1.5$.\n- Distribution for diseased individuals ($D=1$): $X \\mid (D=1) \\sim \\mathcal{N}(\\mu_{1},\\sigma_{1}^{2})$, where $\\mu_{1}=8$ and $\\sigma_{1}=2$.\n- True Positive Rate: $\\mathrm{TPR}(t) = \\mathbb{P}(X \\ge t \\mid D=1)$.\n- False Positive Rate: $\\mathrm{FPR}(t) = \\mathbb{P}(X \\ge t \\mid D=0)$.\n- Youden’s Index: $J(t) = \\mathrm{TPR}(t) - \\mathrm{FPR}(t)$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, employing standard definitions and models from statistical decision theory and biostatistics (Normal distribution, ROC analysis, Youden's index). It is well-posed, as it asks to maximize a well-defined, continuous, and differentiable function. The problem is objective, self-contained, and consistent, providing all necessary parameters and definitions. The parameter values are realistic. The task is non-trivial, requiring derivation and calculation, particularly because the variances are not equal. The problem is mathematically verifiable.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. We may proceed with the solution.\n\nThe goal is to find $t^{\\star} = \\arg\\max_{t} J(t)$. We begin by expressing $J(t)$ in an analytical form.\nLet $\\Phi(z)$ be the cumulative distribution function (CDF) of the standard normal distribution, $\\mathcal{N}(0,1)$. The probability of a normal random variable $Y \\sim \\mathcal{N}(\\mu, \\sigma^2)$ being greater than or equal to a value $t$ is given by:\n$$ \\mathbb{P}(Y \\ge t) = 1 - \\mathbb{P}(Y < t) = 1 - \\Phi\\left(\\frac{t-\\mu}{\\sigma}\\right) $$\nUsing this, we can define the $\\mathrm{TPR}(t)$ and $\\mathrm{FPR}(t)$ for the given distributions.\n\nFor the diseased population, $X_1 \\sim \\mathcal{N}(\\mu_1, \\sigma_1^2)$:\n$$ \\mathrm{TPR}(t) = \\mathbb{P}(X \\ge t \\mid D=1) = 1 - \\Phi\\left(\\frac{t-\\mu_1}{\\sigma_1}\\right) $$\nFor the non-diseased population, $X_0 \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$:\n$$ \\mathrm{FPR}(t) = \\mathbb{P}(X \\ge t \\mid D=0) = 1 - \\Phi\\left(\\frac{t-\\mu_0}{\\sigma_0}\\right) $$\nNow, we can write the expression for Youden's index, $J(t)$:\n$$ J(t) = \\mathrm{TPR}(t) - \\mathrm{FPR}(t) = \\left(1 - \\Phi\\left(\\frac{t-\\mu_1}{\\sigma_1}\\right)\\right) - \\left(1 - \\Phi\\left(\\frac{t-\\mu_0}{\\sigma_0}\\right)\\right) $$\n$$ J(t) = \\Phi\\left(\\frac{t-\\mu_0}{\\sigma_0}\\right) - \\Phi\\left(\\frac{t-\\mu_1}{\\sigma_1}\\right) $$\nTo find the threshold $t$ that maximizes $J(t)$, we compute its derivative with respect to $t$ and set it to zero. Let $\\phi(z)$ be the probability density function (PDF) of the standard normal distribution, which is the derivative of its CDF, $\\frac{d\\Phi(z)}{dz} = \\phi(z)$. Using the chain rule:\n$$ \\frac{dJ}{dt} = \\frac{d}{dt}\\left[\\Phi\\left(\\frac{t-\\mu_0}{\\sigma_0}\\right)\\right] - \\frac{d}{dt}\\left[\\Phi\\left(\\frac{t-\\mu_1}{\\sigma_1}\\right)\\right] $$\n$$ \\frac{dJ}{dt} = \\phi\\left(\\frac{t-\\mu_0}{\\sigma_0}\\right) \\cdot \\frac{1}{\\sigma_0} - \\phi\\left(\\frac{t-\\mu_1}{\\sigma_1}\\right) \\cdot \\frac{1}{\\sigma_1} $$\nThe term $\\frac{1}{\\sigma} \\phi\\left(\\frac{t-\\mu}{\\sigma}\\right)$ is the PDF of a general normal distribution $\\mathcal{N}(\\mu, \\sigma^2)$, which we denote as $f(t; \\mu, \\sigma^2)$. So, we can write the derivative as:\n$$ \\frac{dJ}{dt} = f(t; \\mu_0, \\sigma_0^2) - f(t; \\mu_1, \\sigma_1^2) $$\nSetting the derivative to zero to find the critical points $t^{\\star}$:\n$$ f(t^{\\star}; \\mu_0, \\sigma_0^2) = f(t^{\\star}; \\mu_1, \\sigma_1^2) $$\nThis result signifies that the optimal threshold for Youden's index is the value of $t$ where the probability density functions of the two classes intersect. Now we solve this equation for $t^{\\star}$.\n$$ \\frac{1}{\\sigma_0\\sqrt{2\\pi}} \\exp\\left(-\\frac{(t^{\\star}-\\mu_0)^2}{2\\sigma_0^2}\\right) = \\frac{1}{\\sigma_1\\sqrt{2\\pi}} \\exp\\left(-\\frac{(t^{\\star}-\\mu_1)^2}{2\\sigma_1^2}\\right) $$\nTaking the natural logarithm of both sides:\n$$ \\ln\\left(\\frac{1}{\\sigma_0}\\right) - \\frac{(t^{\\star}-\\mu_0)^2}{2\\sigma_0^2} = \\ln\\left(\\frac{1}{\\sigma_1}\\right) - \\frac{(t^{\\star}-\\mu_1)^2}{2\\sigma_1^2} $$\nRearranging the terms yields:\n$$ \\frac{(t^{\\star}-\\mu_1)^2}{2\\sigma_1^2} - \\frac{(t^{\\star}-\\mu_0)^2}{2\\sigma_0^2} = \\ln\\left(\\frac{\\sigma_0}{\\sigma_1}\\right) $$\nMultiplying by $2\\sigma_0^2\\sigma_1^2$ to clear the denominators:\n$$ \\sigma_0^2(t^{\\star}-\\mu_1)^2 - \\sigma_1^2(t^{\\star}-\\mu_0)^2 = 2\\sigma_0^2\\sigma_1^2 \\ln\\left(\\frac{\\sigma_0}{\\sigma_1}\\right) $$\nExpanding the squared terms:\n$$ \\sigma_0^2(t^{\\star 2} - 2\\mu_1 t^{\\star} + \\mu_1^2) - \\sigma_1^2(t^{\\star 2} - 2\\mu_0 t^{\\star} + \\mu_0^2) = 2\\sigma_0^2\\sigma_1^2 \\ln\\left(\\frac{\\sigma_0}{\\sigma_1}\\right) $$\nGrouping terms by powers of $t^{\\star}$, we obtain a quadratic equation $At^{\\star 2} + Bt^{\\star} + C = 0$:\n$$ (\\sigma_0^2 - \\sigma_1^2)t^{\\star 2} + 2(\\mu_0\\sigma_1^2 - \\mu_1\\sigma_0^2)t^{\\star} + (\\mu_1^2\\sigma_0^2 - \\mu_0^2\\sigma_1^2 - 2\\sigma_0^2\\sigma_1^2 \\ln\\left(\\frac{\\sigma_0}{\\sigma_1}\\right)) = 0 $$\nThe coefficients are:\n$A = \\sigma_0^2 - \\sigma_1^2$\n$B = 2(\\mu_0\\sigma_1^2 - \\mu_1\\sigma_0^2)$\n$C = \\mu_1^2\\sigma_0^2 - \\mu_0^2\\sigma_1^2 - 2\\sigma_0^2\\sigma_1^2 \\ln\\left(\\frac{\\sigma_0}{\\sigma_1}\\right)$\n\nNow, we substitute the given numerical values: $\\mu_{0}=5$, $\\sigma_{0}=1.5$, $\\mu_{1}=8$, $\\sigma_{1}=2$.\n$\\sigma_0^2 = (1.5)^2 = 2.25$\n$\\sigma_1^2 = (2)^2 = 4$\n\n$A = 2.25 - 4 = -1.75$\n$B = 2(5 \\cdot 4 - 8 \\cdot 2.25) = 2(20 - 18) = 4$\n$C = 8^2 \\cdot 2.25 - 5^2 \\cdot 4 - 2(2.25)(4) \\ln\\left(\\frac{1.5}{2}\\right) = 64 \\cdot 2.25 - 25 \\cdot 4 - 18 \\ln(0.75)$\n$C = 144 - 100 - 18 \\ln(0.75) = 44 - 18 \\ln(0.75)$\n\nUsing $\\ln(0.75) \\approx -0.28768$:\n$C \\approx 44 - 18(-0.28768) \\approx 44 + 5.17824 = 49.17824$\n\nThe quadratic equation for $t^{\\star}$ is:\n$$ -1.75t^{\\star 2} + 4t^{\\star} + 49.17824 = 0 $$\nWe solve for $t^{\\star}$ using the quadratic formula $t^{\\star} = \\frac{-B \\pm \\sqrt{B^2 - 4AC}}{2A}$:\n$t^{\\star} = \\frac{-4 \\pm \\sqrt{4^2 - 4(-1.75)(49.17824)}}{2(-1.75)}$\n$t^{\\star} = \\frac{-4 \\pm \\sqrt{16 + 7(49.17824)}}{-3.5}$\n$t^{\\star} = \\frac{-4 \\pm \\sqrt{16 + 344.24768}}{-3.5}$\n$t^{\\star} = \\frac{-4 \\pm \\sqrt{360.24768}}{-3.5}$\n$t^{\\star} = \\frac{-4 \\pm 18.98019}{-3.5}$\n\nThis gives two solutions:\n$t_1^{\\star} = \\frac{-4 + 18.98019}{-3.5} = \\frac{14.98019}{-3.5} \\approx -4.28005$\n$t_2^{\\star} = \\frac{-4 - 18.98019}{-3.5} = \\frac{-22.98019}{-3.5} \\approx 6.56577$\n\nSince the means of the non-diseased and diseased populations are $\\mu_0 = 5$ and $\\mu_1 = 8$ respectively, with the diseased population having a higher mean biomarker value, the optimal threshold $t^{\\star}$ is expected to lie between these two values. The solution $t_1^{\\star} \\approx -4.28$ is not medically or statistically meaningful in this context. The solution $t_2^{\\star} \\approx 6.566$ lies between $5$ and $8$. A formal analysis of the second derivative of $J(t)$ would confirm that $t_2^{\\star}$ corresponds to a maximum and $t_1^{\\star}$ corresponds to a minimum of Youden's Index. Thus, the optimal threshold is $t^{\\star} = t_2^{\\star}$.\n\nRounding the result to four significant figures:\n$t^{\\star} \\approx 6.566$", "answer": "$$\\boxed{6.566}$$", "id": "4963858"}, {"introduction": "While Youden's index is a valuable measure of a test's intrinsic performance, the \"best\" threshold in a clinical setting often depends on external factors. This practice shifts the focus from pure classification accuracy to a decision-theoretic framework. You will derive the optimal threshold that minimizes the expected cost of misclassification, learning how disease prevalence $\\pi$ and the specific costs of false positives ($c_{\\mathrm{FP}}$) and false negatives ($c_{\\mathrm{FN}}$) combine to define the most rational decision rule.", "problem": "A medical screening test outputs a continuous diagnostic score $S \\in \\mathbb{R}$. In a target clinical population, the disease indicator $D \\in \\{0,1\\}$ has prevalence $P(D=1)=\\pi$ with $\\pi \\in (0,1)$. You adopt a threshold rule: declare $D=1$ (disease present) if and only if $S \\ge \\tau$, where $\\tau \\in \\mathbb{R}$ is a threshold to be chosen. The receiver operating characteristic (ROC) curve is induced by varying $\\tau$.\n\nAssume the following class-conditional distributions for the score:\n- Conditional on disease, $S \\mid D=1 \\sim \\mathcal{N}(\\mu_{1},\\sigma^{2})$.\n- Conditional on no disease, $S \\mid D=0 \\sim \\mathcal{N}(\\mu_{0},\\sigma^{2})$.\n\nHere $\\mu_{1},\\mu_{0} \\in \\mathbb{R}$, $\\sigma > 0$, and $\\mu_{1} > \\mu_{0}$.\n\nAssign decision costs consistent with a one-step screening decision: a false negative (missed disease) incurs cost $c_{\\mathrm{FN}}>0$, a false positive (unnecessary follow-up) incurs cost $c_{\\mathrm{FP}}>0$, and correct decisions have zero cost. Let the expected cost per screened individual be defined in terms of the threshold $\\tau$ via the joint distribution of $(S,D)$, using the standard definitions of sensitivity and specificity that underlie the receiver operating characteristic (ROC) curve.\n\nStarting only from the fundamental definitions of expected cost under misclassification and the above distributional assumptions, derive the closed-form expression for the threshold $\\tau^{\\star}$ that minimizes the expected cost as a function of $\\mu_{0}$, $\\mu_{1}$, $\\sigma$, $c_{\\mathrm{FN}}$, $c_{\\mathrm{FP}}$, and $\\pi$. Express your final answer as a single simplified algebraic expression in these symbols. No numerical evaluation is required and no rounding is permitted. The final answer must be a single symbolic mathematical expression.", "solution": "We begin from the definitions that connect binary classification performance to the receiver operating characteristic (ROC) curve and expected cost. For a threshold $\\tau \\in \\mathbb{R}$, the rule classifies $D=1$ if and only if $S \\ge \\tau$. The false negative probability is $P(S<\\tau \\mid D=1)$ and the false positive probability is $P(S \\ge \\tau \\mid D=0)$. With prevalence $P(D=1)=\\pi$ and $P(D=0)=1-\\pi$, and costs $c_{\\mathrm{FN}}>0$ and $c_{\\mathrm{FP}}>0$ for false negative and false positive decisions respectively, the expected cost per individual as a function of $\\tau$ is\n$$\nR(\\tau) \\;=\\; c_{\\mathrm{FN}} \\,\\pi \\,P(S<\\tau \\mid D=1) \\;+\\; c_{\\mathrm{FP}} \\,(1-\\pi)\\,P(S\\ge \\tau \\mid D=0).\n$$\nUnder the assumed Gaussian models, denote the class-conditional cumulative distribution functions (CDFs) by\n$$\nF_{1}(\\tau) \\;=\\; P(S \\le \\tau \\mid D=1) \\;=\\; \\Phi\\!\\left(\\frac{\\tau-\\mu_{1}}{\\sigma}\\right), \\qquad\nF_{0}(\\tau) \\;=\\; P(S \\le \\tau \\mid D=0) \\;=\\; \\Phi\\!\\left(\\frac{\\tau-\\mu_{0}}{\\sigma}\\right),\n$$\nwhere $\\Phi$ is the standard normal CDF. Then $P(S<\\tau \\mid D=1)=F_{1}(\\tau)$, and $P(S\\ge\\tau \\mid D=0)=1-F_{0}(\\tau)$. The expected cost becomes\n$$\nR(\\tau) \\;=\\; c_{\\mathrm{FN}}\\,\\pi\\,F_{1}(\\tau) \\;+\\; c_{\\mathrm{FP}}\\,(1-\\pi)\\,\\bigl(1-F_{0}(\\tau)\\bigr).\n$$\nTo minimize $R(\\tau)$ over $\\tau$, we differentiate with respect to $\\tau$ and set the derivative equal to zero. The derivative of a cumulative distribution function is its density, so with class-conditional densities\n$$\nf_{1}(\\tau) \\;=\\; \\frac{1}{\\sigma}\\,\\varphi\\!\\left(\\frac{\\tau-\\mu_{1}}{\\sigma}\\right), \\qquad\nf_{0}(\\tau) \\;=\\; \\frac{1}{\\sigma}\\,\\varphi\\!\\left(\\frac{\\tau-\\mu_{0}}{\\sigma}\\right),\n$$\nwhere $\\varphi$ is the standard normal density, we have\n$$\n\\frac{d}{d\\tau}R(\\tau) \\;=\\; c_{\\mathrm{FN}}\\,\\pi\\,f_{1}(\\tau) \\;-\\; c_{\\mathrm{FP}}\\,(1-\\pi)\\,f_{0}(\\tau).\n$$\nA stationary point $\\tau^{\\star}$ satisfies\n$$\nc_{\\mathrm{FN}}\\,\\pi\\,f_{1}(\\tau^{\\star}) \\;=\\; c_{\\mathrm{FP}}\\,(1-\\pi)\\,f_{0}(\\tau^{\\star}).\n$$\nRearranging gives the likelihood ratio condition\n$$\n\\frac{f_{1}(\\tau^{\\star})}{f_{0}(\\tau^{\\star})} \\;=\\; \\frac{c_{\\mathrm{FP}}\\,(1-\\pi)}{c_{\\mathrm{FN}}\\,\\pi}.\n$$\nBecause $f_{1}$ and $f_{0}$ are Gaussian densities with equal variance, the left-hand side is a strictly increasing function of $\\tau$ (since $\\mu_{1}>\\mu_{0}$), ensuring a unique solution that minimizes $R(\\tau)$.\n\nWe now compute $f_{1}(\\tau)/f_{0}(\\tau)$ explicitly. The class-conditional densities are\n$$\nf_{1}(s) \\;=\\; \\frac{1}{\\sigma\\sqrt{2\\pi}}\\exp\\!\\left(-\\frac{(s-\\mu_{1})^{2}}{2\\sigma^{2}}\\right), \\qquad\nf_{0}(s) \\;=\\; \\frac{1}{\\sigma\\sqrt{2\\pi}}\\exp\\!\\left(-\\frac{(s-\\mu_{0})^{2}}{2\\sigma^{2}}\\right).\n$$\nThus,\n$$\n\\ln\\!\\left(\\frac{f_{1}(s)}{f_{0}(s)}\\right) \\;=\\; -\\frac{(s-\\mu_{1})^{2}}{2\\sigma^{2}} + \\frac{(s-\\mu_{0})^{2}}{2\\sigma^{2}}\n\\;=\\; \\frac{(\\mu_{1}-\\mu_{0})}{\\sigma^{2}}\\,s \\;-\\; \\frac{\\mu_{1}^{2}-\\mu_{0}^{2}}{2\\sigma^{2}}.\n$$\nSetting $s=\\tau^{\\star}$ and equating to $\\ln\\!\\left(\\frac{c_{\\mathrm{FP}}(1-\\pi)}{c_{\\mathrm{FN}}\\pi}\\right)$ yields\n$$\n\\frac{(\\mu_{1}-\\mu_{0})}{\\sigma^{2}}\\,\\tau^{\\star} \\;-\\; \\frac{\\mu_{1}^{2}-\\mu_{0}^{2}}{2\\sigma^{2}} \\;=\\; \\ln\\!\\left(\\frac{c_{\\mathrm{FP}}(1-\\pi)}{c_{\\mathrm{FN}}\\pi}\\right).\n$$\nSolving for $\\tau^{\\star}$ gives\n$$\n\\tau^{\\star} \\;=\\; \\frac{\\sigma^{2}}{\\mu_{1}-\\mu_{0}}\\,\\ln\\!\\left(\\frac{c_{\\mathrm{FP}}(1-\\pi)}{c_{\\mathrm{FN}}\\pi}\\right) \\;+\\; \\frac{\\mu_{1}^{2}-\\mu_{0}^{2}}{2(\\mu_{1}-\\mu_{0})}.\n$$\nRecognizing that $\\frac{\\mu_{1}^{2}-\\mu_{0}^{2}}{2(\\mu_{1}-\\mu_{0})}=\\frac{\\mu_{1}+\\mu_{0}}{2}$, we obtain the simplified closed form\n$$\n\\tau^{\\star} \\;=\\; \\frac{\\mu_{1}+\\mu_{0}}{2} \\;+\\; \\frac{\\sigma^{2}}{\\mu_{1}-\\mu_{0}}\\,\\ln\\!\\left(\\frac{c_{\\mathrm{FP}}(1-\\pi)}{c_{\\mathrm{FN}}\\pi}\\right).\n$$\nThis $\\tau^{\\star}$ uniquely minimizes the expected cost $R(\\tau)$ given the specified Gaussian score model, prevalence $\\pi$, and misclassification costs, and corresponds geometrically to the point on the receiver operating characteristic (ROC) curve where the tangent slope equals $\\frac{c_{\\mathrm{FP}}(1-\\pi)}{c_{\\mathrm{FN}}\\pi}$.", "answer": "$$\\boxed{\\frac{\\mu_{1}+\\mu_{0}}{2}+\\frac{\\sigma^{2}}{\\mu_{1}-\\mu_{0}}\\ln\\!\\left(\\frac{c_{\\mathrm{FP}}(1-\\pi)}{c_{\\mathrm{FN}}\\pi}\\right)}$$", "id": "4963859"}, {"introduction": "Theoretical models provide invaluable insight, but ROC analysis in practice begins with empirical data. This exercise transitions from deriving properties of theoretical curves to computing them from a given sample of scores and true labels. You will implement the complete workflow for calculating the empirical Area Under the Curve (AUC), partial AUC, and Youden's index, tackling the critical, real-world details of handling score ties and ensuring numerical stability.", "problem": "You are given the task of implementing a numerically stable computation of the Receiver Operating Characteristic (ROC) curve and related summary functionals for diagnostic test scores in a medical classification setting. The implementation must be grounded in the following fundamental definitions.\n\n1. Observations consist of pairs $\\{(s_i, y_i)\\}_{i=1}^n$ where $s_i \\in \\mathbb{R}$ is a real-valued diagnostic score and $y_i \\in \\{0,1\\}$ is the class label indicating non-diseased ($y_i=0$) or diseased ($y_i=1$).\n\n2. For any threshold $\\tau \\in \\mathbb{R} \\cup \\{-\\infty, +\\infty\\}$, define a classifier that predicts positive iff $s_i \\ge \\tau$. Let $P = \\sum_{i=1}^n \\mathbb{I}(y_i=1)$ and $N = \\sum_{i=1}^n \\mathbb{I}(y_i=0)$ denote the number of positives and negatives. The true positive rate (TPR, sensitivity) and false positive rate (FPR, 1-specificity) at threshold $\\tau$ are\n$$\n\\mathrm{TPR}(\\tau) = \\frac{1}{P} \\sum_{i=1}^n \\mathbb{I}(y_i=1)\\,\\mathbb{I}(s_i \\ge \\tau),\\quad\n\\mathrm{FPR}(\\tau) = \\frac{1}{N} \\sum_{i=1}^n \\mathbb{I}(y_i=0)\\,\\mathbb{I}(s_i \\ge \\tau).\n$$\nThe ROC curve is the set of points $\\{(\\mathrm{FPR}(\\tau), \\mathrm{TPR}(\\tau))\\}$ as $\\tau$ varies from $+\\infty$ to $-\\infty$.\n\n3. The area under the curve (AUC) is defined as the probability that a randomly chosen positive score exceeds a randomly chosen negative score, with ties receiving half credit. Equivalently, if $\\{s_i: y_i=1\\}$ are positive scores and $\\{s_j: y_j=0\\}$ are negative scores, then\n$$\n\\mathrm{AUC} = \\frac{1}{PN} \\sum_{i: y_i=1} \\sum_{j: y_j=0} \\left[ \\mathbb{I}(s_i > s_j) + \\tfrac{1}{2}\\mathbb{I}(s_i = s_j) \\right].\n$$\n\n4. The partial area under the curve up to a false positive rate cap $\\alpha$ is the integral of $\\mathrm{TPR}$ with respect to $\\mathrm{FPR}$ from $0$ to $\\alpha$, computed on the empirical ROC curve using linear interpolation along the segments between successive ROC points. The normalized partial AUC in $[0,\\alpha]$ is obtained by dividing this partial area by $\\alpha$, so that it lies in $[0,1]$:\n$$\n\\mathrm{pAUC}_\\alpha^{\\mathrm{norm}} = \\frac{1}{\\alpha} \\int_{0}^{\\alpha} \\mathrm{TPR}(x)\\,dx.\n$$\n\n5. The Youden index $J(\\tau)$ at threshold $\\tau$ is\n$$\nJ(\\tau) = \\mathrm{TPR}(\\tau) - \\mathrm{FPR}(\\tau).\n$$\nDefine $J^\\star = \\max_{\\tau} J(\\tau)$ and select a maximizing threshold $\\tau^\\star$ as the smallest finite threshold among those achieving $J^\\star$.\n\nNumerical stability requirements. In practical computation with floating-point scores, exact equality $s_i = s_j$ may be ill-posed due to rounding. To robustly handle near ties:\n- Use an absolute tolerance $\\varepsilon = 10^{-12}$ to treat scores $a$ and $b$ as tied for ranking if $|a-b| \\le \\varepsilon$.\n- Construct thresholds by clustering scores into groups where adjacent sorted scores differ by at most $\\varepsilon$. Treat each cluster as a single score level whose representative threshold is the minimum element of that cluster. Evaluate the ROC at thresholds $\\tau \\in \\{+\\infty\\} \\cup \\{\\text{cluster representatives in descending order}\\} \\cup \\{-\\infty\\}$.\n- When computing AUC, award half credit for near ties under the same tolerance rule: a pair $(s_i,s_j)$ with $|s_i - s_j| \\le \\varepsilon$ contributes $\\tfrac{1}{2}$ to the numerator.\n\nTask. Implement a program that, for each provided test case, computes:\n- The empirical $\\mathrm{AUC}$ using the near-tie rule with $\\varepsilon = 10^{-12}$.\n- The normalized partial area $\\mathrm{pAUC}_\\alpha^{\\mathrm{norm}}$ with $\\alpha = 0.2$, using linear interpolation along the ROC curve constructed from the threshold set described above.\n- The maximum Youden index $J^\\star$ and the selected threshold $\\tau^\\star$ according to the rule above.\n\nYour program must output, for each test case, a list of four values $[\\mathrm{AUC}, \\mathrm{pAUC}_\\alpha^{\\mathrm{norm}}, J^\\star, \\tau^\\star]$, with each value rounded to six decimal places. Aggregate the results for all test cases into a single line as a comma-separated list of these per-case lists enclosed in square brackets, e.g., $[[a_1,a_2,a_3,a_4],[b_1,b_2,b_3,b_4]]$.\n\nTest suite. Use the following four test cases. In each, the first list is the diagnostic scores $\\{s_i\\}$ and the second is the corresponding labels $\\{y_i\\}$ with $1$ indicating diseased and $0$ indicating non-diseased. The tolerance is $\\varepsilon=10^{-12}$ and the false positive cap is $\\alpha=0.2$ for all cases.\n\n- Case $1$ (general mixed scores):\n  - Scores: $\\{0.90, 0.80, 0.70, 0.10, 0.40, 0.35, 0.85, 0.20, 0.50\\}$\n  - Labels: $\\{1, 1, 0, 0, 1, 0, 1, 0, 1\\}$\n\n- Case $2$ (near ties across classes):\n  - Scores: $\\{0.3000000000000000, 0.3000000000000004, 0.6000000000000000, 0.6000000000000003, 0.4500000000000000, 0.4500000000000002, 0.2000000000000000, 0.2000000000000001\\}$\n  - Labels: $\\{1, 0, 1, 0, 0, 1, 1, 0\\}$\n\n- Case $3$ (perfect separation):\n  - Scores: $\\{0.10, 0.20, 0.30, 0.80, 0.90, 0.95\\}$\n  - Labels: $\\{0, 0, 0, 1, 1, 1\\}$\n\n- Case $4$ (extreme class imbalance with one positive):\n  - Scores: $\\{0.51, 0.10, 0.11, 0.09, 0.12, 0.10, 0.13, 0.08, 0.10\\}$\n  - Labels: $\\{1, 0, 0, 0, 0, 0, 0, 0, 0\\}$\n\nFinal output format. Your program should produce a single line of output containing a list of four-element lists, one per test case, with each float rounded to six decimal places, for example:\n$[[x_{11},x_{12},x_{13},x_{14}],[x_{21},x_{22},x_{23},x_{24}],[x_{31},x_{32},x_{33},x_{34}],[x_{41},x_{42},x_{43},x_{44}]]$.", "solution": "```python\nimport numpy as np\n\ndef compute_metrics(scores_list, labels_list, alpha, eps):\n    \"\"\"\n    Computes AUC, normalized pAUC, max Youden index J*, and optimal threshold tau*\n    according to the problem specification.\n    \"\"\"\n    scores = np.array(scores_list, dtype=np.float64)\n    labels = np.array(labels_list)\n\n    pos_scores = scores[labels == 1]\n    neg_scores = scores[labels == 0]\n\n    P = len(pos_scores)\n    N = len(neg_scores)\n    \n    if P == 0 or N == 0:\n        # Undefined metrics, return neutral values.\n        return [0.5, 0.5, 0.0, -np.inf if P > 0 else np.inf]\n\n    # 1. AUC Calculation with near-tie rule\n    auc_numerator = 0.0\n    for s_p in pos_scores:\n        for s_n in neg_scores:\n            diff = s_p - s_n\n            if diff > eps:\n                auc_numerator += 1.0\n            elif abs(diff) = eps:\n                auc_numerator += 0.5\n    auc = auc_numerator / (P * N)\n\n    # 2. ROC Curve construction and Youden Index calculation\n    # As per spec, cluster scores to find representative thresholds\n    all_scores_sorted = np.sort(np.unique(scores))\n    thresholds = []\n    if len(all_scores_sorted) > 0:\n        current_cluster_min = all_scores_sorted[0]\n        thresholds.append(current_cluster_min)\n        for i in range(1, len(all_scores_sorted)):\n            if all_scores_sorted[i] - all_scores_sorted[i-1] > eps:\n                current_cluster_min = all_scores_sorted[i]\n                thresholds.append(current_cluster_min)\n\n    roc_points = []\n    j_candidates = []\n\n    # Evaluate at each finite threshold from high to low\n    for tau in sorted(thresholds, reverse=True):\n        tp = np.sum(pos_scores >= tau)\n        fp = np.sum(neg_scores >= tau)\n        tpr = tp / P\n        fpr = fp / N\n        roc_points.append((fpr, tpr))\n        j_candidates.append({'j': tpr - fpr, 'tau': tau})\n\n    # Add standard boundary points for ROC curve\n    roc_points.extend([(0.0, 0.0), (1.0, 1.0)])\n    \n    # 3. Maximum Youden Index (J*) and Optimal Threshold (tau*)\n    if j_candidates:\n        max_j = max(c['j'] for c in j_candidates)\n        # Find smallest threshold that achieves max_j (within tolerance)\n        j_star = max_j\n        tau_star = min(c['tau'] for c in j_candidates if abs(c['j'] - max_j)  1e-9)\n    else:\n        j_star = 0.0\n        tau_star = -np.inf\n    \n    # 4. Normalized Partial AUC\n    # Create the full ROC path for integration\n    # The path consists of unique (FPR, TPR) pairs sorted by FPR, then TPR\n    roc_path = sorted(list(set(roc_points)))\n    \n    fpr_path = np.array([p[0] for p in roc_path])\n    tpr_path = np.array([p[1] for p in roc_path])\n\n    pauc_area = 0.0\n    if alpha > 0:\n        # Find where the path crosses the alpha cutoff\n        if np.any(fpr_path >= alpha):\n            # Find the first index where FPR is >= alpha\n            end_idx = np.where(fpr_path >= alpha)[0][0]\n            \n            # Create the arrays for the area up to alpha\n            fpr_capped = np.append(fpr_path[:end_idx], alpha)\n            \n            # Interpolate TPR at alpha\n            tpr_at_alpha = np.interp(alpha, fpr_path, tpr_path)\n            tpr_capped = np.append(tpr_path[:end_idx], tpr_at_alpha)\n            \n            # Calculate area using the trapezoidal rule\n            pauc_area = np.trapz(tpr_capped, fpr_capped)\n        else: # alpha is beyond the max FPR (which is 1.0)\n            pauc_area = np.trapz(tpr_path, fpr_path)\n            \n        pauc_norm = pauc_area / alpha\n    else:\n        pauc_norm = 0.0\n\n    return [auc, pauc_norm, j_star, tau_star]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results in the specified format.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general mixed scores)\n        ([0.90, 0.80, 0.70, 0.10, 0.40, 0.35, 0.85, 0.20, 0.50],\n         [1, 1, 0, 0, 1, 0, 1, 0, 1]),\n        # Case 2 (near ties across classes)\n        ([0.3000000000000000, 0.3000000000000004, 0.6000000000000000, \n          0.6000000000000003, 0.4500000000000000, 0.4500000000000002, \n          0.2000000000000000, 0.2000000000000001],\n         [1, 0, 1, 0, 0, 1, 1, 0]),\n        # Case 3 (perfect separation)\n        ([0.10, 0.20, 0.30, 0.80, 0.90, 0.95],\n         [0, 0, 0, 1, 1, 1]),\n        # Case 4 (extreme class imbalance with one positive)\n        ([0.51, 0.10, 0.11, 0.09, 0.12, 0.10, 0.13, 0.08, 0.10],\n         [1, 0, 0, 0, 0, 0, 0, 0, 0]),\n    ]\n\n    alpha = 0.2\n    eps = 1e-12\n    \n    all_results = []\n    for scores, labels in test_cases:\n        result = compute_metrics(scores, labels, alpha, eps)\n        all_results.append(result)\n\n    # Format the final output string\n    output_str = \"[\"\n    output_str += \",\".join([f\"[{r[0]:.6f},{r[1]:.6f},{r[2]:.6f},{r[3]:.6f}]\" for r in all_results])\n    output_str += \"]\"\n    print(output_str)\n\nsolve()\n```", "answer": "[[0.900000,0.600000,0.750000,0.400000],[0.562500,0.000000,0.000000,0.200000],[1.000000,1.000000,1.000000,0.800000],[1.000000,1.000000,1.000000,0.510000]]", "id": "4963863"}]}