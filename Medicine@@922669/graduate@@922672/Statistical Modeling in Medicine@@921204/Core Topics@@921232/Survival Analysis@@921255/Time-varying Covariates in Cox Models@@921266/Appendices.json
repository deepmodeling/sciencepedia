{"hands_on_practices": [{"introduction": "This first exercise provides a foundational calculation to build your intuition for time-varying covariates. By computing the hazard ratio at different points in time for a subject who initiates treatment mid-study, you will directly apply the core definition of the extended Cox model. This practice clarifies how relative risk is not a static characteristic but evolves dynamically with a subject's exposure history [@problem_id:4991783].", "problem": "A clinical cohort study follows patients from enrollment time $t=0$ to an event of interest. Consider the Cox proportional hazards (PH) model with a single time-varying covariate $X(t)$ that records exposure to a blood-pressure–lowering medication: $X(t)=0$ indicates not receiving the medication at time $t$, and $X(t)=1$ indicates receiving the medication at time $t$. Suppose one subject initiates the medication at time $t=5$, so that $X(t)=0$ for $t5$ and $X(t)=1$ for $t\\ge 5$. The regression parameter for this covariate is $\\beta=0.7$ from a previously fitted model. Consider another subject who never receives the medication, so that $X(t)\\equiv 0$ for all $t$. Using the foundational definition of the hazard function and the proportional hazards structure for time-varying covariates, compute the hazard ratio, defined as the instantaneous risk for the first subject relative to the second subject, at times $t=3$ and $t=8$. The hazard ratio is dimensionless; express your answers as exact analytic expressions without approximation and without units.", "solution": "The problem statement is evaluated for validity.\n\n### Step 1: Extract Givens\n-   Model: Cox proportional hazards (PH) model.\n-   Covariate: A single time-varying covariate $X(t)$.\n-   Covariate values: $X(t)=0$ (no medication), $X(t)=1$ (on medication).\n-   Subject 1 covariate function: $X_1(t) = 0$ for $t5$ and $X_1(t) = 1$ for $t \\ge 5$.\n-   Subject 2 covariate function: $X_2(t) = 0$ for all $t$.\n-   Regression parameter: $\\beta = 0.7$.\n-   Task: Compute the hazard ratio for subject 1 relative to subject 2 at times $t=3$ and $t=8$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective.\n1.  **Scientific Soundness**: The Cox proportional hazards model with time-varying covariates is a standard and fundamental tool in survival analysis, a major subfield of statistics, particularly in biostatistics and epidemiology. The problem represents a canonical application of this model. The value of $\\beta=0.7$ is a given parameter for a hypothetical model and does not violate any scientific principles.\n2.  **Well-Posedness**: The problem is fully specified. It provides the mathematical form of the model, the exact definitions of the covariates for both subjects over time, the value of the model parameter $\\beta$, and the specific time points for evaluation. This allows for a unique and meaningful solution.\n3.  **Objectivity**: The problem is stated in precise, formal language common to the field of statistics, free of ambiguity or subjective interpretation.\n\nAll other validation criteria are also met. The problem is not incomplete, contradictory, unrealistic, ill-posed, trivial, or unverifiable.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\nThe foundational definition of the hazard function, $h(t)$, in a Cox proportional hazards model with a single time-varying covariate $X(t)$ is given by:\n$$h(t | X(t)) = h_0(t) \\exp(\\beta X(t))$$\nwhere $h_0(t)$ is the baseline hazard function at time $t$, and $\\beta$ is the log-hazard ratio associated with a one-unit increase in the covariate $X(t)$.\n\nThe problem asks for the hazard ratio (HR), defined as the instantaneous risk for the first subject relative to the second subject. Let $h_1(t)$ be the hazard function for the first subject and $h_2(t)$ be the hazard for the second subject. The hazard ratio at time $t$ is:\n$$\\text{HR}(t) = \\frac{h_1(t | X_1(t))}{h_2(t | X_2(t))}$$\n\nSubstituting the Cox model definition for each subject:\n$$h_1(t | X_1(t)) = h_0(t) \\exp(\\beta X_1(t))$$\n$$h_2(t | X_2(t)) = h_0(t) \\exp(\\beta X_2(t))$$\n\nThe hazard ratio is therefore:\n$$\\text{HR}(t) = \\frac{h_0(t) \\exp(\\beta X_1(t))}{h_0(t) \\exp(\\beta X_2(t))}$$\n\nThe baseline hazard function $h_0(t)$ is common to both subjects and cancels out, which is the essence of the \"proportional hazards\" assumption. This simplification yields:\n$$\\text{HR}(t) = \\frac{\\exp(\\beta X_1(t))}{\\exp(\\beta X_2(t))} = \\exp(\\beta X_1(t) - \\beta X_2(t)) = \\exp(\\beta [X_1(t) - X_2(t)])$$\n\nWe are asked to compute this ratio at two specific time points: $t=3$ and $t=8$. The value of the regression parameter is given as $\\beta = 0.7$.\n\n**Calculation at time $t=3$:**\nFirst, we evaluate the covariates for each subject at $t=3$.\n-   For subject 1, since $t=3  5$, the subject has not yet initiated the medication. Thus, $X_1(3) = 0$.\n-   For subject 2, the subject never receives the medication. Thus, $X_2(t) = 0$ for all $t$, which means $X_2(3) = 0$.\n\nNow, we substitute these values into the hazard ratio formula:\n$$\\text{HR}(3) = \\exp(\\beta [X_1(3) - X_2(3)]) = \\exp(0.7 [0 - 0]) = \\exp(0) = 1$$\nAt $t=3$, both subjects are unexposed, so their instantaneous risks are identical, and the hazard ratio is $1$.\n\n**Calculation at time $t=8$:**\nNext, we evaluate the covariates for each subject at $t=8$.\n-   For subject 1, since $t=8 \\ge 5$, the subject is on the medication. Thus, $X_1(8) = 1$.\n-   For subject 2, the subject is never on the medication. Thus, $X_2(8) = 0$.\n\nWe substitute these new values into the hazard ratio formula:\n$$\\text{HR}(8) = \\exp(\\beta [X_1(8) - X_2(8)]) = \\exp(0.7 [1 - 0]) = \\exp(0.7 \\times 1) = \\exp(0.7)$$\nAt $t=8$, subject 1 is exposed to the medication while subject 2 is not. The hazard for subject 1 is $\\exp(0.7)$ times the hazard for subject 2.\n\nThe two required values are the hazard ratio at $t=3$ and $t=8$. These are $1$ and $\\exp(0.7)$, respectively.", "answer": "$$\\boxed{\\begin{pmatrix} 1  \\exp(0.7) \\end{pmatrix}}$$", "id": "4991783"}, {"introduction": "Real-world studies often involve complexities like staggered patient entry and changes in covariates over time. This problem tasks you with creating a \"start-stop\" dataset, the standard data structure for handling such scenarios in a Cox model. By partitioning follow-up time and calculating a partial likelihood component, you will gain hands-on experience with the essential mechanics of fitting models with time-varying covariates [@problem_id:4991875].", "problem": "Consider a survival analysis of postoperative infection in a cohort with staggered study entry and a single time-varying exposure that is activated by a hospital policy on day $14$. Two subjects are observed under the Cox proportional hazards (CPH) model, which posits the hazard function $h_{i}(t) = h_{0}(t)\\,\\exp\\!\\big(\\beta_{X}\\,X_{i}(t) + \\beta_{Z}\\,Z_{i}\\big)$, where $h_{0}(t)$ is an unspecified baseline hazard, $X_{i}(t)$ is a time-varying exposure indicator, and $Z_{i}$ is a time-invariant patient-level covariate. Subject $1$ enters observation at day $0$, has $Z_{1} = 1$, and experiences the event at day $20$. Subject $2$ enters observation at day $12$, has $Z_{2} = 0$, and is administratively censored at day $30$. The exposure policy turns on at day $14$ for all patients, so $X_{i}(t) = 0$ for $t  14$ and $X_{i}(t) = 1$ for $t \\ge 14$ for both $i = 1,2$.\n\nTasks:\n- Construct the start-stop interval representation suitable for left truncation and time-varying covariates, ensuring that all change points in $X_{i}(t)$ and at event or censoring times are respected.\n- Using a counting-process-based definition of the risk set that respects left truncation, determine the composition of the risk set at the event time $t=20$ and compute the corresponding denominator of the partial likelihood contribution at $t=20$.\n\nAssume $\\beta_{X} = \\ln(2)$ and $\\beta_{Z} = \\ln(1.5)$. Express the requested denominator as a single real number. No rounding is required.", "solution": "The problem statement is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. It is a standard application of the Cox proportional hazards model with time-varying covariates and left-truncated data, a common scenario in survival analysis. Therefore, the problem is valid.\n\nThe problem requires a two-part solution: first, the construction of a start-stop data representation, and second, the calculation of the denominator of a partial likelihood term at a specific event time. We approach these tasks sequentially.\n\nThe model is the Cox proportional hazards (CPH) model with a hazard function for subject $i$ at time $t$ given by:\n$$ h_{i}(t) = h_{0}(t)\\,\\exp\\!\\big(\\beta_{X}\\,X_{i}(t) + \\beta_{Z}\\,Z_{i}\\big) $$\nwhere $h_{0}(t)$ is the baseline hazard, $X_{i}(t)$ is a time-varying covariate, and $Z_{i}$ is a time-invariant covariate. The coefficients are given as $\\beta_{X} = \\ln(2)$ and $\\beta_{Z} = \\ln(1.5)$.\n\nFirst, we construct the start-stop interval representation. This data format is necessary to correctly fit a CPH model with time-varying covariates. Each subject's follow-up time is partitioned into intervals during which all covariates remain constant. The split points are determined by the subjects' entry and exit times, and any time points at which a time-varying covariate changes value.\n\nThe critical time points in this problem are:\n-   $t=0$: Entry of Subject $1$.\n-   $t=12$: Entry of Subject $2$ (this represents left truncation).\n-   $t=14$: The hospital policy is activated, changing $X_{i}(t)$ from $0$ to $1$ for all subjects.\n-   $t=20$: Subject $1$ experiences the event.\n-   $t=30$: Subject $2$ is censored.\n\nUsing these time points, we can define the intervals for each subject. We will use the `(start, stop]` interval notation.\n\nFor Subject $1$ (Entry $t=0$, Event $t=20$, $Z_1=1$):\n-   The first interval is from entry until the covariate changes: `(0, 14]`. In this interval, $X_1(t)=0$ and $Z_1=1$. The subject does not experience an event.\n-   The second interval is from the covariate change until the event: `(14, 20]`. In this interval, $X_1(t)=1$ and $Z_1=1$. The subject experiences the event at the end of this interval, $t=20$.\n\nFor Subject $2$ (Entry $t=12$, Censored $t=30$, $Z_2=0$):\n-   The first interval is from entry until the covariate changes: `(12, 14]`. In this interval, $X_2(t)=0$ and $Z_2=0$. The subject does not experience an event.\n-   The second interval is from the covariate change until censoring: `(14, 30]`. In this interval, $X_2(t)=1$ and $Z_2=0$. The subject is censored at the end of this interval, $t=30$.\n\nThis information is summarized in the following start-stop representation table:\n| Subject ID | Start Time | Stop Time | Event Status | $X_i(t)$ | $Z_i$ |\n|------------|------------|-----------|--------------|----------|-------|\n| 1          | $0$        | $14$      | $0$          | $0$      | $1$   |\n| 1          | $14$       | $20$      | $1$          | $1$      | $1$   |\n| 2          | $12$       | $14$      | $0$          | $0$      | $0$   |\n| 2          | $14$       | $30$      | $0$          | $1$      | $0$   |\n\nNext, we compute the denominator of the partial likelihood contribution at the event time $t=20$. The partial likelihood for a single event at time $t_j$ for subject $j$ is given by the ratio of the hazard of the subject who failed to the sum of hazards of all subjects at risk at that time. The denominator of this contribution is:\n$$ D_{t_j} = \\sum_{k \\in \\mathcal{R}(t_j)} h_k(t_j) = \\sum_{k \\in \\mathcal{R}(t_j)} h_0(t_j)\\,\\exp\\!\\big(\\beta_{X}\\,X_{k}(t_j) + \\beta_{Z}\\,Z_{k}\\big) $$\nThe term $h_0(t_j)$ can be factored out, and since it also appears in the numerator, it cancels. The part of the denominator relevant to the parameters is the sum of the risk scores:\n$$ \\sum_{k \\in \\mathcal{R}(t_j)} \\exp\\!\\big(\\beta_{X}\\,X_{k}(t_j) + \\beta_{Z}\\,Z_{k}\\big) $$\nThis is the quantity we are asked to compute for the event at $t=20$.\n\nThe risk set, $\\mathcal{R}(t)$, in the counting process formulation consists of all subjects who are under observation and have not yet experienced the event just prior to time $t$. For a subject $i$ with entry time $E_i$ and event/censoring time $T_i$, the condition to be in the risk set at time $t$ is $E_i  t \\le T_i$. This definition correctly handles left-truncated data.\n\nWe need to determine the risk set $\\mathcal{R}(20)$:\n-   For Subject $1$: Entry $E_1=0$, event $T_1=20$. The condition is $0  20 \\le 20$, which is true. Thus, Subject $1$ is in $\\mathcal{R}(20)$.\n-   For Subject $2$: Entry $E_2=12$, censoring $T_2=30$. The condition is $12  20 \\le 30$, which is true. Thus, Subject $2$ is in $\\mathcal{R}(20)$.\n\nThe risk set at $t=20$ is $\\mathcal{R}(20) = \\{1, 2\\}$.\n\nNow we compute the denominator by summing the risk scores for these two subjects, evaluated at $t=20$:\n$$ D_{20} = \\sum_{k \\in \\{1, 2\\}} \\exp\\!\\big(\\beta_{X}\\,X_{k}(20) + \\beta_{Z}\\,Z_{k}\\big) = \\exp\\!\\big(\\beta_{X}\\,X_{1}(20) + \\beta_{Z}\\,Z_{1}\\big) + \\exp\\!\\big(\\beta_{X}\\,X_{2}(20) + \\beta_{Z}\\,Z_{2}\\big) $$\nWe substitute the known values for the covariates and coefficients.\nAt time $t=20$, since $20 \\ge 14$, the time-varying covariate for both subjects is $X_1(20)=1$ and $X_2(20)=1$.\nThe time-invariant covariates are $Z_1=1$ and $Z_2=0$.\nThe coefficients are $\\beta_{X} = \\ln(2)$ and $\\beta_{Z} = \\ln(1.5)$.\n\nFor Subject $1$, the risk score is:\n$$ \\exp\\!\\big(\\beta_{X}\\,X_{1}(20) + \\beta_{Z}\\,Z_{1}\\big) = \\exp\\!\\big(\\ln(2) \\cdot 1 + \\ln(1.5) \\cdot 1\\big) = \\exp\\!\\big(\\ln(2) + \\ln(1.5)\\big) $$\nUsing the property $\\ln(a) + \\ln(b) = \\ln(ab)$:\n$$ \\exp\\!\\big(\\ln(2 \\times 1.5)\\big) = \\exp\\!\\big(\\ln(3)\\big) = 3 $$\n\nFor Subject $2$, the risk score is:\n$$ \\exp\\!\\big(\\beta_{X}\\,X_{2}(20) + \\beta_{Z}\\,Z_{2}\\big) = \\exp\\!\\big(\\ln(2) \\cdot 1 + \\ln(1.5) \\cdot 0\\big) = \\exp\\!\\big(\\ln(2)\\big) = 2 $$\n\nThe denominator of the partial likelihood contribution at $t=20$ is the sum of these risk scores:\n$$ D_{20} = 3 + 2 = 5 $$", "answer": "$$\\boxed{5}$$", "id": "4991875"}, {"introduction": "One of the most critical and subtle challenges in survival analysis is avoiding \"immortal time bias,\" where a patient's exposure status is misclassified based on future events. This exercise presents a hypothetical scenario where a naive analysis suggests a treatment is protective, while a correct time-dependent analysis shows it has no effect. By working through both, you will develop a crucial skill in identifying and preventing this common and serious form of bias [@problem_id:4991868].", "problem": "A cohort study in cardiovascular medicine tracks the time to first major adverse cardiac event for five patients indexed by $i \\in \\{A,B,C,D,E\\}$. Each patient $i$ has an entry (left-truncation) time $a_i$, a treatment initiation time $s_i$ if they ever start therapy, and an exit time $t_i$ at which the event occurs or censoring happens. The covariate of interest is a binary indicator of being on cardioprotective medication at time $t$, denoted $z_i(t)$, where $z_i(t)=1$ if on medication at time $t$ and $z_i(t)=0$ otherwise. The study aims to estimate the association between medication and event hazard using the Cox proportional hazards model (Cox PH). The baseline hazard is unspecified, and there are no tied event times. All individuals are under observation only on $[a_i, t_i]$, and non-informative censoring is assumed.\n\nThe patient-specific times are as follows:\n- Patient $A$: $a_A=0$, $s_A=3$, $t_A=4$ (event at $t=4$).\n- Patient $B$: $a_B=0$, never initiates therapy, $t_B=1$ (event at $t=1$).\n- Patient $C$: $a_C=2$, never initiates therapy, $t_C=2.5$ (event at $t=2.5$).\n- Patient $D$: $a_D=3.5$, never initiates therapy, $t_D=5$ (event at $t=5$).\n- Patient $E$: $a_E=4.2$, $s_E=4.5$, $t_E=6$ (censored at $t=6$ without an event).\n\nConsider two coding strategies for the covariate:\n1. Naive baseline coding: define a time-invariant indicator $w_i$ that equals $1$ if patient $i$ ever initiates therapy during follow-up ($s_i$ exists) and $0$ otherwise. This misclassifies any pre-initiation time as “treated” for those who ever initiate.\n2. Corrected time-dependent coding: use the time-dependent indicator $z_i(t)$ that equals $1$ only for $t \\ge s_i$ and $0$ for $t  s_i$.\n\nUsing the Cox PH model with a single binary covariate and exact partial likelihood, compute the hazard ratio $\\exp(\\widehat{\\beta})$ for medication under both coding strategies. In all computations, base your derivation on fundamental definitions for risk sets constructed from left-truncation and dropout at event or censoring times. There are event times at $t=1$, $t=2.5$, $t=4$, and $t=5$, each with exactly two patients at risk. For each coding, carefully identify the risk sets and which individual experiences the event at each event time, then derive the partial likelihood and the maximum partial likelihood estimate $\\widehat{\\beta}$.\n\nReport only the corrected time-dependent hazard ratio estimate $\\exp(\\widehat{\\beta})$ as your final answer. No rounding is required. No units are required.", "solution": "The problem requires the computation of the hazard ratio for the effect of a cardioprotective medication using a Cox proportional hazards model under two different covariate coding schemes. The solution will first validate the problem statement and then proceed to the detailed calculation for both scenarios.\n\n### Problem Validation\n\nFirst, I will extract the givens and validate the problem.\n\n**Step 1: Extract Givens**\n-   **Study Population**: Five patients, indexed by $i \\in \\{A, B, C, D, E\\}$.\n-   **Time Variables**: For each patient $i$, an entry time $a_i$, a treatment initiation time $s_i$ (if applicable), and an exit time $t_i$.\n-   **Observation Window**: Each patient $i$ is observed on the interval $[a_i, t_i]$.\n-   **Covariate**: A binary indicator $z_i(t)$ for being on medication, where $z_i(t)=1$ if on medication at time $t$ and $z_i(t)=0$ otherwise.\n-   **Model**: Cox proportional hazards model, $h(t | z_i(t)) = h_0(t) \\exp(\\beta z_i(t))$.\n-   **Assumptions**: Unspecified baseline hazard, no tied event times, non-informative censoring.\n-   **Patient Data**:\n    -   Patient $A$: $a_A=0$, $s_A=3$, $t_A=4$ (event).\n    -   Patient $B$: $a_B=0$, no $s_B$, $t_B=1$ (event).\n    -   Patient $C$: $a_C=2$, no $s_C$, $t_C=2.5$ (event).\n    -   Patient $D$: $a_D=3.5$, no $s_D$, $t_D=5$ (event).\n    -   Patient $E$: $a_E=4.2$, $s_E=4.5$, $t_E=6$ (censored).\n-   **Covariate Coding Strategies**:\n    1.  **Naive baseline coding**: $w_i=1$ if patient $i$ ever initiates therapy, $w_i=0$ otherwise.\n    2.  **Corrected time-dependent coding**: $z_i(t)=1$ for $t \\ge s_i$ and $z_i(t)=0$ for $t  s_i$.\n-   **Task**: Compute the hazard ratio $\\exp(\\widehat{\\beta})$ for both strategies. Report only the estimate from the corrected coding as the final answer.\n-   **Constraint**: \"There are event times at $t=1$, $t=2.5$, $t=4$, and $t=5$, each with exactly two patients at risk.\"\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in biostatistics and survival analysis. It is objective and formalizable. To verify it is well-posed and self-contained, I will check the provided constraint regarding the risk sets. The risk set at time $t$, denoted $R(t)$, comprises all individuals $i$ who are under observation at time $t$ and have not yet experienced an event or been censored prior to $t$. Formally, an individual $i$ is in the risk set at time $t$ if their observation interval $[a_i, t_i]$ contains $t$, i.e., $a_i \\le t \\le t_i$.\n\nThe ordered event times are $t_{(1)}=1$ (Patient $B$), $t_{(2)}=2.5$ (Patient $C$), $t_{(3)}=4$ (Patient $A$), and $t_{(4)}=5$ (Patient $D$).\n\n-   **At event time $t=1$**:\n    -   Patient $A$: $a_A=0 \\le 1 \\le t_A=4$. In risk set.\n    -   Patient $B$: $a_B=0 \\le 1 \\le t_B=1$. In risk set.\n    -   Patient $C$: $a_C=2 \\not\\le 1$. Not in risk set.\n    -   Patient $D$: $a_D=3.5 \\not\\le 1$. Not in risk set.\n    -   Patient $E$: $a_E=4.2 \\not\\le 1$. Not in risk set.\n    -   The risk set is $R(1)=\\{A, B\\}$, size is $2$. The assertion holds.\n\n-   **At event time $t=2.5$**:\n    -   Patient $A$: $a_A=0 \\le 2.5 \\le t_A=4$. In risk set.\n    -   Patient $B$: Event at $t_B=1  2.5$. Not in risk set.\n    -   Patient $C$: $a_C=2 \\le 2.5 \\le t_C=2.5$. In risk set.\n    -   Patient $D$: $a_D=3.5 \\not\\le 2.5$. Not in risk set.\n    -   Patient $E$: $a_E=4.2 \\not\\le 2.5$. Not in risk set.\n    -   The risk set is $R(2.5)=\\{A, C\\}$, size is $2$. The assertion holds.\n\n-   **At event time $t=4$**:\n    -   Patient $A$: $a_A=0 \\le 4 \\le t_A=4$. In risk set.\n    -   Patient $B$: Event at $t_B=1  4$. Not in risk set.\n    -   Patient $C$: Event at $t_C=2.5  4$. Not in risk set.\n    -   Patient $D$: $a_D=3.5 \\le 4 \\le t_D=5$. In risk set.\n    -   Patient $E$: $a_E=4.2 \\not\\le 4$. Not in risk set.\n    -   The risk set is $R(4)=\\{A, D\\}$, size is $2$. The assertion holds.\n\n-   **At event time $t=5$**:\n    -   Patient $A$: Event at $t_A=4  5$. Not in risk set.\n    -   Patient $B$: Event at $t_B=1  5$. Not in risk set.\n    -   Patient $C$: Event at $t_C=2.5  5$. Not in risk set.\n    -   Patient $D$: $a_D=3.5 \\le 5 \\le t_D=5$. In risk set.\n    -   Patient $E$: $a_E=4.2 \\le 5 \\le t_E=6$. In risk set.\n    -   The risk set is $R(5)=\\{D, E\\}$, size is $2$. The assertion holds.\n\n**Step 3: Verdict and Action**\nThe problem is fully specified, internally consistent, and scientifically valid. I will proceed with the solution.\n\n### Cox Model Estimation\n\nThe Cox model hazard function is $h(t | X_i(t)) = h_0(t) \\exp(\\beta X_i(t))$. The partial likelihood function for unique event times $t_{(1)}, \\dots, t_{(k)}$ is given by:\n$$L(\\beta) = \\prod_{j=1}^{k} \\frac{\\exp(\\beta X_{d(j)}(t_{(j)}))}{\\sum_{l \\in R(t_{(j)})} \\exp(\\beta X_l(t_{(j)}))}$$\nwhere $d(j)$ is the index of the patient who has an event at time $t_{(j)}$, and $R(t_{(j)})$ is the risk set at that time. The estimate $\\widehat{\\beta}$ maximizes $L(\\beta)$.\n\nThe event times are $t=1$ (patient $B$), $t=2.5$ (patient $C$), $t=4$ (patient $A$), and $t=5$ (patient $D$). The risk sets are $R(1)=\\{A,B\\}$, $R(2.5)=\\{A,C\\}$, $R(4)=\\{A,D\\}$, and $R(5)=\\{D,E\\}$.\n\n**1. Naive Baseline Coding ($w_i$)**\n\nThe time-invariant covariate $w_i$ is $1$ if the patient ever starts therapy and $0$ otherwise.\n-   Patient $A$: $s_A$ exists, so $w_A=1$.\n-   Patient $B$: no $s_B$, so $w_B=0$.\n-   Patient $C$: no $s_C$, so $w_C=0$.\n-   Patient $D$: no $s_D$, so $w_D=0$.\n-   Patient $E$: $s_E$ exists, so $w_E=1$.\n\nThe partial likelihood is the product of terms for each event:\n-   Event at $t=1$ (Patient $B$ fails, $w_B=0$), Risk set $R(1)=\\{A, B\\}$ ($w_A=1, w_B=0$):\n    $$L_1(\\beta) = \\frac{\\exp(\\beta w_B)}{\\exp(\\beta w_A) + \\exp(\\beta w_B)} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{1}{\\exp(\\beta) + 1}$$\n-   Event at $t=2.5$ (Patient $C$ fails, $w_C=0$), Risk set $R(2.5)=\\{A, C\\}$ ($w_A=1, w_C=0$):\n    $$L_2(\\beta) = \\frac{\\exp(\\beta w_C)}{\\exp(\\beta w_A) + \\exp(\\beta w_C)} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{1}{\\exp(\\beta) + 1}$$\n-   Event at $t=4$ (Patient $A$ fails, $w_A=1$), Risk set $R(4)=\\{A, D\\}$ ($w_A=1, w_D=0$):\n    $$L_3(\\beta) = \\frac{\\exp(\\beta w_A)}{\\exp(\\beta w_A) + \\exp(\\beta w_D)} = \\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{\\exp(\\beta)}{\\exp(\\beta) + 1}$$\n-   Event at $t=5$ (Patient $D$ fails, $w_D=0$), Risk set $R(5)=\\{D, E\\}$ ($w_D=0, w_E=1$):\n    $$L_4(\\beta) = \\frac{\\exp(\\beta w_D)}{\\exp(\\beta w_D) + \\exp(\\beta w_E)} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1)} = \\frac{1}{1 + \\exp(\\beta)}$$\n\nThe total partial likelihood is $L(\\beta) = L_1 \\cdot L_2 \\cdot L_3 \\cdot L_4 = \\frac{1}{(\\exp(\\beta)+1)^2} \\cdot \\frac{\\exp(\\beta)}{\\exp(\\beta)+1} \\cdot \\frac{1}{\\exp(\\beta)+1} = \\frac{\\exp(\\beta)}{(\\exp(\\beta)+1)^4}$.\nThe log-partial likelihood is $l(\\beta) = \\beta - 4 \\ln(\\exp(\\beta)+1)$.\nThe score function is $U(\\beta) = \\frac{d l}{d \\beta} = 1 - 4 \\frac{\\exp(\\beta)}{\\exp(\\beta)+1}$.\nSetting $U(\\widehat{\\beta})=0$ gives $1 = 4 \\frac{\\exp(\\widehat{\\beta})}{\\exp(\\widehat{\\beta})+1}$, so $\\exp(\\widehat{\\beta})+1 = 4\\exp(\\widehat{\\beta})$, which implies $3\\exp(\\widehat{\\beta})=1$.\nThus, the naive hazard ratio estimate is $\\exp(\\widehat{\\beta}) = \\frac{1}{3}$.\n\n**2. Corrected Time-Dependent Coding ($z_i(t)$)**\n\nThe covariate $z_i(t)$ is $1$ if $t \\ge s_i$ and $0$ otherwise.\n-   $z_A(t)=1$ for $t \\ge 3$, $0$ otherwise.\n-   $z_B(t)=0$ for all $t$.\n-   $z_C(t)=0$ for all $t$.\n-   $z_D(t)=0$ for all $t$.\n-   $z_E(t)=1$ for $t \\ge 4.5$, $0$ otherwise.\n\nWe evaluate the covariates at each event time for the individuals in the risk set.\n-   Event at $t=1$ (Patient $B$ fails), Risk set $R(1)=\\{A, B\\}$:\n    At $t=1$, $z_A(1)=0$ (since $1  s_A=3$) and $z_B(1)=0$.\n    $$L_1(\\beta) = \\frac{\\exp(\\beta z_B(1))}{\\exp(\\beta z_A(1)) + \\exp(\\beta z_B(1))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{1+1} = \\frac{1}{2}$$\n-   Event at $t=2.5$ (Patient $C$ fails), Risk set $R(2.5)=\\{A, C\\}$:\n    At $t=2.5$, $z_A(2.5)=0$ (since $2.5  s_A=3$) and $z_C(2.5)=0$.\n    $$L_2(\\beta) = \\frac{\\exp(\\beta z_C(2.5))}{\\exp(\\beta z_A(2.5)) + \\exp(\\beta z_C(2.5))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{1+1} = \\frac{1}{2}$$\n-   Event at $t=4$ (Patient $A$ fails), Risk set $R(4)=\\{A, D\\}$:\n    At $t=4$, $z_A(4)=1$ (since $4 \\ge s_A=3$) and $z_D(4)=0$.\n    $$L_3(\\beta) = \\frac{\\exp(\\beta z_A(4))}{\\exp(\\beta z_A(4)) + \\exp(\\beta z_D(4))} = \\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 0)} = \\frac{\\exp(\\beta)}{\\exp(\\beta) + 1}$$\n-   Event at $t=5$ (Patient $D$ fails), Risk set $R(5)=\\{D, E\\}$:\n    At $t=5$, $z_D(5)=0$ and $z_E(5)=1$ (since $5 \\ge s_E=4.5$).\n    $$L_4(\\beta) = \\frac{\\exp(\\beta z_D(5))}{\\exp(\\beta z_D(5)) + \\exp(\\beta z_E(5))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 1)} = \\frac{1}{1 + \\exp(\\beta)}$$\n\nThe total partial likelihood is $L(\\beta) = \\frac{1}{2} \\cdot \\frac{1}{2} \\cdot \\frac{\\exp(\\beta)}{\\exp(\\beta)+1} \\cdot \\frac{1}{\\exp(\\beta)+1} = \\frac{1}{4} \\frac{\\exp(\\beta)}{(\\exp(\\beta)+1)^2}$.\nThe log-partial likelihood is $l(\\beta) = -\\ln(4) + \\beta - 2 \\ln(\\exp(\\beta)+1)$.\nThe score function is $U(\\beta) = \\frac{d l}{d \\beta} = 1 - 2 \\frac{\\exp(\\beta)}{\\exp(\\beta)+1}$.\nSetting $U(\\widehat{\\beta})=0$ gives $1 = 2 \\frac{\\exp(\\widehat{\\beta})}{\\exp(\\widehat{\\beta})+1}$, so $\\exp(\\widehat{\\beta})+1 = 2\\exp(\\widehat{\\beta})$, which implies $\\exp(\\widehat{\\beta})=1$.\n\nThe hazard ratio estimate using the corrected time-dependent coding is $\\exp(\\widehat{\\beta})=1$. This indicates no association between the medication and the hazard of the cardiac event, a stark contrast to the fallacious result from the naive coding which introduced immortal time bias.\nThe final answer is the hazard ratio from the corrected analysis.", "answer": "$$\\boxed{1}$$", "id": "4991868"}]}