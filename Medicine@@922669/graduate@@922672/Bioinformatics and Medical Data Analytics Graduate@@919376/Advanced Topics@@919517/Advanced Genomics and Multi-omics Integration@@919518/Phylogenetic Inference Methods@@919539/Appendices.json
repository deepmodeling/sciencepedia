{"hands_on_practices": [{"introduction": "Distance-based methods, such as the Neighbor-Joining (NJ) algorithm, provide a computationally efficient approach to inferring tree topologies from a matrix of pairwise dissimilarities. Unlike simpler clustering methods, the NJ algorithm does not assume a molecular clock and aims to find the tree that best fits the provided distance data. This practice ([@problem_id:4593239]) will guide you through the manual execution of the NJ algorithm, from calculating the selection criterion $Q_{ij}$ to updating the distance matrix at each step, offering a concrete understanding of how this foundational method constructs a phylogenetic tree.", "problem": "Consider the task of reconstructing an unrooted phylogenetic tree from a symmetric intertaxon dissimilarity matrix using the distance-based Neighbor Joining (NJ) method. Suppose there are six taxa labeled $A$, $B$, $C$, $D$, $E$, and $F$. The input is a symmetric matrix $\\{d_{ij}\\}$ with $d_{ii} = 0$ and $d_{ij} = d_{ji}$ for all $i,j$, given by the following nonzero entries:\n- $d_{AB} = 2$, $d_{AC} = 3.5$, $d_{AD} = 5.2$, $d_{AE} = 5.2$, $d_{AF} = 7.5$,\n- $d_{BC} = 3.5$, $d_{BD} = 5.2$, $d_{BE} = 5.2$, $d_{BF} = 7.5$,\n- $d_{CD} = 4.7$, $d_{CE} = 4.7$, $d_{CF} = 7.0$,\n- $d_{DE} = 2$, $d_{DF} = 4.3$, $d_{EF} = 4.3$.\n\nImplement the standard Neighbor Joining (NJ) update procedure from first principles to:\n1. Identify at each iteration the pair of taxa (or clusters) to be joined.\n2. Compute the corresponding branch (limb) lengths to the newly introduced internal node.\n3. Update the reduced distance matrix for the next iteration.\n\nUse the following deterministic tie-breaking rule: when the NJ selection criterion yields ties, choose the pair with the smallest raw intertaxon distance $d_{ij}$; if there is still a tie, choose the lexicographically earliest pair under the ordering $A \\prec B \\prec C \\prec D \\prec E \\prec F$.\n\nCarry the NJ procedure to completion until an unrooted tree on the six original taxa is obtained. Your task is to compute the total sum of all branch lengths in the final reconstructed unrooted tree (that is, the sum of the lengths of all edges in the tree). Express the final total as a single real number. No rounding is required. Distances are in arbitrary units; do not include any unit in your answer.", "solution": "The problem requires the reconstruction of an unrooted phylogenetic tree for six taxa, $\\{A, B, C, D, E, F\\}$, using the Neighbor Joining (NJ) algorithm. The input is a symmetric distance matrix $d_{ij}$. The goal is to find the total sum of all branch lengths in the final tree.\n\nThe Neighbor Joining algorithm is an iterative procedure that joins pairs of taxa (or clusters) until a single branch remains, which represents the full unrooted tree. The core of the algorithm is the selection criterion, which is to find the pair $(i, j)$ that minimizes the value of $Q_{ij}$, defined as:\n$$Q_{ij} = (N-2)d_{ij} - r_i - r_j$$\nwhere $N$ is the number of current taxa/clusters, $d_{ij}$ is the distance between taxa $i$ and $j$, and $r_i$ is the sum of distances from taxon $i$ to all other taxa:\n$$r_i = \\sum_{k \\in S, k \\neq i} d_{ik}$$\nwhere $S$ is the current set of taxa.\n\nLet's proceed with the algorithm step-by-step.\n\n### Iteration 1: $N=6$\n\nThe initial set of taxa is $S_1 = \\{A, B, C, D, E, F\\}$. The given distance matrix $d$ is:\n$$\n\\begin{array}{c|cccccc}\n & A & B & C & D & E & F \\\\\n\\hline\nA & 0 & 2 & 3.5 & 5.2 & 5.2 & 7.5 \\\\\nB & 2 & 0 & 3.5 & 5.2 & 5.2 & 7.5 \\\\\nC & 3.5 & 3.5 & 0 & 4.7 & 4.7 & 7.0 \\\\\nD & 5.2 & 5.2 & 4.7 & 0 & 2 & 4.3 \\\\\nE & 5.2 & 5.2 & 4.7 & 2 & 0 & 4.3 \\\\\nF & 7.5 & 7.5 & 7.0 & 4.3 & 4.3 & 0\n\\end{array}\n$$\n\nFirst, we compute the sum of distances $r_i$ for each taxon:\n$r_A = 2 + 3.5 + 5.2 + 5.2 + 7.5 = 23.4$\n$r_B = 2 + 3.5 + 5.2 + 5.2 + 7.5 = 23.4$\n$r_C = 3.5 + 3.5 + 4.7 + 4.7 + 7.0 = 23.4$\n$r_D = 5.2 + 5.2 + 4.7 + 2 + 4.3 = 21.4$\n$r_E = 5.2 + 5.2 + 4.7 + 2 + 4.3 = 21.4$\n$r_F = 7.5 + 7.5 + 7.0 + 4.3 + 4.3 = 30.6$\n\nNext, we calculate the $Q$-matrix using $Q_{ij} = (6-2)d_{ij} - r_i - r_j = 4d_{ij} - r_i - r_j$:\n$Q_{AB} = 4(2) - (23.4 + 23.4) = 8 - 46.8 = -38.8$\n$Q_{AC} = 4(3.5) - (23.4 + 23.4) = 14 - 46.8 = -32.8$\n$Q_{AD} = 4(5.2) - (23.4 + 21.4) = 20.8 - 44.8 = -24.0$\n$Q_{AE} = 4(5.2) - (23.4 + 21.4) = 20.8 - 44.8 = -24.0$\n$Q_{AF} = 4(7.5) - (23.4 + 30.6) = 30 - 54.0 = -24.0$\n$Q_{BC} = 4(3.5) - (23.4 + 23.4) = 14 - 46.8 = -32.8$\n$Q_{BD} = 4(5.2) - (23.4 + 21.4) = 20.8 - 44.8 = -24.0$\n$Q_{BE} = 4(5.2) - (23.4 + 21.4) = 20.8 - 44.8 = -24.0$\n$Q_{BF} = 4(7.5) - (23.4 + 30.6) = 30 - 54.0 = -24.0$\n$Q_{CD} = 4(4.7) - (23.4 + 21.4) = 18.8 - 44.8 = -26.0$\n$Q_{CE} = 4(4.7) - (23.4 + 21.4) = 18.8 - 44.8 = -26.0$\n$Q_{CF} = 4(7.0) - (23.4 + 30.6) = 28 - 54.0 = -26.0$\n$Q_{DE} = 4(2) - (21.4 + 21.4) = 8 - 42.8 = -34.8$\n$Q_{DF} = 4(4.3) - (21.4 + 30.6) = 17.2 - 52.0 = -34.8$\n$Q_{EF} = 4(4.3) - (21.4 + 30.6) = 17.2 - 52.0 = -34.8$\n\nThe minimum value in the $Q$-matrix is $Q_{AB} = -38.8$. We join taxa $A$ and $B$ to a new node, which we shall call $U_1$.\n\nThe branch lengths from $A$ and $B$ to $U_1$ are calculated as:\n$L_{AU_1} = \\frac{1}{2}d_{AB} + \\frac{1}{2(6-2)}(r_A - r_B) = \\frac{1}{2}(2) + \\frac{1}{8}(23.4 - 23.4) = 1.0$\n$L_{BU_1} = \\frac{1}{2}d_{AB} + \\frac{1}{2(6-2)}(r_B - r_A) = \\frac{1}{2}(2) + \\frac{1}{8}(23.4 - 23.4) = 1.0$\n\nWe update the distance matrix. The new set of taxa is $S_2 = \\{U_1, C, D, E, F\\}$. The distances from $U_1$ to the other taxa are:\n$d_{U_1C} = \\frac{1}{2}(d_{AC} + d_{BC} - d_{AB}) = \\frac{1}{2}(3.5 + 3.5 - 2) = 2.5$\n$d_{U_1D} = \\frac{1}{2}(d_{AD} + d_{BD} - d_{AB}) = \\frac{1}{2}(5.2 + 5.2 - 2) = 4.2$\n$d_{U_1E} = \\frac{1}{2}(d_{AE} + d_{BE} - d_{AB}) = \\frac{1}{2}(5.2 + 5.2 - 2) = 4.2$\n$d_{U_1F} = \\frac{1}{2}(d_{AF} + d_{BF} - d_{AB}) = \\frac{1}{2}(7.5 + 7.5 - 2) = 6.5$\n\n### Iteration 2: $N=5$\n\nThe set of taxa is $S_2 = \\{U_1, C, D, E, F\\}$, and the reduced distance matrix is:\n$$\n\\begin{array}{c|ccccc}\n & U_1 & C & D & E & F \\\\\n\\hline\nU_1 & 0 & 2.5 & 4.2 & 4.2 & 6.5 \\\\\nC & 2.5 & 0 & 4.7 & 4.7 & 7.0 \\\\\nD & 4.2 & 4.7 & 0 & 2 & 4.3 \\\\\nE & 4.2 & 4.7 & 2 & 0 & 4.3 \\\\\nF & 6.5 & 7.0 & 4.3 & 4.3 & 0\n\\end{array}\n$$\n\nWe compute the new sums of distances $r_i$:\n$r_{U_1} = 2.5 + 4.2 + 4.2 + 6.5 = 17.4$\n$r_C = 2.5 + 4.7 + 4.7 + 7.0 = 18.9$\n$r_D = 4.2 + 4.7 + 2 + 4.3 = 15.2$\n$r_E = 4.2 + 4.7 + 2 + 4.3 = 15.2$\n$r_F = 6.5 + 7.0 + 4.3 + 4.3 = 22.1$\n\nWe calculate the $Q$-matrix with $N=5$, i.e., $Q_{ij} = (5-2)d_{ij} - r_i - r_j = 3d_{ij} - r_i - r_j$:\n$Q_{U_1C} = 3(2.5) - (17.4 + 18.9) = 7.5 - 36.3 = -28.8$\n$Q_{DE} = 3(2) - (15.2 + 15.2) = 6 - 30.4 = -24.4$\nAll other $Q_{ij}$ values are $-20.0$ or greater. The minimum is $Q_{U_1C} = -28.8$. We join cluster $U_1$ and taxon $C$ to a new node $U_2$.\n\nThe branch lengths to $U_2$ are:\n$L_{U_1U_2} = \\frac{1}{2}d_{U_1C} + \\frac{1}{2(5-2)}(r_{U_1} - r_C) = \\frac{1}{2}(2.5) + \\frac{1}{6}(17.4 - 18.9) = 1.25 - 0.25 = 1.0$\n$L_{CU_2} = \\frac{1}{2}d_{U_1C} + \\frac{1}{2(5-2)}(r_C - r_{U_1}) = \\frac{1}{2}(2.5) + \\frac{1}{6}(18.9 - 17.4) = 1.25 + 0.25 = 1.5$\n\nThe new set of taxa is $S_3 = \\{U_2, D, E, F\\}$. Distances to $U_2 = (U_1, C)$ are:\n$d_{U_2D} = \\frac{1}{2}(d_{U_1D} + d_{CD} - d_{U_1C}) = \\frac{1}{2}(4.2 + 4.7 - 2.5) = 3.2$\n$d_{U_2E} = \\frac{1}{2}(d_{U_1E} + d_{CE} - d_{U_1C}) = \\frac{1}{2}(4.2 + 4.7 - 2.5) = 3.2$\n$d_{U_2F} = \\frac{1}{2}(d_{U_1F} + d_{CF} - d_{U_1C}) = \\frac{1}{2}(6.5 + 7.0 - 2.5) = 5.5$\n\n### Iteration 3: $N=4$\n\nThe set of taxa is $S_3 = \\{U_2, D, E, F\\}$, with the distance matrix:\n$$\n\\begin{array}{c|cccc}\n & U_2 & D & E & F \\\\\n\\hline\nU_2 & 0 & 3.2 & 3.2 & 5.5 \\\\\nD & 3.2 & 0 & 2 & 4.3 \\\\\nE & 3.2 & 2 & 0 & 4.3 \\\\\nF & 5.5 & 4.3 & 4.3 & 0\n\\end{array}\n$$\nWe compute the sums of distances $r_i$:\n$r_{U_2} = 3.2 + 3.2 + 5.5 = 11.9$\n$r_D = 3.2 + 2 + 4.3 = 9.5$\n$r_E = 3.2 + 2 + 4.3 = 9.5$\n$r_F = 5.5 + 4.3 + 4.3 = 14.1$\n\nWe calculate the $Q$-matrix with $N=4$, i.e., $Q_{ij} = (4-2)d_{ij} - r_i - r_j = 2d_{ij} - r_i - r_j$:\n$Q_{U_2D} = 2(3.2) - (11.9 + 9.5) = 6.4 - 21.4 = -15.0$\n$Q_{U_2E} = 2(3.2) - (11.9 + 9.5) = 6.4 - 21.4 = -15.0$\n$Q_{U_2F} = 2(5.5) - (11.9 + 14.1) = 11.0 - 26.0 = -15.0$\n$Q_{DE} = 2(2) - (9.5 + 9.5) = 4.0 - 19.0 = -15.0$\n$Q_{DF} = 2(4.3) - (9.5 + 14.1) = 8.6 - 23.6 = -15.0$\n$Q_{EF} = 2(4.3) - (9.5 + 14.1) = 8.6 - 23.6 = -15.0$\n\nAll pairs have a $Q$-value of $-15.0$. We apply the tie-breaking rule: choose the pair with the smallest raw distance $d_{ij}$. The distances are $d_{U_2D}=3.2$, $d_{U_2E}=3.2$, $d_{U_2F}=5.5$, $d_{DE}=2$, $d_{DF}=4.3$, $d_{EF}=4.3$. The minimum distance is $d_{DE}=2$. Thus, we join $D$ and $E$ to a new node $U_3$.\n\nThe branch lengths to $U_3$ are:\n$L_{DU_3} = \\frac{1}{2}d_{DE} + \\frac{1}{2(4-2)}(r_D - r_E) = \\frac{1}{2}(2) + \\frac{1}{4}(9.5 - 9.5) = 1.0$\n$L_{EU_3} = \\frac{1}{2}d_{DE} + \\frac{1}{2(4-2)}(r_E - r_D) = \\frac{1}{2}(2) + \\frac{1}{4}(9.5 - 9.5) = 1.0$\n\nThe new set of taxa is $S_4 = \\{U_2, U_3, F\\}$. Distances involving $U_3$ are:\n$d_{U_2U_3} = \\frac{1}{2}(d_{U_2D} + d_{U_2E} - d_{DE}) = \\frac{1}{2}(3.2 + 3.2 - 2) = 2.2$\n$d_{U_3F} = \\frac{1}{2}(d_{DF} + d_{EF} - d_{DE}) = \\frac{1}{2}(4.3 + 4.3 - 2) = 3.3$\n\n### Iteration 4: $N=3$\n\nThe set of taxa is $S_4 = \\{U_2, U_3, F\\}$, with the distance matrix:\n$$\n\\begin{array}{c|ccc}\n & U_2 & U_3 & F \\\\\n\\hline\nU_2 & 0 & 2.2 & 5.5 \\\\\nU_3 & 2.2 & 0 & 3.3 \\\\\nF & 5.5 & 3.3 & 0\n\\end{array}\n$$\nWith $N=3$, the algorithm terminates by connecting the three remaining nodes to a central node. The lengths of the three branches leading to this final node are:\n$L_{U_2, \\text{center}} = \\frac{1}{2}(d_{U_2U_3} + d_{U_2F} - d_{U_3F}) = \\frac{1}{2}(2.2 + 5.5 - 3.3) = \\frac{1}{2}(4.4) = 2.2$\n$L_{U_3, \\text{center}} = \\frac{1}{2}(d_{U_2U_3} + d_{U_3F} - d_{U_2F}) = \\frac{1}{2}(2.2 + 3.3 - 5.5) = \\frac{1}{2}(0) = 0.0$\n$L_{F, \\text{center}} = \\frac{1}{2}(d_{U_2F} + d_{U_3F} - d_{U_2U_3}) = \\frac{1}{2}(5.5 + 3.3 - 2.2) = \\frac{1}{2}(6.6) = 3.3$\n\n### Sum of Branch Lengths\n\nWe have calculated all the branch lengths of the unrooted tree. The final unrooted tree has $2(6)-3=9$ branches. The total set of branches and their lengths are:\n1. $L_{AU_1} = 1.0$ (Terminal branch)\n2. $L_{BU_1} = 1.0$ (Terminal branch)\n3. $L_{CU_2} = 1.5$ (Terminal branch)\n4. $L_{DU_3} = 1.0$ (Terminal branch)\n5. $L_{EU_3} = 1.0$ (Terminal branch)\n6. $L_{FU_c} = 3.3$ (Terminal branch to center)\n7. $L_{U_1U_2} = 1.0$ (Internal branch)\n8. $L_{U_2U_c} = 2.2$ (Internal branch to center)\n9. $L_{U_3U_c} = 0.0$ (Internal branch to center)\n\nThe total sum of all branch lengths is the sum of these values:\nTotal Length $= 1.0 + 1.0 + 1.5 + 1.0 + 1.0 + 3.3 + 1.0 + 2.2 + 0.0$\nTotal Length $= 12.0$\n\nThe total sum of all branch lengths in the reconstructed tree is $12.0$.", "answer": "$$\\boxed{12.0}$$", "id": "4593239"}, {"introduction": "In contrast to methods that rely on pre-computed distances, character-based approaches like Maximum Parsimony (MP) work directly with character data to evaluate evolutionary hypotheses. The core principle of MP is to find the tree that minimizes the total number of evolutionary changes needed to explain the observed states at the leaves. This exercise ([@problem_id:4593188]) introduces Sankoff's dynamic programming algorithm, a versatile method that calculates the minimum parsimony score for a given tree, even accommodating complex, non-uniform costs for state changes, thereby providing a quantitative measure of a tree's explanatory power.", "problem": "Consider a single discrete morphological character with three possible states $\\{0,1,2\\}$. You are given a rooted, strictly binary phylogenetic tree with four taxa. The root is $\\rho$; its two children are internal nodes $u$ and $v$. Node $u$ has leaves $t_1$ and $t_2$ as children, and node $v$ has leaves $t_3$ and $t_4$ as children. The observed character states at the leaves are: $t_1=1$, $t_2=0$, $t_3=2$, $t_4=1$. Assume a directed transition cost matrix $C$ that gives the cost $C(i \\to j)$ of changing from parental state $i$ to child state $j$ along a single edge:\n$$\nC \\;=\\; \\begin{pmatrix}\n0 & 2 & 5 \\\\\n1 & 0 & 2 \\\\\n3 & 1 & 0\n\\end{pmatrix},\n$$\nwhere the $(i,j)$-entry is $C(i \\to j)$ for $i,j \\in \\{0,1,2\\}$. Under maximum parsimony (MP), the total score of an ancestral state assignment is the sum of $C(\\text{parent} \\to \\text{child})$ over all directed edges, and the MP score is the minimum possible total over all assignments of states to the internal nodes consistent with the observed leaf states.\n\nUsing Sankoffâ€™s dynamic programming method, compute the MP (Sankoff) parsimony score $S$ for this character on the given rooted tree and specify one minimal ancestral reconstruction (that is, one specific assignment of states to $\\rho$, $u$, and $v$ that attains the minimum). For leaves, treat observed states as fixed. Report only the numerical value of the parsimony score $S$ as your final answer. No rounding is required.", "solution": "The problem requires the computation of the maximum parsimony (MP) score for a given character on a rooted tree using Sankoff's dynamic programming algorithm. The MP score is the minimum total cost of character state changes across all edges of the tree, minimized over all possible ancestral state assignments. The Sankoff algorithm computes this score via a post-order traversal (from leaves to root).\n\nFor each node $k$ in the tree and each possible character state $i \\in \\{0, 1, 2\\}$, we define a score, $S_k(i)$, which represents the minimum parsimony score for the subtree rooted at $k$, given that node $k$ has state $i$.\n\nThe given transition cost matrix is:\n$$\nC(i \\to j) \\;=\\; \\begin{pmatrix}\n0 & 2 & 5 \\\\\n1 & 0 & 2 \\\\\n3 & 1 & 0\n\\end{pmatrix}\n$$\nwhere rows correspond to the parental state $i \\in \\{0,1,2\\}$ and columns correspond to the child state $j \\in \\{0,1,2\\}$.\n\nThe algorithm proceeds in two phases: a forward pass (post-order traversal) to calculate scores, and a (not required for the final answer, but useful for verification) backward pass (pre-order traversal) to reconstruct the ancestral states. We will perform the forward pass.\n\n**Step 1: Initialization at the Leaves**\nFor a leaf node $k$ with an observed state $s_k$, the score vector $\\vec{S}_k = (S_k(0), S_k(1), S_k(2))$ is initialized as follows: $S_k(s_k) = 0$ and $S_k(i) = \\infty$ for all $i \\neq s_k$.\nThe observed states are $t_1=1$, $t_2=0$, $t_3=2$, $t_4=1$.\n- For leaf $t_1$: State is $1$. $\\vec{S}_{t_1} = (\\infty, 0, \\infty)$.\n- For leaf $t_2$: State is $0$. $\\vec{S}_{t_2} = (0, \\infty, \\infty)$.\n- For leaf $t_3$: State is $2$. $\\vec{S}_{t_3} = (\\infty, \\infty, 0)$.\n- For leaf $t_4$: State is $1$. $\\vec{S}_{t_4} = (\\infty, 0, \\infty)$.\n\n**Step 2: Post-Order Traversal (Up the Tree)**\nFor an internal node $p$ with children $c_L$ and $c_R$, the score $S_p(i)$ is calculated for each state $i$ using the formula:\n$$\nS_p(i) = \\left[ \\min_{j \\in \\{0,1,2\\}} (S_{c_L}(j) + C(i \\to j)) \\right] + \\left[ \\min_{k \\in \\{0,1,2\\}} (S_{c_R}(k) + C(i \\to k)) \\right]\n$$\n\n**Calculation for internal node $u$ (children $t_1, t_2$):**\n- $S_u(0) = \\left[ \\min_{j} (S_{t_1}(j) + C(0 \\to j)) \\right] + \\left[ \\min_{k} (S_{t_2}(k) + C(0 \\to k)) \\right]$\n$S_u(0) = (S_{t_1}(1) + C(0 \\to 1)) + (S_{t_2}(0) + C(0 \\to 0)) = (0 + 2) + (0 + 0) = 2$.\n- $S_u(1) = \\left[ \\min_{j} (S_{t_1}(j) + C(1 \\to j)) \\right] + \\left[ \\min_{k} (S_{t_2}(k) + C(1 \\to k)) \\right]$\n$S_u(1) = (S_{t_1}(1) + C(1 \\to 1)) + (S_{t_2}(0) + C(1 \\to 0)) = (0 + 0) + (0 + 1) = 1$.\n- $S_u(2) = \\left[ \\min_{j} (S_{t_1}(j) + C(2 \\to j)) \\right] + \\left[ \\min_{k} (S_{t_2}(k) + C(2 \\to k)) \\right]$\n$S_u(2) = (S_{t_1}(1) + C(2 \\to 1)) + (S_{t_2}(0) + C(2 \\to 0)) = (0 + 1) + (0 + 3) = 4$.\nSo, the score vector for node $u$ is $\\vec{S}_u = (2, 1, 4)$.\n\n**Calculation for internal node $v$ (children $t_3, t_4$):**\n- $S_v(0) = \\left[ \\min_{j} (S_{t_3}(j) + C(0 \\to j)) \\right] + \\left[ \\min_{k} (S_{t_4}(k) + C(0 \\to k)) \\right]$\n$S_v(0) = (S_{t_3}(2) + C(0 \\to 2)) + (S_{t_4}(1) + C(0 \\to 1)) = (0 + 5) + (0 + 2) = 7$.\n- $S_v(1) = \\left[ \\min_{j} (S_{t_3}(j) + C(1 \\to j)) \\right] + \\left[ \\min_{k} (S_{t_4}(k) + C(1 \\to k)) \\right]$\n$S_v(1) = (S_{t_3}(2) + C(1 \\to 2)) + (S_{t_4}(1) + C(1 \\to 1)) = (0 + 2) + (0 + 0) = 2$.\n- $S_v(2) = \\left[ \\min_{j} (S_{t_3}(j) + C(2 \\to j)) \\right] + \\left[ \\min_{k} (S_{t_4}(k) + C(2 \\to k)) \\right]$\n$S_v(2) = (S_{t_3}(2) + C(2 \\to 2)) + (S_{t_4}(1) + C(2 \\to 1)) = (0 + 0) + (0 + 1) = 1$.\nSo, the score vector for node $v$ is $\\vec{S}_v = (7, 2, 1)$.\n\n**Calculation for root node $\\rho$ (children $u, v$):**\n- $S_\\rho(0) = \\left[ \\min_{j} (S_u(j) + C(0 \\to j)) \\right] + \\left[ \\min_{k} (S_v(k) + C(0 \\to k)) \\right]$\n$S_\\rho(0) = [\\min(S_u(0)+C(0\\to0), S_u(1)+C(0\\to1), S_u(2)+C(0\\to2))] + [\\min(S_v(0)+C(0\\to0), S_v(1)+C(0\\to1), S_v(2)+C(0\\to2))]$\n$S_\\rho(0) = [\\min(2+0, 1+2, 4+5)] + [\\min(7+0, 2+2, 1+5)] = \\min(2, 3, 9) + \\min(7, 4, 6) = 2 + 4 = 6$.\n- $S_\\rho(1) = \\left[ \\min_{j} (S_u(j) + C(1 \\to j)) \\right] + \\left[ \\min_{k} (S_v(k) + C(1 \\to k)) \\right]$\n$S_\\rho(1) = [\\min(S_u(0)+C(1\\to0), S_u(1)+C(1\\to1), S_u(2)+C(1\\to2))] + [\\min(S_v(0)+C(1\\to0), S_v(1)+C(1\\to1), S_v(2)+C(1\\to2))]$\n$S_\\rho(1) = [\\min(2+1, 1+0, 4+2)] + [\\min(7+1, 2+0, 1+2)] = \\min(3, 1, 6) + \\min(8, 2, 3) = 1 + 2 = 3$.\n- $S_\\rho(2) = \\left[ \\min_{j} (S_u(j) + C(2 \\to j)) \\right] + \\left[ \\min_{k} (S_v(k) + C(2 \\to k)) \\right]$\n$S_\\rho(2) = [\\min(S_u(0)+C(2\\to0), S_u(1)+C(2\\to1), S_u(2)+C(2\\to2))] + [\\min(S_v(0)+C(2\\to0), S_v(1)+C(2\\to1), S_v(2)+C(2\\to2))]$\n$S_\\rho(2) = [\\min(2+3, 1+1, 4+0)] + [\\min(7+3, 2+1, 1+0)] = \\min(5, 2, 4) + \\min(10, 3, 1) = 2 + 1 = 3$.\nSo, the score vector for the root node $\\rho$ is $\\vec{S}_\\rho = (6, 3, 3)$.\n\n**Step 3: Final Parsimony Score**\nThe total MP score for the character, $S$, is the minimum value in the score vector of the root node.\n$$\nS = \\min(S_\\rho(0), S_\\rho(1), S_\\rho(2)) = \\min(6, 3, 3) = 3\n$$\nThus, the minimum parsimony score for this character on the given tree is $3$.", "answer": "$$\n\\boxed{3}\n$$", "id": "4593188"}, {"introduction": "The parsimony criterion serves as a powerful tool for model selection, enabling us to compare competing evolutionary hypotheses (i.e., different tree topologies) and determine which one provides a more concise explanation of the data. This exercise ([@problem_id:4593241]) extends the application of Sankoff's algorithm to a practical data analysis scenario: choosing the most parsimonious tree from two alternatives. It also introduces realistic complexities, such as handling missing data and using a biologically informed cost matrix that differentiates between transitions and transversions, thus connecting the abstract algorithm to applied phylogenetic analysis.", "problem": "A cohort of five patient-derived viral isolates $\\mathrm{I}_1,\\mathrm{I}_2,\\mathrm{I}_3,\\mathrm{I}_4,\\mathrm{I}_5$ is genotyped at four independent loci, each locus being a single nucleotide with states in the alphabet $\\{\\mathrm{A},\\mathrm{C},\\mathrm{G},\\mathrm{T}\\}$. Missing data are recorded as $\\text{?}$ and should be treated as completely ambiguous, meaning all states are allowed at that leaf with zero penalty. Assume maximum parsimony under an additive step-matrix that penalizes transitions ($\\mathrm{A}\\leftrightarrow \\mathrm{G}$ and $\\mathrm{C}\\leftrightarrow \\mathrm{T}$) with cost $1$, transversions with cost $2$, and no cost for identical states. The four-site character matrix (site index $s=1,2,3,4$) is:\n- Site $1$: $\\mathrm{I}_1=\\mathrm{A}$, $\\mathrm{I}_2=\\mathrm{G}$, $\\mathrm{I}_3=\\text{?}$, $\\mathrm{I}_4=\\mathrm{G}$, $\\mathrm{I}_5=\\mathrm{A}$.\n- Site $2$: $\\mathrm{I}_1=\\mathrm{C}$, $\\mathrm{I}_2=\\mathrm{T}$, $\\mathrm{I}_3=\\mathrm{C}$, $\\mathrm{I}_4=\\text{?}$, $\\mathrm{I}_5=\\mathrm{T}$.\n- Site $3$: $\\mathrm{I}_1=\\mathrm{G}$, $\\mathrm{I}_2=\\mathrm{G}$, $\\mathrm{I}_3=\\mathrm{T}$, $\\mathrm{I}_4=\\mathrm{T}$, $\\mathrm{I}_5=\\text{?}$.\n- Site $4$: $\\mathrm{I}_1=\\mathrm{A}$, $\\mathrm{I}_2=\\mathrm{C}$, $\\mathrm{I}_3=\\mathrm{G}$, $\\mathrm{I}_4=\\mathrm{T}$, $\\mathrm{I}_5=\\mathrm{A}$.\n\nConsider the two alternative unrooted binary topologies on these isolates:\n- $\\mathcal{T}_1$: $((\\mathrm{I}_1,\\mathrm{I}_2),(\\mathrm{I}_3,(\\mathrm{I}_4,\\mathrm{I}_5)))$.\n- $\\mathcal{T}_2$: $((\\mathrm{I}_1,(\\mathrm{I}_2,\\mathrm{I}_3)),(\\mathrm{I}_4,\\mathrm{I}_5))$.\n\nStarting from first principles of maximum parsimony with an additive step-matrix, derive the dynamic programming recurrence needed to compute the minimal total substitution cost for each site on a given topology. Then, compute the total parsimony score across the four sites for each topology and determine which topology is preferred under this criterion. Express the final answer as a row matrix of the two total parsimony scores in the order $\\mathcal{T}_1,\\mathcal{T}_2$. No rounding is required.", "solution": "The problem requires the calculation and comparison of maximum parsimony scores for two given unrooted topologies, $\\mathcal{T}_1$ and $\\mathcal{T}_2$, based on a character matrix for five viral isolates. The scoring is determined by a non-uniform substitution cost matrix.\n\nFirst, we will establish the theoretical framework by deriving the dynamic programming recurrence for computing the minimum substitution cost (parsimony score). This method is a generalization of Fitch's algorithm, known as Sankoff's algorithm, which accommodates arbitrary substitution costs.\n\nLet $\\mathcal{T}$ be a given phylogenetic tree. For a single character site, the parsimony score is the minimum total number of substitutions (weighted by their cost) required to explain the character states observed at the leaves of the tree. Let the set of possible character states be $\\Sigma = \\{\\mathrm{A}, \\mathrm{C}, \\mathrm{G}, \\mathrm{T}\\}$. The cost of a substitution from state $i$ to state $j$ is given by a cost matrix $c(i, j)$.\n\nThe problem provides the following cost matrix, $c(i,j)$, where transitions (A$\\leftrightarrow$G, C$\\leftrightarrow$T) have a cost of $1$, and transversions have a cost of $2$:\n$$\nc = \\begin{pmatrix}\n & \\mathrm{A} & \\mathrm{C} & \\mathrm{G} & \\mathrm{T} \\\\\n\\mathrm{A} & 0 & 2 & 1 & 2 \\\\\n\\mathrm{C} & 2 & 0 & 2 & 1 \\\\\n\\mathrm{G} & 1 & 2 & 0 & 2 \\\\\n\\mathrm{T} & 2 & 1 & 2 & 0\n\\end{pmatrix}\n$$\n\nThe Sankoff algorithm calculates the parsimony score using a post-order traversal of the tree (from leaves to root). For each node $k$ in the tree, we compute a cost vector, $S_k$, where $S_k(x)$ is the minimum cost of the subtree rooted at $k$, given that node $k$ has the character state $x \\in \\Sigma$.\n\n**Dynamic Programming Recurrence:**\n\n1.  **Initialization (Leaf Nodes):** For a leaf node $k$ corresponding to an isolate with observed character state $x_k$:\n    - If the state $x_k$ is known (i.e., $x_k \\in \\Sigma$), the cost vector is:\n      $$ S_k(x) = \\begin{cases} 0 & \\text{if } x = x_k \\\\ \\infty & \\text{if } x \\neq x_k \\end{cases} $$\n    - If the state is missing data (i.e., $x_k = \\text{?}$), it is treated as completely ambiguous. Any state can be assigned without penalty.\n      $$ S_k(x) = 0 \\quad \\forall x \\in \\Sigma $$\n\n2.  **Recursion (Internal Nodes):** For an internal node $k$ with child nodes $i$ and $j$, the cost vector $S_k(x)$ is calculated as follows:\n    $$ S_k(x) = \\left( \\min_{y \\in \\Sigma} \\{ S_i(y) + c(x, y) \\} \\right) + \\left( \\min_{z \\in \\Sigma} \\{ S_j(z) + c(x, z) \\} \\right) $$\n    This formula sums the minimum costs for the subtrees of its children, including the substitution costs along the branches leading to them.\n\n3.  **Total Score (Rooted Tree):** For a tree rooted at node $R$, the parsimony score for the site is the minimum value in the root's cost vector:\n    $$ \\text{Score} = \\min_{x \\in \\Sigma} \\{ S_R(x) \\} $$\n\n4.  **Total Score (Unrooted Tree):** An unrooted tree with $N$ leaves has an arbitrary central edge. We can calculate the score by \"rooting\" the tree on this edge. Let the central edge connect internal nodes $u$ and $v$. The cost vectors $S_u$ and $S_v$ are calculated for the two subtrees that are formed by removing the edge $(u,v)$. The total parsimony score for the unrooted tree is then the minimum cost of connecting these two subtrees:\n    $$ \\text{Score} = \\min_{x, y \\in \\Sigma} \\{ S_u(x) + S_v(y) + c(x, y) \\} $$\n\nThe total parsimony score for a topology is the sum of the scores for each site. We now apply this procedure to the two given topologies. The cost vectors $S_k(x)$ will be represented as row vectors $(S_k(\\mathrm{A}), S_k(\\mathrm{C}), S_k(\\mathrm{G}), S_k(\\mathrm{T}))$.\n\n**Evaluation of Topology $\\mathcal{T}_1: ((\\mathrm{I}_1,\\mathrm{I}_2),(\\mathrm{I}_3,(\\mathrm{I}_4,\\mathrm{I}_5)))$**\nThis topology has a central edge connecting node $V_A$ (parent of $\\mathrm{I}_1, \\mathrm{I}_2$) and node $V_C$ (parent of $\\mathrm{I}_3$ and $V_B$, where $V_B$ is the parent of $\\mathrm{I}_4, \\mathrm{I}_5$).\n\n**Site 1:** $(\\mathrm{A}, \\mathrm{G}, \\text{?}, \\mathrm{G}, \\mathrm{A})$\n- Subtree at $V_A$ (children $\\mathrm{I}_1=\\mathrm{A}, \\mathrm{I}_2=\\mathrm{G}$): $S_{V_A}(x) = c(x,\\mathrm{A}) + c(x,\\mathrm{G}) = (0+1, 2+2, 1+0, 2+2) = (1,4,1,4)$.\n- Subtree at $V_B$ (children $\\mathrm{I}_4=\\mathrm{G}, \\mathrm{I}_5=\\mathrm{A}$): $S_{V_B}(x) = c(x,\\mathrm{G}) + c(x,\\mathrm{A}) = (1+0, 2+2, 0+1, 2+2) = (1,4,1,4)$.\n- Subtree at $V_C$ (children $\\mathrm{I}_3=\\text{?}, V_B$): $S_{V_C}(x) = \\min_{y}\\{0+c(x,y)\\} + \\min_{z}\\{S_{V_B}(z)+c(x,z)\\} = 0 + (1,3,1,3) = (1,3,1,3)$.\n- Total Score: $\\min_{x,y}\\{S_{V_A}(x)+S_{V_C}(y)+c(x,y)\\}$. With $S_{V_A}=(1,4,1,4)$ and $S_{V_C}=(1,3,1,3)$, the minimum is achieved for $x,y \\in \\{\\mathrm{A}, \\mathrm{G}\\}$. E.g., for $x=y=\\mathrm{A}$, cost is $1+1+0=2$.\n  **Score for Site 1 = $2$.**\n\n**Site 2:** $(\\mathrm{C}, \\mathrm{T}, \\mathrm{C}, \\text{?}, \\mathrm{T})$\n- Subtree at $V_A$ ($\\mathrm{I}_1=\\mathrm{C}, \\mathrm{I}_2=\\mathrm{T}$): $S_{V_A}(x) = c(x,\\mathrm{C}) + c(x,\\mathrm{T}) = (4,1,4,1)$.\n- Subtree at $V_B$ ($\\mathrm{I}_4=\\text{?}, \\mathrm{I}_5=\\mathrm{T}$): $S_{V_B}(x) = 0 + c(x,\\mathrm{T})=(2,1,2,0)$.\n- Subtree at $V_C$ ($\\mathrm{I}_3=\\mathrm{C}, V_B$): $S_{V_C}(x) = c(x,\\mathrm{C}) + \\min_{z}\\{S_{V_B}(z)+c(x,z)\\} = c(x,\\mathrm{C}) + (2,1,2,0) = (2,0,2,1) + (2,1,2,0) = (4,1,4,1)$.\n- Total Score: $\\min_{x,y}\\{S_{V_A}(x)+S_{V_C}(y)+c(x,y)\\}$. With $S_{V_A}=(4,1,4,1)$ and $S_{V_C}=(4,1,4,1)$. For $x=y=\\mathrm{C}$, cost is $1+1+0=2$.\n  **Score for Site 2 = $2$.**\n\n**Site 3:** $(\\mathrm{G}, \\mathrm{G}, \\mathrm{T}, \\mathrm{T}, \\text{?})$\n- Subtree at $V_A$ ($\\mathrm{I}_1=\\mathrm{G}, \\mathrm{I}_2=\\mathrm{G}$): $S_{V_A}(x) = c(x,\\mathrm{G}) + c(x,\\mathrm{G}) = (2,4,0,4)$.\n- Subtree at $V_B$ ($\\mathrm{I}_4=\\mathrm{T}, \\mathrm{I}_5=\\text{?}$): $S_{V_B}(x) = c(x,\\mathrm{T}) + 0 = (2,1,2,0)$.\n- Subtree at $V_C$ ($\\mathrm{I}_3=\\mathrm{T}, V_B$): $S_{V_C}(x) = c(x,\\mathrm{T}) + \\min_{z}\\{S_{V_B}(z)+c(x,z)\\} = (2,1,2,0) + (2,1,2,0) = (4,2,4,0)$.\n- Total Score: $\\min_{x,y}\\{S_{V_A}(x)+S_{V_C}(y)+c(x,y)\\}$. With $S_{V_A}=(2,4,0,4)$ and $S_{V_C}=(4,2,4,0)$. For $x=\\mathrm{G}, y=\\mathrm{T}$, cost is $0+0+2=2$.\n  **Score for Site 3 = $2$.**\n\n**Site 4:** $(\\mathrm{A}, \\mathrm{C}, \\mathrm{G}, \\mathrm{T}, \\mathrm{A})$\n- Subtree at $V_A$ ($\\mathrm{I}_1=\\mathrm{A}, \\mathrm{I}_2=\\mathrm{C}$): $S_{V_A}(x) = c(x,\\mathrm{A}) + c(x,\\mathrm{C}) = (2,2,3,3)$.\n- Subtree at $V_B$ ($\\mathrm{I}_4=\\mathrm{T}, \\mathrm{I}_5=\\mathrm{A}$): $S_{V_B}(x) = c(x,\\mathrm{T}) + c(x,\\mathrm{A}) = (2,3,3,2)$.\n- Subtree at $V_C$ ($\\mathrm{I}_3=\\mathrm{G}, V_B$): $S_{V_C}(x) = c(x,\\mathrm{G}) + \\min_z\\{S_{V_B}(z)+c(x,z)\\} = (1,2,0,2) + (2,3,3,2) = (3,5,3,4)$.\n- Total Score: $\\min_{x,y}\\{S_{V_A}(x)+S_{V_C}(y)+c(x,y)\\}$. With $S_{V_A}=(2,2,3,3)$ and $S_{V_C}=(3,5,3,4)$. For $x=y=\\mathrm{A}$, cost is $2+3+0=5$.\n  **Score for Site 4 = $5$.**\n\n**Total Score for $\\mathcal{T}_1$ = $2+2+2+5 = 11$.**\n\n**Evaluation of Topology $\\mathcal{T}_2: ((\\mathrm{I}_1,(\\mathrm{I}_2,\\mathrm{I}_3)),(\\mathrm{I}_4,\\mathrm{I}_5))$**\nThis topology has a central edge connecting node $V_F$ (parent of $\\mathrm{I}_1$ and $V_E$, where $V_E$ is the parent of $\\mathrm{I}_2, \\mathrm{I}_3$) and node $V_D$ (parent of $\\mathrm{I}_4, \\mathrm{I}_5$).\n\n**Site 1:** $(\\mathrm{A}, \\mathrm{G}, \\text{?}, \\mathrm{G}, \\mathrm{A})$\n- Subtree at $V_D$ ($\\mathrm{I}_4=\\mathrm{G}, \\mathrm{I}_5=\\mathrm{A}$): $S_{V_D}(x) = c(x,\\mathrm{G}) + c(x,\\mathrm{A}) = (1,4,1,4)$.\n- Subtree at $V_E$ ($\\mathrm{I}_2=\\mathrm{G}, \\mathrm{I}_3=\\text{?}$): $S_{V_E}(x) = c(x,\\mathrm{G}) + 0 = (1,2,0,2)$.\n- Subtree at $V_F$ ($\\mathrm{I}_1=\\mathrm{A}, V_E$): $S_{V_F}(x) = c(x,\\mathrm{A}) + \\min_z\\{S_{V_E}(z)+c(x,z)\\} = (0,2,1,2) + (1,2,0,2) = (1,4,1,4)$.\n- Total Score: $\\min_{x,y}\\{S_{V_F}(x)+S_{V_D}(y)+c(x,y)\\}$. Both vectors are $(1,4,1,4)$. For $x=y=\\mathrm{A}$ or $x=y=\\mathrm{G}$, cost is $1+1+0=2$.\n  **Score for Site 1 = $2$.**\n\n**Site 2:** $(\\mathrm{C}, \\mathrm{T}, \\mathrm{C}, \\text{?}, \\mathrm{T})$\n- Subtree at $V_D$ ($\\mathrm{I}_4=\\text{?}, \\mathrm{I}_5=\\mathrm{T}$): $S_{V_D}(x) = 0 + c(x,\\mathrm{T}) = (2,1,2,0)$.\n- Subtree at $V_E$ ($\\mathrm{I}_2=\\mathrm{T}, \\mathrm{I}_3=\\mathrm{C}$): $S_{V_E}(x)=c(x,\\mathrm{T})+c(x,\\mathrm{C}) = (4,1,4,1)$.\n- Subtree at $V_F$ ($\\mathrm{I}_1=\\mathrm{C}, V_E$): $S_{V_F}(x) = c(x,C) + \\min_z\\{S_{V_E}(z)+c(x,z)\\} = (2,0,2,1)+(3,1,3,1) = (5,1,5,2)$.\n- Total Score: $\\min_{x,y}\\{S_{V_F}(x)+S_{V_D}(y)+c(x,y)\\}$. With $S_{V_F}=(5,1,5,2), S_{V_D}=(2,1,2,0)$. For $x=y=\\mathrm{C}$, cost is $1+1+0=2$.\n  **Score for Site 2 = $2$.**\n\n**Site 3:** $(\\mathrm{G}, \\mathrm{G}, \\mathrm{T}, \\mathrm{T}, \\text{?})$\n- Subtree at $V_D$ ($\\mathrm{I}_4=\\mathrm{T}, \\mathrm{I}_5=\\text{?}$): $S_{V_D}(x) = c(x,\\mathrm{T}) + 0 = (2,1,2,0)$.\n- Subtree at $V_E$ ($\\mathrm{I}_2=\\mathrm{G}, \\mathrm{I}_3=\\mathrm{T}$): $S_{V_E}(x)=c(x,\\mathrm{G})+c(x,\\mathrm{T}) = (3,3,2,2)$.\n- Subtree at $V_F$ ($\\mathrm{I}_1=\\mathrm{G}, V_E$): $S_{V_F}(x) = c(x,\\mathrm{G}) + \\min_z\\{S_{V_E}(z)+c(x,z)\\} = (1,2,0,2) + (3,3,2,2) = (4,5,2,4)$.\n- Total Score: $\\min_{x,y}\\{S_{V_F}(x)+S_{V_D}(y)+c(x,y)\\}$. With $S_{V_F}=(4,5,2,4), S_{V_D}=(2,1,2,0)$. For $x=\\mathrm{G}, y=\\mathrm{T}$, cost is $2+0+2 = 4$.\n  **Score for Site 3 = $4$.**\n\n**Site 4:** $(\\mathrm{A}, \\mathrm{C}, \\mathrm{G}, \\mathrm{T}, \\mathrm{A})$\n- Subtree at $V_D$ ($\\mathrm{I}_4=\\mathrm{T}, \\mathrm{I}_5=\\mathrm{A}$): $S_{V_D}(x) = c(x,\\mathrm{T})+c(x,\\mathrm{A}) = (2,3,3,2)$.\n- Subtree at $V_E$ ($\\mathrm{I}_2=\\mathrm{C}, \\mathrm{I}_3=\\mathrm{G}$): $S_{V_E}(x)=c(x,\\mathrm{C})+c(x,\\mathrm{G}) = (3,2,2,3)$.\n- Subtree at $V_F$ ($\\mathrm{I}_1=\\mathrm{A}, V_E$): $S_{V_F}(x) = c(x,\\mathrm{A}) + \\min_z\\{S_{V_E}(z)+c(x,z)\\} = (0,2,1,2) + (3,2,2,3) = (3,4,3,5)$.\n- Total Score: $\\min_{x,y}\\{S_{V_F}(x)+S_{V_D}(y)+c(x,y)\\}$. With $S_{V_F}=(3,4,3,5), S_{V_D}=(2,3,3,2)$. For $x=y=\\mathrm{A}$, cost is $3+2+0=5$.\n  **Score for Site 4 = $5$.**\n\n**Total Score for $\\mathcal{T}_2$ = $2+2+4+5 = 13$.**\n\n**Conclusion**\nThe total parsimony score for topology $\\mathcal{T}_1$ is $11$.\nThe total parsimony score for topology $\\mathcal{T}_2$ is $13$.\nUnder the maximum parsimony criterion, the topology with the lowest score is preferred. Therefore, $\\mathcal{T}_1$ is the more parsimonious topology for this dataset and cost model. The final answer is the pair of scores for $\\mathcal{T}_1$ and $\\mathcal{T}_2$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n11 & 13\n\\end{pmatrix}\n}\n$$", "id": "4593241"}]}