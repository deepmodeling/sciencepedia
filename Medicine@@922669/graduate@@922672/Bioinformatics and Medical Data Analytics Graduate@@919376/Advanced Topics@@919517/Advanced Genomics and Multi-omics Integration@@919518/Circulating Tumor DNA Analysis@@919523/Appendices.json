{"hands_on_practices": [{"introduction": "Detecting a rare tumor-derived variant requires sufficient sequencing depth to distinguish true signal from background sequencing error. This practice problem guides you through a formal power calculation, a cornerstone of experimental design for any ctDNA assay. By applying a statistical model based on the binomial distribution and its normal approximation, you will determine the minimum coverage needed to achieve a desired level of statistical power, providing a quantitative foundation for assay development [@problem_id:4546218].", "problem": "In a targeted deep sequencing assay for circulating tumor deoxyribonucleic acid (ctDNA), a single nucleotide variant is assessed by counting the number of reads that support the variant. Assume independent read outcomes and a constant per-base miscall probability. Under the absence of a true variant, a read supports the variant only due to sequencing error with probability $e$. When a true variant is present at allele fraction $p$ in the cell-free deoxyribonucleic acid (DNA), the probability that a read supports the variant reflects two contributions: correct observation of the variant from a mutant molecule and erroneous observation of the variant from a wild-type molecule. Model this per-read probability under the presence of the variant as $\\theta_{1} = p(1 - e) + (1 - p)e$, and under the absence of the variant as $\\theta_{0} = e$. Let $X$ denote the number of variant-supporting reads in $n$ independent trials, so that $X \\sim \\operatorname{Bin}(n, \\theta)$ with $\\theta \\in \\{\\theta_{0}, \\theta_{1}\\}$ depending on whether the variant is absent or present.\n\nConsider a one-sided hypothesis test that calls the variant if $X \\geq k_{\\alpha}$, where the threshold $k_{\\alpha}$ is chosen so that the false positive probability under the absence of the variant is at most $\\alpha$. Using the normal approximation to the binomial distribution for large $n$, determine the minimal coverage depth $n$ that achieves statistical power $0.9$ at significance level $\\alpha = 0.01$ to detect a variant with allele fraction $p = 0.001$ given a per-base error rate $e = 1 \\times 10^{-3}$. Assume the background error model and independence described above, and use a one-sided test without continuity correction. Report the minimal integer $n$ that satisfies these constraints. No units are required for the final answer.", "solution": "The user wants me to solve a problem about determining the required sequencing depth for detecting a ctDNA variant.\n\nHere's my plan:\n1.  **Validate the problem statement**:\n    *   Extract all the given information.\n    *   Check for scientific soundness, consistency, and completeness.\n    *   The problem seems well-defined and grounded in standard statistical methods used in bioinformatics for NGS data analysis.\n\n2.  **Step 1: Extract Givens**\n    *   Per-base miscall probability (error rate): $e = 1 \\times 10^{-3}$\n    *   Variant allele fraction: $p = 0.001$\n    *   Significance level (Type I error rate): $\\alpha = 0.01$\n    *   Statistical power (1 - Type II error rate): $1 - \\beta = 0.9$\n    *   Model for variant presence: $X_1 \\sim \\operatorname{Bin}(n, \\theta_1)$ where $\\theta_1 = p(1 - e) + (1 - p)e$\n    *   Model for variant absence (null hypothesis): $X_0 \\sim \\operatorname{Bin}(n, \\theta_0)$ where $\\theta_0 = e$\n    *   Hypothesis test: Call variant if $X \\geq k_{\\alpha}$.\n    *   $k_{\\alpha}$ is chosen such that $P(X \\geq k_{\\alpha} | \\text{variant absent}) \\leq \\alpha$.\n    *   Approximation: Use Normal approximation to the Binomial distribution.\n    *   Correction: No continuity correction.\n    *   Goal: Find the minimal integer coverage depth $n$.\n\n3.  **Step 2: Validate Using Extracted Givens**\n    *   **Scientifically Grounded**: Yes. The model for read counts from sequencing is a standard binomial model. The probability of observing a variant read, $\\theta_1$, correctly accounts for reads from mutant alleles ($p(1-e)$) and reads from wild-type alleles that are miscalled ($ (1-p)e $). This is a well-established model in ctDNA analysis. The use of hypothesis testing, power, and significance levels is also standard.\n    *   **Well-Posed**: Yes. The problem asks for a specific value ($n$) based on a set of well-defined constraints ($\\alpha$, power, $p$, $e$). All necessary information is provided. A unique solution is expected.\n    *   **Objective**: Yes. The language is precise and quantitative. No subjective terms are used.\n    *   **Flaw Check**:\n        1.  **Scientific Unsoundness**: No. The models and methods are standard in bioinformatics.\n        2.  **Non-Formalizable**: No. The problem is already formalized mathematically. It is directly related to ctDNA analysis.\n        3.  **Incomplete/Contradictory**: No. All necessary parameters are given.\n        4.  **Unrealistic/Infeasible**: No. The values for $p$, $e$, $\\alpha$, and power are typical for ctDNA applications.\n        5.  **Ill-Posed**: No. The structure is a standard sample size calculation for a hypothesis test.\n        6.  **Pseudo-Profound/Trivial**: No. This is a non-trivial calculation involving setting up and solving two simultaneous inequalities derived from the power and significance constraints.\n        7.  **Outside Scientific Verifiability**: No. The result can be verified by direct calculation.\n\n4.  **Step 3: Verdict and Action**\n    *   The problem is **valid**. I will proceed with the solution.\n\n5.  **Develop the Solution**\n\n    *   **Define Hypotheses**:\n        *   Null Hypothesis ($H_0$): The variant is absent. The number of variant reads $X$ follows a binomial distribution $X \\sim \\operatorname{Bin}(n, \\theta_0)$.\n        *   Alternative Hypothesis ($H_1$): The variant is present. The number of variant reads $X$ follows a binomial distribution $X \\sim \\operatorname{Bin}(n, \\theta_1)$.\n\n    *   **Calculate Probabilities $\\theta_0$ and $\\theta_1$**:\n        *   $\\theta_0 = e = 1 \\times 10^{-3} = 0.001$.\n        *   $\\theta_1 = p(1 - e) + (1 - p)e = p - pe + e - pe = p + e - 2pe$.\n        *   Given $p = 0.001$ and $e = 0.001$:\n        *   $\\theta_1 = 0.001 + 0.001 - 2(0.001)(0.001) = 0.002 - 2 \\times 10^{-6} = 0.001998$.\n\n    *   **Apply Normal Approximation**:\n        *   For large $n$, if $X \\sim \\operatorname{Bin}(n, \\theta)$, then $X$ is approximately normally distributed: $X \\approx N(n\\theta, n\\theta(1-\\theta))$.\n        *   Under $H_0$: $X_0 \\approx N(\\mu_0, \\sigma_0^2)$ where $\\mu_0 = n\\theta_0$ and $\\sigma_0^2 = n\\theta_0(1-\\theta_0)$.\n        *   Under $H_1$: $X_1 \\approx N(\\mu_1, \\sigma_1^2)$ where $\\mu_1 = n\\theta_1$ and $\\sigma_1^2 = n\\theta_1(1-\\theta_1)$.\n\n    *   **Set up the Significance Level Constraint**:\n        *   The false positive probability (Type I error) must be at most $\\alpha$.\n        *   $P(X \\geq k_{\\alpha} | H_0) \\leq \\alpha$.\n        *   Using the normal approximation for $X_0$: $P\\left(\\frac{X_0 - \\mu_0}{\\sigma_0} \\geq \\frac{k_{\\alpha} - \\mu_0}{\\sigma_0}\\right) \\leq \\alpha$.\n        *   Let $Z \\sim N(0, 1)$ be the standard normal random variable.\n        *   $P\\left(Z \\geq \\frac{k_{\\alpha} - n\\theta_0}{\\sqrt{n\\theta_0(1-\\theta_0)}}\\right) \\leq \\alpha$.\n        *   Let $z_{\\alpha}$ be the upper $\\alpha$-quantile of the standard normal distribution, i.e., $P(Z \\geq z_{\\alpha}) = \\alpha$.\n        *   For the inequality to hold, we need $\\frac{k_{\\alpha} - n\\theta_0}{\\sqrt{n\\theta_0(1-\\theta_0)}} \\geq z_{\\alpha}$.\n        *   We set the threshold at the boundary of the critical region: $\\frac{k_{\\alpha} - n\\theta_0}{\\sqrt{n\\theta_0(1-\\theta_0)}} = z_{\\alpha}$.\n        *   This gives us an expression for the critical value $k_{\\alpha}$:\n            $k_{\\alpha} = n\\theta_0 + z_{\\alpha}\\sqrt{n\\theta_0(1-\\theta_0)}$. (Equation 1)\n\n    *   **Set up the Power Constraint**:\n        *   The power is the probability of correctly rejecting $H_0$ when $H_1$ is true. Power = $1 - \\beta$.\n        *   $P(X \\geq k_{\\alpha} | H_1) = 1 - \\beta$.\n        *   Using the normal approximation for $X_1$: $P\\left(\\frac{X_1 - \\mu_1}{\\sigma_1} \\geq \\frac{k_{\\alpha} - \\mu_1}{\\sigma_1}\\right) = 1 - \\beta$.\n        *   $P\\left(Z \\geq \\frac{k_{\\alpha} - n\\theta_1}{\\sqrt{n\\theta_1(1-\\theta_1)}}\\right) = 1 - \\beta$.\n        *   Let $z_{1-\\beta}$ be the upper $(1-\\beta)$-quantile of the standard normal distribution. By symmetry of the normal distribution, $z_{1-\\beta} = -z_{\\beta}$.\n        *   So, we need $\\frac{k_{\\alpha} - n\\theta_1}{\\sqrt{n\\theta_1(1-\\theta_1)}} = z_{1-\\beta} = -z_{\\beta}$.\n        *   This gives another expression for $k_{\\alpha}$:\n            $k_{\\alpha} = n\\theta_1 - z_{\\beta}\\sqrt{n\\theta_1(1-\\theta_1)}$. (Equation 2)\n\n    *   **Solve for n**:\n        *   Equate the two expressions for $k_{\\alpha}$ (Equation 1 and Equation 2):\n            $n\\theta_0 + z_{\\alpha}\\sqrt{n\\theta_0(1-\\theta_0)} = n\\theta_1 - z_{\\beta}\\sqrt{n\\theta_1(1-\\theta_1)}$.\n        *   Rearrange the terms to solve for $\\sqrt{n}$:\n            $n\\theta_1 - n\\theta_0 = z_{\\alpha}\\sqrt{n\\theta_0(1-\\theta_0)} + z_{\\beta}\\sqrt{n\\theta_1(1-\\theta_1)}$.\n            $n(\\theta_1 - \\theta_0) = \\sqrt{n} \\left( z_{\\alpha}\\sqrt{\\theta_0(1-\\theta_0)} + z_{\\beta}\\sqrt{\\theta_1(1-\\theta_1)} \\right)$.\n            $\\sqrt{n}(\\theta_1 - \\theta_0) = z_{\\alpha}\\sqrt{\\theta_0(1-\\theta_0)} + z_{\\beta}\\sqrt{\\theta_1(1-\\theta_1)}$.\n        *   Isolate $\\sqrt{n}$:\n            $\\sqrt{n} = \\frac{z_{\\alpha}\\sqrt{\\theta_0(1-\\theta_0)} + z_{\\beta}\\sqrt{\\theta_1(1-\\theta_1)}}{\\theta_1 - \\theta_0}$.\n        *   Square both sides to get $n$:\n            $n = \\left( \\frac{z_{\\alpha}\\sqrt{\\theta_0(1-\\theta_0)} + z_{\\beta}\\sqrt{\\theta_1(1-\\theta_1)}}{\\theta_1 - \\theta_0} \\right)^2$.\n\n    *   **Plug in the numbers**:\n        *   $\\alpha = 0.01$. We need $z_{0.01}$. Looking up in a standard normal table or using a calculator, $z_{0.01} \\approx 2.3263$.\n        *   Power = $1 - \\beta = 0.9$, so $\\beta = 0.1$. We need $z_{0.1}$. Looking up in a table, $z_{0.1} \\approx 1.2816$.\n        *   $\\theta_0 = e = 0.001$.\n        *   $\\theta_1 = p(1-e) + (1-p)e = 0.001(1-0.001) + (1-0.001)(0.001) = 0.001(0.999) + (0.999)(0.001) = 0.000999 + 0.000999 = 0.001998$.\n        *   Wait, let's double check the formula for $\\theta_1$.\n            $\\theta_1 = p(1-e) + (1-p)e$. Yes, this is correct.\n            If a molecule is mutant (prob $p$), the read is correct (prob $1-e$). So $p(1-e)$.\n            If a molecule is wild-type (prob $1-p$), the read is an error (prob $e$). So $(1-p)e$.\n            The sum is the total probability of observing a variant read.\n            $\\theta_1 = 0.001 \\times (1-0.001) + (1-0.001) \\times 0.001 = 0.001 \\times 0.999 + 0.999 \\times 0.001 = 0.000999 + 0.000999 = 0.001998$.\n            This seems extremely close to $2p$. Let's check the alternative way of writing it: $\\theta_1 = p+e-2pe = 0.001 + 0.001 - 2(0.001)(0.001) = 0.002 - 0.000002 = 0.001998$. Correct.\n\n    *   **Calculate the terms for the formula of n**:\n        *   $\\theta_1 - \\theta_0 = 0.001998 - 0.001 = 0.000998$.\n        *   $\\sqrt{\\theta_0(1-\\theta_0)} = \\sqrt{0.001(1-0.001)} = \\sqrt{0.001 \\times 0.999} = \\sqrt{0.000999} \\approx 0.031607$.\n        *   $\\sqrt{\\theta_1(1-\\theta_1)} = \\sqrt{0.001998(1-0.001998)} = \\sqrt{0.001998 \\times 0.998002} = \\sqrt{0.001994007996} \\approx 0.044654$.\n        *   Numerator = $z_{\\alpha}\\sqrt{\\theta_0(1-\\theta_0)} + z_{\\beta}\\sqrt{\\theta_1(1-\\theta_1)}$\n            $= (2.3263) \\times (0.031607) + (1.2816) \\times (0.044654)$\n            $= 0.073527 + 0.057229$\n            $= 0.130756$\n        *   Denominator = $\\theta_1 - \\theta_0 = 0.000998$.\n        *   $\\sqrt{n} = \\frac{0.130756}{0.000998} \\approx 131.018$.\n        *   $n = (131.018)^2 \\approx 17165.7$.\n\n    *   **Refine the calculation using more precision**:\n        *   $z_{0.01} \\approx 2.326347874$\n        *   $z_{0.1} \\approx 1.281551566$\n        *   $\\theta_0 = 0.001$\n        *   $\\theta_1 = 0.001998$\n        *   $\\theta_1 - \\theta_0 = 0.000998$\n        *   $\\theta_0(1-\\theta_0) = 0.001 \\times 0.999 = 0.000999$\n        *   $\\sqrt{\\theta_0(1-\\theta_0)} = \\sqrt{0.000999} \\approx 0.03160696126$\n        *   $\\theta_1(1-\\theta_1) = 0.001998 \\times (1-0.001998) = 0.001998 \\times 0.998002 = 0.001994007996$\n        *   $\\sqrt{\\theta_1(1-\\theta_1)} = \\sqrt{0.001994007996} \\approx 0.0446543166$\n        *   Numerator: \n            $(2.326347874 \\times 0.03160696126) + (1.281551566 \\times 0.0446543166)$\n            $= 0.073527457 + 0.057228834 = 0.130756291$\n        *   $\\sqrt{n} = \\frac{0.130756291}{0.000998} = 131.01832765$\n        *   $n = (131.01832765)^2 = 17165.806...$\n\n    *   **Approximation check**:\n        *   The formula for $n$ is standard for comparing two proportions.\n        *   It can be simplified if $\\theta_0$ and $\\theta_1$ are small. Then $1-\\theta_0 \\approx 1$ and $1-\\theta_1 \\approx 1$.\n        *   $n \\approx \\left( \\frac{z_{\\alpha}\\sqrt{\\theta_0} + z_{\\beta}\\sqrt{\\theta_1}}{\\theta_1 - \\theta_0} \\right)^2$.\n        *   Let's see what value this gives.\n        *   $\\sqrt{\\theta_0} = \\sqrt{0.001} \\approx 0.03162277$\n        *   $\\sqrt{\\theta_1} = \\sqrt{0.001998} \\approx 0.04469899$\n        *   Numerator $\\approx (2.3263) \\times (0.03162277) + (1.2816) \\times (0.04469899)$\n            $= 0.07356 + 0.05728 = 0.13084$\n        *   Denominator = $0.000998$\n        *   $\\sqrt{n} \\approx \\frac{0.13084}{0..000998} \\approx 131.102$\n        *   $n \\approx (131.102)^2 \\approx 17187.7$.\n        *   This is close, but the original formula is more accurate. The problem doesn't state to use this simplification, so I will stick with the full formula.\n\n    *   **Final answer**: The problem asks for the minimal *integer* $n$. Since we calculated $n = 17165.806...$, we need to round up to the next integer to ensure the power and significance level constraints are met.\n    *   So, the minimal integer $n$ is $17166$.\n\n    *   **Double check the logic**:\n        1.  Hypotheses are correct. $H_0: \\theta = \\theta_0$, $H_1: \\theta = \\theta_1$.\n        2.  Test is one-sided, reject for large $X$.\n        3.  Normal approximation is specified.\n        4.  Constraint 1 (Significance): $P(X \\ge k | H_0) \\le \\alpha$.\n            This leads to $\\frac{k - n\\theta_0}{\\sqrt{n\\theta_0(1-\\theta_0)}} \\ge z_\\alpha$. We set it to equality for the boundary case, so $k = n\\theta_0 + z_\\alpha \\sqrt{n\\theta_0(1-\\theta_0)}$.\n        5.  Constraint 2 (Power): $P(X \\ge k | H_1) = 1-\\beta$.\n            This leads to $\\frac{k - n\\theta_1}{\\sqrt{n\\theta_1(1-\\theta_1)}} = z_{1-\\beta} = -z_\\beta$. So $k = n\\theta_1 - z_\\beta \\sqrt{n\\theta_1(1-\\theta_1)}$.\n        6.  Equating the two expressions for $k$:\n            $n\\theta_0 + z_\\alpha \\sqrt{n\\theta_0(1-\\theta_0)} = n\\theta_1 - z_\\beta \\sqrt{n\\theta_1(1-\\theta_1)}$\n            $n(\\theta_1 - \\theta_0) = z_\\alpha \\sqrt{n\\theta_0(1-\\theta_0)} + z_\\beta \\sqrt{n\\theta_1(1-\\theta_1)}$\n            $\\sqrt{n} (\\theta_1 - \\theta_0) = z_\\alpha \\sqrt{\\theta_0(1-\\theta_0)} + z_\\beta \\sqrt{\\theta_1(1-\\theta_1)}$\n            $\\sqrt{n} = \\frac{z_\\alpha \\sqrt{\\theta_0(1-\\theta_0)} + z_\\beta \\sqrt{\\theta_1(1-\\theta_1)}}{\\theta_1 - \\theta_0}$\n            This is the standard formula. The derivation is correct.\n\n    *   **Final numerical check**:\n        *   $e = 10^{-3}$\n        *   $p = 10^{-3}$\n        *   $\\alpha = 0.01 \\implies z_\\alpha \\approx 2.3263$\n        *   $1-\\beta = 0.9 \\implies \\beta = 0.1 \\implies z_\\beta \\approx 1.2816$\n        *   $\\theta_0 = e = 0.001$\n        *   $\\theta_1 = p + e - 2pe = 0.001 + 0.001 - 2(0.001)^2 = 0.002 - 0.000002 = 0.001998$\n        *   $\\theta_1 - \\theta_0 = 0.000998$\n        *   $\\sqrt{\\theta_0(1-\\theta_0)} = \\sqrt{0.001 \\times 0.999} = \\sqrt{0.000999} \\approx 0.031607$\n        *   $\\sqrt{\\theta_1(1-\\theta_1)} = \\sqrt{0.001998 \\times 0.998002} = \\sqrt{0.001994007996} \\approx 0.044654$\n        *   $\\sqrt{n} = \\frac{2.3263 \\times 0.031607 + 1.2816 \\times 0.044654}{0.000998}$\n        *   $\\sqrt{n} = \\frac{0.073527 + 0.057229}{0.000998} = \\frac{0.130756}{0.000998} \\approx 131.018$\n        *   $n = (131.018)^2 \\approx 17165.7$\n        *   Minimal integer $n$ is $17166$.\n\n    *   The problem specifies \"without continuity correction\". My derivation uses the normal approximation directly on the discrete variable, which is what \"without continuity correction\" implies. If a continuity correction were used, the conditions would be $P(X \\ge k) \\approx P(X_{cont} \\ge k-0.5)$, which would slightly alter the formulas. Since it is explicitly forbidden, my current approach is correct.\n\n    *   The logic and calculation appear solid. Now I will write it all out formally. I need to be careful with the LaTeX formatting for all mathematical expressions.\n\n    *   **Structure of the solution text**:\n        1.  State the problem as a hypothesis test. Define $H_0$ and $H_1$.\n        2.  Identify the distributions under $H_0$ and $H_1$.\n        3.  Specify the parameters $\\theta_0$ and $\\theta_1$ and calculate their values.\n        4.  Introduce the normal approximation to the binomial distribution. State the mean and variance under both hypotheses.\n        5.  Formulate the condition for the significance level $\\alpha$. This defines the critical value $k_{\\alpha}$ in terms of $n$ and $z_\\alpha$.\n        6.  Formulate the condition for the power $1-\\beta$. This gives a second expression for $k_{\\alpha}$ in terms of $n$ and $z_\\beta$.\n        7.  Equate the two expressions for $k_{\\alpha}$ and solve for $n$.\n        8.  Substitute the given numerical values for $\\alpha$, $1-\\beta$, $p$, and $e$.\n        9.  Calculate the value of $n$ and round up to the nearest integer to find the minimal required coverage.\n        10. Final answer in the required format.\n\n    *   Let's check the constraints on the normal approximation. We need $n\\theta$ and $n(1-\\theta)$ to be sufficiently large (e.g.,  5 or  10).\n        *   With $n \\approx 17166$:\n        *   $n\\theta_0 = 17166 \\times 0.001 = 17.166  10$.\n        *   $n(1-\\theta_0) = 17166 \\times 0.999 \\approx 17149  10$.\n        *   $n\\theta_1 = 17166 \\times 0.001998 \\approx 34.298  10$.\n        *   $n(1-\\theta_1) = 17166 \\times 0.998002 \\approx 17131  10$.\n        *   The normal approximation is justified *a posteriori*.\n\n    *   The steps are robust. I am ready to write the solution. The problem has no flaws and is well-defined. My reasoning is sound and the calculations are verified.", "answer": "$$\\boxed{17166}$$", "id": "4546218"}, {"introduction": "Once a ctDNA assay is developed, understanding its performance in a clinical setting is paramount. This exercise moves from the intrinsic properties of a test—sensitivity and specificity—to its practical predictive power using Bayes' theorem. You will calculate the Positive and Negative Predictive Values ($P(D \\mid T^{+})$ and $P(\\overline{D} \\mid T^{-})$), learning how disease prevalence in a population critically influences the interpretation of a positive or negative result for minimal residual disease (MRD) monitoring [@problem_id:4546294].", "problem": "A clinical trial is evaluating a Circulating Tumor DNA (ctDNA)-based Minimal Residual Disease (MRD) assay for post-operative surveillance in patients with resected colorectal cancer. The assay reports a binary outcome: positive when tumor-specific variants are detected above a predefined limit of detection, and negative otherwise. In a validation cohort representative of the target surveillance population, the disease prevalence (the probability that a patient truly harbors residual disease at the time of testing) is $0.2$. At the chosen decision threshold, the assay has sensitivity $0.8$ and specificity $0.98$, where sensitivity is defined as $P(T^{+} \\mid D)$ and specificity is defined as $P(T^{-} \\mid \\overline{D})$, with $T^{+}$/$T^{-}$ denoting a positive/negative test and $D$/$\\overline{D}$ denoting disease present/absent. Using only the core definitions of sensitivity, specificity, and disease prevalence, together with Bayes theorem and the law of total probability, derive and compute the positive predictive value $P(D \\mid T^{+})$ and the negative predictive value $P(\\overline{D} \\mid T^{-})$ for this ctDNA-based MRD assay. Express each value as a decimal rounded to four significant figures.", "solution": "The problem statement is subjected to a rigorous validation process before any attempt at a solution.\n\n### Step 1: Extract Givens\nThe following quantities and definitions are provided verbatim:\n-   Disease prevalence: $P(D) = 0.2$\n-   Assay sensitivity: $P(T^{+} \\mid D) = 0.8$\n-   Assay specificity: $P(T^{-} \\mid \\overline{D}) = 0.98$\n-   $T^{+}$: a positive test result\n-   $T^{-}$: a negative test result\n-   $D$: disease is present\n-   $\\overline{D}$: disease is absent\n-   Required quantities: Positive Predictive Value, $P(D \\mid T^{+})$, and Negative Predictive Value, $P(\\overline{D} \\mid T^{-})$.\n-   Constraints: The derivation must use only the core definitions of sensitivity, specificity, prevalence, Bayes' theorem, and the law of total probability. The final values must be expressed as decimals rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity:\n-   **Scientifically Grounded**: The problem is well-grounded in biostatistics and clinical diagnostics, a core component of bioinformatics and medical analytics. The concepts of sensitivity, specificity, prevalence, positive predictive value (PPV), and negative predictive value (NPV) are standard metrics for evaluating diagnostic tests. The application to circulating tumor DNA (ctDNA) for Minimal Residual Disease (MRD) monitoring is a current and highly relevant topic in oncology. The provided numerical values for prevalence ($20\\%$), sensitivity ($80\\%$), and specificity ($98\\%$) are plausible for such an assay in a post-operative surveillance context. The problem adheres to established scientific and mathematical principles.\n-   **Well-Posed**: The problem is well-posed. It provides all necessary information to compute the requested quantities. The definitions are standard, and the required derivation path using specific theorems (Bayes, Law of Total Probability) ensures that a unique and meaningful solution exists.\n-   **Objective**: The problem is stated with objective, precise, and unambiguous language. All terms are formally defined using standard probabilistic notation. There are no subjective or opinion-based elements.\n\nThe problem does not exhibit any flaws such as scientific unsoundness, missing information, contradiction, or vagueness. It is a standard, formalizable problem in applied probability theory.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A full solution will be derived.\n\n### Solution Derivation\nThe objective is to compute the positive predictive value, $P(D \\mid T^{+})$, and the negative predictive value, $P(\\overline{D} \\mid T^{-})$. This requires the application of Bayes' theorem in conjunction with the law of total probability.\n\nFirst, we establish the probabilities of the complementary events, which will be necessary for the calculations.\nThe probability of a patient being disease-free is the complement of the disease prevalence:\n$$P(\\overline{D}) = 1 - P(D) = 1 - 0.2 = 0.8$$\nThe probability of a false negative is the complement of sensitivity:\n$$P(T^{-} \\mid D) = 1 - P(T^{+} \\mid D) = 1 - 0.8 = 0.2$$\nThe probability of a false positive is the complement of specificity:\n$$P(T^{+} \\mid \\overline{D}) = 1 - P(T^{-} \\mid \\overline{D}) = 1 - 0.98 = 0.02$$\n\n**1. Calculation of the Positive Predictive Value (PPV)**\n\nThe PPV is the probability that a patient has the disease given a positive test result, noted as $P(D \\mid T^{+})$. According to Bayes' theorem:\n$$P(D \\mid T^{+}) = \\frac{P(T^{+} \\mid D) P(D)}{P(T^{+})}$$\nThe denominator, $P(T^{+})$, is the total probability of a positive test result. It can be expanded using the law of total probability by conditioning on the disease state ($D$ or $\\overline{D}$):\n$$P(T^{+}) = P(T^{+} \\mid D) P(D) + P(T^{+} \\mid \\overline{D}) P(\\overline{D})$$\nThis expression represents the sum of probabilities of true positives and false positives. Substituting this into the Bayes' theorem expression for PPV gives the full formula:\n$$P(D \\mid T^{+}) = \\frac{P(T^{+} \\mid D) P(D)}{P(T^{+} \\mid D) P(D) + P(T^{+} \\mid \\overline{D}) P(\\overline{D})}$$\nNow, we substitute the given numerical values:\n$$P(D \\mid T^{+}) = \\frac{(0.8)(0.2)}{(0.8)(0.2) + (0.02)(0.8)}$$\n$$P(D \\mid T^{+}) = \\frac{0.16}{0.16 + 0.016} = \\frac{0.16}{0.176}$$\n$$P(D \\mid T^{+}) = \\frac{10}{11} \\approx 0.909090...$$\nRounding to four significant figures, the PPV is $0.9091$.\n\n**2. Calculation of the Negative Predictive Value (NPV)**\n\nThe NPV is the probability that a patient is disease-free given a negative test result, noted as $P(\\overline{D} \\mid T^{-})$. According to Bayes' theorem:\n$$P(\\overline{D} \\mid T^{-}) = \\frac{P(T^{-} \\mid \\overline{D}) P(\\overline{D})}{P(T^{-})}$$\nThe denominator, $P(T^{-})$, is the total probability of a negative test result. It can be expanded using the law of total probability:\n$$P(T^{-}) = P(T^{-} \\mid D) P(D) + P(T^{-} \\mid \\overline{D}) P(\\overline{D})$$\nThis expression represents the sum of probabilities of false negatives and true negatives. Substituting this into the Bayes' theorem expression for NPV gives the full formula:\n$$P(\\overline{D} \\mid T^{-}) = \\frac{P(T^{-} \\mid \\overline{D}) P(\\overline{D})}{P(T^{-} \\mid D) P(D) + P(T^{-} \\mid \\overline{D}) P(\\overline{D})}$$\nNow, we substitute the numerical values:\n$$P(\\overline{D} \\mid T^{-}) = \\frac{(0.98)(0.8)}{(0.2)(0.2) + (0.98)(0.8)}$$\n$$P(\\overline{D} \\mid T^{-}) = \\frac{0.784}{0.04 + 0.784} = \\frac{0.784}{0.824}$$\n$$P(\\overline{D} \\mid T^{-}) = \\frac{98}{103} \\approx 0.951456...$$\nRounding to four significant figures, the NPV is $0.9515$.\n\nThe derived values are $P(D \\mid T^{+}) \\approx 0.9091$ and $P(\\overline{D} \\mid T^{-}) \\approx 0.9515$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.9091  0.9515\n\\end{pmatrix}\n}\n$$", "id": "4546294"}, {"introduction": "A primary challenge in ctDNA analysis is distinguishing true tumor-derived somatic mutations from non-tumor variants, such as germline polymorphisms or clonal hematopoiesis of indeterminate potential (CHIP). This advanced practice requires you to implement a Bayesian filtering strategy that leverages a matched-normal sample to make this distinction. By modeling allele counts and their uncertainty, you will build a principled decision rule to retain tumor-specific signals, a foundational skill for any bioinformatician working with ctDNA data [@problem_id:4546235].", "problem": "You are tasked with designing and implementing a decision rule to filter non-tumor variants using matched-normal white blood cell (WBC) sequencing while retaining tumor-specific signals in circulating tumor deoxyribonucleic acid (ctDNA) analysis. You will model allele counts from plasma and matched-normal WBC as arising from binomial sampling with an unknown alternate allele fraction, and you will use a Bayesian approach with a noninformative prior to quantify evidence. The objective is to construct a mathematically principled rule that filters germline and Clonal Hematopoiesis of Indeterminate Potential (CHIP) variants while preserving true tumor-derived variants.\n\nStart from the following fundamental base:\n- For each locus, the number of alternate reads in a sample with total depth follows a binomial distribution conditioned on the underlying alternate allele fraction. If $a$ is the alternate read count and $n$ is the total depth, then $a \\sim \\mathrm{Binomial}(n, p)$ for some unknown $p \\in [0,1]$.\n- Use the Jeffreys prior for a binomial proportion, which is the Beta distribution $\\mathrm{Beta}(\\alpha_0, \\beta_0)$ with $\\alpha_0 = 0.5$ and $\\beta_0 = 0.5$.\n- The matched-normal WBC and plasma measurements are conditionally independent given their respective allele fractions under this model.\n\nDefinitions:\n- Let $n_p$ and $a_p$ denote plasma depth and plasma alternate reads for a variant.\n- Let $n_w$ and $a_w$ denote WBC depth and WBC alternate reads for the same variant.\n- Let $p_p$ and $p_w$ denote the unknown alternate allele fractions in plasma and WBC, respectively.\n- Define the posterior distributions $p_p \\mid (a_p, n_p) \\sim \\mathrm{Beta}(\\alpha_p, \\beta_p)$ and $p_w \\mid (a_w, n_w) \\sim \\mathrm{Beta}(\\alpha_w, \\beta_w)$ derived from the prior $\\mathrm{Beta}(0.5, 0.5)$ and the binomial likelihood.\n\nDecision rule requirements:\n- You must compute the posterior probability that the WBC alternate allele fraction exceeds a WBC minimum threshold $\\tau_w \\in (0,1)$, namely $S_w = \\Pr(p_w  \\tau_w \\mid a_w, n_w)$.\n- You must compute the posterior probability that plasma is enriched relative to WBC by at least a factor $c  1$, namely $E = \\Pr(p_p  c \\, p_w \\mid a_p, n_p, a_w, n_w)$, where $p_p$ and $p_w$ are independent a posteriori under separate Beta posteriors.\n- Use the following fixed hyperparameters for all variants: $\\alpha_0 = 0.5$, $\\beta_0 = 0.5$, $\\tau_w = 0.01$, $\\tau_p = 0.005$ (used only for internal validation), enrichment factor $c = 3.0$, WBC evidence threshold $\\theta_w = 0.95$, and enrichment significance threshold $\\theta_{\\mathrm{enrich}} = 0.10$.\n\nFilter decision rule:\n- Output $1$ (filter as non-tumor) if and only if both of the following hold:\n  1. $S_w \\ge \\theta_w$ (strong WBC evidence of presence above $\\tau_w$),\n  2. $E \\le \\theta_{\\mathrm{enrich}}$ (no strong evidence that plasma is enriched relative to WBC by factor $c$).\n- Otherwise, output $0$ (retain as possibly tumor-specific).\n\nInput data for this task is embedded in the program and consists of a small test suite, each test case represented as an ordered quadruple $(n_p, a_p, n_w, a_w)$:\n- Case 1 (tumor-specific, clear): $(n_p, a_p, n_w, a_w) = (4000, 200, 4000, 2)$.\n- Case 2 (germline heterozygous): $(n_p, a_p, n_w, a_w) = (500, 255, 500, 250)$.\n- Case 3 (CHIP-like, WBC high, plasma low): $(n_p, a_p, n_w, a_w) = (6000, 120, 2000, 200)$.\n- Case 4 (noise-only, both near error): $(n_p, a_p, n_w, a_w) = (10000, 5, 10000, 8)$.\n- Case 5 (both present but plasma enriched; retain): $(n_p, a_p, n_w, a_w) = (3000, 300, 3000, 60)$.\n- Case 6 (germline homozygous alternate): $(n_p, a_p, n_w, a_w) = (200, 198, 200, 199)$.\n- Case 7 (borderline WBC weak, plasma moderate; retain): $(n_p, a_p, n_w, a_w) = (3000, 90, 3000, 18)$.\n\nScientific realism and modeling assumptions:\n- The measurement process for $a_p$ given $n_p$ and $p_p$ and for $a_w$ given $n_w$ and $p_w$ is binomial as defined above.\n- Sequencing error rates are implicitly handled by the choice of $\\tau_w$ and by using a prior that does not spuriously inflate evidence near zero; do not use any explicit error rate parameters. All allele fractions are expressed as decimals in $[0,1]$.\n- The probability $E$ must be computed from first principles given the independent Beta posterior distributions for $p_p$ and $p_w$. You may compute $E$ using exact analytical expressions when available or by numerical integration consistent with the definitions.\n\nYour program should produce a single line of output containing the results for the seven test cases as a comma-separated list of integers enclosed in square brackets (for example, \"[1,0,1,0,1,1,0]\"). The $i$-th integer must be the decision for the $i$-th test case, where $1$ indicates \"filter\" and $0$ indicates \"retain\". No other text should be printed.", "solution": "We begin from the binomial sampling model. For a given locus, let $a_p \\sim \\mathrm{Binomial}(n_p, p_p)$ and $a_w \\sim \\mathrm{Binomial}(n_w, p_w)$ with $p_p, p_w \\in [0,1]$ representing the unknown alternate allele fractions in plasma and white blood cells (WBC), respectively. We place the Jeffreys prior $\\mathrm{Beta}(\\alpha_0, \\beta_0)$ with $\\alpha_0 = 0.5$ and $\\beta_0 = 0.5$ independently on $p_p$ and $p_w$. By conjugacy, the posteriors are\n$$\np_p \\mid (a_p, n_p) \\sim \\mathrm{Beta}(\\alpha_p, \\beta_p), \\quad \\alpha_p = \\alpha_0 + a_p, \\ \\beta_p = \\beta_0 + (n_p - a_p),\n$$\n$$\np_w \\mid (a_w, n_w) \\sim \\mathrm{Beta}(\\alpha_w, \\beta_w), \\quad \\alpha_w = \\alpha_0 + a_w, \\ \\beta_w = \\beta_0 + (n_w - a_w).\n$$\nBecause the plasma and WBC measurements are generated by distinct sampling processes conditioned on their respective parameters and the priors are independent, the posterior distributions for $p_p$ and $p_w$ are independent.\n\nWe require the following posterior probabilities:\n\n1. The WBC evidence statistic $S_w = \\Pr(p_w  \\tau_w \\mid a_w, n_w)$. Since $p_w \\mid \\text{data} \\sim \\mathrm{Beta}(\\alpha_w, \\beta_w)$, we can express\n$$\nS_w = \\int_{\\tau_w}^{1} \\frac{1}{B(\\alpha_w,\\beta_w)} x^{\\alpha_w - 1} (1-x)^{\\beta_w - 1} \\, dx = 1 - I_{\\tau_w}(\\alpha_w,\\beta_w),\n$$\nwhere $B(\\cdot,\\cdot)$ is the Beta function and $I_{x}(\\alpha,\\beta)$ is the regularized incomplete Beta function, which equals the cumulative distribution function of the $\\mathrm{Beta}(\\alpha,\\beta)$ distribution evaluated at $x$.\n\n2. The enrichment probability $E = \\Pr(p_p  c \\, p_w \\mid a_p, n_p, a_w, n_w)$ for $c  1$. Given the independence of posteriors, this is\n$$\nE = \\int_{0}^{1} \\int_{c y}^{1} f_{p_p}(x) \\, f_{p_w}(y) \\, dx \\, dy,\n$$\nwhere $f_{p_p}(x) = \\frac{1}{B(\\alpha_p,\\beta_p)} x^{\\alpha_p - 1} (1-x)^{\\beta_p - 1}$ and $f_{p_w}(y) = \\frac{1}{B(\\alpha_w,\\beta_w)} y^{\\alpha_w - 1} (1-y)^{\\beta_w - 1}$. Because the inner integral is nonzero only when $c y \\le 1$, the integration region for $y$ truncates at $y_{\\max} = 1 / c$, yielding\n$$\nE = \\int_{0}^{1/c} \\left[ \\int_{c y}^{1} f_{p_p}(x) \\, dx \\right] f_{p_w}(y) \\, dy = \\int_{0}^{1/c} \\left[ 1 - I_{c y}(\\alpha_p, \\beta_p) \\right] \\, f_{p_w}(y) \\, dy.\n$$\nThis integral can be evaluated numerically to any desired precision. The inner bracket term is the complementary cumulative distribution function of the $\\mathrm{Beta}(\\alpha_p,\\beta_p)$ distribution evaluated at $c y$.\n\nThe decision rule is designed to filter two classes of non-tumor variants while retaining tumor-specific ones:\n\n- Germline variants: These appear in both WBC and plasma with similar alternate allele fractions (for a heterozygous site, typically near $0.5$; for homozygous alternate, near $1.0$). Under the model, $S_w$ will be near $1$ for reasonable depth, and $E$ will be small for $c  1$ since $p_p$ is not substantially larger than $p_w$.\n\n- Clonal Hematopoiesis of Indeterminate Potential (CHIP) variants: These are acquired variants arising from white blood cell lineages and can appear in plasma due to the normal cell-free deoxyribonucleic acid background but typically at an allele fraction not exceeding that in WBC. Under the model, $S_w$ will be large, and $E$ small.\n\n- Tumor-specific ctDNA variants: These are enriched in plasma relative to WBC or present in plasma when WBC appears absent. Under the model, either $S_w$ will be small or $E$ will be large, preventing filtering.\n\nWe choose hyperparameters and thresholds as follows: $\\alpha_0 = 0.5$, $\\beta_0 = 0.5$, $\\tau_w = 0.01$, $\\tau_p = 0.005$ (the latter provides a sanity threshold but is not directly used in the final rule), enrichment factor $c = 3.0$, WBC evidence threshold $\\theta_w = 0.95$, and enrichment significance threshold $\\theta_{\\mathrm{enrich}} = 0.10$.\n\nAlgorithmic steps for each test case $(n_p, a_p, n_w, a_w)$:\n\n1. Compute posterior parameters $\\alpha_p = 0.5 + a_p$, $\\beta_p = 0.5 + (n_p - a_p)$, and $\\alpha_w = 0.5 + a_w$, $\\beta_w = 0.5 + (n_w - a_w)$.\n\n2. Compute $S_w = 1 - I_{\\tau_w}(\\alpha_w, \\beta_w)$ using the regularized incomplete Beta function.\n\n3. Compute $E = \\int_{0}^{1/c} \\left[ 1 - I_{c y}(\\alpha_p, \\beta_p) \\right] \\, f_{p_w}(y) \\, dy$, where $f_{p_w}(y) = \\frac{1}{B(\\alpha_w,\\beta_w)} y^{\\alpha_w - 1} (1-y)^{\\beta_w - 1}$. Evaluate numerically using quadrature. This is a one-dimensional integral on the finite interval $[0, 1/c]$ of a smooth integrand composed of standard special functions.\n\n4. Decide to filter if and only if $S_w \\ge \\theta_w$ and $E \\le \\theta_{\\mathrm{enrich}}$. Output $1$ if filter, else $0$.\n\nJustification from the base:\n- The binomial model and the Jeffreys prior ensure that posteriors are proper and reflect uncertainty appropriately, avoiding overconfidence at low counts.\n- The statistic $S_w$ identifies loci with strong WBC support above a minimum variant allele fraction threshold $\\tau_w$, separating sequencing noise (which would generally fall below $\\tau_w$) from true WBC-derived signals (germline or CHIP).\n- The enrichment probability $E$ formalizes the notion of plasma enrichment relative to WBC expected under tumor-derived ctDNA, based on the relative magnitudes of the independent Beta posteriors. The factor $c  1$ penalizes minor deviations and focuses on meaningful enrichment.\n- The conjunction of $S_w \\ge \\theta_w$ and $E \\le \\theta_{\\mathrm{enrich}}$ captures the intended filtering behavior while retaining tumor-specific signals that are either absent in WBC or enriched in plasma.\n\nApplying these steps to the given test suite produces a deterministic list of integers corresponding to filter (non-tumor) and retain (possibly tumor-specific) decisions. The final program implements this computation exactly and prints the results as a single-line comma-separated list enclosed in square brackets, in the specified order of test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.special import betainc, beta as beta_fn\n\ndef beta_posterior_params(a, n, alpha0=0.5, beta0=0.5):\n    \"\"\"Return posterior alpha, beta for Beta prior with binomial likelihood.\"\"\"\n    return alpha0 + a, beta0 + (n - a)\n\ndef prob_vaf_gt_tau(alpha, beta, tau):\n    \"\"\"Compute P(X  tau) for X ~ Beta(alpha, beta) using regularized incomplete beta.\"\"\"\n    # betainc(alpha, beta, x) is the CDF at x\n    cdf = betainc(alpha, beta, tau)\n    p = 1.0 - cdf\n    # clip to [0,1] for numerical stability\n    if p  0.0:\n        p = 0.0\n    elif p  1.0:\n        p = 1.0\n    return p\n\ndef prob_x_gt_cy(alpha_x, beta_x, alpha_y, beta_y, c):\n    \"\"\"\n    Compute P(X  c Y) where X ~ Beta(alpha_x, beta_x), Y ~ Beta(alpha_y, beta_y), independent.\n    Using the 1D integral: ∫_0^{1/c} [1 - I_{c y}(alpha_x, beta_x)] f_Y(y) dy.\n    \"\"\"\n    if c = 0:\n        raise ValueError(\"c must be  0\")\n    y_max = 1.0 / c\n    norm_y = beta_fn(alpha_y, beta_y)\n\n    def integrand(y):\n        # For y in [0, 1/c], c*y = 1, so no need to clip argument\n        tail_x = 1.0 - betainc(alpha_x, beta_x, c * y)\n        pdf_y = (y ** (alpha_y - 1.0)) * ((1.0 - y) ** (beta_y - 1.0)) / norm_y\n        return tail_x * pdf_y\n\n    # Numerical integration over [0, 1/c]\n    res, _ = quad(integrand, 0.0, y_max, epsabs=1e-12, epsrel=1e-10, limit=200)\n    # Clip to [0,1] for numerical stability\n    if res  0.0:\n        res = 0.0\n    elif res  1.0:\n        res = 1.0\n    return res\n\ndef decide_filter(n_p, a_p, n_w, a_w,\n                  alpha0=0.5, beta0=0.5,\n                  tau_w=0.01, c=3.0,\n                  theta_w=0.95, theta_enrich=0.10):\n    \"\"\"\n    Return 1 if filter (non-tumor) else 0 (retain).\n    \"\"\"\n    # Posterior params\n    alpha_p, beta_p = beta_posterior_params(a_p, n_p, alpha0, beta0)\n    alpha_w, beta_w = beta_posterior_params(a_w, n_w, alpha0, beta0)\n\n    # WBC evidence above tau_w\n    S_w = prob_vaf_gt_tau(alpha_w, beta_w, tau_w)\n\n    # Plasma enrichment relative to WBC by factor c\n    E = prob_x_gt_cy(alpha_p, beta_p, alpha_w, beta_w, c)\n\n    # Decision\n    filter_flag = 1 if (S_w = theta_w and E = theta_enrich) else 0\n    return filter_flag\n\ndef solve():\n    # Fixed hyperparameters as specified\n    alpha0 = 0.5\n    beta0 = 0.5\n    tau_w = 0.01\n    c = 3.0\n    theta_w = 0.95\n    theta_enrich = 0.10\n\n    # Define the test cases from the problem statement.\n    # Each case: (n_p, a_p, n_w, a_w)\n    test_cases = [\n        (4000, 200, 4000, 2),    # Case 1: tumor-specific, clear\n        (500, 255, 500, 250),    # Case 2: germline heterozygous\n        (6000, 120, 2000, 200),  # Case 3: CHIP-like\n        (10000, 5, 10000, 8),    # Case 4: noise-only\n        (3000, 300, 3000, 60),   # Case 5: both present, plasma enriched - retain\n        (200, 198, 200, 199),    # Case 6: germline homozygous alt\n        (3000, 90, 3000, 18),    # Case 7: borderline WBC weak, plasma moderate - retain\n    ]\n\n    results = []\n    for (n_p, a_p, n_w, a_w) in test_cases:\n        result = decide_filter(\n            n_p, a_p, n_w, a_w,\n            alpha0=alpha0, beta0=beta0,\n            tau_w=tau_w, c=c,\n            theta_w=theta_w, theta_enrich=theta_enrich\n        )\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "4546235"}]}