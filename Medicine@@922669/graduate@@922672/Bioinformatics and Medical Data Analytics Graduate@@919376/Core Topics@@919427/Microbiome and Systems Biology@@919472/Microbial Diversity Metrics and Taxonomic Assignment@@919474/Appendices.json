{"hands_on_practices": [{"introduction": "This first practice provides a foundational exercise in quantifying microbial diversity using the family of Hill numbers. By deriving and calculating these \"true diversity\" metrics for hypothetical communities, you will learn how to translate raw abundance data into an intuitive \"effective number of species\". This exercise will also develop your understanding of how the metric's sensitivity can be tuned to emphasize either rare or common taxa, a key concept in ecological interpretation. [@problem_id:4584534]", "problem": "A clinical study of gut microbiomes uses amplicon sequencing to profile bacterial communities. After quality control, each read is denoised into an Amplicon Sequence Variant (ASV), and taxonomic labels at the genus level are assigned with the Ribosomal Database Project (RDP) naive Bayesian classifier at a confidence threshold of 0.8. Two stool samples, community $A$ and community $B$, are aggregated to genus-level relative abundance vectors across $7$ genera (each entry is the fraction of total reads assigned to that genus, and all entries are strictly positive and sum to $1$): for community $A$, the vector is $\\mathbf{p}^{(A)} = (0.30, 0.25, 0.15, 0.10, 0.08, 0.07, 0.05)$; for community $B$, the vector is $\\mathbf{p}^{(B)} = (0.40, 0.20, 0.15, 0.10, 0.06, 0.05, 0.04)$. Starting from foundational properties of diversity measures (including the replication principle and invariance to species labels) and the well-tested connection between the family of Rényi entropies and effective numbers of equally abundant taxa, derive the appropriate expressions for the Hill numbers ${}^qD$ at orders $q=0$, $q=1$, and $q=2$. Then compute ${}^0D$, ${}^1D$, and ${}^2D$ for each community using the provided vectors. Finally, based on first principles, explain how the order $q$ controls sensitivity to rare versus common taxa and use your computed values to illustrate this sensitivity for communities $A$ and $B$. Report the six numerical values in the order $\\left({}^{0}D_{A}, {}^{1}D_{A}, {}^{2}D_{A}, {}^{0}D_{B}, {}^{1}D_{B}, {}^{2}D_{B}\\right)$, rounding to four significant figures. The diversity quantities are unitless.", "solution": "The problem is scientifically grounded, well-posed, objective, and contains all necessary information to derive and compute the requested quantities. The data vectors are internally consistent, as the relative abundances in each sum to $1$. Therefore, the problem is valid and we may proceed with a solution.\n\nThe foundational concept behind modern diversity measures is the idea of an \"effective number of species,\" or \"true diversity,\" denoted $D$. True diversity measures convert raw abundance data into a more intuitive unit: the number of equally abundant species that would yield the same diversity value. A measure is considered a true diversity if it satisfies the replication principle: if a pooled community is formed by combining $N$ equally large, equally diverse communities that share no species, the diversity of the pooled community should be $N$ times the diversity of a single community. This property is satisfied by defining diversity as the exponential of a generalized entropy.\n\nThe family of Rényi entropies provides a suitable framework. The Rényi entropy of order $q$ for a community with $S$ species and relative abundances $p_i$ (where $i = 1, \\dots, S$ and $\\sum_{i=1}^{S} p_i = 1$) is defined as:\n$$ H_q = \\frac{1}{1-q} \\ln\\left(\\sum_{i=1}^{S} p_i^q\\right) \\quad \\text{for } q \\ge 0, q \\neq 1 $$\nA key property of entropy is that for a community of $M$ equally abundant species (i.e., $p_i = 1/M$ for all $i$), the entropy should equal $\\ln(M)$. Let's verify this for Rényi entropy:\n$$ H_q = \\frac{1}{1-q} \\ln\\left(\\sum_{i=1}^{M} \\left(\\frac{1}{M}\\right)^q\\right) = \\frac{1}{1-q} \\ln\\left(M \\cdot \\frac{1}{M^q}\\right) = \\frac{1}{1-q} \\ln\\left(M^{1-q}\\right) = \\frac{1-q}{1-q} \\ln(M) = \\ln(M) $$\nThis property allows us to define the true diversity of order $q$, also known as the Hill number ${}^qD$, as the number of species in an equally-abundant community that would have the same Rényi entropy value. That is, we set $H_q(\\text{community}) = \\ln({}^qD)$.\n$$ \\ln({}^qD) = \\frac{1}{1-q} \\ln\\left(\\sum_{i=1}^{S} p_i^q\\right) $$\nExponentiating both sides gives the general formula for Hill numbers for $q \\neq 1$:\n$$ {}^qD = \\exp\\left(H_q\\right) = \\left(\\sum_{i=1}^{S} p_i^q\\right)^{\\frac{1}{1-q}} $$\n\nWe now derive the specific expressions for $q=0$, $q=1$, and $q=2$. The number of genera is $S=7$ for both communities.\n\n**Case 1: $q=0$ (Species Richness)**\nFor $q=0$, we can substitute directly into the general formula:\n$$ {}^0D = \\left(\\sum_{i=1}^{S} p_i^0\\right)^{\\frac{1}{1-0}} = \\sum_{i=1}^{S} p_i^0 $$\nSince all provided abundances $p_i$ are strictly positive, $p_i^0 = 1$. The sum is therefore the count of all genera with non-zero abundance.\n$$ {}^0D = \\sum_{i=1}^{S} 1 = S $$\nThis is the species richness of the community.\n\n**Case 2: $q=2$ (Inverse Simpson Diversity)**\nFor $q=2$, substituting into the general formula gives:\n$$ {}^2D = \\left(\\sum_{i=1}^{S} p_i^2\\right)^{\\frac{1}{1-2}} = \\left(\\sum_{i=1}^{S} p_i^2\\right)^{-1} = \\frac{1}{\\sum_{i=1}^{S} p_i^2} $$\nThe term $\\sum_{i=1}^{S} p_i^2$ is the Simpson concentration index, often denoted $\\lambda$. Thus, ${}^2D$ is the inverse of the Simpson index.\n\n**Case 3: $q=1$ (Exponential of Shannon Entropy)**\nThe general formula is undefined at $q=1$. We must evaluate the limit as $q \\to 1$:\n$$ {}^1D = \\lim_{q\\to1} \\left(\\sum_{i=1}^{S} p_i^q\\right)^{\\frac{1}{1-q}} $$\nThis is an indeterminate form of type $1^\\infty$. It is easier to work with the logarithm, $\\ln({}^qD) = \\frac{\\ln(\\sum p_i^q)}{1-q}$. As $q \\to 1$, this is of the form $0/0$, so we can apply L'Hôpital's rule. Let $f(q) = \\ln(\\sum_i p_i^q)$ and $g(q) = 1-q$.\nThe derivatives are $g'(q) = -1$ and $f'(q) = \\frac{\\sum_i p_i^q \\ln(p_i)}{\\sum_i p_i^q}$.\n$$ \\lim_{q\\to1} \\ln({}^qD) = \\lim_{q\\to1} \\frac{f'(q)}{g'(q)} = \\frac{\\frac{\\sum_i p_i^1 \\ln(p_i)}{\\sum_i p_i^1}}{-1} = -\\sum_{i=1}^{S} p_i \\ln(p_i) $$\nThis result is the Shannon entropy, $H'$. Therefore, the limit of the Hill number is:\n$$ {}^1D = \\exp\\left(-\\sum_{i=1}^{S} p_i \\ln(p_i)\\right) = \\exp(H') $$\n\nNow we compute these values for communities A and B.\nLet $\\mathbf{p}^{(A)} = (0.30, 0.25, 0.15, 0.10, 0.08, 0.07, 0.05)$ and $\\mathbf{p}^{(B)} = (0.40, 0.20, 0.15, 0.10, 0.06, 0.05, 0.04)$. For both, $S=7$.\n\n**Calculations for Community A:**\n$${}^0D_A = S = 7$$\n$${}^2D_A = \\frac{1}{\\sum (p_i^{(A)})^2} = \\frac{1}{0.30^2 + 0.25^2 + 0.15^2 + 0.10^2 + 0.08^2 + 0.07^2 + 0.05^2}$$\n$${}^2D_A = \\frac{1}{0.09 + 0.0625 + 0.0225 + 0.01 + 0.0064 + 0.0049 + 0.0025} = \\frac{1}{0.1988} \\approx 5.03018$$\n$$H'_A = -\\sum p_i^{(A)} \\ln(p_i^{(A)}) = - (0.30\\ln(0.30) + 0.25\\ln(0.25) + \\dots + 0.05\\ln(0.05)) \\approx 1.76059$$\n$${}^1D_A = \\exp(H'_A) = \\exp(1.76059) \\approx 5.81593$$\n\n**Calculations for Community B:**\n$${}^0D_B = S = 7$$\n$${}^2D_B = \\frac{1}{\\sum (p_i^{(B)})^2} = \\frac{1}{0.40^2 + 0.20^2 + 0.15^2 + 0.10^2 + 0.06^2 + 0.05^2 + 0.04^2}$$\n$${}^2D_B = \\frac{1}{0.16 + 0.04 + 0.0225 + 0.01 + 0.0036 + 0.0025 + 0.0016} = \\frac{1}{0.2402} \\approx 4.16320$$\n$$H'_B = -\\sum p_i^{(B)} \\ln(p_i^{(B)}) = - (0.40\\ln(0.40) + 0.20\\ln(0.20) + \\dots + 0.04\\ln(0.04)) \\approx 1.65059$$\n$${}^1D_B = \\exp(H'_B) = \\exp(1.65059) \\approx 5.21004$$\n\nRounding to four significant figures, we have:\n$\\left({}^{0}D_{A}, {}^{1}D_{A}, {}^{2}D_{A}\\right) = (7.000, 5.816, 5.030)$\n$\\left({}^{0}D_{B}, {}^{1}D_{B}, {}^{2}D_{B}\\right) = (7.000, 5.210, 4.163)$\n\n**Explanation of the order $q$:**\nThe order $q$ tunes the sensitivity of the Hill number to the relative abundances of the species. The core of the formula is the sum of weighted abundances, $\\sum p_i^q = \\sum p_i \\cdot p_i^{q-1}$.\n- For $q > 1$, the term $p_i^{q-1}$ gives disproportionately high weight to species with high abundance ($p_i$). For example, at $q=2$, the abundances are weighted by themselves ($p_i$). This means ${}^qD$ for $q>1$ is most sensitive to the number and abundances of the most common species.\n- For $q  1$, the term $p_i^{q-1}$ has a negative exponent. This gives disproportionately high weight to species with low abundance ($p_i$). For example, at $q=0$, the weighting is by $p_i^{-1}$, which is very large for rare species. In the limit, ${}^0D$ disregards abundances entirely and simply counts all present species, thus giving maximal importance to the rarest species just by their presence.\n- For $q=1$, the weighting is uniform (effectively $p_i^0=1$), meaning each individual is weighted equally. This is interpreted as weighting each species precisely by its proportional abundance in the community, without favoring either rare or common species.\n\n**Illustration with Computed Values:**\nThe computed values demonstrate this principle.\n- For $q=0$, ${}^0D_{A} = {}^0D_{B} = 7.000$. This metric is insensitive to abundance and only reflects that both communities have the same number of genera.\n- For $q=1$ and $q=2$, we see that ${}^1D_{A} > {}^1D_{B}$ ($5.816 > 5.210$) and ${}^2D_{A} > {}^2D_{B}$ ($5.030 > 4.163$). Community B has a more dominant top genus ($40\\%$ abundance vs. $30\\%$ for A), making it less even. Metrics with $q \\ge 1$ penalize this unevenness, correctly identifying community A as more diverse in terms of evenness.\n- The sensitivity to dominance increases with $q$. The percentage difference in diversity between A and B is larger for $q=2$ than for $q=1$. For $q=1$, A is $(5.816 - 5.210)/5.210 \\approx 11.6\\%$ more diverse than B. For $q=2$, A is $(5.030 - 4.163)/4.163 \\approx 20.8\\%$ more diverse. The higher value of $q$ more strongly penalizes the high dominance in community B, resulting in a lower diversity value and a larger gap between the two communities. This confirms that increasing $q$ amplifies the influence of the most abundant species on the diversity calculation. The full profile of ${}^qD$ values across a range of $q$ provides a more complete picture of a community's diversity structure than a single index.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n7.000  5.816  5.030  7.000  5.210  4.163\n\\end{pmatrix}\n}\n$$", "id": "4584534"}, {"introduction": "While a unified framework like Hill numbers provides robust diversity measures, many other indices are used in the literature, not all of which are well-behaved. This exercise presents a critical thinking challenge involving a seemingly plausible but flawed evenness index. By demonstrating how this surrogate violates a fundamental principle of measurement—the Pigou-Dalton principle of transfers—you will appreciate why a rigorous, axiomatic approach is essential for selecting and interpreting ecological metrics. [@problem_id:4584535]", "problem": "A common pipeline in microbial community profiling uses 16S ribosomal RNA (rRNA) amplicon sequencing followed by a naive Bayesian taxonomic assignment. Consider a single stool sample in which three Amplicon Sequence Variants (ASVs) are confidently assigned at the genus level. Let the initial assigned read counts be $\\mathbf{n}^{(0)} = (n_{1}^{(0)}, n_{2}^{(0)}, n_{3}^{(0)}) = (2, 1, 1)$, with total $N^{(0)} = \\sum_{i=1}^{3} n_{i}^{(0)} = 4$. A subsequent classifier update reassigns one previously unassigned read to the rarest taxon, yielding new assigned counts $\\mathbf{n}^{(1)} = (2, 2, 1)$ and $N^{(1)} = 5$; all previously assigned reads remain unchanged. For each state $t \\in \\{0,1\\}$, let the relative abundances be $p_{i}^{(t)} = n_{i}^{(t)} / N^{(t)}$ and the Shannon entropy (in nats) be $H^{(t)} = - \\sum_{i=1}^{3} p_{i}^{(t)} \\ln p_{i}^{(t)}$.\n\nSome applied literature uses the following sample-size–normalized evenness surrogate:\n$$\nE_{N}^{(t)} \\equiv \\frac{H^{(t)}}{\\ln\\!\\big(N^{(t)}\\big)}.\n$$\n\nStarting only from the definitions of $p_{i}^{(t)}$, $H^{(t)}$, and $E_{N}^{(t)}$ above, compute the change in this evenness surrogate,\n$$\n\\Delta E_{N} \\equiv E_{N}^{(1)} - E_{N}^{(0)},\n$$\nfor the update $\\mathbf{n}^{(0)} \\to \\mathbf{n}^{(1)}$ described. Then, in one to two sentences, explain which natural evenness axiom this behavior violates and why. Round the numerical value of $\\Delta E_{N}$ to four significant figures. The final answer must be a single real number (no units).", "solution": "The problem requires the computation of the change in a sample-size–normalized evenness surrogate, $\\Delta E_{N}$, resulting from an update to microbial read counts, and an explanation of which evenness axiom this behavior violates.\n\nFirst, we must validate the problem statement.\n### Step 1: Extract Givens\n- Initial read counts: $\\mathbf{n}^{(0)} = (n_{1}^{(0)}, n_{2}^{(0)}, n_{3}^{(0)}) = (2, 1, 1)$\n- Initial total reads: $N^{(0)} = \\sum_{i=1}^{3} n_{i}^{(0)} = 4$\n- Updated read counts: $\\mathbf{n}^{(1)} = (2, 2, 1)$\n- Updated total reads: $N^{(1)} = 5$\n- Relative abundance definition: $p_{i}^{(t)} = n_{i}^{(t)} / N^{(t)}$ for state $t \\in \\{0,1\\}$\n- Shannon entropy definition: $H^{(t)} = - \\sum_{i=1}^{3} p_{i}^{(t)} \\ln p_{i}^{(t)}$ (in nats)\n- Evenness surrogate definition: $E_{N}^{(t)} \\equiv \\frac{H^{(t)}}{\\ln(N^{(t)})}$\n- Quantity to compute: $\\Delta E_{N} \\equiv E_{N}^{(1)} - E_{N}^{(0)}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the fields of bioinformatics and quantitative ecology, using standard definitions for relative abundance and Shannon entropy. The evenness surrogate $E_{N}^{(t)}$ is explicitly defined, preventing ambiguity. The setup is self-contained and mathematically consistent. The task is a direct calculation followed by a conceptual explanation based on established principles of diversity measurement. The problem is well-posed and objective.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\nWe begin by calculating the necessary quantities for the initial state, $t=0$.\nThe initial counts are $\\mathbf{n}^{(0)} = (2, 1, 1)$, with a total count of $N^{(0)} = 4$.\nThe corresponding relative abundances are:\n$$\n\\mathbf{p}^{(0)} = \\left(p_{1}^{(0)}, p_{2}^{(0)}, p_{3}^{(0)}\\right) = \\left(\\frac{2}{4}, \\frac{1}{4}, \\frac{1}{4}\\right) = \\left(\\frac{1}{2}, \\frac{1}{4}, \\frac{1}{4}\\right)\n$$\nThe Shannon entropy $H^{(0)}$ is:\n$$\nH^{(0)} = - \\sum_{i=1}^{3} p_{i}^{(0)} \\ln p_{i}^{(0)} = - \\left( \\frac{1}{2}\\ln\\left(\\frac{1}{2}\\right) + \\frac{1}{4}\\ln\\left(\\frac{1}{4}\\right) + \\frac{1}{4}\\ln\\left(\\frac{1}{4}\\right) \\right)\n$$\nUsing the property $\\ln(1/x) = -\\ln(x)$:\n$$\nH^{(0)} = - \\left( -\\frac{1}{2}\\ln(2) - \\frac{1}{4}\\ln(4) - \\frac{1}{4}\\ln(4) \\right) = \\frac{1}{2}\\ln(2) + \\frac{1}{2}\\ln(4)\n$$\nSince $\\ln(4) = \\ln(2^2) = 2\\ln(2)$:\n$$\nH^{(0)} = \\frac{1}{2}\\ln(2) + \\frac{1}{2}(2\\ln(2)) = \\frac{1}{2}\\ln(2) + \\ln(2) = \\frac{3}{2}\\ln(2)\n$$\nNow, we compute the evenness surrogate $E_{N}^{(0)}$:\n$$\nE_{N}^{(0)} = \\frac{H^{(0)}}{\\ln(N^{(0)})} = \\frac{\\frac{3}{2}\\ln(2)}{\\ln(4)} = \\frac{\\frac{3}{2}\\ln(2)}{2\\ln(2)} = \\frac{3/2}{2} = \\frac{3}{4}\n$$\n\nNext, we calculate the same quantities for the updated state, $t=1$.\nThe updated counts are $\\mathbf{n}^{(1)} = (2, 2, 1)$, with a total count of $N^{(1)} = 5$.\nThe corresponding relative abundances are:\n$$\n\\mathbf{p}^{(1)} = \\left(p_{1}^{(1)}, p_{2}^{(1)}, p_{3}^{(1)}\\right) = \\left(\\frac{2}{5}, \\frac{2}{5}, \\frac{1}{5}\\right)\n$$\nThe Shannon entropy $H^{(1)}$ is:\n$$\nH^{(1)} = - \\sum_{i=1}^{3} p_{i}^{(1)} \\ln p_{i}^{(1)} = - \\left( \\frac{2}{5}\\ln\\left(\\frac{2}{5}\\right) + \\frac{2}{5}\\ln\\left(\\frac{2}{5}\\right) + \\frac{1}{5}\\ln\\left(\\frac{1}{5}\\right) \\right)\n$$\n$$\nH^{(1)} = - \\left( \\frac{4}{5}\\ln\\left(\\frac{2}{5}\\right) + \\frac{1}{5}\\ln\\left(\\frac{1}{5}\\right) \\right)\n$$\nUsing the properties $\\ln(a/b) = \\ln(a) - \\ln(b)$ and $\\ln(1/b) = -\\ln(b)$:\n$$\nH^{(1)} = - \\left( \\frac{4}{5}(\\ln(2) - \\ln(5)) - \\frac{1}{5}\\ln(5) \\right) = -\\frac{4}{5}\\ln(2) + \\frac{4}{5}\\ln(5) + \\frac{1}{5}\\ln(5) = \\ln(5) - \\frac{4}{5}\\ln(2)\n$$\nNow, we compute the evenness surrogate $E_{N}^{(1)}$:\n$$\nE_{N}^{(1)} = \\frac{H^{(1)}}{\\ln(N^{(1)})} = \\frac{\\ln(5) - \\frac{4}{5}\\ln(2)}{\\ln(5)} = 1 - \\frac{4}{5}\\frac{\\ln(2)}{\\ln(5)}\n$$\n\nFinally, we compute the change $\\Delta E_{N} = E_{N}^{(1)} - E_{N}^{(0)}$:\n$$\n\\Delta E_{N} = \\left(1 - \\frac{4}{5}\\frac{\\ln(2)}{\\ln(5)}\\right) - \\frac{3}{4} = \\frac{1}{4} - \\frac{4}{5}\\frac{\\ln(2)}{\\ln(5)}\n$$\nTo obtain a numerical value, we use $\\ln(2) \\approx 0.693147$ and $\\ln(5) \\approx 1.609438$.\n$$\n\\Delta E_{N} \\approx 0.25 - \\frac{4}{5} \\times \\frac{0.693147}{1.609438} \\approx 0.25 - 0.8 \\times 0.430677 \\approx 0.25 - 0.3445416 = -0.0945416\n$$\nRounding to four significant figures, we get $\\Delta E_{N} \\approx -0.09454$.\n\nThe second part of the question asks to explain which natural evenness axiom this behavior violates. The update from $\\mathbf{n}^{(0)}=(2, 1, 1)$ to $\\mathbf{n}^{(1)}=(2, 2, 1)$ involves adding an individual to one of the rarest taxa. This operation makes the distribution of relative abundances, $\\mathbf{p}^{(t)}$, more uniform, with $\\mathbf{p}^{(0)}=(0.5, 0.25, 0.25)$ becoming $\\mathbf{p}^{(1)}=(0.4, 0.4, 0.2)$. Any valid measure of evenness must increase or remain unchanged for such an update. Our calculation shows that $\\Delta E_N  0$, meaning the surrogate paradoxically decreased.\n\nThis behavior violates the Pigou-Dalton principle of transfers, a fundamental axiom stating that an evenness metric must increase when abundance is transferred from a more abundant taxon to a less abundant one. Although this is an addition and not a simple transfer, the resulting distribution of proportions is more even, yet the surrogate $E_N$ decreases because its normalization by $\\ln(N)$ makes the index inappropriately sensitive to the total sample size $N$.", "answer": "$$\n\\boxed{-0.09454}\n$$", "id": "4584535"}, {"introduction": "Moving from analyzing single communities to comparing them introduces a major statistical challenge: the compositional nature of sequencing data. This practice uses a carefully constructed thought experiment to reveal how naive comparisons of read counts can lead to false discoveries of differentially abundant taxa. You will then apply a principled compositional data analysis (CoDA) technique to correctly identify true changes, highlighting a critical skill for robust microbiome analysis. [@problem_id:4584543]", "problem": "A clinical microbiome study compares two groups of stool samples: a control group and a case group. Sequencing libraries are prepared with a constant amount of a synthetic spike-in taxon to enable absolute referencing. Let the true absolute abundances per sample for three biological taxa, $A$, $B$, $C$, and a spike-in taxon $S$, be given. The observed read counts arise from sampling proportional to the true absolute abundances with a sample-specific scaling factor that reflects library size and efficiency. Specifically, suppose the following absolute abundances (cells) and observed read counts are obtained for two control samples and two case samples.\n\nControl sample $1$: absolute abundances $A=1000$, $B=1000$, $C=1000$, $S=500$. Sequencing depth factor yields observed counts $A=4000$, $B=4000$, $C=4000$, $S=2000$.\n\nControl sample $2$: absolute abundances $A=2000$, $B=2000$, $C=2000$, $S=500$. Sequencing depth factor yields observed counts $A=4000$, $B=4000$, $C=4000$, $S=1000$.\n\nCase sample $3$: absolute abundances $A=10000$, $B=1000$, $C=1000$, $S=500$. Sequencing depth factor yields observed counts $A=10000$, $B=1000$, $C=1000$, $S=500$.\n\nCase sample $4$: absolute abundances $A=20000$, $B=2000$, $C=2000$, $S=500$. Sequencing depth factor yields observed counts $A=40000$, $B=4000$, $C=4000$, $S=1000$.\n\nAssume that the observed counts are exactly proportional to the absolute abundances within each sample, due to the sequencing depth factor, which can differ between samples.\n\nUsing only fundamental principles of compositional data and without invoking any ad hoc normalization formula, analyze the following.\n\n1. Explain, by explicit calculation, how a naive test based on comparing group-mean raw counts across conditions would misidentify taxon $B$ as differentially abundant, even though its absolute abundance is unchanged between control and case samples.\n\n2. Use Compositional Data Analysis (CoDA) with an Additive Log-Ratio (ALR) transform that uses the spike-in taxon $S$ as the reference part. Justify from first principles why ALR log-ratios remove sample-specific scaling and compositional effects under the stated assumptions, and compute the difference in group means of the ALR for taxon $A$ between the case and control groups.\n\nGive your final answer as a single closed-form analytic expression for the ALR-based case-minus-control difference in group means for taxon $A$ using the natural logarithm. Do not round. No units are required.", "solution": "The problem statement has been evaluated and is deemed valid. It is scientifically grounded in the principles of microbiome analysis, well-posed with sufficient and consistent data, and objectively formulated. The data provided are internally consistent with the model of proportionality between absolute abundances and observed counts via a sample-specific scaling factor.\n\nLet the true absolute abundance of a taxon $i$ in a sample be denoted by $N_i$, and the corresponding observed read count be $C_i$. The problem states that for any given sample, there exists a sample-specific sequencing depth factor, $k$, such that $C_i = k \\cdot N_i$ for all taxa $i$ in that sample. The spike-in taxon, $S$, is stated to have a constant true absolute abundance across all samples, which is given as $N_S = 500$.\n\nThe provided data is as follows:\nControl sample $1$ (s1): Abundances $(N_A, N_B, N_C, N_S) = (1000, 1000, 1000, 500)$. Observed counts $(C_A, C_B, C_C, C_S) = (4000, 4000, 4000, 2000)$. The scaling factor is $k_1 = 4000/1000 = 4$.\nControl sample $2$ (s2): Abundances $(N_A, N_B, N_C, N_S) = (2000, 2000, 2000, 500)$. Observed counts $(C_A, C_B, C_C, C_S) = (4000, 4000, 4000, 1000)$.The scaling factor is $k_2 = 4000/2000 = 2$.\nCase sample $3$ (s3): Abundances $(N_A, N_B, N_C, N_S) = (10000, 1000, 1000, 500)$. Observed counts $(C_A, C_B, C_C, C_S) = (10000, 1000, 1000, 500)$. The scaling factor is $k_3 = 10000/10000 = 1$.\nCase sample $4$ (s4): Abundances $(N_A, N_B, N_C, N_S) = (20000, 2000, 2000, 500)$. Observed counts $(C_A, C_B, C_C, C_S) = (40000, 4000, 4000, 1000)$. The scaling factor is $k_4 = 40000/20000 = 2$.\n\nThe control group consists of samples $s1$ and $s2$. The case group consists of samples $s3$ and $s4$.\n\n**1. Analysis of the Naive Test on Raw Counts for Taxon B**\n\nFirst, it is essential to verify the problem's premise that the absolute abundance of taxon $B$ is unchanged between the groups.\nFor the control group, the absolute abundances of taxon $B$ are $N_{B,s1} = 1000$ and $N_{B,s2} = 2000$. The mean absolute abundance is $\\bar{N}_{B, \\text{control}} = \\frac{1000 + 2000}{2} = 1500$.\nFor the case group, the absolute abundances of taxon $B$ are $N_{B,s3} = 1000$ and $N_{B,s4} = 2000$. The mean absolute abundance is $\\bar{N}_{B, \\text{case}} = \\frac{1000 + 2000}{2} = 1500$.\nThe mean absolute abundances are identical. In fact, the distribution of absolute abundances for taxon $B$ is $\\{1000, 2000\\}$ in both groups. Therefore, there is no true differential abundance for taxon $B$ between the case and control groups.\n\nA naive test would directly compare the group means of the observed raw read counts.\nThe observed counts for taxon $B$ in the control group are $C_{B,s1} = 4000$ and $C_{B,s2} = 4000$.\nThe mean raw count for taxon $B$ in the control group is:\n$$\n\\bar{C}_{B, \\text{control}} = \\frac{C_{B,s1} + C_{B,s2}}{2} = \\frac{4000 + 4000}{2} = 4000\n$$\nThe observed counts for taxon $B$ in the case group are $C_{B,s3} = 1000$ and $C_{B,s4} = 4000$.\nThe mean raw count for taxon $B$ in the case group is:\n$$\n\\bar{C}_{B, \\text{case}} = \\frac{C_{B,s3} + C_{B,s4}}{2} = \\frac{1000 + 4000}{2} = 2500\n$$\nComparing the group means, $\\bar{C}_{B, \\text{case}} = 2500$ is substantially lower than $\\bar{C}_{B, \\text{control}} = 4000$. This apparent decrease would lead a naive statistical analysis to incorrectly conclude that taxon $B$ is less abundant in the case group.\n\nThis misidentification arises because raw counts are not directly comparable across samples. The counts are a product of the true abundance and a sample-specific scaling factor ($C_i = k \\cdot N_i$). The scaling factor $k$ encapsulates variations in sequencing depth, library preparation efficiency, and total biological material, and it differs from sample to sample ($k_1=4$, $k_2=2$, $k_3=1$, $k_4=2$). For instance, sample $s1$ (control) and sample $s3$ (case) have the same absolute abundance of taxon $B$ ($N_B=1000$), but their observed counts are drastically different ($C_{B,s1}=4000$ vs. $C_{B,s3}=1000$) solely because their scaling factors differ ($k_1=4$ vs. $k_3=1$). This discrepancy is an instance of a compositional effect: the massive increase in the absolute abundance of taxon $A$ in the case samples alters the proportional representation of all taxa, which, combined with varying sequencing depths, generates misleading signals in the raw count data.\n\n**2. Compositional Data Analysis (CoDA) using the Additive Log-Ratio (ALR) Transform**\n\nThe Additive Log-Ratio (ALR) transform is a method to analyze compositional data that is robust to the issues described above. It operates by taking logarithms of ratios of the components of a composition.\n\n**Justification from First Principles:**\nLet the vector of observed counts for a sample be $\\mathbf{C} = [C_1, C_2, \\dots, C_D]$, where $D$ is the number of taxa. This is a composition, as the information it carries is relative. The ALR transform, using taxon $S$ as the reference, is defined for any other taxon $i$ as:\n$$\n\\text{alr}(i) = \\ln\\left(\\frac{C_i}{C_S}\\right)\n$$\nWe can substitute the model for observed counts, $C_i = k \\cdot N_i$ and $C_S = k \\cdot N_S$, into this definition:\n$$\n\\text{alr}(i) = \\ln\\left(\\frac{k \\cdot N_i}{k \\cdot N_S}\\right)\n$$\nThe sample-specific scaling factor $k$, being a common multiplier for all taxa within a single sample, cancels out in the ratio:\n$$\n\\text{alr}(i) = \\ln\\left(\\frac{N_i}{N_S}\\right)\n$$\nThis resulting value is the logarithm of the ratio of the true absolute abundances of taxon $i$ and the spike-in taxon $S$. The problem states that the spike-in $S$ was added in a constant amount, and the provided data shows its true absolute abundance $N_S$ is constant at $500$ across all samples. Therefore, the ALR value can be written as:\n$$\n\\text{alr}(i) = \\ln(N_i) - \\ln(N_S)\n$$\nSince $\\ln(N_S)$ is a constant across all samples, any variation in $\\text{alr}(i)$ between samples or groups directly reflects variation in $\\ln(N_i)$, the logarithm of the true absolute abundance of taxon $i$. The ALR transform, by using the ratio to a constant spike-in, effectively removes the sample-specific scaling artifact $k$ and converts the relative count data into a representation that is proportional to the logarithm of the true absolute abundances. This makes it a valid basis for comparing abundances across samples and groups.\n\n**Calculation for Taxon A:**\nWe are asked to compute the difference in the group means of the ALR for taxon $A$ between the case and control groups, $\\Delta_{\\text{ALR}}(A) = \\overline{\\text{alr}(A)}_{\\text{case}} - \\overline{\\text{alr}(A)}_{\\text{control}}$.\n\nFirst, we compute the ALR values for taxon $A$ in each control sample:\nFor sample $s1$: $C_{A,s1} = 4000$, $C_{S,s1} = 2000$.\n$$\n\\text{alr}_{s1}(A) = \\ln\\left(\\frac{4000}{2000}\\right) = \\ln(2)\n$$\nFor sample $s2$: $C_{A,s2} = 4000$, $C_{S,s2} = 1000$.\n$$\n\\text{alr}_{s2}(A) = \\ln\\left(\\frac{4000}{1000}\\right) = \\ln(4)\n$$\nThe mean ALR for the control group is:\n$$\n\\overline{\\text{alr}(A)}_{\\text{control}} = \\frac{\\ln(2) + \\ln(4)}{2} = \\frac{\\ln(2) + \\ln(2^2)}{2} = \\frac{\\ln(2) + 2\\ln(2)}{2} = \\frac{3\\ln(2)}{2}\n$$\nNext, we compute the ALR values for taxon $A$ in each case sample:\nFor sample $s3$: $C_{A,s3} = 10000$, $C_{S,s3} = 500$.\n$$\n\\text{alr}_{s3}(A) = \\ln\\left(\\frac{10000}{500}\\right) = \\ln(20)\n$$\nFor sample $s4$: $C_{A,s4} = 40000$, $C_{S,s4} = 1000$.\n$$\n\\text{alr}_{s4}(A) = \\ln\\left(\\frac{40000}{1000}\\right) = \\ln(40)\n$$\nThe mean ALR for the case group is:\n$$\n\\overline{\\text{alr}(A)}_{\\text{case}} = \\frac{\\ln(20) + \\ln(40)}{2}\n$$\nNow, we compute the difference:\n$$\n\\Delta_{\\text{ALR}}(A) = \\overline{\\text{alr}(A)}_{\\text{case}} - \\overline{\\text{alr}(A)}_{\\text{control}} = \\frac{\\ln(20) + \\ln(40)}{2} - \\frac{3\\ln(2)}{2}\n$$\nUsing the property $\\ln(x) + \\ln(y) = \\ln(xy)$:\n$$\n\\Delta_{\\text{ALR}}(A) = \\frac{\\ln(20 \\times 40)}{2} - \\frac{\\ln(2^3)}{2} = \\frac{\\ln(800) - \\ln(8)}{2}\n$$\nUsing the property $\\ln(x) - \\ln(y) = \\ln(x/y)$:\n$$\n\\Delta_{\\text{ALR}}(A) = \\frac{1}{2}\\ln\\left(\\frac{800}{8}\\right) = \\frac{1}{2}\\ln(100)\n$$\nUsing the property $\\ln(x^y) = y\\ln(x)$:\n$$\n\\Delta_{\\text{ALR}}(A) = \\frac{1}{2}\\ln(10^2) = \\frac{1}{2}(2\\ln(10)) = \\ln(10)\n$$\nThis result represents the mean difference in the log-ratio of absolute abundances of $A$ relative to $S$. Because $N_S$ is constant, this value reflects the average log-fold change in the absolute abundance of taxon $A$ between the case and control groups.", "answer": "$$\\boxed{\\ln(10)}$$", "id": "4584543"}]}