{"hands_on_practices": [{"introduction": "The foundation of any Flux Balance Analysis is the stoichiometric matrix, $S$, which mathematically represents the metabolic network's structure. This first exercise provides essential practice in constructing this matrix from basic chemical principles and exploring the properties of the steady-state solution space [@problem_id:4565034]. Mastering this step is crucial for building and interpreting any constraint-based model.", "problem": "Consider a minimal internal metabolic network used for Flux Balance Analysis (FBA), consisting of exactly three internal metabolites $A$, $B$, and $C$, and four reactions $R_{1}$ through $R_{4}$. The fundamental base you must use is the steady-state mass balance principle (conservation of matter), which, in FBA, equates to the statement that for each metabolite, the net production rate equals zero when the system is at steady state. In this toy network, matter conservation is modeled as conservation of a tracked moiety count. Specifically, let $A$, $B$, and $C$ represent moieties carrying, respectively, $1$, $2$, and $3$ units of a conserved atomic moiety, and assume that only this moiety is tracked. The four reactions are defined as chemically balanced transformations with respect to this conserved moiety:\n- $R_{1}$: $A + A \\rightarrow B$,\n- $R_{2}$: $A + B \\rightarrow C$,\n- $R_{3}$: $C \\rightarrow A + B$,\n- $R_{4}$: $\\varnothing \\rightarrow A$ (an import exchange bringing $A$ from the environment into the system; $\\varnothing$ denotes the environment and is not an internal metabolite).\n\nUnder the standard stoichiometric sign convention, substrates are assigned negative stoichiometric coefficients and products are assigned positive coefficients. Let the stoichiometric matrix $S$ be the $3 \\times 4$ matrix whose rows are ordered $(A,B,C)$ and whose columns are ordered $(R_{1},R_{2},R_{3},R_{4})$, with entries $S_{i j}$ equal to the stoichiometric coefficient of metabolite $i$ in reaction $j$.\n\nTask:\n1. From first-principles mass balance by writing and balancing the above chemical equations, derive all stoichiometric coefficients and assemble the stoichiometric matrix $S$.\n2. Using the steady-state mass balance equations $S v = 0$ for flux vector $v \\in \\mathbb{R}^{4}$, determine the dimension of the feasible steady-state flux space, defined as the nullspace of $S$ ignoring any bounds or irreversibility constraints.\n\nReport the dimension as a single integer with no units. No rounding is required.", "solution": "The problem is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n- **Metabolites**: $A$, $B$, $C$.\n- **Reactions**: $R_{1}$, $R_{2}$, $R_{3}$, $R_{4}$.\n- **Conserved Moiety Counts**: $A$ carries $1$ unit, $B$ carries $2$ units, $C$ carries $3$ units.\n- **Reaction Definitions**:\n  - $R_{1}$: $A + A \\rightarrow B$\n  - $R_{2}$: $A + B \\rightarrow C$\n  - $R_{3}$: $C \\rightarrow A + B$\n  - $R_{4}$: $\\varnothing \\rightarrow A$ (import exchange)\n- **Stoichiometric Matrix Definition**: $S$ is a $3 \\times 4$ matrix. Rows are ordered $(A, B, C)$. Columns are ordered $(R_{1}, R_{2}, R_{3}, R_{4})$. Entry $S_{i j}$ is the stoichiometric coefficient of metabolite $i$ in reaction $j$. Substrates have negative coefficients, products have positive coefficients.\n- **Governing Principle**: Steady-state mass balance, $S v = 0$, where $v$ is the flux vector.\n- **Task**: \n  1. Assemble the stoichiometric matrix $S$.\n  2. Determine the dimension of the feasible steady-state flux space, which is the dimension of the nullspace of $S$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is a standard, albeit simplified, application of Flux Balance Analysis (FBA), a core method in systems biology and bioinformatics. It correctly uses the concepts of stoichiometric matrices, steady-state mass balance ($S v = 0$), and nullspace analysis. The provided reactions are also confirmed to be balanced with respect to the defined conserved moiety counts, which ensures internal consistency.\n- **Well-Posed**: The problem asks for the derivation of a matrix and the calculation of the dimension of its nullspace. This is a well-defined mathematical task with a unique integer solution.\n- **Objective**: The problem is stated in precise, technical language with no subjective or ambiguous terms.\n- **Complete and Consistent**: All information required to construct the matrix $S$ and perform the linear algebra is provided. There are no contradictions.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution Derivation\n\nThe first step is to construct the $3 \\times 4$ stoichiometric matrix $S$ based on the four given reactions. The rows correspond to the metabolites $(A, B, C)$ and the columns to the reactions $(R_{1}, R_{2}, R_{3}, R_{4})$. The standard convention is that substrates of a reaction have negative stoichiometric coefficients, while products have positive coefficients.\n\n1.  **Reaction $R_{1}$: $A + A \\rightarrow B$ or $2A \\rightarrow B$**\n    - Metabolite $A$ is a substrate with a stoichiometry of $2$. Coefficient $S_{11} = -2$.\n    - Metabolite $B$ is a product with a stoichiometry of $1$. Coefficient $S_{21} = +1$.\n    - Metabolite $C$ is not involved. Coefficient $S_{31} = 0$.\n    The first column of $S$ is $\\begin{pmatrix} -2 \\\\ 1 \\\\ 0 \\end{pmatrix}$.\n\n2.  **Reaction $R_{2}$: $A + B \\rightarrow C$**\n    - Metabolite $A$ is a substrate with a stoichiometry of $1$. Coefficient $S_{12} = -1$.\n    - Metabolite $B$ is a substrate with a stoichiometry of $1$. Coefficient $S_{22} = -1$.\n    - Metabolite $C$ is a product with a stoichiometry of $1$. Coefficient $S_{32} = +1$.\n    The second column of $S$ is $\\begin{pmatrix} -1 \\\\ -1 \\\\ 1 \\end{pmatrix}$.\n\n3.  **Reaction $R_{3}$: $C \\rightarrow A + B$**\n    - Metabolite $A$ is a product with a stoichiometry of $1$. Coefficient $S_{13} = +1$.\n    - Metabolite $B$ is a product with a stoichiometry of $1$. Coefficient $S_{23} = +1$.\n    - Metabolite $C$ is a substrate with a stoichiometry of $1$. Coefficient $S_{33} = -1$.\n    The third column of $S$ is $\\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\end{pmatrix}$. Note that this reaction is the reverse of $R_{2}$, so its stoichiometric vector is the negative of the vector for $R_{2}$.\n\n4.  **Reaction $R_{4}$: $\\varnothing \\rightarrow A$**\n    - This is an import flux, so metabolite $A$ is produced from the perspective of the internal system.\n    - Metabolite $A$ is a product with a stoichiometry of $1$. Coefficient $S_{14} = +1$.\n    - Metabolites $B$ and $C$ are not involved. Coefficients $S_{24} = 0$ and $S_{34} = 0$.\n    The fourth column of $S$ is $\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$.\n\nCombining these columns yields the complete stoichiometric matrix $S$:\n$$ S = \\begin{pmatrix} -2  -1  1  1 \\\\ 1  -1  1  0 \\\\ 0  1  -1  0 \\end{pmatrix} $$\n\nThe second part of the task is to determine the dimension of the feasible steady-state flux space. At steady state, the net production of each internal metabolite is zero. This is expressed by the linear system $S v = 0$, where $v = (v_1, v_2, v_3, v_4)^T$ is the vector of fluxes through the reactions $R_1$ to $R_4$. The set of all vectors $v$ that satisfy this equation constitutes the nullspace of the matrix $S$, denoted $\\text{Null}(S)$. The dimension of this space, $\\dim(\\text{Null}(S))$, is the number of independent basis vectors that span the space.\n\nAccording to the Rank-Nullity Theorem, for a matrix $S$ with $n$ columns:\n$$ \\text{rank}(S) + \\dim(\\text{Null}(S)) = n $$\nIn our case, $S$ is a $3 \\times 4$ matrix, so $n=4$. Therefore:\n$$ \\dim(\\text{Null}(S)) = 4 - \\text{rank}(S) $$\nWe must find the rank of $S$, which is the number of linearly independent rows (or columns). This can be determined by applying Gaussian elimination to reduce $S$ to its row echelon form.\n\nStarting with $S$:\n$$ S = \\begin{pmatrix} -2  -1  1  1 \\\\ 1  -1  1  0 \\\\ 0  1  -1  0 \\end{pmatrix} $$\nSwap Row 1 and Row 2 ($R_1 \\leftrightarrow R_2$):\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ -2  -1  1  1 \\\\ 0  1  -1  0 \\end{pmatrix} $$\nAdd $2$ times Row 1 to Row 2 ($R_2 \\rightarrow R_2 + 2R_1$):\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ 0  -3  3  1 \\\\ 0  1  -1  0 \\end{pmatrix} $$\nSwap Row 2 and Row 3 ($R_2 \\leftrightarrow R_3$):\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ 0  1  -1  0 \\\\ 0  -3  3  1 \\end{pmatrix} $$\nAdd $3$ times Row 2 to Row 3 ($R_3 \\rightarrow R_3 + 3R_2$):\n$$ \\begin{pmatrix} 1  -1  1  0 \\\\ 0  1  -1  0 \\\\ 0  0  0  1 \\end{pmatrix} $$\nThis matrix is in row echelon form. It has three non-zero rows, each containing a pivot (leading non-zero entry). The number of pivots is equal to the rank of the matrix.\nTherefore, $\\text{rank}(S) = 3$.\n\nNow, we can calculate the dimension of the nullspace:\n$$ \\dim(\\text{Null}(S)) = 4 - \\text{rank}(S) = 4 - 3 = 1 $$\nThe dimension of the feasible steady-state flux space is $1$. This implies that all possible steady-state flux distributions for this network can be described by a single free parameter. For instance, the system of equations from the row-echelon form is $v_1-v_2+v_3=0$, $v_2-v_3=0$, and $v_4=0$. This resolves to $v_4=0$, $v_2=v_3$, and $v_1=0$. The solution vector is $v = (0, t, t, 0)^T$ for any scalar $t$, which is a one-dimensional space spanned by the basis vector $(0, 1, 1, 0)^T$.", "answer": "$$\\boxed{1}$$", "id": "4565034"}, {"introduction": "While understanding the theory is crucial, the real power of FBA is realized through computational simulation. This practice guides you in implementing an FBA problem to predict how an organism's growth is affected by the availability of different nutrients in its environment, a common and powerful application [@problem_id:4565021]. This exercise bridges the gap between the abstract mathematical formulation and tangible biological predictions.", "problem": "You are given a small metabolic network suitable for Flux Balance Analysis (FBA). FBA assumes steady state for intracellular metabolite concentrations and models reaction fluxes as a solution to a linear program. Let there be $m$ intracellular metabolites and $n$ reactions, with a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, a flux vector $v \\in \\mathbb{R}^{n}$, and an objective vector $c \\in \\mathbb{R}^{n}$. The steady-state constraint is $S v = 0$, and reaction bounds are $l \\le v \\le u$. The optimization objective is to maximize the biomass flux $c^\\top v$. In this network, all flux units must be expressed in millimoles per gram Dry Weight per hour (mmol/gDW/h).\n\nThe network tracks $m = 5$ intracellular metabolites: glucose ($\\mathrm{G}$), pyruvate ($\\mathrm{P}$), ammonium ($\\mathrm{A}$), oxygen ($\\mathrm{O}$), and a biomass precursor ($\\mathrm{B}$). There are $n = 7$ reactions:\n- $v_1$: Glycolysis-like conversion, $\\mathrm{G} \\rightarrow 2\\,\\mathrm{P}$.\n- $v_2$: Biomass precursor synthesis, $\\mathrm{P} + \\mathrm{A} + \\mathrm{O} \\rightarrow \\mathrm{B}$.\n- $v_3$: Biomass assembly (drain), $\\mathrm{B} \\rightarrow \\varnothing$.\n- $v_4$: Glucose exchange import, $\\varnothing \\rightarrow \\mathrm{G}$.\n- $v_5$: Ammonium exchange import, $\\varnothing \\rightarrow \\mathrm{A}$.\n- $v_6$: Oxygen exchange import, $\\varnothing \\rightarrow \\mathrm{O}$.\n- $v_7$: Pyruvate exchange export, $\\mathrm{P} \\rightarrow \\varnothing$.\n\nAll reactions are irreversible and nonnegative, that is, $v_i \\ge 0$ for all $i \\in \\{1,2,\\dots,7\\}$. For internal reactions $v_1$, $v_2$, $v_3$, use an upper bound of $U_{\\text{int}} = 1000$ mmol/gDW/h. For exchange reactions, the upper bounds are specified per medium. The stoichiometric matrix $S$ (rows ordered as $\\mathrm{G}$, $\\mathrm{P}$, $\\mathrm{A}$, $\\mathrm{O}$, $\\mathrm{B}$; columns ordered as $v_1,\\dots,v_7$) is:\n$$\nS \\;=\\;\n\\begin{bmatrix}\n-1  0  0  +1  0  0  0 \\\\\n+2  -1  0  0  0  0  -1 \\\\\n0  -1  0  0  +1  0  0 \\\\\n0  -1  0  0  0  +1  0 \\\\\n0  +1  -1  0  0  0  0 \\\\\n\\end{bmatrix}.\n$$\nThe biomass objective vector $c$ selects the biomass assembly reaction $v_3$, so $c = (0,\\,0,\\,1,\\,0,\\,0,\\,0,\\,0)^\\top$.\n\nYou must implement exchange constraints for three media compositions by setting the upper bounds $u$ for $v_4$, $v_5$, $v_6$ to the given uptake limits (in mmol/gDW/h), with lower bounds $l$ equal to $0$ for all reactions. The pyruvate export $v_7$ has upper bound $U_{\\text{int}}$.\n\nUsing the steady-state assumption $S v = 0$, reaction bounds $l \\le v \\le u$, and the objective $c^\\top v$, compute the optimal biomass flux $v_3^\\star$ (the maximal feasible value of $v_3$) for each medium. Express each optimal biomass flux in mmol/gDW/h, rounded to three decimal places.\n\nTest suite (each tuple provides $(U_{\\mathrm{glc}}, U_{\\mathrm{nh4}}, U_{\\mathrm{o2}})$, the respective upper bounds for $v_4$, $v_5$, $v_6$):\n- Case $1$ (general feasible growth): $(10,\\,5,\\,20)$.\n- Case $2$ (carbon-limited): $(1,\\,10,\\,10)$.\n- Case $3$ (oxygen-zero edge case): $(10,\\,10,\\,0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[x_1,x_2,x_3]$), where each $x_i$ is the optimal biomass flux for the corresponding test case, rounded to three decimals, in mmol/gDW/h.", "solution": "The problem requires the calculation of the optimal biomass flux in a simplified metabolic network using Flux Balance Analysis (FBA). The FBA framework models the system at a steady state, which translates into a linear programming (LP) problem. The solution to this LP provides the distribution of fluxes through the network's reactions that maximizes a given biological objective.\n\nFirst, we must formalize the problem as a standard linear program. An LP seeks to optimize (maximize or minimize) a linear objective function subject to a set of linear equality and inequality constraints. The general form for this FBA problem is:\n\nMaximize: $c^\\top v$\nSubject to:\n1. $S v = \\mathbf{0}$ (steady-state mass balance)\n2. $l \\le v \\le u$ (flux capacity constraints)\n\nHere, $v \\in \\mathbb{R}^n$ is the vector of fluxes for the $n=7$ reactions, $c \\in \\mathbb{R}^n$ is the objective vector, $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix for the $m=5$ metabolites, and $l, u \\in \\mathbb{R}^n$ are the lower and upper bounds on the fluxes, respectively.\n\nLet's define each component based on the provided information:\n\n1.  **Flux Vector, $v$**: The vector of unknown reaction fluxes we aim to solve for:\n    $$\n    v = [v_1, v_2, v_3, v_4, v_5, v_6, v_7]^\\top\n    $$\n    where each $v_i$ corresponds to the flux of the $i$-th reaction in the network.\n\n2.  **Objective Vector, $c$**: The objective is to maximize the biomass assembly reaction, which is $v_3$. This is achieved by setting the third component of the objective vector $c$ to $1$ and all other components to $0$.\n    $$\n    c = [0, 0, 1, 0, 0, 0, 0]^\\top\n    $$\n    The objective function is then $c^\\top v = v_3$.\n\n3.  **Stoichiometric Matrix, $S$**: The matrix $S$ is given, representing the stoichiometry of the reactions for the metabolites ordered as (Glucose, Pyruvate, Ammonium, Oxygen, Biomass precursor). The columns correspond to reactions $v_1, \\dots, v_7$.\n    $$\n    S \\;=\\;\n    \\begin{bmatrix}\n    -1  0  0  +1  0  0  0 \\\\\n    +2  -1  0  0  0  0  -1 \\\\\n    0  -1  0  0  +1  0  0 \\\\\n    0  -1  0  0  0  +1  0 \\\\\n    0  +1  -1  0  0  0  0 \\\\\n    \\end{bmatrix}\n    $$\n    The steady-state constraint is $S v = \\mathbf{0}$, which yields a system of $5$ linear equations.\n\n4.  **Flux Bounds, $l$ and $u$**:\n    - **Lower Bounds ($l$)**: All reactions are stated to be irreversible and non-negative ($v_i \\ge 0$). This sets all lower bounds to zero.\n      $$\n      l = [0, 0, 0, 0, 0, 0, 0]^\\top\n      $$\n    - **Upper Bounds ($u$)**: The upper bounds are specified for different types of reactions.\n      - Internal reactions ($v_1, v_2, v_3$) and the pyruvate export ($v_7$) have an upper bound of $U_{\\text{int}} = 1000$ mmol/gDW/h.\n      - Exchange import reactions ($v_4, v_5, v_6$) have upper bounds that vary with the medium composition, given by $(U_{\\mathrm{glc}}, U_{\\mathrm{nh4}}, U_{\\mathrm{o2}})$ for each test case.\n      For a specific case, the upper bound vector is:\n      $$\n      u = [1000, 1000, 1000, U_{\\mathrm{glc}}, U_{\\mathrm{nh4}}, U_{\\mathrm{o2}}, 1000]^\\top\n      $$\n\nThe problem can be solved using a standard LP solver, such as `scipy.optimize.linprog`. This function is configured to solve minimization problems. To maximize $c^\\top v$, we can equivalently minimize $-c^\\top v$. Therefore, the objective vector for the solver will be $c' = -c = [0, 0, -1, 0, 0, 0, 0]^\\top$. The optimal biomass flux $v_3^\\star$ will be the negative of the minimum value returned by the solver.\n\nThe implementation will proceed by iterating through the three test cases. For each case:\n1.  The values of $(U_{\\mathrm{glc}}, U_{\\mathrm{nh4}}, U_{\\mathrm{o2}})$ are used to construct the full upper bound vector $u$.\n2.  The `scipy.optimize.linprog` function is called with the following parameters:\n    - `c`: The negative objective vector $c'$.\n    - `A_eq`: The stoichiometric matrix $S$.\n    - `b_eq`: A zero vector of size $m=5$, corresponding to the $S v = \\mathbf{0}$ constraint.\n    - `bounds`: A sequence of $(l_i, u_i)$ pairs for each flux $v_i$.\n\nThe optimal value of the objective function, returned by the solver, is $-v_3^\\star$. The desired result, $v_3^\\star$, is obtained by negating this value. The final result for each case is then rounded to three decimal places.\n\nAlternatively, for this small system, we can deduce the solution analytically from the steady-state equations $Sv=0$:\n1. Row 1: $-v_1 + v_4 = 0 \\implies v_1 = v_4$\n2. Row 3: $-v_2 + v_5 = 0 \\implies v_2 = v_5$\n3. Row 4: $-v_2 + v_6 = 0 \\implies v_2 = v_6$\n4. Row 5: $v_2 - v_3 = 0 \\implies v_2 = v_3$\n5. Row 2: $2v_1 - v_2 - v_7 = 0 \\implies v_7 = 2v_1 - v_2$\n\nTo maximize $v_3$, we must maximize $v_2$. From the equations and bounds:\n- $v_3 = v_2 = v_5 = v_6$. The bounds $v_3 \\le 1000$, $v_2 \\le 1000$, $v_5 \\le U_{\\text{nh4}}$, $v_6 \\le U_{\\text{o2}}$ together imply $v_3 \\le \\min(1000, U_{\\text{nh4}}, U_{\\text{o2}})$.\n- $v_1 = v_4$. The bounds $v_1 \\le 1000$ and $v_4 \\le U_{\\text{glc}}$ imply $v_1 \\le \\min(1000, U_{\\text{glc}})$.\n- To maximize $v_3$ (and thus $v_2$), we need to find a feasible setting for the other fluxes. The constraint $v_7 = 2v_1 - v_2 \\ge 0$ implies $v_2 \\le 2v_1$. To allow for the largest possible $v_2$, we should maximize $v_1$. The maximum value for $v_1$ is $U_{\\text{glc}}$ (since $U_{\\text{glc}} \\le 10$ in all cases). Thus, $v_2 \\le 2U_{\\text{glc}}$.\n- Combining all constraints on $v_3=v_2$, the maximal feasible value is $v_3^\\star = \\min(U_{\\text{nh4}}, U_{\\text{o2}}, 2U_{\\text{glc}}, 1000)$.\n\nApplying this formula to the test cases:\n- Case 1: $(10, 5, 20) \\implies v_3^\\star = \\min(5, 20, 2 \\times 10, 1000) = 5.0$.\n- Case 2: $(1, 10, 10) \\implies v_3^\\star = \\min(10, 10, 2 \\times 1, 1000) = 2.0$.\n- Case 3: $(10, 10, 0) \\implies v_3^\\star = \\min(10, 0, 2 \\times 10, 1000) = 0.0$.\n\nThe following program implements the formal LP solution, which confirms these analytical results.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the Flux Balance Analysis problem for a given metabolic network\n    under different medium compositions.\n    \"\"\"\n\n    # Stoichiometric matrix S (m=5 metabolites, n=7 reactions)\n    # Rows: G, P, A, O, B\n    # Cols: v1, v2, v3, v4, v5, v6, v7\n    S = np.array([\n        [-1,  0,  0,  1,  0,  0,  0],  # G: -v1 + v4 = 0\n        [ 2, -1,  0,  0,  0,  0, -1],  # P: 2v1 - v2 - v7 = 0\n        [ 0, -1,  0,  0,  1,  0,  0],  # A: -v2 + v5 = 0\n        [ 0, -1,  0,  0,  0,  1,  0],  # O: -v2 + v6 = 0\n        [ 0,  1, -1,  0,  0,  0,  0]   # B: v2 - v3 = 0\n    ])\n\n    # Objective is to maximize v3 (biomass).\n    # linprog minimizes, so we minimize -v3.\n    c = np.array([0, 0, -1, 0, 0, 0, 0])\n\n    # Steady-state constraint Sv = 0\n    b_eq = np.zeros(S.shape[0])\n\n    # Upper bound for internal reactions and pyruvate export\n    U_int = 1000.0\n\n    # Define the test cases from the problem statement.\n    # Each tuple provides (U_glc, U_nh4, U_o2) for v4, v5, v6.\n    test_cases = [\n        (10.0, 5.0, 20.0),  # Case 1 (general feasible growth)\n        (1.0, 10.0, 10.0), # Case 2 (carbon-limited)\n        (10.0, 10.0, 0.0)   # Case 3 (oxygen-zero edge case)\n    ]\n\n    results = []\n    for case in test_cases:\n        U_glc, U_nh4, U_o2 = case\n\n        # Define flux bounds (l = v = u). All reactions are irreversible (v_i = 0).\n        # Lower bounds are all 0.\n        # Upper bounds depend on the medium composition.\n        bounds = [\n            (0, U_int),  # v1: Glycolysis-like\n            (0, U_int),  # v2: Biomass precursor synthesis\n            (0, U_int),  # v3: Biomass assembly (drain)\n            (0, U_glc),  # v4: Glucose import\n            (0, U_nh4),  # v5: Ammonium import\n            (0, U_o2),   # v6: Oxygen import\n            (0, U_int)   # v7: Pyruvate export\n        ]\n\n        # Solve the linear programming problem.\n        # The 'highs' method is robust and the default in recent SciPy versions.\n        res = linprog(c=c, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n        # The result 'res.fun' is the minimum value of -v3.\n        # The maximum v3 is -res.fun.\n        if res.success:\n            # Handle the case of -0.0 for display\n            optimal_v3 = -res.fun if res.fun != 0 else 0.0\n        else:\n            # If LP is infeasible or unbounded, max flux is 0.\n            # (Problem setup guarantees feasibility)\n            optimal_v3 = 0.0\n            \n        # Format the result to three decimal places and add to the list.\n        results.append(f\"{optimal_v3:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4565021"}, {"introduction": "One of FBA's most significant contributions is its ability to predict phenotype from genotype by simulating gene deletions. This advanced practice introduces Gene-Protein-Reaction (GPR) rules to model the consequences of knocking out genes, allowing you to identify essential genes and complex genetic interactions like synthetic lethality [@problem_id:4565011]. This demonstrates how FBA serves as a powerful tool in metabolic engineering and systems biology.", "problem": "Consider a toy metabolic network to be analyzed using Flux Balance Analysis (FBA) at steady state. The network has five internal metabolites and nine reactions. Let the metabolites be $G$ (internal glucose), $A$, $B$, $P$, and $ATP$. Let the reaction flux vector be $v \\in \\mathbb{R}^9$, indexed as follows:\n- $v_1$: uptake, $\\rightarrow G$\n- $v_2$: glycolysis, $G \\rightarrow A + ATP$\n- $v_3$: alternative conversion, $G \\rightarrow B$\n- $v_4$: $A \\rightarrow P$\n- $v_5$: $B \\rightarrow P$\n- $v_6$: biomass formation, $P \\rightarrow$ biomass\n- $v_7$: ATP synthesis, $\\rightarrow ATP$\n- $v_8$: (intentionally omitted index; there is no reaction $v_8$ in this model)\n- $v_9$: non-growth associated ATP maintenance, $ATP \\rightarrow$\n\nThe stoichiometric balance equations for the internal metabolites at steady state are given by the linear system $S v = 0$, where the stoichiometric coefficients are:\n- For $G$: $+1$ in $v_1$, $-1$ in $v_2$, $-1$ in $v_3$.\n- For $A$: $+1$ in $v_2$, $-1$ in $v_4$.\n- For $B$: $+1$ in $v_3$, $-1$ in $v_5$.\n- For $P$: $+1$ in $v_4$, $+1$ in $v_5$, $-1$ in $v_6$.\n- For $ATP$: $+1$ in $v_2$, $+1$ in $v_7$, $-1$ in $v_9$.\n\nEach reaction flux $v_j$ has bounds $l_j \\le v_j \\le u_j$ that reflect thermodynamic and capacity constraints:\n- $v_1$: $0 \\le v_1 \\le 10$ (limited uptake capacity)\n- $v_2$: $0 \\le v_2 \\le 1000$\n- $v_3$: $0 \\le v_3 \\le 1000$\n- $v_4$: $0 \\le v_4 \\le 1000$\n- $v_5$: $0 \\le v_5 \\le 1000$\n- $v_6$: $0 \\le v_6 \\le 1000$\n- $v_7$: $0 \\le v_7 \\le 1000$\n- $v_9$: $1 \\le v_9 \\le 1000$ (maintenance demand is enforced by the lower bound)\nAll unlisted reaction bounds are to be treated as non-existent reactions (no $v_8$ exists in this model).\n\nThe objective of FBA is to maximize biomass production flux $v_6$. Formally, the optimization problem is:\n$$\n\\max_{v \\in \\mathbb{R}^9} \\quad c^\\top v \\quad \\text{subject to} \\quad S v = 0, \\quad l \\le v \\le u,\n$$\nwhere $c \\in \\mathbb{R}^9$ has $c_6 = 1$ and $c_j = 0$ for all $j \\neq 6$. All fluxes are expressed in $1/\\mathrm{h}$ and the computed optimal growth rate must be expressed in $1/\\mathrm{h}$.\n\nGene deletions affect reaction feasibility via Gene-Protein-Reaction (GPR) rules. A reaction is active if and only if its GPR rule evaluates to true for the set of non-deleted genes; otherwise, its flux bounds are set to $l_j = u_j = 0$. The GPR rules for the reactions are:\n- $v_1: gT1 \\lor gT2$\n- $v_2$: $gGLY$\n- $v_3: gALT1 \\lor gALT2$\n- $v_4: gA2P1 \\land gA2P2$\n- $v_5$: $gB2P$\n- $v_6$: no associated gene (always active)\n- $v_7: gATPa \\land gATPb$\n- $v_9$: no associated gene (always active)\n\nYou must implement a program that:\n1. Constructs the stoichiometric matrix $S$, the bounds $l$ and $u$, and the objective vector $c$ as specified.\n2. Applies single and double gene deletions by evaluating the GPR rules and setting reaction bounds to zero for any reaction whose GPR rule is not satisfied under the deletion set.\n3. Solves the above linear program for each scenario to obtain the optimal growth rate $v_6^\\star$ in $1/\\mathrm{h}$. If the linear program is infeasible, define the growth rate $v_6^\\star = 0$.\n4. Determines synthetic lethality for gene pairs as follows: a pair $\\{g_a, g_b\\}$ exhibits synthetic lethality if and only if the optimal growth under the double deletion is $\\le \\tau$ while the optimal growth under each single deletion is $ \\tau$, with tolerance $\\tau = 10^{-9}$.\n\nUse the following test suite:\n- Single deletions to evaluate: $[gGLY, gA2P2, gB2P, gATPa, gX]$, where $gX$ is a gene not present in any GPR rule.\n- Double deletions to evaluate: $[(gA2P1, gB2P), (gT1, gT2), (gATPa, gATPb), (gGLY, gGLY), (gX, gB2P), (gGLY, gATPa)]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with the following structure:\n- The first element is the baseline optimal growth rate with no deletions (a float in $1/\\mathrm{h}$).\n- The second element is a list of floats giving the optimal growth rates for the specified single deletions, in the same order, in $1/\\mathrm{h}$.\n- The third element is a list of floats giving the optimal growth rates for the specified double deletions, in the same order, in $1/\\mathrm{h}$.\n- The fourth element is a list of booleans giving the synthetic lethality flags for the specified double deletions, in the same order.\n\nThe final output must therefore be in the exact format:\n$$\n[\\text{baseline},[\\text{single\\_1},\\dots,\\text{single\\_n}],[\\text{double\\_1},\\dots,\\text{double\\_m}],[\\text{SL\\_1},\\dots,\\text{SL\\_m}]]\n$$\nwith all floats in $1/\\mathrm{h}$ and booleans as true or false values.", "solution": "The user provides a well-defined Flux Balance Analysis (FBA) problem for a toy metabolic network and asks for a program to calculate optimal growth rates under various gene deletion scenarios, including an analysis of synthetic lethality.\n\n### Step 1: Extract Givens\n\n- **Metabolites**: $G$, $A$, $B$, $P$, $ATP$.\n- **Reactions and Stoichiometry**:\n    - A flux vector $v \\in \\mathbb{R}^9$ is specified, with $v_8$ being an intentionally omitted reaction. The non-zero entries in the stoichiometric matrix $S$ for the system $S v = 0$ are:\n    - $G$: $v_1 - v_2 - v_3 = 0$\n    - $A$: $v_2 - v_4 = 0$\n    - $B$: $v_3 - v_5 = 0$\n    - $P$: $v_4 + v_5 - v_6 = 0$\n    - $ATP$: $v_2 + v_7 - v_9 = 0$\n- **Flux Bounds ($l \\le v \\le u$)**:\n    - $v_1$: $[0, 10]$\n    - $v_2$: $[0, 1000]$\n    - $v_3$: $[0, 1000]$\n    - $v_4$: $[0, 1000]$\n    - $v_5$: $[0, 1000]$\n    - $v_6$: $[0, 1000]$\n    - $v_7$: $[0, 1000]$\n    - $v_8$: Implicitly $[0, 0]$ as it is an omitted reaction.\n    - $v_9$: $[1, 1000]$\n- **Objective Function**: Maximize $v_6$. This corresponds to an objective vector $c$ where $c_6 = 1$ and all other $c_j = 0$.\n- **Gene-Protein-Reaction (GPR) Rules**: A reaction's flux is set to $0$ if its GPR rule evaluates to false.\n    - $v_1: gT1 \\lor gT2$\n    - $v_2$: $gGLY$\n    - $v_3: gALT1 \\lor gALT2$\n    - $v_4: gA2P1 \\land gA2P2$\n    - $v_5$: $gB2P$\n    - $v_6$: no associated gene\n    - $v_7: gATPa \\land gATPb$\n    - $v_9$: no associated gene\n- **Infeasibility Condition**: If a linear program is infeasible, the optimal growth rate $v_6^\\star$ is defined as $0$.\n- **Synthetic Lethality (SL)**: A gene pair $\\{g_a, g_b\\}$ is synthetically lethal if the growth rate with the double deletion is $\\le \\tau$ while the growth rate with each single deletion is $ \\tau$, where $\\tau = 10^{-9}$.\n- **Test Suite**:\n    - Single deletions: $[gGLY, gA2P2, gB2P, gATPa, gX]$\n    - Double deletions: $[(gA2P1, gB2P), (gT1, gT2), (gATPa, gATPb), (gGLY, gGLY), (gX, gB2P), (gGLY, gATPa)]$\n- **Output Format**: A single line string `[baseline,[single_...],[double_...],[SL_...]]` with floats for growth rates and lowercase booleans for SL flags.\n\n### Step 2: Validate Using Extracted Givens\n\n- **Scientifically Grounded**: The problem is a standard application of Flux Balance Analysis, a cornerstone method in computational systems biology. The concepts of stoichiometric matrices, flux bounds, GPR rules, and synthetic lethality are all standard and well-established in the field.\n- **Well-Posed**: The problem is formulated as a linear program (LP), which is a well-posed mathematical problem. It specifies the objective function, equality constraints ($S v = 0$), and inequality constraints ($l \\le v \\le u$). A unique, stable solution for the maximum objective value is guaranteed to exist, or the problem will be determined to be infeasible. The procedure for handling infeasibility is also clearly defined.\n- **Objective**: The problem is stated using precise mathematical and logical terms, free of subjective language.\n- **Completeness and Consistency**: All necessary components to define the LP for each scenario are provided: the stoichiometric matrix, all bounds, the objective, and the logic (GPR rules) for modifying the bounds. The intentional omission of reaction $v_8$ is explicitly stated and can be handled by setting its corresponding column in $S$ to zero and its bounds to $[0, 0]$, which is a consistent modeling choice.\n\n### Step 3: Verdict and Action\n\nThe problem is valid. It is scientifically sound, well-posed, and all information required for a solution is provided. I will proceed with the solution.\n\n### Principle-Based Design of the Solution\n\nThe solution will be implemented as a Python program utilizing the `scipy.optimize.linprog` function to solve the series of linear programming problems defined by the FBA model.\n\n1.  **Model Representation**: The metabolic network model will be encoded using NumPy arrays.\n    - The stoichiometric matrix $S$ will be a $5 \\times 9$ matrix, where rows correspond to metabolites and columns to reactions ($v_1$ through $v_9$, with column $8$ for the dummy reaction $v_8$ being all zeros).\n    - The base lower ($l$) and upper ($u$) flux bounds will be represented as two $9$-element vectors.\n    - The objective vector $c$ will be a $9$-element vector with a $1$ at the position corresponding to $v_6$ (index $5$) and zeros elsewhere. Since `linprog` performs minimization, we will solve for $\\min(-c^\\top v)$.\n\n2.  **GPR Rule Evaluation**: The GPR rules will be stored in a dictionary mapping reaction indices to their corresponding logical strings. A function will be created to handle gene deletions. For a given set of deleted genes, this function will:\n    - Parse the gene identifiers from all rule strings to establish the complete set of genes in the model.\n    - Generate a boolean status for each gene (present or absent).\n    - Evaluate each GPR string using Python's `eval()` function in a restricted namespace containing only the gene statuses. This provides a simple and effective way to implement the AND/OR logic.\n    - If a rule evaluates to `False`, the corresponding reaction's lower and upper bounds will be set to $0$.\n\n3.  **FBA Solver Function**: A core function, `solve_fba(deleted_genes)`, will encapsulate the logic for solving one FBA instance.\n    - It takes a set of deleted gene names as input.\n    - It applies the GPR logic to generate the appropriate flux bounds for the given deletion scenario.\n    - It calls `scipy.optimize.linprog` with the stoichiometric matrix $S$ as equality constraints (`A_eq`), a zero vector for `b_eq`, the calculated bounds, and the negative objective vector `-c`.\n    - It checks the solver's status code. If the problem is infeasible (`status=2`), it returns a growth rate of $0.0$, as specified. Otherwise, it returns the maximized objective value, which is the negative of the value returned by the minimizer (`-result.fun`).\n\n4.  **Test Suite Execution**: The main part of the program will execute the specified test suite.\n    - It will first compute the baseline growth with no deletions.\n    - It will then iterate through the lists of single and double gene deletions, calling the `solve_fba` function for each case and storing the resulting growth rates.\n    - To determine synthetic lethality for each double deletion pair $\\{g_a, g_b\\}$, it will retrieve the growth rates for the double deletion $\\Delta(g_a, g_b)$ and for each single deletion, $\\Delta(g_a)$ and $\\Delta(g_b)$. A small cache will be used to store and retrieve single-deletion growth rates to avoid redundant computations.\n    - The synthetic lethality condition ($\\Delta(g_a, g_b) \\le \\tau \\land \\Delta(g_a)  \\tau \\land \\Delta(g_b)  \\tau$) will be evaluated for each pair.\n\n5.  **Output Formatting**: A final function will assemble the collected results—baseline growth, single-deletion growths, double-deletion growths, and synthetic lethality flags—into a nested list structure. It will then format this structure into the precise string format required, including the conversion of Python boolean values (`True`, `False`) to lowercase strings (`true`, `false`).\n\nThis structured approach ensures that each part of the problem is addressed correctly and efficiently, leading to the required output.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\nimport re\n\ndef solve():\n    \"\"\"\n    Implements a Flux Balance Analysis (FBA) for a toy metabolic network\n    to calculate growth rates under gene deletions and identify synthetic lethality.\n    \"\"\"\n    # 1. DEFINE THE METABOLIC MODEL\n    # Stoichiometric matrix S (5 metabolites x 9 reactions)\n    # Rows: G, A, B, P, ATP\n    # Cols (0-indexed): v1, v2, v3, v4, v5, v6, v7, v8(dummy), v9\n    S = np.array([\n        # v1, v2, v3, v4, v5, v6, v7, v8, v9\n        [ 1., -1., -1.,  0.,  0.,  0.,  0.,  0.,  0.],  # G\n        [ 0.,  1.,  0., -1.,  0.,  0.,  0.,  0.,  0.],  # A\n        [ 0.,  0.,  1.,  0., -1.,  0.,  0.,  0.,  0.],  # B\n        [ 0.,  0.,  0.,  1.,  1., -1.,  0.,  0.,  0.],  # P\n        [ 0.,  1.,  0.,  0.,  0.,  0.,  1.,  0., -1.]   # ATP\n    ])\n\n    # Base reaction flux bounds (lower, upper). v8 (index 7) is inactive.\n    L_base = np.array([0., 0., 0., 0., 0., 0., 0., 0., 1.])\n    U_base = np.array([10., 1000., 1000., 1000., 1000., 1000., 1000., 0., 1000.])\n\n    # Objective function: maximize v6 (flux at index 5).\n    # linprog minimizes, so we will pass the negative of the objective vector.\n    c = np.zeros(9)\n    c[5] = 1.0\n\n    # Gene-Protein-Reaction (GPR) rules (0-based reaction indices).\n    gpr_rules = {\n        0: \"gT1 or gT2\",\n        1: \"gGLY\",\n        2: \"gALT1 or gALT2\",\n        3: \"gA2P1 and gA2P2\",\n        4: \"gB2P\",\n        6: \"gATPa and gATPb\",\n    }\n    \n    # Extract all unique gene names from GPR rules to build the evaluation context.\n    all_model_genes = set()\n    for rule in gpr_rules.values():\n        all_model_genes.update(re.findall(r'g[A-Za-z0-9]+', rule))\n\n    # Cache for single gene deletion growth rates to speed up SL calculation.\n    # The key is a sorted tuple of deleted genes.\n    fba_results_cache = {}\n\n    # 2. DEFINE THE CORE FBA SOLVER\n    def solve_fba(deleted_genes_set):\n        \"\"\"\n        Solves the FBA problem for a given set of gene deletions.\n        \"\"\"\n        # Use a canonical, sorted tuple as the cache key.\n        cache_key = tuple(sorted(list(deleted_genes_set)))\n        if cache_key in fba_results_cache:\n            return fba_results_cache[cache_key]\n\n        current_l = L_base.copy()\n        current_u = U_base.copy()\n\n        # Evaluate GPR rules and update bounds for knocked-out reactions.\n        gene_status = {gene: (gene not in deleted_genes_set) for gene in all_model_genes}\n        \n        for rxn_idx, rule_str in gpr_rules.items():\n            # Safely evaluate the boolean expression in a restricted namespace.\n            is_active = eval(rule_str, {\"__builtins__\": {}}, gene_status)\n            if not is_active:\n                current_l[rxn_idx] = 0.0\n                current_u[rxn_idx] = 0.0\n        \n        bounds = list(zip(current_l, current_u))\n        b_eq = np.zeros(S.shape[0])\n\n        # Solve the linear program using the 'highs' method.\n        res = linprog(c=-c, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n        # As per problem spec, if infeasible (status 2), growth is 0.\n        if res.status == 2:\n            growth_rate = 0.0\n        else:\n            # Maximization objective is the negative of the minimizer's result.\n            growth_rate = -res.fun if res.success else 0.0\n\n        # Cache the result before returning.\n        fba_results_cache[cache_key] = growth_rate\n        return growth_rate\n\n    # 3. EXECUTE THE TEST SUITE\n    tau = 1e-9\n\n    # Baseline growth (no deletions)\n    baseline_growth = solve_fba(set())\n\n    # Single deletions\n    single_deletion_genes = ['gGLY', 'gA2P2', 'gB2P', 'gATPa', 'gX']\n    single_growth_rates = [solve_fba({g}) for g in single_deletion_genes]\n\n    # Double deletions\n    double_deletion_gene_pairs = [\n        ('gA2P1', 'gB2P'), ('gT1', 'gT2'), ('gATPa', 'gATPb'), \n        ('gGLY', 'gGLY'), ('gX', 'gB2P'), ('gGLY', 'gATPa')\n    ]\n    double_growth_rates = [solve_fba(set(pair)) for pair in double_deletion_gene_pairs]\n\n    # Synthetic lethality analysis\n    synthetic_lethality_flags = []\n    for i, (g_a, g_b) in enumerate(double_deletion_gene_pairs):\n        double_growth = double_growth_rates[i]\n        \n        # Retrieve single growth rates (will use cache if already computed)\n        growth_a = solve_fba({g_a})\n        growth_b = solve_fba({g_b})\n\n        is_lethal = (double_growth = tau) and (growth_a  tau) and (growth_b  tau)\n        synthetic_lethality_flags.append(is_lethal)\n\n    # 4. FORMAT AND PRINT THE FINAL OUTPUT\n    final_result_list = [\n        baseline_growth,\n        single_growth_rates,\n        double_growth_rates,\n        synthetic_lethality_flags\n    ]\n\n    def format_output(data):\n        \"\"\"Recursively formats the results into the required string format.\"\"\"\n        if isinstance(data, list):\n            return f\"[{','.join(format_output(x) for x in data)}]\"\n        elif isinstance(data, bool):\n            return str(data).lower()\n        elif isinstance(data, (float, np.floating)):\n            # Format floats to 1 decimal place if they are whole numbers.\n            return f\"{data:.1f}\" if data == int(data) else str(data)\n        else:\n            return str(data)\n            \n    print(format_output(final_result_list))\n\nsolve()\n```", "id": "4565011"}]}