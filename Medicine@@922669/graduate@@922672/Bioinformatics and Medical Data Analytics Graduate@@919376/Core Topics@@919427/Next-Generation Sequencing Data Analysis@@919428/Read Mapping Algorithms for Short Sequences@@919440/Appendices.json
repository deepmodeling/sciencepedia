{"hands_on_practices": [{"introduction": "Modern short-read aligners rely on the Ferragina-Manzini (FM) index for its remarkable efficiency in finding exact matches within a massive reference genome. This exercise demystifies the core mechanism of the FM-index, the backward search algorithm. By manually tracing the steps to find the suffix array interval for a given read, you will gain a concrete understanding of how the Burrows-Wheeler Transform (BWT) and its auxiliary data structures work in concert to query the reference text. [@problem_id:4603992]", "problem": "An exact read mapper for short sequences uses the Ferragina–Manzini index (FM-index) built on a DNA reference text with a unique sentinel. Consider a reference string $G = \\text{ACGTACGT}\\$$ where the sentinel symbol is $\\$$ and is lexicographically smallest. The alphabet order is $\\text{\\$}  \\text{A}  \\text{C}  \\text{G}  \\text{T}$. An FM-index over $G$ is available with the following components:\n- The Burrows–Wheeler Transform (BWT) string is $\\text{TT\\$AACCGG}$.\n- The array $C$ giving, for each character $c$, the total number of characters in $G$ that are lexicographically smaller than $c$ is: $C(\\$)=0$, $C(\\text{A})=1$, $C(\\text{C})=3$, $C(\\text{G})=5$, $C(\\text{T})=7$.\n- For $c \\in \\{\\$, \\text{A}, \\text{C}, \\text{G}, \\text{T}\\}$ and integer $i$ with $0 \\le i \\le n$, where $n$ is the length of $G$, define $\\mathrm{Occ}(c,i)$ as the number of occurrences of $c$ in the BWT prefix of length $i$ (positions $1$ through $i$), with the convention $\\mathrm{Occ}(c,0)=0$.\n\nLet the short read be $R=\\text{ACGT}$. Starting only from the core definitions of the FM-index, the Last–First property, and the meanings of $C$ and $\\mathrm{Occ}$, perform the complete backward search over $R$ to determine the final suffix array interval $[l,r]$ that corresponds to all suffix array positions whose prefixes match $R$ exactly. Then, state the principled conditions under which a mapper that uses exact FM-index matching would report hits from this interval when enforcing a multi-mapping cap $M$, where reporting occurs only if the total number of exact matches $k$ satisfies $1 \\le k \\le M$.\n\nWhat is the total number of reported exact hits when $M = 3$? Provide your answer as a single integer. No rounding is required, and no units are to be reported.", "solution": "The problem requires performing a backward search for a short read using a given Ferragina–Manzini index (FM-index) and then determining the number of reported hits based on a multi-mapping cap. The process involves two main stages: validating the problem components and executing the search algorithm.\n\nFirst, the validity of the problem statement is established. The provided components are: the reference string $G = \\text{ACGTACGT}\\$$, the alphabet order $\\text{\\$}  \\text{A}  \\text{C}  \\text{G}  \\text{T}$, the Burrows–Wheeler Transform (BWT) string $\\text{TT\\$AACCGG}$, and the C-array: $C(\\$)=0$, $C(\\text{A})=1$, $C(\\text{C})=3$, $C(\\text{G})=5$, $C(\\text{T})=7$. The length of the reference is $n=9$. We can verify that the BWT string and C-array are indeed correct for the given reference $G$, confirming the internal consistency of the problem data. The problem is scientifically grounded, well-posed, objective, and contains all necessary information. Thus, it is valid.\n\nThe core of the solution is the backward search algorithm, which finds all occurrences of a pattern $R$ by iterating backward through its characters. For each character, it updates a suffix array (SA) interval $[l, r]$ that brackets all suffixes of the reference text prefixed by the portion of the pattern processed so far. The update relies on the Last-First (LF) mapping property, encapsulated in the following formulas for a 1-based, inclusive interval $[l,r]$:\n$$l_{new} = C(c) + \\mathrm{Occ}(c, l_{old} - 1) + 1$$\n$$r_{new} = C(c) + \\mathrm{Occ}(c, r_{old})$$\nHere, $c$ is the character being prepended to the search pattern, $[l_{old}, r_{old}]$ is the SA interval from the previous step, $C(c)$ is the count of characters in $G$ lexicographically smaller than $c$, and $\\mathrm{Occ}(c, i)$ is the number of occurrences of character $c$ in the prefix of the BWT string of length $i$, i.e., $\\text{BWT}[1 \\dots i]$. The search starts with the full SA range, $[1, n]$.\n\nThe short read to be mapped is $R=\\text{ACGT}$. The search proceeds backward, processing characters in the order $\\text{T}$, then $\\text{G}$, then $\\text{C}$, then $\\text{A}$. The BWT string is $B = \\text{TT\\$AACCGG}$ and its length is $n=9$. The initial interval is $[l, r] = [1, 9]$.\n\n**Step 1: Search for the last character of the read, $c = \\text{T}$.**\nThe initial interval is $[l_0, r_0] = [1, 9]$. We update it for $c = \\text{T}$.\n$l_1 = C(\\text{T}) + \\mathrm{Occ}(\\text{T}, l_0 - 1) + 1 = C(\\text{T}) + \\mathrm{Occ}(\\text{T}, 0) + 1$.\n$r_1 = C(\\text{T}) + \\mathrm{Occ}(\\text{T}, r_0) = C(\\text{T}) + \\mathrm{Occ}(\\text{T}, 9)$.\nFrom the problem givens, $C(\\text{T}) = 7$. By definition, $\\mathrm{Occ}(\\text{T}, 0) = 0$. By counting in $B = \\text{TT\\$AACCGG}$, the number of occurrences of $\\text{T}$ in the entire BWT string is $\\mathrm{Occ}(\\text{T}, 9) = 2$.\n$l_1 = 7 + 0 + 1 = 8$.\n$r_1 = 7 + 2 = 9$.\nThe SA interval for suffixes starting with $\\text{T}$ is $[8, 9]$.\n\n**Step 2: Prepend the next character, $c = \\text{G}$, to search for $\\text{GT}$.**\nThe current interval is $[l_1, r_1] = [8, 9]$. We update it for $c = \\text{G}$.\n$l_2 = C(\\text{G}) + \\mathrm{Occ}(\\text{G}, l_1 - 1) + 1 = C(\\text{G}) + \\mathrm{Occ}(\\text{G}, 7) + 1$.\n$r_2 = C(\\text{G}) + \\mathrm{Occ}(\\text{G}, r_1) = C(\\text{G}) + \\mathrm{Occ}(\\text{G}, 9)$.\nGiven $C(\\text{G}) = 5$. We count occurrences of $\\text{G}$ in prefixes of $B = \\text{TT\\$AACCGG}$:\n$\\mathrm{Occ}(\\text{G}, 7)$ applied to $B[1 \\dots 7] = \\text{TT\\$AACC}$ is $0$.\n$\\mathrm{Occ}(\\text{G}, 9)$ applied to $B[1 \\dots 9] = \\text{TT\\$AACCGG}$ is $2$.\n$l_2 = 5 + 0 + 1 = 6$.\n$r_2 = 5 + 2 = 7$.\nThe SA interval for suffixes starting with $\\text{GT}$ is $[6, 7]$.\n\n**Step 3: Prepend the next character, $c = \\text{C}$, to search for $\\text{CGT}$.**\nThe current interval is $[l_2, r_2] = [6, 7]$. We update it for $c = \\text{C}$.\n$l_3 = C(\\text{C}) + \\mathrm{Occ}(\\text{C}, l_2 - 1) + 1 = C(\\text{C}) + \\mathrm{Occ}(\\text{C}, 5) + 1$.\n$r_3 = C(\\text{C}) + \\mathrm{Occ}(\\text{C}, r_2) = C(\\text{C}) + \\mathrm{Occ}(\\text{C}, 7)$.\nGiven $C(\\text{C}) = 3$. We count occurrences of $\\text{C}$ in prefixes of $B$:\n$\\mathrm{Occ}(\\text{C}, 5)$ applied to $B[1 \\dots 5] = \\text{TT\\$AA}$ is $0$.\n$\\mathrm{Occ}(\\text{C}, 7)$ applied to $B[1 \\dots 7] = \\text{TT\\$AACC}$ is $2$.\n$l_3 = 3 + 0 + 1 = 4$.\n$r_3 = 3 + 2 = 5$.\nThe SA interval for suffixes starting with $\\text{CGT}$ is $[4, 5]$.\n\n**Step 4: Prepend the first character, $c = \\text{A}$, to search for $\\text{ACGT}$.**\nThe current interval is $[l_3, r_3] = [4, 5]$. We update it for $c = \\text{A}$.\n$l_4 = C(\\text{A}) + \\mathrm{Occ}(\\text{A}, l_3 - 1) + 1 = C(\\text{A}) + \\mathrm{Occ}(\\text{A}, 3) + 1$.\n$r_4 = C(\\text{A}) + \\mathrm{Occ}(\\text{A}, r_3) = C(\\text{A}) + \\mathrm{Occ}(\\text{A}, 5)$.\nGiven $C(\\text{A}) = 1$. We count occurrences of $\\text{A}$ in prefixes of $B$:\n$\\mathrm{Occ}(\\text{A}, 3)$ applied to $B[1 \\dots 3] = \\text{TT\\$}$ is $0$.\n$\\mathrm{Occ}(\\text{A}, 5)$ applied to $B[1 \\dots 5] = \\text{TT\\$AA}$ is $2$.\n$l_4 = 1 + 0 + 1 = 2$.\n$r_4 = 1 + 2 = 3$.\nThe final SA interval for the read $\\text{ACGT}$ is $[l, r] = [2, 3]$.\n\nThe number of exact matches, $k$, is the size of this final interval.\n$$k = r - l + 1 = 3 - 2 + 1 = 2$$\nThis means the read $\\text{ACGT}$ appears exactly $2$ times as a substring in the reference genome $G$.\n\nThe problem states that a mapper with a multi-mapping cap $M$ reports hits only if the total number of exact matches $k$ satisfies the condition $1 \\le k \\le M$. If this condition is met, all $k$ hits are reported. If $k=0$ (no match) or $k  M$ (too many matches), nothing is reported.\n\nWe are given a multi-mapping cap of $M = 3$. We found that the number of exact matches is $k = 2$. We must check if the reporting condition is satisfied:\n$$1 \\le k \\le M \\implies 1 \\le 2 \\le 3$$\nThis inequality is true. Therefore, the mapper reports the hits. The total number of reported exact hits is equal to $k$.\n\nThus, the total number of reported exact hits is $2$.", "answer": "$$\\boxed{2}$$", "id": "4603992"}, {"introduction": "Finding an exact match is often not possible due to sequencing errors and biological variations. Therefore, aligners must score inexact alignments, and a crucial component of this is the gap penalty model. This practice problem focuses on a realistic scenario involving an insertion or deletion (indel) within a homopolymer run, a common error type. By comparing the alignment score from a sophisticated affine gap model to one from a naive approach, you will see firsthand why accurately modeling gap opening and extension costs is critical for avoiding alignment artifacts and achieving biologically meaningful results. [@problem_id:4603915]", "problem": "Consider a short-read mapping scenario typical of Next-Generation Sequencing, in which a read must be aligned to a reference genome segment using a dynamic programming alignment with an affine gap model. Begin from the following fundamental bases: sequence alignment score is the sum of rewards for matches and penalties for mismatches and gaps, and an affine gap penalty decomposes a gap of length $L$ into a gap-open penalty plus $L$ gap-extension penalties. Define the insertion-deletion (indel) model as a single deletion event in the read relative to the reference within a homopolymer run, a realistic error mode in several sequencing technologies.\n\nA mapper anchors a read to a reference by an exact seed and then extends the alignment across a homopolymer run without immediate gap opening. Let the reference segment be 5'-CGA TTTTTTTTT ACG-3' with $10$ consecutive thymine nucleotides, and let the read be 5'-CGA TTTTTT ACG-3' with $7$ consecutive thymine nucleotides, so the read has a single deletion of length $L = 3$ within the homopolymer run. Assume the flanking contexts \"CGA\" and \"ACG\" are identical in the read and reference.\n\nUse the following affine scoring scheme throughout the extension: a match contributes $+\\alpha$ with $\\alpha = 2$, a mismatch contributes $-\\delta$ with $\\delta = 3$, opening a gap incurs $-\\gamma$ with $\\gamma = 4$, and each gap extension incurs $-\\lambda$ with $\\lambda = 1$. The dynamic programming extension operates under two strategies:\n\n- Strategy A (no-gap forced over the homopolymer): The extension does not open a gap within the homopolymer. Because the read is shorter by $L = 3$ in the homopolymer, the alignment is shifted by $L$ positions upon exiting the run, causing the next $L$ aligned positions at the boundary to be mismatches before re-synchronization, after which all subsequent positions match.\n\n- Strategy B (affine-gap within the homopolymer): The extension opens a single deletion gap of length $L = 3$ within the homopolymer run and then continues with matches.\n\nAssume that in both strategies, all positions outside the immediate homopolymer boundary align as matches, and the seed and terminal contexts remain perfectly matched, so that the only scoring difference between Strategy A and Strategy B arises from how the single indel is treated.\n\nDerive, from the above bases and definitions, the alignment score for Strategy A and Strategy B, and then compute the numerical score improvement of Strategy B over Strategy A, defined as the score of Strategy B minus the score of Strategy A. Provide your final answer as a single real number. No rounding is necessary.", "solution": "The problem is well-posed, scientifically grounded, and provides all necessary information to derive a unique solution. We begin by analyzing the scoring for the two specified alignment strategies.\n\nThe problem states that the scoring difference between Strategy A and Strategy B arises solely from the handling of the indel within the homopolymer run and its immediate boundary. The perfectly matched flanking contexts `CGA` and `ACG` contribute an identical score component to both strategies, which will cancel out when the difference is computed. Therefore, we only need to calculate the alignment scores for the region of divergence.\n\nThe reference sequence contains a homopolymer of $10$ thymine nucleotides, while the read contains $7$. This corresponds to a deletion in the read of length $L = 10 - 7 = 3$ relative to the reference.\n\nThe scoring parameters are given as:\n- Match score: $+\\alpha = +2$\n- Mismatch penalty: $-\\delta = -3$\n- Gap-open penalty: $-\\gamma = -4$\n- Gap-extension penalty: $-\\lambda = -1$\n\n**Strategy A: No-Gap Forced Alignment**\n\nIn this strategy, no gap is introduced. The $7$ thymines of the read are aligned against the first $7$ thymines of the reference's homopolymer run. According to the problem description, this forces a shift in the alignment such that \"the next $L$ aligned positions at the boundary to be mismatches\". With $L=3$, this means the `ACG` context of the read aligns against the remaining $3$ thymines of the reference's homopolymer.\n\nThe alignment for the region of interest is as follows:\n- First, $7$ thymines from the read align with $7$ thymines from the reference, resulting in $7$ matches.\n- Next, the subsequent $3$ bases from the read (`A`, `C`, `G`) align with the last $3$ thymines from the reference's homopolymer run (`T`, `T`, `T`), resulting in $3$ mismatches.\n\nThe score for Strategy A, denoted as $S_A$, is the sum of the scores from these components:\n$$S_A = 7 \\times \\alpha + L \\times (-\\delta)$$\nSubstituting the given values, $L=3$, $\\alpha=2$, and $\\delta=3$:\n$$S_A = 7(2) + 3(-3) = 14 - 9 = 5$$\n\n**Strategy B: Affine-Gap Alignment**\n\nIn this strategy, a single deletion gap of length $L=3$ is opened in the read to account for the missing bases. The alignment for the homopolymer region is:\n- The $7$ thymines of the read align with the first $7$ thymines of the reference, resulting in $7$ matches.\n- The remaining $3$ thymines of the reference's homopolymer are aligned against a gap in the read. This constitutes a single gap event of length $L=3$.\n\nThe score for Strategy B, denoted as $S_B$, is the sum of the scores from the matches and the affine gap penalty. The affine gap penalty for a gap of length $L$ is $(-\\gamma) + L \\times (-\\lambda)$.\n$$S_B = 7 \\times \\alpha + (-\\gamma) + L \\times (-\\lambda)$$\nSubstituting the given values, $L=3$, $\\alpha=2$, $\\gamma=4$, and $\\lambda=1$:\n$$S_B = 7(2) + (-4) + 3(-1) = 14 - 4 - 3 = 7$$\n\n**Score Improvement of Strategy B over Strategy A**\n\nThe score improvement is defined as the score of Strategy B minus the score of Strategy A.\n$$\\text{Score Improvement} = S_B - S_A$$\nUsing the calculated scores:\n$$\\text{Score Improvement} = 7 - 5 = 2$$\n\nAlternatively, we can compute the difference symbolically:\n$$S_B - S_A = (7\\alpha - \\gamma - L\\lambda) - (7\\alpha - L\\delta)$$\n$$S_B - S_A = 7\\alpha - \\gamma - L\\lambda - 7\\alpha + L\\delta$$\n$$S_B - S_A = L\\delta - \\gamma - L\\lambda$$\nSubstituting the values $L=3$, $\\delta=3$, $\\gamma=4$, and $\\lambda=1$:\n$$S_B - S_A = 3(3) - 4 - 3(1) = 9 - 4 - 3 = 2$$\nBoth methods yield the same result. The use of an explicit affine gap penalty (Strategy B) results in a higher (better) alignment score compared to forcing mismatches to avoid a gap (Strategy A).", "answer": "$$\\boxed{2}$$", "id": "4603915"}, {"introduction": "A high alignment score does not guarantee a correct mapping, especially in genomes with repetitive regions. To address this, mappers report a Mapping Quality (MAPQ), a probabilistic estimate of mapping accuracy. This exercise will guide you through the derivation of MAPQ from first principles. By converting alignment scores into posterior probabilities under a defined error model, you will learn how to quantify the confidence in a mapping by considering both the best alignment and its closest competitor, a fundamental concept in the interpretation of alignment results. [@problem_id:4603952]", "problem": "A short Deoxyribonucleic Acid (DNA) read of length $L=75$ nucleotides is aligned to a reference genome by a mapper that scores candidate alignments using a position-wise log-likelihood ratio (LLR) model with a natural logarithm. For each position $i$, let $b_i \\in \\{\\mathrm{A},\\mathrm{C},\\mathrm{G},\\mathrm{T}\\}$ be the reference base and $x_i$ be the observed read base. Assume the following well-tested probabilistic base-emission model:\n- Under the hypothesis that the alignment is correct, the base-calling error rate per position is $\\epsilon$, independent across positions. Thus $\\Pr(x_i=b_i \\mid \\text{correct})=1-\\epsilon$ and $\\Pr(x_i \\neq b_i \\mid \\text{correct})=\\epsilon$, with a symmetric error model distributing $\\epsilon$ equally among the three incorrect nucleotides, so $\\Pr(x_i=a \\neq b_i \\mid \\text{correct})=\\epsilon/3$.\n- Under the hypothesis that the alignment is incorrect, the observed base is independent of $b_i$ and follows a uniform background distribution $\\Pr(x_i=\\mathrm{A})=\\Pr(x_i=\\mathrm{C})=\\Pr(x_i=\\mathrm{G})=\\Pr(x_i=\\mathrm{T})=1/4$.\n\nThe alignment score for a candidate alignment $j$ is defined as the sum over positions of the LLR,\n$$\nS_j \\equiv \\sum_{i=1}^{L} \\ln\\!\\left(\\frac{\\Pr(x_i \\mid \\text{correct at }j)}{\\Pr(x_i \\mid \\text{incorrect})}\\right),\n$$\nwhere $\\ln$ denotes the natural logarithm.\n\nA particular read produces two plausible alignments (hits). For the best-scoring hit (candidate $j=1$), there are $m_1=70$ matches and $u_1=5$ mismatches. For the second-best hit (candidate $j=2$), there are $m_2=68$ matches and $u_2=7$ mismatches. Assume the prior probability of either candidate being the true origin of the read is equal, and the prior probability mass of any other origin is negligible relative to these two.\n\nLet the Phred-like mapping quality $Q$ be defined by\n$$\nQ \\equiv -10\\,\\log_{10}\\!\\big(1 - P_{\\text{correct}}\\big),\n$$\nwhere $P_{\\text{correct}}$ is the posterior probability that the best-scoring hit is the correct origin of the read under the probabilistic model above. Using only the assumptions stated, derive $P_{\\text{correct}}$ from the alignment scores $S_1$ and $S_2$, evaluate $Q$ numerically for $\\epsilon=0.01$, and report the final $Q$ rounded to four significant figures. Express $Q$ as a dimensionless number (no units).", "solution": "The problem is subjected to validation and is deemed valid. It is scientifically grounded in the principles of bioinformatics and probabilistic modeling, well-posed with sufficient information for a unique solution, and objective in its language.\n\nThe objective is to compute the Phred-like mapping quality $Q$ for the best-scoring alignment. This requires determining the posterior probability, $P_{\\text{correct}}$, that the best-scoring hit (candidate $j=1$) is the true origin of the read. Let $C_j$ be the event that candidate alignment $j$ is the correct origin, and let $X$ represent the observed read sequence data. We are asked to find $P_{\\text{correct}} = \\Pr(C_1 \\mid X)$.\n\nAccording to Bayes' theorem, the posterior probability is given by:\n$$ \\Pr(C_1 \\mid X) = \\frac{\\Pr(X \\mid C_1) \\Pr(C_1)}{\\Pr(X)} $$\nThe problem states that the prior probabilities of the two candidates are equal, $\\Pr(C_1) = \\Pr(C_2)$, and that the probability of any other origin is negligible. This implies the sample space for the true origin can be restricted to $\\{C_1, C_2\\}$, so $\\Pr(C_1) + \\Pr(C_2) \\approx 1$, leading to $\\Pr(C_1) = \\Pr(C_2) = 1/2$. The marginal probability of the data, $\\Pr(X)$, is the sum over all possible hypotheses:\n$$ \\Pr(X) = \\Pr(X \\mid C_1)\\Pr(C_1) + \\Pr(X \\mid C_2)\\Pr(C_2) $$\nSubstituting this into the expression for $\\Pr(C_1 \\mid X)$ and using the equal priors:\n$$ P_{\\text{correct}} = \\Pr(C_1 \\mid X) = \\frac{\\Pr(X \\mid C_1) \\Pr(C_1)}{\\Pr(X \\mid C_1)\\Pr(C_1) + \\Pr(X \\mid C_2)\\Pr(C_2)} = \\frac{\\Pr(X \\mid C_1)}{\\Pr(X \\mid C_1) + \\Pr(X \\mid C_2)} $$\nThe term $\\Pr(X \\mid C_j)$ is the likelihood of observing the read $X$ given that alignment $j$ is correct. The alignment score $S_j$ is defined as the log-likelihood ratio:\n$$ S_j = \\sum_{i=1}^{L} \\ln\\left(\\frac{\\Pr(x_i \\mid C_j)}{\\Pr(x_i \\mid \\text{incorrect})}\\right) $$\nDue to the independence of base-calling errors across positions, this sum of logs can be written as the log of a product:\n$$ S_j = \\ln\\left(\\prod_{i=1}^{L} \\frac{\\Pr(x_i \\mid C_j)}{\\Pr(x_i \\mid \\text{incorrect})}\\right) = \\ln\\left(\\frac{\\prod_{i=1}^{L}\\Pr(x_i \\mid C_j)}{\\prod_{i=1}^{L}\\Pr(x_i \\mid \\text{incorrect})}\\right) = \\ln\\left(\\frac{\\Pr(X \\mid C_j)}{\\Pr(X \\mid \\text{incorrect})}\\right) $$\nExponentiating both sides gives the likelihood $\\Pr(X \\mid C_j)$ in terms of the score $S_j$ and the likelihood under the incorrect-alignment hypothesis, $\\Pr(X \\mid \\text{incorrect})$:\n$$ \\Pr(X \\mid C_j) = \\Pr(X \\mid \\text{incorrect}) \\exp(S_j) $$\nSubstituting this into the equation for $P_{\\text{correct}}$:\n$$ P_{\\text{correct}} = \\frac{\\Pr(X \\mid \\text{incorrect}) \\exp(S_1)}{\\Pr(X \\mid \\text{incorrect}) \\exp(S_1) + \\Pr(X \\mid \\text{incorrect}) \\exp(S_2)} = \\frac{\\exp(S_1)}{\\exp(S_1) + \\exp(S_2)} $$\nDividing the numerator and denominator by $\\exp(S_1)$ yields the desired expression for $P_{\\text{correct}}$ in terms of the alignment scores:\n$$ P_{\\text{correct}} = \\frac{1}{1 + \\exp(S_2 - S_1)} $$\nNext, we must calculate the score difference $S_1 - S_2$. The total score for an alignment is the sum of log-likelihood ratios over all positions. This sum can be separated into contributions from matches and mismatches. Let $LLR_m$ be the LLR for a match and $LLR_u$ be the LLR for a mismatch.\nFor a match ($x_i=b_i$):\n$$ LLR_m = \\ln\\left(\\frac{\\Pr(x_i=b_i \\mid \\text{correct})}{\\Pr(x_i=b_i \\mid \\text{incorrect})}\\right) = \\ln\\left(\\frac{1-\\epsilon}{1/4}\\right) = \\ln(4(1-\\epsilon)) $$\nFor a mismatch ($x_i \\neq b_i$):\n$$ LLR_u = \\ln\\left(\\frac{\\Pr(x_i \\neq b_i \\mid \\text{correct})}{\\Pr(x_i \\neq b_i \\mid \\text{incorrect})}\\right) = \\ln\\left(\\frac{\\epsilon/3}{1/4}\\right) = \\ln\\left(\\frac{4\\epsilon}{3}\\right) $$\nThe total alignment score for candidate $j$ with $m_j$ matches and $u_j$ mismatches is:\n$$ S_j = m_j LLR_m + u_j LLR_u $$\nThe score difference is then:\n$$ S_1 - S_2 = (m_1 - m_2) LLR_m + (u_1 - u_2) LLR_u $$\nGiven $m_1=70, u_1=5$ and $m_2=68, u_2=7$. The differences are $m_1-m_2=2$ and $u_1-u_2=-2$.\n$$ S_1 - S_2 = 2 \\cdot LLR_m - 2 \\cdot LLR_u = 2(LLR_m - LLR_u) $$\nSubstituting the expressions for $LLR_m$ and $LLR_u$:\n$$ S_1 - S_2 = 2\\left[\\ln(4(1-\\epsilon)) - \\ln\\left(\\frac{4\\epsilon}{3}\\right)\\right] = 2\\ln\\left(\\frac{4(1-\\epsilon)}{4\\epsilon/3}\\right) = 2\\ln\\left(\\frac{3(1-\\epsilon)}{\\epsilon}\\right) $$\nThe probability of error (i.e., the probability that the best hit is incorrect) is $1 - P_{\\text{correct}}$:\n$$ 1 - P_{\\text{correct}} = 1 - \\frac{1}{1 + \\exp(S_2 - S_1)} = \\frac{\\exp(S_2 - S_1)}{1 + \\exp(S_2 - S_1)} = \\frac{1}{\\exp(S_1 - S_2) + 1} $$\nSubstituting the expression for $S_1 - S_2$:\n$$ 1 - P_{\\text{correct}} = \\frac{1}{\\exp\\left(2\\ln\\left(\\frac{3(1-\\epsilon)}{\\epsilon}\\right)\\right) + 1} = \\frac{1}{\\left(\\frac{3(1-\\epsilon)}{\\epsilon}\\right)^2 + 1} $$\nNow we can express the mapping quality $Q$ in terms of $\\epsilon$:\n$$ Q = -10\\,\\log_{10}(1 - P_{\\text{correct}}) = -10\\,\\log_{10}\\left(\\frac{1}{1 + \\left(\\frac{3(1-\\epsilon)}{\\epsilon}\\right)^2}\\right) = 10\\,\\log_{10}\\left(1 + \\left(\\frac{3(1-\\epsilon)}{\\epsilon}\\right)^2\\right) $$\nWe are given $\\epsilon=0.01$. We can now evaluate this expression numerically.\nFirst, calculate the term inside the parenthesis:\n$$ \\frac{3(1-\\epsilon)}{\\epsilon} = \\frac{3(1-0.01)}{0.01} = \\frac{3 \\times 0.99}{0.01} = 3 \\times 99 = 297 $$\nNow, substitute this value into the expression for $Q$:\n$$ Q = 10\\,\\log_{10}(1 + 297^2) = 10\\,\\log_{10}(1 + 88209) = 10\\,\\log_{10}(88210) $$\nUsing a calculator for the logarithm:\n$$ \\log_{10}(88210) \\approx 4.945523 $$\nTherefore, the mapping quality is:\n$$ Q = 10 \\times 4.945523 \\approx 49.45523 $$\nRounding the result to four significant figures gives $49.46$.", "answer": "$$\\boxed{49.46}$$", "id": "4603952"}]}