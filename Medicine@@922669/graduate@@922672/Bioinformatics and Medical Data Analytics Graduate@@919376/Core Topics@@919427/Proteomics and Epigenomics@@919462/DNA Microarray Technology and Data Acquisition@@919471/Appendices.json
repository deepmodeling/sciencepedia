{"hands_on_practices": [{"introduction": "To interpret microarray data, we must first understand the biophysical principles governing signal generation. This initial practice guides you through modeling the ideal hybridization of a target DNA sequence to its corresponding probe on the array surface at thermodynamic equilibrium. By applying the law of mass action, you will derive the foundational Langmuir isotherm, which provides a direct quantitative link between the concentration of a target molecule in solution and the resulting fluorescence intensity we expect to measure.", "problem": "In a Deoxyribonucleic acid (DNA) microarray hybridization experiment, consider a single, well-isolated probe spot bearing a large excess of identical, noninteracting probe sites exposed to a well-mixed bath containing a single cognate target species at a known bulk concentration. Assume the following scientifically standard conditions: monovalent probe–target binding, negligible nonspecific interactions, negligible probe–probe interactions, and negligible depletion of target from the bulk by surface binding so that the free target concentration at the surface equals the bulk concentration. The surface hybridization proceeds according to reversible binding kinetics and reaches thermodynamic equilibrium. The detector operates in the linear, non-saturating regime so that the measured fluorescence intensity is proportional to the fraction of occupied probe sites, and the relative intensity normalized to the fully saturated signal equals the equilibrium bound fraction.\n\nYou are given an equilibrium association constant $K$ and a bulk target concentration $C$, with $K = 10^{8}\\,\\mathrm{M}^{-1}$ and $C = 0.5\\,\\mathrm{nM}$. Starting only from the law of mass action for the reaction $\\text{probe} + \\text{target} \\rightleftharpoons \\text{complex}$ and conservation of surface binding sites, derive the equilibrium bound fraction of probe sites and then use it to estimate the relative intensity, assuming linear detection and no scanner saturation.\n\nReport a single number equal to this bound fraction (which equals the relative intensity normalized to the saturation intensity), as a dimensionless decimal fraction, rounded to four significant figures.", "solution": "The problem requires the derivation of the equilibrium bound fraction of probe sites for a surface hybridization reaction and its subsequent calculation based on given parameters. The derivation must proceed from first principles, namely the law of mass action and the conservation of surface binding sites.\n\nFirst, we formalize the system. Let $[P]$ represent the surface concentration of free, unoccupied probe sites, $[T]$ be the concentration of free target molecules at the surface, and $[PT]$ be the surface concentration of occupied probe sites (probe-target complexes). The total surface concentration of probe sites, which is a constant, is denoted by $[P_{total}]$.\n\nThe reversible binding reaction is given as:\n$$\n\\text{probe} + \\text{target} \\rightleftharpoons \\text{complex}\n$$\nOr, using our defined symbols for the species at the surface:\n$$\nP + T \\rightleftharpoons PT\n$$\nAccording to the law of mass action, at thermodynamic equilibrium, the ratio of concentrations of products to reactants is defined by the equilibrium association constant, $K$:\n$$\nK = \\frac{[PT]}{[P] [T]}\n$$\nThe conservation of surface probe sites dictates that the total concentration of sites is the sum of the concentrations of free (unoccupied) and bound (occupied) sites:\n$$\n[P_{total}] = [P] + [PT]\n$$\nFrom this conservation law, we can express the concentration of free sites as:\n$$\n[P] = [P_{total}] - [PT]\n$$\nThe problem states that depletion of the target from the bulk solution is negligible. Therefore, the concentration of free target molecules at the surface, $[T]$, is equal to the bulk concentration, $C$.\n$$\n[T] = C\n$$\nNow, substitute the expressions for $[P]$ and $[T]$ into the law of mass action equation:\n$$\nK = \\frac{[PT]}{([P_{total}] - [PT]) C}\n$$\nOur objective is to find the equilibrium bound fraction, denoted by $\\theta$. This fraction is defined as the ratio of the concentration of occupied sites to the total concentration of sites:\n$$\n\\theta = \\frac{[PT]}{[P_{total}]}\n$$\nTo derive an expression for $\\theta$, we rearrange the equation involving $K$. First, multiply both sides by $([P_{total}] - [PT]) C$:\n$$\nK C ([P_{total}] - [PT]) = [PT]\n$$\nDistribute the term $K C$ on the left-hand side:\n$$\nK C [P_{total}] - K C [PT] = [PT]\n$$\nGather all terms containing $[PT]$ on one side of the equation:\n$$\nK C [P_{total}] = [PT] + K C [PT]\n$$\nFactor out $[PT]$ on the right-hand side:\n$$\nK C [P_{total}] = [PT] (1 + K C)\n$$\nTo obtain the bound fraction $\\theta$, we divide both sides by $[P_{total}]$ and by $(1 + K C)$:\n$$\n\\frac{[PT]}{[P_{total}]} = \\frac{K C}{1 + K C}\n$$\nThus, the equilibrium bound fraction is:\n$$\n\\theta = \\frac{K C}{1 + K C}\n$$\nThis is the well-known Langmuir adsorption isotherm. The problem states that the relative intensity, normalized to the saturation intensity, equals this equilibrium bound fraction. We now proceed to calculate the numerical value of $\\theta$ using the provided data.\n\nThe given values are:\nEquilibrium association constant, $K = 10^{8}\\,\\mathrm{M}^{-1}$.\nBulk target concentration, $C = 0.5\\,\\mathrm{nM}$.\n\nThe units of $K$ and $C$ must be consistent. We convert the concentration $C$ from nanomolar ($\\mathrm{nM}$) to molar ($\\mathrm{M}$).\n$$\n1\\,\\mathrm{nM} = 10^{-9}\\,\\mathrm{M}\n$$\nTherefore,\n$$\nC = 0.5\\,\\mathrm{nM} = 0.5 \\times 10^{-9}\\,\\mathrm{M}\n$$\nNow, we calculate the dimensionless product $K C$:\n$$\nK C = (10^{8}\\,\\mathrm{M}^{-1}) \\times (0.5 \\times 10^{-9}\\,\\mathrm{M}) = 0.5 \\times 10^{8-9} = 0.5 \\times 10^{-1} = 0.05\n$$\nFinally, we substitute this value into the expression for $\\theta$:\n$$\n\\theta = \\frac{K C}{1 + K C} = \\frac{0.05}{1 + 0.05} = \\frac{0.05}{1.05}\n$$\nPerforming the division:\n$$\n\\theta = \\frac{5}{105} = \\frac{1}{21} \\approx 0.0476190476...\n$$\nThe problem requires the result to be rounded to four significant figures. The first four significant figures are $4$, $7$, $6$, and $1$. The fifth significant digit is $9$. Since $9 \\ge 5$, we round up the fourth significant digit ($1$) to $2$.\n$$\n\\theta \\approx 0.04762\n$$\nThis value represents both the equilibrium bound fraction of probe sites and the relative fluorescence intensity.", "answer": "$$\\boxed{0.04762}$$", "id": "4558648"}, {"introduction": "Real-world biological samples are complex mixtures, not pure solutions of a single target. This practice extends our equilibrium model to account for the crucial phenomenon of competitive binding, where nonspecific sequences vie with the intended target for the same probe sites. Tackling this problem [@problem_id:4558674] will deepen your understanding of signal specificity and the challenges of distinguishing true signal from background noise, a fundamental aspect of data acquisition.", "problem": "A Deoxyribonucleic Acid (DNA) microarray spot presents a large number of identical, non-interacting probe sites, each capable of binding at most one target molecule by Watson–Crick hybridization. The array is hybridized with a well-mixed solution containing a single specific target at concentration $C_{s}$ and $m$ nonspecific competitors at concentrations $\\{C_{i}\\}_{i=1}^{m}$. Assume reversible binding governed by mass action kinetics and thermodynamic equilibrium, with association equilibrium constants $K_{s}$ for the specific target and $\\{K_{i}\\}_{i=1}^{m}$ for the competitors. All targets compete for the same probe sites, and there are no cooperative or steric effects beyond single-site occupancy. The scanner measures fluorescence intensity proportional to the fraction of probe sites bound by the specific target, and competitors are unlabeled.\n\nStarting from the definition of the equilibrium association constant $K=\\frac{k_{\\mathrm{on}}}{k_{\\mathrm{off}}}$ for a single binding reaction, the law of mass action, and site conservation for independent adsorption to identical sites, derive from first principles an expression for the equilibrium fraction of probe sites bound by the specific target, as a function of $K_{s}$, $C_{s}$, $\\{K_{i}\\}_{i=1}^{m}$, and $\\{C_{i}\\}_{i=1}^{m}$. Then, for $m=3$ competitors, evaluate this bound fraction numerically using:\n- $K_{s} = 1.0 \\times 10^{8} \\, \\mathrm{M}^{-1}$, $C_{s} = 2.0 \\times 10^{-9} \\, \\mathrm{M}$,\n- $K_{1} = 2.0 \\times 10^{6} \\, \\mathrm{M}^{-1}$, $C_{1} = 5.0 \\times 10^{-8} \\, \\mathrm{M}$,\n- $K_{2} = 5.0 \\times 10^{5} \\, \\mathrm{M}^{-1}$, $C_{2} = 1.0 \\times 10^{-7} \\, \\mathrm{M}$,\n- $K_{3} = 1.0 \\times 10^{6} \\, \\mathrm{M}^{-1}$, $C_{3} = 1.0 \\times 10^{-8} \\, \\mathrm{M}$.\n\nExpress the final bound fraction as a unitless decimal and round your answer to four significant figures.", "solution": "The problem requires the derivation of the equilibrium fraction of probe sites occupied by a specific target molecule in the presence of multiple competitor molecules. This is a classic competitive binding problem, which can be solved using the principles of mass action kinetics at thermodynamic equilibrium. The model is equivalent to the competitive Langmurian adsorption isotherm.\n\nFirst, we define the relevant species and their concentrations.\nLet $[P]$ be the concentration of free, unoccupied probe sites on the microarray surface.\nLet $[PS]$ be the concentration of probe sites bound to the specific target molecule, $S$.\nLet $[PC_i]$ be the concentration of probe sites bound to the $i$-th nonspecific competitor molecule, $C_i$.\nLet $[P]_T$ be the total concentration of probe sites, which is constant.\nThe conservation of probe sites dictates that the total concentration is the sum of the free and occupied sites:\n$$ [P]_T = [P] + [PS] + \\sum_{i=1}^{m} [PC_i] $$\n\nThe problem states that binding is reversible and governed by mass action kinetics. At equilibrium, for each binding reaction, the rate of association equals the rate of dissociation. This relationship is quantified by the association equilibrium constant, $K$.\n\nFor the specific target molecule $S$ binding to a probe site $P$ to form a complex $PS$:\n$$ S + P \\rightleftharpoons PS $$\nThe association equilibrium constant, $K_s$, is given by:\n$$ K_s = \\frac{[PS]}{[P][S]} $$\nThe problem describes hybridization in a well-mixed solution where the concentration of the target, $C_s$, can be assumed to be constant and equal to the concentration of free target molecules in the bulk solution, i.e., $[S] = C_s$. This assumes the number of surface sites is small compared to the total number of molecules in solution, so binding does not significantly deplete the bulk concentration.\nRearranging the equilibrium equation for the specific target gives:\n$$ [PS] = K_s [P] C_s $$\n\nSimilarly, for each of the $m$ nonspecific competitor molecules, $C_i$, binding to a probe site $P$:\n$$ C_i + P \\rightleftharpoons PC_i $$\nThe corresponding association equilibrium constant, $K_i$, is:\n$$ K_i = \\frac{[PC_i]}{[P][C_i]} $$\nAssuming the bulk concentrations of the competitors, $\\{C_i\\}_{i=1}^{m}$, are also constant, i.e., $[C_i] = C_i$, we can write:\n$$ [PC_i] = K_i [P] C_i $$\n\nNow, we substitute the expressions for $[PS]$ and $[PC_i]$ into the site conservation equation:\n$$ [P]_T = [P] + K_s [P] C_s + \\sum_{i=1}^{m} (K_i [P] C_i) $$\nWe can factor out the concentration of free probe sites, $[P]$:\n$$ [P]_T = [P] \\left( 1 + K_s C_s + \\sum_{i=1}^{m} K_i C_i \\right) $$\n\nThe quantity of interest is the fraction of probe sites bound by the specific target. Let us denote this fraction by $\\theta_s$. By definition, this is the ratio of the concentration of specifically bound sites to the total concentration of sites:\n$$ \\theta_s = \\frac{[PS]}{[P]_T} $$\nSubstituting the expressions we derived for $[PS]$ and $[P]_T$:\n$$ \\theta_s = \\frac{K_s [P] C_s}{[P] \\left( 1 + K_s C_s + \\sum_{i=1}^{m} K_i C_i \\right)} $$\nThe concentration of free sites, $[P]$, cancels out from the numerator and the denominator, yielding the final general expression for the specifically bound fraction:\n$$ \\theta_s = \\frac{K_s C_s}{1 + K_s C_s + \\sum_{i=1}^{m} K_i C_i} $$\nThis expression gives the equilibrium fraction of occupied sites as a function of the specific and nonspecific target concentrations and their respective binding affinities, as required.\n\nNext, we evaluate this expression numerically for the case of $m=3$ competitors, using the provided data:\n- $K_{s} = 1.0 \\times 10^{8} \\, \\mathrm{M}^{-1}$, $C_{s} = 2.0 \\times 10^{-9} \\, \\mathrm{M}$\n- $K_{1} = 2.0 \\times 10^{6} \\, \\mathrm{M}^{-1}$, $C_{1} = 5.0 \\times 10^{-8} \\, \\mathrm{M}$\n- $K_{2} = 5.0 \\times 10^{5} \\, \\mathrm{M}^{-1}$, $C_{2} = 1.0 \\times 10^{-7} \\, \\mathrm{M}$\n- $K_{3} = 1.0 \\times 10^{6} \\, \\mathrm{M}^{-1}$, $C_{3} = 1.0 \\times 10^{-8} \\, \\mathrm{M}$\n\nThe formula becomes:\n$$ \\theta_s = \\frac{K_s C_s}{1 + K_s C_s + K_1 C_1 + K_2 C_2 + K_3 C_3} $$\nWe first calculate the dimensionless products $K C$ for each species:\n- Specific target signal term: $K_s C_s = (1.0 \\times 10^8) \\times (2.0 \\times 10^{-9}) = 0.2$\n- Competitor $1$ cross-reactivity term: $K_1 C_1 = (2.0 \\times 10^6) \\times (5.0 \\times 10^{-8}) = 10.0 \\times 10^{-2} = 0.1$\n- Competitor $2$ cross-reactivity term: $K_2 C_2 = (5.0 \\times 10^5) \\times (1.0 \\times 10^{-7}) = 5.0 \\times 10^{-2} = 0.05$\n- Competitor $3$ cross-reactivity term: $K_3 C_3 = (1.0 \\times 10^6) \\times (1.0 \\times 10^{-8}) = 1.0 \\times 10^{-2} = 0.01$\n\nNow, we substitute these values into the expression for $\\theta_s$:\n$$ \\theta_s = \\frac{0.2}{1 + 0.2 + 0.1 + 0.05 + 0.01} $$\nThe denominator is the sum of all terms:\n$$ \\text{Denominator} = 1 + 0.2 + 0.1 + 0.05 + 0.01 = 1.36 $$\nThe numerator is $0.2$.\nTherefore, the fraction of specifically bound sites is:\n$$ \\theta_s = \\frac{0.2}{1.36} \\approx 0.1470588... $$\nThe problem asks for the result to be rounded to four significant figures.\n$$ \\theta_s \\approx 0.1471 $$\nThis is the final numerical answer.", "answer": "$$\\boxed{0.1471}$$", "id": "4558674"}, {"introduction": "Having modeled signal generation at the single-probe level, we now address a central challenge in data acquisition: making measurements comparable across different arrays. Technical variations in sample preparation, hybridization, and scanning can introduce systematic biases that obscure true biological differences. This computational exercise [@problem_id:4558692] introduces quantile normalization, a powerful technique for aligning the statistical distributions of multiple arrays, ensuring that downstream comparisons are valid and meaningful.", "problem": "You are given multiple vectors of fluorescence intensities from single-channel DNA microarray technology, each vector corresponding to one array measured on the same probe set. The goal is to implement quantile normalization as a distributional alignment procedure grounded in the following fundamental base: fluorescence intensity is a monotone function of target abundance, and empirical distributions can be aligned by matching empirical quantiles. Use the definitions of Empirical Cumulative Distribution Function (ECDF) and quantile function without relying on any specialized microarray shortcut formulas.\n\nDefinitions and assumptions to use as the fundamental base:\n- Let $m$ denote the number of arrays and let $n$ denote the number of probes per array. For array $i \\in \\{1,\\dots,m\\}$, let the observed intensities be $X^{(i)} = (X^{(i)}_1,\\dots,X^{(i)}_n) \\in \\mathbb{R}^n$.\n- The Empirical Cumulative Distribution Function (ECDF) of array $i$ is $F_i(x) = \\frac{1}{n}\\sum_{k=1}^n \\mathbf{1}\\{X^{(i)}_k \\le x\\}$.\n- The empirical quantile function (generalized inverse) is $Q_i(p) = \\inf\\{x \\in \\mathbb{R}: F_i(x) \\ge p\\}$ for $p \\in (0,1]$.\n- Assume measurement is a monotone transformation of a common biological signal, so that across arrays it is meaningful to align empirical quantiles.\n- The common quantile reference is defined conceptually as the pointwise average of the arrays’ empirical quantile functions.\n\nYour tasks:\n- Derive, from the above base, an implementable algorithm that maps each array’s empirical distribution onto a common quantile reference constructed from the arrays themselves. The algorithm must satisfy the following consistency constraint: if $X^{(i)}_{(1)} \\le \\dots \\le X^{(i)}_{(n)}$ are the order statistics of array $i$, and if $R_j$ denotes the common reference at rank $j \\in \\{1,\\dots,n\\}$, then entries in array $i$ that occupy a contiguous block of equal values covering ranks $a$ through $b$ in its sorted order must all be assigned the average $\\frac{1}{b-a+1}\\sum_{j=a}^b R_j$ upon normalization. This rule ensures stability under ties within an array.\n- Implement your algorithm as a complete program that, for each test case below, quantile-normalizes the arrays and returns the normalized values in their original index order. Round each output value to $6$ decimal places using standard rounding.\n\nTest suite:\n- Test case $1$ (general case, no ties): three arrays of length $5$.\n  - Array $1$: $[5.2,\\,3.1,\\,4.4,\\,8.0,\\,7.3]$\n  - Array $2$: $[2.0,\\,9.1,\\,6.5,\\,3.3,\\,5.7]$\n  - Array $3$: $[7.2,\\,1.2,\\,2.9,\\,4.1,\\,6.9]$\n- Test case $2$ (boundary case, identical arrays): two arrays of length $4$.\n  - Array $1$: $[1.0,\\,2.0,\\,3.0,\\,4.0]$\n  - Array $2$: $[1.0,\\,2.0,\\,3.0,\\,4.0]$\n- Test case $3$ (edge case, one array constant with ties): three arrays of length $6$.\n  - Array $1$: $[10.0,\\,10.0,\\,10.0,\\,10.0,\\,10.0,\\,10.0]$\n  - Array $2$: $[8.0,\\,12.0,\\,7.0,\\,15.0,\\,9.0,\\,11.0]$\n  - Array $3$: $[13.0,\\,14.0,\\,5.0,\\,6.0,\\,16.0,\\,4.0]$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list of floats containing the quantile-normalized values, flattened by concatenating arrays in the order given, and within each array preserving the original probe index order. For example, the overall output should look like $[[\\dots],[\\dots],[\\dots]]$ where each inner list contains $n \\times m$ rounded float values for that test case in the specified order.\n- No inputs are to be read; the program must run as-is on the provided test suite and print exactly one line.\n\nAngle units and physical units do not apply in this problem. All reported numbers must be rounded to $6$ decimal places, expressed as decimals (not as percentages).", "solution": "The goal is to devise and implement an algorithm for quantile normalization, a procedure to align the statistical distributions of multiple datasets, in this case, fluorescence intensity vectors from DNA microarrays. The derivation must be founded strictly on the provided definitions of the Empirical Cumulative Distribution Function (ECDF) and the quantile function.\n\nLet the data be represented by an $n \\times m$ matrix $X$, where $n$ is the number of probes, $m$ is the number of arrays, and the $i$-th column $X^{(i)}$ contains the intensities for array $i$.\n\n**1. The Common Reference Distribution**\n\nThe foundation of quantile normalization is the assumption that a common underlying distribution exists for all arrays, and any observed differences in distributions are due to technical, non-biological variation. The task is to map each array's empirical distribution to a common reference distribution.\n\nThe problem defines this reference as the \"pointwise average of the arrays' empirical quantile functions.\" Let's formalize this. The ECDF for array $i$ is $F_i(x) = \\frac{1}{n}\\sum_{k=1}^n \\mathbf{1}\\{X^{(i)}_k \\le x\\}$, and its quantile function is $Q_i(p) = \\inf\\{x \\in \\mathbb{R}: F_i(x) \\ge p\\}$.\n\nFor a finite sample of size $n$, the ECDF is a step function. The quantile function $Q_i(p)$ is most naturally evaluated at a set of $n$ discrete probabilities. A standard choice for these is $p_j = j/n$ for $j=1, \\dots, n$, but for practical implementation with order statistics, we consider the values themselves. Let $X^{(i)}_{(1)} \\le \\dots \\le X^{(i)}_{(n)}$ denote the order statistics of array $i$. These are the empirical quantiles of the distribution of $X^{(i)}$. Specifically, $X^{(i)}_{(j)}$ is an estimator of $Q_i(p)$ for $p$ in the vicinity of $j/n$.\n\nThe reference quantile function, $Q_{ref}(p)$, is defined as $Q_{ref}(p) = \\frac{1}{m} \\sum_{i=1}^m Q_i(p)$. To create a practical, discrete reference distribution, we evaluate this at each of the $n$ ranks. We define a reference value, $R_j$, for each rank $j \\in \\{1, \\dots, n\\}$ by averaging the $j$-th order statistics across all $m$ arrays:\n$$\nR_j = \\frac{1}{m} \\sum_{i=1}^m X^{(i)}_{(j)}\n$$\nThe vector $R = (R_1, R_2, \\dots, R_n)$ constitutes our sorted target distribution. Any normalized array, when sorted, should have these values.\n\n**2. Rank-Based Normalization and Handling of Ties**\n\nThe normalization procedure replaces each intensity value in an original array with a value from the reference distribution $R$ based on its rank.\n\nIf all values within an array are unique, a value $X^{(i)}_k$ with rank $j$ (i.e., it is the $j$-th smallest value in the array) is replaced by the $j$-th reference quantile, $R_j$.\n\nHowever, real data often contains ties. The problem specifies a consistency constraint for this scenario: if multiple entries are tied in value, they occupy a contiguous block of ranks, say from $a$ to $b$. All these tied entries must be assigned the same normalized value, which is the arithmetic mean of the reference quantiles corresponding to that block of ranks:\n$$\nX^{(i)}_{norm, \\text{tied}} = \\frac{1}{b-a+1} \\sum_{j=a}^b R_j\n$$\nThis rule ensures that identical measurements within a sample are mapped to identical normalized values, preserving the internal structure of ties while conforming to the overall reference distribution.\n\n**3. Algorithmic Synthesis**\n\nBased on the principles above, we can formulate a complete algorithm for quantile normalization.\n\n1.  **Construct Data Matrix**: Given $m$ arrays of length $n$, construct an $n \\times m$ matrix $X$.\n\n2.  **Determine Ranks and Sorted Data**: For each column (array) $i$ of $X$, determine the permutation of indices that sorts the column. This gives the rank of each element. Apply these permutations to create a new matrix, $X_{sorted}$, where each column contains the order statistics of the corresponding original array.\n\n3.  **Compute Reference Quantiles**: Compute the row-wise mean of the $X_{sorted}$ matrix. This yields the reference quantile vector $R$ of length $n$.\n    $$\n    R_j = \\frac{1}{m} \\sum_{i=1}^{m} (X_{sorted})_{j,i} \\quad \\text{for } j=1, \\dots, n \\quad \\text{(using 1-based indexing for clarity)}\n    $$\n\n4.  **Assign Normalized Values with Tie Handling**: Create a temporary matrix, $X'_{norm\\_sorted}$, of the same dimensions. For each column $i$:\n    a. Iterate through the sorted column $(X_{sorted})_{:, i}$.\n    b. Identify contiguous blocks of identical values. For each block spanning ranks $a$ to $b$, calculate the average of the reference quantiles over this range, $\\bar{R}_{a,b} = \\frac{1}{b-a+1} \\sum_{j=a}^b R_j$.\n    c. Assign this average value $\\bar{R}_{a,b}$ to all entries in column $i$ of $X'_{norm\\_sorted}$ from row $a$ to $b$.\n\n5.  **Reorder to Original Structure**: The matrix $X'_{norm\\_sorted}$ contains the correct normalized values, but they are sorted within each column. The final step is to \"unsort\" each column to match the original data's structure. This is achieved by using the inverse of the sorting permutations computed in Step 2. For each column, the value at rank $j$ in $X'_{norm\\_sorted}$ is placed back into the original position of the element that had rank $j$.\n\nThe result is a matrix $X_{norm}$ of the same dimensions as $X$, where each column has been quantile-normalized. The values are then rounded and formatted as per the problem specification.", "answer": "```python\nimport numpy as np\n\ndef quantile_normalize(data_matrix):\n    \"\"\"\n    Performs quantile normalization on a matrix of expression data.\n\n    The problem is defined in terms of arrays as vectors, but it is conventional\n    in numpy to treat them as columns of a matrix.\n    The input data_matrix is expected to have shape (n_probes, m_arrays).\n    \"\"\"\n    # Step 1: Get data dimensions\n    n, m = data_matrix.shape\n\n    # Step 2: Determine ranks and get sorted data\n    # sorted_indices gives the original row indices of the elements in sorted order.\n    # e.g., sorted_indices[0, i] is the original index of the smallest element in col i.\n    sorted_indices = np.argsort(data_matrix, axis=0)\n    \n    # sorted_data is the matrix where each column is sorted\n    sorted_data = np.take_along_axis(data_matrix, sorted_indices, axis=0)\n\n    # Step 3: Compute reference quantiles (row-wise mean of sorted data)\n    reference_quantiles = np.mean(sorted_data, axis=1)\n\n    # Step 4: Assign normalized values with tie handling\n    # This matrix will hold the normalized values, but in sorted order for each column\n    normalized_data_sorted = np.zeros_like(data_matrix)\n\n    for i in range(m):\n        # Process each column (array)\n        sorted_col = sorted_data[:, i]\n        \n        j = 0\n        while j  n:\n            # Find the contiguous block of ties\n            # Find all elements equal to the current one\n            tie_group_indices = np.where(sorted_col == sorted_col[j])[0]\n            \n            # The contiguous block starts at j and ends at the max index in the group\n            # This is simpler and more robust than finding start/end of contiguous blocks\n            # if the sorted array has interleaved values (which it won't, but as a general pattern)\n            # here we can just find the end of the current contiguous block\n            start_j = j\n            end_j = j\n            while end_j + 1  n and sorted_col[end_j + 1] == sorted_col[start_j]:\n                end_j += 1\n            \n            # These ranks are from start_j to end_j (inclusive)\n            ranks = slice(start_j, end_j + 1)\n            \n            # Calculate the mean of the reference quantiles for this block of ranks\n            avg_ref = np.mean(reference_quantiles[ranks])\n            \n            # Assign this average to all tied ranks in the sorted normalized data\n            normalized_data_sorted[ranks, i] = avg_ref\n            \n            # Move to the next new value\n            j = end_j + 1\n            \n    # Step 5: Reorder to original structure\n    # We need to place a value from normalized_data_sorted[j, i] into the\n    # original position of the element that had rank j in column i.\n    # The original position is given by sorted_indices[j, i].\n    \n    normalized_data = np.zeros_like(data_matrix)\n    # A bit more explicit than np.put_along_axis for clarity\n    for i in range(m):\n        # The indices to restore original order\n        original_order_indices = np.argsort(sorted_indices[:, i])\n        normalized_data[:, i] = normalized_data_sorted[:, i][original_order_indices]\n        # A more direct way without a second argsort:\n        # for j in range(n):\n        #     original_index = sorted_indices[j, i]\n        #     normalized_data[original_index, i] = normalized_data_sorted[j, i]\n\n    return normalized_data\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (general case, no ties)\n        [\n            [5.2, 3.1, 4.4, 8.0, 7.3],\n            [2.0, 9.1, 6.5, 3.3, 5.7],\n            [7.2, 1.2, 2.9, 4.1, 6.9]\n        ],\n        # Test case 2 (boundary case, identical arrays)\n        [\n            [1.0, 2.0, 3.0, 4.0],\n            [1.0, 2.0, 3.0, 4.0]\n        ],\n        # Test case 3 (edge case, one array constant with ties)\n        [\n            [10.0, 10.0, 10.0, 10.0, 10.0, 10.0],\n            [8.0, 12.0, 7.0, 15.0, 9.0, 11.0],\n            [13.0, 14.0, 5.0, 6.0, 16.0, 4.0]\n        ]\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Convert to numpy array, transposing to have arrays as columns\n        data_matrix = np.array(case).T\n        normalized_matrix = quantile_normalize(data_matrix)\n        \n        # Round to 6 decimal places\n        rounded_matrix = np.round(normalized_matrix, 6)\n        \n        # Flatten the result by concatenating arrays (now columns)\n        # The result must be flattened in the order of original arrays\n        flattened_result = rounded_matrix.T.flatten().tolist()\n        all_results.append(flattened_result)\n\n    # Format the final output as a string representing a list of lists.\n    # The str(list) automatically generates the correct bracketed, comma-separated format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "4558692"}]}