{"hands_on_practices": [{"introduction": "The cornerstone of identifying a ChIP-seq peak is determining if the number of reads at a specific locus is statistically significant. This practice introduces the Poisson distribution as a fundamental null model for background reads, allowing you to calculate the probability of observing a given read count by chance. Mastering this calculation is the first step toward understanding how peak callers quantify evidence for enrichment.", "problem": "In chromatin immunoprecipitation followed by high-throughput sequencing (ChIP-seq) for histone modifications, a common peak-calling baseline assumes that, under a background-only null model with no true enrichment, the read counts in fixed-width genomic bins are generated by a Poisson process with a bin-specific mean equal to the background rate. Suppose that a negative control experiment and genome-wide normalization have estimated the background rate to be $\\lambda = 3$ reads per bin at the binning scheme under consideration. In an immunoprecipitation track at a candidate summit bin, an observed count of $k = 20$ reads is recorded.\n\nUnder the background-only null, model the count in a bin as a Poisson random variable with mean $\\lambda$. Define the one-sided enrichment $p$-value for this bin as the probability, under the null, of observing at least $k$ reads in a single bin. Derive the form of this $p$-value from first principles given the Poisson model and compute it for $\\lambda = 3$ and $k = 20$. Express your final answer as a single closed-form analytic expression without numerical approximation. No units are required for the final answer, as the $p$-value is dimensionless.", "solution": "The problem asks for the one-sided enrichment $p$-value, which is the probability of observing a read count of at least $k$ in a single bin, given a background null model.\n\n1.  **Define the Null Model:** The null model assumes the read count, $X$, in a single bin follows a Poisson distribution with a mean rate $\\lambda$. This is written as $X \\sim \\text{Poisson}(\\lambda)$. The probability mass function (PMF) for a Poisson distribution is:\n    $$ P(X=i) = \\frac{e^{-\\lambda} \\lambda^i}{i!} $$\n    In this problem, we are given the background rate $\\lambda = 3$.\n\n2.  **Define the p-value:** The $p$-value is the probability of observing a result as extreme as or more extreme than the one observed, assuming the null hypothesis is true. For enrichment, this corresponds to a one-sided test:\n    $$ p = P(X \\ge k) $$\n    Here, the observed count is $k=20$.\n\n3.  **Formulate the Calculation:** We need to calculate $P(X \\ge 20)$. This can be expressed as an infinite sum:\n    $$ P(X \\ge 20) = \\sum_{i=20}^{\\infty} P(X=i) = \\sum_{i=20}^{\\infty} \\frac{e^{-3} 3^i}{i!} $$\n\n4.  **Use the Complement for a Closed-Form Expression:** Calculating an infinite sum is impractical. It is more straightforward to calculate the probability of the complementary event, $P(X  20)$, and subtract it from 1. The event $X  20$ is equivalent to $X \\le 19$.\n    $$ P(X \\ge 20) = 1 - P(X  20) = 1 - P(X \\le 19) $$\n    The cumulative probability $P(X \\le 19)$ is a finite sum:\n    $$ P(X \\le 19) = \\sum_{i=0}^{19} P(X=i) = \\sum_{i=0}^{19} \\frac{e^{-3} 3^i}{i!} $$\n\n5.  **Final Expression:** Substituting this back into the equation for the $p$-value gives the final closed-form analytical expression. We can factor out the constant term $e^{-3}$:\n    $$ p = 1 - e^{-3} \\sum_{i=0}^{19} \\frac{3^i}{i!} $$\nThis expression is the final answer.", "answer": "$$\n\\boxed{1 - \\exp(-3) \\sum_{i=0}^{19} \\frac{3^i}{i!}}\n$$", "id": "4545465"}, {"introduction": "While a simple global background rate is a good starting point, real genomic landscapes have variable background signals due to factors like chromatin accessibility and sequence mappability. This exercise simulates a more sophisticated background estimation method, akin to that used in the popular MACS algorithm, by integrating information across multiple genomic scales. This demonstrates how to build a robust, local null model, which is critical for reducing false positives in peak calling.", "problem": "A histone modification Chromatin Immunoprecipitation followed by sequencing (ChIP-seq) peak-calling pipeline models binned read counts in the treatment sample as realizations of a Poisson random variable with mean (expected count) given by a locally estimated background rate. In widely used approaches such as Model-based Analysis of ChIP-Sequencing (MACS), the local background expectation at a candidate locus is stabilized by choosing the maximum among a global background rate and window-normalized control rates computed at multiple spatial scales. Concretely, suppose the following are observed and assumed:\n- The test bin width is $200$ base pairs (bp).\n- Control sample counts around the locus are $5$ in the $1\\,\\mathrm{kb}$ window, $18$ in the $5\\,\\mathrm{kb}$ window, and $24$ in the $10\\,\\mathrm{kb}$ window, where $1\\,\\mathrm{kb} = 1000\\,\\mathrm{bp}$.\n- The global background rate is $\\lambda_{\\mathrm{global}} = 2$ counts per $200\\,\\mathrm{bp}$ bin.\n- Treatment and control libraries have equal total sequencing depths, so no further library-size scaling is required.\n- The observed treatment count in the test bin at the locus is $30$.\n\nUnder the Poisson model, and using the multi-scale stabilization rule $\\lambda_{\\mathrm{local}} = \\max\\{\\lambda_{\\mathrm{global}}, \\lambda_{1\\,\\mathrm{kb}}, \\lambda_{5\\,\\mathrm{kb}}, \\lambda_{10\\,\\mathrm{kb}}\\}$, where each $\\lambda_{w}$ is obtained by normalizing the control count in the window of width $w$ to the $200\\,\\mathrm{bp}$ test bin by count density times bin width, compute:\n1. The local expected count $\\lambda_{\\mathrm{local}}$ for the $200\\,\\mathrm{bp}$ bin.\n2. The one-sided Poisson $p$-value $P(X \\geq 30 \\mid \\lambda_{\\mathrm{local}})$ for testing enrichment in the treatment, where $X$ denotes the Poisson count in the bin.\n\nReport $\\lambda_{\\mathrm{local}}$ exactly as a count per $200\\,\\mathrm{bp}$ bin (dimensionless), and round the $p$-value to three significant figures. Express the $p$-value as a dimensionless decimal in scientific notation.", "solution": "We begin from the definition of the Poisson distribution: if $X \\sim \\mathrm{Pois}(\\lambda)$, then the probability mass function is\n$$\nP(X = n \\mid \\lambda) = \\exp(-\\lambda)\\,\\frac{\\lambda^{n}}{n!},\n$$\nfor $n \\in \\{0,1,2,\\dots\\}$. The one-sided enrichment $p$-value for observing at least $k$ reads under the null $\\mathrm{Pois}(\\lambda)$ model is\n$$\nP(X \\geq k \\mid \\lambda) = \\sum_{n=k}^{\\infty} \\exp(-\\lambda)\\,\\frac{\\lambda^{n}}{n!} = 1 - \\sum_{n=0}^{k-1} \\exp(-\\lambda)\\,\\frac{\\lambda^{n}}{n!}.\n$$\nEquivalently, in terms of the regularized upper incomplete gamma function, for integer $k$,\n$$\nP(X \\geq k \\mid \\lambda) = \\frac{\\Gamma(k, \\lambda)}{\\Gamma(k)}.\n$$\n\nThe local background expectation is stabilized as\n$$\n\\lambda_{\\mathrm{local}} = \\max\\left\\{\\lambda_{\\mathrm{global}}, \\lambda_{1\\,\\mathrm{kb}}, \\lambda_{5\\,\\mathrm{kb}}, \\lambda_{10\\,\\mathrm{kb}}\\right\\},\n$$\nwhere each window-normalized expectation $\\lambda_{w}$ is computed by converting the control count in window width $w$ to an expected count in the $200\\,\\mathrm{bp}$ test bin via density times bin width:\n$$\n\\lambda_{w} = \\left(\\frac{c_{w}}{w}\\right)\\times 200,\n$$\nwith $c_{w}$ the control count in the $w$-bp window. Under the assumption of equal library sizes, no additional scaling factor is needed.\n\nCompute each $\\lambda_{w}$:\n- For $w = 1\\,\\mathrm{kb} = 1000\\,\\mathrm{bp}$ and $c_{1\\,\\mathrm{kb}} = 5$,\n$$\n\\lambda_{1\\,\\mathrm{kb}} = \\left(\\frac{5}{1000}\\right)\\times 200 = 1.\n$$\n- For $w = 5\\,\\mathrm{kb} = 5000\\,\\mathrm{bp}$ and $c_{5\\,\\mathrm{kb}} = 18$,\n$$\n\\lambda_{5\\,\\mathrm{kb}} = \\left(\\frac{18}{5000}\\right)\\times 200 = 0.72.\n$$\n- For $w = 10\\,\\mathrm{kb} = 10000\\,\\mathrm{bp}$ and $c_{10\\,\\mathrm{kb}} = 24$,\n$$\n\\lambda_{10\\,\\mathrm{kb}} = \\left(\\frac{24}{10000}\\right)\\times 200 = 0.48.\n$$\nGiven $\\lambda_{\\mathrm{global}} = 2$, we have\n$$\n\\lambda_{\\mathrm{local}} = \\max\\{2, 1, 0.72, 0.48\\} = 2.\n$$\n\nNow compute the one-sided $p$-value for observing $k = 30$ under $X \\sim \\mathrm{Pois}(\\lambda_{\\mathrm{local}})$ with $\\lambda_{\\mathrm{local}} = 2$:\n$$\nP(X \\geq 30 \\mid \\lambda = 2) = \\sum_{n=30}^{\\infty} \\exp(-2)\\,\\frac{2^{n}}{n!}.\n$$\nThe leading term is\n$$\nP(X = 30 \\mid \\lambda = 2) = \\exp(-2)\\,\\frac{2^{30}}{30!}.\n$$\nWe can evaluate this term by using $2^{30} = 1{,}073{,}741{,}824$ and the exact factorial $30! = 265252859812191058636308480000000$, yielding\n$$\nP(X = 30 \\mid \\lambda = 2) = \\exp(-2)\\,\\frac{1{,}073{,}741{,}824}{265252859812191058636308480000000}.\n$$\nNumerically, $\\exp(-2) \\approx 0.1353352832366127$, and thus\n$$\nP(X = 30 \\mid \\lambda = 2) \\approx 5.48 \\times 10^{-25}.\n$$\nTo approximate the upper tail beyond $n=30$, note the recursive ratio\n$$\n\\frac{P(X = n+1 \\mid \\lambda)}{P(X = n \\mid \\lambda)} = \\frac{\\lambda}{n+1}.\n$$\nAt $n = 30$ and $\\lambda = 2$, this ratio is $\\frac{2}{31} \\approx 0.064516129$, and it decreases further for larger $n$. Therefore, the tail sum is well-approximated by a rapidly convergent series:\n$$\n\\sum_{n=30}^{\\infty} P(X = n \\mid \\lambda=2) = P(X=30 \\mid \\lambda=2)\\left(1 + \\frac{2}{31} + \\frac{2}{31}\\cdot\\frac{2}{32} + \\frac{2}{31}\\cdot\\frac{2}{32}\\cdot\\frac{2}{33} + \\dots \\right).\n$$\nEvaluating the first several terms of the multiplicative factors inside the parentheses gives approximately\n$$\n1 + 0.064516129 + 0.004032508 + 0.000244097 + 0.000014360 + 0.000000819 + \\dots \\approx 1.068807962.\n$$\nThus,\n$$\nP(X \\geq 30 \\mid \\lambda = 2) \\approx \\left(5.48 \\times 10^{-25}\\right)\\times 1.068807962 \\approx 5.86 \\times 10^{-25}.\n$$\nAlternatively, using the regularized upper incomplete gamma function, $P(X \\geq 30 \\mid \\lambda = 2) = \\Gamma(30,2)/\\Gamma(30)$, which numerically evaluates to the same value.\n\nTherefore, the requested quantities are\n$$\n\\lambda_{\\mathrm{local}} = 2,\\quad P(X \\geq 30 \\mid \\lambda_{\\mathrm{local}}) \\approx 5.86 \\times 10^{-25},\n$$\nwith the $p$-value rounded to three significant figures as required.", "answer": "$$\\boxed{\\begin{pmatrix}2  5.86 \\times 10^{-25}\\end{pmatrix}}$$", "id": "4545492"}, {"introduction": "Unlike the sharp, localized peaks of transcription factors, many histone modifications form broad domains that can span thousands of base pairs. This exercise addresses this by moving from identifying individual enriched bins to the crucial post-processing step of \"stitching\" them together. You will apply a defined rule to merge nearby significant bins, illustrating how peak callers algorithmically define these large-scale chromatin features.", "problem": "Chromatin Immunoprecipitation Sequencing (ChIP-seq) for broad histone modifications such as histone H3 lysine 27 trimethylation (H3K27me3) is often analyzed by binning the genome into equal-width bins and identifying enriched bins according to a statistical test (for example, a Poisson or negative binomial test against input control), followed by stitching adjacent enriched bins into domains to tolerate local dropout due to sampling variability. Consider a single chromosome partitioned into $20$ consecutive non-overlapping bins indexed $1$ through $20$. Let the set of enriched bin indices be $E=\\{2,3,4,7,8,12,13,14,15,19\\}$. A stitching rule is defined by a nonnegative integer gap allowance $g$, which permits merging enriched bins across at most $g$ intervening unenriched bins. Formally, enriched bins at indices $ij$ are considered stitchable within a single domain if the number of intervening unenriched bins, $j-i-1$, satisfies $j-i-1\\leq g$. A domain is then a maximal stitched group of enriched bins under this rule, and the span of a domain is the inclusive interval from its smallest enriched index to its largest enriched index.\n\nUsing only this definition and the facts that (i) the genome has $20$ bins labeled $1$ through $20$, (ii) the enriched set is $E$ as given above, and (iii) the allowed gap is $g=1$, determine the stitched domains and report their spans as ordered start–end pairs in ascending genomic order. Express your final answer by concatenating the start–end pairs into a single row vector, with the starts and ends for each domain placed consecutively. Do not perform any rounding and do not include units.", "solution": "The problem requires us to identify stitched domains of enriched genomic bins and report their spans. The total number of bins is $20$, indexed from $1$ to $20$. The set of enriched bin indices is given as $E=\\{2, 3, 4, 7, 8, 12, 13, 14, 15, 19\\}$.\n\nThe rule for stitching two enriched bins at indices $i$ and $j$, where $ij$, is that the number of intervening unenriched bins, given by the expression $j-i-1$, must not exceed a specified gap allowance $g$. In this problem, the gap allowance is $g=1$. Therefore, the condition for stitching is:\n$$j-i-1 \\leq 1$$\nThis inequality can be simplified to:\n$$j-i \\leq 2$$\nThis condition implies that two enriched bins can be stitched together if they are adjacent (i.e., $j-i=1$) or if they are separated by exactly one unenriched bin (i.e., $j-i=2$).\n\nA \"domain\" is defined as a maximal stitched group of enriched bins. We can find these domains by examining the gaps between consecutive enriched bins in the sorted list.\n\nThe sorted list of enriched bin indices is: $2, 3, 4, 7, 8, 12, 13, 14, 15, 19$.\n\nWe will iterate through this list to group the bins into domains.\n\n1.  **First Domain:**\n    - We start with the first enriched bin, index $2$.\n    - Compare with the next enriched bin, index $3$. The difference is $3-2=1$. Since $1 \\leq 2$, bins $2$ and $3$ are stitched.\n    - Compare with the next enriched bin, index $4$. The difference is $4-3=1$. Since $1 \\leq 2$, bins $3$ and $4$ are stitched. By transitivity, the group is now $\\{2, 3, 4\\}$.\n    - Compare with the next enriched bin, index $7$. The difference between the last bin of the current group ($4$) and the new bin ($7$) is $7-4=3$. Since $3 > 2$, bin $7$ cannot be stitched to bin $4$.\n    - This concludes the first domain. The enriched bins in this domain are $\\{2, 3, 4\\}$. The span of a domain is the inclusive interval from its smallest to its largest enriched index. Thus, the span for the first domain is from index $2$ to index $4$. The start-end pair is $(2, 4)$.\n\n2.  **Second Domain:**\n    - We start a new domain with bin $7$.\n    - Compare with the next enriched bin, index $8$. The difference is $8-7=1$. Since $1 \\leq 2$, bins $7$ and $8$ are stitched. The group is $\\{7, 8\\}$.\n    - Compare with the next enriched bin, index $12$. The difference between the last bin of the current group ($8$) and the new bin ($12$) is $12-8=4$. Since $4 > 2$, bin $12$ cannot be stitched to bin $8$.\n    - This concludes the second domain. The enriched bins are $\\{7, 8\\}$. The span is from index $7$ to index $8$. The start-end pair is $(7, 8)$.\n\n3.  **Third Domain:**\n    - We start a new domain with bin $12$.\n    - Compare with the next enriched bin, index $13$. The difference is $13-12=1$. Since $1 \\leq 2$, bins $12$ and $13$ are stitched.\n    - Compare with the next enriched bin, index $14$. The difference is $14-13=1$. Since $1 \\leq 2$, bins $13$ and $14$ are stitched. The group is now $\\{12, 13, 14\\}$.\n    - Compare with the next enriched bin, index $15$. The difference is $15-14=1$. Since $1 \\leq 2$, bins $14$ and $15$ are stitched. The group is now $\\{12, 13, 14, 15\\}$.\n    - Compare with the next enriched bin, index $19$. The difference between the last bin of the current group ($15$) and the new bin ($19$) is $19-15=4$. Since $4 > 2$, bin $19$ cannot be stitched to bin $15$.\n    - This concludes the third domain. The enriched bins are $\\{12, 13, 14, 15\\}$. The span is from index $12$ to index $15$. The start-end pair is $(12, 15)$.\n\n4.  **Fourth Domain:**\n    - We start a new domain with the last remaining enriched bin, index $19$. Since there are no more enriched bins to stitch to, this bin forms a domain by itself.\n    - The enriched bins are $\\{19\\}$. The span is from index $19$ to index $19$. The start-end pair is $(19, 19)$.\n\nThe identified domains and their spans, in ascending genomic order, are:\n- Domain 1: Span $(2, 4)$\n- Domain 2: Span $(7, 8)$\n- Domain 3: Span $(12, 15)$\n- Domain 4: Span $(19, 19)$\n\nThe problem asks for the final answer to be presented by concatenating these start-end pairs into a single row vector. The components of this vector will be the start and end indices of each domain in order.\nVector components: $2, 4, 7, 8, 12, 15, 19, 19$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2  4  7  8  12  15  19  19\n\\end{pmatrix}\n}\n$$", "id": "4545442"}]}