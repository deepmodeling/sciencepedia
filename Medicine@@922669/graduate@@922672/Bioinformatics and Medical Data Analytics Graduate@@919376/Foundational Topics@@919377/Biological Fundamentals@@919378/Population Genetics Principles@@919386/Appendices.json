{"hands_on_practices": [{"introduction": "The Hardy-Weinberg principle provides a baseline expectation for genotype frequencies in a population. A fundamental task in population genetics is to assess whether a real-world sample deviates from this baseline. This first exercise guides you through the standard procedure: calculating allele frequencies from observed genotype counts and applying the Pearson chi-square goodness-of-fit test to quantify any discrepancy [@problem_id:4595871]. Mastering this test is an essential first step in genetic data quality control and a foundational skill for analyzing population-scale genomic data.", "problem": "A biobank-based medical genomics study genotypes a biallelic single-nucleotide polymorphism with alleles $A$ and $a$ in a cohort of $N=500$ unrelated individuals. The observed genotype counts are $n_{AA}=280$, $n_{Aa}=160$, and $n_{aa}=60$. Assume that the underlying sampling mechanism for genotypes is independent across individuals and that, conditional on the allele frequency $p$ of allele $A$ in the population, genotype counts arise from a multinomial sampling model whose cell probabilities are implied by the Hardy–Weinberg equilibrium (HWE) principle of random mating in a large, closed population with no mutation, migration, or selection at the locus.\n\nStarting only from the core definitions that (i) allele frequency is the proportion of alleles carried by the sample, (ii) under HWE the genotype probabilities are functions of $p$ and $q=1-p$ determined by random union of gametes, and (iii) the expected counts under a multinomial model equal the sample size multiplied by the corresponding cell probabilities:\n\n1. Derive the maximum likelihood estimate $\\hat{p}$ of the allele $A$ frequency using the observed genotype counts.\n2. Using $\\hat{p}$, compute the HWE-expected genotype counts for $AA$, $Aa$, and $aa$ in this sample.\n3. Using the Pearson chi-square goodness-of-fit framework for a multinomial model with one fitted parameter, compute the test statistic that compares the observed counts to their HWE-expected counts.\n\nBriefly comment on whether the discrepancy between observed and expected counts is plausibly attributable to sampling variation alone under HWE, or whether it more likely reflects model misfit (for example, inbreeding, population structure, or other departures from HWE). In your comment, ground your reasoning in the scale of the sample and the form of the deviation.\n\nReport only the Pearson chi-square test statistic as your final answer, rounded to $4$ significant figures. Express the final result as a pure number with no units.", "solution": "The problem will be validated by first extracting the given information and then scrutinizing it against established criteria for scientific soundness and completeness.\n\n### Problem Validation\n\n#### Step 1: Extract Givens\n- Sample size: $N=500$ unrelated individuals.\n- Observed genotype counts: $n_{AA}=280$, $n_{Aa}=160$, $n_{aa}=60$.\n- Locus is a biallelic single-nucleotide polymorphism with alleles $A$ and $a$.\n- Allele frequency of $A$ is denoted by $p$.\n- The sampling model is multinomial.\n- The model assumes Hardy–Weinberg equilibrium (HWE), implying genotype probabilities are $P(AA)=p^2$, $P(Aa)=2p(1-p)$, and $P(aa)=(1-p)^2$.\n\n#### Step 2: Validate Using Extracted Givens\n1.  **Scientific or Factual Soundness**: The problem is grounded in the fundamental principles of population genetics, specifically the Hardy–Weinberg equilibrium, and employs standard statistical methodologies (Maximum Likelihood Estimation, Pearson's chi-square test) for parameter estimation and model fitting. The concepts are scientifically sound.\n2.  **Well-Posed**: The problem asks for the calculation of a maximum likelihood estimate, expected counts, and a test statistic. These are well-defined quantities that can be uniquely determined from the provided data and model assumptions.\n3.  **Objective**: The problem is stated using precise, quantitative, and unbiased language.\n4.  **Incomplete or Contradictory Setup**: The given genotype counts sum to the total sample size: $n_{AA} + n_{Aa} + n_{aa} = 280 + 160 + 60 = 500 = N$. The problem provides all necessary information and is internally consistent.\n5.  **Unrealistic or Infeasible**: The observed counts and sample size are realistic for a biobank study. No physical or scientific impossibilities are present.\n\n#### Step 3: Verdict and Action\nThe problem is valid as it is scientifically grounded, well-posed, objective, and internally consistent. A complete solution will now be provided.\n\n### Solution\n\nThe solution is presented in three parts as requested: deriving the maximum likelihood estimate of the allele frequency, calculating the expected genotype counts under HWE, and computing the chi-square test statistic.\n\n#### 1. Derivation of the Maximum Likelihood Estimate (MLE) of $p$\n\nThe problem requires a derivation from first principles. Under the assumption of HWE, the probabilities for genotypes $AA$, $Aa$, and $aa$ are $p^2$, $2pq$, and $q^2$ respectively, where $q = 1-p$. The observed counts $(n_{AA}, n_{Aa}, n_{aa})$ are assumed to follow a multinomial distribution with parameters $N$ and probabilities $(p^2, 2p(1-p), (1-p)^2)$.\n\nThe likelihood function $L(p)$ is proportional to the probability of observing the given data, conditional on the parameter $p$:\n$$L(p | n_{AA}, n_{Aa}, n_{aa}) \\propto (P(AA))^{n_{AA}} (P(Aa))^{n_{Aa}} (P(aa))^{n_{aa}}$$\nSubstituting the HWE probabilities:\n$$L(p) \\propto (p^2)^{n_{AA}} (2p(1-p))^{n_{Aa}} ((1-p)^2)^{n_{aa}}$$\nWe can ignore the constant factor of $2^{n_{Aa}}$ for maximization:\n$$L(p) \\propto p^{2n_{AA}} p^{n_{Aa}} (1-p)^{n_{Aa}} (1-p)^{2n_{aa}}$$\n$$L(p) \\propto p^{2n_{AA} + n_{Aa}} (1-p)^{n_{Aa} + 2n_{aa}}$$\n\nTo find the value of $p$ that maximizes $L(p)$, we work with the log-likelihood function, $\\ell(p) = \\ln(L(p))$:\n$$\\ell(p) = C + (2n_{AA} + n_{Aa})\\ln(p) + (n_{Aa} + 2n_{aa})\\ln(1-p)$$\nwhere $C$ is a constant. We differentiate $\\ell(p)$ with respect to $p$ and set the derivative to zero:\n$$\\frac{d\\ell}{dp} = \\frac{2n_{AA} + n_{Aa}}{p} - \\frac{n_{Aa} + 2n_{aa}}{1-p} = 0$$\nSolving for $p$:\n$$\\frac{2n_{AA} + n_{Aa}}{p} = \\frac{n_{Aa} + 2n_{aa}}{1-p}$$\n$$(1-p)(2n_{AA} + n_{Aa}) = p(n_{Aa} + 2n_{aa})$$\n$$2n_{AA} + n_{Aa} - p(2n_{AA} + n_{Aa}) = p(n_{Aa} + 2n_{aa})$$\n$$2n_{AA} + n_{Aa} = p(2n_{AA} + n_{Aa} + n_{Aa} + 2n_{aa}) = p(2n_{AA} + 2n_{Aa} + 2n_{aa})$$\n$$2n_{AA} + n_{Aa} = p \\cdot 2(n_{AA} + n_{Aa} + n_{aa}) = p \\cdot 2N$$\nThe maximum likelihood estimate, $\\hat{p}$, is therefore:\n$$\\hat{p} = \\frac{2n_{AA} + n_{Aa}}{2N}$$\nThis result confirms that the MLE is equivalent to the allele frequency calculated by direct counting of alleles in the sample.\n\nUsing the given counts ($n_{AA}=280$, $n_{Aa}=160$, $N=500$):\n$$\\hat{p} = \\frac{2(280) + 160}{2(500)} = \\frac{560 + 160}{1000} = \\frac{720}{1000} = 0.72$$\n\n#### 2. HWE-Expected Genotype Counts\n\nUsing the MLE $\\hat{p} = 0.72$, we find the frequency of allele $a$:\n$$\\hat{q} = 1 - \\hat{p} = 1 - 0.72 = 0.28$$\nThe expected genotype proportions under HWE are:\n$$P(AA) = \\hat{p}^2 = (0.72)^2 = 0.5184$$\n$$P(Aa) = 2\\hat{p}\\hat{q} = 2(0.72)(0.28) = 0.4032$$\n$$P(aa) = \\hat{q}^2 = (0.28)^2 = 0.0784$$\nThe expected genotype counts ($E$) in a sample of size $N=500$ are:\n$$E_{AA} = N \\times P(AA) = 500 \\times 0.5184 = 259.2$$\n$$E_{Aa} = N \\times P(Aa) = 500 \\times 0.4032 = 201.6$$\n$$E_{aa} = N \\times P(aa) = 500 \\times 0.0784 = 39.2$$\n\n#### 3. Pearson Chi-Square Test Statistic\n\nThe Pearson chi-square ($\\chi^2$) statistic is calculated as the sum of squared differences between observed ($O$) and expected ($E$) counts, each divided by the expected count:\n$$\\chi^2 = \\sum_{i \\in \\{AA, Aa, aa\\}} \\frac{(O_i - E_i)^2}{E_i}$$\nThe observed counts are $O_{AA}=280$, $O_{Aa}=160$, and $O_{aa}=60$.\n$$\\chi^2 = \\frac{(280 - 259.2)^2}{259.2} + \\frac{(160 - 201.6)^2}{201.6} + \\frac{(60 - 39.2)^2}{39.2}$$\n$$\\chi^2 = \\frac{(20.8)^2}{259.2} + \\frac{(-41.6)^2}{201.6} + \\frac{(20.8)^2}{39.2}$$\n$$\\chi^2 = \\frac{432.64}{259.2} + \\frac{1730.56}{201.6} + \\frac{432.64}{39.2}$$\n$$\\chi^2 \\approx 1.66914 + 8.58413 + 11.03673 \\approx 21.28999$$\nRounding to $4$ significant figures, the test statistic is $21.29$.\n\n#### Commentary on the Result\nThe degrees of freedom for this goodness-of-fit test are given by $df = (\\text{number of genotype categories}) - 1 - (\\text{number of estimated parameters})$. Here, $df = 3 - 1 - 1 = 1$. The critical value for a $\\chi^2$ distribution with $1$ degree of freedom at a conventional significance level of $\\alpha=0.05$ is $3.84$. Our calculated statistic of $\\chi^2 \\approx 21.29$ vastly exceeds this threshold. This indicates that the probability of observing such a large deviation from HWE expectations due to random sampling variation alone is extremely low ($p \\ll 0.001$). Therefore, the discrepancy strongly suggests that the HWE model is a poor fit for the data.\n\nThe form of the deviation provides clues to the underlying cause. We observe a deficit of heterozygotes ($O_{Aa}=160$ vs. $E_{Aa}=201.6$) and a corresponding excess of both homozygote classes ($O_{AA}=280$ vs. $E_{AA}=259.2$ and $O_{aa}=60$ vs. $E_{aa}=39.2$). This specific pattern is the classic signature of processes that increase homozygosity above random-mating expectations, such as inbreeding (consanguineous mating) or population substructure (the Wahlund effect, where the sample is a mixture of distinct subpopulations with different allele frequencies). Given the large sample size, the deviation is not a statistical fluke but rather strong evidence for a violation of one or more HWE assumptions in this population.", "answer": "$$\\boxed{21.29}$$", "id": "4595871"}, {"introduction": "When data deviate from Hardy-Weinberg equilibrium, it's crucial to consider whether the cause is biological, such as inbreeding, or technical. Systematic genotyping errors are a common technical cause of apparent HWE deviations, often producing a characteristic signal of heterozygote deficiency. This theoretical practice challenges you to model such an error process analytically, deriving its precise effect on the chi-square test statistic [@problem_id:4595878]. This exercise builds critical thinking skills for interpreting statistical results and understanding the impact of data quality on downstream analyses.", "problem": "A single nucleotide polymorphism is diallelic with alleles $A$ and $a$. In the true population, the locus is in Hardy–Weinberg equilibrium (HWE), i.e., genotype frequencies are $A A$ with probability $p^{2}$, $A a$ with probability $2 p q$, and $a a$ with probability $q^{2}$, where $p$ is the true allele frequency of $A$ and $q = 1 - p$ is the true allele frequency of $a$. A bioinformatics pipeline calling genotypes from high-throughput data introduces a systematic genotyping error that affects only true heterozygotes: independently for each $A a$ individual, with probability $\\epsilon$ the heterozygote is miscalled as a homozygote, and conditional on a miscall, the reported homozygote is $A A$ with probability $1/2$ and $a a$ with probability $1/2$. True homozygotes $A A$ and $a a$ are never miscalled. Assume a sample of size $N$ drawn from the population, ignore sampling variance by working with expected counts under the above model, and assume the Hardy–Weinberg test uses the Pearson chi-square statistic comparing observed genotype counts to HWE-expected counts computed from the allele frequency estimated from the observed data.\n\nStarting from the fundamental definition of Hardy–Weinberg equilibrium and the definition of the Pearson chi-square test, derive closed-form analytical expressions for:\n- the expected observed heterozygosity (the proportion of individuals observed as heterozygotes) as a function of $p$, $q$, and $\\epsilon$; and\n- the asymptotic expected value of the Pearson chi-square Hardy–Weinberg test statistic under the stated error model, as a function of $N$ and $\\epsilon$.\n\nProvide exact expressions; do not round. Your final answer must be a single row matrix containing the two expressions in the order specified above.", "solution": "The problem statement has been analyzed and is deemed valid. It is scientifically grounded in population genetics and statistics, is well-posed, objective, and contains all necessary information for a unique solution. We may therefore proceed with a formal derivation.\n\nLet $p$ be the true frequency of allele $A$ and $q=1-p$ be the true frequency of allele $a$. In the true population, which is in Hardy–Weinberg equilibrium (HWE), the genotype frequencies are:\n- True $AA$: $P_{true}(AA) = p^2$\n- True $Aa$: $P_{true}(Aa) = 2pq$\n- True $aa$: $P_{true}(aa) = q^2$\n\nThe problem describes a systematic genotyping error model. We can define the conditional probabilities of the observed genotype given the true genotype. Let $G_{obs}$ be the observed genotype and $G_{true}$ be the true genotype.\n- True homozygotes are never miscalled:\n  $P(G_{obs}=AA | G_{true}=AA) = 1$\n  $P(G_{obs}=aa | G_{true}=aa) = 1$\n  $P(G_{obs} \\neq AA | G_{true}=AA) = 0$\n  $P(G_{obs} \\neq aa | G_{true}=aa) = 0$\n- True heterozygotes ($Aa$) are miscalled with probability $\\epsilon$:\n  The probability of observing $Aa$ given a true $Aa$ is the probability of no miscall:\n  $P(G_{obs}=Aa | G_{true}=Aa) = 1 - \\epsilon$\n  Conditional on a miscall (which occurs with probability $\\epsilon$), the reported genotype is $AA$ with probability $1/2$ and $aa$ with probability $1/2$. Therefore:\n  $P(G_{obs}=AA | G_{true}=Aa) = \\epsilon \\times \\frac{1}{2} = \\frac{\\epsilon}{2}$\n  $P(G_{obs}=aa | G_{true}=Aa) = \\epsilon \\times \\frac{1}{2} = \\frac{\\epsilon}{2}$\n\nUsing the law of total probability, we can calculate the expected frequencies of the observed genotypes, denoted $P_{obs}(G_{obs})$.\n$P_{obs}(G_{obs}) = \\sum_{G_{true} \\in \\{AA, Aa, aa\\}} P(G_{obs} | G_{true}) P_{true}(G_{true})$\n\nFor observed $AA$:\n$P_{obs}(AA) = P(AA|AA)P_{true}(AA) + P(AA|Aa)P_{true}(Aa) + P(AA|aa)P_{true}(aa)$\n$P_{obs}(AA) = (1)(p^2) + (\\frac{\\epsilon}{2})(2pq) + (0)(q^2) = p^2 + pq\\epsilon$\n\nFor observed $Aa$:\n$P_{obs}(Aa) = P(Aa|AA)P_{true}(AA) + P(Aa|Aa)P_{true}(Aa) + P(Aa|aa)P_{true}(aa)$\n$P_{obs}(Aa) = (0)(p^2) + (1-\\epsilon)(2pq) + (0)(q^2) = 2pq(1-\\epsilon)$\n\nFor observed $aa$:\n$P_{obs}(aa) = P(aa|AA)P_{true}(AA) + P(aa|Aa)P_{true}(Aa) + P(aa|aa)P_{true}(aa)$\n$P_{obs}(aa) = (0)(p^2) + (\\frac{\\epsilon}{2})(2pq) + (1)(q^2) = q^2 + pq\\epsilon$\n\nAs a consistency check, the sum of observed frequencies is:\n$(p^2 + pq\\epsilon) + 2pq(1-\\epsilon) + (q^2 + pq\\epsilon) = p^2 + 2pq + q^2 + pq\\epsilon - 2pq\\epsilon + pq\\epsilon = (p+q)^2 = 1$.\n\nThe first part of the problem asks for the expected observed heterozygosity. This is the expected proportion of individuals observed as heterozygotes, which is $P_{obs}(Aa)$.\nExpected observed heterozygosity $= 2pq(1-\\epsilon)$.\n\nThe second part of the problem asks for the asymptotic expected value of the Pearson chi-square statistic. The statistic is given by $\\chi^2 = \\sum_i \\frac{(O_i - E_i)^2}{E_i}$, where $O_i$ are the observed genotype counts and $E_i$ are the expected genotype counts under HWE. The problem specifies to work with expected counts, which means we replace the random observed counts with their expected values based on a sample of size $N$.\n$O_{AA} = N \\cdot P_{obs}(AA) = N(p^2 + pq\\epsilon)$\n$O_{Aa} = N \\cdot P_{obs}(Aa) = N(2pq(1-\\epsilon))$\n$O_{aa} = N \\cdot P_{obs}(aa) = N(q^2 + pq\\epsilon)$\n\nThe expected counts $E_i$ are calculated under the HWE assumption, using allele frequencies estimated from the *observed* data. Let the observed allele frequency of $A$ be $p'_{obs}$. This is calculated from the observed genotype frequencies:\n$p'_{obs} = P_{obs}(AA) + \\frac{1}{2} P_{obs}(Aa)$\n$p'_{obs} = (p^2 + pq\\epsilon) + \\frac{1}{2} (2pq(1-\\epsilon))$\n$p'_{obs} = p^2 + pq\\epsilon + pq - pq\\epsilon$\n$p'_{obs} = p^2 + pq = p(p+q) = p(1) = p$\n\nRemarkably, the observed allele frequency $p'_{obs}$ is an unbiased estimator of the true allele frequency $p$. Consequently, the observed frequency of allele $a$ is $q'_{obs} = 1 - p'_{obs} = 1 - p = q$.\n\nNow we can calculate the HWE-expected counts $E_i$ based on $p'_{obs}=p$ and $q'_{obs}=q$ for a sample of size $N$:\n$E_{AA} = N (p'_{obs})^2 = Np^2$\n$E_{Aa} = N \\cdot 2 p'_{obs} q'_{obs} = N \\cdot 2pq$\n$E_{aa} = N (q'_{obs})^2 = Nq^2$\n\nWe now compute the terms $(O_i - E_i)$:\n$O_{AA} - E_{AA} = N(p^2 + pq\\epsilon) - Np^2 = Npq\\epsilon$\n$O_{Aa} - E_{Aa} = N(2pq(1-\\epsilon)) - N(2pq) = 2Npq - 2Npq\\epsilon - 2Npq = -2Npq\\epsilon$\n$O_{aa} - E_{aa} = N(q^2 + pq\\epsilon) - Nq^2 = Npq\\epsilon$\n\nThe sum of these differences is $Npq\\epsilon - 2Npq\\epsilon + Npq\\epsilon = 0$, as expected. Finally, we compute the asymptotic expected value of the chi-square statistic by substituting these values into the formula:\n$\\chi^2 = \\frac{(O_{AA} - E_{AA})^2}{E_{AA}} + \\frac{(O_{Aa} - E_{Aa})^2}{E_{Aa}} + \\frac{(O_{aa} - E_{aa})^2}{E_{aa}}$\n$\\chi^2 = \\frac{(Npq\\epsilon)^2}{Np^2} + \\frac{(-2Npq\\epsilon)^2}{N(2pq)} + \\frac{(Npq\\epsilon)^2}{Nq^2}$\n$\\chi^2 = \\frac{N^2p^2q^2\\epsilon^2}{Np^2} + \\frac{4N^2p^2q^2\\epsilon^2}{2Npq} + \\frac{N^2p^2q^2\\epsilon^2}{Nq^2}$\n$\\chi^2 = Nq^2\\epsilon^2 + 2Npq\\epsilon^2 + Np^2\\epsilon^2$\nFactoring out the common terms $N\\epsilon^2$:\n$\\chi^2 = N\\epsilon^2 (q^2 + 2pq + p^2)$\nSince $p^2 + 2pq + q^2 = (p+q)^2 = 1^2 = 1$, the expression simplifies to:\n$\\chi^2 = N\\epsilon^2$\n\nThis is the asymptotic expected value of the Pearson chi-square statistic under the specified error model.\n\nThe two required expressions are:\n1. Expected observed heterozygosity: $2pq(1-\\epsilon)$\n2. Asymptotic expected value of the Pearson chi-square statistic: $N\\epsilon^2$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2pq(1-\\epsilon)  N\\epsilon^{2}\n\\end{pmatrix}\n}\n$$", "id": "4595878"}, {"introduction": "The chi-square test, while widely used, relies on large-sample approximations that become unreliable for loci with rare alleles—a common scenario in modern sequencing studies. For these cases, an exact test based on the conditional distribution of genotypes is the statistically rigorous approach. This capstone exercise moves from theory to practice, requiring you to implement the HWE exact test from first principles [@problem_id:4595920]. By deriving the conditional probability distribution and handling the computational details, you will develop a robust tool and a deep understanding of its statistical foundation, including the distinction between standard and mid-$P$ values.", "problem": "You are to implement an exact conditional test for Hardy–Weinberg equilibrium (HWE) at a single biallelic locus. The test must condition on the observed allele count and enumerate the distribution of heterozygote counts under the null hypothesis of HWE. The setting is a diploid sample of $n$ individuals with genotype counts $n_{\\text{AA}}$, $n_{\\text{Aa}}$, and $n_{\\text{aa}}$, where the two alleles are denoted by $\\text{A}$ and $\\text{a}$, and $n_{\\text{AA}} + n_{\\text{Aa}} + n_{\\text{aa}} = n$. The null hypothesis is that the population is in Hardy–Weinberg equilibrium (HWE), meaning random mating and no forces such as selection, mutation, migration, or genotyping error that would alter genotype frequencies beyond those generated by allele frequencies alone.\n\nFundamental base: Under HWE, genotype frequencies in the population are determined only by allele frequencies, and in a sample they follow a multinomial model. When conditioning on the observed allele count $n_{\\text{A}} = 2 n_{\\text{AA}} + n_{\\text{Aa}}$ of allele $\\text{A}$ among the $2n$ gene copies, the distribution of how these $n_{\\text{A}}$ copies are paired into $n$ diploid genotypes is governed by random pairing of gene copies. All pairings of $2n$ gene copies into $n$ unordered pairs are equally likely under random mating.\n\nTask requirements:\n- Starting from the above definitions and assumptions, derive the admissible set of heterozygote counts $h$ that are compatible with the fixed allele count $n_{\\text{A}}$ and the sample size $n$, and derive the conditional probability mass function for the heterozygote count $H$ under HWE, that is, the probability $\\Pr(H = h \\mid n_{\\text{A}}, n)$ for each admissible $h$.\n- Implement a program that, for each test case, computes:\n  1. The exact two-sided p-value based on the probability metric, defined as the sum of probabilities of all admissible outcomes whose probability under the null is less than or equal to the probability of the observed heterozygote count $h_{\\text{obs}}$. Formally, if $p(h)$ denotes $\\Pr(H = h \\mid n_{\\text{A}}, n)$, compute $\\sum_{h : p(h) \\leq p(h_{\\text{obs}})} p(h)$ as a real number in $[0,1]$.\n  2. The corresponding mid-$P$ two-sided p-value, defined as $\\sum_{h : p(h)  p(h_{\\text{obs}})} p(h) + \\tfrac{1}{2} p(h_{\\text{obs}})$, expressed as a real number in $[0,1]$.\n- Both p-values must be returned as decimal numbers for each test case, not as percentages.\n\nDesign details:\n- Use the random mating principle to derive the conditional distribution by enumerating all feasible heterozygote counts $h$ subject to the constraints implied by $n_{\\text{A}}$ and $n$, and count the number of equiprobable allocations that yield a given $h$. Do not use asymptotic approximations; the computation must be exact up to machine precision by working in the log-domain to avoid numerical overflow.\n- Ensure that the program handles degenerate cases correctly, including monomorphic samples where all gene copies are the same allele. Note that due to the discrete nature of the distribution, the exact two-sided p-value is conservative, and the mid-$P$ value may be preferable in some contexts; your solution should explain when this is the case.\n\nTest suite:\nProvide results for the following five test cases, each specified by $(n_{\\text{AA}}, n_{\\text{Aa}}, n_{\\text{aa}})$:\n1. $(30, 10, 10)$ with $n = 50$ and $n_{\\text{A}} = 2 \\cdot 30 + 10 = 70$.\n2. $(0, 10, 0)$ with $n = 10$ and $n_{\\text{A}} = 2 \\cdot 0 + 10 = 10$.\n3. $(20, 0, 0)$ with $n = 20$ and $n_{\\text{A}} = 2 \\cdot 20 + 0 = 40$ (monomorphic).\n4. $(1, 3, 1)$ with $n = 5$ and $n_{\\text{A}} = 2 \\cdot 1 + 3 = 5$.\n5. $(40, 4, 6)$ with $n = 50$ and $n_{\\text{A}} = 2 \\cdot 40 + 4 = 84$.\n\nFinal output format:\nYour program should produce a single line of output containing, for the five test cases in order, the exact two-sided p-values and the mid-$P$ two-sided p-values, flattened into a single list. That is, the output must be a single Python-style list in the form $[p_{1,\\text{exact}}, p_{1,\\text{mid}}, p_{2,\\text{exact}}, p_{2,\\text{mid}}, p_{3,\\text{exact}}, p_{3,\\text{mid}}, p_{4,\\text{exact}}, p_{4,\\text{mid}}, p_{5,\\text{exact}}, p_{5,\\text{mid}}]$, where each entry is a real number in $[0,1]$.", "solution": "We begin from the Hardy–Weinberg equilibrium (HWE) principle. Under HWE, genotype frequencies are determined by allele frequencies, and in a finite sample the genotype counts follow a multinomial distribution based on those frequencies. When conditioning on the observed allele count $n_{\\text{A}}$ among the $2n$ gene copies, the random mating assumption implies that all allocations of $n_{\\text{A}}$ copies of allele $\\text{A}$ into the $2n$ gene-copy slots are equally likely, and the gene copies are paired uniformly at random into $n$ unordered diploid genotypes. Therefore, the conditional distribution of genotype counts given $n_{\\text{A}}$ arises from counting the number of equiprobable pairings that result in a given configuration.\n\nLet the observed genotypes be $n_{\\text{AA}}$, $n_{\\text{Aa}}$, and $n_{\\text{aa}}$, with $n_{\\text{AA}} + n_{\\text{Aa}} + n_{\\text{aa}} = n$ and $n_{\\text{A}} = 2 n_{\\text{AA}} + n_{\\text{Aa}}$. Under the conditional framework, it is sufficient to consider the heterozygote count $H = n_{\\text{Aa}}$. For any fixed $n$ and $n_{\\text{A}}$, the heterozygote count $h$ determines the homozygote counts uniquely:\n$$\nn_{\\text{AA}}(h) = \\frac{n_{\\text{A}} - h}{2}, \\quad n_{\\text{aa}}(h) = \\frac{2n - n_{\\text{A}} - h}{2}.\n$$\nThese must be nonnegative integers, which imposes the following constraints on $h$:\n1. $h$ must be an integer with the same parity as $n_{\\text{A}}$ (so that $n_{\\text{A}} - h$ and $2n - n_{\\text{A}} - h$ are even).\n2. $0 \\leq h \\leq \\min(n_{\\text{A}}, 2n - n_{\\text{A}})$ (to ensure $n_{\\text{AA}}(h) \\geq 0$ and $n_{\\text{aa}}(h) \\geq 0$).\n\nHence, the admissible set of $h$ values is\n$$\n\\mathcal{H} = \\{ h \\in \\mathbb{Z} : h \\equiv n_{\\text{A}} \\ (\\text{mod } 2), \\ 0 \\leq h \\leq \\min(n_{\\text{A}}, 2n - n_{\\text{A}}) \\}.\n$$\nUnder random mating and conditioning on $n_{\\text{A}}$, all allocations of the $n_{\\text{A}}$ copies of allele $\\text{A}$ among the $2n$ slots are equally likely, so the total number of allocations is $\\binom{2n}{n_{\\text{A}}}$. For a given admissible $h$, the number of allocations that produce exactly $n_{\\text{AA}}(h)$ $\\text{AA}$ homozygotes, $h$ heterozygotes, and $n_{\\text{aa}}(h)$ $\\text{aa}$ homozygotes is\n$$\nW(h) = \\frac{n!}{n_{\\text{AA}}(h)! \\, h! \\, n_{\\text{aa}}(h)!} \\cdot 2^{h}.\n$$\nThe factor $2^{h}$ accounts for the fact that each heterozygous genotype $\\text{Aa}$ can be formed by two different allocations of an $\\text{A}$ gene copy and an $\\text{a}$ gene copy within the pair, whereas homozygote pairs have only one allocation. Therefore, the conditional probability mass function under HWE for $H$ given $n_{\\text{A}}$ and $n$ is\n$$\np(h) = \\Pr(H = h \\mid n, n_{\\text{A}}) = \\frac{W(h)}{\\sum_{h' \\in \\mathcal{H}} W(h')},\n$$\nwhich can equivalently be written as $p(h) = W(h) / \\binom{2n}{n_{\\text{A}}}$, but computing via $W(h)$ normalized by the sum $\\sum_{h' \\in \\mathcal{H}} W(h')$ is numerically stable and avoids direct manipulation of very large binomial coefficients.\n\nGiven an observed heterozygote count $h_{\\text{obs}} = n_{\\text{Aa}}$, the exact two-sided p-value based on the probability metric (often recommended to avoid ambiguity in tail selection for two-sided tests in discrete settings) is computed as\n$$\np_{\\text{exact}} = \\sum_{h \\in \\mathcal{H} : p(h) \\leq p(h_{\\text{obs}})} p(h).\n$$\nThe mid-$P$ two-sided p-value is defined to reduce the conservativeness induced by discreteness:\n$$\np_{\\text{mid}} = \\sum_{h \\in \\mathcal{H} : p(h)  p(h_{\\text{obs}})} p(h) + \\frac{1}{2} p(h_{\\text{obs}}) = p_{\\text{exact}} - \\frac{1}{2} p(h_{\\text{obs}}).\n$$\nBoth $p_{\\text{exact}}$ and $p_{\\text{mid}}$ lie in $[0,1]$, though $p_{\\text{mid}}$ can be strictly smaller than $p_{\\text{exact}}$. In the degenerate case where $\\mathcal{H}$ contains a single value (for example, a monomorphic sample), one has $p(h_{\\text{obs}}) = 1$, which yields $p_{\\text{exact}} = 1$ and $p_{\\text{mid}} = \\tfrac{1}{2}$.\n\nAlgorithmic design:\n1. For each test case, compute $n = n_{\\text{AA}} + n_{\\text{Aa}} + n_{\\text{aa}}$, $n_{\\text{A}} = 2 n_{\\text{AA}} + n_{\\text{Aa}}$, and $h_{\\text{obs}} = n_{\\text{Aa}}$.\n2. Enumerate $\\mathcal{H}$ using parity and bounds: set $h_{\\min}$ to $0$ if $n_{\\text{A}}$ is even or $1$ if $n_{\\text{A}}$ is odd, and $h_{\\max} = \\min(n_{\\text{A}}, 2n - n_{\\text{A}})$, then list $h$ from $h_{\\min}$ to $h_{\\max}$ in steps of $2$.\n3. For each $h \\in \\mathcal{H}$, compute $n_{\\text{AA}}(h)$ and $n_{\\text{aa}}(h)$, then compute $\\log W(h)$ using the log-factorial identity $\\log(k!) = \\log\\Gamma(k+1)$ to avoid overflow. Specifically,\n$$\n\\log W(h) = \\log(n!) - \\log(n_{\\text{AA}}(h)!) - \\log(h!) - \\log(n_{\\text{aa}}(h)!) + h \\log 2.\n$$\n4. Normalize to obtain $p(h)$ via a log-sum-exp computation: if $\\ell(h) = \\log W(h)$, then\n$$\np(h) = \\exp\\left(\\ell(h) - \\log\\left(\\sum_{h' \\in \\mathcal{H}} \\exp(\\ell(h'))\\right)\\right),\n$$\nwhich is implemented stably using the standard $\\log$-sum-exp trick.\n5. Compute $p_{\\text{exact}}$ by summing $p(h)$ for all $h$ with $p(h) \\leq p(h_{\\text{obs}})$, and compute $p_{\\text{mid}} = p_{\\text{exact}} - \\tfrac{1}{2} p(h_{\\text{obs}})$.\n6. Return the pair $(p_{\\text{exact}}, p_{\\text{mid}})$ for each test case.\n\nWhen mid-$P$ is preferable:\nMid-$P$ is often preferable in large-scale discrete testing contexts where exact p-values are overly conservative due to the discreteness of the test statistic. In population-genetic analyses across many loci (for example, genome-wide association studies or quality control of genotypes), the conservative nature of exact tests can reduce power to detect genuine deviations from HWE, particularly heterozygote deficiencies suggestive of genotyping errors or inbreeding. Mid-$P$ reduces this conservativeness by effectively splitting the probability mass of the observed outcome, providing better calibration of type I error rates and increased power while retaining the exact finite-sample enumeration. However, mid-$P$ is not uniformly conservative and may not be appropriate for interval estimation contexts or when strict control of the family-wise error rate is required in small samples. In degenerate cases with a single admissible outcome (for example, monomorphic data), mid-$P$ yields $0.5$, whereas the exact p-value is $1.0$, underscoring that mid-$P$ should be interpreted with care in such boundary conditions.\n\nThe final program implements the above algorithm and outputs a single flat list of the exact two-sided and mid-$P$ two-sided p-values for the specified test suite, in the required one-line format.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gammaln, logsumexp\n\ndef hwe_exact_pvalues(n_AA, n_Aa, n_aa):\n    \"\"\"\n    Compute the exact two-sided probability-based p-value and mid-P p-value\n    for Hardy–Weinberg equilibrium by conditioning on the allele count and\n    enumerating the distribution of heterozygotes.\n\n    Parameters:\n        n_AA (int): Count of AA homozygotes\n        n_Aa (int): Count of Aa heterozygotes\n        n_aa (int): Count of aa homozygotes\n\n    Returns:\n        (float, float): (p_exact_two_sided, p_mid_two_sided)\n    \"\"\"\n    n = n_AA + n_Aa + n_aa\n    n_A = 2 * n_AA + n_Aa\n    h_obs = n_Aa\n\n    # Determine admissible heterozygote counts h with correct parity and bounds.\n    h_min = n_A % 2  # 0 if even, 1 if odd\n    h_max = min(n_A, 2 * n - n_A)\n    if h_min  h_max:\n        # No admissible configurations: should not happen with valid counts, but guard anyway.\n        return (1.0, 0.5)\n\n    # Enumerate admissible h values: step of 2 to respect parity.\n    H_vals = np.arange(h_min, h_max + 1, 2, dtype=int)\n\n    # Compute log-weights log W(h) using gammaln for log-factorials: log(k!) = gammaln(k+1).\n    log_weights = []\n    for h in H_vals:\n        n_AA_h = (n_A - h) // 2\n        n_aa_h = (2 * n - n_A - h) // 2\n        # Sanity checks: nonnegative integers\n        if n_AA_h  0 or n_aa_h  0:\n            log_weights.append(-np.inf)\n            continue\n        # log W(h) = log(n!) - log(n_AA_h!) - log(h!) - log(n_aa_h!) + h * log(2)\n        lw = (gammaln(n + 1)\n              - gammaln(n_AA_h + 1)\n              - gammaln(h + 1)\n              - gammaln(n_aa_h + 1)\n              + h * np.log(2.0))\n        log_weights.append(lw)\n    log_weights = np.array(log_weights, dtype=float)\n\n    # Convert to probabilities via log-sum-exp normalization.\n    logZ = logsumexp(log_weights)\n    # Handle degenerate cases where all log_weights are -inf (should not happen)\n    if not np.isfinite(logZ):\n        # Return neutral values\n        return (1.0, 0.5)\n\n    probs = np.exp(log_weights - logZ)\n\n    # Find observed probability p(h_obs).\n    # h_obs must be in H_vals; if not, the configuration is impossible under the conditioning.\n    try:\n        idx_obs = int(np.where(H_vals == h_obs)[0][0])\n    except IndexError:\n        # Impossible observed h under the conditioning; return extreme p-values.\n        # This should not occur with internally consistent inputs.\n        return (0.0, 0.0)\n\n    p_obs = probs[idx_obs]\n\n    # Exact two-sided probability-based p-value: sum of probs = p_obs.\n    p_exact = float(np.sum(probs[probs = p_obs]))\n\n    # Mid-P two-sided p-value: subtract half of the observed probability mass.\n    p_mid = p_exact - 0.5 * p_obs\n\n    # Numerical safety: clip to [0,1]\n    p_exact = min(max(p_exact, 0.0), 1.0)\n    p_mid = min(max(p_mid, 0.0), 1.0)\n\n    return (p_exact, p_mid)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple is (n_AA, n_Aa, n_aa)\n    test_cases = [\n        (30, 10, 10),  # n=50, n_A=70\n        (0, 10, 0),    # n=10, n_A=10 (maximum heterozygosity)\n        (20, 0, 0),    # n=20, n_A=40 (monomorphic)\n        (1, 3, 1),     # n=5,  n_A=5 (odd parity case)\n        (40, 4, 6),    # n=50, n_A=84 (heterozygote deficiency)\n    ]\n\n    results = []\n    for n_AA, n_Aa, n_aa in test_cases:\n        p_exact, p_mid = hwe_exact_pvalues(n_AA, n_Aa, n_aa)\n        results.append(p_exact)\n        results.append(p_mid)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4595920"}]}