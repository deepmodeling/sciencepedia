{"hands_on_practices": [{"introduction": "Identifying the short, variable DNA sequences where transcription factors bind is a fundamental challenge in genomics. This practice introduces the Position Weight Matrix (PWM), a powerful probabilistic model for representing these binding motifs. By deriving and applying a log-odds scoring system [@problem_id:4560143], you will learn how to quantitatively distinguish potential regulatory sites from the genomic background, a core skill in analyzing regulatory elements.", "problem": "A candidate transcription factor binding site motif implicated in insulator function within epigenetic regulation of chromatin architecture is modeled from high-confidence peaks derived from Chromatin Immunoprecipitation followed by sequencing (ChIP-seq). The motif is represented by a Position Weight Matrix (PWM), formally the matrix of position-specific multinomial parameters $P=\\{p_{i,b}\\}$ of length $L$ over nucleotides $b \\in \\{\\mathrm{A},\\mathrm{C},\\mathrm{G},\\mathrm{T}\\}$, where each position $i \\in \\{1,\\dots,L\\}$ satisfies $\\sum_{b} p_{i,b} = 1$ and $p_{i,b} \\ge 0$. The genomic background is modeled as an independent and identically distributed multinomial with probabilities $q=\\{q_{\\mathrm{A}}, q_{\\mathrm{C}}, q_{\\mathrm{G}}, q_{\\mathrm{T}}\\}$ satisfying $\\sum_{b} q_{b} = 1$.\n\nFrom first principles, define the Position Weight Matrix (PWM) and the positional information content under a general background as the Kullback-Leibler divergence (KLD) between the motif position distribution and the background. Then, starting from the likelihood of a sequence under the PWM and the background models and invoking the standard position-independence assumption for transcription factor binding motifs, derive the log-likelihood ratio scoring function. Finally, compute the log-odds motif score for the following instance using the natural logarithm.\n\nUse the nucleotide order $(\\mathrm{A}, \\mathrm{C}, \\mathrm{G}, \\mathrm{T})$ for both the PWM and background. Let the motif length be $L=8$ and the PWM be\n$$\nP \\;=\\; \\begin{pmatrix}\n0.05 & 0.10 & 0.75 & 0.10 \\\\\n0.10 & 0.60 & 0.20 & 0.10 \\\\\n0.05 & 0.10 & 0.80 & 0.05 \\\\\n0.10 & 0.10 & 0.20 & 0.60 \\\\\n0.65 & 0.10 & 0.15 & 0.10 \\\\\n0.15 & 0.10 & 0.65 & 0.10 \\\\\n0.10 & 0.70 & 0.10 & 0.10 \\\\\n0.55 & 0.15 & 0.15 & 0.15\n\\end{pmatrix}.\n$$\nLet the genomic background be\n$$\nq \\;=\\; (0.30,\\, 0.20,\\, 0.22,\\, 0.28).\n$$\nConsider the length-$8$ sequence\n$$\n\\mathbf{b} \\;=\\; (\\mathrm{G},\\, \\mathrm{C},\\, \\mathrm{G},\\, \\mathrm{T},\\, \\mathrm{A},\\, \\mathrm{G},\\, \\mathrm{C},\\, \\mathrm{A}).\n$$\n\nCompute the natural-logarithm log-odds motif score of $\\mathbf{b}$ under $P$ relative to $q$, expressed in nats, and round your answer to $4$ significant figures. Your final reported value must be a single real number.", "solution": "The problem requires a three-part response: a theoretical definition of the Position Weight Matrix (PWM) and positional information content, a derivation of the log-likelihood ratio scoring function, and a specific calculation for a given DNA sequence, PWM, and background model.\n\n### Problem Validation\n\nFirst, the validity of the problem statement is assessed.\n\n1.  **Extract Givens**:\n    *   A Position Weight Matrix (PWM) is a matrix of position-specific multinomial parameters $P=\\{p_{i,b}\\}$ for a motif of length $L$ over nucleotides $b \\in \\{\\mathrm{A},\\mathrm{C},\\mathrm{G},\\mathrm{T}\\}$.\n    *   For each position $i \\in \\{1,\\dots,L\\}$, the probabilities sum to unity: $\\sum_{b} p_{i,b} = 1$ and are non-negative: $p_{i,b} \\ge 0$.\n    *   The genomic background is an independent and identically distributed (i.i.d.) multinomial model with probabilities $q=\\{q_{\\mathrm{A}}, q_{\\mathrm{C}}, q_{\\mathrm{G}}, q_{\\mathrm{T}}\\}$ where $\\sum_{b} q_{b} = 1$.\n    *   The nucleotide order is specified as $(\\mathrm{A}, \\mathrm{C}, \\mathrm{G}, \\mathrm{T})$.\n    *   The motif length is $L=8$.\n    *   The PWM is given as:\n        $$\n        P \\;=\\; \\begin{pmatrix}\n        0.05 & 0.10 & 0.75 & 0.10 \\\\\n        0.10 & 0.60 & 0.20 & 0.10 \\\\\n        0.05 & 0.10 & 0.80 & 0.05 \\\\\n        0.10 & 0.10 & 0.20 & 0.60 \\\\\n        0.65 & 0.10 & 0.15 & 0.10 \\\\\n        0.15 & 0.10 & 0.65 & 0.10 \\\\\n        0.10 & 0.70 & 0.10 & 0.10 \\\\\n        0.55 & 0.15 & 0.15 & 0.15\n        \\end{pmatrix}.\n        $$\n    *   The background nucleotide probabilities are $q = (0.30, 0.20, 0.22, 0.28)$.\n    *   The specific DNA sequence to be scored is $\\mathbf{b} = (\\mathrm{G}, \\mathrm{C}, \\mathrm{G}, \\mathrm{T}, \\mathrm{A}, \\mathrm{G}, \\mathrm{C}, \\mathrm{A})$.\n    *   The task is to compute the natural-logarithm log-odds motif score, rounded to $4$ significant figures.\n\n2.  **Validate Using Extracted Givens**:\n    *   **Scientific and Factual Soundness**: The problem is based on cornerstone concepts in bioinformatics for modeling transcription factor binding sites, including PWMs, background models, and log-odds scoring. These are standard and well-established methods.\n    *   **Completeness and Consistency**: The problem is self-contained. The PWM matrix rows correctly sum to $1$. For instance, for row $1$: $0.05 + 0.10 + 0.75 + 0.10 = 1.00$. This holds for all $8$ rows. The background probabilities also sum to $1$: $0.30 + 0.20 + 0.22 + 0.28 = 1.00$. The dimensions of the PWM ($8 \\times 4$) are consistent with the motif length ($L=8$) and the alphabet size ($4$ nucleotides). All data required for the calculation are provided.\n    *   **Well-Posedness**: The problem asks for a calculation based on well-defined mathematical formulas. A unique, stable, and meaningful solution exists.\n\n3.  **Verdict**: The problem is valid.\n\n### Part 1: Definitions from First Principles\n\nA **Position Weight Matrix (PWM)**, denoted as $P$, is a probabilistic model representing a sequence motif of a fixed length $L$. It is an $L \\times k$ matrix, where $k$ is the size of the alphabet (here, $k=4$ for DNA nucleotides $\\{\\mathrm{A},\\mathrm{C},\\mathrm{G},\\mathrm{T}\\}$). Each element $p_{i,b}$ of the matrix specifies the probability of observing nucleotide $b$ at position $i$ of the motif. This model assumes independence between positions. For each position $i \\in \\{1, \\dots, L\\}$, the set of probabilities $\\{p_{i,b}\\}_{b \\in \\{\\mathrm{A,C,G,T}\\}}$ forms a multinomial distribution, so $\\sum_{b} p_{i,b} = 1$ and $p_{i,b} \\ge 0$.\n\nThe **positional information content** at position $i$, denoted $I_i$, quantifies the conservation of that position. It measures the reduction in uncertainty about the nucleotide at position $i$ relative to the background distribution $q$. This is formally defined as the Kullback-Leibler divergence (KLD) from the background distribution $q$ to the motif's positional distribution $p_{i,\\cdot} = (p_{i,\\mathrm{A}}, p_{i,\\mathrm{C}}, p_{i,\\mathrm{G}}, p_{i,\\mathrm{T}})$. Using the natural logarithm, the information content in units of nats is:\n$$\nI_i = D_{\\mathrm{KL}}(p_{i,\\cdot} || q) = \\sum_{b \\in \\{\\mathrm{A,C,G,T}\\}} p_{i,b} \\ln\\left(\\frac{p_{i,b}}{q_b}\\right)\n$$\n\n### Part 2: Derivation of the Log-Likelihood Ratio Scoring Function\n\nTo distinguish true motif instances from background DNA, we formulate a hypothesis test. Let $\\mathbf{b} = (b_1, b_2, \\dots, b_L)$ be a DNA sequence of length $L$.\n\n*   **Hypothesis $M$ (Motif model)**: The sequence $\\mathbf{b}$ was generated by the motif model $P$.\n*   **Hypothesis $B$ (Background model)**: The sequence $\\mathbf{b}$ was generated by the background model $q$.\n\nUnder the assumption of positional independence inherent to the PWM model, the likelihood of observing sequence $\\mathbf{b}$ under hypothesis $M$ is the product of the probabilities of observing each base $b_i$ at its corresponding position $i$:\n$$\n\\mathbb{P}(\\mathbf{b} | M) = \\prod_{i=1}^{L} p_{i, b_i}\n$$\nUnder the i.i.d. background model, the likelihood of observing sequence $\\mathbf{b}$ under hypothesis $B$ is the product of the background probabilities for each base:\n$$\n\\mathbb{P}(\\mathbf{b} | B) = \\prod_{i=1}^{L} q_{b_i}\n$$\nThe **likelihood ratio** compares these two probabilities:\n$$\n\\frac{\\mathbb{P}(\\mathbf{b} | M)}{\\mathbb{P}(\\mathbf{b} | B)} = \\frac{\\prod_{i=1}^{L} p_{i, b_i}}{\\prod_{i=1}^{L} q_{b_i}} = \\prod_{i=1}^{L} \\frac{p_{i, b_i}}{q_{b_i}}\n$$\nFor numerical stability and additive properties, we take the logarithm of this ratio. This gives the **log-likelihood ratio** or **log-odds score**, $S(\\mathbf{b})$. Using the natural logarithm:\n$$\nS(\\mathbf{b}) = \\ln\\left( \\prod_{i=1}^{L} \\frac{p_{i, b_i}}{q_{b_i}} \\right) = \\sum_{i=1}^{L} \\ln\\left( \\frac{p_{i, b_i}}{q_{b_i}} \\right)\n$$\nThis function scores a sequence by summing the position-specific log-odds, where each term reflects how much more probable the observed nucleotide is under the motif model than the background model. This resulting sum is the log-odds motif score.\n\n### Part 3: Calculation for the Specific Instance\n\nWe are given the sequence $\\mathbf{b} = (\\mathrm{G}, \\mathrm{C}, \\mathrm{G}, \\mathrm{T}, \\mathrm{A}, \\mathrm{G}, \\mathrm{C}, \\mathrm{A})$. The nucleotide order for the PWM columns and background vector is $(\\mathrm{A}, \\mathrm{C}, \\mathrm{G}, \\mathrm{T})$. The background probabilities are $q = (q_{\\mathrm{A}}, q_{\\mathrm{C}}, q_{\\mathrm{G}}, q_{\\mathrm{T}}) = (0.30, 0.20, 0.22, 0.28)$.\n\nThe score $S(\\mathbf{b})$ is calculated by summing the log-odds for each position $i=1, \\dots, 8$:\n$$\nS(\\mathbf{b}) = \\sum_{i=1}^{8} \\ln\\left( \\frac{p_{i, b_i}}{q_{b_i}} \\right)\n$$\nLet's compute each term:\n*   Position $1$: base $b_1 = \\mathrm{G}$. $p_{1,\\mathrm{G}} = 0.75$, $q_{\\mathrm{G}} = 0.22$. Score = $\\ln(0.75 / 0.22)$.\n*   Position $2$: base $b_2 = \\mathrm{C}$. $p_{2,\\mathrm{C}} = 0.60$, $q_{\\mathrm{C}} = 0.20$. Score = $\\ln(0.60 / 0.20) = \\ln(3)$.\n*   Position $3$: base $b_3 = \\mathrm{G}$. $p_{3,\\mathrm{G}} = 0.80$, $q_{\\mathrm{G}} = 0.22$. Score = $\\ln(0.80 / 0.22)$.\n*   Position $4$: base $b_4 = \\mathrm{T}$. $p_{4,\\mathrm{T}} = 0.60$, $q_{\\mathrm{T}} = 0.28$. Score = $\\ln(0.60 / 0.28)$.\n*   Position $5$: base $b_5 = \\mathrm{A}$. $p_{5,\\mathrm{A}} = 0.65$, $q_{\\mathrm{A}} = 0.30$. Score = $\\ln(0.65 / 0.30)$.\n*   Position $6$: base $b_6 = \\mathrm{G}$. $p_{6,\\mathrm{G}} = 0.65$, $q_{\\mathrm{G}} = 0.22$. Score = $\\ln(0.65 / 0.22)$.\n*   Position $7$: base $b_7 = \\mathrm{C}$. $p_{7,\\mathrm{C}} = 0.70$, $q_{\\mathrm{C}} = 0.20$. Score = $\\ln(0.70 / 0.20) = \\ln(3.5)$.\n*   Position $8$: base $b_8 = \\mathrm{A}$. $p_{8,\\mathrm{A}} = 0.55$, $q_{\\mathrm{A}} = 0.30$. Score = $\\ln(0.55 / 0.30)$.\n\nSumming these values:\n$S(\\mathbf{b}) = \\ln(\\frac{0.75}{0.22}) + \\ln(\\frac{0.60}{0.20}) + \\ln(\\frac{0.80}{0.22}) + \\ln(\\frac{0.60}{0.28}) + \\ln(\\frac{0.65}{0.30}) + \\ln(\\frac{0.65}{0.22}) + \\ln(\\frac{0.70}{0.20}) + \\ln(\\frac{0.55}{0.30})$\n$S(\\mathbf{b}) \\approx 1.226402 + 1.098612 + 1.290944 + 0.762140 + 0.773190 + 1.083319 + 1.252763 + 0.606136$\n$S(\\mathbf{b}) \\approx 8.093506$\n\nThe problem requires the answer to be rounded to $4$ significant figures. The calculated value is $8.093506...$. The fifth significant digit is $5$, so we round up the fourth digit.\n$S(\\mathbf{b}) \\approx 8.094$.", "answer": "$$\n\\boxed{8.094}\n$$", "id": "4560143"}, {"introduction": "After identifying potential regulatory regions, the next step is often to measure their epigenetic state. This exercise delves into the practical aspects of analyzing DNA methylation data from popular microarray platforms [@problem_id:4560141]. You will compare two common metrics, the Beta-value and the M-value, and explore the crucial statistical concept of homoscedasticity to understand why one is often superior for robust downstream linear modeling.", "problem": "You are analyzing Deoxyribonucleic Acid (DNA) methylation at a single cytosine-phosphate-guanine (CpG) site located in an enhancer that modulates a gene’s promoter activity. On an Illumina methylation array, the methylated and unmethylated fluorescence intensities for one biological sample at this CpG are recorded as methylated channel $M = 800$ and unmethylated channel $U = 200$. A small positive offset $\\alpha = 100$ is used in preprocessing to improve numerical stability in downstream analyses. Using the standard definitions in array-based methylation analysis, the Beta-value is the fraction of methylated signal on $[0,1]$ incorporating the offset, and the $M$-value is the base-$2$ logit transform of the Beta-value. \n\nTask: \n- Compute the Beta-value and $M$-value for this CpG from the given $M$, $U$, and $\\alpha$. \n- Then, starting from first principles about how transformations affect variance and the well-established behavior of fluorescence intensities on the log scale, determine which option simultaneously reports the correct computed values and provides a correct justification for why $M$-values typically exhibit better homoscedasticity across the methylation range than Beta-values in linear modeling of cohort-scale data.\n\nChoose one option.\n\nA. Beta-value $= \\dfrac{800}{800+200+100} \\approx 0.7273$; $M$-value $= \\log_2\\!\\left(\\dfrac{0.7273}{1-0.7273}\\right) \\approx 1.415$. Explanation: Because the Beta-value is a bounded nonlinear proportion on $[0,1]$, its variance depends on its mean; in contrast, the $M$-value is essentially a log-ratio (logit) that maps $[0,1]$ to $\\mathbb{R}$ and, under approximately additive and homoscedastic errors on the log-intensity scale, differences of logs have near-constant variance. Thus the logit stabilizes variance across the dynamic range, yielding more homoscedastic residuals.\n\nB. Beta-value $= \\dfrac{800}{800+200} = 0.8$; $M$-value $= \\log_2\\!\\left(\\dfrac{800}{200}\\right) = 2$. Explanation: The log simply reduces skewness of intensities, which by itself guarantees homoscedasticity, so $M$-values are always variance-stabilized regardless of the offset or transformation details.\n\nC. Beta-value $= \\dfrac{800}{800+200+100} \\approx 0.7273$; $M$-value $= \\log_2\\!\\left(\\dfrac{800}{200}\\right) = 2$. Explanation: Beta-values are more homoscedastic because they are bounded on $[0,1]$, while $M$-values are unbounded and therefore have unstable variance.\n\nD. Beta-value $= \\dfrac{800}{800+200+100} \\approx 0.7273$; $M$-value $= \\log_2\\!\\left(\\dfrac{800+100}{200+100}\\right) \\approx 1.585$. Explanation: Adding the same offset to both channels makes the variance exactly constant for all levels of methylation, so $M$-values are homoscedastic by construction.", "solution": "We first compute the Beta-value and the $M$-value using the standard definitions used for array-based methylation analysis: the Beta-value is the fraction of methylated signal including the offset, and the $M$-value is the base-$2$ logit of the Beta-value.\n\nGiven $M = 800$, $U = 200$, and $\\alpha = 100$, the Beta-value is\n$$\n\\beta \\;=\\; \\frac{M}{M + U + \\alpha}\n\\;=\\;\n\\frac{800}{800 + 200 + 100}\n\\;=\\;\n\\frac{800}{1100}\n\\;\\approx\\;\n0.7272727\\ldots \\;\\approx\\; 0.7273.\n$$\n\nThe $M$-value is the base-$2$ logit of $\\beta$:\n$$\nM\\text{-value} \\;=\\; \\log_2\\!\\left(\\frac{\\beta}{1-\\beta}\\right)\n\\;=\\;\n\\log_2\\!\\left(\\frac{0.7272727\\ldots}{1 - 0.7272727\\ldots}\\right)\n\\;=\\;\n\\log_2\\!\\left(\\frac{0.7272727\\ldots}{0.2727272\\ldots}\\right)\n\\;=\\;\n\\log_2(2.6666\\ldots)\n\\;\\approx\\;\n1.415.\n$$\n\nWe now address homoscedasticity from first principles.\n\nFoundational considerations:\n- Fluorescence intensities from the methylated and unmethylated channels often behave approximately log-normally, so that on the log scale, errors can be modeled as approximately additive and close to homoscedastic across a wide dynamic range. If we write $X = \\log_2 M$ and $Y = \\log_2 U$, then a common working model is that $X = \\mu_X + \\varepsilon_X$ and $Y = \\mu_Y + \\varepsilon_Y$, with $\\operatorname{Var}(\\varepsilon_X) \\approx \\operatorname{Var}(\\varepsilon_Y) \\approx \\sigma^2$ and modest covariance.\n- The Beta-value is a bounded nonlinear transformation on $[0,1]$ of the pair $(M,U)$, specifically $\\beta = M/(M+U+\\alpha)$. Such bounded nonlinear maps inherently introduce mean–variance coupling: changes in $M$ or $U$ translate into different-sized changes in $\\beta$ depending on where $\\beta$ lies (near $0$, near $1$, or near the middle).\n- The $M$-value is the base-$2$ logit of $\\beta$. In the special case $\\alpha = 0$, it is algebraically equal to a log-ratio: \n$$\n\\log_2\\!\\left(\\frac{\\beta}{1-\\beta}\\right)\n=\n\\log_2\\!\\left(\\frac{M}{U}\\right).\n$$\nThis identity shows that the $M$-value is essentially a difference of log-intensities, $X - Y$.\n\nHomoscedasticity mechanism for $M$-values:\n- Under the log-intensity model above, $\\operatorname{Var}(X - Y) = \\operatorname{Var}(X) + \\operatorname{Var}(Y) - 2\\operatorname{Cov}(X,Y) \\approx 2\\sigma^2 - 2\\operatorname{Cov}(X,Y)$, which is approximately constant across the mean signal levels when the covariance is either small or slowly varying. Therefore, the variance of the $M$-value is approximately independent of the mean methylation level, yielding a more homoscedastic response suitable for linear modeling.\n- When $\\alpha > 0$, the $M$-value defined as a logit of $\\beta$ is no longer exactly $\\log_2(M/U)$, but it remains a smooth monotone transform closely related to a log-ratio for typical offsets and signal ranges; hence it largely inherits the variance-stabilizing behavior.\n\nWhy Beta-values are heteroscedastic:\n- Consider the mapping $f(M,U) = \\beta = M/(M+U+\\alpha)$. A first-order delta-method approximation with small, independent perturbations in $M$ and $U$ shows\n$$\n\\frac{\\partial f}{\\partial M} = \\frac{U+\\alpha}{(M+U+\\alpha)^2} = \\frac{1-\\beta}{M+U+\\alpha}, \n\\quad\n\\frac{\\partial f}{\\partial U} = -\\frac{M}{(M+U+\\alpha)^2} = -\\frac{\\beta}{M+U+\\alpha}.\n$$\nIf the absolute variances of $M$ and $U$ on the linear scale are non-constant and increase with signal (as suggested by log-normal-like behavior), then the induced variance in $\\beta$ depends on $\\beta$ through these derivatives and the scale of $(M,U)$, producing a mean-dependent variance. More generally, bounded proportions exhibit mean–variance coupling (e.g., in binomial sampling, $\\operatorname{Var}(\\beta)$ scales with $\\beta(1-\\beta)$), making homoscedastic modeling problematic on the Beta-value scale.\n\nTogether, these points explain why $M$-values, which are approximately log-ratios of intensities, tend to be markedly more homoscedastic than Beta-values across the methylation range.\n\nOption-by-option analysis:\n\n- Option A:\n  - Computation: $\\beta = 800/1100 \\approx 0.7273$ and $M$-value $= \\log_2(0.7273/0.2727) \\approx \\log_2(2.6667) \\approx 1.415$. These match our calculations.\n  - Explanation: Correct. It identifies the boundedness and mean–variance coupling of $\\beta$, the approximate log-ratio nature of $M$-values, and the additivity and near-constant variance on the log scale that yield more homoscedastic differences of logs.\n\n- Option B:\n  - Computation: Ignores $\\alpha$, giving $\\beta = 0.8$ and $M$-value $= 2$, which contradict the offset-inclusive definitions. Incorrect numerics.\n  - Explanation: Incorrect. Reducing skewness does not by itself guarantee homoscedasticity, and it ignores the crucial role of the log-ratio structure and offset handling.\n\n- Option C:\n  - Computation: Uses the correct $\\beta \\approx 0.7273$ but takes the $M$-value as $\\log_2(800/200) = 2$, which is not the defined base-$2$ logit of $\\beta$ with $\\alpha > 0$. Incorrect $M$-value.\n  - Explanation: Incorrect. It reverses the homoscedasticity claim, asserting Beta-values are more homoscedastic, which is contrary to empirical and theoretical insights.\n\n- Option D:\n  - Computation: Reports an $M$-value as $\\log_2((M+\\alpha)/(U+\\alpha)) \\approx \\log_2(900/300) \\approx 1.585$, which is not the definition given (the $M$-value here should be the base-$2$ logit of $\\beta$). Incorrect under the stated definitions.\n  - Explanation: Incorrect. Adding a constant offset does not make variance exactly constant across all methylation levels; it prevents division-by-zero instabilities but does not enforce perfect homoscedasticity.\n\nTherefore, only Option A is fully correct.", "answer": "$$\\boxed{A}$$", "id": "4560141"}, {"introduction": "The ultimate goal of studying genomic regulation is to understand causal mechanisms, such as how genetic variation impacts gene expression through epigenetic changes. This advanced practice introduces mediation analysis as a formal framework to test such directional hypotheses [@problem_id:4560084]. By simulating data and applying a series of regression models, you will dissect the pathway from a genotype (meQTL) to expression (eQTL) via a DNA methylation mediator, gaining hands-on experience with a powerful tool for causal inference in genomics.", "problem": "You are given a conceptual model in which single nucleotide polymorphisms (SNPs) in Deoxyribonucleic Acid (DNA) genotype influence cytosine methylation at a locus, and methylation in turn influences messenger ribonucleic acid expression. The analytical goal is to test mediation directionality, specifically whether genotype influences expression primarily through methylation, using conditional analyses and the Sobel test for indirect effects.\n\nStarting from core definitions and widely accepted principles:\n- The Central Dogma of molecular biology states that DNA information flows through ribonucleic acid to protein, and epigenetic regulation modulates transcriptional output. In statistical genomics, an expression quantitative trait locus (eQTL) is defined as a DNA variant that associates with expression level, and a methylation quantitative trait locus (meQTL) is defined as a DNA variant that associates with methylation level.\n- Ordinary Least Squares (OLS) linear regression models describe the expectation of a response as a linear function of predictors. For an observed response vector $y \\in \\mathbb{R}^{n}$ and a design matrix $X \\in \\mathbb{R}^{n \\times p}$, the OLS estimator is $\\hat{\\beta} = (X^{\\top}X)^{-1}X^{\\top}y$, with residuals $r = y - X\\hat{\\beta}$, residual variance $\\hat{\\sigma}^{2} = \\lVert r \\rVert^{2} / (n - p)$, and estimator covariance $\\mathrm{Var}(\\hat{\\beta}) = \\hat{\\sigma}^{2}(X^{\\top}X)^{-1}$. Coefficient standard errors are the square roots of the diagonal entries of $\\mathrm{Var}(\\hat{\\beta})$. Given linear modeling assumptions (independent errors with zero mean and constant variance, and full rank $X$), t-statistics $t_{j} = \\hat{\\beta}_{j} / \\mathrm{SE}(\\hat{\\beta}_{j})$ follow a Student distribution with $n - p$ degrees of freedom. The Sobel test for an indirect effect under linear mediation uses the product of path coefficients and their variances to form a normal approximation test statistic.\n- Under Hardy–Weinberg equilibrium for a biallelic locus with minor allele frequency $p \\in (0,1)$, the genotype $G \\in \\{0,1,2\\}$ has probabilities $\\mathbb{P}(G=0) = (1-p)^{2}$, $\\mathbb{P}(G=1) = 2p(1-p)$, and $\\mathbb{P}(G=2) = p^{2}$.\n\nModel the variables as follows, for sample size $n$:\n- Genotype $G \\in \\{0,1,2\\}^{n}$ drawn under Hardy–Weinberg equilibrium with minor allele frequency $p$.\n- A covariate principal component $C \\sim \\mathcal{N}(0,1)$ per sample to represent population structure or batch effects.\n- Methylation $M \\in \\mathbb{R}^{n}$ generated by $M = a G + \\alpha C + \\varepsilon_{M}$, where $\\varepsilon_{M} \\sim \\mathcal{N}(0,\\sigma_{M}^{2} I)$.\n- Expression $E \\in \\mathbb{R}^{n}$ generated by $E = b M + c G + \\beta C + \\varepsilon_{E}$, where $\\varepsilon_{E} \\sim \\mathcal{N}(0,\\sigma_{E}^{2} I)$.\n\nYour program must, for each test case, perform three OLS analyses:\n1. Unconditional eQTL: regress $E$ on an intercept, $G$, and $C$ to estimate the total genotype effect $c$.\n2. meQTL: regress $M$ on an intercept, $G$, and $C$ to estimate the genotype-to-methylation effect $a$.\n3. Conditional eQTL with mediator: regress $E$ on an intercept, $G$, $M$, and $C$ to estimate the mediator-to-expression effect $b$ and the direct genotype effect $c'$.\n\nThen, compute the Sobel test for the indirect effect $a \\cdot b$ using the estimated coefficients and their standard errors. Use two-tailed tests with significance threshold $\\alpha = 0.05$. Determine mediation directionality for genotype $\\rightarrow$ methylation $\\rightarrow$ expression as a boolean according to all of the following criteria:\n- The unconditional genotype effect on expression is significant (estimate $c$ with two-tailed p-value less than $0.05$).\n- The genotype effect on methylation is significant (estimate $a$ with two-tailed p-value less than $0.05$).\n- The methylation effect on expression is significant when controlling for genotype (estimate $b$ with two-tailed p-value less than $0.05$).\n- The magnitude of the direct genotype effect on expression shrinks when controlling for methylation, i.e., $\\lvert c' \\rvert < \\lvert c \\rvert$.\n- The Sobel test for the indirect effect $a \\cdot b$ is significant with two-tailed p-value less than $0.05$, and the sign of the indirect effect $\\mathrm{sign}(a \\cdot b)$ matches the sign of the total genotype effect $\\mathrm{sign}(c)$.\n\nFor each test case, your program must output a list containing the following in order: the estimated indirect effect $a \\cdot b$ as a float, the Sobel $Z$ statistic as a float, the Sobel two-tailed p-value as a float, and the directional mediation decision as a boolean.\n\nUnits and angles do not apply, and all outputs are dimensionless real numbers or booleans. The final output must be a single line containing the results across all test cases as a comma-separated list enclosed in square brackets. Each test case result must itself be a comma-separated list enclosed in square brackets. For example, the program should produce a single line in the format $[\\,[x_{1},y_{1},z_{1},\\mathrm{True}],\\,[x_{2},y_{2},z_{2},\\mathrm{False}]\\,]$, and so on. Round all floats to six decimal places in the final output.\n\nTest suite parameter values:\n- Case A (clear mediation): $n=400$, minor allele frequency $p=0.3$, $a=0.9$, $b=1.0$, $c=0.1$, $\\sigma_{M}=0.8$, $\\sigma_{E}=1.0$, $\\alpha=0.5$, $\\beta=0.4$, random seed $=123$.\n- Case B (no methylation path): $n=400$, $p=0.3$, $a=0.0$, $b=1.0$, $c=1.0$, $\\sigma_{M}=0.8$, $\\sigma_{E}=1.0$, $\\alpha=0.5$, $\\beta=0.4$, random seed $=456$.\n- Case C (no expression path through methylation): $n=400$, $p=0.3$, $a=0.8$, $b=0.0$, $c=0.5$, $\\sigma_{M}=0.8$, $\\sigma_{E}=1.0$, $\\alpha=0.5$, $\\beta=0.4$, random seed $=789$.\n- Case D (high collinearity, small sample): $n=80$, $p=0.45$, $a=2.0$, $b=1.0$, $c=0.0$, $\\sigma_{M}=0.1$, $\\sigma_{E}=1.0$, $\\alpha=0.0$, $\\beta=0.0$, random seed $=101$.\n- Case E (negative mediation): $n=500$, $p=0.25$, $a=1.0$, $b=-0.8$, $c=0.0$, $\\sigma_{M}=0.7$, $\\sigma_{E}=0.7$, $\\alpha=0.3$, $\\beta=0.3$, random seed $=202$.\n\nYour program must deterministically generate data using the specified seeds and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each per-case result is a bracketed, comma-separated list $[a\\cdot b, Z, p, \\mathrm{boolean}]$, with all floats rounded to six decimal places and no spaces.", "solution": "The problem requires a simulation-based validation of causal mediation analysis for a specified genotype-methylation-expression model. The solution involves generating data according to the model, performing a series of Ordinary Least Squares (OLS) regressions to estimate the path coefficients, and then applying the Sobel test and a set of decision criteria to determine if mediation is supported. This process is repeated for several test cases with different underlying parameters.\n\nThe logical flow of the solution is as follows:\n1.  **Data Generation**: For each test case, simulate a dataset of size $n$ based on the provided parameters.\n2.  **Statistical Analysis**: Perform three distinct OLS regressions to estimate the total effect, the mediator path, and the direct effect.\n3.  **Mediation Test**: Compute the Sobel test statistic for the indirect effect and evaluate a set of five criteria to make a final boolean decision on mediation.\n\n**1. Data Generation**\n\nFor each test case, we generate data for $n$ individuals. Reproducibility is ensured by using the specified random seed for each case.\n\n-   **Genotype ($G$)**: The genotype $G$ for each individual is an integer from the set $\\{0, 1, 2\\}$, representing the count of a minor allele. It is drawn from a multinomial distribution governed by Hardy-Weinberg equilibrium with minor allele frequency $p$. The probabilities for the genotypes are:\n    $$ \\mathbb{P}(G=0) = (1-p)^2 $$\n    $$ \\mathbb{P}(G=1) = 2p(1-p) $$\n    $$ \\mathbb{P}(G=2) = p^2 $$\n\n-   **Covariate ($C$)**: A covariate $C$, representing factors like population structure, is drawn from a standard normal distribution, $C \\sim \\mathcal{N}(0, 1)$.\n\n-   **Methylation ($M$)**: The methylation level $M$ is generated as a linear function of genotype $G$ and covariate $C$, with an added noise term $\\varepsilon_M$:\n    $$ M = a G + \\alpha C + \\varepsilon_M $$\n    where $\\varepsilon_M$ is drawn from a normal distribution with mean $0$ and variance $\\sigma_{M}^2$, i.e., $\\varepsilon_M \\sim \\mathcal{N}(0, \\sigma_{M}^2)$.\n\n-   **Expression ($E$)**: The expression level $E$ is generated based on methylation $M$, genotype $G$, and covariate $C$, with an added noise term $\\varepsilon_E$:\n    $$ E = b M + c' G + \\beta C + \\varepsilon_E $$\n    where $c'$ corresponds to the parameter named $c$ in the problem's test suite, representing the true direct effect of genotype on expression. The noise term $\\varepsilon_E$ is drawn from $\\mathcal{N}(0, \\sigma_{E}^2)$.\n\n**2. Statistical Modeling: Ordinary Least Squares (OLS)**\n\nThe analysis relies on OLS regression to estimate the coefficients of the linear models. For a general linear model $y = X\\beta + \\varepsilon$, where $y$ is an $n \\times 1$ response vector and $X$ is an $n \\times p$ design matrix of predictors (including an intercept), the OLS estimator for the coefficient vector $\\beta$ is:\n$$ \\hat{\\beta} = (X^{\\top}X)^{-1}X^{\\top}y $$\nThe standard errors of these estimates are derived from the variance of the estimator. First, the residual variance $\\hat{\\sigma}^2$ is estimated from the residuals $r = y - X\\hat{\\beta}$:\n$$ \\hat{\\sigma}^2 = \\frac{\\lVert r \\rVert^2}{n-p} = \\frac{r^{\\top}r}{n-p} $$\nwhere $n-p$ are the degrees of freedom. The covariance matrix of the coefficient estimates is then:\n$$ \\mathrm{Var}(\\hat{\\beta}) = \\hat{\\sigma}^2 (X^{\\top}X)^{-1} $$\nThe standard error for each coefficient $\\hat{\\beta}_j$ is the square root of the corresponding diagonal element of this matrix: $\\mathrm{SE}(\\hat{\\beta}_j) = \\sqrt{\\mathrm{Var}(\\hat{\\beta})_{jj}}$.\n\nTo test the significance of each coefficient, a t-statistic is calculated:\n$$ t_j = \\frac{\\hat{\\beta}_j}{\\mathrm{SE}(\\hat{\\beta}_j)} $$\nUnder the null hypothesis $H_0: \\beta_j=0$, this statistic follows a Student's t-distribution with $n-p$ degrees of freedom. The two-tailed p-value is then calculated from this distribution.\n\n**3. Mediation Analysis Steps**\n\nThree regression models are fitted to estimate the relevant paths:\n\n-   **Model 1: Total Effect ($c_{\\text{total}}$)**. This model estimates the total effect of genotype on expression, without considering the mediator.\n    $$ E \\sim 1 + G + C $$\n    We fit this model to obtain the estimate $\\hat{c}_{\\text{total}}$ (the coefficient for $G$) and its p-value. The problem statement refers to this estimate as `$c$`.\n\n-   **Model 2: Genotype-Mediator Path ($a$)**. This model quantifies the effect of genotype on the mediator, methylation.\n    $$ M \\sim 1 + G + C $$\n    This provides the estimate $\\hat{a}$ (the coefficient for $G$), its standard error $\\mathrm{SE}(\\hat{a})$, and its p-value.\n\n-   **Model 3: Mediator-Expression ($b$) and Direct Effect ($c'$)**. This model includes the mediator to estimate its effect on expression while controlling for genotype.\n    $$ E \\sim 1 + G + M + C $$\n    From this model, we obtain the estimate $\\hat{b}$ (for $M$), its standard error $\\mathrm{SE}(\\hat{b})$, and its p-value, as well as the estimate for the direct effect $\\hat{c'}$ (for $G$).\n\n**4. Sobel Test for the Indirect Effect**\n\nThe indirect effect of genotype on expression through methylation is quantified by the product of the path coefficients, $a \\cdot b$. The Sobel test assesses the statistical significance of this indirect effect. The test statistic $Z$ is calculated using the estimates $\\hat{a}$, $\\hat{b}$ and their standard errors from the regressions above:\n$$ Z = \\frac{\\hat{a}\\hat{b}}{\\sqrt{\\hat{a}^2 \\mathrm{SE}(\\hat{b})^2 + \\hat{b}^2 \\mathrm{SE}(\\hat{a})^2}} $$\nUnder the null hypothesis that the indirect effect is zero ($a \\cdot b = 0$), $Z$ is approximately normally distributed, $Z \\sim \\mathcal{N}(0, 1)$. The two-tailed p-value is computed from this standard normal distribution.\n\n**5. Decision Criteria for Mediation**\n\nThe final determination of mediation is a boolean outcome based on the fulfillment of all five of the following criteria, using a significance level of $\\alpha = 0.05$:\n\n1.  **Significant Total Effect**: The total effect of genotype on expression, $\\hat{c}_{\\text{total}}$, must be statistically significant ($p < 0.05$).\n2.  **Significant Path $a$**: The effect of genotype on methylation, $\\hat{a}$, must be statistically significant ($p < 0.05$).\n3.  **Significant Path $b$**: The effect of methylation on expression, $\\hat{b}$, when controlling for genotype, must be statistically significant ($p < 0.05$).\n4.  **Effect Size Reduction**: The magnitude of the direct effect of genotype, $\\hat{c'}$, must be smaller than the magnitude of the total effect, i.e., $|\\hat{c'}| < |\\hat{c}_{\\text{total}}|$.\n5.  **Significant & Consistent Indirect Effect**: The Sobel test for the indirect effect $\\hat{a}\\hat{b}$ must be significant ($p < 0.05$), and the sign of the indirect effect must match the sign of the total effect, i.e., $\\mathrm{sign}(\\hat{a}\\hat{b}) = \\mathrm{sign}(\\hat{c}_{\\text{total}})$.\n\nA `True` result is returned if and only if all five conditions are met. The final output for each test case comprises the estimated indirect effect $\\hat{a}\\hat{b}$, the Sobel $Z$ statistic, the Sobel p-value, and this final boolean decision.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import stats\n\ndef ols(y: np.ndarray, X: np.ndarray) -> tuple[np.ndarray, np.ndarray, np.ndarray]:\n    \"\"\"\n    Performs Ordinary Least Squares (OLS) regression.\n\n    Args:\n        y: Response vector (n_samples,).\n        X: Design matrix (n_samples, n_predictors), including intercept.\n\n    Returns:\n        A tuple containing:\n        - beta_hat: Estimated coefficients.\n        - se_beta: Standard errors of the coefficients.\n        - p_values: Two-tailed p-values for the coefficients.\n    \"\"\"\n    n, p = X.shape\n    df = n - p\n    try:\n        # beta_hat = (X.T @ X)^-1 @ X.T @ y\n        beta_hat = np.linalg.solve(X.T @ X, X.T @ y)\n\n        residuals = y - X @ beta_hat\n        rss = residuals.T @ residuals\n        sigma2_hat = rss / df\n\n        # Covariance matrix of coefficients\n        var_beta_hat = sigma2_hat * np.linalg.inv(X.T @ X)\n        se_beta = np.sqrt(np.diag(var_beta_hat))\n\n        # t-statistics, handle SE=0 case\n        t_stats = np.divide(beta_hat, se_beta, out=np.full_like(beta_hat, np.inf), where=se_beta != 0)\n        \n        # Two-tailed p-values from Student's t-distribution\n        p_values = 2 * stats.t.sf(np.abs(t_stats), df)\n\n        return beta_hat, se_beta, p_values\n    \n    except np.linalg.LinAlgError:\n        # In case of a singular matrix (e.g., perfect collinearity)\n        nan_array = np.full(p, np.nan)\n        return nan_array, nan_array, nan_array\n\n\ndef run_mediation_analysis(n, p_maf, a_true, b_true, c_direct_true, sigma_m, sigma_e, alpha, beta, seed):\n    \"\"\"\n    Runs a full mediation analysis for a single test case.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n\n    # 1. Data Generation\n    # Genotype G drawn from Hardy-Weinberg equilibrium probabilities\n    p0 = (1 - p_maf)**2\n    p1 = 2 * p_maf * (1 - p_maf)\n    p2 = p_maf**2\n    G = rng.choice([0, 1, 2], size=n, p=[p0, p1, p2])\n\n    # Covariate C from standard normal distribution\n    C = rng.normal(0, 1, size=n)\n\n    # Methylation M\n    eps_m = rng.normal(0, sigma_m, size=n)\n    M = a_true * G + alpha * C + eps_m\n\n    # Expression E\n    eps_e = rng.normal(0, sigma_e, size=n)\n    E = b_true * M + c_direct_true * G + beta * C + eps_e\n\n    intercept = np.ones(n)\n\n    # 2. OLS Analyses\n    # Model 1: Total effect (c_total). E ~ 1 + G + C\n    X1 = np.c_[intercept, G, C]\n    coeffs1, _, pvals1 = ols(E, X1)\n    c_total_hat = coeffs1[1]\n    p_c_total = pvals1[1]\n\n    # Model 2: Path a. M ~ 1 + G + C\n    coeffs2, se2, pvals2 = ols(M, X1) # X matrix is the same\n    a_hat = coeffs2[1]\n    se_a = se2[1]\n    p_a = pvals2[1]\n\n    # Model 3: Paths b and c'. E ~ 1 + G + M + C\n    X3 = np.c_[intercept, G, M, C]\n    coeffs3, se3, pvals3 = ols(E, X3)\n    c_prime_hat = coeffs3[1]\n    b_hat = coeffs3[2]\n    se_b = se3[2]\n    p_b = pvals3[2]\n\n    # 3. Sobel Test for the indirect effect a*b\n    indirect_effect_ab = a_hat * b_hat\n    \n    # Calculate Sobel SE and Z-statistic\n    # Denominator: sqrt(a^2*seb^2 + b^2*sea^2)\n    se_ab_sq = (a_hat**2 * se_b**2) + (b_hat**2 * se_a**2)\n    \n    # Handle cases where variance is non-positive or SE is zero\n    if se_ab_sq <= 0 or np.isnan(se_ab_sq):\n        sobel_z = np.nan\n        sobel_p = 1.0\n    else:\n        se_ab = np.sqrt(se_ab_sq)\n        sobel_z = indirect_effect_ab / se_ab\n        sobel_p = 2 * stats.norm.sf(np.abs(sobel_z))\n\n    # 4. Evaluate Mediation Criteria\n    crit1 = p_c_total < 0.05\n    crit2 = p_a < 0.05\n    crit3 = p_b < 0.05\n    crit4 = np.abs(c_prime_hat) < np.abs(c_total_hat)\n    crit5 = (sobel_p < 0.05) and (np.sign(indirect_effect_ab) == np.sign(c_total_hat))\n\n    is_mediation = all([crit1, crit2, crit3, crit4, crit5])\n\n    return [indirect_effect_ab, sobel_z, sobel_p, is_mediation]\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case A (clear mediation)\n        {'n': 400, 'p_maf': 0.3, 'a_true': 0.9, 'b_true': 1.0, 'c_direct_true': 0.1, \n         'sigma_m': 0.8, 'sigma_e': 1.0, 'alpha': 0.5, 'beta': 0.4, 'seed': 123},\n        # Case B (no methylation path)\n        {'n': 400, 'p_maf': 0.3, 'a_true': 0.0, 'b_true': 1.0, 'c_direct_true': 1.0, \n         'sigma_m': 0.8, 'sigma_e': 1.0, 'alpha': 0.5, 'beta': 0.4, 'seed': 456},\n        # Case C (no expression path through methylation)\n        {'n': 400, 'p_maf': 0.3, 'a_true': 0.8, 'b_true': 0.0, 'c_direct_true': 0.5, \n         'sigma_m': 0.8, 'sigma_e': 1.0, 'alpha': 0.5, 'beta': 0.4, 'seed': 789},\n        # Case D (high collinearity, small sample)\n        {'n': 80, 'p_maf': 0.45, 'a_true': 2.0, 'b_true': 1.0, 'c_direct_true': 0.0, \n         'sigma_m': 0.1, 'sigma_e': 1.0, 'alpha': 0.0, 'beta': 0.0, 'seed': 101},\n        # Case E (negative mediation)\n        {'n': 500, 'p_maf': 0.25, 'a_true': 1.0, 'b_true': -0.8, 'c_direct_true': 0.0, \n         'sigma_m': 0.7, 'sigma_e': 0.7, 'alpha': 0.3, 'beta': 0.3, 'seed': 202}\n    ]\n\n    all_results = []\n    for params in test_cases:\n        result = run_mediation_analysis(**params)\n        \n        # Replace nan with a string 'nan' for formatting\n        ab, z, p = result[:3]\n        ab_str = f\"{ab:.6f}\" if not np.isnan(ab) else \"nan\"\n        z_str = f\"{z:.6f}\" if not np.isnan(z) else \"nan\"\n        p_str = f\"{p:.6f}\" if not np.isnan(p) else \"nan\"\n        \n        # Format the result list as a string\n        formatted_result = f\"[{ab_str},{z_str},{p_str},{result[3]}]\"\n        all_results.append(formatted_result)\n\n    # Combine all results into a single line string\n    final_output = f\"[{','.join(all_results)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "4560084"}]}