{"hands_on_practices": [{"introduction": "The most fundamental concept in the study of biological aging is quantifying the divergence between an individual's biological age and their chronological age. This practice introduces the simplest and most intuitive measure: Epigenetic Age Acceleration (EAA), often termed \"delta age.\" By calculating the average difference between predicted epigenetic age and chronological age for a small cohort, you will gain a foundational understanding of what it means for a group to exhibit accelerated or decelerated aging. [@problem_id:4337070]", "problem": "A hospital-based precision medicine cohort study quantified blood-based DNA methylation (DNAm) using a validated pan-tissue epigenetic clock to estimate biological (epigenetic) age for older adults undergoing inflammatory screening. For each participant $i$, let chronological age be $A_i$ and predicted epigenetic age be $\\hat{A}_i$. Epigenetic age acceleration (EAA) at the cohort level is defined as the arithmetic mean of the individual-level differences between predicted epigenetic age and chronological age across all $n$ participants. Assume all samples were processed in the same batch and pre-adjusted for known technical covariates so that simple averaging is appropriate.\n\nGiven the data for $n=10$ participants:\n- $i=1$: $(A_1,\\hat{A}_1)=(45.2, 47.6)$\n- $i=2$: $(A_2,\\hat{A}_2)=(52.8, 51.9)$\n- $i=3$: $(A_3,\\hat{A}_3)=(60.3, 59.0)$\n- $i=4$: $(A_4,\\hat{A}_4)=(39.7, 41.1)$\n- $i=5$: $(A_5,\\hat{A}_5)=(71.5, 74.3)$\n- $i=6$: $(A_6,\\hat{A}_6)=(64.1, 63.2)$\n- $i=7$: $(A_7,\\hat{A}_7)=(55.0, 54.8)$\n- $i=8$: $(A_8,\\hat{A}_8)=(48.6, 50.0)$\n- $i=9$: $(A_9,\\hat{A}_9)=(58.2, 57.6)$\n- $i=10$: $(A_{10},\\hat{A}_{10})=(66.9, 69.5)$\n\nCompute the cohort mean epigenetic age acceleration and report it as a single real number in years. Round your answer to four significant figures. Then, based on the sign and magnitude of the value, interpret within your solution whether the cohort exhibits accelerated or decelerated aging on average, and comment on the magnitude in the context of biological aging assessment.", "solution": "The problem statement is first validated against the required criteria.\n\n### Step 1: Extract Givens\n- The study involves $n=10$ participants.\n- For each participant $i$, the chronological age is $A_i$ and the predicted epigenetic age is $\\hat{A}_i$.\n- Epigenetic Age Acceleration (EAA) at the cohort level is defined as the arithmetic mean of the individual-level differences between predicted epigenetic age and chronological age, i.e., $\\frac{1}{n}\\sum_{i=1}^{n}(\\hat{A}_i - A_i)$.\n- The data for the $n=10$ participants are:\n  - $i=1$: $(A_1, \\hat{A}_1) = (45.2, 47.6)$\n  - $i=2$: $(A_2, \\hat{A}_2) = (52.8, 51.9)$\n  - $i=3$: $(A_3, \\hat{A}_3) = (60.3, 59.0)$\n  - $i=4$: $(A_4, \\hat{A}_4) = (39.7, 41.1)$\n  - $i=5$: $(A_5, \\hat{A}_5) = (71.5, 74.3)$\n  - $i=6$: $(A_6, \\hat{A}_6) = (64.1, 63.2)$\n  - $i=7$: $(A_7, \\hat{A}_7) = (55.0, 54.8)$\n  - $i=8$: $(A_8, \\hat{A}_8) = (48.6, 50.0)$\n  - $i=9$: $(A_9, \\hat{A}_9) = (58.2, 57.6)$\n  - $i=10$: $(A_{10}, \\hat{A}_{10}) = (66.9, 69.5)$\n- The final result should be rounded to four significant figures.\n- An interpretation of the result is required.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity.\n- **Scientifically Grounded**: The concepts presented—chronological age, epigenetic age, DNA methylation (DNAm), epigenetic clocks, and epigenetic age acceleration (EAA)—are central and well-established in the field of geroscience and precision medicine. The definition of EAA as the difference between epigenetic and chronological age is standard. The problem is scientifically sound.\n- **Well-Posed**: The problem provides a clear, unambiguous definition for the quantity to be calculated (cohort mean EAA). All necessary data points ($A_i$, $\\hat{A}_i$, and $n$) are provided. A unique numerical solution exists.\n- **Objective**: The problem is stated using precise, objective language. There are no subjective or opinion-based elements.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is scientifically grounded, well-posed, and objective. A solution can be constructed.\n\n### Solution Derivation\nThe primary task is to compute the cohort mean epigenetic age acceleration, which we will denote as $\\text{EAA}_{\\text{cohort}}$. As defined in the problem, this is the arithmetic mean of the individual-level differences between the predicted epigenetic age, $\\hat{A}_i$, and the chronological age, $A_i$, for all $n$ participants.\n\nThe formula for the cohort mean EAA is:\n$$ \\text{EAA}_{\\text{cohort}} = \\frac{1}{n} \\sum_{i=1}^{n} (\\hat{A}_i - A_i) $$\nGiven that the number of participants is $n=10$, the formula becomes:\n$$ \\text{EAA}_{\\text{cohort}} = \\frac{1}{10} \\sum_{i=1}^{10} (\\hat{A}_i - A_i) $$\nFirst, we calculate the individual age difference, $\\Delta_i = \\hat{A}_i - A_i$, for each participant $i$:\n- For $i=1$: $\\Delta_1 = 47.6 - 45.2 = 2.4$ years\n- For $i=2$: $\\Delta_2 = 51.9 - 52.8 = -0.9$ years\n- For $i=3$: $\\Delta_3 = 59.0 - 60.3 = -1.3$ years\n- For $i=4$: $\\Delta_4 = 41.1 - 39.7 = 1.4$ years\n- For $i=5$: $\\Delta_5 = 74.3 - 71.5 = 2.8$ years\n- For $i=6$: $\\Delta_6 = 63.2 - 64.1 = -0.9$ years\n- For $i=7$: $\\Delta_7 = 54.8 - 55.0 = -0.2$ years\n- For $i=8$: $\\Delta_8 = 50.0 - 48.6 = 1.4$ years\n- For $i=9$: $\\Delta_9 = 57.6 - 58.2 = -0.6$ years\n- For $i=10$: $\\Delta_{10} = 69.5 - 66.9 = 2.6$ years\n\nNext, we sum these individual differences:\n$$ \\sum_{i=1}^{10} \\Delta_i = 2.4 + (-0.9) + (-1.3) + 1.4 + 2.8 + (-0.9) + (-0.2) + 1.4 + (-0.6) + 2.6 $$\n$$ \\sum_{i=1}^{10} \\Delta_i = (2.4 + 1.4 + 2.8 + 1.4 + 2.6) - (0.9 + 1.3 + 0.9 + 0.2 + 0.6) $$\n$$ \\sum_{i=1}^{10} \\Delta_i = 10.6 - 3.9 = 6.7 \\text{ years} $$\nFinally, we compute the mean by dividing the sum by $n=10$:\n$$ \\text{EAA}_{\\text{cohort}} = \\frac{6.7}{10} = 0.67 \\text{ years} $$\nThe problem requires the answer to be rounded to four significant figures. The number $0.67$ has two significant figures. To express this with four significant figures, we add trailing zeros: $0.6700$.\n\n### Interpretation\nThe computed cohort mean epigenetic age acceleration is $+0.6700$ years.\n- **Sign**: The sign of the value is positive. A positive EAA indicates that, on average, the epigenetic age of participants in the cohort is greater than their chronological age. This signifies that the cohort, as a whole, exhibits **accelerated biological aging**.\n- **Magnitude**: The magnitude of the acceleration is $0.6700$ years. In the context of biological aging assessment, this is a relatively modest value. While the result indicates a trend towards accelerated aging, a deviation of less than one year is typically considered a small effect. Clinically significant associations with morbidity and mortality are often observed with EAA values of several years (e.g., $3$ to $5$ years or more, depending on the specific epigenetic clock and outcome). Therefore, this cohort shows a slight, but not extreme, average acceleration in its biological aging process.", "answer": "$$\\boxed{0.6700}$$", "id": "4337070"}, {"introduction": "An epigenetic clock is a predictive model, and its utility hinges on its accuracy. This exercise moves from calculating a biomarker to critically evaluating the clock that produces it. You will compute two essential performance metrics, Mean Absolute Error ($MAE$) and Root Mean Squared Error ($RMSE$), to quantify the clock's predictive error, and learn how the relationship between them reveals important information about the error distribution, such as the impact of outliers. [@problem_id:4337063]", "problem": "A Deoxyribonucleic Acid (DNA) methylation-based epigenetic clock is evaluated in a precision medicine study using a held-out validation set of paired predicted epigenetic ages and observed chronological ages for $n$ individuals. For each individual $i \\in \\{1,\\dots,n\\}$, let the observed chronological age be $A_i$ (in years) and the predicted epigenetic age be $\\hat{A}_i$ (in years). The study seeks to quantify predictive accuracy using two standard regression error functionals grounded in the absolute deviation loss and the squared deviation loss. Use only their standard definitions; do not assume any special distributional forms for the residuals.\n\nYou are given $n = 8$ paired observations (years):\n- Individual $1$: $A_1 = 38.0$, $\\hat{A}_1 = 40.5$.\n- Individual $2$: $A_2 = 45.0$, $\\hat{A}_2 = 44.2$.\n- Individual $3$: $A_3 = 52.0$, $\\hat{A}_3 = 56.7$.\n- Individual $4$: $A_4 = 60.0$, $\\hat{A}_4 = 59.0$.\n- Individual $5$: $A_5 = 67.0$, $\\hat{A}_5 = 68.1$.\n- Individual $6$: $A_6 = 73.0$, $\\hat{A}_6 = 69.5$.\n- Individual $7$: $A_7 = 80.0$, $\\hat{A}_7 = 70.0$.\n- Individual $8$: $A_8 = 55.0$, $\\hat{A}_8 = 57.3$.\n\nTasks:\n- Using the standard definitions of Root Mean Squared Error (RMSE) and Mean Absolute Error (MAE) applied to these $n$ paired observations, compute both metrics, $MAE$ and $RMSE$, in years.\n- Then compute the ratio $r = \\text{RMSE}/\\text{MAE}$.\n- Briefly interpret, in terms of error sensitivity, what the relative magnitudes of RMSE and MAE imply about the residuals for this epigenetic clock on this dataset.\n\nReport only the ratio $r$ as your final answer, rounded to four significant figures, expressed as a pure number (no units). Do not include any other quantity in your final answer.", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It presents a standard task in statistical model evaluation within the context of biomedical research. The provided data are complete and consistent, and the required calculations use standard, unambiguous definitions.\n\nThe objective is to compute the Mean Absolute Error (MAE) and the Root Mean Squared Error (RMSE) for a given set of $n=8$ paired observations of chronological age ($A_i$) and predicted epigenetic age ($\\hat{A}_i$), and subsequently to compute and interpret their ratio.\n\nLet the prediction error, or residual, for the $i$-th individual be denoted by $e_i$. The residual is defined as the difference between the observed value and the predicted value:\n$$e_i = A_i - \\hat{A}_i$$\n\nThe Mean Absolute Error (MAE) is the average of the absolute values of the errors:\n$$\\text{MAE} = \\frac{1}{n} \\sum_{i=1}^{n} |e_i|$$\n\nThe Root Mean Squared Error (RMSE) is the square root of the average of the squared errors:\n$$\\text{RMSE} = \\sqrt{\\frac{1}{n} \\sum_{i=1}^{n} e_i^2}$$\n\nThe given data for $n=8$ individuals are:\n- Individual $1$: $A_1 = 38.0$, $\\hat{A}_1 = 40.5$\n- Individual $2$: $A_2 = 45.0$, $\\hat{A}_2 = 44.2$\n- Individual $3$: $A_3 = 52.0$, $\\hat{A}_3 = 56.7$\n- Individual $4$: $A_4 = 60.0$, $\\hat{A}_4 = 59.0$\n- Individual $5$: $A_5 = 67.0$, $\\hat{A}_5 = 68.1$\n- Individual $6$: $A_6 = 73.0$, $\\hat{A}_6 = 69.5$\n- Individual $7$: $A_7 = 80.0$, $\\hat{A}_7 = 70.0$\n- Individual $8$: $A_8 = 55.0$, $\\hat{A}_8 = 57.3$\n\nFirst, we compute the residuals $e_i$:\n- $e_1 = 38.0 - 40.5 = -2.5$\n- $e_2 = 45.0 - 44.2 = 0.8$\n- $e_3 = 52.0 - 56.7 = -4.7$\n- $e_4 = 60.0 - 59.0 = 1.0$\n- $e_5 = 67.0 - 68.1 = -1.1$\n- $e_6 = 73.0 - 69.5 = 3.5$\n- $e_7 = 80.0 - 70.0 = 10.0$\n- $e_8 = 55.0 - 57.3 = -2.3$\n\nNext, we compute the MAE. We require the sum of the absolute values of the residuals:\n$$ \\sum_{i=1}^{8} |e_i| = |-2.5| + |0.8| + |-4.7| + |1.0| + |-1.1| + |3.5| + |10.0| + |-2.3| $$\n$$ \\sum_{i=1}^{8} |e_i| = 2.5 + 0.8 + 4.7 + 1.0 + 1.1 + 3.5 + 10.0 + 2.3 = 25.9 $$\nThe MAE is therefore:\n$$ \\text{MAE} = \\frac{25.9}{8} = 3.2375 \\text{ years} $$\n\nNow, we compute the RMSE. We require the sum of the squared residuals:\n$$ \\sum_{i=1}^{8} e_i^2 = (-2.5)^2 + (0.8)^2 + (-4.7)^2 + (1.0)^2 + (-1.1)^2 + (3.5)^2 + (10.0)^2 + (-2.3)^2 $$\n$$ \\sum_{i=1}^{8} e_i^2 = 6.25 + 0.64 + 22.09 + 1.0 + 1.21 + 12.25 + 100.0 + 5.29 = 148.73 $$\nThe Mean Squared Error (MSE) is $\\frac{148.73}{8} = 18.59125 \\text{ years}^2$.\nThe RMSE is the square root of the MSE:\n$$ \\text{RMSE} = \\sqrt{18.59125} \\approx 4.311757 \\text{ years} $$\n\nFinally, we compute the ratio $r = \\frac{\\text{RMSE}}{\\text{MAE}}$:\n$$ r = \\frac{\\sqrt{18.59125}}{3.2375} \\approx \\frac{4.311757}{3.2375} \\approx 1.331818 $$\nRounding to four significant figures, we get $r \\approx 1.332$.\n\nA brief interpretation of this result is warranted. The RMSE metric squares the errors before averaging, which gives disproportionately greater weight to larger errors. The MAE metric, by contrast, weights each error linearly according to its absolute magnitude. Consequently, the RMSE is always greater than or equal to the MAE. The ratio $r = \\frac{\\text{RMSE}}{\\text{MAE}}$ is a measure of the variability in the error magnitudes; a value of $r=1$ would imply all errors are of equal magnitude. A value of $r$ substantially greater than $1$ indicates the presence of outliers or significant variation in the error distribution. In this dataset, the error for individual $7$ ($e_7=10.0$ years) is considerably larger than the other errors. This single large error contributes significantly to the sum of squared errors, thereby inflating the RMSE relative to the MAE and causing the ratio $r \\approx 1.332$ to be notably greater than $1$. This suggests that while the epigenetic clock is reasonably accurate for most individuals in this small sample, its performance is degraded by sporadic, large prediction errors.", "answer": "$$\\boxed{1.332}$$", "id": "4337063"}, {"introduction": "Simple \"delta age\" has limitations, as it doesn't properly account for the natural, non-linear trend of epigenetic age with chronological age. This advanced practice guides you through the construction of a more robust, \"second-generation\" biomarker, `AgeAccelGrim`, which is defined as the residual from a regression of epigenetic age on chronological age. By implementing this method, you will not only understand the statistical foundation of modern age acceleration measures but also demonstrate their power in capturing health risks, such as mortality, that are independent of age itself. [@problem_id:4336995]", "problem": "You are given a task to formalize and compute epigenetic age acceleration derived from the GrimAge epigenetic clock (GrimAge) in the setting of precision medicine and genomic diagnostics. From first principles, define and construct epigenetic age acceleration as a residual from a regression of GrimAge on chronological age, with an extension that includes sex as a covariate, and demonstrate how this metric captures risk that is linearly independent of chronological age and sex.\n\nFundamental base:\n- Epigenetic clocks such as GrimAge summarize deoxyribonucleic acid methylation (DNA methylation, DNAm) into a scalar estimate of biological age. GrimAge is constructed from methylation-based surrogates for plasma proteins and smoking pack-years and is widely validated in epidemiological cohorts.\n- Ordinary Least Squares (OLS) regression projects a response onto the column space of predictors. Given response vector $y \\in \\mathbb{R}^n$ and design matrix $X \\in \\mathbb{R}^{n \\times p}$ (including an intercept column), the OLS fitted values are $\\hat{y} = X \\hat{\\beta}$ where $\\hat{\\beta} = \\arg\\min_{\\beta} \\|y - X \\beta\\|_2^2$. The OLS solution can be written using the Moore–Penrose pseudoinverse $X^{+}$ as $\\hat{\\beta} = X^{+} y$, yielding $\\hat{y} = X X^{+} y$. The residual vector is $r = y - \\hat{y} = (I - X X^{+}) y$ and satisfies the orthogonality property $X^\\top r = 0$, meaning the residuals are uncorrelated with any predictor in $X$.\n- Age acceleration for GrimAge, denoted $AgeAccelGrim$, is defined as the residual $r$ from regressing GrimAge $y$ on chronological age (and optionally sex), which quantifies deviation from expected GrimAge given those covariates.\n\nYour program must:\n1. For each test case, construct two OLS models using the design matrices:\n   - Model A (age-only): $X_A = [\\mathbf{1}, age]$, where $\\mathbf{1}$ is the vector of ones for the intercept, and $age$ is the chronological age vector in years.\n   - Model B (age and sex): $X_B = [\\mathbf{1}, age, sex]$, where $sex$ is encoded as binary $0$ for female and $1$ for male.\n2. For each model, compute the residuals $r = y - X X^{+} y$, which are the $AgeAccelGrim$ values, expressed in years.\n3. Verify the orthogonality condition by computing the inner products between the residual vector and each included covariate column in $X$ and return a boolean for each inner product indicating whether its absolute value is below a numerical tolerance of $10^{-10}$ (this confirms linear independence from the covariates in the sense of zero correlation under OLS).\n4. Given an externally provided mortality risk index vector $m$ for each test case, compute the Pearson correlation coefficient between $r$ from Model B and $m$. If the sample standard deviation of $r$ is zero, define the correlation as $0.0$ by convention. Return the correlation rounded to three decimals.\n5. Output the residual vectors from both models in years, rounded to three decimals, and the booleans for the orthogonality checks, and the correlation value for each test case as a nested list.\n\nScientific realism requirements:\n- Interpret $AgeAccelGrim$ as a deviation in years, and ensure all residual outputs are in years, rounded to three decimals.\n- The orthogonality property must be demonstrated numerically via inner products, not assumed.\n- The mortality risk index $m$ is designed to have dependence on the $AgeAccelGrim$ signal but no systematic dependence on chronological age or sex, thereby testing risk capture independent of those covariates.\n\nTest suite:\n- Each test case provides arrays for chronological age in years, sex encoded as $0$ (female) or $1$ (male), GrimAge in years, and a mortality risk index (unitless). All arrays have matching lengths.\n\nTest Case 1 (general case, mixed sex, noisy GrimAge):\n- $age = [45, 50, 55, 60, 65, 70, 75, 80]$\n- $sex = [0, 1, 0, 1, 0, 1, 0, 1]$\n- $y$ (GrimAge, in years) $= [51.05, 59.8, 62.15, 70.9, 72.35, 80.7, 83.25, 91.6]$\n- $m$ (mortality risk index, unitless) $= [9.16, 10.56, 9.58, 10.98, 9.37, 10.49, 9.65, 10.77]$\n\nTest Case 2 (boundary case, sex column is all zeros):\n- $age = [40, 44, 48, 52, 56, 60]$\n- $sex = [0, 0, 0, 0, 0, 0]$\n- $y$ (GrimAge, in years) $= [44.0, 49.0, 54.0, 59.0, 64.0, 66.5]$\n- $m$ (mortality risk index, unitless) $= [3.4, 4.2, 5.0, 5.8, 6.6, 5.4]$\n\nTest Case 3 (edge case, perfect linear fit with collinearity of sex and intercept):\n- $age = [30, 40, 50, 60]$\n- $sex = [1, 1, 1, 1]$\n- $y$ (GrimAge, in years) $= [43, 55, 67, 79]$\n- $m$ (mortality risk index, unitless) $= [8.0, 8.0, 8.0, 8.0]$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n- Each test case result must be a nested list of the form: \n  $[$ residuals from Model A (list of floats in years, rounded to three decimals), residuals from Model B (list of floats in years, rounded to three decimals), orthogonality booleans for Model A with $age$ (single boolean), orthogonality booleans for Model B with $age$ and $sex$ (list of two booleans), Pearson correlation between Model B residuals and $m$ (float rounded to three decimals) $]$.\n- The top-level output is a list containing the three test case results.\n\nExample of the required top-level format (structure only): $[[\\ldots],[\\ldots],[\\ldots]]$.\n\nAngle units are not applicable. All residuals must be expressed in years. Percentages are not used; any fractional quantities must be represented as decimals.", "solution": "The problem requires the formalization and computation of epigenetic age acceleration, specifically $AgeAccelGrim$, from the GrimAge epigenetic clock. This metric is defined as the set of residuals obtained from an Ordinary Least Squares (OLS) regression of GrimAge values on chronological age and, optionally, sex. The task involves constructing two regression models, calculating the residuals, verifying their orthogonality with the predictors, and assessing their correlation with an independent mortality risk index.\n\n### Mathematical Formulation of Age Acceleration\n\nLet the observed GrimAge values for $n$ individuals be represented by a vector $y \\in \\mathbb{R}^n$. Let the corresponding predictor variables (chronological age, sex, etc.) be assembled as columns in a design matrix $X \\in \\mathbb{R}^{n \\times p}$, which also includes a leading column of ones, $\\mathbf{1}$, to model the intercept. The general linear model is expressed as:\n$$ y = X\\beta + \\epsilon $$\nwhere $\\beta \\in \\mathbb{R}^p$ is the vector of unknown coefficients and $\\epsilon \\in \\mathbb{R}^n$ represents the error terms.\n\nOLS regression finds an estimate $\\hat{\\beta}$ that minimizes the sum of squared differences, $\\|y - X\\beta\\|_2^2$. The vector of fitted values, $\\hat{y} = X\\hat{\\beta}$, is the orthogonal projection of $y$ onto the column space of $X$. A robust way to compute this projection, especially in the presence of collinearity among predictors, is by using the Moore-Penrose pseudoinverse, $X^{+}$, of the design matrix $X$.\n\nThe projection matrix onto the column space of $X$ is given by $P = X X^{+}$. The fitted values are then calculated as:\n$$ \\hat{y} = P y = X X^{+} y $$\nThe epigenetic age acceleration, $AgeAccelGrim$, is defined as the vector of residuals, $r$, which is the component of $y$ orthogonal to the column space of $X$. It is computed by subtracting the fitted values from the observed values:\n$$ r = y - \\hat{y} = (I - P)y = (I - X X^{+})y $$\nwhere $I$ is the $n \\times n$ identity matrix. Each element $r_i$ of the vector $r$ represents the deviation of an individual's GrimAge from the expected value based on their chronological age and other covariates in the model, measured in years.\n\n### Model Specifications\n\nTwo specific models are to be constructed:\n\n1.  **Model A (age-only):** This model regresses GrimAge on chronological age. The design matrix $X_A \\in \\mathbb{R}^{n \\times 2}$ is:\n    $$ X_A = [\\mathbf{1}, age] $$\n    where $age$ is the vector of chronological ages. The corresponding age acceleration is $r_A = (I - X_A X_A^{+})y$.\n\n2.  **Model B (age and sex):** This model includes sex as an additional covariate. The design matrix $X_B \\in \\mathbb{R}^{n \\times 3}$ is:\n    $$ X_B = [\\mathbf{1}, age, sex] $$\n    where $sex$ is a binary vector (e.g., $0$ for female, $1$ for male). The corresponding age acceleration is $r_B = (I - X_B X_B^{+})y$. The use of $X_B^{+}$ correctly handles cases where the $sex$ column might be constant, causing collinearity with the intercept column $\\mathbf{1}$.\n\n### Orthogonality Property\n\nA fundamental property of OLS is that the residual vector $r$ is orthogonal to every column vector $x_j$ in the design matrix $X$. This is expressed as $X^\\top r = 0$. For any column $x_j$, the inner product with the residual vector is zero:\n$$ x_j^\\top r = 0 $$\nThis property confirms that the variance explained by the predictors has been fully removed from the residuals. For this problem, we numerically verify this by checking if the absolute value of the inner product is less than a small tolerance, $\\tau = 10^{-10}$. Specifically, we must check:\n- For Model A: $|age^\\top r_A| < \\tau$.\n- For Model B: $|age^\\top r_B| < \\tau$ and $|sex^\\top r_B| < \\tau$.\n\n### Correlation with an External Variable\n\nTo evaluate if the age acceleration metric captures health-related information not already present in its constituent predictors (age and sex), we compute its Pearson correlation coefficient with an external mortality risk index, $m$. For the residual vector $r_B$ from Model B and the risk index vector $m$, the correlation $\\rho_{r_B, m}$ is:\n$$ \\rho_{r_B, m} = \\frac{\\sum_{i=1}^n (r_{B,i} - \\bar{r}_B)(m_i - \\bar{m})}{\\sqrt{\\sum_{i=1}^n (r_{B,i} - \\bar{r}_B)^2} \\sqrt{\\sum_{i=1}^n (m_i - \\bar{m})^2}} $$\nwhere $\\bar{r}_B$ and $\\bar{m}$ are the sample means of the respective vectors. If the sample standard deviation of either $r_B$ or $m$ is zero, the denominator becomes zero. By convention specified in the problem, the correlation is defined as $0.0$ in this situation.\n\n### Computational Procedure Summary\n\nFor each test case, the following steps are performed:\n1.  Construct the design matrices $X_A$ and $X_B$ from the given $age$ and $sex$ vectors, prepending a column of ones for the intercept.\n2.  Compute the Moore-Penrose pseudoinverse for each design matrix, $X_A^{+}$ and $X_B^{+}$.\n3.  Calculate the residual vectors $r_A$ and $r_B$ using the formula $r = y - X(X^{+} y)$.\n4.  Verify the orthogonality conditions by computing the required inner products and comparing their absolute values against the tolerance of $10^{-10}$.\n5.  Compute the Pearson correlation coefficient between $r_B$ and the provided mortality vector $m$, handling the zero standard deviation case as specified.\n6.  Round the residuals and the correlation coefficient to three decimal places and assemble the results into the specified nested list format.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and generate the final output.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"age\": np.array([45, 50, 55, 60, 65, 70, 75, 80]),\n            \"sex\": np.array([0, 1, 0, 1, 0, 1, 0, 1]),\n            \"y\": np.array([51.05, 59.8, 62.15, 70.9, 72.35, 80.7, 83.25, 91.6]),\n            \"m\": np.array([9.16, 10.56, 9.58, 10.98, 9.37, 10.49, 9.65, 10.77])\n        },\n        {\n            \"age\": np.array([40, 44, 48, 52, 56, 60]),\n            \"sex\": np.array([0, 0, 0, 0, 0, 0]),\n            \"y\": np.array([44.0, 49.0, 54.0, 59.0, 64.0, 66.5]),\n            \"m\": np.array([3.4, 4.2, 5.0, 5.8, 6.6, 5.4])\n        },\n        {\n            \"age\": np.array([30, 40, 50, 60]),\n            \"sex\": np.array([1, 1, 1, 1]),\n            \"y\": np.array([43, 55, 67, 79]),\n            \"m\": np.array([8.0, 8.0, 8.0, 8.0])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = compute_age_acceleration_metrics(\n            case[\"age\"], case[\"sex\"], case[\"y\"], case[\"m\"]\n        )\n        results.append(result)\n\n    # Convert the final list of lists to the required string format.\n    # The default str() for a list adds spaces, so we build the string manually.\n    final_output_str = \"[\" + \",\".join(map(str, results)) + \"]\"\n    final_output_str = final_output_str.replace(\" \", \"\") # Ensure no spaces\n    print(final_output_str)\n\n\ndef compute_age_acceleration_metrics(age, sex, y, m):\n    \"\"\"\n    Computes AgeAccelGrim residuals and related metrics for a single case.\n    \n    Args:\n        age (np.array): Vector of chronological ages.\n        sex (np.array): Vector of sex encodings (0/1).\n        y (np.array): Vector of GrimAge values.\n        m (np.array): Vector of mortality risk index values.\n        \n    Returns:\n        list: A nested list containing the required outputs for one test case.\n    \"\"\"\n    n = len(age)\n    intercept = np.ones(n)\n    tolerance = 1e-10\n\n    # --- Model A (age-only) ---\n    # Construct design matrix X_A = [1, age]\n    X_A = np.vstack([intercept, age]).T\n    \n    # Compute residuals r_A = y - X_A * X_A^+ * y\n    X_A_pinv = np.linalg.pinv(X_A)\n    y_hat_A = X_A @ X_A_pinv @ y\n    r_A = y - y_hat_A\n    \n    # Verify orthogonality: dot product of age vector and residual vector\n    ortho_A_check = abs(np.dot(age, r_A)) < tolerance\n    \n    # --- Model B (age and sex) ---\n    # Construct design matrix X_B = [1, age, sex]\n    X_B = np.vstack([intercept, age, sex]).T\n    \n    # Compute residuals r_B = y - X_B * X_B^+ * y\n    X_B_pinv = np.linalg.pinv(X_B)\n    y_hat_B = X_B @ X_B_pinv @ y\n    r_B = y - y_hat_B\n    \n    # Verify orthogonality: dot products of age/sex vectors with residual vector\n    ortho_B_check_age = abs(np.dot(age, r_B)) < tolerance\n    ortho_B_check_sex = abs(np.dot(sex, r_B)) < tolerance\n    ortho_B_checks = [ortho_B_check_age, ortho_B_check_sex]\n\n    # --- Correlation with mortality risk index ---\n    # Handle the case where standard deviation is zero\n    if np.std(r_B) == 0 or np.std(m) == 0:\n        correlation = 0.0\n    else:\n        # np.corrcoef returns a 2x2 matrix, we need the off-diagonal element\n        corr_matrix = np.corrcoef(r_B, m)\n        correlation = corr_matrix[0, 1]\n    \n    # Check for NaN just in case of floating point issues leading to non-zero std\n    if np.isnan(correlation):\n        correlation = 0.0\n\n    # --- Format output ---\n    residuals_A_rounded = np.round(r_A, 3).tolist()\n    residuals_B_rounded = np.round(r_B, 3).tolist()\n    correlation_rounded = round(correlation, 3)\n\n    return [\n        residuals_A_rounded,\n        residuals_B_rounded,\n        ortho_A_check,\n        ortho_B_checks,\n        correlation_rounded\n    ]\n\n# Execute the main function\nsolve()\n```", "id": "4336995"}]}