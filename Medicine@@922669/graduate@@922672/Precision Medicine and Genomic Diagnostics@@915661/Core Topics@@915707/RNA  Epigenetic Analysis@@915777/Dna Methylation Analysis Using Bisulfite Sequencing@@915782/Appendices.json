{"hands_on_practices": [{"introduction": "The foundation of bisulfite sequencing is the chemical conversion of unmethylated cytosines, but this process is not perfectly efficient. This exercise demonstrates how to mathematically correct for both incomplete conversion of unmethylated cytosines and the unintended deamination of methylated ones. By deriving and applying a correction formula from first principles, you will learn to transform raw sequencing counts into a more accurate, quantitative estimate of the true methylation fraction at a specific site [@problem_id:5143326].", "problem": "A laboratory is comparing cytosine methylation at a single Cytosine–phosphate–Guanine (CpG) dinucleotide in matched tissues processed as fresh-frozen and Formalin-Fixed Paraffin-Embedded (FFPE). Deoxyribonucleic Acid (DNA) was extracted from both tissues using validated, matrix-appropriate protocols. Sodium bisulfite conversion was performed; spike-in controls quantified that under this protocol the probability that an unmethylated cytosine deaminates to uracil (and is read as thymine) is $c_{u} = 0.95$, and the probability that a methylated cytosine deaminates (and is read as thymine) is $d_{m} = 0.02$. At the CpG of interest, bisulfite sequencing yielded the following counts: in the fresh-frozen sample, $78$ reads report cytosine and $42$ report thymine out of $120$ total reads; in the FFPE sample, $30$ reads report cytosine and $50$ report thymine out of $80$ total reads. \n\nStarting only from the definitions that (i) bisulfite conversion deaminates unmethylated cytosines to uracil with probability $c_{u}$ while methylated cytosines remain as cytosine with probability $1 - d_{m}$, and (ii) the observed cytosine fraction equals the total probability of observing cytosine aggregated over the true methylation states, derive an estimator for the true methylation fraction $p$ in terms of the observed cytosine fraction $y$, $c_{u}$, and $d_{m}$. Then, use this estimator and the data above to compute the corrected difference in true methylation between fresh-frozen and FFPE, defined as $p_{\\mathrm{fresh}} - p_{\\mathrm{FFPE}}$. Round your answer to $4$ significant figures. Express the final result as a unitless fraction.", "solution": "We begin from the probabilistic model of bisulfite conversion and observation. Let $p$ denote the true methylation fraction at the CpG, that is, the probability that a randomly selected DNA molecule has a methylated cytosine at the site prior to bisulfite treatment. Let $y$ denote the observed fraction of reads reporting cytosine after bisulfite treatment and sequencing.\n\nBy definition of the bisulfite chemistry under the stated protocol, an unmethylated cytosine is deaminated (and will be read as thymine) with probability $c_{u}$, so it is observed as cytosine with probability $1 - c_{u}$. A methylated cytosine is resistant to bisulfite but can undergo unintended deamination with probability $d_{m}$, so it is observed as cytosine with probability $1 - d_{m}$.\n\nUsing the law of total probability, the observed cytosine fraction $y$ is the sum over the two mutually exclusive true states (methylated versus unmethylated):\n$$\ny \\;=\\; \\underbrace{p}_{\\text{true methylated}}\\cdot \\underbrace{(1 - d_{m})}_{\\text{observed as cytosine}} \\;+\\; \\underbrace{(1 - p)}_{\\text{true unmethylated}}\\cdot \\underbrace{(1 - c_{u})}_{\\text{observed as cytosine}}.\n$$\nThis simplifies algebraically:\n$$\ny \\;=\\; p(1 - d_{m}) + (1 - p)(1 - c_{u}) \\;=\\; (1 - c_{u}) + p\\big[(1 - d_{m}) - (1 - c_{u})\\big] \\;=\\; (1 - c_{u}) + p(c_{u} - d_{m}).\n$$\nSolving for $p$ gives the estimator:\n$$\n\\hat{p} \\;=\\; \\frac{y - (1 - c_{u})}{c_{u} - d_{m}}.\n$$\n\nWe now compute $y$ for each sample and apply the estimator. For the fresh-frozen sample, the observed cytosine fraction is\n$$\ny_{\\mathrm{fresh}} \\;=\\; \\frac{78}{120} \\;=\\; 0.65.\n$$\nWith $c_{u} = 0.95$ and $d_{m} = 0.02$, we have\n$$\n\\hat{p}_{\\mathrm{fresh}} \\;=\\; \\frac{0.65 - (1 - 0.95)}{0.95 - 0.02} \\;=\\; \\frac{0.65 - 0.05}{0.93} \\;=\\; \\frac{0.60}{0.93}.\n$$\n\nFor the FFPE sample, the observed cytosine fraction is\n$$\ny_{\\mathrm{FFPE}} \\;=\\; \\frac{30}{80} \\;=\\; 0.375,\n$$\nand thus\n$$\n\\hat{p}_{\\mathrm{FFPE}} \\;=\\; \\frac{0.375 - (1 - 0.95)}{0.95 - 0.02} \\;=\\; \\frac{0.375 - 0.05}{0.93} \\;=\\; \\frac{0.325}{0.93}.\n$$\n\nThe corrected difference in true methylation is\n$$\n\\hat{p}_{\\mathrm{fresh}} - \\hat{p}_{\\mathrm{FFPE}} \\;=\\; \\frac{0.60}{0.93} - \\frac{0.325}{0.93} \\;=\\; \\frac{0.275}{0.93}.\n$$\nWe evaluate this quotient to obtain a numeric value and round to $4$ significant figures:\n$$\n\\frac{0.275}{0.93} \\;\\approx\\; 0.2956989247\\ldots \\;\\to\\; 0.2957 \\text{ (unitless)}.\n$$\n\nInterpretation in differential methylation analysis: The derivation shows that incomplete conversion of unmethylated cytosine (quantified by $1 - c_{u}$) inflates observed cytosine counts, while unintended deamination of methylated cytosine (quantified by $d_{m}$) deflates them. Correcting both biases yields a linear deconvolution for the true methylation fraction. When comparing fresh-frozen and FFPE tissues, the same misclassification parameters can be applied if they are validated for each matrix (for example, via spike-ins processed alongside each sample type). If $c_{u}$ or $d_{m}$ differ by matrix due to extraction-induced damage or crosslinks typical of FFPE, matrix-specific calibration should be used; otherwise, uncorrected comparisons may misattribute conversion artifacts to biological differences. Under the stated, validated parameters, the fresh-frozen sample exhibits a higher true methylation by approximately $0.2957$ in fractional units at this CpG.", "answer": "$$\\boxed{0.2957}$$", "id": "5143326"}, {"introduction": "Beyond the chemistry of bisulfite conversion, the underlying genetic sequence itself can be a major source of artifacts in methylation analysis. This practice explores how a Single Nucleotide Polymorphism (SNP) that abolishes a CpG site can be mistaken for a change in methylation status. By disentangling the genetic signal from the epigenetic one using the variant allele fraction, you will develop a critical skill for avoiding false conclusions, particularly in genetically diverse samples such as human cohorts or heterogeneous tumors [@problem_id:4334576].", "problem": "A cancer biopsy is analyzed using Whole-Genome Bisulfite Sequencing (WGBS), and methylation is called at a reference cytosine followed by guanine on the forward strand (a CpG site). In bisulfite conversion, unmethylated cytosines are deaminated to uracil and sequenced as thymine, whereas methylated cytosines remain cytosines. The basic methylation estimator at a cytosine position is defined as the fraction of reads with cytosine over the total reads covering that position. Consider the following data at a single CpG site: total coverage is $N = 360$, with observed cytosine count $n_C = 108$ and thymine count $n_T = 252$, giving a naive methylation estimate $\\hat{m} = n_C/(n_C+n_T)$. Variant calling from the same sample yields a Variant Call Format (VCF) entry indicating a Single Nucleotide Polymorphism (SNP) that turns the CpG cytosine into thymine ($C \\to T$) with variant allele fraction $p = 0.25$, abolishing the CpG on that allele. There are no called variants at the adjacent guanine. The sample is approximately diploid at this locus with no copy number alteration.\n\nFrom first principles, explain how to identify and filter CpG sites affected by Single Nucleotide Polymorphisms (SNPs) or short Insertions/Deletions (indels) that create or abolish CpGs in bisulfite sequencing analysis, accounting for both strands of Deoxyribonucleic Acid (DNA) and small indels overlapping the dinucleotide. Then, under the stated assumptions, quantify the impact of the $C \\to T$ SNP on the naive methylation estimate and provide a corrected methylation estimate for this site. Choose the option that most accurately describes a scientifically sound identification/filtering strategy and provides the correct quantitative impact and corrected estimate.\n\nOptions:\nA. Scan the sample’s VCF for any variant that affects either base of the CpG on either strand: at the CpG cytosine, any substitution away from cytosine; at the adjacent guanine, any substitution away from guanine; and one-base indels that remove or insert a base within the $2$-nucleotide window such that the `$5'$-cytosine` or `$3'$-guanine` is deleted or a new CpG is created (for instance, inserting guanine adjacent to cytosine). Mask such positions, or adjust methylation estimates using the variant allele fraction. For a CpG-abolishing SNP with allele fraction $p$, the expected naive estimate satisfies $\\hat{m} = (1-p)m$, where $m$ is the true methylation on alleles that still contain the CpG, so the corrected estimate is $\\tilde{m} = \\hat{m}/(1-p)$. With $N = 360$, $n_C = 108$, $n_T = 252$, and $p = 0.25$, $\\hat{m} = 0.30$, yielding $\\tilde{m} = 0.30/0.75 = 0.40$. The naive estimate is biased downward by a multiplicative factor $(1-p)$ and an absolute shift of $-pm$.\n\nB. Identify only SNPs at the cytosine position on the forward (reference) strand; ignore variants at the guanine and reverse strand complement and ignore indels. Correct for CpG-abolishing SNPs by multiplying the naive estimate by $(1-p)$, i.e., $\\tilde{m} = (1-p)\\hat{m}$. With $p = 0.25$ and $\\hat{m} = 0.30$, report $\\tilde{m} = 0.225$ and state that the naive estimate is unbiased if alignments are high quality.\n\nC. Use a population Minor Allele Frequency (MAF) threshold to flag sites, without considering the sample’s VCF or strand symmetry, and correct CpG-abolishing SNPs by additive adjustment $\\tilde{m} = \\hat{m} + p$. With $p = 0.25$ and $\\hat{m} = 0.30$, report $\\tilde{m} = 0.55$, and claim the naive estimate is biased downward by $p$ irrespective of the true methylation $m$.\n\nD. Rely on bisulfite-aware aligners to ignore mismatches due to SNPs, assuming reads from CpG-abolishing alleles do not contribute to cytosine/thymine counts at CpG positions. Therefore, no special identification/filtering is required, and the naive estimate equals the true methylation ($\\hat{m} = m$). With $N = 360$, $n_C = 108$, and $n_T = 252$, report $\\tilde{m} = 0.30$ and no bias.\n\nE. Identify variants at the cytosine but treat changes at the adjacent guanine as harmless because guanine is not directly converted by bisulfite chemistry; incorporate indels only if they exceed $5$ bases. Correct for CpG-abolishing SNPs by $\\tilde{m} = (\\hat{m}-p)/(1-p)$, yielding $\\tilde{m} = (0.30-0.25)/0.75 \\approx 0.0667$, and conclude that the naive estimate is biased downward by exactly $p$ regardless of $m$.", "solution": "The user has provided a problem concerning the analysis of DNA methylation data from Whole-Genome Bisulfite Sequencing (WGBS) in the presence of a Single Nucleotide Polymorphism (SNP). The task is to validate the problem, explain the principles for handling such genetic variation, and calculate a corrected methylation estimate.\n\n### Step 1: Extract Givens\n\n-   **Analysis Method:** Whole-Genome Bisulfite Sequencing (WGBS)\n-   **Biological Context:** A cancer biopsy sample, approximately diploid with no copy number alteration at the locus of interest.\n-   **Site of Interest:** A reference CpG site (a cytosine followed by a guanine on the forward strand).\n-   **Bisulfite Conversion Chemistry:** Unmethylated cytosines (C) are converted to uracil (U), which are then read as thymine (T) during sequencing. Methylated cytosines (mC) are protected from conversion and remain as C.\n-   **Sequencing Data at the CpG site:**\n    -   Total read coverage: $N = 360$.\n    -   Observed cytosine count: $n_C = 108$.\n    -   Observed thymine count: $n_T = 252$. (Note: $n_C + n_T = 108 + 252 = 360 = N$, which is consistent).\n-   **Naive Methylation Estimator:** $\\hat{m} = n_C / (n_C + n_T)$.\n-   **Genetic Variant Information (from a VCF file):**\n    -   A Single Nucleotide Polymorphism (SNP) exists at the CpG cytosine: $C \\to T$.\n    -   This SNP abolishes the CpG site for the allele carrying the variant.\n    -   The variant allele fraction is given as $p = 0.25$.\n    -   No variants are called at the adjacent guanine.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientific Grounding:** The problem is firmly grounded in the established principles of molecular biology, genomics, and bioinformatics. The description of CpG sites, bisulfite sequencing chemistry, methylation estimation, and the confounding effect of SNPs on methylation calls are all standard and scientifically accurate concepts in the field of epigenetics.\n-   **Well-Posedness:** The problem is well-posed. It provides all necessary quantitative data ($N$, $n_C$, $n_T$, $p$) and a clear set of assumptions (diploid locus, no other variants) to allow for the derivation of a unique, corrected methylation estimate. The qualitative part of the question, asking for a general strategy, is also well-defined within the context of the field.\n-   **Objectivity:** The problem statement is expressed in precise, objective, and technical language, free from ambiguity or subjective claims.\n\n-   **Flaw Checklist Assessment:**\n    1.  **Scientific/Factual Unsoundness:** None. The premises are factually correct.\n    2.  **Non-Formalizable/Irrelevant:** None. The problem is a standard, formalizable issue in quantitative genomics.\n    3.  **Incomplete/Contradictory Setup:** None. The given data are complete and internally consistent ($n_C + n_T = N$).\n    4.  **Unrealistic/Infeasible:** None. The coverage depth, read counts, and allele fraction are all realistic values for a typical WGBS experiment on a heterozygous SNP.\n    5.  **Ill-Posed/Poorly Structured:** None. A unique solution can be derived from the provided information.\n    6.  **Pseudo-Profound/Trivial:** None. The problem addresses a genuine and non-trivial challenge in bisulfite sequencing analysis that requires careful quantitative reasoning.\n    7.  **Outside Scientific Verifiability:** None. The model and its predictions are verifiable.\n\n### Step 3: Verdict and Action\n\nThe problem statement is **VALID**. I will proceed with deriving the solution and evaluating the options.\n\n### Solution Derivation\n\n**Part 1: General Strategy for Identifying and Filtering CpG Sites Affected by Variants**\n\nA CpG site is a dinucleotide, $5'$-C-G-$3'$. Due to the complementary nature of DNA, a CpG on the forward strand corresponds to a CpG on the reverse strand ($5'$-C-G-$3'$ on the reverse complement). Therefore, a robust analysis must consider variants that could disrupt this dinucleotide on either strand.\n\nA variant can create or abolish a CpG site.\n1.  **Abolishing a CpG:**\n    -   A substitution at the cytosine position (e.g., $C \\to T$, $C \\to A$, or $C \\to G$) on the forward strand directly removes the site of methylation.\n    -   A substitution at the guanine position (e.g., $G \\to A$, $G \\to T$, or $G \\to C$) on the forward strand breaks the CpG context. This also corresponds to a $C \\to T$, $C \\to A$, or $C \\to G$ substitution at the cytosine of the reverse-strand CpG, abolishing it.\n    -   A short deletion that removes either the C or the G.\n    -   A short insertion between the C and the G (e.g., $CG \\to CTG$).\n2.  **Creating a CpG:**\n    -   A substitution that creates a C followed by a G where there was none before (e.g., $TG \\to CG$ or $CA \\to CG$).\n    -   An indel that results in a new CG dinucleotide.\n\nTherefore, a scientifically sound identification and filtering strategy requires integrating variant call data (e.g., from a VCF file) with CpG site locations. Specifically, one must scan the VCF for any variant—SNP or short indel—whose position overlaps with the two-base-pair window of a CpG dinucleotide. Any site affected by such a variant should be either masked (excluded from analysis) or have its methylation estimate corrected using the variant allele fraction, if available from non-bisulfite sequencing data.\n\n**Part 2: Quantitative Correction of the Methylation Estimate**\n\nLet $m$ be the true methylation fraction of the cytosines on the alleles that genuinely contain a CpG site.\nLet $p$ be the variant allele fraction of the SNP ($C \\to T$).\nThe fraction of alleles that are reference (contain C) is $(1-p)$.\nThe fraction of alleles that are variant (contain T) is $p$.\n\nThe total number of reads covering the position is $N$. These reads are sampled from the two allele populations.\n-   Number of reads from reference (C-containing) alleles is expected to be $N_{ref} = N(1-p)$.\n-   Number of reads from variant (T-containing) alleles is expected to be $N_{var} = Np$.\n\nNow, let's model the expected counts of observed C's and T's after bisulfite sequencing.\n-   An observed cytosine ($C$) can only arise from a methylated cytosine on a reference allele. The expected count is $E[n_C] = N_{ref} \\times m = N(1-p)m$.\n-   An observed thymine ($T$) can arise from two sources:\n    1.  An unmethylated cytosine on a reference allele, which is converted to T. The expected count is $N_{ref} \\times (1-m) = N(1-p)(1-m)$.\n    2.  A thymine from a variant allele, which is read as T. The expected count is $N_{var} = Np$.\n    The total expected count of thymines is $E[n_T] = N(1-p)(1-m) + Np$.\n\nThe naive methylation estimate, $\\hat{m}$, is defined as the fraction of observed C reads:\n$$ \\hat{m} = \\frac{n_C}{N} = \\frac{n_C}{n_C + n_T} $$\nThe expected value of this estimator is:\n$$ E[\\hat{m}] = \\frac{E[n_C]}{N} = \\frac{N(1-p)m}{N} = (1-p)m $$\nThis shows that the naive estimator $\\hat{m}$ is a biased estimator of the true methylation level $m$. The bias is $E[\\hat{m}] - m = (1-p)m - m = -pm$. The naive estimate is an underestimate, with the magnitude of the bias dependent on both the allele fraction $p$ and the true methylation level $m$.\n\nTo find a corrected estimator for $m$, which we denote $\\tilde{m}$, we can rearrange the relationship $E[\\hat{m}] = (1-p)m$. We use the observed value $\\hat{m}$ as an estimate for its expectation $E[\\hat{m}]$.\n$$ \\hat{m} \\approx (1-p)m $$\nSolving for $m$ gives the corrected estimator:\n$$ \\tilde{m} = \\frac{\\hat{m}}{1-p} $$\n\n**Part 3: Calculation with Given Data**\n\n-   $N = 360$, $n_C = 108$, $n_T = 252$.\n-   $p = 0.25$.\n\nFirst, calculate the naive methylation estimate:\n$$ \\hat{m} = \\frac{n_C}{N} = \\frac{108}{360} = 0.30 $$\nNext, calculate the corrected methylation estimate using the derived formula:\n$$ \\tilde{m} = \\frac{\\hat{m}}{1-p} = \\frac{0.30}{1 - 0.25} = \\frac{0.30}{0.75} = \\frac{30}{75} = \\frac{2}{5} = 0.40 $$\nThe corrected methylation level for the CpG-containing alleles is $0.40$ or $40\\%$.\n\nLet's verify this result with the original counts. If $m=0.40$ is the true methylation:\n-   Expected $n_C = N(1-p)m = 360 \\times (1-0.25) \\times 0.40 = 360 \\times 0.75 \\times 0.40 = 270 \\times 0.40 = 108$.\n-   Expected $n_T = N(1-p)(1-m) + Np = 360 \\times 0.75 \\times (1-0.40) + 360 \\times 0.25 = 270 \\times 0.60 + 90 = 162 + 90 = 252$.\nThe calculated true methylation level perfectly explains the observed read counts.\n\n### Option-by-Option Analysis\n\n**A. Scan the sample’s VCF for any variant that affects either base of the CpG on either strand... and one-base indels... Mask such positions, or adjust methylation estimates... For a CpG-abolishing SNP with allele fraction $p$, the expected naive estimate satisfies $\\hat{m} = (1-p)m$... so the corrected estimate is $\\tilde{m} = \\hat{m}/(1-p)$. With $N = 360$, $n_C = 108$, $n_T = 252$, and $p = 0.25$, $\\hat{m} = 0.30$, yielding $\\tilde{m} = 0.30/0.75 = 0.40$. The naive estimate is biased downward by a multiplicative factor $(1-p)$ and an absolute shift of $-pm$.**\n-   **Identification Strategy:** Correct. It is comprehensive, considering both bases of the CpG, by extension both strands, and relevant short indels.\n-   **Correction Formula:** Correct. The formula $\\tilde{m} = \\hat{m}/(1-p)$ is precisely what was derived from first principles.\n-   **Calculation:** Correct. $\\hat{m} = 108/360 = 0.30$, and $\\tilde{m} = 0.30/0.75 = 0.40$.\n-   **Bias Description:** Correct. The expectation $E[\\hat{m}]$ is indeed $(1-p)m$, and the absolute bias is $E[\\hat{m}] - m = -pm$.\n-   **Verdict:** **Correct**.\n\n**B. Identify only SNPs at the cytosine position on the forward (reference) strand; ignore variants at the guanine and reverse strand complement and ignore indels. Correct... by multiplying... $\\tilde{m} = (1-p)\\hat{m}$. With $p = 0.25$ and $\\hat{m} = 0.30$, report $\\tilde{m} = 0.225$ and state that the naive estimate is unbiased...**\n-   **Identification Strategy:** Incorrect. This strategy is incomplete and would miss many CpG-disrupting variants.\n-   **Correction Formula:** Incorrect. The formula should be division by $(1-p)$, not multiplication.\n-   **Calculation:** The calculation $0.30 \\times 0.75 = 0.225$ is arithmetically correct for the wrong formula. The resulting estimate is incorrect.\n-   **Bias Description:** Incorrect. The naive estimate is demonstrably biased.\n-   **Verdict:** **Incorrect**.\n\n**C. Use a population Minor Allele Frequency (MAF) threshold... without considering the sample’s VCF... correct... by additive adjustment $\\tilde{m} = \\hat{m} + p$. With $p = 0.25$ and $\\hat{m} = 0.30$, report $\\tilde{m} = 0.55$, and claim the naive estimate is biased downward by $p$ irrespective of the true methylation $m$.**\n-   **Identification Strategy:** Incorrect. Sample-specific VCF is superior to population MAF.\n-   **Correction Formula:** Incorrect. The formula $\\tilde{m} = \\hat{m} + p$ is not derived from the underlying model.\n-   **Calculation:** The calculation $0.30 + 0.25 = 0.55$ is arithmetically correct for the wrong formula. The result is incorrect.\n-   **Bias Description:** Incorrect. The bias is $-pm$, not a constant $-p$.\n-   **Verdict:** **Incorrect**.\n\n**D. Rely on bisulfite-aware aligners to ignore mismatches due to SNPs, assuming reads from CpG-abolishing alleles do not contribute to cytosine/thymine counts... no special identification/filtering is required, and the naive estimate equals the true methylation... report $\\tilde{m} = 0.30$ and no bias.**\n-   **Identification Strategy:** Incorrect. This demonstrates a misunderstanding of how bisulfite aligners work. They cannot distinguish a genetic T from a bisulfite-converted T. Reads from variant alleles definitely contribute to the counts.\n-   **Correction Formula:** Incorrect. It claims no correction is needed.\n-   **Conclusion:** Incorrect. The naive estimate is biased, so reporting $\\tilde{m} = \\hat{m} = 0.30$ is wrong.\n-   **Verdict:** **Incorrect**.\n\n**E. Identify variants at the cytosine but treat changes at the adjacent guanine as harmless... incorporate indels only if they exceed $5$ bases. Correct... by $\\tilde{m} = (\\hat{m}-p)/(1-p)$, yielding $\\tilde{m} = (0.30-0.25)/0.75 \\approx 0.0667$, and conclude that the naive estimate is biased downward by exactly $p$ regardless of $m$.**\n-   **Identification Strategy:** Incorrect. Changes at the guanine are not harmless, and the indel threshold is arbitrary and inappropriate.\n-   **Correction Formula:** Incorrect. The formula $\\tilde{m} = (\\hat{m}-p)/(1-p)$ is not justifiable from first principles and leads to a biased estimator.\n-   **Calculation:** The calculation $(0.30-0.25)/0.75 \\approx 0.0667$ is arithmetically correct for the wrong formula. The result is incorrect.\n-   **Bias Description:** Incorrect. Again, the bias is $-pm$, not a constant value.\n-   **Verdict:** **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "4334576"}, {"introduction": "When analyzing multiple biological replicates, the variation in methylation levels often exceeds what can be explained by technical sequencing noise alone. This \"overdispersion\" is rooted in true biological heterogeneity among samples. This advanced problem introduces a powerful hierarchical framework, the Beta-Binomial model, to properly account for this variability. Deriving the posterior mean methylation level will provide you with a robust statistical tool essential for performing reliable differential methylation analysis [@problem_id:4334596].", "problem": "In precision oncology, cytosine methylation at promoter regions can modulate gene expression and influence clinical phenotypes. Sodium bisulfite treatment coupled to high-throughput sequencing (bisulfite sequencing) converts unmethylated cytosines to uracil (read as thymine), while methylated cytosines remain cytosine. At a single cytosine–phosphate–guanine (CpG) site interrogated by Whole-Genome Bisulfite Sequencing (WGBS), consider $R$ biological replicates. In replicate $r \\in \\{1,\\dots,R\\}$, suppose $n_r$ independent reads cover the CpG, and $y_r$ of these reads report methylation (i.e., cytosine is observed). Let $p_r$ denote the true methylation probability in replicate $r$. Assume bisulfite conversion and base-calling errors are negligible relative to biological variability so that, conditional on $p_r$, each read is a Bernoulli trial with success probability $p_r$.\n\nTo account for overdispersion across biological replicates induced by heterogeneity (for example, cell-type mixture and epigenetic variability), model the replicate-specific methylation probabilities using a hierarchical formulation where $p_r$ are independent draws from a Beta distribution with parameters $(\\alpha,\\beta)$:\n- Conditional sampling: $Y_r \\mid p_r \\sim \\mathrm{Binomial}(n_r, p_r)$,\n- Random effects: $p_r \\sim \\mathrm{Beta}(\\alpha,\\beta)$,\nwith common $(\\alpha,\\beta)$ across replicates for a fixed CpG site.\n\nStarting from the definitions of the Binomial and Beta distributions, and the Beta function $B(a,b) = \\int_{0}^{1} t^{a-1} (1-t)^{b-1} \\,\\mathrm{d}t$ for $a>0$, $b>0$, complete the following tasks:\n\n- Formulate the marginal sampling model for $Y_r$ by integrating out $p_r$, establishing the Beta-Binomial distribution that captures overdispersion across replicates in terms of $(\\alpha,\\beta)$ and $n_r$.\n- Using the conjugacy of the Beta distribution to the Binomial likelihood, derive the posterior distribution of $p_r$ given observed counts $(y_r, n_r)$ under the Beta prior $\\mathrm{Beta}(\\alpha,\\beta)$.\n- From that posterior distribution, derive the posterior mean $\\mathbb{E}[\\,p_r \\mid y_r, n_r, \\alpha, \\beta\\,]$ as a closed-form analytic expression in $(\\alpha,\\beta,y_r,n_r)$.\n\nYour final answer must be the closed-form analytic expression for the posterior mean of $p_r$. No numerical evaluation is required. If you introduce any angle quantities, express them in radians. If you introduce any physical units, specify them explicitly; however, for this problem, there are no physical units in the final expression. Do not write your answer as an inequality or an equation; provide a single closed-form expression only.", "solution": "The problem statement has been evaluated and is deemed valid. It is scientifically grounded in the field of statistical genomics, specifically in the analysis of bisulfite sequencing data for DNA methylation. The problem is well-posed, providing a complete and consistent hierarchical statistical model and asking for the derivation of a specific, well-defined quantity (the posterior mean). The language used is objective and formal. The tasks are logically structured and require a standard, non-trivial derivation in Bayesian statistics. There are no contradictions, ambiguities, or factual unsoundness.\n\nThe problem requires the derivation of the posterior mean of the methylation probability $p_r$ for a given CpG site in a replicate $r$. The model is specified as a hierarchical structure:\n1.  The likelihood for the observed number of methylated reads, $y_r$, out of a total of $n_r$ reads, is given by a Binomial distribution, conditional on the true methylation probability $p_r$:\n    $$P(Y_r = y_r \\mid p_r, n_r) = \\binom{n_r}{y_r} p_r^{y_r} (1-p_r)^{n_r-y_r}$$\n    This is the PMF of the $\\mathrm{Binomial}(n_r, p_r)$ distribution.\n\n2.  The prior distribution for the replicate-specific methylation probability, $p_r$, is given by a Beta distribution with hyperparameters $\\alpha$ and $\\beta$:\n    $$f(p_r \\mid \\alpha, \\beta) = \\frac{p_r^{\\alpha-1} (1-p_r)^{\\beta-1}}{B(\\alpha, \\beta)}$$\n    This is the PDF of the $\\mathrm{Beta}(\\alpha, \\beta)$ distribution, where $B(\\alpha, \\beta)$ is the Beta function, defined as $B(\\alpha,\\beta) = \\int_{0}^{1} t^{\\alpha-1} (1-t)^{\\beta-1} \\,\\mathrm{d}t$.\n\nThe problem asks for three derivations. We will proceed step-by-step.\n\n**Task 1: Formulate the marginal sampling model for $Y_r$.**\nThe marginal probability of observing $y_r$ methylated reads is obtained by integrating the product of the likelihood and the prior over all possible values of $p_r \\in [0, 1]$. This process is known as marginalization.\n\n$$P(Y_r = y_r \\mid n_r, \\alpha, \\beta) = \\int_{0}^{1} P(Y_r = y_r \\mid p_r, n_r) f(p_r \\mid \\alpha, \\beta) \\, \\mathrm{d}p_r$$\n\nSubstituting the expressions for the Binomial PMF and the Beta PDF:\n$$P(Y_r = y_r \\mid n_r, \\alpha, \\beta) = \\int_{0}^{1} \\left[ \\binom{n_r}{y_r} p_r^{y_r} (1-p_r)^{n_r-y_r} \\right] \\left[ \\frac{p_r^{\\alpha-1} (1-p_r)^{\\beta-1}}{B(\\alpha, \\beta)} \\right] \\, \\mathrm{d}p_r$$\n\nWe can take the terms that do not depend on $p_r$ outside the integral:\n$$P(Y_r = y_r \\mid n_r, \\alpha, \\beta) = \\frac{\\binom{n_r}{y_r}}{B(\\alpha, \\beta)} \\int_{0}^{1} p_r^{y_r} (1-p_r)^{n_r-y_r} p_r^{\\alpha-1} (1-p_r)^{\\beta-1} \\, \\mathrm{d}p_r$$\n\nCombining the powers of $p_r$ and $(1-p_r)$:\n$$P(Y_r = y_r \\mid n_r, \\alpha, \\beta) = \\frac{\\binom{n_r}{y_r}}{B(\\alpha, \\beta)} \\int_{0}^{1} p_r^{(y_r + \\alpha) - 1} (1-p_r)^{(n_r - y_r + \\beta) - 1} \\, \\mathrm{d}p_r$$\n\nThe integral on the right-hand side is, by definition, the Beta function $B(y_r + \\alpha, n_r - y_r + \\beta)$. Therefore, the marginal probability is:\n$$P(Y_r = y_r \\mid n_r, \\alpha, \\beta) = \\binom{n_r}{y_r} \\frac{B(y_r + \\alpha, n_r - y_r + \\beta)}{B(\\alpha, \\beta)}$$\nThis is the probability mass function of the Beta-Binomial distribution, denoted as $Y_r \\sim \\mathrm{BetaBinomial}(n_r, \\alpha, \\beta)$. This model correctly captures overdispersion because its variance is greater than that of a simple Binomial model with a fixed probability.\n\n**Task 2: Derive the posterior distribution of $p_r$.**\nUsing Bayes' theorem, the posterior distribution of $p_r$ given the observed data $(y_r, n_r)$ and hyperparameters $(\\alpha, \\beta)$ is proportional to the product of the likelihood and the prior:\n$$f(p_r \\mid y_r, n_r, \\alpha, \\beta) \\propto P(Y_r = y_r \\mid p_r, n_r) \\cdot f(p_r \\mid \\alpha, \\beta)$$\n\nSubstituting the functional forms of the likelihood and prior, and dropping constant factors (terms not depending on $p_r$, such as $\\binom{n_r}{y_r}$ and $1/B(\\alpha, \\beta)$):\n$$f(p_r \\mid y_r, n_r, \\alpha, \\beta) \\propto \\left[ p_r^{y_r} (1-p_r)^{n_r-y_r} \\right] \\cdot \\left[ p_r^{\\alpha-1} (1-p_r)^{\\beta-1} \\right]$$\n\nCombining the exponents:\n$$f(p_r \\mid y_r, n_r, \\alpha, \\beta) \\propto p_r^{y_r + \\alpha - 1} (1-p_r)^{n_r - y_r + \\beta - 1}$$\n\nThis expression is the kernel of a Beta distribution. We can recognize that the posterior distribution of $p_r$ is a Beta distribution with updated parameters $\\alpha'$ and $\\beta'$:\n$$\\alpha' = y_r + \\alpha$$\n$$\\beta' = n_r - y_r + \\beta$$\nThus, the posterior distribution is:\n$$p_r \\mid y_r, n_r, \\alpha, \\beta \\sim \\mathrm{Beta}(y_r + \\alpha, n_r - y_r + \\beta)$$\nThis result illustrates the conjugacy of the Beta prior with the Binomial likelihood: the posterior distribution belongs to the same family (Beta) as the prior distribution.\n\n**Task 3: Derive the posterior mean $\\mathbb{E}[\\,p_r \\mid y_r, n_r, \\alpha, \\beta\\,]$.**\nThe expected value (mean) of a random variable $X$ following a $\\mathrm{Beta}(a, b)$ distribution is given by the formula $\\mathbb{E}[X] = \\frac{a}{a+b}$.\n\nWe apply this formula to our posterior distribution for $p_r$, which is $\\mathrm{Beta}(\\alpha', \\beta')$ with $\\alpha' = y_r + \\alpha$ and $\\beta' = n_r - y_r + \\beta$. The posterior mean is therefore:\n$$\\mathbb{E}[p_r \\mid y_r, n_r, \\alpha, \\beta] = \\frac{\\alpha'}{\\alpha' + \\beta'}$$\n\nSubstituting the expressions for $\\alpha'$ and $\\beta'$:\n$$\\mathbb{E}[p_r \\mid y_r, n_r, \\alpha, \\beta] = \\frac{y_r + \\alpha}{(y_r + \\alpha) + (n_r - y_r + \\beta)}$$\n\nSimplifying the denominator:\n$$\\mathbb{E}[p_r \\mid y_r, n_r, \\alpha, \\beta] = \\frac{y_r + \\alpha}{y_r + \\alpha + n_r - y_r + \\beta} = \\frac{y_r + \\alpha}{n_r + \\alpha + \\beta}$$\n\nThis final expression is the closed-form analytic solution for the posterior mean of the methylation probability $p_r$. It can be interpreted as a \"shrinkage\" estimator, where the sample proportion $\\frac{y_r}{n_r}$ is adjusted towards the prior mean $\\frac{\\alpha}{\\alpha+\\beta}$, with the degree of adjustment determined by the sample size $n_r$ and the strength of the prior, encapsulated by $\\alpha+\\beta$.", "answer": "$$\\boxed{\\frac{y_r + \\alpha}{n_r + \\alpha + \\beta}}$$", "id": "4334596"}]}