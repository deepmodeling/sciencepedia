{"hands_on_practices": [{"introduction": "To effectively personalize warfarin therapy, we must quantitatively integrate the distinct contributions of pharmacokinetics and pharmacodynamics. This practice challenges you to construct a dosing model from the ground up, starting with the Michaelis-Menten kinetics of *CYP2C9* variants and the altered sensitivity of *VKORC1* variants [@problem_id:4395948]. By calculating the relative intrinsic clearance ($Cl_{int}$) and combining it with pharmacodynamic factors, you will develop a powerful understanding of how genetic variations synergistically determine the required maintenance dose.", "problem": "A pharmacogenomic dosing model for the anticoagulant S-warfarin integrates hepatic metabolism by Cytochrome P450 2C9 (CYP2C9) and pharmacodynamic sensitivity via Vitamin K epoxide reductase complex subunit 1 (VKORC1). Assume the following as the fundamental base:\n\n- S-warfarin is a low-extraction, low-substrate-concentration hepatically cleared drug whose oxidative clearance is dominated by CYP2C9-mediated 7-hydroxylation.\n- Under steady-state oral dosing, for a fixed target anticoagulation intensity (International Normalized Ratio (INR)), the required maintenance dose is proportional to the product of hepatic clearance and the pharmacodynamically required effective concentration.\n- Recombinant CYP2C9 allele variants exhibit Michaelis–Menten kinetics for S-warfarin 7-hydroxylation, and in vivo substrate concentrations are much lower than the Michaelis–Menten constant.\n- In a diploid genotype, the two CYP2C9 alleles are expressed equally, and total hepatic CYP2C9 concentration is conserved across genotypes; the net catalytic efficiency is the average of the two allele-specific catalytic efficiencies.\n\nYou are given in vitro kinetic parameters measured for recombinant human CYP2C9 variants with S-warfarin:\n\n- CYP2C9$^{\\ast}1$: $K_{m,1} = 3.0\\,\\mu\\mathrm{M}$, $V_{\\max,1} = 9.0\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1}$.\n- CYP2C9$^{\\ast}2$: $K_{m,2} = 3.2\\,\\mu\\mathrm{M}$, $V_{\\max,2} = 5.4\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1}$.\n- CYP2C9$^{\\ast}3$: $K_{m,3} = 4.5\\,\\mu\\mathrm{M}$, $V_{\\max,3} = 1.2\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1}$.\n\nAdditionally, VKORC1 promoter genotype at position $-1639$ influences the pharmacodynamic concentration requirement to achieve a fixed INR. Let the required effective concentration scale linearly with VKORC1 abundance, and take the ratio of the required concentration for genotype GA relative to GG as $0.70$.\n\nUsing only the fundamental bases above, compute the predicted ratio of the maintenance dose for a patient with genotype CYP2C9$^{\\ast}2/^{\\ast}3$ and VKORC1 $-1639$ GA relative to a reference patient with genotype CYP2C9$^{\\ast}1/^{\\ast}1$ and VKORC1 $-1639$ GG. Round your answer to four significant figures, and express it as a dimensionless decimal (no percent sign).", "solution": "The problem statement is a valid, well-posed problem in pharmacogenomics. It contains all necessary information and is scientifically grounded. We proceed to the solution.\n\nThe problem asks for the ratio of the steady-state maintenance dose of S-warfarin for a test patient to a reference patient. The test patient has genotype CYP2C9$^{\\ast}2/^{\\ast}3$ and VKORC1 $-1639$ GA. The reference patient has genotype CYP2C9$^{\\ast}1/^{\\ast}1$ and VKORC1 $-1639$ GG.\n\nLet $D_{test}$ and $D_{ref}$ be the maintenance doses for the test and reference patients, respectively. According to the problem, the required maintenance dose, $D$, is proportional to the product of hepatic clearance, $Cl_H$, and the pharmacodynamically required effective concentration, $C_{eff}$.\n$$ D \\propto Cl_H \\times C_{eff} $$\nTherefore, the ratio of the doses can be expressed as:\n$$ \\frac{D_{test}}{D_{ref}} = \\frac{Cl_{H, test}}{Cl_{H, ref}} \\times \\frac{C_{eff, test}}{C_{eff, ref}} $$\n\nWe must evaluate the ratio of clearances and the ratio of effective concentrations separately.\n\nFirst, we analyze the hepatic clearance, $Cl_H$. S-warfarin is stated to be a low-extraction drug. For such drugs, hepatic clearance is not limited by hepatic blood flow but is determined by the intrinsic metabolic capacity of the liver. Thus, hepatic clearance is proportional to the intrinsic clearance, $Cl_{int}$.\n$$ Cl_H \\propto Cl_{int} $$\nThe intrinsic clearance is defined by the Michaelis–Menten kinetics of the metabolizing enzyme, CYP2C9. The velocity of the reaction, $v$, is given by:\n$$ v = \\frac{V_{max} [S]}{K_m + [S]} $$\nwhere $[S]$ is the substrate concentration, $V_{max}$ is the maximum reaction velocity, and $K_m$ is the Michaelis–Menten constant. Intrinsic clearance is defined as the rate of metabolism per unit of substrate concentration, in the limit of low substrate concentration:\n$$ Cl_{int} = \\frac{v}{[S]} = \\frac{V_{max}}{K_m + [S]} $$\nThe problem states that in vivo substrate concentrations are much lower than the Michaelis–Menten constant, i.e., $[S] \\ll K_m$. Under this condition, the expression for intrinsic clearance simplifies to:\n$$ Cl_{int} \\approx \\frac{V_{max}}{K_m} $$\nThis ratio, $V_{max}/K_m$, represents the catalytic efficiency of the enzyme, which we will denote as $\\eta$. Therefore, the hepatic clearance is proportional to the catalytic efficiency of the total CYP2C9 enzyme pool in the liver.\n$$ Cl_H \\propto \\eta_{total} $$\nThe problem specifies that in a diploid individual, the net catalytic efficiency is the arithmetic mean of the efficiencies of the two constituent alleles. For a genotype composed of alleles $A$ and $B$, the total efficiency is:\n$$ \\eta_{A/B} = \\frac{1}{2}(\\eta_A + \\eta_B) = \\frac{1}{2}\\left(\\frac{V_{max, A}}{K_{m, A}} + \\frac{V_{max, B}}{K_{m, B}}\\right) $$\nWe can now calculate the catalytic efficiencies for the individual CYP2C9 alleles using the provided kinetic data.\nFor CYP2C9$^{\\ast}1$:\n$$ \\eta_1 = \\frac{V_{max,1}}{K_{m,1}} = \\frac{9.0\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1}}{3.0\\,\\mu\\mathrm{M}} = 3.0\\,\\mu\\mathrm{M}^{-1}\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1} $$\nFor CYP2C9$^{\\ast}2$:\n$$ \\eta_2 = \\frac{V_{max,2}}{K_{m,2}} = \\frac{5.4\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1}}{3.2\\,\\mu\\mathrm{M}} = 1.6875\\,\\mu\\mathrm{M}^{-1}\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1} $$\nFor CYP2C9$^{\\ast}3$:\n$$ \\eta_3 = \\frac{V_{max,3}}{K_{m,3}} = \\frac{1.2\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1}}{4.5\\,\\mu\\mathrm{M}} \\approx 0.2667\\,\\mu\\mathrm{M}^{-1}\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1} $$\nUsing fractions for precision: $\\eta_3 = \\frac{1.2}{4.5} = \\frac{12}{45} = \\frac{4}{15}$.\n\nNext, we calculate the net catalytic efficiency for the reference and test patient genotypes.\nReference patient (CYP2C9$^{\\ast}1/^{\\ast}1$):\n$$ \\eta_{ref} = \\frac{1}{2}(\\eta_1 + \\eta_1) = \\eta_1 = 3.0\\,\\mu\\mathrm{M}^{-1}\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1} $$\nTest patient (CYP2C9$^{\\ast}2/^{\\ast}3$):\n$$ \\eta_{test} = \\frac{1}{2}(\\eta_2 + \\eta_3) = \\frac{1}{2}\\left(1.6875 + \\frac{4}{15}\\right) = \\frac{1}{2}\\left(\\frac{27}{16} + \\frac{4}{15}\\right) $$\n$$ \\eta_{test} = \\frac{1}{2}\\left(\\frac{27 \\times 15 + 4 \\times 16}{16 \\times 15}\\right) = \\frac{1}{2}\\left(\\frac{405 + 64}{240}\\right) = \\frac{469}{480} \\approx 0.977083\\,\\mu\\mathrm{M}^{-1}\\,\\mathrm{pmol}\\,\\mathrm{min}^{-1}\\,\\mathrm{pmol}^{-1} $$\nThe ratio of hepatic clearances is equal to the ratio of their net catalytic efficiencies:\n$$ \\frac{Cl_{H, test}}{Cl_{H, ref}} = \\frac{\\eta_{test}}{\\eta_{ref}} = \\frac{469/480}{3} = \\frac{469}{1440} $$\n\nSecond, we analyze the ratio of effective concentrations, $C_{eff}$. The problem states that the VKORC1 $-1639$ GA genotype requires an effective concentration that is a fraction of that required for the GG genotype. The test patient has the GA genotype, and the reference patient has the GG genotype. This ratio is given directly:\n$$ \\frac{C_{eff, test}}{C_{eff, ref}} = \\frac{C_{eff, GA}}{C_{eff, GG}} = 0.70 $$\n\nFinally, we combine the clearance and concentration ratios to find the final dose ratio:\n$$ \\frac{D_{test}}{D_{ref}} = \\left(\\frac{Cl_{H, test}}{Cl_{H, ref}}\\right) \\times \\left(\\frac{C_{eff, test}}{C_{eff, ref}}\\right) = \\left(\\frac{469}{1440}\\right) \\times 0.70 $$\n$$ \\frac{D_{test}}{D_{ref}} = \\frac{469}{1440} \\times \\frac{7}{10} = \\frac{3283}{14400} \\approx 0.22798611... $$\nThe problem requires the answer to be rounded to four significant figures.\n$$ \\frac{D_{test}}{D_{ref}} \\approx 0.2280 $$", "answer": "$$\\boxed{0.2280}$$", "id": "4395948"}, {"introduction": "While predicting the correct steady-state dose is crucial, ensuring patient safety during the initial loading phase is equally important. This problem asks you to analyze a clinical scenario involving a patient with the *CYP2C9* \\*3/\\*3 genotype, who has a markedly reduced warfarin clearance [@problem_id:4395979]. You will apply your knowledge of pharmacokinetic principles like drug accumulation and half-life, along with the indirect pharmacodynamic response of clotting factor depletion, to identify the safest and most effective loading strategy.", "problem": "A $70$ kg warfarin-naïve adult with nonvalvular atrial fibrillation and normal hepatic function is initiated on a commonly used loading protocol of warfarin: $10$ mg on day $1$ and day $2$, followed by $5$ mg daily from day $3$. The International Normalized Ratio (INR) is planned to be checked daily. Preemptive pharmacogenomic testing returns Cytochrome P450 2C9 (*CYP2C9*) \\*3/\\*3 and Vitamin K epoxide reductase complex subunit $1$ (VKORC$1$) promoter genotype $-1639$ G/G. Consider the following well-tested facts that can be used as the fundamental base for reasoning: (i) warfarin is a racemate whose S-enantiomer is predominantly cleared by *CYP2C9*; (ii) *CYP2C9* \\*3/\\*3 reduces S-warfarin intrinsic clearance to approximately $10$–$20\\%$ of wild-type; (iii) for a one-compartment, first-order elimination drug, clearance $CL$ and volume of distribution $V_d$ determine the elimination rate constant $k$ via $k=CL/V_d$ and the half-life $t_{1/2}=\\ln(2)/k$; (iv) under repeated daily dosing at interval $\\tau=24$ h, accumulation and time to steady state are governed by $k$ and $t_{1/2}$; (v) the anticoagulant effect is indirect because warfarin inhibits synthesis of vitamin K–dependent clotting factors, whose approximate half-lives are: Factor VII $\\approx 6$ h, Factor IX $\\approx 24$ h, Factor X $\\approx 36$–$48$ h, and Factor II (prothrombin) $\\approx 60$–$72$ h; INR rise therefore lags concentration changes and continues while synthesis remains inhibited.\n\nBased on these principles, compare the expected early INR trajectory over days $1$–$5$ under this loading protocol in *CYP2C9* \\*3/\\*3 versus *CYP2C9* \\*1/\\*1, and select the single best modified loading regimen that minimizes INR overshoot risk while allowing attainment of a therapeutic INR by approximately day $3$–$5$.\n\nWhich option best integrates the pharmacokinetic and pharmacodynamic reasoning and proposes an appropriate regimen?\n\nA. In *CYP2C9* \\*3/\\*3, markedly reduced clearance prolongs $t_{1/2}$ and increases accumulation, so for the same loading doses, warfarin concentrations are higher and rise for longer; because depletion of Factors X and II lags by days, the INR continues to rise into days $3$–$5$, increasing overshoot risk. To minimize this, avoid front-loading and begin with $1$–$2$ mg/day (for example, $1$ mg on day $1$–$2$), check INR by day $3$, and titrate slowly.\n\nB. In *CYP2C9* \\*3/\\*3, hepatic activation of warfarin is impaired, so a higher loading dose (for example, $10$–$15$ mg on day $1$–$2$) is needed to overcome reduced effect; INR will otherwise be subtherapeutic until Factors II and X turn over.\n\nC. The INR trajectory is governed almost entirely by clotting factor half-lives, so *CYP2C9* genotype has negligible impact on overshoot risk; maintain the $10$ mg loading protocol but add daily INR checks to prevent supratherapeutic values.\n\nD. To prevent overshoot in *CYP2C9* \\*3/\\*3, split the same total daily loading dose into twice-daily dosing (for example, $5$ mg every $12$ h on days $1$–$2$) to reduce peak-to-trough fluctuation; this will reduce accumulation and lower INR overshoot risk without changing total dose.", "solution": "We begin from pharmacokinetic first principles. For a one-compartment, first-order elimination model, the elimination rate constant is $k=CL/V_d$, and the half-life is $t_{1/2}=\\ln(2)/k$. The average exposure at steady state and early accumulation under multiple dosing are inversely proportional to clearance $CL$; the area under the concentration–time curve over a dosing interval is $AUC_{\\tau} \\propto \\text{Dose}/CL$. The time to approach steady state is on the order of $4$–$5$ half-lives. *CYP2C9* \\*3/\\*3 reduces S-warfarin intrinsic clearance to approximately $10$–$20\\%$ of wild-type, which implies $CL$ decreases by a factor of roughly $5$–$10$, $k$ decreases proportionally, and $t_{1/2}$ increases by a factor of roughly $5$–$10$. If wild-type S-warfarin $t_{1/2}$ is approximately $36$–$42$ h, then *CYP2C9* \\*3/\\*3 would plausibly increase $t_{1/2}$ to approximately $90$ h or more. Under a loading protocol of $10$ mg on day $1$–$2$, followed by $5$ mg daily, the reduced $CL$ in *CYP2C9* \\*3/\\*3 increases early $AUC$ and the accumulation factor. Thus, after the first $2$–$3$ doses, total body burden and plasma concentrations in *CYP2C9* \\*3/\\*3 will be substantially higher than in *CYP2C9* \\*1/\\*1, and they will continue to rise for longer because $t_{1/2}$ is prolonged.\n\nNext, consider pharmacodynamics. Warfarin inhibits Vitamin K epoxide reductase complex subunit $1$ (VKORC$1$), reducing the synthesis rate of vitamin K–dependent clotting factors. The anticoagulant effect is indirect because it reflects the balance between synthesis (inhibited) and elimination of clotting factors with their own half-lives. Factor VII has a short half-life ($\\approx 6$ h), so it declines quickly and contributes to an early INR rise. However, Factors X and II have longer half-lives ($\\approx 36$–$48$ h and $\\approx 60$–$72$ h), so full expression of the anticoagulant effect unfolds over several days. When warfarin concentrations are high and sustained due to markedly reduced $CL$, synthesis remains strongly inhibited, and the INR will continue to rise into days $3$–$5$. Therefore, compared to *CYP2C9* \\*1/\\*1, the same loading protocol in *CYP2C9* \\*3/\\*3 yields higher and more prolonged exposure, a greater accumulation factor, and, coupled with pharmacodynamic lag, a higher risk of INR overshoot in the day $3$–$5$ window.\n\nTo minimize overshoot, the loading regimen should reduce early exposure (lower dose and slower accumulation) and allow for pharmacodynamic lag, with early INR monitoring guiding titration.\n\nOption-by-option analysis:\n\nA. This option states that in *CYP2C9* \\*3/\\*3, reduced $CL$ prolongs $t_{1/2}$, increases accumulation, and that the INR continues to rise into days $3$–$5$ due to the delayed depletion of Factors X and II, increasing overshoot risk. This follows directly from $k=CL/V_d$, $t_{1/2}=\\ln(2)/k$, and the indirect response model of clotting factor turnover. The proposed modification—avoid front-loading, initiate at $1$–$2$ mg/day (for example, $1$ mg on days $1$–$2$), and check INR by day $3$ with slow titration—is consistent with reducing early $AUC$ in a markedly low-$CL$ phenotype and aligns with pharmacogenomic guideline ranges for *CYP2C9* \\*3/\\*3 maintenance dosing. Correct.\n\nB. This option asserts that warfarin requires hepatic activation and that *CYP2C9* \\*3/\\*3 reduces activation, implying a need for higher doses. This is incorrect: warfarin is active as administered, and *CYP2C9* mediates clearance, not activation. Reduced $CL$ increases exposure at any given dose; higher loading would worsen overshoot risk. Incorrect.\n\nC. This option claims genotype has negligible impact because clotting factor half-lives dominate the INR trajectory. While factor kinetics impose a lag, the magnitude and persistence of synthesis inhibition depend on warfarin concentration, which is substantially higher and longer-lasting when $CL$ is reduced. Thus, genotype materially affects overshoot risk, and maintaining a $10$ mg loading protocol is unsafe in *CYP2C9* \\*3/\\*3. Incorrect.\n\nD. This option proposes dose splitting to twice daily with the same total daily dose to reduce overshoot by reducing peak-to-trough fluctuation. For drugs with long $t_{1/2}$ relative to $\\tau$ (here, $t_{1/2}\\gg 24$ h), peak-to-trough fluctuation is already small, and accumulation as well as $AUC$ are governed by total daily dose and $CL$. Splitting the dose does not meaningfully reduce accumulation or $AUC$ and therefore does not address overshoot risk driven by excessive total exposure in a low-$CL$ phenotype. Incorrect.\n\nTherefore, the option that correctly analyzes the INR trajectory and proposes a regimen to minimize overshoot is A.", "answer": "$$\\boxed{A}$$", "id": "4395979"}, {"introduction": "The ultimate goal of pharmacogenomics is to create validated, data-driven tools that guide clinical decision-making. This advanced practice provides hands-on experience in building and evaluating a warfarin dosing algorithm from a patient cohort dataset [@problem_id:4395995]. You will implement a rigorous machine learning workflow, including feature engineering, ridge regression, and nested cross-validation, to compare the predictive accuracy of a clinical-only model versus a comprehensive genotype-guided model.", "problem": "You are tasked with implementing a reproducible, cross-validated calibration of two linear dosing algorithms for stable warfarin maintenance dose prediction in the context of pharmacogenomics. The scientific base you must rely on comprises: definitions of linear models, properties of the natural logarithm transformation to stabilize multiplicative variability, and standard evaluation metrics such as Mean Absolute Error (MAE) and mean signed error (bias). You must not rely on any published warfarin “shortcut” dosing formula; instead, you must construct models directly from the data and the definitions below. All computations and answers must be expressed in milligrams per day (mg/day). Your program must produce a single line of output containing a comma-separated list enclosed in square brackets.\n\nYou will fit two linear models to predict the natural logarithm of the stable dose and evaluate predictions on held-out data using Cross-Validation (CV). Predictions must then be exponentiated back to mg/day to compute errors in the original unit.\n\nDefinitions and modeling framework:\n- Let $n$ denote the number of individuals and let $\\mathbf{x}_i \\in \\mathbb{R}^p$ denote the predictor vector for individual $i$, with corresponding observed stable dose $d_i$ in mg/day. Let $y_i = \\ln(d_i)$ denote the natural logarithm of the dose (dimensionless).\n- You will fit a linear model in the log-dose space of the form $y \\approx \\beta_0 + \\sum_{j=1}^{p} \\beta_j z_j$, where $z_j$ are standardized predictors derived from $\\mathbf{x}$.\n- Standardization: for each non-intercept predictor $x_j$, compute the training-fold mean $\\mu_j$ and standard deviation $\\sigma_j$, and define $z_j = \\frac{x_j - \\mu_j}{\\sigma_j}$ using only the training-fold statistics. If $\\sigma_j = 0$, replace it by $1$ to avoid division by zero.\n- Ridge-regularized fitting is required within each training fold: estimate $\\boldsymbol{\\beta}$ by minimizing the penalized squared error in the log-dose space with penalty $\\lambda \\sum_{j=1}^p \\beta_j^2$. The intercept $\\beta_0$ must not be penalized.\n- Hyperparameter selection: within each training fold, choose the ridge penalty $\\lambda$ from the candidate set $\\{\\;0,\\,0.1,\\,1,\\,10\\;\\}$ to minimize the average Mean Absolute Error (MAE) on a deterministic $3$-fold inner CV, using only the training-fold data. The inner $3$ folds must be assigned deterministically by the index modulo $3$ (see below).\n- After selecting $\\lambda$, refit on the entire training fold and predict the log-dose on the held-out fold; then exponentiate to obtain predicted dose in mg/day.\n\nEvaluation metrics:\n- Define Mean Absolute Error (MAE) as $\\frac{1}{n} \\sum_{i=1}^{n} \\left| \\hat{d}_i - d_i \\right|$, where $\\hat{d}_i$ is the predicted dose (mg/day) and $d_i$ is the observed dose (mg/day).\n- Define bias (mean signed error) as $\\frac{1}{n} \\sum_{i=1}^{n} \\left( \\hat{d}_i - d_i \\right)$ in mg/day.\n- Compute these metrics separately for each model across all held-out predictions aggregated over outer folds.\n\nCross-Validation partitions:\n- Use $K$-fold outer CV with $K = 5$, assigning individuals deterministically to folds by zero-based index $i$ with outer-fold $f_{\\text{outer}}(i) = i \\bmod 5$.\n- For inner CV during hyperparameter selection on a given training set, assign inner folds deterministically by the zero-based index within the training set, $f_{\\text{inner}}(j) = j \\bmod 3$.\n\nPredictor construction:\n- Clinical-only model predictors (excluding intercept): age in years, Body Surface Area (BSA) in square meters, sex as binary ($1$ for male, $0$ for female), smoking status as binary ($1$ for current smoker, $0$ otherwise), amiodarone co-therapy as binary ($1$ for yes, $0$ for no).\n- Genotype-guided model predictors (excluding intercept): all clinical-only predictors plus two genetic predictors:\n  - Cytochrome P450 2C9 (*CYP2C9*) activity score encoded from diplotype using the mapping: $*1/*1 \\mapsto 2.0$, $*1/*2 \\mapsto 1.5$, $*1/*3 \\mapsto 1.0$, $*2/*2 \\mapsto 1.0$, $*2/*3 \\mapsto 0.5$, $*3/*3 \\mapsto 0.0$.\n  - Vitamin K epoxide reductase complex subunit 1 (*VKORC1*) -1639G>A genotype encoded as the count of the $\\mathrm{A}$ allele: $\\mathrm{GG} \\mapsto 0$, $\\mathrm{GA} \\mapsto 1$, $\\mathrm{AA} \\mapsto 2$.\n- Body Surface Area (BSA) must be computed from weight (kilograms) and height (centimeters) by the Du Bois formula: $\\mathrm{BSA} = 0.007184 \\times \\mathrm{weight}^{0.425} \\times \\mathrm{height}^{0.725}$, with BSA in square meters.\n\nUnits and rounding:\n- All model fitting is performed in the log-dose space, but all evaluation and final reporting must be in mg/day.\n- Express the final MAE and bias values in mg/day, rounded to exactly $3$ decimal places.\n\nDataset and test suite:\n- Use the following cohort of $20$ individuals. Each record is a tuple ordered as $(\\text{age years}, \\text{weight kg}, \\text{height cm}, \\text{male}, \\text{smoker}, \\text{amiodarone}, \\text{CYP2C9 diplotype}, \\text{VKORC1 genotype}, \\text{observed stable dose mg/day})$.\n- The $20$ records are:\n  1. $(55,\\,82,\\,178,\\,1,\\,0,\\,0,\\,*1/*1,\\,GG,\\,5.5)$\n  2. $(70,\\,68,\\,165,\\,0,\\,0,\\,0,\\,*1/*2,\\,GA,\\,3.5)$\n  3. $(45,\\,90,\\,185,\\,1,\\,1,\\,0,\\,*1/*1,\\,GG,\\,6.5)$\n  4. $(80,\\,60,\\,160,\\,0,\\,0,\\,1,\\,*1/*3,\\,GA,\\,2.0)$\n  5. $(62,\\,75,\\,172,\\,1,\\,0,\\,0,\\,*1/*2,\\,GG,\\,4.5)$\n  6. $(50,\\,95,\\,190,\\,1,\\,1,\\,0,\\,*1/*1,\\,GA,\\,6.0)$\n  7. $(65,\\,70,\\,168,\\,0,\\,0,\\,0,\\,*2/*2,\\,AA,\\,2.5)$\n  8. $(58,\\,85,\\,180,\\,1,\\,0,\\,1,\\,*1/*1,\\,GA,\\,4.0)$\n  9. $(40,\\,62,\\,170,\\,0,\\,1,\\,0,\\,*1/*2,\\,GA,\\,4.2)$\n  10. $(75,\\,80,\\,175,\\,1,\\,0,\\,0,\\,*1/*3,\\,GG,\\,3.0)$\n  11. $(68,\\,72,\\,165,\\,0,\\,0,\\,0,\\,*1/*1,\\,AA,\\,3.0)$\n  12. $(52,\\,78,\\,172,\\,1,\\,1,\\,0,\\,*1/*2,\\,GG,\\,5.0)$\n  13. $(35,\\,88,\\,182,\\,1,\\,1,\\,0,\\,*1/*1,\\,GG,\\,7.0)$\n  14. $(60,\\,64,\\,160,\\,0,\\,0,\\,0,\\,*2/*3,\\,GA,\\,2.2)$\n  15. $(72,\\,70,\\,168,\\,1,\\,0,\\,1,\\,*1/*2,\\,AA,\\,2.5)$\n  16. $(48,\\,82,\\,178,\\,0,\\,0,\\,0,\\,*1/*1,\\,GA,\\,4.8)$\n  17. $(66,\\,90,\\,175,\\,1,\\,1,\\,0,\\,*1/*2,\\,GA,\\,4.6)$\n  18. $(59,\\,73,\\,170,\\,0,\\,0,\\,0,\\,*1/*3,\\,GA,\\,3.3)$\n  19. $(77,\\,68,\\,165,\\,0,\\,0,\\,1,\\,*3/*3,\\,AA,\\,1.0)$\n  20. $(42,\\,100,\\,188,\\,1,\\,1,\\,0,\\,*1/*1,\\,GG,\\,7.5)$\n\nAlgorithmic requirements:\n- Implement the outer $5$-fold CV as described.\n- Within each outer training fold, perform inner $3$-fold CV to select $\\lambda \\in \\{\\;0,\\,0.1,\\,1,\\,10\\;\\}$ that minimizes the inner-fold average MAE in mg/day. Fit the ridge-regularized linear model in the log-dose space using the training-fold standardization and the selected $\\lambda$ (intercept unpenalized). Use a numerically stable closed-form solution.\n- For each outer test instance, compute the predicted dose by exponentiating the predicted log-dose. Aggregate all outer-fold predictions to compute overall MAE and bias per model.\n\nFinal output specification:\n- Your program should produce a single line of output containing the four results as a comma-separated list enclosed in square brackets in the following order and units: $[\\text{MAE clinical-only}, \\text{bias clinical-only}, \\text{MAE genotype-guided}, \\text{bias genotype-guided}]$, all in mg/day and each rounded to exactly $3$ decimal places. For example, an output could look like $[4.123,-0.250,3.876,-0.100]$ (this is only an example format; your actual numerical results must be computed from the specified data and procedure).", "solution": "We begin from first principles of linear modeling and cross-validated estimation. Let $d_i$ denote the observed stable warfarin dose in mg/day for individual $i$, and let $y_i = \\ln(d_i)$ be the natural logarithm which transforms multiplicative variability into additive structure and often stabilizes variance. We posit a linear relationship in the log-dose space,\n$$\ny_i \\approx \\beta_0 + \\sum_{j=1}^{p} \\beta_j z_{ij},\n$$\nwhere $z_{ij}$ are standardized predictors computed from raw predictors $x_{ij}$ via $z_{ij} = (x_{ij} - \\mu_j)/\\sigma_j$, with $\\mu_j$ and $\\sigma_j$ computed from the training data only. If $\\sigma_j = 0$, we set $\\sigma_j = 1$ to avoid division by zero, which leaves that feature centered without scaling and prevents numerical instabilities.\n\nTo prevent overfitting and to calibrate the model to unseen data, we use Cross-Validation (CV). The outer CV has $K = 5$ folds, assigned deterministically by index modulo $5$. For each outer fold, the model is trained on $4$ folds and evaluated on the held-out fold. Within each training fold, we must select the ridge penalty $\\lambda$ to balance bias and variance. Ridge regression estimates $\\boldsymbol{\\beta}$ by minimizing\n$$\n\\sum_{i \\in \\mathcal{T}} \\left( y_i - \\beta_0 - \\sum_{j=1}^{p} \\beta_j z_{ij} \\right)^2 + \\lambda \\sum_{j=1}^{p} \\beta_j^2,\n$$\nwhere $\\mathcal{T}$ indexes the training set and the intercept $\\beta_0$ is explicitly excluded from the penalty. We select $\\lambda \\in \\{0, 0.1, 1, 10\\}$ by inner $3$-fold CV within the training set, assigning inner folds deterministically by index modulo $3$. For each candidate $\\lambda$, we perform the inner CV: standardize predictors based on the inner-training split, fit the ridge model in closed form, predict the held-out inner split, exponentiate predictions to mg/day, and compute Mean Absolute Error (MAE) in mg/day. We then average the inner-fold MAEs and choose the $\\lambda$ with the lowest average MAE. Ties can be broken by choosing the smallest $\\lambda$, which is deterministic.\n\nThe closed-form solution for ridge regression with unpenalized intercept can be obtained by augmenting the standardized design matrix $Z$ with a column of ones to form $X = [\\mathbf{1}, Z]$, and defining a penalty matrix $P = \\operatorname{diag}(0, \\lambda, \\ldots, \\lambda)$. The estimator is\n$$\n\\hat{\\boldsymbol{\\beta}} = \\left( X^\\top X + P \\right)^{-1} X^\\top \\mathbf{y},\n$$\nwhere $\\mathbf{y}$ is the vector of training responses $y_i$. For $\\lambda = 0$, the solution reduces to ordinary least squares, where we employ the Moore–Penrose pseudoinverse to ensure numerical stability even if $X^\\top X$ is singular. For $\\lambda > 0$, $X^\\top X + P$ is positive definite under standard conditions, and a stable solver (e.g., via a linear system solve or pseudoinverse) yields $\\hat{\\boldsymbol{\\beta}}$.\n\nAfter selecting $\\lambda$ on the inner CV, we refit on the full outer training set with the chosen $\\lambda$ and training standardization parameters $(\\mu_j, \\sigma_j)$, then predict on the outer test fold. For each test instance with raw predictors $\\mathbf{x}$, we compute $z_j = (x_j - \\mu_j)/\\sigma_j$ using the outer training parameters, obtain the predicted log-dose $\\hat{y}$, and exponentiate to $\\hat{d} = \\exp(\\hat{y})$ in mg/day.\n\nWe define the evaluation metrics on the aggregated outer test predictions across all folds:\n- Mean Absolute Error (MAE): \n$$\n\\mathrm{MAE} = \\frac{1}{n} \\sum_{i=1}^{n} \\left| \\hat{d}_i - d_i \\right|.\n$$\n- Bias (mean signed error):\n$$\n\\mathrm{Bias} = \\frac{1}{n} \\sum_{i=1}^{n} \\left( \\hat{d}_i - d_i \\right).\n$$\n\nWe construct two models that differ only in their predictors:\n- Clinical-only predictors: age (years), Body Surface Area (BSA), sex (binary), smoking (binary), amiodarone (binary).\n- Genotype-guided predictors: clinical-only predictors plus CYP2C9 activity score and VKORC1 $-1639\\mathrm{G}>\\mathrm{A}$ A-allele count.\n\nBSA is computed from weight (kg) and height (cm) via the Du Bois formula:\n$$\n\\mathrm{BSA} = 0.007184 \\times \\mathrm{weight}^{0.425} \\times \\mathrm{height}^{0.725} \\quad (\\mathrm{m}^2).\n$$\n\nGenetic encodings are:\n- CYP2C9 activity score: $*1/*1 \\to 2.0$, $*1/*2 \\to 1.5$, $*1/*3 \\to 1.0$, $*2/*2 \\to 1.0$, $*2/*3 \\to 0.5$, $*3/*3 \\to 0.0$.\n- VKORC1 genotype A-allele count: $\\mathrm{GG} \\to 0$, $\\mathrm{GA} \\to 1$, $\\mathrm{AA} \\to 2$.\n\nThe deterministic CV partitioning by index modulo arithmetic ensures reproducibility and universal applicability without reliance on randomness. The final output requires rounding each metric to exactly $3$ decimal places and reporting the four values in the order: $[\\mathrm{MAE\\ clinical}, \\mathrm{Bias\\ clinical}, \\mathrm{MAE\\ genotype}, \\mathrm{Bias\\ genotype}]$.\n\nBy following this procedure on the provided dataset of $20$ individuals, one obtains a pair of cross-validated performance metrics for each model in mg/day, enabling a principled comparison of the added value of genotype information over clinical variables alone while adhering to rigorous model calibration and evaluation principles.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef du_bois_bsa(weight_kg, height_cm):\n    # BSA in m^2 per Du Bois formula\n    return 0.007184 * (weight_kg ** 0.425) * (height_cm ** 0.725)\n\ndef map_cyp2c9_activity(diplotype: str) -> float:\n    mapping = {\n        \"*1/*1\": 2.0,\n        \"*1/*2\": 1.5,\n        \"*1/*3\": 1.0,\n        \"*2/*2\": 1.0,\n        \"*2/*3\": 0.5,\n        \"*3/*3\": 0.0,\n    }\n    if diplotype not in mapping:\n        raise ValueError(f\"Unknown CYP2C9 diplotype: {diplotype}\")\n    return mapping[diplotype]\n\ndef map_vkorc1_a_count(genotype: str) -> int:\n    mapping = {\"GG\": 0, \"GA\": 1, \"AA\": 2}\n    if genotype not in mapping:\n        raise ValueError(f\"Unknown VKORC1 genotype: {genotype}\")\n    return mapping[genotype]\n\ndef build_features(records, include_genetics: bool):\n    \"\"\"\n    Build feature matrix and target vector.\n    Clinical predictors: age, BSA, male, smoker, amiodarone\n    Genetic predictors: CYP2C9 activity score, VKORC1 A-allele count\n    Target: ln(dose)\n    \"\"\"\n    X_list = []\n    y_list = []\n    for rec in records:\n        age, weight, height, male, smoker, amio, cyp, vkor, dose = rec\n        bsa = du_bois_bsa(weight, height)\n        features = [age, bsa, male, smoker, amio]\n        if include_genetics:\n            cyp_act = map_cyp2c9_activity(cyp)\n            vkor_a = map_vkorc1_a_count(vkor)\n            features.extend([cyp_act, vkor_a])\n        X_list.append(features)\n        y_list.append(np.log(dose))\n    X = np.array(X_list, dtype=float)\n    y = np.array(y_list, dtype=float)\n    return X, y\n\ndef standardize_train(X):\n    mu = X.mean(axis=0)\n    sd = X.std(axis=0, ddof=0)\n    sd_safe = np.where(sd == 0.0, 1.0, sd)\n    Z = (X - mu) / sd_safe\n    return Z, mu, sd_safe\n\ndef standardize_apply(X, mu, sd):\n    sd_safe = np.where(sd == 0.0, 1.0, sd)\n    return (X - mu) / sd_safe\n\ndef ridge_fit_predict(X_train, y_train, X_test, lam):\n    \"\"\"\n    Fit ridge regression in log-dose space with unpenalized intercept.\n    X_train, X_test are standardized feature matrices (no intercept column).\n    \"\"\"\n    n_train, p = X_train.shape\n    # Add intercept\n    ones_train = np.ones((n_train, 1))\n    Xtr = np.hstack([ones_train, X_train])\n    # Penalty matrix: 0 for intercept, lam for others\n    P = np.diag(np.concatenate([[0.0], np.full(p, lam, dtype=float)]))\n    # Closed-form solution: beta = (X^T X + P)^-1 X^T y\n    XtX = Xtr.T @ Xtr + P\n    Xty = Xtr.T @ y_train\n    # Use pseudoinverse for numerical stability (handles lam=0 too)\n    beta = np.linalg.pinv(XtX) @ Xty\n    # Predict\n    ones_test = np.ones((X_test.shape[0], 1))\n    Xte = np.hstack([ones_test, X_test])\n    y_pred = Xte @ beta\n    return y_pred\n\ndef kfold_indices(n, k):\n    # Deterministic fold assignment by index mod k\n    folds = {f: [] for f in range(k)}\n    for i in range(n):\n        folds[i % k].append(i)\n    return folds\n\ndef inner_cv_select_lambda(X_train_raw, y_train, lambdas, n_inner=3):\n    # Determine inner folds on training indices by relative order, modulo n_inner\n    ntr = X_train_raw.shape[0]\n    # Build indices per inner fold by local order\n    inner_folds = {f: [] for f in range(n_inner)}\n    for j in range(ntr):\n        inner_folds[j % n_inner].append(j)\n\n    best_lam = None\n    best_score = np.inf\n    for lam in lambdas:\n        # Compute average MAE across inner folds\n        maes = []\n        for f in range(n_inner):\n            inner_test_idx = np.array(inner_folds[f], dtype=int)\n            inner_train_idx = np.array(\n                [idx for idx in range(ntr) if idx not in inner_folds[f]],\n                dtype=int\n            )\n            X_tr_raw = X_train_raw[inner_train_idx]\n            y_tr = y_train[inner_train_idx]\n            X_te_raw = X_train_raw[inner_test_idx]\n            y_te = y_train[inner_test_idx]\n            # Standardize on inner training\n            Z_tr, mu, sd = standardize_train(X_tr_raw)\n            Z_te = standardize_apply(X_te_raw, mu, sd)\n            # Fit and predict in log space\n            y_hat_log = ridge_fit_predict(Z_tr, y_tr, Z_te, lam)\n            # Back-transform to mg/day\n            d_hat = np.exp(y_hat_log)\n            d_true = np.exp(y_te)\n            mae = np.mean(np.abs(d_hat - d_true))\n            maes.append(mae)\n        avg_mae = float(np.mean(maes))\n        if (avg_mae  best_score) or (np.isclose(avg_mae, best_score) and (best_lam is not None and lam  best_lam)):\n            best_score = avg_mae\n            best_lam = lam\n        if best_lam is None:\n            best_lam = lam\n            best_score = avg_mae\n    return best_lam\n\ndef cross_validated_metrics(records):\n    # Prepare full datasets for each model\n    X_clin, y = build_features(records, include_genetics=False)\n    X_gen, _ = build_features(records, include_genetics=True)\n\n    n = X_clin.shape[0]\n    outer_folds = kfold_indices(n, 5)\n    lambdas = [0.0, 0.1, 1.0, 10.0]\n\n    # Storage for predictions\n    pred_clin = np.zeros(n, dtype=float)\n    pred_gen = np.zeros(n, dtype=float)\n\n    for f in range(5):\n        test_idx = np.array(outer_folds[f], dtype=int)\n        train_idx = np.array([i for i in range(n) if i not in test_idx], dtype=int)\n\n        # Clinical-only\n        Xtr_c = X_clin[train_idx]\n        ytr = y[train_idx]\n        Xte_c = X_clin[test_idx]\n\n        lam_c = inner_cv_select_lambda(Xtr_c, ytr, lambdas, n_inner=3)\n        Ztr_c, mu_c, sd_c = standardize_train(Xtr_c)\n        Zte_c = standardize_apply(Xte_c, mu_c, sd_c)\n        yhat_log_c = ridge_fit_predict(Ztr_c, ytr, Zte_c, lam_c)\n        pred_clin[test_idx] = np.exp(yhat_log_c)\n\n        # Genotype-guided\n        Xtr_g = X_gen[train_idx]\n        Xte_g = X_gen[test_idx]\n\n        lam_g = inner_cv_select_lambda(Xtr_g, ytr, lambdas, n_inner=3)\n        Ztr_g, mu_g, sd_g = standardize_train(Xtr_g)\n        Zte_g = standardize_apply(Xte_g, mu_g, sd_g)\n        yhat_log_g = ridge_fit_predict(Ztr_g, ytr, Zte_g, lam_g)\n        pred_gen[test_idx] = np.exp(yhat_log_g)\n\n    # True doses\n    doses = np.array([rec[-1] for rec in records], dtype=float)\n\n    # Metrics\n    mae_clin = float(np.mean(np.abs(pred_clin - doses)))\n    bias_clin = float(np.mean(pred_clin - doses))\n    mae_gen = float(np.mean(np.abs(pred_gen - doses)))\n    bias_gen = float(np.mean(pred_gen - doses))\n\n    return mae_clin, bias_clin, mae_gen, bias_gen\n\ndef solve():\n    # Dataset as specified in the problem statement\n    # Each record: (age, weight, height, male, smoker, amiodarone, CYP2C9, VKORC1, observed dose mg/day)\n    records = [\n        (55, 82, 178, 1, 0, 0, \"*1/*1\", \"GG\", 5.5),\n        (70, 68, 165, 0, 0, 0, \"*1/*2\", \"GA\", 3.5),\n        (45, 90, 185, 1, 1, 0, \"*1/*1\", \"GG\", 6.5),\n        (80, 60, 160, 0, 0, 1, \"*1/*3\", \"GA\", 2.0),\n        (62, 75, 172, 1, 0, 0, \"*1/*2\", \"GG\", 4.5),\n        (50, 95, 190, 1, 1, 0, \"*1/*1\", \"GA\", 6.0),\n        (65, 70, 168, 0, 0, 0, \"*2/*2\", \"AA\", 2.5),\n        (58, 85, 180, 1, 0, 1, \"*1/*1\", \"GA\", 4.0),\n        (40, 62, 170, 0, 1, 0, \"*1/*2\", \"GA\", 4.2),\n        (75, 80, 175, 1, 0, 0, \"*1/*3\", \"GG\", 3.0),\n        (68, 72, 165, 0, 0, 0, \"*1/*1\", \"AA\", 3.0),\n        (52, 78, 172, 1, 1, 0, \"*1/*2\", \"GG\", 5.0),\n        (35, 88, 182, 1, 1, 0, \"*1/*1\", \"GG\", 7.0),\n        (60, 64, 160, 0, 0, 0, \"*2/*3\", \"GA\", 2.2),\n        (72, 70, 168, 1, 0, 1, \"*1/*2\", \"AA\", 2.5),\n        (48, 82, 178, 0, 0, 0, \"*1/*1\", \"GA\", 4.8),\n        (66, 90, 175, 1, 1, 0, \"*1/*2\", \"GA\", 4.6),\n        (59, 73, 170, 0, 0, 0, \"*1/*3\", \"GA\", 3.3),\n        (77, 68, 165, 0, 0, 1, \"*3/*3\", \"AA\", 1.0),\n        (42, 100, 188, 1, 1, 0, \"*1/*1\", \"GG\", 7.5),\n    ]\n\n    mae_clin, bias_clin, mae_gen, bias_gen = cross_validated_metrics(records)\n\n    # Round to exactly 3 decimals\n    results = [\n        f\"{mae_clin:.3f}\",\n        f\"{bias_clin:.3f}\",\n        f\"{mae_gen:.3f}\",\n        f\"{bias_gen:.3f}\",\n    ]\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4395995"}]}