{"hands_on_practices": [{"introduction": "Before delving into complex alignment algorithms, it is crucial to master the fundamental grammar of genomics: coordinate systems. Seemingly trivial \"off-by-one\" errors stemming from confusion between 0-based and 1-based indexing are a notorious source of bugs in bioinformatics pipelines, leading to incorrect variant annotation and flawed downstream conclusions. This practice [@problem_id:4375062] will challenge you to navigate the different coordinate conventions used by standard file formats like BED, VCF, and GFF, solidifying your understanding of this critical and practical aspect of read mapping.", "problem": "In genome informatics, interval coordinates are represented using two widely adopted systems grounded in standard definitions of indexing over sequences. In a $0$-based inclusive-exclusive (half-open) system, an interval $[s,e)$ represents the elements at offsets $s, s+1, \\dots, e-1$; in a $1$-based inclusive (closed) system, an interval $[S,E]$ represents the elements at positions $S, S+1, \\dots, E$. A mathematically consistent interconversion between these systems requires $S = s + 1$ and $E = e$ for intervals that describe the same run of elements. In human genome analysis, Browser Extensible Data (BED) uses $0$-based half-open coordinates, Variant Call Format (VCF) uses $1$-based inclusive single-position sites for single-nucleotide variants, Sequence Alignment/Map (SAM) and Binary Alignment/Map (BAM) use $1$-based inclusive leftmost positions and the Concise Idiosyncratic Gapped Alignment Report (CIGAR) string to encode alignment spans, and General Feature Format/Gene Transfer Format (GFF/GTF) use $1$-based inclusive intervals. Human Genome Variation Society (HGVS) nomenclature expresses transcript-relative coordinates as $1$-based inclusive indices along complementary DNA (cDNA).\n\nConsider a plus-strand exon on chromosome $7$ that spans the $0$-based half-open interval $[55049999, 55050003)$, which corresponds to the $1$-based inclusive interval $[55050000, 55050003]$ and thus contains $4$ bases. A single-nucleotide variant is reported in VCF at chromosome $7$, position $55050003$ (that is, the last base of the exon) with reference allele $\\text{C}$ and alternate allele $\\text{T}$.\n\nA downstream pipeline attempts to perform interval overlap queries between variants and BED exons by converting each VCF single-nucleotide variant at $1$-based position $p$ into a $0$-based half-open interval but mistakenly maps it to $[p, p+1)$, rather than the mathematically correct $[p-1, p)$. The same mistaken mapping is also used internally to assign transcript-relative HGVS cDNA positions. Separately, a different team exports BED exon intervals to GFF without applying any coordinate transformation.\n\nBased only on the core definitions above and the scenario described, which of the following statements are correct? Select all that apply.\n\nA. Under the mistaken mapping $[p, p+1)$, the single-nucleotide variant at chromosome $7$ position $55050003$ will be classified as intronic (i.e., outside the exon) by the overlap query, even though it truly lies within the exon.\n\nB. Under the mistaken mapping $[p, p+1)$, a single-nucleotide variant at the first base of a plus-strand exon of length at least $2$ bases will still be classified as exonic by the overlap query.\n\nC. If the same mistaken mapping $[p, p+1)$ is used to compute Human Genome Variation Society (HGVS) cDNA indices, then for single-nucleotide variants within exons (not at transcript starts), the reported cDNA coordinate will be shifted upward by $+1$ relative to the true coordinate.\n\nD. When computing per-base coverage from Sequence Alignment/Map (SAM) or Binary Alignment/Map (BAM) alignments, treating $1$-based inclusive leftmost positions as if they were $0$-based half-open starts will increase the per-base depth globally by $1$ at every genomic position.\n\nE. For plus-strand exons, failing to convert Browser Extensible Data (BED) intervals $[s,e)$ to General Feature Format (GFF) $[S,E]$ by setting $S = s+1$ and $E = e$ will shift the reported $5'$ exon boundary downstream by $+1$ base while leaving the $3'$ boundary unchanged.\n\nF. For deletions in Variant Call Format (VCF) with reference allele length $L > 1$ at genomic position $p$, the mathematically correct $0$-based half-open interval to test for overlap is $[p-1, p-1+L)$; under the mistaken mapping $[p, p+L)$, the deletion window is shifted right by $+1$ base, which can alter normalization and left-alignment in repetitive sequence contexts.", "solution": "The problem requires a critical analysis of several statements concerning genomic coordinate systems and the consequences of incorrect conversions between them. I will first validate the problem statement and then proceed to a detailed evaluation of each option.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   **0-based inclusive-exclusive (half-open) system:** An interval $[s,e)$ represents elements at offsets $s, s+1, \\dots, e-1$. The length is $e-s$. This system is used by the Browser Extensible Data (BED) format.\n*   **1-based inclusive (closed) system:** An interval $[S,E]$ represents elements at positions $S, S+1, \\dots, E$. The length is $E-S+1$. This system is used by Variant Call Format (VCF), Sequence Alignment/Map (SAM/BAM), General Feature Format (GFF/GTF), and Human Genome Variation Society (HGVS) nomenclature.\n*   **Correct Interconversion:** To represent the same sequence of bases, a $0$-based $[s,e)$ interval converts to a $1$-based $[S,E]$ interval with $S = s + 1$ and $E = e$. Conversely, a $1$-based $[S,E]$ interval converts to a $0$-based $[s,e)$ interval with $s = S - 1$ and $e = E$.\n*   **Scenario Data:**\n    *   A plus-strand exon on chromosome $7$ is given by the $0$-based half-open interval $[55049999, 55050003)$ and the equivalent $1$-based inclusive interval $[55050000, 55050003]$. The length is $4$ bases.\n    *   A single-nucleotide variant (SNV) is reported in VCF at chromosome $7$, position $p = 55050003$. This is the last base of the specified exon.\n*   **Mistaken Mappings:**\n    1.  A VCF SNV at $1$-based position $p$ is mistakenly converted to the $0$-based interval $[p, p+1)$. The correct mapping for a single position $p$ (which is a $1$-based interval $[p,p]$) would be $[p-1, p)$.\n    2.  The same mistake $[p, p+1)$ is used for assigning HGVS cDNA coordinates.\n    3.  BED intervals $[s,e)$ are exported to GFF format as $[s,e]$ without coordinate transformation.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem statement is scientifically sound, well-posed, and objective. It accurately describes standard coordinate systems and file formats used in bioinformatics. The \"off-by-one\" errors presented in the mistaken mappings are common and realistic pitfalls in genomics data processing. The provided data is internally consistent: the $0$-based interval $[55049999, 55050003)$ covers $0$-based indices $55049999, 55050000, 55050001, 55050002$, which are $4$ bases. The corresponding $1$-based positions are $55050000, 55050001, 55050002, 55050003$, which is the interval $[55050000, 55050003]$. The SNV at position $55050003$ is indeed the last base of this exon. All premises are clear, formalizable, and free of contradictions or vagueness.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. I will now proceed with the solution by analyzing each statement.\n\n### Option-by-Option Analysis\n\n**A. Under the mistaken mapping $[p, p+1)$, the single-nucleotide variant at chromosome $7$ position $55050003$ will be classified as intronic (i.e., outside the exon) by the overlap query, even though it truly lies within the exon.**\n\n*   **Exon Interval:** The exon is given in BED format, which is $0$-based half-open. The interval is $I_{exon} = [55049999, 55050003)$. This interval includes all genomic indices $x$ such that $55049999 \\leq x < 55050003$.\n*   **SNV Position:** The SNV is at the $1$-based position $p = 55050003$.\n*   **Truth Check:** The correct $0$-based interval for this single-nucleotide position is $[p-1, p) = [55050003-1, 55050003) = [55050002, 55050003)$. The index $55050002$ satisfies $55049999 \\leq 55050002 < 55050003$, so the variant truly lies within the exon.\n*   **Mistaken Mapping:** The variant is mistakenly mapped to the $0$-based interval $I_{SNV, mistaken} = [p, p+1) = [55050003, 55050004)$.\n*   **Overlap Query:** We test if $I_{exon}$ and $I_{SNV, mistaken}$ overlap. An overlap exists if their intersection is non-empty. The interval $I_{exon}$ contains indices up to, but not including, $55050003$. The interval $I_{SNV, mistaken}$ contains indices starting from $55050003$. They are adjacent but do not share any common indices. Their intersection is the empty set.\n*   **Conclusion:** Because there is no overlap, the pipeline will classify the variant as being outside the exon. If the region adjacent to the exon is an intron, it would be classified as intronic. The statement is therefore correct.\n\n**Verdict: Correct**\n\n**B. Under the mistaken mapping $[p, p+1)$, a single-nucleotide variant at the first base of a plus-strand exon of length at least $2$ bases will still be classified as exonic by the overlap query.**\n\n*   **Exon Interval:** Let the exon be described by the $0$-based interval $[s, e)$, with length $L = e-s \\geq 2$.\n*   **SNV Position:** The first base of the exon is at $0$-based index $s$. Its corresponding $1$-based position is $p = s+1$.\n*   **Mistaken Mapping:** The SNV at $p = s+1$ is mistakenly mapped to the $0$-based interval $I_{SNV, mistaken} = [p, p+1) = [s+1, s+2)$. This interval represents the base at index $s+1$.\n*   **Overlap Query:** We test if $I_{exon} = [s, e)$ overlaps with $I_{SNV, mistaken} = [s+1, s+2)$. The exon interval contains indices $s, s+1, \\dots, e-1$. Since the length $L=e-s \\geq 2$, we know that $e \\geq s+2$. This guarantees that the index $s+1$ is within the exon interval $[s,e)$. The interval $[s+1, s+2)$ representing the mistaken SNV location is a sub-interval of $[s,e)$ (since $s < s+1$ and $s+2 \\leq e$). Thus, the intersection is non-empty (it is $[s+1, s+2)$), and an overlap will be detected.\n*   **Conclusion:** The variant will be correctly classified as exonic. The statement is correct.\n\n**Verdict: Correct**\n\n**C. If the same mistaken mapping $[p, p+1)$ is used to compute Human Genome Variation Society (HGVS) cDNA indices, then for single-nucleotide variants within exons (not at transcript starts), the reported cDNA coordinate will be shifted upward by `+1` relative to the true coordinate.**\n\n*   **HGVS cDNA Position:** The `c.` coordinate is a $1$-based index into the spliced transcript sequence. It is calculated by summing the lengths of preceding exons and adding the $1$-based offset of the variant within its own exon.\n*   **Correct Calculation:** For a variant at $1$-based genomic position $p$, the correct $0$-based index is $p-1$. If this falls into an exon starting at $0$-based index $s_{exon}$, the $0$-based offset within the exon is $(p-1) - s_{exon}$. The $1$-based offset is $((p-1) - s_{exon}) + 1$.\n*   **Mistaken Calculation:** The mistaken mapping uses the interval $[p, p+1)$, effectively treating the $1$-based position $p$ as a $0$-based index. The mistaken $0$-based offset within the exon would be $p - s_{exon}$. The mistaken $1$-based offset is $(p - s_{exon}) + 1$.\n*   **Comparison:**\n    *   True coordinate contribution: `... + ((p-1) - s_exon + 1)`\n    *   Mistaken coordinate contribution: `... + (p - s_exon + 1)`\n    The difference is `(p - s_{exon} + 1) - ((p-1) - s_{exon} + 1) = p - (p-1) = 1$.\n*   **Conclusion:** The mistaken calculation introduces an error of $+1$. The reported cDNA coordinate will be shifted upward by $+1$ relative to the true coordinate. The statement is correct.\n\n**Verdict: Correct**\n\n**D. When computing per-base coverage from Sequence Alignment/Map (SAM) or Binary Alignment/Map (BAM) alignments, treating $1$-based inclusive leftmost positions as if they were $0$-based half-open starts will increase the per-base depth globally by $1$ at every genomic position.**\n\n*   **SAM/BAM Alignment:** An alignment starting at $1$-based position `POS` with read length `L` correctly covers the $1$-based interval $[POS, POS+L-1]$. This corresponds to the $0$-based interval $[POS-1, POS+L-1)$.\n*   **Mistaken Assumption:** The position `POS` is treated as a $0$-based start. This implies the alignment covers the $0$-based interval $[POS, POS+L)$.\n*   **Analysis:** Comparing the correct interval $[POS-1, POS+L-1)$ with the mistaken interval $[POS, POS+L)$, we see the mistaken interval is shifted one base to the right (downstream). For each read, the coverage contribution is shifted. The base at position $POS-1$ loses a count, while the base at position $POS+L-1$ gains a count. The total coverage integrated over the genome remains constant. This is a redistribution of coverage, not a uniform increase. The coverage at a specific position `x` might increase, decrease, or stay the same, depending on the number of reads starting at `x` and `x+1`.\n*   **Conclusion:** The statement that per-base depth increases globally by $1$ is incorrect.\n\n**Verdict: Incorrect**\n\n**E. For plus-strand exons, failing to convert Browser Extensible Data (BED) intervals $[s,e)$ to General Feature Format (GFF) $[S,E]$ by setting $S = s+1$ and $E = e$ will shift the reported $5'$ exon boundary downstream by `+1` base while leaving the $3'$ boundary unchanged.**\n\n*   **Correct Conversion:** A BED ($0$-based) interval $[s,e)$ should be converted to a GFF ($1$-based) interval $[S,E]$ where $S = s+1$ and $E = e$.\n*   **Mistaken Conversion:** The BED interval $[s,e)$ is directly written as a GFF interval `[s,e]`.\n*   **Boundary Analysis (Plus Strand):**\n    *   **5' Boundary:** The true 5' boundary is at the start of the interval. In $1$-based coordinates, this is position $S = s+1$. The mistaken GFF reports the 5' boundary as position $s$. The difference is $s - (s+1) = -1$. A shift from $s+1$ to $s$ is an upstream shift (towards smaller coordinates), not a downstream shift.\n    *   **3' Boundary:** The true 3' boundary is at the end of the interval. In $1$-based coordinates, this is position $E=e$. The mistaken GFF reports the 3' boundary as position $e$. This boundary is unchanged.\n*   **Conclusion:** While the 3' boundary is indeed unchanged, the 5' boundary is shifted upstream by $1$, not downstream by $1$. The statement is therefore incorrect.\n\n**Verdict: Incorrect**\n\n**F. For deletions in Variant Call Format (VCF) with reference allele length $L > 1$ at genomic position $p$, the mathematically correct $0$-based half-open interval to test for overlap is $[p-1, p-1+L)$; under the mistaken mapping $[p, p+L)$, the deletion window is shifted right by `+1` base, which can alter normalization and left-alignment in repetitive sequence contexts.**\n\n*   **VCF Deletion Span:** A variant at $1$-based position $p$ with a reference allele of length $L$ affects the genomic region corresponding to that allele. This region is the $1$-based, inclusive interval $[p, p+L-1]$.\n*   **Correct 0-based Interval:** Using the conversion rule ($s = S-1, e = E$), the $1$-based interval $[S,E] = [p, p+L-1]$ converts to the $0$-based half-open interval $[s,e) = [p-1, p+L-1)$. The statement gives the interval as $[p-1, p-1+L)$, which is algebraically identical to $[p-1, p+L-1)$. The first part of the statement is correct.\n*   **Mistaken Mapping:** The problem proposes a mistaken mapping analogy for deletions, `[p, p+L)`.\n*   **Shift Analysis:** Comparing the start of the correct interval, $p-1$, with the start of the mistaken interval, $p$, we see a shift of $p - (p-1) = +1$. Comparing the ends, $(p+L-1)$ and $(p+L)$, we see the exclusive end of the mistaken interval is also shifted by $+1$. Thus, the entire window is shifted right (downstream) by $1$ base. The second part of the statement is correct.\n*   **Consequence Analysis:** Variant normalization (including left-alignment) is a critical process to ensure canonical, unambiguous representation of indels, especially in repetitive sequences. This process relies on the precise genomic coordinates of the variant. An incorrect coordinate system that shifts the variant's apparent location by even one base will disrupt normalization algorithms, potentially leading to redundant variant calls or incorrect comparisons between datasets. The described consequence is accurate and significant.\n*   **Conclusion:** All parts of the statement are correct.\n\n**Verdict: Correct**", "answer": "$$\\boxed{ABCF}$$", "id": "4375062"}, {"introduction": "Once a read is placed on a reference genome, we must quantify the quality of its fit. Moving beyond a simple count of mismatches, this exercise [@problem_id:4375120] explores a more sophisticated, probabilistic scoring method that incorporates the confidence of each base call. You will learn how to convert the ubiquitous Phred quality score ($Q$) into a base-calling error probability ($p$) and use it to construct a log-likelihood ratio, a powerful statistical tool for discriminating between a correct alignment and a plausible alternative.", "problem": "A precision oncology pipeline uses Next-Generation Sequencing (NGS) reads and quality-aware alignment scoring to discriminate between a correct alignment of a read to a reference genome and an alternative alignment that implies base mismatches at certain positions. Consider a generative model for base observation in which, conditioned on the true reference base at a position, a sequencer emits the correct base with probability $1 - p$ and, if it errs, distributes the error uniformly over the three incorrect bases, assigning probability $p/3$ to each incorrect base. The Phred quality scale is defined such that the Phred quality score $Q$ is minus ten times the base-10 logarithm of the base-calling error probability $p$. Using this foundation and assuming independence across positions, derive the conversion from a baseâ€™s quality score $Q$ to its error probability $p$, and then compute the per-read natural-logarithm log-likelihood ratio in favor of a correct alignment versus a specific incorrect alignment that mismatches the read at two positions, when the read agrees with the reference at those two positions and the observed quality scores are $Q_{1} = 30$ and $Q_{2} = 25$. Explicitly, compute\n$$\nS \\;=\\; \\sum_{i=1}^{2} \\ln\\!\\left(\\frac{P(\\text{observed base} \\mid \\text{match at position } i)}{P(\\text{observed base} \\mid \\text{mismatch at position } i)}\\right),\n$$\nusing the model above and the Phred definition. Express the final score in nats and round your answer to four significant figures.", "solution": "The user has provided a problem statement that requires validation before a solution is attempted.\n\n### Step 1: Extract Givens\n-   **Generative model for base sequencing:**\n    -   Probability of observing the correct base, given the true base: $1 - p$.\n    -   Probability of observing a specific incorrect base, given the true base: $p/3$.\n-   **Phred quality score definition:**\n    -   $Q = -10 \\log_{10}(p)$, where $p$ is the base-calling error probability.\n-   **Assumption of independence:**\n    -   Observations at different positions are independent.\n-   **Objective:**\n    1.  Derive the conversion from a quality score $Q$ to its error probability $p$.\n    2.  Compute the total natural-logarithm log-likelihood ratio $S$ for two positions.\n-   **Formula for the log-likelihood ratio:**\n    -   $S = \\sum_{i=1}^{2} \\ln\\left(\\frac{P(\\text{observed base} \\mid \\text{match at position } i)}{P(\\text{observed base} \\mid \\text{mismatch at position } i)}\\right)$.\n-   **Conditions for computation:**\n    -   The comparison is between a correct alignment and a specific incorrect alignment.\n    -   In the correct alignment, the read agrees with the reference at the two positions.\n    -   The incorrect alignment mismatches the read at these two positions.\n    -   The observed Phred quality scores are $Q_{1} = 30$ and $Q_{2} = 25$.\n-   **Final Output Format:**\n    -   The score $S$ should be in nats (natural units of information).\n    -   The final numerical answer must be rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity:\n-   **Scientifically Grounded:** The problem is firmly rooted in bioinformatics and computational genomics. The Phred quality score is a standard metric in DNA sequencing. The generative model for sequencing errors, while simplified, is a common and conceptually valid model. The use of a log-likelihood ratio to compare competing hypotheses (in this case, genomic alignments) is a fundamental technique in statistical inference.\n-   **Well-Posed:** The problem is well-posed. It provides all necessary definitions (the error model, the Phred score), data ($Q_1$, $Q_2$), and a clear-cut objective (derive a formula and compute a value). The specified conditions lead to a unique, stable, and meaningful solution.\n-   **Objective:** The problem is stated using precise, quantitative, and unbiased language.\n\nThe problem does not exhibit any flaws such as scientific unsoundness, ambiguity, contradiction, or infeasibility.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be derived.\n\n### Solution Derivation\n\nThe solution proceeds in several steps. First, we derive the relationship between the error probability $p$ and the Phred quality score $Q$. Second, we formulate the probabilities for the numerator and denominator of the likelihood ratio. Third, we assemble the log-likelihood ratio expression. Finally, we substitute the given numerical values and compute the score $S$.\n\n_1. Conversion from Phred Quality Score ($Q$) to Error Probability ($p$)_\n\nThe Phred quality score $Q$ is defined as:\n$$Q = -10 \\log_{10}(p)$$\nTo find the error probability $p$ as a function of $Q$, we solve this equation for $p$:\n$$-\\frac{Q}{10} = \\log_{10}(p)$$\n$$p(Q) = 10^{-Q/10}$$\nThis is the required conversion formula.\n\n_2. Formulation of Probabilities for the Likelihood Ratio_\n\nThe score $S$ is a sum of log-likelihood ratios over two positions, $i=1, 2$. Let's analyze the term for a single position $i$:\n$$S_i = \\ln\\left(\\frac{P(\\text{observed base} \\mid \\text{match at position } i)}{P(\\text{observed base} \\mid \\text{mismatch at position } i)}\\right)$$\n\nThe numerator, $P(\\text{observed base} \\mid \\text{match at position } i)$, is the probability of observing a specific base from the sequencer, given that the alignment is correct at this position. A correct alignment implies that the true reference base is identical to the observed read base. The probability of the sequencer correctly identifying a base is given by the model as $1 - p_i$, where $p_i$ is the error probability at position $i$.\n$$P(\\text{observed base} \\mid \\text{match at position } i) = 1 - p_i$$\n\nThe denominator, $P(\\text{observed base} \\mid \\text{mismatch at position } i)$, is the probability of observing a specific base, given that the alignment is incorrect at this position. An incorrect alignment implies that the true reference base is different from the observed read base. For the observed base to be recorded, the sequencer must have made an error. The model specifies that when an error occurs, it is uniformly distributed over the three incorrect bases. Thus, the probability of observing any single, specific incorrect base is $p_i/3$.\n$$P(\\text{observed base} \\mid \\text{mismatch at position } i) = \\frac{p_i}{3}$$\n\n_3. Log-Likelihood Ratio Calculation_\n\nSubstituting these probabilities into the expression for $S_i$, we get:\n$$S_i = \\ln\\left(\\frac{1 - p_i}{p_i/3}\\right)$$\nThe total score $S$ is the sum over the two positions:\n$$S = S_1 + S_2 = \\ln\\left(\\frac{1 - p_1}{p_1/3}\\right) + \\ln\\left(\\frac{1 - p_2}{p_2/3}\\right)$$\n\n_4. Numerical Computation_\n\nWe are given the quality scores $Q_1 = 30$ and $Q_2 = 25$. We use the derived formula $p(Q) = 10^{-Q/10}$ to find the corresponding error probabilities.\n\nFor position $1$:\n$$p_1 = 10^{-Q_1/10} = 10^{-30/10} = 10^{-3} = 0.001$$\n\nFor position $2$:\n$$p_2 = 10^{-Q_2/10} = 10^{-25/10} = 10^{-2.5}$$\n\nNow, we substitute these values into the expression for $S$:\n$$S = \\ln\\left(\\frac{1 - 10^{-3}}{10^{-3}/3}\\right) + \\ln\\left(\\frac{1 - 10^{-2.5}}{10^{-2.5}/3}\\right)$$\nLet's simplify the terms:\n$$S = \\ln\\left(3 \\times \\frac{1 - 10^{-3}}{10^{-3}}\\right) + \\ln\\left(3 \\times \\frac{1 - 10^{-2.5}}{10^{-2.5}}\\right)$$\n$$S = \\ln\\left(3 \\times (10^3 - 1)\\right) + \\ln\\left(3 \\times (10^{2.5} - 1)\\right)$$\n$$S = \\ln(3 \\times 999) + \\ln(3 \\times (10^{2.5} - 1))$$\n$$S = \\ln(2997) + \\ln(3 \\times (10^{2.5} - 1))$$\n\nWe now compute the numerical values. The natural logarithm means the result is in nats.\n$$S_1 = \\ln(2997) \\approx 8.00536709$$\nFor the second term:\n$$10^{2.5} = 10^2 \\times 10^{0.5} = 100\\sqrt{10} \\approx 100 \\times 3.16227766 = 316.227766$$\n$$S_2 = \\ln(3 \\times (316.227766 - 1)) = \\ln(3 \\times 315.227766) = \\ln(945.683298) \\approx 6.85195000$$\n\nThe total score $S$ is the sum:\n$$S = S_1 + S_2 \\approx 8.00536709 + 6.85195000 = 14.85731709$$\n\nThe problem requires the answer to be rounded to four significant figures.\n$$S \\approx 14.86$$\nThis score represents the total evidence, in nats, in favor of the correct alignment over the specified incorrect one, based on the observations at these two positions.", "answer": "$$\\boxed{14.86}$$", "id": "4375120"}, {"introduction": "A high alignment score is necessary but not sufficient; the ultimate question is our confidence that the read belongs to this specific location and not somewhere else in the genome. This final exercise [@problem_id:4375061] synthesizes scoring principles into the calculation of Mapping Quality (MAPQ), the Phred-scaled posterior probability that an alignment is incorrect. You will develop a realistic model that combines the likelihood of the best and second-best alignments with prior probabilities reflecting genome repetitiveness, culminating in a single, vital metric used in virtually all variant-calling pipelines.", "problem": "Consider a single-end DNA sequencing read in a clinical whole-genome pipeline for Precision Medicine. The task is to quantify the confidence of its placement on the reference genome by modeling base-level sequencing errors and comparing two competing alignments produced by a seed-and-extend aligner. The downstream metric is the Mapping Quality (MAPQ), defined on the Phred scale.\n\nA read of length $L = 100$ nucleotides has uniform Phred quality score (Q-score) $Q = 30$ at every base. The best-scoring alignment hypothesis $\\mathcal{A}_{1}$ aligns the read with $k_{1} = 2$ mismatches (substitutions only), and the second-best alignment hypothesis $\\mathcal{A}_{2}$ aligns the read with $k_{2} = 3$ mismatches (substitutions only). Insertions and deletions are absent in both alignments. Assume a standard independent base error model: if the alignment hypothesis is correct at a given position $i$, the probability that the observed base matches the reference base is $(1 - e)$ and the probability that it is any one of the three mismatching bases is $e/3$, where $e = 10^{-Q/10}$. Assume all base errors are independent across positions.\n\nAssume equal priors for the two alignment hypotheses $\\mathcal{A}_{1}$ and $\\mathcal{A}_{2}$. To reflect genome repetitiveness and the practical uncertainty introduced by index heuristics, use the following realistic priors and heuristic cap:\n- Let the prior probability that a read originates from a repetitive locus (so that multiple distinct genomic loci can produce similarly good alignments) be $\\pi_{r} = 10^{-3}$ and the probability of a unique locus be $\\pi_{u} = 1 - \\pi_{r}$. If the read is repetitive, assume a conservative lower bound on the posterior probability of incorrect placement of $\\eta = \\frac{1}{2}$ (i.e., at least one other locus is comparably likely).\n- After computing the Phred-scaled MAPQ from the mixed posterior error probability, apply an index-uncertainty cap by taking the minimum of the raw MAPQ and $C_{\\text{index}} = 30$.\n\nStarting from the independent per-base error model and fundamental probability definitions, derive the likelihood ratio between $\\mathcal{A}_{1}$ and $\\mathcal{A}_{2}$, the posterior probability that $\\mathcal{A}_{1}$ is incorrect, convert this to MAPQ, and then apply the index cap. Express the final MAPQ as a single real number (dimensionless). Round your final answer to three significant figures.", "solution": "The user wants me to solve the problem described in \"prompt\".\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n- Sequencing read length: $L = 100$\n- Uniform Phred quality score: $Q = 30$\n- Best alignment hypothesis $\\mathcal{A}_{1}$: $k_{1} = 2$ mismatches (substitutions only)\n- Second-best alignment hypothesis $\\mathcal{A}_{2}$: $k_{2} = 3$ mismatches (substitutions only)\n- Insertions and deletions are absent.\n- Per-base error probability: $e = 10^{-Q/10}$\n- For a correct alignment at position $i$:\n    - Probability of observed base matching reference: $(1 - e)$\n    - Probability of observed base being any one of the three mismatching bases: $e/3$\n- Base errors are independent across positions.\n- Priors for alignment hypotheses: $P(\\mathcal{A}_{1}) = P(\\mathcal{A}_{2})$\n- Prior probability of a repetitive locus: $\\pi_{r} = 10^{-3}$\n- Prior probability of a unique locus: $\\pi_{u} = 1 - \\pi_{r}$\n- If the locus is repetitive, posterior probability of incorrect placement is at least $\\eta = \\frac{1}{2}$.\n- Index-uncertainty cap: $C_{\\text{index}} = 30$\n- The final answer is to be rounded to three significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem is firmly grounded in the principles of bioinformatics and genomic diagnostics. It uses standard, well-established models: the Phred scale for sequencing error, an independent per-base error model, Bayesian inference for comparing alignment hypotheses, and the definition of Mapping Quality (MAPQ). The inclusion of priors for repetitive regions and a heuristic cap reflects realistic complexities handled by production-grade alignment software. The problem is scientifically and factually sound.\n- **Well-Posed:** All necessary variables, constants, and models are explicitly provided. The objective is clearly stated: calculate the final MAPQ after a series of specified steps. The problem is self-contained and allows for the derivation of a unique, stable solution.\n- **Objective:** The problem is stated using precise, quantitative, and unbiased language. There are no subjective elements or ambiguities in the definitions.\n\n**Step 3: Verdict and Action**\nThe problem is valid as it is scientifically sound, well-posed, and objective. I will proceed with the solution.\n\n**Solution Derivation**\n\nThe primary goal is to compute the Mapping Quality (MAPQ), which is the Phred-scaled posterior probability that the best alignment, $\\mathcal{A}_{1}$, is incorrect. The calculation involves several steps, starting from the base-level error model and incorporating uncertainties from alignment ambiguity and genome repetitiveness.\n\n**1. Per-Base Error Probability**\nThe Phred quality score $Q$ is related to the base-call error probability $e$ by the definition $e = 10^{-Q/10}$.\nGiven $Q = 30$, the error probability at any given base is:\n$$e = 10^{-30/10} = 10^{-3} = 0.001$$\n\n**2. Likelihood of Alignment Hypotheses**\nLet $D$ represent the observed sequencing read data. We need to calculate the likelihood of observing $D$ given an alignment hypothesis $\\mathcal{A}_{i}$, denoted $P(D | \\mathcal{A}_{i})$. An alignment hypothesis $\\mathcal{A}_i$ places the read of length $L$ at a specific genomic locus with $k_i$ mismatches and $L-k_i$ matches.\n\nAccording to the provided error model:\n- At a position where the alignment indicates a match, the probability of observing the matching base is $(1-e)$.\n- At a position where the alignment indicates a mismatch, a specific incorrect base is observed. The probability of this specific substitution is given as $e/3$.\n\nSince base errors are independent, the likelihood of an entire alignment is the product of the probabilities at each position. For an alignment $\\mathcal{A}_i$ with $k_i$ mismatches:\n$$P(D | \\mathcal{A}_i) = (1-e)^{L-k_i} \\left(\\frac{e}{3}\\right)^{k_i}$$\n\nFor the two competing hypotheses:\n- For $\\mathcal{A}_1$ with $L=100$ and $k_1=2$:\n$$P(D | \\mathcal{A}_1) = (1-e)^{100-2} \\left(\\frac{e}{3}\\right)^{2} = (1-e)^{98} \\left(\\frac{e}{3}\\right)^{2}$$\n- For $\\mathcal{A}_2$ with $L=100$ and $k_2=3$:\n$$P(D | \\mathcal{A}_2) = (1-e)^{100-3} \\left(\\frac{e}{3}\\right)^{3} = (1-e)^{97} \\left(\\frac{e}{3}\\right)^{3}$$\n\n**3. Likelihood Ratio**\nWe compute the likelihood ratio of the second-best to the best alignment hypothesis:\n$$\\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)} = \\frac{(1-e)^{97} (e/3)^{3}}{(1-e)^{98} (e/3)^{2}} = \\frac{e/3}{1-e}$$\n\n**4. Posterior Probability of Error (Alignment Ambiguity)**\nTo find the probability that the best alignment $\\mathcal{A}_1$ is incorrect, we first consider the simplified case where the only alternatives are captured by $\\mathcal{A}_2$. Let this conditional error probability be $P_{\\text{err, align}}$. Using Bayes' theorem and the given equal priors ($P(\\mathcal{A}_1) = P(\\mathcal{A}_2)$), the posterior probability of $\\mathcal{A}_1$ being correct is:\n$$P(\\mathcal{A}_1 | D) = \\frac{P(D | \\mathcal{A}_1) P(\\mathcal{A}_1)}{P(D | \\mathcal{A}_1) P(\\mathcal{A}_1) + P(D | \\mathcal{A}_2) P(\\mathcal{A}_2)} = \\frac{P(D | \\mathcal{A}_1)}{P(D | \\mathcal{A}_1) + P(D | \\mathcal{A}_2)}$$\nDividing the numerator and denominator by $P(D | \\mathcal{A}_1)$:\n$$P(\\mathcal{A}_1 | D) = \\frac{1}{1 + \\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)}}$$\nThe probability that $\\mathcal{A}_1$ is incorrect (i.e., that $\\mathcal{A}_2$ is correct in this two-hypothesis world) is $P_{\\text{err, align}} = 1 - P(\\mathcal{A}_1 | D)$:\n$$P_{\\text{err, align}} = 1 - \\frac{1}{1 + \\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)}} = \\frac{\\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)}}{1 + \\frac{P(D | \\mathcal{A}_2)}{P(D | \\mathcal{A}_1)}}$$\nSubstituting the likelihood ratio:\n$$P_{\\text{err, align}} = \\frac{\\frac{e/3}{1-e}}{1 + \\frac{e/3}{1-e}} = \\frac{e/3}{1-e+e/3} = \\frac{e/3}{1 - 2e/3}$$\n\n**5. Total Posterior Error Probability**\nThe final probability of error must account for the prior knowledge about the genome structure (unique vs. repetitive loci). We use the law of total probability. Let $E$ be the event that the alignment $\\mathcal{A}_1$ is incorrect. Let $U$ be the event the read originates from a unique locus and $R$ be the event it originates from a repetitive locus.\n$$P(E) = P(E|U)P(U) + P(E|R)P(R)$$\n- $P(U) = \\pi_u = 1 - \\pi_r$ is the prior probability of a unique locus.\n- $P(R) = \\pi_r = 10^{-3}$ is the prior probability of a repetitive locus.\n- $P(E|U) = P_{\\text{err, align}}$ is the error probability if the locus is unique, where the error arises purely from chance similarity to another locus.\n- $P(E|R) = \\eta = \\frac{1}{2}$ is the given conservative probability of error if the locus is repetitive.\n\nThe total posterior error probability, $P_{\\text{err, total}}$, is:\n$$P_{\\text{err, total}} = P_{\\text{err, align}} \\cdot \\pi_u + \\eta \\cdot \\pi_r$$\n\n**6. Numerical Calculation**\nWe substitute the given values:\n- $e = 10^{-3} = 0.001$\n- $\\pi_r = 10^{-3} = 0.001$\n- $\\pi_u = 1 - 0.001 = 0.999$\n- $\\eta = 0.5$\n\nFirst, calculate $P_{\\text{err, align}}$:\n$$P_{\\text{err, align}} = \\frac{0.001/3}{1 - 2(0.001)/3} = \\frac{0.001/3}{1 - 0.002/3} = \\frac{0.001/3}{(3-0.002)/3} = \\frac{0.001}{2.998}$$\nNow, calculate $P_{\\text{err, total}}$:\n$$P_{\\text{err, total}} = \\left(\\frac{0.001}{2.998}\\right) \\cdot (0.999) + (0.5) \\cdot (0.001)$$\n$$P_{\\text{err, total}} = \\frac{0.000999}{2.998} + 0.0005 \\approx 0.000333222 + 0.0005 = 0.000833222$$\n\n**7. MAPQ Calculation and Capping**\nThe raw MAPQ is calculated using the Phred scale formula:\n$$\\text{MAPQ}_{\\text{raw}} = -10 \\log_{10}(P_{\\text{err, total}})$$\n$$\\text{MAPQ}_{\\text{raw}} = -10 \\log_{10}(0.000833222) \\approx -10(-3.0792) \\approx 30.792$$\nThe problem specifies an index-uncertainty cap of $C_{\\text{index}} = 30$. The final MAPQ is the minimum of the raw calculation and the cap.\n$$\\text{MAPQ}_{\\text{final}} = \\min(\\text{MAPQ}_{\\text{raw}}, C_{\\text{index}})$$\n$$\\text{MAPQ}_{\\text{final}} = \\min(30.792, 30) = 30$$\n\n**8. Final Answer Formatting**\nThe problem requires the answer to be a single real number rounded to three significant figures. The calculated value is exactly $30$. To express this with three significant figures, we write it as $30.0$.", "answer": "$$\\boxed{30.0}$$", "id": "4375061"}]}