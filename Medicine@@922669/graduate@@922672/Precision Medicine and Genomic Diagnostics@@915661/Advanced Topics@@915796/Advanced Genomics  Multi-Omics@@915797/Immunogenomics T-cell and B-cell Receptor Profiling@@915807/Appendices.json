{"hands_on_practices": [{"introduction": "High-throughput sequencing data forms the bedrock of immunogenomics, but it is not infallible; sequencing errors can obscure true biological variation. This practice will guide you through a realistic bioinformatic challenge: developing a computational pipeline to distinguish genuine somatic variants from sequencing artifacts [@problem_id:4352270]. By implementing a model based on Hamming distance, Phred quality scores, and binomial statistics, you will gain hands-on experience in the critical data-cleaning step required for any downstream repertoire analysis.", "problem": "Consider a collection of Complementarity-Determining Region 3 (CDR3) nucleotide sequences of equal length, each observed with a nonnegative integer read count and, for sequences that differ from a hypothesized cluster parent by a small number of substitutions, with a list of per-mismatch base quality scores in Phred units. Use the following fundamental bases: the Central Dogma of Molecular Biology dictates that nucleotide sequences encode biological information; Illumina-like basecalling quality scores in Phred units relate the probability of an incorrect base call $p$ to the quality $Q$ via $Q = -10 \\log_{10}(p)$; the Hamming distance $d_H$ between two sequences of equal length equals the number of positions at which they differ; and independent basecalling errors across positions imply that the probability of simultaneously generating a specific set of substitutions is the product of the per-position probabilities. In a standard substitution error model, assuming equal probability for any of the three non-reference nucleotides, the probability of a specific wrong base at a position with error probability $p$ is $p/3$. Given a cluster parent with read count $n_p$ and a candidate variant $v$ with read count $n_v$ that differs at $m$ positions with per-mismatch Phred scores $\\{Q_i\\}_{i=1}^m$, the null that $v$ arises from sequencing errors in reads of the parent implies that the number of reads equal to $v$ follows a $\\mathrm{Binomial}(n_p, p_{\\text{var}})$ distribution with $p_{\\text{var}} = \\prod_{i=1}^m \\left(10^{-Q_i/10}/3\\right)$. A one-sided test classifies $v$ as a true somatic variant if the survival probability $\\Pr\\left(X \\ge n_v\\right)$ under $X \\sim \\mathrm{Binomial}(n_p, p_{\\text{var}})$ is below a chosen significance level, and if additional frequency and minimum count criteria are satisfied.\n\nYour task is to implement the following, starting from the above fundamental bases and using only finite, discrete computations:\n\n- Step $1$ (Clustering): Given a Hamming distance threshold $d_{\\max}$, build clusters using single-linkage connectivity: represent sequences as nodes in an undirected graph with an edge between two nodes if their Hamming distance is at most $d_{\\max}$, then define clusters as the connected components. Within each cluster, define the cluster parent as the sequence with the largest read count (breaking ties arbitrarily but deterministically by lexicographic order if needed).\n\n- Step $2$ (Variant error probability): For each non-parent sequence $v$ in a cluster, compute the Hamming distance to its parent and retrieve the corresponding list of Phred quality scores for the mismatching positions (these lists are provided in the test suite). Convert each $Q_i$ to an error probability $p_i = 10^{-Q_i/10}$ and then to the specific wrong-base probability $p_i/3$. Under independence, compute $p_{\\text{var}}$ as the product across mismatches.\n\n- Step $3$ (Statistical decision): For each candidate $v$, compute the one-sided survival probability $\\Pr\\left(X \\ge n_v\\right)$ under $X \\sim \\mathrm{Binomial}(n_p, p_{\\text{var}})$. Classify $v$ as a true somatic variant if and only if all of the following hold: the survival probability is strictly less than $\\alpha$, the absolute count $n_v$ is at least $n_{\\min}$, and the within-cluster frequency $f_v = n_v / n_{\\text{cluster}}$ is at least $f_{\\min}$, where $n_{\\text{cluster}}$ is the sum of read counts of all sequences in the cluster.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with entries for each test case as the number of clusters followed by the number of sequences classified as true somatic variants (across all clusters of that case). For example, in the format $[n_{\\text{clusters,case }1}, n_{\\text{true,case }1}, n_{\\text{clusters,case }2}, n_{\\text{true,case }2}, n_{\\text{clusters,case }3}, n_{\\text{true,case }3}]$.\n\nUse the following test suite, which provides sequences (strings over the alphabet $\\{A,C,G,T\\}$), read counts, per-sequence mismatch quality arrays, and decision thresholds. All sequences have equal length. Angles do not appear; no physical units are involved. The final outputs are integers.\n\n- Test case $1$ (happy path, mixed qualities, two clusters):\n    - Thresholds: $d_{\\max} = 1$, $\\alpha = 0.01$, $n_{\\min} = 3$, $f_{\\min} = 0.01$.\n    - Sequences and counts:\n        - Parent candidate: \"ACGTACGTACGT\" with count $1000$.\n        - Variant: \"ACGTACGTACGA\" with count $25$, mismatches quality array $[35]$.\n        - Variant: \"ACGTACGTTCGT\" with count $5$, mismatches quality array $[12]$.\n        - Variant: \"ACGTACGTACCT\" with count $2$, mismatches quality array $[40]$.\n        - Variant: \"ACGTACGTACGG\" with count $1$, mismatches quality array $[45]$.\n        - Second parent candidate: \"TGCATGCATGCA\" with count $70$.\n        - Variant near second parent: \"TGCATGCATGCG\" with count $4$, mismatches quality array $[10]$.\n\n- Test case $2$ (boundary condition with $d_{\\max} = 2$, mixed one- and two-mismatch variants, two clusters):\n    - Thresholds: $d_{\\max} = 2$, $\\alpha = 0.01$, $n_{\\min} = 3$, $f_{\\min} = 0.01$.\n    - Sequences and counts:\n        - Parent candidate: \"TTTTCCCCAAAA\" with count $300$.\n        - Variant: \"TTTTCCCGTAAA\" with count $10$, mismatches quality array $[30,30]$.\n        - Variant: \"TTTTCCCCAAAT\" with count $4$, mismatches quality array $[25]$.\n        - Variant: \"TTTTCCCCAATA\" with count $3$, mismatches quality array $[15]$.\n        - Independent second cluster: \"GGGGTTTTCCCC\" with count $120$.\n\n- Test case $3$ (edge case, high-quality but low-frequency variant screening, one cluster):\n    - Thresholds: $d_{\\max} = 2$, $\\alpha = 0.01$, $n_{\\min} = 3$, $f_{\\min} = 0.01$.\n    - Sequences and counts:\n        - Parent candidate: \"GGGGAAAACCCC\" with count $2000$.\n        - Variant: \"GGGGAAAACCCG\" with count $2$, mismatches quality array $[45]$.\n        - Variant: \"GGGGAAAACCCT\" with count $25$, mismatches quality array $[35]$.\n        - Variant: \"GGGGAAAGCCCT\" with count $3$, mismatches quality array $[20,20]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, specifically $[n_{\\text{clusters,case }1}, n_{\\text{true,case }1}, n_{\\text{clusters,case }2}, n_{\\text{true,case }2}, n_{\\text{clusters,case }3}, n_{\\text{true,case }3}]$, using the exact inputs and criteria above. No other text should be printed.", "solution": "The problem is valid. It is scientifically grounded in the principles of molecular biology and sequencing error analysis, well-posed with a clear and complete set of instructions and data, and objective in its formulation. The task is to implement a computational pipeline to distinguish true biological variants from sequencing artifacts in a set of immunogenomic sequences. This process involves three main stages: clustering sequences based on similarity, calculating error probabilities for potential variants, and applying a statistical test to classify them.\n\nThe solution proceeds by implementing the specified steps for each test case.\n\n**Step 1: Sequence Clustering and Parent Identification**\n\nThe first step is to group the input sequences into clusters based on their similarity. This is achieved using a single-linkage clustering approach.\n\n1.  **Graph Representation**: The collection of unique nucleotide sequences is conceptualized as a set of nodes in an undirected graph. An edge is drawn between any two nodes (sequences) if their Hamming distance, $d_H$, is less than or equal to a given threshold, $d_{\\max}$. The Hamming distance $d_H(s_1, s_2)$ between two sequences $s_1$ and $s_2$ of equal length is the number of positions at which the corresponding characters are different.\n\n2.  **Cluster Definition**: A cluster is defined as a connected component of this graph. A connected component is a subgraph in which any two vertices are connected to each other by a path, and which is connected to no additional vertices in the supergraph. Standard graph traversal algorithms, such as Breadth-First Search (BFS) or Depth-First Search (DFS), are employed to identify these components.\n\n3.  **Parent Identification**: Within each identified cluster, one sequence is designated as the \"cluster parent\". The parent is defined as the sequence with the highest associated read count, $n$. In cases where multiple sequences share the same maximum read count, the tie is broken deterministically by selecting the sequence that comes first in lexicographical order. All other sequences in the cluster are considered candidate variants originating from this parent.\n\n**Step 2: Variant Error Probability Calculation**\n\nFor each candidate variant $v$ in a cluster, we calculate the probability that it could have arisen from its parent $p$ due to sequencing errors alone. This forms the basis of our null hypothesis.\n\n1.  **Error Probability from Phred Score**: The quality of each base call is given by a Phred quality score, $Q$. The problem relates $Q$ to the probability of an erroneous base call, $p_{\\text{err}}$, by the formula $Q = -10 \\log_{10}(p_{\\text{err}})$. This can be rearranged to find the error probability for a specific base:\n    $$p_{\\text{err}} = 10^{-Q/10}$$\n\n2.  **Specific Substitution Probability**: The standard substitution error model assumes that if a base is called incorrectly, any of the three other nucleotides is equally likely. Thus, the probability of a specific incorrect base appearing at a position with error probability $p_{\\text{err}}$ is $p_{\\text{err}}/3$.\n\n3.  **Combined Probability for a Variant**: A variant $v$ differs from its parent $p$ at $m = d_H(p, v)$ positions. Let the Phred scores for these $m$ mismatching positions be $\\{Q_i\\}_{i=1}^m$. Assuming that sequencing errors at different positions are independent events, the total probability of this specific variant $v$ arising from parent $p$ through sequencing errors, denoted $p_{\\text{var}}$, is the product of the individual specific substitution probabilities:\n    $$p_{\\text{var}} = \\prod_{i=1}^{m} \\frac{10^{-Q_i/10}}{3}$$\n\n**Step 3: Statistical Decision for Variant Classification**\n\nThe final step is to decide whether a candidate variant is a \"true somatic variant\" or a sequencing artifact. This decision is based on a combination of statistical significance and heuristic filters.\n\n1.  **Null Hypothesis Testing**: The null hypothesis states that all $n_v$ reads observed for variant $v$ are the result of sequencing errors from the $n_p$ reads of the parent $p$. Under this hypothesis, the number of reads for variant $v$, modeled by a random variable $X$, follows a Binomial distribution, $X \\sim \\mathrm{Binomial}(n_p, p_{\\text{var}})$. We test this hypothesis by calculating the one-sided p-value, which is the probability of observing at least $n_v$ variant reads by chance. This is the survival function (SF) of the binomial distribution evaluated at $n_v-1$:\n    $$\\Pr(X \\ge n_v) = \\sum_{k=n_v}^{n_p} \\binom{n_p}{k} p_{\\text{var}}^k (1-p_{\\text{var}})^{n_p-k}$$\n\n2.  **Classification Criteria**: A candidate variant $v$ is classified as a \"true somatic variant\" if and only if it satisfies all three of the following conditions:\n    a. **Statistical Significance**: The survival probability must be strictly less than a predefined significance level $\\alpha$.\n       $$\\Pr(X \\ge n_v) < \\alpha$$\n    b. **Minimum Read Count**: The absolute read count for the variant, $n_v$, must meet or exceed a minimum threshold, $n_{\\min}$.\n       $$n_v \\ge n_{\\min}$$\n    c. **Minimum Frequency**: The relative frequency of the variant within its cluster must meet or exceed a minimum threshold, $f_{\\min}$. The cluster frequency is $f_v = n_v / n_{\\text{cluster}}$, where $n_{\\text{cluster}}$ is the sum of read counts of all sequences in the cluster.\n       $$\\frac{n_v}{n_{\\text{cluster}}} \\ge f_{\\min}$$\n\nBy applying these three steps to each provided test case, we determine the number of clusters and the total count of true somatic variants, which are then formatted into the final output.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import binom\nfrom collections import deque\n\ndef solve():\n    \"\"\"\n    Solves the immunogenomics variant calling problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # Test case 1\n        {\n            \"thresholds\": {\"d_max\": 1, \"alpha\": 0.01, \"n_min\": 3, \"f_min\": 0.01},\n            \"data\": {\n                \"ACGTACGTACGT\": (1000, []),\n                \"ACGTACGTACGA\": (25, [35]),\n                \"ACGTACGTTCGT\": (5, [12]),\n                \"ACGTACGTACCT\": (2, [40]),\n                \"ACGTACGTACGG\": (1, [45]),\n                \"TGCATGCATGCA\": (70, []),\n                \"TGCATGCATGCG\": (4, [10]),\n            }\n        },\n        # Test case 2\n        {\n            \"thresholds\": {\"d_max\": 2, \"alpha\": 0.01, \"n_min\": 3, \"f_min\": 0.01},\n            \"data\": {\n                \"TTTTCCCCAAAA\": (300, []),\n                \"TTTTCCCGTAAA\": (10, [30, 30]),\n                \"TTTTCCCCAAAT\": (4, [25]),\n                \"TTTTCCCCAATA\": (3, [15]),\n                \"GGGGTTTTCCCC\": (120, []),\n            }\n        },\n        # Test case 3\n        {\n            \"thresholds\": {\"d_max\": 2, \"alpha\": 0.01, \"n_min\": 3, \"f_min\": 0.01},\n            \"data\": {\n                \"GGGGAAAACCCC\": (2000, []),\n                \"GGGGAAAACCCG\": (2, [45]),\n                \"GGGGAAAACCCT\": (25, [35]),\n                \"GGGGAAAGCCCT\": (3, [20, 20]),\n            }\n        }\n    ]\n\n    final_results = []\n    for case in test_cases:\n        thresholds = case[\"thresholds\"]\n        data = case[\"data\"]\n        sequences = list(data.keys())\n        \n        # Step 1: Clustering\n        adj = {seq: [] for seq in sequences}\n        for i in range(len(sequences)):\n            for j in range(i + 1, len(sequences)):\n                s1, s2 = sequences[i], sequences[j]\n                dist = sum(1 for c1, c2 in zip(s1, s2) if c1 != c2)\n                if dist = thresholds[\"d_max\"]:\n                    adj[s1].append(s2)\n                    adj[s2].append(s1)\n\n        clusters = []\n        visited = set()\n        for seq in sequences:\n            if seq not in visited:\n                component = []\n                q = deque([seq])\n                visited.add(seq)\n                while q:\n                    current_seq = q.popleft()\n                    component.append(current_seq)\n                    for neighbor in adj[current_seq]:\n                        if neighbor not in visited:\n                            visited.add(neighbor)\n                            q.append(neighbor)\n                clusters.append(component)\n        \n        num_clusters = len(clusters)\n        total_true_variants = 0\n\n        for cluster in clusters:\n            if len(cluster) == 1:\n                continue\n\n            # Identify parent\n            cluster.sort(key=lambda s: (-data[s][0], s))\n            parent_seq = cluster[0]\n            n_p = data[parent_seq][0]\n            \n            n_cluster = sum(data[s][0] for s in cluster)\n\n            # Analyze variants\n            for variant_seq in cluster[1:]:\n                n_v, q_scores = data[variant_seq]\n\n                # Step 2: Calculate p_var\n                p_var = 1.0\n                for q in q_scores:\n                    p_err = 10**(-q / 10.0)\n                    p_var *= (p_err / 3.0)\n\n                # Step 3: Statistical decision\n                # Condition 2: Minimum read count\n                if n_v  thresholds[\"n_min\"]:\n                    continue\n                \n                # Condition 3: Minimum frequency\n                f_v = n_v / n_cluster\n                if f_v  thresholds[\"f_min\"]:\n                    continue\n\n                # Condition 1: Statistical significance\n                survival_prob = binom.sf(n_v - 1, n_p, p_var)\n                if survival_prob >= thresholds[\"alpha\"]:\n                    continue\n                \n                # All conditions met\n                total_true_variants += 1\n        \n        final_results.extend([num_clusters, total_true_variants])\n\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n\n```", "id": "4352270"}, {"introduction": "Once we have high-confidence sequences, a crucial analytical decision is how to define a \"clonotype.\" Due to the degeneracy of the genetic code, multiple nucleotide sequences can translate into the same amino acid sequence, presenting a choice between nucleotide-level or amino-acid-level clonotyping. This practice demonstrates the profound impact of this decision, requiring you to quantify how collapsing nucleotide sequences affects measures of repertoire diversity and the inference of shared, or \"public,\" clones between individuals [@problem_id:4352254].", "problem": "A core task in immunogenomics for precision medicine is defining clonotypes from T-Cell Receptor (TCR) or B-Cell Receptor (BCR) repertoires and quantifying how analytical choices affect diversity and the inference of shared public clones. Consider the Complementarity-Determining Region 3 (CDR3)-based clonotype definitions at the nucleotide level (unique CDR3 nucleotide sequences) and at the amino acid level (unique CDR3 amino acid sequences). Two individuals, $X$ and $Y$, each have TCR $\\beta$ repertoire data with observed CDR3 nucleotide clonotypes and read counts as follows, where each nucleotide clonotype maps to one amino acid clonotype due to codon translation:\n\nFor individual $X$: $s_1 \\to A$ with $40$ reads, $s_2 \\to A$ with $10$ reads, $s_3 \\to B$ with $25$ reads, $s_4 \\to C$ with $15$ reads, $s_5 \\to D$ with $10$ reads.\n\nFor individual $Y$: $s_6 \\to A$ with $20$ reads, $s_7 \\to B$ with $30$ reads, $s_8 \\to B$ with $10$ reads, $s_9 \\to C$ with $30$ reads, $s_{10} \\to E$ with $10$ reads.\n\nAssume that $s_7$ is the same nucleotide clonotype as $s_3$ (i.e., an identical CDR3 nucleotide sequence present in both $X$ and $Y$), while all other nucleotide clonotypes are distinct between $X$ and $Y$. At the amino acid level, the clonotype mappings are: $A$ for $\\{s_1, s_2, s_6\\}$, $B$ for $\\{s_3, s_7, s_8\\}$, $C$ for $\\{s_4, s_9\\}$, $D$ for $\\{s_5\\}$, and $E$ for $\\{s_{10}\\}$.\n\nUse the following fundamental bases:\n- The Central Dogma of molecular biology establishes that different nucleotide sequences can encode the same amino acid sequence due to codon degeneracy.\n- Shannon entropy $H$ for a discrete distribution is defined by $H = -\\sum_{i} p_i \\ln(p_i)$, where $p_i$ are relative frequencies and $\\ln$ is the natural logarithm.\n- The effective number of clonotypes (Hill number of order $1$) is $D = \\exp(H)$.\n\nDefine the collapse-induced bias index $B$ as\n$$\nB \\equiv \\left(\\frac{S_{\\mathrm{aa}}}{S_{\\mathrm{nt}}}\\right)\\left(\\frac{D_{\\mathrm{aa}}^{\\mathrm{pool}}}{D_{\\mathrm{nt}}^{\\mathrm{pool}}}\\right),\n$$\nwhere $S_{\\mathrm{aa}}$ and $S_{\\mathrm{nt}}$ are the numbers of shared clonotypes between individuals $X$ and $Y$ at the amino acid level and nucleotide level, respectively, and $D_{\\mathrm{aa}}^{\\mathrm{pool}}$ and $D_{\\mathrm{nt}}^{\\mathrm{pool}}$ are the effective numbers of clonotypes computed on the pooled data from $X$ and $Y$ at the amino acid and nucleotide levels, respectively.\n\nCompute $B$ from the provided data. Use the natural logarithm for entropy calculations. Round your final answer for $B$ to four significant figures. Express the final quantity as a pure number without units.", "solution": "The objective is to compute the collapse-induced bias index $B$, defined as $B \\equiv \\left(\\frac{S_{\\mathrm{aa}}}{S_{\\mathrm{nt}}}\\right)\\left(\\frac{D_{\\mathrm{aa}}^{\\mathrm{pool}}}{D_{\\mathrm{nt}}^{\\mathrm{pool}}}\\right)$. This requires the calculation of four quantities: the number of shared nucleotide clonotypes ($S_{\\mathrm{nt}}$), the number of shared amino acid clonotypes ($S_{\\mathrm{aa}}$), the effective number of clonotypes in the pooled nucleotide repertoire ($D_{\\mathrm{nt}}^{\\mathrm{pool}}$), and the effective number of clonotypes in the pooled amino acid repertoire ($D_{\\mathrm{aa}}^{\\mathrm{pool}}$).\n\nFirst, we determine the number of shared clonotypes between individuals $X$ and $Y$.\n\nThe number of shared nucleotide clonotypes, $S_{\\mathrm{nt}}$, is given directly by the problem statement. It is stated that \"$s_7$ is the same nucleotide clonotype as $s_3$\", and \"all other nucleotide clonotypes are distinct\". Therefore, there is exactly one shared nucleotide clonotype.\n$$\nS_{\\mathrm{nt}} = 1\n$$\nTo find the number of shared amino acid clonotypes, $S_{\\mathrm{aa}}$, we must first identify the set of amino acid clonotypes present in each individual.\nFor individual $X$, the nucleotide clonotypes are $\\{s_1, s_2, s_3, s_4, s_5\\}$, which map to the amino acid clonotypes $\\{A, A, B, C, D\\}$. The set of unique amino acid clonotypes in $X$ is $\\{A, B, C, D\\}$.\nFor individual $Y$, the nucleotide clonotypes are $\\{s_6, s_7, s_8, s_9, s_{10}\\}$, which map to the amino acid clonotypes $\\{A, B, B, C, E\\}$. The set of unique amino acid clonotypes in $Y$ is $\\{A, B, C, E\\}$.\nThe shared amino acid clonotypes are the intersection of these two sets: $\\{A, B, C, D\\} \\cap \\{A, B, C, E\\} = \\{A, B, C\\}$. The number of shared amino acid clonotypes is therefore $3$.\n$$\nS_{\\mathrm{aa}} = 3\n$$\n\nNext, we compute the effective number of clonotypes for the pooled data, starting with the nucleotide level. To find $D_{\\mathrm{nt}}^{\\mathrm{pool}}$, we first pool the reads from both individuals for each unique nucleotide sequence.\nThe total number of reads in individual $X$ is $40 + 10 + 25 + 15 + 10 = 100$.\nThe total number of reads in individual $Y$ is $20 + 30 + 10 + 30 + 10 = 100$.\nThe total number of reads in the pooled data is $100 + 100 = 200$.\nThe unique nucleotide clonotypes in the pooled repertoire and their total read counts are:\n- $s_1$: $40$ reads\n- $s_2$: $10$ reads\n- $s_3/s_7$: $25 (\\text{from } X) + 30 (\\text{from } Y) = 55$ reads\n- $s_4$: $15$ reads\n- $s_5$: $10$ reads\n- $s_6$: $20$ reads\n- $s_8$: $10$ reads\n- $s_9$: $30$ reads\n- $s_{10}$: $10$ reads\n\nThe relative frequencies ($p_i$) of these $9$ unique nucleotide clonotypes are:\n$p_1 = \\frac{40}{200} = 0.2$, $p_2 = \\frac{10}{200} = 0.05$, $p_3 = \\frac{55}{200} = 0.275$, $p_4 = \\frac{15}{200} = 0.075$, $p_5 = \\frac{10}{200} = 0.05$, $p_6 = \\frac{20}{200} = 0.1$, $p_7 = \\frac{10}{200} = 0.05$, $p_8 = \\frac{30}{200} = 0.15$, $p_9 = \\frac{10}{200} = 0.05$.\n\nThe Shannon entropy $H_{\\mathrm{nt}}^{\\mathrm{pool}}$ is calculated as $H = -\\sum_{i} p_i \\ln(p_i)$:\n$$\nH_{\\mathrm{nt}}^{\\mathrm{pool}} = - \\begin{pmatrix} 0.2 \\ln(0.2) + 0.05 \\ln(0.05) + 0.275 \\ln(0.275) + 0.075 \\ln(0.075) \\\\ + 0.05 \\ln(0.05) + 0.1 \\ln(0.1) + 0.05 \\ln(0.05) + 0.15 \\ln(0.15) + 0.05 \\ln(0.05) \\end{pmatrix}\n$$\n$$\nH_{\\mathrm{nt}}^{\\mathrm{pool}} = - [ 0.2 \\ln(0.2) + 0.275 \\ln(0.275) + 0.15 \\ln(0.15) + 0.1 \\ln(0.1) + 0.075 \\ln(0.075) + 4(0.05 \\ln(0.05)) ]\n$$\n$$\nH_{\\mathrm{nt}}^{\\mathrm{pool}} \\approx - [-0.321888 - 0.355021 - 0.284568 - 0.230259 - 0.194270 + 4(-0.149787)]\n$$\n$$\nH_{\\mathrm{nt}}^{\\mathrm{pool}} \\approx - [-1.386006 - 0.599148] = -(-1.985154) \\approx 1.985154\n$$\nThe effective number of clonotypes $D_{\\mathrm{nt}}^{\\mathrm{pool}}$ is $\\exp(H_{\\mathrm{nt}}^{\\mathrm{pool}})$:\n$$\nD_{\\mathrm{nt}}^{\\mathrm{pool}} = \\exp(1.985154) \\approx 7.280145\n$$\n\nNow, we compute the effective number of clonotypes for the pooled amino acid data, $D_{\\mathrm{aa}}^{\\mathrm{pool}}$. We pool the reads based on their unique amino acid sequence.\n- Clonotype $A$: reads from $s_1, s_2, s_6 \\implies 40 + 10 + 20 = 70$ reads.\n- Clonotype $B$: reads from $s_3, s_7, s_8 \\implies 25 + 30 + 10 = 65$ reads.\n- Clonotype $C$: reads from $s_4, s_9 \\implies 15 + 30 = 45$ reads.\n- Clonotype $D$: reads from $s_5 \\implies 10$ reads.\n- Clonotype $E$: reads from $s_{10} \\implies 10$ reads.\nThe total number of reads is $70 + 65 + 45 + 10 + 10 = 200$.\nThe relative frequencies ($p_i$) of these $5$ unique amino acid clonotypes are:\n$p_A = \\frac{70}{200} = 0.35$, $p_B = \\frac{65}{200} = 0.325$, $p_C = \\frac{45}{200} = 0.225$, $p_D = \\frac{10}{200} = 0.05$, $p_E = \\frac{10}{200} = 0.05$.\n\nThe Shannon entropy $H_{\\mathrm{aa}}^{\\mathrm{pool}}$ is:\n$$\nH_{\\mathrm{aa}}^{\\mathrm{pool}} = - [ 0.35 \\ln(0.35) + 0.325 \\ln(0.325) + 0.225 \\ln(0.225) + 2(0.05 \\ln(0.05)) ]\n$$\n$$\nH_{\\mathrm{aa}}^{\\mathrm{pool}} \\approx - [-0.367438 - 0.365278 - 0.335622 + 2(-0.149787)]\n$$\n$$\nH_{\\mathrm{aa}}^{\\mathrm{pool}} \\approx - [-1.068338 - 0.299574] = -(-1.367912) \\approx 1.367912\n$$\nThe effective number of clonotypes $D_{\\mathrm{aa}}^{\\mathrm{pool}}$ is $\\exp(H_{\\mathrm{aa}}^{\\mathrm{pool}})$:\n$$\nD_{\\mathrm{aa}}^{\\mathrm{pool}} = \\exp(1.367912) \\approx 3.927118\n$$\n\nFinally, we compute the collapse-induced bias index $B$:\n$$\nB = \\left(\\frac{S_{\\mathrm{aa}}}{S_{\\mathrm{nt}}}\\right)\\left(\\frac{D_{\\mathrm{aa}}^{\\mathrm{pool}}}{D_{\\mathrm{nt}}^{\\mathrm{pool}}}\\right) = \\left(\\frac{3}{1}\\right) \\left(\\frac{3.927118}{7.280145}\\right)\n$$\n$$\nB = 3 \\times 0.5394295 \\approx 1.6182885\n$$\nRounding the result to four significant figures, we get $1.618$.", "answer": "$$\n\\boxed{1.618}\n$$", "id": "4352254"}, {"introduction": "A primary goal of repertoire profiling is to quantitatively describe its structure, particularly the balance between the number of unique clonotypes (richness) and the dominance of expanded clones (evenness). This exercise introduces Hill numbers as a powerful, unified framework for measuring diversity across this spectrum [@problem_id:4352355]. By calculating diversity indices of different orders ($q=0, 1, 2$), you will learn to interpret the \"diversity profile\" of a repertoire and understand what it reveals about the underlying immunological state, such as an antigen-driven clonal expansion.", "problem": "In a study of tumor-infiltrating lymphocytes to guide precision immunotherapy, high-throughput sequencing of the T-cell receptor (TCR) beta chain Complementarity-Determining Region 3 (CDR3) was performed. Unique Molecular Identifier (UMI)-corrected clonotype counts were normalized to frequencies to yield a complete repertoire of observed clonotypes for a single patient sample. Let the normalized clonotype frequency vector be\n$$\n\\mathbf{p}=\\big(0.22,\\,0.18,\\,0.12,\\,0.10,\\,0.08,\\,0.07,\\,0.06,\\,0.05,\\,0.05,\\,0.04,\\,0.03\\big),\n$$\nwhich sums to $1$ and represents the full set of nonzero clonotypes in this sample.\n\nUsing the definition of Hill numbers $^{q}D$ as the family of diversity measures parameterized by the order $q$, where for $q\\neq 1$,\n$$\n^{q}D=\\left(\\sum_{i=1}^{R} p_{i}^{\\,q}\\right)^{\\frac{1}{1-q}},\n$$\nand by continuity for $q\\to 1$,\n$$\n^{1}D=\\exp\\!\\left(-\\sum_{i=1}^{R} p_{i}\\ln p_{i}\\right),\n$$\ncompute the Hill numbers for $q=0$, $q=1$, and $q=2$ for this repertoire. Begin from core probability definitions and limits to justify each case, including the $q\\to 1$ limit. Then, in the context of immunogenomics of T-cell and B-cell receptor (BCR) profiling, explain how varying $q$ reweights richness versus dominance and why this is informative about clonal expansion in immune repertoires.\n\nReport your three diversity values as a row vector $\\big(^{0}D,\\,^{1}D,\\,^{2}D\\big)$ and round each entry to four significant figures. No units are required for the final numerical values. Use radians if any angles appear.", "solution": "The problem is valid as it is scientifically grounded in immunogenomics and biostatistics, well-posed with all necessary data and definitions, and objective in its formulation. The concepts of Hill numbers, Shannon entropy, and Simpson index are standard measures of diversity, and their application to T-cell receptor repertoire analysis is a cornerstone of quantitative immunology.\n\nThe task is to compute the Hill numbers of order $q=0$, $q=1$, and $q=2$ for a given T-cell receptor (TCR) clonotype frequency distribution and to provide a biological interpretation of these measures in the context of immune repertoire analysis. The provided clonotype frequency vector is $\\mathbf{p}=\\big(0.22,\\,0.18,\\,0.12,\\,0.10,\\,0.08,\\,0.07,\\,0.06,\\,0.05,\\,0.05,\\,0.04,\\,0.03\\big)$. The total number of observed clonotypes (richness) is $R=11$. The sum of these frequencies is $\\sum_{i=1}^{11} p_i = 1.00$.\n\nThe Hill numbers, denoted $^{q}D$, are a family of diversity indices parameterized by the order $q$. The general formula for $q \\neq 1$ is:\n$$\n^{q}D=\\left(\\sum_{i=1}^{R} p_{i}^{\\,q}\\right)^{\\frac{1}{1-q}}\n$$\nWe will now compute the Hill numbers for $q=0$, $q=2$, and $q=1$.\n\n**Case 1: Hill number of order $q=0$ (Richness)**\n\nFor $q=0$, the general formula is applied directly.\n$$\n^{0}D = \\left(\\sum_{i=1}^{R} p_{i}^{\\,0}\\right)^{\\frac{1}{1-0}} = \\sum_{i=1}^{R} p_{i}^{\\,0}\n$$\nBy definition, for any nonzero probability $p_i  0$, the value of $p_i^{\\,0}$ is $1$. Since the problem states that the vector $\\mathbf{p}$ represents the \"full set of nonzero clonotypes\", every $p_i$ in the sum is greater than $0$. Therefore, the sum becomes a count of the number of terms:\n$$\n^{0}D = \\sum_{i=1}^{R} 1 = R\n$$\nThis measure, $^{0}D$, is simply the total number of unique clonotypes observed in the sample, also known as species richness. It is completely insensitive to the relative abundance of the clonotypes, treating a clonotype with frequency $0.22$ and one with frequency $0.03$ as equal contributors to the diversity.\nFor the given vector $\\mathbf{p}$, there are $R=11$ distinct clonotype frequencies.\n$$\n^{0}D = 11\n$$\n\n**Case 2: Hill number of order $q=2$ (Inverse Simpson Index)**\n\nFor $q=2$, the general formula gives:\n$$\n^{2}D = \\left(\\sum_{i=1}^{R} p_{i}^{\\,2}\\right)^{\\frac{1}{1-2}} = \\left(\\sum_{i=1}^{R} p_{i}^{\\,2}\\right)^{-1} = \\frac{1}{\\sum_{i=1}^{R} p_{i}^{\\,2}}\n$$\nThe term in the denominator, $\\lambda = \\sum_{i=1}^{R} p_{i}^{\\,2}$, is the Simpson index. It represents the probability that two T-cells selected randomly (with replacement) from the population belong to the same clonotype. The Hill number $^{2}D$ is the inverse of the Simpson index and can be interpreted as the effective number of dominant clonotypes. The squaring of the frequencies gives disproportionately more weight to the most abundant clonotypes.\n\nLet's calculate $\\sum p_i^2$ for the given data:\n$$\n\\sum_{i=1}^{11} p_i^{\\,2} = (0.22)^2 + (0.18)^2 + (0.12)^2 + (0.10)^2 + (0.08)^2 + (0.07)^2 + (0.06)^2 + (0.05)^2 + (0.05)^2 + (0.04)^2 + (0.03)^2\n$$\n$$\n\\sum_{i=1}^{11} p_i^{\\,2} = 0.0484 + 0.0324 + 0.0144 + 0.0100 + 0.0064 + 0.0049 + 0.0036 + 0.0025 + 0.0025 + 0.0016 + 0.0009 = 0.1276\n$$\nNow we can calculate $^{2}D$:\n$$\n^{2}D = \\frac{1}{0.1276} \\approx 7.8369905956...\n$$\n\n**Case 3: Hill number of order $q=1$ (Exponential of Shannon Entropy)**\n\nAs $q \\to 1$, the general formula $^{q}D = (\\sum p_i^{\\,q})^{1/(1-q)}$ approaches the indeterminate form $1^{\\infty}$, since $\\sum p_i^1 = 1$. To resolve this, we analyze the limit of its logarithm, $\\ln(^{q}D)$.\n$$\n\\ln(^{q}D) = \\frac{\\ln\\left(\\sum_{i=1}^{R} p_i^{\\,q}\\right)}{1-q}\n$$\nAs $q \\to 1$, the numerator approaches $\\ln(\\sum p_i) = \\ln(1) = 0$ and the denominator approaches $0$. This is an indeterminate form of type $0/0$, so we can apply L'Hôpital's rule. We differentiate the numerator and denominator with respect to $q$:\nLet $f(q) = \\ln\\left(\\sum p_i^{\\,q}\\right)$ and $g(q) = 1-q$.\n$$\nf'(q) = \\frac{d}{dq}\\ln\\left(\\sum p_i^{\\,q}\\right) = \\frac{1}{\\sum p_i^{\\,q}} \\cdot \\frac{d}{dq}\\left(\\sum p_i^{\\,q}\\right) = \\frac{\\sum (p_i^{\\,q} \\ln p_i)}{\\sum p_i^{\\,q}}\n$$\n$$\ng'(q) = \\frac{d}{dq}(1-q) = -1\n$$\nApplying L'Hôpital's rule:\n$$\n\\lim_{q \\to 1} \\ln(^{q}D) = \\lim_{q \\to 1} \\frac{f'(q)}{g'(q)} = \\lim_{q \\to 1} \\frac{\\sum (p_i^{\\,q} \\ln p_i) / (\\sum p_i^{\\,q})}{-1}\n$$\nSubstituting $q=1$:\n$$\n\\lim_{q \\to 1} \\ln(^{q}D) = \\frac{\\sum (p_i^{\\,1} \\ln p_i) / (\\sum p_i^{\\,1})}{-1} = \\frac{\\sum p_i \\ln p_i}{ -1} = -\\sum_{i=1}^{R} p_i \\ln p_i\n$$\nThis expression is the Shannon entropy, $H$. Thus, $\\lim_{q\\to 1} \\ln(^{q}D) = H$, which implies that the limit of $^{q}D$ is:\n$$\n^{1}D = \\lim_{q \\to 1} {^q D} = \\exp(H) = \\exp\\left(-\\sum_{i=1}^{R} p_i \\ln p_i\\right)\n$$\nThis measure can be interpreted as the effective number of common clonotypes, as each clonotype is weighted exactly by its frequency.\n\nLet's calculate the Shannon entropy $H$ for the given data:\n$$\nH = - \\sum_{i=1}^{11} p_i \\ln p_i = - [ 0.22\\ln(0.22) + 0.18\\ln(0.18) + 0.12\\ln(0.12) + 0.10\\ln(0.10) + 0.08\\ln(0.08) + 0.07\\ln(0.07) + 0.06\\ln(0.06) + 2 \\times 0.05\\ln(0.05) + 0.04\\ln(0.04) + 0.03\\ln(0.03) ]\n$$\n$$\nH \\approx - [ -0.333107 + (-0.308664) + (-0.254432) + (-0.230259) + (-0.202058) + (-0.186148) + (-0.168805) + 2 \\times (-0.149787) + (-0.128755) + (-0.105197) ]\n$$\n$$\nH \\approx - [-1.917425 - 2 \\times 0.149787] \\approx - [-2.216999] \\approx 2.21699949...\n$$\nNow we compute $^{1}D$:\n$$\n^{1}D = \\exp(H) \\approx \\exp(2.21699949...) \\approx 9.1802935...\n$$\n\n**Interpretation in Immunogenomics**\n\nThe parameter $q$ in the Hill diversity numbers controls the sensitivity of the metric to clonotype frequencies. This provides a powerful tool for characterizing the structure of an immune repertoire.\n- **$q=0$ (${^{0}D}$)**: This is the richness, or total number of unique TCR/BCR clonotypes. It gives equal weight to every clonotype, regardless of its abundance. It is therefore highly sensitive to rare clonotypes. In a tumor microenvironment, a high $^{0}D$ indicates a broad potential for antigen recognition.\n- **$q=1$ (${^{1}D}$)**: This metric, the exponential of Shannon entropy, weights clonotypes proportionally to their frequency. It is often interpreted as the \"effective number of common clonotypes.\" It represents the diversity of a hypothetical repertoire where all clonotypes are equally abundant.\n- **$q=2$ (${^{2}D}$)**: This metric, the inverse Simpson index, disproportionately weights the most frequent clonotypes due to the squaring of frequencies ($p_i^2$). It is interpreted as the \"effective number of dominant clonotypes\" and is highly sensitive to the presence of large, expanded clones.\n\n**Informing on Clonal Expansion**: The relationship between these values reveals the evenness of the repertoire. A healthy, naive immune repertoire is highly diverse and even, meaning it has many different clonotypes at low, similar frequencies. In this case, $^{0}D \\approx {^{1}D} \\approx {^{2}D}$. In contrast, a strong immune response, such as the anti-tumor response studied here, is characterized by **clonal expansion**: a few specific T-cell clones that recognize tumor antigens proliferate dramatically. This creates a highly uneven repertoire with a few dominant clones and many rare ones. This unevenness is captured by the profile of Hill numbers: $^{0}D$ will be much larger than $^{2}D$, with $^{1}D$ in between.\nThe calculated values for this patient are $^{0}D = 11$, $^{1}D \\approx 9.180$, and $^{2}D \\approx 7.837$. The clear hierarchy $^{0}D  {^{1}D}  {^{2}D}$ ($11  9.180  7.837$) quantitatively demonstrates a notable degree of unevenness and clonal dominance in the tumor-infiltrating lymphocyte population, which is a typical signature of an active, antigen-driven immune response. This information is critical for precision medicine, as a highly clonal response may indicate a better prognosis or predict a favorable response to checkpoint inhibitor immunotherapies.\n\n**Final Numerical Values**\n\nRounding the results to four significant figures:\n$^{0}D = 11.00$\n$^{1}D \\approx 9.180$\n$^{2}D \\approx 7.837$\n\nThe final answer is the row vector of these three values.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n11.00  9.180  7.837\n\\end{pmatrix}\n}\n$$", "id": "4352355"}]}