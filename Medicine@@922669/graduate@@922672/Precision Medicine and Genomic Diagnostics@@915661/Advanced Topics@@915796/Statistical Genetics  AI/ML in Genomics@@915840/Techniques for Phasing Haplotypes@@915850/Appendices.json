{"hands_on_practices": [{"introduction": "Haplotype phasing algorithms must integrate evidence from many, often conflicting, sequencing reads to reconstruct the most plausible pair of haplotypes. A powerful and common approach is to model this as a graph problem, where finding the optimal phase corresponds to finding a minimum weighted cut. This practice challenges you to translate probabilistic evidence from sequencing reads, encoded in Phred quality scores, into edge weights in a conflict graph and find the most likely haplotype configuration based on this model [@problem_id:4388626].", "problem": "In graph-based haplotype phasing for precision medicine and genomic diagnostics, adjacent heterozygous single-nucleotide variants are grouped into two haplotypes by partitioning a graph whose vertices represent variants and whose edges encode read-based evidence that specific pairs of variants are co-phased on the same chromosome. Consider four heterozygous variants labeled $A$, $B$, $C$, and $D$ in a pharmacogenomically relevant gene. There are edges $(A,B)$, $(B,C)$, and $(C,D)$, each supported by two independent paired-end reads spanning the corresponding variant pair. Assume that variant $A$ is known to lie on haplotype $H_1$ and variant $D$ on haplotype $H_2$ from orthogonal phase information, and that cutting an edge $(i,j)$ corresponds to placing $i$ and $j$ on different haplotypes, thereby contradicting the reads that span $(i,j)$.\n\nUse the following fundamental bases:\n- The Phred base quality definition: for any base call with quality score $Q$, the probability of an incorrect base call is $p_{\\text{err}} = 10^{-Q/10}$.\n- Independence of base-call errors across positions within a read and across reads.\n- The likelihood principle for independent events: if multiple independent events must simultaneously be wrong to explain a contradiction, the combined probability is the product of their individual probabilities, and negative log-likelihoods are additive.\n\nFor each read $k$ spanning variants $i$ and $j$, define $p_{i}^{(k)}$ and $p_{j}^{(k)}$ as the error probabilities at the bases overlapping $i$ and $j$, respectively, obtained from the provided Phred scores. Model the probability that read $k$’s same-haplotype assertion for $(i,j)$ is wrong as the event that at least one of the two base calls in the read is wrong. For two independent base-call error events at $i$ and $j$, the probability of this union is $p_{i}^{(k)} + p_{j}^{(k)} - p_{i}^{(k)} p_{j}^{(k)}$. For an edge $(i,j)$ supported by multiple reads, define its cut penalty weight as the negative natural logarithm of the probability that all supporting reads are simultaneously misleading. Under independence, this equals the sum of the negative natural logarithms of the per-read misleading probabilities.\n\nThe Phred quality scores for the two reads spanning each edge are:\n- Edge $(A,B)$: read $1$ has $(Q_{A}, Q_{B}) = (30, 30)$; read $2$ has $(Q_{A}, Q_{B}) = (40, 35)$.\n- Edge $(B,C)$: read $1$ has $(Q_{B}, Q_{C}) = (30, 20)$; read $2$ has $(Q_{B}, Q_{C}) = (35, 25)$.\n- Edge $(C,D)$: read $1$ has $(Q_{C}, Q_{D}) = (25, 35)$; read $2$ has $(Q_{C}, Q_{D}) = (30, 40)$.\n\nCompute the minimum weighted cut value for this graph subject to the constraint that $A$ and $D$ lie on different haplotypes, and report the value of the minimum cut (the sum of weights of edges that cross the partition). Express the final cut weight as a dimensionless quantity and round your answer to four significant figures. Additionally, in your derivation, explain how the edge weights as defined above reflect base quality in the sequencing reads and why higher-quality evidence yields larger penalties for cutting.", "solution": "The problem asks for the minimum weighted cut for a graph representing four heterozygous variants, labeled $A$, $B$, $C$, and $D$. The graph consists of vertices $\\{A, B, C, D\\}$ and edges $(A,B)$, $(B,C)$, and $(C,D)$, forming a linear path. We are given the constraint that variant $A$ is on haplotype $H_1$ and variant $D$ is on haplotype $H_2$. A cut corresponds to a partition of the vertices into two sets, one for each haplotype, and its weight is the sum of the weights of all edges that connect a vertex in $H_1$ to a vertex in $H_2$. We seek the partition that minimizes this total weight.\n\nFirst, we must calculate the weight for each edge. The weight of an edge $(i, j)$, denoted $w(i,j)$, is defined as the negative natural logarithm of the probability that all supporting reads are simultaneously misleading. This is the sum of the negative log-likelihoods for each read.\nFor a single read $k$ spanning variants $i$ and $j$, with base call error probabilities $p_{i}^{(k)}$ and $p_{j}^{(k)}$, the probability that the read is misleading (i.e., at least one of the two base calls is incorrect) is given by:\n$$P_k(\\text{misleading}) = p_{i}^{(k)} + p_{j}^{(k)} - p_{i}^{(k)} p_{j}^{(k)}$$\nThe error probability $p$ is derived from the Phred quality score $Q$ using the formula $p = 10^{-Q/10}$.\nThe weight for an edge supported by $N$ reads is:\n$$w(i,j) = \\sum_{k=1}^{N} \\left[ -\\ln\\left( P_k(\\text{misleading}) \\right) \\right]$$\n\nNow, we calculate the weight for each of the three edges.\n\n1.  **Edge $(A,B)$**\n    - Read $1$: $(Q_A, Q_B) = (30, 30)$.\n      $p_A^{(1)} = 10^{-30/10} = 10^{-3}$.\n      $p_B^{(1)} = 10^{-30/10} = 10^{-3}$.\n      $P_1(\\text{misleading}) = 10^{-3} + 10^{-3} - (10^{-3})(10^{-3}) = 2 \\times 10^{-3} - 10^{-6} = 0.001999$.\n      The weight contribution is $w_1 = -\\ln(0.001999) \\approx 6.215108$.\n    - Read $2$: $(Q_A, Q_B) = (40, 35)$.\n      $p_A^{(2)} = 10^{-40/10} = 10^{-4}$.\n      $p_B^{(2)} = 10^{-35/10} = 10^{-3.5}$.\n      $P_2(\\text{misleading}) = 10^{-4} + 10^{-3.5} - (10^{-4})(10^{-3.5}) = 10^{-4} + 10^{-3.5} - 10^{-7.5} \\approx 0.000416196$.\n      The weight contribution is $w_2 = -\\ln(10^{-4} + 10^{-3.5} - 10^{-7.5}) \\approx 7.785233$.\n    - Total weight for edge $(A,B)$:\n      $$w(A,B) = w_1 + w_2 \\approx 6.215108 + 7.785233 = 14.000341$$\n\n2.  **Edge $(B,C)$**\n    - Read $1$: $(Q_B, Q_C) = (30, 20)$.\n      $p_B^{(1)} = 10^{-30/10} = 10^{-3}$.\n      $p_C^{(1)} = 10^{-20/10} = 10^{-2}$.\n      $P_1(\\text{misleading}) = 10^{-3} + 10^{-2} - (10^{-3})(10^{-2}) = 1.1 \\times 10^{-2} - 10^{-5} = 0.01099$.\n      The weight contribution is $w_1 = -\\ln(0.01099) \\approx 4.510858$.\n    - Read $2$: $(Q_B, Q_C) = (35, 25)$.\n      $p_B^{(2)} = 10^{-35/10} = 10^{-3.5}$.\n      $p_C^{(2)} = 10^{-25/10} = 10^{-2.5}$.\n      $P_2(\\text{misleading}) = 10^{-3.5} + 10^{-2.5} - (10^{-3.5})(10^{-2.5}) = 10^{-3.5} + 10^{-2.5} - 10^{-6} \\approx 0.003477505$.\n      The weight contribution is $w_2 = -\\ln(10^{-3.5} + 10^{-2.5} - 10^{-6}) \\approx 5.661642$.\n    - Total weight for edge $(B,C)$:\n      $$w(B,C) = w_1 + w_2 \\approx 4.510858 + 5.661642 = 10.172500$$\n\n3.  **Edge $(C,D)$**\n    - Read $1$: $(Q_C, Q_D) = (25, 35)$.\n      $p_C^{(1)} = 10^{-25/10} = 10^{-2.5}$.\n      $p_D^{(1)} = 10^{-35/10} = 10^{-3.5}$.\n      $P_1(\\text{misleading}) = 10^{-2.5} + 10^{-3.5} - (10^{-2.5})(10^{-3.5}) = 10^{-2.5} + 10^{-3.5} - 10^{-6} \\approx 0.003477505$.\n      The weight contribution is $w_1 = -\\ln(10^{-2.5} + 10^{-3.5} - 10^{-6}) \\approx 5.661642$.\n    - Read $2$: $(Q_C, Q_D) = (30, 40)$.\n      $p_C^{(2)} = 10^{-30/10} = 10^{-3}$.\n      $p_D^{(2)} = 10^{-40/10} = 10^{-4}$.\n      $P_2(\\text{misleading}) = 10^{-3} + 10^{-4} - (10^{-3})(10^{-4}) = 1.1 \\times 10^{-3} - 10^{-7} = 0.0010999$.\n      The weight contribution is $w_2 = -\\ln(0.0010999) \\approx 6.812403$.\n    - Total weight for edge $(C,D)$:\n      $$w(C,D) = w_1 + w_2 \\approx 5.661642 + 6.812403 = 12.474045$$\n\nThe problem is to partition the vertices $\\{A, B, C, D\\}$ into two sets, $H_1$ and $H_2$, such that $A \\in H_1$, $D \\in H_2$, and the sum of weights of edges connecting the two sets is minimized. The assignment of vertices $B$ and $C$ determines the partition. There are four possibilities:\n1.  $B \\in H_1$, $C \\in H_1$. The partition is $\\{A, B, C\\} | \\{D\\}$. The only cut edge is $(C,D)$. Total weight = $w(C,D) \\approx 12.47$.\n2.  $B \\in H_1$, $C \\in H_2$. The partition is $\\{A, B\\} | \\{C, D\\}$. The only cut edge is $(B,C)$. Total weight = $w(B,C) \\approx 10.17$.\n3.  $B \\in H_2$, $C \\in H_2$. The partition is $\\{A\\} | \\{B, C, D\\}$. The only cut edge is $(A,B)$. Total weight = $w(A,B) \\approx 14.00$.\n4.  $B \\in H_2$, $C \\in H_1$. The partition is $\\{A, C\\} | \\{B, D\\}$. The cut edges are $(A,B)$, $(B,C)$, and $(C,D)$. Total weight = $w(A,B) + w(B,C) + w(C,D) \\approx 14.00 + 10.17 + 12.47 = 36.64$.\n\nComparing the four total cut weights:\n$$ \\min(12.474045, 10.172500, 14.000341, 36.646886) = 10.172500 $$\nThe minimum weighted cut value is approximately $10.1725$. This corresponds to the partition where $A$ and $B$ are on haplotype $H_1$, and $C$ and $D$ are on haplotype $H_2$.\n\nThe edge weights directly reflect the base quality. Higher Phred quality scores $Q$ correspond to exponentially lower base-call error probabilities $p = 10^{-Q/10}$. The probability of a read being misleading, $P(\\text{misleading})$, is a function of these error probabilities. For high-quality reads, $p$ is very small, making $P(\\text{misleading})$ also very small. The edge weight is the negative natural logarithm of this probability, $w = -\\ln(P(\\text{misleading}))$. Since $-\\ln(x)$ is a monotonically decreasing function for $x0$, a smaller probability of error (higher quality evidence) results in a larger weight. Thus, a larger weight signifies stronger evidence that the two variants are on the same chromosome, and consequently, a larger penalty for cutting the edge, which represents contradicting that evidence.\n\nRounding the minimum cut value to four significant figures gives $10.17$.", "answer": "$$\\boxed{10.17}$$", "id": "4388626"}, {"introduction": "After a phasing algorithm predicts a set of haplotypes, a critical next step is to assess their accuracy. The most fundamental metric for this is the switch error, which identifies points where the predicted haplotype incorrectly swaps between the two true parental chromosomes. This exercise provides a direct, hands-on opportunity to calculate the switch error count and rate, a core skill for anyone validating or comparing phasing results [@problem_id:4388681].", "problem": "A clinical research team is validating haplotype phasing within a pharmacogenomic gene region spanning a $10$-Single Nucleotide Polymorphism (SNP) block. Each SNP is bi-allelic and heterozygous for the sample, and alleles are encoded as $0$ or $1$. Two haplotypes are defined at each position, corresponding to the two homologous chromosomes. The true haplotypes $H^{T}_{1}$ and $H^{T}_{2}$ for the block are known from a trio-based ground truth. An algorithm has predicted haplotypes $H^{P}_{1}$ and $H^{P}_{2}$ for the same block.\n\nUse the following data:\n- True haplotypes:\n$$H^{T}_{1} = (1, 0, 1, 1, 0, 0, 1, 0, 1, 0), \\quad H^{T}_{2} = (0, 1, 0, 0, 1, 1, 0, 1, 0, 1).$$\n- Predicted haplotypes:\n$$H^{P}_{1} = (1, 0, 0, 1, 1, 0, 1, 1, 0, 0), \\quad H^{P}_{2} = (0, 1, 1, 0, 0, 1, 0, 0, 1, 1).$$\n\nDefinitions to use:\n1. A haplotype phasing at SNP $i$ assigns the allele on each homologous chromosome; for bi-allelic heterozygous loci, $H^{T}_{1}[i] \\neq H^{T}_{2}[i]$ and $H^{P}_{1}[i] \\neq H^{P}_{2}[i]$ hold for all $i$.\n2. A switch error between adjacent SNPs $i$ and $i+1$ occurs if the mapping that aligns $H^{P}_{1}$ to one of $\\{H^{T}_{1}, H^{T}_{2}\\}$ at position $i$ differs from the mapping at position $i+1$. Formally, define a sequence $s_{i} \\in \\{+1,-1\\}$ by $s_{i} = +1$ if $H^{P}_{1}[i] = H^{T}_{1}[i]$ and $s_{i} = -1$ if $H^{P}_{1}[i] = H^{T}_{2}[i]$. A switch error is counted when $s_{i+1} \\neq s_{i}$.\n3. The switch error count is the total number of indices $i \\in \\{1,\\dots,9\\}$ for which $s_{i+1} \\neq s_{i}$ in this $10$-SNP block.\n4. The switch error rate is the switch error count divided by the number of adjacent heterozygous SNP pairs, which for $10$ heterozygous SNPs equals $9$. Express the rate as a decimal fraction.\n\nCompute the switch error count and the switch error rate for the predicted haplotypes relative to the true haplotypes. Round the switch error rate to $4$ significant figures. Express the final rate as a decimal fraction (do not use a percent sign). Provide the final answer as two values: first the integer switch error count and second the rounded switch error rate.", "solution": "The core of the problem is to determine the alignment sequence $s_i$ and then count the number of times this alignment \"switches\" between adjacent positions. The sequence $s_i$ tracks whether the predicted haplotype $H^{P}_{1}$ matches the true haplotype $H^{T}_{1}$ (which we can arbitrarily label as the \"correct\" phase) or if it matches $H^{T}_{2}$ (the \"switched\" phase).\n\nThe alignment sequence $s = (s_1, s_2, \\dots, s_{10})$ is constructed by comparing the predicted haplotype $H^{P}_{1}$ to the true haplotype $H^{T}_{1}$ at each SNP position $i$ from $1$ to $10$.\nGiven:\n$$H^{T}_{1} = (1, 0, 1, 1, 0, 0, 1, 0, 1, 0)$$\n$$H^{P}_{1} = (1, 0, 0, 1, 1, 0, 1, 1, 0, 0)$$\n\nBy definition, $s_{i} = +1$ if $H^{P}_{1}[i] = H^{T}_{1}[i]$, and $s_{i} = -1$ otherwise (since heterozygosity implies that if $H^{P}_{1}[i] \\neq H^{T}_{1}[i]$, then it must be that $H^{P}_{1}[i] = H^{T}_{2}[i]$).\n\nLet's compute $s_i$ for each position $i$:\n-   For $i=1$: $H^{P}_{1}[1] = 1$ and $H^{T}_{1}[1] = 1$. They are equal, so $s_1 = +1$.\n-   For $i=2$: $H^{P}_{1}[2] = 0$ and $H^{T}_{1}[2] = 0$. They are equal, so $s_2 = +1$.\n-   For $i=3$: $H^{P}_{1}[3] = 0$ and $H^{T}_{1}[3] = 1$. They are not equal, so $s_3 = -1$.\n-   For $i=4$: $H^{P}_{1}[4] = 1$ and $H^{T}_{1}[4] = 1$. They are equal, so $s_4 = +1$.\n-   For $i=5$: $H^{P}_{1}[5] = 1$ and $H^{T}_{1}[5] = 0$. They are not equal, so $s_5 = -1$.\n-   For $i=6$: $H^{P}_{1}[6] = 0$ and $H^{T}_{1}[6] = 0$. They are equal, so $s_6 = +1$.\n-   For $i=7$: $H^{P}_{1}[7] = 1$ and $H^{T}_{1}[7] = 1$. They are equal, so $s_7 = +1$.\n-   For $i=8$: $H^{P}_{1}[8] = 1$ and $H^{T}_{1}[8] = 0$. They are not equal, so $s_8 = -1$.\n-   For $i=9$: $H^{P}_{1}[9] = 0$ and $H^{T}_{1}[9] = 1$. They are not equal, so $s_9 = -1$.\n-   For $i=10$: $H^{P}_{1}[10] = 0$ and $H^{T}_{1}[10] = 0$. They are equal, so $s_{10} = +1$.\n\nThe complete alignment sequence is $s = (+1, +1, -1, +1, -1, +1, +1, -1, -1, +1)$.\n\nNext, we calculate the switch error count. A switch error occurs at index $i$ if $s_{i+1} \\neq s_i$. We check this for $i=1, \\dots, 9$.\n-   $i=1$: $s_2 = +1$, $s_1 = +1$. $s_2 = s_1$. No switch.\n-   $i=2$: $s_3 = -1$, $s_2 = +1$. $s_3 \\neq s_2$. **Switch 1**.\n-   $i=3$: $s_4 = +1$, $s_3 = -1$. $s_4 \\neq s_3$. **Switch 2**.\n-   $i=4$: $s_5 = -1$, $s_4 = +1$. $s_5 \\neq s_4$. **Switch 3**.\n-   $i=5$: $s_6 = +1$, $s_5 = -1$. $s_6 \\neq s_5$. **Switch 4**.\n-   $i=6$: $s_7 = +1$, $s_6 = +1$. $s_7 = s_6$. No switch.\n-   $i=7$: $s_8 = -1$, $s_7 = +1$. $s_8 \\neq s_7$. **Switch 5**.\n-   $i=8$: $s_9 = -1$, $s_8 = -1$. $s_9 = s_8$. No switch.\n-   $i=9$: $s_{10} = +1$, $s_9 = -1$. $s_{10} \\neq s_9$. **Switch 6**.\n\nBy summing these occurrences, the total switch error count is $6$.\n\nFinally, we compute the switch error rate. It is the switch error count divided by the number of opportunities for a switch, which is the number of adjacent SNP pairs. For a block of $10$ SNPs, there are $10-1 = 9$ adjacent pairs.\n$$ \\text{Switch Error Rate} = \\frac{\\text{Switch Error Count}}{\\text{Number of adjacent pairs}} = \\frac{6}{9} $$\nSimplifying the fraction gives:\n$$ \\frac{6}{9} = \\frac{2}{3} $$\nAs a decimal, this is $0.6666\\overline{6}$. The problem requires this to be rounded to $4$ significant figures.\n$$ 0.6666\\overline{6} \\approx 0.6667 $$\n\nThe two required values are the switch error count ($6$) and the switch error rate ($0.6667$).", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n6  0.6667\n\\end{pmatrix}\n}\n$$", "id": "4388681"}, {"introduction": "Beyond local accuracy, the quality of a phasing result is also judged by its contiguity—the length of the chromosomal segments that are successfully phased into continuous blocks. The N50 phase block length is a standard statistic used to quantify this contiguity, providing a single number that summarizes the scale of the phasing assembly. In this practice, you will learn to compute and interpret the N50 statistic, a key metric for evaluating the completeness of a haplotype map [@problem_id:4388662].", "problem": "In haplotype phasing for clinical genomics, contiguous segments of the genome in which heterozygous variants are assigned to the same parental chromosome are termed phase blocks. Consider a dataset from a targeted precision medicine panel in which read-backed phasing produced a finite set of phase blocks with measured lengths. A robust way to summarize the typical block scale is the statistic known as the N50 phase block length. Starting from the core definition that phase blocks partition the phased portion of the genome into contiguous intervals with positive lengths, and that a summary statistic should reflect the contribution of longer blocks to the total phased span, provide a formal mathematical definition of the N50 phase block length in terms of the multiset of block lengths. Then, compute the N50 phase block length for the set of phase block lengths $\\{100\\,\\mathrm{kb}, 250\\,\\mathrm{kb}, 1.2\\,\\mathrm{Mb}, 80\\,\\mathrm{kb}\\}$ obtained from an individual’s phasing. Express the final N50 in kilobases. No rounding is required. Do not include units in your final numerical answer box.", "solution": "Phase blocks arising from haplotype phasing are contiguous genomic intervals with positive lengths. Let the multiset of block lengths be denoted by $\\{l_{1}, l_{2}, \\dots, l_{n}\\}$ with each $l_{i}  0$. To define a statistic that captures the typical block size while weighting blocks by their contribution to the total phased span, we sort the lengths in nonincreasing order, yielding a sequence $l_{(1)} \\geq l_{(2)} \\geq \\dots \\geq l_{(n)}$. Let the total phased span be $L_{\\mathrm{tot}} = \\sum_{i=1}^{n} l_{(i)}$. The N50 phase block length is then defined as the smallest length in this sorted sequence such that the cumulative sum from the largest down reaches at least half of the total. Formally,\n$$\n\\mathrm{N50} = \\min \\left\\{ l_{(k)} \\;:\\; \\sum_{i=1}^{k} l_{(i)} \\geq \\frac{1}{2} \\sum_{i=1}^{n} l_{(i)} \\right\\}.\n$$\n\nWe now compute this quantity for the given set $\\{100\\,\\mathrm{kb}, 250\\,\\mathrm{kb}, 1.2\\,\\mathrm{Mb}, 80\\,\\mathrm{kb}\\}$. First, convert all lengths to the same unit, kilobases (kb). Using $1\\,\\mathrm{Mb} = 1000\\,\\mathrm{kb}$, the set in kilobases is\n$$\n\\{100\\,\\mathrm{kb}, 250\\,\\mathrm{kb}, 1200\\,\\mathrm{kb}, 80\\,\\mathrm{kb}\\}.\n$$\nSort in nonincreasing order:\n$$\nl_{(1)} = 1200\\,\\mathrm{kb}, \\quad l_{(2)} = 250\\,\\mathrm{kb}, \\quad l_{(3)} = 100\\,\\mathrm{kb}, \\quad l_{(4)} = 80\\,\\mathrm{kb}.\n$$\nCompute the total phased span:\n$$\nL_{\\mathrm{tot}} = 1200 + 250 + 100 + 80 = 1630\\,\\mathrm{kb}.\n$$\nCompute half of the total:\n$$\n\\frac{1}{2} L_{\\mathrm{tot}} = \\frac{1}{2} \\times 1630 = 815\\,\\mathrm{kb}.\n$$\nCompute cumulative sums in the sorted order:\n- After the first block: $S_{1} = 1200\\,\\mathrm{kb}$.\n- After the second block: $S_{2} = 1200 + 250 = 1450\\,\\mathrm{kb}$.\n- After the third block: $S_{3} = 1450 + 100 = 1550\\,\\mathrm{kb}$.\n- After the fourth block: $S_{4} = 1550 + 80 = 1630\\,\\mathrm{kb}$.\n\nThe smallest $k$ for which $S_{k} \\geq 815\\,\\mathrm{kb}$ is $k=1$, since $S_{1} = 1200\\,\\mathrm{kb} \\geq 815\\,\\mathrm{kb}$. Therefore,\n$$\n\\mathrm{N50} = l_{(1)} = 1200\\,\\mathrm{kb}.\n$$\nExpressed in kilobases, the N50 phase block length is $1200$.", "answer": "$$\\boxed{1200}$$", "id": "4388662"}]}