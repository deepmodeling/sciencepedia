{"hands_on_practices": [{"introduction": "A central challenge in cancer genomics is to connect the detailed picture of intra-tumor heterogeneity (ITH) revealed by single-cell sequencing with the vast amount of existing bulk sequencing data. The Variant Allele Fraction (VAF) from a bulk sample represents the average signal across millions of cells. This exercise guides you through deriving the fundamental mathematical model that links the bulk VAF to its underlying single-cell clonal architecture, accounting for tumor purity and clone-specific copy number states. Mastering this derivation provides a critical foundation for deconvolving bulk data and for quantitatively understanding how ITH shapes the genomic landscape of a tumor [@problem_id:4381111].", "problem": "Consider a bulk deoxyribonucleic acid (DNA) mixture prepared from a tissue containing tumor and normal cells. Let the tumor purity be $p \\in (0,1)$, meaning the fraction $p$ of cells in the bulk are tumor and the fraction $1-p$ are normal. Within the tumor compartment, assume there are $k$ single-cell–defined clones indexed by $i \\in \\{1,\\dots,k\\}$, with clone frequency $q_i$ such that $\\sum_{i=1}^{k} q_i = 1$ and $q_i \\ge 0$ for all $i$. At a specific genomic locus, each tumor clone $i$ has total copy number $C_i \\in \\mathbb{N}$ and carries $M_i \\in \\{0,1,\\dots,C_i\\}$ mutant copies of a somatic variant. The normal compartment has total copy number $C_{\\mathrm{N}} \\in \\mathbb{N}$ and $M_{\\mathrm{N}} \\in \\{0,1,\\dots,C_{\\mathrm{N}}\\}$ mutant copies at the same locus. Assume unbiased library preparation and sequencing such that each allele copy in the mixture has an equal probability of generating a read, and that read sampling is independent and identically distributed. Define the Variant Allele Fraction (VAF) as the limit, as the total number of sequencing reads $N \\to \\infty$, of the fraction of reads reporting the mutant allele at the locus.\n\nStarting from the definition of VAF and basic mixture principles, derive a closed-form analytic expression for the expected bulk VAF at this locus as a function of $p$, $\\{q_i\\}_{i=1}^{k}$, $\\{C_i\\}_{i=1}^{k}$, $\\{M_i\\}_{i=1}^{k}$, $C_{\\mathrm{N}}$, and $M_{\\mathrm{N}}$, under the stated assumptions. Express your final answer as a single simplified expression. No numerical evaluation or rounding is required.", "solution": "The problem requires the derivation of a closed-form analytic expression for the expected bulk Variant Allele Fraction (VAF). The problem defines the VAF as the limit, as the total number of sequencing reads $N \\to \\infty$, of the fraction of reads reporting the mutant allele. Given the assumption that each allele copy in the mixture has an equal probability of generating a read, this VAF is equivalent to the true proportion of mutant alleles in the total pool of alleles contributed by all cells in the mixture.\n\nWe can express the VAF as a ratio:\n$$\n\\text{VAF} = \\frac{\\text{Expected number of mutant allele copies in the pool}}{\\text{Expected total number of allele copies in the pool}}\n$$\nThe \"pool\" refers to the entire collection of alleles from the bulk tissue sample. The expected numbers can be calculated by considering the average contribution from each cell subpopulation, weighted by its prevalence.\n\nLet us define the subpopulations and their properties based on the givens:\n- Normal cells: constitute a fraction $1-p$ of the total cell population. Each normal cell has $C_{\\mathrm{N}}$ total copies and $M_{\\mathrm{N}}$ mutant copies of the allele at the locus.\n- Tumor cells: constitute a fraction $p$ of the total cell population. This compartment is heterogeneous and consists of $k$ distinct clones.\n- Tumor clone $i$: constitutes a fraction $q_i$ of the tumor cell population. Therefore, its fraction in the total bulk population is $p q_i$. Each cell of clone $i$ has $C_i$ total copies and $M_i$ mutant copies of the allele.\n\nFirst, we calculate the numerator: the expected number of mutant alleles. This is the sum of the mutant alleles contributed by the normal and all tumor cell subpopulations, weighted by their respective-cell fractions and copy numbers. More precisely, we are calculating the average number of mutant alleles per cell, which, when scaled by the total number of cells, gives a quantity proportional to the total number of mutant alleles.\nThe contribution from the normal cell compartment is proportional to its cell fraction, $1-p$, multiplied by the number of mutant alleles per normal cell, $M_{\\mathrm{N}}$. This term is $(1-p) M_{\\mathrm{N}}$.\nThe contribution from the tumor compartment is the sum of contributions from each of the $k$ clones. For clone $i$, its cell fraction in the bulk is $p q_i$, and it carries $M_i$ mutant alleles. The contribution from clone $i$ is $p q_i M_i$. Summing over all clones gives the total tumor contribution: $\\sum_{i=1}^{k} p q_i M_i = p \\sum_{i=1}^{k} q_i M_i$.\nThe total average number of mutant alleles per cell in the bulk is the sum of these contributions:\n$$\n\\text{Average Mutant Alleles per Cell} = (1-p) M_{\\mathrm{N}} + p \\sum_{i=1}^{k} q_i M_i\n$$\n\nNext, we calculate the denominator: the expected total number of alleles at the locus. This is the normalization factor, representing the size of the entire allele pool. The logic is identical to the calculation for the numerator, but we use the total copy numbers ($C_{\\mathrm{N}}$ and $C_i$) instead of the mutant copy numbers.\nThe contribution from the normal cell compartment to the total allele pool is proportional to its cell-fraction-weighted copy number: $(1-p) C_{\\mathrm{N}}$.\nThe contribution from the tumor compartment is the sum of contributions from each clone: $\\sum_{i=1}^{k} p q_i C_i = p \\sum_{i=1}^{k} q_i C_i$.\nThe total average number of alleles per cell in the bulk is the sum of these contributions:\n$$\n\\text{Average Total Alleles per Cell} = (1-p) C_{\\mathrm{N}} + p \\sum_{i=1}^{k} q_i C_i\n$$\n\nThe VAF is the ratio of the average number of mutant alleles to the average number of total alleles. This ratio represents the proportion of mutant alleles in the total DNA pool.\n$$\n\\text{VAF} = \\frac{(1-p) M_{\\mathrm{N}} + p \\sum_{i=1}^{k} q_i M_i}{(1-p) C_{\\mathrm{N}} + p \\sum_{i=1}^{k} q_i C_i}\n$$\nThis is the final, closed-form analytic expression for the expected bulk VAF. It is a function of the tumor purity $p$, the normal cell copy numbers $C_{\\mathrm{N}}$ and $M_{\\mathrm{N}}$, and the set of tumor clone frequencies $\\{q_i\\}_{i=1}^{k}$ and copy numbers $\\{C_i\\}_{i=1}^{k}$ and $\\{M_i\\}_{i=1}^{k}$.", "answer": "$$\n\\boxed{\\frac{(1-p) M_{\\mathrm{N}} + p \\sum_{i=1}^{k} q_i M_i}{(1-p) C_{\\mathrm{N}} + p \\sum_{i=1}^{k} q_i C_i}}\n$$", "id": "4381111"}, {"introduction": "Reconstructing the evolutionary history of a tumor is a primary goal of scDNA-seq. The Infinite Sites Model (ISM) provides a powerful, simplified framework for this task, giving rise to the perfect phylogeny constraint. However, real-world single-cell data is imperfect and contains technical artifacts. This practice provides a hands-on opportunity to apply the four-gamete test, a direct consequence of the ISM, to a realistic genotype matrix to identify violations of perfect phylogeny. More importantly, it challenges you to reason about the likely sources of these violations, learning to distinguish between true evolutionary complexity and common technical errors such as Allelic Dropout (ADO) and doublets [@problem_id:4381080].", "problem": "Consider a binary genotype matrix from Single-Cell Deoxyribonucleic Acid (DNA) sequencing assaying four Single-Nucleotide Variants (SNVs) $(s_1,s_2,s_3,s_4)$ across nine cells $(c_1,\\dots,c_9)$. Each cell’s genotype vector $\\mathbf{g}(c_i)$ lists the presence $(1)$ or absence $(0)$ of each SNV in the fixed order $(s_1,s_2,s_3,s_4)$. The observed genotypes are:\n$\\mathbf{g}(c_1)=(0,0,0,0)$,\n$\\mathbf{g}(c_2)=(1,0,0,0)$,\n$\\mathbf{g}(c_3)=(1,1,0,0)$,\n$\\mathbf{g}(c_4)=(1,0,1,0)$,\n$\\mathbf{g}(c_5)=(1,1,0,1)$,\n$\\mathbf{g}(c_6)=(1,0,0,1)$,\n$\\mathbf{g}(c_7)=(0,0,0,1)$,\n$\\mathbf{g}(c_8)=(1,1,1,0)$,\n$\\mathbf{g}(c_9)=(0,1,0,0)$.\n\nAssume the Infinite Sites Model (ISM), which states each SNV arises at most once in the tumor phylogeny and never reverts. Under the ISM, the perfect phylogeny constraint implies that for any pair of SNVs $(s_i,s_j)$, the distribution of two-locus haplotypes across cells cannot contain all four combinations $(00,01,10,11)$; this is commonly tested by the four-gamete test.\n\nSingle-cell assays are subject to errors including Allelic Dropout (ADO; false negatives turning $1 \\to 0$), False Positives (FP; false positives turning $0 \\to 1$), and doublets (two cells captured together producing an elementwise logical OR of their true genotypes). Copy Number Variation (CNV) can also perturb genotypes but is not directly modeled here.\n\nTasks:\n- Starting from the ISM and the definition of the four-gamete test, determine the number $V$ of SNV pairs among the $\\binom{4}{2}=6$ possible pairs whose observed two-locus haplotype distributions across $(c_1,\\dots,c_9)$ contain all four gametes $(00,01,10,11)$, thereby violating perfect phylogeny.\n- In your derivation, identify any cell whose genotype is exactly the elementwise logical OR of two other cells’ genotypes and explain how such a configuration can introduce an $(11)$ haplotype for an otherwise incompatible pair, consistent with a doublet. Also, use first-principles reasoning to discuss whether the remaining violations are more parsimoniously explained by Allelic Dropout (ADO), False Positives (FP), or Copy Number Variation (CNV).\n\nReport the exact integer value of $V$ with no rounding and no units.", "solution": "We begin from the Infinite Sites Model (ISM), which posits that each Single-Nucleotide Variant (SNV) occurs at most once without back-mutation. Under the ISM, a perfect phylogeny exists if and only if, for every pair of binary characters (here, SNVs), the observed two-locus haplotypes across sampled cells do not contain all four combinations $(00,01,10,11)$. This is formalized by the four-gamete test: the presence of all four gametes for any pair indicates a violation of perfect phylogeny consistency with the ISM.\n\nWe have four SNVs $(s_1,s_2,s_3,s_4)$ and nine cells $(c_1,\\dots,c_9)$ with genotypes:\n$\\mathbf{g}(c_1)=(0,0,0,0)$,\n$\\mathbf{g}(c_2)=(1,0,0,0)$,\n$\\mathbf{g}(c_3)=(1,1,0,0)$,\n$\\mathbf{g}(c_4)=(1,0,1,0)$,\n$\\mathbf{g}(c_5)=(1,1,0,1)$,\n$\\mathbf{g}(c_6)=(1,0,0,1)$,\n$\\mathbf{g}(c_7)=(0,0,0,1)$,\n$\\mathbf{g}(c_8)=(1,1,1,0)$,\n$\\mathbf{g}(c_9)=(0,1,0,0)$.\n\nWe examine each of the $\\binom{4}{2}=6$ SNV pairs and compile the set of observed two-locus haplotypes across the nine cells. A pair violates perfect phylogeny if and only if the set includes all four gametes $(00,01,10,11)$.\n\nCompute gametes for each pair:\n\n1. Pair $(s_1,s_2)$: extract $(s_1,s_2)$ from each cell.\n- $c_1:(0,0)$,\n- $c_2:(1,0)$,\n- $c_3:(1,1)$,\n- $c_4:(1,0)$,\n- $c_5:(1,1)$,\n- $c_6:(1,0)$,\n- $c_7:(0,0)$,\n- $c_8:(1,1)$,\n- $c_9:(0,1)$.\nObserved set is $\\{(0,0),(1,0),(1,1),(0,1)\\}$, i.e., all four gametes. Thus $(s_1,s_2)$ violates the four-gamete test.\n\n2. Pair $(s_1,s_3)$:\n- $c_1:(0,0)$,\n- $c_2:(1,0)$,\n- $c_3:(1,0)$,\n- $c_4:(1,1)$,\n- $c_5:(1,0)$,\n- $c_6:(1,0)$,\n- $c_7:(0,0)$,\n- $c_8:(1,1)$,\n- $c_9:(0,0)$.\nObserved set is $\\{(0,0),(1,0),(1,1)\\}$. The gamete $(0,1)$ is absent. This pair is compatible and does not violate perfect phylogeny.\n\n3. Pair $(s_1,s_4)$:\n- $c_1:(0,0)$,\n- $c_2:(1,0)$,\n- $c_3:(1,0)$,\n- $c_4:(1,0)$,\n- $c_5:(1,1)$,\n- $c_6:(1,1)$,\n- $c_7:(0,1)$,\n- $c_8:(1,0)$,\n- $c_9:(0,0)$.\nObserved set is $\\{(0,0),(1,0),(1,1),(0,1)\\}$, i.e., all four gametes. Thus $(s_1,s_4)$ violates the four-gamete test.\n\n4. Pair $(s_2,s_3)$:\n- $c_1:(0,0)$,\n- $c_2:(0,0)$,\n- $c_3:(1,0)$,\n- $c_4:(0,1)$,\n- $c_5:(1,0)$,\n- $c_6:(0,0)$,\n- $c_7:(0,0)$,\n- $c_8:(1,1)$,\n- $c_9:(1,0)$.\nObserved set is $\\{(0,0),(1,0),(0,1),(1,1)\\}$, i.e., all four gametes. Thus $(s_2,s_3)$ violates the four-gamete test.\n\n5. Pair $(s_2,s_4)$:\n- $c_1:(0,0)$,\n- $c_2:(0,0)$,\n- $c_3:(1,0)$,\n- $c_4:(0,0)$,\n- $c_5:(1,1)$,\n- $c_6:(0,1)$,\n- $c_7:(0,1)$,\n- $c_8:(1,0)$,\n- $c_9:(1,0)$.\nObserved set is $\\{(0,0),(1,0),(0,1),(1,1)\\}$, i.e., all four gametes. Thus $(s_2,s_4)$ violates the four-gamete test.\n\n6. Pair $(s_3,s_4)$:\n- $c_1:(0,0)$,\n- $c_2:(0,0)$,\n- $c_3:(0,0)$,\n- $c_4:(1,0)$,\n- $c_5:(0,1)$,\n- $c_6:(0,1)$,\n- $c_7:(0,1)$,\n- $c_8:(1,0)$,\n- $c_9:(0,0)$.\nObserved set is $\\{(0,0),(1,0),(0,1)\\}$. The gamete $(1,1)$ is absent. This pair is compatible and does not violate perfect phylogeny.\n\nCounting violations, the pairs $(s_1,s_2)$, $(s_1,s_4)$, $(s_2,s_3)$, and $(s_2,s_4)$ violate the four-gamete test. Therefore, the number of violating pairs is\n$$\nV=4.\n$$\n\nDiagnosis of likely sources of violations:\n- Doublet identification via logical OR: A doublet, under elementwise logical OR, can introduce the $(1,1)$ gamete for a pair that otherwise would not exhibit it under a perfect phylogeny. Inspect $\\mathbf{g}(c_8)=(1,1,1,0)$. Note that\n$$\n\\mathbf{g}(c_8)=\\mathbf{g}(c_3)\\,\\text{OR}\\,\\mathbf{g}(c_4)=(1,1,0,0)\\,\\text{OR}\\,(1,0,1,0)=(1,1,1,0),\n$$\nexactly. This is parsimoniously explained by a doublet comprising one cell from the $(s_2)$ branch and one from the $(s_3)$ branch. Its presence introduces the $(1,1)$ haplotype for $(s_2,s_3)$, contributing directly to the four-gamete violation observed for $(s_2,s_3)$.\n- Allelic Dropout (ADO; false negatives $1 \\to 0$): Cells $\\mathbf{g}(c_9)=(0,1,0,0)$ and $\\mathbf{g}(c_6)=(1,0,0,1)$ can be parsimoniously attributed to dropout events relative to nearby genotypes with additional $1$s. For instance, $\\mathbf{g}(c_9)$ is consistent with dropping $s_1$ in $\\mathbf{g}(c_3)$, yielding the $(0,1)$ gamete for $(s_1,s_2)$ and completing the four-gamete set for that pair. Similarly, $\\mathbf{g}(c_6)$ is consistent with dropping $s_2$ from $\\mathbf{g}(c_5)$, yielding the $(0,1)$ haplotype for $(s_2,s_4)$.\n- False Positives (FP; $0 \\to 1$): $\\mathbf{g}(c_7)=(0,0,0,1)$ is plausibly explained by a false positive at $s_4$ on an otherwise ancestral background, providing the $(0,1)$ gamete for $(s_1,s_4)$ and helping complete the four-gamete set for that pair.\n- Copy Number Variation (CNV): While CNV can generate complex genotype patterns, the specific signatures here (exact logical OR equalities and isolated single-locus gains or losses) are more parsimoniously attributable to doublets (for $\\mathbf{g}(c_8)$) and single-locus ADO/FP (for $\\mathbf{g}(c_6)$, $\\mathbf{g}(c_7)$, and $\\mathbf{g}(c_9)$), without requiring CNV-induced multi-locus changes.\n\nIn summary, applying the four-gamete test yields $V=4$ violating pairs, with at least one violation strongly attributable to a doublet (via $\\mathbf{g}(c_8)$) and others consistent with Allelic Dropout and False Positives.", "answer": "$$\\boxed{4}$$", "id": "4381080"}, {"introduction": "The success of an scDNA-seq experiment often hinges on its ability to detect rare, but potentially significant, subclones. Before committing substantial resources, a researcher must determine the required experimental scale. This practice simulates this critical design step by tasking you with a power calculation. Starting from first principles, you will derive the minimum number of cells that must be sequenced to detect a subclone of a given frequency with high probability, while incorporating the real-world, confounding effects of cell doublet formation and imperfect assay sensitivity. This exercise is essential for developing the quantitative skills needed to design robust and efficient single-cell experiments [@problem_id:4381140].", "problem": "You are designing a single-cell deoxyribonucleic acid sequencing (scDNA-seq) experiment to detect an intra-tumor subclone present at frequency $f$ among tumor cells. Cells are captured into libraries in droplets that yield either singlets with probability $1 - d$ or doublets with probability $d$, where $d$ is the doublet rate. A subclone cell, if present in a capture, is correctly genotyped with assay sensitivity $s$ (that is, the probability of correctly calling the subclone in that capture is $s$ for each subclone cell). Assume independent, identically distributed captures and that cells are sampled uniformly at random from the tumor cell population, with negligible non-tumor contamination.\n\nStarting only from the definition of Bernoulli trials, the binomial model for independent trials, and the rule that the probability of at least one success in $n$ trials equals one minus the probability of zero successes, derive the minimal number of captured single-cell libraries $n$ such that the probability of detecting the subclone at least once is strictly greater than $0.99$. Use the following scientifically realistic parameters: $f = 0.005$, $d = 0.20$, and $s = 0.90$. Report your result as the minimal integer $n$ that satisfies the condition. No units are required.", "solution": "The problem asks for the minimum number of captured libraries, $n$, needed to detect a subclone at least once with a probability greater than 0.99. Let $E$ be the event of detecting the subclone at least once in $n$ captures. We want to find the minimal integer $n$ such that $P(E) > 0.99$.\n\nThe captures are independent trials, so we can use the complement rule:\n$$P(E) = 1 - P(\\text{no detection in } n \\text{ captures})$$\nLet $p_{\\text{fail}}$ be the probability of failing to detect the subclone in a single library capture. The probability of failing in all $n$ independent captures is $(p_{\\text{fail}})^n$. Thus,\n$$P(E) = 1 - (p_{\\text{fail}})^n$$\nThe condition is $1 - (p_{\\text{fail}})^n > 0.99$, which simplifies to $(p_{\\text{fail}})^n  0.01$.\nTaking the natural logarithm of both sides gives $n \\ln(p_{\\text{fail}})  \\ln(0.01)$. Since $p_{\\text{fail}}  1$, its logarithm is negative. Dividing by $\\ln(p_{\\text{fail}})$ reverses the inequality:\n$$n > \\frac{\\ln(0.01)}{\\ln(p_{\\text{fail}})}$$\n\nNext, we must calculate $p_{\\text{fail}}$. A single library capture can be a singlet (with probability $1-d$) or a doublet (with probability $d$). Using the law of total probability:\n$$p_{\\text{fail}} = P(\\text{fail}|\\text{singlet})P(\\text{singlet}) + P(\\text{fail}|\\text{doublet})P(\\text{doublet})$$\n$$p_{\\text{fail}} = P(\\text{fail}|\\text{singlet})(1 - d) + P(\\text{fail}|\\text{doublet})d$$\n\nFirst, we determine the probability of failing to get a detection from a single randomly sampled cell. A detection occurs if the cell is from the subclone (probability $f$) AND the assay is successful (probability $s$). The probability of detection from one cell is $f \\times s$. Therefore, the probability of *no detection* from one cell is $1 - fs$.\n\nNow we calculate the conditional probabilities:\n1.  **Failure in a singlet**: A singlet contains one cell. The library fails if this single cell does not yield a detection.\n    $$P(\\text{fail}|\\text{singlet}) = 1 - fs$$\n2.  **Failure in a doublet**: A doublet contains two independently sampled cells. The library fails only if *both* cells fail to yield a detection.\n    $$P(\\text{fail}|\\text{doublet}) = (1 - fs) \\times (1 - fs) = (1 - fs)^2$$\n\nSubstituting these back into the expression for $p_{\\text{fail}}$:\n$$p_{\\text{fail}} = (1 - fs)(1 - d) + (1 - fs)^2 d$$\nWe can factor out $(1-fs)$:\n$$p_{\\text{fail}} = (1 - fs)[(1-d) + d(1-fs)] = (1 - fs)[1 - d + d - dfs] = (1 - fs)(1 - dfs)$$\n\nNow, we plug in the given parameter values: $f = 0.005$, $d = 0.20$, and $s = 0.90$.\n- The probability of detection from one subclone cell is $fs = 0.005 \\times 0.90 = 0.0045$.\n- The term $dfs = 0.20 \\times 0.0045 = 0.0009$.\n- The overall probability of failure in a single capture is:\n$$p_{\\text{fail}} = (1 - 0.0045)(1 - 0.0009) = (0.9955)(0.9991) = 0.99460445$$\n\nFinally, we solve for $n$:\n$$n > \\frac{\\ln(0.01)}{\\ln(0.99460445)} \\approx \\frac{-4.605170}{-0.00540966} \\approx 851.285$$\nSince $n$ must be an integer and must be strictly greater than 851.285, the minimal number of libraries required is 852.", "answer": "$$\\boxed{852}$$", "id": "4381140"}]}