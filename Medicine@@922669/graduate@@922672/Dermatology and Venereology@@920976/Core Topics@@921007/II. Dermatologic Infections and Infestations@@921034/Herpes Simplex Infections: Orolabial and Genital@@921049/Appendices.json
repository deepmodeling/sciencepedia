{"hands_on_practices": [{"introduction": "The initial and most crucial step in diagnosing genital ulcer disease is a meticulous clinical evaluation. This exercise [@problem_id:4491681] hones your ability to perform targeted history-taking and apply fundamental clinical knowledge to distinguish between the classic presentations of Herpes Simplex Virus and primary syphilis, which is the bedrock of effective venereology practice. By carefully correlating the patient's narrative with the physical examination, you can construct a prioritized differential diagnosis and formulate an efficient diagnostic strategy.", "problem": "A 28-year-old cisgender man presents with a solitary genital ulcer on the mid-shaft of the penis that has been present for 7 days. He describes the lesion as painless and denies dysuria, fever, or malaise. On inspection, the lesion is approximately 1 cm in diameter, with a clean base and an indurated border; there are non-tender, slightly enlarged inguinal lymph nodes. He reports a new sexual partner 3 weeks ago with vaginal and oral intercourse and inconsistent condom use. He has no prior diagnosis of Herpes Simplex Virus (HSV) infection and does not recall any grouped vesicles preceding the ulcer. He is unsure of his Human Immunodeficiency Virus (HIV) status. You are tasked with using sexual history-taking to prioritize the most likely etiology between syphilis and HSV and to outline next diagnostic steps based on the answers.\n\nFundamental base for reasoning:\n- Primary syphilis (caused by Treponema pallidum) commonly presents with a single, indurated, painless ulcer (chancre) and non-tender regional lymphadenopathy, with an incubation period typically around 21 days and ranging from approximately 10 to 90 days.\n- Genital HSV typically presents with grouped vesicles that evolve into multiple shallow, painful erosions or ulcers, often accompanied by tender lymphadenopathy and systemic prodromal symptoms; incubation is typically around 4 days and ranges from approximately 2 to 12 days.\n- Principles of sexual history-taking emphasize an open-ended start, nonjudgmental clarification of timeline and exposures, and systematic coverage of partners, practices, protection, past sexually transmitted infections (STIs), and pregnancy intentions, then tailored risk assessment and testing.\n- Diagnostic evaluation of suspected primary syphilis includes non-treponemal testing (e.g., Rapid Plasma Reagin, Venereal Disease Research Laboratory), treponemal testing (e.g., Treponema pallidum particle agglutination, enzyme immunoassay), and, when available, direct detection from the lesion by darkfield microscopy or nucleic acid amplification. Early primary syphilis may yield initially nonreactive serology; repeat testing in approximately 2 weeks is appropriate when suspicion is high. HSV diagnosis from a lesion favors polymerase chain reaction of a lesion swab; type-specific serology is of limited utility in acute diagnosis.\n\nWhich of the following option best applies a stepwise, evidence-based sexual history-taking sequence to prioritize syphilis over HSV in this patient and correctly outlines the next diagnostic steps contingent on the history and examination?\n\nA. Begin with an open-ended invitation to narrate recent sexual activity, then anchor the lesion onset to specific encounters to estimate incubation, followed by clarifying pain, number of partners, types of sex (oral, vaginal, anal), condom use, partner symptoms, prior STIs and treatments, and HIV status. Correlate a solitary, indurated, painless ulcer and non-tender lymph nodes with primary syphilis given exposure about 3 weeks earlier. Order both non-treponemal (e.g., RPR or VDRL) and treponemal (e.g., TPPA or EIA) tests and attempt direct detection from the ulcer with darkfield microscopy or polymerase chain reaction if available; if serology is nonreactive but suspicion remains high, repeat in about 2 weeks. Concurrently screen for HIV and other STIs (e.g., Neisseria gonorrhoeae, Chlamydia trachomatis), and consider partner notification; reserve HSV lesion polymerase chain reaction for cases with vesicles or pronounced pain.\n\nB. Start by asking, “Is your ulcer from herpes?”, confirm that it is painless, assume syphilis, and treat immediately with benzathine penicillin without any testing; skip broader sexual history and defer HIV testing.\n\nC. Prioritize questions about a history of orolabial “cold sores” and stress triggers; order type-specific HSV serology immediately and, if Immunoglobulin G is positive, diagnose genital herpes. Do not order syphilis serology because a painless ulcer is unlikely to be syphilis and syphilis serology only becomes positive late.\n\nD. Focus on travel and oral sex exposures; order only a rapid plasma reagin test, and if it is negative, exclude syphilis, diagnose chancroid on the basis of pain absence, and treat with azithromycin. Do not repeat testing or perform treponemal assays.\n\nE. Use the “five Ps” (Partners, Practices, Protection, Past STIs, Pregnancy plans), ask about lesion chronology, pain, and lymphadenopathy, then order HSV polymerase chain reaction from the ulcer and type-specific HSV serology alongside a treponemal syphilis test only. If the treponemal test is positive and the rapid plasma reagin is negative, dismiss syphilis as previously treated and concentrate on HSV as the cause of the current ulcer.\n\nSelect the single best option.", "solution": "The problem statement is valid. It presents a clear, self-contained, and scientifically grounded clinical scenario in the field of venereology. The provided information is sufficient and consistent, allowing for a logical differential diagnosis and the formulation of a management plan based on the established principles of medicine. The question asks for the best application of sexual history-taking and diagnostic reasoning, which is a well-posed problem.\n\nThe patient is a 28-year-old cisgender man presenting with a solitary, painless, indurated genital ulcer of 7 days' duration, accompanied by non-tender inguinal lymphadenopathy. He reports a new sexual partner 3 weeks (which is 21 days) prior to presentation, with inconsistent condom use. This clinical presentation and timeline are classic for a primary chancre of syphilis, caused by *Treponema pallidum*. The typical incubation period for syphilis is approximately 21 days. The lesion characteristics (solitary, painless, indurated) and the non-tender lymphadenopathy are the hallmark signs.\n\nConversely, genital herpes simplex virus (HSV) infection, the main differential to consider, typically presents with multiple, painful vesicles that evolve into ulcers. The incubation period is shorter (typically 2-12 days), and the associated lymphadenopathy is usually tender. The patient's history lacks these features.\n\nThe task is to select the option that best integrates a proper sexual history to support the leading diagnosis of syphilis and outlines the correct subsequent diagnostic steps.\n\n**Analysis of Option A:**\nThis option proposes a stepwise approach that is fully consistent with best practices in sexual health.\n1.  **History-taking**: It advocates starting with an open-ended question, which is the cornerstone of patient-centered interviewing. It then correctly focuses on anchoring the timeline of the lesion to specific sexual encounters to estimate the incubation period. The systematic collection of further details (the \"five Ps\" elements: partners, practices, protection, past STIs, pregnancy plans - although not named as such, the components are listed) is comprehensive.\n2.  **Clinical Correlation**: It accurately correlates the findings—an incubation period of approximately 3 weeks, a solitary, painless, indurated ulcer, and non-tender lymphadenopathy—with the diagnosis of primary syphilis.\n3.  **Diagnostic Plan**: The proposed diagnostic strategy is a model of care. It includes:\n    -   Ordering both a non-treponemal test (e.g., RPR or VDRL) and a treponemal test (e.g., TPPA or EIA), which is the standard for syphilis serological diagnosis.\n    -   Attempting direct detection from the chancre via darkfield microscopy or polymerase chain reaction (PCR), which is the most sensitive method for diagnosing early primary syphilis, as serology may still be negative.\n    -   A critical contingency plan: if serology is nonreactive despite high clinical suspicion, repeating it in approximately 2 weeks to account for the seroconversion window.\n    -   Comprehensive STI screening, including for HIV, *Neisseria gonorrhoeae*, and *Chlamydia trachomatis*, which is standard of care for any patient with a new STI.\n    -   Logically reserving specific HSV testing for cases with a more typical herpetic presentation.\nThis option is thorough, evidence-based, and clinically sound.\nVerdict: **Correct**.\n\n**Analysis of Option B:**\nThis option is deeply flawed. Starting with a closed, leading question (“Is your ulcer from herpes?”) is poor communication technique. Assuming a diagnosis and treating with benzathine penicillin without any confirmatory testing is contrary to modern medical practice, except in specific public health or resource-poor contexts not described here; it prevents confirmation of the diagnosis and monitoring of treatment response via serology. Skipping a broader sexual history misses opportunities for comprehensive risk assessment and counseling. Deferring HIV testing is a serious omission, as genital ulcer disease increases the risk of HIV acquisition and transmission, and co-infection is common.\nVerdict: **Incorrect**.\n\n**Analysis of Option C:**\nThis option is based on false premises. Prioritizing questions about HSV is inappropriate when the clinical signs overwhelmingly point to syphilis. The statement \"a painless ulcer is unlikely to be syphilis\" is factually wrong; the classic syphilitic chancre is painless. The statement that syphilis serology \"only becomes positive late\" is a misleading oversimplification; serology can be negative in the earliest stage, but it is not a reason to forego testing, especially given the recommendation to repeat the test. Ordering type-specific HSV Immunoglobulin G (IgG) serology is not the recommended method for diagnosing an acute genital ulcer, as it only indicates past exposure and cannot confirm the etiology of the current lesion. Failing to order any syphilis testing in this high-suspicion scenario is a major diagnostic error.\nVerdict: **Incorrect**.\n\n**Analysis of Option D:**\nThis option contains multiple, significant errors. Diagnosing chancroid is incorrect, as this ulcer is painless and indurated, whereas chancroid ulcers are typically painful and non-indurated. The logic of diagnosing chancroid \"on the basis of pain absence\" is a direct contradiction of its defining features. Ruling out syphilis based on a single negative rapid plasma reagin (RPR) test is dangerous, as non-treponemal tests can be negative in early primary syphilis (the \"seronegative window\"). Failing to perform a treponemal test or repeat testing violates standard diagnostic algorithms.\nVerdict: **Incorrect**.\n\n**Analysis of Option E:**\nThis option begins with a reasonable history-taking framework (the \"five Ps\") but then proposes a flawed diagnostic and interpretive strategy. Ordering an HSV PCR is low-yield but not strictly wrong; however, the subsequent logic is erroneous. The recommendation to order only a treponemal test is not standard; algorithms use both test types. The most critical flaw is the interpretation of a positive treponemal test with a negative non-treponemal (RPR) test. In a patient with a lesion suspicious for a primary chancre, this pattern is highly suggestive of *very early primary syphilis*, where the more specific treponemal test becomes positive before the non-treponemal test. To \"dismiss syphilis as previously treated\" in this context would be a catastrophic misinterpretation, leading to a missed diagnosis and lack of treatment.\nVerdict: **Incorrect**.\n\nIn summary, Option A is the only choice that outlines a methodologically sound, evidence-based, and comprehensive approach to the patient, from history-taking through diagnosis and management planning, and is fully aligned with the provided fundamental principles.", "answer": "$$\\boxed{A}$$", "id": "4491681"}, {"introduction": "In modern medicine, diagnosis is rarely based on a single piece of information, and test results are often imperfect. This practice [@problem_id:4445989] demonstrates how Bayes' theorem provides a formal framework for integrating a patient's baseline risk with results from multiple diagnostic tests. Mastering this approach will solidify your ability to quantitatively weigh and combine evidence from different sources, a critical skill for navigating diagnostic uncertainty in complex cases like concurrent oral and genital ulceration.", "problem": "A patient presents to a tertiary dermatology and venereology clinic with concurrent oral and genital ulcers. The working differential is restricted to four mutually exclusive and collectively exhaustive etiologies: herpes simplex virus (HSV) infection, Behçet's disease, primary syphilis, and complex aphthosis. In this clinic, among patients with this specific syndrome (concurrent oral and genital ulcers), the pretest probabilities are: HSV infection $P(H)=0.35$, Behçet's disease $P(B)=0.30$, primary syphilis $P(S)=0.10$, and complex aphthosis $P(A)=0.25$. Independent diagnostic evaluations are performed with the following results and characteristics, assumed conditionally independent given the true underlying diagnosis:\n\n1. Polymerase chain reaction (PCR) for HSV from the genital ulcer: result positive. For HSV infection, the sensitivity is $0.97$. For non-HSV etiologies, the specificity is $0.995$.\n2. Treponema pallidum particle agglutination assay (TPPA): result negative. For primary syphilis, the sensitivity is $0.85$. For non-syphilis etiologies, the specificity is $0.99$.\n3. Pathergy test: result positive. For Behçet's disease, the sensitivity is $0.60$. For non-Behçet's etiologies, the specificity is $0.95$.\n4. Human leukocyte antigen (HLA) B51: result positive. For Behçet's disease, the probability of HLA-B51 positivity is $0.60$. For non-Behçet's etiologies, the probability of HLA-B51 positivity is $0.15$.\n\nAssume that the four listed etiologies are the only possible causes in this model and that, conditioned on the true etiology, the four test results are independent. Using only the definitions of conditional probability, the law of total probability, and Bayes' theorem, compute the posterior probability that HSV infection is the cause of the ulcers given all the observed results. Express your answer as a decimal probability and round your answer to four significant figures.", "solution": "The problem is first validated to ensure it is scientifically sound, self-contained, and well-posed.\n\n### Step 1: Extract Givens\nLet the four mutually exclusive and collectively exhaustive etiologies be denoted by the events:\n- $H$: Herpes simplex virus (HSV) infection\n- $B$: Behçet's disease\n- $S$: Primary syphilis\n- $A$: Complex aphthosis\n\nThe prior probabilities (pretest probabilities) are:\n- $P(H) = 0.35$\n- $P(B) = 0.30$\n- $P(S) = 0.10$\n- $P(A) = 0.25$\nThe sum of these probabilities is $0.35 + 0.30 + 0.10 + 0.25 = 1.00$, confirming they are collectively exhaustive.\n\nThe observed evidence consists of four test results. Let $E$ be the composite event representing all results:\n- $E_1$: PCR for HSV is positive ($PCR^+$)\n- $E_2$: TPPA is negative ($TPPA^-$)\n- $E_3$: Pathergy test is positive ($PT^+$)\n- $E_4$: HLA-B51 is positive ($HLA^+$)\nSo, $E = \\{E_1, E_2, E_3, E_4\\}$.\n\nThe conditional probabilities for the tests are given:\n1.  **PCR for HSV**: Result $PCR^+$.\n    - Sensitivity for HSV: $P(PCR^+ | H) = 0.97$.\n    - Specificity for non-HSV: $P(PCR^- | \\text{not } H) = 0.995$. This implies the false positive rate is $P(PCR^+ | \\text{not } H) = 1 - 0.995 = 0.005$. Here, 'not $H$' corresponds to the set of diagnoses $\\{B, S, A\\}$.\n2.  **TPPA**: Result $TPPA^-$.\n    - Sensitivity for Syphilis: $P(TPPA^+ | S) = 0.85$. This implies the true negative rate for a patient with Syphilis is $P(TPPA^- | S) = 1 - 0.85 = 0.15$.\n    - Specificity for non-Syphilis: $P(TPPA^- | \\text{not } S) = 0.99$. Here, 'not $S$' corresponds to $\\{H, B, A\\}$.\n3.  **Pathergy test**: Result $PT^+$.\n    - Sensitivity for Behçet's: $P(PT^+ | B) = 0.60$.\n    - Specificity for non-Behçet's: $P(PT^- | \\text{not } B) = 0.95$. This implies the false positive rate is $P(PT^+ | \\text{not } B) = 1 - 0.95 = 0.05$. Here, 'not $B$' corresponds to $\\{H, S, A\\}$.\n4.  **HLA-B51**: Result $HLA^+$.\n    - For Behçet's: $P(HLA^+ | B) = 0.60$.\n    - For non-Behçet's: $P(HLA^+ | \\text{not } B) = 0.15$. Here, 'not $B$' corresponds to $\\{H, S, A\\}$.\n\nThe problem assumes the four test results are conditionally independent given the true underlying diagnosis.\n\nThe objective is to compute the posterior probability of HSV infection given the evidence, $P(H|E)$, rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard application of Bayesian inference in a medical context. The givens are complete, with all necessary prior probabilities and conditional probabilities (sensitivities/specificities) defined. The etiologies are mutually exclusive and collectively exhaustive, ensuring a consistent probabilistic model. The assumptions, such as conditional independence of tests, are explicitly stated. There are no scientific or logical contradictions, no ambiguities, and the problem is well-posed. The problem is therefore deemed **valid**.\n\n### Step 3: Solution\nThe posterior probability of HSV infection, $P(H|E)$, can be calculated using Bayes' theorem:\n$$ P(H | E) = \\frac{P(E | H) P(H)}{P(E)} $$\nThe term $P(E)$ in the denominator is the total probability of observing the evidence $E$, calculated by summing over all possible etiologies using the law of total probability:\n$$ P(E) = P(E | H)P(H) + P(E | B)P(B) + P(E | S)P(S) + P(E | A)P(A) $$\nDue to the conditional independence of the four tests, the likelihood of the evidence $E$ for any given diagnosis $D \\in \\{H, B, S, A\\}$ is the product of the individual conditional probabilities of each test result:\n$$ P(E | D) = P(PCR^+ | D) \\times P(TPPA^- | D) \\times P(PT^+ | D) \\times P(HLA^+ | D) $$\nWe must first calculate these likelihoods for each of the four possible diagnoses.\n\n**1. Likelihood for HSV ($H$):**\n- $P(PCR^+ | H) = 0.97$ (Sensitivity)\n- $P(TPPA^- | H) = P(TPPA^- | \\text{not } S) = 0.99$ (Specificity for non-syphilis)\n- $P(PT^+ | H) = P(PT^+ | \\text{not } B) = 1 - 0.95 = 0.05$ (False positive rate)\n- $P(HLA^+ | H) = P(HLA^+ | \\text{not } B) = 0.15$ (Positivity in non-Behçet's)\n$P(E | H) = 0.97 \\times 0.99 \\times 0.05 \\times 0.15 = 0.00720225$\n\n**2. Likelihood for Behçet's disease ($B$):**\n- $P(PCR^+ | B) = P(PCR^+ | \\text{not } H) = 1 - 0.995 = 0.005$ (False positive rate)\n- $P(TPPA^- | B) = P(TPPA^- | \\text{not } S) = 0.99$ (Specificity for non-syphilis)\n- $P(PT^+ | B) = 0.60$ (Sensitivity)\n- $P(HLA^+ | B) = 0.60$ (Positivity in Behçet's)\n$P(E | B) = 0.005 \\times 0.99 \\times 0.60 \\times 0.60 = 0.001782$\n\n**3. Likelihood for Syphilis ($S$):**\n- $P(PCR^+ | S) = P(PCR^+ | \\text{not } H) = 0.005$ (False positive rate)\n- $P(TPPA^- | S) = 1 - 0.85 = 0.15$ (False negative rate)\n- $P(PT^+ | S) = P(PT^+ | \\text{not } B) = 0.05$ (False positive rate)\n- $P(HLA^+ | S) = P(HLA^+ | \\text{not } B) = 0.15$ (Positivity in non-Behçet's)\n$P(E | S) = 0.005 \\times 0.15 \\times 0.05 \\times 0.15 = 0.000005625$\n\n**4. Likelihood for Complex Aphthosis ($A$):**\n- $P(PCR^+ | A) = P(PCR^+ | \\text{not } H) = 0.005$ (False positive rate)\n- $P(TPPA^- | A) = P(TPPA^- | \\text{not } S) = 0.99$ (Specificity for non-syphilis)\n- $P(PT^+ | A) = P(PT^+ | \\text{not } B) = 0.05$ (False positive rate)\n- $P(HLA^+ | A) = P(HLA^+ | \\text{not } B) = 0.15$ (Positivity in non-Behçet's)\n$P(E | A) = 0.005 \\times 0.99 \\times 0.05 \\times 0.15 = 0.000037125$\n\nNow, we calculate the numerator of Bayes' theorem, which is the joint probability $P(E, H)$:\n$P(E | H)P(H) = 0.00720225 \\times 0.35 = 0.0025207875$\n\nNext, we calculate the total probability of the evidence, $P(E)$, by weighting each likelihood by its prior probability and summing:\n$P(E) = P(E|H)P(H) + P(E|B)P(B) + P(E|S)P(S) + P(E|A)P(A)$\n$P(E) = (0.00720225 \\times 0.35) + (0.001782 \\times 0.30) + (0.000005625 \\times 0.10) + (0.000037125 \\times 0.25)$\n$P(E) = 0.0025207875 + 0.0005346 + 0.0000005625 + 0.00000928125$\n$P(E) = 0.00306523125$\n\nFinally, we compute the posterior probability $P(H|E)$:\n$$ P(H | E) = \\frac{P(E | H) P(H)}{P(E)} = \\frac{0.0025207875}{0.00306523125} \\approx 0.8223845 $$\nThe problem requires the answer to be rounded to four significant figures.\n$P(H | E) \\approx 0.8224$", "answer": "$$\\boxed{0.8224}$$", "id": "4445989"}, {"introduction": "The rich patterns within clinical data can be formalized into probabilistic models to aid in classification and prediction. This advanced exercise [@problem_id:4445995] challenges you to translate established clinical knowledge about genital herpes into a naive Bayes classifier, a powerful tool for distinguishing primary from recurrent episodes and predicting outcomes. This practice bridges clinical expertise and computational methods, demonstrating how to build a simple yet effective diagnostic algorithm from the ground up.", "problem": "You are to implement a principled classifier and estimator for genital herpes simplex infection episodes using a minimal generative probabilistic model grounded in established dermatology and venereology facts. The model must be constructed from the following fundamental base: Herpes Simplex Virus (HSV) has two main types affecting the genital area, HSV type 1 and HSV type 2; primary first-episode genital herpes is typically more severe, with more numerous and bilateral lesions, higher frequency of systemic symptoms (fever, malaise), and inguinal lymphadenopathy, compared to recurrent episodes, which are shorter, milder, often preceded by a prodrome (tingling, burning), and more frequently precipitated by triggers such as stress, sexual friction, or menses. HSV type 2 recurs more frequently genitally than HSV type 1. You must formalize these qualitative statements into a naive Bayes model with independent features and use it to infer, for each episode, (i) whether it is primary-like or recurrent-like, (ii) the most likely virus type (HSV type 1 or HSV type 2) driving the genital disease pattern, and (iii) the expected untreated episode duration in days.\n\nDefine the following variables for an episode: $n$ the lesion count (a non-negative integer), $b$ the bilateral involvement indicator ($1$ if bilateral, $0$ otherwise), $s$ the systemic symptom indicator ($1$ if present, $0$ otherwise), $p$ the prodrome indicator ($1$ if present, $0$ otherwise), $d$ the dysuria indicator ($1$ if present, $0$ otherwise), $\\ell$ the inguinal lymphadenopathy indicator ($1$ if present, $0$ otherwise), $c$ the number of recognized triggers in the week preceding onset (a non-negative integer), $r$ the number of recurrences in the last year (a non-negative integer), and $o$ the history of orolabial herpes indicator ($1$ if present, $0$ otherwise).\n\nPart A (episode type): Model two classes $C \\in \\{\\text{primary}, \\text{recurrent}\\}$. Use the following priors: $\\mathbb{P}(C=\\text{primary}) = 0.25$ and $\\mathbb{P}(C=\\text{recurrent}) = 0.75$. Assume conditional independence of features given $C$, and specify likelihoods as follows: for the lesion count $n$, use a Poisson distribution with rate $\\lambda_{n|\\text{primary}} = 12$ and $\\lambda_{n|\\text{recurrent}} = 3$; for the trigger count $c$, use a Poisson distribution with rate $\\lambda_{c|\\text{primary}} = 0.5$ and $\\lambda_{c|\\text{recurrent}} = 1.5$; for bilateral involvement $b$, use a Bernoulli distribution with success probabilities $p_{b|\\text{primary}} = 0.6$ and $p_{b|\\text{recurrent}} = 0.25$; for systemic symptoms $s$, use Bernoulli with $p_{s|\\text{primary}} = 0.65$ and $p_{s|\\text{recurrent}} = 0.1$; for prodrome $p$, use Bernoulli with $p_{p|\\text{primary}} = 0.25$ and $p_{p|\\text{recurrent}} = 0.65$; for dysuria $d$, use Bernoulli with $p_{d|\\text{primary}} = 0.5$ and $p_{d|\\text{recurrent}} = 0.25$; for inguinal lymphadenopathy $\\ell$, use Bernoulli with $p_{\\ell|\\text{primary}} = 0.6$ and $p_{\\ell|\\text{recurrent}} = 0.25$. For a Poisson random variable $X$ with rate $\\lambda$, the probability mass function is $\\mathbb{P}(X=k)=e^{-\\lambda}\\lambda^{k}/k!$ for integer $k\\ge 0$. For a Bernoulli random variable $Y$ with success probability $p$, the probability mass function is $\\mathbb{P}(Y=y)=p^{y}(1-p)^{1-y}$ for $y\\in\\{0,1\\}$. Using Bayes’ theorem $\\mathbb{P}(C\\mid \\text{features}) \\propto \\mathbb{P}(C)\\prod_{i}\\mathbb{P}(\\text{feature}_{i}\\mid C)$, compute the posterior probability $\\mathbb{P}(C=\\text{primary}\\mid n,b,s,p,d,\\ell,c)$ and classify the episode as primary-like if this posterior is at least $0.5$, otherwise as recurrent-like. To ensure numerical stability, you should compute in the log-domain and exponentiate only for normalized posterior evaluation.\n\nPart B (virus type): Model two classes $T \\in \\{\\text{HSV1}, \\text{HSV2}\\}$ representing HSV type 1 and HSV type 2, respectively. Use the priors $\\mathbb{P}(T=\\text{HSV2})=0.7$ and $\\mathbb{P}(T=\\text{HSV1})=0.3$. Condition on the recurrence count $r$ and orolabial history $o$, assuming independence given $T$. For $r$, use a Poisson likelihood with $\\lambda_{r|\\text{HSV2}}=4$ and $\\lambda_{r|\\text{HSV1}}=1$. For $o$, use a Bernoulli likelihood with $p_{o|\\text{HSV2}}=0.2$ and $p_{o|\\text{HSV1}}=0.5$. Compute the posterior $\\mathbb{P}(T\\mid r,o)$ and classify as HSV type 2 if $\\mathbb{P}(T=\\text{HSV2}\\mid r,o)\\ge 0.5$, otherwise HSV type 1.\n\nPart C (expected untreated duration): Let the untreated episode duration be modeled as $D=\\mu_{\\text{primary}}$ if the episode is primary and $D=\\mu_{\\text{recurrent}}$ if recurrent, with $\\mu_{\\text{primary}}=14$ days and $\\mu_{\\text{recurrent}}=7$ days. Report the posterior predictive expectation $\\mathbb{E}[D\\mid \\text{features}]=\\mathbb{P}(C=\\text{primary}\\mid \\text{features})\\cdot 14 + \\mathbb{P}(C=\\text{recurrent}\\mid \\text{features})\\cdot 7$. Express the expected duration in days, rounded to two decimals.\n\nInput and test suite: There is no external input. Your program must hard-code and evaluate the following test suite of episodes, each encoded as a tuple $(n,b,s,p,d,\\ell,c,r,o)$ where the variables are in the order defined above:\n- Case $1$: $(18,1,1,0,1,1,0,0,0)$\n- Case $2$: $(3,0,0,1,0,0,2,5,0)$\n- Case $3$: $(2,0,0,1,0,0,1,1,1)$\n- Case $4$: $(8,1,0,1,0,1,1,2,0)$\n- Case $5$: $(1,0,0,0,0,0,0,0,0)$\n\nFor each case, your program must compute and return a sublist $[C,T,D]$ where $C$ is the integer episode class label (1 for primary-like, 0 for recurrent-like), $T$ is the integer HSV type label (2 for HSV type 2, 1 for HSV type 1), and $D$ is the expected untreated duration as a float in days rounded to two decimals. Final Output Format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets without spaces, where each element is the sublist for a case. For example, the output should look like $[[C_{1},T_{1},D_{1}],[C_{2},T_{2},D_{2}],\\dots]$ with no spaces anywhere in the line.", "solution": "The problem is valid as it presents a scientifically grounded, well-posed, and objective task based on established clinical knowledge in dermatology and venereology. It provides a complete and consistent set of parameters and definitions to construct a probabilistic classifier and estimator. The problem is a formal exercise in applying Bayesian inference, which is a standard and robust methodology in computational sciences.\n\nThe solution is architected as a tripartite Bayesian model. The first part classifies the episode type ($C$), the second classifies the virus type ($T$), and the third estimates the expected episode duration ($D$). These three parts are addressed sequentially for each provided test case. The core of the solution is the application of Bayes' theorem, which states that the posterior probability of a hypothesis (a class) given the evidence (features) is proportional to the product of the prior probability of the hypothesis and the likelihood of the evidence given the hypothesis. The \"naive\" Bayes assumption stipulates that all features are conditionally independent given the class, simplifying the likelihood calculation to a product of individual feature likelihoods.\n\nPart A: Episode Type Classification\nThe goal is to determine whether an episode is primary-like ($C=\\text{primary}$) or recurrent-like ($C=\\text{recurrent}$) based on a set of features $\\boldsymbol{x}_{\\text{A}} = (n, b, s, p, d, \\ell, c)$. According to Bayes' theorem, the posterior probability of a class $C$ is given by:\n$$\n\\mathbb{P}(C \\mid \\boldsymbol{x}_{\\text{A}}) \\propto \\mathbb{P}(C) \\mathbb{P}(\\boldsymbol{x}_{\\text{A}} \\mid C)\n$$\nUnder the naive Bayes assumption of conditional independence, this becomes:\n$$\n\\mathbb{P}(C \\mid \\boldsymbol{x}_{\\text{A}}) \\propto \\mathbb{P}(C) \\mathbb{P}(n \\mid C) \\mathbb{P}(b \\mid C) \\mathbb{P}(s \\mid C) \\mathbb{P}(p \\mid C) \\mathbb{P}(d \\mid C) \\mathbb{P}(\\ell \\mid C) \\mathbb{P}(c \\mid C)\n$$\nDirect computation of this product of probabilities can lead to numerical underflow. To ensure stability, calculations are performed in the log-domain. The unnormalized log-posterior for a class $C$ is:\n$$\n\\log \\tilde{\\mathbb{P}}(C \\mid \\boldsymbol{x}_{\\text{A}}) = \\log \\mathbb{P}(C) + \\sum_{i \\in \\{n,b,s,p,d,\\ell,c\\}} \\log \\mathbb{P}(x_i \\mid C)\n$$\nThe log-likelihood for a Poisson-distributed feature $k$ with rate $\\lambda$ is $\\log \\mathbb{P}(k \\mid \\lambda) = -\\lambda + k \\log \\lambda - \\log(k!)$. The term $\\log(k!)$ is computed efficiently using the log-gamma function, $\\text{gammaln}(k+1)$. The log-likelihood for a Bernoulli-distributed feature $y$ with success probability $p$ is $\\log \\mathbb{P}(y \\mid p) = y \\log p + (1-y) \\log (1-p)$.\n\nLet $L_{\\text{primary}} = \\log \\tilde{\\mathbb{P}}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}})$ and $L_{\\text{recurrent}} = \\log \\tilde{\\mathbb{P}}(C=\\text{recurrent} \\mid \\boldsymbol{x}_{\\text{A}})$. The posterior probability for the primary class is obtained by normalizing these log-scores. Using the log-sum-exp trick to maintain numerical precision, we compute $M = \\max(L_{\\text{primary}}, L_{\\text{recurrent}})$ and then:\n$$\n\\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}}) = \\frac{\\exp(L_{\\text{primary}} - M)}{\\exp(L_{\\text{primary}} - M) + \\exp(L_{\\text{recurrent}} - M)}\n$$\nThe episode is classified as primary-like (label $C=1$) if this posterior probability is greater than or equal to $0.5$; otherwise, it is classified as recurrent-like (label $C=0$).\n\nPart B: Virus Type Classification\nThis part classifies the virus as HSV type $1$ ($T=\\text{HSV1}$) or HSV type $2$ ($T=\\text{HSV2}$) based on features $\\boldsymbol{x}_{\\text{B}} = (r, o)$. The methodology parallels Part A. We compute the unnormalized log-posteriors for each virus type:\n$$\n\\log \\tilde{\\mathbb{P}}(T \\mid \\boldsymbol{x}_{\\text{B}}) = \\log \\mathbb{P}(T) + \\log \\mathbb{P}(r \\mid T) + \\log \\mathbb{P}(o \\mid T)\n$$\nThe classification rule is to select the class with the higher posterior probability. This is equivalent to comparing the unnormalized log-posteriors. The virus is classified as HSV type $2$ (label $T=2$) if $\\log \\tilde{\\mathbb{P}}(T=\\text{HSV2} \\mid \\boldsymbol{x}_{\\text{B}}) \\ge \\log \\tilde{\\mathbb{P}}(T=\\text{HSV1} \\mid \\boldsymbol{x}_{\\text{B}})$, and as HSV type $1$ (label $T=1$) otherwise. Unlike in Part C, explicit normalization is not required for this classification decision.\n\nPart C: Expected Untreated Duration\nThe expected untreated duration, $\\mathbb{E}[D \\mid \\boldsymbol{x}_{\\text{A}}]$, is the posterior predictive expectation. It is a weighted average of the durations for primary and recurrent episodes, where the weights are the posterior probabilities computed in Part A:\n$$\n\\mathbb{E}[D \\mid \\boldsymbol{x}_{\\text{A}}] = \\mathbb{E}[D \\mid C=\\text{primary}] \\cdot \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}}) + \\mathbb{E}[D \\mid C=\\text{recurrent}] \\cdot \\mathbb{P}(C=\\text{recurrent} \\mid \\boldsymbol{x}_{\\text{A}})\n$$\nUsing the given values $\\mu_{\\text{primary}}=14$ days and $\\mu_{\\text{recurrent}}=7$ days, and noting that $\\mathbb{P}(C=\\text{recurrent} \\mid \\boldsymbol{x}_{\\text{A}}) = 1 - \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}})$, the formula simplifies to:\n$$\n\\mathbb{E}[D \\mid \\boldsymbol{x}_{\\text{A}}] = 14 \\cdot \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}}) + 7 \\cdot (1 - \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}})) = 7 \\cdot \\mathbb{P}(C=\\text{primary} \\mid \\boldsymbol{x}_{\\text{A}}) + 7\n$$\nThe final result is rounded to two decimal places as specified. The algorithm implements these three parts for each test case and formats the output as a single-line list of lists.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gammaln\n\ndef solve():\n    \"\"\"\n    Implements a naive Bayes classifier and estimator for herpes simplex infection episodes.\n    \"\"\"\n\n    # Part A: Parameters for Episode Type Classification (primary vs. recurrent)\n    params_A = {\n        'priors': {'primary': 0.25, 'recurrent': 0.75},\n        'likelihoods': {\n            'n': {'type': 'poisson', 'primary': 12, 'recurrent': 3},\n            'c': {'type': 'poisson', 'primary': 0.5, 'recurrent': 1.5},\n            'b': {'type': 'bernoulli', 'primary': 0.6, 'recurrent': 0.25},\n            's': {'type': 'bernoulli', 'primary': 0.65, 'recurrent': 0.1},\n            'p': {'type': 'bernoulli', 'primary': 0.25, 'recurrent': 0.65},\n            'd': {'type': 'bernoulli', 'primary': 0.5, 'recurrent': 0.25},\n            'l': {'type': 'bernoulli', 'primary': 0.6, 'recurrent': 0.25},\n        }\n    }\n\n    # Part B: Parameters for Virus Type Classification (HSV-1 vs. HSV-2)\n    params_B = {\n        'priors': {'hsv1': 0.3, 'hsv2': 0.7},\n        'likelihoods': {\n            'r': {'type': 'poisson', 'hsv1': 1, 'hsv2': 4},\n            'o': {'type': 'bernoulli', 'hsv1': 0.5, 'hsv2': 0.2},\n        }\n    }\n\n    # Part C: Parameters for Expected Duration Estimation\n    params_C = {'primary': 14, 'recurrent': 7}\n\n    test_cases = [\n        (18, 1, 1, 0, 1, 1, 0, 0, 0),  # Case 1\n        (3, 0, 0, 1, 0, 0, 2, 5, 0),   # Case 2\n        (2, 0, 0, 1, 0, 0, 1, 1, 1),   # Case 3\n        (8, 1, 0, 1, 0, 1, 1, 2, 0),   # Case 4\n        (1, 0, 0, 0, 0, 0, 0, 0, 0),   # Case 5\n    ]\n\n    results = []\n\n    for case in test_cases:\n        n, b, s, p, d, l, c, r, o = case\n        features_A = {'n': n, 'b': b, 's': s, 'p': p, 'd': d, 'l': l, 'c': c}\n        features_B = {'r': r, 'o': o}\n\n        # --- Part A: Episode Type Classification ---\n        log_post_primary = np.log(params_A['priors']['primary'])\n        log_post_recurrent = np.log(params_A['priors']['recurrent'])\n\n        for feat, value in features_A.items():\n            spec = params_A['likelihoods'][feat]\n            if spec['type'] == 'poisson':\n                # log P(k|lam) = -lam + k*log(lam) - gammaln(k+1)\n                lam_p, lam_r = spec['primary'], spec['recurrent']\n                log_post_primary += -lam_p + value * np.log(lam_p) - gammaln(value + 1)\n                log_post_recurrent += -lam_r + value * np.log(lam_r) - gammaln(value + 1)\n            elif spec['type'] == 'bernoulli':\n                # log P(y|p) = y*log(p) + (1-y)*log(1-p)\n                prob_p, prob_r = spec['primary'], spec['recurrent']\n                log_post_primary += value * np.log(prob_p) + (1 - value) * np.log(1 - prob_p)\n                log_post_recurrent += value * np.log(prob_r) + (1 - value) * np.log(1 - prob_r)\n\n        # Normalize posteriors for Part A using log-sum-exp trick for numerical stability\n        max_log = max(log_post_primary, log_post_recurrent)\n        post_primary_unnorm = np.exp(log_post_primary - max_log)\n        post_recurrent_unnorm = np.exp(log_post_recurrent - max_log)\n        prob_primary = post_primary_unnorm / (post_primary_unnorm + post_recurrent_unnorm)\n\n        # Classification C: 1 for primary-like, 0 for recurrent-like\n        C_label = 1 if prob_primary >= 0.5 else 0\n\n        # --- Part B: Virus Type Classification ---\n        log_post_hsv1 = np.log(params_B['priors']['hsv1'])\n        log_post_hsv2 = np.log(params_B['priors']['hsv2'])\n\n        for feat, value in features_B.items():\n            spec = params_B['likelihoods'][feat]\n            if spec['type'] == 'poisson':\n                lam_1, lam_2 = spec['hsv1'], spec['hsv2']\n                log_post_hsv1 += -lam_1 + value * np.log(lam_1) - gammaln(value + 1)\n                log_post_hsv2 += -lam_2 + value * np.log(lam_2) - gammaln(value + 1)\n            elif spec['type'] == 'bernoulli':\n                p_1, p_2 = spec['hsv1'], spec['hsv2']\n                log_post_hsv1 += value * np.log(p_1) + (1 - value) * np.log(1 - p_1)\n                log_post_hsv2 += value * np.log(p_2) + (1 - value) * np.log(1- p_2)\n        \n        # Classification T: 2 for HSV-2, 1 for HSV-1\n        T_label = 2 if log_post_hsv2 >= log_post_hsv1 else 1\n\n        # --- Part C: Expected Untreated Duration ---\n        expected_duration = (prob_primary * params_C['primary'] + \n                             (1 - prob_primary) * params_C['recurrent'])\n        D_val = round(expected_duration, 2)\n        \n        results.append([C_label, T_label, D_val])\n\n    # Format the final output string as specified\n    sub_results_str = []\n    for C_label, T_label, D_val in results:\n        sub_results_str.append(f\"[{C_label},{T_label},{D_val:.2f}]\")\n    final_output = f\"[{','.join(sub_results_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "4445995"}]}