{"hands_on_practices": [{"introduction": "A key challenge in systems biology is to connect macroscopic experimental observations to the parameters of an underlying microscopic model. This exercise provides a bridge by showing how experimentally measurable quantities, like the Mean First Passage Time (MFPT) between cellular states, can be used to determine the fundamental parameters of a coarse-grained model. You will derive transition rates $k$, stationary probabilities $p^{\\mathrm{ss}}$, and the potential difference $\\Delta U$ between two cell fates, revealing the quantitative basis of landscape stability from kinetic data [@problem_id:4376534].", "problem": "In the potential landscape and flux framework for cell fate, consider a high-dimensional stochastic gene-regulatory system with two well-separated metastable basins corresponding to phenotypic states labeled $A$ and $B$. Coarse-grain the dynamics to a continuous-time Markov jump process with two states $A$ and $B$ and constant transition rates $k_{A \\to B}$ and $k_{B \\to A}$. Long direct simulations of the full stochastic dynamics yield the following mean first passage times (Mean First Passage Time (MFPT) is defined as the expected time to first reach a specified target set starting from a given initial set): starting in basin $A$, the MFPT to reach basin $B$ is $\\tau_{A \\to B} = 20~\\mathrm{h}$; starting in basin $B$, the MFPT to reach basin $A$ is $\\tau_{B \\to A} = 5~\\mathrm{h}$.\n\nWork within the following foundational definitions and facts:\n- The coarse-grained two-state process is assumed to be a time-homogeneous continuous-time Markov chain with constant transition rates.\n- The stationary distribution $\\{p_A^{\\mathrm{ss}}, p_B^{\\mathrm{ss}}\\}$ solves the master equation at stationarity together with normalization.\n- The coarse-grained potential landscape is defined by $U_i = -\\ln p_i^{\\mathrm{ss}}$ (taking units where Boltzmann constant times temperature equals unity), up to an additive constant.\n- The coarse-grained steady-state probability flux on the edge $A \\rightleftarrows B$ is $J_{A B}^{\\mathrm{ss}} = p_A^{\\mathrm{ss}} k_{A \\to B} - p_B^{\\mathrm{ss}} k_{B \\to A}$.\n\nUsing only these bases and the given MFPTs:\n1. Derive the rates $k_{A \\to B}$ and $k_{B \\to A}$ from the MFPTs.\n2. Derive the stationary probabilities $p_A^{\\mathrm{ss}}$ and $p_B^{\\mathrm{ss}}$ from the rates.\n3. Express the coarse-grained potential difference $\\Delta U \\equiv U_B - U_A$ purely in terms of the MFPTs, and evaluate it exactly.\n4. Briefly justify, from first principles, the value of the coarse-grained steady-state flux $J_{A B}^{\\mathrm{ss}}$ and explain how this connects to the existence of a nonzero continuous-space probability flux field $\\mathbf{J}(\\mathbf{x})$ at the underlying non-equilibrium steady state.\n\nProvide your final answer as the exact expression for $\\Delta U$ in terms of the natural logarithm. Do not include units in the final answer.", "solution": "The problem is first validated to ensure it is scientifically grounded, self-contained, and well-posed.\n\n**Step 1: Extract Givens**\n- The system is a high-dimensional stochastic gene-regulatory system with two metastable states, $A$ and $B$.\n- The dynamics are coarse-grained to a continuous-time Markov jump process between states $A$ and $B$.\n- The transition rates are constant, denoted as $k_{A \\to B}$ and $k_{B \\to A}$.\n- The Mean First Passage Time (MFPT) from basin $A$ to basin $B$ is $\\tau_{A \\to B} = 20~\\mathrm{h}$.\n- The MFPT from basin $B$ to basin $A$ is $\\tau_{B \\to A} = 5~\\mathrm{h}$.\n- The stationary distribution is $\\{p_A^{\\mathrm{ss}}, p_B^{\\mathrm{ss}}\\}$.\n- The coarse-grained potential is defined as $U_i = -\\ln p_i^{\\mathrm{ss}}$, with units where Boltzmann constant times temperature equals unity.\n- The coarse-grained steady-state probability flux is $J_{A B}^{\\mathrm{ss}} = p_A^{\\mathrm{ss}} k_{A \\to B} - p_B^{\\mathrm{ss}} k_{B \\to A}$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding (Critical):** The problem is firmly rooted in the established statistical physics framework for analyzing stochastic biological systems, specifically the potential and flux landscape theory developed by Jin Wang and collaborators. The concepts of coarse-graining, continuous-time Markov chains, mean first passage time, and the definitions of potential and flux are standard in this field. The problem is scientifically sound.\n- **Well-Posed:** The problem provides two data points (the two MFPTs) to determine two unknowns (the two transition rates). From these, all other quantities can be uniquely derived. The problem is self-contained and provides sufficient information for a unique solution.\n- **Objective (Critical):** The language is precise and quantitative, free of subjective or ambiguous terminology.\n\n**Step 3: Verdict and Action**\n- **Verdict:** The problem is valid.\n- **Action:** Proceed with a full solution.\n\n**Solution Derivation**\n\nThe problem requires a four-part solution, which will be addressed sequentially.\n\n**1. Derive the rates $k_{A \\to B}$ and $k_{B \\to A}$ from the MFPTs.**\n\nFor a two-state continuous-time Markov process, the system resides in a given state for an exponentially distributed amount of time before transitioning. If the system is in state $A$, the only possible transition is to state $B$. The rate of this transition is $k_{A \\to B}$. The waiting time in state $A$ is thus an exponential random variable with rate parameter $k_{A \\to B}$. The mean of this exponential distribution is the inverse of the rate.\n\nThe Mean First Passage Time (MFPT) from state $A$ to state $B$, denoted $\\tau_{A \\to B}$, is defined as the expected time to first reach state $B$, starting from state $A$. In this simple two-state model, this is precisely the mean waiting time in state $A$ before the jump to $B$ occurs. Therefore, the MFPT is the reciprocal of the transition rate out of the starting state.\n\nMathematically, we have:\n$$ \\tau_{A \\to B} = \\frac{1}{k_{A \\to B}} $$\nand similarly for the transition from $B$ to $A$:\n$$ \\tau_{B \\to A} = \\frac{1}{k_{B \\to A}} $$\nUsing the given values $\\tau_{A \\to B} = 20~\\mathrm{h}$ and $\\tau_{B \\to A} = 5~\\mathrm{h}$, we can calculate the rates:\n$$ k_{A \\to B} = \\frac{1}{\\tau_{A \\to B}} = \\frac{1}{20}~\\mathrm{h}^{-1} $$\n$$ k_{B \\to A} = \\frac{1}{\\tau_{B \\to A}} = \\frac{1}{5}~\\mathrm{h}^{-1} $$\n\n**2. Derive the stationary probabilities $p_A^{\\mathrm{ss}}$ and $p_B^{\\mathrm{ss}}$ from the rates.**\n\nThe stationary distribution $\\{p_A^{\\mathrm{ss}}, p_B^{\\mathrm{ss}}\\}$ is found by solving the master equation at steady state, where the time derivatives of the probabilities are zero. The master equation for state $A$ is:\n$$ \\frac{dp_A}{dt} = -k_{A \\to B} p_A + k_{B \\to A} p_B $$\nAt steady state, $\\frac{dp_A}{dt} = 0$, which implies:\n$$ p_A^{\\mathrm{ss}} k_{A \\to B} = p_B^{\\mathrm{ss}} k_{B \\to A} $$\nThis is the condition of detailed balance, indicating that the gross probability flow from $A$ to $B$ equals the gross flow from $B$ to $A$ at steady state.\n\nWe also have the normalization condition:\n$$ p_A^{\\mathrm{ss}} + p_B^{\\mathrm{ss}} = 1 $$\nFrom the detailed balance equation, we express $p_B^{\\mathrm{ss}}$ in terms of $p_A^{\\mathrm{ss}}$:\n$$ p_B^{\\mathrm{ss}} = p_A^{\\mathrm{ss}} \\frac{k_{A \\to B}}{k_{B \\to A}} $$\nSubstituting this into the normalization condition:\n$$ p_A^{\\mathrm{ss}} + p_A^{\\mathrm{ss}} \\frac{k_{A \\to B}}{k_{B \\to A}} = 1 $$\n$$ p_A^{\\mathrm{ss}} \\left( 1 + \\frac{k_{A \\to B}}{k_{B \\to A}} \\right) = 1 $$\nSolving for $p_A^{\\mathrm{ss}}$:\n$$ p_A^{\\mathrm{ss}} = \\frac{1}{1 + \\frac{k_{A \\to B}}{k_{B \\to A}}} = \\frac{k_{B \\to A}}{k_{B \\to A} + k_{A \\to B}} $$\nAnd for $p_B^{\\mathrm{ss}}$:\n$$ p_B^{\\mathrm{ss}} = 1 - p_A^{\\mathrm{ss}} = \\frac{k_{A \\to B}}{k_{B \\to A} + k_{A \\to B}} $$\nSubstituting the numerical values for the rates ($k_{A \\to B} = 1/20$ and $k_{B \\to A} = 1/5$):\n$$ p_A^{\\mathrm{ss}} = \\frac{1/5}{1/5 + 1/20} = \\frac{1/5}{(4+1)/20} = \\frac{1}{5} \\cdot \\frac{20}{5} = \\frac{4}{5} $$\n$$ p_B^{\\mathrm{ss}} = \\frac{1/20}{1/5 + 1/20} = \\frac{1/20}{(4+1)/20} = \\frac{1}{20} \\cdot \\frac{20}{5} = \\frac{1}{5} $$\n\n**3. Express the coarse-grained potential difference $\\Delta U \\equiv U_B - U_A$ purely in terms of the MFPTs, and evaluate it.**\n\nThe potential is defined as $U_i = -\\ln p_i^{\\mathrm{ss}}$. The potential difference is therefore:\n$$ \\Delta U = U_B - U_A = (-\\ln p_B^{\\mathrm{ss}}) - (-\\ln p_A^{\\mathrm{ss}}) = \\ln p_A^{\\mathrm{ss}} - \\ln p_B^{\\mathrm{ss}} = \\ln\\left(\\frac{p_A^{\\mathrm{ss}}}{p_B^{\\mathrm{ss}}}\\right) $$\nUsing the expressions for $p_A^{\\mathrm{ss}}$ and $p_B^{\\mathrm{ss}}$ derived from the rates:\n$$ \\frac{p_A^{\\mathrm{ss}}}{p_B^{\\mathrm{ss}}} = \\frac{k_{B \\to A} / (k_{B \\to A} + k_{A \\to B})}{k_{A \\to B} / (k_{B \\to A} + k_{A \\to B})} = \\frac{k_{B \\to A}}{k_{A \\to B}} $$\nThis ratio can also be obtained directly from the detailed balance condition $p_A^{\\mathrm{ss}} k_{A \\to B} = p_B^{\\mathrm{ss}} k_{B \\to A}$.\nSubstituting this into the expression for $\\Delta U$:\n$$ \\Delta U = \\ln\\left(\\frac{k_{B \\to A}}{k_{A \\to B}}\\right) $$\nNow, we express this in terms of the MFPTs using $k_{A \\to B} = 1/\\tau_{A \\to B}$ and $k_{B \\to A} = 1/\\tau_{B \\to A}$:\n$$ \\Delta U = \\ln\\left(\\frac{1/\\tau_{B \\to A}}{1/\\tau_{A \\to B}}\\right) = \\ln\\left(\\frac{\\tau_{A \\to B}}{\\tau_{B \\to A}}\\right) $$\nThis expression gives the potential difference purely in terms of the measurable MFPTs. Evaluating this with the given data:\n$$ \\Delta U = \\ln\\left(\\frac{20}{5}\\right) = \\ln(4) $$\n\n**4. Justify the value of the coarse-grained steady-state flux $J_{A B}^{\\mathrm{ss}}$ and explain its connection to the underlying continuous-space probability flux field $\\mathbf{J}(\\mathbf{x})$.**\n\nThe coarse-grained steady-state flux is defined as $J_{A B}^{\\mathrm{ss}} = p_A^{\\mathrm{ss}} k_{A \\to B} - p_B^{\\mathrm{ss}} k_{B \\to A}$. As established in part $2$, the condition for a stationary state in this system is the detailed balance condition, $p_A^{\\mathrm{ss}} k_{A \\to B} = p_B^{\\mathrm{ss}} k_{B \\to A}$. Substituting this into the flux definition directly shows that the net flux is zero:\n$$ J_{A B}^{\\mathrm{ss}} = p_A^{\\mathrm{ss}} k_{A \\to B} - p_A^{\\mathrm{ss}} k_{A \\to B} = 0 $$\nThe coarse-grained flux $J_{A B}^{\\mathrm{ss}}$ represents the net rate of probability mass transfer between the entire basin $A$ and the entire basin $B$. A value of $0$ signifies that the system, from this macroscopic viewpoint, is in equilibrium. The outflow from $A$ to $B$ is perfectly balanced by the inflow from $B$ to $A$.\n\nHowever, the underlying high-dimensional system is generally a non-equilibrium steady state (NESS). In a continuous state space $\\mathbf{x}$ (e.g., of protein concentrations), a NESS is described by a time-independent probability density $P_{\\mathrm{ss}}(\\mathbf{x})$ and a non-zero, divergence-free probability flux field $\\mathbf{J}_{\\mathrm{ss}}(\\mathbf{x})$ (i.e., $\\nabla \\cdot \\mathbf{J}_{\\mathrm{ss}} = 0$, but $\\mathbf{J}_{\\mathrm{ss}}(\\mathbf{x}) \\neq \\mathbf{0}$). This non-zero flux is a hallmark of systems driven away from thermodynamic equilibrium by, for example, energy-consuming processes like ATP hydrolysis. This flux often manifests as persistent cyclical flows in the state space.\n\nThe coarse-graining procedure averages over these microscopic details. The discrete states $A$ and $B$ correspond to large regions (basins) in the continuous state space. While the microscopic flux $\\mathbf{J}_{\\mathrm{ss}}(\\mathbf{x})$ can be non-zero everywhere, creating rotational flows within and between the basins, the *net* exchange of probability between the entirety of basin $A$ and the entirety of basin $B$ must be zero for the total probability in each basin ($p_A^{\\mathrm{ss}}$ and $p_B^{\\mathrm{ss}}$) to remain constant over time. Thus, the zero value of the coarse-grained flux, $J_{A B}^{\\mathrm{ss}} = 0$, is a necessary condition for the stationarity of the coarse-grained description, and it is fully compatible with the existence of a non-zero, non-equilibrium flux field $\\mathbf{J}_{\\mathrm{ss}}(\\mathbf{x})$ at the underlying microscopic level. The coarse-graining effectively integrates out the non-equilibrium circulation, resulting in a description that satisfies detailed balance.", "answer": "$$\n\\boxed{\\ln(4)}\n$$", "id": "4376534"}, {"introduction": "While the concept of a potential landscape $U$ is powerful, many biological processes like the cell cycle are fundamentally directional and operate far from thermodynamic equilibrium. This practice delves into the core of the flux framework by analyzing a system with a persistent, rotational probability flux $J$. By solving for the dynamics of a particle on a ring, you will uncover how a perfectly flat potential landscape can support directed, cyclical motion, and you will quantify the thermodynamic cost via the entropy production rate $\\sigma$ required to sustain this non-equilibrium state [@problem_id:4376532].", "problem": "Consider a minimal non-equilibrium model of a cyclic cell-fate coordinate, such as a coarse-grained cell cycle phase angle, represented by a single angular variable $\\theta \\in [0, 2\\pi)$ with periodic boundary conditions. The dynamics are given by the Itô stochastic differential equation (SDE)\n$$\n\\mathrm{d}\\theta = \\Omega\\,\\mathrm{d}t + \\sqrt{2D}\\,\\mathrm{d}W_t,\n$$\nwhere $\\Omega>0$ is a constant drift (representing a persistent cyclic drive generated by metabolic and regulatory oscillations), $D>0$ is a constant dimensionless diffusion coefficient (representing molecular noise), and $W_t$ is a standard Wiener process. The probability density $P(\\theta,t)$ evolves according to the Fokker–Planck equation (FPE)\n$$\n\\frac{\\partial P(\\theta,t)}{\\partial t} = -\\frac{\\partial}{\\partial \\theta}\\big(\\Omega\\,P(\\theta,t)\\big) + D\\,\\frac{\\partial^2 P(\\theta,t)}{\\partial \\theta^2}.\n$$\nThe non-equilibrium steady state is characterized by a stationary probability density $P_{\\text{ss}}(\\theta)$ and a stationary probability flux $J(\\theta)$ obeying the continuity relation $\\partial_t P + \\partial_{\\theta} J = 0$ and periodic boundary conditions. In the potential landscape and flux framework, the effective landscape is defined by $U(\\theta) \\equiv -\\ln P_{\\text{ss}}(\\theta)$.\n\nTasks:\n1. Starting from the SDE and FPE above and imposing periodic boundary conditions on $[0,2\\pi)$, derive $P_{\\text{ss}}(\\theta)$ and $J(\\theta)$, and explicitly verify that $P_{\\text{ss}}(\\theta)$ is uniform while $J(\\theta)\\neq 0$.\n2. Using the standard steady-state entropy production rate for Itô diffusions,\n$$\n\\sigma \\equiv \\int_{0}^{2\\pi} \\frac{J(\\theta)^2}{D\\,P_{\\text{ss}}(\\theta)}\\,\\mathrm{d}\\theta,\n$$\ncompute $\\sigma$ for this model.\n3. Briefly explain the biological interpretation of a flat landscape $U(\\theta)$ sustained by a rotational flux $J(\\theta)$ in the context of cell fate, highlighting how directionality of progression can persist without basins in the landscape.\n\nExpress the final answer to Task 2 as a single analytic expression in terms of $\\Omega$ and $D$, with no units. No rounding is required.", "solution": "The problem is scientifically grounded, well-posed, objective, and provides all necessary information to derive a unique and meaningful solution. It is a standard problem in statistical physics applied to systems biology. Therefore, we proceed directly to the solution.\n\n### Task 1: Derivation of Steady-State Probability and Flux\n\nThe dynamics of the probability density $P(\\theta,t)$ are governed by the Fokker–Planck equation (FPE):\n$$\n\\frac{\\partial P(\\theta,t)}{\\partial t} = -\\frac{\\partial}{\\partial \\theta}\\big(\\Omega\\,P(\\theta,t)\\big) + D\\,\\frac{\\partial^2 P(\\theta,t)}{\\partial \\theta^2}\n$$\nThis equation can be written as a continuity equation, $\\frac{\\partial P}{\\partial t} = -\\frac{\\partial J}{\\partial \\theta}$, where the probability flux $J(\\theta,t)$ is defined as:\n$$\nJ(\\theta,t) = \\Omega\\,P(\\theta,t) - D\\,\\frac{\\partial P(\\theta,t)}{\\partial \\theta}\n$$\nIn the steady state, the probability density $P_{\\text{ss}}(\\theta)$ is time-independent, so $\\frac{\\partial P_{\\text{ss}}}{\\partial t} = 0$. The continuity equation then implies that $\\frac{\\partial J_{\\text{ss}}}{\\partial \\theta} = 0$, which means the steady-state flux $J_{\\text{ss}}(\\theta)$ must be a constant, which we will denote as $J_0$.\n\nWe are thus left with a first-order ordinary differential equation for $P_{\\text{ss}}(\\theta)$:\n$$\nJ_0 = \\Omega\\,P_{\\text{ss}}(\\theta) - D\\,\\frac{\\mathrm{d}P_{\\text{ss}}(\\theta)}{\\mathrm{d}\\theta}\n$$\nRearranging this equation gives a standard linear non-homogeneous ODE:\n$$\n\\frac{\\mathrm{d}P_{\\text{ss}}}{\\mathrm{d}\\theta} - \\frac{\\Omega}{D}\\,P_{\\text{ss}}(\\theta) = -\\frac{J_0}{D}\n$$\nThe general solution can be found using an integrating factor $I(\\theta) = \\exp\\left(\\int -\\frac{\\Omega}{D}\\,\\mathrm{d}\\theta\\right) = \\exp\\left(-\\frac{\\Omega\\theta}{D}\\right)$. Multiplying the ODE by $I(\\theta)$ yields:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}\\theta}\\left( P_{\\text{ss}}(\\theta)\\,\\exp\\left(-\\frac{\\Omega\\theta}{D}\\right) \\right) = -\\frac{J_0}{D}\\,\\exp\\left(-\\frac{\\Omega\\theta}{D}\\right)\n$$\nIntegrating both sides with respect to $\\theta$:\n$$\nP_{\\text{ss}}(\\theta)\\,\\exp\\left(-\\frac{\\Omega\\theta}{D}\\right) = \\int -\\frac{J_0}{D}\\,\\exp\\left(-\\frac{\\Omega\\theta}{D}\\right)\\,\\mathrm{d}\\theta = \\left(-\\frac{J_0}{D}\\right)\\left(-\\frac{D}{\\Omega}\\right)\\exp\\left(-\\frac{\\Omega\\theta}{D}\\right) + C\n$$\n$$\nP_{\\text{ss}}(\\theta)\\,\\exp\\left(-\\frac{\\Omega\\theta}{D}\\right) = \\frac{J_0}{\\Omega}\\,\\exp\\left(-\\frac{\\Omega\\theta}{D}\\right) + C\n$$\nwhere $C$ is the constant of integration. Solving for $P_{\\text{ss}}(\\theta)$ by multiplying by $\\exp\\left(\\frac{\\Omega\\theta}{D}\\right)$:\n$$\nP_{\\text{ss}}(\\theta) = \\frac{J_0}{\\Omega} + C\\,\\exp\\left(\\frac{\\Omega\\theta}{D}\\right)\n$$\nWe now apply the boundary conditions. The variable $\\theta$ is periodic on $[0, 2\\pi)$, so the probability density must be periodic: $P_{\\text{ss}}(0) = P_{\\text{ss}}(2\\pi)$.\n$$\nP_{\\text{ss}}(0) = \\frac{J_0}{\\Omega} + C\\,\\exp(0) = \\frac{J_0}{\\Omega} + C\n$$\n$$\nP_{\\text{ss}}(2\\pi) = \\frac{J_0}{\\Omega} + C\\,\\exp\\left(\\frac{2\\pi\\Omega}{D}\\right)\n$$\nSetting $P_{\\text{ss}}(0) = P_{\\text{ss}}(2\\pi)$ gives:\n$$\n\\frac{J_0}{\\Omega} + C = \\frac{J_0}{\\Omega} + C\\,\\exp\\left(\\frac{2\\pi\\Omega}{D}\\right) \\implies C = C\\,\\exp\\left(\\frac{2\\pi\\Omega}{D}\\right)\n$$\nSince $\\Omega > 0$ and $D > 0$, the term $\\exp\\left(\\frac{2\\pi\\Omega}{D}\\right) > 1$. The only way for the equation $C = C \\times (\\text{a number greater than } 1)$ to hold is if $C=0$.\n\nWith $C=0$, the steady-state probability distribution simplifies to:\n$$\nP_{\\text{ss}}(\\theta) = \\frac{J_0}{\\Omega}\n$$\nThis shows that $P_{\\text{ss}}(\\theta)$ is a constant, i.e., a uniform distribution.\nTo find the value of this constant, we apply the normalization condition $\\int_0^{2\\pi} P_{\\text{ss}}(\\theta)\\,\\mathrm{d}\\theta = 1$.\n$$\n\\int_0^{2\\pi} \\frac{J_0}{\\Omega}\\,\\mathrm{d}\\theta = \\frac{J_0}{\\Omega} \\int_0^{2\\pi} \\mathrm{d}\\theta = \\frac{J_0}{\\Omega} (2\\pi) = 1\n$$\nSolving for $J_0$, we find the constant steady-state flux:\n$$\nJ_0 = \\frac{\\Omega}{2\\pi}\n$$\nSubstituting this back into the expression for $P_{\\text{ss}}(\\theta)$:\n$$\nP_{\\text{ss}}(\\theta) = \\frac{1}{\\Omega} \\left(\\frac{\\Omega}{2\\pi}\\right) = \\frac{1}{2\\pi}\n$$\nSo, we have derived $P_{\\text{ss}}(\\theta) = \\frac{1}{2\\pi}$ and $J(\\theta) = J_0 = \\frac{\\Omega}{2\\pi}$. We can explicitly verify that $P_{\\text{ss}}(\\theta)$ is uniform, as it is a constant. We can also verify that $J(\\theta)$ is non-zero, since the problem states $\\Omega>0$, which implies $J(\\theta) = \\frac{\\Omega}{2\\pi} \\neq 0$.\n\n### Task 2: Calculation of Entropy Production Rate\n\nThe steady-state entropy production rate $\\sigma$ is given by the formula:\n$$\n\\sigma = \\int_{0}^{2\\pi} \\frac{J(\\theta)^2}{D\\,P_{\\text{ss}}(\\theta)}\\,\\mathrm{d}\\theta\n$$\nWe substitute the expressions for $J(\\theta)$ and $P_{\\text{ss}}(\\theta)$ derived in Task 1:\n$$\nJ(\\theta) = \\frac{\\Omega}{2\\pi} \\quad \\text{and} \\quad P_{\\text{ss}}(\\theta) = \\frac{1}{2\\pi}\n$$\nThe integrand becomes:\n$$\n\\frac{J(\\theta)^2}{D\\,P_{\\text{ss}}(\\theta)} = \\frac{\\left(\\frac{\\Omega}{2\\pi}\\right)^2}{D\\,\\left(\\frac{1}{2\\pi}\\right)} = \\frac{\\frac{\\Omega^2}{4\\pi^2}}{\\frac{D}{2\\pi}} = \\frac{\\Omega^2}{4\\pi^2} \\cdot \\frac{2\\pi}{D} = \\frac{\\Omega^2}{2\\pi D}\n$$\nThe integrand is a constant. We now compute the definite integral for $\\sigma$:\n$$\n\\sigma = \\int_{0}^{2\\pi} \\frac{\\Omega^2}{2\\pi D}\\,\\mathrm{d}\\theta = \\frac{\\Omega^2}{2\\pi D} \\int_{0}^{2\\pi} \\mathrm{d}\\theta\n$$\n$$\n\\sigma = \\frac{\\Omega^2}{2\\pi D} [\\theta]_0^{2\\pi} = \\frac{\\Omega^2}{2\\pi D} (2\\pi - 0) = \\frac{\\Omega^2}{D}\n$$\nThe entropy production rate is $\\sigma = \\frac{\\Omega^2}{D}$.\n\n### Task 3: Biological Interpretation\n\nThe effective landscape is defined as $U(\\theta) \\equiv -\\ln P_{\\text{ss}}(\\theta)$. With $P_{\\text{ss}}(\\theta) = \\frac{1}{2\\pi}$, the landscape is:\n$$\nU(\\theta) = -\\ln\\left(\\frac{1}{2\\pi}\\right) = \\ln(2\\pi)\n$$\nThis landscape is perfectly flat, meaning it has no valleys (attractors) or hills (barriers). In a traditional equilibrium framework (like Waddington's landscape), a flat potential would imply that there are no preferred cell states and no driving force for state transitions. A population of cells would be uniformly distributed and individual cells would diffuse randomly without any net direction.\n\nHowever, in this non-equilibrium model, we find a non-zero, constant probability flux $J(\\theta) = \\frac{\\Omega}{2\\pi} > 0$. This flux represents a constant, unidirectional \"current\" or flow of probability around the cycle. Biologically, this means that even though all phases of the cell cycle are equally likely to be observed in a large, unsynchronized population (uniform $P_{\\text{ss}}$), each individual cell is relentlessly progressing through the cycle in a specific direction (e.g., G1 $\\to$ S $\\to$ G2 $\\to$ M).\n\nThis coexistence of a flat landscape and a non-zero \"rotational\" flux is a hallmark of a non-equilibrium steady state (NESS). The directionality of biological processes like the cell cycle is not encoded in landscape \"tilts\" or \"valleys\" but is actively maintained by a persistent driving force (the drift $\\Omega$), which is fueled by continuous energy consumption (e.g., from metabolism). The positive entropy production rate $\\sigma = \\frac{\\Omega^2}{D} > 0$ quantifies the rate of this energy dissipation required to maintain the system away from thermal equilibrium and sustain the directed flux. In essence, the flux, not the landscape topography, captures the fundamental directionality of the cell's progression.", "answer": "$$\\boxed{\\frac{\\Omega^2}{D}}$$", "id": "4376532"}, {"introduction": "Armed with the foundational concepts of potential and flux, this final practice transitions from simplified analytical models to a full-scale computational investigation of a realistic gene circuit. You will implement a numerical solver for the Fokker-Planck equation to analyze the classic genetic toggle switch, a paradigm for bistable cell-fate decisions. This hands-on project will allow you to compute and visualize the complete two-dimensional stationary probability distribution $P_{\\mathrm{ss}}$, which defines the landscape, and its associated non-equilibrium flux field $\\mathbf{J}_{\\mathrm{ss}}$, providing a powerful toolset for quantitatively analyzing the stability and dynamics of cellular differentiation [@problem_id:4376575].", "problem": "Consider a two-dimensional stochastic gene regulatory network representing a mutual repression toggle switch. The macroscopic deterministic drift of the state vector $(x,y)$ is given by the ordinary differential equation (ODE)\n$$\n\\frac{dx}{dt} = f_x(x,y),\\quad \\frac{dy}{dt} = f_y(x,y),\n$$\nwhere the right-hand sides represent production balanced by decay and cross-repression with Hill-type nonlinearities. In the mesoscopic description under intrinsic noise, the time evolution of the probability density $P(x,y,t)$ is governed by the Fokker–Planck equation (FPE), also known as the forward Kolmogorov equation,\n$$\n\\frac{\\partial P(x,y,t)}{\\partial t} = -\\nabla \\cdot \\mathbf{J}(x,y,t),\n$$\nwhere the probability flux $\\mathbf{J}$ is given by\n$$\n\\mathbf{J}(x,y,t) = \\mathbf{f}(x,y)\\,P(x,y,t) - \\mathbf{D}\\,\\nabla P(x,y,t),\n$$\nwith drift $\\mathbf{f}(x,y) = (f_x(x,y), f_y(x,y))$ and a constant diagonal diffusion matrix $\\mathbf{D} = \\mathrm{diag}(D_x, D_y)$. At steady state, the stationary distribution $P_{\\text{ss}}(x,y)$ and its associated flux $\\mathbf{J}_{\\text{ss}}(x,y)$ satisfy the divergence-free condition\n$$\n\\nabla \\cdot \\mathbf{J}_{\\text{ss}}(x,y) = 0.\n$$\nThis conservation law encodes the potential landscape (from the probability distribution) and the non-equilibrium flux (from circulating probability currents).\n\nStarting from the general conservation law for probability and the definition of flux above, you will discretize the steady-state Fokker–Planck equation on a uniform rectangular grid using a finite volume scheme. The discretization must:\n- Use cell-centered unknowns for $P_{\\text{ss}}$ on an $N_x \\times N_y$ grid over a rectangular domain $[0,L]\\times[0,L]$ with uniform spacings $\\Delta x = L/N_x$ and $\\Delta y = L/N_y$, and cell centers at $(x_i,y_j) = ((i+\\tfrac{1}{2})\\Delta x,(j+\\tfrac{1}{2})\\Delta y)$ for $i=0,\\ldots,N_x-1$, $j=0,\\ldots,N_y-1$.\n- Compute face fluxes on each cell using an upwind treatment for the advective part $\\mathbf{f}(x,y)\\,P$ and a central difference for the diffusive part $-\\mathbf{D}\\,\\nabla P$.\n- Enforce zero normal flux boundary conditions (no-flux) at the domain boundaries.\n- Enforce the steady-state constraint $\\nabla\\cdot\\mathbf{J}_{\\text{ss}}=0$ for each cell and impose the normalization constraint $\\int P_{\\text{ss}}(x,y)\\,dx\\,dy = 1$ to close the linear system.\n\nFor the toggle network, use the following dimensionless drift functions with Hill-type repression:\n$$\nf_x(x,y) = \\frac{\\alpha}{1 + \\left(\\frac{y}{K}\\right)^n} - x + h,\\qquad\nf_y(x,y) = \\frac{\\alpha}{1 + \\left(\\frac{x}{K}\\right)^m} - y + s,\n$$\nwhere $\\alpha>0$ is the maximal production rate, $K>0$ is the repression threshold (set $K=1$), and $n,m\\ge 2$ are Hill coefficients. The parameters $h$ and $s$ introduce bias terms.\n\nAll quantities in this problem are dimensionless; no physical units are required. Angles do not appear; no angle unit is required. The final numerical outputs must be real-valued scalars.\n\nYour program must:\n1. Assemble and solve the discrete steady-state FPE for $P_{\\text{ss}}$ using the finite volume scheme described above.\n2. Compute the cell-centered flux field $\\mathbf{J}_{\\text{ss}}(x_i,y_j) = \\left(J_x(i,j), J_y(i,j)\\right)$ using central differences for $\\nabla P_{\\text{ss}}$ and the drift evaluated at cell centers.\n3. Compute the discrete divergence residual at cell centers by central differences,\n$$\nR(i,j) = \\frac{J_x(i+1,j) - J_x(i-1,j)}{2\\Delta x} + \\frac{J_y(i,j+1) - J_y(i,j-1)}{2\\Delta y},\n$$\nwith appropriate one-sided differences at boundaries, and report the mean absolute value of $R$ over all cells as a measure of how well $\\nabla\\cdot\\mathbf{J}_{\\text{ss}}=0$ is satisfied.\n\nImplement the above for the following test suite of parameter sets to ensure coverage of distinct regimes:\n- Test case 1 (bistable, symmetric, low noise; \"happy path\"): $L=4$, $N_x=N_y=40$, $\\alpha=3.0$, $K=1.0$, $n=4$, $m=4$, $h=0.0$, $s=0.0$, $D_x=D_y=0.03$. Report:\n  - The normalization error $E_1 = \\left|1 - \\sum_{i,j} P_{\\text{ss}}(i,j)\\,\\Delta x\\,\\Delta y\\right|$.\n  - The mean absolute divergence residual $M_1 = \\frac{1}{N_x N_y}\\sum_{i,j} |R(i,j)|$.\n  - A bimodality balance metric $B_1$, defined as the smaller of the two probability masses in the high-$x$/low-$y$ basin and low-$x$/high-$y$ basin, where the basins are rectangular regions $\\{x>2.5,\\,y<0.5\\}$ and $\\{x<0.5,\\,y>2.5\\}$ respectively. Each mass is the sum of $P_{\\text{ss}}$ over the region times $\\Delta x\\,\\Delta y$.\n- Test case 2 (monostable regime, moderate noise): $L=4$, $N_x=N_y=40$, $\\alpha=1.0$, $K=1.0$, $n=4$, $m=4$, $h=0.0$, $s=0.0$, $D_x=D_y=0.05$. Report:\n  - The normalization error $E_2$.\n  - The mean absolute divergence residual $M_2$.\n  - The distance $R_{\\max,2}$ from the location of the global maximum of $P_{\\text{ss}}$ to the point $(1,1)$, computed as $\\sqrt{(x_{\\max}-1)^2 + (y_{\\max}-1)^2}$.\n- Test case 3 (biased bistability): $L=4$, $N_x=N_y=40$, $\\alpha=3.0$, $K=1.0$, $n=4$, $m=4$, $h=+0.3$, $s=-0.3$, $D_x=D_y=0.03$. Report:\n  - The normalization error $E_3$.\n  - The mean absolute divergence residual $M_3$.\n  - The mass asymmetry $\\Delta_3 = M_{x\\text{-high}} - M_{y\\text{-high}}$, where $M_{x\\text{-high}}$ is the probability mass in $\\{x>2.5,\\,y<0.5\\}$ and $M_{y\\text{-high}}$ is the mass in $\\{x<0.5,\\,y>2.5\\}$.\n- Test case 4 (boundary condition sensitivity on coarser grid): $L=4$, $N_x=N_y=20$, $\\alpha=3.0$, $K=1.0$, $n=4$, $m=4$, $h=0.0$, $s=0.0$, $D_x=D_y=0.03$. Report:\n  - The normalization error $E_4$.\n  - The mean absolute divergence residual $M_4$.\n  - The average absolute boundary normal flux $F_4$, defined by averaging $|J_x|$ along the left and right boundary cell centers and $|J_y|$ along the bottom and top boundary cell centers.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the following order:\n$$\n[E_1,\\,M_1,\\,B_1,\\,E_2,\\,M_2,\\,R_{\\max,2},\\,E_3,\\,M_3,\\,\\Delta_3,\\,E_4,\\,M_4,\\,F_4].\n$$\nAll twelve outputs must be decimal numbers (floating-point values). No other text should be printed.", "solution": "The problem requires the numerical solution of the two-dimensional, steady-state Fokker-Planck equation for a gene regulatory toggle switch model. The solution is to be obtained using a finite volume method on a uniform grid, followed by the calculation of several specified metrics.\n\nThe governing equation at steady state is the divergence-free condition on the probability flux, $\\nabla \\cdot \\mathbf{J}_{\\text{ss}} = 0$. The flux $\\mathbf{J}_{\\text{ss}}$ is composed of an advective (or drift) part and a diffusive part:\n$$\n\\mathbf{J}_{\\text{ss}}(x,y) = \\mathbf{f}(x,y)P_{\\text{ss}}(x,y) - \\mathbf{D} \\nabla P_{\\text{ss}}(x,y)\n$$\nwhere $P_{\\text{ss}}(x,y)$ is the stationary probability distribution, $\\mathbf{f}(x,y) = (f_x(x,y), f_y(x,y))$ is the deterministic drift vector, and $\\mathbf{D} = \\mathrm{diag}(D_x, D_y)$ is the constant, diagonal diffusion matrix.\n\n**Finite Volume Discretization**\n\nThe core of the method is to enforce the conservation law $\\nabla \\cdot \\mathbf{J}_{\\text{ss}} = 0$ in an integral sense over each cell of the computational grid. The domain $[0,L] \\times [0,L]$ is discretized into an $N_x \\times N_y$ grid of cells. Each cell $\\Omega_{i,j}$ is a small rectangle centered at $(x_i, y_j) = ((i+\\frac{1}{2})\\Delta x, (j+\\frac{1}{2})\\Delta y)$, with dimensions $\\Delta x \\times \\Delta y$, where $\\Delta x = L/N_x$ and $\\Delta y = L/N_y$.\n\nWe integrate the governing equation over $\\Omega_{i,j}$ and apply the divergence theorem:\n$$\n\\int_{\\Omega_{i,j}} \\nabla \\cdot \\mathbf{J}_{\\text{ss}} \\,dA = \\oint_{\\partial\\Omega_{i,j}} \\mathbf{J}_{\\text{ss}} \\cdot \\mathbf{n} \\,ds = 0\n$$\nwhere $\\mathbf{n}$ is the outward-pointing normal vector to the cell boundary $\\partial\\Omega_{i,j}$. This integral form states that the total probability flux out of the cell is zero. For a rectangular cell, this becomes:\n$$\n\\left( J_{x, i+1/2, j} - J_{x, i-1/2, j} \\right) \\Delta y + \\left( J_{y, i, j+1/2} - J_{y, i, j-1/2} \\right) \\Delta x = 0\n$$\nHere, $J_{x, i+1/2, j}$ represents the $x$-component of the flux evaluated at the center of the right face of the cell (at $x=(i+1)\\Delta x$), and similarly for the other three faces (left, top, bottom).\n\n**Numerical Flux Approximation**\n\nTo proceed, we must approximate the face fluxes in terms of the cell-centered probability values $P_{i,j} \\equiv P_{\\text{ss}}(x_i, y_j)$. The flux consists of two parts.\n\n1.  **Diffusive Flux**: The diffusive part, $-D_x\\frac{\\partial P}{\\partial x}$, is approximated using a second-order central difference. At the right face $(i+1/2, j)$, this is:\n    $$\n    -D_x \\frac{\\partial P}{\\partial x}\\bigg|_{i+1/2, j} \\approx -D_x \\frac{P_{i+1,j} - P_{i,j}}{\\Delta x}\n    $$\n\n2.  **Advective Flux**: The advective part, $f_x P$, requires an upwind scheme for stability, as specified. The value of $P$ at the face is taken from the \"upwind\" cell, i.e., the cell from which the flow originates. Let $f_{x, i+1/2, j} \\equiv f_x(x_{i+1/2}, y_j)$.\n    - If $f_{x, i+1/2, j} > 0$ (flow is from left to right), we use $P_{i,j}$.\n    - If $f_{x, i+1/2, j} < 0$ (flow is from right to left), we use $P_{i+1,j}$.\n    This can be expressed compactly as $f_{x, i+1/2, j}^+ P_{i,j} + f_{x, i+1/2, j}^- P_{i+1,j}$, where $f^+ = \\max(f,0)$ and $f^- = \\min(f,0)$.\n\nCombining both parts, the total flux through the right face of cell $(i,j)$ is:\n$$\nJ_{x, i+1/2, j} \\approx \\left( f_{x, i+1/2, j}^+ P_{i,j} + f_{x, i+1/2, j}^- P_{i+1,j} \\right) - D_x \\frac{P_{i+1,j} - P_{i,j}}{\\Delta x}\n$$\nAnalogous expressions are derived for the other three faces ($J_{x, i-1/2, j}$, $J_{y, i, j+1/2}$, $J_{y, i, j-1/2}$).\n\n**Assembly of the Linear System**\n\nSubstituting these flux approximations into the flux balance equation for each cell $(i,j)$ yields a linear algebraic equation that relates $P_{i,j}$ to its four neighbors, $P_{i \\pm 1, j}$ and $P_{i, j \\pm 1}$. This results in a large, sparse system of linear equations of the form $\\mathbf{A}\\mathbf{p} = \\mathbf{0}$, where $\\mathbf{p}$ is a vector containing all the unknown cell probabilities $P_{i,j}$ (flattened into a 1D array of size $N_x N_y$). The matrix $\\mathbf{A}$ has a pentadiagonal structure.\n\nThe no-flux boundary conditions are incorporated by setting the normal flux to zero at the domain boundaries. For example, for a cell $(0,j)$ on the left boundary, the flux through its left face is zero, $J_{x, -1/2, j} = 0$. This modifies the flux balance equation for boundary cells.\n\n**Closing the System**\n\nThe homogeneous system $\\mathbf{A}\\mathbf{p} = \\mathbf{0}$ has a non-trivial solution (since the sum of coefficients in each row is zero), but this solution is only defined up to a multiplicative constant. To obtain a unique, physically meaningful probability distribution, we must impose the normalization constraint:\n$$\n\\int_0^L \\int_0^L P_{\\text{ss}}(x,y) \\,dx\\,dy = 1\n$$\nIn discrete form, this is $\\sum_{i,j} P_{i,j} \\Delta x \\Delta y = 1$. This equation is used to replace one of the (redundant) flux balance equations in the system. Typically, the equation for the last cell is replaced. This transforms the system into an inhomogeneous one, $\\mathbf{A'}\\mathbf{p} = \\mathbf{b}$, where the last row of $\\mathbf{A'}$ contains the coefficients $\\Delta x \\Delta y$ and the last element of $\\mathbf{b}$ is $1$. This system has a unique solution which can be found using a sparse linear solver.\n\n**Post-processing and Metric Calculation**\n\nAfter solving for the vector $\\mathbf{p}$ and reshaping it into the 2D array $P_{i,j}$, the specified metrics are calculated:\n1.  **Normalization Error ($E$)**: Computed as $\\left|1 - \\sum_{i,j} P_{i,j}\\Delta x \\Delta y\\right|$ to verify the accuracy of the linear solve.\n2.  **Cell-Centered Flux and Divergence Residual ($M$)**: A cell-centered flux field $\\mathbf{J}_{\\text{ss}}(x_i, y_j)$ is computed using the solved $P_{i,j}$. The drift $\\mathbf{f}$ is evaluated at cell centers, and the gradient $\\nabla P_{\\text{ss}}$ is approximated using central differences (with one-sided differences at boundaries). The divergence of this flux field, $R(i,j) = (\\nabla \\cdot \\mathbf{J}_{\\text{ss}})_{i,j}$, is then computed, again using centered/one-sided differences. The mean absolute value of $R(i,j)$ over the grid, $M$, quantifies how well the numerical solution satisfies the original divergence-free condition.\n3.  **Basin Metrics ($B_1$, $\\Delta_3$)**: Probability masses for specified rectangular regions (basins) are calculated by summing $P_{i,j} \\Delta x \\Delta y$ for all cells whose centers fall within those regions. These masses are used to compute the bimodality balance $B_1$ and asymmetry $\\Delta_3$.\n4.  **Peak Location ($R_{\\max,2}$)**: The grid indices of the maximum value of $P_{i,j}$ are found, converted to spatial coordinates $(x_{\\max}, y_{\\max})$, and used to compute the distance to a reference point.\n5.  **Boundary Flux ($F_4$)**: The average absolute normal flux is computed by averaging the magnitudes of the pre-calculated cell-centered normal flux components ($|J_x|$ on vertical boundaries, $|J_y|$ on horizontal boundaries) at all boundary cells.\n\nThis comprehensive procedure allows for a robust numerical characterization of the toggle-switch system's stationary behavior under different parameter regimes.", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Main orchestrator function that runs all test cases and prints the final result.\n    \"\"\"\n    test_cases = [\n        # Test Case 1: Bistable, symmetric, low noise\n        {\n            \"L\": 4.0, \"Nx\": 40, \"Ny\": 40, \"alpha\": 3.0, \"K\": 1.0, \n            \"n\": 4.0, \"m\": 4.0, \"h\": 0.0, \"s\": 0.0, \n            \"Dx\": 0.03, \"Dy\": 0.03, \"case_id\": 1\n        },\n        # Test Case 2: Monostable, moderate noise\n        {\n            \"L\": 4.0, \"Nx\": 40, \"Ny\": 40, \"alpha\": 1.0, \"K\": 1.0, \n            \"n\": 4.0, \"m\": 4.0, \"h\": 0.0, \"s\": 0.0, \n            \"Dx\": 0.05, \"Dy\": 0.05, \"case_id\": 2\n        },\n        # Test Case 3: Biased bistability\n        {\n            \"L\": 4.0, \"Nx\": 40, \"Ny\": 40, \"alpha\": 3.0, \"K\": 1.0, \n            \"n\": 4.0, \"m\": 4.0, \"h\": 0.3, \"s\": -0.3, \n            \"Dx\": 0.03, \"Dy\": 0.03, \"case_id\": 3\n        },\n        # Test Case 4: Coarser grid sensitivity\n        {\n            \"L\": 4.0, \"Nx\": 20, \"Ny\": 20, \"alpha\": 3.0, \"K\": 1.0, \n            \"n\": 4.0, \"m\": 4.0, \"h\": 0.0, \"s\": 0.0, \n            \"Dx\": 0.03, \"Dy\": 0.03, \"case_id\": 4\n        },\n    ]\n\n    all_results = []\n    for params in test_cases:\n        results = run_case(**params)\n        all_results.extend(results)\n\n    # Format the final output string as specified.\n    print(f\"[{','.join(f'{r:.8e}' for r in all_results)}]\")\n\ndef run_case(L, Nx, Ny, alpha, K, n, m, h, s, Dx, Dy, case_id):\n    \"\"\"\n    Solves the FPE for a single set of parameters and computes the required metrics.\n    \"\"\"\n    dx = L / Nx\n    dy = L / Ny\n    \n    # Cell center coordinates\n    x_centers = (np.arange(Nx) + 0.5) * dx\n    y_centers = (np.arange(Ny) + 0.5) * dy\n    \n    # Face coordinates\n    x_faces = np.arange(Nx + 1) * dx\n    y_faces = np.arange(Ny + 1) * dy\n\n    # Drift functions\n    def fx(x, y):\n        return alpha / (1 + (y / K)**n) - x + h\n    def fy(x, y):\n        return alpha / (1 + (x / K)**m) - y + s\n\n    N_vars = Nx * Ny\n    A = lil_matrix((N_vars, N_vars))\n    \n    # Assemble the matrix A\n    for j in range(Ny):\n        for i in range(Nx):\n            k = i + j * Nx # Flattened index\n            \n            # Coefficients for neighbors\n            # East face (i+1/2)\n            if i  Nx - 1:\n                f_val = fx(x_faces[i + 1], y_centers[j])\n                f_pos = max(f_val, 0)\n                f_neg = min(f_val, 0)\n                A[k, k] += (f_pos + Dx / dx) * dy\n                A[k, k + 1] += (f_neg - Dx / dx) * dy\n\n            # West face (i-1/2)\n            if i > 0:\n                f_val = fx(x_faces[i], y_centers[j])\n                f_pos = max(f_val, 0)\n                f_neg = min(f_val, 0)\n                A[k, k] -= (f_neg - Dx / dx) * dy\n                A[k, k - 1] -= (f_pos + Dx / dx) * dy\n\n            # North face (j+1/2)\n            if j  Ny - 1:\n                f_val = fy(x_centers[i], y_faces[j + 1])\n                f_pos = max(f_val, 0)\n                f_neg = min(f_val, 0)\n                A[k, k] += (f_pos + Dy / dy) * dx\n                A[k, k + Nx] += (f_neg - Dy / dy) * dx\n            \n            # South face (j-1/2)\n            if j > 0:\n                f_val = fy(x_centers[i], y_faces[j])\n                f_pos = max(f_val, 0)\n                f_neg = min(f_val, 0)\n                A[k, k] -= (f_neg - Dy / dy) * dx\n                A[k, k - Ny] -= (f_pos + Dy / dy) * dx\n\n    # Create RHS vector and apply normalization constraint\n    b = np.zeros(N_vars)\n    A[-1, :] = dx * dy  # Replace last equation\n    b[-1] = 1.0\n\n    # Solve the linear system\n    A_csr = A.tocsr()\n    p_vec = spsolve(A_csr, b)\n    P_ss = p_vec.reshape((Ny, Nx))\n\n    # --- Post-processing and Metric Calculation ---\n\n    # Metric: Normalization Error (E)\n    norm_error = np.abs(1.0 - np.sum(P_ss) * dx * dy)\n\n    # Metric: Mean Absolute Divergence Residual (M)\n    # 1. Compute cell-centered flux J\n    yy, xx = np.meshgrid(y_centers, x_centers, indexing='ij')\n    fx_c = fx(xx, yy)\n    fy_c = fy(xx, yy)\n\n    grad_P_y, grad_P_x = np.gradient(P_ss, dy, dx)\n\n    Jx = fx_c * P_ss - Dx * grad_P_x\n    Jy = fy_c * P_ss - Dy * grad_P_y\n    \n    # 2. Compute divergence of J\n    grad_Jy_y, _ = np.gradient(Jy, dy, dx)\n    _, grad_Jx_x = np.gradient(Jx, dy, dx)\n    R = grad_Jx_x + grad_Jy_y\n    mean_abs_div_residual = np.mean(np.abs(R))\n\n    # --- Case-specific Metrics ---\n    if case_id == 1 or case_id == 3:\n        # Basins for bistability metrics\n        basin_x_high_mask = (xx > 2.5)  (yy  0.5)\n        basin_y_high_mask = (xx  0.5)  (yy > 2.5)\n        \n        mass_x_high = np.sum(P_ss[basin_x_high_mask]) * dx * dy\n        mass_y_high = np.sum(P_ss[basin_y_high_mask]) * dx * dy\n\n        if case_id == 1:\n            # Bimodality balance B1\n            bimodality_balance = min(mass_x_high, mass_y_high)\n            return [norm_error, mean_abs_div_residual, bimodality_balance]\n        else: # case_id == 3\n            # Mass asymmetry Delta3\n            mass_asymmetry = mass_x_high - mass_y_high\n            return [norm_error, mean_abs_div_residual, mass_asymmetry]\n\n    elif case_id == 2:\n        # Distance of max probability from (1,1)\n        j_max, i_max = np.unravel_index(np.argmax(P_ss), P_ss.shape)\n        x_max = x_centers[i_max]\n        y_max = y_centers[j_max]\n        R_max_2 = np.sqrt((x_max - 1.0)**2 + (y_max - 1.0)**2)\n        return [norm_error, mean_abs_div_residual, R_max_2]\n\n    elif case_id == 4:\n        # Average absolute boundary normal flux F4\n        flux_left = np.abs(Jx[:, 0])\n        flux_right = np.abs(Jx[:, -1])\n        flux_bottom = np.abs(Jy[0, :])\n        flux_top = np.abs(Jy[-1, :])\n        \n        total_abs_flux = np.sum(flux_left) + np.sum(flux_right) + np.sum(flux_bottom) + np.sum(flux_top)\n        num_boundary_points = 2 * Nx + 2 * Ny\n        avg_abs_boundary_flux = total_abs_flux / num_boundary_points\n        return [norm_error, mean_abs_div_residual, avg_abs_boundary_flux]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "4376575"}]}