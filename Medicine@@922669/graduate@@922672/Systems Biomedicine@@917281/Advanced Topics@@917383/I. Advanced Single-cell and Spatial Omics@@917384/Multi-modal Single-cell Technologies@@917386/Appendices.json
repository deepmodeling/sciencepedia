{"hands_on_practices": [{"introduction": "The success of a single-cell experiment begins with the physical capture of individual cells. This exercise delves into the statistical foundation of droplet-based technologies, where the encapsulation of cells is modeled as a random process. By deriving the Poisson distribution from first principles, you will gain a quantitative understanding of the fundamental trade-off between experimental throughput and data quality, specifically the balance between maximizing single-cell capture and minimizing the rate of confounding cell doublets. [@problem_id:4362774]", "problem": "A droplet-based multi-modal single-cell assay such as Cellular Indexing of Transcriptomes and Epitopes by Sequencing (CITE-seq) co-encapsulates cells with barcoded capture beads inside microfluidic droplets. Assume that cells are suspended at low concentration and that, for each droplet, the arrival of cells can be modeled as independent Bernoulli trials across a large population of cells in the input volume. Let there be $n$ potential trials (cells) each with small probability $p$ of entering a given droplet, with $n$ large and $p$ small so that $n p$ remains finite. Define the mean loading parameter as $\\lambda = n p$. \n\nStarting from the Bernoulli model and without invoking any target distribution by name, derive the limiting distribution for the number of cells per droplet, $K$, as $n \\to \\infty$ with $p = \\lambda / n$. Use this limiting distribution to obtain a closed-form expression for the fraction of droplets that contain exactly one cell and the fraction that contain exactly two cells. Interpret the fraction of droplets with exactly two cells as the doublet fraction. \n\nThen, using $\\lambda = 0.1$, compute numerically the fraction of droplets with exactly one cell and the doublet fraction, and round each to six significant figures. Finally, explain, from first principles, the throughput trade-off: how changing $\\lambda$ affects the expected number of droplets with exactly one cell in a run that generates $r$ droplets per second for $t$ seconds, and how this relates to the doublet fraction in multi-modal single-cell assays. Your final numerical answer must report the two fractions only; express any general expressions for throughput symbolically in your reasoning. No units are required for the fractions.", "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of statistical mechanics and quantitative biology, specifically the modeling of cell loading in microfluidic devices. The problem is well-posed, objective, and contains all necessary information to derive a unique and meaningful solution. It is directly relevant to the topic of multi-modal single-cell technologies. We may therefore proceed with a formal solution.\n\nThe problem starts with the premise that for a given microfluidic droplet, the event of a cell entering it from a large population of $n$ cells is a set of $n$ independent Bernoulli trials. Each trial (representing a single cell) has a small probability $p$ of success (entering the droplet). The total number of cells captured in a droplet, denoted by the random variable $K$, follows a binomial distribution. The probability mass function (PMF) for capturing exactly $k$ cells is given by:\n$$P(K=k) = \\binom{n}{k} p^k (1-p)^{n-k}$$\nwhere $\\binom{n}{k} = \\frac{n!}{k!(n-k)!}$.\n\nThe problem specifies that $n$ is large and $p$ is small, with their product, the mean loading parameter $\\lambda = np$, remaining finite. We are asked to find the limiting distribution as $n \\to \\infty$ with $p = \\lambda/n$. We substitute $p = \\lambda/n$ into the binomial PMF:\n$$P(K=k) = \\frac{n!}{k!(n-k)!} \\left(\\frac{\\lambda}{n}\\right)^k \\left(1-\\frac{\\lambda}{n}\\right)^{n-k}$$\nTo evaluate the limit as $n \\to \\infty$, we analyze the components of this expression. First, we expand the factorial term:\n$$\\frac{n!}{(n-k)!} = n(n-1)(n-2)\\cdots(n-k+1)$$\nWe can rewrite the PMF by rearranging terms:\n$$P(K=k) = \\frac{\\lambda^k}{k!} \\cdot \\frac{n(n-1)\\cdots(n-k+1)}{n^k} \\cdot \\left(1-\\frac{\\lambda}{n}\\right)^n \\cdot \\left(1-\\frac{\\lambda}{n}\\right)^{-k}$$\nNow, we take the limit of each component as $n \\to \\infty$ for a fixed integer $k$:\n1. The term $\\frac{\\lambda^k}{k!}$ is constant with respect to $n$.\n2. The term $\\frac{n(n-1)\\cdots(n-k+1)}{n^k}$ becomes:\n$$\\lim_{n\\to\\infty} \\frac{n(n-1)\\cdots(n-k+1)}{n^k} = \\lim_{n\\to\\infty} \\left(\\frac{n}{n}\\cdot\\frac{n-1}{n}\\cdots\\frac{n-k+1}{n}\\right) = \\lim_{n\\to\\infty} \\left(1 \\cdot \\left(1-\\frac{1}{n}\\right) \\cdots \\left(1-\\frac{k-1}{n}\\right)\\right) = 1$$\n3. The term $\\left(1-\\frac{\\lambda}{n}\\right)^n$ has a well-known limit related to the definition of the exponential function:\n$$\\lim_{n\\to\\infty} \\left(1-\\frac{\\lambda}{n}\\right)^n = \\exp(-\\lambda)$$\n4. For the final term, as $n\\to\\infty$, $\\frac{\\lambda}{n} \\to 0$. Therefore:\n$$\\lim_{n\\to\\infty} \\left(1-\\frac{\\lambda}{n}\\right)^{-k} = (1-0)^{-k} = 1$$\nCombining these limits, we obtain the limiting distribution for $K$:\n$$\\lim_{n\\to\\infty} P(K=k) = \\frac{\\lambda^k}{k!} \\cdot 1 \\cdot \\exp(-\\lambda) \\cdot 1 = \\frac{\\lambda^k \\exp(-\\lambda)}{k!}$$\nThis is the PMF of the Poisson distribution with mean $\\lambda$. Thus, the number of cells per droplet, $K$, is well-approximated by $K \\sim \\text{Poisson}(\\lambda)$.\n\nUsing this limiting distribution, we can find the closed-form expressions for the fraction of droplets containing exactly one cell and exactly two cells. The fraction of droplets with $k$ cells is simply $P(K=k)$.\nFor exactly one cell ($k=1$):\n$$P(K=1) = \\frac{\\lambda^1 \\exp(-\\lambda)}{1!} = \\lambda \\exp(-\\lambda)$$\nFor exactly two cells ($k=2$), which is defined as the doublet fraction:\n$$P(K=2) = \\frac{\\lambda^2 \\exp(-\\lambda)}{2!} = \\frac{\\lambda^2}{2} \\exp(-\\lambda)$$\n\nNext, we compute the numerical values for these fractions using the given mean loading parameter $\\lambda = 0.1$.\nThe fraction of droplets with exactly one cell is:\n$$P(K=1) = 0.1 \\times \\exp(-0.1) \\approx 0.1 \\times 0.9048374180359595 \\approx 0.0904837418$$\nRounded to six significant figures, this is $0.0904837$.\n\nThe doublet fraction is:\n$$P(K=2) = \\frac{(0.1)^2}{2} \\exp(-0.1) = \\frac{0.01}{2} \\exp(-0.1) = 0.005 \\times \\exp(-0.1) \\approx 0.005 \\times 0.9048374180359595 \\approx 0.00452418709$$\nRounded to six significant figures, this is $0.00452419$.\n\nFinally, we explain the throughput trade-off from first principles. In a single-cell experiment that generates droplets at a rate of $r$ for a duration $t$, the total number of droplets produced is $N_{total} = rt$. The primary goal is to maximize the number of useful data-points, which correspond to droplets containing exactly one cell (singlets). The expected number of singlets, let's call this the effective throughput $T_{eff}$, is:\n$$T_{eff}(\\lambda) = N_{total} \\times P(K=1) = (rt) \\lambda \\exp(-\\lambda)$$\nAt the same time, it is critical to minimize experimental artifacts. In multi-modal assays, droplets containing two or more cells (multiplets, with doublets being the most common type) lead to confounded signals and must be discarded. The doublet fraction, $F_{doublet}(\\lambda) = P(K=2)$, is a key metric for data quality.\n$$F_{doublet}(\\lambda) = \\frac{\\lambda^2}{2} \\exp(-\\lambda)$$\nThe trade-off arises from the conflicting dependence of $T_{eff}$ and $F_{doublet}$ on the loading parameter $\\lambda$. To maximize the throughput of singlets, we can find the maximum of $T_{eff}(\\lambda)$ by taking its derivative with respect to $\\lambda$ and setting it to zero:\n$$\\frac{d}{d\\lambda} T_{eff}(\\lambda) = (rt) [\\exp(-\\lambda) - \\lambda \\exp(-\\lambda)] = (rt) \\exp(-\\lambda) (1-\\lambda)$$\nSetting this to zero yields $1-\\lambda = 0$, or $\\lambda=1$. Thus, the maximum number of singlets is obtained when the mean number of cells per droplet is $1$.\nHowever, let us evaluate the doublet fraction at this throughput-maximizing value of $\\lambda=1$:\n$$F_{doublet}(\\lambda=1) = \\frac{1^2}{2} \\exp(-1) = \\frac{1}{2e} \\approx 0.184$$\nA doublet fraction of $18.4\\%$ is unacceptably high for most high-quality single-cell studies, as it implies a significant fraction of the data is corrupted.\nThe doublet fraction $F_{doublet}(\\lambda)$ is a monotonically increasing function of $\\lambda$ for typical values ($0 < \\lambda < 2$). To keep this fraction low, one must use a small $\\lambda$. For instance, at $\\lambda=0.1$, the doublet fraction is only about $0.45\\%$.\nThe consequence of choosing a low $\\lambda$ to ensure high data quality (low doublet rate) is a substantial reduction in throughput. The fraction of droplets that are singlets at $\\lambda=1$ is $P(K=1|\\lambda=1) = 1 \\cdot \\exp(-1) \\approx 0.368$. In contrast, at $\\lambda = 0.1$, the singlet fraction is $P(K=1|\\lambda=0.1) \\approx 0.0905$. This means that to achieve a low doublet rate, one must operate in a regime where over $90\\%$ of droplets are empty ($P(K=0) = \\exp(-0.1) \\approx 0.9048$), and only about $9\\%$ of droplets yield useful singlet data. This illustrates the fundamental trade-off: increasing $\\lambda$ boosts the yield of single-cell droplets up to $\\lambda=1$, but at the cost of a quadratically increasing doublet contamination rate (the ratio $P(K=2)/P(K=1) = \\lambda/2$), forcing a practical compromise at low $\\lambda$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.0904837 & 0.00452419\n\\end{pmatrix}\n}\n$$", "id": "4362774"}, {"introduction": "Once sequencing data is acquired, the raw counts reflect not only biological variation but also technical artifacts like differences in sequencing depth per cell. This practice addresses the critical pre-processing step of normalization, which aims to remove such technical noise. You will perform a hands-on calculation of size factors using the robust median-of-ratios method and contrast it with simpler library-size scaling, revealing how different assumptions can impact the corrected data. [@problem_id:4362752]", "problem": "You are analyzing a small single-cell RNA sequencing (scRNA-seq; single-cell Ribonucleic Acid sequencing) submatrix extracted from a multi-modal single-cell study. The observed integer counts are Unique Molecular Identifier (UMI; Unique Molecular Identifier) counts. From first principles, assume a multiplicative sampling model in which, for gene $g$ and cell $c$, the observed count is proportional to an unknown per-cell efficiency (a cell-specific multiplicative factor) times the underlying gene abundance. You aim to estimate the per-cell scaling factors and to reason about how this estimation differs from log-normalization.\n\nConsider the following raw count matrix $X$ (genes in rows, cells in columns):\n$$\n\\begin{array}{c|ccc}\n & c_1 & c_2 & c_3 \\\\\n\\hline\ng_1 & 100 & 200 & 300 \\\\\ng_2 & 50 & 75 & 125 \\\\\ng_3 & 10 & 10 & 10 \\\\\ng_4 & 0 & 50 & 100 \\\\\n\\end{array}\n$$\n\nUsing the median-of-ratios size-factor method adapted to zero inflation in scRNA-seq, proceed conceptually as follows: form a reference by excluding any gene that has a zero count in any cell; for the remaining genes, compute a per-gene geometric mean across cells; for each cell, compute the ratios of its per-gene counts to the corresponding gene-wise geometric means; take the median of these ratios across genes to obtain that cell’s size factor. Report the resulting size factors for $c_1$, $c_2$, and $c_3$ rounded to $3$ decimals. When comparing options, treat any common multiplicative rescaling of all size factors as equivalent.\n\nNow compare this approach with log-normalization: in standard scRNA-seq preprocessing, log-normalization typically divides each cell’s counts by its total library size (optionally multiplied by a constant scale factor) and applies a logarithm with a small pseudocount. Evaluate which option below jointly provides both the correct size factors for the matrix above (up to a common multiplicative constant and rounded to $3$ decimals) and a correct comparison between median-of-ratios size-factor normalization and log-normalization.\n\nChoose one option.\n\nA. Size factors $\\approx [0.643,\\, 1.000,\\, 1.608]$. Log-normalization divides by per-cell library size and applies a logarithm with a pseudocount, stabilizing variance but not robustly correcting composition bias; the median-of-ratios size factors estimate per-cell multiplicative effects while down-weighting the influence of a few highly expressed genes via the median across genes.\n\nB. Size factors $\\approx [0.478,\\, 1.000,\\, 1.597]$. Under UMI counting, median-of-ratios size factors are numerically equivalent to library-size log-normalization when using the same pseudocount, and log-normalization removes composition bias in the presence of a few highly abundant transcripts.\n\nC. Size factors $\\approx [0.750,\\, 1.000,\\, 1.250]$. The correct reference for ratios uses the arithmetic mean across cells (not the geometric mean), because the geometric mean is inappropriate with zero inflation; unlike size-factor normalization, log-normalization corrects both multiplicative and gene-specific biases.\n\nD. Size factors $\\approx [0.731,\\, 1.022,\\, 1.420]$. The median-of-ratios method uses the mean of ratios across genes to define per-cell factors; log-normalization better corrects composition bias than the median-of-ratios because the logarithm guarantees invariance to extreme genes.", "solution": "The user has provided a problem statement regarding the normalization of a single-cell RNA sequencing count matrix. The task involves validating the problem, calculating size factors using a specific method, and evaluating provided options that combine numerical results with a conceptual comparison to log-normalization.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Raw Count Matrix $X$**:\n$$\nX = \\begin{pmatrix}\n100 & 200 & 300 \\\\\n50 & 75 & 125 \\\\\n10 & 10 & 10 \\\\\n0 & 50 & 100 \\\\\n\\end{pmatrix}\n$$\nwhere rows represent genes ($g_1, g_2, g_3, g_4$) and columns represent cells ($c_1, c_2, c_3$).\n\n- **Assumed Model**: For a gene $g$ and cell $c$, the observed UMI count $X_{gc}$ is proportional to a per-cell efficiency (size factor) times the underlying gene abundance.\n\n- **Method for Size Factor Estimation (Median-of-Ratios)**:\n    1.  Form a reference by excluding any gene that has a zero count in any cell.\n    2.  For the remaining genes, compute a per-gene geometric mean across cells. This serves as the reference level for each gene.\n    3.  For each cell, compute the ratios of its per-gene counts to the corresponding gene-wise geometric means.\n    4.  The size factor for a cell is the median of these ratios.\n\n- **Reporting and Equivalence**:\n    - Round final size factors to $3$ decimals.\n    - Treat any common multiplicative rescaling of all size factors as equivalent.\n\n- **Comparison Task**: Compare the median-of-ratios method with log-normalization, which is described as dividing each cell's counts by its total library size (and other steps).\n\n**Step 2: Validate Using Extracted Givens**\n\n- **Scientific Grounding**: The problem is scientifically grounded. The median-of-ratios method is a well-established normalization technique, first introduced for bulk RNA-seq (DESeq) and adapted for scRNA-seq. The multiplicative model for sampling is a standard assumption. Log-normalization is also a ubiquitous procedure in scRNA-seq analysis pipelines. The concepts of UMIs, size factors, library size, and compositional bias are central to the field.\n\n- **Well-Posed**: The problem is well-posed. It provides a specific input matrix and a clear, algorithmic procedure for calculating the size factors. This ensures that a unique solution (up to a scaling constant) exists and can be derived. The comparative part of the question addresses a standard and important topic in the analysis of sequencing data.\n\n- **Objective**: The problem is objective. It is expressed in precise, technical language. The data are numerical, and the procedure is algorithmic. There are no subjective or opinion-based statements in the problem setup.\n\n**Step 3: Verdict and Action**\n\nThe problem statement is valid. It is scientifically sound, well-posed, and objective. There are no contradictions, missing information, or logical flaws. I will proceed with the solution.\n\n### Solution Derivation\n\nThe procedure to calculate the size factors for cells $c_1$, $c_2$, and $c_3$ is as follows.\n\n**1. Form a Reference Gene Set**\nThe method requires excluding any gene with a zero count in any cell. The count matrix is:\n$$\n\\begin{array}{c|ccc}\n & c_1 & c_2 & c_3 \\\\\n\\hline\ng_1 & 100 & 200 & 300 \\\\\ng_2 & 50 & 75 & 125 \\\\\ng_3 & 10 & 10 & 10 \\\\\ng_4 & 0 & 50 & 100 \\\\\n\\end{array}\n$$\nGene $g_4$ has a count of $0$ in cell $c_1$. Therefore, it is excluded from the calculation. The reference set of genes consists of $g_1$, $g_2$, and $g_3$.\n\n**2. Compute Per-Gene Geometric Means**\nFor the remaining genes, we compute the geometric mean of their counts across the three cells. Let $\\hat{\\mu}_g$ be the geometric mean for gene $g$.\nFor gene $g_1$:\n$$ \\hat{\\mu}_{g_1} = (100 \\times 200 \\times 300)^{1/3} = (6,000,000)^{1/3} \\approx 181.712059 $$\nFor gene $g_2$:\n$$ \\hat{\\mu}_{g_2} = (50 \\times 75 \\times 125)^{1/3} = (468,750)^{1/3} \\approx 77.675971 $$\nFor gene $g_3$:\n$$ \\hat{\\mu}_{g_3} = (10 \\times 10 \\times 10)^{1/3} = 10 $$\n\n**3. Compute Ratios for Each Cell**\nFor each cell $c$, we compute the ratios $r_{gc} = X_{gc} / \\hat{\\mu}_g$ for the reference genes $g \\in \\{g_1, g_2, g_3\\}$.\n\nFor cell $c_1$:\n- $r_{g_1, c_1} = 100 / 181.712059 \\approx 0.5503$\n- $r_{g_2, c_1} = 50 / 77.675971 \\approx 0.6437$\n- $r_{g_3, c_1} = 10 / 10 = 1.0$\nThe set of ratios is $\\{0.5503, 0.6437, 1.0\\}$.\n\nFor cell $c_2$:\n- $r_{g_1, c_2} = 200 / 181.712059 \\approx 1.1006$\n- $r_{g_2, c_2} = 75 / 77.675971 \\approx 0.9656$\n- $r_{g_3, c_2} = 10 / 10 = 1.0$\nThe set of ratios is $\\{1.1006, 0.9656, 1.0\\}$.\n\nFor cell $c_3$:\n- $r_{g_1, c_3} = 300 / 181.712059 \\approx 1.6510$\n- $r_{g_2, c_3} = 125 / 77.675971 \\approx 1.6093$\n- $r_{g_3, c_3} = 10 / 10 = 1.0$\nThe set of ratios is $\\{1.6510, 1.6093, 1.0\\}$.\n\n**4. Compute the Median of Ratios (Size Factors)**\nThe size factor $s_c$ for each cell is the median of its set of ratios.\n\nFor cell $c_1$:\n$$ s_{c_1} = \\text{median}(\\{0.5503, 0.6437, 1.0\\}) = 0.6437 $$\nRounding to $3$ decimals, $s_{c_1} \\approx 0.644$.\n\nFor cell $c_2$:\nThe sorted ratios are $\\{0.9656, 1.0, 1.1006\\}$.\n$$ s_{c_2} = \\text{median}(\\{0.9656, 1.0, 1.1006\\}) = 1.0 $$\nRounding to $3$ decimals, $s_{c_2} = 1.000$.\n\nFor cell $c_3$:\nThe sorted ratios are $\\{1.0, 1.6093, 1.6510\\}$.\n$$ s_{c_3} = \\text{median}(\\{1.0, 1.6093, 1.6510\\}) = 1.6093 $$\nRounding to $3$ decimals, $s_{c_3} \\approx 1.609$.\n\nThe calculated size factors are approximately $[0.644, 1.000, 1.609]$.\n\n### Option-by-Option Analysis\n\nNow I will evaluate each option, which consists of a numerical part (the size factors) and a conceptual part (the comparison of normalization methods).\n\n**A. Size factors $\\approx [0.643,\\, 1.000,\\, 1.608]$. Log-normalization divides by per-cell library size and applies a logarithm with a pseudocount, stabilizing variance but not robustly correcting composition bias; the median-of-ratios size factors estimate per-cell multiplicative effects while down-weighting the influence of a few highly expressed genes via the median across genes.**\n\n- **Numerical Part**: The proposed size factors $[0.643, 1.000, 1.608]$ are extremely close to my calculated values of $[0.644, 1.000, 1.609]$. The differences are minor ($-0.001$, $0$, $-0.001$) and are most likely attributable to slight differences in rounding conventions or floating-point arithmetic. Among the options, this is the only numerically plausible result.\n- **Conceptual Part**: The description of log-normalization is accurate. Normalizing by total library size is known to be non-robust to \"compositional bias\" where a few highly expressed genes can dominate the library size, leading to the apparent down-regulation of other genes. The description of the median-of-ratios method is also correct. By taking the median of ratios, the method is robust to outlier genes (those with extremely high or low counts relative to other cells), providing a more stable estimate of the cell-specific scaling factor. This robustness corrects, or at least mitigates, the compositional bias. The entire statement is conceptually sound.\n\n- **Verdict**: **Correct**.\n\n**B. Size factors $\\approx [0.478,\\, 1.000,\\, 1.597]$. Under UMI counting, median-of-ratios size factors are numerically equivalent to library-size log-normalization when using the same pseudocount, and log-normalization removes composition bias in the presence of a few highly abundant transcripts.**\n\n- **Numerical Part**: Let's compute the size factors based on total library size.\n    - Library size of $c_1$: $100 + 50 + 10 + 0 = 160$.\n    - Library size of $c_2$: $200 + 75 + 10 + 50 = 335$.\n    - Library size of $c_3$: $300 + 125 + 10 + 100 = 535$.\n    If we scale these relative to cell $c_2$, we get the factors: $160/335 \\approx 0.478$, $335/335 = 1.000$, and $535/335 \\approx 1.597$. These numbers match the option. However, this is library-size normalization, not the median-of-ratios method requested in the problem.\n- **Conceptual Part**: The statement \"median-of-ratios size factors are numerically equivalent to library-size\" is demonstrably false from the calculations. The statement that \"log-normalization removes composition bias\" is also false; it is highly susceptible to this bias.\n\n- **Verdict**: **Incorrect**.\n\n**C. Size factors $\\approx [0.750,\\, 1.000,\\, 1.250]$. The correct reference for ratios uses the arithmetic mean across cells (not the geometric mean), because the geometric mean is inappropriate with zero inflation; unlike size-factor normalization, log-normalization corrects both multiplicative and gene-specific biases.**\n\n- **Numerical Part**: If we were to use the arithmetic mean as the reference, the size factors would be different. The values in the option, $[0.750, 1.000, 1.250]$, do not match.\n- **Conceptual Part**: The problem explicitly instructs to use the geometric mean. The claim that the arithmetic mean is \"correct\" is an unsupported opinion that contradicts the problem statement and the standard DESeq method. The reason given (\"geometric mean is inappropriate with zero inflation\") is misleading; the method adapts by excluding genes with zeros, which is a standard procedure. The claim that log-normalization corrects gene-specific biases, while size-factor normalization does not, is also incorrect in this context.\n\n- **Verdict**: **Incorrect**.\n\n**D. Size factors $\\approx [0.731,\\, 1.022,\\, 1.420]$. The median-of-ratios method uses the mean of ratios across genes to define per-cell factors; log-normalization better corrects composition bias than the median-of-ratios because the logarithm guarantees invariance to extreme genes.**\n\n- **Numerical Part**: The source of these numbers is unclear, but they do not match the calculation based on the problem description.\n- **Conceptual Part**: The statement contains multiple falsehoods. It claims the \"median-of-ratios\" method uses a \"mean\", which is a direct contradiction. It claims log-normalization is *better* at correcting composition bias, which is the opposite of the established consensus. The logarithm dampens extreme values but does not make the underlying library size calculation robust to the influence of those genes.\n\n- **Verdict**: **Incorrect**.\n\n### Conclusion\n\nOnly option A provides numerical results that are consistent with the specified calculation method, up to a small, acceptable rounding difference. Furthermore, its conceptual explanation of the properties of median-of-ratios normalization versus log-normalization is accurate and reflects the consensus in the field. All other options contain significant numerical or conceptual errors.", "answer": "$$\\boxed{A}$$", "id": "4362752"}, {"introduction": "Integrating multiple data modalities is a powerful but delicate process; a successful integration removes technical differences between datasets while preserving true biological heterogeneity. This final practice provides tools to quantitatively evaluate the outcome of an integration analysis. By computing metrics that measure both batch mixing and cell-type separation, you will learn to diagnose a common pitfall known as over-integration, ensuring that the biological signals of interest are not inadvertently erased during data correction. [@problem_id:4362789]", "problem": "You are integrating single-cell ribonucleic acid sequencing (scRNA-seq) and single-cell assay for transposase-accessible chromatin (scATAC-seq) profiles using a graph-based method that constructs a shared embedding across modalities. The experimental design includes $2$ cell types, T lymphocytes (T cells) and B lymphocytes (B cells), sampled across $2$ batches (Batch $1$: scRNA-seq; Batch $2$: scATAC-seq-derived gene activity). To evaluate whether integration has over-corrected biological differences, you will compute two biological conservation metrics: a local label mixing score and a gene set score that should remain distinct across cell types.\n\nYou are provided the $k$-nearest neighbor graph ($k = 3$, excluding the query cell) in the integrated space. For each cell, the $3$ nearest neighbors are given as ordered labels of the form (CellType, Batch):\n\n- T1 (T, $1$): neighbors = [(B, $1$), (T, $1$), (B, $2$)]\n- T2 (T, $1$): neighbors = [(B, $2$), (T, $1$), (B, $1$)]\n- T3 (T, $2$): neighbors = [(B, $2$), (B, $2$), (T, $1$)]\n- B1 (B, $1$): neighbors = [(T, $1$), (B, $2$), (T, $1$)]\n- B2 (B, $2$): neighbors = [(T, $1$), (B, $2$), (T, $1$)]\n- B3 (B, $2$): neighbors = [(T, $2$), (B, $2$), (T, $1$)]\n\nUsing the standard definition of the Local Inverse Simpson’s Index (LISI) as the inverse Simpson diversity of labels among a cell’s $k$ nearest neighbors, compute:\n- the average cell-type LISI (cLISI) across all cells,\n- the average batch LISI (iLISI) across all cells.\n\nSeparately, you are given log-normalized scRNA-seq expression for a T cell receptor (TCR) signaling gene set $G_{\\mathrm{TCR}} = \\{\\mathrm{CD3D}, \\mathrm{LCK}, \\mathrm{TRAC}\\}$. For each cell, compute the per-cell TCR gene set score as the arithmetic mean of the gene expressions over $G_{\\mathrm{TCR}}$, then compute the average score for T cells and for B cells.\n\nGene-wise log-normalized expressions (values in arbitrary log units) are:\n\n- CD3D: T1 $= 3.0$, T2 $= 2.8$, T3 $= 3.2$, B1 $= 0.2$, B2 $= 0.1$, B3 $= 0.3$\n- LCK: T1 $= 2.5$, T2 $= 2.7$, T3 $= 2.6$, B1 $= 0.2$, B2 $= 0.1$, B3 $= 0.2$\n- TRAC: T1 $= 3.1$, T2 $= 2.9$, T3 $= 3.0$, B1 $= 0.3$, B2 $= 0.2$, B3 $= 0.1$\n\nBased on the computed average cLISI, iLISI, and the TCR gene set scores across cell types, which interpretation is most consistent with these data?\n\nA. Over-integration is likely: cell-type neighborhoods are strongly mixed (high cLISI close to the two-label maximum), batches are well mixed (high iLISI), yet the TCR gene set remains distinctly higher in T cells than B cells.\n\nB. No over-integration: high cLISI and high iLISI indicate correct mixing of biologically similar cell types, and the TCR gene set is similar between T and B cells.\n\nC. Under-integration: batch effects persist (low iLISI), while the TCR gene set is indistinguishable across T and B cells, indicating loss of biological signal.\n\nD. Indeterminate: because the TCR gene set score was computed only from scRNA-seq, it cannot inform over-integration in a multi-modal setting, even if cLISI and iLISI are high.", "solution": "The problem statement is first validated to ensure it is scientifically grounded, well-posed, and complete.\n\n### Step 1: Extract Givens\n- **Experimental Setup**: $2$ cell types (T cells, B cells) and $2$ batches (Batch $1$: scRNA-seq; Batch $2$: scATAC-seq-derived gene activity).\n- **Cells and Labels**:\n  - T1: (T, $1$)\n  - T2: (T, $1$)\n  - T3: (T, $2$)\n  - B1: (B, $1$)\n  - B2: (B, $2$)\n  - B3: (B, $2$)\n- **$k$-Nearest Neighbors ($k=3$)**:\n  - T1: [(B, $1$), (T, $1$), (B, $2$)]\n  - T2: [(B, $2$), (T, $1$), (B, $1$)]\n  - T3: [(B, $2$), (B, $2$), (T, $1$)]\n  - B1: [(T, $1$), (B, $2$), (T, $1$)]\n  - B2: [(T, $1$), (B, $2$), (T, $1$)]\n  - B3: [(T, $2$), (B, $2$), (T, $1$)]\n- **Metric Definitions**:\n  - Local Inverse Simpson’s Index (LISI) is the inverse Simpson diversity of labels among a cell’s $k$ nearest neighbors.\n  - Per-cell TCR gene set score is the arithmetic mean of gene expressions over the gene set $G_{\\mathrm{TCR}}$.\n- **Gene Set**: $G_{\\mathrm{TCR}} = \\{\\mathrm{CD3D}, \\mathrm{LCK}, \\mathrm{TRAC}\\}$.\n- **Gene Expression Data**:\n  - CD3D: T1=$3.0$, T2=$2.8$, T3=$3.2$, B1=$0.2$, B2=$0.1$, B3=$0.3$\n  - LCK: T1=$2.5$, T2=$2.7$, T3=$2.6$, B1=$0.2$, B2=$0.1$, B3=$0.2$\n  - TRAC: T1=$3.1$, T2=$2.9$, T3=$3.0$, B1=$0.3$, B2=$0.2$, B3=$0.1$\n- **Tasks**:\n  1. Compute the average cell-type LISI (cLISI) and average batch LISI (iLISI).\n  2. Compute the average TCR gene set score for T cells and B cells.\n  3. Interpret the results to evaluate the data integration.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem utilizes established concepts and metrics from single-cell multi-omics analysis, including scRNA-seq, scATAC-seq, gene activity scores, data integration, batch effects, and evaluation metrics like LISI and gene set scoring. The setup is a standard scenario in computational systems biology. This is valid.\n- **Well-Posed**: The problem provides all necessary data and definitions to perform the required calculations. The metrics (LISI, mean gene score) are defined unambiguously. The question asks for an interpretation based on these quantitative results, which is a standard task. This is valid.\n- **Objective**: The problem is stated in precise, objective, and technical language. This is valid.\n- **Completeness and Consistency**: All neighbor lists and expression values are provided. The term \"log-normalized scRNA-seq expression\" is used as a heading for a table that includes data for scATAC-seq cells (T3, B2, B3). This is a minor imprecision in language, but common in the field where \"gene activity scores\" derived from scATAC-seq are made to be analogous to scRNA-seq expression. The context makes it clear that the provided values are to be used for all cells. This does not represent a fatal flaw. This is valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. The solution will proceed.\n\n### Derivations\n\n**1. Calculation of LISI Scores**\n\nThe Simpson's Index ($S$) for a set of neighbors is calculated as $S = \\sum_{i=1}^{L} p_i^2$, where $L$ is the number of unique labels and $p_i$ is the proportion of neighbors with label $i$. The Local Inverse Simpson's Index (LISI) is $\\mathrm{LISI} = 1/S$. The number of neighbors is $k=3$.\n\n**1.1. Cell-type LISI (cLISI)**\nThe labels are T cell (T) and B cell (B). There are $L=2$ labels.\n\n- **Cell T1**: Neighbors' cell types are [B, T, B]. Counts: $1$ T, $2$ B. Proportions: $p_T = \\frac{1}{3}$, $p_B = \\frac{2}{3}$.\n  $S_{\\mathrm{celltype}} = (\\frac{1}{3})^2 + (\\frac{2}{3})^2 = \\frac{1}{9} + \\frac{4}{9} = \\frac{5}{9}$.\n  $\\mathrm{cLISI}(\\mathrm{T1}) = \\frac{1}{5/9} = \\frac{9}{5} = 1.8$.\n- **Cell T2**: Neighbors' cell types are [B, T, B]. Counts: $1$ T, $2$ B.\n  $\\mathrm{cLISI}(\\mathrm{T2}) = 1.8$.\n- **Cell T3**: Neighbors' cell types are [B, B, T]. Counts: $1$ T, $2$ B.\n  $\\mathrm{cLISI}(\\mathrm{T3}) = 1.8$.\n- **Cell B1**: Neighbors' cell types are [T, B, T]. Counts: $2$ T, $1$ B.\n  $S_{\\mathrm{celltype}} = (\\frac{2}{3})^2 + (\\frac{1}{3})^2 = \\frac{4}{9} + \\frac{1}{9} = \\frac{5}{9}$.\n  $\\mathrm{cLISI}(\\mathrm{B1}) = \\frac{1}{5/9} = \\frac{9}{5} = 1.8$.\n- **Cell B2**: Neighbors' cell types are [T, B, T]. Counts: $2$ T, $1$ B.\n  $\\mathrm{cLISI}(\\mathrm{B2}) = 1.8$.\n- **Cell B3**: Neighbors' cell types are [T, B, T]. Counts: $2$ T, $1$ B.\n  $\\mathrm{cLISI}(\\mathrm{B3}) = 1.8$.\n\nThe cLISI for every cell is $1.8$.\nThe average cLISI is:\n$$ \\text{Average cLISI} = \\frac{6 \\times 1.8}{6} = 1.8 $$\n\n**1.2. Batch LISI (iLISI)**\nThe labels are Batch $1$ and Batch $2$. There are $L=2$ labels.\n\n- **Cell T1**: Neighbors' batches are [$1, 1, 2$]. Counts: $2$ from Batch $1$, $1$ from Batch $2$. Proportions: $p_1 = \\frac{2}{3}$, $p_2 = \\frac{1}{3}$.\n  $S_{\\mathrm{batch}} = (\\frac{2}{3})^2 + (\\frac{1}{3})^2 = \\frac{4}{9} + \\frac{1}{9} = \\frac{5}{9}$.\n  $\\mathrm{iLISI}(\\mathrm{T1}) = \\frac{1}{5/9} = \\frac{9}{5} = 1.8$.\n- **Cell T2**: Neighbors' batches are [$2, 1, 1$]. Counts: $2$ from Batch $1$, $1$ from Batch $2$.\n  $\\mathrm{iLISI}(\\mathrm{T2}) = 1.8$.\n- **Cell T3**: Neighbors' batches are [$2, 2, 1$]. Counts: $1$ from Batch $1$, $2$ from Batch $2$. Proportions: $p_1 = \\frac{1}{3}$, $p_2 = \\frac{2}{3}$.\n  $S_{\\mathrm{batch}} = (\\frac{1}{3})^2 + (\\frac{2}{3})^2 = \\frac{5}{9}$.\n  $\\mathrm{iLISI}(\\mathrm{T3}) = 1.8$.\n- **Cell B1**: Neighbors' batches are [$1, 2, 1$]. Counts: $2$ from Batch $1$, $1$ from Batch $2$.\n  $\\mathrm{iLISI}(\\mathrm{B1}) = 1.8$.\n- **Cell B2**: Neighbors' batches are [$1, 2, 1$]. Counts: $2$ from Batch $1$, $1$ from Batch $2$.\n  $\\mathrm{iLISI}(\\mathrm{B2}) = 1.8$.\n- **Cell B3**: Neighbors' batches are [$2, 2, 1$]. Counts: $1$ from Batch $1$, $2$ from Batch $2$.\n  $\\mathrm{iLISI}(\\mathrm{B3}) = 1.8$.\n\nThe iLISI for every cell is $1.8$.\nThe average iLISI is:\n$$ \\text{Average iLISI} = \\frac{6 \\times 1.8}{6} = 1.8 $$\n\n**2. Calculation of TCR Gene Set Scores**\n\nThe score for each cell is the arithmetic mean of the expressions of CD3D, LCK, and TRAC.\n\n- **T cells**:\n  - Score(T1) = $\\frac{3.0 + 2.5 + 3.1}{3} = \\frac{8.6}{3} \\approx 2.867$\n  - Score(T2) = $\\frac{2.8 + 2.7 + 2.9}{3} = \\frac{8.4}{3} = 2.800$\n  - Score(T3) = $\\frac{3.2 + 2.6 + 3.0}{3} = \\frac{8.8}{3} \\approx 2.933$\n  - Average T cell score = $\\frac{(8.6/3) + (8.4/3) + (8.8/3)}{3} = \\frac{25.8/3}{3} = \\frac{25.8}{9} \\approx 2.867$\n\n- **B cells**:\n  - Score(B1) = $\\frac{0.2 + 0.2 + 0.3}{3} = \\frac{0.7}{3} \\approx 0.233$\n  - Score(B2) = $\\frac{0.1 + 0.1 + 0.2}{3} = \\frac{0.4}{3} \\approx 0.133$\n  - Score(B3) = $\\frac{0.3 + 0.2 + 0.1}{3} = \\frac{0.6}{3} = 0.200$\n  - Average B cell score = $\\frac{(0.7/3) + (0.4/3) + (0.6/3)}{3} = \\frac{1.7/3}{3} = \\frac{1.7}{9} \\approx 0.189$\n\n**3. Interpretation and Option Evaluation**\n\n- **LISI Score Interpretation**: For a two-label system, the LISI score ranges from $1$ (perfectly homogeneous neighborhood) to $2$ (perfectly mixed neighborhood, $50/50$ split).\n  - Our average iLISI is $1.8$. This is a high value, close to the maximum of $2$, indicating that cells from different batches are well-mixed in the integrated embedding. This suggests successful removal of the batch effect.\n  - Our average cLISI is $1.8$. This is also a high value, indicating that T cells and B cells are strongly mixed in their local neighborhoods. This is a sign of poor biological conservation, as distinct cell types are not clustering with themselves. This phenomenon is known as **over-integration**.\n\n- **Gene Set Score Interpretation**: The average TCR gene set score for T cells ($\\approx 2.87$) is substantially higher than for B cells ($\\approx 0.19$). This indicates that a key biological signature distinguishing T cells from B cells is well-preserved.\n\n- **Synthesis**: The integration has successfully mixed the batches (high iLISI), but it has done so too aggressively, mixing distinct biological cell types (high cLISI). This is the definition of over-integration. The preservation of the TCR gene set score is an important counterpoint, showing that not all biological signal is lost, but the critical local neighborhood structure, which is the basis for the LISI metric, is compromised.\n\n**Option-by-Option Analysis**\n\n- **A. Over-integration is likely: cell-type neighborhoods are strongly mixed (high cLISI close to the two-label maximum), batches are well mixed (high iLISI), yet the TCR gene set remains distinctly higher in T cells than B cells.**\n  - `high cLISI close to the two-label maximum`: Correct. Our cLISI is $1.8$, close to the maximum of $2$.\n  - `batches are well mixed (high iLISI)`: Correct. Our iLISI is $1.8$.\n  - `TCR gene set remains distinctly higher in T cells than B cells`: Correct. Our scores were $\\approx 2.87$ for T cells vs. $\\approx 0.19$ for B cells.\n  - `Over-integration is likely`: This conclusion is strongly supported by the combination of high iLISI and high cLISI. The entire statement is consistent with our findings.\n  - **Verdict**: **Correct**.\n\n- **B. No over-integration: high cLISI and high iLISI indicate correct mixing of biologically similar cell types, and the TCR gene set is similar between T and B cells.**\n  - `high cLISI and high iLISI indicate correct mixing...`: Incorrect. High cLISI indicates *incorrect* mixing of biologically *distinct* cell types (T vs B cells).\n  - `the TCR gene set is similar between T and B cells`: Incorrect. The scores are vastly different.\n  - **Verdict**: **Incorrect**.\n\n- **C. Under-integration: batch effects persist (low iLISI), while the TCR gene set is indistinguishable across T and B cells, indicating loss of biological signal.**\n  - `batch effects persist (low iLISI)`: Incorrect. We calculated a high iLISI ($1.8$), meaning batch effects are removed, not persistent. Low iLISI would be close to $1$.\n  - `the TCR gene set is indistinguishable across T and B cells`: Incorrect. The scores are very distinct.\n  - **Verdict**: **Incorrect**.\n\n- **D. Indeterminate: because the TCR gene set score was computed only from scRNA-seq, it cannot inform over-integration in a multi-modal setting, even if cLISI and iLISI are high.**\n  - `computed only from scRNA-seq`: Incorrect. The problem provides data for all cells, including those from Batch $2$ (scATAC-seq), and describes this data as \"scATAC-seq-derived gene activity,\" a standard way to produce a gene-centric matrix from chromatin accessibility data.\n  - `it cannot inform over-integration`: Incorrect. Gene set scores are a standard biological conservation metric used to evaluate integration quality. While LISI scores assess the geometric structure, gene scores assess the preservation of known biological features. Both are informative.\n  - **Verdict**: **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "4362789"}]}