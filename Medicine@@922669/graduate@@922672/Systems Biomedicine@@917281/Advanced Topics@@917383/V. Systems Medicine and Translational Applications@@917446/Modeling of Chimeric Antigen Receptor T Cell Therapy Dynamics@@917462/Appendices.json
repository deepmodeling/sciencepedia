{"hands_on_practices": [{"introduction": "This exercise grounds our understanding in a fundamental building block of population dynamics: the logistic growth model. Before modeling complex interactions, it is crucial to understand how a single population, such as CAR T-cells, behaves under resource limitations. By deriving the analytical solution [@problem_id:4361771], you will gain a first-principles understanding of the concept of carrying capacity ($K$), a parameter that elegantly summarizes the complex constraints imposed by the tumor microenvironment on T-cell expansion.", "problem": "Consider the in vivo expansion of Chimeric Antigen Receptor (CAR) T cells following adoptive transfer into a patient with a solid tumor. A widely used coarse-grained population model posits that the CAR T cell abundance $T(t)$ satisfies the ordinary differential equation\n$$\\frac{dT}{dt} = r\\,T\\left(1 - \\frac{T}{K}\\right),$$\nwhere $r>0$ is the intrinsic per-capita growth rate at low $T$, and $K>0$ is a finite upper bound imposed by tumor microenvironment constraints (for example, antigen availability, metabolic resources such as glucose and oxygen, suppressive cytokines, and spatial limitations). Assume the initial condition $T(0)=T_0$ with $0<T_0<K$.\n\nStarting from this differential equation and standard calculus, derive the analytic solution $T(t)$ and state the conditions under which the solution remains positive and bounded for all $t\\geq 0$. Then, interpret the parameter $K$ as an emergent quantity from tumor microenvironment constraints that collectively cap CAR T cell expansion, explaining its meaning in terms of equilibrium and stability.\n\nProvide the final expression for $T(t)$ in closed form as a function of $t$, $T_0$, $r$, and $K$. No numerical approximation or rounding is required, and no units are needed in the final expression.", "solution": "The problem statement is first validated according to the specified criteria.\n\n### Step 1: Extract Givens\n- Differential Equation: $$\\frac{dT}{dt} = r\\,T\\left(1 - \\frac{T}{K}\\right)$$\n- Parameters and Constraints: $r>0$, $K>0$.\n- Initial Condition: $T(0)=T_0$, with $0<T_0<K$.\n- Task:\n  1. Derive the analytic solution $T(t)$.\n  2. State the conditions under which the solution remains positive and bounded for all $t\\geq 0$.\n  3. Interpret the parameter $K$ in terms of equilibrium and stability.\n  4. Provide the final expression for $T(t)$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is scientifically grounded. The logistic equation is a canonical model in population dynamics and ecology, widely and appropriately used in systems biology and mathematical oncology to describe population growth under resource limitations. Its application to model the expansion of CAR T cells subject to the carrying capacity of the tumor microenvironment is a standard, scientifically sound approach in the field.\n- **Well-Posed**: The problem is well-posed. It is a first-order, nonlinear, autonomous ordinary differential equation with a specified initial condition within a valid domain. The existence and uniqueness theorem for ODEs guarantees a unique solution for $t \\geq 0$.\n- **Objective**: The problem is stated in precise, objective mathematical and biological language. It requests a derivation and interpretation based on established principles, free from subjectivity.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically grounded, well-posed, and objective. It presents a standard problem in mathematical biology that can be solved with definitive methods. We proceed with the solution.\n\n### Solution Derivation\nThe governing equation is the logistic differential equation:\n$$\n\\frac{dT}{dt} = r\\,T\\left(1 - \\frac{T}{K}\\right)\n$$\nThis is a separable differential equation. We rearrange the terms to separate the variables $T$ and $t$:\n$$\n\\frac{dT}{T\\left(1 - \\frac{T}{K}\\right)} = r\\,dt\n$$\nTo integrate the left-hand side, we first simplify the expression and then use partial fraction decomposition.\n$$\n\\frac{1}{T\\left(1 - \\frac{T}{K}\\right)} = \\frac{1}{T\\left(\\frac{K-T}{K}\\right)} = \\frac{K}{T(K-T)}\n$$\nWe seek to decompose this fraction into the form:\n$$\n\\frac{K}{T(K-T)} = \\frac{A}{T} + \\frac{B}{K-T}\n$$\nMultiplying both sides by $T(K-T)$ gives:\n$$\nK = A(K-T) + BT\n$$\nTo find the constants $A$ and $B$, we can substitute convenient values for $T$.\n- Let $T=0$: $K = A(K) + B(0) \\implies A = 1$.\n- Let $T=K$: $K = A(0) + B(K) \\implies B = 1$.\nThus, the partial fraction decomposition is:\n$$\n\\frac{K}{T(K-T)} = \\frac{1}{T} + \\frac{1}{K-T}\n$$\nSubstituting this back into the separated differential equation, we get:\n$$\n\\left(\\frac{1}{T} + \\frac{1}{K-T}\\right)dT = r\\,dt\n$$\nNow, we integrate both sides:\n$$\n\\int \\left(\\frac{1}{T} + \\frac{1}{K-T}\\right)dT = \\int r\\,dt\n$$\n$$\n\\ln|T| - \\ln|K-T| = rt + C\n$$\nwhere $C$ is the constant of integration. We can combine the logarithms:\n$$\n\\ln\\left|\\frac{T}{K-T}\\right| = rt + C\n$$\nGiven the initial condition $0 < T_0 < K$ and the nature of the logistic growth (the population will approach $K$ from below), the population $T(t)$ will remain in the interval $(0, K)$ for all $t \\geq 0$. Therefore, $T > 0$ and $K-T > 0$, allowing us to remove the absolute value signs:\n$$\n\\ln\\left(\\frac{T}{K-T}\\right) = rt + C\n$$\nWe solve for the constant $C$ using the initial condition $T(0) = T_0$:\n$$\n\\ln\\left(\\frac{T_0}{K-T_0}\\right) = r(0) + C \\implies C = \\ln\\left(\\frac{T_0}{K-T_0}\\right)\n$$\nSubstituting $C$ back into the equation:\n$$\n\\ln\\left(\\frac{T}{K-T}\\right) = rt + \\ln\\left(\\frac{T_0}{K-T_0}\\right)\n$$\n$$\n\\ln\\left(\\frac{T}{K-T}\\right) - \\ln\\left(\\frac{T_0}{K-T_0}\\right) = rt\n$$\n$$\n\\ln\\left(\\frac{T(K-T_0)}{T_0(K-T)}\\right) = rt\n$$\nExponentiating both sides:\n$$\n\\frac{T(K-T_0)}{T_0(K-T)} = \\exp(rt)\n$$\nNow we solve for $T(t)$:\n$$\nT(K-T_0) = T_0(K-T)\\exp(rt)\n$$\n$$\nT(K-T_0) = KT_0\\exp(rt) - T T_0\\exp(rt)\n$$\n$$\nT(K-T_0) + T T_0\\exp(rt) = KT_0\\exp(rt)\n$$\n$$\nT(K - T_0 + T_0\\exp(rt)) = KT_0\\exp(rt)\n$$\n$$\nT(t) = \\frac{KT_0\\exp(rt)}{K - T_0 + T_0\\exp(rt)}\n$$\nTo obtain the standard form of the logistic function, we divide the numerator and denominator by $T_0\\exp(rt)$:\n$$\nT(t) = \\frac{K}{\\frac{K-T_0}{T_0\\exp(rt)} + 1} = \\frac{K}{1 + \\frac{K-T_0}{T_0}\\exp(-rt)}\n$$\nThis is the analytic solution for $T(t)$.\n\n### Conditions for Positivity and Boundedness\nWe are given $r>0$, $K>0$, and $0 < T_0 < K$.\n1.  **Positivity**: In the solution $T(t) = \\frac{K}{1 + \\left(\\frac{K-T_0}{T_0}\\right)\\exp(-rt)}$, the numerator $K$ is positive. For the denominator, since $K > T_0 > 0$, the term $\\frac{K-T_0}{T_0}$ is positive. The exponential term $\\exp(-rt)$ is always positive for all real $t$. Therefore, the product $\\left(\\frac{K-T_0}{T_0}\\right)\\exp(-rt)$ is positive. The denominator is $1$ plus this positive term, so the denominator is strictly positive (and greater than $1$). A positive numerator divided by a positive denominator yields a positive result. Thus, $T(t) > 0$ for all $t \\geq 0$.\n2.  **Boundedness**: The function $T(t)$ is evaluated at its boundaries. At $t=0$, $T(0) = \\frac{K}{1 + \\frac{K-T_0}{T_0}} = \\frac{K}{\\frac{T_0+K-T_0}{T_0}} = \\frac{K}{K/T_0} = T_0$. As $t \\to \\infty$, since $r>0$, the term $\\exp(-rt) \\to 0$. The solution approaches its upper limit:\n    $$ \\lim_{t\\to\\infty} T(t) = \\frac{K}{1 + \\left(\\frac{K-T_0}{T_0}\\right) \\cdot 0} = K $$\n    Since $T(t)$ is a monotonically increasing function for $0 < T_0 < K$ (its derivative $\\frac{dT}{dt}$ is positive for $0<T<K$), the solution is bounded. For all $t \\geq 0$, the solution satisfies $T_0 \\leq T(t) < K$. The solution is therefore positive and bounded for all non-negative time under the given conditions.\n\n### Interpretation of the Parameter K\nThe parameter $K$ is the **carrying capacity** of the system. Its meaning is found by analyzing the equilibrium points and their stability from the original ODE, $\\frac{dT}{dt} = f(T) = rT - \\frac{r}{K}T^2$.\nThe equilibrium points (or steady states) are the values of $T$ where the rate of change is zero, i.e., $\\frac{dT}{dt} = 0$.\n$$ rT\\left(1 - \\frac{T}{K}\\right) = 0 $$\nThis equation gives two equilibrium points: $T_1^* = 0$ and $T_2^* = K$.\n\nTo determine the stability of these equilibria, we examine the sign of the derivative of the rate function, $f'(T) = \\frac{d}{dT}\\left(rT - \\frac{r}{K}T^2\\right) = r - \\frac{2rT}{K}$.\n- At the equilibrium $T_1^* = 0$: $f'(0) = r$. Since $r>0$, this equilibrium is **unstable**. Any small perturbation from $T=0$ (such as an initial dose $T_0 > 0$) will lead to the population moving away from this point. In the biological context, this is the \"extinction\" state.\n- At the equilibrium $T_2^* = K$: $f'(K) = r - \\frac{2rK}{K} = r - 2r = -r$. Since $r>0$, $f'(K) < 0$, which means this equilibrium is **stable**. If the population is near $K$, it will return to $K$. This implies that $K$ acts as an attractor for the system dynamics.\n\nIn the context of CAR T cell therapy, $K$ represents the maximum sustainable cell population that the tumor microenvironment (TME) can support. It is an emergent parameter that lumps together various biological constraints, including:\n- **Antigen availability**: Limited tumor cells mean limited antigen to stimulate T cell proliferation.\n- **Metabolic resources**: Competition for essential nutrients like glucose and oxygen within the TME.\n- **Inhibitory signals**: The presence of suppressive molecules (e.g., TGF-$\\beta$, IL-10) or inhibitory cells (e.g., regulatory T cells) that dampen the CAR T cell response.\n- **Physical space**: Spatial constraints within the tumor tissue.\n\nTherefore, $K$ is interpreted as the stable, upper bound on CAR T cell abundance, a ceiling imposed by the collective inhibitory and resource-limiting factors of the TME. The population grows until it reaches this carrying capacity, at which point proliferation and death rates balance out, and the population size stabilizes at $T=K$.", "answer": "$$\n\\boxed{\\frac{K}{1 + \\left(\\frac{K - T_0}{T_0}\\right) \\exp(-rt)}}\n$$", "id": "4361771"}, {"introduction": "Building upon the concept of limited growth, we now move to a more realistic scenario by modeling the direct interaction between CAR T-cells and tumor cells. This practice [@problem_id:4361819] treats the system as a classic predator-prey model, a powerful paradigm in mathematical biology. By implementing and simulating this coupled system, you will develop practical computational skills and explore how variations in key biological rates can determine the success or failure of therapy, leading to either tumor eradication or relapse.", "problem": "A dynamic interaction between tumor cells and Chimeric Antigen Receptor T cells (CAR-T) can be modeled from first principles using conservation of mass, resource limitation, and mass-action encounter kinetics. Tumor growth is constrained by limited resources and space, motivating logistic growth, and CAR-T cells interact with tumor cells both by killing the tumor and by expanding upon antigen recognition, while undergoing natural decay. Your task is to implement and simulate a model that estimates the earliest time at which either tumor eradication or tumor regrowth occurs, given specified parameters and initial conditions.\n\nUse the following modeling assumptions drawn from well-tested systems biomedicine principles:\n- Tumor cell population $T(t)$ grows logistically with intrinsic rate $r$ and carrying capacity $K$, and is reduced via CAR-T mediated killing at a rate proportional to the product of tumor and CAR-T counts (mass-action).\n- CAR-T cell population $E(t)$ undergoes net proliferation upon tumor contact proportional to the product $T(t)E(t)$ with coefficient $\\alpha$, and decays at rate $\\delta$ per cell.\n\nFrom these assumptions:\n- The tumor dynamics satisfy the ordinary differential equation\n$$\\frac{dT}{dt} = r\\,T\\left(1-\\frac{T}{K}\\right) - \\kappa\\,E\\,T,$$\nwhere $r$ is in $\\text{day}^{-1}$, $K$ is in $\\text{cells}$, and $\\kappa$ is in $\\text{cell}^{-1}\\,\\text{day}^{-1}$.\n- The CAR-T dynamics satisfy the ordinary differential equation\n$$\\frac{dE}{dt} = \\alpha\\,T\\,E - \\delta\\,E,$$\nwhere $\\alpha$ is in $\\text{cell}^{-1}\\,\\text{day}^{-1}$ and $\\delta$ is in $\\text{day}^{-1}$.\n- Initial conditions are $T(0)=T_0$ and $E(0)=E_0$, with $T_0$ and $E_0$ in $\\text{cells}$.\n\nDefine two clinically relevant thresholds:\n- Tumor eradication when $T(t) \\le T_{\\text{erad}}$, with $T_{\\text{erad}} = 1.0$ in $\\text{cells}$.\n- Tumor regrowth (escape) when $T(t) \\ge T_{\\text{reg}}$, with $T_{\\text{reg}} = 0.8\\,K$ in $\\text{cells}$.\n\nEstimate the earliest time $t^\\ast$ in $\\text{days}$ at which either $T(t)$ first satisfies $T(t) \\le T_{\\text{erad}}$ or $T(t) \\ge T_{\\text{reg}}$. If neither event occurs within a simulation horizon of $t_{\\max}=180$ in $\\text{days}$, return the sentinel $-1.0$. Express the final answers in $\\text{days}$ rounded to two decimal places, except the sentinel which must be exactly $-1.0$.\n\nImplement a program that integrates the coupled system and detects the first threshold crossing using robust event detection. Use a fixed carrying capacity $K=10^9$ in $\\text{cells}$. Assume time is measured in $\\text{days}$ and all cell counts in $\\text{cells}$. The model must be numerically integrated with appropriate accuracy to correctly detect the first event. The output for each test case is a single float rounded to two decimals (or $-1.0$), representing the estimated earliest event time in $\\text{days}$.\n\nTest Suite:\nSimulate the following four hypothetical patients, each specified by parameter values $(r,\\kappa,\\alpha,\\delta)$ and initial conditions $(T_0,E_0)$, where all numbers are given in the units defined above.\n\n- Case $1$ (anticipated eradication): $(r=0.03, \\kappa=1\\times10^{-9}, \\alpha=5\\times10^{-9}, \\delta=0.10), (T_0=1\\times10^{8}, E_0=5\\times10^{7})$.\n- Case $2$ (anticipated regrowth): $(r=0.04, \\kappa=1\\times10^{-10}, \\alpha=1\\times10^{-9}, \\delta=0.20), (T_0=1\\times10^{8}, E_0=1\\times10^{6})$.\n- Case $3$ (no event within horizon): $(r=0.001, \\kappa=5\\times10^{-11}, \\alpha=5\\times10^{-10}, \\delta=0.05), (T_0=1\\times10^{8}, E_0=1\\times10^{5})$.\n- Case $4$ (borderline dynamics): $(r=0.03, \\kappa=5\\times10^{-10}, \\alpha=3\\times10^{-9}, \\delta=0.20), (T_0=1\\times10^{8}, E_0=1\\times10^{7})$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,result_3,result_4]$), where each $result_i$ is the float time in $\\text{days}$ rounded to two decimals, or exactly $-1.0$ if no event occurs by $t_{\\max}$. No additional text should be printed.", "solution": "The problem posed is a well-defined initial value problem for a system of coupled nonlinear ordinary differential equations (ODEs), a standard task in systems biology and computational science. The model is a variant of the predator-prey paradigm, specifically formulated to describe the dynamics of tumor cells ($T$) as prey and Chimeric Antigen Receptor T-cells ($E$) as predators.\n\nThe system is governed by the following equations:\n$$\n\\frac{dT}{dt} = r\\,T\\left(1 - \\frac{T}{K}\\right) - \\kappa\\,E\\,T\n$$\n$$\n\\frac{dE}{dt} = \\alpha\\,T\\,E - \\delta\\,E\n$$\nHere, the tumor population $T(t)$ exhibits logistic growth with an intrinsic rate $r$ and carrying capacity $K$. It is depleted through interactions with CAR-T cells $E(t)$ via a mass-action kinetics term with rate constant $\\kappa$. The CAR-T cell population $E(t)$ proliferates upon encountering tumor cells, also governed by a mass-action term with rate constant $\\alpha$, and undergoes natural first-order decay at a rate $\\delta$. The initial state of the system is given by $T(0) = T_0$ and $E(0) = E_0$.\n\nDue to the nonlinear nature of these coupled equations, an analytical solution is not generally available. Therefore, we must resort to numerical integration to approximate the solution trajectories $T(t)$ and $E(t)$ over time. The core of the task is to determine the earliest time $t^\\ast$ at which the tumor cell population $T(t)$ crosses one of two specified thresholds:\n1.  **Eradication:** $T(t) \\le T_{\\text{erad}}$, where $T_{\\text{erad}} = 1.0$.\n2.  **Regrowth:** $T(t) \\ge T_{\\text{reg}}$, where $T_{\\text{reg}} = 0.8\\,K = 8 \\times 10^8$.\n\nThis type of problem, where one needs to find the time an ODE solution satisfies a specific condition, is known as an event-finding problem. Modern numerical ODE solvers provide robust mechanisms for this. We will employ the `scipy.integrate.solve_ivp` function, a powerful and versatile ODE solver in Python's SciPy library.\n\nThe `solve_ivp` function allows for the specification of event functions. An event is triggered when an event function's value crosses zero. We define two such functions corresponding to our thresholds:\n-   For eradication, the event function is $g_{\\text{erad}}(t, y) = y_0 - T_{\\text{erad}}$, where $y_0$ represents the tumor cell population $T(t)$. The integration should stop if this function becomes zero while decreasing (i.e., $T(t)$ drops to $T_{\\text{erad}}$). This is specified by setting the event's `direction` attribute to $-1$.\n-   For regrowth, the event function is $g_{\\text{reg}}(t, y) = y_0 - T_{\\text{reg}}$. The integration should stop if this function becomes zero while increasing (i.e., $T(t)$ rises to $T_{\\text{reg}}$). This is specified by setting the event's `direction` attribute to $1$.\n\nFor both event functions, we set the `terminal` attribute to `True`. This instructs the solver to terminate the integration as soon as the first of these events is detected. The time of termination is then precisely the earliest event time $t^\\ast$ we seek.\n\nThe overall algorithm for each test case is as follows:\n1.  Define a Python function that computes the derivatives $[\\frac{dT}{dt}, \\frac{dE}{dt}]$ given the current state $[T, E]$, time $t$, and the model parameters $(r, \\kappa, \\alpha, \\delta, K)$.\n2.  Define the two event functions as described above, setting their `terminal` and `direction` properties appropriately.\n3.  Set the integration time span from $t=0$ to $t=t_{\\text{max}} = 180$ days.\n4.  Call `solve_ivp` with the derivative function, time span, initial conditions $(T_0, E_0)$, model parameters, and the list of event functions. We use the `LSODA` method, a well-regarded adaptive solver suitable for both non-stiff and stiff problems, and enable `dense_output=True` for accurate event location.\n5.  After the integration, we check the solver's status. If an event was triggered, the solver terminates, and the event time is the final time point in the solution output, `sol.t[-1]`. This value is rounded to two decimal places.\n6.  If no event is triggered within the time horizon $[0, t_{\\text{max}}]$, the solver completes the full interval. In this case, we report the sentinel value of $-1.0$.\n\nThis procedure is systematically applied to each of the four test cases to generate the final output.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves a system of ODEs modeling CAR-T cell and tumor dynamics\n    to find the earliest time of tumor eradication or regrowth.\n    \"\"\"\n    # Define global constants and thresholds\n    K = 1.0e9  # cells, tumor carrying capacity\n    T_erad = 1.0  # cells, eradication threshold\n    T_reg = 0.8 * K  # cells, regrowth threshold\n    t_max = 180.0  # days, simulation horizon\n\n    # Test suite: (r, kappa, alpha, delta, T0, E0)\n    test_cases = [\n        # Case 1 (anticipated eradication)\n        (0.03, 1e-9, 5e-9, 0.10, 1e8, 5e7),\n        # Case 2 (anticipated regrowth)\n        (0.04, 1e-10, 1e-9, 0.20, 1e8, 1e6),\n        # Case 3 (no event within horizon)\n        (0.001, 5e-11, 5e-10, 0.05, 1e8, 1e5),\n        # Case 4 (borderline dynamics)\n        (0.03, 5e-10, 3e-9, 0.20, 1e8, 1e7),\n    ]\n\n    results = []\n\n    def model(t, y, r, kappa, alpha, delta, K_val):\n        \"\"\"\n        Defines the coupled ODE system for tumor (T) and CAR-T cells (E).\n        y = [T, E]\n        \"\"\"\n        T, E = y\n        # Ensure cell counts do not become negative in the numerical solution\n        T = max(0, T)\n        E = max(0, E)\n        \n        dT_dt = r * T * (1 - T / K_val) - kappa * E * T\n        dE_dt = alpha * T * E - delta * E\n        return [dT_dt, dE_dt]\n\n    # Define event for tumor eradication\n    def event_eradication(t, y, r, kappa, alpha, delta, K_val):\n        return y[0] - T_erad\n    event_eradication.terminal = True\n    event_eradication.direction = -1  # Event triggers when T crosses T_erad from above\n\n    # Define event for tumor regrowth\n    def event_regrowth(t, y, r, kappa, alpha, delta, K_val):\n        return y[0] - T_reg\n    event_regrowth.terminal = True\n    event_regrowth.direction = 1  # Event triggers when T crosses T_reg from below\n\n    for params in test_cases:\n        r_case, kappa_case, alpha_case, delta_case, T0_case, E0_case = params\n        \n        y0 = [T0_case, E0_case]\n        t_span = (0, t_max)\n        \n        # Package arguments for the model and event functions\n        args = (r_case, kappa_case, alpha_case, delta_case, K)\n\n        sol = solve_ivp(\n            fun=model,\n            t_span=t_span,\n            y0=y0,\n            method='LSODA',  # General-purpose solver for stiff/non-stiff problems\n            args=args,\n            events=[event_eradication, event_regrowth],\n            dense_output=True, # Recommended for accurate event location\n        )\n\n        # sol.status == 1 indicates that a terminal event was triggered\n        if sol.status == 1 and sol.t_events and any(len(e) > 0 for e in sol.t_events):\n            # The integration stops at the first terminal event.\n            # The time of this event is the last time point in the solution.\n            event_time = sol.t[-1]\n            results.append(round(event_time, 2))\n        else:\n            # No event occurred within the simulation horizon\n            results.append(-1.0)\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4361819"}, {"introduction": "A mathematical model is only as powerful as its ability to be constrained by real-world data. This final practice [@problem_id:4361810] delves into the critical and advanced topic of parameter identifiability, asking a crucial question: how much information does a given dataset contain about a specific model parameter? Using the robust statistical method of profile likelihood, you will investigate the identifiability of the CAR-T cell death rate ($\\delta$), learning to diagnose when a model is over-parameterized or when data is insufficient, a core skill for any serious modeler in systems biomedicine.", "problem": "You are tasked with implementing a profile likelihood analysis for the death rate of Chimeric Antigen Receptor T cell (CAR-T) therapy, denoted by $\\delta$ in units of $\\mathrm{day}^{-1}$, within a mechanistic model of tumor-CAR-T dynamics. The model must be constructed from first principles of population dynamics and mass-action interaction. Consider a tumor cell population $N(t)$ (in cells) and a CAR-T cell population $E(t)$ (in cells), interacting according to the following ordinary differential equations in continuous time $t$ (in days):\n$$\n\\frac{dN}{dt} \\;=\\; r\\,N(t)\\left(1-\\frac{N(t)}{K}\\right) \\;-\\; k\\,E(t)\\,N(t),\n$$\n$$\n\\frac{dE}{dt} \\;=\\; \\alpha\\,N(t)\\,E(t) \\;-\\; \\delta\\,E(t).\n$$\nHere, $r$ is the tumor intrinsic growth rate (in $\\mathrm{day}^{-1}$), $K$ is the tumor carrying capacity (in cells), $k$ is the CAR-T mediated tumor kill efficacy (in $\\mathrm{day}^{-1}\\,\\mathrm{cell}^{-1}$), $\\alpha$ is the CAR-T expansion coupling due to antigen (in $\\mathrm{day}^{-1}\\,\\mathrm{cell}^{-1}$), and $\\delta$ is the CAR-T death rate (in $\\mathrm{day}^{-1}$). The initial conditions are $N(0)=N_0$ and $E(0)=E_0$, both in cells.\n\nAssume the observable is the tumor burden $N(t)$ at discrete times $\\{t_i\\}_{i=1}^m$, corrupted by additive Gaussian measurement error with known standard deviation $\\sigma$ (in cells). For any given parameter set $\\theta=(r,K,k,\\alpha,\\delta,N_0,E_0)$ and observation times $\\{t_i\\}$, define the negative log-likelihood (ignoring additive constants) under independent Gaussian errors as\n$$\n\\mathrm{NLL}(\\theta) \\;=\\; \\sum_{i=1}^{m} \\frac{\\left(N_\\theta(t_i)-y_i\\right)^2}{2\\,\\sigma^2},\n$$\nwhere $N_\\theta(t)$ denotes the tumor trajectory generated by the model with parameters $\\theta$, and $y_i$ are the observed tumor burdens (in cells).\n\nYour program must perform a profile likelihood analysis for $\\delta$ by computing, for a grid of values $\\delta \\in \\mathcal{D}$, the profiled negative log-likelihood\n$$\n\\mathrm{NLL}_p(\\delta) \\;=\\; \\min_{(k,\\alpha,E_0)\\in\\mathcal{G}} \\mathrm{NLL}\\big(r,K,k,\\alpha,\\delta,N_0,E_0\\big),\n$$\nwhere the nuisance parameters $(k,\\alpha,E_0)$ are optimized over a fixed discrete grid $\\mathcal{G}$, while $r$, $K$, and $N_0$ are held fixed. For numerical simulation of the ordinary differential equations, use a deterministic fourth-order Runge–Kutta scheme with fixed step size, ensuring non-negativity of states by clipping $N(t)$ and $E(t)$ to be greater than or equal to $0$ after each integration step.\n\nInterpretation rule for flat profiles: using the likelihood ratio principle grounded in Wilks’ theorem, for one parameter of interest $\\delta$, a change in profiled negative log-likelihood less than $1.9207$ across the entire $\\delta$ grid indicates a flat profile and hence non-identifiability of $\\delta$ under the given data and model. Formally, define\n$$\n\\Delta(\\mathcal{D}) \\;=\\; \\max_{\\delta\\in\\mathcal{D}} \\mathrm{NLL}_p(\\delta) \\;-\\; \\min_{\\delta\\in\\mathcal{D}} \\mathrm{NLL}_p(\\delta),\n$$\nand declare the profile to be flat if $\\Delta(\\mathcal{D}) < 1.9207$. Flatness may arise from data insufficiency (e.g., too few, too noisy observations) or model redundancy (e.g., structural decoupling such that $\\delta$ does not affect the observable).\n\nSimulation and unit requirements:\n- All times must be in days.\n- All rates ($r$, $k$, $\\alpha$, $\\delta$) must be in $\\mathrm{day}^{-1}$ or $\\mathrm{day}^{-1}\\,\\mathrm{cell}^{-1}$ as indicated.\n- All population counts ($N$, $E$, $K$, $N_0$, $E_0$) must be in cells.\n- Express all outputs as booleans indicating profile flatness, with no percentage signs.\n\nDiscretization for the profile:\n- Use a grid $\\mathcal{D}$ of $\\delta$ values uniformly spaced over the interval $[0.05,1.00]$ in $\\mathrm{day}^{-1}$, inclusive, with exactly $41$ points.\n- Use a nuisance grid $\\mathcal{G}$ composed of the Cartesian product of\n  - $k \\in \\{0.0, 1\\times 10^{-15}, 5\\times 10^{-15}, 1\\times 10^{-14}, 5\\times 10^{-14}\\}$,\n  - $\\alpha \\in \\{1\\times 10^{-15}, 5\\times 10^{-15}, 1\\times 10^{-14}, 5\\times 10^{-14}, 1\\times 10^{-13}\\}$,\n  - $E_0 \\in \\{1\\times 10^{5}, 2\\times 10^{5}, 5\\times 10^{5}, 1\\times 10^{6}, 2\\times 10^{6}\\}$.\n\nDeterministic observation construction: for each test case, the observed data $y_i$ must be generated by simulating the model under the true parameters, then adding a deterministic measurement deviation $e_i=\\sigma\\cdot 0.2\\cdot \\sin(0.3\\,t_i)$ (in cells) to each $N(t_i)$, i.e.,\n$$\ny_i \\;=\\; N_{\\theta^\\star}(t_i) \\;+\\; \\sigma\\cdot 0.2\\cdot \\sin(0.3\\,t_i),\n$$\nwhere $\\theta^\\star$ denotes the true parameter set for the test case.\n\nTest suite specification (three cases):\n- Case $1$ (informative data; expected non-flat profile):\n  - $r=0.30\\,\\mathrm{day}^{-1}$, $K=1\\times 10^{9}\\,\\mathrm{cells}$, $N_0=2\\times 10^{7}\\,\\mathrm{cells}$,\n  - $k_{\\mathrm{true}}=1\\times 10^{-14}\\,\\mathrm{day}^{-1}\\,\\mathrm{cell}^{-1}$, $\\alpha_{\\mathrm{true}}=5\\times 10^{-14}\\,\\mathrm{day}^{-1}\\,\\mathrm{cell}^{-1}$, $\\delta_{\\mathrm{true}}=0.25\\,\\mathrm{day}^{-1}$, $E_{0,\\mathrm{true}}=5\\times 10^{5}\\,\\mathrm{cells}$,\n  - Observation times $t_i$ are uniformly spaced: $t_i\\in\\{0,2,4,\\dots,40\\}\\,\\mathrm{days}$, i.e., $21$ points,\n  - $\\sigma=1\\times 10^{6}\\,\\mathrm{cells}$.\n- Case $2$ (data insufficiency; expected flat profile):\n  - $r=0.30\\,\\mathrm{day}^{-1}$, $K=1\\times 10^{9}\\,\\mathrm{cells}$, $N_0=2\\times 10^{7}\\,\\mathrm{cells}$,\n  - $k_{\\mathrm{true}}=1\\times 10^{-14}\\,\\mathrm{day}^{-1}\\,\\mathrm{cell}^{-1}$, $\\alpha_{\\mathrm{true}}=5\\times 10^{-14}\\,\\mathrm{day}^{-1}\\,\\mathrm{cell}^{-1}$, $\\delta_{\\mathrm{true}}=0.25\\,\\mathrm{day}^{-1}$, $E_{0,\\mathrm{true}}=3\\times 10^{5}\\,\\mathrm{cells}$,\n  - Observation times $t_i\\in\\{0,20,40\\}\\,\\mathrm{days}$, i.e., $3$ points,\n  - $\\sigma=1\\times 10^{7}\\,\\mathrm{cells}$.\n- Case $3$ (model redundancy; expected flat profile because $k_{\\mathrm{true}}=0$ decouples $N(t)$ from $E(t)$):\n  - $r=0.30\\,\\mathrm{day}^{-1}$, $K=1\\times 10^{9}\\,\\mathrm{cells}$, $N_0=2\\times 10^{7}\\,\\mathrm{cells}$,\n  - $k_{\\mathrm{true}}=0.0\\,\\mathrm{day}^{-1}\\,\\mathrm{cell}^{-1}$, $\\alpha_{\\mathrm{true}}=5\\times 10^{-14}\\,\\mathrm{day}^{-1}\\,\\mathrm{cell}^{-1}$, $\\delta_{\\mathrm{true}}=0.40\\,\\mathrm{day}^{-1}$, $E_{0,\\mathrm{true}}=5\\times 10^{5}\\,\\mathrm{cells}$,\n  - Observation times $t_i\\in\\{0,2,4,\\dots,40\\}\\,\\mathrm{days}$, i.e., $21$ points,\n  - $\\sigma=1\\times 10^{6}\\,\\mathrm{cells}$.\n\nAlgorithmic requirements:\n- Implement a fixed-step fourth-order Runge–Kutta scheme with step $\\Delta t=0.1\\,\\mathrm{days}$ to integrate the system from $t=0$ to the largest observation time in each case. At each requested $t_i$, return $N(t_i)$ by taking the nearest integration grid point to $t_i$ (ensure that $t_i/\\Delta t$ is rounded to the nearest integer).\n- For each case, construct the observed data $y_i$ as specified above from the true trajectory plus deterministic deviations.\n- For each case, compute $\\mathrm{NLL}_p(\\delta)$ over the specified grids and then evaluate $\\Delta(\\mathcal{D})$.\n- Classify each case as flat if $\\Delta(\\mathcal{D})<1.9207$, otherwise non-flat.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the three cases as a comma-separated list of booleans enclosed in square brackets, in the order of Cases $1$, $2$, and $3$, for example, `[True,False,True]`.", "solution": "The problem requires a profile likelihood analysis for the CAR-T cell death rate, $\\delta$, in a given two-state ordinary differential equation (ODE) model of tumor-immune dynamics. The validity of the problem statement has been confirmed as it is scientifically grounded, mathematically well-posed, and algorithmically specified with no internal contradictions.\n\nThe core of the task is to determine if the parameter $\\delta$ is identifiable under three different scenarios, corresponding to informative data, sparse data, and a structurally redundant model. Identifiability is assessed by computing the profile likelihood for $\\delta$ and checking if its range exceeds a statistically motivated threshold. A profile that is too \"flat\" signifies that the data and model cannot constrain the value of $\\delta$, rendering it non-identifiable.\n\nThe solution is structured as a series of computational steps for each test case, as outlined below.\n\n**1. The Mathematical Model**\n\nThe system's dynamics are described by two coupled ODEs for the tumor cell population $N(t)$ and CAR-T cell population $E(t)$:\n$$\n\\frac{dN}{dt} = r\\,N\\left(1-\\frac{N}{K}\\right) - k\\,E\\,N\n$$\n$$\n\\frac{dE}{dt} = \\alpha\\,N\\,E - \\delta\\,E\n$$\nThis is a predator-prey model, where tumor cells ($N$) are the prey and CAR-T cells ($E$) are the predators. The tumor grows logistically with rate $r$ and carrying capacity $K$. CAR-T cells kill tumor cells at a rate proportional to $k$ and the product of their populations (mass-action kinetics). The CAR-T population expands in response to tumor antigen presence at a rate proportional to $\\alpha$ and dies at a per-capita rate $\\delta$.\n\n**2. Numerical Integration Scheme**\n\nTo obtain the trajectories $N(t)$ and $E(t)$ for a given set of parameters $\\theta=(r,K,k,\\alpha,\\delta,N_0,E_0)$, we must solve this system of ODEs numerically. As stipulated, a fixed-step fourth-order Runge-Kutta (RK4) method is employed. Given the state vector $\\mathbf{y}(t) = [N(t), E(t)]^T$ and the ODE function $\\mathbf{f}(t, \\mathbf{y})$, one step of size $\\Delta t$ is computed as:\n$$\n\\mathbf{k}_1 = \\mathbf{f}(t, \\mathbf{y})\n$$\n$$\n\\mathbf{k}_2 = \\mathbf{f}\\left(t + \\frac{\\Delta t}{2}, \\mathbf{y} + \\frac{\\Delta t}{2}\\mathbf{k}_1\\right)\n$$\n$$\n\\mathbf{k}_3 = \\mathbf{f}\\left(t + \\frac{\\Delta t}{2}, \\mathbf{y} + \\frac{\\Delta t}{2}\\mathbf{k}_2\\right)\n$$\n$$\n\\mathbf{k}_4 = \\mathbf{f}\\left(t + \\Delta t, \\mathbf{y} + \\Delta t\\mathbf{k}_3\\right)\n$$\n$$\n\\mathbf{y}(t+\\Delta t) = \\mathbf{y}(t) + \\frac{\\Delta t}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n$$\nA fixed step size of $\\Delta t=0.1$ days is used. Crucially, after each integration step, the populations $N(t)$ and $E(t)$ are clipped to be non-negative, enforcing biological realism. Model predictions at observation times $t_i$ are retrieved by finding the solution at the integration time grid point closest to $t_i$.\n\n**3. Synthetic Data Generation**\n\nFor each test case, a synthetic \"observed\" dataset $\\{y_i\\}$ must be generated. This involves two steps:\n1.  Simulate the ODE model using the case-specific \"true\" parameters $\\theta^\\star = (r, K, k_{\\mathrm{true}}, \\alpha_{\\mathrm{true}}, \\delta_{\\mathrm{true}}, N_0, E_{0,\\mathrm{true}})$ to obtain the true tumor trajectory $N_{\\theta^\\star}(t_i)$.\n2.  Add a specified deterministic deviation to create the data points:\n    $$\n    y_i = N_{\\theta^\\star}(t_i) + \\sigma\\cdot 0.2\\cdot \\sin(0.3\\,t_i)\n    $$\nThis process yields a unique, reproducible dataset for each case against which model fits will be evaluated.\n\n**4. Profile Likelihood Calculation**\n\nThe central part of the analysis is the computation of the profiled negative log-likelihood, $\\mathrm{NLL}_p(\\delta)$. The negative log-likelihood (NLL) function, assuming independent Gaussian errors, quantifies the mismatch between model predictions $N_\\theta(t_i)$ and observed data $y_i$:\n$$\n\\mathrm{NLL}(\\theta) = \\sum_{i=1}^{m} \\frac{\\left(N_\\theta(t_i) - y_i\\right)^2}{2\\,\\sigma^2}\n$$\nThe profile for $\\delta$ is constructed by fixing $\\delta$ to a specific value from its grid $\\mathcal{D}$, and then finding the NLL value that results from the best-fitting combination of the nuisance parameters $(k, \\alpha, E_0)$ chosen from their discrete grid $\\mathcal{G}$. The fixed parameters for the profiling procedure are $r$, $K$, and $N_0$.\n$$\n\\mathrm{NLL}_p(\\delta) = \\min_{(k,\\alpha,E_0)\\in\\mathcal{G}} \\mathrm{NLL}\\big(r,K,k,\\alpha,\\delta,N_0,E_0\\big)\n$$\nThis procedure is repeated for every $\\delta \\in \\mathcal{D}$, yielding the entire profile $\\mathrm{NLL}_p$ as a function of $\\delta$.\n\n**5. Identifiability Assessment**\n\nThe final step is to determine if the profile is \"flat\". According to the likelihood-ratio test framework and Wilks' theorem, the confidence interval for a single parameter is defined by the points where the NLL increases by a certain threshold from its minimum. A non-identifiable parameter exhibits a very small change in likelihood across its range. The problem specifies a precise criterion:\n1.  Calculate the range of the profiled NLL over the grid $\\mathcal{D}$:\n    $$\n    \\Delta(\\mathcal{D}) = \\max_{\\delta\\in\\mathcal{D}} \\mathrm{NLL}_p(\\delta) - \\min_{\\delta\\in\\mathcal{D}} \\mathrm{NLL}_p(\\delta)\n    $$\n2.  Compare this range to the threshold derived from the chi-squared distribution, $\\frac{1}{2}\\chi^2_{1, 0.95} \\approx 1.9207$.\n3.  If $\\Delta(\\mathcal{D}) < 1.9207$, the profile is declared flat, and $\\delta$ is non-identifiable for that case. Otherwise, it is identifiable.\n\nThis entire procedure is implemented for each of the three test cases, which are designed to demonstrate how data quality (informative vs. sparse) and model structure (coupled vs. decoupled) impact parameter identifiability. Specifically, non-flatness is expected for Case 1 (informative data), while flatness is expected for Case 2 (insufficient data) and Case 3 (structural non-identifiability where $k=0$ decouples the measured variable $N$ from the parameter of interest $\\delta$). The final output is a boolean list indicating flatness for each case.", "answer": "```python\nimport numpy as np\n\n# Global constants as specified in the problem\nFLATNESS_THRESHOLD = 1.9207\n\n# Define the system of ordinary differential equations\ndef ode_system(t, y, r, K, k, alpha, delta):\n    \"\"\"\n    Defines the ODE system for tumor-CAR-T dynamics.\n    y: state vector [N, E]\n    t: time\n    params: r, K, k, alpha, delta\n    \"\"\"\n    N, E = y\n    dN_dt = r * N * (1.0 - N / K) - k * E * N\n    dE_dt = alpha * N * E - delta * E\n    return np.array([dN_dt, dE_dt])\n\ndef rk4_step(f, t, y, dt, params):\n    \"\"\"\n    Performs a single step of the fourth-order Runge-Kutta method.\n    \"\"\"\n    k1 = f(t, y, **params)\n    k2 = f(t + dt / 2.0, y + dt / 2.0 * k1, **params)\n    k3 = f(t + dt / 2.0, y + dt / 2.0 * k2, **params)\n    k4 = f(t + dt, y + dt * k3, **params)\n    y_next = y + (dt / 6.0) * (k1 + 2.0 * k2 + 2.0 * k3 + k4)\n    # Enforce non-negativity constraint\n    y_next[y_next < 0] = 0.0\n    return y_next\n\ndef solve_ode(params, t_obs):\n    \"\"\"\n    Solves the ODE system using RK4 and returns solutions at specified times.\n    \"\"\"\n    dt = 0.1\n    t_start = 0.0\n    t_end = np.max(t_obs)\n    \n    num_steps = int(np.ceil(t_end / dt))\n    t_grid = np.linspace(t_start, t_end, num_steps + 1)\n    \n    y0 = np.array([params['N0'], params['E0']])\n    y_trajectory = np.zeros((len(t_grid), 2))\n    y_trajectory[0] = y0\n    y_current = y0\n    \n    ode_params = {k: v for k, v in params.items() if k in ['r', 'K', 'k', 'alpha', 'delta']}\n\n    for i in range(num_steps):\n        t_current = t_grid[i]\n        y_current = rk4_step(ode_system, t_current, y_current, dt, ode_params)\n        y_trajectory[i+1] = y_current\n        \n    # Get N(t) at observation times by finding the nearest grid point\n    obs_indices = np.round(t_obs / dt).astype(int)\n    N_at_obs = y_trajectory[obs_indices, 0]\n    return N_at_obs\n\ndef calculate_nll(y_obs, y_model, sigma):\n    \"\"\"\n    Calculates the negative log-likelihood.\n    \"\"\"\n    return np.sum((y_model - y_obs)**2) / (2.0 * sigma**2)\n\ndef analyze_case(case_params, grids):\n    \"\"\"\n    Performs the full profile likelihood analysis for a single test case.\n    \"\"\"\n    # Unpack parameters\n    true_params = case_params['true']\n    fixed_params = case_params['fixed']\n    obs_config = case_params['obs']\n    \n    t_obs = obs_config['t_i']\n    sigma = obs_config['sigma']\n\n    # 1. Generate synthetic \"observed\" data\n    params_for_data_gen = {**fixed_params, **true_params}\n    # Ensure keys match solver expectations\n    params_for_data_gen['E0'] = params_for_data_gen.pop('E0_true')\n    \n    N_true = solve_ode(params_for_data_gen, t_obs)\n    deterministic_error = sigma * 0.2 * np.sin(0.3 * t_obs)\n    y_observed = N_true + deterministic_error\n\n    # 2. Perform Profile Likelihood analysis\n    delta_grid = grids['delta']\n    k_grid = grids['k']\n    alpha_grid = grids['alpha']\n    E0_grid = grids['E0']\n    \n    profiled_nll_values = []\n\n    for delta_val in delta_grid:\n        min_nll_for_delta = np.inf\n        \n        # Grid search over nuisance parameters\n        for k_val in k_grid:\n            for alpha_val in alpha_grid:\n                for E0_val in E0_grid:\n                    # Construct current parameter set for simulation\n                    current_params = {\n                        **fixed_params,\n                        'k': k_val,\n                        'alpha': alpha_val,\n                        'delta': delta_val,\n                        'E0': E0_val\n                    }\n                    \n                    # Solve ODE with current parameter set\n                    N_model = solve_ode(current_params, t_obs)\n                    \n                    # Calculate NLL\n                    nll = calculate_nll(y_observed, N_model, sigma)\n                    \n                    if nll < min_nll_for_delta:\n                        min_nll_for_delta = nll\n\n        profiled_nll_values.append(min_nll_for_delta)\n\n    # 3. Assess profile flatness\n    profiled_nll_values = np.array(profiled_nll_values)\n    delta_nll = np.max(profiled_nll_values) - np.min(profiled_nll_values)\n    \n    is_flat = delta_nll < FLATNESS_THRESHOLD\n    return is_flat\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run analysis, and print results.\n    \"\"\"\n    # Define test cases from the problem statement.\n    test_cases = [\n        {\n            # Case 1: Informative data\n            'fixed': {'r': 0.30, 'K': 1e9, 'N0': 2e7},\n            'true': {'k': 1e-14, 'alpha': 5e-14, 'delta': 0.25, 'E0_true': 5e5},\n            'obs': {'t_i': np.arange(0, 40.1, 2), 'sigma': 1e6}\n        },\n        {\n            # Case 2: Data insufficiency\n            'fixed': {'r': 0.30, 'K': 1e9, 'N0': 2e7},\n            'true': {'k': 1e-14, 'alpha': 5e-14, 'delta': 0.25, 'E0_true': 3e5},\n            'obs': {'t_i': np.array([0., 20., 40.]), 'sigma': 1e7}\n        },\n        {\n            # Case 3: Model redundancy\n            'fixed': {'r': 0.30, 'K': 1e9, 'N0': 2e7},\n            'true': {'k': 0.0, 'alpha': 5e-14, 'delta': 0.40, 'E0_true': 5e5},\n            'obs': {'t_i': np.arange(0, 40.1, 2), 'sigma': 1e6}\n        }\n    ]\n\n    # Define discretization grids\n    grids = {\n        'delta': np.linspace(0.05, 1.00, 41),\n        'k': np.array([0.0, 1e-15, 5e-15, 1e-14, 5e-14]),\n        'alpha': np.array([1e-15, 5e-15, 1e-14, 5e-14, 1e-13]),\n        'E0': np.array([1e5, 2e5, 5e5, 1e6, 2e6])\n    }\n    \n    results = []\n    for case in test_cases:\n        is_flat = analyze_case(case, grids)\n        results.append(is_flat)\n\n    # Format output as specified, converting booleans to lowercase strings for Python's print\n    py_bool_to_js_bool = lambda b: str(b).lower()\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "4361810"}]}