{"hands_on_practices": [{"introduction": "The first step in connectome analysis is constructing an accurate representation of the brain's network. This practice addresses a critical challenge in diffusion MRI-based tractography, where partial volume effects at the boundary of different tissue types can create false, or spurious, connections. By working through this problem, you will learn to identify how artifacts arise from the underlying signal model and, more importantly, how to apply anatomically-informed corrections to enhance the biological plausibility of your structural connectome [@problem_id:4322117].", "problem": "In diffusion Magnetic Resonance Imaging (dMRI) based tractography for brain connectome analysis, edges are inferred by propagating streamlines through an estimated directional field, often the Fiber Orientation Distribution (FOD), under algorithmic constraints such as an angular deviation threshold and an amplitude threshold. Consider a measurement model in which the diffusion-weighted signal in a voxel is a mixture of contributions from white matter and cerebrospinal fluid (CSF), represented as\n$$\nS(b,\\mathbf{g}) \\;=\\; S_0\\Big[f_{\\mathrm{WM}}\\exp\\!\\big(-b\\,\\mathbf{g}^\\top\\mathbf{D}_{\\mathrm{WM}}\\mathbf{g}\\big) \\;+\\; f_{\\mathrm{CSF}}\\exp\\!\\big(-b\\,D_{\\mathrm{iso}}\\big)\\Big],\n$$\nwhere $b$ is the diffusion weighting, $\\mathbf{g}$ is the unit gradient direction, $S_0$ is the non-diffusion-weighted signal, $f_{\\mathrm{WM}}$ and $f_{\\mathrm{CSF}}$ are tissue fractions satisfying $f_{\\mathrm{WM}}+f_{\\mathrm{CSF}}=1$, $\\mathbf{D}_{\\mathrm{WM}}$ is an anisotropic diffusion tensor aligned with the local white matter orientation, and $D_{\\mathrm{iso}}$ is an isotropic diffusivity representative of CSF. Suppose two adjacent voxels straddling the interhemispheric fissure have partial volumes such that each contains white matter from its respective hemisphere that runs approximately tangential to the fissure (i.e., oriented anterior–posterior), as well as CSF from the fissure itself. The tractography algorithm seeds streamlines from left-hemisphere cortex and selects propagation directions from the FOD, constrained by a maximum angular deviation $\\,\\theta_{\\max}\\,$ and an amplitude threshold $\\,\\tau\\,$.\n\nYour task is to identify a valid counterexample demonstrating that partial volume effects can create spurious inter-hemispheric streamlines that do not traverse the corpus callosum, and to propose a correction grounded in anatomical priors or exclusion masks. Use first principles from the multi-compartment signal model above to reason about how mixed anisotropic–isotropic signals can yield FOD features that misguidedly support streamline propagation across CSF. Parameters are plausible and scientifically realistic. White matter anisotropy can be quantified by a diffusion tensor with principal diffusivities $\\,d_{\\parallel}=1.7\\times 10^{-3}\\,\\mathrm{mm}^2/\\mathrm{s}\\,$ and $\\,d_{\\perp}=0.3\\times 10^{-3}\\,\\mathrm{mm}^2/\\mathrm{s}\\,$ aligned with the local white matter axis, while CSF is modeled with $\\,D_{\\mathrm{iso}}=3.0\\times 10^{-3}\\,\\mathrm{mm}^2/\\mathrm{s}\\,$. Consider single-shell acquisitions with $\\,b=1000\\,\\mathrm{s/mm^2}\\,$, voxel size $\\,2\\,\\mathrm{mm}\\,$ isotropic, and a single-tissue Constrained Spherical Deconvolution (CSD) FOD estimator. A streamline propagator uses maximum angular deviation $\\,\\theta_{\\max}=60^\\circ\\,$ and amplitude threshold $\\,\\tau=0.1\\,$. Anatomically Constrained Tractography (ACT) refers to enforcing tissue-type constraints derived from structural segmentation, such that streamlines are permitted to propagate in white matter and terminate in cortical gray matter, and are prohibited from entering CSF; exclusion masks are regions streamlines are not allowed to traverse; waypoint regions of interest (ROIs) enforce that streamlines must pass through designated anatomy.\n\nSelect the option that presents a scientifically coherent counterexample (consistent with the model above) where partial volume effects plausibly yield spurious inter-hemispheric connections, along with a correction that uses anatomical priors or exclusion masks to specifically remove such artifacts without destroying legitimate callosal connectivity.\n\nA. Two midsagittal voxels along the interhemispheric fissure each have $\\,f_{\\mathrm{WM}}=0.55\\,$ with white matter oriented approximately anterior–posterior in the respective hemisphere and $\\,f_{\\mathrm{CSF}}=0.45\\,$ from the fissure. With single-tissue CSD at $\\,b=1000\\,\\mathrm{s/mm^2}\\,$ and $\\,2\\,\\mathrm{mm}\\,$ voxels, the FOD exhibits a broad primary lobe aligned anterior–posterior and a minor medial lobe due to the isotropic mixture and deconvolution regularization. Deterministic tracking with $\\,\\theta_{\\max}=60^\\circ\\,$ and $\\,\\tau=0.1\\,$ seeds in the left superior frontal gyrus and follows the minor medial lobe across the fissure into the right voxel, producing inter-hemispheric streamlines that do not traverse the corpus callosum. Correction: perform Anatomically Constrained Tractography (ACT) using tissue-type priors from T$\\,1\\,$-weighted segmentation, add an exclusion mask covering the interhemispheric fissure (CSF), and impose a corpus callosum waypoint ROI for any inter-hemispheric edge, thereby removing CSF-crossing streamlines while preserving legitimate callosal connections.\n\nB. Eddy-current distortions align gradient directions across hemispheres, causing streamlines to bridge left–right through CSF even without partial volume. Correction: apply eddy-current correction to the diffusion data, which eliminates the spurious inter-hemispheric edges without using anatomical priors.\n\nC. Using probabilistic tracking without an angular constraint, streamlines wander across the midline anywhere, generating spurious inter-hemispheric connections irrespective of tissue composition. Correction: reduce $\\,\\theta_{\\max}\\,$ to $\\,30^\\circ\\,$ and increase $\\,\\tau\\,$ to $\\,0.2\\,$; no anatomical masks or priors are needed to remove midline artifacts.\n\nD. Multi-tissue CSD with $\\,b=1000\\,\\mathrm{s/mm^2}\\,$ and $\\,2\\,\\mathrm{mm}\\,$ voxels produces spurious inter-hemispheric connections because it overfits CSF. Correction: smooth the FOD angular profile with a strong regularizer so minor peaks vanish; anatomical exclusion masks are unnecessary if the FOD is smooth enough.", "solution": "The core of the problem lies in how a single-tissue Constrained Spherical Deconvolution (CSD) algorithm interprets the diffusion signal from a voxel containing a mixture of white matter (WM) and cerebrospinal fluid (CSF).\n\nThe signal in such a voxel is given by:\n$$\nS(b,\\mathbf{g}) \\;=\\; S_0\\Big[f_{\\mathrm{WM}}\\exp\\!\\big(-b\\,\\mathbf{g}^\\top\\mathbf{D}_{\\mathrm{WM}}\\mathbf{g}\\big) \\;+\\; f_{\\mathrm{CSF}}\\exp\\!\\big(-b\\,D_{\\mathrm{iso}}\\big)\\Big]\n$$\nThe first term represents the anisotropic signal contribution from WM, while the second term represents the isotropic signal from CSF.\n\nLet's analyze the signal attenuation for the given parameters at $b=1000\\,\\mathrm{s/mm^2}$.\n-   For WM, the signal depends on the angle between the fiber orientation (anterior-posterior) and the gradient direction $\\mathbf{g}$.\n    -   When $\\mathbf{g}$ is parallel to the fibers, attenuation is maximal: $\\exp(-b d_{\\parallel}) = \\exp(-1000 \\times 1.7\\times 10^{-3}) = \\exp(-1.7) \\approx 0.183$.\n    -   When $\\mathbf{g}$ is perpendicular to the fibers, attenuation is minimal: $\\exp(-b d_{\\perp}) = \\exp(-1000 \\times 0.3\\times 10^{-3}) = \\exp(-0.3) \\approx 0.741$.\n-   For CSF, the signal is isotropic (independent of $\\mathbf{g}$) and highly attenuated due to its high diffusivity:\n    -   Attenuation is $\\exp(-b D_{\\mathrm{iso}}) = \\exp(-1000 \\times 3.0\\times 10^{-3}) = \\exp(-3.0) \\approx 0.050$.\n\nA single-tissue CSD algorithm is fundamentally misspecified for this signal. It operates under the assumption that the entire signal $S(b,\\mathbf{g})$ arises from a convolution of a single WM \"response function\" $R_{\\mathrm{WM}}(\\mathbf{g})$ with the underlying Fiber Orientation Distribution $FOD(\\mathbf{g})$. The response function $R_{\\mathrm{WM}}(\\mathbf{g})$ is highly anisotropic, resembling the signal from a coherently oriented bundle of fibers.\n\nThe algorithm attempts to deconvolve the measured signal to find the FOD:\n$$\nFOD = \\mathrm{deconvolve}(S, R_{\\mathrm{WM}})\n$$\nIn our voxel, the signal is a sum of an anisotropic WM component and an isotropic CSF component. The deconvolution process will correctly attribute the anisotropic part of the signal to a large FOD lobe in the anterior-posterior (A-P) direction. However, it must also account for the isotropic contribution from CSF, i.e., the term $f_{\\mathrm{CSF}}\\exp(-b\\,D_{\\mathrm{iso}})$. Because the algorithm's only tool is the anisotropic response function $R_{\\mathrm{WM}}$, it will attempt to explain this constant, isotropic signal floor by positing the existence of WM fibers oriented in various directions. Due to regularization and numerical properties of the deconvolution, this often manifests not as a perfectly uniform distribution, but as spurious, smaller lobes in directions orthogonal to the main fiber population.\n\nIn the scenario described—a voxel at the interhemispheric fissure with A-P oriented fibers—the main FOD lobe will be A-P. The isotropic CSF contamination will cause the CSD algorithm to generate artifactual FOD amplitude in other directions, including the medial-lateral direction. This can result in a \"minor medial lobe\" pointing across the fissure.\n\nNow, consider the tractography algorithm with $\\theta_{\\max}=60^\\circ$ and $\\tau=0.1$. A streamline propagating along the A-P tract reaches this voxel. The propagator evaluates possible next steps based on the local FOD. It sees the main A-P lobe and the spurious medial lobe. If the amplitude of this medial lobe exceeds the threshold $\\tau=0.1$, it is considered a potential path. If the angle between the current A-P direction and the new medial direction is less than $\\theta_{\\max}=60^\\circ$, the turn is valid. While a perfect $90^\\circ$ turn would be rejected, the spurious lobe may be broad or deflected, allowing the algorithm to find a valid turning angle. If so, the streamline will erroneously \"jump\" across the CSF-filled fissure into the adjacent voxel, creating a spurious inter-hemispheric connection that does not traverse the corpus callosum.\n\n### Option-by-Option Analysis\n\n**A. Two midsagittal voxels along the interhemispheric fissure each have $\\,f_{\\mathrm{WM}}=0.55\\,$ with white matter oriented approximately anterior–posterior in the respective hemisphere and $\\,f_{\\mathrm{CSF}}=0.45\\,$ from the fissure. With single-tissue CSD at $\\,b=1000\\,\\mathrm{s/mm^2}\\,$ and $\\,2\\,\\mathrm{mm}\\,$ voxels, the FOD exhibits a broad primary lobe aligned anterior–posterior and a minor medial lobe due to the isotropic mixture and deconvolution regularization. Deterministic tracking with $\\,\\theta_{\\max}=60^\\circ\\,$ and $\\,\\tau=0.1\\,$ seeds in the left superior frontal gyrus and follows the minor medial lobe across the fissure into the right voxel, producing inter-hemispheric streamlines that do not traverse the corpus callosum. Correction: perform Anatomically Constrained Tractography (ACT) using tissue-type priors from T$\\,1\\,$-weighted segmentation, add an exclusion mask covering the interhemispheric fissure (CSF), and impose a corpus callosum waypoint ROI for any inter-hemispheric edge, thereby removing CSF-crossing streamlines while preserving legitimate callosal connections.**\n\nThis option accurately describes the mechanism derived above. The partial volume fractions ($f_{\\mathrm{WM}}=0.55, f_{\\mathrm{CSF}}=0.45$) represent significant contamination. The description of the resulting FOD (major A-P lobe, minor medial lobe) and the behavior of the tractography algorithm are fully consistent with the principles of single-tissue CSD and streamline propagation. The proposed correction is a multi-pronged, state-of-the-art approach that is specifically designed to eliminate this type of artifact: ACT prevents propagation in CSF, the exclusion mask explicitly forbids crossing the fissure, and the waypoint ROI ensures that any interhemispheric fibers follow known anatomy (the corpus callosum). This set of corrections is specific and effective.\n\nVerdict: **Correct**.\n\n**B. Eddy-current distortions align gradient directions across hemispheres, causing streamlines to bridge left–right through CSF even without partial volume. Correction: apply eddy-current correction to the diffusion data, which eliminates the spurious inter-hemispheric edges without using anatomical priors.**\n\nThis option misdiagnoses the problem. While eddy-current distortions are a significant source of artifacts in dMRI, they primarily cause geometric distortions and intensity modulations that lead to misalignment between gradient volumes. They do not typically create spurious, coherent FOD lobes pointing medially, especially \"even without partial volume\". The problem is explicitly framed around a partial volume model, which is the direct cause of the artifact in question. Furthermore, eddy-current correction is a necessary preprocessing step, but it would not solve the partial volume artifact, which would persist even in perfectly corrected data.\n\nVerdict: **Incorrect**.\n\n**C. Using probabilistic tracking without an angular constraint, streamlines wander across the midline anywhere, generating spurious inter-hemispheric connections irrespective of tissue composition. Correction: reduce $\\,\\theta_{\\max}\\,$ to $\\,30^\\circ\\,$ and increase $\\,\\tau\\,$ to $\\,0.2\\,$; no anatomical masks or priors are needed to remove midline artifacts.**\n\nThis option alters the premises of the problem. It replaces the specified deterministic algorithm with constrained propagation with \"probabilistic tracking without an angular constraint\". While it is true that overly permissive probabilistic tracking can create spurious connections, this is not the mechanism described in the problem statement. The proposed correction—globally tightening algorithmic thresholds—is a non-specific remedy that would likely prune valid, highly-curving tracts elsewhere in the brain, failing the requirement to \"not destroy legitimate... connectivity.\" The assertion that \"no anatomical masks or priors are needed\" is contrary to best practices for handling tissue-boundary artifacts.\n\nVerdict: **Incorrect**.\n\n**D. Multi-tissue CSD with $\\,b=1000\\,\\mathrm{s/mm^2}\\,$ and $\\,2\\,\\mathrm{mm}\\,$ voxels produces spurious inter-hemispheric connections because it overfits CSF. Correction: smooth the FOD angular profile with a strong regularizer so minor peaks vanish; anatomical exclusion masks are unnecessary if the FOD is smooth enough.**\n\nThis option makes a statement that is the opposite of the established science. Multi-tissue CSD is an advanced technique specifically developed to *solve* the problem of partial volume with CSF, not to cause it. It uses separate response functions for WM and CSF, allowing it to correctly attribute the isotropic signal component to the CSF compartment, resulting in a \"cleaner\" WM FOD that is *less* likely to have spurious lobes. The premise that multi-tissue CSD creates the artifact is fundamentally wrong. The proposed correction (strong smoothing) is, like in option C, a non-specific approach that degrades the overall quality and angular resolution of the FOD.\n\nVerdict: **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "4322117"}, {"introduction": "Once a connectome is constructed, we characterize its properties using network metrics. However, these metrics are estimates derived from noisy data and are subject to uncertainty. This exercise demonstrates how to quantify the reliability of a fundamental nodal metric, strength, by propagating uncertainty from individual edge weights using a statistically robust bootstrap procedure and the delta method, teaching a crucial skill for assessing the confidence of your connectome findings [@problem_id:4322092].", "problem": "You are analyzing a functional brain connectome constructed from resting-state functional magnetic resonance imaging (rs-fMRI) time series data. Each node corresponds to a cortical region, and each undirected edge between nodes corresponds to the sample Pearson correlation coefficient computed between the regional time series. Suppose the time series for each region has length $T$ and exhibits temporal autocorrelation. You decide to quantify uncertainty in edge weights via a circular block bootstrap with fixed block length $b$, resampling blocks of time points to construct bootstrap replicates of the correlation estimator for each edge.\n\nUse the following foundational facts as your starting point: under joint Gaussianity and independent sampling, the Fisher $z$-transform $z = \\operatorname{arctanh}(r)$ of the sample Pearson correlation $r$ is approximately normally distributed with variance $\\operatorname{Var}(z) \\approx 1/(n-3)$, where $n$ is the effective number of independent observations. In the presence of temporal autocorrelation, the circular block bootstrap with block length $b$ induces an effective sample size $n_{\\text{eff}} = T/b$ for estimating the sampling variability of $z$.\n\nDefine the node strength of node $i$ as $s_i = \\sum_{j \\neq i} r_{ij}$, where $r_{ij}$ is the correlation-based edge weight connecting node $i$ to node $j$. To aggregate edge-level uncertainty into a node-level reliability metric, define the reliability of node $i$ as $R_i = s_i^2 / \\operatorname{Var}(s_i)$, where $\\operatorname{Var}(s_i)$ is obtained by propagating the bootstrap-estimated edge variances to the sum $s_i$ under the approximation that bootstrap Fisher $z$-replicates are independent across edges incident to node $i$.\n\nDerive, from first principles and the stated foundations, a closed-form analytic expression for $R_i$ in terms of $T$, $b$, and the edge weights $r_{ij}$. Then, for a specific node $i$ with three incident edges having weights $r_{i1} = 0.4$, $r_{i2} = 0.2$, and $r_{i3} = 0.5$, with time series length $T = 240$ and block length $b = 5$, compute the numerical value of $R_i$. Round your final numerical answer to four significant figures and express it as a dimensionless quantity.", "solution": "The solution requires deriving a closed-form analytic expression for the node reliability metric, $R_i$, and then calculating its numerical value for the given parameters. The derivation proceeds by systematically applying the definitions and foundational facts provided.\n\n**Derivation of the analytic expression for $R_i$**\n\nThe definition of node reliability is given as:\n$$R_i = \\frac{s_i^2}{\\operatorname{Var}(s_i)}$$\nThe numerator is the square of the node strength, $s_i = \\sum_{j \\neq i} r_{ij}$. Therefore, the numerator is $\\left(\\sum_{j \\neq i} r_{ij}\\right)^2$.\n\nThe denominator is the variance of the node strength, $\\operatorname{Var}(s_i) = \\operatorname{Var}\\left(\\sum_{j \\neq i} r_{ij}\\right)$. To compute this, we must propagate the uncertainty from the individual edge weights, $r_{ij}$. The problem states to assume that the Fisher $z$-transformed bootstrap replicates, $z_{ij} = \\operatorname{arctanh}(r_{ij})$, are independent across edges incident to node $i$ (i.e., for a fixed node $i$ and varying $j$). Independence of the random variables $z_{ij}$ implies independence of any deterministic functions of these variables. Since $r_{ij} = \\tanh(z_{ij})$, the correlation estimators $r_{ij}$ (for a fixed $i$) are also treated as independent for the purpose of variance propagation. For independent random variables, the variance of the sum is the sum of the variances:\n$$\\operatorname{Var}(s_i) = \\operatorname{Var}\\left(\\sum_{j \\neq i} r_{ij}\\right) = \\sum_{j \\neq i} \\operatorname{Var}(r_{ij})$$\nNext, we determine $\\operatorname{Var}(r_{ij})$. The problem states that the variance of the Fisher-transformed correlation, $z_{ij}$, is $\\operatorname{Var}(z_{ij}) \\approx \\frac{1}{n-3}$. The effective sample size, $n$, is given by the block bootstrap parameters as $n = n_{\\text{eff}} = T/b$. Thus, the variance for each $z_{ij}$ is approximately:\n$$\\operatorname{Var}(z_{ij}) \\approx \\frac{1}{\\frac{T}{b} - 3}$$\nTo find the variance of $r_{ij}$ from the variance of $z_{ij}$, we use the delta method (a first-order Taylor expansion for propagation of uncertainty). Given the transformation $r_{ij} = \\tanh(z_{ij})$, the variance of $r_{ij}$ can be approximated as:\n$$\\operatorname{Var}(r_{ij}) \\approx \\left(\\frac{d r_{ij}}{d z_{ij}}\\right)^2 \\operatorname{Var}(z_{ij})$$\nThe derivative is evaluated at the mean of $z_{ij}$, which is assumed to be the observed value $z_{ij} = \\operatorname{arctanh}(r_{ij})$. The derivative of $\\tanh(x)$ with respect to $x$ is $\\operatorname{sech}^2(x) = 1 - \\tanh^2(x)$.\n$$\\frac{d r_{ij}}{d z_{ij}} = \\frac{d}{d z_{ij}} \\tanh(z_{ij}) = 1 - \\tanh^2(z_{ij})$$\nEvaluating at $z_{ij} = \\operatorname{arctanh}(r_{ij})$, the derivative becomes $1 - \\tanh^2(\\operatorname{arctanh}(r_{ij})) = 1 - r_{ij}^2$.\nSubstituting this into the variance approximation for $r_{ij}$:\n$$\\operatorname{Var}(r_{ij}) \\approx \\left(1 - r_{ij}^2\\right)^2 \\operatorname{Var}(z_{ij}) = \\left(1 - r_{ij}^2\\right)^2 \\left(\\frac{1}{\\frac{T}{b} - 3}\\right)$$\nNow we can compute the variance of the node strength, $\\operatorname{Var}(s_i)$:\n$$\\operatorname{Var}(s_i) = \\sum_{j \\neq i} \\operatorname{Var}(r_{ij}) = \\sum_{j \\neq i} \\left(1 - r_{ij}^2\\right)^2 \\left(\\frac{1}{\\frac{T}{b} - 3}\\right)$$\nWe can factor out the term that does not depend on the summation index $j$:\n$$\\operatorname{Var}(s_i) = \\left(\\frac{1}{\\frac{T}{b} - 3}\\right) \\sum_{j \\neq i} \\left(1 - r_{ij}^2\\right)^2$$\nFinally, we substitute the expressions for the numerator and denominator back into the definition of $R_i$:\n$$R_i = \\frac{\\left(\\sum_{j \\neq i} r_{ij}\\right)^2}{\\left(\\frac{1}{\\frac{T}{b} - 3}\\right) \\sum_{j \\neq i} \\left(1 - r_{ij}^2\\right)^2}$$\nSimplifying this expression yields the final closed-form analytic expression for node reliability:\n$$R_i = \\left(\\frac{T}{b} - 3\\right) \\frac{\\left(\\sum_{j \\neq i} r_{ij}\\right)^2}{\\sum_{j \\neq i} \\left(1 - r_{ij}^2\\right)^2}$$\n\n**Numerical Calculation**\n\nWe are given the following values for a specific node $i$:\n-   Time series length: $T = 240$\n-   Bootstrap block length: $b = 5$\n-   Incident edge weights: $r_{i1} = 0.4$, $r_{i2} = 0.2$, $r_{i3} = 0.5$.\n\nFirst, we calculate the effective sample size factor:\n$$\\frac{T}{b} - 3 = \\frac{240}{5} - 3 = 48 - 3 = 45$$\nNext, we calculate the squared node strength, which is the numerator of the fraction:\n$$s_i = \\sum_{j \\neq i} r_{ij} = 0.4 + 0.2 + 0.5 = 1.1$$\n$$s_i^2 = (1.1)^2 = 1.21$$\nNext, we calculate the sum in the denominator of the fraction:\n$$\\sum_{j \\neq i} \\left(1 - r_{ij}^2\\right)^2 = \\left(1 - (0.4)^2\\right)^2 + \\left(1 - (0.2)^2\\right)^2 + \\left(1 - (0.5)^2\\right)^2$$\n$$= \\left(1 - 0.16\\right)^2 + \\left(1 - 0.04\\right)^2 + \\left(1 - 0.25\\right)^2$$\n$$= (0.84)^2 + (0.96)^2 + (0.75)^2$$\n$$= 0.7056 + 0.9216 + 0.5625 = 2.1897$$\nFinally, we combine these components to compute $R_i$:\n$$R_i = 45 \\times \\frac{1.21}{2.1897} = \\frac{54.45}{2.1897} \\approx 24.866419...$$\nThe problem requires rounding the final answer to four significant figures.\n$$R_i \\approx 24.87$$\nThe quantity is dimensionless, as $s_i^2$ and $\\operatorname{Var}(s_i)$ have the same units of (correlation squared).", "answer": "$$\n\\boxed{24.87}\n$$", "id": "4322092"}, {"introduction": "A primary goal of connectomics is to discover how brain networks differ across populations, such as in clinical studies. This requires performing statistical tests on thousands of edges simultaneously, creating a massive multiple comparisons problem. This practice guides you through the entire statistical workflow, from deriving valid $p$-values using non-parametric permutation testing to controlling the False Discovery Rate (FDR) with the Benjamini-Hochberg procedure, ensuring your scientific conclusions are statistically sound [@problem_id:4322084].", "problem": "Consider a functional brain connectome constructed from resting-state functional magnetic resonance imaging time series. For each subject, the functional connectivity between two regions is quantified as the Pearson correlation coefficient $r$, which is then stabilized via the Fisher $z$ transformation $z = \\frac{1}{2}\\ln\\!\\left(\\frac{1+r}{1-r}\\right)$. Two independent cohorts are studied: group $\\mathcal{G}_A$ with $n_A = 10$ subjects and group $\\mathcal{G}_B$ with $n_B = 10$ subjects. The connectome comprises $p = 4$ cortical regions labeled $R_1, R_2, R_3, R_4$, yielding $m = \\binom{4}{2} = 6$ undirected edges: $(R_1,R_2)$, $(R_1,R_3)$, $(R_1,R_4)$, $(R_2,R_3)$, $(R_2,R_4)$, $(R_3,R_4)$.\n\nFor each edge $e$, define the group mean difference of Fisher $z$-transformed connectivity as $d_e = \\bar{z}_A(e) - \\bar{z}_B(e)$, where $\\bar{z}_A(e)$ and $\\bar{z}_B(e)$ are the across-subject means in $\\mathcal{G}_A$ and $\\mathcal{G}_B$, respectively. The observed differences are:\n- $(R_1,R_2)$: $d_{12} = 0.23$;\n- $(R_1,R_3)$: $d_{13} = 0.11$;\n- $(R_1,R_4)$: $d_{14} = 0.34$;\n- $(R_2,R_3)$: $d_{23} = 0.19$;\n- $(R_2,R_4)$: $d_{24} = 0.08$;\n- $(R_3,R_4)$: $d_{34} = 0.12$.\n\nTo test for edge-wise group differences under the null hypothesis that group labels are exchangeable (no group effect), a Monte Carlo permutation scheme is performed with $N_{\\text{perm}} = 999$ random label permutations across the $n_A + n_B = 20$ subjects. For each permutation $\\pi$, recompute $d_e^{(\\pi)}$ for all edges. The two-sided extremal counts $b_e$ are recorded as the number of permutations with $|d_e^{(\\pi)}| \\ge |d_e|$. The recorded extremal counts are:\n- $(R_1,R_2)$: $b_{12} = 3$;\n- $(R_1,R_3)$: $b_{13} = 20$;\n- $(R_1,R_4)$: $b_{14} = 0$;\n- $(R_2,R_3)$: $b_{23} = 8$;\n- $(R_2,R_4)$: $b_{24} = 31$;\n- $(R_3,R_4)$: $b_{34} = 17$.\n\nStarting only from the principles of exchangeability under the null and the definition of empirical tail probabilities, derive the exact form of the permutation test $p$-value for each edge. Then, starting only from the definition of the False Discovery Rate (FDR) as the expected proportion of false discoveries among all discoveries and the step-up control logic of the Benjamini-Hochberg False Discovery Rate (FDR) procedure, derive the Benjamini-Hochberg adjusted $q$-values for a set of $m$ edge-wise $p$-values. Using these derivations, compute the Benjamini-Hochberg $q$-value for the edge $(R_2,R_4)$ given the data above. Provide the final value as an exact decimal. If you perform any rounding, round to four significant figures and state the rounding step explicitly; otherwise, report the exact value.", "solution": "The solution involves three main parts: first, deriving the formula for the permutation test $p$-value; second, outlining the logic of the Benjamini-Hochberg (BH) False Discovery Rate (FDR) adjustment; and third, applying these to calculate the BH-adjusted $q$-value for the edge $(R_2, R_4)$.\n\n**Part 1: Derivation of the Permutation Test $p$-value**\n\nThe null hypothesis, $H_0$, posits that there is no true difference between group $\\mathcal{G}_A$ and group $\\mathcal{G}_B$, meaning the subject labels are exchangeable. Under $H_0$, the observed test statistic, $d_e = \\bar{z}_A(e) - \\bar{z}_B(e)$, for any edge $e$, is simply one realization from the distribution of all possible test statistics that would be obtained by permuting the group labels among the $n_A + n_B = 20$ subjects.\n\nA permutation test approximates this full permutation distribution by generating a large number of random permutations. Here, $N_{\\text{perm}} = 999$ random permutations of the group labels are generated. For each permutation $\\pi$, a new test statistic $d_e^{(\\pi)}$ is computed.\n\nThe empirical null distribution for edge $e$ is formed by the collection of these permuted statistics along with the original, observed statistic. The total size of this reference set is $N_{\\text{perm}} + 1$.\n\nThe $p$-value is defined as the probability of observing a test statistic at least as extreme as the one actually observed, assuming $H_0$ is true. For a two-sided test, \"extremity\" is measured by the absolute value of the statistic. The observed statistic is $d_e$, and its extremity is $|d_e|$. The permuted statistics are $d_e^{(\\pi)}$, with extremities $|d_e^{(\\pi)}|$.\n\nThe problem provides $b_e$, the number of permutations where the permuted statistic was at least as extreme as the observed one:\n$$b_e = \\sum_{\\pi=1}^{N_{\\text{perm}}} \\mathbb{I}(|d_e^{(\\pi)}| \\ge |d_e|)$$\nwhere $\\mathbb{I}(\\cdot)$ is the indicator function.\n\nTo calculate the $p$-value, we count how many elements in the empirical null distribution (of size $N_{\\text{perm}} + 1$) are as or more extreme than the observed statistic. This count includes the $b_e$ permutations and the observed statistic itself, as $|d_e| \\ge |d_e|$ is always true. Thus, the total count of equally or more extreme values is $b_e + 1$.\n\nThe empirical $p$-value is the ratio of this count to the total number of elements in the reference distribution. Therefore, the exact form of the permutation test $p$-value for edge $e$ is:\n$$p_e = \\frac{b_e + 1}{N_{\\text{perm}} + 1}$$\nThis formulation, including the $+1$ in both the numerator and denominator, is standard practice to ensure the $p$-value is well-behaved, bounded between $\\frac{1}{N_{\\text{perm}}+1}$ and $1$, and avoids a $p$-value of $0$.\n\n**Part 2: Derivation of the Benjamini-Hochberg (BH) FDR Procedure**\n\nWhen performing multiple hypothesis tests, as is the case here with $m=6$ edges, we must correct for the increased probability of making a Type I error. The False Discovery Rate (FDR) is the expected proportion of false discoveries (erroneously rejected null hypotheses, or Type I errors) among all discoveries (all rejected null hypotheses). Let $V$ be the number of false discoveries and $R$ be the total number of discoveries. The False Discovery Proportion is $FDP = V/R$ (defined as $0$ if $R=0$), and $FDR = E[FDP]$.\n\nThe Benjamini-Hochberg (BH) procedure provides control over the FDR at a specified level $\\alpha$. The \"step-up\" procedure works as follows:\n1.  Given a set of $m$ $p$-values, $\\{p_1, p_2, \\ldots, p_m\\}$, sort them in ascending order: $p_{(1)} \\le p_{(2)} \\le \\ldots \\le p_{(m)}$. Let $H_{(i)}$ be the null hypothesis corresponding to the $p$-value $p_{(i)}$.\n2.  To control FDR at level $\\alpha$, find the largest index $k$ such that $p_{(k)} \\le \\frac{k}{m} \\alpha$.\n3.  Reject all null hypotheses $H_{(i)}$ for $i = 1, 2, \\ldots, k$.\n\nThe BH-adjusted $p$-value, often called a $q$-value, for a specific test is defined as the lowest FDR level $\\alpha$ at which that test's null hypothesis would be rejected. From the procedure above, the hypothesis $H_{(i)}$ is rejected if $p_{(i)} \\le \\frac{i}{m} \\alpha$, or equivalently, if $\\alpha \\ge p_{(i)} \\frac{m}{i}$. To satisfy this condition for all rejected hypotheses up to rank $k$, we must have $\\alpha \\ge p_{(j)}\\frac{m}{j}$ for all $j \\le k$. The BH procedure rejects all $H_{(1)}, \\dots, H_{(k)}$, so the critical $\\alpha$ is determined by the \"loosest\" condition, which is at rank $k$. However, the definition of the $q$-value must ensure monotonicity, i.e., $p_{(i)} \\le p_{(j)} \\implies q_{(i)} \\le q_{(j)}$.\n\nThe $q$-value for the $i$-th ordered $p$-value, $q_{(i)}$, is derived from the step-up logic. The condition for rejecting $H_{(i)}$ and all preceding hypotheses is that for some $k \\ge i$, $p_{(k)} \\le \\frac{k}{m}\\alpha$. The minimum $\\alpha$ for which this holds for a fixed $p_{(i)}$ is effectively $\\min_{j=i, \\dots, m} \\{p_{(j)}\\frac{m}{j}\\}$.\nTherefore, the $q$-values for the sorted $p$-values are computed as follows:\n-   Start with the largest $p$-value, $p_{(m)}$. Its adjusted value is $q_{(m)} = p_{(m)}\\frac{m}{m} = p_{(m)}$.\n-   Proceed downwards for $i = m-1, \\ldots, 1$. The $q$-value for $p_{(i)}$ is given by:\n    $$q_{(i)} = \\min\\left(q_{(i+1)}, p_{(i)}\\frac{m}{i}\\right)$$\nThis recursive definition is equivalent to the direct form:\n$$q_{(i)} = \\min_{j=i, \\dots, m} \\left( p_{(j)} \\frac{m}{j} \\right)$$\nThe final set of $q$-values $\\{q_{(1)}, q_{(2)}, \\ldots, q_{(m)}\\}$ is then re-associated with their original, unsorted hypotheses.\n\n**Part 3: Calculation of the $q$-value for edge $(R_2, R_4)$**\n\nFirst, we compute the uncorrected $p$-value for each of the $m=6$ edges using the derived formula $p_e = \\frac{b_e + 1}{N_{\\text{perm}} + 1}$ with $N_{\\text{perm}} = 999$.\n-   $p_{12} = \\frac{3+1}{999+1} = \\frac{4}{1000} = 0.004$\n-   $p_{13} = \\frac{20+1}{1000} = \\frac{21}{1000} = 0.021$\n-   $p_{14} = \\frac{0+1}{1000} = \\frac{1}{1000} = 0.001$\n-   $p_{23} = \\frac{8+1}{1000} = \\frac{9}{1000} = 0.009$\n-   $p_{24} = \\frac{31+1}{1000} = \\frac{32}{1000} = 0.032$\n-   $p_{34} = \\frac{17+1}{1000} = \\frac{18}{1000} = 0.018$\n\nNext, we sort these $p$-values in ascending order:\n-   $p_{(1)} = 0.001$ (from edge $(R_1,R_4)$)\n-   $p_{(2)} = 0.004$ (from edge $(R_1,R_2)$)\n-   $p_{(3)} = 0.009$ (from edge $(R_2,R_3)$)\n-   $p_{(4)} = 0.018$ (from edge $(R_3,R_4)$)\n-   $p_{(5)} = 0.021$ (from edge $(R_1,R_3)$)\n-   $p_{(6)} = 0.032$ (from edge $(R_2,R_4)$)\n\nWe are asked to find the $q$-value for the edge $(R_2, R_4)$. Its uncorrected $p$-value is $p_{24}=0.032$, which is the largest of all $p$-values, corresponding to rank $i=6$ in the sorted list.\n\nUsing the derived BH procedure, we compute the $q$-value for this ranked $p$-value, $q_{(6)}$.\nAccording to the formula, the $q$-value for the largest $p$-value ($i=m$) is simply the $p$-value itself:\n$$q_{(m)} = p_{(m)}$$\nIn our case, $m=6$, so we need to compute $q_{(6)}$:\n$$q_{(6)} = p_{(6)} = 0.032$$\nThis can also be seen from the general formula $q_{(i)} = \\min_{j=i, \\dots, m} \\left( p_{(j)} \\frac{m}{j} \\right)$. For $i=6$, the set of indices $j$ is just $\\{6\\}$, so:\n$$q_{(6)} = p_{(6)} \\frac{m}{6} = p_{(6)} \\frac{6}{6} = p_{(6)} = 0.032$$\nThe value is an exact decimal and does not require rounding. The Benjamini-Hochberg $q$-value for the edge $(R_2, R_4)$ is $0.032$.", "answer": "$$\\boxed{0.032}$$", "id": "4322084"}]}