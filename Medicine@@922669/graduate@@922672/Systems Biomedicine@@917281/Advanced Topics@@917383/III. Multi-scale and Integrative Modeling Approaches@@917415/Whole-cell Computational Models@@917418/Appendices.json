{"hands_on_practices": [{"introduction": "The stoichiometric matrix, $S$, is the blueprint of a metabolic network. This exercise explores how the mathematical structure of this matrix reveals fundamental conservation laws within the cell, such as the fixed total pool of adenylate phosphates (AMP, ADP, ATP). By applying linear algebra to find vectors in the left-nullspace of $S$, you will learn to automatically identify these invariant quantities, a crucial step for model validation and for simplifying dynamic simulations of the network [@problem_id:4399280].", "problem": "Consider a dynamical model of intracellular biochemical species in a whole-cell computational model. Let $m$ denote the number of tracked chemical species and let $n$ denote the number of reactions. The time evolution of the concentration vector $\\mathbf{x}(t) \\in \\mathbb{R}^m$ is governed by the mass-balance Ordinary Differential Equation (ODE)\n$$\n\\frac{d\\mathbf{x}}{dt} = S \\, \\mathbf{v}(t),\n$$\nwhere $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix and $\\mathbf{v}(t) \\in \\mathbb{R}^n$ is the vector of reaction fluxes. A linear conservation relation is any row vector $\\mathbf{l}^\\top \\in \\mathbb{R}^{1 \\times m}$ such that the scalar quantity $\\mathbf{l}^\\top \\mathbf{x}(t)$ is invariant for all time under all admissible reaction fluxes; by the product rule and arbitrariness of $\\mathbf{v}(t)$, this requires\n$$\n\\mathbf{l}^\\top S = \\mathbf{0}^\\top,\n$$\nthat is, $\\mathbf{l}$ lies in the left-nullspace of $S$. A conserved moiety is a conservation relation whose nonzero components align with a single predefined chemical backbone group (for example, the adenylate backbone across adenosine monophosphate, adenosine diphosphate, and adenosine triphosphate) and have equal positive weights on each species in that group; conservation relations that mix multiple groups and/or require unequal weights are general conservation relations.\n\nTask: For each provided stoichiometric matrix, compute a basis for the left-nullspace by finding all vectors $\\mathbf{l}$ satisfying $\\mathbf{l}^\\top S = \\mathbf{0}^\\top$. Then, using the specified moiety groupings (given as sets of zero-based species indices), classify which groups yield conserved moieties by testing the group-indicator vector with equal unit weights on the groupâ€™s species. Finally, report for each test case:\n- the total number $k$ of independent conservation relations (the dimension of the left-nullspace),\n- the number $m_c$ of conserved moieties identified using the provided groups,\n- and the number $g_c$ of general conservation relations, computed as $g_c = \\max(0, k - m_c)$.\n\nAll computations are dimensionless; no physical unit conversion is required.\n\nUse the following test suite of stoichiometric matrices and moiety groupings. Species are listed in row order; reaction columns follow the given biochemical interpretation.\n\nTest case $1$ (block-diagonal adenylate and nicotinamide system):\nSpecies order: $[\\mathrm{AMP}, \\mathrm{ADP}, \\mathrm{ATP}, \\mathrm{NAD}, \\mathrm{NADH}]$.\nReactions:\n- $r_1$: $2\\,\\mathrm{ADP} \\rightarrow \\mathrm{AMP} + \\mathrm{ATP}$,\n- $r_2$: $\\mathrm{ATP} \\rightarrow \\mathrm{ADP}$,\n- $r_3$: $\\mathrm{NADH} \\rightarrow \\mathrm{NAD}$.\nStoichiometric matrix:\n$$\nS^{(1)} = \\begin{bmatrix}\n1 & 0 & 0 \\\\\n-2 & 1 & 0 \\\\\n1 & -1 & 0 \\\\\n0 & 0 & 1 \\\\\n0 & 0 & -1\n\\end{bmatrix}.\n$$\nMoiety groups (zero-based indices): $\\{\\{0,1,2\\}, \\{3,4\\}\\}$.\n\nTest case $2$ (adenylate with inorganic phosphate, including AMP consumption):\nSpecies order: $[\\mathrm{AMP}, \\mathrm{ADP}, \\mathrm{ATP}, \\mathrm{Pi}]$.\nReactions:\n- $r_1$: $2\\,\\mathrm{ADP} \\rightarrow \\mathrm{AMP} + \\mathrm{ATP}$,\n- $r_2$: $\\mathrm{ATP} \\rightarrow \\mathrm{ADP} + \\mathrm{Pi}$,\n- $r_3$: $\\mathrm{AMP} \\rightarrow \\mathrm{Pi} + \\text{external}$.\nStoichiometric matrix:\n$$\nS^{(2)} = \\begin{bmatrix}\n1 & 0 & -1 \\\\\n-2 & 1 & 0 \\\\\n1 & -1 & 0 \\\\\n0 & 1 & 1\n\\end{bmatrix}.\n$$\nMoiety groups (zero-based indices): $\\{\\{0,1,2\\}, \\{3\\}\\}$.\n\nTest case $3$ (full-rank exchange with environment; no internal conservation):\nSpecies order: $[X, Y, Z]$.\nReactions:\n- $r_1$: $X \\rightarrow \\text{external}$,\n- $r_2$: $Y \\rightarrow \\text{external}$,\n- $r_3$: $Z \\rightarrow \\text{external}$.\nStoichiometric matrix:\n$$\nS^{(3)} = \\begin{bmatrix}\n-1 & 0 & 0 \\\\\n0 & -1 & 0 \\\\\n0 & 0 & -1\n\\end{bmatrix}.\n$$\nMoiety groups (zero-based indices): $\\{\\{0,1,2\\}\\}$.\n\nAlgorithmic requirements:\n- Compute a basis for the nullspace of $(S^{(i)})^\\top$ for each test case $i \\in \\{1,2,3\\}$, and set $k$ equal to the basis dimension.\n- For each provided moiety group $G$, form the indicator vector $\\mathbf{l}_G \\in \\mathbb{R}^m$ with $(\\mathbf{l}_G)_j = 1$ for $j \\in G$ and $(\\mathbf{l}_G)_j = 0$ for $j \\notin G$. Classify $G$ as a conserved moiety if $\\mathbf{l}_G^\\top S^{(i)} = \\mathbf{0}^\\top$.\n- Set $m_c$ equal to the count of groups $G$ classified as conserved moieties, and set $g_c = \\max(0, k - m_c)$.\n\nOutput specification:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a list $[k, m_c, g_c]$ for the corresponding test case in order $1,2,3$. For example, the output must be of the form\n$[ [k_1, m_{c,1}, g_{c,1}], [k_2, m_{c,2}, g_{c,2}], [k_3, m_{c,3}, g_{c,3}] ]$,\nwith all entries being integers.", "solution": "The problem requires an analysis of conservation laws in biochemical reaction networks, a fundamental concept in systems biology and whole-cell modeling. The time evolution of species concentrations, $\\mathbf{x}(t)$, is described by the ordinary differential equation $\\frac{d\\mathbf{x}}{dt} = S \\mathbf{v}(t)$, where $S$ is the stoichiometric matrix and $\\mathbf{v}(t)$ is the vector of reaction fluxes.\n\nA linear conservation relation is a linear combination of species concentrations, $\\mathbf{l}^\\top \\mathbf{x}(t)$, that remains constant over time. For this quantity to be invariant, its time derivative must be zero:\n$$\n\\frac{d}{dt} (\\mathbf{l}^\\top \\mathbf{x}(t)) = \\mathbf{l}^\\top \\frac{d\\mathbf{x}}{dt} = \\mathbf{l}^\\top (S \\mathbf{v}(t)) = (\\mathbf{l}^\\top S) \\mathbf{v}(t) = 0\n$$\nSince this must hold for any arbitrary vector of reaction fluxes $\\mathbf{v}(t)$, it necessitates that the vector $\\mathbf{l}^\\top S$ be the zero vector, $\\mathbf{0}^\\top$. This condition, $\\mathbf{l}^\\top S = \\mathbf{0}^\\top$, defines $\\mathbf{l}$ as a vector in the left-nullspace of the stoichiometric matrix $S$. The set of all such vectors $\\mathbf{l}$ forms a vector space, and the dimension of this space, denoted by $k$, corresponds to the number of linearly independent conservation relations in the system. Computationally, the left-nullspace of $S$ is equivalent to the nullspace of its transpose, $S^\\top$.\n\nThe problem distinguishes between two types of conservation relations:\n$1$. **Conserved Moieties**: These are specific, simple conservation relations where the vector $\\mathbf{l}$ acts as an indicator vector for a predefined group of species. Specifically, for a given moiety group $G$, the corresponding vector $\\mathbf{l}_G$ has components equal to $1$ for species within the group and $0$ otherwise. A group $G$ represents a conserved moiety if its indicator vector $\\mathbf{l}_G$ is in the left-nullspace of $S$ (i.e., $\\mathbf{l}_G^\\top S = \\mathbf{0}^\\top$). The number of such groups is denoted by $m_c$.\n$2$. **General Conservation Relations**: These are any conservation relations that are not accounted for by the predefined conserved moieties. They might involve unequal weighting of species or the mixing of different chemical groups. The number of such relations, $g_c$, is determined by the difference between the total number of independent conservation relations, $k$, and the number of identified conserved moieties, $m_c$, given by $g_c = \\max(0, k - m_c)$.\n\nThe solution proceeds by analyzing each test case according to these principles.\n\n**Test Case 1**:\nThe stoichiometric matrix is given by:\n$$\nS^{(1)} = \\begin{bmatrix}\n1 & 0 & 0 \\\\\n-2 & 1 & 0 \\\\\n1 & -1 & 0 \\\\\n0 & 0 & 1 \\\\\n0 & 0 & -1\n\\end{bmatrix}\n$$\nThe number of species is $m=5$. To find the conservation laws, we compute a basis for the nullspace of $(S^{(1)})^\\top$:\n$$\n(S^{(1)})^\\top = \\begin{bmatrix}\n1 & -2 & 1 & 0 & 0 \\\\\n0 & 1 & -1 & 0 & 0 \\\\\n0 & 0 & 0 & 1 & -1\n\\end{bmatrix}\n$$\nSolving $(S^{(1)})^\\top \\mathbf{l} = \\mathbf{0}$ for $\\mathbf{l} = [l_1, l_2, l_3, l_4, l_5]^\\top$ yields the equations $l_1 - 2l_2 + l_3 = 0$, $l_2 - l_3 = 0$, and $l_4 - l_5 = 0$. These simplify to $l_1 = l_2 = l_3$ and $l_4 = l_5$. The solution space is spanned by two linearly independent vectors, for example $[1, 1, 1, 0, 0]^\\top$ and $[0, 0, 0, 1, 1]^\\top$. Therefore, the dimension of the left-nullspace is $k_1 = 2$.\n\nNext, we test the provided moiety groups: $\\{\\{0, 1, 2\\}, \\{3, 4\\}\\}$.\n- For group $G_1 = \\{0, 1, 2\\}$, the indicator vector is $\\mathbf{l}_{G_1} = [1, 1, 1, 0, 0]^\\top$. We check if $\\mathbf{l}_{G_1}^\\top S^{(1)} = \\mathbf{0}^\\top$:\n$$\n[1, 1, 1, 0, 0] \\begin{bmatrix} 1 & 0 & 0 \\\\ -2 & 1 & 0 \\\\ 1 & -1 & 0 \\\\ 0 & 0 & 1 \\\\ 0 & 0 & -1 \\end{bmatrix} = [1-2+1, 1-1, 0] = [0, 0, 0]\n$$\nThis condition holds, so this is a conserved moiety.\n- For group $G_2 = \\{3, 4\\}$, the indicator vector is $\\mathbf{l}_{G_2} = [0, 0, 0, 1, 1]^\\top$. We check if $\\mathbf{l}_{G_2}^\\top S^{(1)} = \\mathbf{0}^\\top$:\n$$\n[0, 0, 0, 1, 1] \\begin{bmatrix} 1 & 0 & 0 \\\\ -2 & 1 & 0 \\\\ 1 & -1 & 0 \\\\ 0 & 0 & 1 \\\\ 0 & 0 & -1 \\end{bmatrix} = [0, 0, 1-1] = [0, 0, 0]\n$$\nThis also holds. Thus, we have identified $m_{c,1} = 2$ conserved moieties.\nFinally, the number of general conservation relations is $g_{c,1} = \\max(0, k_1 - m_{c,1}) = \\max(0, 2 - 2) = 0$.\nThe result for this case is $[2, 2, 0]$.\n\n**Test Case 2**:\nThe stoichiometric matrix is:\n$$\nS^{(2)} = \\begin{bmatrix}\n1 & 0 & -1 \\\\\n-2 & 1 & 0 \\\\\n1 & -1 & 0 \\\\\n0 & 1 & 1\n\\end{bmatrix}\n$$\nThe number of species is $m=4$. We find the nullspace of $(S^{(2)})^\\top$:\n$$\n(S^{(2)})^\\top = \\begin{bmatrix}\n1 & -2 & 1 & 0 \\\\\n0 & 1 & -1 & 1 \\\\\n-1 & 0 & 0 & 1\n\\end{bmatrix}\n$$\nSolving $(S^{(2)})^\\top \\mathbf{l} = \\mathbf{0}$ yields a one-dimensional nullspace spanned by the vector $[1, 2, 3, 1]^\\top$. Thus, the total number of independent conservation relations is $k_2 = 1$. This vector represents the conservation of phosphate groups across AMP (1P), ADP (2P), ATP (3P), and inorganic phosphate Pi (1P).\n\nThe moiety groups to test are $\\{\\{0, 1, 2\\}, \\{3\\}\\}$.\n- For group $G_1 = \\{0, 1, 2\\}$, the indicator vector is $\\mathbf{l}_{G_1} = [1, 1, 1, 0]^\\top$. We check the condition:\n$$\n[1, 1, 1, 0] \\begin{bmatrix} 1 & 0 & -1 \\\\ -2 & 1 & 0 \\\\ 1 & -1 & 0 \\\\ 0 & 1 & 1 \\end{bmatrix} = [1-2+1, 1-1, -1] = [0, 0, -1] \\neq [0, 0, 0]\n$$\n- For group $G_2 = \\{3\\}$, the indicator vector is $\\mathbf{l}_{G_2} = [0, 0, 0, 1]^\\top$:\n$$\n[0, 0, 0, 1] \\begin{bmatrix} 1 & 0 & -1 \\\\ -2 & 1 & 0 \\\\ 1 & -1 & 0 \\\\ 0 & 1 & 1 \\end{bmatrix} = [0, 1, 1] \\neq [0, 0, 0]\n$$\nNeither group yields a conserved moiety, so $m_{c,2} = 0$.\nThe number of general conservation relations is $g_{c,2} = \\max(0, k_2 - m_{c,2}) = \\max(0, 1 - 0) = 1$. The single conservation law found, $[1, 2, 3, 1]^\\top$, involves unequal weights and is thus a general conservation relation.\nThe result for this case is $[1, 0, 1]$.\n\n**Test Case 3**:\nThe stoichiometric matrix is:\n$$\nS^{(3)} = \\begin{bmatrix}\n-1 & 0 & 0 \\\\\n0 & -1 & 0 \\\\\n0 & 0 & -1\n\\end{bmatrix} = -I_3\n$$\nThe number of species is $m=3$. $S^{(3)}$ is a full-rank square matrix. Its transpose, $(S^{(3)})^\\top = -I_3$, is also full-rank. The nullspace of a full-rank matrix contains only the zero vector. Therefore, the dimension of the left-nullspace is $k_3 = 0$. There are no non-trivial conservation relations in this system.\n\nWith $k_3=0$, it is impossible to find any conserved moieties. The number of identified conserved moieties must be $m_{c,3} = 0$.\nThe number of general conservation relations is $g_{c,3} = \\max(0, k_3 - m_{c,3}) = \\max(0, 0 - 0) = 0$.\nThe result for this case is $[0, 0, 0]$.\n\nThe final output is an aggregation of these three results.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import null_space\n\ndef solve():\n    \"\"\"\n    Computes conservation relations for given biochemical systems.\n\n    For each test case, the function calculates:\n    - k: The total number of independent conservation relations (dimension of the left-nullspace).\n    - m_c: The number of conserved moieties from a given list of species groups.\n    - g_c: The number of general conservation relations.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"S\": np.array([\n                [1, 0, 0],\n                [-2, 1, 0],\n                [1, -1, 0],\n                [0, 0, 1],\n                [0, 0, -1]\n            ]),\n            \"groups\": [[0, 1, 2], [3, 4]]\n        },\n        {\n            \"S\": np.array([\n                [1, 0, -1],\n                [-2, 1, 0],\n                [1, -1, 0],\n                [0, 1, 1]\n            ]),\n            \"groups\": [[0, 1, 2], [3]]\n        },\n        {\n            \"S\": np.array([\n                [-1, 0, 0],\n                [0, -1, 0],\n                [0, 0, -1]\n            ]),\n            \"groups\": [[0, 1, 2]]\n        }\n    ]\n\n    results = []\n    # A small tolerance for floating-point comparisons\n    tolerance = 1e-9\n\n    for case in test_cases:\n        S = case[\"S\"]\n        groups = case[\"groups\"]\n        num_species = S.shape[0]\n\n        # Step 1: Compute a basis for the left-nullspace of S and find its dimension, k.\n        # The left-nullspace of S is the nullspace of S.T.\n        # The columns of `ns` form an orthonormal basis for the nullspace.\n        ns_basis = null_space(S.T)\n        k = ns_basis.shape[1]\n\n        # Step 2: Test each moiety group to count the number of conserved moieties, m_c.\n        m_c = 0\n        for group in groups:\n            # Form the indicator vector l_G for the group.\n            l_G = np.zeros(num_species)\n            l_G[group] = 1.0\n            \n            # Check if l_G is in the left-nullspace, i.e., l_G^T @ S = 0.\n            product = l_G.T @ S\n            if np.allclose(product, np.zeros_like(product), atol=tolerance):\n                # The group corresponds to a conserved moiety.\n                m_c += 1\n\n        # Step 3: Compute the number of general conservation relations, g_c.\n        g_c = max(0, k - m_c)\n\n        results.append(f\"[{k},{m_c},{g_c}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4399280"}, {"introduction": "Whole-cell models are not just static maps; they are dynamic systems whose behavior we want to simulate over time. A major computational challenge arises from the fact that biological processes occur on vastly different timescales, a property known as \"stiffness.\" This practice demonstrates how to diagnose stiffness by examining the eigenvalues of the system's Jacobian matrix, a measure of local sensitivity [@problem_id:4399346]. Mastering this analysis is essential for choosing appropriate and efficient numerical solvers, a critical skill for any computational biologist.", "problem": "Consider a whole-cell metabolic subsystem modeled as an ordinary differential equation (ODE) system based on mass action kinetics. Let $x \\in \\mathbb{R}^n$ denote the vector of species concentrations, $S \\in \\mathbb{R}^{n \\times r}$ the stoichiometric matrix, and $v(x) \\in \\mathbb{R}^r$ the vector of reaction rates. The dynamics are given by the mass balance law and mass action kinetics: \n$$\n\\frac{dx}{dt} = f(x) = S \\, v(x),\n$$\nwhere for each reaction $j \\in \\{1, \\dots, r\\}$, \n$$\nv_j(x) = k_j \\prod_{i=1}^{n} x_i^{\\nu_{ij}},\n$$ \nwith $k_j > 0$ the rate constant and $\\nu_{ij} \\in \\mathbb{N}_0$ the stoichiometric order (reactant molecularity) of species $i$ in reaction $j$. Define the Jacobian matrix \n$$\nJ(x) = \\frac{\\partial f}{\\partial x}(x) \\in \\mathbb{R}^{n \\times n}.\n$$\nStiffness in such ODE systems can be analyzed by examining the eigenvalues $\\{\\lambda_i\\}_{i=1}^n$ of $J(x)$ at a given state $x$, particularly when the magnitudes $\\{|\\lambda_i|\\}$ span multiple orders of magnitude. This spread forces explicit methods to take very small steps for stability, while implicit methods can remain stable at much larger steps, providing computational advantages in whole-cell models with fast and slow subsystems.\n\nYour task is to derive from first principles how to compute the Jacobian matrix $J(x)$ for mass action kinetics, compute its eigenvalues at specified states, and then quantify stiffness by the ratio \n$$\nR = \\frac{\\max_i |\\lambda_i|}{\\min_{i:\\,|\\lambda_i|>\\varepsilon} |\\lambda_i|},\n$$\nexcluding near-zero eigenvalues using a tolerance $\\varepsilon = 10^{-12}$. Also compute the order-of-magnitude spread \n$$\nM = \\log_{10}(R),\n$$\nand classify the system as stiff if $M \\geq 3$, otherwise non-stiff. Output, for each test case, the list $[R, M, \\text{flag}]$ where $\\text{flag}$ is $1$ for stiff and $0$ for non-stiff. If fewer than two eigenvalues satisfy $|\\lambda_i| > \\varepsilon$, define $R = 1$ and $M = 0$, and set $\\text{flag} = 0$. Angles are not involved. No physical units are required in the output since the metrics are dimensionless.\n\nUse the following test suite of four cases that cover a general case, a highly stiff case, a nonlinear molecularity case with state-dependent Jacobian, and a near-threshold case. All matrices and vectors are specified with entries as follows.\n\nCase $1$ (three-species cycle, first-order rates, similar timescales):\n$$\nS_1 = \\begin{bmatrix}\n-1 & 0 & 1 \\\\\n1 & -1 & 0 \\\\\n0 & 1 & -1\n\\end{bmatrix},\\quad\n\\nu_1 = \\begin{bmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1\n\\end{bmatrix},\\quad\nk_1 = \\begin{bmatrix} 0.8 \\\\ 1.0 \\\\ 1.2 \\end{bmatrix},\\quad\nx_1 = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 1.0 \\end{bmatrix}.\n$$\n\nCase $2$ (three-species cycle, first-order rates, widely separated timescales):\n$$\nS_2 = \\begin{bmatrix}\n-1 & 0 & 1 \\\\\n1 & -1 & 0 \\\\\n0 & 1 & -1\n\\end{bmatrix},\\quad\n\\nu_2 = \\begin{bmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1\n\\end{bmatrix},\\quad\nk_2 = \\begin{bmatrix} 10^{-3} \\\\ 1.0 \\\\ 10^{3} \\end{bmatrix},\\quad\nx_2 = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 1.0 \\end{bmatrix}.\n$$\n\nCase $3$ (nonlinear molecularity with dimerization, state-dependent Jacobian):\n$$\nS_3 = \\begin{bmatrix}\n-2 & 0 & 1 \\\\\n1 & -1 & 0 \\\\\n0 & 1 & -1\n\\end{bmatrix},\\quad\n\\nu_3 = \\begin{bmatrix}\n2 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1\n\\end{bmatrix},\\quad\nk_3 = \\begin{bmatrix} 5.0 \\\\ 0.1 \\\\ 0.01 \\end{bmatrix},\\quad\nx_3 = \\begin{bmatrix} 100.0 \\\\ 1.0 \\\\ 1.0 \\end{bmatrix}.\n$$\n\nCase $4$ (near-threshold stiffness, first-order rates):\n$$\nS_4 = \\begin{bmatrix}\n-1 & 0 & 1 \\\\\n1 & -1 & 0 \\\\\n0 & 1 & -1\n\\end{bmatrix},\\quad\n\\nu_4 = \\begin{bmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & 0 \\\\\n0 & 0 & 1\n\\end{bmatrix},\\quad\nk_4 = \\begin{bmatrix} 10^{-2} \\\\ 1.0 \\\\ 10 \\end{bmatrix},\\quad\nx_4 = \\begin{bmatrix} 1.0 \\\\ 1.0 \\\\ 1.0 \\end{bmatrix}.\n$$\n\nImplement a program that, for each case, constructs $J(x)$ from $S$, $\\nu$, $k$, and $x$, computes the eigenvalues of $J(x)$, computes $R$, $M$, and the stiffness flag, and outputs a single line containing a list of the four per-case results as a comma-separated list enclosed in square brackets, where each per-case result is the list $[R, M, \\text{flag}]$. For example, the output format must be \n$$\n\\text{[ [r\\_1,m\\_1,f\\_1], [r\\_2,m\\_2,f\\_2], [r\\_3,m\\_3,f\\_3], [r\\_4,m\\_4,f\\_4] ]}.\n$$\nNo input should be read from the user, and no files should be accessed. Use the tolerance $\\varepsilon = 10^{-12}$ to exclude near-zero eigenvalues when computing $\\min |\\lambda_i|$.", "solution": "The user-provided problem has been validated and is determined to be a valid, well-posed scientific problem. The following is the complete, reasoned solution.\n\nThe objective is to derive an expression for the Jacobian matrix $J(x)$ of a metabolic subsystem governed by mass action kinetics, and then to use it to quantify system stiffness for several test cases.\n\nThe system dynamics are described by the ordinary differential equation (ODE):\n$$\n\\frac{dx}{dt} = f(x) = S \\, v(x)\n$$\nwhere $x \\in \\mathbb{R}^n$ is the vector of species concentrations, $S \\in \\mathbb{R}^{n \\times r}$ is the stoichiometric matrix, and $v(x) \\in \\mathbb{R}^r$ is the vector of reaction rates. For a system with $n$ species and $r$ reactions, the dynamics for the $i$-th species concentration, $x_i$, are given by:\n$$\nf_i(x) = \\frac{dx_i}{dt} = \\sum_{j=1}^{r} S_{ij} v_j(x)\n$$\nHere, $S_{ij}$ represents the stoichiometric coefficient of species $i$ in reaction $j$. The reaction rates $v_j(x)$ are defined by the law of mass action:\n$$\nv_j(x) = k_j \\prod_{l=1}^{n} x_l^{\\nu_{lj}}\n$$\nwhere $k_j > 0$ is the rate constant for reaction $j$, and $\\nu_{lj} \\in \\mathbb{N}_0$ is the molecularity of species $l$ acting as a reactant in reaction $j$.\n\nThe Jacobian matrix $J(x)$ is an $n \\times n$ matrix whose elements $J_{ik}(x)$ are the partial derivatives of the rate of change of the $i$-th species with respect to the concentration of the $k$-th species:\n$$\nJ_{ik}(x) = \\frac{\\partial f_i}{\\partial x_k}(x)\n$$\nSubstituting the expression for $f_i(x)$, we have:\n$$\nJ_{ik}(x) = \\frac{\\partial}{\\partial x_k} \\left( \\sum_{j=1}^{r} S_{ij} v_j(x) \\right)\n$$\nSince differentiation is a linear operation, we can interchange the derivative and the summation:\n$$\nJ_{ik}(x) = \\sum_{j=1}^{r} S_{ij} \\frac{\\partial v_j(x)}{\\partial x_k}\n$$\nNext, we must compute the partial derivative of the reaction rate $v_j(x)$ with respect to a species concentration $x_k$:\n$$\n\\frac{\\partial v_j(x)}{\\partial x_k} = \\frac{\\partial}{\\partial x_k} \\left( k_j \\prod_{l=1}^{n} x_l^{\\nu_{lj}} \\right)\n$$\nUsing the product rule for differentiation, the derivative is non-zero only for the term corresponding to $l=k$:\n$$\n\\frac{\\partial v_j(x)}{\\partial x_k} = k_j \\left( \\prod_{l \\neq k} x_l^{\\nu_{lj}} \\right) \\frac{\\partial}{\\partial x_k} (x_k^{\\nu_{kj}}) = k_j \\left( \\prod_{l \\neq k} x_l^{\\nu_{lj}} \\right) (\\nu_{kj} x_k^{\\nu_{kj}-1})\n$$\nIf $\\nu_{kj} = 0$, the derivative is $0$. If $\\nu_{kj} > 0$ and $x_k > 0$, we can rearrange this expression by multiplying and dividing by $x_k$:\n$$\n\\frac{\\partial v_j(x)}{\\partial x_k} = \\nu_{kj} \\frac{1}{x_k} \\left( k_j \\left( \\prod_{l \\neq k} x_l^{\\nu_{lj}} \\right) x_k^{\\nu_{kj}} \\right) = \\frac{\\nu_{kj}}{x_k} \\left( k_j \\prod_{l=1}^{n} x_l^{\\nu_{lj}} \\right)\n$$\nThis simplifies to a compact and elegant form:\n$$\n\\frac{\\partial v_j(x)}{\\partial x_k} = \\frac{\\nu_{kj} v_j(x)}{x_k}\n$$\nThis form is valid for the provided test cases, as all specified concentrations $x_k$ are strictly positive.\n\nSubstituting this back into the expression for the Jacobian element $J_{ik}(x)$:\n$$\nJ_{ik}(x) = \\sum_{j=1}^{r} S_{ij} \\frac{\\nu_{kj} v_j(x)}{x_k}\n$$\nThis expression can be formulated in matrix notation. Let us define a matrix $N(x) \\in \\mathbb{R}^{r \\times n}$ whose elements are $N_{jk}(x) = \\frac{\\partial v_j(x)}{\\partial x_k} = \\frac{\\nu_{kj} v_j(x)}{x_k}$. Then the Jacobian matrix $J(x)$ is the product of the stoichiometric matrix $S$ and the matrix $N(x)$:\n$$\nJ(x) = S \\cdot N(x)\n$$\nThe computational procedure for each test case is as follows:\n1.  Given the parameters $S \\in \\mathbb{R}^{n \\times r}$, $\\nu \\in \\mathbb{R}^{n \\times r}$, $k \\in \\mathbb{R}^{r}$, and $x \\in \\mathbb{R}^{n}$.\n2.  Calculate the reaction rate vector $v(x) \\in \\mathbb{R}^r$, where each element $v_j(x)$ is computed as $v_j(x) = k_j \\prod_{i=1}^{n} x_i^{\\nu_{ij}}$.\n3.  Construct the matrix $N(x) \\in \\mathbb{R}^{r \\times n}$ with elements $N_{jk}(x) = (\\nu_{kj}/x_k) v_j(x)$.\n4.  Compute the Jacobian matrix $J(x) \\in \\mathbb{R}^{n \\times n}$ via the matrix product $J(x) = S N(x)$.\n5.  Calculate the eigenvalues $\\{\\lambda_i\\}_{i=1}^n$ of $J(x)$.\n6.  Compute the set of eigenvalue magnitudes, $\\{|\\lambda_i|\\}$.\n7.  Filter this set to retain only magnitudes greater than the tolerance $\\varepsilon = 10^{-12}$. Let this filtered set of magnitudes be $\\Lambda_{filtered}$.\n8.  If the number of elements in $\\Lambda_{filtered}$ is less than two, set the stiffness ratio $R=1.0$, the logarithmic spread $M=0.0$, and the stiffness flag to $0$.\n9.  Otherwise, compute $R = \\frac{\\max_i |\\lambda_i|}{\\min(|\\Lambda_{filtered}|)}$.\n10. Compute the order-of-magnitude spread $M = \\log_{10}(R)$.\n11. Determine the stiffness flag: $1$ if $M \\geq 3$, and $0$ otherwise.\n12. The final result for the case is the list $[R, M, \\text{flag}]$.\n\nThis procedure is applied to each of the four test cases provided.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating stiffness metrics for several\n    biochemical reaction networks modeled by ODEs.\n    \"\"\"\n    epsilon = 1e-12\n    stiffness_threshold = 3.0\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (three-species cycle, first-order rates, similar timescales)\n        (\n            np.array([[-1, 0, 1], [1, -1, 0], [0, 1, -1]]),  # S1\n            np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]),      # nu1\n            np.array([0.8, 1.0, 1.2]),                       # k1\n            np.array([1.0, 1.0, 1.0])                        # x1\n        ),\n        # Case 2 (three-species cycle, first-order rates, widely separated timescales)\n        (\n            np.array([[-1, 0, 1], [1, -1, 0], [0, 1, -1]]),  # S2\n            np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]),      # nu2\n            np.array([1e-3, 1.0, 1e3]),                      # k2\n            np.array([1.0, 1.0, 1.0])                        # x2\n        ),\n        # Case 3 (nonlinear molecularity with dimerization, state-dependent Jacobian)\n        (\n            np.array([[-2, 0, 1], [1, -1, 0], [0, 1, -1]]),  # S3\n            np.array([[2, 0, 0], [0, 1, 0], [0, 0, 1]]),      # nu3\n            np.array([5.0, 0.1, 0.01]),                      # k3\n            np.array([100.0, 1.0, 1.0])                      # x3\n        ),\n        # Case 4 (near-threshold stiffness, first-order rates)\n        (\n            np.array([[-1, 0, 1], [1, -1, 0], [0, 1, -1]]),  # S4\n            np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]),      # nu4\n            np.array([1e-2, 1.0, 10.0]),                     # k4\n            np.array([1.0, 1.0, 1.0])                        # x4\n        )\n    ]\n\n    results = []\n    for S, nu, k, x in test_cases:\n        n = S.shape[0]  # Number of species\n        r = S.shape[1]  # Number of reactions\n\n        # Step 1: Compute the reaction rate vector v(x)\n        v = np.zeros(r)\n        for j in range(r):\n            # v_j = k_j * product(x_i ^ nu_ij for i=1..n)\n            v[j] = k[j] * np.prod(x ** nu[:, j])\n\n        # Step 2: Compute the matrix N(x) of partial derivatives of rates\n        # N_jk = (nu_kj / x_k) * v_j\n        N = np.zeros((r, n))\n        for j in range(r):\n            for k_idx in range(n):\n                if x[k_idx] > 0:  # Avoid division by zero\n                    N[j, k_idx] = (nu[k_idx, j] / x[k_idx]) * v[j]\n                # If x_k is zero, derivative is zero unless nu_kj=1, which is not handled here\n                # but not needed for the given test cases.\n\n        # Step 3: Compute the Jacobian matrix J(x) = S @ N(x)\n        J = S @ N\n\n        # Step 4: Compute the eigenvalues of J(x)\n        eigenvalues = np.linalg.eigvals(J)\n\n        # Step 5: Compute eigenvalue magnitudes and filter\n        abs_eigenvalues = np.abs(eigenvalues)\n        filtered_eigenvalues = abs_eigenvalues[abs_eigenvalues > epsilon]\n        \n        R, M, flag = 0.0, 0.0, 0\n        \n        # Step 6: Handle special case and compute stiffness metrics\n        if filtered_eigenvalues.size < 2:\n            R = 1.0\n            M = 0.0\n            flag = 0\n        else:\n            max_lambda = np.max(abs_eigenvalues)\n            min_lambda_filtered = np.min(filtered_eigenvalues)\n            \n            if min_lambda_filtered > 0:\n                R = max_lambda / min_lambda_filtered\n                M = np.log10(R)\n                flag = 1 if M >= stiffness_threshold else 0\n            else: # Should not happen due to filtering\n                R = 1.0\n                M = 0.0\n                flag = 0\n\n        results.append([R, M, flag])\n\n    # Final print statement in the exact required format.\n    # The default str() for a list includes spaces, e.g., '[1.0, 2.0, 3]',\n    # which matches the format example '[r_1, m_1, f_1]'.\n    # The join operation creates a string 'list1_str,list2_str,...'\n    # and the f-string wraps it in the outer brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```", "id": "4399346"}, {"introduction": "Beyond dynamic simulation, whole-cell models are powerful tools for predicting the optimal functional states of a cell, such as its maximum growth rate, using constraint-based approaches. This exercise elevates the classic Flux Balance Analysis (FBA) by incorporating thermodynamic laws, ensuring that predicted reaction fluxes are energetically feasible. You will learn to calculate the Gibbs free energy change ($\\Delta G$) for reactions based on metabolite concentrations and use it to constrain the network's operation [@problem_id:4399339]. This practice connects stoichiometry, thermodynamics, and cellular objectives to generate more realistic predictions of metabolic function.", "problem": "You are modeling a minimal stoichiometric subnetwork inside a whole-cell computational model under steady-state conditions. The network contains three intracellular metabolites $A$, $B$, and $C$, and five reactions: an uptake reaction $R_{\\mathrm{in}}$ that imports $A$ from outside, two internal conversions $R_{AB}$ and $R_{BC}$, a biomass sink $R_{\\mathrm{bio}}$ that consumes $C$, and an efflux reaction $R_{\\mathrm{out}}$ that exports $C$ to the exterior. The steady-state mass balance for intracellular metabolites is enforced by the stoichiometric matrix $S \\in \\mathbb{R}^{3 \\times 5}$ with rows ordered $(A,B,C)$ and columns $(R_{\\mathrm{in}}, R_{AB}, R_{BC}, R_{\\mathrm{bio}}, R_{\\mathrm{out}})$:\n$$\nS = \\begin{bmatrix}\n+1 & -1 & 0 & 0 & 0 \\\\\n0 & +1 & -1 & 0 & 0 \\\\\n0 & 0 & +1 & -1 & -1\n\\end{bmatrix}.\n$$\nThe flux vector is $v \\in \\mathbb{R}^{5}$ with entries $(v_{\\mathrm{in}}, v_{AB}, v_{BC}, v_{\\mathrm{bio}}, v_{\\mathrm{out}})$. Steady state requires $S v = 0$. Flux units are in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$; report all fluxes in these units.\n\nThermodynamic feasibility of each internal reaction $i$ is constrained by the change in Gibbs free energy:\n$$\n\\Delta G_i = \\Delta G_i^\\circ + R T \\ln Q_i,\n$$\nwhere $\\Delta G_i^\\circ$ is the standard Gibbs free energy change in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, $R$ is the universal gas constant in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$, $T$ is the absolute temperature in $\\mathrm{K}$, and $Q_i$ is the reaction quotient. Activities are approximated by concentrations in $\\mathrm{M}$ relative to the standard state of $1\\,\\mathrm{M}$ so that $Q_i$ is dimensionless. For a reaction with stoichiometric coefficients $\\nu_j$ (positive for products, negative for reactants), $Q_i = \\prod_j [X_j]^{\\nu_j}$ using intracellular concentrations $[X_j]$ for intracellular species. Only internal, chemically balanced reactions are thermodynamically constrained; in this network, apply the $\\Delta G_i$ constraint only to $R_{AB}$ and $R_{BC}$. The directionality requirement is:\n- If $\\Delta G_i \\le -\\varepsilon$ then only forward flux is admissible, i.e., $v_i \\ge 0$.\n- If $\\Delta G_i \\ge +\\varepsilon$ then only reverse flux is admissible, i.e., $v_i \\le 0$.\n- If $|\\Delta G_i| < \\varepsilon$ then the reaction is thermodynamically reversible, i.e., $v_i$ is free to be positive or negative within given magnitude bounds.\n\nAssume the following constants and bounds are fixed across all test cases:\n- Gas constant $R = 0.008314\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$.\n- Temperature $T = 310\\,\\mathrm{K}$.\n- Tolerance $\\varepsilon = 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Standard Gibbs energies: $\\Delta G^\\circ_{AB} = -5\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ and $\\Delta G^\\circ_{BC} = +2\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n- Flux bounds (in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$): $0 \\le v_{\\mathrm{in}} \\le 5$, $-10 \\le v_{AB} \\le 10$, $-10 \\le v_{BC} \\le 10$, $0 \\le v_{\\mathrm{bio}} \\le 10$, $0 \\le v_{\\mathrm{out}} \\le 10$.\n- Reaction quotients for $R_{AB}$ and $R_{BC}$ are computed as $Q_{AB} = \\dfrac{[B]}{[A]}$ and $Q_{BC} = \\dfrac{[C]}{[B]}$, respectively, using intracellular concentrations in $\\mathrm{M}$.\n\nYour task is to:\n1. Compute $\\Delta G_{AB}$ and $\\Delta G_{BC}$ from the given $\\Delta G^\\circ_i$, $R$, $T$, and intracellular concentrations using the natural logarithm.\n2. Translate the signs of $\\Delta G_{AB}$ and $\\Delta G_{BC}$, with tolerance $\\varepsilon$, into directionality constraints on $v_{AB}$ and $v_{BC}$ as specified above by tightening their bounds accordingly.\n3. Construct and solve a linear program to maximize $v_{\\mathrm{bio}}$ subject to steady-state $S v = 0$, the above bounds, and the thermodynamically imposed directionality on $v_{AB}$ and $v_{BC}$. This corresponds to minimizing $-v_{\\mathrm{bio}}$.\n4. For each test case, return three results: the maximized biomass flux $v_{\\mathrm{bio}}$ (a float), and two integers encoding directionality for $R_{AB}$ and $R_{BC}$ where $+1$ means forward-only, $-1$ means reverse-only, and $0$ means reversible.\n\nPhysical units requirements:\n- Report $v_{\\mathrm{bio}}$ in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$, rounded to six decimal places.\n\nTest suite (each case provides intracellular concentrations in $\\mathrm{M}$; use $R$ and $T$ above):\n- Case $1$ (both internal steps exergonic forward): $[A] = 10^{-3}$, $[B] = 10^{-4}$, $[C] = 10^{-6}$.\n- Case $2$ ($R_{AB}$ endergonic forward, $R_{BC}$ exergonic forward): $[A] = 10^{-6}$, $[B] = 10^{-3}$, $[C] = 10^{-6}$.\n- Case $3$ ($R_{BC}$ near equilibrium): $[A] = 10^{-3}$, $[B] = 10^{-4}$, and $[C] = [B] \\cdot \\exp\\!\\left(-\\dfrac{\\Delta G^\\circ_{BC}}{R T}\\right)$.\n\nFinal output format:\n- Your program should produce a single line of output containing a flat, comma-separated list enclosed in square brackets. Concatenate the three per-case triplets in order. For each case, place $v_{\\mathrm{bio}}$ (rounded to six decimals) first, followed by the integer codes for $R_{AB}$ and $R_{BC}$. For example, a syntactic illustration is $[x_1,d_{AB,1},d_{BC,1},x_2,d_{AB,2},d_{BC,2},x_3,d_{AB,3},d_{BC,3}]$, where $x_i$ are floats with six decimals and $d_{(\\cdot),i} \\in \\{-1,0,+1\\}$.", "solution": "The problem requires the determination of the maximum biomass production rate, $v_{\\mathrm{bio}}$, in a minimal metabolic network under steady-state and thermodynamic constraints. This is a constrained optimization problem that can be formulated and solved as a Linear Program (LP). The solution process involves three primary steps for each given test case: first, calculating the Gibbs free energy change ($\\Delta G$) for the internal reactions; second, using these $\\Delta G$ values to set directionality constraints on the corresponding fluxes; and third, solving the resulting LP to maximize $v_{\\mathrm{bio}}$.\n\nThe metabolic network consists of $3$ intracellular metabolites ($A, B, C$) and $5$ reactions ($R_{\\mathrm{in}}, R_{AB}, R_{BC}, R_{\\mathrm{bio}}, R_{\\mathrm{out}}$). The system dynamics are governed by the steady-state mass balance equation:\n$$S v = 0$$\nwhere $S \\in \\mathbb{R}^{3 \\times 5}$ is the stoichiometric matrix and $v \\in \\mathbb{R}^{5}$ is the vector of reaction fluxes.\n$$\nS = \\begin{bmatrix}\n+1 & -1 & 0 & 0 & 0 \\\\\n0 & +1 & -1 & 0 & 0 \\\\\n0 & 0 & +1 & -1 & -1\n\\end{bmatrix}, \\quad\nv = \\begin{pmatrix} v_{\\mathrm{in}} \\\\ v_{AB} \\\\ v_{BC} \\\\ v_{\\mathrm{bio}} \\\\ v_{\\mathrm{out}} \\end{pmatrix}\n$$\nThis matrix equation expands to three linear equality constraints:\n$$(1) \\quad v_{\\mathrm{in}} - v_{AB} = 0$$\n$$(2) \\quad v_{AB} - v_{BC} = 0$$\n$$(3) \\quad v_{BC} - v_{\\mathrm{bio}} - v_{\\mathrm{out}} = 0$$\nFrom equations $(1)$ and $(2)$, we deduce that $v_{\\mathrm{in}} = v_{AB} = v_{BC}$.\n\nThe optimization problem is to maximize the biomass flux, $v_{\\mathrm{bio}}$. This is equivalent to minimizing the objective function $c^T v$, where $c = (0, 0, 0, -1, 0)^T$.\n\nThe fluxes are subject to baseline bounds:\n$$0 \\le v_{\\mathrm{in}} \\le 5$$\n$$-10 \\le v_{AB} \\le 10$$\n$$-10 \\le v_{BC} \\le 10$$\n$$0 \\le v_{\\mathrm{bio}} \\le 10$$\n$$0 \\le v_{\\mathrm{out}} \\le 10$$\n\nThermodynamic constraints further tighten the bounds on the internal reaction fluxes $v_{AB}$ and $v_{BC}$. The Gibbs free energy change for a reaction $i$ is calculated as:\n$$\\Delta G_i = \\Delta G_i^\\circ + R T \\ln Q_i$$\nwhere $R = 0.008314\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$ and $T = 310\\,\\mathrm{K}$. Thus, $R T \\approx 2.57734\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$. The tolerance is $\\varepsilon = 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$. The reaction quotients are $Q_{AB} = [B]/[A]$ and $Q_{BC} = [C]/[B]$.\n\nThe directionality rules are:\n- If $\\Delta G_i \\le -10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, the flux $v_i$ is constrained to be non-negative ($v_i \\ge 0$). The directionality code is $+1$.\n- If $\\Delta G_i \\ge +10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, the flux $v_i$ is constrained to be non-positive ($v_i \\le 0$). The directionality code is $-1$.\n- If $|\\Delta G_i| < 10^{-3}\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, the flux $v_i$ is reversible within its original bounds. The directionality code is $0$.\n\nWe now solve for each test case.\n\n**Case 1:**\n- Concentrations: $[A] = 10^{-3}\\,\\mathrm{M}$, $[B] = 10^{-4}\\,\\mathrm{M}$, $[C] = 10^{-6}\\,\\mathrm{M}$.\n- Reaction quotients:\n  $$Q_{AB} = \\frac{[B]}{[A]} = \\frac{10^{-4}}{10^{-3}} = 0.1$$\n  $$Q_{BC} = \\frac{[C]}{[B]} = \\frac{10^{-6}}{10^{-4}} = 0.01$$\n- Gibbs free energy changes:\n  $$\\Delta G_{AB} = \\Delta G^\\circ_{AB} + RT \\ln Q_{AB} = -5 + (2.57734) \\ln(0.1) \\approx -5 - 5.934 = -10.934\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n  $$\\Delta G_{BC} = \\Delta G^\\circ_{BC} + RT \\ln Q_{BC} = +2 + (2.57734) \\ln(0.01) \\approx +2 - 11.869 = -9.869\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n- Directionality:\n  Since $\\Delta G_{AB} \\ll -\\varepsilon$, $R_{AB}$ is forward-only. The new bounds for $v_{AB}$ are $[0, 10]$. The directionality code is $+1$.\n  Since $\\Delta G_{BC} \\ll -\\varepsilon$, $R_{BC}$ is forward-only. The new bounds for $v_{BC}$ are $[0, 10]$. The directionality code is $+1$.\n- LP solution:\n  The constraints are $v_{\\mathrm{in}} = v_{AB} = v_{BC}$.\n  The bounds are $0 \\le v_{\\mathrm{in}} \\le 5$, $0 \\le v_{AB} \\le 10$, $0 \\le v_{BC} \\le 10$. The tightest upper bound is from $v_{\\mathrm{in}}$, so $v_{\\mathrm{in}} = v_{AB} = v_{BC} \\le 5$.\n  From $v_{BC} = v_{\\mathrm{bio}} + v_{\\mathrm{out}}$, to maximize $v_{\\mathrm{bio}}$, we must minimize $v_{\\mathrm{out}}$. The minimum is $v_{\\mathrm{out}} = 0$.\n  This yields $v_{\\mathrm{bio}} = v_{BC}$. The maximum possible value for $v_{BC}$ is $5\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$.\n  Thus, the maximum biomass flux is $v_{\\mathrm{bio}} = 5.0$.\n- Result for Case 1: ($v_{\\mathrm{bio}} = 5.0$, $d_{AB} = +1$, $d_{BC} = +1$)\n\n**Case 2:**\n- Concentrations: $[A] = 10^{-6}\\,\\mathrm{M}$, $[B] = 10^{-3}\\,\\mathrm{M}$, $[C] = 10^{-6}\\,\\mathrm{M}$.\n- Reaction quotients:\n  $$Q_{AB} = \\frac{[B]}{[A]} = \\frac{10^{-3}}{10^{-6}} = 1000$$\n  $$Q_{BC} = \\frac{[C]}{[B]} = \\frac{10^{-6}}{10^{-3}} = 0.001$$\n- Gibbs free energy changes:\n  $$\\Delta G_{AB} = -5 + (2.57734) \\ln(1000) \\approx -5 + 17.804 = +12.804\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n  $$\\Delta G_{BC} = +2 + (2.57734) \\ln(0.001) \\approx +2 - 17.804 = -15.804\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n- Directionality:\n  Since $\\Delta G_{AB} \\gg +\\varepsilon$, $R_{AB}$ is reverse-only. The new bounds for $v_{AB}$ are $[-10, 0]$. The directionality code is $-1$.\n  Since $\\Delta G_{BC} \\ll -\\varepsilon$, $R_{BC}$ is forward-only. The new bounds for $v_{BC}$ are $[0, 10]$. The directionality code is $+1$.\n- LP solution:\n  The constraints are $v_{\\mathrm{in}} = v_{AB} = v_{BC}$.\n  The bounds require $v_{\\mathrm{in}} \\ge 0$, $v_{AB} \\le 0$, and $v_{BC} \\ge 0$.\n  The only value satisfying $v \\ge 0$ and $v \\le 0$ simultaneously is $v=0$.\n  Therefore, $v_{\\mathrm{in}} = v_{AB} = v_{BC} = 0$.\n  From $v_{BC} - v_{\\mathrm{bio}} - v_{\\mathrm{out}} = 0$, we get $0 - v_{\\mathrm{bio}} - v_{\\mathrm{out}} = 0$. Since $v_{\\mathrm{bio}} \\ge 0$ and $v_{\\mathrm{out}} \\ge 0$, the only solution is $v_{\\mathrm{bio}} = 0$ and $v_{\\mathrm{out}} = 0$.\n  The maximum biomass flux is $v_{\\mathrm{bio}} = 0.0$.\n- Result for Case 2: ($v_{\\mathrm{bio}} = 0.0$, $d_{AB} = -1$, $d_{BC} = +1$)\n\n**Case 3:**\n- Concentrations: $[A] = 10^{-3}\\,\\mathrm{M}$, $[B] = 10^{-4}\\,\\mathrm{M}$, and $[C] = [B] \\cdot \\exp\\!\\left(-\\frac{\\Delta G^\\circ_{BC}}{R T}\\right)$.\n- Reaction quotients:\n  $Q_{AB} = \\frac{[B]}{[A]} = \\frac{10^{-4}}{10^{-3}} = 0.1$.\n  $Q_{BC} = \\frac{[C]}{[B]} = \\exp\\!\\left(-\\frac{\\Delta G^\\circ_{BC}}{R T}\\right)$.\n- Gibbs free energy changes:\n  $\\Delta G_{AB}$ is the same as in Case 1: $\\Delta G_{AB} \\approx -10.934\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$.\n  For $R_{BC}$:\n  $$\\Delta G_{BC} = \\Delta G^\\circ_{BC} + RT \\ln(Q_{BC}) = \\Delta G^\\circ_{BC} + RT \\ln\\left(\\exp\\left(-\\frac{\\Delta G^\\circ_{BC}}{R T}\\right)\\right)$$\n  $$\\Delta G_{BC} = \\Delta G^\\circ_{BC} + RT \\left(-\\frac{\\Delta G^\\circ_{BC}}{R T}\\right) = \\Delta G^\\circ_{BC} - \\Delta G^\\circ_{BC} = 0\\,\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$$\n- Directionality:\n  Since $\\Delta G_{AB} \\ll -\\varepsilon$, $R_{AB}$ is forward-only. The new bounds for $v_{AB}$ are $[0, 10]$. The directionality code is $+1$.\n  Since $|\\Delta G_{BC}| = 0 < \\varepsilon$, $R_{BC}$ is reversible. The bounds for $v_{BC}$ remain $[-10, 10]$. The directionality code is $0$.\n- LP solution:\n  The constraints are $v_{\\mathrm{in}} = v_{AB} = v_{BC}$.\n  The bounds are $0 \\le v_{\\mathrm{in}} \\le 5$, $0 \\le v_{AB} \\le 10$, $-10 \\le v_{BC} \\le 10$.\n  Again, the limiting flux is $v_{\\mathrm{in}}$, so $v_{\\mathrm{in}} = v_{AB} = v_{BC} \\le 5$. Since $v_{in} \\ge 0$, we have $0 \\le v_{BC} \\le 5$.\n  To maximize $v_{\\mathrm{bio}}$ from $v_{BC} = v_{\\mathrm{bio}} + v_{\\mathrm{out}}$, we set $v_{\\mathrm{out}} = 0$.\n  This gives $v_{\\mathrm{bio}} = v_{BC}$. The maximum value is $5\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$.\n  The maximum biomass flux is $v_{\\mathrm{bio}} = 5.0$.\n- Result for Case 3: ($v_{\\mathrm{bio}} = 5.0$, $d_{AB} = +1$, $d_{BC} = 0$)\n\nThe final output is a concatenation of these results.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of flux balance analysis problems with thermodynamic constraints.\n    \"\"\"\n    # Define constants and fixed parameters\n    R = 0.008314  # Gas constant in kJ mol^-1 K^-1\n    T = 310.0      # Temperature in K\n    EPSILON = 1e-3 # Tolerance for Gibbs free energy in kJ mol^-1\n    \n    # Standard Gibbs free energy changes in kJ mol^-1\n    DG_CIRC_AB = -5.0\n    DG_CIRC_BC = 2.0\n    \n    # Stoichiometric matrix S\n    # Rows: A, B, C\n    # Cols: R_in, R_AB, R_BC, R_bio, R_out\n    S = np.array([\n        [1, -1, 0, 0, 0],\n        [0, 1, -1, 0, 0],\n        [0, 0, 1, -1, -1]\n    ])\n    \n    # Base flux bounds (in mmol gDW^-1 h^-1)\n    # v_in, v_AB, v_BC, v_bio, v_out\n    base_bounds = [\n        (0, 5.0),\n        (-10.0, 10.0),\n        (-10.0, 10.0),\n        (0, 10.0),\n        (0, 10.0)\n    ]\n    \n    # Objective function: Maximize v_bio, which is to minimize -v_bio\n    c = np.array([0, 0, 0, -1, 0])\n    \n    # Equality constraints: Sv = 0\n    A_eq = S\n    b_eq = np.zeros(S.shape[0])\n\n    # Test cases: intracellular concentrations [A], [B], [C] in M\n    # Case 3 [C] is calculated programmatically.\n    test_cases = [\n        # Case 1\n        {'A': 1e-3, 'B': 1e-4, 'C': 1e-6},\n        # Case 2\n        {'A': 1e-6, 'B': 1e-3, 'C': 1e-6},\n        # Case 3\n        {'A': 1e-3, 'B': 1e-4, 'C': (1e-4 * np.exp(-DG_CIRC_BC / (R * T)))},\n    ]\n\n    final_results = []\n\n    for case_concs in test_cases:\n        conc_A = case_concs['A']\n        conc_B = case_concs['B']\n        conc_C = case_concs['C']\n        \n        # 1. Compute Delta G for internal reactions\n        RT = R * T\n        \n        # Reaction R_AB: A -> B\n        Q_AB = conc_B / conc_A\n        delta_G_AB = DG_CIRC_AB + RT * np.log(Q_AB)\n        \n        # Reaction R_BC: B -> C\n        Q_BC = conc_C / conc_B\n        delta_G_BC = DG_CIRC_BC + RT * np.log(Q_BC)\n\n        # 2. Determine directionality and update flux bounds\n        bounds = list(base_bounds) # Create a mutable copy\n        \n        # Directionality for R_AB (index 1)\n        dir_AB = 0\n        if delta_G_AB <= -EPSILON:\n            bounds[1] = (0, bounds[1][1]) # Forward only\n            dir_AB = 1\n        elif delta_G_AB >= EPSILON:\n            bounds[1] = (bounds[1][0], 0) # Reverse only\n            dir_AB = -1\n        \n        # Directionality for R_BC (index 2)\n        dir_BC = 0\n        if delta_G_BC <= -EPSILON:\n            bounds[2] = (0, bounds[2][1]) # Forward only\n            dir_BC = 1\n        elif delta_G_BC >= EPSILON:\n            bounds[2] = (bounds[2][0], 0) # Reverse only\n            dir_BC = -1\n            \n        # 3. Solve the linear program\n        res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        # res.fun is the minimum of -v_bio. We want max v_bio.\n        max_v_bio = -res.fun if res.success else 0.0\n        \n        # 4. Store results for this case\n        final_results.extend([f\"{max_v_bio:.6f}\", str(dir_AB), str(dir_BC)])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```", "id": "4399339"}]}