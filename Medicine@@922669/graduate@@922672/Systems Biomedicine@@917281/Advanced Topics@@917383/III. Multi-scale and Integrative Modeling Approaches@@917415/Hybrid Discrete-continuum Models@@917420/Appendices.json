{"hands_on_practices": [{"introduction": "To begin, we explore the most fundamental interaction in a hybrid model: the influence of a single, static agent on a continuous field. This exercise asks you to derive the steady-state concentration profile of a signaling molecule secreted by a cell modeled as a point source in one dimension [@problem_id:4353438]. By solving this reaction-diffusion problem analytically, you will gain insight into the balance between molecular diffusion and degradation, leading to the fundamentally important concept of a characteristic decay length, $\\ell = \\sqrt{D/\\lambda}$.", "problem": "Consider a hybrid discrete-continuum model of a secreted signaling molecule along a one-dimensional extracellular tract (for example, a collagen fiber) in systems biomedicine. A single secreting cell located at position $x=0$ is represented discretely as a point source, while the extracellular concentration field $C(x,t)$ is modeled as a continuum. The field obeys conservation of mass and Fick’s law of diffusion: the flux is $J(x,t) = -D\\,\\partial C/\\partial x$ with diffusion coefficient $D>0$, and the molecule is degraded in the extracellular space with a first-order rate constant $\\lambda>0$. The cell secretes at a constant rate $q>0$. The one-dimensional balance of mass yields the partial differential equation (PDE)\n$$\n\\frac{\\partial C}{\\partial t} = -\\frac{\\partial J}{\\partial x} - \\lambda C + q\\,\\delta(x),\n$$\nwhere $\\delta(x)$ is the Dirac delta distribution and $x \\in \\mathbb{R}$. Assume the system reaches a steady state on an infinite domain with $C(x)\\to 0$ as $|x|\\to \\infty$.\n\nStarting from the stated physical laws and definitions, derive the steady-state concentration profile $C(x)$ generated by the point source. Your derivation must treat the point source via the Dirac delta distribution and enforce physically appropriate boundary conditions at infinity. Express your final steady-state solution $C(x)$ in terms of the spatial coordinate $x$ and the parameters $D$, $\\lambda$, and $q$, and write it using the characteristic decay length $\\ell$ defined by the continuum-reaction balance. Briefly explain the physical meaning of $\\ell$ during your derivation, but report only the analytical expression for $C(x)$ as your final answer. Do not include units in your final expression. No numerical evaluation or rounding is required.", "solution": "The problem requires the derivation of the steady-state concentration profile $C(x)$ for a signaling molecule in a one-dimensional domain, governed by a reaction-diffusion equation with a point source.\n\nThe starting point is the governing partial differential equation (PDE) for the concentration field $C(x,t)$, which combines Fick's law of diffusion, first-order degradation, and a point source secretion:\n$$\n\\frac{\\partial C}{\\partial t} = -\\frac{\\partial J}{\\partial x} - \\lambda C + q\\,\\delta(x)\n$$\nThe flux $J(x,t)$ is given by Fick's law as $J(x,t) = -D\\frac{\\partial C}{\\partial x}$. Substituting this into the conservation equation yields:\n$$\n\\frac{\\partial C}{\\partial t} = -\\frac{\\partial}{\\partial x}\\left(-D\\frac{\\partial C}{\\partial x}\\right) - \\lambda C + q\\,\\delta(x)\n$$\n$$\n\\frac{\\partial C}{\\partial t} = D\\frac{\\partial^2 C}{\\partial x^2} - \\lambda C + q\\,\\delta(x)\n$$\nwhere $D > 0$ is the diffusion coefficient, $\\lambda > 0$ is the degradation rate constant, $q > 0$ is the secretion rate, and $\\delta(x)$ is the Dirac delta distribution representing the point source at $x=0$.\n\nThe problem asks for the steady-state solution, which is achieved when the concentration profile no longer changes with time. We set the time derivative to zero, $\\frac{\\partial C}{\\partial t} = 0$. Let $C(x)$ denote the steady-state concentration profile. The PDE reduces to a second-order ordinary differential equation (ODE):\n$$\nD\\frac{d^2 C}{dx^2} - \\lambda C + q\\,\\delta(x) = 0\n$$\nTo solve this equation, we first consider the regions where the source term is zero, i.e., for $x \\neq 0$. In these regions, the ODE is homogeneous:\n$$\nD\\frac{d^2 C}{dx^2} - \\lambda C = 0 \\quad \\text{for } x \\neq 0\n$$\nRearranging this equation gives:\n$$\n\\frac{d^2 C}{dx^2} - \\frac{\\lambda}{D} C = 0\n$$\nThis equation reveals a characteristic length scale that emerges from the balance between diffusion (parameter $D$) and reaction (parameter $\\lambda$). We define this characteristic decay length, $\\ell$, as:\n$$\n\\ell = \\sqrt{\\frac{D}{\\lambda}}\n$$\nPhysically, $\\ell$ represents the typical distance a molecule diffuses before it is degraded. A larger $\\ell$ implies that the signal propagates further from the source. The ODE can now be written in terms of $\\ell$:\n$$\n\\frac{d^2 C}{dx^2} - \\frac{1}{\\ell^2} C = 0\n$$\nThe characteristic equation for this ODE is $r^2 - \\frac{1}{\\ell^2} = 0$, which has roots $r = \\pm \\frac{1}{\\ell}$. The general solution is a linear combination of exponential functions:\n$$\nC(x) = A \\exp\\left(\\frac{x}{\\ell}\\right) + B \\exp\\left(-\\frac{x}{\\ell}\\right)\n$$\nwhere $A$ and $B$ are integration constants that may differ for the regions $x < 0$ and $x > 0$. We must apply the boundary conditions specified for the infinite domain: $C(x) \\to 0$ as $|x| \\to \\infty$.\n\nFor the region $x > 0$, as $x \\to \\infty$, the term $\\exp(x/\\ell)$ grows unboundedly. To satisfy the boundary condition $C(x) \\to 0$, its coefficient must be zero. Thus, for $x > 0$:\n$$\nC(x) = B_+ \\exp\\left(-\\frac{x}{\\ell}\\right)\n$$\nFor the region $x < 0$, as $x \\to -\\infty$, the term $\\exp(-x/\\ell)$ grows unboundedly. To satisfy the boundary condition, its coefficient must be zero. Thus, for $x < 0$:\n$$\nC(x) = A_- \\exp\\left(\\frac{x}{\\ell}\\right)\n$$\nNext, we must connect these two solutions at the source location, $x=0$. Two conditions are required. The first is that the concentration field must be physically continuous at the source:\n$$\n\\lim_{x \\to 0^+} C(x) = \\lim_{x \\to 0^-} C(x)\n$$\n$$\nB_+ \\exp(0) = A_- \\exp(0) \\implies B_+ = A_-\n$$\nLet us denote this common constant by $K$. The solution can then be written as a single expression using the absolute value function:\n$$\nC(x) = K \\exp\\left(-\\frac{|x|}{\\ell}\\right)\n$$\nThe second condition is derived by integrating the full inhomogeneous ODE across the source at $x=0$. We integrate from $-\\epsilon$ to $+\\epsilon$ for some small $\\epsilon > 0$ and then consider the limit as $\\epsilon \\to 0$:\n$$\n\\int_{-\\epsilon}^{\\epsilon} \\left( D\\frac{d^2 C}{dx^2} - \\lambda C + q\\,\\delta(x) \\right) dx = 0\n$$\n$$\nD \\int_{-\\epsilon}^{\\epsilon} \\frac{d^2 C}{dx^2} dx - \\lambda \\int_{-\\epsilon}^{\\epsilon} C(x) dx + q \\int_{-\\epsilon}^{\\epsilon} \\delta(x) dx = 0\n$$\nEvaluating each term in the limit $\\epsilon \\to 0$:\nThe first term becomes $D \\left[ \\frac{dC}{dx} \\right]_{-\\epsilon}^{\\epsilon} = D \\left( \\left.\\frac{dC}{dx}\\right|_{x=\\epsilon} - \\left.\\frac{dC}{dx}\\right|_{x=-\\epsilon} \\right)$, which in the limit is the jump in the derivative at $x=0$, i.e., $D (\\left.C'\\right|_{0^+} - \\left.C'\\right|_{0^-})$.\nThe second term vanishes because $C(x)$ is continuous and finite at $x=0$, so the integral $\\int_{-\\epsilon}^{\\epsilon} C(x) dx \\to 0$ as $\\epsilon \\to 0$.\nThe third term, by the sifting property of the Dirac delta function, is $q \\int_{-\\epsilon}^{\\epsilon} \\delta(x) dx = q \\cdot 1 = q$.\n\nThe integrated equation thus provides the jump condition for the derivative:\n$$\nD \\left( \\left.\\frac{dC}{dx}\\right|_{0^+} - \\left.\\frac{dC}{dx}\\right|_{0^-} \\right) + q = 0 \\implies \\left.\\frac{dC}{dx}\\right|_{0^+} - \\left.\\frac{dC}{dx}\\right|_{0^-} = -\\frac{q}{D}\n$$\nThis condition reflects the conservation of mass at the source: the discontinuity in diffusive flux, $-D\\frac{dC}{dx}$, must balance the source rate $q$.\n\nWe now compute the derivatives of our solution $C(x) = K \\exp(-|x|/\\ell)$:\nFor $x > 0$, $C(x) = K \\exp(-x/\\ell)$, so $\\frac{dC}{dx} = -\\frac{K}{\\ell} \\exp(-x/\\ell)$. Thus, $\\left.\\frac{dC}{dx}\\right|_{0^+} = -\\frac{K}{\\ell}$.\nFor $x < 0$, $C(x) = K \\exp(x/\\ell)$, so $\\frac{dC}{dx} = \\frac{K}{\\ell} \\exp(x/\\ell)$. Thus, $\\left.\\frac{dC}{dx}\\right|_{0^-} = \\frac{K}{\\ell}$.\n\nSubstituting these into the jump condition:\n$$\n\\left(-\\frac{K}{\\ell}\\right) - \\left(\\frac{K}{\\ell}\\right) = -\\frac{q}{D}\n$$\n$$\n-\\frac{2K}{\\ell} = -\\frac{q}{D}\n$$\nSolving for the constant $K$:\n$$\nK = \\frac{q\\ell}{2D}\n$$\nFinally, substituting this value of $K$ back into the expression for $C(x)$ gives the steady-state concentration profile:\n$$\nC(x) = \\frac{q\\ell}{2D} \\exp\\left(-\\frac{|x|}{\\ell}\\right)\n$$\nThis expression describes an exponential decay of the concentration away from the source, with the characteristic decay length set by $\\ell = \\sqrt{D/\\lambda}$.", "answer": "$$\\boxed{\\frac{q\\ell}{2D} \\exp\\left(-\\frac{|x|}{\\ell}\\right)}$$", "id": "4353438"}, {"introduction": "Building on the one-dimensional case, we now examine the profile generated by a point source in a two-dimensional plane, which is more representative of cell culture environments [@problem_id:4353352]. This problem reveals a crucial difference from the 1D case: a logarithmic singularity at the source. Understanding the origin and implications of this singularity is key to appreciating the conceptual interface between the discrete agent and the continuum field, representing the breakdown of the continuum description at the cellular scale.", "problem": "Consider a hybrid discrete-continuum model in systems biomedicine where a single stationary cell located at the origin acts as a localized source term for a diffusible nutrient field in a planar tissue. The continuum nutrient concentration $c(\\mathbf{x})$ is governed at steady state by the partial differential equation (PDE)\n$$\n\\nabla^2 c(\\mathbf{x}) = \\alpha\\,\\delta(\\mathbf{x}),\n$$\nin the infinite two-dimensional domain $\\mathbb{R}^2$, where $\\alpha$ is a real constant and $\\delta(\\mathbf{x})$ is the Dirac delta distribution centered at the origin. Assume isotropy so that $c(\\mathbf{x}) = c(r)$ depends only on radial distance $r = |\\mathbf{x}|$. Because the infinite two-dimensional domain does not permit a finite boundary condition at infinity for a point source, fix the additive constant by imposing the reference condition $c(R) = 0$ at a specified macroscopic radius $R > 0$. \n\nStarting from the fundamental properties of the Laplacian operator and the Dirac delta distribution, compute the explicit steady-state nutrient concentration profile $c(r)$ for $r > 0$, expressed in terms of $r$, $R$, and $\\alpha$. Additionally, using only first principles, characterize the leading-order behavior of $c(r)$ in the limit $r \\to 0^+$ and explain its physical interpretation in the context of hybrid discrete-continuum coupling. \n\nExpress your final profile $c(r)$ as a single closed-form analytic expression. No numerical rounding is required.", "solution": "The steady-state nutrient concentration $c(\\mathbf{x})$ is governed by the Poisson equation in two dimensions:\n$$\n\\nabla^2 c(\\mathbf{x}) = \\alpha\\,\\delta(\\mathbf{x})\n$$\nwhere $\\mathbf{x} \\in \\mathbb{R}^2$, $\\alpha$ is a constant representing the source strength, and $\\delta(\\mathbf{x})$ is the Dirac delta distribution. The problem states that the solution is isotropic, meaning $c(\\mathbf{x}) = c(r)$, where $r = |\\mathbf{x}| = \\sqrt{x_1^2 + x_2^2}$ is the radial distance from the origin.\n\nFor any region not including the origin (i.e., for $r > 0$), the Dirac delta term is zero, $\\delta(\\mathbf{x}) = 0$. In this region, the governing equation simplifies to Laplace's equation:\n$$\n\\nabla^2 c(r) = 0 \\quad \\text{for } r > 0\n$$\nTo solve this, we express the Laplacian operator $\\nabla^2$ in polar coordinates $(r, \\theta)$. The general form is $\\nabla^2 = \\frac{1}{r}\\frac{\\partial}{\\partial r}\\left(r\\frac{\\partial}{\\partial r}\\right) + \\frac{1}{r^2}\\frac{\\partial^2}{\\partial \\theta^2}$. Due to the radial symmetry, the concentration $c$ does not depend on the angle $\\theta$, so the term $\\frac{\\partial^2 c}{\\partial \\theta^2}$ vanishes. The PDE thus becomes an ordinary differential equation (ODE) in $r$:\n$$\n\\frac{1}{r}\\frac{d}{dr}\\left(r\\frac{dc}{dr}\\right) = 0\n$$\nFor this equation to hold for $r>0$, the term in the parentheses must be a constant. Let this constant be $A$:\n$$\nr\\frac{dc}{dr} = A\n$$\nSeparating variables and integrating gives:\n$$\n\\frac{dc}{dr} = \\frac{A}{r}\n$$\nIntegrating a second time with respect to $r$ yields the general solution for $c(r)$:\n$$\nc(r) = A \\ln(r) + B\n$$\nwhere $A$ and $B$ are constants of integration. This is the fundamental solution to the 2D Laplace equation in a radially symmetric setting.\n\nTo determine the constant $A$, we must relate it to the source strength $\\alpha$. We integrate the original Poisson equation over a small disk $D_\\epsilon$ of radius $\\epsilon$ centered at the origin.\n$$\n\\iint_{D_\\epsilon} \\nabla^2 c(\\mathbf{x}) \\, d^2x = \\iint_{D_\\epsilon} \\alpha\\,\\delta(\\mathbf{x}) \\, d^2x\n$$\nBy the defining property of the Dirac delta distribution, the integral on the right-hand side is simply $\\alpha$.\n$$\n\\iint_{D_\\epsilon} \\alpha\\,\\delta(\\mathbf{x}) \\, d^2x = \\alpha\n$$\nFor the left-hand side, we apply the 2D Divergence Theorem (a special case of Green's theorem), which states $\\iint_D \\nabla \\cdot \\mathbf{F} \\, d^2x = \\oint_{\\partial D} \\mathbf{F} \\cdot \\mathbf{\\hat{n}} \\, ds$. Letting $\\mathbf{F} = \\nabla c$, we have:\n$$\n\\iint_{D_\\epsilon} \\nabla^2 c \\, d^2x = \\oint_{\\partial D_\\epsilon} \\nabla c \\cdot \\mathbf{\\hat{n}} \\, ds\n$$\nHere, $\\partial D_\\epsilon$ is the circle of radius $\\epsilon$, $\\mathbf{\\hat{n}}$ is the outward unit normal vector (which is the radial unit vector $\\mathbf{\\hat{r}}$), and $ds$ is the element of arc length. The gradient in polar coordinates for a radially symmetric function is $\\nabla c = \\frac{dc}{dr}\\mathbf{\\hat{r}}$.\nThe integral becomes:\n$$\n\\oint_{\\partial D_\\epsilon} \\left(\\frac{dc}{dr}\\mathbf{\\hat{r}}\\right) \\cdot \\mathbf{\\hat{r}} \\, ds = \\oint_{\\partial D_\\epsilon} \\frac{dc}{dr} \\, ds\n$$\nWe substitute $\\frac{dc}{dr} = \\frac{A}{r}$. At $r=\\epsilon$, the integrand is constant, $\\frac{A}{\\epsilon}$. The path of integration is a circle of circumference $2\\pi\\epsilon$.\n$$\n\\oint_{\\partial D_\\epsilon} \\frac{A}{\\epsilon} \\, ds = \\frac{A}{\\epsilon} \\int_0^{2\\pi} \\epsilon \\, d\\theta = \\frac{A}{\\epsilon}(2\\pi\\epsilon) = 2\\pi A\n$$\nEquating the results from the left and right sides of the integrated Poisson equation gives:\n$$\n2\\pi A = \\alpha \\implies A = \\frac{\\alpha}{2\\pi}\n$$\nSo, the concentration profile is $c(r) = \\frac{\\alpha}{2\\pi}\\ln(r) + B$.\n\nTo determine the constant $B$, we use the specified reference condition $c(R) = 0$ for a given radius $R > 0$.\n$$\nc(R) = \\frac{\\alpha}{2\\pi}\\ln(R) + B = 0\n$$\nSolving for $B$:\n$$\nB = -\\frac{\\alpha}{2\\pi}\\ln(R)\n$$\nSubstituting $A$ and $B$ back into the expression for $c(r)$, we obtain the final explicit form of the concentration profile:\n$$\nc(r) = \\frac{\\alpha}{2\\pi}\\ln(r) - \\frac{\\alpha}{2\\pi}\\ln(R) = \\frac{\\alpha}{2\\pi}\\left(\\ln(r) - \\ln(R)\\right)\n$$\nUsing the properties of logarithms, this can be written as:\n$$\nc(r) = \\frac{\\alpha}{2\\pi}\\ln\\left(\\frac{r}{R}\\right)\n$$\n\nNext, we analyze the leading-order behavior of $c(r)$ in the limit $r \\to 0^+$. As $r$ approaches $0$ from the positive side, the argument of the logarithm, $\\frac{r}{R}$, also approaches $0$. The natural logarithm function $\\ln(x)$ approaches $-\\infty$ as its argument $x \\to 0^+$.\n$$\n\\lim_{r\\to 0^+} c(r) = \\lim_{r\\to 0^+} \\frac{\\alpha}{2\\pi}\\left(\\ln(r) - \\ln(R)\\right)\n$$\nAs $r \\to 0^+$, the $\\ln(r)$ term dominates the constant term $-\\ln(R)$. Therefore, the leading-order behavior is a logarithmic singularity:\n$$\nc(r) \\sim \\frac{\\alpha}{2\\pi}\\ln(r) \\quad \\text{as } r \\to 0^+\n$$\nThis reveals that the concentration diverges at the location of the point source.\n\nThe physical interpretation of this singularity is central to understanding hybrid discrete-continuum models. The continuum PDE model treats the cell as a mathematical point source with zero volume, represented by the Dirac delta distribution $\\delta(\\mathbf{x})$. The logarithmic divergence of the nutrient concentration at $r=0$ is a direct and unavoidable mathematical consequence of this idealization. A physical cell, however, has a finite size. The concentration of a nutrient cannot be infinite anywhere, including at the cell's surface. This singularity signifies the breakdown of the continuum description at length scales comparable to and smaller than the cell itself.\n\nIn a hybrid discrete-continuum framework, this is precisely the interface where the discrete and continuum descriptions must be coupled. The continuum model provides the far-field concentration, which exhibits a characteristic singular behavior as it approaches the discrete object (the cell). The discrete model for the cell, in turn, does not \"see\" an infinite concentration. Instead, a coupling condition is required. For instance, the cell's behavior (e.g., its rate of nutrient consumption or secretion, which determines $\\alpha$) might depend on the average concentration of the continuum field evaluated over its finite surface, or at a specific \"coupling radius\". The singularity thereby provides the necessary local information from the continuum field that drives the state of the discrete element, bridging the two scales of the hybrid model. It is an artifact of the mathematical representation that has a profound implication on how the two parts of the model must interact.", "answer": "$$\\boxed{\\frac{\\alpha}{2\\pi}\\ln\\left(\\frac{r}{R}\\right)}$$", "id": "4353352"}, {"introduction": "Moving from analytical solutions to computational models, this practice challenges you to build a full hybrid simulation from the ground up [@problem_id:4353262]. You will implement a model where a population of discrete agents consumes a diffusing nutrient, and their survival and proliferation depend on the local nutrient concentration. This hands-on coding exercise will solidify your understanding of how to couple PDE solvers with agent-based rules and provides a window into the emergent, collective behaviors that are the focus of much of systems biomedicine.", "problem": "Consider a hybrid discrete-continuum model for a diffusing nutrient field interacting with a set of discrete biological agents. Let the continuum field be the dimensionless nutrient concentration $c(\\mathbf{x},t)$ defined over a square domain $\\Omega = [0,1]^2$, and the discrete agents be indexed by $i=1,\\dots,N(t)$ with positions $\\mathbf{x}_i \\in \\Omega$. Start from the fundamental base of Fick's law of diffusion, which states that the diffusive flux is $\\mathbf{J} = -D \\nabla c$, where $D$ is a positive diffusion coefficient, and mass conservation, which states that accumulation equals inflow minus outflow plus sources minus sinks. Under these assumptions, the governing continuum equation for the nutrient is obtained by writing a diffusion term and subtracting localized uptake by agents, modeled as point sinks at agent locations. The uptake rate per agent is a function $\\lambda(c(\\mathbf{x}_i))$ of the local concentration at the agent's position, leading to the hybrid discrete-continuum partial differential equation\n$$\n\\partial_t c(\\mathbf{x},t) = D \\nabla^2 c(\\mathbf{x},t) - \\sum_{i=1}^{N(t)} \\lambda\\!\\big(c(\\mathbf{x}_i,t)\\big)\\,\\delta\\!\\big(\\mathbf{x}-\\mathbf{x}_i\\big),\n$$\nwhere $\\delta(\\cdot)$ is the Dirac delta distribution. Assume zero-flux (Neumann) boundary conditions on $\\partial \\Omega$ so that $\\partial_{\\mathbf{n}} c = 0$ holds, where $\\mathbf{n}$ is the outward normal.\n\nDefine the uptake function by Michaelis–Menten kinetics (MM): \n$$\n\\lambda(c) = k \\frac{c}{K + c},\n$$\nwith positive parameters $k$ and $K$. Agents do not move, but their population evolves via two rules based on local nutrient: apoptosis (death) and proliferation (division). Each agent $i$ has an integer age counter $a_i(t)$ (in time steps). At each time step, the rules are:\n- If the local nutrient $c(\\mathbf{x}_i,t)$ is less than or equal to a threshold $c_{\\mathrm{apop}}$, the agent undergoes apoptosis and is removed immediately.\n- If the local nutrient $c(\\mathbf{x}_i,t)$ is greater than or equal to a threshold $c_{\\mathrm{prolif}}$, the agent's age $a_i$ increases by one; otherwise, the age does not change. If $a_i$ reaches or exceeds a prescribed division interval $T_{\\mathrm{div}}$, the agent divides into two agents: the original agent resets its age to zero, and a new agent is created with age zero at position $\\mathbf{x}_i + (\\Delta x,0)$ if this lies inside $\\Omega$; otherwise at $\\mathbf{x}_i - (\\Delta x,0)$. Here $\\Delta x$ denotes the grid spacing defined below. If the new position would lie outside $\\Omega$, it must be clamped to remain within $\\Omega$.\n\nApproximate the continuum field numerically using a regular Cartesian grid with $N_x$ nodes in the $x$ direction and $N_y$ nodes in the $y$ direction, with grid spacings $\\Delta x = 1/(N_x-1)$ and $\\Delta y = 1/(N_y-1)$. Let $c_{j,k}^n$ denote the discrete approximation to $c$ at grid index $(j,k)$ and time step $n$. Approximate the Laplacian $ \\nabla^2 c $ with the standard $5$-point stencil and enforce the zero-flux boundary condition by using mirrored ghost values (equivalently, padding with edge values so that $\\partial_{\\mathbf{n}} c = 0$). Approximate $\\delta(\\mathbf{x}-\\mathbf{x}_i)$ by distributing each agent's uptake into the four nearest grid nodes using bilinear weights that sum to one. To preserve the correct physical scaling, divide the deposited uptake by the cell area $\\Delta x \\Delta y$ so that the discrete sink $S_{j,k}^n$ at a node represents a rate per unit area. Use an explicit forward Euler time integration,\n$$\nc^{n+1}_{j,k} = c^n_{j,k} + \\Delta t \\left( D \\nabla^2_{\\mathrm{FD}} c^n_{j,k} - S^n_{j,k} \\right),\n$$\nwith a time step $\\Delta t$ chosen to satisfy the standard stability restriction for two-dimensional diffusion on a uniform grid. For equal spacings $\\Delta x = \\Delta y$, enforce\n$$\n\\Delta t \\le \\frac{\\Delta x^2}{4 D}\n$$\nand for this assignment choose \n$$\n\\Delta t = 0.2 \\frac{\\Delta x^2}{4 D}\n$$\nfor numerical safety. The initial condition is uniform $c(\\mathbf{x},0) = 1$ everywhere in $\\Omega$, and initial agent ages are zero.\n\nImplement the above hybrid model and simulate it for a prescribed number of time steps $T$ for each of the following three test cases. All quantities are dimensionless; no physical units are used. For each test case, output the final number of living agents $N(T)$ as an integer.\n\nTest Suite:\n- Case A (general happy path):\n  - Domain and grid: $N_x = 64$, $N_y = 64$.\n  - Diffusion: $D = 10^{-3}$.\n  - Uptake parameters: $k = 5 \\times 10^{-2}$, $K = 10^{-1}$.\n  - Agent rules: $c_{\\mathrm{prolif}} = 0.7$, $c_{\\mathrm{apop}} = 0.2$, $T_{\\mathrm{div}} = 30$.\n  - Time steps: $T = 220$.\n  - Initial agents: two agents at positions $\\mathbf{x}_1=(0.5,0.5)$ and $\\mathbf{x}_2=(0.55,0.5)$ with ages $0$.\n- Case B (boundary-condition and high-consumption stress test):\n  - Domain and grid: $N_x = 64$, $N_y = 64$.\n  - Diffusion: $D = 10^{-3}$.\n  - Uptake parameters: $k = 2 \\times 10^{-1}$, $K = 5 \\times 10^{-2}$.\n  - Agent rules: $c_{\\mathrm{prolif}} = 0.6$, $c_{\\mathrm{apop}} = 0.4$, $T_{\\mathrm{div}} = 40$.\n  - Time steps: $T = 200$.\n  - Initial agents: two agents at positions $\\mathbf{x}_1=(0.02,0.02)$ and $\\mathbf{x}_2=(0.98,0.98)$ with ages $0$.\n- Case C (edge case with no agents):\n  - Domain and grid: $N_x = 64$, $N_y = 64$.\n  - Diffusion: $D = 10^{-3}$.\n  - Uptake parameters: $k = 10^{-1}$, $K = 10^{-1}$.\n  - Agent rules: $c_{\\mathrm{prolif}} = 0.9$, $c_{\\mathrm{apop}} = 0.1$, $T_{\\mathrm{div}} = 20$.\n  - Time steps: $T = 100$.\n  - Initial agents: none.\n\nYour program should produce a single line of output containing the final number of living agents for the three test cases as a comma-separated list enclosed in square brackets (e.g., $[N_A,N_B,N_C]$). No extra text or spaces should be printed beyond this exact format. The program must be self-contained and require no input from the user.", "solution": "The problem requires the implementation of a hybrid discrete-continuum model. This model consists of two primary components: a continuous partial differential equation (PDE) for a nutrient field and a set of discrete rules governing a population of biological agents. The two components are coupled: the agents consume the nutrient, creating localized sinks in the continuum field, and the local nutrient concentration, in turn, dictates the agents' survival and proliferation.\n\nThe solution is implemented as a numerical simulation that evolves the system state over a prescribed number of time steps, $T$. The core steps of the algorithm are outlined below.\n\n**1. System Initialization**\n\nFirst, we establish the simulation environment based on the provided parameters.\n- A two-dimensional Cartesian grid of size $N_y \\times N_x$ is defined to represent the spatial domain $\\Omega = [0,1]^2$. The grid spacings are $\\Delta x = 1/(N_x-1)$ and $\\Delta y = 1/(N_y-1)$.\n- The nutrient concentration field, $c(\\mathbf{x}, t)$, is discretized on this grid, denoted $c_{j,k}^n$, where $(j,k)$ are grid indices and $n$ is the time step index. It is initialized to a uniform value of $c_{j,k}^0 = 1$.\n- The time step $\\Delta t$ is determined by the explicit Euler stability condition for diffusion, with an additional safety factor of $0.2$:\n$$ \\Delta t = 0.2 \\frac{\\min(\\Delta x^2, \\Delta y^2)}{4D} $$\nFor this problem, $\\Delta x = \\Delta y$, simplifying the expression to $\\Delta t = 0.2 \\frac{\\Delta x^2}{4D}$.\n- The discrete agents are stored as a list or array, with each agent possessing state variables for its position $\\mathbf{x}_i \\in [0,1]^2$ and its integer age $a_i \\in \\mathbb{N}_0$. Initial agent positions are given, and initial ages are set to $a_i(0)=0$.\n\n**2. The Simulation Loop**\n\nThe simulation proceeds iteratively for $n = 0, 1, \\dots, T-1$. Each time step comprises three main parts: agent dynamics, sink term calculation, and PDE field update.\n\n**2.1. Agent Dynamics and Coupling (Discrete Part)**\n\nFor each agent $i$ with position $\\mathbf{x}_i$ and age $a_i$, its fate is determined by the local nutrient concentration $c(\\mathbf{x}_i, t^n)$. Since agent positions are continuous, $c(\\mathbf{x}_i, t^n)$ is approximated by bilinearly interpolating the values from the four nearest grid nodes surrounding $\\mathbf{x}_i$. Let $\\mathbf{x}_i = (x_i, y_i)$, and let $(j,k)$ be the indices of the bottom-left grid node, i.e., $j = \\lfloor x_i/\\Delta x \\rfloor$ and $k = \\lfloor y_i/\\Delta y \\rfloor$. Let $u = (x_i/\\Delta x) - j$ and $v = (y_i/\\Delta y) - k$ be the fractional distances. The local concentration is:\n$$ c(\\mathbf{x}_i) \\approx (1-u)(1-v)c_{k,j}^n + u(1-v)c_{k,j+1}^n + (1-u)v c_{k+1,j}^n + u v c_{k+1,j+1}^n $$\nBased on this value, the following rules are applied:\n- **Apoptosis:** If $c(\\mathbf{x}_i) \\le c_{\\mathrm{apop}}$, the agent is marked for removal from the population.\n- **Proliferation:** If the agent survives and $c(\\mathbf{x}_i) \\ge c_{\\mathrm{prolif}}$, its age is incremented: $a_i \\to a_i + 1$. If the updated age $a_i$ reaches or exceeds the division interval $T_{\\mathrm{div}}$, the agent divides. The parent agent's age is reset to $a_i=0$, and a new daughter agent is created with age $0$. The new agent is placed at $\\mathbf{x}_i + (\\Delta x, 0)$ if this position is within $\\Omega$, otherwise at $\\mathbf{x}_i - (\\Delta x, 0)$. The final position is clamped to the domain boundaries $[0,1]^2$.\n\nAll removals and additions are collected and applied simultaneously at the end of the agent update sub-step to ensure consistency.\n\n**2.2. Sink Term Calculation (Coupling)**\n\nThe agents' consumption of nutrients is modeled as a sink term $S^n_{j,k}$ in the PDE. This term is calculated for each surviving agent.\n- For each agent $i$, the uptake rate is given by the Michaelis-Menten function:\n$$ \\lambda_i = \\lambda(c(\\mathbf{x}_i)) = k \\frac{c(\\mathbf{x}_i)}{K + c(\\mathbf{x}_i)} $$\n- This point sink is distributed to the four nearest grid nodes $(k,j), (k,j+1), (k+1,j), (k+1,j+1)$ using the same bilinear weights as for interpolation. To maintain physical consistency, the total uptake rate $\\lambda_i$ is converted to a sink density by dividing by the grid cell area, $A_{cell} = \\Delta x \\Delta y$. The contribution of agent $i$ to the sink at node $(k,j)$ is therefore:\n$$ \\Delta S_{k,j} = \\frac{\\lambda_i}{\\Delta x \\Delta y} (1-u)(1-v) $$\nSimilar terms are added to the other three nodes. The total sink $S_{k,j}^n$ is the sum of contributions from all agents.\n\n**2.3. Field Update (Continuum Part)**\n\nThe concentration field is updated using the forward Euler method:\n$$ c_{j,k}^{n+1} = c_{j,k}^n + \\Delta t \\left( D (\\nabla^2 c^n)_{j,k} - S^n_{j,k} \\right) $$\n- The Laplacian operator, $\\nabla^2 c$, is approximated using the standard 5-point finite difference stencil on a uniform grid ($\\Delta x=\\Delta y$):\n$$ (\\nabla^2 c^n)_{j,k} \\approx \\frac{c_{j+1,k}^n + c_{j-1,k}^n + c_{j,k+1}^n + c_{j,k-1}^n - 4c_{j,k}^n}{\\Delta x^2} $$\n- The zero-flux Neumann boundary conditions, $\\partial_{\\mathbf{n}} c = 0$, are implemented by padding the concentration grid with its edge values. This is equivalent to setting ghost cell values equal to their adjacent interior cell values, e.g., $c_{-1,k} = c_{1,k}$ on the left boundary.\n- After the update, the concentration values are clipped to be non-negative, $c_{j,k}^{n+1} = \\max(0, c_{j,k}^{n+1})$, to prevent unphysical negative values that might arise from numerical imprecision.\n\nAfter $T$ time steps, the simulation terminates, and the final number of living agents, $N(T)$, is reported. This procedure is performed for each test case specified in the problem statement.", "answer": "```python\nimport numpy as np\n\ndef run_simulation(Nx, Ny, D, k, K, c_prolif, c_apop, T_div, T, initial_agents_pos):\n    \"\"\"\n    Runs a single simulation of the hybrid discrete-continuum model.\n    \"\"\"\n    # 1. Initialization\n    dx = 1.0 / (Nx - 1)\n    dy = 1.0 / (Ny - 1)  # dx is assumed equal to dy in the problem\n    dt = 0.2 * (dx**2) / (4 * D)\n    \n    # Concentration field c[y, x]\n    c = np.ones((Ny, Nx), dtype=np.float64)\n    \n    # Agents array: [x, y, age]\n    if initial_agents_pos:\n        agents = np.array([[pos[0], pos[1], 0.0] for pos in initial_agents_pos], dtype=np.float64)\n    else:\n        agents = np.empty((0, 3), dtype=np.float64)\n\n    # 2. Main simulation loop\n    for _ in range(T):\n        sinks = np.zeros_like(c)\n        \n        if agents.shape[0] > 0:\n            # 2.1. Agent Dynamics\n            # Get local concentration for each agent via bilinear interpolation\n            x_pos = agents[:, 0]\n            y_pos = agents[:, 1]\n            \n            x_scaled = x_pos / dx\n            y_scaled = y_pos / dy\n            \n            # Using min with Nx-2/Ny-2 ensures j+1/k+1 are valid indices\n            j = np.minimum(np.floor(x_scaled).astype(int), Nx - 2)\n            k = np.minimum(np.floor(y_scaled).astype(int), Ny - 2)\n\n            u = x_scaled - j\n            v = y_scaled - k\n            \n            # Vectorized bilinear interpolation for local concentration c_local\n            c_local = (1-v) * ((1-u) * c[k, j] + u * c[k, j+1]) + \\\n                      v * ((1-u) * c[k+1, j] + u * c[k+1, j+1])\n\n            # Apoptosis\n            apoptosis_mask = c_local <= c_apop\n            surviving_mask = ~apoptosis_mask\n            \n            # Proliferation\n            prolif_mask = c_local >= c_prolif\n            \n            # Filter to get data for agents that survive this step\n            agents = agents[surviving_mask]\n            c_local = c_local[surviving_mask]\n            prolif_mask = prolif_mask[surviving_mask]\n\n            if agents.shape[0] > 0:\n                # 2.2. Sink Calculation\n                lambda_vals = k * c_local / (K + c_local)\n                sink_per_area = lambda_vals / (dx * dy)\n\n                x_pos = agents[:, 0]\n                y_pos = agents[:, 1]\n                x_scaled = x_pos / dx\n                y_scaled = y_pos / dy\n                j = np.minimum(np.floor(x_scaled).astype(int), Nx - 2)\n                k = np.minimum(np.floor(y_scaled).astype(int), Ny - 2)\n                u = x_scaled - j\n                v = y_scaled - k\n\n                # Distribute sinks to 4 nearest neighbors using bilinear weights.\n                # np.add.at is used to handle multiple agents contributing to the same node.\n                np.add.at(sinks, (k, j), (1-u)*(1-v) * sink_per_area)\n                np.add.at(sinks, (k, j+1), u*(1-v) * sink_per_area)\n                np.add.at(sinks, (k+1, j), (1-u)*v * sink_per_area)\n                np.add.at(sinks, (k+1, j+1), u*v * sink_per_area)\n\n                # Update ages for agents that are in a proliferative environment\n                agents[prolif_mask, 2] += 1\n                \n                # Division\n                division_mask = agents[:, 2] >= T_div\n                dividing_agents = agents[division_mask]\n                \n                new_agents_list = []\n                if dividing_agents.shape[0] > 0:\n                    # Reset age of parent agents\n                    agents[division_mask, 2] = 0\n                    \n                    for agent in dividing_agents:\n                        x, y, _ = agent\n                        x_new = x + dx\n                        # If new position is outside, choose the other side\n                        if x_new > 1.0:\n                            x_new = x - dx\n                        \n                        # Clamp to ensure it remains within [0,1]\n                        x_new = np.clip(x_new, 0.0, 1.0)\n                        y_new = y\n                        \n                        new_agents_list.append([x_new, y_new, 0.0])\n                \n                # Update main agent array with new agents\n                if new_agents_list:\n                    agents = np.vstack([agents, np.array(new_agents_list, dtype=np.float64)])\n\n        # 2.3. Field Update\n        # Laplacian with Neumann BCs (padding with edge values)\n        c_padded = np.pad(c, 1, mode='edge')\n        lap_c = (c_padded[1:-1, :-2] + c_padded[1:-1, 2:] + \n                 c_padded[:-2, 1:-1] + c_padded[2:, 1:-1] - 4*c) / (dx**2)\n        \n        # Forward Euler time step\n        c += dt * (D * lap_c - sinks)\n        \n        # Ensure concentration is non-negative\n        np.clip(c, 0, None, out=c)\n    \n    return agents.shape[0]\n\ndef solve():\n    \"\"\"\n    Defines and runs the test cases, then prints the final results.\n    \"\"\"\n    test_cases = [\n        # Case A\n        {\n            'Nx': 64, 'Ny': 64, 'D': 1e-3, 'k': 5e-2, 'K': 1e-1,\n            'c_prolif': 0.7, 'c_apop': 0.2, 'T_div': 30, 'T': 220,\n            'initial_agents_pos': [(0.5, 0.5), (0.55, 0.5)]\n        },\n        # Case B\n        {\n            'Nx': 64, 'Ny': 64, 'D': 1e-3, 'k': 2e-1, 'K': 5e-2,\n            'c_prolif': 0.6, 'c_apop': 0.4, 'T_div': 40, 'T': 200,\n            'initial_agents_pos': [(0.02, 0.02), (0.98, 0.98)]\n        },\n        # Case C\n        {\n            'Nx': 64, 'Ny': 64, 'D': 1e-3, 'k': 1e-1, 'K': 1e-1,\n            'c_prolif': 0.9, 'c_apop': 0.1, 'T_div': 20, 'T': 100,\n            'initial_agents_pos': []\n        }\n    ]\n    \n    results = []\n    for params in test_cases:\n        final_agent_count = run_simulation(**params)\n        results.append(final_agent_count)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "4353262"}]}