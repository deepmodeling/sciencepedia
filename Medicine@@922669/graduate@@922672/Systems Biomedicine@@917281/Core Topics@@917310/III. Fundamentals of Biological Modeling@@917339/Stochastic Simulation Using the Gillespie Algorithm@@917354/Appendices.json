{"hands_on_practices": [{"introduction": "At the heart of any reaction network simulation is the need to track how the system's state changes over time. This first practice focuses on the fundamental bookkeeping of molecular counts. By constructing a stoichiometry matrix, we can create a powerful and compact representation of how each possible reaction alters the number of molecules of each species, laying the groundwork for understanding the deterministic state update step within the Gillespie algorithm [@problem_id:4388691].", "problem": "Consider a well-mixed, isothermal single-compartment biochemical reaction network with $3$ molecular species $A$, $B$, and $C$ undergoing the following reactions under stochastic mass-action kinetics in volume $V$:\n- Reaction $R_1$: $A \\to B$ with rate constant $k_1$.\n- Reaction $R_2$: $B \\to A$ with rate constant $k_2$.\n- Reaction $R_3$: $B + C \\to A$ with rate constant $k_3$.\n\nAssume the dynamics follow the Chemical Master Equation (CME) and are simulated using the Stochastic Simulation Algorithm (SSA). Starting from first principles of the CME and SSA, and the definition of stoichiometric state-change vectors, do the following:\n- Construct the stoichiometry matrix $S$ explicitly, specifying its ordering of reaction channels and species.\n- Using the representation of the state as a jump process with reaction counting processes, demonstrate how to compute the state update after a specified finite sequence of reaction firings.\n\nLet the initial molecular counts be $X(0) = (A(0), B(0), C(0)) = (80, 40, 25)$. Consider the following specific SSA trajectory segment: first $R_1$ fires $10$ times consecutively, then $R_3$ fires $15$ times consecutively, and finally $R_2$ fires $5$ times consecutively, with no other firings in between. Compute the final state vector $X_{\\text{final}} = (A_{\\text{final}}, B_{\\text{final}}, C_{\\text{final}})$ that results from this sequence. Report the final state as molecule counts. Do not include units in your final boxed answer. The answer does not require rounding.", "solution": "We begin from the Chemical Master Equation (CME) framework for a well-mixed reaction network with discrete molecular counts. In this setting, the system state is a random vector $X(t) \\in \\mathbb{N}_0^3$ representing the copy numbers of species $A$, $B$, and $C$ at time $t$. Each reaction channel $R_j$ has a propensity function $a_j(X(t))$ under stochastic mass-action kinetics and a stoichiometric state-change vector $\\nu_j \\in \\mathbb{Z}^3$ representing the net change in molecular counts when reaction $R_j$ fires once. The CME dynamics can be represented as a pure-jump Markov process with counting processes $N_j(t)$, one for each reaction channel, such that the state can be written as\n$$\nX(t) \\;=\\; X(0) \\;+\\; \\sum_{j=1}^{M} \\nu_j \\, N_j(t),\n$$\nwhere $M$ is the number of reactions. In the Stochastic Simulation Algorithm (SSA), each firing instantaneously increments some $N_j(t)$ by $1$ and updates the state by adding $\\nu_j$.\n\nDefine the stoichiometry matrix $S \\in \\mathbb{Z}^{3 \\times 3}$ by stacking the stoichiometric vectors as columns,\n$$\nS \\;=\\; \\begin{bmatrix} \\nu_1 & \\nu_2 & \\nu_3 \\end{bmatrix}.\n$$\nWe choose the reaction ordering $(R_1,R_2,R_3)$ and the species ordering $(A,B,C)$, so each column $j$ of $S$ is the net change in $(A,B,C)$ caused by one firing of $R_j$.\n\nWe derive each $\\nu_j$ from the reaction stoichiometry:\n- Reaction $R_1$: $A \\to B$. One molecule of $A$ is consumed and one molecule of $B$ is produced, with no change in $C$. Thus,\n$$\n\\nu_1 \\;=\\; \\begin{pmatrix} -1 \\\\ +1 \\\\ 0 \\end{pmatrix}.\n$$\n- Reaction $R_2$: $B \\to A$. One molecule of $B$ is consumed and one molecule of $A$ is produced, with no change in $C$. Thus,\n$$\n\\nu_2 \\;=\\; \\begin{pmatrix} +1 \\\\ -1 \\\\ 0 \\end{pmatrix}.\n$$\n- Reaction $R_3$: $B + C \\to A$. One molecule each of $B$ and $C$ are consumed and one molecule of $A$ is produced. Thus,\n$$\n\\nu_3 \\;=\\; \\begin{pmatrix} +1 \\\\ -1 \\\\ -1 \\end{pmatrix}.\n$$\n\nTherefore, the stoichiometry matrix is\n$$\nS \\;=\\; \\begin{pmatrix}\n-1 & +1 & +1 \\\\\n+1 & -1 & -1 \\\\\n0 & 0 & -1\n\\end{pmatrix},\n$$\nwith rows ordered as $(A,B,C)$ and columns ordered as $(R_1,R_2,R_3)$.\n\nTo compute a state update after a finite sequence of reaction firings, we use the jump representation. Let $n_j$ denote the total number of firings of reaction $R_j$ over the interval of interest. Then the net change in state over that interval is\n$$\n\\Delta X \\;=\\; \\sum_{j=1}^{3} \\nu_j \\, n_j \\;=\\; S \\, n,\n$$\nwhere $n = (n_1,n_2,n_3)^{\\top}$. This follows directly from additivity of jumps in the CME/SSA representation: each firing of $R_j$ adds $\\nu_j$, and summing over all firings yields $S n$.\n\nFor the specified SSA trajectory segment, the sequence is:\n- $R_1$ fires $10$ times, so $n_1 = 10$.\n- $R_3$ fires $15$ times, so $n_3 = 15$.\n- $R_2$ fires $5$ times, so $n_2 = 5$.\n\nHence,\n$$\nn \\;=\\; \\begin{pmatrix} 10 \\\\ 5 \\\\ 15 \\end{pmatrix}.\n$$\nCompute the net change\n$$\n\\Delta X \\;=\\; S n \\;=\\;\n\\begin{pmatrix}\n-1 & +1 & +1 \\\\\n+1 & -1 & -1 \\\\\n0 & 0 & -1\n\\end{pmatrix}\n\\begin{pmatrix} 10 \\\\ 5 \\\\ 15 \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n-1\\cdot 10 + 1\\cdot 5 + 1\\cdot 15 \\\\\n1\\cdot 10 - 1\\cdot 5 - 1\\cdot 15 \\\\\n0\\cdot 10 + 0\\cdot 5 - 1\\cdot 15\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n10 \\\\ -10 \\\\ -15\n\\end{pmatrix}.\n$$\n\nWith initial state $X(0) = (80,40,25)^{\\top}$, the final state is\n$$\nX_{\\text{final}} \\;=\\; X(0) + \\Delta X \\;=\\; \\begin{pmatrix} 80 \\\\ 40 \\\\ 25 \\end{pmatrix} + \\begin{pmatrix} 10 \\\\ -10 \\\\ -15 \\end{pmatrix} \\;=\\; \\begin{pmatrix} 90 \\\\ 30 \\\\ 10 \\end{pmatrix}.\n$$\n\nAs a consistency check, we can verify stepwise feasibility and equivalence to aggregation. Sequentially applying the specified firings:\n- After $10$ firings of $R_1$: $(A,B,C) = (80,40,25) + 10\\,(-1,+1,0) = (70,50,25)$.\n- After $15$ firings of $R_3$: $(A,B,C) = (70,50,25) + 15\\,(+1,-1,-1) = (85,35,10)$.\n- After $5$ firings of $R_2$: $(A,B,C) = (85,35,10) + 5\\,(+1,-1,0) = (90,30,10)$.\nThis matches the aggregated calculation $X(0) + S n$ and remains nonnegative at each step, confirming feasibility under the SSA framework.\n\nThus, the final state vector is $(90,30,10)$ in molecule counts.", "answer": "$$\\boxed{\\begin{pmatrix}90 & 30 & 10\\end{pmatrix}}$$", "id": "4388691"}, {"introduction": "With the state update mechanism in place, we now turn to the stochastic core of the Gillespie algorithm. This exercise guides you through a single, complete iteration of the simulation loop, from calculating reaction propensities to using random numbers to determine both the waiting time until the next event and which specific reaction will occur. Mastering this fundamental cycle is the key to understanding how the algorithm advances time and evolves the system stochastically [@problem_id:4388732].", "problem": "Consider a constitutive gene expression microcircuit in a single cell with two molecular species, messenger ribonucleic acid ($M$) and protein ($P$). The system is modeled as a continuous-time Markov chain governed by the Chemical Master Equation (CME) under mass-action kinetics. The Stochastic Simulation Algorithm (SSA; Gillespie algorithm) is applied. The reaction network is:\n1. $\\varnothing \\rightarrow M$ with stochastic rate constant $c_{1}$,\n2. $M \\rightarrow M + P$ with stochastic rate constant $c_{2}$,\n3. $M \\rightarrow \\varnothing$ with stochastic rate constant $c_{3}$,\n4. $P \\rightarrow \\varnothing$ with stochastic rate constant $c_{4}$.\n\nAssume the stochastic rate constants are $c_{1} = 0.05\\,\\mathrm{s}^{-1}$, $c_{2} = 0.50\\,\\mathrm{s}^{-1}$, $c_{3} = 0.10\\,\\mathrm{s}^{-1}$, and $c_{4} = 0.02\\,\\mathrm{s}^{-1}$. The initial molecular counts at time $t(0)$ are $x_{M}(0) = 3$ and $x_{P}(0) = 10$, and the initial time is $t(0) = 0\\,\\mathrm{s}$. For a single SSA iteration, use two independent uniform random variates on $(0,1)$ given by $r_{1} = \\exp(-2)$ and $r_{2} = 0.925$.\n\nStarting from the foundational definitions of propensity functions in the CME and the memoryless property of exponential waiting times governing SSA reaction times, perform one SSA iteration: compute propensities $a_{\\mu}(x)$ for $\\mu \\in \\{1,2,3,4\\}$, the total propensity $a_{0}$, the waiting time $\\tau$, the index $j$ of the next reaction, and the updated time and state after firing reaction $j$. Round the waiting time and the updated time to four significant figures, and express the updated time in seconds. Provide the final numerical values for $a_{0}$, $\\tau$, $j$, the updated time $t(0)+\\tau$, and the updated state $(x_{M}, x_{P})$.", "solution": "The problem requires the execution of a single iteration of the Stochastic Simulation Algorithm (SSA), also known as the Gillespie algorithm, for a given gene expression network. The state of the system is described by the vector of molecular counts $x(t) = (x_{M}(t), x_{P}(t))$, where $x_{M}$ is the number of messenger RNA molecules and $x_{P}$ is the number of protein molecules.\n\nThe four chemical reactions are:\n1. $R_1: \\varnothing \\xrightarrow{c_1} M$\n2. $R_2: M \\xrightarrow{c_2} M + P$\n3. $R_3: M \\xrightarrow{c_3} \\varnothing$\n4. $R_4: P \\xrightarrow{c_4} \\varnothing$\n\nThe initial state at time $t(0) = 0\\,\\mathrm{s}$ is given as $x(0) = (x_{M}(0), x_{P}(0)) = (3, 10)$. The stochastic rate constants are $c_{1} = 0.05\\,\\mathrm{s}^{-1}$, $c_{2} = 0.50\\,\\mathrm{s}^{-1}$, $c_{3} = 0.10\\,\\mathrm{s}^{-1}$, and $c_{4} = 0.02\\,\\mathrm{s}^{-1}$.\n\nThe first step of the SSA is to calculate the propensity function $a_{\\mu}(x)$ for each reaction $\\mu \\in \\{1, 2, 3, 4\\}$. The propensity function represents the probability, per unit time, that a specific reaction occurs given the current state $x$. For mass-action kinetics, the propensities are:\n- $a_{1}(x) = c_{1}$ (zeroth-order reaction)\n- $a_{2}(x) = c_{2} x_{M}$ (first-order reaction)\n- $a_{3}(x) = c_{3} x_{M}$ (first-order reaction)\n- $a_{4}(x) = c_{4} x_{P}$ (first-order reaction)\n\nWe evaluate these propensities at the initial state $x(0) = (3, 10)$:\n- $a_{1}(x(0)) = 0.05\\,\\mathrm{s}^{-1}$\n- $a_{2}(x(0)) = (0.50\\,\\mathrm{s}^{-1})(3) = 1.50\\,\\mathrm{s}^{-1}$\n- $a_{3}(x(0)) = (0.10\\,\\mathrm{s}^{-1})(3) = 0.30\\,\\mathrm{s}^{-1}$\n- $a_{4}(x(0)) = (0.02\\,\\mathrm{s}^{-1})(10) = 0.20\\,\\mathrm{s}^{-1}$\n\nThe total propensity, $a_{0}(x)$, is the sum of the individual propensities. It represents the rate of any reaction occurring.\n$$a_{0}(x(0)) = \\sum_{\\mu=1}^{4} a_{\\mu}(x(0)) = 0.05 + 1.50 + 0.30 + 0.20 = 2.05\\,\\mathrm{s}^{-1}$$\n\nThe second step is to generate two independent random numbers, $r_{1}$ and $r_{2}$, from a uniform distribution on $(0, 1)$. These are given as $r_{1} = \\exp(-2)$ and $r_{2} = 0.925$.\n\nThe waiting time $\\tau$ until the next reaction is an exponentially distributed random variable with rate $a_{0}(x)$. The memoryless property of the exponential distribution is fundamental here. We can generate $\\tau$ using the inversion method:\n$$\\tau = \\frac{1}{a_{0}(x)} \\ln\\left(\\frac{1}{r_{1}}\\right) = -\\frac{\\ln(r_{1})}{a_{0}(x)}$$\nSubstituting the given values for $r_{1}$ and the calculated $a_{0}(x(0))$:\n$$\\tau = -\\frac{\\ln(\\exp(-2))}{2.05} = -\\frac{-2}{2.05} = \\frac{2}{2.05} \\approx 0.975609756\\,\\mathrm{s}$$\nRounding to four significant figures as required, we get $\\tau \\approx 0.9756\\,\\mathrm{s}$.\n\nThe next reaction to occur, with index $j$, is determined using the second random number $r_{2}$. The index $j$ is the smallest integer satisfying the condition:\n$$\\sum_{\\mu=1}^{j} a_{\\mu}(x) \\ge r_{2} \\cdot a_{0}(x)$$\nFirst, we compute the target value:\n$$r_{2} \\cdot a_{0}(x(0)) = 0.925 \\cdot 2.05 = 1.89625$$\nNow we check the cumulative sum of propensities:\n- For $j=1$: $\\sum_{\\mu=1}^{1} a_{\\mu} = a_{1} = 0.05$. This is less than $1.89625$.\n- For $j=2$: $\\sum_{\\mu=1}^{2} a_{\\mu} = a_{1} + a_{2} = 0.05 + 1.50 = 1.55$. This is less than $1.89625$.\n- For $j=3$: $\\sum_{\\mu=1}^{3} a_{\\mu} = a_{1} + a_{2} + a_{3} = 1.55 + 0.30 = 1.85$. This is less than $1.89625$.\n- For $j=4$: $\\sum_{\\mu=1}^{4} a_{\\mu} = a_{1} + a_{2} + a_{3} + a_{4} = 1.85 + 0.20 = 2.05$. This is greater than or equal to $1.89625$.\n\nThe condition is satisfied for $j=4$. Thus, the next reaction to fire is $R_4$.\n\nThe final step is to update the system time and state.\nThe new time $t'$ is the sum of the old time and the waiting time $\\tau$:\n$$t' = t(0) + \\tau = 0\\,\\mathrm{s} + 0.9756\\,\\mathrm{s} = 0.9756\\,\\mathrm{s}$$\n\nThe new state $x'$ is obtained by adding the state-change vector $\\nu_j$ for reaction $j=4$ to the old state $x(0)$. The reaction $R_4: P \\rightarrow \\varnothing$ corresponds to a decrease of one molecule of protein $P$. The state-change vector is $\\nu_4 = (0, -1)$.\n$$x' = x(0) + \\nu_4 = (3, 10) + (0, -1) = (3, 9)$$\nThe updated state is $x_{M}' = 3$ and $x_{P}' = 9$.\n\nIn summary, the results of one SSA iteration are:\n- Total propensity $a_{0} = 2.05\\,\\mathrm{s}^{-1}$.\n- Waiting time $\\tau \\approx 0.9756\\,\\mathrm{s}$.\n- Index of next reaction $j=4$.\n- Updated time $t' \\approx 0.9756\\,\\mathrm{s}$.\n- Updated state $(x_{M}', x_{P}') = (3, 9)$.\n\nThese values are compiled for the final answer.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.05 & 0.9756 & 4 & 0.9756 & 3 & 9\n\\end{pmatrix}\n}\n$$", "id": "4388732"}, {"introduction": "The parameters of the Gillespie algorithm are not arbitrary; they are deeply rooted in the physical chemistry of the cellular environment. This final practice bridges the gap between the abstract simulation and biophysical reality by exploring how system volume affects reaction kinetics. You will investigate why changes in volume selectively alter the rates of bimolecular reactions over unimolecular ones, providing crucial insight into the role of molecular crowding in cellular processes [@problem_id:4388690].", "problem": "A single-cell cytosolic signaling module is modeled using the Gillespie algorithm (also known as the Stochastic Simulation Algorithm (SSA)). The module contains a protein species $A$ and an adaptor species $B$. In the current state, there are $X_A = 1000$ molecules of $A$ and $X_B = 300$ molecules of $B$. The cell volume is $V = 1.0 \\times 10^{-12}$ liters. Protein $A$ undergoes unimolecular degradation $A \\rightarrow \\varnothing$ with a macroscopic first-order rate constant $k_1 = 2.0 \\times 10^{-3} \\ \\mathrm{s}^{-1}$. Proteins $A$ and $B$ bind to form a complex $C$ via a bimolecular reaction $A + B \\rightarrow C$ with a macroscopic second-order rate constant $k_M = 1.0 \\times 10^{6} \\ \\mathrm{L \\ mol^{-1} \\ s^{-1}}$. Assume that the relationship between macroscopic rate constants (expressed per molar concentration) and stochastic rate constants (expressed per molecule) uses Avogadroâ€™s number $N_A = 6.02214076 \\times 10^{23} \\ \\mathrm{mol^{-1}}$ and the system volume $V$.\n\nThe cell undergoes osmotic shrinkage such that its volume is halved to $V/2$, while the molecule counts $X_A$ and $X_B$ remain the same at the instant of interest. Using the Gillespie framework and starting from first principles, compute the ratio of the expected waiting time to the next reaction event in the halved-volume state to that in the original-volume state. Round your answer to four significant figures. In your derivation, explicitly identify how halving the volume affects the SSA propensities of unimolecular versus bimolecular reactions and briefly interpret the biological implications of this change in terms of molecular collision frequency and reaction competition.", "solution": "The Gillespie algorithm (Stochastic Simulation Algorithm, or SSA) models the time evolution of a well-stirred chemical system by treating each reaction channel as a stochastic event. The key quantity in the SSA is the propensity, $a_j$, of each reaction. The total propensity, $a_0 = \\sum_j a_j$, determines the waiting time $\\tau$ to the next reaction event, which is drawn from an exponential distribution with mean $\\mathbb{E}[\\tau] = 1/a_0$.\n\nFirst, we must convert the given macroscopic rate constants ($k_1$, $k_M$) into stochastic rate constants ($c_1$, $c_2$) that are used to calculate the propensities from molecule counts.\n\nFor the unimolecular reaction $R_1: A \\rightarrow \\varnothing$, the macroscopic rate law is $v_1 = k_1 [A]$. The stochastic propensity function is $a_1 = c_1 X_A$. By equating the macroscopic rate (in terms of concentration change) with the average stochastic rate, we find that the stochastic rate constant $c_1$ is equal to the macroscopic rate constant $k_1$. Therefore, $c_1 = k_1 = 2.0 \\times 10^{-3} \\ \\mathrm{s}^{-1}$. This relationship is independent of volume.\n\nFor the bimolecular reaction $R_2: A + B \\rightarrow C$, the macroscopic rate law is $v_2 = k_M [A][B]$. The stochastic propensity function for distinct reactants is $a_2 = c_2 X_A X_B$. A comparison of rates shows that the stochastic rate constant $c_2$ is related to the macroscopic constant $k_M$ by $c_2 = \\frac{k_M}{N_A V}$. Unlike the unimolecular case, the stochastic rate constant for a bimolecular reaction is inversely proportional to the system volume $V$.\n\nNow, we calculate the propensities for the original volume, $V = 1.0 \\times 10^{-12} \\ \\mathrm{L}$. The state is $X_A = 1000$ and $X_B = 300$.\n\n**1. Propensities in Original Volume ($V$):**\n- **Reaction 1 (Degradation):** $a_1 = c_1 X_A = (2.0 \\times 10^{-3} \\ \\mathrm{s}^{-1}) \\times 1000 = 2.0 \\ \\mathrm{s}^{-1}$.\n- **Reaction 2 (Binding):** The stochastic rate constant is $c_2 = \\frac{k_M}{N_A V} = \\frac{1.0 \\times 10^{6} \\ \\mathrm{L \\ mol^{-1} \\ s^{-1}}}{(6.02214076 \\times 10^{23} \\ \\mathrm{mol^{-1}})(1.0 \\times 10^{-12} \\ \\mathrm{L})} \\approx 1.660539 \\times 10^{-6} \\ \\mathrm{molecule^{-1} s^{-1}}$. The propensity is $a_2 = c_2 X_A X_B = (1.660539 \\times 10^{-6}) \\times 1000 \\times 300 \\approx 0.498162 \\ \\mathrm{s}^{-1}$.\n\nThe total propensity for the original volume is $a_{0, \\text{orig}} = a_1 + a_2 = 2.0 + 0.498162 = 2.498162 \\ \\mathrm{s}^{-1}$.\n\n**2. Propensities in Halved Volume ($V' = V/2$):**\n- **Reaction 1 (Degradation):** The propensity $a'_1$ is unaffected by the volume change, so $a'_1 = a_1 = 2.0 \\ \\mathrm{s}^{-1}$.\n- **Reaction 2 (Binding):** The new stochastic rate constant is $c'_2 = \\frac{k_M}{N_A V'} = \\frac{k_M}{N_A (V/2)} = 2c_2$. The new propensity is $a'_2 = c'_2 X_A X_B = 2(c_2 X_A X_B) = 2a_2$. Thus, $a'_2 = 2 \\times 0.498162 \\ \\mathrm{s}^{-1} = 0.996324 \\ \\mathrm{s}^{-1}$.\n\nThe total propensity for the halved volume is $a_{0, \\text{half}} = a'_1 + a'_2 = 2.0 + 0.996324 = 2.996324 \\ \\mathrm{s}^{-1}$.\n\n**3. Ratio of Expected Waiting Times:**\nThe expected waiting time to the next reaction is $\\mathbb{E}[\\tau] = 1/a_0$. We need to compute the ratio $\\frac{\\mathbb{E}[\\tau_{\\text{half}}]}{\\mathbb{E}[\\tau_{\\text{orig}}]}$.\n$$\n\\text{Ratio} = \\frac{\\mathbb{E}[\\tau_{\\text{half}}]}{\\mathbb{E}[\\tau_{\\text{orig}}]} = \\frac{1/a_{0, \\text{half}}}{1/a_{0, \\text{orig}}} = \\frac{a_{0, \\text{orig}}}{a_{0, \\text{half}}}\n$$\nSubstituting the numerical values:\n$$\n\\text{Ratio} = \\frac{2.498162}{2.996324} \\approx 0.833742\n$$\nRounding to four significant figures, the ratio is $0.8337$.\n\n**Biological Interpretation**\nThe propensity of the unimolecular reaction ($A \\to \\varnothing$) is independent of volume because it represents an intrinsic process for a single molecule. In contrast, the propensity of the bimolecular reaction ($A+B \\to C$) is inversely proportional to volume. Halving the volume doubles the concentration of both $A$ and $B$, which doubles the rate of intermolecular collisions and thus doubles the bimolecular reaction propensity. The total system reactivity, $a_0$, increases, causing the average waiting time to the next reaction to decrease. Furthermore, the volume reduction selectively accelerates the bimolecular reaction relative to the unimolecular one. The probability of the next event being a binding event increases, demonstrating how physical parameters like cell volume can shift the balance of reaction networks and alter cellular behavior.", "answer": "$$\\boxed{0.8337}$$", "id": "4388690"}]}