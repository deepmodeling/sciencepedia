{"hands_on_practices": [{"introduction": "Raw read counts from an RNA-seq experiment are not directly comparable; they are confounded by both gene length and library sequencing depth. This exercise provides foundational practice in two common normalization methods, Reads/Fragments Per Kilobase per Million (RPKM/FPKM) and Transcripts Per Million (TPM), which are designed to correct for these biases. By working through the calculations [@problem_id:4351520], you will gain a first-hand understanding of why normalized units are essential and how they can drastically alter the apparent ranking of gene expression.", "problem": "A cohort study in systems biomedicine generates messenger ribonucleic acid (mRNA) profiles from two biological samples using high-throughput sequencing. For downstream analysis of gene expression, the core processing pipeline performs quality control, alignment to a reference genome, and quantification of aligned reads. Consider four protein-coding genes, denoted $G_1$, $G_2$, $G_3$, and $G_4$, with genomic lengths $L_{1} = 2000$ base pairs, $L_{2} = 10000$ base pairs, $L_{3} = 500$ base pairs, and $L_{4} = 3000$ base pairs. Sample $1$ is sequenced single-end, with a total of $N_1 = 3.0 \\times 10^{7}$ mapped reads, and yields raw gene-level read counts $c_{1}^{(1)} = 600$, $c_{2}^{(1)} = 900$, $c_{3}^{(1)} = 450$, and $c_{4}^{(1)} = 300$. Sample $2$ is sequenced paired-end, with a total of $N_2 = 1.5 \\times 10^{7}$ mapped fragments, and yields raw gene-level fragment counts $c_{1}^{(2)} = 800$, $c_{2}^{(2)} = 300$, $c_{3}^{(2)} = 400$, and $c_{4}^{(2)} = 500$.\n\nStarting from foundational definitions of length normalization and library-size scaling in transcript quantification, perform the following:\n\n- Compute for sample $1$ the Reads Per Kilobase per Million mapped reads (RPKM) for each gene and the Transcripts Per Million (TPM) for each gene.\n- Compute for sample $2$ the Fragments Per Kilobase per Million mapped fragments (FPKM) for each gene and the Transcripts Per Million (TPM) for each gene.\n- For each sample separately, determine whether the within-sample rank ordering of genes by raw counts differs from the rank ordering by TPM, and briefly justify the outcome using first-principles reasoning.\n\nFinally, define the Kendall tau distance between two total orderings on the same set of items as the number of pairwise discordances between the orderings. Using this definition, compute the Kendall tau distance between the raw-count ranking and the TPM ranking for sample $1$. Report only this Kendall tau distance as your final numerical answer. No rounding is required, and no units should be provided for the final answer.", "solution": "The problem is assessed to be valid as it is scientifically grounded in standard principles of transcriptomics data analysis, well-posed with all necessary information provided, and objective in its formulation.\n\nThe core of this problem involves the application of standard normalization techniques used in RNA sequencing (RNA-seq) data analysis to compare gene expression levels. The two main normalization metrics are Reads/Fragments Per Kilobase per Million (RPKM/FPKM) and Transcripts Per Million (TPM).\n\nThe foundational definitions for a gene $i$ are as follows:\nLet $c_i$ be the raw count of reads (for single-end sequencing) or fragments (for paired-end sequencing) mapped to gene $i$.\nLet $L_i$ be the length of the transcript corresponding to gene $i$, in base pairs (bp). We convert this to kilobases (kb) by $L_i^{\\text{kb}} = L_i / 1000$.\nLet $N$ be the total number of mapped reads or fragments in the sequencing library. We convert this to millions by $N^{\\text{millions}} = N / 10^6$.\n\nThe RPKM (for single-end) or FPKM (for paired-end) is defined as:\n$$ \\text{RPKM}_i \\text{ or } \\text{FPKM}_i = \\frac{c_i}{L_i^{\\text{kb}} \\cdot N^{\\text{millions}}} = \\frac{10^9 \\cdot c_i}{L_i \\cdot N} $$\nThis formula normalizes the raw counts first by the total library size (sequencing depth) and then by gene length.\n\nThe TPM is defined by a different order of operations. First, raw counts are normalized for gene length to get a measure of transcript abundance rate. Then, these rates are normalized by the sum of all rates to account for library size.\n1.  Rate calculation (reads per kilobase): $R_i = \\frac{c_i}{L_i^{\\text{kb}}} = \\frac{1000 \\cdot c_i}{L_i}$\n2.  Sum of all rates: $T = \\sum_j R_j$\n3.  TPM calculation: $\\text{TPM}_i = \\left(\\frac{R_i}{T}\\right) \\cdot 10^6$\n\nWith these definitions, we can proceed with the calculations for each sample.\n\n**Analysis of Sample 1**\nGiven data for Sample $1$:\n- Total mapped reads: $N_1 = 3.0 \\times 10^7$, so $N_1^{\\text{millions}} = 30$.\n- Gene lengths: $L_1 = 2000$ bp ($2$ kb), $L_2 = 10000$ bp ($10$ kb), $L_3 = 500$ bp ($0.5$ kb), $L_4 = 3000$ bp ($3$ kb).\n- Raw counts: $c_{1}^{(1)} = 600$, $c_{2}^{(1)} = 900$, $c_{3}^{(1)} = 450$, $c_{4}^{(1)} = 300$.\n\n**RPKM Calculation for Sample 1:**\n- $G_1$: $\\text{RPKM}_1^{(1)} = \\frac{600}{2 \\cdot 30} = 10$\n- $G_2$: $\\text{RPKM}_2^{(1)} = \\frac{900}{10 \\cdot 30} = 3$\n- $G_3$: $\\text{RPKM}_3^{(1)} = \\frac{450}{0.5 \\cdot 30} = \\frac{450}{15} = 30$\n- $G_4$: $\\text{RPKM}_4^{(1)} = \\frac{300}{3 \\cdot 30} = \\frac{300}{90} = \\frac{10}{3}$\n\n**TPM Calculation for Sample 1:**\nFirst, we calculate the rates $R_i^{(1)} = c_i^{(1)}/L_i^{\\text{kb}}$:\n- $R_1^{(1)} = \\frac{600}{2} = 300$\n- $R_2^{(1)} = \\frac{900}{10} = 90$\n- $R_3^{(1)} = \\frac{450}{0.5} = 900$\n- $R_4^{(1)} = \\frac{300}{3} = 100$\nThe sum of rates is $T^{(1)} = 300 + 90 + 900 + 100 = 1390$.\nNow, we calculate the TPM values:\n- $G_1$: $\\text{TPM}_1^{(1)} = \\left(\\frac{300}{1390}\\right) \\cdot 10^6 \\approx 215827$\n- $G_2$: $\\text{TPM}_2^{(1)} = \\left(\\frac{90}{1390}\\right) \\cdot 10^6 \\approx 64748$\n- $G_3$: $\\text{TPM}_3^{(1)} = \\left(\\frac{900}{1390}\\right) \\cdot 10^6 \\approx 647482$\n- $G_4$: $\\text{TPM}_4^{(1)} = \\left(\\frac{100}{1390}\\right) \\cdot 10^6 \\approx 71942$\n\n**Analysis of Sample 2**\nGiven data for Sample $2$:\n- Total mapped fragments: $N_2 = 1.5 \\times 10^7$, so $N_2^{\\text{millions}} = 15$.\n- Gene lengths are the same as for Sample $1$.\n- Raw counts: $c_{1}^{(2)} = 800$, $c_{2}^{(2)} = 300$, $c_{3}^{(2)} = 400$, $c_{4}^{(2)} = 500$.\n\n**FPKM Calculation for Sample 2:**\n- $G_1$: $\\text{FPKM}_1^{(2)} = \\frac{800}{2 \\cdot 15} = \\frac{800}{30} = \\frac{80}{3}$\n- $G_2$: $\\text{FPKM}_2^{(2)} = \\frac{300}{10 \\cdot 15} = \\frac{300}{150} = 2$\n- $G_3$: $\\text{FPKM}_3^{(2)} = \\frac{400}{0.5 \\cdot 15} = \\frac{400}{7.5} = \\frac{160}{3}$\n- $G_4$: $\\text{FPKM}_4^{(2)} = \\frac{500}{3 \\cdot 15} = \\frac{500}{45} = \\frac{100}{9}$\n\n**TPM Calculation for Sample 2:**\nFirst, we calculate the rates $R_i^{(2)} = c_i^{(2)}/L_i^{\\text{kb}}$:\n- $R_1^{(2)} = \\frac{800}{2} = 400$\n- $R_2^{(2)} = \\frac{300}{10} = 30$\n- $R_3^{(2)} = \\frac{400}{0.5} = 800$\n- $R_4^{(2)} = \\frac{500}{3}$\nThe sum of rates is $T^{(2)} = 400 + 30 + 800 + \\frac{500}{3} = 1230 + \\frac{500}{3} = \\frac{3690 + 500}{3} = \\frac{4190}{3}$.\nNow, we calculate the TPM values:\n- $G_1$: $\\text{TPM}_1^{(2)} = \\left(\\frac{400}{4190/3}\\right) \\cdot 10^6 = \\frac{1200}{4190} \\cdot 10^6 \\approx 286396$\n- $G_2$: $\\text{TPM}_2^{(2)} = \\left(\\frac{30}{4190/3}\\right) \\cdot 10^6 = \\frac{90}{4190} \\cdot 10^6 \\approx 21480$\n- $G_3$: $\\text{TPM}_3^{(2)} = \\left(\\frac{800}{4190/3}\\right) \\cdot 10^6 = \\frac{2400}{4190} \\cdot 10^6 \\approx 572792$\n- $G_4$: $\\text{TPM}_4^{(2)} = \\left(\\frac{500/3}{4190/3}\\right) \\cdot 10^6 = \\frac{500}{4190} \\cdot 10^6 \\approx 119332$\n\n**Comparison of Rank Orderings**\n\nFor Sample 1:\n- Raw count ranking: $c_2^{(1)}(900)  c_1^{(1)}(600)  c_3^{(1)}(450)  c_4^{(1)}(300) \\implies G_2  G_1  G_3  G_4$.\n- TPM ranking (proportional to rates $R_i^{(1)}$): $R_3^{(1)}(900)  R_1^{(1)}(300)  R_4^{(1)}(100)  R_2^{(1)}(90) \\implies G_3  G_1  G_4  G_2$.\nThe within-sample rank ordering by raw counts differs from the rank ordering by TPM.\n\nFor Sample 2:\n- Raw count ranking: $c_1^{(2)}(800)  c_4^{(2)}(500)  c_3^{(2)}(400)  c_2^{(2)}(300) \\implies G_1  G_4  G_3  G_2$.\n- TPM ranking (proportional to rates $R_i^{(2)}$): $R_3^{(2)}(800)  R_1^{(2)}(400)  R_4^{(2)}(500/3)  R_2^{(2)}(30) \\implies G_3  G_1  G_4  G_2$.\nThe within-sample rank ordering by raw counts also differs from the rank ordering by TPM.\n\n**Justification from First Principles:**\nThe raw read count for a gene is mechanistically a product of its true transcript abundance (molar concentration) and its length. Longer genes present a larger target for random fragmentation and sequencing, thus accumulating more reads than shorter genes, even if both are expressed at the same level. This length bias confounds the interpretation of raw counts as a direct measure of expression.\nThe TPM calculation rectifies this. The first step, $R_i = c_i / L_i^{\\text{kb}}$, explicitly divides out the gene length, yielding a rate that is proportional to the actual transcript abundance. The subsequent scaling by total rates normalizes for library size. Since this final scaling factor is the same for all genes within a sample, it does not alter the within-sample ranking established by the initial length normalization step. Therefore, the difference between the raw-count ranking and the TPM ranking is fundamentally due to the correction for gene length bias. For example, in Sample 1, gene $G_2$ is the longest ($10000$ bp) and has the highest raw count, but after length normalization, its relative expression is the lowest. Conversely, gene $G_3$ is the shortest ($500$ bp), and its modest raw count translates to the highest relative expression after length normalization.\n\n**Kendall Tau Distance for Sample 1**\nThe Kendall tau distance between two rankings is the number of pairs of items whose relative ordering is different in the two rankings. The set of items is {$G_1, G_2, G_3, G_4$}.\n- Ranking 1 (from raw counts): $\\pi_1 = (G_2, G_1, G_3, G_4)$\n- Ranking 2 (from TPM): $\\pi_2 = (G_3, G_1, G_4, G_2)$\n\nWe examine all $\\binom{4}{2} = 6$ pairs of genes:\n1.  Pair $(G_1, G_2)$: In $\\pi_1$, $G_2  G_1$. In $\\pi_2$, $G_1  G_2$. Discordant.\n2.  Pair $(G_1, G_3)$: In $\\pi_1$, $G_1  G_3$. In $\\pi_2$, $G_3  G_1$. Discordant.\n3.  Pair $(G_1, G_4)$: In $\\pi_1$, $G_1  G_4$. In $\\pi_2$, $G_1  G_4$. Concordant.\n4.  Pair $(G_2, G_3)$: In $\\pi_1$, $G_2  G_3$. In $\\pi_2$, $G_3  G_2$. Discordant.\n5.  Pair $(G_2, G_4)$: In $\\pi_1$, $G_2  G_4$. In $\\pi_2$, $G_4  G_2$. Discordant.\n6.  Pair $(G_3, G_4)$: In $\\pi_1$, $G_3  G_4$. In $\\pi_2$, $G_3  G_4$. Concordant.\n\nThere are $4$ discordant pairs. Therefore, the Kendall tau distance between the raw-count ranking and the TPM ranking for Sample $1$ is $4$.", "answer": "$$\\boxed{4}$$", "id": "4351520"}, {"introduction": "A common challenge in read alignment is the presence of multi-mapping reads, which are compatible with more than one gene or genomic location. How these ambiguous reads are handled can significantly impact the final quantification results. This exercise [@problem_id:4351466] explores the quantitative difference between two common disambiguation strategies, demonstrating how a specific bioinformatic choice directly influences downstream biological interpretation.", "problem": "A single-end ribonucleic acid sequencing (RNA-Seq) experiment profiles a genomic locus where two genes, denoted $A$ and $B$, overlap over part of their exonic sequence. The locus is the only expressed region in the sample. Gene $A$ has total exonic length $L_A = 1200$ base pairs, and gene $B$ has total exonic length $L_B = 900$ base pairs. Of these, an overlapping segment of length $300$ base pairs is perfectly identical between $A$ and $B$, while the remaining exonic sequence is unique to each gene. A short-read aligner reports three categories of alignments from the sequenced reads at this locus:\n- $180$ alignments map uniquely to the unique exonic region of gene $A$.\n- $120$ alignments map uniquely to the unique exonic region of gene $B$.\n- $200$ alignments map equally well to the identical overlapping segment and are reported as multi-mapping reads compatible with both $A$ and $B$.\n\nAssume all $500$ alignments at this locus originate from this sample’s expressed transcriptome and that there is no expression outside this locus. Quantification follows the standard length normalization principle: convert assigned read counts to reads-per-kilobase by dividing by the gene’s exonic length measured in kilobases, and then scale these values so that the transcript abundance values sum to $10^6$ across all genes in the sample to yield Transcripts Per Million (TPM).\n\nConsider two disambiguation strategies for the multi-mapping reads:\n- Strategy $\\mathrm{U}$ (unique-only): discard multi-mapping reads and only count reads that map uniquely to a single gene.\n- Strategy $\\mathrm{F}$ (fractional): assign each multi-mapping read fractionally and equally across all compatible genes.\n\nStarting from the core definitions above, compute the TPM values for genes $A$ and $B$ under each strategy and then compute the Euclidean distance between the two resulting TPM vectors. That is, if $\\mathbf{t}^{(\\mathrm{U})}$ and $\\mathbf{t}^{(\\mathrm{F})}$ denote the two-dimensional vectors of TPMs for $\\{A,B\\}$ under strategies $\\mathrm{U}$ and $\\mathrm{F}$ respectively, compute the Euclidean norm of $\\mathbf{t}^{(\\mathrm{F})} - \\mathbf{t}^{(\\mathrm{U})}$.\n\nRound your final distance to four significant figures. Express the final distance in TPM units.", "solution": "The problem will first be validated for scientific soundness, self-containment, and objectivity. Upon successful validation, a complete solution will be derived.\n\n### Step 1: Extract Givens\n-   Gene $A$ total exonic length: $L_A = 1200$ base pairs.\n-   Gene $B$ total exonic length: $L_B = 900$ base pairs.\n-   Length of overlapping, identical segment: $300$ base pairs.\n-   Number of alignments unique to gene $A$: $N_{A,u} = 180$.\n-   Number of alignments unique to gene $B$: $N_{B,u} = 120$.\n-   Number of multi-mapping alignments compatible with both $A$ and $B$: $N_{AB,m} = 200$.\n-   Quantification method: Transcripts Per Million (TPM).\n    -   Step 1: Compute Reads Per Kilobase (RPK) by dividing assigned read counts by the gene's exonic length in kilobases.\n    -   Step 2: Scale RPK values such that the total sum is $10^6$.\n-   Disambiguation Strategy $\\mathrm{U}$ (unique-only): Discard multi-mapping reads.\n-   Disambiguation Strategy $\\mathrm{F}$ (fractional): Assign each multi-mapping read equally across compatible genes.\n-   Objective: Compute the Euclidean distance $||\\mathbf{t}^{(\\mathrm{F})} - \\mathbf{t}^{(\\mathrm{U})}||$, where $\\mathbf{t}$ denotes the two-dimensional vector of TPMs for genes $\\{A,B\\}$.\n-   Rounding: The final result must be rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is scientifically grounded and well-posed. The concepts presented—RNA-Seq, multi-mapping reads, TPM quantification, and read disambiguation strategies—are standard and fundamental in the field of bioinformatics and systems biomedicine. The data provided are self-contained, numerically consistent, and sufficient to derive a unique solution. The definitions of the two strategies, $\\mathrm{U}$ and $\\mathrm{F}$, are clear and objective. The problem does not violate any scientific principles, nor does it contain any subjective or ambiguous language. The length of the overlapping segment ($300$ bp) is descriptive context but not directly required for the TPM calculation, which uses the total exonic length as per its standard definition. The problem is valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will now be provided.\n\nThe core of the problem is the computation of Transcripts Per Million (TPM) values for two genes, $A$ and $B$, under two different models for handling multi-mapping reads. The TPM for a gene $i$ is defined as:\n$$TPM_i = \\left( \\frac{C_i / l_i}{\\sum_j (C_j / l_j)} \\right) \\times 10^6$$\nwhere $C_i$ is the number of reads assigned to gene $i$, and $l_i$ is the length of gene $i$ in kilobases. The term $C_i/l_i$ is the Reads Per Kilobase (RPK).\n\nThe lengths of the genes in kilobases (kb) are:\n$l_A = \\frac{L_A}{1000} = \\frac{1200}{1000} = 1.2$ kb.\n$l_B = \\frac{L_B}{1000} = \\frac{900}{1000} = 0.9$ kb.\n\nWe will now calculate the TPM vectors for each strategy.\n\n**Strategy U (unique-only)**\nUnder this strategy, multi-mapping reads are discarded. The counts for each gene are only from uniquely mapping reads.\n-   Count for gene $A$: $C_A^{(U)} = N_{A,u} = 180$.\n-   Count for gene $B$: $C_B^{(U)} = N_{B,u} = 120$.\n\nNext, we compute the RPK values:\n-   $RPK_A^{(U)} = \\frac{C_A^{(U)}}{l_A} = \\frac{180}{1.2} = 150$.\n-   $RPK_B^{(U)} = \\frac{C_B^{(U)}}{l_B} = \\frac{120}{0.9} = \\frac{1200}{9} = \\frac{400}{3}$.\n\nThe sum of all RPK values, which is the scaling factor, is:\n$S^{(U)} = RPK_A^{(U)} + RPK_B^{(U)} = 150 + \\frac{400}{3} = \\frac{450}{3} + \\frac{400}{3} = \\frac{850}{3}$.\n\nNow we can compute the TPM values:\n-   $TPM_A^{(U)} = \\left( \\frac{RPK_A^{(U)}}{S^{(U)}} \\right) \\times 10^6 = \\left( \\frac{150}{850/3} \\right) \\times 10^6 = \\frac{450}{850} \\times 10^6 = \\frac{9}{17} \\times 10^6$.\n-   $TPM_B^{(U)} = \\left( \\frac{RPK_B^{(U)}}{S^{(U)}} \\right) \\times 10^6 = \\left( \\frac{400/3}{850/3} \\right) \\times 10^6 = \\frac{400}{850} \\times 10^6 = \\frac{8}{17} \\times 10^6$.\n\nThe TPM vector for strategy U is $\\mathbf{t}^{(U)} = \\left( \\frac{9}{17} \\times 10^6, \\frac{8}{17} \\times 10^6 \\right)$.\n\n**Strategy F (fractional)**\nUnder this strategy, each multi-mapping read is assigned fractionally to all compatible genes. Since the $N_{AB,m} = 200$ reads are compatible with two genes ($A$ and $B$), each gene receives a count of $1/2$ from each such read.\n-   Count for gene $A$: $C_A^{(F)} = N_{A,u} + \\frac{1}{2}N_{AB,m} = 180 + \\frac{1}{2}(200) = 180 + 100 = 280$.\n-   Count for gene $B$: $C_B^{(F)} = N_{B,u} + \\frac{1}{2}N_{AB,m} = 120 + \\frac{1}{2}(200) = 120 + 100 = 220$.\n\nNext, we compute the RPK values:\n-   $RPK_A^{(F)} = \\frac{C_A^{(F)}}{l_A} = \\frac{280}{1.2} = \\frac{2800}{12} = \\frac{700}{3}$.\n-   $RPK_B^{(F)} = \\frac{C_B^{(F)}}{l_B} = \\frac{220}{0.9} = \\frac{2200}{9}$.\n\nThe sum of RPK values is:\n$S^{(F)} = RPK_A^{(F)} + RPK_B^{(F)} = \\frac{700}{3} + \\frac{2200}{9} = \\frac{2100}{9} + \\frac{2200}{9} = \\frac{4300}{9}$.\n\nNow we compute the TPM values:\n-   $TPM_A^{(F)} = \\left( \\frac{RPK_A^{(F)}}{S^{(F)}} \\right) \\times 10^6 = \\left( \\frac{700/3}{4300/9} \\right) \\times 10^6 = \\left( \\frac{700}{3} \\cdot \\frac{9}{4300} \\right) \\times 10^6 = \\frac{2100}{4300} \\times 10^6 = \\frac{21}{43} \\times 10^6$.\n-   $TPM_B^{(F)} = \\left( \\frac{RPK_B^{(F)}}{S^{(F)}} \\right) \\times 10^6 = \\left( \\frac{2200/9}{4300/9} \\right) \\times 10^6 = \\frac{2200}{4300} \\times 10^6 = \\frac{22}{43} \\times 10^6$.\n\nThe TPM vector for strategy F is $\\mathbf{t}^{(F)} = \\left( \\frac{21}{43} \\times 10^6, \\frac{22}{43} \\times 10^6 \\right)$.\n\n**Euclidean Distance**\nThe final step is to compute the Euclidean distance $D = ||\\mathbf{t}^{(F)} - \\mathbf{t}^{(U)}||$. First, we compute the difference vector $\\Delta\\mathbf{t} = \\mathbf{t}^{(F)} - \\mathbf{t}^{(U)}$.\n-   $\\Delta TPM_A = TPM_A^{(F)} - TPM_A^{(U)} = \\left(\\frac{21}{43} - \\frac{9}{17}\\right) \\times 10^6 = \\left(\\frac{21 \\cdot 17 - 9 \\cdot 43}{43 \\cdot 17}\\right) \\times 10^6 = \\left(\\frac{357 - 387}{731}\\right) \\times 10^6 = -\\frac{30}{731} \\times 10^6$.\n-   $\\Delta TPM_B = TPM_B^{(F)} - TPM_B^{(U)} = \\left(\\frac{22}{43} - \\frac{8}{17}\\right) \\times 10^6 = \\left(\\frac{22 \\cdot 17 - 8 \\cdot 43}{43 \\cdot 17}\\right) \\times 10^6 = \\left(\\frac{374 - 344}{731}\\right) \\times 10^6 = \\frac{30}{731} \\times 10^6$.\n\nThe Euclidean distance is the square root of the sum of the squared differences:\n$D = \\sqrt{(\\Delta TPM_A)^2 + (\\Delta TPM_B)^2} = \\sqrt{\\left(-\\frac{30}{731} \\times 10^6\\right)^2 + \\left(\\frac{30}{731} \\times 10^6\\right)^2}$\n$D = \\sqrt{2 \\left(\\frac{30}{731} \\times 10^6\\right)^2} = \\sqrt{2} \\left| \\frac{30}{731} \\times 10^6 \\right| = \\frac{30\\sqrt{2}}{731} \\times 10^6$.\n\nFinally, we compute the numerical value and round to four significant figures.\n$D \\approx \\frac{30 \\times 1.41421356}{731} \\times 10^6 \\approx \\frac{42.4264068}{731} \\times 10^6 \\approx 0.058038860 \\times 10^6 = 58038.860$.\nRounding to four significant figures gives $58040$. Expressed in scientific notation, this is $5.804 \\times 10^4$.", "answer": "$$\\boxed{5.804 \\times 10^{4}}$$", "id": "4351466"}, {"introduction": "Strand-specific sequencing protocols provide powerful information for resolving the transcriptional origin of reads in complex genomic regions with overlapping genes. However, this power depends on correctly informing the quantification tool about the library's strand orientation. This problem [@problem_id:4351355] models the process of read assignment in a stranded library and quantifies the dramatic misassignment error that occurs when the software settings do not match the experimental protocol.", "problem": "A researcher is quantifying gene expression from ribonucleic acid sequencing (RNA-seq) data in a strand-specific library prepared with deoxyuridine triphosphate (dUTP), which is known to be reverse-stranded: reads derived from a transcript on the genome $+$ strand align predominantly to the genome $-$ strand, and vice versa, except for a low probability of strand-label error. The quantification tool uses a strand-compatibility rule. In the \"reverse\" setting, a read is assigned to a gene only if the aligner-reported strand is the opposite of the gene's annotated strand; in the \"forward\" setting, assignment requires equality of the aligner-reported strand and the gene strand. When a read overlaps exons of two genes on opposite strands, the tool assigns the read to the single gene whose strand is compatible under the chosen setting. When a read overlaps only one gene, it is either counted for that gene if the compatibility rule is satisfied or dropped otherwise.\n\nConsider two genes $G_1$ and $G_2$ with annotated strands $+$ and $-$, respectively. Their exons overlap in a shared genomic region. Assume the following experimentally supported model:\n- Each read's aligner-reported strand equals the true (library-determined) orientation with probability $1 - \\epsilon$, and is flipped with probability $\\epsilon$, independently of other reads.\n- In the overlapping region, a total of $N_{\\mathrm{ov}}$ reads originate from transcripts of $G_1$ and $G_2$, with $x$ from $G_1$ and $N_{\\mathrm{ov}} - x$ from $G_2$.\n- In unique exonic regions, $N_1^{\\mathrm{uni}}$ reads originate from $G_1$-specific exons and $N_2^{\\mathrm{uni}}$ originate from $G_2$-specific exons.\n- All reads are uniquely mapped and pass quality control filters except for the strand-label error described above.\n\nUse the following values:\n- $\\epsilon = 0.02$,\n- $N_{\\mathrm{ov}} = 1000$,\n- $x = 650$,\n- $N_1^{\\mathrm{uni}} = 400$,\n- $N_2^{\\mathrm{uni}} = 600$.\n\nStarting from the definitions of probability, expectation, and the strand-compatibility rules, compute:\n1. The total counts assigned to $G_1$ and $G_2$ under the reverse setting.\n2. The total counts assigned to $G_1$ and $G_2$ under the forward setting.\n3. The misassignment error rate under each setting, defined as the fraction of assigned reads whose assigned gene label differs from the true gene-of-origin, expressed as a decimal or a fraction.\n\nFinally, report the single quantity $R$, the ratio of the misassignment error rate under the forward setting to that under the reverse setting, as a single real number or a single closed-form analytic expression. Do not use a percentage sign. If you choose to approximate, round your answer to four significant figures; otherwise, provide an exact form.", "solution": "The problem is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. The model of strand-specific RNA-seq quantification, including strand errors and the handling of unique versus overlapping reads, is a standard and valid representation of challenges in bioinformatics data analysis. We proceed with the solution.\n\nFirst, we must establish the core probabilistic relationships. The library is a reverse-stranded dUTP library. This means a read originating from a gene on a given strand of the genome is expected to map to the opposite strand.\n- Gene $G_1$ is on the $+$ strand. A read from $G_1$ has a true library-determined orientation of $-$.\n- Gene $G_2$ is on the $-$ strand. A read from $G_2$ has a true library-determined orientation of $+$.\n\nThe aligner reports the true orientation with probability $1 - \\epsilon$ and the incorrect, flipped orientation with probability $\\epsilon$.\n- For a read from $G_1$ (true orientation $-$):\n  - Aligner reports strand $-$ with probability $P(\\text{report } - | G_1) = 1 - \\epsilon$.\n  - Aligner reports strand $+$ with probability $P(\\text{report } + | G_1) = \\epsilon$.\n- For a read from $G_2$ (true orientation $+$):\n  - Aligner reports strand $+$ with probability $P(\\text{report } + | G_2) = 1 - \\epsilon$.\n  - Aligner reports strand $-$ with probability $P(\\text{report } - | G_2) = \\epsilon$.\n\nNext, we analyze the two quantification settings based on their strand-compatibility rules.\n\n**1. Reverse Setting**\nThe \"reverse\" setting is the correct one for a dUTP library. A read is assigned to a gene if the aligner-reported strand is the opposite of the gene's annotated strand.\n- For $G_1$ (annotated strand $+$), the assignment rule is: aligner strand must be $-$.\n- For $G_2$ (annotated strand $-$), the assignment rule is: aligner strand must be $+$.\n\nLet's determine the assignment probabilities for a single read originating from either gene:\n- A read from $G_1$: It is assigned to $G_1$ if the aligner reports $-$, which occurs with probability $1 - \\epsilon$. It is assigned to $G_2$ if the aligner reports $+$, which occurs with probability $\\epsilon$.\n- A read from $G_2$: It is assigned to $G_1$ if the aligner reports $-$, which occurs with probability $\\epsilon$. It is assigned to $G_2$ if the aligner reports $+$, which occurs with probability $1 - \\epsilon$.\n\nNow, we calculate the expected counts for each gene by considering reads from unique and overlapping regions.\n- **Unique regions**: $N_1^{\\mathrm{uni}}$ reads from $G_1$ and $N_2^{\\mathrm{uni}}$ reads from $G_2$.\n  - Reads from $G_1$'s unique region are assigned to $G_1$ if they meet its rule (aligner reports $-$). This happens with probability $1-\\epsilon$. Otherwise, they are dropped.\n  - Expected counts from $G_1$ unique region: $C_{1, \\text{uni}}^{\\text{rev}} = N_1^{\\mathrm{uni}}(1 - \\epsilon)$.\n  - Reads from $G_2$'s unique region are assigned to $G_2$ if they meet its rule (aligner reports $+$). This happens with probability $1-\\epsilon$. Otherwise, they are dropped.\n  - Expected counts from $G_2$ unique region: $C_{2, \\text{uni}}^{\\text{rev}} = N_2^{\\mathrm{uni}}(1 - \\epsilon)$.\n- **Overlapping region**: $x$ reads from $G_1$ and $N_{\\mathrm{ov}} - x$ reads from $G_2$. In this region, a read is assigned to the gene whose rule it satisfies. Since the rules for $G_1$ (strand $-$) and $G_2$ (strand $+$) are mutually exclusive, every read is assigned to exactly one gene.\n  - Of the $x$ reads from $G_1$, a fraction $1-\\epsilon$ is correctly assigned to $G_1$ and a fraction $\\epsilon$ is misassigned to $G_2$.\n  - Of the $N_{\\mathrm{ov}} - x$ reads from $G_2$, a fraction $1-\\epsilon$ is correctly assigned to $G_2$ and a fraction $\\epsilon$ is misassigned to $G_1$.\n  - Expected counts from overlap region for $G_1$: $C_{1, \\text{ov}}^{\\text{rev}} = x(1 - \\epsilon) + (N_{\\mathrm{ov}} - x)\\epsilon$.\n  - Expected counts from overlap region for $G_2$: $C_{2, \\text{ov}}^{\\text{rev}} = x\\epsilon + (N_{\\mathrm{ov}} - x)(1 - \\epsilon)$.\n\nTotal expected counts under the reverse setting:\n$C_1^{\\text{rev}} = C_{1, \\text{uni}}^{\\text{rev}} + C_{1, \\text{ov}}^{\\text{rev}} = N_1^{\\mathrm{uni}}(1 - \\epsilon) + x(1 - \\epsilon) + (N_{\\mathrm{ov}} - x)\\epsilon$.\n$C_2^{\\text{rev}} = C_{2, \\text{uni}}^{\\text{rev}} + C_{2, \\text{ov}}^{\\text{rev}} = N_2^{\\mathrm{uni}}(1 - \\epsilon) + x\\epsilon + (N_{\\mathrm{ov}} - x)(1 - \\epsilon)$.\n\nUsing the given values: $\\epsilon = 0.02$, $N_1^{\\mathrm{uni}} = 400$, $N_2^{\\mathrm{uni}} = 600$, $N_{\\mathrm{ov}} = 1000$, $x = 650$.\n$C_1^{\\text{rev}} = 400(0.98) + 650(0.98) + (1000 - 650)(0.02) = 392 + 637 + 350(0.02) = 1029 + 7 = 1036$.\n$C_2^{\\text{rev}} = 600(0.98) + 650(0.02) + (1000 - 650)(0.98) = 588 + 13 + 350(0.98) = 601 + 343 = 944$.\n\n**2. Forward Setting**\nThe \"forward\" setting is the incorrect one for a dUTP library. A read is assigned to a gene if the aligner-reported strand is the same as the gene's annotated strand.\n- For $G_1$ (annotated strand $+$), the assignment rule is: aligner strand must be $+$.\n- For $G_2$ (annotated strand $-$), the assignment rule is: aligner strand must be $-$.\n\nAssignment probabilities:\n- A read from $G_1$: It is assigned to $G_1$ if the aligner reports $+$, which occurs with probability $\\epsilon$. It is assigned to $G_2$ if the aligner reports $-$, which occurs with probability $1-\\epsilon$.\n- A read from $G_2$: It is assigned to $G_1$ if the aligner reports $+$, which occurs with probability $1-\\epsilon$. It is assigned to $G_2$ if the aligner reports $-$, which occurs with probability $\\epsilon$.\n\nTotal expected counts under the forward setting:\n- Unique regions:\n  - $C_{1, \\text{uni}}^{\\text{fwd}} = N_1^{\\mathrm{uni}}\\epsilon$.\n  - $C_{2, \\text{uni}}^{\\text{fwd}} = N_2^{\\mathrm{uni}}\\epsilon$.\n- Overlapping region:\n  - $C_{1, \\text{ov}}^{\\text{fwd}} = x\\epsilon + (N_{\\mathrm{ov}}-x)(1 - \\epsilon)$.\n  - $C_{2, \\text{ov}}^{\\text{fwd}} = x(1 - \\epsilon) + (N_{\\mathrm{ov}}-x)\\epsilon$.\n\nTotal counts:\n$C_1^{\\text{fwd}} = N_1^{\\mathrm{uni}}\\epsilon + x\\epsilon + (N_{\\mathrm{ov}} - x)(1 - \\epsilon)$.\n$C_2^{\\text{fwd}} = N_2^{\\mathrm{uni}}\\epsilon + x(1 - \\epsilon) + (N_{\\mathrm{ov}} - x)\\epsilon$.\n\nUsing the given values:\n$C_1^{\\text{fwd}} = 400(0.02) + 650(0.02) + 350(0.98) = 8 + 13 + 343 = 364$.\n$C_2^{\\text{fwd}} = 600(0.02) + 650(0.98) + 350(0.02) = 12 + 637 + 7 = 656$.\n\n**3. Misassignment Error Rates**\nThe misassignment error rate is the fraction of assigned reads whose assigned gene label is not the true gene-of-origin. Reads from unique regions are either assigned correctly or dropped; they are never misassigned to another gene. Misassignment only occurs for reads originating in the overlapping region.\n\n- **Reverse Setting**:\n  - Number of misassigned reads: Reads from $G_1$ assigned to $G_2$ ($x\\epsilon$) + reads from $G_2$ assigned to $G_1$ ($(N_{\\mathrm{ov}}-x)\\epsilon$).\n  - $M^{\\text{rev}} = x\\epsilon + (N_{\\mathrm{ov}} - x)\\epsilon = N_{\\mathrm{ov}}\\epsilon = 1000(0.02) = 20$.\n  - Total number of assigned reads: $A^{\\text{rev}} = C_1^{\\text{rev}} + C_2^{\\text{rev}} = 1036 + 944 = 1980$.\n  - Alternatively, $A^{\\text{rev}} = (N_1^{\\mathrm{uni}} + N_2^{\\mathrm{uni}})(1 - \\epsilon) + N_{\\mathrm{ov}} = (400+600)(0.98) + 1000 = 980 + 1000 = 1980$.\n  - Error rate: $E^{\\text{rev}} = \\frac{M^{\\text{rev}}}{A^{\\text{rev}}} = \\frac{20}{1980} = \\frac{1}{99}$.\n\n- **Forward Setting**:\n  - Number of misassigned reads: Reads from $G_1$ assigned to $G_2$ ($x(1-\\epsilon)$) + reads from $G_2$ assigned to $G_1$ ($(N_{\\mathrm{ov}}-x)(1-\\epsilon)$).\n  - $M^{\\text{fwd}} = x(1-\\epsilon) + (N_{\\mathrm{ov}} - x)(1-\\epsilon) = N_{\\mathrm{ov}}(1-\\epsilon) = 1000(0.98) = 980$.\n  - Total number of assigned reads: $A^{\\text{fwd}} = C_1^{\\text{fwd}} + C_2^{\\text{fwd}} = 364 + 656 = 1020$.\n  - Alternatively, $A^{\\text{fwd}} = (N_1^{\\mathrm{uni}} + N_2^{\\mathrm{uni}})\\epsilon + N_{\\mathrm{ov}} = (400+600)(0.02) + 1000 = 20 + 1000 = 1020$.\n  - Error rate: $E^{\\text{fwd}} = \\frac{M^{\\text{fwd}}}{A^{\\text{fwd}}} = \\frac{980}{1020} = \\frac{98}{102} = \\frac{49}{51}$.\n\n**Final Quantity: Ratio $R$**\nThe final required quantity is the ratio of the misassignment error rate under the forward setting to that under the reverse setting.\n$R = \\frac{E^{\\text{fwd}}}{E^{\\text{rev}}} = \\frac{49/51}{1/99} = \\frac{49}{51} \\times 99$.\nWe can simplify this expression by noting that $51 = 3 \\times 17$ and $99 = 3 \\times 33$.\n$R = \\frac{49}{3 \\times 17} \\times (3 \\times 33) = \\frac{49 \\times 33}{17}$.\nCalculating the numerator: $49 \\times 33 = 49 \\times (30 + 3) = 1470 + 147 = 1617$.\nTherefore, $R = \\frac{1617}{17}$.\n\nAs a sanity check, we can use the general formula:\n$R = \\frac{E^{\\text{fwd}}}{E^{\\text{rev}}} = \\frac{N_{\\mathrm{ov}}(1-\\epsilon) / ((N_1^{\\mathrm{uni}} + N_2^{\\mathrm{uni}})\\epsilon + N_{\\mathrm{ov}})}{N_{\\mathrm{ov}}\\epsilon / ((N_1^{\\mathrm{uni}} + N_2^{\\mathrm{uni}})(1-\\epsilon) + N_{\\mathrm{ov}})} = \\frac{1-\\epsilon}{\\epsilon} \\cdot \\frac{(N_1^{\\mathrm{uni}} + N_2^{\\mathrm{uni}})(1-\\epsilon) + N_{\\mathrm{ov}}}{(N_1^{\\mathrm{uni}} + N_2^{\\mathrm{uni}})\\epsilon + N_{\\mathrm{ov}}}$.\n$R = \\frac{0.98}{0.02} \\cdot \\frac{(1000)(0.98) + 1000}{(1000)(0.02) + 1000} = 49 \\cdot \\frac{980 + 1000}{20 + 1000} = 49 \\cdot \\frac{1980}{1020} = 49 \\cdot \\frac{198}{102} = 49 \\cdot \\frac{99}{51} = 49 \\cdot \\frac{33}{17} = \\frac{1617}{17}$.\nThe calculation is confirmed. This represents the ratio of error when using the incorrect quantification setting versus the correct one. The large value indicates a substantial penalty for using the wrong setting, as expected.", "answer": "$$\\boxed{\\frac{1617}{17}}$$", "id": "4351355"}]}