{"hands_on_practices": [{"introduction": "A foundational step in establishing the pharmacological basis of a digital therapeutic (DTx) is to characterize its \"dose-response\" relationship. In this context, the \"dose\" is often a measure of patient engagement, such as daily usage time. This practice [@problem_id:4545292] demonstrates how to apply a classic pharmacodynamic model, the Hill equation, to quantify the link between engagement and clinical effect, allowing you to calculate key parameters like potency ($EC_{50}$) and maximal efficacy ($E_{\\max}$).", "problem": "A prescription digital therapeutic delivers cognitive-behavioral content for a chronic condition, and its pharmacodynamic effect is driven by validated daily engagement time, denoted by $X$ (in minutes), analogous to an exposure variable. In line with receptor theory and the law of mass action, assume the exposure–response follows a saturable, cooperative relationship in which the fraction of maximal effect increases sigmoidally with $X$, is one-half at the half-maximal engagement $EC_{50}$, and has steepness governed by a Hill coefficient $\\gamma$. The maximal achievable effect on a standardized clinical outcome scale is $E_{\\max}$. For a particular product, $E_{\\max} = 10$, $EC_{50} = 20$ minutes, and $\\gamma = 2$. Using first principles of saturable pharmacodynamics grounded in mass-action and cooperative binding concepts, derive an expression for the fraction of maximal effect as a function of $X$, and then compute its value for $X = 30$ minutes of validated daily engagement. Report your final numeric answer as a unitless decimal fraction of $E_{\\max}$, and round your answer to four significant figures. Additionally, explain in words how large this effect is relative to the maximal effect, but only the numeric fraction should be reported as the final answer.", "solution": "The user has provided a problem to be solved. I will now perform validation of the problem statement.\n\n### Step 1: Extract Givens\n- **Variable**: Daily engagement time, denoted by $X$ (in minutes).\n- **Model Description**: The exposure-response relationship is saturable, cooperative, and follows a sigmoidal curve.\n- **Maximal Effect**: $E_{\\max} = 10$ on a standardized clinical outcome scale.\n- **Half-Maximal Engagement**: The effect is one-half of the maximum at $EC_{50} = 20$ minutes.\n- **Steepness/Cooperativity**: Hill coefficient, $\\gamma = 2$.\n- **Target Exposure**: $X = 30$ minutes.\n- **Objective 1**: Derive an expression for the fraction of maximal effect as a function of $X$.\n- **Objective 2**: Compute the value of this fraction for $X = 30$ minutes.\n- **Reporting**: The final numeric answer should be a unitless decimal fraction of $E_{\\max}$, rounded to four significant figures. A verbal explanation of the effect's magnitude is also requested.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific Grounding**: The problem is scientifically grounded. It applies the Hill-Langmuir equation, a standard and fundamental model in pharmacology used to describe cooperative binding and dose-response relationships. Applying this pharmacological model to the engagement-response of a digital therapeutic is a valid and commonly used analogy in the field of digital health and pharmacometrics. The parameters $E_{\\max}$, $EC_{50}$, and $\\gamma$ (Hill coefficient) are the standard terms for this model.\n2.  **Well-Posedness**: The problem is well-posed. It provides all necessary parameters to define the mathematical model and a specific input value ($X=30$) for which to calculate an output. The solution is unique and stable.\n3.  **Objectivity**: The problem is stated using objective, precise, and standard scientific terminology. There are no subjective or opinion-based claims.\n4.  **Completeness and Consistency**: The problem is self-contained. All data required for the calculation ($EC_{50}$, $\\gamma$, $X$) are provided. The value of $E_{\\max}$ is given for context but is not strictly necessary for calculating the *fraction* of maximal effect, which does not introduce a contradiction.\n5.  **Plausibility**: The given values are plausible within a modeling context. An $EC_{50}$ of $20$ minutes is a reasonable daily engagement target, and a Hill coefficient of $2$ indicates positive cooperativity, which is a standard feature of such models.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a direct application of a standard scientific model, the Hill equation, to a well-defined scenario. I will now proceed with the solution.\n\nThe problem requires the derivation of an expression for the fraction of maximal effect based on the principles of saturable, cooperative pharmacodynamics. The model described is the Hill-Langmuir equation, commonly known as the Hill equation. This equation models the effect $E$ as a function of exposure or concentration $X$.\n\nThe general form of the Hill equation is:\n$$\nE(X) = E_{\\min} + (E_{\\max} - E_{\\min}) \\frac{X^{\\gamma}}{EC_{50}^{\\gamma} + X^{\\gamma}}\n$$\nIn this context, the baseline effect in the absence of engagement is assumed to be zero, so $E_{\\min} = 0$. The equation simplifies to:\n$$\nE(X) = E_{\\max} \\frac{X^{\\gamma}}{EC_{50}^{\\gamma} + X^{\\gamma}}\n$$\nHere, $E(X)$ is the effect at an engagement level of $X$, $E_{\\max}$ is the maximal possible effect, $EC_{50}$ is the engagement level that produces $50\\%$ of the maximal effect, and $\\gamma$ is the Hill coefficient, which describes the steepness of the curve and the degree of cooperativity.\n\nThe first part of the task is to derive an expression for the fraction of maximal effect. This fraction, let us call it $f$, is the ratio of the effect at a given engagement $X$ to the maximal effect $E_{\\max}$.\n$$\nf = \\frac{E(X)}{E_{\\max}}\n$$\nSubstituting the expression for $E(X)$:\n$$\nf = \\frac{E_{\\max} \\frac{X^{\\gamma}}{EC_{50}^{\\gamma} + X^{\\gamma}}}{E_{\\max}}\n$$\nThe $E_{\\max}$ terms cancel, yielding the derived expression for the fraction of maximal effect:\n$$\nf(X) = \\frac{X^{\\gamma}}{EC_{50}^{\\gamma} + X^{\\gamma}}\n$$\nThis expression is the formal answer to the first part of the problem.\n\nThe second part of the task is to compute the value of this fraction for a specific engagement time. The given values are:\n- Daily engagement time, $X = 30$ minutes.\n- Half-maximal engagement, $EC_{50} = 20$ minutes.\n- Hill coefficient, $\\gamma = 2$.\n\nWe substitute these values into the derived expression for $f(X)$:\n$$\nf(30) = \\frac{30^{2}}{20^{2} + 30^{2}}\n$$\nNow, we perform the calculation:\n$$\nf(30) = \\frac{900}{400 + 900}\n$$\n$$\nf(30) = \\frac{900}{1300}\n$$\nSimplifying the fraction:\n$$\nf(30) = \\frac{9}{13}\n$$\nTo provide the answer as a decimal rounded to four significant figures, we compute the value of the fraction:\n$$\nf(30) = \\frac{9}{13} \\approx 0.69230769...\n$$\nRounding to four significant figures gives:\n$$\nf(30) \\approx 0.6923\n$$\nThis means that an engagement of $30$ minutes per day achieves approximately $69.23\\%$ of the maximal possible therapeutic effect. Qualitatively, this is a substantial effect, indicating that this level of engagement is significantly beyond the half-maximal point ($EC_{50} = 20$ minutes) and is on the upper, less steep portion of the sigmoidal exposure-response curve.", "answer": "$$\n\\boxed{0.6923}\n$$", "id": "4545292"}, {"introduction": "Beyond establishing that a DTx works, it is critical to validate *how* it works. This involves testing whether the observed clinical benefit is achieved through the intended mechanism of action, a process analogous to confirming target engagement for a traditional drug. This exercise [@problem_id:4545270] introduces causal mediation analysis, a powerful statistical method used to decompose a treatment's effect into direct and indirect pathways, allowing you to quantitatively assess if the therapeutic effect is mediated by the hypothesized psychological or behavioral change.", "problem": "A prescription digital therapeutic delivering individualized behavioral activation for major depressive disorder is evaluated in a randomized controlled trial (RCT). Let treatment assignment be denoted by $T \\in \\{0,1\\}$, behavioral activation level (the mediator) by $M$, and depressive symptom severity (the outcome) by $Y$. All three variables $T$, $M$, and $Y$ are standardized to mean $0$ and variance $1$. Assume a linear, additive, no-interaction causal system with stable unit treatment value and no interference, and that randomization ensures no unmeasured confounding of $T \\rightarrow M$ and $T \\rightarrow Y$, and that any mediator-outcome confounding is absent conditional on $T$. Under these conditions, consider the structural relations consistent with these assumptions: $M$ responds linearly to $T$, and $Y$ responds linearly to both $T$ and $M$. The standardized path coefficient from $T$ to $M$ is $\\alpha = 0.5$, and the standardized path coefficient from $M$ to $Y$ (adjusted for $T$) is $\\beta = 0.6$.\n\nUsing only fundamental definitions of linear causal mediation with standardized variables and no treatment-mediator interaction, derive from first principles the standardized natural indirect effect of the digital therapeutic on $Y$ operating through $M$, and then compute its numerical value. Briefly interpret the sign and magnitude of this indirect effect to assess mechanism validation, in the sense of whether the intended mechanism (increasing behavioral activation to reduce depressive symptoms) is supported by the data-generating structure.\n\nReport the final numerical value of the standardized indirect effect as a unitless decimal rounded to $4$ significant figures.", "solution": "The user wants me to solve a problem based on a provided problem statement.\n\n### Step 1: Extract Givens\n\n1.  **Variables**: \n    *   $T$: Treatment assignment, $T \\in \\{0, 1\\}$.\n    *   $M$: Behavioral activation level (mediator).\n    *   $Y$: Depressive symptom severity (outcome).\n2.  **Standardization**: Variables $T$, $M$, and $Y$ are standardized to have a mean of $0$ and a variance of $1$.\n3.  **Assumptions**:\n    *   The causal system is linear, additive, and has no treatment-mediator interaction.\n    *   The Stable Unit Treatment Value Assumption (SUTVA) holds, and there is no interference.\n    *   Randomization ensures no unmeasured confounding for the $T \\rightarrow M$ and $T \\rightarrow Y$ relationships.\n    *   There is no mediator-outcome confounding conditional on $T$.\n4.  **Structural Relations**:\n    *   $M$ responds linearly to $T$.\n    *   $Y$ responds linearly to both $T$ and $M$.\n5.  **Path Coefficients**:\n    *   Standardized path coefficient from $T$ to $M$: $\\alpha = 0.5$.\n    *   Standardized path coefficient from $M$ to $Y$ (adjusted for $T$): $\\beta = 0.6$.\n6.  **Task**:\n    *   Derive the standardized natural indirect effect (NIE) from first principles.\n    *   Compute the numerical value of the NIE.\n    *   Interpret the sign and magnitude for mechanism validation.\n    *   Report the numerical value rounded to $4$ significant figures.\n\n### Step 2: Validate Using Extracted Givens\n\n*   **Scientifically Grounded**: The problem utilizes the standard framework of linear causal mediation analysis, a well-established methodology in biostatistics, epidemiology, and social sciences. The application to a digital therapeutic for depression is a contemporary and valid context in clinical pharmacology. The assumptions listed are standard for simplifying the analysis and are explicitly stated. The numerical values of the coefficients, while leading to a counter-intuitive conclusion, are not physically or mathematically impossible.\n*   **Well-Posed**: The problem is well-posed. It provides a clearly defined set of linear structural equations with specified parameters and asks for the computation of a derived quantity (the indirect effect). The information provided is sufficient and consistent for deriving a unique solution.\n*   **Objective**: The problem is stated in precise, objective, and standard scientific terminology. It is free of ambiguity and subjective claims.\n\nThe problem does not violate any of the specified invalidity criteria. It is a valid, solvable problem in applied statistics.\n\n### Step 3: Verdict and Action\n\nThe problem is valid. I will proceed with the solution.\n\n### Derivation and Solution\n\nThe problem describes a linear causal system. Given that the variables $T$, $M$, and $Y$ are standardized to a mean of $0$ and a variance of $1$, the structural equations for the mediator ($M$) and the outcome ($Y$) can be written without intercepts.\n\nThe structural equation for the mediator $M$ as a linear function of the treatment $T$ is:\n$$ M = \\alpha T + \\epsilon_M $$\nwhere $\\alpha$ is the standardized path coefficient from $T$ to $M$, and $\\epsilon_M$ is a random error term with mean $0$. The assumption of no unmeasured confounding of the $T \\rightarrow M$ relationship ensures that $T$ and $\\epsilon_M$ are uncorrelated.\n\nThe structural equation for the outcome $Y$ as a linear function of the treatment $T$ and the mediator $M$ is:\n$$ Y = \\gamma' T + \\beta M + \\epsilon_Y $$\nwhere $\\gamma'$ is the standardized path coefficient representing the direct effect of $T$ on $Y$, $\\beta$ is the standardized path coefficient from $M$ to $Y$ adjusted for $T$, and $\\epsilon_Y$ is a random error term with mean $0$. The assumption of no mediator-outcome confounding conditional on $T$ implies that $\\epsilon_M$ and $\\epsilon_Y$ are uncorrelated, i.e., $\\text{Cov}(\\epsilon_M, \\epsilon_Y) = 0$.\n\nTo derive the natural indirect effect (NIE) from first principles, we use the potential outcomes framework. Let $M(t)$ be the potential value of the mediator if an individual were assigned treatment $T=t$, and let $Y(t, m)$ be the potential value of the outcome if an individual were assigned treatment $T=t$ and their mediator value were set to $m$.\n\nFrom our structural equations, we can write the potential outcomes as:\n$$ M(t) = \\alpha t + \\epsilon_M $$\n$$ Y(t, m) = \\gamma' t + \\beta m + \\epsilon_Y $$\n\nThe natural indirect effect is defined as the expected change in the outcome $Y$ when the treatment level is held constant at the treatment condition ($t=1$), while the mediator is changed from the value it would have taken under the control condition ($M(0)$) to the value it would have taken under the treatment condition ($M(1)$). Formally:\n$$ \\text{NIE} = E[Y(1, M(1)) - Y(1, M(0))] $$\nLet's express the terms inside the expectation using our potential outcome equations.\nThe potential value of the outcome, with $T$ set to $1$ and $M$ set to its potential value under treatment, $M(1)$, is:\n$$ Y(1, M(1)) = \\gamma' (1) + \\beta M(1) + \\epsilon_Y = \\gamma' + \\beta (\\alpha(1) + \\epsilon_M) + \\epsilon_Y = \\gamma' + \\alpha\\beta + \\beta\\epsilon_M + \\epsilon_Y $$\nThe potential value of the outcome, with $T$ set to $1$ and $M$ set to its potential value under control, $M(0)$, is:\n$$ Y(1, M(0)) = \\gamma' (1) + \\beta M(0) + \\epsilon_Y = \\gamma' + \\beta (\\alpha(0) + \\epsilon_M) + \\epsilon_Y = \\gamma' + \\beta\\epsilon_M + \\epsilon_Y $$\n\nNow, we substitute these into the definition of the NIE:\n$$ \\text{NIE} = E[(\\gamma' + \\alpha\\beta + \\beta\\epsilon_M + \\epsilon_Y) - (\\gamma' + \\beta\\epsilon_M + \\epsilon_Y)] $$\nSimplifying the expression inside the expectation:\n$$ \\text{NIE} = E[\\gamma' + \\alpha\\beta + \\beta\\epsilon_M + \\epsilon_Y - \\gamma' - \\beta\\epsilon_M - \\epsilon_Y] = E[\\alpha\\beta] $$\nSince $\\alpha$ and $\\beta$ are constants (path coefficients), the expectation of the constant is the constant itself.\n$$ \\text{NIE} = \\alpha\\beta $$\nThis derivation confirms that for a linear system without treatment-mediator interaction, the natural indirect effect is given by the product of the path coefficients from the treatment to the mediator and from the mediator to the outcome.\n\nThe problem provides the numerical values for the standardized path coefficients:\n$$ \\alpha = 0.5 $$\n$$ \\beta = 0.6 $$\nWe can now compute the numerical value of the NIE:\n$$ \\text{NIE} = (0.5)(0.6) = 0.3 $$\nThe problem requests the result rounded to $4$ significant figures, which is $0.3000$.\n\nFinally, we interpret this result in the context of mechanism validation. The intended mechanism is that the digital therapeutic (an increase in $T$) increases behavioral activation (an increase in $M$), which in turn *reduces* depressive symptom severity (a decrease in $Y$). This pathway implies that the path coefficient $\\alpha$ should be positive (treatment increases activation) and the path coefficient $\\beta$ should be negative (activation reduces symptoms).\n\nThe given model has $\\alpha = 0.5$, which is positive and consistent with the intended mechanism: the therapeutic increases behavioral activation.\nHowever, the model has $\\beta = 0.6$, which is positive. This implies that an increase in behavioral activation ($M$) leads to an *increase* in depressive symptom severity ($Y$), when controlling for treatment. This finding contradicts the hypothesized mechanism of action.\n\nThe resulting indirect effect, $\\text{NIE} = \\alpha\\beta = 0.3000$, is positive. This positive sign indicates that the overall effect transmitted through the mediator is one that *increases* depressive symptoms. Therefore, the data-generating structure as defined by the problem parameters does not support the validation of the intended mechanism. Instead, it suggests a paradoxical effect where the therapy's successful engagement of the target mechanism (behavioral activation) leads to a worsening of the clinical outcome. This is an instance of what is known as inconsistent mediation, where the indirect effect has the opposite sign to what is expected based on the therapeutic hypothesis.", "answer": "$$\n\\boxed{0.3000}\n$$", "id": "4545270"}, {"introduction": "A key promise of digital therapeutics is their ability to deliver personalized medicine at scale by dynamically adjusting treatment intensity. This practice [@problem_id:4545282] challenges you to design a Bayesian adaptive dosing algorithm, a sophisticated approach that embodies the principles of modern clinical pharmacology. You will build a decision-making engine that learns from individual patient data in real-time to optimize the \"dose\" of a behavioral intervention, balancing therapeutic benefit against potential adverse events and costs.", "problem": "A digital therapeutic platform adaptively assigns behavioral dose intensity across sessions to achieve a pharmacologically meaningful target attainment event while controlling adverse events. In each session for a given dose level, there are two independent Bernoulli outcomes: target attainment and adverse event. For each dose level, the probability of target attainment and the probability of adverse event are unknown and are modeled independently. To update beliefs, the platform uses a conjugate Beta prior and the Bernoulli likelihood for each outcome stream, applying Bayes’ rule after each session to form a posterior. From this posterior, the platform computes the posterior-predictive probability of target attainment and the posterior-predictive probability of adverse event at each dose level. The platform then selects the next dose to maximize an expected utility that trades off predicted target benefit, predicted adverse risk, and a linear dose cost, subject to a safety constraint that requires sufficiently high posterior probability that the adverse event probability is at or below a specified maximum.\n\nStart from the following fundamental bases: the Bernoulli likelihood for binary outcomes, conjugate Beta priors for unknown Bernoulli probabilities, Bayes’ rule, and the definition of posterior-predictive expectation under a Beta posterior. The expected utility is a linear combination of posterior-predictive quantities and a linear dose cost. The safety constraint is a posterior probability statement under the Beta posterior for the adverse event probability.\n\nFor each test case, you are given:\n- A set of dose intensity levels as a list, indexed from $0$.\n- For each dose index $d$, prior parameters for target attainment $(\\alpha^{(t)}_{d}, \\beta^{(t)}_{d})$ and observed counts up to now $(s^{(t)}_{d}, f^{(t)}_{d})$, where $s$ is the number of target attainment successes and $f$ is the number of failures at that dose.\n- For each dose index $d$, prior parameters for adverse events $(\\alpha^{(a)}_{d}, \\beta^{(a)}_{d})$ and observed counts up to now $(s^{(a)}_{d}, f^{(a)}_{d})$, where $s$ is the number of observed adverse events and $f$ is the number of non-adverse outcomes at that dose.\n- Utility weights $(w_{t}, w_{a}, w_{d})$, where $w_{t}$ multiplies the posterior-predictive probability of target attainment, $w_{a}$ multiplies the posterior-predictive probability of an adverse event, and $w_{d}$ multiplies the dose intensity as a linear cost.\n- Safety parameters: a maximum acceptable adverse event probability $q_{\\max}$ and a required posterior confidence level $\\gamma$.\n\nDecision rule to implement per test case:\n1. For each dose index $d$, update the target attainment posterior parameters to $(\\alpha^{(t)}_{d} + s^{(t)}_{d}, \\beta^{(t)}_{d} + f^{(t)}_{d})$ and the adverse event posterior parameters to $(\\alpha^{(a)}_{d} + s^{(a)}_{d}, \\beta^{(a)}_{d} + f^{(a)}_{d})$.\n2. Compute the posterior-predictive probability of target attainment at dose $d$ as the expectation under the updated Beta posterior, and similarly for adverse events. These are the expectations of the Bernoulli parameter under the corresponding Beta posterior.\n3. Enforce the safety constraint at dose $d$ by requiring the posterior probability that the adverse event probability is less than or equal to $q_{\\max}$ to be at least $\\gamma$. Discard doses that do not satisfy this constraint.\n4. Among the remaining safe doses, compute the expected utility\n   $$U(d) = w_{t} \\cdot \\text{PredTarget}(d) - w_{a} \\cdot \\text{PredAE}(d) - w_{d} \\cdot \\text{DoseIntensity}(d).$$\n   Select the dose index $d$ that maximizes $U(d)$. If there is a tie, select the smallest index. If no dose index satisfies the safety constraint, return $-1$.\n\nAll probabilities must be treated as decimals, not percentages. No physical units are required for the dose intensity. Angles are not involved.\n\nTest suite:\n- Test case $1$:\n  - Dose intensities: $[\\,1.0, 2.0, 3.5\\,]$.\n  - For all doses, priors for target attainment are $(\\alpha^{(t)}=\\;1, \\beta^{(t)}=\\;1)$ and priors for adverse events are $(\\alpha^{(a)}=\\;1, \\beta^{(a)}=\\;1)$.\n  - Target attainment observed counts by dose index:\n    - $d=0$: $(s^{(t)}, f^{(t)}) = (6, 4)$.\n    - $d=1$: $(s^{(t)}, f^{(t)}) = (14, 6)$.\n    - $d=2$: $(s^{(t)}, f^{(t)}) = (18, 12)$.\n  - Adverse event observed counts by dose index:\n    - $d=0$: $(s^{(a)}, f^{(a)}) = (0, 10)$.\n    - $d=1$: $(s^{(a)}, f^{(a)}) = (2, 18)$.\n    - $d=2$: $(s^{(a)}, f^{(a)}) = (6, 24)$.\n  - Utility weights: $(w_{t}, w_{a}, w_{d}) = (1.0, 0.5, 0.05)$.\n  - Safety parameters: $q_{\\max} = 0.2$, $\\gamma = 0.9$.\n\n- Test case $2$:\n  - Dose intensities: $[\\,1.0, 2.5\\,]$.\n  - For all doses, priors for target attainment are $(\\alpha^{(t)}=\\;1, \\beta^{(t)}=\\;1)$ and priors for adverse events are $(\\alpha^{(a)}=\\;1, \\beta^{(a)}=\\;1)$.\n  - Target attainment observed counts by dose index:\n    - $d=0$: $(s^{(t)}, f^{(t)}) = (8, 12)$.\n    - $d=1$: $(s^{(t)}, f^{(t)}) = (16, 4)$.\n  - Adverse event observed counts by dose index:\n    - $d=0$: $(s^{(a)}, f^{(a)}) = (0, 20)$.\n    - $d=1$: $(s^{(a)}, f^{(a)}) = (4, 16)$.\n  - Utility weights: $(w_{t}, w_{a}, w_{d}) = (1.0, 0.8, 0.1)$.\n  - Safety parameters: $q_{\\max} = 0.1$, $\\gamma = 0.8$.\n\n- Test case $3$:\n  - Dose intensities: $[\\,0.5, 1.5\\,]$.\n  - For all doses, priors for target attainment are $(\\alpha^{(t)}=\\;1, \\beta^{(t)}=\\;1)$ and priors for adverse events are $(\\alpha^{(a)}=\\;1, \\beta^{(a)}=\\;1)$.\n  - Target attainment observed counts by dose index:\n    - $d=0$: $(s^{(t)}, f^{(t)}) = (10, 10)$.\n    - $d=1$: $(s^{(t)}, f^{(t)}) = (15, 5)$.\n  - Adverse event observed counts by dose index:\n    - $d=0$: $(s^{(a)}, f^{(a)}) = (3, 7)$.\n    - $d=1$: $(s^{(a)}, f^{(a)}) = (5, 7)$.\n  - Utility weights: $(w_{t}, w_{a}, w_{d}) = (1.0, 1.0, 0.0)$.\n  - Safety parameters: $q_{\\max} = 0.05$, $\\gamma = 0.9$.\n\nYour program should produce a single line of output containing the recommended dose indices for the three test cases as a comma-separated list enclosed in square brackets, in the order of the test cases, using zero-based indexing and using $-1$ if no dose is safe. For example, an output might look like $[1,0,-1]$.", "solution": "The problem requires us to determine the optimal dose intensity for a digital therapeutic platform based on a Bayesian decision-theoretic framework. We are given a set of discrete dose levels and, for each dose, prior beliefs and observational data for two independent outcomes: target attainment and adverse events. The process involves updating our beliefs using Bayes' rule, checking for safety, and then selecting the dose that maximizes an expected utility function. The solution will be derived by applying the principles of Bayesian inference for Bernoulli processes using Beta distributions.\n\nLet us denote the probability of target attainment at dose index $d$ as $p_d^{(t)}$ and the probability of an adverse event as $p_d^{(a)}$. These probabilities are unknown.\n\n**1. Bayesian Model Specification**\n\nThe problem states that for each outcome (target attainment and adverse event), we have a Bernoulli process. The number of successes $s$ in $n$ trials follows a Binomial distribution. The likelihood function for an unknown probability parameter $p$, given $s$ successes and $f=n-s$ failures, is:\n$$ L(p | s, f) \\propto p^s (1-p)^f $$\nThe problem specifies a Beta distribution as the conjugate prior for the unknown probability $p$. A Beta distribution is defined by two positive shape parameters, $\\alpha$ and $\\beta$:\n$$ \\text{Prior}(p; \\alpha, \\beta) = \\frac{p^{\\alpha-1}(1-p)^{\\beta-1}}{B(\\alpha, \\beta)} \\propto p^{\\alpha-1}(1-p)^{\\beta-1} $$\nwhere $B(\\alpha, \\beta)$ is the Beta function.\n\nAccording to Bayes' rule, the posterior distribution is proportional to the product of the likelihood and the prior:\n$$ \\text{Posterior}(p | s, f) \\propto L(p | s, f) \\times \\text{Prior}(p; \\alpha, \\beta) $$\n$$ \\propto (p^s (1-p)^f) \\times (p^{\\alpha-1}(1-p)^{\\beta-1}) $$\n$$ \\propto p^{\\alpha+s-1} (1-p)^{\\beta+f-1} $$\nThis expression is the kernel of a new Beta distribution, $\\text{Beta}(\\alpha', \\beta')$, with updated parameters:\n$$ \\alpha' = \\alpha + s $$\n$$ \\beta' = \\beta + f $$\nThis process is applied independently for target attainment and adverse events for each dose level.\n\nFor each dose index $d$:\n- The posterior distribution for the target attainment probability $p_d^{(t)}$ is $\\text{Beta}(\\alpha'^{(t)}_{d}, \\beta'^{(t)}_{d})$, where $\\alpha'^{(t)}_{d} = \\alpha^{(t)}_{d} + s^{(t)}_{d}$ and $\\beta'^{(t)}_{d} = \\beta^{(t)}_{d} + f^{(t)}_{d}$.\n- The posterior distribution for the adverse event probability $p_d^{(a)}$ is $\\text{Beta}(\\alpha'^{(a)}_{d}, \\beta'^{(a)}_{d})$, where $\\alpha'^{(a)}_{d} = \\alpha^{(a)}_{d} + s^{(a)}_{d}$ and $\\beta'^{(a)}_{d} = \\beta^{(a)}_{d} + f^{(a)}_{d}$.\n\n**2. Posterior-Predictive Probabilities**\n\nThe posterior-predictive probability of an event in a future trial is its expected probability, where the expectation is taken over the posterior distribution of the probability parameter. For a variable $p$ following a Beta distribution, $p \\sim \\text{Beta}(\\alpha', \\beta')$, its expectation is:\n$$ E[p] = \\frac{\\alpha'}{\\alpha' + \\beta'} $$\nTherefore, for each dose $d$, we compute:\n- The posterior-predictive probability of target attainment, $\\text{PredTarget}(d)$:\n$$ \\text{PredTarget}(d) = E[p_d^{(t)} | \\text{data}] = \\frac{\\alpha'^{(t)}_{d}}{\\alpha'^{(t)}_{d} + \\beta'^{(t)}_{d}} $$\n- The posterior-predictive probability of an adverse event, $\\text{PredAE}(d)$:\n$$ \\text{PredAE}(d) = E[p_d^{(a)} | \\text{data}] = \\frac{\\alpha'^{(a)}_{d}}{\\alpha'^{(a)}_{d} + \\beta'^{(a)}_{d}} $$\n\n**3. Safety Constraint**\n\nA dose $d$ is considered safe only if we can assert with a sufficiently high degree of confidence that its true adverse event probability $p_d^{(a)}$ is below a specified maximum threshold $q_{\\max}$. This is formulated as a requirement on the posterior distribution of $p_d^{(a)}$:\n$$ P(p_d^{(a)} \\le q_{\\max} | \\text{data}) \\ge \\gamma $$\nwhere $\\gamma$ is the required confidence level. The left side of the inequality is the cumulative distribution function (CDF) of the posterior distribution for $p_d^{(a)}$, which is $\\text{Beta}(\\alpha'^{(a)}_{d}, \\beta'^{(a)}_{d})$, evaluated at $q_{\\max}$.\n$$ \\text{Dose } d \\text{ is safe if } \\text{CDF}_{\\text{Beta}(\\alpha'^{(a)}_{d}, \\beta'^{(a)}_{d})}(q_{\\max}) \\ge \\gamma $$\nDoses that do not satisfy this condition are discarded from consideration.\n\n**4. Expected Utility Maximization**\n\nAmong the doses that are deemed safe, we select the one that maximizes the expected utility function $U(d)$. This function is defined as a linear combination of the predicted benefit, predicted risk, and dose cost:\n$$ U(d) = w_{t} \\cdot \\text{PredTarget}(d) - w_{a} \\cdot \\text{PredAE}(d) - w_{d} \\cdot \\text{DoseIntensity}(d) $$\nwhere $(w_{t}, w_{a}, w_{d})$ are the given utility weights. The negative signs for $w_a$ and $w_d$ indicate that adverse events and higher dose intensities are costs that reduce utility.\n\nThe decision rule is to select the dose index $d^*$ such that:\n$$ d^* = \\arg\\max_{d \\in \\text{SafeDoses}} U(d) $$\nIf multiple doses yield the same maximum utility, the one with the smallest index is chosen. If the set of safe doses is empty, the procedure returns $-1$.\n\nWe now apply this four-step procedure to each test case.\n\n**Test Case 1 Evaluation:**\n- Doses: $[\\,1.0, 2.0, 3.5\\,]$\n- Priors: $(\\alpha^{(t)}, \\beta^{(t)}) = (1, 1)$, $(\\alpha^{(a)}, \\beta^{(a)}) = (1, 1)$ for all doses.\n- Weights: $(w_{t}, w_{a}, w_{d}) = (1.0, 0.5, 0.05)$\n- Safety: $q_{\\max} = 0.2$, $\\gamma = 0.9$\n\n*Dose $d=0$*:\n- Target posterior: $\\alpha'^{(t)}_0 = 1+6=7, \\beta'^{(t)}_0 = 1+4=5$. $\\text{PredTarget}(0) = \\frac{7}{12} \\approx 0.5833$.\n- AE posterior: $\\alpha'^{(a)}_0 = 1+0=1, \\beta'^{(a)}_0 = 1+10=11$. $\\text{PredAE}(0) = \\frac{1}{12} \\approx 0.0833$.\n- Safety: Check $P(p_0^{(a)} \\le 0.2)$ for $\\text{Beta}(1, 11)$. CDF is $1 - (1-0.2)^{11} \\approx 0.9141$. Since $0.9141 \\ge 0.9$, dose $0$ is safe.\n- Utility: $U(0) = 1.0(\\frac{7}{12}) - 0.5(\\frac{1}{12}) - 0.05(1.0) = \\frac{7}{12} - \\frac{0.5}{12} - 0.05 \\approx 0.5417 - 0.05 = 0.4917$.\n\n*Dose $d=1$*:\n- Target posterior: $\\alpha'^{(t)}_1 = 1+14=15, \\beta'^{(t)}_1 = 1+6=7$. $\\text{PredTarget}(1) = \\frac{15}{22} \\approx 0.6818$.\n- AE posterior: $\\alpha'^{(a)}_1 = 1+2=3, \\beta'^{(a)}_1 = 1+18=19$. $\\text{PredAE}(1) = \\frac{3}{22} \\approx 0.1364$.\n- Safety: Check $P(p_1^{(a)} \\le 0.2)$ for $\\text{Beta}(3, 19)$. CDF is $\\approx 0.8835$. Since $0.8835 < 0.9$, dose $1$ is unsafe.\n\n*Dose $d=2$*:\n- Target posterior: $\\alpha'^{(t)}_2 = 1+18=19, \\beta'^{(t)}_2 = 1+12=13$. $\\text{PredTarget}(2) = \\frac{19}{32} \\approx 0.5938$.\n- AE posterior: $\\alpha'^{(a)}_2 = 1+6=7, \\beta'^{(a)}_2 = 1+24=25$. $\\text{PredAE}(2) = \\frac{7}{32} \\approx 0.2188$.\n- Safety: Check $P(p_2^{(a)} \\le 0.2)$ for $\\text{Beta}(7, 25)$. CDF is $\\approx 0.3843$. Since $0.3843 < 0.9$, dose $2$ is unsafe.\n\nOnly dose $d=0$ is safe. Thus, the selected dose index is $0$.\n\n**Test Case 2 Evaluation:**\n- Doses: $[\\,1.0, 2.5\\,]$\n- Priors: $(\\alpha^{(t)}, \\beta^{(t)}) = (1, 1)$, $(\\alpha^{(a)}, \\beta^{(a)}) = (1, 1)$ for all doses.\n- Weights: $(w_{t}, w_{a}, w_{d}) = (1.0, 0.8, 0.1)$\n- Safety: $q_{\\max} = 0.1$, $\\gamma = 0.8$\n\n*Dose $d=0$*:\n- Target posterior: $\\alpha'^{(t)}_0 = 1+8=9, \\beta'^{(t)}_0 = 1+12=13$. $\\text{PredTarget}(0) = \\frac{9}{22} \\approx 0.4091$.\n- AE posterior: $\\alpha'^{(a)}_0 = 1+0=1, \\beta'^{(a)}_0 = 1+20=21$. $\\text{PredAE}(0) = \\frac{1}{22} \\approx 0.0455$.\n- Safety: Check $P(p_0^{(a)} \\le 0.1)$ for $\\text{Beta}(1, 21)$. CDF is $1 - (1-0.1)^{21} \\approx 0.8906$. Since $0.8906 \\ge 0.8$, dose $0$ is safe.\n- Utility: $U(0) = 1.0(\\frac{9}{22}) - 0.8(\\frac{1}{22}) - 0.1(1.0) = \\frac{9 - 0.8}{22} - 0.1 = \\frac{8.2}{22} - 0.1 \\approx 0.3727 - 0.1 = 0.2727$.\n\n*Dose $d=1$*:\n- Target posterior: $\\alpha'^{(t)}_1 = 1+16=17, \\beta'^{(t)}_1 = 1+4=5$. $\\text{PredTarget}(1) = \\frac{17}{22} \\approx 0.7727$.\n- AE posterior: $\\alpha'^{(a)}_1 = 1+4=5, \\beta'^{(a)}_1 = 1+16=17$. $\\text{PredAE}(1) = \\frac{5}{22} \\approx 0.2273$.\n- Safety: Check $P(p_1^{(a)} \\le 0.1)$ for $\\text{Beta}(5, 17)$. CDF is $\\approx 0.1495$. Since $0.1495 < 0.8$, dose $1$ is unsafe.\n\nOnly dose $d=0$ is safe. Thus, the selected dose index is $0$.\n\n**Test Case 3 Evaluation:**\n- Doses: $[\\,0.5, 1.5\\,]$\n- Priors: $(\\alpha^{(t)}, \\beta^{(t)}) = (1, 1)$, $(\\alpha^{(a)}, \\beta^{(a)}) = (1, 1)$ for all doses.\n- Weights: $(w_{t}, w_{a}, w_{d}) = (1.0, 1.0, 0.0)$\n- Safety: $q_{\\max} = 0.05$, $\\gamma = 0.9$\n\n*Dose $d=0$*:\n- Target posterior: $\\alpha'^{(t)}_0 = 1+10=11, \\beta'^{(t)}_0 = 1+10=11$. $\\text{PredTarget}(0) = \\frac{11}{22} = 0.5$.\n- AE posterior: $\\alpha'^{(a)}_0 = 1+3=4, \\beta'^{(a)}_0 = 1+7=8$. $\\text{PredAE}(0) = \\frac{4}{12} \\approx 0.3333$.\n- Safety: Check $P(p_0^{(a)} \\le 0.05)$ for $\\text{Beta}(4, 8)$. CDF is $\\approx 0.0157$. Since $0.0157 < 0.9$, dose $0$ is unsafe.\n\n*Dose $d=1$*:\n- Target posterior: $\\alpha'^{(t)}_1 = 1+15=16, \\beta'^{(t)}_1 = 1+5=6$. $\\text{PredTarget}(1) = \\frac{16}{22} \\approx 0.7273$.\n- AE posterior: $\\alpha'^{(a)}_1 = 1+5=6, \\beta'^{(a)}_1 = 1+7=8$. $\\text{PredAE}(1) = \\frac{6}{14} \\approx 0.4286$.\n- Safety: Check $P(p_1^{(a)} \\le 0.05)$ for $\\text{Beta}(6, 8)$. CDF is $\\approx 0.00035$. Since $0.00035 < 0.9$, dose $1$ is unsafe.\n\nNo doses are safe. Thus, the procedure returns $-1$.\n\nFinal results across the test cases are $[0, 0, -1]$.", "answer": "```python\nimport numpy as np\nfrom scipy.stats import beta\n\ndef solve():\n    \"\"\"\n    Main function to solve the adaptive dosing problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # Test case 1\n        {\n            \"dose_intensities\": [1.0, 2.0, 3.5],\n            \"priors_target\": [(1, 1), (1, 1), (1, 1)],\n            \"counts_target\": [(6, 4), (14, 6), (18, 12)],\n            \"priors_adverse\": [(1, 1), (1, 1), (1, 1)],\n            \"counts_adverse\": [(0, 10), (2, 18), (6, 24)],\n            \"utility_weights\": (1.0, 0.5, 0.05),\n            \"safety_params\": (0.2, 0.9)  # (q_max, gamma)\n        },\n        # Test case 2\n        {\n            \"dose_intensities\": [1.0, 2.5],\n            \"priors_target\": [(1, 1), (1, 1)],\n            \"counts_target\": [(8, 12), (16, 4)],\n            \"priors_adverse\": [(1, 1), (1, 1)],\n            \"counts_adverse\": [(0, 20), (4, 16)],\n            \"utility_weights\": (1.0, 0.8, 0.1),\n            \"safety_params\": (0.1, 0.8)\n        },\n        # Test case 3\n        {\n            \"dose_intensities\": [0.5, 1.5],\n            \"priors_target\": [(1, 1), (1, 1)],\n            \"counts_target\": [(10, 10), (15, 5)],\n            \"priors_adverse\": [(1, 1), (1, 1)],\n            \"counts_adverse\": [(3, 7), (5, 7)],\n            \"utility_weights\": (1.0, 1.0, 0.0),\n            \"safety_params\": (0.05, 0.9)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = find_best_dose(\n            case[\"dose_intensities\"],\n            case[\"priors_target\"],\n            case[\"counts_target\"],\n            case[\"priors_adverse\"],\n            case[\"counts_adverse\"],\n            case[\"utility_weights\"],\n            case[\"safety_params\"]\n        )\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef find_best_dose(\n    dose_intensities,\n    priors_target,\n    counts_target,\n    priors_adverse,\n    counts_adverse,\n    utility_weights,\n    safety_params\n):\n    \"\"\"\n    Implements the decision rule for a single test case.\n    \"\"\"\n    num_doses = len(dose_intensities)\n    w_t, w_a, w_d = utility_weights\n    q_max, gamma = safety_params\n    \n    safe_doses = []\n\n    for d in range(num_doses):\n        # 1. Update posterior parameters\n        alpha_t_prior, beta_t_prior = priors_target[d]\n        s_t, f_t = counts_target[d]\n        alpha_t_post = alpha_t_prior + s_t\n        beta_t_post = beta_t_prior + f_t\n\n        alpha_a_prior, beta_a_prior = priors_adverse[d]\n        s_a, f_a = counts_adverse[d]\n        alpha_a_post = alpha_a_prior + s_a\n        beta_a_post = beta_a_prior + f_a\n\n        # 2. Compute posterior-predictive probabilities\n        pred_target = alpha_t_post / (alpha_t_post + beta_t_post)\n        pred_ae = alpha_a_post / (alpha_a_post + beta_a_post)\n\n        # 3. Enforce the safety constraint\n        # P(p_adverse <= q_max) must be >= gamma\n        # This is the CDF of the Beta posterior for the adverse event probability\n        posterior_prob_safe = beta.cdf(q_max, alpha_a_post, beta_a_post)\n        \n        is_safe = posterior_prob_safe >= gamma\n\n        if is_safe:\n            # 4. Compute expected utility for safe doses\n            dose_intensity = dose_intensities[d]\n            utility = w_t * pred_target - w_a * pred_ae - w_d * dose_intensity\n            safe_doses.append({\"index\": d, \"utility\": utility})\n\n    if not safe_doses:\n        return -1\n    else:\n        # Select the dose index that maximizes utility.\n        # If there is a tie, the smallest index is chosen due to stable sort,\n        # or can be explicitly handled by sorting on index as a secondary key.\n        # Python's sort is stable, which means if utilities are equal,\n        # original order (by index) is preserved. max() with a key also\n        # returns the first occurrence in case of ties.\n        best_dose = max(safe_doses, key=lambda x: x[\"utility\"])\n        return best_dose[\"index\"]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "4545282"}]}