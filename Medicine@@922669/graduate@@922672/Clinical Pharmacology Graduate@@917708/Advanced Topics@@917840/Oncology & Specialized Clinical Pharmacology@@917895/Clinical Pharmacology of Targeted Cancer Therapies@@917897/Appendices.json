{"hands_on_practices": [{"introduction": "A cornerstone of pharmacology is understanding the average drug exposure a patient experiences during long-term therapy. This exercise guides you back to first principles, using the law of mass conservation to derive the fundamental equation for steady-state average concentration ($C_{\\mathrm{ss,avg}}$). By doing so, you will not only calculate a key pharmacokinetic parameter but also reinforce your understanding of why this relationship holds true for any drug exhibiting linear kinetics [@problem_id:4575263].", "problem": "An orally administered tyrosine kinase inhibitor (TKI) is given at a fixed maintenance regimen of $100$ mg once daily, that is, every $\\tau = 24$ h. The TKI exhibits linear pharmacokinetics in a one-compartment system with first-order absorption and first-order elimination. Assume the following: oral bioavailability $\\left(F\\right)$ is constant at $F = 0.5$, systemic clearance $\\left(CL\\right)$ is time-invariant and concentration-independent at $CL = 20$ L/h, volume of distribution is finite and constant, there is no enterohepatic recirculation, and there is no time-dependent change in clearance or bioavailability (for example, no auto-induction or mechanism-based inhibition over the timescale considered). Let $C\\left(t\\right)$ denote the plasma concentration and define the area under the concentration–time curve over a dosing interval as $\\mathrm{AUC}_{0-\\tau} = \\int_{0}^{\\tau} C\\left(t\\right)\\,dt$. Define the steady-state average concentration over a dosing interval as $C_{\\mathrm{ss,avg}} = \\frac{1}{\\tau}\\int_{0}^{\\tau} C\\left(t\\right)\\,dt$.\n\nUsing only fundamental definitions and conservation of mass over one dosing interval at steady state, derive an analytic expression for $C_{\\mathrm{ss,avg}}$ in terms of $F$, $Dose$, $CL$, and $\\tau$. Then, apply your derived expression to compute the steady-state average concentration for this TKI under the stated regimen and assumptions.\n\nRound your final numerical result to four significant figures and express the concentration in mg/L.", "solution": "The problem is first validated against the required criteria.\n\n**Step 1: Extract Givens**\n- Drug: Tyrosine kinase inhibitor (TKI)\n- Administration: Oral\n- Regimen: Fixed maintenance, once daily\n- Dose ($Dose$): $100$ mg\n- Dosing interval ($\\tau$): $24$ h\n- Pharmacokinetic model: Linear, one-compartment, first-order absorption, first-order elimination\n- Oral bioavailability ($F$): $0.5$ (constant)\n- Systemic clearance ($CL$): $20$ L/h (time-invariant, concentration-independent)\n- Volume of distribution ($V$): Finite and constant\n- Assumption: No enterohepatic recirculation\n- Assumption: No time-dependent changes in $CL$ or $F$\n- Plasma concentration as a function of time: $C(t)$\n- Area under the concentration-time curve over a dosing interval: $\\mathrm{AUC}_{0-\\tau} = \\int_{0}^{\\tau} C\\left(t\\right)\\,dt$\n- Steady-state average concentration: $C_{\\mathrm{ss,avg}} = \\frac{1}{\\tau}\\int_{0}^{\\tau} C\\left(t\\right)\\,dt$\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It is based on the fundamental principles of clinical pharmacokinetics, specifically the concept of steady state in a one-compartment linear model. All necessary parameters ($Dose$, $F$, $CL$, $\\tau$) and definitions ($\\mathrm{AUC}_{0-\\tau}$, $C_{\\mathrm{ss,avg}}$) are provided. The problem is self-contained, consistent, and free of any scientific or logical flaws. The requested task is to derive a standard pharmacokinetic relationship from first principles (conservation of mass) and then apply it, which is a valid and formalizable task.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A reasoned solution will be provided.\n\nThe derivation proceeds from the principle of conservation of mass. At steady state, over a single dosing interval $\\tau$, the total mass of drug entering the systemic circulation must equal the total mass of drug eliminated from the systemic circulation.\n\nLet $M_{in}$ be the mass of drug absorbed into the systemic circulation over one dosing interval, $\\tau$. The administered dose is $Dose$, and the fraction that reaches the systemic circulation is the bioavailability, $F$. Therefore, for each dosing interval, the mass absorbed is:\n$$M_{in} = F \\times Dose$$\n\nLet $M_{out}$ be the mass of drug eliminated from the systemic circulation over the same dosing interval, $\\tau$. The instantaneous rate of elimination (mass per unit time) is the product of systemic clearance, $CL$, and the plasma concentration at time $t$, $C(t)$.\n$$Rate_{elim}(t) = CL \\times C(t)$$\nTo find the total mass eliminated over the interval from $t=0$ to $t=\\tau$, we must integrate this instantaneous rate over the interval:\n$$M_{out} = \\int_{0}^{\\tau} Rate_{elim}(t)\\,dt = \\int_{0}^{\\tau} CL \\times C(t)\\,dt$$\nSince $CL$ is stated to be time-invariant and concentration-independent, it can be treated as a constant and factored out of the integral:\n$$M_{out} = CL \\times \\int_{0}^{\\tau} C(t)\\,dt$$\nThe problem defines the area under the concentration-time curve from $t=0$ to $t=\\tau$ as $\\mathrm{AUC}_{0-\\tau} = \\int_{0}^{\\tau} C(t)\\,dt$. Substituting this definition gives:\n$$M_{out} = CL \\times \\mathrm{AUC}_{0-\\tau}$$\n\nAt steady state, mass in equals mass out over one dosing interval:\n$$M_{in} = M_{out}$$\n$$F \\times Dose = CL \\times \\mathrm{AUC}_{0-\\tau}$$\n\nThe problem asks for an expression for the steady-state average concentration, $C_{\\mathrm{ss,avg}}$, which is defined as:\n$$C_{\\mathrm{ss,avg}} = \\frac{1}{\\tau}\\int_{0}^{\\tau} C(t)\\,dt = \\frac{\\mathrm{AUC}_{0-\\tau}}{\\tau}$$\nWe can rearrange our mass balance equation to solve for $C_{\\mathrm{ss,avg}}$. First, divide the mass balance equation by $\\tau$:\n$$\\frac{F \\times Dose}{\\tau} = \\frac{CL \\times \\mathrm{AUC}_{0-\\tau}}{\\tau}$$\nThis equation expresses the equality of the average rate of drug input and the average rate of drug elimination over the dosing interval. Recognizing that the right-hand side contains the definition of $C_{\\mathrm{ss,avg}}$:\n$$\\frac{F \\times Dose}{\\tau} = CL \\times \\left( \\frac{\\mathrm{AUC}_{0-\\tau}}{\\tau} \\right) = CL \\times C_{\\mathrm{ss,avg}}$$\nSolving for $C_{\\mathrm{ss,avg}}$ yields the desired analytic expression:\n$$C_{\\mathrm{ss,avg}} = \\frac{F \\times Dose}{CL \\times \\tau}$$\n\nNow, we apply this expression to compute the numerical value for the given TKI. The parameters are:\n- $F = 0.5$\n- $Dose = 100$ mg\n- $CL = 20$ L/h\n- $\\tau = 24$ h\n\nSubstituting these values into the derived formula:\n$$C_{\\mathrm{ss,avg}} = \\frac{0.5 \\times 100 \\text{ mg}}{(20 \\text{ L/h}) \\times (24 \\text{ h})}$$\n$$C_{\\mathrm{ss,avg}} = \\frac{50 \\text{ mg}}{480 \\text{ L}}$$\n$$C_{\\mathrm{ss,avg}} = \\frac{5}{48} \\text{ mg/L}$$\nCalculating the numerical value:\n$$C_{\\mathrm{ss,avg}} \\approx 0.1041666... \\text{ mg/L}$$\nRounding the result to four significant figures as requested:\n$$C_{\\mathrm{ss,avg}} \\approx 0.1042 \\text{ mg/L}$$\nThis is the steady-state average concentration for the TKI under the stated regimen and assumptions.", "answer": "$$\n\\boxed{0.1042}\n$$", "id": "4575263"}, {"introduction": "The clinical success of an oral targeted therapy often depends on its physicochemical properties and how they interact with the patient's physiology. This practice explores a critical real-world scenario: the pH-dependent solubility of a weakly basic drug and the potential for a significant drug-drug interaction with acid-reducing agents [@problem_id:4575259]. By applying the Henderson-Hasselbalch principle to solubility, you will quantify how a change in gastric pH can dramatically alter a drug's dissolution, providing a mechanistic basis for a common clinical challenge.", "problem": "A clinical pharmacologist is evaluating a new tyrosine kinase inhibitor (TKI) that is a monoprotic weak base with acid dissociation constant $pK_a = 5.5$ and intrinsic solubility $S_0 = 0.05$ mg/mL. The intrinsic solubility $S_0$ is the saturation concentration of the neutral base in the absence of ionization. Assume ideal solution behavior (activity coefficients near unity), no complex precipitation or salt-limited solubility, and that only the singly protonated species forms in the clinically relevant $\\mathrm{pH}$ range. The gastric $\\mathrm{pH}$ under fasting conditions is $2$, but a coadministered proton pump inhibitor (PPI) may raise gastric $\\mathrm{pH}$ to $5$.\n\nStarting from the acid–base equilibrium of a monoprotic weak base and the definition of $pK_a$, and using the concept that the ionized fraction contributes additively to the apparent solubility of a weak base, derive the relationship between total solubility $S_{\\text{total}}$ and $\\mathrm{pH}$ in terms of $S_0$, $pK_a$, and $\\mathrm{pH}$. Then use it to compute the total solubility at $\\mathrm{pH} = 2$ and at $\\mathrm{pH} = 5$ in mg/mL. Finally, report as your answer the fold-change in solubility upon PPI coadministration, defined as the ratio $S_{\\text{total}}(\\mathrm{pH}=5)/S_{\\text{total}}(\\mathrm{pH}=2)$, expressed as a decimal with no units. Round your final ratio to three significant figures.", "solution": "The user-provided problem is evaluated against the validation criteria.\n\n### Step 1: Extract Givens\n- Drug is a monoprotic weak base.\n- Acid dissociation constant of the conjugate acid: $pK_a = 5.5$.\n- Intrinsic solubility of the neutral base: $S_0 = 0.05$ mg/mL.\n- Assumptions: ideal solution behavior, no complex precipitation or salt-limited solubility, only singly protonated species forms.\n- Fasting gastric pH: $\\mathrm{pH}_{\\text{fasting}} = 2$.\n- Gastric pH with proton pump inhibitor (PPI): $\\mathrm{pH}_{\\text{PPI}} = 5$.\n- Task 1: Derive the relationship between total solubility $S_{\\text{total}}$ and $\\mathrm{pH}$ in terms of $S_0$, $pK_a$, and $\\mathrm{pH}$.\n- Task 2: Compute $S_{\\text{total}}$ at $\\mathrm{pH} = 2$.\n- Task 3: Compute $S_{\\text{total}}$ at $\\mathrm{pH} = 5$.\n- Task 4: Compute the fold-change ratio $S_{\\text{total}}(\\mathrm{pH}=5) / S_{\\text{total}}(\\mathrm{pH}=2)$.\n- Reporting requirement: Final ratio as a decimal rounded to three significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, describing the well-established principle of pH-dependent solubility for ionizable compounds. This is a fundamental concept in pharmaceutics and pharmacology. The provided values ($pK_a$, $S_0$, $\\mathrm{pH}$ levels) are realistic for a clinical scenario involving an oral drug. The problem is well-posed, providing all necessary data and explicit assumptions to allow for a unique, stable solution. The terminology is precise and objective. The problem does not violate any of the invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A reasoned solution will be provided.\n\n### Solution Derivation and Calculation\n\nThe problem requires the derivation of the total solubility ($S_{\\text{total}}$) of a monoprotic weak base as a function of $\\mathrm{pH}$. Let the weak base be represented by the symbol $B$ and its protonated (conjugate acid) form by $BH^+$.\n\nThe relevant chemical equilibrium is the dissociation of the conjugate acid, for which the $pK_a$ is given:\n$$BH^+ \\rightleftharpoons B + H^+$$\n\nThe acid dissociation constant, $K_a$, is defined by the mass-action expression for this equilibrium:\n$$K_a = \\frac{[B][H^+]}{[BH^+]}$$\nwhere the brackets denote molar concentrations. The problem assumes ideal behavior, so activities are replaced by concentrations.\n\nThe total solubility, $S_{\\text{total}}$, is the maximum total concentration of the drug that can be dissolved in the solution at a given $\\mathrm{pH}$. It is the sum of the concentrations of all dissolved species at saturation:\n$$S_{\\text{total}} = [B]_{\\text{sat}} + [BH^+]_{\\text{sat}}$$\n\nA key principle of solubility for ionizable compounds is that the concentration of the neutral, unionized species in a saturated solution is constant and equal to its intrinsic solubility, $S_0$, regardless of the $\\mathrm{pH}$. Therefore, at saturation:\n$$[B]_{\\text{sat}} = S_0$$\n\nNow, we can express the concentration of the protonated species, $[BH^+]_{\\text{sat}}$, in terms of $S_0$. Rearranging the $K_a$ expression and substituting $[B]_{\\text{sat}} = S_0$:\n$$[BH^+]_{\\text{sat}} = \\frac{[B]_{\\text{sat}}[H^+]}{K_a} = \\frac{S_0[H^+]}{K_a}$$\n\nSubstituting the expressions for $[B]_{\\text{sat}}$ and $[BH^+]_{\\text{sat}}$ back into the equation for $S_{\\text{total}}$:\n$$S_{\\text{total}} = S_0 + \\frac{S_0[H^+]}{K_a}$$\n\nFactoring out $S_0$ yields the relationship between total solubility, intrinsic solubility, and hydrogen ion concentration:\n$$S_{\\text{total}} = S_0 \\left(1 + \\frac{[H^+]}{K_a}\\right)$$\n\nTo express this relationship in terms of $\\mathrm{pH}$ and $pK_a$, we use the definitions $\\mathrm{pH} = -\\log_{10}([H^+])$ and $pK_a = -\\log_{10}(K_a)$. This means $[H^+] = 10^{-\\mathrm{pH}}$ and $K_a = 10^{-pK_a}$. The ratio becomes:\n$$\\frac{[H^+]}{K_a} = \\frac{10^{-\\mathrm{pH}}}{10^{-pK_a}} = 10^{(pK_a - \\mathrm{pH})}$$\n\nSubstituting this into the solubility equation gives the final derived relationship:\n$$S_{\\text{total}} = S_0 (1 + 10^{(pK_a - \\mathrm{pH})})$$\n\nThis is the Henderson-Hasselbalch equation adapted for the solubility of a weak base.\n\nNext, we use this derived formula to compute the solubilities at the specified $\\mathrm{pH}$ values, using the given parameters $S_0 = 0.05$ mg/mL and $pK_a = 5.5$.\n\n**Solubility at $\\mathrm{pH} = 2$ (fasting gastric conditions):**\n$$S_{\\text{total}}(\\mathrm{pH}=2) = S_0 (1 + 10^{(5.5 - 2)}) = 0.05 \\times (1 + 10^{3.5})$$\n\n**Solubility at $\\mathrm{pH} = 5$ (with PPI coadministration):**\n$$S_{\\text{total}}(\\mathrm{pH}=5) = S_0 (1 + 10^{(5.5 - 5)}) = 0.05 \\times (1 + 10^{0.5})$$\n\nThe problem asks for the fold-change in solubility, defined as the ratio $S_{\\text{total}}(\\mathrm{pH}=5) / S_{\\text{total}}(\\mathrm{pH}=2)$.\n$$\\text{Fold-change} = \\frac{S_{\\text{total}}(\\mathrm{pH}=5)}{S_{\\text{total}}(\\mathrm{pH}=2)} = \\frac{0.05 \\times (1 + 10^{0.5})}{0.05 \\times (1 + 10^{3.5})}$$\n\nThe $S_0$ term cancels out, simplifying the expression:\n$$\\text{Fold-change} = \\frac{1 + 10^{0.5}}{1 + 10^{3.5}}$$\n\nNow, we evaluate this expression numerically:\n$10^{0.5} = \\sqrt{10} \\approx 3.16227766$\n$10^{3.5} = 10^3 \\times 10^{0.5} \\approx 1000 \\times 3.16227766 = 3162.27766$\n\n$$\\text{Fold-change} = \\frac{1 + 3.16227766}{1 + 3162.27766} = \\frac{4.16227766}{3163.27766} \\approx 0.001315816$$\n\nRounding the final result to three significant figures, we get $0.00132$. This significant decrease in solubility upon raising the gastric $\\mathrm{pH}$ is a classic example of a drug-drug interaction mediated by gastric acid-reducing agents, a critical consideration in clinical pharmacology.", "answer": "$$\\boxed{0.00132}$$", "id": "4575259"}, {"introduction": "The ultimate goal of clinical pharmacology is to define and leverage the relationship between drug exposure and clinical response. This advanced practice bridges pharmacokinetics (PK) and pharmacodynamics (PD) by tasking you with building an exposure-response model from scratch [@problem_id:4575252]. You will implement a logistic regression model using the Newton-Raphson method to quantify how the probability of toxicity changes with drug concentration, a core skill in modern drug development and therapeutic individualization.", "problem": "You are given patient-level trough concentrations at steady state, commonly denoted as minimum concentration $C_{\\min}$, for a Tyrosine Kinase Inhibitor (TKI), and whether each patient experienced grade greater than or equal to $2$ toxicity according to the Common Terminology Criteria for Adverse Events (CTCAE). Assume that toxicity emerges from exposure with monotonically increasing log-odds as concentration increases. Model the probability of grade greater than or equal to $2$ toxicity as a function of $C_{\\min}$ via logistic regression, using maximum likelihood estimation from first principles.\n\nStart from the following foundational base in clinical pharmacology and biostatistics:\n\n- Pharmacokinetic-pharmacodynamic exposure-response principle: for many inhibitors, higher exposure increases the chance of toxicity in a monotonic manner.\n- Binary outcome model for toxicity: each patient $i$ has a binary outcome $y_i \\in \\{0,1\\}$, where $y_i = 1$ indicates grade greater than or equal to $2$ toxicity and $y_i = 0$ otherwise, modeled as an independent Bernoulli random variable with parameter $p_i$.\n- Bernoulli likelihood: the probability mass function is $f(y_i \\mid p_i) = p_i^{y_i} (1 - p_i)^{1 - y_i}$.\n- Logit link: the log-odds are linear in exposure, $\\operatorname{logit}(p_i) = \\ln\\left(\\frac{p_i}{1 - p_i}\\right) = \\beta_0 + \\beta_1 x_i$, where $x_i$ is $C_{\\min}$ for patient $i$, $\\beta_0$ is the intercept, and $\\beta_1$ is the slope parameter describing how log-odds change per unit concentration.\n\nYou must derive and implement a maximum likelihood estimator for $\\beta_0$ and $\\beta_1$ using Newton–Raphson (iteratively reweighted least squares) without calling any prebuilt classification routines. Use the natural logarithm. Then, compute predicted probabilities $p(x) = \\frac{1}{1 + e^{-(\\beta_0 + \\beta_1 x)}}$ for specified test concentrations.\n\nTraining data (all $C_{\\min}$ values are in $\\mathrm{ng/mL}$):\n- Concentrations $x$ (in $\\mathrm{ng/mL}$): $[8, 15, 22, 29, 36, 44, 52, 60, 68, 76, 84, 92, 105, 120, 135, 150, 170, 190, 210, 230]$.\n- Toxicity indicators $y$: $[0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1]$.\n\nMathematical and algorithmic requirements:\n- Define the log-likelihood $\\ell(\\beta_0, \\beta_1) = \\sum_{i=1}^{n} \\left( y_i (\\beta_0 + \\beta_1 x_i) - \\ln\\left(1 + e^{\\beta_0 + \\beta_1 x_i}\\right) \\right)$.\n- Derive the gradient $\\nabla \\ell(\\boldsymbol{\\beta}) = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p})$, where $\\mathbf{X}$ is the $n \\times 2$ design matrix with first column all ones and second column $x_i$, $\\mathbf{y}$ is the vector of outcomes, and $\\mathbf{p}$ has entries $p_i = \\frac{1}{1 + e^{-(\\beta_0 + \\beta_1 x_i)}}$.\n- Derive the Hessian $\\mathbf{H}(\\boldsymbol{\\beta}) = -\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}$, where $\\mathbf{W}$ is diagonal with entries $p_i (1 - p_i)$.\n- Implement the Newton step by solving $\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X} \\, \\Delta \\boldsymbol{\\beta} = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p})$ and updating $\\boldsymbol{\\beta} \\leftarrow \\boldsymbol{\\beta} + \\Delta \\boldsymbol{\\beta}$ until convergence.\n\nScientific realism constraints:\n- Treat $C_{\\min}$ as steady-state trough concentration in $\\mathrm{ng/mL}$.\n- Probabilities must be reported as decimals in $[0,1]$ (no percentage signs).\n\nTest suite:\n- Compute predicted probabilities for $x$ (in $\\mathrm{ng/mL}$): $[0, 25, 75, 120, 180, 300]$.\n\nAnswer specification:\n- Your program must fit $\\beta_0$ and $\\beta_1$ to the training data using the method above, then compute $p(x)$ for the six test concentrations.\n- Express the final results as six decimal numbers rounded to four places after the decimal point, in a single line, as a comma-separated list enclosed in square brackets.\n- The final output format must be exactly: for example, $[0.1234,0.5678,0.9012,0.3456,0.7890,0.2345]$.\n\nNo external input is permitted. The program must be fully self-contained and produce the specified output from the embedded training set and test suite.", "solution": "We aim to build a logistic regression model relating trough concentration $C_{\\min}$ to the probability of grade greater than or equal to $2$ toxicity for a Tyrosine Kinase Inhibitor, using maximum likelihood estimation from fundamental definitions. We begin by formalizing the binary outcome model and the likelihood.\n\nEach patient $i$ provides an exposure $x_i$ (in $\\mathrm{ng/mL}$) and a binary toxicity indicator $y_i \\in \\{0,1\\}$. The Bernoulli model posits that $y_i \\sim \\operatorname{Bernoulli}(p_i)$, where $p_i$ is the probability of toxicity at exposure $x_i$. The likelihood is $L(\\boldsymbol{\\beta}) = \\prod_{i=1}^{n} p_i^{y_i} (1 - p_i)^{1 - y_i}$, with $p_i$ modeled through the logit link,\n$$\n\\operatorname{logit}(p_i) = \\ln\\left(\\frac{p_i}{1-p_i}\\right) = \\beta_0 + \\beta_1 x_i,\n$$\nso that\n$$\np_i = \\frac{1}{1 + e^{-(\\beta_0 + \\beta_1 x_i)}}.\n$$\nThis link arises from assuming the log-odds of toxicity increase linearly with exposure, a clinically reasonable simplification consistent with monotonic exposure-response relationships in targeted inhibitor pharmacology.\n\nThe log-likelihood is\n$$\n\\ell(\\boldsymbol{\\beta}) = \\sum_{i=1}^{n} \\left[ y_i (\\beta_0 + \\beta_1 x_i) - \\ln\\left(1 + e^{\\beta_0 + \\beta_1 x_i}\\right) \\right],\n$$\nwhere $\\boldsymbol{\\beta} = (\\beta_0, \\beta_1)^\\top$. To maximize $\\ell(\\boldsymbol{\\beta})$, we compute the gradient and Hessian for Newton–Raphson updates. Let $\\mathbf{X}$ be the $n \\times 2$ design matrix with first column $\\mathbf{1}$ and second column the exposures $(x_i)$, let $\\mathbf{y}$ be the vector of observed outcomes, and let $\\mathbf{p}$ be the vector with entries $p_i$ as above. The gradient is\n$$\n\\nabla \\ell(\\boldsymbol{\\beta}) = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p}),\n$$\nand the Hessian is\n$$\n\\mathbf{H}(\\boldsymbol{\\beta}) = -\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}, \\quad \\text{with} \\quad \\mathbf{W} = \\operatorname{diag}\\left(p_i (1 - p_i)\\right).\n$$\nThe Newton step solves\n$$\n\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X} \\, \\Delta \\boldsymbol{\\beta} = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p}),\n$$\nand updates\n$$\n\\boldsymbol{\\beta} \\leftarrow \\boldsymbol{\\beta} + \\Delta \\boldsymbol{\\beta}.\n$$\nThis is equivalent to iteratively reweighted least squares (IRLS), where the weights are $p_i (1 - p_i)$ and the working responses reflect the current residuals $(y_i - p_i)$.\n\nAlgorithmic design:\n- Initialize $\\boldsymbol{\\beta}^{(0)} = (0, 0)^\\top$.\n- For iteration $t = 0, 1, \\dots$:\n  1. Compute $p_i^{(t)} = \\frac{1}{1 + e^{-(\\beta_0^{(t)} + \\beta_1^{(t)} x_i)}}$ for all $i$.\n  2. Form $\\mathbf{W}^{(t)} = \\operatorname{diag}\\left(p_i^{(t)} (1 - p_i^{(t)})\\right)$.\n  3. Compute the right-hand side $\\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p}^{(t)})$.\n  4. Solve $(\\mathbf{X}^\\top \\mathbf{W}^{(t)} \\mathbf{X}) \\, \\Delta \\boldsymbol{\\beta}^{(t)} = \\mathbf{X}^\\top (\\mathbf{y} - \\mathbf{p}^{(t)})$ for $\\Delta \\boldsymbol{\\beta}^{(t)}$.\n  5. Update $\\boldsymbol{\\beta}^{(t+1)} = \\boldsymbol{\\beta}^{(t)} + \\Delta \\boldsymbol{\\beta}^{(t)}$.\n  6. Stop when $\\|\\Delta \\boldsymbol{\\beta}^{(t)}\\|_2$ is below a small tolerance (for example, $10^{-10}$) or a maximum iteration cap is reached.\n- For numerical stability in the rare case of near-singular $\\mathbf{X}^\\top \\mathbf{W} \\mathbf{X}$ (e.g., quasi-separation), add a very small ridge term $\\lambda \\mathbf{I}$ to the system with $\\lambda$ a tiny positive constant (e.g., $\\lambda = 10^{-8}$), which does not materially alter the maximum likelihood but ensures solvability.\n\nOnce $\\widehat{\\boldsymbol{\\beta}} = (\\widehat{\\beta}_0, \\widehat{\\beta}_1)^\\top$ is found, compute the predicted probabilities for any new concentration $x$ as\n$$\n\\widehat{p}(x) = \\frac{1}{1 + e^{-(\\widehat{\\beta}_0 + \\widehat{\\beta}_1 x)}}.\n$$\nApply this to the specified test suite concentrations $[0, 25, 75, 120, 180, 300]$ (in $\\mathrm{ng/mL}$). The outputs are dimensionless probabilities and must be expressed as decimals rounded to four places.\n\nThis approach ties pharmacological exposure-response rationale (higher $C_{\\min}$ generally increases toxicity risk) to a rigorous statistical model using only foundational definitions and optimization, ensuring an interpretable slope $\\widehat{\\beta}_1$ that quantifies how each $\\mathrm{ng/mL}$ increment in $C_{\\min}$ changes the log-odds of grade greater than or equal to $2$ toxicity. The algorithm is implemented in a self-contained Python program that fits the model on the embedded training data and prints the six requested probabilities in the exact required format.\n```python\nimport numpy as np\n\ndef irls_logistic_regression(X, y, max_iter=1000, tol=1e-10, ridge=1e-8):\n    \"\"\"\n    Fit logistic regression via Iteratively Reweighted Least Squares (Newton-Raphson).\n\n    Parameters:\n        X: Design matrix of shape (n_samples, n_features), with intercept column included.\n        y: Binary response vector of shape (n_samples,).\n        max_iter: Maximum number of iterations.\n        tol: Convergence tolerance on parameter update norm.\n        ridge: Small diagonal ridge added to X^T W X for numerical stability.\n\n    Returns:\n        beta: Estimated parameter vector of shape (n_features,).\n    \"\"\"\n    n_features = X.shape[1]\n    beta = np.zeros(n_features)\n\n    for _ in range(max_iter):\n        z = X @ beta\n        # Sigmoid probabilities\n        p = 1.0 / (1.0 + np.exp(-z))\n\n        # Weights: p * (1 - p)\n        w = p * (1.0 - p)\n\n        # Guard against zero weights by adding a tiny floor\n        w = np.maximum(w, 1e-12)\n\n        # Compute gradient: X^T (y - p)\n        grad = X.T @ (y - p)\n\n        # Hessian (negative of second derivative of log-likelihood): X^T W X\n        # Build W as diagonal efficiently via multiplying columns\n        WX = X * w[:, None]\n        H = X.T @ WX\n\n        # Add small ridge for numerical stability\n        H += ridge * np.eye(n_features)\n\n        # Solve H * delta = grad for Newton step\n        try:\n            delta = np.linalg.solve(H, grad)\n        except np.linalg.LinAlgError:\n            # Fallback to least-squares solution if singular\n            delta, *_ = np.linalg.lstsq(H, grad, rcond=None)\n\n        beta_new = beta + delta\n\n        # Check convergence\n        if np.linalg.norm(delta) < tol:\n            beta = beta_new\n            break\n\n        beta = beta_new\n\n    return beta\n\ndef predict_prob(beta, x):\n    \"\"\"Predict probability for a scalar or array x given beta = [beta0, beta1].\"\"\"\n    x = np.asarray(x, dtype=float)\n    z = beta[0] + beta[1] * x\n    return 1.0 / (1.0 + np.exp(-z))\n\ndef solve():\n    # Training data: Cmin (ng/mL) and toxicity indicator (grade >= 2 as 1, else 0)\n    x_train = np.array([8, 15, 22, 29, 36, 44, 52, 60, 68, 76, 84, 92, 105, 120, 135, 150, 170, 190, 210, 230], dtype=float)\n    y_train = np.array([0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1], dtype=float)\n\n    # Design matrix with intercept\n    X = np.column_stack([np.ones_like(x_train), x_train])\n\n    # Fit logistic regression via IRLS\n    beta_hat = irls_logistic_regression(X, y_train, max_iter=1000, tol=1e-10, ridge=1e-8)\n\n    # Test suite concentrations (ng/mL)\n    test_cases = [0.0, 25.0, 75.0, 120.0, 180.0, 300.0]\n\n    # Predict probabilities\n    probs = predict_prob(beta_hat, np.array(test_cases))\n\n    # Round to 4 decimal places and format\n    results_str = [f\"{p:.4f}\" for p in probs]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```", "answer": "[0.0101,0.0245,0.4042,0.9168,0.9961,1.0000]", "id": "4575252"}]}