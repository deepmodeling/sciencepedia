{"hands_on_practices": [{"introduction": "Understanding how a drug's concentration changes over time in the body is the cornerstone of clinical pharmacology. This first practice invites you to model the pharmacokinetic profile of the JAK inhibitor tofacitinib at steady state. By applying the principle of mass balance, you will derive expressions for the average drug concentration and its fluctuation over a dosing interval, providing critical insights into how a dosing regimen achieves a therapeutic window. [@problem_id:4536912]", "problem": "An adult patient with moderate ulcerative colitis is initiated on the Janus kinase (JAK) inhibitor tofacitinib immediate-release at a regimen of $10\\,\\mathrm{mg}$ orally every $12\\,\\mathrm{h}$. Assume linear pharmacokinetics in a one-compartment model with first-order elimination, absolute oral bioavailability $F = 0.74$, systemic clearance $\\mathrm{CL} = 24\\,\\mathrm{L}\\,\\mathrm{h}^{-1}$, elimination half-life $t_{1/2} = 3.0\\,\\mathrm{h}$, and an absorption rate constant $k_{a} = 2.0\\,\\mathrm{h}^{-1}$ such that $k_{a} \\gg k_{el}$.\n\nStarting from fundamental mass balance and core pharmacokinetic definitions, derive an expression for the steady-state average plasma concentration $C_{ss,\\mathrm{avg}}$ over a dosing interval and compute its value for this regimen. Express your final $C_{ss,\\mathrm{avg}}$ in $\\mathrm{ng}\\,\\mathrm{mL}^{-1}$ and round to three significant figures.\n\nNext, define the steady-state fluctuation as the peak-to-trough ratio $C_{\\max}/C_{\\min}$ over one dosing interval and, using the one-compartment first-order elimination model and the stated condition $k_{a} \\gg k_{el}$, derive the closed-form expression for $C_{\\max}/C_{\\min}$ in terms of $k_{el}$ and $\\tau$, then compute the numerical value for this regimen. Report the ratio as a pure number rounded to three significant figures.\n\nUse the dosing interval $\\tau = 12\\,\\mathrm{h}$. Make no additional assumptions beyond linear pharmacokinetics and the quantities provided.", "solution": "The problem is deemed valid as it is scientifically grounded in established principles of pharmacokinetics, is well-posed with sufficient and consistent data, and is expressed in objective, formal language. We may proceed with the solution.\n\nThe problem asks for two distinct derivations and calculations based on a one-compartment pharmacokinetic model with first-order absorption and elimination for a drug administered orally.\n\nPart 1: Derivation and computation of the steady-state average plasma concentration, $C_{ss,\\mathrm{avg}}$.\n\nThe fundamental principle of pharmacokinetics at steady state is that the rate of drug administration is equal to the rate of drug elimination when averaged over one dosing interval, $\\tau$. This is an expression of mass balance.\n\nThe dose administered is $D$. The fraction of the dose that reaches systemic circulation is the absolute oral bioavailability, $F$. Therefore, the total amount of drug entering the systemic circulation over one dosing interval is $F \\cdot D$. The average rate of drug input is this amount divided by the dosing interval, $\\tau$.\n$$ \\text{Average Rate In} = \\frac{F \\cdot D}{\\tau} $$\nThe rate of drug elimination from the body at any time $t$ is given by the product of the systemic clearance, $\\mathrm{CL}$, and the plasma drug concentration, $C(t)$.\n$$ \\text{Rate of Elimination}(t) = \\mathrm{CL} \\cdot C(t) $$\nAt steady state, the average rate of elimination over one dosing interval is the product of the clearance and the average steady-state concentration, $C_{ss,\\mathrm{avg}}$.\n$$ \\text{Average Rate Out} = \\mathrm{CL} \\cdot C_{ss,\\mathrm{avg}} $$\nBy equating the average rate in and the average rate out, we obtain:\n$$ \\frac{F \\cdot D}{\\tau} = \\mathrm{CL} \\cdot C_{ss,\\mathrm{avg}} $$\nSolving for $C_{ss,\\mathrm{avg}}$ yields the expression:\n$$ C_{ss,\\mathrm{avg}} = \\frac{F \\cdot D}{\\mathrm{CL} \\cdot \\tau} $$\nThis relationship is general for any linear pharmacokinetic model, regardless of the number of compartments or the route of administration.\n\nWe are given the following values:\nDose, $D = 10\\,\\mathrm{mg}$\nBioavailability, $F = 0.74$\nSystemic clearance, $\\mathrm{CL} = 24\\,\\mathrm{L}\\,\\mathrm{h}^{-1}$\nDosing interval, $\\tau = 12\\,\\mathrm{h}$\n\nSubstituting these values into the derived expression:\n$$ C_{ss,\\mathrm{avg}} = \\frac{0.74 \\cdot 10\\,\\mathrm{mg}}{\\left(24\\,\\mathrm{L}\\,\\mathrm{h}^{-1}\\right) \\cdot \\left(12\\,\\mathrm{h}\\right)} = \\frac{7.4\\,\\mathrm{mg}}{288\\,\\mathrm{L}} \\approx 0.025694\\,\\mathrm{mg}\\,\\mathrm{L}^{-1} $$\nThe problem requires the answer in units of $\\mathrm{ng}\\,\\mathrm{mL}^{-1}$. We perform the unit conversion:\n$$ 1\\,\\mathrm{mg}\\,\\mathrm{L}^{-1} = \\frac{1 \\times 10^{6}\\,\\mathrm{ng}}{1 \\times 10^{3}\\,\\mathrm{mL}} = 1000\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1} $$\nTherefore:\n$$ C_{ss,\\mathrm{avg}} \\approx 0.025694\\,\\mathrm{mg}\\,\\mathrm{L}^{-1} \\times 1000\\,\\frac{\\mathrm{ng}\\,\\mathrm{mL}^{-1}}{\\mathrm{mg}\\,\\mathrm{L}^{-1}} \\approx 25.694\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1} $$\nRounding to three significant figures, we get $C_{ss,\\mathrm{avg}} = 25.7\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$.\n\nPart 2: Derivation and computation of the steady-state fluctuation, $C_{\\max}/C_{\\min}$.\n\nThe fluctuation is defined as the ratio of the peak ($C_{\\max}$) to trough ($C_{\\min}$) plasma concentrations at steady state over a single dosing interval. The problem specifies the use of the one-compartment first-order elimination model under the condition that the absorption rate constant is much greater than the elimination rate constant, $k_{a} \\gg k_{el}$.\n\nThis condition, $k_{a} \\gg k_{el}$, implies that the drug absorption process is very rapid compared to the elimination process. In such cases, the absorption phase is short, and the oral administration can be approximated as an intravenous (IV) bolus dose for the purposes of analyzing the concentration decay phase. After the peak concentration, $C_{\\max}$, is reached, the subsequent decline in plasma concentration over the remainder of the dosing interval is governed solely by first-order elimination.\nThe concentration $C(t)$ at a time $t$ after the peak is given by:\n$$ C(t) = C_{\\max} \\cdot \\exp(-k_{el} t) $$\nAt steady state, the trough concentration, $C_{\\min}$, is the concentration remaining just before the next dose is administered, which occurs at the end of the dosing interval, $\\tau$, after the peak. Thus, we can set $t = \\tau$ (approximating that $t_{\\max}$ is very close to $0$ and the decay phase lasts for nearly the full interval $\\tau$).\n$$ C_{\\min} = C_{\\max} \\cdot \\exp(-k_{el} \\tau) $$\nRearranging this equation to find the ratio $C_{\\max}/C_{\\min}$ gives the desired expression for the fluctuation:\n$$ \\frac{C_{\\max}}{C_{\\min}} = \\frac{1}{\\exp(-k_{el} \\tau)} = \\exp(k_{el} \\tau) $$\nTo compute the numerical value of this ratio, we first need to determine the elimination rate constant, $k_{el}$, from the given elimination half-life, $t_{1/2} = 3.0\\,\\mathrm{h}$. The relationship is:\n$$ k_{el} = \\frac{\\ln(2)}{t_{1/2}} $$\nSubstituting the value of $t_{1/2}$:\n$$ k_{el} = \\frac{\\ln(2)}{3.0\\,\\mathrm{h}} $$\nNow, we can compute the exponent $k_{el}\\tau$:\n$$ k_{el}\\tau = \\left(\\frac{\\ln(2)}{3.0\\,\\mathrm{h}}\\right) \\cdot (12\\,\\mathrm{h}) = 4\\ln(2) = \\ln(2^4) = \\ln(16) $$\nFinally, we calculate the fluctuation ratio:\n$$ \\frac{C_{\\max}}{C_{\\min}} = \\exp(k_{el}\\tau) = \\exp(\\ln(16)) = 16 $$\nRounding to three significant figures, the ratio is $16.0$.\nThe condition $k_{a} \\gg k_{el}$ is satisfied, as $k_a = 2.0\\,\\mathrm{h}^{-1}$ and $k_{el} = \\frac{\\ln(2)}{3.0} \\approx 0.231\\,\\mathrm{h}^{-1}$.", "answer": "$$\\boxed{\\begin{pmatrix} 25.7  16.0 \\end{pmatrix}}$$", "id": "4536912"}, {"introduction": "A patient's response to a drug is not determined in isolation; co-administered medications can significantly alter its pharmacokinetics. This practice explores a clinically vital scenario: a drug-drug interaction (DDI) where a potent inhibitor affects the metabolism of tofacitinib. You will apply the principles of competitive enzyme inhibition to quantify the change in drug clearance and determine the necessary dose adjustment, a core skill for ensuring patient safety in complex therapeutic regimens. [@problem_id:4536889]", "problem": "A Janus kinase (JAK) inhibitor, tofacitinib, is cleared by parallel pathways that include cytochrome P450 3A4 (CYP3A4) metabolism and non-CYP3A4 routes. Consider a patient at steady state on tofacitinib where the baseline apparent oral clearance is $CL$, and a fraction $f_{m}$ of $CL$ is mediated by CYP3A4, with the remaining fraction $(1 - f_{m})$ representing all other clearance routes unaffected by CYP3A4 inhibition. A strong CYP3A4 inhibitor is initiated. Its unbound hepatic inlet concentration is $I$ and its competitive inhibition constant against CYP3A4 is $K_{i}$. Assume linear pharmacokinetics, first-order elimination, and that oral bioavailability $F$ and the dosing interval are unchanged by the inhibitor. Also assume that the inhibitor does not affect non-CYP3A4 clearance or drug transport.\n\nGiven the following clinically plausible values for tofacitinib and the inhibitor:\n- Baseline apparent oral clearance $CL = 24\\ \\mathrm{L\\ h^{-1}}$,\n- CYP3A4 fraction metabolized $f_{m} = 0.53$,\n- Inhibitor unbound concentration at the enzyme site $I = 1.2\\ \\mu\\mathrm{M}$,\n- Competitive inhibition constant $K_{i} = 0.030\\ \\mu\\mathrm{M}$,\n\nuse first principles of competitive Michaelis–Menten inhibition and additive clearance across parallel pathways to derive an expression for the new total clearance $CL'$ after inhibitor coadministration in terms of $CL$, $f_{m}$, $I$, and $K_{i}$. Then compute the proportional dose reduction factor needed to maintain the same average steady-state concentration $C_{\\mathrm{ss,avg}}$ after inhibitor initiation, assuming the dosing interval is unchanged. Report the dose reduction factor as a unitless decimal rounded to four significant figures.", "solution": "The problem requires the derivation of an expression for the new apparent oral clearance ($CL'$) of tofacitinib in the presence of a competitive CYP3A4 inhibitor, followed by the calculation of a dose reduction factor. The solution is based on the principles of parallel clearance pathways and competitive enzyme inhibition.\n\nFirst, we validate the problem statement.\n\n**Step 1: Extract Givens**\n-   Baseline apparent oral clearance: $CL = 24\\ \\mathrm{L\\ h^{-1}}$\n-   Fraction of $CL$ mediated by CYP3A4: $f_{m} = 0.53$\n-   Inhibitor unbound concentration: $I = 1.2\\ \\mu\\mathrm{M}$\n-   Competitive inhibition constant: $K_{i} = 0.030\\ \\mu\\mathrm{M}$\n-   Assumptions: Linear pharmacokinetics, first-order elimination, unchanged oral bioavailability $F$, unchanged dosing interval $\\tau$, no effect of the inhibitor on non-CYP3A4 clearance or drug transport.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in established pharmacokinetic principles of drug-drug interactions, specifically the competitive inhibition of a major metabolic pathway (CYP3A4). The scenario is well-posed, with all necessary parameters and assumptions provided to arrive at a unique solution. The given numerical values are clinically plausible for a strong DDI involving tofacitinib. The problem is objective, formalizable, and contains no contradictions or ambiguities.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. We proceed with the solution.\n\n**Derivation of New Total Clearance ($CL'$)**\n\nThe baseline apparent oral clearance, $CL$, is composed of two parallel pathways: metabolism by CYP3A4 and all other clearance routes. Let $CL_{CYP3A4}$ be the clearance via CYP3A4 and $CL_{other}$ be the clearance via other routes. The total clearance is the sum of the clearances from these parallel pathways:\n$$CL = CL_{CYP3A4} + CL_{other}$$\nAccording to the problem statement, a fraction $f_m$ of the total clearance is due to CYP3A4. Therefore, we can express these component clearances in terms of $CL$ and $f_m$:\n$$CL_{CYP3A4} = f_m \\cdot CL$$\n$$CL_{other} = (1 - f_m) \\cdot CL$$\nThe problem states that a competitive inhibitor of CYP3A4 is administered. The inhibitor does not affect the non-CYP3A4 clearance routes, so the new clearance for this pathway, $CL'_{other}$, remains unchanged:\n$$CL'_{other} = CL_{other} = (1 - f_m) \\cdot CL$$\nFor a metabolic pathway that exhibits first-order kinetics (as implied by the assumption of linear pharmacokinetics, where substrate concentration is much lower than the Michaelis constant $K_m$), the clearance is given by the ratio of the maximum velocity $V_{max}$ to $K_m$. Competitive inhibition increases the apparent $K_m$ by a factor of $(1 + [I]/K_i)$, where $[I]$ is the inhibitor concentration at the enzyme and $K_i$ is the inhibition constant. The new clearance for the inhibited pathway, $CL'_{CYP3A4}$, is thus:\n$$CL'_{CYP3A4} = \\frac{CL_{CYP3A4}}{1 + \\frac{I}{K_i}}$$\nSubstituting the expression for $CL_{CYP3A4}$:\n$$CL'_{CYP3A4} = \\frac{f_m \\cdot CL}{1 + \\frac{I}{K_i}}$$\nThe new total apparent oral clearance, $CL'$, is the sum of the new component clearances:\n$$CL' = CL'_{CYP3A4} + CL'_{other}$$\nSubstituting the expressions for each component:\n$$CL' = \\frac{f_m \\cdot CL}{1 + \\frac{I}{K_i}} + (1 - f_m) \\cdot CL$$\nThis is the derived expression for the new total clearance $CL'$ in terms of the given parameters.\n\n**Derivation and Calculation of the Dose Reduction Factor**\n\nThe average steady-state drug concentration, $C_{\\mathrm{ss,avg}}$, is given by the relationship:\n$$C_{\\mathrm{ss,avg}} = \\frac{\\text{Dosing Rate}}{CL} = \\frac{D/\\tau}{CL}$$\nwhere $D$ is the dose and $\\tau$ is the dosing interval.\n\nLet the original dose be $D_{0}$ and the new dose required to maintain the same steady-state concentration be $D_{new}$. The original steady-state concentration is $C_{\\mathrm{ss,avg},0} = \\frac{D_0/\\tau}{CL}$. The new steady-state concentration is $C_{\\mathrm{ss,avg},new} = \\frac{D_{new}/\\tau}{CL'}$.\nThe problem requires that $C_{\\mathrm{ss,avg},new} = C_{\\mathrm{ss,avg},0}$. Since the dosing interval $\\tau$ remains unchanged:\n$$\\frac{D_{new}}{CL'} = \\frac{D_0}{CL}$$\nRearranging for the new dose gives:\n$$D_{new} = D_0 \\cdot \\frac{CL'}{CL}$$\nThe proportional dose reduction factor, which we will denote as $R_D$, is the ratio of the new dose to the original dose:\n$$R_D = \\frac{D_{new}}{D_0} = \\frac{CL'}{CL}$$\nSubstituting the derived expression for $CL'$:\n$$R_D = \\frac{1}{CL} \\left( \\frac{f_m \\cdot CL}{1 + \\frac{I}{K_i}} + (1 - f_m) \\cdot CL \\right)$$\nThe $CL$ term cancels out:\n$$R_D = \\frac{f_m}{1 + \\frac{I}{K_i}} + (1 - f_m)$$\nNow, we substitute the given numerical values into this expression for $R_D$:\n-   $f_{m} = 0.53$\n-   $I = 1.2\\ \\mu\\mathrm{M}$\n-   $K_{i} = 0.030\\ \\mu\\mathrm{M}$\n\nFirst, calculate the inhibition term ratio:\n$$\\frac{I}{K_i} = \\frac{1.2}{0.030} = 40$$\nNow, substitute this into the expression for $R_D$:\n$$R_D = \\frac{0.53}{1 + 40} + (1 - 0.53)$$\n$$R_D = \\frac{0.53}{41} + 0.47$$\n$$R_D \\approx 0.0129268... + 0.47$$\n$$R_D \\approx 0.4829268...$$\nThe problem asks for the result to be rounded to four significant figures.\n$$R_D \\approx 0.4829$$\n\nThis dose reduction factor of $0.4829$ means that the new dose should be approximately $48.29\\%$ of the original dose to maintain the same average steady-state concentration.", "answer": "$$\\boxed{0.4829}$$", "id": "4536889"}, {"introduction": "The ultimate goal of pharmacology is to connect drug exposure to clinical outcomes. This final practice bridges the gap between pharmacokinetics (PK) and pharmacodynamics (PD) by having you model an exposure-response relationship for the JAK inhibitor upadacitinib. You will work with the foundational sigmoidal $E_{max}$ model to analyze clinical data, estimating the key parameters $EC_{50}$ and $E_{max}$ that define a drug's potency and maximal effect, a central task in modern drug development. [@problem_id:4536862]", "problem": "A Janus kinase (JAK) inhibitor such as upadacitinib modulates inflammatory signaling in atopic dermatitis, where clinical response can be summarized by the Eczema Area and Severity Index (EASI). Let $C$ denote the average plasma concentration at steady state in $\\mathrm{ng/mL}$. Let the fractional improvement in EASI from baseline be $E(C)$, a unitless number in $[0,1]$. Begin from the following fundamental base:\n- Law of mass action for ligand–target binding and receptor occupancy.\n- The concept that pharmacodynamic effect is a transduction of occupancy into a bounded response with a maximal achievable effect.\n- Additivity of a non-drug baseline component and a drug-mediated component of effect.\n\nDerive, from first principles, a parametric function $E(C)$ that maps concentration $C$ to expected mean fractional improvement, using:\n- A baseline component $E_{0}$ (dimensionless), attributable to non-specific and placebo effects.\n- A maximal drug-mediated component $E_{\\max}$ (dimensionless), representing the asymptotic incremental effect beyond baseline at very high $C$.\n- A potency parameter $\\mathrm{EC}_{50}$ in $\\mathrm{ng/mL}$ that quantifies the concentration at which one-half of the maximal drug-mediated component is achieved under the model’s occupancy–effect assumptions.\n- A Hill (sigmoidicity) coefficient $n$ (dimensionless), reflecting cooperativity or net transduction steepness.\n\nUsing the derived function, construct an ordinary least squares estimator for $(\\mathrm{EC}_{50}, E_{\\max})$ given observed pairs $\\{(C_{i}, y_{i})\\}$ where $y_{i}$ are sample means of $E(C_{i})$. Enforce the constraints $E_{\\max} \\ge 0$ and $\\mathrm{EC}_{50}  0$. Do not estimate $E_{0}$ or $n$; they are known constants in each dataset.\n\nImplement a program that, for each dataset below, estimates $(\\mathrm{EC}_{50}, E_{\\max})$ by minimizing the sum of squared residuals between observations $y_{i}$ and the model prediction at $C_{i}$ using the derived function. Report $\\mathrm{EC}_{50}$ in $\\mathrm{ng/mL}$ and $E_{\\max}$ as a decimal fraction. The program must process a test suite of three datasets that probe different regimes of sigmoidicity and saturation.\n\nTest suite (each $C$ list is in $\\mathrm{ng/mL}$; each $y$ list is a unitless fractional improvement):\n- Dataset A (moderate sigmoidicity with $n=1$):\n  - Known: $E_{0} = 0.10$ (dimensionless), $n = 1.0$ (dimensionless).\n  - Concentrations: $C = [0.0, 10.0, 25.0, 50.0, 100.0]$.\n  - Observed means: $y = [0.10, 0.30, 0.45, 0.5666666667, 0.66]$.\n- Dataset B (steeper sigmoidicity with $n=2$):\n  - Known: $E_{0} = 0.15$ (dimensionless), $n = 2.0$ (dimensionless).\n  - Concentrations: $C = [0.0, 15.0, 30.0, 60.0, 120.0]$.\n  - Observed means: $y = [0.15, 0.28, 0.475, 0.67, 0.7617647058823529]$.\n- Dataset C (low maximal effect with strong saturation point included):\n  - Known: $E_{0} = 0.05$ (dimensionless), $n = 1.0$ (dimensionless).\n  - Concentrations: $C = [0.0, 5.0, 10.0, 20.0, 200.0]$.\n  - Observed means: $y = [0.05, 0.11666666666666667, 0.15, 0.18333333333333335, 0.24047619047619047]$.\n\nRequirements:\n- Use the function you derive from the fundamentals above for $E(C)$.\n- Estimate $(\\mathrm{EC}_{50}, E_{\\max})$ via nonlinear least squares with non-negativity/positivity constraints as specified.\n- Return results as a single line in the format: a list of three lists, one per dataset, each inner list containing $[\\mathrm{EC}_{50}, E_{\\max}]$.\n- Rounding and units: print $\\mathrm{EC}_{50}$ in $\\mathrm{ng/mL}$ rounded to two decimals, and $E_{\\max}$ as a decimal fraction rounded to four decimals.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $[[x_{1},y_{1}],[x_{2},y_{2}],[x_{3},y_{3}]]$, with no extra spaces or text.\n\nThe program must be self-contained and require no input. It should use deterministic optimization to produce the estimates for all datasets in the test suite.", "solution": "The problem requires the derivation of a parametric function for a pharmacodynamic response, followed by the implementation of a constrained nonlinear least squares parameter estimation procedure.\n\n### Part 1: Derivation of the Pharmacodynamic Model $E(C)$\n\nThe derivation proceeds from the three fundamental principles provided in the problem statement.\n\n**1. Additivity of Baseline and Drug-Mediated Effects**\nThe total observed clinical response, denoted as $E(C)$, is modeled as the sum of two components: a baseline effect $E_{0}$ that is independent of the drug concentration, and a drug-mediated effect $E_{drug}(C)$ that is dependent on the concentration $C$.\n$$E(C) = E_{0} + E_{drug}(C)$$\nHere, $E_{0}$ represents the response observed in the absence of the drug ($C=0$), such as placebo effects or natural disease course.\n\n**2. Relationship between Occupancy and Effect**\nThe law of mass action governs the binding of a drug (ligand, $L$) to its target (receptor, $R$). The fraction of receptors occupied by the drug, $\\Theta$, is a function of the drug concentration $C$. The pharmacodynamic effect is a transduction of this occupancy. The drug-mediated effect, $E_{drug}(C)$, is modeled as being proportional to a function of this occupancy, reaching a maximal incremental value $E_{\\max}$ when occupancy is total ($\\Theta=1$).\n\n**3. The Sigmoidal $E_{\\max}$ Model**\nThe problem stipulates the use of a Hill coefficient, $n$, which generalizes the simple 1:1 binding model to account for cooperativity or complex signal transduction pathways. This leads directly to the Hill equation, a standard sigmoidal model in pharmacology that relates concentration to effect. The drug-mediated effect is expressed as:\n$$E_{drug}(C) = E_{\\max} \\frac{C^n}{C^n + (\\mathrm{EC}_{50})^n}$$\nIn this formulation:\n- $E_{\\max}$ is the maximal drug-attributable effect, an incremental effect over the baseline $E_{0}$.\n- $\\mathrm{EC}_{50}$ is the concentration of the drug that produces $50\\%$ of the maximal drug-mediated effect, $E_{\\max}$.\n- $n$ is the Hill coefficient, which determines the steepness (sigmoidicity) of the concentration-response curve.\n\nCombining the additivity principle with the sigmoidal model for the drug effect yields the final parametric function for the total response $E(C)$:\n$$E(C) = E_{0} + E_{\\max} \\frac{C^n}{C^n + (\\mathrm{EC}_{50})^n}$$\nThis model is consistent with the provided definitions. At $C=0$, $E(0) = E_{0}$. As $C \\to \\infty$, $E(C) \\to E_{0} + E_{\\max}$. At $C=\\mathrm{EC}_{50}$, the drug-mediated portion of the effect is $E_{\\max} \\frac{(\\mathrm{EC}_{50})^n}{(\\mathrm{EC}_{50})^n + (\\mathrm{EC}_{50})^n} = \\frac{1}{2}E_{\\max}$, as required.\n\n### Part 2: Ordinary Least Squares (OLS) Estimation\n\nWe are tasked with estimating the parameters $\\theta = (\\mathrm{EC}_{50}, E_{\\max})$ from a set of observed data points $\\{(C_{i}, y_{i})\\}_{i=1}^{N}$, where $y_i$ is the observed mean response at concentration $C_i$. The parameters $E_{0}$ and $n$ are treated as known constants for each dataset.\n\nThe OLS method finds the parameter values that minimize the sum of the squared residuals (SSR). The residual $r_i$ for the $i$-th observation is the difference between the observed response $y_i$ and the response predicted by the model, $\\hat{y}_i = E(C_i; \\mathrm{EC}_{50}, E_{\\max})$.\n$$r_i = y_i - \\hat{y}_i = y_i - \\left( E_{0} + E_{\\max} \\frac{C_i^n}{(\\mathrm{EC}_{50})^n + C_i^n} \\right)$$\nThe SSR is the objective function to be minimized:\n$$\\mathrm{SSR}(\\mathrm{EC}_{50}, E_{\\max}) = \\sum_{i=1}^{N} r_i^2 = \\sum_{i=1}^{N} \\left( y_i - E_{0} - E_{\\max} \\frac{C_i^n}{(\\mathrm{EC}_{50})^n + C_i^n} \\right)^2$$\nThis minimization must be performed subject to the scientifically motivated constraints: $\\mathrm{EC}_{50}  0$ and $E_{\\max} \\ge 0$.\n\n### Part 3: Numerical Implementation Strategy\n\nThe minimization of the SSR is a nonlinear, constrained optimization problem. We will employ a numerical solver to find the optimal parameters $\\widehat{\\theta} = (\\widehat{\\mathrm{EC}}_{50}, \\widehat{E}_{\\max})$. The `scipy.optimize.minimize` function from the SciPy library is well-suited for this task.\n\nThe implementation will proceed as follows for each dataset:\n1.  Define an objective function that computes the SSR for a given set of parameters $(\\mathrm{EC}_{50}, E_{\\max})$, the concentration-response data $(C, y)$, and the known constants $(E_0, n)$.\n2.  Provide reasonable initial guesses for $\\mathrm{EC}_{50}$ and $E_{\\max}$.\n3.  Specify the parameter bounds: $(\\epsilon, \\infty)$ for $\\mathrm{EC}_{50}$ (where $\\epsilon$ is a small positive number to enforce strict positivity) and $[0, \\infty)$ for $E_{\\max}$.\n4.  Call `scipy.optimize.minimize` with the `L-BFGS-B` method, which is efficient for bound-constrained problems.\n5.  Extract the optimized parameters from the result.\n6.  Format the results according to the specified rounding rules ($\\mathrm{EC}_{50}$ to two decimal places, $E_{\\max}$ to four decimal places) and collect them for the final output. This process is repeated for all three datasets.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Derives a pharmacodynamic model, fits it to data using nonlinear least squares,\n    and reports the estimated parameters for three datasets.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"E0\": 0.10,\n            \"n\": 1.0,\n            \"C\": np.array([0.0, 10.0, 25.0, 50.0, 100.0]),\n            \"y\": np.array([0.10, 0.30, 0.45, 0.5666666667, 0.66]),\n            \"x0\": [30.0, 0.6]  # Initial guess for [EC50, Emax]\n        },\n        {\n            \"E0\": 0.15,\n            \"n\": 2.0,\n            \"C\": np.array([0.0, 15.0, 30.0, 60.0, 120.0]),\n            \"y\": np.array([0.15, 0.28, 0.475, 0.67, 0.7617647058823529]),\n            \"x0\": [40.0, 0.7]  # Initial guess for [EC50, Emax]\n        },\n        {\n            \"E0\": 0.05,\n            \"n\": 1.0,\n            \"C\": np.array([0.0, 5.0, 10.0, 20.0, 200.0]),\n            \"y\": np.array([0.05, 0.11666666666666667, 0.15, 0.18333333333333335, 0.24047619047619047]),\n            \"x0\": [15.0, 0.2]  # Initial guess for [EC50, Emax]\n        }\n    ]\n\n    def model_func(C_data, params, E0, n):\n        \"\"\"\n        Calculates the predicted effect E(C) using the sigmoidal Emax model.\n        E(C) = E0 + Emax * C^n / (EC50^n + C^n)\n        \"\"\"\n        EC50, Emax = params\n        \n        # Power terms\n        C_pow_n = np.power(C_data, n)\n        EC50_pow_n = np.power(EC50, n)\n        \n        # Calculate drug effect. Denominator is safe due to EC50 > 0 bound.\n        # For C=0, C_pow_n=0, so drug_effect is 0.\n        drug_effect = Emax * C_pow_n / (EC50_pow_n + C_pow_n)\n        \n        return E0 + drug_effect\n\n    def objective_func(params, C_data, y_data, E0, n):\n        \"\"\"\n        Objective function for OLS: calculates the sum of squared residuals (SSR).\n        \"\"\"\n        y_predicted = model_func(C_data, params, E0, n)\n        residuals = y_data - y_predicted\n        return np.sum(residuals**2)\n\n    results = []\n    for case in test_cases:\n        # Extract data for the current case\n        C_data = case[\"C\"]\n        y_data = case[\"y\"]\n        E0 = case[\"E0\"]\n        n = case[\"n\"]\n        initial_guess = case[\"x0\"]\n\n        # Define parameter bounds: EC50 > 0, Emax >= 0.\n        # Use a small positive number for the lower bound of EC50.\n        bounds = [(1e-9, None), (0, None)]\n\n        # Perform the constrained nonlinear optimization\n        opt_result = minimize(\n            fun=objective_func,\n            x0=initial_guess,\n            args=(C_data, y_data, E0, n),\n            method='L-BFGS-B',\n            bounds=bounds\n        )\n\n        # Extract optimal parameters\n        EC50_opt, Emax_opt = opt_result.x\n\n        # Format results as per problem specification and append\n        formatted_result = [\n            round(EC50_opt, 2),\n            round(Emax_opt, 4)\n        ]\n        results.append(formatted_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join([f'[{res[0]},{res[1]}]' for res in results])}]\")\n\nsolve()\n```", "id": "4536862"}]}