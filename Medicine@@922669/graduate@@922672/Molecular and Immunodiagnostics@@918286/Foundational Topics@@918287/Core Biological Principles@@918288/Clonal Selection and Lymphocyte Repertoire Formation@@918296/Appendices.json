{"hands_on_practices": [{"introduction": "The foundation of adaptive immunity lies in the vast diversity of lymphocyte receptors, which originates from the V(D)J recombination of gene segments. This first exercise provides hands-on practice in calculating the combinatorial diversity of the B cell receptor (BCR) repertoire, using real-world gene segment counts from the IMGT database [@problem_id:5101624]. By performing this calculation, you will gain a quantitative appreciation for how the immune system generates a massive number of potential antibodies from a limited set of genes.", "problem": "A clinical laboratory is designing a baseline molecular diversity model for the B cell receptor (BCR) repertoire to contextualize high-throughput repertoire sequencing outputs in molecular and immunodiagnostics. The model will include only combinatorial contributions from gene segment choice and will explicitly exclude any junctional diversity (for example, insertions and deletions at coding joints), somatic hypermutation, and selection. Start from the following fundamental base:\n\n- In immunoglobulin gene assembly by V(D)J recombination, each productive heavy chain rearrangement involves choosing one variable segment, one diversity segment, and one joining segment from the immunoglobulin heavy chain (IGH) locus, whereas each productive light chain rearrangement involves choosing one variable segment and one joining segment from a light chain locus (either immunoglobulin kappa light chain (IGK) or immunoglobulin lambda light chain (IGL)).\n- Combinatorial diversity is defined as the number of distinct receptor sequences generated solely by independent choices of gene segments across loci, with pseudogenes and nonfunctional open reading frames excluded from the counts.\n- A mature B cell expresses one heavy chain and one light chain, with the light chain being either kappa or lambda, not both.\n\nAssume independence of gene segment choice across loci (i.e., heavy chain choices are independent of light chain choices), and independence between the IGK and IGL pathways at the combinatorial counting level.\n\nThe International ImMunoGeneTics (IMGT) database curation for functional gene segments in the human genome provides the following counts per haploid locus:\n\n- For the immunoglobulin heavy chain (IGH): $N_{V}^{H} = 44$ functional $V$ segments, $N_{D}^{H} = 23$ functional $D$ segments, $N_{J}^{H} = 6$ functional $J$ segments.\n- For the immunoglobulin kappa light chain (IGK): $N_{V}^{K} = 34$ functional $V$ segments, $N_{J}^{K} = 5$ functional $J$ segments.\n- For the immunoglobulin lambda light chain (IGL): $N_{V}^{L} = 33$ functional $V$ segments, $N_{J}^{L} = 5$ functional $J$ segments.\n\nUsing only the principles stated above and standard combinatorial counting, derive the analytic expression for the heavy chain combinatorial diversity and extend it to obtain the total BCR combinatorial diversity that accounts for pairing with either kappa or lambda light chains. Then, evaluate the resulting total BCR combinatorial diversity numerically using the counts given.\n\nRound your final numerical result to three significant figures and express it in scientific notation as a dimensionless count.", "solution": "The problem asks for the derivation of the analytic expression for the total combinatorial diversity of the B cell receptor (BCR) repertoire and its numerical evaluation, based on provided counts of functional gene segments from the International ImMunoGeneTics (IMGT) database. The model is simplified to include only combinatorial diversity arising from the selection of V, D, and J gene segments, explicitly excluding other sources of diversity.\n\nThe fundamental principle for calculating combinatorial diversity in this context is the multiplication rule of counting. If a process can be broken down into a sequence of independent stages, the total number of outcomes is the product of the number of outcomes at each stage. Additionally, if an outcome can be achieved through one of several mutually exclusive pathways, the total number of outcomes is the sum of the outcomes for each pathway.\n\nFirst, we will derive the analytic expression for the combinatorial diversity of the heavy chain ($C_{H}$). A productive heavy chain rearrangement involves selecting one V segment, one D segment, and one J segment from the immunoglobulin heavy chain (IGH) locus. The problem states these choices are independent. The number of available functional segments are given as $N_{V}^{H}$, $N_{D}^{H}$, and $N_{J}^{H}$.\n\nApplying the multiplication rule, the heavy chain combinatorial diversity is:\n$$C_{H} = N_{V}^{H} \\times N_{D}^{H} \\times N_{J}^{H}$$\n\nNext, we derive the expression for the combinatorial diversity of the light chain ($C_{LC}$). A mature B cell expresses a light chain that is either a kappa ($\\kappa$) chain or a lambda ($\\lambda$) chain, but not both. These are mutually exclusive possibilities for the light chain. Therefore, the total light chain diversity is the sum of the diversities of the kappa and lambda chains.\n\nFor the kappa light chain, one V segment and one J segment are chosen from the immunoglobulin kappa (IGK) locus. The number of functional segments are $N_{V}^{K}$ and $N_{J}^{K}$. The diversity is:\n$$C_{K} = N_{V}^{K} \\times N_{J}^{K}$$\n\nFor the lambda light chain, one V segment and one J segment are chosen from the immunoglobulin lambda (IGL) locus. The number of functional segments are $N_{V}^{L}$ and $N_{J}^{L}$. The diversity is:\n$$C_{\\lambda} = N_{V}^{L} \\times N_{J}^{L}$$\n\nThe total light chain diversity is the sum of these two possibilities:\n$$C_{LC} = C_{K} + C_{\\lambda} = (N_{V}^{K} \\times N_{J}^{K}) + (N_{V}^{L} \\times N_{J}^{L})$$\n\nFinally, the total BCR combinatorial diversity ($C_{BCR}$) is determined by the pairing of one heavy chain with one light chain. The problem states that the choice of heavy chain is independent of the choice of light chain. Therefore, the total diversity is the product of the heavy chain diversity and the total light chain diversity.\n\nThe complete analytic expression for the total BCR combinatorial diversity is:\n$$C_{BCR} = C_{H} \\times C_{LC} = (N_{V}^{H} \\times N_{D}^{H} \\times N_{J}^{H}) \\times ((N_{V}^{K} \\times N_{J}^{K}) + (N_{V}^{L} \\times N_{J}^{L}))$$\n\nNow, we will evaluate this expression numerically using the provided data:\n- For IGH: $N_{V}^{H} = 44$, $N_{D}^{H} = 23$, $N_{J}^{H} = 6$.\n- For IGK: $N_{V}^{K} = 34$, $N_{J}^{K} = 5$.\n- For IGL: $N_{V}^{L} = 33$, $N_{J}^{L} = 5$.\n\nFirst, calculate the heavy chain diversity, $C_{H}$:\n$$C_{H} = 44 \\times 23 \\times 6 = 1012 \\times 6 = 6072$$\n\nNext, calculate the light chain diversities, $C_{K}$ and $C_{\\lambda}$:\n$$C_{K} = 34 \\times 5 = 170$$\n$$C_{\\lambda} = 33 \\times 5 = 165$$\n\nThe total light chain diversity, $C_{LC}$, is the sum:\n$$C_{LC} = 170 + 165 = 335$$\n\nFinally, calculate the total BCR diversity, $C_{BCR}$, by multiplying the heavy and total light chain diversities:\n$$C_{BCR} = C_{H} \\times C_{LC} = 6072 \\times 335 = 2034120$$\n\nThe problem requires this result to be rounded to three significant figures and expressed in scientific notation.\n$$2034120 \\approx 2.03 \\times 10^{6}$$\nThe fourth significant digit is $4$, so we round down.", "answer": "$$\\boxed{2.03 \\times 10^{6}}$$", "id": "5101624"}, {"introduction": "After T cells generate their initial receptors, they undergo a rigorous selection process in the thymus to ensure they are both functional and self-tolerant. This practice models thymic selection as a survival window based on binding affinity, quantified by the dissociation constant $K_d$ [@problem_id:5101667]. By deriving the survival fraction from a given affinity distribution, you will learn how biophysical principles and probability theory can be combined to understand population-level outcomes in lymphocyte development.", "problem": "Consider thymic selection within the adaptive immune system, where survival of developing T lymphocytes is governed by their T Cell Receptor (TCR) interactions with self peptide–Major Histocompatibility Complex (pMHC). The reversible binding reaction is $T + P \\rightleftharpoons C$, where $T$ denotes free TCR, $P$ denotes free pMHC, and $C$ denotes the TCR–pMHC complex. At equilibrium, the equilibrium dissociation constant is defined as $K_d = \\frac{[T][P]}{[C]}$, which serves as a physicochemical measure of binding affinity; smaller $K_d$ corresponds to higher affinity. In thymic selection, clones survive if their affinity is neither too high (risking autoimmunity) nor too low (failing positive selection). Model this by the survival window $0 < \\theta_1 < K_d < \\theta_2$, with $\\theta_1$ enforcing deletion for excessive affinity and $\\theta_2$ enforcing deletion for insufficient affinity.\n\nAssume the repertoire of $K_d$ values across nascent clones generated by Variable (V), Diversity (D), and Joining (J) gene segment recombination is well approximated by a log-normal distribution due to multiplicative molecular determinants of binding. Specifically, the probability density function of $K_d$ is\n$$\nf(K_d) = \\frac{1}{K_d \\,\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(\\ln K_d - \\mu)^{2}}{2\\sigma^{2}}\\right), \\quad K_d > 0,\n$$\nwith parameters $\\mu \\in \\mathbb{R}$ and $\\sigma > 0$, and $f(K_d)$ is normalized on $(0,\\infty)$.\n\nStarting from the equilibrium definition of $K_d$, the survival window logic above, and the given distribution, derive the survival fraction $S$ of clones predicted to pass thymic selection as a closed-form analytic expression in terms of $\\mu$, $\\sigma$, $\\theta_1$, and $\\theta_2$. You may express your final answer using the cumulative distribution function (CDF) of the standard normal distribution or the error function. Provide the final survival fraction $S$ as a single closed-form expression with no units. No numerical approximation or rounding is required.", "solution": "The survival fraction, $S$, is the probability that a nascent T-cell clone, whose $K_d$ is drawn from the distribution $f(K_d)$, satisfies the survival condition $\\theta_1 < K_d < \\theta_2$. This probability is obtained by integrating the probability density function $f(K_d)$ over the survival window.\n$$\nS = P(\\theta_1 < K_d < \\theta_2) = \\int_{\\theta_1}^{\\theta_2} f(K_d) \\, dK_d\n$$\nSubstituting the given expression for $f(K_d)$:\n$$\nS = \\int_{\\theta_1}^{\\theta_2} \\frac{1}{K_d \\,\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(\\ln K_d - \\mu)^{2}}{2\\sigma^{2}}\\right) \\, dK_d\n$$\nThis integral is most readily solved by a change of variables. The form of the PDF for $K_d$ is characteristic of a log-normal distribution. By definition, if a random variable $K_d$ follows a log-normal distribution with parameters $\\mu$ and $\\sigma$, then the new random variable $X = \\ln K_d$ follows a normal (Gaussian) distribution with mean $\\mu$ and standard deviation $\\sigma$.\n\nWe can transform the integration problem from the variable $K_d$ to the variable $X$. The condition $\\theta_1 < K_d < \\theta_2$ on $K_d$ is equivalent to the condition $\\ln \\theta_1 < \\ln K_d < \\ln \\theta_2$ on its logarithm, since the natural logarithm is a strictly increasing function. Thus, we seek the probability $P(\\ln \\theta_1 < X < \\ln \\theta_2)$. This probability is the integral of the normal PDF from $x = \\ln \\theta_1$ to $x = \\ln \\theta_2$.\n$$\nS = \\int_{\\ln \\theta_1}^{\\ln \\theta_2} \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(x - \\mu)^{2}}{2\\sigma^{2}}\\right) \\, dx\n$$\nThis integral represents the area under a normal distribution curve between two points. It is standard practice to evaluate this using the cumulative distribution function (CDF). We standardize the normal variable $X$ to a standard normal variable $Z \\sim N(0, 1)$ using the transformation $Z = \\frac{X - \\mu}{\\sigma}$.\n\nThe limits of integration for the new variable $Z$ are:\n-   Lower limit: $z_1 = \\frac{\\ln \\theta_1 - \\mu}{\\sigma}$\n-   Upper limit: $z_2 = \\frac{\\ln \\theta_2 - \\mu}{\\sigma}$\n\nThe survival fraction $S$ is then the probability $P(z_1 < Z < z_2)$, where $Z$ follows the standard normal distribution. This probability is expressed in terms of the CDF of the standard normal distribution, denoted by $\\Phi(z)$, which is defined as:\n$$\n\\Phi(z) = P(Z \\le z) = \\int_{-\\infty}^{z} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{t^2}{2}\\right) \\, dt\n$$\nThe probability over an interval is given by the difference in the CDF values at the endpoints of the interval:\n$$\nS = P(z_1 < Z < z_2) = P(Z \\le z_2) - P(Z \\le z_1) = \\Phi(z_2) - \\Phi(z_1)\n$$\nSubstituting the expressions for $z_1$ and $z_2$, we obtain the final closed-form expression for the survival fraction $S$:\n$$\nS = \\Phi\\left(\\frac{\\ln \\theta_2 - \\mu}{\\sigma}\\right) - \\Phi\\left(\\frac{\\ln \\theta_1 - \\mu}{\\sigma}\\right)\n$$\nThis expression gives the fraction of T-cell clones that are predicted to survive thymic selection, as a function of the distribution parameters $\\mu$ and $\\sigma$ and the selection thresholds $\\theta_1$ and $\\theta_2$. The solution can also be expressed using the error function, $\\text{erf}(x)$, via the relation $\\Phi(z) = \\frac{1}{2}\\left(1 + \\text{erf}\\left(\\frac{z}{\\sqrt{2}}\\right)\\right)$.", "answer": "$$\n\\boxed{\\Phi\\left(\\frac{\\ln \\theta_2 - \\mu}{\\sigma}\\right) - \\Phi\\left(\\frac{\\ln \\theta_1 - \\mu}{\\sigma}\\right)}\n$$", "id": "5101667"}, {"introduction": "In a clinical or research setting, we often analyze snapshots of the immune repertoire using high-throughput sequencing. This exercise introduces Shannon entropy, a powerful metric for quantifying the diversity of an observed repertoire [@problem_id:5102035]. You will calculate the entropy for a hypothetical T cell clonotype distribution and interpret its significance, learning how this measure helps distinguish between a healthy, polyclonal repertoire and a skewed, oligoclonal one that might indicate disease.", "problem": "A peripheral blood sample from a patient suspected of a dominant clonal T cell expansion is profiled by high-throughput Complementarity-Determining Region $3$ (CDR$3$) sequencing of the T cell receptor (TCR) $\\beta$ chain using Next-Generation Sequencing (NGS). After Polymerase Chain Reaction (PCR) amplification with unique molecular identifiers to correct amplification bias, the molecular counts are normalized to obtain a clone frequency distribution over the top $10$ detected clonotypes, denoted $\\{p_i\\}_{i=1}^{10}$. The frequencies are:\n$$\np_1 = 0.27,\\quad\np_2 = 0.14,\\quad\np_3 = 0.12,\\quad\np_4 = 0.10,\\quad\np_5 = 0.08,\\quad\np_6 = 0.07,\\quad\np_7 = 0.06,\\quad\np_8 = 0.06,\\quad\np_9 = 0.05,\\quad\np_{10} = 0.05.\n$$\nAssume the distribution $\\{p_i\\}$ is properly normalized so that $\\sum_{i=1}^{10} p_i = 1$. Using the information-theoretic diversity measure known as Shannon entropy, with the natural logarithm (base $e$), compute the entropy of this repertoire in units of natural information content (nats). Round your final numerical value to four significant figures. Then, based only on first principles that connect clonal selection and lymphocyte repertoire formation to information content, explain the diagnostic significance of the computed value with respect to oligoclonality versus polyclonality. Express the entropy in nats.", "solution": "The primary task is to compute the Shannon entropy of the given T-cell clonotype frequency distribution and interpret its diagnostic meaning.\n\n**Part 1: Calculation of Shannon Entropy**\n\nThe Shannon entropy, $H$, for a discrete probability distribution $\\{p_i\\}_{i=1}^{N}$ is defined by the formula:\n$$\nH = - \\sum_{i=1}^{N} p_i \\log_b(p_i)\n$$\nThe problem specifies the use of the natural logarithm, so the base $b$ is Euler's number, $e$, and the entropy will be expressed in units of nats (natural units of information). The formula is thus:\n$$\nH = - \\sum_{i=1}^{N} p_i \\ln(p_i)\n$$\nIn this problem, the number of clonotypes is $N=10$, and their frequencies $\\{p_i\\}$ are given. We compute the entropy by substituting these values into the formula.\n\nThe calculation is as follows:\n$$\nH = - \\sum_{i=1}^{10} p_i \\ln(p_i)\n$$\n$$\nH = - \\left[ 0.27\\ln(0.27) + 0.14\\ln(0.14) + 0.12\\ln(0.12) + 0.10\\ln(0.10) + 0.08\\ln(0.08) + 0.07\\ln(0.07) + 2(0.06\\ln(0.06)) + 2(0.05\\ln(0.05)) \\right]\n$$\nPerforming the numerical calculations for each term:\n- $0.27\\ln(0.27) \\approx -0.353519$\n- $0.14\\ln(0.14) \\approx -0.275256$\n- $0.12\\ln(0.12) \\approx -0.254432$\n- $0.10\\ln(0.10) \\approx -0.230259$\n- $0.08\\ln(0.08) \\approx -0.202058$\n- $0.07\\ln(0.07) \\approx -0.186148$\n- $2 \\times (0.06\\ln(0.06)) \\approx -0.337609$\n- $2 \\times (0.05\\ln(0.05)) \\approx -0.299573$\n\nSumming these values:\n$$\n\\sum_{i=1}^{10} p_i \\ln(p_i) \\approx -0.353519 - 0.275256 - 0.254432 - 0.230259 - 0.202058 - 0.186148 - 0.337609 - 0.299573 = -2.138854\n$$\nThe entropy $H$ is the negative of this sum:\n$$\nH \\approx -(-2.138854) = 2.138854 \\text{ nats}\n$$\nRounding to four significant figures, as requested:\n$$\nH \\approx 2.139 \\text{ nats}\n$$\n\n**Part 2: Diagnostic Significance**\n\nThe Shannon entropy, $H$, when applied to a lymphocyte repertoire, is a quantitative measure of its diversity. It reflects the uncertainty in predicting the identity of a randomly chosen T-cell clone from the population. The diagnostic significance of the value $H \\approx 2.139$ nats is understood by comparing it to the theoretical minimum and maximum values for a repertoire of $N=10$ clones.\n\n1.  **Maximum Entropy (Polyclonality):** The entropy is maximized when the distribution is uniform, i.e., all clones have the same frequency, $p_i = 1/N = 1/10 = 0.1$ for all $i$. This represents a perfectly polyclonal state, characteristic of a healthy and diverse immune repertoire. The maximum possible entropy, $H_{\\text{max}}$, is:\n    $$\n    H_{\\text{max}} = -\\sum_{i=1}^{10} \\frac{1}{10} \\ln\\left(\\frac{1}{10}\\right) = -10 \\left(\\frac{1}{10} \\ln(0.1)\\right) = -\\ln(0.1) = \\ln(10) \\approx 2.303 \\text{ nats}\n    $$\n    A high entropy value, close to $H_{\\text{max}}$, signifies high clonal diversity and evenness.\n\n2.  **Minimum Entropy (Monoclonality):** The entropy is minimized when one clone completely dominates the repertoire, i.e., $p_k=1$ for one clone $k$ and $p_i=0$ for all other clones $i \\neq k$. This represents an extreme monoclonal state. The minimum entropy, $H_{\\text{min}}$, is:\n    $$\n    H_{\\text{min}} = -(1 \\cdot \\ln(1) + \\sum_{i \\neq k} 0 \\cdot \\ln(0)) = 0 \\text{ nats}\n    $$\n    A low entropy value, close to $0$, signifies a collapse of diversity and the dominance of a single clone.\n\n**Interpretation:**\nThe calculated entropy for the patient's sample is $H \\approx 2.139$ nats. This value is significantly greater than $H_{\\text{min}} = 0$ but is noticeably less than the maximum possible entropy $H_{\\text{max}} \\approx 2.303$ nats.\n\nThis intermediate value is indicative of an **oligoclonal** repertoire. The term \"oligoclonal\" describes a state of diversity that is reduced from the highly polyclonal baseline, where a few clones (oligo-) have expanded to occupy a substantial fraction of the repertoire. The frequency distribution is skewed, as seen by the top clone having a frequency of $p_1=0.27$, which is $2.7$ times higher than the frequency in a perfectly uniform distribution.\n\nFrom a diagnostic perspective, the entropy value of $2.139$ nats provides quantitative evidence to support the initial suspicion of a \"dominant clonal T cell expansion\". A healthy, unperturbed repertoire would exhibit a higher entropy, closer to $\\ln(10)$. The observed reduction in entropy reflects a loss of diversity due to the proliferative expansion of one or more T-cell clones. This can be caused by a persistent infection driving an antigen-specific response, an autoimmune process, or a lymphoproliferative disorder such as T-cell lymphoma or leukemia. Therefore, the calculated entropy serves as a crucial quantitative biomarker for the degree of clonal skewing in the T-cell population, helping to characterize the immune state and guide further diagnostic investigation.", "answer": "$$\n\\boxed{2.139}\n$$", "id": "5102035"}]}