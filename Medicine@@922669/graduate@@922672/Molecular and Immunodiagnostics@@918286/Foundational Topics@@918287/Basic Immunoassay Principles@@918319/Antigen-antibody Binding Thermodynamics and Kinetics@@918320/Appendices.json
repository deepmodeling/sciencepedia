{"hands_on_practices": [{"introduction": "This practice focuses on the heart of binding thermodynamics: calculating the equilibrium state of a simple bimolecular interaction. It demonstrates how to derive the exact concentration of the antigen-antibody complex from first principles—the law of mass action and conservation of mass. Mastering this calculation [@problem_id:5092704] is fundamental, as it provides the quantitative foundation for understanding binding saturation and interpreting data from virtually any equilibrium-based immunoassay.", "problem": "In a homogeneous immunodiagnostic binding assay at constant temperature, consider a single-site reversible interaction between an antibody species and an antigen species obeying the law of mass action. Let the antibody be denoted by $A$, the antigen by $G$, and the $1{:}1$ complex by $AG$. The dissociation constant is defined by $K_d=\\frac{[A][G]}{[AG]}$, where $[\\,\\cdot\\,]$ denotes molar concentration at equilibrium. The total concentrations are conserved: $A_t=[A]+[AG]$ and $G_t=[G]+[AG]$. Assume no cooperativity, no multivalency, no self-association, and that the system is closed with no depletion or production other than binding.\n\nStarting from these fundamental definitions and the conservation relations, derive the exact equilibrium expression for the complex concentration $[AG]$ without introducing approximations, and use it to compute the equilibrium fraction of antigen bound, defined as $f=\\frac{[AG]}{G_t}$, for the following parameter values: $A_t=10\\,\\mathrm{nM}$, $G_t=20\\,\\mathrm{nM}$, and $K_d=2\\,\\mathrm{nM}$. Round your numerical result for $f$ to four significant figures and express it as a unitless decimal. In addition, use first-principles reasoning from the derived expression to briefly interpret whether the binding outcome is primarily stoichiometry-limited or affinity-limited under these conditions. Your final reported answer must be only the numerical value of $f$ rounded to four significant figures.", "solution": "The system is a reversible bimolecular binding reaction $A+G \\rightleftharpoons AG$ characterized by the dissociation constant $K_d=\\frac{[A][G]}{[AG]}$. The fundamental base is the law of mass action and the conservation of total species. Let $x=[AG]$ denote the equilibrium complex concentration. Then conservation implies\n$$\n[A]=A_t-x,\\quad [G]=G_t-x.\n$$\nSubstitute into the definition of the dissociation constant:\n$$\nK_d=\\frac{(A_t-x)(G_t-x)}{x}.\n$$\nMultiply both sides by $x$ to obtain a polynomial equation in $x$:\n$$\nK_d\\,x=(A_t-x)(G_t-x)=A_tG_t-x(A_t+G_t)+x^2.\n$$\nRearrange terms to write a quadratic equation:\n$$\nx^2 - x\\left(A_t+G_t+K_d\\right) + A_tG_t = 0.\n$$\nThis quadratic in $x$ has two roots given by the quadratic formula. The physically relevant root must satisfy $0\\leq x \\leq \\min\\{A_t,G_t\\}$ and be nonnegative. The two solutions are\n$$\nx=\\frac{\\left(A_t+G_t+K_d\\right)\\pm\\sqrt{\\left(A_t+G_t+K_d\\right)^2-4A_tG_t}}{2}.\n$$\nThe larger root exceeds $\\min\\{A_t,G_t\\}$ and is not physically admissible. Therefore the admissible equilibrium complex concentration is\n$$\nx=\\frac{\\left(A_t+G_t+K_d\\right)-\\sqrt{\\left(A_t+G_t+K_d\\right)^2-4A_tG_t}}{2}.\n$$\nThe equilibrium fraction of antigen bound is\n$$\nf=\\frac{x}{G_t}=\\frac{1}{G_t}\\cdot\\frac{\\left(A_t+G_t+K_d\\right)-\\sqrt{\\left(A_t+G_t+K_d\\right)^2-4A_tG_t}}{2}.\n$$\n\nWe now substitute the given numerical values $A_t=10\\,\\mathrm{nM}$, $G_t=20\\,\\mathrm{nM}$, and $K_d=2\\,\\mathrm{nM}$ into the expression for $x$. First compute the sum\n$$\nS=A_t+G_t+K_d=10\\,\\mathrm{nM}+20\\,\\mathrm{nM}+2\\,\\mathrm{nM}=32\\,\\mathrm{nM}.\n$$\nNext compute the discriminant\n$$\n\\Delta=S^2-4A_tG_t=(32\\,\\mathrm{nM})^2-4\\cdot(10\\,\\mathrm{nM})\\cdot(20\\,\\mathrm{nM})=1024\\,\\mathrm{nM}^2-800\\,\\mathrm{nM}^2=224\\,\\mathrm{nM}^2.\n$$\nThen\n$$\n\\sqrt{\\Delta}=\\sqrt{224}\\,\\mathrm{nM}=4\\sqrt{14}\\,\\mathrm{nM}.\n$$\nThus\n$$\nx=\\frac{32\\,\\mathrm{nM}-\\sqrt{224}\\,\\mathrm{nM}}{2}=\\frac{32-\\sqrt{224}}{2}\\,\\mathrm{nM}.\n$$\nNumerically, $\\sqrt{224}\\approx 14.966629547$, giving\n$$\nx\\approx \\frac{32-14.966629547}{2}\\,\\mathrm{nM}\\approx \\frac{17.033370453}{2}\\,\\mathrm{nM}\\approx 8.516685226\\,\\mathrm{nM}.\n$$\nTherefore,\n$$\nf=\\frac{x}{G_t}\\approx \\frac{8.516685226\\,\\mathrm{nM}}{20\\,\\mathrm{nM}}\\approx 0.4258342613.\n$$\nRounded to four significant figures, the equilibrium fraction of antigen bound is\n$$\nf\\approx 0.4258.\n$$\n\nInterpretation of the saturation regime from first principles: The stoichiometric upper bound on $x$ is $\\min\\{A_t,G_t\\}=A_t=10\\,\\mathrm{nM}$, which would correspond to $f_{\\max}=\\frac{A_t}{G_t}=\\frac{10}{20}=0.5$ in the limit of infinitely strong binding (effectively $K_d\\to 0$). Here, $K_d=2\\,\\mathrm{nM}$ is smaller than both $A_t$ and $G_t$, so the system is in a high-affinity regime where binding approaches the stoichiometric limit. The observed $f\\approx 0.4258$ is close to, but below, $0.5$, indicating that the binding is primarily limited by the available antibody (stoichiometry) with a modest reduction due to finite affinity. Thus, the system is near the stoichiometric saturation regime rather than being affinity-limited.", "answer": "$$\\boxed{0.4258}$$", "id": "5092704"}, {"introduction": "Moving from the static picture of equilibrium, we now explore the dynamics of binding by examining the association rate. This exercise challenges you to calculate the theoretical maximum speed at which an antigen and antibody can associate, known as the diffusion-limited rate constant, $k_{\\text{on}}$. By applying Smoluchowski's theory to a model of diffusing spheres [@problem_id:5092682], you will gain insight into the physical constraints governing reaction speed and establish a crucial benchmark for evaluating experimentally measured kinetic data.", "problem": "An immunodiagnostic assay is performed in a homogeneous aqueous buffer where a monoclonal antibody and its monovalent antigen freely diffuse and bind without energetic barriers once they come within a short-range encounter distance. Treat both the antibody and antigen as hard spheres in three dimensions, undergoing independent Brownian motion. The translational diffusion coefficients are $D_{\\mathrm{Ab}}=60\\,\\mathrm{\\mu m^2/s}$ for the antibody and $D_{\\mathrm{Ag}}=100\\,\\mathrm{\\mu m^2/s}$ for the antigen, and the encounter radius is $R=4\\,\\mathrm{nm}$. Avogadro’s constant is $N_A=6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$.\n\nStarting from steady-state diffusion to a perfectly absorbing spherical boundary and the definition of flux from Fick’s laws, derive the diffusion-limited bimolecular association rate constant $k_{\\mathrm{on,DL}}$ for the antigen–antibody reaction, explicitly expressing the result in molar units $\\mathrm{M^{-1}s^{-1}}$ by converting from the given microscopic units. Clearly justify the use of the relative diffusion coefficient for two diffusing reactants. Compute the numerical value of $k_{\\mathrm{on,DL}}$ using the parameters provided. Round your final answer to three significant figures and express it in $\\mathrm{M^{-1}s^{-1}}$.", "solution": "### Derivation and Solution\n\nThe problem asks for the derivation of the diffusion-limited bimolecular association rate constant, $k_{\\mathrm{on,DL}}$, which describes the rate at which two diffusing species, an antibody (Ab) and an antigen (Ag), encounter each other and bind.\n\nFirst, we simplify the two-body diffusion problem into a one-body problem. The encounter of two independently diffusing particles is mathematically equivalent to the diffusion of a single particle with a relative diffusion coefficient, $D_{\\mathrm{rel}}$, towards a stationary target. The positions of the antibody and antigen are $\\vec{r}_{\\mathrm{Ab}}(t)$ and $\\vec{r}_{\\mathrm{Ag}}(t)$, respectively. Their relative position is $\\vec{r}_{\\mathrm{rel}}(t) = \\vec{r}_{\\mathrm{Ag}}(t) - \\vec{r}_{\\mathrm{Ab}}(t)$. Since their Brownian motions are uncorrelated, the mean squared displacement of the relative position adds: $\\langle |\\Delta\\vec{r}_{\\mathrm{rel}}|^2 \\rangle = \\langle |\\Delta\\vec{r}_{\\mathrm{Ag}}|^2 \\rangle + \\langle |\\Delta\\vec{r}_{\\mathrm{Ab}}|^2 \\rangle$. In three dimensions, the mean squared displacement is related to the diffusion coefficient by $\\langle |\\Delta\\vec{r}|^2 \\rangle = 6 D \\Delta t$. Thus, $6 D_{\\mathrm{rel}} \\Delta t = 6 D_{\\mathrm{Ag}} \\Delta t + 6 D_{\\mathrm{Ab}} \\Delta t$, which simplifies to:\n$$D_{\\mathrm{rel}} = D_{\\mathrm{Ab}} + D_{\\mathrm{Ag}}$$\nThis justifies using a model where antigen particles with diffusion coefficient $D_{\\mathrm{rel}}$ diffuse towards a stationary antibody target. The binding is assumed to be instantaneous upon reaching an encounter distance $R$, making the target a \"perfectly absorbing sphere\" of radius $R$.\n\nWe seek the steady-state flux of antigen molecules onto this spherical target. The concentration of antigen, $C(r)$, as a function of the distance $r$ from the center of the antibody, is governed by Fick's laws. In steady-state, the divergence of the flux density $\\vec{J}$ is zero: $\\nabla \\cdot \\vec{J} = 0$. Using Fick's first law, $\\vec{J} = -D_{\\mathrm{rel}} \\nabla C$, this becomes the Laplace equation for the concentration:\n$$\\nabla^2 C(r) = 0$$\nDue to the spherical symmetry of the problem, we use the Laplacian in spherical coordinates, assuming concentration only varies with radius $r$:\n$$\\frac{1}{r^2} \\frac{d}{dr} \\left( r^2 \\frac{dC}{dr} \\right) = 0$$\nIntegrating this equation twice with respect to $r$ yields the general solution:\n$$C(r) = A_1 - \\frac{A_2}{r}$$\nwhere $A_1$ and $A_2$ are integration constants determined by the boundary conditions.\nThe boundary conditions are:\n1.  Far from the target ($r \\to \\infty$), the concentration is the bulk antigen concentration, $C_0$: $C(r \\to \\infty) = C_0$.\n2.  At the surface of the absorbing sphere ($r=R$), the concentration is zero due to immediate binding: $C(R) = 0$.\n\nApplying the first boundary condition: $C_0 = A_1 - \\frac{A_2}{\\infty}$, which gives $A_1 = C_0$.\nApplying the second boundary condition: $0 = C_0 - \\frac{A_2}{R}$, which gives $A_2 = C_0 R$.\nSubstituting the constants back, the steady-state concentration profile is:\n$$C(r) = C_0 \\left( 1 - \\frac{R}{r} \\right)$$\nThe total flux, or rate of reaction, $\\Phi$, for a single antibody molecule is the integral of the flux density vector over the surface of the sphere of radius $R$. The magnitude of the flux density at radius $r$ is $J(r) = |\\vec{J}(r)| = |-D_{\\mathrm{rel}} \\frac{dC}{dr}|$.\nThe gradient is $\\frac{dC}{dr} = \\frac{C_0 R}{r^2}$.\nAt the surface $r=R$, the gradient is $\\left. \\frac{dC}{dr} \\right|_{r=R} = \\frac{C_0}{R}$.\nThe flux magnitude at the surface is $J(R) = D_{\\mathrm{rel}} \\frac{C_0}{R}$.\nThe total flux (particles per second) into the sphere is this magnitude multiplied by the surface area of the sphere, $A_{sphere} = 4\\pi R^2$:\n$$\\Phi = J(R) \\times A_{sphere} = \\left( D_{\\mathrm{rel}} \\frac{C_0}{R} \\right) (4\\pi R^2) = 4\\pi D_{\\mathrm{rel}} R C_0$$\nThis flux $\\Phi$ represents the rate of reaction for one antibody molecule, which can be expressed as $\\Phi = k_{\\text{micro}} C_0$, where $k_{\\text{micro}}$ is the microscopic second-order rate constant. By comparison, we find:\n$$k_{\\text{micro}} = 4\\pi D_{\\mathrm{rel}} R$$\nThis constant has units of volume per time (e.g., $\\mathrm{m^3/s}$), representing the volume swept out by the diffusing particle per unit time. To obtain the molar association rate constant $k_{\\mathrm{on,DL}}$ in the standard units of $\\mathrm{M^{-1}s^{-1}}$ (which is equivalent to $\\mathrm{L \\cdot mol^{-1} \\cdot s^{-1}}$), we must convert from the particle-based microscopic scale to the molar macroscopic scale. The molar rate constant $k_{\\mathrm{on,DL}}$ is related to the microscopic rate constant $k_{\\text{micro}}$ by:\n$$k_{\\mathrm{on,DL}} = k_{\\text{micro}} \\times N_A \\times (\\text{conversion factor from m}^3 \\text{ to L})$$\nSince $1 \\, \\mathrm{m^3} = 1000 \\, \\mathrm{L}$, the conversion factor is $1000$.\nTherefore, the final expression for the diffusion-limited association rate constant is:\n$$k_{\\mathrm{on,DL}} = 4\\pi D_{\\mathrm{rel}} R N_A \\times 1000$$\nFor this formula to yield units of $\\mathrm{M^{-1}s^{-1}}$, the inputs must be in SI base units: $D_{\\mathrm{rel}}$ in $\\mathrm{m^2/s}$ and $R$ in $\\mathrm{m}$.\n\nNow, we compute the numerical value.\nFirst, convert the given parameters to SI units.\n$D_{\\mathrm{Ab}} = 60\\,\\mathrm{\\mu m^2/s} = 60 \\times (10^{-6}\\,\\mathrm{m})^2/\\mathrm{s} = 60 \\times 10^{-12}\\,\\mathrm{m^2/s}$.\n$D_{\\mathrm{Ag}} = 100\\,\\mathrm{\\mu m^2/s} = 100 \\times 10^{-12}\\,\\mathrm{m^2/s}$.\n$R = 4\\,\\mathrm{nm} = 4 \\times 10^{-9}\\,\\mathrm{m}$.\n\nCalculate the relative diffusion coefficient:\n$$D_{\\mathrm{rel}} = D_{\\mathrm{Ab}} + D_{\\mathrm{Ag}} = (60 \\times 10^{-12} + 100 \\times 10^{-12})\\,\\mathrm{m^2/s} = 160 \\times 10^{-12}\\,\\mathrm{m^2/s} = 1.6 \\times 10^{-10}\\,\\mathrm{m^2/s}$$\nSubstitute the values into the derived equation for $k_{\\mathrm{on,DL}}$:\n$$k_{\\mathrm{on,DL}} = 4\\pi (1.6 \\times 10^{-10}\\,\\mathrm{m^2/s}) (4 \\times 10^{-9}\\,\\mathrm{m}) (6.02214076 \\times 10^{23}\\,\\mathrm{mol^{-1}}) (1000\\,\\mathrm{L/m^3})$$\n$$k_{\\mathrm{on,DL}} = 4\\pi (1.6)(4)(6.02214076) \\times 10^{-10} \\times 10^{-9} \\times 10^{23} \\times 10^3 \\, \\mathrm{L \\cdot mol^{-1} \\cdot s^{-1}}$$\n$$k_{\\mathrm{on,DL}} = 25.6\\pi (6.02214076) \\times 10^{(-10-9+23+3)} \\, \\mathrm{M^{-1}s^{-1}}$$\n$$k_{\\mathrm{on,DL}} = 25.6\\pi (6.02214076) \\times 10^{7} \\, \\mathrm{M^{-1}s^{-1}}$$\n$$k_{\\mathrm{on,DL}} \\approx (80.42477) (6.02214076) \\times 10^{7} \\, \\mathrm{M^{-1}s^{-1}}$$\n$$k_{\\mathrm{on,DL}} \\approx 484.349 \\times 10^{7} \\, \\mathrm{M^{-1}s^{-1}}$$\n$$k_{\\mathrm{on,DL}} \\approx 4.84349 \\times 10^{9} \\, \\mathrm{M^{-1}s^{-1}}$$\nRounding the result to three significant figures as requested:\n$$k_{\\mathrm{on,DL}} = 4.84 \\times 10^9 \\, \\mathrm{M^{-1}s^{-1}}$$", "answer": "$$\\boxed{4.84 \\times 10^9}$$", "id": "5092682"}, {"introduction": "This final practice synthesizes our understanding of equilibrium and thermodynamics into a powerful computational exercise: simulating an Isothermal Titration Calorimetry (ITC) experiment. You will implement a first-principles model that tracks mass balance and re-calculates binding equilibrium after each simulated injection, ultimately generating a complete titration curve [@problem_id:5092675]. This hands-on simulation provides a deep, practical understanding of how macroscopic heat signals measured in an ITC experiment are directly linked to the underlying molecular parameters of binding affinity ($K_d$) and enthalpy ($\\Delta H$).", "problem": "You are to implement a simulation of Isothermal Titration Calorimetry (ITC) for a single-site antigen–antibody binding interaction using first principles of equilibrium thermodynamics and mass balance. The binding reaction is modeled as a reversible association between antigen and antibody, $A + B \\rightleftharpoons AB$, characterized by the equilibrium dissociation constant $K_d$ defined by the law of mass action as $K_d = \\dfrac{[A][B]}{[AB]}$. The integrated heat released or absorbed per injection is determined by the enthalpy change per mole $\\Delta H$ for complex formation and the change in the number of moles of complex in the cell.\n\nAssume the following physically realistic and testable scenario for each injection:\n- The cell volume is constant and equal to $V_0$.\n- The syringe delivers an injection of volume $v_i$ containing antigen at concentration $C_s$.\n- The cell initially contains antibody at concentration $C_M$ and no antigen.\n- Upon each injection, a volume fraction $f_i = \\dfrac{v_i}{V_0}$ of the cell content is displaced to maintain constant volume; the displaced fluid has the composition of the pre-injection mixture.\n- After mixing and reaching equilibrium, binding follows the law of mass action and conservation of mass.\n\nLet $M^{(i)}$ and $L^{(i)}$ denote the total moles of antibody and antigen in the cell after the $i$-th injection, respectively, with initial conditions $M^{(0)} = C_M V_0$ and $L^{(0)} = 0$. The mass balance update on the $i$-th injection is:\n- $M^{(i)} = (1 - f_i) M^{(i-1)}$,\n- $L^{(i)} = (1 - f_i) L^{(i-1)} + v_i C_s$.\n\nDefine total concentrations after injection $i$ as $T_M^{(i)} = \\dfrac{M^{(i)}}{V_0}$ and $T_L^{(i)} = \\dfrac{L^{(i)}}{V_0}$. Let $x^{(i)}$ be the equilibrium concentration of complex $[AB]$ after the $i$-th injection. At equilibrium, $[A] = T_M^{(i)} - x^{(i)}$ and $[B] = T_L^{(i)} - x^{(i)}$ must satisfy the law of mass action $K_d = \\dfrac{[A][B]}{x^{(i)}}$. The integrated heat of the $i$-th injection is the enthalpy change per mole multiplied by the net change in moles of complex in the cell across the injection and equilibration step, given by $q_i = \\Delta H \\, V_0 \\left( x^{(i)} - (1 - f_i) x^{(i-1)} \\right)$, where $x^{(0)} = 0$.\n\nYour task is to:\n- Implement a program that, for each injection, updates $M^{(i)}$ and $L^{(i)}$ via conservation, computes $T_M^{(i)}$ and $T_L^{(i)}$, solves for $x^{(i)}$ from the law of mass action and mass balances without using any shortcut formula stated in the problem statement, and computes $q_i$ in Joules using the enthalpy $\\Delta H$ expressed in $\\text{J} \\cdot \\text{mol}^{-1}$.\n- Simulate the titration curve as the list of $q_i$ values for the specified injections.\n\nExpress all integrated heats $q_i$ in $\\text{J}$, rounded to six decimal places.\n\nTest Suite:\nCompute the titration curves for the following four parameter sets. In each case, use the specified $V_0$ (in $\\text{L}$), $C_M$ (in $\\text{mol} \\cdot \\text{L}^{-1}$), $C_s$ (in $\\text{mol} \\cdot \\text{L}^{-1}$), $K_d$ (in $\\text{mol} \\cdot \\text{L}^{-1}$), $\\Delta H$ (in $\\text{J} \\cdot \\text{mol}^{-1}$), and injection volumes $v_i$ (in $\\text{L}$):\n\n- Case $1$ (general case):\n  - $V_0 = 1.4 \\times 10^{-3}$,\n  - $C_M = 1.2 \\times 10^{-5}$,\n  - $C_s = 2.5 \\times 10^{-4}$,\n  - $K_d = 5.0 \\times 10^{-7}$,\n  - $\\Delta H = -3.5 \\times 10^{4}$,\n  - $10$ injections, each with $v_i = 2.0 \\times 10^{-6}$.\n\n- Case $2$ (tight binding edge):\n  - $V_0 = 1.5 \\times 10^{-3}$,\n  - $C_M = 1.0 \\times 10^{-5}$,\n  - $C_s = 1.0 \\times 10^{-4}$,\n  - $K_d = 1.0 \\times 10^{-9}$,\n  - $\\Delta H = -5.0 \\times 10^{4}$,\n  - $10$ injections, each with $v_i = 2.0 \\times 10^{-6}$.\n\n- Case $3$ (weak binding edge):\n  - $V_0 = 1.4 \\times 10^{-3}$,\n  - $C_M = 1.0 \\times 10^{-5}$,\n  - $C_s = 2.0 \\times 10^{-4}$,\n  - $K_d = 1.0 \\times 10^{-4}$,\n  - $\\Delta H = -2.0 \\times 10^{4}$,\n  - $10$ injections, each with $v_i = 3.0 \\times 10^{-6}$.\n\n- Case $4$ (zero enthalpy boundary and variable injections):\n  - $V_0 = 1.4 \\times 10^{-3}$,\n  - $C_M = 8.0 \\times 10^{-6}$,\n  - $C_s = 1.5 \\times 10^{-4}$,\n  - $K_d = 1.0 \\times 10^{-6}$,\n  - $\\Delta H = 0$,\n  - $10$ injections with $v_i$ sequence $\\left[0, 2.0 \\times 10^{-6}, 2.0 \\times 10^{-6}, 2.0 \\times 10^{-6}, 3.0 \\times 10^{-6}, 3.0 \\times 10^{-6}, 4.0 \\times 10^{-6}, 4.0 \\times 10^{-6}, 5.0 \\times 10^{-6}, 5.0 \\times 10^{-6}\\right]$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each entry of this top-level list must be the titration curve for one case, represented as a list of floats in $\\text{J}$ rounded to six decimal places, ordered as Case $1$, Case $2$, Case $3$, Case $4$. For example, it must have the syntactic form of a list of lists with numeric entries, and it must be printed on a single line only.", "solution": "The problem requires the implementation of a first-principles simulation of an Isothermal Titration Calorimetry (ITC) experiment for a single-site binding model. The simulation must calculate the heat released or absorbed ($q_i$) for each of a series of injections. The problem is scientifically sound, well-posed, and provides all necessary information and parameters to construct a unique, verifiable solution.\n\nThe simulation proceeds iteratively, with each step corresponding to one injection from the syringe into the sample cell. For each injection $i$, we must update the total amounts of antibody and antigen in the cell, solve for the new equilibrium state, and then calculate the associated heat change.\n\n**1. System Definition and Mass Balance**\n\nThe system consists of a sample cell of constant volume $V_0$ and a syringe. Initially, at step $i=0$, the cell contains antibody at concentration $C_M$ and no antigen. The initial number of moles of antibody (macromolecule, species $A$) is $M^{(0)} = C_M V_0$, and the initial moles of antigen (ligand, species $B$) is $L^{(0)} = 0$. The initial concentration of the antigen-antibody complex, $x^{(0)}$, is also $0$.\n\nFor each subsequent injection $i$, a volume $v_i$ of antigen solution at concentration $C_s$ is added to the cell. To maintain a constant volume $V_0$, an equal volume $v_i$ of the cell's content is displaced. The fraction of the cell volume displaced is $f_i = v_i / V_0$. The displaced fluid has the composition of the cell mixture from the end of the previous step, $(i-1)$.\n\nThe total moles of antibody, $M^{(i)}$, and antigen, $L^{(i)}$, in the cell after injection $i$ and displacement are updated according to the principles of mass conservation:\n- The moles of antibody are reduced by the fraction displaced:\n$$M^{(i)} = M^{(i-1)} (1 - f_i)$$\n- The moles of antigen are reduced by the fraction displaced and increased by the amount injected:\n$$L^{(i)} = L^{(i-1)} (1 - f_i) + v_i C_s$$\n\nAfter the injection and mixing, the total concentrations of antibody, $T_M^{(i)}$, and antigen, $T_L^{(i)}$, in the cell volume $V_0$ are:\n$$T_M^{(i)} = \\frac{M^{(i)}}{V_0}$$\n$$T_L^{(i)} = \\frac{L^{(i)}}{V_0}$$\n\n**2. Chemical Equilibrium**\n\nThe binding reaction is the reversible association $A + B \\rightleftharpoons AB$. At equilibrium, the concentrations of free antibody $[A]$, free antigen $[B]$, and complex $[AB]$ are related by the dissociation constant $K_d$:\n$$K_d = \\frac{[A] [B]}{[AB]}$$\n\nLet $x^{(i)}$ be the equilibrium concentration of the complex $[AB]$ after injection $i$. From the conservation of mass for each species within the cell volume $V_0$, the equilibrium concentrations of the free species are:\n$$[A] = T_M^{(i)} - x^{(i)}$$\n$$[B] = T_L^{(i)} - x^{(i)}$$\n\nSubstituting these into the expression for $K_d$ yields:\n$$K_d = \\frac{(T_M^{(i)} - x^{(i)})(T_L^{(i)} - x^{(i)})}{x^{(i)}}$$\n\nTo find the equilibrium concentration of the complex, $x^{(i)}$, we must solve this equation. Rearranging it into a standard quadratic form, $a(x^{(i)})^2 + b(x^{(i)}) + c = 0$:\n$$K_d x^{(i)} = T_M^{(i)} T_L^{(i)} - T_M^{(i)} x^{(i)} - T_L^{(i)} x^{(i)} + (x^{(i)})^2$$\n$$(x^{(i)})^2 - (T_M^{(i)} + T_L^{(i)} + K_d) x^{(i)} + T_M^{(i)} T_L^{(i)} = 0$$\n\nThe coefficients of the quadratic equation for $x^{(i)}$ are:\n- $a = 1$\n- $b = -(T_M^{(i)} + T_L^{(i)} + K_d)$\n- $c = T_M^{(i)} T_L^{(i)}$\n\nThe solution is given by the quadratic formula, $x^{(i)} = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$.\n$$x^{(i)} = \\frac{(T_M^{(i)} + T_L^{(i)} + K_d) \\pm \\sqrt{(T_M^{(i)} + T_L^{(i)} + K_d)^2 - 4 T_M^{(i)} T_L^{(i)}}}{2}$$\n\nA physically meaningful solution for a concentration must be real and positive. The discriminant, $(T_M^{(i)} + T_L^{(i)} + K_d)^2 - 4 T_M^{(i)} T_L^{(i)}$, is always positive, guaranteeing real roots. Furthermore, the concentration of the complex, $x^{(i)}$, cannot exceed the total concentration of either reactant, i.e., $0 \\le x^{(i)} \\le \\min(T_M^{(i)}, T_L^{(i)})$. The root with the plus sign would yield a value for $x^{(i)}$ that is larger than $T_M^{(i)} + T_L^{(i)}$, which is physically impossible. Therefore, the correct physical root is the one with the minus sign:\n$$x^{(i)} = \\frac{(T_M^{(i)} + T_L^{(i)} + K_d) - \\sqrt{(T_M^{(i)} + T_L^{(i)} + K_d)^2 - 4 T_M^{(i)} T_L^{(i)}}}{2}$$\n\n**3. Heat Calculation**\n\nThe integrated heat, $q_i$, associated with injection $i$ is the product of the molar enthalpy of binding, $\\Delta H$, and the total change in the number of moles of complex, $\\Delta N_{AB}^{(i)}$, within the cell.\nThe number of moles of complex at the end of step $i$ is $N_{AB}^{(i)} = x^{(i)} V_0$.\nThe number of moles of complex at the beginning of step $i$ (i.e., end of step $i-1$) was $N_{AB}^{(i-1)} = x^{(i-1)} V_0$. During the displacement phase of injection $i$, a volume $v_i$ containing complex at concentration $x^{(i-1)}$ is removed. The moles of complex remaining in the cell before re-equilibration is $x^{(i-1)} V_0 - x^{(i-1)} v_i = x^{(i-1)} V_0 (1 - v_i/V_0) = x^{(i-1)} V_0 (1-f_i)$.\nThe net change in moles of complex in the cell during step $i$ is the final amount minus this remaining amount:\n$$\\Delta N_{AB}^{(i)} = x^{(i)} V_0 - x^{(i-1)} V_0 (1 - f_i) = V_0 \\left( x^{(i)} - (1 - f_i) x^{(i-1)} \\right)$$\n\nThe heat for injection $i$ is therefore:\n$$q_i = \\Delta H \\cdot \\Delta N_{AB}^{(i)} = \\Delta H V_0 \\left( x^{(i)} - (1 - f_i) x^{(i-1)} \\right)$$\n\n**4. Simulation Algorithm**\n\nThe titration curve is simulated by applying the above steps iteratively for each injection.\n\n- **Initialization ($i = 0$):**\n  - $v_0 = 0$\n  - $M^{(0)} = C_M V_0$\n  - $L^{(0)} = 0$\n  - $x^{(0)} = 0$\n  - Initialize an empty list to store heat values, `q_list`.\n\n- **Iteration (for $i=1, 2, ..., N_{injections}$):**\n  1. Retrieve the injection volume $v_i$.\n  2. Calculate the displacement fraction: $f_i = v_i / V_0$.\n  3. Update total moles of antibody and antigen:\n     $M^{(i)} = M^{(i-1)} (1 - f_i)$\n     $L^{(i)} = L^{(i-1)} (1 - f_i) + v_i C_s$\n  4. Update total concentrations:\n     $T_M^{(i)} = M^{(i)} / V_0$\n     $T_L^{(i)} = L^{(i)} / V_0$\n  5. Calculate the new equilibrium complex concentration $x^{(i)}$ by solving the quadratic equation.\n  6. Calculate the heat for the current injection: $q_i = \\Delta H V_0 \\left( x^{(i)} - (1 - f_i) x^{(i-1)} \\right)$.\n  7. Append $q_i$ to `q_list`.\n  8. Update state for the next iteration: $M^{(i)}$ becomes the new $M^{(i-1)}$, $L^{(i)}$ becomes the new $L^{(i-1)}$, and $x^{(i)}$ becomes the new $x^{(i-1)}$.\n\nThis procedure is repeated for all injections in each specified test case to generate the required titration curves.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates Isothermal Titration Calorimetry (ITC) experiments for four\n    different parameter sets and prints the resulting titration curves.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case 1 (general case)\",\n            \"V0\": 1.4e-3,       # L\n            \"CM\": 1.2e-5,       # mol/L\n            \"Cs\": 2.5e-4,       # mol/L\n            \"Kd\": 5.0e-7,       # mol/L\n            \"delta_H\": -3.5e4,  # J/mol\n            \"vi_list\": [2.0e-6] * 10\n        },\n        {\n            \"name\": \"Case 2 (tight binding edge)\",\n            \"V0\": 1.5e-3,\n            \"CM\": 1.0e-5,\n            \"Cs\": 1.0e-4,\n            \"Kd\": 1.0e-9,\n            \"delta_H\": -5.0e4,\n            \"vi_list\": [2.0e-6] * 10\n        },\n        {\n            \"name\": \"Case 3 (weak binding edge)\",\n            \"V0\": 1.4e-3,\n            \"CM\": 1.0e-5,\n            \"Cs\": 2.0e-4,\n            \"Kd\": 1.0e-4,\n            \"delta_H\": -2.0e4,\n            \"vi_list\": [3.0e-6] * 10\n        },\n        {\n            \"name\": \"Case 4 (zero enthalpy boundary and variable injections)\",\n            \"V0\": 1.4e-3,\n            \"CM\": 8.0e-6,\n            \"Cs\": 1.5e-4,\n            \"Kd\": 1.0e-6,\n            \"delta_H\": 0.0,\n            \"vi_list\": [0.0, 2.0e-6, 2.0e-6, 2.0e-6, 3.0e-6, 3.0e-6, 4.0e-6, 4.0e-6, 5.0e-6, 5.0e-6]\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        V0 = case[\"V0\"]\n        CM = case[\"CM\"]\n        Cs = case[\"Cs\"]\n        Kd = case[\"Kd\"]\n        delta_H = case[\"delta_H\"]\n        vi_list = case[\"vi_list\"]\n\n        # Initial conditions (i=0)\n        M_prev = CM * V0  # Moles of Antibody\n        L_prev = 0.0      # Moles of Antigen\n        x_prev = 0.0      # Concentration of complex [AB]\n\n        q_list = []\n\n        for vi in vi_list:\n            # Calculate displacement fraction\n            fi = vi / V0\n\n            # Update total moles based on mass balance\n            # M_curr is moles of antibody after injection i\n            # L_curr is moles of antigen after injection i\n            M_curr = M_prev * (1 - fi)\n            L_curr = L_prev * (1 - fi) + vi * Cs\n            \n            # Calculate total concentrations in the cell\n            TM_curr = M_curr / V0\n            TL_curr = L_curr / V0\n\n            # Solve for the new equilibrium concentration of the complex, x_curr\n            # (x_curr)^2 - (TM_curr + TL_curr + Kd) * x_curr + TM_curr * TL_curr = 0\n            a = 1.0\n            b = -(TM_curr + TL_curr + Kd)\n            c = TM_curr * TL_curr\n\n            # Use the quadratic formula, selecting the physically meaningful root\n            discriminant = b**2 - 4 * a * c\n            \n            # Ensure discriminant is non-negative to avoid domain errors with sqrt\n            if discriminant  0:\n                discriminant = 0\n\n            x_curr = (-b - np.sqrt(discriminant)) / (2 * a)\n\n            # Calculate the integrated heat for the injection\n            # q_i = delta_H * V0 * (x_curr - (1 - fi) * x_prev)\n            q_i = delta_H * V0 * (x_curr - (1 - fi) * x_prev)\n            q_list.append(round(q_i, 6))\n\n            # Update state for the next iteration\n            M_prev = M_curr\n            L_prev = L_curr\n            x_prev = x_curr\n        \n        all_results.append(q_list)\n\n    # Format the final output string as a list of lists.\n    # The default str() representation of a list of lists matches the required format.\n    print(str(all_results))\n\nsolve()\n```", "id": "5092675"}]}