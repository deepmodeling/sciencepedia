{"hands_on_practices": [{"introduction": "The foundation of spectral cytometry lies in its ability to distinguish multiple fluorophores simultaneously. We can conceptualize a fluorophore's emission profile as a vector in a high-dimensional space, where each dimension represents a detector channel. This exercise introduces the spectral angle, a geometric measure derived from the dot product, as a quantitative tool to assess the similarity between two spectral signatures [@problem_id:5165247]. Calculating this angle provides direct insight into the degree of spectral overlap and the inherent difficulty of unmixing two dyes, forming the theoretical basis for panel design.", "problem": "A spectral flow cytometer in a molecular and immunodiagnostics assay records photon emission across $6$ discrete spectral detectors spanning approximately $450$–$700$ nanometers. After background subtraction and per-event normalization to unit Euclidean norm, two single-fluorophore reference spectra are represented as vectors $a, b \\in \\mathbb{R}^{6}$:\n$$\na=\\left(\\frac{1}{\\sqrt{3}},\\, \\frac{1}{\\sqrt{3}},\\, \\frac{1}{\\sqrt{3}},\\, 0,\\, 0,\\, 0\\right), \\quad\nb=\\left(\\frac{1}{\\sqrt{2}},\\, 0,\\, \\frac{1}{\\sqrt{2}},\\, 0,\\, 0,\\, 0\\right).\n$$\nUsing only the fundamental definitions of the Euclidean inner product and norm in $\\mathbb{R}^{n}$ and the geometric interpretation of the angle between vectors, derive an explicit expression for the spectral angle $\\theta$ between $a$ and $b$ and compute its numerical value. Express your final numerical answer for $\\theta$ in radians, rounded to four significant figures. Briefly discuss, based on first principles of linear unmixing in spectral flow cytometry, how the magnitude of the computed $\\theta$ informs diagnostic expectations about fluorophore separability when both dyes are present in a mixture at comparable abundance and moderate signal-to-noise ratio.", "solution": "The problem statement is first subjected to a rigorous validation procedure before any attempt at a solution.\n\n### Step 1: Extract Givens\n- The problem is set in a $6$-dimensional real vector space, $\\mathbb{R}^{6}$.\n- Two single-fluorophore reference spectra are given as vectors $a, b \\in \\mathbb{R}^{6}$.\n- The vectors have been pre-processed by background subtraction and normalized to have a unit Euclidean norm.\n- Vector $a = \\left(\\frac{1}{\\sqrt{3}},\\, \\frac{1}{\\sqrt{3}},\\, \\frac{1}{\\sqrt{3}},\\, 0,\\, 0,\\, 0\\right)$.\n- Vector $b = \\left(\\frac{1}{\\sqrt{2}},\\, 0,\\, \\frac{1}{\\sqrt{2}},\\, 0,\\, 0,\\, 0\\right)$.\n- The task requires derivation of the spectral angle $\\theta$ between $a$ and $b$ using only a) the fundamental definition of the Euclidean inner product, b) the definition of the Euclidean norm, and c) the geometric interpretation of the angle between vectors.\n- The task requires computation of the numerical value of $\\theta$ in radians, rounded to four significant figures.\n- The task requires a brief discussion on how the magnitude of $\\theta$ relates to fluorophore separability in linear unmixing.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific Grounding**: The problem is well-grounded in the principles of linear algebra as applied to spectral data analysis, which is a standard and fundamental technique in fields like spectral flow cytometry and remote sensing. Representing spectra as vectors and using the angle between them to quantify similarity is a core concept.\n2.  **Well-Posedness**: The problem is well-posed. The vectors are explicitly defined, and the task—to compute the angle between them and discuss its significance—is unambiguous. A unique mathematical solution for the angle exists.\n3.  **Objectivity**: The problem is stated using objective, mathematical language, free from subjective or ambiguous terminology.\n4.  **Consistency Check**: The problem states that the vectors are normalized to unit Euclidean norm. This claim is verifiable.\n    For vector $a$:\n    $$ \\|a\\|^2 = \\left(\\frac{1}{\\sqrt{3}}\\right)^2 + \\left(\\frac{1}{\\sqrt{3}}\\right)^2 + \\left(\\frac{1}{\\sqrt{3}}\\right)^2 + 0^2 + 0^2 + 0^2 = \\frac{1}{3} + \\frac{1}{3} + \\frac{1}{3} = 1 $$\n    Thus, $\\|a\\| = \\sqrt{1} = 1$.\n    For vector $b$:\n    $$ \\|b\\|^2 = \\left(\\frac{1}{\\sqrt{2}}\\right)^2 + 0^2 + \\left(\\frac{1}{\\sqrt{2}}\\right)^2 + 0^2 + 0^2 + 0^2 = \\frac{1}{2} + \\frac{1}{2} = 1 $$\n    Thus, $\\|b\\| = \\sqrt{1} = 1$.\n    The given vectors are indeed unit vectors as stated. The problem is internally consistent and complete. No essential information is missing, and no contradictions are present.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid** as it is scientifically grounded, well-posed, objective, and internally consistent. A full solution will be provided.\n\n### Solution Derivation\nThe derivation proceeds from the fundamental definitions as required.\n\nThe Euclidean inner product (or dot product) of two vectors $x = (x_1, x_2, \\dots, x_n)$ and $y = (y_1, y_2, \\dots, y_n)$ in $\\mathbb{R}^{n}$ is defined as:\n$$ \\langle x, y \\rangle = \\sum_{i=1}^{n} x_i y_i $$\nThe Euclidean norm of a vector $x$ is defined as $\\|x\\| = \\sqrt{\\langle x, x \\rangle} = \\sqrt{\\sum_{i=1}^{n} x_i^2}$.\n\nThe geometric interpretation of the inner product relates it to the angle $\\theta$ between the vectors $x$ and $y$:\n$$ \\langle x, y \\rangle = \\|x\\| \\|y\\| \\cos(\\theta) $$\nThis equation provides the basis for defining the angle between two non-zero vectors. Rearranging for $\\cos(\\theta)$ gives:\n$$ \\cos(\\theta) = \\frac{\\langle x, y \\rangle}{\\|x\\| \\|y\\|} $$\nApplying the inverse cosine function yields the explicit expression for the angle $\\theta$:\n$$ \\theta = \\arccos\\left(\\frac{\\langle x, y \\rangle}{\\|x\\| \\|y\\|}\\right) $$\nThis is the required expression for the spectral angle.\n\nNow, we apply this to the specific vectors $a$ and $b$ in $\\mathbb{R}^{6}$.\nFirst, we compute the inner product $\\langle a, b \\rangle$:\n$$ \\langle a, b \\rangle = \\left(\\frac{1}{\\sqrt{3}}\\right)\\left(\\frac{1}{\\sqrt{2}}\\right) + \\left(\\frac{1}{\\sqrt{3}}\\right)(0) + \\left(\\frac{1}{\\sqrt{3}}\\right)\\left(\\frac{1}{\\sqrt{2}}\\right) + (0)(0) + (0)(0) + (0)(0) $$\n$$ \\langle a, b \\rangle = \\frac{1}{\\sqrt{6}} + 0 + \\frac{1}{\\sqrt{6}} + 0 + 0 + 0 = \\frac{2}{\\sqrt{6}} $$\nThis can be rationalized to $\\frac{2\\sqrt{6}}{6} = \\frac{\\sqrt{6}}{3}$, but the form $\\frac{2}{\\sqrt{6}}$ is sufficient for computation.\n\nNext, we use the norms of the vectors. As given in the problem and verified in the validation step, the vectors are of unit norm: $\\|a\\| = 1$ and $\\|b\\| = 1$.\n\nSubstituting these values into the expression for $\\cos(\\theta)$:\n$$ \\cos(\\theta) = \\frac{\\frac{2}{\\sqrt{6}}}{(1)(1)} = \\frac{2}{\\sqrt{6}} $$\nNow we can find the angle $\\theta$ by taking the inverse cosine:\n$$ \\theta = \\arccos\\left(\\frac{2}{\\sqrt{6}}\\right) $$\nTo compute the numerical value, we evaluate the argument:\n$$ \\frac{2}{\\sqrt{6}} \\approx 0.81649658\\dots $$\n$$ \\theta = \\arccos(0.81649658\\dots) \\approx 0.61547970\\dots \\text{ radians} $$\nRounding to four significant figures, we get:\n$$ \\theta \\approx 0.6155 \\text{ radians} $$\n\n### Discussion on Fluorophore Separability\nIn spectral flow cytometry, a signal measured from a cell stained with multiple fluorophores is modeled as a linear combination of the reference spectra of the individual fluorophores, plus a noise term. For a two-fluorophore mixture of $a$ and $b$, the measured signal vector $m$ can be written as:\n$$ m = c_a a + c_b b + \\epsilon $$\nwhere $c_a$ and $c_b$ are the unknown abundances (proportional to the number of molecules) of each fluorophore, and $\\epsilon$ is the measurement noise vector. The process of estimating $c_a$ and $c_b$ from the measurement $m$ is called linear unmixing.\n\nThe ability to accurately and robustly determine $c_a$ and $c_b$ is critically dependent on the linear independence of the reference vectors $a$ and $b$. The spectral angle $\\theta$ is the primary measure of this independence.\n- If $\\theta = 0$, the vectors are collinear ($a$ and $b$ represent identical spectral shapes). The fluorophores are indistinguishable, and it is impossible to solve for their individual contributions.\n- If $\\theta = \\frac{\\pi}{2}$ radians ($90^\\circ$), the vectors are orthogonal. Their spectra are completely non-overlapping. This is the ideal scenario for separation, as the unmixing problem is perfectly conditioned, and the presence of one fluorophore does not project onto the spectral signature of the other.\n- For intermediate angles $0 < \\theta < \\frac{\\pi}{2}$, the vectors are partially correlated, indicating spectral overlap. A smaller angle implies greater overlap and higher correlation.\n\nThe computed angle is $\\theta \\approx 0.6155$ radians, which is approximately $35.3^\\circ$. This value is significantly different from both $0$ and $\\frac{\\pi}{2}$. It indicates a moderate but substantial degree of spectral overlap between the two fluorophores. From a diagnostic standpoint, this has a direct consequence: the linear system for unmixing will be somewhat ill-conditioned. In the presence of measurement noise (which is always a factor, especially at low signal levels), this ill-conditioning amplifies the effect of the noise on the estimated abundances $c_a$ and $c_b$. This phenomenon is known as \"spillover\" or \"crosstalk,\" where signal from one dye is incorrectly attributed to the other. The variance of the estimated abundances is inversely proportional to $\\sin^2(\\theta)$. As $\\theta$ is moderately small, the variance of the estimates will be significantly inflated compared to the orthogonal case. Therefore, the diagnostic expectation is that while these two fluorophores are separable, the quantification of their respective abundances will have a notable degree of uncertainty and cross-contamination, which could compromise the precision of diagnostic measurements, especially for populations with low expression levels or when one fluorophore is much brighter than the other.", "answer": "$$\n\\boxed{0.6155}\n$$", "id": "5165247"}, {"introduction": "Real-world measurements involve more than just the target fluorophores; biological samples exhibit autofluorescence that can confound analysis. This practice demonstrates the importance of a complete model by examining the impact of including an autofluorescence \"endmember\" in the unmixing process. You will explore how the residual—the portion of the signal unexplained by the model—serves as a critical diagnostic for goodness-of-fit [@problem_id:5165268]. Understanding this principle is crucial for ensuring the accurate quantification of markers, especially those with low expression levels that might otherwise be obscured by unmodeled background signals.", "problem": "In spectral flow cytometry used for molecular and immunodiagnostics, a single-cell emission spectrum across detectors is modeled as a linear superposition of known endmember spectra (fluorochromes and autofluorescence), plus noise. Consider a five-detector instrument that has been gain-normalized and whitened so that the reference spectra are orthonormal and the measurement noise is isotropic. Let the linear measurement model be $y = A x + \\varepsilon$, where $y \\in \\mathbb{R}^{5}$ is the measured spectrum (in arbitrary fluorescence units), $A$ is the reference matrix with columns that are the unit $2$-norm spectral fingerprints of each endmember, $x$ is the nonnegative abundance vector, and $\\varepsilon$ is zero-mean additive noise. The orthonormal basis vectors of detector space are denoted by $\\{e_{1}, e_{2}, e_{3}, e_{4}, e_{5}\\}$, with the first three corresponding to the three fluorochromes, the fourth to autofluorescence, and the fifth to an unmodeled spectral shape orthogonal to the references.\n\nSuppose the three fluorochrome reference spectra are $A_{F} = [e_{1}, e_{2}, e_{3}]$, and the autofluorescence (AF) endmember is $e_{4}$. The measured single-cell spectrum is\n$$\ny = \\begin{pmatrix} 300 \\\\ 200 \\\\ 0 \\\\ 150 \\\\ 40 \\end{pmatrix} \\text{ a.u.}\n$$\nAssume the standard linear unmixing estimator is obtained by minimizing the Euclidean norm of the residual, that is, by solving $\\min_{x} \\|y - A x\\|_{2}$, where $A$ is the chosen reference matrix.\n\nCompute the Euclidean norm of the residual when unmixing is performed:\n1. Excluding the autofluorescence endmember, using $A_{0} = [e_{1}, e_{2}, e_{3}]$.\n2. Including the autofluorescence endmember, using $A_{1} = [e_{1}, e_{2}, e_{3}, e_{4}]$.\n\nThen calculate the absolute decrease in the residual norm, defined as $\\Delta R = \\|y - A_{0}\\hat{x}_{0}\\|_{2} - \\|y - A_{1}\\hat{x}_{1}\\|_{2}$, where $\\hat{x}_{0}$ and $\\hat{x}_{1}$ are the minimizers for $A_{0}$ and $A_{1}$, respectively. Express your final answer for $\\Delta R$ in arbitrary fluorescence units (a.u.). No rounding is required.\n\nFinally, interpret what this change implies for diagnostic quantification of low-abundance markers in spectral flow cytometry when autofluorescence is present.", "solution": "The problem requires the calculation of the Euclidean norm of the residual for a linear unmixing problem under two different model assumptions, followed by the calculation of the decrease in this norm and an interpretation of the result.\n\nThe linear model is given by $y = A x + \\varepsilon$, where $y$ is the measured data, $A$ is the matrix of reference spectra, $x$ is the abundance vector, and $\\varepsilon$ is noise. The standard linear unmixing estimator is found by solving the least-squares problem:\n$$\n\\hat{x} = \\arg\\min_{x} \\|y - A x\\|_{2}\n$$\nThe vector $\\hat{y} = A\\hat{x}$ is the orthogonal projection of the data vector $y$ onto the column space of $A$, denoted $\\text{Col}(A)$. The residual vector is $r = y - \\hat{y}$. By the properties of orthogonal projections, the residual vector $r$ is orthogonal to $\\text{Col}(A)$. In other words, $r$ is the projection of $y$ onto the orthogonal complement of the column space of $A$, denoted $(\\text{Col}(A))^{\\perp}$.\n\nThe problem provides an orthonormal basis for the $5$-dimensional detector space, $\\{e_{1}, e_{2}, e_{3}, e_{4}, e_{5}\\}$. Since these vectors are orthonormal, we can represent any vector in this space as a linear combination of them. The measured spectrum is given as:\n$$\ny = \\begin{pmatrix} 300 \\\\ 200 \\\\ 0 \\\\ 150 \\\\ 40 \\end{pmatrix}\n$$\nIn terms of the orthonormal basis, this vector is expressed as:\n$$\ny = 300 e_{1} + 200 e_{2} + 0 e_{3} + 150 e_{4} + 40 e_{5}\n$$\nThis representation simplifies the projection calculations significantly. The projection of $y$ onto a subspace spanned by a subset of these basis vectors is simply the sum of the components of $y$ along those basis vectors.\n\n**Part 1: Unmixing excluding the autofluorescence endmember**\n\nIn this case, the model matrix is $A_{0} = [e_{1}, e_{2}, e_{3}]$. The column space of $A_{0}$ is $\\text{Col}(A_{0}) = \\text{span}\\{e_{1}, e_{2}, e_{3}\\}$. The orthogonal projection of $y$ onto this subspace, $\\hat{y}_{0}$, is:\n$$\n\\hat{y}_{0} = (y \\cdot e_{1})e_{1} + (y \\cdot e_{2})e_{2} + (y \\cdot e_{3})e_{3}\n$$\nUsing the coefficients from the expansion of $y$:\n$$\n\\hat{y}_{0} = 300 e_{1} + 200 e_{2} + 0 e_{3}\n$$\nThe residual vector, $r_{0} = y - \\hat{y}_{0}$, is the part of $y$ that is orthogonal to $\\text{Col}(A_{0})$.\n$$\nr_{0} = (300 e_{1} + 200 e_{2} + 0 e_{3} + 150 e_{4} + 40 e_{5}) - (300 e_{1} + 200 e_{2} + 0 e_{3})\n$$\n$$\nr_{0} = 150 e_{4} + 40 e_{5}\n$$\nThe Euclidean norm of the residual, $\\|r_{0}\\|_{2}$, is calculated using the Pythagorean theorem, as $e_{4}$ and $e_{5}$ are orthogonal:\n$$\n\\|r_{0}\\|_{2}^{2} = \\|150 e_{4} + 40 e_{5}\\|_{2}^{2} = 150^{2} \\|e_{4}\\|_{2}^{2} + 40^{2} \\|e_{5}\\|_{2}^{2}\n$$\nSince $\\|e_{4}\\|_{2} = 1$ and $\\|e_{5}\\|_{2} = 1$:\n$$\n\\|r_{0}\\|_{2}^{2} = 150^{2} + 40^{2} = 22500 + 1600 = 24100\n$$\nThus, the norm of the residual is:\n$$\n\\|r_{0}\\|_{2} = \\sqrt{24100} = 10\\sqrt{241}\n$$\n\n**Part 2: Unmixing including the autofluorescence endmember**\n\nIn this case, the model matrix is $A_{1} = [e_{1}, e_{2}, e_{3}, e_{4}]$. The column space is $\\text{Col}(A_{1}) = \\text{span}\\{e_{1}, e_{2}, e_{3}, e_{4}\\}$. The orthogonal projection of $y$ onto this larger subspace, $\\hat{y}_{1}$, is:\n$$\n\\hat{y}_{1} = (y \\cdot e_{1})e_{1} + (y \\cdot e_{2})e_{2} + (y \\cdot e_{3})e_{3} + (y \\cdot e_{4})e_{4}\n$$\nUsing the coefficients from the expansion of $y$:\n$$\n\\hat{y}_{1} = 300 e_{1} + 200 e_{2} + 0 e_{3} + 150 e_{4}\n$$\nThe residual vector, $r_{1} = y - \\hat{y}_{1}$, is:\n$$\nr_{1} = (300 e_{1} + 200 e_{2} + 0 e_{3} + 150 e_{4} + 40 e_{5}) - (300 e_{1} + 200 e_{2} + 0 e_{3} + 150 e_{4})\n$$\n$$\nr_{1} = 40 e_{5}\n$$\nThe Euclidean norm of the residual, $\\|r_{1}\\|_{2}$, is:\n$$\n\\|r_{1}\\|_{2} = \\|40 e_{5}\\|_{2} = 40 \\|e_{5}\\|_{2} = 40 \\times 1 = 40\n$$\n\n**Part 3: Absolute decrease in the residual norm**\n\nThe absolute decrease in the residual norm, $\\Delta R$, is the difference between the two computed norms:\n$$\n\\Delta R = \\|y - A_{0}\\hat{x}_{0}\\|_{2} - \\|y - A_{1}\\hatx_{1}\\|_{2} = \\|r_{0}\\|_{2} - \\|r_{1}\\|_{2}\n$$\n$$\n\\Delta R = 10\\sqrt{241} - 40\n$$\nThe mention of a \"nonnegative abundance vector\" $x$ implies a non-negative least squares (NNLS) problem. However, the solutions for the unconstrained least squares problem, $\\hat{x}_0 = A_0^T y = [300, 200, 0]^T$ and $\\hat{x}_1 = A_1^T y = [300, 200, 0, 150]^T$, are already non-negative. Therefore, the unconstrained and non-negative least squares solutions coincide in this specific case, and the calculated residuals are correct.\n\n**Part 4: Interpretation of the result**\n\nThe residual represents the portion of the measured signal that is not explained by the chosen linear model. This unexplained portion can be attributed to measurement noise and/or model misspecification error (i.e., true spectral components present in the cell but not included in a model's reference matrix $A$).\n\nWhen autofluorescence is excluded from the model ($A_{0}$), its spectral signature ($150 e_{4}$) is not accounted for and is thus relegated to the residual. This results in a large residual norm of $10\\sqrt{241} \\approx 155.24$ a.u. This large, structured residual (it is not random noise) can obscure faint signals from low-abundance markers, leading to false negatives or inaccurate quantification.\n\nWhen autofluorescence is included in the model ($A_{1}$), its contribution is correctly identified and assigned to the corresponding abundance coefficient ($x_{AF} = 150$). Consequently, the autofluorescence signal is removed from the residual, which now only contains the component $40 e_{5}$. This component represents what is left, possibly noise or other unmodeled spectral shapes. The residual norm drops sharply to $40$ a.u.\n\nThe decrease, $\\Delta R = 10\\sqrt{241} - 40 \\approx 115.24$ a.u., quantifies the improvement in the model's goodness-of-fit. For diagnostic applications, especially in quantifying low-abundance markers, this is critical. A smaller residual implies a lower noise floor or background, which increases the signal-to-noise ratio for all markers. By explicitly modeling autofluorescence, we prevent its signal from contaminating the estimates of other fluorochromes (spillover compensation) and from inflating the residual. This enables the reliable detection and quantification of weak signals that would otherwise be indistinguishable from the large, unmodeled background, thereby significantly improving the sensitivity and accuracy of immunodiagnostic assays.", "answer": "$$\n\\boxed{10\\sqrt{241} - 40}\n$$", "id": "5165268"}, {"introduction": "Once a comprehensive spectral model is established, the next challenge is to perform the unmixing optimally and to quantify the quality of the resulting separation. This advanced exercise delves into the Generalized Least Squares (GLS) method, which accounts for varying noise levels across detector channels to produce the most precise estimates of fluorophore abundance. You will then use these estimates to calculate the Stain Index ($SI$), a key performance metric that measures the resolution between negative and positive populations [@problem_id:5165248]. This problem bridges advanced statistical estimation with a practical benchmark of diagnostic sensitivity, illustrating why spectral unmixing can outperform conventional compensation.", "problem": "In spectral flow cytometry (SFC), photon counts across multiple detectors are used to estimate fluorophore abundances by linear unmixing. Consider a single analyte marker measured on heterogeneous cells exhibiting a negative population and a positive population. Assume the single-cell fluorescence intensity distributions in any one reported channel are well modeled by Gaussian distributions due to the Central Limit Theorem and the additive nature of photon shot noise and electronic noise. Specifically, let the negative population be distributed as a Gaussian with mean $\\mu_{\\text{neg}}$ and standard deviation $\\sigma_{\\text{neg}}$, and the positive population have mean $\\mu_{\\text{pos}}$.\n\nPart A (derivation from first principles): Starting from the following fundamental base:\n- Gaussian distribution quantiles define tail probabilities, and a threshold at $\\mu_{\\text{neg}} + k \\sigma_{\\text{neg}}$ corresponds to a fixed false-positive fraction determined by $k$.\n- A practically useful low false-positive operating point in flow cytometry is captured by selecting $k \\approx 2$, which places the decision threshold near the upper tail of the negative Gaussian.\nDerive a normalized separation metric (the stain index) that quantifies how far the positive mean lies above the negative distribution width at this operating point, expressed in terms of $\\mu_{\\text{pos}}$, $\\mu_{\\text{neg}}$, and $\\sigma_{\\text{neg}}$. Do not assume any specific numerical values in this part.\n\nPart B (spectral unmixing model and computation): In SFC, suppose the observed spectral measurement vector $\\mathbf{y} \\in \\mathbb{R}^{m}$ satisfies the linear model $\\mathbf{y} = S \\mathbf{a} + \\mathbf{e}$, where $S \\in \\mathbb{R}^{m \\times n}$ contains the reference emission spectra for $n$ fluorophores across $m$ detectors, $\\mathbf{a} \\in \\mathbb{R}^{n}$ are the underlying fluorophore abundances, and $\\mathbf{e}$ is zero-mean Gaussian noise with covariance matrix $N \\in \\mathbb{R}^{m \\times m}$. The Generalized Least Squares (GLS) linear unmixing estimator is $\\hat{\\mathbf{a}} = W \\mathbf{y}$ with $W = \\left(S^{\\top} N^{-1} S\\right)^{-1} S^{\\top} N^{-1}$.\n\nConsider $m = 2$ detectors and $n = 2$ fluorophores with\n$$\nS = \\begin{pmatrix}\n1 & \\tfrac{1}{4} \\\\\n\\tfrac{1}{10} & \\tfrac{17}{20}\n\\end{pmatrix}, \\quad\nN = \\begin{pmatrix}\n400 & 0 \\\\\n0 & 1600\n\\end{pmatrix}.\n$$\nAssume the target analyte is fluorophore $1$. The negative population has $a_{1} = 0$ and the positive population has $a_{1} = 500$, while fluorophore $2$ is absent in both populations (i.e., $a_{2} = 0$). Using the GLS model, compute the stain index in the unmixed analyte-$1$ channel. Express your final answer as a single exact closed-form expression in simplest radical form (no numerical rounding and no units).\n\nPart C (conceptual comparison): Briefly discuss, at the level of means and variances, how spectral unmixing via GLS affects $\\mu$ and $\\sigma$ of the reported analyte channel compared to conventional spillover compensation that uses a simple inverse of a spillover matrix, under the assumptions of linearity and Gaussian noise. Your discussion should rely only on linear estimation, variance propagation, and unbiasedness arguments, and should not invoke any software-specific heuristics.\n\nThe final reported value for Part B must be a single number or a single closed-form analytic expression; do not include units or a percentage sign. If you choose to approximate numerically, round your answer to four significant figures; otherwise, provide the exact expression.", "solution": "Part A. Let the negative population intensity $X_{\\text{neg}}$ be Gaussian with mean $\\mu_{\\text{neg}}$ and standard deviation $\\sigma_{\\text{neg}}$, and the positive population intensity $X_{\\text{pos}}$ be Gaussian with mean $\\mu_{\\text{pos}}$. A classifier threshold that keeps the false-positive rate small can be placed at the upper tail of the negative Gaussian, for example at $T = \\mu_{\\text{neg}} + k \\sigma_{\\text{neg}}$. For $k = 2$, this threshold approximates a low false-positive operating point for a Gaussian. A normalized separation metric that quantifies how far the positive mean lies above this operating point is\n$$\n\\text{separation} = \\frac{\\mu_{\\text{pos}} - T}{\\sigma_{\\text{neg}}} = \\frac{\\mu_{\\text{pos}} - \\mu_{\\text{neg}} - k \\sigma_{\\text{neg}}}{\\sigma_{\\text{neg}}}.\n$$\nFor reporting a scale-invariant index that reflects how many “half-widths” of the negative distribution fit into the mean gap, one normalizes the mean difference by twice the negative standard deviation, i.e., with $k = 2$ the stain index is\n$$\n\\text{SI} = \\frac{\\mu_{\\text{pos}} - \\mu_{\\text{neg}}}{2 \\sigma_{\\text{neg}}}.\n$$\nThis choice corresponds to measuring the mean gap in units of the negative distribution’s two-standard-deviation width, anchoring the operating point to a fixed false-positive regime.\n\nPart B. We adopt the linear model $\\mathbf{y} = S \\mathbf{a} + \\mathbf{e}$ with $\\mathbf{e} \\sim \\mathcal{N}(\\mathbf{0}, N)$ and the Generalized Least Squares (GLS) estimator $\\hat{\\mathbf{a}} = W \\mathbf{y}$, where\n$$\nW = \\left(S^{\\top} N^{-1} S\\right)^{-1} S^{\\top} N^{-1}.\n$$\nUnder correct modeling, $\\mathbb{E}[\\hat{\\mathbf{a}}] = \\mathbf{a}$ because $W S = I$, and the estimator covariance is the Gauss–Markov covariance\n$$\n\\operatorname{Var}(\\hat{\\mathbf{a}}) = \\left(S^{\\top} N^{-1} S\\right)^{-1}.\n$$\nTherefore, in the unmixed analyte-$1$ channel, the negative mean is $\\mu_{\\text{neg}} = 0$ and the positive mean is $\\mu_{\\text{pos}} = 500$. The negative standard deviation in the unmixed analyte-$1$ channel, denoted $\\sigma_{\\text{neg}}$, is the square root of the $(1,1)$ element of $\\left(S^{\\top} N^{-1} S\\right)^{-1}$.\n\nWe compute $H \\equiv S^{\\top} N^{-1} S$. First, $N^{-1} = \\begin{pmatrix} \\tfrac{1}{400} & 0 \\\\ 0 & \\tfrac{1}{1600} \\end{pmatrix}$. With\n$$\nS = \\begin{pmatrix}\n1 & \\tfrac{1}{4} \\\\\n\\tfrac{1}{10} & \\tfrac{17}{20}\n\\end{pmatrix},\n$$\nwe obtain\n$$\nH = S^{\\top} N^{-1} S\n= \\begin{pmatrix}\n\\tfrac{401}{160000} & \\tfrac{217}{320000} \\\\\n\\tfrac{217}{320000} & \\tfrac{389}{640000}\n\\end{pmatrix}\n= \\frac{1}{640000}\n\\begin{pmatrix}\n1604 & 434 \\\\\n434 & 389\n\\end{pmatrix}.\n$$\nInverting $H$ gives\n$$\nH^{-1} = 640000 \\begin{pmatrix}\n1604 & 434 \\\\\n434 & 389\n\\end{pmatrix}^{-1}.\n$$\nThe determinant of the integer matrix is\n$$\n\\det\\begin{pmatrix}\n1604 & 434 \\\\\n434 & 389\n\\end{pmatrix} = 1604 \\cdot 389 - 434^{2} = 623956 - 188356 = 435600.\n$$\nThus\n$\n\\begin{pmatrix}\n1604 & 434 \\\\\n434 & 389\n\\end{pmatrix}^{-1}\n= \\frac{1}{435600}\n\\begin{pmatrix}\n389 & -434 \\\\\n-434 & 1604\n\\end{pmatrix},\n$\nand\n$$\nH^{-1} = \\frac{640000}{435600}\n\\begin{pmatrix}\n389 & -434 \\\\\n-434 & 1604\n\\end{pmatrix}\n= \\frac{1600}{1089}\n\\begin{pmatrix}\n389 & -434 \\\\\n-434 & 1604\n\\end{pmatrix},\n$$\nsince $\\tfrac{640000}{435600} = \\tfrac{1600}{1089}$.\n\nTherefore, the variance of the unmixed analyte-$1$ channel for the negative population is\n$$\n\\sigma_{\\text{neg}}^{2} = \\left(H^{-1}\\right)_{11} = \\frac{1600}{1089} \\cdot 389 = \\frac{622400}{1089},\n$$\nand\n$$\n\\sigma_{\\text{neg}} = \\frac{40 \\sqrt{389}}{33}.\n$$\nUsing the result of Part A, the stain index in the unmixed analyte-$1$ channel is\n$$\n\\text{SI} = \\frac{\\mu_{\\text{pos}} - \\mu_{\\text{neg}}}{2 \\sigma_{\\text{neg}}}\n= \\frac{500 - 0}{2 \\cdot \\left(\\tfrac{40 \\sqrt{389}}{33}\\right)}\n= \\frac{500 \\cdot 33}{80 \\sqrt{389}}\n= \\frac{16500}{80 \\sqrt{389}}\n= \\frac{825}{4 \\sqrt{389}}.\n$$\nThis is an exact closed-form expression in simplest radical form.\n\nPart C. Under linearity and Gaussian noise, both conventional spillover compensation and GLS spectral unmixing can be framed as linear estimators $\\hat{\\mathbf{a}} = L \\mathbf{y}$ that aim to recover $\\mathbf{a}$. If $L$ satisfies $L S = I$, then the estimator is unbiased, so the reported analyte mean $\\mu$ equals the true abundance (i.e., $\\mathbb{E}[\\hat{\\mathbf{a}}] = \\mathbf{a}$). The key difference lies in variance propagation. For any unbiased linear estimator $L$, the output covariance is $L N L^{\\top}$. The Gauss–Markov theorem states that the Generalized Least Squares (GLS) choice $W = \\left(S^{\\top} N^{-1} S\\right)^{-1} S^{\\top} N^{-1}$ uniquely minimizes the covariance (in the positive semidefinite sense) among all unbiased linear estimators, yielding $\\operatorname{Var}(\\hat{\\mathbf{a}}) = \\left(S^{\\top} N^{-1} S\\right)^{-1}$. In contrast, conventional compensation often uses a simple inverse of a spillover matrix (or an approximate left-inverse that does not weight by $N^{-1}$). When detector noises are heteroscedastic or correlated, failing to weight by $N^{-1}$ generally inflates the variance of the reported analyte relative to GLS. Consequently, compared to conventional compensation, spectral unmixing via GLS preserves the mean (unbiasedness) while typically reducing the standard deviation $\\sigma$ of the reported analyte channel, thereby increasing the stain index $\\text{SI} = (\\mu_{\\text{pos}} - \\mu_{\\text{neg}})/(2 \\sigma_{\\text{neg}})$ through a smaller denominator. In summary, under matched models, GLS unmixing maintains $\\mu$ and optimally down-weights noisy detectors to minimize $\\sigma$, improving separation quantified by the stain index.", "answer": "$$\\boxed{\\frac{825}{4 \\sqrt{389}}}$$", "id": "5165248"}]}