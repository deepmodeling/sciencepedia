{"hands_on_practices": [{"introduction": "Droplet-based single-cell sequencing relies on stochastically partitioning cells into picoliter droplets, a process that inevitably leads to a trade-off between cell throughput and data quality. This exercise explores the fundamental statistical model governing this process, the Poisson distribution, to quantify the probability of forming \"doublets\"—droplets containing more than one cell. Understanding and modeling this phenomenon [@problem_id:3321400] is the first critical step in designing a successful scRNA-seq experiment and interpreting its results.", "problem": "Single-cell ribonucleic acid sequencing (scRNA-seq) measures messenger ribonucleic acid (mRNA) abundance at the resolution of individual cells. Define droplet-based single-cell ribonucleic acid sequencing (scRNA-seq) and contrast it to plate-based single-cell ribonucleic acid sequencing (scRNA-seq) methods in terms of capture modality, barcoding, throughput, and typical trade-offs relevant to computational systems biology analyses. Then, consider a microfluidic droplet encapsulation system in which a well-mixed cell suspension is partitioned into aqueous droplets in oil. Assume the following modeling base: cells are independently and randomly encapsulated into droplets, droplets form independently, and the number of cells per droplet follows a Poisson distribution with rate parameter $\\lambda$ equal to the expected number of cells per droplet. Using only these base assumptions and standard properties of the Poisson distribution, derive from first principles an analytic expression for the probability that a droplet contains at least two cells (a “doublet-or-higher”) as a function of $\\lambda$. Finally, evaluate this probability at $\\lambda = 0.1$ and $\\lambda = 0.2$, and report both probabilities as decimals. Round each value to $4$ significant figures. Do not use the percent sign; express probabilities as unitless decimals.", "solution": "The first part of the problem requires a definition of droplet-based scRNA-seq and a comparison with plate-based methods.\n\nDroplet-based scRNA-seq is a high-throughput technology used to profile the transcriptomes of thousands to hundreds of thousands of individual cells. The core principle involves the use of microfluidics to partition a cell suspension into picoliter- to nanoliter-volume aqueous droplets within an immiscible oil phase. Critically, each droplet is designed to co-encapsulate a single cell with a single bead or gel that is pre-loaded with barcoded primers. This process is stochastic. Once encapsulated, the cell is lysed, and its messenger ribonucleic acid (mRNA) molecules are captured by the primers on the co-encapsulated bead. All mRNA from a given cell are thus tagged with a unique barcode sequence specific to that droplet, enabling the pooling of all droplets for subsequent reverse transcription and sequencing. The barcodes are later used computationally to demultiplex the sequencing reads and assign them back to their cell of origin.\n\nWe contrast droplet-based and plate-based scRNA-seq methods on the specified criteria:\n\n1.  **Capture Modality**:\n    *   **Plate-based**: Cells are physically isolated into individual wells of a multi-well plate (e.g., $96$-well or $384$-well plates). This isolation is deterministic and can be achieved via methods like fluorescence-activated cell sorting (FACS), which allows for selection of specific cells, or limiting dilution, which is a less precise manual method. Each well serves as a distinct reaction vessel.\n    *   **Droplet-based**: Cells are captured stochastically. A dilute cell suspension is passed through a microfluidic chip, where droplets are formed at a high frequency. The encapsulation of cells into droplets follows a statistical distribution, typically modeled as a Poisson process. The goal is to load cells at a concentration low enough to minimize the probability of multiple cells being captured in the same droplet.\n\n2.  **Barcoding**:\n    *   **Plate-based**: Barcoding is performed on a per-well basis. Following cell lysis in each well, reverse transcription is carried out using primers that contain a barcode unique to that well. All transcripts from the single cell in a given well are tagged with the same barcode.\n    *   **Droplet-based**: Barcoding is performed on a per-droplet basis. Each droplet contains a bead carrying millions of copies of a unique barcode sequence. After cell lysis within the droplet, the released mRNAs are captured and tagged with this barcode. The collection of all barcodes across all beads is vast, allowing for the unique identification of tens of thousands of cells.\n\n3.  **Throughput**:\n    *   **Plate-based**: This approach has a relatively low throughput. The number of cells that can be processed is limited by the number of wells on the plate, typically ranging from a few dozen to a few thousand cells per experiment. The process is often more labor-intensive.\n    *   **Droplet-based**: This approach offers massive throughput. Microfluidic systems can generate thousands of droplets per second, enabling the simultaneous processing of tens of thousands to hundreds of thousands of cells in a single experiment with significantly less hands-on time per cell.\n\n4.  **Typical Trade-offs**:\n    *   **Plate-based** methods generally provide higher capture efficiency, meaning a larger fraction of the mRNA molecules from a single cell are captured and sequenced. This results in greater sequencing depth per cell and more sensitive detection of genes. It also allows for direct integration with cell imaging and easier targeting of rare cell populations via FACS. The primary trade-offs are significantly lower cell throughput, higher cost per cell, and greater manual labor.\n    *   **Droplet-based** methods prioritize cell throughput and lower cost per cell. The main trade-off is lower mRNA capture efficiency, leading to sparser data (fewer genes and unique molecules detected per cell). A critical challenge is the stochastic formation of \"doublets\" (droplets containing two or more cells), which can confound downstream analysis and must be controlled by limiting the cell concentration and computationally filtered.\n\nThe second part of the problem asks for a mathematical derivation.\nLet the random variable $X$ denote the number of cells encapsulated in a single droplet. According to the problem statement, $X$ follows a Poisson distribution with rate parameter $\\lambda$, where $\\lambda$ is the expected number of cells per droplet. The probability mass function (PMF) for $X$ is given by:\n$$P(X=k) = \\frac{\\lambda^k \\exp(-\\lambda)}{k!}, \\quad \\text{for } k \\in \\{0, 1, 2, \\dots\\}$$\nWe are asked to find the probability that a droplet contains at least two cells. This event is mathematically represented as $\\{X \\ge 2\\}$. The probability of this event is $P(X \\ge 2)$.\n\nIt is most straightforward to calculate this probability using the complement rule. The complement of the event $\\{X \\ge 2\\}$ is the event that a droplet contains fewer than two cells, i.e., $\\{X  2\\}$. The event $\\{X  2\\}$ can be partitioned into two disjoint events: $\\{X = 0\\}$ (the droplet is empty) and $\\{X = 1\\}$ (the droplet contains exactly one cell, a \"singlet\").\nTherefore, the probability of the complement is:\n$$P(X  2) = P(X=0) + P(X=1)$$\nUsing the PMF of the Poisson distribution:\nThe probability of a droplet being empty ($k=0$) is:\n$$P(X=0) = \\frac{\\lambda^0 \\exp(-\\lambda)}{0!} = \\frac{1 \\cdot \\exp(-\\lambda)}{1} = \\exp(-\\lambda)$$\nThe probability of a droplet containing a singlet ($k=1$) is:\n$$P(X=1) = \\frac{\\lambda^1 \\exp(-\\lambda)}{1!} = \\frac{\\lambda \\exp(-\\lambda)}{1} = \\lambda \\exp(-\\lambda)$$\nSumming these probabilities gives the probability of the complement event:\n$$P(X  2) = \\exp(-\\lambda) + \\lambda \\exp(-\\lambda) = (1+\\lambda)\\exp(-\\lambda)$$\nThe desired probability, $P(X \\ge 2)$, is $1$ minus the probability of the complement:\n$$P(X \\ge 2) = 1 - P(X  2) = 1 - (1+\\lambda)\\exp(-\\lambda)$$\nThis is the analytic expression for the probability of a droplet containing a doublet-or-higher as a function of $\\lambda$.\n\nFinally, we evaluate this expression for the given values of $\\lambda$.\n\nCase 1: $\\lambda = 0.1$\nThe probability is:\n$$P(X \\ge 2 | \\lambda=0.1) = 1 - (1+0.1)\\exp(-0.1) = 1 - 1.1 \\exp(-0.1)$$\nCalculating the value:\n$$P(X \\ge 2 | \\lambda=0.1) \\approx 1 - 1.1 \\times 0.904837418... = 1 - 0.995321159... \\approx 0.00467884...$$\nRounding to $4$ significant figures, we get $0.004679$.\n\nCase 2: $\\lambda = 0.2$\nThe probability is:\n$$P(X \\ge 2 | \\lambda=0.2) = 1 - (1+0.2)\\exp(-0.2) = 1 - 1.2 \\exp(-0.2)$$\nCalculating the value:\n$$P(X \\ge 2 | \\lambda=0.2) \\approx 1 - 1.2 \\times 0.818730753... = 1 - 0.982476903... \\approx 0.01752309...$$\nRounding to $4$ significant figures, we get $0.01752$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.004679  0.01752\n\\end{pmatrix}\n}\n$$", "id": "3321400"}, {"introduction": "After sequencing, a crucial step is to filter out low-quality data from cells that were damaged during sample preparation. This exercise moves beyond simple ad-hoc thresholds and introduces a principled approach using Bayesian decision theory to define an optimal cutoff for a key quality metric, the mitochondrial RNA fraction. By modeling healthy and damaged cells as a mixture distribution, you will derive a decision rule [@problem_id:5162677] that minimizes the expected misclassification cost, a powerful technique for robust data quality control.", "problem": "In single-cell ribonucleic acid sequencing, the mitochondrial messenger ribonucleic acid fraction, denoted by $x \\in [0,1]$, is widely used as a quality indicator because elevated mitochondrial transcript fractions are empirically associated with compromised membrane integrity and damaged cells. Consider a cohort where cells arise from two latent classes: healthy cells (class $H$) and damaged cells (class $D$). You will model the quality indicator using a mixture model and derive a Bayes-optimal decision boundary for excluding cells.\n\nAssume the following foundational elements:\n- The probability of a cell being healthy or damaged is given by prior probabilities $\\pi_{H}$ and $\\pi_{D}$ with $\\pi_{H}+\\pi_{D}=1$.\n- Misclassification losses are asymmetric: $\\lambda_{DH}$ is the loss incurred by excluding a healthy cell (deciding $D$ when true class is $H$), and $\\lambda_{HD}$ is the loss incurred by retaining a damaged cell (deciding $H$ when true class is $D$).\n- To map the bounded fraction into an unbounded scale suitable for a Gaussian model, use the logistic transform $y=\\ln\\!\\left(\\frac{x}{1-x}\\right)$.\n- Conditional on class, the transformed variable is approximately Gaussian: $y \\mid H \\sim \\mathcal{N}(\\mu_{H},\\sigma^{2})$ and $y \\mid D \\sim \\mathcal{N}(\\mu_{D},\\sigma^{2})$ with a common variance $\\sigma^{2}$.\n\nStarting from Bayes decision theory and the above assumptions, derive the analytical expression for the Bayes-optimal exclusion threshold $t^{\\star}$ on the original fraction scale, that is, the smallest value $t^{\\star} \\in (0,1)$ such that the rule “exclude a cell as damaged if and only if $x \\ge t^{\\star}$” minimizes expected loss.\n\nThen, for the scientifically realistic parameterization\n- $\\mu_{H}=-2.4$, $\\mu_{D}=-0.9$,\n- $\\sigma=0.55$,\n- $\\pi_{H}=0.85$, $\\pi_{D}=0.15$,\n- $\\lambda_{DH}=1$, $\\lambda_{HD}=3$,\nevaluate your derived expression numerically to obtain $t^{\\star}$.\n\nRound your final answer for $t^{\\star}$ to four significant figures. Express the final answer as a unitless fraction in $(0,1)$.", "solution": "The Bayes-optimal decision rule is to choose the action (exclude or retain) that minimizes the posterior expected loss for a given observation. We decide to exclude a cell as damaged (decision $D$) if the expected loss of excluding it is less than the expected loss of retaining it (decision $H$).\n$$ \\mathbb{E}[\\text{Loss} | \\text{decide } D, y]  \\mathbb{E}[\\text{Loss} | \\text{decide } H, y] $$\n$$ \\lambda_{DH} P(H | y)  \\lambda_{HD} P(D | y) $$\nUsing Bayes' rule, $P(\\text{class}|y) \\propto p(y|\\text{class}) \\pi_{\\text{class}}$, the decision boundary $y^\\star$ is the point where the costs are equal. This can be expressed as a likelihood ratio test:\n$$ \\frac{p(y^\\star | D)}{p(y^\\star | H)} = \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} $$\nSubstituting the Gaussian probability density functions for $p(y|D)$ and $p(y|H)$ and taking the natural logarithm of both sides gives:\n$$ \\frac{(y^\\star - \\mu_H)^2 - (y^\\star - \\mu_D)^2}{2\\sigma^2} = \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) $$\nSolving this equation for $y^\\star$ yields the optimal threshold on the logit-transformed scale:\n$$ y^{\\star} = \\frac{\\mu_D + \\mu_H}{2} + \\frac{\\sigma^2}{\\mu_D - \\mu_H} \\ln\\left( \\frac{\\lambda_{DH} \\pi_H}{\\lambda_{HD} \\pi_D} \\right) $$\nTo find the threshold $t^\\star$ on the original fraction scale $x$, we apply the inverse logistic function:\n$$ t^{\\star} = \\frac{1}{1 + \\exp(-y^{\\star})} $$\nNow, we substitute the given numerical values:\n- $\\mu_{H}=-2.4$, $\\mu_{D}=-0.9$\n- $\\sigma=0.55 \\implies \\sigma^2 = 0.3025$\n- $\\pi_{H}=0.85$, $\\pi_{D}=0.15$\n- $\\lambda_{DH}=1$, $\\lambda_{HD}=3$\n\nThe log-likelihood ratio term is:\n$$ \\ln\\left( \\frac{1 \\times 0.85}{3 \\times 0.15} \\right) = \\ln\\left(\\frac{0.85}{0.45}\\right) = \\ln\\left(\\frac{17}{9}\\right) \\approx 0.635988 $$\nThe difference in means is $\\mu_D - \\mu_H = -0.9 - (-2.4) = 1.5$.\nThe average of the means is $(\\mu_D + \\mu_H)/2 = (-0.9 - 2.4)/2 = -1.65$.\n\nPlugging these into the expression for $y^\\star$:\n$$ y^{\\star} = -1.65 + \\frac{0.3025}{1.5} \\ln\\left(\\frac{17}{9}\\right) \\approx -1.65 + (0.201667)(0.635988) \\approx -1.65 + 0.128264 \\approx -1.521736 $$\nFinally, we transform back to the original scale:\n$$ t^{\\star} = \\frac{1}{1 + \\exp(-(-1.521736))} = \\frac{1}{1 + \\exp(1.521736)} \\approx \\frac{1}{1 + 4.58015} \\approx 0.1792066 $$\nRounding to four significant figures, the optimal exclusion threshold is $0.1792$.", "answer": "$$\n\\boxed{0.1792}\n$$", "id": "5162677"}, {"introduction": "A primary goal of many scRNA-seq studies is to identify differentially expressed genes between conditions, but experiments involving multiple donors present a significant statistical challenge. This practice addresses the critical issue of pseudoreplication, where treating cells from the same donor as independent replicates can grossly inflate statistical significance. You will mathematically derive the correct variance structure using a mixed-effects model [@problem_id:5162658] and quantify the inflation of test statistics, providing a solid foundation for the sound analysis of hierarchical biological data.", "problem": "In a two-condition single-cell RNA sequencing (scRNA-seq) differential expression study in molecular and immunodiagnostics, cells are sampled from human donors, and gene expression is measured on a log-normalized scale. Let condition be encoded at the donor level by $x_{i} \\in \\{0,1\\}$ for donor $i$, with each donor contributing multiple cells. Consider a single gene whose cell-level expression for cell $j$ from donor $i$ is modeled additively by a donor-level offset and a cell-level residual, with all sources centered at zero. Assume the following facts as the fundamental base:\n- Linearity of expectation and the bilinearity of covariance.\n- For any finite collection of random variables, the variance of a sum equals the sum of variances plus twice the sum of pairwise covariances.\n- Donor-level offsets are independent across donors, residuals are independent across cells, and donor-level offsets are independent of residuals.\n\nYou are asked to analyze pseudoreplication when cells are treated as independent replicates and to derive the appropriate model and variance under donor-level random effects, then quantify the inflation of significance.\n\nSet up the following balanced design: there are $D_{0}$ donors in condition $x=0$ and $D_{1}$ donors in condition $x=1$, and each donor contributes exactly $m$ cells. Let the donor-level offsets $\\{b_{i}\\}$ be independent with mean $0$ and variance $\\sigma_{b}^{2}$, and let the cell-level residuals $\\{\\varepsilon_{ij}\\}$ be independent with mean $0$ and variance $\\sigma_{e}^{2}$, with $b_{i}$ independent of all $\\varepsilon_{ij}$. The observable cell-level expression is\n$$\ny_{ij}=\\mu+\\beta x_{i}+b_{i}+\\varepsilon_{ij}.\n$$\nThe naive cell-level analysis that ignores donor structure fits a fixed-effects regression of $y_{ij}$ on $x_{i}$ treating all cells as independent and identically distributed, whereas the correct analysis uses a mixed-effects model with a donor-level random intercept.\n\nTasks:\n1. Using only the variance-covariance properties stated above and the additive structure of $y_{ij}$, derive the variance of the group mean in each condition under the mixed-effects model and hence derive the variance of the estimator of the condition effect $\\beta$ as the difference of group means. Express your result symbolically in terms of $D_{0}$, $D_{1}$, $m$, $\\sigma_{b}^{2}$, and $\\sigma_{e}^{2}$.\n2. Under the naive cell-level analysis that treats all cells as independent with common variance, derive the corresponding variance of the same estimator of $\\beta$.\n3. Define the inflation factor for the $z$-statistic as $R_{z}=z_{\\text{naive}}/z_{\\text{mixed}}$, where $z_{\\text{naive}}$ uses the naive variance and $z_{\\text{mixed}}$ uses the mixed-effects variance. Derive a closed-form expression for $R_{z}$ in terms of $D_{0}$, $D_{1}$, $m$, $\\sigma_{b}^{2}$, and $\\sigma_{e}^{2}$.\n4. In a realistic scRNA-seq experiment with $D_{0}=6$, $D_{1}=6$, $m=100$, $\\sigma_{b}^{2}=0.5$, and $\\sigma_{e}^{2}=1$, evaluate $R_{z}$ exactly. Express the final ratio as an exact closed-form expression; do not round.", "solution": "The estimator for the condition effect $\\beta$ is the difference in the sample means between condition $x=1$ and condition $x=0$. Let $\\bar{y}_{1}$ and $\\bar{y}_{0}$ be the mean expression levels for all cells in condition $1$ and condition $0$, respectively. The estimator is thus $\\hat{\\beta} = \\bar{y}_{1} - \\bar{y}_{0}$. Since the donors in condition $0$ are independent of the donors in condition $1$, the random variables $\\bar{y}_{0}$ and $\\bar{y}_{1}$ are independent. Therefore, the variance of their difference is the sum of their variances:\n$$\n\\text{Var}(\\hat{\\beta}) = \\text{Var}(\\bar{y}_{1} - \\bar{y}_{0}) = \\text{Var}(\\bar{y}_{1}) + \\text{Var}(\\bar{y}_{0})\n$$\n\n### Task 1: Variance of $\\hat{\\beta}$ under the Mixed-Effects Model\n\nThe correct analysis accounts for the two-level structure of the data (cells nested within donors). First, we calculate the variance of the mean for a single condition (e.g., condition 1). The mean can be expressed as the average of donor-level means, $\\bar{y}_{1} = \\frac{1}{D_{1}} \\sum_{i \\in I_{1}} \\bar{y}_{i}$. The variance of a single donor's mean expression, $\\bar{y}_i$, is $\\text{Var}(\\bar{y}_{i}) = \\text{Var}(b_i) + \\text{Var}(\\bar{\\varepsilon}_i) = \\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}$. Since donor means are independent, the variance of the group mean is:\n$$\n\\text{Var}_{\\text{mixed}}(\\bar{y}_{1}) = \\text{Var}\\left(\\frac{1}{D_{1}} \\sum_{i \\in I_{1}} \\bar{y}_{i}\\right) = \\frac{D_{1}}{D_{1}^{2}} \\left(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\\right) = \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{1}}\n$$\nBy identical logic for condition $0$, the variance of its mean is $\\text{Var}_{\\text{mixed}}(\\bar{y}_{0}) = \\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{D_{0}}$.\nThus, the variance of the estimator $\\hat{\\beta}$ under the mixed-effects model is:\n$$\n\\text{Var}_{\\text{mixed}}(\\hat{\\beta}) = \\left(\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}\\right) \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)\n$$\n\n### Task 2: Variance of $\\hat{\\beta}$ under the Naive Model\n\nThe naive analysis incorrectly assumes all cells are independent replicates. Under this assumption, the total variance of a single observation is $\\text{Var}(y_{ij}) = \\sigma_{b}^{2} + \\sigma_{e}^{2}$. The naive model treats this as the variance of each of the $N_k = D_k m$ independent cells in group $k$. The variance of the group mean is the total variance divided by the number of cells.\n$$\n\\text{Var}_{\\text{naive}}(\\bar{y}_{1}) = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{1}m} \\quad \\text{and} \\quad \\text{Var}_{\\text{naive}}(\\bar{y}_{0}) = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{D_{0}m}\n$$\nThe variance of the estimator $\\hat{\\beta}$ under the naive model is the sum of these variances:\n$$\n\\text{Var}_{\\text{naive}}(\\hat{\\beta}) = \\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m} \\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)\n$$\n\n### Task 3: Inflation Factor $R_{z}$\n\nThe z-statistic is $z = \\hat{\\beta} / \\sqrt{\\text{Var}(\\hat{\\beta})}$. The inflation factor is the ratio of the naive z-statistic to the correct mixed-effects z-statistic:\n$$\nR_{z} = \\frac{z_{\\text{naive}}}{z_{\\text{mixed}}} = \\frac{\\hat{\\beta} / \\sqrt{\\text{Var}_{\\text{naive}}(\\hat{\\beta})}}{\\hat{\\beta} / \\sqrt{\\text{Var}_{\\text{mixed}}(\\hat{\\beta})}} = \\sqrt{\\frac{\\text{Var}_{\\text{mixed}}(\\hat{\\beta})}{\\text{Var}_{\\text{naive}}(\\hat{\\beta})}}\n$$\nSubstituting the expressions from Tasks 1 and 2, the term $\\left(\\frac{1}{D_{0}} + \\frac{1}{D_{1}}\\right)$ cancels out:\n$$\nR_{z} = \\sqrt{\\frac{\\sigma_{b}^{2} + \\frac{\\sigma_{e}^{2}}{m}}{\\frac{\\sigma_{b}^{2} + \\sigma_{e}^{2}}{m}}} = \\sqrt{\\frac{m \\sigma_{b}^{2} + \\sigma_{e}^{2}}{\\sigma_{b}^{2} + \\sigma_{e}^{2}}}\n$$\n\n### Task 4: Numerical Evaluation\n\nWe substitute the given values: $m=100$, $\\sigma_{b}^{2}=0.5$, and $\\sigma_{e}^{2}=1$.\n$$\nR_{z} = \\sqrt{\\frac{(100)(0.5) + 1}{0.5 + 1}}\n$$\n$$\nR_{z} = \\sqrt{\\frac{50 + 1}{1.5}} = \\sqrt{\\frac{51}{3/2}}\n$$\n$$\nR_{z} = \\sqrt{51 \\times \\frac{2}{3}} = \\sqrt{17 \\times 2} = \\sqrt{34}\n$$\nThis represents the factor by which the statistical significance (z-score) is inflated due to pseudoreplication.", "answer": "$$\n\\boxed{\\sqrt{34}}\n$$", "id": "5162658"}]}