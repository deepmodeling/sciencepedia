{"hands_on_practices": [{"introduction": "Effective management begins with accurate diagnosis, yet screening tools provide probabilities, not certainties. This exercise [@problem_id:4792591] applies the foundational principles of Bayesian inference to a common clinical scenario, using a patient's AUDIT-C score to calculate the post-test probability of Alcohol Use Disorder. Mastering this quantitative approach is essential for interpreting screening results correctly and making evidence-informed diagnostic judgments.", "problem": "An internal medicine clinic uses the Alcohol Use Disorders Identification Test-Consumption (AUDIT-C) to screen for Alcohol Use Disorder (AUD). In this clinicâ€™s adult patient population, the pretest probability of AUD is $0.15$. A cutoff score of $6$ defines a positive screen. At this threshold, for diagnosing AUD relative to a structured diagnostic interview, the AUDIT-C has sensitivity $0.70$ and specificity $0.90$. A patient screens positive with a score of $6$. Using only the foundational definitions of sensitivity, specificity, and conditional probability, together with the relationship between odds and probability, derive from first principles and then calculate the post-test probability $\\mathbb{P}(\\text{AUD} \\mid +)$, where $+$ denotes a positive test. Express the final answer as a decimal probability, rounded to four significant figures.", "solution": "The problem as stated is subjected to validation.\n\n### Step 1: Extract Givens\n- Pretest probability of Alcohol Use Disorder (AUD): $\\mathbb{P}(\\text{AUD}) = 0.15$\n- Cutoff score for a positive screen: $6$\n- Sensitivity of the test at this cutoff: $0.70$\n- Specificity of the test at this cutoff: $0.90$\n- A patient screens positive.\n- The task is to derive and calculate the post-test probability, $\\mathbb{P}(\\text{AUD} \\mid +)$, where $+$ denotes a positive test.\n- The final answer must be a decimal rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem uses standard, well-defined concepts from medical statistics and probability theory, namely sensitivity, specificity, pre-test probability (prevalence), and post-test probability. The values provided for sensitivity ($0.70$), specificity ($0.90$), and pre-test probability ($0.15$) are clinically realistic for the AUDIT-C screening tool in a primary care population. The problem is grounded in established medical diagnostic principles.\n- **Well-Posed:** The problem provides all necessary information to calculate a unique post-test probability. It is a classic application of Bayes' theorem.\n- **Objective:** The problem is stated using precise, unambiguous, and objective language.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, and objective. It contains no inconsistencies, ambiguities, or missing information. Therefore, the problem is deemed **valid**. The solution will proceed by deriving the post-test probability from first principles.\n\n### Derivation and Solution\nLet $D$ be the event that a patient has Alcohol Use Disorder (AUD), and let $D^c$ be the event that the patient does not have AUD. Let $+$ denote the event of a positive test result and $-$ denote the event of a negative test result.\n\nThe givens can be formally expressed as:\n- The pre-test probability of the disease, $\\mathbb{P}(D) = 0.15$.\n- The sensitivity of the test, which is the probability of a positive test given the presence of the disease: $\\mathbb{P}(+ \\mid D) = 0.70$.\n- The specificity of the test, which is the probability of a negative test given the absence of the disease: $\\mathbb{P}(- \\mid D^c) = 0.90$.\n\nFrom these givens, we can derive two additional probabilities:\n- The probability of not having the disease is the complement of having it: $\\mathbb{P}(D^c) = 1 - \\mathbb{P}(D) = 1 - 0.15 = 0.85$.\n- The probability of a positive test given the absence of the disease (the false positive rate) is the complement of the specificity: $\\mathbb{P}(+ \\mid D^c) = 1 - \\mathbb{P}(- \\mid D^c) = 1 - 0.90 = 0.10$.\n\nThe objective is to calculate the post-test probability, $\\mathbb{P}(D \\mid +)$. We will derive this from the foundational definition of conditional probability.\n\nThe definition of conditional probability states that for any two events $A$ and $B$, $\\mathbb{P}(A \\mid B) = \\frac{\\mathbb{P}(A \\cap B)}{\\mathbb{P}(B)}$. Applying this to our problem:\n$$\n\\mathbb{P}(D \\mid +) = \\frac{\\mathbb{P}(D \\cap +)}{\\mathbb{P}(+)}\n$$\nWe must find expressions for the numerator, $\\mathbb{P}(D \\cap +)$, and the denominator, $\\mathbb{P}(+)$.\n\nThe numerator, $\\mathbb{P}(D \\cap +)$, is the joint probability of having the disease and testing positive. It can be found by rearranging the definition of conditional probability: $\\mathbb{P}(D \\cap +) = \\mathbb{P}(+ \\mid D) \\mathbb{P}(D)$. This term represents the probability of a true positive result in the population.\n\nThe denominator, $\\mathbb{P}(+)$, is the total probability of a positive test. A positive test can occur in two mutually exclusive ways: a patient has the disease and tests positive (a true positive), or a patient does not have the disease and tests positive (a false positive). Using the law of total probability, we can express $\\mathbb{P}(+)$ as the sum of the probabilities of these two events:\n$$\n\\mathbb{P}(+) = \\mathbb{P}(D \\cap +) + \\mathbb{P}(D^c \\cap +)\n$$\nUsing the definition of conditional probability for each term, we get:\n$$\n\\mathbb{P}(+) = \\mathbb{P}(+ \\mid D) \\mathbb{P}(D) + \\mathbb{P}(+ \\mid D^c) \\mathbb{P}(D^c)\n$$\nNow, we substitute the expressions for the numerator and denominator back into the formula for $\\mathbb{P}(D \\mid +)$:\n$$\n\\mathbb{P}(D \\mid +) = \\frac{\\mathbb{P}(+ \\mid D) \\mathbb{P}(D)}{\\mathbb{P}(+ \\mid D) \\mathbb{P}(D) + \\mathbb{P}(+ \\mid D^c) \\mathbb{P}(D^c)}\n$$\nThis is the formal statement of Bayes' theorem for this context, derived from first principles.\n\nNow, we substitute the numerical values into this derived formula.\n- The numerator is $\\mathbb{P}(+ \\mid D) \\mathbb{P}(D) = (0.70) \\times (0.15) = 0.105$.\n- The denominator is $\\mathbb{P}(+ \\mid D) \\mathbb{P}(D) + \\mathbb{P}(+ \\mid D^c) \\mathbb{P}(D^c) = (0.70)(0.15) + (0.10)(0.85) = 0.105 + 0.085 = 0.190$.\n\nTherefore, the post-test probability is:\n$$\n\\mathbb{P}(D \\mid +) = \\frac{0.105}{0.190}\n$$\nCalculating the value:\n$$\n\\mathbb{P}(D \\mid +) = \\frac{105}{190} = \\frac{21}{38} \\approx 0.55263157...\n$$\nThe problem requires the answer to be rounded to four significant figures. The first four significant figures are $5$, $5$, $2$, and $6$. The fifth digit is $3$, so we do not round up.\nThe final calculated probability is $0.5526$.", "answer": "$$\\boxed{0.5526}$$", "id": "4792591"}, {"introduction": "Patients in severe alcohol withdrawal often arrive having received multiple benzodiazepine doses, creating a significant risk of oversedation with further treatment. This practice problem [@problem_id:4792622] challenges you to navigate this complexity by calculating a safe and effective lorazepam dose. You will synthesize concepts of equipotent dosing, drug half-lives, and first-order pharmacokinetics to determine the patient's current sedative load and supplement it appropriately.", "problem": "A hospitalized patient with severe Alcohol Use Disorder (AUD) withdrawal symptoms has already received multiple benzodiazepine doses before arrival. You are tasked with calculating a safe initial lorazepam dose to give now, using equipotent benzodiazepine equivalence and pharmacokinetic principles to account for residual on-board drug. Use the following well-tested facts as the fundamental base for your derivation:\n\n1. Equipotent benzodiazepine equivalence: $10\\,\\mathrm{mg}$ diazepam $\\equiv 25\\,\\mathrm{mg}$ chlordiazepoxide $\\equiv 2\\,\\mathrm{mg}$ lorazepam.\n2. First-order elimination for drug amount remaining at time $t$: if $D_{0}$ is the administered dose (in $\\mathrm{mg}$), the amount remaining is $D(t) = D_{0}\\,\\exp(-k t)$, where $k = \\ln(2)/t_{1/2}$ and $t_{1/2}$ is the elimination half-life.\n3. Elimination half-lives (assume single-compartment kinetics and complete bioavailability for the doses given below): diazepam $t_{1/2} = 36\\,\\mathrm{h}$, lorazepam $t_{1/2} = 12\\,\\mathrm{h}$, chlordiazepoxide $t_{1/2} = 10\\,\\mathrm{h}$.\n4. For severe withdrawal, a conservative, symptom-triggered protocol targets an initial cumulative diazepam-equivalent load of $S = 30\\,\\mathrm{mg}$ to achieve control of agitation and tremor without oversedation.\n5. In moderate hepatic impairment, reduce the calculated supplemental dose by a safety factor $s = 0.80$ to mitigate oversedation risk.\n6. To minimize oversedation risk in this patient with hepatic impairment, administer lorazepam rather than diazepam or chlordiazepoxide for the initial dose now, converting from the diazepam-equivalent supplemental requirement using the equivalence in item 1.\n\nPatient-specific data:\n- Prehospital and early Emergency Department benzodiazepine doses:\n  - Diazepam $10\\,\\mathrm{mg}$ intravenous at $t = -2\\,\\mathrm{h}$.\n  - Lorazepam $1\\,\\mathrm{mg}$ intravenous at $t = -1.5\\,\\mathrm{h}$.\n  - Chlordiazepoxide $25\\,\\mathrm{mg}$ oral at $t = -3\\,\\mathrm{h}$ (assume complete systemic availability by now).\n- Current time is $t = 0\\,\\mathrm{h}$.\n\nTasks:\n- Compute the residual diazepam-equivalent amount on board at $t=0\\,\\mathrm{h}$ from each prior dose using first-order elimination and the equipotent equivalence, and sum these to obtain $R$.\n- Compute the additional diazepam-equivalent amount needed as $S - R$ (if negative, set to $0$).\n- Apply the hepatic safety factor $s$ to this supplemental diazepam-equivalent requirement.\n- Convert the safety-adjusted diazepam-equivalent supplemental amount to a single lorazepam dose to administer now, using the equipotent equivalence above. For this calculation, do not exceed a single-dose cap of $4\\,\\mathrm{mg}$ lorazepam; if your computed dose exceeds this cap, use the cap instead.\n- Round your final lorazepam dose to three significant figures. Express your final answer in $\\mathrm{mg}$ of lorazepam.", "solution": "We proceed from the provided fundamental pharmacologic facts and equivalence relationships. The goal is to determine a single lorazepam dose now that safely supplements the residual benzodiazepine effect to reach the target diazepam-equivalent load $S = 30\\,\\mathrm{mg}$, then reduce by the safety factor $s = 0.80$ and convert to lorazepam using the equipotent equivalence.\n\nStep 1: Compute residual amounts for each administered benzodiazepine at $t=0\\,\\mathrm{h}$ using first-order elimination $D(t) = D_{0}\\,\\exp(-k t)$ with $k = \\ln(2)/t_{1/2}$.\n\n1. Diazepam:\n- Administered dose $D_{0,\\mathrm{dia}} = 10\\,\\mathrm{mg}$ at $t = -2\\,\\mathrm{h}$.\n- Half-life $t_{1/2,\\mathrm{dia}} = 36\\,\\mathrm{h}$, so $k_{\\mathrm{dia}} = \\ln(2)/36$.\n- Residual diazepam amount:\n$$D_{\\mathrm{dia}}(0) = 10\\,\\exp\\!\\left(-\\frac{\\ln(2)}{36}\\cdot 2\\right) = 10\\,\\exp\\!\\left(-\\frac{\\ln(2)}{18}\\right) = 10 \\cdot 2^{-1/18}.$$\nSince diazepam itself defines the diazepam-equivalent, its residual diazepam-equivalent contribution is simply\n$$R_{\\mathrm{dia}} = 10 \\cdot \\exp\\!\\left(-\\frac{\\ln(2)}{18}\\right).$$\n\n2. Lorazepam:\n- Administered dose $D_{0,\\mathrm{lor}} = 1\\,\\mathrm{mg}$ at $t = -1.5\\,\\mathrm{h}$.\n- Half-life $t_{1/2,\\mathrm{lor}} = 12\\,\\mathrm{h}$, so $k_{\\mathrm{lor}} = \\ln(2)/12$.\n- Residual lorazepam amount:\n$$D_{\\mathrm{lor}}(0) = 1\\,\\exp\\!\\left(-\\frac{\\ln(2)}{12}\\cdot 1.5\\right) = \\exp\\!\\left(-\\frac{\\ln(2)}{8}\\right) = 2^{-1/8}.$$\n- Convert residual lorazepam to diazepam-equivalents using the equipotent ratio $2\\,\\mathrm{mg}$ lorazepam $\\equiv 10\\,\\mathrm{mg}$ diazepam, i.e., $1\\,\\mathrm{mg}$ lorazepam $\\equiv 5\\,\\mathrm{mg}$ diazepam:\n$$R_{\\mathrm{lor}} = 5 \\cdot D_{\\mathrm{lor}}(0) = 5 \\cdot \\exp\\!\\left(-\\frac{\\ln(2)}{8}\\right) = 5 \\cdot 2^{-1/8}.$$\n\n3. Chlordiazepoxide:\n- Administered dose $D_{0,\\mathrm{clo}} = 25\\,\\mathrm{mg}$ at $t = -3\\,\\mathrm{h}$.\n- Half-life $t_{1/2,\\mathrm{clo}} = 10\\,\\mathrm{h}$, so $k_{\\mathrm{clo}} = \\ln(2)/10$.\n- Residual chlordiazepoxide amount:\n$$D_{\\mathrm{clo}}(0) = 25\\,\\exp\\!\\left(-\\frac{\\ln(2)}{10}\\cdot 3\\right) = 25\\,\\exp\\!\\left(-\\frac{3\\,\\ln(2)}{10}\\right) = 25 \\cdot 2^{-3/10}.$$\n- Convert residual chlordiazepoxide to diazepam-equivalents using the equipotent ratio $25\\,\\mathrm{mg}$ chlordiazepoxide $\\equiv 10\\,\\mathrm{mg}$ diazepam, i.e., multiply by $10/25 = 0.4$:\n$$R_{\\mathrm{clo}} = 0.4 \\cdot D_{\\mathrm{clo}}(0) = 0.4 \\cdot 25 \\cdot 2^{-3/10} = 10 \\cdot 2^{-3/10}.$$\n\nSum the residual diazepam-equivalents:\n$$R = R_{\\mathrm{dia}} + R_{\\mathrm{lor}} + R_{\\mathrm{clo}} = 10 \\cdot 2^{-1/18} + 5 \\cdot 2^{-1/8} + 10 \\cdot 2^{-3/10}.$$\n\nStep 2: Compute the supplemental diazepam-equivalent requirement:\n$$\\Delta = S - R.$$\nIf $\\Delta < 0$, set $\\Delta = 0$; otherwise use the positive value. With the provided values, we will find $\\Delta > 0$.\n\nStep 3: Apply the hepatic safety factor $s = 0.80$ to reduce the supplemental requirement:\n$$\\Delta_{s} = s \\cdot \\Delta.$$\n\nStep 4: Convert $\\Delta_{s}$ (diazepam-equivalents) to a lorazepam dose using the equipotent relationship $10\\,\\mathrm{mg}$ diazepam $\\equiv 2\\,\\mathrm{mg}$ lorazepam, i.e., multiply by the factor $2/10 = 0.2$:\n$$D_{\\mathrm{lor,init}} = 0.2 \\cdot \\Delta_{s}.$$\nIf $D_{\\mathrm{lor,init}} > 4\\,\\mathrm{mg}$, cap at $4\\,\\mathrm{mg}$; otherwise, use $D_{\\mathrm{lor,init}}$ as calculated.\n\nNow compute numerically.\n\nEvaluate each residual term using $\\ln(2) \\approx 0.6931471805599453$:\n- Diazepam residual factor:\n$$2^{-1/18} = \\exp\\!\\left(-\\frac{\\ln(2)}{18}\\right) \\approx \\exp(-0.0385081767) \\approx 0.962233,$$\nso\n$$R_{\\mathrm{dia}} \\approx 10 \\times 0.962233 = 9.62233.$$\n- Lorazepam residual factor:\n$$2^{-1/8} = \\exp\\!\\left(-\\frac{\\ln(2)}{8}\\right) \\approx \\exp(-0.0866433976) \\approx 0.917006,$$\nso\n$$R_{\\mathrm{lor}} \\approx 5 \\times 0.917006 = 4.58503.$$\n- Chlordiazepoxide residual factor:\n$$2^{-3/10} = \\exp\\!\\left(-\\frac{3\\,\\ln(2)}{10}\\right) \\approx \\exp(-0.2079441542) \\approx 0.812194,$$\nso\n$$R_{\\mathrm{clo}} \\approx 10 \\times 0.812194 = 8.12194.$$\n\nSum:\n$$R \\approx 9.62233 + 4.58503 + 8.12194 = 22.32930.$$\n\nCompute supplemental requirement:\n$$\\Delta = S - R = 30 - 22.32930 = 7.67070.$$\n\nApply safety factor:\n$$\\Delta_{s} = 0.80 \\times 7.67070 = 6.13656.$$\n\nConvert to lorazepam dose:\n$$D_{\\mathrm{lor,init}} = 0.2 \\times 6.13656 = 1.22731.$$\n\nCheck cap of $4\\,\\mathrm{mg}$: $1.22731 < 4$, so no capping is needed.\n\nRound to three significant figures:\n$$D_{\\mathrm{lor,init}} \\approx 1.23.$$\n\nThus, the safe initial lorazepam dose to give now is $1.23\\,\\mathrm{mg}$.", "answer": "$$\\boxed{1.23}$$", "id": "4792622"}, {"introduction": "Moving beyond single-dose calculations, the ultimate goal of systematic care is a robust, adaptive treatment protocol. This advanced exercise [@problem_id:4792635] guides you through the design of a complete, symptom-triggered dosing algorithm from first principles. By translating clinical goals and safety constraints into a mathematical framework, you will learn to construct a protocol that balances efficacy against the risks of oversedation and cumulative toxicity.", "problem": "You are asked to design and implement a deterministic titration algorithm for symptom-triggered benzodiazepine dosing in alcohol withdrawal that balances two competing goals: minimizing oversedation and preventing breakthrough withdrawal symptoms. The algorithm must operate on purely mathematical quantities and be derived from well-accepted fundamentals: first-order elimination kinetics, linear pharmacodynamic slopes near a working point, symptom-targeted control toward a band of Clinical Institute Withdrawal Assessment for Alcohol scale, revised (CIWA-Ar) scores, and hard dose caps to reflect safety constraints. The algorithm should produce a recommended single dose in milligrams for each test case, based on the current CIWA-Ar score and the dosing history. Your program must compute and print these recommendations for a small test suite.\n\nFundamental base and assumptions:\n- The current symptom severity is represented by a CIWA-Ar score denoted by $c_t$ (unitless).\n- The target symptom band is defined by a lower bound $c_L$ and an upper bound $c_U$, with a target center $c^\\star$ in the middle. Use $c_L=8$, $c_U=12$, and $c^\\star=10$.\n- The symptom response to a small dose increment is approximated linearly near the working point; each milligram reduces the next-assessment CIWA-Ar by a constant slope $k_c$ (unit: CIWA-Ar points per milligram). Use $k_c=2.5$.\n- Sedation risk is modeled via an effect-compartment index $e_t$ that increases linearly with administered milligrams and decays by first-order elimination. Each milligram increases the index by $k_e$ (unitless per milligram), and the index decays with half-life $t_{1/2}$ according to standard first-order elimination. Use $k_e=1$ and $t_{1/2}=14$ hours. Specifically, a dose $d_i$ given $h_i$ hours ago contributes $k_e d_i 2^{-h_i/t_{1/2}}$ to $e_t$.\n- A hard oversedation ceiling is imposed: $e_t$ must not exceed $e_{\\max}$. Use $e_{\\max}=8$.\n- Dose caps are enforced as hard constraints: a single-dose maximum $D_{\\text{single}}$, a rolling $1$-hour cumulative maximum $D_{1\\text{h}}$, and a rolling $6$-hour cumulative maximum $D_{6\\text{h}}$. Use $D_{\\text{single}}=4$ milligrams, $D_{1\\text{h}}=8$ milligrams, and $D_{6\\text{h}}=24$ milligrams. For the rolling windows, include doses administered at times $h_i$ satisfying $h_i \\le 1$ for the $1$-hour window and $h_i \\le 6$ for the $6$-hour window.\n- To prevent breakthrough symptoms at high severity, impose a rescue policy: if $c_t \\ge c_{\\text{break}}$, the recommended dose should not be less than a minimal rescue dose $d_{\\text{rescue}}$ unless restricted by a safety constraint. Use $c_{\\text{break}}=20$ and $d_{\\text{rescue}}=2$ milligrams.\n\nDerivation target and required algorithmic form:\n- Use the linear pharmacodynamic symptom model to compute an ideal unconstrained dose that centers the expected next CIWA-Ar score near $c^\\star$, then apply safety constraints in a principled order.\n- Let $d$ denote the next single dose in milligrams. The predicted next-assessment symptom level is modeled as $c_{t+} = c_t - k_c d$. Choose $d$ to minimize deviation from the target center while avoiding oversedation by enforcing that $e_t + k_e d \\le e_{\\max}$ and that hard cumulative dose caps are not exceeded.\n- Compute the following intermediate quantities:\n  1. The effect-compartment index $e_t = \\sum_i k_e d_i 2^{-h_i/t_{1/2}}$, where $d_i$ are prior doses and $h_i$ are hours since each dose.\n  2. The remaining allowances from caps: $A_{\\text{single}} = D_{\\text{single}}$, $A_{1\\text{h}} = \\max\\{0, D_{1\\text{h}} - \\sum_{h_i \\le 1} d_i\\}$, and $A_{6\\text{h}} = \\max\\{0, D_{6\\text{h}} - \\sum_{h_i \\le 6} d_i\\}$. The aggregate cap allowance is $A_{\\text{cap}} = \\min\\{A_{\\text{single}}, A_{1\\text{h}}, A_{6\\text{h}}\\}$.\n  3. The ideal unconstrained dose toward the target center: $d_{\\text{ideal}} = \\max\\{0, (c_t - c^\\star)/k_c\\}$.\n  4. The sedation-limited allowance: $A_{\\text{sed}} = \\max\\{0, (e_{\\max} - e_t)/k_e\\}$.\n- The primary recommended dose before rescue logic is $d_0 = \\min\\{d_{\\text{ideal}}, A_{\\text{sed}}, A_{\\text{cap}}\\}$.\n- The rescue rule is then applied: if $c_t \\ge c_{\\text{break}}$ and $d_0  d_{\\text{rescue}}$, set the final dose to $d = \\min\\{d_{\\text{rescue}}, A_{\\text{sed}}, A_{\\text{cap}}\\}$; otherwise $d = d_0$.\n- The algorithm must output $d$ in milligrams, rounded to one decimal place.\n\nInput representation and test suite:\n- Each test case is a pair $(c_t, \\mathcal{H})$ where $c_t$ is the current CIWA-Ar score (unitless), and $\\mathcal{H}$ is a list of prior doses with their times as $(d_i, h_i)$, where $d_i$ is in milligrams and $h_i$ is in hours before the current time. The present time is $h=0$ by convention. All $h_i$ are nonnegative real numbers.\n- Use the following test suite of six cases to exercise the algorithm across different regimes. For each case, compute the recommended dose $d$ in milligrams (rounded to one decimal place):\n  1. Case A (happy path, moderate symptoms, no prior doses): $c_t=18$, $\\mathcal{H}=[]$.\n  2. Case B (already on target, no dosing): $c_t=10$, $\\mathcal{H}=[]$.\n  3. Case C (severe symptoms but near oversedation from recent dosing): $c_t=24$, $\\mathcal{H}=[(4.0,1.0),(4.0,2.0)]$.\n  4. Case D (hourly cap binding): $c_t=22$, $\\mathcal{H}=[(7.5,0.5)]$.\n  5. Case E (six-hour cap strongly binding and high residual effect): $c_t=21$, $\\mathcal{H}=[(10.0,5.0),(8.0,3.0),(5.5,1.0)]$.\n  6. Case F (boundary of lower target): $c_t=8$, $\\mathcal{H}=[]$.\n\nAngle units are not applicable. All dose outputs must be expressed in milligrams and rounded to one decimal place. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\") in the same order as the listed test cases.", "solution": "We construct a principled algorithm by integrating basic pharmacokinetics and control objectives. The derivation starts from the following fundamentals.\n\nFirst-order elimination law for the effect compartment: If $x(t)$ denotes an effect-compartment proxy, then under first-order elimination and instantaneous input, the contribution of a dose $d_i$ administered at time $t_i$ to the current effect $x(t)$ at time $t$ is proportional to $d_i \\,\\exp(-k (t - t_i))$, where $k$ is the elimination rate constant. The half-life $t_{1/2}$ satisfies $t_{1/2} = (\\ln 2)/k$, hence $\\exp(-k \\Delta t) = 2^{-\\Delta t / t_{1/2}}$ for lag $\\Delta t$. We adopt an effect index $e_t$ that sums individual contributions scaled by a pharmacodynamic slope $k_e$:\n$$\ne_t = \\sum_i k_e\\, d_i\\, 2^{-h_i/t_{1/2}},\n$$\nwhere $h_i$ is the time in hours since dose $d_i$.\n\nLinearized pharmacodynamics near a working point: For small changes near a working point, the assumed next-assessment CIWA-Ar response to dose $d$ may be approximated as\n$$\nc_{t+} \\approx c_t - k_c\\, d,\n$$\nwhere $k_c$ is a positive slope in units of CIWA-Ar points per milligram.\n\nControl objective: We steer $c_{t+}$ toward a target center $c^\\star$ within a tolerable band $[c_L, c_U]$. A simple convex surrogate loss is the squared deviation $(c_{t+} - c^\\star)^2$, minimized subject to hard safety constraints. Because the surrogate and constraints are separable in the single decision variable $d$, the unconstrained minimizer is given by differentiating the quadratic surrogate with respect to $d$, yielding an ideal target dose\n$$\nd_{\\text{ideal}} = \\max\\{0, (c_t - c^\\star)/k_c\\}.\n$$\nThe nonnegativity constraint arises from the irreversibility of dosing.\n\nSafety constraints: We must enforce\n1. Oversedation ceiling $e_t + k_e\\, d \\le e_{\\max}$, which rearranges to a sedation-limited allowance\n$$\nA_{\\text{sed}} = \\max\\{0, (e_{\\max} - e_t)/k_e\\}.\n$$\n2. Cumulative dose caps: For a single dose, $d \\le D_{\\text{single}}$; in the last $1$ hour, total dose (including $d$) must satisfy\n$$\n\\sum_{h_i \\le 1} d_i + d \\le D_{1\\text{h}},\n$$\nand in the last $6$ hours,\n$$\n\\sum_{h_i \\le 6} d_i + d \\le D_{6\\text{h}}.\n$$\nThese imply remaining allowances\n$$\nA_{1\\text{h}} = \\max\\{0, D_{1\\text{h}} - \\sum_{h_i \\le 1} d_i\\}, \\quad\nA_{6\\text{h}} = \\max\\{0, D_{6\\text{h}} - \\sum_{h_i \\le 6} d_i\\},\n$$\nand $A_{\\text{single}} = D_{\\text{single}}$. The cap-limited allowance is\n$$\nA_{\\text{cap}} = \\min\\{A_{\\text{single}}, A_{1\\text{h}}, A_{6\\text{h}}\\}.\n$$\n\nPrimary recommendation: The constrained minimizer under independent upper bounds collapses to clamping the unconstrained minimizer to the most restrictive allowance,\n$$\nd_0 = \\min\\{d_{\\text{ideal}}, A_{\\text{sed}}, A_{\\text{cap}}\\}.\n$$\nThis follows from the monotonicity of $c_{t+}$ in $d$ and the convexity of the surrogate objective.\n\nRescue policy: To reduce risk of breakthrough symptoms at high severity, we require a minimal intervention if severity exceeds a break point, provided that safety constraints are not violated. With $c_{\\text{break}}$ and $d_{\\text{rescue}}$ given, define\n$$\nd =\n\\begin{cases}\n\\min\\{d_{\\text{rescue}}, A_{\\text{sed}}, A_{\\text{cap}}\\},  \\text{if } c_t \\ge c_{\\text{break}} \\text{ and } d_0  d_{\\text{rescue}}, \\\\\nd_0,  \\text{otherwise}.\n\\end{cases}\n$$\nThis preserves the oversedation ceiling and dose caps.\n\nParameterization: Use $c_L=8$, $c_U=12$, and $c^\\star=10$; $k_c=2.5$; $k_e=1$; $t_{1/2}=14$ hours; $e_{\\max}=8$; $D_{\\text{single}}=4$ milligrams; $D_{1\\text{h}}=8$ milligrams; $D_{6\\text{h}}=24$ milligrams; $c_{\\text{break}}=20$; and $d_{\\text{rescue}}=2$ milligrams. For computing $e_t$, use the exact binary-decay form $2^{-h_i/t_{1/2}}$.\n\nAlgorithmic procedure for one test case $(c_t, \\mathcal{H})$:\n1. Compute $e_t \\leftarrow \\sum_{(d_i,h_i)\\in \\mathcal{H}} k_e\\, d_i\\, 2^{-h_i/t_{1/2}}$.\n2. Compute rolling sums $S_{1\\text{h}} \\leftarrow \\sum_{h_i \\le 1} d_i$ and $S_{6\\text{h}} \\leftarrow \\sum_{h_i \\le 6} d_i$.\n3. Compute allowances $A_{1\\text{h}} \\leftarrow \\max\\{0, D_{1\\text{h}} - S_{1\\text{h}}\\}$, $A_{6\\text{h}} \\leftarrow \\max\\{0, D_{6\\text{h}} - S_{6\\text{h}}\\}$, $A_{\\text{single}} \\leftarrow D_{\\text{single}}$, and $A_{\\text{cap}} \\leftarrow \\min\\{A_{\\text{single}}, A_{1\\text{h}}, A_{6\\text{h}}\\}$.\n4. Compute $d_{\\text{ideal}} \\leftarrow \\max\\{0, (c_t - c^\\star)/k_c\\}$ and $A_{\\text{sed}} \\leftarrow \\max\\{0, (e_{\\max} - e_t)/k_e\\}$.\n5. Set $d_0 \\leftarrow \\min\\{d_{\\text{ideal}}, A_{\\text{sed}}, A_{\\text{cap}}\\}$.\n6. If $c_t \\ge c_{\\text{break}}$ and $d_0  d_{\\text{rescue}}$, set $d \\leftarrow \\min\\{d_{\\text{rescue}}, A_{\\text{sed}}, A_{\\text{cap}}\\}$; else set $d \\leftarrow d_0$.\n7. Round $d$ to one decimal place.\n\nThis algorithm is directly implementable. Applying it to the specified test suite yields the final outputs. The final program must produce a single line containing a Python-like list of the six dose recommendations, in milligrams, rounded to one decimal place, in the order of the cases A through F.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef decay_factor(hours: float, half_life: float) - float:\n    \"\"\"\n    First-order elimination with half-life: fraction remaining after 'hours'.\n    Uses the identity exp(-k t) = 2^{-t / t_half}.\n    \"\"\"\n    return 2.0 ** (-hours / half_life)\n\ndef compute_effect_index(history, k_e: float, half_life: float) - float:\n    \"\"\"\n    Sum of effect-compartment contributions from history.\n    history: list of (dose_mg, hours_ago)\n    \"\"\"\n    e = 0.0\n    for d_i, h_i in history:\n        e += k_e * d_i * decay_factor(h_i, half_life)\n    return e\n\ndef compute_window_sums(history, window_hours: float) - float:\n    \"\"\"\n    Sum of doses within a rolling window, including doses given exactly at the boundary (=).\n    \"\"\"\n    total = 0.0\n    for d_i, h_i in history:\n        if h_i = window_hours:\n            total += d_i\n    return total\n\ndef recommend_dose(ciwa: float, history):\n    # Parameters (units noted in comments)\n    c_L = 8.0        # CIWA lower bound (unitless)\n    c_U = 12.0       # CIWA upper bound (unitless)\n    c_star = 10.0    # CIWA target center (unitless)\n    k_c = 2.5        # CIWA points reduced per mg\n    k_e = 1.0        # effect index increment per mg (unitless)\n    t_half = 14.0    # hours\n    e_max = 8.0      # effect index ceiling (unitless)\n    D_single = 4.0   # mg\n    D_1h = 8.0       # mg per 1 hour rolling window\n    D_6h = 24.0      # mg per 6 hour rolling window\n    c_break = 20.0   # CIWA threshold for rescue\n    d_rescue = 2.0   # mg minimal rescue dose\n\n    # Compute effect index\n    e_t = compute_effect_index(history, k_e, t_half)\n\n    # Compute cumulative doses in windows\n    S_1h = compute_window_sums(history, 1.0)\n    S_6h = compute_window_sums(history, 6.0)\n\n    # Remaining allowances from caps\n    A_single = D_single\n    A_1h = max(0.0, D_1h - S_1h)\n    A_6h = max(0.0, D_6h - S_6h)\n    A_cap = min(A_single, A_1h, A_6h)\n\n    # Ideal dose toward target center (nonnegative)\n    d_ideal = max(0.0, (ciwa - c_star) / k_c)\n\n    # Sedation-limited allowance\n    A_sed = max(0.0, (e_max - e_t) / k_e)\n\n    # Primary constrained recommendation\n    d0 = min(d_ideal, A_sed, A_cap)\n\n    # Rescue policy for high severity\n    if ciwa = c_break and d0  d_rescue:\n        d = min(d_rescue, A_sed, A_cap)\n    else:\n        d = d0\n\n    # Round to one decimal place\n    d_rounded = float(f\"{d:.1f}\")\n    return d_rounded\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (current_CIWA, history=[(dose_mg, hours_ago), ...])\n    test_cases = [\n        (18.0, []),                                      # Case A\n        (10.0, []),                                      # Case B\n        (24.0, [(4.0, 1.0), (4.0, 2.0)]),                # Case C\n        (22.0, [(7.5, 0.5)]),                            # Case D\n        (21.0, [(10.0, 5.0), (8.0, 3.0), (5.5, 1.0)]),   # Case E\n        (8.0, []),                                       # Case F\n    ]\n\n    results = []\n    for ciwa, history in test_cases:\n        result = recommend_dose(ciwa, history)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "4792635"}]}