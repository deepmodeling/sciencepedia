{"hands_on_practices": [{"introduction": "Detecting circulating tumor cells (CTCs) is a primary challenge in liquid biopsy due to their extreme rarity. The Poisson distribution provides a powerful statistical framework for modeling these rare, randomly distributed events within a blood sample. This foundational exercise guides you through deriving the relationship between mean CTC concentration $\\lambda$, sampled blood volume $V$, and the probability of detection, a critical skill for designing and interpreting CTC assays.", "problem": "A translational medicine team is designing a liquid biopsy protocol to detect Circulating Tumor Cells (CTCs). In this protocol, a test is deemed positive if at least one CTC is present in a sampled blood volume. Assume CTCs are spatially homogeneous in peripheral blood and that counts in disjoint volume elements are independent, so that the number of CTCs observed in a sampled volume follows a Poisson distribution. Let the mean CTC concentration be $\\lambda$ cells per milliliter and let the sampled blood volume be $V$ milliliters. Starting from the standard definition of the Poisson distribution, derive the detection probability as a function of $\\lambda$ and $V$, defined as the probability that the sample contains at least one CTC. Then, for a patient with mean CTC concentration $\\lambda = 0.20$ cells/milliliter, compute the minimal sampled volume $V_{\\text{min}}$ required to achieve a detection probability of $p^{\\ast} = 0.95$. Express the final volume in milliliters and round your answer to four significant figures.", "solution": "The problem statement is assessed to be valid as it is scientifically grounded, self-contained, well-posed, objective, and its premises are consistent with standard practices in statistical modeling for biomedical applications.\n\nThe problem asks for two results: first, a derivation of the detection probability for Circulating Tumor Cells (CTCs) as a function of their mean concentration $\\lambda$ and the sampled blood volume $V$; second, the calculation of the minimal volume $V_{\\text{min}}$ required to achieve a specific detection probability.\n\nLet $X$ be the random variable representing the number of CTCs found in a blood sample of volume $V$. The problem states that CTCs are spatially homogeneous and counts in disjoint volumes are independent, warranting the use of a Poisson distribution to model $X$.\n\nThe mean concentration of CTCs is given as $\\lambda$ in units of cells per milliliter. Therefore, the mean number of CTCs, $\\mu$, in a sample of volume $V$ (in milliliters) is given by the product:\n$$ \\mu = \\lambda V $$\nThe number of events $X$ in this volume is assumed to follow a Poisson distribution with mean $\\mu$. The probability mass function (PMF) for $X$ is:\n$$ P(X=k) = \\frac{\\mu^k \\exp(-\\mu)}{k!} \\quad \\text{for } k \\in \\{0, 1, 2, ...\\} $$\n\nThe detection probability, which we can denote as $p_{\\text{detect}}$, is defined as the probability that at least one CTC is present in the sample. This corresponds to the event $X \\ge 1$. A direct calculation of $P(X \\ge 1) = P(X=1) + P(X=2) + \\dots$ would involve an infinite series. It is more straightforward to use the complement rule: the probability of finding at least one CTC is $1$ minus the probability of finding zero CTCs.\n$$ p_{\\text{detect}} = P(X \\ge 1) = 1 - P(X=0) $$\nWe find $P(X=0)$ by substituting $k=0$ into the Poisson PMF:\n$$ P(X=0) = \\frac{\\mu^0 \\exp(-\\mu)}{0!} $$\nUsing the standard definitions $\\mu^0=1$ (for $\\mu>0$) and $0!=1$, this simplifies to:\n$$ P(X=0) = \\exp(-\\mu) $$\nSubstituting this result back into the expression for the detection probability, we get:\n$$ p_{\\text{detect}} = 1 - \\exp(-\\mu) $$\nFinally, expressing this probability as a function of the given parameters $\\lambda$ and $V$ by substituting $\\mu = \\lambda V$, we arrive at the first required result:\n$$ p_{\\text{detect}}(\\lambda, V) = 1 - \\exp(-\\lambda V) $$\n\nFor the second part of the problem, we need to calculate the minimal sampled volume, $V_{\\text{min}}$, required to achieve a detection probability of $p^{\\ast} = 0.95$. The mean CTC concentration is given as $\\lambda = 0.20$ cells/milliliter.\n\nWe set the detection probability equal to the target probability $p^{\\ast}$:\n$$ p_{\\text{detect}}(\\lambda, V_{\\text{min}}) = p^{\\ast} $$\n$$ 1 - \\exp(-\\lambda V_{\\text{min}}) = p^{\\ast} $$\nWe now solve this equation for $V_{\\text{min}}$. First, isolate the exponential term:\n$$ \\exp(-\\lambda V_{\\text{min}}) = 1 - p^{\\ast} $$\nNext, take the natural logarithm ($\\ln$) of both sides of the equation:\n$$ \\ln(\\exp(-\\lambda V_{\\text{min}})) = \\ln(1 - p^{\\ast}) $$\n$$ -\\lambda V_{\\text{min}} = \\ln(1 - p^{\\ast}) $$\nFinally, isolate $V_{\\text{min}}$:\n$$ V_{\\text{min}} = -\\frac{\\ln(1 - p^{\\ast})}{\\lambda} $$\nNow we substitute the given numerical values, $\\lambda = 0.20$ and $p^{\\ast} = 0.95$:\n$$ V_{\\text{min}} = -\\frac{\\ln(1 - 0.95)}{0.20} $$\n$$ V_{\\text{min}} = -\\frac{\\ln(0.05)}{0.20} $$\nUsing the logarithmic property $-\\ln(x) = \\ln(1/x)$, we have $-\\ln(0.05) = \\ln(1/0.05) = \\ln(20)$. Thus, the expression becomes:\n$$ V_{\\text{min}} = \\frac{\\ln(20)}{0.20} $$\nTo obtain the final numerical answer, we compute the value of this expression:\n$$ \\ln(20) \\approx 2.99573227355... $$\n$$ V_{\\text{min}} \\approx \\frac{2.99573227355}{0.20} \\approx 14.9786613677... $$\nThe problem requires the answer to be expressed in milliliters and rounded to four significant figures. The first four significant figures of the result are $1$, $4$, $9$, and $7$. The fifth significant figure is $8$, which is greater than or equal to $5$, so we round up the fourth significant figure.\n$$ V_{\\text{min}} \\approx 14.98 $$\nThe minimal required volume is $14.98$ milliliters.", "answer": "$$\\boxed{14.98}$$", "id": "5026710"}, {"introduction": "Once a CTC assay is established, the next critical step is to determine its clinical value as a biomarker. This practice simulates a common scenario in translational research where you must evaluate a CTC-based test's ability to predict patient response to therapy. By calculating the positive and negative predictive values from hypothetical trial data, you will gain hands-on experience in quantifying the performance of a biomarker in a clinical context.", "problem": "A translational study evaluates whether early changes in circulating tumor cells (CTCs) measured by a standardized immunomagnetic capture assay can predict radiographic response at week $12$ by Response Evaluation Criteria in Solid Tumors (RECIST). The assay quantifies CTCs in $7.5\\,\\mathrm{mL}$ of peripheral blood at baseline (pre-treatment) and on day $14$ after initiating systemic therapy. A predefined biomarker response criterion is set as follows: patients who start with an unfavorable baseline (baseline CTC count $\\geq 5$ per $7.5\\,\\mathrm{mL}$) and demonstrate conversion to a favorable level (day-$14$ CTC count $< 5$ per $7.5\\,\\mathrm{mL}$) are considered test-positive; those who do not convert are considered test-negative. Only patients with baseline CTC count $\\geq 5$ per $7.5\\,\\mathrm{mL}$ are included in this analysis.\n\nIn a cohort of $180$ such patients, $68$ met the conversion criterion at day $14$ and $112$ did not. By week $12$ imaging, $51$ of the $68$ converters achieved a RECIST response (partial response), while $17$ did not. Among the non-converters, $38$ achieved a RECIST response and $74$ did not.\n\nUsing foundational definitions from probability and diagnostic test evaluation, compute the positive predictive value and the negative predictive value of the day-$14$ conversion test for predicting week-$12$ RECIST response in this baseline-unfavorable subgroup. Report the positive predictive value and the negative predictive value as decimals, rounded to four significant figures. Do not use a percent sign; express each value as a pure decimal number without units.", "solution": "The problem is valid. It is scientifically grounded, well-posed, and contains complete and consistent data.\n\nThis problem requires the calculation of the positive predictive value (PPV) and negative predictive value (NPV) of a biomarker test. The analysis is framed as a standard diagnostic test evaluation. Let us define the components of this evaluation based on the problem statement.\n\nThe \"test\" is the change in circulating tumor cell (CTC) count by day $14$.\n- A positive test outcome (Test+) is defined as conversion from a baseline CTC count $\\geq 5$ per $7.5\\,\\mathrm{mL}$ to a day-$14$ CTC count $< 5$ per $7.5\\,\\mathrm{mL}$. Patients with this outcome are referred to as \"converters\".\n- A negative test outcome (Test-) is defined as non-conversion, meaning the day-$14$ CTC count remains $\\geq 5$ for a patient with a baseline count $\\geq 5$. Patients with this outcome are \"non-converters\".\n\nThe \"disease\" status corresponds to the radiographic response at week $12$, as determined by RECIST criteria.\n- A positive disease status (Disease+) is achieving a RECIST response.\n- A negative disease status (Disease-) is not achieving a RECIST response.\n\nThe analysis is performed on a cohort of $N=180$ patients, all of whom had a baseline CTC count $\\geq 5$ per $7.5\\,\\mathrm{mL}$.\n\nTo systematically calculate PPV and NPV, we organize the provided data into a $2 \\times 2$ contingency table. The standard categories are:\n- True Positives (TP): Patients who are Test+ and Disease+.\n- False Positives (FP): Patients who are Test+ but Disease-.\n- True Negatives (TN): Patients who are Test- and Disease-.\n- False Negatives (FN): Patients who are Test- but Disease+.\n\nFrom the problem statement, we extract the following numbers:\n- Total number of Test+ patients (converters) = $68$.\n- Total number of Test- patients (non-converters) = $112$.\n- Among the $68$ converters (Test+):\n  - $51$ achieved a RECIST response (Disease+). These are the True Positives: $TP = 51$.\n  - $17$ did not achieve a RECIST response (Disease-). These are the False Positives: $FP = 17$.\n- Among the $112$ non-converters (Test-):\n  - $38$ achieved a RECIST response (Disease+). These are the False Negatives: $FN = 38$.\n  - $74$ did not achieve a RECIST response (Disease-). These are the True Negatives: $TN = 74$.\n\nWe can summarize this in a contingency table:\n\n|                   | RECIST Response (Disease+) | No RECIST Response (Disease-) | Total        |\n|-------------------|----------------------------|-------------------------------|--------------|\n| **CTC Conversion (Test+)** | $TP = 51$                  | $FP = 17$                     | $TP+FP = 68$ |\n| **No Conversion (Test-)**  | $FN = 38$                  | $TN = 74$                     | $FN+TN = 112$ |\n| **Total**         | $TP+FN = 89$               | $FP+TN = 91$                  | $N = 180$    |\n\nThe totals are consistent with the problem statement: $68 + 112 = 180$ patients in total.\n\nNow, we apply the foundational definitions of PPV and NPV.\n\nThe Positive Predictive Value (PPV) is the probability that a patient with a positive test result truly has the condition (i.e., will have a RECIST response). It is the proportion of true positives among all positive tests.\n$$\nPPV = P(\\text{Disease+} | \\text{Test+}) = \\frac{TP}{TP + FP}\n$$\nSubstituting the values from our table:\n$$\nPPV = \\frac{51}{51 + 17} = \\frac{51}{68}\n$$\nCalculating the decimal value:\n$$\nPPV = 0.75\n$$\nAs per the instruction to round to four significant figures, this value is $0.7500$.\n\nThe Negative Predictive Value (NPV) is the probability that a patient with a negative test result truly does not have the condition (i.e., will not have a RECIST response). It is the proportion of true negatives among all negative tests.\n$$\nNPV = P(\\text{Disease-} | \\text{Test-}) = \\frac{TN}{TN + FN}\n$$\nSubstituting the values from our table:\n$$\nNPV = \\frac{74}{74 + 38} = \\frac{74}{112}\n$$\nCalculating the decimal value:\n$$\nNPV = 0.6607142857...\n$$\nRounding to four significant figures, we look at the fifth significant digit. Since it is $1$ (which is less than $5$), we round down.\n$$\nNPV \\approx 0.6607\n$$\n\nThe required values are the positive predictive value and the negative predictive value, reported as decimals rounded to four significant figures.\n- Positive Predictive Value = $0.7500$\n- Negative Predictive Value = $0.6607$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.7500 & 0.6607\n\\end{pmatrix}\n}\n$$", "id": "5026599"}, {"introduction": "The ultimate goal of many translational discoveries is to change clinical practice, which requires demonstrating not only efficacy but also economic value. This advanced practice introduces you to health economic evaluation by tasking you with building a cohort-based Markov model to assess a CTC-guided treatment strategy. You will integrate clinical effectiveness, costs, and quality-of-life data to determine if a novel biomarker-driven approach provides good value for money, a key consideration for health policy decisions.", "problem": "A cohort-based discrete-time Markov model is to be constructed to compare two strategies in translational medicine for patients with solid tumors monitored via liquid biopsy for circulating tumor cells (CTCs): standard of care (SoC) versus CTC-guided therapy switching. The Markov model has three mutually exclusive health states: progression-free survival (PFS), progressed disease (PD), and death (D). All patients start in PFS at cycle $t=0$. Cycles are of length $1$ month and the time horizon is a fixed number of months. Death is absorbing. Transition probabilities are constant within each therapy-risk subgroup, and the model assumes no transitions from PD back to PFS.\n\nFundamental bases and definitions:\n- The Markov property implies that the future state depends only on the current state. If $v_t$ is the occupancy row vector over states at cycle $t$ and $M$ is a valid transition probability matrix for the subgroup, then the occupancy evolves as $v_{t+1} = v_t M$.\n- Quality-adjusted life years (QALYs) quantify health by applying state-specific utilities to time in state. If $u_{\\mathrm{PFS}}$, $u_{\\mathrm{PD}}$, and $u_{\\mathrm{D}}$ are utilities for PFS, PD, and D, respectively, then the QALYs accrued over one month from occupancy $v_t$ are the utility-weighted sum multiplied by $1/12$ years.\n- Monetary costs are accrued per cycle by state occupancy and by events. Per-cycle costs include therapy-specific costs in PFS and a PD management cost; death may incur a one-time event cost upon transition into D.\n- Discounting applies to future costs and QALYs using an annual rate $r$, with per-cycle discount factor $d_t = \\left(1+r\\right)^{-(t+1)/12}$ assuming end-of-cycle accrual.\n\nStrategy definitions:\n- SoC: All patients receive therapy $A$ from baseline. Transition dynamics differ by underlying risk category: low risk versus high risk. Let $p_{\\mathrm{high}}$ be the baseline fraction of patients who are high risk; $1 - p_{\\mathrm{high}}$ are low risk. For SoC, all low-risk patients follow transition matrix $M_{A,\\mathrm{low}}$ and all high-risk patients follow $M_{A,\\mathrm{high}}$.\n- CTC-guided: At baseline, all patients undergo a single CTC test with sensitivity $S_e$ and specificity $S_p$, incurring a one-time test cost. Patients testing positive are assigned to therapy $B$; those testing negative are assigned to therapy $A$. Misclassification occurs according to $S_e$ and $S_p$. Low-risk and high-risk patients assigned to therapy $A$ or $B$ follow their respective transition matrices $M_{A,\\mathrm{low}}$, $M_{A,\\mathrm{high}}$, $M_{B,\\mathrm{low}}$, and $M_{B,\\mathrm{high}}$.\n\nUtilities and costs:\n- Utilities are $u_{\\mathrm{PFS}}$, $u_{\\mathrm{PD}}$, $u_{\\mathrm{D}}=0$.\n- Per-cycle costs: PFS costs depend on therapy, with $c_{\\mathrm{PFS},A}$ for therapy $A$ and $c_{\\mathrm{PFS},B}$ for therapy $B$. PD cost per cycle is $c_{\\mathrm{PD}}$. Death incurs a one-time cost $c_{\\mathrm{death}}$ when transitioning into D. The CTC-guided strategy incurs a one-time test cost $c_{\\mathrm{CTC}}$ at baseline.\n- All costs must be expressed in United States dollars (USD) per patient. All QALYs are dimensionless.\n\nDecision rule:\n- For a willingness-to-pay threshold $\\lambda$ (in USD per QALY), compute net monetary benefit (NMB) for each strategy as $ \\mathrm{NMB} = \\lambda \\times \\mathrm{QALYs} - \\mathrm{Cost} $. The CTC-guided strategy is considered cost-effective if its NMB strictly exceeds SoC’s NMB.\n\nAlgorithmic computation requirements:\n- For each subgroup $g$ defined by $(\\mathrm{risk}, \\mathrm{therapy})$, initialize the occupancy vector $v^{(g)}_0 = [w_g, 0, 0]$, where $w_g$ is the subgroup’s initial patient fraction derived from $p_{\\mathrm{high}}$, $S_e$, and $S_p$ for the chosen strategy.\n- Propagate $v^{(g)}_t$ for $t = 0,\\dots,T-1$ using $v^{(g)}_{t+1} = v^{(g)}_t M_g$.\n- At each cycle $t$, accrue discounted QALYs by summing across subgroups the utility-weighted occupancy times $1/12$ years and multiplying by $d_t$. Accrue discounted costs by summing across subgroups: PFS occupancy times therapy-specific PFS cost, PD occupancy times $c_{\\mathrm{PD}}$, plus new deaths times $c_{\\mathrm{death}}$, then multiplying by $d_t$. New deaths for subgroup $g$ at cycle $t$ are $v^{(g)}_t[\\mathrm{D}] - v^{(g)}_{t-1}[\\mathrm{D}]$ with $v^{(g)}_{-1}[\\mathrm{D}] = 0$. Add $c_{\\mathrm{CTC}}$ (undiscounted) once at baseline to the guided strategy’s total costs.\n\nTest suite:\nImplement the program to evaluate the following four parameter sets. For each, output whether the CTC-guided strategy is cost-effective relative to SoC given the threshold $\\lambda$.\n\nCommon structure across cases:\n- Horizon $T = 36$ cycles ($36$ months).\n- Annual discount rate $r = 0.03$ unless otherwise specified.\n- Utilities: $u_{\\mathrm{PFS}} = 0.85$, $u_{\\mathrm{PD}} = 0.60$, $u_{\\mathrm{D}} = 0$.\n- Costs: $c_{\\mathrm{PD}} = 9000$ USD per cycle, $c_{\\mathrm{death}} = 20000$ USD per death event.\n- SoC transitions:\n  - $M_{A,\\mathrm{low}}$: PFS row $[0.945, 0.050, 0.005]$; PD row $[0, 0.900, 0.100]$; D row $[0, 0, 1]$.\n  - $M_{A,\\mathrm{high}}$: PFS row $[0.890, 0.100, 0.010]$; PD row $[0, 0.850, 0.150]$; D row $[0, 0, 1]$.\n\nCase $1$ (base case, expected to favor guided at a relatively high threshold):\n- $p_{\\mathrm{high}} = 0.40$, $S_e = 0.85$, $S_p = 0.90$.\n- Costs: $c_{\\mathrm{CTC}} = 1500$ USD; $c_{\\mathrm{PFS},A} = 6000$ USD per cycle; $c_{\\mathrm{PFS},B} = 8000$ USD per cycle.\n- Therapy $B$ transitions:\n  - $M_{B,\\mathrm{low}}$: PFS row $[0.934, 0.060, 0.006]$; PD row $[0, 0.900, 0.100]$; D row $[0, 0, 1]$.\n  - $M_{B,\\mathrm{high}}$: PFS row $[0.912, 0.080, 0.008]$; PD row $[0, 0.870, 0.130]$; D row $[0, 0, 1]$.\n- $\\lambda = 150000$ USD per QALY.\n\nCase $2$ (low prevalence and lower specificity, expected not to favor guided):\n- $p_{\\mathrm{high}} = 0.10$, $S_e = 0.85$, $S_p = 0.80$.\n- Costs: $c_{\\mathrm{CTC}} = 1500$ USD; $c_{\\mathrm{PFS},A} = 6000$ USD per cycle; $c_{\\mathrm{PFS},B} = 8000$ USD per cycle.\n- Therapy $B$ transitions as in Case $1$.\n- $\\lambda = 100000$ USD per QALY.\n\nCase $3$ (perfect test but low willingness-to-pay, expected not to favor guided):\n- $p_{\\mathrm{high}} = 0.40$, $S_e = 1.00$, $S_p = 1.00$.\n- Costs: $c_{\\mathrm{CTC}} = 1500$ USD; $c_{\\mathrm{PFS},A} = 6000$ USD per cycle; $c_{\\mathrm{PFS},B} = 8000$ USD per cycle.\n- Therapy $B$ transitions as in Case $1$.\n- $\\lambda = 50000$ USD per QALY.\n\nCase $4$ (boundary case with zero incremental QALYs and positive incremental costs, expected not to favor guided):\n- $p_{\\mathrm{high}} = 0.40$, $S_e = 1.00$, $S_p = 1.00$.\n- Costs: $c_{\\mathrm{CTC}} = 1500$ USD; $c_{\\mathrm{PFS},A} = 6000$ USD per cycle; $c_{\\mathrm{PFS},B} = 6000$ USD per cycle.\n- Therapy $B$ transitions set equal to therapy $A$ transitions: $M_{B,\\mathrm{low}} = M_{A,\\mathrm{low}}$ and $M_{B,\\mathrm{high}} = M_{A,\\mathrm{high}}$.\n- $\\lambda = 100000$ USD per QALY.\n\nFinal output specification:\nYour program should produce a single line of output containing the results as a comma-separated list of booleans enclosed in square brackets (e.g., $[{\\mathrm{True}},{\\mathrm{False}},{\\mathrm{True}},{\\mathrm{False}}]$). Each boolean indicates whether the CTC-guided strategy is cost-effective for the corresponding test case at the specified $\\lambda$.", "solution": "The problem statement has been meticulously reviewed and validated against the specified criteria.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Model Type**: Discrete-time Markov model.\n- **States**: $S = \\{\\text{PFS, PD, D}\\}$ (Progression-Free Survival, Progressed Disease, Death).\n- **Initial State**: All patients in PFS at $t=0$.\n- **Cycle Length**: $1$ month.\n- **Time Horizon**: $T$ months.\n- **Model Dynamics**: $v_{t+1} = v_t M$, where $v_t$ is the state occupancy row vector at cycle $t$, and $M$ is the transition probability matrix.\n- **Constraints**: No transitions from PD to PFS. Death (D) is an absorbing state.\n- **Strategies**:\n    1.  **Standard of Care (SoC)**: All patients receive therapy A. The cohort is a mixture of low-risk and high-risk patients.\n    2.  **CTC-guided**: Patients are tested for Circulating Tumor Cells (CTCs) at baseline. Test positives get therapy B, test negatives get therapy A.\n- **Subgroup Fractions**:\n    - **SoC**:\n        - Low-risk (on therapy A): $1 - p_{\\mathrm{high}}$\n        - High-risk (on therapy A): $p_{\\mathrm{high}}$\n    - **CTC-guided**:\n        - True Negatives (low-risk, test negative, on therapy A): $(1 - p_{\\mathrm{high}}) S_p$\n        - False Positives (low-risk, test positive, on therapy B): $(1 - p_{\\mathrm{high}}) (1 - S_p)$\n        - False Negatives (high-risk, test negative, on therapy A): $p_{\\mathrm{high}} (1 - S_e)$\n        - True Positives (high-risk, test positive, on therapy B): $p_{\\mathrm{high}} S_e$\n- **QALY Calculation**: Per cycle, $(v_t[\\text{PFS}] \\cdot u_{\\mathrm{PFS}} + v_t[\\text{PD}] \\cdot u_{\\mathrm{PD}} + v_t[\\text{D}] \\cdot u_{\\mathrm{D}}) \\times (1/12)$.\n- **Cost Calculation**:\n    - **Per-cycle state costs**: $c_{\\mathrm{PFS},A}$ or $c_{\\mathrm{PFS},B}$ for patients in PFS; $c_{\\mathrm{PD}}$ for patients in PD.\n    - **One-time event cost**: $c_{\\mathrm{death}}$ for each new transition into D.\n    - **One-time strategy cost**: $c_{\\mathrm{CTC}}$ for the CTC-guided strategy at baseline (undiscounted).\n- **Discounting**: Annual rate $r$. End-of-cycle accrual. Per-cycle discount factor for cycle $t$ (from time $t$ to $t+1$) is $d_t = (1+r)^{-(t+1)/12}$.\n- **Decision Rule**: CTC-guided is cost-effective if $\\mathrm{NMB}_{\\text{CTC}} > \\mathrm{NMB}_{\\text{SoC}}$, where $\\mathrm{NMB} = \\lambda \\times \\mathrm{QALYs} - \\mathrm{Cost}$.\n- **Common Parameters**:\n    - $T = 36$ months.\n    - $r = 0.03$.\n    - Utilities: $u_{\\mathrm{PFS}} = 0.85$, $u_{\\mathrm{PD}} = 0.60$, $u_{\\mathrm{D}} = 0$.\n    - Costs: $c_{\\mathrm{PD}} = 9000$ USD/cycle, $c_{\\mathrm{death}} = 20000$ USD/event.\n    - States: PFS (index 0), PD (index 1), D (index 2).\n    - $M_{A,\\mathrm{low}} = \\begin{pmatrix} 0.945 & 0.050 & 0.005 \\\\ 0 & 0.900 & 0.100 \\\\ 0 & 0 & 1 \\end{pmatrix}$.\n    - $M_{A,\\mathrm{high}} = \\begin{pmatrix} 0.890 & 0.100 & 0.010 \\\\ 0 & 0.850 & 0.150 \\\\ 0 & 0 & 1 \\end{pmatrix}$.\n- **Case-specific Parameters**:\n    - **Case 1**: $p_{\\mathrm{high}} = 0.40, S_e = 0.85, S_p = 0.90, c_{\\mathrm{CTC}} = 1500, c_{\\mathrm{PFS},A} = 6000, c_{\\mathrm{PFS},B} = 8000, \\lambda = 150000$.\n        - $M_{B,\\mathrm{low}} = \\begin{pmatrix} 0.934 & 0.060 & 0.006 \\\\ 0 & 0.900 & 0.100 \\\\ 0 & 0 & 1 \\end{pmatrix}$.\n        - $M_{B,\\mathrm{high}} = \\begin{pmatrix} 0.912 & 0.080 & 0.008 \\\\ 0 & 0.870 & 0.130 \\\\ 0 & 0 & 1 \\end{pmatrix}$.\n    - **Case 2**: $p_{\\mathrm{high}} = 0.10, S_e = 0.85, S_p = 0.80, c_{\\mathrm{CTC}} = 1500, c_{\\mathrm{PFS},A} = 6000, c_{\\mathrm{PFS},B} = 8000, \\lambda = 100000$. $M_B$ as in Case 1.\n    - **Case 3**: $p_{\\mathrm{high}} = 0.40, S_e = 1.00, S_p = 1.00, c_{\\mathrm{CTC}} = 1500, c_{\\mathrm{PFS},A} = 6000, c_{\\mathrm{PFS},B} = 8000, \\lambda = 50000$. $M_B$ as in Case 1.\n    - **Case 4**: $p_{\\mathrm{high}} = 0.40, S_e = 1.00, S_p = 1.00, c_{\\mathrm{CTC}} = 1500, c_{\\mathrm{PFS},A} = 6000, c_{\\mathrm{PFS},B} = 6000, \\lambda = 100000$. $M_{B,\\mathrm{low}} = M_{A,\\mathrm{low}}, M_{B,\\mathrm{high}} = M_{A,\\mathrm{high}}$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is scientifically grounded, employing a standard Markov cohort model for health economic evaluation. This methodology is fundamental to translational medicine and health technology assessment. The parameters, including probabilities, costs, and utilities, are numerically plausible. All transition matrices are valid right stochastic matrices (rows sum to $1$). The problem is well-posed, providing all necessary definitions, data, and a clear algorithmic path to a unique solution. The language is objective and formal. The setup is self-contained and internally consistent.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. A solution will be developed.\n\n### Solution\n\nThe solution requires implementing a cohort-based discrete-time Markov model to calculate the total discounted Quality-Adjusted Life Years (QALYs) and costs for two competing strategies: Standard of Care (SoC) and CTC-guided therapy. The Net Monetary Benefit (NMB) is then computed for each to determine cost-effectiveness.\n\nThe core of the model is the simulation of patient cohort transitions over a finite time horizon. The cohort is partitioned into mutually exclusive subgroups, each defined by a risk category (low/high) and an assigned therapy (A/B). Each subgroup's evolution is governed by a specific transition probability matrix.\n\n**Principle 1: Cohort Partitioning and Subgroup Dynamics**\n\nThe total patient cohort is normalized to a size of $1$. This cohort is divided into subgroups based on the strategy.\n\n- **SoC Strategy**: The cohort is divided into two subgroups based on intrinsic risk:\n    1.  Low-Risk on Therapy A: Initial fraction $w_{\\text{low}} = 1 - p_{\\mathrm{high}}$. Dynamics governed by $M_{A,\\mathrm{low}}$.\n    2.  High-Risk on Therapy A: Initial fraction $w_{\\text{high}} = p_{\\mathrm{high}}$. Dynamics governed by $M_{A,\\mathrm{high}}$.\n\n- **CTC-Guided Strategy**: The cohort is divided into four subgroups based on intrinsic risk and the outcome of the CTC test, which has sensitivity $S_e$ and specificity $S_p$:\n    1.  True Negatives (TN): Low-risk, test negative, receive therapy A. Fraction $w_{\\text{TN}} = (1 - p_{\\mathrm{high}}) S_p$. Governed by $M_{A,\\mathrm{low}}$.\n    2.  False Negatives (FN): High-risk, test negative, receive therapy A. Fraction $w_{\\text{FN}} = p_{\\mathrm{high}} (1 - S_e)$. Governed by $M_{A,\\mathrm{high}}$.\n    3.  False Positives (FP): Low-risk, test positive, receive therapy B. Fraction $w_{\\text{FP}} = (1 - p_{\\mathrm{high}}) (1 - S_p)$. Governed by $M_{B,\\mathrm{low}}$.\n    4.  True Positives (TP): High-risk, test positive, receive therapy B. Fraction $w_{\\text{TP}} = p_{\\mathrm{high}} S_e$. Governed by $M_{B,\\mathrm{high}}$.\n\nFor each subgroup $g$, we initialize a state occupancy vector $v_0^{(g)} = [w_g, 0, 0]$, where $w_g$ is the subgroup's initial fraction. The evolution over $T$ cycles is a \"Markov trace\" computed as $v_{t+1}^{(g)} = v_t^{(g)} M_g$ for $t = 0, \\dots, T-1$.\n\n**Principle 2: Accrual of Outcomes and Costs**\n\nOutcomes (QALYs) and costs are accrued at the end of each monthly cycle and discounted to their present value. The annual discount rate is $r$. The discount factor for outcomes accrued at the end of cycle $t$ (i.e., at month $t+1$) is $d_t = (1+r)^{-(t+1)/12}$.\n\nFor each cycle $t \\in \\{0, 1, \\dots, T-1\\}$:\n1.  **QALYs**: The QALYs gained during the cycle are based on the proportion of the cohort in each non-death state at the start of the cycle. For each subgroup $g$, the QALYs are $(v_t^{(g)}[\\text{PFS}] \\cdot u_{\\mathrm{PFS}} + v_t^{(g)}[\\text{PD}] \\cdot u_{\\mathrm{PD}}) / 12$. The total QALYs for the cycle are the sum over all subgroups.\n2.  **Costs**: Costs have two components:\n    - **State Costs**: Accrued based on the state occupied at the beginning of the cycle. For subgroup $g$, this is $v_t^{(g)}[\\text{PFS}] \\cdot c_{\\mathrm{PFS}, \\text{therapy}} + v_t^{(g)}[\\text{PD}] \\cdot c_{\\mathrm{PD}}$, where $c_{\\mathrm{PFS}, \\text{therapy}}$ depends on the therapy assigned to the subgroup.\n    - **Event Costs**: Accrued for transitions occurring during the cycle. The number of new deaths in subgroup $g$ during cycle $t$ is $v_{t+1}^{(g)}[\\text{D}] - v_t^{(g)}[\\text{D}]$. The associated cost is this increment multiplied by $c_{\\mathrm{death}}$.\n\nThe total discounted QALYs and costs for a strategy are the sum of these discounted per-cycle values over the entire time horizon $T$. For the CTC-guided strategy, the initial undiscounted test cost $c_\\mathrm{CTC}$ is added to its total cost.\n\n**Principle 3: Economic Decision Rule**\n\nThe cost-effectiveness of the CTC-guided strategy is evaluated using the Net Monetary Benefit (NMB) framework. For a given willingness-to-pay threshold $\\lambda$ (USD per QALY), the NMB is:\n$$ \\mathrm{NMB} = (\\lambda \\times \\text{Total Discounted QALYs}) - \\text{Total Discounted Cost} $$\nThe CTC-guided strategy is considered cost-effective if its NMB is strictly greater than that of the SoC strategy:\n$$ \\mathrm{NMB}_{\\text{CTC}} > \\mathrm{NMB}_{\\text{SoC}} $$\nThis is equivalent to the Incremental Net Monetary Benefit (INMB) being positive:\n$$ \\mathrm{INMB} = (\\mathrm{NMB}_{\\text{CTC}} - \\mathrm{NMB}_{\\text{SoC}}) = \\lambda (\\mathrm{QALYs}_{\\text{CTC}} - \\mathrm{QALYs}_{\\text{SoC}}) - (\\mathrm{Costs}_{\\text{CTC}} - \\mathrm{Costs}_{\\text{SoC}}) > 0 $$\n\nThe algorithm proceeds by implementing these principles for each of the four test cases provided, comparing the NMB of the two strategies to yield a boolean determination of cost-effectiveness.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the Markov model for all test cases and print the results.\n    \"\"\"\n\n    # --- Common Parameters ---\n    T = 36  # Time horizon in months\n    r = 0.03  # Annual discount rate\n    u_pfs = 0.85\n    u_pd = 0.60\n    u_d = 0.0\n    utilities = np.array([u_pfs, u_pd, u_d])\n    c_pd = 9000.0\n    c_death = 20000.0\n\n    # Transition matrices\n    M_A_low = np.array([\n        [0.945, 0.050, 0.005],\n        [0.0, 0.900, 0.100],\n        [0.0, 0.0, 1.0]\n    ])\n    M_A_high = np.array([\n        [0.890, 0.100, 0.010],\n        [0.0, 0.850, 0.150],\n        [0.0, 0.0, 1.0]\n    ])\n    M_B_low_case1 = np.array([\n        [0.934, 0.060, 0.006],\n        [0.0, 0.900, 0.100],\n        [0.0, 0.0, 1.0]\n    ])\n    M_B_high_case1 = np.array([\n        [0.912, 0.080, 0.008],\n        [0.0, 0.870, 0.130],\n        [0.0, 0.0, 1.0]\n    ])\n\n    test_cases = [\n        # Case 1\n        {\n            \"p_high\": 0.40, \"Se\": 0.85, \"Sp\": 0.90, \"lambda\": 150000.0,\n            \"c_ctc\": 1500.0, \"c_pfs_a\": 6000.0, \"c_pfs_b\": 8000.0,\n            \"M_B_low\": M_B_low_case1, \"M_B_high\": M_B_high_case1\n        },\n        # Case 2\n        {\n            \"p_high\": 0.10, \"Se\": 0.85, \"Sp\": 0.80, \"lambda\": 100000.0,\n            \"c_ctc\": 1500.0, \"c_pfs_a\": 6000.0, \"c_pfs_b\": 8000.0,\n            \"M_B_low\": M_B_low_case1, \"M_B_high\": M_B_high_case1\n        },\n        # Case 3\n        {\n            \"p_high\": 0.40, \"Se\": 1.00, \"Sp\": 1.00, \"lambda\": 50000.0,\n            \"c_ctc\": 1500.0, \"c_pfs_a\": 6000.0, \"c_pfs_b\": 8000.0,\n            \"M_B_low\": M_B_low_case1, \"M_B_high\": M_B_high_case1\n        },\n        # Case 4\n        {\n            \"p_high\": 0.40, \"Se\": 1.00, \"Sp\": 1.00, \"lambda\": 100000.0,\n            \"c_ctc\": 1500.0, \"c_pfs_a\": 6000.0, \"c_pfs_b\": 6000.0,\n            \"M_B_low\": M_A_low, \"M_B_high\": M_A_high\n        },\n    ]\n\n    def compute_strategy_outcomes(strategy_type, params):\n        \"\"\"\n        Computes total discounted QALYs and Costs for a given strategy.\n        \n        strategy_type: 'soc' or 'ctc_guided'\n        params: a dictionary of parameters for the current test case.\n        \"\"\"\n        p_high = params[\"p_high\"]\n        c_pfs_a = params[\"c_pfs_a\"]\n        c_pfs_b = params[\"c_pfs_b\"]\n        M_B_low = params[\"M_B_low\"]\n        M_B_high = params[\"M_B_high\"]\n\n        subgroups = []\n        total_cost = 0.0\n        \n        if strategy_type == 'soc':\n            subgroups.append({'weight': 1.0 - p_high, 'matrix': M_A_low, 'c_pfs': c_pfs_a})\n            subgroups.append({'weight': p_high, 'matrix': M_A_high, 'c_pfs': c_pfs_a})\n        elif strategy_type == 'ctc_guided':\n            total_cost += params[\"c_ctc\"]  # Undiscounted baseline cost\n            Se = params[\"Se\"]\n            Sp = params[\"Sp\"]\n            \n            # True Negatives (TN): low-risk, test neg, therapy A\n            w_tn = (1.0 - p_high) * Sp\n            if w_tn > 0:\n                subgroups.append({'weight': w_tn, 'matrix': M_A_low, 'c_pfs': c_pfs_a})\n                \n            # False Negatives (FN): high-risk, test neg, therapy A\n            w_fn = p_high * (1.0 - Se)\n            if w_fn > 0:\n                subgroups.append({'weight': w_fn, 'matrix': M_A_high, 'c_pfs': c_pfs_a})\n\n            # False Positives (FP): low-risk, test pos, therapy B\n            w_fp = (1.0 - p_high) * (1.0 - Sp)\n            if w_fp > 0:\n                subgroups.append({'weight': w_fp, 'matrix': M_B_low, 'c_pfs': c_pfs_b})\n                \n            # True Positives (TP): high-risk, test pos, therapy B\n            w_tp = p_high * Se\n            if w_tp > 0:\n                subgroups.append({'weight': w_tp, 'matrix': M_B_high, 'c_pfs': c_pfs_b})\n\n        total_qaly = 0.0\n\n        for t in range(T):\n            discount_factor = (1.0 + r)**(-(t + 1.0) / 12.0)\n            \n            cycle_qaly = 0.0\n            cycle_cost = 0.0\n            \n            # Propagate and calculate outcomes for each subgroup\n            # For this, we need traces. Let's compute them first.\n        \n        traces = []\n        for sg in subgroups:\n            trace = np.zeros((T + 1, 3))\n            trace[0, :] = np.array([sg['weight'], 0, 0])\n            for t in range(T):\n                trace[t + 1, :] = trace[t, :] @ sg['matrix']\n            traces.append(trace)\n        \n        for t in range(T):\n            discount_factor = (1.0 + r)**(-(t + 1.0) / 12.0)\n            cycle_qaly_sum = 0.0\n            cycle_cost_sum = 0.0\n\n            for i, sg in enumerate(subgroups):\n                v_t = traces[i][t]\n                v_t_plus_1 = traces[i][t+1]\n                \n                # QALYs based on state at start of cycle\n                cycle_qaly_sum += np.dot(v_t, utilities)\n\n                # Costs based on state at start of cycle\n                cycle_cost_sum += v_t[0] * sg['c_pfs'] + v_t[1] * c_pd\n                \n                # Event cost for new deaths during cycle\n                new_deaths = v_t_plus_1[2] - v_t[2]\n                cycle_cost_sum += new_deaths * c_death\n            \n            total_qaly += (cycle_qaly_sum / 12.0) * discount_factor\n            total_cost += cycle_cost_sum * discount_factor\n            \n        return total_qaly, total_cost\n\n    results = []\n    for case_params in test_cases:\n        # Calculate outcomes for Standard of Care (SoC)\n        qaly_soc, cost_soc = compute_strategy_outcomes('soc', case_params)\n        nmb_soc = case_params['lambda'] * qaly_soc - cost_soc\n        \n        # Calculate outcomes for CTC-guided strategy\n        qaly_ctc, cost_ctc = compute_strategy_outcomes('ctc_guided', case_params)\n        nmb_ctc = case_params['lambda'] * qaly_ctc - cost_ctc\n\n        # Compare NMBs\n        is_cost_effective = nmb_ctc > nmb_soc\n        results.append(is_cost_effective)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "5026626"}]}