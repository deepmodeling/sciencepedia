{"hands_on_practices": [{"introduction": "Justifying the first-in-human (FIH) starting dose is a cornerstone of any Investigational New Drug (IND) application, forming a critical bridge between nonclinical safety studies and the clinical protocol. This process requires translating toxicology findings from animal models into a human context. This exercise [@problem_id:5003203] challenges you to apply body surface area (BSA) scaling, a fundamental allometric principle used to derive a Human Equivalent Dose (HED), and to articulate the scientific reasoning behind it. Mastering this derivation and calculation is essential for demonstrating to regulatory authorities that a proposed starting dose is founded on a quantitative, scientifically-grounded assessment of safety.", "problem": "A sponsor preparing an Investigational New Drug (IND) application must justify the proposed first-in-human dose using translational principles that link nonclinical toxicology to human exposure. In a Good Laboratory Practice repeat-dose oral toxicology study in Beagle dogs, the No-Observed-Adverse-Effect Level (NOAEL) was established at $15\\,\\mathrm{mg/kg/day}$. The sponsor intends to use body surface area scaling to convert this animal NOAEL to a Human Equivalent Dose (HED) on a $\\mathrm{mg/kg/day}$ basis for an adult human. The body weight to body surface area conversion factor $K_m$ (defined as $K_m = \\frac{M}{\\mathrm{BSA}}$ with units $\\mathrm{kg/m^2}$) is given as $K_m^{dog} = 20\\,\\mathrm{kg/m^2}$ and $K_m^{human} = 37\\,\\mathrm{kg/m^2}$.\n\nUsing a derivation grounded in first principles of physiological allometry and the invariance of dose per $\\mathrm{m^2}$ as an exposure surrogate, determine the Human Equivalent Dose (HED) in $\\mathrm{mg/kg/day}$ from the dog NOAEL. Round your answer to four significant figures and express it in $\\mathrm{mg/kg/day}$. Additionally, articulate the epistemic justification for body surface area (BSA) scaling as a model for interspecies dose conversion in the context of IND dose selection, explaining what is being equated, why it is reasonable given biological scaling laws, and how the $K_m$ factors operationalize this equivalence without appealing to untested shortcut formulas. Your final numerical answer must be a single real value.", "solution": "The problem as stated is valid. It is scientifically grounded in the established principles of interspecies allometric scaling used in pharmacology and toxicology, a critical step in translational medicine governed by regulatory guidelines. The problem is well-posed, providing all necessary data—the animal No-Observed-Adverse-Effect Level ($\\mathrm{NOAEL}$), and the species-specific body-weight-to-surface-area conversion factors ($K_m$)—to calculate a unique Human Equivalent Dose ($\\mathrm{HED}$). The terminology is precise and objective.\n\nThe core task is twofold: first, to provide the epistemic justification for body surface area ($\\mathrm{BSA}$) scaling and derive the conversion formula from first principles; and second, to calculate the $\\mathrm{HED}$.\n\nThe fundamental principle underlying body surface area scaling for interspecies dose conversion is the empirical observation that many physiological processes, including basal metabolic rate, blood flow, and the clearance of xenobiotics, do not scale linearly with body mass ($M$) across species. Instead, these processes often follow an allometric scaling law of the form $Y = a M^b$, where $Y$ is the physiological parameter, $a$ is a normalization constant, and the exponent $b$ is typically found to be approximately $\\frac{2}{3}$ or $\\frac{3}{4}$. Body surface area ($\\mathrm{BSA}$) itself scales with mass as $\\mathrm{BSA} \\propto M^{2/3}$. The near equivalence of the scaling exponents for metabolic rate and $\\mathrm{BSA}$ suggests that metabolic rate is approximately proportional to body surface area. Since drug clearance is often driven by metabolism, maintaining a constant drug exposure (e.g., area under the concentration-time curve, $\\mathrm{AUC}$) across species is better achieved by normalizing the dose to $\\mathrm{BSA}$ rather than to body weight.\n\nTherefore, the central assumption, as stated in the problem, is the **invariance of dose per unit of body surface area** needed to produce an equivalent biological effect. This means the dose expressed in $\\mathrm{mg/m^2}$ that corresponds to the $\\mathrm{NOAEL}$ is presumed to be equivalent between the animal species (dog) and humans.\nWe can state this principle mathematically:\n$$ D_{\\mathrm{human}, \\mathrm{mg/m^2}} = D_{\\mathrm{animal}, \\mathrm{mg/m^2}} $$\nwhere $D_{\\mathrm{animal}, \\mathrm{mg/m^2}}$ is the dose in $\\mathrm{mg}$ per square meter for the animal, and $D_{\\mathrm{human}, \\mathrm{mg/m^2}}$ is the equivalent dose for the human.\n\nThe problem provides doses in units of mass per unit body weight per day ($\\mathrm{mg/kg/day}$). We must convert this to a dose per unit $\\mathrm{BSA}$ ($\\mathrm{mg/m^2/day}$). The total daily dose administered to a subject (animal or human) is the product of the dose per unit mass and the subject's total mass $M$:\n$$ D_{\\mathrm{total}} \\, (\\mathrm{mg/day}) = D_{\\mathrm{mg/kg/day}} \\times M \\, (\\mathrm{kg}) $$\nTo find the dose per unit $\\mathrm{BSA}$, we divide this total dose by the subject's $\\mathrm{BSA}$:\n$$ D_{\\mathrm{mg/m^2/day}} = \\frac{D_{\\mathrm{total}}}{\\mathrm{BSA}} = \\frac{D_{\\mathrm{mg/kg/day}} \\times M}{\\mathrm{BSA}} $$\nThe problem defines the conversion factor $K_m$ as the ratio of body weight to body surface area:\n$$ K_m \\, (\\mathrm{kg/m^2}) = \\frac{M \\, (\\mathrm{kg})}{\\mathrm{BSA} \\, (\\mathrm{m^2})} $$\nSubstituting the definition of $K_m$ into our expression for $D_{\\mathrm{mg/m^2/day}}$ provides the direct conversion from a weight-normalized dose to a surface-area-normalized dose:\n$$ D_{\\mathrm{mg/m^2/day}} = D_{\\mathrm{mg/kg/day}} \\times K_m $$\nThis relationship shows how the $K_m$ factor operationalizes the conversion between the two dosing metrics. Now we apply our founding principle of equivalent exposure:\n$$ D_{\\mathrm{human}, \\mathrm{mg/m^2/day}} = D_{\\mathrm{animal}, \\mathrm{mg/m^2/day}} $$\nUsing the derived conversion, we substitute for each side of the equation:\n$$ D_{\\mathrm{human}, \\mathrm{mg/kg/day}} \\times K_m^{\\mathrm{human}} = D_{\\mathrm{animal}, \\mathrm{mg/kg/day}} \\times K_m^{\\mathrm{animal}} $$\nThe quantity $D_{\\mathrm{human}, \\mathrm{mg/kg/day}}$ is the Human Equivalent Dose ($\\mathrm{HED}$) that we seek to determine. The quantity $D_{\\mathrm{animal}, \\mathrm{mg/kg/day}}$ is the given animal $\\mathrm{NOAEL}$. Let's solve for the $\\mathrm{HED}$:\n$$ \\mathrm{HED} = D_{\\mathrm{animal}, \\mathrm{mg/kg/day}} \\times \\frac{K_m^{\\mathrm{animal}}}{K_m^{\\mathrm{human}}} $$\nThis equation is the derived formula for calculating the $\\mathrm{HED}$ from the animal dose, grounded in the first principle of equivalent dose per $\\mathrm{m^2}$.\n\nWe are given the following values:\nThe dog $\\mathrm{NOAEL}$, $D_{\\mathrm{animal}, \\mathrm{mg/kg/day}} = 15\\,\\mathrm{mg/kg/day}$.\nThe dog conversion factor, $K_m^{\\mathrm{dog}} = 20\\,\\mathrm{kg/m^2}$.\nThe human conversion factor, $K_m^{\\mathrm{human}} = 37\\,\\mathrm{kg/m^2}$.\n\nSubstituting these values into the derived equation:\n$$ \\mathrm{HED} = 15\\,\\mathrm{mg/kg/day} \\times \\frac{20\\,\\mathrm{kg/m^2}}{37\\,\\mathrm{kg/m^2}} $$\nThe units of $\\mathrm{kg/m^2}$ cancel, yielding the $\\mathrm{HED}$ in the correct units of $\\mathrm{mg/kg/day}$.\n$$ \\mathrm{HED} = 15 \\times \\frac{20}{37} \\,\\mathrm{mg/kg/day} = \\frac{300}{37} \\,\\mathrm{mg/kg/day} $$\nPerforming the division:\n$$ \\mathrm{HED} \\approx 8.108108... \\,\\mathrm{mg/kg/day} $$\nThe problem requires the answer to be rounded to four significant figures.\n$$ \\mathrm{HED} \\approx 8.108\\,\\mathrm{mg/kg/day} $$\nThis value represents the dose in humans that is predicted to provide an exposure equivalent to the $\\mathrm{NOAEL}$ observed in dogs, based on body surface area scaling.", "answer": "$$\n\\boxed{8.108}\n$$", "id": "5003203"}, {"introduction": "Beyond the pharmacology of the drug substance, the safety of an investigational product depends critically on its quality and purity, which are detailed in the Chemistry, Manufacturing, and Controls (CMC) section of an IND. For injectable (parenteral) drugs, controlling for pyrogenic contaminants like bacterial endotoxins is a non-negotiable safety requirement. This practice [@problem_id:5003194] requires you to apply established pharmacopeial rules to calculate the maximum allowable endotoxin concentration for a lot of an intravenous drug product. This exercise demonstrates how to integrate clinical dosing information with established safety thresholds to set a quantitative, enforceable quality attribute that protects patients from manufacturing-related risks.", "problem": "A biotechnology sponsor is preparing the Chemistry, Manufacturing, and Controls (CMC) section of an Investigational New Drug (IND) application for an intravenous monoclonal antibody drug product supplied at a concentration of $20$ mg/mL. The Phase 1 protocol defines the maximum recommended clinical regimen as a fixed dose of $600$ mg administered as a constant-rate intravenous infusion over 3 hours. Enrolled adults are screened to weigh at least $45$ kg. Using accepted pyrogenicity thresholds by route of administration and the regulatory convention for infusions exceeding 1 hour, determine the lot-release endotoxin acceptance limit per milliliter that ensures no subject exceeds the pyrogenic threshold during the maximum allowed administration in the trial. Use the threshold appropriate for the intravenous, non-intrathecal route of administration. In your derivation, justify the selection of body weight and the one-hour time basis when converting the fixed dose to a weight-normalized administration consistent with infusion practice. Round your final answer to three significant figures and express it in endotoxin units per milliliter (EU/mL).", "solution": "The problem requires the determination of the lot-release endotoxin acceptance limit for an intravenous monoclonal antibody drug product. This calculation must adhere to established regulatory principles for pyrogenicity. The solution is derived by ensuring that the maximum amount of endotoxin administered to the most sensitive subject in the clinical trial does not exceed the established pyrogenic threshold.\n\nFirst, we identify the given parameters and constants:\n- Drug product concentration, $C = 20$ mg/mL.\n- Total fixed dose, $D_{total} = 600$ mg.\n- Infusion duration, $T = 3$ hours.\n- Minimum subject body weight, $M_{min} = 45$ kg.\n\nThe problem specifies using the pyrogenicity threshold for the intravenous, non-intrathecal route of administration. This threshold, denoted as $K$, is a standard value defined in pharmacopeias (e.g., United States Pharmacopeia, USP).\n- Pyrogenic threshold, $K = 5.0$ Endotoxin Units (EU) per kilogram of body weight (EU/kg).\n\nThe derivation proceeds in two main stages: first, establishing the maximum allowable endotoxin dose for a subject, and second, relating this dose to the concentration of endotoxin in the drug product.\n\n**1. Justification of Parameters and Calculation of the Hourly Pyrogenic Dose Limit**\n\nThe endotoxin limit for a drug product lot must be set to ensure safety for all potential patients. The regulatory calculation requires using the worst-case scenario.\n\n- **Justification of Body Weight**: The clinical regimen specifies a fixed dose of $600$ mg, which is not adjusted for patient weight. The pyrogenic effect of endotoxin is dose-dependent on a per-kilogram-of-body-weight basis. Therefore, the highest endotoxin dose per kilogram will be received by the lightest subject. To ensure the limit is protective for the entire study population, the calculation must be based on the minimum allowable subject weight, which is given as $M_{min} = 45$ kg.\n\n- **Justification of One-Hour Time Basis**: The problem states the infusion is administered over 3 hours and requires using the \"regulatory convention for infusions exceeding 1 hour.\" For parenteral drug infusions, the pyrogenic threshold $K$ is typically applied not to the total dose over the entire infusion duration, but to the maximum dose administered within any single hour. This convention acknowledges that the physiological response to endotoxins is related to the rate of exposure, and the body possesses clearance mechanisms. For a constant-rate infusion, the dose administered in any one-hour period is uniform and represents the relevant exposure rate for this calculation.\n\nBased on these justifications, we calculate the maximum allowable endotoxin dose that can be administered in a one-hour period to the worst-case subject. Let this limit be $E_{limit}$.\n$$\nE_{limit} = K \\times M_{min}\n$$\nSubstituting the values:\n$$\nE_{limit} = 5.0 \\frac{\\text{EU}}{\\text{kg}} \\times 45 \\text{ kg} = 225 \\text{ EU}\n$$\nThis is the maximum amount of endotoxin a subject weighing $45$ kg can receive in any single hour of infusion.\n\n**2. Calculation of the Lot-Release Endotoxin Acceptance Limit**\n\nNext, we determine the volume of drug product administered per hour and use this to find the maximum permissible concentration of endotoxin in the product.\n\nFirst, we find the total volume of the drug product administered, $V_{total}$.\n$$\nV_{total} = \\frac{D_{total}}{C} = \\frac{600 \\text{ mg}}{20 \\text{ mg/mL}} = 30 \\text{ mL}\n$$\n\nThe infusion is administered at a constant rate over 3 hours. The volume administered per hour, $V_{rate}$, is:\n$$\nV_{rate} = \\frac{V_{total}}{T} = \\frac{30 \\text{ mL}}{3 \\text{ h}} = 10 \\text{ mL/h}\n$$\n\nLet $L$ be the lot-release endotoxin acceptance limit in EU/mL. The total amount of endotoxin delivered to the patient in one hour is the product of this limit and the volume infusion rate, $L \\times V_{rate}$. This amount must not exceed the hourly pyrogenic dose limit, $E_{limit}$.\n$$\nL \\times V_{rate} \\le E_{limit}\n$$\n\nTo find the maximum permissible limit $L$, we set the quantities equal:\n$$\nL = \\frac{E_{limit}}{V_{rate}}\n$$\nSubstituting the calculated values:\n$$\nL = \\frac{225 \\text{ EU}}{10 \\text{ mL/h}} = 22.5 \\frac{\\text{EU}}{\\text{mL}}\n$$\nThe problem requires the final answer to be rounded to three significant figures. The calculated value of $22.5$ EU/mL is already expressed with three significant figures.\n\nTherefore, the lot-release endotoxin acceptance limit is $22.5$ EU/mL. This limit ensures that even if a lot contains endotoxin at this maximum concentration, a $45$ kg subject receiving the drug via a $3$-hour constant infusion will not be exposed to more than $225$ EU in any given hour, which is the pyrogenic threshold for that individual.", "answer": "$$\\boxed{22.5}$$", "id": "5003194"}, {"introduction": "A robust IND does not just propose a single starting dose; it must also outline a complete strategy for the clinical investigation, including how doses will be escalated safely and efficiently to identify a suitable dose for later-phase studies. This advanced practice [@problem_id:5003226] immerses you in the design of a modern, model-based dose-escalation trial. You will construct and apply a Bayesian logistic regression model, using preclinical data to inform a prior belief about the dose-toxicity relationship and then updating that belief with emerging clinical data to guide subsequent decisions. By implementing this framework, you will gain firsthand experience with the sophisticated statistical methods that enable adaptive trial designs, enhancing both the safety and efficiency of early-phase drug development.", "problem": "You are preparing the statistical section of a United States Food and Drug Administration Investigational New Drug (IND) application and must specify a Bayesian model-based dose-escalation decision rule that is justified by preclinical potency and exposure data. Implement a program that, for each test case, constructs a prior for a monotonic dose-toxicity model using preclinical potency and toxicity benchmarks and then updates to a posterior using observed human cohort data to recommend the next dose. The decision rule and its justification must derive from foundational principles: Bayes’ theorem, the definition of the logistic (logit) link, and standard interspecies allometric dose conversion based on body surface area. No other shortcut formulas are to be assumed.\n\nUse the following universal base and definitions:\n- Bayes’ theorem: for parameters $\\theta$ and data $D$, the posterior density is $p(\\theta\\mid D) \\propto p(D\\mid \\theta)\\,p(\\theta)$.\n- Logistic link: $\\operatorname{logit}(p) = \\log\\!\\left(\\dfrac{p}{1-p}\\right)$ and $\\operatorname{logistic}(x) = \\dfrac{1}{1+e^{-x}}$.\n- Allometric human equivalent dose conversion by body surface area: for an animal species with factor $K_m$, the human equivalent dose in $\\mathrm{mg/kg}$ is $\\mathrm{HED}_{\\mathrm{mg/kg}} = \\mathrm{AnimalDose}_{\\mathrm{mg/kg}} \\times \\dfrac{K_m(\\text{species})}{K_m(\\text{human})}$. For a human body weight $W$ in $\\mathrm{kg}$, the corresponding absolute human dose is $\\mathrm{HED}_{\\mathrm{mg}} = \\mathrm{HED}_{\\mathrm{mg/kg}} \\times W$. Use $K_m(\\text{human}) = 37$, $K_m(\\text{rat}) = 6$, and $K_m(\\text{dog}) = 20$.\n\nModel and prior construction to implement:\n- You must model the probability of Dose-Limiting Toxicity (DLT) at dose $d$ (in $\\mathrm{mg}$) by a Bayesian Logistic Regression Model (BLRM): $\\operatorname{logit}\\!\\big(p(d)\\big) = \\alpha + \\beta \\log(d)$ with $\\beta > 0$.\n- Construct a bivariate normal prior for $(\\alpha,\\beta)$ with mean vector $(\\mu_\\alpha,\\mu_\\beta)$ and diagonal covariance $\\operatorname{diag}(\\sigma_\\alpha^2,\\sigma_\\beta^2)$ as follows, using two anchors derived from preclinical potency and exposure:\n  1. Let $E_{50}$ (in $\\mathrm{mg/kg}$) denote the animal potency benchmark (for example, half-maximal effective dose) and $T_{25}$ (in $\\mathrm{mg/kg}$) denote the animal dose associated with an estimated $25$-in-$100$ rate of severe adverse effects. Convert these to absolute human doses via the above allometric scaling and the given human body weight $W$ to get $d_S$ for $E_{50}$ and $d_{\\mathrm{tox}}$ for $T_{25}$.\n  2. Set a conservative toxicity anchor $d_L = f \\cdot d_{\\mathrm{tox}}$ with $f = 0.3$.\n  3. Impose the prior calibration constraints $\\operatorname{logit}\\!\\big(p(d_S)\\big) = \\operatorname{logit}(0.05)$ and $\\operatorname{logit}\\!\\big(p(d_L)\\big) = \\operatorname{logit}(0.25)$ and solve for $(\\mu_\\alpha,\\mu_\\beta)$ from the two linear equations in $\\alpha$ and $\\beta$.\n  4. Set $\\sigma_\\alpha = 1.5 \\times u$ and $\\sigma_\\beta = 0.75 \\times u$, where $u$ is an uncertainty scale factor provided in each test case. This yields $\\Sigma_0 = \\operatorname{diag}(\\sigma_\\alpha^2,\\sigma_\\beta^2)$.\n- Likelihood: For observed cohorts indexed by $j$ with dose $d_j$ (in $\\mathrm{mg}$), $n_j$ participants, and $y_j$ DLTs, assume independent Bernoulli outcomes with $p(d_j)$, so the likelihood is $\\prod_j \\left[p(d_j)\\right]^{y_j}\\left[1-p(d_j)\\right]^{n_j-y_j}$.\n\nPosterior computation and decision rule to implement:\n- Compute the posterior over $(\\alpha,\\beta)$ numerically by grid approximation, restricting to $\\beta > 0$. Use a rectangular grid spanning $\\alpha \\in [\\mu_\\alpha - 5\\sigma_\\alpha, \\mu_\\alpha + 5\\sigma_\\alpha]$ and $\\beta \\in [\\max(10^{-3}, \\mu_\\beta - 5\\sigma_\\beta), \\mu_\\beta + 5\\sigma_\\beta]$ with at least $121$ evenly spaced points in each dimension. Normalize the posterior on this grid.\n- For each candidate dose $d$ in the provided dose grid, compute the posterior mean toxicity $\\bar p(d) = \\mathbb{E}[p(d)\\mid \\text{data}]$ and the posterior exceedance probability $\\Pr\\!\\big(p(d) > \\theta_U \\mid \\text{data}\\big)$, where the target toxicity interval is $[\\theta_L,\\theta_U]$.\n- Overdose control: declare a dose $d$ acceptable if $\\Pr\\!\\big(p(d) > \\theta_U \\mid \\text{data}\\big) < \\eta$, where $\\eta$ is an overdose control threshold provided in each test case.\n- Recommendation: among acceptable doses, recommend the dose whose posterior mean toxicity $\\bar p(d)$ is closest (in absolute difference) to the target center $\\theta^\\star = (\\theta_L+\\theta_U)/2$. If no dose is acceptable, recommend $0\\,\\mathrm{mg}$ (encoded as $0$).\n\nTechnical requirements:\n- All doses are in $\\mathrm{mg}$. All input preclinical doses are in $\\mathrm{mg/kg}$. Body weights are in $\\mathrm{kg}$. Use natural logarithms. All probabilities must be treated as real numbers in $(0,1)$; report comparisons as booleans internally but the final recommendation is a dose in $\\mathrm{mg}$.\n- Angle units are not applicable.\n- Your program must implement the above procedure exactly and produce a single line of output containing the recommended next doses for all test cases, as a comma-separated list enclosed in square brackets.\n\nTest suite:\nProvide the recommendations for the following four test cases. Each test case specifies $(\\text{species}, W, E_{50}, T_{25}, \\text{dose\\_grid}, \\{(d_j,n_j,y_j)\\}, [\\theta_L,\\theta_U], \\eta, u)$.\n\n- Case $1$: species $=$ rat, $W = 70$, $E_{50} = 1.0$, $T_{25} = 10.0$, dose grid $= [5,10,20,40,80]$, observed cohorts $= \\{(5,3,0),(10,3,0)\\}$, target interval $= [0.16,0.33]$, $\\eta = 0.25$, $u = 1.5$.\n- Case $2$: species $=$ dog, $W = 70$, $E_{50} = 0.5$, $T_{25} = 2.0$, dose grid $= [5,10,20,40,80]$, observed cohorts $= \\{(5,3,1),(10,3,2)\\}$, target interval $= [0.16,0.33]$, $\\eta = 0.25$, $u = 2.0$.\n- Case $3$: species $=$ rat, $W = 70$, $E_{50} = 4.0$, $T_{25} = 40.0$, dose grid $= [5,10,20,40,80]$, observed cohorts $= \\{(5,3,0),(10,3,0),(20,6,1),(40,3,0)\\}$, target interval $= [0.16,0.33]$, $\\eta = 0.25$, $u = 1.5$.\n- Case $4$: species $=$ rat, $W = 70$, $E_{50} = 0.2$, $T_{25} = 1.0$, dose grid $= [5,10,20,40]$, observed cohorts $= \\{(5,3,3)\\}$, target interval $= [0.16,0.33]$, $\\eta = 0.25$, $u = 2.0$.\n\nFinal output format:\nYour program should produce a single line of output containing the recommended next doses (in $\\mathrm{mg}$) for cases $1$ through $4$, as a comma-separated list enclosed in square brackets (for example, $[d_1,d_2,d_3,d_4]$), with each $d_i$ an integer. If no dose is acceptable, return $0$ for that case.", "solution": "The problem requires the implementation of a Bayesian model-based dose-escalation decision rule for a Phase I clinical trial, a task central to translational medicine and biostatistics. The procedure involves constructing a prior distribution for model parameters from preclinical data, updating this prior to a posterior distribution using observed human data, and using the posterior to recommend the next dose. The entire process is grounded in first principles: Bayesian inference, logistic regression, and allometric scaling.\n\nThe analysis proceeds in four principal stages:\n1.  **Model and Likelihood Specification**: Definition of the statistical model linking dose to toxicity probability.\n2.  **Prior Elicitation**: Translation of preclinical animal data into an informative prior distribution for the model parameters.\n3.  **Posterior Computation**: Numerical calculation of the posterior distribution by combining the prior with the likelihood from observed human cohort data, via Bayes' theorem.\n4.  **Decision Making**: Application of a pre-specified rule to the posterior distribution to recommend the next dose.\n\n**1. Model and Likelihood Specification**\n\nThe probability of a Dose-Limiting Toxicity (DLT), $p$, at a given absolute human dose $d$ (in $\\mathrm{mg}$) is modeled using a two-parameter Bayesian Logistic Regression Model (BLRM). The relationship is defined via the logit link function:\n$$\n\\operatorname{logit}\\!\\big(p(d)\\big) = \\log\\left(\\frac{p(d)}{1-p(d)}\\right) = \\alpha + \\beta \\log(d)\n$$\nwhere $\\log$ is the natural logarithm. The model parameters are the intercept $\\alpha$ and the slope $\\beta$. The constraint $\\beta > 0$ is imposed, reflecting the biological assumption that toxicity is a monotonically non-decreasing function of dose. The probability $p(d)$ is recovered using the inverse of the logit function, the logistic function:\n$$\np(d) = \\operatorname{logistic}(\\alpha + \\beta \\log(d)) = \\frac{1}{1 + e^{-(\\alpha + \\beta \\log(d))}}\n$$\nGiven data from $k$ patient cohorts, where cohort $j$ consists of $n_j$ patients treated at dose $d_j$, among whom $y_j$ experienced a DLT, the outcomes are assumed to follow independent Bernoulli distributions. The likelihood function $p(\\text{data} \\mid \\alpha,\\beta)$, which measures how well the parameters $(\\alpha, \\beta)$ explain the observed data, is the product of the probabilities of the observed outcomes for all patients:\n$$\n\\mathcal{L}(\\alpha, \\beta \\mid \\text{data}) = \\prod_{j=1}^{k} \\left[p(d_j)\\right]^{y_j} \\left[1-p(d_j)\\right]^{n_j-y_j}\n$$\n\n**2. Prior Elicitation**\n\nBefore observing any human data, our knowledge about the parameters $(\\alpha, \\beta)$ is encoded in a prior distribution, $p(\\alpha, \\beta)$. As specified, this is a bivariate normal distribution with a diagonal covariance matrix:\n$$\n(\\alpha, \\beta) \\sim \\mathcal{N}\\left(\\begin{pmatrix} \\mu_\\alpha \\\\ \\mu_\\beta \\end{pmatrix}, \\begin{pmatrix} \\sigma_\\alpha^2 & 0 \\\\ 0 & \\sigma_\\beta^2 \\end{pmatrix}\\right)\n$$\nThe parameters of this prior distribution (the mean vector $(\\mu_\\alpha, \\mu_\\beta)$ and variances $\\sigma_\\alpha^2, \\sigma_\\beta^2$) are derived from preclinical animal data.\n\n**2.1. Allometric Scaling**:\nPreclinical benchmarks, the half-maximal effective dose $E_{50}$ and a toxic dose $T_{25}$ (both in $\\mathrm{mg/kg}$), are converted to Human Equivalent Doses (HED) in $\\mathrm{mg/kg}$ using a standard formula based on body surface area:\n$$\n\\mathrm{HED}_{\\mathrm{mg/kg}} = \\mathrm{AnimalDose}_{\\mathrm{mg/kg}} \\times \\frac{K_m(\\text{species})}{K_m(\\text{human})}\n$$\nThe provided species-specific factors are $K_m(\\text{human}) = 37$, $K_m(\\text{rat}) = 6$, and $K_m(\\text{dog}) = 20$. These HEDs are then converted to absolute human doses (in $\\mathrm{mg}$) by multiplying by a standard human body weight, $W$:\n$$\n\\mathrm{Dose}_{\\mathrm{mg}} = \\mathrm{HED}_{\\mathrm{mg/kg}} \\times W\n$$\nThis yields two key human dose levels: $d_S$ derived from $E_{50}$, representing a \"safe\" or sub-therapeutic dose, and $d_{\\mathrm{tox}}$ derived from $T_{25}$.\n\n**2.2. Prior Mean Elicitation**:\nThe mean of the prior, $(\\mu_\\alpha, \\mu_\\beta)$, is determined by calibrating the model to two anchor points. The first anchor assumes a low DLT probability, $p(d_S) = 0.05$, at the efficacy-related dose $d_S$. The second anchor uses a conservative toxic dose, $d_L = f \\cdot d_{\\mathrm{tox}}$ with a scaling factor $f=0.3$, and assumes a higher DLT probability, $p(d_L) = 0.25$. These assumptions create a system of two linear equations for $\\mu_\\alpha$ and $\\mu_\\beta$:\n$$\n\\mu_\\alpha + \\mu_\\beta \\log(d_S) = \\operatorname{logit}(0.05) \\approx -2.9444 \\\\\n\\mu_\\alpha + \\mu_\\beta \\log(d_L) = \\operatorname{logit}(0.25) \\approx -1.0986\n$$\nSolving this system yields the prior means:\n$$\n\\mu_\\beta = \\frac{\\operatorname{logit}(0.25) - \\operatorname{logit}(0.05)}{\\log(d_L) - \\log(d_S)} \\\\\n\\mu_\\alpha = \\operatorname{logit}(0.05) - \\mu_\\beta \\log(d_S)\n$$\n\n**2.3. Prior Variance Specification**:\nThe prior variances are set as a function of a provided uncertainty scale factor, $u$:\n$$\n\\sigma_\\alpha = 1.5 \\times u \\quad \\text{and} \\quad \\sigma_\\beta = 0.75 \\times u\n$$\nThese values define the initial uncertainty about the dose-toxicity curve before any human data is collected.\n\n**3. Posterior Computation**\n\nAccording to Bayes' theorem, the posterior probability density of the parameters given the data, $p(\\alpha, \\beta \\mid \\text{data})$, is proportional to the product of the likelihood and the prior:\n$$\np(\\alpha, \\beta \\mid \\text{data}) \\propto \\mathcal{L}(\\alpha, \\beta \\mid \\text{data}) \\times p(\\alpha, \\beta)\n$$\nThis posterior distribution represents our updated knowledge. It is computed numerically using grid approximation. A rectangular grid of points $(\\alpha_i, \\beta_j)$ is created. The grid for $\\alpha$ spans $[\\mu_\\alpha - 5\\sigma_\\alpha, \\mu_\\alpha + 5\\sigma_\\alpha]$, and for $\\beta$ spans $[\\max(10^{-3}, \\mu_\\beta - 5\\sigma_\\beta), \\mu_\\beta + 5\\sigma_\\beta]$. At each grid point, the unnormalized posterior value is calculated. To avoid numerical underflow, calculations are performed on the log scale:\n$$\n\\log p(\\alpha_i, \\beta_j \\mid \\text{data}) \\propto \\log\\mathcal{L}(\\alpha_i, \\beta_j \\mid \\text{data}) + \\log p(\\alpha_i, \\beta_j)\n$$\nwhere\n$$\n\\log\\mathcal{L}(\\alpha_i, \\beta_j \\mid \\text{data}) = \\sum_{k=1}^{K} \\left[ y_k (\\alpha_i + \\beta_j \\log d_k) - n_k \\log(1 + e^{\\alpha_i + \\beta_j \\log d_k}) \\right]\n$$\nand\n$$\n\\log p(\\alpha_i, \\beta_j) = -\\frac{1}{2}\\left[ \\left(\\frac{\\alpha_i-\\mu_\\alpha}{\\sigma_\\alpha}\\right)^2 + \\left(\\frac{\\beta_j-\\mu_\\beta}{\\sigma_\\beta}\\right)^2 \\right]\n$$\nThe resulting grid of log-posterior values is exponentiated and normalized by its sum to yield a discrete posterior probability mass function.\n\n**4. Decision Making**\n\nThe final step is to use the computed posterior distribution to guide the dose-escalation decision. The target toxicity interval is $[\\theta_L, \\theta_U]$. For each candidate dose $d$ in the provided dose grid, two posterior summaries are computed:\n\n-   **Posterior Mean Toxicity, $\\bar{p}(d)$**: The expected toxicity probability at dose $d$, averaging over the posterior distribution of $(\\alpha, \\beta)$.\n    $$\n    \\bar{p}(d) = \\mathbb{E}[p(d) \\mid \\text{data}] = \\sum_{i,j} p(d; \\alpha_i, \\beta_j) \\cdot \\text{Posterior}(\\alpha_i, \\beta_j)\n    $$\n-   **Posterior Exceedance Probability**: The probability that the true toxicity $p(d)$ exceeds the upper target threshold $\\theta_U$.\n    $$\n    \\Pr(p(d) > \\theta_U \\mid \\text{data}) = \\sum_{(i,j) \\text{ s.t. } p(d; \\alpha_i, \\beta_j) > \\theta_U} \\text{Posterior}(\\alpha_i, \\beta_j)\n    $$\n\nThe decision rule is as follows:\n-   **Overdose Control**: A dose $d$ is declared \"acceptable\" if its posterior exceedance probability is less than a specified threshold $\\eta$: $\\Pr(p(d) > \\theta_U \\mid \\text{data}) < \\eta$.\n-   **Recommendation**: Among all acceptable doses, the one whose posterior mean toxicity $\\bar{p}(d)$ is closest to the center of the target interval, $\\theta^\\star = (\\theta_L + \\theta_U)/2$, is recommended. The distance to minimize is $|\\bar{p}(d) - \\theta^\\star|$.\n-   **De-escalation/Stopping**: If no dose in the grid is found to be acceptable, it implies all available doses are considered too toxic, and the recommendation is to halt escalation and treat at a lower dose (represented as $0\\,\\mathrm{mg}$).\nThis comprehensive, principle-based procedure provides a rigorous and justifiable framework for making dose-escalation decisions in early-phase clinical trials.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final results.\n    \"\"\"\n    \n    # Define constants\n    KM_FACTORS = {'human': 37, 'rat': 6, 'dog': 20}\n    PRIOR_CALIBRATION_PROBS = {'p_S': 0.05, 'p_L': 0.25}\n    D_L_FACTOR = 0.3\n    \n    # Test cases as specified in the problem\n    test_cases = [\n        {\n            \"species\": \"rat\", \"W\": 70, \"E50\": 1.0, \"T25\": 10.0,\n            \"dose_grid\": [5, 10, 20, 40, 80],\n            \"cohorts\": [(5, 3, 0), (10, 3, 0)],\n            \"target_interval\": [0.16, 0.33], \"eta\": 0.25, \"u\": 1.5\n        },\n        {\n            \"species\": \"dog\", \"W\": 70, \"E50\": 0.5, \"T25\": 2.0,\n            \"dose_grid\": [5, 10, 20, 40, 80],\n            \"cohorts\": [(5, 3, 1), (10, 3, 2)],\n            \"target_interval\": [0.16, 0.33], \"eta\": 0.25, \"u\": 2.0\n        },\n        {\n            \"species\": \"rat\", \"W\": 70, \"E50\": 4.0, \"T25\": 40.0,\n            \"dose_grid\": [5, 10, 20, 40, 80],\n            \"cohorts\": [(5, 3, 0), (10, 3, 0), (20, 6, 1), (40, 3, 0)],\n            \"target_interval\": [0.16, 0.33], \"eta\": 0.25, \"u\": 1.5\n        },\n        {\n            \"species\": \"rat\", \"W\": 70, \"E50\": 0.2, \"T25\": 1.0,\n            \"dose_grid\": [5, 10, 20, 40],\n            \"cohorts\": [(5, 3, 3)],\n            \"target_interval\": [0.16, 0.33], \"eta\": 0.25, \"u\": 2.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        recommendation = get_recommendation(case, KM_FACTORS, PRIOR_CALIBRATION_PROBS, D_L_FACTOR)\n        results.append(recommendation)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef logit(p):\n    \"\"\"Computes the logit function.\"\"\"\n    return np.log(p / (1 - p))\n\ndef logistic(x):\n    \"\"\"Computes the logistic function.\"\"\"\n    return 1 / (1 + np.exp(-x))\n\ndef stable_log1p_exp(x):\n    \"\"\"Computes log(1 + exp(x)) in a numerically stable way.\"\"\"\n    return np.maximum(x, 0) + np.log1p(np.exp(-np.abs(x)))\n\ndef get_recommendation(case, km_factors, prior_probs, d_l_factor):\n    \"\"\"\n    Implements the full Bayesian decision rule for a single test case.\n    \"\"\"\n    # --- 1. Unpack Parameters and Construct Prior ---\n    species = case[\"species\"]\n    W, E50, T25 = case[\"W\"], case[\"E50\"], case[\"T25\"]\n    u = case[\"u\"]\n\n    # Allometric scaling to get human doses d_S and d_tox\n    km_species = km_factors[species]\n    km_human = km_factors['human']\n    \n    hed_e50 = E50 * (km_species / km_human)\n    d_S = hed_e50 * W\n    \n    hed_t25 = T25 * (km_species / km_human)\n    d_tox = hed_t25 * W\n    \n    d_L = d_l_factor * d_tox\n    \n    # Solve for prior means (mu_alpha, mu_beta)\n    logit_pS = logit(prior_probs['p_S'])\n    logit_pL = logit(prior_probs['p_L'])\n    \n    log_d_S = np.log(d_S)\n    log_d_L = np.log(d_L)\n    \n    # Solve the 2x2 linear system\n    mu_beta = (logit_pL - logit_pS) / (log_d_L - log_d_S)\n    mu_alpha = logit_pS - mu_beta * log_d_S\n    \n    # Calculate prior standard deviations\n    sigma_alpha = 1.5 * u\n    sigma_beta = 0.75 * u\n    \n    # --- 2. Posterior Computation (Grid Approximation) ---\n    grid_size = 201 \n    \n    # Define grids for alpha and beta\n    alpha_min, alpha_max = mu_alpha - 5 * sigma_alpha, mu_alpha + 5 * sigma_alpha\n    alphas = np.linspace(alpha_min, alpha_max, grid_size)\n    \n    beta_min = np.maximum(1e-3, mu_beta - 5 * sigma_beta)\n    beta_max = mu_beta + 5 * sigma_beta\n    betas = np.linspace(beta_min, beta_max, grid_size)\n    \n    alpha_grid, beta_grid = np.meshgrid(alphas, betas)\n    \n    # Calculate log prior probability (up to a constant)\n    log_prior = -0.5 * (((alpha_grid - mu_alpha) / sigma_alpha)**2 + ((beta_grid - mu_beta) / sigma_beta)**2)\n    \n    # Calculate log likelihood from observed human cohorts\n    log_likelihood = np.zeros_like(alpha_grid)\n    for d_j, n_j, y_j in case[\"cohorts\"]:\n        log_d_j = np.log(d_j)\n        eta_j_grid = alpha_grid + beta_grid * log_d_j\n        log_likelihood += y_j * eta_j_grid - n_j * stable_log1p_exp(eta_j_grid)\n        \n    # Calculate log posterior (unnormalized)\n    log_posterior = log_prior + log_likelihood\n    \n    # Normalize posterior probability grid\n    log_posterior -= np.max(log_posterior)\n    posterior = np.exp(log_posterior)\n    posterior /= np.sum(posterior)\n    \n    # --- 3. Decision Making ---\n    dose_grid = case[\"dose_grid\"]\n    theta_L, theta_U = case[\"target_interval\"]\n    eta = case[\"eta\"]\n    target_center = (theta_L + theta_U) / 2.0\n    \n    acceptable_doses = []\n    \n    for d_cand in dose_grid:\n        log_d_cand = np.log(d_cand)\n        eta_cand_grid = alpha_grid + beta_grid * log_d_cand\n        \n        # Calculate p(d) for each point in the posterior grid\n        p_cand_grid = logistic(eta_cand_grid)\n        \n        # Calculate posterior exceedance probability\n        exceedance_prob = np.sum(posterior[p_cand_grid > theta_U])\n        \n        if exceedance_prob  eta:\n            # This dose is acceptable; calculate its posterior mean toxicity\n            mean_toxicity = np.sum(p_cand_grid * posterior)\n            acceptable_doses.append((d_cand, mean_toxicity))\n            \n    if not acceptable_doses:\n        return 0\n    \n    # Find the best dose among the acceptable ones\n    best_dose = -1\n    min_dist = float('inf')\n    \n    for d, mean_tox in acceptable_doses:\n        dist = abs(mean_tox - target_center)\n        if dist  min_dist:\n            min_dist = dist\n            best_dose = d\n            \n    return int(best_dose)\n\nsolve()\n```", "id": "5003226"}]}