{"hands_on_practices": [{"introduction": "In clinical research, failing to account for relevant biological variables can lead to flawed conclusions. This first practice problem demonstrates a fundamental pitfall: omitted variable bias. By working through this scenario, you will derive and quantify the bias in a treatment effect estimate that arises when sex is ignored in a statistical model, even in a randomized trial where confounding might be assumed to be absent [@problem_id:5061100]. This exercise highlights the critical importance of including sex as a biological variable to ensure the validity of your analytical results.", "problem": "A pragmatic two-arm translational medicine study evaluates a new lipid-modulating therapy against standard care. The primary endpoint is the 12-week change in low-density lipoprotein cholesterol measured in milligrams per deciliter (mg/dL), denoted by the random variable $Y$. Let the binary treatment indicator be $T \\in \\{0,1\\}$, where $T=1$ for the new therapy and $T=0$ for standard care. Let the binary sex indicator be $S \\in \\{0,1\\}$, where $S=1$ for male and $S=0$ for female. Assume the following structural outcome model holds in the study population:\n$$\nY \\;=\\; \\beta_{0} \\;+\\; \\beta_{1} T \\;+\\; \\beta_{2} S \\;+\\; \\varepsilon,\n$$\nwith $E[\\varepsilon \\mid T,S] = 0$ and no treatment-by-sex interaction, so the effect of sex is additive and constant across treatment arms.\n\nDue to post-randomization differential retention, sex is imbalanced across arms, creating a correlation between $T$ and $S$. Suppose the marginal and conditional distributions are\n$$\nP(T=1) \\;=\\; 0.5,\\qquad P(S=1 \\mid T=1) \\;=\\; 0.70,\\qquad P(S=1 \\mid T=0) \\;=\\; 0.40.\n$$\nA prior pharmacokinetic-pharmacodynamic analysis has robustly established that, holding treatment fixed, males experience a lower reduction in $Y$ relative to females by an average of $4$ mg/dL, so the sex coefficient is\n$$\n\\beta_{2} \\;=\\; -4 \\;\\text{ mg/dL}.\n$$\n\nAn analyst mistakenly omits sex from the model and fits $Y$ on $T$ using Ordinary Least Squares (OLS) in the population limit. Define the bias in the estimated treatment effect as\n$$\nB \\;=\\; E\\!\\left[\\hat{\\beta}_{1}^{\\text{omit}}\\right] \\;-\\; \\beta_{1},\n$$\nwhere $\\hat{\\beta}_{1}^{\\text{omit}}$ is the OLS coefficient from regressing $Y$ on $T$ alone. Starting only from the definitions of the linear model above, the OLS normal equations, and the definitions of variance and covariance, derive $B$ and compute its numerical value. Express the final bias in milligrams per deciliter (mg/dL). If rounding is required, round your answer to four significant figures.", "solution": "The problem statement is validated as scientifically grounded, well-posed, and objective. It presents a standard problem in statistical modeling, specifically addressing omitted variable bias within the context of a clinical trial analysis, which is central to translational medicine. All data and conditions provided are consistent and sufficient for deriving a unique, meaningful solution.\n\nThe objective is to compute the bias $B = E[\\hat{\\beta}_{1}^{\\text{omit}}] - \\beta_{1}$. The term $\\hat{\\beta}_{1}^{\\text{omit}}$ represents the Ordinary Least Squares (OLS) estimator of the coefficient for the treatment indicator $T$ from a simple linear regression of the outcome $Y$ on $T$ alone. In the population limit, this estimator converges to the true population parameter, which is given by the ratio of the covariance to the variance:\n$$\nE\\left[\\hat{\\beta}_{1}^{\\text{omit}}\\right] = \\frac{\\text{Cov}(T, Y)}{\\text{Var}(T)}\n$$\nThe true structural model for the outcome $Y$ is given as:\n$$\nY = \\beta_{0} + \\beta_{1} T + \\beta_{2} S + \\varepsilon\n$$\nwhere $E[\\varepsilon \\mid T,S] = 0$. We can substitute this expression for $Y$ into the covariance term:\n$$\n\\text{Cov}(T, Y) = \\text{Cov}(T, \\beta_{0} + \\beta_{1} T + \\beta_{2} S + \\varepsilon)\n$$\nUsing the linearity property of the covariance operator, we expand this expression:\n$$\n\\text{Cov}(T, Y) = \\text{Cov}(T, \\beta_{0}) + \\text{Cov}(T, \\beta_{1} T) + \\text{Cov}(T, \\beta_{2} S) + \\text{Cov}(T, \\varepsilon)\n$$\nWe evaluate each term:\n1.  $\\text{Cov}(T, \\beta_{0}) = 0$, as the covariance of a random variable with a constant is zero.\n2.  $\\text{Cov}(T, \\beta_{1} T) = \\beta_{1} \\text{Cov}(T, T) = \\beta_{1} \\text{Var}(T)$.\n3.  $\\text{Cov}(T, \\beta_{2} S) = \\beta_{2} \\text{Cov}(T, S)$.\n4.  $\\text{Cov}(T, \\varepsilon) = E[T \\varepsilon] - E[T]E[\\varepsilon]$. The assumption $E[\\varepsilon \\mid T,S] = 0$ implies, by the law of total expectation, that $E[\\varepsilon] = E[E[\\varepsilon \\mid T,S]] = 0$. It also implies $E[\\varepsilon \\mid T] = E_{S \\mid T}[E[\\varepsilon \\mid T,S]] = 0$. Therefore, $E[T\\varepsilon] = E[E[T\\varepsilon \\mid T]] = E[T E[\\varepsilon \\mid T]] = E[T \\cdot 0] = 0$. Thus, $\\text{Cov}(T, \\varepsilon) = 0 - E[T] \\cdot 0 = 0$.\n\nSubstituting these back gives:\n$$\n\\text{Cov}(T, Y) = \\beta_{1} \\text{Var}(T) + \\beta_{2} \\text{Cov}(T, S)\n$$\nNow we can write the full expression for $E[\\hat{\\beta}_{1}^{\\text{omit}}]$:\n$$\nE\\left[\\hat{\\beta}_{1}^{\\text{omit}}\\right] = \\frac{\\beta_{1} \\text{Var}(T) + \\beta_{2} \\text{Cov}(T, S)}{\\text{Var}(T)} = \\beta_{1} + \\beta_{2} \\frac{\\text{Cov}(T, S)}{\\text{Var}(T)}\n$$\nThe bias $B$ is then derived as:\n$$\nB = E\\left[\\hat{\\beta}_{1}^{\\text{omit}}\\right] - \\beta_{1} = \\left(\\beta_{1} + \\beta_{2} \\frac{\\text{Cov}(T, S)}{\\text{Var}(T)}\\right) - \\beta_{1} = \\beta_{2} \\frac{\\text{Cov}(T, S)}{\\text{Var}(T)}\n$$\nTo compute the numerical value of $B$, we must calculate $\\text{Var}(T)$ and $\\text{Cov}(T, S)$ from the given probabilities. The variable $T$ is a Bernoulli random variable since $T \\in \\{0, 1\\}$.\nGiven $P(T=1) = 0.5$, the expectation and variance of $T$ are:\n$$\nE[T] = P(T=1) = 0.5\n$$\n$$\n\\text{Var}(T) = E[T^2] - (E[T])^2 = P(T=1) - (P(T=1))^2 = 0.5 - (0.5)^2 = 0.5 - 0.25 = 0.25\n$$\nNext, we calculate $\\text{Cov}(T, S) = E[TS] - E[T]E[S]$. The variable $S$ is also Bernoulli, $S \\in \\{0, 1\\}$.\nWe need $E[S]$ and $E[TS]$.\nThe expectation of $S$ is $E[S] = P(S=1)$. Using the law of total probability:\n$$\nP(S=1) = P(S=1 \\mid T=1)P(T=1) + P(S=1 \\mid T=0)P(T=0)\n$$\nWe are given $P(T=1)=0.5$, so $P(T=0) = 1 - 0.5 = 0.5$.\n$$\nP(S=1) = (0.70)(0.5) + (0.40)(0.5) = 0.35 + 0.20 = 0.55\n$$\nSo, $E[S] = 0.55$.\nThe expectation of the product $TS$ for binary variables is the joint probability $P(T=1, S=1)$:\n$$\nE[TS] = P(T=1, S=1)\n$$\nUsing the definition of conditional probability, $P(T=1, S=1) = P(S=1 \\mid T=1)P(T=1)$:\n$$\nE[TS] = (0.70)(0.5) = 0.35\n$$\nNow we compute the covariance:\n$$\n\\text{Cov}(T, S) = E[TS] - E[T]E[S] = 0.35 - (0.5)(0.55) = 0.35 - 0.275 = 0.075\n$$\nFinally, we substitute the known and calculated values into the formula for the bias $B$. We are given $\\beta_{2} = -4$ mg/dL.\n$$\nB = \\beta_{2} \\frac{\\text{Cov}(T, S)}{\\text{Var}(T)} = (-4) \\frac{0.075}{0.25}\n$$\nThe ratio is $\\frac{0.075}{0.25} = 0.3$.\n$$\nB = -4 \\times 0.3 = -1.2\n$$\nThe bias in the estimated treatment effect is $-1.2$ mg/dL. This value is exact and does not require rounding.", "answer": "$$\n\\boxed{-1.2}\n$$", "id": "5061100"}, {"introduction": "Recognizing that a treatment's effect may differ between sexes is the first step; the next is designing studies with enough statistical power to detect such differences. This exercise moves from analysis to prospective design, tasking you with calculating the required sample size to identify a sex-by-treatment interaction within a pharmacodynamic model [@problem_id:5061099]. Mastering this process is essential for planning efficient and informative translational studies that can uncover clinically meaningful, sex-specific therapeutic responses.", "problem": "A translational pharmacodynamic study will evaluate a sex-by-treatment interaction in an $E_{\\max}$ pharmacodynamic (PD) model, treating sex as a biological variable. The response model for an individual at dose $d$ with sex indicator $S \\in \\{-1, +1\\}$ (e.g., $S=+1$ for females and $S=-1$ for males) is\n$$\n\\mu(d,S) \\;=\\; E_{0} \\;+\\; \\big(E_{\\max} \\;+\\; \\psi\\,S\\big)\\,\\frac{d}{ED_{50} + d},\n$$\nwhere $E_{0}$ is the baseline response, $E_{\\max}$ is the maximum drug effect, $ED_{50}$ is the dose producing half of $E_{\\max}$, and $\\psi$ is the sex-by-treatment interaction parameter that modulates $E_{\\max}$ by sex. Assume independent, homoscedastic, normally distributed errors with variance $\\sigma^{2}$.\n\nThe study will randomize participants equally by sex across four dose levels $d \\in \\{0, 10, 30, 100\\}\\,\\mathrm{mg}$ with equal allocation within each sex-by-dose cell. For design calculations, treat $ED_{50}$ as known and equal to $20\\,\\mathrm{mg}$, and assume the residual variance is $\\sigma^{2}=0.64$. Investigators wish to detect a true interaction $\\psi=\\psi^{\\star}=0.25$ (in response units) using a two-sided hypothesis test at significance level $\\alpha=0.05$ with desired power $1-\\beta=0.90$.\n\nStarting from first principles appropriate for nonlinear regression in translational pharmacology—namely, the first-order Taylor linearization of the mean function, asymptotic normality of the estimator of $\\psi$ under regularity conditions, and the Wald test—derive the sample size formula under the given balanced design and compute the minimal total sample size $N$ (across all sexes and doses) required to achieve the desired power under these assumptions. Use standard normal critical values for the Wald test, ignore finite-sample corrections, and take the minimal integer $N$ that achieves at least the target power under equal allocation across the $2 \\times 4$ cells. Report $N$ as a single integer with no units.", "solution": "The user-provided problem is valid. It is scientifically grounded in pharmacodynamics and biostatistics, self-contained, and well-posed. All necessary parameters and conditions for a unique solution are provided.\n\nThe objective is to derive a formula for the total sample size $N$ required to detect a specific sex-by-treatment interaction effect $\\psi$ and to compute its numerical value. The derivation will be based on the first-order Taylor expansion of the nonlinear mean function, the asymptotic properties of the parameter estimators, and the Wald test.\n\nThe pharmacodynamic response model for an individual is given by:\n$$\n\\mu(d,S) = E_{0} + (E_{\\max} + \\psi S) \\frac{d}{ED_{50} + d}\n$$\nwhere $d$ is the dose and $S \\in \\{-1, +1\\}$ is the sex indicator. The parameters to be estimated are $\\theta = (E_{0}, E_{\\max}, \\psi)^T$. For the purpose of design, $ED_{50}$ is considered known. Let's define the dose-dependent part of the model as $g(d) = \\frac{d}{ED_{50} + d}$. The mean function can then be written as:\n$$\n\\mu(d, S; \\theta) = E_{0} + (E_{\\max} + \\psi S) g(d)\n$$\nThe variance of the observations is $\\sigma^2$. For a single observation, the Fisher Information Matrix (FIM) is given by $I(\\theta) = \\frac{1}{\\sigma^2} \\left(\\frac{\\partial \\mu}{\\partial \\theta}\\right) \\left(\\frac{\\partial \\mu}{\\partial \\theta}\\right)^T$. We first compute the gradient of the mean function with respect to the parameters $\\theta = (E_{0}, E_{\\max}, \\psi)^T$:\n$$\n\\frac{\\partial \\mu}{\\partial \\theta} = \\begin{pmatrix} \\frac{\\partial \\mu}{\\partial E_{0}} \\\\ \\frac{\\partial \\mu}{\\partial E_{\\max}} \\\\ \\frac{\\partial \\mu}{\\partial \\psi} \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ g(d) \\\\ S \\cdot g(d) \\end{pmatrix}\n$$\nThe FIM for a single subject at dose $d$ and sex $S$ is then:\n$$\nI(d, S) = \\frac{1}{\\sigma^2} \\begin{pmatrix} 1 \\\\ g(d) \\\\ S g(d) \\end{pmatrix} \\begin{pmatrix} 1 & g(d) & S g(d) \\end{pmatrix} = \\frac{1}{\\sigma^2} \\begin{pmatrix} 1 & g(d) & S g(d) \\\\ g(d) & g(d)^2 & S g(d)^2 \\\\ S g(d) & S g(d)^2 & S^2 g(d)^2 \\end{pmatrix}\n$$\nSince $S \\in \\{-1, +1\\}$, we have $S^2 = 1$.\n$$\nI(d, S) = \\frac{1}{\\sigma^2} \\begin{pmatrix} 1 & g(d) & S g(d) \\\\ g(d) & g(d)^2 & S g(d)^2 \\\\ S g(d) & S g(d)^2 & g(d)^2 \\end{pmatrix}\n$$\nThe study design specifies a total sample size $N$ with equal allocation across $2$ sexes and $4$ dose levels, resulting in $8$ cells. Let $n$ be the number of subjects per cell, so $N = 8n$. The total FIM, $I_N$, is the sum of the individual FIMs over all $N$ subjects. Due to the balanced design, this is $n$ times the sum of the FIMs over the $8$ unique design cells $(d_k, S_j)$:\n$$\nI_N = n \\sum_{k=1}^{4} \\sum_{j \\in \\{-1, +1\\}} I(d_k, S_j) = \\frac{n}{\\sigma^2} \\sum_{k=1}^{4} \\left( \\begin{pmatrix} 1 & g(d_k) & -g(d_k) \\\\ g(d_k) & g(d_k)^2 & -g(d_k)^2 \\\\ -g(d_k) & -g(d_k)^2 & g(d_k)^2 \\end{pmatrix} + \\begin{pmatrix} 1 & g(d_k) & +g(d_k) \\\\ g(d_k) & g(d_k)^2 & +g(d_k)^2 \\\\ +g(d_k) & +g(d_k)^2 & g(d_k)^2 \\end{pmatrix} \\right)\n$$\nSumming over the sex indicator $S$ for each dose level $d_k$ yields:\n$$\nI_N = \\frac{n}{\\sigma^2} \\sum_{k=1}^{4} \\begin{pmatrix} 2 & 2g(d_k) & 0 \\\\ 2g(d_k) & 2g(d_k)^2 & 0 \\\\ 0 & 0 & 2g(d_k)^2 \\end{pmatrix}\n$$\nThis block-diagonal structure is a result of the balanced design with respect to sex, making the estimator for $\\psi$ asymptotically orthogonal to the estimators for $E_0$ and $E_{\\max}$. Summing over the four dose levels $d_k \\in \\{0, 10, 30, 100\\}$:\n$$\nI_N = \\frac{2n}{\\sigma^2} \\begin{pmatrix} \\sum_{k=1}^{4} 1 & \\sum_{k=1}^{4} g(d_k) & 0 \\\\ \\sum_{k=1}^{4} g(d_k) & \\sum_{k=1}^{4} g(d_k)^2 & 0 \\\\ 0 & 0 & \\sum_{k=1}^{4} g(d_k)^2 \\end{pmatrix} = \\frac{2n}{\\sigma^2} \\begin{pmatrix} 4 & \\sum g(d_k) & 0 \\\\ \\sum g(d_k) & \\sum g(d_k)^2 & 0 \\\\ 0 & 0 & \\sum g(d_k)^2 \\end{pmatrix}\n$$\nThe asymptotic variance of $\\hat{\\psi}$ is the inverse of the $(3,3)$-element of $I_N$:\n$$\n\\mathrm{Var}(\\hat{\\psi}) = \\left( [I_N]_{33} \\right)^{-1} = \\left( \\frac{2n}{\\sigma^2} \\sum_{k=1}^{4} g(d_k)^2 \\right)^{-1} = \\frac{\\sigma^2}{2n \\sum_{k=1}^{4} g(d_k)^2}\n$$\nSubstituting $n = N/8$:\n$$\n\\mathrm{Var}(\\hat{\\psi}) = \\frac{\\sigma^2}{2(N/8) \\sum g(d_k)^2} = \\frac{4\\sigma^2}{N \\sum g(d_k)^2}\n$$\nThe Wald test statistic for the hypothesis $H_0: \\psi=0$ versus $H_a: \\psi \\neq 0$ is $W = \\hat{\\psi} / \\mathrm{SE}(\\hat{\\psi})$, where $\\mathrm{SE}(\\hat{\\psi}) = \\sqrt{\\mathrm{Var}(\\hat{\\psi})}$. For a two-sided test with significance level $\\alpha$ and power $1-\\beta$ to detect an effect $\\psi = \\psi^{\\star}$, the required sample size must satisfy:\n$$\n\\frac{|\\psi^{\\star}|}{\\mathrm{SE}(\\hat{\\psi})} \\ge z_{1-\\alpha/2} + z_{1-\\beta}\n$$\nwhere $z_q$ is the $q$-th quantile of the standard normal distribution. Substituting the expression for $\\mathrm{SE}(\\hat{\\psi})$:\n$$\n\\frac{|\\psi^{\\star}| \\sqrt{N \\sum g(d_k)^2}}{2\\sigma} \\ge z_{1-\\alpha/2} + z_{1-\\beta}\n$$\nSolving for $N$ gives the sample size formula:\n$$\nN \\ge \\frac{4\\sigma^2 (z_{1-\\alpha/2} + z_{1-\\beta})^2}{(\\psi^{\\star})^2 \\sum_{k=1}^{4} g(d_k)^2}\n$$\nWe now substitute the given values. The dose levels are $d \\in \\{0, 10, 30, 100\\}$ and $ED_{50}=20$. The values of $g(d) = d/(20+d)$ are:\n$g(0) = \\frac{0}{20+0} = 0$\n$g(10) = \\frac{10}{20+10} = \\frac{1}{3}$\n$g(30) = \\frac{30}{20+30} = \\frac{3}{5}$\n$g(100) = \\frac{100}{20+100} = \\frac{5}{6}$\n\nThe sum of squares is:\n$$\n\\sum_{k=1}^{4} g(d_k)^2 = 0^2 + \\left(\\frac{1}{3}\\right)^2 + \\left(\\frac{3}{5}\\right)^2 + \\left(\\frac{5}{6}\\right)^2 = \\frac{1}{9} + \\frac{9}{25} + \\frac{25}{36}\n$$\nThe least common multiple of $9$, $25$, and $36$ is $900$.\n$$\n\\sum_{k=1}^{4} g(d_k)^2 = \\frac{100}{900} + \\frac{324}{900} + \\frac{625}{900} = \\frac{1049}{900}\n$$\nThe other parameters are: $\\sigma^2 = 0.64$, $\\psi^{\\star} = 0.25$, $\\alpha=0.05$, and $1-\\beta=0.90$. The critical values are $z_{1-0.05/2} = z_{0.975} \\approx 1.96$ and $z_{1-0.10} = z_{0.90} \\approx 1.2816$.\n\nSubstituting these values into the sample size formula:\n$$\nN \\ge \\frac{4(0.64) (1.96 + 1.2816)^2}{(0.25)^2 \\left(\\frac{1049}{900}\\right)}\n$$\n$$\nN \\ge \\frac{2.56 \\cdot (3.2416)^2}{0.0625 \\cdot \\frac{1049}{900}} = \\frac{2.56 \\cdot 10.50797056}{\\frac{1049}{14400}}\n$$\n$$\nN \\ge \\frac{26.9004046... \\cdot 14400}{1049} = \\frac{387365.826...}{1049} \\approx 369.27\n$$\nThe total sample size $N$ must be an integer. Furthermore, the design requires equal allocation across the $8$ sex-by-dose cells, meaning $N$ must be a multiple of $8$. We must find the smallest multiple of $8$ that is greater than or equal to $369.27$.\n$369.27 / 8 \\approx 46.16$. The next integer is $47$.\nThus, the required number of subjects per cell is $n=47$.\nThe total minimal sample size is $N = 8 \\times n = 8 \\times 47 = 376$.", "answer": "$$\\boxed{376}$$", "id": "5061099"}, {"introduction": "The ultimate goal of studying sex as a biological variable is to improve health outcomes, often through tailored therapeutic strategies. This final hands-on practice puts this principle into action by tasking you with developing and simulating a phase-specific dosing algorithm for a hypothetical drug affected by the menstrual cycle [@problem_id:5061066]. This computational exercise demonstrates how pharmacokinetic modeling can translate biological understanding into a dosing rule that reduces exposure variability, representing a concrete step toward personalized medicine.", "problem": "You are asked to formalize a dosing rule that accounts for menstrual cycle phase effects on clearance and bioavailability and to quantify how this rule influences exposure variability, using a simple linear pharmacokinetic model that is standard in translational medicine. The modeling must explicitly treat sex as a biological variable by incorporating menstrual cycle phases. Work from the following fundamental base: in a one-compartment linear pharmacokinetic system with first-order elimination, the single-dose area under the concentration-time curve (Area Under the Curve (AUC)) for an oral dose is given by $AUC = \\dfrac{D \\cdot F}{CL}$, where $D$ is dose, $F$ is fraction absorbed (bioavailability), and $CL$ is clearance. Menstrual cycle phase can modulate $CL$ and $F$ through biologically plausible mechanisms (for example, hormone-mediated changes in hepatic blood flow or gastrointestinal physiology). \n\nYour task is to:\n1) Derive, from the base relation $AUC = \\dfrac{D \\cdot F}{CL}$, a phase-specific dosing rule that equalizes the expected AUC across menstrual phases to a chosen reference phase under the assumption of linear kinetics. Use the typical (population mean) parameters for each phase to construct the dosing rule, and define the reference AUC as the expected AUC in the reference phase given a specified reference dose. Do not assume any nonlinear kinetics or time-varying clearance within a dose interval. \n2) Implement a simulation to estimate the expected AUC in each phase with and without this dosing rule using interindividual variability. Model interindividual variability in $CL$ and $F$ as independent log-normal random variables centered at their phase-specific means with specified coefficients of variation (CV). To construct a log-normal variable $X$ with arithmetic mean $\\mu$ and coefficient of variation $CV_X$ (expressed as a decimal, for example $0.3$), use the parameterization $X = \\mu \\cdot \\exp(\\eta)$ with $\\eta \\sim \\mathcal{N}(-\\tfrac{1}{2}\\sigma^2, \\sigma^2)$ and $\\sigma^2 = \\ln(1 + CV_X^2)$. Use independence between $CL$ and $F$ and across phases.\n\nPhases are ordered as $[$menses, follicular, ovulatory, luteal$]$. Assume the reference phase for the dosing rule is the follicular phase. For each test case below, do the following:\n- Compute the adjusted dose for each phase that equalizes the expected AUC to the follicular-phase expected AUC (based on phase means).\n- Simulate $N$ virtual participants per phase using the specified seed, drawing $CL_i$ and $F_i$ as described above. For the non-adjusted scenario, compute $AUC_i = \\dfrac{D_{\\text{ref}} \\cdot F_i}{CL_i}$. For the adjusted scenario, compute $AUC_i = \\dfrac{D_{\\text{phase}} \\cdot F_i}{CL_i}$. \n- For each phase and scenario, report the arithmetic mean AUC across the $N$ samples. Express AUC in mg·h/L, rounded to three decimals. Report adjusted doses in mg, rounded to three decimals. Coefficients of variation are provided as decimals (for example, $0.3$ rather than $30$ percent).\n- Angles are not used in this problem.\n- All physical quantities that require units must be expressed in the specified units. For AUC, use mg·h/L; for dose, use mg; for clearance, use L/h; for bioavailability, use unitless fraction.\n\nTest Suite (three cases):\n- Case $1$ (happy path):\n  - Reference dose $D_{\\text{ref}} = $ $100$ mg; base clearance $CL_{\\text{base}} = $ $12$ L/h; base bioavailability $F_{\\text{base}} = $ $0.6$.\n  - Phase multipliers for clearance: menses $1.0$, follicular $0.95$, ovulatory $0.90$, luteal $1.10$.\n  - Phase multipliers for bioavailability: menses $0.95$, follicular $1.00$, ovulatory $1.05$, luteal $1.10$.\n  - Interindividual variability: $CV_{CL} = $ $0.30$, $CV_{F} = $ $0.20$.\n  - Simulation size $N = $ $50000$, random seed $11$.\n- Case $2$ (boundary: no phase effects, no variability):\n  - Reference dose $D_{\\text{ref}} = $ $100$ mg; base clearance $CL_{\\text{base}} = $ $10$ L/h; base bioavailability $F_{\\text{base}} = $ $0.5$.\n  - Phase multipliers for clearance: menses $1.0$, follicular $1.0$, ovulatory $1.0$, luteal $1.0$.\n  - Phase multipliers for bioavailability: menses $1.0$, follicular $1.0$, ovulatory $1.0$, luteal $1.0$.\n  - Interindividual variability: $CV_{CL} = $ $0.0$, $CV_{F} = $ $0.0$.\n  - Simulation size $N = $ $1000$, random seed $7$.\n- Case $3$ (edge: strong phase shifts and high variability):\n  - Reference dose $D_{\\text{ref}} = $ $50$ mg; base clearance $CL_{\\text{base}} = $ $20$ L/h; base bioavailability $F_{\\text{base}} = $ $0.3$.\n  - Phase multipliers for clearance: menses $1.20$, follicular $1.00$, ovulatory $0.85$, luteal $1.10$.\n  - Phase multipliers for bioavailability: menses $0.80$, follicular $1.00$, ovulatory $1.20$, luteal $0.90$.\n  - Interindividual variability: $CV_{CL} = $ $0.60$, $CV_{F} = $ $0.40$.\n  - Simulation size $N = $ $40000$, random seed $23$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element corresponds to one test case in the same order as listed above and must itself be a list of three lists: \n- the first inner list contains the four phase-specific mean AUC values under the non-adjusted reference dose $D_{\\text{ref}}$ in mg·h/L, \n- the second inner list contains the four phase-specific mean AUC values under the adjusted doses in mg·h/L,\n- the third inner list contains the four phase-specific adjusted doses in mg. \n\nAll floats must be rounded to three decimals. The phase order within each inner list is $[$menses, follicular, ovulatory, luteal$]$. For example, the overall format must be \n$[$ $[$ $[$fixed\\_menses$, $fixed\\_follicular$, $fixed\\_ovulatory$, $fixed\\_luteal$ $]$, $[$adjusted\\_menses$, $adjusted\\_follicular$, $adjusted\\_ovulatory$, $adjusted\\_luteal$ $]$, $[$dose\\_menses$, $dose\\_follicular$, $dose\\_ovulatory$, $dose\\_luteal$ $]$ $]$, $[$\\dots$]$, $[$\\dots$]$ $]$.", "solution": "Begin with the foundational linear pharmacokinetic relationship for a single oral dose: $AUC = \\dfrac{D \\cdot F}{CL}$, where $D$ is dose (mg), $F$ is bioavailability (unitless fraction), and $CL$ is clearance (L/h). Let the menstrual cycle phase index be $p \\in \\{\\text{menses}, \\text{follicular}, \\text{ovulatory}, \\text{luteal}\\}$. Let $CL_{\\text{base}}$ and $F_{\\text{base}}$ be baseline values and $\\theta_{CL,p}$ and $\\theta_{F,p}$ be multiplicative phase effects such that the phase-specific means are $CL_p = CL_{\\text{base}} \\cdot \\theta_{CL,p}$ and $F_p = F_{\\text{base}} \\cdot \\theta_{F,p}$.\n\nDerivation of the dosing rule. Choose a reference phase $r$ (here, the follicular phase) and a reference dose $D_{\\text{ref}}$. The reference expected AUC at the typical level (ignoring interindividual variability) is \n$$AUC_r^{\\star} = \\frac{D_{\\text{ref}} \\cdot F_r}{CL_r}.$$\nTo equalize the typical AUC in another phase $p$ to this reference target, choose a phase-specific dose $D_p$ so that, at the level of phase means,\n$$\\frac{D_p \\cdot F_p}{CL_p} = \\frac{D_{\\text{ref}} \\cdot F_r}{CL_r}.$$\nSolving for $D_p$ yields\n$$D_p = D_{\\text{ref}} \\cdot \\frac{CL_p / F_p}{CL_r / F_r}.$$\nThis rule arises directly from proportionality in the base equation: dose is proportional to $CL/F$ to maintain $AUC$.\n\nModeling interindividual variability. For each participant $i$ in phase $p$, model $CL_{p,i}$ and $F_{p,i}$ as independent log-normal random variables centered at the phase means $CL_p$ and $F_p$ with specified coefficients of variation $CV_{CL}$ and $CV_{F}$ (decimals). For a generic quantity $X$ with arithmetic mean $\\mu$ and coefficient of variation $CV_X$, define $\\sigma_X^2 = \\ln(1 + CV_X^2)$ and sample\n$$X_i = \\mu \\cdot \\exp(\\eta_i), \\quad \\eta_i \\sim \\mathcal{N}\\!\\left(-\\frac{1}{2}\\sigma_X^2,\\ \\sigma_X^2\\right).$$\nThis parameterization ensures $\\mathbb{E}[X_i] = \\mu$ and $\\text{Var}(X_i) = (e^{\\sigma_X^2} - 1)\\mu^2$, so the arithmetic coefficient of variation equals $CV_X$.\n\nFor each phase $p$, compute two AUC sets per participant $i$:\n- Non-adjusted (reference dose): $AUC_{p,i}^{(\\text{fixed})} = \\dfrac{D_{\\text{ref}} \\cdot F_{p,i}}{CL_{p,i}}$.\n- Adjusted (phase-specific dose): $AUC_{p,i}^{(\\text{adj})} = \\dfrac{D_p \\cdot F_{p,i}}{CL_{p,i}}$.\n\nReport per phase the arithmetic mean across $i = 1, \\dots, N$. Because $F_{p,i}$ and $CL_{p,i}$ are independent log-normal variables centered on means $F_p$ and $CL_p$, the non-adjusted expected AUC satisfies\n$$\\mathbb{E}\\!\\left[AUC_{p,i}^{(\\text{fixed})}\\right] = D_{\\text{ref}} \\cdot \\mathbb{E}\\!\\left[\\frac{F_{p,i}}{CL_{p,i}}\\right] = D_{\\text{ref}} \\cdot \\mathbb{E}[F_{p,i}] \\cdot \\mathbb{E}\\!\\left[\\frac{1}{CL_{p,i}}\\right].$$\nWith the above log-normal parameterization, $\\mathbb{E}[F_{p,i}] = F_p$ and, if $CL_{p,i} = CL_p \\cdot Z$ with $Z$ log-normal and $\\mathbb{E}[Z] = 1$, then $\\mathbb{E}\\!\\left[\\tfrac{1}{CL_{p,i}}\\right] = \\tfrac{1}{CL_p} \\cdot \\mathbb{E}\\!\\left[\\tfrac{1}{Z}\\right] = \\tfrac{1}{CL_p} \\cdot e^{\\sigma_{CL}^2}$. Thus,\n$$\\mathbb{E}\\!\\left[AUC_{p,i}^{(\\text{fixed})}\\right] = \\frac{D_{\\text{ref}} \\cdot F_p}{CL_p} \\cdot e^{\\sigma_{CL}^2}.$$\nFor the adjusted dose $D_p = D_{\\text{ref}} \\cdot \\dfrac{CL_p / F_p}{CL_r / F_r}$, the expected adjusted AUC becomes\n$$\\mathbb{E}\\!\\left[AUC_{p,i}^{(\\text{adj})}\\right] = \\left(D_{\\text{ref}} \\cdot \\frac{CL_p / F_p}{CL_r / F_r}\\right) \\cdot \\frac{F_p}{CL_p} \\cdot e^{\\sigma_{CL}^2} = \\frac{D_{\\text{ref}} \\cdot F_r}{CL_r} \\cdot e^{\\sigma_{CL}^2},$$\nwhich is constant across phases for a given test case when $CV_{CL}$ is the same across phases. Therefore, the dosing rule equalizes the expected AUC across phases up to a multiplicative factor $e^{\\sigma_{CL}^2}$ induced by variability in clearance; this factor is phase-invariant under the given assumptions. In the special case with zero variability ($CV_{CL} = 0$), we have $\\sigma_{CL}^2 = 0$ and the expected adjusted AUC exactly equals the deterministic target $\\dfrac{D_{\\text{ref}} \\cdot F_r}{CL_r}$.\n\nAlgorithmic implementation steps:\n1) For each case, compute phase means $CL_p = CL_{\\text{base}} \\cdot \\theta_{CL,p}$ and $F_p = F_{\\text{base}} \\cdot \\theta_{F,p}$. Identify the reference phase $r$ as follicular.\n2) Compute adjusted doses $D_p = D_{\\text{ref}} \\cdot \\dfrac{CL_p / F_p}{CL_r / F_r}$ for phases $p \\in \\{\\text{menses}, \\text{follicular}, \\text{ovulatory}, \\text{luteal}\\}$.\n3) For each phase, draw $N$ samples of $CL_{p,i}$ and $F_{p,i}$ as independent log-normal variables centered on $CL_p$ and $F_p$ using $\\sigma_{CL}^2 = \\ln(1 + CV_{CL}^2)$ and $\\sigma_{F}^2 = \\ln(1 + CV_{F}^2)$, with $\\eta_{CL} \\sim \\mathcal{N}(-\\tfrac{1}{2}\\sigma_{CL}^2, \\sigma_{CL}^2)$ and $\\eta_{F} \\sim \\mathcal{N}(-\\tfrac{1}{2}\\sigma_{F}^2, \\sigma_{F}^2)$, and $CL_{p,i} = CL_p \\cdot e^{\\eta_{CL}}$, $F_{p,i} = F_p \\cdot e^{\\eta_{F}}$.\n4) Compute sample mean AUCs per phase under non-adjusted and adjusted dosing as arithmetic means of $\\dfrac{D_{\\text{ref}} \\cdot F_{p,i}}{CL_{p,i}}$ and $\\dfrac{D_p \\cdot F_{p,i}}{CL_{p,i}}$, respectively.\n5) Round all mean AUCs to three decimals (mg·h/L) and adjusted doses to three decimals (mg), following the specified phase order and output format.\n\nEdge cases and expectations covered by the test suite:\n- Case $1$ demonstrates typical moderate cycle effects and variability. The adjusted mean AUCs should be approximately equal across phases.\n- Case $2$ has no phase effects and zero variability; the adjusted doses equal the reference dose and both non-adjusted and adjusted mean AUCs are identical across phases and exactly match the deterministic target.\n- Case $3$ stresses the algorithm with strong phase shifts and high variability; non-adjusted mean AUCs are disparate, while adjusted mean AUCs are harmonized, illustrating the role of sex-specific physiological variation across the menstrual cycle in dosing decisions.\n\nThe final program follows these steps precisely and prints the nested list containing, for each case, the four non-adjusted mean AUCs, the four adjusted mean AUCs, and the four adjusted doses, in that order, all rounded to three decimals, matching the mandated single-line output format.", "answer": "```python\nimport numpy as np\n\ndef lognormal_samples(mean_value, cv, size, rng):\n    \"\"\"\n    Generate log-normal samples with given arithmetic mean (mean_value) and coefficient of variation (cv).\n    Returns an array of shape (size,).\n    \"\"\"\n    if cv < 0:\n        raise ValueError(\"CV must be non-negative.\")\n    sigma2 = np.log(1.0 + cv**2)\n    # When cv == 0, sigma2 == 0 and the distribution collapses to a point mass at mean_value.\n    if sigma2 == 0.0:\n        return np.full(size, mean_value, dtype=float)\n    mu = -0.5 * sigma2\n    return mean_value * np.exp(rng.normal(loc=mu, scale=np.sqrt(sigma2), size=size))\n\ndef simulate_case(dose_ref_mg, cl_base_lph, f_base, theta_cl, theta_f, cv_cl, cv_f, n, seed):\n    \"\"\"\n    Simulate one test case.\n    Returns:\n        fixed_means: list of 4 floats (mean AUC per phase under fixed dose)\n        adjusted_means: list of 4 floats (mean AUC per phase under adjusted dose)\n        adjusted_doses: list of 4 floats (adjusted dose per phase)\n    \"\"\"\n    phases = [\"menses\", \"follicular\", \"ovulatory\", \"luteal\"]\n    # Compute phase means\n    cl_phase = {p: cl_base_lph * theta_cl[p] for p in phases}\n    f_phase = {p: f_base * theta_f[p] for p in phases}\n    # Reference phase is follicular\n    ref = \"follicular\"\n    # Adjusted doses per phase\n    # D_p = D_ref * (CL_p / F_p) / (CL_ref / F_ref)\n    cl_over_f_ref = cl_phase[ref] / f_phase[ref]\n    adjusted_doses = []\n    for p in phases:\n        dose_adj = dose_ref_mg * (cl_phase[p] / f_phase[p]) / cl_over_f_ref\n        adjusted_doses.append(dose_adj)\n    # Simulate\n    rng = np.random.default_rng(seed)\n    fixed_means = []\n    adjusted_means = []\n    for idx, p in enumerate(phases):\n        cl_samples = lognormal_samples(cl_phase[p], cv_cl, n, rng)\n        f_samples = lognormal_samples(f_phase[p], cv_f, n, rng)\n        # Avoid division by zero (not expected with log-normal, but guard anyway)\n        cl_samples = np.where(cl_samples <= 0, np.finfo(float).tiny, cl_samples)\n        auc_fixed = dose_ref_mg * f_samples / cl_samples\n        auc_adj = adjusted_doses[idx] * f_samples / cl_samples\n        fixed_means.append(float(np.mean(auc_fixed)))\n        adjusted_means.append(float(np.mean(auc_adj)))\n    # Round results to three decimals\n    fixed_means = [round(x, 3) for x in fixed_means]\n    adjusted_means = [round(x, 3) for x in adjusted_means]\n    adjusted_doses = [round(x, 3) for x in adjusted_doses]\n    return fixed_means, adjusted_means, adjusted_doses\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Case 1\n    case1 = {\n        \"dose_ref_mg\": 100.0,\n        \"cl_base_lph\": 12.0,\n        \"f_base\": 0.6,\n        \"theta_cl\": {\"menses\": 1.0, \"follicular\": 0.95, \"ovulatory\": 0.90, \"luteal\": 1.10},\n        \"theta_f\": {\"menses\": 0.95, \"follicular\": 1.00, \"ovulatory\": 1.05, \"luteal\": 1.10},\n        \"cv_cl\": 0.30,\n        \"cv_f\": 0.20,\n        \"n\": 50000,\n        \"seed\": 11,\n    }\n    # Case 2\n    case2 = {\n        \"dose_ref_mg\": 100.0,\n        \"cl_base_lph\": 10.0,\n        \"f_base\": 0.5,\n        \"theta_cl\": {\"menses\": 1.0, \"follicular\": 1.0, \"ovulatory\": 1.0, \"luteal\": 1.0},\n        \"theta_f\": {\"menses\": 1.0, \"follicular\": 1.0, \"ovulatory\": 1.0, \"luteal\": 1.0},\n        \"cv_cl\": 0.0,\n        \"cv_f\": 0.0,\n        \"n\": 1000,\n        \"seed\": 7,\n    }\n    # Case 3\n    case3 = {\n        \"dose_ref_mg\": 50.0,\n        \"cl_base_lph\": 20.0,\n        \"f_base\": 0.3,\n        \"theta_cl\": {\"menses\": 1.20, \"follicular\": 1.00, \"ovulatory\": 0.85, \"luteal\": 1.10},\n        \"theta_f\": {\"menses\": 0.80, \"follicular\": 1.00, \"ovulatory\": 1.20, \"luteal\": 0.90},\n        \"cv_cl\": 0.60,\n        \"cv_f\": 0.40,\n        \"n\": 40000,\n        \"seed\": 23,\n    }\n    test_cases = [case1, case2, case3]\n\n    results = []\n    for c in test_cases:\n        fixed_means, adjusted_means, adjusted_doses = simulate_case(\n            c[\"dose_ref_mg\"],\n            c[\"cl_base_lph\"],\n            c[\"f_base\"],\n            c[\"theta_cl\"],\n            c[\"theta_f\"],\n            c[\"cv_cl\"],\n            c[\"cv_f\"],\n            c[\"n\"],\n            c[\"seed\"]\n        )\n        results.append([fixed_means, adjusted_means, adjusted_doses])\n\n    # Final print statement in the exact required format.\n    print(str(results))\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "5061066"}]}