{"hands_on_practices": [{"introduction": "Successful placentation hinges on the radical transformation of maternal spiral arteries into high-flow, low-resistance conduits. This exercise moves beyond qualitative description to quantitative modeling, applying the fundamental principles of fluid dynamics encapsulated in Poiseuille's law [@problem_id:4453969]. By calculating the fold-change in blood flow from specified, hypothetical changes in vessel geometry and blood viscosity, you will gain a deeper appreciation for the powerful hemodynamic consequences of trophoblast-mediated remodeling.", "problem": "In early human placentation, extravillous trophoblast (EVT) invades and remodels maternal spiral arteries (MSA), increasing luminal radius and decreasing vasoreactivity to augment perfusion of the intervillous space (IVS). Consider a uterine supply comprising $n$ identical MSA branches arranged effectively in parallel between a common upstream artery and the IVS, each experiencing the same pressure drop $ \\Delta P $ from inlet to outlet. Before EVT remodeling, each MSA can be idealized as a rigid cylindrical conduit of radius $ r $, length $ L $, perfused by a Newtonian fluid of dynamic viscosity $ \\mu $ under steady laminar flow. After EVT remodeling at the end of the first trimester, a fraction $ p = 0.4 $ of the MSA increase their luminal radius to $ 2 r $, and their effective axial length shortens to $ 0.8 L $ due to loss of distal muscular tonicity and taper. Simultaneously, maternal hemodilution reduces blood viscosity to $ \\mu' = 0.9 \\mu $. Assume that upstream and downstream pressures defining $ \\Delta P $ and the vessel geometry aside from the stated changes remain unchanged, that entrance and exit effects are negligible, and that flow in each branch remains laminar, incompressible, and quasisteady. Using the physical principles encapsulated by Poiseuille’s law for laminar flow in rigid cylindrical conduits and mass conservation in parallel networks, compute the overall fold-change $ F = \\frac{Q_{\\text{after}}}{Q_{\\text{before}}} $ in total volumetric flow into the IVS due to these changes. Express $ F $ as an exact rational number and treat it as unitless.", "solution": "The problem will be validated by first extracting the givens and then assessing its scientific grounding, well-posedness, and objectivity.\n\n### Step 1: Extract Givens\n- Total number of identical maternal spiral artery (MSA) branches: $n$.\n- Arrangement of MSA branches: in parallel.\n- Pressure drop across each branch: $\\Delta P$, constant before and after remodeling.\n- Initial state (before remodeling):\n    - Radius of each MSA: $r$.\n    - Length of each MSA: $L$.\n    - Dynamic viscosity of blood: $\\mu$.\n- Final state (after remodeling):\n    - Fraction of remodeled MSA: $p = 0.4$.\n    - Radius of remodeled MSA: $2r$.\n    - Length of remodeled MSA: $0.8L$.\n    - Dynamic viscosity of blood after hemodilution: $\\mu' = 0.9\\mu$.\n- The remaining fraction of MSA, $1-p$, are unremodeled in geometry but are perfused by blood of the new viscosity $\\mu'$.\n- Assumptions:\n    - Flow is steady, laminar, incompressible.\n    - Conduits are rigid and cylindrical.\n    - Entrance and exit effects are negligible.\n    - The physical model is Poiseuille's law.\n- Objective: Compute the overall fold-change in total volumetric flow, $F = \\frac{Q_{\\text{after}}}{Q_{\\text{before}}}$, as an exact rational number.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the validation criteria.\n- **Scientifically Grounded:** The problem is firmly grounded in the principles of fluid dynamics, specifically using Poiseuille's law to model blood flow in arteries. This is a standard and appropriate first-order approximation in biophysics and physiology. The biological context—remodeling of spiral arteries by extravillous trophoblasts during placentation—is a fundamental concept in reproductive biology and obstetrics. The described changes (increased radius, decreased length, decreased viscosity) are qualitatively consistent with physiological observations.\n- **Well-Posed:** The problem provides all necessary parameters and relationships to determine a unique solution. The quantities $n$, $r$, $L$, $\\mu$, and $\\Delta P$ are symbolic but will cancel out in the final ratio, as expected for a fold-change calculation. The numerical values for the fraction of remodeled vessels and the scaling factors for radius, length, and viscosity are explicitly given. The setup is self-contained and consistent.\n- **Objective:** The problem is stated in precise, quantitative, and unbiased language, free from subjective or opinion-based claims.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is a well-posed, scientifically grounded, and objective problem in biophysical modeling. A solution will be derived.\n\n### Solution Derivation\n\nThe analysis is based on Poiseuille's law for the volumetric flow rate, $Q$, through a cylindrical pipe of radius $R$ and length $L$ under a pressure difference $\\Delta P$ for a fluid with dynamic viscosity $\\eta$:\n$$Q = \\frac{\\pi R^4 \\Delta P}{8 \\eta L}$$\n\n**1. Total Flow Before Remodeling ($Q_{\\text{before}}$)**\n\nBefore remodeling, there are $n$ identical MSA branches. The flow rate through a single branch, $Q_{\\text{single, before}}$, is given by:\n$$Q_{\\text{single, before}} = \\frac{\\pi r^4 \\Delta P}{8 \\mu L}$$\nSince all $n$ branches are in parallel, the total flow rate is the sum of the individual flow rates:\n$$Q_{\\text{before}} = n \\cdot Q_{\\text{single, before}} = n \\frac{\\pi r^4 \\Delta P}{8 \\mu L}$$\n\n**2. Total Flow After Remodeling ($Q_{\\text{after}}$)**\n\nAfter remodeling, the population of $n$ arteries is divided into two groups. Maternal hemodilution has changed the blood viscosity to $\\mu' = 0.9\\mu$ for all vessels.\n\n**Group A: Remodeled Arteries**\n- Number of arteries in this group: $n_A = p \\cdot n = 0.4 n$.\n- Radius: $r_A = 2r$.\n- Length: $L_A = 0.8L$.\n- Viscosity: $\\mu' = 0.9\\mu$.\nThe flow rate through a single remodeled artery, $Q_{\\text{single, rem}}$, is:\n$$Q_{\\text{single, rem}} = \\frac{\\pi (r_A)^4 \\Delta P}{8 \\mu' L_A} = \\frac{\\pi (2r)^4 \\Delta P}{8 (0.9\\mu) (0.8L)}$$\n$$Q_{\\text{single, rem}} = \\frac{\\pi (16 r^4) \\Delta P}{8 (0.72) \\mu L} = \\frac{16}{0.72} \\left( \\frac{\\pi r^4 \\Delta P}{8 \\mu L} \\right) = \\frac{16}{0.72} Q_{\\text{single, before}}$$\n\n**Group B: Unremodeled Arteries**\n- Number of arteries in this group: $n_B = (1-p) n = (1-0.4)n = 0.6 n$.\n- Radius: $r_B = r$.\n- Length: $L_B = L$.\n- Viscosity: $\\mu' = 0.9\\mu$.\nThe flow rate through a single unremodeled artery, $Q_{\\text{single, unrem}}$, is affected only by the change in viscosity:\n$$Q_{\\text{single, unrem}} = \\frac{\\pi (r_B)^4 \\Delta P}{8 \\mu' L_B} = \\frac{\\pi r^4 \\Delta P}{8 (0.9\\mu) L}$$\n$$Q_{\\text{single, unrem}} = \\frac{1}{0.9} \\left( \\frac{\\pi r^4 \\Delta P}{8 \\mu L} \\right) = \\frac{1}{0.9} Q_{\\text{single, before}}$$\n\nThe total flow after remodeling, $Q_{\\text{after}}$, is the sum of the total flows from both groups:\n$$Q_{\\text{after}} = n_A \\cdot Q_{\\text{single, rem}} + n_B \\cdot Q_{\\text{single, unrem}}$$\n$$Q_{\\text{after}} = (0.4n) \\left(\\frac{16}{0.72} Q_{\\text{single, before}}\\right) + (0.6n) \\left(\\frac{1}{0.9} Q_{\\text{single, before}}\\right)$$\n$$Q_{\\text{after}} = n \\cdot Q_{\\text{single, before}} \\left( (0.4) \\frac{16}{0.72} + (0.6) \\frac{1}{0.9} \\right)$$\n\n**3. Fold-Change in Total Flow ($F$)**\n\nThe fold-change $F$ is the ratio of the total flow after remodeling to the total flow before remodeling:\n$$F = \\frac{Q_{\\text{after}}}{Q_{\\text{before}}} = \\frac{n \\cdot Q_{\\text{single, before}} \\left( (0.4) \\frac{16}{0.72} + (0.6) \\frac{1}{0.9} \\right)}{n \\cdot Q_{\\text{single, before}}}$$\n$$F = (0.4) \\frac{16}{0.72} + (0.6) \\frac{1}{0.9}$$\n\nTo express $F$ as an exact rational number, we convert the decimals to fractions:\n- $0.4 = \\frac{4}{10} = \\frac{2}{5}$\n- $0.6 = \\frac{6}{10} = \\frac{3}{5}$\n- $0.72 = \\frac{72}{100} = \\frac{18}{25}$\n- $0.9 = \\frac{9}{10}$\n\nSubstituting these fractions into the expression for $F$:\n$$F = \\left(\\frac{2}{5}\\right) \\frac{16}{\\frac{18}{25}} + \\left(\\frac{3}{5}\\right) \\frac{1}{\\frac{9}{10}}$$\n$$F = \\left(\\frac{2}{5}\\right) \\left(\\frac{16 \\cdot 25}{18}\\right) + \\left(\\frac{3}{5}\\right) \\left(\\frac{10}{9}\\right)$$\n\nNow, we simplify each term:\nFirst term:\n$$\\left(\\frac{2}{5}\\right) \\left(\\frac{16 \\cdot 25}{18}\\right) = \\frac{2 \\cdot 16 \\cdot 25}{5 \\cdot 18} = \\frac{1 \\cdot 16 \\cdot 5}{1 \\cdot 9} = \\frac{80}{9}$$\nSecond term:\n$$\\left(\\frac{3}{5}\\right) \\left(\\frac{10}{9}\\right) = \\frac{3 \\cdot 10}{5 \\cdot 9} = \\frac{30}{45} = \\frac{2}{3}$$\n\nFinally, we add the two terms:\n$$F = \\frac{80}{9} + \\frac{2}{3}$$\nTo add these fractions, we find a common denominator, which is $9$:\n$$F = \\frac{80}{9} + \\frac{2 \\cdot 3}{3 \\cdot 3} = \\frac{80}{9} + \\frac{6}{9} = \\frac{80+6}{9} = \\frac{86}{9}$$\nThe overall fold-change in total volumetric flow is $\\frac{86}{9}$.", "answer": "$$\\boxed{\\frac{86}{9}}$$", "id": "4453969"}, {"introduction": "Bridging from biophysical theory to clinical practice, this problem focuses on the non-invasive assessment of uteroplacental circulation. Doppler ultrasound, and specifically the Pulsatility Index (PI), serves as a critical tool for monitoring the hemodynamic changes that result from spiral artery remodeling. This practice will require you to calculate the uterine artery PI from clinically relevant measurements and interpret its significance, thereby honing your ability to use diagnostic data to evaluate the adequacy of placentation in the first trimester [@problem_id:4453954].", "problem": "A pregnant patient at $10$ weeks of gestation undergoes standardized, angle-corrected uterine artery Doppler ultrasound sampling at the point of maximal flow in early diastole. The measured peak systolic velocity is $S = 50$ $\\mathrm{cm}\\,\\mathrm{s}^{-1}$, the end-diastolic velocity is $D = 10$ $\\mathrm{cm}\\,\\mathrm{s}^{-1}$, and the time-averaged mean velocity over the cardiac cycle is $\\text{mean} = 25$ $\\mathrm{cm}\\,\\mathrm{s}^{-1}$. Using the standard definition of the uterine artery pulsatility index (PI) employed in obstetric Doppler, compute the PI from these measurements. Report the PI as an exact, unitless value (no rounding). Then, based on fundamental hemodynamic principles governing spiral artery remodeling in early placentation and the expected trajectory of uterine artery impedance in the first trimester, briefly justify whether the computed PI is more consistent with adequate or inadequate remodeling. Your final boxed answer must contain only the numerical PI value.", "solution": "The problem is deemed valid as it is scientifically grounded, well-posed, internally consistent, and contains all necessary information for a solution.\n\nThe pulsatility index ($PI$), a quantitative measure of vascular impedance derived from Doppler ultrasound waveforms, is defined by the Gosling and King formula:\n$$ PI = \\frac{S - D}{\\text{mean}} $$\nwhere $S$ is the peak systolic velocity, $D$ is the end-diastolic velocity, and $\\text{mean}$ is the time-averaged mean velocity over the cardiac cycle.\n\nThe problem provides the following values for the uterine artery at $10$ weeks of gestation:\n- Peak systolic velocity, $S = 50 \\, \\mathrm{cm}\\,\\mathrm{s}^{-1}$\n- End-diastolic velocity, $D = 10 \\, \\mathrm{cm}\\,\\mathrm{s}^{-1}$\n- Time-averaged mean velocity, $\\text{mean} = 25 \\, \\mathrm{cm}\\,\\mathrm{s}^{-1}$\n\nSubstituting these values into the formula yields the pulsatility index:\n$$ PI = \\frac{50 \\, \\mathrm{cm}\\,\\mathrm{s}^{-1} - 10 \\, \\mathrm{cm}\\,\\mathrm{s}^{-1}}{25 \\, \\mathrm{cm}\\,\\mathrm{s}^{-1}} = \\frac{40 \\, \\mathrm{cm}\\,\\mathrm{s}^{-1}}{25 \\, \\mathrm{cm}\\,\\mathrm{s}^{-1}} $$\nThe units of velocity cancel, rendering the $PI$ a dimensionless quantity. The numerical value is calculated as:\n$$ PI = \\frac{40}{25} = \\frac{8}{5} = 1.6 $$\n\nThe second part of the task is to justify whether this $PI$ value is more consistent with adequate or inadequate spiral artery remodeling.\n\nIn normal early pregnancy, a process of placentation involves trophoblastic invasion and remodeling of the maternal spiral arteries. This physiological process transforms them from narrow, high-resistance vessels into wide, low-resistance channels. The purpose of this remodeling is to establish a high-flow, low-impedance uteroplacental circulation to support the growing fetus.\n\nThe uterine artery $PI$ is a non-invasive proxy for this downstream vascular impedance.\n- **Adequate remodeling** leads to a low-impedance state. Hemodynamically, this is reflected by a high end-diastolic velocity and a correspondingly low $PI$.\n- **Inadequate remodeling**, the primary pathology in conditions like pre-eclampsia and fetal growth restriction, results in a persistent high-impedance state, reflected by a low end-diastolic velocity and a high $PI$.\n\nAt $10$ weeks of gestation, the remodeling process is underway but physiologically incomplete. The uterine circulation is in a transitional state from the high-resistance non-pregnant state to the low-resistance pregnant state. The calculated $PI$ of $1.6$ reflects a state of high vascular impedance. This is evidenced by the large difference between systolic and diastolic velocities ($S-D = 40 \\, \\mathrm{cm}\\,\\mathrm{s}^{-1}$) and the high systolic-to-diastolic ratio ($S/D = 50/10 = 5$), which are hallmarks of a high-resistance vascular bed.\n\nA state of adequate remodeling is, by definition, a low-impedance state. A state of inadequate remodeling is a high-impedance state. The measured waveform, with a $PI$ of $1.6$, unequivocally demonstrates the characteristics of high impedance. Therefore, the hemodynamic profile is more consistent with the features of inadequate remodeling (a high-impedance state) than it is with the features of adequate remodeling (a low-impedance state), even though the value might be considered within the expected range for this early gestational age. The persistence of this $PI$ value, or a failure for it to decline significantly over the subsequent weeks of the first trimester, would be a strong indicator of a pathological process of failed placentation.", "answer": "$$\\boxed{1.6}$$", "id": "4453954"}, {"introduction": "Implantation is a complex, multifactorial process, and predicting its success requires integrating diverse biological information. This advanced practice introduces a modern, computational approach to personalized medicine, using a Bayesian framework to synthesize data from the embryo, endometrium, and maternal immune system. By implementing a Naive Bayes model based on plausible, hypothetical parameters, you will learn to quantify the probability of implantation, developing skills in probabilistic reasoning and understanding how disparate data can inform clinical decision-making [@problem_id:4453925].", "problem": "Implement a program that, using Bayes’ theorem and conditional independence assumptions, estimates the posterior probability of implantation success in in vitro fertilization from four observed features: embryo euploidy status, an endometrial receptivity marker, a continuous endometrial steroid hormone level, and a maternal-fetal immune genotype category. Your model must start from first principles and use only the following well-tested biological facts as class-conditional information, together with Bayes’ theorem and the naive conditional independence assumption.\n\nAssume the following generative model. Let the implantation outcome be a binary random variable $I \\in \\{0,1\\}$, with prior $P(I=1)=p_0$ and $P(I=0)=1-p_0$. Conditional on $I$, assume that:\n- Embryo euploidy $E \\in \\{0,1\\}$ is conditionally independent of all other features given $I$.\n- Endometrial receptivity $R \\in \\{0,1\\}$ (for example, a result from Endometrial Receptivity Analysis (ERA)) is conditionally independent of all other features given $I$.\n- Maternal-fetal immune genotype category $G \\in \\{\\text{F},\\text{N},\\text{U}\\}$, summarizing Killer-cell Immunoglobulin-like Receptor (KIR) and Human Leukocyte Antigen (HLA) combinations as favorable (F), neutral (N), or unfavorable (U), is conditionally independent of all other features given $I$.\n- Serum progesterone level on the day of embryo transfer $S \\in \\mathbb{R}$ (measured in ng/mL) follows a Gaussian distribution conditional on $I$ and is conditionally independent of all other features given $I$.\n\nUnder these assumptions, the joint likelihood factors as\n$$\nP(E,R,G,S \\mid I=i) \\;=\\; P(E\\mid I=i)\\,P(R\\mid I=i)\\,P(G\\mid I=i)\\,f_{S\\mid I=i}(S),\n$$\nwhere $f_{S\\mid I=i}$ is the Gaussian probability density function for $S$ given $I=i$.\n\nUse the following scientifically plausible and self-consistent parameter values:\n- Prior: $p_0 = 0.30$.\n- Euploidy (for a single blastocyst transfer): $P(E=1\\mid I=1)=0.85$, $P(E=1\\mid I=0)=0.25$; therefore $P(E=0\\mid I=i)=1-P(E=1\\mid I=i)$ for $i\\in\\{0,1\\}$.\n- Endometrial receptivity: $P(R=1\\mid I=1)=0.75$, $P(R=1\\mid I=0)=0.35$; therefore $P(R=0\\mid I=i)=1-P(R=1\\mid I=i)$.\n- Immune genotype category:\n  - If $I=1$: $P(G=\\text{F}\\mid I=1)=0.50$, $P(G=\\text{N}\\mid I=1)=0.35$, $P(G=\\text{U}\\mid I=1)=0.15$.\n  - If $I=0$: $P(G=\\text{F}\\mid I=0)=0.25$, $P(G=\\text{N}\\mid I=0)=0.45$, $P(G=\\text{U}\\mid I=0)=0.30$.\n- Progesterone (ng/mL) on day of transfer, modeled as Gaussian:\n  - If $I=1$: $S \\sim \\mathcal{N}(\\mu_1,\\sigma_1^2)$ with $\\mu_1=12.0$ and $\\sigma_1=2.5$.\n  - If $I=0$: $S \\sim \\mathcal{N}(\\mu_0,\\sigma_0^2)$ with $\\mu_0=8.5$ and $\\sigma_0=2.5$.\n\nGiven an observed feature tuple $(E,R,G,S)$, use Bayes’ theorem to compute\n$$\nP(I=1\\mid E,R,G,S)\\;=\\;\\frac{P(I=1)\\,P(E,R,G,S\\mid I=1)}{P(I=1)\\,P(E,R,G,S\\mid I=1)+P(I=0)\\,P(E,R,G,S\\mid I=0)}.\n$$\nFor numerical robustness, your implementation must compute this posterior using log-likelihoods and a stable normalization (for example, via a log-sum-exp transformation), not by multiplying raw probabilities.\n\nInput conventions for each case:\n- $E\\in\\{0,1\\}$ where $1$ denotes a euploid embryo and $0$ denotes an aneuploid embryo.\n- $R\\in\\{0,1\\}$ where $1$ denotes histologically or transcriptomically receptive endometrium and $0$ denotes non-receptive.\n- $G\\in\\{\\text{F},\\text{N},\\text{U}\\}$ as defined above.\n- $S\\in\\mathbb{R}$ measured in ng/mL.\n\nYour program must evaluate the following test suite of cases and output the posterior probabilities $P(I=1\\mid E,R,G,S)$ for each, expressed as decimals (unitless) rounded to four decimal places:\n- Case $1$: $(E,R,G,S)=(1,1,\\text{F},13.0)$.\n- Case $2$: $(E,R,G,S)=(0,1,\\text{F},12.0)$.\n- Case $3$: $(E,R,G,S)=(1,0,\\text{U},7.5)$.\n- Case $4$: $(E,R,G,S)=(1,1,\\text{N},10.0)$.\n- Case $5$: $(E,R,G,S)=(0,0,\\text{U},5.0)$.\n- Case $6$: $(E,R,G,S)=(1,0,\\text{N},18.0)$.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing the six posterior probabilities in the order of the cases above, as a comma-separated list enclosed in square brackets, for example, $[\\ldots]$. Each probability must be rounded to four decimal places and represented as a decimal between $0$ and $1$ (no percentage sign).", "solution": "The objective is to compute the posterior probability of implantation success, $P(I=1 \\mid E,R,G,S)$, given a set of four observed features: embryo euploidy ($E$), endometrial receptivity ($R$), maternal-fetal immune genotype ($G$), and serum progesterone level ($S$). The calculation will be based on Bayes' theorem and the Naive Bayes assumption of conditional independence of the features given the implantation outcome $I \\in \\{0, 1\\}$.\n\nLet the evidence be denoted by $\\mathcal{D} = (E,R,G,S)$. According to Bayes' theorem, the posterior probability of success ($I=1$) is given by:\n$$\nP(I=1 \\mid \\mathcal{D}) = \\frac{P(I=1) P(\\mathcal{D} \\mid I=1)}{P(\\mathcal{D})}\n$$\nThe denominator, $P(\\mathcal{D})$, is the marginal likelihood or evidence, which can be expanded using the law of total probability:\n$$\nP(\\mathcal{D}) = P(\\mathcal{D} \\mid I=1)P(I=1) + P(\\mathcal{D} \\mid I=0)P(I=0)\n$$\nSubstituting this into the Bayes' formula yields the full expression for the posterior probability:\n$$\nP(I=1 \\mid \\mathcal{D}) = \\frac{P(I=1) P(\\mathcal{D} \\mid I=1)}{P(I=1) P(\\mathcal{D} \\mid I=1) + P(I=0) P(\\mathcal{D} \\mid I=0)}\n$$\nThe problem states that the features $E$, $R$, $G$, and $S$ are conditionally independent given the implantation outcome $I$. This Naive Bayes assumption allows us to factor the joint likelihood $P(\\mathcal{D} \\mid I=i)$ as a product of individual conditional probabilities and probability densities:\n$$\nP(\\mathcal{D} \\mid I=i) = P(E \\mid I=i) \\, P(R \\mid I=i) \\, P(G \\mid I=i) \\, f_{S}(S \\mid I=i)\n$$\nwhere $f_S$ denotes the probability density function for the continuous variable $S$.\n\nMultiplying many small probabilities can lead to numerical underflow. To ensure numerical stability, we perform the calculations in log-space. Let us define two quantities, $\\ell_1$ and $\\ell_0$, which are the logarithms of the un-normalized posteriors (i.e., the joint probabilities $P(\\mathcal{D}, I=i)$):\n$$\n\\ell_i = \\log \\left( P(I=i) P(\\mathcal{D} \\mid I=i) \\right) = \\log P(I=i) + \\log P(\\mathcal{D} \\mid I=i) \\quad \\text{for } i \\in \\{0, 1\\}\n$$\nUsing the conditional independence assumption, we can expand the log-likelihood term:\n$$\n\\log P(\\mathcal{D} \\mid I=i) = \\log P(E \\mid I=i) + \\log P(R \\mid I=i) + \\log P(G \\mid I=i) + \\log f_{S}(S \\mid I=i)\n$$\nThe problem specifies that the serum progesterone level $S$ conditioned on the outcome $I=i$ follows a Gaussian distribution $\\mathcal{N}(\\mu_i, \\sigma_i^2)$. The logarithm of the Gaussian PDF is:\n$$\n\\log f_{S}(s \\mid I=i) = \\log \\left( \\frac{1}{\\sqrt{2\\pi\\sigma_i^2}} \\exp\\left(-\\frac{(s-\\mu_i)^2}{2\\sigma_i^2}\\right) \\right) = -\\frac{1}{2}\\log(2\\pi\\sigma_i^2) - \\frac{(s-\\mu_i)^2}{2\\sigma_i^2}\n$$\nSo, the terms $\\ell_1$ and $\\ell_0$ are computed as follows, using the specific values of the observed features $(E, R, G, S)$:\n$$\n\\ell_1 = \\log P(I=1) + \\log P(E \\mid I=1) + \\log P(R \\mid I=1) + \\log P(G \\mid I=1) + \\log f_{S}(S \\mid I=1)\n$$\n$$\n\\ell_0 = \\log P(I=0) + \\log P(E \\mid I=0) + \\log P(R \\mid I=0) + \\log P(G \\mid I=0) + \\log f_{S}(S \\mid I=0)\n$$\nThe posterior probability can be expressed in terms of $\\ell_1$ and $\\ell_0$:\n$$\nP(I=1 \\mid \\mathcal{D}) = \\frac{\\exp(\\ell_1)}{\\exp(\\ell_1) + \\exp(\\ell_0)}\n$$\nTo avoid potential overflow or underflow when exponentiating $\\ell_1$ and $\\ell_0$, we can rewrite this expression by dividing the numerator and denominator by $\\exp(\\ell_1)$:\n$$\nP(I=1 \\mid \\mathcal{D}) = \\frac{1}{1 + \\exp(\\ell_0) / \\exp(\\ell_1)} = \\frac{1}{1 + \\exp(\\ell_0 - \\ell_1)}\n$$\nThis is the logistic sigmoid function applied to the log-odds ratio, $\\ell_1 - \\ell_0$. This form is numerically stable.\n\nThe implementation will proceed as follows:\n1.  Store all given prior and conditional probabilities in suitable data structures. Their logarithms will be pre-calculated.\n2.  For each test case $(E,R,G,S)$:\n    a. Calculate $\\ell_1$ by summing the log-prior $\\log P(I=1)$ and the log-likelihood contributions from each feature, conditioned on $I=1$. The log-likelihood for $S$ is obtained from the log-PDF of the corresponding Gaussian distribution $\\mathcal{N}(\\mu_1, \\sigma_1^2)$.\n    b. Similarly, calculate $\\ell_0$ using the parameters for the $I=0$ case.\n    c. Compute the posterior probability $P(I=1 \\mid \\mathcal{D})$ using the stable formula $1 / (1 + \\exp(\\ell_0 - \\ell_1))$.\n3.  Collect the results for all test cases, round each to four decimal places, and format the final output as a comma-separated list in square brackets.\n\nThe given parameters are:\n- Priors: $P(I=1) = 0.30$, $P(I=0) = 0.70$.\n- Conditionals for $E=1$: $P(E=1 \\mid I=1)=0.85$, $P(E=1 \\mid I=0)=0.25$.\n- Conditionals for $R=1$: $P(R=1 \\mid I=1)=0.75$, $P(R=1 \\mid I=0)=0.35$.\n- Conditionals for $G$:\n  - For $I=1$: $P(G=\\text{F})=0.50$, $P(G=\\text{N})=0.35$, $P(G=\\text{U})=0.15$.\n  - For $I=0$: $P(G=\\text{F})=0.25$, $P(G=\\text{N})=0.45$, $P(G=\\text{U})=0.30$.\n- Conditionals for $S$: $\\mathcal{N}(\\mu_1=12.0, \\sigma_1=2.5)$ for $I=1$ and $\\mathcal{N}(\\mu_0=8.5, \\sigma_0=2.5)$ for $I=0$.\nThe probabilities for $E=0$ and $R=0$ are derived as $1 - P(\\text{feature}=1 \\mid I=i)$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes the posterior probability of IVF implantation success for a suite\n    of test cases using a Naive Bayes model.\n    \"\"\"\n\n    # Define the parameters of the Bayesian model.\n    # Priors\n    p_I1 = 0.30\n    p_I0 = 1 - p_I1\n\n    # Conditional probabilities for Euploidy (E)\n    p_E_given_I = {\n        1: {1: 0.85, 0: 1 - 0.85},  # I=1: P(E=1|I=1), P(E=0|I=1)\n        0: {1: 0.25, 0: 1 - 0.25}   # I=0: P(E=1|I=0), P(E=0|I=0)\n    }\n\n    # Conditional probabilities for Receptivity (R)\n    p_R_given_I = {\n        1: {1: 0.75, 0: 1 - 0.75},  # I=1: P(R=1|I=1), P(R=0|I=1)\n        0: {1: 0.35, 0: 1 - 0.35}   # I=0: P(R=1|I=0), P(R=0|I=0)\n    }\n\n    # Conditional probabilities for Genotype (G)\n    p_G_given_I = {\n        1: {'F': 0.50, 'N': 0.35, 'U': 0.15},  # I=1\n        0: {'F': 0.25, 'N': 0.45, 'U': 0.30}   # I=0\n    }\n\n    # Parameters for Gaussian distribution of Progesterone (S)\n    s_params = {\n        1: {'mu': 12.0, 'sigma': 2.5},  # I=1\n        0: {'mu': 8.5, 'sigma': 2.5}   # I=0\n    }\n    \n    # Pre-compute log probabilities for stability and efficiency\n    log_p_I1 = np.log(p_I1)\n    log_p_I0 = np.log(p_I0)\n    \n    log_p_E_given_I = {i: {val: np.log(p) for val, p in probs.items()} for i, probs in p_E_given_I.items()}\n    log_p_R_given_I = {i: {val: np.log(p) for val, p in probs.items()} for i, probs in p_R_given_I.items()}\n    log_p_G_given_I = {i: {val: np.log(p) for val, p in probs.items()} for i, probs in p_G_given_I.items()}\n\n    def calculate_posterior(E: int, R: int, G: str, S: float) -> float:\n        \"\"\"\n        Calculates the posterior probability P(I=1 | E, R, G, S) using log-space.\n        \n        Args:\n            E: Embryo euploidy (1 for euploid, 0 for aneuploid).\n            R: Endometrial receptivity (1 for receptive, 0 for non-receptive).\n            G: Immune genotype category ('F', 'N', 'U').\n            S: Serum progesterone level (ng/mL).\n            \n        Returns:\n            The posterior probability of implantation success.\n        \"\"\"\n        # Calculate log-proportional-posterior for I=1\n        log_likelihood_1 = (log_p_E_given_I[1][E] +\n                              log_p_R_given_I[1][R] +\n                              log_p_G_given_I[1][G] +\n                              norm.logpdf(S, loc=s_params[1]['mu'], scale=s_params[1]['sigma']))\n        ell_1 = log_p_I1 + log_likelihood_1\n\n        # Calculate log-proportional-posterior for I=0\n        log_likelihood_0 = (log_p_E_given_I[0][E] +\n                              log_p_R_given_I[0][R] +\n                              log_p_G_given_I[0][G] +\n                              norm.logpdf(S, loc=s_params[0]['mu'], scale=s_params[0]['sigma']))\n        ell_0 = log_p_I0 + log_likelihood_0\n\n        # Calculate posterior probability using the numerically stable logistic function\n        # P(I=1|D) = 1 / (1 + exp(l0 - l1))\n        # This is equivalent to exp(l1) / (exp(l1) + exp(l0))\n        posterior_prob_I1 = 1.0 / (1.0 + np.exp(ell_0 - ell_1))\n        \n        return posterior_prob_I1\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1, 1, 'F', 13.0),  # Case 1\n        (0, 1, 'F', 12.0),  # Case 2\n        (1, 0, 'U', 7.5),   # Case 3\n        (1, 1, 'N', 10.0),  # Case 4\n        (0, 0, 'U', 5.0),   # Case 5\n        (1, 0, 'N', 18.0),  # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        E_obs, R_obs, G_obs, S_obs = case\n        posterior = calculate_posterior(E_obs, R_obs, G_obs, S_obs)\n        results.append(round(posterior, 4))\n    \n    # Format results into a string as per the problem specification.\n    # Using 'g' format specifier to avoid trailing zeros for numbers like 0.1200\n    formatted_results = [f'{res:.4f}' for res in results]\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4453925"}]}