{"hands_on_practices": [{"introduction": "The power of the Cox model is its ability to handle covariates that change over time, such as evolving lab values or treatment statuses. This exercise will give you practice with the foundational skills needed for such analyses. You will first learn to translate a subject's history into the \"start-stop\" data format, and then use this data to compute a single contribution to the stratified partial likelihood, which is the core component of the model [@problem_id:4961494]. Mastering this calculation is the first step toward understanding how the entire model is constructed.", "problem": "A clinical cohort is analyzed using a stratified Cox proportional hazards (PH) model with a single time-dependent covariate. For stratum $s \\in \\{1,2\\}$, the hazard function for an individual with covariate path $X(t)$ is assumed to satisfy the proportional hazards structure\n$$\nh_{s}(t \\mid X(t)) \\;=\\; h_{0,s}(t)\\,\\exp\\!\\big(\\beta\\,X(t)\\big),\n$$\nwhere $h_{0,s}(t)$ is the unknown baseline hazard in stratum $s$ and $\\beta$ is an unknown regression coefficient common to all strata. The time-dependent covariate is recorded at discrete times and is treated as a step function that is constant on open intervals between measurement times and takes the updated value on the right-closed endpoints.\n\nSubject $A$ belongs to stratum $s=1$. This subject has longitudinal covariate measurements $Z(0)=0$, $Z(2)=1$, and $Z(5)=0$, and experiences the event at time $t=6$. Construct the start–stop representation for subject $A$ using the measurement times and the event time, with the event indicator $\\delta=1$ on the final interval and $\\delta=0$ otherwise.\n\nAt time $t=6$, the risk set within stratum $s=1$ consists of subject $A$ and two additional individuals:\n- Subject $B$ (also in stratum $s=1$) with measurements $W(0)=1$ and $W(4)=2$ and no event before $t=6$.\n- Subject $C$ (also in stratum $s=1$) with a constant covariate $U(t)\\equiv 0.5$ from baseline and no event before $t=6$.\n\nThere are other individuals in stratum $s=2$ at risk at $t=6$, but due to stratification they do not contribute to the risk set for subject $A$’s event.\n\nStarting only from the definition of the hazard function above and the interpretation of a risk set as those individuals still at risk just before time $t$, derive the contribution of subject $A$’s event at $t=6$ to the Cox partial likelihood under the stratified model. Express your final answer as a single simplified analytic expression in terms of $\\beta$. No rounding is required.", "solution": "The problem requires two parts: constructing the start-stop data for Subject A and then deriving its contribution to the partial likelihood.\n\n#### Part 1: Start-Stop Representation for Subject A\n\nFor a subject with a time-dependent covariate, the observation period is broken into intervals defined by the covariate measurement times and the final event or censoring time. Subject A has measurements at times $t=0, 2, 5$ and experiences the event at $t=6$. The covariate value is constant on intervals of the form $(t_{start}, t_{stop}]$.\n\nThe intervals for Subject A are $(0, 2]$, $(2, 5]$, and $(5, 6]$.\n1.  **Interval 1**: From $t=0$ to $t=2$. The covariate value is $X(t) = Z(0) = 0$. No event occurs, so the event indicator $\\delta$ is $0$.\n2.  **Interval 2**: From $t=2$ to $t=5$. The covariate value is updated to $X(t) = Z(2) = 1$. No event occurs, so $\\delta=0$.\n3.  **Interval 3**: From $t=5$ to the event time $t=6$. The covariate value is updated to $X(t) = Z(5) = 0$. The event occurs at the end of this interval, so $\\delta=1$.\n\nThe start-stop representation for Subject A is as follows:\n| Start Time ($t_{start}$) | Stop Time ($t_{stop}$) | Covariate Value ($X$) | Event Indicator ($\\delta$) |\n|--------------------------|------------------------|-----------------------|----------------------------|\n| $0$                      | $2$                    | $0$                   | $0$                        |\n| $2$                      | $5$                    | $1$                   | $0$                        |\n| $5$                      | $6$                    | $0$                   | $1$                        |\n\n#### Part 2: Contribution to the Partial Likelihood\n\nThe contribution to the Cox partial likelihood for an event at time $t_i$ for individual $i$ in stratum $s_i$ is the ratio of the hazard of the failing individual to the sum of the hazards of all individuals in the stratum-specific risk set $R(t_i, s_i)$.\n$$\nL_i = \\frac{h_i(t_i | X_i(t_i))}{\\sum_{j \\in R(t_i, s_i)} h_j(t_i | X_j(t_i))} = \\frac{h_{0,s_i}(t_i)\\exp(\\beta X_i(t_i))}{\\sum_{j \\in R(t_i, s_i)} h_{0,s_i}(t_i)\\exp(\\beta X_j(t_i))} = \\frac{\\exp(\\beta X_i(t_i))}{\\sum_{j \\in R(t_i, s_i)} \\exp(\\beta X_j(t_i))}\n$$\nWe calculate this for Subject A's event at $t=6$ in stratum $s=1$. The risk set $R(6, 1)$ consists of subjects $\\{A, B, C\\}$. We need the covariate values for each subject at the event time $t=6$.\n\n- **Subject A**: The last covariate update was $Z(5)=0$. Thus, $X_A(6)=0$.\n- **Subject B**: The last covariate update before $t=6$ was $W(4)=2$. Thus, $X_B(6)=2$.\n- **Subject C**: The covariate is constant, $U(t) \\equiv 0.5$. Thus, $X_C(6)=0.5$.\n\nThe numerator is for Subject A, who had the event:\n$$\n\\text{Numerator} = \\exp(\\beta X_A(6)) = \\exp(\\beta \\cdot 0) = 1\n$$\n\nThe denominator is the sum over all individuals in the risk set $R(6, 1)$:\n$$\n\\text{Denominator} = \\sum_{j \\in \\{A, B, C\\}} \\exp(\\beta X_j(6)) = \\exp(\\beta X_A(6)) + \\exp(\\beta X_B(6)) + \\exp(\\beta X_C(6))\n$$\nSubstituting the covariate values:\n$$\n\\text{Denominator} = \\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 2) + \\exp(\\beta \\cdot 0.5) = 1 + \\exp(2\\beta) + \\exp(0.5\\beta)\n$$\n\nThe contribution of Subject A's event to the partial likelihood is the ratio of the numerator to the denominator:\n$$\nL_A = \\frac{1}{1 + \\exp(2\\beta) + \\exp(0.5\\beta)}\n$$\nThis is the final simplified analytic expression.", "answer": "$$\n\\boxed{\\frac{1}{1 + \\exp(2\\beta) + \\exp(0.5\\beta)}}\n$$", "id": "4961494"}, {"introduction": "After understanding how a single event contributes to the partial likelihood, the next step is to assemble the contributions from all events in a study. This practice guides you through constructing the full partial likelihood for a small cohort with time-dependent covariates [@problem_id:4961492]. By tracking the composition of the risk set as it shrinks over time, you will develop a deep, step-by-step intuition for how the Cox model aggregates information across the entire follow-up period to estimate the effect parameter $\\beta$.", "problem": "Consider a cohort of three subjects, indexed by $i \\in \\{1,2,3\\}$, each experiencing exactly one event with distinct event times $T_{1}=2$, $T_{2}=4$, and $T_{3}=6$. There is no censoring. Let $X_{i}(t)$ denote a single scalar time-dependent covariate for subject $i$, defined as follows: $X_{1}(t)=0$ for all $t$, $X_{2}(t)=0$ for $t<3$ and $X_{2}(t)=1$ for $t\\ge 3$, and $X_{3}(t)=0$ for $t<3$ and $X_{3}(t)=2$ for $t\\ge 3$. Assume a single stratum (i.e., no stratification) and adopt the Cox proportional hazards model, whose hazard at time $t$ for a subject with covariate history $X(t)$ is $h(t \\mid X(t))=h_{0}(t)\\exp\\!\\big(\\beta X(t)\\big)$, where $h_{0}(t)$ is an unspecified baseline hazard and $\\beta$ is an unknown regression coefficient.\n\nUsing only the model definition above and the interpretation of hazard as an instantaneous event rate, derive the partial likelihood for $\\beta$ by (i) identifying the appropriate risk sets at each event time and (ii) forming the product of the conditional probabilities that the observed subject is the one who fails at each event time, given the risk set at that time. Simplify your result to a single closed-form analytic expression in terms of $\\beta$. Express your final answer as an exact expression; no rounding is required.", "solution": "The partial likelihood, $L(\\beta)$, is the product of conditional probabilities over the set of observed event times. For an event at time $t_{(j)}$ for subject $i_j$, the contribution is the risk of subject $i_j$ divided by the sum of risks of all subjects in the risk set $R(t_{(j)})$.\n$$ L(\\beta) = \\prod_{j=1}^{k} \\frac{\\exp(\\beta X_{i_j}(t_{(j)}))}{\\sum_{l \\in R(t_{(j)})} \\exp(\\beta X_l(t_{(j)}))} $$\nWe are given three subjects with distinct event times $T_1=2$, $T_2=4$, and $T_3=6$. The ordered event times are $t_{(1)}=2$ (subject $1$ fails), $t_{(2)}=4$ (subject $2$ fails), and $t_{(3)}=6$ (subject $3$ fails).\n\n**Event 1: Failure at $t_{(1)} = 2$**\nThe subject failing is subject $1$. The risk set is $R(2)=\\{1, 2, 3\\}$.\nWe evaluate the covariates for each subject in the risk set at $t=2$:\n- Subject $1$: $X_1(2) = 0$.\n- Subject $2$: For $t3$, $X_2(t)=0$, so $X_2(2) = 0$.\n- Subject $3$: For $t3$, $X_3(t)=0$, so $X_3(2) = 0$.\n\nThe first term of the partial likelihood is:\n$$ L_1(\\beta) = \\frac{\\exp(\\beta X_1(2))}{\\exp(\\beta X_1(2)) + \\exp(\\beta X_2(2)) + \\exp(\\beta X_3(2))} = \\frac{\\exp(\\beta \\cdot 0)}{\\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0) + \\exp(\\beta \\cdot 0)} = \\frac{1}{1+1+1} = \\frac{1}{3} $$\n\n**Event 2: Failure at $t_{(2)} = 4$**\nThe subject failing is subject $2$. Subject $1$ has already failed, so the risk set is $R(4)=\\{2, 3\\}$.\nWe evaluate the covariates for each subject in the risk set at $t=4$:\n- Subject $2$: For $t \\ge 3$, $X_2(t)=1$, so $X_2(4) = 1$.\n- Subject $3$: For $t \\ge 3$, $X_3(t)=2$, so $X_3(4) = 2$.\n\nThe second term of the partial likelihood is:\n$$ L_2(\\beta) = \\frac{\\exp(\\beta X_2(4))}{\\exp(\\beta X_2(4)) + \\exp(\\beta X_3(4))} = \\frac{\\exp(\\beta \\cdot 1)}{\\exp(\\beta \\cdot 1) + \\exp(\\beta \\cdot 2)} = \\frac{\\exp(\\beta)}{\\exp(\\beta) + \\exp(2\\beta)} $$\nThis simplifies by factoring out $\\exp(\\beta)$ from the denominator:\n$$ L_2(\\beta) = \\frac{\\exp(\\beta)}{\\exp(\\beta)(1 + \\exp(\\beta))} = \\frac{1}{1 + \\exp(\\beta)} $$\n\n**Event 3: Failure at $t_{(3)} = 6$**\nThe subject failing is subject $3$. The risk set is $R(6)=\\{3\\}$.\nThe covariate for subject $3$ at $t=6$ is $X_3(6)=2$.\nThe third term of the partial likelihood is:\n$$ L_3(\\beta) = \\frac{\\exp(\\beta X_3(6))}{\\exp(\\beta X_3(6))} = 1 $$\n\n**Total Partial Likelihood**\nThe total partial likelihood $L(\\beta)$ is the product of the terms:\n$$ L(\\beta) = L_1(\\beta) \\cdot L_2(\\beta) \\cdot L_3(\\beta) = \\left(\\frac{1}{3}\\right) \\cdot \\left(\\frac{1}{1 + \\exp(\\beta)}\\right) \\cdot (1) $$\n$$ L(\\beta) = \\frac{1}{3(1 + \\exp(\\beta))} $$", "answer": "$$\\boxed{\\frac{1}{3(1 + \\exp(\\beta))}}$$", "id": "4961492"}, {"introduction": "While theoretical examples often assume distinct event times, real-world data frequently contains ties, where multiple subjects experience an event at the same recorded time. This exercise tackles this practical challenge by asking you to compare the two most widely used methods for handling ties: the Breslow and Efron approximations [@problem_id:4961541]. By numerically calculating the likelihood contribution under both approaches for a specific scenario, you will gain insight into their underlying assumptions and see why the Efron approximation is generally preferred for its greater accuracy.", "problem": "Consider a stratified Cox proportional hazards model in which the instantaneous hazard for individual $i$ in stratum $s$ at time $t$ is given by $h_{is}(t)=h_{0s}(t)\\exp\\{\\beta X_i(t)\\}$, where $h_{0s}(t)$ is the stratum-specific baseline hazard and $X_i(t)$ is a time-dependent covariate. At time $t=5$, exactly three failures are tied within stratum $\\mathcal{S}_A$, coming from subjects $1$, $2$, and $3$, whose covariate values are $X_1(5)=1$, $X_2(5)=3$, and $X_3(5)=2$. The stratum-specific risk set $\\mathcal{R}_A(5)$ additionally contains five other individuals (subjects $4$–$8$) at risk at $t=5$ with covariate values $X_4(5)=0$, $X_5(5)=1.5$, $X_6(5)=2.2$, $X_7(5)=-0.5$, and $X_8(5)=3.1$. Assume a common regression coefficient $\\beta=0.4$ across strata and that tied failures occur only within $\\mathcal{S}_A$ at $t=5$.\n\nStarting from the definition of the Cox partial likelihood and the conceptual basis of tie handling, derive the contribution at $t=5$ to the partial likelihood under the Breslow approximation (which treats the tied failures as occurring simultaneously) and under the Efron approximation (which spreads the tied failures uniformly over the tie interval). Compute both contributions numerically for the given data. Then, report the ratio $\\text{Efron}/\\text{Breslow}$ for the partial likelihood contribution at $t=5$, rounded to four significant figures. Express the final ratio as a pure number with no units.", "solution": "To handle the $d=3$ tied failures at $t=5$, we first define several quantities. The risk score for each individual $i$ is $\\exp\\{\\beta X_i(t)\\}$. Let $N$ be the product of the risk scores for the failing individuals, $D$ be the sum of the risk scores for the failing individuals, and $W$ be the sum of the risk scores for all individuals in the risk set $\\mathcal{R}_A(5)$. The common baseline hazard $h_{0s}(t)$ cancels from all partial likelihood calculations.\n\nGiven $\\beta=0.4$, we compute the risk scores $\\exp\\{0.4 X_i(5)\\}$.\nFor the $d=3$ failing subjects (set $\\mathcal{D}_A(5)$):\n- Subject 1: $X_1(5)=1 \\implies \\exp(0.4) \\approx 1.49182$\n- Subject 2: $X_2(5)=3 \\implies \\exp(1.2) \\approx 3.32012$\n- Subject 3: $X_3(5)=2 \\implies \\exp(0.8) \\approx 2.22554$\nThe sum of risk scores for the failing subjects is $D \\approx 1.49182 + 3.32012 + 2.22554 = 7.03748$.\nThe numerator for both approximations is the product of these risk scores, $N = \\exp\\{0.4(1+3+2)\\} = \\exp(2.4) \\approx 11.02318$.\n\nFor the 5 non-failing subjects at risk:\n- Subject 4: $X_4(5)=0 \\implies \\exp(0) = 1$\n- Subject 5: $X_5(5)=1.5 \\implies \\exp(0.6) \\approx 1.82212$\n- Subject 6: $X_6(5)=2.2 \\implies \\exp(0.88) \\approx 2.41090$\n- Subject 7: $X_7(5)=-0.5 \\implies \\exp(-0.2) \\approx 0.81873$\n- Subject 8: $X_8(5)=3.1 \\implies \\exp(1.24) \\approx 3.45561$\nThe sum of risk scores for these non-failing subjects is approximately $9.50736$.\n\nThe total sum of risk scores for the entire risk set is $W = D + 9.50736 \\approx 7.03748 + 9.50736 = 16.54484$.\n\n**Breslow Approximation**\nThe formula for the Breslow contribution is:\n$$ L_{\\text{Breslow}} = \\frac{N}{W^d} = \\frac{\\prod_{i \\in \\mathcal{D}_A(5)} \\exp\\{\\beta X_i(5)\\}}{(\\sum_{j \\in \\mathcal{R}_A(5)} \\exp\\{\\beta X_j(5)\\})^d} $$\nWith $d=3$, this is:\n$$ L_{\\text{Breslow}} \\approx \\frac{11.02318}{(16.54484)^3} \\approx \\frac{11.02318}{4528.85} \\approx 0.0024330 $$\n\n**Efron Approximation**\nThe formula for the Efron contribution is:\n$$ L_{\\text{Efron}} = \\frac{N}{\\prod_{r=0}^{d-1} (W - \\frac{r}{d}D)} $$\nWith $d=3$, the denominator is the product of three terms:\n- For $r=0$: $W \\approx 16.54484$\n- For $r=1$: $W - \\frac{1}{3}D \\approx 16.54484 - \\frac{7.03748}{3} \\approx 14.19901$\n- For $r=2$: $W - \\frac{2}{3}D \\approx 16.54484 - \\frac{2 \\times 7.03748}{3} \\approx 11.85318$\nThe denominator is the product: $16.54484 \\times 14.19901 \\times 11.85318 \\approx 2784.56$.\nThe Efron contribution is:\n$$ L_{\\text{Efron}} \\approx \\frac{11.02318}{2784.56} \\approx 0.0039601 $$\n\n**Ratio**\nThe ratio is:\n$$ \\frac{L_{\\text{Efron}}}{L_{\\text{Breslow}}} \\approx \\frac{0.0039601}{0.0024330} \\approx 1.62766 $$\nAlternatively, the ratio can be calculated from the denominators:\n$$ \\frac{W^3}{\\prod_{r=0}^{2}(W - \\frac{r}{3}D)} \\approx \\frac{4528.85}{2784.56} \\approx 1.62642 $$\nRounding to four significant figures, the ratio is $1.626$.", "answer": "$$\\boxed{1.626}$$", "id": "4961541"}]}