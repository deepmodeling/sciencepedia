{"hands_on_practices": [{"introduction": "Every day, laboratories produce millions of results. To ensure a \"glucose\" result from one hospital means the exact same thing as a \"glucose\" result from another, we rely on standards like LOINC (Logical Observation Identifiers Names and Codes). This exercise challenges you to apply the LOINC six-axis model to deconstruct the common lab test \"Serum glucose.\" giving you a practical understanding of how structured terminologies create the unambiguous meaning that underpins data interoperability. [@problem_id:4828090]", "problem": "A clinical laboratory information system needs to represent a single time-point quantitative measurement of serum glucose using the six-axis compositional model of Logical Observation Identifiers Names and Codes (LOINC). The six LOINC axes are defined as follows: Component (the analyte or observation), Property (the characteristic measured), Time (the temporal aspect of the measurement), System (the specimen or system), Scale (the measurement scale type), and Method (the analytic technique). The system receives a typical chemistry result reported in milligrams per deciliter for a serum specimen collected at a single time point without a specified method. Based on these definitions, determine the appropriate axis assignments for the observation “Serum glucose.” Justify each axis choice from first principles of the LOINC model and the semantics of quantitative laboratory results.\n\nTo produce a single internal numeric control code for downstream processing, the institution uses the following compositional encoding rule, which maps each chosen axis term to an integer and combines them multiplicatively:\n- Component:\n  - Glucose: $c_{\\mathrm{Glucose}} = 19$\n- Property:\n  - Mass concentration (LOINC property code “MCnc”): $p_{\\mathrm{MCnc}} = 23$\n  - Substance concentration (LOINC property code “SCnc”): $p_{\\mathrm{SCnc}} = 17$\n- Time:\n  - Point in time: $t_{\\mathrm{Pt}} = 29$\n- System:\n  - Serum: $s_{\\mathrm{Ser}} = 31$\n- Scale:\n  - Quantitative: $q_{\\mathrm{Qn}} = 37$\n- Method:\n  - None specified: $m_{\\mathrm{None}} = 41$\n\nGiven your justified axis assignments, compute the composite internal code $E$:\n$$E = c \\times p \\times t \\times s \\times q \\times m.$$\nReport the final value of $E$ as a single integer. No rounding is required and no units should be included in the final numeric result.", "solution": "The task is to assign the six LOINC axes for the observation “Serum glucose” and then compute a composite internal numeric code by multiplying the mapped integers for each axis choice. We proceed from the core definitions in the LOINC model.\n\nFirst principles for axis selection:\n1. Component axis definition: The Component axis represents the analyte or phenomenon being measured. For “Serum glucose,” the analyte is glucose. Therefore, the Component is “Glucose,” which maps to $c_{\\mathrm{Glucose}} = 19$.\n\n2. Property axis definition: The Property axis denotes the measured characteristic (for example, mass concentration, substance concentration, presence, ratio). Clinical chemistry results for glucose in serum are commonly reported in milligrams per deciliter, which reflects a mass per unit volume. In LOINC, mass concentration is denoted by “MCnc.” By contrast, “SCnc” denotes substance (amount-of-substance) concentration, typically reported in millimoles per liter. Because the laboratory result is provided in milligrams per deciliter, the appropriate property is mass concentration. Thus, Property is “MCnc,” which maps to $p_{\\mathrm{MCnc}} = 23$ (and we do not use $p_{\\mathrm{SCnc}} = 17$).\n\n3. Time axis definition: The Time axis captures the temporal aspect of the measurement (for example, a single point in time versus a time interval or collection over a duration). The observation is described explicitly as a single time-point measurement; in LOINC, this is “Pt” (point in time). Therefore, Time is “Pt,” which maps to $t_{\\mathrm{Pt}} = 29$.\n\n4. System axis definition: The System axis specifies the specimen or system. The observation states “Serum glucose,” which unambiguously identifies serum as the specimen. Therefore, System is “Ser,” which maps to $s_{\\mathrm{Ser}} = 31$.\n\n5. Scale axis definition: The Scale axis indicates the type of scale used for reporting results, such as quantitative, ordinal, nominal, or narrative. A numeric laboratory value for glucose is a quantitative measurement. LOINC denotes this as “Qn.” Therefore, Scale is “Qn,” which maps to $q_{\\mathrm{Qn}} = 37$.\n\n6. Method axis definition: The Method axis optionally captures the analytic technique (for example, enzymatic method, potentiometry). The problem states that no method is specified. In LOINC, omitting the method is standard when the technique is unspecified or not material to result interpretation. Therefore, Method is “None,” which maps to $m_{\\mathrm{None}} = 41$.\n\nWith these justified axis assignments, we compute the composite internal code using the provided multiplicative rule:\n$$\nE = c \\times p \\times t \\times s \\times q \\times m\n= 19 \\times 23 \\times 29 \\times 31 \\times 37 \\times 41.\n$$\n\nWe multiply step by step:\n- First, $19 \\times 23 = 437$.\n- Next, $437 \\times 29 = 12673$.\n- Then, $12673 \\times 31 = 392863$.\n- Next, $392863 \\times 37 = 14535931$.\n- Finally, $14535931 \\times 41 = 595973171$.\n\nThus, the composite internal code is\n$$\nE = 595973171.\n$$\n\nThis numeric result reflects the justified six-axis LOINC representation for “Serum glucose” as Glucose/MCnc/Pt/Ser/Qn/None under the institution’s encoding scheme.", "answer": "$$\\boxed{595973171}$$", "id": "4828090"}, {"introduction": "Clinical care often involves complex groups of concepts, such as \"all beta-blocker medications.\" Instead of a static list, we can use the logical structure of SNOMED CT to create a dynamic, query-based definition—an intensional value set—that automatically includes new beta-blockers as they are approved. In this practice, you will work with a miniature SNOMED CT-like ontology to define and expand such a value set, simulating the core task of building patient cohorts for analytics or clinical decision support. [@problem_id:4827973]", "problem": "You are given a simplified, self-contained subset of a clinical terminology system designed to mimic core behavior of Systematized Nomenclature of Medicine Clinical Terms (SNOMED CT). Each concept is identified by an integer concept identifier, a human-readable display name, an activity status, and a set of relationships and properties. The ontology is modeled as a directed acyclic graph with an $\\text{is\\_a}$ parent relation for taxonomic hierarchy and a $\\text{has\\_active\\_ingredient}$ attribute for clinical drugs pointing to their active ingredient substances. You will use this miniature ontology to define an intensional ValueSet for “Beta blockers” and implement an expansion function $expand$ with filters.\n\nFundamental base and rules to use:\n1. A concept $x$ is a descendant-or-self of a concept $y$ if there exists a path (possibly of length $0$) following zero or more $\\text{is\\_a}$ edges from $x$ to $y$. Formally, $descOrSelf(x,y)$ holds if $x=y$ or there exists $p$ such that $\\text{is\\_a}(x,p)$ and $descOrSelf(p,y)$.\n2. A “clinical drug” concept $c$ has a $\\text{has\\_active\\_ingredient}$ attribute to some “substance” concept $s$. If a concept lacks $\\text{has\\_active\\_ingredient}$, it is not a clinical drug in this dataset.\n3. An intensional ValueSet is defined by a logical predicate over concepts. Its expansion is the set of all concepts that satisfy the predicate at evaluation time (no fixed, enumerated list in the definition).\n\nMini-terminology (concept identifier, display, active status, relationships/properties):\n- Substances:\n  - $100000$: “Substance (substance)”, active $\\mathrm{True}$; parents: none.\n  - $111000$: “Beta adrenergic receptor antagonist (substance)”, active $\\mathrm{True}$; parents: $\\{100000\\}$.\n  - $111100$: “Atenolol (substance)”, active $\\mathrm{True}$; parents: $\\{111000\\}$.\n  - $111200$: “Metoprolol (substance)”, active $\\mathrm{True}$; parents: $\\{111000\\}$.\n  - $111300$: “Propranolol (substance)”, active $\\mathrm{True}$; parents: $\\{111000\\}$.\n  - $111400$: “Carvedilol (substance)”, active $\\mathrm{True}$; parents: $\\{111000\\}$.\n  - $112000$: “Amlodipine (substance)”, active $\\mathrm{True}$; parents: $\\{100000\\}$.\n\n- Clinical drugs (each has $\\text{has\\_active\\_ingredient}$ and a dose form):\n  - $201100$: “Atenolol 50 mg oral tablet”, active $\\mathrm{True}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=111100$; $\\text{dose\\_form}=\\text{\"tablet\"}$.\n  - $201101$: “Atenolol 25 mg oral tablet”, active $\\mathrm{True}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=111100$; $\\text{dose\\_form}=\\text{\"tablet\"}$.\n  - $201150$: “Atenolol 10 mg/mL injection”, active $\\mathrm{False}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=111100$; $\\text{dose\\_form}=\\text{\"injection\"}$.\n  - $202100$: “Metoprolol 50 mg oral tablet”, active $\\mathrm{True}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=111200$; $\\text{dose\\_form}=\\text{\"tablet\"}$.\n  - $202110$: “Metoprolol 5 mg/mL injection”, active $\\mathrm{True}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=111200$; $\\text{dose\\_form}=\\text{\"injection\"}$.\n  - $203100$: “Propranolol 10 mg oral tablet”, active $\\mathrm{True}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=111300$; $\\text{dose\\_form}=\\text{\"tablet\"}$.\n  - $203200$: “Propranolol 40 mg oral tablet”, active $\\mathrm{True}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=111300$; $\\text{dose\\_form}=\\text{\"tablet\"}$.\n  - $204100$: “Carvedilol 6.25 mg oral tablet”, active $\\mathrm{True}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=111400$; $\\text{dose\\_form}=\\text{\"tablet\"}$.\n  - $204200$: “Carvedilol 3.125 mg oral tablet”, active $\\mathrm{True}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=111400$; $\\text{dose\\_form}=\\text{\"tablet\"}$.\n  - $205100$: “Amlodipine 5 mg oral tablet”, active $\\mathrm{True}$; parents: $\\varnothing$; $\\text{has\\_active\\_ingredient}=112000$; $\\text{dose\\_form}=\\text{\"tablet\"}$.\n\nIntensional ValueSet definition for “Beta blockers”:\nLet $B=111000$ denote the “Beta adrenergic receptor antagonist (substance)” concept. Define the ValueSet $V$ as all clinical drugs $c$ such that there exists a substance $s$ with $\\text{has\\_active\\_ingredient}(c)=s$ and $descOrSelf(s,B)$ holds. Formally,\n$$\nV \\;=\\; \\{\\, c \\mid \\exists s\\;(\\text{has\\_active\\_ingredient}(c)=s \\land descOrSelf(s,B)) \\,\\}.\n$$\n\nBehavior of the expansion function $expand$ with filters:\nGiven filters $(a,t,d)$ where $a\\in\\{0,1\\}$ is an “active only” flag, $t$ is a (possibly empty) string for a case-insensitive substring match applied to the display, and $d$ is a (possibly empty) string for an exact match on $\\text{dose\\_form}$, define\n$$\nexpand(V,a,t,d) \\;=\\; \\mathrm{sort}_{\\uparrow}\\Big(\\{\\, \\mathrm{id}(c) \\in V \\;\\mid\\; (a=0 \\lor \\mathrm{active}(c)=\\mathrm{True}) \\land (\\lvert t\\rvert=0 \\lor t \\text{ occurs in display}(c)) \\land (\\lvert d\\rvert=0 \\lor \\text{dose\\_form}(c)=d) \\,\\}\\Big),\n$$\nwhere $\\mathrm{sort}_{\\uparrow}$ sorts concept identifiers in ascending numerical order, and “$t$ occurs in display$(c)$” is a case-insensitive substring test.\n\nTask:\n- Implement a program that constructs the set $V$ using the ontology above and computes $expand(V,a,t,d)$ for each test case below. All string comparisons for $t$ must be case-insensitive. Sorting must be strictly in ascending numeric order of concept identifiers.\n\nTest suite (each test case is a triple $(a,t,d)$):\n1. $(0,\\text{\"\"},\\text{\"\"})$\n2. $(1,\\text{\"\"},\\text{\"\"})$\n3. $(1,\\text{\"tablet\"},\\text{\"\"})$\n4. $(1,\\text{\"\"},\\text{\"injection\"})$\n5. $(1,\\text{\"metoprolol\"},\\text{\"\"})$\n6. $(1,\\text{\"\"},\\text{\"capsule\"})$\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the list result of $expand(V,a,t,d)$ for the corresponding test case. For example: $[\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$. The results must be lists of integers representing concept identifiers, in ascending order, with no additional text. No physical units or angles apply in this task, and no percentages are required.", "solution": "The problem has been validated and is deemed sound, well-posed, and objective. It provides a self-contained dataset and a clear, formal set of rules for computation. All necessary information is present, and there are no contradictions. We may proceed with the solution.\n\nThe task is to implement an expansion function for an intensionally defined ValueSet within a simplified clinical terminology system. This requires several steps: representing the terminology, implementing the hierarchical relationship logic, constructing the initial ValueSet, and then applying a series of filters for each test case.\n\n**Step 1: Data Representation**\n\nFirst, we must structure the provided terminology data for efficient access. The concepts and their properties can be stored in a dictionary, mapping each concept identifier (an integer) to an object or dictionary containing its attributes: `display` (string), `active` (boolean), `parents` (set of integers), `has_active_ingredient` (integer, if applicable), and `dose_form` (string, if applicable).\n\nThe `is_a` relationships, defined by the `parents` property, form a directed acyclic graph. We can represent this explicitly as a child-to-parents mapping, which will be used for traversing the hierarchy. For example, for a concept `c` with `parents: {p1, p2}`, we have `is_a(c, p1)` and `is_a(c, p2)`.\n\n**Step 2: Implementing the `descOrSelf` Function**\n\nThe `descOrSelf(x, y)` predicate is central to defining the ValueSet. It holds if concept $x$ is a descendant of concept $y$ or is $y$ itself. This is equivalent to checking if there is a path from $x$ to $y$ in the `is_a` hierarchy graph. The formal definition provided, $descOrSelf(x,y)$ holds if $x=y$ or there exists $p$ such that $\\text{is\\_a}(x,p)$ and $descOrSelf(p,y)$, naturally leads to a recursive algorithm.\n\nWe will implement a function `is_descendant_or_self(x, y, parent_map)` that traverses upwards from concept $x$ through its parents.\n1.  Base case 1: If $x = y$, the condition is met, return `True`.\n2.  Base case 2: If $x$ has no parents, it cannot be a descendant of any other concept, so return `False`.\n3.  Recursive step: For each parent $p$ of $x$, recursively call `is_descendant_or_self(p, y, parent_map)`. If any of these calls return `True`, then $x$ is a descendant of $y$, and we return `True`.\n4.  If the recursion completes for all parents without finding $y$, return `False`.\n\nTo avoid recomputing paths in the graph, we can use memoization, storing the results of `(x, y)` pairs.\n\n**Step 3: Constructing the Intensional ValueSet `V`**\n\nThe ValueSet $V$ is defined as:\n$$\nV \\;=\\; \\{\\, c \\mid \\exists s\\;(\\text{has\\_active\\_ingredient}(c)=s \\land descOrSelf(s,B)) \\,\\}\n$$\nwhere $B = 111000$ corresponds to \"Beta adrenergic receptor antagonist (substance)\".\n\nTo compute the members of $V$, we iterate through all concepts in our dataset:\n1.  Identify concepts that are \"clinical drugs\". According to the problem, these are the concepts that have the `has_active_ingredient` property.\n2.  For each clinical drug $c$, retrieve its active ingredient substance $s$, where $\\text{has\\_active\\_ingredient}(c) = s$.\n3.  Evaluate the predicate $descOrSelf(s, B)$ using our function from Step 2.\n4.  If the predicate is true, the concept identifier of $c$ is added to the set of members of $V$.\n\nLet's trace this for our data:\n- The target ancestor is $B = 111000$.\n- The substances that are descendants-or-self of $B$ are $111100$ (Atenolol), $111200$ (Metoprolol), $111300$ (Propranolol), and $111400$ (Carvedilol). The substance $112000$ (Amlodipine) is not a descendant of $B$.\n- We find all clinical drugs whose `has_active_ingredient` is one of these four substances.\n- This includes all drug concepts from $201100$ to $204200$. The drug concept $205100$ (Amlodipine tablet) is excluded.\n- The resulting set of concept identifiers for $V$ is $\\{201100, 201101, 201150, 202100, 202110, 203100, 203200, 204100, 204200\\}$.\n\n**Step 4: Implementing the `expand` Function**\n\nThe expansion function $expand(V, a, t, d)$ filters the concepts in $V$ based on a set of criteria and returns a sorted list of their identifiers.\n\nFor a given set of filters $(a, t, d)$, the process is:\n1.  Start with the full set of concepts whose identifiers are in $V$.\n2.  **Activity Filter**: If the flag $a=1$, filter the set, retaining only concepts $c$ where `active(c)` is `True`. If $a=0$, this filter is skipped.\n3.  **Display Name Filter**: If the filter string $t$ is not empty, filter the current set. For each concept $c$, retain it only if $t$ appears as a case-insensitive substring within its display name `display(c)`.\n4.  **Dose Form Filter**: If the filter string $d$ is not empty, filter the current set. Retain concept $c$ only if its `dose_form(c)` property is an exact match for $d$.\n5.  After all filters are applied, collect the concept identifiers of the remaining concepts.\n6.  Sort these identifiers in ascending numerical order, as required by $\\mathrm{sort}_{\\uparrow}$.\n\n**Step 5: Executing the Test Suite**\n\nWe apply the `expand` function to the set $V$ for each test case $(a,t,d)$.\n\n1.  **Test Case $(0, \\text{\"\"}, \\text{\"\"})$**: No filters are applied ($a=0$, $t$ and $d$ are empty). The result is all concept identifiers in $V$, sorted.\n    - Result: $[201100, 201101, 201150, 202100, 202110, 203100, 203200, 204100, 204200]$\n\n2.  **Test Case $(1, \\text{\"\"}, \\text{\"\"})$**: Filter for active concepts only ($a=1$). This removes concept $201150$, which is `active=False`.\n    - Result: $[201100, 201101, 202100, 202110, 203100, 203200, 204100, 204200]$\n\n3.  **Test Case $(1, \\text{\"tablet\"}, \\text{\"\"})$**: Filter for active concepts and those with \"tablet\" in their display name. Starting from the result of case $2$, we remove concepts whose display name does not contain \"tablet\". This removes $202110$ (\"Metoprolol 5 mg/mL injection\").\n    - Result: $[201100, 201101, 202100, 203100, 203200, 204100, 204200]$\n\n4.  **Test Case $(1, \\text{\"\"}, \\text{\"injection\"})$**: Filter for active concepts with `dose_form` equal to \"injection\". Starting from the result of case $2$, only $202110$ matches the `dose_form` filter.\n    - Result: $[202110]$\n\n5.  **Test Case $(1, \\text{\"metoprolol\"}, \\text{\"\"})$**: Filter for active concepts with \"metoprolol\" in their display name. Starting from the result of case $2$, only concepts $202100$ and $202110$ match the display name filter.\n    - Result: $[202100, 202110]$\n\n6.  **Test Case $(1, \\text{\"\"}, \\text{\"capsule\"})$**: Filter for active concepts with `dose_form` equal to \"capsule\". No concepts in $V$ have this `dose_form`.\n    - Result: $[]$\n\nThese steps provide a complete algorithm to solve the problem, which will be implemented in the final program.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the clinical terminology expansion problem.\n    \"\"\"\n    \n    # Define the miniature terminology dataset\n    concepts_data = [\n        # Substances\n        (100000, \"Substance (substance)\", True, [], {}),\n        (111000, \"Beta adrenergic receptor antagonist (substance)\", True, [100000], {}),\n        (111100, \"Atenolol (substance)\", True, [111000], {}),\n        (111200, \"Metoprolol (substance)\", True, [111000], {}),\n        (111300, \"Propranolol (substance)\", True, [111000], {}),\n        (111400, \"Carvedilol (substance)\", True, [111000], {}),\n        (112000, \"Amlodipine (substance)\", True, [100000], {}),\n        # Clinical drugs\n        (201100, \"Atenolol 50 mg oral tablet\", True, [], {\"has_active_ingredient\": 111100, \"dose_form\": \"tablet\"}),\n        (201101, \"Atenolol 25 mg oral tablet\", True, [], {\"has_active_ingredient\": 111100, \"dose_form\": \"tablet\"}),\n        (201150, \"Atenolol 10 mg/mL injection\", False, [], {\"has_active_ingredient\": 111100, \"dose_form\": \"injection\"}),\n        (202100, \"Metoprolol 50 mg oral tablet\", True, [], {\"has_active_ingredient\": 111200, \"dose_form\": \"tablet\"}),\n        (202110, \"Metoprolol 5 mg/mL injection\", True, [], {\"has_active_ingredient\": 111200, \"dose_form\": \"injection\"}),\n        (203100, \"Propranolol 10 mg oral tablet\", True, [], {\"has_active_ingredient\": 111300, \"dose_form\": \"tablet\"}),\n        (203200, \"Propranolol 40 mg oral tablet\", True, [], {\"has_active_ingredient\": 111300, \"dose_form\": \"tablet\"}),\n        (204100, \"Carvedilol 6.25 mg oral tablet\", True, [], {\"has_active_ingredient\": 111400, \"dose_form\": \"tablet\"}),\n        (204200, \"Carvedilol 3.125 mg oral tablet\", True, [], {\"has_active_ingredient\": 111400, \"dose_form\": \"tablet\"}),\n        (205100, \"Amlodipine 5 mg oral tablet\", True, [], {\"has_active_ingredient\": 112000, \"dose_form\": \"tablet\"}),\n    ]\n\n    # Process data into a more usable format\n    concepts = {}\n    parents_map = {}\n    for cid, display, active, parents, props in concepts_data:\n        concepts[cid] = {\n            \"id\": cid,\n            \"display\": display,\n            \"active\": active,\n            **props\n        }\n        parents_map[cid] = set(parents)\n\n    memo_desc = {}\n    def is_descendant_or_self(x, y):\n        \"\"\"\n        Checks if concept x is a descendant of or is concept y using recursion with memoization.\n        \"\"\"\n        if (x, y) in memo_desc:\n            return memo_desc[(x, y)]\n        \n        if x == y:\n            memo_desc[(x, y)] = True\n            return True\n        \n        if not parents_map.get(x):\n            memo_desc[(x, y)] = False\n            return False\n\n        # Recurse on parents\n        result = any(is_descendant_or_self(p, y) for p in parents_map[x])\n        memo_desc[(x, y)] = result\n        return result\n\n    # --- Step 1: Construct the ValueSet V ---\n    B = 111000  # \"Beta adrenergic receptor antagonist (substance)\"\n    V = set()\n    for cid, concept in concepts.items():\n        if \"has_active_ingredient\" in concept:\n            s = concept[\"has_active_ingredient\"]\n            if is_descendant_or_self(s, B):\n                V.add(cid)\n\n    # --- Step 2: Define and apply the expansion function ---\n    def expand(value_set_ids, a, t, d):\n        \"\"\"\n        Expands the value set with the given filters.\n        \"\"\"\n        candidate_concepts = [concepts[cid] for cid in value_set_ids]\n        \n        # Filter 1: Active status\n        if a == 1:\n            candidate_concepts = [c for c in candidate_concepts if c[\"active\"]]\n        \n        # Filter 2: Display name substring\n        if t:\n            t_lower = t.lower()\n            candidate_concepts = [c for c in candidate_concepts if t_lower in c[\"display\"].lower()]\n\n        # Filter 3: Dose form exact match\n        if d:\n            candidate_concepts = [c for c in candidate_concepts if c.get(\"dose_form\") == d]\n            \n        # Extract IDs and sort\n        result_ids = [c[\"id\"] for c in candidate_concepts]\n        result_ids.sort()\n        \n        return result_ids\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0, \"\", \"\"),\n        (1, \"\", \"\"),\n        (1, \"tablet\", \"\"),\n        (1, \"\", \"injection\"),\n        (1, \"metoprolol\", \"\"),\n        (1, \"\", \"capsule\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, t, d = case\n        result = expand(V, a, t, d)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The string representation of a Python list (e.g., '[1, 2]') is used for each sub-list.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4827973"}, {"introduction": "A patient's medication list often contains a messy mix of brand names, generics, and inconsistent dosages. To make sense of this data, we must first normalize it to a common standard like RxNorm, which links specific products to their core clinical concepts. This practice places you in the role of an informaticist evaluating a medication normalization pipeline, challenging you to first define the \"gold standard\" representation and then use data science metrics like the $F_1$ score to measure the pipeline's real-world performance. [@problem_id:4828018]", "problem": "You are building an interoperability pipeline that normalizes local medication records into the RxNorm clinical hierarchy. Use the following definitions as the foundational base: A National Drug Code (NDC) uniquely identifies a drug product at the package level in the United States and consists of labeler, product, and package segments; in RxNorm, the Semantic Clinical Drug (SCD) concept type is defined by the clinical drug’s normalized ingredient, strength, and dose form (for example, “Ingredient Strength DoseForm”) and is distinct from the Semantic Branded Drug (SBD), which additionally encodes branding. The RxNorm standard canonicalizes dose form terms (for example, “Oral Tablet”) and strengths (for example, “MG”), and the normalization pathway from a local NDC typically proceeds by validating the NDC, mapping directly to an RxNorm concept via the current NDC-to-RxCUI crosswalk, and, if the initial mapping lands on an SBD, projecting to the clinically equivalent SCD by dropping brand attributes while preserving ingredient, strength, and dose form.\n\nTask A (conceptual construction): Construct the normalized RxNorm SCD representation for the clinical concept “Metformin $500$ mg oral tablet.” following RxNorm naming conventions for SCDs. Your construction must be expressed in the standard SCD lexical form described above.\n\nTask B (quantitative evaluation of normalization): You have a local dataset of $12$ product records with NDCs and structured fields (ingredient, strength, dose form, route). The true underlying clinical products in these local records are:\n- $6$ records: Metformin $500$ mg immediate-release oral tablets (these are the intended target SCD). Exactly $1$ of these $6$ uses a retired NDC that no longer maps via the current NDC-to-RxCUI crosswalk.\n- $3$ records: Metformin $500$ mg extended-release oral tablets.\n- $2$ records: Metformin $1000$ mg immediate-release oral tablets.\n- $1$ record: Metformin $500$ mg oral solution.\n\nYour pipeline’s normalization steps are: (i) validate NDCs and drop those that fail crosswalk lookup; (ii) map valid NDCs to RxNorm; if the mapping is to a Semantic Branded Drug (SBD), reduce to its clinically equivalent Semantic Clinical Drug (SCD); (iii) use local structured fields to require dose form “tablet” and route “oral”; (iv) tokenize and normalize ingredient and strength to RxNorm canonical forms; (v) ignore release characteristics (that is, extended-release versus immediate-release is not distinguished by your current pipeline). The decision rule declares a “predicted positive” for the target concept if the normalized tuple is (ingredient = Metformin, strength = $500$ MG, dose form = Oral Tablet).\n\nUsing only the information above and standard definitions of precision, recall, and harmonic mean, compute the F$_1$ score of your pipeline for identifying the target SCD “Metformin $500$ MG Oral Tablet” on this dataset. Express the F$_1$ score as a decimal with no unit, and round your answer to four significant figures.", "solution": "The problem is evaluated as valid. It is scientifically grounded in the principles of medical informatics and clinical data normalization, specifically regarding the RxNorm standard. The problem is well-posed, providing a self-contained, complete, and consistent set of definitions, data, and procedural rules that allow for the derivation of a unique, unambiguous solution. It is expressed in objective, formal language, free of speculation or subjective claims.\n\nThe problem consists of two parts. Part A requires the conceptual construction of a Semantic Clinical Drug (SCD) name. Part B requires the quantitative evaluation of a normalization pipeline using standard performance metrics.\n\n**Part A: Conceptual Construction of the SCD**\n\nThe problem defines a Semantic Clinical Drug (SCD) in RxNorm by its normalized ingredient, strength, and dose form, following the lexical pattern “Ingredient Strength DoseForm”. We are asked to construct the SCD for the clinical concept “Metformin $500$ mg oral tablet”.\n\n1.  **Ingredient**: The ingredient is explicitly given as \"Metformin\". In RxNorm, ingredients are canonicalized, and \"Metformin\" is the standard name.\n2.  **Strength**: The strength is given as “$500$ mg”. The problem states that RxNorm canonicalizes strengths, providing “MG” as an example. Therefore, the normalized strength is \"$500$ MG\".\n3.  **Dose Form**: The dose form is given as “oral tablet”. The problem states that RxNorm canonicalizes dose form terms, providing “Oral Tablet” as an example. Therefore, the normalized dose form is \"Oral Tablet\".\n\nAssembling these components according to the specified SCD lexical form \"Ingredient Strength DoseForm\" yields:\nMetformin $500$ MG Oral Tablet.\n\n**Part B: Quantitative Evaluation of Normalization**\n\nTo compute the F$_1$ score, we must first determine the number of True Positives ($\\text{TP}$), False Positives ($\\text{FP}$), and False Negatives ($\\text{FN}$) produced by the pipeline for the given dataset. The F$_1$ score is the harmonic mean of precision and recall.\n\nThe relevant formulas are:\n$$ \\text{Precision} = \\frac{\\text{TP}}{\\text{TP} + \\text{FP}} $$\n$$ \\text{Recall} = \\frac{\\text{TP}}{\\text{TP} + \\text{FN}} $$\n$$ \\text{F}_1 = 2 \\times \\frac{\\text{Precision} \\times \\text{Recall}}{\\text{Precision} + \\text{Recall}} = \\frac{2 \\times \\text{TP}}{2 \\times \\text{TP} + \\text{FP} + \\text{FN}} $$\n\nFirst, we establish the ground truth from the dataset of $12$ records.\nThe target concept is the SCD for “Metformin $500$ MG Oral Tablet”. The problem specifies that the $6$ records of \"Metformin $500$ mg immediate-release oral tablets\" are the intended target.\n-   **Actual Positives ($P$)**: The number of records that truly represent the target concept. $P = 6$.\n-   **Actual Negatives ($N$)**: The number of records that do not represent the target concept. This includes the other $3+2+1=6$ records. $N = 6$.\n\nNext, we simulate the pipeline's execution on each group of records to determine the pipeline's predictions. The pipeline's decision rule classifies a record as a \"predicted positive\" if its normalized tuple is (ingredient = Metformin, strength = $500$ MG, dose form = Oral Tablet).\n\n1.  **Analysis of the $6$ Actual Positive Records (Metformin $500$ mg immediate-release oral tablets):**\n    -   The problem states that $1$ of these $6$ records has a retired NDC that fails the NDC-to-RxCUI crosswalk.\n    -   According to pipeline step (i), this record is dropped. It is an actual positive that is not predicted as positive by the pipeline. This constitutes a **False Negative ($\\text{FN}$)**. So, $\\text{FN} = 1$.\n    -   The remaining $5$ records have valid NDCs and pass step (i). They are the correct ingredient, strength, and dose form. They will pass all subsequent pipeline steps and match the decision rule. These are actual positives that are correctly predicted as positive. This constitutes a **True Positive ($\\text{TP}$)**. So, $\\text{TP} = 5$.\n\n2.  **Analysis of the $6$ Actual Negative Records:**\n    -   **$3$ records: Metformin $500$ mg extended-release oral tablets.**\n        -   These records are \"oral tablets\" with ingredient \"Metformin\" and strength \"$500$ MG\".\n        -   Pipeline step (v) states that the pipeline \"ignores release characteristics\". Therefore, the \"extended-release\" attribute is discarded during normalization.\n        -   The resulting normalized tuple will be (Metformin, $500$ MG, Oral Tablet), which matches the decision rule.\n        -   These records are actual negatives but are predicted as positive. This constitutes a **False Positive ($\\text{FP}$)**. So, these $3$ records contribute $3$ to the $\\text{FP}$ count.\n    -   **$2$ records: Metformin $1000$ mg immediate-release oral tablets.**\n        -   After normalization of strength (step iv), the strength will be \"$1000$ MG\".\n        -   This does not match the strength \"$500$ MG\" in the decision rule.\n        -   These records are predicted as negative. They are actual negatives predicted as negative, thus they are True Negatives ($\\text{TN}$).\n    -   **$1$ record: Metformin $500$ mg oral solution.**\n        -   Pipeline step (iii) requires the dose form to be \"tablet\".\n        -   This record's dose form is \"oral solution\" and will fail this filter.\n        -   This record is predicted as negative. It is an actual negative predicted as negative, thus it is a True Negative ($\\text{TN}$).\n\nSummary of counts:\n-   True Positives ($\\text{TP}$) = $5$\n-   False Positives ($\\text{FP}$) = $3$\n-   False Negatives ($\\text{FN}$) = $1$\n-   True Negatives ($\\text{TN}$) = $2 + 1 = 3$\n\nTotal records check: $\\text{TP} + \\text{FP} + \\text{FN} + \\text{TN} = 5 + 3 + 1 + 3 = 12$. The counts are consistent.\n\nNow, we compute Precision, Recall, and the F$_1$ score.\n$$ \\text{Precision} = \\frac{\\text{TP}}{\\text{TP} + \\text{FP}} = \\frac{5}{5 + 3} = \\frac{5}{8} $$\n$$ \\text{Recall} = \\frac{\\text{TP}}{\\text{TP} + \\text{FN}} = \\frac{5}{5 + 1} = \\frac{5}{6} $$\n$$ \\text{F}_1 = 2 \\times \\frac{\\text{Precision} \\times \\text{Recall}}{\\text{Precision} + \\text{Recall}} = 2 \\times \\frac{\\frac{5}{8} \\times \\frac{5}{6}}{\\frac{5}{8} + \\frac{5}{6}} $$\nTo simplify the denominator:\n$$ \\frac{5}{8} + \\frac{5}{6} = \\frac{5 \\times 3}{24} + \\frac{5 \\times 4}{24} = \\frac{15 + 20}{24} = \\frac{35}{24} $$\nSubstituting back into the F$_1$ formula:\n$$ \\text{F}_1 = 2 \\times \\frac{\\frac{25}{48}}{\\frac{35}{24}} = 2 \\times \\frac{25}{48} \\times \\frac{24}{35} = 2 \\times \\frac{25}{2 \\times 35} = \\frac{25}{35} = \\frac{5}{7} $$\nFinally, we convert the fraction to a decimal and round to four significant figures as required.\n$$ \\text{F}_1 = \\frac{5}{7} \\approx 0.7142857... $$\nRounding to four significant figures gives $0.7143$.", "answer": "$$\n\\boxed{0.7143}\n$$", "id": "4828018"}]}