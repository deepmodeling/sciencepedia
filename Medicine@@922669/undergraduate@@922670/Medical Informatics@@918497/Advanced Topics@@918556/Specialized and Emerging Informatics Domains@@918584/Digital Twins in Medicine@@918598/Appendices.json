{"hands_on_practices": [{"introduction": "The foundation of a reliable medical digital twin is a mathematical model that accurately represents the patient's physiology. In this first exercise, we will derive one of the most fundamental models in pharmacology—the one-compartment pharmacokinetic (PK) model—directly from the principle of mass conservation. This practice demonstrates how complex biological processes can be described with differential equations, providing a predictive tool for drug concentration over time [@problem_id:4836357].", "problem": "A hospital deploys a patient-specific computational digital twin to support dose individualization of a small-molecule therapy. For this patient, the twin assumes a one-compartment Pharmacokinetics (PK) model with an Intravenous (IV) bolus at time $t=0$ and first-order elimination. The twin represents the body as a single, instantaneously and homogeneously mixed compartment with volume of distribution $V$, drug amount in the body $A(t)$, plasma concentration $C(t)$ related by $C(t)=A(t)/V$, and uses the clinical definition of clearance $CL$ as the proportionality constant between concentration and elimination rate under well-mixed conditions.\n\nStarting only from (i) conservation of mass for the drug in the compartment, and (ii) the definition of clearance as elimination rate equal to $CL$ times concentration, derive a closed-form expression for $C(t)$ for $t \\ge 0$ after an IV bolus dose $D$ is administered at $t=0$.\n\nThen, the digital twin estimates $V$ and $CL$ for this patient as $V=40$ L and $CL=3.0$ L/h. A single IV bolus dose of $D=500$ mg is given at $t=0$. Using your derived expression, compute the model-predicted plasma concentration $C(t)$ at $t=2$ h. Round your answer to three significant figures. Express the final concentration in mg/L.", "solution": "The problem is valid as it is scientifically grounded in standard pharmacokinetic principles, well-posed with a complete and consistent set of definitions and data, and objectively stated.\n\nThe solution requires two steps. First, the derivation of a closed-form expression for the plasma concentration $C(t)$. Second, the calculation of a numerical value for the concentration at a specified time using the derived expression.\n\nThe derivation begins from the principle of conservation of mass for the drug within the single, well-mixed compartment. The rate of change of the amount of drug, $A(t)$, is the rate of administration minus the rate of elimination:\n$$\n\\frac{dA(t)}{dt} = \\text{Rate In} - \\text{Rate Out}\n$$\nFor an intravenous (IV) bolus dose given at time $t=0$, the administration rate is zero for any subsequent time $t>0$.\n$$\n\\text{Rate In} = 0 \\quad (\\text{for } t>0)\n$$\nThe problem defines the elimination rate as the product of clearance, $CL$, and plasma concentration, $C(t)$.\n$$\n\\text{Rate Out} = CL \\cdot C(t)\n$$\nCombining these gives the mass balance equation:\n$$\n\\frac{dA(t)}{dt} = -CL \\cdot C(t)\n$$\nThe relationship between drug amount $A(t)$, concentration $C(t)$, and volume of distribution $V$ is given as $C(t) = \\frac{A(t)}{V}$. Substituting this into the mass balance equation allows us to express it entirely in terms of $A(t)$:\n$$\n\\frac{dA(t)}{dt} = -CL \\cdot \\frac{A(t)}{V} = -\\left(\\frac{CL}{V}\\right)A(t)\n$$\nThis is a first-order, linear, homogeneous ordinary differential equation. The term $\\left(\\frac{CL}{V}\\right)$ represents the first-order elimination rate constant, which can be denoted as $k_e$. The equation to solve is thus $\\frac{dA(t)}{dt} = -k_e A(t)$.\n\nAn initial condition is required. At $t=0$, a bolus dose $D$ is administered and instantaneously distributes in the volume $V$. Thus, the initial amount of drug in the body is $A(0) = D$. The solution to this initial value problem is found by separation of variables:\n$$\n\\int_{A(0)}^{A(t)} \\frac{dA}{A} = \\int_{0}^{t} -k_e d\\tau \\implies \\ln\\left(\\frac{A(t)}{A(0)}\\right) = -k_e t\n$$\nSolving for $A(t)$ by exponentiating both sides yields:\n$$\nA(t) = A(0) \\exp(-k_e t)\n$$\nSubstituting $A(0)=D$ and $k_e = \\frac{CL}{V}$, we get the amount of drug over time:\n$$\nA(t) = D \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\nThe problem asks for the concentration profile $C(t)$. Using $C(t) = \\frac{A(t)}{V}$, we obtain the final closed-form expression:\n$$\nC(t) = \\frac{D}{V} \\exp\\left(-\\frac{CL}{V} t\\right)\n$$\nThis equation describes the plasma concentration at any time $t \\ge 0$.\n\nFor the second part of the problem, we compute the concentration at a specific time using the given parameters. The parameters are: dose $D=500$ mg, volume of distribution $V=40$ L, and clearance $CL=3.0$ L/h. We need to find the concentration $C(t)$ at time $t=2$ h.\n\nThe units of the parameters are consistent. The ratio $\\frac{D}{V}$ has units of mg/L. The exponent term must be dimensionless; the elimination rate constant $k_e = \\frac{CL}{V}$ has units of $\\frac{\\text{L/h}}{\\text{L}} = \\text{h}^{-1}$, which when multiplied by time $t$ in hours, results in a dimensionless quantity. The final concentration will be in mg/L.\n\nWe substitute the numerical values into the derived expression:\n$$\nC(2) = \\frac{500}{40} \\exp\\left(-\\frac{3.0}{40} \\times 2\\right)\n$$\nFirst, calculate the initial concentration $C(0) = \\frac{D}{V}$:\n$$\nC(0) = \\frac{500}{40} = 12.5\n$$\nNext, calculate the value of the exponent:\n$$\n-\\frac{CL}{V} t = -\\frac{3.0}{40} \\times 2 = -0.075 \\times 2 = -0.15\n$$\nNow, substitute these calculated parts back into the main equation:\n$$\nC(2) = 12.5 \\times \\exp(-0.15)\n$$\nEvaluating the exponential function:\n$$\n\\exp(-0.15) \\approx 0.860707976\n$$\nFinally, we compute the concentration at $t=2$ h:\n$$\nC(2) \\approx 12.5 \\times 0.860707976 \\approx 10.7588497\n$$\nThe problem specifies that the answer should be rounded to three significant figures. Rounding $10.7588497$ to three significant figures gives $10.8$.", "answer": "$$\\boxed{10.8}$$", "id": "4836357"}, {"introduction": "While a PK model describes drug concentration, a pharmacodynamic (PD) model is needed to predict the drug's effect. This practice explores the classic $E_{\\max}$ model and introduces sensitivity analysis, a powerful technique to understand how variations in patient-specific parameters influence clinically vital outputs like the therapeutic window [@problem_id:4836309]. By determining which parameters have the greatest impact, we can identify where precision is most critical for building a robust digital twin.", "problem": "A Digital Twin (DT) for an individual patient is used to personalize dosing by predicting the pharmacodynamic (PD) response to drug concentration based on the widely validated maximum effect model. The PD effect is assumed to follow the saturable relationship where the observed effect $E$ depends on the concentration $C$ according to an $E_{\\max}$ formulation. The DT is tasked with making therapeutic window (TW) decisions based on clinically set effect thresholds: a minimum clinically effective level $E_{\\mathrm{L}}$ and a maximum desired level $E_{\\mathrm{U}}$ (chosen below the toxicity threshold).\n\nStarting from the foundational PD principle of saturable receptor binding leading to a monotonically increasing, asymptotic effect versus concentration curve, model the PD effect via the maximum effect model with parameters maximum effect $E_{\\max}$ and half maximal effective concentration $\\mathrm{EC}_{50}$. Using this base, define the lower and upper concentration bounds $C_{\\mathrm{L}}$ and $C_{\\mathrm{U}}$ that achieve $E_{\\mathrm{L}}$ and $E_{\\mathrm{U}}$, respectively, and then define the log-scale TW width\n$$\nW \\equiv \\ln\\!\\left(\\frac{C_{\\mathrm{U}}}{C_{\\mathrm{L}}}\\right).\n$$\nDerive analytic expressions for the normalized (dimensionless) sensitivities of $W$ with respect to the parameters $E_{\\max}$ and $\\mathrm{EC}_{50}$, namely\n$$\nS_{E_{\\max}} \\equiv \\frac{E_{\\max}}{W}\\,\\frac{\\partial W}{\\partial E_{\\max}}, \\quad S_{\\mathrm{EC}_{50}} \\equiv \\frac{\\mathrm{EC}_{50}}{W}\\,\\frac{\\partial W}{\\partial \\mathrm{EC}_{50}}.\n$$\nFinally, evaluate these sensitivities at $E_{\\max} = 100$ effect units, $\\mathrm{EC}_{50} = 2$ mg$\\cdot$L$^{-1}$, $E_{\\mathrm{L}} = 30$ effect units, and $E_{\\mathrm{U}} = 80$ effect units. Report your final numerical values for $\\left(S_{E_{\\max}},\\, S_{\\mathrm{EC}_{50}}\\right)$ as a row matrix in the order $\\left(S_{E_{\\max}},\\, S_{\\mathrm{EC}_{50}}\\right)$, and round your answer to four significant figures. The sensitivities are unitless.", "solution": "The problem requires the derivation and evaluation of the normalized sensitivities of the therapeutic window width with respect to the pharmacodynamic parameters $E_{\\max}$ and $\\mathrm{EC}_{50}$. The problem is scientifically grounded in established principles of pharmacodynamics, is well-posed with sufficient and consistent information, and is formulated objectively, thus it is deemed a valid problem.\n\nThe first step is to formally state the mathematical relationship between the pharmacodynamic effect $E$ and the drug concentration $C$. The problem describes a \"maximum effect model\" characterized by a \"monotonically increasing, asymptotic effect versus concentration curve\" rooted in \"saturable receptor binding\". This corresponds to the standard Hill-Langmuir or Michaelis-Menten-type equation, commonly referred to as the $E_{\\max}$ model:\n$$\nE(C) = \\frac{E_{\\max} C}{\\mathrm{EC}_{50} + C}\n$$\nHere, $E_{\\max}$ is the maximum possible effect and $\\mathrm{EC}_{50}$ is the concentration at which $50\\%$ of the maximum effect is observed. For this model to be physically meaningful, we must have $C \\ge 0$, $E_{\\max} > 0$, and $\\mathrm{EC}_{50} > 0$. The effect $E$ will be in the range $[0, E_{\\max})$.\n\nThe therapeutic window is defined by effect thresholds $E_{\\mathrm{L}}$ and $E_{\\mathrm{U}}$, corresponding to concentrations $C_{\\mathrm{L}}$ and $C_{\\mathrm{U}}$, respectively. To find these concentrations, we must invert the $E_{\\max}$ model to express $C$ as a function of $E$.\n$$\nE(\\mathrm{EC}_{50} + C) = E_{\\max} C\n$$\n$$\nE \\cdot \\mathrm{EC}_{50} + E \\cdot C = E_{\\max} C\n$$\n$$\nE \\cdot \\mathrm{EC}_{50} = (E_{\\max} - E) C\n$$\nSolving for $C$, we obtain:\n$$\nC(E) = \\frac{E \\cdot \\mathrm{EC}_{50}}{E_{\\max} - E}\n$$\nThis expression is valid for any effect $E$ such that $0 \\le E < E_{\\max}$. The given numerical values $E_{\\mathrm{L}}=30$ and $E_{\\mathrm{U}}=80$ are both less than $E_{\\max}=100$, confirming the validity of this step.\n\nUsing this inverse relationship, we can define the lower and upper concentration bounds, $C_{\\mathrm{L}}$ and $C_{\\mathrm{U}}$:\n$$\nC_{\\mathrm{L}} = C(E_{\\mathrm{L}}) = \\frac{E_{\\mathrm{L}} \\cdot \\mathrm{EC}_{50}}{E_{\\max} - E_{\\mathrm{L}}}\n$$\n$$\nC_{\\mathrm{U}} = C(E_{\\mathrm{U}}) = \\frac{E_{\\mathrm{U}} \\cdot \\mathrm{EC}_{50}}{E_{\\max} - E_{\\mathrm{U}}}\n$$\nThe log-scale therapeutic window width $W$ is defined as $W \\equiv \\ln(C_{\\mathrm{U}} / C_{\\mathrm{L}})$. We first compute the ratio $C_{\\mathrm{U}} / C_{\\mathrm{L}}$:\n$$\n\\frac{C_{\\mathrm{U}}}{C_{\\mathrm{L}}} = \\frac{\\frac{E_{\\mathrm{U}} \\cdot \\mathrm{EC}_{50}}{E_{\\max} - E_{\\mathrm{U}}}}{\\frac{E_{\\mathrm{L}} \\cdot \\mathrm{EC}_{50}}{E_{\\max} - E_{\\mathrm{L}}}} = \\frac{E_{\\mathrm{U}}}{E_{\\mathrm{L}}} \\cdot \\frac{E_{\\max} - E_{\\mathrm{L}}}{E_{\\max} - E_{\\mathrm{U}}}\n$$\nAn important observation is that the parameter $\\mathrm{EC}_{50}$ cancels out from the ratio. This implies that the log-scale width $W$ is independent of $\\mathrm{EC}_{50}$. The expression for $W$ is therefore:\n$$\nW = \\ln\\left(\\frac{E_{\\mathrm{U}}}{E_{\\mathrm{L}}} \\cdot \\frac{E_{\\max} - E_{\\mathrm{L}}}{E_{\\max} - E_{\\mathrm{U}}}\\right)\n$$\nFor easier differentiation, we can expand the logarithm:\n$$\nW = \\ln(E_{\\mathrm{U}}) - \\ln(E_{\\mathrm{L}}) + \\ln(E_{\\max} - E_{\\mathrm{L}}) - \\ln(E_{\\max} - E_{\\mathrm{U}})\n$$\nNow, we compute the partial derivatives of $W$ with respect to $E_{\\max}$ and $\\mathrm{EC}_{50}$.\n\nFor the sensitivity with respect to $E_{\\max}$, we first find $\\frac{\\partial W}{\\partial E_{\\max}}$:\n$$\n\\frac{\\partial W}{\\partial E_{\\max}} = \\frac{\\partial}{\\partial E_{\\max}} \\left[ \\ln(E_{\\mathrm{U}}) - \\ln(E_{\\mathrm{L}}) + \\ln(E_{\\max} - E_{\\mathrm{L}}) - \\ln(E_{\\max} - E_{\\mathrm{U}}) \\right]\n$$\nSince $E_{\\mathrm{L}}$ and $E_{\\mathrm{U}}$ are constants with respect to $E_{\\max}$, the first two terms have zero derivative.\n$$\n\\frac{\\partial W}{\\partial E_{\\max}} = 0 - 0 + \\frac{1}{E_{\\max} - E_{\\mathrm{L}}} - \\frac{1}{E_{\\max} - E_{\\mathrm{U}}}\n$$\nCombining the fractions over a common denominator:\n$$\n\\frac{\\partial W}{\\partial E_{\\max}} = \\frac{(E_{\\max} - E_{\\mathrm{U}}) - (E_{\\max} - E_{\\mathrm{L}})}{(E_{\\max} - E_{\\mathrm{L}})(E_{\\max} - E_{\\mathrm{U}})} = \\frac{E_{\\mathrm{L}} - E_{\\mathrm{U}}}{(E_{\\max} - E_{\\mathrm{L}})(E_{\\max} - E_{\\mathrm{U}})}\n$$\nThe normalized sensitivity $S_{E_{\\max}}$ is then:\n$$\nS_{E_{\\max}} \\equiv \\frac{E_{\\max}}{W} \\frac{\\partial W}{\\partial E_{\\max}} = \\frac{E_{\\max}}{W} \\left( \\frac{E_{\\mathrm{L}} - E_{\\mathrm{U}}}{(E_{\\max} - E_{\\mathrm{L}})(E_{\\max} - E_{\\mathrm{U}})} \\right)\n$$\nFor the sensitivity with respect to $\\mathrm{EC}_{50}$, we note that $W$ does not depend on $\\mathrm{EC}_{50}$. Therefore:\n$$\n\\frac{\\partial W}{\\partial \\mathrm{EC}_{50}} = 0\n$$\nThis leads directly to the normalized sensitivity $S_{\\mathrm{EC}_{50}}$:\n$$\nS_{\\mathrm{EC}_{50}} \\equiv \\frac{\\mathrm{EC}_{50}}{W} \\frac{\\partial W}{\\partial \\mathrm{EC}_{50}} = \\frac{\\mathrm{EC}_{50}}{W} \\cdot 0 = 0\n$$\nThe result $S_{\\mathrm{EC}_{50}} = 0$ is a general property of the log-scale therapeutic window width for the $E_{\\max}$ model. It signifies that proportional changes in $\\mathrm{EC}_{50}$ do not affect the log-width of the therapeutic window, as $\\mathrm{EC}_{50}$ acts as a simple scaling factor on the concentration axis, and this scaling is removed by the ratio $C_{\\mathrm{U}}/C_{\\mathrm{L}}$.\n\nFinally, we evaluate the sensitivities using the given numerical values: $E_{\\max} = 100$, $E_{\\mathrm{L}} = 30$, and $E_{\\mathrm{U}} = 80$.\nFirst, calculate the value of $W$:\n$$\nW = \\ln\\left(\\frac{80}{30} \\cdot \\frac{100 - 30}{100 - 80}\\right) = \\ln\\left(\\frac{8}{3} \\cdot \\frac{70}{20}\\right) = \\ln\\left(\\frac{8}{3} \\cdot \\frac{7}{2}\\right) = \\ln\\left(\\frac{56}{6}\\right) = \\ln\\left(\\frac{28}{3}\\right)\n$$\nNext, we evaluate the partial derivative $\\frac{\\partial W}{\\partial E_{\\max}}$:\n$$\n\\frac{\\partial W}{\\partial E_{\\max}} = \\frac{30 - 80}{(100 - 30)(100 - 80)} = \\frac{-50}{(70)(20)} = \\frac{-50}{1400} = -\\frac{1}{28}\n$$\nNow, we can calculate $S_{E_{\\max}}$:\n$$\nS_{E_{\\max}} = \\frac{100}{W} \\left(-\\frac{1}{28}\\right) = \\frac{100}{\\ln(28/3)} \\left(-\\frac{1}{28}\\right) = -\\frac{100}{28 \\ln(28/3)} = -\\frac{25}{7 \\ln(28/3)}\n$$\nNumerically, $\\ln(28/3) \\approx \\ln(9.33333) \\approx 2.23356$.\n$$\nS_{E_{\\max}} \\approx -\\frac{25}{7 \\times 2.23356} \\approx -\\frac{25}{15.63492} \\approx -1.59892\n$$\nRounding to four significant figures, we get $S_{E_{\\max}} \\approx -1.599$.\nThe value for $S_{\\mathrm{EC}_{50}}$ is exactly $0$.\n\nThe final result is the pair $(S_{E_{\\max}}, S_{\\mathrm{EC}_{50}})$.\n$S_{E_{\\max}} \\approx -1.599$\n$S_{\\mathrm{EC}_{50}} = 0$\nThe negative sign for $S_{E_{\\max}}$ indicates that as $E_{\\max}$ increases, the log-width $W$ of the therapeutic window decreases, assuming $E_L$ and $E_U$ are held constant.", "answer": "$$\n\\boxed{\\begin{pmatrix} -1.599 & 0 \\end{pmatrix}}\n$$", "id": "4836309"}, {"introduction": "This final exercise synthesizes the concepts from the previous practices into a complete, albeit simplified, digital twin application. You will translate the PK models into a computational simulation to evaluate different dosing strategies against competing objectives: achieving therapeutic exposure while minimizing a toxicity surrogate [@problem_id:4836348]. This hands-on coding task challenges you to build a decision-support tool that searches for an optimal, personalized dosing regimen, embodying the core purpose of a medical digital twin.", "problem": "You are building a simplified patient-specific digital twin that couples Pharmacokinetics (PK) and Pharmacodynamics (PD) to design an intravenous bolus dosing regimen. The PK is modeled as a one-compartment system with first-order elimination, and the PD toxicity surrogate is the total time that the concentration exceeds a toxicity threshold. The goal is to choose a dosing regimen that achieves a target exposure band while minimizing toxicity, subject to dosing constraints, for multiple patient-specific digital twins.\n\nFundamental base and core definitions:\n- The drug amount in the central compartment, denoted by $A(t)$ in $\\mathrm{mg}$, follows the mass balance Ordinary Differential Equation (ODE): $$\\frac{dA}{dt} = -k \\, A(t),$$ where $k = \\frac{\\mathrm{CL}}{V}$ in $\\mathrm{h}^{-1}$ is the first-order elimination rate constant, $\\mathrm{CL}$ is clearance in $\\mathrm{L}/\\mathrm{h}$, and $V$ is volume of distribution in $\\mathrm{L}$. The concentration is $C(t) = \\frac{A(t)}{V}$ in $\\mathrm{mg}/\\mathrm{L}$.\n- Intravenous bolus dosing at time $t = t_d$ instantaneously increases the amount by $D$ in $\\mathrm{mg}$, so that $A(t_d^+) = A(t_d^-) + D$. Equivalently, $C(t_d^+) = C(t_d^-) + \\frac{D}{V}$.\n- Exposure is quantified by the area under the concentration-time curve: $$\\mathrm{AUC}_{[0,T]} = \\int_{0}^{T} C(t) \\, dt,$$ in $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$.\n- Toxicity surrogate is the time-above-toxicity-threshold: $$\\mathrm{TAT}_{[0,T]} = \\int_{0}^{T} \\mathbb{1}\\!\\left(C(t) > C_{\\mathrm{tox}}\\right) \\, dt,$$ in $\\mathrm{h}$, where $\\mathbb{1}(\\cdot)$ is the indicator function and $C_{\\mathrm{tox}}$ is the toxicity threshold in $\\mathrm{mg}/\\mathrm{L}$.\n\nDesign task:\n- Consider a finite dosing regimen defined by per-dose amount $D$ in $\\mathrm{mg}$, an inter-dose interval $\\tau$ in $\\mathrm{h}$, and a number of doses $N$ (a positive integer). Doses occur at times $t = 0, \\tau, 2\\tau, \\ldots, (N-1)\\tau$.\n- The simulation horizon is $$T_{\\mathrm{end}} = N \\tau + T_{\\mathrm{tail}},$$ where $T_{\\mathrm{tail}}$ in $\\mathrm{h}$ is specified per patient to capture the elimination tail after the last dose.\n- The primary objective is to minimize $\\mathrm{TAT}_{[0,T_{\\mathrm{end}}]}$ subject to the exposure (AUC) constraint $$\\mathrm{AUC}_{\\min} \\le \\mathrm{AUC}_{[0,T_{\\mathrm{end}}]} \\le \\mathrm{AUC}_{\\max}.$$ If multiple regimens satisfy the AUC constraint with identical $\\mathrm{TAT}$ (to numerical tolerance), choose the one with the smallest total administered dose $D_{\\mathrm{tot}} = N D$. If still tied, prefer the regimen with the largest $\\tau$.\n- If no regimen satisfies the AUC constraint, pick the regimen that minimizes the absolute deviation from the target band center, i.e., $$\\left| \\mathrm{AUC}_{[0,T_{\\mathrm{end}}]} - \\frac{\\mathrm{AUC}_{\\min} + \\mathrm{AUC}_{\\max}}{2} \\right|,$$ and use $\\mathrm{TAT}$ and then $D_{\\mathrm{tot}}$ and then $\\tau$ as tie-breakers in that order.\n- Dosing constraints: maximum daily dosing rate constraint $$D \\cdot \\frac{24}{\\tau} \\le D_{\\mathrm{daily, max}},$$ in $\\mathrm{mg}/\\mathrm{day}$, in addition to explicit feasible sets for $D$, $\\tau$, and $N$ given below.\n\nNumerical simulation requirement:\n- Use a fixed-step forward simulation to approximate $C(t)$, $\\mathrm{AUC}$, and $\\mathrm{TAT}$ over $[0, T_{\\mathrm{end}}]$. Choose a fixed time step $\\Delta t$ in $\\mathrm{h}$ and update by the exact decay over a step: if no dose occurs within the step, $C(t + \\Delta t) = C(t) \\exp(-k \\Delta t)$. Apply bolus doses at step boundaries when $t$ matches a scheduled dosing time. Use the rectangle rule for numerical integration of $\\mathrm{AUC}$ and $\\mathrm{TAT}$ over each step.\n\nTest suite:\nImplement your program to solve the optimization problem for the following four patient-specific digital twins. For each case, all units must be interpreted exactly as specified, and your program must compute and return the optimized regimen and associated metrics.\n\n- Case $1$:\n  - $\\mathrm{CL} = 5 \\ \\mathrm{L}/\\mathrm{h}$, $V = 50 \\ \\mathrm{L}$, $C_{\\mathrm{tox}} = 8 \\ \\mathrm{mg}/\\mathrm{L}$.\n  - Allowed per-dose amounts $D \\in \\{100, 200, 300, 400, 500\\}$ in $\\mathrm{mg}$.\n  - Allowed inter-dose intervals $\\tau \\in \\{12, 24\\}$ in $\\mathrm{h}$.\n  - Allowed number of doses $N \\in \\{2, 3, 4\\}$.\n  - Daily dosing limit $D_{\\mathrm{daily, max}} = 800$ in $\\mathrm{mg}/\\mathrm{day}$.\n  - Exposure target band: $\\mathrm{AUC}_{\\min} = 60$, $\\mathrm{AUC}_{\\max} = 80$ in $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$.\n  - Tail time $T_{\\mathrm{tail}} = 48$ in $\\mathrm{h}$.\n- Case $2$:\n  - $\\mathrm{CL} = 12 \\ \\mathrm{L}/\\mathrm{h}$, $V = 40 \\ \\mathrm{L}$, $C_{\\mathrm{tox}} = 7 \\ \\mathrm{mg}/\\mathrm{L}$.\n  - Allowed per-dose amounts $D \\in \\{100, 200, 300, 400, 500\\}$ in $\\mathrm{mg}$.\n  - Allowed inter-dose intervals $\\tau \\in \\{8, 12\\}$ in $\\mathrm{h}$.\n  - Allowed number of doses $N \\in \\{3, 4\\}$.\n  - Daily dosing limit $D_{\\mathrm{daily, max}} = 1000$ in $\\mathrm{mg}/\\mathrm{day}$.\n  - Exposure target band: $\\mathrm{AUC}_{\\min} = 80$, $\\mathrm{AUC}_{\\max} = 100$ in $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$.\n  - Tail time $T_{\\mathrm{tail}} = 48$ in $\\mathrm{h}$.\n- Case $3$:\n  - $\\mathrm{CL} = 6 \\ \\mathrm{L}/\\mathrm{h}$, $V = 20 \\ \\mathrm{L}$, $C_{\\mathrm{tox}} = 9 \\ \\mathrm{mg}/\\mathrm{L}$.\n  - Allowed per-dose amounts $D \\in \\{100, 200, 300, 400, 500\\}$ in $\\mathrm{mg}$.\n  - Allowed inter-dose intervals $\\tau \\in \\{8, 12, 24\\}$ in $\\mathrm{h}$.\n  - Allowed number of doses $N \\in \\{2, 3, 4\\}$.\n  - Daily dosing limit $D_{\\mathrm{daily, max}} = 800$ in $\\mathrm{mg}/\\mathrm{day}$.\n  - Exposure target band: $\\mathrm{AUC}_{\\min} = 50$, $\\mathrm{AUC}_{\\max} = 60$ in $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$.\n  - Tail time $T_{\\mathrm{tail}} = 48$ in $\\mathrm{h}$.\n- Case $4$:\n  - $\\mathrm{CL} = 2 \\ \\mathrm{L}/\\mathrm{h}$, $V = 60 \\ \\mathrm{L}$, $C_{\\mathrm{tox}} = 6 \\ \\mathrm{mg}/\\mathrm{L}$.\n  - Allowed per-dose amounts $D \\in \\{100, 200, 300, 400, 500\\}$ in $\\mathrm{mg}$.\n  - Allowed inter-dose intervals $\\tau \\in \\{24\\}$ in $\\mathrm{h}$.\n  - Allowed number of doses $N \\in \\{1, 2\\}$.\n  - Daily dosing limit $D_{\\mathrm{daily, max}} = 400$ in $\\mathrm{mg}/\\mathrm{day}$.\n  - Exposure target band: $\\mathrm{AUC}_{\\min} = 50$, $\\mathrm{AUC}_{\\max} = 60$ in $\\mathrm{mg}\\cdot\\mathrm{h}/\\mathrm{L}$.\n  - Tail time $T_{\\mathrm{tail}} = 72$ in $\\mathrm{h}$.\n\nImplementation details:\n- Use a fixed time step $\\Delta t = 0.05$ in $\\mathrm{h}$ for all cases.\n- For each candidate regimen $(D, \\tau, N)$ that satisfies the daily dosing limit, simulate $C(t)$ over $[0, T_{\\mathrm{end}}]$, calculate $\\mathrm{AUC}$ and $\\mathrm{TAT}$, and select the optimal regimen according to the stated objective and tie-breakers.\n- Express all final concentrations in $\\mathrm{mg}/\\mathrm{L}$, times in $\\mathrm{h}$, and doses in $\\mathrm{mg}$.\n- Your program should produce a single line of output containing the results for all four cases as a comma-separated list enclosed in square brackets, where each case is reported as a list of the form $[D, \\tau, N, \\mathrm{AUC}, \\mathrm{TAT}]$. Round $\\mathrm{AUC}$ and $\\mathrm{TAT}$ to three decimal places. For example, a valid output line might look like: $[[200,24,2,75.123,1.500],[\\ldots],\\ldots]$.", "solution": "The user-provided problem is a well-posed optimization task in the domain of clinical pharmacokinetics and pharmacodynamics (PK/PD). It is scientifically grounded in established one-compartment PK modeling principles and presents a clear, objective, and solvable problem. All necessary parameters and constraints are provided, making the problem self-contained and free of ambiguity. The task is to find an optimal intravenous bolus dosing regimen by minimizing a toxicity metric while satisfying an exposure target, searching over a finite set of possible regimens.\n\nThe solution methodology involves an exhaustive search over the discrete parameter space of possible dosing regimens, defined by the per-dose amount $D$, the inter-dose interval $\\tau$, and the number of doses $N$. For each patient-specific case, we iterate through all combinations of these three parameters.\n\nFirst, each potential regimen $(D, \\tau, N)$ is validated against the maximum daily dosing rate constraint:\n$$D \\cdot \\frac{24}{\\tau} \\le D_{\\mathrm{daily, max}}$$\nRegimens that violate this constraint are discarded.\n\nFor each valid regimen, a numerical simulation is performed to determine the resulting pharmacokinetic profile and associated metrics. The simulation models the drug concentration in a single compartment, $C(t)$, over the time horizon $[0, T_{\\mathrm{end}}]$, where $T_{\\mathrm{end}} = N \\tau + T_{\\mathrm{tail}}$. The simulation proceeds in discrete time steps of size $\\Delta t = 0.05 \\ \\mathrm{h}$.\n\nThe concentration dynamics are governed by the following rules:\n1.  **First-Order Elimination**: In the absence of a dose, the concentration decays exponentially. The concentration at the end of a time step, $C(t+\\Delta t)$, is related to the concentration at the start, $C(t)$, by:\n    $$C(t + \\Delta t) = C(t) \\exp(-k \\Delta t)$$\n    where $k = \\mathrm{CL}/V$ is the elimination rate constant.\n2.  **Bolus Dosing**: At scheduled dosing times $t_d = 0, \\tau, 2\\tau, \\ldots, (N-1)\\tau$, the concentration is instantaneously increased:\n    $$C(t_d^+) = C(t_d^-) + \\frac{D}{V}$$\n    where $C(t_d^-)$ is the concentration just before the dose and $C(t_d^+)$ is the concentration just after.\n\nDuring the simulation, two key metrics are integrated using the left-rectangle rule:\n1.  **Area Under the Curve (Exposure)**:\n    $$\\mathrm{AUC}_{[0,T_{\\mathrm{end}}]} = \\sum_{i} C(t_i) \\Delta t$$\n2.  **Time Above Toxicity Threshold (Toxicity Surrogate)**:\n    $$\\mathrm{TAT}_{[0,T_{\\mathrm{end}}]} = \\sum_{i} \\mathbb{1}(C(t_i) > C_{\\mathrm{tox}}) \\Delta t$$\n    where $\\mathbb{1}(\\cdot)$ is the indicator function.\n\nAfter simulating all valid regimens for a given patient, the results are collected. The optimal regimen is selected based on a two-tiered objective function:\n\n1.  **Primary Objective**: If there are regimens whose calculated $\\mathrm{AUC}_{[0,T_{\\mathrm{end}}]}$ falls within the target band $[\\mathrm{AUC}_{\\min}, \\mathrm{AUC}_{\\max}]$, the selection is made from this subset. The goal is to find the regimen that minimizes $\\mathrm{TAT}_{[0,T_{\\mathrm{end}}]}}$. Ties are broken by selecting the regimen with the smallest total dose, $D_{\\mathrm{tot}} = N D$, and then by the largest inter-dose interval $\\tau$. This implies sorting the valid regimens by the tuple $(\\mathrm{TAT}, D_{\\mathrm{tot}}, -\\tau)$.\n\n2.  **Secondary Objective**: If no regimen satisfies the $\\mathrm{AUC}$ target, the selection is made from all simulated regimens. The goal is to find the regimen that minimizes the absolute deviation of its $\\mathrm{AUC}$ from the center of the target band, i.e., minimizes $|\\mathrm{AUC}_{[0,T_{\\mathrm{end}}]} - (\\mathrm{AUC}_{\\min} + \\mathrm{AUC}_{\\max})/2|$. Ties are resolved sequentially by minimizing $\\mathrm{TAT}$, then minimizing $D_{\\mathrm{tot}}$, and finally by maximizing $\\tau$. This implies sorting by the tuple $(\\text{deviation}, \\mathrm{TAT}, D_{\\mathrm{tot}}, -\\tau)$.\n\nThis entire procedure is independently applied to each of the four patient-specific cases provided. The final output is a list containing the optimal regimen parameters $(D, \\tau, N)$ and the corresponding calculated metrics $(\\mathrm{AUC}, \\mathrm{TAT})$ for each case, with the metrics rounded to three decimal places.", "answer": "[[400, 24, 2, 79.907, 0.0], [400, 12, 3, 91.24, 0.0], [200, 24, 2, 53.271, 0.0], [200, 24, 1, 57.551, 0.0]]", "id": "4836348"}]}