{"hands_on_practices": [{"introduction": "The Laplace mechanism is a cornerstone of differential privacy, providing a robust method for protecting numerical queries. Its successful implementation hinges on correctly calibrating the amount of random noise to add, which is determined by two factors: the query's global sensitivity and the chosen privacy parameter, $\\varepsilon$. This foundational exercise walks you through the process of calculating sensitivity from first principles for a common scenario in health data—an aggregate sum with clipping—and then using it to determine the appropriate noise scale for the Laplace mechanism [@problem_id:4835475].", "problem": "A research hospital intends to release an aggregate quality metric derived from its Electronic Health Record (EHR) system: the sum of adult patients’ serum creatinine measurements recorded in a one-month period. For each patient $i$, suppose there are $m_i$ draws with measured values $x_{i1}, x_{i2}, \\dots, x_{im_i}$ in $\\text{mg/dL}$. The patient’s raw total is defined as $t_i = \\sum_{j=1}^{m_i} x_{ij}$. To enforce privacy and robustness, the hospital clips each patient’s contribution at a fixed cap $C$ in $\\text{mg/dL}$, forming $s_i = \\min(t_i, C)$. The released statistic is the sum query\n$$\nf(D) = \\sum_{i=1}^{n} s_i,\n$$\nwhere $D$ is the dataset of $n$ patients.\n\nThe hospital will use pure Differential Privacy (DP) with privacy parameter $\\varepsilon$ under the add/remove neighboring relation: two datasets $D$ and $D'$ are neighbors if one can be obtained from the other by adding or removing a single patient’s entire EHR record. The randomized mechanism adds noise to the query output drawn from a Laplace distribution centered at zero with a scale parameter $b$ (in the same unit as the query, $\\text{mg/dL}$).\n\nUsing only first principles—the formal definition of Differential Privacy, the concept of global $\\ell_1$ sensitivity for a query under the specified neighboring relation, and the probability density function of the Laplace distribution—derive the global $\\ell_1$ sensitivity of $f$ and then determine the scale parameter $b$ required to satisfy $\\varepsilon$-DP for this sum query. Take $C = 10\\,\\text{mg/dL}$ and $\\varepsilon = 0.8$. Round your final value for $b$ to four significant figures, and express it in $\\text{mg/dL}$. Report only the value of $b$.", "solution": "We begin from the formal definition of Differential Privacy (DP). A randomized mechanism $\\mathcal{M}$ satisfies $\\varepsilon$-DP under the add/remove neighboring relation if, for all neighboring datasets $D$ and $D'$ and for all measurable subsets $S$ of outputs,\n$$\n\\Pr[\\mathcal{M}(D) \\in S] \\leq \\exp(\\varepsilon)\\,\\Pr[\\mathcal{M}(D') \\in S].\n$$\n\nThe mechanism of interest is the Laplace mechanism applied to the sum query $f(D)$, namely\n$$\n\\mathcal{M}(D) = f(D) + Y,\n$$\nwhere $Y$ is a random variable distributed according to the Laplace distribution with mean $0$ and scale parameter $b$. The probability density function (pdf) of $Y$ is\n$$\np_{Y}(y) = \\frac{1}{2b}\\,\\exp\\!\\left(-\\frac{|y|}{b}\\right).\n$$\n\nTo use the Laplace mechanism, we need the global $\\ell_1$ sensitivity of the query $f$ under the specified neighboring relation. The global $\\ell_1$ sensitivity $\\Delta_{1}(f)$ is defined as\n$$\n\\Delta_{1}(f) = \\max_{D \\sim D'} |f(D) - f(D')|,\n$$\nwhere $D \\sim D'$ denotes that $D$ and $D'$ are neighboring datasets (differing by the add/remove of one patient’s record).\n\nGiven $f(D) = \\sum_{i=1}^{n} s_i$ with $s_i = \\min(t_i, C)$ and $t_i = \\sum_{j=1}^{m_i} x_{ij}$, under add/remove adjacency, $D'$ differs from $D$ by the presence or absence of a single patient $p$. Then\n$$\nf(D) - f(D') = \n\\begin{cases}\ns_p & \\text{if } D' \\text{ is } D \\text{ with patient } p \\text{ removed},\\\\\n- s_p & \\text{if } D \\text{ is } D' \\text{ with patient } p \\text{ removed}.\n\\end{cases}\n$$\nTherefore,\n$$\n|f(D) - f(D')| = |s_p|.\n$$\nBy construction, each $s_p$ is clipped: $s_p = \\min(t_p, C)$, implying $0 \\leq s_p \\leq C$. Hence,\n$$\n|f(D) - f(D')| \\leq C,\n$$\nand since there exist datasets where a patient attains $s_p = C$, the maximum possible change is achieved at $C$. Thus,\n$$\n\\Delta_{1}(f) = C.\n$$\n\nNext, we derive the scale parameter $b$ required for the Laplace mechanism to satisfy $\\varepsilon$-DP. Consider the ratio of output densities at a fixed value $z \\in \\mathbb{R}$:\n$$\n\\frac{p_{\\mathcal{M}(D)}(z)}{p_{\\mathcal{M}(D')}(z)} \n= \n\\frac{\\frac{1}{2b}\\exp\\!\\left(-\\frac{|z - f(D)|}{b}\\right)}{\\frac{1}{2b}\\exp\\!\\left(-\\frac{|z - f(D')|}{b}\\right)}\n=\n\\exp\\!\\left(\\frac{|z - f(D')| - |z - f(D)|}{b}\\right).\n$$\nUsing the reverse triangle inequality, $||a|-|b|| \\leq |a-b|$, we obtain\n$$\n\\left||z - f(D')| - |z - f(D)|\\right| \\leq |f(D) - f(D')|.\n$$\nTherefore, for all $z$,\n$$\n\\frac{p_{\\mathcal{M}(D)}(z)}{p_{\\mathcal{M}(D')}(z)} \n\\leq \\exp\\!\\left(\\frac{|f(D) - f(D')|}{b}\\right)\n\\leq \\exp\\!\\left(\\frac{\\Delta_{1}(f)}{b}\\right).\n$$\nTo ensure the DP condition $\\Pr[\\mathcal{M}(D) \\in S] \\leq \\exp(\\varepsilon)\\,\\Pr[\\mathcal{M}(D') \\in S]$ for all measurable $S$, it suffices to require\n$$\n\\exp\\!\\left(\\frac{\\Delta_{1}(f)}{b}\\right) \\leq \\exp(\\varepsilon),\n$$\nwhich is equivalent to\n$$\n\\frac{\\Delta_{1}(f)}{b} \\leq \\varepsilon\n\\quad\\Rightarrow\\quad\nb \\geq \\frac{\\Delta_{1}(f)}{\\varepsilon}.\n$$\n\nUsing the derived sensitivity $\\Delta_{1}(f) = C$ and the given parameters $C = 10\\,\\text{mg/dL}$ and $\\varepsilon = 0.8$, the minimal scale is\n$$\nb = \\frac{C}{\\varepsilon} = \\frac{10}{0.8} = 12.5\\,\\text{mg/dL}.\n$$\nRounded to four significant figures (and expressed in $\\text{mg/dL}$ as required), this is\n$$\nb = 12.50\\,\\text{mg/dL}.\n$$\n\nWe were asked to report only the value of $b$, rounded to four significant figures.", "answer": "$$\\boxed{12.50}$$", "id": "4835475"}, {"introduction": "In practice, a health data system rarely answers just a single question; instead, it may power an entire surveillance dashboard or support a series of research queries. Each time a statistic is released, it consumes a part of the overall privacy budget. This practice [@problem_id:4835438] explores the vital concept of composition, which provides a formal rule for how privacy loss accumulates over multiple releases, enabling us to manage a finite privacy budget and determine how many queries can be safely answered.", "problem": "A regional health agency operates a public surveillance dashboard that releases a fixed set of aggregate statistics computed from a protected patient database each day. Each released statistic is a counting query (for example, the number of new influenza admissions in the past $1$ day), which has global sensitivity $\\Delta f = 1$. To protect individuals, the agency uses the Laplace mechanism for each statistic, calibrated to a per-release privacy parameter $\\epsilon_{0}$, meaning the noise scale is $b = \\Delta f / \\epsilon_{0}$.\n\nStarting from the definition of Differential Privacy (DP): a randomized mechanism $M$ is $\\epsilon$-Differentially Private (DP) if for any pair of neighboring datasets $D$ and $D'$ and any measurable set $S$ of outputs, $\\Pr[M(D) \\in S] \\le \\exp(\\epsilon)\\,\\Pr[M(D') \\in S]$, derive how the cumulative privacy parameter $\\epsilon_{\\text{tot}}$ grows under simple composition when $k$ statistics are released sequentially and possibly adaptively from the same dataset (i.e., each release may depend on previous releases). Then, apply your derivation to determine the maximum number $k$ of distinct statistics that can be released per day if the per-release privacy parameter is $\\epsilon_{0} = 0.05$ and the daily privacy budget is $\\epsilon_{\\text{budget}} = 1.2$.\n\nReport only the maximum integer $k$ as your final answer. No units are required. If rounding were necessary, round to the nearest integer; however, if the value is exactly an integer, report that integer exactly.", "solution": "Let there be a sequence of $k$ randomized mechanisms, $M_1, M_2, \\dots, M_k$. Each mechanism $M_i$ is assumed to be $\\epsilon_0$-differentially private. These mechanisms are applied sequentially to the same database $D$. The composition can be adaptive, meaning that the choice of mechanism $M_i$ (for $i > 1$) can depend on the outputs of the previous mechanisms $M_1, \\dots, M_{i-1}$. Let the sequence of outputs be $o_1, o_2, \\dots, o_k$, where $o_i$ is the output of $M_i$. The composite mechanism, $M_{\\text{comp}}(D)$, produces the tuple of outputs $O = (o_1, o_2, \\dots, o_k)$. We want to determine the total privacy parameter, $\\epsilon_{\\text{tot}}$, for $M_{\\text{comp}}$.\n\nLet $D$ and $D'$ be two neighboring datasets. Let $p(O|D)$ and $p(O|D')$ be the probability density (or mass) functions for the output tuple $O$. Using the chain rule of probability, we can write the joint probability density as a product of conditional probabilities:\n$$p(O|D) = p(o_1|D) \\cdot p(o_2|D, o_1) \\cdots p(o_k|D, o_1, \\dots, o_{k-1})$$\nAnd similarly for dataset $D'$:\n$$p(O|D') = p(o_1|D') \\cdot p(o_2|D', o_1) \\cdots p(o_k|D', o_1, \\dots, o_{k-1})$$\n\nThe ratio of these two probabilities is:\n$$\\frac{p(O|D)}{p(O|D')} = \\prod_{i=1}^{k} \\frac{p(o_i|D, o_1, \\dots, o_{i-1})}{p(o_i|D', o_1, \\dots, o_{i-1})}$$\n\nFor each mechanism $M_i$ in the sequence, its $\\epsilon_0$-DP guarantee holds conditional on the outputs of the previous mechanisms $o_1, \\dots, o_{i-1}$, as this prior information is independent of the private database. Thus:\n$$\\frac{p(o_i|D, o_1, \\dots, o_{i-1})}{p(o_i|D', o_1, \\dots, o_{i-1})} \\le \\exp(\\epsilon_0)$$\nSubstituting these individual bounds back into the product:\n$$\\frac{p(O|D)}{p(O|D')} \\le \\prod_{i=1}^{k} \\exp(\\epsilon_0) = \\left(\\exp(\\epsilon_0)\\right)^k = \\exp(k \\cdot \\epsilon_0)$$\nThis demonstrates that the composite mechanism is $(k \\cdot \\epsilon_0)$-differentially private. The cumulative privacy parameter is $\\epsilon_{\\text{tot}} = k \\cdot \\epsilon_0$. This is the Basic Composition Theorem.\n\nThe problem states that the total daily privacy budget is $\\epsilon_{\\text{budget}} = 1.2$. The cumulative privacy loss must be less than or equal to this budget:\n$$k \\cdot \\epsilon_0 \\le \\epsilon_{\\text{budget}}$$\nGiven the per-release privacy parameter $\\epsilon_0 = 0.05$, we find the maximum integer $k$:\n$$k \\le \\frac{\\epsilon_{\\text{budget}}}{\\epsilon_0}$$\n$$k \\le \\frac{1.2}{0.05} = \\frac{120}{5} = 24$$\nThe maximum number of statistics that can be released per day is $24$.", "answer": "$$\\boxed{24}$$", "id": "4835438"}, {"introduction": "Releasing differentially private data is only the first step; drawing valid scientific conclusions from it is the ultimate goal. Simply applying classical statistical tests to noise-infused data as if it were the true data can lead to misleading results and a higher rate of false discoveries. This exercise [@problem_id:4835490] illustrates this critical pitfall and guides you through deriving a corrected statistical test that properly accounts for the additional variance introduced by the privacy mechanism, ensuring the integrity of your hypothesis testing.", "problem": "A hospital is evaluating whether the proportion of patients with abnormally high low-density lipoprotein cholesterol (LDL-C) in the current quarter exceeds a previously validated baseline proportion. To protect patient privacy, the hospital adheres to Differential Privacy (DP) by releasing only a sanitized count of elevated LDL-C cases obtained by adding independent Laplace noise to the true count. The hospital wants to test the null hypothesis that the true proportion of elevated LDL-C remains at the baseline value.\n\nAssume the following scientifically plausible setup:\n- The true number of elevated LDL-C cases among $n$ patients is a random variable $C$ modeled as $C \\sim \\mathrm{Binomial}(n,p)$.\n- Under the null hypothesis, $H_{0}: p = p_{0}$, where $p_{0}$ is the baseline proportion.\n- The released differentially private count is $\\tilde{C} = C + \\eta$, where $\\eta \\sim \\mathrm{Laplace}(0,b)$ is independent of $C$. Here $b$ is the Laplace scale parameter chosen by the curator to satisfy a fixed privacy budget; you may take as given that the Laplace distribution has zero mean and variance $2b^{2}$.\n- The classical large-sample $z$-test for a binomial proportion uses the normal approximation of $C$ under $H_{0}$.\n\nExplain, using first principles from the binomial model and properties of independent additive noise, why naively applying a standard $z$-test to the released $\\tilde{C}$ while ignoring the DP noise yields a misestimated $p$-value. Then, derive a corrected large-sample test statistic that incorporates the DP-induced noise variance into the null variance. Finally, compute the corrected test statistic for the concrete release:\n- $n = 800$ patients,\n- $p_{0} = 0.12$,\n- $b = 5$,\n- released count $\\tilde{C} = 118.5$,\n\nand report the value of the corrected test statistic. Round your numerical answer to four significant figures. No units are required in the final answer.", "solution": "The problem requires an explanation of the flaw in a naive hypothesis test on differentially private data, the derivation of a corrected test statistic, and the computation of this statistic for a given set of parameters. The validation indicates the problem is scientifically sound and well-posed.\n\nFirst, let us establish the framework for a classical large-sample $z$-test for a proportion. Under the null hypothesis $H_{0}: p = p_{0}$, the true count of cases $C$ follows a binomial distribution, $C \\sim \\mathrm{Binomial}(n, p_{0})$. For large $n$, this distribution is well-approximated by a normal distribution, $C \\approx \\mathrm{Normal}(\\mu_{C}, \\sigma_{C}^{2})$, where the mean is $\\mu_{C} = \\mathrm{E}[C] = np_{0}$ and the variance is $\\sigma_{C}^{2} = \\mathrm{Var}(C) = np_{0}(1-p_{0})$. The standard test statistic is constructed by standardizing the observed count $C$:\n$$ Z = \\frac{C - \\mathrm{E}[C]}{\\sqrt{\\mathrm{Var}(C)}} = \\frac{C - np_{0}}{\\sqrt{np_{0}(1-p_{0})}} $$\nThis is equivalent to the more common form using the sample proportion $\\hat{p} = C/n$:\n$$ Z = \\frac{\\hat{p} - p_{0}}{\\sqrt{p_{0}(1-p_{0})/n}} $$\n\nNow, consider the naive application of this test to the released differentially private count, $\\tilde{C}$. The naive approach would substitute $\\tilde{C}$ for $C$ in the standard formula, or equivalently, use the noisy proportion $\\tilde{p} = \\tilde{C}/n$ in place of $\\hat{p}$. This yields a naive test statistic:\n$$ Z_{\\text{naive}} = \\frac{\\tilde{C} - np_{0}}{\\sqrt{np_{0}(1-p_{0})}} $$\nThe flaw in this construction lies in the mismatch between the random variable in the numerator and the variance used for standardization in the denominator. The numerator, $\\tilde{C} - np_{0}$, contains variability from two independent sources: the original sampling process (variability of $C$) and the added Laplace noise (variability of $\\eta$). However, the denominator, $\\sqrt{np_{0}(1-p_{0})}$, only accounts for the variance of the true count $C$.\n\nTo formalize this, let's analyze the variance of the noisy count $\\tilde{C} = C + \\eta$. Since $C$ and $\\eta$ are specified as independent, the variance of their sum is the sum of their variances:\n$$ \\mathrm{Var}(\\tilde{C}) = \\mathrm{Var}(C + \\eta) = \\mathrm{Var}(C) + \\mathrm{Var}(\\eta) $$\nUnder the null hypothesis $H_{0}$, we have $\\mathrm{Var}(C) = np_{0}(1-p_{0})$. The problem states that the noise $\\eta \\sim \\mathrm{Laplace}(0, b)$ has variance $\\mathrm{Var}(\\eta) = 2b^{2}$. Therefore, the true variance of the noisy count under $H_{0}$ is:\n$$ \\mathrm{Var}_{H_{0}}(\\tilde{C}) = np_{0}(1-p_{0}) + 2b^{2} $$\nThe naive test statistic incorrectly uses $\\sqrt{np_{0}(1-p_{0})}$ as the standard error, which is strictly smaller than the true standard error, $\\sqrt{np_{0}(1-p_{0}) + 2b^{2}}$. Using an underestimated variance in the denominator artificially inflates the magnitude of the test statistic $|Z_{\\text{naive}}|$. This leads to an overestimation of statistical significance, a smaller calculated $p$-value, and an increased probability of a Type I error (i.e., falsely rejecting the null hypothesis when it is true).\n\nTo derive a corrected large-sample test statistic, we must standardize the observed value $\\tilde{C}$ using its correct mean and standard deviation under the null hypothesis. The expected value of $\\tilde{C}$ under $H_{0}$ is:\n$$ \\mathrm{E}_{H_{0}}[\\tilde{C}] = \\mathrm{E}[C + \\eta] = \\mathrm{E}[C] + \\mathrm{E}[\\eta] = np_{0} + 0 = np_{0} $$\nThe variance of $\\tilde{C}$ under $H_{0}$, as derived above, is $\\mathrm{Var}_{H_{0}}(\\tilde{C}) = np_{0}(1-p_{0}) + 2b^{2}$. For a large-sample test, we approximate the sampling distribution of $\\tilde{C}$ as a normal distribution with this mean and variance. The corrected test statistic, $Z_{\\text{corr}}$, is therefore:\n$$ Z_{\\text{corr}} = \\frac{\\tilde{C} - \\mathrm{E}_{H_{0}}[\\tilde{C}]}{\\sqrt{\\mathrm{Var}_{H_{0}}(\\tilde{C})}} = \\frac{\\tilde{C} - np_{0}}{\\sqrt{np_{0}(1-p_{0}) + 2b^{2}}} $$\nThis statistic properly accounts for both sources of randomness: the binomial sampling and the additive Laplace noise.\n\nFinally, we compute the value of the corrected test statistic using the provided data: $n = 800$, $p_{0} = 0.12$, $b = 5$, and the observed released count $\\tilde{C} = 118.5$.\n\nFirst, we calculate the expected count under the null hypothesis:\n$$ \\mathrm{E}_{H_{0}}[\\tilde{C}] = np_{0} = 800 \\times 0.12 = 96 $$\nNext, we calculate the two components of the variance:\nThe variance from the binomial process is:\n$$ \\sigma_{C}^{2} = np_{0}(1-p_{0}) = 800 \\times 0.12 \\times (1 - 0.12) = 96 \\times 0.88 = 84.48 $$\nThe variance from the Laplace noise is:\n$$ \\sigma_{\\eta}^{2} = 2b^{2} = 2 \\times 5^{2} = 2 \\times 25 = 50 $$\nThe total variance under the null hypothesis is the sum of these two components:\n$$ \\mathrm{Var}_{H_{0}}(\\tilde{C}) = \\sigma_{C}^{2} + \\sigma_{\\eta}^{2} = 84.48 + 50 = 134.48 $$\nThe numerator of the test statistic is the difference between the observed and expected counts:\n$$ \\tilde{C} - np_{0} = 118.5 - 96 = 22.5 $$\nNow we can compute the corrected test statistic:\n$$ Z_{\\text{corr}} = \\frac{22.5}{\\sqrt{134.48}} \\approx \\frac{22.5}{11.596551} \\approx 1.939912 $$\nRounding the result to four significant figures gives $1.940$.", "answer": "$$\\boxed{1.940}$$", "id": "4835490"}]}