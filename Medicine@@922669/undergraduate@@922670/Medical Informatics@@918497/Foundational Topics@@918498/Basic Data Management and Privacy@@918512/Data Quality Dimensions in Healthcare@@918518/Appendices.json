{"hands_on_practices": [{"introduction": "Before performing complex analyses, it is crucial to ensure that healthcare data conforms to fundamental logical rules. This practice addresses the dimensions of temporal plausibility and consistency by focusing on inpatient timelines from Electronic Health Records (EHRs). You will develop a program to automatically detect basic yet critical errors, such as a patient being discharged before they were admitted or being in two different hospital beds at the same time, which are essential first steps in any data cleaning pipeline [@problem_id:4833782].", "problem": "You are given a set of patient-level inpatient timelines derived from Electronic Health Record (EHR) data, represented as lists of admission and discharge time points measured in days since a fixed origin. The goal is to programmatically detect violations of fundamental temporal plausibility and intra-patient consistency constraints and to quantify rates of these violations.\n\nFundamental base and core definitions:\n- Temporal plausibility for an inpatient stay requires that discharge does not precede admission. Formally, for a stay with admission time $t_a$ and discharge time $t_d$, plausibility requires $t_d \\ge t_a$.\n- Intra-patient consistency for inpatient occupancy requires that a single patient does not have overlapping stays. Model each stay as a half-open interval $[t_a, t_d)$, and two stays $(t_{a,i}, t_{d,i})$ and $(t_{a,j}, t_{d,j})$ for the same patient overlap if and only if $\\max(t_{a,i}, t_{a,j}) < \\min(t_{d,i}, t_{d,j})$. Equality at the boundary, $\\max(t_{a,i}, t_{a,j}) = \\min(t_{d,i}, t_{d,j})$, signifies adjacency, not overlap.\n\nTarget violations to compute:\n- Discharge-before-admission violations: count the number of stays where $t_d < t_a$.\n- Overlapping inpatient stays: among valid stays (those where $t_d \\ge t_a$), count, per patient, the number of overlapping stay pairs as defined above.\n\nRequired rates:\n- Record-level discharge-before-admission rate $R_1$: the ratio of the number of discharge-before-admission violations $V_1$ to the total number of stays $N$, i.e., $R_1 = V_1 / N$.\n- Pair-level overlap rate $R_2$: the ratio of the total number of overlapping valid stay pairs $V_2$ to the total number of comparable valid stay pairs $T$ across all patients, i.e., $R_2 = V_2 / T$. If $T = 0$, define $R_2 = 0$.\n- Patient-level overlap prevalence $R_{2p}$: the ratio of the number of patients with at least one overlapping valid stay pair $P_{\\text{over}}$ to the total number of patients $P$, i.e., $R_{2p} = P_{\\text{over}} / P$.\n\nUnits and measurement:\n- All time points must be treated as real numbers in days. There is no angle measurement. Express all rates as decimals rounded to $6$ decimal places.\n\nTest suite:\nUse the following four test cases, each specified as a list of patients, where each patient is a list of stays, and each stay is a pair $(t_a, t_d)$ in days. Intervals are interpreted as $[t_a, t_d)$.\n- Test case $1$ (general \"happy path\"):\n  - Patient $1$: $(1, 3)$, $(3, 5)$.\n  - Patient $2$: $(10, 12)$.\n  - Patient $3$: $(20, 25)$, $(24, 26)$, $(30, 31)$.\n- Test case $2$ (includes discharge-before-admission and overlap):\n  - Patient $1$: $(5, 4)$, $(7, 9)$.\n  - Patient $2$: $(0, 10)$, $(2, 8)$.\n  - Patient $3$: $(10, 12)$, $(12, 14)$.\n- Test case $3$ (edge case with zero comparable pairs):\n  - Patient $1$: $(3, 2)$.\n  - Patient $2$: $(0, 1)$.\n  - Patient $3$: $(5, 4)$.\n- Test case $4$ (boundary conditions and multiple overlaps):\n  - Patient $1$: $(1, 3)$, $(3, 5)$, $(2, 4)$.\n  - Patient $2$: $(10, 12)$, $(10, 12)$.\n  - Patient $3$: $(20, 20)$.\n\nProgram requirements:\n- Implement a program that, for each test case, computes $R_1$, $R_2$, and $R_{2p}$ exactly as defined above, using only valid stays for overlap-related quantities.\n- Express all three rates for each test case as decimals rounded to $6$ decimal places.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[R_1^{(1)}, R_2^{(1)}, R_{2p}^{(1)}, R_1^{(2)}, R_2^{(2)}, R_{2p}^{(2)}, R_1^{(3)}, R_2^{(3)}, R_{2p}^{(3)}, R_1^{(4)}, R_2^{(4)}, R_{2p}^{(4)}]$, where the superscript denotes the test case index from $1$ to $4$.", "solution": "The problem statement has been analyzed and is determined to be valid. It is scientifically grounded in the domain of medical informatics, specifically data quality assessment. The definitions provided are mathematically precise and internally consistent, constituting a well-posed computational problem. The objectives are clear and devoid of ambiguity or subjectivity.\n\nThe task is to compute three specific data quality rates for patient timelines from Electronic Health Record (EHR) data. We will formalize the procedure based on the provided definitions.\n\nAn inpatient stay is represented by a pair of time points $(t_a, t_d)$, where $t_a$ is the admission time and $t_d$ is the discharge time. The stay corresponds to the half-open interval $[t_a, t_d)$. A patient record is a list of such stays. A test case is a list of patient records.\n\nThe three rates to be calculated are:\n1.  The record-level discharge-before-admission rate, $R_1$.\n2.  The pair-level overlap rate, $R_2$.\n3.  The patient-level overlap prevalence, $R_{2p}$.\n\nLet us define the necessary quantities for these rates.\n\n**1. Temporal Plausibility and Rate $R_1$**\n\nA stay $(t_a, t_d)$ is considered temporally plausible if the discharge time is not before the admission time.\n$$\n\\text{Plausibility condition: } t_d \\ge t_a\n$$\nA violation occurs if $t_d < t_a$. Let $V_1$ be the total count of such violations across all stays in a test case. Let $N$ be the total number of stays across all patients. The rate $R_1$ is defined as:\n$$\nR_1 = \\frac{V_1}{N}\n$$\nIf $N=0$, we define $R_1=0$.\n\n**2. Intra-Patient Consistency and Rates $R_2$ and $R_{2p}$**\n\nThese rates concern overlapping stays for a single patient. The analysis is restricted to *valid* stays, i.e., those that satisfy the plausibility condition $t_d \\ge t_a$.\n\nFor a given patient, two distinct valid stays, $(t_{a,i}, t_{d,i})$ and $(t_{a,j}, t_{d,j})$, are defined to overlap if their corresponding time intervals $[t_{a,i}, t_{d,i})$ and $[t_{a,j}, t_{d,j})$ have a non-empty intersection. This is formally expressed as:\n$$\n\\text{Overlap condition: } \\max(t_{a,i}, t_{a,j}) < \\min(t_{d,i}, t_{d,j})\n$$\nNote that adjacency, where $\\max(t_{a,i}, t_{a,j}) = \\min(t_{d,i}, t_{d,j})$, does not constitute an overlap.\n\nTo compute the rates $R_2$ and $R_{2p}$, we define the following quantities for a given test case:\n-   $P$: The total number of patients.\n-   $k_p$: The number of valid stays for patient $p$.\n-   $T$: The total number of comparable valid stay pairs. A patient with $k_p$ valid stays contributes $\\binom{k_p}{2} = \\frac{k_p(k_p-1)}{2}$ pairs. Thus, $T = \\sum_{p=1}^{P} \\binom{k_p}{2}$.\n-   $V_2$: The total number of overlapping valid stay pairs, summed across all patients.\n-   $P_{\\text{over}}$: The number of patients who have at least one pair of overlapping valid stays.\n\nThe rate $R_2$ is the ratio of overlapping pairs to comparable pairs:\n$$\nR_2 = \\frac{V_2}{T}\n$$\nBy definition, if $T=0$, then $R_2=0$.\n\nThe rate $R_{2p}$ is the proportion of patients with data quality issues related to overlap:\n$$\nR_{2p} = \\frac{P_{\\text{over}}}{P}\n$$\nIf $P=0$, we define $R_{2p}=0$.\n\n**Algorithmic Procedure**\n\nFor each test case, we perform the following steps:\n1.  Initialize counters: $V_1 = 0$, $N = 0$, $V_2 = 0$, $T = 0$, $P_{\\text{over}} = 0$, and $P$ as the total number of patients in the test case.\n2.  Iterate through each patient in the test case.\n3.  For each patient, partition their stays into a list of `valid_stays` ($t_d \\ge t_a$) and count the number of invalid stays ($t_d < t_a$). Increment $V_1$ for each invalid stay. Increment $N$ by the total number of stays for the patient.\n4.  For the current patient, let $k_p$ be the number of stays in `valid_stays`. Add $\\binom{k_p}{2}$ to the total $T$.\n5.  If $k_p \\ge 2$, iterate through all unique pairs of stays in `valid_stays`. For each pair, check for overlap using the condition $\\max(t_{a,i}, t_{a,j}) < \\min(t_{d,i}, t_{d,j})$.\n6.  Count the number of overlapping pairs for the current patient. Let this be `patient_overlap_count`. Add this count to the total $V_2$.\n7.  If `patient_overlap_count` $> 0$, increment $P_{\\text{over}}$.\n8.  After iterating through all patients, calculate the final rates $R_1$, $R_2$, and $R_{2p}$ using their respective formulas. Ensure handling of division by zero as specified.\n9.  Round each rate to $6$ decimal places.\n\n**Example Walkthrough: Test Case 1**\n\n-   Data: Patient 1: $(1, 3), (3, 5)$; Patient 2: $(10, 12)$; Patient 3: $(20, 25), (24, 26), (30, 31)$.\n-   Total patients $P = 3$.\n-   Total stays $N = 2 + 1 + 3 = 6$.\n\n**Step 1: Plausibility Check ($R_1$)**\n-   All stays are checked: $3 \\ge 1$, $5 \\ge 3$, $12 \\ge 10$, $25 \\ge 20$, $26 \\ge 24$, $31 \\ge 30$. All are valid.\n-   $V_1 = 0$.\n-   $R_1 = V_1 / N = 0 / 6 = 0.0$.\n\n**Step 2: Overlap Analysis ($R_2$, $R_{2p}$)**\n-   **Patient 1:** Valid stays: `[(1, 3), (3, 5)]`. $k_1 = 2$.\n    - Comparable pairs: $\\binom{2}{2} = 1$.\n    - Check overlap for $((1, 3), (3, 5))$: $\\max(1, 3) = 3$, $\\min(3, 5) = 3$. Condition $3 < 3$ is false. No overlap.\n-   **Patient 2:** Valid stays: `[(10, 12)]`. $k_2 = 1$.\n    - Comparable pairs: $\\binom{1}{2} = 0$. No pairs to check.\n-   **Patient 3:** Valid stays: `[(20, 25), (24, 26), (30, 31)]`. $k_3 = 3$.\n    - Comparable pairs: $\\binom{3}{2} = 3$.\n    - Pair $((20, 25), (24, 26))$: $\\max(20, 24) = 24$, $\\min(25, 26) = 25$. Condition $24 < 25$ is true. Overlap found.\n    - Pair $((20, 25), (30, 31))$: $\\max(20, 30) = 30$, $\\min(25, 31) = 25$. Condition $30 < 25$ is false. No overlap.\n    - Pair $((24, 26), (30, 31))$: $\\max(24, 30) = 30$, $\\min(26, 31) = 26$. Condition $30 < 26$ is false. No overlap.\n    - Patient 3 has $1$ overlapping pair. Since this is $>0$, we count this patient towards $P_{\\text{over}}$.\n\n**Step 3: Aggregate and Calculate Rates**\n-   Total comparable pairs $T = \\binom{2}{2} + \\binom{1}{2} + \\binom{3}{2} = 1 + 0 + 3 = 4$.\n-   Total overlapping pairs $V_2 = 0 (\\text{P1}) + 0 (\\text{P2}) + 1 (\\text{P3}) = 1$.\n-   Total patients with overlap $P_{\\text{over}} = 1$ (Patient 3).\n-   $R_2 = V_2 / T = 1 / 4 = 0.25$.\n-   $R_{2p} = P_{\\text{over}} / P = 1 / 3 \\approx 0.333333$.\n\nFinal rates for test case 1 are $(0.0, 0.25, 0.333333...)$. The remaining test cases are processed identically.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom itertools import combinations\nimport math\n\ndef solve():\n    \"\"\"\n    Computes data quality violation rates for EHR inpatient timelines.\n    \"\"\"\n    test_cases = [\n        # Test case 1\n        [\n            [(1, 3), (3, 5)],\n            [(10, 12)],\n            [(20, 25), (24, 26), (30, 31)]\n        ],\n        # Test case 2\n        [\n            [(5, 4), (7, 9)],\n            [(0, 10), (2, 8)],\n            [(10, 12), (12, 14)]\n        ],\n        # Test case 3\n        [\n            [(3, 2)],\n            [(0, 1)],\n            [(5, 4)]\n        ],\n        # Test case 4\n        [\n            [(1, 3), (3, 5), (2, 4)],\n            [(10, 12), (10, 12)],\n            [(20, 20)]\n        ]\n    ]\n\n    all_results = []\n\n    for case_data in test_cases:\n        # Initialize counters for the current test case\n        total_stays_n = 0\n        discharge_before_admission_v1 = 0\n        total_comparable_pairs_t = 0\n        overlapping_pairs_v2 = 0\n        patients_with_overlap_p_over = 0\n        total_patients_p = len(case_data)\n\n        for patient_stays in case_data:\n            total_stays_n += len(patient_stays)\n            \n            valid_stays = []\n            for stay in patient_stays:\n                t_a, t_d = stay\n                if t_d  t_a:\n                    discharge_before_admission_v1 += 1\n                else:\n                    valid_stays.append(stay)\n\n            k_p = len(valid_stays)\n            patient_comparable_pairs = math.comb(k_p, 2)\n            total_comparable_pairs_t += patient_comparable_pairs\n\n            if patient_comparable_pairs > 0:\n                patient_overlap_count = 0\n                for stay1, stay2 in combinations(valid_stays, 2):\n                    t_a1, t_d1 = stay1\n                    t_a2, t_d2 = stay2\n                    \n                    # Overlap condition: max(ta,i, ta,j)  min(td,i, td,j)\n                    if max(t_a1, t_a2)  min(t_d1, t_d2):\n                        patient_overlap_count += 1\n                \n                if patient_overlap_count > 0:\n                    patients_with_overlap_p_over += 1\n                    overlapping_pairs_v2 += patient_overlap_count\n\n        # Calculate rates\n        # R1: Record-level discharge-before-admission rate\n        r1 = (discharge_before_admission_v1 / total_stays_n) if total_stays_n > 0 else 0.0\n\n        # R2: Pair-level overlap rate\n        r2 = (overlapping_pairs_v2 / total_comparable_pairs_t) if total_comparable_pairs_t > 0 else 0.0\n\n        # R2p: Patient-level overlap prevalence\n        r2p = (patients_with_overlap_p_over / total_patients_p) if total_patients_p > 0 else 0.0\n        \n        all_results.extend([r1, r2, r2p])\n\n    # Format the final output string\n    formatted_results = [f\"{res:.6f}\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4833782"}, {"introduction": "A significant portion of clinical data is captured in unstructured notes, requiring human experts to abstract it into a structured format for analysis. The quality of this abstracted data depends on the consistency, or reliability, between different abstractors. This exercise introduces Cohen’s $\\kappa$, a robust statistical measure that quantifies inter-rater agreement while correcting for agreement that would occur by chance, allowing you to assess the reliability of a common clinical abstraction task [@problem_id:4833853].", "problem": "A hospital is evaluating the data quality dimension of reliability for smoking status abstraction from Electronic Health Record (EHR) clinical notes. Two clinical coders independently assign one of four nominal categories to each patient: Current, Former, Never, or Unknown. Across a cohort of $300$ patients, the joint classifications are:\n\n- Among patients coder A labeled Current, coder B labeled: Current $55$, Former $7$, Never $6$, Unknown $2$.\n- Among patients coder A labeled Former, coder B labeled: Current $6$, Former $75$, Never $7$, Unknown $2$.\n- Among patients coder A labeled Never, coder B labeled: Current $4$, Former $12$, Never $100$, Unknown $4$.\n- Among patients coder A labeled Unknown, coder B labeled: Current $0$, Former $1$, Never $4$, Unknown $15$.\n\nUsing only the foundational definition of inter-rater reliability for nominal categories that adjusts the observed agreement by the agreement expected by chance given the raters’ marginal label distributions, compute Cohen’s $\\kappa$ for these two coders. Report the result as a dimensionless number rounded to four significant figures. Your final answer must be a single real number.", "solution": "The data quality dimension of reliability in healthcare abstraction tasks quantifies the consistency of measurements across observers. For nominal categories, the widely used chance-corrected inter-rater reliability coefficient is Cohen’s $\\kappa$, defined from first principles as the fraction of agreement beyond chance, normalized by the maximum possible agreement beyond chance. Let $P_{o}$ denote the observed proportion of agreement and let $P_{e}$ denote the agreement expected by chance under independence given the marginal label distributions of each coder. The coefficient is\n$$\n\\kappa \\;=\\; \\frac{P_{o} - P_{e}}{1 - P_{e}}.\n$$\n\nStep $1$: Compute $P_{o}$ from the diagonal of the contingency table. The diagonal counts are Current–Current $55$, Former–Former $75$, Never–Never $100$, Unknown–Unknown $15$. The total number of patients is $300$. Thus\n$$\nP_{o} \\;=\\; \\frac{55 + 75 + 100 + 15}{300} \\;=\\; \\frac{245}{300} \\;=\\; \\frac{49}{60}.\n$$\n\nStep $2$: Compute $P_{e}$ from the product of the marginal distributions. First, compute row (coder A) totals:\n- Current: $55 + 7 + 6 + 2 = 70$,\n- Former: $6 + 75 + 7 + 2 = 90$,\n- Never: $4 + 12 + 100 + 4 = 120$,\n- Unknown: $0 + 1 + 4 + 15 = 20$.\n\nThen compute column (coder B) totals:\n- Current: $55 + 6 + 4 + 0 = 65$,\n- Former: $7 + 75 + 12 + 1 = 95$,\n- Never: $6 + 7 + 100 + 4 = 117$,\n- Unknown: $2 + 2 + 4 + 15 = 23$.\n\nEach marginal proportion is the corresponding total divided by $300$. Therefore,\n$$\nP_{e} \\;=\\; \\sum_{\\text{categories}} \\left(\\frac{\\text{row total}}{300}\\right)\\!\\left(\\frac{\\text{column total}}{300}\\right)\n\\;=\\; \\frac{70 \\cdot 65 + 90 \\cdot 95 + 120 \\cdot 117 + 20 \\cdot 23}{300^{2}}.\n$$\nCompute the numerator:\n$$\n70 \\cdot 65 = 4550,\\quad 90 \\cdot 95 = 8550,\\quad 120 \\cdot 117 = 14040,\\quad 20 \\cdot 23 = 460,\n$$\nso the sum is\n$$\n4550 + 8550 + 14040 + 460 = 27600.\n$$\nThus\n$$\nP_{e} \\;=\\; \\frac{27600}{90000} \\;=\\; \\frac{23}{75}.\n$$\n\nStep $3$: Compute $\\kappa$:\n$$\n\\kappa \\;=\\; \\frac{P_{o} - P_{e}}{1 - P_{e}} \\;=\\; \\frac{\\frac{49}{60} - \\frac{23}{75}}{1 - \\frac{23}{75}}.\n$$\nSimplify the numerator:\n$$\n\\frac{49}{60} - \\frac{23}{75} \\;=\\; \\frac{245}{300} - \\frac{92}{300} \\;=\\; \\frac{153}{300} \\;=\\; \\frac{51}{100}.\n$$\nSimplify the denominator:\n$$\n1 - \\frac{23}{75} \\;=\\; \\frac{52}{75}.\n$$\nTherefore,\n$$\n\\kappa \\;=\\; \\frac{\\frac{51}{100}}{\\frac{52}{75}} \\;=\\; \\frac{51}{100} \\cdot \\frac{75}{52} \\;=\\; \\frac{153}{208}.\n$$\nAs a decimal,\n$$\n\\kappa \\approx 0.735576923.\n$$\nRounded to four significant figures,\n$$\n\\kappa \\approx 0.7356.\n$$\n\nInterpretation for clinical use: Using commonly cited qualitative guidelines (for example, Landis and Koch’s scale), $\\kappa$ values in the range $0.61$ to $0.80$ are often described as “substantial” agreement, and values $\\geq 0.81$ as “almost perfect.” Thus, $\\kappa \\approx 0.7356$ indicates substantial inter-rater reliability for smoking status abstraction. Whether this is adequate for clinical deployment depends on the specific application’s risk tolerance; high-stakes decision support often targets $\\kappa$ closer to or exceeding $0.80$.", "answer": "$$\\boxed{0.7356}$$", "id": "4833853"}, {"introduction": "One of the most significant challenges in health informatics is creating a comprehensive, longitudinal record for a patient whose data is spread across different, unlinked systems. This practice simulates this real-world task using probabilistic record linkage, a powerful technique that moves beyond exact matching. You will apply a model based on Bayesian inference to calculate the probability that two records belong to the same person and determine an optimal decision threshold by balancing the costs of false matches versus missed matches [@problem_id:4833794].", "problem": "A hospital plans to link its laboratory information system table to the admissions table to improve care coordination and analytics. To respect data quality dimensions—especially accuracy, consistency, and completeness—the linkage will be done using three quasi-identifiers: last name, Date of Birth (DOB), and residential zip code. Assume the probabilistic record linkage setting where each field’s agreement is conditionally independent given the true match status. For a candidate pair, define the “$m$-probability” for each field as the probability that the field agrees given a true match, and the “$u$-probability” as the probability that the field agrees given a non-match. The following are empirically estimated from historical, validated links:\n- Last name: $m_{\\text{L}} = 0.97$, $u_{\\text{L}} = 0.02$.\n- Date of Birth (DOB): $m_{\\text{D}} = 0.995$, $u_{\\text{D}} = \\frac{1}{365}$.\n- Zip code: $m_{\\text{Z}} = 0.90$, $u_{\\text{Z}} = 0.10$.\n\nAssume a prior match probability $p = 0.02$ for candidate pairs after blocking. The hospital uses a decision-theoretic rule that minimizes expected loss given the cost of a false match (i.e., linking two different patients) $C_{\\text{FP}} = 80$ and the cost of a missed match (i.e., failing to link the same patient) $C_{\\text{FN}} = 5$. Under the independence model, the likelihood ratio for a field that agrees is the ratio $m_{i}/u_{i}$ and for a field that disagrees is $(1 - m_{i})/(1 - u_{i})$.\n\nConsider two candidate pairs:\n- Pair A: last name, DOB, and zip code all agree.\n- Pair B: last name and DOB agree, but zip code disagrees.\n\nTasks:\n1. Compute the posterior probability of being a true match for Pair A and Pair B.\n2. Derive the optimal likelihood ratio threshold that minimizes expected loss under the given costs and prior $p$.\n3. Estimate the expected false match rate (expressed as a decimal) when applying this threshold to all candidate pairs, under the independence assumption and the given $u$-probabilities.\n\nRound each numerical result to four significant figures. Express all probabilities as decimals (not percentages). Provide your final answers in the order: posterior probability for Pair A, posterior probability for Pair B, optimal threshold, estimated false match rate.", "solution": "The user-provided problem has been validated and is deemed valid. It is scientifically grounded in the established Fellegi-Sunter model of probabilistic record linkage, a standard methodology in medical informatics and statistics. The problem is well-posed, providing all necessary parameters, definitions, and assumptions (such as conditional independence) required for a unique solution. The language is objective and the data are internally consistent.\n\nThe solution is divided into three parts as requested by the problem statement.\n\n### 1. Posterior Probability of Match for Pair A and Pair B\n\nThe posterior probability of a match $M$ given an agreement pattern $\\gamma$, denoted $P(M|\\gamma)$, can be found using Bayes' theorem, expressed in terms of odds. The posterior odds of a match are the product of the prior odds and the likelihood ratio (LR) of the observed agreement pattern.\n\nThe prior probability of a match is given as $p = 0.02$. The prior probability of a non-match is $P(U) = 1 - p = 1 - 0.02 = 0.98$.\nThe prior odds of a match are:\n$$ O_{\\text{prior}} = \\frac{P(M)}{P(U)} = \\frac{p}{1-p} = \\frac{0.02}{0.98} = \\frac{1}{49} $$\n\nThe likelihood ratio for an agreement pattern $\\gamma = (\\gamma_L, \\gamma_D, \\gamma_Z)$ is the product of the LRs for each field, due to the conditional independence assumption:\n$$ L(\\gamma) = L_L(\\gamma_L) \\cdot L_D(\\gamma_D) \\cdot L_Z(\\gamma_Z) $$\nwhere the LR for an agreeing field $i$ is $m_i/u_i$ and for a disagreeing field is $(1-m_i)/(1-u_i)$.\n\nThe posterior odds are $O_{\\text{post}}(\\gamma) = L(\\gamma) \\cdot O_{\\text{prior}}$.\nThe posterior probability is then recovered from the posterior odds:\n$$ P(M|\\gamma) = \\frac{O_{\\text{post}}(\\gamma)}{1 + O_{\\text{post}}(\\gamma)} $$\n\nFirst, we calculate the individual likelihood ratios for agreement and disagreement.\n- Last Name (L):\n  - Agreement LR: $L_L(1) = \\frac{m_L}{u_L} = \\frac{0.97}{0.02} = 48.5$\n- Date of Birth (D):\n  - Agreement LR: $L_D(1) = \\frac{m_D}{u_D} = \\frac{0.995}{1/365} = 0.995 \\times 365 = 363.175$\n- Zip Code (Z):\n  - Agreement LR: $L_Z(1) = \\frac{m_Z}{u_Z} = \\frac{0.90}{0.10} = 9.0$\n  - Disagreement LR: $L_Z(0) = \\frac{1-m_Z}{1-u_Z} = \\frac{1-0.90}{1-0.10} = \\frac{0.10}{0.90} = \\frac{1}{9}$\n\n**For Pair A (Last Name, DOB, and Zip Code agree):**\nThe agreement pattern is $\\gamma_A = (1, 1, 1)$.\nThe total likelihood ratio is:\n$$ L(\\gamma_A) = L_L(1) \\cdot L_D(1) \\cdot L_Z(1) = 48.5 \\times 363.175 \\times 9.0 = 158302.5375 $$\nThe posterior odds for Pair A are:\n$$ O_{\\text{post}}(\\gamma_A) = 158302.5375 \\times \\frac{1}{49} \\approx 3230.66403 $$\nThe posterior probability for Pair A is:\n$$ P(M|\\gamma_A) = \\frac{3230.66403}{1 + 3230.66403} \\approx 0.99969055 $$\nRounding to four significant figures, the posterior probability for Pair A is $0.9997$.\n\n**For Pair B (Last Name and DOB agree, Zip Code disagrees):**\nThe agreement pattern is $\\gamma_B = (1, 1, 0)$.\nThe total likelihood ratio is:\n$$ L(\\gamma_B) = L_L(1) \\cdot L_D(1) \\cdot L_Z(0) = 48.5 \\times 363.175 \\times \\frac{1}{9} \\approx 1957.12083 $$\nThe posterior odds for Pair B are:\n$$ O_{\\text{post}}(\\gamma_B) = 1957.12083 \\times \\frac{1}{49} \\approx 39.9412415 $$\nThe posterior probability for Pair B is:\n$$ P(M|\\gamma_B) = \\frac{39.9412415}{1 + 39.9412415} \\approx 0.9755749 $$\nRounding to four significant figures, the posterior probability for Pair B is $0.9756$.\n\n### 2. Optimal Likelihood Ratio Threshold\n\nThe decision rule is to minimize expected loss. A pair is declared a match if the expected loss of this decision is less than the expected loss of declaring it a non-match.\nLet $C_{\\text{FP}} = 80$ be the cost of a false match and $C_{\\text{FN}} = 5$ be the cost of a false non-match (missed match).\n- Expected loss of declaring 'match': $E[\\text{loss}|\\text{declare M}] = P(U|\\gamma) \\cdot C_{\\text{FP}} = (1 - P(M|\\gamma)) \\cdot C_{\\text{FP}}$\n- Expected loss of declaring 'non-match': $E[\\text{loss}|\\text{declare NM}] = P(M|\\gamma) \\cdot C_{\\text{FN}}$\n\nDeclare as a match if:\n$$ (1 - P(M|\\gamma)) \\cdot C_{\\text{FP}}  P(M|\\gamma) \\cdot C_{\\text{FN}} $$\n$$ C_{\\text{FP}}  P(M|\\gamma) \\cdot (C_{\\text{FP}} + C_{\\text{FN}}) $$\nThis gives a threshold for the posterior probability:\n$$ P(M|\\gamma)  \\frac{C_{\\text{FP}}}{C_{\\text{FP}} + C_{\\text{FN}}} $$\nTo find the likelihood ratio threshold $T_{LR}$, we substitute $P(M|\\gamma) = \\frac{L(\\gamma)O_{\\text{prior}}}{1+L(\\gamma)O_{\\text{prior}}}$:\n$$ \\frac{L(\\gamma)O_{\\text{prior}}}{1+L(\\gamma)O_{\\text{prior}}}  \\frac{C_{\\text{FP}}}{C_{\\text{FP}} + C_{\\text{FN}}} $$\nSolving for $L(\\gamma)$:\n$$ L(\\gamma)  \\frac{C_{\\text{FP}}}{C_{\\text{FN}}} \\cdot \\frac{1}{O_{\\text{prior}}} = \\frac{C_{\\text{FP}}}{C_{\\text{FN}}} \\cdot \\frac{1-p}{p} $$\nThe optimal likelihood ratio threshold $T_{LR}$ is therefore:\n$$ T_{LR} = \\frac{C_{\\text{FP}}}{C_{\\text{FN}}} \\cdot \\frac{1-p}{p} = \\frac{80}{5} \\cdot \\frac{0.98}{0.02} = 16 \\times 49 = 784 $$\nThe optimal threshold is exactly $784$. To express this to four significant figures, we write $784.0$.\n\n### 3. Estimated False Match Rate\n\nThe false match rate (or False Positive Rate, FPR) is the probability that a non-matching pair is incorrectly declared a match. This is $P(\\text{declare match}|U)$. A match is declared if the likelihood ratio $L(\\gamma)$ for a given pair's agreement pattern exceeds the threshold $T_{LR} = 784$.\n\nWe must evaluate which of the $2^3 = 8$ possible agreement patterns yield an LR greater than $784$.\nThe LR for agreement on both Last Name and DOB is $L_L(1) \\times L_D(1) = 48.5 \\times 363.175 = 17614.0875$. Since this value is much larger than $784$, any pattern with agreement on both of these fields will have an LR above the threshold, regardless of the zip code's outcome.\n- For agreement on L, D, and Z (pattern (1,1,1)): $L(\\gamma) = 17614.0875 \\times 9 \\approx 158527$, which is $ 784$.\n- For agreement on L and D, but disagreement on Z (pattern (1,1,0)): $L(\\gamma) = 17614.0875 \\times (1/9) \\approx 1957$, which is $ 784$.\n\nNow consider if any other patterns exceed the threshold. The next highest LR is from agreeing on D and Z, but disagreeing on L. The LR for disagreeing on L is $L_L(0) = \\frac{1-0.97}{1-0.02} = \\frac{0.03}{0.98} \\approx 0.0306$.\n- For disagreement on L, but agreement on D and Z (pattern (0,1,1)): $L(\\gamma) \\approx 0.0306 \\times 363.175 \\times 9 \\approx 100$, which is $ 784$.\nAll other patterns will have even lower LRs.\n\nThus, a pair is declared a match if and only if the last name and date of birth both agree. The false match rate is the probability of this happening for a non-matching pair ($U$):\n$$ \\text{FPR} = P(\\gamma_L=1, \\gamma_D=1 | U) $$\nUsing the conditional independence assumption for non-matches:\n$$ \\text{FPR} = P(\\gamma_L=1|U) \\cdot P(\\gamma_D=1|U) = u_L \\cdot u_D $$\nPlugging in the given values:\n$$ \\text{FPR} = 0.02 \\times \\frac{1}{365} = \\frac{0.02}{365} \\approx 0.0000547945 $$\nRounding to four significant figures, the estimated false match rate is $0.00005479$.\n\nThe final answers, rounded to four significant figures, are:\n- Posterior probability for Pair A: $0.9997$\n- Posterior probability for Pair B: $0.9756$\n- Optimal threshold: $784.0$\n- Estimated false match rate: $0.00005479$", "answer": "$$ \\boxed{\n\\begin{pmatrix}\n0.9997  0.9756  784.0  0.00005479\n\\end{pmatrix}\n} $$", "id": "4833794"}]}