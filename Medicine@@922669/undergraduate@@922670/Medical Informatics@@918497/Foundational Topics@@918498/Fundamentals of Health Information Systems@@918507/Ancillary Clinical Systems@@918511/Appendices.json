{"hands_on_practices": [{"introduction": "Managing a Picture Archiving and Communication System (PACS) requires careful capacity planning to ensure sufficient storage for vast amounts of imaging data. This practice provides a foundational skill: translating clinical imaging protocols into a concrete storage footprint. By calculating the data size of CT and MR exams from their acquisition parameters, you will learn how choices made at the modality directly impact the demands on the hospital's IT infrastructure [@problem_id:4822799].", "problem": "A hospital operates ancillary clinical systems including the Laboratory Information System (LIS), the Radiology Information System (RIS), and the Picture Archiving and Communication System (PACS). The PACS stores Digital Imaging and Communications in Medicine (DICOM) images received from computed tomography (CT) and magnetic resonance (MR) modalities. Use the following scientifically established bases:\n\n- Digital images consist of a rectangular pixel matrix with a fixed number of bits allocated per pixel. The uncompressed pixel data size is given by $($rows$) \\times ($columns$) \\times ($\\text{bits allocated}$)/8$ bytes.\n- For multi-slice acquisitions, the number of reconstructed slices is the smallest integer greater than or equal to the coverage length divided by the reconstruction interval, i.e., $\\lceil L / \\Delta \\rceil$, where $L$ is the coverage length and $\\Delta$ is the reconstruction interval (for CT) or slice thickness plus gap (for MR when reconstructing contiguous slices).\n- In lossless compression, only the pixel data are compressed. The DICOM header metadata are not compressed. If the pixel data are compressed by a factor $s$, the compressed pixel data size is the uncompressed pixel data size divided by $s$.\n- The PACS footprint per instance equals the compressed pixel data size plus the uncompressed DICOM header size.\n\nA CT chest–abdomen–pelvis exam and an MR brain dynamic exam are configured as follows.\n\nCT exam parameters:\n- Longitudinal coverage length $L_{\\mathrm{CT}} = 1100~\\mathrm{mm}$.\n- Reconstruction interval $\\Delta_{\\mathrm{CT}} = 0.8~\\mathrm{mm}$.\n- Phases $P_{\\mathrm{CT}} = 3$ (arterial, venous, delayed), each reconstructed with $K_{\\mathrm{CT}} = 2$ kernels (soft tissue and lung).\n- Two scout images are acquired in addition to axial reconstructions.\n- Matrix per instance: $512 \\times 512$ pixels, $\\text{Bits Allocated} = 16$.\n- DICOM header size per instance $H = 4096$ bytes.\n- Lossless compression factor applied to pixel data $s_{\\mathrm{CT}} = 2.0$.\n\nMR exam parameters:\n- Brain coverage length $L_{\\mathrm{MR}} = 144~\\mathrm{mm}$, slice thickness $\\Delta_{\\mathrm{MR}} = 3~\\mathrm{mm}$, no slice gap.\n- Echoes $E_{\\mathrm{MR}} = 2$, dynamic time points $T_{\\mathrm{MR}} = 60$.\n- Matrix per instance: $256 \\times 256$ pixels, $\\text{Bits Allocated} = 16$.\n- DICOM header size per instance $H = 4096$ bytes (same as CT).\n- Lossless compression factor applied to pixel data $s_{\\mathrm{MR}} = 1.5$.\n\nAssume the number of reconstructed CT slices per phase equals $\\left\\lceil L_{\\mathrm{CT}} / \\Delta_{\\mathrm{CT}} \\right\\rceil$, and the number of MR slices equals $\\left\\lceil L_{\\mathrm{MR}} / \\Delta_{\\mathrm{MR}} \\right\\rceil$. The number of MR instances equals slices $\\times$ echoes $\\times$ time points. For CT, the axial instances equal slices $\\times$ phases $\\times$ kernels, plus the two scout instances. Using the fundamental bases above, derive the total PACS storage footprint for both exams combined. Express your final answer in gigabytes with $1~\\mathrm{GB} = 10^{9}$ bytes, and round your final answer to four significant figures.", "solution": "The problem statement has been validated and is deemed sound. It is scientifically grounded, well-posed, objective, and contains all necessary information to derive a unique solution. We may proceed with the calculation.\n\nThe objective is to calculate the total storage footprint for a computed tomography (CT) exam and a magnetic resonance (MR) exam on a Picture Archiving and Communication System (PACS). The total footprint is the sum of the footprints of the individual exams.\n\nLet $F_{\\mathrm{total}}$ be the total storage footprint in bytes. We have:\n$$F_{\\mathrm{total}} = F_{\\mathrm{total, CT}} + F_{\\mathrm{total, MR}}$$\nwhere $F_{\\mathrm{total, CT}}$ and $F_{\\mathrm{total, MR}}$ are the storage footprints for the CT and MR exams, respectively.\n\nFirst, we calculate the storage footprint for the CT exam.\nThe given parameters for the CT exam are:\n-   Longitudinal coverage length: $L_{\\mathrm{CT}} = 1100~\\mathrm{mm}$\n-   Reconstruction interval: $\\Delta_{\\mathrm{CT}} = 0.8~\\mathrm{mm}$\n-   Phases: $P_{\\mathrm{CT}} = 3$\n-   Reconstruction kernels: $K_{\\mathrm{CT}} = 2$\n-   Scout images: $N_{\\mathrm{scout}} = 2$\n-   Matrix dimensions: $N_{\\mathrm{rows}} = 512$, $N_{\\mathrm{cols}} = 512$\n-   Bits allocated per pixel: $B_{\\mathrm{CT}} = 16$\n-   DICOM header size per instance: $H = 4096$ bytes\n-   Lossless compression factor: $s_{\\mathrm{CT}} = 2.0$\n\nThe number of reconstructed axial slices per phase is given by:\n$$N_{\\mathrm{slices, CT}} = \\lceil \\frac{L_{\\mathrm{CT}}}{\\Delta_{\\mathrm{CT}}} \\rceil = \\lceil \\frac{1100}{0.8} \\rceil = \\lceil 1375 \\rceil = 1375$$\nThe total number of axial instances is the product of slices, phases, and kernels:\n$$N_{\\mathrm{axial, CT}} = N_{\\mathrm{slices, CT}} \\times P_{\\mathrm{CT}} \\times K_{\\mathrm{CT}} = 1375 \\times 3 \\times 2 = 8250$$\nThe total number of instances for the CT exam is the sum of axial instances and scout images:\n$$N_{\\mathrm{inst, CT}} = N_{\\mathrm{axial, CT}} + N_{\\mathrm{scout}} = 8250 + 2 = 8252$$\nNext, we calculate the storage size for a single CT instance. The uncompressed pixel data size, $S_{\\mathrm{unc, CT}}$, is:\n$$S_{\\mathrm{unc, CT}} = \\frac{N_{\\mathrm{rows}} \\times N_{\\mathrm{cols}} \\times B_{\\mathrm{CT}}}{8} = \\frac{512 \\times 512 \\times 16}{8} = 524288~\\text{bytes}$$\nThe compressed pixel data size, $S_{\\mathrm{comp, CT}}$, is obtained by applying the compression factor:\n$$S_{\\mathrm{comp, CT}} = \\frac{S_{\\mathrm{unc, CT}}}{s_{\\mathrm{CT}}} = \\frac{524288}{2.0} = 262144~\\text{bytes}$$\nThe footprint per CT instance, $F_{\\mathrm{inst, CT}}$, is the sum of the compressed pixel data size and the DICOM header size:\n$$F_{\\mathrm{inst, CT}} = S_{\\mathrm{comp, CT}} + H = 262144 + 4096 = 266240~\\text{bytes}$$\nThe total storage footprint for the CT exam is the product of the number of instances and the footprint per instance:\n$$F_{\\mathrm{total, CT}} = N_{\\mathrm{inst, CT}} \\times F_{\\mathrm{inst, CT}} = 8252 \\times 266240 = 2197178880~\\text{bytes}$$\n\nSecond, we calculate the storage footprint for the MR exam.\nThe given parameters for the MR exam are:\n-   Brain coverage length: $L_{\\mathrm{MR}} = 144~\\mathrm{mm}$\n-   Slice thickness: $3~\\mathrm{mm}$\n-   Slice gap: $0~\\mathrm{mm}$, so $\\Delta_{\\mathrm{MR}} = 3~\\mathrm{mm}$\n-   Echoes: $E_{\\mathrm{MR}} = 2$\n-   Dynamic time points: $T_{\\mathrm{MR}} = 60$\n-   Matrix dimensions: $N_{\\mathrm{rows}} = 256$, $N_{\\mathrm{cols}} = 256$\n-   Bits allocated per pixel: $B_{\\mathrm{MR}} = 16$\n-   DICOM header size per instance: $H = 4096$ bytes\n-   Lossless compression factor: $s_{\\mathrm{MR}} = 1.5$\n\nThe number of reconstructed slices is:\n$$N_{\\mathrm{slices, MR}} = \\lceil \\frac{L_{\\mathrm{MR}}}{\\Delta_{\\mathrm{MR}}} \\rceil = \\lceil \\frac{144}{3} \\rceil = \\lceil 48 \\rceil = 48$$\nThe total number of instances for the MR exam is the product of slices, echoes, and time points:\n$$N_{\\mathrm{inst, MR}} = N_{\\mathrm{slices, MR}} \\times E_{\\mathrm{MR}} \\times T_{\\mathrm{MR}} = 48 \\times 2 \\times 60 = 5760$$\nNext, we calculate the storage size for a single MR instance. The uncompressed pixel data size, $S_{\\mathrm{unc, MR}}$, is:\n$$S_{\\mathrm{unc, MR}} = \\frac{N_{\\mathrm{rows}} \\times N_{\\mathrm{cols}} \\times B_{\\mathrm{MR}}}{8} = \\frac{256 \\times 256 \\times 16}{8} = 131072~\\text{bytes}$$\nThe compressed pixel data size, $S_{\\mathrm{comp, MR}}$, is:\n$$S_{\\mathrm{comp, MR}} = \\frac{S_{\\mathrm{unc, MR}}}{s_{\\mathrm{MR}}} = \\frac{131072}{1.5}$$\nThe footprint per MR instance, $F_{\\mathrm{inst, MR}}$, is:\n$$F_{\\mathrm{inst, MR}} = S_{\\mathrm{comp, MR}} + H = \\frac{131072}{1.5} + 4096$$\nThe total storage footprint for the MR exam is:\n$$F_{\\mathrm{total, MR}} = N_{\\mathrm{inst, MR}} \\times F_{\\mathrm{inst, MR}} = 5760 \\times \\left( \\frac{131072}{1.5} + 4096 \\right)$$\n$$F_{\\mathrm{total, MR}} = \\frac{5760}{1.5} \\times 131072 + 5760 \\times 4096 = 3840 \\times 131072 + 23592960$$\n$$F_{\\mathrm{total, MR}} = 503316480 + 23592960 = 526909440~\\text{bytes}$$\n\nFinally, we sum the footprints of both exams to find the total:\n$$F_{\\mathrm{total}} = F_{\\mathrm{total, CT}} + F_{\\mathrm{total, MR}} = 2197178880 + 526909440 = 2724088320~\\text{bytes}$$\nThe problem requires the answer in gigabytes (GB), with $1~\\mathrm{GB} = 10^9$ bytes.\n$$F_{\\mathrm{total, GB}} = \\frac{2724088320}{10^9} = 2.72408832~\\mathrm{GB}$$\nRounding to four significant figures, we get $2.724~\\mathrm{GB}$.", "answer": "$$\\boxed{2.724}$$", "id": "4822799"}, {"introduction": "Beyond storage, data integrity is paramount in any clinical system. This exercise tackles a classic and critical challenge in PACS management known as the 'split-study' problem, where a single logical study is fragmented across multiple database records. You are tasked with evaluating different reconciliation strategies to design a safe, standards-compliant algorithm that merges these fragments without corrupting data, a core competency for ensuring a reliable diagnostic archive [@problem_id:4822786].", "problem": "A hospital’s Picture Archiving and Communication System (PACS) ingests Digital Imaging and Communications in Medicine (DICOM) objects from multiple modality gateways. Due to network latency and workflow variability, a single logical radiology study may be partially imported multiple times, creating two PACS study records that each contain disjoint subsets of the study’s series and instances. This is commonly referred to as the split-study problem. You are asked to choose the best approach that both defines the split-study problem in operational terms and specifies a reconciliation algorithm that, upon detecting multiple partial imports for the same logical study, merges them into a single PACS study while preserving the intended series and instance ordering observed by radiologists, without corrupting identifiers.\n\nAssume the following foundational facts and constraints are in force:\n- In DICOM, `StudyInstanceUID` uniquely identifies a study; `SeriesInstanceUID` uniquely identifies a series; and `SOPInstanceUID` uniquely identifies an instance.\n- `AccessionNumber` is an order identifier commonly provided by the Radiology Information System (RIS).\n- `SeriesNumber` and `InstanceNumber` are intended as modality-provided ordinal fields.\n- The PACS must not invalidate DICOM uniqueness semantics; in particular, it must not change existing UIDs on received objects.\n- The user interface should present a stable sort that reflects acquisition chronology where possible.\n\nConsider a case where two partial imports arrive for the same patient within $30$ minutes. Partial import $\\mathcal{A}$ contains series with `SeriesInstanceUID`s $\\{s_1, s_2\\}$ and partial import $\\mathcal{B}$ contains $\\{s_2, s_3\\}$; both sets carry the same `StudyInstanceUID` $u_{\\text{study}}$, but due to race conditions each partial import was indexed into a different PACS study record. Some instances in $s_2$ are duplicated across the two imports with identical `SOPInstanceUID`s. `SeriesNumber` is present on all series, but two series share the same `SeriesNumber` because a modality protocol was reused. Some instances have missing or duplicate `InstanceNumber` values. `AcquisitionTime` is present on most instances; when missing, `ContentTime` exists. `ImagePositionPatient` is present for cross-sectional images.\n\nWhich option best defines the split-study problem and proposes a safe, standards-conformant reconciliation algorithm that merges the partial imports into a single PACS study and preserves series and instance order presented to users?\n\nA. Define split-study as “two studies with the same `AccessionNumber`,” then reconcile by merging all PACS studies with matching `PatientID` and `AccessionNumber`, rewriting all `StudyInstanceUID`, `SeriesInstanceUID`, and `SOPInstanceUID` to a new canonical set so that identifiers are consistent. Present the merged study with series sorted alphabetically by `SeriesDescription` and instances sorted by file arrival time.\n\nB. Define split-study as “multiple PACS study records that contain objects sharing the same `StudyInstanceUID`,” then reconcile by:\n   - Selecting a master study record for the shared `StudyInstanceUID` and moving index entries for series and instances into that record without modifying received DICOM objects.\n   - Deduplicating instances by `SOPInstanceUID` equality.\n   - Grouping by `SeriesInstanceUID` to form series; preserving series order by sorting ascending by `SeriesNumber`, with deterministic tie-breakers using earliest `SeriesDate`/`SeriesTime`, then `SeriesInstanceUID` lexical order; preserving instance order within a series by ascending `InstanceNumber`, with tie-breakers using `AcquisitionTime`, then `ContentTime`, then geometric keys such as `ImagePositionPatient`, and finally `SOPInstanceUID` lexical order.\n   - Resolving attribute conflicts (e.g., `PatientName`, `StudyDate`) with a documented trust policy (e.g., prefer the most recently ingested complete header), recording an audit trail, and deferring to RIS when available, all without altering UIDs.\n   - Treating `AccessionNumber` as a supporting signal for detection and monitoring, not as a UID replacement.\n\nC. Define split-study as “any two imports within $24$ hours for the same `PatientID`,” then reconcile by deferring presentation until a $24$-hour timeout elapses so that all data arrive, reconstruct the study by clustering images using pixel similarity (hash of pixel data and `ImageOrientationPatient`), and ignore DICOM UIDs to avoid inconsistent headers. Order series by centroid slice normal and instances by pixel hash.\n\nD. Define split-study as “all studies acquired on the same calendar day for a patient,” then reconcile by merging them into a single record and renumbering `SeriesNumber` sequentially from $1$ to $N$ to achieve a clean order. Update `InstanceNumber` on all images to be globally unique across the merged study and write these changes back into the DICOM objects to ensure future consistency.\n\nE. Define split-study as “multiple RIS orders for the same patient on the same `AccessionNumber`,” then reconcile by creating a new `StudyInstanceUID` that represents the union of all related images, mapping all `SeriesInstanceUID`s to new values to ensure monotonic ordering by `Modality` and `AcquisitionTime`. Prefer RIS metadata as ground truth, superseding any differing DICOM header values within received images.\n\nSelect the single best option.", "solution": "The user wants me to act as a meticulous STEM professor to validate and solve a problem concerning the \"split-study\" issue in a Picture Archiving and Communication System (PACS).\n\n### Problem Validation\n\nFirst, I must validate the provided problem statement.\n\n#### Step 1: Extract Givens\n-   **Problem Context**: A Picture Archiving and Communication System (PACS) ingests Digital Imaging and Communications in Medicine (DICOM) objects.\n-   **Core Issue**: A single logical radiology study is imported in parts, creating multiple PACS study records. This is termed the \"split-study problem\".\n-   **Objective**: Define the split-study problem and specify a reconciliation algorithm to merge partial imports into a single study.\n-   **Reconciliation Requirements**:\n    1.  Preserve intended series and instance ordering.\n    2.  Do not corrupt identifiers.\n-   **Foundational Facts and Constraints**:\n    1.  Unique Identifiers (UIDs) in DICOM:\n        -   `StudyInstanceUID` for a study.\n        -   `SeriesInstanceUID` for a series.\n        -   `SOPInstanceUID` for an instance.\n    2.  `AccessionNumber`: An identifier from the Radiology Information System (RIS).\n    3.  `SeriesNumber` and `InstanceNumber`: Ordinal fields from the imaging modality.\n    4.  **Critical Constraint**: The PACS **must not** change existing UIDs on received objects.\n    5.  **UI Requirement**: The user interface must present a stable sort, ideally reflecting acquisition chronology.\n-   **Specific Scenario**:\n    -   Two partial imports, $\\mathcal{A}$ and $\\mathcal{B}$, for the same patient arrive within $30$ minutes.\n    -   Both imports share the same `StudyInstanceUID`, $u_{\\text{study}}$.\n    -   Import $\\mathcal{A}$ contains series $\\{s_1, s_2\\}$; import $\\mathcal{B}$ contains series $\\{s_2, s_3\\}$.\n    -   Each import is indexed into a separate PACS study record.\n    -   Instances with identical `SOPInstanceUID`s exist in the overlapping series $s_2$.\n    -   Data Quality Issues:\n        -   `SeriesNumber` is not unique (two series share the same number).\n        -   `InstanceNumber` values are missing or duplicated.\n        -   `AcquisitionTime` is mostly present; `ContentTime` is a fallback.\n        -   `ImagePositionPatient` is available for cross-sectional images.\n\n#### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is firmly rooted in the technical standards and operational realities of medical informatics. The use of DICOM terminology (`StudyInstanceUID`, `SOPInstanceUID`, `AccessionNumber`, etc.) is accurate. The scenario described—split studies caused by network or workflow issues, and imperfect metadata from modalities—is a classic and realistic challenge in PACS management. The entire premise is scientifically and technically sound.\n2.  **Well-Posed**: The problem is well-posed. It clearly defines a scenario, establishes strict constraints (e.g., immutability of UIDs), and asks for the evaluation of several proposed solutions against these criteria. A \"best\" approach can be determined by rigorously comparing the options to the stated requirements.\n3.  **Objective**: The language is technical, precise, and free of subjectivity. The constraints provide an objective framework for evaluating the options.\n\nThe problem statement does not exhibit any flaws. It is a valid, well-structured problem in the field of medical informatics.\n\n#### Step 3: Verdict and Action\nThe problem is **valid**. I will proceed with the solution.\n\n### Solution Derivation\n\nThe goal is to find the best approach to define and solve the split-study problem, adhering to the given constraints. A correct solution must satisfy the following principles:\n\n1.  **Correct Definition**: The fundamental identifier for a \"logical study\" in DICOM is the `StudyInstanceUID`. Therefore, a split-study is correctly defined as two or more PACS-internal records that contain DICOM objects sharing the same `StudyInstanceUID`. Other identifiers like `AccessionNumber` or patient demographics are auxiliary and less reliable for this specific purpose.\n2.  **Data Integrity and Immutability**: The constraint that UIDs must not be changed is absolute. DICOM UIDs guarantee global uniqueness and are the bedrock of data traceability. Any algorithm that creates new UIDs for existing data or rewrites them is non-conformant and destructive. The reconciliation must be a non-destructive operation, typically at the database/index level of the PACS, leaving the original DICOM objects untouched.\n3.  **Deduplication**: Since the same instance can be received multiple times, a deduplication mechanism is necessary. The unique identifier for a DICOM instance is its `SOPInstanceUID`. Thus, deduplication must be performed by comparing `SOPInstanceUID`s.\n4.  **Robust Sorting**: The user interface must present series and instances in a clinically meaningful order, which is typically chronological. Given that `SeriesNumber` and `InstanceNumber` are stated to be unreliable (non-unique, missing), a robust sorting algorithm must use them as a primary key but employ a deterministic, multi-level tie-breaking strategy. Logical tie-breakers include chronological tags (`AcquisitionTime`, `ContentTime`), geometric tags (`ImagePositionPatient` for spatial sorting), and finally, the unique identifiers themselves (`SeriesInstanceUID`, `SOPInstanceUID`) as a final, stable sorting key.\n5.  **Metadata Conflict Resolution**: When merging study-level information from two partial imports, conflicts in descriptive metadata (e.g., `PatientName`, `StudyDate`) can occur. A sound system will have a pre-defined, auditable policy to resolve these conflicts (e.g., prefer the most recent data, prefer data from the RIS).\n\nBased on these principles, I will now evaluate each option.\n\n### Option-by-Option Analysis\n\n**A. Define split-study as “two studies with the same `AccessionNumber`,” then reconcile by merging all PACS studies with matching `PatientID` and `AccessionNumber`, rewriting all `StudyInstanceUID`, `SeriesInstanceUID`, and `SOPInstanceUID` to a new canonical set so that identifiers are consistent. Present the merged study with series sorted alphabetically by `SeriesDescription` and instances sorted by file arrival time.**\n-   **Definition**: Incorrect. Using `AccessionNumber` as the primary key is fragile. An `AccessionNumber` is not guaranteed to be unique and can be manually entered, leading to errors. This can cause incorrect merging of distinct studies. The `StudyInstanceUID` is the correct key.\n-   **Reconciliation**: Violates a critical constraint. It proposes **rewriting all UIDs**, which is explicitly forbidden by the problem statement (\"must not change existing UIDs\"). This is a destructive action that breaks DICOM conformance and data integrity.\n-   **Sorting**: Inadequate. Sorting by `SeriesDescription` (a free-text field) is non-deterministic and not clinically meaningful. Sorting by file arrival time does not reflect the acquisition chronology required by radiologists.\n-   **Verdict**: **Incorrect**.\n\n**B. Define split-study as “multiple PACS study records that contain objects sharing the same `StudyInstanceUID`,” then reconcile by: ...**\n-   **Definition**: Correct. This is the precise, standards-compliant definition of a split DICOM study.\n-   **Reconciliation**: The proposed algorithm is excellent and respects all constraints.\n    -   *Merging*: It correctly proposes moving *index entries* into a master record, which is a non-destructive database operation that leaves the underlying DICOM objects and their UIDs intact.\n    -   *Deduplication*: Correctly uses `SOPInstanceUID` equality for deduplication.\n    -   *Sorting*: Proposes a comprehensive and robust multi-level sorting logic for both series and instances, using primary keys (`SeriesNumber`, `InstanceNumber`) and a deterministic cascade of tie-breakers (`AcquisitionTime`, `ContentTime`, geometric keys, and finally lexical sorting of UIDs). This directly addresses the data quality issues mentioned in the problem and fulfills the UI requirement.\n    -   *Conflict Resolution*: Includes a sound policy for handling metadata conflicts with auditing, which is a hallmark of a well-designed system.\n    -   *Role of AccessionNumber*: Correctly identifies the `AccessionNumber` as a useful secondary identifier for monitoring but not as the primary key for the merge operation.\n-   **Verdict**: **Correct**. This option holistically addresses the problem with a safe, standards-conformant, and robust solution.\n\n**C. Define split-study as “any two imports within $24$ hours for the same `PatientID`,” then reconcile by deferring presentation until a $24$-hour timeout elapses so that all data arrive, reconstruct the study by clustering images using pixel similarity (hash of pixel data and `ImageOrientationPatient`), and ignore DICOM UIDs to avoid inconsistent headers. Order series by centroid slice normal and instances by pixel hash.**\n-   **Definition**: Incorrect and dangerous. A patient can have multiple, distinct studies in a $24$-hour period. This definition would lead to the erroneous merging of unrelated clinical exams.\n-   **Reconciliation**: Fundamentally flawed. A $24$-hour delay in viewing images is clinically unacceptable. The proposal to **ignore DICOM UIDs** is a blatant violation of the DICOM standard and common sense in data management. The pixel-based clustering approach is computationally expensive, prone to error, and completely unnecessary when reliable UIDs are available.\n-   **Sorting**: The sorting method is overly complex and may not produce a clinically intuitive ordering.\n-   **Verdict**: **Incorrect**.\n\n**D. Define split-study as “all studies acquired on the same calendar day for a patient,” then reconcile by merging them into a single record and renumbering `SeriesNumber` sequentially from $1$ to $N$ to achieve a clean order. Update `InstanceNumber` on all images to be globally unique across the merged study and write these changes back into the DICOM objects to ensure future consistency.**\n-   **Definition**: Incorrect. As with option C, this definition would incorrectly merge distinct studies performed on the same day.\n-   **Reconciliation**: Problematic. It proposes **writing changes back into the DICOM objects**. Modifying original source data (`SeriesNumber`, `InstanceNumber`) is a risky practice that compromises data provenance. While not as severe as changing UIDs, it is an inferior approach compared to the non-destructive indexing method in option B. Furthermore, it's solving the wrong problem by merging distinct studies.\n-   **Verdict**: **Incorrect**.\n\n**E. Define split-study as “multiple RIS orders for the same patient on the same `AccessionNumber`,” then reconcile by creating a new `StudyInstanceUID` that represents the union of all related images, mapping all `SeriesInstanceUID`s to new values to ensure monotonic ordering by `Modality` and `AcquisitionTime`. Prefer RIS metadata as ground truth, superseding any differing DICOM header values within received images.**\n-   **Definition**: Incorrect. Relies on the non-unique `AccessionNumber` and RIS logic, not the definitive `StudyInstanceUID`.\n-   **Reconciliation**: Violates a critical constraint in the most severe way. It explicitly calls for **creating a new `StudyInstanceUID`** and **mapping `SeriesInstanceUIDs` to new values**. This directly contradicts the rule \"must not change existing UIDs on received objects.\" This action destroys the original identity of the data.\n-   **Verdict**: **Incorrect**.\n\nConclusion: Option B is the only one that provides a correct definition of the problem and a reconciliation strategy that is safe, effective, and fully compliant with the DICOM standard and the problem's explicit constraints.", "answer": "$$\\boxed{B}$$", "id": "4822786"}, {"introduction": "A PACS must not only store data correctly but also make it available promptly, which requires robust system performance. This advanced practice introduces a powerful analytical tool, queueing theory, to model and predict performance bottlenecks in the PACS ingestion pathway. By analyzing the flow of incoming studies as an $M/M/c$ queue, you will learn how to quantify system delays and make informed decisions about resource allocation to prevent backlogs and ensure timely access to images for clinical care [@problem_id:4822802].", "problem": "A hospital’s Picture Archiving and Communication System (PACS) ingests Digital Imaging and Communications in Medicine (DICOM) studies arriving from modalities coordinated through the Radiology Information System (RIS) and tagged with patient identifiers originating in the Laboratory Information System (LIS). To prevent ingestion bottlenecks, the PACS uses $c$ identical network routers running a First-Come, First-Served (FCFS) queue to accept and validate inbound studies before storage.\n\nAssume the following fundamental base for modeling the PACS ingestion subsystem:\n- Study arrivals form a Poisson process with rate $\\lambda$ (studies per unit time).\n- Each router provides independent, exponentially distributed service times with rate $\\mu$ (studies per unit time per router).\n- The system operates in steady state with $\\lambda < c \\mu$.\n\nModel the ingestion subsystem as an $M/M/c$ queue. Starting only from the definitions above and steady-state birth–death balance for $M/M/c$, derive a closed-form analytical expression for the expected waiting time in the queue, $W_q$, as a function of $\\lambda$, $\\mu$, and $c$. Then, evaluate $W_q$ for the scientifically realistic configuration $\\lambda = 12$ studies/minute, $\\mu = 5$ studies/minute per router, and $c = 3$ routers. Express the final numerical value of $W_q$ in seconds, and round your answer to four significant figures.", "solution": "The problem requires the derivation of the expected waiting time in the queue, $W_q$, for an $M/M/c$ queueing system, followed by a numerical evaluation for a specific set of parameters. The derivation must proceed from the fundamental steady-state birth-death balance equations.\n\nThe system is modeled as an $M/M/c$ queue with arrival rate $\\lambda$, service rate per server $\\mu$, and $c$ identical servers. The system is in steady state, which requires the stability condition $\\lambda < c\\mu$.\n\nLet $P_n$ be the steady-state probability that there are $n$ studies (customers) in the system, for $n = 0, 1, 2, \\dots$. The state of the system is the number of studies present.\n\nThe birth-death process is characterized by the following rates:\n- The arrival rate (birth rate) is constant, independent of the state $n$: $\\lambda_n = \\lambda$ for all $n \\ge 0$.\n- The service rate (death rate) depends on the number of busy servers. If $n$ studies are in the system, $\\min(n, c)$ servers are busy. Since each server works at a rate $\\mu$, the total service rate is $\\mu_n = \\min(n, c)\\mu$.\n  - For $1 \\le n < c$, $\\mu_n = n\\mu$.\n  - For $n \\ge c$, $\\mu_n = c\\mu$.\n\nThe steady-state balance equations express the principle that for each state $n$, the rate of entering state $n$ equals the rate of leaving state $n$.\nFor state $n=0$:\n$\\lambda P_0 = \\mu_1 P_1 \\implies \\lambda P_0 = \\mu P_1$\nFor states $1 \\le n < c$:\n$(\\lambda + n\\mu)P_n = \\lambda P_{n-1} + (n+1)\\mu P_{n+1}$\nFor states $n \\ge c$:\n$(\\lambda + c\\mu)P_n = \\lambda P_{n-1} + c\\mu P_{n+1}$\n\nThese can be simplified by considering the flow between adjacent states, leading to the detailed balance equations:\n$\\lambda P_{n-1} = \\mu_n P_n$ for $n \\ge 1$.\n\nFrom these, we can express $P_n$ in terms of $P_0$:\nFor $1 \\le n \\le c$:\n$P_n = \\frac{\\lambda}{\\mu_n} P_{n-1} = \\frac{\\lambda}{n\\mu} P_{n-1}$.\nUnfolding this recurrence relation, we get:\n$P_n = \\frac{\\lambda^n}{n!\\mu^n} P_0 = \\frac{(\\lambda/\\mu)^n}{n!} P_0$.\n\nFor $n > c$:\n$P_n = \\frac{\\lambda}{\\mu_n} P_{n-1} = \\frac{\\lambda}{c\\mu} P_{n-1}$.\nLet the server utilization be $\\rho = \\frac{\\lambda}{c\\mu}$. The stability condition is $\\rho < 1$.\n$P_n = \\rho P_{n-1}$ for $n > c$.\nUnfolding this relation back to state $c$:\n$P_n = \\rho^{n-c} P_c$.\nSubstituting the expression for $P_c$:\n$P_n = \\rho^{n-c} \\frac{(\\lambda/\\mu)^c}{c!} P_0$.\n\nTo find $P_0$, we use the normalization condition $\\sum_{n=0}^{\\infty} P_n = 1$:\n$$1 = \\sum_{n=0}^{c-1} P_n + \\sum_{n=c}^{\\infty} P_n$$\n$$1 = P_0 \\sum_{n=0}^{c-1} \\frac{(\\lambda/\\mu)^n}{n!} + P_0 \\sum_{n=c}^{\\infty} \\frac{(\\lambda/\\mu)^c}{c!} \\rho^{n-c}$$\nLet $k = n-c$:\n$$\\sum_{n=c}^{\\infty} \\rho^{n-c} = \\sum_{k=0}^{\\infty} \\rho^k = \\frac{1}{1-\\rho}$$\nThis geometric series converges because $\\rho < 1$. Substituting this back:\n$$1 = P_0 \\left[ \\sum_{n=0}^{c-1} \\frac{(\\lambda/\\mu)^n}{n!} + \\frac{(\\lambda/\\mu)^c}{c!} \\frac{1}{1-\\rho} \\right]$$\nThus, $P_0$ is given by:\n$$P_0 = \\left[ \\sum_{n=0}^{c-1} \\frac{(\\lambda/\\mu)^n}{n!} + \\frac{(\\lambda/\\mu)^c}{c! (1 - \\lambda/(c\\mu))} \\right]^{-1}$$\n\nAn arriving study must wait in the queue if and only if all $c$ servers are busy. The probability of this event, often called the Erlang C formula $C(r,c)$ where $r=\\lambda/\\mu$, is:\n$$P(\\text{queue}) = \\sum_{n=c}^{\\infty} P_n = P_c \\sum_{k=0}^{\\infty} \\rho^k = \\frac{P_c}{1-\\rho} = P_0 \\frac{(\\lambda/\\mu)^c}{c!(1-\\rho)}$$\n\nThe expected waiting time in the queue, $W_q$, can be found by conditioning on whether an arrival must queue.\n$W_q = P(\\text{queue}) \\cdot E[W_q | \\text{must queue}] + P(\\text{no queue}) \\cdot 0$.\nGiven that an arriving study must queue, it finds a system with $n \\ge c$ studies. Due to the memoryless property of the exponential service times, the remaining service time for any ongoing service is still exponentially distributed with rate $\\mu$. The total service rate of the $c$ busy servers is $c\\mu$. The time until the next service completion is therefore exponentially distributed with rate $c\\mu$.\nLet $N_q$ be the number of studies in the queue when an arrival occurs, given that the arrival must queue. The probability of finding $k$ studies in the queue ($n=c+k$ total) upon arrival, given that $n \\ge c$, is $\\frac{P_{c+k}}{P(\\text{queue})} = \\frac{P_c \\rho^k}{P_c/(1-\\rho)} = (1-\\rho)\\rho^k$. This is a geometric distribution with mean $E[N_q] = \\frac{\\rho}{1-\\rho}$.\nAn arriving study must wait for the $N_q$ studies ahead of it in the queue to be served, plus the study currently being served by the server that becomes free. Wait, this thinking is slightly off. The arriving study must wait for $N_q+1$ service *completions* from the group of $c$ servers. The expected time for each service completion is $1/(c\\mu)$. Thus, the conditional waiting time is:\n$E[W_q | \\text{must queue}] = (E[N_q]+1) \\frac{1}{c\\mu} = \\left(\\frac{\\rho}{1-\\rho} + 1\\right) \\frac{1}{c\\mu} = \\frac{1}{1-\\rho} \\frac{1}{c\\mu} = \\frac{1}{c\\mu - c\\mu\\rho} = \\frac{1}{c\\mu - \\lambda}$.\nThis result is remarkably simple: the expected wait for those who must queue is the inverse of the system's excess service capacity.\n\nThe unconditional expected waiting time in the queue is then:\n$$W_q = P(\\text{queue}) \\cdot \\frac{1}{c\\mu - \\lambda}$$\nSubstituting the expression for $P(\\text{queue})$:\n$$W_q = \\frac{1}{c\\mu - \\lambda} \\left( P_0 \\frac{(\\lambda/\\mu)^c}{c!(1 - \\lambda/(c\\mu))} \\right)$$\nwhere $P_0$ is given above. This is the closed-form analytical expression for $W_q$.\n\nNow we evaluate $W_q$ for the given parameters:\n- $\\lambda = 12$ studies/minute\n- $\\mu = 5$ studies/minute per router\n- $c = 3$ routers\n\nFirst, we calculate the dimensionless parameters:\n- The offered traffic intensity, $r = \\frac{\\lambda}{\\mu} = \\frac{12}{5} = 2.4$.\n- The server utilization, $\\rho = \\frac{\\lambda}{c\\mu} = \\frac{12}{3 \\times 5} = \\frac{12}{15} = 0.8$.\nThe stability condition $\\rho < 1$ is satisfied.\n\nNext, we calculate the components of $P_0^{-1}$:\nThe summation term:\n$$\\sum_{n=0}^{c-1} \\frac{r^n}{n!} = \\sum_{n=0}^{2} \\frac{(2.4)^n}{n!} = \\frac{(2.4)^0}{0!} + \\frac{(2.4)^1}{1!} + \\frac{(2.4)^2}{2!} = 1 + 2.4 + \\frac{5.76}{2} = 1 + 2.4 + 2.88 = 6.28$$\nThe queueing term:\n$$\\frac{r^c}{c!(1-\\rho)} = \\frac{(2.4)^3}{3!(1-0.8)} = \\frac{13.824}{6 \\times 0.2} = \\frac{13.824}{1.2} = 11.52$$\nNow we find $P_0$:\n$$P_0 = (6.28 + 11.52)^{-1} = (17.80)^{-1}$$\n\nNext, we calculate the probability of queueing, $P(\\text{queue})$:\n$$P(\\text{queue}) = P_0 \\times \\frac{r^c}{c!(1-\\rho)} = \\frac{1}{17.80} \\times 11.52 = \\frac{11.52}{17.80} \\approx 0.647191$$\n\nFinally, we calculate $W_q$ in minutes:\n$$W_q = \\frac{P(\\text{queue})}{c\\mu - \\lambda} = \\frac{11.52 / 17.80}{3 \\times 5 - 12} = \\frac{11.52 / 17.80}{3} = \\frac{11.52}{53.4} \\approx 0.215730337 \\text{ minutes}$$\n\nThe problem requires the answer in seconds, rounded to four significant figures.\n$$W_q \\text{ (in seconds)} = 0.215730337 \\text{ minutes} \\times 60 \\frac{\\text{seconds}}{\\text{minute}} \\approx 12.94382022 \\text{ seconds}$$\nRounding to four significant figures, we get $12.94$.", "answer": "$$\\boxed{12.94}$$", "id": "4822802"}]}