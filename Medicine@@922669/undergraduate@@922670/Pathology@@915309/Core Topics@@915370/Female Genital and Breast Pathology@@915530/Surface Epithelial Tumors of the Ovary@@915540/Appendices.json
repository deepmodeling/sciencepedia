{"hands_on_practices": [{"introduction": "This first exercise places you in the role of a practicing pathologist faced with a common diagnostic challenge: classifying a mucinous ovarian neoplasm. You will apply fundamental histopathologic principles and a specific quantitative criterion to differentiate a benign mucinous cystadenoma from a mucinous borderline tumor [@problem_id:4454319]. This practice is essential for understanding how pathologists make critical distinctions that directly guide clinical treatment and patient prognosis.", "problem": "A unilateral ovarian cystic lesion is sampled extensively. On histology, the lining consists of intestinal-type mucinous epithelium with areas of epithelial stratification and tufting. Quantitative mapping shows that epithelial stratification (defined as more than a single layer of mucinous epithelium forming pseudostratified or multilayered architecture) involves $30\\%$ of the total inner cyst lining. Focal short papillary excrescences arise from the mucinous epithelium, but there is no destructive stromal invasion and no stromal reaction; the stroma is unremarkable, without desmoplasia or inflammatory response. The institution uses a predefined threshold of $10\\%$ of the lining showing stratification to meet the architectural criterion for a mucinous borderline tumor. Starting from the foundational classification principle that epithelial proliferation without destructive stromal invasion distinguishes borderline tumors from benign cystadenomas, and destructive stromal invasion is required for carcinoma, determine which of the following conclusions is best supported.\n\nA. The criteria are met for a mucinous borderline tumor; classify as mucinous borderline (intestinal type) in the absence of invasion.\n\nB. The criteria are not met; the lesion is a benign mucinous cystadenoma because papillary architecture is mandatory for borderline classification regardless of stratification percentage.\n\nC. The criteria are not met; any absence of stromal reaction excludes borderline status, so the lesion must be benign.\n\nD. The criteria are met, but the tumor should be classified as a serous borderline tumor because papillary architecture indicates serous differentiation.\n\nE. The criteria are met for mucinous carcinoma because papillae and epithelial stratification imply invasion even if no destructive stromal invasion is identified.", "solution": "The user has provided a problem in the field of pathology for validation and solution.\n\n### Step 1: Extract Givens\n\nThe problem provides the following information and principles:\n- **Lesion Description**: A unilateral ovarian cystic lesion.\n- **Sampling**: Extensively sampled.\n- **Histology**: The lining consists of intestinal-type mucinous epithelium.\n- **Architectural Features**: The lining shows areas of epithelial stratification and tufting. Focal short papillary excrescences are also present.\n- **Quantitative Data**: Epithelial stratification involves $30\\%$ of the total inner cyst lining.\n- **Provided Definition**: Epithelial stratification is defined as \"more than a single layer of mucinous epithelium forming pseudostratified or multilayered architecture\".\n- **Invasion Status**: There is no destructive stromal invasion.\n- **Stromal Features**: The stroma is unremarkable, with no stromal reaction, desmoplasia, or inflammatory response.\n- **Institutional Criterion**: A predefined threshold of $10\\%$ of the lining showing stratification is required to meet the architectural criterion for a mucinous borderline tumor.\n- **Foundational Principle 1**: Epithelial proliferation without destructive stromal invasion distinguishes borderline tumors from benign cystadenomas.\n- **Foundational Principle 2**: Destructive stromal invasion is required for carcinoma.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem statement is subjected to validation based on the established criteria.\n\n- **Scientifically Grounded**: The problem is well-grounded in the principles of gynecologic pathology. The description of the lesion, the histological features (intestinal-type mucinous epithelium, stratification, tufting, papillary excrescences), the concept of destructive stromal invasion, and the classification scheme (benign, borderline, carcinoma) are all standard and consistent with the World Health Organization (WHO) Classification of Female Genital Tumours. The use of a quantitative threshold for architectural complexity (e.g., stratification extent) is a recognized, albeit sometimes debated, aspect of diagnosing mucinous borderline tumors. The scenario is pathologically realistic.\n- **Well-Posed**: The problem is well-posed. It provides a clear set of histological findings, explicit classification principles, and a specific criterion (the $10\\%$ rule) to be applied. The question asks for the best-supported conclusion, for which a unique answer can be derived from the given information.\n- **Objective**: The language is objective and uses standard pathological terminology. Descriptions such as \"intestinal-type mucinous epithelium,\" \"no destructive stromal invasion,\" and the quantitative measure of \"$30\\%$ stratification\" are precise and free of subjective bias.\n\nThe problem statement is free of scientific unsoundness, internal contradictions, or ambiguity. It presents a logical puzzle based on established medical science principles.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. The solution process will now proceed.\n\n### Derivation of the Correct Conclusion\n\nThe problem requires a diagnosis based on applying the provided principles and criteria to the histological findings.\n\n1.  **Evaluate for Carcinoma**: Foundational Principle 2 states that \"destructive stromal invasion is required for carcinoma.\" The problem explicitly states there is \"no destructive stromal invasion.\" Therefore, a diagnosis of carcinoma is ruled out.\n\n2.  **Evaluate for Benign vs. Borderline**: Foundational Principle 1 states that \"epithelial proliferation without destructive stromal invasion distinguishes borderline tumors from benign cystadenomas.\" A benign cystadenoma would feature a simple, single-layered epithelial lining with minimal to no proliferation. This lesion, however, exhibits significant epithelial proliferation, described as \"epithelial stratification and tufting\" and \"Focal short papillary excrescences.\" This degree of proliferation points away from a benign diagnosis and towards a borderline tumor.\n\n3.  **Apply the Institutional Criterion**: The institution has a specific, quantitative rule for classifying a mucinous tumor as borderline: \"$10\\%$ of the lining showing stratification\". The problem states that quantitative mapping shows stratification involves \"$30\\%$ of the total inner cyst lining.\" Since $30\\% > 10\\%$, the lesion meets this architectural criterion for a mucinous borderline tumor.\n\n4.  **Determine the Tumor Type**: The histology is explicitly described as \"intestinal-type mucinous epithelium.\" This specifies the lineage of the tumor.\n\n5.  **Synthesize the Conclusion**: The lesion is a mucinous neoplasm of the intestinal type. It exhibits significant epithelial proliferation, with the extent of stratification ($30\\%$) exceeding the institutional threshold ($10\\%$) for a borderline tumor. It lacks the defining feature of carcinoma (destructive stromal invasion). Therefore, the correct classification is mucinous borderline tumor, intestinal type.\n\n### Evaluation of Options\n\n**A. The criteria are met for a mucinous borderline tumor; classify as mucinous borderline (intestinal type) in the absence of invasion.**\nThis conclusion is fully supported by the derivation. The quantitative criterion for stratification ($30\\% > 10\\%$) is met, confirming its borderline nature. The absence of destructive invasion rules out carcinoma. The histology confirms it is a mucinous tumor of the intestinal type.\n**Verdict: Correct.**\n\n**B. The criteria are not met; the lesion is a benign mucinous cystadenoma because papillary architecture is mandatory for borderline classification regardless of stratification percentage.**\nThis statement is incorrect for two reasons. First, it falsely claims that papillary architecture is mandatory. The problem provides a criterion based on stratification ($10\\%$), which is explicitly met. In pathology, significant stratification alone can be sufficient for a borderline diagnosis in mucinous tumors. Second, given the extensive epithelial proliferation ($30\\%$ stratification), classifying the lesion as a benign mucinous cystadenoma violates Foundational Principle 1.\n**Verdict: Incorrect.**\n\n**C. The criteria are not met; any absence of stromal reaction excludes borderline status, so the lesion must be benign.**\nThis statement introduces a false criterion. A stromal reaction (desmoplasia) is a response to invasion and is a characteristic feature of invasive carcinoma, not a requirement for a borderline tumor. The definition of a borderline tumor is predicated on epithelial proliferation *without* destructive stromal invasion. The absence of a stromal reaction is consistent with a non-invasive (borderline) process.\n**Verdict: Incorrect.**\n\n**D. The criteria are met, but the tumor should be classified as a serous borderline tumor because papillary architecture indicates serous differentiation.**\nThis option incorrectly reclassifies the tumor. The problem unequivocally states the lining is \"intestinal-type mucinous epithelium.\" This defines the tumor as mucinous. While papillary architecture is very common in serous tumors, it is not exclusive to them and can be found in mucinous tumors. Ignoring the explicit cell type (mucinous) is a fundamental error.\n**Verdict: Incorrect.**\n\n**E. The criteria are met for mucinous carcinoma because papillae and epithelial stratification imply invasion even if no destructive stromal invasion is identified.**\nThis option directly contradicts Foundational Principle 2, which requires \"destructive stromal invasion\" for a diagnosis of carcinoma. The problem explicitly states this feature is absent. The presence of epithelial proliferation (stratification, papillae) in the *absence* of destructive invasion is the definition of a borderline tumor, not carcinoma.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "4454319"}, {"introduction": "A pathologist's role extends beyond simply naming a tumor to predicting its biological behavior. This practice [@problem_id:4454342] delves into the critical concept of tumor staging and prognosis by examining a serous borderline tumor that has spread to the peritoneum. By distinguishing between \"noninvasive\" and \"invasive\" implants, you will learn how disease distribution and the nature of tumor spread modify a patient's long-term outlook, even when the primary diagnosis is not fully malignant.", "problem": "A surgeon requests a pathology consult for a patient with an ovarian mass diagnosed as a serous borderline tumor (also termed atypical proliferative serous tumor). Multiple small peritoneal lesions are biopsied from the omentum and pelvic peritoneum. Histologically, these lesions show epithelial proliferations with hierarchical branching and tufting consistent with serous borderline morphology, but without destructive stromal invasion. The pathologist must advise on the expected impact of these findings on prognosis and on classification/staging. Use the following foundational base to reason to an answer:\n\n- Definition of invasion: carcinoma requires destructive stromal infiltration by neoplastic epithelial cells beyond the basement membrane; without invasion, spread represents non-destructive implantation rather than metastatic carcinoma.\n- Principles of staging and classification: the International Federation of Gynecology and Obstetrics (FIGO) applies stage descriptors to ovarian neoplasms that reflect disease distribution; however, the diagnostic category (borderline tumor versus carcinoma) rests on the presence or absence of invasion.\n- Natural history observations: serous borderline tumors and low-grade serous carcinoma represent distinct ends of a biologic continuum. Invasive implants are linked to progression to low-grade serous carcinoma and decreased disease-specific survival, whereas noninvasive implants lack destructive stromal invasion and are associated primarily with increased recurrence risk.\n\nSuppose that, for serous borderline tumors without implants, the $10$-year disease-specific survival is $S_0 = 0.98$ and the $10$-year recurrence probability is $R_0 = 0.10$. In cohorts with noninvasive peritoneal implants, studies report a relative risk of recurrence $RR_R = 2.3$ compared with those without implants, while the disease-specific survival remains high (near $S_0$). Derive, from the above base, how noninvasive implants should alter prognosis and classification: specifically, state whether the presence of noninvasive implants reclassifies the tumor into an invasive carcinoma category, and qualitatively what change in recurrence and disease-specific survival is expected.\n\nWhich option best reflects the correct derived conclusion?\n\nA. Noninvasive implants, lacking destructive stromal invasion, do not convert the diagnosis to carcinoma; they are recorded as serous borderline tumor with extraovarian disease, with an increased recurrence risk (e.g., $R_1 \\approx RR_R \\times R_0$) but disease-specific survival remaining high near $S_0$.\n\nB. Any peritoneal implant, regardless of invasion, represents metastatic carcinoma that upstages the tumor into low-grade serous carcinoma and sharply reduces disease-specific survival.\n\nC. Noninvasive implants are incidental and have no impact on recurrence or survival; they leave both $R_0$ and $S_0$ unchanged and do not affect staging or classification.\n\nD. Noninvasive implants mandate reclassification to carcinoma and adjuvant platinum-based chemotherapy because they markedly increase the hazard of disease-specific death.\n\nE. The presence of noninvasive implants automatically implies a micropapillary variant and therefore constitutes invasive implants by definition, converting the tumor to carcinoma.", "solution": "The user wants me to first validate the problem statement and then, if valid, derive the solution and evaluate the given options.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\nThe problem statement provides the following information:\n-   **Clinical Scenario:** A patient with an ovarian serous borderline tumor (SBT) is found to have multiple small peritoneal lesions.\n-   **Histology:** The primary ovarian mass is a serous borderline tumor. The peritoneal lesions show morphology consistent with SBT and, critically, **no destructive stromal invasion**.\n-   **Foundational Base for Reasoning:**\n    1.  **Definition of Invasion:** Carcinoma is defined by destructive stromal infiltration. Spread without such invasion is non-destructive implantation, not metastatic carcinoma.\n    2.  **Staging and Classification:** FIGO staging reflects disease distribution. The diagnosis (borderline vs. carcinoma) depends on the presence or absence of invasion.\n    3.  **Natural History:** Serous borderline tumors and low-grade serous carcinoma are related. Invasive implants are associated with progression to carcinoma and decreased survival. Noninvasive implants are associated with increased recurrence risk but not significantly decreased survival.\n-   **Quantitative Data:**\n    -   For SBT without implants: $10$-year disease-specific survival is $S_0 = 0.98$.\n    -   For SBT without implants: $10$-year recurrence probability is $R_0 = 0.10$.\n    -   For SBT with noninvasive implants: Relative risk of recurrence is $RR_R = 2.3$.\n    -   For SBT with noninvasive implants: Disease-specific survival is stated to remain \"high (near $S_0$)\".\n-   **Question:** Determine how noninvasive implants alter prognosis and classification, specifically: (1) whether they reclassify the tumor to carcinoma, and (2) the qualitative change in recurrence and survival.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is evaluated against the validation criteria:\n-   **Scientifically Grounded:** Yes. The problem is based on fundamental and current principles of gynecologic pathology, specifically the WHO classification of ovarian tumors. The distinction between invasive and noninvasive implants is a critical, well-established concept that dictates diagnosis, prognosis, and management. The provided survival and recurrence statistics are realistic for these entities.\n-   **Well-Posed:** Yes. The problem provides a clear clinical-pathological scenario and a set of explicit principles (the \"foundational base\") from which a conclusion must be logically derived. The question is specific and answerable using the information provided.\n-   **Objective:** Yes. The language is clinical, precise, and free of subjective or biased statements.\n\nThe problem does not exhibit any of the enumerated flaws (e.g., scientific unsoundness, incompleteness, ambiguity). It presents a standard reasoning task in pathology.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. The solution process will now proceed.\n\n### Derivation of Solution\n\nThe solution is derived by systematically applying the provided \"Foundational Base\" to the specific case details.\n\n1.  **Analysis of Classification:**\n    -   The \"Definition of Invasion\" principle states that a diagnosis of carcinoma requires *destructive stromal infiltration*.\n    -   The problem explicitly states that the peritoneal lesions show \"no destructive stromal invasion\".\n    -   The \"Principles of Staging and Classification\" principle states that the diagnostic category (borderline vs. carcinoma) \"rests on the presence or absence of invasion\".\n    -   **Conclusion on Classification:** Since destructive invasion is absent in the peritoneal lesions, they are classified as *noninvasive implants*. Therefore, the overall diagnosis is **not** converted to carcinoma. The tumor remains a serous borderline tumor. The presence of extraovarian disease (the implants) would, however, change the FIGO stage to reflect spread beyond the ovary (e.g., Stage II or III), but not the fundamental tumor type.\n\n2.  **Analysis of Prognosis (Recurrence and Survival):**\n    -   The \"Natural History Observations\" principle distinguishes the prognostic implications of invasive versus noninvasive implants.\n    -   For **noninvasive implants**, this principle states they are \"associated primarily with increased recurrence risk\".\n    -   The quantitative data supports this: the relative risk of recurrence is given as $RR_R = 2.3$. The baseline $10$-year recurrence probability is $R_0 = 0.10$. We can estimate the new recurrence probability, $R_1$, as $R_1 \\approx RR_R \\times R_0 = 2.3 \\times 0.10 = 0.23$. This is a substantial increase in risk (from $10\\%$ to $23\\%$).\n    -   For **noninvasive implants**, the principle also states that \"disease-specific survival remains high\". The provided data confirms this, stating survival remains \"near $S_0$,\" where $S_0 = 0.98$.\n    -   **Conclusion on Prognosis:** The presence of noninvasive implants significantly increases the probability of disease recurrence but has a minimal effect on disease-specific survival, which remains excellent.\n\n**Summary of Derived Conclusion:**\nThe presence of peritoneal lesions without destructive stromal invasion in the context of an ovarian serous borderline tumor leads to a diagnosis of *serous borderline tumor with noninvasive implants*. This finding does not change the diagnosis to carcinoma. Prognostically, it is associated with a significantly increased risk of recurrence, but disease-specific survival remains high.\n\n### Option-by-Option Analysis\n\n**A. Noninvasive implants, lacking destructive stromal invasion, do not convert the diagnosis to carcinoma; they are recorded as serous borderline tumor with extraovarian disease, with an increased recurrence risk (e.g., $R_1 \\approx RR_R \\times R_0$) but disease-specific survival remaining high near $S_0$.**\n-   **Analysis:** This option aligns perfectly with the derived conclusion. It correctly states that the diagnosis is not carcinoma due to the lack of invasion. It accurately describes the prognostic impact: increased recurrence risk (even showing the correct calculation based on the provided relative risk) and high survival near $S_0=0.98$.\n-   **Verdict:** **Correct**.\n\n**B. Any peritoneal implant, regardless of invasion, represents metastatic carcinoma that upstages the tumor into low-grade serous carcinoma and sharply reduces disease-specific survival.**\n-   **Analysis:** This statement directly contradicts the foundational principles provided. The problem is built around the crucial distinction between invasive and noninvasive implants, which this option incorrectly ignores. The problem states the lesions are noninvasive, which, by definition, are not carcinoma. It also contradicts the information that survival remains high.\n-   **Verdict:** **Incorrect**.\n\n**C. Noninvasive implants are incidental and have no impact on recurrence or survival; they leave both $R_0$ and $S_0$ unchanged and do not affect staging or classification.**\n-   **Analysis:** This is incorrect. The foundational base and quantitative data explicitly state that noninvasive implants increase the recurrence risk ($RR_R = 2.3$). While survival is largely unchanged, recurrence is not. Furthermore, the presence of extraovarian disease (the implants) affects the FIGO stage.\n-   **Verdict:** **Incorrect**.\n\n**D. Noninvasive implants mandate reclassification to carcinoma and adjuvant platinum-based chemotherapy because they markedly increase the hazard of disease-specific death.**\n-   **Analysis:** This is incorrect. Reclassification to carcinoma is incorrect, as established above. The premise that they \"markedly increase the hazard of disease-specific death\" is also false; the problem states survival remains high, near $S_0 = 0.98$. The subsequent conclusion about mandatory chemotherapy is therefore based on flawed premises.\n-   **Verdict:** **Incorrect**.\n\n**E. The presence of noninvasive implants automatically implies a micropapillary variant and therefore constitutes invasive implants by definition, converting the tumor to carcinoma.**\n-   **Analysis:** This statement contains multiple factual and logical errors. First, noninvasive implants do not automatically imply a micropapillary variant. Second, and more critically, a micropapillary pattern does not, by definition, constitute an invasive implant. An implant's status as invasive versus noninvasive is determined solely by the presence or absence of destructive stromal invasion at the implantation site, a feature the problem explicitly states is absent.\n-   **Verdict:** **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "4454342"}, {"introduction": "Modern diagnostic pathology often involves synthesizing data from multiple sources to solve complex differential diagnoses. In this exercise [@problem_id:4454383], you will tackle the classic problem of determining a tumor's origin by building a simple quantitative model based on an immunohistochemistry panel. You will implement a naive Bayes classifier to calculate the probability that an ovarian mass is a primary tumor versus a metastasis, providing a hands-on introduction to the power of probabilistic reasoning in pathology.", "problem": "You are given a binary immunohistochemistry panel consisting of CK7, CK20, CDX2, SATB2, and PAX8 for a tumor involving the ovary. You must implement a Bayesian classifier that assigns the posterior probability that the tumor is a primary ovarian surface epithelial tumor versus a gastrointestinal (GI) primary metastasis, using Bayesâ€™ theorem with the naive conditional independence assumption across markers.\n\nFundamental base:\n- Bayesâ€™ theorem for two classes states that for any observation vector $x$ and classes $C \\in \\{\\mathrm{O}, \\mathrm{G}\\}$,\n$$\nP(\\mathrm{O}\\mid x) \\;=\\; \\frac{P(\\mathrm{O}) \\, P(x \\mid \\mathrm{O})}{P(\\mathrm{O}) \\, P(x \\mid \\mathrm{O}) \\;+\\; P(\\mathrm{G}) \\, P(x \\mid \\mathrm{G})} \\,,\n$$\nwith $P(\\mathrm{G}) = 1 - P(\\mathrm{O})$ if only two classes are considered.\n- Under the naive independence assumption,\n$$\nP(x \\mid C) \\;=\\; \\prod_{i=1}^{5} P(m_i \\mid C)\\,,\n$$\nwhere $m_i$ are the individual marker outcomes.\n\nDefine the two classes:\n- $\\mathrm{O}$: Primary ovarian surface epithelial tumor (aggregating serous and mucinous lineages).\n- $\\mathrm{G}$: Gastrointestinal primary carcinoma (e.g., colorectal or appendiceal) metastatic to ovary.\n\nUse the following well-tested, biologically plausible conditional probabilities for marker positivity given class:\n- For $\\mathrm{O}$:\n  - $P(\\mathrm{CK7}^+ \\mid \\mathrm{O}) = 0.85$\n  - $P(\\mathrm{CK20}^+ \\mid \\mathrm{O}) = 0.35$\n  - $P(\\mathrm{CDX2}^+ \\mid \\mathrm{O}) = 0.15$\n  - $P(\\mathrm{SATB2}^+ \\mid \\mathrm{O}) = 0.05$\n  - $P(\\mathrm{PAX8}^+ \\mid \\mathrm{O}) = 0.80$\n- For $\\mathrm{G}$:\n  - $P(\\mathrm{CK7}^+ \\mid \\mathrm{G}) = 0.10$\n  - $P(\\mathrm{CK20}^+ \\mid \\mathrm{G}) = 0.85$\n  - $P(\\mathrm{CDX2}^+ \\mid \\mathrm{G}) = 0.90$\n  - $P(\\mathrm{SATB2}^+ \\mid \\mathrm{G}) = 0.70$\n  - $P(\\mathrm{PAX8}^+ \\mid \\mathrm{G}) = 0.02$\n\nFor a negative marker, use $P(\\mathrm{marker}^- \\mid C) = 1 - P(\\mathrm{marker}^+ \\mid C)$.\n\nInput representation for each case:\n- A parameter tuple $(p_{\\mathrm{O}}, p_{\\mathrm{G}}, \\mathrm{CK7}, \\mathrm{CK20}, \\mathrm{CDX2}, \\mathrm{SATB2}, \\mathrm{PAX8})$, where:\n  - $p_{\\mathrm{O}} = P(\\mathrm{O})$ and $p_{\\mathrm{G}} = P(\\mathrm{G})$, with $p_{\\mathrm{O}} + p_{\\mathrm{G}} = 1$.\n  - Each marker value is binary: $\\mathrm{marker} = 1$ for positive and $\\mathrm{marker} = 0$ for negative.\n\nTask:\n- For each test case, compute $P(\\mathrm{O} \\mid \\mathrm{markers})$ using Bayesâ€™ theorem and the naive independence assumption specified above.\n- Express each result as a decimal rounded to exactly four decimal places (no percentage sign).\n- No physical units are involved.\n\nTest suite (process in this order):\n1. $(0.5, 0.5, 1, 0, 0, 0, 1)$\n2. $(0.5, 0.5, 0, 1, 1, 1, 0)$\n3. $(0.5, 0.5, 1, 1, 1, 0, 0)$\n4. $(0.3, 0.7, 1, 0, 0, 0, 1)$\n5. $(0.7, 0.3, 0, 1, 1, 1, 0)$\n6. $(0.5, 0.5, 0, 0, 0, 0, 0)$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test suite, for example:\n\"[r1,r2,r3,r4,r5,r6]\"\nwhere each $r_i$ is the posterior $P(\\mathrm{O} \\mid \\mathrm{markers})$ for case $i$, rounded to four decimal places.", "solution": "The user has provided a well-defined and scientifically grounded problem. The task is to implement a naive Bayes classifier to determine the posterior probability of a tumor being of primary ovarian origin versus a gastrointestinal metastasis based on an immunohistochemistry panel.\n\n### Step 1: Problem Validation\n\nThe problem statement is validated against the required criteria.\n\n**Extracted Givens:**\n1.  **Bayes' Theorem for two classes, $\\mathrm{O}$ (Ovarian) and $\\mathrm{G}$ (Gastrointestinal):**\n    $$\n    P(\\mathrm{O}\\mid x) \\;=\\; \\frac{P(\\mathrm{O}) \\, P(x \\mid \\mathrm{O})}{P(\\mathrm{O}) \\, P(x \\mid \\mathrm{O}) \\;+\\; P(\\mathrm{G}) \\, P(x \\mid \\mathrm{G})}\n    $$\n    where $P(\\mathrm{G}) = 1 - P(\\mathrm{O})$.\n2.  **Naive Independence Assumption:** The likelihood of an observation vector $x$ (composed of marker outcomes $m_i$) is the product of individual marker probabilities:\n    $$\n    P(x \\mid C) \\;=\\; \\prod_{i=1}^{5} P(m_i \\mid C)\n    $$\n3.  **Classes:** $\\mathrm{O}$ = Primary ovarian surface epithelial tumor, $\\mathrm{G}$ = Gastrointestinal primary carcinoma metastasis.\n4.  **Conditional Probabilities for Marker Positivity ($P(\\mathrm{marker}^+ \\mid C)$):**\n    -   For Class $\\mathrm{O}$: $P(\\mathrm{CK7}^+ \\mid \\mathrm{O}) = 0.85$, $P(\\mathrm{CK20}^+ \\mid \\mathrm{O}) = 0.35$, $P(\\mathrm{CDX2}^+ \\mid \\mathrm{O}) = 0.15$, $P(\\mathrm{SATB2}^+ \\mid \\mathrm{O}) = 0.05$, $P(\\mathrm{PAX8}^+ \\mid \\mathrm{O}) = 0.80$.\n    -   For Class $\\mathrm{G}$: $P(\\mathrm{CK7}^+ \\mid \\mathrm{G}) = 0.10$, $P(\\mathrm{CK20}^+ \\mid \\mathrm{G}) = 0.85$, $P(\\mathrm{CDX2}^+ \\mid \\mathrm{G}) = 0.90$, $P(\\mathrm{SATB2}^+ \\mid \\mathrm{G}) = 0.70$, $P(\\mathrm{PAX8}^+ \\mid \\mathrm{G}) = 0.02$.\n5.  **Conditional Probability for Marker Negativity:** $P(\\mathrm{marker}^- \\mid C) = 1 - P(\\mathrm{marker}^+ \\mid C)$.\n6.  **Input Format:** A tuple $(p_{\\mathrm{O}}, p_{\\mathrm{G}}, \\mathrm{CK7}, \\mathrm{CK20}, \\mathrm{CDX2}, \\mathrm{SATB2}, \\mathrm{PAX8})$, where $p_{\\mathrm{O}} = P(\\mathrm{O})$, $p_{\\mathrm{G}} = P(\\mathrm{G})$, and marker values are $1$ for positive and $0$ for negative.\n7.  **Task:** Compute $P(\\mathrm{O} \\mid \\mathrm{markers})$ rounded to four decimal places.\n8.  **Test Suite:**\n    1.  $(0.5, 0.5, 1, 0, 0, 0, 1)$\n    2.  $(0.5, 0.5, 0, 1, 1, 1, 0)$\n    3.  $(0.5, 0.5, 1, 1, 1, 0, 0)$\n    4.  $(0.3, 0.7, 1, 0, 0, 0, 1)$\n    5.  $(0.7, 0.3, 0, 1, 1, 1, 0)$\n    6.  $(0.5, 0.5, 0, 0, 0, 0, 0)$\n\n**Validation Verdict:**\nThe problem is **valid**.\n-   It is **scientifically grounded**: It uses Bayes' theorem, a fundamental principle of probability theory, and applies it to a realistic classification problem in surgical pathology. The immunohistochemical markers and their general expression patterns are biologically plausible for the specified tumor types.\n-   It is **well-posed**: All necessary information is provided, including prior probabilities (for each test case), conditional probabilities (likelihoods), and a clear objective function. The formulas are explicit, ensuring a unique solution for each case.\n-   It is **objective**: The problem is defined with precise quantitative data and mathematical instructions, free of ambiguity or subjective elements.\n-   It does not violate any of the invalidity criteria. The setup is complete, consistent, and formalizable.\n\n### Step 2: Solution Derivation\n\nThe goal is to compute the posterior probability $P(\\mathrm{O} \\mid x)$ for a given set of marker observations $x$. The observation vector $x$ for the $5$ markers can be represented as $x = (x_1, x_2, x_3, x_4, x_5)$, where $x_i \\in \\{0, 1\\}$ corresponds to the outcome of the $i$-th marker (CK7, CK20, CDX2, SATB2, PAX8, in order).\n\nThe core of the calculation is Bayes' theorem:\n$$\nP(\\mathrm{O} \\mid x) = \\frac{P(\\mathrm{O}) P(x \\mid \\mathrm{O})}{P(x)}\n$$\nThe term $P(x)$ is the marginal probability of observing $x$, also known as the evidence. Using the law of total probability, it can be expanded over the two classes:\n$$\nP(x) = P(x \\mid \\mathrm{O}) P(\\mathrm{O}) + P(x \\mid \\mathrm{G}) P(\\mathrm{G})\n$$\nSubstituting this into Bayes' theorem gives the full form provided in the problem statement:\n$$\nP(\\mathrm{O} \\mid x) = \\frac{P(\\mathrm{O}) P(x \\mid \\mathrm{O})}{P(\\mathrm{O}) P(x \\mid \\mathrm{O}) + P(\\mathrm{G}) P(x \\mid \\mathrm{G})}\n$$\nThe terms $P(\\mathrm{O})$ and $P(\\mathrm{G})$ are the prior probabilities, given for each test case. The crucial components to calculate are the class-conditional likelihoods, $P(x \\mid \\mathrm{O})$ and $P(x \\mid \\mathrm{G})$.\n\nUnder the naive independence assumption, the likelihood is the product of the probabilities of each individual marker observation given the class:\n$$\nP(x \\mid C) = \\prod_{i=1}^{5} P(x_i \\mid C)\n$$\nwhere $C \\in \\{\\mathrm{O}, \\mathrm{G}\\}$. The probability for an individual marker observation $x_i$ is determined by its status:\n-   If marker $i$ is positive ($x_i=1$), we use $P(x_i=1 \\mid C) = P(\\text{marker}_i^+ \\mid C)$.\n-   If marker $i$ is negative ($x_i=0$), we use $P(x_i=0 \\mid C) = P(\\text{marker}_i^- \\mid C) = 1 - P(\\text{marker}_i^+ \\mid C)$.\n\nLet us define the conditional probability of positivity for marker $i$ in class $C$ as $\\theta_{i,C} = P(\\text{marker}_i^+ \\mid C})$. Then the probability of observing $x_i$ is:\n$$\nP(x_i \\mid C) = (\\theta_{i,C})^{x_i} (1 - \\theta_{i,C})^{1-x_i}\n$$\nThe full likelihood for class $C$ is therefore:\n$$\nP(x \\mid C) = \\prod_{i=1}^{5} \\left[ (\\theta_{i,C})^{x_i} (1 - \\theta_{i,C})^{1-x_i} \\right]\n$$\n\nLet's demonstrate with Test Case 1: $(0.5, 0.5, 1, 0, 0, 0, 1)$.\n-   Priors: $P(\\mathrm{O}) = 0.5$, $P(\\mathrm{G}) = 0.5$.\n-   Observation vector $x = (1, 0, 0, 0, 1)$, corresponding to CK7$^+$, CK20$^-$, CDX2$^-$, SATB2$^-$, PAX8$^+$.\n\nFirst, calculate the likelihood $P(x \\mid \\mathrm{O})$:\n$P(x \\mid \\mathrm{O}) = P(\\mathrm{CK7}=1 \\mid \\mathrm{O}) \\times P(\\mathrm{CK20}=0 \\mid \\mathrm{O}) \\times P(\\mathrm{CDX2}=0 \\mid \\mathrm{O}) \\times P(\\mathrm{SATB2}=0 \\mid \\mathrm{O}) \\times P(\\mathrm{PAX8}=1 \\mid \\mathrm{O})$\n$P(x \\mid \\mathrm{O}) = P(\\mathrm{CK7}^+ \\mid \\mathrm{O}) \\times (1 - P(\\mathrm{CK20}^+ \\mid \\mathrm{O})) \\times (1 - P(\\mathrm{CDX2}^+ \\mid \\mathrm{O})) \\times (1 - P(\\mathrm{SATB2}^+ \\mid \\mathrm{O})) \\times P(\\mathrm{PAX8}^+ \\mid \\mathrm{O})$\n$P(x \\mid \\mathrm{O}) = 0.85 \\times (1 - 0.35) \\times (1 - 0.15) \\times (1 - 0.05) \\times 0.80$\n$P(x \\mid \\mathrm{O}) = 0.85 \\times 0.65 \\times 0.85 \\times 0.95 \\times 0.80 = 0.356405$\n\nNext, calculate the likelihood $P(x \\mid \\mathrm{G})$:\n$P(x \\mid \\mathrm{G}) = P(\\mathrm{CK7}=1 \\mid \\mathrm{G}) \\times P(\\mathrm{CK20}=0 \\mid \\mathrm{G}) \\times P(\\mathrm{CDX2}=0 \\mid \\mathrm{G}) \\times P(\\mathrm{SATB2}=0 \\mid \\mathrm{G}) \\times P(\\mathrm{PAX8}=1 \\mid \\mathrm{G})$\n$P(x \\mid \\mathrm{G}) = P(\\mathrm{CK7}^+ \\mid \\mathrm{G}) \\times (1 - P(\\mathrm{CK20}^+ \\mid \\mathrm{G})) \\times (1 - P(\\mathrm{CDX2}^+ \\mid \\mathrm{G})) \\times (1 - P(\\mathrm{SATB2}^+ \\mid \\mathrm{G})) \\times P(\\mathrm{PAX8}^+ \\mid \\mathrm{G})$\n$P(x \\mid \\mathrm{G}) = 0.10 \\times (1 - 0.85) \\times (1 - 0.90) \\times (1 - 0.70) \\times 0.02$\n$P(x \\mid \\mathrm{G}) = 0.10 \\times 0.15 \\times 0.10 \\times 0.30 \\times 0.02 = 0.000009$\n\nNow, substitute these values into the posterior probability formula:\nLet $N_\\mathrm{O} = P(\\mathrm{O}) P(x \\mid \\mathrm{O}) = 0.5 \\times 0.356405 = 0.1782025$.\nLet $N_\\mathrm{G} = P(\\mathrm{G}) P(x \\mid \\mathrm{G}) = 0.5 \\times 0.000009 = 0.0000045$.\n$$\nP(\\mathrm{O} \\mid x) = \\frac{N_\\mathrm{O}}{N_\\mathrm{O} + N_\\mathrm{G}} = \\frac{0.1782025}{0.1782025 + 0.0000045} = \\frac{0.1782025}{0.178207} \\approx 0.99997475...\n$$\nRounding to four decimal places, the result is $1.0000$.\n\nThis exact procedure is systematically applied to each of the test cases provided in the problem statement. The implementation will store the conditional probabilities and iterate through each test case, calculating the likelihoods and the final posterior probability, then formatting the result as specified.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a naive Bayes classifier to determine the posterior probability\n    of a tumor being a primary ovarian surface epithelial tumor versus a \n    gastrointestinal metastasis based on an immunohistochemistry panel.\n    \"\"\"\n\n    # Conditional probabilities P(marker_positive | Class)\n    # These are the well-tested, biologically plausible values given.\n    cond_probs = {\n        'O': { # Primary Ovarian Surface Epithelial Tumor\n            'CK7': 0.85, 'CK20': 0.35, 'CDX2': 0.15, 'SATB2': 0.05, 'PAX8': 0.80\n        },\n        'G': { # Gastrointestinal Primary Carcinoma Metastasis\n            'CK7': 0.10, 'CK20': 0.85, 'CDX2': 0.90, 'SATB2': 0.70, 'PAX8': 0.02\n        }\n    }\n    \n    # The order of markers in the test cases must match this list.\n    marker_names = ['CK7', 'CK20', 'CDX2', 'SATB2', 'PAX8']\n\n    # Test suite provided in the problem statement.\n    # Format: (prior_O, prior_G, CK7, CK20, CDX2, SATB2, PAX8)\n    test_cases = [\n        (0.5, 0.5, 1, 0, 0, 0, 1),\n        (0.5, 0.5, 0, 1, 1, 1, 0),\n        (0.5, 0.5, 1, 1, 1, 0, 0),\n        (0.3, 0.7, 1, 0, 0, 0, 1),\n        (0.7, 0.3, 0, 1, 1, 1, 0),\n        (0.5, 0.5, 0, 0, 0, 0, 0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        prior_o, prior_g, *observations = case\n        \n        # Calculate likelihood P(x | C) for each class C in {O, G}\n        # P(x | C) = product[ P(marker_i | C) for i=1 to 5 ]\n        \n        # Likelihood for class O (Ovarian)\n        likelihood_terms_o = []\n        for i, status in enumerate(observations):\n            marker = marker_names[i]\n            prob_pos = cond_probs['O'][marker]\n            if status == 1: # Marker is positive\n                likelihood_terms_o.append(prob_pos)\n            else: # Marker is negative (status == 0)\n                likelihood_terms_o.append(1.0 - prob_pos)\n        likelihood_o = np.prod(likelihood_terms_o)\n\n        # Likelihood for class G (Gastrointestinal)\n        likelihood_terms_g = []\n        for i, status in enumerate(observations):\n            marker = marker_names[i]\n            prob_pos = cond_probs['G'][marker]\n            if status == 1: # Marker is positive\n                likelihood_terms_g.append(prob_pos)\n            else: # Marker is negative (status == 0)\n                likelihood_terms_g.append(1.0 - prob_pos)\n        likelihood_g = np.prod(likelihood_terms_g)\n\n        # Calculate the posterior probability P(O | x) using Bayes' theorem\n        # P(O | x) = (P(O) * P(x | O)) / (P(O) * P(x | O) + P(G) * P(x | G))\n        numerator = prior_o * likelihood_o\n        evidence = (prior_o * likelihood_o) + (prior_g * likelihood_g)\n        \n        # Guard against division by zero, though not expected with these probabilities.\n        if evidence == 0.0:\n            # If evidence is zero, the observation is impossible under the model.\n            # The posterior is ill-defined. We can default to the prior or 0.5.\n            # Given the problem's probabilities are all > 0 and < 1, this won't happen.\n            posterior_o = prior_o\n        else:\n            posterior_o = numerator / evidence\n\n        # Format the result to exactly four decimal places and append.\n        results.append(f\"{posterior_o:.4f}\")\n\n    # Print the final output in the specified format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4454383"}]}