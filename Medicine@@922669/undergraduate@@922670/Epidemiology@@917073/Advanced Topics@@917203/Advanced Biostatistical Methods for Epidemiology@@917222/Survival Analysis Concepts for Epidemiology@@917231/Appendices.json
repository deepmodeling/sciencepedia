{"hands_on_practices": [{"introduction": "The Kaplan-Meier estimator is a cornerstone of survival analysis, allowing us to estimate the survival function directly from time-to-event data, even when some observations are censored. This exercise provides fundamental practice in calculating the Kaplan-Meier survival curve step-by-step and quantifying its uncertainty using Greenwood's formula. Mastering this technique is the first step toward analyzing time-to-event outcomes. [@problem_id:4640253]", "problem": "An investigator is studying time to a clinical event in an infectious disease cohort under right censoring. The survival time $T$ is defined as the time from study entry to the first observed event. The survival function is $S(t) = \\Pr(T > t)$. Assume non-informative right censoring and independent survival times across participants. The product-limit estimator, also known as the Kaplan–Meier (KM) estimator, is used to estimate $S(t)$ from event and censoring times. When events and censorings are recorded at the same time, treat events as occurring before censorings at that time.\n\nA small dataset of $12$ participants is observed, each with a single time (in months) and an indicator for whether that time is an event ($\\delta = 1$) or a right censoring ($\\delta = 0$):\n- Participant $1$: time $2$, $\\delta = 1$\n- Participant $2$: time $3$, $\\delta = 0$\n- Participant $3$: time $4$, $\\delta = 1$\n- Participant $4$: time $5$, $\\delta = 1$\n- Participant $5$: time $6$, $\\delta = 0$\n- Participant $6$: time $7$, $\\delta = 1$\n- Participant $7$: time $8$, $\\delta = 1$\n- Participant $8$: time $9$, $\\delta = 0$\n- Participant $9$: time $10$, $\\delta = 1$\n- Participant $10$: time $12$, $\\delta = 1$\n- Participant $11$: time $12$, $\\delta = 0$\n- Participant $12$: time $15$, $\\delta = 0$\n\nUsing the Kaplan–Meier estimator, compute $\\widehat{S}(t)$ at the selected times $t \\in \\{3, 6, 9, 12\\}$ months. Then, using Greenwood’s formula for the variance of the Kaplan–Meier estimator, compute the standard error of $\\widehat{S}(12)$.\n\nRound your final answer to four significant figures. Express the final answer as a decimal with no units.", "solution": "The survival function is $S(t) = \\Pr(T > t)$, defined for nonnegative time $t$. Under independent survival times and non-informative right censoring, the Kaplan–Meier estimator $\\widehat{S}(t)$ is obtained from the product of estimated conditional survival probabilities at each distinct event time, based on risk sets. Let the distinct event times be $\\{t_{(1)}, t_{(2)}, \\dots\\}$, and at each event time $t_{(j)}$ let $n_j$ be the number at risk immediately before $t_{(j)}$ and $d_j$ the number of events at $t_{(j)}$; then the product-limit estimate is\n$$\n\\widehat{S}(t) \\;=\\; \\prod_{j: t_{(j)} \\le t} \\left(1 - \\frac{d_j}{n_j}\\right) \\;=\\; \\prod_{j: t_{(j)} \\le t} \\frac{n_j - d_j}{n_j}.\n$$\nUnder right censoring, individuals who are censored at time $c$ contribute to the risk set up to time $c$, but not beyond; if events and censorings occur at the same time, events are processed before censorings for risk set accounting.\n\nWe first sort the observed times and identify distinct event times and risk sets. The event times are\n$$\n2, \\; 4, \\; 5, \\; 7, \\; 8, \\; 10, \\; 12,\n$$\nwith one event at each of these times. The censoring times are\n$$\n3, \\; 6, \\; 9, \\; 12, \\; 15.\n$$\nThere are $12$ participants initially at risk.\n\nWe compute $n_j$ and $d_j$ in chronological order (events occur before censorings at tied times):\n- At time $2$: $n_1 = 12$, $d_1 = 1$. After the event, $11$ remain.\n- At time $3$ (censoring): $11 \\to 10$ remain after censoring.\n- At time $4$: $n_2 = 10$, $d_2 = 1$. After the event, $9$ remain.\n- At time $5$: $n_3 = 9$, $d_3 = 1$. After the event, $8$ remain.\n- At time $6$ (censoring): $8 \\to 7$ remain.\n- At time $7$: $n_4 = 7$, $d_4 = 1$. After the event, $6$ remain.\n- At time $8$: $n_5 = 6$, $d_5 = 1$. After the event, $5$ remain.\n- At time $9$ (censoring): $5 \\to 4$ remain.\n- At time $10$: $n_6 = 4$, $d_6 = 1$. After the event, $3$ remain.\n- At time $12$: events before censoring at the same time, so $n_7 = 3$, $d_7 = 1$; after the event, $2$ remain, then the censor at time $12$ reduces to $1$ remain.\n- At time $15$ (censoring): $1 \\to 0$ remain.\n\nThus, the pairs $(n_j, d_j)$ at event times are\n$$\n(12,1),\\; (10,1),\\; (9,1),\\; (7,1),\\; (6,1),\\; (4,1),\\; (3,1).\n$$\n\nCompute $\\widehat{S}(t)$ at the selected times $t \\in \\{3,6,9,12\\}$ months by multiplying the corresponding terms up to time $t$:\n- For $t = 3$: only time $2$ contributes,\n$$\n\\widehat{S}(3) \\;=\\; \\frac{12 - 1}{12} \\;=\\; \\frac{11}{12}.\n$$\n- For $t = 6$: times $2,4,5$ contribute,\n$$\n\\widehat{S}(6) \\;=\\; \\frac{11}{12} \\cdot \\frac{10 - 1}{10} \\cdot \\frac{9 - 1}{9}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{9}{10} \\cdot \\frac{8}{9}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{8}{10}\n\\;=\\; \\frac{11}{15}.\n$$\n- For $t = 9$: times $2,4,5,7,8$ contribute,\n$$\n\\widehat{S}(9) \\;=\\; \\frac{11}{12} \\cdot \\frac{9}{10} \\cdot \\frac{8}{9} \\cdot \\frac{7 - 1}{7} \\cdot \\frac{6 - 1}{6}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{8}{10} \\cdot \\frac{6}{7} \\cdot \\frac{5}{6}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{4}{5} \\cdot \\frac{5}{7}\n\\;=\\; \\frac{11}{12} \\cdot \\frac{4}{7}\n\\;=\\; \\frac{11}{21}.\n$$\n- For $t = 12$: times $2,4,5,7,8,10,12$ contribute,\n$$\n\\widehat{S}(12) \\;=\\; \\widehat{S}(9) \\cdot \\frac{4 - 1}{4} \\cdot \\frac{3 - 1}{3}\n\\;=\\; \\frac{11}{21} \\cdot \\frac{3}{4} \\cdot \\frac{2}{3}\n\\;=\\; \\frac{11}{21} \\cdot \\frac{1}{2}\n\\;=\\; \\frac{11}{42}.\n$$\n\nTo compute the standard error at $t = 12$ using Greenwood’s formula, we use the well-tested variance estimator for the product-limit estimator:\n$$\n\\widehat{\\mathrm{Var}}\\!\\left(\\widehat{S}(t)\\right) \\;=\\; \\widehat{S}(t)^{2} \\sum_{j: t_{(j)} \\le t} \\frac{d_j}{n_j \\left(n_j - d_j\\right)}.\n$$\nHere, $d_j = 1$ at each event time, so for $t = 12$ the sum is\n$$\n\\sum_{j} \\frac{1}{n_j \\left(n_j - 1\\right)} \\;=\\; \\frac{1}{12 \\cdot 11} \\;+\\; \\frac{1}{10 \\cdot 9} \\;+\\; \\frac{1}{9 \\cdot 8} \\;+\\; \\frac{1}{7 \\cdot 6} \\;+\\; \\frac{1}{6 \\cdot 5} \\;+\\; \\frac{1}{4 \\cdot 3} \\;+\\; \\frac{1}{3 \\cdot 2}.\n$$\nEvaluating each term and summing exactly,\n$$\n\\frac{1}{132} \\;+\\; \\frac{1}{90} \\;+\\; \\frac{1}{72} \\;+\\; \\frac{1}{42} \\;+\\; \\frac{1}{30} \\;+\\; \\frac{1}{12} \\;+\\; \\frac{1}{6}\n\\;=\\; \\frac{3139}{9240}.\n$$\nThus,\n$$\n\\widehat{\\mathrm{Var}}\\!\\left(\\widehat{S}(12)\\right)\n\\;=\\; \\left(\\frac{11}{42}\\right)^{2} \\cdot \\frac{3139}{9240}\n\\;=\\; \\frac{121}{1764} \\cdot \\frac{3139}{9240}\n\\;=\\; \\frac{379819}{16299360}.\n$$\nThe Greenwood standard error is the square root of the variance:\n$$\n\\widehat{\\mathrm{SE}}\\!\\left(\\widehat{S}(12)\\right)\n\\;=\\; \\sqrt{\\frac{379819}{16299360}}.\n$$\nNumerically,\n$$\n\\frac{379819}{16299360} \\approx 0.02330168,\n$$\nso\n$$\n\\sqrt{0.02330168} \\approx 0.15265.\n$$\nRounded to four significant figures, the standard error is $0.1527$.", "answer": "$$\\boxed{0.1527}$$", "id": "4640253"}, {"introduction": "Real-world cohort studies often involve staggered enrollment, leading to left-truncated data where subjects are not observed from time zero. This practice demonstrates the critical importance of correctly adjusting the risk set for this delayed entry, as ignoring it can lead to significant bias in survival estimates. By comparing a properly adjusted Kaplan-Meier curve to a naive one, you will gain a concrete understanding of this crucial concept. [@problem_id:4640230]", "problem": "An epidemiologic cohort study of patients diagnosed with a chronic condition aims to estimate the survival function since diagnosis in months, allowing for delayed entry due to staggered enrollment. Individuals are observed only after they enroll; hence survival times are subject to left truncation (delayed entry). Under independent right censoring and independent delayed entry, the survival function $S(t)$ is defined as the probability that the event time $T$ exceeds $t$, and the Kaplan–Meier (KM) estimator is the nonparametric maximum likelihood estimator constructed from conditional survival across distinct event times using the appropriate risk sets.\n\nYou are given a small dataset with $8$ individuals. For each individual $i$, the entry time since diagnosis is $L_i$ (months), the observed time is $O_i$ (months), and the event indicator is $\\delta_i$ ($\\delta_i = 1$ for death at time $O_i$; $\\delta_i = 0$ for right censoring at time $O_i$). The data are:\n\n- Individual $1$: $L_1 = 0$, $O_1 = 5$, $\\delta_1 = 1$.\n- Individual $2$: $L_2 = 3$, $O_2 = 10$, $\\delta_2 = 0$.\n- Individual $3$: $L_3 = 2$, $O_3 = 8$, $\\delta_3 = 1$.\n- Individual $4$: $L_4 = 6$, $O_4 = 12$, $\\delta_4 = 1$.\n- Individual $5$: $L_5 = 0$, $O_5 = 7$, $\\delta_5 = 0$.\n- Individual $6$: $L_6 = 9$, $O_6 = 15$, $\\delta_6 = 1$.\n- Individual $7$: $L_7 = 4$, $O_7 = 11$, $\\delta_7 = 1$.\n- Individual $8$: $L_8 = 1$, $O_8 = 14$, $\\delta_8 = 0$.\n\nCompute the KM estimate of the survival function at $t = 12$ months in two ways:\n\n$1.$ The correctly left-truncated KM, in which the risk set at each event time includes only those individuals who have entered the study strictly before that event time and have not previously experienced the event or censoring.\n\n$2.$ A naive KM that ignores left truncation, in which all individuals are treated as if they were under observation from time $0$ regardless of their actual entry times, and the risk set at each event time includes all individuals with observed time at least that event time who have not previously experienced the event or censoring.\n\nUsing these two constructions, compute the difference $S_{\\text{LT}}(12) - S_{\\text{naive}}(12)$ as a single exact value. Express your final answer as a single number or a single closed-form analytic expression without units. No rounding is required.", "solution": "The user wants me to validate and solve a problem from the field of survival analysis in epidemiology.\n\n### Step 1: Extract Givens\nThe problem provides the following information:\n- A cohort study with $8$ individuals.\n- For each individual $i=1, \\dots, 8$:\n    - $L_i$: entry time since diagnosis (months).\n    - $O_i$: observed time since diagnosis (months).\n    - $\\delta_i$: event indicator, where $\\delta_i = 1$ for death and $\\delta_i = 0$ for right censoring.\n- The dataset is as follows:\n    - Individual $1$: $L_1 = 0$, $O_1 = 5$, $\\delta_1 = 1$.\n    - Individual $2$: $L_2 = 3$, $O_2 = 10$, $\\delta_2 = 0$.\n    - Individual $3$: $L_3 = 2$, $O_3 = 8$, $\\delta_3 = 1$.\n    - Individual $4$: $L_4 = 6$, $O_4 = 12$, $\\delta_4 = 1$.\n    - Individual $5$: $L_5 = 0$, $O_5 = 7$, $\\delta_5 = 0$.\n    - Individual $6$: $L_6 = 9$, $O_6 = 15$, $\\delta_6 = 1$.\n    - Individual $7$: $L_7 = 4$, $O_7 = 11$, $\\delta_7 = 1$.\n    - Individual $8$: $L_8 = 1$, $O_8 = 14$, $\\delta_8 = 0$.\n- The task is to compute the Kaplan-Meier (KM) estimate of the survival function $S(t)$ at $t=12$ months in two ways:\n    1.  $S_{\\text{LT}}(12)$: A left-truncated KM estimate, where the risk set at an event time $t_j$ includes individuals $i$ who have entered the study strictly before $t_j$ ($L_i  t_j$) and have not yet been observed to have an event or be censored ($O_i \\geq t_j$).\n    2.  $S_{\\text{naive}}(12)$: A naive KM estimate that ignores left truncation, where the risk set at an event time $t_j$ includes all individuals $i$ whose observed time is at least $t_j$ ($O_i \\geq t_j$).\n- The final goal is to compute the difference $S_{\\text{LT}}(12) - S_{\\text{naive}}(12)$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is based on the Kaplan-Meier estimator, left truncation, and right censoring, which are fundamental and well-established concepts in survival analysis, a core topic in biostatistics and epidemiology. The setup is scientifically sound.\n2.  **Well-Posed**: The data is provided, the methods for constructing the risk sets are explicitly defined for both estimators, and the target calculation is a specific numerical value. This structure allows for a unique and meaningful solution.\n3.  **Objective**: The problem is stated in precise, technical language, free from subjectivity or ambiguity.\n4.  **Completeness**: All necessary data and definitions ($L_i, O_i, \\delta_i$ for all individuals, rules for risk sets) are provided to perform the required calculations.\n5.  **Realism**: The data represents a small but plausible scenario for a clinical or epidemiological study with staggered patient enrollment.\n6.  **No other flaws**: The problem does not contain contradictions, circular reasoning, or any other listed flaws.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution.\n\nThe Kaplan-Meier product-limit estimator for the survival function $S(t)$ is given by the formula:\n$$ \\hat{S}(t) = \\prod_{j: t_j \\leq t} \\left(1 - \\frac{d_j}{n_j}\\right) $$\nwhere $t_j$ are the distinct event times, $d_j$ is the number of events (deaths) at time $t_j$, and $n_j$ is the number of individuals in the risk set just before time $t_j$. We need to compute this for $t=12$.\n\nFirst, we identify the distinct event times from the data. Events correspond to $\\delta_i=1$.\n- Individual $1$: event at $O_1 = 5$ months.\n- Individual $3$: event at $O_3 = 8$ months.\n- Individual $4$: event at $O_4 = 12$ months.\n- Individual $6$: event at $O_6 = 15$ months.\n- Individual $7$: event at $O_7 = 11$ months.\nThe ordered, distinct event times are $t_1=5$, $t_2=8$, $t_3=11$, $t_4=12$, and $t_5=15$. To compute the survival function at $t=12$, we need to consider all event times up to and including $12$: $5$, $8$, $11$, and $12$. At each of these times, one event occurred, so $d_j=1$ for $j=1, 2, 3, 4$.\n\n**1. Calculation of the Left-Truncated KM Estimate, $S_{\\text{LT}}(12)$**\nThe risk set $R(t_j)$ at an event time $t_j$ consists of individuals $i$ who have entered the study ($L_i  t_j$) and are still under observation ($O_i \\geq t_j$). The size of the risk set is $n_j = |R(t_j)|$.\n\n- **At event time $t_1 = 5$**:\nThe risk set $R(5)$ includes individuals with $L_i  5$ and $O_i \\geq 5$.\nIndividuals at risk:\n  - $1$: $L_1=0  5$, $O_1=5 \\geq 5$ (Yes)\n  - $2$: $L_2=3  5$, $O_2=10 \\geq 5$ (Yes)\n  - $3$: $L_3=2  5$, $O_3=8 \\geq 5$ (Yes)\n  - $4$: $L_4=6 \\nless 5$ (No)\n  - $5$: $L_5=0  5$, $O_5=7 \\geq 5$ (Yes)\n  - $6$: $L_6=9 \\nless 5$ (No)\n  - $7$: $L_7=4  5$, $O_7=11 \\geq 5$ (Yes)\n  - $8$: $L_8=1  5$, $O_8=14 \\geq 5$ (Yes)\nThe number of individuals at risk is $n_1 = 6$. The number of events is $d_1 = 1$. The survival probability factor is $(1 - \\frac{1}{6}) = \\frac{5}{6}$.\n\n- **At event time $t_2 = 8$**:\nThe risk set $R(8)$ includes individuals with $L_i  8$ and $O_i \\geq 8$.\nIndividuals at risk:\n  - $2$: $L_2=3  8$, $O_2=10 \\geq 8$ (Yes)\n  - $3$: $L_3=2  8$, $O_3=8 \\geq 8$ (Yes)\n  - $4$: $L_4=6  8$, $O_4=12 \\geq 8$ (Yes)\n  - $6$: $L_6=9 \\nless 8$ (No)\n  - $7$: $L_7=4  8$, $O_7=11 \\geq 8$ (Yes)\n  - $8$: $L_8=1  8$, $O_8=14 \\geq 8$ (Yes)\nIndividuals $1$ and $5$ are no longer at risk ($O_1=58$, $O_5=78$). The number of individuals at risk is $n_2 = 5$. The number of events is $d_2 = 1$. The survival probability factor is $(1 - \\frac{1}{5}) = \\frac{4}{5}$.\n\n- **At event time $t_3 = 11$**:\nThe risk set $R(11)$ includes individuals with $L_i  11$ and $O_i \\geq 11$.\nIndividuals at risk:\n  - $4$: $L_4=6  11$, $O_4=12 \\geq 11$ (Yes)\n  - $6$: $L_6=9  11$, $O_6=15 \\geq 11$ (Yes)\n  - $7$: $L_7=4  11$, $O_7=11 \\geq 11$ (Yes)\n  - $8$: $L_8=1  11$, $O_8=14 \\geq 11$ (Yes)\nIndividuals $2$ and $3$ are now also no longer at risk ($O_2=1011$, $O_3=811$). The number of individuals at risk is $n_3 = 4$. The number of events is $d_3 = 1$. The survival probability factor is $(1 - \\frac{1}{4}) = \\frac{3}{4}$.\n\n- **At event time $t_4 = 12$**:\nThe risk set $R(12)$ includes individuals with $L_i  12$ and $O_i \\geq 12$.\nIndividuals at risk:\n  - $4$: $L_4=6  12$, $O_4=12 \\geq 12$ (Yes)\n  - $6$: $L_6=9  12$, $O_6=15 \\geq 12$ (Yes)\n  - $8$: $L_8=1  12$, $O_8=14 \\geq 12$ (Yes)\nIndividual $7$ is no longer at risk ($O_7=1112$). The number of individuals at risk is $n_4 = 3$. The number of events is $d_4 = 1$. The survival probability factor is $(1 - \\frac{1}{3}) = \\frac{2}{3}$.\n\nThe left-truncated KM estimate at $t=12$ is the product of these factors:\n$$ \\hat{S}_{\\text{LT}}(12) = \\left(1-\\frac{1}{6}\\right) \\left(1-\\frac{1}{5}\\right) \\left(1-\\frac{1}{4}\\right) \\left(1-\\frac{1}{3}\\right) = \\frac{5}{6} \\times \\frac{4}{5} \\times \\frac{3}{4} \\times \\frac{2}{3} $$\nThis is a telescoping product:\n$$ \\hat{S}_{\\text{LT}}(12) = \\frac{\\cancel{5}}{6} \\times \\frac{\\cancel{4}}{\\cancel{5}} \\times \\frac{\\cancel{3}}{\\cancel{4}} \\times \\frac{2}{\\cancel{3}} = \\frac{2}{6} = \\frac{1}{3} $$\n\n**2. Calculation of the Naive KM Estimate, $S_{\\text{naive}}(12)$**\nThe naive risk set $R(t_j)$ at an event time $t_j$ includes all individuals $i$ who are still under observation ($O_i \\geq t_j$), ignoring the entry times $L_i$.\n\n- **At event time $t_1 = 5$**:\nThe risk set $R(5)$ includes individuals with $O_i \\geq 5$. All $8$ individuals have $O_i \\geq 5$.\n$n_1 = 8$, $d_1 = 1$. The factor is $(1 - \\frac{1}{8}) = \\frac{7}{8}$.\n\n- **At event time $t_2 = 8$**:\nThe risk set $R(8)$ includes individuals with $O_i \\geq 8$. Individuals $1$ ($O_1=58$) and $5$ ($O_5=78$) are excluded.\n$n_2 = 8 - 2 = 6$. $d_2 = 1$. The factor is $(1 - \\frac{1}{6}) = \\frac{5}{6}$.\n\n- **At event time $t_3 = 11$**:\nThe risk set $R(11)$ includes individuals with $O_i \\geq 11$. Individuals $2$ ($O_2=1011$) and $3$ ($O_3=811$) are now also excluded.\n$n_3 = 6 - 2 = 4$. $d_3 = 1$. The factor is $(1 - \\frac{1}{4}) = \\frac{3}{4}$.\n\n- **At event time $t_4 = 12$**:\nThe risk set $R(12)$ includes individuals with $O_i \\geq 12$. Individual $7$ ($O_7=1112$) is now also excluded.\n$n_4 = 4 - 1 = 3$. $d_4 = 1$. The factor is $(1 - \\frac{1}{3}) = \\frac{2}{3}$.\n\nThe naive KM estimate at $t=12$ is the product of these factors:\n$$ \\hat{S}_{\\text{naive}}(12) = \\left(1-\\frac{1}{8}\\right) \\left(1-\\frac{1}{6}\\right) \\left(1-\\frac{1}{4}\\right) \\left(1-\\frac{1}{3}\\right) = \\frac{7}{8} \\times \\frac{5}{6} \\times \\frac{3}{4} \\times \\frac{2}{3} $$\n$$ \\hat{S}_{\\text{naive}}(12) = \\frac{7 \\times 5 \\times 3 \\times 2}{8 \\times 6 \\times 4 \\times 3} = \\frac{210}{576} $$\nSimplifying the fraction:\n$$ \\hat{S}_{\\text{naive}}(12) = \\frac{7}{8} \\times \\frac{5}{6} \\times \\frac{3 \\times 2}{4 \\times 3} = \\frac{7}{8} \\times \\frac{5}{6} \\times \\frac{1}{2} = \\frac{35}{96} $$\n\n**3. Compute the Difference**\nThe final step is to calculate the difference $S_{\\text{LT}}(12) - S_{\\text{naive}}(12)$.\n$$ S_{\\text{LT}}(12) - S_{\\text{naive}}(12) = \\frac{1}{3} - \\frac{35}{96} $$\nTo subtract, we find a common denominator, which is $96$.\n$$ \\frac{1}{3} = \\frac{1 \\times 32}{3 \\times 32} = \\frac{32}{96} $$\nSo, the difference is:\n$$ \\frac{32}{96} - \\frac{35}{96} = \\frac{32 - 35}{96} = -\\frac{3}{96} $$\nThis fraction can be simplified by dividing the numerator and denominator by $3$:\n$$ -\\frac{3 \\div 3}{96 \\div 3} = -\\frac{1}{32} $$\nThe difference is $-\\frac{1}{32}$.", "answer": "$$\\boxed{-\\frac{1}{32}}$$", "id": "4640230"}, {"introduction": "The Cox proportional hazards model is a powerful tool, but its validity hinges on the proportional hazards assumption—that the effect of a covariate is constant over time. This exercise introduces Schoenfeld residuals, a key diagnostic tool for formally testing this assumption. By calculating these residuals and examining their relationship with time, you will learn a fundamental skill in model validation. [@problem_id:4640222]", "problem": "An investigator fits a Cox proportional hazards model in an epidemiologic cohort with a single covariate, where the hazard for subject $i$ at time $t$ is $h(t \\mid x_i) = h_0(t) \\exp(\\beta x_i)$. Consider the following toy dataset with $5$ subjects, each with a follow-up time in months, an event indicator $\\delta_i$ ($1$ for event, $0$ for right-censored), and a single covariate $x_i$:\n- Subject $1$: $(t_1, \\delta_1, x_1) = (1, 1, 0)$\n- Subject $2$: $(t_2, \\delta_2, x_2) = (2, 1, 1)$\n- Subject $3$: $(t_3, \\delta_3, x_3) = (3, 1, 2)$\n- Subject $4$: $(t_4, \\delta_4, x_4) = (4, 0, 1)$\n- Subject $5$: $(t_5, \\delta_5, x_5) = (5, 1, 0)$\n\nA Cox model fit to these data yields an estimated log hazard ratio $\\hat{\\beta} = \\ln(2)$ and an estimated variance $\\widehat{\\mathrm{Var}}(\\hat{\\beta}) = \\frac{1}{2}$.\n\nUsing only the definitions of the Cox partial likelihood and Schoenfeld residuals, do the following:\n1) For each event time $t_i$ with $\\delta_i = 1$, compute the Schoenfeld residual $r_i = x_i - \\bar{x}(\\hat{\\beta}, t_i)$, where $\\bar{x}(\\hat{\\beta}, t_i)$ is the risk-set weighted average of $x$ at time $t_i$ under the fitted model. Then compute the scaled Schoenfeld residual $s_i = \\widehat{\\mathrm{Var}}(\\hat{\\beta}) \\, r_i$.\n2) Regress the scaled Schoenfeld residuals $s_i$ on the corresponding event times $t_i$ using ordinary least squares (no weights), that is, fit $s_i = a + b \\, t_i + \\varepsilon_i$ across the event times. Compute the slope $b$.\n3) Finally, state, in words, what a statistically significant positive slope $b$ would imply about the proportional hazards assumption and the time trend of the covariate effect.\n\nReport only the numerical value of the slope $b$ as your final answer, rounded to four significant figures. Express the slope in residual-units per month (do not include units in the final boxed answer).", "solution": "We begin from the definitions of the Cox model and Schoenfeld residuals. The Cox model specifies $h(t \\mid x) = h_0(t) \\exp(\\beta x)$. The Cox partial likelihood is built from risk sets. For an observed event at time $t_i$, the Schoenfeld residual for covariate $x$ at the fitted parameter $\\hat{\\beta}$ is\n$$\nr_i = x_i - \\bar{x}(\\hat{\\beta}, t_i),\n$$\nwhere\n$$\n\\bar{x}(\\hat{\\beta}, t_i) = \\frac{\\sum_{j \\in \\mathcal{R}(t_i)} x_j \\exp(\\hat{\\beta} x_j)}{\\sum_{j \\in \\mathcal{R}(t_i)} \\exp(\\hat{\\beta} x_j)},\n$$\nand $\\mathcal{R}(t_i)$ is the risk set just prior to $t_i$. Following the Grambsch–Therneau scaling for testing proportional hazards, the scaled Schoenfeld residuals are defined by multiplying the Schoenfeld residuals by the estimated variance-covariance matrix of $\\hat{\\beta}$. With a single covariate, this reduces to\n$$\ns_i = \\widehat{\\mathrm{Var}}(\\hat{\\beta}) \\, r_i.\n$$\n\nGiven $\\hat{\\beta} = \\ln(2)$, we have $\\exp(\\hat{\\beta}) = 2$ and $\\exp(2 \\hat{\\beta}) = 4$. We enumerate the event times ($\\delta_i = 1$) and compute risk-set weighted averages.\n\nEvent at $t_1 = 1$ (subject $1$, $x_1 = 0$):\n- Risk set $\\mathcal{R}(t_1) = \\{1,2,3,4,5\\}$ with $(x_1, x_2, x_3, x_4, x_5) = (0,1,2,1,0)$.\n- Risk scores under $\\hat{\\beta}$ are $\\exp(\\hat{\\beta} x) = (1, 2, 4, 2, 1)$.\n- Denominator $D_1 = 1 + 2 + 4 + 2 + 1 = 10$.\n- Numerator $N_1 = 0 \\cdot 1 + 1 \\cdot 2 + 2 \\cdot 4 + 1 \\cdot 2 + 0 \\cdot 1 = 12$.\n- Weighted mean $\\bar{x}(\\hat{\\beta}, t_1) = \\frac{12}{10} = 1.2$.\n- Schoenfeld residual $r_1 = x_1 - \\bar{x}(\\hat{\\beta}, t_1) = 0 - 1.2 = -1.2$.\n- Scaled residual $s_1 = \\widehat{\\mathrm{Var}}(\\hat{\\beta}) r_1 = \\frac{1}{2} \\cdot (-1.2) = -0.6$.\n\nEvent at $t_2 = 2$ (subject $2$, $x_2 = 1$):\n- Risk set $\\mathcal{R}(t_2) = \\{2,3,4,5\\}$.\n- Covariates $(x_2, x_3, x_4, x_5) = (1,2,1,0)$ with scores $(2,4,2,1)$.\n- Denominator $D_2 = 2 + 4 + 2 + 1 = 9$.\n- Numerator $N_2 = 1 \\cdot 2 + 2 \\cdot 4 + 1 \\cdot 2 + 0 \\cdot 1 = 12$.\n- Weighted mean $\\bar{x}(\\hat{\\beta}, t_2) = \\frac{12}{9} = \\frac{4}{3}$.\n- Schoenfeld residual $r_2 = 1 - \\frac{4}{3} = -\\frac{1}{3}$.\n- Scaled residual $s_2 = \\frac{1}{2} \\cdot \\left(-\\frac{1}{3}\\right) = -\\frac{1}{6}$.\n\nEvent at $t_3 = 3$ (subject $3$, $x_3 = 2$):\n- Risk set $\\mathcal{R}(t_3) = \\{3,4,5\\}$.\n- Covariates $(x_3, x_4, x_5) = (2,1,0)$ with scores $(4,2,1)$.\n- Denominator $D_3 = 4 + 2 + 1 = 7$.\n- Numerator $N_3 = 2 \\cdot 4 + 1 \\cdot 2 + 0 \\cdot 1 = 10$.\n- Weighted mean $\\bar{x}(\\hat{\\beta}, t_3) = \\frac{10}{7}$.\n- Schoenfeld residual $r_3 = 2 - \\frac{10}{7} = \\frac{4}{7}$.\n- Scaled residual $s_3 = \\frac{1}{2} \\cdot \\frac{4}{7} = \\frac{2}{7}$.\n\nEvent at $t_5 = 5$ (subject $5$, $x_5 = 0$; note subject $4$ is censored at $t_4 = 4$):\n- Risk set $\\mathcal{R}(t_5) = \\{5\\}$.\n- Covariate $x_5 = 0$ with score $1$.\n- Denominator $D_5 = 1$ and numerator $N_5 = 0$.\n- Weighted mean $\\bar{x}(\\hat{\\beta}, t_5) = 0$.\n- Schoenfeld residual $r_5 = 0 - 0 = 0$.\n- Scaled residual $s_5 = \\frac{1}{2} \\cdot 0 = 0$.\n\nCollect the event times and scaled Schoenfeld residuals:\n- $(t_i, s_i) \\in \\{(1, -0.6), (2, -\\frac{1}{6}), (3, \\frac{2}{7}), (5, 0)\\}$.\n\nNext, regress $s_i$ on $t_i$ using ordinary least squares: $s_i = a + b \\, t_i + \\varepsilon_i$. The slope $b$ is\n$$\nb = \\frac{\\sum_{i} (t_i - \\bar{t})(s_i - \\bar{s})}{\\sum_{i} (t_i - \\bar{t})^2}.\n$$\nCompute the means:\n$$\n\\bar{t} = \\frac{1 + 2 + 3 + 5}{4} = \\frac{11}{4} = 2.75, \\quad \\bar{s} = \\frac{-\\frac{3}{5} - \\frac{1}{6} + \\frac{2}{7} + 0}{4} = \\frac{-101}{840}.\n$$\nCompute the numerator:\n- For $(t_1, s_1)$: $(t_1 - \\bar{t})(s_1 - \\bar{s}) = \\left(1 - \\frac{11}{4}\\right)\\left(-\\frac{3}{5} + \\frac{101}{840}\\right) = \\left(-\\frac{7}{4}\\right)\\left(-\\frac{403}{840}\\right) = \\frac{2821}{3360}$.\n- For $(t_2, s_2)$: $\\left(2 - \\frac{11}{4}\\right)\\left(-\\frac{1}{6} + \\frac{101}{840}\\right) = \\left(-\\frac{3}{4}\\right)\\left(-\\frac{13}{280}\\right) = \\frac{39}{1120} = \\frac{117}{3360}$.\n- For $(t_3, s_3)$: $\\left(3 - \\frac{11}{4}\\right)\\left(\\frac{2}{7} + \\frac{101}{840}\\right) = \\left(\\frac{1}{4}\\right)\\left(\\frac{341}{840}\\right) = \\frac{341}{3360}$.\n- For $(t_5, s_5)$: $\\left(5 - \\frac{11}{4}\\right)\\left(0 + \\frac{101}{840}\\right) = \\left(\\frac{9}{4}\\right)\\left(\\frac{101}{840}\\right) = \\frac{909}{3360}$.\nSumming gives\n$$\n\\sum_{i} (t_i - \\bar{t})(s_i - \\bar{s}) = \\frac{2821 + 117 + 341 + 909}{3360} = \\frac{4188}{3360} = \\frac{349}{280}.\n$$\nCompute the denominator:\n$$\n\\sum_{i} (t_i - \\bar{t})^2 = \\left(-\\frac{7}{4}\\right)^2 + \\left(-\\frac{3}{4}\\right)^2 + \\left(\\frac{1}{4}\\right)^2 + \\left(\\frac{9}{4}\\right)^2 = \\frac{49 + 9 + 1 + 81}{16} = \\frac{140}{16} = \\frac{35}{4}.\n$$\nTherefore,\n$$\nb = \\frac{\\frac{349}{280}}{\\frac{35}{4}} = \\frac{349}{280} \\cdot \\frac{4}{35} = \\frac{349}{2450} \\approx 0.1424489796.\n$$\nRounding to four significant figures gives $b \\approx 0.1424$.\n\nInterpretation: A statistically significant positive slope $b$ of scaled Schoenfeld residuals versus time indicates that the effect of the covariate on the log hazard is increasing over time, which is a violation of the proportional hazards assumption. In this context, it implies that the log hazard ratio $\\beta(t)$ is not constant but tends to increase with $t$, suggesting a time-varying covariate effect.", "answer": "$$\\boxed{0.1424}$$", "id": "4640222"}]}