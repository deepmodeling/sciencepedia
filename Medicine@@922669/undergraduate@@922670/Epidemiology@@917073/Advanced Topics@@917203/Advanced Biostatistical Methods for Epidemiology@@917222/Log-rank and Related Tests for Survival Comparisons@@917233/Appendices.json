{"hands_on_practices": [{"introduction": "The cornerstone of survival analysis is estimating the survival function, $S(t)$, which represents the probability of surviving beyond a certain time $t$. In real-world studies, we rarely observe the event for every participant, leading to right-censored data. This practice problem guides you through the foundational Kaplan-Meier method to construct a survival curve from first principles and uses Greenwood's formula to quantify the uncertainty in our estimate, a crucial step in interpreting any survival curve. [@problem_id:4608378]", "problem": "Consider a cohort of $12$ patients enrolled in an epidemiologic survival study of time to disease relapse, measured in months. Each patient contributes an observed pair $(t_i,\\delta_i)$, where $t_i$ is the observed follow-up time and $\\delta_i$ is the event indicator ($\\delta_i = 1$ if relapse was observed at time $t_i$, and $\\delta_i = 0$ if the observation was right-censored at time $t_i$). Assume non-informative right-censoring, no competing risks, and that events occurring at the same recorded time are treated as simultaneous.\n\nThe observed pairs $(t_i,\\delta_i)$, sorted by increasing time, are:\n$(3,1)$, $(4,0)$, $(5,1)$, $(8,1)$, $(10,0)$, $(12,1)$, $(12,1)$, $(15,0)$, $(18,1)$, $(20,0)$, $(22,1)$, $(24,1)$.\n\nStarting from first principles, use the definition of the survival function $S(t) = \\Pr(T  t)$, the product-limit (Kaplan–Meier) construction for right-censored data, and large-sample variance reasoning for a product of independent multiplicative factors to derive how to compute the Kaplan–Meier estimator $\\hat{S}(t)$ and its standard error at any time $t$ using Greenwood’s variance formula. Then, compute $\\hat{S}(t)$ and its standard error at $t = 8$ months and $t = 20$ months for the given dataset.\n\nExpress your final numerical values for $\\hat{S}(8)$, $\\operatorname{SE}(\\hat{S}(8))$, $\\hat{S}(20)$, and $\\operatorname{SE}(\\hat{S}(20))$ as decimals. Round your answers to four significant figures. Do not use the percentage symbol.", "solution": "The problem is valid as it is scientifically grounded in standard survival analysis methodology, well-posed with sufficient data, and objective in its formulation. We will proceed with the derivation and calculation.\n\nFirst, we derive the Kaplan-Meier estimator $\\hat{S}(t)$ and its standard error based on Greenwood's formula.\n\n**Derivation of the Kaplan-Meier Estimator**\n\nThe survival function, $S(t)$, is the probability that an individual's time to event, $T$, is greater than some specified time $t$.\n$$S(t) = \\Pr(T  t)$$\nLet the distinct event times observed in the cohort be $t_{(1)}  t_{(2)}  \\dots  t_{(k)}$. The survival function can be expressed as a product of conditional probabilities. For any time $t$ such that $t_{(j)} \\le t  t_{(j+1)}$, the survival probability $S(t)$ is equivalent to $S(t_{(j)})$, which is the probability of surviving past all event times up to and including $t_{(j)}$. This can be written as:\n$$S(t) = \\Pr(T  t_{(1)}) \\times \\Pr(T  t_{(2)}|T  t_{(1)}) \\times \\dots \\times \\Pr(T  t_{(j)}|T  t_{(j-1)})$$\nLet $p_i = \\Pr(T  t_{(i)}|T  t_{(i-1)})$ be the conditional probability of surviving past event time $t_{(i)}$, given survival up to just before $t_{(i)}$. Then, for $t_{(j)} \\le t  t_{(j+1)}$:\n$$S(t) = \\prod_{i=1}^{j} p_i$$\nIn a study with right-censoring, we estimate each conditional probability $p_i$ from the data available at time $t_{(i)}$. Let $n_i$ be the number of individuals at risk just before time $t_{(i)}$ (i.e., those who have not yet had the event or been censored). Let $d_i$ be the number of individuals who experience the event at time $t_{(i)}$. The number of individuals who survive past $t_{(i)}$ among those at risk is $n_i - d_i$. A natural estimator for $p_i$ is the observed proportion of those at risk who survive past $t_{(i)}$:\n$$\\hat{p}_i = \\frac{n_i - d_i}{n_i} = 1 - \\frac{d_i}{n_i}$$\nSubstituting this estimator into the product form gives the Kaplan-Meier (or product-limit) estimator for $S(t)$:\n$$\\hat{S}(t) = \\prod_{i: t_{(i)} \\le t} \\left(1 - \\frac{d_i}{n_i}\\right)$$\nThis estimator is a step function that changes its value only at times when an event occurs.\n\n**Derivation of Greenwood's Formula for the Standard Error**\n\nTo derive the variance of $\\hat{S}(t)$, we use large-sample variance reasoning. It is convenient to first find the variance of $\\ln(\\hat{S}(t))$.\n$$\\ln(\\hat{S}(t)) = \\ln\\left(\\prod_{i: t_{(i)} \\le t} \\hat{p}_i\\right) = \\sum_{i: t_{(i)} \\le t} \\ln(\\hat{p}_i)$$\nAssuming the estimates $\\hat{p}_i$ for different event times are approximately independent for large samples, the variance of the sum is the sum of the variances:\n$$\\operatorname{Var}(\\ln(\\hat{S}(t))) \\approx \\sum_{i: t_{(i)} \\le t} \\operatorname{Var}(\\ln(\\hat{p}_i))$$\nWe use the delta method to approximate $\\operatorname{Var}(\\ln(\\hat{p}_i))$. For a function $g(X)$, $\\operatorname{Var}(g(X)) \\approx [g'(E[X])]^2 \\operatorname{Var}(X)$. Here, $g(p) = \\ln(p)$, so $g'(p) = 1/p$. The random variable is the count of events $d_i$, which can be modeled as a binomial random variable $d_i \\sim \\operatorname{Bin}(n_i, q_i)$, where $q_i = 1-p_i$ is the conditional probability of an event. The estimator is $\\hat{p}_i = (n_i-d_i)/n_i$, and its variance is $\\operatorname{Var}(\\hat{p}_i) = \\frac{\\operatorname{Var}(d_i)}{n_i^2} = \\frac{n_i p_i q_i}{n_i^2} = \\frac{p_i(1-p_i)}{n_i}$.\nApplying the delta method:\n$$\\operatorname{Var}(\\ln(\\hat{p}_i)) \\approx \\left(\\frac{1}{p_i}\\right)^2 \\operatorname{Var}(\\hat{p}_i) = \\frac{1}{p_i^2} \\frac{p_i(1-p_i)}{n_i} = \\frac{1-p_i}{n_i p_i}$$\nWe estimate this variance by substituting the estimates $\\hat{p}_i = (n_i-d_i)/n_i$:\n$$\\widehat{\\operatorname{Var}}(\\ln(\\hat{p}_i)) = \\frac{1 - \\frac{n_i-d_i}{n_i}}{n_i \\left(\\frac{n_i-d_i}{n_i}\\right)} = \\frac{\\frac{d_i}{n_i}}{n_i-d_i} = \\frac{d_i}{n_i(n_i-d_i)}$$\nSumming over the relevant event times gives an estimate for the variance of $\\ln(\\hat{S}(t))$:\n$$\\widehat{\\operatorname{Var}}(\\ln(\\hat{S}(t))) = \\sum_{i: t_{(i)} \\le t} \\frac{d_i}{n_i(n_i-d_i)}$$\nTo find the variance of $\\hat{S}(t)$, we apply the delta method again. Let $h(x) = \\exp(x)$, so that $\\hat{S}(t) = \\exp(\\ln(\\hat{S}(t)))$. The derivative is $h'(x) = \\exp(x)$.\n$$\\operatorname{Var}(\\hat{S}(t)) \\approx [h'(\\ln S(t))]^2 \\operatorname{Var}(\\ln(\\hat{S}(t))) = [\\exp(\\ln S(t))]^2 \\operatorname{Var}(\\ln(\\hat{S}(t))) = [S(t)]^2 \\operatorname{Var}(\\ln(\\hat{S}(t)))$$\nSubstituting the estimators gives Greenwood's formula for the estimated variance:\n$$\\widehat{\\operatorname{Var}}(\\hat{S}(t)) = [\\hat{S}(t)]^2 \\sum_{i: t_{(i)} \\le t} \\frac{d_i}{n_i(n_i-d_i)}$$\nThe standard error is the square root of this variance:\n$$\\operatorname{SE}(\\hat{S}(t)) = \\sqrt{\\widehat{\\operatorname{Var}}(\\hat{S}(t))} = |\\hat{S}(t)| \\sqrt{\\sum_{i: t_{(i)} \\le t} \\frac{d_i}{n_i(n_i-d_i)}}$$\nSince $\\hat{S}(t) \\ge 0$, this simplifies to $\\operatorname{SE}(\\hat{S}(t)) = \\hat{S}(t) \\sqrt{\\sum_{i: t_{(i)} \\le t} \\frac{d_i}{n_i(n_i-d_i)}}$.\n\n**Application to the Dataset**\n\nFirst, we assemble a life table from the given data: $(3,1), (4,0), (5,1), (8,1), (10,0), (12,1), (12,1), (15,0), (18,1), (20,0), (22,1), (24,1)$. The distinct event times are $t=3, 5, 8, 12, 18, 22, 24$.\nLet $t_{(j)}$ be the $j$-th distinct event time, $n_j$ the number at risk just before $t_{(j)}$, and $d_j$ the number of events at $t_{(j)}$.\n\n- Time $t=0$: The full cohort of $12$ is at risk. $\\hat{S}(0)=1$.\n- Time $t=3$ (event): $n_1=12$, $d_1=1$. Censoring at $t=4$ occurs after.\n- Time $t=5$ (event): After $1$ event at $t=3$ and $1$ censoring at $t=4$, $n_2 = 12-1-1 = 10$. $d_2=1$.\n- Time $t=8$ (event): After $1$ event at $t=5$, $n_3 = 10-1 = 9$. $d_3=1$. Censoring at $t=10$ occurs after.\n- Time $t=12$ (tied events): After $1$ event at $t=8$ and $1$ censoring at $t=10$, $n_4 = 9-1-1 = 7$. $d_4=2$. Censoring at $t=15$ occurs after.\n- Time $t=18$ (event): After $2$ events at $t=12$ and $1$ censoring at $t=15$, $n_5 = 7-2-1 = 4$. $d_5=1$. Censoring at $t=20$ occurs after.\n- Time $t=22$ (event): After $1$ event at $t=18$ and $1$ censoring at $t=20$, $n_6 = 4-1-1 = 2$. $d_6=1$.\n- Time $t=24$ (event): After $1$ event at $t=22$, $n_7 = 2-1 = 1$. $d_7=1$.\n\n**Calculation for $t = 8$ months**\nThe event times less than or equal to $t=8$ are $3, 5, 8$.\n$$\\hat{S}(8) = \\prod_{i: t_{(i)} \\le 8} \\left(1 - \\frac{d_i}{n_i}\\right) = \\left(1 - \\frac{1}{12}\\right) \\times \\left(1 - \\frac{1}{10}\\right) \\times \\left(1 - \\frac{1}{9}\\right)$$\n$$\\hat{S}(8) = \\left(\\frac{11}{12}\\right) \\times \\left(\\frac{9}{10}\\right) \\times \\left(\\frac{8}{9}\\right) = \\frac{11 \\times 8}{12 \\times 10} = \\frac{11}{15} \\approx 0.733333...$$\nTo four significant figures, $\\hat{S}(8) = 0.7333$.\n\nFor the standard error, we first compute the sum term:\n$$\\sum_{i: t_{(i)} \\le 8} \\frac{d_i}{n_i(n_i-d_i)} = \\frac{1}{12(11)} + \\frac{1}{10(9)} + \\frac{1}{9(8)} = \\frac{1}{132} + \\frac{1}{90} + \\frac{1}{72}$$\n$$\\text{Sum} \\approx 0.00757576 + 0.01111111 + 0.01388889 \\approx 0.03257576$$\nNow, we compute the standard error:\n$$\\operatorname{SE}(\\hat{S}(8)) = \\hat{S}(8) \\sqrt{\\sum_{i: t_{(i)} \\le 8} \\frac{d_i}{n_i(n_i-d_i)}} \\approx 0.733333 \\times \\sqrt{0.03257576}$$\n$$\\operatorname{SE}(\\hat{S}(8)) \\approx 0.733333 \\times 0.1804876 \\approx 0.132361...$$\nTo four significant figures, $\\operatorname{SE}(\\hat{S}(8)) = 0.1324$.\n\n**Calculation for $t = 20$ months**\nThe Kaplan-Meier estimate is a step function, constant between events. The last event time before or at $t=20$ is $t=18$. Therefore, $\\hat{S}(20) = \\hat{S}(18)$. The event times are $3, 5, 8, 12, 18$.\n$$\\hat{S}(20) = \\hat{S}(18) = \\left(1 - \\frac{1}{12}\\right)\\left(1 - \\frac{1}{10}\\right)\\left(1 - \\frac{1}{9}\\right)\\left(1 - \\frac{2}{7}\\right)\\left(1 - \\frac{1}{4}\\right)$$\n$$\\hat{S}(20) = \\left(\\frac{11}{15}\\right) \\times \\left(\\frac{5}{7}\\right) \\times \\left(\\frac{3}{4}\\right) = \\frac{11 \\times 5 \\times 3}{15 \\times 7 \\times 4} = \\frac{11}{28} \\approx 0.392857...$$\nTo four significant figures, $\\hat{S}(20) = 0.3929$.\n\nFor the standard error, we add the terms for the events at $t=12$ and $t=18$ to the previous sum.\n$$\\sum_{i: t_{(i)} \\le 20} \\frac{d_i}{n_i(n_i-d_i)} = \\left(\\frac{1}{132} + \\frac{1}{90} + \\frac{1}{72}\\right) + \\frac{2}{7(5)} + \\frac{1}{4(3)}$$\n$$\\text{Sum} \\approx 0.03257576 + \\frac{2}{35} + \\frac{1}{12} \\approx 0.03257576 + 0.05714286 + 0.08333333 \\approx 0.17305195$$\nNow, we compute the standard error for $\\hat{S}(20)$:\n$$\\operatorname{SE}(\\hat{S}(20)) = \\hat{S}(20) \\sqrt{\\sum_{i: t_{(i)} \\le 20} \\frac{d_i}{n_i(n_i-d_i)}} \\approx 0.392857 \\times \\sqrt{0.17305195}$$\n$$\\operatorname{SE}(\\hat{S}(20)) \\approx 0.392857 \\times 0.4159951 \\approx 0.163423...$$\nTo four significant figures, $\\operatorname{SE}(\\hat{S}(20)) = 0.1634$.\n\nThe final values, rounded to four significant figures, are:\n$\\hat{S}(8) = 0.7333$\n$\\operatorname{SE}(\\hat{S}(8)) = 0.1324$\n$\\hat{S}(20) = 0.3929$\n$\\operatorname{SE}(\\hat{S}(20)) = 0.1634$", "answer": "$$\\boxed{\\begin{pmatrix} 0.7333  0.1324  0.3929  0.1634 \\end{pmatrix}}$$", "id": "4608378"}, {"introduction": "After describing the survival experience of a group, we often want to compare it with another. The log-rank test is the classic method for testing the null hypothesis that two survival curves are identical. This exercise demystifies the test by having you manually calculate its core components—the score ($U$) and its variance ($V$)—at each event time, revealing how evidence against the null hypothesis accumulates based on the distribution of events across groups. [@problem_id:4608348]", "problem": "An epidemiology study follows two independent cohorts, Group A and Group B, to compare time-to-event outcomes using survival analysis. Assume that at any distinct event time, conditional on the risk set composition just before that time, the allocation of observed events across groups is governed by sampling without replacement from the pooled risk set under the null hypothesis of equal hazard functions. This corresponds to a score test in the Cox Proportional Hazards (CPH) model and yields the classical log-rank test.\n\nThere are three distinct event times, with the following risk set sizes and observed numbers of events in each group at each time:\n- At time $t_1$: Group A has $10$ at risk and Group B has $10$ at risk; observed events are $1$ in Group A and $0$ in Group B.\n- At time $t_2$: Group A has $8$ at risk and Group B has $9$ at risk; observed events are $1$ in Group A and $2$ in Group B.\n- At time $t_3$: Group A has $6$ at risk and Group B has $7$ at risk; observed events are $0$ in Group A and $3$ in Group B.\n\nBetween event times, some individuals may be censored; the given risk set sizes already account for prior events and censoring.\n\nUsing the log-rank framework based on the null of equal hazards, compute the log-rank score $U$ for Group A, its variance $V$, and the standardized statistic $Z = U / \\sqrt{V}$. Justify the expected value and variance used at each event time from first principles. Round the final standardized statistic $Z$ to four significant figures. No units are required. Briefly interpret the value of $Z$ in terms of whether there is evidence of a difference in hazards between the two groups, but provide only the value of $Z$ as your final answer.", "solution": "The fundamental basis for the log-rank test is the null hypothesis of equal hazard functions across groups. Under this null, at any distinct event time $t_j$, conditional on the pooled risk set just prior to $t_j$, the $d_j$ events observed at $t_j$ are allocated across the two groups as if drawn without replacement from the $n_j$ individuals at risk. This implies a hypergeometric model for the number of events from Group A at $t_j$, denoted $O_{A,j}$, with parameters:\n- Population size $n_j = n_{A,j} + n_{B,j}$,\n- Number of “successes” (Group A at risk) $n_{A,j}$,\n- Sample size $d_j$ (number of events at $t_j$).\n\nFor a hypergeometric random variable,\n$$\n\\mathbb{E}[O_{A,j}] = d_j \\frac{n_{A,j}}{n_j},\n\\quad\n\\mathrm{Var}(O_{A,j}) = d_j \\frac{n_{A,j}}{n_j} \\left(1 - \\frac{n_{A,j}}{n_j}\\right) \\frac{n_j - d_j}{n_j - 1}.\n$$\nEquivalently,\n$$\n\\mathrm{Var}(O_{A,j}) = \\frac{d_j (n_j - d_j) n_{A,j} n_{B,j}}{n_j^2 (n_j - 1)}.\n$$\n\nThe log-rank score $U$ for Group A is the sum over event times of observed minus expected events:\n$$\nU = \\sum_{j=1}^{3} \\left(O_{A,j} - \\mathbb{E}[O_{A,j}]\\right),\n$$\nand the variance is\n$$\nV = \\sum_{j=1}^{3} \\mathrm{Var}(O_{A,j}).\n$$\nThe standardized statistic is $Z = U / \\sqrt{V}$, which is approximately standard normal by large-sample theory (Central Limit Theorem (CLT) applied to the score test in the Cox Proportional Hazards (CPH) model).\n\nWe now compute these quantities at each time.\n\nTime $t_1$:\n- Risk sets: $n_{A,1} = 10$, $n_{B,1} = 10$, $n_1 = 20$.\n- Events: $d_1 = 1$, with $O_{A,1} = 1$.\n- Expected:\n$$\n\\mathbb{E}[O_{A,1}] = d_1 \\frac{n_{A,1}}{n_1} = 1 \\cdot \\frac{10}{20} = \\frac{1}{2}.\n$$\n- Variance:\n$$\n\\mathrm{Var}(O_{A,1}) = \\frac{d_1 (n_1 - d_1) n_{A,1} n_{B,1}}{n_1^2 (n_1 - 1)} = \\frac{1 \\cdot 19 \\cdot 10 \\cdot 10}{20^2 \\cdot 19} = \\frac{1}{4}.\n$$\n- Contribution to $U$: $O_{A,1} - \\mathbb{E}[O_{A,1}] = 1 - \\frac{1}{2} = \\frac{1}{2}$.\n\nTime $t_2$:\n- Risk sets: $n_{A,2} = 8$, $n_{B,2} = 9$, $n_2 = 17$.\n- Events: $d_2 = 3$, with $O_{A,2} = 1$.\n- Expected:\n$$\n\\mathbb{E}[O_{A,2}] = d_2 \\frac{n_{A,2}}{n_2} = 3 \\cdot \\frac{8}{17} = \\frac{24}{17}.\n$$\n- Variance:\n$$\n\\mathrm{Var}(O_{A,2}) = \\frac{d_2 (n_2 - d_2) n_{A,2} n_{B,2}}{n_2^2 (n_2 - 1)} = \\frac{3 \\cdot 14 \\cdot 8 \\cdot 9}{17^2 \\cdot 16} = \\frac{3024}{4624} = \\frac{189}{289}.\n$$\n- Contribution to $U$: $O_{A,2} - \\mathbb{E}[O_{A,2}] = 1 - \\frac{24}{17} = -\\frac{7}{17}$.\n\nTime $t_3$:\n- Risk sets: $n_{A,3} = 6$, $n_{B,3} = 7$, $n_3 = 13$.\n- Events: $d_3 = 3$, with $O_{A,3} = 0$.\n- Expected:\n$$\n\\mathbb{E}[O_{A,3}] = d_3 \\frac{n_{A,3}}{n_3} = 3 \\cdot \\frac{6}{13} = \\frac{18}{13}.\n$$\n- Variance:\n$$\n\\mathrm{Var}(O_{A,3}) = \\frac{d_3 (n_3 - d_3) n_{A,3} n_{B,3}}{n_3^2 (n_3 - 1)} = \\frac{3 \\cdot 10 \\cdot 6 \\cdot 7}{13^2 \\cdot 12} = \\frac{1260}{2028} = \\frac{105}{169}.\n$$\n- Contribution to $U$: $O_{A,3} - \\mathbb{E}[O_{A,3}] = 0 - \\frac{18}{13} = -\\frac{18}{13}$.\n\nSumming across times,\n$$\nU = \\left( \\frac{1}{2} \\right) + \\left( -\\frac{7}{17} \\right) + \\left( -\\frac{18}{13} \\right)\n= \\frac{1}{2} - \\frac{7}{17} - \\frac{18}{13}\n= \\frac{221 - 182 - 612}{442}\n= -\\frac{573}{442}.\n$$\nNumerically, $U \\approx -1.2963800905$.\n\nSimilarly,\n$$\nV = \\left( \\frac{1}{4} \\right) + \\left( \\frac{189}{289} \\right) + \\left( \\frac{105}{169} \\right).\n$$\nNumerically,\n$$\n\\frac{1}{4} = 0.25,\\quad \\frac{189}{289} \\approx 0.6539792388,\\quad \\frac{105}{169} \\approx 0.6213017751,\n$$\nso\n$$\nV \\approx 0.25 + 0.6539792388 + 0.6213017751 = 1.5252810139.\n$$\nTherefore,\n$$\nZ = \\frac{U}{\\sqrt{V}} \\approx \\frac{-1.2963800905}{\\sqrt{1.5252810139}} \\approx \\frac{-1.2963800905}{1.235022672} \\approx -1.049681.\n$$\nRounded to four significant figures, $Z \\approx -1.050$.\n\nInterpretation: The standardized log-rank statistic is close to zero in magnitude (approximately $-1.05$), which under the standard normal approximation corresponds to a two-sided tail probability near $0.29$. There is no strong evidence against the null hypothesis of equal hazards between Group A and Group B based on this small dataset.\n\nOnly the value of $Z$ is required as the final answer, rounded as specified.", "answer": "$$\\boxed{-1.050}$$", "id": "4608348"}, {"introduction": "Epidemiological studies often involve complexities beyond simple right-censoring, such as subjects entering the study at different times, a phenomenon known as left truncation. This practice problem extends your skills to a more realistic scenario, challenging you to correctly construct the risk sets in the presence of both left truncation and right censoring. Mastering this skill is essential for correctly applying survival comparison tests like the log-rank test to data from real-world observational cohorts. [@problem_id:4608372]", "problem": "An observational cohort study evaluates time to tuberculosis relapse in two exposure groups with delayed study entry (left truncation) and loss to follow-up (right censoring). For each subject, let $L_i$ denote the left truncation time (entry time), $T_i$ denote the observed time (either an event or a right-censoring time), $\\delta_i$ denote the event indicator ($\\delta_i = 1$ for an event, $\\delta_i = 0$ for censoring), and $G_i \\in \\{A,B\\}$ denote the exposure group. Adopt the right-continuous risk set convention that a subject is at risk at time $t$ if and only if $L_i  t \\le T_i$.\n\nThe synthetic dataset comprises $8$ subjects:\n- Group $A$: \n  - Subject $A_1$: $L=0.5$, $T=3.0$, $\\delta=1$.\n  - Subject $A_2$: $L=1.0$, $T=4.0$, $\\delta=0$.\n  - Subject $A_3$: $L=1.8$, $T=5.0$, $\\delta=1$.\n  - Subject $A_4$: $L=1.5$, $T=6.0$, $\\delta=1$.\n- Group $B$:\n  - Subject $B_1$: $L=0.0$, $T=2.0$, $\\delta=1$.\n  - Subject $B_2$: $L=1.0$, $T=3.5$, $\\delta=0$.\n  - Subject $B_3$: $L=2.5$, $T=5.5$, $\\delta=1$.\n  - Subject $B_4$: $L=0.5$, $T=5.8$, $\\delta=0$.\n\nTasks:\n- Identify the distinct event times across both groups and write the risk set at each event time as the set of subjects satisfying $L_i  t \\le T_i$.\n- Using the risk sets, compute the standard log-rank test statistic comparing group $A$ versus group $B$ under the null hypothesis of equal hazard functions, with constant weights $w(t)=1$ at each event time. Report the chi-square value of the test statistic.\n\nExpress your final numeric answer as an exact fraction. Do not round. No units are required.", "solution": "The problem provides a dataset from an observational cohort study with left-truncated and right-censored data for two groups, $A$ and $B$, and asks for the computation of the log-rank test statistic.\n\n### Problem Validation\n**Step 1: Extract Givens**\n- Data for $8$ subjects, with left truncation time $L_i$, observed time $T_i$, event indicator $\\delta_i$, and group $G_i \\in \\{A, B\\}$.\n- Group $A$:\n  - Subject $A_1$: $L=0.5$, $T=3.0$, $\\delta=1$.\n  - Subject $A_2$: $L=1.0$, $T=4.0$, $\\delta=0$.\n  - Subject $A_3$: $L=1.8$, $T=5.0$, $\\delta=1$.\n  - Subject $A_4$: $L=1.5$, $T=6.0$, $\\delta=1$.\n- Group $B$:\n  - Subject $B_1$: $L=0.0$, $T=2.0$, $\\delta=1$.\n  - Subject $B_2$: $L=1.0$, $T=3.5$, $\\delta=0$.\n  - Subject $B_3$: $L=2.5$, $T=5.5$, $\\delta=1$.\n  - Subject $B_4$: $L=0.5$, $T=5.8$, $\\delta=0$.\n- Risk Set Definition: A subject $i$ is at risk at time $t$ if and only if $L_i  t \\le T_i$.\n- Task: Identify distinct event times, write the risk set for each, and compute the chi-square value of the standard log-rank test statistic with constant weights $w(t)=1$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, as it concerns the application of a standard statistical method (log-rank test) in biostatistics. The problem is well-posed, providing all necessary data and a clear definition of the risk set. The terminology is precise and objective. The dataset is self-contained and free of contradictions. The task is a direct, formalizable calculation based on the provided data and definitions.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n### Solution\nThe solution proceeds in two parts as requested: identifying event times and risk sets, then computing the log-rank statistic.\n\n**Part 1: Distinct Event Times and Risk Sets**\n\nAn event occurs if the event indicator $\\delta_i=1$. The subjects experiencing an event are $A_1$ (at time $3.0$), $A_3$ (at time $5.0$), $A_4$ (at time $6.0$), $B_1$ (at time $2.0$), and $B_3$ (at time $5.5$). The distinct, ordered event times, denoted $t_j$, are:\n$t_1 = 2.0$, $t_2 = 3.0$, $t_3 = 5.0$, $t_4 = 5.5$, and $t_5 = 6.0$.\n\nFor each event time $t_j$, we construct the risk set $R(t_j)$ based on the rule that a subject $i$ is in the risk set if $L_i  t_j \\le T_i$.\n\n- **Event time $t_1 = 2.0$:**\n  The risk set $R(2.0)$ consists of all subjects $i$ for whom $L_i  2.0 \\le T_i$.\n  - Group $A$: $A_1(0.52.0\\le3.0)$, $A_2(1.02.0\\le4.0)$, $A_3(1.82.0\\le5.0)$, $A_4(1.52.0\\le6.0)$. All $4$ are at risk.\n  - Group $B$: $B_1(0.02.0\\le2.0)$, $B_2(1.02.0\\le3.5)$, $B_4(0.52.0\\le5.8)$. Subject $B_3$ is not at risk since $L_{B_3}=2.5 \\not 2.0$. So $3$ are at risk.\n  - $R(2.0) = \\{A_1, A_2, A_3, A_4, B_1, B_2, B_4\\}$.\n\n- **Event time $t_2 = 3.0$:**\n  The risk set $R(3.0)$ consists of subjects $i$ for whom $L_i  3.0 \\le T_i$.\n  - Subject $B_1$ is no longer at risk since $T_{B_1}=2.0  3.0$.\n  - Subject $B_3$ is not yet at risk since $L_{B_3}=2.5  3.0 \\not\\le 5.5=T_{B_3}$. Wait, the original had B3 at risk. Let me re-read the condition. $L_i  t \\le T_i$. For B3 at t=3.0: $2.5  3.0 \\le 5.5$. This is true. B3 is at risk. My original notes were correct. Let's recheck the solution in the source. \"Subject $B_3$ is now at risk since $L_{B_3}=2.5  3.0 \\le 5.5=T_{B_3}$\". This is correct.\n  - $R(3.0) = \\{A_1, A_2, A_3, A_4, B_2, B_3, B_4\\}$. This is also correct.\n\n- **Event time $t_3 = 5.0$:**\n  The risk set $R(5.0)$ consists of subjects $i$ for whom $L_i  5.0 \\le T_i$.\n  - Subjects $A_1(T=3.0)$, $A_2(T=4.0)$, and $B_2(T=3.5)$ are no longer at risk.\n  - $R(5.0) = \\{A_3, A_4, B_3, B_4\\}$. This is correct.\n\n- **Event time $t_4 = 5.5$:**\n  The risk set $R(5.5)$ consists of subjects $i$ for whom $L_i  5.5 \\le T_i$.\n  - Subject $A_3(T=5.0)$ is no longer at risk.\n  - $R(5.5) = \\{A_4, B_3, B_4\\}$. This is correct.\n\n- **Event time $t_5 = 6.0$:**\n  The risk set $R(6.0)$ consists of subjects $i$ for whom $L_i  6.0 \\le T_i$.\n  - Subjects $B_3(T=5.5)$ and $B_4(T=5.8)$ are no longer at risk.\n  - $R(6.0) = \\{A_4\\}$. This is correct.\n\n**Part 2: Log-Rank Test Statistic Calculation**\n\nThe log-rank statistic compares the observed number of events in a group to the expected number under the null hypothesis of no difference in hazard rates between groups. We will calculate the statistic for Group $A$. Let $d_j$ be the total number of events at time $t_j$, $n_j$ the total number of subjects at risk, $d_{jA}$ the number of events in Group $A$, and $n_{jA}$ the number of subjects at risk in Group $A$.\n\nThe expected number of events in Group $A$ at time $t_j$ is $e_{jA} = d_j \\frac{n_{jA}}{n_j}$.\nThe log-rank score statistic is $U = \\sum_{j=1}^{k} w(t_j) (d_{jA} - e_{jA})$. With weights $w(t_j)=1$, this is $U = \\sum_{j=1}^{k} (d_{jA} - e_{jA})$.\nThe variance of the score is $V = \\sum_{j=1}^{k} w(t_j)^2 \\text{Var}(d_{jA})$, where $\\text{Var}(d_{jA}) = \\frac{n_{jA} n_{jB} d_j (n_j-d_j)}{n_j^2(n_j-1)}$. For $n_j=1$, the variance term is $0$.\nThe chi-square statistic is $\\chi^2 = \\frac{U^2}{V}$.\n\nThe calculations are summarized in the following table:\n\n| $j$ | $t_j$ | Event in Group | $d_j$ | $n_j$ | $n_{jA}$ | $d_{jA}$ | $e_{jA} = d_j \\frac{n_{jA}}{n_j}$ | $d_{jA} - e_{jA}$ |\n|---|---|---|---|---|---|---|---|---|\n| $1$ | $2.0$ | $B$ | $1$ | $7$ | $4$ | $0$ | $1 \\cdot \\frac{4}{7} = \\frac{4}{7}$ | $-\\frac{4}{7}$ |\n| $2$ | $3.0$ | $A$ | $1$ | $7$ | $4$ | $1$ | $1 \\cdot \\frac{4}{7} = \\frac{4}{7}$ | $1 - \\frac{4}{7} = \\frac{3}{7}$ |\n| $3$ | $5.0$ | $A$ | $1$ | $4$ | $2$ | $1$ | $1 \\cdot \\frac{2}{4} = \\frac{1}{2}$ | $1 - \\frac{1}{2} = \\frac{1}{2}$ |\n| $4$ | $5.5$ | $B$ | $1$ | $3$ | $1$ | $0$ | $1 \\cdot \\frac{1}{3} = \\frac{1}{3}$ | $-\\frac{1}{3}$ |\n| $5$ | $6.0$ | $A$ | $1$ | $1$ | $1$ | $1$ | $1 \\cdot \\frac{1}{1} = 1$ | $1-1=0$ |\n\nThe score statistic $U$ is the sum of the last column:\n$$U = -\\frac{4}{7} + \\frac{3}{7} + \\frac{1}{2} - \\frac{1}{3} + 0 = -\\frac{1}{7} + \\frac{1}{2} - \\frac{1}{3}$$\n$$U = \\frac{-6 + 21 - 14}{42} = \\frac{1}{42}$$\n\nNext, we calculate the variance $V$. Let $n_{jB} = n_j - n_{jA}$.\nFor $j=1$: $V_1 = \\frac{n_{1A} n_{1B} d_1 (n_1-d_1)}{n_1^2(n_1-1)} = \\frac{4 \\cdot 3 \\cdot 1 \\cdot (7-1)}{7^2 (7-1)} = \\frac{12}{49}$.\nFor $j=2$: $V_2 = \\frac{n_{2A} n_{2B} d_2 (n_2-d_2)}{n_2^2(n_2-1)} = \\frac{4 \\cdot 3 \\cdot 1 \\cdot (7-1)}{7^2 (7-1)} = \\frac{12}{49}$.\nFor $j=3$: $V_3 = \\frac{n_{3A} n_{3B} d_3 (n_3-d_3)}{n_3^2(n_3-1)} = \\frac{2 \\cdot 2 \\cdot 1 \\cdot (4-1)}{4^2 (4-1)} = \\frac{4}{16} = \\frac{1}{4}$.\nFor $j=4$: $V_4 = \\frac{n_{4A} n_{4B} d_4 (n_4-d_4)}{n_4^2(n_4-1)} = \\frac{1 \\cdot 2 \\cdot 1 \\cdot (3-1)}{3^2 (3-1)} = \\frac{2}{9}$.\nFor $j=5$: $n_5=1$, so the denominator $(n_5-1)$ is zero, rendering the variance contribution $V_5=0$. This is because there is no uncertainty in group assignment when only one individual is at risk.\n\nThe total variance $V$ is the sum of the individual variances:\n$$V = V_1 + V_2 + V_3 + V_4 + V_5 = \\frac{12}{49} + \\frac{12}{49} + \\frac{1}{4} + \\frac{2}{9} + 0 = \\frac{24}{49} + \\frac{1}{4} + \\frac{2}{9}$$\nThe common denominator is $49 \\times 4 \\times 9 = 1764$.\n$$V = \\frac{24 \\cdot 36}{1764} + \\frac{1 \\cdot 441}{1764} + \\frac{2 \\cdot 196}{1764} = \\frac{864 + 441 + 392}{1764} = \\frac{1697}{1764}$$\n\nFinally, the chi-square test statistic is calculated:\n$$\\chi^2 = \\frac{U^2}{V} = \\frac{(\\frac{1}{42})^2}{\\frac{1697}{1764}} = \\frac{\\frac{1}{1764}}{\\frac{1697}{1764}} = \\frac{1}{1697}$$\nThe final numeric answer is the exact fraction $\\frac{1}{1697}$.", "answer": "$$\\boxed{\\frac{1}{1697}}$$", "id": "4608372"}]}