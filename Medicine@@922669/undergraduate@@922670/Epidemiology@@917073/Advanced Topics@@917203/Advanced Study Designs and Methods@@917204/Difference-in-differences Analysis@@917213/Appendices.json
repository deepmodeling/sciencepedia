{"hands_on_practices": [{"introduction": "The best way to build intuition for any statistical method is to apply it directly. This first exercise provides a classic public health scenario and asks you to compute the Difference-in-Differences (DiD) estimate from the ground up. By starting with raw counts of disease cases and populations at risk, you will manually calculate the pre- and post-intervention risks, determine the change within both the treated and control communities, and finally, compute the DiD estimate to isolate the program's impact [@problem_id:4586279]. This practice solidifies the core logic of the method.", "problem": "A municipal public health department implemented a point-of-use water chlorination program in Community A to reduce diarrheal disease. Community B did not implement the program during the same period. Surveillance recorded new diarrheal disease cases and the population at risk over two eight-week windows: one immediately before the program began (pre) and one immediately after (post). Assume no migration and that the recorded populations represent the at-risk denominators for each window. The recorded counts are:\n- Community A, pre: $240$ cases among $6000$ persons.\n- Community A, post: $160$ cases among $6100$ persons.\n- Community B, pre: $210$ cases among $5900$ persons.\n- Community B, post: $200$ cases among $6000$ persons.\n\nStarting from the definition of risk (incidence proportion) as the number of new cases divided by the number of persons at risk, and invoking the core causal inference idea that, under the parallel trends assumption, common time-varying influences can be isolated by comparing temporal changes between treated and untreated groups, compute the estimate of the intervention effect on the risk difference using difference-in-differences analysis. Express your final answer as a decimal proportion and round to four significant figures.", "solution": "The aim is to estimate the causal effect of the chlorination program on the risk (incidence proportion) of diarrheal disease using the difference-in-differences framework. The fundamental base is the definition of risk and the causal inference principle that temporal changes in a treated group, net of changes in a contemporaneous untreated control, attribute the residual change to the intervention under the parallel trends assumption.\n\nFirst, define risk for any group and period. For a given group and period, let $C$ denote the number of new cases and $N$ denote the number of persons at risk during the observation window. The risk (incidence proportion) is\n$$\nR \\equiv \\frac{C}{N}.\n$$\n\nCompute risks for each group-period cell:\n- Community A (treated), pre:\n$$\nR_{A,\\mathrm{pre}} = \\frac{240}{6000} = \\frac{24}{600} = \\frac{2}{50} = 0.04.\n$$\n- Community A (treated), post:\n$$\nR_{A,\\mathrm{post}} = \\frac{160}{6100} = \\frac{16}{610} \\approx 0.026229508.\n$$\n- Community B (control), pre:\n$$\nR_{B,\\mathrm{pre}} = \\frac{210}{5900} = \\frac{21}{590} \\approx 0.035593220.\n$$\n- Community B (control), post:\n$$\nR_{B,\\mathrm{post}} = \\frac{200}{6000} = \\frac{1}{30} \\approx 0.033333333.\n$$\n\nNext, compute the temporal change in risk within each community from pre to post:\n- Treated community change:\n$$\n\\Delta R_{A} = R_{A,\\mathrm{post}} - R_{A,\\mathrm{pre}} \\approx 0.026229508 - 0.04 = -0.013770492.\n$$\n- Control community change:\n$$\n\\Delta R_{B} = R_{B,\\mathrm{post}} - R_{B,\\mathrm{pre}} \\approx 0.033333333 - 0.035593220 = -0.002259887.\n$$\n\nUnder the parallel trends assumption—that in the absence of treatment, the treated group would have experienced the same underlying temporal change in risk as the control group—the intervention effect on the risk difference is the treated group’s temporal change net of the control group’s temporal change:\n$$\n\\text{DiD RD} = \\Delta R_{A} - \\Delta R_{B} \\approx (-0.013770492) - (-0.002259887) = -0.011510605.\n$$\n\nThis value represents the estimated reduction in risk attributable to the chlorination program as a decimal proportion. Rounding to four significant figures yields\n$$\n-0.01151.\n$$", "answer": "$$\\boxed{-0.01151}$$", "id": "4586279"}, {"introduction": "After mastering the basic calculation, it's crucial to understand the assumptions that make the DiD estimate a valid measure of causal effect. This problem explores the pivotal \"parallel trends\" assumption, which posits that the treatment and control groups would have followed similar trends in the absence of the intervention. You will investigate how the choice of model—specifically, analyzing the outcome on its original scale (levels) versus its logarithmic scale—is critical for ensuring this assumption holds, especially when effects are multiplicative, as is common for rates and counts in epidemiology [@problem_id:4792531].", "problem": "A health system evaluates a policy designed to reduce avoidable hospitalizations. Two groups are observed: a treated region and a comparison region. For each group $g \\in \\{T, C\\}$ and period $t \\in \\{0,1\\}$, let $Y_{gt}$ denote the aggregate count of hospitalizations over a fixed population of size $n$ identical individuals, each observed for one period. Assume individual events are independent conditional on group and period, and that counts are generated by a Poisson process with mean equal to the product of population size and a group-period rate: $Y_{gt} \\sim \\text{Poisson}(\\mu_{gt})$ with $\\mu_{gt} = n \\lambda_{gt}$.\n\nBaseline rates are $\\lambda_{T0} = 0.20$ and $\\lambda_{C0} = 0.10$. In the absence of the policy, there is a common multiplicative secular change $g = 1.10$ such that $\\lambda_{g1}^{\\text{cf}} = g \\lambda_{g0}$. The policy is implemented only in the treated region in period $t=1$ and scales the post-treatment rate multiplicatively by $\\theta = 0.80$, so that $\\lambda_{T1} = \\theta \\cdot g \\cdot \\lambda_{T0}$, whereas $\\lambda_{C1} = g \\cdot \\lambda_{C0}$. The population size per cell is $n = 1000$.\n\nStarting from the definitions of expectations, the law of large numbers for sample cell means, and the properties of the logarithm that convert products into sums, derive the large-sample limits (i.e., probability limits under infinite replication at the cell level) of the following two two-period, two-group estimands for difference-in-differences (DiD):\n\n1) DiD on levels: the contrast formed by the difference in mean counts over time in the treated region minus the analogous difference in the comparison region.\n\n2) DiD on logs: the contrast formed by the difference in the log of the mean counts over time in the treated region minus the analogous difference in the comparison region.\n\nShow that these two estimands target different causal contrasts under the data-generating process described. Then, using the given numerical values $(n, \\lambda_{T0}, \\lambda_{C0}, g, \\theta)$, compute the large-sample value of each estimand.\n\nReport your final numerical results as a row matrix with two entries (levels first, logs second). Round your answer to four significant figures. Express the first entry in units of events per $1000$ patient-periods and recognize that the second entry is dimensionless on the natural-log scale. Do not include units in your final boxed answer.", "solution": "The problem requires us to derive the large-sample limits of two distinct difference-in-differences (DiD) estimands: one on the levels of the outcome (counts) and one on the logarithm of the outcome. The \"large-sample limit\" or probability limit is found by replacing the random sample quantities with their population expectations, a consequence of the Law of Large Numbers. The outcome variable is the aggregate count $Y_{gt}$, and its expectation is $E[Y_{gt}] = \\mu_{gt}$. We are given that $Y_{gt} \\sim \\text{Poisson}(\\mu_{gt})$ where $\\mu_{gt} = n \\lambda_{gt}$.\n\nFirst, let's establish the population means (expected counts) for each of the four cells using the provided parameters: $n = 1000$, $\\lambda_{T0} = 0.20$, $\\lambda_{C0} = 0.10$, $g = 1.10$, and $\\theta = 0.80$.\n\nThe pre-policy expected counts are:\n$$ \\mu_{T0} = n \\lambda_{T0} = 1000 \\times 0.20 = 200 $$\n$$ \\mu_{C0} = n \\lambda_{C0} = 1000 \\times 0.10 = 100 $$\n\nThe post-policy expected counts are determined by the factual rates $\\lambda_{T1} = \\theta g \\lambda_{T0}$ and $\\lambda_{C1} = g \\lambda_{C0}$.\n$$ \\lambda_{T1} = 0.80 \\times 1.10 \\times 0.20 = 0.176 $$\n$$ \\lambda_{C1} = 1.10 \\times 0.10 = 0.11 $$\nThus, the post-policy expected counts are:\n$$ \\mu_{T1} = n \\lambda_{T1} = 1000 \\times 0.176 = 176 $$\n$$ \\mu_{C1} = n \\lambda_{C1} = 1000 \\times 0.11 = 110 $$\n\n**1) DiD on Levels**\n\nThe DiD estimand on levels is the difference in the change in mean outcomes for the treated group and the change in mean outcomes for the comparison group. Its large-sample limit, which we denote as $\\Delta_{\\text{levels}}$, is given by the same contrast applied to the expected outcomes:\n$$ \\Delta_{\\text{levels}} = (E[Y_{T1}] - E[Y_{T0}]) - (E[Y_{C1}] - E[Y_{C0}]) $$\nSubstituting the expected values $\\mu_{gt}$:\n$$ \\Delta_{\\text{levels}} = (\\mu_{T1} - \\mu_{T0}) - (\\mu_{C1} - \\mu_{C0}) $$\nThe parallel trends assumption states that $E[Y_{T1}^{\\text{cf}}] - E[Y_{T0}] = E[Y_{C1}] - E[Y_{C0}]$. Here, the counterfactual trend for the treated group is $E[Y_{T1}^{\\text{cf}}] - E[Y_{T0}] = n g \\lambda_{T0} - n \\lambda_{T0} = n\\lambda_{T0}(g-1)$. The observed trend for the control group is $E[Y_{C1}] - E[Y_{C0}] = n g \\lambda_{C0} - n \\lambda_{C0} = n\\lambda_{C0}(g-1)$. Since $\\lambda_{T0} \\neq \\lambda_{C0}$, the parallel trends assumption is violated for the levels model. Thus, the DiD on levels does not recover the true average treatment effect on the treated (ATT), which is $n g \\lambda_{T0}(\\theta-1)$.\n\n**2) DiD on Logs**\n\nThe DiD estimand on logs is formed by taking the logarithm of the mean counts. Its large-sample limit, $\\Delta_{\\text{logs}}$, is:\n$$ \\Delta_{\\text{logs}} = (\\ln(E[Y_{T1}]) - \\ln(E[Y_{T0}])) - (\\ln(E[Y_{C1}]) - \\ln(E[Y_{C0}])) $$\nSubstituting $\\mu_{gt} = n \\lambda_{gt}$ and using the property $\\ln(ab) = \\ln(a) + \\ln(b)$, the $\\ln(n)$ terms cancel out, leaving:\n$$ \\Delta_{\\text{logs}} = (\\ln \\lambda_{T1} - \\ln \\lambda_{T0}) - (\\ln \\lambda_{C1} - \\ln \\lambda_{C0}) $$\nNow, we substitute the model for the rates:\n$$ \\Delta_{\\text{logs}} = (\\ln(\\theta g \\lambda_{T0}) - \\ln(\\lambda_{T0})) - (\\ln(g \\lambda_{C0}) - \\ln(\\lambda_{C0})) $$\nUsing logarithmic properties, this simplifies to:\n$$ \\Delta_{\\text{logs}} = ((\\ln\\theta + \\ln g + \\ln\\lambda_{T0}) - \\ln\\lambda_{T0}) - ((\\ln g + \\ln\\lambda_{C0}) - \\ln\\lambda_{C0}) $$\n$$ \\Delta_{\\text{logs}} = (\\ln\\theta + \\ln g) - (\\ln g) = \\ln\\theta $$\nThis estimand targets $\\ln\\theta$, which is the true multiplicative treatment effect on the log-rate scale. The DiD estimator in logs correctly identifies the causal effect because the parallel trends assumption holds on the log scale for this data-generating process.\n\n**Numerical Computation**\n\nWe now compute the values of these large-sample estimands.\n\nFor $\\Delta_{\\text{levels}}$:\n$$ \\Delta_{\\text{levels}} = (\\mu_{T1} - \\mu_{T0}) - (\\mu_{C1} - \\mu_{C0}) = (176 - 200) - (110 - 100) = -24 - 10 = -34 $$\nTo four significant figures, this is $-34.00$.\n\nFor $\\Delta_{\\text{logs}}$:\n$$ \\Delta_{\\text{logs}} = \\ln(\\theta) = \\ln(0.80) \\approx -0.22314355... $$\nRounding to four significant figures gives $-0.2231$.\n\nThe final results are $-34.00$ for the estimand on levels and $-0.2231$ for the estimand on logs.", "answer": "$$ \\boxed{ \\begin{pmatrix} -34.00  -0.2231 \\end{pmatrix} } $$", "id": "4792531"}, {"introduction": "In the real world, policies are often rolled out gradually rather than being implemented for all units at a single point in time. This \"staggered adoption\" design complicates the standard DiD analysis. This advanced problem challenges you to calculate a DiD estimate in such a scenario using a two-way fixed effects (TWFE) model and reveals how the single summary coefficient is actually a weighted average of several underlying comparisons [@problem_id:4792528]. This exercise illuminates a critical insight from modern econometric research: when treatment effects change over time, the TWFE estimator may produce biased results by placing counterintuitive negative weights on some of the true causal effects.", "problem": "A hospital system evaluates the effect of a computerized antimicrobial stewardship algorithm on the number of days of guideline-concordant antibiotic therapy per patient. Hospitals adopt in staggered fashion over two calendar periods, indexed by $t \\in \\{0,1\\}$. There are three cohorts of hospitals defined by adoption timing: early adopters ($E$) are treated in both periods, late adopters ($L$) adopt at $t=1$ only, and never adopters ($N$) do not adopt in either period. The cohort sizes are $n_{E}=100$, $n_{L}=50$, and $n_{N}=50$ hospitals, with each contributing exactly one patient per period so that the panel is balanced. The treatment indicator is $D_{gt} \\in \\{0,1\\}$ for cohort $g \\in \\{E,L,N\\}$ and period $t$, with $D_{E0}=1$, $D_{E1}=1$, $D_{L0}=0$, $D_{L1}=1$, $D_{N0}=0$, and $D_{N1}=0$.\n\nAssume the data are generated from a linear two-way fixed effects model,\n$$\ny_{it} \\;=\\; \\alpha_{i} \\;+\\; \\gamma_{t} \\;+\\; \\beta \\, D_{it} \\;+\\; \\varepsilon_{it},\n$$\nwhere $y_{it}$ is the observed number of days of guideline-concordant antibiotic therapy for unit $i$ in period $t$, $\\alpha_{i}$ are unit fixed effects, $\\gamma_{t}$ are time fixed effects, and $\\beta$ is the parameter of interest. Assume mean-zero errors and parallel trends in the absence of treatment.\n\nThe observed cohort-by-period average outcomes (days per patient) are:\n- $y_{E0} = 6$, $y_{E1} = 7.5$;\n- $y_{L0} = 5$, $y_{L1} = 8$;\n- $y_{N0} = 5$, $y_{N1} = 6$.\n\nStarting from the definitions of ordinary least squares and the Frisch–Waugh–Lovell theorem, compute the two-way fixed effects (TWFE) estimate $\\hat{\\beta}$ using only the six cohort-period cells and the cohort sizes as observation weights. In your derivation, justify how the estimator can be understood as a composition of difference-in-differences (DID) comparisons among the three cohorts and explain, in words, how a comparison between early adopters and late adopters can induce negative implicit weights on some cohort-specific treatment effects under staggered adoption with heterogeneity.\n\nReport the numerical value of $\\hat{\\beta}$ as the final answer, expressed in days per patient, and round your answer to four significant figures. Do not include units in your final boxed answer.", "solution": "The goal is to compute the two-way fixed effects (TWFE) estimate $\\hat{\\beta}$ for the model $y_{it} = \\alpha_i + \\gamma_t + \\beta D_{it} + \\varepsilon_{it}$ using the provided cohort-period average data. We will use a weighted least squares (WLS) regression on the six cohort-period cells, with weights corresponding to the cohort sizes ($n_g$).\n\nAccording to the Frisch–Waugh–Lovell (FWL) theorem, the OLS estimate $\\hat{\\beta}$ can be found by regressing the residualized outcome $\\tilde{y}$ on the residualized treatment indicator $\\tilde{D}$. The \"residualizing\" or \"demeaning\" process for a TWFE model involves subtracting the cohort-specific and time-specific means:\n$$\n\\tilde{X}_{gt} = X_{gt} - \\bar{X}_{g\\cdot} - \\bar{X}_{\\cdot t} + \\bar{X}_{\\cdot\\cdot}\n$$\nwhere $\\bar{X}_{g\\cdot}$ is the average for cohort $g$ over time, $\\bar{X}_{\\cdot t}$ is the weighted average across cohorts for period $t$, and $\\bar{X}_{\\cdot\\cdot}$ is the weighted grand average. The estimate is then calculated as:\n$$\n\\hat{\\beta} = \\frac{\\sum_{g,t} n_g \\tilde{D}_{gt} \\tilde{y}_{gt}}{\\sum_{g,t} n_g \\tilde{D}_{gt}^2}\n$$\n\n**1. Calculate Averages:**\nFirst, we calculate the required averages for the outcome $y$ and the treatment indicator $D$. The total number of hospitals is $N_{tot} = n_E + n_L + n_N = 100 + 50 + 50 = 200$.\n\n*   **Cohort averages (over time):**\n    *   $\\bar{y}_{E\\cdot} = (6 + 7.5)/2 = 6.75$; $\\bar{D}_{E\\cdot} = (1+1)/2 = 1$\n    *   $\\bar{y}_{L\\cdot} = (5 + 8)/2 = 6.5$; $\\bar{D}_{L\\cdot} = (0+1)/2 = 0.5$\n    *   $\\bar{y}_{N\\cdot} = (5 + 6)/2 = 5.5$; $\\bar{D}_{N\\cdot} = (0+0)/2 = 0$\n*   **Time averages (weighted across cohorts):**\n    *   $\\bar{y}_{\\cdot 0} = \\frac{100(6) + 50(5) + 50(5)}{200} = 5.5$; $\\bar{D}_{\\cdot 0} = \\frac{100(1) + 50(0) + 50(0)}{200} = 0.5$\n    *   $\\bar{y}_{\\cdot 1} = \\frac{100(7.5) + 50(8) + 50(6)}{200} = 7.25$; $\\bar{D}_{\\cdot 1} = \\frac{100(1) + 50(1) + 50(0)}{200} = 0.75$\n*   **Grand averages (weighted):**\n    *   $\\bar{y}_{\\cdot\\cdot} = (5.5 + 7.25)/2 = 6.375$; $\\bar{D}_{\\cdot\\cdot} = (0.5 + 0.75)/2 = 0.625$\n\n**2. Calculate Demeaned Variables:**\nUsing the formula $\\tilde{X}_{gt} = X_{gt} - \\bar{X}_{g\\cdot} - \\bar{X}_{\\cdot t} + \\bar{X}_{\\cdot\\cdot}$, we find:\n*   $\\tilde{y}_{E0} = 6 - 6.75 - 5.5 + 6.375 = 0.125$; $\\tilde{D}_{E0} = 1 - 1 - 0.5 + 0.625 = 0.125$\n*   $\\tilde{y}_{E1} = 7.5 - 6.75 - 7.25 + 6.375 = -0.125$; $\\tilde{D}_{E1} = 1 - 1 - 0.75 + 0.625 = -0.125$\n*   $\\tilde{y}_{L0} = 5 - 6.5 - 5.5 + 6.375 = -0.625$; $\\tilde{D}_{L0} = 0 - 0.5 - 0.5 + 0.625 = -0.375$\n*   $\\tilde{y}_{L1} = 8 - 6.5 - 7.25 + 6.375 = 0.625$; $\\tilde{D}_{L1} = 1 - 0.5 - 0.75 + 0.625 = 0.375$\n*   $\\tilde{y}_{N0} = 5 - 5.5 - 5.5 + 6.375 = 0.375$; $\\tilde{D}_{N0} = 0 - 0 - 0.5 + 0.625 = 0.125$\n*   $\\tilde{y}_{N1} = 6 - 5.5 - 7.25 + 6.375 = -0.375$; $\\tilde{D}_{N1} = 0 - 0 - 0.75 + 0.625 = -0.125$\n\n**3. Compute the Estimate:**\n*   **Numerator:** $\\sum n_g \\tilde{D}_{gt} \\tilde{y}_{gt} = 100(0.125 \\cdot 0.125) + 100(-0.125 \\cdot -0.125) + 50(-0.375 \\cdot -0.625) + 50(0.375 \\cdot 0.625) + 50(0.125 \\cdot 0.375) + 50(-0.125 \\cdot -0.375) = 3.125 + 23.4375 + 4.6875 = 31.25$\n*   **Denominator:** $\\sum n_g \\tilde{D}_{gt}^2 = 100(0.125^2 \\times 2) + 50(0.375^2 \\times 2) + 50(0.125^2 \\times 2) = 3.125 + 14.0625 + 1.5625 = 18.75$\n*   $\\hat{\\beta} = \\frac{31.25}{18.75} = \\frac{5}{3} \\approx 1.6667$\n\n**Conceptual Interpretation and Negative Weights**\nThe TWFE estimator in a staggered adoption setting is a weighted average of all possible $2 \\times 2$ DiD estimates. In this case, there are two such comparisons that identify an effect:\n1.  **Late vs. Never Adopters (L vs. N):** A clean DiD comparing a newly treated group to a never-treated control. The estimate is $(\\Delta y_L - \\Delta y_N) / (\\Delta D_L - \\Delta D_N) = ((8-5) - (6-5)) / (1-0) = 2$. This estimates the effect for the late adopters, $\\beta_{L1}$.\n2.  **Late vs. Early Adopters (L vs. E):** A DiD using an already-treated group as a control. The estimate is $(\\Delta y_L - \\Delta y_E) / (\\Delta D_L - \\Delta D_E) = ((8-5) - (7.5-6)) / (1-0) = 1.5$. This component is problematic if treatment effects are not constant. It estimates $\\beta_{L1} - (\\beta_{E1} - \\beta_{E0})$, where $\\beta_{gt}$ is the true effect for group $g$ at time $t$.\n\nThe overall $\\hat{\\beta}$ is a weighted average of these two components. The weights are proportional to cell sizes, giving more weight to the comparison involving the larger Early Adopter group. The exact weights are $1/3$ for the (L vs. N) comparison and $2/3$ for the (L vs. E) comparison.\n$$\n\\hat{\\beta} = \\frac{1}{3}(2) + \\frac{2}{3}(1.5) = \\frac{2}{3} + 1 = \\frac{5}{3}\n$$\nThis confirms the calculation. The problem of negative weights arises because the expectation of the overall estimator becomes $E[\\hat{\\beta}] = \\frac{1}{3}\\beta_{L1} + \\frac{2}{3}(\\beta_{L1} - (\\beta_{E1} - \\beta_{E0})) = \\beta_{L1} + \\frac{2}{3}\\beta_{E0} - \\frac{2}{3}\\beta_{E1}$. The coefficient on the treatment effect for early adopters in the second period, $\\beta_{E1}$, is negative. This happens because using an already-treated group as a control is invalid if its treatment effect evolves over time. The estimator misinterprets the change in the early group's effect as part of the common time trend, leading to bias.\n\nRounding the result to four significant figures gives $1.667$.", "answer": "$$\n\\boxed{1.667}\n$$", "id": "4792528"}]}