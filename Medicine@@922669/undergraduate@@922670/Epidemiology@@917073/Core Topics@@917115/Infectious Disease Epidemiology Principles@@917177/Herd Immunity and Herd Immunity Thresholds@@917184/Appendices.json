{"hands_on_practices": [{"introduction": "The basic reproduction number, $R_0$, represents a pathogen's potential, but the effective reproduction number, $R_e$, reflects its real-world spread amidst interventions and existing immunity. This first practice challenges you to dissect $R_e$ into its core components. By working backward from an observed $R_e$ while accounting for non-pharmaceutical interventions, you will quantify the crucial role of population susceptibility, providing a tangible measure of how close a population is to the herd immunity threshold. [@problem_id:4598126]", "problem": "A directly transmitted infection spreads in a large, homogeneously mixing population. In the absence of any immunity or interventions, each infected individual makes on average $k$ effective contacts per unit time, each contact transmits infection with probability $\\beta$, and the average duration of infectiousness is $D$. The basic reproduction number is defined as the average number of secondary infections caused by a single typical infected individual introduced into a fully susceptible population with no interventions.\n\nSuppose that two interventions are implemented that do not alter who is susceptible: non-pharmaceutical measures reduce the average contact rate by a factor of $0.70$ (equivalently, a reduction of $30$ percent in contact rate), and case isolation reduces the average infectious duration by a factor of $0.75$ (equivalently, a reduction of $25$ percent in infectious duration). On a particular date, the effective reproduction number is measured as $0.91$. Assume that immunity (from vaccination and/or prior infection) acts only by reducing the probability that a contacted individual becomes infected, and define the population-average residual susceptibility fraction, $S_{\\text{eff}}$, as the average probability that a randomly contacted individual is susceptible relative to a fully susceptible population.\n\nStarting from the definitions above and the idea that the expected number of secondary infections per case scales linearly with contact rate, per-contact transmission probability, infectious duration, and the fraction of contacts that are susceptible, derive an expression that links the basic reproduction number $R_{0}$, the intervention scaling factors, the effective reproduction number $R_{\\text{e}}$, and $S_{\\text{eff}}$. Using this expression, compute the value of $S_{\\text{eff}}$ when $R_{0} = 3.8$, the contact-rate factor is $0.70$, the infectious-duration factor is $0.75$, and $R_{\\text{e}} = 0.91$. Round your answer to $4$ significant figures and express it as a decimal (do not use a percentage sign).", "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n- Infection transmission: Directly transmitted in a large, homogeneously mixing population.\n- Average effective contact rate (baseline): $k$ per unit time.\n- Transmission probability per contact: $\\beta$.\n- Average duration of infectiousness (baseline): $D$.\n- Basic reproduction number ($R_0$): Average number of secondary infections from a single case in a fully susceptible population with no interventions.\n- Intervention 1 (non-pharmaceutical): Contact rate reduction factor is $0.70$.\n- Intervention 2 (case isolation): Infectious duration reduction factor is $0.75$.\n- Effective reproduction number on a specific date: $R_{\\text{e}} = 0.91$.\n- Immunity mechanism: Reduces the probability that a contacted individual becomes infected.\n- Population-average residual susceptibility fraction ($S_{\\text{eff}}$): Average probability a randomly contacted individual is susceptible.\n- Core assumption: The expected number of secondary infections scales linearly with contact rate, per-contact transmission probability, infectious duration, and the fraction of contacts that are susceptible.\n- Required calculation: Compute $S_{\\text{eff}}$ using $R_{0} = 3.8$, the intervention factors $0.70$ and $0.75$, and $R_{\\text{e}} = 0.91$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is based on fundamental concepts of compartmental models in epidemiology, a standard and well-established scientific field. The definitions of the basic reproduction number ($R_0$) and effective reproduction number ($R_{\\text{e}}$) are conventional. The assumption of linear scaling for the number of secondary infections is the cornerstone of these models. The parameters provided ($R_0$, $R_e$, reduction factors) are realistic for infectious diseases. The problem is self-contained, with all necessary data and definitions provided for a unique solution. The terminology is precise and objective. There are no scientific flaws, contradictions, or ambiguities.\n\n### Step 3: Verdict and Action\nThe problem is valid. A reasoned solution will be formulated.\n\n### Solution Derivation\nThe problem requires deriving a relationship between the basic reproduction number ($R_0$), the effective reproduction number ($R_{\\text{e}}$), intervention effects, and population susceptibility, and then using this relationship to compute the population-average residual susceptibility fraction, $S_{\\text{eff}}$.\n\nFirst, we formalize the definition of the basic reproduction number, $R_0$. According to the problem statement, $R_0$ is the average number of secondary infections in a fully susceptible population with no interventions. It is stated to scale linearly with the contact rate, transmission probability, and duration of infectiousness. For a fully susceptible population, the fraction of susceptible individuals is $1$.\n\nLet the baseline parameters be:\n- Average contact rate: $k$\n- Transmission probability per contact: $\\beta$\n- Average duration of infectiousness: $D$\n\nTherefore, the basic reproduction number can be expressed as the product of these quantities:\n$$R_0 = k \\cdot \\beta \\cdot D$$\nThis expression represents the average number of new infections generated by a single infectious individual in a completely susceptible population before any control measures are in place.\n\nNext, we formulate the expression for the effective reproduction number, $R_{\\text{e}}$. $R_{\\text{e}}$ accounts for the effects of interventions and the existing level of population immunity.\n\nThe problem describes two interventions:\n$1$. Non-pharmaceutical measures reduce the contact rate by a factor of $c_1 = 0.70$. The new contact rate is $c_1 k$.\n$2$. Case isolation reduces the infectious duration by a factor of $c_2 = 0.75$. The new duration is $c_2 D$.\n\nThe problem also defines the population-average residual susceptibility fraction, $S_{\\text{eff}}$, which represents the fraction of the population that is still susceptible to infection. This factor modifies the number of effective contacts that can lead to a new infection.\n\nUsing the same linear scaling principle, the effective reproduction number, $R_{\\text{e}}$, is the product of the modified parameters:\n$$R_{\\text{e}} = (\\text{new contact rate}) \\cdot (\\text{transmission probability}) \\cdot (\\text{new duration}) \\cdot (\\text{susceptible fraction})$$\nSubstituting the expressions for the modified parameters, we get:\n$$R_{\\text{e}} = (c_1 k) \\cdot \\beta \\cdot (c_2 D) \\cdot S_{\\text{eff}}$$\nWe can rearrange this equation to group the baseline parameters:\n$$R_{\\text{e}} = c_1 c_2 (k \\beta D) S_{\\text{eff}}$$\nRecognizing that the term $(k \\beta D)$ is the definition of $R_0$, we can substitute it into the equation:\n$$R_{\\text{e}} = c_1 c_2 R_0 S_{\\text{eff}}$$\nThis is the required expression linking $R_{\\text{e}}$, $R_0$, the intervention scaling factors $c_1$ and $c_2$, and the effective susceptibility $S_{\\text{eff}}$.\n\nNow, we must solve for $S_{\\text{eff}}$ and compute its value. Rearranging the derived formula gives:\n$$S_{\\text{eff}} = \\frac{R_{\\text{e}}}{c_1 c_2 R_0}$$\nWe are given the following values:\n- $R_{\\text{e}} = 0.91$\n- $R_0 = 3.8$\n- $c_1 = 0.70$\n- $c_2 = 0.75$\n\nSubstituting these values into the expression for $S_{\\text{eff}}$:\n$$S_{\\text{eff}} = \\frac{0.91}{(0.70)(0.75)(3.8)}$$\nFirst, we calculate the product in the denominator:\n$$(0.70) \\cdot (0.75) = 0.525$$\n$$(0.525) \\cdot (3.8) = 1.995$$\nNow, we perform the final division:\n$$S_{\\text{eff}} = \\frac{0.91}{1.995}$$\n$$S_{\\text{eff}} \\approx 0.45614035...$$\nThe problem asks for the answer to be rounded to $4$ significant figures.\n$$S_{\\text{eff}} \\approx 0.4561$$\nThis value means that, on the specified date, the combined effects of vaccination and prior infection have rendered the population effectively $45.61\\%$ as susceptible as a completely naive population.", "answer": "$$\\boxed{0.4561}$$", "id": "4598126"}, {"introduction": "Achieving herd immunity through vaccination depends critically on the specific properties of the vaccine used. This exercise explores the crucial distinction between 'all-or-nothing' (sterilizing) vaccines that completely block infection and 'leaky' vaccines that reduce susceptibility and transmission. By deriving and comparing the herd immunity thresholds for both types, you will gain a deeper appreciation for how different vaccine actions translate into population-level impact and why this matters for public health strategy. [@problem_id:4598125]", "problem": "A well-mixed host population faces a directly transmitted pathogen with basic reproduction number $R_0 = 3$. Two vaccination strategies are available, implemented at random coverage $p$ in the population:\n\n1) An all-or-nothing sterilizing vaccine: each vaccinated individual is completely protected against infection with probability $e_{\\text{ster}} = 0.70$ and otherwise remains fully susceptible and, if infected, fully infectious.\n\n2) A leaky vaccine: each vaccinated individual has multiplicative reductions in both susceptibility and infectiousness. Specifically, susceptibility is reduced by a factor $(1 - \\epsilon_s)$ with $\\epsilon_s = 0.50$, and, conditional on breakthrough infection, infectiousness is reduced by a factor $(1 - \\epsilon_i)$ with $\\epsilon_i = 0.30$.\n\nStarting from first principles, use the following foundations:\n\n- The basic reproduction number $R_0$ is the dominant eigenvalue (spectral radius) of the next-generation operator in a fully susceptible, unvaccinated population.\n\n- Under random vaccination in a homogeneous mixing population, the effective reproduction number $R_e$ equals the dominant eigenvalue of the appropriately modified next-generation operator that accounts for the fraction susceptible and the per-infection infectiousness of each type.\n\n- In the all-or-nothing sterilizing case, a fraction $p e_{\\text{ster}}$ of the population is fully immune, while the remainder has baseline susceptibility and infectiousness.\n\n- In the leaky case, all vaccinated individuals experience a multiplicative reduction of susceptibility by $(1 - \\epsilon_s)$, and those who become infected have infectiousness multiplied by $(1 - \\epsilon_i)$.\n\nFor each vaccine, derive from these principles an expression for the herd-immunity coverage threshold $p^{\\star}$ defined implicitly by the condition $R_e(p^{\\star}) = 1$. Then, compute the ratio $p^{\\star}_{\\text{leaky}} / p^{\\star}_{\\text{ster}}$ for the parameters given above. Express your final answer as a decimal and round your final answer to four significant figures.", "solution": "The user wants to find the herd immunity threshold $p^{\\star}$ for two different vaccine types and then compute the ratio of these thresholds. The herd immunity threshold is defined as the vaccination coverage $p$ at which the effective reproduction number $R_e$ is equal to $1$.\n\nFirst, let's analyze the **all-or-nothing sterilizing vaccine**.\nThis vaccine confers complete protection to a fraction $e_{\\text{ster}}$ of vaccinated individuals. At a population vaccination coverage $p$, a fraction $p \\cdot e_{\\text{ster}}$ of the total population becomes fully immune and is removed from the susceptible pool. The remaining fraction of the population, $1 - p e_{\\text{ster}}$, remains fully susceptible.\n\nThe basic reproduction number, $R_0$, is the average number of secondary infections caused by a single infectious individual in a fully susceptible population. The effective reproduction number, $R_e$, in a partially susceptible population is $R_0$ scaled by the fraction of the population that is susceptible.\n$$R_e(p) = R_0 (1 - p e_{\\text{ster}})$$\nThe herd immunity threshold, $p^{\\star}_{\\text{ster}}$, is the coverage at which $R_e(p^{\\star}_{\\text{ster}}) = 1$.\n$$1 = R_0 (1 - p^{\\star}_{\\text{ster}} e_{\\text{ster}})$$\nSolving for $p^{\\star}_{\\text{ster}}$:\n$$\\frac{1}{R_0} = 1 - p^{\\star}_{\\text{ster}} e_{\\text{ster}}$$\n$$p^{\\star}_{\\text{ster}} e_{\\text{ster}} = 1 - \\frac{1}{R_0}$$\n$$p^{\\star}_{\\text{ster}} = \\frac{1 - \\frac{1}{R_0}}{e_{\\text{ster}}}$$\n\nNext, we analyze the **leaky vaccine**.\nThis vaccine reduces susceptibility by a factor $(1 - \\epsilon_s)$ and, for breakthrough infections, reduces infectiousness by a factor $(1 - \\epsilon_i)$. We follow the instruction to use the next-generation operator formalism. We stratify the population into two groups: unvaccinated (U) and vaccinated (V). The fractions of the population in these groups are $(1-p)$ and $p$, respectively.\n\nLet $K$ be the next-generation matrix, where $K_{ij}$ is the expected number of secondary infections in group $i$ produced by a single infected individual in group $j$, with $i,j \\in \\{U, V\\}$. The matrix elements are proportional to $R_0$, the infectiousness of the source type, the susceptibility of the target type, and the fraction of the population in the target type.\n\nThe relative susceptibilities are $\\sigma_U = 1$ and $\\sigma_V = 1 - \\epsilon_s$.\nThe relative infectiousness values are $\\tau_U = 1$ and $\\tau_V = 1 - \\epsilon_i$.\n\nThe matrix elements are as follows:\n$K_{UU}$: Infections from an unvaccinated source to unvaccinated targets.\n$$K_{UU} = R_0 \\cdot \\tau_U \\cdot \\sigma_U \\cdot (1-p) = R_0 (1-p)$$\n$K_{VU}$: Infections from an unvaccinated source to vaccinated targets.\n$$K_{VU} = R_0 \\cdot \\tau_U \\cdot \\sigma_V \\cdot p = R_0 (1 - \\epsilon_s) p$$\n$K_{UV}$: Infections from a vaccinated source to unvaccinated targets.\n$$K_{UV} = R_0 \\cdot \\tau_V \\cdot \\sigma_U \\cdot (1-p) = R_0 (1 - \\epsilon_i) (1-p)$$\n$K_{VV}$: Infections from a vaccinated source to vaccinated targets.\n$$K_{VV} = R_0 \\cdot \\tau_V \\cdot \\sigma_V \\cdot p = R_0 (1 - \\epsilon_i) (1 - \\epsilon_s) p$$\n\nThe next-generation matrix is:\n$$K = \\begin{pmatrix} K_{UU} & K_{UV} \\\\ K_{VU} & K_{VV} \\end{pmatrix} = R_0 \\begin{pmatrix} 1-p & (1-\\epsilon_i)(1-p) \\\\ p(1-\\epsilon_s) & p(1-\\epsilon_s)(1-\\epsilon_i) \\end{pmatrix}$$\nThis is a rank-$1$ matrix, as the second column is $(1-\\epsilon_i)$ times the first column. It can be written as the outer product of two vectors:\n$$K = R_0 \\begin{pmatrix} 1-p \\\\ p(1-\\epsilon_s) \\end{pmatrix} \\begin{pmatrix} 1 & 1-\\epsilon_i \\end{pmatrix}$$\nThe dominant eigenvalue (spectral radius) of such a matrix $\\mathbf{u}\\mathbf{v}^T$ is $\\mathbf{v}^T\\mathbf{u}$. Therefore, $R_e(p)$ is:\n$$R_e(p) = R_0 \\left( \\begin{pmatrix} 1 & 1-\\epsilon_i \\end{pmatrix} \\begin{pmatrix} 1-p \\\\ p(1-\\epsilon_s) \\end{pmatrix} \\right)$$\n$$R_e(p) = R_0 [1 \\cdot (1-p) + (1-\\epsilon_i) \\cdot p(1-\\epsilon_s)]$$\n$$R_e(p) = R_0 [ (1-p) + p(1-\\epsilon_s)(1-\\epsilon_i) ]$$\nTo find the herd immunity threshold $p^{\\star}_{\\text{leaky}}$, we set $R_e(p^{\\star}_{\\text{leaky}}) = 1$:\n$$1 = R_0 [ (1-p^{\\star}_{\\text{leaky}}) + p^{\\star}_{\\text{leaky}}(1-\\epsilon_s)(1-\\epsilon_i) ]$$\n$$\\frac{1}{R_0} = 1 - p^{\\star}_{\\text{leaky}} + p^{\\star}_{\\text{leaky}}(1-\\epsilon_s-\\epsilon_i+\\epsilon_s\\epsilon_i)$$\n$$\\frac{1}{R_0} = 1 - p^{\\star}_{\\text{leaky}}[1 - (1-\\epsilon_s)(1-\\epsilon_i)]$$\n$$p^{\\star}_{\\text{leaky}}[1 - (1-\\epsilon_s)(1-\\epsilon_i)] = 1 - \\frac{1}{R_0}$$\n$$p^{\\star}_{\\text{leaky}} = \\frac{1 - \\frac{1}{R_0}}{1 - (1-\\epsilon_s)(1-\\epsilon_i)}$$\n\nFinally, we compute the ratio $p^{\\star}_{\\text{leaky}} / p^{\\star}_{\\text{ster}}$.\n$$\\frac{p^{\\star}_{\\text{leaky}}}{p^{\\star}_{\\text{ster}}} = \\frac{\\frac{1 - 1/R_0}{1 - (1-\\epsilon_s)(1-\\epsilon_i)}}{\\frac{1 - 1/R_0}{e_{\\text{ster}}}}$$\nThe term $(1 - 1/R_0)$ cancels, yielding:\n$$\\frac{p^{\\star}_{\\text{leaky}}}{p^{\\star}_{\\text{ster}}} = \\frac{e_{\\text{ster}}}{1 - (1-\\epsilon_s)(1-\\epsilon_i)}$$\nNow, we substitute the given numerical values: $e_{\\text{ster}} = 0.70$, $\\epsilon_s = 0.50$, and $\\epsilon_i = 0.30$.\n$$\\frac{p^{\\star}_{\\text{leaky}}}{p^{\\star}_{\\text{ster}}} = \\frac{0.70}{1 - (1-0.50)(1-0.30)}$$\n$$\\frac{p^{\\star}_{\\text{leaky}}}{p^{\\star}_{\\text{ster}}} = \\frac{0.70}{1 - (0.50)(0.70)}$$\n$$\\frac{p^{\\star}_{\\text{leaky}}}{p^{\\star}_{\\text{ster}}} = \\frac{0.70}{1 - 0.35}$$\n$$\\frac{p^{\\star}_{\\text{leaky}}}{p^{\\star}_{\\text{ster}}} = \\frac{0.70}{0.65} = \\frac{70}{65} = \\frac{14}{13}$$\nAs a decimal, this is $14 \\div 13 \\approx 1.076923...$.\nRounding to four significant figures, the result is $1.077$.", "answer": "$$\\boxed{1.077}$$", "id": "4598125"}, {"introduction": "Epidemiological parameters like $R_0$ and vaccine efficacy are rarely known with perfect certainty. Public health policy must therefore be robust enough to succeed under a range of plausible scenarios. This final practice challenges you to move beyond single-point estimates and design a vaccination strategy that guarantees herd immunity even in a worst-case scenario, bridging the gap between theoretical models and the real-world demands of robust policy-making. [@problem_id:4598112]", "problem": "You are asked to design a program that computes robust herd immunity thresholds under uncertainty using a principled matrix-based epidemiological framework. Begin from the Susceptible-Infectious-Recovered (SIR) compartmental model and the next-generation matrix formalism. The basic reproduction number $R_0$ is defined as the spectral radius (i.e., the largest absolute eigenvalue) of the next-generation matrix $\\mathbf{G}$, denoted by $\\rho(\\mathbf{G})$. For a population partitioned into $n$ groups with contact structure captured by $\\mathbf{G}_{\\text{base}} \\in \\mathbb{R}^{n \\times n}$, assume a leaky vaccine that reduces susceptibility in group $i$ by a factor $e_i \\in [0,1]$ when coverage $p_i \\in [0,1]$ is applied (i.e., residual susceptibility in group $i$ is $1 - e_i p_i$). Consider uniform coverage across groups so that $p_i = p$ for all $i$.\n\nUncertainty is present in the basic reproduction number and in vaccine efficacies. Assume the next-generation matrix scales proportionally with the actual basic reproduction number $R$ via\n$$\n\\mathbf{G}(R) = \\frac{R}{\\rho(\\mathbf{G}_{\\text{base}})} \\, \\mathbf{G}_{\\text{base}},\n$$\nwith $R$ ranging over $[R_{\\min}, R_{\\max}]$. Assume vaccine efficacies are uncertain with $e_i \\in [e_i^{\\min}, e_i^{\\max}]$. Under vaccination at uniform coverage $p$, the effective next-generation matrix is\n$$\n\\mathbf{G}_{\\text{eff}}(p,R,\\mathbf{e}) = \\mathrm{diag}\\big(1 - e_1 p, \\dots, 1 - e_n p \\big) \\, \\mathbf{G}(R).\n$$\nHerd immunity (control of spread at introduction) is achieved if the effective reproduction number, equal to the spectral radius $\\rho\\big(\\mathbf{G}_{\\text{eff}}(p,R,\\mathbf{e})\\big)$, is less than or equal to $1$.\n\nYour task is to compute the minimal uniform coverage $p \\in [0,1]$ that satisfies the following robust herd immunity constraint:\n$$\n\\max_{R \\in [R_{\\min}, R_{\\max}], \\, e_i \\in [e_i^{\\min}, e_i^{\\max}]} \\; \\rho\\big(\\mathbf{G}_{\\text{eff}}(p,R,\\mathbf{e})\\big) \\le 1.\n$$\nIf no $p \\in [0,1]$ can satisfy the constraint, report infeasibility with the value $-1$. Express coverage values as decimals in $[0,1]$ (not with a percentage sign), rounded to six decimal places.\n\nThe program must:\n- Use the spectral radius definition for matrices and apply it to $\\mathbf{G}_{\\text{eff}}(p,R,\\mathbf{e})$.\n- Determine the robust worst-case over the specified uncertainty ranges and find the minimal coverage $p$ that ensures herd immunity in the worst case.\n- Guarantee numerical correctness to within an absolute tolerance of $10^{-8}$ when checking the constraint.\n- If the constraint is satisfied at $p = 0$, output $0.000000$; if it is not satisfied even at $p = 1$, output $-1$ for that test case.\n\nTest suite:\n- Case $1$ (single-group, leaky vaccine, general case):\n  - $$\\mathbf{G}_{\\text{base}} = \\begin{bmatrix} 1.0 \\end{bmatrix}, \\quad R_{\\min} = 2.0, \\quad R_{\\max} = 3.0,$$\n  - $$e^{\\min} = [0.8], \\quad e^{\\max} = [0.95].$$\n- Case $2$ ($2$-group symmetric mixing, heterogeneous efficacy):\n  - $$\\mathbf{G}_{\\text{base}} = \\begin{bmatrix} 1.5 & 0.5 \\\\ 0.5 & 1.5 \\end{bmatrix}, \\quad R_{\\min} = 1.8, \\quad R_{\\max} = 2.5,$$\n  - $$e^{\\min} = [0.9, \\, 0.6], \\quad e^{\\max} = [0.95, \\, 0.85].$$\n- Case $3$ (boundary case where control holds without vaccination):\n  - $$\\mathbf{G}_{\\text{base}} = \\begin{bmatrix} 1.2 & 0.2 \\\\ 0.3 & 0.7 \\end{bmatrix}, \\quad R_{\\min} = 0.9, \\quad R_{\\max} = 1.0,$$\n  - $$e^{\\min} = [0.6, \\, 0.6], \\quad e^{\\max} = [0.95, \\, 0.95].$$\n- Case $4$ (infeasible: vaccine has no effect):\n  - $$\\mathbf{G}_{\\text{base}} = \\begin{bmatrix} 1.0 \\end{bmatrix}, \\quad R_{\\min} = 1.2, \\quad R_{\\max} = 1.5,$$\n  - $$e^{\\min} = [0.0], \\quad e^{\\max} = [0.5].$$\n\nFinal output format:\n- Your program should produce a single line of output containing the minimal robust coverage values for the four cases, as a comma-separated list of decimals rounded to six places, enclosed in square brackets. For example, the output must look like\n$$\n[\\text{case1},\\text{case2},\\text{case3},\\text{case4}]\n$$\nwhere each entry is a decimal in $[0,1]$ rounded to six places, or $-1$ if infeasible.", "solution": "The user has provided a problem statement that requires formal validation prior to any attempt at a solution.\n\n### Step 1: Extract Givens\nThe problem provides the following data, definitions, and conditions:\n- **Model Framework**: Susceptible-Infectious-Recovered (SIR) compartmental model using the next-generation matrix formalism.\n- **Population Structure**: The population is partitioned into $n$ groups.\n- **Base Next-Generation Matrix**: $\\mathbf{G}_{\\text{base}} \\in \\mathbb{R}^{n \\times n}$ captures the contact structure. All its elements are implicitly non-negative as per the underlying epidemiological model.\n- **Basic Reproduction Number**: Defined as the spectral radius of the next-generation matrix, $R_0 = \\rho(\\mathbf{G})$.\n- **Uncertainty in Reproduction Number**: The actual next-generation matrix $\\mathbf{G}(R)$ is scaled by the true basic reproduction number $R$, where $R \\in [R_{\\min}, R_{\\max}]$. The scaling relation is $\\mathbf{G}(R) = \\frac{R}{\\rho(\\mathbf{G}_{\\text{base}})} \\, \\mathbf{G}_{\\text{base}}$.\n- **Vaccination Model**: A leaky vaccine is applied with uniform coverage $p \\in [0,1]$ across all groups.\n- **Vaccine Efficacy**: The vaccine efficacy for group $i$, denoted $e_i \\in [0,1]$, reduces susceptibility by a factor of $e_i p_i$. The residual susceptibility in group $i$ is $1 - e_i p_i$. For uniform coverage $p_i=p$, this is $1 - e_i p$.\n- **Uncertainty in Vaccine Efficacy**: For each group $i$, the efficacy $e_i$ lies in the interval $[e_i^{\\min}, e_i^{\\max}]$.\n- **Effective Next-Generation Matrix**: Under vaccination, the effective matrix is given by $\\mathbf{G}_{\\text{eff}}(p,R,\\mathbf{e}) = \\mathrm{diag}\\big(1 - e_1 p, \\dots, 1 - e_n p \\big) \\, \\mathbf{G}(R)$.\n- **Herd Immunity Condition**: Achieved if the effective reproduction number, $\\rho\\big(\\mathbf{G}_{\\text{eff}}(p,R,\\mathbf{e})\\big)$, is less than or equal to $1$.\n- **Objective**: Find the minimal uniform coverage $p \\in [0,1]$ that satisfies the robust herd immunity constraint:\n$$\n\\max_{R \\in [R_{\\min}, R_{\\max}], \\, e_i \\in [e_i^{\\min}, e_i^{\\max}]} \\; \\rho\\big(\\mathbf{G}_{\\text{eff}}(p,R,\\mathbf{e})\\big) \\le 1.\n$$\n- **Infeasibility**: If no $p \\in [0,1]$ satisfies the constraint, the result is $-1$.\n- **Numerical Specifications**:\n    - Output rounding: six decimal places.\n    - Constraint checking tolerance: $10^{-8}$.\n    - Special cases: If the constraint is met at $p = 0$, output $0.000000$. If it is not met at $p=1$, output $-1$.\n- **Test Cases**: Four specific test cases are provided with matrices $\\mathbf{G}_{\\text{base}}$ and parameter ranges $[R_{\\min}, R_{\\max}]$, $[e_i^{\\min}, e_i^{\\max}]$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is now validated against the required criteria.\n\n- **Scientifically Grounded**: The problem is firmly rooted in mathematical epidemiology. The use of the SIR model, the next-generation matrix, its spectral radius as the reproduction number ($R_0$), and the modeling of leaky vaccines are all standard, well-established concepts. The formulation of robust control under uncertainty is a sophisticated and relevant topic in this field. The problem is scientifically sound and free of pseudoscience.\n\n- **Well-Posed**: The problem is well-posed. It asks for the minimum of a variable $p$ over a compact interval $[0,1]$ subject to a clearly defined inequality constraint. The function within the constraint involves maximizing a continuous function (spectral radius) over a compact set (a hyperrectangle of parameters), which guarantees that the maximum exists. This structure ensures that a unique, stable, and meaningful solution for $p$ either exists within $[0,1]$ or can be proven not to.\n\n- **Objective**: The problem is stated in precise, objective, and mathematical language. All terms are defined, and the objective is unambiguous. There are no subjective or opinion-based statements.\n\nThe problem does not exhibit any of the invalidating flaws:\n1.  **Scientific/Factual Unsoundness**: None. The premises are consistent with established epidemiological theory.\n2.  **Non-Formalizable/Irrelevant**: The problem is highly formalizable and directly concerns herd immunity thresholds.\n3.  **Incomplete/Contradictory Setup**: All necessary parameters ($\\mathbf{G}_{\\text{base}}$, $R$ ranges, $e_i$ ranges) are provided for each test case. The setup is self-contained and consistent.\n4.  **Unrealistic/Infeasible**: The parameter values given in the test cases are within plausible ranges for infectious diseases and vaccine characteristics.\n5.  **Ill-Posed/Poorly Structured**: The problem structure is sound and leads to a solvable optimization problem.\n6.  **Pseudo-Profound/Trivial**: The problem requires non-trivial analysis to simplify the robust constraint and a robust numerical algorithm for its solution, which is a meaningful task.\n7.  **Outside Scientific Verifiability**: The claims and results can be mathematically derived and numerically verified.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be developed.\n\n### Solution\n\nThe objective is to find the minimal uniform vaccination coverage $p \\in [0,1]$ that ensures herd immunity under worst-case uncertainty. The robust constraint is:\n$$\n\\max_{R \\in [R_{\\min}, R_{\\max}], \\, e_i \\in [e_i^{\\min}, e_i^{\\max}]} \\; \\rho\\left(\\mathbf{G}_{\\text{eff}}(p,R,\\mathbf{e})\\right) \\le 1\n$$\nSubstituting the definitions for $\\mathbf{G}_{\\text{eff}}$ and $\\mathbf{G}(R)$, we have:\n$$\n\\max_{R, \\mathbf{e}} \\; \\rho\\left( \\mathrm{diag}\\big(1 - e_1 p, \\dots, 1 - e_n p \\big) \\, \\frac{R}{\\rho(\\mathbf{G}_{\\text{base}})} \\, \\mathbf{G}_{\\text{base}} \\right) \\le 1\n$$\nThe term $\\frac{R}{\\rho(\\mathbf{G}_{\\text{base}})}$ is a non-negative scalar. A property of the spectral radius is that for any matrix $\\mathbf{A}$ and scalar $\\alpha$, $\\rho(\\alpha \\mathbf{A}) = |\\alpha| \\rho(\\mathbf{A})$. Since $R \\ge 0$ and $\\rho(\\mathbf{G}_{\\text{base}}) \\ge 0$, we can factor this scalar out:\n$$\n\\max_{R, \\mathbf{e}} \\; \\frac{R}{\\rho(\\mathbf{G}_{\\text{base}})} \\rho\\left( \\mathrm{diag}\\big(1 - e_1 p, \\dots, 1 - e_n p \\big) \\, \\mathbf{G}_{\\text{base}} \\right) \\le 1\n$$\nThe maximization can now be analyzed in two parts: over $R$ and over $\\mathbf{e}$.\n\n**1. Worst-Case Analysis**\n\n- **Maximization over $R$**: The entire expression is linear in $R$. To maximize it, we must choose the largest possible value for $R$ from its uncertainty interval. Thus, the worst-case $R$ is $R_{\\max}$.\n\n- **Maximization over $\\mathbf{e}$**: Let $\\mathbf{M}(p, \\mathbf{e}) = \\mathrm{diag}\\big(1 - e_1 p, \\dots, 1 - e_n p \\big) \\, \\mathbf{G}_{\\text{base}}$. We need to find the vector of efficacies $\\mathbf{e}$ in the hyperrectangle defined by $[e_i^{\\min}, e_i^{\\max}]$ that maximizes $\\rho(\\mathbf{M}(p, \\mathbf{e}))$.\nThe matrix $\\mathbf{G}_{\\text{base}}$ represents transmission rates and is therefore a non-negative matrix (all its entries are greater than or equal to zero). The term $1 - e_i p$ is also non-negative, since $p \\in [0,1]$ and $e_i \\in [0,1]$. Consequently, $\\mathbf{M}(p, \\mathbf{e})$ is a non-negative matrix.\nBy the Perron-Frobenius theorem for non-negative matrices, the spectral radius $\\rho(\\mathbf{M}(p, \\mathbf{e}))$ is an eigenvalue, and it is a non-decreasing function of the entries of the matrix. To maximize $\\rho(\\mathbf{M}(p, \\mathbf{e}))$, we must make its entries as large as possible. The entries of $\\mathbf{M}(p, \\mathbf{e})$ are given by $(1 - e_i p) (\\mathbf{G}_{\\text{base}})_{ij}$. Since $(\\mathbf{G}_{\\text{base}})_{ij} \\ge 0$ and $p \\ge 0$, the term $(1 - e_i p)$ is maximized when $e_i$ is minimized.\nTherefore, the worst-case efficacy for each group $i$ is its minimum possible value, $e_i^{\\min}$.\n\nCombining these findings, the robust constraint simplifies significantly. We only need to consider a single scenario corresponding to the worst-case parameters $R=R_{\\max}$ and $\\mathbf{e}=\\mathbf{e}^{\\min}$. Let $R_{\\text{eff, robust}}(p)$ be the effective reproduction number under these worst-case conditions. The problem reduces to finding the minimal $p \\in [0,1]$ such that:\n$$\nR_{\\text{eff, robust}}(p) = \\frac{R_{\\max}}{\\rho(\\mathbf{G}_{\\text{base}})} \\rho\\left( \\mathrm{diag}\\big(1 - e_1^{\\min} p, \\dots, 1 - e_n^{\\min} p \\big) \\, \\mathbf{G}_{\\text{base}} \\right) \\le 1\n$$\nLet's define the matrix $\\mathbf{M}(p) = \\mathrm{diag}(1 - \\mathbf{e}^{\\min} p) \\, \\mathbf{G}_{\\text{base}}$. The function $g(p) = \\rho(\\mathbf{M}(p))$ is a monotonically non-increasing function of $p$. This is because increasing $p$ (for $p \\ge 0$) can only decrease the entries of the non-negative matrix $\\mathbf{M}(p)$, which in turn cannot increase its spectral radius. Consequently, $R_{\\text{eff, robust}}(p)$ is also a monotonically non-increasing function of $p$.\n\n**2. Algorithmic Solution**\n\nThe monotonic nature of $R_{\\text{eff, robust}}(p)$ makes this problem amenable to a binary search (bisection method) to find the value of $p$ that satisfies $R_{\\text{eff, robust}}(p) = 1$.\n\nThe algorithm for each test case is as follows:\n\n1.  **Pre-computation**: Calculate $\\rho_0 = \\rho(\\mathbf{G}_{\\text{base}})$. This is a constant for each case. The spectral radius is found by computing all eigenvalues of $\\mathbf{G}_{\\text{base}}$ and taking the one with the largest magnitude.\n\n2.  **Define the Target Function**: Let $f(p) = R_{\\text{eff, robust}}(p) - 1$. We are looking for the smallest $p \\in [0,1]$ such that $f(p) \\le 0$.\n\n3.  **Boundary Checks**:\n    - Evaluate at $p=0$: $R_{\\text{eff, robust}}(0) = \\frac{R_{\\max}}{\\rho_0} \\rho(\\mathbf{G}_{\\text{base}}) = R_{\\max}$. If $R_{\\max} \\le 1$, herd immunity is already achieved without any vaccination. The minimal coverage is $p=0$.\n    - Evaluate at $p=1$: Calculate $R_{\\text{eff, robust}}(1)$. If $R_{\\text{eff, robust}}(1) > 1$ (within the specified numerical tolerance of $10^{-8}$), then even $100\\%$ coverage is insufficient to guarantee herd immunity in the worst case. The problem is infeasible, so the result is $-1$.\n\n4.  **Bisection Search**: If a solution exists between $p=0$ and $p=1$ (i.e., $R_{\\text{eff, robust}}(0) > 1$ and $R_{\\text{eff, robust}}(1) \\le 1$), we use bisection to find it.\n    - Initialize search interval: $[p_{\\text{low}}, p_{\\text{high}}] = [0, 1]$.\n    - Iterate a sufficient number of times (e.g., $100$ iterations) to guarantee convergence to high precision:\n        a. Calculate the midpoint $p_{\\text{mid}} = (p_{\\text{low}} + p_{\\text{high}}) / 2$.\n        b. Evaluate $R_{\\text{eff, robust}}(p_{\\text{mid}})$.\n        c. If $R_{\\text{eff, robust}}(p_{\\text{mid}}) \\le 1$, it means coverage $p_{\\text{mid}}$ is sufficient. The optimal solution may be smaller, so we search in the lower half: set $p_{\\text{high}} = p_{\\text{mid}}$.\n        d. If $R_{\\text{eff, robust}}(p_{\\text{mid}}) > 1$, coverage $p_{\\text{mid}}$ is insufficient. The solution must be larger, so we search in the upper half: set $p_{\\text{low}} = p_{\\text{mid}}$.\n    - The result of the search is $p_{\\text{high}}$, which converges to the minimal required coverage.\n\nThis algorithm provides a robust and numerically stable method to compute the required minimal coverage for each test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes robust herd immunity thresholds for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"G_base\": np.array([[1.0]]),\n            \"R_min\": 2.0, \"R_max\": 3.0,\n            \"e_min\": np.array([0.8]), \"e_max\": np.array([0.95])\n        },\n        {\n            \"G_base\": np.array([[1.5, 0.5], [0.5, 1.5]]),\n            \"R_min\": 1.8, \"R_max\": 2.5,\n            \"e_min\": np.array([0.9, 0.6]), \"e_max\": np.array([0.95, 0.85])\n        },\n        {\n            \"G_base\": np.array([[1.2, 0.2], [0.3, 0.7]]),\n            \"R_min\": 0.9, \"R_max\": 1.0,\n            \"e_min\": np.array([0.6, 0.6]), \"e_max\": np.array([0.95, 0.95])\n        },\n        {\n            \"G_base\": np.array([[1.0]]),\n            \"R_min\": 1.2, \"R_max\": 1.5,\n            \"e_min\": np.array([0.0]), \"e_max\": np.array([0.5])\n        }\n    ]\n\n    results = []\n    \n    # Numerical tolerance for checking the constraint rho <= 1\n    TOL = 1e-8\n    \n    for case in test_cases:\n        G_base = case[\"G_base\"]\n        R_max = case[\"R_max\"]\n        e_min = case[\"e_min\"]\n\n        # Calculate the spectral radius of the base matrix\n        try:\n            eigvals_base = np.linalg.eigvals(G_base)\n            rho_base = np.max(np.abs(eigvals_base))\n        except np.linalg.LinAlgError:\n            # Handle cases with non-converging eigenvalue algorithms, though unlikely here\n            results.append(-2.0) # Using a distinct error code\n            continue\n        \n        # Avoid division by zero, although rho_base > 0 for epidemiologically relevant matrices\n        if rho_base == 0:\n            # If rho_base is 0, R_eff is always 0. Immunity is achieved at p=0 unless R_max is infinite.\n            # Assuming R_max is finite.\n            results.append(0.0)\n            continue\n\n        def get_robust_R_eff(p):\n            \"\"\"\n            Calculates the robust effective reproduction number for a given coverage p.\n            This corresponds to the worst-case scenario (R_max, e_min).\n            \"\"\"\n            # Create the diagonal matrix of residual susceptibilities\n            susceptibility_factors = 1.0 - e_min * p\n            D_p = np.diag(susceptibility_factors)\n            \n            # Form the effective next-generation matrix under worst-case assumptions\n            G_eff = D_p @ G_base\n            \n            # Calculate its spectral radius\n            try:\n                eigvals_eff = np.linalg.eigvals(G_eff)\n                rho_eff = np.max(np.abs(eigvals_eff))\n            except np.linalg.LinAlgError:\n                return float('inf') # Return a large number if eigenvalue computation fails\n            \n            # Calculate the final robust R_eff\n            return (R_max / rho_base) * rho_eff\n\n        # Boundary check at p = 0\n        if get_robust_R_eff(0) <= 1.0 + TOL:\n            results.append(0.0)\n            continue\n            \n        # Boundary check at p = 1\n        if get_robust_R_eff(1) > 1.0 + TOL:\n            results.append(-1.0)\n            continue\n\n        # Bisection method to find the minimal p\n        p_low = 0.0\n        p_high = 1.0\n        \n        # 100 iterations are sufficient for double precision convergence\n        for _ in range(100):\n            p_mid = (p_low + p_high) / 2.0\n            if get_robust_R_eff(p_mid) <= 1.0:\n                # This coverage is sufficient, try for a smaller p\n                p_high = p_mid\n            else:\n                # This coverage is insufficient, must be higher\n                p_low = p_mid\n        \n        # p_high converges to the minimal required coverage\n        results.append(p_high)\n\n    # Format the results as specified.\n    # Rounding is applied here for final output formatting.\n    formatted_results = []\n    for res in results:\n        if res == -1.0:\n            formatted_results.append(\"-1\")\n        else:\n            formatted_results.append(f\"{res:.6f}\")\n\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4598112"}]}