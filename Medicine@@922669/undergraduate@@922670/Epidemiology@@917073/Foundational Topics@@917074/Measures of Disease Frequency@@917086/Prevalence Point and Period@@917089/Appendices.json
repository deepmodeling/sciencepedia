{"hands_on_practices": [{"introduction": "In epidemiology, precision is paramount, as a measure is only as good as its definition. This exercise [@problem_id:4623467] sharpens your conceptual toolkit by challenging you to defend the correct definition of prevalence against common misconceptions, particularly the misuse of person-time denominators. Understanding this distinction is the critical first step toward sound measurement and analysis.", "problem": "A municipal health department monitors a chronic condition in a closed town over a calendar year. At a single census instant at midyear, the enumerated population is $N_{\\text{mid}} = 1000$ persons, of whom $n_{\\text{cases}}(t_{\\text{mid}}) = 80$ are in the disease state at that instant. Over the entire year, $n_{\\text{period}} = 120$ distinct persons are observed to have occupied the disease state at least once during the interval. For operational reasons, field staff also tabulate total observed person-time $PT_{\\text{total}} = 950\\,\\text{person-years}$ and the sum of time spent in the disease state across all persons $PT_{\\text{diseased}} = 100\\,\\text{person-years}$.\n\nTwo analysts propose different denominator strategies for measuring disease frequency. Analyst P argues that the appropriate denominators for point and period prevalence must be person counts tied to the occupancy of the disease state among persons. Analyst T argues that person-time denominators are more appropriate because they account for variable follow-up and are the standard denominator in rate calculations.\n\nStarting from core definitions—prevalence as an occupancy proportion among persons at a point in time (point prevalence) or over a period (period prevalence), and incidence rate as the frequency of new onset events per unit of person-time contributed by at-risk persons—consider the conceptual consequences of pairing numerators and denominators. Specifically, note that a point prevalence numerator is a count of persons occupying the disease state at an instant, and a period prevalence numerator is a count of distinct persons who ever occupied the disease state in the interval, while an incidence numerator is a count of onset events.\n\nWhich of the following statements best explain why person-time denominators are not appropriate for prevalence, and correctly contrast the occupancy interpretation of prevalence with the incidence rate definition that uses person-time? Select all that apply.\n\nA. Prevalence is an occupancy proportion over persons: its numerator counts persons in a state, so its denominator must be a person count to yield a dimensionless proportion; pairing a person numerator with a person-time denominator produces a quantity with units of $1/\\text{time}$ and answers a different question than prevalence, whereas incidence rate is explicitly events per unit person-time.\n\nB. Person-time denominators are required for period prevalence because they correct for variable follow-up; without person-time, period prevalence is undefined when some individuals are censored before the period ends.\n\nC. If one divides $PT_{\\text{diseased}}$ by $PT_{\\text{total}}$, the result is a dimensionless time-averaged occupancy fraction (the proportion of population time spent in the disease state). Although this is interpretable, it is not the standard person-based period prevalence, which counts distinct persons who ever occupied the state during the period; using person-time denominators therefore changes the estimand away from prevalence.\n\nD. Point prevalence at midyear is defined as cases per person-time at the midpoint because it reflects instantaneous flow through the disease state; accordingly, person-time is the appropriate denominator for both point and period prevalence.\n\nE. Using person-time denominators for prevalence yields the same value as using person counts when the disease is rare, so the choice of denominator is inconsequential in practice for low-prevalence conditions.", "solution": "The problem statement asks to evaluate several statements regarding the appropriate denominators for prevalence measures in epidemiology, contrasting them with the denominator used for incidence rates. The core of the problem lies in the fundamental definitions of these epidemiological measures.\n\nFirst, let's establish the definitions based on the principles provided in the problem statement and standard epidemiological practice.\n\n**Prevalence** is a measure of the proportion of a population that is in a particular state (e.g., has a disease) at a specific point in time or over a specified period. It is fundamentally a **proportion**, which is a dimensionless quantity.\n-   **Point Prevalence ($P$)**: This measures the proportion of individuals in a population who have the disease at a single point in time. It is calculated as:\n    $$ P = \\frac{\\text{Number of persons with the disease at a specific time } t}{\\text{Total number of persons in the population at time } t} $$\n    The numerator is a count of persons, and the denominator is a count of persons. The result is a dimensionless proportion, often expressed as a percentage or per $1,000$ persons. Using the data provided, the point prevalence at midyear is:\n    $$ P_{\\text{mid}} = \\frac{n_{\\text{cases}}(t_{\\text{mid}})}{N_{\\text{mid}}} = \\frac{80}{1000} = 0.08 $$\n-   **Period Prevalence ($PP$)**: This measures the proportion of individuals in a population who have had the disease at any time during a specified period. It is calculated as:\n    $$ PP = \\frac{\\text{Number of distinct persons with the disease at any time during the period}}{\\text{Total number of persons in the population during the period (often mid-period population)}} $$\n    The numerator is a count of distinct persons, and the denominator is also a count of persons. The result is a dimensionless proportion. Using the data provided:\n    $$ PP_{\\text{year}} = \\frac{n_{\\text{period}}}{N_{\\text{mid}}} = \\frac{120}{1000} = 0.12 $$\n\n**Incidence Rate (or Incidence Density)** measures the rate at which new cases (events) occur in a population at risk over a period of time. It is a true **rate**, measuring the rapidity of event occurrence.\n-   **Incidence Rate ($IR$)**: This is calculated as:\n    $$ IR = \\frac{\\text{Number of new onset events during a period}}{\\text{Total person-time at risk during the period}} $$\n    The numerator is a count of events (not persons, as one person can have multiple events in some contexts, though for a chronic condition onset is usually once). The denominator is the sum of the time each individual was at risk of developing the disease, measured in units like person-years. The resulting quantity has units of $1/\\text{time}$ (e.g., cases per person-year). It is not a proportion. The problem does not provide the number of new cases, so we cannot calculate the $IR$.\n\nWith these definitions, we can analyze the conceptual role of different denominators. Analyst P, who argues for person-count denominators for prevalence, is correct according to standard definitions. Analyst T, who argues for person-time denominators, is confusing prevalence with either an incidence rate or a different type of measure.\n\nNow, we will evaluate each option.\n\n**A. Prevalence is an occupancy proportion over persons: its numerator counts persons in a state, so its denominator must be a person count to yield a dimensionless proportion; pairing a person numerator with a person-time denominator produces a quantity with units of $1/\\text{time}$ and answers a different question than prevalence, whereas incidence rate is explicitly events per unit person-time.**\n\n-   **Analysis**: This statement correctly identifies prevalence as a person-based proportion. A proportion requires the numerator and denominator to have the same units (in this case, persons), making the result dimensionless. The statement correctly performs a dimensional analysis on the invalid construct of (persons / person-time), which results in units of $1/\\text{time}$. For example, $\\frac{120 \\text{ persons}}{950 \\text{ person-years}}$ has units of $\\text{persons} / (\\text{persons} \\cdot \\text{time})$ which simplifies to $1/\\text{time}$. This is dimensionally a rate, not a proportion. The statement correctly contrasts this with the definition of an incidence rate, which is also a rate (events / person-time) but measures the occurrence of new onsets. This statement is entirely consistent with epidemiological principles.\n-   **Verdict**: **Correct**.\n\n**B. Person-time denominators are required for period prevalence because they correct for variable follow-up; without person-time, period prevalence is undefined when some individuals are censored before the period ends.**\n\n-   **Analysis**: This statement is incorrect. It conflates the requirements for an incidence rate with the definition of period prevalence. Person-time denominators are the hallmark of incidence rates precisely because they account for variable follow-up in a dynamic cohort. Period prevalence, however, is a proportion based on person counts. While censoring or loss to follow-up presents a challenge in determining the appropriate denominator (e.g., should it be the initial, final, or average population?), it does not render the concept \"undefined\". Epidemiologists choose a suitable person-count denominator to best represent the reference population. The assertion that person-time is *required* is fundamentally false.\n-   **Verdict**: **Incorrect**.\n\n**C. If one divides $PT_{\\text{diseased}}$ by $PT_{\\text{total}}$, the result is a dimensionless time-averaged occupancy fraction (the proportion of population time spent in the disease state). Although this is interpretable, it is not the standard person-based period prevalence, which counts distinct persons who ever occupied the state during the period; using person-time denominators therefore changes the estimand away from prevalence.**\n\n-   **Analysis**: This statement accurately describes a valid, but distinct, epidemiological measure. The ratio $\\frac{PT_{\\text{diseased}}}{PT_{\\text{total}}}$ is a ratio of two quantities with the same units (person-time), resulting in a dimensionless proportion. The interpretation is correctly stated as the \"proportion of population time spent in the disease state,\" sometimes called prevalence-in-time or time-averaged prevalence. For the given data, this is $\\frac{100 \\text{ person-years}}{950 \\text{ person-years}} \\approx 0.105$. The statement correctly contrasts this with the standard (person-based) period prevalence, which counts the proportion of *persons* who were ever ill ($120/1000 = 0.12$). The key takeaway is that while one can construct a meaningful dimensionless quantity using person-time in both numerator and denominator, this quantity (the estimand) is different from what is standardly defined as period prevalence.\n-   **Verdict**: **Correct**.\n\n**D. Point prevalence at midyear is defined as cases per person-time at the midpoint because it reflects instantaneous flow through the disease state; accordingly, person-time is the appropriate denominator for both point and period prevalence.**\n\n-   **Analysis**: This statement is incorrect on multiple grounds. Point prevalence is measured at an instant in time; a \"person-time\" denominator is nonsensical in an instantaneous context, as no time has elapsed. The denominator is a simple count of persons at that instant. Furthermore, prevalence measures a \"state\" or \"occupancy,\" not \"flow\". Flow is the concept associated with incidence (the inflow of new cases). The conclusion that person-time is appropriate for both point and period prevalence is a direct contradiction of their definitions.\n-   **Verdict**: **Incorrect**.\n\n**E. Using person-time denominators for prevalence yields the same value as using person counts when the disease is rare, so the choice of denominator is inconsequential in practice for low-prevalence conditions.**\n\n-   **Analysis**: This statement is false. It misapplies or invents a property related to the \"rare disease assumption.\" The standard rare disease assumption relates prevalence ($P$) to incidence rate ($IR$) and average disease duration ($D$) via the formula $P \\approx IR \\times D$ for a stable population. It does not state that a person-count denominator (e.g., $N = 1000$ persons) is approximately equal to a person-time denominator (e.g., $PT = 950$ person-years). These two quantities have different units and are not interchangeable, regardless of whether the prevalence is high or low. The choice of denominator is fundamental to the definition and interpretation of the measure and is never inconsequential.\n-   **Verdict**: **Incorrect**.\n\nIn summary, statements A and C correctly articulate the conceptual and mathematical reasons why person-time denominators are inappropriate for standard prevalence measures and distinguish prevalence from other related quantities.", "answer": "$$\\boxed{AC}$$", "id": "4623467"}, {"introduction": "With a clear definition in mind, the next practical step is designing an efficient study. This practice [@problem_id:4623486] guides you through the process of determining the necessary sample size to estimate prevalence with a desired level of precision. It's a foundational skill that connects statistical theory to the real-world constraints of research planning and resource allocation.", "problem": "A public health team plans a simple random sample from a very large population to estimate the point prevalence of a binary condition at a specific calendar date. Let the true point prevalence be denoted by $p \\in [0,1]$. The investigators will compute the sample proportion $\\hat{p}$ as the estimator of $p$, and they will report a two-sided confidence interval with nominal level $1-\\alpha$ around $\\hat{p}$. They require that the absolute margin of error, defined as half the width of the interval on the prevalence (probability) scale, not exceed a pre-specified value $E \\in (0,1)$.\n\nStarting only from the modeling framework that each sampled individual contributes an independent Bernoulli random variable with parameter $p$, the Central Limit Theorem (CLT) for the sample mean of independent and identically distributed variables, and the definition of a two-sided $1-\\alpha$ confidence interval using the quantile $z_{\\alpha/2}$ of the standard normal distribution, do the following:\n\n1. Derive an approximate expression for the required sample size $n$ as a function of $p$, $E$, and $z_{\\alpha/2}$ that ensures the requested absolute margin of error is no greater than $E$ at nominal confidence level $1-\\alpha$.\n\n2. At the design stage, $p$ is unknown. Using only the mathematical properties of $p(1-p)$ over $p \\in [0,1]$, derive a conservative planning rule that eliminates $p$ from the sample size formula by choosing the value of $p$ that maximizes the required $n$. Provide the resulting closed-form expression for $n$ solely in terms of $E$ and $z_{\\alpha/2}$.\n\nYour final answer should be the conservative closed-form expression for $n$ from part $2$. Do not substitute any numerical values for $E$ or $z_{\\alpha/2}$. No rounding is required because the answer should be an analytic expression, not a number.", "solution": "The problem is assessed to be valid. It is a standard, well-posed problem in statistical sample size calculation, grounded in fundamental principles of statistical inference (Bernoulli trials, Central Limit Theorem). It is self-contained, objective, and internally consistent.\n\nThe task is to derive a formula for the sample size $n$ required to estimate a population prevalence $p$ with a specified absolute margin of error $E$ and a confidence level of $1-\\alpha$. The derivation proceeds in two parts as requested.\n\nPart 1: Derivation of the sample size formula as a function of $p$, $E$, and $z_{\\alpha/2}$.\n\nLet the binary condition in an individual be represented by a random variable $X_i$, where $X_i=1$ if the individual has the condition and $X_i=0$ otherwise. For a simple random sample from a very large population, the variables $X_1, X_2, \\dots, X_n$ can be modeled as independent and identically distributed (i.i.d.) Bernoulli random variables with parameter $p$, the true prevalence.\n$$ X_i \\sim \\text{Bernoulli}(p) \\quad \\text{for } i = 1, \\dots, n $$\nThe parameter $p$ is the probability of success, $P(X_i=1)=p$. The mean and variance of each $X_i$ are $E[X_i] = p$ and $\\text{Var}(X_i) = p(1-p)$.\n\nThe point estimator for the prevalence $p$ is the sample proportion, $\\hat{p}$, defined as the sample mean:\n$$ \\hat{p} = \\frac{1}{n} \\sum_{i=1}^{n} X_i $$\nThe expected value of the estimator is $E[\\hat{p}] = E[\\frac{1}{n} \\sum_{i=1}^{n} X_i] = \\frac{1}{n} \\sum_{i=1}^{n} E[X_i] = \\frac{1}{n} (np) = p$. Thus, $\\hat{p}$ is an unbiased estimator of $p$.\n\nThe variance of the estimator, due to the independence of the $X_i$, is:\n$$ \\text{Var}(\\hat{p}) = \\text{Var}\\left(\\frac{1}{n} \\sum_{i=1}^{n} X_i\\right) = \\frac{1}{n^2} \\sum_{i=1}^{n} \\text{Var}(X_i) = \\frac{1}{n^2} (n \\cdot p(1-p)) = \\frac{p(1-p)}{n} $$\nThe standard error of $\\hat{p}$ is the square root of its variance:\n$$ \\text{SE}(\\hat{p}) = \\sqrt{\\frac{p(1-p)}{n}} $$\nAccording to the Central Limit Theorem (CLT), for a sufficiently large sample size $n$, the sampling distribution of $\\hat{p}$ is approximately normal. Specifically, the standardized statistic\n$$ Z = \\frac{\\hat{p} - p}{\\text{SE}(\\hat{p})} = \\frac{\\hat{p} - p}{\\sqrt{p(1-p)/n}} $$\nis approximately distributed as a standard normal random variable, $Z \\sim N(0,1)$.\n\nA two-sided confidence interval for $p$ with a confidence level of $1-\\alpha$ is constructed based on this approximation. The interval is centered on the estimate $\\hat{p}$ and its width is determined by the standard error and the appropriate quantile of the standard normal distribution. Let $z_{\\alpha/2}$ be the value such that $P(Z > z_{\\alpha/2}) = \\alpha/2$. The interval is defined by the inequality:\n$$ -z_{\\alpha/2} \\le \\frac{\\hat{p} - p}{\\text{SE}(\\hat{p})} \\le z_{\\alpha/2} $$\nThe absolute margin of error, $E$, is defined as half the width of the confidence interval. At the design stage, we define this margin using the true standard error, not its sample estimate.\n$$ E = z_{\\alpha/2} \\cdot \\text{SE}(\\hat{p}) = z_{\\alpha/2} \\sqrt{\\frac{p(1-p)}{n}} $$\nThe problem requires that this margin of error not exceed a pre-specified value, which we also denote as $E$. To find the required sample size $n$, we solve this equation for $n$:\n$$ E^2 = \\left(z_{\\alpha/2} \\sqrt{\\frac{p(1-p)}{n}}\\right)^2 = z_{\\alpha/2}^2 \\cdot \\frac{p(1-p)}{n} $$\nRearranging the terms to solve for $n$, we get:\n$$ nE^2 = z_{\\alpha/2}^2 p(1-p) $$\n$$ n = \\frac{z_{\\alpha/2}^2 p(1-p)}{E^2} $$\nThis expression gives the required sample size $n$ as a function of the unknown prevalence $p$, the desired margin of error $E$, and the critical value $z_{\\alpha/2}$ corresponding to the confidence level $1-\\alpha$. This completes the first part of the derivation.\n\nPart 2: Derivation of a conservative planning rule.\n\nThe formula for $n$ derived above depends on the true prevalence $p$, which is unknown at the design stage. To ensure that the sample size is large enough regardless of the true value of $p$, we adopt a conservative approach by choosing the value of $p$ that maximizes the required sample size $n$.\nThe sample size $n$ is directly proportional to the term $p(1-p)$, as $z_{\\alpha/2}$ and $E$ are fixed constants in the planning stage. Therefore, we must find the maximum value of the function $f(p) = p(1-p)$ for $p \\in [0,1]$.\n\nThe function $f(p) = p - p^2$ is a downward-opening parabola with roots at $p=0$ and $p=1$. The vertex of the parabola, which corresponds to the maximum value of the function, lies on the axis of symmetry at $p = \\frac{0+1}{2} = \\frac{1}{2}$.\n\nAlternatively, we can use calculus to find the maximum. We take the first derivative of $f(p)$ with respect to $p$ and set it to zero:\n$$ \\frac{df}{dp} = \\frac{d}{dp}(p-p^2) = 1 - 2p $$\nSetting $\\frac{df}{dp} = 0$ yields $1-2p = 0$, which gives the critical point $p = \\frac{1}{2}$.\nTo confirm this is a maximum, we examine the second derivative:\n$$ \\frac{d^2f}{dp^2} = -2 $$\nSince the second derivative is negative, the function $f(p)$ has a local maximum at $p = \\frac{1}{2}$. Since this is the only critical point in the interval $(0,1)$ and the function values at the endpoints are $f(0)=0$ and $f(1)=0$, this is the global maximum on the interval $[0,1]$.\n\nThe maximum value of the variance term $p(1-p)$ is:\n$$ f\\left(\\frac{1}{2}\\right) = \\frac{1}{2}\\left(1 - \\frac{1}{2}\\right) = \\frac{1}{2} \\cdot \\frac{1}{2} = \\frac{1}{4} $$\nBy substituting this maximum value into the sample size formula, we obtain the conservative sample size $n$ that guarantees the margin of error will not exceed $E$ for any possible value of $p \\in [0,1]$:\n$$ n = \\frac{z_{\\alpha/2}^2 \\left(\\frac{1}{4}\\right)}{E^2} = \\frac{z_{\\alpha/2}^2}{4E^2} $$\nThis is the final closed-form expression for the conservative sample size, depending only on the desired margin of error $E$ and confidence level $1-\\alpha$ (via $z_{\\alpha/2}$).", "answer": "$$\n\\boxed{\\frac{z_{\\alpha/2}^{2}}{4E^{2}}}\n$$", "id": "4623486"}, {"introduction": "The ultimate test of understanding is to apply abstract definitions to raw data. This exercise [@problem_id:4623538] challenges you to translate the formal definition of period prevalence into a working algorithm for individual-level longitudinal data. Successfully completing this task demonstrates a deep understanding of how to handle complex data structures, such as dynamic populations and precise boundary conditions, bridging the gap between textbook formulas and applied data analysis.", "problem": "You are given individual-level longitudinal data from a closed cohort observed over a finite time interval. Each individual $i$ is described by four time points measured in days: a population entry time $E_i$, a population exit time $X_i$, a disease onset time $T_i^{\\text{on}}$, and a disease resolution time $T_i^{\\text{off}}$. If an individual remains diseased beyond the end of observation, treat $T_i^{\\text{off}}$ as $+\\infty$. All time points are real-valued and measured on a single, common timeline.\n\nStarting from the fundamental definitions:\n- For each individual $i$, define the membership indicator $M_i(t)$ that equals $1$ if $E_i \\le t \\le X_i$ and equals $0$ otherwise, and define the population size at time $t$ as $N(t) = \\sum_i M_i(t)$.\n- For each individual $i$, define the disease indicator $D_i(t)$ that equals $1$ if $T_i^{\\text{on}}  t  T_i^{\\text{off}}$ and equals $0$ otherwise, adopting an open interval for the disease to enforce strict boundary conditions at $t = T_i^{\\text{on}}$ and $t = T_i^{\\text{off}}$.\n- Over a period $\\left[t_0, t_1\\right]$ with $t_0  t_1$, a person is counted as having had the disease during the period if the disease indicator $D_i(t)$ is equal to $1$ for at least one time $t$ in $\\left[t_0, t_1\\right]$. The average population size over the period is defined as the time-average of $N(t)$ on $\\left[t_0, t_1\\right]$.\n\nDerive from these definitions an algorithm that, given $\\left[t_0, t_1\\right]$ and individual-level tuples $\\left(E_i, X_i, T_i^{\\text{on}}, T_i^{\\text{off}}\\right)$, computes the period prevalence over $\\left[t_0, t_1\\right]$ as a single float. Your algorithm must:\n- Use the open-interval disease criterion at the period boundaries, so that disease onset exactly at $t_1$ does not count and disease resolution exactly at $t_0$ does not count.\n- Compute the average population size from entry and exit times by time-averaging $N(t)$ over $\\left[t_0, t_1\\right]$ using only the overlap lengths of membership intervals $\\left[E_i, X_i\\right]$ with the period $\\left[t_0, t_1\\right]$.\n\nImplement the algorithm and evaluate it on the following test suite. For each case, compute the period prevalence and output a float rounded to $6$ decimal places. Express the final output as a single line containing a comma-separated list enclosed in square brackets.\n\nTest Suite (each case specifies $\\left[t_0, t_1\\right]$ and the list of individuals given as $\\left(E, X, T^{\\text{on}}, T^{\\text{off}}\\right)$):\n\n- Case $1$ (happy path):\n  - Period: $t_0 = 0$, $t_1 = 30$.\n  - Individuals:\n    - $\\left(0, 30, 10, 20\\right)$,\n    - $\\left(0, 30, 0, 5\\right)$,\n    - $\\left(0, 30, 40, 60\\right)$,\n    - $\\left(10, 30, 28, 40\\right)$,\n    - $\\left(0, 10, 8, 12\\right)$.\n\n- Case $2$ (boundary conditions at $t_0$ and $t_1$):\n  - Period: $t_0 = 0$, $t_1 = 10$.\n  - Individuals:\n    - $\\left(0, 10, 10, 20\\right)$,\n    - $\\left(0, 10, -5, 0\\right)$,\n    - $\\left(0, 10, -5, 5\\right)$.\n\n- Case $3$ (ongoing disease and membership ending at the period start):\n  - Period: $t_0 = 5$, $t_1 = 15$.\n  - Individuals:\n    - $\\left(0, 20, 12, +\\infty\\right)$,\n    - $\\left(6, 10, 1, 6\\right)$,\n    - $\\left(7, 14, 2, 4\\right)$,\n    - $\\left(0, 5, 4, 5\\right)$.\n\n- Case $4$ (no disease during the period):\n  - Period: $t_0 = 0$, $t_1 = 10$.\n  - Individuals:\n    - $\\left(0, 10, 20, 30\\right)$,\n    - $\\left(0, 10, 11, 12\\right)$.\n\n- Case $5$ (short period length):\n  - Period: $t_0 = 100$, $t_1 = 101$.\n  - Individuals:\n    - $\\left(0, 200, 50, 150\\right)$,\n    - $\\left(100, 100.5, 95, 96\\right)$,\n    - $\\left(100.2, 100.8, 100.3, 100.4\\right)$.\n\nOutput Specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[\\text{result}_1,\\text{result}_2,\\dots\\right]$).\n- Results must be floats rounded to $6$ decimal places, expressed as decimals without a percentage sign.", "solution": "The problem statement has been critically examined and found to be valid. It is self-contained, scientifically grounded in the principles of epidemiology, and mathematically well-posed. The definitions provided for population membership, disease status, and average population size are clear, precise, and internally consistent. The problem is therefore solvable as stated.\n\nThe objective is to compute the period prevalence, $P_{\\text{period}}$, over a time interval $[t_0, t_1]$. By definition, period prevalence is the ratio of the total number of individuals who have the disease at any point during a specified period to the average population size during that same period.\n\n$$ P_{\\text{period}} = \\frac{\\text{Number of individuals with the disease during } [t_0, t_1]}{\\text{Average population size over } [t_0, t_1]} $$\n\nLet us denote the numerator as $C_{[t_0, t_1]}$ and the denominator as $N_{\\text{avg}}$. Each component will be derived from the fundamental definitions provided.\n\n**1. Derivation of the Numerator (Number of Cases)**\n\nAn individual $i$ is counted as a case if their disease indicator $D_i(t) = 1$ for at least one time point $t \\in [t_0, t_1]$. The disease indicator is defined as $D_i(t) = 1$ if and only if $t$ falls within the open interval $(T_i^{\\text{on}}, T_i^{\\text{off}})$, where $T_i^{\\text{on}}$ is the time of disease onset and $T_i^{\\text{off}}$ is the time of disease resolution.\n\nTherefore, an individual $i$ is a case if the disease interval $(T_i^{\\text{on}}, T_i^{\\text{off}})$ has a non-empty intersection with the observation period $[t_0, t_1]$. The intersection of two intervals, $(a, b)$ and $[c, d]$, is non-empty if and only if they are not disjoint. They are disjoint if $b \\le c$ or $a \\ge d$. Consequently, they intersect if and only if $b  c$ AND $a  d$.\n\nApplying this to our specific variables, with $a = T_i^{\\text{on}}$, $b = T_i^{\\text{off}}$, $c = t_0$, and $d = t_1$, an individual $i$ is a case if and only if:\n$$ T_i^{\\text{on}}  t_1 \\quad \\text{and} \\quad T_i^{\\text{off}}  t_0 $$\nThis condition correctly enforces the specified strict boundary conditions. For instance, if an individual's disease onset is exactly at $t_1$, then $T_i^{\\text{on}} = t_1$, the condition $T_i^{\\text{on}}  t_1$ is false, and the individual is not counted. Similarly, if resolution occurs exactly at $t_0$, i.e., $T_i^{\\text{off}} = t_0$, the condition $T_i^{\\text{off}}  t_0$ is false.\n\nThe total number of cases, $C_{[t_0, t_1]}$, is the sum of indicator functions for all individuals satisfying this condition:\n$$ C_{[t_0, t_1]} = \\sum_{i} \\mathbf{1}_{\\{T_i^{\\text{on}}  t_1 \\land T_i^{\\text{off}}  t_0\\}} $$\nwhere $\\mathbf{1}_{\\{\\cdot\\}}$ is the indicator function, which equals $1$ if the condition is true and $0$ otherwise.\n\n**2. Derivation of the Denominator (Average Population Size)**\n\nThe average population size, $N_{\\text{avg}}$, over the period $[t_0, t_1]$ is defined as the time-average of the population size function $N(t)$:\n$$ N_{\\text{avg}} = \\frac{1}{t_1 - t_0} \\int_{t_0}^{t_1} N(t) \\,dt $$\nThe population size at time $t$ is $N(t) = \\sum_i M_i(t)$, where $M_i(t)$ is the membership indicator for individual $i$. By the linearity of integration, we can write:\n$$ N_{\\text{avg}} = \\frac{1}{t_1 - t_0} \\sum_{i} \\int_{t_0}^{t_1} M_i(t) \\,dt $$\nThe membership indicator $M_i(t)$ is defined as $1$ if $t \\in [E_i, X_i]$ (the individual's membership interval) and $0$ otherwise. The integral $\\int_{t_0}^{t_1} M_i(t) \\,dt$ thus represents the length of the intersection between the individual's membership interval $[E_i, X_i]$ and the observation period $[t_0, t_1]$.\n\nLet $L_i$ be this overlap length. The intersection of two closed intervals $[a, b]$ and $[c, d]$ is another interval $[\\max(a, c), \\min(b, d)]$. The length of this intersection is $\\max(0, \\min(b, d) - \\max(a, c))$.\nFor individual $i$, with membership interval $[E_i, X_i]$ and observation period $[t_0, t_1]$, the contributed person-time is:\n$$ L_i = \\max(0, \\min(X_i, t_1) - \\max(E_i, t_0)) $$\nThe sum of these lengths over all individuals gives the total person-time at risk during the period, denoted $\\text{PT}$:\n$$ \\text{PT}_{[t_0, t_1]} = \\sum_i L_i = \\sum_i \\max(0, \\min(X_i, t_1) - \\max(E_i, t_0)) $$\nSubstituting this back into the expression for $N_{\\text{avg}}$:\n$$ N_{\\text{avg}} = \\frac{\\text{PT}_{[t_0, t_1]}}{t_1 - t_0} $$\n\n**3. Final Algorithm for Period Prevalence**\n\nCombining the expressions for the numerator and denominator, we obtain the final formula for period prevalence:\n$$ P_{\\text{period}} = \\frac{C_{[t_0, t_1]}}{N_{\\text{avg}}} = \\frac{C_{[t_0, t_1]}}{\\frac{\\text{PT}_{[t_0, t_1]}}{t_1 - t_0}} = \\frac{C_{[t_0, t_1]} \\cdot (t_1 - t_0)}{\\text{PT}_{[t_0, t_1]}} $$\nThis final form is computationally robust. It is important to handle the case where $\\text{PT}_{[t_0, t_1]} = 0$. If the total person-time is zero, the average population is zero, and the prevalence is formally undefined. If the number of cases is also zero, the prevalence can be considered $0$. If there are cases but zero person-time, it represents a logical contradiction (disease occurring in a non-existent population), but the problem's test cases do not present this pathology. For implementation, if $\\text{PT}_{[t_0, t_1]} = 0$, the prevalence will be set to $0.0$.\nThe algorithm is as follows:\n1. For a given period $[t_0, t_1]$ and a set of individuals, initialize the number of cases $C_{[t_0, t_1]}$ to $0$ and the total person-time $\\text{PT}_{[t_0, t_1]}$ to $0$.\n2. For each individual $i$ with data $(E_i, X_i, T_i^{\\text{on}}, T_i^{\\text{off}})$:\n    a. Evaluate the case condition: if $T_i^{\\text{on}}  t_1$ and $T_i^{\\text{off}}  t_0$, increment $C_{[t_0, t_1]}$.\n    b. Calculate the person-time contribution: $L_i = \\max(0, \\min(X_i, t_1) - \\max(E_i, t_0))$. Add $L_i$ to $\\text{PT}_{[t_0, t_1]}$.\n3. After iterating through all individuals, calculate the period duration $\\Delta t = t_1 - t_0$.\n4. If $\\text{PT}_{[t_0, t_1]}  0$, compute prevalence as $P_{\\text{period}} = (C_{[t_0, t_1]} \\cdot \\Delta t) / \\text{PT}_{[t_0, t_1]}$. Otherwise, set $P_{\\text{period}} = 0.0$.\n5. Round the result to the required precision.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes period prevalence for a series of test cases based on individual-level longitudinal data.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"period\": (0, 30),\n            \"individuals\": [\n                (0, 30, 10, 20),\n                (0, 30, 0, 5),\n                (0, 30, 40, 60),\n                (10, 30, 28, 40),\n                (0, 10, 8, 12),\n            ],\n        },\n        {\n            \"period\": (0, 10),\n            \"individuals\": [\n                (0, 10, 10, 20),\n                (0, 10, -5, 0),\n                (0, 10, -5, 5),\n            ],\n        },\n        {\n            \"period\": (5, 15),\n            \"individuals\": [\n                (0, 20, 12, np.inf),\n                (6, 10, 1, 6),\n                (7, 14, 2, 4),\n                (0, 5, 4, 5),\n            ],\n        },\n        {\n            \"period\": (0, 10),\n            \"individuals\": [\n                (0, 10, 20, 30),\n                (0, 10, 11, 12),\n            ],\n        },\n        {\n            \"period\": (100, 101),\n            \"individuals\": [\n                (0, 200, 50, 150),\n                (100, 100.5, 95, 96),\n                (100.2, 100.8, 100.3, 100.4),\n            ],\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        t0, t1 = case[\"period\"]\n        individuals = case[\"individuals\"]\n        \n        num_cases = 0\n        total_person_time = 0.0\n        \n        # Period duration\n        period_duration = t1 - t0\n\n        for E, X, T_on, T_off in individuals:\n            # Numerator: Count individuals who had the disease during the period.\n            # The disease interval (T_on, T_off) must overlap with the period [t0, t1].\n            # This is true if T_on  t1 and T_off  t0.\n            if T_on  t1 and T_off > t0:\n                num_cases += 1\n            \n            # Denominator: Calculate total person-time at risk.\n            # This is the sum of the lengths of the overlap between each individual's\n            # membership interval [E, X] and the observation period [t0, t1].\n            overlap_start = max(E, t0)\n            overlap_end = min(X, t1)\n            person_time_contribution = max(0, overlap_end - overlap_start)\n            total_person_time += person_time_contribution\n            \n        # Calculate period prevalence\n        # P_period = (Number of cases) / (Average population)\n        # Average population = (Total person-time) / (Period duration)\n        # So, P_period = (Number of cases * Period duration) / (Total person-time)\n\n        if total_person_time == 0:\n            # If total person-time is zero, average population is zero.\n            # If num_cases is also 0, prevalence is 0. If num_cases  0,\n            # prevalence is undefined. The problem cases avoid this ambiguity.\n            # We assign 0 in this case.\n            prevalence = 0.0\n        else:\n            prevalence = (num_cases * period_duration) / total_person_time\n            \n        results.append(f\"{prevalence:.6f}\")\n\n    # Format the final output as a comma-separated list in brackets\n    output_str = \",\".join(results)\n    print(f\"[{output_str}]\")\n\nsolve()\n```", "id": "4623538"}]}