{"hands_on_practices": [{"introduction": "The retina's ability to signal both increases and decreases in light intensity begins with the segregation of information into parallel ON and OFF pathways. This fundamental exercise explores the core circuitry responsible for this split. By predicting how a retinal ganglion cell's firing pattern changes in response to light and to a specific pharmacological agent, you will solidify your understanding of the sign-inverting and sign-preserving synapses that define these critical visual channels [@problem_id:5004878].", "problem": "An experimenter records extracellular spikes from a retinal ganglion cell (RGC) while presenting a centered, small bright spot that is confined to the receptive field (RF) center and negligibly engages the surround. The spot is a luminance step of amplitude $\\Delta L>0$ delivered at time $t=0$ and turned off at time $t=T$, on a mean background luminance $L_{0}$. Baseline firing rate before the step is $r_{0}$. Two RGCs are considered: an ON-center RGC and an OFF-center RGC. After establishing control responses, the experimenter bath-applies L-2-amino-4-phosphonobutyric acid (L-AP4; also called APB), a selective agonist of the postsynaptic metabotropic glutamate receptor $6$ (mGluR$6$) expressed by ON bipolar cells. Assume canonical retinal circuitry: light increments hyperpolarize photoreceptors and reduce glutamate release; the photoreceptor-to-ON bipolar synapse is sign-inverting via mGluR$6$, whereas the photoreceptor-to-OFF bipolar synapse is sign-preserving via ionotropic glutamate receptors. Center excitation of each RGC arises predominantly from its matching bipolar pathway (ON or OFF), and the small spot within the center minimizes surround-mediated contributions.\n\nWhich option best predicts the polarity and qualitative time course of spike rate changes in the ON-center versus OFF-center RGC under control and after L-AP4 (APB), and correctly explains the pathway-specific pharmacology?\n\nA. Control: ON-center shows an increase in spikes at $t=0$ (typically a transient burst with possible sustained elevation during $0<t<T$) and a pause or dip at $t=T$; OFF-center shows a pause or decrease during $0<t<T$ and a transient burst at $t=T$. After L-AP4: ON-center light-evoked increases at $t=0$ are abolished, with little to no response to the light increment; OFF-center responses are largely unchanged. Mechanism: L-AP4 activates mGluR$6$ on ON bipolar dendrites, preventing their light-evoked depolarization; OFF bipolar cells, which use ionotropic glutamate receptors, are not directly affected.\n\nB. Control: ON-center shows a decrease in spikes at $t=0$ and a rebound at $t=T$; OFF-center shows an increase at $t=0$ and a decrease at $t=T$. After L-AP4: ON-center responses are spared, but OFF-center responses are abolished because L-AP4 blocks ionotropic glutamate receptors at OFF bipolar synapses.\n\nC. Control: ON-center shows a transient increase only at $t=T$; OFF-center shows a transient increase only at $t=0$. After L-AP4: both ON and OFF responses are abolished because L-AP4 suppresses phototransduction in photoreceptors upstream of both pathways.\n\nD. Control: ON-center shows an increase in spikes at $t=0$ and OFF-center shows a decrease during $0<t<T$. After L-AP4: OFF-center responses invert to ON-like behavior because L-AP4 converts OFF bipolar signaling into a sign-inverting pathway via mGluR$6$.\n\nE. Control: ON-center shows an increase in spikes at $t=0$ and OFF-center shows a decrease during $0<t<T$. After L-AP4: OFF-center responses are selectively reduced due to blockade of kainate/AMPA-class ionotropic receptors, while ON responses persist via metabotropic signaling that is insensitive to L-AP4.\n\nSelect the best option.", "solution": "The problem statement will be validated before proceeding to a solution.\n\n### Step 1: Extract Givens\n- **Experimental Setup:** Extracellular spike recording from a retinal ganglion cell (RGC).\n- **Stimulus:** A centered, small bright spot confined to the receptive field (RF) center. The stimulus is a luminance step of amplitude $\\Delta L > 0$ delivered at time $t=0$ and turned off at time $t=T$. The background luminance is $L_{0}$.\n- **Baseline Condition:** Baseline firing rate before the stimulus is $r_{0}$.\n- **Cells Investigated:** An ON-center RGC and an OFF-center RGC.\n- **Pharmacological Agent:** L-2-amino-4-phosphonobutyric acid (L-AP4 or APB).\n- **Mechanism of Agent:** L-AP4 is a selective agonist of the postsynaptic metabotropic glutamate receptor $6$ (mGluR$6$).\n- **Cellular Location of Target Receptor:** mGluR$6$ is expressed by ON bipolar cells.\n- **Canonical Retinal Circuitry Principles:**\n    1.  Light increments ($\\Delta L > 0$) hyperpolarize photoreceptors.\n    2.  Hyperpolarization of photoreceptors reduces their rate of glutamate release.\n    3.  The synapse between photoreceptors and ON bipolar cells is sign-inverting, mediated by mGluR$6$.\n    4.  The synapse between photoreceptors and OFF bipolar cells is sign-preserving, mediated by ionotropic glutamate receptors (iGluRs).\n- **Circuitry Assumptions:**\n    1.  Center excitation of each RGC type arises predominantly from its corresponding bipolar pathway (ON-RGC from ON bipolar; OFF-RGC from OFF bipolar).\n    2.  The small, centered spot minimizes contributions from the RF surround.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is evaluated against the established criteria.\n- **Scientifically Grounded:** The problem describes a classic and fundamental experiment in retinal neurophysiology. All stated principles—the function of ON and OFF pathways, the sign-inverting nature of the mGluR$6$ synapse, the sign-preserving nature of iGluR synapses, the effect of light on photoreceptors, and the specific action of L-AP4 (APB) as an mGluR$6$ agonist—are well-established, core concepts in vision science.\n- **Well-Posed:** The problem is clearly defined. It specifies the input (light stimulus and drug), the system (canonical retinal circuitry), and the desired output (qualitative prediction of RGC firing rates). The assumptions provided (minimal surround, canonical connections) render the problem solvable and unambiguous.\n- **Objective:** The language is technical, precise, and free of subjective or ambiguous terminology.\n- **Other Flaws:** The problem is free from the listed flaws. It is not scientifically unsound, incomplete, contradictory, unrealistic, ill-posed, or trivial. It requires the application of fundamental principles to predict the outcome of a defined perturbation.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. A solution will be derived.\n\n### Principle-Based Derivation\n\nWe will analyze the sequence of events in the ON and OFF pathways, both in the control condition and after the application of L-AP4.\n\n**1. Control Condition (No L-AP4)**\n\n*   **Stimulus Onset ($t=0$):** A bright spot ($\\Delta L > 0$) is presented.\n    1.  Photoreceptors in the center of the RF absorb more photons and **hyperpolarize**.\n    2.  Hyperpolarized photoreceptors **reduce their release of glutamate**.\n    3.  **ON Pathway:** ON bipolar cells express mGluR$6$, a metabotropic receptor that, when bound by glutamate, hyperpolarizes the cell (sign-inverting synapse). The reduction in glutamate release leads to **less activation of mGluR$6$**, which **disinhibits** the ON bipolar cell, causing it to **depolarize**. This depolarization causes the ON bipolar cell to increase its glutamate release. The downstream ON-center RGC is excited, leading to an **increase in its spike rate**. This response typically includes a sharp transient burst at the stimulus onset ($t=0$) and may have a sustained component for $0 < t < T$.\n    4.  **OFF Pathway:** OFF bipolar cells express ionotropic glutamate receptors (iGluRs), which are excitatory (sign-preserving synapse). The reduction in glutamate release leads to **less activation of iGluRs**, causing the OFF bipolar cell to **hyperpolarize**. This hyperpolarization causes the OFF bipolar cell to decrease its glutamate release. The downstream OFF-center RGC receives less excitation, leading to a **decrease in its spike rate** (a pause or dip in firing) for the duration $0 < t < T$.\n\n*   **Stimulus Offset ($t=T$):** The bright spot is turned off.\n    1.  The luminance returns to baseline ($L_0$). Photoreceptors **depolarize** back to their resting potential.\n    2.  This depolarization causes a transient **increase in glutamate release** from the photoreceptors.\n    3.  **ON Pathway:** The increased glutamate release **strongly activates the inhibitory mGluR$6$ receptors** on the ON bipolar cell, causing it to **hyperpolarize**. This leads to a **decrease or pause in the firing rate** of the ON-center RGC.\n    4.  **OFF Pathway:** The increased glutamate release **strongly activates the excitatory iGluRs** on the OFF bipolar cell, causing it to **depolarize**. This leads to a transient burst of excitation in the OFF-center RGC, causing an **increase in its spike rate**.\n\n**Summary for Control:**\n- **ON-center RGC:** Fires robustly at light onset ($t=0$), is suppressed at light offset ($t=T$).\n- **OFF-center RGC:** Is suppressed during light presentation ($0 < t < T$), fires robustly at light offset ($t=T$).\n\n**2. After Application of L-AP4 (APB)**\n\nL-AP4 is a selective agonist for mGluR$6$. It binds to and activates these receptors, mimicking the presence of high concentrations of glutamate.\n\n*   **Effect on ON Pathway:**\n    1.  L-AP4 continuously and strongly activates the mGluR$6$ receptors on the ON bipolar cells.\n    2.  This activation mimics the effect of high glutamate levels, causing the ON bipolar cells to be in a constant state of **hyperpolarization**.\n    3.  When the light stimulus is presented at $t=0$, the photoreceptors hyperpolarize and reduce their glutamate release. However, the ON bipolar cell is already maximally hyperpolarized by the saturating concentration of the agonist L-AP4. The change in endogenous glutamate has no additional effect.\n    4.  Consequently, the ON bipolar cell **fails to depolarize** in response to light. It provides no excitatory signal to the ON-center RGC.\n    5.  The light-evoked **response of the ON-center RGC is abolished**.\n\n*   **Effect on OFF Pathway:**\n    1.  The OFF pathway relies on iGluRs at the synapse between photoreceptors and OFF bipolar cells.\n    2.  L-AP4 is described as a *selective* agonist for mGluR$6$ and has no significant effect on iGluRs.\n    3.  Therefore, the signaling from photoreceptors to OFF bipolar cells, and subsequently to OFF-center RGCs, remains intact.\n    4.  The **response of the OFF-center RGC is largely unchanged** by the application of L-AP4.\n\n### Option-by-Option Analysis\n\n*   **A. Control: ON-center shows an increase in spikes at $t=0$ (typically a transient burst with possible sustained elevation during $0<t<T$) and a pause or dip at $t=T$; OFF-center shows a pause or decrease during $0<t<T$ and a transient burst at $t=T$. After L-AP4: ON-center light-evoked increases at $t=0$ are abolished, with little to no response to the light increment; OFF-center responses are largely unchanged. Mechanism: L-AP4 activates mGluR$6$ on ON bipolar dendrites, preventing their light-evoked depolarization; OFF bipolar cells, which use ionotropic glutamate receptors, are not directly affected.**\n    - This option's description of the control responses for both cell types perfectly matches our derivation.\n    - Its description of the effects of L-AP4—abolishing the ON response while sparing the OFF response—also perfectly matches our derivation.\n    - The mechanistic explanation is correct: L-AP4 is an mGluR$6$ agonist that hyperpolarizes ON bipolar cells, occluding the light response, while the iGluR-mediated OFF pathway is unaffected.\n    - **Verdict: Correct**\n\n*   **B. Control: ON-center shows a decrease in spikes at $t=0$ and a rebound at $t=T$; OFF-center shows an increase at $t=0$ and a decrease at $t=T$. After L-AP4: ON-center responses are spared, but OFF-center responses are abolished because L-AP4 blocks ionotropic glutamate receptors at OFF bipolar synapses.**\n    - The control description incorrectly swaps the responses of ON- and OFF-center cells. An ON-center cell, by definition, increases firing to light onset.\n    - The pharmacological explanation is incorrect. L-AP4 affects the ON pathway, not the OFF pathway, and it is an mGluR$6$ agonist, not an iGluR antagonist.\n    - **Verdict: Incorrect**\n\n*   **C. Control: ON-center shows a transient increase only at $t=T$; OFF-center shows a transient increase only at $t=0$. After L-AP4: both ON and OFF responses are abolished because L-AP4 suppresses phototransduction in photoreceptors upstream of both pathways.**\n    - The control description incorrectly assigns the ON response to light offset ($t=T$) and the OFF response to light onset ($t=0$). This is the reverse of the established definitions.\n    - The pharmacological explanation is incorrect. The problem states L-AP4 acts on postsynaptic mGluR$6$ on ON bipolar cells, not on photoreceptors.\n    - **Verdict: Incorrect**\n\n*   **D. Control: ON-center shows an increase in spikes at $t=0$ and OFF-center shows a decrease during $0<t<T$. After L-AP4: OFF-center responses invert to ON-like behavior because L-AP4 converts OFF bipolar signaling into a sign-inverting pathway via mGluR$6$.**\n    - The control description is incomplete as it omits the crucial responses at light offset ($t=T$).\n    - The pharmacological explanation is biologically fictitious. L-AP4 does not affect the OFF pathway, much less convert its fundamental signaling properties.\n    - **Verdict: Incorrect**\n\n*   **E. Control: ON-center shows an increase in spikes at $t=0$ and OFF-center shows a decrease during $0<t<T$. After L-AP4: OFF-center responses are selectively reduced due to blockade of kainate/AMPA-class ionotropic receptors, while ON responses persist via metabotropic signaling that is insensitive to L-AP4.**\n    - The control description is incomplete, same as option D.\n    - The pharmacological explanation is completely backward. It claims L-AP4 affects the OFF (ionotropic) pathway and spares the ON (metabotropic) pathway. The exact opposite is true. L-AP4 acts on the ON pathway's mGluR$6$ receptors.\n    - **Verdict: Incorrect**", "answer": "$$\\boxed{A}$$", "id": "5004878"}, {"introduction": "While we can qualitatively describe a receptive field as having an excitatory center and an inhibitory surround, a quantitative description is essential for precise models of vision. The Difference-of-Gaussians (DoG) model offers an elegant mathematical formalization of this structure. This practice challenges you to derive a direct link between the model's parameters and an observable experimental outcome, the spot size that elicits the maximum response, thereby developing a quantitative metric for the balance between the center and surround [@problem_id:5004856].", "problem": "An on-center retinal ganglion cell (RGC) is modeled as a linear spatial filter whose receptive field is well described by a Difference-of-Gaussians (DoG). The spatial sensitivity kernel is \n$$\nK(r) \\;=\\; K_{c}\\,G(r;\\sigma_{c}) \\;-\\; K_{s}\\,G(r;\\sigma_{s}),\n$$\nwhere $K_{c}>0$ and $K_{s}>0$ are the center and surround gains, respectively, $r$ is the radial distance from the receptive field center, and $G(r;\\sigma)$ is a normalized, isotropic, two-dimensional Gaussian given by\n$$\nG(r;\\sigma)\\;=\\;\\frac{1}{2\\pi\\sigma^{2}}\\exp\\!\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right).\n$$\nA steady, spatially uniform, bright circular spot of radius $a$ and positive contrast $S$ relative to background is centered on the receptive field. Under the linear filter approximation, the instantaneous response amplitude $R(a)$ is proportional to the spatial integral of $K(r)$ over the area of the spot:\n$$\nR(a)\\;=\\;S\\int_{r\\le a} K(r)\\,dA.\n$$\nExperimentally, the spot-size tuning curve $R(a)$ exhibits a single peak at radius $a^{\\ast}$ and decreases for larger radii, consistent with antagonistic center-surround interactions.\n\nGiven the measured peak radius $a^{\\ast}=120\\,\\mu\\mathrm{m}$, and known receptive field scales $\\sigma_{c}=50\\,\\mu\\mathrm{m}$ and $\\sigma_{s}=150\\,\\mu\\mathrm{m}$, start from the definitions above and:\n- Derive an analytic expression for the ratio of surround to center gains $K_{s}/K_{c}$ in terms of $a^{\\ast}$, $\\sigma_{c}$, and $\\sigma_{s}$ by using the necessary condition for a local maximum at $a^{\\ast}>0$.\n- Use this ratio as a quantitative center-surround balance metric, denoted $B\\equiv K_{s}/K_{c}$, and evaluate it numerically for the given parameters.\n\nRound your numerical answer for the balance metric to four significant figures. Express the balance metric as a dimensionless number (no units).", "solution": "The problem is valid as it is scientifically grounded in a standard neurobiological model, mathematically well-posed, and all necessary parameters are provided.\n\nThe instantaneous response amplitude, $R(a)$, of the on-center retinal ganglion cell to a circular spot of radius $a$ and contrast $S$ is given by the integral of the receptive field kernel, $K(r)$, over the area of the spot:\n$$\nR(a) = S \\int_{r \\le a} K(r) \\, dA\n$$\nThe kernel $K(r)$ is a Difference-of-Gaussians (DoG):\n$$\nK(r) = K_{c}G(r;\\sigma_{c}) - K_{s}G(r;\\sigma_{s})\n$$\nwhere $G(r;\\sigma)$ is a normalized two-dimensional Gaussian function:\n$$\nG(r;\\sigma) = \\frac{1}{2\\pi\\sigma^{2}}\\exp\\left(-\\frac{r^{2}}{2\\sigma^{2}}\\right)\n$$\nThe integral is performed over a circular disk of radius $a$. In polar coordinates, the differential area element is $dA = r' dr' d\\theta$. Due to the radial symmetry of the kernel, the integration over the angle $\\theta$ from $0$ to $2\\pi$ yields a factor of $2\\pi$.\n$$\nR(a) = S \\int_0^a \\left( K_c G(r';\\sigma_c) - K_s G(r';\\sigma_s) \\right) 2\\pi r' dr'\n$$\nSubstituting the expression for $G(r';\\sigma)$:\n$$\nR(a) = S \\!\\int_0^a \\left[ K_c \\frac{1}{2\\pi\\sigma_c^2}\\exp\\left(-\\frac{r'^2}{2\\sigma_c^2}\\right) - K_s \\frac{1}{2\\pi\\sigma_s^2}\\exp\\left(-\\frac{r'^2}{2\\sigma_s^2}\\right) \\right] 2\\pi r' dr'\n$$\n$$\nR(a) = S \\int_0^a \\left[ \\frac{K_c}{\\sigma_c^2} \\exp\\left(-\\frac{r'^2}{2\\sigma_c^2}\\right) - \\frac{K_s}{\\sigma_s^2} \\exp\\left(-\\frac{r'^2}{2\\sigma_s^2}\\right) \\right] r' dr'\n$$\nThis integral can be solved term by term. For a generic Gaussian term, the integral is:\n$$\n\\int_0^a \\frac{1}{\\sigma^2} \\exp\\left(-\\frac{r'^2}{2\\sigma^2}\\right) r' dr'\n$$\nUsing the substitution $u = -\\frac{r'^2}{2\\sigma^2}$, we have $du = -\\frac{r'}{\\sigma^2} dr'$. The integral becomes:\n$$\n\\int_0^{-a^2/(2\\sigma^2)} (-du) = [-u]_0^{-a^2/(2\\sigma^2)} = -\\left(-\\frac{a^2}{2\\sigma^2}\\right) - (-0) = \\frac{a^2}{2\\sigma^2}\n$$\nThis seems wrong. Let's re-evaluate.\n$$\n\\int_0^a \\frac{r'}{\\sigma^2} \\exp\\left(-\\frac{r'^2}{2\\sigma^2}\\right) dr' = \\left[ -\\exp\\left(-\\frac{r'^2}{2\\sigma^2}\\right) \\right]_0^a = -\\exp\\left(-\\frac{a^2}{2\\sigma^2}\\right) - (-\\exp(0)) = 1 - \\exp\\left(-\\frac{a^2}{2\\sigma^2}\\right)\n$$\nApplying this result to each term in the expression for $R(a)$:\n$$\nR(a) = S \\left[ K_c \\left(1 - \\exp\\left(-\\frac{a^2}{2\\sigma_c^2}\\right)\\right) - K_s \\left(1 - \\exp\\left(-\\frac{a^2}{2\\sigma_s^2}\\right)\\right) \\right]\n$$\nTo find the radius $a^{\\ast}$ that maximizes the response, we must find the derivative of $R(a)$ with respect to $a$ and set it to zero.\n$$\n\\frac{dR}{da} = S \\frac{d}{da} \\left[ K_c - K_c\\exp\\left(-\\frac{a^2}{2\\sigma_c^2}\\right) - K_s + K_s\\exp\\left(-\\frac{a^2}{2\\sigma_s^2}\\right) \\right]\n$$\n$$\n\\frac{dR}{da} = S \\left[ -K_c \\exp\\left(-\\frac{a^2}{2\\sigma_c^2}\\right)\\left(-\\frac{2a}{2\\sigma_c^2}\\right) + K_s \\exp\\left(-\\frac{a^2}{2\\sigma_s^2}\\right)\\left(-\\frac{2a}{2\\sigma_s^2}\\right) \\right]\n$$\n$$\n\\frac{dR}{da} = S \\cdot a \\left[ \\frac{K_c}{\\sigma_c^2}\\exp\\left(-\\frac{a^2}{2\\sigma_c^2}\\right) - \\frac{K_s}{\\sigma_s^2}\\exp\\left(-\\frac{a^2}{2\\sigma_s^2}\\right) \\right]\n$$\nAlternatively, by the Fundamental Theorem of Calculus, $\\frac{d}{da} \\int_0^a f(x)dx=f(a)$. Here, $R(a) = S \\int_0^a K(r') 2\\pi r' dr'$. Thus, $\\frac{dR}{da} = S \\cdot K(a) \\cdot 2\\pi a$. The condition for a maximum at $a = a^{\\ast} > 0$ is $\\frac{dR}{da}|_{a=a^{\\ast}} = 0$, which implies $K(a^{\\ast}) = 0$.\n$$\nK(a^{\\ast}) = K_{c}G(a^{\\ast};\\sigma_{c}) - K_{s}G(a^{\\ast};\\sigma_{s}) = 0\n$$\n$$\nK_{c} \\frac{1}{2\\pi\\sigma_{c}^{2}}\\exp\\left(-\\frac{(a^{\\ast})^{2}}{2\\sigma_{c}^{2}}\\right) = K_{s} \\frac{1}{2\\pi\\sigma_{s}^{2}}\\exp\\left(-\\frac{(a^{\\ast})^{2}}{2\\sigma_{s}^{2}}\\right)\n$$\nWe can now solve for the ratio of gains $B \\equiv K_s/K_c$.\n$$\n\\frac{K_s}{K_c} = \\frac{\\frac{1}{\\sigma_c^2}\\exp\\left(-\\frac{(a^{\\ast})^2}{2\\sigma_c^2}\\right)}{\\frac{1}{\\sigma_s^2}\\exp\\left(-\\frac{(a^{\\ast})^2}{2\\sigma_s^2}\\right)}\n$$\n$$\nB = \\frac{K_s}{K_c} = \\frac{\\sigma_s^2}{\\sigma_c^2} \\exp\\left(-\\frac{(a^{\\ast})^2}{2\\sigma_c^2} + \\frac{(a^{\\ast})^2}{2\\sigma_s^2}\\right)\n$$\nThis gives the analytical expression for the balance metric $B$:\n$$\nB = \\left(\\frac{\\sigma_s}{\\sigma_c}\\right)^2 \\exp\\left( \\frac{(a^{\\ast})^2}{2} \\left(\\frac{1}{\\sigma_s^2} - \\frac{1}{\\sigma_c^2}\\right) \\right)\n$$\nNow we evaluate this expression numerically with the given parameters: $a^{\\ast}=120\\,\\mu\\mathrm{m}$, $\\sigma_{c}=50\\,\\mu\\mathrm{m}$, and $\\sigma_{s}=150\\,\\mu\\mathrm{m}$. The units are consistent and will cancel, so we can use the numerical values directly.\nThe ratio of the standard deviations is:\n$$\n\\frac{\\sigma_s}{\\sigma_c} = \\frac{150}{50} = 3\n$$\nThe squared ratio is:\n$$\n\\left(\\frac{\\sigma_s}{\\sigma_c}\\right)^2 = 3^2 = 9\n$$\nThe term in the exponent is:\n$$\n\\frac{(a^{\\ast})^2}{2} \\left(\\frac{1}{\\sigma_s^2} - \\frac{1}{\\sigma_c^2}\\right) = \\frac{120^2}{2} \\left(\\frac{1}{150^2} - \\frac{1}{50^2}\\right)\n$$\n$$\n= \\frac{14400}{2} \\left(\\frac{1}{22500} - \\frac{1}{2500}\\right) = 7200 \\left(\\frac{1 - 9}{22500}\\right)\n$$\n$$\n= 7200 \\left(\\frac{-8}{22500}\\right) = \\frac{72 \\times (-8)}{225} = \\frac{8 \\times 9 \\times (-8)}{25 \\times 9} = -\\frac{64}{25} = -2.56\n$$\nSubstituting these values back into the expression for $B$:\n$$\nB = 9 \\exp(-2.56)\n$$\nNow, we calculate the numerical value:\n$$\nB \\approx 9 \\times 0.0773047... \\approx 0.6957423...\n$$\nRounding to four significant figures, the balance metric is $B \\approx 0.6957$.\nThis result, $B < 1$, indicates that the peak amplitude of the center Gaussian kernel, which scales with $K_c/\\sigma_c^2$, is greater than that of the surround, $K_s/\\sigma_s^2$. The total integrated strength of the center, $K_c$, is also greater than that of the surround, $K_s$, which is required for an on-center cell to give a net excitatory response to a large uniform bright stimulus.", "answer": "$$\\boxed{0.6957}$$", "id": "5004856"}, {"introduction": "How do neuroscientists determine the structure of a receptive field from experimental recordings? This advanced practice dives into the modern computational methods used to answer that question, focusing on the Generalized Linear Model (GLM) framework. You will implement a pipeline to fit a DoG receptive field model to simulated neural data, exploring how regularization techniques can improve parameter estimation in the face of noise [@problem_id:5004891]. This exercise provides hands-on experience with the statistical tools that are indispensable for analyzing neural data.", "problem": "You are asked to formalize and implement a parameter estimation strategy for center-surround receptive fields modeled as Difference-of-Gaussians (DoG) filters within a Generalized Linear Model (GLM) framework, using spatially smooth regularization and a biologically motivated prior over scale parameters. The end goal is a program that simulates data for specified test cases, fits parameters using both Maximum Likelihood Estimation (MLE) and Maximum A Posteriori (MAP) estimation, and reports whether the regularized MAP fit improves recovery of the center and surround scales compared to MLE.\n\nStarting point definitions and facts:\n- A Generalized Linear Model (GLM) with a Poisson observation model is defined as follows. Given a stimulus vector $\\mathbf{s}_t \\in \\mathbb{R}^{n}$ at time bin $t$, a linear filter $\\mathbf{k} \\in \\mathbb{R}^{n}$, and a bias $b \\in \\mathbb{R}$, the conditional intensity is\n$$\n\\lambda_t = \\exp\\left(b + \\mathbf{k}^{\\top}\\mathbf{s}_t\\right),\n$$\nand the observed spike count $y_t$ is a realization of a Poisson random variable with mean $\\lambda_t$.\n- A Difference-of-Gaussians (DoG) filter for center-surround coding is defined on a two-dimensional grid as a weighted difference between a narrow Gaussian and a broader Gaussian. Let $G(\\sigma)$ denote an isotropic two-dimensional Gaussian discretized on a square grid and normalized to unit sum, with scale parameter $\\sigma>0$. For an On-center ganglion cell, the spatial filter is\n$$\n\\mathbf{k}_{\\text{on}} = \\alpha \\, G(\\sigma_c) - \\beta \\, G(\\sigma_s),\n$$\nwith $\\alpha>0$, $\\beta>0$, $\\sigma_c>0$, $\\sigma_s > \\sigma_c$. For an Off-center ganglion cell, the spatial filter is\n$$\n\\mathbf{k}_{\\text{off}} = -\\alpha \\, G(\\sigma_c) + \\beta \\, G(\\sigma_s),\n$$\nwith the same constraints on $\\alpha$, $\\beta$, $\\sigma_c$, and $\\sigma_s$.\n- Spatial smoothness of the filter can be enforced by penalizing the squared discrete gradient norm of $\\mathbf{k}$ across the grid. Let $\\nabla_x \\mathbf{k}$ and $\\nabla_y \\mathbf{k}$ denote the forward finite differences along the two grid axes; a smoothness functional is\n$$\n\\Omega_{\\text{smooth}}(\\mathbf{k}) = \\sum_{i,j} \\left( (\\nabla_x \\mathbf{k})_{i,j}^2 + (\\nabla_y \\mathbf{k})_{i,j}^2 \\right).\n$$\n- A biologically motivated choice for positive scale parameters is a log-normal prior, reflecting positivity and multiplicative variability. If $\\log \\sigma$ is normally distributed with mean $\\mu$ and variance $\\tau^2$, then for $\\sigma>0$ the negative log-prior (up to an additive constant) is\n$$\n\\phi_{\\text{logN}}(\\sigma; \\mu, \\tau) = \\log \\sigma + \\frac{(\\log \\sigma - \\mu)^2}{2 \\tau^2}.\n$$\n\nYour tasks:\n1. Implement a simulator that, given a square grid of size $N \\times N$, generates a sequence of stimuli $\\{\\mathbf{s}_t\\}_{t=1}^{T}$ where each $\\mathbf{s}_t \\in \\mathbb{R}^{N^2}$ is formed by flattening a grid of independent standard normal variates. Given a DoG parameter set and a bias $b$, generate Poisson spike counts $y_t$ with mean $\\lambda_t = \\exp(b + \\mathbf{k}^{\\top}\\mathbf{s}_t)$.\n2. Implement two estimators of $(\\alpha, \\beta, \\sigma_c, \\sigma_s, b)$ for a known polarity (On-center or Off-center):\n   - The Maximum Likelihood Estimation (MLE) estimator that minimizes the negative log-likelihood\n   $$\n   \\mathcal{L}_{\\text{NLL}}(\\theta) = \\sum_{t=1}^{T} \\left[ \\exp\\left(b + \\mathbf{k}(\\theta)^{\\top}\\mathbf{s}_t\\right) - y_t \\left(b + \\mathbf{k}(\\theta)^{\\top}\\mathbf{s}_t\\right) \\right],\n   $$\n   where $\\theta$ denotes the parameter vector and $\\mathbf{k}(\\theta)$ is the DoG filter constructed from $(\\alpha, \\beta, \\sigma_c, \\sigma_s)$ with the known polarity.\n   - The Maximum A Posteriori (MAP) estimator that minimizes the sum of the negative log-likelihood and regularization terms\n   $$\n   \\mathcal{J}_{\\text{MAP}}(\\theta) = \\mathcal{L}_{\\text{NLL}}(\\theta) + \\lambda_{\\text{prior}} \\left[\\phi_{\\text{logN}}(\\sigma_c; \\mu_c, \\tau_c) + \\phi_{\\text{logN}}(\\sigma_s; \\mu_s, \\tau_s)\\right] + \\lambda_{\\text{smooth}} \\, \\Omega_{\\text{smooth}}\\left(\\mathbf{k}(\\theta)\\right),\n   $$\n   where $\\lambda_{\\text{prior}}$ and $\\lambda_{\\text{smooth}}$ are nonnegative scalars.\n3. Enforce $\\alpha>0$, $\\beta>0$, $\\sigma_c>0$, and $\\sigma_s>\\sigma_c$ by reparameterizing with unconstrained variables and appropriate transformations. A valid approach is to optimize over $\\log \\alpha$, $\\log \\beta$, $\\log \\sigma_c$, and a free variable whose smooth transform ensures $\\log \\sigma_s - \\log \\sigma_c > 0$; express $\\sigma_s$ in terms of these unconstrained parameters so that the inequality is always satisfied.\n4. For each test case in the suite below, fit parameters by both MLE and MAP (starting from the same initialization based on the data, not the ground truth), compute the root-mean-square error (RMSE) of the recovered scales $(\\sigma_c, \\sigma_s)$ with respect to the known ground truth scales, and return a boolean indicating whether the MAP estimator achieves a lower RMSE than the MLE estimator for that case.\n\nGrid and stimulus specification:\n- Use a square grid of size $N=19$ with unit spacing. Construct $G(\\sigma)$ on this grid as $G_{i,j}(\\sigma) = \\exp\\left(-\\frac{x_i^2 + y_j^2}{2 \\sigma^2}\\right)$ normalized so that $\\sum_{i,j} G_{i,j}(\\sigma) = 1$, where $x_i$ and $y_j$ index the centered grid coordinates.\n\nHyperparameters for regularization:\n- Use $\\lambda_{\\text{smooth}} = 0.01$.\n- Use a log-normal prior for $\\sigma_c$ and $\\sigma_s$ with $\\mu_c = \\log(1.2)$, $\\mu_s = \\log(3.6)$, $\\tau_c = 0.35$, $\\tau_s = 0.35$, and $\\lambda_{\\text{prior}} = 100$.\n\nTest suite:\n- Case 1 (happy path): On-center ganglion cell, $T=2000$, ground truth parameters $\\alpha=1.0$, $\\beta=0.8$, $\\sigma_c=1.2$, $\\sigma_s=3.6$, $b=-2.0$.\n- Case 2 (boundary condition with low baseline): Off-center ganglion cell, $T=2000$, ground truth parameters $\\alpha=0.9$, $\\beta=1.2$, $\\sigma_c=0.8$, $\\sigma_s=2.4$, $b=-3.0$.\n- Case 3 (edge case with fewer samples): On-center ganglion cell, $T=500$, ground truth parameters $\\alpha=0.7$, $\\beta=0.7$, $\\sigma_c=1.8$, $\\sigma_s=5.4$, $b=-2.5$.\n\nComputation and reporting:\n- For each case, initialize the optimization at a common starting point obtained from the data (for example, using $\\log \\alpha = 0$, $\\log \\beta = 0$, $\\log \\sigma_c = \\mu_c$, a transform that yields $\\log \\sigma_s - \\log \\sigma_c \\approx \\mu_s - \\mu_c$, and $b$ initialized to $\\log(\\bar{y}+10^{-8})$ where $\\bar{y}$ is the mean of the observed spike counts). Use identical initialization for both MLE and MAP fits within a case.\n- Compute the RMSE for $(\\sigma_c, \\sigma_s)$ as\n$$\n\\text{RMSE} = \\sqrt{ \\frac{\\left(\\hat{\\sigma}_c - \\sigma_c^{\\ast}\\right)^2 + \\left(\\hat{\\sigma}_s - \\sigma_s^{\\ast}\\right)^2}{2} },\n$$\nwhere $\\sigma_c^{\\ast}$ and $\\sigma_s^{\\ast}$ are the ground truth scales and hats denote estimates.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one boolean per test case, in the order of the cases specified above. For example: \"[True,False,True]\".\n\nAll quantities in this problem are dimensionless, so no unit conversion is required. Ensure numerical stability in any exponential or logarithmic computations.", "solution": "The problem requires the implementation and comparison of Maximum Likelihood Estimation (MLE) and Maximum A Posteriori (MAP) for a Generalized Linear Model (GLM) describing the response of a retinal ganglion cell. The cell's receptive field is modeled as a Difference-of-Gaussians (DoG) filter. The comparison is based on the accuracy of recovering the true filter scale parameters from simulated data.\n\nThe core of the model is a Poisson GLM. The spike count $y_t$ in a small time bin $t$ is drawn from a Poisson distribution with mean $\\lambda_t$, which is the conditional intensity or firing rate.\n$$\ny_t \\sim \\text{Poisson}(\\lambda_t)\n$$\nThe rate $\\lambda_t$ is determined by the dot product of a stimulus vector $\\mathbf{s}_t \\in \\mathbb{R}^{n}$ and a linear filter $\\mathbf{k} \\in \\mathbb{R}^{n}$, passed through an exponential nonlinearity. The full expression for the rate is:\n$$\n\\lambda_t = \\exp\\left(b + \\mathbf{k}^{\\top}\\mathbf{s}_t\\right)\n$$\nwhere $b$ is a scalar bias term.\n\nThe linear filter $\\mathbf{k}$ represents the cell's spatial receptive field, modeled as a Difference-of-Gaussians (DoG). A 2D isotropic Gaussian $G(\\sigma)$ is constructed on a square grid of size $N \\times N$, with scale (standard deviation) $\\sigma$. This discrete Gaussian is normalized to have a unit sum. The DoG filter is a weighted sum of a narrow \"center\" Gaussian with scale $\\sigma_c$ and a wider \"surround\" Gaussian with scale $\\sigma_s$. For an On-center cell, the filter is:\n$$\n\\mathbf{k}_{\\text{on}} = \\alpha \\, G(\\sigma_c) - \\beta \\, G(\\sigma_s)\n$$\nand for an Off-center cell, the signs are inverted:\n$$\n\\mathbf{k}_{\\text{off}} = -\\alpha \\, G(\\sigma_c) + \\beta \\, G(\\sigma_s)\n$$\nThe model parameters are $\\theta = (\\alpha, \\beta, \\sigma_c, \\sigma_s, b)$, subject to the constraints $\\alpha>0$, $\\beta>0$, $\\sigma_c>0$, and $\\sigma_s > \\sigma_c$.\n\nTo estimate the parameters $\\theta$ from a dataset of stimuli $\\{\\mathbf{s}_t\\}_{t=1}^T$ and spike counts $\\{y_t\\}_{t=1}^T$, we minimize an objective function.\n\nFor Maximum Likelihood Estimation (MLE), the objective is the negative log-likelihood (NLL) of the data given the parameters. For a Poisson GLM, this is:\n$$\n\\mathcal{L}_{\\text{NLL}}(\\theta) = \\sum_{t=1}^{T} \\left[ \\lambda_t(\\theta) - y_t \\log(\\lambda_t(\\theta)) \\right] = \\sum_{t=1}^{T} \\left[ \\exp\\left(b + \\mathbf{k}(\\theta)^{\\top}\\mathbf{s}_t\\right) - y_t \\left(b + \\mathbf{k}(\\theta)^{\\top}\\mathbf{s}_t\\right) \\right]\n$$\n\nFor Maximum A Posteriori (MAP) estimation, we add regularization terms to the NLL, which correspond to prior beliefs about the parameters. The MAP objective is:\n$$\n\\mathcal{J}_{\\text{MAP}}(\\theta) = \\mathcal{L}_{\\text{NLL}}(\\theta) + P(\\theta)\n$$\nwhere $P(\\theta)$ is the total penalty. In this problem, two penalties are used. First, a spatial smoothness penalty on the filter $\\mathbf{k}$ encourages neighboring pixels in the filter to have similar values:\n$$\n\\Omega_{\\text{smooth}}(\\mathbf{k}) = \\lambda_{\\text{smooth}} \\sum_{i,j} \\left( (\\nabla_x \\mathbf{k})_{i,j}^2 + (\\nabla_y \\mathbf{k})_{i,j}^2 \\right)\n$$\nwhere $\\nabla_x$ and $\\nabla_y$ are discrete gradient operators (finite differences) and $\\lambda_{\\text{smooth}}=0.01$ is a hyperparameter controlling the strength of this regularization.\n\nSecond, a biologically motivated log-normal prior is placed on the positive scale parameters $\\sigma_c$ and $\\sigma_s$. The negative log-prior for a single scale parameter $\\sigma$ is:\n$$\n\\phi_{\\text{logN}}(\\sigma; \\mu, \\tau) = \\log \\sigma + \\frac{(\\log \\sigma - \\mu)^2}{2 \\tau^2}\n$$\nThe total prior penalty is the sum of these terms for $\\sigma_c$ and $\\sigma_s$, scaled by $\\lambda_{\\text{prior}}=100$:\n$$\nP(\\theta) = \\lambda_{\\text{prior}} \\left[\\phi_{\\text{logN}}(\\sigma_c; \\mu_c, \\tau_c) + \\phi_{\\text{logN}}(\\sigma_s; \\mu_s, \\tau_s)\\right] + \\lambda_{\\text{smooth}} \\, \\Omega_{\\text{smooth}}\\left(\\mathbf{k}(\\theta)\\right)\n$$\nwith prior means $\\mu_c = \\log(1.2)$, $\\mu_s = \\log(3.6)$ and variances $\\tau_c^2=\\tau_s^2=0.35^2$.\n\nThe optimization must respect the parameter constraints. A standard way to handle this is to reparameterize the model using unconstrained variables. We define a new parameter vector $\\mathbf{p} = (p_0, p_1, p_2, p_3, p_4)$ and relate it to the original parameters $\\theta$ via transformations that automatically satisfy the constraints:\n- $\\alpha = \\exp(p_0)$  (ensures $\\alpha > 0$)\n- $\\beta = \\exp(p_1)$  (ensures $\\beta > 0$)\n- $\\sigma_c = \\exp(p_2)$ (ensures $\\sigma_c > 0$)\n- $\\sigma_s = \\sigma_c + \\exp(p_3) = \\exp(p_2) + \\exp(p_3)$ (ensures $\\sigma_s > \\sigma_c > 0$)\n- $b = p_4$ (unconstrained)\nThe optimization is performed over this unconstrained vector $\\mathbf{p}$ using a numerical optimizer (`scipy.optimize.minimize` with the `BFGS` algorithm). The objective functions $\\mathcal{L}_{\\text{NLL}}$ and $\\mathcal{J}_{\\text{MAP}}$ are expressed as functions of $\\mathbf{p}$.\n\nThe implementation proceeds as follows for each test case:\n1.  **Data Simulation**: A dataset of $T$ samples is generated. For each sample $t$, a stimulus $\\mathbf{s}_t$ is created by flattening a $19 \\times 19$ grid of independent standard normal random variates. The true filter $\\mathbf{k}^*$ is constructed from the ground truth parameters. Spike counts $y_t$ are then drawn from a Poisson distribution with mean $\\exp(b^* + (\\mathbf{k}^*)^{\\top}\\mathbf{s}_t)$.\n2.  **Initialization**: A common starting point for both MLE and MAP optimization is determined. Following the problem's specification, we set initial values for $\\alpha=1$ and $\\beta=1$. The scale parameters are initialized based on the prior means: $\\sigma_c^{\\text{init}} = \\exp(\\mu_c) = 1.2$ and $\\sigma_s^{\\text{init}} = \\exp(\\mu_s) = 3.6$. The bias $b$ is initialized based on the average observed spike count: $b^{\\text{init}} = \\log(\\bar{y} + 10^{-8})$. These initial values are then transformed into the unconstrained space to get $\\mathbf{p}_{\\text{init}}$.\n3.  **Optimization**: The MLE and MAP objective functions are minimized starting from $\\mathbf{p}_{\\text{init}}$ to find the estimated parameter vectors $\\hat{\\mathbf{p}}_{\\text{MLE}}$ and $\\hat{\\mathbf{p}}_{\\text{MAP}}$. These are then transformed back to the original parameter space to obtain $\\hat{\\theta}_{\\text{MLE}}$ and $\\hat{\\theta}_{\\text{MAP}}$.\n4.  **Evaluation**: The performance of each estimator is quantified by the Root-Mean-Square Error (RMSE) between the estimated scales $(\\hat{\\sigma}_c, \\hat{\\sigma}_s)$ and the ground truth scales $(\\sigma_c^*, \\sigma_s^*)$:\n    $$\n    \\text{RMSE} = \\sqrt{ \\frac{\\left(\\hat{\\sigma}_c - \\sigma_c^{\\ast}\\right)^2 + \\left(\\hat{\\sigma}_s - \\sigma_s^{\\ast}\\right)^2}{2} }\n    $$\n    Finally, a boolean value is recorded, indicating whether the MAP estimator achieved a lower RMSE than the MLE estimator. This process is repeated for all test cases. The expectation is that the MAP estimator, guided by the priors, will be more robust, especially with less data, and yield more accurate parameter recovery.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\nfrom scipy.special import xlogy\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and estimation for all test cases.\n    \"\"\"\n\n    # Grid and stimulus specification\n    N = 19\n    GRID_COORDS = np.arange(N) - (N - 1) / 2\n    X_GRID, Y_GRID = np.meshgrid(GRID_COORDS, GRID_COORDS)\n    \n    # Hyperparameters for regularization\n    HYPERPARAMETERS = {\n        'lambda_smooth': 0.01,\n        'lambda_prior': 100.0,\n        'mu_c': np.log(1.2),\n        'tau_c': 0.35,\n        'mu_s': np.log(3.6),\n        'tau_s': 0.35,\n    }\n\n    # Test suite\n    TEST_CASES = [\n        {\n            'name': 'Case 1',\n            'polarity': 'on',\n            'T': 2000,\n            'true_params': {'alpha': 1.0, 'beta': 0.8, 'sigma_c': 1.2, 'sigma_s': 3.6, 'b': -2.0}\n        },\n        {\n            'name': 'Case 2',\n            'polarity': 'off',\n            'T': 2000,\n            'true_params': {'alpha': 0.9, 'beta': 1.2, 'sigma_c': 0.8, 'sigma_s': 2.4, 'b': -3.0}\n        },\n        {\n            'name': 'Case 3',\n            'polarity': 'on',\n            'T': 500,\n            'true_params': {'alpha': 0.7, 'beta': 0.7, 'sigma_c': 1.8, 'sigma_s': 5.4, 'b': -2.5}\n        },\n    ]\n\n    def get_gaussian(sigma):\n        \"\"\"Generates a normalized 2D Gaussian filter on the grid.\"\"\"\n        if sigma <= 1e-6: # Avoid division by zero, return a delta function centered\n            g = np.zeros((N, N))\n            g[N // 2, N // 2] = 1.0\n            return g.flatten()\n        \n        g = np.exp(-(X_GRID**2 + Y_GRID**2) / (2 * sigma**2))\n        g_sum = np.sum(g)\n        if g_sum > 1e-9:\n            g /= g_sum\n        else: # Handle case of extremely small sigma leading to underflow\n            g.fill(0)\n            g[N // 2, N // 2] = 1.0\n        return g.flatten()\n\n    def unpack_params(p):\n        \"\"\"Transforms unconstrained optimization variables to model parameters.\"\"\"\n        p_alpha, p_beta, p_sigma_c, p_sigma_s_diff, p_b = p\n        alpha = np.exp(p_alpha)\n        beta = np.exp(p_beta)\n        sigma_c = np.exp(p_sigma_c)\n        sigma_s = sigma_c + np.exp(p_sigma_s_diff)\n        b = p_b\n        return {'alpha': alpha, 'beta': beta, 'sigma_c': sigma_c, 'sigma_s': sigma_s, 'b': b}\n\n    def get_dog_filter(params, polarity):\n        \"\"\"Constructs the DoG filter from parameters.\"\"\"\n        g_c = get_gaussian(params['sigma_c'])\n        g_s = get_gaussian(params['sigma_s'])\n        if polarity == 'on':\n            k = params['alpha'] * g_c - params['beta'] * g_s\n        else: # off\n            k = -params['alpha'] * g_c + params['beta'] * g_s\n        return k\n\n    def simulate_data(true_params, polarity, T, seed):\n        \"\"\"Generates stimuli and Poisson spike counts.\"\"\"\n        rng = np.random.default_rng(seed)\n        stimuli = rng.standard_normal((T, N*N))\n        \n        k_true = get_dog_filter(true_params, polarity)\n        b_true = true_params['b']\n        \n        rates = np.exp(b_true + stimuli @ k_true)\n        spikes = rng.poisson(rates)\n        return stimuli, spikes\n\n    def nll_objective(p, stimuli, spikes, polarity):\n        \"\"\"Negative log-likelihood for the Poisson GLM.\"\"\"\n        params = unpack_params(p)\n        k = get_dog_filter(params, polarity)\n        b = params['b']\n\n        lin_pred = b + stimuli @ k\n        \n        # Using xlogy for stability: 0 * log(0) = 0\n        # The problem gives sum(exp(z) - y*z), which is -log_lik.\n        nll = np.sum(np.exp(lin_pred) - spikes * lin_pred)\n        return nll\n\n    def map_objective(p, stimuli, spikes, polarity):\n        \"\"\"MAP objective function (NLL + priors).\"\"\"\n        # Negative log-likelihood\n        nll = nll_objective(p, stimuli, spikes, polarity)\n\n        # Unpack params for regularization terms\n        params = unpack_params(p)\n        sigma_c = params['sigma_c']\n        sigma_s = params['sigma_s']\n        k = get_dog_filter(params, polarity)\n\n        # Log-normal prior penalty\n        log_sigma_c = np.log(sigma_c)\n        log_sigma_s = np.log(sigma_s)\n\n        phi_c = log_sigma_c + (log_sigma_c - HYPERPARAMETERS['mu_c'])**2 / (2 * HYPERPARAMETERS['tau_c']**2)\n        phi_s = log_sigma_s + (log_sigma_s - HYPERPARAMETERS['mu_s'])**2 / (2 * HYPERPARAMETERS['tau_s']**2)\n        prior_penalty = HYPERPARAMETERS['lambda_prior'] * (phi_c + phi_s)\n        \n        # Smoothness penalty\n        k_2d = k.reshape((N, N))\n        grad_x_sq = np.sum(np.diff(k_2d, axis=1)**2)\n        grad_y_sq = np.sum(np.diff(k_2d, axis=0)**2)\n        smoothness_penalty = HYPERPARAMETERS['lambda_smooth'] * (grad_x_sq + grad_y_sq)\n\n        return nll + prior_penalty + smoothness_penalty\n\n    def calculate_rmse(est_scales, true_scales):\n        \"\"\"Calculates RMSE for sigma_c and sigma_s.\"\"\"\n        est_sigma_c, est_sigma_s = est_scales\n        true_sigma_c, true_sigma_s = true_scales\n        rmse = np.sqrt(\n            ((est_sigma_c - true_sigma_c)**2 + (est_sigma_s - true_sigma_s)**2) / 2\n        )\n        return rmse\n\n    results = []\n    for i, case in enumerate(TEST_CASES):\n        # 1. Simulate data\n        stimuli, spikes = simulate_data(case['true_params'], case['polarity'], case['T'], seed=i)\n\n        # 2. Define initial parameters for optimization\n        b_init = np.log(np.mean(spikes) + 1e-8)\n        sigma_c_init = np.exp(HYPERPARAMETERS['mu_c']) # 1.2\n        sigma_s_init = np.exp(HYPERPARAMETERS['mu_s']) # 3.6\n\n        p_init = np.array([\n            np.log(1.0),                               # p_alpha\n            np.log(1.0),                               # p_beta\n            np.log(sigma_c_init),                      # p_sigma_c\n            np.log(sigma_s_init - sigma_c_init),       # p_sigma_s_diff\n            b_init                                     # p_b\n        ])\n\n        # 3. Fit MLE model\n        mle_res = minimize(\n            nll_objective, p_init,\n            args=(stimuli, spikes, case['polarity']),\n            method='BFGS', options={'maxiter': 500}\n        )\n        mle_params_est = unpack_params(mle_res.x)\n\n        # 4. Fit MAP model\n        map_res = minimize(\n            map_objective, p_init,\n            args=(stimuli, spikes, case['polarity']),\n            method='BFGS', options={'maxiter': 500}\n        )\n        map_params_est = unpack_params(map_res.x)\n\n        # 5. Compare RMSE\n        true_scales = (case['true_params']['sigma_c'], case['true_params']['sigma_s'])\n        \n        mle_scales_est = (mle_params_est['sigma_c'], mle_params_est['sigma_s'])\n        rmse_mle = calculate_rmse(mle_scales_est, true_scales)\n        \n        map_scales_est = (map_params_est['sigma_c'], map_params_est['sigma_s'])\n        rmse_map = calculate_rmse(map_scales_est, true_scales)\n        \n        results.append(rmse_map < rmse_mle)\n    \n    print(f\"[{','.join(str(r).capitalize() for r in results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "5004891"}]}