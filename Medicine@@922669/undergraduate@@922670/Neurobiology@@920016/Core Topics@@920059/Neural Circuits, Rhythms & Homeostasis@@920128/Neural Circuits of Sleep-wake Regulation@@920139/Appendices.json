{"hands_on_practices": [{"introduction": "Understanding the neural basis of sleep disorders begins with quantifying their clinical presentation. This practice places you in the role of a sleep scientist, analyzing data from a patient with insomnia. By calculating key metrics from polysomnography (PSG) like sleep efficiency and the arousal index, you will develop a concrete, quantitative picture of fragmented sleep and then use this evidence to form a plausible hypothesis about the underlying dysregulation within the brain's core sleep-wake circuitry [@problem_id:5036881].", "problem": "A patient with chronic insomnia underwent both wrist-worn actigraphy and overnight laboratory polysomnography (PSG). Actigraphy recorded the interval from bed-in to bed-out as $23{:}00$ to $07{:}00$, consistent with a time in bed of $8$ hours. PSG provided the following sleep-stage durations: non-rapid eye movement stage $1$ ($N1$): $45$ minutes, non-rapid eye movement stage $2$ ($N2$): $180$ minutes, slow-wave sleep ($N3$): $60$ minutes, and rapid eye movement ($\\mathrm{REM}$): $45$ minutes. PSG also measured sleep onset latency (the interval from lights-off to the first scored epoch of sleep) as $60$ minutes and counted $77$ microarousals (brief electroencephalogram arousals typically lasting less than $15$ seconds) across the night. In addition, discrete wake episodes after sleep onset and before final awakening were scored with durations of $12$, $8$, $21$, $13$, $14$, and $22$ minutes. \n\nUse core definitions: sleep efficiency is the fraction of the time in bed actually spent asleep, wake after sleep onset (WASO) is the cumulative time spent awake between the first epoch of sleep and final awakening, and the arousal index is the number of microarousals per hour of total sleep time. Starting from these definitions and physiological facts about sleep-wake regulation—specifically, that sleep arises from inhibitory control of ascending arousal systems by the ventrolateral preoptic nucleus (VLPO) and that wakefulness is maintained by ascending monoaminergic systems such as the Locus Coeruleus (LC) noradrenergic nucleus—compute the patient’s sleep efficiency, WASO, and arousal index. Then, reason which circuit element is most plausibly dysregulated in this presentation, justifying your inference in terms of the measured metrics and the known functions of the relevant nuclei.\n\nProvide your final numeric answer as the arousal index value in events per hour of sleep. If the final numeric quantity is non-integer, round to four significant figures. Express sleep efficiency as a unitless decimal fraction and WASO in minutes; express the arousal index in events per hour.", "solution": "The problem is valid as it is scientifically grounded in the principles of sleep medicine and neurobiology, is well-posed with sufficient and consistent data for calculation, and is expressed in objective, formal language. There are no contradictions, ambiguities, or factual inaccuracies. We can proceed with the solution.\n\nThe problem requires the calculation of three key sleep metrics—sleep efficiency, wake after sleep onset, and arousal index—and a subsequent neurobiological inference based on these results. We will first calculate the required metrics based on the provided definitions and data.\n\nThe given data are:\nTime in Bed ($T_{TIB}$): $8.0$ hours, which corresponds to $8.0 \\text{ h} \\times 60 \\text{ min/h} = 480$ minutes.\nSleep Onset Latency ($T_{SOL}$): $60$ minutes.\nNon-rapid eye movement stage $1$ ($T_{N1}$): $45$ minutes.\nNon-rapid eye movement stage $2$ ($T_{N2}$): $180$ minutes.\nSlow-wave sleep ($N3$) ($T_{N3}$): $60$ minutes.\nRapid eye movement sleep ($T_{REM}$): $45$ minutes.\nNumber of microarousals ($N_{arousals}$): $77$.\nDurations of discrete wake episodes after sleep onset ($W_i$): $12$ min, $8$ min, $21$ min, $13$ min, $14$ min, and $22$ min.\n\nFirst, we calculate the Total Sleep Time ($T_{TST}$), which is the sum of the durations of all sleep stages.\n$$\nT_{TST} = T_{N1} + T_{N2} + T_{N3} + T_{REM}\n$$\nSubstituting the given values:\n$$\nT_{TST} = 45 \\text{ min} + 180 \\text{ min} + 60 \\text{ min} + 45 \\text{ min} = 330 \\text{ min}\n$$\n\nNext, we calculate the patient's sleep efficiency ($SE$). Sleep efficiency is defined as the fraction of the time in bed that is actually spent asleep.\n$$\nSE = \\frac{T_{TST}}{T_{TIB}}\n$$\nUsing the calculated $T_{TST}$ and the given $T_{TIB}$:\n$$\nSE = \\frac{330 \\text{ min}}{480 \\text{ min}} = \\frac{33}{48} = \\frac{11}{16} = 0.6875\n$$\nThis value, approximately $68.8\\%$, is significantly below the normative threshold of $85\\%$, indicating poor sleep consolidation.\n\nNext, we calculate the Wake After Sleep Onset ($T_{WASO}$). This is defined as the cumulative time spent awake between the first epoch of sleep and the final awakening. It is the sum of the durations of the discrete wake episodes provided.\n$$\nT_{WASO} = \\sum_{i=1}^{6} W_i\n$$\n$$\nT_{WASO} = 12 \\text{ min} + 8 \\text{ min} + 21 \\text{ min} + 13 \\text{ min} + 14 \\text{ min} + 22 \\text{ min} = 90 \\text{ min}\n$$\nThis represents $1.5$ hours of wakefulness interrupting the sleep period, which is a substantial amount and indicative of fragmented sleep.\nAs a consistency check, the total time in bed should be the sum of sleep latency, total sleep time, and wake after sleep onset: $T_{TIB} = T_{SOL} + T_{TST} + T_{WASO} = 60 \\text{ min} + 330 \\text{ min} + 90 \\text{ min} = 480 \\text{ min}$, which matches the given $8$ hours.\n\nFinally, we compute the Arousal Index ($AI$). This is defined as the number of microarousals per hour of total sleep time.\nFirst, we convert the total sleep time from minutes to hours:\n$$\nT_{TST, \\text{hours}} = \\frac{330 \\text{ min}}{60 \\text{ min/h}} = 5.5 \\text{ h}\n$$\nNow, we can calculate the Arousal Index:\n$$\nAI = \\frac{N_{arousals}}{T_{TST, \\text{hours}}}\n$$\n$$\nAI = \\frac{77}{5.5 \\text{ h}} = 14 \\text{ events/h}\n$$\nAn arousal index greater than $10$ events per hour is generally considered elevated, further confirming a state of fragmented and unstable sleep.\n\nNow, we must reason which circuit element is most plausibly dysregulated. The key pathological findings from our calculations and the givens are:\n1.  Extremely long Sleep Onset Latency ($T_{SOL} = 60$ min): Difficulty initiating sleep.\n2.  High Wake After Sleep Onset ($T_{WASO} = 90$ min): Difficulty maintaining sleep, characterized by long awakenings.\n3.  High Arousal Index ($AI = 14$ events/h): Difficulty maintaining sleep, characterized by frequent, brief EEG arousals.\n4.  Low Sleep Efficiency ($SE = 0.6875$): The overall outcome of the above deficits.\n\nThese metrics collectively define a phenotype of severe \"sleep-maintenance insomnia\" and \"sleep-onset insomnia.\" This condition is characterized by a failure to produce and sustain a consolidated sleep state.\n\nThe problem anchors the neurobiological reasoning in the functions of two key circuit elements:\n-   The ventrolateral preoptic nucleus (VLPO), which actively promotes sleep by releasing inhibitory neurotransmitters (GABA, galanin) to suppress the brain's arousal systems.\n-   The Locus Coeruleus (LC), a major noradrenergic nucleus that is part of the ascending arousal system responsible for promoting and maintaining wakefulness.\n\nThe sleep-wake cycle is governed by a mutually inhibitory \"flip-flop\" switch between the sleep-promoting VLPO and the wake-promoting arousal nuclei (including the LC). A stable sleep state requires the VLPO to be sufficiently active to tonically inhibit the arousal systems.\n\nThe patient's data indicates a profound and persistent failure of this inhibition.\n-   The high $T_{SOL}$ reflects an inability of the VLPO to overcome the activity of the arousal systems at the beginning of the sleep period.\n-   The high $T_{WASO}$ and high $AI$ reflect an inability of the VLPO to *sustain* this inhibition throughout the night, leading to macroscopic (awakenings) and microscopic (arousals) intrusions of wakefulness.\n\nThis global failure of inhibition can be interpreted in two ways:\n1.  **VLPO Underactivity (Hypofunction):** A primary deficit in the VLPO itself, where it is unable to generate or sustain a sufficient inhibitory signal to suppress a normally functioning arousal system.\n2.  **Arousal System Overactivity (Hyperfunction):** A primary deficit in nuclei like the LC, which are pathologically overactive (a state often termed \"hyperarousal\"). This hyperactivity would require an unusually strong inhibitory signal from the VLPO to be suppressed, which a normally functioning VLPO might not be able to provide.\n\nBoth scenarios lead to the same outcome: the flip-flop switch is biased toward wakefulness and is unstable during the sleep period. However, the question asks for the *most plausible* dysregulated element. The entire syndrome—difficulty initiating, maintaining, and consolidating sleep—points to a fundamental breakdown in the active process of sleep generation and stabilization. Since the VLPO is the principal executive nucleus for this process, a dysregulation within the VLPO, leading to its functional insufficiency, provides the most direct and parsimonious explanation for the full spectrum of observed deficits. A malfunctioning VPLO cannot effectively \"apply the brakes\" on the arousal system, resulting in the observed difficulty getting to sleep and staying asleep. Therefore, dysregulation of the VLPO is the most plausible primary source of the observed pathology.", "answer": "$$\n\\boxed{14}\n$$", "id": "5036881"}, {"introduction": "A true test of a scientific model is its ability to make accurate predictions. This exercise challenges you to apply the canonical 'flip-flop switch' model of sleep-wake regulation to a classic experimental scenario. You will predict the system-wide consequences of selectively removing the orexin/hypocretin neurons, a manipulation that models the neurobiology of narcolepsy type 1, thereby deepening your understanding of how this neuropeptide system stabilizes our states of consciousness [@problem_id:5036961].", "problem": "A laboratory generates a mouse line in which Orexin (Hypocretin) neurons in the Lateral Hypothalamus (LH) are conditionally ablated during adulthood, leaving monoaminergic nuclei anatomically and functionally intact. Histology and in vivo electrophysiology confirm preserved Locus Coeruleus (LC; noradrenergic), Dorsal Raphe Nucleus (DRN; serotonergic), and Tuberomammillary Nucleus (TMN; histaminergic) cell numbers and firing capacity to glutamatergic drive. Melanin-Concentrating Hormone (MCH) neurons in the LH are unaffected. Animals are instrumented for Polysomnography (PSG), including Electroencephalogram (EEG) and Electromyogram (EMG), and recorded across a $24$-hour light-dark cycle. Cataplexy is operationally defined as sudden, transient postural collapse with EMG atonia during wakefulness accompanied by an EEG pattern resembling Rapid Eye Movement (REM) sleep.\n\nUsing only well-established principles of sleep-wake circuitry—namely: (i) the flip-flop organization between the sleep-promoting Ventrolateral Preoptic Area (VLPO) and the ascending monoaminergic-cholinergic arousal system, (ii) the excitatory, stabilizing action of orexin projections onto wake-promoting and REM-off neurons, and (iii) the characterization of REM sleep as cortical activation with muscle atonia—predict the most likely combination of PSG changes and cataplexy triggers in these mice.\n\nWhich option best matches the expected observations?\n\nA. Consolidated wake with increased sleep latency, fewer state transitions per hour, prolonged REM latency, and absence of cataplexy unless monoaminergic nuclei are also ablated.\n\nB. Marked fragmentation of wake and Non-Rapid Eye Movement (NREM) sleep with frequent direct wake-to-REM and NREM-to-REM transitions, reduced REM latency including sleep-onset REM periods, and cataplexy reliably elicited by positively valenced stimuli such as palatable food or social play.\n\nC. Decreased overall REM sleep due to intact monoaminergic tone, with cataplexy primarily triggered by aversive startle or predator odor.\n\nD. Near-normal PSG architecture with increased locomotor activity, and cataplexy triggered only by enforced sleep deprivation.", "solution": "The problem statement describes a scientifically valid and well-posed experimental scenario in neurobiology. It asks to predict the phenotype of a mouse model with adult-onset conditional ablation of orexin (hypocretin) neurons, based on established principles of sleep-wake circuitry.\n\n**Problem Validation**\n\n1.  **Extract Givens**:\n    -   **System**: A mouse line with conditional ablation of Orexin (Hypocretin) neurons in the Lateral Hypothalamus (LH) during adulthood.\n    -   **Intact Circuitry**: Monoaminergic nuclei (Locus Coeruleus/LC, Dorsal Raphe Nucleus/DRN, Tuberomammillary Nucleus/TMN) are anatomically and functionally intact. Melanin-Concentrating Hormone (MCH) neurons in the LH are unaffected.\n    -   **Measurements**: Polysomnography (PSG) with Electroencephalogram (EEG) and Electromyogram (EMG) over a $24$-hour light-dark cycle.\n    -   **Definition**: Cataplexy is defined as a sudden, transient postural collapse with EMG atonia during wakefulness, with an EEG pattern like Rapid Eye Movement (REM) sleep.\n    -   **Guiding Principles**:\n        -   (i) The \"flip-flop\" model between the sleep-promoting Ventrolateral Preoptic Area (VLPO) and the wake-promoting ascending arousal system.\n        -   (ii) Orexin provides excitatory, stabilizing input to wake-promoting and REM-off neurons.\n        -   (iii) REM sleep is characterized by cortical activation (EEG) and muscle atonia (EMG).\n\n2.  **Validate Using Extracted Givens**:\n    -   **Scientific Grounding**: The problem is based on the canonical model of sleep-wake regulation. The functions of orexin, the VLPO, and monoaminergic nuclei (LC, DRN, TMN) are central and well-established concepts in neuroscience. The experimental paradigm (conditional neuronal ablation) and measurement techniques (PSG) are standard in the field. The described scenario is the classic animal model for narcolepsy type $1$. The problem is scientifically sound.\n    -   **Well-Posed**: The problem sets up a clear cause (ablation of orexin neurons) and asks for the effect on sleep architecture and behavior, providing the necessary principles to derive the answer. The question is specific and has a unique, predictable outcome based on current understanding.\n    -   **Objective**: The language is precise, technical, and free of subjective bias.\n\n3.  **Verdict**: The problem is valid. The solution process can proceed.\n\n**Derivation of the Solution**\n\nThe problem requires us to predict the consequences of losing orexin neurons by applying the three provided principles.\n\n1.  **Analysis based on Principle (i) and (ii) - Wake/Sleep Stability**:\n    The sleep-wake cycle is regulated by a \"flip-flop\" switch [Principle (i)] between the sleep-promoting VLPO and the wake-promoting monoaminergic nuclei (LC, DRN, TMN). Such a switch allows for rapid transitions but is inherently unstable. Orexin neurons provide a crucial stabilizing influence on this switch. According to Principle (ii), orexin projects to and excites the wake-promoting monoaminergic neurons. This excitatory drive from orexin holds the \"wake\" side of the flip-flop switch firmly in the \"on\" position during wakefulness, thereby consolidating the wake state and preventing unwanted transitions into sleep.\n\n    In the described mice, the orexin neurons are ablated. This removes the stabilizing excitatory input to the LC, DRN, and TMN. Consequently, the sleep-wake flip-flop switch becomes highly unstable. The system can no longer maintain long, consolidated periods of either wakefulness or sleep. This leads to:\n    -   **Wake fragmentation**: Brief, irresistible episodes of sleep intruding into the normal wake period.\n    -   **Sleep fragmentation**: Frequent arousals from sleep.\n    -   **Increased state transitions**: The total number of transitions between wake, Non-Rapid Eye Movement (NREM) sleep, and REM sleep per hour will be significantly elevated.\n\n2.  **Analysis based on Principle (ii) and (iii) - REM Sleep Regulation and Cataplexy**:\n    The monoaminergic neurons of the LC (noradrenergic) and DRN (serotonergic) are not only wake-promoting but also strongly \"REM-off,\" meaning their activity suppresses REM sleep. Principle (ii) states that orexin excites these REM-off neurons. By exciting the REM-off cells, orexin normally serves to prevent the intrusion of REM sleep phenomena into wakefulness.\n\n    With the loss of orexin, the excitatory drive onto these REM-off monoaminergic neurons is diminished. This has two major consequences for REM sleep regulation:\n    -   **Reduced REM Latency**: After an animal falls asleep, the activity of monoaminergic REM-off neurons must decrease to permit entry into REM sleep. Without the tonic excitatory input from orexin, these neurons may become silent more quickly after sleep onset. This results in a significantly **reduced REM latency** (the time from sleep onset to the first REM period). In severe cases, REM sleep may initiate immediately upon falling asleep, a phenomenon known as Sleep-Onset REM Periods (SOREMPs). This also facilitates direct transitions from wakefulness to REM sleep.\n    -   **Cataplexy**: Cataplexy is defined as muscle atonia (a cardinal feature of REM sleep) occurring during wakefulness [Principle (iii)]. The loss of orexin's stabilizing input to REM-off neurons leaves the motor system vulnerable to the inappropriate activation of REM sleep atonia pathways. Strong emotions, particularly positive ones (e.g., excitement from palatable food, play), are processed by limbic circuits (such as the amygdala) that can powerfully inhibit monoaminergic neurons. In an orexin-deficient brain, this emotion-driven inhibition is sufficient to silence the already destabilized REM-off neurons, triggering a sudden collapse into muscle atonia while the subject is awake—this is the defining event of **cataplexy**. Therefore, cataplexy is expected and should be reliably triggered by strong, positively valenced stimuli.\n\n**Summary of Predictions**:\nThe ablation of orexin neurons will cause a phenotype closely resembling human narcolepsy with cataplexy. This includes:\n-   Severe fragmentation of both wakefulness and NREM sleep.\n-   A high frequency of state transitions.\n-   Shortened latency to REM sleep, with the presence of SOREMPs.\n-   The occurrence of cataplexy, which is characteristically triggered by strong positive emotions.\n\n**Evaluation of Options**\n\n*   **A. Consolidated wake with increased sleep latency, fewer state transitions per hour, prolonged REM latency, and absence of cataplexy unless monoaminergic nuclei are also ablated.**\n    This option describes the opposite of the expected phenotype. Orexin *promotes* consolidated wake and *prolongs* REM latency. Its absence leads to fragmented wake, increased state transitions, and reduced REM latency. Cataplexy is a direct consequence of orexin neuron loss, even with intact monoaminergic nuclei.\n    **Verdict: Incorrect.**\n\n*   **B. Marked fragmentation of wake and Non-Rapid Eye Movement (NREM) sleep with frequent direct wake-to-REM and NREM-to-REM transitions, reduced REM latency including sleep-onset REM periods, and cataplexy reliably elicited by positively valenced stimuli such as palatable food or social play.**\n    This option accurately captures all the key predictions derived from the principles. It correctly identifies state fragmentation, frequent aberrant transitions into REM sleep (including SOREMPs), reduced REM latency, and the characteristic emotional trigger for cataplexy.\n    **Verdict: Correct.**\n\n*   **C. Decreased overall REM sleep due to intact monoaminergic tone, with cataplexy primarily triggered by aversive startle or predator odor.**\n    While the monoaminergic nuclei are REM-off, their stability is compromised without orexin, leading to REM intrusions, not necessarily a decrease in total REM sleep. The trigger for classic cataplexy is strongly associated with positive emotions, not aversive stimuli like fear or startle.\n    **Verdict: Incorrect.**\n\n*   **D. Near-normal PSG architecture with increased locomotor activity, and cataplexy triggered only by enforced sleep deprivation.**\n    The PSG architecture will be profoundly abnormal due to state instability; it will not be \"near-normal.\" While orexin is involved in arousal, its loss leads to sleepiness, not hyperactivity. Sleep deprivation can worsen symptoms but is not the primary trigger for cataplectic attacks, which are typically emotion-induced.\n    **Verdict: Incorrect.**", "answer": "$$\\boxed{B}$$", "id": "5036961"}, {"introduction": "While circuit diagrams provide a qualitative map of the brain, computational models allow us to formalize these connections and make quantitative, testable predictions. This advanced practice introduces a simplified rate-based model of the sleep-wake control network, where the activity of key nuclei influences others through a set of connection weights. Using simulated firing rate data, you will employ a foundational data-fitting technique to work backwards and estimate the signs and strengths of these connections, gaining insight into how neurobiologists build and validate models of circuit function [@problem_id:5036916].", "problem": "You are given a simplified steady-state rate model of four interacting neural populations central to sleep-wake regulation: Locus Coeruleus (LC), Dorsal Raphe Nucleus (DRN), Tuberomammillary Nucleus (TMN), and Pedunculopontine Tegmentum / Laterodorsal Tegmentum (PPT/LDT). Denote the steady-state firing rate of each population in a given behavioral state by $r_{\\mathrm{LC}}^s$, $r_{\\mathrm{DRN}}^s$, $r_{\\mathrm{TMN}}^s$, and $r_{\\mathrm{PPT}}^s$, respectively, where $s \\in \\{\\text{Wake}, \\text{Non-Rapid Eye Movement (NREM)}, \\text{Rapid Eye Movement (REM)}\\}$. Firing rates are reported in hertz (Hz). The behavioral states correspond to quasi-steady operating points of the circuit.\n\nUse the following context-appropriate fundamental base. Near a fixed point, a rate-based network can be approximated by a linear steady-state relation derived from the Wilson–Cowan framework: $$\\mathbf{r}^* \\approx \\mathbf{W}\\,\\mathbf{r}^* + \\mathbf{I},$$ where $\\mathbf{r}^*$ is the vector of steady-state firing rates, $\\mathbf{W}$ is the effective coupling matrix, and $\\mathbf{I}$ is the net external drive. In this problem, you will use a reduced parametrization appropriate to the sleep-wake circuit: mutual interactions within the monoaminergic nodes (LC, DRN, TMN) are pooled into a single cross-coupling parameter, interactions from PPT/LDT to monoamines and vice versa are pooled into single parameters, and state-dependent external drive is represented by a known pattern scaled by an unknown amplitude per state.\n\nAssume the following linear steady-state model in the operating regime of interest:\n- For each monoaminergic population $i \\in \\{\\mathrm{LC}, \\mathrm{DRN}, \\mathrm{TMN}\\}$,\n$$r_i^s = w_{\\mathrm{MM}} \\sum_{\\substack{j \\in \\{\\mathrm{LC},\\mathrm{DRN},\\mathrm{TMN}\\} \\\\ j \\neq i}} r_j^s \\;+\\; w_{P \\to M}\\, r_{\\mathrm{PPT}}^s \\;+\\; a_s\\, E_i^s.$$\n- For the cholinergic population,\n$$r_{\\mathrm{PPT}}^s = w_{M \\to P} \\sum_{j \\in \\{\\mathrm{LC},\\mathrm{DRN},\\mathrm{TMN}\\}} r_j^s \\;+\\; a_s\\, E_{\\mathrm{PPT}}^s.$$\n\nHere, $w_{\\mathrm{MM}}$ is the strength of cross-coupling among monoamines (assumed identical across pairs), $w_{P \\to M}$ is the strength of coupling from PPT/LDT to monoamines, and $w_{M \\to P}$ is the strength of coupling from monoamines to PPT/LDT. The term $a_s$ is the unknown amplitude of a known, state-specific external drive pattern $\\mathbf{E}^s$ with components $E_i^s$ for $i \\in \\{\\mathrm{LC},\\mathrm{DRN},\\mathrm{TMN},\\mathrm{PPT}\\}$. The external drive patterns $\\mathbf{E}^s$ (dimensionless) are given by:\n- Wake external drive pattern $\\mathbf{E}^{\\mathrm{Wake}} = [\\,1,\\,1,\\,1,\\,0.2\\,]$,\n- NREM external drive pattern $\\mathbf{E}^{\\mathrm{NREM}} = [\\,-1,\\,-1,\\,-1,\\,-0.5\\,]$,\n- REM external drive pattern $\\mathbf{E}^{\\mathrm{REM}} = [\\,-0.5,\\,-0.5,\\,-0.5,\\,1\\,]$.\n\nAll firing rates are measured in hertz (Hz) and provided below for three independent test cases. For each test case, the data consist of $12$ measured values: $4$ populations across $3$ behavioral states. Your task is to infer the most plausible sign and strength (real-valued estimates) of $w_{\\mathrm{MM}}$, $w_{P \\to M}$, and $w_{M \\to P}$ that best explain the measured steady-state rates under the model above, while simultaneously estimating the unknown amplitudes $a_{\\mathrm{Wake}}$, $a_{\\mathrm{NREM}}$, and $a_{\\mathrm{REM}}$. Use a least-squares solution to fit the linear system implied by the equations, treating the parameters as constants across states.\n\nTo classify the inferred synaptic interaction signs, use the following convention: excitatory is reported as $+1$, inhibitory as $-1$, and negligible as $0$. A coupling $w$ is classified as negligible if $|w|  \\epsilon$, where $\\epsilon$ is a small tolerance set to $\\epsilon = 10^{-6}$.\n\nTest suite (each rate is in hertz (Hz)):\n- Case $1$:\n  - Wake: $[\\,5.0,\\,4.0,\\,3.0,\\,6.0\\,]$\n  - NREM: $[\\,0.5,\\,0.6,\\,0.4,\\,2.0\\,]$\n  - REM: $[\\,0.2,\\,0.2,\\,0.1,\\,10.0\\,]$\n- Case $2$:\n  - Wake: $[\\,4.0,\\,3.5,\\,3.2,\\,5.0\\,]$\n  - NREM: $[\\,0.4,\\,0.5,\\,0.3,\\,1.8\\,]$\n  - REM: $[\\,0.3,\\,0.25,\\,0.2,\\,9.0\\,]$\n- Case $3$:\n  - Wake: $[\\,6.0,\\,5.5,\\,4.5,\\,2.0\\,]$\n  - NREM: $[\\,0.3,\\,0.3,\\,0.3,\\,1.5\\,]$\n  - REM: $[\\,0.1,\\,0.15,\\,0.1,\\,11.0\\,]$\n\nYour program must:\n- Construct, for each case, the linear system implied by the model using the observed rates and the known external drive patterns.\n- Solve, for each case, the least-squares estimate of the parameter vector $\\boldsymbol{\\theta} = [w_{\\mathrm{MM}}, w_{P \\to M}, w_{M \\to P}, a_{\\mathrm{Wake}}, a_{\\mathrm{NREM}}, a_{\\mathrm{REM}}]$.\n- Return, for each case, a list containing [$w_{\\mathrm{MM}}$, $w_{P \\to M}$, $w_{M \\to P}$, $s_{\\mathrm{MM}}$, $s_{P \\to M}$, $s_{M \\to P}$], where $s_{\\cdot} \\in \\{-1,0,+1\\}$ is the sign classification using the tolerance $\\epsilon = 10^{-6}$ as defined above.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list as specified above. For example, the output must look like $[\\, [\\cdots], [\\cdots], [\\cdots] \\,]$. No additional text should be printed.", "solution": "The problem requires the estimation of six parameters in a simplified linear steady-state model of the sleep-wake regulatory neural circuit. The parameters to be estimated are the coupling strengths $w_{\\mathrm{MM}}$ (monoamine-monoamine), $w_{P \\to M}$ (cholinergic-to-monoaminergic), and $w_{M \\to P}$ (monoaminergic-to-cholinergic), along with three state-dependent external drive amplitudes $a_{\\mathrm{Wake}}$, $a_{\\mathrm{NREM}}$, and $a_{\\mathrm{REM}}$. The estimation is to be performed for three independent test cases using a least-squares fitting procedure.\n\nFirst, we must formalize the problem as a system of linear equations in the standard matrix form $\\mathbf{A} \\boldsymbol{\\theta} = \\mathbf{b}$, where $\\boldsymbol{\\theta}$ is the vector of unknown parameters, $\\mathbf{A}$ is a design matrix constructed from the observed firing rates and known external drive patterns, and $\\mathbf{b}$ is a vector of the observed firing rates.\n\nThe vector of unknown parameters $\\boldsymbol{\\theta}$ is a $6 \\times 1$ column vector:\n$$\n\\boldsymbol{\\theta} = \\begin{bmatrix} w_{\\mathrm{MM}} \\\\ w_{P \\to M} \\\\ w_{M \\to P} \\\\ a_{\\mathrm{Wake}} \\\\ a_{\\mathrm{NREM}} \\\\ a_{\\mathrm{REM}} \\end{bmatrix}\n$$\n\nThe model provides a set of equations for the steady-state firing rates $r_i^s$ of four neural populations ($i \\in \\{\\mathrm{LC}, \\mathrm{DRN}, \\mathrm{TMN}, \\mathrm{PPT}\\}$) across three behavioral states ($s \\in \\{\\mathrm{Wake}, \\mathrm{NREM}, \\mathrm{REM}\\}$). This yields a total of $4 \\times 3 = 12$ equations for each test case. Let's rearrange these equations to isolate the knowns and unknowns.\n\nThe given model equations are:\n1. For each monoaminergic population $i \\in \\{\\mathrm{LC}, \\mathrm{DRN}, \\mathrm{TMN}\\}$:\n$$r_i^s = w_{\\mathrm{MM}} \\sum_{\\substack{j \\in \\{\\mathrm{LC},\\mathrm{DRN},\\mathrm{TMN}\\} \\\\ j \\neq i}} r_j^s \\;+\\; w_{P \\to M}\\, r_{\\mathrm{PPT}}^s \\;+\\; a_s\\, E_i^s$$\n2. For the cholinergic population $i = \\mathrm{PPT}$:\n$$r_{\\mathrm{PPT}}^s = w_{M \\to P} \\sum_{j \\in \\{\\mathrm{LC},\\mathrm{DRN},\\mathrm{TMN}\\}} r_j^s \\;+\\; a_s\\, E_{\\mathrm{PPT}}^s$$\n\nWe can rewrite these equations in a form where the left side consists of terms containing the unknown parameters $\\boldsymbol{\\theta}$ and the right side is the observed firing rate.\n\nFor a specific state $s$ and a monoaminergic population $i \\in \\{\\mathrm{LC}, \\mathrm{DRN}, \\mathrm{TMN}\\}$:\n$$ \\left( \\sum_{\\substack{j \\in M \\\\ j \\neq i}} r_j^s \\right) w_{\\mathrm{MM}} + (r_{\\mathrm{PPT}}^s) w_{P \\to M} + (0) w_{M \\to P} + (\\delta_{s, \\mathrm{Wake}} E_i^s) a_{\\mathrm{Wake}} + (\\delta_{s, \\mathrm{NREM}} E_i^s) a_{\\mathrm{NREM}} + (\\delta_{s, \\mathrm{REM}} E_i^s) a_{\\mathrm{REM}} = r_i^s $$\nwhere $M = \\{\\mathrm{LC}, \\mathrm{DRN}, \\mathrm{TMN}\\}$ and $\\delta_{s,s'}$ is the Kronecker delta, which is $1$ if $s=s'$ and $0$ otherwise.\n\nFor a specific state $s$ and the cholinergic population $i = \\mathrm{PPT}$:\n$$ (0) w_{\\mathrm{MM}} + (0) w_{P \\to M} + \\left( \\sum_{j \\in M} r_j^s \\right) w_{M \\to P} + (\\delta_{s, \\mathrm{Wake}} E_{\\mathrm{PPT}}^s) a_{\\mathrm{Wake}} + (\\delta_{s, \\mathrm{NREM}} E_{\\mathrm{PPT}}^s) a_{\\mathrm{NREM}} + (\\delta_{s, \\mathrm{REM}} E_{\\mathrm{PPT}}^s) a_{\\mathrm{REM}} = r_{\\mathrm{PPT}}^s $$\n\nThese $12$ equations (one for each pair of population and state) form an overdetermined system $\\mathbf{A}\\boldsymbol{\\theta} \\approx \\mathbf{b}$. The design matrix $\\mathbf{A}$ is a $12 \\times 6$ matrix, and the vector $\\mathbf{b}$ is a $12 \\times 1$ vector. Each row of $\\mathbf{A}$ corresponds to one equation, with the columns representing the coefficients of the parameters $w_{\\mathrm{MM}}, w_{P \\to M}, w_{M \\to P}, a_{\\mathrm{Wake}}, a_{\\mathrm{NREM}}, a_{\\mathrm{REM}}$ respectively. The vector $\\mathbf{b}$ contains the measured firing rates $r_i^s$ for the corresponding equation.\n\nLet's order the rows of the system by state (Wake, then NREM, then REM) and within each state by population (LC, DRN, TMN, PPT). The vector $\\mathbf{b}$ for each test case is constructed by stacking the measured firing rates in this order. For example, for Case 1:\n$\\mathbf{b} = [5.0, 4.0, 3.0, 6.0, 0.5, 0.6, 0.4, 2.0, 0.2, 0.2, 0.1, 10.0]^T$.\n\nThe matrix $\\mathbf{A}$ is constructed row by row. For example, the first row, corresponding to the LC population during Wake state ($i=\\mathrm{LC}, s=\\mathrm{Wake}$), is:\n$$ \\begin{bmatrix} (r_{\\mathrm{DRN}}^{\\mathrm{Wake}} + r_{\\mathrm{TMN}}^{\\mathrm{Wake}}),  r_{\\mathrm{PPT}}^{\\mathrm{Wake}},  0,  E_{\\mathrm{LC}}^{\\mathrm{Wake}},  0,  0 \\end{bmatrix} $$\nThe seventh row, corresponding to the DRN population during NREM state ($i=\\mathrm{DRN}, s=\\mathrm{NREM}$), is:\n$$ \\begin{bmatrix} (r_{\\mathrm{LC}}^{\\mathrm{NREM}} + r_{\\mathrm{TMN}}^{\\mathrm{NREM}}),  r_{\\mathrm{PPT}}^{\\mathrm{NREM}},  0,  0,  E_{\\mathrm{DRN}}^{\\mathrm{NREM}},  0 \\end{bmatrix} $$\nThe fourth row, corresponding to the PPT population during Wake state ($i=\\mathrm{PPT}, s=\\mathrm{Wake}$), is:\n$$ \\begin{bmatrix} 0,  0,  (r_{\\mathrm{LC}}^{\\mathrm{Wake}} + r_{\\mathrm{DRN}}^{\\mathrm{Wake}} + r_{\\mathrm{TMN}}^{\\mathrm{Wake}}),  E_{\\mathrm{PPT}}^{\\mathrm{Wake}},  0,  0 \\end{bmatrix} $$\nThis procedure is repeated for all $12$ combinations of population and state to fully construct the $12 \\times 6$ matrix $\\mathbf{A}$.\n\nThe least-squares estimate $\\boldsymbol{\\theta}^*$ that minimizes the Euclidean norm of the residual, $\\| \\mathbf{A}\\boldsymbol{\\theta} - \\mathbf{b} \\|_2$, is given by the solution to the normal equations:\n$$ \\mathbf{A}^T \\mathbf{A} \\boldsymbol{\\theta}^* = \\mathbf{A}^T \\mathbf{b} $$\nAssuming $\\mathbf{A}^T \\mathbf{A}$ is invertible, the solution is:\n$$ \\boldsymbol{\\theta}^* = (\\mathbf{A}^T \\mathbf{A})^{-1} \\mathbf{A}^T \\mathbf{b} $$\nNumerically, it is more stable to compute this solution using methods such as QR decomposition or singular value decomposition (SVD), as implemented in standard numerical libraries.\n\nAfter obtaining the parameter vector $\\boldsymbol{\\theta}^* = [w_{\\mathrm{MM}}, w_{P \\to M}, w_{M \\to P}, a_{\\mathrm{Wake}}, a_{\\mathrm{NREM}}, a_{\\mathrm{REM}}]^T$, we extract the three coupling strengths: $w_{\\mathrm{MM}}, w_{P \\to M}, w_{M \\to P}$.\nTheir signs are classified according to the specified rule with a tolerance $\\epsilon = 10^{-6}$:\n- A coupling $w$ is excitatory ($+1$) if $w  \\epsilon$.\n- It is inhibitory ($-1$) if $w  -\\epsilon$.\n- It is negligible ($0$) if $|w| \\leq \\epsilon$.\n\nThis entire procedure is applied independently to each of the three test cases provided. The final result for each case is a list of six values: $[w_{\\mathrm{MM}}, w_{P \\to M}, w_{M \\to P}, s_{\\mathrm{MM}}, s_{P \\to M}, s_{M \\to P}]$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for neural circuit parameters using a least-squares fit for multiple test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1\n        {\n            'Wake': [5.0, 4.0, 3.0, 6.0],\n            'NREM': [0.5, 0.6, 0.4, 2.0],\n            'REM': [0.2, 0.2, 0.1, 10.0]\n        },\n        # Case 2\n        {\n            'Wake': [4.0, 3.5, 3.2, 5.0],\n            'NREM': [0.4, 0.5, 0.3, 1.8],\n            'REM': [0.3, 0.25, 0.2, 9.0]\n        },\n        # Case 3\n        {\n            'Wake': [6.0, 5.5, 4.5, 2.0],\n            'NREM': [0.3, 0.3, 0.3, 1.5],\n            'REM': [0.1, 0.15, 0.1, 11.0]\n        }\n    ]\n\n    # External drive patterns E^s = [E_LC, E_DRN, E_TMN, E_PPT]\n    E_patterns = {\n        'Wake': [1.0, 1.0, 1.0, 0.2],\n        'NREM': [-1.0, -1.0, -1.0, -0.5],\n        'REM': [-0.5, -0.5, -0.5, 1.0]\n    }\n    \n    # Population and state ordering\n    states = ['Wake', 'NREM', 'REM']\n    # Parameters in theta vector: w_MM, w_P-M, w_M-P, a_Wake, a_NREM, a_REM\n    num_params = 6\n\n    # Tolerance for sign classification\n    epsilon = 1e-6\n\n    def classify_sign(w):\n        if w  epsilon:\n            return 1\n        elif w  -epsilon:\n            return -1\n        else:\n            return 0\n\n    results = []\n    for rates_case in test_cases:\n        A_rows = []\n        b_vals = []\n        \n        # Mapping from state name to the index of its amplitude 'a_s' in the theta vector\n        state_to_a_idx = {'Wake': 3, 'NREM': 4, 'REM': 5}\n\n        # Construct the design matrix A and vector b\n        for state_name in states:\n            r_s = rates_case[state_name]\n            E_s = E_patterns[state_name]\n            \n            # Monoaminergic rates r_LC, r_DRN, r_TMN and their sum\n            r_mono = r_s[:3]\n            sum_mono = sum(r_mono)\n            # Cholinergic rate r_PPT\n            r_ppt = r_s[3]\n            \n            # Equations for the three monoaminergic populations (LC, DRN, TMN)\n            for i in range(3):\n                row = [0.0] * num_params\n                sum_other_mono = sum_mono - r_mono[i]\n                \n                # Coefficient for w_MM\n                row[0] = sum_other_mono\n                # Coefficient for w_P-M\n                row[1] = r_ppt\n                # Coefficient for a_s\n                row[state_to_a_idx[state_name]] = E_s[i]\n                \n                A_rows.append(row)\n                b_vals.append(r_mono[i])\n\n            # Equation for the cholinergic population (PPT)\n            row = [0.0] * num_params\n            # Coefficient for w_M-P\n            row[2] = sum_mono\n            # Coefficient for a_s\n            row[state_to_a_idx[state_name]] = E_s[3]\n            \n            A_rows.append(row)\n            b_vals.append(r_ppt)\n\n        A = np.array(A_rows)\n        b = np.array(b_vals)\n        \n        # Solve the least-squares problem Ax = b for x\n        theta, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n        \n        w_mm, w_p_to_m, w_m_to_p = theta[0], theta[1], theta[2]\n        \n        s_mm = classify_sign(w_mm)\n        s_p_to_m = classify_sign(w_p_to_m)\n        s_m_to_p = classify_sign(w_m_to_p)\n        \n        case_result = [w_mm, w_p_to_m, w_m_to_p, s_mm, s_p_to_m, s_m_to_p]\n        results.append(case_result)\n\n    # Format output as a string representation of a list of lists.\n    # str() on a list correctly adds spaces after commas.\n    results_str = ', '.join([str(res) for res in results])\n    print(f\"[{results_str}]\")\n\nsolve()\n\n```", "id": "5036916"}]}