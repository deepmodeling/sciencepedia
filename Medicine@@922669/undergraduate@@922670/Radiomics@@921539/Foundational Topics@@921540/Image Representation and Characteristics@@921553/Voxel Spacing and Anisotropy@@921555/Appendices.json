{"hands_on_practices": [{"introduction": "This first exercise grounds the abstract concept of a voxel grid in physical reality. By converting voxel indices to physical coordinates, you will directly engage with how voxel spacing defines the geometry of an image and gain a tangible understanding of what anisotropy means. This practice is foundational for appreciating how image acquisition parameters translate into the data we analyze. [@problem_id:4569168]", "problem": "A Three-Dimensional (3D) medical image used for radiomics analysis is sampled on a rectilinear voxel grid with axis-aligned spacings. The voxel spacing along the Cartesian axes is $s_x=0.8$ millimeters, $s_y=0.8$ millimeters, and $s_z=3.0$ millimeters. The image origin is the physical coordinate of the center of the voxel at index $(0,0,0)$ and is given by $(o_x,o_y,o_z)=(10,20,30)$ millimeters. Consider the voxel with integer index $(i,j,k)=(100,50,12)$. Using only the fundamental definitions that (i) voxel spacing is the physical distance between centers of adjacent voxels along each axis and (ii) the origin is the physical coordinate of the voxel center at index $(0,0,0)$, derive the mapping from the index $(i,j,k)$ to its physical coordinate $(x,y,z)$ in millimeters, compute this coordinate for the given values, and then compute the Euclidean distance in millimeters from the origin point to this voxelâ€™s center. Round your final distance to four significant figures and express it in millimeters. Finally, explain how the given spacings imply anisotropic sampling and discuss one implication this has for texture-based radiomic features.", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. All necessary information is provided, and the concepts are fundamental to medical image analysis and radiomics.\n\nThe solution proceeds in three parts as requested by the problem:\n1. Derivation and calculation of the physical coordinate and Euclidean distance.\n2. Explanation of sampling anisotropy.\n3. Discussion of the implication for texture-based radiomic features.\n\nFirst, we derive the general mapping from a voxel index $(i,j,k)$ to its physical coordinate $(x,y,z)$. The problem states that the image is sampled on a rectilinear grid. The image origin, $(o_x, o_y, o_z)$, is the physical coordinate of the center of the voxel at index $(0,0,0)$. The voxel spacings, $s_x$, $s_y$, and $s_z$, represent the physical distance between the centers of adjacent voxels along each respective axis.\n\nThe position of the center of the voxel at index $(i,j,k)$ is displaced from the origin voxel at $(0,0,0)$ by $i$ steps along the x-axis, $j$ steps along the y-axis, and $k$ steps along the z-axis. The total physical displacement along each axis is the number of steps multiplied by the spacing for that axis. Therefore, the physical coordinate $(x,y,z)$ of the center of the voxel with index $(i,j,k)$ is given by:\n$$x = o_x + i \\cdot s_x$$\n$$y = o_y + j \\cdot s_y$$\n$$z = o_z + k \\cdot s_z$$\nThis constitutes the general mapping from voxel index to physical coordinates.\n\nNext, we compute the specific physical coordinate for the given voxel index. The provided values are:\n- Voxel index: $(i,j,k) = (100, 50, 12)$\n- Voxel spacing (in mm): $s_x = 0.8$, $s_y = 0.8$, $s_z = 3.0$\n- Image origin (in mm): $(o_x, o_y, o_z) = (10, 20, 30)$\n\nSubstituting these values into the derived mapping:\n$$x = 10 + 100 \\times 0.8 = 10 + 80 = 90 \\text{ mm}$$\n$$y = 20 + 50 \\times 0.8 = 20 + 40 = 60 \\text{ mm}$$\n$$z = 30 + 12 \\times 3.0 = 30 + 36 = 66 \\text{ mm}$$\nThe physical coordinate of the center of the voxel at index $(100,50,12)$ is $(90, 60, 66)$ mm.\n\nNow, we compute the Euclidean distance, $d$, from the image origin point $P_0 = (o_x, o_y, o_z) = (10, 20, 30)$ to the center of this voxel, $P_v = (x, y, z) = (90, 60, 66)$. The formula for Euclidean distance in three dimensions is:\n$$d = \\sqrt{(x - o_x)^2 + (y - o_y)^2 + (z - o_z)^2}$$\nUsing the derived relations $x - o_x = i \\cdot s_x$, $y - o_y = j \\cdot s_y$, and $z - o_z = k \\cdot s_z$, we can also write the distance as:\n$$d = \\sqrt{(i \\cdot s_x)^2 + (j \\cdot s_y)^2 + (k \\cdot s_z)^2}$$\nLet's compute the displacement components:\n$$\\Delta x = x - o_x = 90 - 10 = 80 \\text{ mm}$$\n$$\\Delta y = y - o_y = 60 - 20 = 40 \\text{ mm}$$\n$$\\Delta z = z - o_z = 66 - 30 = 36 \\text{ mm}$$\nSubstituting these displacements into the distance formula:\n$$d = \\sqrt{80^2 + 40^2 + 36^2}$$\n$$d = \\sqrt{6400 + 1600 + 1296}$$\n$$d = \\sqrt{9296}$$\nThe numerical value of the distance is:\n$$d \\approx 96.415766 \\text{ mm}$$\nThe problem requires rounding the final distance to four significant figures. The first four figures are $9$, $6$, $4$, and $1$. The fifth figure is $5$, so we round up the fourth figure.\n$$d \\approx 96.42 \\text{ mm}$$\n\nSecond, we explain why the given spacings imply anisotropic sampling. Anisotropy, in the context of a grid, means that the physical properties are direction-dependent. Isotropic sampling occurs when the distance between sample points is the same in all directions. For a rectilinear voxel grid, this means the spacings must be equal: $s_x = s_y = s_z$. In this case, the voxels are perfect cubes.\nIn this problem, the spacings are given as $s_x = 0.8$ mm, $s_y = 0.8$ mm, and $s_z = 3.0$ mm. Since $s_x = s_y \\neq s_z$, the voxel dimensions are not equal. The resolution is higher in the $xy$-plane (in-plane) than along the $z$-axis (through-plane). The resulting voxels are not cubes but rectangular prisms (cuboids) with dimensions $0.8 \\times 0.8 \\times 3.0$ mm$^3$. This non-uniform spacing is the definition of anisotropic sampling.\n\nThird, we discuss one implication of this anisotropy for texture-based radiomic features. Texture features, a cornerstone of radiomics, aim to capture the spatial distribution and heterogeneity of voxel intensity values. Many algorithms for calculating these features (e.g., Gray-Level Co-occurrence Matrix (GLCM), Gray-Level Run-Length Matrix (GLRLM)) analyze relationships between a voxel and its neighbors. The definition of a \"neighbor\" is based on its position in the discrete voxel grid, typically defined by an integer offset like $(1,0,0)$ or $(0,0,1)$.\nThe key implication of anisotropic sampling is the **loss of rotational invariance and robustness of texture features**. On an anisotropic grid, the physical distance corresponding to a fixed integer offset is not constant. For example, an offset of $(1,0,0)$ corresponds to a physical distance of $s_x = 0.8$ mm, while an offset of $(0,0,1)$ corresponds to a physical distance of $s_z = 3.0$ mm. If a texture feature is calculated by considering nearest neighbors in the grid, it will inadvertently mix information from different physical scales. A feature computed along the $z$-axis probes voxel relationships over a much larger distance ($3.0$ mm) than one computed in the $xy$-plane ($0.8$ mm). This means the feature value will be strongly dependent on the orientation of the object relative to the scanner axes, not just the underlying biological tissue pattern. Two scans of the same tumor, oriented differently, could yield significantly different texture feature values, compromising the feature's reliability for clinical prediction. To address this, a standard preprocessing step in radiomics is to resample the anisotropic image onto an isotropic grid (e.g., to $1 \\times 1 \\times 1$ mm$^3$ voxels) using interpolation, which ensures that texture analysis is performed in a space where neighborhood relationships correspond to uniform physical distances.", "answer": "$$\\boxed{96.42}$$", "id": "4569168"}, {"introduction": "Now that we understand what anisotropy is, let's explore why it poses a significant challenge for radiomics. This practice uses a synthetic image to demonstrate how ignoring non-uniform voxel spacing can lead to a dramatic miscalculation of a fundamental image feature, the gradient magnitude. This exercise highlights the necessity of accounting for physical dimensions in any quantitative analysis to avoid introducing systematic errors. [@problem_id:4569059]", "problem": "A three-dimensional scalar image used in radiomics is defined on continuous spatial coordinates by the synthetic ramp $I(x,y,z) = \\alpha z$, where $\\alpha$ is a constant with units of intensity per millimeter. The image is sampled on a rectilinear grid with anisotropic voxel spacing $(s_x,s_y,s_z) = (1.0,1.0,5.0)$ mm. Consider an interior voxel at index $(i_0,j_0,k_0)$ so that its immediate neighbors along each axis exist.\n\nUsing only the definition of the spatial gradient and the principle that finite differences must be consistent with the physical spacing along each axis, compute the gradient magnitude at $(i_0,j_0,k_0)$ under two scenarios:\n- the correct computation that respects the given spacings $(s_x,s_y,s_z)$, and\n- the incorrect computation that ignores spacing, treating differences as if $(s_x,s_y,s_z) = (1.0,1.0,1.0)$ mm.\n\nLet $|\\nabla I|_{\\text{correct}}$ denote the correctly computed gradient magnitude and $|\\nabla I|_{\\text{ignore}}$ denote the magnitude when spacing is ignored. Report the ratio $r = \\dfrac{|\\nabla I|_{\\text{ignore}}}{|\\nabla I|_{\\text{correct}}}$. Express the final ratio $r$ as a dimensionless pure number. No rounding is required.", "solution": "The problem is deemed valid as it is scientifically grounded, well-posed, objective, self-contained, and an appropriate exercise in understanding the numerical computation of gradients from sampled image data.\n\nThe continuous scalar image is given by the function $I(x,y,z) = \\alpha z$, where $\\alpha$ is a constant. The spatial gradient of this continuous function, $\\nabla I$, is defined as:\n$$ \\nabla I = \\left( \\frac{\\partial I}{\\partial x}, \\frac{\\partial I}{\\partial y}, \\frac{\\partial I}{\\partial z} \\right) $$\nFor the given function, the partial derivatives are $\\frac{\\partial I}{\\partial x} = 0$, $\\frac{\\partial I}{\\partial y} = 0$, and $\\frac{\\partial I}{\\partial z} = \\alpha$. Therefore, the true analytical gradient is the constant vector $(0, 0, \\alpha)$.\n\nThe image is sampled on a rectilinear grid. The physical position $(x_i, y_j, z_k)$ of a voxel at integer index $(i,j,k)$ is related to the voxel spacing $(s_x, s_y, s_z)$ by $x_i = i s_x$, $y_j = j s_y$, and $z_k = k s_z$ (relative to an origin). The value of the sampled image at index $(i,j,k)$ is thus:\n$$ I(i,j,k) = I(x_i, y_j, z_k) = \\alpha z_k = \\alpha (k s_z) $$\nNote that the image intensity depends only on the $k$ index and the physical spacing $s_z$.\n\nThe spatial gradient of the sampled image at an interior voxel $(i_0, j_0, k_0)$ is approximated using the central finite difference method. The general form for the components is:\n$$ (\\nabla I)_x \\approx \\frac{I(i_0+1, j_0, k_0) - I(i_0-1, j_0, k_0)}{2 s_x} $$\n$$ (\\nabla I)_y \\approx \\frac{I(i_0, j_0+1, k_0) - I(i_0, j_0-1, k_0)}{2 s_y} $$\n$$ (\\nabla I)_z \\approx \\frac{I(i_0, j_0, k_0+1) - I(i_0, j_0, k_0-1)}{2 s_z} $$\nThe denominator in each expression represents the physical distance over which the difference is calculated.\n\nFirst, we compute the gradient correctly, respecting the given anisotropic voxel spacing $(s_x, s_y, s_z) = (1.0, 1.0, 5.0)$ mm.\n\nThe x-component of the gradient is:\n$$ (\\nabla I_{\\text{correct}})_x = \\frac{\\alpha (k_0 s_z) - \\alpha (k_0 s_z)}{2 s_x} = 0 $$\nThe y-component of the gradient is:\n$$ (\\nabla I_{\\text{correct}})_y = \\frac{\\alpha (k_0 s_z) - \\alpha (k_0 s_z)}{2 s_y} = 0 $$\nThe z-component of the gradient is:\n$$ (\\nabla I_{\\text{correct}})_z = \\frac{I(i_0, j_0, k_0+1) - I(i_0, j_0, k_0-1)}{2 s_z} = \\frac{\\alpha((k_0+1)s_z) - \\alpha((k_0-1)s_z)}{2 s_z} $$\n$$ (\\nabla I_{\\text{correct}})_z = \\frac{\\alpha s_z (k_0+1 - (k_0-1))}{2 s_z} = \\frac{\\alpha s_z (2)}{2 s_z} = \\alpha $$\nThe correctly computed gradient vector is $\\nabla I_{\\text{correct}} = (0, 0, \\alpha)$. The magnitude is:\n$$ |\\nabla I|_{\\text{correct}} = \\sqrt{0^2 + 0^2 + \\alpha^2} = |\\alpha| $$\nAssuming $\\alpha$ represents a physical quantity that is positive, $|\\nabla I|_{\\text{correct}} = \\alpha$.\n\nNext, we compute the gradient incorrectly, ignoring the true spacing and treating it as if it were isotropic with spacing $(s'_x, s'_y, s'_z) = (1.0, 1.0, 1.0)$ mm. The error lies in using these incorrect spacing values in the denominators of the finite difference formulae. The numerator, which is the difference in sampled image intensity, remains unchanged.\n\nThe x- and y-components are again $0$, as the numerator is $0$:\n$$ (\\nabla I_{\\text{ignore}})_x = 0 $$\n$$ (\\nabla I_{\\text{ignore}})_y = 0 $$\nThe z-component is computed using the incorrect spacing $s'_z = 1.0$ mm in the denominator:\n$$ (\\nabla I_{\\text{ignore}})_z = \\frac{I(i_0, j_0, k_0+1) - I(i_0, j_0, k_0-1)}{2 s'_z} = \\frac{\\alpha s_z (2)}{2 s'_z} = \\alpha \\frac{s_z}{s'_z} $$\nThe incorrectly computed gradient vector is $\\nabla I_{\\text{ignore}} = (0, 0, \\alpha \\frac{s_z}{s'_z})$. The magnitude is:\n$$ |\\nabla I|_{\\text{ignore}} = \\sqrt{0^2 + 0^2 + \\left(\\alpha \\frac{s_z}{s'_z}\\right)^2} = \\left|\\alpha \\frac{s_z}{s'_z}\\right| $$\nAgain, assuming $\\alpha > 0$, and knowing $s_z$ and $s'_z$ are positive, $|\\nabla I|_{\\text{ignore}} = \\alpha \\frac{s_z}{s'_z}$.\n\nFinally, we compute the ratio $r = \\dfrac{|\\nabla I|_{\\text{ignore}}}{|\\nabla I|_{\\text{correct}}}$.\n$$ r = \\frac{\\alpha \\frac{s_z}{s'_z}}{\\alpha} = \\frac{s_z}{s'_z} $$\nThe problem provides the true spacing $s_z = 5.0$ mm and the incorrectly assumed spacing $s'_z = 1.0$ mm.\n$$ r = \\frac{5.0 \\text{ mm}}{1.0 \\text{ mm}} = 5 $$\nThe ratio is a dimensionless pure number, representing the factor by which the gradient magnitude is overestimated when the anisotropy in the z-direction is ignored.", "answer": "$$\\boxed{5}$$", "id": "4569059"}, {"introduction": "The most common strategy to handle anisotropic data and ensure feature stability is to resample the image onto an isotropic grid. This problem guides you through the essential calculations for this process, from determining the new image dimensions to critically justifying the choice of interpolation method. Mastering this procedure is a key practical skill for preparing images for any robust radiomics workflow. [@problem_id:4569066]", "problem": "A three-dimensional Computed Tomography (CT) image has voxel dimensions given by $(N_x, N_y, N_z) = (256, 256, 80)$ and voxel spacing $(s_x, s_y, s_z) = (0.9, 0.9, 5.0)$ in millimeters. In radiomics, features are sensitive to voxel anisotropy, where anisotropy occurs when $s_x \\neq s_y \\neq s_z$. To reduce bias and improve reproducibility, the volume is to be resampled to isotropic target spacing $t = 1.0$ millimeter along all axes. Starting only from the definitions that the physical extent along each axis is $L_i = N_i s_i$ (for $i \\in \\{x,y,z\\}$) and that isotropic resampling at spacing $t$ preserves the physical extent while changing the voxel grid, derive the expression for the new size $(N'_x, N'_y, N'_z)$ in voxels. Compute the numerical values for this image. Do not round; report the exact real-valued voxel counts. Express your final answer as a single row matrix, and do not include units in the final answer. Additionally, justify, based on sampling considerations and radiomics feature stability, an appropriate interpolation method for resampling the intensity image from the given anisotropic spacing to $t = 1.0$ millimeter, noting any different choice that would apply to discrete segmentation masks.", "solution": "The solution is developed in three parts as requested: derivation of the general formula for the new voxel dimensions, computation of the specific numerical values, and justification of interpolation methods.\n\n#### Part 1: Derivation of the New Voxel Grid Dimensions\nThe physical extent, $L_i$, of the image volume along each axis $i \\in \\{x, y, z\\}$ is defined as the product of the number of voxels, $N_i$, and the spacing of those voxels, $s_i$.\n$$L_i = N_i s_i$$\nThe resampling process creates a new image with new voxel dimensions $(N'_x, N'_y, N'_z)$ and a new, isotropic spacing $t$. The physical extent of this new, resampled volume along each axis, $L'_i$, is given by:\n$$L'_i = N'_i t$$\nA core constraint of the resampling process is a preservation of the physical volume's extent. Therefore, for each axis $i$, we must have $L'_i = L_i$.\n$$N'_i t = N_i s_i$$\nTo find the expression for the new number of voxels, $N'_i$, along each axis, we rearrange the equation:\n$$N'_i = \\frac{N_i s_i}{t}$$\nThis is the general expression for the new voxel count along axis $i$.\n\n#### Part 2: Computation of Numerical Values\nWe apply the derived formula using the provided numerical values.\nThe original dimensions are $(N_x, N_y, N_z) = (256, 256, 80)$.\nThe original spacing is $(s_x, s_y, s_z) = (0.9, 0.9, 5.0)$ mm.\nThe target isotropic spacing is $t = 1.0$ mm.\n\nFor the x-axis:\n$$N'_x = \\frac{N_x s_x}{t} = \\frac{256 \\times 0.9}{1.0} = 230.4$$\n\nFor the y-axis:\n$$N'_y = \\frac{N_y s_y}{t} = \\frac{256 \\times 0.9}{1.0} = 230.4$$\n\nFor the z-axis:\n$$N'_z = \\frac{N_z s_z}{t} = \\frac{80 \\times 5.0}{1.0} = 400.0$$\n\nThe problem requests the exact real-valued voxel counts, which represent the dimensions of the target grid onto which the original data will be interpolated. Thus, the new size is $(N'_x, N'_y, N'_z) = (230.4, 230.4, 400.0)$.\n\n#### Part 3: Justification of Interpolation Methods\nThe choice of interpolation method is critical for the validity and reproducibility of radiomic features. The method depends on the nature of the data (continuous intensity vs. discrete labels) and the resampling operation (upsampling vs. downsampling).\n\nIn this problem, the resampling involves downsampling in the $x$ and $y$ dimensions (from a spacing of $0.9$ mm to $1.0$ mm) and significant upsampling in the $z$ dimension (from $5.0$ mm to $1.0$ mm).\n\n**For the Intensity Image:**\nThe intensity image represents a continuously varying physical property (radiodensity). The interpolation method should aim to accurately estimate this underlying continuous signal at the new grid locations.\n-   **Nearest-neighbor interpolation** is unsuitable. It assigns the value of the closest original voxel to the new voxel location, resulting in a blocky, discontinuous output that severely degrades texture-based and higher-order radiomic features.\n-   **Linear interpolation** is an improvement, as it ensures $C^0$ continuity (the function is continuous, but its derivative is not). However, the discontinuities in the gradient can still adversely affect gradient-based and texture features.\n-   **Higher-order interpolation methods**, such as **cubic B-spline interpolation**, are the preferred choice in radiomics. Spline interpolation generates a $C^2$ continuous signal (continuous function, first, and second derivatives), which provides a much smoother and more physically plausible representation of the underlying tissue densities. This smoothness is crucial for the stability and reproducibility of radiomic features, especially texture features that are sensitive to local intensity variations and gradients. For downsampling (in $x,y$), cubic interpolation also has a low-pass filtering effect that helps mitigate aliasing artifacts. For upsampling (in $z$), it generates smooth and realistic intermediate slices. Therefore, **cubic spline interpolation** is the most appropriate method for the intensity image.\n\n**For Discrete Segmentation Masks:**\nA segmentation mask is a label map, where each voxel is assigned a discrete integer value corresponding to a specific class (e.g., $0$ for background, $1$ for tumor). The goal of resampling is to produce a new mask where every voxel retains a valid, discrete label from the original set.\n-   Applying continuous interpolation methods like linear or cubic spline is fundamentally incorrect. These methods would average the integer labels, producing non-integer values (e.g., $0.7$) at the boundaries between two regions. This phenomenon, known as \"label bleeding,\" renders the mask meaningless, as a voxel cannot partially belong to a class.\n-   The correct method is **nearest-neighbor interpolation**. For each location in the new grid, this method assigns the label of the closest voxel from the original grid. This process guarantees that all voxels in the resampled mask have one of the original, valid integer labels. It preserves the crisp boundaries between segmented regions, which is the primary requirement for a segmentation mask. While it may introduce \"stair-step\" artifacts, it correctly maintains the discrete and categorical nature of the data.\n\nIn summary, cubic spline interpolation should be used for the intensity image to preserve signal integrity for radiomics, while nearest-neighbor interpolation must be used for the segmentation mask to preserve discrete labels.", "answer": "$$\n\\boxed{\\begin{pmatrix} 230.4 & 230.4 & 400.0 \\end{pmatrix}}\n$$", "id": "4569066"}]}