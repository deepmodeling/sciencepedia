{"hands_on_practices": [{"introduction": "A core principle of radiomics is the transformation of visual image data into quantitative features that can reveal underlying biology. This practice takes you directly into the engine room of texture analysis, one of the most powerful techniques in the radiomics toolkit. By manually constructing a Gray Level Co-occurrence Matrix (GLCM) from a small image patch, you will demystify how spatial relationships between pixels are captured and quantified [@problem_id:4566408]. Calculating key texture features like entropy and contrast will provide a first-hand understanding of how we translate a qualitative concept like tissue \"heterogeneity\" into an objective, reproducible biomarker.", "problem": "A central goal in radiomics is to define quantitative imaging biomarkers as reproducible, quantitative measurements derived from images. Consider a discrete image patch already quantized into $L=4$ gray levels labeled $0,1,2,3$. The patch is\n$$\n\\begin{pmatrix}\n0 & 1 & 1 & 2 \\\\\n0 & 0 & 1 & 2 \\\\\n3 & 2 & 2 & 1 \\\\\n3 & 3 & 2 & 1\n\\end{pmatrix}.\n$$\nUsing the Gray Level Co-occurrence Matrix (GLCM) concept as a basis for a quantitative imaging biomarker of texture, do the following under these conditions:\n- Use offset distance $d=1$ at angle $0^{\\circ}$ (to the right along rows).\n- Count only pairs for which both pixels lie inside the patch; do not use wrap-around.\n- Construct a single, non-symmetric GLCM $G$ where entry $G(i,j)$ is the count of ordered pairs whose reference pixel has intensity $i$ and its neighbor at the specified offset has intensity $j$.\n- Normalize $G$ by the total number of counted pairs to obtain a probability mass function $P(i,j)$ on the set $\\{0,1,2,3\\} \\times \\{0,1,2,3\\}$.\n\nFrom $P(i,j)$, compute:\n1) the entropy $H=-\\sum_{i=0}^{3}\\sum_{j=0}^{3} P(i,j)\\,\\ln P(i,j)$, where $\\ln$ denotes the natural logarithm and $0\\ln 0$ is taken to be $0$;\n2) the contrast $C=\\sum_{i=0}^{3}\\sum_{j=0}^{3} (i-j)^{2}\\,P(i,j)$.\n\nReport your final answers as a two-entry row vector $(H, C)$, rounded to four significant figures. Both quantities are unitless and must be expressed using the natural logarithm definition given above. Angle is specified in degrees.", "solution": "The problem is valid. It is scientifically grounded in the field of radiomics, well-posed with all necessary data and constraints, and formulated objectively.\n\nThe solution proceeds in three stages:\n1. Construction of the Gray Level Co-occurrence Matrix (GLCM), $G$.\n2. Normalization of $G$ to obtain the probability mass function, $P$.\n3. Computation of the entropy, $H$, and contrast, $C$, from $P$.\n\nThe image patch, $I$, is given as:\n$$\nI = \\begin{pmatrix}\n0 & 1 & 1 & 2 \\\\\n0 & 0 & 1 & 2 \\\\\n3 & 2 & 2 & 1 \\\\\n3 & 3 & 2 & 1\n\\end{pmatrix}\n$$\nThe gray levels range from $i, j \\in \\{0, 1, 2, 3\\}$. The offset is specified by distance $d=1$ and angle $\\theta=0^{\\circ}$, which corresponds to examining the pixel immediately to the right of each reference pixel. We only consider pairs where both pixels are within the patch. For a $4 \\times 4$ patch, this yields $4 \\times (4-1) = 12$ valid pairs.\n\nThe ordered pairs of gray levels $(i,j)$ are extracted by scanning the image patch from left to right, row by row:\nRow 1: $(0, 1), (1, 1), (1, 2)$\nRow 2: $(0, 0), (0, 1), (1, 2)$\nRow 3: $(3, 2), (2, 2), (2, 1)$\nRow 4: $(3, 3), (3, 2), (2, 1)$\n\nNext, we count the occurrences of each unique pair $(i, j)$ to populate the non-symmetric GLCM, $G(i,j)$. The indices $i$ and $j$ correspond to the gray levels $\\{0, 1, 2, 3\\}$.\n- $G(0,0)$: one occurrence.\n- $G(0,1)$: two occurrences.\n- $G(1,1)$: one occurrence.\n- $G(1,2)$: two occurrences.\n- $G(2,1)$: two occurrences.\n- $G(2,2)$: one occurrence.\n- $G(3,2)$: two occurrences.\n- $G(3,3)$: one occurrence.\nAll other entries $G(i,j)$ are zero. The resulting GLCM, $G$, is:\n$$\nG = \\begin{pmatrix}\n1 & 2 & 0 & 0 \\\\\n0 & 1 & 2 & 0 \\\\\n0 & 2 & 1 & 0 \\\\\n0 & 0 & 2 & 1\n\\end{pmatrix}\n$$\nThe sum of all entries in $G$ is $\\sum_{i,j} G(i,j) = 1+2+1+2+2+1+2+1=12$, which matches the total number of counted pairs, $N=12$.\n\nTo obtain the probability mass function $P(i,j)$, we normalize $G$ by the total number of pairs, $N=12$.\n$$\nP(i,j) = \\frac{G(i,j)}{N} = \\frac{G(i,j)}{12}\n$$\n$$\nP = \\frac{1}{12} \\begin{pmatrix}\n1 & 2 & 0 & 0 \\\\\n0 & 1 & 2 & 0 \\\\\n0 & 2 & 1 & 0 \\\\\n0 & 0 & 2 & 1\n\\end{pmatrix} = \\begin{pmatrix}\n1/12 & 2/12 & 0 & 0 \\\\\n0 & 1/12 & 2/12 & 0 \\\\\n0 & 2/12 & 1/12 & 0 \\\\\n0 & 0 & 2/12 & 1/12\n\\end{pmatrix} = \\begin{pmatrix}\n1/12 & 1/6 & 0 & 0 \\\\\n0 & 1/12 & 1/6 & 0 \\\\\n0 & 1/6 & 1/12 & 0 \\\\\n0 & 0 & 1/6 & 1/12\n\\end{pmatrix}\n$$\nThe non-zero probabilities are $P(i,j) \\in \\{1/12, 1/6\\}$. There are $4$ entries with probability $1/12$ and $4$ entries with probability $1/6$.\n\nNow, we compute the entropy $H$ using the formula $H=-\\sum_{i=0}^{3}\\sum_{j=0}^{3} P(i,j)\\,\\ln P(i,j)$, with the convention $0\\ln 0 = 0$.\n$$\nH = - \\left( 4 \\cdot \\frac{1}{12} \\ln\\left(\\frac{1}{12}\\right) + 4 \\cdot \\frac{1}{6} \\ln\\left(\\frac{1}{6}\\right) \\right)\n$$\n$$\nH = - \\left( \\frac{1}{3} (-\\ln 12) + \\frac{2}{3} (-\\ln 6) \\right) = \\frac{1}{3}\\ln 12 + \\frac{2}{3}\\ln 6\n$$\nUsing logarithm properties, $\\ln(ab) = \\ln a + \\ln b$ and $\\ln(a^k) = k \\ln a$:\n$ \\ln 12 = \\ln(2^2 \\cdot 3) = 2\\ln 2 + \\ln 3 $\n$ \\ln 6 = \\ln(2 \\cdot 3) = \\ln 2 + \\ln 3 $\nSubstituting these into the expression for $H$:\n$$\nH = \\frac{1}{3}(2\\ln 2 + \\ln 3) + \\frac{2}{3}(\\ln 2 + \\ln 3) = \\frac{2}{3}\\ln 2 + \\frac{1}{3}\\ln 3 + \\frac{2}{3}\\ln 2 + \\frac{2}{3}\\ln 3 = \\frac{4}{3}\\ln 2 + \\ln 3\n$$\nNumerically, using $\\ln 2 \\approx 0.693147$ and $\\ln 3 \\approx 1.098612$:\n$$\nH \\approx \\frac{4}{3}(0.693147) + 1.098612 \\approx 0.924196 + 1.098612 = 2.022808\n$$\nRounding to four significant figures, $H \\approx 2.023$.\n\nNext, we compute the contrast $C$ using the formula $C=\\sum_{i=0}^{3}\\sum_{j=0}^{3} (i-j)^{2}\\,P(i,j)$.\nThe summation is performed over all non-zero entries of $P$:\n$$\nC = (0-0)^2 P(0,0) + (0-1)^2 P(0,1) + (1-1)^2 P(1,1) + (1-2)^2 P(1,2) + (2-1)^2 P(2,1) + (2-2)^2 P(2,2) + (3-2)^2 P(3,2) + (3-3)^2 P(3,3)\n$$\nAll diagonal terms $(i=j)$ contribute $0$ to the sum. The non-zero, non-diagonal terms all have $|i-j|=1$, so $(i-j)^2 = 1$.\n$$\nC = 1 \\cdot P(0,1) + 1 \\cdot P(1,2) + 1 \\cdot P(2,1) + 1 \\cdot P(3,2)\n$$\n$$\nC = \\frac{2}{12} + \\frac{2}{12} + \\frac{2}{12} + \\frac{2}{12} = \\frac{8}{12} = \\frac{2}{3}\n$$\nNumerically, $C = 2/3 \\approx 0.666666\\dots$.\nRounding to four significant figures, $C \\approx 0.6667$.\n\nThe final result is the two-entry row vector $(H, C)$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.023 & 0.6667\n\\end{pmatrix}\n}\n$$", "id": "4566408"}, {"introduction": "For a quantitative imaging biomarker to be clinically useful, it must be robust and reproducible, meaning its value should not drastically change due to minor technical variations. This exercise addresses one of the most common sources of variability: the delineation of the region of interest (ROI) by different observers. You will use standard metrics like the Dice Similarity Coefficient and Hausdorff distance to quantify segmentation agreement and then investigate how this agreement impacts the stability of a radiomic feature [@problem_id:4566416]. This practice provides a crucial lesson in biomarker validation, teaching you how to test whether a feature is a reliable measure of biology or merely an artifact of segmentation inconsistency.", "problem": "A key requirement for a quantitative imaging biomarker is that its value be robust to reasonable variations in image segmentation across observers. Consider three independent imaging cases, each segmented by two observers (Observer A and Observer B). You will evaluate segmentation agreement using the standard set overlap coefficient known as the Dice Similarity Coefficient (DSC) and the boundary disagreement using the empirical ninety-fifth percentile Hausdorff distance (HD95). You will then relate these to the variability of a candidate radiomic texture feature, the first-order intensity variance computed with the population formula. Assume voxel spacing is isotropic with unit edge length so that Euclidean distances between boundary points are measured in voxel units.\n\nFor each case, you are given:\n- Case-level set sizes and overlaps: for case $1$, $|A|=50$, $|B|=48$, and $|A \\cap B|=44$; for case $2$, $|A|=60$, $|B|=42$, and $|A \\cap B|=30$; for case $3$, $|A|=55$, $|B|=55$, and $|A \\cap B|=50$.\n- The union of directed shortest boundary-to-surface distances used for the Hausdorff calculation (that is, distances from the boundary of one segmentation to the other segmentation, computed in both directions, pooled together). For case $1$, there are $N=40$ distances: $30$ equal to $0$, $8$ equal to $1$, and $2$ equal to $2$. For case $2$, there are $N=40$ distances: $10$ equal to $0$, $10$ equal to $1$, $10$ equal to $2$, and $10$ equal to $3$. For case $3$, there are $N=40$ distances: $34$ equal to $0$ and $6$ equal to $1$. Define the empirical $95$th percentile as the element at rank $k=\\lceil 0.95\\,N\\rceil$ in the nondecreasingly sorted list of these distances.\n- The precomputed first-order intensity variance values within each observer’s segmentation (population variance): for case $1$, $\\mathrm{Var}_{A}=22$, $\\mathrm{Var}_{B}=26$; for case $2$, $\\mathrm{Var}_{A}=49$, $\\mathrm{Var}_{B}=31$; for case $3$, $\\mathrm{Var}_{A}=15$, $\\mathrm{Var}_{B}=16$.\n\nTasks:\n1. For each case $i \\in \\{1,2,3\\}$, compute the Dice Similarity Coefficient (DSC) from the provided set sizes and overlap, and compute the HD95 from the provided pooled distance multiset using the rank definition $k=\\lceil 0.95\\,N\\rceil$.\n2. For each case $i$, compute the absolute difference in the first-order variance between observers, $\\Delta \\mathrm{Var}_{i}=|\\mathrm{Var}_{A,i}-\\mathrm{Var}_{B,i}|$.\n3. Let $\\mathbf{d}$ be the vector of the three DSC values, $\\mathbf{h}$ be the vector of the three HD95 values, and $\\mathbf{v}$ be the vector of the three $\\Delta \\mathrm{Var}$ values. Compute the Pearson linear correlation coefficient between $\\mathbf{d}$ and $\\mathbf{v}$, and independently between $\\mathbf{h}$ and $\\mathbf{v}$. Finally, compute the difference between these two correlation coefficients.\n\nReport the single final value of the difference between the two correlation coefficients as a dimensionless number, rounded to $4$ significant figures.", "solution": "The problem statement has been critically validated and is deemed valid. It is scientifically grounded in the field of radiomics, well-posed with all necessary data and definitions, and objective in its formulation. The task is a direct application of standard statistical and set-theoretic methods to evaluate the robustness of a candidate imaging biomarker, a core concept in quantitative medical imaging. We may therefore proceed with the solution.\n\nThe problem requires a three-part calculation to assess the relationship between segmentation variability and the stability of a radiomic feature. First, we compute metrics of segmentation agreement and disagreement for three cases. Second, we compute the inter-observer variability of a radiomic feature for each case. Third, we correlate these metrics to quantify their relationship.\n\nThe definitions for the metrics are as follows:\nThe Dice Similarity Coefficient (DSC) for two sets $A$ and $B$ is given by:\n$$ \\mathrm{DSC} = \\frac{2 |A \\cap B|}{|A| + |B|} $$\nThe empirical $95$th percentile Hausdorff distance (HD95) is defined as the element at rank $k=\\lceil 0.95\\,N\\rceil$ in the nondecreasingly sorted list of $N$ boundary-to-surface distances.\nThe absolute difference in the first-order variance for case $i$ is:\n$$ \\Delta \\mathrm{Var}_{i} = |\\mathrm{Var}_{A,i} - \\mathrm{Var}_{B,i}| $$\nThe Pearson linear correlation coefficient $r$ between two vectors of observations $\\mathbf{x}=(x_1, x_2, \\dots, x_n)$ and $\\mathbf{y}=(y_1, y_2, \\dots, y_n)$ is:\n$$ r(\\mathbf{x}, \\mathbf{y}) = \\frac{\\sum_{i=1}^{n} (x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum_{i=1}^{n} (x_i - \\bar{x})^2 \\sum_{i=1}^{n} (y_i - \\bar{y})^2}} $$\nwhere $\\bar{x}$ and $\\bar{y}$ are the sample means of $\\mathbf{x}$ and $\\mathbf{y}$, respectively.\n\n**Task 1: Compute DSC and HD95 for each case**\n\nFor all cases, the number of pooled boundary distances is $N=40$. The rank for the $95$th percentile is thus $k = \\lceil 0.95 \\times 40 \\rceil = \\lceil 38 \\rceil = 38$. We must find the $38$th value in the sorted list of distances for each case.\n\n**Case 1:**\n- Given: $|A_1|=50$, $|B_1|=48$, $|A_1 \\cap B_1|=44$.\n- $\\mathrm{DSC}_1 = \\frac{2 \\times 44}{50 + 48} = \\frac{88}{98} = \\frac{44}{49}$.\n- The sorted distance multiset has $30$ values of $0$, $8$ values of $1$, and $2$ values of $2$. The element at rank $38$ (the last of the $1$s) is $1$.\n- Thus, $\\mathrm{HD95}_1 = 1$.\n\n**Case 2:**\n- Given: $|A_2|=60$, $|B_2|=42$, $|A_2 \\cap B_2|=30$.\n- $\\mathrm{DSC}_2 = \\frac{2 \\times 30}{60 + 42} = \\frac{60}{102} = \\frac{10}{17}$.\n- The sorted distance multiset has $10$ values of $0$, $10$ of $1$, $10$ of $2$, and $10$ of $3$. The elements from rank $31$ to $40$ are all $3$. The element at rank $38$ is $3$.\n- Thus, $\\mathrm{HD95}_2 = 3$.\n\n**Case 3:**\n- Given: $|A_3|=55$, $|B_3|=55$, $|A_3 \\cap B_3|=50$.\n- $\\mathrm{DSC}_3 = \\frac{2 \\times 50}{55 + 55} = \\frac{100}{110} = \\frac{10}{11}$.\n- The sorted distance multiset has $34$ values of $0$ and $6$ values of $1$. The elements from rank $35$ to $40$ are all $1$. The element at rank $38$ is $1$.\n- Thus, $\\mathrm{HD95}_3 = 1$.\n\n**Task 2: Compute $\\Delta \\mathrm{Var}$ for each case**\n\n**Case 1:**\n- Given: $\\mathrm{Var}_{A,1}=22$, $\\mathrm{Var}_{B,1}=26$.\n- $\\Delta \\mathrm{Var}_1 = |22 - 26| = 4$.\n\n**Case 2:**\n- Given: $\\mathrm{Var}_{A,2}=49$, $\\mathrm{Var}_{B,2}=31$.\n- $\\Delta \\mathrm{Var}_2 = |49 - 31| = 18$.\n\n**Case 3:**\n- Given: $\\mathrm{Var}_{A,3}=15$, $\\mathrm{Var}_{B,3}=16$.\n- $\\Delta \\mathrm{Var}_3 = |15 - 16| = 1$.\n\n**Task 3: Compute correlations and their difference**\n\nWe assemble the three vectors of calculated values:\n- DSC values: $\\mathbf{d} = (\\frac{44}{49}, \\frac{10}{17}, \\frac{10}{11})$\n- HD95 values: $\\mathbf{h} = (1, 3, 1)$\n- $\\Delta \\mathrm{Var}$ values: $\\mathbf{v} = (4, 18, 1)$\n\nFirst, we compute the Pearson correlation coefficient $r(\\mathbf{d}, \\mathbf{v})$.\nThe means are:\n$\\bar{d} = \\frac{1}{3}(\\frac{44}{49} + \\frac{10}{17} + \\frac{10}{11}) = \\frac{7316}{9163}$\n$\\bar{v} = \\frac{1}{3}(4 + 18 + 1) = \\frac{23}{3}$\nThe sum of products of deviations (covariance term) is:\n$\\sum (d_i - \\bar{d})(v_i - \\bar{v}) = (\\frac{44}{49}-\\frac{7316}{9163})(4-\\frac{23}{3}) + (\\frac{10}{17}-\\frac{7316}{9163})(18-\\frac{23}{3}) + (\\frac{10}{11}-\\frac{7316}{9163})(1-\\frac{23}{3})$\n$= (\\frac{912}{9163})(-\\frac{11}{3}) + (\\frac{-1926}{9163})(\\frac{31}{3}) + (\\frac{1014}{9163})(-\\frac{20}{3})$\n$= \\frac{-10032 - 59706 - 20280}{27489} = \\frac{-90018}{27489} \\approx -3.274655$\nThe sums of squared deviations are:\n$\\sum (d_i - \\bar{d})^2 = (\\frac{912}{9163})^2 + (\\frac{-1926}{9163})^2 + (\\frac{1014}{9163})^2 = \\frac{5569416}{9163^2} \\approx 0.066336$\n$\\sum (v_i - \\bar{v})^2 = (4-\\frac{23}{3})^2 + (18-\\frac{23}{3})^2 + (1-\\frac{23}{3})^2 = (-\\frac{11}{3})^2 + (\\frac{31}{3})^2 + (-\\frac{20}{3})^2 = \\frac{121+961+400}{9} = \\frac{1482}{9} = \\frac{494}{3}$\n$r(\\mathbf{d}, \\mathbf{v}) = \\frac{-90018/27489}{\\sqrt{(\\frac{5569416}{9163^2})(\\frac{494}{3})}} \\approx \\frac{-3.274655}{\\sqrt{0.066336 \\times 164.666...}} \\approx \\frac{-3.274655}{\\sqrt{10.9234}} \\approx -0.99080$\n\nNext, we compute the Pearson correlation coefficient $r(\\mathbf{h}, \\mathbf{v})$.\nThe means are:\n$\\bar{h} = \\frac{1}{3}(1 + 3 + 1) = \\frac{5}{3}$\n$\\bar{v} = \\frac{23}{3}$ (as before)\nThe covariance term is:\n$\\sum (h_i - \\bar{h})(v_i - \\bar{v}) = (1-\\frac{5}{3})(4-\\frac{23}{3}) + (3-\\frac{5}{3})(18-\\frac{23}{3}) + (1-\\frac{5}{3})(1-\\frac{23}{3})$\n$= (-\\frac{2}{3})(-\\frac{11}{3}) + (\\frac{4}{3})(\\frac{31}{3}) + (-\\frac{2}{3})(-\\frac{20}{3})$\n$= \\frac{22 + 124 + 40}{9} = \\frac{186}{9} = \\frac{62}{3}$\nThe sum of squared deviations for $\\mathbf{h}$ is:\n$\\sum (h_i - \\bar{h})^2 = (-\\frac{2}{3})^2 + (\\frac{4}{3})^2 + (-\\frac{2}{3})^2 = \\frac{4+16+4}{9} = \\frac{24}{9} = \\frac{8}{3}$\n$r(\\mathbf{h}, \\mathbf{v}) = \\frac{62/3}{\\sqrt{(8/3)(494/3)}} = \\frac{62/3}{\\sqrt{3952/9}} = \\frac{62/3}{\\sqrt{3952}/3} = \\frac{62}{\\sqrt{3952}} \\approx \\frac{62}{62.8649} \\approx 0.98624$\n\nFinally, we compute the difference between the two correlation coefficients.\nDifference $= r(\\mathbf{d}, \\mathbf{v}) - r(\\mathbf{h}, \\mathbf{v}) \\approx -0.99080 - 0.98624 = -1.97704$\nRounding to $4$ significant figures, the result is $-1.977$.\nThe strong negative correlation between DSC and $\\Delta\\mathrm{Var}$ indicates that better volumetric overlap corresponds to lower feature variability. The strong positive correlation between HD95 and $\\Delta\\mathrm{Var}$ indicates that larger boundary discrepancies correspond to higher feature variability. Both findings are consistent with the properties of a robust biomarker. The requested difference is the final result.", "answer": "$$\\boxed{-1.977}$$", "id": "4566416"}, {"introduction": "Once a biomarker is shown to be robustly measurable, the final and most important test is to evaluate its clinical performance; for example, can it accurately distinguish between different biological states? This exercise guides you through Receiver Operating Characteristic (ROC) analysis, the standard method for assessing the discriminatory power of a biomarker [@problem_id:4566373]. By implementing the calculation of the Area Under the Curve (AUC) and its confidence interval, you will gain hands-on experience in quantifying a biomarker's diagnostic accuracy and making a data-driven judgment about its potential clinical relevance.", "problem": "You are given several binary classification datasets in which a single quantitative imaging biomarker (QIB) produces a continuous score for each subject and the reference standard provides a binary outcome label for disease presence. From first principles, the Receiver Operating Characteristic (ROC) is defined by the set of attainable pairs of the true positive rate and false positive rate. For any decision threshold $t$ applied to the QIB score $s$, the true positive rate is $\\mathrm{TPR}(t) = \\dfrac{\\mathrm{TP}(t)}{P}$ and the false positive rate is $\\mathrm{FPR}(t) = \\dfrac{\\mathrm{FP}(t)}{N}$, where $P$ is the number of positive cases, $N$ is the number of negative cases, $\\mathrm{TP}(t)$ is the number of positives with $s \\ge t$, and $\\mathrm{FP}(t)$ is the number of negatives with $s \\ge t$. The Area Under the Curve (AUC) is the probability that a randomly drawn positive example will have a strictly higher QIB score than a randomly drawn negative example, with ties counting as half. Equivalently, if $X$ denotes the set of QIB scores for positives and $Y$ denotes the set for negatives, then the AUC is the U-statistic\n$$\n\\widehat{A} = \\frac{1}{|X|\\,|Y|} \\sum_{x \\in X} \\sum_{y \\in Y} \\phi(x,y),\n$$\nwhere\n$$\n\\phi(x,y) = \\begin{cases}\n1 & \\text{if } x > y,\\\\\n0.5 & \\text{if } x = y,\\\\\n0 & \\text{if } x < y.\n\\end{cases}\n$$\nTo quantify uncertainty, use DeLong’s method for a single AUC to compute a two-sided confidence interval at confidence level $0.95$ based on the asymptotic variance of the AUC U-statistic. Interpret the clinical relevance of the QIB as follows: a QIB is deemed clinically relevant for decision support if the lower bound of the $0.95$ confidence interval for the AUC is at least $0.7$.\n\nStarting from the definitions above, implement a program that:\n- Computes the ROC curve points from the definitions of $\\mathrm{TPR}(t)$ and $\\mathrm{FPR}(t)$ for a single QIB and binary labels (you do not need to print these points).\n- Computes the AUC using the U-statistic definition above.\n- Computes a two-sided $0.95$ confidence interval for the AUC using DeLong’s method.\n- Applies the clinical relevance rule: report whether the lower bound of the confidence interval is at least $0.7$.\n\nUse the following test suite of datasets. Each test case is a pair $(\\boldsymbol{y}, \\boldsymbol{s})$ where $\\boldsymbol{y}$ is the list of labels with $1$ indicating disease present and $0$ indicating disease absent, and $\\boldsymbol{s}$ is the corresponding list of QIB scores:\n- Test case $1$ (perfect separation, balanced):\n  - $\\boldsymbol{y} = [1,1,1,1,1,0,0,0,0,0]$\n  - $\\boldsymbol{s} = [0.80,0.90,0.77,0.95,0.88,0.40,0.55,0.60,0.30,0.50]$\n- Test case $2$ (near decision threshold performance, balanced with overlap):\n  - $\\boldsymbol{y} = [1,1,1,1,0,0,0,0]$\n  - $\\boldsymbol{s} = [0.72,0.67,0.63,0.60,0.66,0.64,0.61,0.59]$\n- Test case $3$ (complete ties across classes, balanced):\n  - $\\boldsymbol{y} = [1,1,1,0,0,0]$\n  - $\\boldsymbol{s} = [0.50,0.50,0.50,0.50,0.50,0.50]$\n- Test case $4$ (imbalanced with ties and overlap):\n  - $\\boldsymbol{y} = [1,1,1,0,0,0,0,0]$\n  - $\\boldsymbol{s} = [0.70,0.73,0.69,0.68,0.70,0.71,0.65,0.60]$\n- Test case $5$ (larger sample with slight overlap):\n  - $\\boldsymbol{y} = [1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]$\n  - $\\boldsymbol{s} = [0.82,0.78,0.80,0.85,0.76,0.83,0.79,0.81,0.66,0.77,0.58,0.62,0.60,0.65,0.64,0.59,0.57,0.63,0.61,0.67]$\n\nProgram output specification:\n- For each test case, produce a list $[\\widehat{A}, L, U, C]$ where $\\widehat{A}$ is the AUC, $L$ is the lower bound, $U$ is the upper bound of the two-sided $0.95$ confidence interval computed by DeLong’s method, and $C$ is a boolean indicating clinical relevance according to the rule above.\n- Express $\\widehat{A}$, $L$, and $U$ as decimal numbers rounded to $6$ decimal places. The boolean $C$ must be either True or False.\n- The program should produce a single line of output containing the results as a comma-separated list of these per-test-case lists, enclosed in square brackets. For example, the required format is $[[r_1],[r_2],[r_3],[r_4],[r_5]]$ where each $r_i$ is a list of the four values for test case $i$ in the order specified.", "solution": "The problem as stated is subjected to rigorous validation.\n\n### Step 1: Extract Givens\nThe problem provides the following definitions, data, and constraints:\n- **Reference Standard**: Binary outcome labels $\\boldsymbol{y}$, where $1$ indicates disease presence and $0$ indicates disease absence.\n- **Quantitative Imaging Biomarker (QIB)**: A continuous score $\\boldsymbol{s}$ for each subject.\n- **Positive & Negative Cases**: Let $P$ be the number of positive cases (disease present, label $1$) and $N$ be the number of negative cases (disease absent, label $0$).\n- **Decision Threshold**: A value $t$ applied to the QIB score $s$.\n- **True Positives & False Positives**: $\\mathrm{TP}(t)$ is the number of positive cases with $s \\ge t$. $\\mathrm{FP}(t)$ is the number of negative cases with $s \\ge t$.\n- **True Positive Rate (TPR)**: $\\mathrm{TPR}(t) = \\dfrac{\\mathrm{TP}(t)}{P}$.\n- **False Positive Rate (FPR)**: $\\mathrm{FPR}(t) = \\dfrac{\\mathrm{FP}(t)}{N}$.\n- **Area Under the Curve (AUC)**: The AUC is defined as a U-statistic, denoted $\\widehat{A}$.\n- **Score Sets**: Let $X$ be the set of QIB scores for positive cases, so $|X|=P$. Let $Y$ be the set of QIB scores for negative cases, so $|Y|=N$.\n- **AUC Formula**: $\\widehat{A} = \\frac{1}{|X|\\,|Y|} \\sum_{x \\in X} \\sum_{y \\in Y} \\phi(x,y)$.\n- **Kernel Function**: $\\phi(x,y) = \\begin{cases} 1 & \\text{if } x > y,\\\\ 0.5 & \\text{if } x = y,\\\\ 0 & \\text{if } x < y. \\end{cases}$\n- **Confidence Interval**: A two-sided confidence interval for the AUC is to be computed at a confidence level of $0.95$ using DeLong’s method.\n- **Clinical Relevance Rule**: A QIB is deemed clinically relevant if the lower bound of its $0.95$ confidence interval for the AUC is at least $0.7$.\n- **Test Cases**: Five datasets are provided, each as a pair of lists $(\\boldsymbol{y}, \\boldsymbol{s})$.\n  1. $\\boldsymbol{y} = [1,1,1,1,1,0,0,0,0,0]$, $\\boldsymbol{s} = [0.80,0.90,0.77,0.95,0.88,0.40,0.55,0.60,0.30,0.50]$\n  2. $\\boldsymbol{y} = [1,1,1,1,0,0,0,0]$, $\\boldsymbol{s} = [0.72,0.67,0.63,0.60,0.66,0.64,0.61,0.59]$\n  3. $\\boldsymbol{y} = [1,1,1,0,0,0]$, $\\boldsymbol{s} = [0.50,0.50,0.50,0.50,0.50,0.50]$\n  4. $\\boldsymbol{y} = [1,1,1,0,0,0,0,0]$, $\\boldsymbol{s} = [0.70,0.73,0.69,0.68,0.70,0.71,0.65,0.60]$\n  5. $\\boldsymbol{y} = [1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]$, $\\boldsymbol{s} = [0.82,0.78,0.80,0.85,0.76,0.83,0.79,0.81,0.66,0.77,0.58,0.62,0.60,0.65,0.64,0.59,0.57,0.63,0.61,0.67]$\n- **Output Format**: For each case, a list $[\\widehat{A}, L, U, C]$, where $\\widehat{A}$ is AUC, $L$ is a lower bound, $U$ is an upper bound, and $C$ is a boolean for relevance. $\\widehat{A}$, $L$, and $U$ rounded to $6$ decimal places.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the validation criteria:\n- **Scientifically Grounded**: The problem presents a standard task in biomarker validation. The concepts of ROC analysis, AUC, U-statistics, and DeLong's method for variance estimation are all fundamental, well-established principles in biostatistics. The problem is scientifically and mathematically sound.\n- **Well-Posed**: The problem is well-posed. All necessary inputs (datasets) and definitions (formulas for AUC and the CI method) are explicitly provided. The task is to apply these definitions to the data, which leads to a unique, stable, and meaningful solution for each test case.\n- **Objective**: The problem is stated with complete objectivity using precise mathematical terminology. The rule for \"clinical relevance\" is defined by a clear, quantitative threshold ($L \\ge 0.7$), leaving no room for subjective interpretation.\n- **Flaw Analysis**:\n  1. No scientific or factual unsoundness is detected.\n  2. The problem is a formalizable and highly relevant application of statistical theory.\n  3. The problem is self-contained and internally consistent.\n  4. The datasets, while small, represent plausible scenarios and are not unrealistic or infeasible.\n  5. The terminology is unambiguous, and the problem structure is clear.\n  6. The problem is not trivial. The implementation of DeLong's method, in particular, requires careful attention to the underlying U-statistic theory and is a substantive task.\n  7. The results are scientifically verifiable through independent calculation.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A principled solution will now be developed.\n\n### Solution\n\nThe task is to compute the Area Under the ROC Curve (AUC), its $0.95$ confidence interval using DeLong's method, and determine clinical relevance for several datasets. We proceed by implementing the specified statistical methods from first principles.\n\nLet the set of scores for the $m$ positive cases be $X = \\{x_1, x_2, \\dots, x_m\\}$ and for the $n$ negative cases be $Y = \\{y_1, y_2, \\dots, y_n\\}$.\n\n**1. AUC Calculation**\nThe problem defines the AUC estimate, $\\widehat{A}$, as the U-statistic representing the probability that a randomly drawn positive case has a higher score than a randomly drawn negative case. The calculation is performed directly from the provided formula:\n$$\n\\widehat{A} = \\frac{1}{mn} \\sum_{i=1}^{m} \\sum_{j=1}^{n} \\phi(x_i, y_j)\n$$\nwhere the kernel $\\phi(x,y)$ handles comparisons, giving $1$ for $x>y$, $0.5$ for $x=y$, and $0$ for $x<y$. This formulation is equivalent to the Wilcoxon-Mann-Whitney U-statistic and avoids the need to explicitly construct the ROC curve.\n\n**2. Confidence Interval via DeLong’s Method**\nDeLong’s method provides a non-parametric approach to estimate the variance of the AUC, leveraging the theory of U-statistics. The confidence interval is then constructed assuming the asymptotic normality of the AUC estimator.\n\nFirst, we define two sets of structural components. For each positive score $x_i$, we compute its average comparison against all negative scores:\n$$\nV_{10}(x_i) = \\frac{1}{n} \\sum_{j=1}^{n} \\phi(x_i, y_j)\n$$\nAnd for each negative score $y_j$, we compute its average comparison against all positive scores:\n$$\nV_{01}(y_j) = \\frac{1}{m} \\sum_{i=1}^{m} \\phi(x_i, y_j)\n$$\nIt is a property of these components that the AUC is the mean of either set: $\\widehat{A} = \\frac{1}{m} \\sum_{i=1}^{m} V_{10}(x_i) = \\frac{1}{n} \\sum_{j=1}^{n} V_{01}(y_j)$.\n\nThe sample variances of these structural components are then calculated. For the positive group:\n$$\nS_{10} = \\frac{1}{m-1} \\sum_{i=1}^{m} (V_{10}(x_i) - \\widehat{A})^2\n$$\nAnd for the negative group:\n$$\nS_{01} = \\frac{1}{n-1} \\sum_{j=1}^{n} (V_{01}(y_j) - \\widehat{A})^2\n$$\nThe variance of the AUC estimator, $\\widehat{\\mathrm{Var}}(\\widehat{A})$, is given by the sum of the scaled component variances:\n$$\n\\widehat{\\mathrm{Var}}(\\widehat{A}) = \\frac{S_{10}}{m} + \\frac{S_{01}}{n}\n$$\nThe standard error (SE) is the square root of this variance:\n$$\n\\mathrm{SE}(\\widehat{A}) = \\sqrt{\\widehat{\\mathrm{Var}}(\\widehat{A})}\n$$\nFinally, a two-sided $100(1-\\alpha)\\%$ confidence interval is constructed as $\\widehat{A} \\pm z_{1-\\alpha/2} \\cdot \\mathrm{SE}(\\widehat{A})$. For a $0.95$ confidence level, $\\alpha = 0.05$, and the critical value from the standard normal distribution is $z_{0.975} \\approx 1.95996$.\n\nThe lower bound ($L$) and upper bound ($U$) of the confidence interval are:\n$$\nL = \\widehat{A} - z_{0.975} \\cdot \\mathrm{SE}(\\widehat{A})\n$$\n$$\nU = \\widehat{A} + z_{0.975} \\cdot \\mathrm{SE}(\\widehat{A})\n$$\nIn cases of perfect separation $(\\widehat{A}=1)$ or complete non-discrimination $(\\widehat{A}=0.5 \\text{ due to ties})$, all $V_{10}(x_i)$ values will be identical, and all $V_{01}(y_j)$ values will be identical. This leads to $S_{10} = 0$ and $S_{01} = 0$, resulting in a variance of $0$ and a confidence interval of zero width, i.e., $[L, U] = [\\widehat{A}, \\widehat{A}]$. This is a correct outcome of the methodology.\n\n**3. Clinical Relevance Assessment**\nThe clinical relevance, $C$, is determined by the simple rule:\n$$\nC = (L \\ge 0.7)\n$$\nwhere $L$ is the lower bound of the $0.95$ confidence interval. This boolean value will be reported for each test case.\n\nThe implementation will process each test case by first separating scores into positive and negative groups, then computing $\\widehat{A}$ and the structural components $V_{10}$ and $V_{01}$, followed by the variances $S_{10}$ and $S_{01}$, the total variance $\\widehat{\\mathrm{Var}}(\\widehat{A})$, the confidence interval $[L, U]$, and finally the relevance metric $C$. The numerical results $\\widehat{A}$, $L$, and $U$ will be rounded to $6$ decimal places as required.", "answer": "[[1.000000, 1.000000, 1.000000, True], [0.687500, 0.251527, 1.000000, False], [0.500000, 0.500000, 0.500000, False], [0.733333, 0.271336, 1.000000, False], [0.975000, 0.900863, 1.000000, True]]", "id": "4566373"}]}