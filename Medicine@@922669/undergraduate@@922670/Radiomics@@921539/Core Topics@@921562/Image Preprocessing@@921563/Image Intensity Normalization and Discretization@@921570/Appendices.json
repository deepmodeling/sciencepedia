{"hands_on_practices": [{"introduction": "Real-world medical images often contain a wide range of intensity values, not all of which are relevant for a specific analysis. This exercise demonstrates a crucial and practical two-step workflow for handling such data. You will first perform intensity clipping to isolate a specific range of interest, such as soft tissues in a CT scan, and then apply min-max normalization to standardize these values. This practice [@problem_id:4545736] is essential for understanding how to focus your analysis and prepare data for stable feature extraction.", "problem": "In a radiomics workflow, pre-processing commonly includes intensity clipping followed by linear normalization to a standard range to reduce inter-scan variability and improve feature stability. Consider Computed Tomography (CT) voxel intensities measured in Hounsfield units (HU) from a small region of interest: $\\{-100, 0, 50, 1000, 120\\}$. Assume that, for soft-tissue analysis, intensities are clipped to the range $[0, 200]$ HU to remove out-of-range values, and then linearly normalized to the interval $[0, 1]$ using the minimum and maximum of the clipped values. Perform this two-step pre-processing (first clipping to $[0, 200]$, then min–max normalization to $[0, 1]$ computed from the clipped set) and report the normalized intensities corresponding to the original five voxels in their original order as a single row vector. Express the final normalized values as exact fractions wherever applicable, with no rounding and no units in the final numerical answer.", "solution": "The user wants me to act as a meticulous STEM professor and solve a problem on image intensity normalization in radiomics.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n-   **Input Data**: A set of CT voxel intensities in Hounsfield units (HU), $V_{orig} = \\{-100, 0, 50, 1000, 120\\}$.\n-   **Step 1 (Clipping)**: Intensity clipping to the range $[0, 200]$ HU. Let this range be $[C_{min}, C_{max}]$, where $C_{min} = 0$ and $C_{max} = 200$.\n-   **Step 2 (Normalization)**: Linear normalization to the interval $[0, 1]$. Let this range be $[N_{min}, N_{max}]$, where $N_{min} = 0$ and $N_{max} = 1$. The normalization is based on the minimum and maximum of the *clipped* values.\n-   **Output Requirement**: A single row vector of the five normalized intensities, in the original order, expressed as exact fractions.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Grounding**: The problem is scientifically grounded. Intensity clipping and min-max normalization are standard, well-established pre-processing techniques in medical image analysis, particularly in radiomics for CT scans. Hounsfield units (HU) are the correct unit for CT intensity. The chosen clipping range is plausible for soft-tissue analysis.\n-   **Well-Posed**: The problem is well-posed. The input data, procedural steps, and desired output format are all clearly and unambiguously defined, ensuring a unique solution can be derived.\n-   **Objectivity**: The problem is stated objectively, using precise technical terms without any subjective or opinion-based language.\n-   **Flaw Checklist**: The problem does not violate any of the specified invalidity criteria. It is scientifically sound, formalizable, complete, realistic, well-posed, and non-trivial.\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. A solution will be provided.\n\n**Solution**\n\nThe problem requires performing a two-step pre-processing procedure on a given set of CT voxel intensities. Let the initial vector of intensities be $V_{orig} = \\begin{pmatrix} -100 & 0 & 50 & 1000 & 120 \\end{pmatrix}$.\n\n**Step 1: Intensity Clipping**\nThe first step is to clip the intensities to the specified range of $[0, 200]$. For any given intensity $v$, the clipped value $v_{clip}$ is determined by the formula:\n$$ v_{clip} = \\max(0, \\min(v, 200)) $$\nThis operation ensures that any value below $0$ is set to $0$, any value above $200$ is set to $200$, and any value already within the range $[0, 200]$ remains unchanged. We apply this to each element of $V_{orig}$:\n\n-   For $v_1 = -100$: $v_{1,clip} = \\max(0, \\min(-100, 200)) = \\max(0, -100) = 0$.\n-   For $v_2 = 0$: $v_{2,clip} = \\max(0, \\min(0, 200)) = \\max(0, 0) = 0$.\n-   For $v_3 = 50$: $v_{3,clip} = \\max(0, \\min(50, 200)) = \\max(0, 50) = 50$.\n-   For $v_4 = 1000$: $v_{4,clip} = \\max(0, \\min(1000, 200)) = \\max(0, 200) = 200$.\n-   For $v_5 = 120$: $v_{5,clip} = \\max(0, \\min(120, 200)) = \\max(0, 120) = 120$.\n\nThe resulting vector of clipped intensities is $V_{clip} = \\begin{pmatrix} 0 & 0 & 50 & 200 & 120 \\end{pmatrix}$.\n\n**Step 2: Min-Max Normalization**\nThe second step is to linearly normalize the clipped values to the interval $[0, 1]$. The min-max normalization formula for a value $x$ is:\n$$ x_{norm} = \\frac{x - x_{min}}{x_{max} - x_{min}} $$\nwhere $x_{min}$ and $x_{max}$ are the minimum and maximum values of the dataset being normalized. In this problem, we must use the minimum and maximum of the clipped set, $V_{clip}$.\n\nFirst, we find the minimum and maximum values in $V_{clip}$:\n-   $v_{min, clip} = \\min(\\{0, 0, 50, 200, 120\\}) = 0$.\n-   $v_{max, clip} = \\max(\\{0, 0, 50, 200, 120\\}) = 200$.\n\nSubstituting these into the normalization formula, we get the specific transformation for our clipped data:\n$$ v_{norm} = \\frac{v_{clip} - 0}{200 - 0} = \\frac{v_{clip}}{200} $$\nNow, we apply this transformation to each element of $V_{clip}$:\n\n-   For $v_{1,clip} = 0$: $v_{1,norm} = \\frac{0}{200} = 0$.\n-   For $v_{2,clip} = 0$: $v_{2,norm} = \\frac{0}{200} = 0$.\n-   For $v_{3,clip} = 50$: $v_{3,norm} = \\frac{50}{200} = \\frac{1}{4}$.\n-   For $v_{4,clip} = 200$: $v_{4,norm} = \\frac{200}{200} = 1$.\n-   For $v_{5,clip} = 120$: $v_{5,norm} = \\frac{120}{200} = \\frac{12}{20} = \\frac{3}{5}$.\n\nThe final vector of normalized intensities, corresponding to the original five voxels, is $V_{norm} = \\begin{pmatrix} 0 & 0 & \\frac{1}{4} & 1 & \\frac{3}{5} \\end{pmatrix}$. This vector represents the pre-processed intensities as exact fractions, as required.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0 & \\frac{1}{4} & 1 & \\frac{3}{5}\n\\end{pmatrix}\n}\n$$", "id": "4545736"}, {"introduction": "Once intensities are normalized, the next common step in a radiomics pipeline is discretization, which groups continuous intensity values into a finite number of bins. This process is foundational for calculating many texture-based features. This practice [@problem_id:4545791] walks you through the mechanics of a \"fixed-bin-number\" scheme, where you will calculate the precise bin width and determine how to assign an intensity value to its correct bin label. Mastering this calculation is key to correctly implementing and interpreting discretization-based radiomic features.", "problem": "A radiomics pipeline begins by normalizing voxel intensities from a medical image, such as Computed Tomography (CT), to a predefined range. Consider a single region-of-interest where intensities have already been linearly normalized to lie within the closed interval $\\left[I_{\\min}, I_{\\max}\\right]$ with $I_{\\min}=10$ and $I_{\\max}=210$ (dimensionless normalized intensity units). The next step applies gray-level discretization using a fixed number of bins. In the fixed-bin-number scheme, the interval $\\left[I_{\\min}, I_{\\max}\\right]$ is partitioned into $N$ equal-width bins, here with $N=16$. Bin edges are lower-inclusive and upper-exclusive for all but the highest-intensity bin, which includes the upper bound $I_{\\max}$. Bin labels increase sequentially from $1$ for the lowest-intensity bin to $N$ for the highest-intensity bin. Starting only from these foundational definitions, determine the bin width $\\Delta$ and the bin label assigned to a voxel whose normalized intensity is $I=75$. Express both values as exact numbers, with no rounding required, and report the bin width $\\Delta$ in the same dimensionless normalized intensity units.", "solution": "The problem statement is scientifically grounded, well-posed, and objective. It provides a complete and consistent set of definitions and values for a standard procedure in radiomics, namely gray-level discretization. All necessary information is present to determine a unique solution. We may therefore proceed with the calculation.\n\nThe two quantities to be determined are the bin width, denoted by $\\Delta$, and the bin label for a specific intensity value.\n\nFirst, we calculate the bin width, $\\Delta$. The total range of the normalized intensity values is given by the difference between the maximum and minimum intensities, $I_{\\max} - I_{\\min}$. This range is to be partitioned into $N$ bins of equal width. The formula for the bin width $\\Delta$ is therefore:\n$$\n\\Delta = \\frac{I_{\\max} - I_{\\min}}{N}\n$$\nThe problem provides the following values: $I_{\\min} = 10$, $I_{\\max} = 210$, and the number of bins $N = 16$. Substituting these values into the formula yields:\n$$\n\\Delta = \\frac{210 - 10}{16} = \\frac{200}{16}\n$$\nThis fraction simplifies to:\n$$\n\\Delta = \\frac{100}{8} = \\frac{50}{4} = \\frac{25}{2} = 12.5\n$$\nThe bin width $\\Delta$ is exactly $12.5$ in dimensionless normalized intensity units.\n\nNext, we determine the bin label for a voxel with a normalized intensity of $I = 75$. The bins are labeled sequentially starting from $1$. The $k$-th bin (where $k$ is the bin label) corresponds to a specific intensity interval. Based on the problem description, the bins are lower-inclusive and upper-exclusive, except for the final bin. For any bin $k \\in \\{1, 2, \\dots, N-1\\}$, the intensity interval it covers is:\n$$\n\\left[ I_{\\min} + (k-1)\\Delta, I_{\\min} + k\\Delta \\right)\n$$\nThe final bin, with label $N=16$, covers the interval $\\left[ I_{\\min} + (N-1)\\Delta, I_{\\max} \\right]$ to ensure the upper bound $I_{\\max}$ is included.\n\nTo find the bin label $k$ for the intensity $I = 75$, we must find the integer $k$ that satisfies the condition for bin membership. Since $I = 75$ is not equal to $I_{\\max} = 210$, we use the general condition:\n$$\nI_{\\min} + (k-1)\\Delta \\le I < I_{\\min} + k\\Delta\n$$\nWe can solve for $k$ by first subtracting $I_{\\min}$ from all parts of the inequality:\n$$\n(k-1)\\Delta \\le I - I_{\\min} < k\\Delta\n$$\nSince $\\Delta > 0$, we can divide by $\\Delta$ without changing the direction of the inequalities:\n$$\nk-1 \\le \\frac{I - I_{\\min}}{\\Delta} < k\n$$\nThis shows that $k-1$ is the greatest integer less than or equal to the value of the expression $\\frac{I - I_{\\min}}{\\Delta}$. This is precisely the definition of the floor function, $\\lfloor \\cdot \\rfloor$. Thus, we can write:\n$$\nk-1 = \\left\\lfloor \\frac{I - I_{\\min}}{\\Delta} \\right\\rfloor\n$$\nThe bin label $k$ is therefore given by the formula:\n$$\nk = \\left\\lfloor \\frac{I - I_{\\min}}{\\Delta} \\right\\rfloor + 1\n$$\nWe now substitute the known values: $I = 75$, $I_{\\min} = 10$, and the calculated bin width $\\Delta = 12.5$.\n$$\nk = \\left\\lfloor \\frac{75 - 10}{12.5} \\right\\rfloor + 1\n$$\nFirst, we evaluate the argument of the floor function:\n$$\n\\frac{65}{12.5} = \\frac{130}{25} = \\frac{26}{5} = 5.2\n$$\nNow, substitute this result back into the equation for $k$:\n$$\nk = \\lfloor 5.2 \\rfloor + 1 = 5 + 1 = 6\n$$\nThe bin label assigned to an intensity of $I=75$ is $6$.\n\nTo verify, we can explicitly define the boundaries of the first few bins:\nBin 1: $[10, 10 + 12.5) = [10, 22.5)$\nBin 2: $[22.5, 22.5 + 12.5) = [22.5, 35)$\nBin 3: $[35, 35 + 12.5) = [35, 47.5)$\nBin 4: $[47.5, 47.5 + 12.5) = [47.5, 60)$\nBin 5: $[60, 60 + 12.5) = [60, 72.5)$\nBin 6: $[72.5, 72.5 + 12.5) = [72.5, 85)$\nThe intensity value $I = 75$ clearly falls within the interval $[72.5, 85)$, which corresponds to bin label $6$. The calculation is confirmed to be correct.\n\nThe requested values are the bin width $\\Delta$ and the bin label for $I=75$.\nBin width $\\Delta = 12.5$.\nBin label is $6$.", "answer": "$$\n\\boxed{\\begin{pmatrix} 12.5 & 6 \\end{pmatrix}}\n$$", "id": "4545791"}, {"introduction": "This exercise integrates several key concepts to simulate a miniature radiomics workflow, from raw data to a final quantitative feature. It introduces an alternative and powerful normalization technique, z-score standardization, which rescales intensities based on their statistical distribution. You will then discretize these standardized values and perform the final step: calculating Shannon entropy, a simple yet powerful feature that measures the complexity of the intensity distribution. This comprehensive problem [@problem_id:4545767] illustrates the full purpose of normalization and discretization in generating meaningful, quantitative data from images.", "problem": "In a radiomics preprocessing pipeline, a Region of Interest (ROI) is characterized by raw voxel intensities $\\{12,14,16,18,20\\}$ in dimensionless arbitrary units. A normalization and discretization step is performed as follows: first, apply $z$-score normalization using the sample mean and the unbiased sample standard deviation (with Bessel’s correction). Next, discretize the normalized intensities using a fixed bin width $w=1$ in $z$-score space, where bins are the half-open intervals $[k,k+1)$ for integer $k$, and assign each normalized value to its corresponding bin. Finally, construct the discrete distribution over occupied bins and compute its Shannon entropy using natural logarithms. Derive, from first principles, the sample mean $\\mu$, the unbiased sample standard deviation $\\sigma$, the set of $z$-scores, the occupied bins and their probabilities, and the Shannon entropy $H$ of this discretized distribution. In your reasoning, explain the effect of small sample size on the estimation of $\\sigma$ and how it influences the resulting $z$-scores and discretization. Express the final entropy $H$ in natural-logarithm units (nats) and round your final numerical value to $4$ significant figures.", "solution": "The problem is scientifically well-posed and contains all necessary information to derive a unique solution. We will proceed by following the specified sequence of operations.\n\nFirst, we identify the given raw voxel intensities as the set $X = \\{12, 14, 16, 18, 20\\}$. The number of data points, or sample size, is $n=5$.\n\nThe first step is to compute the sample mean $\\mu$. The sample mean is the arithmetic average of the observations.\n$$\n\\mu = \\frac{1}{n} \\sum_{i=1}^{n} x_i\n$$\nSubstituting the given values:\n$$\n\\mu = \\frac{1}{5}(12 + 14 + 16 + 18 + 20) = \\frac{80}{5} = 16\n$$\nThe sample mean is $\\mu=16$.\n\nThe second step is to compute the unbiased sample standard deviation, denoted by $\\sigma$. This requires first calculating the unbiased sample variance, $\\sigma^2$, which uses Bessel's correction (the denominator is $n-1$ instead of $n$).\n$$\n\\sigma^2 = \\frac{1}{n-1} \\sum_{i=1}^{n} (x_i - \\mu)^2\n$$\nThe sum of squared deviations from the mean is:\n$$\n\\sum_{i=1}^{n} (x_i - \\mu)^2 = (12-16)^2 + (14-16)^2 + (16-16)^2 + (18-16)^2 + (20-16)^2\n$$\n$$\n\\sum_{i=1}^{n} (x_i - \\mu)^2 = (-4)^2 + (-2)^2 + (0)^2 + (2)^2 + (4)^2 = 16 + 4 + 0 + 4 + 16 = 40\n$$\nThe unbiased sample variance is:\n$$\n\\sigma^2 = \\frac{40}{5-1} = \\frac{40}{4} = 10\n$$\nThe unbiased sample standard deviation is the square root of the variance:\n$$\n\\sigma = \\sqrt{10}\n$$\n\nThe use of Bessel's correction, i.e., dividing by $n-1$, is crucial for small sample sizes. The sample variance calculated using a divisor of $n$ is a biased estimator of the population variance, tending to underestimate it. This is because the sum of squared deviations is minimized when calculated from the sample mean, rather than the true (and unknown) population mean. Dividing by $n-1$ instead of $n$ increases the variance estimate, correcting this bias. For a small sample like $n=5$, the correction is significant, as the factor $\\frac{n}{n-1} = \\frac{5}{4} = 1.25$. This larger estimate for $\\sigma$ leads to $z$-scores with smaller absolute values, as $z = (x-\\mu)/\\sigma$, effectively compressing the normalized values towards the mean.\n\nNext, we apply $z$-score normalization to each voxel intensity using the formula $z_i = \\frac{x_i - \\mu}{\\sigma}$.\nThe set of $z$-scores is:\n$$\nz_1 = \\frac{12 - 16}{\\sqrt{10}} = \\frac{-4}{\\sqrt{10}}\n$$\n$$\nz_2 = \\frac{14 - 16}{\\sqrt{10}} = \\frac{-2}{\\sqrt{10}}\n$$\n$$\nz_3 = \\frac{16 - 16}{\\sqrt{10}} = 0\n$$\n$$\nz_4 = \\frac{18 - 16}{\\sqrt{10}} = \\frac{2}{\\sqrt{10}}\n$$\n$$\nz_5 = \\frac{20 - 16}{\\sqrt{10}} = \\frac{4}{\\sqrt{10}}\n$$\nNumerically, these values are approximately $z_1 \\approx -1.2649$, $z_2 \\approx -0.6325$, $z_3=0$, $z_4 \\approx 0.6325$, and $z_5 \\approx 1.2649$.\n\nThe subsequent step is to discretize these normalized intensities. The binning scheme uses a fixed bin width $w=1$, with bins defined as half-open intervals $[k, k+1)$ for integer values of $k$. A value $z$ is assigned to the bin indexed by $k = \\lfloor z \\rfloor$.\n- For $z_1 \\approx -1.2649$, the bin index is $k = \\lfloor -1.2649 \\rfloor = -2$. The value falls in the bin $B_{-2} = [-2, -1)$.\n- For $z_2 \\approx -0.6325$, the bin index is $k = \\lfloor -0.6325 \\rfloor = -1$. The value falls in the bin $B_{-1} = [-1, 0)$.\n- For $z_3 = 0$, the bin index is $k = \\lfloor 0 \\rfloor = 0$. The value falls in the bin $B_{0} = [0, 1)$.\n- For $z_4 \\approx 0.6325$, the bin index is $k = \\lfloor 0.6325 \\rfloor = 0$. The value falls in the bin $B_{0} = [0, 1)$.\n- For $z_5 \\approx 1.2649$, the bin index is $k = \\lfloor 1.2649 \\rfloor = 1$. The value falls in the bin $B_{1} = [1, 2)$.\n\nWe now construct the discrete probability distribution over the occupied bins. The total number of values is $N=5$.\n- Bin $B_{-2}$: contains $1$ value. Its probability is $p_{-2} = \\frac{1}{5}$.\n- Bin $B_{-1}$: contains $1$ value. Its probability is $p_{-1} = \\frac{1}{5}$.\n- Bin $B_{0}$: contains $2$ values. Its probability is $p_{0} = \\frac{2}{5}$.\n- Bin $B_{1}$: contains $1$ value. Its probability is $p_{1} = \\frac{1}{5}$.\nThe set of probabilities for the occupied bins is $\\{p_{-2}, p_{-1}, p_0, p_1\\} = \\{\\frac{1}{5}, \\frac{1}{5}, \\frac{2}{5}, \\frac{1}{5}\\}$. The sum of probabilities is $\\frac{1}{5} + \\frac{1}{5} + \\frac{2}{5} + \\frac{1}{5} = \\frac{5}{5} = 1$, as required.\n\nFinally, we compute the Shannon entropy $H$ of this discrete distribution using the natural logarithm.\n$$\nH = - \\sum_{k} p_k \\ln(p_k)\n$$\nSubstituting the probabilities:\n$$\nH = - \\left( p_{-2}\\ln(p_{-2}) + p_{-1}\\ln(p_{-1}) + p_{0}\\ln(p_{0}) + p_{1}\\ln(p_{1}) \\right)\n$$\n$$\nH = - \\left( \\frac{1}{5}\\ln\\left(\\frac{1}{5}\\right) + \\frac{1}{5}\\ln\\left(\\frac{1}{5}\\right) + \\frac{2}{5}\\ln\\left(\\frac{2}{5}\\right) + \\frac{1}{5}\\ln\\left(\\frac{1}{5}\\right) \\right)\n$$\n$$\nH = - \\left( 3 \\cdot \\frac{1}{5}\\ln\\left(\\frac{1}{5}\\right) + \\frac{2}{5}\\ln\\left(\\frac{2}{5}\\right) \\right)\n$$\nUsing logarithm properties $\\ln(a/b) = \\ln(a) - \\ln(b)$ and $\\ln(1/b) = -\\ln(b)$:\n$$\nH = - \\left( \\frac{3}{5}(-\\ln(5)) + \\frac{2}{5}(\\ln(2) - \\ln(5)) \\right)\n$$\n$$\nH = - \\left( -\\frac{3}{5}\\ln(5) + \\frac{2}{5}\\ln(2) - \\frac{2}{5}\\ln(5) \\right)\n$$\n$$\nH = - \\left( \\frac{2}{5}\\ln(2) - \\frac{5}{5}\\ln(5) \\right) = \\ln(5) - \\frac{2}{5}\\ln(2)\n$$\nThis is the exact analytical expression for the entropy in nats. Now we compute the numerical value:\n$$\nH \\approx 1.6094379 - \\frac{2}{5}(0.6931472) = 1.6094379 - 0.2772589 = 1.332179\n$$\nRounding the final numerical value to $4$ significant figures, we get $H \\approx 1.332$.", "answer": "$$\\boxed{1.332}$$", "id": "4545767"}]}