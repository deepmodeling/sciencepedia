{"hands_on_practices": [{"introduction": "The first step in analyzing observer variability is to quantify the degree of disagreement between different segmentations. This exercise introduces the two most common metrics for measuring volumetric overlap: the Dice similarity coefficient ($DSC$) and the Jaccard index. By deriving these metrics from fundamental set theory and calculating them for a hypothetical case, you will gain a concrete understanding of how spatial agreement is translated into a quantitative score [@problem_id:4547182].", "problem": "Two experienced observers independently segment a tumor region on a three-dimensional Magnetic Resonance Imaging (MRI) scan, producing binary region-of-interest masks $A$ and $B$. The cardinalities $|A|=1200$, $|B|=1000$, and $|A\\cap B|=800$ voxels are measured. In radiomics, inter- and intra-observer segmentation variability is quantified using overlap-based similarity measures grounded in elementary set operations. Starting from the fundamental definitions of set intersection and set union, and using only cardinalities, derive expressions for the Dice similarity coefficient (DSC) and the Jaccard index that normalize $|A\\cap B|$ by appropriate functions of $|A|$, $|B|$, and $|A\\cup B|$. Then compute these two metrics for the given masks. Finally, interpret which metric is more sensitive to boundary disagreements by considering how a small decrease $\\delta>0$ in $|A\\cap B|$ (with $|A|$ and $|B|$ held constant) perturbs each metric, and justify your conclusion based on the resulting rates of change. Express both computed metrics as exact rational numbers; do not round. The final numerical answer must contain the two values only.", "solution": "The problem requires the derivation and computation of two standard segmentation similarity metrics, the Dice similarity coefficient ($DSC$) and the Jaccard index ($J$), followed by a sensitivity analysis. Let the two segmentation masks be represented by sets $A$ and $B$. The given cardinalities are $|A| = 1200$ voxels, $|B| = 1000$ voxels, and the cardinality of their intersection is $|A \\cap B| = 800$ voxels.\n\nFirst, we derive the expressions for the metrics as requested.\n\nThe Jaccard index, $J(A, B)$, is defined as the ratio of the cardinality of the intersection of the sets to the cardinality of their union:\n$$\nJ(A, B) = \\frac{|A \\cap B|}{|A \\cup B|}\n$$\nTo express this in terms of the given cardinalities $|A|$, $|B|$, and $|A \\cap B|$, we use the principle of inclusion-exclusion for two sets, which states:\n$$\n|A \\cup B| = |A| + |B| - |A \\cap B|\n$$\nSubstituting this into the definition of the Jaccard index gives the required expression:\n$$\nJ(A, B) = \\frac{|A \\cap B|}{|A| + |B| - |A \\cap B|}\n$$\n\nThe Dice similarity coefficient, $DSC(A, B)$, is defined as twice the cardinality of the intersection divided by the sum of the cardinalities of the two sets:\n$$\nDSC(A, B) = \\frac{2 |A \\cap B|}{|A| + |B|}\n$$\nThis expression is already in terms of the required cardinalities and normalizes the intersection $|A \\cap B|$ by the arithmetic mean of the individual set sizes, $|A|$ and $|B|$.\n\nNext, we compute the numerical values for these metrics using the provided data.\nFor the Jaccard index:\n$$\nJ = \\frac{800}{1200 + 1000 - 800} = \\frac{800}{2200 - 800} = \\frac{800}{1400} = \\frac{8}{14} = \\frac{4}{7}\n$$\nFor the Dice similarity coefficient:\n$$\nDSC = \\frac{2 \\times 800}{1200 + 1000} = \\frac{1600}{2200} = \\frac{16}{22} = \\frac{8}{11}\n$$\n\nFinally, we address the question of which metric is more sensitive to boundary disagreements. Such disagreements are modeled by a change in the size of the intersection, $|A \\cap B|$, while the individual segmentation volumes, $|A|$ and $|B|$, are held constant. Sensitivity can be quantified by the rate of change of each metric with respect to $|A \\cap B|$. Let $x = |A \\cap B|$, and treat $|A|$ and $|B|$ as constants. The two metrics as functions of $x$ are:\n$$\nJ(x) = \\frac{x}{|A| + |B| - x}\n$$\n$$\nDSC(x) = \\frac{2x}{|A| + |B|}\n$$\n\nWe compute the derivatives of these functions with respect to $x$. For the Dice coefficient, the derivative is a constant:\n$$\n\\frac{d(DSC)}{dx} = \\frac{d}{dx} \\left( \\frac{2x}{|A| + |B|} \\right) = \\frac{2}{|A| + |B|}\n$$\nFor the Jaccard index, we use the quotient rule:\n$$\n\\frac{dJ}{dx} = \\frac{d}{dx} \\left( \\frac{x}{|A| + |B| - x} \\right) = \\frac{(1)(|A| + |B| - x) - (x)(-1)}{(|A| + |B| - x)^2} = \\frac{|A| + |B|}{(|A| + |B| - x)^2}\n$$\n\nNow, we evaluate these rates of change using the given cardinalities: $|A| = 1200$, $|B| = 1000$, and $x = |A \\cap B| = 800$.\n$$\n\\frac{d(DSC)}{dx} = \\frac{2}{1200 + 1000} = \\frac{2}{2200} = \\frac{1}{1100}\n$$\n$$\n\\frac{dJ}{dx} = \\frac{1200 + 1000}{(1200 + 1000 - 800)^2} = \\frac{2200}{(1400)^2} = \\frac{2200}{1960000} = \\frac{22}{19600} = \\frac{11}{9800}\n$$\nTo determine which derivative is larger, we compare the two fractions $\\frac{1}{1100}$ and $\\frac{11}{9800}$. We can cross-multiply:\n$$\n1 \\times 9800 = 9800\n$$\n$$\n11 \\times 1100 = 12100\n$$\nSince $12100 > 9800$, it follows that $\\frac{11}{9800} > \\frac{1}{1100}$.\n\nThe rate of change of the Jaccard index with respect to the intersection size is greater than that of the Dice coefficient. This means that for a small decrease $\\delta > 0$ in $|A \\cap B|$, the magnitude of the change in the Jaccard index, approximately $\\delta \\frac{dJ}{dx}$, will be larger than the magnitude of the change in the Dice coefficient, approximately $\\delta \\frac{d(DSC)}{dx}$. Therefore, the Jaccard index is more sensitive to changes in segmentation overlap, which are representative of boundary disagreements.\n\nThe final computed values for the two metrics are required. They are presented in the order of Dice, then Jaccard.\n$DSC = \\frac{8}{11}$\n$J = \\frac{4}{7}$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{8}{11} & \\frac{4}{7} \\end{pmatrix}}\n$$", "id": "4547182"}, {"introduction": "Observer variability is only a concern because it can affect the radiomic features we extract from segmentations. This practice problem builds a direct bridge between a change in segmentation and its impact on a calculated feature value. By deriving the change in a first-order feature—the mean intensity—that results from adding a small number of boundary voxels, you will see precisely how segmentation inconsistencies propagate into feature instability [@problem_id:4547187].", "problem": "In radiomics, observer-dependent variability in Region of Interest (ROI) segmentation can perturb first-order features such as mean intensity. Consider a static imaging acquisition where a given ROI $A$ has cardinality $|A|$ and voxel intensities $\\{I(x)\\}_{x \\in A}$. The first-order mean intensity feature is defined by the fundamental average definition\n$$\n\\bar{I} = \\frac{1}{|A|} \\sum_{x \\in A} I(x).\n$$\nSuppose that a second observer adds $\\Delta n$ boundary voxels to $A$, producing a new ROI $A'$, where the added boundary voxels have mean intensity $\\bar{I}_{\\text{bnd}}$. Using only the above definition and basic properties of sums and cardinalities, derive an analytic expression for the perturbed mean intensity $\\bar{I}'$ of $A'$ and the perturbation $\\Delta \\bar{I} = \\bar{I}' - \\bar{I}$ in terms of $|A|$, $\\Delta n$, $\\bar{I}$, and $\\bar{I}_{\\text{bnd}}$. Then, evaluate the perturbation for the case $|A| = 5000$, $\\Delta n = 200$, $\\bar{I} = 120$, and $\\bar{I}_{\\text{bnd}} = 90$. Express the final numerical value as an exact fraction. No units are required for intensity in this problem.", "solution": "The starting point is the fundamental definition of the mean intensity over a set of voxels. For the original Region of Interest (ROI) $A$, the mean intensity is\n$$\n\\bar{I} = \\frac{1}{|A|} \\sum_{x \\in A} I(x).\n$$\nLet the sum of intensities over $A$ be denoted by\n$$\nS_{A} = \\sum_{x \\in A} I(x) = |A| \\bar{I}.\n$$\nA second observer adds $\\Delta n$ boundary voxels to $A$ to form a new ROI $A'$. Denote the set of added boundary voxels by $B$, with $|B| = \\Delta n$ and mean intensity $\\bar{I}_{\\text{bnd}}$. The sum of intensities over $B$ is\n$$\nS_{B} = \\sum_{x \\in B} I(x) = \\Delta n \\, \\bar{I}_{\\text{bnd}}.\n$$\nThe new ROI $A' = A \\cup B$ has cardinality\n$$\n|A'| = |A| + \\Delta n,\n$$\nand total intensity sum\n$$\nS_{A'} = S_{A} + S_{B} = |A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}}.\n$$\nBy the same mean definition, the perturbed mean intensity $\\bar{I}'$ over $A'$ is\n$$\n\\bar{I}' = \\frac{S_{A'}}{|A'|} = \\frac{|A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}}}{|A| + \\Delta n}.\n$$\nThe perturbation in mean intensity, defined as the difference between the new and original means, is\n$$\n\\Delta \\bar{I} = \\bar{I}' - \\bar{I} = \\frac{|A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}}}{|A| + \\Delta n} - \\bar{I}.\n$$\nTo simplify, write the right-hand side over the common denominator:\n$$\n\\Delta \\bar{I} = \\frac{|A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}} - \\bar{I}(|A| + \\Delta n)}{|A| + \\Delta n} = \\frac{|A| \\bar{I} + \\Delta n \\, \\bar{I}_{\\text{bnd}} - |A| \\bar{I} - \\Delta n \\bar{I}}{|A| + \\Delta n}.\n$$\nCanceling terms yields\n$$\n\\Delta \\bar{I} = \\frac{\\Delta n \\left( \\bar{I}_{\\text{bnd}} - \\bar{I} \\right)}{|A| + \\Delta n}.\n$$\nThis expression shows that the perturbation is a weighted difference between the boundary-voxel mean and the original mean, with weight factor $\\Delta n/(|A|+\\Delta n)$ determined by how many voxels are added relative to the new total.\n\nNow evaluate this perturbation for the specified values $|A| = 5000$, $\\Delta n = 200$, $\\bar{I} = 120$, and $\\bar{I}_{\\text{bnd}} = 90$:\n$$\n\\Delta \\bar{I} = \\frac{200 \\left( 90 - 120 \\right)}{5000 + 200} = \\frac{200 \\cdot (-30)}{5200} = \\frac{-6000}{5200}.\n$$\nReduce the fraction by dividing numerator and denominator by $400$:\n$$\n\\Delta \\bar{I} = \\frac{-6000}{5200} = \\frac{-15}{13}.\n$$\nThe negative sign reflects that the added boundary voxels have lower mean intensity than the original ROI, thus decreasing the overall mean intensity.", "answer": "$$\\boxed{-\\frac{15}{13}}$$", "id": "4547187"}, {"introduction": "Beyond comparing single pairs of segmentations, a robust radiomics study requires a comprehensive statistical assessment of feature reliability across multiple subjects and observers. This exercise introduces the Intraclass Correlation Coefficient (ICC), a powerful metric derived from a random-effects model that partitions the total measurement variance into its constituent sources. By calculating the ICC, you will learn how to formally quantify the reliability of a radiomic feature and understand how averaging measurements across multiple raters can improve it [@problem_id:4547210].", "problem": "In a radiomics study quantifying inter- and intra-observer segmentation variability for a scalar radiomic feature computed from a Region of Interest (ROI), assume the measurements are modeled using a two-way random-effects absolute-agreement framework. For subject $i$ segmented by rater $j$, the measurement is represented as $y_{ij} = \\mu + s_i + r_j + e_{ij}$, where $s_i$ is the subject-specific random effect with variance $\\sigma^{2}_{\\text{subj}}$, $r_j$ is the rater-specific random effect with variance $\\sigma^{2}_{\\text{rater}}$ representing systematic inter-observer differences, and $e_{ij}$ is the residual term with variance $\\sigma^{2}_{\\text{res}}$ capturing rater-by-subject interaction and intra-observer segmentation noise. Measurements are assumed to be centered and all random components are assumed independent with zero mean. The Intraclass Correlation Coefficient (ICC) for absolute agreement is defined as the correlation between two independent measurements of the same subject under this random-effects model.\n\nYou are given variance components $\\sigma^{2}_{\\text{subj}} = 2.0$, $\\sigma^{2}_{\\text{rater}} = 0.3$, and $\\sigma^{2}_{\\text{res}} = 0.7$ for $k = 3$ raters. Using first principles of variance decomposition and the definition of correlation, compute the Intraclass Correlation Coefficient (ICC) for:\n1) a single measurement (one randomly selected rater), and\n2) the average measurement across $k$ raters.\n\nRound your answers to four significant figures and express them as decimals. Provide both values in the order listed above.", "solution": "The measurement for subject $i$ by rater $j$ is given by the model:\n$$ y_{ij} = \\mu + s_i + r_j + e_{ij} $$\nThe random components $s_i$, $r_j$, and $e_{ij}$ are assumed to be independent with zero mean and respective variances $\\sigma^{2}_{\\text{subj}}$, $\\sigma^{2}_{\\text{rater}}$, and $\\sigma^{2}_{\\text{res}}$.\n\nThe total variance of a single measurement, $y_{ij}$, is the sum of the variances of its random components, due to their independence. The constant mean $\\mu$ does not contribute to the variance.\n$$ \\text{Var}(y_{ij}) = \\text{Var}(s_i) + \\text{Var}(r_j) + \\text{Var}(e_{ij}) = \\sigma^{2}_{\\text{subj}} + \\sigma^{2}_{\\text{rater}} + \\sigma^{2}_{\\text{res}} $$\n\n#### 1) ICC for a single measurement\nThe ICC for a single measurement, which we can denote as $\\text{ICC}_{1}$, corresponds to the form often designated as ICC(A,1). It is defined as the correlation between two measurements on the same subject $i$ by two different, randomly selected raters, say $j$ and $l$ (where $j \\neq l$).\n$$ \\text{ICC}_{1} = \\text{Corr}(y_{ij}, y_{il}) = \\frac{\\text{Cov}(y_{ij}, y_{il})}{\\sqrt{\\text{Var}(y_{ij}) \\text{Var}(y_{il})}} $$\nThe denominator is simply the total variance of a single measurement, since $\\text{Var}(y_{ij}) = \\text{Var}(y_{il})$.\nThe covariance term is:\n$$ \\text{Cov}(y_{ij}, y_{il}) = \\text{Cov}(\\mu + s_i + r_j + e_{ij}, \\mu + s_i + r_l + e_{il}) $$\nUsing the bilinearity of covariance and the independence of the random effects:\n- $\\text{Cov}(s_i, s_i) = \\text{Var}(s_i) = \\sigma^{2}_{\\text{subj}}$\n- $\\text{Cov}(r_j, r_l) = 0$ since $j \\neq l$ and rater effects are independent.\n- $\\text{Cov}(e_{ij}, e_{il}) = 0$ since the residual errors are independent for different rater-subject pairs.\n- All other cross-term covariances, such as $\\text{Cov}(s_i, r_j)$, $\\text{Cov}(s_i, e_{ij})$, etc., are $0$ by the assumption of independence.\nThus, the covariance is solely the variance of the subject effect:\n$$ \\text{Cov}(y_{ij}, y_{il}) = \\sigma^{2}_{\\text{subj}} $$\nThe ICC for a single measurement is the ratio of the between-subject variance to the total variance:\n$$ \\text{ICC}_{1} = \\frac{\\sigma^{2}_{\\text{subj}}}{\\sigma^{2}_{\\text{subj}} + \\sigma^{2}_{\\text{rater}} + \\sigma^{2}_{\\text{res}}} $$\nSubstituting the given numerical values:\n$$ \\sigma^{2}_{\\text{subj}} = 2.0, \\quad \\sigma^{2}_{\\text{rater}} = 0.3, \\quad \\sigma^{2}_{\\text{res}} = 0.7 $$\n$$ \\text{ICC}_{1} = \\frac{2.0}{2.0 + 0.3 + 0.7} = \\frac{2.0}{3.0} = 0.6666... $$\nRounding to four significant figures, we get $\\text{ICC}_{1} \\approx 0.6667$.\n\n#### 2) ICC for the average measurement across $k$ raters\nThis ICC, which we denote as $\\text{ICC}_{k}$, corresponds to the form ICC(A,k). It measures the reliability of the mean of $k$ measurements. Let $\\bar{y}_{i\\cdot}$ be the average measurement for subject $i$ across $k$ raters:\n$$ \\bar{y}_{i\\cdot} = \\frac{1}{k} \\sum_{j=1}^{k} y_{ij} = \\frac{1}{k} \\sum_{j=1}^{k} (\\mu + s_i + r_j + e_{ij}) = \\mu + s_i + \\frac{1}{k}\\sum_{j=1}^{k} r_j + \\frac{1}{k}\\sum_{j=1}^{k} e_{ij} $$\nThe variance of this average score, $\\text{Var}(\\bar{y}_{i\\cdot})$, is found by summing the variances of its independent random components:\n$$ \\text{Var}(\\bar{y}_{i\\cdot}) = \\text{Var}(s_i) + \\text{Var}\\left(\\frac{1}{k}\\sum_{j=1}^{k} r_j\\right) + \\text{Var}\\left(\\frac{1}{k}\\sum_{j=1}^{k} e_{ij}\\right) $$\n$$ \\text{Var}(\\bar{y}_{i\\cdot}) = \\sigma^{2}_{\\text{subj}} + \\frac{1}{k^2} \\sum_{j=1}^{k} \\text{Var}(r_j) + \\frac{1}{k^2} \\sum_{j=1}^{k} \\text{Var}(e_{ij}) $$\n$$ \\text{Var}(\\bar{y}_{i\\cdot}) = \\sigma^{2}_{\\text{subj}} + \\frac{k\\sigma^{2}_{\\text{rater}}}{k^2} + \\frac{k\\sigma^{2}_{\\text{res}}}{k^2} = \\sigma^{2}_{\\text{subj}} + \\frac{\\sigma^{2}_{\\text{rater}}}{k} + \\frac{\\sigma^{2}_{\\text{res}}}{k} $$\nThe ICC for the average measurement is the ratio of the true subject variance to the total variance of the average score:\n$$ \\text{ICC}_{k} = \\frac{\\text{Var}(s_i)}{\\text{Var}(\\bar{y}_{i\\cdot})} = \\frac{\\sigma^{2}_{\\text{subj}}}{\\sigma^{2}_{\\text{subj}} + \\frac{\\sigma^{2}_{\\text{rater}} + \\sigma^{2}_{\\text{res}}}{k}} $$\nSubstituting the given numerical values with $k=3$:\n$$ \\text{ICC}_{3} = \\frac{2.0}{2.0 + \\frac{0.3 + 0.7}{3}} = \\frac{2.0}{2.0 + \\frac{1.0}{3}} = \\frac{2.0}{\\frac{6.0}{3} + \\frac{1.0}{3}} = \\frac{2.0}{\\frac{7.0}{3}} = \\frac{6.0}{7.0} = 0.857142... $$\nRounding to four significant figures, we get $\\text{ICC}_{3} \\approx 0.8571$.\n\nThe two computed values are $0.6667$ and $0.8571$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.6667 & 0.8571\n\\end{pmatrix}\n}\n$$", "id": "4547210"}]}