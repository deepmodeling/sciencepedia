{"hands_on_practices": [{"introduction": "The Dice Similarity Coefficient ($DSC$) and the Jaccard Index, or Intersection over Union ($IoU$), are two of the most common metrics for evaluating segmentation accuracy. While they appear to be different formulas, they are in fact deeply and monotonically related. This first exercise guides you through deriving the exact analytical expression that links $DSC$ directly to $IoU$, starting from fundamental set theory principles [@problem_id:4560075]. Mastering this derivation is key to understanding that these two metrics provide a similar perspective on segmentation overlap, with the Dice score consistently yielding a higher value than the Jaccard index for any imperfect segmentation.", "problem": "In a radiomics study assessing automated tumor segmentation on magnetic resonance imaging, let $A$ denote the finite set of voxels labeled as tumor by the algorithm and let $B$ denote the finite set of voxels labeled as tumor in the expert-annotated reference. Consider the standard segmentation accuracy metrics: Intersection over Union (IoU) and Dice Similarity Coefficient (DSC). Starting from basic set cardinality properties and identities, including the relationship $|A \\cup B| = |A| + |B| - |A \\cap B|$ for finite sets, derive an exact analytic expression that links the DSC to the IoU without introducing any approximations. Then, for a particular slice on which the measured IoU equals $13/20$, compute the corresponding DSC. Express your final numerical result in exact fractional form. No rounding is required.", "solution": "The problem requires the derivation of an exact analytic expression relating the Dice Similarity Coefficient (DSC) to the Intersection over Union (IoU) and the subsequent calculation of the DSC for a given IoU value.\n\nLet $A$ be the finite set of voxels identified as tumor by an automated algorithm, and let $B$ be the finite set of voxels in the expert-annotated reference segmentation. The cardinality of a set $S$ is denoted by $|S|$.\n\nThe Intersection over Union (IoU), also known as the Jaccard index, is defined as the ratio of the cardinality of the intersection of the two sets to the cardinality of their union:\n$$\n\\text{IoU} = \\frac{|A \\cap B|}{|A \\cup B|}\n$$\nThe Dice Similarity Coefficient (DSC) is defined as twice the cardinality of the intersection of the sets divided by the sum of their individual cardinalities:\n$$\n\\text{DSC} = \\frac{2 |A \\cap B|}{|A| + |B|}\n$$\nThe problem provides the principle of inclusion-exclusion for two finite sets, which states:\n$$\n|A \\cup B| = |A| + |B| - |A \\cap B|\n$$\nOur first objective is to derive an expression for the DSC in terms of the IoU. We can start by rearranging the given set identity to express the sum of the cardinalities, $|A| + |B|$, which appears in the denominator of the DSC formula:\n$$\n|A| + |B| = |A \\cup B| + |A \\cap B|\n$$\nSubstituting this expression for $|A| + |B|$ into the definition of the DSC, we obtain:\n$$\n\\text{DSC} = \\frac{2 |A \\cap B|}{|A \\cup B| + |A \\cap B|}\n$$\nThis expression for the DSC now contains the terms $|A \\cap B|$ and $|A \\cup B|$, which are the building blocks of the IoU. To make the IoU appear explicitly, we can divide both the numerator and the denominator of the DSC expression by $|A \\cup B|$. This operation is valid as long as $|A \\cup B| \\neq 0$, which is the case for any non-trivial segmentation problem.\n$$\n\\text{DSC} = \\frac{\\frac{2 |A \\cap B|}{|A \\cup B|}}{\\frac{|A \\cup B|}{|A \\cup B|} + \\frac{|A \\cap B|}{|A \\cup B|}}\n$$\nRecognizing that $\\frac{|A \\cup B|}{|A \\cup B|} = 1$ and substituting the definition $\\text{IoU} = \\frac{|A \\cap B|}{|A \\cup B|}$ into the equation, we arrive at the desired relationship:\n$$\n\\text{DSC} = \\frac{2 \\cdot \\text{IoU}}{1 + \\text{IoU}}\n$$\nThis is the exact analytic expression linking the DSC to the IoU.\n\nThe second part of the problem is to compute the DSC for a given IoU value of $\\frac{13}{20}$. We use the formula derived above.\nGiven $\\text{IoU} = \\frac{13}{20}$, we substitute this value into our expression:\n$$\n\\text{DSC} = \\frac{2 \\left(\\frac{13}{20}\\right)}{1 + \\frac{13}{20}}\n$$\nFirst, we evaluate the numerator:\n$$\n2 \\left(\\frac{13}{20}\\right) = \\frac{26}{20}\n$$\nNext, we evaluate the denominator:\n$$\n1 + \\frac{13}{20} = \\frac{20}{20} + \\frac{13}{20} = \\frac{33}{20}\n$$\nNow, we compute the final ratio:\n$$\n\\text{DSC} = \\frac{\\frac{26}{20}}{\\frac{33}{20}}\n$$\nDividing by the fraction in the denominator is equivalent to multiplying by its reciprocal:\n$$\n\\text{DSC} = \\frac{26}{20} \\times \\frac{20}{33} = \\frac{26}{33}\n$$\nThe fraction $\\frac{26}{33}$ is in its simplest form, since the prime factorization of the numerator is $2 \\times 13$ and the prime factorization of the denominator is $3 \\times 11$, and they share no common factors.", "answer": "$$\\boxed{\\frac{26}{33}}$$", "id": "4560075"}, {"introduction": "To truly appreciate the Dice and Jaccard indices, it is helpful to understand their place within the broader family of classification performance metrics. This practice explores the relationship between segmentation overlap and familiar concepts like precision, recall, and the $F_1$-score. You will demonstrate the important identity that the Dice coefficient is mathematically equivalent to the $F_1$-score, which is the harmonic mean of precision and recall [@problem_id:4560067]. This exercise provides a powerful bridge between the voxel-overlap perspective of segmentation and the instance-counting perspective of classification.", "problem": "A radiomics pipeline evaluates a binary segmentation of a hepatic lesion on Computed Tomography (CT) within a Region of Interest (ROI) of $N$ voxels. Let the predicted lesion mask be the set $\\mathcal{P}$ and the ground-truth lesion mask be the set $\\mathcal{G}$. The overlap is $\\mathcal{P} \\cap \\mathcal{G}$, and the standard confusion counts are defined in terms of set cardinalities: True Positive (TP) is $|\\mathcal{P} \\cap \\mathcal{G}|$, False Positive (FP) is $|\\mathcal{P} \\setminus \\mathcal{G}|$, False Negative (FN) is $|\\mathcal{G} \\setminus \\mathcal{P}|$, and True Negative (TN) is the count of voxels in the ROI that are neither in $\\mathcal{P}$ nor in $\\mathcal{G}$. Precision is defined as the fraction of predicted positives that are correct, recall is defined as the fraction of actual positives that are correctly predicted, the F1 score is defined as the harmonic mean of precision and recall, and accuracy is defined as the fraction of all ROI voxels that are correctly classified.\n\nFor a particular case, you are given $N = 10{,}000$, $|\\mathcal{G}| = 1{,}280$, $|\\mathcal{P}| = 1{,}000$, and the measured accuracy $a = 0.95$ on the ROI. Using only the fundamental definitions above:\n\n1. Derive an expression for $|\\mathcal{P} \\cap \\mathcal{G}|$ in terms of $N$, $|\\mathcal{G}|$, $|\\mathcal{P}|$, and $a$.\n2. Derive an expression for the Dice coefficient in terms of precision and recall, and separately derive an expression for the Jaccard index in terms of the F1 score.\n3. Compute the Jaccard index numerically for the given case.\n\nExpress your final numeric value as an exact fraction. No rounding is required.", "solution": "**Part 1: Derive an expression for $|\\mathcal{P} \\cap \\mathcal{G}|$**\n\nThe accuracy, $a$, is defined as the fraction of correctly classified voxels over the total number of voxels, $N$:\n$$a = \\frac{TP + TN}{N}$$\nThe number of True Positives, $TP$, is given by the cardinality of the intersection of the predicted and ground-truth sets:\n$$TP = |\\mathcal{P} \\cap \\mathcal{G}|$$\nThe number of True Negatives, $TN$, represents the voxels correctly identified as background. These are the voxels outside of both the predicted mask $\\mathcal{P}$ and the ground-truth mask $\\mathcal{G}$. Using the principle of inclusion-exclusion, the number of voxels in the union of the two sets is $|\\mathcal{P} \\cup \\mathcal{G}| = |\\mathcal{P}| + |\\mathcal{G}| - |\\mathcal{P} \\cap \\mathcal{G}|$. The number of True Negatives is the total number of voxels $N$ minus the voxels in this union:\n$$TN = N - |\\mathcal{P} \\cup \\mathcal{G}| = N - (|\\mathcal{P}| + |\\mathcal{G}| - |\\mathcal{P} \\cap \\mathcal{G}|)$$\n$$TN = N - |\\mathcal{P}| - |\\mathcal{G}| + |\\mathcal{P} \\cap \\mathcal{G}|$$\nNow, substitute the expressions for $TP$ and $TN$ into the accuracy formula:\n$$a = \\frac{(|\\mathcal{P} \\cap \\mathcal{G}|) + (N - |\\mathcal{P}| - |\\mathcal{G}| + |\\mathcal{P} \\cap \\mathcal{G}|)}{N}$$\nTo find an expression for $|\\mathcal{P} \\cap \\mathcal{G}|$, we rearrange the equation:\n$$a \\cdot N = 2|\\mathcal{P} \\cap \\mathcal{G}| + N - |\\mathcal{P}| - |\\mathcal{G}|$$\n$$a \\cdot N - N + |\\mathcal{P}| + |\\mathcal{G}| = 2|\\mathcal{P} \\cap \\mathcal{G}|$$\n$$|\\mathcal{P} \\cap \\mathcal{G}| = \\frac{a \\cdot N - N + |\\mathcal{P}| + |\\mathcal{G}|}{2}$$\nThis can be written more compactly as:\n$$|\\mathcal{P} \\cap \\mathcal{G}| = \\frac{N(a-1) + |\\mathcal{P}| + |\\mathcal{G}|}{2}$$\n\n**Part 2: Derive relationships for Dice and Jaccard indices**\n\n**Dice coefficient in terms of precision ($P$) and recall ($R$)**\nThe Dice coefficient is defined as:\n$$Dice = \\frac{2 TP}{2 TP + FP + FN}$$\nPrecision ($P$) and recall ($R$) are defined as:\n$$P = \\frac{TP}{TP+FP} \\quad \\text{and} \\quad R = \\frac{TP}{TP+FN}$$\nFrom these definitions, we can express $FP$ and $FN$ in terms of $TP$, $P$, and $R$:\n$$TP + FP = \\frac{TP}{P} \\implies FP = \\frac{TP}{P} - TP = TP \\left(\\frac{1}{P} - 1\\right)$$\n$$TP + FN = \\frac{TP}{R} \\implies FN = \\frac{TP}{R} - TP = TP \\left(\\frac{1}{R} - 1\\right)$$\nSubstitute these into the Dice formula:\n$$Dice = \\frac{2 TP}{2 TP + TP \\left(\\frac{1}{P} - 1\\right) + TP \\left(\\frac{1}{R} - 1\\right)}$$\nAssuming $TP > 0$, we can cancel $TP$ from the numerator and denominator:\n$$Dice = \\frac{2}{2 + \\left(\\frac{1}{P} - 1\\right) + \\left(\\frac{1}{R} - 1\\right)} = \\frac{2}{\\frac{1}{P} + \\frac{1}{R}}$$\n$$Dice = \\frac{2}{\\frac{R+P}{PR}} = \\frac{2PR}{P+R}$$\nThis expression is the harmonic mean of precision and recall, which is also the definition of the F1 score. Therefore, $Dice = F_1$. The expression for the Dice coefficient in terms of precision and recall is $\\frac{2PR}{P+R}$.\n\n**Jaccard index in terms of the F1 score**\nThe Jaccard index, $J$, is defined as the intersection over the union:\n$$J = \\frac{|\\mathcal{P} \\cap \\mathcal{G}|}{|\\mathcal{P} \\cup \\mathcal{G}|} = \\frac{TP}{TP+FP+FN}$$\nThe F1 score (which is equivalent to the Dice coefficient) is:\n$$F_1 = \\frac{2 TP}{2 TP + FP + FN}$$\nWe can establish a relationship between $J$ and $F_1$. From the definition of $J$, we have $TP+FP+FN = \\frac{TP}{J}$. Substitute this into the $F_1$ formula:\n$$F_1 = \\frac{2 TP}{TP + (TP+FP+FN)} = \\frac{2 TP}{TP + \\frac{TP}{J}}$$\nAssuming $TP > 0$, we cancel $TP$:\n$$F_1 = \\frac{2}{1 + \\frac{1}{J}} = \\frac{2}{\\frac{J+1}{J}} = \\frac{2J}{J+1}$$\nNow, we must solve for $J$ in terms of $F_1$:\n$$F_1 (J+1) = 2J$$\n$$F_1 J + F_1 = 2J$$\n$$F_1 = 2J - F_1 J$$\n$$F_1 = J(2 - F_1)$$\n$$J = \\frac{F_1}{2 - F_1}$$\n\n**Part 3: Compute the Jaccard index for the given case**\n\nFirst, we calculate the number of True Positives, $TP = |\\mathcal{P} \\cap \\mathcal{G}|$, using the formula derived in Part 1 and the given values: $N = 10,000$, $a = 0.95$, $|\\mathcal{P}| = 1,000$, and $|\\mathcal{G}| = 1,280$.\n$$TP = \\frac{10,000(0.95-1) + 1,000 + 1,280}{2}$$\n$$TP = \\frac{10,000(-0.05) + 2,280}{2}$$\n$$TP = \\frac{-500 + 2,280}{2} = \\frac{1,780}{2} = 890$$\nNext, we calculate the number of False Positives ($FP$) and False Negatives ($FN$):\n$$FP = |\\mathcal{P}| - TP = 1,000 - 890 = 110$$\n$$FN = |\\mathcal{G}| - TP = 1,280 - 890 = 390$$\nNow we can compute the Jaccard index, $J$, using its fundamental definition:\n$$J = \\frac{TP}{TP + FP + FN}$$\n$$J = \\frac{890}{890 + 110 + 390} = \\frac{890}{1,390}$$\nTo express this as an exact fraction in simplest form, we divide the numerator and denominator by their greatest common divisor, which is $10$:\n$$J = \\frac{89}{139}$$\nSince both $89$ and $139$ are prime numbers, this fraction is irreducible.", "answer": "$$\\boxed{\\frac{89}{139}}$$", "id": "4560067"}, {"introduction": "While many segmentation tasks are binary (e.g., lesion versus background), real-world applications in radiomics often involve segmenting multiple classes simultaneously, such as different types of tissue or tumor sub-regions. This advanced exercise challenges you to extend the Dice and Jaccard metrics to a multiclass scenario using different aggregation strategies [@problem_id:4560065]. By computing both a micro-averaged Jaccard index and a weighted macro-averaged Dice score, you will gain hands-on experience with the nuanced methods required to summarize multiclass segmentation performance into a single, meaningful number.", "problem": "In a radiomics evaluation of a brain Magnetic Resonance Imaging (MRI) multiclass segmentation, a model assigns exactly one label per voxel among three tissue classes. You are given the following voxel counts, organized by ground-truth class and showing how the model predicted those voxels:\n\n- Ground-truth Class A, total $2000$ voxels: predicted as A $1600$, predicted as B $250$, predicted as C $150$.\n- Ground-truth Class B, total $1800$ voxels: predicted as A $180$, predicted as B $1500$, predicted as C $120$.\n- Ground-truth Class C, total $1200$ voxels: predicted as A $140$, predicted as B $160$, predicted as C $900$.\n\nAssume there is no background class and the three classes are mutually exclusive and collectively exhaustive within the region of interest.\n\nUsing only the core set-based definitions of region overlap and mismatch, compute two aggregate multiclass metrics:\n- The micro-averaged Jaccard index across the three classes, obtained by first aggregating correct and incorrect voxel counts across classes and then forming the index.\n- The ground-truth-frequency-weighted macro-average of the per-class Dice similarity coefficients across the three classes, where each class weight equals its ground-truth voxel fraction among the three classes.\n\nFinally, compute the arithmetic mean of these two aggregate metrics. Express the final result as a decimal (not a percentage) and round to four significant figures.", "solution": "The problem requires the calculation of two multiclass segmentation metrics and their arithmetic mean, based on provided voxel counts from a 3-class classification. The solution process involves three sequential steps: 1) calculating the micro-averaged Jaccard index, 2) calculating the ground-truth-frequency-weighted macro-averaged Dice similarity coefficient, and 3) computing the arithmetic mean of these two values.\n\nFirst, we formalize the given data by constructing a confusion matrix, where rows represent the ground-truth classes and columns represent the predicted classes. Let the classes be $A$, $B$, and $C$.\n\nThe confusion matrix $C$ is:\n$$\nC = \\begin{pmatrix} C_{AA} & C_{AB} & C_{AC} \\\\ C_{BA} & C_{BB} & C_{BC} \\\\ C_{CA} & C_{CB} & C_{CC} \\end{pmatrix} = \\begin{pmatrix} 1600 & 250 & 150 \\\\ 180 & 1500 & 120 \\\\ 140 & 160 & 900 \\end{pmatrix}\n$$\n\nFrom this matrix, we determine the number of True Positives ($TP_i$), False Positives ($FP_i$), and False Negatives ($FN_i$) for each class $i \\in \\{A, B, C\\}$.\n\nFor Class A:\n- True Positives ($TP_A$): Voxels of class A correctly predicted as A. $TP_A = C_{AA} = 1600$.\n- False Positives ($FP_A$): Voxels of other classes incorrectly predicted as A. $FP_A = C_{BA} + C_{CA} = 180 + 140 = 320$.\n- False Negatives ($FN_A$): Voxels of class A incorrectly predicted as other classes. $FN_A = C_{AB} + C_{AC} = 250 + 150 = 400$.\n\nFor Class B:\n- True Positives ($TP_B$): $TP_B = C_{BB} = 1500$.\n- False Positives ($FP_B$): $FP_B = C_{AB} + C_{CB} = 250 + 160 = 410$.\n- False Negatives ($FN_B$): $FN_B = C_{BA} + C_{BC} = 180 + 120 = 300$.\n\nFor Class C:\n- True Positives ($TP_C$): $TP_C = C_{CC} = 900$.\n- False Positives ($FP_C$): $FP_C = C_{AC} + C_{BC} = 150 + 120 = 270$.\n- False Negatives ($FN_C$): $FN_C = C_{CA} + C_{CB} = 140 + 160 = 300$.\n\n**1. Micro-Averaged Jaccard Index ($J_{micro}$)**\n\nThe micro-averaged Jaccard index is calculated by first aggregating the $TP$, $FP$, and $FN$ counts across all classes and then applying the Jaccard formula, $J = \\frac{TP}{TP + FP + FN}$.\n\nFirst, we sum the counts:\n$$\nTP_{micro} = \\sum_{i} TP_i = 1600 + 1500 + 900 = 4000\n$$\n$$\nFP_{micro} = \\sum_{i} FP_i = 320 + 410 + 270 = 1000\n$$\n$$\nFN_{micro} = \\sum_{i} FN_i = 400 + 300 + 300 = 1000\n$$\nNote that for a multiclass problem without a background class, the total number of false positives equals the total number of false negatives, as every misclassification is counted once as an $FP$ for one class and once as an $FN$ for another.\n\nNow, we compute the micro-averaged Jaccard index, which we denote as $M_1$:\n$$\nM_1 = J_{micro} = \\frac{TP_{micro}}{TP_{micro} + FP_{micro} + FN_{micro}} = \\frac{4000}{4000 + 1000 + 1000} = \\frac{4000}{6000} = \\frac{2}{3}\n$$\n\n**2. Ground-Truth-Frequency-Weighted Macro-Averaged Dice Similarity Coefficient ($DSC_{w-macro}$)**\n\nFirst, we compute the Dice similarity coefficient ($DSC$) for each class using the formula $DSC_i = \\frac{2 \\times TP_i}{2 \\times TP_i + FP_i + FN_i}$.\n\nFor Class A:\n$$\nDSC_A = \\frac{2 \\times 1600}{2 \\times 1600 + 320 + 400} = \\frac{3200}{3200 + 720} = \\frac{3200}{3920} = \\frac{40}{49}\n$$\n\nFor Class B:\n$$\nDSC_B = \\frac{2 \\times 1500}{2 \\times 1500 + 410 + 300} = \\frac{3000}{3000 + 710} = \\frac{3000}{3710} = \\frac{300}{371}\n$$\n\nFor Class C:\n$$\nDSC_C = \\frac{2 \\times 900}{2 \\times 900 + 270 + 300} = \\frac{1800}{1800 + 570} = \\frac{1800}{2370} = \\frac{60}{79}\n$$\n\nNext, we calculate the weights based on the ground-truth voxel fraction for each class. The total number of voxels is $N_{total} = 2000 + 1800 + 1200 = 5000$.\nThe ground-truth voxel counts are $N_A = 2000$, $N_B = 1800$, and $N_C = 1200$.\n\nThe weights ($w_i$) are:\n$$\nw_A = \\frac{N_A}{N_{total}} = \\frac{2000}{5000} = \\frac{2}{5} = 0.4\n$$\n$$\nw_B = \\frac{N_B}{N_{total}} = \\frac{1800}{5000} = \\frac{18}{50} = \\frac{9}{25} = 0.36\n$$\n$$\nw_C = \\frac{N_C}{N_{total}} = \\frac{1200}{5000} = \\frac{12}{50} = \\frac{6}{25} = 0.24\n$$\n\nThe weighted macro-average of the Dice coefficients, which we denote as $M_2$, is:\n$$\nM_2 = DSC_{w-macro} = w_A \\times DSC_A + w_B \\times DSC_B + w_C \\times DSC_C\n$$\n$$\nM_2 = \\left(\\frac{2}{5}\\right) \\left(\\frac{40}{49}\\right) + \\left(\\frac{9}{25}\\right) \\left(\\frac{300}{371}\\right) + \\left(\\frac{6}{25}\\right) \\left(\\frac{60}{79}\\right)\n$$\n$$\nM_2 = \\frac{16}{49} + \\frac{108}{371} + \\frac{144}{1975}\n$$\nConverting these fractions to decimals for calculation:\n$ \\frac{16}{49} \\approx 0.32653061 $\n$ \\frac{108}{371} \\approx 0.29110512 $\n$ \\frac{144}{1975} \\approx 0.07291139 $\n$$\nM_2 \\approx 0.32653061 + 0.29110512 + 0.07291139 \\approx 0.79991421\n$$\nNote: A calculation error in the original solution for the last term of $M_2$ was corrected. $ \\frac{6}{25} \\times \\frac{60}{79} = \\frac{360}{1975} \\approx 0.18227848$. Recalculating with the correct term:\n$$ M_2 \\approx 0.32653061 + 0.29110512 + 0.18227848 \\approx 0.79991421 $$\n\n**3. Arithmetic Mean of the Two Metrics**\n\nFinally, we compute the arithmetic mean of $M_1$ and $M_2$.\n$$\n\\text{Mean} = \\frac{M_1 + M_2}{2}\n$$\nUsing the fractional value for $M_1$ and the high-precision decimal for $M_2$:\n$$\nM_1 = \\frac{2}{3} \\approx 0.66666667\n$$\n$$\n\\text{Mean} \\approx \\frac{0.66666667 + 0.79991421}{2} = \\frac{1.46658088}{2} = 0.73329044\n$$\n\nThe problem requires the final result to be rounded to four significant figures. The calculated value is $0.73329044...$. The first four significant figures are $7$, $3$, $3$, and $2$. The fifth significant digit is $9$, so we round up the fourth digit.\nThe final rounded result is $0.7333$.", "answer": "$$\\boxed{0.7333}$$", "id": "4560065"}]}