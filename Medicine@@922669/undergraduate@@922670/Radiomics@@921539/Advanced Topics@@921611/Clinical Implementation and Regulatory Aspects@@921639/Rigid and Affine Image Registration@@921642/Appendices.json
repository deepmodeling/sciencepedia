{"hands_on_practices": [{"introduction": "Combining simple movements like rotation and translation is the foundation of rigid image registration. A crucial question arises: does the order in which we perform these operations matter? This practice guides you through a direct calculation to explore this question, demonstrating the non-commutative nature of geometric transformations and highlighting why the sequence of operations is a critical detail in any registration algorithm [@problem_id:4559305].", "problem": "In a two-dimensional radiomics registration context, assume a rigid transformation defined by a rotation about the origin and a translation, each represented in homogeneous coordinates. A rigid transformation is a special case of an affine transformation with a rotation matrix that is orthogonal with determinant equal to $1$ and a translation vector. The fundamental base for this problem consists of the following well-tested facts: composition of transformations corresponds to matrix multiplication, and homogeneous coordinates represent affine mappings as linear transformations on augmented vectors.\n\nLet $T_{1}$ be a rotation by angle $\\theta$ around the origin, represented in homogeneous coordinates by the matrix\n$$\nT_{1} \\;=\\;\n\\begin{pmatrix}\n\\cos(\\theta)  -\\sin(\\theta)  0 \\\\\n\\sin(\\theta)  \\cos(\\theta)  0 \\\\\n0  0  1\n\\end{pmatrix},\n$$\nand let $T_{2}$ be a translation by the vector $(t_{x}, t_{y})$, represented by\n$$\nT_{2} \\;=\\;\n\\begin{pmatrix}\n1  0  t_{x} \\\\\n0  1  t_{y} \\\\\n0  0  1\n\\end{pmatrix}.\n$$\nConsider the image point $p = (x_{0}, y_{0})$ as a homogeneous column vector $p_{h} = (x_{0}, y_{0}, 1)^{\\top}$. Using the definitions above, compute the transformed point $p_{12} = T_{1} T_{2} p_{h}$ (which corresponds to applying $T_{2}$ followed by $T_{1}$) and the transformed point $p_{21} = T_{2} T_{1} p_{h}$ (which corresponds to applying $T_{1}$ followed by $T_{2}$) for the specific parameters\n$$\n\\theta = \\frac{\\pi}{4} \\text{ radians}, \\quad t_{x} = 3, \\quad t_{y} = -2, \\quad x_{0} = 1, \\quad y_{0} = 2.\n$$\nThen, compute the squared Euclidean distance\n$$\n\\|p_{12} - p_{21}\\|^{2} \\;=\\; (x_{12} - x_{21})^{2} + (y_{12} - y_{21})^{2},\n$$\nwhere $(x_{12}, y_{12})$ and $(x_{21}, y_{21})$ are the Cartesian components of $p_{12}$ and $p_{21}$, respectively.\n\nExpress your final answer as a single exact real number in simplest radical form. Angles must be treated in radians. No rounding is required. Briefly justify, using the computed values, whether composition is commutative in this case, but the final numerical answer must be the single value of $\\|p_{12} - p_{21}\\|^{2}$.", "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and complete. It describes a standard computation in the field of geometric transformations using homogeneous coordinates, providing all necessary definitions and parameters. No flaws are identified.\n\nThe problem asks for the squared Euclidean distance between two points obtained by applying a rotation and a translation in different orders. A point $p=(x_0, y_0)$ is represented by the homogeneous column vector $p_h = (x_0, y_0, 1)^{\\top}$.\n\nThe given transformations are a rotation $T_1$ and a translation $T_2$.\nThe rotation by an angle $\\theta$ around the origin is given by:\n$$\nT_{1} =\n\\begin{pmatrix}\n\\cos(\\theta)  -\\sin(\\theta)  0 \\\\\n\\sin(\\theta)  \\cos(\\theta)  0 \\\\\n0  0  1\n\\end{pmatrix}\n$$\nThe translation by a vector $(t_x, t_y)$ is given by:\n$$\nT_{2} =\n\\begin{pmatrix}\n1  0  t_{x} \\\\\n0  1  t_{y} \\\\\n0  0  1\n\\end{pmatrix}\n$$\nThe specific parameters are $\\theta = \\frac{\\pi}{4}$ radians, $t_x = 3$, $t_y = -2$, and the point is $p_0 = (1, 2)$, so $p_h = (1, 2, 1)^{\\top}$.\n\nFirst, we substitute the value of $\\theta$ into the rotation matrix $T_1$. We have $\\cos(\\frac{\\pi}{4}) = \\frac{\\sqrt{2}}{2}$ and $\\sin(\\frac{\\pi}{4}) = \\frac{\\sqrt{2}}{2}$.\n$$\nT_{1} =\n\\begin{pmatrix}\n\\frac{\\sqrt{2}}{2}  -\\frac{\\sqrt{2}}{2}  0 \\\\\n\\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2}  0 \\\\\n0  0  1\n\\end{pmatrix}\n$$\nThe translation matrix $T_2$ with the given values is:\n$$\nT_{2} =\n\\begin{pmatrix}\n1  0  3 \\\\\n0  1  -2 \\\\\n0  0  1\n\\end{pmatrix}\n$$\nThe point in homogeneous coordinates is $p_h = \\begin{pmatrix} 1 \\\\ 2 \\\\ 1 \\end{pmatrix}$.\n\nWe need to compute the transformed points $p_{12} = T_1 T_2 p_h$ and $p_{21} = T_2 T_1 p_h$. The order of matrix multiplication is from right to left, so $T_1 T_2 p_h$ means applying $T_2$ first, then $T_1$.\n\nLet's analyze the general form of the transformations on a point with Cartesian coordinates $P_0=(x_0, y_0)$. The transformation $p_{12} = T_1 T_2 p_h$ corresponds to \"translate first, then rotate\". In Cartesian coordinates, this is $P_{12} = R(P_0 + t)$, where $R$ is the $2 \\times 2$ rotation matrix and $t$ is the translation vector $(t_x, t_y)^{\\top}$.\nThe transformation $p_{21} = T_2 T_1 p_h$ corresponds to \"rotate first, then translate\". In Cartesian coordinates, this is $P_{21} = R P_0 + t$.\n\nThe vector difference between the two resulting Cartesian points is:\n$$\nP_{12} - P_{21} = (R(P_0 + t)) - (R P_0 + t) = R P_0 + R t - R P_0 - t = R t - t = (R - I) t\n$$\nwhere $I$ is the $2 \\times 2$ identity matrix. The resulting difference vector is notably independent of the initial point $P_0$.\n\nThe squared Euclidean distance is the squared norm of this difference vector: $\\|(R - I)t\\|^2$.\nLet's compute this quantity.\nThe rotation matrix is $R = \\begin{pmatrix} \\frac{\\sqrt{2}}{2}  -\\frac{\\sqrt{2}}{2} \\\\ \\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2} \\end{pmatrix}$.\nThe translation vector is $t = \\begin{pmatrix} 3 \\\\ -2 \\end{pmatrix}$.\nThe identity matrix is $I = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$.\n\nFirst, calculate the matrix $R - I$:\n$$\nR - I =\n\\begin{pmatrix}\n\\frac{\\sqrt{2}}{2}  -\\frac{\\sqrt{2}}{2} \\\\\n\\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2}\n\\end{pmatrix} -\n\\begin{pmatrix}\n1  0 \\\\\n0  1\n\\end{pmatrix} =\n\\begin{pmatrix}\n\\frac{\\sqrt{2}}{2} - 1  -\\frac{\\sqrt{2}}{2} \\\\\n\\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2} - 1\n\\end{pmatrix}\n$$\nNext, compute the vector $(R-I)t$:\n$$\n(R-I)t =\n\\begin{pmatrix}\n\\frac{\\sqrt{2}}{2} - 1  -\\frac{\\sqrt{2}}{2} \\\\\n\\frac{\\sqrt{2}}{2}  \\frac{\\sqrt{2}}{2} - 1\n\\end{pmatrix}\n\\begin{pmatrix}\n3 \\\\\n-2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n3(\\frac{\\sqrt{2}}{2} - 1) - (-2)(\\frac{\\sqrt{2}}{2}) \\\\\n3(\\frac{\\sqrt{2}}{2}) + (-2)(\\frac{\\sqrt{2}}{2} - 1)\n\\end{pmatrix}\n$$\n$$\n=\n\\begin{pmatrix}\n\\frac{3\\sqrt{2}}{2} - 3 + \\frac{2\\sqrt{2}}{2} \\\\\n\\frac{3\\sqrt{2}}{2} - \\frac{2\\sqrt{2}}{2} + 2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\frac{5\\sqrt{2}}{2} - 3 \\\\\n\\frac{\\sqrt{2}}{2} + 2\n\\end{pmatrix}\n$$\nThis vector represents $(x_{12} - x_{21}, y_{12} - y_{21})^{\\top}$.\n\nFinally, we compute the squared Euclidean distance, which is the sum of the squares of the components of this vector:\n$$\n\\|p_{12} - p_{21}\\|^2 = \\left( \\frac{5\\sqrt{2}}{2} - 3 \\right)^2 + \\left( \\frac{\\sqrt{2}}{2} + 2 \\right)^2\n$$\nWe expand each term:\n$$\n\\left( \\frac{5\\sqrt{2}}{2} - 3 \\right)^2 = \\left(\\frac{5\\sqrt{2}}{2}\\right)^2 - 2 \\left(\\frac{5\\sqrt{2}}{2}\\right)(3) + 3^2 = \\frac{25 \\cdot 2}{4} - 15\\sqrt{2} + 9 = \\frac{50}{4} - 15\\sqrt{2} + 9 = \\frac{25}{2} + 9 - 15\\sqrt{2} = \\frac{43}{2} - 15\\sqrt{2}\n$$\n$$\n\\left( \\frac{\\sqrt{2}}{2} + 2 \\right)^2 = \\left(\\frac{\\sqrt{2}}{2}\\right)^2 + 2 \\left(\\frac{\\sqrt{2}}{2}\\right)(2) + 2^2 = \\frac{2}{4} + 2\\sqrt{2} + 4 = \\frac{1}{2} + 4 + 2\\sqrt{2} = \\frac{9}{2} + 2\\sqrt{2}\n$$\nSumming the two results:\n$$\n\\|p_{12} - p_{21}\\|^2 = \\left( \\frac{43}{2} - 15\\sqrt{2} \\right) + \\left( \\frac{9}{2} + 2\\sqrt{2} \\right) = \\frac{43+9}{2} + (-15+2)\\sqrt{2} = \\frac{52}{2} - 13\\sqrt{2} = 26 - 13\\sqrt{2}\n$$\nThe squared Euclidean distance is $26 - 13\\sqrt{2}$.\n\nRegarding the commutativity of the composition: Since $\\|p_{12} - p_{21}\\|^2 = 26 - 13\\sqrt{2} \\approx 26 - 13(1.414) = 7.618 \\neq 0$, the points $p_{12}$ and $p_{21}$ are not the same. This demonstrates that $T_1 T_2 p_h \\neq T_2 T_1 p_h$ for the given point $p_h$. Therefore, the composition of these specific rotation and translation transformations is not commutative. In general, composition of a rotation and a translation is only commutative if the translation vector is zero or the rotation is an identity transformation.", "answer": "$$\\boxed{26 - 13\\sqrt{2}}$$", "id": "4559305"}, {"introduction": "Image registration models can be broadly categorized, with rigid and affine transforms being two of the most fundamental types. While a rigid transformation models the movement of a solid, unchangeable object, an affine transformation allows for more complex changes like stretching and shearing. This exercise makes this abstract distinction concrete by tasking you with proving that a rigid transform cannot turn a sphere into an ellipsoid, while a specific affine transform can, thereby clarifying the unique geometric power and limitations of each model [@problem_id:4559313].", "problem": "In a three-dimensional radiomics registration scenario, consider a segmented lesion whose true shape in the source image can be modeled as a sphere of radius $r$ centered at the origin, given by the set $S_{r} = \\{ \\mathbf{x} \\in \\mathbb{R}^{3} : \\| \\mathbf{x} \\|_{2} = r \\}$. A rigid transformation is defined as $\\mathcal{R}(\\mathbf{x}) = \\mathbf{R}\\mathbf{x} + \\mathbf{t}$, where $\\mathbf{R} \\in \\mathbb{R}^{3 \\times 3}$ satisfies $\\mathbf{R}^{\\top}\\mathbf{R} = \\mathbf{I}$ and $\\det(\\mathbf{R}) = \\pm 1$, and an affine transformation is defined as $\\mathcal{A}(\\mathbf{x}) = \\mathbf{A}\\mathbf{x} + \\mathbf{b}$ with $\\mathbf{A} \\in \\mathbb{R}^{3 \\times 3}$ invertible. In the context of aligning a target image that exhibits anisotropic voxel scaling, you are asked to construct a counterexample that separates the representational power of affine registration from rigid registration.\n\nPerform the following:\n\n1. Using only the core definitions above and the Euclidean norm properties, take the specific anisotropic linear map $\\mathbf{A} = \\mathrm{diag}(2, 1, 1)$ and translation $\\mathbf{b} = \\mathbf{0}$. Derive the implicit quadratic form satisfied by $\\mathbf{y} = \\mathcal{A}(\\mathbf{x})$ with $\\mathbf{x} \\in S_{r}$, and show that the image is an ellipsoid whose principal semi-axes are aligned with the coordinate axes.\n\n2. Using only the length-preserving property of rigid transformations, give a contradiction-based argument that no rigid transformation can map $S_{r}$ onto the ellipsoid you obtained in part $1$.\n\n3. Consider the planar cross-section of the ellipsoid from part $1$ at $z = 0$, which is an ellipse in the $x$â€“$y$ plane. Compute the eccentricity $e$ of this ellipse, defined by $e = \\sqrt{1 - \\frac{b^{2}}{a^{2}}}$ where $a$ and $b$ are the semi-major and semi-minor axes of the ellipse, respectively. Express your final answer as an exact expression with no rounding and no units. Provide only the value of $e$ as your final answer.", "solution": "The problem statement is a valid exercise in linear algebra and geometry, demonstrating the difference in representational capacity between rigid and affine transformations, a fundamental concept in image registration. The definitions provided are standard, and the tasks are well-posed and mathematically sound. We shall proceed with a rigorous, step-by-step solution.\n\nThe problem defines a source object as a sphere $S_r$ of radius $r$ centered at the origin, given by the set of points $\\mathbf{x} = (x_1, x_2, x_3)^{\\top} \\in \\mathbb{R}^{3}$ such that its squared Euclidean norm is constant:\n$$\n\\|\\mathbf{x}\\|_{2}^{2} = x_1^{2} + x_2^{2} + x_3^{2} = r^{2}\n$$\n\n**Part 1: Derivation of the Affine-Transformed Shape**\n\nWe are given a specific affine transformation $\\mathcal{A}(\\mathbf{x}) = \\mathbf{A}\\mathbf{x} + \\mathbf{b}$ with the linear map $\\mathbf{A} = \\mathrm{diag}(2, 1, 1)$ and the translation vector $\\mathbf{b} = \\mathbf{0}$. Let $\\mathbf{y} = (y_1, y_2, y_3)^{\\top}$ be a point in the transformed set, such that $\\mathbf{y} = \\mathcal{A}(\\mathbf{x})$ for some $\\mathbf{x} \\in S_r$. With $\\mathbf{b} = \\mathbf{0}$, this simplifies to $\\mathbf{y} = \\mathbf{A}\\mathbf{x}$.\n\nSince the matrix $\\mathbf{A}$ is given as:\n$$\n\\mathbf{A} = \\begin{pmatrix} 2  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\nthe relationship between the components of $\\mathbf{y}$ and $\\mathbf{x}$ is:\n$$\ny_1 = 2x_1, \\quad y_2 = x_2, \\quad y_3 = x_3\n$$\nTo find the implicit equation satisfied by the components of $\\mathbf{y}$, we must express the components of $\\mathbf{x}$ in terms of the components of $\\mathbf{y}$ and substitute them into the equation of the sphere $S_r$. The matrix $\\mathbf{A}$ is invertible, and its inverse is $\\mathbf{A}^{-1} = \\mathrm{diag}(1/2, 1, 1)$. Thus, $\\mathbf{x} = \\mathbf{A}^{-1}\\mathbf{y}$, which gives:\n$$\nx_1 = \\frac{1}{2}y_1, \\quad x_2 = y_2, \\quad x_3 = y_3\n$$\nSubstituting these expressions into the sphere equation $x_1^{2} + x_2^{2} + x_3^{2} = r^{2}$, we obtain the equation for the transformed surface:\n$$\n\\left(\\frac{y_1}{2}\\right)^{2} + (y_2)^{2} + (y_3)^{2} = r^{2}\n$$\nThis simplifies to:\n$$\n\\frac{y_1^{2}}{4} + y_2^{2} + y_3^{2} = r^{2}\n$$\nTo express this in the standard form of a quadric surface, we divide by $r^{2}$ (assuming $r  0$, which is implicit for a sphere of non-zero radius):\n$$\n\\frac{y_1^{2}}{4r^{2}} + \\frac{y_2^{2}}{r^{2}} + \\frac{y_3^{2}}{r^{2}} = 1\n$$\nThis can be rewritten as:\n$$\n\\frac{y_1^{2}}{(2r)^{2}} + \\frac{y_2^{2}}{r^{2}} + \\frac{y_3^{2}}{r^{2}} = 1\n$$\nThis is the implicit quadratic form defining an ellipsoid centered at the origin. The equation contains only squared terms of $y_1$, $y_2$, and $y_3$, meaning there are no cross-product terms (e.g., $y_1y_2$). This indicates that the principal axes of the ellipsoid are aligned with the coordinate axes. The lengths of the principal semi-axes are given by the square roots of the denominators, which are $2r$, $r$, and $r$.\n\n**Part 2: Contradiction Argument for Rigid Transformation Infeasibility**\n\nA rigid transformation $\\mathcal{R}(\\mathbf{x}) = \\mathbf{R}\\mathbf{x} + \\mathbf{t}$ is defined by the property that the matrix $\\mathbf{R}$ is orthogonal, i.e., $\\mathbf{R}^{\\top}\\mathbf{R} = \\mathbf{I}$. A fundamental property of such transformations is that they are isometries, meaning they preserve the Euclidean distance between any two points. For any $\\mathbf{p}, \\mathbf{q} \\in \\mathbb{R}^{3}$:\n$$\n\\|\\mathcal{R}(\\mathbf{p}) - \\mathcal{R}(\\mathbf{q})\\|_{2} = \\|(\\mathbf{R}\\mathbf{p} + \\mathbf{t}) - (\\mathbf{R}\\mathbf{q} + \\mathbf{t})\\|_{2} = \\|\\mathbf{R}(\\mathbf{p} - \\mathbf{q})\\|_{2} = \\sqrt{(\\mathbf{p} - \\mathbf{q})^{\\top}\\mathbf{R}^{\\top}\\mathbf{R}(\\mathbf{p} - \\mathbf{q})} = \\sqrt{(\\mathbf{p} - \\mathbf{q})^{\\top}\\mathbf{I}(\\mathbf{p} - \\mathbf{q})} = \\|\\mathbf{p} - \\mathbf{q}\\|_{2}\n$$\nThis shows that distance is preserved. We will use this length-preserving property to formulate a proof by contradiction.\n\nAssume, for the sake of contradiction, that there exists a rigid transformation $\\mathcal{R}$ that maps the sphere $S_r$ onto the ellipsoid $E$ derived in Part 1.\nLet $\\mathbf{x}$ be any point on the sphere $S_r$. The distance from $\\mathbf{x}$ to the center of the sphere (the origin $\\mathbf{0}$) is $\\|\\mathbf{x} - \\mathbf{0}\\|_{2} = r$.\nLet $\\mathbf{y} = \\mathcal{R}(\\mathbf{x})$ be the corresponding point on the ellipsoid $E$. The center of the sphere $\\mathbf{0}$ is mapped to the point $\\mathbf{c} = \\mathcal{R}(\\mathbf{0}) = \\mathbf{R}\\mathbf{0} + \\mathbf{t} = \\mathbf{t}$.\nBecause $\\mathcal{R}$ is an isometry, the distance between the transformed point $\\mathbf{y}$ and the transformed center $\\mathbf{c}$ must be the same as the distance between the original point $\\mathbf{x}$ and the original center $\\mathbf{0}$.\n$$\n\\|\\mathbf{y} - \\mathbf{c}\\|_{2} = \\|\\mathcal{R}(\\mathbf{x}) - \\mathcal{R}(\\mathbf{0})\\|_{2} = \\|\\mathbf{x} - \\mathbf{0}\\|_{2} = r\n$$\nThis equality must hold for every point $\\mathbf{y}$ on the ellipsoid $E$. The equation $\\|\\mathbf{y} - \\mathbf{c}\\|_{2} = r$ is the definition of a sphere of radius $r$ centered at $\\mathbf{c}$. Therefore, the assumption that a rigid transformation maps $S_r$ to $E$ implies that $E$ must be a sphere of radius $r$.\n\nHowever, from Part 1, we determined that $E$ is an ellipsoid with principal semi-axes of lengths $2r$, $r$, and $r$. A surface is a sphere if and only if all its principal semi-axes are equal. In our case, since $r  0$, we have $2r \\neq r$. Thus, the ellipsoid $E$ is not a sphere.\n\nThis leads to a contradiction: our assumption implies that $E$ must be a sphere, but the properties of $E$ show it is not a sphere. Consequently, the initial assumption must be false. No rigid transformation can map the sphere $S_r$ onto the ellipsoid $E$.\n\n**Part 3: Calculation of Eccentricity**\n\nWe are asked to compute the eccentricity of the planar cross-section of the ellipsoid at $z = 0$. In our coordinate system, this corresponds to setting $y_3 = 0$. Using the ellipsoid equation from Part 1:\n$$\n\\frac{y_1^{2}}{(2r)^{2}} + \\frac{y_2^{2}}{r^{2}} + \\frac{y_3^{2}}{r^{2}} = 1\n$$\nSetting $y_3=0$ yields the equation of the cross-section in the $y_1$-$y_2$ plane:\n$$\n\\frac{y_1^{2}}{(2r)^{2}} + \\frac{y_2^{2}}{r^{2}} = 1\n$$\nThis is the standard equation of an ellipse centered at the origin. The semi-axes are the square roots of the denominators.\nThe semi-axis along the $y_1$-axis is $\\sqrt{(2r)^{2}} = 2r$.\nThe semi-axis along the $y_2$-axis is $\\sqrt{r^{2}} = r$.\n\nThe semi-major axis, denoted by $a$, is the larger of the two, and the semi-minor axis, denoted by $b$, is the smaller. Since $r  0$, we have $2r  r$. Therefore:\n- Semi-major axis: $a = 2r$\n- Semi-minor axis: $b = r$\n\nThe eccentricity $e$ of an ellipse is given by the formula $e = \\sqrt{1 - \\frac{b^{2}}{a^{2}}}$. Substituting the values of $a$ and $b$:\n$$\ne = \\sqrt{1 - \\frac{r^{2}}{(2r)^{2}}} = \\sqrt{1 - \\frac{r^{2}}{4r^{2}}}\n$$\nThe term $r^{2}$ cancels out from the fraction:\n$$\ne = \\sqrt{1 - \\frac{1}{4}} = \\sqrt{\\frac{3}{4}}\n$$\nSimplifying the expression gives the final exact value for the eccentricity:\n$$\ne = \\frac{\\sqrt{3}}{2}\n$$", "answer": "$$\\boxed{\\frac{\\sqrt{3}}{2}}$$", "id": "4559313"}, {"introduction": "Digital images exist in two distinct coordinate systems: the grid-like index space of voxels and the real-world physical space measured in units like millimeters. Applying geometric operations directly in index space without accounting for physical voxel dimensions can lead to significant errors, especially in medical images with anisotropic voxels. This practice addresses this critical, real-world challenge by having you quantify the distortion from a naive rotation and derive the mathematically correct transformation matrix that ensures geometric fidelity in physical space [@problem_id:4559278].", "problem": "In radiomics workflows, rigid and affine image registration must respect the Euclidean geometry of physical space, not the implicit grid of voxel indices. Consider a three-dimensional image volume with anisotropic voxel spacings along the coordinate axes given by $s_{x}$, $s_{y}$, and $s_{z}$ (in millimeters). Index-space coordinates are denoted by $\\mathbf{i} \\in \\mathbb{R}^{3}$, and physical-space coordinates are given by $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$, where $\\mathbf{S} = \\mathrm{diag}(s_{x}, s_{y}, s_{z})$. Suppose one wishes to apply a rigid rotation by an angle $\\theta$ about the $z$-axis in physical space.\n\nA naive implementation applies the rotation matrix $\\mathbf{R}_{z}(\\theta)$ directly in index space, mapping $\\mathbf{i} \\mapsto \\mathbf{R}_{z}(\\theta)\\,\\mathbf{i}$, and then converts to physical space. In contrast, a correct implementation applies the rotation in physical space, or equivalently composes a corrected index-space affine transform that is consistent with the physical rotation.\n\nUsing only the definitions of the Euclidean norm in physical space, the index-to-physical mapping $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$, and the property that rigid rotations in physical space preserve Euclidean lengths, do the following:\n\n1. For the index-space unit vector $\\mathbf{v} = (1, 0, 0)^{\\top}$ and a rotation by angle $\\theta$ about the $z$-axis, derive from first principles the expression for the ratio $r(\\theta)$ of the physical-space length of the naively transformed vector to the original physical-space length. Your derivation must start from $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$ and the Euclidean norm, and must not assume any specialized formula beyond those definitions.\n\n2. Derive the corrected index-space linear transformation matrix $\\mathbf{M}$ that, when applied to index coordinates as $\\mathbf{i} \\mapsto \\mathbf{M}\\,\\mathbf{i}$, yields the same physical-space effect as applying $\\mathbf{R}_{z}(\\theta)$ in physical space. Show from the definitions that this corrected transformation preserves the physical length of $\\mathbf{v}$.\n\n3. Evaluate the distortion magnitude $d = r(\\theta) - 1$ for $s_{x} = 0.8$ millimeters, $s_{y} = 2.0$ millimeters, and $\\theta = 30$ degrees. Express the final answer as a dimensionless number and round your answer to four significant figures. State the angle in degrees as specified; no conversion is required in your final numeric evaluation.", "solution": "The problem is validated as scientifically grounded, well-posed, objective, and complete. All necessary data and definitions for the required derivations and calculations are provided. The concepts are fundamental to medical image analysis and linear algebra.\n\nThe solution is presented in three parts as requested by the problem statement.\n\n### Part 1: Derivation of the Ratio $r(\\theta)$\n\nLet the index-space coordinates be $\\mathbf{i} = (i_x, i_y, i_z)^{\\top}$ and the physical-space coordinates be $\\mathbf{x} = (x, y, z)^{\\top}$. The mapping between them is given by $\\mathbf{x} = \\mathbf{S}\\,\\mathbf{i}$, where $\\mathbf{S}$ is the diagonal scaling matrix $\\mathbf{S} = \\mathrm{diag}(s_{x}, s_{y}, s_{z})$. The Euclidean norm of a vector $\\mathbf{u} = (u_1, u_2, u_3)^{\\top}$ is $\\|\\mathbf{u}\\| = \\sqrt{u_1^2 + u_2^2 + u_3^2}$.\n\nThe initial index-space vector is given as $\\mathbf{i}_{\\text{orig}} = \\mathbf{v} = (1, 0, 0)^{\\top}$.\nThe corresponding original physical-space vector, $\\mathbf{x}_{\\text{orig}}$, is found by applying the scaling matrix $\\mathbf{S}$:\n$$\n\\mathbf{x}_{\\text{orig}} = \\mathbf{S}\\,\\mathbf{i}_{\\text{orig}} = \\begin{pmatrix} s_x  0  0 \\\\ 0  s_y  0 \\\\ 0  0  s_z \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} s_x \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThe physical-space length (Euclidean norm) of this original vector is:\n$$\n\\|\\mathbf{x}_{\\text{orig}}\\| = \\sqrt{s_x^2 + 0^2 + 0^2} = s_x\n$$\n(We assume $s_x  0$ as it represents a physical spacing).\n\nThe naive implementation applies the rotation directly in index space. The rotation matrix for an angle $\\theta$ about the $z$-axis is:\n$$\n\\mathbf{R}_{z}(\\theta) = \\begin{pmatrix} \\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\nThe naively transformed index-space vector, $\\mathbf{i}_{\\text{naive}}$, is:\n$$\n\\mathbf{i}_{\\text{naive}} = \\mathbf{R}_{z}(\\theta)\\,\\mathbf{i}_{\\text{orig}} = \\begin{pmatrix} \\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\\\ 0 \\end{pmatrix}\n$$\nThis naively transformed index-space vector is then converted to physical space to get $\\mathbf{x}_{\\text{naive}}$:\n$$\n\\mathbf{x}_{\\text{naive}} = \\mathbf{S}\\,\\mathbf{i}_{\\text{naive}} = \\begin{pmatrix} s_x  0  0 \\\\ 0  s_y  0 \\\\ 0  0  s_z \\end{pmatrix} \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} s_x \\cos\\theta \\\\ s_y \\sin\\theta \\\\ 0 \\end{pmatrix}\n$$\nThe physical-space length of this naively transformed vector is:\n$$\n\\|\\mathbf{x}_{\\text{naive}}\\| = \\sqrt{(s_x \\cos\\theta)^2 + (s_y \\sin\\theta)^2 + 0^2} = \\sqrt{s_x^2 \\cos^2\\theta + s_y^2 \\sin^2\\theta}\n$$\nThe ratio $r(\\theta)$ is the physical-space length of the naively transformed vector divided by the original physical-space length:\n$$\nr(\\theta) = \\frac{\\|\\mathbf{x}_{\\text{naive}}\\|}{\\|\\mathbf{x}_{\\text{orig}}\\|} = \\frac{\\sqrt{s_x^2 \\cos^2\\theta + s_y^2 \\sin^2\\theta}}{s_x}\n$$\nThis can be simplified to:\n$$\nr(\\theta) = \\sqrt{\\frac{s_x^2 \\cos^2\\theta + s_y^2 \\sin^2\\theta}{s_x^2}} = \\sqrt{\\cos^2\\theta + \\left(\\frac{s_y}{s_x}\\right)^2 \\sin^2\\theta}\n$$\n\n### Part 2: Derivation of the Corrected Transformation Matrix $\\mathbf{M}$\n\nA correct implementation applies the rotation in physical space. Let $\\mathbf{x}$ be a physical-space vector corresponding to an index-space vector $\\mathbf{i}$ (so $\\mathbf{x} = \\mathbf{S}\\mathbf{i}$). The correctly rotated physical-space vector, $\\mathbf{x}_{\\text{corr}}$, is:\n$$\n\\mathbf{x}_{\\text{corr}} = \\mathbf{R}_{z}(\\theta)\\,\\mathbf{x} = \\mathbf{R}_{z}(\\theta)(\\mathbf{S}\\mathbf{i})\n$$\nWe seek a corrected index-space transformation matrix $\\mathbf{M}$ such that the new index-space vector $\\mathbf{i}_{\\text{corr}} = \\mathbf{M}\\mathbf{i}$ maps to the correctly rotated physical vector $\\mathbf{x}_{\\text{corr}}$. That is, $\\mathbf{x}_{\\text{corr}} = \\mathbf{S}\\mathbf{i}_{\\text{corr}} = \\mathbf{S}(\\mathbf{M}\\mathbf{i})$.\n\nEquating the two expressions for $\\mathbf{x}_{\\text{corr}}$:\n$$\n\\mathbf{S}\\mathbf{M}\\mathbf{i} = \\mathbf{R}_{z}(\\theta)\\mathbf{S}\\mathbf{i}\n$$\nSince this must hold for any vector $\\mathbf{i}$, we can equate the matrices:\n$$\n\\mathbf{S}\\mathbf{M} = \\mathbf{R}_{z}(\\theta)\\mathbf{S}\n$$\nTo solve for $\\mathbf{M}$, we multiply from the left by the inverse of $\\mathbf{S}$. Since $\\mathbf{S}$ is a diagonal matrix with non-zero entries (physical spacings), its inverse is $\\mathbf{S}^{-1} = \\mathrm{diag}(1/s_x, 1/s_y, 1/s_z)$.\n$$\n\\mathbf{M} = \\mathbf{S}^{-1}\\mathbf{R}_{z}(\\theta)\\mathbf{S}\n$$\nWe now compute this product explicitly:\n$$\n\\mathbf{M} = \\begin{pmatrix} \\frac{1}{s_x}  0  0 \\\\ 0  \\frac{1}{s_y}  0 \\\\ 0  0  \\frac{1}{s_z} \\end{pmatrix} \\left[ \\begin{pmatrix} \\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} s_x  0  0 \\\\ 0  s_y  0 \\\\ 0  0  s_z \\end{pmatrix} \\right]\n$$\n$$\n\\mathbf{M} = \\begin{pmatrix} \\frac{1}{s_x}  0  0 \\\\ 0  \\frac{1}{s_y}  0 \\\\ 0  0  \\frac{1}{s_z} \\end{pmatrix} \\begin{pmatrix} s_x \\cos\\theta  -s_y \\sin\\theta  0 \\\\ s_x \\sin\\theta  s_y \\cos\\theta  0 \\\\ 0  0  s_z \\end{pmatrix}\n$$\n$$\n\\mathbf{M} = \\begin{pmatrix} \\cos\\theta  -\\frac{s_y}{s_x}\\sin\\theta  0 \\\\ \\frac{s_x}{s_y}\\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{pmatrix}\n$$\nThis is the corrected index-space linear transformation matrix.\n\nTo show that this transformation preserves the physical length of $\\mathbf{v}$, we consider the length of the physical vector after the corrected transformation. The original physical vector is $\\mathbf{x}_{\\text{orig}} = \\mathbf{S}\\mathbf{v}$. Its length is $\\|\\mathbf{S}\\mathbf{v}\\|$. The transformed physical vector is $\\mathbf{x}_{\\text{corr}} = \\mathbf{S}(\\mathbf{M}\\mathbf{v})$. From our derivation, we know $\\mathbf{S}\\mathbf{M} = \\mathbf{R}_z(\\theta)\\mathbf{S}$, so we can write:\n$$\n\\mathbf{x}_{\\text{corr}} = (\\mathbf{S}\\mathbf{M})\\mathbf{v} = (\\mathbf{R}_z(\\theta)\\mathbf{S})\\mathbf{v} = \\mathbf{R}_z(\\theta)(\\mathbf{S}\\mathbf{v}) = \\mathbf{R}_z(\\theta)\\mathbf{x}_{\\text{orig}}\n$$\nWe are given that rigid rotations in physical space preserve Euclidean lengths. The mapping from $\\mathbf{x}_{\\text{orig}}$ to $\\mathbf{x}_{\\text{corr}}$ is precisely the rigid rotation $\\mathbf{R}_z(\\theta)$ applied in physical space. Therefore, by the premise of the problem:\n$$\n\\|\\mathbf{x}_{\\text{corr}}\\| = \\|\\mathbf{R}_z(\\theta)\\mathbf{x}_{\\text{orig}}\\| = \\|\\mathbf{x}_{\\text{orig}}\\|\n$$\nThis confirms that the corrected transformation preserves the physical length of the vector.\n\n### Part 3: Evaluation of Distortion Magnitude $d$\n\nThe distortion magnitude is defined as $d = r(\\theta) - 1$. Using the expression for $r(\\theta)$ from Part 1:\n$$\nd = \\sqrt{\\cos^2\\theta + \\left(\\frac{s_y}{s_x}\\right)^2 \\sin^2\\theta} - 1\n$$\nWe are given the values $s_x = 0.8$, $s_y = 2.0$, and $\\theta = 30^\\circ$.\nFirst, we compute the ratio of voxel spacings:\n$$\n\\frac{s_y}{s_x} = \\frac{2.0}{0.8} = 2.5\n$$\nThe trigonometric function values for $\\theta = 30^\\circ$ are:\n$$\n\\cos(30^\\circ) = \\frac{\\sqrt{3}}{2}, \\quad \\sin(30^\\circ) = \\frac{1}{2}\n$$\nTheir squares are:\n$$\n\\cos^2(30^\\circ) = \\frac{3}{4} = 0.75\n$$\n$$\n\\sin^2(30^\\circ) = \\frac{1}{4} = 0.25\n$$\nSubstituting these values into the expression for $d$:\n$$\nd = \\sqrt{0.75 + (2.5)^2 (0.25)} - 1\n$$\n$$\nd = \\sqrt{0.75 + (6.25)(0.25)} - 1\n$$\n$$\nd = \\sqrt{0.75 + 1.5625} - 1\n$$\n$$\nd = \\sqrt{2.3125} - 1\n$$\nCalculating the numerical value:\n$$\n\\sqrt{2.3125} \\approx 1.5206906...\n$$\n$$\nd \\approx 1.5206906 - 1 = 0.5206906...\n$$\nRounding the final answer to four significant figures, we get:\n$$\nd \\approx 0.5207\n$$\nThe dimensionless distortion magnitude is approximately $0.5207$, which corresponds to a length increase of about $52.07\\%$.", "answer": "$$\\boxed{0.5207}$$", "id": "4559278"}]}