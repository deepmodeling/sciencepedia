{"hands_on_practices": [{"introduction": "The first step in any systems pharmacology analysis is translating complex biological pathways into a structured, mathematical format that computers can understand. This foundational exercise guides you through representing a drug metabolism pathway as two fundamental network structures: a directed graph showing substrate-product relationships and a stoichiometric matrix that precisely captures the mass-balance of each reaction. Mastering this translation is a crucial skill for applying the powerful tools of network theory to biological systems [@problem_id:4594957].", "problem": "A hypothetical xenobiotic drug $X$ undergoes biotransformation in a hepatocyte under the influence of endogenous cofactors commonly encountered in clinical pharmacology. Consider the species set $\\{D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH}\\}$, where $D$ denotes the parent drug, $M_{1}$ a primary metabolite, $M_{2}$ a conjugate metabolite, Nicotinamide Adenine Dinucleotide Phosphate (reduced) ($\\mathrm{NADPH}$), Nicotinamide Adenine Dinucleotide Phosphate (oxidized) ($\\mathrm{NADP}^{+}$), and glutathione ($\\mathrm{GSH}$). The pathway is given by the following reaction stoichiometries:\n$$\nR_{1}:\\quad D + \\mathrm{NADPH} \\longrightarrow M_{1} + \\mathrm{NADP}^{+},\n$$\n$$\nR_{2}:\\quad M_{1} + \\mathrm{GSH} \\longrightarrow M_{2},\n$$\n$$\nR_{3}:\\quad M_{2} \\longrightarrow M_{1},\n$$\n$$\nR_{4}:\\quad M_{1} \\longrightarrow D.\n$$\nModel the pathway as:\n- A directed graph on the species, with a directed edge from a reactant species to a product species whenever a reaction uses the reactant to produce the product.\n- A reaction hypergraph whose incidence is given by the stoichiometric mapping from species to reactions, with negative entries for reactants and positive entries for products, and zeros otherwise.\n\nTasks:\n- Derive the directed graph adjacency matrix $A \\in \\mathbb{R}^{6 \\times 6}$ with the species ordered as $(D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH})$.\n- Derive the stoichiometric incidence matrix $S \\in \\mathbb{R}^{6 \\times 4}$ with reactions ordered as $(R_{1}, R_{2}, R_{3}, R_{4})$ and the same species row order as above.\n- Compute the rank of the stoichiometric incidence matrix $S$.\n\nExpress your final answer as a single integer. No rounding is required, and no units are needed.", "solution": "We begin from foundational network definitions and stoichiometric bookkeeping used in systems pharmacology. A biochemical reaction is represented by stoichiometric coefficients that count how many molecules of each species are consumed or produced per reaction event. For each reaction, we assign a negative coefficient to each reactant and a positive coefficient to each product. The stoichiometric incidence matrix $S$ has rows indexed by species and columns indexed by reactions, with entries equal to these signed stoichiometric coefficients.\n\nSeparately, the directed graph on species has an adjacency matrix $A$ whose entry $A_{ij}$ is $1$ if there exists at least one reaction in which species $i$ is a reactant and species $j$ is a product, and $0$ otherwise. This constructs the substrate–product graph, often used to analyze reachability and connectivity among molecular entities.\n\nStep 1: Construct the directed graph adjacency matrix $A$.\n\nWe list the ordered species: $(D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH})$ and examine each reaction to identify directed edges from reactants to products.\n\n- Reaction $R_{1}: D + \\mathrm{NADPH} \\longrightarrow M_{1} + \\mathrm{NADP}^{+}$ yields the edges:\n  - $D \\rightarrow M_{1}$,\n  - $D \\rightarrow \\mathrm{NADP}^{+}$,\n  - $\\mathrm{NADPH} \\rightarrow M_{1}$,\n  - $\\mathrm{NADPH} \\rightarrow \\mathrm{NADP}^{+}$.\n- Reaction $R_{2}: M_{1} + \\mathrm{GSH} \\longrightarrow M_{2}$ yields the edges:\n  - $M_{1} \\rightarrow M_{2}$,\n  - $\\mathrm{GSH} \\rightarrow M_{2}$.\n- Reaction $R_{3}: M_{2} \\longrightarrow M_{1}$ yields the edge:\n  - $M_{2} \\rightarrow M_{1}$.\n- Reaction $R_{4}: M_{1} \\longrightarrow D$ yields the edge:\n  - $M_{1} \\rightarrow D$.\n\nNo other edges exist. Therefore, row by row (source to targets) in the order $(D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH})$, we fill $A$:\n\n- Row $D$: edges to $M_{1}$ and $\\mathrm{NADP}^{+}$, so\n  $$\n  [0,\\,1,\\,0,\\,0,\\,1,\\,0].\n  $$\n- Row $M_{1}$: edges to $M_{2}$ and $D$, so\n  $$\n  [1,\\,0,\\,1,\\,0,\\,0,\\,0].\n  $$\n- Row $M_{2}$: edge to $M_{1}$, so\n  $$\n  [0,\\,1,\\,0,\\,0,\\,0,\\,0].\n  $$\n- Row $\\mathrm{NADPH}$: edges to $M_{1}$ and $\\mathrm{NADP}^{+}$, so\n  $$\n  [0,\\,1,\\,0,\\,0,\\,1,\\,0].\n  $$\n- Row $\\mathrm{NADP}^{+}$: no outgoing edges, so\n  $$\n  [0,\\,0,\\,0,\\,0,\\,0,\\,0].\n  $$\n- Row $\\mathrm{GSH}$: edge to $M_{2}$, so\n  $$\n  [0,\\,0,\\,1,\\,0,\\,0,\\,0].\n  $$\n\nThus,\n$$\nA = \\begin{pmatrix}\n0 & 1 & 0 & 0 & 1 & 0 \\\\\n1 & 0 & 1 & 0 & 0 & 0 \\\\\n0 & 1 & 0 & 0 & 0 & 0 \\\\\n0 & 1 & 0 & 0 & 1 & 0 \\\\\n0 & 0 & 0 & 0 & 0 & 0 \\\\\n0 & 0 & 1 & 0 & 0 & 0\n\\end{pmatrix}.\n$$\n\nStep 2: Construct the stoichiometric incidence matrix $S$.\n\nWe assign rows in the order $(D, M_{1}, M_{2}, \\mathrm{NADPH}, \\mathrm{NADP}^{+}, \\mathrm{GSH})$ and columns $(R_{1}, R_{2}, R_{3}, R_{4})$.\n\n- For $R_{1}: D + \\mathrm{NADPH} \\longrightarrow M_{1} + \\mathrm{NADP}^{+}$:\n  - $D$: $-1$,\n  - $M_{1}$: $+1$,\n  - $M_{2}$: $0$,\n  - $\\mathrm{NADPH}$: $-1$,\n  - $\\mathrm{NADP}^{+}$: $+1$,\n  - $\\mathrm{GSH}$: $0$.\n\nSo the first column is\n$$\n\\begin{pmatrix}\n-1 \\\\ 1 \\\\ 0 \\\\ -1 \\\\ 1 \\\\ 0\n\\end{pmatrix}.\n$$\n\n- For $R_{2}: M_{1} + \\mathrm{GSH} \\longrightarrow M_{2}$:\n  - $D$: $0$,\n  - $M_{1}$: $-1$,\n  - $M_{2}$: $+1$,\n  - $\\mathrm{NADPH}$: $0$,\n  - $\\mathrm{NADP}^{+}$: $0$,\n  - $\\mathrm{GSH}$: $-1$.\n\nSo the second column is\n$$\n\\begin{pmatrix}\n0 \\\\ -1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ -1\n\\end{pmatrix}.\n$$\n\n- For $R_{3}: M_{2} \\longrightarrow M_{1}$:\n  - $D$: $0$,\n  - $M_{1}$: $+1$,\n  - $M_{2}$: $-1$,\n  - $\\mathrm{NADPH}$: $0$,\n  - $\\mathrm{NADP}^{+}$: $0$,\n  - $\\mathrm{GSH}$: $0$.\n\nSo the third column is\n$$\n\\begin{pmatrix}\n0 \\\\ 1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0\n\\end{pmatrix}.\n$$\n\n- For $R_{4}: M_{1} \\longrightarrow D$:\n  - $D$: $+1$,\n  - $M_{1}$: $-1$,\n  - $M_{2}$: $0$,\n  - $\\mathrm{NADPH}$: $0$,\n  - $\\mathrm{NADP}^{+}$: $0$,\n  - $\\mathrm{GSH}$: $0$.\n\nSo the fourth column is\n$$\n\\begin{pmatrix}\n1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0\n\\end{pmatrix}.\n$$\n\nCollecting columns, we have\n$$\nS = \\begin{pmatrix}\n-1 & 0 & 0 & 1 \\\\\n1 & -1 & 1 & -1 \\\\\n0 & 1 & -1 & 0 \\\\\n-1 & 0 & 0 & 0 \\\\\n1 & 0 & 0 & 0 \\\\\n0 & -1 & 0 & 0\n\\end{pmatrix}.\n$$\n\nStep 3: Compute the rank of $S$.\n\nSince $S \\in \\mathbb{R}^{6 \\times 4}$, the rank is at most $4$. To decide whether all $4$ columns are linearly independent, we test whether a linear combination $\\alpha \\mathbf{c}_{1} + \\beta \\mathbf{c}_{2} + \\gamma \\mathbf{c}_{3} + \\delta \\mathbf{c}_{4} = \\mathbf{0}$ forces $\\alpha = \\beta = \\gamma = \\delta = 0$, where $\\mathbf{c}_{k}$ denotes the $k$-th column of $S$.\n\nWrite the columns explicitly:\n$$\n\\mathbf{c}_{1} = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\\\ -1 \\\\ 1 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{c}_{2} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ -1 \\end{pmatrix},\\quad\n\\mathbf{c}_{3} = \\begin{pmatrix} 0 \\\\ 1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix},\\quad\n\\mathbf{c}_{4} = \\begin{pmatrix} 1 \\\\ -1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n\nSet $\\alpha \\mathbf{c}_{1} + \\beta \\mathbf{c}_{2} + \\gamma \\mathbf{c}_{3} + \\delta \\mathbf{c}_{4} = \\mathbf{0}$ and equate rows:\n\n- Row $D$: $- \\alpha + 0 + 0 + \\delta = 0 \\implies \\delta = \\alpha$.\n- Row $M_{1}$: $\\alpha - \\beta + \\gamma - \\delta = 0$. Using $\\delta = \\alpha$, we get $- \\beta + \\gamma = 0 \\implies \\gamma = \\beta$.\n- Row $M_{2}$: $0 + \\beta - \\gamma + 0 = 0 \\implies \\beta - \\gamma = 0$, consistent with $\\gamma = \\beta$.\n- Row $\\mathrm{NADPH}$: $- \\alpha + 0 + 0 + 0 = 0 \\implies \\alpha = 0$. Hence $\\delta = 0$.\n- Row $\\mathrm{NADP}^{+}$: $\\alpha + 0 + 0 + 0 = 0 \\implies \\alpha = 0$, already enforced.\n- Row $\\mathrm{GSH}$: $0 - \\beta + 0 + 0 = 0 \\implies \\beta = 0$. Hence $\\gamma = 0$.\n\nTherefore, the only solution is $\\alpha = \\beta = \\gamma = \\delta = 0$, implying that the columns are linearly independent. Consequently, the rank of $S$ is\n$$\n\\mathrm{rank}(S) = 4.\n$$\n\nThis completes the derivation of $A$, $S$, and the computation of the requested scalar network property (the rank of the stoichiometric incidence matrix).", "answer": "$$\\boxed{4}$$", "id": "4594957"}, {"introduction": "Before analyzing entire networks, it is essential to understand the dynamics of their fundamental building blocks, such as the binding of a drug to its receptor. This practice focuses on a classic bimolecular reaction, applying the Law of Mass Action and conservation principles to determine the system's state at equilibrium. By calculating the steady-state concentration of a drug-receptor complex, you will gain a quantitative intuition for how kinetic rates and total component amounts dictate pharmacological response [@problem_id:4595002].", "problem": "In a well-stirred extracellular compartment of a clinical system, a therapeutic ligand $L$ binds a membrane receptor $R$ to form a receptor–ligand complex $C$ via the reversible reaction $L + R \\rightleftharpoons C$. Assume the dynamics follow the Law of Mass Action and that, on the timescale of interest, there is no receptor synthesis, degradation, or internalization, and no ligand clearance, so that the only processes are binding and unbinding. Let $k_{\\text{on}}$ denote the bimolecular association rate constant and $k_{\\text{off}}$ denote the first-order dissociation rate constant. Let the total molar concentrations be conserved as $R_{\\text{tot}} = R + C$ and $L_{\\text{tot}} = L + C$. \n\nGiven $k_{\\text{on}} = 1.0 \\times 10^{6} \\ \\text{M}^{-1}\\ \\text{s}^{-1}$, $k_{\\text{off}} = 1.0 \\times 10^{-3}\\ \\text{s}^{-1}$, $R_{\\text{tot}} = 10\\ \\text{nM}$, and $L_{\\text{tot}} = 5\\ \\text{nM}$, use conservation laws and steady-state flux balance to derive the algebraic condition for the steady-state complex concentration $C_{\\text{ss}}$ and compute its value. \n\nExpress the final concentration in $\\text{nM}$ and round your answer to four significant figures. The final answer must be a single real number.", "solution": "The rate of change of the complex concentration, $C$, is governed by the Law of Mass Action:\n$$\n\\frac{dC}{dt} = k_{\\text{on}} L R - k_{\\text{off}} C\n$$\nAt steady state, $\\frac{dC}{dt} = 0$, which gives the flux balance equation $k_{\\text{on}} L_{\\text{ss}} R_{\\text{ss}} = k_{\\text{off}} C_{\\text{ss}}$. Using the conservation laws $R_{\\text{ss}} = R_{\\text{tot}} - C_{\\text{ss}}$ and $L_{\\text{ss}} = L_{\\text{tot}} - C_{\\text{ss}}$, we can express this equation in terms of $C_{\\text{ss}}$:\n$$\nk_{\\text{on}} (L_{\\text{tot}} - C_{\\text{ss}}) (R_{\\text{tot}} - C_{\\text{ss}}) = k_{\\text{off}} C_{\\text{ss}}\n$$\nWe define the equilibrium dissociation constant $K_d = \\frac{k_{\\text{off}}}{k_{\\text{on}}}$ and rearrange the equation into a standard quadratic form:\n$$\n(L_{\\text{tot}} - C_{\\text{ss}}) (R_{\\text{tot}} - C_{\\text{ss}}) = K_d C_{\\text{ss}}\n$$\n$$\nC_{\\text{ss}}^2 - (L_{\\text{tot}} + R_{\\text{tot}} + K_d)C_{\\text{ss}} + L_{\\text{tot}}R_{\\text{tot}} = 0\n$$\nNext, we substitute the given numerical values. First, we calculate $K_d$:\n$$\nK_d = \\frac{1.0 \\times 10^{-3}\\ \\text{s}^{-1}}{1.0 \\times 10^{6}\\ \\text{M}^{-1}\\ \\text{s}^{-1}} = 1.0 \\times 10^{-9}\\ \\text{M} = 1.0\\ \\text{nM}\n$$\nWith $L_{\\text{tot}} = 5\\ \\text{nM}$ and $R_{\\text{tot}} = 10\\ \\text{nM}$, the quadratic equation becomes:\n$$\nC_{\\text{ss}}^2 - (5 + 10 + 1)C_{\\text{ss}} + (5 \\times 10) = 0\n$$\n$$\nC_{\\text{ss}}^2 - 16C_{\\text{ss}} + 50 = 0\n$$\nWe solve this using the quadratic formula, $x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$:\n$$\nC_{\\text{ss}} = \\frac{16 \\pm \\sqrt{(-16)^2 - 4(1)(50)}}{2} = \\frac{16 \\pm \\sqrt{256 - 200}}{2} = \\frac{16 \\pm \\sqrt{56}}{2} = 8 \\pm \\sqrt{14}\n$$\nThis gives two possible mathematical solutions: $C_{\\text{ss},1} \\approx 8 + 3.7417 = 11.7417\\ \\text{nM}$ and $C_{\\text{ss},2} \\approx 8 - 3.7417 = 4.2583\\ \\text{nM}$.\nThe concentration of the complex $C_{\\text{ss}}$ cannot exceed the total concentration of either of the initial reactants. Therefore, the solution must satisfy $C_{\\text{ss}} \\le \\min(L_{\\text{tot}}, R_{\\text{tot}}) = 5\\ \\text{nM}$. The first root, $11.7417\\ \\text{nM}$, is unphysical and is discarded.\nThe correct steady-state complex concentration is the second root:\n$$\nC_{\\text{ss}} = 8 - \\sqrt{14} \\approx 4.258343\\ \\text{nM}\n$$\nRounding to four significant figures, the final answer is $4.258\\ \\text{nM}$.", "answer": "$$\\boxed{4.258}$$", "id": "4595002"}, {"introduction": "A key promise of systems pharmacology is to anticipate how a drug's effect on its primary target might ripple through the entire cellular network, causing unintended side effects. This computational exercise simulates this process by modeling drug action as a targeted perturbation—inhibition or removal—of a node in a molecular interaction network. By calculating the resulting shifts in a network-wide metric called Katz centrality, you will gain hands-on experience in using network analysis to form hypotheses about the systemic impact of pharmacological interventions [@problem_id:4594949].", "problem": "You are given a directed, weighted, nonnegative network that represents molecular interactions relevant to a drug’s mechanism of action in systems pharmacology. The network is encoded by an adjacency matrix $A \\in \\mathbb{R}_{\\ge 0}^{n \\times n}$, where $A_{ij}$ denotes the strength of the influence from node $i$ onto node $j$. Consider the Katz centrality (KC), which assigns to each node $i$ a centrality $x_i$ that aggregates contributions from paths of all lengths with exponential damping. The Katz centrality vector $x \\in \\mathbb{R}^n$ is defined by the linear system\n$$\n(I - \\alpha A) x = \\beta,\n$$\nwhere $I$ is the identity matrix of dimension $n$, $\\alpha$ is a scalar that satisfies $0 < \\alpha < \\frac{1}{\\rho(A)}$, $\\rho(A)$ is the spectral radius (the largest absolute value of the eigenvalues of $A$), and $\\beta \\in \\mathbb{R}^n$ is the baseline input vector. In this problem, use $\\beta = \\mathbf{1}$ (the vector of ones), and choose $\\alpha$ according to\n$$\n\\alpha = \\begin{cases}\n\\frac{0.9}{\\rho(A)}, & \\text{if } \\rho(A) > 0, \\\\\n0, & \\text{if } \\rho(A) = 0,\n\\end{cases}\n$$\nwhich ensures $0 \\le \\alpha < \\frac{1}{\\rho(A)}$ and the invertibility of $I - \\alpha A$ under these conditions.\n\nModel two types of drug actions:\n- Inhibition of a node $k \\in \\{1,\\dots,n\\}$ with factor $\\gamma \\in [0,1]$: the outgoing influence of node $k$ is scaled, yielding a modified adjacency matrix $A'$ where the $k$-th row is multiplied by $\\gamma$, i.e., $A'_{kj} = \\gamma A_{kj}$ for all $j$, and $A'_{ij} = A_{ij}$ for $i \\neq k$.\n- Removal (complete knockout) of a node $k$: construct the reduced adjacency matrix $A^{\\setminus k}$ by deleting the $k$-th row and $k$-th column from $A$.\n\nFor each action, compute the Katz centrality before and after the perturbation, denoted $x$ (pre-action) and $x'$ (post-action). For removal, $x'$ is defined on the reduced node set, and comparisons shall be made only over the surviving nodes. Quantify the adverse network effect by the maximum absolute relative change in centrality among the nodes that remain after the action:\n$$\nM = \\max_{i \\in S} \\delta_i,\n$$\nwhere $S$ is the set of nodes that exist post-action (for inhibition $S = \\{1,\\dots,n\\}$; for removal $S = \\{1,\\dots,n\\} \\setminus \\{k\\}$), and the node-wise change $\\delta_i$ is defined by\n$$\n\\delta_i = \\begin{cases}\n\\frac{|x'_i - x_i|}{x_i}, & \\text{if } x_i > 0, \\\\\n|x'_i - x_i|, & \\text{if } x_i = 0.\n\\end{cases}\n$$\nReport $M$ as a decimal number (not a percentage) rounded to six decimal places. Centrality is dimensionless, so no physical units are required.\n\nFundamental base for the derivation:\n- The spectral radius $\\rho(A)$ is the maximum absolute value among the eigenvalues of $A$.\n- The Katz centrality arises from the Neumann series representation $(I - \\alpha A)^{-1} = \\sum_{l=0}^{\\infty} (\\alpha A)^l$ when $0 < \\alpha < \\frac{1}{\\rho(A)}$, which is a well-tested fact in linear algebra.\n- The Perron–Frobenius theorem (PF) ensures well-behaved dominant eigenstructure for nonnegative matrices, supporting the choice of $\\alpha$ based on $\\rho(A)$.\n\nYour program must implement the above definitions to compute $M$ for each test case. Node indices in the problem statement are one-based; implement them as zero-based in your code as needed, but the problem specification is one-based.\n\nTest suite:\n1. Happy path inhibition on a five-node network. Use\n$$\nA^{(1)} = \\begin{bmatrix}\n0 & 0.4 & 0 & 0 & 0.1 \\\\\n0 & 0 & 0.5 & 0 & 0 \\\\\n0 & 0 & 0 & 0.3 & 0.2 \\\\\n0.2 & 0 & 0 & 0 & 0.6 \\\\\n0 & 0 & 0 & 0 & 0\n\\end{bmatrix}.\n$$\nInhibit node $k=4$ with factor $\\gamma=0.5$. Compute $M$.\n\n2. Removal on the same five-node network. Use $A^{(1)}$ as above. Remove node $k=2$. Compute $M$.\n\n3. Edge case inhibition of a node with no outgoing edges. Use $A^{(1)}$ as above. Inhibit node $k=5$ with factor $\\gamma=0$. Compute $M$.\n\n4. Boundary case of complete inhibition of a hub-like node on a six-node network. Use\n$$\nA^{(2)} = \\begin{bmatrix}\n0 & 0.8 & 0 & 0 & 0 & 0 \\\\\n0 & 0 & 0.6 & 0.2 & 0 & 0 \\\\\n0 & 0 & 0 & 0.7 & 0 & 0.1 \\\\\n0.1 & 0 & 0 & 0 & 0.5 & 0 \\\\\n0 & 0.3 & 0 & 0 & 0 & 0.4 \\\\\n0 & 0 & 0 & 0 & 0 & 0\n\\end{bmatrix}.\n$$\nInhibit node $k=3$ with factor $\\gamma=0$. Compute $M$.\n\n5. Removal on a minimal two-node signaling chain. Use\n$$\nA^{(3)} = \\begin{bmatrix}\n0 & 1.0 \\\\\n0 & 0\n\\end{bmatrix}.\n$$\nRemove node $k=1$. Compute $M$.\n\nFinal output format:\nYour program should produce a single line of output containing the results for test cases $1$ through $5$ as a comma-separated list enclosed in square brackets, with each $M$ rounded to six decimal places (e.g., \"[0.123456,0.000001,0.250000,0.875000,0.000000]\").", "solution": "The problem statement is rigorously defined, self-contained, and scientifically valid. It poses a computational task rooted in established principles of network science and linear algebra, specifically the application of Katz centrality to model the systemic effects of network perturbations. The premises are sound, the terminology is precise, and the objectives are quantifiable. The problem is well-posed, as the conditions specified for the parameter $\\alpha$ ensure the existence and uniqueness of the Katz centrality vector. We shall, therefore, proceed with a complete solution.\n\nThe core of this problem is the computation and comparison of the Katz centrality (KC) of a network before and after a targeted perturbation. The Katz centrality of a node $i$, denoted $x_i$, is a measure of its influence within a network, accounting for all paths that originate from it. The centrality vector $x \\in \\mathbb{R}^n$ for a network with adjacency matrix $A$ is given by the solution to the linear system:\n$$\n(I - \\alpha A) x = \\beta\n$$\nHere, $I$ is the $n \\times n$ identity matrix, $\\beta$ is a vector of baseline weights (taken here as $\\beta = \\mathbf{1}$, the vector of all ones), and $\\alpha$ is a damping factor. The mathematical foundation for this definition is the Neumann series expansion:\n$$\nx = (I - \\alpha A)^{-1} \\mathbf{1} = \\left( \\sum_{l=0}^{\\infty} (\\alpha A)^l \\right) \\mathbf{1} = \\sum_{l=0}^{\\infty} \\alpha^l A^l \\mathbf{1}\n$$\nThis series shows that the centrality of nodes is a sum over all path lengths $l$, where $(\\alpha A)^l$ accounts for paths of length $l$. For this series to converge, the spectral radius of the matrix $\\alpha A$, which is $\\alpha \\rho(A)$, must be less than $1$. This gives the condition $0 < \\alpha < \\frac{1}{\\rho(A)}$, where $\\rho(A) = \\max_i|\\lambda_i|$ is the spectral radius of $A$ (the largest absolute value of its eigenvalues). The problem prescribes a specific, valid choice for $\\alpha$:\n$$\n\\alpha = \\begin{cases}\n\\frac{0.9}{\\rho(A)}, & \\text{if } \\rho(A) > 0 \\\\\n0, & \\text{if } \\rho(A) = 0\n\\end{cases}\n$$\nThis choice ensures convergence and that the matrix $(I - \\alpha A)$ is a non-singular M-matrix, guaranteeing a unique, non-negative solution $x$.\n\nThe overall computational procedure to determine the adverse network effect, $M$, for a given test case involves the following steps:\n\n1.  **Compute Pre-Action Centrality ($x$)**:\n    a. Given the initial adjacency matrix $A$.\n    b. Compute the eigenvalues of $A$ to find its spectral radius, $\\rho(A)$.\n    c. Calculate the damping factor $\\alpha$ using the rule above.\n    d. Define the identity matrix $I$ and the baseline vector $\\beta = \\mathbf{1}$ of appropriate dimension.\n    e. Solve the linear system $(I - \\alpha A) x = \\beta$ to obtain the pre-action centrality vector $x$.\n\n2.  **Apply Network Perturbation**:\n    a. Create the post-action adjacency matrix $A'$.\n    b. For **inhibition** of node $k$ with factor $\\gamma$, $A'$ is obtained by multiplying the $k$-th row of $A$ by $\\gamma$. Note that the problem uses $1$-based indexing for node $k$.\n    c. For **removal** of node $k$, $A'$ (denoted as $A^{\\setminus k}$ in the problem) is formed by deleting the $k$-th row and $k$-th column from $A$. The dimension of the network is reduced from $n$ to $n-1$.\n\n3.  **Compute Post-Action Centrality ($x'$)**:\n    a. Using the perturbed matrix $A'$, repeat the procedure from Step $1$ to find the post-action centrality vector $x'$. This involves calculating a new spectral radius $\\rho(A')$ and a new damping factor $\\alpha'$.\n    b. If the action was removal, note that $x'$ will have dimension $n-1$.\n\n4.  **Quantify the Adverse Effect ($M$)**:\n    a. Identify the set of nodes $S$ that remain after the action. For inhibition, $S = \\{1, \\dots, n\\}$. For removal of node $k$, $S = \\{1, \\dots, n\\} \\setminus \\{k\\}$.\n    b. For each node $i \\in S$, calculate the node-wise change $\\delta_i$. To do this, we need to compare the elements of $x'$ with the corresponding elements of the original vector $x$. For removal of node $k$, we compare $x'$ with the subvector of $x$ containing all elements except for $x_k$. Let this subvector be $x_S$. The formula for $\\delta_i$ is:\n       $$\n       \\delta_i = \\begin{cases}\n       \\frac{|x'_i - x_{S_i}|}{x_{S_i}}, & \\text{if } x_{S_i} > 0 \\\\\n       |x'_i - x_{S_i}|, & \\text{if } x_{S_i} = 0\n       \\end{cases}\n       $$\n    c. The final metric $M$ is the maximum of these individual changes: $M = \\max_{i \\in S} \\delta_i$.\n    d. The final value of $M$ is rounded to six decimal places.\n\nThis algorithm will be implemented and applied to each of the $5$ test cases provided. The implementation will use numerical libraries to handle matrix operations, eigenvalue computation, and solving the linear systems. Special care is taken to handle the $1$-based versus $0$-based indexing and the comparison over the set of surviving nodes.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the network pharmacology problem by calculating the adverse effect metric M for a series of test cases.\n    \"\"\"\n\n    def compute_katz_centrality(A):\n        \"\"\"\n        Computes the Katz centrality vector for a given adjacency matrix A.\n        Args:\n            A (np.ndarray): The adjacency matrix of the network.\n        Returns:\n            np.ndarray: The Katz centrality vector x.\n        \"\"\"\n        n = A.shape[0]\n        if n == 0:\n            return np.array([])\n        \n        # Calculate eigenvalues and spectral radius\n        try:\n            eigenvalues = np.linalg.eigvals(A)\n            rho_A = np.max(np.abs(eigenvalues))\n        except np.linalg.LinAlgError:\n            return np.ones(n)\n\n        # Determine the damping factor alpha\n        if rho_A > 1e-9:\n            alpha = 0.9 / rho_A\n        else:\n            alpha = 0.0\n            \n        # Set up the linear system (I - alpha * A)x = 1\n        I = np.identity(n)\n        beta = np.ones(n)\n        katz_matrix = I - alpha * A\n        \n        # Solve the system for x.\n        x = np.linalg.solve(katz_matrix, beta)\n        return x\n\n    def compute_metric_M(x_pre, x_post, surviving_indices_pre):\n        \"\"\"\n        Computes the adverse network effect metric M.\n        Args:\n            x_pre (np.ndarray): The pre-action centrality vector.\n            x_post (np.ndarray): The post-action centrality vector.\n            surviving_indices_pre (list): Indices of nodes in the pre-action graph that survive.\n        Returns:\n            float: The computed metric M.\n        \"\"\"\n        if len(surviving_indices_pre) == 0:\n            return 0.0\n\n        # Extract centralities of surviving nodes from the pre-action vector\n        x_pre_surviving = x_pre[surviving_indices_pre]\n        \n        # Calculate delta_i for each surviving node i\n        delta = np.abs(x_post - x_pre_surviving) / np.where(x_pre_surviving > 1e-9, x_pre_surviving, 1.0)\n        \n        return np.max(delta)\n\n    # Define the adjacency matrices for the test cases.\n    A1 = np.array([\n        [0.0, 0.4, 0.0, 0.0, 0.1],\n        [0.0, 0.0, 0.5, 0.0, 0.0],\n        [0.0, 0.0, 0.0, 0.3, 0.2],\n        [0.2, 0.0, 0.0, 0.0, 0.6],\n        [0.0, 0.0, 0.0, 0.0, 0.0]\n    ])\n    \n    A2 = np.array([\n        [0.0, 0.8, 0.0, 0.0, 0.0, 0.0],\n        [0.0, 0.0, 0.6, 0.2, 0.0, 0.0],\n        [0.0, 0.0, 0.0, 0.7, 0.0, 0.1],\n        [0.1, 0.0, 0.0, 0.0, 0.5, 0.0],\n        [0.0, 0.3, 0.0, 0.0, 0.0, 0.4],\n        [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]\n    ])\n\n    A3 = np.array([\n        [0.0, 1.0],\n        [0.0, 0.0]\n    ])\n\n    # Define the full set of test cases from the problem statement.\n    test_cases = [\n        {'A': A1, 'action': 'inhibit', 'k': 4, 'gamma': 0.5},\n        {'A': A1, 'action': 'remove', 'k': 2},\n        {'A': A1, 'action': 'inhibit', 'k': 5, 'gamma': 0.0},\n        {'A': A2, 'action': 'inhibit', 'k': 3, 'gamma': 0.0},\n        {'A': A3, 'action': 'remove', 'k': 1},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        A = case['A']\n        k = case['k']\n        # Convert 1-based node index to 0-based array index\n        k_idx = k - 1\n        n = A.shape[0]\n\n        # Step 1: Compute pre-action centrality\n        x_pre = compute_katz_centrality(A)\n\n        M = 0.0\n        if case['action'] == 'inhibit':\n            gamma = case['gamma']\n            \n            # Step 2: Apply inhibition\n            A_post = A.copy()\n            A_post[k_idx, :] *= gamma\n            \n            # Step 3: Compute post-action centrality\n            x_post = compute_katz_centrality(A_post)\n            \n            # Step 4: Compute metric M\n            surviving_indices = list(range(n))\n            M = compute_metric_M(x_pre, x_post, surviving_indices)\n\n        elif case['action'] == 'remove':\n            # Step 2: Apply removal\n            A_post = np.delete(np.delete(A, k_idx, axis=0), k_idx, axis=1)\n            \n            # Step 3: Compute post-action centrality\n            x_post = compute_katz_centrality(A_post)\n            \n            # Step 4: Compute metric M\n            surviving_indices = [i for i in range(n) if i != k_idx]\n            M = compute_metric_M(x_pre, x_post, surviving_indices)\n        \n        results.append(M)\n\n    # Format the final output string as specified.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4594949"}]}