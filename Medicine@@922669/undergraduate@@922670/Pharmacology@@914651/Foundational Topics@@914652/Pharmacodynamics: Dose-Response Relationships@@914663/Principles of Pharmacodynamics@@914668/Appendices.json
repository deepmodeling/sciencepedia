{"hands_on_practices": [{"introduction": "Understanding drug action often begins at the receptor level, where different molecules may compete for the same binding site. This exercise explores the fundamental principles of competitive binding by modeling the interaction between a full agonist and a partial agonist. By calculating the net effect, you will gain insight into how a drug's affinity ($K_D$) and its intrinsic efficacy ($\\alpha$) combine to determine the ultimate physiological response in a competitive environment [@problem_id:4584226].", "problem": "A receptor system in clinical pharmacology is studied to illustrate core principles of Pharmacodynamics (PD), specifically competitive binding and intrinsic efficacy under equilibrium conditions. Consider a single population of orthosteric receptors with one binding site per receptor and no receptor dimerization, no allosteric modulators, and no receptor reserve. Assume equilibrium, mass-action binding, and that free ligand concentrations equal total added concentrations. Two agonists compete for the same receptor sites:\n\n- A full agonist, labeled $A$, with dissociation constant $K_{D,A} = 10\\,\\mathrm{nM}$ and intrinsic efficacy $\\alpha_{A} = 1.0$.\n- A partial agonist, labeled $B$, with dissociation constant $K_{D,B} = 5\\,\\mathrm{nM}$ and intrinsic efficacy $\\alpha_{B} = 0.4$.\n\nBoth ligands are present simultaneously at fixed concentrations $[A] = 20\\,\\mathrm{nM}$ and $[B] = 30\\,\\mathrm{nM}$. Assume a linear transduction from receptor occupancy to effect, such that the system’s maximal possible effect is achieved at full receptor occupancy by a ligand with intrinsic efficacy $\\alpha = 1.0$, and the net effect is the occupancy-weighted sum of intrinsic efficacies.\n\nUsing only well-tested equilibrium mass-action binding and physically consistent reasoning from first principles, compute the net effect as a decimal fraction of the system’s maximal effect. Express your final answer as a unitless decimal fraction and round to $4$ significant figures.", "solution": "The problem requires determination of the net effect produced when two agonists, a full agonist $A$ and a partial agonist $B$, compete for the same orthosteric receptor population. We proceed from equilibrium mass-action binding and a linear occupancy-to-effect transduction assumption.\n\nThe equilibrium dissociation constant $K_{D,i}$ for ligand $i$ is defined by\n$$\nK_{D,i} \\equiv \\frac{k_{\\mathrm{off},i}}{k_{\\mathrm{on},i}},\n$$\nand at equilibrium, for a receptor $R$ and ligand $L_{i}$,\n$$\n\\frac{[RL_{i}]}{[R]} = \\frac{[L_{i}]}{K_{D,i}}.\n$$\nLet $[R_{T}]$ denote the total receptor concentration, $[R]$ the concentration of free receptors, and $[RL_{i}]$ the concentration of receptors bound to ligand $i$. Mass conservation for receptors gives\n$$\n[R_{T}] = [R] + \\sum_{i}[RL_{i}].\n$$\nUsing the equilibrium relation for each $i$,\n$$\n[RL_{i}] = [R]\\frac{[L_{i}]}{K_{D,i}},\n$$\nso\n$$\n[R_{T}] = [R]\\left(1 + \\sum_{i}\\frac{[L_{i}]}{K_{D,i}}\\right).\n$$\nTherefore,\n$$\n\\frac{[RL_{i}]}{[R_{T}]} = \\frac{[R]\\frac{[L_{i}]}{K_{D,i}}}{[R]\\left(1 + \\sum_{j}\\frac{[L_{j}]}{K_{D,j}}\\right)} = \\frac{\\frac{[L_{i}]}{K_{D,i}}}{1 + \\sum_{j}\\frac{[L_{j}]}{K_{D,j}}}.\n$$\nThus, under competitive binding to a single site, the fractional occupancy by ligand $i$ is\n$$\nf_{i} = \\frac{\\frac{[L_{i}]}{K_{D,i}}}{1 + \\sum_{j}\\frac{[L_{j}]}{K_{D,j}}}.\n$$\nWith two ligands $A$ and $B$, and no other competitors, the denominator becomes\n$$\nD = 1 + \\frac{[A]}{K_{D,A}} + \\frac{[B]}{K_{D,B}}.\n$$\nGiven $[A] = 20\\,\\mathrm{nM}$, $K_{D,A} = 10\\,\\mathrm{nM}$, $[B] = 30\\,\\mathrm{nM}$, $K_{D,B} = 5\\,\\mathrm{nM}$, we compute the dimensionless ratios\n$$\n\\frac{[A]}{K_{D,A}} = \\frac{20\\,\\mathrm{nM}}{10\\,\\mathrm{nM}} = 2,\n\\qquad\n\\frac{[B]}{K_{D,B}} = \\frac{30\\,\\mathrm{nM}}{5\\,\\mathrm{nM}} = 6,\n$$\nso\n$$\nD = 1 + 2 + 6 = 9.\n$$\nTherefore,\n$$\nf_{A} = \\frac{2}{9}, \\qquad f_{B} = \\frac{6}{9}.\n$$\nThe remaining fraction is free receptor,\n$$\nf_{\\mathrm{free}} = \\frac{1}{9},\n$$\nwhich does not contribute to effect.\n\nWe now relate occupancy to effect. Under a linear transduction assumption and intrinsic efficacy $\\alpha_{i}$ normalized such that $\\alpha = 1$ yields the system’s maximal response at full occupancy, the net effect as a fraction of the system’s maximal effect, denoted $\\frac{E}{E_{\\mathrm{sys}}}$, is the occupancy-weighted sum of $\\alpha_{i}$:\n$$\n\\frac{E}{E_{\\mathrm{sys}}} = \\sum_{i}\\alpha_{i} f_{i}.\n$$\nWith $\\alpha_{A} = 1.0$ and $\\alpha_{B} = 0.4$,\n$$\n\\frac{E}{E_{\\mathrm{sys}}} = \\alpha_{A} f_{A} + \\alpha_{B} f_{B} = 1.0 \\cdot \\frac{2}{9} + 0.4 \\cdot \\frac{6}{9} = \\frac{2}{9} + \\frac{2.4}{9} = \\frac{4.4}{9}.\n$$\nCompute the decimal value:\n$$\n\\frac{4.4}{9} \\approx 0.488888\\ldots\n$$\nRounded to $4$ significant figures, the unitless decimal fraction is\n$$\n0.4889.\n$$\nThis is the net effect as a fraction of the system’s maximal effect under the stated assumptions.", "answer": "$$\\boxed{0.4889}$$", "id": "4584226"}, {"introduction": "The relationship between the number of receptors a drug occupies and the resulting cellular response is not always a simple one-to-one correlation. This problem introduces the operational model of agonism to explore how biological systems can amplify a drug's signal, giving rise to the crucial concept of \"spare receptors\". By calculating the fractional occupancy needed for a half-maximal effect, you will see how a system's transducer ratio ($\\tau$) can allow for a maximal response without engaging every available receptor [@problem_id:4982968].", "problem": "A single competitive full agonist binds reversibly to a homogeneous receptor population in a tissue. Assume rapid equilibrium and no constitutive activity. Let the fractional receptor occupancy be defined by the law of mass action as $f = [A]/(K_A + [A])$, where $[A]$ is the free agonist concentration and $K_A$ is the equilibrium dissociation constant. The tissue follows the operational model of agonism (Black and Leff) with transducer ratio $\\tau$ and Hill coefficient $n=1$. The maximal response of the tissue is $E_{\\max}$.\n\nUsing only these foundations, derive an expression that links the normalized effect $E/E_{\\max}$ to the fractional receptor occupancy $f$ when $n=1$, and then determine the value of $f$ required to produce one-half of the maximal response, that is $E = \\tfrac{1}{2} E_{\\max}$, for the specific case $\\tau = 9$. Express the required fractional occupancy $f$ as an exact fraction of the total receptor population. Briefly justify what this result implies about the presence or absence of spare receptors in this system.\n\nYour final answer must be a single exact fraction with no units. Do not round; provide the exact value.", "solution": "The problem requires the derivation of a relationship between the normalized effect, $\\frac{E}{E_{\\max}}$, and fractional receptor occupancy, $f$, based on the operational model of agonism, and then to calculate the specific fractional occupancy required to produce a half-maximal response for a given transducer ratio.\n\nFirst, we validate the problem statement.\n\n**Step 1: Extract Givens**\n- A single competitive full agonist binds reversibly to a homogeneous receptor population.\n- The system is at rapid equilibrium.\n- There is no constitutive activity.\n- Fractional receptor occupancy: $f = \\frac{[A]}{K_A + [A]}$, where $[A]$ is the free agonist concentration and $K_A$ is the equilibrium dissociation constant.\n- The system follows the operational model of agonism (Black and Leff).\n- The transducer ratio is $\\tau$.\n- The Hill coefficient is $n=1$.\n- The maximal response of the tissue is $E_{\\max}$.\n- The objective is to derive an expression for $\\frac{E}{E_{\\max}}$ in terms of $f$.\n- A specific case is given: find $f$ when $E = \\frac{1}{2} E_{\\max}$ and $\\tau = 9$.\n- The final answer for $f$ must be an exact fraction.\n- A brief justification regarding spare receptors is requested.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, being based on fundamental and well-established principles of quantitative pharmacology, namely the law of mass action and the operational model of agonism. All terms such as $f$, $K_A$, $\\tau$, and $E_{\\max}$ are standard in this field. The problem is well-posed, providing all necessary information and definitions to derive a unique solution. The language is objective and precise. The problem does not violate any of the invalidity criteria.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A full solution will be provided.\n\n**Derivation and Solution**\n\nThe operational model of agonism, developed by Black and Leff, provides a framework to link receptor occupancy to tissue response. The model posits that the observed effect, $E$, is a hyperbolic function of an intermediate stimulus, $S$. For a system where the transduction step has a Hill coefficient of $n=1$, this relationship is:\n$$ E = \\frac{E_{\\max} \\cdot S}{K_S + S} $$\nwhere $E_{\\max}$ is the maximal possible effect the tissue can produce, and $K_S$ is the stimulus that produces a half-maximal response ($50\\%$ of $E_{\\max}$).\n\nThe stimulus, $S$, is generated by the binding of the agonist to the receptors. It is assumed to be proportional to the concentration of agonist-receptor complexes, $[AR]$, and the intrinsic efficacy of the agonist, $\\epsilon$. The concentration $[AR]$ is given by the product of the total receptor concentration, $[R_{tot}]$, and the fractional occupancy, $f$.\n$$ S = \\epsilon [AR] = \\epsilon \\cdot f \\cdot [R_{tot}] $$\n\nSubstituting this expression for the stimulus $S$ into the effect equation gives:\n$$ E = \\frac{E_{\\max} \\cdot (\\epsilon \\cdot f \\cdot [R_{tot}])}{K_S + (\\epsilon \\cdot f \\cdot [R_{tot}])} $$\nTo simplify this expression, we can divide the numerator and the denominator by $K_S$:\n$$ E = \\frac{E_{\\max} \\cdot \\frac{\\epsilon \\cdot [R_{tot}]}{K_S} \\cdot f}{1 + \\frac{\\epsilon \\cdot [R_{tot}]}{K_S} \\cdot f} $$\nThe dimensionless group $\\frac{\\epsilon \\cdot [R_{tot}]}{K_S}$ is defined as the transducer ratio, $\\tau$. This ratio quantifies the signal amplification capacity of the system. It represents the ratio of the maximum possible stimulus ($\\epsilon \\cdot [R_{tot}]$) to the stimulus required for a half-maximal response ($K_S$).\n\nSubstituting $\\tau$ into the equation yields the desired relationship between the effect $E$ and the fractional occupancy $f$:\n$$ E = \\frac{E_{\\max} \\cdot \\tau \\cdot f}{1 + \\tau \\cdot f} $$\nTo obtain the normalized effect, we divide by $E_{\\max}$:\n$$ \\frac{E}{E_{\\max}} = \\frac{\\tau \\cdot f}{1 + \\tau \\cdot f} $$\nThis expression links the normalized effect to fractional occupancy via the transducer ratio $\\tau$, as required by the first part of the problem.\n\nNext, we must determine the value of the fractional occupancy $f$ that produces a half-maximal response, i.e., when $E = \\frac{1}{2} E_{\\max}$, for the specific case where $\\tau = 9$. We set $\\frac{E}{E_{\\max}} = \\frac{1}{2}$ and $\\tau = 9$ in our derived equation:\n$$ \\frac{1}{2} = \\frac{9f}{1 + 9f} $$\nWe now solve this equation for $f$. Multiplying both sides by $2(1 + 9f)$ gives:\n$$ 1 \\cdot (1 + 9f) = 2 \\cdot (9f) $$\n$$ 1 + 9f = 18f $$\nSubtracting $9f$ from both sides, we get:\n$$ 1 = 18f - 9f $$\n$$ 1 = 9f $$\nSolving for $f$, we find:\n$$ f = \\frac{1}{9} $$\nThus, a fractional occupancy of $\\frac{1}{9}$ is required to produce one-half of the maximal response in this system.\n\nFinally, we are asked to justify what this result implies about the presence or absence of spare receptors.\nThe concept of spare receptors (or receptor reserve) describes a situation where the maximal response ($E_{\\max}$) can be elicited by an agonist at a concentration that does not occupy all available receptors (i.e., at $f  1$). Equivalently, a system possesses a receptor reserve if the concentration for half-maximal effect ($EC_{50}$) is lower than the dissociation constant ($K_A$).\nIn a hypothetical system with no receptor reserve, the effect is directly proportional to the fractional occupancy: $\\frac{E}{E_{\\max}} = f$. In such a system, a half-maximal response ($\\frac{E}{E_{\\max}} = \\frac{1}{2}$) would require a fractional occupancy of exactly $f = \\frac{1}{2}$.\nIn the given problem, a half-maximal response is achieved when only $f = \\frac{1}{9}$ of the receptors are occupied. Since $\\frac{1}{9}  \\frac{1}{2}$, the system generates a half-maximal response with significantly fewer occupied receptors than would be required in a system without reserve. This indicates that the signal generated by receptor binding is amplified by the downstream transduction pathway. The existence of such amplification is the defining characteristic of a receptor reserve. The transducer ratio, $\\tau = 9$, which is significantly greater than $1$, quantitatively confirms the presence of a substantial population of spare receptors.", "answer": "$$\\boxed{\\frac{1}{9}}$$", "id": "4982968"}, {"introduction": "A core task in pharmacology is to translate raw experimental data into meaningful parameters that describe a drug's activity. This practice simulates this essential process by guiding you to fit a dose-response curve to a set of hypothetical measurements using the Hill equation. This exercise will help you master the skills needed to determine a drug's maximal effect ($E_{\\max}$), potency ($EC_{50}$), and the nature of its binding cooperativity ($n$), which are fundamental to drug characterization and development [@problem_id:4584147].", "problem": "You are tasked with estimating key pharmacodynamic parameters from effect versus concentration measurements using principles appropriate for Clinical Pharmacology and the principles of pharmacodynamics (PD). The scenario is rooted in receptor theory and the law of mass action, where a drug’s effect arises from binding to a finite population of targets, the effect saturates as available targets become fully occupied, and the steepness of the concentration-effect relationship reflects cooperative interactions in binding or signaling. Starting from these foundational ideas, construct a nonlinear least-squares estimator for three parameters that characterize a saturable, monotonic, sigmoidal concentration-effect relationship: the maximal effect $E_{\\max}$, the half-maximal concentration $EC_{50}$, and the slope parameter often called the Hill coefficient $n$. The quantities $E_{\\max}$ and $EC_{50}$ must be strictly positive with physical units $E_{\\max}$ in arbitrary units (a.u.) of effect and $EC_{50}$ in $\\mathrm{mg}/\\mathrm{L}$, and the Hill coefficient $n$ must be strictly positive and dimensionless. The data below provide measured drug concentration (in $\\mathrm{mg}/\\mathrm{L}$) and observed effect (in a.u.), and your program must fit a three-parameter receptor-occupancy-consistent model derived from the law of mass action and the proportionality between effect and fractional occupancy, without assuming any linearization or transformation of the measurements.\n\nYour estimator must:\n1. Minimize the sum of squared residuals between the observed effect and the model-predicted effect at each given concentration.\n2. Enforce the constraints $E_{\\max} \\gt 0$, $EC_{50} \\gt 0$, and $n \\gt 0$ during optimization.\n3. Provide robust initial guesses derived from the data alone, without using any ground-truth parameters.\n4. Return the fitted parameters $E_{\\max}$ (in a.u.), $EC_{50}$ (in $\\mathrm{mg}/\\mathrm{L}$), and $n$ (dimensionless), each rounded to $3$ decimals.\n\nIn addition, quantitatively encode an interpretation of the Hill coefficient $n$ in terms of cooperative behavior using the following classification rule with a tolerance $\\tau = 0.05$: output $-1$ if $n \\lt 1 - \\tau$ (negative cooperativity), $0$ if $|n - 1| \\le \\tau$ (noncooperative), and $+1$ if $n \\gt 1 + \\tau$ (positive cooperativity). The classification code must be an integer.\n\nUse the following test suite comprising four independent datasets. For each dataset, concentrations are in $\\mathrm{mg}/\\mathrm{L}$ and effects are in a.u. Provide estimates for each dataset separately.\n\nDataset A (wide range, moderate slope):\n- Concentrations: $\\{0.25, 0.5, 1, 2, 4, 8, 16\\}$ $\\mathrm{mg}/\\mathrm{L}$\n- Effects: $\\{3.828, 9.520, 21.710, 42.270, 65.880, 83.580, 93.070\\}$ a.u.\n\nDataset B (boundary near noncooperative):\n- Concentrations: $\\{0.05, 0.10, 0.20, 0.50, 1.00, 2.00, 5.00\\}$ $\\mathrm{mg}/\\mathrm{L}$\n- Effects: $\\{4.545, 8.333, 14.286, 25.000, 33.333, 40.000, 45.455\\}$ a.u.\n\nDataset C (high cooperativity, steep transition):\n- Concentrations: $\\{0.10, 0.20, 0.50, 1.00, 2.00, 3.00, 5.00, 10.00\\}$ $\\mathrm{mg}/\\mathrm{L}$\n- Effects: $\\{0.008, 0.128, 4.706, 40.000, 75.294, 79.024, 79.872, 79.992\\}$ a.u.\n\nDataset D (poor saturation within observed range):\n- Concentrations: $\\{1.00, 2.00, 5.00, 10.00, 20.00, 50.00\\}$ $\\mathrm{mg}/\\mathrm{L}$\n- Effects: $\\{0.891, 1.765, 4.286, 8.182, 15.000, 30.000\\}$ a.u.\n\nAngle units are not applicable. The final outputs must be expressed strictly in the units specified above.\n\nYour program must produce a single line of output containing the results as a nested comma-separated list of quadruples, one quadruple per dataset, each of the form $[E_{\\max}, EC_{50}, n, \\text{coop\\_code}]$. The entire output must be enclosed in square brackets, and every floating-point value must be rounded to $3$ decimals. For example, an output for two datasets would look like $[[e_{1},c_{1},n_{1},k_{1}],[e_{2},c_{2},n_{2},k_{2}]]$, where $e_{i}$, $c_{i}$, and $n_{i}$ are floats and $k_{i}$ is an integer.\n\nYour program must run deterministically and must not read any external input.", "solution": "The problem is to estimate the pharmacodynamic parameters of a drug from its measured concentration-effect relationship. The problem statement is scientifically sound, well-posed, and internally consistent. It accurately describes a standard task in clinical pharmacology, parameterizing a sigmoidal dose-response curve.\n\nThe foundational principle is the law of mass action applied to drug-receptor binding. The relationship between drug concentration $C$ and the resulting physiological effect $E$ is described by the Hill-Langmuir equation. This model assumes that the effect is proportional to the fraction of receptors occupied by the drug. For a system involving $n$ binding sites, the effect $E$ as a function of concentration $C$ is given by:\n$$\nE(C) = \\frac{E_{\\max} \\cdot C^n}{EC_{50}^n + C^n}\n$$\nThe three parameters to be determined are:\n1.  $E_{\\max}$: The maximal effect, representing the effect at saturating drug concentrations. It must be positive ($E_{\\max}  0$) and has units of effect (a.u.).\n2.  $EC_{50}$: The half-maximal effective concentration, which is the drug concentration that produces $50\\%$ of the maximal effect. It must be positive ($EC_{50}  0$) and has units of concentration ($\\mathrm{mg}/\\mathrm{L}$).\n3.  $n$: The Hill coefficient, a dimensionless parameter that describes the steepness of the curve and reflects the cooperativity of the drug-receptor interaction. It must be positive ($n  0$).\n\nThe estimation of these parameters, collectively denoted by the vector $\\theta = [E_{\\max}, EC_{50}, n]$, is performed using the method of nonlinear least-squares. This involves finding the parameter values that minimize the sum of squared residuals (SSR) between the observed effect data $E_{\\text{obs},i}$ and the model-predicted effect $E(C_i, \\theta)$ at each corresponding concentration $C_i$. The objective function to be minimized is:\n$$\n\\text{SSR}(\\theta) = \\sum_{i=1}^{N} \\left[E_{\\text{obs},i} - E(C_i, \\theta)\\right]^2 = \\sum_{i=1}^{N} \\left[E_{\\text{obs},i} - \\frac{E_{\\max} \\cdot C_i^n}{EC_{50}^n + C_i^n}\\right]^2\n$$\nThis optimization problem is solved numerically. The `scipy.optimize.curve_fit` function, which implements the Levenberg-Marquardt algorithm, is an appropriate and robust tool for this task.\n\nA critical aspect of nonlinear optimization is the provision of good initial guesses for the parameters. Based on the properties of the Hill equation, we can derive these guesses directly from the data:\n-   **Initial guess for $E_{\\max}$ ($E_{\\max,0}$)**: A reasonable starting point is the maximum observed effect in the dataset, $E_{\\max,0} = \\max(E_{\\text{obs}})$. This is a robust choice, although it may be an underestimate if the data do not show full saturation.\n-   **Initial guess for $EC_{50}$ ($EC_{50,0}$)**: By definition, $EC_{50}$ is the concentration at which the effect is half-maximal. Thus, a logical guess is the concentration $C_i$ from the dataset where the corresponding observed effect $E_{\\text{obs},i}$ is closest to $E_{\\max,0} / 2$.\n-   **Initial guess for $n$ ($n_0$)**: A neutral and common starting value for the Hill coefficient is $n_0 = 1$, which corresponds to the non-cooperative Michaelis-Menten model.\n\nThe problem mandates the physical constraints $E_{\\max}  0$, $EC_{50}  0$, and $n  0$. These are enforced by providing lower bounds of $0$ for all three parameters to the `curve_fit` function.\n\nFinally, the fitted Hill coefficient $n$ is interpreted in terms of binding cooperativity. Using the specified tolerance $\\tau = 0.05$, the classification is as follows:\n-   Negative cooperativity (code $-1$): $n  1 - \\tau = 0.95$.\n-   Noncooperative (code $0$): $|n - 1| \\le \\tau$, which is $0.95 \\le n \\le 1.05$.\n-   Positive cooperativity (code $+1$): $n  1 + \\tau = 1.05$.\n\nThe procedure is applied independently to each of the four provided datasets. For each dataset, the algorithm will:\n1.  Define the concentration and effect data arrays.\n2.  Calculate the initial parameter guesses ($p_0 = [E_{\\max,0}, EC_{50,0}, n_0]$).\n3.  Perform the constrained nonlinear least-squares fit using `curve_fit` to find the optimal parameters.\n4.  Classify the resulting Hill coefficient $n$ to determine the cooperativity code.\n5.  Format the final parameters ($E_{\\max}$, $EC_{50}$, $n$) rounded to $3$ decimal places, along with the integer cooperativity code, into the specified output structure.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Fits a three-parameter Hill equation to pharmacodynamic data and classifies cooperativity.\n    \"\"\"\n    \n    # Define the Hill equation model for the concentration-effect relationship.\n    # The parameters are E_max, EC50, and n (Hill coefficient).\n    # Using np.asarray ensures inputs are arrays and handles C_safe**n correctly for scalars.\n    def hill_equation(C, E_max, EC50, n):\n        C_safe = np.asarray(C, dtype=float)\n        # To prevent 0**n issues for n0 (though n is constrained 0),\n        # we add a small epsilon. Since concentrations are positive, this has no effect.\n        # This also guards against potential warnings or DomainErrors in some math libraries.\n        numerator = E_max * (C_safe**n)\n        denominator = EC50**n + C_safe**n\n        # Avoid division by zero, although denominator is always  0 \n        # due to the bounds EC50  0.\n        return np.divide(numerator, denominator, out=np.zeros_like(numerator), where=denominator!=0)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"C\": np.array([0.25, 0.5, 1, 2, 4, 8, 16]),\n            \"E\": np.array([3.828, 9.520, 21.710, 42.270, 65.880, 83.580, 93.070])\n        },\n        {\n            \"C\": np.array([0.05, 0.10, 0.20, 0.50, 1.00, 2.00, 5.00]),\n            \"E\": np.array([4.545, 8.333, 14.286, 25.000, 33.333, 40.000, 45.455])\n        },\n        {\n            \"C\": np.array([0.10, 0.20, 0.50, 1.00, 2.00, 3.00, 5.00, 10.00]),\n            \"E\": np.array([0.008, 0.128, 4.706, 40.000, 75.294, 79.024, 79.872, 79.992])\n        },\n        {\n            \"C\": np.array([1.00, 2.00, 5.00, 10.00, 20.00, 50.00]),\n            \"E\": np.array([0.891, 1.765, 4.286, 8.182, 15.000, 30.000])\n        }\n    ]\n\n    all_results = []\n    \n    # Process each dataset\n    for case in test_cases:\n        C_data = case[\"C\"]\n        E_data = case[\"E\"]\n\n        # 1. Generate robust initial guesses from the data.\n        #    - E_max_0: Maximum observed effect.\n        #    - EC50_0: Concentration where effect is closest to half of E_max_0.\n        #    - n_0: Neutral guess of 1.0 (non-cooperative).\n        E_max_0 = np.max(E_data)\n        if E_max_0 = 0: E_max_0 = 1.0 # Fallback for pathological data\n        \n        half_max_effect = E_max_0 / 2.0\n        # Find index of the effect value closest to half_max_effect\n        idx = np.argmin(np.abs(E_data - half_max_effect))\n        EC50_0 = C_data[idx]\n        if EC50_0 = 0: EC50_0 = np.mean(C_data) # Fallback\n\n        n_0 = 1.0\n        \n        p0 = [E_max_0, EC50_0, n_0]\n\n        # 2. Define the bounds for the parameters (Emax  0, EC50  0, n  0).\n        bounds = ([0, 0, 0], [np.inf, np.inf, np.inf])\n\n        # 3. Perform nonlinear least-squares fitting.\n        try:\n            popt, _ = curve_fit(hill_equation, C_data, E_data, p0=p0, bounds=bounds, maxfev=10000)\n            E_max_fit, EC50_fit, n_fit = popt\n        except RuntimeError:\n            # In case the fit fails, though it shouldn't for these datasets.\n            E_max_fit, EC50_fit, n_fit = np.nan, np.nan, np.nan\n\n        # 4. Classify the Hill coefficient for cooperativity.\n        tau = 0.05\n        if n_fit  1 - tau:\n            coop_code = -1\n        elif n_fit  1 + tau:\n            coop_code = 1\n        else:\n            coop_code = 0\n            \n        # 5. Store the formatted result quadruple.\n        # The formatting to 3 decimal places happens during string creation.\n        result_quad = [E_max_fit, EC50_fit, n_fit, coop_code]\n        all_results.append(result_quad)\n\n    # 6. Format the final output string as specified.\n    # Each sublist is formatted as a string with no spaces, e.g., '[1.234,5.678,9.012,1]'\n    # Then these strings are joined by commas and enclosed in outer brackets.\n    list_of_quad_strings = []\n    for quad in all_results:\n        # Format floats to 3 decimal places exactly for the output.\n        quad_str = f\"[{quad[0]:.3f},{quad[1]:.3f},{quad[2]:.3f},{quad[3]}]\"\n        list_of_quad_strings.append(quad_str)\n    \n    final_output_string = f\"[{','.join(list_of_quad_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_string)\n\nsolve()\n\n```", "id": "4584147"}]}