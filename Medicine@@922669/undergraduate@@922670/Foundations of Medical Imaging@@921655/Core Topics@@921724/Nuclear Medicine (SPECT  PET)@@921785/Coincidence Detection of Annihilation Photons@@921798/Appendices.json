{"hands_on_practices": [{"introduction": "To accurately detect a coincidence, we must first understand what happens when a single $511\\,\\mathrm{keV}$ annihilation photon interacts with a detector crystal. This first practice delves into the fundamental physics of Compton scattering, the dominant interaction mechanism at this energy. By deriving the maximum energy that can be transferred to an electron in a single collision—the Compton edge—you will gain insight into the structure of a detector's energy spectrum and appreciate the challenges of using energy discrimination to reject unwanted scatter events, a critical task for obtaining high-quality PET images [@problem_id:4868453].", "problem": "A ring of detectors in Positron Emission Tomography (PET) is used to detect coincidence pairs of annihilation photons of energy $511\\,\\mathrm{keV}$. Energy discrimination is applied at each detector to reject scattered events based on pulse height. Consider a single $511\\,\\mathrm{keV}$ photon incident on a scintillation detector. Assume the photon undergoes at most one Compton scatter before either being absorbed or escaping.\n\nStarting from conservation of relativistic energy and momentum for a photon incident on a stationary electron of rest energy $m_e c^2$, derive a general expression for the maximum kinetic energy transferred to the recoil electron in a single Compton interaction as a function of the incident photon energy $E_0$ and $m_e c^2$. Then evaluate this maximum energy deposition (the Compton edge energy) for $E_0 = 511\\,\\mathrm{keV}$. Use $m_e c^2 = 511\\,\\mathrm{keV}$. Round your numerical result to four significant figures and express it in $\\mathrm{keV}$.\n\nFinally, briefly justify, using physical reasoning rooted in interaction mechanisms and signal formation, why multi-site interactions in a thick scintillation crystal (e.g., thickness $\\geq 20\\,\\mathrm{mm}$) complicate energy-based scatter rejection in coincidence detection, even though the Compton edge provides a clear theoretical threshold. Your final reported answer must be only the numerical value of the Compton edge energy as specified above.", "solution": "The problem statement is scientifically grounded, well-posed, and contains all necessary information for a complete derivation and calculation. Therefore, it is deemed valid.\n\nThe problem requires the derivation of the maximum kinetic energy transferred to a recoil electron in a Compton scattering event, followed by its evaluation for an incident photon energy of $E_0 = 511\\,\\mathrm{keV}$. Let the incident photon have energy $E_0$ and momentum $\\vec{p}_0$, the scattered photon have energy $E'$ and momentum $\\vec{p}'$, and the recoil electron have final kinetic energy $K_e$ and momentum $\\vec{p}_e$. The electron is assumed to be initially at rest, so its initial energy is its rest energy, $m_e c^2$.\n\nThe derivation proceeds from the principles of conservation of relativistic energy and momentum.\n\nThe conservation of energy is given by:\n$$E_0 + m_e c^2 = E' + E_e$$\nwhere $E_e$ is the total final energy of the electron. The total energy of the electron is the sum of its rest energy and its kinetic energy, $E_e = m_e c^2 + K_e$. Substituting this into the energy conservation equation gives:\n$$E_0 + m_e c^2 = E' + (m_e c^2 + K_e)$$\n$$E_0 = E' + K_e$$\nThis shows that the kinetic energy of the recoil electron is equal to the energy lost by the photon: $K_e = E_0 - E'$.\n\nThe conservation of momentum is a vector equation:\n$$\\vec{p}_0 = \\vec{p}' + \\vec{p}_e$$\nThis can be rearranged to isolate the electron momentum:\n$$\\vec{p}_e = \\vec{p}_0 - \\vec{p}'$$\nWe can find the magnitude squared of the electron momentum by taking the dot product of this equation with itself:\n$$p_e^2 = (\\vec{p}_0 - \\vec{p}') \\cdot (\\vec{p}_0 - \\vec{p}') = p_0^2 + p'^2 - 2 \\vec{p}_0 \\cdot \\vec{p}'$$\n$$p_e^2 = p_0^2 + p'^2 - 2 p_0 p' \\cos\\theta$$\nwhere $\\theta$ is the angle between the incident and scattered photon directions. For a photon, energy and momentum are related by $E=pc$. Thus, we can write the above equation in terms of energy:\n$$(p_e c)^2 = (p_0 c)^2 + (p' c)^2 - 2 (p_0 c)(p' c) \\cos\\theta$$\n$$(p_e c)^2 = E_0^2 + E'^2 - 2 E_0 E' \\cos\\theta$$\n\nNow we use the relativistic energy-momentum relation for the electron:\n$$E_e^2 = (p_e c)^2 + (m_e c^2)^2$$\nSubstituting $E_e = K_e + m_e c^2$:\n$$(K_e + m_e c^2)^2 = (p_e c)^2 + (m_e c^2)^2$$\n$$K_e^2 + 2 K_e m_e c^2 + (m_e c^2)^2 = (p_e c)^2 + (m_e c^2)^2$$\n$$(p_e c)^2 = K_e^2 + 2 K_e m_e c^2$$\n\nNow we have two expressions for $(p_e c)^2$. Equating them gives:\n$$K_e^2 + 2 K_e m_e c^2 = E_0^2 + E'^2 - 2 E_0 E' \\cos\\theta$$\nSubstitute $K_e = E_0 - E'$ into the left side:\n$$(E_0 - E')^2 + 2 (E_0 - E') m_e c^2 = E_0^2 + E'^2 - 2 E_0 E' \\cos\\theta$$\n$$E_0^2 - 2 E_0 E' + E'^2 + 2 (E_0 - E') m_e c^2 = E_0^2 + E'^2 - 2 E_0 E' \\cos\\theta$$\nCanceling terms ($E_0^2$ and $E'^2$) from both sides:\n$$-2 E_0 E' + 2 (E_0 - E') m_e c^2 = -2 E_0 E' \\cos\\theta$$\nDividing by $2$:\n$$-E_0 E' + (E_0 - E') m_e c^2 = -E_0 E' \\cos\\theta$$\n$$(E_0 - E') m_e c^2 = E_0 E' (1 - \\cos\\theta)$$\nDividing by $E_0 E' m_e c^2$:\n$$\\frac{1}{E'} - \\frac{1}{E_0} = \\frac{1}{m_e c^2} (1 - \\cos\\theta)$$\nThis is the famous Compton scattering formula, which relates the scattered photon energy $E'$ to the incident energy $E_0$ and the scattering angle $\\theta$.\n\nTo find the kinetic energy of the electron, we first solve for $E'$:\n$$\\frac{1}{E'} = \\frac{1}{E_0} + \\frac{1 - \\cos\\theta}{m_e c^2} = \\frac{m_e c^2 + E_0(1 - \\cos\\theta)}{E_0 m_e c^2}$$\n$$E' = \\frac{E_0 m_e c^2}{m_e c^2 + E_0(1 - \\cos\\theta)} = \\frac{E_0}{1 + \\frac{E_0}{m_e c^2}(1 - \\cos\\theta)}$$\nNow, the kinetic energy of the electron is $K_e = E_0 - E'$:\n$$K_e = E_0 - \\frac{E_0}{1 + \\frac{E_0}{m_e c^2}(1 - \\cos\\theta)} = E_0 \\left( 1 - \\frac{1}{1 + \\frac{E_0}{m_e c^2}(1 - \\cos\\theta)} \\right)$$\n$$K_e = E_0 \\left( \\frac{1 + \\frac{E_0}{m_e c^2}(1 - \\cos\\theta) - 1}{1 + \\frac{E_0}{m_e c^2}(1 - \\cos\\theta)} \\right) = E_0 \\frac{\\frac{E_0}{m_e c^2}(1 - \\cos\\theta)}{1 + \\frac{E_0}{m_e c^2}(1 - \\cos\\theta)}$$\nThe kinetic energy $K_e$ is maximized when the term $(1 - \\cos\\theta)$ is maximized. This occurs when $\\cos\\theta = -1$, which corresponds to the photon backscattering at an angle of $\\theta = \\pi$ or $180^\\circ$. At this angle, $1 - \\cos\\theta = 2$.\nThe maximum kinetic energy, $K_{e,max}$, often called the Compton edge energy, is therefore:\n$$K_{e,max} = E_0 \\frac{\\frac{E_0}{m_e c^2}(2)}{1 + \\frac{E_0}{m_e c^2}(2)}$$\nThis can be rewritten by multiplying the numerator and denominator by $m_e c^2$:\n$$K_{e,max} = \\frac{2 E_0^2}{m_e c^2 + 2 E_0}$$\nThis is the general expression for the maximum kinetic energy transferred to the recoil electron.\n\nNow, we evaluate this expression for the given values: $E_0 = 511\\,\\mathrm{keV}$ and $m_e c^2 = 511\\,\\mathrm{keV}$.\n$$K_{e,max} = \\frac{2 (511\\,\\mathrm{keV})^2}{511\\,\\mathrm{keV} + 2 (511\\,\\mathrm{keV})} = \\frac{2 \\times 511^2}{3 \\times 511}\\,\\mathrm{keV}$$\n$$K_{e,max} = \\frac{2 \\times 511}{3}\\,\\mathrm{keV} = \\frac{1022}{3}\\,\\mathrm{keV} \\approx 340.666...\\,\\mathrm{keV}$$\nRounding the result to four significant figures gives $340.7\\,\\mathrm{keV}$.\n\nFinally, we address the complication of multi-site interactions in a thick crystal. The Compton edge at $K_{e,max} \\approx 340.7\\,\\mathrm{keV}$ represents the maximum energy deposited in a *single* Compton scattering event. In an ideal, thin detector, any energy deposition above this value (but below the photopeak) could be attributed to a photon that has already scattered in the patient and thus should be rejected.\n\nHowever, in a thick scintillation crystal (e.g., $\\geq 20\\,\\mathrm{mm}$), the photon scattered inside the crystal has a high probability of interacting again before escaping. The detector's electronics integrate the light produced by all interactions occurring within a very short time window into a single pulse. This pulse's height is proportional to the *sum* of the energies deposited in all interactions. For example, a $511\\,\\mathrm{keV}$ photon might undergo a first Compton scatter, depositing energy $K_{e1}$, and the scattered photon might then undergo a second Compton scatter, depositing $K_{e2}$, before the second scattered photon escapes. The total energy registered by the detector would be $E_{dep} = K_{e1} + K_{e2}$.\n\nThis summed energy $E_{dep}$ can exceed the single-scatter Compton edge, $K_{e,max}$. For instance, a series of two or more forward-scattering events can cumulatively deposit more energy than a single backscattering event. This phenomenon \"fills in\" the region of the energy spectrum between the Compton edge and the full-energy photopeak. As a result, the clean theoretical cutoff at the Compton edge is smeared out. This complicates energy-based scatter rejection because it is no longer possible to cleanly separate true (unscattered in the patient) events that undergo partial energy deposition via multiple scatters in the crystal from events where the photon was scattered in the patient and then detected. Setting an energy window to reject patient scatter becomes a trade-off: a narrow window around the photopeak might incorrectly reject true events with partial energy deposition, reducing sensitivity, while a wider window might incorrectly accept more patient-scattered events, reducing image contrast.", "answer": "$$\\boxed{340.7}$$", "id": "4868453"}, {"introduction": "Identifying two photons as a coincidence pair requires measuring their arrival times with exquisite precision. However, detector signals vary in amplitude, which can introduce a timing error known as 'timing walk' if a simple threshold is used. This exercise [@problem_id:4868427] explores how the choice of electronic timing method—contrasting a basic Leading-Edge Discriminator (LED) with a more sophisticated Constant Fraction Discriminator (CFD)—dramatically affects the final timing resolution. By quantifying the improvement, you will understand a critical engineering principle behind high-performance PET systems, especially those using Time-of-Flight.", "problem": "A pair of identical detection channels in Positron Emission Tomography (PET) perform coincidence timing on annihilation photon events using either a Leading-Edge Discriminator (LED) or a Constant Fraction Discriminator (CFD). Each channel produces an analog scintillation pulse that, near its leading edge, is well approximated by the causal single-pole response to a step, modeled as $v(t) = A\\left(1 - \\exp\\left(-\\frac{t}{\\tau}\\right)\\right)$ for $t \\geq 0$, where $A$ is the pulse amplitude and $\\tau$ is the characteristic rise time constant determined by the detector and front-end electronics. The LED triggers when $v(t)$ crosses a fixed threshold $V_{\\mathrm{th}}$. The CFD triggers when $v(t)$ reaches a fixed fraction $f$ of the pulse amplitude, i.e., the trigger condition is $v(t) = fA$. Assume that, for an ensemble of events, the amplitude $A$ is normally distributed with mean $A_0$ and standard deviation $\\sigma_A$, and that there is an additional amplitude-independent single-channel random timing jitter $\\sigma_{\\mathrm{noise}}$ arising from photostatistics and electronics noise. You may assume the time pick-off distribution of each channel is well approximated as Gaussian due to the central limit effect of small fluctuations.\n\nFrom first principles and the definitions above:\n- Derive the LED trigger time $t_{\\mathrm{LED}}(A)$ by solving the threshold crossing condition, and obtain its sensitivity to amplitude via $\\frac{dt_{\\mathrm{LED}}}{dA}$ evaluated at $A_0$.\n- Using a first-order linearization around $A_0$, propagate the amplitude variance into timing variance to obtain the amplitude-induced single-channel standard deviation $\\sigma_{t,\\mathrm{walk}}$ for LED.\n- Write the total single-channel timing standard deviations for LED and CFD, denoted $\\sigma_{\\mathrm{LED}}$ and $\\sigma_{\\mathrm{CFD}}$, respectively, under the assumption that CFD eliminates amplitude-dependent timing walk for this pulse model.\n- For two identical channels forming a coincidence, express the coincidence timing standard deviation $\\sigma_{\\mathrm{coinc}}$ in terms of the single-channel standard deviations. Then convert each to a coincidence Full Width at Half Maximum (FWHM) using the Gaussian relation between standard deviation and FWHM.\n\nUse the following parameter values: $A_0 = 1.0~\\mathrm{V}$, $\\sigma_A = 0.20~\\mathrm{V}$, $\\tau = 1.5~\\mathrm{ns}$, $V_{\\mathrm{th}} = 0.30~\\mathrm{V}$, $f = 0.30$, and $\\sigma_{\\mathrm{noise}} = 60~\\mathrm{ps}$. Compute the numerical difference between the LED-based and CFD-based coincidence FWHM values, defined as $\\Delta_{\\mathrm{FWHM}} = \\mathrm{FWHM}_{\\mathrm{LED}} - \\mathrm{FWHM}_{\\mathrm{CFD}}$.\n\nExpress your final answer in picoseconds and round your result to three significant figures.", "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the principles of nuclear instrumentation and signal processing for Positron Emission Tomography (PET). The problem is well-posed, providing a complete set of definitions, parameters, and assumptions necessary to derive a unique solution. The language is objective and formal. Therefore, a reasoned solution can be provided.\n\nThe analog scintillation pulse is modeled by the function $v(t) = A\\left(1 - \\exp\\left(-\\frac{t}{\\tau}\\right)\\right)$ for $t \\geq 0$, where $A$ is the pulse amplitude and $\\tau$ is the rise time constant.\n\nFirst, we derive the trigger time for the Leading-Edge Discriminator (LED), denoted $t_{\\mathrm{LED}}(A)$. The LED triggers when the pulse voltage $v(t)$ crosses a fixed threshold $V_{\\mathrm{th}}$. The condition is:\n$$A\\left(1 - \\exp\\left(-\\frac{t_{\\mathrm{LED}}}{\\tau}\\right)\\right) = V_{\\mathrm{th}}$$\nTo solve for $t_{\\mathrm{LED}}$, we rearrange the equation:\n$$1 - \\exp\\left(-\\frac{t_{\\mathrm{LED}}}{\\tau}\\right) = \\frac{V_{\\mathrm{th}}}{A}$$\n$$\\exp\\left(-\\frac{t_{\\mathrm{LED}}}{\\tau}\\right) = 1 - \\frac{V_{\\mathrm{th}}}{A}$$\nTaking the natural logarithm of both sides:\n$$-\\frac{t_{\\mathrm{LED}}}{\\tau} = \\ln\\left(1 - \\frac{V_{\\mathrm{th}}}{A}\\right)$$\nThis yields the LED trigger time as a function of amplitude $A$:\n$$t_{\\mathrm{LED}}(A) = -\\tau \\ln\\left(1 - \\frac{V_{\\mathrm{th}}}{A}\\right)$$\nThis expression is valid for $A > V_{\\mathrm{th}}$.\n\nNext, we find the sensitivity of the trigger time to amplitude variations by differentiating $t_{\\mathrm{LED}}(A)$ with respect to $A$:\n$$\\frac{dt_{\\mathrm{LED}}}{dA} = \\frac{d}{dA}\\left[-\\tau \\ln\\left(1 - \\frac{V_{\\mathrm{th}}}{A}\\right)\\right]$$\nUsing the chain rule, $\\frac{d}{dx}\\ln(u) = \\frac{1}{u}\\frac{du}{dx}$, with $u(A) = 1 - V_{\\mathrm{th}}A^{-1}$:\n$$\\frac{du}{dA} = \\frac{d}{dA}\\left(1 - V_{\\mathrm{th}}A^{-1}\\right) = -V_{\\mathrm{th}}(-1)A^{-2} = \\frac{V_{\\mathrm{th}}}{A^2}$$\nSubstituting this into the derivative for $t_{\\mathrm{LED}}$:\n$$\\frac{dt_{\\mathrm{LED}}}{dA} = -\\tau \\left(\\frac{1}{1 - \\frac{V_{\\mathrm{th}}}{A}}\\right) \\left(\\frac{V_{\\mathrm{th}}}{A^2}\\right) = -\\tau \\left(\\frac{A}{A - V_{\\mathrm{th}}}\\right) \\left(\\frac{V_{\\mathrm{th}}}{A^2}\\right) = -\\frac{\\tau V_{\\mathrm{th}}}{A(A - V_{\\mathrm{th}})}$$\nWe evaluate this sensitivity at the mean amplitude $A = A_0$:\n$$\\left.\\frac{dt_{\\mathrm{LED}}}{dA}\\right|_{A=A_0} = -\\frac{\\tau V_{\\mathrm{th}}}{A_0(A_0 - V_{\\mathrm{th}})}$$\n\nUsing a first-order linearization, we propagate the variance of the amplitude distribution, $\\sigma_A^2$, into a timing variance. The resulting standard deviation in timing due to amplitude walk, $\\sigma_{t,\\mathrm{walk}}$, is given by:\n$$\\sigma_{t,\\mathrm{walk}} = \\left| \\left.\\frac{dt_{\\mathrm{LED}}}{dA}\\right|_{A=A_0} \\right| \\sigma_A$$\nSince all parameters ($\\tau$, $V_{\\mathrm{th}}$, $A_0$, $\\sigma_A$) are positive and $A_0 > V_{\\mathrm{th}}$, the expression inside the absolute value is negative, so we take its negative to get the magnitude:\n$$\\sigma_{t,\\mathrm{walk}} = \\frac{\\tau V_{\\mathrm{th}}}{A_0(A_0 - V_{\\mathrm{th}})} \\sigma_A$$\n\nThe total single-channel timing variance is the sum of the variances from independent noise sources. For the LED, these sources are the timing walk ($\\sigma_{t,\\mathrm{walk}}$) and the intrinsic electronic/photostatistical jitter ($\\sigma_{\\mathrm{noise}}$). Variances add in quadrature:\n$$\\sigma_{\\mathrm{LED}}^2 = \\sigma_{t,\\mathrm{walk}}^2 + \\sigma_{\\mathrm{noise}}^2 \\implies \\sigma_{\\mathrm{LED}} = \\sqrt{\\sigma_{t,\\mathrm{walk}}^2 + \\sigma_{\\mathrm{noise}}^2}$$\nFor the Constant Fraction Discriminator (CFD), the trigger condition is $v(t) = fA$. For the given pulse shape, $A\\left(1 - \\exp\\left(-\\frac{t_{\\mathrm{CFD}}}{\\tau}\\right)\\right) = fA$, which simplifies to $1 - \\exp\\left(-\\frac{t_{\\mathrm{CFD}}}{\\tau}\\right) = f$. The solution for $t_{\\mathrm{CFD}}$ is independent of $A$, meaning the CFD perfectly eliminates timing walk for this pulse model. Thus, the only contribution to its timing jitter is the intrinsic noise:\n$$\\sigma_{\\mathrm{CFD}} = \\sigma_{\\mathrm{noise}}$$\n\nFor a coincidence measurement between two identical, independent detector channels, the timing resolution is determined by the distribution of the time difference $t_{\\mathrm{coinc}} = t_1 - t_2$. The variance of this difference is the sum of the individual channel variances: $\\sigma_{\\mathrm{coinc}}^2 = \\sigma_1^2 + \\sigma_2^2$. For identical channels with single-channel standard deviation $\\sigma_{\\mathrm{single}}$, this becomes $\\sigma_{\\mathrm{coinc}}^2 = 2\\sigma_{\\mathrm{single}}^2$, so $\\sigma_{\\mathrm{coinc}} = \\sqrt{2}\\sigma_{\\mathrm{single}}$.\nThe Full Width at Half Maximum (FWHM) of a Gaussian distribution is related to its standard deviation $\\sigma$ by $\\mathrm{FWHM} = 2\\sqrt{2\\ln(2)}\\sigma$.\nThe coincidence FWHM is therefore:\n$$\\mathrm{FWHM}_{\\mathrm{coinc}} = 2\\sqrt{2\\ln(2)}\\sigma_{\\mathrm{coinc}} = 2\\sqrt{2\\ln(2)}\\left(\\sqrt{2}\\sigma_{\\mathrm{single}}\\right) = 2\\sqrt{4\\ln(2)}\\sigma_{\\mathrm{single}}$$\nThe difference in FWHM between the LED and CFD systems is:\n$$\\Delta_{\\mathrm{FWHM}} = \\mathrm{FWHM}_{\\mathrm{LED}} - \\mathrm{FWHM}_{\\mathrm{CFD}} = 2\\sqrt{4\\ln(2)}\\sigma_{\\mathrm{LED}} - 2\\sqrt{4\\ln(2)}\\sigma_{\\mathrm{CFD}}$$\n$$\\Delta_{\\mathrm{FWHM}} = 2\\sqrt{4\\ln(2)}\\left(\\sigma_{\\mathrm{LED}} - \\sigma_{\\mathrm{CFD}}\\right)$$\n\nWe now compute the numerical value. The given parameters are:\n$A_0 = 1.0~\\mathrm{V}$, $\\sigma_A = 0.20~\\mathrm{V}$, $\\tau = 1.5~\\mathrm{ns} = 1500~\\mathrm{ps}$, $V_{\\mathrm{th}} = 0.30~\\mathrm{V}$, $\\sigma_{\\mathrm{noise}} = 60~\\mathrm{ps}$.\n\nFirst, we calculate the timing walk standard deviation for the LED:\n$$\\sigma_{t,\\mathrm{walk}} = \\frac{(1500~\\mathrm{ps})(0.30~\\mathrm{V})}{(1.0~\\mathrm{V})(1.0~\\mathrm{V} - 0.30~\\mathrm{V})} (0.20~\\mathrm{V}) = \\frac{450}{0.70} \\times 0.20~\\mathrm{ps} = \\frac{90}{0.7}~\\mathrm{ps} = \\frac{900}{7}~\\mathrm{ps}$$\n$$\\sigma_{t,\\mathrm{walk}} \\approx 128.571~\\mathrm{ps}$$\nNext, we calculate the total single-channel standard deviation for the LED:\n$$\\sigma_{\\mathrm{LED}} = \\sqrt{\\left(\\frac{900}{7}\\right)^2 + (60)^2}~\\mathrm{ps} = \\sqrt{\\frac{810000}{49} + 3600}~\\mathrm{ps} = \\sqrt{\\frac{810000 + 176400}{49}}~\\mathrm{ps}$$\n$$\\sigma_{\\mathrm{LED}} = \\sqrt{\\frac{986400}{49}}~\\mathrm{ps} \\approx \\sqrt{20130.61}~\\mathrm{ps} \\approx 141.882~\\mathrm{ps}$$\nThe single-channel standard deviation for the CFD is:\n$$\\sigma_{\\mathrm{CFD}} = \\sigma_{\\mathrm{noise}} = 60~\\mathrm{ps}$$\nNow we compute the final difference in coincidence FWHM:\n$$\\Delta_{\\mathrm{FWHM}} = 2\\sqrt{4\\ln(2)}\\left(141.882... - 60\\right)~\\mathrm{ps}$$\n$$\\Delta_{\\mathrm{FWHM}} = 2\\sqrt{4\\ln(2)}\\left(81.882...\\right)~\\mathrm{ps}$$\nThe pre-factor is $2\\sqrt{4\\ln(2)} \\approx 2\\sqrt{4(0.693147)} \\approx 2\\sqrt{2.772588} \\approx 3.330218$.\n$$\\Delta_{\\mathrm{FWHM}} \\approx 3.330218 \\times 81.882...~\\mathrm{ps} \\approx 272.6715~\\mathrm{ps}$$\nRounding the result to three significant figures gives $273~\\mathrm{ps}$.", "answer": "$$\\boxed{273}$$", "id": "4868427"}, {"introduction": "With state-of-the-art timing resolution, we can go beyond simply confirming a coincidence; we can use the time difference to estimate *where* along the line-of-response (LOR) the annihilation occurred. This practice [@problem_id:4868397] introduces the powerful concept of Time-of-Flight (TOF) reconstruction by guiding you through the development of a Maximum-Likelihood Estimator (MLE) for the event's position. You will formalize the link between a noisy time measurement and the most probable source location, and also investigate how systematic errors like clock offsets can introduce a bias in the final estimate, highlighting the importance of careful system calibration.", "problem": "In a Time-of-Flight Positron Emission Tomography (TOF-PET) system, two detectors placed at opposite ends of a line-of-response (LOR) detect in coincidence two back-to-back annihilation photons of energy approximately $511\\,\\text{keV}$. Let the LOR be parameterized by a coordinate $s$ with $s=0$ at the geometric midpoint between the detectors and $s>0$ increasing toward detector $2$. Neglect non-collinearity and assume the photons propagate at the speed of light $c$ in vacuum.\n\nAn annihilation occurs at an unknown position $s$ along the LOR. The distances from the emission point to the two detectors are $d_{1}$ and $d_{2}$, respectively. The corresponding ideal arrival times at detectors $1$ and $2$ are $t_{1} = t_{0} + d_{1}/c$ and $t_{2} = t_{0} + d_{2}/c$, where $t_{0}$ is the (unknown) emission time. The measured time difference between the two detectors is modeled as a single noisy observation\n$$\n\\Delta t = t_{2} - t_{1} + \\varepsilon,\n$$\nwhere $\\varepsilon$ is zero-mean Gaussian timing noise with known variance $\\sigma_{t}^{2}$, i.e., $\\varepsilon \\sim \\mathcal{N}(0,\\sigma_{t}^{2})$. You may assume that the detector pair is symmetric about $s=0$ so that $d_{1} = \\frac{L}{2} + s$ and $d_{2} = \\frac{L}{2} - s$ for some known separation $L$, and that the annihilation photons are emitted simultaneously in the center-of-mass frame so that any difference in ideal arrival times arises only from the path length difference.\n\n1) Starting from these principles, write down the likelihood of the unknown position $s$ given a single measured time difference $\\Delta t$ and derive the maximum-likelihood estimator $\\hat{s}_{\\text{ML}}$ as an explicit function of the measured $\\Delta t$, the speed of light $c$, and the known variance $\\sigma_{t}^{2}$.\n\n2) Now suppose that the system clocks suffer a constant, unknown offset $\\delta$ so that the measurement model becomes\n$$\n\\Delta t_{\\text{meas}} = \\left(t_{2} - t_{1}\\right) + \\delta + \\varepsilon.\n$$\nIf one naively continues to use the estimator from part (1) while ignoring $\\delta$, compute the bias of this estimator, defined as $\\mathrm{Bias}(\\hat{s}) = \\mathbb{E}[\\hat{s} - s]$, in terms of $\\delta$ and $c$.\n\nProvide your final answer as a pair consisting of the maximum-likelihood estimator from part (1) and the bias from part (2). No numerical evaluation is required. Express $s$ and the bias in meters. Do not include units in your final boxed answer.", "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n- **System:** Time-of-Flight Positron Emission Tomography (TOF-PET).\n- **Physics:** Detection of two back-to-back annihilation photons, each with energy approximately $511\\,\\text{keV}$.\n- **Geometry:** Detectors are at opposite ends of a Line-of-Response (LOR). The LOR is parameterized by coordinate $s$, with $s=0$ at the geometric midpoint. The total separation between detectors is $L$.\n- **Photon Propagation:** Photons propagate at the speed of light in vacuum, $c$. Non-collinearity is neglected.\n- **Annihilation Position:** An unknown position $s$ along the LOR.\n- **Distances:** The distances from the emission point at $s$ to detector 1 and detector 2 are $d_{1} = \\frac{L}{2} + s$ and $d_{2} = \\frac{L}{2} - s$, respectively.\n- **Ideal Times:** Ideal arrival times are $t_{1} = t_{0} + d_{1}/c$ and $t_{2} = t_{0} + d_{2}/c$, where $t_{0}$ is the unknown emission time. Photons are emitted simultaneously in the center-of-mass frame.\n- **Measurement Model 1:** $\\Delta t = t_{2} - t_{1} + \\varepsilon$, where $\\varepsilon$ is a random noise term.\n- **Noise Model:** $\\varepsilon \\sim \\mathcal{N}(0,\\sigma_{t}^{2})$, with $\\sigma_{t}^{2}$ being a known variance.\n- **Task 1:** Derive the maximum-likelihood estimator (MLE) $\\hat{s}_{\\text{ML}}$ as an explicit function of $\\Delta t$, $c$, and $\\sigma_{t}^{2}$.\n- **Measurement Model 2:** $\\Delta t_{\\text{meas}} = (t_{2} - t_{1}) + \\delta + \\varepsilon$, where $\\delta$ is a constant, unknown clock offset.\n- **Task 2:** Compute the bias of the estimator from Part 1, $\\mathrm{Bias}(\\hat{s}) = \\mathbb{E}[\\hat{s} - s]$, when naively applied to the second measurement model. The bias should be in terms of $\\delta$ and $c$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding:** The problem describes a simplified but standard and physically correct model for TOF-PET imaging. The concepts of positron annihilation, $511\\,\\text{keV}$ back-to-back photons, time-of-flight difference, and Gaussian timing resolution are fundamental to the field. All premises are factually sound.\n- **Well-Posedness:** The problem is well-posed. Part 1 requires finding the maximum of a likelihood function, which is a standard procedure in estimation theory. Part 2 asks for the bias of an estimator, a well-defined statistical quantity. The provided information is sufficient to derive unique answers for both parts.\n- **Objectivity & Completeness:** The problem is stated in precise, objective mathematical language. All necessary variables and relationships ($d_1(s)$, $d_2(s)$, $\\mathcal{N}(0, \\sigma_t^2)$) are explicitly defined. There are no ambiguities, contradictions, or missing information.\n- **Realism:** The model uses idealizations (e.g., propagation in vacuum, perfect collinearity) which are common for creating tractable physics problems. These simplifications do not render the problem scientifically invalid or physically impossible.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. The solution process will now proceed.\n\n### Solution Derivation\n\n**Part 1: Maximum-Likelihood Estimator $\\hat{s}_{\\text{ML}}$**\n\nThe ideal time difference between the arrival of the two photons at their respective detectors, $\\Delta t_{\\text{ideal}}$, is given by the difference in their path lengths divided by the speed of light $c$.\nLet $\\Delta t_{\\text{ideal}} = t_2 - t_1$. Using the given expressions for $t_1$ and $t_2$:\n$$\n\\Delta t_{\\text{ideal}} = \\left(t_{0} + \\frac{d_{2}}{c}\\right) - \\left(t_{0} + \\frac{d_{1}}{c}\\right) = \\frac{d_{2} - d_{1}}{c}\n$$\nSubstituting the geometric relations for $d_1$ and $d_2$:\n$$\nd_{1} = \\frac{L}{2} + s \\quad \\text{and} \\quad d_{2} = \\frac{L}{2} - s\n$$\nThe difference $d_{2} - d_{1}$ is:\n$$\nd_{2} - d_{1} = \\left(\\frac{L}{2} - s\\right) - \\left(\\frac{L}{2} + s\\right) = -2s\n$$\nThus, the ideal time difference is directly proportional to the position $s$:\n$$\n\\Delta t_{\\text{ideal}} = -\\frac{2s}{c}\n$$\nThe measurement model for a single observation $\\Delta t$ is:\n$$\n\\Delta t = \\Delta t_{\\text{ideal}} + \\varepsilon = -\\frac{2s}{c} + \\varepsilon\n$$\nwhere the noise term $\\varepsilon$ is a random variable drawn from a Gaussian distribution with mean $0$ and variance $\\sigma_t^2$, i.e., $\\varepsilon \\sim \\mathcal{N}(0, \\sigma_t^2)$.\n\nTo find the maximum-likelihood estimator for $s$, we first write the likelihood function, $p(\\Delta t | s)$, which is the probability density of observing the measurement $\\Delta t$ given a true position $s$. From the measurement model, we can see that $\\Delta t$ is a Gaussian random variable with mean $-\\frac{2s}{c}$ and variance $\\sigma_t^2$.\n$$\n\\Delta t \\sim \\mathcal{N}\\left(-\\frac{2s}{c}, \\sigma_{t}^{2}\\right)\n$$\nThe likelihood function is therefore the probability density function (PDF) of this normal distribution:\n$$\nL(s | \\Delta t) = p(\\Delta t | s) = \\frac{1}{\\sqrt{2\\pi\\sigma_{t}^{2}}} \\exp\\left( -\\frac{\\left(\\Delta t - \\left(-\\frac{2s}{c}\\right)\\right)^{2}}{2\\sigma_{t}^{2}} \\right) = \\frac{1}{\\sqrt{2\\pi\\sigma_{t}^{2}}} \\exp\\left( -\\frac{\\left(\\Delta t + \\frac{2s}{c}\\right)^{2}}{2\\sigma_{t}^{2}} \\right)\n$$\nTo find the value of $s$ that maximizes this likelihood, it is computationally simpler to maximize its natural logarithm, the log-likelihood function $\\ell(s | \\Delta t) = \\ln L(s | \\Delta t)$.\n$$\n\\ell(s | \\Delta t) = \\ln\\left(\\frac{1}{\\sqrt{2\\pi\\sigma_{t}^{2}}}\\right) - \\frac{\\left(\\Delta t + \\frac{2s}{c}\\right)^{2}}{2\\sigma_{t}^{2}}\n$$\nWe find the maximum by taking the derivative of the log-likelihood with respect to $s$ and setting it to zero.\n$$\n\\frac{d\\ell}{ds} = \\frac{d}{ds} \\left[ -\\ln(\\sqrt{2\\pi\\sigma_{t}^{2}}) - \\frac{1}{2\\sigma_{t}^{2}}\\left(\\Delta t + \\frac{2s}{c}\\right)^{2} \\right] \\\\\n= -\\frac{1}{2\\sigma_{t}^{2}} \\cdot 2\\left(\\Delta t + \\frac{2s}{c}\\right) \\cdot \\frac{d}{ds}\\left(\\Delta t + \\frac{2s}{c}\\right) \\\\\n= -\\frac{1}{\\sigma_{t}^{2}}\\left(\\Delta t + \\frac{2s}{c}\\right) \\left(\\frac{2}{c}\\right)\n$$\nSetting the derivative to zero to find the critical point, which corresponds to the MLE $\\hat{s}_{\\text{ML}}$:\n$$\n-\\frac{2}{c\\sigma_{t}^{2}}\\left(\\Delta t + \\frac{2\\hat{s}_{\\text{ML}}}{c}\\right) = 0\n$$\nSince the pre-factor $-\\frac{2}{c\\sigma_{t}^{2}}$ is non-zero, the expression in the parenthesis must be zero:\n$$\n\\Delta t + \\frac{2\\hat{s}_{\\text{ML}}}{c} = 0\n$$\nSolving for $\\hat{s}_{\\text{ML}}$ gives the maximum-likelihood estimator:\n$$\n\\hat{s}_{\\text{ML}} = -\\frac{c \\Delta t}{2}\n$$\nThe second derivative, $\\frac{d^2\\ell}{ds^2} = -\\frac{4}{c^2\\sigma_{t}^{2}}$, is negative, confirming that this is a maximum. Note that the estimator does not depend on the noise variance $\\sigma_t^2$, although its derivation requires the assumption of a Gaussian model for which $\\sigma_t^2$ is a parameter.\n\n**Part 2: Bias of the Estimator with Clock Offset**\n\nIn this part, the measurement model is altered by a constant, unknown clock offset $\\delta$:\n$$\n\\Delta t_{\\text{meas}} = (t_{2} - t_{1}) + \\delta + \\varepsilon = -\\frac{2s}{c} + \\delta + \\varepsilon\n$$\nThe problem states that one naively continues to use the estimator from Part 1. This means replacing $\\Delta t$ with $\\Delta t_{\\text{meas}}$ in the expression for $\\hat{s}_{\\text{ML}}$. Let's call this naive estimator $\\hat{s}_{\\text{naive}}$.\n$$\n\\hat{s}_{\\text{naive}} = -\\frac{c \\Delta t_{\\text{meas}}}{2}\n$$\nWe substitute the expression for $\\Delta t_{\\text{meas}}$ into the estimator formula:\n$$\n\\hat{s}_{\\text{naive}} = -\\frac{c}{2} \\left(-\\frac{2s}{c} + \\delta + \\varepsilon\\right) = s - \\frac{c\\delta}{2} - \\frac{c\\varepsilon}{2}\n$$\nThe bias of an estimator $\\hat{s}$ is defined as $\\mathrm{Bias}(\\hat{s}) = \\mathbb{E}[\\hat{s} - s]$, where the expectation $\\mathbb{E}[\\cdot]$ is taken with respect to the probability distribution of the random variables in the model, which is just $\\varepsilon$ in this case. The true position $s$ and the offset $\\delta$ are treated as non-random parameters.\n$$\n\\mathrm{Bias}(\\hat{s}_{\\text{naive}}) = \\mathbb{E}[\\hat{s}_{\\text{naive}} - s] = \\mathbb{E}\\left[\\left(s - \\frac{c\\delta}{2} - \\frac{c\\varepsilon}{2}\\right) - s\\right]\n$$\n$$\n\\mathrm{Bias}(\\hat{s}_{\\text{naive}}) = \\mathbb{E}\\left[-\\frac{c\\delta}{2} - \\frac{c\\varepsilon}{2}\\right]\n$$\nUsing the linearity of expectation:\n$$\n\\mathrm{Bias}(\\hat{s}_{\\text{naive}}) = -\\mathbb{E}\\left[\\frac{c\\delta}{2}\\right] - \\mathbb{E}\\left[\\frac{c\\varepsilon}{2}\\right] = -\\frac{c\\delta}{2} - \\frac{c}{2}\\mathbb{E}[\\varepsilon]\n$$\nWe are given that the noise $\\varepsilon$ has a mean of zero, $\\mathbb{E}[\\varepsilon] = 0$. Therefore, the bias is:\n$$\n\\mathrm{Bias}(\\hat{s}_{\\text{naive}}) = -\\frac{c\\delta}{2} - \\frac{c}{2}(0) = -\\frac{c\\delta}{2}\n$$\nThe bias is a constant value that depends on the clock offset $\\delta$ and the speed of light $c$.\nThe final answer is the pair $(\\hat{s}_{\\text{ML}}, \\mathrm{Bias})$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{c \\Delta t}{2} & -\\frac{c\\delta}{2}\n\\end{pmatrix}\n}\n$$", "id": "4868397"}]}