{"hands_on_practices": [{"introduction": "This practice grounds our understanding of attenuation correction in the fundamental process of measurement. Before we can correct for attenuation, we must first accurately determine the linear attenuation coefficient, $\\mu$, of the tissues involved. This exercise [@problem_id:4863704] walks you through a simulated transmission scan, demonstrating how to calculate $\\mu$ from raw photon counts and, just as importantly, how to estimate the uncertainty in your measurement due to the inherent randomness of radioactive decay.", "problem": "A transmission measurement is performed to estimate the linear attenuation coefficient for attenuation correction in Single-Photon Emission Computed Tomography (SPECT). A monoenergetic Technetium-99m photon beam at energy $140~\\mathrm{keV}$ is incident on a homogeneous, water-equivalent slab. Assume a narrow-beam geometry so that only primary photons are detected, and scattering can be neglected. The slab thickness is measured as $x = 8.0~\\mathrm{cm}$ with negligible uncertainty relative to counting statistics. Two independent acquisitions of equal duration are performed with a calibrated gamma camera: one without the slab and one with the slab in place. The measured total counts are $N_{0} = 2.5 \\times 10^{6}$ counts without the slab and $N = 7.8 \\times 10^{5}$ counts with the slab.\n\nStarting from the exponential attenuation law for monoenergetic photons and assuming Poisson counting statistics for the independent measurements, derive an expression for the estimator of the linear attenuation coefficient $\\mu$ in terms of $N_{0}$, $N$, and $x$ and then use first-order uncertainty propagation to obtain the standard uncertainty (one standard deviation) of $\\mu$. Compute the numerical values using the measurements provided.\n\nRound both the estimated $\\mu$ and its standard uncertainty to four significant figures. Express the final values in $\\mathrm{cm}^{-1}$. Provide your final answer as two numbers in a single row, where the first number is the estimated $\\mu$ and the second number is its standard uncertainty.", "solution": "The user wants me to solve the following problem:\nA transmission measurement is performed to estimate the linear attenuation coefficient for attenuation correction in Single-Photon Emission Computed Tomography (SPECT). A monoenergetic Technetium-99m photon beam at energy $140~\\mathrm{keV}$ is incident on a homogeneous, water-equivalent slab. Assume a narrow-beam geometry so that only primary photons are detected, and scattering can be neglected. The slab thickness is measured as $x = 8.0~\\mathrm{cm}$ with negligible uncertainty relative to counting statistics. Two independent acquisitions of equal duration are performed with a calibrated gamma camera: one without the slab and one with the slab in place. The measured total counts are $N_{0} = 2.5 \\times 10^{6}$ counts without the slab and $N = 7.8 \\times 10^{5}$ counts with the slab.\n\nStarting from the exponential attenuation law for monoenergetic photons and assuming Poisson counting statistics for the independent measurements, derive an expression for the estimator of the linear attenuation coefficient $\\mu$ in terms of $N_{0}$, $N$, and $x$ and then use first-order uncertainty propagation to obtain the standard uncertainty (one standard deviation) of $\\mu$. Compute the numerical values using the measurements provided.\n\nRound both the estimated $\\mu$ and its standard uncertainty to four significant figures. Express the final values in $\\mathrm{cm}^{-1}$. Provide your final answer as two numbers in a single row, where the first number is the estimated $\\mu$ and the second number is its standard uncertainty.\n\n### Step 1: Extract Givens\n- Photon energy: $140~\\mathrm{keV}$ (from Technetium-99m)\n- Geometry: Narrow-beam\n- Slab thickness: $x = 8.0~\\mathrm{cm}$ (with negligible uncertainty)\n- Counts without slab: $N_{0} = 2.5 \\times 10^{6}$\n- Counts with slab: $N = 7.8 \\times 10^{5}$\n- Statistical model: Independent measurements with Poisson counting statistics.\n- Task: Derive the estimator for the linear attenuation coefficient $\\mu$ and its standard uncertainty $\\sigma_{\\mu}$. Compute their numerical values.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is based on the fundamental principle of exponential photon attenuation (Beer-Lambert law), a cornerstone of medical physics and imaging. The use of Tc-99m, a common medical isotope, with its $140~\\mathrm{keV}$ photons is standard in SPECT. The assumption of Poisson statistics for photon counting is a standard and accurate model for such quantum detection processes. The numerical values provided are realistic for a typical transmission scan. The problem is scientifically sound.\n2.  **Well-Posed**: The problem provides all necessary information ($N_0$, $N$, $x$) to determine a unique value for the estimator $\\hat{\\mu}$ and its uncertainty $\\sigma_{\\mu}$. The instructions are clear.\n3.  **Objective**: The problem is stated in precise, objective language, free of ambiguity or subjective claims.\n4.  **Completeness and Consistency**: The problem is self-contained. The given data are consistent and sufficient for a solution. The assumption of negligible uncertainty in $x$ simplifies the analysis appropriately for this level of problem.\n5.  **No other flaws detected**: The problem is not trivial, metaphorical, or outside the realm of scientific verification.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution.\n\n### Part 1: Derivation of the Estimator for $\\mu$\n\nThe attenuation of a monoenergetic, narrow beam of photons through a homogeneous material is described by the Beer-Lambert law:\n$$I = I_0 \\exp(-\\mu x)$$\nwhere $I_0$ is the incident photon intensity, $I$ is the transmitted photon intensity, $x$ is the thickness of the material, and $\\mu$ is the linear attenuation coefficient.\n\nIn a photon counting experiment, the number of detected counts is proportional to the photon intensity, assuming the detector area and counting time are constant. Let $N_0$ be the counts without the slab (proportional to $I_0$) and $N$ be the counts with the slab (proportional to $I$). We can write:\n$$N_0 = k I_0$$\n$$N = k I$$\nwhere $k$ is a constant of proportionality that depends on the detector efficiency, geometry, and acquisition time. Since these are the same for both measurements, we can establish a relationship between the counts:\n$$N = N_0 \\exp(-\\mu x)$$\nTo find the estimator for $\\mu$, which we denote as $\\hat{\\mu}$, we solve this equation for $\\mu$:\n$$\\frac{N}{N_0} = \\exp(-\\hat{\\mu} x)$$\nTaking the natural logarithm of both sides:\n$$\\ln\\left(\\frac{N}{N_0}\\right) = -\\hat{\\mu} x$$\nRearranging the terms gives the expression for the estimator $\\hat{\\mu}$:\n$$\\hat{\\mu} = -\\frac{1}{x} \\ln\\left(\\frac{N}{N_0}\\right) = \\frac{1}{x} \\ln\\left(\\frac{N_0}{N}\\right)$$\n\n### Part 2: Derivation of the Standard Uncertainty of $\\mu$\n\nWe use the formula for first-order uncertainty propagation. For a function $f(y_1, y_2, \\dots)$, the variance $\\sigma_f^2$ is approximately:\n$$\\sigma_f^2 \\approx \\sum_i \\left(\\frac{\\partial f}{\\partial y_i}\\right)^2 \\sigma_{y_i}^2 + \\sum_{i \\neq j} \\frac{\\partial f}{\\partial y_i} \\frac{\\partial f}{\\partial y_j} \\sigma_{y_i y_j}$$\nwhere $\\sigma_{y_i}^2$ is the variance of the variable $y_i$ and $\\sigma_{y_i y_j}$ is the covariance between $y_i$ and $y_j$.\n\nIn our case, the estimator $\\hat{\\mu}$ is a function of $N_0$, $N$, and $x$. The problem states that the uncertainty in $x$ is negligible, so we treat it as a constant. The measurements $N_0$ and $N$ are independent, so their covariance is zero ($\\sigma_{N_0 N} = 0$). The uncertainty propagation formula for $\\hat{\\mu}$ simplifies to:\n$$\\sigma_{\\mu}^2 \\approx \\left(\\frac{\\partial \\hat{\\mu}}{\\partial N_0}\\right)^2 \\sigma_{N_0}^2 + \\left(\\frac{\\partial \\hat{\\mu}}{\\partial N}\\right)^2 \\sigma_N^2$$\nThe problem specifies that the counts follow Poisson statistics. For a Poisson distribution, the variance of a measurement is equal to its mean value. The best estimate for the mean number of counts is the measured number of counts itself. Therefore:\n$$\\sigma_{N_0}^2 = N_0$$\n$$\\sigma_{N}^2 = N$$\n\nNext, we compute the partial derivatives of $\\hat{\\mu} = \\frac{1}{x}(\\ln(N_0) - \\ln(N))$:\n$$\\frac{\\partial \\hat{\\mu}}{\\partial N_0} = \\frac{\\partial}{\\partial N_0} \\left[\\frac{1}{x}(\\ln(N_0) - \\ln(N))\\right] = \\frac{1}{x N_0}$$\n$$\\frac{\\partial \\hat{\\mu}}{\\partial N} = \\frac{\\partial}{\\partial N} \\left[\\frac{1}{x}(\\ln(N_0) - \\ln(N))\\right] = -\\frac{1}{x N}$$\n\nSubstituting the derivatives and variances into the uncertainty formula:\n$$\\sigma_{\\mu}^2 \\approx \\left(\\frac{1}{x N_0}\\right)^2 (N_0) + \\left(-\\frac{1}{x N}\\right)^2 (N)$$\n$$\\sigma_{\\mu}^2 \\approx \\frac{1}{x^2 N_0^2} N_0 + \\frac{1}{x^2 N^2} N$$\n$$\\sigma_{\\mu}^2 \\approx \\frac{1}{x^2 N_0} + \\frac{1}{x^2 N}$$\n$$\\sigma_{\\mu}^2 \\approx \\frac{1}{x^2} \\left(\\frac{1}{N_0} + \\frac{1}{N}\\right)$$\nThe standard uncertainty $\\sigma_{\\mu}$ is the square root of the variance:\n$$\\sigma_{\\mu} = \\sqrt{\\frac{1}{x^2} \\left(\\frac{1}{N_0} + \\frac{1}{N}\\right)} = \\frac{1}{|x|} \\sqrt{\\frac{1}{N_0} + \\frac{1}{N}}$$\nSince thickness $x$ is positive, we can write:\n$$\\sigma_{\\mu} = \\frac{1}{x} \\sqrt{\\frac{1}{N_0} + \\frac{1}{N}}$$\n\n### Part 3: Numerical Computation\n\nWe are given the following values:\n$x = 8.0~\\mathrm{cm}$\n$N_0 = 2.5 \\times 10^6$\n$N = 7.8 \\times 10^5$\n\nFirst, we compute the value of the estimator $\\hat{\\mu}$:\n$$\\hat{\\mu} = \\frac{1}{8.0~\\mathrm{cm}} \\ln\\left(\\frac{2.5 \\times 10^6}{7.8 \\times 10^5}\\right)$$\n$$\\hat{\\mu} = \\frac{1}{8.0} \\ln\\left(\\frac{250}{78}\\right) \\approx \\frac{1}{8.0} \\ln(3.205128)$$\n$$\\hat{\\mu} \\approx \\frac{1.16478}{8.0} \\approx 0.1455975~\\mathrm{cm}^{-1}$$\nRounding to four significant figures, we get:\n$$\\hat{\\mu} \\approx 0.1456~\\mathrm{cm}^{-1}$$\n\nNext, we compute the standard uncertainty $\\sigma_{\\mu}$:\n$$\\sigma_{\\mu} = \\frac{1}{8.0~\\mathrm{cm}} \\sqrt{\\frac{1}{2.5 \\times 10^6} + \\frac{1}{7.8 \\times 10^5}}$$\n$$\\sigma_{\\mu} = \\frac{1}{8.0} \\sqrt{4.0 \\times 10^{-7} + 1.282051 \\times 10^{-6}}~\\mathrm{cm}^{-1}$$\n$$\\sigma_{\\mu} = \\frac{1}{8.0} \\sqrt{1.682051 \\times 10^{-6}}~\\mathrm{cm}^{-1}$$\n$$\\sigma_{\\mu} \\approx \\frac{1}{8.0} (1.296939 \\times 10^{-3})~\\mathrm{cm}^{-1}$$\n$$\\sigma_{\\mu} \\approx 0.000162117~\\mathrm{cm}^{-1}$$\nRounding to four significant figures, we get:\n$$\\sigma_{\\mu} \\approx 0.0001621~\\mathrm{cm}^{-1}$$\n\nThe estimated linear attenuation coefficient is $0.1456~\\mathrm{cm}^{-1}$ with a standard uncertainty of $0.0001621~\\mathrm{cm}^{-1}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1456 & 0.0001621\n\\end{pmatrix}\n}\n$$", "id": "4863704"}, {"introduction": "With an attenuation map in hand, how is it actually used to produce an accurate image? This practice [@problem_id:4863718] provides a look inside the widely used Maximum Likelihood Expectation Maximization (MLEM) iterative reconstruction algorithm. By working with a simplified two-voxel, two-detector system, you will see precisely how attenuation factors are built into the system model and how they influence the estimated activity in each voxel during a single update step.", "problem": "A Single Photon Emission Computed Tomography (SPECT) system acquires projection data in two bins from a simple one-dimensional object consisting of two voxels. The forward model assumes independently Poisson-distributed counts with mean given by the line integral of emitted activity modulated by system geometry and photon attenuation along the path. Specifically, each system matrix element encodes geometric sensitivity and an attenuation factor based on the Beer–Lambert law. Consider the following toy configuration designed to create different attenuations for the two voxels along two distinct bins, with distances measured along each ray path inside a uniform medium:\n- Linear attenuation coefficient: $\\mu = 0.15\\,\\mathrm{cm}^{-1}$.\n- Path lengths for bin $i$ and voxel $j$: $L_{11} = 22\\,\\mathrm{cm}$, $L_{12} = 6\\,\\mathrm{cm}$, $L_{21} = 8\\,\\mathrm{cm}$, $L_{22} = 24\\,\\mathrm{cm}$.\n- Geometric detection factors are taken equal and normalized so that geometry contributes a multiplicative factor of $1$ in each $H_{ij}$.\nThe measured projection counts are $y_{1} = 1200$ and $y_{2} = 900$. The initial voxel activities for Maximum Likelihood Expectation Maximization (MLEM) are $x_{1}^{(0)} = 1000$ and $x_{2}^{(0)} = 1000$ in arbitrary activity units.\n\nStarting from the Beer–Lambert law for attenuation and the Poisson measurement model for emission tomography, construct the two-by-two system matrix entries $H_{ij}$ for this configuration. Then, from the Poisson log-likelihood, derive the single-iteration MLEM update for emission tomography without background terms. Finally, using your derived update, compute the updated value $x_{1}^{(1)}$ after one iteration. Express your final numerical value in arbitrary activity units and round your answer to four significant figures.", "solution": "The user wants me to solve a problem related to SPECT reconstruction using the MLEM algorithm.\n\nHere's my plan:\n1.  **Validate the problem statement**: I'll meticulously check if the problem is self-contained, scientifically sound, and well-posed.\n2.  **Step 1: Extract Givens**: I will list all the provided data points and parameters verbatim.\n3.  **Step 2: Validate Using Extracted Givens**: I will check for any scientific flaws, inconsistencies, or missing information.\n    - The problem describes a standard setup in emission tomography.\n    - It provides a linear attenuation coefficient $\\mu$.\n    - It gives path lengths $L_{ij}$ for each voxel $j$ and projection bin $i$.\n    - It specifies that geometric factors are normalized to $1$.\n    - It provides measured counts $y_i$.\n    - It gives initial estimates for voxel activities $x_j^{(0)}$.\n    - The task is to construct the system matrix $H$, derive the MLEM update equation, and compute one iteration for $x_1^{(1)}$.\n    - The underlying physics (Beer-Lambert law, Poisson statistics) are standard for this field.\n    - The problem seems well-posed. It has a clear set of inputs and asks for a specific, computable output.\n    - The language is objective and precise.\n    - No obvious flaws are apparent. The problem is valid.\n\n4.  **If Valid (which it seems to be), proceed to the solution**:\n    - **Part 1: Construct the System Matrix H**.\n        - The problem states that the system matrix element $H_{ij}$ encodes geometric sensitivity and an attenuation factor.\n        - Geometric sensitivity is given as a factor of $1$.\n        - The attenuation factor is derived from the Beer-Lambert law: $A = \\exp(-\\mu L)$.\n        - So, $H_{ij} = (\\text{geometry factor}) \\times (\\text{attenuation factor}) = 1 \\times \\exp(-\\mu L_{ij})$.\n        - I need to calculate the four elements $H_{11}$, $H_{12}$, $H_{21}$, and $H_{22}$ using the given $\\mu$ and $L_{ij}$ values.\n        - $\\mu = 0.15\\,\\mathrm{cm}^{-1}$.\n        - $L_{11} = 22\\,\\mathrm{cm} \\implies H_{11} = \\exp(-0.15 \\times 22) = \\exp(-3.3)$.\n        - $L_{12} = 6\\,\\mathrm{cm} \\implies H_{12} = \\exp(-0.15 \\times 6) = \\exp(-0.9)$.\n        - $L_{21} = 8\\,\\mathrm{cm} \\implies H_{21} = \\exp(-0.15 \\times 8) = \\exp(-1.2)$.\n        - $L_{22} = 24\\,\\mathrm{cm} \\implies H_{22} = \\exp(-0.15 \\times 24) = \\exp(-3.6)$.\n\n    - **Part 2: Derive the MLEM update equation**.\n        - The forward model is given by the expected counts in bin $i$: $\\bar{y}_i = \\sum_{j} H_{ij} x_j$.\n        - The measurements $y_i$ are assumed to be independent Poisson random variables with mean $\\bar{y}_i$.\n        - The likelihood function is $L(x) = P(y|x) = \\prod_{i} \\frac{(\\bar{y}_i)^{y_i} \\exp(-\\bar{y}_i)}{y_i!}$.\n        - The log-likelihood function is $\\mathcal{L}(x) = \\ln(L(x)) = \\sum_{i} [y_i \\ln(\\bar{y}_i) - \\bar{y}_i - \\ln(y_i!)]$.\n        - Substituting $\\bar{y}_i = \\sum_{j} H_{ij} x_j$:\n          $\\mathcal{L}(x) = \\sum_{i} [y_i \\ln(\\sum_{j} H_{ij} x_j) - \\sum_{j} H_{ij} x_j] - \\sum_i \\ln(y_i!)$.\n        - To maximize this, we set the partial derivative with respect to each $x_k$ to zero:\n          $\\frac{\\partial \\mathcal{L}}{\\partial x_k} = \\sum_{i} [y_i \\frac{H_{ik}}{\\sum_{j} H_{ij} x_j} - H_{ik}] = 0$.\n        - This gives $\\sum_{i} H_{ik} = \\sum_{i} \\frac{y_i H_{ik}}{\\sum_{j} H_{ij} x_j}$.\n        - This is a non-linear system of equations. The MLEM algorithm provides an iterative solution.\n        - The derivation of the MLEM update rule is a standard result. It comes from the Expectation-Maximization framework applied to this \"incomplete data\" problem.\n        - The complete data would be the number of photons $z_{ij}$ emitted from voxel $j$ and detected in bin $i$.\n        - The update rule is:\n          $x_j^{(k+1)} = \\frac{x_j^{(k)}}{\\sum_{i} H_{ij}} \\sum_{i} H_{ij} \\frac{y_i}{\\sum_{l} H_{il} x_l^{(k)}}$.\n        - I should state this derivation clearly.\n          - Start with the log-likelihood: $\\mathcal{L}(x) = \\sum_i \\left( y_i \\ln(\\sum_j H_{ij} x_j) - \\sum_j H_{ij} x_j \\right)$ (ignoring constant terms).\n          - Differentiating w.r.t. $x_k$: $\\frac{\\partial \\mathcal{L}}{\\partial x_k} = \\sum_i \\left( \\frac{y_i H_{ik}}{\\sum_j H_{ij} x_j} - H_{ik} \\right)$.\n          - Setting to zero gives: $\\sum_i H_{ik} = \\sum_i \\frac{y_i H_{ik}}{\\sum_j H_{ij} x_j}$.\n          - The MLEM algorithm provides a fixed-point iteration to solve this. Rearranging the equation:\n            $1 = \\frac{1}{\\sum_i H_{ik}} \\sum_i \\frac{y_i H_{ik}}{\\sum_j H_{ij} x_j}$.\n            Multiply both sides by $x_k$:\n            $x_k = x_k \\frac{1}{\\sum_i H_{ik}} \\sum_i \\frac{y_i H_{ik}}{\\sum_j H_{ij} x_j}$.\n          - This motivates the iterative scheme:\n            $x_k^{(k+1)} = \\frac{x_k^{(k)}}{\\sum_i H_{ik}} \\sum_i \\frac{y_i H_{ik}}{\\sum_j H_{ij} x_j^{(k)}}$.\n          - This is the formula I need to use.\n\n    - **Part 3: Compute the updated value $x_{1}^{(1)}$**.\n        - The problem asks for $x_{1}^{(1)}$. The formula is:\n          $x_{1}^{(1)} = \\frac{x_{1}^{(0)}}{\\sum_{i=1}^{2} H_{i1}} \\sum_{i=1}^{2} H_{i1} \\frac{y_i}{\\sum_{j=1}^{2} H_{ij} x_j^{(0)}}$.\n        - I have all the components:\n            - $x_1^{(0)} = 1000$\n            - $x_2^{(0)} = 1000$\n            - $y_1 = 1200$\n            - $y_2 = 900$\n            - $H_{11} = \\exp(-3.3)$\n            - $H_{12} = \\exp(-0.9)$\n            - $H_{21} = \\exp(-1.2)$\n            - $H_{22} = \\exp(-3.6)$\n        - Let's assemble the terms.\n        - The denominator for the outer sum is the sensitivity of voxel 1: $S_1 = \\sum_{i} H_{i1} = H_{11} + H_{21} = \\exp(-3.3) + \\exp(-1.2)$.\n        - The inner sums are the forward projections for the current estimate $x^{(0)}$:\n            - $\\bar{y}_1^{(0)} = \\sum_{j} H_{1j} x_j^{(0)} = H_{11} x_1^{(0)} + H_{12} x_2^{(0)} = 1000(\\exp(-3.3) + \\exp(-0.9))$.\n            - $\\bar{y}_2^{(0)} = \\sum_{j} H_{2j} x_j^{(0)} = H_{21} x_1^{(0)} + H_{22} x_2^{(0)} = 1000(\\exp(-1.2) + \\exp(-3.6))$.\n        - Now put it all into the formula for $x_1^{(1)}$:\n          $x_{1}^{(1)} = \\frac{x_{1}^{(0)}}{S_1} \\left( H_{11} \\frac{y_1}{\\bar{y}_1^{(0)}} + H_{21} \\frac{y_2}{\\bar{y}_2^{(0)}} \\right)$\n          $x_{1}^{(1)} = \\frac{1000}{\\exp(-3.3) + \\exp(-1.2)} \\left( H_{11} \\frac{1200}{1000(\\exp(-3.3) + \\exp(-0.9))} + H_{21} \\frac{900}{1000(\\exp(-1.2) + \\exp(-3.6))} \\right)$\n          $x_{1}^{(1)} = \\frac{1000}{\\exp(-3.3) + \\exp(-1.2)} \\left( \\frac{1.2 \\exp(-3.3)}{\\exp(-3.3) + \\exp(-0.9)} + \\frac{0.9 \\exp(-1.2)}{\\exp(-1.2) + \\exp(-3.6)} \\right)$\n\n    - **Part 4: Numerical Calculation**.\n        - I need to calculate the values of the exponentials.\n        - $\\exp(-3.3) \\approx 0.036883$\n        - $\\exp(-0.9) \\approx 0.406570$\n        - $\\exp(-1.2) \\approx 0.301194$\n        - $\\exp(-3.6) \\approx 0.027324$\n        - Let's check these values with a calculator for more precision.\n        - `exp(-3.3)` = 0.0368831671\n        - `exp(-0.9)` = 0.4065696597\n        - `exp(-1.2)` = 0.3011942119\n        - `exp(-3.6)` = 0.0273237224\n        - Now, calculate the intermediate terms:\n        - $S_1 = H_{11} + H_{21} = 0.0368831671 + 0.3011942119 = 0.338077379$\n        - $\\bar{y}_1^{(0)} = 1000 \\times (H_{11} + H_{12}) = 1000 \\times (0.0368831671 + 0.4065696597) = 1000 \\times 0.4434528268 = 443.4528268$\n        - $\\bar{y}_2^{(0)} = 1000 \\times (H_{21} + H_{22}) = 1000 \\times (0.3011942119 + 0.0273237224) = 1000 \\times 0.3285179343 = 328.5179343$\n        - Now the two terms inside the parenthesis:\n          - Term 1: $H_{11} \\frac{y_1}{\\bar{y}_1^{(0)}} = 0.0368831671 \\times \\frac{1200}{443.4528268} = 0.0368831671 \\times 2.7060375 = 0.0997972$\n          - Term 2: $H_{21} \\frac{y_2}{\\bar{y}_2^{(0)}} = 0.3011942119 \\times \\frac{900}{328.5179343} = 0.3011942119 \\times 2.7395698 = 0.8251578$\n          - Sum of terms = $0.0997972 + 0.8251578 = 0.924955$\n        - Final calculation for $x_1^{(1)}$:\n          $x_1^{(1)} = \\frac{x_1^{(0)}}{S_1} \\times (\\text{Sum of terms}) = \\frac{1000}{0.338077379} \\times 0.924955$\n          $x_1^{(1)} = 2957.751 \\times 0.924955 = 2735.808...$\n\n        Let me double check the calculation using the symbolic form to avoid intermediate rounding errors.\n        $x_{1}^{(1)} = \\frac{1000}{\\exp(-3.3) + \\exp(-1.2)} \\left( \\frac{1.2 \\exp(-3.3)}{\\exp(-3.3) + \\exp(-0.9)} + \\frac{0.9 \\exp(-1.2)}{\\exp(-1.2) + \\exp(-3.6)} \\right)$\n        Let $H_{11} = \\exp(-3.3)$, $H_{12} = \\exp(-0.9)$, $H_{21} = \\exp(-1.2)$, $H_{22} = \\exp(-3.6)$.\n        $x_1^{(0)} = 1000, x_2^{(0)}=1000$. $y_1=1200, y_2=900$.\n        $x_1^{(1)} = \\frac{x_1^{(0)}}{H_{11}+H_{21}} \\left( H_{11} \\frac{y_1}{H_{11}x_1^{(0)} + H_{12}x_2^{(0)}} + H_{21} \\frac{y_2}{H_{21}x_1^{(0)} + H_{22}x_2^{(0)}} \\right)$\n        Since $x_1^{(0)} = x_2^{(0)} = 1000$:\n        $x_1^{(1)} = \\frac{1000}{H_{11} + H_{21}} \\left[ H_{11} \\frac{1200}{1000(H_{11} + H_{12})} + H_{21} \\frac{900}{1000(H_{21} + H_{22})} \\right]$\n        $x_1^{(1)} = \\frac{1000}{H_{11} + H_{21}} \\left[ \\frac{1.2 H_{11}}{H_{11} + H_{12}} + \\frac{0.9 H_{21}}{H_{21} + H_{22}} \\right]$\n        This is the expression I used. My prior note about cancellation was to observe that $1000/1000$ inside the bracket cancels, leaving $1.2$ and $0.9$. So the expression is correct.\n\n        Re-calculating with this confirmed expression:\n          $H_{11} = \\exp(-3.3) \\approx 0.036883167$\n          $H_{12} = \\exp(-0.9) \\approx 0.406569660$\n          $H_{21} = \\exp(-1.2) \\approx 0.301194212$\n          $H_{22} = \\exp(-3.6) \\approx 0.027323722$\n          \n          Sum $H_{11}+H_{12} = 0.443452827$\n          Sum $H_{21}+H_{22} = 0.328517934$\n          Sum $H_{11}+H_{21} = 0.338077379$\n\n          Term 1 in bracket: $\\frac{1.2 \\times H_{11}}{H_{11} + H_{12}} = \\frac{1.2 \\times 0.036883167}{0.443452827} = 0.0997982$\n          Term 2 in bracket: $\\frac{0.9 \\times H_{21}}{H_{21} + H_{22}} = \\frac{0.9 \\times 0.301194212}{0.328517934} = 0.825143$\n\n          Sum of terms in bracket = $0.0997982 + 0.825143 = 0.9249412$\n\n          $x_1^{(1)} = \\frac{1000}{H_{11} + H_{21}} \\times (\\text{Sum}) = \\frac{1000}{0.338077379} \\times 0.9249412 = 2942.84 \\times 0.9249412 = 2735.87...$\n\n          The value is $2735.87$.\n          The problem requires rounding to four significant figures. The digits are 2, 7, 3, 5. The next digit is 8, so I need to round up the 5. It becomes 2736.", "answer": "$$\n\\boxed{2736}\n$$", "id": "4863718"}, {"introduction": "In the clinical world, theory meets the complexities of human physiology, and a common challenge is patient motion. This exercise [@problem_id:4863730] explores the practical problem of a mismatch between the attenuation map (often acquired from a separate CT scan) and the SPECT emission data due to respiratory motion. You will calculate the quantitative error in the attenuation factor for a single ray path caused by a small shift in the diaphragm, highlighting a significant source of potential artifacts in thoracic and abdominal imaging.", "problem": "A simplified two-dimensional model is used to study attenuation correction in Single Photon Emission Computed Tomography (SPECT) under respiratory diaphragm motion. Consider an axial slice of the torso represented by a rectangle with width $W = 35\\ \\mathrm{cm}$ spanning $x \\in [-17.5\\ \\mathrm{cm}, 17.5\\ \\mathrm{cm}]$ and height $H = 25\\ \\mathrm{cm}$ spanning $y \\in [-12.5\\ \\mathrm{cm}, 12.5\\ \\mathrm{cm}]$. The lung occupies the superior region and soft tissue (e.g., liver) the inferior region, separated initially by a flat diaphragm at $y = 0\\ \\mathrm{cm}$: lung for $y \\ge 0$ and soft tissue for $y < 0$. The linear attenuation coefficients at $140\\ \\mathrm{keV}$ are $\\mu_{\\mathrm{lung}} = 0.03\\ \\mathrm{cm}^{-1}$ and $\\mu_{\\mathrm{soft}} = 0.15\\ \\mathrm{cm}^{-1}$. Neglect scatter.\n\nA monoenergetic photon is emitted from a voxel at position $(x_{0}, y_{0}) = (0\\ \\mathrm{cm}, 6\\ \\mathrm{cm})$. A projection is acquired at angle $\\theta = 30^{\\circ}$ (angles are in degrees), with the photon traveling toward the detector along the unit direction vector $\\mathbf{v} = (\\cos\\theta,\\ -\\sin\\theta)$. The photon exits the body when the ray first intersects the rectangular boundary.\n\nDue to diaphragm motion between emission and attenuation-map acquisition, the diaphragm shifts superiorly by $\\Delta = 1\\ \\mathrm{cm}$, so that the tissue boundary becomes $y = +1\\ \\mathrm{cm}$ (lung for $y \\ge 1$ and soft tissue for $y < 1$).\n\nStarting from the exponential attenuation law for monoenergetic photons, compute the change in ray path composition (lengths through lung versus soft tissue) induced by this $1\\ \\mathrm{cm}$ diaphragm shift and determine the corresponding multiplicative change in attenuation factor, defined as the ratio\n$$\nr \\equiv \\frac{A_{\\mathrm{new}}}{A_{\\mathrm{old}}} ,\n$$\nwhere $A = \\exp\\!\\left(-\\int \\mu(s)\\, ds\\right)$ is the attenuation factor along the path from the emission point to the exit point. Round your final value of $r$ to four significant figures and express it as a unitless decimal.", "solution": "We begin with the exponential attenuation law for monoenergetic photons: if a photon travels along a path from an emission point to the body surface, the attenuation factor is\n$$\nA = \\exp\\!\\left(-\\int \\mu(s)\\, ds\\right),\n$$\nwhere $\\mu(s)$ is the linear attenuation coefficient along the path parameterized by arc length $s$.\n\nGeometry and parameterization of the ray:\n- The emission point is $(x_{0}, y_{0}) = (0,\\ 6)\\ \\mathrm{cm}$.\n- The projection angle is $\\theta = 30^{\\circ}$, and the unit direction vector is $\\mathbf{v} = (\\cos\\theta,\\ -\\sin\\theta) = \\left(\\frac{\\sqrt{3}}{2},\\ -\\frac{1}{2}\\right)$.\n- Parameterize the ray by $t \\ge 0$:\n$$\nx(t) = x_{0} + (\\cos\\theta)\\, t = \\frac{\\sqrt{3}}{2}\\, t,\\qquad\ny(t) = y_{0} - (\\sin\\theta)\\, t = 6 - \\frac{1}{2}\\, t,\n$$\nwhere $t$ has units of $\\mathrm{cm}$ because $\\mathbf{v}$ is a unit vector and $s = t$.\n\nExit point determination:\n- The ray exits when it first hits the rectangle boundary. The two relevant candidates are the right side $x = 17.5$ and the bottom $y = -12.5$.\n- Hitting the right side gives $t_{x} = \\dfrac{17.5}{\\cos\\theta} = \\dfrac{17.5}{\\sqrt{3}/2} = \\dfrac{35}{\\sqrt{3}}\\ \\mathrm{cm}$.\n- Hitting the bottom gives $t_{y} = \\dfrac{y_{0} - (-12.5)}{\\sin\\theta} = \\dfrac{6 + 12.5}{1/2} = 37\\ \\mathrm{cm}$.\n- Since $t_{x} = \\dfrac{35}{\\sqrt{3}} \\approx 20.207\\ \\mathrm{cm} < 37\\ \\mathrm{cm}$, the exit occurs at the right side $x = 17.5\\ \\mathrm{cm}$ with $t_{\\mathrm{exit}} = \\dfrac{35}{\\sqrt{3}}\\ \\mathrm{cm}$. The corresponding exit $y$ is $y_{\\mathrm{exit}} = 6 - \\dfrac{1}{2} \\cdot \\dfrac{35}{\\sqrt{3}} \\approx -4.103\\ \\mathrm{cm}$, which lies within the vertical bounds.\n\nPath composition before and after the diaphragm shift:\n- Initially, the diaphragm is at $y = 0$, with lung for $y \\ge 0$ and soft tissue for $y < 0$.\n- After the shift by $\\Delta = 1\\ \\mathrm{cm}$ superiorly, the boundary is at $y = 1$, with lung for $y \\ge 1$ and soft tissue for $y < 1$.\n- Along the ray from $y = 6$ down to $y_{\\mathrm{exit}} \\approx -4.103$, the only reclassified segment due to the shift is the horizontal slab $y \\in [0, 1)$. This slab was lung before ($y \\ge 0$) and becomes soft tissue after ($y < 1$).\n\nLength of the reclassified segment along the ray:\n- The ray crosses $y$ monotonically with $dy/dt = -\\sin\\theta = -\\dfrac{1}{2}$.\n- The geometric thickness of the slab is $\\Delta y = 1\\ \\mathrm{cm}$. The corresponding path length along the ray is\n$$\nL_{\\mathrm{slab}} = \\frac{\\Delta y}{|\\sin\\theta|} = \\frac{1}{1/2} = 2\\ \\mathrm{cm}.\n$$\n- This segment lies well within the rectangle because at $y = 1$ (solve $6 - \\tfrac{1}{2} t = 1$), $t = 10\\ \\mathrm{cm}$ and $x = \\tfrac{\\sqrt{3}}{2} \\cdot 10 = 5\\sqrt{3} \\approx 8.660\\ \\mathrm{cm} < 17.5\\ \\mathrm{cm}$, and at $y = 0$ (solve $6 - \\tfrac{1}{2} t = 0$), $t = 12\\ \\mathrm{cm}$ and $x = 6\\sqrt{3} \\approx 10.392\\ \\mathrm{cm} < 17.5\\ \\mathrm{cm}$.\n\nChange in line integral and attenuation factor:\n- Let $\\tau = \\int \\mu(s)\\, ds$ denote the optical path length (attenuation line integral). The only change between the initial and shifted cases arises from the slab $y \\in [0, 1)$ whose classification changes from lung to soft tissue.\n- Therefore, the change in $\\tau$ is\n$$\n\\Delta \\tau \\equiv \\tau_{\\mathrm{new}} - \\tau_{\\mathrm{old}} = \\left(\\mu_{\\mathrm{soft}} - \\mu_{\\mathrm{lung}}\\right)\\, L_{\\mathrm{slab}}.\n$$\n- With $\\mu_{\\mathrm{soft}} = 0.15\\ \\mathrm{cm}^{-1}$, $\\mu_{\\mathrm{lung}} = 0.03\\ \\mathrm{cm}^{-1}$, and $L_{\\mathrm{slab}} = 2\\ \\mathrm{cm}$,\n$$\n\\Delta \\tau = \\left(0.15 - 0.03\\right)\\ \\mathrm{cm}^{-1} \\times 2\\ \\mathrm{cm} = 0.12 \\times 2 = 0.24.\n$$\n- The attenuation factor is $A = \\exp(-\\tau)$. Hence the multiplicative change (ratio) is\n$$\nr \\equiv \\frac{A_{\\mathrm{new}}}{A_{\\mathrm{old}}} = \\frac{\\exp(-\\tau_{\\mathrm{new}})}{\\exp(-\\tau_{\\mathrm{old}})} = \\exp\\!\\left(-\\Delta \\tau\\right) = \\exp(-0.24).\n$$\n\nNumerical evaluation:\n$$\nr = \\exp(-0.24) \\approx 0.786627\\ldots\n$$\nRounded to four significant figures,\n$$\nr \\approx 0.7866.\n$$\nThis unitless decimal is the required multiplicative change in attenuation factor due to the $1\\ \\mathrm{cm}$ superior shift of the diaphragm for the specified projection.", "answer": "$$\\boxed{0.7866}$$", "id": "4863730"}]}