{"hands_on_practices": [{"introduction": "An ideal Positron Emission Tomography (PET) measurement would only record \"true\" coincidence events. In reality, a significant source of background noise comes from random coincidences, which occur when two unrelated photons from different annihilation events happen to strike the detectors within the system's timing window. This exercise guides you through a foundational derivation of the random coincidence rate from first principles, modeling the detector signals as Poisson processes [@problem_id:4988551]. By then applying the derived formula to a realistic clinical scenario, you will gain a tangible understanding of the magnitude of this noise source compared to the true signal.", "problem": "A positron emission tomography (PET) study of Parkinson's Disease (PD) monitoring employs a brain protocol using a dopamine transporter radiotracer. Consider a single line of response (LOR) traversing the striatal region of interest (ROI) for which two opposing detector blocks register independent singles streams modeled as stationary Poisson processes with constant rates $S_1$ and $S_2$ (in $\\mathrm{s}^{-1}$). The electronics define a symmetric coincidence time window of half-width $\\tau$ (so coincidences are accepted when the arrival times differ by at most $\\tau$ seconds). The measured true coincidence rate for this LOR is $T$ (in $\\mathrm{s}^{-1}$), and the scatter coincidence rate is $S$ (in $\\mathrm{s}^{-1}$). Random coincidences arise when unrelated singles from the two detectors fall within the time window.\n\nStarting from the Poisson process framework and the definition of the coincidence window, derive the leading-order expression for the random coincidence rate for this LOR in terms of $S_1$, $S_2$, and $\\tau$ under the small-window approximation. Then, using the following experimentally observed values:\n- $S_1 = 3.2 \\times 10^{5}\\ \\mathrm{s}^{-1}$,\n- $S_2 = 2.8 \\times 10^{5}\\ \\mathrm{s}^{-1}$,\n- $\\tau = 4.0 \\times 10^{-9}\\ \\mathrm{s}$,\n- $T = 6.50 \\times 10^{2}\\ \\mathrm{s}^{-1}$,\n- $S = 3.50 \\times 10^{2}\\ \\mathrm{s}^{-1}$,\n\ncompute the random-to-true-plus-scatter ratio $r$ defined by $r = R/(T+S)$, where $R$ is the random coincidence rate you have derived. Express $r$ as a dimensionless decimal and round your final result to three significant figures.", "solution": "The problem statement is scientifically sound, self-contained, and well-posed, establishing a standard scenario in positron emission tomography (PET) physics. The modeling of detector singles events as independent stationary Poisson processes is a cornerstone of PET data analysis, and the provided numerical values for event rates and timing parameters are physically realistic for a modern clinical scanner. We can therefore proceed with the derivation and subsequent calculation.\n\nThe first task is to derive the expression for the random coincidence rate, $R$. A random coincidence occurs when two unrelated single detection events, one in each of the opposing detectors, are registered within the specified coincidence time window.\n\nLet the two independent streams of single events be modeled as stationary Poisson processes with constant rates $S_1$ and $S_2$, respectively. Consider a single event registered by detector 1 at a time $t_1$. For a random coincidence to be recorded for this specific event, an unrelated event must be registered by detector 2 at a time $t_2$ such that the absolute difference in their arrival times is less than or equal to the half-width of the coincidence window, $\\tau$. This condition is expressed as $|t_1 - t_2| \\le \\tau$, which is equivalent to $t_1 - \\tau \\le t_2 \\le t_1 + \\tau$.\n\nThe time interval during which an event from detector 2 can form a random coincidence with the event at $t_1$ is $[t_1 - \\tau, t_1 + \\tau]$. The total duration of this interval is $(t_1 + \\tau) - (t_1 - \\tau) = 2\\tau$.\n\nSince the events at detector 2 form a Poisson process with rate $S_2$, the probability of observing $k$ events in any time interval of duration $\\Delta t$ is given by the Poisson probability mass function:\n$$P(k \\text{ events in } \\Delta t) = \\frac{(\\lambda \\Delta t)^k e^{-\\lambda \\Delta t}}{k!}$$\nwhere the rate is $\\lambda = S_2$.\n\nFor our case, $\\Delta t = 2\\tau$. The probability of at least one event from detector 2 occurring in this window is $P(k \\ge 1)$. It is simpler to calculate the complement, the probability of zero events, $P(k=0)$.\n$$P(k=0 \\text{ in } 2\\tau) = \\frac{(S_2 \\cdot 2\\tau)^0 e^{-S_2 \\cdot 2\\tau}}{0!} = e^{-S_2 \\cdot 2\\tau}$$\nTherefore, the probability of at least one event is:\n$$P(k \\ge 1 \\text{ in } 2\\tau) = 1 - P(k=0) = 1 - e^{-S_2 \\cdot 2\\tau}$$\nThis is the probability that a given single event from detector 1 will be part of a random coincidence.\n\nThe problem specifies the \"small-window approximation\". This implies that the product of the singles rate and the full time window is much less than $1$, i.e., $S_2 \\cdot 2\\tau \\ll 1$. Under this condition, we can use the first-order Taylor series expansion for the exponential function, $e^{-x} \\approx 1 - x$ for small $x$.\nApplying this approximation with $x = S_2 \\cdot 2\\tau$:\n$$P(k \\ge 1) \\approx 1 - (1 - S_2 \\cdot 2\\tau) = 2\\tau S_2$$\nThe rate of random coincidences, $R$, is the rate at which singles arrive at detector 1 ($S_1$) multiplied by the probability that each such single forms a random coincidence with an event from detector 2.\n$$R = (\\text{Rate of singles at detector 1}) \\times (\\text{Probability of a random coincidence per single})$$\n$$R = S_1 \\times P(k \\ge 1) \\approx S_1 (2\\tau S_2)$$\nThus, the leading-order expression for the random coincidence rate is:\n$$R = 2\\tau S_1 S_2$$\n\nNow, we compute the numerical value of $R$ using the provided experimental values:\n- $S_1 = 3.2 \\times 10^{5}\\ \\mathrm{s}^{-1}$\n- $S_2 = 2.8 \\times 10^{5}\\ \\mathrm{s}^{-1}$\n- $\\tau = 4.0 \\times 10^{-9}\\ \\mathrm{s}$\n\nSubstituting these into the derived expression for $R$:\n$$R = 2 \\times (4.0 \\times 10^{-9}\\ \\mathrm{s}) \\times (3.2 \\times 10^{5}\\ \\mathrm{s}^{-1}) \\times (2.8 \\times 10^{5}\\ \\mathrm{s}^{-1})$$\n$$R = 2 \\times 4.0 \\times 3.2 \\times 2.8 \\times 10^{-9} \\times 10^{5} \\times 10^{5}\\ \\mathrm{s}^{-1}$$\n$$R = 71.68 \\times 10^{(-9+5+5)}\\ \\mathrm{s}^{-1}$$\n$$R = 71.68 \\times 10^{1}\\ \\mathrm{s}^{-1} = 716.8\\ \\mathrm{s}^{-1}$$\n\nThe second part of the task is to compute the random-to-true-plus-scatter ratio, $r$, defined as $r = R/(T+S)$. We use the calculated value of $R$ and the given values for the true coincidence rate, $T$, and the scatter coincidence rate, $S$:\n- $T = 6.50 \\times 10^{2}\\ \\mathrm{s}^{-1} = 650\\ \\mathrm{s}^{-1}$\n- $S = 3.50 \\times 10^{2}\\ \\mathrm{s}^{-1} = 350\\ \\mathrm{s}^{-1}$\n\nFirst, we calculate the denominator, which is the sum of the true and scatter coincidence rates:\n$$T + S = 650\\ \\mathrm{s}^{-1} + 350\\ \\mathrm{s}^{-1} = 1000\\ \\mathrm{s}^{-1} = 1.00 \\times 10^{3}\\ \\mathrm{s}^{-1}$$\nNow, we can compute the ratio $r$:\n$$r = \\frac{R}{T+S} = \\frac{716.8\\ \\mathrm{s}^{-1}}{1000\\ \\mathrm{s}^{-1}}$$\n$$r = 0.7168$$\nThe problem requires this result to be expressed as a dimensionless decimal rounded to three significant figures. The first three significant figures are $7$, $1$, and $6$. The fourth digit is $8$, which is greater than or equal to $5$, so we round up the third digit.\n$$r \\approx 0.717$$\nThis completes the required calculations.", "answer": "$$\\boxed{0.717}$$", "id": "4988551"}, {"introduction": "Beyond randoms, scattered coincidences represent the other major source of background events that degrade PET image quality and quantitative accuracy. This practice explores how imperfect correction for scatter introduces a systematic bias in the final reconstructed activity, a crucial issue in clinical applications like therapy response monitoring [@problem_id:4859465]. By deriving the relationship between scatter fraction, correction error, and quantitative bias, and comparing the effect in 2D versus 3D PET, you will appreciate why robust scatter correction is a cornerstone of modern quantitative imaging.", "problem": "A uniform cylindrical water phantom is imaged with Positron Emission Tomography (PET). Two acquisitions are performed: a two-dimensional (2D) mode with interplane septa and a three-dimensional (3D) mode without septa. Assume a uniform region of interest (ROI) in which the true coincidence counts are linearly related to the true activity by a calibration factor (system sensitivity) $s$, so that the true counts satisfy $T = s A$, where $A$ is the true activity in the ROI. Let the measured prompt counts be the sum of true and scattered coincidences, $P = T + S$, and assume that random coincidences are perfectly corrected and therefore can be ignored for this analysis.\n\nDefine the scatter fraction $\\mathrm{SF}$ by $\\mathrm{SF} = \\dfrac{S}{T + S}$. In the 3D acquisition, the scatter fraction is $\\mathrm{SF}_{3\\mathrm{D}} = 0.40$, and in the 2D acquisition, the scatter fraction is $\\mathrm{SF}_{2\\mathrm{D}} = 0.20$. The scatter correction algorithm underestimates the true scatter by a residual fraction $\\delta = 0.10$, meaning that after correction a fraction $\\delta$ of the true scatter remains unremoved. Reconstruction is linear, and the corrected counts are mapped to the activity estimate by the same sensitivity $s$ used for true coincidences.\n\nStarting from these definitions and the linearity assumptions above, derive the fractional bias in the reconstructed activity, $B = \\dfrac{\\hat{A} - A}{A}$, for each acquisition mode as a function of $\\delta$ and $\\mathrm{SF}$. Then, using the given numerical values, compute the ratio\n$$R = \\dfrac{B_{3\\mathrm{D}}}{B_{2\\mathrm{D}}}.$$\nExpress $R$ as a pure number (dimensionless) and round your answer to four significant figures.", "solution": "The problem requires us to derive the fractional bias in reconstructed activity, $B$, caused by an underestimation of scatter, and then to compute the ratio of this bias between 3D and 2D acquisition modes.\n\nThe fractional bias is defined as $B = \\dfrac{\\hat{A} - A}{A}$, where $A$ is the true activity and $\\hat{A}$ is the reconstructed activity.\nAccording to the problem, the true activity is related to the true counts $T$ via the sensitivity $s$: $A = T/s$.\nThe reconstructed activity $\\hat{A}$ is derived from the scatter-corrected counts, $P_c$: $\\hat{A} = P_c/s$.\nSubstituting these into the bias formula gives:\n$$B = \\dfrac{P_c/s - T/s}{T/s} = \\dfrac{P_c - T}{T}$$\n\nThe measured prompt counts are $P = T + S$. The scatter correction removes an estimated amount of scatter, $S_{est}$. The problem states that the correction underestimates scatter by a fraction $\\delta$, meaning the amount of scatter *remaining* is $\\delta S$. Therefore, the corrected counts are the sum of the true counts and the residual scatter:\n$$P_c = T + \\delta S$$\nSubstituting this into the bias expression:\n$$B = \\dfrac{(T + \\delta S) - T}{T} = \\dfrac{\\delta S}{T}$$\n\nTo express the bias in terms of the scatter fraction, $\\mathrm{SF}$, we use its definition: $\\mathrm{SF} = \\dfrac{S}{T + S}$.\nWe can rearrange this to find the ratio $S/T$:\n$$\\mathrm{SF} (T + S) = S \\implies \\mathrm{SF} \\cdot T = S - \\mathrm{SF} \\cdot S = S(1 - \\mathrm{SF})$$\n$$\\frac{S}{T} = \\frac{\\mathrm{SF}}{1 - \\mathrm{SF}}$$\nSubstituting this back into the bias formula yields the general expression for fractional bias:\n$$B = \\delta \\left( \\frac{\\mathrm{SF}}{1 - \\mathrm{SF}} \\right)$$\n\nNow we can compute the ratio $R = \\dfrac{B_{3\\mathrm{D}}}{B_{2\\mathrm{D}}}$. The factor $\\delta$ is the same for both modes and cancels out:\n$$R = \\frac{\\delta \\left( \\frac{\\mathrm{SF}_{3\\mathrm{D}}}{1 - \\mathrm{SF}_{3\\mathrm{D}}} \\right)}{\\delta \\left( \\frac{\\mathrm{SF}_{2\\mathrm{D}}}{1 - \\mathrm{SF}_{2\\mathrm{D}}} \\right)} = \\frac{\\frac{\\mathrm{SF}_{3\\mathrm{D}}}{1 - \\mathrm{SF}_{3\\mathrm{D}}}}{\\frac{\\mathrm{SF}_{2\\mathrm{D}}}{1 - \\mathrm{SF}_{2\\mathrm{D}}}}$$\nUsing the given values $\\mathrm{SF}_{3\\mathrm{D}} = 0.40$ and $\\mathrm{SF}_{2\\mathrm{D}} = 0.20$:\n$$R = \\frac{\\frac{0.40}{1 - 0.40}}{\\frac{0.20}{1 - 0.20}} = \\frac{\\frac{0.40}{0.60}}{\\frac{0.20}{0.80}} = \\frac{2/3}{1/4}$$\n$$R = \\frac{2}{3} \\times 4 = \\frac{8}{3} \\approx 2.6666...$$\nRounding to four significant figures, we get:\n$$R = 2.667$$\nThis demonstrates that the same fractional error in scatter estimation leads to a significantly larger bias in the 3D mode due to its higher intrinsic scatter fraction.", "answer": "$$\\boxed{2.667}$$", "id": "4859465"}, {"introduction": "Having examined random and scattered events individually, we can now synthesize these concepts to develop a unified metric for PET data quality. The Noise-Equivalent Count Rate (NECR) is a powerful figure of merit that quantifies the effective statistical quality of the acquired data by properly weighting the contributions of true, scattered, and random coincidences [@problem_id:4923407]. Deriving the NECR formula will solidify your understanding of how each event type impacts the final signal-to-noise ratio, providing a crucial tool for evaluating and comparing the performance of different PET scanners and acquisition protocols.", "problem": "A positron emission tomography sinogram bin is observed for a duration of $\\tau$ seconds. Let the underlying rates of true, scatter, and random coincidences entering this bin be $T$, $S$, and $R$, respectively, each in units of counts per second. The prompt count $P$ accumulated in the bin over the interval is modeled as a Poisson random variable with mean $\\mu_{p} = (T+S+R)\\tau$. A delayed randoms window provides an independent estimate $D$ of the random coincidences, modeled as a Poisson random variable with mean $\\mu_{d} = R\\tau$, independent of $P$. To correct for randoms, the bin is processed using the linear estimator\n$$\n\\hat{C} = P - \\beta D,\n$$\nwhere $\\beta$ is a known nonnegative scalar that accounts for any normalization differences between the prompt and delayed measurements.\n\nUsing only fundamental properties of Poisson processes and linear propagation of independent variances, do the following:\n- Derive $\\mathbb{E}[\\hat{C}]$ and $\\mathrm{Var}(\\hat{C})$ in terms of $\\beta$, $T$, $S$, $R$, and $\\tau$. Determine the value of $\\beta$ that makes $\\hat{C}$ an unbiased estimator of the true-plus-scatter counts over the interval.\n- Under the unbiased choice of $\\beta$, derive the variance per unit time of the rate estimator $\\hat{C}/\\tau$.\n- Define the noise-equivalent count rate as follows: consider an idealized noise-free scenario in which only true coincidences at rate $X$ contribute to the bin, so the count over $\\tau$ is Poisson with mean $X\\tau$ and variance $X\\tau$. The noise-equivalent count rate $\\mathrm{NECR}$ for the actual bin is the value of $X$ that yields the same squared signal-to-noise ratio for detecting the true contribution as the corrected bin $\\hat{C}$. Using this definition, derive $\\mathrm{NECR}$ as a closed-form analytic expression in terms of $T$, $S$, and $R$.\n\nProvide your final answer as a single analytic expression for $\\mathrm{NECR}$ in terms of $T$, $S$, and $R$ only. Express $\\mathrm{NECR}$ in the same units as $T$ (counts per second), but do not include units in your final expression.", "solution": "The problem asks for a step-by-step derivation of the Noise-Equivalent Count Rate (NECR) based on a statistical model of PET data.\n\n**1. Derive Expectation and Variance of the Estimator**\nThe estimator for the corrected counts is $\\hat{C} = P - \\beta D$.\nUsing the linearity of expectation and the given means $\\mathbb{E}[P] = (T+S+R)\\tau$ and $\\mathbb{E}[D] = R\\tau$:\n$$\n\\mathbb{E}[\\hat{C}] = \\mathbb{E}[P] - \\beta \\mathbb{E}[D] = (T+S+R)\\tau - \\beta (R\\tau) = (T+S)\\tau + (1-\\beta)R\\tau\n$$\nFor the variance, since $P$ and $D$ are independent, their variances add. The variance of a Poisson variable is its mean.\n$$\n\\mathrm{Var}(\\hat{C}) = \\mathrm{Var}(P) + \\mathrm{Var}(-\\beta D) = \\mathrm{Var}(P) + \\beta^2 \\mathrm{Var}(D)\n$$\n$$\n\\mathrm{Var}(\\hat{C}) = (T+S+R)\\tau + \\beta^2 (R\\tau)\n$$\n\n**2. Determine the Unbiased Choice of $\\beta$**\nFor $\\hat{C}$ to be an unbiased estimator of the true-plus-scatter counts, its expectation must equal the expected value of the true-plus-scatter counts, which is $(T+S)\\tau$.\n$$\n\\mathbb{E}[\\hat{C}] = (T+S)\\tau \\implies (T+S)\\tau + (1-\\beta)R\\tau = (T+S)\\tau\n$$\nThis requires $(1-\\beta)R\\tau = 0$. Since $R$ and $\\tau$ are non-zero, we must have $1-\\beta = 0$, so $\\beta=1$.\n\n**3. Derive the Variance per Unit Time**\nUsing the unbiased choice $\\beta=1$, the variance of the estimator $\\hat{C}$ becomes:\n$$\n\\mathrm{Var}(\\hat{C}) = (T+S+R)\\tau + (1)^2(R\\tau) = (T+S+2R)\\tau\n$$\nThe rate estimator is $\\hat{r} = \\hat{C}/\\tau$. Its variance is:\n$$\n\\mathrm{Var}(\\hat{r}) = \\mathrm{Var}\\left(\\frac{\\hat{C}}{\\tau}\\right) = \\frac{1}{\\tau^2}\\mathrm{Var}(\\hat{C}) = \\frac{(T+S+2R)\\tau}{\\tau^2} = \\frac{T+S+2R}{\\tau}\n$$\n\n**4. Derive the NECR Formula**\nThe squared signal-to-noise ratio, $(\\text{SNR})^2$, for the corrected measurement $\\hat{C}$ is defined with the signal as the expected true counts, $T\\tau$.\n$$\n(\\text{SNR})_{\\hat{C}}^2 = \\frac{(\\text{Signal})^2}{\\mathrm{Var}(\\hat{C})} = \\frac{(T\\tau)^2}{(T+S+2R)\\tau} = \\frac{T^2\\tau}{T+S+2R}\n$$\nFor an idealized system with only true counts at a rate $X=\\text{NECR}$, the measured count is Poisson with mean and variance $(\\text{NECR})\\tau$. The signal is $(\\text{NECR})\\tau$.\n$$\n(\\text{SNR})_{\\text{ideal}}^2 = \\frac{(\\text{Signal})^2}{\\text{Variance}} = \\frac{((\\text{NECR})\\tau)^2}{(\\text{NECR})\\tau} = (\\text{NECR})\\tau\n$$\nEquating the two squared SNRs as per the definition:\n$$\n(\\text{NECR})\\tau = \\frac{T^2\\tau}{T+S+2R}\n$$\nDividing by $\\tau$ (assuming $\\tau > 0$) gives the final expression for NECR:\n$$\n\\text{NECR} = \\frac{T^2}{T+S+2R}\n$$", "answer": "$$\n\\boxed{\\frac{T^2}{T+S+2R}}\n$$", "id": "4923407"}]}