{"hands_on_practices": [{"introduction": "The Patlak graphical analysis is a powerful simplification, but its validity rests on a key assumption: that the reversible compartments of the tissue are in a state of quasi-equilibrium with the plasma. This exercise challenges you to determine the specific time, $t^*$, when this condition is met for a given set of physiological parameters. By working through this problem [@problem_id:4880104], you will gain a concrete understanding of how the underlying tracer exchange rates dictate the time window where the Patlak plot becomes a valid linear model.", "problem": "A bolus dynamic Positron Emission Tomography (PET) scan of glucose metabolism is modeled using the irreversible two-tissue compartment model, where tracer exchanges between plasma and a reversible tissue compartment and then irreversibly accumulates in a trapped compartment. Ignore the whole-blood (vascular) volume. Let the plasma input function be denoted by $C_P(t)$, the reversible tissue compartment by $C_1(t)$, and the trapped tissue compartment by $C_2(t)$, so that the total tissue activity is $C_T(t) = C_1(t) + C_2(t)$. The microparameters are the influx rate constant $K_1$ from plasma to tissue, the efflux rate constant $k_2$ from the reversible compartment back to plasma, and the trapping rate constant $k_3$ from the reversible compartment to the trapped compartment, with $k_4=0$. For this scan, assume that after the first-pass peak, the arterial input function tail is well-approximated by a monoexponential $C_P(t) = A \\exp(-\\lambda t)$ for $t \\ge 0$, where $A>0$ and $\\lambda>0$ are constants.\n\nPatlak linearity is achieved when the contribution of the reversible compartment to the normalized tissue concentration $C_T(t)/C_P(t)$ becomes effectively constant in time. Define $t^{\\ast}$ as the earliest time such that the reversible compartmentâ€™s contribution to $C_T(t)/C_P(t)$ deviates by no more than a fractional tolerance $\\varepsilon = 0.01$ from its asymptotic constant value. Use the following microparameters and tail decay constant: $K_1 = 0.10$ $\\mathrm{mL}\\,\\mathrm{min}^{-1}\\,\\mathrm{mL}^{-1}$, $k_2 = 0.15$ $\\mathrm{min}^{-1}$, $k_3 = 0.05$ $\\mathrm{min}^{-1}$, and $\\lambda = 0.02$ $\\mathrm{min}^{-1}$.\n\nStarting from mass balance and the stated model assumptions and definitions, determine $t^{\\ast}$ in minutes. Round your answer to four significant figures. Express the final time in minutes.", "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n-   **Model**: Irreversible two-tissue compartment model.\n-   **Compartments**: Plasma ($C_P(t)$), reversible tissue ($C_1(t)$), trapped tissue ($C_2(t)$).\n-   **Total Tissue Activity**: $C_T(t) = C_1(t) + C_2(t)$.\n-   **Plasma Input Function**: $C_P(t) = A \\exp(-\\lambda t)$ for $t \\ge 0$, where $A > 0$ and $\\lambda > 0$.\n-   **Microparameters**:\n    -   Influx rate constant: $K_1 = 0.10$ $\\mathrm{mL}\\,\\mathrm{min}^{-1}\\,\\mathrm{mL}^{-1}$ (equivalent to $0.10$ $\\mathrm{min}^{-1}$).\n    -   Efflux rate constant: $k_2 = 0.15$ $\\mathrm{min}^{-1}$.\n    -   Trapping rate constant: $k_3 = 0.05$ $\\mathrm{min}^{-1}$.\n    -   Reverse trapping rate: $k_4 = 0$.\n-   **Input Function Decay Constant**: $\\lambda = 0.02$ $\\mathrm{min}^{-1}$.\n-   **Condition for Patlak Linearity**: The contribution of the reversible compartment to the normalized tissue concentration, $C_T(t)/C_P(t)$, becomes effectively constant. This contribution is identified as $C_1(t)/C_P(t)$.\n-   **Definition of $t^{\\ast}$**: The earliest time such that the fractional deviation of $C_1(t)/C_P(t)$ from its asymptotic constant value is no more than $\\varepsilon = 0.01$.\n-   **Initial Conditions**: Implicitly, $C_1(0) = 0$ and $C_2(0) = 0$ since the tracer is introduced at $t=0$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The irreversible two-tissue compartment model is a standard and fundamental construct in quantitative PET, particularly for tracers like [$^{18}$F]FDG. The use of differential equations based on mass balance is the correct physical basis. The concept of Patlak analysis and the conditions for linearity are well-established. The model is scientifically sound.\n-   **Well-Posed**: The problem provides a clear definition for the quantity to be calculated ($t^*$), sufficient parameters and conditions (all rate constants, the form of the input function, and the tolerance $\\varepsilon$), and asks for a unique numerical value. The setup leads to a unique, stable solution.\n-   **Objective**: The problem is stated in precise, quantitative, and unbiased scientific language.\n-   **Completeness and Consistency**: All necessary numerical values and functional forms are provided. The units are consistent across all parameters (all rates are in $\\mathrm{min}^{-1}$). There are no contradictions.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will be provided.\n\n### Solution Derivation\nThe dynamics of the reversible tissue compartment, $C_1(t)$, are described by the principle of mass balance. The rate of change of tracer concentration in this compartment is the rate of influx from plasma minus the rate of efflux back to plasma and the rate of trapping into the second tissue compartment. This is expressed by the differential equation:\n$$\n\\frac{dC_1(t)}{dt} = K_1 C_P(t) - k_2 C_1(t) - k_3 C_1(t)\n$$\nThis can be rearranged into a standard first-order linear ordinary differential equation:\n$$\n\\frac{dC_1(t)}{dt} + (k_2 + k_3) C_1(t) = K_1 C_P(t)\n$$\nThe problem specifies the plasma input function for $t \\ge 0$ as $C_P(t) = A \\exp(-\\lambda t)$. Substituting this into the differential equation gives:\n$$\n\\frac{dC_1(t)}{dt} + (k_2 + k_3) C_1(t) = K_1 A \\exp(-\\lambda t)\n$$\nThis equation is solved subject to the initial condition $C_1(0) = 0$. The solution is found using an integrating factor or by assuming a solution of the form $C_1(t) = C_{1,h}(t) + C_{1,p}(t)$, where $C_{1,h}$ is the homogeneous solution and $C_{1,p}$ is the particular solution. The general solution is:\n$$\nC_1(t) = \\frac{K_1 A}{k_2 + k_3 - \\lambda} \\exp(-\\lambda t) + C \\exp(-(k_2 + k_3)t)\n$$\nwhere $C$ is a constant of integration. We assume $k_2 + k_3 \\neq \\lambda$. Given the parameters, $k_2 + k_3 = 0.15 + 0.05 = 0.20$ $\\mathrm{min}^{-1}$ and $\\lambda = 0.02$ $\\mathrm{min}^{-1}$, so this condition holds.\nApplying the initial condition $C_1(0) = 0$:\n$$\n0 = \\frac{K_1 A}{k_2 + k_3 - \\lambda} \\exp(0) + C \\exp(0) \\implies C = -\\frac{K_1 A}{k_2 + k_3 - \\lambda}\n$$\nSubstituting $C$ back, the specific solution for $C_1(t)$ is:\n$$\nC_1(t) = \\frac{K_1 A}{k_2 + k_3 - \\lambda} \\left( \\exp(-\\lambda t) - \\exp(-(k_2 + k_3)t) \\right)\n$$\nThe problem asks us to analyze the contribution of the reversible compartment to the normalized tissue concentration. This term is $R(t) = C_1(t) / C_P(t)$.\n$$\nR(t) = \\frac{C_1(t)}{C_P(t)} = \\frac{\\frac{K_1 A}{k_2 + k_3 - \\lambda} \\left( \\exp(-\\lambda t) - \\exp(-(k_2 + k_3)t) \\right)}{A \\exp(-\\lambda t)}\n$$\n$$\nR(t) = \\frac{K_1}{k_2 + k_3 - \\lambda} \\left( 1 - \\frac{\\exp(-(k_2 + k_3)t)}{\\exp(-\\lambda t)} \\right)\n$$\n$$\nR(t) = \\frac{K_1}{k_2 + k_3 - \\lambda} \\left( 1 - \\exp(-(k_2 + k_3 - \\lambda)t) \\right)\n$$\nThe problem states that Patlak linearity is achieved when this term becomes effectively constant. We find the asymptotic value of $R(t)$ as $t \\to \\infty$. Let this be $R_{\\text{asymp}}$.\n$$\nR_{\\text{asymp}} = \\lim_{t \\to \\infty} R(t) = \\lim_{t \\to \\infty} \\frac{K_1}{k_2 + k_3 - \\lambda} \\left( 1 - \\exp(-(k_2 + k_3 - \\lambda)t) \\right)\n$$\nSince $k_2 + k_3 - \\lambda = 0.20 - 0.02 = 0.18 > 0$, the exponential term $\\exp(-(k_2 + k_3 - \\lambda)t)$ approaches $0$ as $t \\to \\infty$.\n$$\nR_{\\text{asymp}} = \\frac{K_1}{k_2 + k_3 - \\lambda}\n$$\nThe time $t^{\\ast}$ is defined by the fractional deviation of $R(t)$ from $R_{\\text{asymp}}$ being equal to the tolerance $\\varepsilon = 0.01$. The fractional deviation is given by $\\frac{|R(t) - R_{\\text{asymp}}|}{R_{\\text{asymp}}}$.\nThe absolute deviation is:\n$$\n|R(t) - R_{\\text{asymp}}| = \\left| \\frac{K_1}{k_2 + k_3 - \\lambda} \\left( 1 - \\exp(-(k_2 + k_3 - \\lambda)t) \\right) - \\frac{K_1}{k_2 + k_3 - \\lambda} \\right|\n$$\n$$\n|R(t) - R_{\\text{asymp}}| = \\left| -\\frac{K_1}{k_2 + k_3 - \\lambda} \\exp(-(k_2 + k_3 - \\lambda)t) \\right| = \\frac{K_1}{k_2 + k_3 - \\lambda} \\exp(-(k_2 + k_3 - \\lambda)t)\n$$\nThe fractional deviation at time $t = t^{\\ast}$ is:\n$$\n\\frac{|R(t^{\\ast}) - R_{\\text{asymp}}|}{R_{\\text{asymp}}} = \\frac{\\frac{K_1}{k_2 + k_3 - \\lambda} \\exp(-(k_2 + k_3 - \\lambda)t^{\\ast})}{\\frac{K_1}{k_2 + k_3 - \\lambda}} = \\exp(-(k_2 + k_3 - \\lambda)t^{\\ast})\n$$\nWe set this equal to $\\varepsilon$:\n$$\n\\exp(-(k_2 + k_3 - \\lambda)t^{\\ast}) = \\varepsilon\n$$\nTo solve for $t^{\\ast}$, we take the natural logarithm of both sides:\n$$\n-(k_2 + k_3 - \\lambda)t^{\\ast} = \\ln(\\varepsilon)\n$$\n$$\nt^{\\ast} = -\\frac{\\ln(\\varepsilon)}{k_2 + k_3 - \\lambda}\n$$\nNow, we substitute the given numerical values:\n-   $k_2 = 0.15$ $\\mathrm{min}^{-1}$\n-   $k_3 = 0.05$ $\\mathrm{min}^{-1}$\n-   $\\lambda = 0.02$ $\\mathrm{min}^{-1}$\n-   $\\varepsilon = 0.01$\n\nThe denominator is $k_2 + k_3 - \\lambda = 0.15 + 0.05 - 0.02 = 0.18$ $\\mathrm{min}^{-1}$.\nThe numerator is $-\\ln(\\varepsilon) = -\\ln(0.01) = -\\ln(10^{-2}) = 2\\ln(10)$.\nNumerically, $\\ln(0.01) \\approx -4.605170$.\n$$\nt^{\\ast} = -\\frac{-4.605170}{0.18} \\approx 25.584278 \\text{ min}\n$$\nThe problem requires rounding the answer to four significant figures.\n$$\nt^{\\ast} \\approx 25.58 \\text{ min}\n$$", "answer": "$$\\boxed{25.58}$$", "id": "4880104"}, {"introduction": "With an understanding of when the Patlak method is applicable, this practice moves from theory to application using measured data. You will take on the role of a data analyst, using the trapezoidal rule to process a sampled arterial input function and late-time tissue measurements to estimate the net influx rate, $K_i$. This exercise [@problem_id:4880125] also presents a realistic scenario where data is missing, allowing you to quantify the bias introduced by this common practical challenge and appreciate the importance of robust data acquisition.", "problem": "A dynamic Positron Emission Tomography (PET) study of an irreversible tracer is modeled by an irreversible two-tissue compartment system consisting of a free compartment with concentration $C_{f}(t)$ and a trapped compartment with concentration $C_{b}(t)$. The arterial plasma input function is $C_{P}(t)$ (decay-corrected to the scan start). The total tissue concentration is $C_{T}(t) = C_{f}(t) + C_{b}(t)$. The system is governed by mass balance:\n- $ \\dfrac{d C_{f}}{dt} = k_{1} C_{P}(t) - (k_{2} + k_{3}) C_{f}(t)$,\n- $ \\dfrac{d C_{b}}{dt} = k_{3} C_{f}(t)$,\nwith initial conditions $C_{f}(0) = 0$ and $C_{b}(0) = 0$. Assume the fractional blood volume is negligible in the measured tissue signal.\n\nAt sufficiently late times when the reversible compartment $C_{f}(t)$ is in quasi-steady state with plasma, there exists a linear relationship between a plasma-normalized tissue function and a plasma-normalized integral of the input, whose slope equals the net influx rate constant $K_{i}$ and whose intercept equals a distribution volume for the reversible compartment. Starting only from the mass balance equations above and standard calculus, derive this late-time linearization and identify the slope in terms of model parameters.\n\nYou are given the following decay-corrected arterial plasma input function samples $C_{P}(t)$ (in $\\mathrm{kBq}/\\mathrm{mL}$) at times $t$ (in $\\mathrm{min}$):\n- $(t, C_{P}(t)) = (0, 0.0)$,\n- $(0.5, 6.0)$,\n- $(1, 5.0)$,\n- $(2, 3.0)$,\n- $(5, 1.5)$,\n- $(10, 1.0)$,\n- $(20, 0.6)$,\n- $(30, 0.45)$,\n- $(40, 0.35)$.\n\nAt $t = 30$ and $t = 40$ minutes, the measured tissue concentrations are $C_{T}(30) = 0.3675$ $\\mathrm{kBq}/\\mathrm{mL}$ and $C_{T}(40) = 0.4025$ $\\mathrm{kBq}/\\mathrm{mL}$, respectively. Use only these two late time points for the linear estimation of the net influx rate constant $K_{i}$.\n\nTasks:\n1) Using the trapezoidal rule on the full set of arterial input samples above, compute the integrals $\\int_{0}^{30} C_{P}(t)\\,dt$ and $\\int_{0}^{40} C_{P}(t)\\,dt$ in units of $\\mathrm{kBq}\\cdot\\mathrm{min}/\\mathrm{mL}$.\n\n2) Using your late-time linearization, form the appropriate plasma-normalized variables and compute the two-point slope using the late samples at $t = 30$ and $t = 40$ minutes to estimate $K_{i}$ from the fully sampled integrals.\n\n3) Now consider a sampling gap scenario: suppose all arterial input samples strictly between $t = 2$ and $t = 20$ minutes are missing, and the analyst linearly interpolates $C_{P}(t)$ between the retained anchor samples at $t = 2$ minutes and $t = 20$ minutes before applying the trapezoidal rule on the reduced set of samples $\\{0, 0.5, 1, 2, 20, 30, 40\\}$ minutes. Recompute $\\int_{0}^{30} C_{P}(t)\\,dt$ and $\\int_{0}^{40} C_{P}(t)\\,dt$ using this reduced set and re-estimate $K_{i}$ from the same two late time points.\n\n4) Finally, quantify the effect of the sampling gap by computing the relative bias in the estimated net influx rate, defined as $\\big(K_{i,\\mathrm{gap}} - K_{i,\\mathrm{full}}\\big) / K_{i,\\mathrm{full}}$. Express your final answer as a decimal (no percentage sign), rounded to four significant figures. Do not include units in your final answer.", "solution": "The problem is scientifically grounded, well-posed, and objective. It describes a standard kinetic analysis method (Patlak plot) in Positron Emission Tomography (PET) and provides all necessary data and conditions for a complete, unique solution. Therefore, the problem is valid and a solution will be provided.\n\nThe problem asks for the derivation of a late-time linearization for an irreversible two-tissue compartment model and its application to estimate the net influx rate constant $K_i$.\n\nFirst, we derive the linearization. The system is described by:\n$$ \\frac{d C_{f}}{dt} = k_{1} C_{P}(t) - (k_{2} + k_{3}) C_{f}(t) $$\n$$ \\frac{d C_{b}}{dt} = k_{3} C_{f}(t) $$\nThe total tissue concentration is $C_{T}(t) = C_{f}(t) + C_{b}(t)$.\nThe problem states that at sufficiently late times, the free compartment is in a quasi-steady state with the plasma. This implies that the rate of change of $C_f(t)$ is negligible compared to the rates of influx and efflux, i.e., $\\frac{dC_f}{dt} \\approx 0$.\nApplying this assumption to the first differential equation gives:\n$$ 0 \\approx k_{1} C_{P}(t) - (k_{2} + k_{3}) C_{f}(t) $$\nSolving for $C_f(t)$ yields the quasi-steady state concentration:\n$$ C_{f}(t) \\approx \\frac{k_{1}}{k_{2} + k_{3}} C_{P}(t) $$\nNow, we consider the trapped compartment. The concentration $C_b(t)$ is found by integrating its rate equation from $0$ to $t$:\n$$ C_b(t) = C_b(0) + \\int_{0}^{t} \\frac{dC_b}{d\\tau} d\\tau = 0 + \\int_{0}^{t} k_{3} C_f(\\tau) d\\tau = k_3 \\int_{0}^{t} C_f(\\tau) d\\tau $$\nThe total tissue concentration is therefore:\n$$ C_T(t) = C_f(t) + C_b(t) = C_f(t) + k_3 \\int_{0}^{t} C_f(\\tau) d\\tau $$\nSubstituting the quasi-steady state approximation for $C_f(t)$ into the expression for $C_T(t)$:\n$$ C_T(t) \\approx \\left(\\frac{k_{1}}{k_{2} + k_{3}}\\right) C_{P}(t) + k_3 \\int_{0}^{t} \\left(\\frac{k_{1}}{k_{2} + k_{3}}\\right) C_P(\\tau) d\\tau $$\nThe term $\\frac{k_1}{k_2+k_3}$ can be factored out of the integral:\n$$ C_T(t) \\approx \\left(\\frac{k_{1}}{k_{2} + k_{3}}\\right) C_{P}(t) + \\left(\\frac{k_{1} k_3}{k_{2} + k_{3}}\\right) \\int_{0}^{t} C_P(\\tau) d\\tau $$\nTo obtain the specified linear relationship, we divide by $C_P(t)$:\n$$ \\frac{C_T(t)}{C_P(t)} \\approx \\left(\\frac{k_{1} k_3}{k_{2} + k_{3}}\\right) \\frac{\\int_{0}^{t} C_P(\\tau) d\\tau}{C_P(t)} + \\frac{k_{1}}{k_{2} + k_{3}} $$\nThis is a linear equation of the form $Y(t) = m X(t) + c$, where:\n- $Y(t) = \\frac{C_T(t)}{C_P(t)}$\n- $X(t) = \\frac{\\int_{0}^{t} C_P(\\tau) d\\tau}{C_P(t)}$\n- The slope $m$ is the net influx rate constant $K_i = \\frac{k_{1} k_3}{k_{2} + k_{3}}$.\n- The intercept $c$ is the reversible compartment distribution volume $V_e = \\frac{k_{1}}{k_{2} + k_{3}}$.\n\nWith the linearization derived, we proceed with the numerical tasks.\n\n**Task 1: Integral computation with full data**\nWe use the trapezoidal rule, $\\int_{t_i}^{t_{i+1}} f(t) dt \\approx \\frac{t_{i+1}-t_i}{2} (f(t_i)+f(t_{i+1}))$.\nThe given C_P(t) data points are:\n$(t, C_{P}(t)) = \\{(0, 0.0), (0.5, 6.0), (1, 5.0), (2, 3.0), (5, 1.5), (10, 1.0), (20, 0.6), (30, 0.45), (40, 0.35)\\}$.\n\n$\\int_{0}^{30} C_{P}(t)\\,dt = \\frac{0.5-0}{2}(0.0+6.0) + \\frac{1-0.5}{2}(6.0+5.0) + \\frac{2-1}{2}(5.0+3.0) + \\frac{5-2}{2}(3.0+1.5) + \\frac{10-5}{2}(1.5+1.0) + \\frac{20-10}{2}(1.0+0.6) + \\frac{30-20}{2}(0.6+0.45)$\n$= 0.25(6.0) + 0.25(11.0) + 0.5(8.0) + 1.5(4.5) + 2.5(2.5) + 5.0(1.6) + 5.0(1.05)$\n$= 1.5 + 2.75 + 4.0 + 6.75 + 6.25 + 8.0 + 5.25 = 34.5$\n\n$\\int_{0}^{40} C_{P}(t)\\,dt = \\int_{0}^{30} C_{P}(t)\\,dt + \\int_{30}^{40} C_{P}(t)\\,dt$\n$= 34.5 + \\frac{40-30}{2}(0.45+0.35) = 34.5 + 5(0.8) = 34.5 + 4.0 = 38.5$\n\nThe integrals are $\\int_{0}^{30} C_{P}(t)\\,dt = 34.5 \\ \\mathrm{kBq}\\cdot\\mathrm{min}/\\mathrm{mL}$ and $\\int_{0}^{40} C_{P}(t)\\,dt = 38.5 \\ \\mathrm{kBq}\\cdot\\mathrm{min}/\\mathrm{mL}$.\n\n**Task 2: Estimation of $K_i$ with full data ($K_{i,\\mathrm{full}}$)**\nWe calculate the plot variables $X(t)$ and $Y(t)$ for $t=30$ and $t=40$.\nAt $t=30 \\ \\mathrm{min}$:\n$C_T(30)=0.3675$, $C_P(30)=0.45$, $\\int_0^{30}C_P(\\tau)d\\tau = 34.5$.\n$Y(30) = \\frac{0.3675}{0.45} = \\frac{49}{60} \\approx 0.8167$\n$X(30) = \\frac{34.5}{0.45} = \\frac{230}{3} \\approx 76.67$\n\nAt $t=40 \\ \\mathrm{min}$:\n$C_T(40)=0.4025$, $C_P(40)=0.35$, $\\int_0^{40}C_P(\\tau)d\\tau = 38.5$.\n$Y(40) = \\frac{0.4025}{0.35} = 1.15 = \\frac{23}{20}$\n$X(40) = \\frac{38.5}{0.35} = 110$\n\nThe slope $K_{i,\\mathrm{full}}$ is estimated as:\n$K_{i,\\mathrm{full}} = \\frac{Y(40)-Y(30)}{X(40)-X(30)} = \\frac{1.15 - 49/60}{110 - 230/3} = \\frac{23/20 - 49/60}{330/3 - 230/3} = \\frac{(69-49)/60}{100/3} = \\frac{20/60}{100/3} = \\frac{1/3}{100/3} = \\frac{1}{100} = 0.01$\n\n**Task 3: Re-estimation of $K_i$ with sampling gap ($K_{i,\\mathrm{gap}}$)**\nThe samples between $t=2$ and $t=20$ are removed. The integral over this range is now calculated using a single trapezoid between the endpoints $(2, 3.0)$ and $(20, 0.6)$.\nThe integral over $[0, 2]$ remains unchanged: $\\int_0^2 C_P dt = 1.5 + 2.75 + 4.0 = 8.25$.\nThe modified integral over $[2, 20]$ is: $\\int_2^{20} C_{P,\\text{interp}} dt = \\frac{20-2}{2}(C_P(2)+C_P(20)) = 9(3.0+0.6) = 9(3.6) = 32.4$.\nThe integral over $[20, 40]$ remains unchanged.\n\nNew total integrals:\n$\\int_0^{30} C_{P,\\text{gap}}(t) dt = \\int_0^2 C_P dt + \\int_2^{20} C_{P,\\text{interp}} dt + \\int_{20}^{30} C_P dt = 8.25 + 32.4 + 5.25 = 45.9$.\n$\\int_0^{40} C_{P,\\text{gap}}(t) dt = \\int_0^{30} C_{P,\\text{gap}} dt + \\int_{30}^{40} C_P dt = 45.9 + 4.0 = 49.9$.\n\nNow we recompute the $X$ variables. The $Y$ variables are unchanged.\nAt $t=30 \\ \\mathrm{min}$:\n$X_{\\text{gap}}(30) = \\frac{45.9}{0.45} = 102$\n\nAt $t=40 \\ \\mathrm{min}$:\n$X_{\\text{gap}}(40) = \\frac{49.9}{0.35} = \\frac{499}{3.5} = \\frac{998}{7} \\approx 142.57$\n\nThe new slope estimate $K_{i,\\mathrm{gap}}$ is:\n$K_{i,\\mathrm{gap}} = \\frac{Y(40)-Y(30)}{X_{\\text{gap}}(40)-X_{\\text{gap}}(30)} = \\frac{1/3}{998/7 - 102} = \\frac{1/3}{(998 - 714)/7} = \\frac{1/3}{284/7} = \\frac{7}{3 \\times 284} = \\frac{7}{852}$\n\n**Task 4: Relative bias computation**\nThe relative bias is defined as $\\frac{K_{i,\\mathrm{gap}} - K_{i,\\mathrm{full}}}{K_{i,\\mathrm{full}}}$.\nRelative Bias = $\\frac{7/852 - 0.01}{0.01} = \\frac{7/852}{1/100} - 1 = \\frac{700}{852} - 1 = \\frac{700-852}{852} = \\frac{-152}{852}$\nSimplifying the fraction by dividing numerator and denominator by their greatest common divisor, which is $4$:\nRelative Bias = $\\frac{-38}{213}$\nAs a decimal, this is approximately $-0.17840375...$. Rounded to four significant figures, the relative bias is $-0.1784$.\n\nThe linear interpolation over the gapped region significantly overestimates the true area under the $C_P(t)$ curve, which is convex. This leads to larger values for the $X$-axis variable in the Patlak plot, `flattening` the estimated slope and causing a negative bias in the $K_i$ estimate.\nThe true integral over $[2, 20]$ was $6.75+6.25+8.0 = 21.0$. The interpolated integral was $32.4$, a significant overestimation.", "answer": "$$\\boxed{-0.1784}$$", "id": "4880125"}, {"introduction": "This final practice is a capstone simulation that brings together all the core concepts of dynamic PET analysis. You will build a model from the ground up to generate realistic time-activity curves that incorporate not only the underlying tracer kinetics but also two critical real-world factors: partial volume effects (PVE) and measurement noise. By analyzing this simulated data, you will see firsthand how physical imaging limitations can bias kinetic parameter estimates and learn how to apply a recovery coefficient to correct for these effects, bridging the gap between idealized models and practical quantitative imaging [@problem_id:4880162].", "problem": "You are asked to write a complete, runnable program that simulates dynamic Positron Emission Tomography (PET) time-activity data with partial volume effects in small tumors, performs a Patlak graphical analysis to estimate the net influx rate constant, and then applies a known recovery coefficient to correct the estimate. The program must follow a principled approach based on compartmental mass balance for an irreversible tracer (for example, Fluorodeoxyglucose), not using shortcut formulas provided in the problem.\n\nThe fundamental base is the following. In an irreversible two-compartment tissue model, let $C_p(t)$ be the plasma input function, $C_t(t)$ be the tissue concentration of tracer, $K_i$ be the net influx rate constant (with unit $\\text{min}^{-1}$), and $V$ be the apparent distribution volume (dimensionless, $\\text{mL}/\\text{mL}$). Under conditions where irreversible trapping dominates, the tissue activity concentration can be expressed in terms of $C_p(t)$ and its time integral, and the Patlak transformation yields a linear relationship from which the slope equals the net influx rate constant. In a realistic PET measurement of a small tumor, the measured tissue concentration is reduced by a partial volume effect, commonly parameterized by a recovery coefficient $RC$ with $0 < RC \\le 1$, and measurement noise is present.\n\nYour program must:\n\n- Simulate the plasma input function $C_p(t)$ over $t \\in [0,60]$ minutes on a regular time grid with spacing $\\Delta t = 0.5$ minutes using a physically plausible tri-exponential form\n  $$C_p(t) = A_1 e^{-\\lambda_1 t} + A_2 e^{-\\lambda_2 t} + A_3 e^{-\\lambda_3 t},$$\n  where $(A_1,A_2,A_3) = (12,3,1)$ in $\\text{kBq}/\\text{mL}$ and $(\\lambda_1,\\lambda_2,\\lambda_3) = (0.5,0.05,0.005)$ in $\\text{min}^{-1}$.\n- Generate the noiseless tissue concentration using the irreversible accumulation relation\n  $$C_t^{\\text{true}}(t) = K_i \\int_0^t C_p(\\tau)\\, d\\tau + V\\, C_p(t),$$\n  with $K_i$ in $\\text{min}^{-1}$ and $V$ dimensionless.\n- Apply a partial volume effect to obtain the measured concentration\n  $$C_t^{\\text{meas}}(t) = RC \\cdot C_t^{\\text{true}}(t),$$\n  and then add zero-mean Gaussian noise with standard deviation\n  $$\\sigma(t) = \\sigma_{\\text{rel}} \\cdot C_t^{\\text{meas}}(t) + \\sigma_{\\text{abs}},$$\n  where $\\sigma_{\\text{rel}}$ is a dimensionless relative noise level and $\\sigma_{\\text{abs}}$ is an absolute noise level in $\\text{kBq}/\\text{mL}$.\n- Form the Patlak variables for the linear phase starting at a specified time $t_{\\text{lin}}$:\n  $$x(t) = \\frac{\\int_0^t C_p(\\tau)\\, d\\tau}{C_p(t)}, \\quad y(t) = \\frac{C_t^{\\text{obs}}(t)}{C_p(t)},$$\n  where $C_t^{\\text{obs}}(t)$ is the noisy measured concentration. Use ordinary least squares to fit $y(t) = s \\cdot x(t) + b$ over $t \\ge t_{\\text{lin}}$, and take the naive Patlak slope estimate $s$ (in $\\text{min}^{-1}$).\n- Compute the recovery-corrected estimate of the net influx rate constant\n  $$\\widehat{K}_i^{\\text{corr}} = \\frac{s}{RC}.$$\n\nPhysical units: All output values of slopes and corrected net influx rate constants must be expressed in $\\text{min}^{-1}$ and rounded to four decimal places. Angles are not involved. Do not use percentages; any proportions must be in decimal form.\n\nTest suite and parameters: Your program must evaluate the following four test cases, each specified by $(K_i, V, RC, \\sigma_{\\text{rel}}, t_{\\text{lin}}, \\text{seed})$ with $K_i$ in $\\text{min}^{-1}$, $V$ dimensionless, $RC$ dimensionless, $\\sigma_{\\text{rel}}$ dimensionless, $t_{\\text{lin}}$ in minutes, and $\\text{seed}$ for reproducible random noise.\n\n- Case $1$: $(0.010, 0.5, 1.0, 0.02, 20, 42)$, a baseline case with no partial volume loss.\n- Case $2$: $(0.015, 0.4, 0.6, 0.03, 20, 43)$, a moderate recovery coefficient representative of a small lesion.\n- Case $3$: $(0.005, 0.8, 0.35, 0.05, 20, 44)$, a low recovery coefficient and higher relative noise.\n- Case $4$: $(0.001, 1.0, 0.2, 0.03, 20, 45)$, a boundary-like case with very low $K_i$ and severe partial volume loss.\n\nUse $\\sigma_{\\text{abs}} = 0.05$ $\\text{kBq}/\\text{mL}$ in all cases. Ensure that simulated concentrations remain physically nonnegative after noise addition by clipping at zero if necessary.\n\nFinal output format: Your program should produce a single line of output containing a nested list of pairs for the four cases in order. Each pair is $[s,\\widehat{K}_i^{\\text{corr}}]$ with both entries rounded to four decimal places and expressed in $\\text{min}^{-1}$. For example, the output format must be\n$[ [s_1,\\widehat{K}_{i,1}^{\\text{corr}}], [s_2,\\widehat{K}_{i,2}^{\\text{corr}}], [s_3,\\widehat{K}_{i,3}^{\\text{corr}}], [s_4,\\widehat{K}_{i,4}^{\\text{corr}}] ].$", "solution": "The user-provided problem has been rigorously validated and is deemed valid. It is scientifically grounded in the principles of tracer kinetic modeling for Positron Emission Tomography (PET), well-posed with a complete and consistent set of parameters and instructions, and formulated objectively. The problem requires the implementation of a simulation and analysis pipeline that is standard in the field of quantitative medical imaging.\n\nThe solution proceeds by first simulating dynamic PET data according to the provided models and then analyzing the simulated data using the Patlak graphical method. The process is broken down into the following steps, which are executed for each of the four test cases.\n\n**1. Generation of Time Grid and Plasma Input Function**\n\nThe simulation is conducted over a time interval of $t \\in [0, 60]$ minutes. We define a discrete time grid $t_j = j \\cdot \\Delta t$ for $j = 0, 1, \\dots, N$, where the time step is $\\Delta t = 0.5$ minutes and $N = 60 / 0.5 = 120$.\n\nThe arterial plasma input function, $C_p(t)$, which describes the concentration of the tracer in the blood plasma over time, is modeled by the tri-exponential function:\n$$C_p(t) = A_1 e^{-\\lambda_1 t} + A_2 e^{-\\lambda_2 t} + A_3 e^{-\\lambda_3 t}$$\nThe parameters are given as $(A_1, A_2, A_3) = (12, 3, 1)$ in units of $\\text{kBq}/\\text{mL}$ and $(\\lambda_1, \\lambda_2, \\lambda_3) = (0.5, 0.05, 0.005)$ in units of $\\text{min}^{-1}$. This function is evaluated at each point $t_j$ on our discrete time grid.\n\n**2. Simulation of True Tissue Tracer Concentration**\n\nThe problem is based on an irreversible two-tissue compartment model. The total concentration of tracer in the tissue, $C_t(t)$, is the sum of tracer in the reversible compartment (free and non-specifically bound) and the irreversible compartment (metabolically trapped). The simplified integrated form of this model's solution is given as:\n$$C_t^{\\text{true}}(t) = K_i \\int_0^t C_p(\\tau)\\, d\\tau + V\\, C_p(t)$$\nHere, $K_i$ is the net influx rate constant (in $\\text{min}^{-1}$) representing the rate of irreversible trapping, and $V$ is the apparent volume of distribution (dimensionless) for the reversible compartments.\n\nThe integral term, $\\int_0^t C_p(\\tau)\\, d\\tau$, is computed numerically at each time point $t_j$. Since $C_p(t)$ is available as a discrete time series, the cumulative trapezoidal rule is the appropriate and standard method for this numerical integration. Let $I(t_j) = \\int_0^{t_j} C_p(\\tau)\\, d\\tau$. The integral is computed as:\n$$I(t_j) = \\sum_{k=1}^{j} \\frac{C_p(t_k) + C_p(t_{k-1})}{2} \\Delta t$$\nwith the initial condition $I(t_0) = 0$.\n\nUsing the computed values of $C_p(t_j)$ and $I(t_j)$, and the case-specific parameters for $K_i$ and $V$, the \"true\" noiseless tissue concentration $C_t^{\\text{true}}(t_j)$ is calculated for each time point.\n\n**3. Application of Partial Volume Effect and Noise Model**\n\nReal PET measurements, especially of small structures like tumors, are affected by the limited spatial resolution of the scanner. This leads to a partial volume effect (PVE), where the measured activity concentration is a mixture of the true concentration within the object and the concentration of surrounding tissues, effectively underestimating the true value. This is modeled by a recovery coefficient, $RC \\in (0, 1]$, where a smaller $RC$ corresponds to a greater signal loss. The measured concentration without noise is:\n$$C_t^{\\text{meas}}(t) = RC \\cdot C_t^{\\text{true}}(t)$$\n\nTo simulate realistic measurement conditions, zero-mean Gaussian noise is added to $C_t^{\\text{meas}}(t)$. The standard deviation of the noise, $\\sigma(t)$, is time-dependent and follows a mixed model with a relative and an absolute component:\n$$\\sigma(t) = \\sigma_{\\text{rel}} \\cdot C_t^{\\text{meas}}(t) + \\sigma_{\\text{abs}}$$\nwhere $\\sigma_{\\text{rel}}$ is a dimensionless relative noise level and $\\sigma_{\\text{abs}} = 0.05$ $\\text{kBq}/\\text{mL}$ is a constant absolute noise level. A noise value $\\epsilon(t_j)$ is drawn from the normal distribution $\\mathcal{N}(0, \\sigma(t_j)^2)$ for each time point using a seeded pseudo-random number generator for reproducibility. The final observed tissue concentration is:\n$$C_t^{\\text{obs}}(t_j) = C_t^{\\text{meas}}(t_j) + \\epsilon(t_j)$$\nAs tracer concentration must be non-negative, any resulting values of $C_t^{\\text{obs}}(t_j)$ that are less than $0$ are clipped to $0$.\n\n**4. Patlak Graphical Analysis and Parameter Estimation**\n\nThe Patlak plot is a graphical analysis technique that linearizes the kinetic model equations for times $t$ large enough that the reversible compartments have reached equilibrium. The transformation is defined by the following variables:\n$$x(t) = \\frac{\\int_0^t C_p(\\tau)\\, d\\tau}{C_p(t)} \\quad \\text{and} \\quad y(t) = \\frac{C_t^{\\text{obs}}(t)}{C_p(t)}$$\nFor the modeled system, substituting the expression for $C_t^{\\text{obs}}(t)$, we get:\n$$y(t) \\approx \\frac{RC \\cdot \\left(K_i \\int_0^t C_p(\\tau)\\, d\\tau + V\\, C_p(t)\\right)}{C_p(t)} = (RC \\cdot K_i) \\cdot x(t) + (RC \\cdot V)$$\nThis predicts a linear relationship between $y(t)$ and $x(t)$. The Patlak analysis consists of performing an ordinary least squares (OLS) linear regression on the data points $(x(t_j), y(t_j))$ for $t_j \\ge t_{\\text{lin}}$, where $t_{\\text{lin}}$ is the time at which the linear phase is assumed to begin. For all test cases, $t_{\\text{lin}} = 20$ minutes.\n\nThe OLS fit provides an estimate of the slope, $s$, which, according to the model, is an estimate of the product $RC \\cdot K_i$.\n$s \\approx RC \\cdot K_i$\n\n**5. Recovery Coefficient Correction**\n\nThe naively estimated slope $s$ from the Patlak plot of the PVE-affected data underestimates the true $K_i$ by a factor of $RC$. To obtain a corrected estimate of the net influx rate, $\\widehat{K}_i^{\\text{corr}}$, the slope $s$ is divided by the known recovery coefficient $RC$:\n$$\\widehat{K}_i^{\\text{corr}} = \\frac{s}{RC}$$\nThis procedure is performed for each of the four test cases, and the resulting pairs $[s, \\widehat{K}_i^{\\text{corr}}]$ are collected. The final values are rounded to four decimal places as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Simulates dynamic PET data with partial volume effects, performs Patlak analysis,\n    and applies a recovery coefficient correction for multiple test cases.\n    \"\"\"\n    \n    # Define simulation time parameters\n    t_max = 60.0  # minutes\n    dt = 0.5      # minutes\n    time_points = np.arange(0, t_max + dt, dt)\n\n    # Define plasma input function C_p(t) parameters\n    A = np.array([12.0, 3.0, 1.0])      # kBq/mL\n    lambdas = np.array([0.5, 0.05, 0.005]) # min^-1\n    \n    # Calculate C_p(t) and its cumulative integral\n    Cp_t = A[0] * np.exp(-lambdas[0] * time_points) + \\\n           A[1] * np.exp(-lambdas[1] * time_points) + \\\n           A[2] * np.exp(-lambdas[2] * time_points)\n\n    # Use scipy's cumulative_trapezoid for numerical integration\n    Int_Cp_t = cumulative_trapezoid(Cp_t, time_points, initial=0)\n\n    # Define test cases\n    # (Ki, V, RC, sigma_rel, t_lin, seed)\n    test_cases = [\n        (0.010, 0.5, 1.0, 0.02, 20, 42),\n        (0.015, 0.4, 0.6, 0.03, 20, 43),\n        (0.005, 0.8, 0.35, 0.05, 20, 44),\n        (0.001, 1.0, 0.2, 0.03, 20, 45)\n    ]\n    \n    sigma_abs = 0.05 # kBq/mL\n\n    results = []\n    \n    for case in test_cases:\n        Ki, V, RC, sigma_rel, t_lin, seed = case\n        \n        # 1. Generate true tissue concentration\n        Ct_true = Ki * Int_Cp_t + V * Cp_t\n        \n        # 2. Apply partial volume effect\n        Ct_meas = RC * Ct_true\n        \n        # 3. Add noise\n        rng = np.random.default_rng(seed)\n        sigma_t = sigma_rel * Ct_meas + sigma_abs\n        noise = rng.normal(0, sigma_t)\n        Ct_obs = Ct_meas + noise\n        \n        # 4. Enforce non-negativity\n        Ct_obs = np.maximum(0, Ct_obs)\n        \n        # 5. Perform Patlak analysis\n        # Select data points for the linear phase\n        linear_phase_indices = np.where(time_points >= t_lin)\n        \n        # Avoid division by zero, although unlikely for t>=20\n        # for the given Cp(t)\n        Cp_lin = Cp_t[linear_phase_indices]\n        valid_indices = np.where(Cp_lin > 1e-9)\n\n        # Form Patlak variables\n        x = Int_Cp_t[linear_phase_indices][valid_indices] / Cp_lin[valid_indices]\n        y = Ct_obs[linear_phase_indices][valid_indices] / Cp_lin[valid_indices]\n\n        # Perform ordinary least squares fit to get the slope 's'\n        # np.polyfit returns [slope, intercept] for degree 1\n        s, _ = np.polyfit(x, y, 1)\n\n        # 6. Compute recovery-corrected Ki\n        Ki_corr = s / RC if RC > 0 else 0\n        \n        results.append([s, Ki_corr])\n\n    # Format the final output string exactly as specified\n    formatted_results = [f\"[{s:.4f},{k:.4f}]\" for s, k in results]\n    final_output = f\"[{','.join(formatted_results)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "4880162"}]}