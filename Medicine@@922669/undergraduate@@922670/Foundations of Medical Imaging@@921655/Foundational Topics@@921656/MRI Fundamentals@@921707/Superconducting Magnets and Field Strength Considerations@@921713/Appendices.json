{"hands_on_practices": [{"introduction": "A key feature of superconducting magnets is their ability to operate in \"persistent mode,\" maintaining a powerful magnetic field for extended periods without an external power source. This practice delves into the physics behind this remarkable stability. By modeling the magnet as a nearly ideal circuit with a minute residual resistance, you will quantify the minuscule field decay over time, providing a concrete understanding of what makes these systems so robust for clinical imaging. [@problem_id:4928914]", "problem": "A whole-body Magnetic Resonance Imaging (MRI) superconducting magnet operated in persistent mode can be modeled as a closed loop consisting of an inductance $L$ and a small but finite residual joint resistance $R_{j}$. In persistent mode there is no external power supply, so the loop obeys Kirchhoff’s Voltage Law (KVL), and the magnetic field is proportional to the circulating current. Starting from KVL and the constitutive relation for inductors, derive the time dependence of the loop current and hence the magnetic field. Then, for $L = 500$ $\\mathrm{H}$ and $R_{j} = 10^{-12}$ $\\Omega$, calculate the time constant $\\tau$ and the percentage field drift over $t = 24$ hours for an initial field $B_{0} = 3$ $\\mathrm{T}$. Express $\\tau$ in seconds and express the percentage field drift as a decimal number of percent (for example, $0.25$ corresponds to $0.25$ in percent). Round both quantities to three significant figures.", "solution": "The problem statement is first subjected to validation.\n\n### Step 1: Extract Givens\n- **Model**: A closed loop circuit representing a superconducting magnet in persistent mode.\n- **Components**: Inductance $L$ and residual joint resistance $R_{j}$.\n- **Governing Law**: Kirchhoff’s Voltage Law (KVL) for a loop with no external power supply.\n- **Constitutive Relation**: The voltage across an inductor is $L \\frac{dI}{dt}$.\n- **Proportionality**: Magnetic field $B$ is proportional to the circulating current $I$.\n- **Values**: $L = 500\\,\\mathrm{H}$, $R_{j} = 10^{-12}\\,\\Omega$.\n- **Initial Condition**: Initial magnetic field is $B_{0} = 3\\,\\mathrm{T}$.\n- **Time Interval**: $t = 24\\,\\text{hours}$.\n- **Tasks**:\n    1.  Derive the time dependence of the loop current $I(t)$ and magnetic field $B(t)$.\n    2.  Calculate the time constant $\\tau$ in seconds.\n    3.  Calculate the percentage field drift over $t = 24$ hours.\n- **Output Requirements**:\n    1. Round $\\tau$ and the percentage field drift to three significant figures.\n    2. Express the percentage field drift as a decimal number of percent.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem models a real-world physical system (a superconducting magnet) using a standard RL circuit, a cornerstone of electromagnetism. The application of KVL is appropriate. The concept of a small residual resistance in superconducting joints is physically correct, and the provided values for inductance ($L=500\\,\\mathrm{H}$) and resistance ($R_j=10^{-12}\\,\\Omega$) are realistic for a large-bore, high-field MRI magnet. The problem is scientifically sound.\n- **Well-Posed**: The problem is clearly defined. It provides all necessary parameters and initial conditions to derive the requested functions and calculate the specified quantities. A unique and stable solution exists for the governing differential equation.\n- **Objective**: The problem is stated in precise, technical language, free of subjectivity or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a standard, well-posed problem in applied physics that is scientifically grounded and objective. A solution will be provided.\n\n### Solution Derivation\nThe superconducting magnet in persistent mode is modeled as a simple RL circuit with no external voltage source. Applying Kirchhoff’s Voltage Law (KVL), the sum of voltage drops across the components in the closed loop must be zero. The voltage drop across the inductor is $V_L = L \\frac{dI(t)}{dt}$ and the voltage drop across the residual resistance is $V_R = I(t)R_j$.\n\nTherefore, the KVL equation is:\n$$L \\frac{dI(t)}{dt} + I(t)R_{j} = 0$$\nThis is a first-order linear homogeneous ordinary differential equation. We can solve it by separation of variables:\n$$L \\frac{dI}{dt} = -I R_j$$\n$$\\frac{1}{I} dI = -\\frac{R_j}{L} dt$$\nWe integrate both sides. Let the initial current at time $t=0$ be $I_0$. We integrate the current from $I_0$ to $I(t)$ and time from $0$ to $t$:\n$$\\int_{I_0}^{I(t)} \\frac{1}{I'} dI' = \\int_{0}^{t} -\\frac{R_j}{L} dt'$$\n$$[\\ln|I'|]_{I_0}^{I(t)} = -\\frac{R_j}{L} [t']_{0}^{t}$$\n$$\\ln(I(t)) - \\ln(I_0) = -\\frac{R_j}{L} t$$\n$$\\ln\\left(\\frac{I(t)}{I_0}\\right) = -\\frac{R_j}{L} t$$\nExponentiating both sides gives the time dependence of the current:\n$$I(t) = I_0 \\exp\\left(-\\frac{R_j}{L}t\\right)$$\nThe problem states that the magnetic field $B$ is proportional to the current $I$. Let this proportionality be represented by a constant $k$, such that $B(t) = k I(t)$.\nAt $t=0$, the initial field is $B_0$ and the initial current is $I_0$, so $B_0 = k I_0$. From this, we have $k = B_0/I_0$.\nSubstituting this into the expression for $B(t)$:\n$$B(t) = \\left(\\frac{B_0}{I_0}\\right) I(t) = \\left(\\frac{B_0}{I_0}\\right) \\left(I_0 \\exp\\left(-\\frac{R_j}{L}t\\right)\\right)$$\n$$B(t) = B_0 \\exp\\left(-\\frac{R_j}{L}t\\right)$$\nThis is the time dependence of the magnetic field. Both the current and magnetic field exhibit exponential decay.\n\nThe standard form for exponential decay is $A(t) = A_0 \\exp(-t/\\tau)$, where $\\tau$ is the time constant. By comparing our derived expression for $B(t)$ with the standard form, we identify the time constant $\\tau$ for this RL circuit as:\n$$\\tau = \\frac{L}{R_j}$$\nUsing the given values $L = 500\\,\\mathrm{H}$ and $R_j = 10^{-12}\\,\\Omega$:\n$$\\tau = \\frac{500}{10^{-12}} = 5 \\times 10^{14} \\, \\mathrm{s}$$\nRounding to three significant figures, the time constant is $\\tau = 5.00 \\times 10^{14}\\,\\mathrm{s}$.\n\nNext, we calculate the percentage field drift over a period of $t = 24\\,\\text{hours}$. First, we convert this time to seconds:\n$$t = 24 \\, \\mathrm{h} \\times 60 \\, \\frac{\\mathrm{min}}{\\mathrm{h}} \\times 60 \\, \\frac{\\mathrm{s}}{\\mathrm{min}} = 86400 \\, \\mathrm{s}$$\nThe field drift is the change in the magnetic field, $\\Delta B = B_0 - B(t)$. The fractional drift is $\\frac{\\Delta B}{B_0}$. The percentage field drift, which we denote as $D_{\\%}$, is this fraction multiplied by $100$:\n$$D_{\\%} = \\frac{B_0 - B(t)}{B_0} \\times 100 = \\left(1 - \\frac{B(t)}{B_0}\\right) \\times 100$$\nSubstituting the expression for $B(t)$:\n$$D_{\\%} = \\left(1 - \\frac{B_0 \\exp(-t/\\tau)}{B_0}\\right) \\times 100 = \\left(1 - \\exp\\left(-\\frac{t}{\\tau}\\right)\\right) \\times 100$$\nNow we compute the value of the exponent's argument:\n$$\\frac{t}{\\tau} = \\frac{86400 \\, \\mathrm{s}}{5.00 \\times 10^{14} \\, \\mathrm{s}} = 1.728 \\times 10^{-10}$$\nSince this value is much less than $1$ ($t/\\tau \\ll 1$), we can use the first-order Taylor series approximation for the exponential function, $\\exp(-x) \\approx 1 - x$ for small $x$. This approximation is highly accurate in this case.\n$$D_{\\%} \\approx \\left(1 - \\left(1 - \\frac{t}{\\tau}\\right)\\right) \\times 100 = \\frac{t}{\\tau} \\times 100$$\n$$D_{\\%} \\approx (1.728 \\times 10^{-10}) \\times 100 = 1.728 \\times 10^{-8}$$\nThe problem asks for this value to be rounded to three significant figures.\n$$D_{\\%} \\approx 1.73 \\times 10^{-8}$$\nThis value represents the requested \"decimal number of percent,\" meaning if the drift were $0.25\\%$, the answer would be $0.25$. Our answer is $1.73 \\times 10^{-8}$.\n\nThe two quantities to be reported are the time constant $\\tau = 5.00 \\times 10^{14}\\,\\mathrm{s}$ and the percentage field drift $1.73 \\times 10^{-8}$.", "answer": "$$\\boxed{\\begin{pmatrix} 5.00 \\times 10^{14}  1.73 \\times 10^{-8} \\end{pmatrix}}$$", "id": "4928914"}, {"introduction": "The immense magnetic fields required for MRI correspond to a vast amount of stored energy, often on the scale of megajoules. This exercise addresses the critical safety engineering problem of managing this energy during a \"quench\"—an unplanned loss of superconductivity. You will calculate the necessary parameters for a quench protection circuit, balancing the need for rapid energy dissipation against the physical voltage limits of the magnet's components, a crucial trade-off in magnet design. [@problem_id:4928730]", "problem": "A superconducting solenoidal magnet used for Magnetic Resonance Imaging (MRI) is operated at a steady transport current $I_{0} = 250\\,\\mathrm{A}$ and has an inductance $L = 500\\,\\mathrm{H}$. If a quench is detected, a protection circuit instantaneously diverts the current into a pure dump resistor placed in series with the magnet, and the power supply is isolated, so that the ensuing current decay is governed solely by the magnet inductance and the dump resistance. The magnet terminal insulation is rated for a maximum allowable voltage magnitude of $V_{\\max} = 1.50\\,\\mathrm{kV}$ during the discharge. Starting from fundamental energy and circuit relations, compute the total electromagnetic energy stored in the magnet at $I_{0}$, and determine the minimum dump resistance needed so that the peak voltage magnitude at the magnet terminals does not exceed $V_{\\max}$. For this minimum resistance, also report the corresponding peak voltage magnitude and the exponential time constant of the current decay. Express the stored energy in megajoules (MJ), the resistance in ohms ($\\Omega$), the voltage in kilovolts (kV), and the time constant in seconds (s). Round all reported values to three significant figures. In your reasoning, justify how the constraints relate to field strength considerations for superconducting MRI magnets.", "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of electromagnetism and circuit theory, specifically as they apply to the critical engineering concern of quench protection in superconducting magnets. The problem is well-posed, objective, and contains all necessary information to compute a unique and meaningful solution. The provided physical values are realistic for a high-field medical imaging magnet.\n\nThe solution proceeds in four parts: calculation of the stored energy, determination of the minimum dump resistance and peak voltage, calculation of the decay time constant, and a justification of the relevance of these parameters to MRI magnet design.\n\n**1. Stored Electromagnetic Energy**\n\nThe total electromagnetic energy $E$ stored in an inductor with inductance $L$ carrying a current $I$ is given by the fundamental relation:\n$$E = \\frac{1}{2} L I^2$$\nThe problem provides the steady-state operating current $I_{0} = 250\\,\\mathrm{A}$ and the magnet inductance $L = 500\\,\\mathrm{H}$. Substituting these values, we compute the energy stored just before the quench:\n$$E = \\frac{1}{2} (500\\,\\mathrm{H}) (250\\,\\mathrm{A})^2 = \\frac{1}{2} (500) (62500)\\,\\mathrm{J} = 15,625,000\\,\\mathrm{J}$$\nTo express this value in megajoules ($1\\,\\mathrm{MJ} = 10^6\\,\\mathrm{J}$), we have:\n$$E = \\frac{15,625,000}{1,000,000}\\,\\mathrm{MJ} = 15.625\\,\\mathrm{MJ}$$\nRounding to three significant figures as required, the stored energy is $E \\approx 15.6\\,\\mathrm{MJ}$.\n\n**2. Circuit Analysis and Minimum Dump Resistance**\n\nWhen a quench occurs, the power supply is isolated, and the magnet current is shunted through a dump resistor $R_{dump}$. The magnet and resistor form a simple series RL circuit. Applying Kirchhoff's Voltage Law to this loop, we have:\n$$V_L(t) + V_R(t) = 0$$\nwhere $V_L(t)$ is the voltage across the inductor and $V_R(t)$ is the voltage across the resistor. These are given by $V_L(t) = L \\frac{dI(t)}{dt}$ and $V_R(t) = I(t)R_{dump}$. The resulting differential equation is:\n$$L \\frac{dI(t)}{dt} + I(t)R_{dump} = 0$$\nThe solution to this first-order homogeneous differential equation, with the initial condition $I(t=0) = I_0$, is an exponential decay:\n$$I(t) = I_0 \\exp\\left(-\\frac{R_{dump}}{L}t\\right) = I_0 \\exp\\left(-\\frac{t}{\\tau}\\right)$$\nwhere $\\tau = \\frac{L}{R_{dump}}$ is the exponential time constant of the current decay.\n\nThe voltage across the magnet terminals during this discharge is $V_L(t)$. From the circuit equation, $V_L(t) = -V_R(t) = -I(t)R_{dump}$. Substituting the expression for $I(t)$:\n$$V_L(t) = -(I_0 \\exp(-t/\\tau))R_{dump} = -I_0 R_{dump} \\exp(-t/\\tau)$$\nThe magnitude of this voltage is $|V_L(t)| = I_0 R_{dump} \\exp(-t/\\tau)$. The peak voltage magnitude occurs at the instant the discharge begins, $t=0$, because the exponential term is maximal at this time ($\\exp(0)=1$).\n$$|V_L|_{peak} = I_0 R_{dump}$$\nThe problem states that this peak voltage must not exceed the insulation rating $V_{max} = 1.50\\,\\mathrm{kV}$.\n$$|V_L|_{peak} \\le V_{max}$$\n$$I_0 R_{dump} \\le V_{max}$$\nTo find the minimum required dump resistance, $R_{dump, min}$, we must select the resistance that produces the maximum allowable voltage. A resistor smaller than this would produce a lower voltage, but the problem seeks the minimum resistance that still satisfies the constraint, which implies we should operate at the boundary. Therefore, we set the peak voltage equal to $V_{max}$:\n$$I_0 R_{dump, min} = V_{max}$$\nSolving for $R_{dump, min}$:\n$$R_{dump, min} = \\frac{V_{max}}{I_0}$$\nUsing the given values $V_{max} = 1.50\\,\\mathrm{kV} = 1500\\,\\mathrm{V}$ and $I_0 = 250\\,\\mathrm{A}$:\n$$R_{dump, min} = \\frac{1500\\,\\mathrm{V}}{250\\,\\mathrm{A}} = 6.00\\,\\Omega$$\nThe corresponding peak voltage magnitude is, by this definition, exactly the maximum allowable voltage, $V_{max} = 1.50\\,\\mathrm{kV}$.\n\n**3. Exponential Time Constant**\n\nThe time constant $\\tau$ for the current decay is calculated using the minimum resistance $R_{dump, min}$:\n$$\\tau = \\frac{L}{R_{dump, min}} = \\frac{500\\,\\mathrm{H}}{6.00\\,\\Omega} = 83.333...\\,\\mathrm{s}$$\nRounding to three significant figures, the time constant is $\\tau \\approx 83.3\\,\\mathrm{s}$.\n\n**4. Justification and Relation to Field Strength**\n\nThe parameters in this problem are directly linked to the fundamental requirements and operational safety of an MRI magnet.\nThe primary goal of an MRI magnet is to generate a strong, homogeneous magnetic field $B_0$ over the imaging volume. The signal-to-noise ratio (SNR) in MRI is approximately proportional to $B_0$, so higher fields (e.g., $1.5\\,\\mathrm{T}$, $3\\,\\mathrm{T}$, $7\\,\\mathrm{T}$) are highly desirable. The energy stored in the magnetic field is proportional to the square of the field strength and the volume it occupies ($E \\propto B_0^2 \\times Volume$). This means that high-field, whole-body MRI magnets store an immense amount of energy, on the order of megajoules, as calculated in part 1. This energy is a direct consequence of the required high field strength.\n\nA \"quench\" is an uncontrolled loss of superconductivity in the magnet coil, where a section of the coil transitions to its normal, resistive state. This resistive zone generates intense Joule heat ($P=I^2R_{zone}$), which can boil off the liquid helium cryogen and, more critically, cause permanent thermal damage or melting of the magnet windings if the energy is not dissipated quickly and safely.\n\nThe quench protection system, involving the dump resistor $R_{dump}$, is designed to rapidly extract the magnet's stored energy and dissipate it as heat externally, away from the delicate magnet coils. The rate of energy extraction is governed by the time constant $\\tau = L/R_{dump}$. A rapid discharge (small $\\tau$) requires a large $R_{dump}$.\n\nHowever, a large $R_{dump}$ creates a high peak voltage across the magnet terminals ($|V_L|_{peak} = I_0 R_{dump}$). If this voltage exceeds the dielectric strength of the magnet's insulation, $V_{max}$, it can cause an electrical arc between windings, short-circuiting and catastrophically destroying the magnet.\n\nTherefore, the design of the quench protection system involves a critical trade-off. The dump resistance $R_{dump}$ must be small enough to keep the terminal voltage below the insulation rating $V_{max}$, yet large enough to ensure the time constant $\\tau$ is short enough to prevent thermal damage to the coil. The calculation of a minimum resistance based on a maximum voltage, as performed here, is a central part of this engineering safety analysis.\n\nIn summary, the high stored energy is a consequence of the required high magnetic field for imaging. The voltage limit $V_{max}$ is a physical constraint of the magnet's construction. Together, these factors dictate the parameters ($R_{dump}$, $\\tau$) of the mandatory quench protection system.\n\nThe final computed values, rounded to three significant figures, are:\n- Stored Energy: $E = 15.6\\,\\mathrm{MJ}$\n- Minimum Dump Resistance: $R_{dump, min} = 6.00\\,\\Omega$\n- Peak Voltage Magnitude: $|V_L|_{peak} = 1.50\\,\\mathrm{kV}$\n- Time Constant: $\\tau = 83.3\\,\\mathrm{s}$", "answer": "$$\\boxed{\\begin{pmatrix} 15.6  6.00  1.50  83.3 \\end{pmatrix}}$$", "id": "4928730"}, {"introduction": "Achieving a highly uniform magnetic field is a central challenge in MRI magnet design, as homogeneity is crucial for avoiding image distortions and artifacts. This computational practice simulates the process of \"shimming,\" where adjustable magnetic fields are used to cancel out imperfections in the main field. By applying linear algebra to solve a least-squares problem, you will determine the optimal settings for a set of shim coils, mirroring the calibration process used in real-world MRI systems. [@problem_id:4928801]", "problem": "You are given a superconducting magnetic resonance imaging main magnet with a nominal uniform field and a set of shim coils. Deviations from uniformity are measured as a scalar magnetic field error map, denoted by $\\Delta B(\\mathbf{r})$ in tesla, within a Diameter Spherical Volume (DSV). Assume static fields and linear media so that superposition holds. Each shim channel $k$ produces a known spatial field pattern $s_k(\\mathbf{r})$ per unit current (in tesla per ampere), so that for any current vector $\\mathbf{I} \\in \\mathbb{R}^K$ the modeled correction field is\n$$\n\\Delta B_{\\text{model}}(\\mathbf{r}; \\mathbf{I}) = \\sum_{k=1}^K I_k\\, s_k(\\mathbf{r}).\n$$\nGiven discrete measurements $\\Delta B(\\mathbf{r}_i)$ at sample locations $\\mathbf{r}_i \\in \\mathbb{R}^3$, the objective is to choose shim currents $\\mathbf{I}$ that minimize the $L_2$ norm of the residual field inhomogeneity inside the DSV:\n$$\n\\min_{\\mathbf{I} \\in \\mathbb{R}^K}\\ \\left\\| \\mathbf{S}\\mathbf{I} - \\mathbf{b} \\right\\|_2,\n$$\nwhere $\\mathbf{S} \\in \\mathbb{R}^{N \\times K}$ has entries $S_{i,k} = s_k(\\mathbf{r}_i)$ and $\\mathbf{b} \\in \\mathbb{R}^N$ has entries $b_i = \\Delta B(\\mathbf{r}_i)$. Only sample points with $\\|\\mathbf{r}_i\\|_2 \\le R$ (inside or on the DSV of radius $R$) are to be included in the fit; all others must be discarded. In the case of multiple minimizers, select the one with minimum Euclidean norm $\\|\\mathbf{I}\\|_2$.\n\nFor this problem, use $K = 4$ shim channels with the following field patterns per ampere:\n- Channel $1$ (Z0 uniform shim): $s_1(\\mathbf{r}) = \\gamma_0$, where $\\gamma_0 = 20 \\times 10^{-6}\\ \\text{T/A}$.\n- Channels $2$–$4$ (first-order gradient shims): $s_2(\\mathbf{r}) = \\gamma_1\\, x$, $s_3(\\mathbf{r}) = \\gamma_1\\, y$, $s_4(\\mathbf{r}) = \\gamma_1\\, z$, where $\\gamma_1 = 40 \\times 10^{-6}\\ \\text{T}/(\\text{A}\\cdot\\text{m})$ and $\\mathbf{r} = (x,y,z)$ in meters.\n\nLet the underlying “true” currents (used to synthesize the measured data for all cases below) be\n$$\n\\mathbf{I}_{\\text{true}} = \\begin{bmatrix} 0.5 \\\\ 1.2 \\\\ -0.8 \\\\ 0.3 \\end{bmatrix}\\ \\text{A}.\n$$\n\nThe measurements for each test case are generated by\n$$\n\\Delta B(\\mathbf{r}_i) = \\gamma_0\\, I_1 + \\gamma_1 \\left( I_2\\, x_i + I_3\\, y_i + I_4\\, z_i \\right) + n_i,\n$$\nwith $n_i$ a known additive noise term in tesla (specified below for each case). Angles do not appear in this problem. All physical quantities must be treated in International System of Units; express all currents in amperes.\n\nImplement a program that constructs $\\mathbf{S}$ and $\\mathbf{b}$ for each test case, filters by the specified DSV radius $R$, and computes the minimum Euclidean-norm least-squares solution $\\hat{\\mathbf{I}}$ that minimizes $\\|\\mathbf{S}\\mathbf{I} - \\mathbf{b}\\|_2$. Use a numerically stable method that returns the minimum-norm solution for any rank.\n\nYour program must solve the following three test cases and output all three solutions.\n\nTest Case A (happy path, noiseless, well-determined):\n- Radius $R = 0.15\\ \\text{m}$.\n- Sample locations $\\{\\mathbf{r}_i\\}$ in meters:\n  $\\left(0.10, 0.00, 0.00\\right)$,\n  $\\left(0.00, 0.10, 0.00\\right)$,\n  $\\left(0.00, 0.00, 0.10\\right)$,\n  $\\left(-0.10, 0.00, 0.00\\right)$,\n  $\\left(0.00, -0.10, 0.00\\right)$,\n  $\\left(0.00, 0.00, -0.10\\right)$,\n  $\\left(0.07, 0.07, 0.07\\right)$,\n  $\\left(-0.07, -0.02, 0.09\\right)$.\n- Noise vector $\\mathbf{n}$: all entries $0$ tesla.\n\nTest Case B (underdetermined, noiseless, minimum-norm selection required):\n- Radius $R = 0.10\\ \\text{m}$.\n- Sample locations $\\{\\mathbf{r}_i\\}$ in meters:\n  $\\left(0.08, 0.06, 0.00\\right)$,\n  $\\left(-0.05, 0.00, 0.0866\\right)$.\n- Noise vector $\\mathbf{n}$: all entries $0$ tesla.\n\nTest Case C (points outside DSV discarded, small measurement noise):\n- Radius $R = 0.12\\ \\text{m}$.\n- Sample locations $\\{\\mathbf{r}_i\\}$ in meters:\n  $\\left(0.11, 0.00, 0.05\\right)$,\n  $\\left(0.00, 0.12, 0.00\\right)$,\n  $\\left(-0.12, 0.00, 0.00\\right)$,\n  $\\left(0.00, 0.00, 0.12\\right)$,\n  $\\left(0.10, 0.06, 0.02\\right)$,\n  $\\left(-0.09, -0.09, -0.09\\right)$.\n- Noise vector $\\mathbf{n}$ in tesla, aligned with the above order:\n  $\\left(1.0\\times 10^{-8},\\ -2.0\\times 10^{-8},\\ 0.5\\times 10^{-8},\\ -1.5\\times 10^{-8},\\ 2.5\\times 10^{-8},\\ -0.3\\times 10^{-8}\\right)$.\n\nRequirements:\n- For each test case, form $\\mathbf{S}$ using only sample points with $\\|\\mathbf{r}_i\\|_2 \\le R$, and form $\\mathbf{b}$ using the given generation rule and noise.\n- Compute $\\hat{\\mathbf{I}}$ as the minimum Euclidean-norm solution to the least-squares problem.\n- Report the currents in amperes, each rounded to exactly six digits after the decimal point.\n\nFinal Output Format:\nYour program should produce a single line of output containing a list of three sublists, one per test case, in the same order A, B, C. Each sublist must contain the four rounded currents in amperes for channels $1$ through $4$. For example:\n\"[[I11,I12,I13,I14],[I21,I22,I23,I24],[I31,I32,I33,I34]]\"\nwhere each $I_{jk}$ is a decimal with exactly six digits after the decimal point and no units printed.", "solution": "The user's problem statement has been analyzed and validated.\n\n### Step 1: Extract Givens\n- **Objective**: Find the current vector $\\mathbf{I} \\in \\mathbb{R}^K$ that solves the minimum-norm least-squares problem: $\\min_{\\mathbf{I} \\in \\mathbb{R}^K}\\ \\left\\| \\mathbf{S}\\mathbf{I} - \\mathbf{b} \\right\\|_2$, with the additional constraint that if multiple minimizers exist, the one with the minimum Euclidean norm $\\|\\mathbf{I}\\|_2$ is chosen.\n- **Model Parameters**:\n    - Number of shim channels: $K = 4$.\n    - Shim basis functions:\n        - $s_1(\\mathbf{r}) = \\gamma_0$, with $\\gamma_0 = 20 \\times 10^{-6}\\ \\text{T/A}$.\n        - $s_2(\\mathbf{r}) = \\gamma_1\\, x$, $s_3(\\mathbf{r}) = \\gamma_1\\, y$, $s_4(\\mathbf{r}) = \\gamma_1\\, z$, with $\\gamma_1 = 40 \\times 10^{-6}\\ \\text{T}/(\\text{A}\\cdot\\text{m})$. Here $\\mathbf{r} = (x,y,z)$.\n- **Data Generation Model**:\n    - \"True\" currents: $\\mathbf{I}_{\\text{true}} = \\begin{bmatrix} 0.5  1.2  -0.8  0.3 \\end{bmatrix}^T\\ \\text{A}$.\n    - Measured field: $\\Delta B(\\mathbf{r}_i) = \\sum_{k=1}^4 I_{\\text{true}, k} s_k(\\mathbf{r}_i) + n_i = \\gamma_0 I_{\\text{true}, 1} + \\gamma_1 (I_{\\text{true}, 2}x_i + I_{\\text{true}, 3}y_i + I_{\\text{true}, 4}z_i) + n_i$.\n- **System Matrices**:\n    - $\\mathbf{S}$ matrix entries: $S_{ik} = s_k(\\mathbf{r}_i)$.\n    - $\\mathbf{b}$ vector entries: $b_i = \\Delta B(\\mathbf{r}_i)$.\n- **DSV Constraint**: Only sample points $\\mathbf{r}_i$ satisfying $\\|\\mathbf{r}_i\\|_2 \\le R$ are used to construct $\\mathbf{S}$ and $\\mathbf{b}$.\n- **Test Case A**:\n    - $R = 0.15\\ \\text{m}$.\n    - Sample points $\\{\\mathbf{r}_i\\}$: $(0.10, 0, 0)$, $(0, 0.10, 0)$, $(0, 0, 0.10)$, $(-0.10, 0, 0)$, $(0, -0.10, 0)$, $(0, 0, -0.10)$, $(0.07, 0.07, 0.07)$, $(-0.07, -0.02, 0.09)$. All coordinates in meters.\n    - Noise $\\mathbf{n}$: all entries are $0\\ \\text{T}$.\n- **Test Case B**:\n    - $R = 0.10\\ \\text{m}$.\n    - Sample points $\\{\\mathbf{r}_i\\}$: $(0.08, 0.06, 0)$, $(-0.05, 0, 0.0866)$. All coordinates in meters.\n    - Noise $\\mathbf{n}$: all entries are $0\\ \\text{T}$.\n- **Test Case C**:\n    - $R = 0.12\\ \\text{m}$.\n    - Sample points $\\{\\mathbf{r}_i\\}$: $(0.11, 0, 0.05)$, $(0, 0.12, 0)$, $(-0.12, 0, 0)$, $(0, 0, 0.12)$, $(0.10, 0.06, 0.02)$, $(-0.09, -0.09, -0.09)$. All coordinates in meters.\n    - Noise $\\mathbf{n}$: $(10^{-8}, -2\\times 10^{-8}, 0.5\\times 10^{-8}, -1.5\\times 10^{-8}, 2.5\\times 10^{-8}, -0.3\\times 10^{-8})\\ \\text{T}$.\n- **Output Requirements**: Report current vector $\\hat{\\mathbf{I}}$ for each case, with each component rounded to $6$ decimal places, in a specific string format.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It describes a standard linear algebra application in MRI physics (field shimming). The model is a physically reasonable simplification (zeroth and first-order shims). The objective function is a standard least-squares minimization. The problem provides all necessary data and constants, and the request to find the minimum-norm solution makes the problem well-posed even for rank-deficient systems. The given physical values are plausible. There are no contradictions, ambiguities, or pseudo-scientific claims.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Principle-Based Solution\nThe core of this problem is to find the optimal shim currents $\\mathbf{I}$ that minimize the squared Euclidean norm of the residual magnetic field error, which is formulated as a linear least-squares problem:\n$$\n\\min_{\\mathbf{I} \\in \\mathbb{R}^K} \\| \\mathbf{S}\\mathbf{I} - \\mathbf{b} \\|_2^2\n$$\nThe problem further specifies that if the solution is not unique (i.e., if the system matrix $\\mathbf{S}$ is rank-deficient), the solution with the minimum Euclidean norm $\\|\\mathbf{I}\\|_2$ should be selected. This defines the minimum-norm least-squares problem, which always has a unique solution given by:\n$$\n\\hat{\\mathbf{I}} = \\mathbf{S}^{+} \\mathbf{b}\n$$\nwhere $\\mathbf{S}^{+}$ is the Moore-Penrose pseudoinverse of $\\mathbf{S}$. This single formulation correctly handles all cases:\n- If $\\mathbf{S}$ has full column rank (overdetermined or well-determined system), $\\mathbf{S}^{+} = (\\mathbf{S}^T\\mathbf{S})^{-1}\\mathbf{S}^T$, yielding the standard unique least-squares solution.\n- If $\\mathbf{S}$ is rank-deficient (underdetermined or ill-conditioned system), the pseudoinverse provides the solution that both minimizes the residual $\\| \\mathbf{S}\\mathbf{I} - \\mathbf{b} \\|_2$ and has the smallest norm $\\|\\mathbf{I}\\|_2$ among all such minimizers.\n\nNumerically stable algorithms, such as those based on Singular Value Decomposition (SVD), are preferred for computing the pseudoinverse and solving the least-squares problem. The `numpy.linalg.lstsq` function in Python provides such an implementation, returning the minimum-norm solution by default.\n\nThe procedure for each test case is as follows:\n\n1.  **Data Filtering**: The first step is to filter the given sample locations $\\{\\mathbf{r}_i\\}$ and their corresponding noise values $\\{n_i\\}$ based on the Diameter Spherical Volume (DSV) radius $R$. A point $\\mathbf{r}_i$ is included if and only if its Euclidean norm $\\|\\mathbf{r}_i\\|_2 = \\sqrt{x_i^2 + y_i^2 + z_i^2}$ is less than or equal to $R$. Let the set of filtered points be $\\{\\mathbf{r}'_j\\}_{j=1}^N$ and the corresponding noise vector be $\\mathbf{n}' \\in \\mathbb{R}^N$.\n\n2.  **System Matrix Construction**: The system matrix $\\mathbf{S} \\in \\mathbb{R}^{N \\times 4}$ is constructed based on the $N$ filtered points. The $j$-th row of $\\mathbf{S}$ corresponds to the point $\\mathbf{r}'_j = (x'_j, y'_j, z'_j)$ and is given by:\n    $$\n    \\mathbf{S}_{j,:} = \\begin{bmatrix} s_1(\\mathbf{r}'_j)  s_2(\\mathbf{r}'_j)  s_3(\\mathbf{r}'_j)  s_4(\\mathbf{r}'_j) \\end{bmatrix} = \\begin{bmatrix} \\gamma_0  \\gamma_1 x'_j  \\gamma_1 y'_j  \\gamma_1 z'_j \\end{bmatrix}\n    $$\n    where $\\gamma_0 = 20 \\times 10^{-6}\\ \\text{T/A}$ and $\\gamma_1 = 40 \\times 10^{-6}\\ \\text{T/(A}\\cdot\\text{m})$.\n\n3.  **Measurement Vector Construction**: The measurement vector $\\mathbf{b} \\in \\mathbb{R}^N$ is synthesized using the true currents $\\mathbf{I}_{\\text{true}}$ and the filtered noise vector $\\mathbf{n}'$. The $j$-th element $b_j$ is the simulated measurement at point $\\mathbf{r}'_j$:\n    $$\n    b_j = \\left( \\sum_{k=1}^4 S_{jk} I_{\\text{true},k} \\right) + n'_j\n    $$\n    In matrix form, this is calculated efficiently as $\\mathbf{b} = \\mathbf{S} \\mathbf{I}_{\\text{true}} + \\mathbf{n}'$.\n\n4.  **Solving the System**: The minimum-norm least-squares solution $\\hat{\\mathbf{I}}$ is computed by solving the system for $\\mathbf{I}$ using a robust numerical solver. $\\hat{\\mathbf{I}}$ is the sought-after vector of shim currents.\n\n5.  **Final Formatting**: The four components of the resulting vector $\\hat{\\mathbf{I}}$ are rounded to six decimal places as required.\n\nThis process is repeated for each of the three test cases.\n- **Case A** represents an overdetermined ($8$ points, $4$ unknowns), noiseless system. All points are within the DSV. We expect the solution to be exactly $\\hat{\\mathbf{I}} = \\mathbf{I}_{\\text{true}}$.\n- **Case B** is an underdetermined ($2$ points, $4$ unknowns), noiseless system. Both points are within the DSV. The solution will be the minimum-norm projection of $\\mathbf{I}_{\\text{true}}$ onto the row space of $\\mathbf{S}$, which will differ from $\\mathbf{I}_{\\text{true}}$.\n- **Case C** is an overdetermined system with noise. One of the $6$ initial points lies outside the DSV and must be discarded, resulting in a system with $5$ points and $4$ unknowns. Due to the presence of noise, the resulting $\\hat{\\mathbf{I}}$ will be an estimate of, but not identical to, $\\mathbf{I}_{\\text{true}}$.", "answer": "[[0.500000,1.200000,-0.800000,0.300000],[0.499119,0.814320,-0.639396,0.505842],[0.500356,1.199671,-0.800050,0.300096]]", "id": "4928801"}]}