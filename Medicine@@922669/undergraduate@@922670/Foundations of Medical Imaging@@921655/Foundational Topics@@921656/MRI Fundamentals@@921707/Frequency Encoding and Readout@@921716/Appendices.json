{"hands_on_practices": [{"introduction": "Translating the theory of frequency encoding into a high-quality MR image is fundamentally an engineering design challenge. In this practice, you will step into the role of an MRI physicist, tasked with designing a readout gradient waveform. This exercise [@problem_id:4886591] requires you to balance the competing demands of image resolution, acquisition speed, and the physical limitations of the MRI hardware, such as maximum gradient strength and slew rate, to find the most time-efficient solution.", "problem": "A single-shot frequency-encoding readout in Magnetic Resonance Imaging (MRI) is to be designed for the $x$-direction. You are given a target field of view $ \\mathrm{FOV}_x $ and spatial resolution $\\delta x$, and you must choose a constant readout gradient magnitude $G_x$ during data acquisition, a sampling dwell time $\\Delta t$, and the readout duration. The gradient waveform is a symmetric trapezoid: it ramps up linearly from $0$ to $G_x$ at the maximum allowed slew rate, holds constant at $G_x$ during data sampling, and then ramps down linearly at the maximum allowed slew rate back to $0$. The design must satisfy both the maximum gradient amplitude and maximum slew rate constraints, and it must respect the maximum sampling rate of the Analog-to-Digital Converter (ADC). If multiple designs are feasible, choose the one that minimizes the total readout duration (including both ramps and flat-top acquisition).\n\nUse the following parameters:\n- Target field of view $ \\mathrm{FOV}_x = 240 \\text{ mm}$.\n- Target resolution $\\delta x = \\mathrm{FOV}_x / 256$.\n- Maximum gradient amplitude $G_{\\max} = 35 \\text{ mT/m}$.\n- Maximum slew rate $S_{\\max} = 150 \\text{ T/m/s}$.\n- ADC maximum sampling rate $f_{s,\\max} = 5.0 \\times 10^{5} \\text{ Hz}$.\n- Proton gyromagnetic ratio $\\gamma = 2\\pi \\times 42.58 \\times 10^{6} \\text{ rad s}^{-1}\\text{T}^{-1}$.\n\nAssume ideal, instantaneous switching at the start and end of the readout trapezoid beyond the slew-limited ramps, no eddy-current or relaxation effects during the short readout, and that sampling occurs only during the constant-amplitude flat top. Using only fundamental spatial-encoding and sampling relationships, determine the minimum achievable total readout duration (including both ramps and the flat top) that meets all constraints. Express your final answer in milliseconds, and round your answer to $4$ significant figures.", "solution": "The frequency-encoding readout design is governed by two foundational principles in Magnetic Resonance Imaging (MRI):\n\n1. Spatial encoding by gradients arises from the Larmor relationship $ \\omega(x) = \\gamma B(x) $, where $B(x) = B_0 + G_x x$ during the readout gradient. This produces a spatially dependent precession frequency that maps position $x$ to frequency.\n\n2. The $k$-space formalism for Cartesian sampling defines\n$$\nk_x(t) = \\frac{\\gamma}{2\\pi} \\int_{0}^{t} G_x(\\tau)\\, d\\tau,\n$$\nand the sampling relationships\n$$\n\\Delta k_x = \\frac{1}{\\mathrm{FOV}_x}, \\qquad k_{x,\\max} = \\frac{1}{2\\,\\delta x},\n$$\nwhich enforce, respectively, the field-of-view condition (no aliasing) and the resolution requirement (extent of $k$-space coverage).\n\nDuring the flat-top readout at constant gradient $G_x$, the slope in $k$-space is\n$$\n\\frac{d k_x}{dt} = \\frac{\\gamma}{2\\pi} G_x.\n$$\nSampling every $\\Delta t$ advances $k_x$ by\n$$\n\\Delta k_x = \\frac{\\gamma}{2\\pi} G_x \\,\\Delta t.\n$$\nThe field-of-view requirement $\\Delta k_x = 1/\\mathrm{FOV}_x$ therefore gives\n$$\n\\Delta t = \\frac{2\\pi}{\\gamma \\, G_x \\, \\mathrm{FOV}_x}.\n$$\nThe total $k$-space width to be traversed is $2 k_{x,\\max} = 1/\\delta x$. With constant $G_x$, the flat-top duration needed to traverse this width is\n$$\nT_{\\mathrm{flat}} = \\frac{2 k_{x,\\max}}{(\\gamma/(2\\pi))\\, G_x} = \\frac{4\\pi \\, k_{x,\\max}}{\\gamma \\, G_x} = \\frac{2\\pi}{\\gamma \\, G_x \\, \\delta x}.\n$$\nThe gradient ramps are limited by the maximum slew rate $S_{\\max}$, so the time to ramp from $0$ to $G_x$ is\n$$\nt_{\\mathrm{ramp}} = \\frac{G_x}{S_{\\max}},\n$$\nand the total readout duration, including both ramps and the flat-top, is\n$$\nT_{\\mathrm{tot}}(G_x) = 2\\, t_{\\mathrm{ramp}} + T_{\\mathrm{flat}} = \\frac{2 G_x}{S_{\\max}} + \\frac{2\\pi}{\\gamma \\, G_x \\, \\delta x}.\n$$\nIf there were no constraints on $G_x$, the optimal $G_x$ minimizing $T_{\\mathrm{tot}}(G_x)$ is obtained by differentiating with respect to $G_x$ and setting to zero:\n$$\n\\frac{d T_{\\mathrm{tot}}}{d G_x} = \\frac{2}{S_{\\max}} - \\frac{2\\pi}{\\gamma \\, \\delta x} \\frac{1}{G_x^{2}} = 0\n\\;\\;\\Rightarrow\\;\\;\nG_{x,\\mathrm{opt}} = \\sqrt{\\frac{\\pi \\, S_{\\max}}{\\gamma \\, \\delta x}}.\n$$\nHowever, there are two hard upper bounds on $G_x$:\n- The hardware amplitude limit $G_{\\max}$.\n- The Analog-to-Digital Converter (ADC) maximum sampling rate $f_{s,\\max}$, which imposes a minimum dwell time $\\Delta t_{\\min} = 1/f_{s,\\max}$. The field-of-view sampling condition requires $\\Delta t = 2\\pi/(\\gamma G_x \\mathrm{FOV}_x) \\ge \\Delta t_{\\min}$, equivalently\n$$\nG_x \\le G_{\\mathrm{ADC}} \\equiv \\frac{2\\pi}{\\gamma \\, \\mathrm{FOV}_x \\, \\Delta t_{\\min}}.\n$$\nTherefore, the feasible $G_x$ must satisfy $0 < G_x \\le \\min(G_{\\max}, G_{\\mathrm{ADC}})$. The minimizing choice is\n$$\nG_x^{\\star} = \n\\begin{cases}\nG_{x,\\mathrm{opt}}, & \\text{if } G_{x,\\mathrm{opt}} \\le \\min(G_{\\max}, G_{\\mathrm{ADC}}),\\\\\n\\min(G_{\\max}, G_{\\mathrm{ADC}}), & \\text{otherwise.}\n\\end{cases}\n$$\n\nNow evaluate numerically. First convert given quantities to consistent units and compute derived values:\n- $\\mathrm{FOV}_x = 240 \\text{ mm} = 0.240 \\text{ m}$.\n- $\\delta x = \\mathrm{FOV}_x/256 = 0.240/256 = 0.0009375 \\text{ m}$.\n- $G_{\\max} = 35 \\text{ mT/m} = 0.035 \\text{ T/m}$.\n- $S_{\\max} = 150 \\text{ T/m/s}$.\n- $f_{s,\\max} = 5.0 \\times 10^{5} \\text{ Hz} \\Rightarrow \\Delta t_{\\min} = 1/f_{s,\\max} = 2.0 \\times 10^{-6} \\text{ s}$.\n- $\\gamma = 2\\pi \\times 42.58 \\times 10^{6} \\text{ rad s}^{-1}\\text{T}^{-1}$.\n\nCompute the unconstrained optimum:\n$$\nG_{x,\\mathrm{opt}} = \\sqrt{\\frac{\\pi \\, S_{\\max}}{\\gamma \\, \\delta x}}\n= \\sqrt{\\frac{\\pi \\times 150}{\\left(2\\pi \\times 42.58 \\times 10^{6}\\right) \\times 0.0009375}}\n= \\sqrt{\\frac{150}{2 \\times 42.58 \\times 10^{6} \\times 0.0009375}}.\n$$\nNumerically,\n$$\n\\gamma \\, \\delta x = \\left(2\\pi \\times 42.58 \\times 10^{6}\\right) \\times 0.0009375 \\approx 2.50817 \\times 10^{5} \\text{ s}^{-1}\\text{T}^{-1},\n$$\nso\n$$\nG_{x,\\mathrm{opt}} \\approx \\sqrt{\\frac{\\pi \\times 150}{2.50817 \\times 10^{5}}} \\approx \\sqrt{1.878 \\times 10^{-3}} \\approx 4.333 \\times 10^{-2} \\text{ T/m}.\n$$\nNext, compute the ADC-imposed bound:\n$$\nG_{\\mathrm{ADC}} = \\frac{2\\pi}{\\gamma \\, \\mathrm{FOV}_x \\, \\Delta t_{\\min}}\n= \\frac{2\\pi}{\\left(2\\pi \\times 42.58 \\times 10^{6}\\right) \\times 0.240 \\times 2.0 \\times 10^{-6}}\n= \\frac{1}{42.58 \\times 10^{6} \\times 0.240 \\times 2.0 \\times 10^{-6}}.\n$$\nNumerically,\n$$\nG_{\\mathrm{ADC}} \\approx \\frac{1}{20.4384} \\text{ T/m} \\approx 4.891 \\times 10^{-2} \\text{ T/m}.\n$$\nTherefore,\n$$\nG_{x,\\mathrm{opt}} \\approx 0.04333 \\text{ T/m}, \\quad G_{\\max} = 0.035 \\text{ T/m}, \\quad G_{\\mathrm{ADC}} \\approx 0.04891 \\text{ T/m}.\n$$\nThe feasible maximum is $\\min(G_{\\max}, G_{\\mathrm{ADC}}) = 0.035 \\text{ T/m}$, which is less than $G_{x,\\mathrm{opt}}$. Thus the minimizing feasible choice is\n$$\nG_x^{\\star} = G_{\\max} = 0.035 \\text{ T/m}.\n$$\nWith this $G_x^{\\star}$, the dwell time from the field-of-view condition is\n$$\n\\Delta t = \\frac{2\\pi}{\\gamma \\, G_x^{\\star} \\, \\mathrm{FOV}_x}\n= \\frac{2\\pi}{\\left(2\\pi \\times 42.58 \\times 10^{6}\\right)\\times 0.035 \\times 0.240}\n\\approx 2.795 \\times 10^{-6} \\text{ s},\n$$\nwhich satisfies $\\Delta t \\ge \\Delta t_{\\min}$, as required.\n\nThe flat-top duration can be found either from $T_{\\mathrm{flat}} = \\frac{2\\pi}{\\gamma \\, G_x^{\\star} \\, \\delta x}$ or equivalently $T_{\\mathrm{flat}} = N \\Delta t$ with $N = \\mathrm{FOV}_x/\\delta x = 256$. Using the latter for numerical consistency,\n$$\nT_{\\mathrm{flat}} = 256 \\times 2.795 \\times 10^{-6} \\text{ s} \\approx 7.155 \\times 10^{-4} \\text{ s} = 0.7155 \\text{ ms}.\n$$\nThe slew-limited ramp time is\n$$\nt_{\\mathrm{ramp}} = \\frac{G_x^{\\star}}{S_{\\max}} = \\frac{0.035}{150} \\text{ s} \\approx 2.333 \\times 10^{-4} \\text{ s} = 0.2333 \\text{ ms}.\n$$\nTherefore, the total readout duration is\n$$\nT_{\\mathrm{tot}} = 2\\, t_{\\mathrm{ramp}} + T_{\\mathrm{flat}} \\approx 2 \\times 0.2333 \\text{ ms} + 0.7155 \\text{ ms} \\approx 1.182 \\text{ ms}.\n$$\nRounded to $4$ significant figures and expressed in milliseconds, the minimum achievable total readout duration is $1.182 \\text{ ms}$.", "answer": "$$\\boxed{1.182}$$", "id": "4886591"}, {"introduction": "An optimally designed readout gradient is only the first step; we must also consider how it interacts with the complex biochemical environment of the human body. This exercise [@problem_id:4867546] explores the practical consequences of frequency encoding in the presence of different tissues, specifically the chemical shift artifact between fat and water. You will not only calculate the magnitude of this spatial misregistration but also engage in clinical problem-solving by evaluating a common strategy—swapping the frequency and phase-encoding axes—to improve diagnostic image quality.", "problem": "A radiologist is acquiring axial Gradient Recalled Echo (GRE) Magnetic Resonance Imaging (MRI) of the orbits at static magnetic field strength $B_0 = 3\\,\\mathrm{T}$ to evaluate the optic nerve sheath. The sequence uses Cartesian sampling with a frequency-encoding (readout) gradient applied along the left–right axis and a phase-encoding gradient along the superior–inferior axis. The Field-of-View (FOV) and matrix along the readout direction are $\\mathrm{FOV}_x = 220\\,\\mathrm{mm}$ and $N_x = 256$, respectively. The total readout bandwidth is $BW_{\\mathrm{read}} = 62.5\\,\\mathrm{kHz}$. The gyromagnetic ratio for hydrogen is $\\gamma / (2\\pi) \\approx 42.58\\,\\mathrm{MHz/T}$. The chemical shift between water and triglyceride fat is approximately $3.5\\,\\mathrm{ppm}$ relative to the Larmor frequency.\n\nUsing as a starting point (i) the Larmor relationship $f = (\\gamma/2\\pi)\\,B$ and (ii) the linear mapping between spatial position and frequency under a constant readout gradient, reason from first principles to determine the expected spatial misregistration between fat and water along the readout axis for these parameters. Then consider the strategy of swapping the frequency-encoding and phase-encoding directions (so that frequency-encoding becomes superior–inferior and phase-encoding becomes left–right) with the goal of moving chemical shift bands away from the optic nerve boundary.\n\nWhich of the following statements are true? Select all that apply.\n\nA. Swapping the frequency- and phase-encoding directions reorients the direction along which fat–water misregistration appears, because the position–frequency mapping used for reconstruction changes axis; this is advisable when critical fat–water interfaces (such as the optic nerve sheath) lie perpendicular to the original frequency-encoding axis, provided that motion along the new phase-encoding axis is minimal.\n\nB. Swapping the frequency- and phase-encoding directions reduces out-of-phase (so-called type 2) chemical shift dark rims by altering the echo time, thereby minimizing fat–water cancellation at boundaries.\n\nC. For a given field strength, the magnitude of fat–water spatial displacement in millimeters is independent of the readout bandwidth per pixel, so swapping encoding directions is equally effective regardless of receiver bandwidth.\n\nD. At higher $B_0$, the fat–water frequency separation in $\\mathrm{Hz}$ increases, so for fixed readout bandwidth per pixel the misregistration in pixels increases; consequently, swapping to move chemical shift bands away from diagnostic boundaries can be more impactful at $3\\,\\mathrm{T}$ than at $1.5\\,\\mathrm{T}$.\n\nE. Swapping the frequency- and phase-encoding directions is ill-advised when the new phase-encoding axis aligns with substantial periodic motion (for example, respiration or arterial pulsation), because this can introduce ghosting across anatomy of interest even if chemical shift bands are moved away.\n\nAnswering requires you to (i) compute the approximate misregistration in pixels and millimeters for the given parameters and (ii) justify under what conditions swapping encoding axes will help or harm diagnostic quality, without invoking any shortcut formulas not derived from the stated starting points.", "solution": "We begin from the Larmor relationship and gradient encoding basics. The Larmor frequency is $f = (\\gamma/2\\pi)\\,B$. Under a constant readout gradient $G_x$ along $x$, the local magnetic field is $B(x) = B_0 + G_x x$, so the instantaneous precession frequency varies with position as\n$$\nf(x) = \\frac{\\gamma}{2\\pi}\\big(B_0 + G_x x\\big) = f_0 + \\frac{\\gamma}{2\\pi} G_x x,\n$$\nwhere $f_0 = (\\gamma/2\\pi) B_0$ is the on-resonance frequency at $x=0$. During readout, reconstruction assumes a one-to-one mapping between frequency and position along $x$, namely that a frequency offset $\\Delta f$ corresponds to a spatial position offset $\\Delta x$ through\n$$\n\\Delta f = \\frac{\\gamma}{2\\pi} G_x\\, \\Delta x.\n$$\nChemical shift between fat and water introduces an intrinsic resonance frequency difference at the same physical location $x$:\n$$\n\\Delta f_{\\mathrm{chem}} = f_{\\mathrm{fat}} - f_{\\mathrm{water}} \\approx (3.5\\times 10^{-6}) \\times f_0.\n$$\nWhen mapping frequencies to positions using the readout gradient, a voxel containing fat is therefore misregistered relative to water by the distance $\\Delta x$ that satisfies\n$$\n\\frac{\\gamma}{2\\pi} G_x\\, \\Delta x = \\Delta f_{\\mathrm{chem}} \\quad \\Rightarrow \\quad \\Delta x = \\frac{\\Delta f_{\\mathrm{chem}}}{(\\gamma/2\\pi) G_x}.\n$$\nTo connect this with scanner bandwidth, note that the total readout bandwidth across the FOV obeys\n$$\nBW_{\\mathrm{read}} = \\left(\\frac{\\gamma}{2\\pi} G_x\\right)\\, \\mathrm{FOV}_x.\n$$\nSubstituting this into the previous expression yields\n$$\n\\Delta x = \\Delta f_{\\mathrm{chem}} \\cdot \\frac{\\mathrm{FOV}_x}{BW_{\\mathrm{read}}}.\n$$\nEquivalently, in pixels,\n$$\n\\Delta n_{\\mathrm{pix}} = \\frac{\\Delta x}{\\mathrm{FOV}_x/N_x} = \\frac{\\Delta f_{\\mathrm{chem}}}{BW_{\\mathrm{read}}/N_x} = \\frac{\\Delta f_{\\mathrm{chem}}}{BW_{\\mathrm{pix}}},\n$$\nwhere $BW_{\\mathrm{pix}} = BW_{\\mathrm{read}}/N_x$ is the bandwidth per pixel along the readout dimension.\n\nWe now compute the numerical values for the given parameters:\n- The Larmor frequency at $B_0 = 3\\,\\mathrm{T}$ is\n$$\nf_0 = \\left(\\frac{\\gamma}{2\\pi}\\right) B_0 \\approx (42.58\\times 10^{6}\\,\\mathrm{Hz/T}) \\times (3\\,\\mathrm{T}) \\approx 127.74\\times 10^{6}\\,\\mathrm{Hz}.\n$$\n- The fat–water chemical shift in $\\mathrm{Hz}$ is\n$$\n\\Delta f_{\\mathrm{chem}} \\approx (3.5\\times 10^{-6}) \\times (127.74\\times 10^{6}\\,\\mathrm{Hz}) \\approx 447.1\\,\\mathrm{Hz}.\n$$\n- The pixel bandwidth along readout is\n$$\nBW_{\\mathrm{pix}} = \\frac{BW_{\\mathrm{read}}}{N_x} = \\frac{62{,}500\\,\\mathrm{Hz}}{256} \\approx 244.14\\,\\mathrm{Hz/pixel}.\n$$\nTherefore, the misregistration in pixels is\n$$\n\\Delta n_{\\mathrm{pix}} \\approx \\frac{447.1\\,\\mathrm{Hz}}{244.14\\,\\mathrm{Hz/pixel}} \\approx 1.83\\,\\mathrm{pixels}.\n$$\n- The in-plane pixel size along the readout axis is\n$$\n\\Delta x_{\\mathrm{pix}} = \\frac{\\mathrm{FOV}_x}{N_x} = \\frac{220\\,\\mathrm{mm}}{256} \\approx 0.86\\,\\mathrm{mm/pixel}.\n$$\nThus the misregistration in millimeters is\n$$\n\\Delta x \\approx (1.83)\\times (0.86\\,\\mathrm{mm}) \\approx 1.57\\,\\mathrm{mm}.\n$$\nThis magnitude is clinically relevant at small structures such as the optic nerve (typical diameter on the order of a few millimeters), because a dark or bright band displaced by approximately $1.5\\,\\mathrm{mm}$ can encroach upon critical boundaries and mimic or obscure pathology.\n\nSwapping the frequency- and phase-encoding axes does not change $\\Delta f_{\\mathrm{chem}}$, $BW_{\\mathrm{pix}}$, or $|\\Delta x|$, but it changes the direction along which the frequency-to-position mapping is performed. Consequently, the fat–water misregistration (type 1 chemical shift artifact) will appear along the new frequency-encoding axis, effectively reorienting the bright/dark band relative to anatomy. This can move the artifact away from a critical boundary if the boundary’s orientation is unfavorable in the original configuration. However, the trade-off is that the new phase-encoding axis becomes more susceptible to motion-induced phase errors and associated ghosting; thus the swap is advisable only when motion along the new phase direction is limited or controllable.\n\nWe now analyze each option:\n\nA. This statement asserts that swapping reorients the direction of misregistration and is advisable when important fat–water interfaces are compromised in the original setup, assuming minimal motion along the new phase-encoding axis. From the derivation, the artifact direction is set by the frequency-encoding axis because the frequency–position mapping occurs there. Swapping axes therefore moves the artifact to the new readout direction. This can indeed move chemical shift bands away from a boundary such as the optic nerve sheath if the original readout direction caused the band to overlap that boundary. The proviso about motion along the new phase direction is appropriate, as phase-encoding is motion-sensitive. Verdict — Correct.\n\nB. This claims that swapping reduces out-of-phase (type 2) chemical shift by altering the echo time. Swapping encoding axes does not, by itself, change the echo time $TE$; type 2 chemical shift (fat–water cancellation) depends on the relative phase at $TE$, which is set by timing and field strength, not by which axis is designated readout or phase-encode. Therefore, swapping does not reduce type 2 artifacts unless $TE$ is also changed. Verdict — Incorrect.\n\nC. This claims independence of the displacement magnitude from readout bandwidth per pixel. From the derivation, $\\Delta n_{\\mathrm{pix}} = \\Delta f_{\\mathrm{chem}} / BW_{\\mathrm{pix}}$ and $\\Delta x = \\Delta f_{\\mathrm{chem}} \\cdot \\mathrm{FOV}_x / BW_{\\mathrm{read}}$, so increasing bandwidth per pixel decreases the displacement; it is not independent. Verdict — Incorrect.\n\nD. This connects field strength to increased frequency separation and hence increased pixel shift for fixed bandwidth per pixel. Since $\\Delta f_{\\mathrm{chem}} \\propto f_0 \\propto B_0$, doubling $B_0$ doubles $\\Delta f_{\\mathrm{chem}}$. For fixed $BW_{\\mathrm{pix}}$, $\\Delta n_{\\mathrm{pix}}$ increases proportionally. Thus the impact of swapping (to redirect the artifact away from boundaries) can be greater at $3\\,\\mathrm{T}$ than at $1.5\\,\\mathrm{T}$. Verdict — Correct.\n\nE. This cautions against swapping when the new phase-encoding axis aligns with substantial periodic motion because of ghosting. Phase-encoding is sensitive to motion-induced phase inconsistencies across repetitions, which produce ghosts along the phase-encode axis. Aligning that axis with respiration or pulsation commonly worsens ghosting. Therefore, even if chemical shift bands are moved, overall diagnostic quality may degrade. Verdict — Correct.\n\nTherefore, the correct options are A, D, and E.", "answer": "$$\\boxed{ADE}$$", "id": "4867546"}, {"introduction": "Modern fast imaging techniques like Echo Planar Imaging (EPI) rely on sophisticated and rapid readout strategies, often involving alternating gradient polarities to traverse k-space quickly. This speed comes at a cost, introducing unique challenges like Nyquist ghosting artifacts that arise from minute timing and system imperfections between successive echoes. This advanced practice [@problem_id:4886589] delves into the elegant data-driven methods used for ghost correction, showing how a low-order polynomial model derived from a reference scan can be used to restore the fidelity of the final image.", "problem": "A single-shot Echo Planar Imaging (EPI) sequence acquires one image by traversing the frequency-encoding (readout) direction with alternating gradient polarities. Consider the reference scan used for Nyquist ghost correction: the sequence is run without phase encoding, and the complex data are recorded for odd and even readout lines separately. Let the readout gradient be approximately constant in magnitude during each line so that the frequency-encoding wavevector satisfies the standard k-space relation $k_{x}(t) = \\frac{\\gamma}{2\\pi} \\int_{0}^{t} G_{x}(\\tau)\\, d\\tau$, where $\\gamma$ is the gyromagnetic ratio and $G_{x}(t)$ is the readout gradient. The measured signal at time $t$ can be modeled by the Fourier integral $s(t) = \\int \\rho(x)\\, \\exp\\!\\left(-\\mathrm{i}\\, 2\\pi\\, k_{x}(t)\\, x + \\mathrm{i}\\, \\phi_{0}(x)\\right) dx$, where $\\rho(x)$ is the spin density and $\\phi_{0}(x)$ is a spatially varying background phase arising from static magnetic field inhomogeneity.\n\nIn practice, a small relative timing offset $\\Delta t$ between the readout and the gradient switching, along with smoothly varying off-resonance, produces a phase mismatch between odd and even lines that is a smooth function of the frequency-encoding coordinate. For small $\\Delta t$ and slowly varying $\\phi_{0}(x)$, this odd–even phase difference can be well-approximated over the sampled readout by a low-order polynomial in the (normalized) frequency-encoding coordinate $k$, i.e., $\\Delta \\phi(k) \\approx c_{0} + c_{1}\\, k + c_{2}\\, k^{2}$, where $\\Delta \\phi(k)$ is the unwrapped phase of the odd-minus-even reference data at coordinate $k$.\n\nYou are given the unwrapped odd–even phase differences, measured in the reference scan at five uniformly spaced normalized coordinates $k \\in \\{-2, -1, 0, 1, 2\\}$:\n- For $k = -2$, $\\Delta \\phi = 0.03$ radians.\n- For $k = -1$, $\\Delta \\phi = 0.03$ radians.\n- For $k = 0$, $\\Delta \\phi = 0.05$ radians.\n- For $k = 1$, $\\Delta \\phi = 0.09$ radians.\n- For $k = 2$, $\\Delta \\phi = 0.15$ radians.\n\nStarting from the signal formation relation and the k-space definition above, explain why a low-order polynomial model for $\\Delta \\phi(k)$ is justified in this context. Then, using a linear least-squares fit to the model $\\Delta \\phi(k) = c_{0} + c_{1}\\, k + c_{2}\\, k^{2}$, compute the coefficient vector $\\begin{pmatrix} c_{0} & c_{1} & c_{2} \\end{pmatrix}$. Express your final numerical values in radians and round your results to four significant figures. The final answer must be the ordered row vector of the three coefficients.", "solution": "This problem requires us to first provide a physical justification for modeling the phase difference between odd and even echoes in Echo Planar Imaging (EPI) with a low-order polynomial. Second, we must perform a linear least-squares fit to the given data to find the coefficients of this polynomial model.\n\n#### Justification of the Polynomial Phase Model\n\nThe phase difference, $\\Delta\\phi(k)$, between data acquired during odd (e.g., positive gradient) and even (e.g., negative gradient) readouts in EPI is the source of the N/2 or \"Nyquist\" ghost artifact. This phase difference is typically a smooth function of the k-space coordinate, $k$, and can therefore be well-approximated by a low-order Taylor series, i.e., a polynomial. The coefficients of this polynomial correspond to specific physical effects:\n\n1.  **Constant Term ($c_0$):** A constant phase error across all of k-space can arise from several sources. These include differences in the group delay of analog filters in the receiver chain for positive versus negative frequencies, a mean off-resonance frequency across the object combined with a slight timing mismatch of the echo centers, or any constant phase offset introduced by the receiver electronics.\n\n2.  **Linear Term ($c_1 k$):** A phase error that is linear in $k$ is predominantly caused by a small, constant time shift, $\\Delta t$, between the odd and even echo acquisitions. According to the Fourier shift theorem, a time shift in the time domain corresponds to a linear phase ramp in the frequency (or k-space) domain. If the data acquisition for even echoes is systematically delayed by $\\Delta t$ relative to the odd echoes, this introduces a phase term proportional to $k \\cdot \\Delta t$.\n\n3.  **Quadratic Term ($c_2 k^2$):** Higher-order phase errors arise from more complex, non-linear effects. A primary cause is eddy currents, which are induced by the rapid switching of the strong EPI gradients. These eddy currents create transient, unwanted magnetic fields that distort the ideal trapezoidal gradient waveforms. This distortion is often time-dependent and can vary between positive and negative gradient lobes, leading to a non-linear, k-dependent phase error. Spatially-varying magnetic field inhomogeneity ($\\Delta B_0(x)$) also contributes to these higher-order phase terms. The quadratic term is the simplest and often most significant correction for these non-linearities.\n\nTherefore, modeling the phase error as $\\Delta \\phi(k) \\approx c_{0} + c_{1}\\, k + c_{2}\\, k^{2}$ provides a robust phenomenological model that captures the dominant physical sources of EPI ghosting.\n\n#### Computation of Coefficients\n\nWe are tasked with finding the coefficients $(c_0, c_1, c_2)$ that best fit the given data points using the model $\\Delta\\phi(k) = c_0 + c_1 k + c_2 k^2$. This is a linear least-squares problem. We set up the system of equations in matrix form, $A\\mathbf{c} = \\mathbf{b}$, where $\\mathbf{c} = \\begin{pmatrix} c_0 & c_1 & c_2 \\end{pmatrix}^T$.\n\nThe data points are $(k, \\Delta\\phi)$: $(-2, 0.03)$, $(-1, 0.03)$, $(0, 0.05)$, $(1, 0.09)$, and $(2, 0.15)$.\n\nThe design matrix $A$ and the observation vector $\\mathbf{b}$ are:\n$$\nA = \\begin{pmatrix}\n1 & k_1 & k_1^2 \\\\\n1 & k_2 & k_2^2 \\\\\n\\vdots & \\vdots & \\vdots \\\\\n1 & k_5 & k_5^2\n\\end{pmatrix} = \\begin{pmatrix}\n1 & -2 & 4 \\\\\n1 & -1 & 1 \\\\\n1 & 0 & 0 \\\\\n1 & 1 & 1 \\\\\n1 & 2 & 4\n\\end{pmatrix}, \\quad \\mathbf{b} = \\begin{pmatrix}\n0.03 \\\\ 0.03 \\\\ 0.05 \\\\ 0.09 \\\\ 0.15\n\\end{pmatrix}\n$$\nThe least-squares solution for the coefficient vector $\\mathbf{c}$ is given by the normal equations, $\\mathbf{c} = (A^T A)^{-1} A^T \\mathbf{b}$.\n\nFirst, we compute $A^T A$:\n$$\nA^T A = \\begin{pmatrix}\n1 & 1 & 1 & 1 & 1 \\\\\n-2 & -1 & 0 & 1 & 2 \\\\\n4 & 1 & 0 & 1 & 4\n\\end{pmatrix}\n\\begin{pmatrix}\n1 & -2 & 4 \\\\\n1 & -1 & 1 \\\\\n1 & 0 & 0 \\\\\n1 & 1 & 1 \\\\\n1 & 2 & 4\n\\end{pmatrix} = \\begin{pmatrix}\n5 & 0 & 10 \\\\\n0 & 10 & 0 \\\\\n10 & 0 & 34\n\\end{pmatrix}\n$$\nNext, we compute $A^T \\mathbf{b}$:\n$$\nA^T \\mathbf{b} = \\begin{pmatrix}\n1 & 1 & 1 & 1 & 1 \\\\\n-2 & -1 & 0 & 1 & 2 \\\\\n4 & 1 & 0 & 1 & 4\n\\end{pmatrix}\n\\begin{pmatrix}\n0.03 \\\\ 0.03 \\\\ 0.05 \\\\ 0.09 \\\\ 0.15\n\\end{pmatrix} = \\begin{pmatrix}\n0.35 \\\\ 0.30 \\\\ 0.84\n\\end{pmatrix}\n$$\nNow, we find the inverse of $A^T A$. The determinant is $\\det(A^T A) = 5(10 \\cdot 34 - 0) - 10(0 - 10 \\cdot 10) = 1700 - 1000 = 700$.\n$$\n(A^T A)^{-1} = \\frac{1}{700}\n\\begin{pmatrix}\n340 & 0 & -100 \\\\\n0 & 70 & 0 \\\\\n-100 & 0 & 50\n\\end{pmatrix}\n$$\nFinally, we solve for $\\mathbf{c}$:\n$$\n\\mathbf{c} = \\begin{pmatrix} c_0 \\\\ c_1 \\\\ c_2 \\end{pmatrix} = (A^T A)^{-1} (A^T \\mathbf{b}) = \\frac{1}{700}\n\\begin{pmatrix}\n340 & 0 & -100 \\\\\n0 & 70 & 0 \\\\\n-100 & 0 & 50\n\\end{pmatrix}\n\\begin{pmatrix}\n0.35 \\\\ 0.30 \\\\ 0.84\n\\end{pmatrix}\n$$\nCalculating each coefficient:\n$$\nc_0 = \\frac{1}{700} (340 \\times 0.35 - 100 \\times 0.84) = \\frac{1}{700} (119 - 84) = \\frac{35}{700} = 0.05\n$$\n$$\nc_1 = \\frac{1}{700} (70 \\times 0.30) = \\frac{21}{700} = 0.03\n$$\n$$\nc_2 = \\frac{1}{700} (-100 \\times 0.35 + 50 \\times 0.84) = \\frac{1}{700} (-35 + 42) = \\frac{7}{700} = 0.01\n$$\nRounding to four significant figures, the coefficients are $c_0 = 0.05000$, $c_1 = 0.03000$, and $c_2 = 0.01000$. The resulting coefficient vector is $\\begin{pmatrix} 0.05000 & 0.03000 & 0.01000 \\end{pmatrix}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.05000 & 0.03000 & 0.01000\n\\end{pmatrix}\n}\n$$", "id": "4886589"}]}