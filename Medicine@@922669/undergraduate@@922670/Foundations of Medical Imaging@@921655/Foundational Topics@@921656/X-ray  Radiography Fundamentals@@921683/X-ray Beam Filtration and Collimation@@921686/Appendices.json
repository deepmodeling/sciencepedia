{"hands_on_practices": [{"introduction": "Before an X-ray beam even reaches the patient, it is hardened by passing through the tube's own components, a process known as inherent filtration. To standardize system performance and ensure safety, it's crucial to quantify this effect using a common metric. This practice problem guides you through calculating the *aluminum equivalence* of a multi-component filter, a foundational skill based on the exponential attenuation law that is essential for physicists and engineers. [@problem_id:4942161]", "problem": "An X-ray tube used for general radiography at a reference kilovoltage peak (kVp) of $70~\\text{kVp}$ produces a beam that, along its exit path, traverses three inherent filtration components: a borosilicate glass envelope of thickness $0.20~\\text{mm}$, a mineral oil layer of thickness $4.0~\\text{mm}$, and a beryllium exit window of thickness $0.80~\\text{mm}$. Assume narrow-beam conditions (negligible scatter) and that the transmitted air kerma is proportional to the transmitted energy fluence. At this operating condition, approximate the polyenergetic spectrum by an effective monoenergetic beam and use the exponential attenuation law. The mass attenuation coefficients $\\mu/\\rho$ at the effective energy are provided as follows: for aluminum, $(\\mu/\\rho)_{\\text{Al}} = 0.215~\\text{cm}^{2}\\,\\text{g}^{-1}$; for beryllium, $(\\mu/\\rho)_{\\text{Be}} = 0.137~\\text{cm}^{2}\\,\\text{g}^{-1}$; for mineral oil, $(\\mu/\\rho)_{\\text{oil}} = 0.25~\\text{cm}^{2}\\,\\text{g}^{-1}$; and for borosilicate glass, $(\\mu/\\rho)_{\\text{glass}} = 0.24~\\text{cm}^{2}\\,\\text{g}^{-1}$. The material densities are: aluminum $\\rho_{\\text{Al}} = 2.70~\\text{g}\\,\\text{cm}^{-3}$, beryllium $\\rho_{\\text{Be}} = 1.85~\\text{g}\\,\\text{cm}^{-3}$, mineral oil $\\rho_{\\text{oil}} = 0.86~\\text{g}\\,\\text{cm}^{-3}$, and borosilicate glass $\\rho_{\\text{glass}} = 2.23~\\text{g}\\,\\text{cm}^{-3}$.\n\nUsing these data and starting from first principles, determine the equivalent aluminum thickness $t_{\\text{eq,Al}}$ that would yield the same transmitted air kerma as the combined filtration of the three components. Express your final answer in $\\text{mm}$ of aluminum (mm Al) and round to three significant figures.", "solution": "The problem is valid. It is scientifically grounded in the principles of radiation physics, specifically the exponential attenuation law. It is well-posed, objective, and contains all necessary information to derive a unique solution.\n\nThe fundamental principle governing the transmission of a monoenergetic X-ray beam through a material is the exponential attenuation law. Under the specified narrow-beam conditions and the approximation of the polyenergetic spectrum as an effective monoenergetic beam, the transmitted air kerma, $K$, is related to the incident air kerma, $K_0$, by:\n$$K = K_0 \\exp(-\\mu t)$$\nwhere $\\mu$ is the linear attenuation coefficient of the material and $t$ is its thickness. The problem states that the transmitted air kerma is proportional to the transmitted energy fluence, which validates the use of this relationship for kerma.\n\nThe linear attenuation coefficient, $\\mu$, is the product of the mass attenuation coefficient, $\\frac{\\mu}{\\rho}$, and the material's density, $\\rho$:\n$$\\mu = \\left(\\frac{\\mu}{\\rho}\\right) \\rho$$\n\nWhen an X-ray beam passes through a series of $N$ different materials, the total attenuation is the product of the attenuation factors for each layer. The transmitted kerma $K_{\\text{trans}}$ is given by:\n$$K_{\\text{trans}} = K_0 \\left( \\exp(-\\mu_1 t_1) \\right) \\left( \\exp(-\\mu_2 t_2) \\right) \\dots \\left( \\exp(-\\mu_N t_N) \\right) = K_0 \\exp\\left(-\\sum_{i=1}^{N} \\mu_i t_i\\right)$$\n\nIn this problem, the beam traverses three inherent filtration components: beryllium (Be), mineral oil (oil), and borosilicate glass (glass). The transmitted kerma is therefore:\n$$K_{\\text{trans}} = K_0 \\exp\\left(-(\\mu_{\\text{Be}} t_{\\text{Be}} + \\mu_{\\text{oil}} t_{\\text{oil}} + \\mu_{\\text{glass}} t_{\\text{glass}})\\right)$$\nWe are asked to find the equivalent thickness of aluminum, $t_{\\text{eq,Al}}$, that produces the same attenuation. For this equivalent filter, the transmitted kerma would be:\n$$K_{\\text{trans}} = K_0 \\exp\\left(-\\mu_{\\text{Al}} t_{\\text{eq,Al}}\\right)$$\nFor the attenuation to be equivalent, the exponents in the two expressions must be equal:\n$$\\mu_{\\text{Al}} t_{\\text{eq,Al}} = \\mu_{\\text{Be}} t_{\\text{Be}} + \\mu_{\\text{oil}} t_{\\text{oil}} + \\mu_{\\text{glass}} t_{\\text{glass}}$$\nSubstituting the expression $\\mu = (\\mu/\\rho)\\rho$ for each material, we get:\n$$\\left(\\frac{\\mu}{\\rho}\\right)_{\\text{Al}} \\rho_{\\text{Al}} t_{\\text{eq,Al}} = \\left(\\frac{\\mu}{\\rho}\\right)_{\\text{Be}} \\rho_{\\text{Be}} t_{\\text{Be}} + \\left(\\frac{\\mu}{\\rho}\\right)_{\\text{oil}} \\rho_{\\text{oil}} t_{\\text{oil}} + \\left(\\frac{\\mu}{\\rho}\\right)_{\\text{glass}} \\rho_{\\text{glass}} t_{\\text{glass}}$$\nWe can now solve for the equivalent aluminum thickness, $t_{\\text{eq,Al}}$:\n$$t_{\\text{eq,Al}} = \\frac{\\left(\\frac{\\mu}{\\rho}\\right)_{\\text{Be}} \\rho_{\\text{Be}} t_{\\text{Be}} + \\left(\\frac{\\mu}{\\rho}\\right)_{\\text{oil}} \\rho_{\\text{oil}} t_{\\text{oil}} + \\left(\\frac{\\mu}{\\rho}\\right)_{\\text{glass}} \\rho_{\\text{glass}} t_{\\text{glass}}}{\\left(\\frac{\\mu}{\\rho}\\right)_{\\text{Al}} \\rho_{\\text{Al}}}$$\nThe given values are:\n- $t_{\\text{Be}} = 0.80~\\text{mm}$\n- $t_{\\text{oil}} = 4.0~\\text{mm}$\n- $t_{\\text{glass}} = 0.20~\\text{mm}$\n- $(\\mu/\\rho)_{\\text{Be}} = 0.137~\\text{cm}^{2}\\,\\text{g}^{-1}$ and $\\rho_{\\text{Be}} = 1.85~\\text{g}\\,\\text{cm}^{-3}$\n- $(\\mu/\\rho)_{\\text{oil}} = 0.25~\\text{cm}^{2}\\,\\text{g}^{-1}$ and $\\rho_{\\text{oil}} = 0.86~\\text{g}\\,\\text{cm}^{-3}$\n- $(\\mu/\\rho)_{\\text{glass}} = 0.24~\\text{cm}^{2}\\,\\text{g}^{-1}$ and $\\rho_{\\text{glass}} = 2.23~\\text{g}\\,\\text{cm}^{-3}$\n- $(\\mu/\\rho)_{\\text{Al}} = 0.215~\\text{cm}^{2}\\,\\text{g}^{-1}$ and $\\rho_{\\text{Al}} = 2.70~\\text{g}\\,\\text{cm}^{-3}$\n\nFor dimensional consistency, all thickness values must be converted to centimeters ($1~\\text{mm} = 0.1~\\text{cm}$):\n- $t_{\\text{Be}} = 0.080~\\text{cm}$\n- $t_{\\text{oil}} = 0.40~\\text{cm}$\n- $t_{\\text{glass}} = 0.020~\\text{cm}$\n\nNow, we calculate the linear attenuation coefficient $\\mu_i$ for each material:\n- $\\mu_{\\text{Be}} = (0.137~\\text{cm}^{2}\\,\\text{g}^{-1}) \\times (1.85~\\text{g}\\,\\text{cm}^{-3}) = 0.25345~\\text{cm}^{-1}$\n- $\\mu_{\\text{oil}} = (0.25~\\text{cm}^{2}\\,\\text{g}^{-1}) \\times (0.86~\\text{g}\\,\\text{cm}^{-3}) = 0.215~\\text{cm}^{-1}$\n- $\\mu_{\\text{glass}} = (0.24~\\text{cm}^{2}\\,\\text{g}^{-1}) \\times (2.23~\\text{g}\\,\\text{cm}^{-3}) = 0.5352~\\text{cm}^{-1}$\n- $\\mu_{\\text{Al}} = (0.215~\\text{cm}^{2}\\,\\text{g}^{-1}) \\times (2.70~\\text{g}\\,\\text{cm}^{-3}) = 0.5805~\\text{cm}^{-1}$\n\nNext, we calculate the terms in the numerator of the expression for $t_{\\text{eq,Al}}$:\n- Beryllium term: $\\mu_{\\text{Be}} t_{\\text{Be}} = (0.25345~\\text{cm}^{-1}) \\times (0.080~\\text{cm}) = 0.020276$\n- Oil term: $\\mu_{\\text{oil}} t_{\\text{oil}} = (0.215~\\text{cm}^{-1}) \\times (0.40~\\text{cm}) = 0.086$\n- Glass term: $\\mu_{\\text{glass}} t_{\\text{glass}} = (0.5352~\\text{cm}^{-1}) \\times (0.020~\\text{cm}) = 0.010704$\n\nThe sum of these terms (the total exponent for the composite filter) is:\n$$\\sum \\mu_i t_i = 0.020276 + 0.086 + 0.010704 = 0.11698$$\nNow we can compute $t_{\\text{eq,Al}}$:\n$$t_{\\text{eq,Al}} = \\frac{\\sum \\mu_i t_i}{\\mu_{\\text{Al}}} = \\frac{0.11698}{0.5805~\\text{cm}^{-1}} \\approx 0.201516~\\text{cm}$$\nThe problem requires the answer to be in millimeters (mm) and rounded to three significant figures.\n$$t_{\\text{eq,Al}} \\approx 0.201516~\\text{cm} \\times \\frac{10~\\text{mm}}{1~\\text{cm}} \\approx 2.01516~\\text{mm}$$\nRounding to three significant figures gives $2.02~\\text{mm}$.", "answer": "$$\\boxed{2.02}$$", "id": "4942161"}, {"introduction": "Filtration and collimation choices are not made in isolation; they have cascading effects throughout the imaging chain. Reducing filtration increases beam intensity, and expanding collimation increases scatter, both of which can push a detector into its nonlinear, saturated range. This exercise demonstrates the delicate balance required when adjusting technique factors, challenging you to predict detector saturation by combining models for attenuation, scatter, and tube output to reinforce the interconnected nature of the imaging system. [@problem_id:4942160]", "problem": "A flat-panel X-ray detector used for general radiography exhibits linear response up to a detector entrance air kerma threshold $K_{\\mathrm{sat}} = 0.75 \\,\\mathrm{mGy}$, beyond which its signal becomes nonlinear due to saturation. An examination is performed at tube potential $100 \\,\\mathrm{kVp}$ with a $15 \\,\\mathrm{cm}$ water-equivalent slab phantom at a source-to-detector distance $100 \\,\\mathrm{cm}$. For a square collimated field of side length $20 \\,\\mathrm{cm}$ and added aluminum filtration thickness $t_{\\mathrm{ref}} = 3.0 \\,\\mathrm{mm}$ (beyond inherent filtration), the calibrated primary detector entrance air kerma per milliampere-second is $Y_{\\mathrm{ref}} = 0.050 \\,\\mathrm{mGy/mAs}$. When filtration is reduced to $t_{\\mathrm{new}} = 1.0 \\,\\mathrm{mm}$ aluminum, the spectrum hardening is neglected and the added aluminum transmission may be approximated by a single effective linear attenuation coefficient $\\mu_{\\mathrm{eff}} = 0.18 \\,\\mathrm{mm}^{-1}$ at the effective energy of the beam. Under the reduced filtration, the operator also opens collimation to a $35 \\,\\mathrm{cm} \\times 35 \\,\\mathrm{cm}$ field, for which the scatter-to-primary ratio (SPR) at the detector is $s_{f} = 0.25$; assume the SPR under the $20 \\,\\mathrm{cm} \\times 20 \\,\\mathrm{cm}$ field was lower and is already accounted for in the calibration of $Y_{\\mathrm{ref}}$ as a primary quantity.\n\nThe operator selects a tube current $I = 800 \\,\\mathrm{mA}$ and exposure time $t_{\\mathrm{exp}} = 25 \\,\\mathrm{ms}$, with tube potential and geometry unchanged. Using physically grounded relationships for exponential attenuation in the added filter and linear scaling of primary kerma with the milliampere-second product, along with the definition that total detector kerma is the sum of primary and scatter components and may be modeled as $K_{\\mathrm{det}} = K_{\\mathrm{primary}} (1 + s_{f})$, determine whether the detector would saturate under these new settings and compute the minimum exposure time at $800 \\,\\mathrm{mA}$ that keeps $K_{\\mathrm{det}}$ at or below $K_{\\mathrm{sat}}$ for the reduced filtration and expanded collimation. Round your answer to four significant figures and express it in milliseconds.", "solution": "The problem will be validated and, if valid, solved by applying fundamental principles of X-ray physics, including exponential attenuation, the relationship between tube output and exposure settings, and the contribution of scatter to the total signal at the detector.\n\nFirst, the problem statement is validated.\n\n**Step 1: Extract Givens**\n- Detector saturation threshold: $K_{\\mathrm{sat}} = 0.75 \\,\\mathrm{mGy}$\n- Tube potential: $100 \\,\\mathrm{kVp}$\n- Phantom: $15 \\,\\mathrm{cm}$ water-equivalent slab\n- Source-to-detector distance: $100 \\,\\mathrm{cm}$\n- Reference added Al filtration: $t_{\\mathrm{ref}} = 3.0 \\,\\mathrm{mm}$\n- Reference collimated field: $20 \\,\\mathrm{cm} \\times 20 \\,\\mathrm{cm}$\n- Reference primary detector entrance air kerma per mAs: $Y_{\\mathrm{ref}} = 0.050 \\,\\mathrm{mGy/mAs}$\n- New added Al filtration: $t_{\\mathrm{new}} = 1.0 \\,\\mathrm{mm}$\n- Effective linear attenuation coefficient of Al: $\\mu_{\\mathrm{eff}} = 0.18 \\,\\mathrm{mm}^{-1}$\n- New collimated field: $35 \\,\\mathrm{cm} \\times 35 \\,\\mathrm{cm}$\n- Scatter-to-primary ratio for new field: $s_{f} = 0.25$\n- Proposed tube current: $I = 800 \\,\\mathrm{mA}$\n- Proposed exposure time: $t_{\\mathrm{exp}} = 25 \\,\\mathrm{ms}$\n- Model for total detector kerma: $K_{\\mathrm{det}} = K_{\\mathrm{primary}} (1 + s_{f})$\n- Assumption: Neglect spectrum hardening.\n- Assumption: $Y_{\\mathrm{ref}}$ is a primary kerma value, with scatter from the reference field already excluded.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is assessed against the validation criteria.\n- **Scientifically Grounded**: The problem is well-grounded in the principles of diagnostic medical physics. It uses standard models for X-ray attenuation (Beer-Lambert law), linear dependence of kerma on milliampere-seconds (mAs), and the additive nature of primary and scattered radiation. The numerical values for tube potential, filtration, kerma rates, attenuation coefficient, and detector saturation are physically realistic for general radiography.\n- **Well-Posed**: The problem is well-posed. It provides sufficient information to calculate the detector kerma under new conditions and to determine the exposure time limit. The question about \"minimum exposure time\" is slightly ambiguous but has a standard interpretation in physics as finding the maximum permissible value that satisfies the boundary condition.\n- **Objective**: The problem is stated using precise, objective language and quantitative data.\n\nThe problem does not violate any of the invalidity criteria. It is scientifically sound, formalizable, complete, and poses a solvable question based on established physical models.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n**Solution Derivation**\n\nThe solution proceeds in two parts. First, we determine if the detector saturates under the proposed settings. Second, we calculate the maximum exposure time that avoids saturation.\n\nThe milliampere-second product ($mAs$) for the proposed exposure is the product of the tube current $I$ and the exposure time $t_{\\mathrm{exp}}$.\n$$mAs_{\\mathrm{new}} = I \\cdot t_{\\mathrm{exp}} = (800 \\,\\mathrm{mA}) \\cdot (25 \\,\\mathrm{ms}) = (800 \\,\\mathrm{mA}) \\cdot (0.025 \\,\\mathrm{s}) = 20 \\,\\mathrm{mAs}$$\n\nNext, we must determine the primary kerma yield for the new filtration thickness, $t_{\\mathrm{new}} = 1.0 \\,\\mathrm{mm}$. The reference yield, $Y_{\\mathrm{ref}} = 0.050 \\,\\mathrm{mGy/mAs}$, corresponds to a reference filtration thickness of $t_{\\mathrm{ref}} = 3.0 \\,\\mathrm{mm}$. We can model the effect of the added filter using the exponential attenuation law. Let $Y_0$ be the primary kerma yield before the added aluminum filter. Then, the reference and new primary yields, $Y_{\\mathrm{ref}}$ and $Y_{\\mathrm{new, primary}}$, are given by:\n$$Y_{\\mathrm{ref}} = Y_0 \\exp(-\\mu_{\\mathrm{eff}} t_{\\mathrm{ref}})$$\n$$Y_{\\mathrm{new, primary}} = Y_0 \\exp(-\\mu_{\\mathrm{eff}} t_{\\mathrm{new}})$$\nThe ratio of the new primary yield to the reference yield is:\n$$\\frac{Y_{\\mathrm{new, primary}}}{Y_{\\mathrm{ref}}} = \\frac{Y_0 \\exp(-\\mu_{\\mathrm{eff}} t_{\\mathrm{new}})}{Y_0 \\exp(-\\mu_{\\mathrm{eff}} t_{\\mathrm{ref}})} = \\exp(-\\mu_{\\mathrm{eff}} (t_{\\mathrm{new}} - t_{\\mathrm{ref}}))$$\nTherefore, the new primary kerma yield is:\n$$Y_{\\mathrm{new, primary}} = Y_{\\mathrm{ref}} \\exp(-\\mu_{\\mathrm{eff}} (t_{\\mathrm{new}} - t_{\\mathrm{ref}}))$$\nSubstituting the given values:\n$$Y_{\\mathrm{new, primary}} = (0.050 \\,\\mathrm{mGy/mAs}) \\cdot \\exp(-0.18 \\,\\mathrm{mm}^{-1} \\cdot (1.0 \\,\\mathrm{mm} - 3.0 \\,\\mathrm{mm}))$$\n$$Y_{\\mathrm{new, primary}} = (0.050 \\,\\mathrm{mGy/mAs}) \\cdot \\exp(-0.18 \\cdot (-2.0)) = (0.050 \\,\\mathrm{mGy/mAs}) \\cdot \\exp(0.36)$$\n\nNow, we can calculate the primary kerma, $K_{\\mathrm{primary}}$, for the proposed exposure:\n$$K_{\\mathrm{primary}} = Y_{\\mathrm{new, primary}} \\cdot mAs_{\\mathrm{new}} = (0.050 \\cdot \\exp(0.36) \\,\\mathrm{mGy/mAs}) \\cdot (20 \\,\\mathrm{mAs})$$\n$$K_{\\mathrm{primary}} = 1.0 \\cdot \\exp(0.36) \\,\\mathrm{mGy}$$\n\nThe total detector kerma, $K_{\\mathrm{det}}$, is the sum of the primary and scatter components, modeled as $K_{\\mathrm{det}} = K_{\\mathrm{primary}} (1 + s_{f})$, where $s_{f} = 0.25$ is the scatter-to-primary ratio for the new, larger field size.\n$$K_{\\mathrm{det}} = K_{\\mathrm{primary}} (1 + 0.25) = 1.25 \\cdot K_{\\mathrm{primary}}$$\n$$K_{\\mathrm{det}} = 1.25 \\cdot (1.0 \\cdot \\exp(0.36) \\,\\mathrm{mGy}) = 1.25 \\cdot \\exp(0.36) \\,\\mathrm{mGy}$$\nNumerically, this is $K_{\\mathrm{det}} \\approx 1.25 \\cdot 1.433329 = 1.79166 \\,\\mathrm{mGy}$.\nWe compare this to the saturation threshold, $K_{\\mathrm{sat}} = 0.75 \\,\\mathrm{mGy}$. Since $1.79166 \\,\\mathrm{mGy} > 0.75 \\,\\mathrm{mGy}$, the detector will indeed saturate under the proposed conditions.\n\nThe second part of the problem asks for the exposure time that keeps the detector kerma at or below saturation. While the wording \"minimum exposure time\" is ambiguous, the standard physical interpretation is to find the maximum allowable exposure time, $t_{\\mathrm{max}}$, for which the kerma equals the saturation threshold. Any time shorter than this will also result in a kerma below the threshold. We set $K_{\\mathrm{det}} = K_{\\mathrm{sat}}$:\n$$K_{\\mathrm{sat}} = K_{\\mathrm{primary}} (1 + s_{f})$$\nLet the required mAs product be $mAs_{\\mathrm{max}} = I \\cdot t_{\\mathrm{max}}$.\n$$K_{\\mathrm{sat}} = (Y_{\\mathrm{new, primary}} \\cdot mAs_{\\mathrm{max}}) (1 + s_{f}) = (Y_{\\mathrm{new, primary}} \\cdot I \\cdot t_{\\mathrm{max}}) (1 + s_{f})$$\nWe solve for $t_{\\mathrm{max}}$:\n$$t_{\\mathrm{max}} = \\frac{K_{\\mathrm{sat}}}{Y_{\\mathrm{new, primary}} \\cdot I \\cdot (1 + s_{f})}$$\nSubstituting the expression for $Y_{\\mathrm{new, primary}}$:\n$$t_{\\mathrm{max}} = \\frac{K_{\\mathrm{sat}}}{Y_{\\mathrm{ref}} \\exp(-\\mu_{\\mathrm{eff}} (t_{\\mathrm{new}} - t_{\\mathrm{ref}})) \\cdot I \\cdot (1 + s_{f})}$$\nNow, we insert the numerical values. The result for $t_{\\mathrm{max}}$ will be in seconds, as the units are $(\\mathrm{mGy}) / [(\\mathrm{mGy}/\\mathrm{mAs}) \\cdot (\\mathrm{mA}) \\cdot (\\mathrm{unitless})] = (\\mathrm{mGy}) / [(\\mathrm{mGy}/(\\mathrm{mA}\\cdot\\mathrm{s})) \\cdot (\\mathrm{mA})] = \\mathrm{s}$.\n$$t_{\\mathrm{max}} = \\frac{0.75}{0.050 \\cdot \\exp(0.36) \\cdot 800 \\cdot (1 + 0.25)}$$\n$$t_{\\mathrm{max}} = \\frac{0.75}{0.050 \\cdot \\exp(0.36) \\cdot 800 \\cdot 1.25} = \\frac{0.75}{0.050 \\cdot \\exp(0.36) \\cdot 1000}$$\n$$t_{\\mathrm{max}} = \\frac{0.75}{50 \\cdot \\exp(0.36)} = \\frac{0.015}{\\exp(0.36)} \\,\\mathrm{s}$$\n$$t_{\\mathrm{max}} \\approx 0.0104651 \\,\\mathrm{s}$$\nThe problem requires the answer in milliseconds, rounded to four significant figures.\n$$t_{\\mathrm{max}} \\approx 10.4651 \\,\\mathrm{ms}$$\nRounding to four significant figures gives $10.47 \\,\\mathrm{ms}$.", "answer": "$$\\boxed{10.47}$$", "id": "4942160"}, {"introduction": "The primary role of collimation is to restrict the X-ray beam to the anatomical region of interest, which is critical for reducing patient dose and minimizing image-degrading scatter. Modern imaging systems must perform this task automatically and reliably, even when faced with patient motion. This computational problem puts you in the role of a system designer, tasking you with developing an algorithm to optimize collimator positions that guarantees coverage while minimizing irradiated area, applying geometric principles to solve a practical engineering challenge. [@problem_id:4942147]", "problem": "An X-ray imaging system uses four independent collimator blades to create an axis-aligned rectangular aperture on the detector plane. The detector plane is modeled in Cartesian coordinates, measured in millimeters, with the aperture edges denoted by $x_L$ (left), $x_R$ (right), $y_B$ (bottom), and $y_T$ (top). A Region of Interest (ROI) is an axis-aligned rectangle with center $(x_0,y_0)$, width $w$ (in millimeters), and height $h$ (in millimeters). Patient motion during exposure is modeled as a bounded set $S \\subset \\mathbb{R}^2$ of possible in-plane translations on the detector plane.\n\nCoverage requirement: For every motion vector $(u_x,u_y) \\in S$, the translated ROI must be entirely contained within the collimator aperture. The aim is to minimize the irradiated area subject to this coverage requirement and hardware constraints.\n\nFundamental base:\n- Rectangles are represented as Cartesian products of intervals.\n- The Minkowski sum of sets $A$ and $B$ is defined as $A \\oplus B = \\{a+b \\mid a \\in A, b \\in B\\}$.\n- For an axis-aligned rectangle, the smallest axis-aligned rectangle that contains its Minkowski sum with a bounded set is obtained by expanding the rectangle by the maximal projections of the bounded set along the coordinate axes.\n\nHardware and quantization constraints:\n- The blade positions must be integer multiples of a quantization step $q$ (in millimeters). Quantization must be performed outward to preserve coverage.\n- Device bounds restrict the aperture to lie within $[X_{\\min}, X_{\\max}] \\times [Y_{\\min}, Y_{\\max}]$.\n\nMotion set models to be used in the test suite:\n1. Axis-aligned box: $S = \\{(u_x,u_y) \\mid |u_x| \\le a_x, |u_y| \\le a_y\\}$ with parameters $a_x$ and $a_y$ in millimeters.\n2. Disc: $S = \\{(u_x,u_y) \\mid u_x^2 + u_y^2 \\le r^2\\}$ with radius $r$ in millimeters.\n3. Convex polygon: $S$ is the convex hull of a finite set of vertices $\\{v_i\\}$ given as ordered pairs in millimeters, assumed to contain the origin.\n\nOptimization objective:\n- Minimize the irradiated area $(x_R - x_L)(y_T - y_B)$ (in square millimeters) subject to the coverage requirement and device bounds. If the constraints cannot be satisfied, declare the case infeasible.\n\nAlgorithmic requirement:\n- Compute the minimal axis-aligned rectangle that contains the set of all translated ROI positions under motion $S$. Then apply outward quantization to enforce the blade step $q$. Finally check hardware bounds. If feasible, report the area and blade positions; otherwise report infeasible.\n\nUnits:\n- All geometric inputs and outputs must be in millimeters.\n- Areas must be in square millimeters.\n\nFinal output format:\n- For each test case, output either the boolean $false$ (if infeasible) or a list $[true,\\text{area\\_mm2},x_L,x_R,y_B,y_T]$ where $\\text{area\\_mm2}$ is the irradiated area in square millimeters and $x_L,x_R,y_B,y_T$ are the blade positions in millimeters.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,\\dots]$).\n\nTest suite:\n- Case $1$: ROI center $(0,0)$, width $100$ mm, height $80$ mm; motion is a disc with radius $10$ mm; quantization step $q=0$ mm; device bounds $X_{\\min}=-200$, $X_{\\max}=200$, $Y_{\\min}=-200$, $Y_{\\max}=200$.\n- Case $2$: ROI center $(10,-5)$, width $50$ mm, height $50$ mm; motion is an axis-aligned box with $a_x=5$ mm, $a_y=2$ mm; quantization step $q=1$ mm; device bounds $X_{\\min}=-100$, $X_{\\max}=100$, $Y_{\\min}=-100$, $Y_{\\max}=100$.\n- Case $3$: ROI center $(5,5)$, width $20$ mm, height $30$ mm; motion is a convex polygon with vertices $(3,0)$, $(-3,0)$, $(0,6)$, $(0,-6)$; quantization step $q=0.5$ mm; device bounds $X_{\\min}=-100$, $X_{\\max}=100$, $Y_{\\min}=-100$, $Y_{\\max}=100$.\n- Case $4$: ROI center $(0,0)$, width $380$ mm, height $380$ mm; motion is a disc with radius $50$ mm; quantization step $q=0$ mm; device bounds $X_{\\min}=-200$, $X_{\\max}=200$, $Y_{\\min}=-200$, $Y_{\\max}=200$.\n- Case $5$: ROI center $(1,1)$, width $64$ mm, height $64$ mm; motion is a disc with radius $0$ mm; quantization step $q=2$ mm; device bounds $X_{\\min}=-200$, $X_{\\max}=200$, $Y_{\\min}=-200$, $Y_{\\max}=200$.", "solution": "The user-provided problem has been validated and is determined to be sound, well-posed, and complete.\n\nThe problem requires us to find the minimal area, axis-aligned rectangular aperture defined by collimator blades, subject to a set of constraints. The primary constraint is that for a given Region of Interest (ROI) and a set of possible patient motion translations, the ROI must remain fully within the aperture for any translation in the motion set.\n\nLet the initial ROI, an axis-aligned rectangle, be denoted by the set of points $R \\subset \\mathbb{R}^2$. The ROI is defined by its center $(x_0, y_0)$, width $w$, and height $h$. The set $R$ can be expressed as the Cartesian product of two intervals:\n$$ R = \\left[ x_0 - \\frac{w}{2}, x_0 + \\frac{w}{2} \\right] \\times \\left[ y_0 - \\frac{h}{2}, y_0 - \\frac{h}{2} \\right] $$\nLet the set of possible patient motion vectors be $S \\subset \\mathbb{R}^2$. The coverage requirement states that for any motion vector $s \\in S$, the translated ROI, $R+s = \\{r+s \\mid r \\in R\\}$, must be contained within the aperture. This implies that the aperture must contain the union of all possible translated ROIs, which is the set $\\bigcup_{s \\in S} (R+s)$. This union is equivalent to the Minkowski sum of the sets $R$ and $S$:\n$$ \\text{Required Coverage Region} = R \\oplus S = \\{r+s \\mid r \\in R, s \\in S\\} $$\nThe problem correctly states that the smallest axis-aligned rectangle that contains $R \\oplus S$ is obtained by expanding the initial rectangle $R$ by the maximal projections of the motion set $S$ along the coordinate axes.\n\nThe step-by-step procedure is as follows:\n\n**Step 1: Determine the Ideal Aperture Boundaries**\nFirst, we establish the boundaries of the initial ROI, denoted as $x_{L,init}$, $x_{R,init}$, $y_{B,init}$, and $y_{T,init}$.\n$$ x_{L,init} = x_0 - \\frac{w}{2} $$\n$$ x_{R,init} = x_0 + \\frac{w}{2} $$\n$$ y_{B,init} = y_0 - \\frac{h}{2} $$\n$$ y_{T,init} = y_0 + \\frac{h}{2} $$\nNext, we find the extremal displacements from the motion set $S$. Let these be:\n$$ \\Delta x_{\\min} = \\inf_{(u_x, u_y) \\in S} u_x, \\quad \\Delta x_{\\max} = \\sup_{(u_x, u_y) \\in S} u_x $$\n$$ \\Delta y_{\\min} = \\inf_{(u_x, u_y) \\in S} u_y, \\quad \\Delta y_{\\max} = \\sup_{(u_x, u_y) \\in S} u_y $$\nThese extrema depend on the model for $S$:\n1.  **Axis-aligned box**: For $S = \\{(u_x,u_y) \\mid |u_x| \\le a_x, |u_y| \\le a_y\\}$, the extrema are $\\Delta x_{\\min} = -a_x$, $\\Delta x_{\\max} = a_x$, $\\Delta y_{\\min} = -a_y$, and $\\Delta y_{\\max} = a_y$.\n2.  **Disc**: For $S = \\{(u_x,u_y) \\mid u_x^2 + u_y^2 \\le r^2\\}$, the extrema are $\\Delta x_{\\min} = -r$, $\\Delta x_{\\max} = r$, $\\Delta y_{\\min} = -r$, and $\\Delta y_{\\max} = r$.\n3.  **Convex polygon**: For $S$ being the convex hull of vertices $\\{v_i=(v_{ix}, v_{iy})\\}$, the extrema are found at the vertices: $\\Delta x_{\\min} = \\min_i(v_{ix})$, $\\Delta x_{\\max} = \\max_i(v_{ix})$, $\\Delta y_{\\min} = \\min_i(v_{iy})$, and $\\Delta y_{\\max} = \\max_i(v_{iy})$.\n\nThe boundaries of the ideal, unquantized aperture, which is the minimal axis-aligned bounding box of $R \\oplus S$, are then:\n$$ x_{L,ideal} = x_{L,init} + \\Delta x_{\\min} $$\n$$ x_{R,ideal} = x_{R,init} + \\Delta x_{\\max} $$\n$$ y_{B,ideal} = y_{B,init} + \\Delta y_{\\min} $$\n$$ y_{T,ideal} = y_{T,init} + \\Delta y_{\\max} $$\n\n**Step 2: Apply Outward Quantization**\nThe hardware requires blade positions to be integer multiples of a quantization step $q$. To maintain full coverage, quantization must be performed \"outward\". A left or bottom edge moves outward by decreasing its value, while a right or top edge moves outward by increasing its value.\nFor a non-zero quantization step $q > 0$, the final blade positions ($x_L, x_R, y_B, y_T$) are calculated as:\n$$ x_L = q \\cdot \\left\\lfloor \\frac{x_{L,ideal}}{q} \\right\\rfloor $$\n$$ x_R = q \\cdot \\left\\lceil \\frac{x_{R,ideal}}{q} \\right\\rceil $$\n$$ y_B = q \\cdot \\left\\lfloor \\frac{y_{B,ideal}}{q} \\right\\rfloor $$\n$$ y_T = q \\cdot \\left\\lceil \\frac{y_{T,ideal}}{q} \\right\\rceil $$\nIf $q=0$, no quantization is applied, so the final positions are equal to the ideal positions.\n\n**Step 3: Check Feasibility and Compute Final Result**\nThe calculated aperture $[x_L, x_R] \\times [y_B, y_T]$ must be geometrically valid and lie within the device's hardware limits, $[X_{\\min}, X_{\\max}] \\times [Y_{\\min}, Y_{\\max}]$. The following conditions must all be true for a feasible solution:\n1.  $x_L  x_R$\n2.  $y_B  y_T$\n3.  $x_L \\ge X_{\\min}$\n4.  $x_R \\le X_{\\max}$\n5.  $y_B \\ge Y_{\\min}$\n6.  $y_T \\le Y_{\\max}$\n\nIf any condition is violated, the case is declared infeasible. Otherwise, the solution is feasible, and the irradiated area is calculated as:\n$$ \\text{Area} = (x_R - x_L) \\cdot (y_T - y_B) $$\nThe final result is then formatted as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final output.\n    \"\"\"\n    test_cases = [\n        # Case 1\n        {'roi_center': (0, 0), 'roi_dims': (100, 80), 'motion_model': 'disc', \n         'motion_params': {'r': 10}, 'q': 0, 'bounds': (-200, 200, -200, 200)},\n        # Case 2\n        {'roi_center': (10, -5), 'roi_dims': (50, 50), 'motion_model': 'box', \n         'motion_params': {'ax': 5, 'ay': 2}, 'q': 1, 'bounds': (-100, 100, -100, 100)},\n        # Case 3\n        {'roi_center': (5, 5), 'roi_dims': (20, 30), 'motion_model': 'polygon', \n         'motion_params': {'vertices': [(3, 0), (-3, 0), (0, 6), (0, -6)]}, 'q': 0.5, 'bounds': (-100, 100, -100, 100)},\n        # Case 4\n        {'roi_center': (0, 0), 'roi_dims': (380, 380), 'motion_model': 'disc', \n         'motion_params': {'r': 50}, 'q': 0, 'bounds': (-200, 200, -200, 200)},\n        # Case 5\n        {'roi_center': (1, 1), 'roi_dims': (64, 64), 'motion_model': 'disc', \n         'motion_params': {'r': 0}, 'q': 2, 'bounds': (-200, 200, -200, 200)},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_aperture(case)\n        results.append(result)\n\n    # Format the final output string as per requirements.\n    formatted_results = []\n    for res in results:\n        if res is False:\n            formatted_results.append(\"false\")\n        else:\n            # res is a list: [True, area, xl, xr, yb, yt]\n            # [true,area_mm2,x_L,x_R,y_B,y_T]\n            res_str = (f\"[{str(res[0]).lower()},\"\n                       f\"{float(res[1])},\"\n                       f\"{float(res[2])},\"\n                       f\"{float(res[3])},\"\n                       f\"{float(res[4])},\"\n                       f\"{float(res[5])}]\")\n            formatted_results.append(res_str)\n\n    print(f\"[{','.join(formatted_results)}]\")\n\n\ndef calculate_aperture(case_params):\n    \"\"\"\n    Calculates the minimal feasible aperture for a single test case.\n    \n    Returns:\n        False if infeasible, or a list [True, area, x_L, x_R, y_B, y_T] if feasible.\n    \"\"\"\n    x0, y0 = case_params['roi_center']\n    w, h = case_params['roi_dims']\n    motion_model = case_params['motion_model']\n    motion_params = case_params['motion_params']\n    q = case_params['q']\n    Xmin, Xmax, Ymin, Ymax = case_params['bounds']\n\n    # Step 1: Determine ideal aperture boundaries\n    xL_init = x0 - w / 2.0\n    xR_init = x0 + w / 2.0\n    yB_init = y0 - h / 2.0\n    yT_init = y0 + h / 2.0\n\n    if motion_model == 'disc':\n        r = motion_params['r']\n        dx_min, dx_max = -r, r\n        dy_min, dy_max = -r, r\n    elif motion_model == 'box':\n        ax, ay = motion_params['ax'], motion_params['ay']\n        dx_min, dx_max = -ax, ax\n        dy_min, dy_max = -ay, ay\n    elif motion_model == 'polygon':\n        vertices = np.array(motion_params['vertices'])\n        dx_min = np.min(vertices[:, 0])\n        dx_max = np.max(vertices[:, 0])\n        dy_min = np.min(vertices[:, 1])\n        dy_max = np.max(vertices[:, 1])\n    else:\n        # Should not happen with the given test suite\n        raise ValueError(\"Unknown motion model\")\n    \n    xL_ideal = xL_init + dx_min\n    xR_ideal = xR_init + dx_max\n    yB_ideal = yB_init + dy_min\n    yT_ideal = yT_init + dy_max\n\n    # Step 2: Apply outward quantization\n    if q > 0:\n        xL = q * np.floor(xL_ideal / q)\n        xR = q * np.ceil(xR_ideal / q)\n        yB = q * np.floor(yB_ideal / q)\n        yT = q * np.ceil(yT_ideal / q)\n    else: # q == 0\n        xL, xR, yB, yT = xL_ideal, xR_ideal, yB_ideal, yT_ideal\n\n    # Step 3: Check feasibility\n    is_feasible = (xL  xR and \n                   yB  yT and\n                   xL >= Xmin and \n                   xR = Xmax and\n                   yB >= Ymin and \n                   yT = Ymax)\n\n    if not is_feasible:\n        return False\n    \n    # Step 4: Compute area and return result\n    area = (xR - xL) * (yT - yB)\n    return [True, area, xL, xR, yB, yT]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "4942147"}]}