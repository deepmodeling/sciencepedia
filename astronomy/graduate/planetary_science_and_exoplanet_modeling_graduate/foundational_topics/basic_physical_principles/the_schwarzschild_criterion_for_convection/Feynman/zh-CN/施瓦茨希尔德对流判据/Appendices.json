{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个练习将提供一个具体的情景：一个具有确定温度剖面的系外行星大气层。你的任务是通过计算和比较环境温度递减率与绝热温度递减率，直接进行稳定性测试。这个练习旨在让你以最直接的方式应用史瓦西判据（），从而建立对该判据如何工作的基本理解。",
            "id": "4184704",
            "problem": "考虑一个无云、以氢为主的系外行星大气层，该大气层被建模为处于静力平衡状态的理想气体，其环境温度剖面由 $T(z)=1500\\,\\mathrm{K}-\\left(12\\,\\mathrm{K\\,km^{-1}}\\right)z$ 给出，其中 $z$ 是以 $\\mathrm{km}$ 为单位的几何高度。引力加速度为 $g=25\\,\\mathrm{m\\,s^{-2}}$，平均分子量为 $\\mu=2.3$（以原子质量单位计），质量比定压热容为 $c_p=1.3\\times 10^4\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。假设 $c_p$ 随高度保持不变，并且理想气体定律成立，其通用气体常数 $R_{\\mathrm{u}}$ 与成分无关。\n\n从静力平衡、理想气体定律以及适用于绝热气块位移的热力学第一定律出发，推导干绝热温度梯度并计算干绝热递减率 $\\Gamma_d$。计算由给定的 $T(z)$ 所隐含的环境递减率 $\\Gamma$。通过比较 $\\Gamma$ 和 $\\Gamma_d$ 来应用 Schwarzschild 对流判据。\n\n报告单一标量诊断值 $\\Delta \\Gamma=\\Gamma-\\Gamma_d$，单位为 $\\mathrm{K\\,km^{-1}}$。将你最终报告的 $\\Delta \\Gamma$ 四舍五入到 $3$ 位有效数字。所有中间的递减率都以 $\\mathrm{K\\,km^{-1}}$ 表示，并假设不需要弧度。",
            "solution": "首先通过检查其组成部分来验证该问题。\n\n**步骤 1：提取已知条件**\n- 模型：一个无云、以氢为主的系外行星大气层。\n- 假设：大气是处于静力平衡状态的理想气体。\n- 环境温度剖面：$T(z)=1500\\,\\mathrm{K}-\\left(12\\,\\mathrm{K\\,km^{-1}}\\right)z$，其中 $z$ 是以 $\\mathrm{km}$ 为单位的几何高度。\n- 引力加速度：$g=25\\,\\mathrm{m\\,s^{-2}}$。\n- 平均分子量：$\\mu=2.3$ 原子质量单位。\n- 质量比定压热容：$c_p=1.3\\times 10^4\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。\n- 附加条件：$c_p$ 随高度恒定；理想气体定律成立，其通用气体常数 $R_{\\mathrm{u}}$。\n- 任务：推导干绝热温度梯度并计算干绝热递减率 $\\Gamma_d$。\n- 任务：计算环境递减率 $\\Gamma$。\n- 任务：通过比较 $\\Gamma$ 和 $\\Gamma_d$ 应用 Schwarzschild 对流判据。\n- 任务：报告诊断值 $\\Delta \\Gamma=\\Gamma-\\Gamma_d$，单位为 $\\mathrm{K\\,km^{-1}}$，并四舍五入到 $3$ 位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学基础**：该问题很好地基于大气物理学的基本原理，特别是热力学和流体静力学。静力平衡、理想气体定律、绝热过程和 Schwarzschild 对流判据等概念在行星科学和天体物理学中是标准内容。\n- **适定性**：该问题提供了推导和计算所需量的所有必要数据。它要求一个特定的、唯一可确定的值（$\\Delta \\Gamma$）。对于在指定温度下的以氢为主的气体，包含 $\\mu$ 与给定的 $c_p$ 在物理上是一致的，尽管对于使用给定 $c_p$ 的最直接求解路径来说，$\\mu$ 并非直接需要。\n- **客观性和清晰度**：该问题使用精确、明确的科学语言陈述。\n- **一致性和真实性**：给定的 $g$、$T$、$c_p$ 和 $\\mu$ 值对于类热木星系外行星在物理上是合理的。所提供的数据没有内部矛盾。\n\n**步骤 3：结论和行动**\n该问题在科学上有效、适定且内部一致。将提供完整的解答。\n\n**解答推导**\n目标是通过计算环境递减率 $\\Gamma$ 和干绝热递减率 $\\Gamma_d$ 之间的差值来确定大气对对流的稳定性。\n\n首先，我们确定环境递减率 $\\Gamma$。它被定义为大气中实际温度梯度的负值：\n$$\n\\Gamma = -\\frac{dT}{dz}\n$$\n给定的温度剖面为 $T(z) = 1500\\,\\mathrm{K} - (12\\,\\mathrm{K\\,km^{-1}})z$。\n我们将常数温度梯度表示为 $\\frac{dT}{dz} = -12\\,\\mathrm{K\\,km^{-1}}$。\n因此，环境递减率是：\n$$\n\\Gamma = -(-12\\,\\mathrm{K\\,km^{-1}}) = 12\\,\\mathrm{K\\,km^{-1}}\n$$\n\n接下来，我们按照要求从第一性原理推导干绝热递减率 $\\Gamma_d$。该推导依赖于三个基本物理定律。\n\n1.  **适用于绝热过程的热力学第一定律**：对于一个绝热位移的气块（与其周围环境没有热交换，$dQ=0$），单位质量的热力学第一定律为：\n    $$\n    c_p dT - \\frac{1}{\\rho} dP = 0\n    $$\n    其中 $c_p$ 是定压比热容，$T$ 是温度，$\\rho$ 是密度，$P$ 是压力。该方程描述了气块的温度变化 $(dT)_{\\text{parcel}}$ 如何随其压力变化 $(dP)_{\\text{parcel}}$ 而变化。重新整理得到绝热气块温度相对于压力的变化：\n    $$\n    \\left(\\frac{dT}{dP}\\right)_{\\text{ad}} = \\frac{1}{\\rho c_p}\n    $$\n\n2.  **理想气体定律**：假设大气气体表现为理想气体。该定律可以写成密度的形式：\n    $$\n    P = \\rho R T\n    $$\n    其中 $R$ 是比气体常数。我们可以将密度表示为 $\\rho = \\frac{P}{RT}$。将其代入绝热温压关系式中：\n    $$\n    \\left(\\frac{dT}{dP}\\right)_{\\text{ad}} = \\frac{RT}{P c_p}\n    $$\n\n3.  **静力平衡方程**：假设背景大气处于静力平衡状态，这意味着向上的压力梯度力与向下的引力相平衡：\n    $$\n    \\frac{dP}{dz} = -\\rho g\n    $$\n    其中 $g$ 是引力加速度，$z$ 是垂直坐标。该方程描述了背景环境的压力剖面。使用理想气体定律代入 $\\rho$，我们得到：\n    $$\n    \\frac{dP}{dz} = -\\frac{Pg}{RT}\n    $$\n\n干绝热递减率 $\\Gamma_d$ 是干气块在大气中绝热上升时冷却的速率。它被定义为 $\\Gamma_d = -(\\frac{dT}{dz})_{\\text{ad}}$。我们可以通过应用链式法则来找到 $(\\frac{dT}{dz})_{\\text{ad}}$，将气块的温度随压力的变化与背景大气的压力随高度的变化结合起来：\n$$\n\\left(\\frac{dT}{dz}\\right)_{\\text{ad}} = \\left(\\frac{dT}{dP}\\right)_{\\text{ad}} \\left(\\frac{dP}{dz}\\right)\n$$\n代入从上述原理推导出的表达式：\n$$\n\\left(\\frac{dT}{dz}\\right)_{\\text{ad}} = \\left(\\frac{RT}{P c_p}\\right) \\left(-\\frac{Pg}{RT}\\right)\n$$\n项 $P$、$R$ 和 $T$ 消掉了，得到一个关于绝热温度梯度的简单表达式：\n$$\n\\left(\\frac{dT}{dz}\\right)_{\\text{ad}} = -\\frac{g}{c_p}\n$$\n根据定义，干绝热递减率是该梯度的负值：\n$$\n\\Gamma_d = -\\left(-\\frac{g}{c_p}\\right) = \\frac{g}{c_p}\n$$\n这是干绝热递减率的一般表达式。\n\n现在，我们使用给定的常数计算 $\\Gamma_d$ 的数值：$g=25\\,\\mathrm{m\\,s^{-2}}$ 和 $c_p=1.3\\times 10^4\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。\n$$\n\\Gamma_d = \\frac{25\\,\\mathrm{m\\,s^{-2}}}{1.3\\times 10^4\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}}\n$$\n此计算的单位是 $\\mathrm{K\\,m^{-1}}$。问题要求结果以 $\\mathrm{K\\,km^{-1}}$ 为单位。我们必须通过乘以 $1000\\,\\mathrm{m\\,km^{-1}}$ 来转换单位。\n$$\n\\Gamma_d = \\frac{25}{1.3 \\times 10^4}\\,\\mathrm{K\\,m^{-1}} \\times 1000\\,\\mathrm{m\\,km^{-1}} = \\frac{25 \\times 1000}{1.3 \\times 10^4}\\,\\mathrm{K\\,km^{-1}} = \\frac{25}{13}\\,\\mathrm{K\\,km^{-1}}\n$$\n数值上，这等于：\n$$\n\\Gamma_d \\approx 1.92307... \\,\\mathrm{K\\,km^{-1}}\n$$\n\nSchwarzschild 对流判据指出，如果环境递减率超过绝热递减率，即 $\\Gamma > \\Gamma_d$，则大气的一个区域是不稳定的，并将发生对流。$\\Delta\\Gamma = \\Gamma - \\Gamma_d$ 的正值表示对流不稳定。\n\n我们现在计算诊断值 $\\Delta\\Gamma$：\n$$\n\\Delta\\Gamma = \\Gamma - \\Gamma_d = 12\\,\\mathrm{K\\,km^{-1}} - \\frac{25}{13}\\,\\mathrm{K\\,km^{-1}}\n$$\n$$\n\\Delta\\Gamma = \\left(12 - \\frac{25}{13}\\right)\\,\\mathrm{K\\,km^{-1}} = \\left(\\frac{12 \\times 13 - 25}{13}\\right)\\,\\mathrm{K\\,km^{-1}} = \\left(\\frac{156 - 25}{13}\\right)\\,\\mathrm{K\\,km^{-1}} = \\frac{131}{13}\\,\\mathrm{K\\,km^{-1}}\n$$\n计算最终数值：\n$$\n\\Delta\\Gamma \\approx 10.076923... \\,\\mathrm{K\\,km^{-1}}\n$$\n按要求四舍五入到 $3$ 位有效数字，我们得到 $10.1\\,\\mathrm{K\\,km^{-1}}$。由于 $\\Delta \\Gamma > 0$，大气是对流不稳定的。",
            "answer": "$$\n\\boxed{10.1}\n$$"
        },
        {
            "introduction": "真实的行星内部通常存在成分梯度，这会影响其稳定性。本练习将介绍勒杜判据（Ledoux criterion），这是一个更普适的稳定性条件，它考虑了平均分子量变化所带来的稳定效应（）。通过比较史瓦西判据和勒杜判据的结果，你将深入了解半对流（semiconvection）现象以及简单判据的局限性。",
            "id": "4184749",
            "problem": "考虑一个氢氦系外行星包层，该包层正在经历缓慢的氦沉降，使得平均分子量随深度增加。该包层局部处于流体静力学平衡状态，并且可以很好地用理想气体来近似。给定该包层中测得的以下对数梯度：成分梯度 $\\nabla_{\\mu} = d\\ln\\mu/d\\ln P$ 为 $\\nabla_{\\mu} = 0.05$，绝热温度梯度为 $\\nabla_{\\mathrm{ad}} = 0.30$，实际温度梯度为 $\\nabla = 0.32$，其中 $\\mu$ 是平均分子量，$P$ 是压力，$T$ 是温度。假设在相同压力下进行微小、快速、绝热的流体元位移，并且在位移过程中，被位移的流体元的成分保持不变。同时，假设理想气体的热力学导数 $(\\delta,\\phi)$ 满足 $\\delta \\equiv -\\left(\\partial\\ln\\rho/\\partial\\ln T\\right)_{P,\\mu} = 1$ 和 $\\phi \\equiv \\left(\\partial\\ln\\rho/\\partial\\ln\\mu\\right)_{P,T} = 1$，其中 $\\rho$ 是密度。\n\n从流体静力学平衡方程、理想气体定律以及被位移流体元的浮力定义出发，从第一性原理推导仅基于热分层的对流稳定性阈值（Schwarzschild判据），以及包含成分梯度稳定效应的阈值（Ledoux判据）。然后，对于给定的包层，计算无量纲超差 $E_{\\mathrm{S}}$ 和 $E_{\\mathrm{L}}$，它们定义为实际热梯度与您为Schwarzschild和Ledoux情况推导出的各自阈值之间的差值。将数对 $\\left(E_{\\mathrm{S}}, E_{\\mathrm{L}}\\right)$ 以单行矩阵的形式报告。将您的数值答案四舍五入到四位有效数字。由于超差是无量纲的，请勿为最终值附加任何单位。",
            "solution": "问题要求从第一性原理推导对流的Schwarzschild判据和Ledoux判据，并随后计算给定系外行星包层的稳定性超差。\n\n判断对流稳定性的第一性原理是分析一个流体元从其平衡位置位移后的运动。如果一个被垂直位移的流体元返回其原始位置，则该层是对流稳定的。如果该流体元继续远离其原始位置，则该层是不稳定的。这由浮力决定，浮力取决于流体元与其周围环境之间的密度差。\n\n考虑一个初始压力为 $P$、半径为 $r$ 的流体元。流体元（下标 $p$）和环境（下标 $e$）的性质初始时是相同的：$\\rho_p = \\rho_e$，$T_p = T_e$，$\\mu_p = \\mu_e$。让我们将这个流体元向上位移一个微小距离 $\\delta r > 0$ 到一个新的压力水平 $P' = P+\\delta P$。由于压力随高度减小，$\\delta P  0$。流体元的新密度为 $\\rho'_p$，周围环境的新密度为 $\\rho'_e$。\n\n如果被位移的流体元比其新环境的密度大，它会下沉回去，则该层是稳定的。稳定性条件是 $\\rho'_p > \\rho'_e$。对于一个微小位移，我们可以将其写成关于密度梯度的条件。密度差为 $\\Delta\\rho = \\rho'_p - \\rho'_e \\approx \\left[ \\left(\\frac{d\\rho}{dr}\\right)_p - \\left(\\frac{d\\rho}{dr}\\right)_e \\right] \\delta r$。为保证稳定性，对于向上位移（$\\delta r > 0$），$\\Delta\\rho > 0$，这意味着 $\\left(\\frac{d\\rho}{dr}\\right)_p > \\left(\\frac{d\\rho}{dr}\\right)_e$。\n\n在一个处于流体静力学平衡的物体中，$\\frac{dP}{dr} = -g\\rho$，其中 $g$ 是局部重力加速度。由于 $g>0$ 和 $\\rho>0$，所以 $\\frac{dP}{dr}  0$。使用压力 $P$ 作为自变量更为方便。使用链式法则，$\\frac{d}{dr} = \\frac{dP}{dr} \\frac{d}{dP}$。稳定性条件变为：\n$$\n\\frac{dP}{dr} \\left(\\frac{d\\rho}{dP}\\right)_p > \\frac{dP}{dr} \\left(\\frac{d\\rho}{dP}\\right)_e\n$$\n由于 $\\frac{dP}{dr}$ 是负的，我们在两边同除以它时必须反转不等号：\n$$\n\\left(\\frac{d\\rho}{dP}\\right)_p  \\left(\\frac{d\\rho}{dP}\\right)_e\n$$\n为了使用问题中提供的无量纲梯度，我们将其转换为关于对数导数的条件：\n$$\n\\frac{P}{\\rho}\\left(\\frac{d\\rho}{dP}\\right)_p  \\frac{P}{\\rho}\\left(\\frac{d\\rho}{dP}\\right)_e \\implies \\left(\\frac{d\\ln\\rho}{d\\ln P}\\right)_p  \\left(\\frac{d\\ln\\rho}{d\\ln P}\\right)_e\n$$\n这是用密度的对数压力导数表示的对流稳定性的一般条件。\n\n接下来，我们用热梯度和成分梯度来表示这些导数。密度 $\\rho$ 是压力 $P$、温度 $T$ 和平均分子量 $\\mu$ 的函数。$\\ln\\rho$ 的全微分是：\n$$\nd\\ln\\rho = \\left(\\frac{\\partial\\ln\\rho}{\\partial\\ln P}\\right)_{T,\\mu} d\\ln P + \\left(\\frac{\\partial\\ln\\rho}{\\partial\\ln T}\\right)_{P,\\mu} d\\ln T + \\left(\\frac{\\partial\\ln\\rho}{\\partial\\ln\\mu}\\right)_{P,T} d\\ln\\mu\n$$\n使用问题中定义的热力学导数 $\\delta \\equiv -\\left(\\frac{\\partial\\ln\\rho}{\\partial\\ln T}\\right)_{P,\\mu}$ 和 $\\phi \\equiv \\left(\\frac{\\partial\\ln\\rho}{\\partial\\ln\\mu}\\right)_{P,T}$，上式变为：\n$$\nd\\ln\\rho = \\left(\\frac{\\partial\\ln\\rho}{\\partial\\ln P}\\right)_{T,\\mu} d\\ln P - \\delta\\, d\\ln T + \\phi\\, d\\ln\\mu\n$$\n对于理想气体（$P \\propto \\rho T/\\mu$），有 $\\rho \\propto P T^{-1} \\mu$。取对数得到 $\\ln\\rho = \\ln P - \\ln T + \\ln \\mu + \\text{常数}$。由此，我们发现 $\\left(\\frac{\\partial\\ln\\rho}{\\partial\\ln P}\\right)_{T,\\mu}=1$，这与给定的值 $\\delta=1$ 和 $\\phi=1$ 一致。因此，密度的对数压力导数为：\n$$\n\\frac{d\\ln\\rho}{d\\ln P} = 1 - \\delta \\frac{d\\ln T}{d\\ln P} + \\phi \\frac{d\\ln\\mu}{d\\ln P}\n$$\n现在我们将此应用于环境和流体元。\n\n对于环境（下标 $e$），梯度是包层中存在的实际梯度：$\\frac{d\\ln T_e}{d\\ln P} = \\nabla$ 和 $\\frac{d\\ln\\mu_e}{d\\ln P} = \\nabla_\\mu$。\n$$\n\\left(\\frac{d\\ln\\rho}{d\\ln P}\\right)_e = 1 - \\delta\\nabla + \\phi\\nabla_\\mu\n$$\n对于被位移的流体元（下标 $p$），位移被假定为快速且绝热的。因此，流体元的温度梯度遵循绝热温度梯度，即 $\\frac{d\\ln T_p}{d\\ln P} = \\nabla_{\\mathrm{ad}}$。流体元的成分没有时间改变，因此保持不变：$\\frac{d\\ln\\mu_p}{d\\ln P} = 0$。\n$$\n\\left(\\frac{d\\ln\\rho}{d\\ln P}\\right)_p = 1 - \\delta\\nabla_{\\mathrm{ad}} + \\phi(0) = 1 - \\delta\\nabla_{\\mathrm{ad}}\n$$\n将这些表达式代入稳定性条件 $\\left(\\frac{d\\ln\\rho}{d\\ln P}\\right)_p  \\left(\\frac{d\\ln\\rho}{d\\ln P}\\right)_e$：\n$$\n1 - \\delta\\nabla_{\\mathrm{ad}}  1 - \\delta\\nabla + \\phi\\nabla_\\mu\n$$\n$$\n-\\delta\\nabla_{\\mathrm{ad}}  -\\delta\\nabla + \\phi\\nabla_\\mu\n$$\n$$\n\\delta\\nabla  \\delta\\nabla_{\\mathrm{ad}} + \\phi\\nabla_\\mu\n$$\n两边同除以 $\\delta$（为正值）得到稳定性条件：\n$$\n\\nabla  \\nabla_{\\mathrm{ad}} + \\frac{\\phi}{\\delta}\\nabla_\\mu\n$$\n这就是对流稳定性的 **Ledoux判据**。当实际温度梯度 $\\nabla$ 超过阈值 $\\nabla_{\\mathrm{ad}} + \\frac{\\phi}{\\delta}\\nabla_\\mu$ 时，该层变得对流不稳定。一个正的成分梯度（$\\nabla_\\mu > 0$，即平均分子量随深度/压力增加）具有稳定作用。\n\n**Schwarzschild判据** 是通过忽略成分梯度的影响得出的，这相当于在Ledoux判据中设置 $\\nabla_\\mu = 0$。稳定性条件简化为：\n$$\n\\nabla  \\nabla_{\\mathrm{ad}}\n$$\n该判据指出，如果实际温度梯度是超绝热的（$\\nabla > \\nabla_{\\mathrm{ad}}$），则该层是不稳定的。\n\n问题要求计算无量纲超差 $E_{\\mathrm{S}}$ 和 $E_{\\mathrm{L}}$，它们被定义为实际热梯度与各自不稳定性阈值之间的差。\nSchwarzschild不稳定性阈值是 $\\nabla_{\\mathrm{ad}}$。超差为：\n$$\nE_{\\mathrm{S}} = \\nabla - \\nabla_{\\mathrm{ad}}\n$$\nLedoux不稳定性阈值是 $\\nabla_{\\mathrm{ad}} + \\frac{\\phi}{\\delta}\\nabla_\\mu$。超差为：\n$$\nE_{\\mathrm{L}} = \\nabla - \\left(\\nabla_{\\mathrm{ad}} + \\frac{\\phi}{\\delta}\\nabla_\\mu\\right)\n$$\n现在，我们代入给定的数值：\n$\\nabla = 0.32$\n$\\nabla_{\\mathrm{ad}} = 0.30$\n$\\nabla_{\\mu} = 0.05$\n$\\delta = 1$\n$\\phi = 1$\n\n计算Schwarzschild超差 $E_{\\mathrm{S}}$：\n$$\nE_{\\mathrm{S}} = 0.32 - 0.30 = 0.02\n$$\n$E_{\\mathrm{S}}$ 的正值意味着根据Schwarzschild判据，该层是不稳定的（$\\nabla > \\nabla_{\\mathrm{ad}}$）。\n\n计算Ledoux超差 $E_{\\mathrm{L}}$：\n$$\nE_{\\mathrm{L}} = 0.32 - \\left(0.30 + \\frac{1}{1} \\times 0.05\\right) = 0.32 - (0.30 + 0.05) = 0.32 - 0.35 = -0.03\n$$\n$E_{\\mathrm{L}}$ 的负值意味着根据Ledoux判据，该层是稳定的（$\\nabla  \\nabla_{\\mathrm{ad}} + \\frac{\\phi}{\\delta}\\nabla_\\mu$）。成分梯度的稳定效应足以克服热不稳定性。这种物理状态被称为半对流。\n\n问题要求将数对 $(E_{\\mathrm{S}}, E_{\\mathrm{L}})$ 四舍五入到四位有效数字。\n$E_{\\mathrm{S}} = 0.02000$\n$E_{\\mathrm{L}} = -0.03000$\n该数对以单行矩阵的形式报告。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.02000  -0.03000 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "从单点分析转向完整的大气建模，本练习要求你编写一个程序，以识别任何给定大气剖面中的对流区域。你将实施数值方法，在压力网格上计算温度递减率，并系统地应用史瓦西判据（）。这项实践旨在培养你在行星和系外行星大气建模方面所必需的计算技能。",
            "id": "4184782",
            "problem": "您正在使用 Schwarzschild 对流判据来模拟行星和系外行星大气中的垂直稳定性。这个问题的基本基础包括流体静力平衡、理想气体状态方程以及温度直减率的热力学定义。令 $P$ 表示压强（单位：帕斯卡），$z$ 表示几何高度（单位：米），$T$ 表示温度（单位：开尔文），$\\rho$ 表示质量密度（单位：千克/立方米），$g$ 表示重力加速度（单位：米/平方秒），$R_{\\mathrm{u}}$ 表示普适气体常数（单位：焦耳/摩尔·开尔文），$M$ 表示平均摩尔质量（单位：千克/摩尔），$c_p$ 表示定压比热容（单位：焦耳/千克·开尔文）。您可以使用的基本关系是：流体静力平衡 $dP/dz=-\\rho g$，理想气体状态方程 $P=\\rho R T$（其中 $R=R_{\\mathrm{u}}/M$），以及由 $H_p=-P/(dP/dz)$ 定义的气压标高。物理温度直减率为 $\\Gamma(P)=-dT/dz$，干绝热温度直减率为 $\\Gamma_d(P)=g/c_p(P)$。Schwarzschild 对流判据预测，在物理温度直减率满足 $\\Gamma(P)\\Gamma_d(P)$ 的任何地方都会发生对流。\n\n您的任务是实现一个程序，对于给定的参数化 $T(P)$ 廓线和 $c_p(P)$ 方程，该程序使用 $H_p(P)$ 计算垂直温度直减率 $\\Gamma(P)$，评估条件 $\\Gamma(P)\\Gamma_d(P)$，并返回满足该条件的连续压强区间。您必须在一个均匀的 $\\ln P$ 网格上数值计算关于 $\\ln P$ 的导数，并使用链式法则获得用 $H_p(P)$ 和 $dT/d\\ln P$ 表示的 $-dT/dz$。气压标高 $H_p(P)$ 必须通过理想气体关系和流体静力平衡，由给定的 $T(P)$ 和常数计算得出。最终报告的区间必须以帕斯卡表示。\n\n实现要求：\n- 在闭区间 $[P_{\\min},P_{\\max}]$ 上构建一个包含 $N$ 个在 $\\ln P$ 上均匀分布的点的压强网格。对内部点使用中心差分，对端点使用单侧差分来近似 $dT/d\\ln P$。\n- 使用由 $H_p(P)=P/(\\rho g)$ 计算出的 $H_p(P)$，并结合理想气体关系来消去 $\\rho$。\n- 在网格上一致地计算 $\\Gamma(P)$ 和 $\\Gamma_d(P)$，并确定 $\\Gamma(P)\\Gamma_d(P)$ 成立的连续网格段。\n- 将满足不稳定判据的相邻网格点合并为区间 $[P_{\\mathrm{start}},P_{\\mathrm{end}}]$（其中 $P_{\\mathrm{start}}  P_{\\mathrm{end}}$）。\n- 将最终报告的压强区间端点四舍五入到最接近的整数帕斯卡。\n\n测试用例：\n您必须评估四个独立的测试用例，并以单个 JSON 兼容列表的形式报告结果，该列表包含四个子列表，每个子列表包含特定测试用例的区间（如果有）。\n- 用例 A：$g=9.4$, $M=2.3\\times 10^{-3}$, $P_{\\min}=10^3$, $P_{\\max}=10^6$, $T(P)=300(P/10^5)^{0.30}$, $c_p(P)=1.43\\times 10^4$。\n- 用例 B：$g=9.4$, $M=2.3\\times 10^{-3}$, $P_{\\min}=10^3$, $P_{\\max}=10^6$, $T(P)=300(P/10^5)^{\\alpha_n}$，其中 $\\alpha_n=(R_{\\mathrm{u}}/M)/c_p$, $c_p(P)=1.43\\times 10^4$。\n- 用例 C：$g=11.0$, $M=2.7\\times 10^{-2}$, $P_{\\min}=10^3$, $P_{\\max}=10^6$, $T(P) = T_b \\text{ if } P\\le P_b \\text{ else } T_b(P/P_b)^{0.35}$，其中 $T_b=320, P_b=5\\times 10^4$。\n- 用例 D：$g=7.0$, $M=2.3\\times 10^{-3}$, $P_{\\min}=10^4$, $P_{\\max}=7\\times 10^5$, $T(P)=300(P/10^5)^{0.28}$, $c_p(P)=1.0\\times 10^4 \\left( 1 + 0.7 / (1 + e^{-(P-2.0\\times 10^5)/5.0\\times 10^4}) \\right)$。\n\n输出必须是一个包含四个列表的单个列表，例如 `[[[P1s,P1e]], [[P2s,P2e],[P3s,P3e]], [], ...]`，其中每个内部列表对应一个用例的结果。",
            "solution": "所述问题在科学上是合理的、适定的、客观的，并包含足够的信息以获得唯一解。其基础物理原理（基于流体静力平衡、理想气体定律和绝热过程热力学）是行星科学的基础。在此背景下，Schwarzschild 判据是对流的标准诊断方法。因此，该问题被认为是**有效的**，我将继续提供完整解答。\n\n目标是确定行星大气中对流不稳定的压强区间。控制原理是 Schwarzschild 判据，该判据指出，当一个气块垂直位移时，如果它相对于新环境保持浮力，它将继续上升或下沉。当背景大气的随高度冷却速度快于位移气块因绝热膨胀而冷却的速度时，就会发生这种情况。\n\n让我们正式推导所需物理量。物理（或环境）温度直减率定义为温度随几何高度 $z$ 增加而降低的速率：\n$$\n\\Gamma(P) = -\\frac{dT}{dz}\n$$\n为了计算这个导数，我们使用链式法则将自变量从高度 $z$ 更改为压强的自然対数 $\\ln P$，因为问题要求在 $\\ln P$ 网格上进行计算。\n$$\n\\Gamma(P) = -\\frac{dT}{d\\ln P} \\frac{d\\ln P}{dz}\n$$\n$d\\ln P/dz$ 这一项可以与气压标高 $H_p$ 相关联，其定义为：\n$$\nH_p = -P \\left( \\frac{dP}{dz} \\right)^{-1}\n$$\n根据这个定义，我们有 $dP/dz = -P/H_p$。$\\ln P$ 对 $z$ 的导数是：\n$$\n\\frac{d\\ln P}{dz} = \\frac{d\\ln P}{dP} \\frac{dP}{dz} = \\frac{1}{P} \\left( -\\frac{P}{H_p} \\right) = -\\frac{1}{H_p}\n$$\n将此代入 $\\Gamma(P)$ 的表达式中，得到：\n$$\n\\Gamma(P) = -\\frac{dT}{d\\ln P} \\left( -\\frac{1}{H_p(P)} \\right) = \\frac{1}{H_p(P)} \\frac{dT}{d\\ln P}\n$$\n接下来，我们必须用给定的大气属性来表示气压标高 $H_p(P)$。我们从它在流体静力平衡方程 $dP/dz = -\\rho g$ 中的定义开始：\n$$\nH_p(P) = -P \\left( \\frac{dP}{dz} \\right)^{-1} = -P (-\\rho g)^{-1} = \\frac{P}{\\rho g}\n$$\n其中 $\\rho$ 是质量密度，$g$ 是重力加速度。我们使用理想气体状态方程 $P = \\rho R T$ 来消去密度 $\\rho$。比气体常数 $R$ 由普适气体常数 $R_{\\mathrm{u}}$ 除以平均摩尔质量 $M$ 给出，因此 $R=R_{\\mathrm{u}}/M$。将 $\\rho = P/(RT)$ 代入 $H_p$ 的表达式中：\n$$\nH_p(P) = \\frac{P}{(P/(RT)) g} = \\frac{RT(P)}{g} = \\frac{R_{\\mathrm{u}} T(P)}{M g}\n$$\n现在，我们可以用给定的函数和常数写出物理温度直减率的完整表达式：\n$$\n\\Gamma(P) = \\left( \\frac{R_{\\mathrm{u}} T(P)}{M g} \\right)^{-1} \\frac{dT}{d\\ln P} = \\frac{M g}{R_{\\mathrm{u}} T(P)} \\frac{dT}{d\\ln P}\n$$\n第二个关键量是干绝热温度直减率 $\\Gamma_d(P)$。这是一个气块在上升过程中因绝热膨胀而冷却的速率。它由以下公式给出：\n$$\n\\Gamma_d(P) = \\frac{g}{c_p(P)}\n$$\n当物理温度直减率超过绝热温度直减率时，即满足 Schwarzschild 对流不稳定判据：\n$$\n\\Gamma(P)  \\Gamma_d(P)\n$$\n代入我们推导出的表达式：\n$$\n\\frac{M g}{R_{\\mathrm{u}} T(P)} \\frac{dT}{d\\ln P}  \\frac{g}{c_p(P)}\n$$\n由于 $g  0$，我们可以将其简化为：\n$$\n\\frac{M}{R_{\\mathrm{u}} T(P)} \\frac{dT}{d\\ln P}  \\frac{1}{c_p(P)}\n$$\n必须在压强网格的每个点上评估这个不等式。\n\n数值实现将按以下步骤进行：\n1.  对每个测试用例，确定常数 $g$、$M$、$R_{\\mathrm{u}}$ 以及函数 $T(P)$ 和 $c_p(P)$。\n2.  在定义域 $[P_{\\min}, P_{\\max}]$ 上构建一个在 $\\ln P$ 上均匀分布的 $N=2001$ 个点的网格，以及相应的压强网格 $P_i = \\exp((\\ln P)_i)$。\n3.  对网格上的所有点 $i$，计算温度 $T_i = T(P_i)$ 和热容 $c_{p,i} = c_p(P_i)$。\n4.  在每个网格点上数值计算导数 $(dT/d\\ln P)_i$。我们将对内部点使用二阶中心差分，对端点使用二阶单侧差分，正如 `numpy.gradient` 所实现的那样。\n5.  使用上述推导的公式，在每个网格点上计算物理温度直减率 $\\Gamma_i$ 和绝热温度直减率 $\\Gamma_{d,i}$。\n6.  对于每个网格点 $i$，判断是否满足 Schwarzschild 判据 $\\Gamma_i  \\Gamma_{d,i}$。这将产生一个布尔数组，用于指示不稳定点。\n7.  识别所有连续的不稳定网格点段。从索引 $i_{start}$ 到 $i_{end}$ 的段对应于一个对流区间 $[P_{start}, P_{end}] = [P_{i_{start}}, P_{i_{end}}]$。\n8.  将每个区间的压强端点四舍五入到最接近的整数。\n9.  为每个测试用例收集区间列表，并按规定格式化最终输出。如果某个用例没有发现不稳定点，则返回一个空列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and identifies convective intervals in planetary atmospheres\n    based on the Schwarzschild criterion for four specified test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            # Case A: Globally superadiabatic power law\n            \"g\": 9.4, \"M\": 2.3e-3, \"P_min\": 1e3, \"P_max\": 1e6,\n            \"T_func\": lambda P, T0=300, P0=1e5, alpha=0.30: T0 * (P / P0)**alpha,\n            \"cp_func\": lambda P, cp0=1.43e4: np.full_like(P, cp0)\n        },\n        {\n            # Case B: Exactly neutral power law\n            \"g\": 9.4, \"M\": 2.3e-3, \"P_min\": 1e3, \"P_max\": 1e6,\n            \"T_func\": lambda P, T0=300, P0=1e5, g=9.4, M=2.3e-3, Ru=8.314462618, cp0=1.43e4: T0 * (P / P0)**((Ru/M)/cp0),\n            \"cp_func\": lambda P, cp0=1.43e4: np.full_like(P, cp0)\n        },\n        {\n            # Case C: Edge case with an isothermal upper layer\n            \"g\": 11.0, \"M\": 2.7e-2, \"P_min\": 1e3, \"P_max\": 1e6,\n            \"T_func\": lambda P, Tb=320, Pb=5e4, alpha=0.35: np.where(P = Pb, Tb, Tb * (P / Pb)**alpha),\n            \"cp_func\": lambda P, cp0=1.20e4: np.full_like(P, cp0)\n        },\n        {\n            # Case D: Variable heat capacity crossing the threshold\n            \"g\": 7.0, \"M\": 2.3e-3, \"P_min\": 1e4, \"P_max\": 7e5,\n            \"T_func\": lambda P, T0=300, P0=1e5, alpha=0.28: T0 * (P / P0)**alpha,\n            \"cp_func\": lambda P, cp0=1.0e4, delta=0.7, Pc=2.0e5, w=5.0e4: cp0 * (1 + delta / (1 + np.exp(-(P - Pc) / w)))\n        }\n    ]\n\n    R_u = 8.314462618\n    N = 2001\n    all_results = []\n\n    for case in test_cases:\n        # 1. Unpack parameters\n        g, M = case[\"g\"], case[\"M\"]\n        P_min, P_max = case[\"P_min\"], case[\"P_max\"]\n        T_func, cp_func = case[\"T_func\"], case[\"cp_func\"]\n\n        # 2. Create pressure grid\n        log_P_grid = np.linspace(np.log(P_min), np.log(P_max), N)\n        P_grid = np.exp(log_P_grid)\n\n        # 3. Evaluate T and cp on the grid\n        T_grid = T_func(P_grid)\n        cp_grid = cp_func(P_grid)\n        \n        # 4. Compute numerical derivative dT/d(ln P)\n        dTdlogP = np.gradient(T_grid, log_P_grid)\n        \n        # 5. Calculate physical and adiabatic lapse rates\n        # Gamma = (M*g / (R_u*T)) * (dT/dlnP)\n        gamma = (M * g / (R_u * T_grid)) * dTdlogP\n        \n        # Gamma_d = g / c_p\n        gamma_d = g / cp_grid\n        \n        # 6. Apply Schwarzschild criterion\n        is_unstable = gamma > gamma_d\n        \n        # 7. Identify contiguous unstable intervals\n        intervals = []\n        if np.any(is_unstable):\n            # Pad with False to correctly find intervals at edges\n            padded_unstable = np.concatenate(([False], is_unstable, [False]))\n            diff = np.diff(padded_unstable.astype(int))\n            \n            starts = np.where(diff == 1)[0]\n            ends = np.where(diff == -1)[0] - 1\n            \n            for start_idx, end_idx in zip(starts, ends):\n                # 8. Get pressures and round to nearest integer\n                p_start = int(round(P_grid[start_idx]))\n                p_end = int(round(P_grid[end_idx]))\n                if p_start  p_end:\n                    intervals.append([p_start, p_end])\n                elif p_start == p_end and start_idx == end_idx: # Single point instability\n                     # Not explicitly requested, but handle for robustness.\n                     # Problem implies merging adjacent points, a single point is not an interval P_start  P_end\n                     pass\n        \n        all_results.append(intervals)\n\n    # Format output\n    # The default str() for lists in Python includes spaces, which is fine.\n    # Eg: str([[1, 2]]) -> '[[1, 2]]'\n    results_str = [str(res).replace(\" \", \"\") for res in all_results]\n    print(f\"[{','.join(results_str)}]\")\n\n\nsolve()\n\n```"
        }
    ]
}