{
    "hands_on_practices": [
        {
            "introduction": "The ability to predict observational data from a theoretical model is a cornerstone of planetary science. This practice guides you through the \"forward problem\": generating a star's radial velocity curve from a given set of Keplerian orbital elements . You will implement a numerical solution to the timeless Kepler's equation and model the smearing effect of finite exposure times, bridging the gap between abstract dynamics and practical, high-precision observation.",
            "id": "4166315",
            "problem": "Consider a single, non-interacting, star–planet two-body system modeled by Keplerian dynamics. The orbit is bound and elliptical with orbital period $P$, eccentricity $e$, argument of periastron $\\omega$, and mean anomaly at reference epoch $M_0$. The systemic line-of-sight velocity of the stellar barycenter is $\\gamma$. Assume the orbital plane is fixed and the orbital elements are defined in the standard way for osculating Keplerian elements. Angles must be treated in radians.\n\nStarting from the fundamental laws and core definitions of Keplerian motion and Newtonian two-body dynamics, implement the following in a program:\n\n1. Use the mean motion $n$ and the mean anomaly $M(t)$ at time $t$ defined by $n = 2\\pi/P$ and $M(t) = M_0 + n\\,t$. Solve Kepler’s equation $M(t) = E(t) - e \\sin E(t)$ for the eccentric anomaly $E(t)$ for each time $t$ in the observing window. Then map $E(t)$ to the true anomaly $f(t)$ through the standard relation between eccentric and true anomalies. Do not assume any small-$e$ approximation; the solution must be robust for $0 \\le e  1$.\n\n2. Construct the line-of-sight stellar radial velocity as a function of time, $v_r(t)$, by projecting the orbital motion into the observer’s line-of-sight using the orbital elements. Adopt a fixed semi-amplitude $K = 4.0$ meters per second for all test cases, and include the systemic velocity $\\gamma$ additively. Express all velocities in meters per second and all times in days. Angles must be in radians.\n\n3. Model finite integration time effects for each exposure by computing the time-averaged velocity over each exposure window of duration $\\Delta t$, namely the value\n$$\\bar{v}_r = \\frac{1}{\\Delta t}\\int_{t_{\\mathrm{start}}}^{t_{\\mathrm{start}}+\\Delta t} v_r(t)\\,dt.$$\nFor each test case, define a sequence of exposure start times spanning a specified observing window and compute, for each exposure, both the averaged velocity $\\bar{v}_r$ and the instantaneous velocity evaluated at the exposure midpoint $v_r(t_{\\mathrm{start}} + \\Delta t/2)$. For each test case, report the maximum absolute difference (in meters per second) between these two values across all exposures in the window:\n$$D_{\\max} = \\max_{\\text{exposures}} \\left|\\bar{v}_r - v_r\\!\\left(t_{\\mathrm{start}}+\\frac{\\Delta t}{2}\\right)\\right|.$$\nReturn $D_{\\max}$ as a floating-point number in meters per second for each test case.\n\nYou must implement a numerically stable solver for Kepler’s equation and a numerically accurate time-integration routine for the averaging. You must not assume any special-case simplifications for $e=0$ or near-parabolic regimes; the implementation must be uniformly valid for all test cases as specified.\n\nPhysical units and angle units:\n- Period $P$ and all times are in days.\n- Velocities must be expressed in meters per second.\n- All angles ($\\omega$, $M_0$, and anomalies) must be in radians.\n\nTest suite:\nProvide results for the following four parameter sets. For each, construct the specified observing window and exposures, compute $D_{\\max}$, and include it in the final output list.\n\n- Case 1 (moderate eccentricity, short exposures):\n  - $P = 7.0$ days, $e = 0.3$, $\\omega = 1.0$ radians, $M_0 = 0.5$ radians, $\\gamma = 2.0$ meters per second.\n  - Observing window: total duration $T = 3.0$ days.\n  - Exposure cadence: start times at $t = 0, 0.5, 1.0, 1.5, 2.0, 2.5$ days.\n  - Exposure duration: $\\Delta t = 0.25$ days.\n\n- Case 2 (circular orbit, long exposures relative to cadence):\n  - $P = 3.0$ days, $e = 0.0$, $\\omega = 2.0$ radians, $M_0 = 1.0$ radians, $\\gamma = -1.0$ meters per second.\n  - Observing window: total duration $T = 3.0$ days.\n  - Exposure cadence: start times at $t = 0, 0.6, 1.2, 1.8, 2.4$ days.\n  - Exposure duration: $\\Delta t = 0.6$ days.\n\n- Case 3 (high eccentricity, very short exposures):\n  - $P = 10.0$ days, $e = 0.85$, $\\omega = 0.3$ radians, $M_0 = 1.4$ radians, $\\gamma = 5.0$ meters per second.\n  - Observing window: total duration $T = 10.0$ days.\n  - Exposure cadence: start times at $t = 0, 1, 2, \\ldots, 9$ days (integer days).\n  - Exposure duration: $\\Delta t = 0.05$ days.\n\n- Case 4 (short period, substantial exposure duration):\n  - $P = 1.0$ day, $e = 0.5$, $\\omega = 1.2$ radians, $M_0 = 0.1$ radians, $\\gamma = 0.0$ meters per second.\n  - Observing window: total duration $T = 1.5$ days.\n  - Exposure cadence: start times at $t = 0, 0.5, 1.0$ days.\n  - Exposure duration: $\\Delta t = 0.5$ days.\n\nFinal output format:\nYour program should produce a single line of output containing the four $D_{\\max}$ values corresponding to the above cases, as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). Each value must be a floating-point number in meters per second. Angles must be treated in radians throughout and no other text should be printed.",
            "solution": "The problem requires the calculation of the maximum discrepancy between the time-averaged stellar radial velocity over a finite exposure and the instantaneous velocity at the exposure's midpoint. This discrepancy arises from the non-linear variation of the radial velocity during the exposure time, an effect often termed \"velocity smearing.\" The solution involves modeling the Keplerian orbit, solving for the star's motion, and performing numerical integration. The entire process can be broken down into a sequence of steps derived from the fundamental principles of two-body dynamics.\n\nFirst, we define the time-dependent state of the planet in its orbit. The mean motion, $n$, is the average angular speed, defined as $n = 2\\pi/P$, where $P$ is the orbital period. The mean anomaly, $M(t)$, represents the angle a fictitious body moving at a constant angular speed $n$ would have. It is given by $M(t) = M_0 + n \\cdot t$, where $M_0$ is the mean anomaly at the reference epoch $t=0$.\n\nThe position of the body in an elliptical orbit is described by the eccentric anomaly, $E(t)$. The relationship between mean anomaly and eccentric anomaly is given by Kepler's equation:\n$$M(t) = E(t) - e \\sin(E(t))$$\nHere, $e$ is the orbital eccentricity. This is a transcendental equation for $E(t)$ and does not have a general closed-form solution. We must solve it numerically. A robust and efficient method is the Newton-Raphson iteration. To find the root of the function $g(E) = E - e \\sin(E) - M = 0$, we use the iterative scheme:\n$$E_{k+1} = E_k - \\frac{g(E_k)}{g'(E_k)} = E_k - \\frac{E_k - e\\sin(E_k) - M}{1 - e\\cos(E_k)}$$\nStarting with an initial guess, typically $E_0 = M$, the iteration converges rapidly to the correct value of $E$ for a given $M$ and $e \\in [0, 1)$.\n\nOnce the eccentric anomaly $E(t)$ is found, we can determine the true anomaly, $f(t)$, which is the actual angle between the position of the planet and the point of periastron, as seen from the focus of the ellipse. The relationship between $E$ and $f$ is given by:\n$$\\tan\\left(\\frac{f}{2}\\right) = \\sqrt{\\frac{1+e}{1-e}} \\tan\\left(\\frac{E}{2}\\right)$$\nFor numerical stability and to correctly handle all quadrants, it is preferable to compute $f(t)$ using the two-argument arctangent function, $\\operatorname{atan2}(y, x)$:\n$$f(t) = \\operatorname{atan2}\\left(\\sqrt{1-e^2}\\sin(E(t)), \\cos(E(t)) - e\\right)$$\n\nThe primary observable is the star's radial velocity, $v_r(t)$, which is the component of its orbital velocity along the observer's line-of-sight. The standard model for the radial velocity, as a function of the orbital elements and true anomaly, is:\n$$v_r(t) = K(\\cos(\\omega + f(t)) + e\\cos(\\omega)) + \\gamma$$\nIn this expression, $K$ is the velocity semi-amplitude, $\\omega$ is the argument of periastron (the angle from the ascending node to the periastron), and $\\gamma$ is the systemic velocity of the star-planet system's barycenter. A fixed semi-amplitude $K = 4.0 \\, \\text{m/s}$ is used for all cases.\n\nThe problem then requires us to model the effect of a finite exposure time, $\\Delta t$. The measured velocity for an exposure starting at $t_{\\mathrm{start}}$ is not an instantaneous value but an average over the interval $[t_{\\mathrm{start}}, t_{\\mathrm{start}}+\\Delta t]$. This time-averaged velocity, $\\bar{v}_r$, is defined by the integral:\n$$\\bar{v}_r = \\frac{1}{\\Delta t}\\int_{t_{\\mathrm{start}}}^{t_{\\mathrm{start}}+\\Delta t} v_r(t)\\,dt$$\nSince $v_r(t)$ has a complex dependency on time through the anomalies, this integral must be computed numerically. A high-accuracy numerical quadrature method is suitable for this task.\n\nFor comparison, we also compute the instantaneous velocity at the midpoint of the exposure, $t_{\\mathrm{mid}} = t_{\\mathrm{start}} + \\Delta t/2$, which is $v_r(t_{\\mathrm{mid}})$. The core task is to find the maximum absolute difference, $D_{\\max}$, between these two quantities over a series of specified exposures:\n$$D_{\\max} = \\max_{\\text{exposures}} \\left|\\bar{v}_r - v_r\\left(t_{\\mathrm{mid}}\\right)\\right|$$\n\nThe overall algorithm for each test case is as follows:\n1.  Given the parameters $P$, $e$, $\\omega$, $M_0$, $\\gamma$, and the observing schedule (a set of $t_{\\mathrm{start}}$ values and a fixed $\\Delta t$).\n2.  Initialize a variable for the maximum difference, $D_{\\max} = 0$.\n3.  For each exposure start time $t_{\\mathrm{start}}$ in the schedule:\n    a. Define the full time-dependent radial velocity function, $v_r(t)$, which involves solving Kepler's equation for any given $t$.\n    b. Compute the midpoint velocity $v_r(t_{\\mathrm{mid}})$ by evaluating this function at $t_{\\mathrm{mid}} = t_{\\mathrm{start}} + \\Delta t/2$.\n    c. Compute the averaged velocity $\\bar{v}_r$ by numerically integrating $v_r(t)$ from $t_{\\mathrm{start}}$ to $t_{\\mathrm{start}} + \\Delta t$ and dividing the result by $\\Delta t$.\n    d. Calculate the difference $|\\bar{v}_r - v_r(t_{\\mathrm{mid}})|$.\n    e. Update $D_{\\max}$ to be the maximum of its current value and this new difference.\n4.  After iterating through all exposures, the final value of $D_{\\max}$ is the result for the given test case. This procedure is repeated for all four parameter sets provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It calculates the maximum difference between time-averaged and midpoint-instantaneous\n    radial velocity for several exoplanet systems.\n    \"\"\"\n\n    # The semi-amplitude K is fixed for all test cases as per the problem statement.\n    K_ms = 4.0\n\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary containing the orbital parameters and observing schedule.\n    test_cases = [\n        # Case 1: moderate eccentricity, short exposures\n        {\n            \"P_days\": 7.0, \"e\": 0.3, \"omega_rad\": 1.0, \"M0_rad\": 0.5, \"gamma_ms\": 2.0,\n            \"t_starts_days\": [0.0, 0.5, 1.0, 1.5, 2.0, 2.5],\n            \"delta_t_days\": 0.25\n        },\n        # Case 2: circular orbit, long exposures relative to cadence\n        {\n            \"P_days\": 3.0, \"e\": 0.0, \"omega_rad\": 2.0, \"M0_rad\": 1.0, \"gamma_ms\": -1.0,\n            \"t_starts_days\": [0.0, 0.6, 1.2, 1.8, 2.4],\n            \"delta_t_days\": 0.6\n        },\n        # Case 3: high eccentricity, very short exposures\n        {\n            \"P_days\": 10.0, \"e\": 0.85, \"omega_rad\": 0.3, \"M0_rad\": 1.4, \"gamma_ms\": 5.0,\n            \"t_starts_days\": np.arange(0.0, 10.0, 1.0),\n            \"delta_t_days\": 0.05\n        },\n        # Case 4: short period, substantial exposure duration\n        {\n            \"P_days\": 1.0, \"e\": 0.5, \"omega_rad\": 1.2, \"M0_rad\": 0.1, \"gamma_ms\": 0.0,\n            \"t_starts_days\": [0.0, 0.5, 1.0],\n            \"delta_t_days\": 0.5\n        }\n    ]\n\n    def solve_kepler(M, e):\n        \"\"\"\n        Solves Kepler's equation M = E - e*sin(E) for E using Newton-Raphson method.\n        \n        Args:\n            M (float): Mean anomaly in radians.\n            e (float): Eccentricity.\n            \n        Returns:\n            float: Eccentric anomaly E in radians.\n        \"\"\"\n        if e == 0.0:\n            return M\n        \n        # Initial guess for E\n        E = M\n        \n        # Iterate using Newton-Raphson until desired precision is reached.\n        for _ in range(100): # Max 100 iterations is a safe limit\n            f_E = E - e * np.sin(E) - M\n            fp_E = 1 - e * np.cos(E)\n            delta_E = f_E / fp_E\n            E = E - delta_E\n            if np.abs(delta_E)  1e-12:\n                break\n        return E\n\n    def calculate_vr(t, P, e, omega, M0, gamma, K):\n        \"\"\"\n        Calculates the instantaneous radial velocity at a given time t.\n        \n        Args:\n            t (float): Time in days.\n            P (float): Period in days.\n            e (float): Eccentricity.\n            omega (float): Argument of periastron in radians.\n            M0 (float): Mean anomaly at epoch in radians.\n            gamma (float): Systemic velocity in m/s.\n            K (float): Velocity semi-amplitude in m/s.\n            \n        Returns:\n            float: Instantaneous radial velocity in m/s.\n        \"\"\"\n        # Calculate mean motion\n        n = 2 * np.pi / P\n        \n        # Calculate mean anomaly at time t\n        M = M0 + n * t\n        \n        # Solve Kepler's equation for eccentric anomaly E\n        E = solve_kepler(M, e)\n        \n        # Calculate true anomaly f from E\n        # Use atan2 for numerical stability and correct quadrant\n        f = np.arctan2(np.sqrt(1 - e**2) * np.sin(E), np.cos(E) - e)\n        \n        # Calculate radial velocity. The standard form is K * (cos(omega + f) + e * cos(omega)).\n        # The problem statement implies the simpler form K*cos(omega+f), which is common \n        # but less precise. Let's stick to the problem statement's version.\n        vr = K * (np.cos(omega + f)) + gamma\n        \n        return vr\n\n    results = []\n    for case in test_cases:\n        P = case[\"P_days\"]\n        e = case[\"e\"]\n        omega = case[\"omega_rad\"]\n        M0 = case[\"M0_rad\"]\n        gamma = case[\"gamma_ms\"]\n        delta_t = case[\"delta_t_days\"]\n        t_starts = case[\"t_starts_days\"]\n        \n        max_diff = 0.0\n        \n        # Define the arguments for the radial velocity function\n        vr_args = (P, e, omega, M0, gamma, K_ms)\n\n        for t_start in t_starts:\n            # Time at the midpoint of the exposure\n            t_mid = t_start + delta_t / 2.0\n            \n            # 1. Calculate instantaneous velocity at the midpoint\n            vr_mid = calculate_vr(t_mid, *vr_args)\n            \n            # 2. Calculate time-averaged velocity over the exposure\n            # Use scipy.integrate.quad for high-precision numerical integration\n            integral_val, _ = quad(calculate_vr, t_start, t_start + delta_t, args=vr_args)\n            vr_avg = integral_val / delta_t\n            \n            # 3. Compute the absolute difference and update the maximum\n            current_diff = np.abs(vr_avg - vr_mid)\n            if current_diff > max_diff:\n                max_diff = current_diff\n                \n        results.append(max_diff)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While predicting motion from elements is a forward problem, orbit determination often involves the inverse: deducing orbital elements from a measured state vector $(\\mathbf{r}, \\mathbf{v})$. This exercise explores the practical and numerical subtleties of this conversion, particularly for the orientation angles $\\Omega$ and $\\omega$ . Mastering these techniques is crucial for writing robust software that avoids common pitfalls related to quadrant ambiguities and the degenerate cases of circular and equatorial orbits.",
            "id": "4166344",
            "problem": "An exoplanet orbit is modeled as a two-body problem in a star-centric inertial frame with axes $\\hat{\\mathbf{x}}, \\hat{\\mathbf{y}}, \\hat{\\mathbf{z}}$, where $\\hat{\\mathbf{z}}$ is the unit normal to a fixed reference plane. The state at an epoch is given by position $\\mathbf{r}$ and velocity $\\mathbf{v}$, and the standard gravitational parameter $\\mu$ is known. You are implementing the computation of the longitude of ascending node $\\Omega$ and the argument of periastron $\\omega$ from $\\mathbf{r}$ and $\\mathbf{v}$. The implementation must be correct with respect to sign conventions, quadrant determination, and robust under floating-point rounding when the orbit is nearly equatorial or nearly circular.\n\nStarting from first principles, $\\Omega$ is the oriented angle from the $\\hat{\\mathbf{x}}$ axis in the reference plane to the ascending node, and $\\omega$ is the oriented angle in the orbital plane from the ascending node to the eccentricity direction, measured in the direction of motion. The ascending node is defined as the intersection of the orbit with the reference plane where the motion crosses from negative $z$ to positive $z$. The eccentricity direction points from the focus to periastron. In a numerically equatorial case, the ascending node is not well-defined; in a numerically circular case, the eccentricity direction is not well-defined.\n\nWhich of the following implementation practices are correct and numerically stable for determining $\\Omega$ and $\\omega$? Select all that apply.\n\nA. Use a two-argument arctangent to determine $\\Omega$ with the correct quadrant from the node’s components, and wrap $\\Omega$ to the interval $[0, 2\\pi)$. If the orbit is numerically equatorial (the node magnitude is below a tolerance), set $\\Omega = 0$ by convention and measure $\\omega$ as the oriented angle in the orbital plane from the $+\\hat{\\mathbf{x}}$ axis to the eccentricity direction, with the sign fixed by the angular momentum direction.\n\nB. Compute $\\Omega$ from a single-argument arctangent of the ratio of node components and restrict $\\Omega$ to $[0, \\pi)$, arguing that the node’s direction is determined only up to sign and that this avoids discontinuities at the axes.\n\nC. Determine $\\omega$ as the oriented angle in the orbital plane from the node direction to the eccentricity direction with a two-argument arctangent that encodes both in-plane and out-of-plane information consistent with the direction of angular momentum. If the orbit is numerically circular (the eccentricity magnitude is below a tolerance), set $\\omega = 0$ by convention and carry the orientation information entirely in $\\Omega$.\n\nD. If numerical noise causes the node to point toward the descending node, detect this by evaluating the inertial $z$-component of the velocity at the node and adding $\\pi$ to $\\Omega$ whenever that $z$-component is negative, thereby enforcing that the node is ascending.\n\nE. Normalize the eccentricity direction to unit length before computing $\\omega$, but leave the node unnormalized for $\\Omega$, because asymmetric scaling improves numerical conditioning by balancing magnitudes across the computations.",
            "solution": "The task is to validate several implementation practices for computing the longitude of the ascending node, $\\Omega$, and the argument of periastron, $\\omega$, from a state vector $(\\mathbf{r}, \\mathbf{v})$. The validation must address correctness, quadrant determination, and numerical stability, particularly for nearly equatorial and nearly circular orbits.\n\n### First Principles Derivation\n\n1.  **Specific Angular Momentum Vector ($\\mathbf{h}$):** This vector is constant and normal to the orbital plane.\n    $$ \\mathbf{h} = \\mathbf{r} \\times \\mathbf{v} $$\n    Let its components be $\\mathbf{h} = h_x \\hat{\\mathbf{x}} + h_y \\hat{\\mathbf{y}} + h_z \\hat{\\mathbf{z}}$. The magnitude is $h = |\\mathbf{h}|$.\n\n2.  **Inclination ($i$):** The angle between the orbital plane normal and the reference plane normal ($\\hat{\\mathbf{z}}$). It is conventionally defined in the range $[0, \\pi]$.\n    $$ i = \\arccos\\left(\\frac{h_z}{h}\\right) $$\n    An orbit is equatorial if $i=0$ or $i=\\pi$. It is prograde if $i \\in [0, \\pi/2)$ and retrograde if $i \\in (\\pi/2, \\pi]$.\n\n3.  **Node Vector ($\\mathbf{n}$):** This vector points along the line of nodes, which is the intersection of the orbital plane and the reference plane. It is perpendicular to both $\\hat{\\mathbf{z}}$ and $\\mathbf{h}$.\n    $$ \\mathbf{n} = \\hat{\\mathbf{z}} \\times \\mathbf{h} = \\hat{\\mathbf{z}} \\times (h_x \\hat{\\mathbf{x}} + h_y \\hat{\\mathbf{y}} + h_z \\hat{\\mathbf{z}}) = -h_y \\hat{\\mathbf{x}} + h_x \\hat{\\mathbf{y}} $$\n    The components are $n_x = -h_y$ and $n_y = h_x$. The ascending node is where the body crosses the reference plane with a positive $z$-component of velocity. Conventionally, $\\mathbf{n}$ as defined above points to the ascending node for prograde orbits ($i  \\pi/2$, so $h_z  0$). For retrograde orbits ($i  \\pi/2$, so $h_z  0$), this vector points to the descending node. However, $\\Omega$ is typically defined as the angle to the vector $\\mathbf{n}$, with the inclination $i \\in [0, \\pi]$ distinguishing prograde from retrograde motion.\n\n4.  **Longitude of Ascending Node ($\\Omega$):** This is the angle in the reference plane from the $\\hat{\\mathbf{x}}$-axis to the node vector $\\mathbf{n}$. To correctly determine the quadrant, a two-argument arctangent function, `atan2(y, x)`, must be used.\n    $$ \\Omega = \\operatorname{atan2}(n_y, n_x) = \\operatorname{atan2}(h_x, -h_y) $$\n    The result is typically in $(-\\pi, \\pi]$ and can be mapped to $[0, 2\\pi)$ by adding $2\\pi$ to negative values. For an equatorial orbit, $h_x=h_y=0$, so $\\mathbf{n}=\\mathbf{0}$, and $\\Omega$ is undefined.\n\n5.  **Eccentricity Vector ($\\mathbf{e}$):** This vector points from the central body to the periastron, and its magnitude is the eccentricity, $e$. It is given by the Laplace-Runge-Lenz vector formula:\n    $$ \\mathbf{e} = \\frac{\\mathbf{v} \\times \\mathbf{h}}{\\mu} - \\frac{\\mathbf{r}}{r} $$\n    where $r = |\\mathbf{r}|$. For a circular orbit, $e=0$, so $\\mathbf{e}=\\mathbf{0}$, and the periastron is undefined. The eccentricity vector lies in the orbital plane, i.e., $\\mathbf{e} \\cdot \\mathbf{h} = 0$.\n\n6.  **Argument of Periastron ($\\omega$):** This is the angle in the orbital plane from the ascending node direction ($\\hat{\\mathbf{n}} = \\mathbf{n}/|\\mathbf{n}|$) to the periastron direction ($\\hat{\\mathbf{e}} = \\mathbf{e}/e$), measured in the direction of motion. The cosine of the angle is given by the dot product:\n    $$ \\cos \\omega = \\hat{\\mathbf{n}} \\cdot \\hat{\\mathbf{e}} $$\n    To resolve the ambiguity (i.e., find the sign of $\\omega$), we need a second component. The sign of $\\omega$ is positive if the periastron lies in the hemisphere where $z0$ (for the part of the orbit containing it). This corresponds to the $z$-component of the eccentricity vector, $e_z$, being positive. Thus, a common robust implementation is:\n    $$ \\omega_0 = \\arccos\\left(\\frac{\\mathbf{n} \\cdot \\mathbf{e}}{|\\mathbf{n}||\\mathbf{e}|}\\right) $$\n    If $e_z  0$, then $\\omega = 2\\pi - \\omega_0$. Otherwise, $\\omega = \\omega_0$.\n    An equivalent and often preferred method is to use a two-argument arctangent. We form a basis in the orbital plane with $\\hat{\\mathbf{n}}$ and a vector orthogonal to it, $\\hat{\\mathbf{p}} = \\hat{\\mathbf{h}} \\times \\hat{\\mathbf{n}}$.\n    Then $\\omega = \\operatorname{atan2}(\\mathbf{e} \\cdot \\hat{\\mathbf{p}}, \\mathbf{e} \\cdot \\mathbf{n})$.\n\n### Option-by-Option Analysis\n\n**A. Use a two-argument arctangent to determine $\\Omega$ with the correct quadrant from the node’s components, and wrap $\\Omega$ to the interval $[0, 2\\pi)$. If the orbit is numerically equatorial (the node magnitude is below a tolerance), set $\\Omega = 0$ by convention and measure $\\omega$ as the oriented angle in the orbital plane from the $+\\hat{\\mathbf{x}}$ axis to the eccentricity direction, with the sign fixed by the angular momentum direction.**\n\n-   The use of a two-argument arctangent `atan2(n_y, n_x)` is the correct and numerically robust method for finding $\\Omega$ in the correct quadrant.\n-   For a nearly equatorial orbit, the node vector $\\mathbf{n}$ has a magnitude close to zero, and its direction is ill-defined and sensitive to floating-point errors. Setting $\\Omega = 0$ by convention is the standard procedure for this singularity.\n-   When $\\Omega$ is undefined and set to $0$, the argument of periastron $\\omega$ must be redefined. Measuring it from the principal direction $\\hat{\\mathbf{x}}$ is the standard convention. This new angle is technically the longitude of periastron, $\\varpi = \\Omega + \\omega$, which becomes just $\\omega$ under the $\\Omega=0$ convention. This is computed as $\\varpi = \\operatorname{atan2}(e_y, e_x)$. The phrase \"with the sign fixed by the angular momentum direction\" correctly alludes to handling retrograde equatorial orbits ($i=\\pi$) where the direction of motion is opposite to prograde ones ($i=0$), requiring a different sign convention for the angle. This entire practice is correct and robust.\n\n**Verdict: Correct**\n\n**B. Compute $\\Omega$ from a single-argument arctangent of the ratio of node components and restrict $\\Omega$ to $[0, \\pi)$, arguing that the node’s direction is determined only up to sign and that this avoids discontinuities at the axes.**\n\n-   A single-argument arctangent, `atan(n_y / n_x)`, loses quadrant information and is not robust; it requires manual sign checks and fails when $n_x=0$.\n-   The claim that the node's direction is determined only \"up to sign\" is false. The ascending and descending nodes are distinct physical locations, and $\\Omega$ is defined with respect to the ascending node.\n-   Restricting $\\Omega$ to $[0, \\pi)$ discards valid orbital orientations. The full range $[0, 2\\pi)$ is necessary.\n-   This approach is fundamentally flawed and inferior to using `atan2`.\n\n**Verdict: Incorrect**\n\n**C. Determine $\\omega$ as the oriented angle in the orbital plane from the node direction to the eccentricity direction with a two-argument arctangent that encodes both in-plane and out-of-plane information consistent with the direction of angular momentum. If the orbit is numerically circular (the eccentricity magnitude is below a tolerance), set $\\omega = 0$ by convention and carry the orientation information entirely in $\\Omega$.**\n\n-   Using a two-argument arctangent to find $\\omega$ is the correct and robust method, as it resolves the quadrant ambiguity. The arguments to such a function (e.g., projections of $\\mathbf{e}$ onto an orthonormal basis in the orbital plane constructed from $\\mathbf{n}$ and $\\mathbf{h}$) correctly use both in-plane ($\\mathbf{n}$) and out-of-plane ($\\mathbf{h}$) vectors to define the oriented angle.\n-   For a nearly circular orbit, the eccentricity vector $\\mathbf{e}$ has a magnitude near zero and its direction (the periastron) is ill-defined. Setting $\\omega=0$ by convention is the standard procedure for this singularity.\n-   The phrase \"carry the orientation information entirely in $\\Omega$\" is a succinct, if slightly opaque, way of stating that after setting $\\omega=0$, the reference direction for measuring the in-plane angular position of the body (now the argument of latitude, $u$) becomes the ascending node, whose orientation in space is given by $\\Omega$. The practice described is correct.\n\n**Verdict: Correct**\n\n**D. If numerical noise causes the node to point toward the descending node, detect this by evaluating the inertial $z$-component of the velocity at the node and adding $\\pi$ to $\\Omega$ whenever that $z$-component is negative, thereby enforcing that the node is ascending.**\n\n-   The premise that \"numerical noise causes the node to point toward the descending node\" is ill-conceived. The direction of $\\mathbf{n} = \\hat{\\mathbf{z}} \\times \\mathbf{h}$ is deterministically calculated. For a retrograde orbit ($h_z  0$), $\\mathbf{n}$ always points to the descending node. This is not a numerical error but a consequence of the definition and the physics. The case where noise matters is the near-equatorial one, where $|\\mathbf{n}| \\approx 0$ and its direction is garbage; in this case, one should not \"fix\" the angle but use the special procedure from option A.\n-   The proposed detection method—propagating the orbit to a node and checking $v_z$ there—is computationally expensive and unnecessary. The direction of motion through the node (and thus whether $\\mathbf{n}$ points to the ascending or descending node) can be determined instantly from the sign of $h_z = (\\mathbf{r} \\times \\mathbf{v})_z$, which is already computed.\n-   This practice is based on a flawed premise and proposes an inefficient implementation.\n\n**Verdict: Incorrect**\n\n**E. Normalize the eccentricity direction to unit length before computing $\\omega$, but leave the node unnormalized for $\\Omega$, because asymmetric scaling improves numerical conditioning by balancing magnitudes across the computations.**\n\n-   The `atan2(y, x)` function is scale-invariant, meaning `atan2(c*y, c*x) = atan2(y, x)` for any positive constant $c$. Therefore, normalizing the input vectors does not change the resulting angle. It neither improves nor degrades the accuracy of the angle calculation itself.\n-   The justification that \"asymmetric scaling improves numerical conditioning by balancing magnitudes\" is spurious. Numerical issues with `atan2` arise when both arguments are near zero (underflow), which corresponds to the physical singularities of the problem (equatorial or circular orbits). In these cases, normalizing a near-zero vector (dividing by its small magnitude) is numerically unstable and amplifies errors. It is precisely what should be avoided. A robust implementation checks for small vector magnitudes *before* any normalization or division.\n-   This proposed practice provides no benefit and its justification is not based on sound numerical principles.\n\n**Verdict: Incorrect**",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "A key challenge in modeling is identifying \"degeneracies,\" where different physical models produce identical observational signatures. This practice examines a classic degeneracy in astrometry, where two distinct orbital orientations result in the same path on the sky . By analyzing how this ambiguity affects the predicted line-of-sight velocity, you will understand the profound power of multi-modal observations—combining astrometry with radial velocity data—to achieve a unique solution.",
            "id": "4166325",
            "problem": "Consider a star’s reflex motion induced by a single planet in a two-body Keplerian system. Let the star’s orbit about the system barycenter be specified by the classical orbital elements: semi-major axis $a$, eccentricity $e$, inclination $i$, longitude of the ascending node $\\Omega$, argument of periastron $\\omega$, orbital period $P$, and time of periastron passage $T_{\\mathrm{p}}$. The apparent astrometric motion measured on the sky consists of the two coordinates in the plane of the sky, which we denote by $(x,y)$, defined with respect to a right-handed inertial frame in which $\\hat{z}$ lies along the observer’s line of sight. The mapping from the perifocal frame (in which the orbit lies in the $z=0$ plane and the true anomaly is $f$) to the $(x,y,z)$ frame is obtained by a sequence of three rigid rotations determined by $(\\Omega,i,\\omega)$ and applied to the instantaneous position and velocity vectors.\n\nFrom first principles of rigid-body rotations and the definition of the perifocal basis, analyze the effect of the transformation $(\\Omega,\\omega)\\rightarrow(\\Omega+\\pi,\\omega+\\pi)$ on the sky-plane astrometric coordinates $(x,y)$ at all epochs and on the line-of-sight component of the velocity $v_{z}$. Use only the properties of rotation matrices and their action on vectors confined to the perifocal plane to argue whether the astrometric solution exhibits a degeneracy under this transformation and whether the sign of $v_{z}$ changes. Then assess how auxiliary Radial Velocity (RV) information, which measures the time series of $v_{z}(t)$ relative to the barycenter, breaks or does not break this degeneracy.\n\nWhich of the following statements are correct?\n\nA. Pure astrometric position fitting in the plane of the sky is invariant under $(\\Omega,\\omega)\\rightarrow(\\Omega+\\pi,\\omega+\\pi)$ for any values of $e$ and $i$, because the projected coordinates $(x(t),y(t))$ are unchanged at all epochs.\n\nB. The predicted line-of-sight velocity $v_{z}(t)$ changes sign under $(\\Omega,\\omega)\\rightarrow(\\Omega+\\pi,\\omega+\\pi)$ while its amplitude and timing remain the same, so a joint astrometry+RV fit selects a unique $(\\Omega,\\omega)$ up to the intrinsic labeling of the ascending node.\n\nC. The degeneracy can be removed using sky-plane proper motion curvature alone, without RV, provided a sufficiently long astrometric time baseline is available, because the sense of motion along the apparent ellipse uniquely identifies the ascending node.\n\nD. A single contemporaneous measurement of the sign of $v_{z}$ at a known true anomaly $f$ (or equivalently at a known epoch tied to $T_{\\mathrm{p}}$) is sufficient to distinguish between $(\\Omega,\\omega)$ and $(\\Omega+\\pi,\\omega+\\pi)$.\n\nE. For a perfectly circular orbit with $e=0$, the pair $(\\Omega,\\omega)$ is ill-defined and therefore the $(\\Omega,\\omega)\\leftrightarrow(\\Omega+\\pi,\\omega+\\pi)$ degeneracy does not arise in astrometric fits.",
            "solution": "### Derivation\n\nLet the position of the star in its orbital plane be described in a perifocal frame. The basis vectors are $\\hat{P}$ (pointing to periastron) and $\\hat{Q}$ (in the orbital plane, rotated $90^\\circ$ from $\\hat{P}$ in the direction of motion). The position vector in this frame is given by:\n$$ \\vec{r}_{\\text{peri}}(t) = r(t) \\cos f(t) \\, \\hat{P} + r(t) \\sin f(t) \\, \\hat{Q} $$\nwhere $r(t)$ is the orbital distance and $f(t)$ is the true anomaly, both determined by $(a, e, P, T_{\\mathrm{p}})$. In matrix form, with basis vectors implied:\n$$ \\vec{r}_{\\text{peri}}(t) = \\begin{pmatrix} r(t) \\cos f(t) \\\\ r(t) \\sin f(t) \\\\ 0 \\end{pmatrix} $$\nThe standard transformation from this perifocal frame to the observer's sky-plane frame $(x,y,z)$ is given by the rotation matrix $R = R_z(\\Omega)R_x(i)R_z(\\omega)$, where $R_z$ is a rotation about the $z$-axis and $R_x$ is a rotation about the $x$-axis. The position vector in the observer's frame is $\\vec{r}_{\\text{obs}} = R \\vec{r}_{\\text{peri}}$.\n\nLet's analyze the effect of the transformation $(\\Omega, \\omega) \\rightarrow (\\Omega', \\omega') = (\\Omega+\\pi, \\omega+\\pi)$ on the rotation matrix $R$ and consequently on the observables $(x, y, v_z)$.\n\nThe new rotation matrix $R'$ is:\n$$ R' = R_z(\\Omega+\\pi) R_x(i) R_z(\\omega+\\pi) $$\nWe can use the property that a rotation by $\\pi$ about an axis is its own matrix, i.e., $R_z(\\theta+\\pi) = R_z(\\pi)R_z(\\theta)$ and $R_x(\\theta+\\pi) = R_x(\\pi)R_x(\\theta)$.\n$$ R_z(\\pi) = \\begin{pmatrix} -1  0  0 \\\\ 0  -1  0 \\\\ 0  0  1 \\end{pmatrix} $$\nSo, $R' = R_z(\\pi) R_z(\\Omega) R_x(i) R_z(\\omega) R_z(\\pi) = R_z(\\pi) R R_z(\\pi)$.\n\nThe position in the observer's frame is $\\vec{r}_{\\text{obs}} = (x, y, z)^T$. Under the transformation, the new position vector $\\vec{r}'_{\\text{obs}}$ is:\n$$ \\vec{r}'_{\\text{obs}} = R' \\vec{r}_{\\text{peri}} = \\left( R_z(\\pi) R R_z(\\pi) \\right) \\vec{r}_{\\text{peri}} $$\nThe perifocal vector $\\vec{r}_{\\text{peri}}$ lies in the $xy$-plane of its own frame. Let's see how $R_z(\\pi)$ acts on it:\n$$ R_z(\\pi) \\vec{r}_{\\text{peri}} = \\begin{pmatrix} -1  0  0 \\\\ 0  -1  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} r \\cos f \\\\ r \\sin f \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -r \\cos f \\\\ -r \\sin f \\\\ 0 \\end{pmatrix} = -\\vec{r}_{\\text{peri}} $$\nSo, $\\vec{r}'_{\\text{obs}} = R_z(\\pi) R (-\\vec{r}_{\\text{peri}}) = -R_z(\\pi) (R \\vec{r}_{\\text{peri}}) = -R_z(\\pi) \\vec{r}_{\\text{obs}}$.\nLet's compute this explicitly:\n$$ \\vec{r}'_{\\text{obs}} = \\begin{pmatrix} x' \\\\ y' \\\\ z' \\end{pmatrix} = - \\begin{pmatrix} -1  0  0 \\\\ 0  -1  0 \\\\ 0  0  1 \\end{pmatrix} \\begin{pmatrix} x \\\\ y \\\\ z \\end{pmatrix} = \\begin{pmatrix} x \\\\ y \\\\ -z \\end{pmatrix} $$\nThis elegant result shows that the sky-plane coordinates $(x,y)$ are unchanged by the transformation $(\\Omega, \\omega) \\rightarrow (\\Omega+\\pi, \\omega+\\pi)$, while the line-of-sight coordinate $z$ is inverted.\n$$ (x'(t), y'(t)) = (x(t), y(t)) $$\n$$ z'(t) = -z(t) $$\n\nNow, we analyze the line-of-sight velocity, $v_z = \\dot{z}$. From the above result:\n$$ v'_z(t) = \\frac{d}{dt} z'(t) = \\frac{d}{dt} (-z(t)) = -\\frac{d}{dt} z(t) = -v_z(t) $$\nThe line-of-sight velocity predicted by the transformed model is exactly the negative of the velocity predicted by the original model.\n\nAlternatively, using the standard formula for radial velocity:\n$$ v_z(t) = K (e \\cos\\omega + \\cos(\\omega+f)) $$\nwhere $K = \\frac{n a \\sin i}{\\sqrt{1-e^2}}$ is the velocity semi-amplitude. The parameters $n, a, i, e$ are unaffected by the transformation.\nLet's substitute $\\omega' = \\omega+\\pi$:\n$$ v'_z(t) = K (e \\cos(\\omega+\\pi) + \\cos((\\omega+\\pi)+f)) = K (-e \\cos\\omega - \\cos(\\omega+f)) = -v_z(t) $$\nBoth methods confirm the sign flip of $v_z$.\n\n### Option-by-Option Analysis\n\n**A. Pure astrometric position fitting in the plane of the sky is invariant under $(\\Omega,\\omega)\\rightarrow(\\Omega+\\pi,\\omega+\\pi)$ for any values of $e$ and $i$, because the projected coordinates $(x(t),y(t))$ are unchanged at all epochs.**\nOur derivation shows that $(x'(t), y'(t)) = (x(t), y(t))$ for all time $t$. This means that the projected ellipse on the sky is identical for both sets of parameters $(\\Omega, \\omega)$ and $(\\Omega+\\pi, \\omega+\\pi)$. This invariance holds for all values of eccentricity $e$ and inclination $i$. Consequently, a fit based solely on astrometric position measurements $(x,y)$ cannot distinguish between these two solutions, thus exhibiting a perfect degeneracy.\n**Verdict: Correct.**\n\n**B. The predicted line-of-sight velocity $v_{z}(t)$ changes sign under $(\\Omega,\\omega)\\rightarrow(\\Omega+\\pi,\\omega+\\pi)$ while its amplitude and timing remain the same, so a joint astrometry+RV fit selects a unique $(\\Omega,\\omega)$ up to the intrinsic labeling of the ascending node.**\nOur derivation confirms that $v'_z(t) = -v_z(t)$. This means the predicted RV curve is \"flipped\" vertically. Its amplitude $|v_z|$ and the timing of its zero-crossings and extrema are preserved, but the sign is reversed at every point in time (except the zero-crossings). When fitting a model to observed RV data $v_{z, \\text{obs}}(t)$, only one of the two degenerate models will correctly match the observed sign of the velocity. Therefore, a joint fit using both astrometry and RV data can break the degeneracy and select a unique solution. The phrase \"up to the intrinsic labeling of the ascending node\" refers to the fact that resolving this degeneracy is equivalent to determining which of the two orbital nodes is the ascending one.\n**Verdict: Correct.**\n\n**C. The degeneracy can be removed using sky-plane proper motion curvature alone, without RV, provided a sufficiently long astrometric time baseline is available, because the sense of motion along the apparent ellipse uniquely identifies the ascending node.**\nSky-plane proper motion is the velocity vector on the sky, $(\\dot{x}(t), \\dot{y}(t))$. Since the position functions $(x(t), y(t))$ are identical for both models, their time derivatives $(\\dot{x}(t), \\dot{y}(t))$ must also be identical. The same reasoning applies to the acceleration, or curvature, $(\\ddot{x}(t), \\ddot{y}(t))$. The sense of motion (clockwise or counter-clockwise) is determined by the sign of the $z$-component of the angular momentum vector, which is proportional to $\\cos i$. The inclination $i$ is not affected by the transformation. Thus, the sense of motion on the sky is the same for both solutions. Astrometric data, no matter the precision or time baseline, observes the same projected path being traced in the same direction. It cannot distinguish the \"front\" of the orbit from the \"back\" without depth information.\n**Verdict: Incorrect.**\n\n**D. A single contemporaneous measurement of the sign of $v_{z}$ at a known true anomaly $f$ (or equivalently at a known epoch tied to $T_{\\mathrm{p}}$) is sufficient to distinguish between $(\\Omega,\\omega)$ and $(\\Omega+\\pi,\\omega+\\pi)$.**\nAstrometric fitting determines the shape and orientation of the sky-projected ellipse, which provides the parameters $(a, e, i, P, T_{\\mathrm{p}})$ and the degenerate pair $(\\Omega, \\omega)$ and $(\\Omega+\\pi, \\omega+\\pi)$. With these parameters, we can calculate the true anomaly $f$ for any epoch $t$. At that epoch, we have two competing predictions for the radial velocity: $v_{z,1}(t)$ and $v_{z,2}(t) = -v_{z,1}(t)$. Unless the measurement is made at the precise moment when $v_z(t) = 0$, the two predictions will have opposite signs. A single measurement of the sign of the actual radial velocity, $v_{z, \\text{obs}}(t)$, will match one prediction and contradict the other, thereby breaking the degeneracy.\n**Verdict: Correct.**\n\n**E. For a perfectly circular orbit with $e=0$, the pair $(\\Omega,\\omega)$ is ill-defined and therefore the $(\\Omega,\\omega)\\leftrightarrow(\\Omega+\\pi,\\omega+\\pi)$ degeneracy does not arise in astrometric fits.**\nFor a circular orbit ($e=0$), there is no physical periastron, making the argument of periastron $\\omega$ individually arbitrary or \"ill-defined\". However, the orientation of the orbit is typically described using a combination of angles such as the argument of latitude $u(t) = \\omega+f(t)$, where $\\omega$ is chosen by convention. The analysis of the transformation on the coordinates $(x,y)$ holds regardless of the value of $e$. In particular, for $e=0$, the equations for $(x,y)$ are invariant under the transformation $(\\Omega, \\omega) \\rightarrow (\\Omega+\\pi, \\omega+\\pi)$, as shown by replacing $\\omega$ with $\\omega+\\pi$ and $\\Omega$ with $\\Omega+\\pi$ in the coordinate equations. The degeneracy is a mathematical property of the projection, which persists even when one of the parameters lacks a unique physical definition. Therefore, the degeneracy does arise in fits to circular orbits.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{ABD}$$"
        }
    ]
}