{
    "hands_on_practices": [
        {
            "introduction": "Before constructing complex atmospheric models, it is essential to master the fundamental principles governing how radiation interacts with a gaseous medium. This interaction is quantified by the optical depth, $\\tau$. This first exercise connects the macroscopic structure of an atmosphere in hydrostatic equilibrium to its optical depth, laying the groundwork for all radiative transfer calculations. By deriving the relationship between pressure $p$ and $\\tau$ from first principles, you will gain a foundational understanding of where in an atmosphere radiation is primarily absorbed and emitted, and what defines the effective \"visible surface,\" or photosphere, of a planet .",
            "id": "4174953",
            "problem": "Consider a plane-parallel, isothermal hydrogen atmosphere in hydrostatic equilibrium on a giant exoplanet. The atmosphere has a constant scale height $H$ and a vertically uniform absorber with band-mean extinction coefficient that is proportional to the local mass density. In a selected narrow spectral band, the band-mean extinction coefficient per unit length at a reference pressure $p_{\\mathrm{ref}}$ is $k_{\\nu,0}$, and for any height $z$ the local extinction coefficient is $k_{\\nu}(z) = k_{\\nu,0}\\,p(z)/p_{\\mathrm{ref}}$. Assume constant temperature in the band so that the scale height $H$ is constant, and assume a constant absorber mixing ratio.\n\nStarting only from the definitions of optical depth, hydrostatic balance, and the isothermal scale height relation, derive an expression for the vertical optical depth $\\tau_{\\nu}(p)$ from the top of the atmosphere down to a level of pressure $p$ in terms of $k_{\\nu,0}$, $H$, and $p/p_{\\mathrm{ref}}$. Then, using this expression:\n\n- Compute the vertical optical depth at $p = 1\\,\\mathrm{bar}$.\n- Determine the pressure level $p^{\\ast}$ at which $\\tau_{\\nu}(p^{\\ast}) = 1$.\n\nUse the following values: $H = 27.5\\,\\mathrm{km}$, $p_{\\mathrm{ref}} = 1.0\\,\\mathrm{bar}$, and $k_{\\nu,0} = 3.20 \\times 10^{-5}\\,\\mathrm{m}^{-1}$ at $p_{\\mathrm{ref}}$. Express $p^{\\ast}$ in $\\mathrm{bar}$. Round both the optical depth at $1\\,\\mathrm{bar}$ and $p^{\\ast}$ to three significant figures. The final answer must be a single row containing the two values in the order $\\left(\\tau_{\\nu}(1\\,\\mathrm{bar}),\\,p^{\\ast}\\right)$.",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of atmospheric physics, is well-posed with a clear objective, and is free from inconsistencies or ambiguities.\n\nThe objective is to derive an expression for the vertical optical depth $\\tau_{\\nu}(p)$ as a function of pressure $p$, and then use it to compute two specific quantities. The derivation begins from fundamental definitions.\n\nThe vertical optical depth $\\tau_{\\nu}$ is defined by its differential, integrated from the top of the atmosphere (where pressure $p \\to 0$ and altitude $z \\to \\infty$) down to a specific level. The differential element of optical depth, $d\\tau_{\\nu}$, along a vertical path $dz$ is given by:\n$$d\\tau_{\\nu} = -k_{\\nu}(z) dz$$\nwhere $k_{\\nu}(z)$ is the extinction coefficient at altitude $z$. The negative sign indicates that optical depth increases as one moves downwards (decreasing $z$).\n\nThe problem states that the atmosphere is in hydrostatic equilibrium. The equation for hydrostatic balance is:\n$$\\frac{dp}{dz} = -\\rho(z) g$$\nwhere $p(z)$ is the pressure, $\\rho(z)$ is the mass density, and $g$ is the acceleration due to gravity, assumed to be constant over the relevant atmospheric heights.\n\nThe atmosphere is also stated to be isothermal. For an ideal gas at constant temperature $T$, the pressure and density are related by $p = \\rho R_s T$, where $R_s$ is the specific gas constant. This can be rewritten as $\\rho(z) = \\frac{p(z)}{R_s T}$. Substituting this into the hydrostatic balance equation gives:\n$$\\frac{dp}{dz} = -\\frac{g}{R_s T} p(z)$$\nThe quantity $\\frac{R_s T}{g}$ has units of length and is defined as the pressure scale height, $H$. Thus, $H = \\frac{R_s T}{g}$. The equation becomes:\n$$\\frac{dp}{dz} = -\\frac{p(z)}{H}$$\nFrom this, we can express the differential height element $dz$ in terms of the differential pressure element $dp$:\n$$dz = -H \\frac{dp}{p}$$\n\nNow we can express the optical depth differential $d\\tau_{\\nu}$ in terms of pressure. We are given the relation for the extinction coefficient:\n$$k_{\\nu}(z) = k_{\\nu,0} \\frac{p(z)}{p_{\\mathrm{ref}}}$$\nSubstituting the expressions for $k_{\\nu}(z)$ and $dz$ into the definition of $d\\tau_{\\nu}$:\n$$d\\tau_{\\nu} = -\\left(k_{\\nu,0} \\frac{p}{p_{\\mathrm{ref}}}\\right) \\left(-H \\frac{dp}{p}\\right)$$\nThe pressure $p$ in the numerator and denominator cancels out, leading to a simplified expression:\n$$d\\tau_{\\nu} = \\frac{k_{\\nu,0} H}{p_{\\mathrm{ref}}} dp$$\nTo find the total optical depth $\\tau_{\\nu}(p)$ from the top of the atmosphere (where pressure is $0$) down to a level with pressure $p$, we integrate $d\\tau_{\\nu}$:\n$$\\tau_{\\nu}(p) = \\int_{0}^{p} \\frac{k_{\\nu,0} H}{p_{\\mathrm{ref}}} dp'$$\nSince $k_{\\nu,0}$, $H$, and $p_{\\mathrm{ref}}$ are constants, the integral is straightforward:\n$$\\tau_{\\nu}(p) = \\frac{k_{\\nu,0} H}{p_{\\mathrm{ref}}} \\int_{0}^{p} dp' = \\frac{k_{\\nu,0} H}{p_{\\mathrm{ref}}} [p']_{0}^{p}$$\nThis yields the final expression for the vertical optical depth as a function of pressure:\n$$\\tau_{\\nu}(p) = \\frac{k_{\\nu,0} H p}{p_{\\mathrm{ref}}}$$\nThis can also be written as $\\tau_{\\nu}(p) = (k_{\\nu,0} H) \\left(\\frac{p}{p_{\\mathrm{ref}}}\\right)$.\n\nWith this expression, we can compute the required values using the provided data: $H = 27.5\\,\\mathrm{km}$, $p_{\\mathrm{ref}} = 1.0\\,\\mathrm{bar}$, and $k_{\\nu,0} = 3.20 \\times 10^{-5}\\,\\mathrm{m}^{-1}$.\n\nFirst, we compute the vertical optical depth at $p = 1\\,\\mathrm{bar}$.\nAt $p = 1.0\\,\\mathrm{bar}$, the ratio $p/p_{\\mathrm{ref}} = 1.0\\,\\mathrm{bar} / 1.0\\,\\mathrm{bar} = 1$. The optical depth is:\n$$\\tau_{\\nu}(1\\,\\mathrm{bar}) = k_{\\nu,0} H$$\nWe must use consistent units. The scale height $H$ is given in kilometers, so we convert it to meters: $H = 27.5\\,\\mathrm{km} = 27.5 \\times 10^3\\,\\mathrm{m}$.\n$$\\tau_{\\nu}(1\\,\\mathrm{bar}) = (3.20 \\times 10^{-5}\\,\\mathrm{m}^{-1}) \\times (27.5 \\times 10^3\\,\\mathrm{m})$$\n$$\\tau_{\\nu}(1\\,\\mathrm{bar}) = 3.20 \\times 27.5 \\times 10^{-2} = 88.0 \\times 10^{-2} = 0.88$$\nRounding to three significant figures, the result is $0.880$. This is a dimensionless quantity, as expected for optical depth.\n\nSecond, we determine the pressure level $p^{\\ast}$ at which the optical depth is unity, i.e., $\\tau_{\\nu}(p^{\\ast}) = 1$.\nUsing the derived formula:\n$$1 = \\frac{k_{\\nu,0} H p^{\\ast}}{p_{\\mathrm{ref}}}$$\nSolving for $p^{\\ast}$:\n$$p^{\\ast} = p_{\\mathrm{ref}} \\frac{1}{k_{\\nu,0} H}$$\nWe have already calculated the value of the product $k_{\\nu,0} H = 0.880$.\n$$p^{\\ast} = (1.0\\,\\mathrm{bar}) \\times \\frac{1}{0.880}$$\n$$p^{\\ast} \\approx 1.13636... \\,\\mathrm{bar}$$\nRounding to three significant figures, we get:\n$$p^{\\ast} = 1.14\\,\\mathrm{bar}$$\n\nThe two values to be reported are the optical depth at $1\\,\\mathrm{bar}$ and the pressure $p^{\\ast}$ at which optical depth is unity.\n$\\tau_{\\nu}(1\\,\\mathrm{bar}) = 0.880$\n$p^{\\ast} = 1.14\\,\\mathrm{bar}$",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.880  1.14 \\end{pmatrix}}$$"
        },
        {
            "introduction": "An atmosphere governed solely by radiative transfer is not always stable. If the resulting temperature decrease with height is too rapid, the fluid becomes unstable and begins to convect, a process that fundamentally alters the thermal structure. This practice focuses on the Schwarzschild criterion, the critical condition for the onset of convection. You will derive the dimensionless radiative temperature gradient, $\\nabla_{\\mathrm{rad}}$, and compare it with the adiabatic gradient, $\\nabla_{\\mathrm{ad}}$, to diagnose atmospheric stability . Mastering this concept is crucial for understanding why atmospheres develop distinct layers like a troposphere and stratosphere, providing the essential \"switch\" in any radiative-convective model.",
            "id": "4174979",
            "problem": "Consider a one-dimensional, plane-parallel atmosphere of a giant planet in steady state, with a constant vertical radiative flux $F$ and constant gravitational acceleration $g$. Assume local thermodynamic equilibrium and the radiative diffusion approximation applies. The vertical coordinate is $z$, pressure is $P(z)$, temperature is $T(z)$, density is $\\rho(z)$, and the Rosseland mean opacity is $\\kappa(P,T)$. Convection sets in according to the Schwarzschild criterion when the dimensionless radiative temperature gradient $\\nabla_{\\mathrm{rad}}$ exceeds the dimensionless adiabatic gradient $\\nabla_{\\mathrm{ad}}$.\n\nStarting only from the following fundamental base:\n- Hydrostatic equilibrium: $\\dfrac{dP}{dz} = -\\rho g$.\n- Radiative diffusion for net flux: $F = -\\dfrac{16 \\sigma T^3}{3 \\kappa \\rho} \\dfrac{dT}{dz}$, where $\\sigma$ is the Stefan–Boltzmann constant.\n- Definition of the dimensionless temperature gradient: $\\nabla \\equiv \\dfrac{d \\ln T}{d \\ln P}$.\n- Ideal-gas adiabatic gradient for a constant adiabatic index $\\gamma$ (ratio of specific heats): $\\nabla_{\\mathrm{ad}} = \\dfrac{\\gamma - 1}{\\gamma}$.\n\nDerive an expression for the radiative gradient $\\nabla_{\\mathrm{rad}}$ in terms of $P$, $T$, $\\kappa$, $F$, $g$, and physical constants, and then use it to determine the onset of convection in the given test atmospheres by finding the shallowest pressure level where $\\nabla_{\\mathrm{rad}} \\ge \\nabla_{\\mathrm{ad}}$.\n\nFor opacity, use a pressure–temperature power-law:\n$$\n\\kappa(P,T) = \\kappa_0 \\left( \\dfrac{P}{P_{\\mathrm{ref}}} \\right)^{a} \\left( \\dfrac{T}{T_{\\mathrm{ref}}} \\right)^{b},\n$$\nwith $P_{\\mathrm{ref}} = 10^5 \\ \\mathrm{Pa}$ and $T_{\\mathrm{ref}} = 1000 \\ \\mathrm{K}$. The adiabatic index $\\gamma$ is treated as a constant per test case.\n\nCompute $\\nabla_{\\mathrm{rad}}(P_i,T_i)$ on the following logarithmically spaced pressure grids for each test case, and compare to $\\nabla_{\\mathrm{ad}}$ to determine the first (smallest $P$) level where convection would onset. If no level is convectively unstable, report $-1$.\n\nAll physical quantities must use the following units: $P$ in $\\mathrm{Pa}$, $T$ in $\\mathrm{K}$, $F$ in $\\mathrm{W} \\ \\mathrm{m}^{-2}$, $g$ in $\\mathrm{m} \\ \\mathrm{s}^{-2}$, and $\\kappa$ in $\\mathrm{m}^2 \\ \\mathrm{kg}^{-1}$. Angles are not used in this problem. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., [$p_1,p_2,p_3]$), where each $p_i$ is the pressure in $\\mathrm{Pa}$ of the shallowest convectively unstable level for the corresponding test case, or $-1$ if none.\n\nTest suite:\n- Case A (giant planet with weak internal flux):\n  - $g = 24.79 \\ \\mathrm{m} \\ \\mathrm{s}^{-2}$, $F = 6 \\ \\mathrm{W} \\ \\mathrm{m}^{-2}$, $\\gamma = 1.4$.\n  - Opacity parameters: $\\kappa_0 = 2 \\times 10^{-2} \\ \\mathrm{m}^2 \\ \\mathrm{kg}^{-1}$, $a = 0.5$, $b = 1.0$.\n  - Pressure grid: $N = 12$ levels, logarithmically spaced from $P_{\\min} = 10^4 \\ \\mathrm{Pa}$ to $P_{\\max} = 10^7 \\ \\mathrm{Pa}$.\n  - Temperature profile: $T(P) = T_0 \\left( \\dfrac{P}{P_0} \\right)^{\\alpha}$, with $T_0 = 130 \\ \\mathrm{K}$, $P_0 = 10^4 \\ \\mathrm{Pa}$, $\\alpha = 0.25$.\n- Case B (strongly irradiated hot Jupiter):\n  - $g = 20 \\ \\mathrm{m} \\ \\mathrm{s}^{-2}$, $F = 1500 \\ \\mathrm{W} \\ \\mathrm{m}^{-2}$, $\\gamma = 1.42$.\n  - Opacity parameters: $\\kappa_0 = 5 \\times 10^{-2} \\ \\mathrm{m}^2 \\ \\mathrm{kg}^{-1}$, $a = 1.0$, $b = 0.0$.\n  - Pressure grid: $N = 12$ levels, logarithmically spaced from $P_{\\min} = 10^4 \\ \\mathrm{Pa}$ to $P_{\\max} = 10^7 \\ \\mathrm{Pa}$.\n  - Temperature profile: $T(P) = T_0 \\left( \\dfrac{P}{P_0} \\right)^{\\alpha}$, with $T_0 = 1000 \\ \\mathrm{K}$, $P_0 = 10^4 \\ \\mathrm{Pa}$, $\\alpha = 0.05$.\n- Case C (intermediate flux with mixed opacity dependence):\n  - $g = 30 \\ \\mathrm{m} \\ \\mathrm{s}^{-2}$, $F = 200 \\ \\mathrm{W} \\ \\mathrm{m}^{-2}$, $\\gamma = 1.35$.\n  - Opacity parameters: $\\kappa_0 = 3 \\times 10^{-2} \\ \\mathrm{m}^2 \\ \\mathrm{kg}^{-1}$, $a = 0.7$, $b = 0.7$.\n  - Pressure grid: $N = 12$ levels, logarithmically spaced from $P_{\\min} = 10^4 \\ \\mathrm{Pa}$ to $P_{\\max} = 10^7 \\ \\mathrm{Pa}$.\n  - Temperature profile: $T(P) = T_0 \\left( \\dfrac{P}{P_0} \\right)^{\\alpha}$, with $T_0 = 300 \\ \\mathrm{K}$, $P_0 = 10^4 \\ \\mathrm{Pa}$, $\\alpha = 0.20$.\n\nAlgorithmic requirements:\n- Derive $\\nabla_{\\mathrm{rad}}$ using the provided fundamental laws and definitions, without introducing any other shortcut formulas.\n- For each test case, evaluate $\\nabla_{\\mathrm{rad}}$ at each grid level using the specified $\\kappa(P,T)$, $P$, $T$, $F$, and $g$.\n- Compute $\\nabla_{\\mathrm{ad}}$ from $\\gamma$ for each test case.\n- Determine the shallowest pressure level where $\\nabla_{\\mathrm{rad}} \\ge \\nabla_{\\mathrm{ad}}$. If no such level exists, return $-1$ for that case.\n\nFinal output format:\n- Your program should print a single line containing a list with three entries, one per test case, formatted exactly as [$p_A,p_B,p_C$], where each $p_X$ is either a floating-point pressure in $\\mathrm{Pa}$ of the onset of convection (the smallest $P$ satisfying $\\nabla_{\\mathrm{rad}} \\ge \\nabla_{\\mathrm{ad}}$) or the integer $-1$ if no level is unstable.",
            "solution": "The user-provided problem has been rigorously validated and is determined to be a valid, well-posed scientific problem. It is scientifically grounded in the principles of atmospheric physics, is objective in its formulation, and is self-contained, providing all necessary information for a unique solution. The problem requires the derivation of a key physical quantity and its subsequent numerical evaluation under specified conditions, which is a standard and meaningful exercise in planetary science.\n\nThe core of the problem is to determine the onset of convection in a planetary atmosphere. Convection begins when a parcel of gas, if displaced vertically, becomes less dense than its surroundings and continues to rise. This condition is described by the Schwarzschild criterion, which states that the atmosphere is unstable to convection if the actual temperature gradient is steeper than the adiabatic temperature gradient. In terms of dimensionless gradients, this criterion is $\\nabla_{\\mathrm{rad}} \\ge \\nabla_{\\mathrm{ad}}$. Our task is to derive an expression for the radiative gradient, $\\nabla_{\\mathrm{rad}}$, and then apply this criterion to the given test cases.\n\nFirst, we derive the expression for the radiative gradient, $\\nabla_{\\mathrm{rad}}$. The definition of the dimensionless temperature gradient is given as:\n$$\n\\nabla \\equiv \\dfrac{d \\ln T}{d \\ln P}\n$$\nThe radiative gradient, $\\nabla_{\\mathrm{rad}}$, is this quantity when the temperature structure is determined solely by radiative transport. Using the chain rule, we can write:\n$$\n\\nabla_{\\mathrm{rad}} = \\dfrac{d \\ln T}{d \\ln P} = \\dfrac{P}{T} \\dfrac{dT}{dP}\n$$\nTo find the derivative of temperature with respect to pressure, $\\dfrac{dT}{dP}$, we use the chain rule again, this time with respect to the vertical coordinate $z$:\n$$\n\\dfrac{dT}{dP} = \\dfrac{dT}{dz} \\dfrac{dz}{dP}\n$$\nThe problem provides the two fundamental equations needed to find $\\dfrac{dT}{dz}$ and $\\dfrac{dz}{dP}$.\n\nFrom the equation of hydrostatic equilibrium:\n$$\n\\dfrac{dP}{dz} = -\\rho g\n$$\nwe can find $\\dfrac{dz}{dP}$ by taking the reciprocal:\n$$\n\\dfrac{dz}{dP} = -\\dfrac{1}{\\rho g}\n$$\nFrom the radiative diffusion equation for net flux $F$:\n$$\nF = -\\dfrac{16 \\sigma T^3}{3 \\kappa \\rho} \\dfrac{dT}{dz}\n$$\nwe can solve for the physical temperature gradient, $\\dfrac{dT}{dz}$:\n$$\n\\dfrac{dT}{dz} = -\\dfrac{3 \\kappa \\rho F}{16 \\sigma T^3}\n$$\nNow, we substitute these two expressions back into the equation for $\\dfrac{dT}{dP}$:\n$$\n\\dfrac{dT}{dP} = \\left( -\\dfrac{3 \\kappa \\rho F}{16 \\sigma T^3} \\right) \\left( -\\dfrac{1}{\\rho g} \\right) = \\dfrac{3 \\kappa F}{16 \\sigma g T^3}\n$$\nNotably, the density $\\rho$ cancels out, which simplifies the expression and removes the need for an equation of state to determine $\\rho$.\n\nFinally, we substitute this result for $\\dfrac{dT}{dP}$ into our definition of $\\nabla_{\\mathrm{rad}}$:\n$$\n\\nabla_{\\mathrm{rad}} = \\dfrac{P}{T} \\left( \\dfrac{3 \\kappa F}{16 \\sigma g T^3} \\right)\n$$\nThis gives the final, derived expression for the radiative gradient in terms of the required variables:\n$$\n\\nabla_{\\mathrm{rad}} = \\dfrac{3 F \\kappa P}{16 g \\sigma T^4}\n$$\n\nThe algorithmic procedure to solve the problem is as follows:\nFor each test case, we are given a set of atmospheric parameters ($g$, $F$, $\\gamma$), opacity parameters ($\\kappa_0$, $a$, $b$), a pressure grid specification ($P_{\\min}$, $P_{\\max}$, $N$), and a temperature-pressure profile ($T_0$, $P_0$, $\\alpha$).\n\n1.  Calculate the adiabatic gradient, $\\nabla_{\\mathrm{ad}}$. This value is constant for each case, as $\\gamma$ is constant:\n    $$\n    \\nabla_{\\mathrm{ad}} = \\dfrac{\\gamma - 1}{\\gamma}\n    $$\n2.  Generate a logarithmically spaced pressure grid of $N$ points from $P_{\\min}$ to $P_{\\max}$.\n3.  Iterate through the pressure grid points, $P_i$, in increasing order of pressure.\n4.  For each pressure level $P_i$:\n    a. Calculate the corresponding temperature $T_i$ using the given profile:\n       $$\n       T_i = T_0 \\left( \\dfrac{P_i}{P_0} \\right)^{\\alpha}\n       $$\n    b. Calculate the Rosseland mean opacity $\\kappa_i$ at that level using the power-law formula:\n       $$\n       \\kappa_i = \\kappa_0 \\left( \\dfrac{P_i}{P_{\\mathrm{ref}}} \\right)^{a} \\left( \\dfrac{T_i}{T_{\\mathrm{ref}}} \\right)^{b}\n       $$\n    c. Calculate the radiative gradient $\\nabla_{\\mathrm{rad}, i}$ using our derived formula:\n       $$\n       \\nabla_{\\mathrm{rad}, i} = \\dfrac{3 F \\kappa_i P_i}{16 g \\sigma T_i^4}\n       $$\n    d. Compare the radiative and adiabatic gradients. If $\\nabla_{\\mathrm{rad}, i} \\ge \\nabla_{\\mathrm{ad}}$, the atmosphere at this level is unstable to convection.\n5.  The solution for the test case is the first (shallowest, i.e., lowest) pressure $P_i$ for which the convection criterion is met. If the loop completes and the criterion is never met, the result for that case is $-1$.\n\nThis procedure is implemented for each of the three test cases provided. The Stefan-Boltzmann constant, $\\sigma$, is taken as $5.670374419 \\times 10^{-8} \\ \\mathrm{W} \\ \\mathrm{m}^{-2} \\ \\mathrm{K}^{-4}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.constants import sigma\n\ndef solve():\n    \"\"\"\n    Computes the shallowest pressure level for the onset of convection in\n    several model planetary atmospheres.\n    \"\"\"\n    \n    # Reference constants for opacity calculation\n    P_ref = 1e5  # Pa\n    T_ref = 1e3  # K\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"g\": 24.79, \"F\": 6.0, \"gamma\": 1.4,\n            \"kappa0\": 2e-2, \"a\": 0.5, \"b\": 1.0,\n            \"N\": 12, \"P_min\": 1e4, \"P_max\": 1e7,\n            \"T0\": 130.0, \"P0\": 1e4, \"alpha\": 0.25,\n        },\n        {\n            \"name\": \"Case B\",\n            \"g\": 20.0, \"F\": 1500.0, \"gamma\": 1.42,\n            \"kappa0\": 5e-2, \"a\": 1.0, \"b\": 0.0,\n            \"N\": 12, \"P_min\": 1e4, \"P_max\": 1e7,\n            \"T0\": 1000.0, \"P0\": 1e4, \"alpha\": 0.05,\n        },\n        {\n            \"name\": \"Case C\",\n            \"g\": 30.0, \"F\": 200.0, \"gamma\": 1.35,\n            \"kappa0\": 3e-2, \"a\": 0.7, \"b\": 0.7,\n            \"N\": 12, \"P_min\": 1e4, \"P_max\": 1e7,\n            \"T0\": 300.0, \"P0\": 1e4, \"alpha\": 0.20,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters for the current case\n        g = case[\"g\"]\n        F = case[\"F\"]\n        gamma = case[\"gamma\"]\n        kappa0 = case[\"kappa0\"]\n        a = case[\"a\"]\n        b = case[\"b\"]\n        N = case[\"N\"]\n        P_min = case[\"P_min\"]\n        P_max = case[\"P_max\"]\n        T0 = case[\"T0\"]\n        P0 = case[\"P0\"]\n        alpha = case[\"alpha\"]\n\n        # 1. Calculate the constant adiabatic gradient\n        nabla_ad = (gamma - 1.0) / gamma\n\n        # 2. Create the logarithmically spaced pressure grid\n        P_grid = np.logspace(np.log10(P_min), np.log10(P_max), N)\n\n        # 3. Iterate through pressure levels to find onset of convection\n        onset_pressure = -1.0\n        for P in P_grid:\n            # 4a. Calculate temperature from the T-P profile\n            T = T0 * (P / P0)**alpha\n            \n            # 4b. Calculate opacity\n            kappa = kappa0 * (P / P_ref)**a * (T / T_ref)**b\n            \n            # 4c. Calculate the radiative gradient\n            nabla_rad_numerator = 3.0 * F * kappa * P\n            nabla_rad_denominator = 16.0 * g * sigma * T**4\n            nabla_rad = nabla_rad_numerator / nabla_rad_denominator\n            \n            # 4d. Check for convection onset (Schwarzschild criterion)\n            if nabla_rad = nabla_ad:\n                onset_pressure = P\n                break  # Found the shallowest level, stop searching\n\n        results.append(onset_pressure)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This capstone practice synthesizes the concepts of radiative transfer and convective instability into a complete, self-consistent model, which is the essence of predicting a planet's climate from physical laws. You will be guided through the construction of a full one-dimensional radiative-convective equilibrium (RCE) model from the ground up. The process involves implementing radiative balance using a semi-gray approximation and then applying a convective adjustment scheme to establish a stable thermal profile and locate the tropopause . By building a model and using it to investigate the climatic impact of a cloud layer, you will gain invaluable hands-on experience with the core techniques of planetary climate modeling.",
            "id": "4174946",
            "problem": "You are tasked with implementing a self-consistent, single-column Radiative-Convective Equilibrium (RCE) model for a planetary atmosphere under a semi-gray, two-stream approximation, and quantifying how adding a high cloud deck modifies the equilibrium temperature-pressure profile $T(p)$ and the tropopause altitude. The context is planetary science and exoplanet modeling. Your program must compute results for a specified test suite and produce exactly one line of output in the format described below.\n\nFundamental base for derivation and implementation:\n- Hydrostatic equilibrium: $dp/dz = -\\rho g$.\n- Ideal Gas Law: $p = \\rho R T$, where $R$ is the specific gas constant.\n- Radiative energy balance at the top of atmosphere: $\\sigma T_{\\mathrm{eff}}^{4} = (1 - A) S / 4$, where $\\sigma$ is the Stefan-Boltzmann constant, $A$ is the Bond albedo, and $S$ is the stellar irradiance (also known as the stellar constant) incident at the top of the atmosphere.\n- Two-stream, Eddington semi-gray longwave approximation for radiative equilibrium in the thermal infrared, assuming a well-mixed longwave absorber. Do not assume any shortwave absorption within the atmosphere; shortwave contributes only to setting $T_{\\mathrm{eff}}$.\n\nModeling requirements:\n1. Pressure coordinate and optical depth:\n   - Use a pressure grid that spans from the top of atmosphere pressure $p_{\\mathrm{top}}$ to the surface pressure $p_{\\mathrm{surf}}$.\n   - Assume the thermal infrared optical depth is proportional to mass path (well-mixed absorber), so the clear-sky cumulative longwave optical depth to space is increasing with pressure.\n   - A high cloud deck is represented as an infinitesimally thin slab at a pressure level $p_{\\mathrm{cloud}}$, which increases the cumulative longwave optical depth above all deeper levels by an increment $\\Delta \\tau_{\\mathrm{cloud}}$, while levels above the cloud are unaffected.\n\n2. Radiative equilibrium profile:\n   - Derive the radiative equilibrium temperature profile $T_{\\mathrm{rad}}(p)$ under the semi-gray two-stream Eddington approximation using the absorbed flux defined by $T_{\\mathrm{eff}}$.\n   - The clear-sky case uses the baseline longwave optical depth profile.\n   - The cloudy case uses the modified longwave optical depth profile with the cloud increment applied as described.\n\n3. Convective adjustment and tropopause identification:\n   - Define the dry adiabatic lapse in pressure coordinates by $T_{\\mathrm{conv}}(p) = T_{\\mathrm{tp}} \\left( \\frac{p}{p_{\\mathrm{tp}}} \\right)^{R/c_{p}}$, where $T_{\\mathrm{tp}}$ is the temperature at the tropopause pressure $p_{\\mathrm{tp}}$, $R$ is the specific gas constant, and $c_{p}$ is the specific heat at constant pressure.\n   - Implement a convective adjustment that replaces the radiative equilibrium profile below a candidate $p_{\\mathrm{tp}}$ by the dry adiabat anchored at $T_{\\mathrm{rad}}(p_{\\mathrm{tp}})$, provided that convection is required (i.e., the radiative equilibrium profile is superadiabatic and would be destabilizing relative to the dry adiabat).\n   - Identify the tropopause as the highest-altitude (lowest-pressure) level above which the atmosphere remains in radiative equilibrium and below which the convective adiabat does not undercut the radiative equilibrium temperature (i.e., $T_{\\mathrm{conv}}(p) \\ge T_{\\mathrm{rad}}(p)$ for all deeper levels). If no convection is required anywhere, define the tropopause altitude as $0$.\n\n4. Altitude calculation:\n   - Compute the geometric altitude $z(p)$ of each pressure level relative to the surface ($z=0$ at the surface) by numerical integration of the hydrostatic relation combined with the Ideal Gas Law,\n     $$ \\frac{dz}{dp} = -\\frac{R T(p)}{g p}. $$\n     Perform this integration using the final RCE temperature profile for each case.\n\n5. Quantities to report per test case:\n   - The maximum absolute change in the temperature profile $T(p)$ due to adding the cloud deck, expressed in Kelvin, i.e.,\n     $$ \\Delta T_{\\max} = \\max_{p} \\left| T_{\\mathrm{RCE,cloud}}(p) - T_{\\mathrm{RCE,clear}}(p) \\right|. $$\n   - The change in tropopause altitude (cloud minus clear), expressed in meters, i.e.,\n     $$ \\Delta z_{\\mathrm{tp}} = z_{\\mathrm{tp,cloud}} - z_{\\mathrm{tp,clear}}. $$\n\nNumerical and physical details:\n- All temperatures must be in Kelvin.\n- All altitudes must be in meters.\n- Pressures must be in pascal.\n- Gravitational acceleration $g$ is in meters per second squared.\n- Specific heat $c_{p}$ and specific gas constant $R$ are in joule per kilogram per kelvin.\n- Optical depths are dimensionless.\n\nImplementation constraints:\n- Use a pressure grid that is logarithmically spaced (to resolve upper atmosphere) with at least $200$ levels between $p_{\\mathrm{top}}$ and $p_{\\mathrm{surf}}$.\n- Use the Stefan-Boltzmann constant $\\sigma = 5.670374419 \\times 10^{-8}$ watt per square meter per kelvin to the fourth power.\n- Ensure numerical stability and monotonicity where physically required.\n\nTest suite:\nProvide computations for the following four cases. For each case, use the specified parameters.\n- Case 1 (Earth-like, optically thick): $p_{\\mathrm{surf}} = 1.0 \\times 10^{5}$, $p_{\\mathrm{top}} = 100.0$, $g = 9.81$, $c_{p} = 1004.0$, $R = 287.0$, $S = 1361.0$, $A = 0.30$, $\\tau_{\\mathrm{surf}} = 3.0$, $p_{\\mathrm{cloud}} = 2.0 \\times 10^{4}$, $\\Delta \\tau_{\\mathrm{cloud}} = 1.0$.\n- Case 2 (Mars-like, tenuous atmosphere): $p_{\\mathrm{surf}} = 600.0$, $p_{\\mathrm{top}} = 1.0$, $g = 3.71$, $c_{p} = 730.0$, $R = 189.0$, $S = 586.0$, $A = 0.25$, $\\tau_{\\mathrm{surf}} = 0.2$, $p_{\\mathrm{cloud}} = 50.0$, $\\Delta \\tau_{\\mathrm{cloud}} = 0.5$.\n- Case 3 (Super-Earth, thick atmosphere): $p_{\\mathrm{surf}} = 2.0 \\times 10^{5}$, $p_{\\mathrm{top}} = 100.0$, $g = 15.0$, $c_{p} = 1000.0$, $R = 300.0$, $S = 1700.0$, $A = 0.20$, $\\tau_{\\mathrm{surf}} = 5.0$, $p_{\\mathrm{cloud}} = 1.0 \\times 10^{4}$, $\\Delta \\tau_{\\mathrm{cloud}} = 2.0$.\n- Case 4 (Earth-like boundary, no cloud increment): $p_{\\mathrm{surf}} = 1.0 \\times 10^{5}$, $p_{\\mathrm{top}} = 100.0$, $g = 9.81$, $c_{p} = 1004.0$, $R = 287.0$, $S = 1361.0$, $A = 0.30$, $\\tau_{\\mathrm{surf}} = 3.0$, $p_{\\mathrm{cloud}} = 2.0 \\times 10^{4}$, $\\Delta \\tau_{\\mathrm{cloud}} = 0.0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets, where each inner list corresponds to a test case and contains two floats: $[\\Delta T_{\\max}, \\Delta z_{\\mathrm{tp}}]$.\n- For example: $[[\\Delta T_{\\max,1},\\Delta z_{\\mathrm{tp},1}],[\\Delta T_{\\max,2},\\Delta z_{\\mathrm{tp},2}],[\\Delta T_{\\max,3},\\Delta z_{\\mathrm{tp},3}],[\\Delta T_{\\max,4},\\Delta z_{\\mathrm{tp},4}]]$.",
            "solution": "The user-provided problem is valid and will be solved as stated. It is a well-posed problem in planetary atmospheric physics that is scientifically grounded and contains sufficient information for a unique solution.\n\nThe solution requires the construction of a one-dimensional Radiative-Convective Equilibrium (RCE) model. The core of this task is to calculate the equilibrium temperature-pressure profile, $T(p)$, for a planetary atmosphere, first for a clear-sky case and then for a case with a high-altitude cloud deck. The differences in temperature and tropopause structure between these two scenarios are then quantified.\n\n### 1. Theoretical Framework\n\nThe model is based on a set of fundamental physical principles and standard approximations used in atmospheric science.\n\n#### 1.1. Radiative Balance and Effective Temperature\n\nThe planet is in global energy balance. The absorbed stellar radiation is balanced by the outgoing longwave radiation (OLR) emitted to space. The OLR is characterized by an effective temperature, $T_{\\mathrm{eff}}$, defined by the Stefan-Boltzmann law.\nThe total solar energy incident on the planet is proportional to its cross-sectional area, $\\pi R_p^2$, where $R_p$ is the planet's radius. This energy is distributed over the planet's surface area, $4\\pi R_p^2$. The absorbed solar flux per unit area, averaged over the globe, is given by $F_{solar} = (1 - A)S/4$, where $S$ is the stellar irradiance at the planet's orbit and $A$ is the Bond albedo. In equilibrium, the OLR must equal this absorbed flux:\n$$ \\sigma T_{\\mathrm{eff}}^{4} = \\frac{(1 - A) S}{4} $$\nwhere $\\sigma$ is the Stefan-Boltzmann constant. $T_{\\mathrm{eff}}$ is a fundamental parameter that sets the energy budget for the atmospheric temperature structure.\n\n#### 1.2. Radiative Equilibrium Temperature Profile\n\nThe problem specifies a semi-gray, two-stream Eddington approximation for radiative transfer in the thermal infrared. This is a standard model for a \"gray\" atmosphere, which absorbs equally at all longwave frequencies. The solution to the radiative transfer equations under this approximation yields a well-known temperature profile as a function of the vertical longwave optical depth, $\\tau$. The optical depth $\\tau$ is defined as $0$ at the top of the atmosphere and increases with pressure downwards. The temperature at any level in radiative equilibrium, $T_{\\mathrm{rad}}$, is given by:\n$$ T_{\\mathrm{rad}}(\\tau)^4 = T_{\\mathrm{eff}}^4 \\left( \\frac{1}{2} + \\frac{3}{4}\\tau \\right) $$\nThis equation describes the greenhouse effect: the atmosphere becomes warmer at depth (larger $\\tau$) as it becomes more opaque to outgoing thermal radiation.\n\n#### 1.3. Optical Depth Profile\n\nThe problem assumes a well-mixed longwave absorber, meaning its mass mixing ratio is constant with altitude. In this case, the incremental optical depth $d\\tau$ is proportional to the incremental mass path $dp/g$. Integrating this from the top of the atmosphere ($p_{\\text{top}}$, $\\tau=0$) down to a pressure level $p$ gives a linear relationship between optical depth and pressure:\n$$ \\tau(p) = \\tau_{\\mathrm{surf}} \\frac{p - p_{\\mathrm{top}}}{p_{\\mathrm{surf}} - p_{\\mathrm{top}}} $$\nwhere $\\tau_{\\mathrm{surf}}$ is the total optical depth of the atmosphere at the surface pressure $p_{\\mathrm{surf}}$.\n\nA high cloud deck is modeled as an infinitesimally thin layer at pressure $p_{\\mathrm{cloud}}$ that adds an increment of optical depth, $\\Delta \\tau_{\\mathrm{cloud}}$. This modification affects the total optical depth for all levels *below* the cloud:\n$$ \\tau_{\\mathrm{mod}}(p) = \\begin{cases} \\tau_{\\mathrm{clear}}(p)  \\text{if } p \\le p_{\\mathrm{cloud}} \\\\ \\tau_{\\mathrm{clear}}(p) + \\Delta\\tau_{\\mathrm{cloud}}  \\text{if } p  p_{\\mathrm{cloud}} \\end{cases} $$\nThis modified optical depth profile, $\\tau_{\\mathrm{mod}}(p)$, is used to calculate the radiative equilibrium profile in the cloudy case.\n\n#### 1.4. Convective Adjustment and Tropopause\n\nThe radiative equilibrium profile is not always stable. If the temperature decreases with altitude faster than the dry adiabatic lapse rate, the atmosphere is unstable to convection. Convection efficiently mixes heat vertically, driving the temperature profile towards a dry adiabat. The RCE profile is the stable configuration that results from this adjustment.\n\nThe dry adiabat is given in pressure coordinates by:\n$$ T(p) = T_0 \\left(\\frac{p}{p_0}\\right)^{\\kappa} \\quad \\text{where} \\quad \\kappa = \\frac{R}{c_p} $$\nHere, $(p_0, T_0)$ is a reference point, $R$ is the specific gas constant, and $c_p$ is the specific heat at constant pressure.\n\nThe tropopause is the boundary between the lower, convectively-mixed troposphere and the upper, radiatively-controlled stratosphere. It is found by identifying the highest-altitude (lowest-pressure) level, $p_{\\mathrm{tp}}$, such that if the profile below it follows a dry adiabat anchored at $(p_{\\mathrm{tp}}, T_{\\mathrm{rad}}(p_{\\mathrm{tp}}))$, this adiabatic profile remains warmer than or at the same temperature as the purely radiative profile at all deeper levels. That is, we search for the minimum $p_{\\mathrm{tp}}$ that satisfies:\n$$ T_{\\mathrm{rad}}(p_{\\mathrm{tp}}) \\left(\\frac{p}{p_{\\mathrm{tp}}}\\right)^{\\kappa} \\ge T_{\\mathrm{rad}}(p) \\quad \\text{for all } p  p_{\\mathrm{tp}} $$\nIf no such level exists, the entire atmosphere is in radiative equilibrium, and no tropopause forms due to convection.\n\n#### 1.5. Final RCE Temperature Profile\n\nOnce the tropopause pressure $p_{\\mathrm{tp}}$ is identified, the final RCE temperature profile, $T_{\\mathrm{RCE}}(p)$, is constructed as a composite:\n$$ T_{\\mathrm{RCE}}(p) = \\begin{cases} T_{\\mathrm{rad}}(p)  \\text{if } p \\le p_{\\mathrm{tp}} \\quad \\text{(Stratosphere)} \\\\ T_{\\mathrm{rad}}(p_{\\mathrm{tp}}) \\left(\\frac{p}{p_{\\mathrm{tp}}}\\right)^{\\kappa}  \\text{if } p  p_{\\mathrm{tp}} \\quad \\text{(Troposphere)} \\end{cases} $$\nIf no tropopause is found, $T_{\\mathrm{RCE}}(p) = T_{\\mathrm{rad}}(p)$ for all $p$.\n\n#### 1.6. Altitude Profile\n\nThe geometric altitude $z(p)$ is found by integrating the equation of hydrostatic equilibrium ($dp = -\\rho g dz$) combined with the ideal gas law ($p = \\rho R T$). This gives the differential relation:\n$$ \\frac{dz}{dp} = -\\frac{R T(p)}{g p} $$\nIntegrating this from the surface ($p=p_{\\mathrm{surf}}$, $z=0$) upwards to a pressure level $p$ gives the altitude:\n$$ z(p) = \\int_{p}^{p_{\\mathrm{surf}}} \\frac{R T_{\\mathrm{RCE}}(p')}{g p'} dp' $$\nThis integral is computed numerically. Using a logarithmically spaced pressure grid, a reasonable approximation for the integral between two adjacent levels $p_i$ and $p_{i+1}$ is:\n$$ z_i - z_{i+1} = \\int_{p_i}^{p_{i+1}} -\\frac{R T(p')}{g p'} dp' \\approx \\frac{R}{g} \\left( \\frac{T_i + T_{i+1}}{2} \\right) \\ln\\left(\\frac{p_{i+1}}{p_i}\\right) $$\nStarting with $z=0$ at the surface, the altitude at each pressure level can be calculated by summing these increments. The tropopause altitude, $z_{\\mathrm{tp}}$, is the altitude corresponding to the tropopause pressure, $p_{\\mathrm{tp}}$. If no tropopause exists, $z_{\\mathrm{tp}} = 0$.\n\n### 2. Computational Algorithm\n\nThe solution is implemented by following these steps for each test case:\n\n1.  **Initialization**: Define physical constants and the parameters for the current test case. Set up a logarithmically spaced pressure grid with $N=1000$ levels from $p_{\\mathrm{top}}$ to $p_{\\mathrm{surf}}$.\n2.  **Calculate $T_{\\mathrm{eff}}$**: Compute the effective temperature from the given stellar irradiance $S$ and albedo $A$.\n3.  **Process Clear-Sky Case**:\n    a.  Compute the clear-sky optical depth profile $\\tau_{\\mathrm{clear}}(p)$.\n    b.  Calculate the radiative equilibrium profile $T_{\\mathrm{rad,clear}}(p)$.\n    c.  Find the tropopause pressure $p_{\\mathrm{tp,clear}}$ by systematically searching from the top of the atmosphere downwards.\n    d.  Construct the final RCE profile $T_{\\mathrm{RCE,clear}}(p)$.\n    e.  If a tropopause was found, calculate the full altitude profile $z_{\\mathrm{clear}}(p)$ and find the tropopause altitude $z_{\\mathrm{tp,clear}}$. If not, $z_{\\mathrm{tp,clear}} = 0$.\n4.  **Process Cloudy-Sky Case**:\n    a.  Compute the cloudy-sky optical depth profile $\\tau_{\\mathrm{cloud}}(p)$ by adding $\\Delta \\tau_{\\mathrm{cloud}}$ for $p  p_{\\mathrm{cloud}}$.\n    b.  Calculate the radiative equilibrium profile $T_{\\mathrm{rad,cloud}}(p)$.\n    c.  Find the tropopause pressure $p_{\\mathrm{tp,cloud}}$.\n    d.  Construct the final RCE profile $T_{\\mathrm{RCE,cloud}}(p)$.\n    e.  Calculate the tropopause altitude $z_{\\mathrm{tp,cloud}}$.\n5.  **Compute Final Metrics**:\n    a.  Calculate the maximum absolute temperature change: $\\Delta T_{\\max} = \\max_{p} |T_{\\mathrm{RCE,cloud}}(p) - T_{\\mathrm{RCE,clear}}(p)|$.\n    b.  Calculate the change in tropopause altitude: $\\Delta z_{\\mathrm{tp}} = z_{\\mathrm{tp,cloud}} - z_{\\mathrm{tp,clear}}$.\n6.  **Store and Output Results**: Store the pair $[\\Delta T_{\\max}, \\Delta z_{\\mathrm{tp}}]$ and repeat for all test cases. Format the final output as a list of these pairs.\n\nThis procedure is deterministic and directly implements the physics described in the problem statement. The use of a fine pressure grid and a stable numerical integration scheme ensures accuracy.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the Radiative-Convective Equilibrium problem\n    for the given test suite.\n    \"\"\"\n    \n    # Stefan-Boltzmann constant (W m^-2 K^-4)\n    SIGMA = 5.670374419e-8\n    \n    # Number of pressure levels in the model\n    N_LEVELS = 1000\n\n    test_cases = [\n        # Case 1 (Earth-like, optically thick)\n        {'p_surf': 1.0e5, 'p_top': 100.0, 'g': 9.81, 'cp': 1004.0, 'R': 287.0, \n         'S': 1361.0, 'A': 0.30, 'tau_surf': 3.0, 'p_cloud': 2.0e4, 'Delta_tau_cloud': 1.0},\n        # Case 2 (Mars-like, tenuous atmosphere)\n        {'p_surf': 600.0, 'p_top': 1.0, 'g': 3.71, 'cp': 730.0, 'R': 189.0, \n         'S': 586.0, 'A': 0.25, 'tau_surf': 0.2, 'p_cloud': 50.0, 'Delta_tau_cloud': 0.5},\n        # Case 3 (Super-Earth, thick atmosphere)\n        {'p_surf': 2.0e5, 'p_top': 100.0, 'g': 15.0, 'cp': 1000.0, 'R': 300.0, \n         'S': 1700.0, 'A': 0.20, 'tau_surf': 5.0, 'p_cloud': 1.0e4, 'Delta_tau_cloud': 2.0},\n        # Case 4 (Earth-like boundary, no cloud increment)\n        {'p_surf': 1.0e5, 'p_top': 100.0, 'g': 9.81, 'cp': 1004.0, 'R': 287.0, \n         'S': 1361.0, 'A': 0.30, 'tau_surf': 3.0, 'p_cloud': 2.0e4, 'Delta_tau_cloud': 0.0},\n    ]\n\n    results = []\n\n    for params in test_cases:\n        p_surf = params['p_surf']\n        p_top = params['p_top']\n                \n        # Create a logarithmically spaced pressure grid from p_top to p_surf\n        p_grid = np.logspace(np.log10(p_top), np.log10(p_surf), N_LEVELS)\n\n        # Calculate results for clear-sky case\n        T_rce_clear, z_tp_clear = compute_rce_profile(p_grid, params, False)\n        \n        # Calculate results for cloudy-sky case\n        T_rce_cloud, z_tp_cloud = compute_rce_profile(p_grid, params, True)\n        \n        # Compute final metrics\n        delta_T_max = np.max(np.abs(T_rce_cloud - T_rce_clear))\n        delta_z_tp = z_tp_cloud - z_tp_clear\n        \n        results.append([delta_T_max, delta_z_tp])\n\n    # Format output as specified\n    print(f\"[{','.join([f'[{r[0]:.4f},{r[1]:.4f}]' for r in results])}]\")\n\n\ndef compute_rce_profile(p_grid, params, is_cloudy):\n    \"\"\"\n    Computes the Radiative-Convective Equilibrium profile for a given\n    set of parameters and cloud state.\n    \n    Returns:\n        T_rce (np.ndarray): The final RCE temperature profile [K].\n        z_tp (float): The tropopause altitude [m].\n    \"\"\"\n    \n    # Unpack parameters\n    p_surf = params['p_surf']\n    p_top = params['p_top']\n    g = params['g']\n    cp = params['cp']\n    R = params['R']\n    S = params['S']\n    A = params['A']\n    tau_surf = params['tau_surf']\n    p_cloud = params['p_cloud']\n    Delta_tau_cloud = params['Delta_tau_cloud']\n    SIGMA = 5.670374419e-8\n    \n    # 1. Effective Temperature\n    T_eff = ((1.0 - A) * S / (4.0 * SIGMA))**0.25\n    \n    # 2. Optical Depth Profile\n    tau_clear = tau_surf * (p_grid - p_top) / (p_surf - p_top)\n    \n    tau = np.copy(tau_clear)\n    if is_cloudy and Delta_tau_cloud  0:\n        cloud_mask = p_grid  p_cloud\n        tau[cloud_mask] += Delta_tau_cloud\n        \n    # 3. Radiative Equilibrium Temperature Profile\n    T_rad = T_eff * (0.5 + 0.75 * tau)**0.25\n    \n    # 4. Convective Adjustment and Tropopause Identification\n    kappa = R / cp\n    p_tp_idx = -1  # Index of tropopause pressure level\n    \n    for k in range(len(p_grid)):\n        p_tp_candidate = p_grid[k]\n        T_tp_candidate = T_rad[k]\n        \n        # Get pressure levels below the candidate tropopause\n        sub_trop_mask = p_grid  p_tp_candidate\n        if not np.any(sub_trop_mask):\n            continue\n\n        p_sub = p_grid[sub_trop_mask]\n        T_rad_sub = T_rad[sub_trop_mask]\n        \n        # Adiabatic profile below the candidate tropopause\n        T_conv_sub = T_tp_candidate * (p_sub / p_tp_candidate)**kappa\n        \n        # Check if the adiabat is warmer than or at the same temp as the radiative profile\n        if np.all(T_conv_sub = T_rad_sub):\n            p_tp_idx = k\n            break\n            \n    # 5. Final RCE Profile and Altitude Calculation\n    T_rce = np.copy(T_rad)\n    z_tp = 0.0\n\n    if p_tp_idx != -1:\n        # Tropopause found, construct RCE profile\n        p_tp = p_grid[p_tp_idx]\n        T_tp = T_rad[p_tp_idx]\n        \n        troposphere_mask = p_grid  p_tp\n        p_troposphere = p_grid[troposphere_mask]\n        T_rce[troposphere_mask] = T_tp * (p_troposphere / p_tp)**kappa\n        \n        # Calculate altitude profile\n        z_grid = np.zeros_like(p_grid)\n        # z_grid[-1] is 0 at p_surf\n        for i in range(len(p_grid) - 2, -1, -1):\n            T_mean_layer = 0.5 * (T_rce[i] + T_rce[i+1])\n            z_grid[i] = z_grid[i+1] + (R / g) * T_mean_layer * np.log(p_grid[i+1] / p_grid[i])\n        \n        z_tp = z_grid[p_tp_idx]\n        \n    return T_rce, z_tp\n\n\nif __name__ == '__main__':\n    solve()\n\n```"
        }
    ]
}