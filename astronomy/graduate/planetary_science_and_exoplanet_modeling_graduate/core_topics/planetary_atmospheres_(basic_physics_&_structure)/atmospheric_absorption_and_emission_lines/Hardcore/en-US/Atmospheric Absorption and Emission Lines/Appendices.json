{
    "hands_on_practices": [
        {
            "introduction": "The intensity of a spectral line is a direct probe of the atmospheric conditions where it forms. For exoplanets, where temperatures can vary dramatically, understanding how line intensities respond to temperature is fundamental to interpreting observations. This practice delves into the core principles of statistical mechanics that govern line strengths, forcing you to dissect the competing effects of population dilution, thermal population of the energy level, and stimulated emission. This exercise is key to building an intuition for why different lines can serve as powerful thermometers for planetary atmospheres .",
            "id": "4152772",
            "problem": "An irradiated exoplanet atmosphere dominated by water vapor is observed in transmission. Consider a single rovibrational transition of water with line center wavenumber $\\tilde{\\nu}_0$ and lower-state term value $E_l$ (both expressed in inverse centimeters), and assume the total number of water molecules in the absorbing column does not change with temperature over the range considered. Neglect line-shape effects, pressure broadening, and any temperature dependence of the transition dipole moment; assume the electronic ground state and thermal equilibrium prevail. The integrated line intensity $S(T)$ (per molecule) depends on the fractional population of the lower state, the level partitioning characterized by the molecular partition function $Q(T)$, and the stimulated emission correction.\n\nUsing the tabulated partition function values for water vapor $Q(T)$ and the following spectroscopic constants:\n- $\\tilde{\\nu}_0 = 1595~\\mathrm{cm}^{-1}$,\n- $E_l = 500~\\mathrm{cm}^{-1}$,\n- $Q(500~\\mathrm{K}) = 5.30 \\times 10^{2}$,\n- $Q(1500~\\mathrm{K}) = 5.20 \\times 10^{3}$,\n- $c_2 \\equiv \\dfrac{h c}{k_B} = 1.438777~\\mathrm{cm \\cdot K}$,\n\nderive from first principles an expression for the ratio of integrated line intensities $R \\equiv \\dfrac{S(1500~\\mathrm{K})}{S(500~\\mathrm{K})}$, evaluate $R$ numerically, and briefly interpret the sign and magnitude of the change in terms of the underlying lower-state population and stimulated emission effects. Express the final ratio as a dimensionless number rounded to four significant figures.",
            "solution": "The integrated line intensity, $S(T)$, for a rovibrational transition from a lower state $l$ to an upper state $u$ at a temperature $T$ is proportional to the number of absorbing molecules in the lower state, corrected for stimulated emission. From first principles, the expression for $S(T)$ (in units of $\\mathrm{cm}^{-1}/(\\mathrm{molecule \\cdot cm^{-2}})$) can be written as:\n$$\nS(T) = \\frac{C_0}{Q(T)} g_l \\exp\\left(-\\frac{E_l}{k_B T}\\right) \\left[1 - \\exp\\left(-\\frac{h c \\tilde{\\nu}_0}{k_B T}\\right)\\right]\n$$\nHere, $C_0$ is a constant that encompasses fundamental physical constants and the transition dipole moment, which is assumed to be independent of temperature. $Q(T)$ is the total internal partition function of the molecule at temperature $T$. $g_l$ is the degeneracy of the lower state $l$, and $E_l$ is its energy. Under the problem's assumptions, $g_l$ is a constant for the given state. $\\tilde{\\nu}_0$ is the wavenumber of the transition line center. The term $\\exp\\left(-\\frac{E_l}{k_B T}\\right)$ is the Boltzmann factor for the lower state. The term $\\left[1 - \\exp\\left(-\\frac{h c \\tilde{\\nu}_0}{k_B T}\\right)\\right]$ accounts for the effect of stimulated emission, where $h c \\tilde{\\nu}_0$ is the energy difference between the upper and lower states.\n\nThe problem provides energies ($E_l$) and wavenumbers ($\\tilde{\\nu}_0$) in units of $\\mathrm{cm}^{-1}$. This is a common convention in spectroscopy. To use these values directly in the exponential terms, we utilize the second radiation constant, $c_2 \\equiv \\frac{h c}{k_B}$, which has units of $\\mathrm{cm \\cdot K}$. The exponents are then written as $-\\frac{c_2 E_l}{T}$ and $-\\frac{c_2 \\tilde{\\nu}_0}{T}$, where $E_l$ and $\\tilde{\\nu}_0$ are the numerical values in $\\mathrm{cm}^{-1}$.\n\nThe expression for $S(T)$ can thus be written in a proportionality form, collecting all temperature-independent terms into a single constant $C$:\n$$\nS(T) \\propto \\frac{1}{Q(T)} \\exp\\left(-\\frac{c_2 E_l}{T}\\right) \\left[1 - \\exp\\left(-\\frac{c_2 \\tilde{\\nu}_0}{T}\\right)\\right]\n$$\nWe are asked to find the ratio $R \\equiv \\frac{S(T_2)}{S(T_1)}$, where $T_1 = 500~\\mathrm{K}$ and $T_2 = 1500~\\mathrm{K}$. Forming this ratio eliminates the constant of proportionality $C$:\n$$\nR = \\frac{\\frac{1}{Q(T_2)} \\exp\\left(-\\frac{c_2 E_l}{T_2}\\right) \\left[1 - \\exp\\left(-\\frac{c_2 \\tilde{\\nu}_0}{T_2}\\right)\\right]}{\\frac{1}{Q(T_1)} \\exp\\left(-\\frac{c_2 E_l}{T_1}\\right) \\left[1 - \\exp\\left(-\\frac{c_2 \\tilde{\\nu}_0}{T_1}\\right)\\right]}\n$$\nRearranging this expression gives:\n$$\nR = \\left(\\frac{Q(T_1)}{Q(T_2)}\\right) \\cdot \\left(\\frac{\\exp\\left(-\\frac{c_2 E_l}{T_2}\\right)}{\\exp\\left(-\\frac{c_2 E_l}{T_1}\\right)}\\right) \\cdot \\left(\\frac{1 - \\exp\\left(-\\frac{c_2 \\tilde{\\nu}_0}{T_2}\\right)}{1 - \\exp\\left(-\\frac{c_2 \\tilde{\\nu}_0}{T_1}\\right)}\\right)\n$$\nThis expression can be further simplified:\n$$\nR = \\frac{Q(T_1)}{Q(T_2)} \\cdot \\exp\\left[c_2 E_l \\left(\\frac{1}{T_1} - \\frac{1}{T_2}\\right)\\right] \\cdot \\frac{1 - \\exp\\left(-\\frac{c_2 \\tilde{\\nu}_0}{T_2}\\right)}{1 - \\exp\\left(-\\frac{c_2 \\tilde{\\nu}_0}{T_1}\\right)}\n$$\nNow we substitute the given values:\n-   $T_1 = 500~\\mathrm{K}$\n-   $T_2 = 1500~\\mathrm{K}$\n-   $\\tilde{\\nu}_0 = 1595~\\mathrm{cm}^{-1}$\n-   $E_l = 500~\\mathrm{cm}^{-1}$\n-   $Q(T_1) = 5.30 \\times 10^{2}$\n-   $Q(T_2) = 5.20 \\times 10^{3}$\n-   $c_2 = 1.438777~\\mathrm{cm \\cdot K}$\n\nFirst, we calculate the arguments of the exponential functions:\nFor the lower-state population term:\n-   $c_2 E_l \\left(\\frac{1}{T_1} - \\frac{1}{T_2}\\right) = (1.438777~\\mathrm{cm \\cdot K}) \\cdot (500~\\mathrm{cm}^{-1}) \\cdot \\left(\\frac{1}{500~\\mathrm{K}} - \\frac{1}{1500~\\mathrm{K}}\\right) = 719.3885 \\cdot \\left(\\frac{2}{1500}\\right) = 0.9591846\\bar{6}$\n\nFor the stimulated emission term:\n-   $\\frac{c_2 \\tilde{\\nu}_0}{T_1} = \\frac{(1.438777~\\mathrm{cm \\cdot K}) \\cdot (1595~\\mathrm{cm}^{-1})}{500~\\mathrm{K}} = 4.58969863$\n-   $\\frac{c_2 \\tilde{\\nu}_0}{T_2} = \\frac{(1.438777~\\mathrm{cm \\cdot K}) \\cdot (1595~\\mathrm{cm}^{-1})}{1500~\\mathrm{K}} = 1.52989954\\bar{3}$\n\nNow, we evaluate each of the three factors contributing to $R$:\n1.  Partition function ratio:\n    $$ \\frac{Q(T_1)}{Q(T_2)} = \\frac{5.30 \\times 10^{2}}{5.20 \\times 10^{3}} = \\frac{530}{5200} \\approx 0.101923 $$\n2.  Boltzmann factor ratio (lower-state population):\n    $$ \\exp\\left[c_2 E_l \\left(\\frac{1}{T_1} - \\frac{1}{T_2}\\right)\\right] = \\exp(0.9591846\\bar{6}) \\approx 2.60959 $$\n3.  Stimulated emission correction ratio:\n    $$ \\frac{1 - \\exp\\left(-\\frac{c_2 \\tilde{\\nu}_0}{T_2}\\right)}{1 - \\exp\\left(-\\frac{c_2 \\tilde{\\nu}_0}{T_1}\\right)} = \\frac{1 - \\exp(-1.52989954\\bar{3})}{1 - \\exp(-4.58969863)} = \\frac{1 - 0.2165538}{1 - 0.0101565} = \\frac{0.7834462}{0.9898435} \\approx 0.791485 $$\n\nMultiplying these three factors together gives the ratio $R$:\n$$ R \\approx (0.101923) \\cdot (2.60959) \\cdot (0.791485) \\approx 0.210534 $$\nRounding to four significant figures, we get $R = 0.2105$.\n\nInterpretation of the result:\nThe ratio $R$ is significantly less than $1$, indicating that the integrated intensity of this line is substantially weaker at the higher temperature of $1500~\\mathrm{K}$ than at $500~\\mathrm{K}$. This change is the net result of three competing temperature-dependent effects:\n1.  **Partition Function ($Q(T)$)**: The partition function increases from $530$ to $5200$, a factor of $\\approx 9.8$. Since $S(T) \\propto 1/Q(T)$, this effect drastically dilutes the population of any single state by distributing molecules over a much larger number of accessible rovibrational states at the higher temperature. This is the dominant effect and causes a strong decrease in line strength, contributing a factor of $\\approx 0.102$ to the ratio.\n2.  **Lower-State Population (Boltzmann Factor)**: For a state with non-zero energy $E_l = 500~\\mathrm{cm}^{-1}$, the Boltzmann factor $\\exp(-c_2 E_l/T)$ increases with temperature. More thermal energy is available to populate this excited state. This effect increases the line strength, contributing a factor of $\\approx 2.61$ to the ratio.\n3.  **Stimulated Emission**: The stimulated emission correction factor $1 - \\exp(-c_2 \\tilde{\\nu}_0/T)$ decreases as temperature rises, because the population of the upper state becomes more significant, increasing the rate of stimulated emission which counteracts absorption. This effect reduces the net line strength, contributing a factor of $\\approx 0.791$ to the ratio.\n\nThe strong population dilution due to the growth of the partition function (factor of $0.102$) overwhelmingly dominates the increase from the Boltzmann factor for the lower state (factor of $2.61$), leading to a net decrease in line intensity. The increased stimulated emission further reduces the intensity. The final intensity at $1500~\\mathrm{K}$ is approximately $21\\%$ of its value at $500~\\mathrm{K}$.",
            "answer": "$$\\boxed{0.2105}$$"
        },
        {
            "introduction": "An individual molecule may absorb a photon, but an observable spectral line is the collective result of countless such events within a vast atmospheric slab. To connect microscopic properties to a macroscopic spectrum, we must use the equation of radiative transfer. This exercise provides a hands-on derivation of the emergent intensity from an isothermal, uniform slab, revealing the fundamental expression that governs whether a line appears in absorption or emission based on the slab's temperature relative to its background. Mastering this concept is the first step toward building more complex, realistic atmospheric models .",
            "id": "4152756",
            "problem": "Consider a plane-parallel, isothermal exoplanetary atmospheric slab observed at the center of a single spectral line of frequency $\\nu_{0}$. The slab has a total line-center optical depth $\\tau_{0}$ measured along the outward surface normal from the top boundary ($\\tau=0$) to the bottom boundary ($\\tau=\\tau_{0}$). Assume Local Thermodynamic Equilibrium (LTE), so the line source function is spatially constant and equal to the Planck function at line center, $S_{0} = B_{\\nu_{0}}(T)$, where $T$ is the uniform slab temperature. Neglect scattering and any continuum opacity within the slab at $\\nu_{0}$; the only extinction and emission are due to the line. The lower boundary ($\\tau=\\tau_{0}$) is illuminated from below by a background continuum source with outward specific intensity $I_{c}$ at $\\nu_{0}$, and there is no incident radiation from above.\n\nStarting from the one-dimensional radiative transfer equation along the outward normal direction at $\\nu_{0}$ and appropriate boundary conditions, derive the emergent specific intensity from the top of the slab, $I_{\\nu_{0}}(0)$, as a function of $\\tau_{0}$, $B_{\\nu_{0}}(T)$, and $I_{c}$. Then, using your derived expression, identify the absorption and emission regimes as $\\tau_{0}$ varies and explain the limiting behaviors for small and large $\\tau_{0}$ in terms of the relative magnitudes of $B_{\\nu_{0}}(T)$ and $I_{c}$.\n\nExpress your final answer as a single closed-form analytic expression for $I_{\\nu_{0}}(0)$ in terms of $I_{c}$, $B_{\\nu_{0}}(T)$, and $\\tau_{0}$. Do not substitute numerical values.",
            "solution": "The one-dimensional radiative transfer equation (RTE) describes the change in specific intensity $I_{\\nu}$ along a path. For this problem, we consider the radiation at the line-center frequency $\\nu_0$. The optical depth $\\tau$ is defined to be $\\tau=0$ at the top of the slab and increases downwards to $\\tau=\\tau_0$ at the bottom. We are interested in the intensity traveling along the outward normal, which is in the direction of decreasing $\\tau$. The RTE for a ray moving along the normal ($\\mu=1$) is given by:\n$$ \\frac{dI_{\\nu_0}(\\tau)}{d\\tau} = I_{\\nu_0}(\\tau) - S_0 $$\nwhere $I_{\\nu_0}(\\tau)$ is the specific intensity at optical depth $\\tau$ and $S_0$ is the source function at line center.\n\nThe problem states that the slab is in LTE and is isothermal with a uniform temperature $T$. Under LTE, the source function is equal to the Planck function, and since the temperature is constant, the source function is spatially constant:\n$$ S_0 = B_{\\nu_0}(T) $$\nwhere $B_{\\nu_0}(T)$ is the Planck function evaluated at frequency $\\nu_0$ and temperature $T$. The RTE is thus a first-order linear ordinary differential equation with a constant term:\n$$ \\frac{dI_{\\nu_0}(\\tau)}{d\\tau} - I_{\\nu_0}(\\tau) = -B_{\\nu_0}(T) $$\nTo solve this equation, we use an integrating factor, $\\rho(\\tau) = \\exp\\left(\\int (-1) d\\tau\\right) = \\exp(-\\tau)$. Multiplying the RTE by the integrating factor gives:\n$$ \\exp(-\\tau) \\frac{dI_{\\nu_0}(\\tau)}{d\\tau} - \\exp(-\\tau) I_{\\nu_0}(\\tau) = -B_{\\nu_0}(T) \\exp(-\\tau) $$\nThe left side can be written as the derivative of a product:\n$$ \\frac{d}{d\\tau} \\left( I_{\\nu_0}(\\tau) \\exp(-\\tau) \\right) = -B_{\\nu_0}(T) \\exp(-\\tau) $$\nWe integrate this equation from an arbitrary depth $\\tau$ to the bottom boundary $\\tau_0$:\n$$ \\int_{\\tau}^{\\tau_0} \\frac{d}{d\\tau'} \\left( I_{\\nu_0}(\\tau') \\exp(-\\tau') \\right) d\\tau' = \\int_{\\tau}^{\\tau_0} -B_{\\nu_0}(T) \\exp(-\\tau') d\\tau' $$\n$$ I_{\\nu_0}(\\tau_0) \\exp(-\\tau_0) - I_{\\nu_0}(\\tau) \\exp(-\\tau) = B_{\\nu_0}(T) (\\exp(-\\tau_0) - \\exp(-\\tau)) $$\nNow we solve for $I_{\\nu_0}(\\tau)$:\n$$ I_{\\nu_0}(\\tau) \\exp(-\\tau) = I_{\\nu_0}(\\tau_0) \\exp(-\\tau_0) - B_{\\nu_0}(T) \\exp(-\\tau_0) + B_{\\nu_0}(T) \\exp(-\\tau) $$\n$$ I_{\\nu_0}(\\tau) = I_{\\nu_0}(\\tau_0) \\exp(-(\\tau_0 - \\tau)) + B_{\\nu_0}(T) (1 - \\exp(-(\\tau_0 - \\tau))) $$\nThis is the formal solution of the RTE. Substituting the boundary condition at the bottom of the slab, $I_{\\nu_0}(\\tau_0) = I_c$:\n$$ I_{\\nu_0}(\\tau) = I_c \\exp(-(\\tau_0 - \\tau)) + B_{\\nu_0}(T) (1 - \\exp(-(\\tau_0 - \\tau))) $$\nThe problem asks for the emergent specific intensity from the top of the slab, which is $I_{\\nu_0}(0)$. We evaluate the expression at $\\tau = 0$:\n$$ I_{\\nu_0}(0) = I_c \\exp(-\\tau_0) + B_{\\nu_0}(T) (1 - \\exp(-\\tau_0)) $$\nThis is the final expression for the emergent intensity.\n\nNext, we analyze the absorption and emission regimes. A spectral line is observed in absorption if the emergent intensity is less than the background continuum, $I_{\\nu_0}(0)  I_c$. It is observed in emission if $I_{\\nu_0}(0)  I_c$. We examine the difference $I_{\\nu_0}(0) - I_c$:\n$$ I_{\\nu_0}(0) - I_c = I_c \\exp(-\\tau_0) + B_{\\nu_0}(T) (1 - \\exp(-\\tau_0)) - I_c $$\n$$ I_{\\nu_0}(0) - I_c = I_c (\\exp(-\\tau_0) - 1) + B_{\\nu_0}(T) (1 - \\exp(-\\tau_0)) $$\n$$ I_{\\nu_0}(0) - I_c = -I_c (1 - \\exp(-\\tau_0)) + B_{\\nu_0}(T) (1 - \\exp(-\\tau_0)) $$\n$$ I_{\\nu_0}(0) - I_c = (B_{\\nu_0}(T) - I_c) (1 - \\exp(-\\tau_0)) $$\nSince the optical depth $\\tau_0$ must be non-negative, the term $(1 - \\exp(-\\tau_0))$ is always greater than or equal to $0$. Assuming $\\tau_0 > 0$, the sign of $I_{\\nu_0}(0) - I_c$ is determined entirely by the sign of $(B_{\\nu_0}(T) - I_c)$.\n- **Absorption Regime:** An absorption line ($I_{\\nu_0}(0)  I_c$) occurs when $B_{\\nu_0}(T) - I_c  0$, which means $B_{\\nu_0}(T)  I_c$. Physically, the slab is \"colder\" than the background source, so it absorbs more radiation from the background than it emits, creating a deficit of intensity.\n- **Emission Regime:** An emission line ($I_{\\nu_0}(0)  I_c$) occurs when $B_{\\nu_0}(T) - I_c  0$, which means $B_{\\nu_0}(T)  I_c$. Physically, the slab is \"hotter\" than the background source, so it emits more radiation than it absorbs from the background, creating an excess of intensity.\n- **No Line Feature:** If $B_{\\nu_0}(T) = I_c$, then $I_{\\nu_0}(0) = I_c$ for any $\\tau_0$. The slab is in radiative equilibrium with the background, and no line feature is produced.\n\nFinally, we analyze the limiting behaviors for small and large $\\tau_0$.\n- **Optically Thin Limit ($\\tau_0 \\ll 1$):**\nFor small $\\tau_0$, we can use the first-order Taylor expansion $\\exp(-\\tau_0) \\approx 1 - \\tau_0$. Substituting this into the expression for $I_{\\nu_0}(0)$:\n$$ I_{\\nu_0}(0) \\approx I_c (1 - \\tau_0) + B_{\\nu_0}(T) (1 - (1 - \\tau_0)) $$\n$$ I_{\\nu_0}(0) \\approx I_c - I_c \\tau_0 + B_{\\nu_0}(T) \\tau_0 $$\n$$ I_{\\nu_0}(0) \\approx I_c + (B_{\\nu_0}(T) - I_c) \\tau_0 $$\nIn the optically thin limit, the line strength, $|I_{\\nu_0}(0) - I_c|$, is directly proportional to the optical depth $\\tau_0$. The slab is mostly transparent, and the deviation from the continuum level is small.\n\n- **Optically Thick Limit ($\\tau_0 \\gg 1$):**\nFor large $\\tau_0$, the term $\\exp(-\\tau_0)$ approaches $0$. The expression for $I_{\\nu_0}(0)$ becomes:\n$$ \\lim_{\\tau_0 \\to \\infty} I_{\\nu_0}(0) = I_c \\cdot 0 + B_{\\nu_0}(T) (1 - 0) = B_{\\nu_0}(T) $$\nIn the optically thick limit, the emergent intensity equals the Planck function at the slab's temperature. The slab is opaque, so no radiation from the background source $I_c$ can pass through. An observer sees only the thermal emission from the top layers of the slab, and the line is said to be saturated. The intensity at line center drops or rises to the value of the Planck function $B_{\\nu_0}(T)$, regardless of the background intensity.",
            "answer": "$$\n\\boxed{I_c \\exp(-\\tau_0) + B_{\\nu_0}(T) (1 - \\exp(-\\tau_0))}\n$$"
        },
        {
            "introduction": "Theoretical understanding of spectral lines must be paired with the practical realities of observation, where detecting faint signals is a battle against noise. This computational exercise moves from pure theory to observational strategy, exploring the crucial trade-off between resolving a line shape (favoring high resolution) and maximizing the photons per spectral bin to beat detector noise (favoring low resolution). Finding the optimal resolving power, $R^{\\star}$, is a realistic task faced by astronomers when planning observations, making this a vital bridge between theory and practice .",
            "id": "4152731",
            "problem": "An exoplanet transmission spectrum exhibits narrow atmospheric absorption lines originating from molecular species. Consider a single isolated absorption line at wavelength $\\lambda_0$ observed with a spectrograph of resolving power $R$, defined by $R = \\lambda_0 / \\Delta \\lambda_{\\mathrm{FWHM}}$, where $\\Delta \\lambda_{\\mathrm{FWHM}}$ is the instrument Full Width at Half Maximum in wavelength units. Assume the instrument line spread function is Gaussian. The intrinsic line profile is Gaussian due to thermal (Doppler) and pressure broadening with standard deviation $\\sigma_{\\mathrm{line}}$ (in meters), and has equivalent width $W_{\\mathrm{eq}}$ (in meters). The observed line is the convolution of the intrinsic line with the instrument line spread function, both Gaussian.\n\nPhoton detection is subject to Poisson noise and detector read noise. Let $C_{\\lambda}$ be the continuum photon counts per unit wavelength (in counts per meter) at $\\lambda_0$, integrated over the total exposure time and telescope area, and let $N_r$ be the detector read noise per spectral bin (in counts). The spectrograph samples each resolution element with $s$ bins, so the bin width is $\\delta \\lambda = \\lambda_0 / (R s)$.\n\nUsing the following foundational principles and definitions only, derive a quantitative expression for the detection significance of the line as a function of $R$, and implement an algorithm to find the optimal resolving power $R^\\star$ within a specified integer range that maximizes the detection significance:\n\n- Conservation of equivalent width under convolution for weak lines: the equivalent width $W_{\\mathrm{eq}}$ of an absorption line is preserved under convolution with an instrumental profile. For a Gaussian line with peak fractional depth $D$ and standard deviation $\\sigma$, the equivalent width satisfies $W_{\\mathrm{eq}} = \\sqrt{2 \\pi} \\, D \\, \\sigma$.\n- Convolution of Gaussians: the convolution of two Gaussian profiles with standard deviations $\\sigma_1$ and $\\sigma_2$ is Gaussian with standard deviation $\\sigma_{\\mathrm{obs}} = \\sqrt{\\sigma_1^2 + \\sigma_2^2}$.\n- Relation between Gaussian standard deviation and Full Width at Half Maximum: $\\Delta \\lambda_{\\mathrm{FWHM}} = 2 \\sqrt{2 \\ln 2} \\, \\sigma$.\n- Definition of resolving power: $R = \\lambda_0 / \\Delta \\lambda_{\\mathrm{FWHM}}$.\n- Signal-to-Noise Ratio (SNR) for detecting a known shape in additive noise using a matched filter: the optimal SNR scales with the square root of the integral of the squared fractional line profile divided by the noise variance density. Assume the fractional absorption measurement in each bin is formed by dividing by the local continuum, and the noise variance per bin is the sum of photon noise and read noise contributions appropriately normalized by the continuum counts in that bin.\n\nScientific realism constraints:\n- Treat the absorption line as weak (linear regime), so equivalent width conservation holds.\n- Treat Poisson noise and read noise as independent and additive in variance.\n- Assume uniform continuum counts per unit wavelength across the narrow region of the line.\n- Assume Gaussian shapes for intrinsic and instrumental profiles.\n\nYour program must:\n1. Derive and implement a function $\\mathrm{SNR}(R)$ that maps integer $R$ to a scalar detection significance based on the principles above.\n2. For each test case, search integer $R$ in the inclusive range $[R_{\\min}, R_{\\max}]$ and return the integer $R^\\star$ that maximizes $\\mathrm{SNR}(R)$. In case of ties, return the smallest $R$ achieving the maximum.\n3. The output for all test cases must be a single line containing a comma-separated list of the optimal $R^\\star$ values enclosed in square brackets with no spaces. Resolving power $R$ is dimensionless; print integer values with no units.\n\nImplement the algorithm and evaluate it on the following test suite. All wavelength-related quantities are in meters, counts are dimensionless counts, and the sampling factor $s$ is dimensionless. Use these parameters as given:\n\n- Test case 1 (photon-noise dominated, narrow line): $\\lambda_0 = 7.60 \\times 10^{-7}$, $\\sigma_{\\mathrm{line}} = 6.00 \\times 10^{-12}$, $W_{\\mathrm{eq}} = 1.00 \\times 10^{-11}$, $C_{\\lambda} = 3.00 \\times 10^{15}$, $N_r = 5.0$, $s = 3$, $R_{\\min} = 20000$, $R_{\\max} = 150000$.\n- Test case 2 (read-noise impacted): $\\lambda_0 = 7.60 \\times 10^{-7}$, $\\sigma_{\\mathrm{line}} = 6.00 \\times 10^{-12}$, $W_{\\mathrm{eq}} = 1.00 \\times 10^{-11}$, $C_{\\lambda} = 3.00 \\times 10^{15}$, $N_r = 100.0$, $s = 3$, $R_{\\min} = 20000$, $R_{\\max} = 150000$.\n- Test case 3 (broader line, moderate counts): $\\lambda_0 = 1.25 \\times 10^{-6}$, $\\sigma_{\\mathrm{line}} = 4.00 \\times 10^{-11}$, $W_{\\mathrm{eq}} = 2.00 \\times 10^{-10}$, $C_{\\lambda} = 1.00 \\times 10^{15}$, $N_r = 10.0$, $s = 3$, $R_{\\min} = 5000$, $R_{\\max} = 80000$.\n- Test case 4 (very narrow line, low read noise, extended range): $\\lambda_0 = 7.60 \\times 10^{-7}$, $\\sigma_{\\mathrm{line}} = 1.00 \\times 10^{-12}$, $W_{\\mathrm{eq}} = 5.00 \\times 10^{-12}$, $C_{\\lambda} = 5.00 \\times 10^{14}$, $N_r = 2.0$, $s = 3$, $R_{\\min} = 20000$, $R_{\\max} = 300000$.\n\nFinal output format:\n- Your program should produce a single line of output containing the optimal resolving powers for the four test cases as a comma-separated list enclosed in square brackets (e.g., \"[R1,R2,R3,R4]\"), with each $R_i$ an integer. No other text should be printed.",
            "solution": "### Principle-Based Solution Derivation\n\nThe goal is to derive an expression for the squared signal-to-noise ratio, $\\mathrm{SNR}^2$, as a function of the spectrograph's resolving power, $R$. Maximizing $\\mathrm{SNR}(R)$ is equivalent to maximizing $\\mathrm{SNR}^2(R)$.\n\n1.  **Observed Line Profile:**\n    The instrumental line spread function (LSF) is Gaussian. Its Full Width at Half Maximum is $\\Delta\\lambda_{\\mathrm{FWHM}} = \\lambda_0/R$. The standard deviation of the LSF, $\\sigma_{\\mathrm{inst}}$, is given by the relation $\\Delta \\lambda_{\\mathrm{FWHM}} = 2\\sqrt{2\\ln 2} \\, \\sigma_{\\mathrm{inst}}$.\n    $$ \\sigma_{\\mathrm{inst}}(R) = \\frac{\\Delta\\lambda_{\\mathrm{FWHM}}}{2\\sqrt{2\\ln 2}} = \\frac{\\lambda_0}{R \\cdot 2\\sqrt{2\\ln 2}} $$\n    The intrinsic line profile is also Gaussian with a given standard deviation $\\sigma_{\\mathrm{line}}$. The observed profile is the convolution of these two Gaussians, resulting in a Gaussian profile with a standard deviation $\\sigma_{\\mathrm{obs}}$.\n    $$ \\sigma_{\\mathrm{obs}}(R) = \\sqrt{\\sigma_{\\mathrm{line}}^2 + \\sigma_{\\mathrm{inst}}(R)^2} = \\sqrt{\\sigma_{\\mathrm{line}}^2 + \\left(\\frac{\\lambda_0}{R \\cdot 2\\sqrt{2\\ln 2}}\\right)^2} $$\n\n2.  **Signal Strength:**\n    The signal is the fractional absorption profile, $f(\\lambda)$. For a matched filter, the total signal power is proportional to the integral of the squared profile, $\\int f(\\lambda)^2 d\\lambda$. The observed profile is $f(\\lambda) = D_{\\mathrm{obs}} \\exp\\left(-\\frac{(\\lambda-\\lambda_0)^2}{2\\sigma_{\\mathrm{obs}}^2}\\right)$, where $D_{\\mathrm{obs}}$ is the peak fractional depth. The equivalent width, $W_{\\mathrm{eq}}$, is conserved, meaning $W_{\\mathrm{eq}} = \\sqrt{2\\pi} D_{\\mathrm{obs}} \\sigma_{\\mathrm{obs}}$. From this, we find $D_{\\mathrm{obs}} = \\frac{W_{\\mathrm{eq}}}{\\sqrt{2\\pi}\\sigma_{\\mathrm{obs}}}$.\n    The integral of the squared profile is:\n    $$ \\int_{-\\infty}^{\\infty} f(\\lambda)^2 d\\lambda = \\int_{-\\infty}^{\\infty} D_{\\mathrm{obs}}^2 \\exp\\left(-\\frac{(\\lambda-\\lambda_0)^2}{\\sigma_{\\mathrm{obs}}^2}\\right) d\\lambda = D_{\\mathrm{obs}}^2 \\sqrt{\\pi} \\sigma_{\\mathrm{obs}} $$\n    Substituting the expression for $D_{\\mathrm{obs}}$:\n    $$ \\int f(\\lambda)^2 d\\lambda = \\left(\\frac{W_{\\mathrm{eq}}}{\\sqrt{2\\pi}\\sigma_{\\mathrm{obs}}}\\right)^2 \\sqrt{\\pi} \\sigma_{\\mathrm{obs}} = \\frac{W_{\\mathrm{eq}}^2}{2\\pi\\sigma_{\\mathrm{obs}}^2} \\sqrt{\\pi} \\sigma_{\\mathrm{obs}} = \\frac{W_{\\mathrm{eq}}^2}{2\\sqrt{\\pi}\\sigma_{\\mathrm{obs}}(R)} $$\n\n3.  **Noise Variance:**\n    The spectrograph samples the spectrum with a bin width of $\\delta\\lambda = \\lambda_0 / (Rs)$.\n    The number of continuum counts in one spectral bin is $N_{\\mathrm{bin}} = C_{\\lambda} \\delta\\lambda$.\n    The total variance in counts per bin is the sum of the photon shot noise variance ($N_{\\mathrm{bin}}$) and the detector read noise variance ($N_r^2$).\n    $$ \\sigma_{\\mathrm{counts}}^2 = N_{\\mathrm{bin}} + N_r^2 = C_{\\lambda}\\delta\\lambda + N_r^2 $$\n    The fractional noise variance per bin, $\\sigma_{\\mathrm{frac}}^2$, is obtained by normalizing by the squared continuum counts in that bin:\n    $$ \\sigma_{\\mathrm{frac}}^2 = \\frac{\\sigma_{\\mathrm{counts}}^2}{N_{\\mathrm{bin}}^2} = \\frac{C_{\\lambda}\\delta\\lambda + N_r^2}{(C_{\\lambda}\\delta\\lambda)^2} $$\n\n4.  **Signal-to-Noise Ratio (SNR):**\n    The squared SNR for an optimal matched filter is the integrated squared signal profile divided by the noise power spectral density. The noise power spectral density, $\\mathcal{N}_0$, is the variance per unit bandwidth, which is $\\sigma_{\\mathrm{frac}}^2 / (1/\\delta\\lambda) = \\sigma_{\\mathrm{frac}}^2 \\delta\\lambda$.\n    $$ \\mathrm{SNR}^2 = \\frac{\\int f(\\lambda)^2 d\\lambda}{\\mathcal{N}_0} = \\frac{\\int f(\\lambda)^2 d\\lambda}{\\sigma_{\\mathrm{frac}}^2 \\delta\\lambda} $$\n    Substituting the expressions for the integrated signal and the fractional noise variance:\n    $$ \\mathrm{SNR}^2(R) = \\frac{1}{\\delta\\lambda} \\cdot \\frac{(C_{\\lambda}\\delta\\lambda)^2}{C_{\\lambda}\\delta\\lambda + N_r^2} \\cdot \\frac{W_{\\mathrm{eq}}^2}{2\\sqrt{\\pi}\\sigma_{\\mathrm{obs}}(R)} $$\n    $$ \\mathrm{SNR}^2(R) = \\frac{C_{\\lambda}^2 \\delta\\lambda}{C_{\\lambda}\\delta\\lambda + N_r^2} \\cdot \\frac{W_{\\mathrm{eq}}^2}{2\\sqrt{\\pi}\\sigma_{\\mathrm{obs}}(R)} $$\n    Finally, substituting the $R$-dependent expressions for $\\delta\\lambda$ and $\\sigma_{\\mathrm{obs}}$ gives the function to be maximized:\n    $$ \\mathrm{SNR}^2(R) = \\frac{C_{\\lambda}^2 \\left(\\frac{\\lambda_0}{Rs}\\right)}{C_{\\lambda}\\left(\\frac{\\lambda_0}{Rs}\\right) + N_r^2} \\cdot \\frac{W_{\\mathrm{eq}}^2}{2\\sqrt{\\pi}\\sqrt{\\sigma_{\\mathrm{line}}^2 + \\left(\\frac{\\lambda_0}{R \\cdot 2\\sqrt{2\\ln 2}}\\right)^2}} $$\n\n### Algorithmic Design\n\nThe derived expression for $\\mathrm{SNR}^2(R)$ is a function of a single variable, the integer resolving power $R$. To find the optimal resolving power $R^\\star$ that maximizes this function, a simple grid search algorithm is employed.\n\nFor each test case, the algorithm iterates through every integer value of $R$ from $R_{\\min}$ to $R_{\\max}$, inclusive. In each iteration, it calculates the value of $\\mathrm{SNR}^2(R)$ using the derived formula and the specific parameters for that test case. The algorithm maintains two variables: one to store the maximum $\\mathrm{SNR}^2$ value found so far and another to store the corresponding $R$ value. The stored maximum is updated only when a strictly greater $\\mathrm{SNR}^2$ value is computed. This ensures that in the case of a tie, the first (and therefore smallest) value of $R$ that achieves the maximum is retained, fulfilling the problem's tie-breaking condition. The final stored $R$ value is the optimal resolving power $R^\\star$.\n```python\nimport numpy as np\n\ndef calculate_snr_squared(R, lambda_0, sigma_line, Weq, C_lambda, N_r, s):\n    \"\"\"\n    Calculates the squared Signal-to-Noise Ratio (SNR^2) for a given resolving power R.\n    \n    The function implements the derived formula:\n    SNR^2(R) = [C_lambda^2 * delta_lambda / (C_lambda * delta_lambda + N_r^2)] * \n               [Weq^2 / (2 * sqrt(pi) * sigma_obs)]\n    \"\"\"\n    \n    # Check for R=0 to avoid division by zero, though R = R_min  0\n    if R == 0:\n        return 0.0\n\n    # 1. Calculate instrumental and observed line widths\n    # Constant relating Gaussian FWHM to standard deviation\n    fwhm_to_sigma_factor = 2.0 * np.sqrt(2.0 * np.log(2.0))\n    \n    # Standard deviation of the instrumental line spread function (LSF)\n    sigma_inst = lambda_0 / (R * fwhm_to_sigma_factor)\n    \n    # Standard deviation of the observed (convolved) line profile\n    sigma_obs = np.sqrt(sigma_line**2 + sigma_inst**2)\n    \n    # 2. Calculate the noise term\n    # Spectral bin width in meters\n    delta_lambda = lambda_0 / (R * s)\n    \n    # Number of continuum counts per bin\n    continuum_counts_per_bin = C_lambda * delta_lambda\n    \n    # Noise term: accounts for photon noise and read noise\n    # Numerator is (C_lambda * delta_lambda)^2\n    # Denominator is (C_lambda * delta_lambda + N_r^2)\n    # The whole term simplifies to (C_lambda^2 * delta_lambda)/( ... )\n    # after combining with other factors in the full SNR^2 derivation.\n    noise_factor = (C_lambda**2 * delta_lambda) / (continuum_counts_per_bin + N_r**2)\n    \n    # 3. Calculate the signal term\n    # This term is proportional to the integrated squared line profile\n    signal_factor = Weq**2 / (2.0 * np.sqrt(np.pi) * sigma_obs)\n    \n    # 4. Combine terms to get SNR^2\n    snr2 = noise_factor * signal_factor\n    \n    return snr2\n\ndef find_optimal_R(params):\n    \"\"\"\n    Finds the optimal integer resolving power R* that maximizes the SNR.\n    \n    Iterates through the range [R_min, R_max] and finds the R that gives the\n    maximum value from calculate_snr_squared.\n    \"\"\"\n    R_min = params['R_min']\n    R_max = params['R_max']\n    \n    max_snr_sq = -1.0\n    optimal_R = -1\n    \n    for R in range(R_min, R_max + 1):\n        snr_sq = calculate_snr_squared(\n            R,\n            params['lambda_0'],\n            params['sigma_line'],\n            params['Weq'],\n            params['C_lambda'],\n            params['N_r'],\n            params['s']\n        )\n        \n        if snr_sq  max_snr_sq:\n            max_snr_sq = snr_sq\n            optimal_R = R\n            \n    return optimal_R\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    test_cases = [\n        {\n            'lambda_0': 7.60e-7, 'sigma_line': 6.00e-12, 'Weq': 1.00e-11,\n            'C_lambda': 3.00e15, 'N_r': 5.0, 's': 3,\n            'R_min': 20000, 'R_max': 150000\n        },\n        {\n            'lambda_0': 7.60e-7, 'sigma_line': 6.00e-12, 'Weq': 1.00e-11,\n            'C_lambda': 3.00e15, 'N_r': 100.0, 's': 3,\n            'R_min': 20000, 'R_max': 150000\n        },\n        {\n            'lambda_0': 1.25e-6, 'sigma_line': 4.00e-11, 'Weq': 2.00e-10,\n            'C_lambda': 1.00e15, 'N_r': 10.0, 's': 3,\n            'R_min': 5000, 'R_max': 80000\n        },\n        {\n            'lambda_0': 7.60e-7, 'sigma_line': 1.00e-12, 'Weq': 5.00e-12,\n            'C_lambda': 5.00e14, 'N_r': 2.0, 's': 3,\n            'R_min': 20000, 'R_max': 300000\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        optimal_R = find_optimal_R(case)\n        results.append(str(optimal_R))\n\n    # Final print statement must match the required format exactly.\n    print(f\"[{','.join(results)}]\")\n\n# This part is for execution if the file is run as a script. \n# It is not part of the solution to be displayed.\n# solve()\n```",
            "answer": "[82647,38159,19044,178052]"
        }
    ]
}