{
    "hands_on_practices": [
        {
            "introduction": "在模拟行星大气中的散射时，首要步骤是确定光与粒子相互作用的性质，这取决于粒子尺寸与光波长的相对大小。本练习旨在介绍无量纲尺寸参数 $x$，这是一个用于判断应使用简单的瑞利散射近似还是复杂的米氏散射理论的关键物理量。通过这个实践，您将巩固对定义不同散射机制物理条件的理解，并学会如何为特定场景选择合适的理论模型 。",
            "id": "4175752",
            "problem": "一颗暖海王星的系外行星透射光谱显示出与亚微米气溶胶散射一致的连续谱斜率。在以近红外真空波长 $\\lambda$ 为中心的特定观测窗口中，根据微物理建模推断，该行星临边光化学产生的霾具有一个模态粒子半径 $a$。假设霾粒子是均匀球体，且背景气体在此窗口内是非吸收性的。从平面波被球体散射的电磁波传播和边值问题出发，使用波数和粒子半径作为相关的量纲输入，构建在长波极限下控制角散射和效率因子的无量纲尺寸参数。然后，根据以下观测上合理的参数计算其值，并根据其与1的相对大小，判断瑞利散射还是洛伦兹-米氏散射描述更适合用于模拟该波段中与波长相关的不透明度。\n\n给定：\n- 粒子半径 $a = 0.01\\,\\mu\\mathrm{m}$。\n- 波长 $\\lambda = 0.80\\,\\mu\\mathrm{m}$。\n\n将计算出的尺寸参数的最终数值表示为一个无单位的量。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求构建控制球形粒子电磁散射的无量纲尺寸参数，根据给定参数进行数值计算，并评估合适的散射模型。\n\n电磁平面波与均匀球形粒子的相互作用由洛伦兹-米氏理论描述，该理论为这个边值问题提供了麦克斯韦方程的精确解。入射平面波由其波矢 $\\vec{k}$ 表征，其大小为波数 $k$。波数通过 $k = n_{med} \\frac{2\\pi}{\\lambda}$ 与真空波长 $\\lambda$ 及介质的折射率 $n_{med}$ 相关。问题陈述背景气体是非吸收性的，对于近红外波段的典型行星大气气体，折射率非常接近于1，即 $n_{med} \\approx 1$。因此，我们可以将波数近似为 $k = \\frac{2\\pi}{\\lambda}$。该量具有长度倒数的量纲，并代表波的空间频率。\n\n散射体是一个半径为 $a$ 的均匀球体。这是粒子的特征长度尺度。\n\n在求解矢量波动方程时，通过使用一个特征长度对空间坐标进行归一化，使其无量纲化。自然的选择是波数的倒数，$1/k = \\lambda/(2\\pi)$。当在球体表面（半径 $r=a$ 处）应用边界条件时，乘积 $kr$ 成为一个关键变量。具体来说，在边界上，该变量取值为 $ka$。这个乘积是无量纲的，因为它是两个长度之比，即粒子半径 $a$ 与约化波长 $\\lambda/(2\\pi)$之比。\n\n这个无量纲量被称为尺寸参数，通常用 $x$ 或 $\\alpha$ 表示。它由波数 $k$ 和粒子半径 $a$ 的乘积构成：\n$$x = ka$$\n代入波数的表达式 $k = \\frac{2\\pi}{\\lambda}$，我们得到尺寸参数的标准定义：\n$$x = \\frac{2\\pi a}{\\lambda}$$\n尺寸参数在物理上代表粒子周长与入射波长之比。整个散射过程的特性——包括散射效率、吸收效率和散射光的角分布（相函数）——都由尺寸参数 $x$ 和粒子相对于介质的复折射率决定。\n\n尺寸参数 $x$ 相对于1的大小决定了适用的物理机制：\n1.  **瑞利散射机制**：当 $x \\ll 1$ 时，粒子远小于光的波长。在这个长波极限下，完整的洛伦兹-米氏级数解可以截断到其第一项（电偶极子项），从而得到一组简单得多的方程。散射效率 $Q_{sca}$ 与 $x^4$ 成正比，这导致了经典的散射强度对 $\\lambda^{-4}$ 的依赖性。\n2.  **米氏散射机制（或洛伦兹-米氏机制）**：当 $x \\ge 1$ 时（或更普遍地，对于任何瑞利近似不成立的 $x$，例如 $x \\gtrsim 0.1$），必须计算完整的级数解。散射行为是复杂的，其特征是效率因子的振荡和高度结构化的前向散射相函数。术语“米氏散射”在技术上指适用于所有 $x$ 的完整理论，但在实践中，它用于表示粒子尺寸与波长相当或更大，且瑞利散射的简化假设失效的机制。\n\n现在，我们为给定的观测参数计算尺寸参数 $x$ 的值：\n- 粒子半径：$a = 0.01\\,\\mu\\mathrm{m}$\n- 波长：$\\lambda = 0.80\\,\\mu\\mathrm{m}$\n\n使用尺寸参数的公式：\n$$x = \\frac{2\\pi a}{\\lambda} = \\frac{2\\pi (0.01\\,\\mu\\mathrm{m})}{0.80\\,\\mu\\mathrm{m}}$$\n$\\mu\\mathrm{m}$ 的单位相消，按要求得到一个无量纲的结果。\n$$x = \\frac{0.02\\pi}{0.80} = \\frac{2\\pi}{80} = \\frac{\\pi}{40}$$\n对其进行数值计算：\n$$x = \\frac{\\pi}{40} \\approx 0.0785398...$$\n问题要求将结果四舍五入至四位有效数字。计算值为 $x \\approx 0.0785398...$。从第一个非零数字（7）开始数四位，得到 $0.07853$。第五位有效数字是 $9$，大于或等于5，因此向前一位进位。所以，舍入到四位有效数字的结果是 $0.07854$。\n\n计算出的尺寸参数值为 $x \\approx 0.07854$。\n为了确定合适的散射模型，我们将此值与1进行比较。\n$$0.07854 \\ll 1$$\n由于尺寸参数远小于$1$，满足了瑞利散射机制的条件。因此，对于在此特定观测窗口中模拟与波长相关的不透明度，更简单的瑞利散射描述是合适的，并且在物理上是合理的。尽管洛伦兹-米氏理论普遍有效，但其应用在计算上会更昂贵，并且在此极限下会产生收敛于瑞利近似的结果。因此，瑞利模型是合适的选择。",
            "answer": "$$\\boxed{0.07854}$$"
        },
        {
            "introduction": "确定了适用的散射机制后，下一步是考虑粒子本身的材料属性。本练习将探讨粒子吸收光的能力（由其复折射率的虚部 $k$ 表征）如何影响散射过程。通过在瑞利散射极限下推导单次散射反照率 $\\varpi_0$，您将深入理解散射与吸收之间的基本权衡关系，这对于建立精确的辐射传输模型至关重要 。",
            "id": "4175746",
            "problem": "考虑一个半径为 $a$ 的均匀、各向同性的球形霾粒子，悬浮在背景折射率为1的非吸收性系外行星大气中。在自由空间波长 $\\lambda$ 处，该粒子的复折射率为 $m(\\lambda) = n(\\lambda) + i\\,k(\\lambda)$，其中 $n(\\lambda)$ 和 $k(\\lambda)$ 分别是其实部和虚部。假设适用瑞利区条件 $x \\equiv 2\\pi a/\\lambda \\ll 1$，并且在入射单色平面波的作用下，粒子的响应可以被视为一个感生电偶极子。\n\n从球体表面的电磁边界条件和 $x \\ll 1$ 所隐含的偶极子近似出发，推导粒子的电偶极化率 $\\alpha(\\lambda)$，用 $a$ 和 $m(\\lambda)$ 表示。然后，利用米氏理论的瑞利极限渐近式以及光学定理，获得散射效率 $Q_{\\mathrm{sca}}$ 和吸收效率 $Q_{\\mathrm{abs}}$ 关于尺寸参数 $x$ 和复材料对比度的解析表达式。将单次散射反照率 (SSA) 定义为 $\\varpi_0 \\equiv Q_{\\mathrm{sca}}/Q_{\\mathrm{ext}}$，其中 $Q_{\\mathrm{ext}} \\equiv Q_{\\mathrm{sca}} + Q_{\\mathrm{abs}}$。在光学和近红外波段，对于许多系外行星的云和霾物质，在物理相关条件 $x \\ll 1$ 和 $k \\ll n$ 下，分析在固定的 $n$ 和 $x$ 时 $\\partial \\varpi_0 / \\partial k$ 的情况，以说明增加 $k$ 如何导致 $\\varpi_0$ 减小。\n\n你的最终答案必须是瑞利极限下 $\\varpi_0(n,k,x)$ 的一个单一闭式解析表达式，用 $n$、$k$ 和 $x$ 表示。不需要进行数值计算，最终表达式中不应包含单位。",
            "solution": "这个问题要求在瑞利散射区（$x \\equiv 2\\pi a/\\lambda \\ll 1$）下，推导球形粒子的电偶极化率 $\\alpha$、散射效率 $Q_{\\mathrm{sca}}$ 和吸收效率 $Q_{\\mathrm{abs}}$，以及单次散射反照率 $\\varpi_0$。推导过程分为三个主要部分。\n\n### 第1步：问题验证\n\n**提取的已知条件：**\n*   粒子是半径为 $a$ 的均匀、各向同性的球体。\n*   粒子悬浮在背景折射率为1的非吸收介质中。\n*   粒子的复折射率为 $m(\\lambda) = n(\\lambda) + i\\,k(\\lambda)$。\n*   适用瑞利区条件：$x \\equiv 2\\pi a/\\lambda \\ll 1$。\n*   粒子的响应被视为感生电偶极子。\n*   入射波是单色平面波。\n*   定义：$\\varpi_0 \\equiv Q_{\\mathrm{sca}}/Q_{\\mathrm{ext}}$，其中 $Q_{\\mathrm{ext}} \\equiv Q_{\\mathrm{sca}} + Q_{\\mathrm{abs}}$。\n*   分析条件：$x \\ll 1$ 和 $k \\ll n$。\n\n**验证：**\n1.  **科学依据：** 该问题坚实地植根于经典电磁学和光散射理论（瑞利极限下的米氏理论）。所有概念在物理学和大气/行星科学中都是标准内容。\n2.  **适定性：** 该问题提供了足够的信息来推导所要求量的唯一且有意义的表达式。\n3.  **客观性：** 语言精确，没有主观性。\n\n该问题是一个标准的教科书推导，不包含任何科学或逻辑上的缺陷。问题是 **有效的**。\n\n### 第2步：粒子极化率 $\\alpha$ 的推导\n\n在瑞利极限（$a \\ll \\lambda$）下，入射电场 $\\vec{E}_{\\mathrm{inc}}$ 在粒子上的空间变化可以忽略不计。我们可以将这个问题视为一个半径为 $a$、复相对介电常数为 $\\epsilon_r = m^2$ 的电介质球，置于一个静态、均匀的外部电场 $\\vec{E}_0 = E_0\\hat{z}$ 中。周围介质的相对介电常数为 $\\epsilon_1=1^2=1$，因此其介电常数为 $\\epsilon_0$。粒子的介电常数为 $\\epsilon_2 = m^2\\epsilon_0$。\n\n标量势 $\\Phi$ 必须满足拉普拉斯方程 $\\nabla^2\\Phi=0$。在球坐标系中，对于方位对称的情况，通解是勒让德多项式的和。在球外（$r > a$），电势是外部电场引起的电势与感生偶极子电势之和：\n$$ \\Phi_{\\mathrm{out}}(r, \\theta) = -E_0 r \\cos\\theta + \\frac{p}{4\\pi\\epsilon_0 r^2} \\cos\\theta $$\n其中 $p$ 是感生偶极矩的大小。在球内（$r < a$），电势在原点处必须是有限的，因此其形式必须为：\n$$ \\Phi_{\\mathrm{in}}(r, \\theta) = -E_{\\mathrm{in}} r \\cos\\theta $$\n其中 $E_{\\mathrm{in}}$ 是球内的均匀电场。\n\n在球体表面（$r=a$）的电磁边界条件是：\n1.  切向电场连续，这意味着电势连续：$\\Phi_{\\mathrm{in}}(a, \\theta) = \\Phi_{\\mathrm{out}}(a, \\theta)$。\n2.  电位移场法向分量连续：$\\epsilon_2 \\frac{\\partial \\Phi_{\\mathrm{in}}}{\\partial r}\\Big|_{r=a} = \\epsilon_0 \\frac{\\partial \\Phi_{\\mathrm{out}}}{\\partial r}\\Big|_{r=a}$。\n\n应用这些条件：\n1.  $-E_{\\mathrm{in}} a \\cos\\theta = -E_0 a \\cos\\theta + \\frac{p}{4\\pi\\epsilon_0 a^2} \\cos\\theta \\implies -E_{\\mathrm{in}} a = -E_0 a + \\frac{p}{4\\pi\\epsilon_0 a^2}$\n2.  $m^2 \\epsilon_0 (-E_{\\mathrm{in}} \\cos\\theta) = \\epsilon_0 \\left(-E_0 \\cos\\theta - \\frac{2p}{4\\pi\\epsilon_0 a^3} \\cos\\theta\\right) \\implies m^2 E_{\\mathrm{in}} = E_0 + \\frac{2p}{4\\pi\\epsilon_0 a^3}$\n\n我们得到了一个关于 $E_{\\mathrm{in}}$ 和 $p$ 的二元线性方程组。从(1)式可得，$E_{\\mathrm{in}} = E_0 - \\frac{p}{4\\pi\\epsilon_0 a^3}$。将此代入(2)式：\n$$ m^2 \\left(E_0 - \\frac{p}{4\\pi\\epsilon_0 a^3}\\right) = E_0 + \\frac{2p}{4\\pi\\epsilon_0 a^3} $$\n$$ E_0(m^2 - 1) = \\frac{p}{4\\pi\\epsilon_0 a^3} (m^2 + 2) $$\n求解偶极矩 $p$：\n$$ p = 4\\pi\\epsilon_0 a^3 \\left(\\frac{m^2 - 1}{m^2 + 2}\\right) E_0 $$\n电偶极化率 $\\alpha$ 由关系式 $\\vec{p} = \\epsilon_0 \\alpha \\vec{E}_0$ 定义。因此，\n$$ \\alpha = 4\\pi a^3 \\frac{m^2 - 1}{m^2 + 2} $$\n\n### 第3步：散射和吸收效率的推导\n\n效率是各自的截面通过粒子的几何截面 $\\pi a^2$ 进行归一化得到的值。\n\n**散射效率 $Q_{\\mathrm{sca}}$**\n一个振荡的偶极子会辐射功率。由角频率为 $\\omega$ 的感生偶极子 $\\vec{p}$ 振荡所散射的时间平均功率由拉莫尔公式给出：\n$$ P_{\\mathrm{sca}} = \\frac{\\omega^4 |\\vec{p}|^2}{12\\pi\\epsilon_0 c^3} $$\n代入 $\\vec{p} = \\epsilon_0 \\alpha \\vec{E}_0$：\n$$ P_{\\mathrm{sca}} = \\frac{\\omega^4 |\\epsilon_0 \\alpha E_0|^2}{12\\pi\\epsilon_0 c^3} = \\frac{\\omega^4 \\epsilon_0 |\\alpha|^2 E_0^2}{12\\pi c^3} $$\n平面波的入射强度（辐照度）为 $I_{\\mathrm{inc}} = \\frac{1}{2}c\\epsilon_0 E_0^2$。散射截面为 $\\sigma_{\\mathrm{sca}} = P_{\\mathrm{sca}}/I_{\\mathrm{inc}}$：\n$$ \\sigma_{\\mathrm{sca}} = \\frac{\\omega^4 \\epsilon_0 |\\alpha|^2 E_0^2}{12\\pi c^3} \\frac{2}{c\\epsilon_0 E_0^2} = \\frac{\\omega^4 |\\alpha|^2}{6\\pi c^4} $$\n使用波数 $k_{\\mathrm{w}} = \\omega/c = 2\\pi/\\lambda$：\n$$ \\sigma_{\\mathrm{sca}} = \\frac{k_{\\mathrm{w}}^4}{6\\pi} |\\alpha|^2 $$\n散射效率为 $Q_{\\mathrm{sca}} = \\sigma_{\\mathrm{sca}}/(\\pi a^2)$：\n$$ Q_{\\mathrm{sca}} = \\frac{k_{\\mathrm{w}}^4}{6\\pi^2 a^2} |\\alpha|^2 = \\frac{k_{\\mathrm{w}}^4}{6\\pi^2 a^2} \\left|4\\pi a^3 \\frac{m^2 - 1}{m^2 + 2}\\right|^2 = \\frac{16\\pi^2 k_{\\mathrm{w}}^4 a^6}{6\\pi^2 a^2} \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 = \\frac{8}{3} (k_{\\mathrm{w}}a)^4 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 $$\n使用尺寸参数 $x = k_{\\mathrm{w}} a = 2\\pi a/\\lambda$，我们得到：\n$$ Q_{\\mathrm{sca}} = \\frac{8}{3} x^4 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 $$\n\n**吸收效率 $Q_{\\mathrm{abs}}$**\n粒子吸收的时间平均功率为 $P_{\\mathrm{abs}} = \\frac{1}{2}\\omega\\mathrm{Im}(\\vec{p} \\cdot \\vec{E}_{\\mathrm{inc}}^{*})$。当 $\\vec{p} = \\epsilon_0\\alpha\\vec{E}_{\\mathrm{inc}}$ 时：\n$$ P_{\\mathrm{abs}} = \\frac{1}{2}\\omega\\mathrm{Im}(\\epsilon_0\\alpha |\\vec{E}_{\\mathrm{inc}}|^2) = \\frac{1}{2}\\omega\\epsilon_0 E_0^2 \\mathrm{Im}(\\alpha) $$\n吸收截面为 $\\sigma_{\\mathrm{abs}} = P_{\\mathrm{abs}}/I_{\\mathrm{inc}}$：\n$$ \\sigma_{\\mathrm{abs}} = \\frac{\\frac{1}{2}\\omega\\epsilon_0 E_0^2 \\mathrm{Im}(\\alpha)}{\\frac{1}{2}c\\epsilon_0 E_0^2} = \\frac{\\omega}{c}\\mathrm{Im}(\\alpha) = k_{\\mathrm{w}}\\mathrm{Im}(\\alpha) $$\n吸收效率 $Q_{\\mathrm{abs}} = \\sigma_{\\mathrm{abs}}/(\\pi a^2)$ 为：\n$$ Q_{\\mathrm{abs}} = \\frac{k_{\\mathrm{w}}}{\\pi a^2} \\mathrm{Im}\\left(4\\pi a^3 \\frac{m^2 - 1}{m^2 + 2}\\right) = 4k_{\\mathrm{w}}a \\mathrm{Im}\\left(\\frac{m^2 - 1}{m^2 + 2}\\right) $$\n用 $x$ 表示，即为：\n$$ Q_{\\mathrm{abs}} = 4x \\, \\mathrm{Im}\\left(\\frac{m^2 - 1}{m^2 + 2}\\right) $$\n为了计算虚部，令 $m=n+ik$。那么 $m^2 = (n^2-k^2) + i(2nk)$。\n$$ \\frac{m^2-1}{m^2+2} = \\frac{(n^2-k^2-1) + i(2nk)}{(n^2-k^2+2) + i(2nk)} $$\n此表达式的虚部为：\n$$ \\mathrm{Im}\\left(\\frac{m^2-1}{m^2+2}\\right) = \\frac{(2nk)(n^2-k^2+2) - (n^2-k^2-1)(2nk)}{|m^2+2|^2} = \\frac{6nk}{|m^2+2|^2} $$\n因此，吸收效率为：\n$$ Q_{\\mathrm{abs}} = 4x \\frac{6nk}{|m^2+2|^2} = \\frac{24xnk}{(n^2-k^2+2)^2 + (2nk)^2} $$\n\n### 第4步：单次散射反照率 $\\varpi_0$ 及其分析\n\n单次散射反照率定义为 $\\varpi_0 = Q_{\\mathrm{sca}}/Q_{\\mathrm{ext}} = Q_{\\mathrm{sca}}/(Q_{\\mathrm{sca}} + Q_{\\mathrm{abs}})$。代入我们推导出的表达式：\n$$ \\varpi_0 = \\frac{\\frac{8}{3} x^4 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2}{\\frac{8}{3} x^4 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 + 4x \\, \\mathrm{Im}\\left(\\frac{m^2 - 1}{m^2 + 2}\\right)} $$\n分子和分母同除以 $4x$：\n$$ \\varpi_0 = \\frac{\\frac{2}{3} x^3 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2}{\\frac{2}{3} x^3 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 + \\mathrm{Im}\\left(\\frac{m^2 - 1}{m^2 + 2}\\right)} $$\n代入各项的展开形式：\n$$ \\varpi_0 = \\frac{\\frac{2}{3} x^3 \\frac{|m^2-1|^2}{|m^2+2|^2}}{\\frac{2}{3} x^3 \\frac{|m^2-1|^2}{|m^2+2|^2} + \\frac{6nk}{|m^2+2|^2}} $$\n分子和分母同乘以 $3|m^2+2|^2$ 得：\n$$ \\varpi_0 = \\frac{2 x^3 |m^2-1|^2}{2 x^3 |m^2-1|^2 + 18nk} $$\n展开 $|m^2-1|^2 = |(n^2-k^2-1)+i(2nk)|^2 = (n^2-k^2-1)^2 + 4n^2k^2$，我们得到 $\\varpi_0(n,k,x)$ 的最终表达式：\n$$ \\varpi_0 = \\frac{2 x^3 \\left((n^2-k^2-1)^2 + 4n^2k^2\\right)}{2 x^3 \\left((n^2-k^2-1)^2 + 4n^2k^2\\right) + 18nk} $$\n\n为了分析在 $k \\ll n$ 条件下 $\\varpi_0$ 对 $k$ 的依赖关系，我们考察其导数 $\\partial \\varpi_0 / \\partial k$。令 $A(k) = 2 x^3 |m^2-1|^2$ 和 $B(k) = 18nk$。则 $\\varpi_0 = A/(A+B)$。\n$$ \\frac{\\partial \\varpi_0}{\\partial k} = \\frac{\\frac{\\partial A}{\\partial k}(A+B) - A\\left(\\frac{\\partial A}{\\partial k} + \\frac{\\partial B}{\\partial k}\\right)}{(A+B)^2} = \\frac{B\\frac{\\partial A}{\\partial k} - A\\frac{\\partial B}{\\partial k}}{(A+B)^2} $$\n对于 $k \\ll n$：\n$|m^2-1|^2 \\approx |n^2-1|^2 = \\text{关于 } k \\text{ 的常数}$。所以 $A(k) \\approx 2 x^3 (n^2-1)^2$，且 $\\frac{\\partial A}{\\partial k} \\approx 0$。\n$B(k) = 18nk$ 项，所以 $\\frac{\\partial B}{\\partial k} = 18n$。\n将这些近似值代入导数中：\n$$ \\frac{\\partial \\varpi_0}{\\partial k} \\approx \\frac{(18nk)(0) - (2 x^3 (n^2-1)^2)(18n)}{(A+B)^2} = - \\frac{36 n x^3 (n^2-1)^2}{(A+B)^2} $$\n由于 $x>0$，$n>0$，且分母为正，所以 $\\partial \\varpi_0 / \\partial k  0$。这表明，增加折射率的虚部 $k$（即增加粒子的固有吸收）会降低单次散射反照率 $\\varpi_0$，这与物理预期相符。",
            "answer": "$$\\boxed{\\frac{2 x^{3} \\left(\\left(n^{2}-k^{2}-1\\right)^{2} + 4n^{2}k^{2}\\right)}{2 x^{3} \\left(\\left(n^{2}-k^{2}-1\\right)^{2} + 4n^{2}k^{2}\\right) + 18nk}}$$"
        },
        {
            "introduction": "这是本章的综合性实践，它将物理模型与实际应用联系起来，展示了如何利用瑞利散射和米氏散射的不同波长依赖性来解译观测数据。在这个动手练习中，您将使用贝叶斯模型比较这一强大的统计工具，来定量地判断哪种散射过程——是清澈的气体大气还是充满尘埃的大气——更能解释给定的系外行星光谱。这项练习代表了从理论物理到现代数据驱动的天文学研究的关键一步 。",
            "id": "4175768",
            "problem": "给定一个简化的线性化正向模型，用于描述系外行星大气中与波长相关的光衰减，该模型适用于瑞利散射和以米氏散射为主的霾。设可观测量为一个无量纲消光类物理量的自然对数，记为 $y(\\lambda)$，它被建模为波长相对于参考波长的对数的线性函数。定义 $x(\\lambda) \\equiv \\ln(\\lambda/\\lambda_0)$，其中 $\\lambda$ 的单位为微米，$\\lambda_0$ 为一个固定的参考波长，单位也为微米。假设测量误差是独立的高斯误差。\n\n竞争性假设：\n- 假设 $H_R$ (纯瑞利气体)：$y_i = b - 4\\,x_i + \\varepsilon_i$，其中 $b$ 是一个未知振幅，且 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma_i^2)$ 独立同分布。\n- 假设 $H_M$ (米氏主导的霾)：$y_i = b - \\alpha\\,x_i + \\varepsilon_i$，其中 $b$ 和 $\\alpha$ 是未知数，且 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma_i^2)$ 独立同分布。\n\n先验（选择对于系外行星大气是物理上现实的）：\n- 对于两个假设，$b \\sim \\mathcal{N}(\\mu_b,\\sigma_b^2)$，其中 $\\mu_b = -1.0$ 且 $\\sigma_b = 2.0$ (无量纲)。\n- 仅对于 $H_M$，$ \\alpha \\sim \\mathcal{N}(\\mu_\\alpha,\\sigma_\\alpha^2)$，其中 $\\mu_\\alpha = 1.5$ 且 $\\sigma_\\alpha = 1.0$ (无量纲)。\n- 对于 $H_R$，斜率固定为瑞利值 $4$（在 $H_R$ 下不需要为 $\\alpha$ 设置先验）。\n\n似然模型：\n- 对于一个包含 $n$ 个波长 $\\{\\lambda_i\\}_{i=1}^n$ 和测量值 $\\{y_i\\}_{i=1}^n$ 的数据集，假设误差是独立的，并服从标准差已知的高斯分布 $\\{\\sigma_i\\}_{i=1}^n$ (无量纲)。本问题不涉及角度。\n\n您的任务是，为下面测试套件中的每个数据集，计算比较 $H_R$ 和 $H_M$ 的贝叶斯因子的自然对数，即\n$$\\ln \\mathcal{B}_{R,M} \\equiv \\ln Z_R - \\ln Z_M,$$\n其中 $Z_R$ 和 $Z_M$ 分别是 $H_R$ 和 $H_M$ 的贝叶斯证据（边缘似然），通过对相应先验积分似然函数得到。计算必须使用自然对数和上文定义的标准国际单位制 (SI) 一致的无量纲单位。所有波长必须按给定的微米单位处理。每个数据集的输出必须是一个等于 $\\ln \\mathcal{B}_{R,M}$ 的实数（浮点数）。\n\n您必须使用的基本和建模假设：\n- 贝叶斯定理，其中证据定义为似然函数在先验上的积分。\n- 一旦用 $x_i = \\ln(\\lambda_i/\\lambda_0)$ 表示，正向模型在参数上是线性的。\n- 噪声模型是具有已知方差的独立高斯模型。\n\n参考波长：\n- 使用 $\\lambda_0 = 0.5$ 微米。\n\n测试套件（每个数据集都已完全指定，所有数字都应解释为精确值，除了通过 $\\sigma_i$ 在似然中编码的噪声外，没有额外的噪声）：\n- 数据集 1 (类瑞利，高信噪比)：\n  - 波长（微米）：$\\{0.4, 0.5, 0.6, 0.8, 1.0\\}$。\n  - 测量不确定度：$\\{\\sigma_i\\} = \\{0.02, 0.02, 0.02, 0.02, 0.02\\}$ (无量纲)。\n  - 合成数据生成（确定性）：$b_{\\mathrm{true}} = -1.2$, $\\alpha_{\\mathrm{true}} = 4.0$, $y_i = b_{\\mathrm{true}} - \\alpha_{\\mathrm{true}} \\ln(\\lambda_i/\\lambda_0)$。\n- 数据集 2 (类米氏，高信噪比)：\n  - 波长（微米）：$\\{0.4, 0.5, 0.6, 0.8, 1.0\\}$。\n  - 测量不确定度：$\\{\\sigma_i\\} = \\{0.02, 0.02, 0.02, 0.02, 0.02\\}$ (无量纲)。\n  - 合成数据生成（确定性）：$b_{\\mathrm{true}} = -1.2$, $\\alpha_{\\mathrm{true}} = 1.2$, $y_i = b_{\\mathrm{true}} - \\alpha_{\\mathrm{true}} \\ln(\\lambda_i/\\lambda_0)$。\n- 数据集 3 (模糊，低信噪比)：\n  - 波长（微米）：$\\{0.5, 0.7, 1.0\\}$。\n  - 测量不确定度：$\\{\\sigma_i\\} = \\{0.5, 0.5, 0.5\\}$ (无量纲)。\n  - 合成数据生成（确定性）：$b_{\\mathrm{true}} = -1.2$, $\\alpha_{\\mathrm{true}} = 3.0$, $y_i = b_{\\mathrm{true}} - \\alpha_{\\mathrm{true}} \\ln(\\lambda_i/\\lambda_0)$。\n\n程序要求：\n- 通过执行贝叶斯定理所蕴含的精确高斯积分，为具有高斯先验的线性高斯模型实现证据 $Z_R$ 和 $Z_M$ 的数值稳定计算。\n- 对于 $H_R$，通过将模型适当地转换为关于 $b$ 的单参数线性高斯问题来处理固定的瑞利斜率。\n- 为每个数据集计算 $\\ln \\mathcal{B}_{R,M}$，结果为浮点数。\n- 最终输出格式：您的程序应生成单行输出，其中包含三个结果，以逗号分隔并用方括号括起，例如 $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]$。每个浮点数必须精确到小数点后六位。\n- 单位：波长按指定的微米单位；所有其他量均为无量纲。不涉及角度。不涉及百分比。\n\n您的最终程序不得接受任何输入，并且必须按原样运行以产生所需的单行输出。",
            "solution": "问题陈述已经过验证，被认为是有效的。它具有科学依据、问题定义良好、客观，并包含推导唯一且有意义解所需的所有信息。所提供的模型是系外行星大气中瑞利和米氏散射现象的简化但具有物理动机的表示，计算贝叶斯因子是贝叶斯模型比较中的一个标准、定义明确的程序。\n\n问题的核心是计算贝叶斯因子的自然对数 $\\ln \\mathcal{B}_{R,M}$，该因子用于比较瑞利假设 ($H_R$) 与米氏假设 ($H_M$) 的证据。它由它们各自的对数证据之差给出：\n$$ \\ln \\mathcal{B}_{R,M} = \\ln Z_R - \\ln Z_M $$\n对于一个给定的模型，其证据 $Z$ 是边缘似然，通过对参数的先验分布积分似然函数得到。对于一个参数为 $\\mathbf{w}$、似然为 $\\mathcal{L}(\\mathbf{d}|\\mathbf{w})$、先验为 $\\pi(\\mathbf{w})$ 的模型，证据是 $Z = \\int \\mathcal{L}(\\mathbf{d}|\\mathbf{w}) \\pi(\\mathbf{w}) d\\mathbf{w}$。\n\n两个假设都是线性高斯模型的实例。这类模型的一般形式是 $\\mathbf{y} = \\mathbf{X}\\mathbf{w} + \\boldsymbol{\\varepsilon}$，其中 $\\mathbf{y}$ 是 $n \\times 1$ 的观测向量，$\\mathbf{X}$ 是 $n \\times k$ 的设计矩阵，$\\mathbf{w}$ 是 $k \\times 1$ 的参数向量，$\\boldsymbol{\\varepsilon}$ 是噪声向量。问题指定了高斯似然 $\\boldsymbol{\\varepsilon} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{C}_\\text{noise})$ 和参数上的高斯先验 $\\mathbf{w} \\sim \\mathcal{N}(\\mathbf{w}_0, \\mathbf{C}_\\text{prior})$。\n\n对于这类模型，证据的积分有解析解。对数证据 $\\ln Z$ 可以用数值稳定的形式表示为：\n$$ \\ln Z = -\\frac{1}{2} (\\mathbf{y} - \\mathbf{X}\\mathbf{w}_0)^T (\\mathbf{C}_\\text{noise} + \\mathbf{X}\\mathbf{C}_\\text{prior}\\mathbf{X}^T)^{-1} (\\mathbf{y} - \\mathbf{X}\\mathbf{w}_0) - \\frac{1}{2} \\ln |\\mathbf{C}_\\text{noise} + \\mathbf{X}\\mathbf{C}_\\text{prior}\\mathbf{X}^T| - \\frac{n}{2}\\ln(2\\pi) $$\n让我们定义矩阵 $\\mathbf{A} = \\mathbf{C}_\\text{noise} + \\mathbf{X}\\mathbf{C}_\\text{prior}\\mathbf{X}^T$ 和向量 $\\mathbf{v} = \\mathbf{y} - \\mathbf{X}\\mathbf{w}_0$。公式简化为：\n$$ \\ln Z = -\\frac{1}{2} \\left[ \\mathbf{v}^T \\mathbf{A}^{-1} \\mathbf{v} + \\ln|\\mathbf{A}| + n\\ln(2\\pi) \\right] $$\n在计算对数贝叶斯因子 $\\ln Z_R - \\ln Z_M$ 时，由于两个模型都应用于大小为 $n$ 的同一数据集，公共项 $\\frac{n}{2}\\ln(2\\pi)$ 会相互抵消。因此，我们只需要为每个假设计算其余的项。\n\n设给定数据集的数据为波长集合 $\\{\\lambda_i\\}_{i=1}^n$、测量值集合 $\\{y_i\\}_{i=1}^n$ 和不确定度集合 $\\{\\sigma_i\\}_{i=1}^n$。参考波长为 $\\lambda_0 = 0.5$。\n自变量为 $x_i = \\ln(\\lambda_i/\\lambda_0)$。\n观测向量为 $\\mathbf{y} = [y_1, \\dots, y_n]^T$。\n噪声协方差矩阵是对角矩阵，$\\mathbf{C}_\\text{noise} = \\text{diag}(\\sigma_1^2, \\dots, \\sigma_n^2)$。\n$b$ 的先验为 $\\mathcal{N}(\\mu_b, \\sigma_b^2)$，其中 $\\mu_b=-1.0$ 和 $\\sigma_b=2.0$。\n$\\alpha$ 的先验为 $\\mathcal{N}(\\mu_\\alpha, \\sigma_\\alpha^2)$，其中 $\\mu_\\alpha=1.5$ 和 $\\sigma_\\alpha=1.0$。\n\n**假设 $H_R$ (瑞利，斜率固定为 $-4$)：**\n模型为 $y_i = b - 4x_i + \\varepsilon_i$。为了将其纳入我们的线性模型框架，我们将其重排为 $y_i + 4x_i = b + \\varepsilon_i$。\n- 有效数据向量是 $\\mathbf{y}'_R = \\mathbf{y} + 4\\mathbf{x}$。\n- 参数向量是 $\\mathbf{w}_R = [b]$，它有 $k_R=1$ 个参数。\n- 设计矩阵 $\\mathbf{X}_R$ 是一个 $n \\times 1$ 的全一列向量。\n- 先验均值为 $\\mathbf{w}_{0,R} = [\\mu_b] = [-1.0]$。\n- 先验协方差是 $1 \\times 1$ 矩阵 $\\mathbf{C}_{\\text{prior},R} = [\\sigma_b^2] = [4.0]$。\n\n使用这些定义，$H_R$ 的对数证据项（不含常数）为：\n$$ \\ln Z'_R = -\\frac{1}{2} \\left[ (\\mathbf{y}'_R - \\mathbf{X}_R\\mathbf{w}_{0,R})^T \\mathbf{A}_R^{-1} (\\mathbf{y}'_R - \\mathbf{X}_R\\mathbf{w}_{0,R}) + \\ln|\\mathbf{A}_R| \\right] $$\n其中 $\\mathbf{A}_R = \\mathbf{C}_\\text{noise} + \\mathbf{X}_R \\mathbf{C}_{\\text{prior},R} \\mathbf{X}_R^T$。\n\n**假设 $H_M$ (米氏，可变斜率)：**\n模型为 $y_i = b - \\alpha x_i + \\varepsilon_i$。这可以写成 $y_i = [1, -x_i]\\begin{pmatrix} b \\\\ \\alpha \\end{pmatrix} + \\varepsilon_i$。\n- 数据向量为 $\\mathbf{y}$。\n- 参数向量为 $\\mathbf{w}_M = [b, \\alpha]^T$，它有 $k_M=2$ 个参数。\n- 设计矩阵 $\\mathbf{X}_M$ 是一个 $n \\times 2$ 的矩阵，其行为 $[1, -x_i]$。\n- 先验均值向量为 $\\mathbf{w}_{0,M} = [\\mu_b, \\mu_\\alpha]^T = [-1.0, 1.5]^T$。\n- 由于 $b$ 和 $\\alpha$ 的先验是独立的，先验协方差是对角的：$\\mathbf{C}_{\\text{prior},M} = \\text{diag}(\\sigma_b^2, \\sigma_\\alpha^2) = \\text{diag}(4.0, 1.0)$。\n\n$H_M$ 的对数证据项（不含常数）为：\n$$ \\ln Z'_M = -\\frac{1}{2} \\left[ (\\mathbf{y} - \\mathbf{X}_M\\mathbf{w}_{0,M})^T \\mathbf{A}_M^{-1} (\\mathbf{y} - \\mathbf{X}_M\\mathbf{w}_{0,M}) + \\ln|\\mathbf{A}_M| \\right] $$\n其中 $\\mathbf{A}_M = \\mathbf{C}_\\text{noise} + \\mathbf{X}_M \\mathbf{C}_{\\text{prior},M} \\mathbf{X}_M^T$。\n\n最终所需量为 $\\ln \\mathcal{B}_{R,M} = \\ln Z_R - \\ln Z_M = \\ln Z'_R - \\ln Z'_M$。\n在数值计算中，二次型 $\\mathbf{v}^T\\mathbf{A}^{-1}\\mathbf{v}$ 的计算方法是：首先求解线性方程组 $\\mathbf{A}\\mathbf{z} = \\mathbf{v}$ 得到 $\\mathbf{z}$，然后计算点积 $\\mathbf{v}^T\\mathbf{z}$。对数行列式 $\\ln|\\mathbf{A}|$ 使用类似 `numpy.linalg.slogdet` 的函数计算以保持数值精度。测试套件中提供的每个数据集都采用了这种方法实现。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_log_evidence_term(y_vec, X_mat, C_noise, w0_vec, C_prior):\n    \"\"\"\n    Computes the log-evidence for a linear-Gaussian model, excluding the\n    constant term -n/2 * ln(2*pi).\n    \n    Args:\n        y_vec (np.ndarray): The n x 1 observation vector.\n        X_mat (np.ndarray): The n x k design matrix.\n        C_noise (np.ndarray): The n x n noise covariance matrix.\n        w0_vec (np.ndarray): The k x 1 prior mean vector for parameters.\n        C_prior (np.ndarray): The k x k prior covariance matrix for parameters.\n\n    Returns:\n        float: The value of the log-evidence term.\n    \"\"\"\n    n, k = X_mat.shape\n\n    # A = C_noise + X * C_prior * X^T\n    A_mat = C_noise + X_mat @ C_prior @ X_mat.T\n\n    # v = y - X * w0\n    v_vec = y_vec - X_mat @ w0_vec\n    \n    # Calculate log-determinant of A\n    sign, log_det_A = np.linalg.slogdet(A_mat)\n    if sign = 0:\n        # This should not happen for a positive-definite matrix A\n        raise ValueError(\"Matrix A is not positive definite.\")\n        \n    # Calculate the quadratic term v^T * A^-1 * v\n    # This is done by solving A * z = v for z, then computing v^T * z.\n    # It is more numerically stable than computing the inverse of A.\n    z_vec = np.linalg.solve(A_mat, v_vec)\n    quad_term = v_vec.T @ z_vec\n    \n    # The log-evidence term is -0.5 * (quadratic term + log-determinant)\n    # The term involving ln(2*pi) cancels in the Bayes Factor.\n    log_z_prime = -0.5 * (quad_term.item() + log_det_A)\n    \n    return log_z_prime\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    # Priors and constants\n    lambda0 = 0.5  # micrometers\n    mu_b = -1.0\n    sigma_b = 2.0\n    mu_alpha = 1.5\n    sigma_alpha = 1.0\n\n    C_prior_b = np.array([[sigma_b**2]])\n    w0_R = np.array([mu_b]).reshape(-1, 1)\n\n    C_prior_M = np.diag([sigma_b**2, sigma_alpha**2])\n    w0_M = np.array([mu_b, mu_alpha]).reshape(-1, 1)\n\n    # Test suite\n    test_cases = [\n        {\n            \"lambdas\": np.array([0.4, 0.5, 0.6, 0.8, 1.0]),\n            \"sigmas\": np.array([0.02, 0.02, 0.02, 0.02, 0.02]),\n            \"b_true\": -1.2,\n            \"alpha_true\": 4.0,\n        },\n        {\n            \"lambdas\": np.array([0.4, 0.5, 0.6, 0.8, 1.0]),\n            \"sigmas\": np.array([0.02, 0.02, 0.02, 0.02, 0.02]),\n            \"b_true\": -1.2,\n            \"alpha_true\": 1.2,\n        },\n        {\n            \"lambdas\": np.array([0.5, 0.7, 1.0]),\n            \"sigmas\": np.array([0.5, 0.5, 0.5]),\n            \"b_true\": -1.2,\n            \"alpha_true\": 3.0,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        lambdas = case[\"lambdas\"]\n        sigmas = case[\"sigmas\"]\n        b_true = case[\"b_true\"]\n        alpha_true = case[\"alpha_true\"]\n        \n        n = len(lambdas)\n        \n        # 1. Pre-computation based on data\n        x_vec = np.log(lambdas / lambda0)\n        y_vec = b_true - alpha_true * x_vec\n        \n        # Reshape vectors to be n x 1 column vectors\n        x_vec = x_vec.reshape(-1, 1)\n        y_vec = y_vec.reshape(-1, 1)\n        \n        C_noise = np.diag(sigmas**2)\n\n        # 2. Calculate log-evidence for H_R (Rayleigh)\n        y_prime_R = y_vec + 4.0 * x_vec\n        X_R = np.ones((n, 1))\n        \n        log_Z_R_prime = calculate_log_evidence_term(\n            y_prime_R, X_R, C_noise, w0_R, C_prior_b\n        )\n        \n        # 3. Calculate log-evidence for H_M (Mie)\n        X_M = np.hstack((np.ones((n, 1)), -x_vec))\n        \n        log_Z_M_prime = calculate_log_evidence_term(\n            y_vec, X_M, C_noise, w0_M, C_prior_M\n        )\n        \n        # 4. Compute the log Bayes Factor\n        log_B_RM = log_Z_R_prime - log_Z_M_prime\n        results.append(log_B_RM)\n        \n    # Final output formatting\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}