{
    "hands_on_practices": [
        {
            "introduction": "The first step in modeling light scattering by atmospheric particles is to determine which physical regime applies. This crucial decision depends on the comparison between the particle's size and the wavelength of light, a relationship captured by the dimensionless size parameter, $x$. This exercise guides you through the process of calculating this fundamental parameter for a realistic exoplanet haze scenario, allowing you to determine whether the simpler Rayleigh scattering approximation is sufficient or if the full, more complex Lorenz-Mie theory is required .",
            "id": "4175752",
            "problem": "An exoplanetary transmission spectrum of a warm Neptune shows a continuum slope consistent with scattering by submicron aerosols. In a specific observation window centered at a vacuum wavelength $\\lambda$ in the near-infrared, the photochemically produced haze in the planet’s limb has a modal particle radius $a$ inferred from microphysical modeling. Assume the haze particles are homogeneous spheres and the background gas is non-absorbing in this window. Starting from electromagnetic wave propagation and boundary-value scattering of a plane wave by a sphere, construct the dimensionless size parameter that controls the angular scattering and efficiency factors in the long-wavelength limit, using the wave number and the particle radius as the relevant dimensional inputs. Then compute its value for the following observationally plausible parameters and, based on its magnitude relative to unity, identify whether the Rayleigh or Lorenz–Mie scattering description is appropriate for modeling the wavelength-dependent opacity in this band.\n\nGiven:\n- Particle radius $a = 0.01\\,\\mu\\mathrm{m}$.\n- Wavelength $\\lambda = 0.80\\,\\mu\\mathrm{m}$.\n\nExpress the final numerical value of the computed size parameter as a unitless quantity. Round your answer to four significant figures.",
            "solution": "The problem requires the construction of the dimensionless size parameter that governs electromagnetic scattering by a spherical particle, its numerical calculation for given parameters, and an assessment of the appropriate scattering model.\n\nThe interaction of an electromagnetic plane wave with a homogeneous spherical particle is described by the Lorenz–Mie theory, which provides an exact solution to Maxwell's equations for this boundary-value problem. The incident plane wave is characterized by its wave vector $\\vec{k}$, the magnitude of which is the wave number $k$. The wave number is related to the vacuum wavelength $\\lambda$ and the refractive index of the medium $n_{med}$ by $k = n_{med} \\frac{2\\pi}{\\lambda}$. The problem states the background gas is non-absorbing, and for a typical planetary atmosphere gas in the near-infrared, the refractive index is very close to unity, $n_{med} \\approx 1$. Therefore, we can approximate the wave number as $k = \\frac{2\\pi}{\\lambda}$. This quantity has dimensions of inverse length and represents the spatial frequency of the wave.\n\nThe scatterer is a homogeneous sphere of radius $a$. This is the characteristic length scale of the particle.\n\nIn solving the vector wave equation, the spatial coordinates are made dimensionless by normalizing them with a characteristic length. The natural choice is the inverse wave number, $1/k = \\lambda/(2\\pi)$. When applying the boundary conditions at the surface of the sphere (at radius $r=a$), the product $kr$ becomes a key variable. Specifically, at the boundary, this variable takes the value $ka$. This product is dimensionless, as it is the ratio of two lengths, the particle radius $a$ to the reduced wavelength $\\lambda/(2\\pi)$.\n\nThis dimensionless quantity is known as the size parameter, commonly denoted by $x$ or $\\alpha$. It is constructed from the wave number $k$ and the particle radius $a$ as their product:\n$$x = ka$$\nSubstituting the expression for the wave number, $k = \\frac{2\\pi}{\\lambda}$, we obtain the standard definition of the size parameter:\n$$x = \\frac{2\\pi a}{\\lambda}$$\nThe size parameter physically represents the ratio of the particle's circumference to the incident wavelength. The entire character of the scattering process—including the scattering efficiency, absorption efficiency, and the angular distribution of scattered light (the phase function)—is determined by the size parameter $x$ and the complex refractive index of the particle relative to the medium.\n\nThe magnitude of the size parameter $x$ relative to unity, $1$, dictates the applicable physical regime:\n1.  **Rayleigh Scattering Regime**: When $x \\ll 1$, the particle is much smaller than the wavelength of light. In this long-wavelength limit, the full Lorenz–Mie series solution can be truncated to its first term (the electric dipole term), leading to a much simpler set of equations. The scattering efficiency $Q_{sca}$ is proportional to $x^4$, which gives rise to the classic $\\lambda^{-4}$ dependence of scattering intensity.\n2.  **Mie Scattering Regime (or Lorenz–Mie Regime)**: When $x \\ge 1$ (or more generally, for any $x$ where the Rayleigh approximation is not valid, e.g., $x \\gtrsim 0.1$), the full series solution must be computed. The scattering behavior is complex, characterized by oscillations in the efficiency factors and a highly structured, forward-throwing phase function. The term \"Mie scattering\" technically refers to the complete theory for all $x$, but in practice, it is used to denote the regime where the particle size is comparable to or larger than the wavelength, and the simplifying assumptions of Rayleigh scattering fail.\n\nNow, we compute the value of the size parameter $x$ for the given observational parameters:\n- Particle radius: $a = 0.01\\,\\mu\\mathrm{m}$\n- Wavelength: $\\lambda = 0.80\\,\\mu\\mathrm{m}$\n\nUsing the formula for the size parameter:\n$$x = \\frac{2\\pi a}{\\lambda} = \\frac{2\\pi (0.01\\,\\mu\\mathrm{m})}{0.80\\,\\mu\\mathrm{m}}$$\nThe units of $\\mu\\mathrm{m}$ cancel, yielding a dimensionless result as required.\n$$x = \\frac{0.02\\pi}{0.80} = \\frac{2\\pi}{80} = \\frac{\\pi}{40}$$\nTo evaluate this numerically:\n$$x = \\frac{\\pi}{40} \\approx \\frac{3.14159265...}{40} \\approx 0.0785398...$$\nThe problem requires rounding to four significant figures. The first significant figure is the $7$. The fourth significant figure is the $5$, which is followed by a $3$, so we do not round up. However, the calculation above is slightly incorrect in rounding from the source $\\pi$. Re-calculating: $3.14159 / 40 = 0.07853975$. The fourth significant digit is $5$. The following digit is $3$. Re-reading the problem instruction, let me ensure my rounding process is impeccable. $0.0785398...$. The significant figures are $7, 8, 5, 3$. The digit after the '3' is a '9'. Therefore, the '3' must be rounded up to '4'. The correctly rounded value to four significant figures is $0.07854$.\n\nThe computed value of the size parameter is $x \\approx 0.07854$.\nTo determine the appropriate scattering model, we compare this value to unity.\n$$0.07854 \\ll 1$$\nSince the size parameter is much less than $1$, the condition for the Rayleigh scattering regime is satisfied. Therefore, for modeling the wavelength-dependent opacity in this specific observation window, the simpler Rayleigh scattering description is appropriate and physically justified. Although Lorenz–Mie theory is universally valid, its application would be computationally more expensive and would yield results that converge to the Rayleigh approximation in this limit. Thus, the Rayleigh model is the suitable choice.",
            "answer": "$$\\boxed{0.07854}$$"
        },
        {
            "introduction": "When particles are much smaller than the wavelength of light ($x \\ll 1$), we can explore the rich physics of the Rayleigh regime from first principles. This practice delves into the connection between a particle's fundamental material properties—encapsulated in its complex refractive index, $m(\\lambda)$—and its interaction with light. By deriving the particle's polarizability, you will see how its capacity to both scatter and absorb radiation leads directly to the definition of the single-scattering albedo, $\\varpi_0$, a key parameter governing the brightness and thermal structure of a planetary atmosphere .",
            "id": "4175746",
            "problem": "Consider a homogeneous, isotropic, spherical haze particle of radius $a$ suspended in a non-absorbing exoplanet atmosphere whose background refractive index is unity. The particle has a complex refractive index $m(\\lambda) = n(\\lambda) + i\\,k(\\lambda)$ at free-space wavelength $\\lambda$, where $n(\\lambda)$ and $k(\\lambda)$ are the real and imaginary parts, respectively. Assume the Rayleigh regime $x \\equiv 2\\pi a/\\lambda \\ll 1$ applies and that the particle response can be treated as an induced electric dipole under an incident monochromatic plane wave.\n\nStarting from the electromagnetic boundary conditions at the surface of the sphere and the dipole approximation implied by $x \\ll 1$, derive the particle’s electric dipole polarizability $\\alpha(\\lambda)$ in terms of $a$ and $m(\\lambda)$. Then, using the Rayleigh-limit asymptotics of Mie theory together with the optical theorem, obtain analytic expressions for the scattering efficiency $Q_{\\mathrm{sca}}$ and absorption efficiency $Q_{\\mathrm{abs}}$ in terms of the size parameter $x$ and the complex material contrast. Define the single-scattering albedo (SSA) as $\\varpi_0 \\equiv Q_{\\mathrm{sca}}/Q_{\\mathrm{ext}}$, where $Q_{\\mathrm{ext}} \\equiv Q_{\\mathrm{sca}} + Q_{\\mathrm{abs}}$. Under the physically relevant conditions $x \\ll 1$ and $k \\ll n$ for many exoplanet cloud and haze materials at optical and near-infrared wavelengths, analyze $\\partial \\varpi_0 / \\partial k$ at fixed $n$ and $x$ to show how increasing $k$ reduces $\\varpi_0$.\n\nYour final answer must be a single closed-form analytic expression for $\\varpi_0(n,k,x)$ in the Rayleigh limit, expressed in terms of $n$, $k$, and $x$. No numerical evaluation is required, and no units should be included in the final expression.",
            "solution": "This problem requires the derivation of the electric dipole polarizability $\\alpha$, scattering and absorption efficiencies $Q_{\\mathrm{sca}}$ and $Q_{\\mathrm{abs}}$, and the single-scattering albedo $\\varpi_0$ for a spherical particle in the Rayleigh scattering regime ($x \\equiv 2\\pi a/\\lambda \\ll 1$). The derivation proceeds in three main parts.\n\n### Step 1: Problem Validation\n\n**Extracted Givens:**\n*   Particle is a homogeneous, isotropic, sphere of radius $a$.\n*   Particle is suspended in a non-absorbing medium with a background refractive index of unity.\n*   Particle's complex refractive index is $m(\\lambda) = n(\\lambda) + i\\,k(\\lambda)$.\n*   The Rayleigh regime applies: $x \\equiv 2\\pi a/\\lambda \\ll 1$.\n*   The particle's response is treated as an induced electric dipole.\n*   The incident wave is a monochromatic plane wave.\n*   Definitions: $\\varpi_0 \\equiv Q_{\\mathrm{sca}}/Q_{\\mathrm{ext}}$, where $Q_{\\mathrm{ext}} \\equiv Q_{\\mathrm{sca}} + Q_{\\mathrm{abs}}$.\n*   Conditions for analysis: $x \\ll 1$ and $k \\ll n$.\n\n**Validation:**\n1.  **Scientifically Grounded:** The problem is firmly rooted in classical electromagnetism and the theory of light scattering (Mie theory in the Rayleigh limit). All concepts are standard in physics and atmospheric/planetary science.\n2.  **Well-Posed:** The problem provides sufficient information to derive unique and meaningful expressions for the requested quantities.\n3.  **Objective:** The language is precise and free of subjectivity.\n\nThe problem is a standard textbook derivation and contains no scientific or logical flaws. It is **valid**.\n\n### Step 2: Derivation of Particle Polarizability $\\alpha$\n\nIn the Rayleigh limit ($a \\ll \\lambda$), the spatial variation of the incident electric field $\\vec{E}_{\\mathrm{inc}}$ across the particle is negligible. We can treat the problem as a dielectric sphere of radius $a$ and complex relative permittivity $\\epsilon_r = m^2$ placed in a static, uniform external electric field $\\vec{E}_0 = E_0\\hat{z}$. The surrounding medium has relative permittivity $\\epsilon_1=1^2=1$, so its permittivity is $\\epsilon_0$. The particle's permittivity is $\\epsilon_2 = m^2\\epsilon_0$.\n\nThe scalar potential $\\Phi$ must satisfy Laplace's equation, $\\nabla^2\\Phi=0$. In spherical coordinates, with azimuthal symmetry, the general solution is a sum of Legendre polynomials. Outside the sphere ($r > a$), the potential is the sum of the potential due to the external field and the potential of the induced dipole:\n$$ \\Phi_{\\mathrm{out}}(r, \\theta) = -E_0 r \\cos\\theta + \\frac{p}{4\\pi\\epsilon_0 r^2} \\cos\\theta $$\nwhere $p$ is the magnitude of the induced dipole moment. Inside the sphere ($r < a$), the potential must be finite at the origin, so it must be of the form:\n$$ \\Phi_{\\mathrm{in}}(r, \\theta) = -E_{\\mathrm{in}} r \\cos\\theta $$\nwhere $E_{\\mathrm{in}}$ is the uniform field inside the sphere.\n\nThe electromagnetic boundary conditions at the surface of the sphere ($r=a$) are:\n1.  Continuity of the tangential electric field, which implies continuity of the potential: $\\Phi_{\\mathrm{in}}(a, \\theta) = \\Phi_{\\mathrm{out}}(a, \\theta)$.\n2.  Continuity of the normal component of the electric displacement field: $\\epsilon_2 \\frac{\\partial \\Phi_{\\mathrm{in}}}{\\partial r}\\Big|_{r=a} = \\epsilon_0 \\frac{\\partial \\Phi_{\\mathrm{out}}}{\\partial r}\\Big|_{r=a}$.\n\nApplying these conditions:\n1.  $-E_{\\mathrm{in}} a \\cos\\theta = -E_0 a \\cos\\theta + \\frac{p}{4\\pi\\epsilon_0 a^2} \\cos\\theta \\implies -E_{\\mathrm{in}} a = -E_0 a + \\frac{p}{4\\pi\\epsilon_0 a^2}$\n2.  $m^2 \\epsilon_0 (-E_{\\mathrm{in}} \\cos\\theta) = \\epsilon_0 \\left(-E_0 \\cos\\theta - \\frac{2p}{4\\pi\\epsilon_0 a^3} \\cos\\theta\\right) \\implies m^2 E_{\\mathrm{in}} = E_0 + \\frac{2p}{4\\pi\\epsilon_0 a^3}$\n\nWe have a system of two linear equations for $E_{\\mathrm{in}}$ and $p$. From (1), $E_{\\mathrm{in}} = E_0 - \\frac{p}{4\\pi\\epsilon_0 a^3}$. Substituting this into (2):\n$$ m^2 \\left(E_0 - \\frac{p}{4\\pi\\epsilon_0 a^3}\\right) = E_0 + \\frac{2p}{4\\pi\\epsilon_0 a^3} $$\n$$ E_0(m^2 - 1) = \\frac{p}{4\\pi\\epsilon_0 a^3} (m^2 + 2) $$\nSolving for the dipole moment $p$:\n$$ p = 4\\pi\\epsilon_0 a^3 \\left(\\frac{m^2 - 1}{m^2 + 2}\\right) E_0 $$\nThe electric polarizability $\\alpha$ is defined by the relation $\\vec{p} = \\epsilon_0 \\alpha \\vec{E}_0$. Thus,\n$$ \\alpha = 4\\pi a^3 \\frac{m^2 - 1}{m^2 + 2} $$\n\n### Step 3: Derivation of Scattering and Absorption Efficiencies\n\nThe efficiencies are the respective cross-sections normalized by the particle's geometric cross-section, $\\pi a^2$.\n\n**Scattering Efficiency $Q_{\\mathrm{sca}}$**\nAn oscillating dipole radiates power. The time-averaged power scattered by the induced dipole $\\vec{p}$ oscillating at angular frequency $\\omega$ is given by the Larmor formula:\n$$ P_{\\mathrm{sca}} = \\frac{\\omega^4 |\\vec{p}|^2}{12\\pi\\epsilon_0 c^3} $$\nSubstituting $\\vec{p} = \\epsilon_0 \\alpha \\vec{E}_0$:\n$$ P_{\\mathrm{sca}} = \\frac{\\omega^4 |\\epsilon_0 \\alpha E_0|^2}{12\\pi\\epsilon_0 c^3} = \\frac{\\omega^4 \\epsilon_0 |\\alpha|^2 E_0^2}{12\\pi c^3} $$\nThe incident intensity (irradiance) of the plane wave is $I_{\\mathrm{inc}} = \\frac{1}{2}c\\epsilon_0 E_0^2$. The scattering cross-section is $\\sigma_{\\mathrm{sca}} = P_{\\mathrm{sca}}/I_{\\mathrm{inc}}$:\n$$ \\sigma_{\\mathrm{sca}} = \\frac{\\omega^4 \\epsilon_0 |\\alpha|^2 E_0^2}{12\\pi c^3} \\frac{2}{c\\epsilon_0 E_0^2} = \\frac{\\omega^4 |\\alpha|^2}{6\\pi c^4} $$\nUsing the wave number $k_{\\mathrm{w}} = \\omega/c = 2\\pi/\\lambda$:\n$$ \\sigma_{\\mathrm{sca}} = \\frac{k_{\\mathrm{w}}^4}{6\\pi} |\\alpha|^2 $$\nThe scattering efficiency is $Q_{\\mathrm{sca}} = \\sigma_{\\mathrm{sca}}/(\\pi a^2)$:\n$$ Q_{\\mathrm{sca}} = \\frac{k_{\\mathrm{w}}^4}{6\\pi^2 a^2} |\\alpha|^2 = \\frac{k_{\\mathrm{w}}^4}{6\\pi^2 a^2} \\left|4\\pi a^3 \\frac{m^2 - 1}{m^2 + 2}\\right|^2 = \\frac{16\\pi^2 k_{\\mathrm{w}}^4 a^6}{6\\pi^2 a^2} \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 = \\frac{8}{3} (k_{\\mathrm{w}}a)^4 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 $$\nUsing the size parameter $x = k_{\\mathrm{w}} a = 2\\pi a/\\lambda$, we get:\n$$ Q_{\\mathrm{sca}} = \\frac{8}{3} x^4 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 $$\n\n**Absorption Efficiency $Q_{\\mathrm{abs}}$**\nThe time-averaged power absorbed by the particle is $P_{\\mathrm{abs}} = \\frac{1}{2}\\omega\\mathrm{Im}(\\vec{p} \\cdot \\vec{E}_{\\mathrm{inc}}^{*})$. With $\\vec{p} = \\epsilon_0\\alpha\\vec{E}_{\\mathrm{inc}}$:\n$$ P_{\\mathrm{abs}} = \\frac{1}{2}\\omega\\mathrm{Im}(\\epsilon_0\\alpha |\\vec{E}_{\\mathrm{inc}}|^2) = \\frac{1}{2}\\omega\\epsilon_0 E_0^2 \\mathrm{Im}(\\alpha) $$\nThe absorption cross-section is $\\sigma_{\\mathrm{abs}} = P_{\\mathrm{abs}}/I_{\\mathrm{inc}}$:\n$$ \\sigma_{\\mathrm{abs}} = \\frac{\\frac{1}{2}\\omega\\epsilon_0 E_0^2 \\mathrm{Im}(\\alpha)}{\\frac{1}{2}c\\epsilon_0 E_0^2} = \\frac{\\omega}{c}\\mathrm{Im}(\\alpha) = k_{\\mathrm{w}}\\mathrm{Im}(\\alpha) $$\nThe absorption efficiency $Q_{\\mathrm{abs}} = \\sigma_{\\mathrm{abs}}/(\\pi a^2)$ is:\n$$ Q_{\\mathrm{abs}} = \\frac{k_{\\mathrm{w}}}{\\pi a^2} \\mathrm{Im}\\left(4\\pi a^3 \\frac{m^2 - 1}{m^2 + 2}\\right) = 4k_{\\mathrm{w}}a \\mathrm{Im}\\left(\\frac{m^2 - 1}{m^2 + 2}\\right) $$\nIn terms of $x$, this is:\n$$ Q_{\\mathrm{abs}} = 4x \\, \\mathrm{Im}\\left(\\frac{m^2 - 1}{m^2 + 2}\\right) $$\nTo evaluate the imaginary part, let $m=n+ik$. Then $m^2 = (n^2-k^2) + i(2nk)$.\n$$ \\frac{m^2-1}{m^2+2} = \\frac{(n^2-k^2-1) + i(2nk)}{(n^2-k^2+2) + i(2nk)} $$\nThe imaginary part of this expression is:\n$$ \\mathrm{Im}\\left(\\frac{m^2-1}{m^2+2}\\right) = \\frac{(2nk)(n^2-k^2+2) - (n^2-k^2-1)(2nk)}{|m^2+2|^2} = \\frac{6nk}{|m^2+2|^2} $$\nSo, the absorption efficiency is:\n$$ Q_{\\mathrm{abs}} = 4x \\frac{6nk}{|m^2+2|^2} = \\frac{24xnk}{(n^2-k^2+2)^2 + (2nk)^2} $$\n\n### Step 4: Single-Scattering Albedo $\\varpi_0$ and Analysis\n\nThe single-scattering albedo is defined as $\\varpi_0 = Q_{\\mathrm{sca}}/Q_{\\mathrm{ext}} = Q_{\\mathrm{sca}}/(Q_{\\mathrm{sca}} + Q_{\\mathrm{abs}})$. Substituting our derived expressions:\n$$ \\varpi_0 = \\frac{\\frac{8}{3} x^4 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2}{\\frac{8}{3} x^4 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 + 4x \\, \\mathrm{Im}\\left(\\frac{m^2 - 1}{m^2 + 2}\\right)} $$\nDividing the numerator and denominator by $4x$:\n$$ \\varpi_0 = \\frac{\\frac{2}{3} x^3 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2}{\\frac{2}{3} x^3 \\left|\\frac{m^2 - 1}{m^2 + 2}\\right|^2 + \\mathrm{Im}\\left(\\frac{m^2 - 1}{m^2 + 2}\\right)} $$\nSubstituting the expanded forms of the terms:\n$$ \\varpi_0 = \\frac{\\frac{2}{3} x^3 \\frac{|m^2-1|^2}{|m^2+2|^2}}{\\frac{2}{3} x^3 \\frac{|m^2-1|^2}{|m^2+2|^2} + \\frac{6nk}{|m^2+2|^2}} $$\nMultiplying numerator and denominator by $3|m^2+2|^2$ gives:\n$$ \\varpi_0 = \\frac{2 x^3 |m^2-1|^2}{2 x^3 |m^2-1|^2 + 18nk} $$\nExpanding $|m^2-1|^2 = |(n^2-k^2-1)+i(2nk)|^2 = (n^2-k^2-1)^2 + 4n^2k^2$, we obtain the final expression for $\\varpi_0(n,k,x)$:\n$$ \\varpi_0 = \\frac{2 x^3 \\left((n^2-k^2-1)^2 + 4n^2k^2\\right)}{2 x^3 \\left((n^2-k^2-1)^2 + 4n^2k^2\\right) + 18nk} $$\n\nTo analyze the dependence of $\\varpi_0$ on $k$ for $k \\ll n$, we examine its derivative $\\partial \\varpi_0 / \\partial k$. Let $A(k) = 2 x^3 |m^2-1|^2$ and $B(k) = 18nk$. Then $\\varpi_0 = A/(A+B)$.\n$$ \\frac{\\partial \\varpi_0}{\\partial k} = \\frac{\\frac{\\partial A}{\\partial k}(A+B) - A\\left(\\frac{\\partial A}{\\partial k} + \\frac{\\partial B}{\\partial k}\\right)}{(A+B)^2} = \\frac{B\\frac{\\partial A}{\\partial k} - A\\frac{\\partial B}{\\partial k}}{(A+B)^2} $$\nFor $k \\ll n$:\n$|m^2-1|^2 \\approx |n^2-1|^2 = \\text{constant with respect to } k$. So $A(k) \\approx 2 x^3 (n^2-1)^2$, and $\\frac{\\partial A}{\\partial k} \\approx 0$.\nThe term $B(k) = 18nk$, so $\\frac{\\partial B}{\\partial k} = 18n$.\nSubstituting these approximations into the derivative:\n$$ \\frac{\\partial \\varpi_0}{\\partial k} \\approx \\frac{(18nk)(0) - (2 x^3 (n^2-1)^2)(18n)}{(A+B)^2} = - \\frac{36 n x^3 (n^2-1)^2}{(A+B)^2} $$\nSince $x>0$, $n>0$, and the denominator is positive, $\\partial \\varpi_0 / \\partial k < 0$. This demonstrates that increasing the imaginary part of the refractive index $k$ (i.e., increasing the particle's intrinsic absorption) decreases the single-scattering albedo $\\varpi_0$, as expected physically.",
            "answer": "$$\\boxed{\\frac{2 x^{3} \\left(\\left(n^{2}-k^{2}-1\\right)^{2} + 4n^{2}k^{2}\\right)}{2 x^{3} \\left(\\left(n^{2}-k^{2}-1\\right)^{2} + 4n^{2}k^{2}\\right) + 18nk}}$$"
        },
        {
            "introduction": "This chapter culminates in bridging theory with practical data analysis, a core skill in modern planetary science. When interpreting an exoplanet's transmission spectrum, we often face competing hypotheses: is the observed slope caused by Rayleigh scattering in a clear atmosphere, or by a haze of aerosols that follow Mie theory? This computational exercise demonstrates how to use a powerful statistical framework, Bayesian model selection, to quantitatively compare these competing models and determine which is better supported by a given dataset .",
            "id": "4175768",
            "problem": "You are given a simplified linearized forward model for wavelength-dependent optical attenuation in an exoplanet atmosphere that is applicable to both Rayleigh scattering and Mie-dominated hazes. Let the observable be the natural logarithm of a dimensionless extinction-like quantity, denoted by $y(\\lambda)$, modeled as a linear function of the logarithm of wavelength relative to a reference wavelength. Define $x(\\lambda) \\equiv \\ln(\\lambda/\\lambda_0)$ with $\\lambda$ in micrometers and $\\lambda_0$ a fixed reference wavelength in micrometers. Assume independent Gaussian measurement errors.\n\nCompeting hypotheses:\n- Hypothesis $H_R$ (pure Rayleigh gas): $y_i = b - 4x_i + \\varepsilon_i$, where $b$ is an unknown amplitude and $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma_i^2)$ independently.\n- Hypothesis $H_M$ (Mie-dominated haze): $y_i = b - \\alpha x_i + \\varepsilon_i$, where $b$ and $\\alpha$ are unknown and $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma_i^2)$ independently.\n\nPriors (chosen to be physically realistic for exoplanet atmospheres):\n- For both hypotheses, $b \\sim \\mathcal{N}(\\mu_b,\\sigma_b^2)$ with $\\mu_b = -1.0$ and $\\sigma_b = 2.0$ (dimensionless).\n- For $H_M$ only, $\\alpha \\sim \\mathcal{N}(\\mu_\\alpha,\\sigma_\\alpha^2)$ with $\\mu_\\alpha = 1.5$ and $\\sigma_\\alpha = 1.0$ (dimensionless).\n- For $H_R$, the slope is fixed at the Rayleigh value 4 (no prior for $\\alpha$ is needed under $H_R$).\n\nLikelihood model:\n- For a dataset of $n$ wavelengths $\\{\\lambda_i\\}_{i=1}^n$ and measurements $\\{y_i\\}_{i=1}^n$, assume the errors are independent Gaussian with known standard deviations $\\{\\sigma_i\\}_{i=1}^n$ (dimensionless). Angles do not appear in this problem.\n\nYour task is to compute, for each dataset in the test suite below, the natural logarithm of the Bayes factor comparing $H_R$ to $H_M$, namely\n$$\\ln \\mathcal{B}_{R,M} \\equiv \\ln Z_R - \\ln Z_M,$$\nwhere $Z_R$ and $Z_M$ are the Bayesian evidences (marginal likelihoods) of $H_R$ and $H_M$, respectively, obtained by integrating the likelihood over the corresponding priors. Calculations must use natural logarithms and Standard International (SI) consistent dimensionless units as defined above. All wavelengths must be treated in micrometers as given. The outputs for each dataset must be a single real number (a float) equal to $\\ln \\mathcal{B}_{R,M}$.\n\nFundamental base and modeling assumptions you must use:\n- Bayes’ theorem with evidence defined as the integral of the likelihood over the prior.\n- The forward model is linear in parameters once expressed in $x_i = \\ln(\\lambda_i/\\lambda_0)$.\n- The noise model is independent Gaussian with known variances.\n\nReference wavelength:\n- Use $\\lambda_0 = 0.5$ micrometers.\n\nTest suite (each dataset is fully specified, and all numbers are to be interpreted as exact, with no additional noise beyond what is encoded in the likelihood via $\\sigma_i$):\n- Dataset $1$ (Rayleigh-like, high signal-to-noise):\n  - Wavelengths in micrometers: $\\{0.4, 0.5, 0.6, 0.8, 1.0\\}$.\n  - Measurement uncertainties: $\\{\\sigma_i\\} = \\{0.02, 0.02, 0.02, 0.02, 0.02\\}$ (dimensionless).\n  - Synthetic data generation (deterministic): $b_{\\mathrm{true}} = -1.2$, $\\alpha_{\\mathrm{true}} = 4.0$, $y_i = b_{\\mathrm{true}} - \\alpha_{\\mathrm{true}} \\ln(\\lambda_i/\\lambda_0)$.\n- Dataset $2$ (Mie-like, high signal-to-noise):\n  - Wavelengths in micrometers: $\\{0.4, 0.5, 0.6, 0.8, 1.0\\}$.\n  - Measurement uncertainties: $\\{\\sigma_i\\} = \\{0.02, 0.02, 0.02, 0.02, 0.02\\}$ (dimensionless).\n  - Synthetic data generation (deterministic): $b_{\\mathrm{true}} = -1.2$, $\\alpha_{\\mathrm{true}} = 1.2$, $y_i = b_{\\mathrm{true}} - \\alpha_{\\mathrm{true}} \\ln(\\lambda_i/\\lambda_0)$.\n- Dataset $3$ (ambiguous, low signal-to-noise):\n  - Wavelengths in micrometers: $\\{0.5, 0.7, 1.0\\}$.\n  - Measurement uncertainties: $\\{\\sigma_i\\} = \\{0.5, 0.5, 0.5\\}$ (dimensionless).\n  - Synthetic data generation (deterministic): $b_{\\mathrm{true}} = -1.2$, $\\alpha_{\\mathrm{true}} = 3.0$, $y_i = b_{\\mathrm{true}} - \\alpha_{\\mathrm{true}} \\ln(\\lambda_i/\\lambda_0)$.\n\nProgram requirements:\n- Implement a numerically stable computation of the evidences $Z_R$ and $Z_M$ for linear-Gaussian models with Gaussian priors by carrying out the exact Gaussian integral implied by Bayes’ theorem.\n- For $H_R$, treat the fixed Rayleigh slope by transforming the model into a one-parameter linear-Gaussian problem in $b$ as appropriate.\n- For each dataset, compute $\\ln \\mathcal{B}_{R,M}$ as a float.\n- Final output format: Your program should produce a single line of output containing the three results as a comma-separated list enclosed in square brackets, for example, $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]$. Each float must be formatted to exactly six digits after the decimal point.\n- Units: Wavelengths in micrometers as specified; all other quantities are dimensionless. Angles do not appear. No percentages appear.\n\nYour final program must not accept any input and must run as-is to produce the required single-line output.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded, well-posed, objective, and contains all necessary information to derive a unique, meaningful solution. The models provided are simplified but physically motivated representations of Rayleigh and Mie scattering phenomena in exoplanet atmospheres, and the task of computing the Bayes factor is a standard, well-defined procedure in Bayesian model comparison.\n\nThe core of the problem is to compute the natural logarithm of the Bayes factor, $\\ln \\mathcal{B}_{R,M}$, which compares the evidence for the Rayleigh hypothesis ($H_R$) against the Mie hypothesis ($H_M$). This is given by the difference in their respective log-evidences:\n$$ \\ln \\mathcal{B}_{R,M} = \\ln Z_R - \\ln Z_M $$\nThe evidence, $Z$, for a given model is the marginal likelihood, obtained by integrating the likelihood over the prior distribution of the parameters. For a model with parameters $\\mathbf{w}$, likelihood $\\mathcal{L}(\\mathbf{d}|\\mathbf{w})$, and prior $\\pi(\\mathbf{w})$, the evidence is $Z = \\int \\mathcal{L}(\\mathbf{d}|\\mathbf{w}) \\pi(\\mathbf{w}) d\\mathbf{w}$.\n\nBoth hypotheses are instances of a linear-Gaussian model. The general form of such a model is $\\mathbf{y} = \\mathbf{X}\\mathbf{w} + \\boldsymbol{\\varepsilon}$, where $\\mathbf{y}$ is the $n \\times 1$ vector of observations, $\\mathbf{X}$ is the $n \\times k$ design matrix, $\\mathbf{w}$ is the $k \\times 1$ vector of parameters, and $\\boldsymbol{\\varepsilon}$ is the noise vector. The problem specifies a Gaussian likelihood, $\\boldsymbol{\\varepsilon} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{C}_\\text{noise})$, and a Gaussian prior on the parameters, $\\mathbf{w} \\sim \\mathcal{N}(\\mathbf{w}_0, \\mathbf{C}_\\text{prior})$.\n\nFor this class of models, the integral for the evidence has an analytical solution. The log-evidence, $\\ln Z$, can be expressed in a numerically stable form as:\n$$ \\ln Z = -\\frac{1}{2} (\\mathbf{y} - \\mathbf{X}\\mathbf{w}_0)^T (\\mathbf{C}_\\text{noise} + \\mathbf{X}\\mathbf{C}_\\text{prior}\\mathbf{X}^T)^{-1} (\\mathbf{y} - \\mathbf{X}\\mathbf{w}_0) - \\frac{1}{2} \\ln |\\mathbf{C}_\\text{noise} + \\mathbf{X}\\mathbf{C}_\\text{prior}\\mathbf{X}^T| - \\frac{n}{2}\\ln(2\\pi) $$\nLet's define the matrix $\\mathbf{A} = \\mathbf{C}_\\text{noise} + \\mathbf{X}\\mathbf{C}_\\text{prior}\\mathbf{X}^T$ and the vector $\\mathbf{v} = \\mathbf{y} - \\mathbf{X}\\mathbf{w}_0$. The formula simplifies to:\n$$ \\ln Z = -\\frac{1}{2} \\left[ \\mathbf{v}^T \\mathbf{A}^{-1} \\mathbf{v} + \\ln|\\mathbf{A}| + n\\ln(2\\pi) \\right] $$\nWhen calculating the log Bayes factor $\\ln Z_R - \\ln Z_M$, the term $\\frac{n}{2}\\ln(2\\pi)$ is common to both and cancels out, as both models are applied to the same dataset of size $n$. Therefore, we need to compute the remaining terms for each hypothesis.\n\nLet the data for a given dataset be the set of wavelengths $\\{\\lambda_i\\}_{i=1}^n$, measurements $\\{y_i\\}_{i=1}^n$, and uncertainties $\\{\\sigma_i\\}_{i=1}^n$. The reference wavelength is $\\lambda_0 = 0.5$.\nThe independent variables are $x_i = \\ln(\\lambda_i/\\lambda_0)$.\nThe observation vector is $\\mathbf{y} = [y_1, \\dots, y_n]^T$.\nThe noise covariance matrix is diagonal, $\\mathbf{C}_\\text{noise} = \\text{diag}(\\sigma_1^2, \\dots, \\sigma_n^2)$.\nThe prior on $b$ is $\\mathcal{N}(\\mu_b, \\sigma_b^2)$ with $\\mu_b=-1.0$ and $\\sigma_b=2.0$.\nThe prior on $\\alpha$ is $\\mathcal{N}(\\mu_\\alpha, \\sigma_\\alpha^2)$ with $\\mu_\\alpha=1.5$ and $\\sigma_\\alpha=1.0$.\n\n**Hypothesis $H_R$ (Rayleigh, slope fixed at $-4$):**\nThe model is $y_i = b - 4x_i + \\varepsilon_i$. To fit this into our linear model framework, we rearrange it as $y_i + 4x_i = b + \\varepsilon_i$.\n- The effective data vector is $\\mathbf{y}'_R = \\mathbf{y} + 4\\mathbf{x}$.\n- The parameter vector is $\\mathbf{w}_R = [b]$, which has $k_R=1$ parameter.\n- The design matrix $\\mathbf{X}_R$ is an $n \\times 1$ column vector of ones.\n- The prior mean is $\\mathbf{w}_{0,R} = [\\mu_b] = [-1.0]$.\n- The prior covariance is the $1 \\times 1$ matrix $\\mathbf{C}_{\\text{prior},R} = [\\sigma_b^2] = [4.0]$.\n\nUsing these definitions, the log-evidence term for $H_R$ (without the constant) is:\n$$ \\ln Z'_R = -\\frac{1}{2} \\left[ (\\mathbf{y}'_R - \\mathbf{X}_R\\mathbf{w}_{0,R})^T \\mathbf{A}_R^{-1} (\\mathbf{y}'_R - \\mathbf{X}_R\\mathbf{w}_{0,R}) + \\ln|\\mathbf{A}_R| \\right] $$\nwhere $\\mathbf{A}_R = \\mathbf{C}_\\text{noise} + \\mathbf{X}_R \\mathbf{C}_{\\text{prior},R} \\mathbf{X}_R^T$.\n\n**Hypothesis $H_M$ (Mie, variable slope):**\nThe model is $y_i = b - \\alpha x_i + \\varepsilon_i$. This can be written as $y_i = [1, -x_i]\\begin{pmatrix} b \\\\ \\alpha \\end{pmatrix} + \\varepsilon_i$.\n- The data vector is $\\mathbf{y}$.\n- The parameter vector is $\\mathbf{w}_M = [b, \\alpha]^T$, which has $k_M=2$ parameters.\n- The design matrix $\\mathbf{X}_M$ is an $n \\times 2$ matrix with rows $[1, -x_i]$.\n- The prior mean vector is $\\mathbf{w}_{0,M} = [\\mu_b, \\mu_\\alpha]^T = [-1.0, 1.5]^T$.\n- Since the priors on $b$ and $\\alpha$ are independent, the prior covariance is diagonal: $\\mathbf{C}_{\\text{prior},M} = \\text{diag}(\\sigma_b^2, \\sigma_\\alpha^2) = \\text{diag}(4.0, 1.0)$.\n\nThe log-evidence term for $H_M$ (without the constant) is:\n$$ \\ln Z'_M = -\\frac{1}{2} \\left[ (\\mathbf{y} - \\mathbf{X}_M\\mathbf{w}_{0,M})^T \\mathbf{A}_M^{-1} (\\mathbf{y} - \\mathbf{X}_M\\mathbf{w}_{0,M}) + \\ln|\\mathbf{A}_M| \\right] $$\nwhere $\\mathbf{A}_M = \\mathbf{C}_\\text{noise} + \\mathbf{X}_M \\mathbf{C}_{\\text{prior},M} \\mathbf{X}_M^T$.\n\nThe final desired quantity is $\\ln \\mathcal{B}_{R,M} = \\ln Z_R - \\ln Z_M = \\ln Z'_R - \\ln Z'_M$.\nFor numerical computation, the quadratic form $\\mathbf{v}^T\\mathbf{A}^{-1}\\mathbf{v}$ is calculated by first solving the linear system $\\mathbf{A}\\mathbf{z} = \\mathbf{v}$ for $\\mathbf{z}$, and then computing the dot product $\\mathbf{v}^T\\mathbf{z}$. The log-determinant $\\ln|\\mathbf{A}|$ is computed using a function like `numpy.linalg.slogdet` to maintain numerical precision. This approach is implemented for each dataset provided in the test suite.",
            "answer": "```python\nimport numpy as np\n\ndef calculate_log_evidence_term(y_vec, X_mat, C_noise, w0_vec, C_prior):\n    \"\"\"\n    Computes the log-evidence for a linear-Gaussian model, excluding the\n    constant term -n/2 * ln(2*pi).\n    \n    Args:\n        y_vec (np.ndarray): The n x 1 observation vector.\n        X_mat (np.ndarray): The n x k design matrix.\n        C_noise (np.ndarray): The n x n noise covariance matrix.\n        w0_vec (np.ndarray): The k x 1 prior mean vector for parameters.\n        C_prior (np.ndarray): The k x k prior covariance matrix for parameters.\n\n    Returns:\n        float: The value of the log-evidence term.\n    \"\"\"\n    n, k = X_mat.shape\n\n    # A = C_noise + X * C_prior * X^T\n    A_mat = C_noise + X_mat @ C_prior @ X_mat.T\n\n    # v = y - X * w0\n    v_vec = y_vec - X_mat @ w0_vec\n    \n    # Calculate log-determinant of A\n    sign, log_det_A = np.linalg.slogdet(A_mat)\n    if sign = 0:\n        # This should not happen for a positive-definite matrix A\n        raise ValueError(\"Matrix A is not positive definite.\")\n        \n    # Calculate the quadratic term v^T * A^-1 * v\n    # This is done by solving A * z = v for z, then computing v^T * z.\n    # It is more numerically stable than computing the inverse of A.\n    z_vec = np.linalg.solve(A_mat, v_vec)\n    quad_term = v_vec.T @ z_vec\n    \n    # The log-evidence term is -0.5 * (quadratic term + log-determinant)\n    # The term involving ln(2*pi) cancels in the Bayes Factor.\n    log_z_prime = -0.5 * (quad_term.item() + log_det_A)\n    \n    return log_z_prime\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    # Priors and constants\n    lambda0 = 0.5  # micrometers\n    mu_b = -1.0\n    sigma_b = 2.0\n    mu_alpha = 1.5\n    sigma_alpha = 1.0\n\n    C_prior_b = np.array([[sigma_b**2]])\n    w0_R = np.array([mu_b]).reshape(-1, 1)\n\n    C_prior_M = np.diag([sigma_b**2, sigma_alpha**2])\n    w0_M = np.array([mu_b, mu_alpha]).reshape(-1, 1)\n\n    # Test suite\n    test_cases = [\n        {\n            \"lambdas\": np.array([0.4, 0.5, 0.6, 0.8, 1.0]),\n            \"sigmas\": np.array([0.02, 0.02, 0.02, 0.02, 0.02]),\n            \"b_true\": -1.2,\n            \"alpha_true\": 4.0,\n        },\n        {\n            \"lambdas\": np.array([0.4, 0.5, 0.6, 0.8, 1.0]),\n            \"sigmas\": np.array([0.02, 0.02, 0.02, 0.02, 0.02]),\n            \"b_true\": -1.2,\n            \"alpha_true\": 1.2,\n        },\n        {\n            \"lambdas\": np.array([0.5, 0.7, 1.0]),\n            \"sigmas\": np.array([0.5, 0.5, 0.5]),\n            \"b_true\": -1.2,\n            \"alpha_true\": 3.0,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        lambdas = case[\"lambdas\"]\n        sigmas = case[\"sigmas\"]\n        b_true = case[\"b_true\"]\n        alpha_true = case[\"alpha_true\"]\n        \n        n = len(lambdas)\n        \n        # 1. Pre-computation based on data\n        x_vec = np.log(lambdas / lambda0)\n        y_vec = b_true - alpha_true * x_vec\n        \n        # Reshape vectors to be n x 1 column vectors\n        x_vec = x_vec.reshape(-1, 1)\n        y_vec = y_vec.reshape(-1, 1)\n        \n        C_noise = np.diag(sigmas**2)\n\n        # 2. Calculate log-evidence for H_R (Rayleigh)\n        y_prime_R = y_vec + 4.0 * x_vec\n        X_R = np.ones((n, 1))\n        \n        log_Z_R_prime = calculate_log_evidence_term(\n            y_prime_R, X_R, C_noise, w0_R, C_prior_b\n        )\n        \n        # 3. Calculate log-evidence for H_M (Mie)\n        X_M = np.hstack((np.ones((n, 1)), -x_vec))\n        \n        log_Z_M_prime = calculate_log_evidence_term(\n            y_vec, X_M, C_noise, w0_M, C_prior_M\n        )\n        \n        # 4. Compute the log Bayes Factor\n        log_B_RM = log_Z_R_prime - log_Z_M_prime\n        results.append(log_B_RM)\n        \n    # Final output formatting\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}