{
    "hands_on_practices": [
        {
            "introduction": "Simple analytical models are often the key to unlocking the fundamental physics of complex systems. This exercise delves into the classic $n=1$ polytropic model, a powerful approximation for understanding the structure of cold, giant planets. By deriving the mass-radius relationship from first principles , you will uncover a surprising result that provides a crucial baseline for interpreting the observed population of gas giants and brown dwarfs.",
            "id": "4166849",
            "problem": "A cold, hydrogen–helium (H–He) giant planet can be approximated by a polytropic interior. Assume a spherically symmetric, self-gravitating fluid in hydrostatic equilibrium obeying the polytropic relation $P = K \\rho^{1 + 1/n}$ with index $n = 1$, where $P$ is pressure, $\\rho$ is mass density, and $K$ is a constant that encodes thermodynamic state and composition. Starting from the fundamental equations of hydrostatic equilibrium $dP/dr = - G M(r) \\rho / r^{2}$ and mass continuity $dM/dr = 4 \\pi r^{2} \\rho$, where $G$ is the gravitational constant and $M(r)$ is the mass enclosed within radius $r$, derive the mass–radius scaling implied by the $n=1$ polytrope and obtain the expression for the planet’s radius $R$ in terms of $K$ and $G$.\n\nChoose $K$ such that a $1\\,M_J$ ($M_J$ is the Jupiter Mass) $n=1$ polytrope reproduces the Jupiter Radius $R_J$. Using this same value of $K$, compute the radii (in units of $R_J$) for planets of mass $0.3\\,M_J$ and $3\\,M_J$. Round your two radii to four significant figures and express them in units of Jupiter radii ($R_J$).\n\nFinally, comment qualitatively on how the mass dependence you obtain compares with expectations from realistic hydrogen–helium equation of state (EOS) calculations for cold, non-irradiated giant planets, and explain the physical origin of any discrepancy using first principles of compressibility and degeneracy. The final numerical answer should be the two radii for $0.3\\,M_J$ and $3\\,M_J$ expressed in $R_J$, rounded to four significant figures.",
            "solution": "The problem requires an analysis of a planetary structure based on a polytropic equation of state with index $n=1$. The analysis proceeds by solving the equations of stellar structure for this specific case to derive a mass-radius relationship, which is then used to calculate radii for planets of different masses.\n\nThe fundamental governing equations provided are:\n1.  The equation of hydrostatic equilibrium:\n    $$ \\frac{dP}{dr} = - \\frac{G M(r) \\rho(r)}{r^2} $$\n2.  The equation of mass continuity:\n    $$ \\frac{dM(r)}{dr} = 4 \\pi r^2 \\rho(r) $$\n3.  The polytropic equation of state for index $n=1$:\n    $$ P = K \\rho^{1 + 1/n} = K \\rho^2 $$\nIn these equations, $P$ is the pressure, $\\rho$ is the mass density, $r$ is the radial coordinate from the center, $M(r)$ is the mass enclosed within radius $r$, $G$ is the gravitational constant, and $K$ is the polytropic constant.\n\nTo solve this system, we employ the Lane-Emden formalism. This involves normalizing the density and radius to dimensionless variables. We define a dimensionless function $\\theta(\\xi)$ and a dimensionless radius $\\xi$ as follows:\n$$ \\rho(r) = \\rho_c \\theta^n(\\xi) = \\rho_c \\theta(\\xi) \\quad (\\text{for } n=1) $$\n$$ r = a \\xi $$\nwhere $\\rho_c$ is the central density and $a$ is a characteristic length scale. Substituting these into the governing equations leads to the Lane-Emden equation, a second-order ordinary differential equation for $\\theta(\\xi)$.\n\nFirst, we combine the hydrostatic equilibrium and mass continuity equations by differentiating the former:\n$$ \\frac{d}{dr}\\left(\\frac{r^2}{\\rho}\\frac{dP}{dr}\\right) = -G \\frac{dM(r)}{dr} = -4\\pi G r^2\\rho $$\nNext, we substitute the polytropic relation $P = K\\rho^{1+1/n}$. The pressure gradient is $\\frac{dP}{dr} = K(1+\\frac{1}{n})\\rho^{1/n}\\frac{d\\rho}{dr}$.\nFor $n=1$, this is $\\frac{dP}{dr} = 2K\\rho\\frac{d\\rho}{dr}$. The structure equation becomes:\n$$ \\frac{d}{dr}\\left(\\frac{r^2}{\\rho} (2K\\rho\\frac{d\\rho}{dr})\\right) = \\frac{d}{dr}\\left(2Kr^2\\frac{d\\rho}{dr}\\right) = -4\\pi G r^2\\rho $$\nSubstituting $\\rho = \\rho_c\\theta$ and $r = a\\xi$, we get:\n$$ \\frac{d}{a d\\xi}\\left(2K(a\\xi)^2 \\frac{d(\\rho_c\\theta)}{a d\\xi}\\right) = -4\\pi G (a\\xi)^2 (\\rho_c\\theta) $$\n$$ \\frac{2K\\rho_c a^2}{a^2} \\frac{d}{d\\xi}\\left(\\xi^2 \\frac{d\\theta}{d\\xi}\\right) = -4\\pi G a^2 \\xi^2 \\rho_c\\theta $$\n$$ \\frac{d}{d\\xi}\\left(\\xi^2 \\frac{d\\theta}{d\\xi}\\right) = -\\frac{2\\pi G a^2}{K} \\xi^2 \\theta $$\nTo obtain the canonical form of the Lane-Emden equation, we choose the length scale $a$ such that the coefficient on the right-hand side is $1$.\n$$ a^2 = \\frac{K}{2\\pi G} \\implies a = \\sqrt{\\frac{K}{2\\pi G}} $$\nWith this choice, the Lane-Emden equation for $n=1$ is:\n$$ \\frac{1}{\\xi^2}\\frac{d}{d\\xi}\\left(\\xi^2 \\frac{d\\theta}{d\\xi}\\right) = -\\theta $$\nThe physical solution must be finite at the center ($\\xi=0$), so we impose the boundary conditions $\\theta(0)=1$ and $\\frac{d\\theta}{d\\xi}|_{\\xi=0}=0$. The solution satisfying these conditions is:\n$$ \\theta(\\xi) = \\frac{\\sin(\\xi)}{\\xi} $$\nThe surface of the planet, $R$, is defined by the radius where the density first becomes zero. This corresponds to the first non-trivial root of $\\theta(\\xi)$, which we denote $\\xi_1$. For $\\theta(\\xi) = \\frac{\\sin(\\xi)}{\\xi}$, this occurs when $\\sin(\\xi_1) = 0$, giving $\\xi_1 = \\pi$.\n\nThe total radius of the planet is therefore $R = a \\xi_1 = a \\pi$. Substituting the expression for $a$:\n$$ R = \\pi \\sqrt{\\frac{K}{2\\pi G}} = \\sqrt{\\frac{\\pi^2 K}{2\\pi G}} = \\sqrt{\\frac{\\pi K}{2G}} $$\nThis is the required expression for the radius $R$. A key feature of this result is that $R$ depends only on the constants $K$ and $G$. It is independent of the planet's total mass $M$ or its central density $\\rho_c$. This establishes the mass-radius scaling for an $n=1$ polytrope: the radius is constant for a given $K$.\n\nThe problem states that for a mass $M=1\\,M_J$, the radius is $R=1\\,R_J$. This allows us to fix the value of the constant $K$. Let's call it $K_J$.\n$$ R_J = \\sqrt{\\frac{\\pi K_J}{2G}} $$\nWe are then asked to compute the radii for planets of mass $0.3\\,M_J$ and $3\\,M_J$, assuming they are described by the same physics (i.e., an $n=1$ polytrope with the same constant $K_J$).\nAccording to our derived mass-radius relation, the radius is independent of mass. Therefore, the radii of these two planets will be identical to the radius of the Jupiter-mass planet.\nRadius for $0.3\\,M_J$ planet: $R_{0.3} = \\sqrt{\\frac{\\pi K_J}{2G}} = R_J$.\nRadius for $3.0\\,M_J$ planet: $R_{3.0} = \\sqrt{\\frac{\\pi K_J}{2G}} = R_J$.\nExpressed in units of Jupiter radii ($R_J$) and rounded to four significant figures, both radii are $1.000$.\n\nThe problem also asks for a qualitative comparison with realistic models. The $n=1$ polytrope prediction of a mass-independent radius ($R \\propto M^0$) provides a surprisingly reasonable first approximation for the behavior of gas giant exoplanets in the mass range of roughly $0.5$ to $5$ Jupiter masses, where the observed mass-radius relationship is relatively flat.\n\nHowever, a single polytropic index is an oversimplification. The true equation of state (EOS) of a hydrogen-helium mixture is complex. The discrepancy arises because the model fails to account for the changing physics of the planetary interior as mass increases. As mass and central pressure increase, electron degeneracy pressure becomes progressively more important in supporting the planet against gravitational collapse. For very massive giant planets and brown dwarfs, the EOS approaches that of a non-relativistic, degenerate Fermi gas, for which the pressure-density relation is $P \\propto \\rho^{5/3}$. This corresponds to a polytropic index of $n = \\frac{1}{5/3 - 1} = \\frac{3}{2}$. For an $n=3/2$ polytrope, the mass-radius relation is $R \\propto M^{-1/3}$, meaning the radius decreases with increasing mass.\n\nTherefore, realistic models predict that the radius of a cold H-He planet does not remain constant. It increases with mass for low-mass planets, reaches a plateau or a maximum around a few Jupiter masses, and then decreases for higher masses as degeneracy pressure dominates. The $n=1$ model artificially represents the entire mass range with the physics of the \"plateau\" region, thus missing the turnover and subsequent contraction at higher masses. For instance, a realistic $3\\,M_J$ planet would be slightly smaller in radius than Jupiter. The physical origin of this discrepancy is the failure of the simple $P=K\\rho^2$ relation to capture the transition toward a state dominated by electron degeneracy.",
            "answer": "$$ \\boxed{\n\\begin{pmatrix}\n1.000 & 1.000\n\\end{pmatrix}\n} $$"
        },
        {
            "introduction": "Moving from simple analytical solutions to numerical modeling allows us to tackle more complex planetary structures. This practice challenges you to build a two-layer model for a sub-Neptune, a common type of exoplanet consisting of a rocky core and a gaseous envelope. You will implement an iterative scheme to determine the minimum envelope mass fraction needed to match an observed radius and explore how atmospheric composition affects this critical parameter .",
            "id": "4166861",
            "problem": "You are tasked with building a two-layer exoplanet structural model to estimate the minimum envelope mass fraction required to reproduce a specified planetary radius given the total mass, and to test the sensitivity of this minimum envelope fraction to the envelope metallicity. The model must be grounded in fundamental physical principles and widely accepted approximations. The target system is a sub-Neptune-like planet with total mass $M$ and observed radius $R_{\\mathrm{obs}}$. The planet is modeled as an Earth-like rocky core of mass $M_{\\mathrm{c}}$ overlain by an isothermal hydrogen-helium envelope of mass $M_{\\mathrm{env}}$ with heavy molecule enrichment (metallicity) characterized by a mass fraction $Z_{\\mathrm{env}}$. The envelope mass fraction is defined as $f_{\\mathrm{env}} = M_{\\mathrm{env}} / M$, and the objective is to determine the minimum $f_{\\mathrm{env}}$ for which the model radius $R$ equals or exceeds $R_{\\mathrm{obs}}$.\n\nYour program must implement the following physics and approximations, operating strictly in International System of Units (SI):\n\n- The model includes a rocky core and a gaseous envelope. The core mass is $M_{\\mathrm{c}} = (1 - f_{\\mathrm{env}}) M$ and the envelope mass is $M_{\\mathrm{env}} = f_{\\mathrm{env}} M$.\n- The core radius $R_{\\mathrm{c}}$ follows a widely used approximate mass-radius scaling for Earth-like composition: $R_{\\mathrm{c}} = R_\\oplus \\left( \\frac{M_{\\mathrm{c}}}{M_\\oplus} \\right)^\\alpha$, where $R_\\oplus$ and $M_\\oplus$ are the Earth radius and Earth mass, and $\\alpha$ is a constant exponent taken as $0.27$.\n- The envelope is treated as isothermal with temperature $T$ and obeys the Ideal Gas Law. Hydrostatic equilibrium is enforced through $\\frac{dP}{dz} = -\\rho g$, where $P$ is pressure, $z$ is altitude, $\\rho$ is mass density, and $g$ is local gravitational acceleration. Combined with the Ideal Gas Law $P = \\rho R_{\\mathrm{gas}} T$ with $R_{\\mathrm{gas}} = \\frac{k_{\\mathrm{B}}}{\\mu m_{\\mathrm{H}}}$, one obtains the exponential pressure profile $P(z) = P_{\\mathrm{b}} \\exp\\left(-\\frac{z}{H}\\right)$, where $P_{\\mathrm{b}}$ is the pressure at the base of the envelope (top of the core), and $H = \\frac{k_{\\mathrm{B}} T}{\\mu m_{\\mathrm{H}} g}$ is the scale height. Here $k_{\\mathrm{B}}$ is the Boltzmann constant, $m_{\\mathrm{H}}$ is the atomic mass unit (mass of a hydrogen atom), and $\\mu$ is the dimensionless mean molecular weight in atomic mass units.\n- The mean molecular weight $\\mu$ is approximated for a mixture of hydrogen-helium and heavy molecules using mass fractions. Let the hydrogen-helium component have mean molecular weight $\\mu_{\\mathrm{HHe}}$ and the heavy molecule component have mean molecular weight $\\mu_Z$. With mass fraction $Z_{\\mathrm{env}}$ of heavy molecules, approximate\n$$\n\\mu(Z_{\\mathrm{env}}) = \\left( \\frac{1 - Z_{\\mathrm{env}}}{\\mu_{\\mathrm{HHe}}} + \\frac{Z_{\\mathrm{env}}}{\\mu_Z} \\right)^{-1}.\n$$\n- The photospheric pressure (pressure at the transit radius) is fixed at $P_{\\mathrm{ph}}$. The envelope thickness is approximated as\n$$\n\\Delta R = \n\\begin{cases}\n0, & P_{\\mathrm{b}} \\le P_{\\mathrm{ph}}, \\\\\nH \\ln\\left( \\frac{P_{\\mathrm{b}}}{P_{\\mathrm{ph}}} \\right), & $P_{\\mathrm{b}} > P_{\\mathrm{ph}}$,\n\\end{cases}\n$$\nwith $H$ evaluated using the surface gravity $g = \\frac{G M}{R^2}$ and an iterative fixed-point scheme for $R$, since $R = R_{\\mathrm{c}} + \\Delta R$ enters $g$.\n- The envelope mass is related to the base pressure through the hydrostatic column:\n$$\nM_{\\mathrm{env}} = 4 \\pi R_{\\mathrm{c}}^2 \\frac{P_{\\mathrm{b}}}{g_{\\mathrm{b}}}\n$$\nwhere $g_{\\mathrm{b}}$ is the gravitational acceleration evaluated at the base radius. In this model, approximate $g_{\\mathrm{b}}$ with the same $g$ used to evaluate $H$ for iterative consistency. Hence $P_{\\mathrm{b}} \\approx \\frac{M_{\\mathrm{env}} g}{4 \\pi R_{\\mathrm{c}}^2}$.\n\nThe algorithmic task is to determine, for a given $Z_{\\mathrm{env}}$, the minimum $f_{\\mathrm{env}}$ such that the model radius $R = R_{\\mathrm{c}} + \\Delta R$ is greater than or equal to $R_{\\mathrm{obs}}$. This should be solved by monotone root-bracketing and bisection on $f_{\\mathrm{env}}$ over a physically reasonable interval $[0, f_{\\mathrm{max}}]$, where $f_{\\mathrm{max}}$ is a chosen upper bound.\n\nScientific realism requirements:\n- Use $G$ for Newton's gravitational constant, $k_{\\mathrm{B}}$ for the Boltzmann constant, and $m_{\\mathrm{H}}$ for the mass of a hydrogen atom.\n- Use $M_\\oplus$ and $R_\\oplus$ for Earth mass and radius to define $M$ and $R_{\\mathrm{obs}}$.\n- Use $\\mu_{\\mathrm{HHe}} = 2.3$ as a typical hydrogen-helium mean molecular weight and $\\mu_Z = 18$ as a representative heavy molecule mean molecular weight (e.g., water) in atomic mass units.\n\nInput parameters for the scenario:\n- Planet total mass $M = 5 M_\\oplus$.\n- Observed radius $R_{\\mathrm{obs}} = 2.5 R_\\oplus$.\n- Rock core mass-radius exponent $\\alpha = 0.27$.\n- Isothermal envelope temperature $T = 800\\,\\mathrm{K}$ for the metallicity sensitivity analysis.\n- Photospheric pressure $P_{\\mathrm{ph}} = 2.0 \\times 10^4\\,\\mathrm{Pa}$.\n- Metallicity cases to test $Z_{\\mathrm{env}} \\in \\{0.0, 0.5, 0.9\\}$.\n- Additionally, include an edge case with $Z_{\\mathrm{env}} = 0.0$ and a colder envelope temperature $T = 400\\,\\mathrm{K}$ to probe a boundary condition.\n\nYour program must:\n- Implement an iterative fixed-point update for $R$ at a given $f_{\\mathrm{env}}$ and $Z_{\\mathrm{env}}$ until convergence to a tolerance (for example, a fractional change in $R$ less than $10^{-8}$).\n- Use a bisection method on $f_{\\mathrm{env}}$ to find the minimum envelope fraction for which $R \\ge R_{\\mathrm{obs}}$ in each test case, searching $f_{\\mathrm{env}} \\in [0, 0.5]$ and returning $f_{\\mathrm{max}}$ if no solution is found in the bracket.\n- Convert $M$ and $R_{\\mathrm{obs}}$ to SI units internally for all calculations.\n- Produce the final results as unitless decimal fractions for $f_{\\mathrm{env}}$, rounded to six decimal places.\n\nTest suite specification:\n- Case $1$: $Z_{\\mathrm{env}} = 0.0$, $T = 800\\,\\mathrm{K}$.\n- Case $2$: $Z_{\\mathrm{env}} = 0.5$, $T = 800\\,\\mathrm{K}$.\n- Case $3$: $Z_{\\mathrm{env}} = 0.9$, $T = 800\\,\\mathrm{K}$.\n- Case $4$ (edge): $Z_{\\mathrm{env}} = 0.0$, $T = 400\\,\\mathrm{K}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the four cases as a comma-separated list enclosed in square brackets, ordered as listed above. For example, in the format $[x_1,x_2,x_3,x_4]$, where each $x_i$ is the minimum $f_{\\mathrm{env}}$ for the corresponding test case, rounded to six decimal places and expressed as a unitless decimal fraction.",
            "solution": "The goal is to estimate the minimum envelope mass fraction $f_{\\mathrm{env}}$ required for a planet with total mass $M$ and observed radius $R_{\\mathrm{obs}}$ to have a modeled radius $R \\ge R_{\\mathrm{obs}}$, subject to envelope metallicity $Z_{\\mathrm{env}}$. The model treats the planet as a rocky core plus an isothermal ideal-gas envelope. The solution proceeds from hydrostatic equilibrium and the Ideal Gas Law, along with a mass-radius scaling for the rocky core.\n\nStep $1$ (Core radius model): Assume Earth-like composition for the core. For core mass $M_{\\mathrm{c}} = (1 - f_{\\mathrm{env}}) M$, adopt a widely used power-law scaling\n$$\nR_{\\mathrm{c}} = R_\\oplus \\left( \\frac{M_{\\mathrm{c}}}{M_\\oplus} \\right)^\\alpha,\n$$\nwith $\\alpha = 0.27$ representing the compressible nature of rocky material. This scaling is based on planetary interior models and is empirically supported for Earth-like compositions across super-Earth masses.\n\nStep $2$ (Envelope thermodynamics and hydrostatics): The envelope is isothermal at temperature $T$ and obeys the Ideal Gas Law,\n$$\nP = \\rho R_{\\mathrm{gas}} T,\n$$\nwhere $R_{\\mathrm{gas}} = \\frac{k_{\\mathrm{B}}}{\\mu m_{\\mathrm{H}}}$, $k_{\\mathrm{B}}$ is the Boltzmann constant, $m_{\\mathrm{H}}$ is the mass of a hydrogen atom, and $\\mu$ is the mean molecular weight expressed in atomic mass units. Hydrostatic equilibrium,\n$$\n\\frac{dP}{dz} = -\\rho g,\n$$\ncombined with the Ideal Gas Law yields an exponential pressure profile,\n$$\nP(z) = P_{\\mathrm{b}} \\exp\\left(-\\frac{z}{H}\\right), \\quad H = \\frac{k_{\\mathrm{B}} T}{\\mu m_{\\mathrm{H}} g},\n$$\nwhere $H$ is the scale height and $g$ is the gravitational acceleration at the radius $R = R_{\\mathrm{c}} + \\Delta R$. The envelope thickness from the base pressure $P_{\\mathrm{b}}$ down to the photospheric pressure $P_{\\mathrm{ph}}$ is then\n$$\n\\Delta R = \n\\begin{cases}\n0, & P_{\\mathrm{b}} \\le P_{\\mathrm{ph}}, \\\\\nH \\ln\\left( \\frac{P_{\\mathrm{b}}}{P_{\\mathrm{ph}}} \\right), & P_{\\mathrm{b}} > P_{\\mathrm{ph}}.\n\\end{cases}\n$$\n\nStep $3$ (Mean molecular weight with metallicity): The mean molecular weight of the envelope is estimated from mass fractions of hydrogen-helium and heavy molecules. With hydrogen-helium mean molecular weight $\\mu_{\\mathrm{HHe}}$ and heavy molecule mean molecular weight $\\mu_Z$, the mixture is approximated as\n$$\n\\mu(Z_{\\mathrm{env}}) = \\left( \\frac{1 - Z_{\\mathrm{env}}}{\\mu_{\\mathrm{HHe}}} + \\frac{Z_{\\mathrm{env}}}{\\mu_Z} \\right)^{-1}.\n$$\nThis arises from converting mass fractions to number fractions $n_i \\propto \\frac{w_i}{\\mu_i}$ and defining the mean molecular weight as the inverse of the total number fraction per unit mass.\n\nStep $4$ (Envelope mass and base pressure): The hydrostatic column mass above the base is $\\Sigma = \\int_0^\\infty \\rho\\,dz = \\frac{P_{\\mathrm{b}}}{g}$. The envelope mass over the core surface area is therefore\n$$\nM_{\\mathrm{env}} = 4 \\pi R_{\\mathrm{c}}^2 \\Sigma = 4 \\pi R_{\\mathrm{c}}^2 \\frac{P_{\\mathrm{b}}}{g}.\n$$\nSolving for the base pressure yields\n$$\nP_{\\mathrm{b}} = \\frac{M_{\\mathrm{env}} g}{4 \\pi R_{\\mathrm{c}}^2} = \\frac{f_{\\mathrm{env}} M g}{4 \\pi R_{\\mathrm{c}}^2}.\n$$\nThis expression couples the envelope mass fraction, gravity, and core radius. Note that $g = \\frac{G M}{R^2}$ with $R = R_{\\mathrm{c}} + \\Delta R$ is itself a function of the total radius, requiring iterative consistency for $R$.\n\nStep $5$ (Fixed-point iteration for radius): For a given $f_{\\mathrm{env}}$ and $Z_{\\mathrm{env}}$, compute $M_{\\mathrm{c}}$ and $R_{\\mathrm{c}}$. Initialize $R$ with $R_{\\mathrm{c}}$, then iterate the following steps until convergence:\n- Compute $g = \\frac{G M}{R^2}$.\n- Compute $\\mu$ via $\\mu(Z_{\\mathrm{env}})$.\n- Compute $H = \\frac{k_{\\mathrm{B}} T}{\\mu m_{\\mathrm{H}} g}$.\n- Compute $P_{\\mathrm{b}} = \\frac{f_{\\mathrm{env}} M g}{4 \\pi R_{\\mathrm{c}}^2}$.\n- Compute $\\Delta R$ from $H$ and the logarithmic relation if $P_{\\mathrm{b}} > P_{\\mathrm{ph}}$, otherwise set $\\Delta R = 0$.\n- Update $R \\leftarrow R_{\\mathrm{c}} + \\Delta R$ and repeat until the fractional change in $R$ is smaller than a tolerance (e.g., $10^{-8}$).\n\nThis fixed-point scheme is stable because $\\Delta R$ responds smoothly to changes in $g$ and $R$, and the logarithm enforces monotonicity in pressure ratios.\n\nStep $6$ (Root-bracketing in envelope fraction): Define the function $R(f_{\\mathrm{env}}; Z_{\\mathrm{env}})$ as the converged radius from the iterative scheme. Note the following qualitative behavior:\n- As $f_{\\mathrm{env}} \\to 0$, $R \\to R_{\\mathrm{c}}$ and typically $R < R_{\\mathrm{obs}}$ for sub-Neptune targets, because the core alone is too compact.\n- As $f_{\\mathrm{env}}$ increases, the base pressure $P_{\\mathrm{b}}$ increases, enhancing $\\Delta R$, and although $R_{\\mathrm{c}}$ decreases with lower core mass, the envelope thickness generally dominates, causing $R$ to increase. Higher $Z_{\\mathrm{env}}$ increases $\\mu$, which reduces the scale height $H$, decreasing $\\Delta R$ and thus requiring a larger $f_{\\mathrm{env}}$ to reach the same $R_{\\mathrm{obs}}$.\n\nUse bisection on $f_{\\mathrm{env}} \\in [0, f_{\\mathrm{max}}]$ (with $f_{\\mathrm{max}} = 0.5$) to find the minimum fraction such that $R(f_{\\mathrm{env}}; Z_{\\mathrm{env}}) \\ge R_{\\mathrm{obs}}$. If $R(0; Z_{\\mathrm{env}}) \\ge R_{\\mathrm{obs}}$, the minimum fraction is $0$. If $R(f_{\\mathrm{max}}; Z_{\\mathrm{env}}) < R_{\\mathrm{obs}}$, return $f_{\\mathrm{max}}$ to indicate the bracket was insufficient.\n\nStep $7$ (Units and constants): Convert $M$ and $R_{\\mathrm{obs}}$ from Earth units to SI using $M_\\oplus$ and $R_\\oplus$. Use:\n- $G$ for Newton's gravitational constant,\n- $k_{\\mathrm{B}}$ for the Boltzmann constant,\n- $m_{\\mathrm{H}}$ for the mass of a hydrogen atom,\n- $\\mu_{\\mathrm{HHe}} = 2.3$,\n- $\\mu_Z = 18$,\n- $P_{\\mathrm{ph}} = 2.0 \\times 10^4\\,\\mathrm{Pa}$.\n\nStep $8$ (Test suite and output): Evaluate the minimum $f_{\\mathrm{env}}$ for the four test cases specified:\n- Case $1$: $Z_{\\mathrm{env}} = 0.0$, $T = 800\\,\\mathrm{K}$.\n- Case $2$: $Z_{\\mathrm{env}} = 0.5$, $T = 800\\,\\mathrm{K}$.\n- Case $3$: $Z_{\\mathrm{env}} = 0.9$, $T = 800\\,\\mathrm{K}$.\n- Case $4$: $Z_{\\mathrm{env}} = 0.0$, $T = 400\\,\\mathrm{K}$.\nRound each result to six decimal places and output as a single line in the format $[x_1,x_2,x_3,x_4]$, where $x_i$ are unitless decimal fractions.\n\nThis approach connects the exoplanet mass-radius relationship to atmospheric structure via hydrostatic equilibrium and the Ideal Gas Law, translates envelope metallicity into mean molecular weight effects on scale height, and employs an iterative, physically consistent radius computation combined with root-bracketing on envelope mass fraction. The model’s behavior with respect to $Z_{\\mathrm{env}}$ is physically intuitive: larger $\\mu$ reduces $H$, which raises the required $f_{\\mathrm{env}}$ to achieve a given $R_{\\mathrm{obs}}$. The cold-temperature edge case further reduces $H$, serving as a boundary condition that increases the minimum fraction and tests algorithmic robustness.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Physical constants (SI units)\nG = 6.67430e-11            # Gravitational constant, m^3 kg^-1 s^-2\nk_B = 1.380649e-23         # Boltzmann constant, J K^-1\nm_H = 1.6735575e-27        # Mass of hydrogen atom, kg\n\n# Earth reference values (SI units)\nM_EARTH = 5.9722e24        # kg\nR_EARTH = 6.371e6          # m\n\n# Model parameters\nalpha_core = 0.27          # Core mass-radius exponent for Earth-like composition\nmu_HHe = 2.3               # Mean molecular weight of H/He mixture (amu)\nmu_Z = 18.0                # Representative heavy molecule mean molecular weight (amu), e.g., H2O\nP_ph = 2.0e4               # Photospheric pressure, Pa\n\n# Target planet properties (SI units)\nM_total = 5.0 * M_EARTH\nR_obs = 2.5 * R_EARTH\n\ndef mu_mix(Z, mu_hhe=mu_HHe, muz=mu_Z):\n    \"\"\"\n    Mean molecular weight (dimensionless, in atomic mass units) for a mixture with\n    heavy-molecule mass fraction Z using mass-fraction harmonic mean:\n    1/mu = (1-Z)/mu_hhe + Z/muz\n    \"\"\"\n    return 1.0 / ((1.0 - Z) / mu_hhe + Z / muz)\n\ndef core_radius(M_core, alpha=alpha_core):\n    \"\"\"\n    Earth-like rocky core mass-radius relationship:\n    R_c = R_EARTH * (M_core / M_EARTH)^alpha\n    \"\"\"\n    if M_core = 0.0:\n        return 0.0\n    return R_EARTH * (M_core / M_EARTH) ** alpha\n\ndef model_radius(f_env, Z_env, T, M_tot=M_total, R_target_obs=R_obs, max_iter=200, tol=1e-10):\n    \"\"\"\n    Compute the self-consistent total radius for given envelope fraction f_env and metallicity Z_env.\n    Iterates gravity and scale height until radius converges.\n    \"\"\"\n    # Core mass and radius\n    M_core = max((1.0 - f_env) * M_tot, 0.0)\n    R_c = core_radius(M_core)\n\n    # Initialize radius\n    R = max(R_c, 1.0)  # avoid division by zero\n\n    # Precompute mean molecular weight\n    mu = mu_mix(Z_env)\n\n    # Fixed-point iteration\n    for _ in range(max_iter):\n        # Surface gravity at current radius\n        g = G * M_tot / (R ** 2) if R > 0 else 0.0\n\n        # Scale height\n        H = k_B * T / (mu * m_H * g) if g > 0 else 0.0\n\n        # Base pressure from envelope mass fraction\n        P_b = (f_env * M_tot * g) / (4.0 * np.pi * max(R_c, 1.0)**2) if R_c > 0 and g > 0 else 0.0\n\n        # Envelope thickness\n        if P_b = P_ph or H = 0.0:\n            delta_R = 0.0\n        else:\n            delta_R = H * np.log(P_b / P_ph)\n\n        R_new = R_c + max(delta_R, 0.0)\n\n        # Convergence check\n        if R > 0:\n            if abs(R_new - R) / R  tol:\n                R = R_new\n                break\n        if abs(R_new - R)  (tol * R_EARTH):\n            R = R_new\n            break\n\n        R = R_new\n\n    return R\n\ndef find_min_f_env(Z_env, T, M_tot=M_total, R_target_obs=R_obs, f_max=0.5, tol=1e-12, max_bisect_iter=80):\n    \"\"\"\n    Find the minimal f_env such that model_radius(f_env, Z_env, T) >= R_target_obs using bisection.\n    \"\"\"\n    # Evaluate at lower bound\n    R_low = model_radius(0.0, Z_env, T, M_tot, R_target_obs)\n    if R_low >= R_target_obs:\n        return 0.0\n\n    # Evaluate at upper bound\n    R_high = model_radius(f_max, Z_env, T, M_tot, R_target_obs)\n    if R_high  R_target_obs:\n        # No solution within bracket; return f_max as indicator\n        return f_max\n\n    # Bisection\n    lo = 0.0\n    hi = f_max\n    for _ in range(max_bisect_iter):\n        mid = 0.5 * (lo + hi)\n        R_mid = model_radius(mid, Z_env, T, M_tot, R_target_obs)\n        if R_mid >= R_target_obs:\n            hi = mid\n        else:\n            lo = mid\n        if hi - lo  tol:\n            break\n\n    return hi\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Z_env, T_K)\n    test_cases = [\n        (0.0, 800.0),  # Case 1: pure H/He, nominal temperature\n        (0.5, 800.0),  # Case 2: moderate metallicity\n        (0.9, 800.0),  # Case 3: very metal-rich envelope\n        (0.0, 400.0),  # Case 4: cold-envelope edge case\n    ]\n\n    results = []\n    for Z_env, T in test_cases:\n        f_min = find_min_f_env(Z_env, T)\n        # Round to six decimal places\n        results.append(f\"{f_min:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "A central challenge in exoplanet science is breaking degeneracies, where different physical models can explain the same observation. This practice focuses on the crucial interplay between a rocky planet's interior and its atmosphere, demonstrating how even a thin atmosphere can systematically bias our inference of interior composition. By simulating a retrieval of the core mass fraction with and without an atmospheric correction , you will directly quantify this bias and learn a fundamental technique for more robustly characterizing terrestrial worlds.",
            "id": "4166866",
            "problem": "Consider a two-layer exoplanet composed of an iron core and a silicate mantle observed in transit. The observable transit radius is generally offset from the radius at a fiducial pressure level by the presence of an atmosphere. The goal is to quantify the bias in inferred interior composition, parameterized by the core mass fraction, when the atmosphere-induced radius offset is ignored or approximately corrected. Work entirely from first principles, starting from hydrostatic equilibrium and the ideal gas law for the atmosphere, and mass and volume conservation for the interior.\n\nFundamental bases and assumptions:\n- Hydrostatic equilibrium for a static, plane-parallel atmosphere yields $dP/dz = -\\rho g$, where $P$ is pressure, $z$ is geometric height, $\\rho$ is mass density, and $g$ is local gravity assumed approximately constant over the atmospheric thickness. The ideal gas law relates $\\rho$ and $P$ by $P = n k_{\\mathrm{B}} T$ and $\\rho = n \\mu$, where $n$ is number density, $k_{\\mathrm{B}}$ is the Boltzmann constant, $T$ is temperature, and $\\mu$ is mean molecular mass per particle. From these, derive the isothermal scale height $H$ and use it to approximate the atmosphere-induced transit radius offset $\\Delta R_{\\mathrm{atm}}$ as a multiple of the scale height.\n- The planet interior is approximated as two homogeneous incompressible layers: an iron core of constant density $\\rho_{\\mathrm{Fe}}$ and a silicate mantle of constant density $\\rho_{\\mathrm{rock}}$. Under this assumption, the total volume is the sum of partial volumes, and the total radius is determined by total volume.\n\nDefinitions and constants to use in your derivation and implementation:\n- Gravitational constant $G = 6.67430\\times 10^{-11}\\,\\mathrm{m}^3\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-2}$.\n- Boltzmann constant $k_{\\mathrm{B}} = 1.380649\\times 10^{-23}\\,\\mathrm{J}\\,\\mathrm{K}^{-1}$.\n- Proton mass $m_{\\mathrm{p}} = 1.67262192369\\times 10^{-27}\\,\\mathrm{kg}$.\n- Iron density $\\rho_{\\mathrm{Fe}} = 8000\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$.\n- Silicate rock density $\\rho_{\\mathrm{rock}} = 3500\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$.\n- Earth mass $M_{\\oplus} = 5.9722\\times 10^{24}\\,\\mathrm{kg}$.\n\nAtmospheric transit radius offset model:\n- For an isothermal atmosphere with mean molecular mass $\\mu$ and temperature $T$, define the isothermal scale height as $H = k_{\\mathrm{B}} T / (\\mu g)$, where $g = G M / R^2$ is surface gravity for a planet of mass $M$ and radius $R$.\n- Approximate the transit radius offset as $\\Delta R_{\\mathrm{atm}} = N_{H} H$, where $N_{H}$ is a dimensionless constant representing the number of scale heights at which the effective transit chord becomes optically thick. Use $N_{H}$ provided per test case.\n\nInterior composition and radius:\n- Let the core mass fraction be $\\mathrm{CMF} \\in [0,1]$, so the iron core mass is $M_{\\mathrm{core}} = \\mathrm{CMF}\\,M$ and the mantle mass is $M_{\\mathrm{mantle}} = (1-\\mathrm{CMF})\\,M$.\n- Under the volume additivity assumption for incompressible layers, the total interior radius $R_{\\mathrm{int}}$ satisfies volume conservation with partial volumes $V_{\\mathrm{core}} = M_{\\mathrm{core}}/\\rho_{\\mathrm{Fe}}$ and $V_{\\mathrm{mantle}} = M_{\\mathrm{mantle}}/\\rho_{\\mathrm{rock}}$. The observable transit radius is $R_{\\mathrm{obs}} = R_{\\mathrm{int}} + \\Delta R_{\\mathrm{atm}}$.\n\nRetrieval strategies to compare:\n- Naive retrieval (ignoring atmosphere): Infer $\\mathrm{CMF}$ from $M$ and $R_{\\mathrm{obs}}$ using the two-layer volume additivity model.\n- Corrected retrieval (with transit radius correction): Estimate $\\Delta R_{\\mathrm{atm}}$ from $M$, $R_{\\mathrm{obs}}$, $T$, and $\\mu$ using the isothermal scale height with $g$ computed from $R_{\\mathrm{obs}}$, then subtract it to obtain $R_{\\mathrm{corr}} = R_{\\mathrm{obs}} - \\Delta R_{\\mathrm{atm,est}}$. Infer $\\mathrm{CMF}$ from $M$ and $R_{\\mathrm{corr}}$ using the same two-layer model.\n\nYou must:\n1. Derive the isothermal scale height $H$ from hydrostatic equilibrium and the ideal gas law.\n2. Derive the expression linking $M$, $R$, $\\rho_{\\mathrm{Fe}}$, $\\rho_{\\mathrm{rock}}$, and $\\mathrm{CMF}$ based on the volume additivity model, and invert it to retrieve $\\mathrm{CMF}$ from $M$ and $R$.\n3. Implement a program that, for each test case below, computes:\n   - The \"true\" interior radius $R_{\\mathrm{int}}$ from the known $M$ and true $\\mathrm{CMF}$,\n   - The true atmosphere offset $\\Delta R_{\\mathrm{atm,true}}$ using $R_{\\mathrm{int}}$,\n   - The observed radius $R_{\\mathrm{obs}}$,\n   - The naive inferred core mass fraction $\\mathrm{CMF}_{\\mathrm{naive}}$ ignoring atmosphere,\n   - The corrected inferred core mass fraction $\\mathrm{CMF}_{\\mathrm{corr}}$ using a transit radius correction computed with $g$ from $R_{\\mathrm{obs}}$,\n   - The biases $b_{\\mathrm{naive}} = \\mathrm{CMF}_{\\mathrm{naive}} - \\mathrm{CMF}_{\\mathrm{true}}$ and $b_{\\mathrm{corr}} = \\mathrm{CMF}_{\\mathrm{corr}} - \\mathrm{CMF}_{\\mathrm{true}}$.\n4. Express masses in $\\mathrm{kg}$, radii in $\\mathrm{m}$, temperatures in $\\mathrm{K}$, and mean molecular masses in $\\mathrm{kg}$ per particle. Biases are dimensionless and must be reported as decimal numbers rounded to six decimal places.\n\nTest suite:\n- Case $1$: $M = 1.0\\,M_{\\oplus}$, $\\mathrm{CMF}_{\\mathrm{true}} = 0.32$, $T = 800\\,\\mathrm{K}$, $\\mu = 2.3\\,m_\\mathrm{p}$, $N_{H} = 5$.\n- Case $2$: $M = 1.0\\,M_{\\oplus}$, $\\mathrm{CMF}_{\\mathrm{true}} = 0.32$, $T = 800\\,\\mathrm{K}$, $\\mu = 2.3\\,m_\\mathrm{p}$, $N_{H} = 0$.\n- Case $3$: $M = 0.5\\,M_{\\oplus}$, $\\mathrm{CMF}_{\\mathrm{true}} = 0.30$, $T = 1000\\,\\mathrm{K}$, $\\mu = 2.3\\,m_\\mathrm{p}$, $N_{H} = 5$.\n- Case $4$: $M = 5.0\\,M_{\\oplus}$, $\\mathrm{CMF}_{\\mathrm{true}} = 0.20$, $T = 1200\\,\\mathrm{K}$, $\\mu = 2.3\\,m_\\mathrm{p}$, $N_{H} = 5$.\n- Case $5$: $M = 1.5\\,M_{\\oplus}$, $\\mathrm{CMF}_{\\mathrm{true}} = 0.35$, $T = 300\\,\\mathrm{K}$, $\\mu = 28.0\\,m_\\mathrm{p}$, $N_{H} = 5$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case and is itself a list of two floats $[b_{\\mathrm{naive}}, b_{\\mathrm{corr}}]$, each rounded to six decimal places. For example, for two hypothetical results it should look like $[[0.123456,-0.000321],[\\dots,\\dots]]$.",
            "solution": "The problem requires an analysis of the systematic bias in determining an exoplanet's core mass fraction (CMF) when an overlying atmosphere affects the observed transit radius. We will first derive the necessary physical and mathematical relationships from first principles, and then outline the computational procedure to quantify the bias for two different retrieval strategies.\n\n### 1. Derivations from First Principles\n\n#### Derivation of the Isothermal Scale Height ($H$)\nThe structure of the atmosphere is governed by the equation of hydrostatic equilibrium, which in a plane-parallel approximation is:\n$$\n\\frac{dP}{dz} = -\\rho g\n$$\nwhere $P$ is the pressure, $z$ is the altitude, $\\rho$ is the mass density, and $g$ is the local gravitational acceleration, assumed constant over the atmosphere's extent.\n\nThe atmosphere is modeled as an ideal gas, whose density $\\rho$ is related to pressure $P$ and temperature $T$ by:\n$$\n\\rho = \\frac{\\mu P}{k_{\\mathrm{B}} T}\n$$\nThis is derived from the ideal gas law $P = n k_{\\mathrm{B}} T$ and the definition of mass density $\\rho = n\\mu$, where $n$ is the number density, $\\mu$ is the mean molecular mass per particle, and $k_{\\mathrm{B}}$ is the Boltzmann constant.\n\nSubstituting the expression for $\\rho$ into the hydrostatic equilibrium equation gives:\n$$\n\\frac{dP}{dz} = -\\left(\\frac{\\mu P}{k_{\\mathrm{B}} T}\\right) g\n$$\nThis is a first-order ordinary differential equation for $P(z)$. For an isothermal atmosphere ($T$ is constant), we can rearrange the terms to separate the variables $P$ and $z$:\n$$\n\\frac{dP}{P} = -\\left(\\frac{\\mu g}{k_{\\mathrm{B}} T}\\right) dz\n$$\nThe term $\\frac{k_{\\mathrm{B}} T}{\\mu g}$ has units of length and represents the characteristic length scale over which the pressure changes significantly. This is defined as the isothermal scale height, $H$:\n$$\nH \\equiv \\frac{k_{\\mathrm{B}} T}{\\mu g}\n$$\nThe differential equation thus becomes $\\frac{dP}{P} = -\\frac{1}{H} dz$, which integrates to $P(z) = P_0 e^{-z/H}$, confirming $H$ as the e-folding length of the pressure profile. The problem models the atmosphere-induced transit radius offset as $\\Delta R_{\\mathrm{atm}} = N_{H} H$.\n\n#### Derivation of Core Mass Fraction ($\\mathrm{CMF}$) from Mass ($M$) and Radius ($R$)\nWe model the planet's interior as two incompressible layers: an iron core and a silicate mantle. The total mass $M$ is the sum of the core mass $M_{\\mathrm{core}}$ and mantle mass $M_{\\mathrm{mantle}}$. The core mass fraction, $\\mathrm{CMF}$, is defined as $\\mathrm{CMF} = M_{\\mathrm{core}} / M$.\n$$\nM_{\\mathrm{core}} = \\mathrm{CMF} \\cdot M\n$$\n$$\nM_{\\mathrm{mantle}} = (1 - \\mathrm{CMF}) \\cdot M\n$$\nUnder the incompressibility assumption, the volume of each layer is its mass divided by its constant density ($\\rho_{\\mathrm{Fe}}$ for the core, $\\rho_{\\mathrm{rock}}$ for the mantle).\n$$\nV_{\\mathrm{core}} = \\frac{M_{\\mathrm{core}}}{\\rho_{\\mathrm{Fe}}} = \\frac{\\mathrm{CMF} \\cdot M}{\\rho_{\\mathrm{Fe}}}\n$$\n$$\nV_{\\mathrm{mantle}} = \\frac{M_{\\mathrm{mantle}}}{\\rho_{\\mathrm{rock}}} = \\frac{(1 - \\mathrm{CMF}) \\cdot M}{\\rho_{\\mathrm{rock}}}\n$$\nThe total interior volume $V_{\\mathrm{int}}$ is the sum of the layer volumes, which is related to the total interior radius $R_{\\mathrm{int}}$:\n$$\nV_{\\mathrm{int}} = \\frac{4}{3}\\pi R_{\\mathrm{int}}^3 = V_{\\mathrm{core}} + V_{\\mathrm{mantle}}\n$$\nSubstituting the expressions for the layer volumes:\n$$\n\\frac{4}{3}\\pi R_{\\mathrm{int}}^3 = \\frac{\\mathrm{CMF} \\cdot M}{\\rho_{\\mathrm{Fe}}} + \\frac{(1 - \\mathrm{CMF}) \\cdot M}{\\rho_{\\mathrm{rock}}}\n$$\nTo derive an expression for $\\mathrm{CMF}$ as a function of $M$ and $R_{\\mathrm{int}}$, we can first express this relation in terms of the planet's average density, $\\bar{\\rho} = M / V_{\\mathrm{int}} = M / (\\frac{4}{3}\\pi R_{\\mathrm{int}}^3)$. Dividing the equation by $M$:\n$$\n\\frac{V_{\\mathrm{int}}}{M} = \\frac{1}{\\bar{\\rho}} = \\frac{\\mathrm{CMF}}{\\rho_{\\mathrm{Fe}}} + \\frac{1 - \\mathrm{CMF}}{\\rho_{\\mathrm{rock}}}\n$$\nWe now solve for $\\mathrm{CMF}$:\n$$\n\\frac{1}{\\bar{\\rho}} = \\mathrm{CMF} \\left(\\frac{1}{\\rho_{\\mathrm{Fe}}} - \\frac{1}{\\rho_{\\mathrm{rock}}}\\right) + \\frac{1}{\\rho_{\\mathrm{rock}}}\n$$\n$$\n\\frac{1}{\\bar{\\rho}} - \\frac{1}{\\rho_{\\mathrm{rock}}} = \\mathrm{CMF} \\left(\\frac{1}{\\rho_{\\mathrm{Fe}}} - \\frac{1}{\\rho_{\\mathrm{rock}}}\\right)\n$$\n$$\n\\mathrm{CMF} = \\frac{\\frac{1}{\\bar{\\rho}} - \\frac{1}{\\rho_{\\mathrm{rock}}}}{\\frac{1}{\\rho_{\\mathrm{Fe}}} - \\frac{1}{\\rho_{\\mathrm{rock}}}}\n$$\nThis expression allows the retrieval of the core mass fraction from a given total mass $M$ and interior radius $R_{\\mathrm{int}}$, by first calculating the average density $\\bar{\\rho}$.\n\n### 2. Computational Procedure for Bias Analysis\n\nFor each test case, we perform a three-stage calculation.\n\n**Stage 1: Forward Model (Simulating the \"True\" Planet and its Observation)**\nGiven the true mass $M$, true core mass fraction $\\mathrm{CMF}_{\\mathrm{true}}$, atmospheric temperature $T$, mean molecular weight $\\mu$, and scale height multiple $N_H$:\n1.  Calculate core and mantle masses: $M_{\\mathrm{core}} = \\mathrm{CMF}_{\\mathrm{true}} \\cdot M$ and $M_{\\mathrm{mantle}} = (1 - \\mathrm{CMF}_{\\mathrm{true}}) \\cdot M$.\n2.  Calculate core and mantle volumes: $V_{\\mathrm{core}} = M_{\\mathrm{core}}/\\rho_{\\mathrm{Fe}}$ and $V_{\\mathrm{mantle}} = M_{\\mathrm{mantle}}/\\rho_{\\mathrm{rock}}$.\n3.  Calculate the true total interior volume $V_{\\mathrm{int}} = V_{\\mathrm{core}} + V_{\\mathrm{mantle}}$ and the true interior radius $R_{\\mathrm{int}} = (\\frac{3V_{\\mathrm{int}}}{4\\pi})^{1/3}$.\n4.  Calculate the true surface gravity using the true interior radius: $g_{\\mathrm{true}} = GM/R_{\\mathrm{int}}^2$.\n5.  Calculate the true atmospheric scale height: $H_{\\mathrm{true}} = k_{\\mathrm{B}}T / (\\mu g_{\\mathrm{true}})$.\n6.  Calculate the true atmospheric radius offset: $\\Delta R_{\\mathrm{atm,true}} = N_H H_{\\mathrm{true}}$.\n7.  Calculate the \"observed\" transit radius: $R_{\\mathrm{obs}} = R_{\\mathrm{int}} + \\Delta R_{\\mathrm{atm,true}}$.\n\n**Stage 2: Naive Retrieval and Bias Calculation**\nThis strategy incorrectly assumes the observed radius is the interior radius, i.e., $R_{\\mathrm{int, naive}} = R_{\\mathrm{obs}}$.\n1.  Calculate the naive average density $\\bar{\\rho}_{\\mathrm{naive}} = M / (\\frac{4}{3}\\pi R_{\\mathrm{obs}}^3)$.\n2.  Use the derived inversion formula to find the naively inferred core mass fraction, $\\mathrm{CMF}_{\\mathrm{naive}}$:\n    $$\n    \\mathrm{CMF}_{\\mathrm{naive}} = \\frac{1/\\bar{\\rho}_{\\mathrm{naive}} - 1/\\rho_{\\mathrm{rock}}}{1/\\rho_{\\mathrm{Fe}} - 1/\\rho_{\\mathrm{rock}}}\n    $$\n3.  Calculate the naive bias: $b_{\\mathrm{naive}} = \\mathrm{CMF}_{\\mathrm{naive}} - \\mathrm{CMF}_{\\mathrm{true}}$.\n\n**Stage 3: Corrected Retrieval and Bias Calculation**\nThis strategy attempts to correct for the atmosphere by estimating its size and subtracting it from the observed radius.\n1.  Estimate the surface gravity using the observed radius: $g_{\\mathrm{est}} = GM/R_{\\mathrm{obs}}^2$.\n2.  Estimate the scale height based on this gravity: $H_{\\mathrm{est}} = k_{\\mathrm{B}}T / (\\mu g_{\\mathrm{est}})$.\n3.  Estimate the atmospheric offset: $\\Delta R_{\\mathrm{atm,est}} = N_H H_{\\mathrm{est}}$.\n4.  Calculate the corrected interior radius: $R_{\\mathrm{corr}} = R_{\\mathrm{obs}} - \\Delta R_{\\mathrm{atm,est}}$.\n5.  Calculate the corrected average density $\\bar{\\rho}_{\\mathrm{corr}} = M / (\\frac{4}{3}\\pi R_{\\mathrm{corr}}^3)$.\n6.  Use the inversion formula to find the corrected core mass fraction, $\\mathrm{CMF}_{\\mathrm{corr}}$:\n    $$\n    \\mathrm{CMF}_{\\mathrm{corr}} = \\frac{1/\\bar{\\rho}_{\\mathrm{corr}} - 1/\\rho_{\\mathrm{rock}}}{1/\\rho_{\\mathrm{Fe}} - 1/\\rho_{\\mathrm{rock}}}\n    $$\n7.  Calculate the corrected bias: $b_{\\mathrm{corr}} = \\mathrm{CMF}_{\\mathrm{corr}} - \\mathrm{CMF}_{\\mathrm{true}}$.\n\nThis full procedure is implemented for each test case to determine the two biases, which quantify the error introduced by the atmosphere and the effectiveness of the simple correction scheme.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the bias in inferred exoplanet core mass fraction due to\n    atmospheric effects, for both a naive and a corrected retrieval strategy.\n    \"\"\"\n\n    # --- Define Constants (SI units) ---\n    G = 6.67430e-11  # m^3 kg^-1 s^-2\n    k_B = 1.380649e-23  # J K^-1\n    m_p = 1.67262192369e-27  # kg\n    M_earth = 5.9722e24  # kg\n    rho_Fe = 8000.0  # kg m^-3\n    rho_rock = 3500.0  # kg m^-3\n\n    # --- Test Suite ---\n    test_cases = [\n        # (M in M_earth, CMF_true, T in K, mu in m_p, N_H)\n        (1.0, 0.32, 800.0, 2.3, 5.0),\n        (1.0, 0.32, 800.0, 2.3, 0.0),\n        (0.5, 0.30, 1000.0, 2.3, 5.0),\n        (5.0, 0.20, 1200.0, 2.3, 5.0),\n        (1.5, 0.35, 300.0, 28.0, 5.0),\n    ]\n\n    # --- Helper function to retrieve CMF from M and R ---\n    def get_cmf(M, R, rho_r, rho_f):\n        \"\"\"Calculates CMF from total mass M and interior radius R.\"\"\"\n        if R = 0:\n            return np.nan # Unphysical radius\n        \n        V_int = (4.0 / 3.0) * np.pi * R**3\n        rho_avg = M / V_int\n        \n        # Inversion formula: CMF = (1/rho_avg - 1/rho_r) / (1/rho_f - 1/rho_r)\n        term_avg = 1.0 / rho_avg\n        term_rock = 1.0 / rho_r\n        term_iron = 1.0 / rho_f\n        \n        cmf = (term_avg - term_rock) / (term_iron - term_rock)\n        return cmf\n\n    results = []\n    \n    for case in test_cases:\n        M_me, CMF_true, T, mu_mp, N_H = case\n        \n        # --- Convert inputs to SI units ---\n        M_kg = M_me * M_earth\n        mu_kg = mu_mp * m_p\n\n        # --- Stage 1: Forward Model (Simulating \"Truth\") ---\n        # Calculate true interior radius R_int\n        M_core_true = CMF_true * M_kg\n        M_mantle_true = (1.0 - CMF_true) * M_kg\n        V_core_true = M_core_true / rho_Fe\n        V_mantle_true = M_mantle_true / rho_rock\n        V_int_true = V_core_true + V_mantle_true\n        R_int_true = (3.0 * V_int_true / (4.0 * np.pi))**(1.0/3.0)\n\n        # Calculate true atmospheric offset and observed radius R_obs\n        g_true = G * M_kg / R_int_true**2\n        H_true = (k_B * T) / (mu_kg * g_true)\n        delta_R_atm_true = N_H * H_true\n        R_obs = R_int_true + delta_R_atm_true\n\n        # --- Stage 2: Naive Retrieval ---\n        # Assume R_int = R_obs\n        CMF_naive = get_cmf(M_kg, R_obs, rho_rock, rho_Fe)\n        b_naive = CMF_naive - CMF_true\n\n        # --- Stage 3: Corrected Retrieval ---\n        # Estimate atmospheric offset using R_obs to calculate gravity\n        g_est = G * M_kg / R_obs**2\n        H_est = (k_B * T) / (mu_kg * g_est)\n        delta_R_atm_est = N_H * H_est\n        R_corr = R_obs - delta_R_atm_est\n        \n        CMF_corr = get_cmf(M_kg, R_corr, rho_rock, rho_Fe)\n        b_corr = CMF_corr - CMF_true\n        \n        results.append([b_naive, b_corr])\n\n    # --- Final Output Formatting ---\n    formatted_results = []\n    for bn, bc in results:\n        formatted_results.append(f'[{bn:.6f},{bc:.6f}]')\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}