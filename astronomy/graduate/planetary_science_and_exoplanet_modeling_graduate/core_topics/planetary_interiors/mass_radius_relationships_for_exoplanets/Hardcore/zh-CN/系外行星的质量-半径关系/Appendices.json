{
    "hands_on_practices": [
        {
            "introduction": "在行星科学中，最简洁的物理模型往往是理解复杂现象最有力的起点。多方球模型（polytropic model）便是一个经典例子，它虽然经过了简化，却为我们理解气体巨行星的内部结构提供了深刻的洞见。本练习将引导你从流体静力学平衡和多方球状态方程出发，推导出一种理想化气体巨行星的质量-半径关系，揭示其一个关键且略显反直觉的特性。通过这个基础练习 ，你将掌握分析自引力天体结构的基本方法，并为后续更复杂的建模工作奠定坚实的物理基础。",
            "id": "4166849",
            "problem": "一个冷的氢-氦 (H-He) 巨行星可以用多方内层来近似。假设一个球对称的、自引力的流体处於靜流體平衡狀態，并遵循多方关系 $P = K \\rho^{1 + 1/n}$，其中指数 $n=1$，$P$ 是壓力，$\\rho$ 是質量密度，$K$ 是一個編碼了熱力學狀態和成分的常數。从静流体平衡的基本方程 $dP/dr = - G M(r) \\rho / r^{2}$ 和質量連續性方程 $dM/dr = 4 \\pi r^{2} \\rho$ 出發，其中 $G$ 是引力常數，$M(r)$ 是半径 $r$ 內包含的質量，推导由 $n=1$ 多方模型所蘊含的質量-半徑標度關係，並得到行星半徑 $R$ 關於 $K$ 和 $G$ 的表達式。\n\n选择 $K$ 值，使得一个质量为 $1\\,M_J$（$M_J$ 是木星质量）的 $n=1$ 多方模型能够再现木星半径 $R_J$。使用这个相同的 $K$ 值，计算质量分别为 $0.3\\,M_J$ 和 $3\\,M_J$ 的行星的半径（以 $R_J$ 为单位）。将你的两个半径值四舍五入到四位有效数字，并以木星半径 ($R_J$) 为单位表示。\n\n最后，定性地评论你得到的质量依赖关系与基于实际氢-氦状态方程 (EOS) 对冷的、无辐射巨行星的计算预期相比如何，并利用可压缩性和简并性的第一性原理来解释任何差异的物理根源。最终的数值答案应该是质量为 $0.3\\,M_J$ 和 $3\\,M_J$ 行星的两个半径，以 $R_J$ 为单位表示，并四舍五入到四位有效数字。",
            "solution": "该问题要求基于指数为 $n=1$ 的多方状态方程分析行星结构。分析过程是通过求解此特定情况下的恒星结构方程来推导质量-半径关系，然后用该关系计算不同质量行星的半径。\n\n提供的基本控制方程是：\n1.  静流體平衡方程：\n    $$ \\frac{dP}{dr} = - \\frac{G M(r) \\rho(r)}{r^2} $$\n2.  質量連續性方程：\n    $$ \\frac{dM(r)}{dr} = 4 \\pi r^2 \\rho(r) $$\n3.  指数为 $n=1$ 的多方状态方程：\n    $$ P = K \\rho^{1 + 1/n} = K \\rho^2 $$\n在这些方程中，$P$ 是压力，$\\rho$ 是质量密度，$r$ 是从中心开始的径向坐标，$M(r)$ 是半径 $r$ 内包含的质量，$G$ 是引力常数，$K$ 是多方常数。\n\n为了求解这个方程组，我们采用 Lane-Emden 形式。这包括将密度和半径归一化为无量纲变量。我们定义一个无量纲函数 $\\theta(\\xi)$ 和一个无量纲半径 $\\xi$ 如下：\n$$ \\rho(r) = \\rho_c \\theta^n(\\xi) = \\rho_c \\theta(\\xi) \\quad (\\text{for } n=1) $$\n$$ r = a \\xi $$\n其中 $\\rho_c$ 是中心密度，$a$ 是一个特征长度尺度。将这些代入控制方程，得到关于 $\\theta(\\xi)$ 的二阶常微分方程——Lane-Emden 方程。\n\n首先，我们通过对静流体平衡方程求导，将其与质量连续性方程结合起来：\n$$ \\frac{d}{dr}\\left(\\frac{r^2}{\\rho}\\frac{dP}{dr}\\right) = -G \\frac{dM(r)}{dr} = -4\\pi G r^2\\rho $$\n接下来，我们代入多方关系 $P = K\\rho^{1+1/n}$。压力梯度为 $\\frac{dP}{dr} = K(1+\\frac{1}{n})\\rho^{1/n}\\frac{d\\rho}{dr}$。\n对于 $n=1$ 的情况，$\\frac{dP}{dr} = 2K\\rho\\frac{d\\rho}{dr}$。结构方程变为：\n$$ \\frac{d}{dr}\\left(\\frac{r^2}{\\rho} (2K\\rho\\frac{d\\rho}{dr})\\right) = \\frac{d}{dr}\\left(2Kr^2\\frac{d\\rho}{dr}\\right) = -4\\pi G r^2\\rho $$\n代入 $\\rho = \\rho_c\\theta$ 和 $r = a\\xi$，我们得到：\n$$ \\frac{d}{a d\\xi}\\left(2K(a\\xi)^2 \\frac{d(\\rho_c\\theta)}{a d\\xi}\\right) = -4\\pi G (a\\xi)^2 (\\rho_c\\theta) $$\n$$ \\frac{2K\\rho_c a^2}{a^2} \\frac{d}{d\\xi}\\left(\\xi^2 \\frac{d\\theta}{d\\xi}\\right) = -4\\pi G a^2 \\xi^2 \\rho_c\\theta $$\n$$ \\frac{d}{d\\xi}\\left(\\xi^2 \\frac{d\\theta}{d\\xi}\\right) = -\\frac{2\\pi G a^2}{K} \\xi^2 \\theta $$\n为了得到 Lane-Emden 方程的正则形式，我们选择长度尺度 $a$，使得右侧的系数为 1。\n$$ a^2 = \\frac{K}{2\\pi G} \\implies a = \\sqrt{\\frac{K}{2\\pi G}} $$\n如此选择后，$n=1$ 的 Lane-Emden 方程为：\n$$ \\frac{1}{\\xi^2}\\frac{d}{d\\xi}\\left(\\xi^2 \\frac{d\\theta}{d\\xi}\\right) = -\\theta $$\n物理上合理的解在中心 ($\\xi=0$) 处必须是有限的，因此我们施加边界条件 $\\theta(0)=1$ 和 $\\frac{d\\theta}{d\\xi}|_{\\xi=0}=0$。满足这些条件的解是：\n$$ \\theta(\\xi) = \\frac{\\sin(\\xi)}{\\xi} $$\n行星的表面 $R$ 定义为密度首次变为零处的半径。这对应于 $\\theta(\\xi)$ 的第一个非平凡根，我们记为 $\\xi_1$。对于 $\\theta(\\xi) = \\frac{\\sin(\\xi)}{\\xi}$，这发生在 $\\sin(\\xi_1) = 0$ 时，即 $\\xi_1 = \\pi$。\n\n因此，行星的总半径为 $R = a \\xi_1 = a \\pi$。代入 $a$ 的表达式：\n$$ R = \\pi \\sqrt{\\frac{K}{2\\pi G}} = \\sqrt{\\frac{\\pi^2 K}{2\\pi G}} = \\sqrt{\\frac{\\pi K}{2G}} $$\n这就是所要求的半径 $R$ 的表达式。该结果的一个关键特征是，$R$ 仅依赖于常数 $K$ 和 $G$。它与行星的总质量 $M$ 或其中心密度 $\\rho_c$ 无关。这为 $n=1$ 多方模型建立了质量-半径标度关系：对于给定的 $K$，半径是恒定的。\n\n题目指出，对于质量为 $M=1\\,M_J$ 的行星，其半径为 $R=1\\,R_J$。这使我们能够确定常数 $K$ 的值。我们称之为 $K_J$。\n$$ R_J = \\sqrt{\\frac{\\pi K_J}{2G}} $$\n然后，题目要求我们计算质量为 $0.3\\,M_J$ 和 $3\\,M_J$ 的行星的半径，假设它们由相同的物理定律（即，具有相同常数 $K_J$ 的 $n=1$ 多方模型）描述。\n根据我们推导出的质量-半径关系，半径与质量无关。因此，这两颗行星的半径将与木星质量行星的半径相同。\n质量为 $0.3\\,M_J$ 行星的半径：$R_{0.3} = \\sqrt{\\frac{\\pi K_J}{2G}} = R_J$。\n质量为 $3.0\\,M_J$ 行星的半径：$R_{3.0} = \\sqrt{\\frac{\\pi K_J}{2G}} = R_J$。\n以木星半径 ($R_J$) 为单位表示，并四舍五入到四位有效数字，两个半径均为 $1.000$。\n\n题目还要求与实际模型进行定性比较。$n=1$ 多方模型预测的半径与质量无关 ($R \\propto M^0$)，这为质量范围大约在 0.5 到 5 倍木星质量的气态巨行星的行为提供了一个惊人合理的初步近似，在这一质量范围内，观测到的质量-半径关系相对平坦。\n\n然而，单一的多方指数是一种过度简化。氢-氦混合物的真实状态方程 (EOS) 是复杂的。出现差异是因为该模型未能解释随着质量增加，行星内部物理性质的变化。随着质量和中心压力的增加，电子简并压力在支撑行星抵抗引力坍縮方面变得越来越重要。对于质量非常大的巨行星和棕矮星，其状态方程接近于非相对论性简并费米气体，其压力-密度关系为 $P \\propto \\rho^{5/3}$。这对应于多方指数 $n = \\frac{1}{5/3 - 1} = \\frac{3}{2}$。对于 $n=3/2$ 的多方模型，质量-半径关系为 $R \\propto M^{-1/3}$，意味着半径随质量增加而减小。\n\n因此，实际模型预测，冷的氢-氦行星的半径并非恒定不变。对于低质量行星，半径随质量增加而增大；在几倍木星质量附近达到一个平台期或最大值；然后随着简并压力占主导地位，对于更高质量的行星，半径随质量增加而减小。$n=1$ 模型人为地用“平台”区域的物理特性来代表整个质量范围，因此错过了在更大质量处的转折点和随后的收缩。例如，一个真实的质量为 $3\\,M_J$ 的行星，其半径会比木星略小。这种差异的物理根源在于，简单的 $P=K\\rho^2$ 关系无法捕捉到向电子简并主导状态的过渡。",
            "answer": "$$ \\boxed{\n\\begin{pmatrix}\n1.000  1.000\n\\end{pmatrix}\n} $$"
        },
        {
            "introduction": "从理想化的气体巨行星模型出发，我们现在转向系外行星中数量庞大且结构多样的“次海王星”。这些行星通常具有岩石核心和气体包层的多层结构，其质量-半径关系无法用单一的多方球模型来描述。本次实践将带你从解析理论走向计算建模 ，构建一个双层结构模型来解决一个经典问题：解释一个给定质量和半径的行星需要多厚的“外衣”？通过编写程序，你将探索行星包层的质量分数如何影响其半径，并量化分析大气温度和金属丰度等关键参数的敏感性。",
            "id": "4166861",
            "problem": "您的任务是建立一个双层系外行星结构模型，用于在给定总质量的情况下，估算再现指定行星半径所需的最小包层质量分数，并测试该最小包层分数对包层金属丰度的敏感性。该模型必须基于基本物理原理和广泛接受的近似。目标系统是一颗类亚海王星行星，其总质量为 $M$，观测半径为 $R_{\\mathrm{obs}}$。该行星被建模为一个质量为 $M_{\\mathrm{c}}$ 的类地岩石核心，其上覆盖着一个质量为 $M_{\\mathrm{env}}$ 的等温氢氦包层，该包层富含重分子（金属丰度），其质量分数由 $Z_{\\mathrm{env}}$ 表征。包层质量分数定义为 $f_{\\mathrm{env}} = M_{\\mathrm{env}} / M$，目标是确定最小的 $f_{\\mathrm{env}}$，使得模型半径 $R$ 等于或超过 $R_{\\mathrm{obs}}$。\n\n您的程序必须严格遵循国际单位制（SI），并实现以下物理学原理和近似：\n\n- 模型包括一个岩石核心和一个气体包层。核心质量为 $M_{\\mathrm{c}} = (1 - f_{\\mathrm{env}}) M$，包层质量为 $M_{\\mathrm{env}} = f_{\\mathrm{env}} M$。\n- 核心半径 $R_{\\mathrm{c}}$ 遵循一个广泛使用的针对类地成分的近似质量-半径标度关系：$R_{\\mathrm{c}} = R_\\oplus \\left( \\frac{M_{\\mathrm{c}}}{M_\\oplus} \\right)^\\alpha$，其中 $R_\\oplus$ 和 $M_\\oplus$ 分别是地球半径和地球质量，$\\alpha$ 是一个常数指数，取值为 $0.27$。\n- 包层被视为温度为 $T$ 的等温层，并遵循理想气体定律。通过 $\\frac{dP}{dz} = -\\rho g$ 来强制实现流体静力学平衡，其中 $P$ 是压力， $z$ 是高度，$\\rho$ 是质量密度， $g$ 是局部引力加速度。结合理想气体定律 $P = \\rho R_{\\mathrm{gas}} T$（其中 $R_{\\mathrm{gas}} = \\frac{k_{\\mathrm{B}}}{\\mu m_{\\mathrm{H}}}$），可以得到指数压力剖面 $P(z) = P_{\\mathrm{b}} \\exp\\left(-\\frac{z}{H}\\right)$，其中 $P_{\\mathrm{b}}$ 是包层底部（核心顶部）的压力， $H = \\frac{k_{\\mathrm{B}} T}{\\mu m_{\\mathrm{H}} g}$ 是标高。此处 $k_{\\mathrm{B}}$ 是玻尔兹曼常数， $m_{\\mathrm{H}}$ 是原子质量单位（一个氢原子的质量），$\\mu$ 是以原子质量单位表示的无量纲平均分子量。\n- 平均分子量 $\\mu$ 是根据氢氦混合物和重分子的质量分数近似得出的。设氢氦组分的平均分子量为 $\\mu_{\\mathrm{HHe}}$，重分子组分的平均分子量为 $\\mu_Z$。对于重分子质量分数为 $Z_{\\mathrm{env}}$ 的情况，近似计算为\n$$\n\\mu(Z_{\\mathrm{env}}) = \\left( \\frac{1 - Z_{\\mathrm{env}}}{\\mu_{\\mathrm{HHe}}} + \\frac{Z_{\\mathrm{env}}}{\\mu_Z} \\right)^{-1}.\n$$\n- 光球层压力（凌星半径处的压力）固定为 $P_{\\mathrm{ph}}$。包层厚度近似为\n$$\n\\Delta R = \n\\begin{cases}\n0,   P_{\\mathrm{b}} \\le P_{\\mathrm{ph}}, \\\\\nH \\ln\\left( \\frac{P_{\\mathrm{b}}}{P_{\\mathrm{ph}}} \\right),  P_{\\mathrm{b}}  P_{\\mathrm{ph}},\n\\end{cases}\n$$\n其中 $H$ 使用表面引力 $g = \\frac{G M}{R^2}$ 和一个针对 $R$ 的迭代不动点方案进行评估，因为 $R = R_{\\mathrm{c}} + \\Delta R$ 会影响 $g$。\n- 包层质量通过流体静力学柱与底部压力相关联：\n$$\nM_{\\mathrm{env}} = 4 \\pi R_{\\mathrm{c}}^2 \\frac{P_{\\mathrm{b}}}{g_{\\mathrm{b}}}\n$$\n其中 $g_{\\mathrm{b}}$ 是在核心半径处计算的引力加速度。在此模型中，为保证迭代一致性，用与评估 $H$ 时相同的 $g$ 来近似 $g_{\\mathrm{b}}$。因此 $P_{\\mathrm{b}} \\approx \\frac{M_{\\mathrm{env}} g}{4 \\pi R_{\\mathrm{c}}^2}$。\n\n算法任务是，对于给定的 $Z_{\\mathrm{env}}$，确定最小的 $f_{\\mathrm{env}}$，使得模型半径 $R = R_{\\mathrm{c}} + \\Delta R$ 大于或等于 $R_{\\mathrm{obs}}$。这应该通过在一个物理上合理的区间 $[0, f_{\\mathrm{max}}]$（其中 $f_{\\mathrm{max}}$ 是一个选定的上界）上对 $f_{\\mathrm{env}}$ 使用单调求根区间法和二分法来解决。\n\n科学真实性要求：\n- 使用 $G$ 表示牛顿引力常数，$k_{\\mathrm{B}}$ 表示玻尔兹曼常数，$m_{\\mathrm{H}}$ 表示一个氢原子的质量。\n- 使用 $M_\\oplus$ 和 $R_\\oplus$（地球质量和半径）来定义 $M$ 和 $R_{\\mathrm{obs}}$。\n- 使用 $\\mu_{\\mathrm{HHe}} = 2.3$ 作为典型的氢氦平均分子量，$\\mu_Z = 18$ 作为代表性的重分子平均分子量（例如水），单位为原子质量单位。\n\n场景的输入参数：\n- 行星总质量 $M = 5 M_\\oplus$。\n- 观测半径 $R_{\\mathrm{obs}} = 2.5 R_\\oplus$。\n- 岩石核心质量-半径指数 $\\alpha = 0.27$。\n- 用于金属丰度敏感性分析的等温包层温度 $T = 800\\,\\mathrm{K}$。\n- 光球层压力 $P_{\\mathrm{ph}} = 2.0 \\times 10^4\\,\\mathrm{Pa}$。\n- 需要测试的金属丰度情况 $Z_{\\mathrm{env}} \\in \\{0.0, 0.5, 0.9\\}$。\n- 另外，包括一个 $Z_{\\mathrm{env}} = 0.0$ 和一个更冷的包层温度 $T = 400\\,\\mathrm{K}$ 的边界情况，以探测一个边界条件。\n\n您的程序必须：\n- 在给定的 $f_{\\mathrm{env}}$ 和 $Z_{\\mathrm{env}}$ 下，实现对 $R$ 的迭代不动点更新，直到收敛到某个容差（例如，$R$ 的相对变化小于 $10^{-8}$）。\n- 对每个测试用例，使用二分法在 $f_{\\mathrm{env}} \\in [0, 0.5]$ 区间内寻找使 $R \\ge R_{\\mathrm{obs}}$ 的最小包层分数，如果在该区间内未找到解，则返回 $f_{\\mathrm{max}}$。\n- 在所有计算中，将 $M$ 和 $R_{\\mathrm{obs}}$ 内部转换为国际单位制（SI）单位。\n- 最终结果以无量纲的小数形式表示 $f_{\\mathrm{env}}$，并四舍五入到六位小数。\n\n测试套件规范：\n- 情况 1：$Z_{\\mathrm{env}} = 0.0$, $T = 800\\,\\mathrm{K}$。\n- 情况 2：$Z_{\\mathrm{env}} = 0.5$, $T = 800\\,\\mathrm{K}$。\n- 情况 3：$Z_{\\mathrm{env}} = 0.9$, $T = 800\\,\\mathrm{K}$。\n- 情况 4（边界）：$Z_{\\mathrm{env}} = 0.0$, $T = 400\\,\\mathrm{K}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个测试用例的结果，结果为用方括号括起来的逗号分隔列表，顺序如上所列。例如，格式为 $[x_1,x_2,x_3,x_4]$，其中每个 $x_i$ 是对应测试用例的最小 $f_{\\mathrm{env}}$，四舍五入到六位小数，并表示为无量纲小数。",
            "solution": "目标是估算一个总质量为 $M$、观测半径为 $R_{\\mathrm{obs}}$ 的行星，其模型半径 $R \\ge R_{\\mathrm{obs}}$ 所需的最小包层质量分数 $f_{\\mathrm{env}}$，并考虑包层金属丰度 $Z_{\\mathrm{env}}$ 的影响。该模型将行星视为一个岩石核心加上一个等温理想气体包层。求解过程基于流体静力学平衡和理想气体定律，以及岩石核心的质量-半径标度关系。\n\n步骤 1（核心半径模型）：假设核心具有类地成分。对于核心质量 $M_{\\mathrm{c}} = (1 - f_{\\mathrm{env}}) M$，采用一个广泛使用的幂律标度关系\n$$\nR_{\\mathrm{c}} = R_\\oplus \\left( \\frac{M_{\\mathrm{c}}}{M_\\oplus} \\right)^\\alpha,\n$$\n其中 $\\alpha = 0.27$ 代表了岩石材料的可压缩性。该标度关系基于行星内部模型，并得到了跨越超级地球质量范围的类地成分行星的经验支持。\n\n步骤 2（包层热力学与流体静力学）：包层温度为 $T$ 且等温，遵循理想气体定律，\n$$\nP = \\rho R_{\\mathrm{gas}} T,\n$$\n其中 $R_{\\mathrm{gas}} = \\frac{k_{\\mathrm{B}}}{\\mu m_{\\mathrm{H}}}$，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$m_{\\mathrm{H}}$ 是一个氢原子的质量，$\\mu$ 是以原子质量单位表示的平均分子量。流体静力学平衡，\n$$\n\\frac{dP}{dz} = -\\rho g,\n$$\n与理想气体定律结合，得到指数压力剖面，\n$$\nP(z) = P_{\\mathrm{b}} \\exp\\left(-\\frac{z}{H}\\right), \\quad H = \\frac{k_{\\mathrm{B}} T}{\\mu m_{\\mathrm{H}} g},\n$$\n其中 $H$ 是标高，$g$ 是在半径 $R = R_{\\mathrm{c}} + \\Delta R$ 处的引力加速度。从底部压力 $P_{\\mathrm{b}}$ 到光球层压力 $P_{\\mathrm{ph}}$ 的包层厚度则为\n$$\n\\Delta R = \n\\begin{cases}\n0,   P_{\\mathrm{b}} \\le P_{\\mathrm{ph}}, \\\\\nH \\ln\\left( \\frac{P_{\\mathrm{b}}}{P_{\\mathrm{ph}}} \\right),  P_{\\mathrm{b}}  P_{\\mathrm{ph}}.\n\\end{cases}\n$$\n\n步骤 3（含金属丰度的平均分子量）：包层的平均分子量是根据氢氦和重分子的质量分数估算得出的。设氢氦的平均分子量为 $\\mu_{\\mathrm{HHe}}$，重分子的平均分子量为 $\\mu_Z$，则混合物的平均分子量近似为\n$$\n\\mu(Z_{\\mathrm{env}}) = \\left( \\frac{1 - Z_{\\mathrm{env}}}{\\mu_{\\mathrm{HHe}}} + \\frac{Z_{\\mathrm{env}}}{\\mu_Z} \\right)^{-1}.\n$$\n这是通过将质量分数转换为数量分数 $n_i \\propto \\frac{w_i}{\\mu_i}$ 并将平均分子量定义为单位质量总数量分数的倒数得出的。\n\n步骤 4（包层质量和底部压力）：核心底部以上的流体静力学柱质量为 $\\Sigma = \\int_0^\\infty \\rho\\,dz = \\frac{P_{\\mathrm{b}}}{g}$。因此，核心表面上方的包层质量为\n$$\nM_{\\mathrm{env}} = 4 \\pi R_{\\mathrm{c}}^2 \\Sigma = 4 \\pi R_{\\mathrm{c}}^2 \\frac{P_{\\mathrm{b}}}{g}.\n$$\n解出底部压力得\n$$\nP_{\\mathrm{b}} = \\frac{M_{\\mathrm{env}} g}{4 \\pi R_{\\mathrm{c}}^2} = \\frac{f_{\\mathrm{env}} M g}{4 \\pi R_{\\mathrm{c}}^2}.\n$$\n这个表达式将包层质量分数、引力和核心半径联系起来。请注意，$g = \\frac{G M}{R^2}$（其中 $R = R_{\\mathrm{c}} + \\Delta R$）本身是总半径的函数，需要对 $R$ 进行迭代以确保一致性。\n\n步骤 5（半径的不动点迭代）：对于给定的 $f_{\\mathrm{env}}$ 和 $Z_{\\mathrm{env}}$，计算 $M_{\\mathrm{c}}$ 和 $R_{\\mathrm{c}}$。用 $R_{\\mathrm{c}}$ 初始化 $R$，然后迭代以下步骤直至收敛：\n- 计算 $g = \\frac{G M}{R^2}$。\n- 通过 $\\mu(Z_{\\mathrm{env}})$ 计算 $\\mu$。\n- 计算 $H = \\frac{k_{\\mathrm{B}} T}{\\mu m_{\\mathrm{H}} g}$。\n- 计算 $P_{\\mathrm{b}} = \\frac{f_{\\mathrm{env}} M g}{4 \\pi R_{\\mathrm{c}}^2}$。\n- 如果 $P_{\\mathrm{b}}  P_{\\mathrm{ph}}$，则根据 $H$ 和对数关系计算 $\\Delta R$，否则设置 $\\Delta R = 0$。\n- 更新 $R \\leftarrow R_{\\mathrm{c}} + \\Delta R$ 并重复，直到 $R$ 的相对变化小于一个容差（例如，$10^{-8}$）。\n\n该不动点方案是稳定的，因为 $\\Delta R$ 对 $g$ 和 $R$ 的变化响应平滑，且对数函数确保了压力比的单调性。\n\n步骤 6（包层分数的求根区间法）：将函数 $R(f_{\\mathrm{env}}; Z_{\\mathrm{env}})$ 定义为从迭代方案中收敛得到的半径。注意以下定性行为：\n- 当 $f_{\\mathrm{env}} \\to 0$ 时，$R \\to R_{\\mathrm{c}}$，对于类亚海王星目标，通常 $R  R_{\\mathrm{obs}}$，因为单独的核心过于致密。\n- 随着 $f_{\\mathrm{env}}$ 增加，底部压力 $P_{\\mathrm{b}}$ 增加，从而增大 $\\Delta R$。尽管随着核心质量降低 $R_{\\mathrm{c}}$ 会减小，但包层厚度通常起主导作用，导致 $R$ 增加。更高的 $Z_{\\mathrm{env}}$ 会增加 $\\mu$，从而减小标高 $H$，进而减小 $\\Delta R$，因此需要更大的 $f_{\\mathrm{env}}$ 才能达到相同的 $R_{\\mathrm{obs}}$。\n\n对 $f_{\\mathrm{env}} \\in [0, f_{\\mathrm{max}}]$（其中 $f_{\\mathrm{max}} = 0.5$）使用二分法，找到使得 $R(f_{\\mathrm{env}}; Z_{\\mathrm{env}}) \\ge R_{\\mathrm{obs}}$ 的最小分数。如果 $R(0; Z_{\\mathrm{env}}) \\ge R_{\\mathrm{obs}}$，则最小分数为 $0$。如果 $R(f_{\\mathrm{max}}; Z_{\\mathrm{env}})  R_{\\mathrm{obs}}$，则返回 $f_{\\mathrm{max}}$ 以表示该区间不足以找到解。\n\n步骤 7（单位和常数）：使用 $M_\\oplus$ 和 $R_\\oplus$ 将 $M$ 和 $R_{\\mathrm{obs}}$ 从地球单位转换为国际单位制（SI）。使用：\n- $G$ 表示牛顿引力常数，\n- $k_{\\mathrm{B}}$ 表示玻尔兹曼常数，\n- $m_{\\mathrm{H}}$ 表示一个氢原子的质量，\n- $\\mu_{\\mathrm{HHe}} = 2.3$，\n- $\\mu_Z = 18$，\n- $P_{\\mathrm{ph}} = 2.0 \\times 10^4\\,\\mathrm{Pa}$。\n\n步骤 8（测试套件和输出）：为指定的四个测试用例评估最小的 $f_{\\mathrm{env}}$：\n- 情况 1：$Z_{\\mathrm{env}} = 0.0$, $T = 800\\,\\mathrm{K}$。\n- 情况 2：$Z_{\\mathrm{env}} = 0.5$, $T = 800\\,\\mathrm{K}$。\n- 情况 3：$Z_{\\mathrm{env}} = 0.9$, $T = 800\\,\\mathrm{K}$。\n- 情况 4：$Z_{\\mathrm{env}} = 0.0$, $T = 400\\,\\mathrm{K}$。\n将每个结果四舍五入到六位小数，并以 $[x_1,x_2,x_3,x_4]$ 格式单行输出，其中 $x_i$ 是无量纲小数。\n\n该方法通过流体静力学平衡和理想气体定律将系外行星的质量-半径关系与大气结构联系起来，将包层金属丰度转化为平均分子量对标高的影响，并采用一种迭代的、物理上一致的半径计算方法，结合对包层质量分数的求根区间法。该模型关于 $Z_{\\mathrm{env}}$ 的行为在物理上是直观的：更大的 $\\mu$ 会减小 $H$，从而需要更大的 $f_{\\mathrm{env}}$ 才能达到给定的 $R_{\\mathrm{obs}}$。低温边界情况会进一步减小 $H$，作为一个边界条件，它会增加最小分数并测试算法的鲁棒性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Physical constants (SI units)\nG = 6.67430e-11            # Gravitational constant, m^3 kg^-1 s^-2\nk_B = 1.380649e-23         # Boltzmann constant, J K^-1\nm_H = 1.6735575e-27        # Mass of hydrogen atom, kg\n\n# Earth reference values (SI units)\nM_EARTH = 5.9722e24        # kg\nR_EARTH = 6.371e6          # m\n\n# Model parameters\nalpha_core = 0.27          # Core mass-radius exponent for Earth-like composition\nmu_HHe = 2.3               # Mean molecular weight of H/He mixture (amu)\nmu_Z = 18.0                # Representative heavy molecule mean molecular weight (amu), e.g., H2O\nP_ph = 2.0e4               # Photospheric pressure, Pa\n\n# Target planet properties (SI units)\nM_total = 5.0 * M_EARTH\nR_obs = 2.5 * R_EARTH\n\ndef mu_mix(Z, mu_hhe=mu_HHe, muz=mu_Z):\n    \"\"\"\n    Mean molecular weight (dimensionless, in atomic mass units) for a mixture with\n    heavy-molecule mass fraction Z using mass-fraction harmonic mean:\n    1/mu = (1-Z)/mu_hhe + Z/muz\n    \"\"\"\n    return 1.0 / ((1.0 - Z) / mu_hhe + Z / muz)\n\ndef core_radius(M_core, alpha=alpha_core):\n    \"\"\"\n    Earth-like rocky core mass-radius relationship:\n    R_c = R_EARTH * (M_core / M_EARTH)^alpha\n    \"\"\"\n    if M_core == 0.0:\n        return 0.0\n    return R_EARTH * (M_core / M_EARTH) ** alpha\n\ndef model_radius(f_env, Z_env, T, M_tot=M_total, R_target_obs=R_obs, max_iter=200, tol=1e-10):\n    \"\"\"\n    Compute the self-consistent total radius for given envelope fraction f_env and metallicity Z_env.\n    Iterates gravity and scale height until radius converges.\n    \"\"\"\n    # Core mass and radius\n    M_core = max((1.0 - f_env) * M_tot, 0.0)\n    R_c = core_radius(M_core)\n\n    # Initialize radius\n    R = max(R_c, 1.0)  # avoid division by zero\n\n    # Precompute mean molecular weight\n    mu = mu_mix(Z_env)\n\n    # Fixed-point iteration\n    for _ in range(max_iter):\n        # Surface gravity at current radius\n        g = G * M_tot / (R ** 2) if R > 0 else 0.0\n\n        # Scale height\n        H = k_B * T / (mu * m_H * g) if g > 0 else 0.0\n\n        # Base pressure from envelope mass fraction\n        P_b = (f_env * M_tot * g) / (4.0 * np.pi * max(R_c, 1.0)**2) if R_c > 0 and g > 0 else 0.0\n\n        # Envelope thickness\n        if P_b = P_ph or H == 0.0:\n            delta_R = 0.0\n        else:\n            delta_R = H * np.log(P_b / P_ph)\n\n        R_new = R_c + max(delta_R, 0.0)\n\n        # Convergence check\n        if R > 0:\n            if abs(R_new - R) / R  tol:\n                R = R_new\n                break\n        if abs(R_new - R)  (tol * R_EARTH):\n            R = R_new\n            break\n\n        R = R_new\n\n    return R\n\ndef find_min_f_env(Z_env, T, M_tot=M_total, R_target_obs=R_obs, f_max=0.5, tol=1e-12, max_bisect_iter=80):\n    \"\"\"\n    Find the minimal f_env such that model_radius(f_env, Z_env, T) >= R_target_obs using bisection.\n    \"\"\"\n    # Evaluate at lower bound\n    R_low = model_radius(0.0, Z_env, T, M_tot, R_target_obs)\n    if R_low >= R_target_obs:\n        return 0.0\n\n    # Evaluate at upper bound\n    R_high = model_radius(f_max, Z_env, T, M_tot, R_target_obs)\n    if R_high  R_target_obs:\n        # No solution within bracket; return f_max as indicator\n        return f_max\n\n    # Bisection\n    lo = 0.0\n    hi = f_max\n    for _ in range(max_bisect_iter):\n        mid = 0.5 * (lo + hi)\n        R_mid = model_radius(mid, Z_env, T, M_tot, R_target_obs)\n        if R_mid >= R_target_obs:\n            hi = mid\n        else:\n            lo = mid\n        if hi - lo  tol:\n            break\n\n    return hi\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Z_env, T_K)\n    test_cases = [\n        (0.0, 800.0),  # Case 1: pure H/He, nominal temperature\n        (0.5, 800.0),  # Case 2: moderate metallicity\n        (0.9, 800.0),  # Case 3: very metal-rich envelope\n        (0.0, 400.0),  # Case 4: cold-envelope edge case\n    ]\n\n    results = []\n    for Z_env, T in test_cases:\n        f_min = find_min_f_env(Z_env, T)\n        # Round to six decimal places\n        results.append(f\"{f_min:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "理论模型与观测数据之间存在着一道需要谨慎跨越的鸿沟，那就是系统性偏差。例如，我们通过凌星法观测到的行星半径并非其固体表面，而是大气层中某个特定的光学深度处的高度。本练习将深入探讨这种大气层造成的半径偏移如何影响我们对类地行星内部成分的推断，特别是其核心质量分数（core mass fraction, $\\mathrm{CMF}$）。通过模拟一个“天真”的（忽略大气效应）和一个“修正”的分析过程，你将亲身体会到精确解读系外行星观测数据时的微妙之处，并对模型假设的重要性有更深刻的认识。",
            "id": "4166866",
            "problem": "考虑一颗由铁核和硅酸盐地幔组成的双层系外行星，在凌星期间被观测到。可观测到的凌星半径通常因大气层的存在而偏离某个基准压力水平下的半径。目标是量化当忽略或近似校正由大气层引起的半径偏差时，推断的内部成分（由核质量分数参数化）中的偏差。完全从第一性原理出发，从大气的流体静力学平衡和理想气体定律，以及内部的质量和体积守恒开始。\n\n基本依据和假设：\n- 静态、平面平行大气的流体静力学平衡得出 $dP/dz = -\\rho g$，其中 $P$ 是压力，$z$ 是几何高度，$\\rho$ 是质量密度，$g$ 是局部重力（假定在大气厚度范围内近似恒定）。理想气体定律通过 $P = n k_{\\mathrm{B}} T$ 和 $\\rho = n \\mu$ 将 $\\rho$ 和 $P$ 联系起来，其中 $n$ 是数密度，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是温度，$\\mu$ 是每个粒子的平均分子质量。从这些关系中，推导出等温标高 $H$，并用它来近似由大气引起的凌星半径偏移 $\\Delta R_{\\mathrm{atm}}$ 作为标高的倍数。\n- 行星内部被近似为两个均匀的不可压缩层：一个密度恒为 $\\rho_{\\mathrm{Fe}}$ 的铁核和一个密度恒为 $\\rho_{\\mathrm{rock}}$ 的硅酸盐地幔。在此假设下，总体积是部分体积之和，总半径由总体积决定。\n\n在您的推导和实现中使用的定义和常量：\n- 引力常数 $G = 6.67430\\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}$。\n- 玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$。\n- 质子质量 $m_{\\mathrm{p}} = 1.67262192369\\times 10^{-27}\\,\\mathrm{kg}$。\n- 铁密度 $\\rho_{\\mathrm{Fe}} = 8000\\,\\mathrm{kg\\,m^{-3}}$。\n- 硅酸盐岩石密度 $\\rho_{\\mathrm{rock}} = 3500\\,\\mathrm{kg\\,m^{-3}}$。\n- 地球质量 $M_{\\oplus} = 5.9722\\times 10^{24}\\,\\mathrm{kg}$。\n\n大气凌星半径偏移模型：\n- 对于平均分子质量为 $\\mu$、温度为 $T$ 的等温大气，将等温标高定义为 $H = k_{\\mathrm{B}} T / (\\mu g)$，其中 $g = G M / R^{2}$ 是质量为 $M$、半径为 $R$ 的行星的表面重力。\n- 将凌星半径偏移近似为 $\\Delta R_{\\mathrm{atm}} = N_{H} H$，其中 $N_{H}$ 是一个无量纲常数，表示有效凌星弦达到光学厚度的标高数量。使用每个测试用例提供的 $N_{H}$。\n\n内部成分和半径：\n- 设核质量分数 $\\mathrm{CMF} \\in [0,1]$，则铁核质量为 $M_{\\mathrm{core}} = \\mathrm{CMF}\\,M$，地幔质量为 $M_{\\mathrm{mantle}} = (1-\\mathrm{CMF})\\,M$。\n- 在不可压缩层的体积可加性假设下，总内部半径 $R_{\\mathrm{int}}$ 满足体积守恒，其中部分体积为 $V_{\\mathrm{core}} = M_{\\mathrm{core}}/\\rho_{\\mathrm{Fe}}$ 和 $V_{\\mathrm{mantle}} = M_{\\mathrm{mantle}}/\\rho_{\\mathrm{rock}}$。可观测凌星半径为 $R_{\\mathrm{obs}} = R_{\\mathrm{int}} + \\Delta R_{\\mathrm{atm}}$。\n\n待比较的推断策略：\n- 朴素推断（忽略大气）：使用双层体积可加性模型从 $M$ 和 $R_{\\mathrm{obs}}$ 推断 $\\mathrm{CMF}$。\n- 校正后推断（带凌星半径校正）：使用由 $R_{\\mathrm{obs}}$ 计算出的 $g$ 和等温标高，从 $M$、$R_{\\mathrm{obs}}$、$T$ 和 $\\mu$ 估算 $\\Delta R_{\\mathrm{atm}}$，然后将其减去以获得 $R_{\\mathrm{corr}} = R_{\\mathrm{obs}} - \\Delta R_{\\mathrm{atm,est}}$。使用相同的双层模型从 $M$ 和 $R_{\\mathrm{corr}}$ 推断 $\\mathrm{CMF}$。\n\n您必须：\n1. 从流体静力学平衡和理想气体定律推导出等温标高 $H$。\n2. 基于体积可加性模型，推导出连接 $M$、$R$、$\\rho_{\\mathrm{Fe}}$、$\\rho_{\\mathrm{rock}}$ 和 $\\mathrm{CMF}$ 的表达式，并将其反转以从 $M$ 和 $R$ 中推断出 $\\mathrm{CMF}$。\n3. 实现一个程序，为下面的每个测试用例计算：\n   - 从已知的 $M$ 和真实的 $\\mathrm{CMF}$ 计算出“真实”内部半径 $R_{\\mathrm{int}}$，\n   - 使用 $R_{\\mathrm{int}}$ 计算出真实的大气偏移量 $\\Delta R_{\\mathrm{atm,true}}$，\n   - 观测半径 $R_{\\mathrm{obs}}$，\n   - 忽略大气时的朴素推断核质量分数 $\\mathrm{CMF}_{\\mathrm{naive}}$，\n   - 使用由 $R_{\\mathrm{obs}}$ 计算出的 $g$ 进行凌星半径校正后的校正推断核质量分数 $\\mathrm{CMF}_{\\mathrm{corr}}$，\n   - 偏差 $b_{\\mathrm{naive}} = \\mathrm{CMF}_{\\mathrm{naive}} - \\mathrm{CMF}_{\\mathrm{true}}$ 和 $b_{\\mathrm{corr}} = \\mathrm{CMF}_{\\mathrm{corr}} - \\mathrm{CMF}_{\\mathrm{true}}$。\n4. 质量以 $\\mathrm{kg}$ 表示，半径以 $\\mathrm{m}$ 表示，温度以 $\\mathrm{K}$ 表示，平均分子质量以每个粒子的 $\\mathrm{kg}$ 表示。偏差是无量纲的，必须报告为四舍五入到六位小数的十进制数。\n\n测试套件：\n- 案例 1：$M = 1.0\\,M_{\\oplus}$，$\\mathrm{CMF}_{\\mathrm{true}} = 0.32$，$T = 800\\,\\mathrm{K}$，$\\mu = 2.3\\,m_{\\mathrm{p}}$，$N_{H} = 5$。\n- 案例 2：$M = 1.0\\,M_{\\oplus}$，$\\mathrm{CMF}_{\\mathrm{true}} = 0.32$，$T = 800\\,\\mathrm{K}$，$\\mu = 2.3\\,m_{\\mathrm{p}}$，$N_{H} = 0$。\n- 案例 3：$M = 0.5\\,M_{\\oplus}$，$\\mathrm{CMF}_{\\mathrm{true}} = 0.30$，$T = 1000\\,\\mathrm{K}$，$\\mu = 2.3\\,m_{\\mathrm{p}}$，$N_{H} = 5$。\n- 案例 4：$M = 5.0\\,M_{\\oplus}$，$\\mathrm{CMF}_{\\mathrm{true}} = 0.20$，$T = 1200\\,\\mathrm{K}$，$\\mu = 2.3\\,m_{\\mathrm{p}}$，$N_{H} = 5$。\n- 案例 5：$M = 1.5\\,M_{\\oplus}$，$\\mathrm{CMF}_{\\mathrm{true}} = 0.35$，$T = 300\\,\\mathrm{K}$，$\\mu = 28.0\\,m_{\\mathrm{p}}$，$N_{H} = 5$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，其本身是一个包含两个浮点数 $[b_{\\mathrm{naive}}, b_{\\mathrm{corr}}]$ 的列表，每个浮点数都四舍五入到六位小数。例如，对于两个假设的结果，它应该看起来像 $[[0.123456,-0.000321],[\\dots,\\dots]]$。",
            "solution": "该问题要求分析在确定系外行星的核质量分数（CMF）时，当上覆大气影响观测到的凌星半径时产生的系统性偏差。我们将首先从第一性原理推导必要的物理和数学关系，然后概述量化两种不同推断策略偏差的计算过程。\n\n### 1. 从第一性原理推导\n\n#### 等温标高（$H$）的推导\n大气的结构由流体静力学平衡方程决定，在平面平行近似下为：\n$$\n\\frac{dP}{dz} = -\\rho g\n$$\n其中 $P$ 是压力，$z$ 是高度，$\\rho$ 是质量密度，$g$ 是局部引力加速度，假定在大气范围内为常数。\n\n大气被建模为理想气体，其密度 $\\rho$ 与压力 $P$ 和温度 $T$ 的关系如下：\n$$\n\\rho = \\frac{\\mu P}{k_{\\mathrm{B}} T}\n$$\n这由理想气体定律 $P = n k_{\\mathrm{B}} T$ 和质量密度的定义 $\\rho = n\\mu$ 推导得出，其中 $n$ 是数密度，$\\mu$ 是每个粒子的平均分子质量，$k_{\\mathrm{B}}$ 是玻尔兹曼常数。\n\n将 $\\rho$ 的表达式代入流体静力学平衡方程，得到：\n$$\n\\frac{dP}{dz} = -\\left(\\frac{\\mu P}{k_{\\mathrm{B}} T}\\right) g\n$$\n这是一个关于 $P(z)$ 的一阶常微分方程。对于等温大气（$T$ 是常数），我们可以重新排列各项以分离变量 $P$ 和 $z$：\n$$\n\\frac{dP}{P} = -\\left(\\frac{\\mu g}{k_{\\mathrm{B}} T}\\right) dz\n$$\n项 $\\frac{k_{\\mathrm{B}} T}{\\mu g}$ 的单位是长度，表示压力发生显著变化的特征长度尺度。这被定义为等温标高，$H$：\n$$\nH \\equiv \\frac{k_{\\mathrm{B}} T}{\\mu g}\n$$\n因此，微分方程变为 $\\frac{dP}{P} = -\\frac{1}{H} dz$，积分后得到 $P(z) = P_0 e^{-z/H}$，证实了 $H$ 是压力分布的 e-折叠长度。问题将大气引起的凌星半径偏移建模为 $\\Delta R_{\\mathrm{atm}} = N_{H} H$。\n\n#### 从质量（$M$）和半径（$R$）推导核质量分数（$\\mathrm{CMF}$）\n我们将行星内部建模为两个不可压缩的层：一个铁核和一个硅酸盐地幔。总质量 $M$ 是核质量 $M_{\\mathrm{core}}$ 和地幔质量 $M_{\\mathrm{mantle}}$ 的总和。核质量分数 $\\mathrm{CMF}$ 定义为 $\\mathrm{CMF} = M_{\\mathrm{core}} / M$。\n$$\nM_{\\mathrm{core}} = \\mathrm{CMF} \\cdot M\n$$\n$$\nM_{\\mathrm{mantle}} = (1 - \\mathrm{CMF}) \\cdot M\n$$\n在不可压缩性假设下，每层的体积是其质量除以其恒定密度（核为 $\\rho_{\\mathrm{Fe}}$，地幔为 $\\rho_{\\mathrm{rock}}$）。\n$$\nV_{\\mathrm{core}} = \\frac{M_{\\mathrm{core}}}{\\rho_{\\mathrm{Fe}}} = \\frac{\\mathrm{CMF} \\cdot M}{\\rho_{\\mathrm{Fe}}}\n$$\n$$\nV_{\\mathrm{mantle}} = \\frac{M_{\\mathrm{mantle}}}{\\rho_{\\mathrm{rock}}} = \\frac{(1 - \\mathrm{CMF}) \\cdot M}{\\rho_{\\mathrm{rock}}}\n$$\n总内部体积 $V_{\\mathrm{int}}$ 是各层体积之和，与总内部半径 $R_{\\mathrm{int}}$ 相关：\n$$\nV_{\\mathrm{int}} = \\frac{4}{3}\\pi R_{\\mathrm{int}}^3 = V_{\\mathrm{core}} + V_{\\mathrm{mantle}}\n$$\n代入各层体积的表达式：\n$$\n\\frac{4}{3}\\pi R_{\\mathrm{int}}^3 = \\frac{\\mathrm{CMF} \\cdot M}{\\rho_{\\mathrm{Fe}}} + \\frac{(1 - \\mathrm{CMF}) \\cdot M}{\\rho_{\\mathrm{rock}}}\n$$\n为了推导 $\\mathrm{CMF}$ 作为 $M$ 和 $R_{\\mathrm{int}}$ 的函数表达式，我们可以首先用行星的平均密度 $\\bar{\\rho} = M / V_{\\mathrm{int}} = M / (\\frac{4}{3}\\pi R_{\\mathrm{int}}^3)$ 来表示这个关系。将方程两边除以 $M$：\n$$\n\\frac{V_{\\mathrm{int}}}{M} = \\frac{1}{\\bar{\\rho}} = \\frac{\\mathrm{CMF}}{\\rho_{\\mathrm{Fe}}} + \\frac{1 - \\mathrm{CMF}}{\\rho_{\\mathrm{rock}}}\n$$\n我们现在求解 $\\mathrm{CMF}$：\n$$\n\\frac{1}{\\bar{\\rho}} = \\mathrm{CMF} \\left(\\frac{1}{\\rho_{\\mathrm{Fe}}} - \\frac{1}{\\rho_{\\mathrm{rock}}}\\right) + \\frac{1}{\\rho_{\\mathrm{rock}}}\n$$\n$$\n\\frac{1}{\\bar{\\rho}} - \\frac{1}{\\rho_{\\mathrm{rock}}} = \\mathrm{CMF} \\left(\\frac{1}{\\rho_{\\mathrm{Fe}}} - \\frac{1}{\\rho_{\\mathrm{rock}}}\\right)\n$$\n$$\n\\mathrm{CMF} = \\frac{\\frac{1}{\\bar{\\rho}} - \\frac{1}{\\rho_{\\mathrm{rock}}}}{\\frac{1}{\\rho_{\\mathrm{Fe}}} - \\frac{1}{\\rho_{\\mathrm{rock}}}}\n$$\n这个表达式允许从给定的总质量 $M$ 和内部半径 $R_{\\mathrm{int}}$ 推断出核质量分数，方法是首先计算平均密度 $\\bar{\\rho}$。\n\n### 2. 偏差分析的计算流程\n\n对于每个测试用例，我们执行一个三阶段的计算。\n\n**阶段1：正演模型（模拟“真实”行星及其观测）**\n给定真实质量 $M$、真实核质量分数 $\\mathrm{CMF}_{\\mathrm{true}}$、大气温度 $T$、平均分子量 $\\mu$ 和标高倍数 $N_H$：\n1.  计算核和地幔的质量：$M_{\\mathrm{core}} = \\mathrm{CMF}_{\\mathrm{true}} \\cdot M$ 和 $M_{\\mathrm{mantle}} = (1 - \\mathrm{CMF}_{\\mathrm{true}}) \\cdot M$。\n2.  计算核和地幔的体积：$V_{\\mathrm{core}} = M_{\\mathrm{core}}/\\rho_{\\mathrm{Fe}}$ 和 $V_{\\mathrm{mantle}} = M_{\\mathrm{mantle}}/\\rho_{\\mathrm{rock}}$。\n3.  计算真实的总内部体积 $V_{\\mathrm{int}} = V_{\\mathrm{core}} + V_{\\mathrm{mantle}}$ 和真实的内部半径 $R_{\\mathrm{int}} = (\\frac{3V_{\\mathrm{int}}}{4\\pi})^{1/3}$。\n4.  使用真实的内部半径计算真实的表面重力：$g_{\\mathrm{true}} = GM/R_{\\mathrm{int}}^2$。\n5.  计算真实的大气标高：$H_{\\mathrm{true}} = k_{\\mathrm{B}}T / (\\mu g_{\\mathrm{true}})$。\n6.  计算真实的大气半径偏移：$\\Delta R_{\\mathrm{atm,true}} = N_H H_{\\mathrm{true}}$。\n7.  计算“观测到的”凌星半径：$R_{\\mathrm{obs}} = R_{\\mathrm{int}} + \\Delta R_{\\mathrm{atm,true}}$。\n\n**阶段2：朴素推断与偏差计算**\n该策略错误地假设观测半径即为内部半径，即 $R_{\\mathrm{int, naive}} = R_{\\mathrm{obs}}$。\n1.  计算朴素平均密度 $\\bar{\\rho}_{\\mathrm{naive}} = M / (\\frac{4}{3}\\pi R_{\\mathrm{obs}}^3)$。\n2.  使用推导出的反演公式，求出朴素推断的核质量分数 $\\mathrm{CMF}_{\\mathrm{naive}}$：\n    $$\n    \\mathrm{CMF}_{\\mathrm{naive}} = \\frac{1/\\bar{\\rho}_{\\mathrm{naive}} - 1/\\rho_{\\mathrm{rock}}}{1/\\rho_{\\mathrm{Fe}} - 1/\\rho_{\\mathrm{rock}}}\n    $$\n3.  计算朴素偏差：$b_{\\mathrm{naive}} = \\mathrm{CMF}_{\\mathrm{naive}} - \\mathrm{CMF}_{\\mathrm{true}}$。\n\n**阶段3：校正后推断与偏差计算**\n该策略试图通过估计大气层的大小并将其从观测半径中减去来校正大气层的影响。\n1.  使用观测半径估算表面重力：$g_{\\mathrm{est}} = GM/R_{\\mathrm{obs}}^2$。\n2.  基于此重力估算标高：$H_{\\mathrm{est}} = k_{\\mathrm{B}}T / (\\mu g_{\\mathrm{est}})$。\n3.  估算大气偏移量：$\\Delta R_{\\mathrm{atm,est}} = N_H H_{\\mathrm{est}}$。\n4.  计算校正后的内部半径：$R_{\\mathrm{corr}} = R_{\\mathrm{obs}} - \\Delta R_{\\mathrm{atm,est}}$。\n5.  计算校正后的平均密度 $\\bar{\\rho}_{\\mathrm{corr}} = M / (\\frac{4}{3}\\pi R_{\\mathrm{corr}}^3)$。\n6.  使用反演公式，求出校正后的核质量分数 $\\mathrm{CMF}_{\\mathrm{corr}}$：\n    $$\n    \\mathrm{CMF}_{\\mathrm{corr}} = \\frac{1/\\bar{\\rho}_{\\mathrm{corr}} - 1/\\rho_{\\mathrm{rock}}}{1/\\rho_{\\mathrm{Fe}} - 1/\\rho_{\\mathrm{rock}}}\n    $$\n7.  计算校正后的偏差：$b_{\\mathrm{corr}} = \\mathrm{CMF}_{\\mathrm{corr}} - \\mathrm{CMF}_{\\mathrm{true}}$。\n\n对每个测试用例实施此完整流程，以确定两种偏差，这些偏差量化了大气引入的误差以及简单校正方案的有效性。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the bias in inferred exoplanet core mass fraction due to\n    atmospheric effects, for both a naive and a corrected retrieval strategy.\n    \"\"\"\n\n    # --- Define Constants (SI units) ---\n    G = 6.67430e-11  # m^3 kg^-1 s^-2\n    k_B = 1.380649e-23  # J K^-1\n    m_p = 1.67262192369e-27  # kg\n    M_earth = 5.9722e24  # kg\n    rho_Fe = 8000.0  # kg m^-3\n    rho_rock = 3500.0  # kg m^-3\n\n    # --- Test Suite ---\n    test_cases = [\n        # (M in M_earth, CMF_true, T in K, mu in m_p, N_H)\n        (1.0, 0.32, 800.0, 2.3, 5.0),\n        (1.0, 0.32, 800.0, 2.3, 0.0),\n        (0.5, 0.30, 1000.0, 2.3, 5.0),\n        (5.0, 0.20, 1200.0, 2.3, 5.0),\n        (1.5, 0.35, 300.0, 28.0, 5.0),\n    ]\n\n    # --- Helper function to retrieve CMF from M and R ---\n    def get_cmf(M, R, rho_r, rho_f):\n        \"\"\"Calculates CMF from total mass M and interior radius R.\"\"\"\n        if R = 0:\n            return np.nan # Unphysical radius\n        \n        V_int = (4.0 / 3.0) * np.pi * R**3\n        rho_avg = M / V_int\n        \n        # Inversion formula: CMF = (1/rho_avg - 1/rho_r) / (1/rho_f - 1/rho_r)\n        term_avg = 1.0 / rho_avg\n        term_rock = 1.0 / rho_r\n        term_iron = 1.0 / rho_f\n        \n        cmf = (term_avg - term_rock) / (term_iron - term_rock)\n        return cmf\n\n    results = []\n    \n    for case in test_cases:\n        M_me, CMF_true, T, mu_mp, N_H = case\n        \n        # --- Convert inputs to SI units ---\n        M_kg = M_me * M_earth\n        mu_kg = mu_mp * m_p\n\n        # --- Stage 1: Forward Model (Simulating \"Truth\") ---\n        # Calculate true interior radius R_int\n        M_core_true = CMF_true * M_kg\n        M_mantle_true = (1.0 - CMF_true) * M_kg\n        V_core_true = M_core_true / rho_Fe\n        V_mantle_true = M_mantle_true / rho_rock\n        V_int_true = V_core_true + V_mantle_true\n        R_int_true = (3.0 * V_int_true / (4.0 * np.pi))**(1.0/3.0)\n\n        # Calculate true atmospheric offset and observed radius R_obs\n        g_true = G * M_kg / R_int_true**2\n        H_true = (k_B * T) / (mu_kg * g_true)\n        delta_R_atm_true = N_H * H_true\n        R_obs = R_int_true + delta_R_atm_true\n\n        # --- Stage 2: Naive Retrieval ---\n        # Assume R_int = R_obs\n        CMF_naive = get_cmf(M_kg, R_obs, rho_rock, rho_Fe)\n        b_naive = CMF_naive - CMF_true\n\n        # --- Stage 3: Corrected Retrieval ---\n        # Estimate atmospheric offset using R_obs to calculate gravity\n        g_est = G * M_kg / R_obs**2\n        H_est = (k_B * T) / (mu_kg * g_est)\n        delta_R_atm_est = N_H * H_est\n        R_corr = R_obs - delta_R_atm_est\n        \n        CMF_corr = get_cmf(M_kg, R_corr, rho_rock, rho_Fe)\n        b_corr = CMF_corr - CMF_true\n        \n        results.append([b_naive, b_corr])\n\n    # --- Final Output Formatting ---\n    formatted_results = []\n    for bn, bc in results:\n        formatted_results.append(f'[{bn:.6f},{bc:.6f}]')\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}