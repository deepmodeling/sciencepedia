{
    "hands_on_practices": [
        {
            "introduction": "Isostasy is the fundamental principle of gravitational balance that governs the large-scale structure of planetary lithospheres. This exercise applies the Pratt model of isostasy, which posits that lateral variations in surface elevation are compensated by variations in crustal density. By deriving the consequences of a compositional change in the lower crust, you will gain a quantitative understanding of how planets maintain hydrostatic equilibrium, a crucial skill for interpreting gravity and topography data from any terrestrial world. ",
            "id": "4165580",
            "problem": "Consider two laterally adjacent provinces on a terrestrial exoplanet with a two-layer crust over a homogeneous mantle. Let the vertical coordinate be $z$, measured downward from the planetary surface at $z=0$. The base of compensation is at a fixed depth $z=z_c$ and is common to both provinces. Province $\\mathrm{A}$ has an upper crust of thickness $t_u$ with uniform density $\\rho_u$, a lower crust of thickness $t_l$ with uniform density $\\rho_l$, and a mantle of density $\\rho_m$ below the Mohorovičić discontinuity (the crust-mantle boundary) at $z=T$, where $T=t_u+t_l$. Province $\\mathrm{B}$ has the same upper crust thickness $t_u$ and upper crust density $\\rho_u$, but its lower crust has experienced compositional modification, so its density is $\\rho_l+\\Delta \\rho$, with $\\Delta \\rho$ spatially uniform in province $\\mathrm{B}$ and confined entirely to the lower crustal layer. The mantle density remains $\\rho_m$ and is uniform in both provinces. Gravitational acceleration $g$ is uniform, and density variations with pressure and temperature are neglected.\n\nUnder Pratt isostasy, columns are in lateral hydrostatic balance, meaning that the lithostatic pressure at the compensation depth $z_c$ is equal between provinces when the surface elevations are equal. Suppose erosional and depositional processes have adjusted the surface elevations to be equal between the provinces, and assume that the upper crustal thickness $t_u$ does not change between provinces. To restore lateral hydrostatic equilibrium at $z_c$ in the presence of the lower crustal compositional density change $\\Delta \\rho$ in province $\\mathrm{B}$, the system adjusts by changing the thickness of the lower crust by an amount $\\delta t_l$ in province $\\mathrm{B}$, which shifts the depth of the Mohorovičić discontinuity by $\\delta T$. Assume $\\delta T=\\delta t_l$ because the upper crust thickness is fixed.\n\nStarting from the definition of lithostatic pressure $p(z)=\\int_{0}^{z} \\rho(z')\\,g\\,\\mathrm{d}z'$ and the requirement of equal lithostatic pressure at $z=z_c$ between provinces, derive a closed-form analytic expression for the compensating lower crust thickness change $\\delta t_l$ and the corresponding Mohorovičić discontinuity depth change $\\delta T$ in province $\\mathrm{B}$, expressed in terms of $t_l$, $\\rho_u$, $\\rho_l$, $\\rho_m$, and $\\Delta \\rho$. Provide your final answer as analytic expressions. No numerical evaluation or rounding is required, and no units need be reported in the final expressions.",
            "solution": "The problem requires the derivation of an expression for the change in lower crustal thickness, $\\delta t_l$, and the corresponding change in the depth of the Mohorovičić discontinuity, $\\delta T$, required to maintain isostatic equilibrium between two adjacent provinces, A and B. The fundamental principle of isostasy, as stated in the problem, is that the lithostatic pressure at a specified compensation depth, $z_c$, must be equal for both provinces. The surface elevations of the two provinces are given as equal, and the coordinate $z$ is measured downwards from this common surface ($z=0$). The gravitational acceleration, $g$, is assumed to be uniform.\n\nThe lithostatic pressure, $p$, at a depth $z$ is defined by the integral of the weight of the overlying material column:\n$$p(z) = \\int_{0}^{z} \\rho(z')\\,g\\,\\mathrm{d}z'$$\nThe condition for isostatic balance between province A and province B is therefore:\n$$p_A(z_c) = p_B(z_c)$$\n$$\\int_{0}^{z_c} \\rho_A(z')\\,g\\,\\mathrm{d}z' = \\int_{0}^{z_c} \\rho_B(z')\\,g\\,\\mathrm{d}z'$$\nSince $g$ is constant, it can be factored out and cancelled from both sides, leaving the condition that the total mass per unit area in the columns above the compensation depth must be equal.\n\nFirst, let us define the density profile, $\\rho_A(z)$, for the reference province A. The crust consists of two layers: an upper crust of thickness $t_u$ and density $\\rho_u$, and a lower crust of thickness $t_l$ and density $\\rho_l$. The Mohorovičić discontinuity (Moho) is at depth $T = t_u + t_l$. Below the Moho lies the mantle with density $\\rho_m$. The density profile is a piecewise function:\n$$\n\\rho_A(z) =\n\\begin{cases}\n\\rho_u & \\text{for } 0 \\le z < t_u \\\\\n\\rho_l & \\text{for } t_u \\le z < t_u + t_l \\\\\n\\rho_m & \\text{for } z \\ge t_u + t_l\n\\end{cases}\n$$\nThe pressure at the compensation depth $z_c$ (which must be within the mantle, i.e., $z_c > T$) is:\n$$p_A(z_c) = g \\left[ \\int_{0}^{t_u} \\rho_u\\,\\mathrm{d}z' + \\int_{t_u}^{t_u+t_l} \\rho_l\\,\\mathrm{d}z' + \\int_{t_u+t_l}^{z_c} \\rho_m\\,\\mathrm{d}z' \\right]$$\n$$p_A(z_c) = g \\left[ \\rho_u t_u + \\rho_l t_l + \\rho_m (z_c - (t_u+t_l)) \\right]$$\n\nNext, we define the density profile, $\\rho_B(z)$, for province B. It has the same upper crust thickness $t_u$ and density $\\rho_u$. Its lower crust has a modified density $\\rho_l + \\Delta\\rho$ and a modified thickness $t_l + \\delta t_l$. The Moho is therefore at a new depth $T_B = t_u + t_l + \\delta t_l$. The mantle density remains $\\rho_m$.\n$$\n\\rho_B(z) =\n\\begin{cases}\n\\rho_u & \\text{for } 0 \\le z < t_u \\\\\n\\rho_l + \\Delta\\rho & \\text{for } t_u \\le z < t_u + t_l + \\delta t_l \\\\\n\\rho_m & \\text{for } z \\ge t_u + t_l + \\delta t_l\n\\end{cases}\n$$\nThe pressure at the compensation depth $z_c$ in province B is:\n$$p_B(z_c) = g \\left[ \\int_{0}^{t_u} \\rho_u\\,\\mathrm{d}z' + \\int_{t_u}^{t_u+t_l+\\delta t_l} (\\rho_l + \\Delta\\rho)\\,\\mathrm{d}z' + \\int_{t_u+t_l+\\delta t_l}^{z_c} \\rho_m\\,\\mathrm{d}z' \\right]$$\n$$p_B(z_c) = g \\left[ \\rho_u t_u + (\\rho_l + \\Delta\\rho)(t_l+\\delta t_l) + \\rho_m (z_c - (t_u+t_l+\\delta t_l)) \\right]$$\n\nNow, we apply the isostatic equilibrium condition, $p_A(z_c) = p_B(z_c)$. The factor $g$ cancels.\n$$ \\rho_u t_u + \\rho_l t_l + \\rho_m (z_c - t_u - t_l) = \\rho_u t_u + (\\rho_l + \\Delta\\rho)(t_l+\\delta t_l) + \\rho_m (z_c - t_u - t_l - \\delta t_l) $$\nWe can simplify this equation by cancelling common terms. The terms $\\rho_u t_u$ and $\\rho_m (z_c - t_u - t_l)$ appear on both sides and can be eliminated (after expanding the right-hand side's mantle term into $\\rho_m(z_c - t_u - t_l) - \\rho_m\\delta t_l$).\n$$ \\rho_l t_l = (\\rho_l + \\Delta\\rho)(t_l+\\delta t_l) - \\rho_m \\delta t_l $$\nExpand the product on the right side:\n$$ \\rho_l t_l = \\rho_l t_l + \\rho_l \\delta t_l + \\Delta\\rho \\, t_l + \\Delta\\rho \\, \\delta t_l - \\rho_m \\delta t_l $$\nThe term $\\rho_l t_l$ cancels from both sides:\n$$ 0 = \\rho_l \\delta t_l + \\Delta\\rho \\, t_l + \\Delta\\rho \\, \\delta t_l - \\rho_m \\delta t_l $$\nNow, we must solve for $\\delta t_l$. We gather all terms containing $\\delta t_l$ on one side and the remaining terms on the other.\n$$ -\\Delta\\rho \\, t_l = \\rho_l \\delta t_l + \\Delta\\rho \\, \\delta t_l - \\rho_m \\delta t_l $$\nFactor out $\\delta t_l$:\n$$ -\\Delta\\rho \\, t_l = (\\rho_l + \\Delta\\rho - \\rho_m) \\delta t_l $$\nIsolating $\\delta t_l$ yields the desired expression:\n$$ \\delta t_l = \\frac{-\\Delta\\rho \\, t_l}{\\rho_l + \\Delta\\rho - \\rho_m} $$\nThis expression can be written in a more conventional form by multiplying the numerator and the denominator by $-1$:\n$$ \\delta t_l = \\frac{\\Delta\\rho \\, t_l}{\\rho_m - \\rho_l - \\Delta\\rho} $$\nThe problem states that the change in the Moho depth, $\\delta T$, is equal to the change in the lower crustal thickness, $\\delta t_l$, because the upper crustal thickness $t_u$ is fixed.\n$$ \\delta T = \\delta t_l $$\nTherefore, the expression for the change in Moho depth is identical.\n$$ \\delta T = \\frac{\\Delta\\rho \\, t_l}{\\rho_m - \\rho_l - \\Delta\\rho} $$\nThese are the closed-form analytic expressions for the compensating thickness changes. It is worth noting that for the system to be gravitationally stable, the density of the mantle $\\rho_m$ must be greater than the density of the modified lower crust, $\\rho_l + \\Delta\\rho$. This ensures the denominator is positive, and thus the sign of the crustal thickness change $\\delta t_l$ is the same as the sign of the density perturbation $\\Delta\\rho$. A densification of the lower crust ($\\Delta\\rho > 0$) is compensated by a thickening of the crustal root ($\\delta t_l > 0$), and vice-versa.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\Delta\\rho \\, t_l}{\\rho_m - \\rho_l - \\Delta\\rho} & \\frac{\\Delta\\rho \\, t_l}{\\rho_m - \\rho_l - \\Delta\\rho}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While isostasy describes a planet's static state, its long-term thermal evolution is dominated by mantle convection. This practice utilizes scaling analysis, a powerful tool in geodynamics, to relate the convective overturn time to fundamental physical parameters through the dimensionless Rayleigh number, $Ra$. Deriving and applying this scaling law for a hypothetical super-Earth will solidify your understanding of the forces driving mantle flow and how planetary properties control the efficiency of interior heat transport. ",
            "id": "4165547",
            "problem": "A rocky super-Earth is modeled as having an isoviscous, incompressible mantle obeying the Boussinesq approximation at effectively infinite Prandtl number, convecting beneath a mobile lid. Consider a plane-parallel convecting mantle layer of thickness $D$ with constant thermal diffusivity $\\kappa$, thermal expansivity $\\alpha$, density $\\rho$, dynamic viscosity $\\eta$, gravitational acceleration $g$, and superadiabatic temperature contrast across the layer $\\Delta T$. In such convection, the characteristic convective velocity non-dimensionalized by $\\kappa/D$ follows a power-law in the Rayleigh number with exponent $\\gamma$ appropriate to the mobile-lid, isoviscous regime.\n\nStarting from fundamental balances of buoyancy, viscous resistance, and heat diffusion that underlie thermal convection scalings, derive an analytic expression for the convective overturn time $t$ in terms of $D$, $\\kappa$, $\\rho$, $g$, $\\alpha$, $\\Delta T$, $\\eta$, and $\\gamma$. Then evaluate $t$ numerically for a super-Earth mantle with the following properties:\n- $D = 4.33 \\times 10^{6}\\ \\mathrm{m}$,\n- $\\kappa = 1.00 \\times 10^{-6}\\ \\mathrm{m^2\\ s^{-1}}$,\n- $\\alpha = 2.00 \\times 10^{-5}\\ \\mathrm{K^{-1}}$,\n- $\\Delta T = 2.50 \\times 10^{3}\\ \\mathrm{K}$,\n- $\\rho = 4.50 \\times 10^{3}\\ \\mathrm{kg\\ m^{-3}}$,\n- $\\eta = 1.00 \\times 10^{22}\\ \\mathrm{Pa\\ s}$,\n- $g = 2.20 \\times 10^{1}\\ \\mathrm{m\\ s^{-2}}$,\nand adopt the canonical mobile-lid, isoviscous exponent $\\gamma = 2/3$. Neglect any order-unity prefactors in the scaling.\n\nExpress the final time in mega-years (Myr). Round your answer to three significant figures. The final answer must be a single number.",
            "solution": "The objective is to first derive an analytical expression for the convective overturn time, $t$, and then to calculate its numerical value for a given set of planetary parameters. The analysis will rely on scaling arguments, neglecting order-unity prefactors as instructed.\n\nThe convective overturn time, $t$, is the characteristic time it takes for a fluid parcel to traverse the convecting layer. For a layer of thickness $D$, this time is determined by the characteristic convective velocity, $u$. The scaling relationship is:\n$$\nt \\sim \\frac{D}{u}\n$$\nThe problem states that the characteristic convective velocity, when non-dimensionalized, follows a power-law relationship with the Rayleigh number, $Ra$. The non-dimensional velocity, $u'$, is defined by scaling the dimensional velocity $u$ with the thermal diffusion velocity, $\\kappa/D$:\n$$\nu' = \\frac{u}{\\kappa/D}\n$$\nThe scaling law for $u'$ in the mobile-lid, isoviscous regime is given as:\n$$\nu' \\sim Ra^{\\gamma}\n$$\nwhere $\\gamma$ is the power-law exponent. Combining these two expressions allows us to find the dimensional velocity $u$:\n$$\nu = u' \\frac{\\kappa}{D} \\sim \\left( Ra^{\\gamma} \\right) \\frac{\\kappa}{D}\n$$\nThe Rayleigh number, $Ra$, is a dimensionless parameter that characterizes the ratio of thermally-driven buoyancy forces to viscous and diffusive dissipative forces. For the system described, it is defined as:\n$$\nRa = \\frac{\\alpha g \\rho \\Delta T D^3}{\\eta \\kappa}\n$$\nwhere $\\alpha$ is the thermal expansivity, $g$ is the gravitational acceleration, $\\rho$ is the density, $\\Delta T$ is the superadiabatic temperature contrast, $D$ is the layer thickness, $\\eta$ is the dynamic viscosity, and $\\kappa$ is the thermal diffusivity.\n\nWe can now substitute the expression for $u$ into the definition of the overturn time $t$:\n$$\nt \\sim \\frac{D}{u} \\sim \\frac{D}{(\\kappa/D) Ra^{\\gamma}} = \\frac{D^2}{\\kappa} Ra^{-\\gamma}\n$$\nThe term $D^2/\\kappa$ represents the characteristic time for heat to diffuse across the layer. The overturn time is thus the diffusion time modulated by the vigor of convection, as represented by $Ra^{-\\gamma}$. Substituting the full expression for the Rayleigh number yields the final analytical expression for the overturn time $t$ in terms of the fundamental physical parameters:\n$$\nt \\sim \\frac{D^2}{\\kappa} \\left( \\frac{\\alpha g \\rho \\Delta T D^3}{\\eta \\kappa} \\right)^{-\\gamma}\n$$\nThis is the required analytical expression.\n\nNext, we evaluate this expression numerically using the provided data for the super-Earth:\n-   $D = 4.33 \\times 10^{6}\\ \\mathrm{m}$\n-   $\\kappa = 1.00 \\times 10^{-6}\\ \\mathrm{m^2\\ s^{-1}}$\n-   $\\alpha = 2.00 \\times 10^{-5}\\ \\mathrm{K^{-1}}$\n-   $\\Delta T = 2.50 \\times 10^{3}\\ \\mathrm{K}$\n-   $\\rho = 4.50 \\times 10^{3}\\ \\mathrm{kg\\ m^{-3}}$\n-   $\\eta = 1.00 \\times 10^{22}\\ \\mathrm{Pa\\ s}$\n-   $g = 2.20 \\times 10^{1}\\ \\mathrm{m\\ s^{-2}}$\n-   $\\gamma = 2/3$\n\nFirst, we calculate the Rayleigh number, $Ra$:\n$$\nRa = \\frac{(2.00 \\times 10^{-5}) (2.20 \\times 10^{1}) (4.50 \\times 10^{3}) (2.50 \\times 10^{3}) (4.33 \\times 10^{6})^3}{(1.00 \\times 10^{22}) (1.00 \\times 10^{-6})}\n$$\nThe numerator can be calculated as:\n$$\n\\text{Numerator} = (2.00 \\times 2.20 \\times 4.50 \\times 2.50) \\times (4.33)^3 \\times 10^{-5+1+3+3+(6 \\times 3)}\n$$\n$$\n\\text{Numerator} = (49.5) \\times (81.221237) \\times 10^{20} \\approx 4.02045 \\times 10^{23}\n$$\nThe denominator is:\n$$\n\\text{Denominator} = (1.00 \\times 10^{22}) \\times (1.00 \\times 10^{-6}) = 1.00 \\times 10^{16}\n$$\nThus, the Rayleigh number is:\n$$\nRa = \\frac{4.02045 \\times 10^{23}}{1.00 \\times 10^{16}} \\approx 4.02045 \\times 10^7\n$$\nNow, we calculate the overturn time $t$ using the derived scaling relationship $t \\sim (D^2/\\kappa) Ra^{-\\gamma}$:\n$$\nt \\approx \\frac{(4.33 \\times 10^{6})^2}{1.00 \\times 10^{-6}} (4.02045 \\times 10^7)^{-2/3}\n$$\nFirst, calculate the thermal diffusion time, $t_{diff} = D^2/\\kappa$:\n$$\nt_{diff} = \\frac{1.87489 \\times 10^{13}\\ \\mathrm{m}^2}{1.00 \\times 10^{-6}\\ \\mathrm{m}^2 \\mathrm{s}^{-1}} = 1.87489 \\times 10^{19}\\ \\mathrm{s}\n$$\nNext, calculate the term $Ra^{-2/3}$:\n$$\nRa^{-2/3} = (4.02045 \\times 10^7)^{-2/3} = ((4.02045 \\times 10^7)^{1/3})^{-2}\n$$\n$$\n(4.02045 \\times 10^7)^{1/3} = (40.2045 \\times 10^6)^{1/3} = (40.2045)^{1/3} \\times 10^2 \\approx 3.4259 \\times 10^2\n$$\n$$\nRa^{-2/3} \\approx (3.4259 \\times 10^2)^{-2} \\approx \\frac{1}{11.7368 \\times 10^4} \\approx \\frac{1}{1.17368 \\times 10^5} \\approx 8.5201 \\times 10^{-6}\n$$\nNow, we compute the overturn time $t$ in seconds:\n$$\nt \\approx (1.87489 \\times 10^{19}\\ \\mathrm{s}) \\times (8.5201 \\times 10^{-6}) \\approx 1.5974 \\times 10^{14}\\ \\mathrm{s}\n$$\nFinally, we convert the time from seconds to mega-years (Myr). There are approximately $3.15576 \\times 10^7$ seconds in a year, and $10^6$ years in a mega-year.\n$$\n1\\ \\mathrm{Myr} = 10^6\\ \\mathrm{years} \\times 3.15576 \\times 10^7\\ \\mathrm{s/year} \\approx 3.15576 \\times 10^{13}\\ \\mathrm{s}\n$$\n$$\nt\\ (\\mathrm{Myr}) = \\frac{1.5974 \\times 10^{14}\\ \\mathrm{s}}{3.15576 \\times 10^{13}\\ \\mathrm{s/Myr}} \\approx 5.0618\\ \\mathrm{Myr}\n$$\nRounding the result to three significant figures gives $5.06$ Myr.",
            "answer": "$$\\boxed{5.06}$$"
        },
        {
            "introduction": "Our most detailed knowledge of Earth's interior—and by extension, our models for other planets—comes from seismology. This exercise bridges the gap between theoretical models and geophysical data by tackling a simplified but realistic inverse problem. You will use damped least-squares to invert synthetic normal mode attenuation data for a planet's radial quality factor ($Q$) structure, which serves as a proxy for its physical state, and test how this structure correlates with physical models of mantle temperature and grain size. ",
            "id": "4165558",
            "problem": "You are given an idealized linear inverse problem for a spherically symmetric terrestrial planet’s mantle that uses normal mode splitting information to infer radial attenuation, expressed through the quality factor $Q$ of three concentric mantle layers. The three layers are lithosphere, upper mantle, and lower mantle. The forward model assumes that each observed mode’s inverse quality factor $q_i$ is a weighted average of the layers’ inverse quality factors $m_j = 1/Q_j$, with known sensitivity weights. Specifically, the forward relation is\n$$\nq_i = \\sum_{j=1}^{3} w_{ij} \\, m_j,\n$$\nwhere $i \\in \\{1,\\dots,5\\}$ indexes the five observed normal modes and $j \\in \\{1,2,3\\}$ indexes the layers. The weights $w_{ij}$ encode the radial sensitivity of mode $i$ to layer $j$ and satisfy $\\sum_{j} w_{ij} = 1$ for each $i$. The objective is to estimate the layer-wise quality factors $Q_j$ from the observed $q_i$ by solving a damped least-squares inverse problem, and then to quantitatively examine how attenuation correlates with mantle temperature and grain size using a physically motivated scaling.\n\nFundamental base:\n- Define the quality factor $Q$ for a viscoelastic material: $Q$ is dimensionless and quantifies the ratio of stored to dissipated energy per cycle; higher $Q$ means lower attenuation. For normal modes, small perturbations in structure and attenuation lead to measurable mode frequency splittings and linewidths that can be linearly related to internal $Q$ structure through sensitivity kernels. In this simplified setting, each mode’s inverse quality factor $q_i$ is a linear functional of the radial inverse $Q$ structure, discretized into three layers as above.\n- Use least-squares theory to solve the linear inverse problem. With a damping parameter $\\lambda > 0$, solve for $m = (m_1,m_2,m_3)^\\top$ via the normal equations\n$$\n\\left( G^\\top G + \\lambda^2 I \\right) m = G^\\top d,\n$$\nwhere $G$ is the $5 \\times 3$ matrix of weights $w_{ij}$, $d$ is the $5 \\times 1$ vector with components $q_i$, and $I$ is the identity matrix. Then set $Q_j = 1/m_j$.\n- Model the dependence of attenuation on temperature $T$ and grain size $d$ with a broad-band, power-law background consistent with an Andrade-type anelasticity: for a reference angular frequency $\\omega_0$, define the predicted inverse quality factor for layer $j$ as\n$$\nm^{\\mathrm{pred}}_j = A \\left( \\frac{\\omega_{\\mathrm{ref}}}{\\omega_0} \\right)^{\\alpha} \\left( \\frac{T_j}{T_0} \\right)^{\\beta} \\left( \\frac{d_j}{d_0} \\right)^{-p},\n$$\nwhere $A$, $\\alpha$, $\\beta$, and $p$ are positive constants, $T_0$ and $d_0$ are reference values, and $\\omega_{\\mathrm{ref}}$ is a representative angular frequency for the set of modes. This captures that inverse $Q$ increases with temperature and decreases with grain size in the mantle.\n\nComputational tasks:\n1. For each test case, solve the damped least-squares inverse problem to obtain $m_j$ and $Q_j = 1/m_j$.\n2. For each test case, compute $m^{\\mathrm{pred}}_j$ using the scaling above and then compute the Pearson correlation coefficient\n$$\nr = \\frac{\\mathrm{cov}(m, m^{\\mathrm{pred}})}{\\sigma_m \\, \\sigma_{m^{\\mathrm{pred}}}},\n$$\nwhere $\\mathrm{cov}$ denotes covariance and $\\sigma$ denotes the standard deviation. If $\\sigma_m = 0$ or $\\sigma_{m^{\\mathrm{pred}}} = 0$, set $r = 0$.\n3. For each test case, compute the root-mean-square misfit\n$$\n\\mathrm{RMS} = \\sqrt{ \\frac{1}{5} \\sum_{i=1}^{5} \\left( q_i - \\sum_{j=1}^{3} w_{ij} m_j \\right)^2 }.\n$$\n\nUnits and constants:\n- Quality factor $Q$ is dimensionless.\n- Temperature $T$ is in $\\mathrm{K}$.\n- Grain size $d$ is in $\\mathrm{m}$.\n- Frequencies are in $\\mathrm{Hz}$ (use angular frequency only in the ratio form; here we set $\\omega_{\\mathrm{ref}} / \\omega_0 = 1$ by choosing $\\omega_{\\mathrm{ref}} = \\omega_0$).\n- Use $A = 0.005$, $\\alpha = 0.2$, $\\beta = 1.5$, $p = 0.5$, $T_0 = 1500 \\,\\mathrm{K}$, $d_0 = 1\\times 10^{-3} \\,\\mathrm{m}$, and $\\omega_0 = 0.01 \\,\\mathrm{Hz}$ with $\\omega_{\\mathrm{ref}} = 0.01 \\,\\mathrm{Hz}$, so that $\\left( \\omega_{\\mathrm{ref}} / \\omega_0 \\right)^{\\alpha} = 1$. Use a damping parameter $\\lambda = 1\\times 10^{-6}$.\n\nSensitivity weights $w_{ij}$ (rows are modes $i=1$ to $i=5$, columns are layers $j=1$ lithosphere, $j=2$ upper mantle, $j=3$ lower mantle):\n- Mode $1$: $[\\,0.1,\\,0.3,\\,0.6\\,]$\n- Mode $2$: $[\\,0.15,\\,0.45,\\,0.4\\,]$\n- Mode $3$: $[\\,0.25,\\,0.5,\\,0.25\\,]$\n- Mode $4$: $[\\,0.35,\\,0.5,\\,0.15\\,]$\n- Mode $5$: $[\\,0.5,\\,0.45,\\,0.05\\,]$\n\nMode frequencies (for context, in $\\mathrm{Hz}$): $[\\,0.003,\\,0.005,\\,0.01,\\,0.02,\\,0.04\\,]$.\n\nTest suite:\n- Test case $1$ (Earth-like mantle):\n  - Observed inverse mode quality factors $q$: $[\\,0.0050000,\\,0.0058333,\\,0.0062500,\\,0.0064167,\\,0.0064167\\,]$.\n  - Layer temperatures $T$: $[\\,1200,\\,1600,\\,1900\\,]$ $\\mathrm{K}$.\n  - Layer grain sizes $d$: $[\\,1.0\\times 10^{-3},\\,5.0\\times 10^{-4},\\,2.0\\times 10^{-3}\\,]$ $\\mathrm{m}$.\n- Test case $2$ (hotter upper mantle, finer grains):\n  - Observed $q$: $[\\,0.0068167,\\,0.0082250,\\,0.0089167,\\,0.0091833,\\,0.0091583\\,]$.\n  - $T$: $[\\,1300,\\,1700,\\,1800\\,]$ $\\mathrm{K}$.\n  - $d$: $[\\,1.0\\times 10^{-3},\\,4.0\\times 10^{-4},\\,1.5\\times 10^{-3}\\,]$ $\\mathrm{m}$.\n- Test case $3$ (cold, coarse-grained mantle):\n  - Observed $q$: $[\\,0.0027333,\\,0.0031000,\\,0.0033333,\\,0.0034667,\\,0.0035667\\,]$.\n  - $T$: $[\\,1100,\\,1300,\\,1500\\,]$ $\\mathrm{K}$.\n  - $d$: $[\\,2.5\\times 10^{-3},\\,2.0\\times 10^{-3},\\,2.5\\times 10^{-3}\\,]$ $\\mathrm{m}$.\n- Test case $4$ (attenuating lower mantle):\n  - Observed $q$: $[\\,0.0038000,\\,0.0032000,\\,0.0027500,\\,0.0024500,\\,0.0021500\\,]$.\n  - $T$: $[\\,1100,\\,1300,\\,1800\\,]$ $\\mathrm{K}$.\n  - $d$: $[\\,2.0\\times 10^{-3},\\,2.0\\times 10^{-3},\\,5.0\\times 10^{-4}\\,]$ $\\mathrm{m}$.\n\nAlgorithmic specification:\n- Implement the damped least-squares solution for $m$ using the normal equations above and compute $Q_j = 1/m_j$ for each layer.\n- Compute $m^{\\mathrm{pred}}_j$ using the power-law scaling with the given constants and inputs.\n- Compute $r$ and $\\mathrm{RMS}$ as defined.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list of five floats in the order $[\\,Q_{\\mathrm{lith}},\\,Q_{\\mathrm{upper}},\\,Q_{\\mathrm{lower}},\\,r,\\,\\mathrm{RMS}\\,]$, so the final output is a list of these lists, for the four test cases, for example $[[a,b,c,d,e],[f,g,h,i,j],[k,l,m,n,o],[p,q,r,s,t]]$. All $Q$ values and $r$ are dimensionless, and $\\mathrm{RMS}$ is dimensionless.",
            "solution": "The solution requires implementing a three-step process for each test case.\n\n**1. Damped Least-Squares Inversion**\nThe core of the problem is to solve the linear system $(G^\\top G + \\lambda^2 I) m = G^\\top d$ for the model vector $m = [m_1, m_2, m_3]^\\top$, which represents the inverse quality factors of the three mantle layers.\n- The sensitivity matrix $G$ and the damping parameter $\\lambda = 1 \\times 10^{-6}$ are given and constant for all test cases. We first construct the matrix for the normal equations, $A_{\\text{norm}} = G^\\top G + \\lambda^2 I$.\n- For each test case, the data vector $d$ is given by the observed inverse mode quality factors $q_i$. We form the right-hand side vector $b_{\\text{norm}} = G^\\top d$.\n- We solve the linear system $A_{\\text{norm}} m = b_{\\text{norm}}$ to find the vector $m$.\n- The quality factor for each layer is then calculated as $Q_j = 1/m_j$.\n\n**2. Physical Model and Correlation**\nNext, we calculate the predicted inverse quality factors, $m^{\\mathrm{pred}}_j$, using the provided physical scaling law and compute the correlation with our inverted result $m_j$.\n- The scaling law is given by:\n$$ m^{\\mathrm{pred}}_j = A \\left( \\frac{T_j}{T_0} \\right)^{\\beta} \\left( \\frac{d_j}{d_0} \\right)^{-p} $$\nsince the frequency-dependent term $(\\omega_{\\mathrm{ref}} / \\omega_0)^{\\alpha}$ evaluates to 1.\n- Using the given constants and the per-case layer temperatures $T_j$ and grain sizes $d_j$, we compute the vector $m^{\\mathrm{pred}} = [m^{\\mathrm{pred}}_1, m^{\\mathrm{pred}}_2, m^{\\mathrm{pred}}_3]^\\top$.\n- The Pearson correlation coefficient $r$ between the vectors $m$ and $m^{\\mathrm{pred}}$ is then computed. As specified, if the standard deviation of either vector is zero, $r$ is set to $0$.\n\n**3. RMS Misfit Calculation**\nFinally, we quantify the goodness of fit of our inverted model $m$ to the observed data $d$.\n- We predict the data that our model would produce: $d^{\\text{pred}} = G m$.\n- The residual vector is the difference between observed and predicted data: $res = d - d^{\\text{pred}}$.\n- The RMS misfit is the square root of the mean of the squared residuals:\n$$ \\mathrm{RMS} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} res_i^2} $$\nwhere $N=5$ is the number of observations.\n\nThis procedure is applied to each of the four test cases, and the five calculated values ($Q_1, Q_2, Q_3, r, \\mathrm{RMS}$) are reported for each.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves a series of geophysical inverse problems to determine mantle quality factors.\n\n    For each test case, this function:\n    1. Solves a damped least-squares problem to find layer inverse quality factors (m).\n    2. Calculates the layer quality factors (Q = 1/m).\n    3. Computes a predicted inverse quality factor (m_pred) based on a physical scaling law.\n    4. Calculates the Pearson correlation coefficient (r) between m and m_pred.\n    5. Computes the root-mean-square (RMS) misfit between observed and predicted data.\n    \"\"\"\n    \n    # Define constants and fixed parameters as per the problem statement\n    # Sensitivity weights matrix G, connecting observations to model parameters\n    G = np.array([\n        [0.1, 0.3, 0.6],\n        [0.15, 0.45, 0.4],\n        [0.25, 0.5, 0.25],\n        [0.35, 0.5, 0.15],\n        [0.5, 0.45, 0.05]\n    ], dtype=float)\n\n    # Damping parameter for the least-squares inversion\n    lamb = 1e-6\n\n    # Constants for the physical attenuation scaling law\n    A = 0.005\n    beta = 1.5\n    p = 0.5\n    T0 = 1500.0  # Reference Temperature in Kelvin\n    d0 = 1e-3    # Reference grain size in meters\n    # The frequency term (omega_ref / omega_0)^alpha evaluates to 1 and is omitted.\n\n    # Pre-compute the constant parts of the normal equations matrix for efficiency\n    G_T = G.T\n    G_T_G = G_T @ G\n    lambda_sq_I = lamb**2 * np.identity(G.shape[1])\n    A_norm = G_T_G + lambda_sq_I\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1 (Earth-like mantle)\n        {\n            \"q_obs\": np.array([0.0050000, 0.0058333, 0.0062500, 0.0064167, 0.0064167]),\n            \"T_layers\": np.array([1200, 1600, 1900]),\n            \"d_grains\": np.array([1.0e-3, 5.0e-4, 2.0e-3])\n        },\n        # Test case 2 (hotter upper mantle, finer grains)\n        {\n            \"q_obs\": np.array([0.0068167, 0.0082250, 0.0089167, 0.0091833, 0.0091583]),\n            \"T_layers\": np.array([1300, 1700, 1800]),\n            \"d_grains\": np.array([1.0e-3, 4.0e-4, 1.5e-3])\n        },\n        # Test case 3 (cold, coarse-grained mantle)\n        {\n            \"q_obs\": np.array([0.0027333, 0.0031000, 0.0033333, 0.0034667, 0.0035667]),\n            \"T_layers\": np.array([1100, 1300, 1500]),\n            \"d_grains\": np.array([2.5e-3, 2.0e-3, 2.5e-3])\n        },\n        # Test case 4 (attenuating lower mantle)\n        {\n            \"q_obs\": np.array([0.0038000, 0.0032000, 0.0027500, 0.0024500, 0.0021500]),\n            \"T_layers\": np.array([1100, 1300, 1800]),\n            \"d_grains\": np.array([2.0e-3, 2.0e-3, 5.0e-4])\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        d_vec = case[\"q_obs\"]\n        T = case[\"T_layers\"]\n        d_grain = case[\"d_grains\"]\n\n        # Task 1: Solve damped least-squares for m and compute Q\n        b_norm = G_T @ d_vec\n        m = np.linalg.solve(A_norm, b_norm)\n        Q_layers = 1.0 / m\n        \n        # Task 2: Compute predicted m and Pearson correlation r\n        m_pred = A * (T / T0)**beta * (d_grain / d0)**(-p)\n        \n        # Calculate correlation coefficient, handling zero standard deviation as per instructions\n        if np.std(m, ddof=0) == 0 or np.std(m_pred, ddof=0) == 0:\n            r = 0.0\n        else:\n            r_matrix = np.corrcoef(m, m_pred)\n            r = r_matrix[0, 1]\n\n        # Task 3: Compute RMS misfit\n        d_pred = G @ m\n        residuals = d_vec - d_pred\n        rms = np.sqrt(np.mean(residuals**2))\n        \n        # Assemble results for the current case: [Q_lith, Q_upper, Q_lower, r, RMS]\n        case_results = [\n            Q_layers[0],\n            Q_layers[1],\n            Q_layers[2],\n            r,\n            rms\n        ]\n        all_results.append(case_results)\n\n    # Final print statement in the exact required format: [[...],[...],...]\n    inner_strs = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(inner_strs)}]\")\n\nsolve()\n```"
        }
    ]
}