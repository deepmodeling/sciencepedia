{
    "hands_on_practices": [
        {
            "introduction": "Understanding the intricate process of gravitational collapse begins with a firm grasp of the fundamental physical dependencies. This first exercise guides you through a classic scaling analysis to determine how the Jeans mass ($M_J$), the minimum mass required for a gas cloud to collapse, relates to its number density ($n$). By comparing the characteristic timescales for gravitational free-fall and pressure-wave propagation, you can derive a powerful relationship that provides a first-order understanding of the conditions that favor star formation. ",
            "id": "1923005",
            "problem": "In the study of star formation, a crucial concept is the Jeans instability, which describes the conditions under which a cloud of interstellar gas will collapse under its own gravity. Consider a simplified model of a protostellar cloud, treating it as a uniform, spherical, and isothermal gas cloud at a constant temperature $T$. The gas is composed of particles with a uniform average mass $\\mu$. The stability of this cloud is determined by a competition between its internal thermal energy, which causes it to expand, and its self-gravitational potential energy, which causes it to contract.\n\nA common way to analyze this is by comparing two characteristic timescales: the time it takes for the cloud to collapse under gravity if pressure were absent (the free-fall time, $t_{ff}$), and the time it takes for a pressure wave (traveling at the isothermal sound speed, $c_s$) to cross the cloud and react to a compression ($t_s$). The cloud becomes unstable and collapses if the free-fall time is shorter than the sound-crossing time. The minimum mass for which this instability occurs is known as the Jeans mass, $M_J$.\n\nIt is known that the free-fall time scales with the mass density $\\rho$ as $t_{ff} \\propto (G\\rho)^{-1/2}$, where $G$ is the gravitational constant. For an ideal gas at constant temperature $T$, the isothermal sound speed $c_s$ depends only on $T$, $\\mu$, and the Boltzmann constant $k_B$.\n\nThe Jeans mass $M_J$ exhibits a power-law relationship with the number density $n$ of the gas particles, of the form $M_J \\propto n^{\\alpha}$. Based on the principles described, determine the value of the exponent $\\alpha$.",
            "solution": "We compare the free-fall time and the sound-crossing time for a uniform spherical cloud of radius $R$ and density $\\rho$. The free-fall time scales as $t_{ff} \\propto (G \\rho)^{-1/2}$. The sound-crossing time is $t_{s} = R/c_{s}$, where for an isothermal ideal gas the sound speed is $c_{s} = (k_{B}T/\\mu)^{1/2}$.\n\nAt the threshold of instability (the Jeans condition), we set $t_{ff} \\sim t_{s}$, giving\n$$\n\\frac{R}{c_{s}} \\propto (G \\rho)^{-1/2} \\quad \\Rightarrow \\quad R \\propto c_{s} (G \\rho)^{-1/2}.\n$$\nFor a uniform sphere, the mass is $M = \\frac{4}{3}\\pi \\rho R^{3}$, hence the Jeans mass scales as\n$$\nM_{J} \\propto \\rho R^{3} \\propto \\rho \\left[c_{s} (G \\rho)^{-1/2}\\right]^{3} = c_{s}^{3} G^{-3/2} \\rho^{-1/2}.\n$$\nUsing the isothermal ideal-gas relation $c_{s}^{2} = k_{B}T/\\mu$, we have $c_{s}^{3} \\propto (k_{B}T)^{3/2} \\mu^{-3/2}$. Therefore,\n$$\nM_{J} \\propto (k_{B}T)^{3/2} \\mu^{-3/2} G^{-3/2} \\rho^{-1/2}.\n$$\nSince $T$ and $\\mu$ are fixed, the dependence on the number density $n$ follows from $\\rho = \\mu n$, giving\n$$\nM_{J} \\propto \\rho^{-1/2} \\propto (\\mu n)^{-1/2} \\propto n^{-1/2}.\n$$\nThus the power-law exponent is $\\alpha = -\\frac{1}{2}$.",
            "answer": "$$\\boxed{-\\frac{1}{2}}$$"
        },
        {
            "introduction": "Translating physical theory into a numerical simulation introduces a new set of challenges, chief among them being finite grid resolution. This practice bridges the gap between the analytical concept of Jeans instability and its computational reality by introducing the crucial Truelove resolution criterion. You will perform a practical calculation to determine if a hypothetical simulation can correctly capture gravitational collapse or if it is susceptible to artificial fragmentation, a common numerical artifact. ",
            "id": "3537920",
            "problem": "Consider a uniform, isothermal, self-gravitating gas of background density $\\rho_0$ and sound speed $c_s$ integrated with a finite-volume hydrodynamics solver on a uniform Cartesian grid of spacing $\\Delta x$. The onset of gravitational instability in such a medium may be analyzed by linearizing the equations of mass conservation, momentum conservation with a barotropic pressure law $P(\\rho)$, and the gravitational Poisson equation for the perturbations. A practical resolution requirement in grid-based simulations demands that the characteristic gravitational fragmentation scale be covered by at least $N_J$ grid cells to avoid artificial fragmentation. Suppose the simulation domain contains gas with $c_s = 0.2\\,\\mathrm{km\\,s^{-1}}$, $\\rho_0 = 2\\times 10^{-21}\\,\\mathrm{g\\,cm^{-3}}$, grid spacing $\\Delta x = 0.5\\,\\mathrm{pc}$, and one adopts $N_J = 4$ as the minimum resolution in cells of the gravitational fragmentation scale.\n\nWhich option correctly:\n(i) defines the grid scale $\\Delta x$,\n(ii) gives the correct expression for the Jeans length from linear stability of an isothermal, self-gravitating medium,\n(iii) states the correct Truelove resolution criterion in inequality form,\n(iv) evaluates the numbers above to determine whether the resolution condition is met, and\n(v) justifies why, if the condition is not met, sub-grid prescriptions for collapse, star formation, and stellar feedback become necessary?\n\nA. $\\Delta x$ is the linear size of a cubic grid cell. The Jeans length is $\\lambda_J = \\sqrt{\\pi c_s^2/(G\\rho_0)}$. The Truelove criterion is $\\lambda_J/N_J \\ge \\Delta x$. With $c_s = 0.2\\,\\mathrm{km\\,s^{-1}}$, $\\rho_0 = 2\\times 10^{-21}\\,\\mathrm{g\\,cm^{-3}}$, $\\lambda_J \\approx 1.0\\,\\mathrm{pc}$, so $\\lambda_J/N_J \\approx 0.25\\,\\mathrm{pc} < \\Delta x$, and the criterion is violated. When violated, pressure gradients across the collapse scale are under-resolved, leading to spurious numerical fragmentation and overcooling; therefore one must employ sub-grid collapse/”sink” prescriptions, star formation rate closures tied to the free-fall time, and inject momentum/energy from stellar feedback over resolvable volumes to capture the missing physics.\n\nB. $\\Delta x$ is the distance between adjacent cell centers projected along one axis. The Jeans length is $\\lambda_J = \\sqrt{\\pi c_s^2/(G\\rho_0)}$. The Truelove criterion is $\\Delta x \\ge \\lambda_J/N_J$. Using the given numbers, the grid satisfies the criterion, so no special treatment is needed; numerical diffusion in the scheme will suppress any artificial collapse without requiring sub-grid models.\n\nC. $\\Delta x$ is the smallest resolvable wavelength in the grid. The Jeans length is $\\lambda_J = \\sqrt{c_s^2/(G\\rho_0)}$ (no $\\pi$ factor). The Truelove criterion is $\\Delta x \\le \\lambda_J/N_J$. With the given parameters, the inequality $\\Delta x \\le \\lambda_J/N_J$ holds, so the resolution is sufficient and sub-grid models would only bias the solution.\n\nD. $\\Delta x$ is the linear size of a cubic grid cell. The Jeans length is $\\lambda_J = \\sqrt{\\pi c_s^2/(G\\rho_0)}$. The Truelove criterion is $\\lambda_J/N_J \\ge \\Delta x$. With the given parameters, $\\lambda_J \\approx 3.1\\,\\mathrm{pc}$ and thus $\\lambda_J/N_J \\approx 0.78\\,\\mathrm{pc} > \\Delta x$, so the criterion is satisfied and sub-grid models for star formation and feedback are unnecessary.\n\nE. $\\Delta x$ is the linear size of a cubic grid cell. The onset of collapse is controlled by the free-fall time $t_\\mathrm{ff}$ rather than a length scale; the correct requirement is a temporal criterion $\\Delta t \\le t_\\mathrm{ff}/N_t$ for some integer $N_t$. If violated, stability can be restored by reducing the time step via the Courant–Friedrichs–Lewy (CFL) condition, so no sub-grid prescriptions are needed for collapse, star formation, or feedback.",
            "solution": "The user wants me to solve and analyze a computational astrophysics problem.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\nThe problem statement provides the following information:\n- Medium: Uniform, isothermal, self-gravitating gas.\n- Background density: $\\rho_0 = 2\\times 10^{-21}\\,\\mathrm{g\\,cm^{-3}}$.\n- Sound speed: $c_s = 0.2\\,\\mathrm{km\\,s^{-1}}$.\n- Grid type: Uniform Cartesian grid.\n- Grid spacing: $\\Delta x = 0.5\\,\\mathrm{pc}$.\n- Required Jeans resolution: $N_J = 4$ grid cells.\n- The question asks for the option that correctly addresses five points: (i) definition of $\\Delta x$, (ii) expression for the Jeans length $\\lambda_J$, (iii) the Truelove resolution criterion, (iv) numerical evaluation of the criterion, and (v) the justification for sub-grid models.\n\n**Step 2: Validate Using Extracted Givens**\n\n1.  **Scientifically Grounded**: The problem concerns the Jeans instability and its numerical resolution (the Truelove criterion), which are fundamental and well-established concepts in computational astrophysics, specifically in the study of star formation. The governing equations mentioned (conservation laws, Poisson equation) are correct. The physical parameters provided for density, sound speed, and grid resolution are realistic for simulations of molecular clouds.\n2.  **Well-Posed**: The problem is well-posed. It asks to identify the correct statement among several options based on applying established physical theory and performing a standard calculation. All necessary data ($\\rho_0, c_s, \\Delta x, N_J$) are provided. The gravitational constant $G$ is a universal constant. A unique answer can be determined.\n3.  **Objective**: The problem is stated using precise, objective scientific language. There are no subjective or ambiguous terms.\n4.  **Completeness and Consistency**: The problem is self-contained and internally consistent. No essential information is missing, and no contradictions are present.\n5.  **Other Flaws**: The problem does not exhibit any other flaws such as being trivial, tautological, or based on non-formalizable analogies. It tests core knowledge in its field.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. I will proceed with a full solution.\n\n### Principle-Based Derivation and Evaluation\n\nThe core of the problem is to evaluate the Truelove resolution criterion for the given physical parameters. This requires deriving the Jeans length, stating the criterion, and performing the calculation.\n\n**1. The Jeans Length ($\\lambda_J$)**\n\nThe Jeans length is the critical wavelength that separates stable oscillations from unstable gravitational collapse in a static, uniform, self-gravitating medium. It is derived from a linear perturbation analysis of the fluid equations (mass conservation, momentum conservation/Euler equation, and the Poisson equation). For an isothermal gas with pressure $P = c_s^2 \\rho$, the dispersion relation for small perturbations is:\n$$ \\omega^2 = c_s^2 k^2 - 4\\pi G \\rho_0 $$\nwhere $\\omega$ is the perturbation frequency, $k$ is the wavenumber ($k=2\\pi/\\lambda$), $G$ is the gravitational constant, and $\\rho_0$ is the background density. Instability ($\\omega^2 < 0$) occurs for wavenumbers smaller than the Jeans wavenumber, $k_J$. The critical point $\\omega^2 = 0$ defines $k_J$:\n$$ c_s^2 k_J^2 = 4\\pi G \\rho_0 \\implies k_J = \\frac{\\sqrt{4\\pi G \\rho_0}}{c_s} $$\nThe Jeans length, $\\lambda_J$, is the wavelength corresponding to this wavenumber:\n$$ \\lambda_J = \\frac{2\\pi}{k_J} = 2\\pi \\frac{c_s}{\\sqrt{4\\pi G \\rho_0}} = c_s \\sqrt{\\frac{4\\pi^2}{4\\pi G \\rho_0}} $$\n$$ \\lambda_J = \\sqrt{\\frac{\\pi c_s^2}{G \\rho_0}} $$\nThis confirms the correct expression for the Jeans length.\n\n**2. The Truelove Resolution Criterion**\n\nIn grid-based hydrodynamics simulations, to prevent artificial numerical fragmentation, the Jeans length must be resolved by a sufficient number of grid cells. If it is not, the numerical scheme cannot accurately represent the stabilizing pressure gradients that oppose collapse on small scales. The study by Truelove et al. (1997) demonstrated that the Jeans length must be resolved by at least $N_J \\approx 4$ cells. This condition, known as the Truelove criterion, is expressed as:\n$$ \\frac{\\lambda_J}{\\Delta x} \\ge N_J \\quad \\text{or equivalently} \\quad \\Delta x \\le \\frac{\\lambda_J}{N_J} $$\nThe form $\\lambda_J/N_J \\ge \\Delta x$ is also common.\n\n**3. Numerical Evaluation**\n\nWe are given:\n- $c_s = 0.2\\,\\mathrm{km\\,s^{-1}} = 2 \\times 10^4\\,\\mathrm{cm\\,s^{-1}}$\n- $\\rho_0 = 2 \\times 10^{-21}\\,\\mathrm{g\\,cm^{-3}}$\n- $\\Delta x = 0.5\\,\\mathrm{pc}$\n- $N_J = 4$\n\nWe use the physical constants:\n- $G \\approx 6.674 \\times 10^{-8}\\,\\mathrm{cm^3\\,g^{-1}\\,s^{-2}}$\n- $1\\,\\mathrm{pc} \\approx 3.086 \\times 10^{18}\\,\\mathrm{cm}$\n\nFirst, calculate the Jeans length $\\lambda_J$:\n$$ \\lambda_J = \\sqrt{\\frac{\\pi (2 \\times 10^4\\,\\mathrm{cm\\,s^{-1}})^2}{(6.674 \\times 10^{-8}\\,\\mathrm{cm^3\\,g^{-1}\\,s^{-2}})(2 \\times 10^{-21}\\,\\mathrm{g\\,cm^{-3}})}} $$\n$$ \\lambda_J = \\sqrt{\\frac{\\pi \\times 4 \\times 10^8}{1.3348 \\times 10^{-28}}}\\,\\mathrm{cm} = \\sqrt{\\frac{1.2566 \\times 10^9}{1.3348 \\times 10^{-28}}}\\,\\mathrm{cm} \\approx \\sqrt{9.414 \\times 10^{36}}\\,\\mathrm{cm} $$\n$$ \\lambda_J \\approx 3.068 \\times 10^{18}\\,\\mathrm{cm} $$\nTo compare with $\\Delta x$, we convert $\\lambda_J$ to parsecs:\n$$ \\lambda_J \\approx \\frac{3.068 \\times 10^{18}\\,\\mathrm{cm}}{3.086 \\times 10^{18}\\,\\mathrm{cm/pc}} \\approx 0.994\\,\\mathrm{pc} $$\nRounding to two significant figures, $\\lambda_J \\approx 1.0\\,\\mathrm{pc}$.\n\nNow, we check the Truelove criterion, $\\Delta x \\le \\lambda_J / N_J$:\n$$ \\frac{\\lambda_J}{N_J} = \\frac{1.0\\,\\mathrm{pc}}{4} = 0.25\\,\\mathrm{pc} $$\nThe criterion is $\\Delta x \\le 0.25\\,\\mathrm{pc}$. With the given $\\Delta x = 0.5\\,\\mathrm{pc}$, we have:\n$$ 0.5\\,\\mathrm{pc} \\le 0.25\\,\\mathrm{pc} $$\nThis statement is **false**. Therefore, the resolution criterion is **violated**.\n\n**4. Consequence of Violation**\n\nWhen the Truelove criterion is violated, the grid is too coarse to resolve the Jeans length. As collapse proceeds, density increases, and the local Jeans length shrinks. Once $\\lambda_J$ becomes smaller than the grid scale, the simulation can no longer model the pressure forces that would resist collapse. This leads to unphysical, grid-scale fragmentation. To avoid this and to model the physics of unresolved collapse and star formation, computational astrophysicists employ sub-grid models. These include:\n- \"Sink particles\" (or star particles) to represent unresolved collapsing cores, accreting mass from the grid.\n- Sub-grid star formation recipes, often linking the star formation rate to the local gas density and free-fall time ($t_\\mathrm{ff} \\propto 1/\\sqrt{G\\rho}$).\n- Sub-grid stellar feedback models to inject energy, momentum, mass, and radiation from the sink particles back into the surrounding gas on the grid, representing the effects of winds, jets, and supernovae from the newly formed stars.\n\n### Option-by-Option Analysis\n\n**A.**\n- (i) `$\\Delta x$ is the linear size of a cubic grid cell.` **Correct**. This is a standard definition.\n- (ii) `The Jeans length is $\\lambda_J = \\sqrt{\\pi c_s^2/(G\\rho_0)}$`. **Correct**. As derived above.\n- (iii) `The Truelove criterion is $\\lambda_J/N_J \\ge \\Delta x$`. **Correct**. This is a valid statement of the criterion.\n- (iv) `...$\\lambda_J \\approx 1.0\\,\\mathrm{pc}$, so $\\lambda_J/N_J \\approx 0.25\\,\\mathrm{pc} < \\Delta x$, and the criterion is violated.` **Correct**. The calculation matches our derivation, and the conclusion that the criterion is violated is correct.\n- (v) `When violated, pressure gradients... are under-resolved... one must employ sub-grid... prescriptions...` **Correct**. This accurately describes the physical and numerical consequences and the need for sub-grid models for collapse, star formation, and feedback.\n**Verdict: Correct.**\n\n**B.**\n- (iii) `The Truelove criterion is $\\Delta x \\ge \\lambda_J/N_J$.` **Incorrect**. This is the inverse of the correct criterion. A finer grid (smaller $\\Delta x$) is required to meet the criterion, not a coarser one.\n- (iv) `...the grid satisfies the criterion...` **Incorrect**. It is violated.\n- (v) `...numerical diffusion in the scheme will suppress any artificial collapse...` **Incorrect**. Relying on numerical diffusion is not a physically motivated or controlled method to handle gravitational collapse; it's an artifact to be minimized. The correct solution is a sub-grid model.\n**Verdict: Incorrect.**\n\n**C.**\n- (i) `$\\Delta x$ is the smallest resolvable wavelength in the grid.` **Incorrect**. The smallest resolvable wavelength is $2\\Delta x$ (the Nyquist limit).\n- (ii) `The Jeans length is $\\lambda_J = \\sqrt{c_s^2/(G\\rho_0)}$ (no $\\pi$ factor)`. **Incorrect**. The derivation from first principles includes a factor of $\\pi$. This expression is an order-of-magnitude estimate, not the formal result from linear theory.\n- (iv) `...the inequality $\\Delta x \\le \\lambda_J/N_J$ holds...` **Incorrect**. As shown in the derivation, the inequality is violated.\n**Verdict: Incorrect.**\n\n**D.**\n- (iv) `With the given parameters, $\\lambda_J \\approx 3.1\\,\\mathrm{pc}$...` **Incorrect**. This is a calculation error. Our calculation correctly yields $\\lambda_J \\approx 1.0\\,\\mathrm{pc}$. This error propagates to the conclusion.\n- (iv/v) `...so the criterion is satisfied and sub-grid models... are unnecessary.` **Incorrect**. This conclusion is based on the faulty calculation. The criterion is actually violated, and sub-grid models are necessary.\n**Verdict: Incorrect.**\n\n**E.**\n- States that the requirement is a temporal one ($\\Delta t \\le t_\\mathrm{ff}/N_t$) rather than a spatial one. **Incorrect**. This confuses the Courant-Friedrichs-Lewy (CFL) condition on the timestep $\\Delta t$ with the Truelove condition on the grid spacing $\\Delta x$. While timestep control is crucial for accuracy and stability, it does not address the problem of artificial fragmentation, which is an issue of spatial resolution.\n- `...stability can be restored by reducing the time step... so no sub-grid prescriptions are needed...` **Incorrect**. Reducing the timestep cannot compensate for a lack of spatial resolution. This shows a fundamental misunderstanding of the problem.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Having explored the scaling laws and a key numerical criterion, this final exercise challenges you to implement these concepts in a practical, simplified simulation. You will design a program to model the evolution of a collapsing isothermal sphere's central density. The core task is to actively enforce the resolution criterion derived from the Jeans length, providing a direct, hands-on experience of how numerical constraints dictate the limits of a simulation and necessitate more advanced sub-grid techniques. ",
            "id": "3520927",
            "problem": "Design and implement a complete, runnable program that formalizes and executes a numerical test for spherical gravitational collapse on a uniform grid by initializing a marginally Jeans-unstable isothermal sphere and enforcing resolution criteria to capture central density increase without artificial fragmentation. The program must be self-contained, use the International System of Units (SI), and produce a single-line list output for a specified test suite. The algorithmic design must start from first principles and well-tested facts to derive the necessary working formulas.\n\nBegin from the following fundamental base:\n- Newtonian self-gravity and fluid dynamics governed by the compressible Euler equations and Poisson's equation. Specifically, mass conservation, momentum conservation, and gravity satisfy $ \\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{v}) = 0 $, $ \\partial_t (\\rho \\mathbf{v}) + \\nabla \\cdot (\\rho \\mathbf{v} \\mathbf{v} + P \\mathbf{I}) = - \\rho \\nabla \\Phi $, and $ \\nabla^2 \\Phi = 4 \\pi G \\rho $, where $ \\rho $ is mass density, $ \\mathbf{v} $ is velocity, $ P $ is pressure, $ \\mathbf{I} $ is the identity tensor, $ \\Phi $ is gravitational potential, and $ G $ is the gravitational constant.\n- Isothermal equation of state $ P = c_s^2 \\rho $, with constant isothermal sound speed $ c_s $ (in $ \\mathrm{m/s} $).\n- Linearized stability of a uniform, self-gravitating isothermal medium, from which the concept of a Jeans instability and a corresponding characteristic length scale emerges.\n- Hydrostatic equilibrium in an isothermal sphere, $ \\nabla P = - \\rho \\nabla \\Phi $, combined with Poisson’s equation, to obtain a characteristic inner scale length for the central, quasi-uniform core.\n\nYour program must perform the following, adhering to scientific realism, without inserting any shortcut formulas directly in the statement. Instead, derive them in the solution section and implement them in the code:\n1. Initialize a spherically symmetric, truncated isothermal sphere with central density $ \\rho_c(0) $ and sound speed $ c_s $, using a radially decreasing, centrally flat profile constructed from hydrostatic balance. Use SI units throughout. The sphere is truncated at radius $ R $.\n2. Define a uniform grid with $ N $ cells across the sphere radius $ R $, yielding grid spacing $ \\Delta x = R/N $.\n3. Evolve the central density $ \\rho_c(t) $ in time using a physically motivated collapse timescale based on free-fall in a self-gravitating fluid. Explicitly enforce a stable time step using the Courant-Friedrichs-Lewy (CFL) condition applied to a characteristic speed combining isothermal sound speed and a free-fall estimate derived from the mass inside the inner core scale. Use a conservative CFL number $ C_{\\mathrm{CFL}} = 0.3 $.\n4. At each time step, compute the local characteristic instability length and enforce a resolution criterion that prevents artificial fragmentation. Specifically, require a minimum number of cells per instability length to be maintained at the center. If the resolution condition would be violated as the central density increases, stop the evolution and record the last admissible central density.\n5. Stop the evolution either when the central density has increased by a target factor $ f_{\\mathrm{target}} $ relative to the initial central density, or when the resolution criterion is about to be violated, whichever occurs first. The program must record the achieved final central density and whether the target factor has been reached without violating the resolution criterion.\n\nNumerical and physical specifications:\n- Use SI units for all internal computations and outputs. Express any final density values in $ \\mathrm{kg/m^3} $ as decimal floats.\n- Angle units are not required in this problem.\n- For the resolution threshold, require a minimum number of cells per instability length of $ N_{\\min} = 4 $ (expressed as the integer $ 4 $).\n- Use a conservative stability limiter on the density integration time step so that the fractional central density change per step does not exceed $ 1\\% $ (expressed as the decimal $ 0.01 $).\n- Use a maximum runtime cap of $ t_{\\max} = 5 \\, t_{\\mathrm{ff},0} $ to avoid integration blow-up, where $ t_{\\mathrm{ff},0} $ is the initial free-fall time computed from the initial central density.\n\nTest suite:\nProvide three test cases that probe different aspects of the setup:\n- Case A (happy path): $ R = 0.1 $ parsec, $ N = 256 $, $ c_s = 200 \\, \\mathrm{m/s} $, $ \\rho_c(0) = 2 \\times 10^{-16} \\, \\mathrm{kg/m^3} $, $ N_{\\min} = 4 $, $ f_{\\mathrm{target}} = 10 $.\n- Case B (low resolution): $ R = 0.1 $ parsec, $ N = 32 $, $ c_s = 200 \\, \\mathrm{m/s} $, $ \\rho_c(0) = 2 \\times 10^{-16} \\, \\mathrm{kg/m^3} $, $ N_{\\min} = 4 $, $ f_{\\mathrm{target}} = 10 $.\n- Case C (larger radius edge case): $ R = 0.2 $ parsec, $ N = 128 $, $ c_s = 200 \\, \\mathrm{m/s} $, $ \\rho_c(0) = 2 \\times 10^{-16} \\, \\mathrm{kg/m^3} $, $ N_{\\min} = 4 $, $ f_{\\mathrm{target}} = 10 $.\n\nYour program must:\n- Convert parsec to meters internally using $ 1 \\, \\mathrm{pc} = 3.0857 \\times 10^{16} \\, \\mathrm{m} $.\n- For each case, evolve the central density following the specified rules until one of the stopping criteria is met.\n- For each test case, produce two outputs: the final central density in $ \\mathrm{kg/m^3} $ as a float, and a boolean indicating whether the target factor was reached before violating the resolution criterion.\n- Final output format: A single line containing a Python-style list with entries for all cases concatenated in order, alternating float and boolean per case. For example, the output must be of the form $ [\\rho_{\\mathrm{final,A}}, \\mathrm{pass}_A, \\rho_{\\mathrm{final,B}}, \\mathrm{pass}_B, \\rho_{\\mathrm{final,C}}, \\mathrm{pass}_C] $ where each $ \\rho_{\\mathrm{final}} $ is a float in $ \\mathrm{kg/m^3} $ and each $ \\mathrm{pass} $ is either $ \\mathrm{True} $ or $ \\mathrm{False} $.\n\nImportant: The problem statement must not provide any direct shortcuts or final formulas for the instability length, the inner core scale, or the free-fall time. These must be derived from the specified base in your solution. Implement precisely those derived relations in code to complete the numerical test and produce the required outputs.",
            "solution": "The problem posed is to design and implement a numerical test for spherical gravitational collapse. This involves initializing a marginally Jeans-unstable isothermal sphere and tracking the evolution of its central density, $\\rho_c$, subject to physical and numerical constraints. The evolution is halted when either a target density is reached or the simulation can no longer adequately resolve the characteristic scale of gravitational instability. This is a standard test in computational astrophysics, often used to validate hydrodynamics codes.\n\nBefore an algorithmic solution can be constructed, it is necessary to derive the key physical quantities from the provided fundamental principles: the Euler equations, Poisson's equation, and an isothermal equation of state. The required derivations are for the characteristic instability length (the Jeans length, $\\lambda_J$), and the characteristic timescale for collapse (the free-fall time, $t_{\\mathrm{ff}}$).\n\n**1. Derivation of the Jeans Instability Length ($\\lambda_J$)**\n\nThe Jeans instability describes the conditions under which a self-gravitating fluid's internal pressure can no longer resist gravitational collapse. We analyze the stability of a uniform, static, isothermal medium with initial density $\\rho_0$, pressure $P_0 = c_s^2 \\rho_0$, and velocity $\\mathbf{v}_0 = \\mathbf{0}$. We introduce small perturbations: $\\rho = \\rho_0 + \\rho_1$, $\\mathbf{v} = \\mathbf{v}_1$, $P = P_0 + P_1$, and $\\Phi = \\Phi_0 + \\Phi_1$.\n\nLinearizing the governing equations for these perturbations yields:\n- Mass Conservation: $\\partial_t \\rho_1 + \\rho_0 \\nabla \\cdot \\mathbf{v}_1 = 0$\n- Momentum Conservation: $\\rho_0 \\partial_t \\mathbf{v}_1 + \\nabla P_1 = -\\rho_0 \\nabla \\Phi_1$\n- Poisson's Equation: $\\nabla^2 \\Phi_1 = 4 \\pi G \\rho_1$\n\nUsing the isothermal equation of state, $\\nabla P_1 = c_s^2 \\nabla \\rho_1$. We seek plane-wave solutions of the form $e^{i(\\mathbf{k} \\cdot \\mathbf{x} - \\omega t)}$, where $\\mathbf{k}$ is the wavevector and $\\omega$ is the angular frequency. The derivatives transform as $\\partial_t \\to -i\\omega$ and $\\nabla \\to i\\mathbf{k}$. The linearized system becomes an algebraic system:\n- $-i\\omega \\rho_1 + \\rho_0 (i\\mathbf{k} \\cdot \\mathbf{v}_1) = 0 \\implies \\omega \\rho_1 = \\rho_0 (\\mathbf{k} \\cdot \\mathbf{v}_1)$\n- $-i\\omega \\rho_0 \\mathbf{v}_1 + i\\mathbf{k} c_s^2 \\rho_1 = -i\\mathbf{k} \\rho_0 \\Phi_1$\n- $-k^2 \\Phi_1 = 4 \\pi G \\rho_1$\n\nTaking the dot product of the momentum equation with $\\mathbf{k}$ and substituting the other relations, we arrive at the dispersion relation for the system:\n$$ \\omega^2 = c_s^2 k^2 - 4 \\pi G \\rho_0 $$\nFor a perturbation to be stable, it must oscillate, which requires a real frequency $\\omega$, meaning $\\omega^2 > 0$. If $\\omega^2 < 0$, $\\omega$ is imaginary, and the perturbation grows exponentially, signifying an instability. The critical point $\\omega^2 = 0$ defines the Jeans wavenumber, $k_J$:\n$$ c_s^2 k_J^2 = 4 \\pi G \\rho_0 \\implies k_J = \\sqrt{\\frac{4 \\pi G \\rho_0}{c_s^2}} $$\nThe corresponding Jeans length, $\\lambda_J = 2\\pi/k_J$, is the characteristic scale of the instability. Perturbations larger than this length are gravitationally unstable.\n$$ \\lambda_J = 2\\pi \\sqrt{\\frac{c_s^2}{4 \\pi G \\rho_0}} = c_s \\sqrt{\\frac{\\pi}{G \\rho_0}} $$\nThis is the required formula for the instability length as a function of local density $\\rho$.\n\n**2. Derivation of the Free-fall Time ($t_{\\mathrm{ff}}$)**\n\nThe free-fall time is the characteristic timescale for a pressureless fluid to collapse under its own gravity. We consider a particle on the surface of a uniform sphere of density $\\rho$ and initial radius $R$. The mass enclosed is $M = \\frac{4}{3}\\pi R^3 \\rho$. The equation of motion for this particle at a radius $r(t)$ is given by Newton's law of gravitation, where the enclosed mass remains $M$:\n$$ \\frac{d^2r}{dt^2} = -\\frac{GM}{r^2} $$\nThis is an equation for radial infall. We solve it with initial conditions $r(0) = R$ and $\\dot{r}(0) = 0$. Integrating once with respect to time (using the energy method) gives the velocity:\n$$ \\frac{dr}{dt} = -\\sqrt{2GM\\left(\\frac{1}{r} - \\frac{1}{R}\\right)} $$\nThe free-fall time $t_{\\mathrm{ff}}$ is the time taken for the particle to reach the center ($r=0$). This requires integrating the above expression:\n$$ t_{\\mathrm{ff}} = \\int_R^0 \\frac{dr}{-\\sqrt{2GM\\left(\\frac{1}{r} - \\frac{1}{R}\\right)}} = \\sqrt{\\frac{R}{2GM}} \\int_0^R \\sqrt{\\frac{r}{R-r}} dr $$\nUsing the substitution $r = R \\sin^2\\theta$, the integral evaluates to $\\frac{\\pi R}{2}$. Substituting this back gives:\n$$ t_{\\mathrm{ff}} = \\sqrt{\\frac{R}{2GM}} \\left(\\frac{\\pi R}{2}\\right) = \\frac{\\pi}{2\\sqrt{2}}\\sqrt{\\frac{R^3}{GM}} $$\nFinally, substituting $M = \\frac{4}{3}\\pi R^3 \\rho$, the dependence on the initial radius $R$ cancels out, yielding a universal timescale that depends only on the initial density:\n$$ t_{\\mathrm{ff}} = \\sqrt{\\frac{3\\pi}{32 G \\rho}} $$\nThis is the derived formula for the free-fall time.\n\n**3. Algorithmic Design and Numerical Scheme**\n\nThe program will simulate the evolution of the central density $\\rho_c(t)$ based on a simple ordinary differential equation model where the rate of change is governed by the free-fall time: $d\\rho_c/dt \\approx \\rho_c/t_{\\mathrm{ff}}(\\rho_c)$. A forward Euler method is used for time integration: $\\rho_{c,k+1} = \\rho_{c,k} + ( \\rho_{c,k} / t_{\\mathrm{ff}}(\\rho_{c,k}) ) \\Delta t$.\n\nThe simulation proceeds as follows for each test case:\n1.  **Initialization**: All parameters are converted to SI units. The grid spacing $\\Delta x = R/N$ is calculated. The initial and target central densities ($\\rho_c(0)$, $\\rho_{\\mathrm{target}}$), and the maximum simulation time ($t_{\\max} = 5 \\, t_{\\mathrm{ff},0}$) are determined. The simulation time $t$ starts at $0$.\n\n2.  **Time Step Calculation**: At each step $k$, a time step $\\Delta t$ is computed as the minimum of two limiting factors to ensure stability and accuracy:\n    -   A Courant-Friedrichs-Lewy (CFL) condition: $\\Delta t_{\\mathrm{CFL}} = C_{\\mathrm{CFL}} \\frac{\\Delta x}{c_s}$, with $C_{\\mathrm{CFL}} = 0.3$. This limits the time step based on the sound-crossing time of a grid cell.\n    -   A density change limiter: The fractional density change per step is limited to $1\\%$ (or $0.01$). From the evolution equation, this implies $\\Delta t / t_{\\mathrm{ff}} \\le 0.01$, giving $\\Delta t_{\\rho} = 0.01 \\, t_{\\mathrm{ff}}(\\rho_{c,k})$.\n    -   The final time step is $\\Delta t = \\min(\\Delta t_{\\mathrm{CFL}}, \\Delta t_{\\rho})$.\n\n3.  **Evolution and Halting Conditions**: The simulation evolves in a loop. In each iteration, a candidate next state $(\\rho_{c,k+1}, t_{k+1})$ is predicted. This candidate state is checked against the halting conditions before the step is accepted.\n    -   **Resolution Criterion (Truelove Criterion)**: The Jeans length must be resolved by a minimum number of grid cells, $N_{\\min}=4$. That is, $\\lambda_J(\\rho) \\ge N_{\\min} \\Delta x$. We calculate $\\lambda_J(\\rho_{c,k+1})$. If this condition is violated, the simulation stops, and the final density is recorded as the last admissible value, $\\rho_{c,k}$. The target is considered not reached.\n    -   **Target Density**: If $\\rho_{c,k+1} \\ge \\rho_{\\mathrm{target}}$, the simulation stops. The final density is $\\rho_{c,k+1}$, and the target is considered reached.\n    -   **Maximum Time**: If $t_{k+1} \\ge t_{\\max}$, the simulation stops to prevent runaway integration. The final density is $\\rho_{c,k+1}$. The target-reached status is determined by checking if this final density meets or exceeds $\\rho_{\\mathrm{target}}$.\n\n4.  **Output**: For each test case, the final central density achieved and a boolean indicating whether the target density factor was reached are stored. The final output is a single-line list containing these pairs for all test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.constants import G\n\ndef solve():\n    \"\"\"\n    Formalizes and executes a numerical test for spherical gravitational collapse.\n    \"\"\"\n    # Define physical constants from problem statement\n    PC_TO_M = 3.0857e16\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (happy path)\n        {'R_pc': 0.1, 'N': 256, 'c_s': 200.0, 'rho_c0': 2e-16, 'N_min': 4, 'f_target': 10.0},\n        # Case B (low resolution)\n        {'R_pc': 0.1, 'N': 32, 'c_s': 200.0, 'rho_c0': 2e-16, 'N_min': 4, 'f_target': 10.0},\n        # Case C (larger radius edge case)\n        {'R_pc': 0.2, 'N': 128, 'c_s': 200.0, 'rho_c0': 2e-16, 'N_min': 4, 'f_target': 10.0},\n    ]\n\n    # Global numerical parameters\n    C_CFL = 0.3\n    DENSITY_CHANGE_LIMIT = 0.01\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters\n        R_pc = case['R_pc']\n        N = case['N']\n        c_s = case['c_s']\n        rho_c0 = case['rho_c0']\n        N_min = case['N_min']\n        f_target = case['f_target']\n\n        # 1. Initialization and Unit Conversion\n        R = R_pc * PC_TO_M  # Radius in meters\n        delta_x = R / N      # Grid spacing in meters\n\n        rho_c = rho_c0\n        t = 0.0\n        target_reached = False\n\n        rho_target = f_target * rho_c0\n\n        # Derived formula for initial free-fall time\n        t_ff0 = np.sqrt((3.0 * np.pi) / (32.0 * G * rho_c0))\n        t_max = 5.0 * t_ff0\n        \n        # 2. Main Evolution Loop\n        while True:\n            # Calculate characteristic quantities for the current state\n            # Derived formula for free-fall time at current density rho_c\n            t_ff = np.sqrt((3.0 * np.pi) / (32.0 * G * rho_c))\n\n            # Calculate time step based on CFL and density change limits\n            dt_cfl = C_CFL * delta_x / c_s\n            dt_rho = DENSITY_CHANGE_LIMIT * t_ff\n            dt = min(dt_cfl, dt_rho)\n\n            # Predict the next central density\n            # Using d(rho)/dt ~ rho / t_ff\n            rho_c_next = rho_c + (rho_c / t_ff) * dt\n            t_next = t + dt\n\n            # 3. Check Halting Conditions before committing the step\n\n            # a) Resolution Criterion (Truelove Criterion)\n            # The next step would violate resolution if the Jeans length at rho_c_next\n            # is smaller than N_min grid cells.\n            # Derived formula for Jeans length: lambda_J = c_s * sqrt(pi / (G * rho))\n            lambda_j_next = c_s * np.sqrt(np.pi / (G * rho_c_next))\n            \n            if lambda_j_next < N_min * delta_x:\n                # Resolution is about to be violated. Stop.\n                # The final density is the last admissible one, which is the current rho_c.\n                target_reached = False\n                break\n\n            # b) Target Density\n            if rho_c_next >= rho_target:\n                # Target reached. Stop.\n                rho_c = rho_c_next\n                target_reached = True\n                break\n\n            # c) Maximum Time\n            if t_next >= t_max:\n                # Max time reached. Stop.\n                rho_c = rho_c_next\n                # Check if the target was met at this final step\n                target_reached = (rho_c >= rho_target)\n                break\n\n            # If no halting conditions met, commit the step\n            rho_c = rho_c_next\n            t = t_next\n\n        # Append final results for this case to the list\n        results.append(rho_c)\n        results.append(target_reached)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}