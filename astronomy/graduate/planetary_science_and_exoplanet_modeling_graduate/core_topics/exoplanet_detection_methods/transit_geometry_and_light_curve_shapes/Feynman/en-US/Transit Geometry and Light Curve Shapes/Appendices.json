{
    "hands_on_practices": [
        {
            "introduction": "Understanding the shape of a transit light curve begins with pure geometry. This first practice challenges you to derive and implement the foundational model of a transit based on the overlap area between two disks, representing the star and the planet. By coding this model for a uniformly bright star, you will not only grasp the direct relationship between geometry and flux but also confront the practical necessity of ensuring numerical stability, a critical skill in computational astrophysics .",
            "id": "4186773",
            "problem": "You are tasked with deriving from first principles and implementing an efficient, numerically stable algorithm to compute the normalized stellar flux during a planetary transit for arbitrary projected separation values. The algorithm must partition geometry into three cases: no overlap, partial overlap, and full overlap, and must ensure numerical stability near the case boundaries. The star is modeled as a uniformly bright, circular disk of unit radius, and the planet is modeled as a uniformly opaque circular disk with radius given by the planet-to-star radius ratio.\n\nStarting point and definitions (fundamental base):\n- The observed flux from a star with specific intensity $I(\\mu)$ is the surface integral of $I(\\mu)$ over the visible stellar disk. For a uniformly bright star, $I(\\mu) = I_0$ where $I_0$ is a constant, and the normalized flux equals the fraction of the unobscured stellar area.\n- Let the stellar radius be $R_\\star = 1$ (defining the unit length), and the planet-to-star radius ratio be $p = R_p / R_\\star$, where $R_p$ is the planet radius. Let the projected separation between the centers of the star and planet, in units of $R_\\star$, be $z \\ge 0$.\n- The normalized flux $F$ during transit is defined as $F = 1 - A_{\\mathrm{overlap}} / \\pi$, where $A_{\\mathrm{overlap}}$ is the area of intersection of two circles of radii $1$ and $p$ whose centers are separated by distance $z$. This relation follows from the definition of normalized flux for a uniformly bright disk, since the unobscured stellar area is $\\pi$.\n\nTasks:\n1. Derive expressions for the overlap area $A_{\\mathrm{overlap}}$ based on Euclidean geometry by partitioning into three cases, expressed in terms of $z$ and $p$:\n   - No overlap: $z \\ge 1 + p$.\n   - Full overlap (one circle contained within the other): $z \\le |1 - p|$.\n   - Partial overlap: $|1 - p|  z  1 + p$.\n   Your derivation must start from the definition of normalized flux as an area integral and reduce to analytic forms for $A_{\\mathrm{overlap}}$ in each case without introducing untested assumptions.\n2. Design the algorithm to compute $F(z, p)$ by evaluating $A_{\\mathrm{overlap}}$ efficiently for arbitrary $z$ and $p$, ensuring numerical stability near the boundaries $z = 1 + p$ and $z = |1 - p|$. Your algorithm must:\n   - Avoid division by zero.\n   - Clip arguments to inverse trigonometric functions to their domains (e.g., $[-1, 1]$).\n   - Clamp small negative values under square roots to $0$.\n   - Employ tolerance thresholds for boundary decisions to avoid oscillations due to floating-point rounding.\n3. Implement the algorithm in a program that takes no input, computes the fluxes for the test suite below, and prints the results in the required format.\n\nTest suite:\nCompute the normalized flux $F$ for the following $(p, z)$ pairs, where $p$ and $z$ are dimensionless:\n- Case covering no overlap, partial overlap, full overlap, and boundary proximity:\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $2.0$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $1.1$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $1.099999999999$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $0.9$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $0.900000000001$ $\\,)$\n  - $(p, z) = (\\,$ $0.1$ $\\,,$ $\\,$ $0.899999999999$ $\\,)$\n  - $(p, z) = (\\,$ $1.0$ $\\,,$ $\\,$ $0.0$ $\\,)$\n  - $(p, z) = (\\,$ $1.0$ $\\,,$ $\\,$ $1.9999$ $\\,)$\n  - $(p, z) = (\\,$ $0.0$ $\\,,$ $\\,$ $0.5$ $\\,)$\n  - $(p, z) = (\\,$ $0.5$ $\\,,$ $\\,$ $1.5$ $\\,)$\n\nRequired output:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[$$result_1$$,$$result_2$$,$$\\dots$$]$).\n- Each result must be a floating-point number representing the normalized flux $F$ for the corresponding test case, computed using the algorithm described above.\n\nConstraints:\n- Use the circle intersection geometry only; do not use numerical pixelation or Monte Carlo integration.\n- Ensure that the implementation is efficient and numerically stable near $z = 1 + p$ and $z = |1 - p|$.",
            "solution": "The problem is evaluated as scientifically grounded, well-posed, and objective, meeting all criteria for a valid problem statement. It presents a standard problem in exoplanet transit modeling based on fundamental Euclidean geometry.\n\nThe normalized stellar flux $F$ for a uniformly bright star of unit radius ($R_\\star = 1$) is given by the fraction of the visible stellar disk that is not obscured by the transiting planet. The total area of the stellar disk is $A_\\star = \\pi R_\\star^2 = \\pi$. If $A_{\\mathrm{overlap}}$ is the area of the stellar disk hidden by the planet, the normalized flux is $F = (A_\\star - A_{\\mathrm{overlap}}) / A_\\star = 1 - A_{\\mathrm{overlap}} / \\pi$.\n\nOur task is to derive the analytic expression for $A_{\\mathrm{overlap}}$, which is the area of intersection of two circles: the star with radius $r_1 = 1$, and the planet with radius $r_2 = p$. The distance between their centers is $z$.\n\nLet the star's center be at the origin $(0, 0)$ of a Cartesian coordinate system. Let the planet's center be at $(z, 0)$. The equations of the two circles are $x^2 + y^2 = 1^2$ and $(x-z)^2 + y^2 = p^2$.\n\nThe area of intersection of two circles can be calculated as the sum of the areas of two circular segments, one from each circle, that are defined by their common chord.\n\nFirst, we find the $x$-coordinate of the common chord by solving for the intersection points of the two circles:\n$$y^2 = 1 - x^2$$\n$$(x-z)^2 + (1-x^2) = p^2 \\implies x^2 - 2xz + z^2 + 1 - x^2 = p^2$$\n$$1 - 2xz + z^2 = p^2 \\implies x = \\frac{1 + z^2 - p^2}{2z}$$\nThis $x$ value defines the position of the vertical chord common to both circles. This expression is only physically meaningful when the circles intersect partially, and $z  0$.\n\nThe area of a circular segment of a circle with radius $r$, cut by a chord at a distance $d$ from its center, is given by $A_{\\mathrm{seg}} = r^2 \\arccos(d/r) - d\\sqrt{r^2 - d^2}$.\n\nFor the star (radius $r_1=1$), the distance to the chord is $d_1 = x = \\frac{1 + z^2 - p^2}{2z}$.\nFor the planet (radius $r_2=p$), the distance to the chord is $d_2 = |z-x| = z - x = z - \\frac{1 + z^2 - p^2}{2z} = \\frac{2z^2 - 1 - z^2 + p^2}{2z} = \\frac{p^2 + z^2 - 1}{2z}$.\n\nThe total overlap area is the sum of the two segment areas: $A_{\\mathrm{overlap}} = A_{\\mathrm{seg},1} + A_{\\mathrm{seg},2}$.\n$$A_{\\mathrm{seg},1} = 1^2 \\arccos\\left(\\frac{d_1}{1}\\right) - d_1 \\sqrt{1^2 - d_1^2}$$\n$$A_{\\mathrm{seg},2} = p^2 \\arccos\\left(\\frac{d_2}{p}\\right) - d_2 \\sqrt{p^2 - d_2^2}$$\n\nThe term under the square root can be simplified. The half-length of the chord, $y = \\sqrt{1-d_1^2}$, can be expressed as:\n$$y = \\sqrt{1 - \\left(\\frac{1+z^2-p^2}{2z}\\right)^2} = \\frac{1}{2z}\\sqrt{4z^2 - (1+z^2-p^2)^2}$$\nThe argument of the square root is a difference of squares:\n$$4z^2 - (1+z^2-p^2)^2 = (2z - (1+z^2-p^2))(2z + (1+z^2-p^2))$$\n$$= (2z - 1 - z^2 + p^2)(2z + 1 + z^2 - p^2)$$\n$$= (p^2 - (z-1)^2)((z+1)^2 - p^2)$$\n$$= (p-z+1)(p+z-1)(z-p+1)(z+p+1)$$\nThis term is guaranteed to be non-negative when a non-degenerate triangle with sides $1$, $p$, and $z$ can be formed, which corresponds to the partial overlap case. The term $\\sqrt{p^2-d_2^2}$ simplifies to the same chord half-length $y$.\n\nSubstituting $d_1$ and $d_2$ into the segment area formulas:\n$A_{\\mathrm{overlap}} = \\arccos(d_1) - d_1 y + p^2\\arccos(d_2/p) - d_2 y = \\arccos(d_1) + p^2\\arccos(d_2/p) - (d_1+d_2)y$.\nSince $d_1+d_2 = x + (z-x) = z$, we have:\n$A_{\\mathrm{overlap}} = \\arccos(d_1) + p^2\\arccos(d_2/p) - z \\cdot y$.\n$A_{\\mathrm{overlap}} = \\arccos\\left(\\frac{1+z^2-p^2}{2z}\\right) + p^2 \\arccos\\left(\\frac{p^2+z^2-1}{2pz}\\right) - \\frac{1}{2}\\sqrt{(-z+p+1)(z+p-1)(z-p+1)(z+p+1)}$.\n\nThis formula is valid for the partial overlap case. We now analyze the three distinct geometric cases as a function of $p$ and $z$.\n\n**1. No Overlap: $z \\ge 1 + p$**\nThe circles do not intersect or are externally tangent. The distance between centers is greater than or equal to the sum of the radii.\n$$A_{\\mathrm{overlap}} = 0$$\nThe normalized flux is $F = 1 - 0/\\pi = 1$.\n\n**2. Full Overlap (Containment): $z \\le |1 - p|$**\nOne circle is entirely contained within the other, or they are internally tangent. The distance between centers is less than or equal to the difference of the radii. The overlap area is the area of the smaller circle.\n- If $p \\le 1$ (planet smaller than or same size as the star), the smaller circle is the planet. The condition is $z \\le 1-p$.\n  $$A_{\\mathrm{overlap}} = \\pi p^2$$\n  The flux is $F = 1 - (\\pi p^2)/\\pi = 1 - p^2$.\n- If $p  1$ (planet larger than the star), the smaller circle is the star. The condition is $z \\le p-1$.\n  $$A_{\\mathrm{overlap}} = \\pi (1)^2 = \\pi$$\n  The flux is $F = 1 - \\pi/\\pi = 0$.\n\n**3. Partial Overlap: $|1 - p|  z  1 + p$**\nThe circles intersect at two points. The overlap area is given by the formula derived above:\n$$A_{\\mathrm{overlap}} = \\arccos\\left(\\frac{1+z^2-p^2}{2z}\\right) + p^2 \\arccos\\left(\\frac{p^2+z^2-1}{2pz}\\right) - \\frac{1}{2}\\sqrt{(-z+p+1)(z+p-1)(z-p+1)(z+p+1)}$$\nThe flux is $F = 1 - A_{\\mathrm{overlap}}/\\pi$.\n\n**Algorithm Design and Numerical Stability**\nThe algorithm directly implements the three cases. Careful implementation is required to ensure numerical stability at the boundaries between cases ($z = 1+p$ and $z = |1-p|$), where arguments to inverse trigonometric functions approach $\\pm 1$ and arguments to square roots approach $0$.\n\n- **Case Logic**: The algorithm must first check the boundary conditions to select the correct formula:\n  1. If $z \\ge 1 + p$, use the 'No Overlap' formula.\n  2. If $z \\le |1 - p|$, use the 'Full Overlap' formula, branching on whether $p \\le 1$ or $p  1$.\n  3. Otherwise, use the 'Partial Overlap' formula.\n\n- **Avoiding Division by Zero**:\n  - The partial overlap formula contains $z$ and $p$ in denominators.\n  - If $z=0$, this falls into the full overlap case ($0 \\le |1-p|$ for $p \\ne 1$), so the partial overlap formula is not used.\n  - If $p=0$, the planet has zero radius, so $A_{\\mathrm{overlap}}=0$ and $F=1$. This can be handled as a special case at the beginning of the algorithm.\n\n- **Numerical Precision at Boundaries**:\n  - Near the boundaries, floating-point inaccuracies can cause the arguments to `arccos` to fall slightly outside the valid domain of $[-1, 1]$. To prevent `NaN` results, these arguments must be clamped to the range $[-1, 1]$.\n  - Similarly, the argument of the square root, which is mathematically guaranteed to be non-negative in the partial overlap regime, can become a small negative number due to rounding errors near the boundaries. This argument must be clamped to be non-negative (e.g., `max(0.0, arg)`).\n\nThe full algorithm proceeds as follows:\nInput parameters $p \\ge 0$ and $z \\ge 0$.\n1. Handle the trivial case: if $p=0$, return $F=1$.\n2. Compare $z$ with $1+p$ and $|1-p|$ to determine the geometric case.\n3. Apply the corresponding formula for $A_{\\mathrm{overlap}}$.\n4. For the partial overlap case, apply the numerical clamping safeguards described above before evaluating `arccos` and `sqrt`.\n5. Compute the final normalized flux $F = 1 - A_{\\mathrm{overlap}}/\\pi$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the normalized stellar flux for a set of test cases\n    based on the geometric model of a planetary transit.\n    \"\"\"\n\n    test_cases = [\n        # (p, z) pairs\n        (0.1, 2.0),\n        (0.1, 1.1),\n        (0.1, 1.099999999999),\n        (0.1, 0.9),\n        (0.1, 0.900000000001),\n        (0.1, 0.899999999999),\n        (1.0, 0.0),\n        (1.0, 1.9999),\n        (0.0, 0.5),\n        (0.5, 1.5),\n    ]\n\n    results = []\n    for p, z in test_cases:\n        flux = compute_flux(p, z)\n        results.append(flux)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_flux(p, z):\n    \"\"\"\n    Computes the normalized stellar flux for a planetary transit.\n\n    The star is a uniformly bright disk of unit radius. The planet is a\n    uniformly opaque disk.\n\n    Args:\n        p (float): The planet-to-star radius ratio (Rp / R*).\n        z (float): The projected separation between centers in units of R*.\n\n    Returns:\n        float: The normalized stellar flux F.\n    \"\"\"\n    # Trivial case: zero-radius planet. Flux is always 1.\n    if p == 0.0:\n        return 1.0\n\n    # Ensure z is non-negative, as per definition.\n    z = abs(z)\n\n    # Case 1: No overlap. The circles are separate.\n    # z = 1 + p\n    if z = 1.0 + p:\n        return 1.0\n\n    # Case 2: Full overlap. One circle is contained within the other.\n    # z = |1 - p|\n    if z = abs(1.0 - p):\n        if p = 1.0:\n            # The planet is fully within the star.\n            return 1.0 - p**2\n        else:\n            # The star is fully occulted by the larger planet.\n            return 0.0\n\n    # Case 3: Partial overlap.\n    # |1 - p|  z  1 + p\n    # The division-by-zero for z=0 is avoided by the full overlap case.\n    # The division-by-zero for p=0 is avoided by the initial check.\n    \n    # Arguments for the arccos functions\n    c1_arg = (1.0 + z**2 - p**2) / (2.0 * z)\n    c2_arg = (p**2 + z**2 - 1.0) / (2.0 * p * z)\n\n    # Clamp arguments to the valid domain of arccos: [-1, 1] for stability.\n    c1_arg = np.clip(c1_arg, -1.0, 1.0)\n    c2_arg = np.clip(c2_arg, -1.0, 1.0)\n\n    # Angles of the circular sectors\n    k1 = np.arccos(c1_arg)\n    k0 = np.arccos(c2_arg)\n\n    # The argument of the square root is proportional to the area of the\n    # triangle with sides 1, p, and z. This form is numerically stable.\n    sqrt_arg = (-z + p + 1.0) * (z + p - 1.0) * (z - p + 1.0) * (z + p + 1.0)\n    \n    # Clamp argument to be non-negative for sqrt.\n    sqrt_arg = np.maximum(0.0, sqrt_arg)\n    \n    # Overlap area formula for partial transit\n    A_overlap = k1 + p**2 * k0 - 0.5 * np.sqrt(sqrt_arg)\n    \n    # Normalized flux\n    F = 1.0 - A_overlap / np.pi\n    \n    return F\n\nsolve()\n```"
        },
        {
            "introduction": "Real stars are not uniformly bright; they appear darker toward their edges, a phenomenon known as limb darkening. This practice moves beyond the simple 'small planet' approximation to explore how this intensity gradient, combined with the planet's finite size, affects the transit depth. By using a Taylor expansion to derive a higher-order correction to the flux decrement, you will gain a deeper analytical understanding of the subtle curvatures in a realistic light curve .",
            "id": "4186783",
            "problem": "Consider a star of radius $R_{\\star}$ with a radially symmetric specific intensity profile $I(\\mu)$ following a linear limb-darkening law $I(\\mu) = I_{0}\\left(1 - u\\left(1 - \\mu\\right)\\right)$, where $I_{0}$ is the specific intensity at the stellar center, $u$ is the linear limb-darkening coefficient, and $\\mu = \\sqrt{1 - \\rho^{2}}$ with $\\rho = r/R_{\\star}$ the projected radial coordinate in units of $R_{\\star}$. A planet of radius $R_{p}$ ($k \\equiv R_{p}/R_{\\star} \\ll 1$) transits the star such that, at a given time, the center of the planetary disk projects to a point at $\\rho$ on the stellar disk. Assume the planet disk lies entirely within the stellar disk (i.e., $\\rho \\leq 1 - k$) so that the occulted region is a full circular disk.\n\nStarting from the definition of the flux decrement as the overlap integral of the stellar intensity over the area occulted by the planet, and using a Taylor expansion of $I$ about the planet center in the plane-of-sky two-dimensional (2D) coordinates, derive the first non-vanishing correction beyond the Small Planet Approximation (SPA) that accounts for finite $R_{p}$ curvature effects. Express the normalized flux decrement $\\delta f(\\rho)$, defined as the occulted flux divided by the total unobscured stellar flux, to order $k^{4}$ in closed form for the linear limb-darkening law specified above.\n\nYour final answer must be a single analytic expression for $\\delta f(\\rho)$ in terms of $k$, $u$, and $\\mu$, valid up to and including terms of order $k^{4}$. No numerical evaluation or rounding is required, and the result must be dimensionless.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of radiative transfer and celestial mechanics, is well-posed with a clear objective and sufficient constraints, and is expressed in objective, formal language. It presents a standard, non-trivial problem in the modeling of exoplanet transits.\n\nThe normalized flux decrement, $\\delta f(\\rho)$, is defined as the ratio of the flux occulted by the planet, $\\Delta F$, to the total unobscured flux from the star, $F_{\\star}$.\n$$\n\\delta f(\\rho) = \\frac{\\Delta F}{F_{\\star}}\n$$\nWe will first calculate the total stellar flux, $F_{\\star}$, and then the occulted flux, $\\Delta F$, to the required order of accuracy.\n\nThe total flux $F_{\\star}$ is obtained by integrating the specific intensity $I(\\rho)$ over the projected disk of the star. Using the projected radial coordinate $\\rho = r/R_{\\star}$, the surface element is $dS = r dr d\\phi = R_{\\star}^2 \\rho d\\rho d\\phi$.\n$$\nF_{\\star} = \\int_{0}^{2\\pi} \\int_{0}^{R_{\\star}} I(r/R_{\\star}) r dr d\\phi = 2\\pi R_{\\star}^2 \\int_{0}^{1} I(\\rho) \\rho d\\rho\n$$\nThe stellar intensity is given by the linear limb-darkening law $I(\\rho) = I_{0}\\left(1 - u\\left(1 - \\mu\\right)\\right)$, where $\\mu = \\sqrt{1 - \\rho^{2}}$.\nSubstituting this into the integral for $F_{\\star}$:\n$$\nF_{\\star} = 2\\pi R_{\\star}^2 I_{0} \\int_{0}^{1} \\left[1 - u\\left(1 - \\sqrt{1 - \\rho^{2}}\\right)\\right] \\rho d\\rho\n$$\n$$\nF_{\\star} = 2\\pi R_{\\star}^2 I_{0} \\left[ (1-u) \\int_{0}^{1} \\rho d\\rho + u \\int_{0}^{1} \\rho\\sqrt{1-\\rho^2} d\\rho \\right]\n$$\nThe integrals evaluate to:\n$$\n\\int_{0}^{1} \\rho d\\rho = \\left[\\frac{\\rho^2}{2}\\right]_{0}^{1} = \\frac{1}{2}\n$$\n$$\n\\int_{0}^{1} \\rho\\sqrt{1-\\rho^2} d\\rho = \\left[-\\frac{1}{3}(1-\\rho^2)^{3/2}\\right]_{0}^{1} = \\frac{1}{3}\n$$\nThus, the total stellar flux is:\n$$\nF_{\\star} = 2\\pi R_{\\star}^2 I_{0} \\left( \\frac{1-u}{2} + \\frac{u}{3} \\right) = 2\\pi R_{\\star}^2 I_{0} \\left( \\frac{3-3u+2u}{6} \\right) = \\pi R_{\\star}^2 I_{0} \\left(1 - \\frac{u}{3}\\right)\n$$\n\nNext, we calculate the occulted flux, $\\Delta F$. This is the integral of the stellar intensity over the area of the planet's disk. The planet has radius $R_p$ and its center is at a projected distance $r_p = \\rho R_{\\star}$ from the star's center. We can set up a local Cartesian coordinate system $(\\xi, \\eta)$ centered on the planet's disk. The position of a point within the planet's disk relative to the star's center is $\\mathbf{r}' = \\mathbf{r}_p + \\mathbf{s}$, where $\\mathbf{s} = (\\xi, \\eta)$ and $\\xi^2 + \\eta^2 \\leq R_p^2$.\n$$\n\\Delta F = \\iint_{\\xi^2+\\eta^2 \\leq R_p^2} I(\\mathbf{r}_p + \\mathbf{s}) d\\xi d\\eta\n$$\nFor a small planet ($R_p \\ll R_{\\star}$), we can Taylor-expand the intensity function $I$ around the planet's center $\\mathbf{r}_p$:\n$$\nI(\\mathbf{r}_p + \\mathbf{s}) \\approx I(\\mathbf{r}_p) + (\\mathbf{s} \\cdot \\nabla)I(\\mathbf{r}_p) + \\frac{1}{2!}(\\mathbf{s} \\cdot \\nabla)^2 I(\\mathbf{r}_p) + O(|\\mathbf{s}|^3)\n$$\nThe occulted flux is the integral of this expansion over the planet's disk, which has area $A_p = \\pi R_p^2$. Due to the circular symmetry of the integration domain, all terms with odd powers of $\\xi$ or $\\eta$ integrate to zero.\n$$\n\\Delta F = \\iint_{A_p} I(\\mathbf{r}_p) dS + \\frac{1}{2} \\iint_{A_p} \\left(\\xi^2 \\frac{\\partial^2 I}{\\partial x^2} + \\eta^2 \\frac{\\partial^2 I}{\\partial y^2} + 2\\xi\\eta \\frac{\\partial^2 I}{\\partial x\\partial y}\\right)_{\\mathbf{r}_p} d\\xi d\\eta + O(R_p^6)\n$$\nThe required integrals over the disk are:\n$$\n\\iint_{A_p} d\\xi d\\eta = \\pi R_p^2, \\quad \\iint_{A_p} \\xi^2 d\\xi d\\eta = \\iint_{A_p} \\eta^2 d\\xi d\\eta = \\frac{\\pi R_p^4}{4}, \\quad \\iint_{A_p} \\xi\\eta d\\xi d\\eta = 0\n$$\nSubstituting these into the expression for $\\Delta F$:\n$$\n\\Delta F = I(\\mathbf{r}_p)(\\pi R_p^2) + \\frac{1}{2} \\left( \\frac{\\partial^2 I}{\\partial x^2}\\bigg|_{\\mathbf{r}_p} \\frac{\\pi R_p^4}{4} + \\frac{\\partial^2 I}{\\partial y^2}\\bigg|_{\\mathbf{r}_p} \\frac{\\pi R_p^4}{4} \\right) + O(R_p^6)\n$$\nThis simplifies to:\n$$\n\\Delta F = \\pi R_p^2 I(\\mathbf{r}_p) + \\frac{\\pi R_p^4}{8} \\nabla^2 I(\\mathbf{r}_p) + O(R_p^6)\n$$\nwhere $\\nabla^2 I$ is the Laplacian of the intensity, evaluated at the planet's center. The first term corresponds to the Small Planet Approximation (SPA), and the second term is the first non-vanishing correction.\n\nWe now need to calculate $I(\\rho)$ and $\\nabla^2 I(\\rho)$. The intensity is $I(\\rho) = I_0(1-u+u\\mu)$, with $\\mu=\\sqrt{1-\\rho^2}$.\nThe Laplacian in 2D polar coordinates $(r, \\phi)$ for a radially symmetric function is $\\nabla^2 I = \\frac{1}{r}\\frac{d}{dr}\\left(r\\frac{dI}{dr}\\right)$. Using $\\rho=r/R_{\\star}$, we have $d/dr = (1/R_{\\star})d/d\\rho$, so $\\nabla^2 I = \\frac{1}{R_{\\star}^2 \\rho}\\frac{d}{d\\rho}\\left(\\rho\\frac{dI}{d\\rho}\\right)$.\n\nLet's compute the derivatives of $I$ with respect to $\\rho$:\n$$\n\\frac{dI}{d\\rho} = \\frac{d}{d\\rho} \\left[ I_0(1-u+u\\sqrt{1-\\rho^2}) \\right] = I_0 u \\frac{-2\\rho}{2\\sqrt{1-\\rho^2}} = -I_0 u \\frac{\\rho}{\\sqrt{1-\\rho^2}} = -I_0 u \\frac{\\rho}{\\mu}\n$$\nThen, $\\rho \\frac{dI}{d\\rho} = -I_0 u \\frac{\\rho^2}{\\mu}$. Differentiating again:\n$$\n\\frac{d}{d\\rho}\\left(\\rho\\frac{dI}{d\\rho}\\right) = -I_0 u \\frac{d}{d\\rho}\\left(\\frac{\\rho^2}{\\sqrt{1-\\rho^2}}\\right) = -I_0 u \\left( \\frac{2\\rho\\sqrt{1-\\rho^2} - \\rho^2 \\frac{-\\rho}{\\sqrt{1-\\rho^2}}}{1-\\rho^2} \\right)\n$$\n$$\n= -I_0 u \\left( \\frac{2\\rho(1-\\rho^2) + \\rho^3}{(1-\\rho^2)^{3/2}} \\right) = -I_0 u \\frac{2\\rho - \\rho^3}{(1-\\rho^2)^{3/2}} = -I_0 u \\frac{\\rho(2-\\rho^2)}{\\mu^3}\n$$\nThe Laplacian is therefore:\n$$\n\\nabla^2 I(\\rho) = \\frac{1}{R_{\\star}^2 \\rho} \\left( -I_0 u \\frac{\\rho(2-\\rho^2)}{\\mu^3} \\right) = -\\frac{I_0 u}{R_{\\star}^2} \\frac{2-\\rho^2}{\\mu^3}\n$$\nNow substitute $I(\\rho)$ and $\\nabla^2 I(\\rho)$ into the expression for $\\Delta F$, using $R_p = k R_{\\star}$:\n$$\n\\Delta F = \\pi (kR_{\\star})^2 I_0(1-u+u\\mu) + \\frac{\\pi (kR_{\\star})^4}{8} \\left( -\\frac{I_0 u}{R_{\\star}^2} \\frac{2-\\rho^2}{\\mu^3} \\right)\n$$\n$$\n\\Delta F = \\pi R_{\\star}^2 I_0 \\left[ k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{2-\\rho^2}{\\mu^3} \\right]\n$$\nFinally, we compute the normalized flux decrement $\\delta f(\\rho) = \\Delta F / F_{\\star}$:\n$$\n\\delta f(\\rho) = \\frac{\\pi R_{\\star}^2 I_0 \\left[ k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{2-\\rho^2}{\\mu^3} \\right]}{\\pi R_{\\star}^2 I_{0} \\left(1 - \\frac{u}{3}\\right)}\n$$\n$$\n\\delta f(\\rho) = \\frac{k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{2-\\rho^2}{\\mu^3}}{1 - \\frac{u}{3}}\n$$\nTo express this solely in terms of $k$, $u$, and $\\mu$, we substitute $\\rho^2 = 1-\\mu^2$:\n$$\n\\delta f(\\rho) = \\frac{k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{2-(1-\\mu^2)}{\\mu^3}}{1 - \\frac{u}{3}}\n$$\n$$\n\\delta f(\\rho) = \\frac{k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{1+\\mu^2}{\\mu^3}}{1 - \\frac{u}{3}}\n$$\nThis is the full expression for the normalized flux decrement to order $k^4$.",
            "answer": "$$\n\\boxed{\\frac{k^2(1-u+u\\mu) - \\frac{k^4 u}{8} \\frac{1+\\mu^2}{\\mu^3}}{1 - \\frac{u}{3}}}\n$$"
        },
        {
            "introduction": "A perfect theoretical model is only useful if we understand how it relates to actual measurements, which are subject to instrumental effects. This exercise focuses on a key observational reality: finite exposure times, where flux is averaged over a specific duration, $\\Delta t$. You will derive the first-order timing offset this averaging introduces, providing a crucial insight into how instrumental characteristics systematically alter the observed shape and timing of a transit light curve .",
            "id": "4186706",
            "problem": "Consider a transiting exoplanet observed by a photometric instrument that performs finite-duration integrations. Let the true, instantaneous stellar flux during transit be a differentiable function of time, denoted by $F_{\\mathrm{true}}(t)$. Define a specific contact time $t_{c}$ (for example, first contact) implicitly by the condition $F_{\\mathrm{true}}(t_{c}) = F_{c}$, where $F_{c}$ is a chosen reference flux level associated with that contact from transit geometry (for instance, the level at which the stellar limb is just touched by the planetary disk, as defined by the transit model including limb darkening).\n\nThe instrument reports for each exposure a single timestamp $t_{s}$ equal to the start-of-exposure time, and a measured flux that is the average over the exposure window of duration $\\Delta t$. Thus the measured flux is\n$$\nF_{\\mathrm{obs}}(t_{s}) = \\frac{1}{\\Delta t} \\int_{t_{s}}^{t_{s} + \\Delta t} F_{\\mathrm{true}}(\\tau)\\, d\\tau.\n$$\nThe measured contact time $t_{\\mathrm{meas}}$ is defined operationally as the timestamp $t_{s}$ at which the reported $F_{\\mathrm{obs}}(t_{s})$ first equals the reference level $F_{c}$.\n\nStarting from the above definitions and the transit light-curve geometry near contact, assume that near $t_{c}$ the function $F_{\\mathrm{true}}(t)$ can be approximated to leading order by a linear expansion,\n$$\nF_{\\mathrm{true}}(t) \\approx F_{c} + S\\,(t - t_{c}),\n$$\nwhere $S = \\left.\\frac{d F_{\\mathrm{true}}}{dt}\\right|_{t = t_{c}}$ is finite and nonzero, and higher-order curvature terms are neglected. Using only this local approximation and the finite-exposure averaging definition, derive the first-order correction $\\delta t = t_{\\mathrm{meas}} - t_{c}$ in terms of the cadence $\\Delta t$.\n\nExpress your final answer as a single closed-form analytic expression in seconds. No numerical substitution is required and no rounding is required.",
            "solution": "The problem asks for the first-order correction $\\delta t = t_{\\mathrm{meas}} - t_{c}$ between the measured contact time and the true contact time, given the effects of a finite exposure duration $\\Delta t$. We are provided with the definitions of the observed flux, the true contact time, the measured contact time, and a linear approximation for the true flux near the contact point.\n\nThe observed flux $F_{\\mathrm{obs}}(t_{s})$ is defined as the time-average of the true flux $F_{\\mathrm{true}}(t)$ over an exposure interval of duration $\\Delta t$ starting at time $t_{s}$:\n$$F_{\\mathrm{obs}}(t_{s}) = \\frac{1}{\\Delta t} \\int_{t_{s}}^{t_{s} + \\Delta t} F_{\\mathrm{true}}(\\tau)\\, d\\tau.$$\nNear the true contact time $t_{c}$, the true flux is approximated by a linear function:\n$$F_{\\mathrm{true}}(t) \\approx F_{c} + S\\,(t - t_{c}),$$\nwhere $F_{c} = F_{\\mathrm{true}}(t_{c})$ is the reference flux at the contact time, and $S = \\left.\\frac{d F_{\\mathrm{true}}}{dt}\\right|_{t = t_{c}}$ is the slope of the light curve at that instant, which is assumed to be finite and non-zero.\n\nTo find the observed flux, we substitute the linear approximation of $F_{\\mathrm{true}}(t)$ into the integral definition of $F_{\\mathrm{obs}}(t_{s})$:\n$$F_{\\mathrm{obs}}(t_{s}) \\approx \\frac{1}{\\Delta t} \\int_{t_{s}}^{t_{s} + \\Delta t} \\left[ F_{c} + S\\,(\\tau - t_{c}) \\right] d\\tau.$$\nWe can evaluate this integral by separating the terms:\n$$F_{\\mathrm{obs}}(t_{s}) = \\frac{1}{\\Delta t} \\left( \\int_{t_{s}}^{t_{s} + \\Delta t} F_{c}\\,d\\tau + \\int_{t_{s}}^{t_{s} + \\Delta t} S\\,(\\tau - t_{c})\\,d\\tau \\right).$$\nThe first part of the integral is:\n$$\\int_{t_{s}}^{t_{s} + \\Delta t} F_{c}\\,d\\tau = F_{c} [\\tau]_{t_{s}}^{t_{s} + \\Delta t} = F_{c} ((t_{s} + \\Delta t) - t_{s}) = F_{c} \\Delta t.$$\nThe second part of the integral is:\n$$S \\int_{t_{s}}^{t_{s} + \\Delta t} (\\tau - t_{c})\\,d\\tau = S \\left[ \\frac{\\tau^2}{2} - t_{c}\\tau \\right]_{t_{s}}^{t_{s} + \\Delta t} = S \\left( \\left(\\frac{(t_{s} + \\Delta t)^2}{2} - t_{c}(t_{s} + \\Delta t)\\right) - \\left(\\frac{t_{s}^2}{2} - t_{c}t_{s}\\right) \\right).$$\nExpanding and simplifying the terms:\n$$S \\left( \\frac{t_{s}^2 + 2t_{s}\\Delta t + (\\Delta t)^2 - t_{s}^2}{2} - t_{c}(t_{s} + \\Delta t - t_{s}) \\right) = S \\left( \\frac{2t_{s}\\Delta t + (\\Delta t)^2}{2} - t_{c}\\Delta t \\right)$$\n$$= S \\left( t_{s}\\Delta t + \\frac{(\\Delta t)^2}{2} - t_{c}\\Delta t \\right) = S \\Delta t \\left( (t_{s} - t_{c}) + \\frac{\\Delta t}{2} \\right).$$\nSubstituting these results back into the expression for $F_{\\mathrm{obs}}(t_{s})$:\n$$F_{\\mathrm{obs}}(t_{s}) = \\frac{1}{\\Delta t} \\left( F_{c}\\Delta t + S \\Delta t \\left( (t_{s} - t_{c}) + \\frac{\\Delta t}{2} \\right) \\right) = F_{c} + S \\left( (t_{s} - t_{c}) + \\frac{\\Delta t}{2} \\right).$$\nThis equation relates the measured flux at a start time $t_{s}$ to the parameters of the transit model. A useful check of this result is to recognize that the time-average of a linear function over an interval is equal to the function's value at the midpoint of the interval. Our result is equivalent to $F_{\\mathrm{obs}}(t_s) = F_{\\mathrm{true}}(t_s + \\frac{\\Delta t}{2})$, which confirms the integration.\n\nThe measured contact time $t_{\\mathrm{meas}}$ is defined as the specific start-of-exposure time $t_{s}$ for which the observed flux $F_{\\mathrm{obs}}(t_s)$ equals the reference flux $F_{c}$. We find $t_{\\mathrm{meas}}$ by setting $t_s = t_{\\mathrm{meas}}$ and $F_{\\mathrm{obs}}(t_{\\mathrm{meas}}) = F_{c}$:\n$$F_{c} = F_{c} + S \\left( (t_{\\mathrm{meas}} - t_{c}) + \\frac{\\Delta t}{2} \\right).$$\nSubtracting $F_c$ from both sides yields:\n$$0 = S \\left( (t_{\\mathrm{meas}} - t_{c}) + \\frac{\\Delta t}{2} \\right).$$\nSince the slope $S$ is specified to be non-zero, we can divide both sides by $S$:\n$$0 = (t_{\\mathrm{meas}} - t_{c}) + \\frac{\\Delta t}{2}.$$\nThe problem asks for the correction $\\delta t = t_{\\mathrm{meas}} - t_{c}$. Rearranging the equation to solve for this quantity, we obtain:\n$$\\delta t = t_{\\mathrm{meas}} - t_{c} = -\\frac{\\Delta t}{2}.$$\nThis result shows that, to first order, the measured contact time (timestamped at the start of the exposure) precedes the true contact time by half the exposure duration. This timing offset is a direct consequence of averaging the flux over the exposure interval and is independent of the slope of the light curve, as long as the linear approximation holds.",
            "answer": "$$\\boxed{-\\frac{\\Delta t}{2}}$$"
        }
    ]
}