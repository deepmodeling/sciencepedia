{
    "hands_on_practices": [
        {
            "introduction": "对任何凌日系外行星的研究，其基础在于精确测定其轨道周期。这项练习将引导你完成一个基本过程：将线性星历表拟合到一系列带噪声的凌日时间测量数据上。通过应用加权最小二乘法，你不仅将推导出轨道周期和参考凌日时间，还将量化它们的不确定性，这项技能对于预测未来的凌日事件以及进行更高级的分析（如搜索凌日时间变化）至关重要。",
            "id": "4185095",
            "problem": "给定多组通过凌星法观测到的系外行星凌星中点时数据集，其中凌星周期性地重复发生。在线性星历模型下，第 $n$ 次凌星的中点时表示为 $t_n = t_0 + n P$，其中 $t_0$ 是凌星指数 $n=0$ 时的参考中点时，$P$ 是轨道周期。每次观测到的中点时 $t_n$ 都带有一个独立的高斯不确定度 $\\sigma_n$。假设不确定度 $\\sigma_n$ 是已知且准确的。所有时间均以天为单位处理。您需要基于独立高斯噪声的假设，执行加权最小二乘拟合来估计 $P$ 和 $t_0$，计算它们的参数协方差矩阵，并将不确定度传播到指定的未来凌星指数 $m$。\n\n从基本原理出发：线性模型 $t_n = t_0 + n P$、高斯测量误差的定义以及独立测量下加权最小二乘目标的定义。从这些原理推导出 $P$ 和 $t_0$ 的估计量以及参数协方差矩阵。然后，使用线性不确定度传播，推导出在指数 $m$ 处的预测未来凌星时间 $t_m$ 的不确定度。\n\n实现一个程序，对每个提供的测试用例计算以下内容：\n- 拟合的轨道周期 $P$（单位：天）。\n- 拟合的参考中点时 $t_0$（单位：天）。\n- $P$ 的一倍标准差不确定度，记为 $\\sigma_P$（单位：天）。\n- $t_0$ 的一倍标准差不确定度，记为 $\\sigma_{t_0}$（单位：天）。\n- $t_0$ 和 $P$ 之间的协方差，记为 $\\mathrm{Cov}(t_0,P)$（单位：天$^2$）。\n- 在指定的未来凌星指数 $m$ 处的预测未来中点时 $t_m$（单位：天）。\n- $t_m$ 的一倍标准差不确定度，记为 $\\sigma_{t_m}$（单位：天）。\n\n所有输出必须以天为单位表示，并四舍五入到六位小数。角度单位不适用。不要使用百分比；所有不确定度必须是数值浮点数。\n\n使用以下测试套件，其中每个测试用例提供凌星指数 $n$ 的列表、对应的观测中点时 $t$（单位：天）、对应的不确定度 $\\sigma$（单位：天）以及用于预测的未来指数 $m$：\n\n- 测试用例 1（通用、采样良好、异方差）：\n  - $n = [\\,0,\\,1,\\,2,\\,3,\\,4,\\,5,\\,6,\\,7\\,]$\n  - $t = [\\,2457000.123756,\\,2457003.64770459,\\,2457007.17305318,\\,2457010.69770177,\\,2457014.22225036,\\,2457017.74759895,\\,2457021.27184754,\\,2457024.79689613\\,]$\n  - $\\sigma = [\\,0.0010,\\,0.0012,\\,0.0009,\\,0.0011,\\,0.0010,\\,0.0008,\\,0.0013,\\,0.0009\\,]$\n  - $m = 20$\n\n- 测试用例 2（边界情况，恰好两次观测，指数间隔大）：\n  - $n = [\\,0,\\,10\\,]$\n  - $t = [\\,2458000.0001,\\,2458012.34547\\,]$\n  - $\\sigma = [\\,0.0003,\\,0.0005\\,]$\n  - $m = 25$\n\n- 测试用例 3（边缘情况，有一个离群值且具有相应较大的不确定度）：\n  - $n = [\\,0,\\,1,\\,2,\\,3,\\,4\\,]$\n  - $t = [\\,50000.002,\\,50000.799,\\,50001.65,\\,50002.4,\\,50003.198\\,]$\n  - $\\sigma = [\\,0.001,\\,0.001,\\,0.05,\\,0.0015,\\,0.001\\,]$\n  - $m = 10$\n\n- 测试用例 4（权重不均且采样不规则）：\n  - $n = [\\,0,\\,5,\\,6,\\,12,\\,13\\,]$\n  - $t = [\\,1000.0003,\\,1009.9999,\\,1012.0002,\\,1024.0,\\,1025.9985\\,]$\n  - $\\sigma = [\\,0.01,\\,0.0002,\\,0.0002,\\,0.0003,\\,0.005\\,]$\n  - $m = 50$\n\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，并用方括号括起来的结果。对于每个测试用例，按 $[\\,P,\\,t_0,\\,\\sigma_P,\\,\\sigma_{t_0},\\,\\mathrm{Cov}(t_0,P),\\,t_m,\\,\\sigma_{t_m}\\,]$ 的顺序输出一个包含七个浮点数的列表，四舍五入到六位小数。因此，最终输出必须是一个聚合了四个用例列表的单一列表，例如：$[\\,[p_1, t0_1, \\ldots],\\,[p_2, t0_2, \\ldots],\\,[p_3, t0_3, \\ldots],\\,[p_4, t0_4, \\ldots]\\,]$。",
            "solution": "我们在线性星历模型下对观测到的凌星中点时进行建模。确定性模型为 $t_n = t_0 + n P$，其中 $t_0$ 是凌星指数 $n=0$ 时的凌星中点时，$P$ 是轨道周期。观测值为 $t_n^{\\mathrm{obs}}$，其独立高斯误差的已知标准差为 $\\sigma_n$。在独立高斯误差下，似然函数为\n$$\n\\mathcal{L}(t_0,P) = \\prod_{n} \\frac{1}{\\sqrt{2\\pi}\\,\\sigma_n} \\exp\\left( -\\frac{(t_n^{\\mathrm{obs}} - t_0 - n P)^2}{2\\sigma_n^2} \\right).\n$$\n最大化似然等价于最小化加权残差平方和，\n$$\nS(t_0,P) = \\sum_n w_n \\left( t_n^{\\mathrm{obs}} - t_0 - n P \\right)^2,\n$$\n其中 $w_n = 1/\\sigma_n^2$ 是与每次观测相关的权重。\n\n为线性模型引入设计矩阵。对于每个观测指数 $n$，定义回归向量 $\\boldsymbol{x}_n = [\\,1,\\,n\\,]^\\top$ 和参数向量 $\\boldsymbol{\\beta} = [\\,t_0,\\,P\\,]^\\top$。模型为 $t_n^{\\mathrm{obs}} \\approx \\boldsymbol{x}_n^\\top \\boldsymbol{\\beta}$。加权最小二乘正规方程组由下式给出\n$$\n\\left( \\sum_n w_n \\boldsymbol{x}_n \\boldsymbol{x}_n^\\top \\right) \\hat{\\boldsymbol{\\beta}} = \\sum_n w_n t_n^{\\mathrm{obs}} \\boldsymbol{x}_n,\n$$\n我们可以使用加权和明确地写出。定义以下加权和：\n$$\nS_{00} = \\sum_n w_n, \\quad S_{01} = \\sum_n w_n n, \\quad S_{11} = \\sum_n w_n n^2,\n$$\n以及加权数据和\n$$\nY_0 = \\sum_n w_n t_n^{\\mathrm{obs}}, \\quad Y_1 = \\sum_n w_n n t_n^{\\mathrm{obs}}.\n$$\n则正规矩阵为\n$$\n\\boldsymbol{S} = \\begin{bmatrix} S_{00}  S_{01} \\\\ S_{01}  S_{11} \\end{bmatrix}, \\quad \\boldsymbol{y} = \\begin{bmatrix} Y_0 \\\\ Y_1 \\end{bmatrix}.\n$$\n加权最小二乘估计量为\n$$\n\\hat{\\boldsymbol{\\beta}} = \\boldsymbol{S}^{-1} \\boldsymbol{y}.\n$$\n令 $D = S_{00} S_{11} - S_{01}^2$ 表示 $\\boldsymbol{S}$ 的行列式。$2\\times 2$ 矩阵 $\\boldsymbol{S}$ 的逆矩阵是\n$$\n\\boldsymbol{S}^{-1} = \\frac{1}{D} \\begin{bmatrix} S_{11}  -S_{01} \\\\ -S_{01}  S_{00} \\end{bmatrix}.\n$$\n因此，参数估计值为\n$$\n\\hat{t}_0 = \\frac{Y_0 S_{11} - Y_1 S_{01}}{D}, \\quad \\hat{P} = \\frac{Y_1 S_{00} - Y_0 S_{01}}{D}.\n$$\n\n在测量方差 $\\sigma_n^2$ 已知且指定正确的假设下，参数协方差矩阵由费雪信息的逆矩阵给出，对于加权最小二乘法，这等于正规矩阵的逆矩阵：\n$$\n\\mathrm{Cov}(\\hat{\\boldsymbol{\\beta}}) = \\boldsymbol{S}^{-1} = \\begin{bmatrix} \\mathrm{Var}(\\hat{t}_0)  \\mathrm{Cov}(\\hat{t}_0,\\hat{P}) \\\\ \\mathrm{Cov}(\\hat{t}_0,\\hat{P})  \\mathrm{Var}(\\hat{P}) \\end{bmatrix} = \\frac{1}{D} \\begin{bmatrix} S_{11}  -S_{01} \\\\ -S_{01}  S_{00} \\end{bmatrix}.\n$$\n因此，\n$$\n\\sigma_{t_0} = \\sqrt{\\mathrm{Var}(\\hat{t}_0)} = \\sqrt{\\frac{S_{11}}{D}}, \\quad \\sigma_P = \\sqrt{\\mathrm{Var}(\\hat{P})} = \\sqrt{\\frac{S_{00}}{D}}, \\quad \\mathrm{Cov}(\\hat{t}_0,\\hat{P}) = -\\frac{S_{01}}{D}.\n$$\n\n要预测指数为 $m$ 的未来凌星中点时，我们使用线性模型\n$$\n\\hat{t}_m = \\hat{t}_0 + m \\hat{P}.\n$$\n对于联合高斯参数估计的线性不确定度传播，$\\hat{t}_m$ 的方差为\n$$\n\\mathrm{Var}(\\hat{t}_m) = \\begin{bmatrix} 1  m \\end{bmatrix} \\mathrm{Cov}(\\hat{\\boldsymbol{\\beta}}) \\begin{bmatrix} 1 \\\\ m \\end{bmatrix} = \\mathrm{Var}(\\hat{t}_0) + 2 m \\,\\mathrm{Cov}(\\hat{t}_0,\\hat{P}) + m^2 \\,\\mathrm{Var}(\\hat{P}).\n$$\n因此，\n$$\n\\sigma_{t_m} = \\sqrt{\\mathrm{Var}(\\hat{t}_m)}.\n$$\n\n每个测试用例的算法步骤：\n1. 取数组 $n$、$t$ 和 $\\sigma$，计算权重 $w_n = 1/\\sigma_n^2$。\n2. 通过加权和计算 $S_{00}$、$S_{01}$、$S_{11}$、$Y_0$ 和 $Y_1$。\n3. 计算 $D = S_{00} S_{11} - S_{01}^2$ 并使用上述公式求解 $\\hat{t}_0$ 和 $\\hat{P}$。\n4. 从 $\\boldsymbol{S}^{-1}$ 计算协方差矩阵元素 $\\mathrm{Var}(\\hat{t}_0)$、$\\mathrm{Var}(\\hat{P})$ 和 $\\mathrm{Cov}(\\hat{t}_0,\\hat{P})$。\n5. 对于指定的未来指数 $m$，计算 $\\hat{t}_m = \\hat{t}_0 + m \\hat{P}$ 和 $\\sigma_{t_m}$，使用线性传播公式。\n6. 将所有输出四舍五入到六位小数，并返回列表 $[\\,\\hat{P},\\,\\hat{t}_0,\\,\\sigma_P,\\,\\sigma_{t_0},\\,\\mathrm{Cov}(\\hat{t}_0,\\hat{P}),\\,\\hat{t}_m,\\,\\sigma_{t_m}\\,]$。\n7. 将所有测试用例的结果聚合成一个单一列表，并按规定格式单行打印。\n\n该方法在科学上基于独立高斯噪声下的线性模型的最大似然估计和标准线性误差传播，这些方法在行星科学和系外行星凌星时间分析建模中经过了充分检验并被广泛接受。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef weighted_linear_fit(n, t, sigma):\n    \"\"\"\n    Perform weighted least-squares fit for t_n = t0 + n * P.\n    Returns estimates: P, t0, and covariance matrix elements C00, C01, C11 where\n    Cov([t0, P]) = [[C00, C01],\n                    [C01, C11]]\n    \"\"\"\n    n = np.asarray(n, dtype=float)\n    t = np.asarray(t, dtype=float)\n    sigma = np.asarray(sigma, dtype=float)\n    w = 1.0 / (sigma ** 2)\n\n    # Weighted sums for normal equations\n    S00 = np.sum(w)\n    S01 = np.sum(w * n)\n    S11 = np.sum(w * n * n)\n    Y0 = np.sum(w * t)\n    Y1 = np.sum(w * n * t)\n\n    D = S00 * S11 - S01 * S01\n    if D == 0.0:\n        raise ValueError(\"Normal matrix is singular or ill-conditioned (non-positive determinant).\")\n\n    # Parameter estimates\n    t0_hat = (Y0 * S11 - Y1 * S01) / D\n    P_hat = (Y1 * S00 - Y0 * S01) / D\n\n    # Covariance matrix elements (since Cov = (X^T W X)^-1 for known variances)\n    C00 = S11 / D           # Var(t0)\n    C01 = -S01 / D          # Cov(t0, P)\n    C11 = S00 / D           # Var(P)\n\n    return P_hat, t0_hat, C00, C01, C11\n\ndef propagate_prediction(t0_hat, P_hat, C00, C01, C11, m):\n    \"\"\"\n    Predict future transit time and its uncertainty for index m.\n    Returns t_pred, sigma_t_pred.\n    \"\"\"\n    t_pred = t0_hat + m * P_hat\n    var_pred = C00 + 2.0 * m * C01 + (m ** 2) * C11\n    # Numerical safety: variance should be non-negative; clamp small negatives due to rounding\n    if var_pred  0 and var_pred > -1e-18:\n        var_pred = 0.0\n    sigma_pred = np.sqrt(var_pred)\n    return t_pred, sigma_pred\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        (\n            [0, 1, 2, 3, 4, 5, 6, 7],\n            [2457000.123756, 2457003.64770459, 2457007.17305318, 2457010.69770177,\n             2457014.22225036, 2457017.74759895, 2457021.27184754, 2457024.79689613],\n            [0.0010, 0.0012, 0.0009, 0.0011, 0.0010, 0.0008, 0.0013, 0.0009],\n            20\n        ),\n        # Test case 2\n        (\n            [0, 10],\n            [2458000.0001, 2458012.34547],\n            [0.0003, 0.0005],\n            25\n        ),\n        # Test case 3\n        (\n            [0, 1, 2, 3, 4],\n            [50000.002, 50000.799, 50001.65, 50002.4, 50003.198],\n            [0.001, 0.001, 0.05, 0.0015, 0.001],\n            10\n        ),\n        # Test case 4\n        (\n            [0, 5, 6, 12, 13],\n            [1000.0003, 1009.9999, 1012.0002, 1024.0, 1025.9985],\n            [0.01, 0.0002, 0.0002, 0.0003, 0.005],\n            50\n        ),\n    ]\n\n    results = []\n    for n, t, sigma, m in test_cases:\n        P_hat, t0_hat, C00, C01, C11 = weighted_linear_fit(n, t, sigma)\n        sigma_P = np.sqrt(C11)\n        sigma_t0 = np.sqrt(C00)\n        cov_t0P = C01\n        t_pred, sigma_t_pred = propagate_prediction(t0_hat, P_hat, C00, C01, C11, m)\n\n        # Round to six decimal places as specified\n        formatted = [\n            f\"{P_hat:.6f}\",\n            f\"{t0_hat:.6f}\",\n            f\"{sigma_P:.6f}\",\n            f\"{sigma_t0:.6f}\",\n            f\"{cov_t0P:.6f}\",\n            f\"{t_pred:.6f}\",\n            f\"{sigma_t_pred:.6f}\",\n        ]\n        results.append(f\"[{','.join(formatted)}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "精确测量行星半径依赖于对凌日深度的正确解读，但主星自身的特征会引入显著的偏差。这项练习深入探讨了一种最常见的系统性效应：未被遮挡的星斑。你将推导并量化恒星表面上这些更冷、更暗的区域，在未被行星遮挡时，如何改变恒星的总流量，从而导致对凌日深度的过高估计，这揭示了恒星活动与系外行星特征描述之间的关键联系。",
            "id": "4185160",
            "problem": "一颗半径为 $R_{\\star}$ 的恒星，拥有一颗半径为 $R_{p}$ 的凌日行星。恒星光球由两个部分组成：一个温度均匀为 $T_{\\mathrm{q}}$ 的“宁静”区域，覆盖面积分数为 $(1 - f)$；以及温度较低、均匀为 $T_{\\mathrm{s}}  T_{\\mathrm{q}}$ 的星斑，覆盖面积分数为 $f$。假设行星的凌日弦只穿过宁静光球区域（不经过星斑），恒星盘面各向同性地辐射，临边昏暗效应可以忽略不计，且观测是在一个中心波长为 $\\lambda$ 的窄光度带内进行的，使得测得的凌日外光通量与在 $\\lambda$ 处的按面积加权的辐射强度成正比。\n\n从凌日深度是被遮挡的恒星光通量与凌日外恒星光通量之比的定义出发，推导在有星斑的情况下观测到的凌日中点深度 $\\delta_{\\mathrm{eff}}$ 的表达式，该表达式用完全宁静恒星的参考凌日中点深度 $\\delta$ 以及凌日外光通量 $F_{\\mathrm{quiet}}$ 和 $F_{\\mathrm{spotted}}$ 来表示。然后，将此表达式具体化到辐射强度由波长 $\\lambda$ 处的普朗克光谱辐射亮度 $B_{\\lambda}(T)$ 给出的情况。\n\n使用你推导的表达式，为以下参数计算乘性偏差因子 $\\delta_{\\mathrm{eff}} / \\delta$：$T_{\\mathrm{q}} = 5800\\ \\mathrm{K}$，$T_{\\mathrm{s}} = 4800\\ \\mathrm{K}$，$f = 0.05$，以及 $\\lambda = 600\\ \\mathrm{nm}$。使用普朗克函数 $B_{\\lambda}(T) = \\dfrac{2 h c^{2}}{\\lambda^{5}}\\left[\\exp\\!\\left(\\dfrac{h c}{\\lambda k_{B} T}\\right) - 1\\right]^{-1}$，其中 $h = 6.62607015 \\times 10^{-34}\\ \\mathrm{J\\cdot s}$，$c = 2.99792458 \\times 10^{8}\\ \\mathrm{m/s}$，以及 $k_{B} = 1.380649 \\times 10^{-23}\\ \\mathrm{J/K}$。将最终答案表示为一个无量纲数，并四舍五入到四位有效数字。",
            "solution": "所述问题具有科学依据、良定、客观，并包含唯一解所需的所有信息。它描述了系外行星凌日光度学中的一个标准问题，并基于辐射转移和几何学的基本原理。因此，该问题被认为是有效的。\n\n该问题要求得到三个结果：\n1.  用宁静恒星的参考深度 $\\delta$ 和凌日外光通量 $F_{\\mathrm{quiet}}$ 与 $F_{\\mathrm{spotted}}$ 表示观测到的凌日中点深度 $\\delta_{\\mathrm{eff}}$ 的表达式。\n2.  将此表达式具体化到恒星辐射遵循普朗克光谱辐射亮度 $B_{\\lambda}(T)$ 的情况。\n3.  对于给定的一组参数，数值计算乘性偏差因子 $\\delta_{\\mathrm{eff}}/\\delta$。\n\n设 $R_{\\star}$ 为恒星半径，$R_{\\mathrm{p}}$ 为行星半径。恒星的投影盘面面积为 $A_{\\star} = \\pi R_{\\star}^{2}$，行星的投影盘面面积为 $A_{\\mathrm{p}} = \\pi R_{\\mathrm{p}}^{2}$。\n问题陈述，凌日外光通量与按面积加权的辐射强度成正比。设 $I_{\\mathrm{q}}$ 为温度为 $T_{\\mathrm{q}}$ 的宁静光球的辐射强度，$I_{\\mathrm{s}}$ 为温度为 $T_{\\mathrm{s}}$ 的星斑的辐射强度。\n\n对于一个假设的、完全宁静的恒星，其凌日外光通量记为 $F_{\\mathrm{quiet}}$。它正比于总恒星面积乘以宁静光球的强度：\n$$F_{\\mathrm{quiet}} \\propto A_{\\star} I_{\\mathrm{q}}$$\n对于有星斑的恒星，恒星盘面的一部分被星斑覆盖，其面积分数为 $f$。因此，凌日外光通量 $F_{\\mathrm{spotted}}$ 为：\n$$F_{\\mathrm{spotted}} \\propto (1-f) A_{\\star} I_{\\mathrm{q}} + f A_{\\star} I_{\\mathrm{s}}$$\n\n凌日深度定义为被遮挡的恒星光通量与凌日外恒星光通量之比。\n参考凌日深度 $\\delta$ 对应于在完全宁静的恒星上发生的凌日。被遮挡的光通量 $\\Delta F_{\\mathrm{quiet}}$ 是来自行星面积 $A_{\\mathrm{p}}$ 的光通量，该区域具有均匀的强度 $I_{\\mathrm{q}}$。\n$$\\delta = \\frac{\\Delta F_{\\mathrm{quiet}}}{F_{\\mathrm{quiet}}} = \\frac{k A_{\\mathrm{p}} I_{\\mathrm{q}}}{k A_{\\star} I_{\\mathrm{q}}} = \\frac{A_{\\mathrm{p}}}{A_{\\star}} = \\left(\\frac{R_{\\mathrm{p}}}{R_{\\star}}\\right)^{2}$$\n这里，$k$ 是一个比例常数，它将辐射强度和面积与观测到的光通量联系起来。\n\n对于有星斑的恒星，问题陈述行星凌经一个宁静光球区域。因此，被遮挡的光通量 $\\Delta F$ 是由于遮蔽了一个辐射强度为 $I_{\\mathrm{q}}$ 的表面。被遮挡的光通量的大小与宁静恒星情况下的相同：\n$$\\Delta F \\propto A_{\\mathrm{p}} I_{\\mathrm{q}}$$\n我们可以将其与 $F_{\\mathrm{quiet}}$ 和 $\\delta$ 联系起来：\n$$\\Delta F = \\frac{A_{\\mathrm{p}}}{A_{\\star}} (k A_{\\star} I_{\\mathrm{q}}) = \\delta F_{\\mathrm{quiet}}$$\n对于有星斑的恒星，观测到的凌日深度 $\\delta_{\\mathrm{eff}}$ 是这个被遮挡的光通量与来自有星斑恒星的总凌日外光通量 $F_{\\mathrm{spotted}}$ 之比：\n$$\\delta_{\\mathrm{eff}} = \\frac{\\Delta F}{F_{\\mathrm{spotted}}} = \\frac{\\delta F_{\\mathrm{quiet}}}{F_{\\mathrm{spotted}}}$$\n这是第一个要求的表达式。它表明观测到的深度是几何深度乘以宁静恒星与有星斑恒星的光通量之比。由于 $T_{\\mathrm{s}}  T_{\\mathrm{q}}$，我们有 $I_{\\mathrm{s}}  I_{\\mathrm{q}}$，这意味着 $F_{\\mathrm{spotted}}  F_{\\mathrm{quiet}}$。因此，$\\delta_{\\mathrm{eff}} > \\delta$。未被遮挡的冷星斑的存在使得凌日看起来更深。\n\n接下来，我们使用给定波长 $\\lambda$ 处的普朗克函数来表示辐射强度，从而将此结果具体化：$I_{\\lambda} = B_{\\lambda}(T)$。\n因此，$I_{\\mathrm{q}} = B_{\\lambda}(T_{\\mathrm{q}})$ 且 $I_{\\mathrm{s}} = B_{\\lambda}(T_{\\mathrm{s}})$。光通量之比变为：\n$$\\frac{F_{\\mathrm{quiet}}}{F_{\\mathrm{spotted}}} = \\frac{k A_{\\star} B_{\\lambda}(T_{\\mathrm{q}})}{k \\left[ (1-f) A_{\\star} B_{\\lambda}(T_{\\mathrm{q}}) + f A_{\\star} B_{\\lambda}(T_{\\mathrm{s}}) \\right]} = \\frac{B_{\\lambda}(T_{\\mathrm{q}})}{(1-f) B_{\\lambda}(T_{\\mathrm{q}}) + f B_{\\lambda}(T_{\\mathrm{s}})}$$\n将分子和分母同时除以 $B_{\\lambda}(T_{\\mathrm{q}})$ 得：\n$$\\frac{F_{\\mathrm{quiet}}}{F_{\\mathrm{spotted}}} = \\frac{1}{1 - f + f \\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})}}$$\n将此代入 $\\delta_{\\mathrm{eff}}$ 的表达式中，得到第二个结果。乘性偏差因子为：\n$$\\frac{\\delta_{\\mathrm{eff}}}{\\delta} = \\frac{1}{1 - f + f \\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})}}$$\n\n最后，我们计算这个偏差因子的数值。普朗克函数之比为：\n$$\\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})} = \\frac{\\frac{2 h c^{2}}{\\lambda^{5}}\\left[\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T_{\\mathrm{s}}}\\right) - 1\\right]^{-1}}{\\frac{2 h c^{2}}{\\lambda^{5}}\\left[\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T_{\\mathrm{q}}}\\right) - 1\\right]^{-1}} = \\frac{\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T_{\\mathrm{q}}}\\right) - 1}{\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T_{\\mathrm{s}}}\\right) - 1}$$\n我们给定的参数如下：\n$T_{\\mathrm{q}} = 5800\\ \\mathrm{K}$\n$T_{\\mathrm{s}} = 4800\\ \\mathrm{K}$\n$f = 0.05$\n$\\lambda = 600\\ \\mathrm{nm} = 6 \\times 10^{-7}\\ \\mathrm{m}$\n$h = 6.62607015 \\times 10^{-34}\\ \\mathrm{J\\cdot s}$\n$c = 2.99792458 \\times 10^{8}\\ \\mathrm{m/s}$\n$k_{B} = 1.380649 \\times 10^{-23}\\ \\mathrm{J/K}$\n\n首先，我们计算普朗克函数比值中的指数。设 $x_{T} = \\frac{h c}{\\lambda k_{B} T}$。\n$$x_{\\mathrm{q}} = \\frac{h c}{\\lambda k_{B} T_{\\mathrm{q}}} = \\frac{(6.62607015 \\times 10^{-34}\\ \\mathrm{J\\cdot s}) (2.99792458 \\times 10^{8}\\ \\mathrm{m/s})}{(6 \\times 10^{-7}\\ \\mathrm{m}) (1.380649 \\times 10^{-23}\\ \\mathrm{J/K}) (5800\\ \\mathrm{K})} \\approx 4.134417$$\n$$x_{\\mathrm{s}} = \\frac{h c}{\\lambda k_{B} T_{\\mathrm{s}}} = \\frac{(6.62607015 \\times 10^{-34}\\ \\mathrm{J\\cdot s}) (2.99792458 \\times 10^{8}\\ \\mathrm{m/s})}{(6 \\times 10^{-7}\\ \\mathrm{m}) (1.380649 \\times 10^{-23}\\ \\mathrm{J/K}) (4800\\ \\mathrm{K})} \\approx 4.995754$$\n现在，我们计算普朗克函数的比值：\n$$\\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})} = \\frac{\\exp(x_{\\mathrm{q}}) - 1}{\\exp(x_{\\mathrm{s}}) - 1} = \\frac{\\exp(4.134417) - 1}{\\exp(4.995754) - 1} \\approx \\frac{62.45210 - 1}{147.7711 - 1} = \\frac{61.45210}{146.7711} \\approx 0.418698$$\n最后，我们使用这个比值和星斑覆盖分数 $f = 0.05$ 来计算偏差因子：\n$$\\frac{\\delta_{\\mathrm{eff}}}{\\delta} = \\frac{1}{1 - f + f \\frac{B_{\\lambda}(T_{\\mathrm{s}})}{B_{\\lambda}(T_{\\mathrm{q}})}} = \\frac{1}{1 - 0.05 + (0.05)(0.418698)} = \\frac{1}{0.95 + 0.0209349} = \\frac{1}{0.9709349} \\approx 1.029935$$\n将结果四舍五入到四位有效数字，得到 $1.030$。",
            "answer": "$$\\boxed{1.030}$$"
        },
        {
            "introduction": "并非恒星光变曲线中的每一次周期性下降都代表着一颗行星；天体物理伪信号常常能模仿凌日信号。这项高级练习旨在解决验证行星候选体的关键任务，即将其与一种常见的伪信号——背景混合食双星——区分开来。你将模拟凌日深度在不同颜色滤光片下的变化，利用这样一个原理：真实行星的色度特征（主要由临边变暗引起）与混合双星的色度特征（由不同温度恒星的流量稀释引起）有显著不同，从而构建一个用于系外行星验证的重要工具。",
            "id": "4185129",
            "problem": "你的任务是模拟两种竞争性假说下随波长变化的凌星深度，并利用多波段光度测量数据，判断一个类凌星的亮度下降是与一颗行星凌越单个目标恒星的情况一致，还是更符合一个背景混合食双星的情况。你必须从第一性原理出发，推导并实现一个完整的、可运行的程序，该程序能计算在二次临边变暗情况下，一个小型不透明遮挡体造成的各波段相关的凌星深度，以及在混合情况下，由混合恒星光谱引起的随通带变化的稀释效应。然后，对于每个测试用例，你必须使用一个基于比率的判据对事件进行分类，该判据能够将仅由临边变暗引起的色度效应与由光谱混合引入的色度效应分离开来。\n\n请从以下基本依据和核心定义开始：\n\n- 辐射转移中比强度的定义以及小行星掩食近似。对于一个半径为 $R_{\\mathrm{occ}}$ 的小型不透明遮挡体，以撞击参数 $b$（单位为恒星半径 $R_\\star$）凌越一颗半径为 $R_\\star$ 的恒星，其流量损失分数（凌星深度）$\\delta$ 是被遮挡的面积分数，并以相对于盘积分强度的局部比强度加权。在小行星极限情况下，这简化为一个涉及被遮挡位置 $\\mu$ 处的局部表面亮度和盘平均强度的表达式。\n- 二次临边变暗定律。比强度作为 $\\mu \\equiv \\cos\\theta$ 的函数表示为：\n$$\n\\frac{I(\\mu)}{I(1)} = 1 - u_1\\,(1-\\mu) - u_2\\,(1-\\mu)^2,\n$$\n其中 $u_1$ 和 $u_2$ 是适用于给定通带的临边变暗系数，而 $I(1)$ 是恒星盘中心的比强度。盘平均强度 $\\langle I \\rangle$ 必须通过对可见恒星盘上的 $I(\\mu)$ 进行积分来推导。\n- 有效温度为 $T$ 的恒星的黑体光谱辐射率（普朗克函数）：\n$$\nB_\\lambda(T) = \\frac{2 h c^2}{\\lambda^5} \\frac{1}{\\exp\\!\\left(\\frac{h c}{\\lambda k_{\\mathrm{B}} T}\\right) - 1},\n$$\n其中 $h$ 是普朗克常数，$c$ 是光速，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$\\lambda$ 是波长。假设每个通带的透射率是顶帽函数 $S_i(\\lambda)=1$（对于 $\\lambda \\in [\\lambda_{1,i}, \\lambda_{2,i}]$）且在其他情况下 $S_i(\\lambda)=0$。距离为 $d$、半径为 $R$ 的恒星在一个通带内的流量与以下表达式成正比：\n$$\nF_i \\propto \\frac{R^2}{d^2} \\int_{\\lambda_{1,i}}^{\\lambda_{2,i}} B_\\lambda(T)\\, d\\lambda.\n$$\n你必须对这个积分进行数值计算。\n\n需要推导和实现的模型假设：\n\n1. 行星假说：对于一颗半径为 $R_{\\mathrm{p}}$ 的小行星凌越目标恒星，其撞击参数为 $b_{\\mathrm{t}}$，在通带 $i$ 中的临边变暗系数为 $(u_{1,i}^{\\mathrm{t}}, u_{2,i}^{\\mathrm{t}})$，请推导通带相关的凌星深度 $\\delta^{\\mathrm{pl}}_i$ 关于 $k \\equiv R_{\\mathrm{p}}/R_\\star$、$\\mu_{\\mathrm{t}} \\equiv \\sqrt{\\max(0, 1 - b_{\\mathrm{t}}^2)}$、$I(\\mu)$ 和 $\\langle I \\rangle$ 的表达式。\n2. 混合食双星假说：考虑一个背景食双星系统，由主星（下标 $1$）和伴星（下标 $2$）组成，其半径分别为 $R_1$ 和 $R_2$，温度分别为 $T_1$ 和 $T_2$，在通带 $i$ 中的临边变暗系数为 $(u_{1,i}^{\\mathrm{eb}}, u_{2,i}^{\\mathrm{eb}})$，距离为 $d_{\\mathrm{eb}}$。目标恒星的半径为 $R_{\\mathrm{t}}$，温度为 $T_{\\mathrm{t}}$，临边变暗系数为 $(u_{1,i}^{\\mathrm{t}}, u_{2,i}^{\\mathrm{t}})$，距离为 $d_{\\mathrm{t}}$。在双星伴星掩食主星的小遮挡体近似下，设双星撞击参数为 $b_{\\mathrm{eb}}$ 且 $\\mu_{\\mathrm{eb}} \\equiv \\sqrt{\\max(0, 1 - b_{\\mathrm{eb}}^2)}$，请推导主星流量的内在分数损失 $\\delta^{\\mathrm{eb,int}}_i$ 以及观测到的混合稀释深度：\n$$\n\\delta^{\\mathrm{blend}}_i = \\frac{F_{1,i}\\, \\delta^{\\mathrm{eb,int}}_i}{F_{\\mathrm{t},i} + F_{1,i} + F_{2,i}},\n$$\n其中 $F_{\\mathrm{t},i}$、$F_{1,i}$ 和 $F_{2,i}$ 分别是目标恒星、双星主星和双星伴星在通带 $i$ 中的流量。\n\n需要实现的决策判据：\n\n- 对于每个测试用例，计算三个通带中测得的深度 $\\delta_i$。计算仅由目标恒星临边变暗效应引起的预测值：\n$$\nS_i^{\\mathrm{t}} \\equiv \\frac{I^{\\mathrm{t}}(\\mu_{\\mathrm{t}})}{\\langle I^{\\mathrm{t}} \\rangle},\n$$\n并构建深度比 $r_i \\equiv \\delta_i / \\delta_{\\mathrm{V}}$（对于 $i \\in \\{\\mathrm{B}, \\mathrm{V}, \\mathrm{R}\\}$）。同样地，计算预测的临边变暗比 $R_i^{\\mathrm{t}} \\equiv S_i^{\\mathrm{t}} / S_{\\mathrm{V}}^{\\mathrm{t}}$。如果最大绝对偏差满足：\n$$\n\\max_{i \\in \\{\\mathrm{B},\\mathrm{R}\\}} \\left| r_i - R_i^{\\mathrm{t}} \\right|  \\tau,\n$$\n且容差 $\\tau = 0.03$（无单位），则将该事件分类为与行星假说一致。否则，分类为与行星假说不一致。\n\n通带与单位：\n\n- 使用三个顶帽通带，波长区间以米为单位指定：\n  - 蓝色（B）：$\\lambda \\in [4.0 \\times 10^{-7},\\, 5.0 \\times 10^{-7}]$ m。\n  - 可见光（V）：$\\lambda \\in [5.0 \\times 10^{-7},\\, 6.0 \\times 10^{-7}]$ m。\n  - 红色（R）：$\\lambda \\in [6.0 \\times 10^{-7},\\, 7.0 \\times 10^{-7}]$ m。\n- 物理输入必须按指定的国际单位制（SI）处理：半径以米为单位，距离以米为单位，温度以开尔文为单位，波长以米为单位。\n- 最终的凌星深度表示为无单位分数，并四舍五入到六位小数。\n\n测试套件：\n\n请实现你的程序，为以下四组参数集计算结果。在每种情况下，计算三个波段的深度和分类布尔值。\n\n- 情况 1（行星凌越类日目标星，中心凌星）：\n  - 目标恒星：$R_\\star = 6.957 \\times 10^{8}$ m, $T_{\\mathrm{t}} = 5777$ K，撞击参数 $b_{\\mathrm{t}} = 0.0$。\n  - 行星：$R_{\\mathrm{p}} = 6.957 \\times 10^{7}$ m。\n  - 目标恒星在各通带的临边变暗系数：\n    - B：$(u_{1,\\mathrm{B}}^{\\mathrm{t}}, u_{2,\\mathrm{B}}^{\\mathrm{t}}) = (0.55, 0.16)$。\n    - V：$(u_{1,\\mathrm{V}}^{\\mathrm{t}}, u_{2,\\mathrm{V}}^{\\mathrm{t}}) = (0.49, 0.22)$。\n    - R：$(u_{1,\\mathrm{R}}^{\\mathrm{t}}, u_{2,\\mathrm{R}}^{\\mathrm{t}}) = (0.40, 0.28)$。\n- 情况 2（行星凌越K型目标星，掠过式凌星）：\n  - 目标恒星：$R_\\star = 0.9 \\times 6.957 \\times 10^{8}$ m, $T_{\\mathrm{t}} = 5000$ K，撞击参数 $b_{\\mathrm{t}} = 0.9$。\n  - 行星：$R_{\\mathrm{p}} = 0.03 \\times 6.957 \\times 10^{8}$ m。\n  - 目标恒星在各通带的临边变暗系数：\n    - B：$(u_{1,\\mathrm{B}}^{\\mathrm{t}}, u_{2,\\mathrm{B}}^{\\mathrm{t}}) = (0.80, 0.10)$。\n    - V：$(u_{1,\\mathrm{V}}^{\\mathrm{t}}, u_{2,\\mathrm{V}}^{\\mathrm{t}}) = (0.70, 0.10)$。\n    - R：$(u_{1,\\mathrm{R}}^{\\mathrm{t}}, u_{2,\\mathrm{R}}^{\\mathrm{t}}) = (0.60, 0.10)$。\n- 情况 3（类日目标星后的混合食双星）：\n  - 目标恒星：$R_{\\mathrm{t}} = 6.957 \\times 10^{8}$ m, $T_{\\mathrm{t}} = 5777$ K, $d_{\\mathrm{t}} = 300 \\times 3.0857 \\times 10^{16}$ m，用于分类的假定撞击参数 $b_{\\mathrm{t}} = 0.4$。\n  - 用于分类的目标星临边变暗系数：\n    - B：$(u_{1,\\mathrm{B}}^{\\mathrm{t}}, u_{2,\\mathrm{B}}^{\\mathrm{t}}) = (0.55, 0.16)$。\n    - V：$(u_{1,\\mathrm{V}}^{\\mathrm{t}}, u_{2,\\mathrm{V}}^{\\mathrm{t}}) = (0.49, 0.22)$。\n    - R：$(u_{1,\\mathrm{R}}^{\\mathrm{t}}, u_{2,\\mathrm{R}}^{\\mathrm{t}}) = (0.40, 0.28)$。\n  - 双星主星：$R_1 = 0.7 \\times 6.957 \\times 10^{8}$ m, $T_1 = 4500$ K。\n  - 双星伴星：$R_2 = 0.3 \\times 6.957 \\times 10^{8}$ m, $T_2 = 4000$ K。\n  - 双星距离：$d_{\\mathrm{eb}} = 1500 \\times 3.0857 \\times 10^{16}$ m，撞击参数 $b_{\\mathrm{eb}} = 0.2$。\n  - 双星临边变暗系数：\n    - B：$(u_{1,\\mathrm{B}}^{\\mathrm{eb}}, u_{2,\\mathrm{B}}^{\\mathrm{eb}}) = (0.75, 0.15)$。\n    - V：$(u_{1,\\mathrm{V}}^{\\mathrm{eb}}, u_{2,\\mathrm{V}}^{\\mathrm{eb}}) = (0.65, 0.15)$。\n    - R：$(u_{1,\\mathrm{R}}^{\\mathrm{eb}}, u_{2,\\mathrm{R}}^{\\mathrm{eb}}) = (0.55, 0.15)$。\n- 情况 4（具有热主星的混合食双星位于冷M矮星目标之后）：\n  - 目标恒星：$R_{\\mathrm{t}} = 0.4 \\times 6.957 \\times 10^{8}$ m, $T_{\\mathrm{t}} = 3500$ K, $d_{\\mathrm{t}} = 200 \\times 3.0857 \\times 10^{16}$ m，用于分类的假定撞击参数 $b_{\\mathrm{t}} = 0.5$。\n  - 用于分类的目标星临边变暗系数：\n    - B：$(u_{1,\\mathrm{B}}^{\\mathrm{t}}, u_{2,\\mathrm{B}}^{\\mathrm{t}}) = (0.90, 0.10)$。\n    - V：$(u_{1,\\mathrm{V}}^{\\mathrm{t}}, u_{2,\\mathrm{V}}^{\\mathrm{t}}) = (0.85, 0.10)$。\n    - R：$(u_{1,\\mathrm{R}}^{\\mathrm{t}}, u_{2,\\mathrm{R}}^{\\mathrm{t}}) = (0.80, 0.10)$。\n  - 双星主星：$R_1 = 1.8 \\times 6.957 \\times 10^{8}$ m, $T_1 = 9000$ K。\n  - 双星伴星：$R_2 = 0.6 \\times 6.957 \\times 10^{8}$ m, $T_2 = 6500$ K。\n  - 双星距离：$d_{\\mathrm{eb}} = 1000 \\times 3.0857 \\times 10^{16}$ m，撞击参数 $b_{\\mathrm{eb}} = 0.2$。\n  - 双星临边变暗系数：\n    - B：$(u_{1,\\mathrm{B}}^{\\mathrm{eb}}, u_{2,\\mathrm{B}}^{\\mathrm{eb}}) = (0.30, 0.10)$。\n    - V：$(u_{1,\\mathrm{V}}^{\\mathrm{eb}}, u_{2,\\mathrm{V}}^{\\mathrm{eb}}) = (0.25, 0.10)$。\n    - R：$(u_{1,\\mathrm{R}}^{\\mathrm{eb}}, u_{2,\\mathrm{R}}^{\\mathrm{eb}}) = (0.20, 0.10)$。\n\n你的程序必须：\n\n- 使用足够精细的波长网格对每个通带上的普朗克函数进行数值积分，以确保稳定性。\n- 对每个情景中指定的撞击参数，计算 $\\mu$ 为 $\\mu = \\sqrt{\\max(0, 1-b^2)}$。\n- 使用推导出的表达式计算相应情况下的 $\\delta^{\\mathrm{pl}}_i$ 和 $\\delta^{\\mathrm{blend}}_i$。\n- 对于每个测试用例，按顺序输出一个列表，其中包含B、V、R三个波段的深度（每个都四舍五入到六位小数）和分类布尔值。\n\n最终输出格式：\n\n- 你的程序应生成单行输出，包含一个用方括号括起来的、以逗号分隔的结果列表，其中每个测试用例都呈现为自己的、没有空格的方括号列表。例如：\"[[dB1,dV1,dR1,True],[dB2,dV2,dR2,False],...]\"。",
            "solution": "所提出的问题是天体物理建模中的一个有效练习，特别是关于从光度学上区分凌日系外行星和混合食双星系统。该问题在科学上基于辐射转移和黑体辐射的原理，其参数集完备，提法得当，且表述客观。我们将首先从第一性原理推导必要的理论表达式，然后通过计算实现它们，以分析所提供的测试用例。\n\n### 1. 核心光度学量的推导\n\n我们首先建立恒星强度和流量的基础关系，这是整个模型的基础。\n\n**1.1. 盘平均比强度**\n\n具有二次临边变暗的恒星的比强度由下式给出：\n$$\n\\frac{I(\\mu)}{I(1)} = 1 - u_1(1-\\mu) - u_2(1-\\mu)^2\n$$\n其中 $\\mu = \\cos\\theta$ 是视线与出射的恒星表面法线之间的夹角余弦，而 $I(1)$ 是恒星盘中心（$\\mu=1$）的强度。\n\n为了求得凌星深度，我们必须将被遮挡点的局部强度与盘平均强度 $\\langle I \\rangle$ 进行比较。盘平均强度定义为总辐射通量除以恒星盘的投影面积 $\\pi R_\\star^2$。通量是通过对可见恒星盘上的比强度进行积分得到的。用 $\\mu$ 表示，投影面积元为 $dA = 2\\pi r dr$，其中投影半径 $r = R_\\star \\sin\\theta = R_\\star \\sqrt{1-\\mu^2}$。求导可得 $2rdr = -2 R_\\star^2 \\mu d\\mu$。因此，在盘上积分的总流量正比于 $\\int_0^1 I(\\mu) \\mu d\\mu$。\n\n因此，盘平均强度 $\\langle I \\rangle$ 为：\n$$\n\\langle I \\rangle = \\frac{\\int_{disk} I(\\mu) dA_{proj}}{\\int_{disk} dA_{proj}} = \\frac{\\int_0^1 I(\\mu) (2\\pi R_\\star^2 \\mu d\\mu)}{\\pi R_\\star^2} = 2 \\int_0^1 I(\\mu) \\mu d\\mu\n$$\n代入 $I(\\mu)$ 的表达式：\n$$\n\\langle I \\rangle = 2 \\int_0^1 I(1) \\left[1 - u_1(1-\\mu) - u_2(1-\\mu)^2\\right] \\mu d\\mu\n$$\n$$\n\\langle I \\rangle = 2 I(1) \\int_0^1 \\left( \\mu - u_1(\\mu - \\mu^2) - u_2(\\mu - 2\\mu^2 + \\mu^3) \\right) d\\mu\n$$\n逐项计算积分：\n$$\n\\int_0^1 \\mu d\\mu = \\frac{1}{2}; \\quad \\int_0^1 (\\mu - \\mu^2)d\\mu = \\frac{1}{2} - \\frac{1}{3} = \\frac{1}{6}; \\quad \\int_0^1 (\\mu - 2\\mu^2 + \\mu^3)d\\mu = \\frac{1}{2} - \\frac{2}{3} + \\frac{1}{4} = \\frac{1}{12}\n$$\n将这些结果代回：\n$$\n\\langle I \\rangle = 2 I(1) \\left( \\frac{1}{2} - \\frac{u_1}{6} - \\frac{u_2}{12} \\right) = I(1) \\left( 1 - \\frac{u_1}{3} - \\frac{u_2}{6} \\right)\n$$\n这为我们的强度比提供了分母。\n\n**1.2. 通带积分流量**\n\n在给定通带 $i$ 中，从距离为 $d$、半径为 $R$ 的恒星接收到的流量与其在该通带的光度除以 $4\\pi d^2$ 成正比。光度是表面积（$4\\pi R^2$）乘以单位面积的发射流量（光谱辐射率的积分）。我们已知通带流量与以下表达式成正比：\n$$\nF_i \\propto \\frac{R^2}{d^2} \\int_{\\lambda_{1,i}}^{\\lambda_{2,i}} B_\\lambda(T)\\, d\\lambda\n$$\n其中 $B_\\lambda(T)$ 是普朗克函数：\n$$\nB_\\lambda(T) = \\frac{2 h c^2}{\\lambda^5} \\frac{1}{\\exp\\left(\\frac{h c}{\\lambda k_{\\mathrm{B}} T}\\right) - 1}\n$$\n我们定义通带积分黑体发射率为 $E_i(T) = \\int_{\\lambda_{1,i}}^{\\lambda_{2,i}} B_\\lambda(T)\\, d\\lambda$。该积分必须进行数值计算。那么，来自任何恒星 $j$ 在通带 $i$ 中的相对流量贡献正比于 $f_{j,i} = (R_j/d_j)^2 E_i(T_j)$。\n\n### 2. 凌星深度建模\n\n**2.1. 行星假说**\n\n一个小型不透明遮挡体（半径为 $R_{\\mathrm{p}}$ 的行星）凌越一颗半径为 $R_\\star$ 的恒星，产生的流量损失分数（深度 $\\delta$）由被遮挡流量与总恒星流量之比给出。在小行星近似下，这简化为行星与恒星的面积比，并按遮挡位置的相对表面亮度加权：\n$$\n\\delta = \\frac{\\text{Area}_{\\mathrm{p}} \\times I(\\mu_{\\mathrm{occ}})}{\\text{Area}_{\\star} \\times \\langle I \\rangle} = \\left(\\frac{R_{\\mathrm{p}}}{R_\\star}\\right)^2 \\frac{I(\\mu_{\\mathrm{occ}})}{\\langle I \\rangle}\n$$\n对于撞击参数为 $b$（以恒星半径为单位）的凌星，遮挡的位置对应于 $\\mu_t = \\sqrt{\\max(0, 1-b^2)}$。设 $k \\equiv R_{\\mathrm{p}}/R_\\star$。与波段相关的凌星深度 $\\delta^{\\mathrm{pl}}_i$ 为：\n$$\n\\delta^{\\mathrm{pl}}_i = k^2 \\frac{I_i^{\\mathrm{t}}(\\mu_t)}{\\langle I_i^{\\mathrm{t}} \\rangle} = k^2 \\frac{1 - u_{1,i}^{\\mathrm{t}}(1-\\mu_t) - u_{2,i}^{\\mathrm{t}}(1-\\mu_t)^2}{1 - u_{1,i}^{\\mathrm{t}}/3 - u_{2,i}^{\\mathrm{t}}/6}\n$$\n因子 $S_i^{\\mathrm{t}} \\equiv I_i^{\\mathrm{t}}(\\mu_t) / \\langle I_i^{\\mathrm{t}} \\rangle$ 包含了临边变暗的色度效应。\n\n**2.2. 混合食双星假说**\n\n在这种情景下，观测到的流量是前景目标恒星（$t$）和背景食双星的两颗恒星（$1$ 和 $2$）的贡献之和。\n$$\nF_{\\mathrm{total},i} = F_{\\mathrm{t},i} + F_{1,i} + F_{2,i}\n$$\n一次食象发生在双星系统内部，其中伴星（恒星 $2$）遮挡主星（恒星 $1$）。使用同样的小遮挡体近似，恒星 $1$ 的内在流量损失分数为：\n$$\n\\delta^{\\mathrm{eb,int}}_i = \\left(\\frac{R_2}{R_1}\\right)^2 \\frac{I_i^{\\mathrm{eb}}(\\mu_{eb})}{\\langle I_i^{\\mathrm{eb}} \\rangle}\n$$\n其中 $\\mu_{eb} = \\sqrt{\\max(0, 1-b_{eb}^2)}$，且强度和临边变暗系数 $(u_{1,i}^{\\mathrm{eb}}, u_{2,i}^{\\mathrm{eb}})$ 适用于双星系统的主星。食象期间损失的绝对流量为 $\\Delta F_i = F_{1,i} \\delta^{\\mathrm{eb,int}}_i$。观测深度是该流量损失除以总系统流量：\n$$\n\\delta^{\\mathrm{blend}}_i = \\frac{\\Delta F_i}{F_{\\mathrm{total},i}} = \\frac{F_{1,i} \\delta^{\\mathrm{eb,int}}_i}{F_{\\mathrm{t},i} + F_{1,i} + F_{2,i}}\n$$\n利用正比关系 $F_{j,i} \\propto f_{j,i} = (R_j/d_j)^2 E_i(T_j)$，表达式变为：\n$$\n\\delta^{\\mathrm{blend}}_i = \\frac{f_{1,i} \\delta^{\\mathrm{eb,int}}_i}{f_{\\mathrm{t},i} + f_{1,i} + f_{2,i}}\n$$\n此形式表明，观测深度不仅是内在食深度的函数，也与三颗相关恒星的相对流量有关，而后者由于它们的有效温度不同而高度依赖于波长。\n\n### 3. 分类判据\n\n该分类方案旨在区分仅由临边变暗引起的色度效应（行星情况）和由临边变暗与光谱混合共同引起的组合效应（混合情况）。我们定义一个测量的深度比 $r_i = \\delta_i / \\delta_{\\mathrm{V}}$，适用于波段 $i \\in \\{\\mathrm{B}, \\mathrm{R}\\}$。我们将此与行星凌越目标恒星所期望的理论比率进行比较，该理论比率仅取决于目标星的临边变暗：\n$$\nR_i^{\\mathrm{t}} = \\frac{\\delta^{\\mathrm{pl}}_i}{\\delta^{\\mathrm{pl}}_{\\mathrm{V}}} = \\frac{k^2 S_i^{\\mathrm{t}}}{k^2 S_{\\mathrm{V}}^{\\mathrm{t}}} = \\frac{S_i^{\\mathrm{t}}}{S_{\\mathrm{V}}^{\\mathrm{t}}}\n$$\n偏差以 $\\max_{i \\in \\{\\mathrm{B},\\mathrm{R}\\}} |r_i - R_i^{\\mathrm{t}}|$ 来衡量。如果此偏差小于容差 $\\tau = 0.03$，则该事件被分类为与行星假说一致。较大的偏差表明存在额外的色度效应，例如来自光谱不同恒星的稀释效应，这指向了混合情景。\n\n以下程序实现了这些推导出的模型，用以分析所提供的测试用例。普朗克函数的数值积分是使用 `scipy.integrate.quad` 进行的。所有计算均在国际单位制（SI）下进行。",
            "answer": "```python\nimport numpy as np\nfrom scipy import integrate\nfrom typing import List, Tuple, Dict, Any\n\ndef solve():\n    \"\"\"\n    Solves the exoplanet transit validation problem by modeling transit depths\n    under planet and blended eclipsing binary hypotheses and classifying events.\n    \"\"\"\n\n    # Physical constants in SI units\n    H = 6.62607015e-34  # Planck constant (J*s)\n    C = 299792458.0     # Speed of light (m/s)\n    KB = 1.380649e-23   # Boltzmann constant (J/K)\n    \n    # Pre-calculated constant terms for Planck function\n    _2HC2 = 2.0 * H * C**2\n    _HC_KB = H * C / KB\n\n    # Passband definitions in meters\n    PASSBANDS = {\n        'B': (4.0e-7, 5.0e-7),\n        'V': (5.0e-7, 6.0e-7),\n        'R': (6.0e-7, 7.0e-7),\n    }\n\n    # Test cases from the problem statement\n    R_sun = 6.957e8 # Solar radius in meters\n    pc_to_m = 3.0857e16 # Parsec to meter conversion\n    \n    test_cases: List[Dict[str, Any]] = [\n        {\n            'type': 'planet',\n            'params': {\n                'R_star': R_sun,\n                'T_target': 5777.0,\n                'b_target': 0.0,\n                'R_planet': 0.1 * R_sun,\n                'ld_target': {'B': (0.55, 0.16), 'V': (0.49, 0.22), 'R': (0.40, 0.28)},\n            }\n        },\n        {\n            'type': 'planet',\n            'params': {\n                'R_star': 0.9 * R_sun,\n                'T_target': 5000.0,\n                'b_target': 0.9,\n                'R_planet': 0.03 * R_sun,\n                'ld_target': {'B': (0.80, 0.10), 'V': (0.70, 0.10), 'R': (0.60, 0.10)},\n            }\n        },\n        {\n            'type': 'blend',\n            'params': {\n                'target': {'R': R_sun, 'T': 5777.0, 'd': 300.0 * pc_to_m},\n                'eb_primary': {'R': 0.7 * R_sun, 'T': 4500.0},\n                'eb_secondary': {'R': 0.3 * R_sun, 'T': 4000.0},\n                'eb_config': {'d': 1500.0 * pc_to_m, 'b': 0.2},\n                'ld_eb': {'B': (0.75, 0.15), 'V': (0.65, 0.15), 'R': (0.55, 0.15)},\n                'classification': {\n                    'b_target': 0.4,\n                    'ld_target': {'B': (0.55, 0.16), 'V': (0.49, 0.22), 'R': (0.40, 0.28)},\n                }\n            }\n        },\n        {\n            'type': 'blend',\n            'params': {\n                'target': {'R': 0.4 * R_sun, 'T': 3500.0, 'd': 200.0 * pc_to_m},\n                'eb_primary': {'R': 1.8 * R_sun, 'T': 9000.0},\n                'eb_secondary': {'R': 0.6 * R_sun, 'T': 6500.0},\n                'eb_config': {'d': 1000.0 * pc_to_m, 'b': 0.2},\n                'ld_eb': {'B': (0.30, 0.10), 'V': (0.25, 0.10), 'R': (0.20, 0.10)},\n                'classification': {\n                    'b_target': 0.5,\n                    'ld_target': {'B': (0.90, 0.10), 'V': (0.85, 0.10), 'R': (0.80, 0.10)},\n                }\n            }\n        },\n    ]\n\n    memoized_flux_integrals = {}\n\n    def planck_function(wl: float, T: float) - float:\n        \"\"\"Computes Planck function B_lambda(T) in SI units.\"\"\"\n        if T == 0: return 0.0\n        exponent = _HC_KB / (wl * T)\n        if exponent  np.log(np.finfo(float).max): return 0.0 # Avoid overflow in exp\n        return _2HC2 / (wl**5 * (np.exp(exponent) - 1.0))\n\n    def integrate_planck(T: float, wl_min: float, wl_max: float) - float:\n        \"\"\"Numerically integrates Planck function over a wavelength range.\"\"\"\n        key = (T, wl_min, wl_max)\n        if key in memoized_flux_integrals:\n            return memoized_flux_integrals[key]\n        \n        integral, _ = integrate.quad(planck_function, wl_min, wl_max, args=(T,))\n        memoized_flux_integrals[key] = integral\n        return integral\n\n    def compute_s_factor(u1: float, u2: float, b: float) - float:\n        \"\"\"Computes the limb-darkening factor S = I(mu)/I.\"\"\"\n        if b  1.0: return 0.0\n        mu = np.sqrt(1.0 - b**2)\n        \n        i_mu_norm = 1.0 - u1 * (1.0 - mu) - u2 * (1.0 - mu)**2\n        i_avg_norm = 1.0 - u1 / 3.0 - u2 / 6.0\n        \n        if i_avg_norm == 0: return 0.0\n        return i_mu_norm / i_avg_norm\n\n    all_results = []\n    for case in test_cases:\n        params = case['params']\n        depths = {}\n\n        if case['type'] == 'planet':\n            k = params['R_planet'] / params['R_star']\n            for band, (u1, u2) in params['ld_target'].items():\n                s_factor = compute_s_factor(u1, u2, params['b_target'])\n                depths[band] = k**2 * s_factor\n            \n            # Classification parameters are the same as generation parameters\n            ld_target_class = params['ld_target']\n            b_target_class = params['b_target']\n\n        elif case['type'] == 'blend':\n            # Compute flux contributions\n            flux_factors = {}\n            stars = {\n                't': params['target'], \n                '1': params['eb_primary'], \n                '2': params['eb_secondary']\n            }\n            # Distances need to be handled carefully\n            distances = {\n                't': params['target']['d'],\n                '1': params['eb_config']['d'],\n                '2': params['eb_config']['d']\n            }\n            for band, (wl_min, wl_max) in PASSBANDS.items():\n                flux_factors[band] = {}\n                for key, star_info in stars.items():\n                    E_i = integrate_planck(star_info['T'], wl_min, wl_max)\n                    flux_factors[band][key] = (star_info['R'] / distances[key])**2 * E_i\n            \n            # Compute intrinsic and diluted depths\n            k_eb = stars['2']['R'] / stars['1']['R']\n            for band, (u1, u2) in params['ld_eb'].items():\n                s_factor_eb = compute_s_factor(u1, u2, params['eb_config']['b'])\n                delta_int_eb = k_eb**2 * s_factor_eb\n                \n                f_t = flux_factors[band]['t']\n                f_1 = flux_factors[band]['1']\n                f_2 = flux_factors[band]['2']\n                \n                total_flux = f_t + f_1 + f_2\n                if total_flux == 0:\n                    depths[band] = 0.0\n                else:\n                    depths[band] = (f_1 * delta_int_eb) / total_flux\n            \n            # Use specific parameters for classification\n            ld_target_class = params['classification']['ld_target']\n            b_target_class = params['classification']['b_target']\n        \n        # Classification\n        ratios_measured = {\n            'B': depths['B'] / depths['V'] if depths['V'] != 0 else 0,\n            'R': depths['R'] / depths['V'] if depths['V'] != 0 else 0,\n        }\n        \n        s_factors_target = {}\n        for band, (u1, u2) in ld_target_class.items():\n            s_factors_target[band] = compute_s_factor(u1, u2, b_target_class)\n\n        ratios_predicted = {\n            'B': s_factors_target['B'] / s_factors_target['V'] if s_factors_target['V'] != 0 else 0,\n            'R': s_factors_target['R'] / s_factors_target['V'] if s_factors_target['V'] != 0 else 0,\n        }\n\n        dev_B = abs(ratios_measured['B'] - ratios_predicted['B'])\n        dev_R = abs(ratios_measured['R'] - ratios_predicted['R'])\n        \n        tau = 0.03\n        is_consistent_with_planet = max(dev_B, dev_R)  tau\n        \n        result_list = [\n            f\"{depths['B']:.6f}\",\n            f\"{depths['V']:.6f}\",\n            f\"{depths['R']:.6f}\",\n            str(is_consistent_with_planet)\n        ]\n        all_results.append(f\"[{','.join(result_list)}]\")\n    \n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}