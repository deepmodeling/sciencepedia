{
    "hands_on_practices": [
        {
            "introduction": "Understanding the conserved quantities of a dynamical system is the first step toward unraveling its behavior. This practice guides you through the derivation of the Jacobi constant, the only known integral of motion in the non-integrable Circular Restricted Three-Body Problem (CR3BP) . By working from first principles in a rotating reference frame, you will build a foundational understanding of the effective potential and the constraints it places on particle motion.",
            "id": "4186008",
            "problem": "Consider the Circular Restricted Three-Body Problem (CR3BP), defined as the motion of a test particle of negligible mass under the gravitational influence of two primary bodies with masses $1-\\mu$ and $\\mu$ moving in circular orbits about their common center of mass. Work in nondimensional canonical units where the total mass is $1$, the separation of the primaries is $1$, and the angular speed of the uniformly rotating synodic frame is $1$. In this frame, the primaries are fixed at positions $(-\\mu,0,0)$ and $(1-\\mu,0,0)$ along the $x$-axis.\n\nStarting from Newton’s law of universal gravitation and Newton’s second law in a uniformly rotating frame, derive the effective potential $\\Omega(x,y,z)$ that combines the gravitational contributions of the two primaries with the centrifugal potential, and hence derive the Jacobi integral $C$ as a constant of motion. Then, for the specific mass ratio $\\mu=0.01$, evaluate the Jacobi constant for the test particle state $(x,y,z)=(0.5,0,0)$ with velocities $(\\dot{x},\\dot{y},\\dot{z})=(0,0.2,0)$.\n\nExpress your final answer as a single exact rational number with no units. No rounding is required.",
            "solution": "The Circular Restricted Three-Body Problem (CR3BP) models a test particle moving under the gravitational fields of two primaries of masses $1-\\mu$ and $\\mu$ that revolve in circular orbits. In nondimensional canonical units, the separation of the primaries is $1$, the total mass is $1$, and the mean motion (angular speed) of the rotating synodic frame is $1$. In the synodic frame, the primaries are fixed at $(-\\mu,0,0)$ and $(1-\\mu,0,0)$.\n\nWe begin with Newton’s second law in an inertial frame and transform to the uniformly rotating frame. In the rotating frame with angular velocity vector $\\boldsymbol{\\omega}$ of magnitude $1$ aligned with the $z$-axis, the acceleration of the particle includes fictitious forces: the Coriolis acceleration $-2\\,\\boldsymbol{\\omega}\\times\\dot{\\mathbf{r}}$ and the centrifugal acceleration $-\\boldsymbol{\\omega}\\times(\\boldsymbol{\\omega}\\times\\mathbf{r})$. With $\\boldsymbol{\\omega}=(0,0,1)$ and $\\mathbf{r}=(x,y,z)$, these contribute the terms $-2\\,\\hat{\\mathbf{z}}\\times\\dot{\\mathbf{r}}$ and $-\\hat{\\mathbf{z}}\\times(\\hat{\\mathbf{z}}\\times\\mathbf{r})$. The gravitational acceleration is derived from the sum of gravitational potentials of the primaries.\n\nLet $r_1$ and $r_2$ denote the distances from the particle to the primaries:\n$$\nr_1=\\sqrt{(x+\\mu)^2+y^2+z^2}, \\qquad r_2=\\sqrt{(x-1+\\mu)^2+y^2+z^2}.\n$$\nThe gravitational potential per unit mass of the test particle is\n$$\nU(x,y,z)=-\\frac{1-\\mu}{r_1}-\\frac{\\mu}{r_2}.\n$$\nIn the rotating frame, the centrifugal potential per unit mass is\n$$\n\\Phi_{\\text{cf}}(x,y,z)=-\\frac{1}{2}\\left(x^2+y^2\\right),\n$$\nsince $\\boldsymbol{\\omega}$ has unit magnitude and is aligned with the $z$-axis. It is standard to define the effective potential $\\Omega(x,y,z)$ as the negative of the sum of these potentials (so that its gradient produces the non-Coriolis parts of the equations of motion):\n$$\n\\Omega(x,y,z)=\\frac{1-\\mu}{r_1}+\\frac{\\mu}{r_2}+\\frac{1}{2}\\left(x^2+y^2\\right).\n$$\n\nThe equations of motion in the rotating frame can be written as\n$$\n\\ddot{x}-2\\dot{y}=\\frac{\\partial \\Omega}{\\partial x}, \\qquad\n\\ddot{y}+2\\dot{x}=\\frac{\\partial \\Omega}{\\partial y}, \\qquad\n\\ddot{z}=\\frac{\\partial \\Omega}{\\partial z}.\n$$\nTo derive the Jacobi integral, multiply the first equation by $\\dot{x}$, the second by $\\dot{y}$, and the third by $\\dot{z}$, and sum:\n$$\n\\dot{x}\\ddot{x}+\\dot{y}\\ddot{y}+\\dot{z}\\ddot{z}-2\\dot{x}\\dot{y}+2\\dot{y}\\dot{x}\n= \\dot{x}\\frac{\\partial\\Omega}{\\partial x}+\\dot{y}\\frac{\\partial\\Omega}{\\partial y}+\\dot{z}\\frac{\\partial\\Omega}{\\partial z}.\n$$\nThe Coriolis terms cancel, yielding\n$$\n\\frac{d}{dt}\\left(\\frac{1}{2}\\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right)\\right)\n= \\frac{d}{dt}\\,\\Omega(x,y,z).\n$$\nRearranging,\n$$\n\\frac{d}{dt}\\left(\\Omega - \\frac{1}{2}\\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right)\\right)=0,\n$$\nso the quantity $\\Omega - \\frac{1}{2}\\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right)$ is constant along trajectories. By convention, the Jacobi integral $C$ is defined as\n$$\nC=2\\,\\Omega - \\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right).\n$$\n\nWe now evaluate $C$ for the given state with $\\mu=0.01$, position $(x,y,z)=(0.5,0,0)$, and velocity $(\\dot{x},\\dot{y},\\dot{z})=(0,0.2,0)$.\n\nFirst compute the distances to the primaries:\n$$\nr_1=\\sqrt{(x+\\mu)^2+y^2+z^2}=\\sqrt{(0.5+0.01)^2+0^2+0^2}=\\sqrt{0.51^2}=0.51,\n$$\n$$\nr_2=\\sqrt{(x-1+\\mu)^2+y^2+z^2}=\\sqrt{(0.5-1+0.01)^2+0^2+0^2}=\\sqrt{(-0.49)^2}=0.49.\n$$\nThe effective potential at this state is\n$$\n\\Omega=\\frac{1-\\mu}{r_1}+\\frac{\\mu}{r_2}+\\frac{1}{2}(x^2+y^2)\n=\\frac{0.99}{0.51}+\\frac{0.01}{0.49}+\\frac{1}{2}(0.5^2).\n$$\nRewrite each term as an exact rational number:\n$$\n\\frac{0.99}{0.51}=\\frac{99/100}{51/100}=\\frac{99}{51}=\\frac{33}{17}, \\qquad\n\\frac{0.01}{0.49}=\\frac{1/100}{49/100}=\\frac{1}{49}, \\qquad\n\\frac{1}{2}(0.5^2)=\\frac{1}{2}\\cdot\\frac{1}{4}=\\frac{1}{8}.\n$$\nThus,\n$$\n\\Omega=\\frac{33}{17}+\\frac{1}{49}+\\frac{1}{8}.\n$$\nThe squared speed is\n$$\n\\dot{x}^2+\\dot{y}^2+\\dot{z}^2=0^2+0.2^2+0^2=0.04=\\frac{4}{100}=\\frac{1}{25}.\n$$\nTherefore, the Jacobi constant is\n$$\nC=2\\,\\Omega - \\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right)\n=2\\left(\\frac{33}{17}+\\frac{1}{49}+\\frac{1}{8}\\right)-\\frac{1}{25}\n=\\frac{66}{17}+\\frac{2}{49}+\\frac{1}{4}-\\frac{1}{25}.\n$$\nCombine as a single rational number using the common denominator $83{,}300=17\\cdot 49 \\cdot 100$:\n$$\n\\frac{66}{17}=\\frac{323{,}400}{83{,}300}, \\quad\n\\frac{2}{49}=\\frac{3{,}400}{83{,}300}, \\quad\n\\frac{1}{4}=\\frac{20{,}825}{83{,}300}, \\quad\n\\frac{1}{25}=\\frac{3{,}332}{83{,}300},\n$$\nso\n$$\nC=\\frac{323{,}400+3{,}400+20{,}825-3{,}332}{83{,}300}=\\frac{344{,}293}{83{,}300}.\n$$\nThis fraction is in lowest terms because the denominator factors as $2^2\\cdot 5^2\\cdot 7^2\\cdot 17$ and the numerator is not divisible by $2$, $5$, $7$, or $17$.\n\nHence, the Jacobi constant at the specified state is exactly $\\frac{344{,}293}{83{,}300}$.",
            "answer": "$$\\boxed{\\frac{344293}{83300}}$$"
        },
        {
            "introduction": "While the Jacobi constant constrains the regions of possible motion, it does not tell the full story of stability. This practice delves into the equilibrium solutions of the CR3BP—the famous Lagrange points—and asks you to analyze their linear stability . Performing a linearization around the triangular points, $L_4$ and $L_5$, will allow you to derive the critical mass ratio threshold for stability, offering a classic and powerful example of analytical techniques in celestial mechanics.",
            "id": "4186006",
            "problem": "Consider the planar Circular Restricted Three-Body Problem (CR3BP), where two massive bodies of masses $m_1$ and $m_2$ move on circular orbits about their common center of mass with constant angular speed. Let the total mass be $m_1 + m_2 = 1$, the separation of the primaries be $1$, and the angular speed be nondimensionalized to $n = 1$. Define the mass parameter as $\\mu = m_2/(m_1 + m_2)$ with $0  \\mu  1/2$. In a uniformly rotating frame with axes fixed to the line joining the primaries, the test particle of negligible mass moves under the effective potential $\\Omega(x,y)$ that combines the gravitational and centrifugal contributions.\n\nStarting from Newton's laws and the standard rotating-frame equations of motion for the CR3BP, derive the linearized equations around the triangular Lagrange equilibrium points $L_4$ and $L_5$, and obtain the characteristic polynomial for the linearized dynamics. From this fundamental derivation, determine the criterion for linear stability of $L_4$ and $L_5$ in terms of $\\mu$ (the Routh stability criterion) and express the threshold $\\mu_{\\mathrm{R}}$ as a closed-form analytic expression.\n\nThen, for $\\mu = 0.02$, compute the positive difference $\\Delta = \\mu_{\\mathrm{R}} - \\mu$ as a dimensionless number. Round your answer to four significant figures. The final submission must be this single real-valued number $\\Delta$.",
            "solution": "The problem statement has been validated and found to be scientifically grounded, well-posed, and objective. It represents a standard, non-trivial problem in celestial mechanics. I will now proceed with the solution.\n\nThe problem is set in the planar Circular Restricted Three-Body Problem (CR3BP). In a synodic (rotating) coordinate system $(x,y)$ where the two primary masses, $m_1$ and $m_2$, are fixed on the $x$-axis, the equations of motion for a test particle of negligible mass are given by:\n$$\n\\ddot{x} - 2n\\dot{y} = \\frac{\\partial \\Omega}{\\partial x}\n$$\n$$\n\\ddot{y} + 2n\\dot{x} = \\frac{\\partial \\Omega}{\\partial y}\n$$\nHere, $n$ is the angular speed of the primaries, and $\\Omega(x,y)$ is the effective potential. The system has been nondimensionalized such that the total mass $m_1+m_2=1$, the separation of the primaries is $1$, and the gravitational constant $G=1$. With these choices, the angular speed $n=1$. The mass parameter is $\\mu = \\frac{m_2}{m_1+m_2} = m_2$, which implies $m_1=1-\\mu$. The primaries are located at $(-\\mu, 0)$ and $(1-\\mu, 0)$.\n\nThe effective potential $\\Omega(x,y)$ is the sum of the gravitational potentials of the two primaries and the centrifugal potential in the rotating frame:\n$$\n\\Omega(x,y) = \\frac{1}{2}(x^2+y^2) + \\frac{1-\\mu}{r_1} + \\frac{\\mu}{r_2}\n$$\nwhere $r_1$ and $r_2$ are the distances from the test particle to $m_1$ and $m_2$, respectively:\n$$\nr_1 = \\sqrt{(x+\\mu)^2 + y^2}\n$$\n$$\nr_2 = \\sqrt{(x-(1-\\mu))^2 + y^2}\n$$\n\nThe Lagrange equilibrium points are the stationary points of the effective potential, where $\\frac{\\partial \\Omega}{\\partial x}=0$ and $\\frac{\\partial \\Omega}{\\partial y}=0$.\nThe triangular points, $L_4$ and $L_5$, are found to be located where the test particle forms an equilateral triangle with the primaries. This condition implies $r_1=r_2=1$. Solving for the coordinates $(x_0, y_0)$ gives:\n$$\n(x_0+\\mu)^2 + y_0^2 = 1^2\n$$\n$$\n(x_0-(1-\\mu))^2 + y_0^2 = 1^2\n$$\nSubtracting the two equations gives $(x_0+\\mu)^2 = (x_0-(1-\\mu))^2$. Since $y_0 \\neq 0$, we can take the square root of both sides to eventually find $x_0 = \\frac{1}{2}-\\mu$. Substituting this back into the first equation yields $(\\frac{1}{2}-\\mu+\\mu)^2 + y_0^2 = 1$, which gives $y_0^2 = \\frac{3}{4}$. Thus, the coordinates of the triangular points are:\n$$\nL_4: (x_0, y_0) = \\left(\\frac{1}{2}-\\mu, \\frac{\\sqrt{3}}{2}\\right)\n$$\n$$\nL_5: (x_0, y_0) = \\left(\\frac{1}{2}-\\mu, -\\frac{\\sqrt{3}}{2}\\right)\n$$\n\nTo analyze the stability, we linearize the equations of motion around an equilibrium point $(x_0, y_0)$. Let $x(t) = x_0+\\xi(t)$ and $y(t)=y_0+\\eta(t)$, where $\\xi$ and $\\eta$ are small displacements. The linearized equations are:\n$$\n\\ddot{\\xi} - 2\\dot{\\eta} = \\Omega_{xx} \\xi + \\Omega_{xy} \\eta\n$$\n$$\n\\ddot{\\eta} + 2\\dot{\\xi} = \\Omega_{yx} \\xi + \\Omega_{yy} \\eta\n$$\nwhere the subscripts on $\\Omega$ denote second partial derivatives evaluated at the equilibrium point. We need to compute these derivatives.\n$$\n\\Omega_x = x - \\frac{(1-\\mu)(x+\\mu)}{r_1^3} - \\frac{\\mu(x-(1-\\mu))}{r_2^3}\n$$\n$$\n\\Omega_y = y - \\frac{(1-\\mu)y}{r_1^3} - \\frac{\\mu y}{r_2^3}\n$$\nThe second derivatives are:\n$$\n\\Omega_{xx} = 1 + \\frac{3(1-\\mu)(x+\\mu)^2}{r_1^5} - \\frac{1-\\mu}{r_1^3} + \\frac{3\\mu(x-(1-\\mu))^2}{r_2^5} - \\frac{\\mu}{r_2^3}\n$$\n$$\n\\Omega_{yy} = 1 + \\frac{3(1-\\mu)y^2}{r_1^5} - \\frac{1-\\mu}{r_1^3} + \\frac{3\\mu y^2}{r_2^5} - \\frac{\\mu}{r_2^3}\n$$\n$$\n\\Omega_{xy} = \\frac{3(1-\\mu)(x+\\mu)y}{r_1^5} + \\frac{3\\mu(x-(1-\\mu))y}{r_2^5}\n$$\nAt $L_4/L_5$, we have $r_1=r_2=1$, $x_0+\\mu = \\frac{1}{2}$, $x_0-(1-\\mu) = -\\frac{1}{2}$, and $y_0^2 = \\frac{3}{4}$. Substituting these values:\n$$\n\\Omega_{xx} = 1 + 3(1-\\mu)\\left(\\frac{1}{2}\\right)^2 - (1-\\mu) + 3\\mu\\left(-\\frac{1}{2}\\right)^2 - \\mu = 1 + \\frac{3}{4}(1-\\mu+\\mu) - (1-\\mu+\\mu) = 1+\\frac{3}{4}-1 = \\frac{3}{4}\n$$\n$$\n\\Omega_{yy} = 1 + 3(1-\\mu)\\left(\\frac{3}{4}\\right) - (1-\\mu) + 3\\mu\\left(\\frac{3}{4}\\right) - \\mu = 1 + \\frac{9}{4}(1-\\mu+\\mu) - (1-\\mu+\\mu) = 1+\\frac{9}{4}-1 = \\frac{9}{4}\n$$\n$$\n\\Omega_{xy} = 3(1-\\mu)\\left(\\frac{1}{2}\\right)y_0 + 3\\mu\\left(-\\frac{1}{2}\\right)y_0 = \\frac{3}{2}y_0(1-\\mu-\\mu) = \\frac{3}{2}y_0(1-2\\mu) = \\pm\\frac{3\\sqrt{3}}{4}(1-2\\mu)\n$$\nThe sign depends on whether we are at $L_4$ or $L_5$. Note that $\\Omega_{yx}=\\Omega_{xy}$.\n\nWe seek solutions of the form $\\xi = A e^{\\lambda t}$ and $\\eta = B e^{\\lambda t}$. This leads to the characteristic equation:\n$$\n\\det\\begin{pmatrix} \\lambda^2 - \\Omega_{xx}  -2\\lambda - \\Omega_{xy} \\\\ 2\\lambda - \\Omega_{yx}  \\lambda^2 - \\Omega_{yy} \\end{pmatrix} = 0\n$$\n$$\n(\\lambda^2 - \\Omega_{xx})(\\lambda^2 - \\Omega_{yy}) - (-2\\lambda - \\Omega_{xy})(2\\lambda - \\Omega_{xy}) = 0\n$$\n$$\n\\lambda^4 - (\\Omega_{xx}+\\Omega_{yy})\\lambda^2 + \\Omega_{xx}\\Omega_{yy} + (4\\lambda^2 - \\Omega_{xy}^2) = 0\n$$\n$$\n\\lambda^4 + (4 - \\Omega_{xx} - \\Omega_{yy})\\lambda^2 + (\\Omega_{xx}\\Omega_{yy} - \\Omega_{xy}^2) = 0\n$$\nSubstituting the computed values:\n$\\Omega_{xx}+\\Omega_{yy} = \\frac{3}{4} + \\frac{9}{4} = 3$.\n$\\Omega_{xx}\\Omega_{yy} - \\Omega_{xy}^2 = \\left(\\frac{3}{4}\\right)\\left(\\frac{9}{4}\\right) - \\left(\\frac{3\\sqrt{3}}{4}(1-2\\mu)\\right)^2 = \\frac{27}{16} - \\frac{27}{16}(1-2\\mu)^2 = \\frac{27}{16}[1-(1-4\\mu+4\\mu^2)] = \\frac{27}{16}(4\\mu-4\\mu^2) = \\frac{27}{4}\\mu(1-\\mu)$.\n\nThe characteristic polynomial is:\n$$\n\\lambda^4 + (4 - 3)\\lambda^2 + \\frac{27}{4}\\mu(1-\\mu) = 0\n$$\n$$\n\\lambda^4 + \\lambda^2 + \\frac{27}{4}\\mu(1-\\mu) = 0\n$$\nThis is a biquadratic equation in $\\lambda$. Let $z = \\lambda^2$. The equation becomes a quadratic in $z$:\n$$\nz^2 + z + \\frac{27}{4}\\mu(1-\\mu) = 0\n$$\nThe roots are $z_{1,2} = \\frac{-1 \\pm \\sqrt{1 - 27\\mu(1-\\mu)}}{2}$.\nFor linear stability, all eigenvalues $\\lambda$ must have non-positive real parts. If $\\lambda$ is a root, so are $-\\lambda$, $\\bar{\\lambda}$, and $-\\bar{\\lambda}$. Stability requires all four roots to be purely imaginary, which in turn requires the two roots for $z=\\lambda^2$ to be real, distinct, and negative.\nFor the roots $z$ to be real, the discriminant must be non-negative:\n$$\nD = 1 - 27\\mu(1-\\mu) \\ge 0\n$$\nIf $D \\ge 0$, then since $\\mu(1-\\mu)  0$ for $0  \\mu  1$, we have $1-27\\mu(1-\\mu)  1$. Thus $\\sqrt{D}  1$, which ensures that both roots $z_{1,2}$ are negative. This leads to purely imaginary eigenvalues $\\lambda$, corresponding to stable oscillations.\nThe stability criterion is therefore $1 - 27\\mu(1-\\mu) \\ge 0$.\n\nThe threshold for stability, $\\mu_{\\mathrm{R}}$, corresponds to the equality, which marks the onset of complex roots for $z$ and thus unstable eigenvalues for $\\lambda$.\n$$\n1 - 27\\mu_{\\mathrm{R}}(1-\\mu_{\\mathrm{R}}) = 0\n$$\n$$\n27\\mu_{\\mathrm{R}}^2 - 27\\mu_{\\mathrm{R}} + 1 = 0\n$$\nSolving this quadratic equation for $\\mu_{\\mathrm{R}}$:\n$$\n\\mu_{\\mathrm{R}} = \\frac{27 \\pm \\sqrt{27^2 - 4(27)(1)}}{2(27)} = \\frac{27 \\pm \\sqrt{729 - 108}}{54} = \\frac{27 \\pm \\sqrt{621}}{54}\n$$\nSince $\\sqrt{621} = \\sqrt{9 \\times 69} = 3\\sqrt{69}$, we have:\n$$\n\\mu_{\\mathrm{R}} = \\frac{27 \\pm 3\\sqrt{69}}{54} = \\frac{9 \\pm \\sqrt{69}}{18}\n$$\nThe problem specifies $0  \\mu  1/2$. Since $\\sqrt{69} \\approx 8.3$, the solution with the plus sign $\\frac{9+\\sqrt{69}}{18}$ is greater than $1/2$. The physically relevant solution is the one with the minus sign:\n$$\n\\mu_{\\mathrm{R}} = \\frac{9 - \\sqrt{69}}{18}\n$$\nThis is the Routh stability threshold.\n\nFinally, we must compute $\\Delta = \\mu_{\\mathrm{R}} - \\mu$ for $\\mu = 0.02$.\nFirst, we evaluate $\\mu_{\\mathrm{R}}$ numerically:\n$$\n\\mu_{\\mathrm{R}} = \\frac{9 - \\sqrt{69}}{18} \\approx \\frac{9 - 8.30662386}{18} = \\frac{0.69337614}{18} \\approx 0.0385208965\n$$\nNow, we calculate the difference $\\Delta$:\n$$\n\\Delta = \\mu_{\\mathrm{R}} - \\mu \\approx 0.0385208965 - 0.02 = 0.0185208965\n$$\nRounding to four significant figures, we get:\n$$\n\\Delta \\approx 0.01852\n$$\nThe fifth significant figure is $0$, so no rounding up is necessary.",
            "answer": "$$\\boxed{0.01852}$$"
        },
        {
            "introduction": "Analytical methods like linear stability analysis are powerful but often only provide a local picture of the dynamics. To explore the rich, global behavior of the CR3BP, including the onset of chaos, we turn to computational tools . In this hands-on computational exercise, you will generate Poincaré sections to visualize the structure of the phase space, learning to distinguish between the ordered, quasi-periodic motion of stable islands and the unpredictable behavior within chaotic seas.",
            "id": "4186041",
            "problem": "Consider the planar Circular Restricted Three-Body Problem (CR3BP) in the synodic (rotating) frame, with normalized canonical units: the distance between primaries is $1$, the total mass is $1$, and the angular velocity of the rotating frame is $1$ radian per unit time. Let the primary masses be $m_1 = 1 - \\mu$ and $m_2 = \\mu$ located at fixed positions $(-\\mu, 0)$ and $(1 - \\mu, 0)$, respectively. The equations of motion in the rotating frame follow from Newton's second law with the Coriolis and centrifugal terms and the gravitational accelerations from the primaries. Define the effective potential\n$$\n\\Omega(x,y) = \\frac{1}{2}(x^2 + y^2) + \\frac{1 - \\mu}{r_1} + \\frac{\\mu}{r_2},\n$$\nwhere $r_1 = \\sqrt{(x + \\mu)^2 + y^2}$ and $r_2 = \\sqrt{(x - 1 + \\mu)^2 + y^2}$. The equations of motion are\n$$\n\\ddot{x} - 2 \\dot{y} = \\frac{\\partial \\Omega}{\\partial x}, \\quad \\ddot{y} + 2 \\dot{x} = \\frac{\\partial \\Omega}{\\partial y},\n$$\nwith\n$$\n\\frac{\\partial \\Omega}{\\partial x} = x - \\frac{(1 - \\mu)(x + \\mu)}{r_1^3} - \\frac{\\mu(x - 1 + \\mu)}{r_2^3}, \\quad \\frac{\\partial \\Omega}{\\partial y} = y - \\frac{(1 - \\mu)y}{r_1^3} - \\frac{\\mu y}{r_2^3}.\n$$\nThe Jacobi constant is defined as\n$$\nC = 2 \\Omega(x,y) - \\left(\\dot{x}^2 + \\dot{y}^2\\right).\n$$\n\nYour task is to compute a Poincaré section at $y = 0$ with $\\dot{y}  0$ for the Earth–Moon mass parameter $\\mu = 0.0121506$ and Jacobi constant $C = 3.1$. Specifically:\n\n1. For each initial condition with $y(0) = 0$, $\\dot{x}(0) = 0$, and chosen $x(0)$, compute $\\dot{y}(0)  0$ from the Jacobi constant constraint $C = 2 \\Omega(x(0), 0) - \\left(\\dot{x}(0)^2 + \\dot{y}(0)^2\\right)$, i.e.,\n$$\n\\dot{y}(0) = \\sqrt{2 \\Omega\\!\\left(x(0), 0\\right) - C}.\n$$\nDiscard any $x(0)$ for which the radicand is negative.\n\n2. Integrate the CR3BP equations of motion and record successive intersections with the Poincaré section defined by $y = 0$ and $\\dot{y}  0$. Use radians for any angular measure and the canonical CR3BP units described above. Ensure numerical integration is stable and respects the singular nature of motion near the primaries (e.g., do not allow $r_1$ or $r_2$ to approach zero).\n\n3. Using only the set of recorded section points $(x, \\dot{x})$ at $y = 0$, classify the observed structure for each initial condition as either an \"island\" (thin, quasi-one-dimensional curve indicative of regular motion) or a \"stochastic layer\" (area-filling scatter indicative of chaotic transport). Your classification must be based on rigorous, quantitative criteria derived from the geometry of the recorded points; for example, by comparing principal component variances of $(x, \\dot{x})$ and an occupancy fraction over a uniform grid covering the data extent. You must define and justify your thresholds, and the criteria must be applied consistently across all test cases.\n\n4. Implement event detection such that crossings at $y = 0$ with $\\dot{y}  0$ are correctly detected. Ignore the trivial initial \"intersection\" at $t = 0$. Terminate integrations that approach within a small distance of either primary to avoid singularities, and treat such cases according to your classification logic in a principled way.\n\nUse the following test suite of initial positions $x(0)$:\n- $x(0) = -0.5$\n- $x(0) = 0.5$\n- $x(0) = 0.9$\n- $x(0) = 1.05$\n- $x(0) = 1.2$\n\nFor each initial condition, compute at least $N = 200$ valid section crossings (unless a termination condition is reached) before classification.\n\nFinal output format: Your program should produce a single line of output containing the classification results for the five test cases as a comma-separated list of integers enclosed in square brackets, where $0$ indicates \"island\" and $1$ indicates \"stochastic layer\" (e.g., \"[0,1,0,1,0]\"). No additional text should be printed.\n\nAll quantities are to be expressed in the canonical CR3BP units described, and angles (if any) are in radians. The results must be presented exactly as specified above.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and complete.\n\n### Step 1: Extract Givens\n- **System**: Planar Circular Restricted Three-Body Problem (CR3BP) in a synodic (rotating) frame.\n- **Units**: Canonical (distance between primaries is $1$, total mass is $1$, angular velocity is $1$).\n- **Masses**: Primary masses $m_1 = 1 - \\mu$ and $m_2 = \\mu$ at $(-\\mu, 0)$ and $(1 - \\mu, 0)$ respectively.\n- **Potential**: Effective potential $\\Omega(x,y) = \\frac{1}{2}(x^2 + y^2) + \\frac{1 - \\mu}{r_1} + \\frac{\\mu}{r_2}$, with $r_1 = \\sqrt{(x + \\mu)^2 + y^2}$ and $r_2 = \\sqrt{(x - 1 + \\mu)^2 + y^2}$.\n- **Equations of Motion (EOM)**: $\\ddot{x} - 2 \\dot{y} = \\frac{\\partial \\Omega}{\\partial x}$ and $\\ddot{y} + 2 \\dot{x} = \\frac{\\partial \\Omega}{\\partial y}$.\n- **Jacobi Constant**: $C = 2 \\Omega(x,y) - \\left(\\dot{x}^2 + \\dot{y}^2\\right)$.\n- **Parameters**: Earth-Moon mass parameter $\\mu = 0.0121506$, Jacobi constant $C = 3.1$.\n- **Task**: Compute a Poincaré section at $y = 0$ with $\\dot{y}  0$.\n- **Initial Conditions**: For a given $x(0)$, we have $y(0) = 0$, $\\dot{x}(0) = 0$, and $\\dot{y}(0) = \\sqrt{2 \\Omega(x(0), 0) - C}$.\n- **Test Cases**: Initial positions $x(0) \\in \\{-0.5, 0.5, 0.9, 1.05, 1.2\\}$.\n- **Integration Requirements**: Collect at least $N = 200$ section crossings, ignoring the initial state at $t=0$. Terminate integration if the trajectory approaches too close to either primary.\n- **Classification Task**: Classify the resulting set of Poincaré section points $(x, \\dot{x})$ as \"island\" (code $0$) or \"stochastic layer\" (code $1$) based on a quantitative, justified criterion.\n- **Output**: A comma-separated list of integer classifications for the test cases, in the format `[c1,c2,c3,c4,c5]`.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard exercise in computational celestial mechanics and nonlinear dynamics.\n- **Scientific Grounding**: The CR3BP model, equations of motion, effective potential, and Jacobi constant are all fundamental and correctly stated concepts in astrodynamics. The use of Poincaré sections to analyze the phase space structure is a canonical technique.\n- **Well-Posedness**: The problem provides a system of ordinary differential equations (ODEs), well-defined initial conditions derived from the Jacobi integral, and a clear objective. The classification task, while requiring the definition of a criterion, is a standard problem in data analysis for dynamical systems.\n- **Completeness and Consistency**: All necessary constants ($\\mu$, $C$), equations, and initial conditions are provided. There are no contradictions.\n- **Feasibility**: The numerical integration of the CR3BP equations and the collection of Poincaré section points are computationally feasible tasks. The classification based on the geometry of these points is also programmatically achievable.\n- **Objectivity**: The problem is stated in precise mathematical terms. The requirement for a \"rigorous, quantitative\" classification criterion removes subjectivity.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A solution will be constructed following the specified guidelines.\n\n***\n\n### Solution Design\n\nThe solution involves numerically integrating the CR3BP equations of motion for several initial conditions and analyzing the resulting Poincaré sections to classify the dynamics as regular (island) or chaotic (stochastic layer).\n\n#### 1. System of First-Order ODEs\nThe two second-order EOMs are converted into a system of four first-order ODEs. Let the state vector be $S = (x, y, v_x, v_y)^T$, where $v_x = \\dot{x}$ and $v_y = \\dot{y}$. The system is:\n$$\n\\frac{d}{dt}\n\\begin{pmatrix} x \\\\ y \\\\ v_x \\\\ v_y \\end{pmatrix}\n=\n\\begin{pmatrix} v_x \\\\ v_y \\\\ 2v_y + \\frac{\\partial \\Omega}{\\partial x} \\\\ -2v_x + \\frac{\\partial \\Omega}{\\partial y} \\end{pmatrix}\n$$\nThe partial derivatives of the effective potential $\\Omega$ are given by:\n$$\n\\frac{\\partial \\Omega}{\\partial x} = x - \\frac{(1 - \\mu)(x + \\mu)}{r_1^3} - \\frac{\\mu(x - 1 + \\mu)}{r_2^3}\n$$\n$$\n\\frac{\\partial \\Omega}{\\partial y} = y - \\frac{(1 - \\mu)y}{r_1^3} - \\frac{\\mu y}{r_2^3}\n$$\nwhere $r_1 = \\sqrt{(x + \\mu)^2 + y^2}$ and $r_2 = \\sqrt{(x - 1 + \\mu)^2 + y^2}$. This system is implemented as the core function for a numerical ODE solver.\n\n#### 2. Initial Conditions\nFor each test case specified by an initial position $x_0 = x(0)$, the initial state vector $S(0) = (x_0, 0, 0, \\dot{y}_0)$ is determined. The initial velocity component $\\dot{y}_0 = \\dot{y}(0)$ is calculated from the Jacobi constant $C = 3.1$. At $t=0$, we have $y(0)=0$ and $\\dot{x}(0)=0$, so the Jacobi relation becomes:\n$$\nC = 2 \\Omega(x_0, 0) - \\left(0^2 + \\dot{y}_0^2\\right)\n$$\nSolving for $\\dot{y}_0$, we get:\n$$\n\\dot{y}_0 = \\sqrt{2 \\Omega(x_0, 0) - C}\n$$\nThe condition specifies using $\\dot{y}_0  0$. The radicand $2 \\Omega(x_0, 0) - C$ must be non-negative for a real velocity to exist, defining the Hill's region for zero-velocity curves. All provided test cases yield a positive radicand.\n\n#### 3. Numerical Integration and Event Detection\nThe `scipy.integrate.solve_ivp` function is used for numerical integration, chosen for its robustness and built-in event detection capabilities. High precision is maintained by setting the relative and absolute error tolerances to $10^{-11}$.\n\nTwo events are defined to control the integration:\n1.  **Poincaré Section Crossing**: An event function `event_y_zero` triggers when $y(t) = 0$. The solver is configured to detect all such crossings (from positive or negative $y$) and to continue the integration. After a crossing is detected, a check is performed on the state to ensure that $\\dot{y}  0$. The point $(x, \\dot{x})$ is recorded only if this condition is met. The trivial initial point at $t=0$ is explicitly ignored.\n2.  **Primary Proximity Termination**: An event function `event_near_primary` triggers if the trajectory's distance to either primary, $r_1$ or $r_2$, falls below a small threshold, $\\epsilon_{term} = 10^{-3}$. This event is terminal, halting the integration to prevent numerical instabilities and singularities associated with a close approach or collision.\n\nThe integration proceeds in segments until at least $N = 200$ valid Poincaré section points are collected or a termination event occurs. A maximum total integration time is also imposed to prevent infinite loops.\n\n#### 4. Classification Criterion: Principal Component Analysis (PCA)\nThe geometric structure of the collected Poincaré section points $(x, \\dot{x})$ is analyzed to classify the trajectory.\n-   **Regular Orbits (Islands)**: These are quasi-periodic and trace out a thin, one-dimensional, closed curve in the Poincaré section.\n-   **Chaotic Orbits (Stochastic Layers)**: These orbits are not confined to a smooth manifold and fill a two-dimensional area in the section.\n\nTo quantitatively distinguish between these two cases, Principal Component Analysis (PCA) is applied to the set of $N$ collected points. PCA identifies the principal axes of the data distribution, and the eigenvalues of the data's covariance matrix, $\\lambda_{min}$ and $\\lambda_{max}$, correspond to the variance along these axes.\n\nThe classification logic is as follows:\n1.  Assemble the collected points $\\{(x_i, v_{x,i})\\}_{i=1}^N$ into a $N \\times 2$ matrix.\n2.  Calculate the $2 \\times 2$ covariance matrix of this dataset.\n3.  Compute its two eigenvalues, $\\lambda_{min}$ and $\\lambda_{max}$ (where $\\lambda_{min} \\le \\lambda_{max}$).\n4.  Calculate the ratio $R_{PCA} = \\lambda_{min} / \\lambda_{max}$. This ratio measures the eccentricity of the point cloud. For a line-like structure (island), $\\lambda_{min} \\ll \\lambda_{max}$, so $R_{PCA} \\approx 0$. For an area-filling distribution (stochastic layer), $\\lambda_{min}$ is comparable to $\\lambda_{max}$, so $R_{PCA}$ is significantly greater than $0$.\n5.  A threshold is established: if $R_{PCA}  0.01$, the structure is classified as an \"island\" (0). Otherwise, it is a \"stochastic layer\" (1). This threshold signifies that if the variance in the \"thin\" direction is less than $1\\%$ of the variance in the \"long\" direction, the structure is considered one-dimensional.\n\nThis criterion is applied consistently to all test cases.\n\n#### 5. Handling of Special Cases\n-   **Premature Termination**: If the integration is terminated due to proximity to a primary, the trajectory is exhibiting strong instability, a hallmark of chaotic motion. Therefore, such cases are immediately classified as a \"stochastic layer\" (1), provided a minimum number of points (e.g., $10$) have been collected to ensure the behavior is not an initial transient artifact.\n-   **Insufficient Points**: If the integration times out before collecting a minimum of $20$ points, it's difficult to perform a reliable PCA. This scenario (e.g., a trajectory escaping the system slowly) is also characteristic of chaotic or boundary dynamics and is classified as \"stochastic layer\" (1).\n\nThis comprehensive approach ensures a robust and principled classification for each initial condition based on the numerically observed dynamics.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to solve the CR3BP classification problem for the given test cases.\n    \"\"\"\n\n    # --- Constants and System Parameters ---\n    MU = 0.0121506\n    C = 3.1\n    X1 = -MU\n    X2 = 1.0 - MU\n\n    # --- Simulation and Classification Parameters ---\n    N_POINTS = 200\n    MIN_POINTS_FOR_PCA = 20\n    EPS_TERMINATION = 1e-3\n    PCA_THRESHOLD = 0.01\n    RTOL = 1e-11\n    ATOL = 1e-11\n    MAX_INTEGRATION_TIME_TOTAL = 5000.0\n    MAX_INTEGRATION_TIME_STEP = 500.0\n\n    # --- Equations of Motion ---\n    def derivatives(_, state):\n        \"\"\"\n        Computes the time derivatives for the CR3BP state vector [x, y, vx, vy].\n        \"\"\"\n        x, y, vx, vy = state\n        \n        r1_sq = (x - X1)**2 + y**2\n        r2_sq = (x - X2)**2 + y**2\n        \n        # Add a small epsilon to avoid division by zero if an event doesn't trigger perfectly.\n        r1 = np.sqrt(r1_sq) + 1e-12\n        r2 = np.sqrt(r2_sq) + 1e-12\n\n        r1_cubed = r1**3\n        r2_cubed = r2**3\n        \n        # Acceleration components from the effective potential gradient\n        ax = x - (1.0 - MU) * (x - X1) / r1_cubed - MU * (x - X2) / r2_cubed\n        ay = y - (1.0 - MU) * y / r1_cubed - MU * y / r2_cubed\n\n        # Full equations of motion in the rotating frame\n        dvx = 2.0 * vy + ax\n        dvy = -2.0 * vx + ay\n        \n        return [vx, vy, dvx, dvy]\n\n    # --- Event Handlers for Integration ---\n    def event_y_zero(_, state):\n        \"\"\"Event function to detect crossings of the y=0 plane.\"\"\"\n        return state[1]\n    event_y_zero.terminal = False\n    event_y_zero.direction = 0  # Detect all zero-crossings\n\n    def event_near_primary(_, state):\n        \"\"\"Event function to terminate integration near primaries.\"\"\"\n        x, y, _, _ = state\n        r1 = np.sqrt((x - X1)**2 + y**2)\n        r2 = np.sqrt((x - X2)**2 + y**2)\n        return min(r1, r2) - EPS_TERMINATION\n    event_near_primary.terminal = True\n    event_near_primary.direction = -1 # Trigger when distance goes below threshold\n\n    def classify_trajectory(x0):\n        \"\"\"\n        Integrates a trajectory and classifies its Poincare section.\n        Returns 0 for 'island', 1 for 'stochastic layer'.\n        \"\"\"\n        # 1. Calculate Initial Conditions\n        r1_0 = abs(x0 - X1)\n        r2_0 = abs(x0 - X2)\n        omega_0 = 0.5 * x0**2 + (1.0 - MU) / r1_0 + MU / r2_0\n        \n        radicand = 2.0 * omega_0 - C\n        if radicand  0:\n            # Trajectory is in a forbidden region, which implies instability.\n            return 1\n            \n        dy0 = np.sqrt(radicand)\n        S0 = [x0, 0.0, 0.0, dy0]\n\n        # 2. Integrate and Collect Poincare Points\n        poincare_points = []\n        current_S = np.array(S0)\n        current_t = 0.0\n        terminated_early = False\n\n        while len(poincare_points)  N_POINTS and current_t  MAX_INTEGRATION_TIME_TOTAL:\n            t_span = (current_t, current_t + MAX_INTEGRATION_TIME_STEP)\n            sol = solve_ivp(\n                derivatives,\n                t_span,\n                current_S,\n                method='DOP853',\n                events=(event_y_zero, event_near_primary),\n                dense_output=True,\n                rtol=RTOL,\n                atol=ATOL,\n            )\n\n            # Process y=0 crossing events\n            y_crossing_times = sol.t_events[0]\n            if y_crossing_times.size > 0:\n                y_crossing_states = sol.sol(y_crossing_times)\n                for i in range(y_crossing_states.shape[1]):\n                    t_event = y_crossing_times[i]\n                    state_event = y_crossing_states[:, i]\n                    # Ignore trivial initial crossing and ensure dy/dt > 0\n                    if t_event > 1e-9 and state_event[3] > 0:\n                        poincare_points.append((state_event[0], state_event[2]))\n                        if len(poincare_points) >= N_POINTS:\n                            break\n            \n            # Check for termination events\n            if sol.status == 1:  # Integration terminated by an event\n                if sol.t_events[1].size > 0: # Near-primary event\n                    terminated_early = True\n                break\n\n            current_t = sol.t[-1]\n            current_S = sol.y[:, -1]\n        \n        # 3. Classify Based on Collected Data\n        if terminated_early:\n            return 1 # Classified as chaotic due to primary proximity\n\n        if len(poincare_points)  MIN_POINTS_FOR_PCA:\n             # Insufficient points collected, implies chaotic escape or unstable orbit\n            return 1\n\n        # Perform PCA on the (x, vx) points\n        data = np.array(poincare_points)\n        cov_matrix = np.cov(data, rowvar=False)\n        eigenvalues = np.linalg.eigvalsh(cov_matrix) # Returns sorted eigenvalues\n        \n        # Ratio of smallest to largest eigenvalue\n        # For a perfect line, smallest eigenvalue is 0.\n        if eigenvalues[1]  1e-12: # Avoid division by zero if variance is nil\n             return 0\n        ratio = eigenvalues[0] / eigenvalues[1]\n\n        if ratio  PCA_THRESHOLD:\n            return 0  # 'island'\n        else:\n            return 1  # 'stochastic layer'\n\n    # --- Run Test Cases ---\n    test_cases = [-0.5, 0.5, 0.9, 1.05, 1.2]\n    results = []\n    for x0 in test_cases:\n        results.append(classify_trajectory(x0))\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}