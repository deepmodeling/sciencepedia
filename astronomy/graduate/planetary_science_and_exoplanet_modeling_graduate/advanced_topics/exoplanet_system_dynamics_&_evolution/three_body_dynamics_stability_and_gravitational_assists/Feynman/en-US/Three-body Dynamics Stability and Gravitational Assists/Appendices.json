{
    "hands_on_practices": [
        {
            "introduction": "The Jacobi constant is a cornerstone of the Circular Restricted Three-Body Problem (CR3BP), serving as the sole known integral of motion. This conserved quantity, analogous to energy in an inertial frame, defines the regions of space accessible to a particle and is crucial for understanding orbital stability and trajectory design. This practice  challenges you to derive this vital constant from first principles and then apply it to a concrete scenario, bridging the gap between abstract theory and practical calculation.",
            "id": "4186008",
            "problem": "Consider the Circular Restricted Three-Body Problem (CR3BP), defined as the motion of a test particle of negligible mass under the gravitational influence of two primary bodies with masses $1-\\mu$ and $\\mu$ moving in circular orbits about their common center of mass. Work in nondimensional canonical units where the total mass is $1$, the separation of the primaries is $1$, and the angular speed of the uniformly rotating synodic frame is $1$. In this frame, the primaries are fixed at positions $(-\\mu,0,0)$ and $(1-\\mu,0,0)$ along the $x$-axis.\n\nStarting from Newton’s law of universal gravitation and Newton’s second law in a uniformly rotating frame, derive the effective potential $\\Omega(x,y,z)$ that combines the gravitational contributions of the two primaries with the centrifugal potential, and hence derive the Jacobi integral $C$ as a constant of motion. Then, for the specific mass ratio $\\mu=0.01$, evaluate the Jacobi constant for the test particle state $(x,y,z)=(0.5,0,0)$ with velocities $(\\dot{x},\\dot{y},\\dot{z})=(0,0.2,0)$.\n\nExpress your final answer as a single exact rational number with no units. No rounding is required.",
            "solution": "The Circular Restricted Three-Body Problem (CR3BP) models a test particle moving under the gravitational fields of two primaries of masses $1-\\mu$ and $\\mu$ that revolve in circular orbits. In nondimensional canonical units, the separation of the primaries is $1$, the total mass is $1$, and the mean motion (angular speed) of the rotating synodic frame is $1$. In the synodic frame, the primaries are fixed at $(-\\mu,0,0)$ and $(1-\\mu,0,0)$.\n\nWe begin with Newton’s second law in an inertial frame and transform to the uniformly rotating frame. In the rotating frame with angular velocity vector $\\boldsymbol{\\omega}$ of magnitude $1$ aligned with the $z$-axis, the acceleration of the particle includes fictitious forces: the Coriolis acceleration $-2\\,\\boldsymbol{\\omega}\\times\\dot{\\mathbf{r}}$ and the centrifugal acceleration $-\\boldsymbol{\\omega}\\times(\\boldsymbol{\\omega}\\times\\mathbf{r})$. With $\\boldsymbol{\\omega}=(0,0,1)$ and $\\mathbf{r}=(x,y,z)$, these contribute the terms $-2\\,\\hat{\\mathbf{z}}\\times\\dot{\\mathbf{r}}$ and $-\\hat{\\mathbf{z}}\\times(\\hat{\\mathbf{z}}\\times\\mathbf{r})$. The gravitational acceleration is derived from the sum of gravitational potentials of the primaries.\n\nLet $r_1$ and $r_2$ denote the distances from the particle to the primaries:\n$$\nr_1=\\sqrt{(x+\\mu)^2+y^2+z^2}, \\qquad r_2=\\sqrt{(x-1+\\mu)^2+y^2+z^2}.\n$$\nThe gravitational potential per unit mass of the test particle is\n$$\nU(x,y,z)=-\\frac{1-\\mu}{r_1}-\\frac{\\mu}{r_2}.\n$$\nIn the rotating frame, the centrifugal potential per unit mass is\n$$\n\\Phi_{\\text{cf}}(x,y,z)=-\\frac{1}{2}\\left(x^2+y^2\\right),\n$$\nsince $\\boldsymbol{\\omega}$ has unit magnitude and is aligned with the $z$-axis. It is standard to define the effective potential $\\Omega(x,y,z)$ as the negative of the sum of these potentials (so that its gradient produces the non-Coriolis parts of the equations of motion):\n$$\n\\Omega(x,y,z)=\\frac{1-\\mu}{r_1}+\\frac{\\mu}{r_2}+\\frac{1}{2}\\left(x^2+y^2\\right).\n$$\n\nThe equations of motion in the rotating frame can be written as\n$$\n\\ddot{x}-2\\dot{y}=\\frac{\\partial \\Omega}{\\partial x}, \\qquad\n\\ddot{y}+2\\dot{x}=\\frac{\\partial \\Omega}{\\partial y}, \\qquad\n\\ddot{z}=\\frac{\\partial \\Omega}{\\partial z}.\n$$\nTo derive the Jacobi integral, multiply the first equation by $\\dot{x}$, the second by $\\dot{y}$, and the third by $\\dot{z}$, and sum:\n$$\n\\dot{x}\\ddot{x}+\\dot{y}\\ddot{y}+\\dot{z}\\ddot{z}-2\\dot{x}\\dot{y}+2\\dot{y}\\dot{x}\n= \\dot{x}\\frac{\\partial\\Omega}{\\partial x}+\\dot{y}\\frac{\\partial\\Omega}{\\partial y}+\\dot{z}\\frac{\\partial\\Omega}{\\partial z}.\n$$\nThe Coriolis terms cancel, yielding\n$$\n\\frac{d}{dt}\\left(\\frac{1}{2}\\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right)\\right)\n= \\frac{d}{dt}\\,\\Omega(x,y,z).\n$$\nRearranging,\n$$\n\\frac{d}{dt}\\left(\\Omega - \\frac{1}{2}\\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right)\\right)=0,\n$$\nso the quantity $\\Omega - \\frac{1}{2}\\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right)$ is constant along trajectories. By convention, the Jacobi integral $C$ is defined as\n$$\nC=2\\,\\Omega - \\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right).\n$$\n\nWe now evaluate $C$ for the given state with $\\mu=0.01$, position $(x,y,z)=(0.5,0,0)$, and velocity $(\\dot{x},\\dot{y},\\dot{z})=(0,0.2,0)$.\n\nFirst compute the distances to the primaries:\n$$\nr_1=\\sqrt{(x+\\mu)^2+y^2+z^2}=\\sqrt{(0.5+0.01)^2+0^2+0^2}=\\sqrt{0.51^2}=0.51,\n$$\n$$\nr_2=\\sqrt{(x-1+\\mu)^2+y^2+z^2}=\\sqrt{(0.5-1+0.01)^2+0^2+0^2}=\\sqrt{(-0.49)^2}=0.49.\n$$\nThe effective potential at this state is\n$$\n\\Omega=\\frac{1-\\mu}{r_1}+\\frac{\\mu}{r_2}+\\frac{1}{2}(x^2+y^2)\n=\\frac{0.99}{0.51}+\\frac{0.01}{0.49}+\\frac{1}{2}(0.5^2).\n$$\nRewrite each term as an exact rational number:\n$$\n\\frac{0.99}{0.51}=\\frac{99/100}{51/100}=\\frac{99}{51}=\\frac{33}{17}, \\qquad\n\\frac{0.01}{0.49}=\\frac{1/100}{49/100}=\\frac{1}{49}, \\qquad\n\\frac{1}{2}(0.5^2)=\\frac{1}{2}\\cdot\\frac{1}{4}=\\frac{1}{8}.\n$$\nThus,\n$$\n\\Omega=\\frac{33}{17}+\\frac{1}{49}+\\frac{1}{8}.\n$$\nThe squared speed is\n$$\n\\dot{x}^2+\\dot{y}^2+\\dot{z}^2=0^2+0.2^2+0^2=0.04=\\frac{4}{100}=\\frac{1}{25}.\n$$\nTherefore, the Jacobi constant is\n$$\nC=2\\,\\Omega - \\left(\\dot{x}^2+\\dot{y}^2+\\dot{z}^2\\right)\n=2\\left(\\frac{33}{17}+\\frac{1}{49}+\\frac{1}{8}\\right)-\\frac{1}{25}\n=\\frac{66}{17}+\\frac{2}{49}+\\frac{1}{4}-\\frac{1}{25}.\n$$\nCombine as a single rational number using the common denominator $83{,}300=17\\cdot 49 \\cdot 100$:\n$$\n\\frac{66}{17}=\\frac{323{,}400}{83{,}300}, \\quad\n\\frac{2}{49}=\\frac{3{,}400}{83{,}300}, \\quad\n\\frac{1}{4}=\\frac{20{,}825}{83{,}300}, \\quad\n\\frac{1}{25}=\\frac{3{,}332}{83{,}300},\n$$\nso\n$$\nC=\\frac{323{,}400+3{,}400+20{,}825-3{,}332}{83{,}300}=\\frac{344{,}293}{83{,}300}.\n$$\nThis fraction is in lowest terms because the denominator factors as $2^2\\cdot 5^2\\cdot 7^2\\cdot 17$ and the numerator is not divisible by $2$, $5$, $7$, or $17$.\n\nHence, the Jacobi constant at the specified state is exactly $\\frac{344{,}293}{83{,}300}$.",
            "answer": "$$\\boxed{\\frac{344293}{83300}}$$"
        },
        {
            "introduction": "Gravitational assists, or \"slingshot maneuvers,\" are a striking application of three-body dynamics, enabling ambitious interplanetary missions. By treating a close flyby as a hyperbolic two-body encounter in the planet's reference frame, we can precisely calculate the resulting change in the spacecraft's velocity vector, $\\Delta \\mathbf{v}$. This exercise  walks you through the derivation of the \"velocity kick,\" offering a hands-on understanding of how energy is exchanged during these critical maneuvers and empowering you to quantify their effect.",
            "id": "4186021",
            "problem": "A small test particle on a heliocentric orbit undergoes a close planetary flyby that can be modeled as a two-body hyperbolic encounter in the planet-centered frame. Assume Newtonian gravity with gravitational parameter $\\mu = G M$, and neglect the gravitational influence of the star during the brief encounter. The particle approaches a planet of mass $M_{\\mathrm{J}}$ (Jupiter mass) with asymptotic speed $v_{\\infty}$ and impact parameter $b$. The gravitational focusing by the planet deflects the trajectory by some scattering angle, rotating the asymptotic velocity vector while preserving its magnitude in the planet-centered frame.\n\nStarting from conservation of energy and angular momentum for the two-body problem, derive the hyperbolic-scattering relation between the impact parameter $b$, the asymptotic speed $v_{\\infty}$, and the scattering angle. Then, use this to obtain an expression for the magnitude of the velocity kick $\\Delta v$ defined as the norm of the difference between the outgoing and incoming asymptotic velocity vectors in the planet-centered frame. Finally, evaluate $\\Delta v$ for the following parameters:\n- $b = 0.01\\,\\mathrm{AU}$ where $1\\,\\mathrm{AU} = 1.495978707\\times 10^{11}\\,\\mathrm{m}$,\n- $v_{\\infty} = 5\\,\\mathrm{km/s}$,\n- $M_{\\mathrm{J}} = 1.89813\\times 10^{27}\\,\\mathrm{kg}$,\n- $G = 6.67430\\times 10^{-11}\\,\\mathrm{m^{3}\\,kg^{-1}\\,s^{-2}}$.\n\nExpress your final answer for $\\Delta v$ in $\\mathrm{m/s}$ and round your answer to four significant figures.",
            "solution": "The problem is to derive the velocity change of a test particle after a hyperbolic flyby of a planet and then calculate its value for a given set of parameters. The solution proceeds in three stages: first, deriving the relationship between the encounter parameters and the geometry of the trajectory; second, deriving an expression for the magnitude of the velocity change, $\\Delta v$; and third, calculating the numerical value of $\\Delta v$.\n\nThe analysis is performed in the planet-centered reference frame, assuming a two-body problem governed by Newtonian gravity. The gravitational parameter of the planet is $\\mu = G M_{\\mathrm{J}}$.\n\n**Part 1: Derivation of the Hyperbolic Scattering Relation**\n\nIn the two-body problem, both the specific mechanical energy, $\\mathcal{E}$, and the specific angular momentum vector, $\\mathbf{h}$, are conserved quantities.\n\nThe specific mechanical energy is given by:\n$$ \\mathcal{E} = \\frac{1}{2}v^2 - \\frac{\\mu}{r} $$\nwhere $v$ is the speed of the particle and $r$ is its distance from the planet. At an infinite distance from the planet ($r \\to \\infty$), the particle's speed is the asymptotic approach speed, $v_{\\infty}$. At this limit, the potential energy term vanishes, so the energy is:\n$$ \\mathcal{E} = \\frac{1}{2}v_{\\infty}^2 $$\nSince $\\mathcal{E}$ is a constant of motion, its value is positive for any $v_{\\infty} > 0$, which confirms that the trajectory is hyperbolic.\n\nThe specific angular momentum is given by $\\mathbf{h} = \\mathbf{r} \\times \\mathbf{v}$. Its magnitude, $h = \\|\\mathbf{h}\\|$, is also conserved. At a great distance from the planet, the trajectory is asymptotically a straight line. The impact parameter, $b$, is defined as the perpendicular distance between the planet and this initial asymptotic path. Thus, the magnitude of the angular momentum can be calculated at infinity as:\n$$ h = b v_{\\infty} $$\n\nThe eccentricity, $e$, of a conic section is related to the energy and angular momentum by the formula:\n$$ e = \\sqrt{1 + \\frac{2\\mathcal{E}h^2}{\\mu^2}} $$\nSubstituting the expressions for $\\mathcal{E}$ and $h$ in terms of the flyby parameters $v_{\\infty}$ and $b$:\n$$ e = \\sqrt{1 + \\frac{2 \\left(\\frac{1}{2}v_{\\infty}^2\\right) (b v_{\\infty})^2}{\\mu^2}} = \\sqrt{1 + \\frac{v_{\\infty}^4 b^2}{\\mu^2}} = \\sqrt{1 + \\left(\\frac{b v_{\\infty}^2}{\\mu}\\right)^2} $$\nThis equation relates the eccentricity of the hyperbolic trajectory to the initial conditions of the encounter.\n\nNext, we relate the eccentricity to the scattering angle, $\\delta$. The polar equation for a hyperbolic trajectory is $r(\\theta) = \\frac{p}{1 + e \\cos\\theta}$, where $p$ is the semi-latus rectum and $\\theta$ is the true anomaly measured from the periapsis. The asymptotes of the hyperbola correspond to the directions where $r \\to \\infty$, which occurs when the denominator $1 + e \\cos\\theta \\to 0$. This gives the true anomaly of the asymptotes, $\\theta_{\\infty}$, as:\n$$ \\cos\\theta_{\\infty} = -\\frac{1}{e} $$\nThe particle approaches from $\\theta = -\\theta_{\\infty}$ and recedes towards $\\theta = +\\theta_{\\infty}$. The scattering angle, $\\delta$, is the angle between the incoming and outgoing asymptotic velocity vectors. From the geometry of the hyperbola, the total angle turned by the velocity vector is related to the angle between the asymptotes. The angle between the axis of symmetry and each asymptote is $\\theta_{\\infty}$. The deflection angle $\\delta$ is given by the relation $\\delta = 2\\theta_{\\infty} - \\pi$.\n\nFrom this, we can write:\n$$ \\frac{\\delta + \\pi}{2} = \\theta_{\\infty} $$\nTaking the cosine of both sides:\n$$ \\cos\\left(\\frac{\\delta}{2} + \\frac{\\pi}{2}\\right) = \\cos(\\theta_{\\infty}) $$\nUsing the trigonometric identity $\\cos(x + \\frac{\\pi}{2}) = -\\sin(x)$, we have:\n$$ -\\sin\\left(\\frac{\\delta}{2}\\right) = -\\frac{1}{e} $$\nThis simplifies to a fundamental relation for hyperbolic scattering:\n$$ \\sin\\left(\\frac{\\delta}{2}\\right) = \\frac{1}{e} $$\nCombining this with the expression for eccentricity, we obtain the desired scattering relation between $\\delta$, $b$, and $v_{\\infty}$:\n$$ \\sin\\left(\\frac{\\delta}{2}\\right) = \\frac{1}{\\sqrt{1 + \\left(\\frac{b v_{\\infty}^2}{\\mu}\\right)^2}} $$\nAn alternative and often-used form is found by relating $\\cot(\\delta/2)$ to $e$:\n$$ \\cot^2\\left(\\frac{\\delta}{2}\\right) = \\frac{1}{\\sin^2(\\delta/2)} - 1 = e^2 - 1 = \\left(\\frac{b v_{\\infty}^2}{\\mu}\\right)^2 $$\nTaking the positive square root gives:\n$$ \\cot\\left(\\frac{\\delta}{2}\\right) = \\frac{b v_{\\infty}^2}{\\mu} $$\n\n**Part 2: Derivation of the Velocity Kick Magnitude, $\\Delta v$**\n\nThe velocity kick, $\\Delta\\mathbf{v}$, is the vector difference between the outgoing asymptotic velocity, $\\mathbf{v}_{\\text{out}}$, and the incoming asymptotic velocity, $\\mathbf{v}_{\\text{in}}$:\n$$ \\Delta\\mathbf{v} = \\mathbf{v}_{\\text{out}} - \\mathbf{v}_{\\text{in}} $$\nIn the planet-centered frame, the encounter only rotates the velocity vector; its magnitude is conserved at infinity. Thus, $\\|\\mathbf{v}_{\\text{in}}\\| = \\|\\mathbf{v}_{\\text{out}}\\| = v_{\\infty}$. The angle between these two vectors is the scattering angle, $\\delta$.\n\nThe magnitude of the velocity kick, $\\Delta v = \\|\\Delta\\mathbf{v}\\|$, can be found by considering the square of the norm:\n$$ (\\Delta v)^2 = \\|\\Delta\\mathbf{v}\\|^2 = (\\mathbf{v}_{\\text{out}} - \\mathbf{v}_{\\text{in}}) \\cdot (\\mathbf{v}_{\\text{out}} - \\mathbf{v}_{\\text{in}}) $$\n$$ (\\Delta v)^2 = \\|\\mathbf{v}_{\\text{out}}\\|^2 + \\|\\mathbf{v}_{\\text{in}}\\|^2 - 2 \\mathbf{v}_{\\text{out}} \\cdot \\mathbf{v}_{\\text{in}} $$\n$$ (\\Delta v)^2 = v_{\\infty}^2 + v_{\\infty}^2 - 2 (v_{\\infty})(v_{\\infty}) \\cos(\\delta) = 2v_{\\infty}^2(1 - \\cos\\delta) $$\nUsing the half-angle identity $1 - \\cos\\delta = 2\\sin^2(\\delta/2)$:\n$$ (\\Delta v)^2 = 2v_{\\infty}^2 \\left(2\\sin^2\\left(\\frac{\\delta}{2}\\right)\\right) = 4v_{\\infty}^2 \\sin^2\\left(\\frac{\\delta}{2}\\right) $$\nTaking the square root, and noting that $\\delta \\in [0, \\pi]$ so $\\sin(\\delta/2) \\geq 0$:\n$$ \\Delta v = 2 v_{\\infty} \\sin\\left(\\frac{\\delta}{2}\\right) $$\nNow, we use the scattering relation $\\sin(\\delta/2) = 1/e$ derived in the previous part:\n$$ \\Delta v = \\frac{2 v_{\\infty}}{e} $$\nSubstituting the expression for $e$ gives the final formula for $\\Delta v$ in terms of the initial parameters:\n$$ \\Delta v = \\frac{2 v_{\\infty}}{\\sqrt{1 + \\left(\\frac{b v_{\\infty}^2}{G M_{\\mathrm{J}}}\\right)^2}} $$\n\n**Part 3: Numerical Evaluation**\n\nWe are given the following parameters, which must be converted to SI units:\n- $b = 0.01\\,\\mathrm{AU} = 0.01 \\times (1.495978707\\times 10^{11}\\,\\mathrm{m}) = 1.495978707 \\times 10^9\\,\\mathrm{m}$\n- $v_{\\infty} = 5\\,\\mathrm{km/s} = 5 \\times 10^3\\,\\mathrm{m/s}$\n- $M_{\\mathrm{J}} = 1.89813\\times 10^{27}\\,\\mathrm{kg}$\n- $G = 6.67430\\times 10^{-11}\\,\\mathrm{m^{3}\\,kg^{-1}\\,s^{-2}}$\n\nFirst, calculate the gravitational parameter for Jupiter, $\\mu_{\\mathrm{J}}$:\n$$ \\mu_{\\mathrm{J}} = G M_{\\mathrm{J}} = (6.67430\\times 10^{-11}\\,\\mathrm{m^{3}\\,kg^{-1}\\,s^{-2}}) \\times (1.89813\\times 10^{27}\\,\\mathrm{kg}) \\approx 1.2668653 \\times 10^{17}\\,\\mathrm{m^3/s^2} $$\n\nNext, compute the dimensionless quantity inside the square root:\n$$ \\frac{b v_{\\infty}^2}{\\mu_{\\mathrm{J}}} = \\frac{(1.495978707 \\times 10^9\\,\\mathrm{m}) \\times (5 \\times 10^3\\,\\mathrm{m/s})^2}{1.2668653 \\times 10^{17}\\,\\mathrm{m^3/s^2}} $$\n$$ \\frac{b v_{\\infty}^2}{\\mu_{\\mathrm{J}}} = \\frac{(1.495978707 \\times 10^9) \\times (2.5 \\times 10^7)}{1.2668653 \\times 10^{17}} \\approx \\frac{3.7399468 \\times 10^{16}}{1.2668653 \\times 10^{17}} \\approx 0.2952136 $$\n\nNow, calculate the eccentricity, $e$:\n$$ e = \\sqrt{1 + \\left(\\frac{b v_{\\infty}^2}{\\mu_{\\mathrm{J}}}\\right)^2} \\approx \\sqrt{1 + (0.2952136)^2} \\approx \\sqrt{1 + 0.0871511} \\approx \\sqrt{1.0871511} \\approx 1.0426654 $$\n\nFinally, calculate the magnitude of the velocity kick, $\\Delta v$:\n$$ \\Delta v = \\frac{2 v_{\\infty}}{e} \\approx \\frac{2 \\times (5 \\times 10^3\\,\\mathrm{m/s})}{1.0426654} = \\frac{10000\\,\\mathrm{m/s}}{1.0426654} \\approx 9590.803\\,\\mathrm{m/s} $$\n\nRounding the result to four significant figures as requested gives:\n$$ \\Delta v \\approx 9591\\,\\mathrm{m/s} $$",
            "answer": "$$\n\\boxed{9591}\n$$"
        },
        {
            "introduction": "While analytical tools like the Jacobi integral provide broad constraints, understanding the rich, often chaotic, details of motion in the CR3BP requires computational methods. The Poincaré section is a powerful technique for visualizing the structure of phase space by reducing its dimensionality, turning continuous flows into discrete maps. In this advanced practice , you will implement a numerical simulation to generate a Poincaré section, allowing you to visually and quantitatively distinguish between stable, regular orbits and the unpredictable dynamics of chaotic layers.",
            "id": "4186041",
            "problem": "Consider the planar Circular Restricted Three-Body Problem (CR3BP) in the synodic (rotating) frame, with normalized canonical units: the distance between primaries is $1$, the total mass is $1$, and the angular velocity of the rotating frame is $1$ radian per unit time. Let the primary masses be $m_1 = 1 - \\mu$ and $m_2 = \\mu$ located at fixed positions $(-\\mu, 0)$ and $(1 - \\mu, 0)$, respectively. The equations of motion in the rotating frame follow from Newton's second law with the Coriolis and centrifugal terms and the gravitational accelerations from the primaries. Define the effective potential\n$$\n\\Omega(x,y) = \\frac{1}{2}(x^2 + y^2) + \\frac{1 - \\mu}{r_1} + \\frac{\\mu}{r_2},\n$$\nwhere $r_1 = \\sqrt{(x + \\mu)^2 + y^2}$ and $r_2 = \\sqrt{(x - 1 + \\mu)^2 + y^2}$. The equations of motion are\n$$\n\\ddot{x} - 2 \\dot{y} = \\frac{\\partial \\Omega}{\\partial x}, \\quad \\ddot{y} + 2 \\dot{x} = \\frac{\\partial \\Omega}{\\partial y},\n$$\nwith\n$$\n\\frac{\\partial \\Omega}{\\partial x} = x - \\frac{(1 - \\mu)(x + \\mu)}{r_1^3} - \\frac{\\mu(x - 1 + \\mu)}{r_2^3}, \\quad \\frac{\\partial \\Omega}{\\partial y} = y - \\frac{(1 - \\mu)y}{r_1^3} - \\frac{\\mu y}{r_2^3}.\n$$\nThe Jacobi constant is defined as\n$$\nC = 2 \\Omega(x,y) - \\left(\\dot{x}^2 + \\dot{y}^2\\right).\n$$\n\nYour task is to compute a Poincaré section at $y = 0$ with $\\dot{y} > 0$ for the Earth–Moon mass parameter $\\mu = 0.0121506$ and Jacobi constant $C = 3.1$. Specifically:\n\n1. For each initial condition with $y(0) = 0$, $\\dot{x}(0) = 0$, and chosen $x(0)$, compute $\\dot{y}(0) > 0$ from the Jacobi constant constraint $C = 2 \\Omega(x(0), 0) - \\left(\\dot{x}(0)^2 + \\dot{y}(0)^2\\right)$, i.e.,\n$$\n\\dot{y}(0) = \\sqrt{2 \\Omega\\!\\left(x(0), 0\\right) - C}.\n$$\nDiscard any $x(0)$ for which the radicand is negative.\n\n2. Integrate the CR3BP equations of motion and record successive intersections with the Poincaré section defined by $y = 0$ and $\\dot{y} > 0$. Use radians for any angular measure and the canonical CR3BP units described above. Ensure numerical integration is stable and respects the singular nature of motion near the primaries (e.g., do not allow $r_1$ or $r_2$ to approach zero).\n\n3. Using only the set of recorded section points $(x, \\dot{x})$ at $y = 0$, classify the observed structure for each initial condition as either an \"island\" (thin, quasi-one-dimensional curve indicative of regular motion) or a \"stochastic layer\" (area-filling scatter indicative of chaotic transport). Your classification must be based on rigorous, quantitative criteria derived from the geometry of the recorded points; for example, by comparing principal component variances of $(x, \\dot{x})$ and an occupancy fraction over a uniform grid covering the data extent. You must define and justify your thresholds, and the criteria must be applied consistently across all test cases.\n\n4. Implement event detection such that crossings at $y = 0$ with $\\dot{y} > 0$ are correctly detected. Ignore the trivial initial \"intersection\" at $t = 0$. Terminate integrations that approach within a small distance of either primary to avoid singularities, and treat such cases according to your classification logic in a principled way.\n\nUse the following test suite of initial positions $x(0)$:\n- $x(0) = -0.5$\n- $x(0) = 0.5$\n- $x(0) = 0.9$\n- $x(0) = 1.05$\n- $x(0) = 1.2$\n\nFor each initial condition, compute at least $N = 200$ valid section crossings (unless a termination condition is reached) before classification.\n\nFinal output format: Your program should produce a single line of output containing the classification results for the five test cases as a comma-separated list of integers enclosed in square brackets, where $0$ indicates \"island\" and $1$ indicates \"stochastic layer\" (e.g., \"[0,1,0,1,0]\"). No additional text should be printed.\n\nAll quantities are to be expressed in the canonical CR3BP units described, and angles (if any) are in radians. The results must be presented exactly as specified above.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and complete.\n\n### Step 1: Extract Givens\n- **System**: Planar Circular Restricted Three-Body Problem (CR3BP) in a synodic (rotating) frame.\n- **Units**: Canonical (distance between primaries is $1$, total mass is $1$, angular velocity is $1$).\n- **Masses**: Primary masses $m_1 = 1 - \\mu$ and $m_2 = \\mu$ at $(-\\mu, 0)$ and $(1 - \\mu, 0)$ respectively.\n- **Potential**: Effective potential $\\Omega(x,y) = \\frac{1}{2}(x^2 + y^2) + \\frac{1 - \\mu}{r_1} + \\frac{\\mu}{r_2}$, with $r_1 = \\sqrt{(x + \\mu)^2 + y^2}$ and $r_2 = \\sqrt{(x - 1 + \\mu)^2 + y^2}$.\n- **Equations of Motion (EOM)**: $\\ddot{x} - 2 \\dot{y} = \\frac{\\partial \\Omega}{\\partial x}$ and $\\ddot{y} + 2 \\dot{x} = \\frac{\\partial \\Omega}{\\partial y}$.\n- **Jacobi Constant**: $C = 2 \\Omega(x,y) - \\left(\\dot{x}^2 + \\dot{y}^2\\right)$.\n- **Parameters**: Earth-Moon mass parameter $\\mu = 0.0121506$, Jacobi constant $C = 3.1$.\n- **Task**: Compute a Poincaré section at $y = 0$ with $\\dot{y} > 0$.\n- **Initial Conditions**: For a given $x(0)$, we have $y(0) = 0$, $\\dot{x}(0) = 0$, and $\\dot{y}(0) = \\sqrt{2 \\Omega(x(0), 0) - C}$.\n- **Test Cases**: Initial positions $x(0) \\in \\{-0.5, 0.5, 0.9, 1.05, 1.2\\}$.\n- **Integration Requirements**: Collect at least $N = 200$ section crossings, ignoring the initial state at $t=0$. Terminate integration if the trajectory approaches too close to either primary.\n- **Classification Task**: Classify the resulting set of Poincaré section points $(x, \\dot{x})$ as \"island\" (code $0$) or \"stochastic layer\" (code $1$) based on a quantitative, justified criterion.\n- **Output**: A comma-separated list of integer classifications for the test cases, in the format `[c1,c2,c3,c4,c5]`.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard exercise in computational celestial mechanics and nonlinear dynamics.\n- **Scientific Grounding**: The CR3BP model, equations of motion, effective potential, and Jacobi constant are all fundamental and correctly stated concepts in astrodynamics. The use of Poincaré sections to analyze the phase space structure is a canonical technique.\n- **Well-Posedness**: The problem provides a system of ordinary differential equations (ODEs), well-defined initial conditions derived from the Jacobi integral, and a clear objective. The classification task, while requiring the definition of a criterion, is a standard problem in data analysis for dynamical systems.\n- **Completeness and Consistency**: All necessary constants ($\\mu$, $C$), equations, and initial conditions are provided. There are no contradictions.\n- **Feasibility**: The numerical integration of the CR3BP equations and the collection of Poincaré section points are computationally feasible tasks. The classification based on the geometry of these points is also programmatically achievable.\n- **Objectivity**: The problem is stated in precise mathematical terms. The requirement for a \"rigorous, quantitative\" classification criterion removes subjectivity.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A solution will be constructed following the specified guidelines.\n\n***\n\n### Solution Design\n\nThe solution involves numerically integrating the CR3BP equations of motion for several initial conditions and analyzing the resulting Poincaré sections to classify the dynamics as regular (island) or chaotic (stochastic layer).\n\n#### 1. System of First-Order ODEs\nThe two second-order EOMs are converted into a system of four first-order ODEs. Let the state vector be $S = (x, y, v_x, v_y)^T$, where $v_x = \\dot{x}$ and $v_y = \\dot{y}$. The system is:\n$$\n\\frac{d}{dt}\n\\begin{pmatrix} x \\\\ y \\\\ v_x \\\\ v_y \\end{pmatrix}\n=\n\\begin{pmatrix} v_x \\\\ v_y \\\\ 2v_y + \\frac{\\partial \\Omega}{\\partial x} \\\\ -2v_x + \\frac{\\partial \\Omega}{\\partial y} \\end{pmatrix}\n$$\nThe partial derivatives of the effective potential $\\Omega$ are given by:\n$$\n\\frac{\\partial \\Omega}{\\partial x} = x - \\frac{(1 - \\mu)(x + \\mu)}{r_1^3} - \\frac{\\mu(x - 1 + \\mu)}{r_2^3}\n$$\n$$\n\\frac{\\partial \\Omega}{\\partial y} = y - \\frac{(1 - \\mu)y}{r_1^3} - \\frac{\\mu y}{r_2^3}\n$$\nwhere $r_1 = \\sqrt{(x + \\mu)^2 + y^2}$ and $r_2 = \\sqrt{(x - 1 + \\mu)^2 + y^2}$. This system is implemented as the core function for a numerical ODE solver.\n\n#### 2. Initial Conditions\nFor each test case specified by an initial position $x_0 = x(0)$, the initial state vector $S(0) = (x_0, 0, 0, \\dot{y}_0)$ is determined. The initial velocity component $\\dot{y}_0 = \\dot{y}(0)$ is calculated from the Jacobi constant $C = 3.1$. At $t=0$, we have $y(0)=0$ and $\\dot{x}(0)=0$, so the Jacobi relation becomes:\n$$\nC = 2 \\Omega(x_0, 0) - \\left(0^2 + \\dot{y}_0^2\\right)\n$$\nSolving for $\\dot{y}_0$, we get:\n$$\n\\dot{y}_0 = \\sqrt{2 \\Omega(x_0, 0) - C}\n$$\nThe condition specifies using $\\dot{y}_0 > 0$. The radicand $2 \\Omega(x_0, 0) - C$ must be non-negative for a real velocity to exist, defining the Hill's region for zero-velocity curves. All provided test cases yield a positive radicand.\n\n#### 3. Numerical Integration and Event Detection\nThe `scipy.integrate.solve_ivp` function is used for numerical integration, chosen for its robustness and built-in event detection capabilities. High precision is maintained by setting the relative and absolute error tolerances to $10^{-11}$.\n\nTwo events are defined to control the integration:\n1.  **Poincaré Section Crossing**: An event function `event_y_zero` triggers when $y(t) = 0$. The solver is configured to detect all such crossings (from positive or negative $y$) and to continue the integration. After a crossing is detected, a check is performed on the state to ensure that $\\dot{y} > 0$. The point $(x, \\dot{x})$ is recorded only if this condition is met. The trivial initial point at $t=0$ is explicitly ignored.\n2.  **Primary Proximity Termination**: An event function `event_near_primary` triggers if the trajectory's distance to either primary, $r_1$ or $r_2$, falls below a small threshold, $\\epsilon_{term} = 10^{-3}$. This event is terminal, halting the integration to prevent numerical instabilities and singularities associated with a close approach or collision.\n\nThe integration proceeds in segments until at least $N = 200$ valid Poincaré section points are collected or a termination event occurs. A maximum total integration time is also imposed to prevent infinite loops.\n\n#### 4. Classification Criterion: Principal Component Analysis (PCA)\nThe geometric structure of the collected Poincaré section points $(x, \\dot{x})$ is analyzed to classify the trajectory.\n-   **Regular Orbits (Islands)**: These are quasi-periodic and trace out a thin, one-dimensional, closed curve in the Poincaré section.\n-   **Chaotic Orbits (Stochastic Layers)**: These orbits are not confined to a smooth manifold and fill a two-dimensional area in the section.\n\nTo quantitatively distinguish between these two cases, Principal Component Analysis (PCA) is applied to the set of $N$ collected points. PCA identifies the principal axes of the data distribution, and the eigenvalues of the data's covariance matrix, $\\lambda_{min}$ and $\\lambda_{max}$, correspond to the variance along these axes.\n\nThe classification logic is as follows:\n1.  Assemble the collected points $\\{(x_i, v_{x,i})\\}_{i=1}^N$ into a $N \\times 2$ matrix.\n2.  Calculate the $2 \\times 2$ covariance matrix of this dataset.\n3.  Compute its two eigenvalues, $\\lambda_{min}$ and $\\lambda_{max}$ (where $\\lambda_{min} \\le \\lambda_{max}$).\n4.  Calculate the ratio $R_{PCA} = \\lambda_{min} / \\lambda_{max}$. This ratio measures the eccentricity of the point cloud. For a line-like structure (island), $\\lambda_{min} \\ll \\lambda_{max}$, so $R_{PCA} \\approx 0$. For an area-filling distribution (stochastic layer), $\\lambda_{min}$ is comparable to $\\lambda_{max}$, so $R_{PCA}$ is significantly greater than $0$.\n5.  A threshold is established: if $R_{PCA} < 0.01$, the structure is classified as an \"island\" (0). Otherwise, it is a \"stochastic layer\" (1). This threshold signifies that if the variance in the \"thin\" direction is less than $1\\%$ of the variance in the \"long\" direction, the structure is considered one-dimensional.\n\nThis criterion is applied consistently to all test cases.\n\n#### 5. Handling of Special Cases\n-   **Premature Termination**: If the integration is terminated due to proximity to a primary, the trajectory is exhibiting strong instability, a hallmark of chaotic motion. Therefore, such cases are immediately classified as a \"stochastic layer\" (1), provided a minimum number of points (e.g., $10$) have been collected to ensure the behavior is not an initial transient artifact.\n-   **Insufficient Points**: If the integration times out before collecting a minimum of $20$ points, it's difficult to perform a reliable PCA. This scenario (e.g., a trajectory escaping the system slowly) is also characteristic of chaotic or boundary dynamics and is classified as \"stochastic layer\" (1).\n\nThis comprehensive approach ensures a robust and principled classification for each initial condition based on the numerically observed dynamics.",
            "answer": "$$\\boxed{[0, 1, 0, 1, 1]}$$"
        }
    ]
}