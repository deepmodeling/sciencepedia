{
    "hands_on_practices": [
        {
            "introduction": "地转平衡是描述大尺度行星大气流动的基本近似。本练习将引导你直接应用地转风方程，将风速与压力梯度直接联系起来。通过计算一个给定压力场下的地转风矢量 ，你将掌握在旋转行星上驱动大气环流的核心机制，这是理解更复杂动力学现象的基石。",
            "id": "4161550",
            "problem": "考虑一颗快速自转的系外行星上稳定分层大气的中纬度气柱。采用一个局部笛卡尔坐标系，其中$x$朝东，$y$朝北，$z$朝上。假设空气密度$\\rho$为常数，科里奥利参数$f0$为常数，代表北半球的情况。在给定的等压面上，水平气压场由下式给出\n$$\np(x,y) \\;=\\; p_{\\mathrm{ref}} \\;+\\; a\\,x \\;+\\; b\\,y \\;+\\; c\\,x^{2} \\;+\\; d\\,y^{2},\n$$\n其中$p_{\\mathrm{ref}}$是一个恒定的参考气压。对于一个特定的系外行星，取$\\rho = 1.0\\,\\mathrm{kg\\,m^{-3}}$，$f = 1.5\\times 10^{-4}\\,\\mathrm{s^{-1}}$，$a = -1.1\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$，$b = 0.7\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$，$c = 2.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$，以及$d = -1.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$。\n\n从旋转坐标系中的水平动量方程出发，在所述假设下应用地转平衡，推导出地转风矢量$\\mathbf{u}_{g}(x,y)$用$\\nabla_{h}p(x,y)$表示的表达式，然后计算点$(x,y)=(1.0\\times 10^{6}\\,\\mathrm{m},\\,2.0\\times 10^{6}\\,\\mathrm{m})$处的$\\mathbf{u}_{g}$。根据你的推导，说明当$f0$时，地转流相对于等压线的方向。\n\n以行矩阵格式报告指定点的地转风的最终数值，包括两个分量$(u_{g},v_{g})$，单位为$\\mathrm{m\\,s^{-1}}$，并将每个分量四舍五入到四位有效数字。",
            "solution": "首先验证问题，以确保其科学上合理、自洽且适定。\n\n### 步骤 1：提取已知条件\n-   **坐标系**：$x$（朝东），$y$（朝北），$z$（朝上）。\n-   **大气**：稳定分层，空气密度$\\rho$为常数。\n-   **旋转**：科里奥利参数$f  0$为常数。\n-   **气压场**：$p(x,y) = p_{\\mathrm{ref}} + a\\,x + b\\,y + c\\,x^{2} + d\\,y^{2}$。\n-   **常数**：\n    -   $\\rho = 1.0\\,\\mathrm{kg\\,m^{-3}}$\n    -   $f = 1.5\\times 10^{-4}\\,\\mathrm{s^{-1}}$\n    -   $a = -1.1\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$\n    -   $b = 0.7\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$\n    -   $c = 2.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$\n    -   $d = -1.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$\n-   **计算点**：$(x,y)=(1.0\\times 10^{6}\\,\\mathrm{m},\\,2.0\\times 10^{6}\\,\\mathrm{m})$。\n\n### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题是地转近似的标准应用，这是地球物理流体动力学中的一个基本概念。恒定密度和科里奥利参数的假设是理想化模型中常见的简化。\n2.  **适定性**：该问题提供了一个明确定义的气压场和所有必要的常数，以确定气压梯度并随后确定地转风。要求具体，且有唯一解。\n3.  **客观性**：问题以精确、定量的术语陈述，没有主观性。\n4.  **量纲和物理一致性**：给定常数的单位是一致的。量纲分析表明，气压梯度除以密度和科里奥利参数的乘积，正确地得到了速度的单位：$[\\mathrm{Pa\\,m^{-1}} / (\\mathrm{kg\\,m^{-3}} \\cdot \\mathrm{s^{-1}})] = [(\\mathrm{kg\\,m\\,s^{-2}}\\,\\mathrm{m^{-2}})\\,\\mathrm{m^{-1}} / (\\mathrm{kg\\,m^{-3}} \\cdot \\mathrm{s^{-1}})] = [\\mathrm{kg\\,m^{-2}\\,s^{-2}}] / [\\mathrm{kg\\,m^{-3}\\,s^{-1}}] = \\mathrm{m\\,s^{-1}}$。数值在合理（尽管是系外行星的）范围内。\n\n### 步骤 3：结论和行动\n问题有效。现在开始求解过程。\n\n在旋转坐标系中，忽略摩擦力的水平动量方程为：\n$$\n\\frac{Du}{Dt} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} + fv\n$$\n$$\n\\frac{Dv}{Dt} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} - fu\n$$\n其中$\\mathbf{u} = (u,v)$是水平速度矢量，$p$是气压，$\\rho$是密度，$f$是科里奥利参数，$\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + u\\frac{\\partial}{\\partial x} + v\\frac{\\partial}{\\partial y}$是二维物质导数。\n\n当气压梯度力与科里奥利力平衡时，就达到了地转平衡。这要求流动是稳定的（$\\frac{\\partial}{\\partial t} = 0$）且平流加速度项可以忽略不计（即对于低罗斯贝数的流动）。在这些假设下，左侧的加速度项消失，动量方程简化为地转方程：\n$$\n0 = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} + fv_{g}\n$$\n$$\n0 = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} - fu_{g}\n$$\n其中$\\mathbf{u}_{g} = (u_{g}, v_{g})$表示地转风矢量。\n\n求解这两个方程，得到地转风的分量$u_g$和$v_g$：\n$$\nu_{g} = -\\frac{1}{f\\rho}\\frac{\\partial p}{\\partial y}\n$$\n$$\nv_{g} = \\frac{1}{f\\rho}\\frac{\\partial p}{\\partial x}\n$$\n这些表达式根据水平气压梯度$\\nabla_{h}p = \\left(\\frac{\\partial p}{\\partial x}, \\frac{\\partial p}{\\partial y}\\right)$定义了地转风。\n\n用矢量表示法，地转风矢量$\\mathbf{u}_{g} = u_{g}\\mathbf{i} + v_{g}\\mathbf{j}$可以表示为：\n$$\n\\mathbf{u}_{g} = \\frac{1}{f\\rho} \\left( -\\frac{\\partial p}{\\partial y}\\mathbf{i} + \\frac{\\partial p}{\\partial x}\\mathbf{j} \\right) = \\frac{1}{f\\rho} (\\mathbf{k} \\times \\nabla_{h}p)\n$$\n其中$\\mathbf{k}$是垂直方向的单位矢量。\n\n从矢量表达式$\\mathbf{u}_{g} = \\frac{1}{f\\rho} (\\mathbf{k} \\times \\nabla_{h}p)$，我们可以确定地转流的方向。根据定义，气压梯度矢量$\\nabla_{h}p$垂直于等压线（等压线）并指向高压区。与垂直单位矢量$\\mathbf{k}$的叉积产生一个垂直于$\\nabla_{h}p$的矢量$\\mathbf{u}_{g}$。因此，地转风必须平行于等压线流动。\n\n对于北半球，其中$f0$，$\\mathbf{u}_{g}$的方向由$\\mathbf{k} \\times \\nabla_{h}p$给出。根据右手定则，该矢量从$\\nabla_{h}p$的方向逆时针旋转$90^{\\circ}$。由于$\\nabla_{h}p$指向高压，这意味着地转风的流动方向使其右侧为高压区。这就是所谓的白贝罗定律（Buys Ballot's law）。\n\n现在，我们计算指定位置的地转风。首先，我们从给定的气压场$p(x,y) = p_{\\mathrm{ref}} + a\\,x + b\\,y + c\\,x^{2} + d\\,y^{2}$计算气压梯度的分量：\n$$\n\\frac{\\partial p}{\\partial x} = a + 2cx\n$$\n$$\n\\frac{\\partial p}{\\partial y} = b + 2dy\n$$\n我们使用提供的常数在点$(x_{0}, y_{0}) = (1.0 \\times 10^{6}\\,\\mathrm{m}, 2.0 \\times 10^{6}\\,\\mathrm{m})$处计算这些导数：\n$a = -1.1\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$，$b = 0.7\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$，$c = 2.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$，以及$d = -1.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$。\n\n气压梯度的x分量为：\n$$\n\\frac{\\partial p}{\\partial x} = (-1.1 \\times 10^{-3}) + 2(2.0 \\times 10^{-12})(1.0 \\times 10^{6}) = -1.1 \\times 10^{-3} + 4.0 \\times 10^{-6} = -0.0011 + 0.000004 = -1.096 \\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}\n$$\n气压梯度的y分量为：\n$$\n\\frac{\\partial p}{\\partial y} = (0.7 \\times 10^{-3}) + 2(-1.0 \\times 10^{-12})(2.0 \\times 10^{6}) = 0.7 \\times 10^{-3} - 4.0 \\times 10^{-6} = 0.0007 - 0.000004 = 6.96 \\times 10^{-4}\\,\\mathrm{Pa\\,m^{-1}}\n$$\n我们已知$\\rho = 1.0\\,\\mathrm{kg\\,m^{-3}}$和$f = 1.5 \\times 10^{-4}\\,\\mathrm{s^{-1}}$。乘积$f\\rho$为：\n$$\nf\\rho = (1.5 \\times 10^{-4}\\,\\mathrm{s^{-1}}) \\times (1.0\\,\\mathrm{kg\\,m^{-3}}) = 1.5 \\times 10^{-4}\\,\\mathrm{kg\\,m^{-3}\\,s^{-1}}\n$$\n现在我们计算地转风的分量：\n$$\nu_{g} = -\\frac{1}{f\\rho}\\frac{\\partial p}{\\partial y} = -\\frac{1}{1.5 \\times 10^{-4}} (6.96 \\times 10^{-4}) = -\\frac{6.96}{1.5} = -4.64\\,\\mathrm{m\\,s^{-1}}\n$$\n$$\nv_{g} = \\frac{1}{f\\rho}\\frac{\\partial p}{\\partial x} = \\frac{1}{1.5 \\times 10^{-4}} (-1.096 \\times 10^{-3}) = \\frac{-1.096 \\times 10^{-3}}{1.5 \\times 10^{-4}} = -\\frac{10.96 \\times 10^{-4}}{1.5 \\times 10^{-4}} = -\\frac{10.96}{1.5} \\approx -7.30666... \\,\\mathrm{m\\,s^{-1}}\n$$\n按要求将每个分量四舍五入到四位有效数字：\n$$\nu_{g} \\approx -4.640\\,\\mathrm{m\\,s^{-1}}\n$$\n$$\nv_{g} \\approx -7.307\\,\\mathrm{m\\,s^{-1}}\n$$\n指定点的最终地转风矢量为$(u_g, v_g) = (-4.640, -7.307)\\,\\mathrm{m\\,s^{-1}}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-4.640  -7.307\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在地转平衡的基础上，我们将引入热成风关系，这是地球物理流体动力学中的一个核心概念。热成风巧妙地将地转风的垂直切变（动力学）与水平温度梯度（热力学）联系起来。本练习  将引导你完成一个完整的理论推导，从给定的位势高度场出发，最终得到温度梯度的解析表达式，从而深化你对行星大气结构中动力与热力过程相互作用的理解。",
            "id": "4161537",
            "problem": "考虑一颗同步自转的系外行星，其半径为 $a$，重力加速度为 $g$，自转角速度为 $\\Omega$。设球面上的纬度为 $\\varphi$，经度为 $\\lambda$。假设大气为干燥的理想气体，其比气体常数为 $R$。定义科里奥利参数为 $f = 2 \\Omega \\sin \\varphi$。在气压坐标 $(p)$ 下进行计算，并假设满足静力平衡。在参考气压 $p_0$ 处，观测到的位势高度场 $Z(\\lambda,\\varphi,p_0)$ 为\n$$\nZ(\\lambda,\\varphi,p_0) = Z_* + A \\cos \\lambda \\, \\sin \\varphi,\n$$\n其中 $Z_*$ 和 $A$ 是常数。独立的遥感反演表明，在所关心的气压范围内（以 $p_0$ 为中心），$Z$ 的垂直结构可以表示为\n$$\nZ(\\lambda,\\varphi,p) = Z(\\lambda,\\varphi,p_0) + B \\cos \\varphi \\, \\ln\\!\\left(\\frac{p}{p_0}\\right),\n$$\n其中 $B$ 为常数。\n\n仅使用地转平衡下的水平动量方程、静力学关系和理想气体定律，完成以下任务：\n\n- 根据 $Z(\\lambda,\\varphi,p_0)$，推导在半径为 $a$ 的旋转球体上，$p_0$ 处的地转风分量。\n\n- 在气压坐标下推导热成风关系，该关系将地转风的垂直切变与等压面上的水平温度梯度联系起来。\n\n- 将这些结果与给定的 $Z(\\lambda,\\varphi,p)$ 垂直结构相结合，得到在任意纬度 $\\varphi$ 处隐含的经向温度梯度 $\\partial T/\\partial y$ 的闭合形式解析表达式，其中 $y$ 表示局地向北距离坐标。\n\n最终的经向温度梯度请以开尔文每米为单位表示，并将 $\\varphi$ 视为弧度。你的最终答案必须是仅包含参数 $a$、$g$、$R$、$B$ 和 $\\varphi$ 的单一闭合形式解析表达式。",
            "solution": "用户提供了一个行星大气动力学问题，要求应用地转平衡、静力平衡和理想气体定律来推导经向温度梯度的关系。该问题具有科学依据，提法适定，并包含了所有必要信息，因此被认为是有效的。解题过程将遵循问题陈述中设定的三个任务。\n\n基本假设如下：\n1.  水平动量满足地转平衡。\n2.  垂直动量满足静力平衡。\n3.  大气为干燥的理想气体。\n\n水平位置采用球面坐标系 $(\\lambda, \\varphi)$，垂直坐标采用气压 $p$。局地向北距离用 $y$ 表示，其中 $dy = a \\, d\\varphi$。\n\n首先，我们推导参考气压层 $p_0$ 上的地转风分量。\n在半径为 $a$ 的球面上，气压坐标系中的地转动量方程由科里奥利力与气压梯度力之间的平衡给出。单位质量的气压梯度力为 $-\\nabla_p \\Phi$，其中 $\\Phi = gZ$ 是位势。\n地转风的纬向（向东，$u_g$）和经向（向北，$v_g$）分量为：\n$$ -f v_g = -\\frac{1}{a \\cos \\varphi} \\frac{\\partial \\Phi}{\\partial \\lambda} \\\\ f u_g = -\\frac{1}{a} \\frac{\\partial \\Phi}{\\partial \\varphi} $$\n代入 $\\Phi = gZ$，其中 $g$ 是重力加速度（假设为常数），我们得到：\n$$ u_g = -\\frac{g}{fa} \\frac{\\partial Z}{\\partial \\varphi} \\\\ v_g = \\frac{g}{fa \\cos \\varphi} \\frac{\\partial Z}{\\partial \\lambda} $$\n问题给出了参考气压 $p_0$ 处的位势高度场：\n$$ Z(\\lambda,\\varphi,p_0) = Z_* + A \\cos \\lambda \\sin \\varphi $$\n我们计算 $Z$ 在 $p_0$ 处的水平偏导数：\n$$ \\frac{\\partial Z}{\\partial \\lambda}\\bigg|_{p_0} = \\frac{\\partial}{\\partial \\lambda} (Z_* + A \\cos \\lambda \\sin \\varphi) = -A \\sin \\lambda \\sin \\varphi $$\n$$ \\frac{\\partial Z}{\\partial \\varphi}\\bigg|_{p_0} = \\frac{\\partial}{\\partial \\varphi} (Z_* + A \\cos \\lambda \\sin \\varphi) = A \\cos \\lambda \\cos \\varphi $$\n将这些导数代入地转风方程，得到 $p_0$ 处的风分量：\n$$ u_g(\\lambda, \\varphi, p_0) = -\\frac{g}{fa} (A \\cos \\lambda \\cos \\varphi) = -\\frac{g A \\cos \\lambda \\cos \\varphi}{fa} $$\n$$ v_g(\\lambda, \\varphi, p_0) = \\frac{g}{fa \\cos \\varphi} (-A \\sin \\lambda \\sin \\varphi) = -\\frac{g A \\sin \\lambda \\sin \\varphi}{fa \\cos \\varphi} $$\n使用科里奥利参数的定义 $f = 2 \\Omega \\sin \\varphi$，我们可以将其写为：\n$$ u_g(p_0) = -\\frac{g A \\cos \\lambda \\cos \\varphi}{2 \\Omega a \\sin \\varphi} = -\\frac{g A}{2 \\Omega a} \\cos \\lambda \\cot \\varphi $$\n$$ v_g(p_0) = -\\frac{g A \\sin \\lambda \\sin \\varphi}{(2 \\Omega a \\sin \\varphi) \\cos \\varphi} = -\\frac{g A}{2 \\Omega a} \\frac{\\sin \\lambda}{\\cos \\varphi} $$\n这就完成了第一个任务。\n\n接下来，我们推导热成风关系。该关系将地转风的垂直切变与等压面上的水平温度梯度联系起来。我们首先对地转风方程关于气压 $p$ 求偏导：\n$$ \\frac{\\partial u_g}{\\partial p} = -\\frac{g}{fa} \\frac{\\partial}{\\partial p} \\left( \\frac{\\partial Z}{\\partial \\varphi} \\right) = -\\frac{g}{fa} \\frac{\\partial^2 Z}{\\partial \\varphi \\partial p} $$\n$$ \\frac{\\partial v_g}{\\partial p} = \\frac{g}{fa \\cos \\varphi} \\frac{\\partial}{\\partial p} \\left( \\frac{\\partial Z}{\\partial \\lambda} \\right) = \\frac{g}{fa \\cos \\varphi} \\frac{\\partial^2 Z}{\\partial \\lambda \\partial p} $$\n为了将位势 $Z$ 与温度 $T$ 联系起来，我们使用静力平衡方程和理想气体定律。气压坐标系中的静力方程为：\n$$ \\frac{\\partial \\Phi}{\\partial p} = -\\alpha $$\n其中 $\\alpha = 1/\\rho$ 是比容。由于 $\\Phi = gZ$，该方程变为 $g \\frac{\\partial Z}{\\partial p} = -\\alpha$。\n理想气体定律为 $p = \\rho R T$，或 $p\\alpha = RT$，由此得到 $\\alpha = \\frac{RT}{p}$。\n将 $\\alpha$ 代入静力学关系，我们得到：\n$$ g \\frac{\\partial Z}{\\partial p} = -\\frac{RT}{p} $$\n对该方程求水平导数（在 $p$ 恒定时），我们可以将 $Z$ 的混合偏导数与 $T$ 的水平梯度联系起来：\n$$ \\frac{\\partial}{\\partial \\varphi} \\left( g \\frac{\\partial Z}{\\partial p} \\right) = g \\frac{\\partial^2 Z}{\\partial \\varphi \\partial p} = -\\frac{R}{p} \\frac{\\partial T}{\\partial \\varphi} $$\n$$ \\frac{\\partial}{\\partial \\lambda} \\left( g \\frac{\\partial Z}{\\partial p} \\right) = g \\frac{\\partial^2 Z}{\\partial \\lambda \\partial p} = -\\frac{R}{p} \\frac{\\partial T}{\\partial \\lambda} $$\n现在我们将 $Z$ 的这些二阶导数表达式代回到风切变方程中：\n$$ \\frac{\\partial u_g}{\\partial p} = -\\frac{g}{fa} \\left( -\\frac{R}{gp} \\frac{\\partial T}{\\partial \\varphi} \\right) = \\frac{R}{fap} \\frac{\\partial T}{\\partial \\varphi} $$\n$$ \\frac{\\partial v_g}{\\partial p} = \\frac{g}{fa \\cos \\varphi} \\left( -\\frac{R}{gp} \\frac{\\partial T}{\\partial \\lambda} \\right) = -\\frac{R}{fap \\cos \\varphi} \\frac{\\partial T}{\\partial \\lambda} $$\n这些就是气压坐标系下的热成风方程。通过使用垂直坐标 $\\ln p$ 可以得到一个通常更方便的形式，因为 $d(\\ln p) = dp/p$：\n$$ \\frac{\\partial u_g}{\\partial (\\ln p)} = p \\frac{\\partial u_g}{\\partial p} = \\frac{R}{fa} \\frac{\\partial T}{\\partial \\varphi} $$\n$$ \\frac{\\partial v_g}{\\partial (\\ln p)} = p \\frac{\\partial v_g}{\\partial p} = -\\frac{R}{fa \\cos \\varphi} \\frac{\\partial T}{\\partial \\lambda} $$\n这就完成了第二个任务。\n\n最后，我们结合这些结果来求经向温度梯度 $\\frac{\\partial T}{\\partial y}$。局地向北距离元为 $dy = a \\, d\\varphi$，所以经向温度梯度为 $\\frac{\\partial T}{\\partial y} = \\frac{1}{a} \\frac{\\partial T}{\\partial \\varphi}$。\n从纬向风的热成风方程中，我们可以用 $u_g$ 的垂直切变来表示 $\\frac{\\partial T}{\\partial \\varphi}$：\n$$ \\frac{\\partial T}{\\partial \\varphi} = \\frac{fa}{R} \\frac{\\partial u_g}{\\partial (\\ln p)} $$\n将此代入 $\\frac{\\partial T}{\\partial y}$ 的表达式中：\n$$ \\frac{\\partial T}{\\partial y} = \\frac{1}{a} \\left( \\frac{fa}{R} \\frac{\\partial u_g}{\\partial (\\ln p)} \\right) = \\frac{f}{R} \\frac{\\partial u_g}{\\partial (\\ln p)} $$\n为了计算该式，我们需要纬向地转风的垂直切变 $\\frac{\\partial u_g}{\\partial (\\ln p)}$。我们首先利用给定的 $Z$ 的垂直结构来找到 $u_g(\\lambda, \\varphi, p)$ 的完整表达式：\n$$ Z(\\lambda,\\varphi,p) = Z(\\lambda,\\varphi,p_0) + B \\cos \\varphi \\, \\ln\\!\\left(\\frac{p}{p_0}\\right) = Z_* + A \\cos \\lambda \\sin \\varphi + B \\cos \\varphi \\ln\\!\\left(\\frac{p}{p_0}\\right) $$\n经向导数为：\n$$ \\frac{\\partial Z}{\\partial \\varphi} = \\frac{\\partial}{\\partial \\varphi} \\left[ Z_* + A \\cos \\lambda \\sin \\varphi + B \\cos \\varphi \\ln\\!\\left(\\frac{p}{p_0}\\right) \\right] = A \\cos \\lambda \\cos \\varphi - B \\sin \\varphi \\ln\\!\\left(\\frac{p}{p_0}\\right) $$\n因此，纬向地转风为：\n$$ u_g(\\lambda, \\varphi, p) = -\\frac{g}{fa} \\frac{\\partial Z}{\\partial \\varphi} = -\\frac{g}{fa} \\left[ A \\cos \\lambda \\cos \\varphi - B \\sin \\varphi \\ln\\!\\left(\\frac{p}{p_0}\\right) \\right] $$\n现在，我们计算关于 $\\ln p$ 的垂直切变。令 $\\eta = \\ln p$。那么 $\\ln(p/p_0) = \\ln p - \\ln p_0$。\n$$ \\frac{\\partial u_g}{\\partial (\\ln p)} = \\frac{\\partial}{\\partial (\\ln p)} \\left\\{ -\\frac{g}{fa} \\left[ A \\cos \\lambda \\cos \\varphi - B \\sin \\varphi (\\ln p - \\ln p_0) \\right] \\right\\} $$\n项 $A \\cos \\lambda \\cos \\varphi$ 和 $B \\sin \\varphi \\ln p_0$ 相对于 $\\ln p$ 是常数。因此，我们只需要对包含 $\\ln p$ 的项求导：\n$$ \\frac{\\partial u_g}{\\partial (\\ln p)} = -\\frac{g}{fa} \\frac{\\partial}{\\partial (\\ln p)} \\left[ -B \\sin \\varphi \\ln p \\right] = -\\frac{g}{fa} (-B \\sin \\varphi) = \\frac{g B \\sin \\varphi}{fa} $$\n纬向风的垂直切变不随气压和经度变化。现在，我们将此结果代入经向温度梯度的表达式中：\n$$ \\frac{\\partial T}{\\partial y} = \\frac{f}{R} \\left( \\frac{g B \\sin \\varphi}{fa} \\right) $$\n分子和分母中的科里奥利参数 $f$ 相互抵消：\n$$ \\frac{\\partial T}{\\partial y} = \\frac{g B \\sin \\varphi}{Ra} $$\n这就是由给定位势高度场隐含的经向温度梯度的最终闭合形式解析表达式。它由所要求的参数 $a$、$g$、$R$、$B$ 和 $\\varphi$ 表示。",
            "answer": "$$\\boxed{\\frac{g B \\sin(\\varphi)}{a R}}$$"
        },
        {
            "introduction": "现在，让我们将理论应用于模拟真实世界行星科学研究的实践中。本练习要求你开发一个计算方法，通过“反演”热成风方程，从观测到的风切变数据中重建系外行星的温度场。这个动手编程实践  完美地展示了如何运用基本物理原理来分析和解释天文观测数据，是行星建模与数据分析的关键技能。",
            "id": "4161502",
            "problem": "您的任务是开发一个完整的反演方法（并将其实现为一个可运行的程序），从通过多普勒技术获得的纬向风垂直切变 $\\partial u/\\partial \\ln p$ 的测量数据中，反演出一颗旋转的系外行星上的三维温度场 $T(\\lambda,\\varphi,p)$。您的方法必须从适用于大尺度行星大气的基本原理出发：压强面上的水平地转平衡、静力平衡以及理想气体定律。您必须显式地处理科里奥利参数 $f(\\varphi)$ 的经向变化，其中 $f(\\varphi)=2\\Omega\\sin\\varphi$，$\\Omega$ 是行星的自转速率，并使用行星半径为 $a$ 的球面几何来关联经向导数与纬度和距离。所有角度必须以弧度为单位，压强以帕斯卡（Pa）为单位，风速以米每秒（m/s）为单位，温度以开尔文（K）为单位。\n\n您将在给定的经度-纬度-压强网格上实现一个离散反演，具体步骤如下：\n- 使用科学上适用的平衡定律，以观测到的风切变和 $f(\\varphi)$ 来表示温度梯度。\n- 使用 $y=a\\varphi$ 将经向导数 $\\partial/\\partial y$ 转换为纬度导数 $\\partial/\\partial \\varphi$。\n- 对于每个压强层，在给定参考纬度 $\\varphi_{\\mathrm{ref}}$ 处的指定参考温度 $T_{\\mathrm{ref}}(\\varphi_{\\mathrm{ref}},p)$ 的情况下，沿纬度积分经向温度梯度以恢复 $T(\\lambda,\\varphi,p)$。\n\n为确保可测试性，请将您的方法应用于以下三个测试用例。每个用例定义了行星参数、网格、观测到的切变场 $\\partial u/\\partial \\ln p(\\lambda,\\varphi,p)$、参考纬度索引以及该纬度下的参考温度廓线：\n\n用例 A（一般中纬度情况）：\n- 行星半径 $a=9.4\\times 10^{6}\\,\\mathrm{m}$。\n- 自转周期 $P=0.7\\,\\mathrm{days}$，因此 $\\Omega=2\\pi/P$，其中 $P$ 以秒为单位。\n- 特定气体常数 $R=3700\\,\\mathrm{J/(kg\\,K)}$。\n- 经度 $\\lambda\\in\\{0,\\pi/2,\\pi\\}\\,\\mathrm{rad}$。\n- 纬度 $\\varphi\\in\\{-\\pi/6,0,\\pi/6\\}\\,\\mathrm{rad}$。\n- 压强 $p\\in\\{1.0\\times 10^{5},5.0\\times 10^{4}\\}\\,\\mathrm{Pa}$。\n- 观测到的切变场 $\\partial u/\\partial \\ln p(\\lambda,\\varphi,p)=S_{0}\\cos\\varphi\\sin\\lambda\\left[1-0.3\\left(\\frac{p}{10^{5}}-1\\right)\\right]$，其中 $S_{0}=20\\,\\mathrm{m/s}$。\n- 参考纬度索引位于 $\\varphi_{\\mathrm{ref}}=0$（中间索引）。\n- 在 $\\varphi_{\\mathrm{ref}}$ 处的参考温度廓线为 $T_{\\mathrm{ref}}(p)=\\{1400,1400\\}\\,\\mathrm{K}$。\n\n用例 B（赤道边缘情况，用于测试小 $f$ 值的行为）：\n- 行星半径 $a=6.0\\times 10^{6}\\,\\mathrm{m}$。\n- 自转周期 $P=3.0\\,\\mathrm{days}$，因此 $\\Omega=2\\pi/P$，其中 $P$ 以秒为单位。\n- 特定气体常数 $R=3700\\,\\mathrm{J/(kg\\,K)}$。\n- 经度 $\\lambda\\in\\{0\\}\\,\\mathrm{rad}$。\n- 纬度 $\\varphi\\in\\{-5\\pi/180,0,5\\pi/180\\}\\,\\mathrm{rad}$。\n- 压强 $p\\in\\{1.0\\times 10^{5},8.0\\times 10^{4},5.0\\times 10^{4}\\}\\,\\mathrm{Pa}$。\n- 观测到的切变场 $\\partial u/\\partial \\ln p(\\lambda,\\varphi,p)=S_{1}\\cos\\varphi\\left(\\frac{p}{10^{5}}\\right)$，其中 $S_{1}=12\\,\\mathrm{m/s}$。\n- 参考纬度索引位于 $\\varphi_{\\mathrm{ref}}=0$（中间索引）。\n- 在 $\\varphi_{\\mathrm{ref}}$ 处的参考温度廓线为 $T_{\\mathrm{ref}}(p)=\\{1200,1180,1150\\}\\,\\mathrm{K}$。\n\n用例 C（零切变边界情况）：\n- 行星半径 $a=7.0\\times 10^{6}\\,\\mathrm{m}$。\n- 自转周期 $P=1.0\\,\\mathrm{days}$，因此 $\\Omega=2\\pi/P$，其中 $P$ 以秒为单位。\n- 特定气体常数 $R=3700\\,\\mathrm{J/(kg\\,K)}$。\n- 经度 $\\lambda\\in\\{0,\\pi/3,2\\pi/3\\}\\,\\mathrm{rad}$。\n- 纬度 $\\varphi\\in\\{-\\pi/6,0,\\pi/6\\}\\,\\mathrm{rad}$。\n- 压强 $p\\in\\{1.2\\times 10^{5},8.0\\times 10^{4}\\}\\,\\mathrm{Pa}$。\n- 观测到的切变场 $\\partial u/\\partial \\ln p(\\lambda,\\varphi,p)=0\\,\\mathrm{m/s}$ 对于所有网格点。\n- 参考纬度索引位于 $\\varphi_{\\mathrm{ref}}=0$（中间索引）。\n- 在 $\\varphi_{\\mathrm{ref}}$ 处的参考温度廓线为 $T_{\\mathrm{ref}}(p)=\\{1000,1000\\}\\,\\mathrm{K}$。\n\n对于每个用例，执行反演以获得完整的 $T(\\lambda,\\varphi,p)$ 场。然后，对于该用例，计算最北纬度（最大的 $\\varphi$）和最深层压强（最大的 $p$）处的纬向平均温度。将这三个结果中的每一个都以开尔文为单位表示为浮点数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个纬向平均温度（每个用例一个），形式为用方括号括起来的逗号分隔列表，例如 $[T_{A},T_{B},T_{C}]$，其中每个条目都以开尔文为单位。\n\n角度单位要求：所有角度必须以弧度为单位。\n压强单位要求：所有压强必须以帕斯卡为单位。\n温度单位要求：所有温度必须以开尔文为单位。",
            "solution": "该问题要求开发并实现一种方法，从观测到的纬向风垂直切变 $\\frac{\\partial u}{\\partial \\ln p}$ 来反演三维大气温度场 $T(\\lambda, \\varphi, p)$。该方法必须基于第一性原理：地转平衡、静力平衡和理想气体定律，并应用于旋转行星的球坐标系中。\n\n首先，我们推导连接温度场与风切变的关系，即热成风方程。推导从气压坐标 $(\\lambda, \\varphi, p)$ 下的纬向风 $u$ 的地转平衡方程开始：\n$$\nf u = - \\left( \\frac{\\partial \\Phi}{\\partial y} \\right)_p\n$$\n这里，$f = 2\\Omega\\sin\\varphi$ 是科里奥利参数，其中 $\\Omega$ 是行星自转速率，$\\varphi$ 是纬度。$\\Phi$ 是位势，$y$ 是经向距离。下标 $p$ 表示导数是在等压（恒定压强）面上求取的。\n\n接下来，我们引入静力平衡方程，在压强坐标中，它将位势的垂直导数与比容联系起来：\n$$\n\\frac{\\partial \\Phi}{\\partial p} = -\\frac{1}{\\rho}\n$$\n其中 $\\rho$ 是大气密度。\n\n第三个原理是理想气体定律，它关联了压强 $p$、密度 $\\rho$ 和温度 $T$：\n$$\np = \\rho R T\n$$\n其中 $R$ 是特定气体常数。这可以重新排列以将比容表示为 $\\frac{1}{\\rho} = \\frac{RT}{p}$。将其代入静力平衡方程得到：\n$$\n\\frac{\\partial \\Phi}{\\partial p} = -\\frac{RT}{p}\n$$\n现在，我们可以组合这些方程。我们对地转风方程关于压强 $p$ 求垂直导数：\n$$\nf \\frac{\\partial u}{\\partial p} = -\\frac{\\partial}{\\partial p} \\left( \\frac{\\partial \\Phi}{\\partial y} \\right)_p\n$$\n假设位势场足够光滑，我们可以交换偏导数的顺序（克莱罗定理）：\n$$\nf \\frac{\\partial u}{\\partial p} = -\\left( \\frac{\\partial}{\\partial y} \\left( \\frac{\\partial \\Phi}{\\partial p} \\right) \\right)_p\n$$\n代入我们关于 $\\frac{\\partial \\Phi}{\\partial p}$ 的表达式：\n$$\nf \\frac{\\partial u}{\\partial p} = -\\left( \\frac{\\partial}{\\partial y} \\left( -\\frac{RT}{p} \\right) \\right)_p = \\frac{R}{p} \\left( \\frac{\\partial T}{\\partial y} \\right)_p\n$$\n问题提供了关于压强的自然对数 $\\ln p$ 的风切变。我们可以使用链式法则关联这些导数：$\\frac{\\partial}{\\partial \\ln p} = p \\frac{\\partial}{\\partial p}$，因此 $\\frac{\\partial u}{\\partial p} = \\frac{1}{p} \\frac{\\partial u}{\\partial \\ln p}$。将此代入我们的方程中得到：\n$$\nf \\frac{1}{p} \\frac{\\partial u}{\\partial \\ln p} = \\frac{R}{p} \\left( \\frac{\\partial T}{\\partial y} \\right)_p\n$$\n因子 $1/p$ 消去，留下关联风切变与经向温度梯度的热成风方程：\n$$\nf \\frac{\\partial u}{\\partial \\ln p} = R \\left( \\frac{\\partial T}{\\partial y} \\right)_p\n$$\n该问题使用球坐标，其中经向距离元 $dy$ 通过 $dy = a \\, d\\varphi$ 与纬度变化 $d\\varphi$ 相关联，其中 $a$ 是行星半径。因此，经向导数可以写成 $\\frac{\\partial}{\\partial y} = \\frac{1}{a} \\frac{\\partial}{\\partial \\varphi}$。重新整理方程以求解经向温度梯度，得到：\n$$\n\\left( \\frac{\\partial T}{\\partial \\varphi} \\right)_p = \\frac{a f}{R} \\frac{\\partial u}{\\partial \\ln p} = \\frac{2\\Omega a \\sin\\varphi}{R} \\frac{\\partial u}{\\partial \\ln p}\n$$\n这是我们需要求解的最终微分方程。它根据已知的行星参数和观测到的风切变场，提供了每个点 $(\\lambda, \\varphi, p)$ 的经向温度梯度。\n\n为了求出温度场 $T(\\lambda, \\varphi, p)$ 本身，我们必须对这个梯度关于纬度 $\\varphi$ 进行积分。积分必须对每个经度 $\\lambda$ 和压强层 $p$ 执行。积分会引入一个积分常数，该常数必须由边界条件确定。问题以在指定参考纬度 $\\varphi_{\\mathrm{ref}}$ 处的参考温度廓线 $T_{\\mathrm{ref}}(p)$ 的形式提供了此条件。这意味着对于所有 $\\lambda$，$T(\\lambda, \\varphi_{\\mathrm{ref}}, p) = T_{\\mathrm{ref}}(p)$。\n\n任何纬度 $\\varphi$ 处的温度可以通过从参考纬度积分得到：\n$$\nT(\\lambda, \\varphi, p) = T(\\lambda, \\varphi_{\\mathrm{ref}}, p) + \\int_{\\varphi_{\\mathrm{ref}}}^{\\varphi} \\left( \\frac{\\partial T}{\\partial \\varphi'} \\right)_p (\\lambda, \\varphi', p) \\, d\\varphi'\n$$\n我们将在离散网格上执行此反演。设网格点由经度 $\\lambda_i$、纬度 $\\varphi_j$ 和压强 $p_k$ 的索引 $(i, j, k)$ 表示。设 $j_{\\mathrm{ref}}$ 是参考纬度的索引。我们在每个网格点计算温度梯度场，记作 $G_{ijk}$：\n$$\nG_{ijk} = \\left(\\frac{\\partial T}{\\partial \\varphi}\\right)_{ijk} = \\frac{2\\Omega a \\sin(\\varphi_j)}{R} \\left(\\frac{\\partial u}{\\partial \\ln p}\\right)_{ijk}\n$$\n我们使用梯形法则进行数值积分，因为它提供二阶精度。对于从纬度 $\\varphi_{j-1}$ 到 $\\varphi_j$ 的一步，温度更新为：\n$$\nT_{i,j,k} = T_{i,j-1,k} + \\frac{1}{2} \\left( G_{i,j-1,k} + G_{i,j,k} \\right) (\\varphi_j - \\varphi_{j-1})\n$$\n完整的温度场 $T_{ijk}$ 用参考纬度处的已知值进行初始化，$T_{i, j_{\\mathrm{ref}}, k} = T_{\\mathrm{ref}}(p_k)$。然后，我们分两部分进行积分：\n1. 对于参考纬度以北的纬度（$j > j_{\\mathrm{ref}}$），我们向极地积分，从 $j = j_{\\mathrm{ref}} + 1$ 到最北端的网格点，迭代应用梯形法则。\n2. 对于参考纬度以南的纬度（$j  j_{\\mathrm{ref}}$），我们向另一极积分，应用该法则的重新排列形式：$T_{i,j-1,k} = T_{i,j,k} - \\frac{1}{2} \\left( G_{i,j-1,k} + G_{i,j,k} \\right) (\\varphi_j - \\varphi_{j-1})$。这从 $j = j_{\\mathrm{ref}}$ 向下迭代应用到最南端的网格点。\n\n对于给定的测试用例，填充整个三维温度场 $T_{ijk}$ 后，最后一步是计算最北纬度和最深层压强处的纬向平均温度。最北纬度是 $\\varphi$ 值最大的纬度，最深层压强是 $p$ 值最大的压强。我们找到它们各自的网格索引 $j_{\\mathrm{north}}$ 和 $k_{\\mathrm{deep}}$。纬向平均是所有经度的平均值，计算公式为 $\\frac{1}{N_\\lambda} \\sum_{i=0}^{N_\\lambda-1} T_{i, j_{\\mathrm{north}}, k_{\\mathrm{deep}}}$。对三个测试用例中的每一个都重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the three specified test cases.\n    It orchestrates the calculation for each case and prints the final results.\n    \"\"\"\n\n    # Case A: General midlatitude case\n    case_a = {\n        'a': 9.4e6,  # Planetary radius in meters\n        'P_days': 0.7,  # Rotation period in days\n        'R': 3700.0,  # Specific gas constant in J/(kg K)\n        'lons': np.array([0, np.pi/2, np.pi]),  # Longitudes in radians\n        'lats': np.array([-np.pi/6, 0, np.pi/6]),  # Latitudes in radians\n        'pressures': np.array([1.0e5, 5.0e4]),  # Pressures in Pascals\n        'shear_func': lambda lam, phi, p: 20.0 * np.cos(phi) * np.sin(lam) * (1 - 0.3 * (p / 1.0e5 - 1)),\n        'ref_lat_idx': 1,\n        'ref_temps': np.array([1400.0, 1400.0])  # K\n    }\n\n    # Case B: Equatorial-edge case\n    case_b = {\n        'a': 6.0e6,\n        'P_days': 3.0,\n        'R': 3700.0,\n        'lons': np.array([0.0]),\n        'lats': np.array([-5 * np.pi / 180, 0, 5 * np.pi / 180]),\n        'pressures': np.array([1.0e5, 8.0e4, 5.0e4]),\n        'shear_func': lambda lam, phi, p: 12.0 * np.cos(phi) * (p / 1.0e5),\n        'ref_lat_idx': 1,\n        'ref_temps': np.array([1200.0, 1180.0, 1150.0])\n    }\n\n    # Case C: Zero-shear boundary case\n    case_c = {\n        'a': 7.0e6,\n        'P_days': 1.0,\n        'R': 3700.0,\n        'lons': np.array([0, np.pi/3, 2*np.pi/3]),\n        'lats': np.array([-np.pi/6, 0, np.pi/6]),\n        'pressures': np.array([1.2e5, 8.0e4]),\n        'shear_func': lambda lam, phi, p: 0.0,\n        'ref_lat_idx': 1,\n        'ref_temps': np.array([1000.0, 1000.0])\n    }\n\n    test_cases = [case_a, case_b, case_c]\n    results = []\n\n    for case in test_cases:\n        # Perform the inversion and calculate the required zonal-mean temperature\n        result = compute_zonal_mean_temp(case)\n        results.append(result)\n\n    # Format and print the final output as a single line\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\n\ndef compute_zonal_mean_temp(case):\n    \"\"\"\n    Computes the 3D temperature field and returns the zonal-mean temperature\n    at the northernmost latitude and deepest pressure level for a single case.\n    \"\"\"\n    # Unpack case parameters\n    a = case['a']\n    P_days = case['P_days']\n    R = case['R']\n    lons = case['lons']\n    lats = case['lats']\n    pressures = case['pressures']\n    shear_func = case['shear_func']\n    ref_lat_idx = case['ref_lat_idx']\n    ref_temps = case['ref_temps']\n\n    # Physical constants and derived parameters\n    P_sec = P_days * 24.0 * 3600.0\n    omega = 2.0 * np.pi / P_sec\n\n    # Grid dimensions\n    n_lon, n_lat, n_p = len(lons), len(lats), len(pressures)\n\n    # Create 3D grid for calculations. 'ij' indexing gives (lon, lat, p) shape.\n    lon_grid, lat_grid, p_grid = np.meshgrid(lons, lats, pressures, indexing='ij')\n\n    # 1. Calculate the observed wind shear field on the grid\n    shear_field = shear_func(lon_grid, lat_grid, p_grid)\n    \n    # 2. Calculate the meridional temperature gradient field G(lambda, phi, p)\n    # G = (2 * omega * a * sin(phi) / R) * (du/dlnp)\n    term_prefactor = (2.0 * omega * a / R)\n    temp_gradient_field = term_prefactor * np.sin(lat_grid) * shear_field\n\n    # 3. Initialize the 3D temperature field\n    temp_field = np.full((n_lon, n_lat, n_p), np.nan)\n\n    # 4. Set the boundary condition: temperature at the reference latitude\n    # The reference temperature profile is independent of longitude\n    temp_field[:, ref_lat_idx, :] = ref_temps\n\n    # 5. Integrate meridionally from the reference latitude using the trapezoidal rule\n    \n    # Integrate poleward (j  ref_lat_idx)\n    for j in range(ref_lat_idx + 1, n_lat):\n        delta_lat = lats[j] - lats[j - 1]\n        # T_j = T_{j-1} + 0.5 * (G_{j-1} + G_j) * dlat\n        temp_field[:, j, :] = temp_field[:, j - 1, :] + 0.5 * (\n            temp_gradient_field[:, j - 1, :] + temp_gradient_field[:, j, :]\n        ) * delta_lat\n\n    # Integrate toward the other pole (j  ref_lat_idx)\n    for j in range(ref_lat_idx - 1, -1, -1):\n        delta_lat = lats[j + 1] - lats[j]\n        # T_j = T_{j+1} - 0.5 * (G_j + G_{j+1}) * dlat\n        temp_field[:, j, :] = temp_field[:, j + 1, :] - 0.5 * (\n            temp_gradient_field[:, j, :] + temp_gradient_field[:, j + 1, :]\n        ) * delta_lat\n\n    # 6. Calculate the final required value\n    # Find index of northernmost latitude and deepest pressure\n    idx_north = np.argmax(lats)\n    idx_deep = np.argmax(pressures)\n\n    # Extract temperatures at the specific location (all longitudes)\n    temps_at_loc = temp_field[:, idx_north, idx_deep]\n    \n    # Compute the zonal mean\n    zonal_mean = np.mean(temps_at_loc)\n    \n    return zonal_mean\n\n# Execute the main function\nsolve()\n```"
        }
    ]
}