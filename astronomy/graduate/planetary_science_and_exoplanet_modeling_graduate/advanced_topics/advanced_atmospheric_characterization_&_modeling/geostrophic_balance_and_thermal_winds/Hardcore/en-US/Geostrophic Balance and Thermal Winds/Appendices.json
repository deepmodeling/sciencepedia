{
    "hands_on_practices": [
        {
            "introduction": "The most direct way to understand geostrophic balance is to apply it. This first exercise provides a concrete opportunity to compute the geostrophic wind vector, $\\mathbf{u}_g$, directly from a specified pressure field on a hypothetical exoplanet. By working through this calculation (), you will solidify your understanding of how the pressure gradient force and the Coriolis force combine to dictate large-scale atmospheric flow, and you'll practice the fundamental skill of translating a pressure map into a velocity field.",
            "id": "4161550",
            "problem": "Consider a midlatitude column of a stably stratified atmosphere on a rapidly rotating exoplanet. Adopt a local Cartesian coordinate system with $x$ eastward, $y$ northward, and $z$ upward. Assume a constant air density $\\rho$ and a constant Coriolis parameter $f0$ representative of the Northern Hemisphere. The horizontal pressure field is prescribed at a given isobaric surface by\n$$\np(x,y) \\;=\\; p_{\\mathrm{ref}} \\;+\\; a\\,x \\;+\\; b\\,y \\;+\\; c\\,x^{2} \\;+\\; d\\,y^{2},\n$$\nwhere $p_{\\mathrm{ref}}$ is a constant reference pressure. For a specific exoplanet, take $\\rho = 1.0\\,\\mathrm{kg\\,m^{-3}}$, $f = 1.5\\times 10^{-4}\\,\\mathrm{s^{-1}}$, $a = -1.1\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$, $b = 0.7\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$, $c = 2.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$, and $d = -1.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$. \n\nStarting from the horizontal momentum equations in a rotating frame and invoking geostrophic balance under the stated assumptions, derive the expression for the geostrophic wind vector $\\mathbf{u}_{g}(x,y)$ in terms of $\\nabla_{h}p(x,y)$, and then evaluate $\\mathbf{u}_{g}$ at the point $(x,y)=(1.0\\times 10^{6}\\,\\mathrm{m},\\,2.0\\times 10^{6}\\,\\mathrm{m})$. State, based on your derivation, the direction of the geostrophic flow relative to isobars for $f0$.\n\nReport the final numerical value of the geostrophic wind at the specified point as the two components $(u_{g},v_{g})$ in $\\mathrm{m\\,s^{-1}}$ using a row matrix format, and round each component to four significant figures.",
            "solution": "The problem is first validated to ensure it is scientifically sound, self-contained, and well-posed.\n\n### Step 1: Extract Givens\n-   **Coordinate System**: $x$ (eastward), $y$ (northward), $z$ (upward).\n-   **Atmosphere**: Stably stratified, constant air density $\\rho$.\n-   **Rotation**: Constant Coriolis parameter $f > 0$.\n-   **Pressure Field**: $p(x,y) = p_{\\mathrm{ref}} + a\\,x + b\\,y + c\\,x^{2} + d\\,y^{2}$.\n-   **Constants**:\n    -   $\\rho = 1.0\\,\\mathrm{kg\\,m^{-3}}$\n    -   $f = 1.5\\times 10^{-4}\\,\\mathrm{s^{-1}}$\n    -   $a = -1.1\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$\n    -   $b = 0.7\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$\n    -   $c = 2.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$\n    -   $d = -1.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$\n-   **Evaluation Point**: $(x,y)=(1.0\\times 10^{6}\\,\\mathrm{m},\\,2.0\\times 10^{6}\\,\\mathrm{m})$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is a standard application of the geostrophic approximation, a fundamental concept in geophysical fluid dynamics. The assumptions of constant density and Coriolis parameter are common simplifications in idealized models.\n2.  **Well-Posed**: The problem provides a well-defined pressure field and all necessary constants to determine the pressure gradient and, subsequently, the geostrophic wind. The request is specific and has a unique solution.\n3.  **Objective**: The problem is stated in precise, quantitative terms, free of subjectivity.\n4.  **Dimensional and Physical Consistency**: The units of the given constants are consistent. As shown by a dimensional analysis, the pressure gradient divided by the product of density and the Coriolis parameter correctly yields units of velocity: $[\\mathrm{Pa\\,m^{-1}} / (\\mathrm{kg\\,m^{-3}} \\cdot \\mathrm{s^{-1}})] = [(\\mathrm{kg\\,m\\,s^{-2}}\\,\\mathrm{m^{-2}})\\,\\mathrm{m^{-1}} / (\\mathrm{kg\\,m^{-3}} \\cdot \\mathrm{s^{-1}})] = [\\mathrm{kg\\,m^{-2}\\,s^{-2}}] / [\\mathrm{kg\\,m^{-3}\\,s^{-1}}] = \\mathrm{m\\,s^{-1}}$. The numerical values are within plausible, albeit exoplanetary, ranges.\n\n### Step 3: Verdict and Action\nThe problem is valid. The solution process will now proceed.\n\nThe horizontal momentum equations in a rotating frame, neglecting friction, are:\n$$\n\\frac{Du}{Dt} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} + fv\n$$\n$$\n\\frac{Dv}{Dt} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} - fu\n$$\nwhere $\\mathbf{u} = (u,v)$ is the horizontal velocity vector, $p$ is the pressure, $\\rho$ is the density, $f$ is the Coriolis parameter, and $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + u\\frac{\\partial}{\\partial x} + v\\frac{\\partial}{\\partial y}$ is the material derivative in two dimensions.\n\nGeostrophic balance is achieved when the pressure gradient force is balanced by the Coriolis force. This requires the flow to be steady ($\\frac{\\partial}{\\partial t} = 0$) and the advective acceleration terms to be negligible (i.e., for low Rossby number flows). Under these assumptions, the acceleration terms on the left-hand side vanish, and the momentum equations simplify to the geostrophic equations:\n$$\n0 = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} + fv_{g}\n$$\n$$\n0 = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} - fu_{g}\n$$\nwhere $\\mathbf{u}_{g} = (u_{g}, v_{g})$ denotes the geostrophic wind vector.\n\nSolving these two equations for the components of the geostrophic wind, $u_g$ and $v_g$, we obtain:\n$$\nu_{g} = -\\frac{1}{f\\rho}\\frac{\\partial p}{\\partial y}\n$$\n$$\nv_{g} = \\frac{1}{f\\rho}\\frac{\\partial p}{\\partial x}\n$$\nThese expressions define the geostrophic wind in terms of the horizontal pressure gradient, $\\nabla_{h}p = \\left(\\frac{\\partial p}{\\partial x}, \\frac{\\partial p}{\\partial y}\\right)$.\n\nIn vector notation, the geostrophic wind vector $\\mathbf{u}_{g} = u_{g}\\mathbf{i} + v_{g}\\mathbf{j}$ can be expressed as:\n$$\n\\mathbf{u}_{g} = \\frac{1}{f\\rho} \\left( -\\frac{\\partial p}{\\partial y}\\mathbf{i} + \\frac{\\partial p}{\\partial x}\\mathbf{j} \\right) = \\frac{1}{f\\rho} (\\mathbf{k} \\times \\nabla_{h}p)\n$$\nwhere $\\mathbf{k}$ is the unit vector in the vertical direction.\n\nFrom the vector expression $\\mathbf{u}_{g} = \\frac{1}{f\\rho} (\\mathbf{k} \\times \\nabla_{h}p)$, we can determine the direction of the geostrophic flow. The pressure gradient vector $\\nabla_{h}p$ is, by definition, perpendicular to the isobars (lines of constant pressure) and points towards higher pressure. The cross product with the vertical unit vector $\\mathbf{k}$ results in a vector $\\mathbf{u}_{g}$ that is perpendicular to $\\nabla_{h}p$. Therefore, the geostrophic wind must flow parallel to the isobars.\n\nFor the Northern Hemisphere, where $f0$, the direction of $\\mathbf{u}_{g}$ is given by $\\mathbf{k} \\times \\nabla_{h}p$. By the right-hand rule, this vector is rotated $90^{\\circ}$ counter-clockwise from the direction of $\\nabla_{h}p$. Since $\\nabla_{h}p$ points towards high pressure, this means the geostrophic wind flows such that the high-pressure area is to its right. This is known as Buys Ballot's law.\n\nNow, we evaluate the geostrophic wind at the specified location. First, we compute the components of the pressure gradient from the given pressure field $p(x,y) = p_{\\mathrm{ref}} + a\\,x + b\\,y + c\\,x^{2} + d\\,y^{2}$:\n$$\n\\frac{\\partial p}{\\partial x} = a + 2cx\n$$\n$$\n\\frac{\\partial p}{\\partial y} = b + 2dy\n$$\nWe evaluate these derivatives at the point $(x_{0}, y_{0}) = (1.0 \\times 10^{6}\\,\\mathrm{m}, 2.0 \\times 10^{6}\\,\\mathrm{m})$ using the provided constants:\n$a = -1.1\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$, $b = 0.7\\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}$, $c = 2.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$, and $d = -1.0\\times 10^{-12}\\,\\mathrm{Pa\\,m^{-2}}$.\n\nThe x-component of the pressure gradient is:\n$$\n\\frac{\\partial p}{\\partial x} = (-1.1 \\times 10^{-3}) + 2(2.0 \\times 10^{-12})(1.0 \\times 10^{6}) = -1.1 \\times 10^{-3} + 4.0 \\times 10^{-6} = -0.0011 + 0.000004 = -1.096 \\times 10^{-3}\\,\\mathrm{Pa\\,m^{-1}}\n$$\nThe y-component of the pressure gradient is:\n$$\n\\frac{\\partial p}{\\partial y} = (0.7 \\times 10^{-3}) + 2(-1.0 \\times 10^{-12})(2.0 \\times 10^{6}) = 0.7 \\times 10^{-3} - 4.0 \\times 10^{-6} = 0.0007 - 0.000004 = 6.96 \\times 10^{-4}\\,\\mathrm{Pa\\,m^{-1}}\n$$\nWe are given $\\rho = 1.0\\,\\mathrm{kg\\,m^{-3}}$ and $f = 1.5 \\times 10^{-4}\\,\\mathrm{s^{-1}}$. The product $f\\rho$ is:\n$$\nf\\rho = (1.5 \\times 10^{-4}\\,\\mathrm{s^{-1}}) \\times (1.0\\,\\mathrm{kg\\,m^{-3}}) = 1.5 \\times 10^{-4}\\,\\mathrm{kg\\,m^{-3}\\,s^{-1}}\n$$\nNow we compute the components of the geostrophic wind:\n$$\nu_{g} = -\\frac{1}{f\\rho}\\frac{\\partial p}{\\partial y} = -\\frac{1}{1.5 \\times 10^{-4}} (6.96 \\times 10^{-4}) = -\\frac{6.96}{1.5} = -4.64\\,\\mathrm{m\\,s^{-1}}\n$$\n$$\nv_{g} = \\frac{1}{f\\rho}\\frac{\\partial p}{\\partial x} = \\frac{1}{1.5 \\times 10^{-4}} (-1.096 \\times 10^{-3}) = \\frac{-1.096 \\times 10^{-3}}{1.5 \\times 10^{-4}} = \\frac{-10.96 \\times 10^{-4}}{1.5 \\times 10^{-4}} = -\\frac{10.96}{1.5} \\approx -7.30666... \\,\\mathrm{m\\,s^{-1}}\n$$\nRounding each component to four significant figures as required:\n$$\nu_{g} \\approx -4.640\\,\\mathrm{m\\,s^{-1}}\n$$\n$$\nv_{g} \\approx -7.307\\,\\mathrm{m\\,s^{-1}}\n$$\nThe final geostrophic wind vector at the specified point is $(u_g, v_g) = (-4.640, -7.307)\\,\\mathrm{m\\,s^{-1}}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-4.640  -7.307\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While powerful, geostrophic balance is an approximation that assumes straight, unaccelerated flow. This practice () challenges you to move beyond this idealization and explore the dynamics of curved flow, which is characteristic of weather systems and atmospheric jets. You will derive the gradient wind balance, which includes the centripetal acceleration, and in doing so, develop a quantitative measure—the Rossby number—to determine when the geostrophic approximation is valid and to estimate its error.",
            "id": "4161525",
            "problem": "On a rapidly rotating terrestrial exoplanet, consider a steady, horizontal, frictionless atmospheric flow that follows curved isobars. The planetary rotation rate is $\\Omega$, the latitude is $\\phi$, and the local flow has constant speed $V$ and a streamline radius of curvature $R$. Let the horizontal Pressure Gradient Force (PGF) per unit mass have magnitude $G$. Starting from the horizontal momentum equations in a rotating frame and the definition of centripetal acceleration, work in natural (streamline-following) coordinates to obtain the normal-force balance for a cyclonic flow in the Northern Hemisphere. Use this to define a dimensionless parameter that measures the relative importance of curvature to the Coriolis term, and express the fractional error incurred by diagnosing the wind speed from geostrophic balance instead of the more accurate gradient-wind balance, where the fractional error is defined as $(V_g - V)/V$ with $V_g$ denoting the wind speed that would be inferred by imposing geostrophic balance for the same $G$.\n\nThen, for the exoplanet and flow specified by:\n- rotation rate $\\Omega = 1.20 \\times 10^{-4}\\ \\mathrm{s^{-1}}$,\n- latitude $\\phi = 50$ degrees,\n- wind speed $V = 80\\ \\mathrm{m\\,s^{-1}}$,\n- radius of curvature $R = 1.20 \\times 10^{6}\\ \\mathrm{m}$,\n\nevaluate the fractional geostrophic error as a pure number. Use the standard midlatitude approximation $f = 2 \\Omega \\sin\\phi$ for the Coriolis parameter. Express the final answer as a decimal with no units and round your result to four significant figures. Angles are given in degrees.",
            "solution": "The problem asks for a derivation of the gradient wind balance for a specific flow, the definition of a relevant dimensionless parameter, an expression for the fractional error of the geostrophic approximation, and a numerical calculation of this error for a given exoplanet scenario.\n\nFirst, we validate the problem.\n\n### Step 1: Extract Givens\n-   Planetary rotation rate: $\\Omega$\n-   Latitude: $\\phi$\n-   Flow characteristics: Steady, horizontal, frictionless, following curved isobars.\n-   Flow speed (constant): $V$\n-   Streamline radius of curvature: $R$\n-   Magnitude of horizontal Pressure Gradient Force (PGF) per unit mass: $G$\n-   Coordinate system: Natural (streamline-following) coordinates.\n-   Flow type: Cyclonic flow in the Northern Hemisphere.\n-   Coriolis parameter: $f = 2 \\Omega \\sin\\phi$.\n-   Geostrophic wind speed for the same $G$: $V_g$.\n-   Definition of fractional error: $(V_g - V)/V$.\n-   Numerical values for evaluation:\n    -   $\\Omega = 1.20 \\times 10^{-4}\\ \\mathrm{s^{-1}}$\n    -   $\\phi = 50$ degrees\n    -   $V = 80\\ \\mathrm{m\\,s^{-1}}$\n    -   $R = 1.20 \\times 10^{6}\\ \\mathrm{m}$\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is based on the fundamental principles of fluid dynamics on a rotating body, specifically the balance of forces (pressure gradient, Coriolis) and acceleration (centripetal) in atmospheric flow. These concepts are central to meteorology and planetary science.\n-   **Well-Posed**: The problem is structured logically. It requests a series of derivations and calculations for which all necessary information and definitions are provided. A unique analytical and numerical solution can be determined.\n-   **Objective**: The problem is stated using precise, standard scientific terminology. There is no ambiguity or subjective content.\n-   The problem does not exhibit any flaws such as scientific unsoundness, incompleteness, contradiction, or infeasibility. The provided numerical values, while for a hypothetical exoplanet, are physically plausible for a rapidly rotating terrestrial world with a substantial atmosphere.\n\n### Step 3: Verdict and Action\nThe problem is valid. We will proceed with the solution.\n\n### Derivation of the Gradient Wind Balance\nThe horizontal momentum equation for a frictionless flow on a rotating planet, expressed per unit mass, is:\n$$\n\\frac{D\\vec{u}_h}{Dt} = -\\frac{1}{\\rho}\\nabla_h p - 2\\vec{\\Omega} \\times \\vec{u}_h\n$$\nwhere $\\vec{u}_h$ is the horizontal velocity, $\\frac{D}{Dt}$ is the material derivative, $\\rho$ is the density, $\\nabla_h p$ is the horizontal pressure gradient, and $\\vec{\\Omega}$ is the planetary rotation vector.\n\nLet $\\vec{G} = -\\frac{1}{\\rho}\\nabla_h p$ be the PGF per unit mass, with magnitude $G$. The Coriolis force per unit mass is $\\vec{F}_{Co} = -2\\vec{\\Omega} \\times \\vec{u}_h$. The equation becomes:\n$$\n\\frac{D\\vec{u}_h}{Dt} = \\vec{G} + \\vec{F}_{Co}\n$$\nWe work in a natural coordinate system with unit vectors $(\\hat{s}, \\hat{n})$, where $\\hat{s}$ is tangential to the flow direction and $\\hat{n}$ is normal to the flow, pointing towards the center of curvature. The velocity is $\\vec{u}_h = V\\hat{s}$.\n\nThe acceleration term for a steady flow (${\\partial}/{\\partial t} = 0$) with constant speed $V$ along a curved path with radius of curvature $R$ is the centripetal acceleration:\n$$\n\\frac{D\\vec{u}_h}{Dt} = \\frac{V^2}{R}\\hat{n}\n$$\nThe problem specifies a cyclonic flow in the Northern Hemisphere. This corresponds to counter-clockwise rotation around a low-pressure center.\n1.  The PGF, $\\vec{G}$, points from high to low pressure, so it is directed inward toward the center of curvature. Thus, $\\vec{G} = G\\hat{n}$.\n2.  The Coriolis force, $\\vec{F}_{Co}$, in the horizontal plane has magnitude $fV$, where $f = 2\\Omega\\sin\\phi$ is the Coriolis parameter, and is directed to the right of the velocity vector in the Northern Hemisphere. For counter-clockwise circular motion, \"to the right\" is outward, away from the center of curvature. Thus, the Coriolis force opposes the $\\hat{n}$ direction: $\\vec{F}_{Co} = -fV\\hat{n}$.\n\nSubstituting these terms into the momentum equation's normal component:\n$$\n\\text{Acceleration}_{\\,n} = \\text{PGF}_{\\,n} + \\text{Coriolis}_{\\,n}\n$$\n$$\n\\frac{V^2}{R} = G - fV\n$$\nThis is the equation for the normal-force balance, also known as the gradient wind balance for a cyclonic flow in the Northern Hemisphere.\n\n### Dimensionless Parameter\nThe problem asks for a dimensionless parameter measuring the relative importance of curvature to the Coriolis term. The \"curvature term\" in the force balance is the centripetal force required to maintain the curved path, which is balanced by the net force. The force itself is $m \\frac{V^2}{R}$. The associated acceleration is $\\frac{V^2}{R}$. The Coriolis force per unit mass has magnitude $fV$.\n\nThe ratio of the magnitude of the centripetal acceleration to the magnitude of the Coriolis acceleration is a suitable dimensionless parameter, commonly known as the Rossby number, $Ro$:\n$$\nRo = \\frac{\\text{centripetal acceleration}}{\\text{Coriolis acceleration}} = \\frac{V^2/R}{fV} = \\frac{V}{fR}\n$$\n\n### Fractional Geostrophic Error\nGeostrophic balance is a simpler model where the flow is assumed to be straight ($R \\to \\infty$) and unaccelerated ($\\frac{D\\vec{u}_h}{Dt} = 0$). In this case, the PGF is balanced entirely by the Coriolis force. For a wind speed $V_g$ under geostrophic balance with the same PGF magnitude $G$, the balance equation is:\n$$\n0 = G - fV_g \\implies G = fV_g\n$$\nThe fractional error incurred by using the geostrophic wind $V_g$ instead of the true gradient wind $V$ is defined as $\\frac{V_g - V}{V}$.\nTo find an expression for this, we substitute $G = fV_g$ into the gradient wind equation:\n$$\n\\frac{V^2}{R} = (fV_g) - fV = f(V_g - V)\n$$\nTo obtain the desired fractional error, we divide both sides by $fV$:\n$$\n\\frac{V^2}{fVR} = \\frac{f(V_g - V)}{fV}\n$$\n$$\n\\frac{V_g - V}{V} = \\frac{V}{fR}\n$$\nThus, the fractional error is precisely the Rossby number, $Ro$.\n\n### Numerical Evaluation\nWe now calculate the value of this fractional error for the given exoplanet data.\nThe required quantities are:\n-   $V = 80\\ \\mathrm{m\\,s^{-1}}$\n-   $R = 1.20 \\times 10^{6}\\ \\mathrm{m}$\n-   $\\Omega = 1.20 \\times 10^{-4}\\ \\mathrm{s^{-1}}$\n-   $\\phi = 50$ degrees\n\nFirst, calculate the Coriolis parameter, $f$:\n$$\nf = 2\\Omega\\sin\\phi = 2 \\times (1.20 \\times 10^{-4}\\ \\mathrm{s^{-1}}) \\times \\sin(50^{\\circ})\n$$\nUsing the value $\\sin(50^{\\circ}) \\approx 0.7660444$:\n$$\nf \\approx 2.40 \\times 10^{-4} \\times 0.7660444\\ \\mathrm{s^{-1}} \\approx 1.8385 \\times 10^{-4}\\ \\mathrm{s^{-1}}\n$$\nNow, we can calculate the fractional error, $\\frac{V}{fR}$:\n$$\n\\text{Fractional Error} = \\frac{80\\ \\mathrm{m\\,s^{-1}}}{(1.838506... \\times 10^{-4}\\ \\mathrm{s^{-1}}) \\times (1.20 \\times 10^{6}\\ \\mathrm{m})}\n$$\n$$\n\\text{Fractional Error} = \\frac{80}{1.838506... \\times 1.20 \\times 10^2} = \\frac{80}{220.6207...}\n$$\n$$\n\\text{Fractional Error} \\approx 0.362614\n$$\nRounding the result to four significant figures, we get $0.3626$.",
            "answer": "$$\\boxed{0.3626}$$"
        },
        {
            "introduction": "This final practice serves as a capstone, connecting the principles of geostrophic and hydrostatic balance to the practical challenges of atmospheric remote sensing. The thermal wind relationship, which links vertical wind shear to horizontal temperature gradients, is a powerful diagnostic tool. In this computational exercise (), you will design and implement an inversion algorithm to retrieve a planet's three-dimensional temperature structure, $T(\\lambda,\\varphi,p)$, from observations of its wind field, a task central to characterizing exoplanetary atmospheres.",
            "id": "4161502",
            "problem": "You are tasked with developing a complete inversion method (and implementing it as a runnable program) to retrieve the three-dimensional temperature field $T(\\lambda,\\varphi,p)$ on a rotating exoplanet from measurements of the vertical shear of the zonal wind $\\partial u/\\partial \\ln p$ obtained by Doppler techniques. Your method must start from first principles applicable to large-scale planetary atmospheres: horizontal geostrophic balance on pressure surfaces, hydrostatic balance, and the Ideal Gas Law. You must treat the meridional variation of the Coriolis parameter $f(\\varphi)$ explicitly, where $f(\\varphi)=2\\Omega\\sin\\varphi$, with $\\Omega$ the planetary rotation rate, and use spherical geometry with planetary radius $a$ to relate meridional derivatives in latitude to distance. All angles must be in radians, pressure in Pascals (Pa), wind in meters per second (m/s), and temperature in Kelvin (K).\n\nYou will implement a discrete inversion on given longitude-latitude-pressure grids by:\n- Using the scientifically appropriate balance laws to express $T$-gradients in terms of the observed wind shear and $f(\\varphi)$.\n- Converting meridional derivatives $\\partial/\\partial y$ to latitude derivatives $\\partial/\\partial \\varphi$ using $y=a\\varphi$.\n- Integrating meridional temperature gradients along latitude to recover $T(\\lambda,\\varphi,p)$, given a specified reference temperature $T_{\\mathrm{ref}}(\\varphi_{\\mathrm{ref}},p)$ at a chosen reference latitude $\\varphi_{\\mathrm{ref}}$ for each pressure level.\n\nTo ensure testability, apply your method to the following three test cases. Each case defines the planetary parameters, grids, the observed shear field $\\partial u/\\partial \\ln p(\\lambda,\\varphi,p)$, the reference latitude index, and the reference temperature profile at that latitude:\n\nCase A (general midlatitude case):\n- Planetary radius $a=9.4\\times 10^{6}\\,\\mathrm{m}$.\n- Rotation period $P=0.7\\,\\mathrm{days}$ so $\\Omega=2\\pi/P$ with $P$ in seconds.\n- Specific gas constant $R=3700\\,\\mathrm{J/(kg\\,K)}$.\n- Longitudes $\\lambda\\in\\{0,\\pi/2,\\pi\\}\\,\\mathrm{rad}$.\n- Latitudes $\\varphi\\in\\{-\\pi/6,0,\\pi/6\\}\\,\\mathrm{rad}$.\n- Pressures $p\\in\\{1.0\\times 10^{5},5.0\\times 10^{4}\\}\\,\\mathrm{Pa}$.\n- Observed shear field $\\partial u/\\partial \\ln p(\\lambda,\\varphi,p)=S_{0}\\cos\\varphi\\sin\\lambda\\left[1-0.3\\left(\\frac{p}{10^{5}}-1\\right)\\right]$ with $S_{0}=20\\,\\mathrm{m/s}$.\n- Reference latitude index at $\\varphi_{\\mathrm{ref}}=0$ (the middle index).\n- Reference temperature profile $T_{\\mathrm{ref}}(p)=\\{1400,1400\\}\\,\\mathrm{K}$ at $\\varphi_{\\mathrm{ref}}$.\n\nCase B (equatorial-edge case to test small-$f$ behavior):\n- Planetary radius $a=6.0\\times 10^{6}\\,\\mathrm{m}$.\n- Rotation period $P=3.0\\,\\mathrm{days}$ so $\\Omega=2\\pi/P$ with $P$ in seconds.\n- Specific gas constant $R=3700\\,\\mathrm{J/(kg\\,K)}$.\n- Longitudes $\\lambda\\in\\{0\\}\\,\\mathrm{rad}$.\n- Latitudes $\\varphi\\in\\{-5\\pi/180,0,5\\pi/180\\}\\,\\mathrm{rad}$.\n- Pressures $p\\in\\{1.0\\times 10^{5},8.0\\times 10^{4},5.0\\times 10^{4}\\}\\,\\mathrm{Pa}$.\n- Observed shear field $\\partial u/\\partial \\ln p(\\lambda,\\varphi,p)=S_{1}\\cos\\varphi\\left(\\frac{p}{10^{5}}\\right)$ with $S_{1}=12\\,\\mathrm{m/s}$.\n- Reference latitude index at $\\varphi_{\\mathrm{ref}}=0$ (the middle index).\n- Reference temperature profile $T_{\\mathrm{ref}}(p)=\\{1200,1180,1150\\}\\,\\mathrm{K}$ at $\\varphi_{\\mathrm{ref}}$.\n\nCase C (zero-shear boundary case):\n- Planetary radius $a=7.0\\times 10^{6}\\,\\mathrm{m}$.\n- Rotation period $P=1.0\\,\\mathrm{days}$ so $\\Omega=2\\pi/P$ with $P$ in seconds.\n- Specific gas constant $R=3700\\,\\mathrm{J/(kg\\,K)}$.\n- Longitudes $\\lambda\\in\\{0,\\pi/3,2\\pi/3\\}\\,\\mathrm{rad}$.\n- Latitudes $\\varphi\\in\\{-\\pi/6,0,\\pi/6\\}\\,\\mathrm{rad}$.\n- Pressures $p\\in\\{1.2\\times 10^{5},8.0\\times 10^{4}\\}\\,\\mathrm{Pa}$.\n- Observed shear field $\\partial u/\\partial \\ln p(\\lambda,\\varphi,p)=0\\,\\mathrm{m/s}$ for all grid points.\n- Reference latitude index at $\\varphi_{\\mathrm{ref}}=0$ (the middle index).\n- Reference temperature profile $T_{\\mathrm{ref}}(p)=\\{1000,1000\\}\\,\\mathrm{K}$ at $\\varphi_{\\mathrm{ref}}$.\n\nFor each case, perform the inversion to obtain the full $T(\\lambda,\\varphi,p)$ field. Then, for that case, compute the zonal-mean temperature at the northernmost latitude (largest $\\varphi$) and the deepest pressure (largest $p$). Express each of these three results in Kelvin as floating-point numbers.\n\nFinal output format:\nYour program should produce a single line of output containing the three zonal-mean temperatures (one per case) as a comma-separated list enclosed in square brackets, for example $[T_{A},T_{B},T_{C}]$, where each entry is in Kelvin.\n\nAngle unit requirement: All angles must be in radians.\nPressure unit requirement: All pressures must be in Pascals.\nTemperature unit requirement: All temperatures must be in Kelvin.",
            "solution": "The problem requires the development and implementation of a method to retrieve a three-dimensional atmospheric temperature field, $T(\\lambda, \\varphi, p)$, from observations of the vertical shear of the zonal wind, $\\frac{\\partial u}{\\partial \\ln p}$. The method must be based on first principles: geostrophic balance, hydrostatic balance, and the ideal gas law, applied in spherical coordinates on a rotating planet.\n\nFirst, we derive the governing equation that relates the temperature field to the wind shear. This relationship is known as the Thermal Wind Equation. The derivation begins with the geostrophic balance for the zonal wind, $u$, in pressure coordinates $(\\lambda, \\varphi, p)$:\n$$\nf u = - \\left( \\frac{\\partial \\Phi}{\\partial y} \\right)_p\n$$\nHere, $f = 2\\Omega\\sin\\varphi$ is the Coriolis parameter, where $\\Omega$ is the planetary rotation rate and $\\varphi$ is the latitude. $\\Phi$ is the geopotential, and $y$ is the meridional distance. The subscript $p$ indicates that the derivative is taken on an isobaric (constant pressure) surface.\n\nNext, we introduce the hydrostatic balance equation, which in pressure coordinates relates the vertical derivative of the geopotential to the specific volume:\n$$\n\\frac{\\partial \\Phi}{\\partial p} = -\\frac{1}{\\rho}\n$$\nwhere $\\rho$ is the atmospheric density.\n\nThe third principle is the ideal gas law, which relates pressure $p$, density $\\rho$, and temperature $T$:\n$$\np = \\rho R T\n$$\nwhere $R$ is the specific gas constant. This can be rearranged to express the specific volume as $\\frac{1}{\\rho} = \\frac{RT}{p}$. Substituting this into the hydrostatic equation yields:\n$$\n\\frac{\\partial \\Phi}{\\partial p} = -\\frac{RT}{p}\n$$\nNow, we can combine these equations. We take the vertical derivative of the geostrophic wind equation with respect to pressure $p$:\n$$\nf \\frac{\\partial u}{\\partial p} = -\\frac{\\partial}{\\partial p} \\left( \\frac{\\partial \\Phi}{\\partial y} \\right)_p\n$$\nAssuming the geopotential field is sufficiently smooth, we can swap the order of the partial derivatives (Clairaut's theorem):\n$$\nf \\frac{\\partial u}{\\partial p} = -\\left( \\frac{\\partial}{\\partial y} \\left( \\frac{\\partial \\Phi}{\\partial p} \\right) \\right)_p\n$$\nSubstituting our expression for $\\frac{\\partial \\Phi}{\\partial p}$:\n$$\nf \\frac{\\partial u}{\\partial p} = -\\left( \\frac{\\partial}{\\partial y} \\left( -\\frac{RT}{p} \\right) \\right)_p = \\frac{R}{p} \\left( \\frac{\\partial T}{\\partial y} \\right)_p\n$$\nThe problem provides the wind shear with respect to the natural logarithm of pressure, $\\ln p$. We can relate the derivatives using the chain rule: $\\frac{\\partial}{\\partial \\ln p} = p \\frac{\\partial}{\\partial p}$, so $\\frac{\\partial u}{\\partial p} = \\frac{1}{p} \\frac{\\partial u}{\\partial \\ln p}$. Substituting this into our equation gives:\n$$\nf \\frac{1}{p} \\frac{\\partial u}{\\partial \\ln p} = \\frac{R}{p} \\left( \\frac{\\partial T}{\\partial y} \\right)_p\n$$\nThe factor of $1/p$ cancels, leaving the thermal wind equation relating wind shear to the meridional temperature gradient:\n$$\nf \\frac{\\partial u}{\\partial \\ln p} = R \\left( \\frac{\\partial T}{\\partial y} \\right)_p\n$$\nThe problem uses spherical coordinates, where the meridional distance element $dy$ is related to the change in latitude $d\\varphi$ by $dy = a \\, d\\varphi$, with $a$ being the planetary radius. Thus, the meridional derivative can be written as $\\frac{\\partial}{\\partial y} = \\frac{1}{a} \\frac{\\partial}{\\partial \\varphi}$. Rearranging the equation to solve for the meridional temperature gradient gives:\n$$\n\\left( \\frac{\\partial T}{\\partial \\varphi} \\right)_p = \\frac{a f}{R} \\frac{\\partial u}{\\partial \\ln p} = \\frac{2\\Omega a \\sin\\varphi}{R} \\frac{\\partial u}{\\partial \\ln p}\n$$\nThis is the final differential equation we need to solve. It provides the meridional gradient of temperature at each point $(\\lambda, \\varphi, p)$ based on the known planetary parameters and the observed wind shear field.\n\nTo find the temperature field $T(\\lambda, \\varphi, p)$ itself, we must integrate this gradient with respect to latitude $\\varphi$. The integration must be performed for each longitude $\\lambda$ and pressure level $p$. The integration introduces a constant of integration, which must be determined by a boundary condition. The problem provides this condition in the form of a reference temperature profile $T_{\\mathrm{ref}}(p)$ at a specified reference latitude $\\varphi_{\\mathrm{ref}}$. This implies that $T(\\lambda, \\varphi_{\\mathrm{ref}}, p) = T_{\\mathrm{ref}}(p)$ for all $\\lambda$.\n\nThe temperature at any latitude $\\varphi$ can be found by integrating from the reference latitude:\n$$\nT(\\lambda, \\varphi, p) = T(\\lambda, \\varphi_{\\mathrm{ref}}, p) + \\int_{\\varphi_{\\mathrm{ref}}}^{\\varphi} \\left( \\frac{\\partial T}{\\partial \\varphi'} \\right)_p (\\lambda, \\varphi', p) \\, d\\varphi'\n$$\nWe will perform this inversion on a discrete grid. Let the grid points be indexed by $(i, j, k)$ for longitude $\\lambda_i$, latitude $\\varphi_j$, and pressure $p_k$. Let $j_{\\mathrm{ref}}$ be the index of the reference latitude. The temperature gradient field, which we denote as $G_{ijk}$, is calculated at each grid point:\n$$\nG_{ijk} = \\left(\\frac{\\partial T}{\\partial \\varphi}\\right)_{ijk} = \\frac{2\\Omega a \\sin(\\varphi_j)}{R} \\left(\\frac{\\partial u}{\\partial \\ln p}\\right)_{ijk}\n$$\nWe use the trapezoidal rule for numerical integration, as it provides second-order accuracy. For a step from latitude $\\varphi_{j-1}$ to $\\varphi_j$, the temperature update is:\n$$\nT_{i,j,k} = T_{i,j-1,k} + \\frac{1}{2} \\left( G_{i,j-1,k} + G_{i,j,k} \\right) (\\varphi_j - \\varphi_{j-1})\n$$\nThe full temperature field $T_{ijk}$ is initialized with the known values at the reference latitude, $T_{i, j_{\\mathrm{ref}}, k} = T_{\\mathrm{ref}}(p_k)$. Then, we perform the integration in two parts:\n$1$. For latitudes north of the reference ($j > j_{\\mathrm{ref}}$), we integrate poleward, applying the trapezoidal rule iteratively from $j = j_{\\mathrm{ref}} + 1$ to the northernmost grid point.\n$2$. For latitudes south of the reference ($j  j_{\\mathrm{ref}}$), we integrate equatorward (or toward the other pole), applying a rearranged form of the rule: $T_{i,j-1,k} = T_{i,j,k} - \\frac{1}{2} \\left( G_{i,j-1,k} + G_{i,j,k} \\right) (\\varphi_j - \\varphi_{j-1})$. This is applied iteratively from $j = j_{\\mathrm{ref}}$ down to the southernmost grid point.\n\nAfter populating the entire $3$D temperature field $T_{ijk}$ for a given test case, the final step is to calculate the zonal-mean temperature at the northernmost latitude and deepest pressure level. The northernmost latitude is the one with the maximum $\\varphi$ value, and the deepest pressure is the one with the maximum $p$ value. We find their respective grid indices, $j_{\\mathrm{north}}$ and $k_{\\mathrm{deep}}$. The zonal mean is the average over all longitudes, calculated as $\\frac{1}{N_\\lambda} \\sum_{i=0}^{N_\\lambda-1} T_{i, j_{\\mathrm{north}}, k_{\\mathrm{deep}}}$. This procedure is repeated for each of the three test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the three specified test cases.\n    It orchestrates the calculation for each case and prints the final results.\n    \"\"\"\n\n    # Case A: General midlatitude case\n    case_a = {\n        'a': 9.4e6,  # Planetary radius in meters\n        'P_days': 0.7,  # Rotation period in days\n        'R': 3700.0,  # Specific gas constant in J/(kg K)\n        'lons': np.array([0, np.pi/2, np.pi]),  # Longitudes in radians\n        'lats': np.array([-np.pi/6, 0, np.pi/6]),  # Latitudes in radians\n        'pressures': np.array([1.0e5, 5.0e4]),  # Pressures in Pascals\n        'shear_func': lambda lam, phi, p: 20.0 * np.cos(phi) * np.sin(lam) * (1 - 0.3 * (p / 1.0e5 - 1)),\n        'ref_lat_idx': 1,\n        'ref_temps': np.array([1400.0, 1400.0])  # K\n    }\n\n    # Case B: Equatorial-edge case\n    case_b = {\n        'a': 6.0e6,\n        'P_days': 3.0,\n        'R': 3700.0,\n        'lons': np.array([0.0]),\n        'lats': np.array([-5 * np.pi / 180, 0, 5 * np.pi / 180]),\n        'pressures': np.array([1.0e5, 8.0e4, 5.0e4]),\n        'shear_func': lambda lam, phi, p: 12.0 * np.cos(phi) * (p / 1.0e5),\n        'ref_lat_idx': 1,\n        'ref_temps': np.array([1200.0, 1180.0, 1150.0])\n    }\n\n    # Case C: Zero-shear boundary case\n    case_c = {\n        'a': 7.0e6,\n        'P_days': 1.0,\n        'R': 3700.0,\n        'lons': np.array([0, np.pi/3, 2*np.pi/3]),\n        'lats': np.array([-np.pi/6, 0, np.pi/6]),\n        'pressures': np.array([1.2e5, 8.0e4]),\n        'shear_func': lambda lam, phi, p: 0.0,\n        'ref_lat_idx': 1,\n        'ref_temps': np.array([1000.0, 1000.0])\n    }\n\n    test_cases = [case_a, case_b, case_c]\n    results = []\n\n    for case in test_cases:\n        # Perform the inversion and calculate the required zonal-mean temperature\n        result = compute_zonal_mean_temp(case)\n        results.append(result)\n\n    # Format and print the final output as a single line\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\n\ndef compute_zonal_mean_temp(case):\n    \"\"\"\n    Computes the 3D temperature field and returns the zonal-mean temperature\n    at the northernmost latitude and deepest pressure level for a single case.\n    \"\"\"\n    # Unpack case parameters\n    a = case['a']\n    P_days = case['P_days']\n    R = case['R']\n    lons = case['lons']\n    lats = case['lats']\n    pressures = case['pressures']\n    shear_func = case['shear_func']\n    ref_lat_idx = case['ref_lat_idx']\n    ref_temps = case['ref_temps']\n\n    # Physical constants and derived parameters\n    P_sec = P_days * 24.0 * 3600.0\n    omega = 2.0 * np.pi / P_sec\n\n    # Grid dimensions\n    n_lon, n_lat, n_p = len(lons), len(lats), len(pressures)\n\n    # Create 3D grid for calculations. 'ij' indexing gives (lon, lat, p) shape.\n    lon_grid, lat_grid, p_grid = np.meshgrid(lons, lats, pressures, indexing='ij')\n\n    # 1. Calculate the observed wind shear field on the grid\n    shear_field = shear_func(lon_grid, lat_grid, p_grid)\n    \n    # 2. Calculate the meridional temperature gradient field G(lambda, phi, p)\n    # G = (2 * omega * a * sin(phi) / R) * (du/dlnp)\n    term_prefactor = (2.0 * omega * a / R)\n    temp_gradient_field = term_prefactor * np.sin(lat_grid) * shear_field\n\n    # 3. Initialize the 3D temperature field\n    temp_field = np.full((n_lon, n_lat, n_p), np.nan)\n\n    # 4. Set the boundary condition: temperature at the reference latitude\n    # The reference temperature profile is independent of longitude\n    temp_field[:, ref_lat_idx, :] = ref_temps\n\n    # 5. Integrate meridionally from the reference latitude using the trapezoidal rule\n    \n    # Integrate poleward (j  ref_lat_idx)\n    for j in range(ref_lat_idx + 1, n_lat):\n        delta_lat = lats[j] - lats[j - 1]\n        # T_j = T_{j-1} + 0.5 * (G_{j-1} + G_j) * dlat\n        temp_field[:, j, :] = temp_field[:, j - 1, :] + 0.5 * (\n            temp_gradient_field[:, j - 1, :] + temp_gradient_field[:, j, :]\n        ) * delta_lat\n\n    # Integrate toward the other pole (j  ref_lat_idx)\n    for j in range(ref_lat_idx - 1, -1, -1):\n        delta_lat = lats[j + 1] - lats[j]\n        # T_j = T_{j+1} - 0.5 * (G_j + G_{j+1}) * dlat\n        temp_field[:, j, :] = temp_field[:, j + 1, :] - 0.5 * (\n            temp_gradient_field[:, j, :] + temp_gradient_field[:, j + 1, :]\n        ) * delta_lat\n\n    # 6. Calculate the final required value\n    # Find index of northernmost latitude and deepest pressure\n    idx_north = np.argmax(lats)\n    idx_deep = np.argmax(pressures)\n\n    # Extract temperatures at the specific location (all longitudes)\n    temps_at_loc = temp_field[:, idx_north, idx_deep]\n    \n    # Compute the zonal mean\n    zonal_mean = np.mean(temps_at_loc)\n    \n    return zonal_mean\n\n# Execute the main function\nsolve()\n```"
        }
    ]
}