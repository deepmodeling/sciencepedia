{"hands_on_practices": [{"introduction": "A powerful technique in the study of diffusion processes is to translate questions about expected values into boundary value problems. This exercise demonstrates this principle by tasking you with deriving the Laplace transform of the first hitting time for a Brownian motion with drift. By applying the infinitesimal generator and Dynkin's formula, you will construct and solve a second-order ordinary differential equation, gaining hands-on practice with one of the most fundamental tools in the SDE toolkit [@problem_id:2970748].", "problem": "Consider a one-dimensional diffusion defined by the Stochastic Differential Equation (SDE) $$\\mathrm{d}X_{t}=\\mu\\,\\mathrm{d}t+\\sigma\\,\\mathrm{d}W_{t},$$ where $W_{t}$ is a standard Brownian motion, $\\mu\\in\\mathbb{R}$ is a constant drift, $\\sigma0$ is a constant volatility, and $X_{0}=0$. For a fixed $a0$, define the first hitting time $$\\tau_{a}=\\inf\\{t\\geq 0:X_{t}=a\\}.$$ For a parameter $\\lambda0$, the Laplace transform of the hitting time is $$\\mathbb{E}\\big[\\exp(-\\lambda\\,\\tau_{a})\\big].$$\n\nStarting from first principles appropriate to time-homogeneous diffusions, including Itô's formula, the strong Markov property, the infinitesimal generator, and the Dynkin formula, derive the boundary value problem satisfied by the function $$u(x)=\\mathbb{E}_{x}\\big[\\exp(-\\lambda\\,\\tau_{a})\\big],$$ where $\\mathbb{E}_{x}$ denotes expectation given $X_{0}=x$, and then solve this boundary value problem to obtain a closed-form expression for $$u(0)=\\mathbb{E}\\big[\\exp(-\\lambda\\,\\tau_{a})\\big].$$\n\nYour final answer must be a single closed-form analytic expression in terms of $a$, $\\mu$, $\\sigma$, and $\\lambda$. No rounding is required, and no physical units are involved. Express the answer in exact form.", "solution": "We begin by recalling foundational tools for time-homogeneous diffusions. For a sufficiently smooth function $f$, Itô's formula for the process $X_{t}$ defined by $$\\mathrm{d}X_{t}=\\mu\\,\\mathrm{d}t+\\sigma\\,\\mathrm{d}W_{t}$$ yields\n$$\n\\mathrm{d}f(X_{t})=f'(X_{t})\\,\\mathrm{d}X_{t}+\\frac{1}{2}f''(X_{t})\\,\\mathrm{d}\\langle X\\rangle_{t}\n=f'(X_{t})\\mu\\,\\mathrm{d}t+f'(X_{t})\\sigma\\,\\mathrm{d}W_{t}+\\frac{1}{2}\\sigma^{2}f''(X_{t})\\,\\mathrm{d}t.\n$$\nThus the infinitesimal generator $\\mathcal{L}$ of $X_{t}$ acts on $f$ as\n$$\n\\mathcal{L}f(x)=\\mu f'(x)+\\frac{\\sigma^{2}}{2}f''(x).\n$$\n\nDefine for a fixed $\\lambda0$ the function\n$$\nu(x)=\\mathbb{E}_{x}\\big[\\exp(-\\lambda\\tau_{a})\\big],\\quad xa.\n$$\nWe aim to derive the boundary value problem for $u$. Consider the process\n$$\nM_{t}=\\exp(-\\lambda t)\\,u(X_{t}),\n$$\nand apply Itô's formula to $M_{t}$ up to the stopping time $\\tau_{a}$. To make this precise, take the localized stopping times $\\tau_{a}\\wedge t$ with $t0$ and compute\n$$\n\\mathrm{d}\\big(\\exp(-\\lambda t)u(X_{t})\\big)=\\exp(-\\lambda t)\\left[-\\lambda u(X_{t})\\,\\mathrm{d}t+\\mathrm{d}u(X_{t})\\right].\n$$\nUsing the generator expression for $\\mathrm{d}u(X_{t})$,\n$$\n\\mathrm{d}u(X_{t})=\\left(\\mu u'(X_{t})+\\frac{\\sigma^{2}}{2}u''(X_{t})\\right)\\mathrm{d}t+\\sigma u'(X_{t})\\,\\mathrm{d}W_{t},\n$$\nwe find\n$$\n\\mathrm{d}\\big(\\exp(-\\lambda t)u(X_{t})\\big)\n=\\exp(-\\lambda t)\\left[\\left(\\mu u'(X_{t})+\\frac{\\sigma^{2}}{2}u''(X_{t})-\\lambda u(X_{t})\\right)\\mathrm{d}t+\\sigma u'(X_{t})\\,\\mathrm{d}W_{t}\\right].\n$$\nIf $u$ satisfies the differential equation\n$$\n\\mu u'(x)+\\frac{\\sigma^{2}}{2}u''(x)=\\lambda u(x)\\quad\\text{for }xa,\n$$\nthen the drift part vanishes and $\\exp(-\\lambda t)u(X_{t})$ is a local martingale. By localization at $\\tau_{a}$ and boundedness considerations described below, we obtain a true martingale\n$$\n\\exp\\big(-\\lambda(t\\wedge\\tau_{a})\\big)u\\big(X_{t\\wedge\\tau_{a}}\\big).\n$$\nBy the optional stopping theorem and the strong Markov property, taking expectations yields\n$$\nu(x)=\\mathbb{E}_{x}\\left[\\exp\\big(-\\lambda(t\\wedge\\tau_{a})\\big)u\\big(X_{t\\wedge\\tau_{a}}\\big)\\right].\n$$\nLetting $t\\to\\infty$, monotone convergence and dominated convergence imply\n$$\nu(x)=\\mathbb{E}_{x}\\left[\\exp(-\\lambda\\tau_{a})u(X_{\\tau_{a}})\\mathbf{1}_{\\{\\tau_{a}\\infty\\}}\\right]\n=\\mathbb{E}_{x}\\left[\\exp(-\\lambda\\tau_{a})\\right]u(a),\n$$\nwhere we used $X_{\\tau_{a}}=a$ on $\\{\\tau_{a}\\infty\\}$. By definition, $u(x)=\\mathbb{E}_{x}\\left[\\exp(-\\lambda\\tau_{a})\\right]$, hence we must have the boundary condition\n$$\nu(a)=1.\n$$\n\nTo complete the boundary value problem, we specify the behavior as $x\\to -\\infty$. Intuitively, starting far to the left makes the hitting time $\\tau_{a}$ very large, and the exponential $\\exp(-\\lambda\\tau_{a})$ tends to $0$, so it is natural to impose\n$$\n\\lim_{x\\to -\\infty}u(x)=0.\n$$\nThis condition also ensures boundedness on $(-\\infty,a)$ and uniqueness among solutions of the second-order linear ordinary differential equation. Thus, the boundary value problem is\n$$\n\\frac{\\sigma^{2}}{2}u''(x)+\\mu u'(x)=\\lambda u(x)\\quad\\text{for }xa,\\qquad u(a)=1,\\qquad \\lim_{x\\to -\\infty}u(x)=0.\n$$\n\nWe now solve this linear ordinary differential equation with constant coefficients. Seek solutions of the form $u(x)=\\exp(r x)$, which leads to the characteristic equation\n$$\n\\frac{\\sigma^{2}}{2}r^{2}+\\mu r-\\lambda=0.\n$$\nThe roots are\n$$\nr_{\\pm}=\\frac{-\\mu\\pm\\sqrt{\\mu^{2}+2\\lambda\\sigma^{2}}}{\\sigma^{2}}.\n$$\nTherefore, the general solution on $(-\\infty,a)$ is\n$$\nu(x)=C_{1}\\exp(r_{+}x)+C_{2}\\exp(r_{-}x).\n$$\nWe analyze the signs of $r_{\\pm}$. Since $\\sqrt{\\mu^{2}+2\\lambda\\sigma^{2}}\\geq|\\mu|$, we have\n$$\nr_{+}=\\frac{-\\mu+\\sqrt{\\mu^{2}+2\\lambda\\sigma^{2}}}{\\sigma^{2}}\\geq 0,\\qquad\nr_{-}=\\frac{-\\mu-\\sqrt{\\mu^{2}+2\\lambda\\sigma^{2}}}{\\sigma^{2}}\\leq 0.\n$$\nImposing $\\lim_{x\\to -\\infty}u(x)=0$ eliminates the term that explodes as $x\\to -\\infty$. Since $r_{-}0$, $\\exp(r_{-}x)\\to\\infty$ as $x\\to -\\infty$, while $\\exp(r_{+}x)\\to 0$. Hence we must set $C_{2}=0$, and the solution reduces to\n$$\nu(x)=C_{1}\\exp(r_{+}x).\n$$\nThe boundary condition $u(a)=1$ gives $C_{1}=\\exp(-r_{+}a)$, so\n$$\nu(x)=\\exp\\big(r_{+}(x-a)\\big).\n$$\nEvaluating at $x=0$ yields the desired Laplace transform:\n$$\nu(0)=\\exp\\big(-r_{+}a\\big)=\\exp\\left(\\frac{\\mu-\\sqrt{\\mu^{2}+2\\lambda\\sigma^{2}}}{\\sigma^{2}}\\,a\\right).\n$$\n\nThis completes the derivation from the generator-based boundary value problem and the solution by elementary ordinary differential equation methods. As a consistency check, for $\\lambda=0$ we obtain\n$$\nu(0)=\\exp\\left(\\frac{\\mu-|\\mu|}{\\sigma^{2}}\\,a\\right),\n$$\nwhich equals $1$ when $\\mu\\geq 0$ (almost sure hitting to the right with nonnegative drift) and equals $\\exp\\left(\\frac{2\\mu a}{\\sigma^{2}}\\right)$ when $\\mu0$, the classical rightward hitting probability for a drifted Brownian motion, confirming the correctness of the expression.", "answer": "$$\\boxed{\\exp\\!\\left(\\frac{\\mu-\\sqrt{\\mu^{2}+2\\lambda\\sigma^{2}}}{\\sigma^{2}}\\,a\\right)}$$", "id": "2970748"}, {"introduction": "Characteristic functions are not just static descriptors; they behave predictably under important transformations, such as a change of probability measure. This practice explores the Esscher transform, a crucial technique for risk-neutral pricing in finance, by asking you to derive how the characteristic exponent and Lévy triplet of a process change under this \"exponential tilting\" [@problem_id:2970754]. Completing this exercise will deepen your understanding of how measure changes are operationalized and how they affect the fundamental structure of a Lévy process.", "problem": "Consider a real-valued Lévy process $X = (X_{t})_{t \\ge 0}$ on a filtered probability space, with characteristic function $\\mathbb{E}[\\exp(i u X_{t})] = \\exp(t \\psi(u))$ and characteristic exponent $\\psi(u)$ given by the Lévy–Khintchine formula\n$$\n\\psi(u) = i b u - \\frac{1}{2} \\sigma^{2} u^{2} + \\int_{\\mathbb{R}} \\left( \\exp(i u x) - 1 - i u x \\mathbf{1}_{\\{|x| \\le 1\\}} \\right) \\nu(dx),\n$$\nwhere $(b, \\sigma^{2}, \\nu)$ is the Lévy triplet with truncation function $x \\mathbf{1}_{\\{|x| \\le 1\\}}$ held fixed. Assume there exists a nonempty interval of real parameters around $0$ such that the moment-generating function is finite, i.e., for each $\\theta$ in this interval,\n$$\n\\mathbb{E}[\\exp(\\theta X_{t})]  \\infty \\quad \\text{for all } t \\ge 0,\n$$\nequivalently $\\int_{|x|1} \\exp(\\theta x) \\nu(dx)  \\infty$. For a fixed $\\theta$ in this effective domain, define the Esscher transform (also known as the exponential tilting) of $X$ via the Radon–Nikodym (RN) derivative\n$$\n\\left. \\frac{d \\mathbb{Q}^{(\\theta)}}{d \\mathbb{P}} \\right|_{\\mathcal{F}_{t}} \\;=\\; \\exp\\!\\big( \\theta X_{t} - t \\kappa(\\theta) \\big),\n$$\nwhere $\\kappa(\\theta)$ is the cumulant generating function satisfying $\\mathbb{E}[\\exp(\\theta X_{t})] = \\exp(t \\kappa(\\theta))$.\n\nStarting from the Lévy–Khintchine representation and the Esscher transform definition above, derive the characteristic exponent $\\psi_{\\theta}(u)$ of $X$ under the tilted measure $\\mathbb{Q}^{(\\theta)}$, writing it explicitly in Lévy–Khintchine form with the same truncation function, and explain how the Lévy triplet changes under the tilt. Your derivation should rely only on these fundamental definitions and standard measure-change calculus, and must be valid for all real $u$ for which the characteristic function is defined. Provide your final answer as a single closed-form analytic expression for $\\psi_{\\theta}(u)$ in terms of $(b, \\sigma^{2}, \\nu)$ and $\\theta$.", "solution": "We want to find the characteristic exponent $\\psi_{\\theta}(u)$ of the process $X_t$ under the tilted measure $\\mathbb{Q}^{(\\theta)}$. By definition, this exponent satisfies the relation $\\mathbb{E}_{\\mathbb{Q}^{(\\theta)}}[\\exp(i u X_t)] = \\exp(t \\psi_{\\theta}(u))$.\n\nWe start by computing the expectation on the left-hand side using the change of measure formula. The Radon-Nikodym derivative is given as $L_t = \\frac{d \\mathbb{Q}^{(\\theta)}}{d \\mathbb{P}} |_{\\mathcal{F}_t} = \\exp(\\theta X_t - t \\kappa(\\theta))$. For any $\\mathcal{F}_t$-measurable random variable $Y$, we have $\\mathbb{E}_{\\mathbb{Q}^{(\\theta)}}[Y] = \\mathbb{E}_{\\mathbb{P}}[Y L_t]$. Let $Y = \\exp(i u X_t)$.\n$$\n\\mathbb{E}_{\\mathbb{Q}^{(\\theta)}}[\\exp(i u X_t)] = \\mathbb{E}_{\\mathbb{P}}\\left[\\exp(i u X_t) \\cdot \\exp(\\theta X_t - t \\kappa(\\theta))\\right]\n$$\n$$\n= \\mathbb{E}_{\\mathbb{P}}\\left[\\exp((\\theta + i u) X_t - t \\kappa(\\theta))\\right]\n$$\nWe can factor out the non-random term from the expectation:\n$$\n= \\exp(-t \\kappa(\\theta)) \\mathbb{E}_{\\mathbb{P}}\\left[\\exp((\\theta + i u) X_t)\\right]\n$$\nThe expectation term $\\mathbb{E}_{\\mathbb{P}}\\left[\\exp((\\theta + i u) X_t)\\right]$ is the moment-generating function of $X_t$ under $\\mathbb{P}$, evaluated at the complex argument $z = \\theta + i u$. By definition, this is $\\exp(t \\kappa(\\theta + i u))$. Substituting this back into our expression, we get:\n$$\n\\mathbb{E}_{\\mathbb{Q}^{(\\theta)}}[\\exp(i u X_t)] = \\exp(-t \\kappa(\\theta)) \\exp(t \\kappa(\\theta + i u)) = \\exp(t[\\kappa(\\theta + i u) - \\kappa(\\theta)])\n$$\nBy comparing this result with the definition $\\mathbb{E}_{\\mathbb{Q}^{(\\theta)}}[\\exp(i u X_t)] = \\exp(t \\psi_{\\theta}(u))$, we identify the new characteristic exponent:\n$$\n\\psi_{\\theta}(u) = \\kappa(\\theta + i u) - \\kappa(\\theta)\n$$\nThe cumulant generating function $\\kappa(z)$ is the analytic continuation of the characteristic exponent, obtained by replacing $iu$ with $z$ in the Lévy–Khintchine formula:\n$$\n\\kappa(z) = b z + \\frac{1}{2} \\sigma^{2} z^{2} + \\int_{\\mathbb{R}} \\left( \\exp(z x) - 1 - z x \\mathbf{1}_{\\{|x| \\le 1\\}} \\right) \\nu(dx)\n$$\nWe now compute the difference $\\kappa(\\theta + i u) - \\kappa(\\theta)$ term by term. The drift and diffusion part becomes:\n$$\n\\left( b(\\theta+iu) + \\frac{1}{2}\\sigma^2(\\theta+iu)^2 \\right) - \\left( b\\theta + \\frac{1}{2}\\sigma^2\\theta^2 \\right) = i(b + \\sigma^2 \\theta)u - \\frac{1}{2}\\sigma^2 u^2\n$$\nThe jump part becomes:\n$$\n\\int_{\\mathbb{R}} \\left[ \\left( \\exp((\\theta+iu)x) - 1 - (\\theta+iu)x\\mathbf{1}_{\\{|x|\\le 1\\}} \\right) - \\left( \\exp(\\theta x) - 1 - \\theta x\\mathbf{1}_{\\{|x|\\le 1\\}} \\right) \\right] \\nu(dx)\n$$\n$$\n= \\int_{\\mathbb{R}} \\left( \\exp(\\theta x)\\exp(i u x) - \\exp(\\theta x) - i u x \\mathbf{1}_{\\{|x| \\le 1\\}} \\right) \\nu(dx)\n$$\nTo write this in the canonical Lévy–Khintchine form, we add and subtract the term $i u x \\mathbf{1}_{\\{|x| \\le 1\\}} \\exp(\\theta x)$ inside the integral, which gives:\n$$\n\\int_{\\mathbb{R}} \\exp(\\theta x) \\left( \\exp(i u x) - 1 - i u x \\mathbf{1}_{\\{|x| \\le 1\\}} \\right) \\nu(dx) + \\int_{\\mathbb{R}} i u x \\mathbf{1}_{\\{|x| \\le 1\\}} (\\exp(\\theta x) - 1) \\nu(dx)\n$$\nThe second integral is a linear term in $iu$ and contributes a drift correction of $iu \\int_{|x| \\le 1} x(\\exp(\\theta x) - 1)\\nu(dx)$. Assembling the full expression for $\\psi_{\\theta}(u)$ and grouping terms:\n$$\n\\psi_{\\theta}(u) = i\\left(b + \\sigma^2 \\theta + \\int_{|x| \\le 1} x(\\exp(\\theta x) - 1)\\nu(dx)\\right)u - \\frac{1}{2}\\sigma^2 u^2 + \\int_{\\mathbb{R}} \\left( \\exp(i u x) - 1 - i u x \\mathbf{1}_{\\{|x| \\le 1\\}} \\right) \\exp(\\theta x) \\nu(dx)\n$$\nThis expression is in the canonical Lévy–Khintchine form, from which we can identify the transformed Lévy triplet $(b_{\\theta}, \\sigma_{\\theta}^2, \\nu_{\\theta})$:\n- **Transformed Drift, $b_{\\theta}$:** $b_{\\theta} = b + \\sigma^2 \\theta + \\int_{|x| \\le 1} x(\\exp(\\theta x) - 1) \\nu(dx)$\n- **Transformed Brownian Volatility, $\\sigma_{\\theta}^2$:** $\\sigma_{\\theta}^2 = \\sigma^2$ (unchanged)\n- **Transformed Lévy Measure, $\\nu_{\\theta}$:** $\\nu_{\\theta}(dx) = \\exp(\\theta x) \\nu(dx)$\n\nThe process $X_t$ under the measure $\\mathbb{Q}^{(\\theta)}$ is therefore a new Lévy process with this transformed triplet.", "answer": "$$\n\\boxed{i \\left( b + \\sigma^2 \\theta + \\int_{|x| \\le 1} x(\\exp(\\theta x) - 1) \\nu(dx) \\right) u - \\frac{1}{2} \\sigma^2 u^2 + \\int_{\\mathbb{R}} \\left( \\exp(i u x) - 1 - i u x \\mathbf{1}_{\\{|x| \\le 1\\}} \\right) \\exp(\\theta x) \\nu(dx)}\n$$", "id": "2970754"}, {"introduction": "We often have access to a closed-form expression for a process's characteristic function when its probability density function (PDF) is unknown or intractable. This final practice bridges the gap between analytical theory and practical application by tasking you with recovering the PDF of an Ornstein-Uhlenbeck process via numerical Fourier inversion [@problem_id:2970777]. This exercise highlights the immense practical utility of characteristic functions and provides hands-on experience with the numerical challenges, such as truncation and discretization errors, that arise in computational finance and physics.", "problem": "You are given the task of recovering the probability density function of a one-dimensional Itô process at a fixed time from its characteristic function and analyzing the numerical errors inherent in the inversion. Consider the Ornstein–Uhlenbeck stochastic differential equation (SDE)\n$$\ndX_t = \\kappa \\left(\\theta - X_t\\right)\\,dt + \\sigma\\, dW_t,\\quad X_0 = x_0,\n$$\nwhere $W_t$ is a standard Brownian motion, and $\\kappa$, $\\theta$, $\\sigma$, $x_0$, and $t$ are real parameters with $\\kappa \\gt 0$, $\\sigma \\gt 0$, and $t \\gt 0$.\n\nThe characteristic function of $X_t$ is defined by\n$$\n\\phi_{X_t}(u) = \\mathbb{E}\\left[e^{i u X_t}\\right],\n$$\nand the density $p_{X_t}(x)$, when it exists, can be recovered from $\\phi_{X_t}(u)$ via the Fourier inversion formula\n$$\np_{X_t}(x) = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} e^{-i u x}\\,\\phi_{X_t}(u)\\,du.\n$$\n\nStarting from fundamental properties of linear SDEs, Itô calculus, and the definition of the characteristic function, you must:\n1. Derive the distribution of $X_t$ and $\\phi_{X_t}(u)$ for the Ornstein–Uhlenbeck process defined above, strictly from first principles (no shortcut formulas).\n2. Design a numerical Fourier inversion scheme to approximate $p_{X_t}(x)$ using a symmetric truncation of the integral at $\\pm U$ and a composite trapezoidal rule with uniform step size $\\Delta u$:\n$$\n\\widehat{p}_{X_t}(x;U,\\Delta u) = \\frac{1}{2\\pi}\\sum_{k=-K}^{K} w_k\\, \\phi_{X_t}(u_k)\\, e^{-i u_k x}\\,\\Delta u,\n$$\nwhere $u_k = k\\,\\Delta u$, $K = \\lfloor U/\\Delta u\\rfloor$, and $w_k$ are trapezoidal weights with endpoints weighted by $1/2$ and interior points by $1$.\n3. Analyze and quantify the approximation error $\\left|p_{X_t}(x) - \\widehat{p}_{X_t}(x;U,\\Delta u)\\right|$ by separating the sources of error:\n   - Truncation error due to finite $U$, using a bound derived from the decay of $\\left|\\phi_{X_t}(u)\\right|$.\n   - Discretization error due to finite $\\Delta u$, using a bound from the composite trapezoidal rule in terms of the supremum of the second derivative of the integrand on $\\left[-U,U\\right]$.\n\nYour algorithm must:\n- Implement the numerical inversion scheme described above.\n- Use the analytically derived $p_{X_t}(x)$ for the Ornstein–Uhlenbeck process (obtained from part 1) as the reference to compute the pointwise absolute error.\n- For each test case below, compute the maximum absolute error over a grid of $x$ values that spans the main mass of the distribution. Use a grid\n$$\nx_j = m - 4\\sqrt{v} + j\\cdot \\delta_x,\\quad j=0,1,\\ldots,J,\n$$\nwhere $m$ and $v$ are the mean and variance of $X_t$ determined from part 1, $J=200$, and $\\delta_x = \\frac{8\\sqrt{v}}{J}$.\n\nTest Suite:\n- Case 1 (general happy path): $\\kappa=1.0$, $\\theta=0.0$, $x_0=1.0$, $\\sigma=1.0$, $t=1.0$, $U=30.0$, $\\Delta u=0.01$.\n- Case 2 (truncation-limited): $\\kappa=1.0$, $\\theta=0.0$, $x_0=1.0$, $\\sigma=1.0$, $t=1.0$, $U=5.0$, $\\Delta u=0.01$.\n- Case 3 (discretization-limited): $\\kappa=1.0$, $\\theta=0.0$, $x_0=1.0$, $\\sigma=1.0$, $t=1.0$, $U=30.0$, $\\Delta u=0.5$.\n- Case 4 (slow decay edge case): $\\kappa=1.5$, $\\theta=-0.5$, $x_0=2.0$, $\\sigma=0.5$, $t=0.1$, $U=30.0$, $\\Delta u=0.05$.\n\nOutput Specification:\n- For each case, compute the maximum absolute error over the specified $x$ grid.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\").\n- Each result must be a floating-point number representing the maximum absolute error for the corresponding test case.\n\nNo physical units apply to this problem. Angles, where they appear implicitly through complex exponentials, are handled in radians by the standard mathematical definitions used.", "solution": "The problem is addressed in two parts: first, a theoretical derivation of the required analytical expressions, and second, a description of the numerical algorithm and its implementation based on these expressions.\n\n### Part 1: Analytical Solution of the Ornstein-Uhlenbeck Process\n\nThe Ornstein-Uhlenbeck process is described by the linear stochastic differential equation (SDE):\n$$\ndX_t = \\kappa \\left(\\theta - X_t\\right)\\,dt + \\sigma\\, dW_t, \\quad X_0 = x_0\n$$\nTo solve this, we use an integrating factor $e^{\\kappa t}$. Let $Y_t = e^{\\kappa t} X_t$. Applying Itô's product rule gives:\n$$\ndY_t = \\kappa e^{\\kappa t} X_t\\,dt + e^{\\kappa t}\\,dX_t = \\kappa e^{\\kappa t} X_t\\,dt + e^{\\kappa t} \\left( \\kappa(\\theta - X_t)\\,dt + \\sigma\\,dW_t \\right)\n$$\nThe terms involving $X_t$ cancel out, simplifying the expression to:\n$$\ndY_t = \\kappa \\theta e^{\\kappa t}\\,dt + \\sigma e^{\\kappa t}\\,dW_t\n$$\nIntegrating from $s=0$ to $s=t$ and solving for $X_t$ yields:\n$$\nX_t = x_0 e^{-\\kappa t} + \\theta (1 - e^{-\\kappa t}) + \\sigma \\int_0^t e^{-\\kappa(t-s)}\\,dW_s\n$$\nSince $X_t$ is a sum of a deterministic term and an Itô integral with a deterministic integrand, it follows a normal distribution, $X_t \\sim \\mathcal{N}(m_t, v_t)$. The mean $m_t$ is the deterministic part, as the expectation of the Itô integral is zero:\n$$\nm_t = \\mathbb{E}[X_t] = x_0 e^{-\\kappa t} + \\theta (1 - e^{-\\kappa t})\n$$\nThe variance $v_t$ is found using Itô isometry on the stochastic integral term:\n$$\nv_t = \\text{Var}[X_t] = \\sigma^2 \\int_0^t \\left(e^{-\\kappa(t-s)}\\right)^2\\,ds = \\frac{\\sigma^2}{2\\kappa} (1 - e^{-2\\kappa t})\n$$\nThe probability density function (PDF) $p_{X_t}(x)$ is that of a Gaussian:\n$$\np_{X_t}(x) = \\frac{1}{\\sqrt{2\\pi v_t}} \\exp\\left(-\\frac{(x - m_t)^2}{2v_t}\\right)\n$$\nThe characteristic function $\\phi_{X_t}(u) = \\mathbb{E}[e^{i u X_t}]$ of this Gaussian distribution is:\n$$\n\\phi_{X_t}(u) = \\exp\\left(i u m_t - \\frac{1}{2} u^2 v_t\\right)\n$$\nThese analytical formulas provide the basis for the numerical implementation and error calculation.\n\n### Part 2: Numerical Inversion Algorithm\n\nThe PDF is recovered from the characteristic function via the inverse Fourier transform, which is approximated numerically. The algorithm proceeds as follows for each test case:\n1.  **Calculate Parameters:** Given $(\\kappa, \\theta, x_0, \\sigma, t)$, compute the analytical mean $m_t$ and variance $v_t$.\n2.  **Define Grids:** Construct the spatial grid $\\{x_j\\}_{j=0}^J$ over $[m_t - 4\\sqrt{v_t}, m_t + 4\\sqrt{v_t}]$ and the frequency grid $\\{u_k\\}_{k=-K}^K$ over $[-U, U]$.\n3.  **Numerical Inversion:** For each point $x_j$, approximate the PDF $\\widehat{p}_{X_t}(x_j)$ using the composite trapezoidal rule on the integral. This involves calculating $\\phi_{X_t}(u_k)$ and the Fourier kernel $e^{-i u_k x_j}$ for all grid points, applying the trapezoidal weights, and summing the results.\n4.  **Error Calculation:** For each $x_j$, compute the true PDF value $p_{X_t}(x_j)$ using the Gaussian formula. The absolute error is then $|p_{X_t}(x_j) - \\widehat{p}_{X_t}(x_j)|$.\n5.  **Report Maximum Error:** The result for the test case is the maximum absolute error found across the entire spatial grid $\\{x_j\\}$.\n\nThe following Python code implements this algorithm.\n\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of recovering the PDF of an Ornstein-Uhlenbeck process\n    from its characteristic function using numerical Fourier inversion and\n    calculating the maximum absolute error against the true PDF.\n    \"\"\"\n    # Define the test cases as per the problem statement.\n    # Each tuple is (kappa, theta, x0, sigma, t, U, delta_u)\n    test_cases = [\n        (1.0, 0.0, 1.0, 1.0, 1.0, 30.0, 0.01),\n        (1.0, 0.0, 1.0, 1.0, 1.0, 5.0, 0.01),\n        (1.0, 0.0, 1.0, 1.0, 1.0, 30.0, 0.5),\n        (1.5, -0.5, 2.0, 0.5, 0.1, 30.0, 0.05),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        kappa, theta, x0, sigma, t, U, delta_u = case\n        \n        # 1. Calculate analytical mean (m_t) and variance (v_t) of X_t\n        e_neg_kt = np.exp(-kappa * t)\n        m_t = x0 * e_neg_kt + theta * (1 - e_neg_kt)\n        v_t = (sigma**2 / (2 * kappa)) * (1 - np.exp(-2 * kappa * t))\n        \n        # 2. Setup the grid for x where the PDF is evaluated.\n        # This grid spans 8 standard deviations around the mean.\n        J = 200\n        v_t_sqrt = np.sqrt(v_t)\n        delta_x = 8 * v_t_sqrt / J\n        x_grid = m_t - 4 * v_t_sqrt + np.arange(J + 1) * delta_x\n        \n        # 3. Setup the grid for the frequency domain (u) for numerical integration.\n        K = int(np.floor(U / delta_u))\n        u_grid = np.arange(-K, K + 1) * delta_u\n        \n        # 4. Perform the numerical Fourier inversion.\n        # This is done in a vectorized way for efficiency.\n        \n        # Calculate the characteristic function values on the u_grid.\n        # phi(u) = exp(i*u*m_t - 0.5*u^2*v_t)\n        phi_u_vals = np.exp(1j * u_grid * m_t - 0.5 * u_grid**2 * v_t)\n        \n        # Define the trapezoidal rule weights.\n        weights = np.ones_like(u_grid)\n        weights[0] = 0.5\n        weights[-1] = 0.5\n        \n        # Prepare for vectorized computation over x_grid.\n        # x_grid -> column vector, u_grid -> row vector\n        x_col = x_grid[:, np.newaxis]\n        u_row = u_grid[np.newaxis, :]\n        \n        # Compute the Fourier kernel exp(-i*u*x) for all combinations of u and x.\n        exp_inv_kernel = np.exp(-1j * x_col * u_row)\n        \n        # The integrand for each x is phi(u) * exp(-i*u*x).\n        # We broadcast phi_u_vals to match the shape of the kernel.\n        integrand = phi_u_vals[np.newaxis, :] * exp_inv_kernel\n        \n        # Apply trapezoidal weights to the integrand.\n        integrand_weighted = integrand * weights[np.newaxis, :]\n        \n        # Sum over the u-dimension (axis=1) and scale to get the integral approximation.\n        integral_sum = np.sum(integrand_weighted, axis=1)\n        p_hat_vals = np.real(integral_sum * delta_u / (2 * np.pi))\n        \n        # 5. Calculate the true PDF values on the x_grid.\n        # p(x) = (1/sqrt(2*pi*v_t)) * exp(-(x-m_t)^2 / (2*v_t))\n        p_true_vals = (1 / np.sqrt(2 * np.pi * v_t)) * np.exp(-(x_grid - m_t)**2 / (2 * v_t))\n        \n        # 6. Compute the maximum absolute error.\n        abs_errors = np.abs(p_true_vals - p_hat_vals)\n        max_error = np.max(abs_errors)\n        \n        results.append(max_error)\n\n    # Return results for printing in the final answer tag\n    return results\n\n```", "answer": "[5.26723249767667e-12,0.007623956100913204,0.00030588494801127676,2.0545939223789416e-07]", "id": "2970777"}]}