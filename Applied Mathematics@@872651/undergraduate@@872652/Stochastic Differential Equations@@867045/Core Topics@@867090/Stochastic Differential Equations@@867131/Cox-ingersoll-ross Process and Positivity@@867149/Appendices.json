{"hands_on_practices": [{"introduction": "Before we can simulate a stochastic process, it is invaluable to understand its theoretical long-term behavior. This first exercise guides you through a fundamental derivation to find the stationary distribution of the Cox-Ingersoll-Ross process. By applying the principle of detailed balance to the Fokker-Planck equation, you will see precisely how the model parameters $\\kappa$, $\\theta$, and $\\sigma$ interact to define the process's equilibrium state, which you will identify as a familiar Gamma distribution [@problem_id:3047712].", "problem": "Consider the Cox–Ingersoll–Ross (CIR) stochastic differential equation (SDE)\n$$\n\\mathrm{d}X_{t} \\;=\\; \\kappa\\bigl(\\theta - X_{t}\\bigr)\\,\\mathrm{d}t \\;+\\; \\sigma\\,\\sqrt{X_{t}}\\,\\mathrm{d}W_{t},\n$$\nwhere $X_{t} \\in (0,\\infty)$, $\\kappa>0$, $\\theta>0$, $\\sigma>0$, and $W_{t}$ is a standard Wiener process. Assume the Feller condition $2\\kappa\\theta > \\sigma^{2}$ so that the boundary at $x=0$ is nonattainable and the process remains strictly positive.\n\nStarting from the Kolmogorov forward (Fokker–Planck) equation for the time-dependent probability density $p(x,t)$ and invoking detailed balance (vanishing stationary probability current), derive the stationary density $p^{\\ast}(x)$ on $(0,\\infty)$. Identify this density as a Gamma distribution by determining its shape and rate parameters explicitly in terms of $\\kappa$, $\\theta$, and $\\sigma$. Provide your final answer as a single closed-form analytic expression for $p^{\\ast}(x)$ on $x>0$.", "solution": "The problem statement is deemed valid as it is scientifically grounded, well-posed, and objective. It represents a standard problem in the theory of stochastic processes.\n\nThe Cox–Ingersoll–Ross (CIR) process is described by the stochastic differential equation (SDE):\n$$\n\\mathrm{d}X_{t} \\;=\\; \\kappa(\\theta - X_{t})\\,\\mathrm{d}t \\;+\\; \\sigma\\sqrt{X_{t}}\\,\\mathrm{d}W_{t}\n$$\nThis is a one-dimensional Itô process of the general form $\\mathrm{d}X_t = A(X_t)\\,\\mathrm{d}t + B(X_t)\\,\\mathrm{d}W_t$. By comparison, we identify the drift coefficient $A(x)$ and the diffusion coefficient $B(x)$:\n$$\nA(x) = \\kappa(\\theta - x)\n$$\n$$\nB(x) = \\sigma\\sqrt{x}\n$$\nThe evolution of the probability density function $p(x,t)$ of the process $X_t$ is governed by the Kolmogorov forward equation, also known as the Fokker–Planck equation:\n$$\n\\frac{\\partial p(x,t)}{\\partial t} = -\\frac{\\partial}{\\partial x} \\left[ A(x) p(x,t) \\right] + \\frac{1}{2}\\frac{\\partial^2}{\\partial x^2} \\left[ B(x)^2 p(x,t) \\right]\n$$\nSubstituting the specific forms of $A(x)$ and $B(x)^2 = \\sigma^2 x$ for the CIR process, we get:\n$$\n\\frac{\\partial p(x,t)}{\\partial t} = -\\frac{\\partial}{\\partial x} \\left[ \\kappa(\\theta - x) p(x,t) \\right] + \\frac{1}{2}\\frac{\\partial^2}{\\partial x^2} \\left[ \\sigma^2 x p(x,t) \\right]\n$$\nThis equation can be expressed as a continuity equation, $\\frac{\\partial p}{\\partial t} = -\\frac{\\partial J}{\\partial x}$, where $J(x,t)$ is the probability current:\n$$\nJ(x,t) = A(x) p(x,t) - \\frac{1}{2}\\frac{\\partial}{\\partial x} \\left[B(x)^2 p(x,t)\\right] = \\kappa(\\theta - x) p(x,t) - \\frac{\\sigma^2}{2}\\frac{\\partial}{\\partial x} \\left[x p(x,t)\\right]\n$$\nTo find the stationary density $p^*(x)$, we set the time derivative to zero, $\\frac{\\partial p}{\\partial t} = 0$. This implies that the stationary probability current, $J^*(x)$, must be constant with respect to $x$. The problem specifies to invoke detailed balance, which corresponds to the condition that the stationary probability current vanishes everywhere, i.e., $J^*(x) = 0$. This condition is appropriate for a process on $(0, \\infty)$ with a nonattainable (reflecting) boundary at $x=0$, as ensured by the Feller condition $2\\kappa\\theta > \\sigma^2$. Setting the stationary current to zero gives the following ordinary differential equation for $p^*(x)$:\n$$\n\\kappa(\\theta - x) p^*(x) - \\frac{\\sigma^2}{2}\\frac{\\mathrm{d}}{\\mathrm{d}x} \\left[x p^*(x)\\right] = 0\n$$\nWe can rearrange this equation to solve for $p^*(x)$:\n$$\n\\frac{\\sigma^2}{2}\\frac{\\mathrm{d}}{\\mathrm{d}x} \\left[x p^*(x)\\right] = \\kappa(\\theta - x) p^*(x)\n$$\nApplying the product rule to the left-hand side:\n$$\n\\frac{\\sigma^2}{2}\\left(p^*(x) + x\\frac{\\mathrm{d}p^*(x)}{\\mathrm{d}x}\\right) = \\kappa(\\theta - x)p^*(x)\n$$\nWe can separate variables to solve this first-order linear ODE. Rearranging terms to isolate $\\frac{\\mathrm{d}p^*(x)}{\\mathrm{d}x}$:\n$$\n\\frac{\\sigma^2}{2} x \\frac{\\mathrm{d}p^*(x)}{\\mathrm{d}x} = \\left(\\kappa(\\theta - x) - \\frac{\\sigma^2}{2}\\right)p^*(x) = \\left(\\kappa\\theta - \\frac{\\sigma^2}{2} - \\kappa x\\right)p^*(x)\n$$\n$$\n\\frac{1}{p^*(x)}\\frac{\\mathrm{d}p^*(x)}{\\mathrm{d}x} = \\frac{1}{x} \\frac{2}{\\sigma^2} \\left(\\kappa\\theta - \\frac{\\sigma^2}{2} - \\kappa x\\right) = \\frac{2\\kappa\\theta - \\sigma^2}{\\sigma^2 x} - \\frac{2\\kappa}{\\sigma^2}\n$$\nIntegrating both sides with respect to $x$:\n$$\n\\int \\frac{\\mathrm{d}p^*(x)}{p^*(x)} = \\int \\left(\\frac{2\\kappa\\theta/\\sigma^2 - 1}{x} - \\frac{2\\kappa}{\\sigma^2}\\right)\\mathrm{d}x\n$$\n$$\n\\ln(p^*(x)) = \\left(\\frac{2\\kappa\\theta}{\\sigma^2} - 1\\right)\\ln(x) - \\frac{2\\kappa}{\\sigma^2}x + C'\n$$\nwhere $C'$ is the constant of integration. Exponentiating both sides gives the unnormalized density:\n$$\np^*(x) = \\exp(C') \\exp\\left(\\left(\\frac{2\\kappa\\theta}{\\sigma^2} - 1\\right)\\ln(x)\\right) \\exp\\left(-\\frac{2\\kappa}{\\sigma^2}x\\right)\n$$\n$$\np^*(x) = C x^{\\frac{2\\kappa\\theta}{\\sigma^2} - 1} \\exp\\left(-\\frac{2\\kappa}{\\sigma^2}x\\right)\n$$\nwhere $C = \\exp(C')$ is a normalization constant. This functional form is that of a Gamma distribution. The probability density function of a Gamma distribution with shape parameter $\\alpha$ and rate parameter $\\beta$ is given by:\n$$\nf(x; \\alpha, \\beta) = \\frac{\\beta^\\alpha}{\\Gamma(\\alpha)} x^{\\alpha-1} \\exp(-\\beta x)\n$$\nBy comparing our expression for $p^*(x)$ with the canonical form of the Gamma PDF, we can identify the shape and rate parameters:\nShape parameter:\n$$\n\\alpha - 1 = \\frac{2\\kappa\\theta}{\\sigma^2} - 1 \\quad \\implies \\quad \\alpha = \\frac{2\\kappa\\theta}{\\sigma^2}\n$$\nRate parameter:\n$$\n\\beta = \\frac{2\\kappa}{\\sigma^2}\n$$\nThe parameters $\\kappa$, $\\theta$, and $\\sigma$ are all positive, ensuring that $\\alpha > 0$ and $\\beta > 0$. The given Feller condition $2\\kappa\\theta > \\sigma^2$ ensures that $\\alpha > 1$.\nThe normalization constant $C$ is therefore:\n$$\nC = \\frac{\\beta^\\alpha}{\\Gamma(\\alpha)} = \\frac{\\left(\\frac{2\\kappa}{\\sigma^2}\\right)^{\\frac{2\\kappa\\theta}{\\sigma^2}}}{\\Gamma\\left(\\frac{2\\kappa\\theta}{\\sigma^2}\\right)}\n$$\nSubstituting this constant back into our expression for $p^*(x)$, we obtain the final normalized stationary probability density:\n$$\np^*(x) = \\frac{\\left(\\frac{2\\kappa}{\\sigma^2}\\right)^{\\frac{2\\kappa\\theta}{\\sigma^2}}}{\\Gamma\\left(\\frac{2\\kappa\\theta}{\\sigma^2}\\right)} x^{\\frac{2\\kappa\\theta}{\\sigma^2} - 1} \\exp\\left(-\\frac{2\\kappa}{\\sigma^2}x\\right)\n$$\nThis is the stationary density for the CIR process on the domain $x \\in (0, \\infty)$.", "answer": "$$\n\\boxed{\\frac{\\left(\\frac{2\\kappa}{\\sigma^2}\\right)^{\\frac{2\\kappa\\theta}{\\sigma^2}}}{\\Gamma\\left(\\frac{2\\kappa\\theta}{\\sigma^2}\\right)} x^{\\frac{2\\kappa\\theta}{\\sigma^2} - 1} \\exp\\left(-\\frac{2\\kappa}{\\sigma^2}x\\right)}\n$$", "id": "3047712"}, {"introduction": "The theoretical CIR process is guaranteed to remain non-negative, a crucial feature for models of interest rates or variance. However, this essential property is often lost when we move from the continuous world of theory to the discrete steps of a computer simulation. This practice exposes a critical pitfall of the most straightforward simulation technique, the Euler-Maruyama method, by having you calculate the probability that a single step can fall below zero [@problem_id:3047714]. Mastering this concept is fundamental to building robust numerical models and appreciating the subtleties of discretization.", "problem": "Consider the Cox–Ingersoll–Ross (CIR) stochastic differential equation (SDE) given by $dX_t = \\kappa(\\theta - X_t)\\,dt + \\sigma \\sqrt{X_t}\\,dW_t$ with initial value $X_0 \\ge 0$, where $\\kappa > 0$, $\\theta > 0$, $\\sigma \\ge 0$, and $W_t$ is a standard Brownian motion. The exact solution of this SDE is known to be strictly positive under the Feller condition $2\\kappa\\theta \\ge \\sigma^2$ when $X_0 > 0$. However, numerical time discretizations such as the Euler–Maruyama method do not inherit this positivity in general.\n\nTask: Starting from the definition of the Euler–Maruyama scheme applied to an Itô SDE and the fact that Brownian increments over a time step of length $h$ are normally distributed with mean $0$ and variance $h$, derive from first principles an expression for the probability that a single Euler–Maruyama update of the CIR SDE starting from a given nonnegative state $x \\ge 0$ yields a negative next value. Your derivation must express this probability in terms of $\\kappa$, $\\theta$, $\\sigma$, $x$, and $h$, using only standard properties of the normal distribution. Then, implement a program that, for each parameter set in the test suite below, computes this one-step negativity probability and returns it as a floating-point number rounded to six decimal places.\n\nYou must treat any degenerate cases correctly. In particular, if the diffusion coefficient at the current state is zero so that the noise term disappears in the Euler–Maruyama update (for example, when $\\sigma = 0$ or $x = 0$), then the one-step update is deterministic; in this situation, the probability should be either $0$ or $1$ depending on the sign of the deterministic update.\n\nUse the following test suite. Each test case is a tuple $(\\kappa,\\theta,\\sigma,x,h)$:\n- Test case $1$: $(4.0, 0.04, 0.5, 0.04, 0.25)$.\n- Test case $2$: $(1.2, 0.05, 0.3, 0.0, 0.1)$.\n- Test case $3$: $(0.3, 0.02, 0.4, 0.02, 0.5)$.\n- Test case $4$: $(10.0, 0.01, 0.0, 0.03, 0.2)$.\n\nDesign for coverage:\n- Test case $1$ satisfies the Feller condition $2\\kappa\\theta \\ge \\sigma^2$ with $x > 0$, illustrating that even then the Euler–Maruyama method can assign a positive probability to a negative next step.\n- Test case $2$ starts at $x = 0$, where the diffusion term vanishes and the one-step scheme is deterministic in the first step.\n- Test case $3$ violates the Feller condition and has $x > 0$ with a relatively large time step $h$, illustrating a larger probability of crossing below zero.\n- Test case $4$ has $\\sigma = 0$ and a large time step $h$ chosen so that the deterministic Euler step becomes negative, yielding probability $1$ of negativity despite $x \\ge 0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test suite and with each probability rounded to six decimal places (for example, $[0.123456,0.000000,0.654321,1.000000]$).", "solution": "The problem requires the derivation of the one-step negativity probability for the Euler–Maruyama discretization of the Cox-Ingersoll-Ross (CIR) process.\n\nThe CIR process is described by the stochastic differential equation (SDE):\n$$\ndX_t = \\kappa(\\theta - X_t)\\,dt + \\sigma \\sqrt{X_t}\\,dW_t\n$$\nwhere $X_t$ is the state of the process at time $t$, $W_t$ is a standard Brownian motion, and the parameters $\\kappa$, $\\theta$, and $\\sigma$ are constants satisfying $\\kappa > 0$, $\\theta > 0$, and $\\sigma \\ge 0$. The process starts from a non-negative initial value $X_0 \\ge 0$.\n\nThe Euler-Maruyama numerical scheme is used to approximate the solution of an SDE by discretizing time into steps of length $h$. For a general Itô SDE $dY_t = a(Y_t, t)\\,dt + b(Y_t, t)\\,dW_t$, the scheme is given by:\n$$\nY_{n+1} = Y_n + a(Y_n, t_n)h + b(Y_n, t_n)\\Delta W_n\n$$\nwhere $Y_n = Y_{t_n}$, $t_{n+1} = t_n + h$, and $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$ is the increment of the Brownian motion over the time step. A fundamental property of Brownian motion is that its increments are normally distributed, specifically $\\Delta W_n \\sim N(0, h)$.\n\nFor the CIR process, the drift and diffusion coefficients are $a(x) = \\kappa(\\theta - x)$ and $b(x) = \\sigma \\sqrt{x}$, respectively. Let the current state of the process be $X_n = x$, where $x \\ge 0$. Applying the Euler-Maruyama scheme, the next state $X_{n+1}$ is:\n$$\nX_{n+1} = x + \\kappa(\\theta - x)h + \\sigma \\sqrt{x} \\Delta W_n\n$$\nWe need to find the probability that this next state is negative, i.e., $P(X_{n+1}  0)$.\n\nThe Brownian increment $\\Delta W_n$ can be expressed as $\\sqrt{h}Z$, where $Z$ is a standard normal random variable, $Z \\sim N(0, 1)$. Substituting this into the equation for $X_{n+1}$ gives:\n$$\nX_{n+1} = x + \\kappa(\\theta - x)h + \\sigma \\sqrt{x} \\sqrt{h} Z\n$$\nWe want to calculate the probability $P(X_{n+1}  0)$, which translates to:\n$$\nP(x + \\kappa(\\theta - x)h + \\sigma \\sqrt{x} \\sqrt{h} Z  0)\n$$\nTo solve this, we must analyze two distinct cases based on the value of the diffusion term's coefficient.\n\n**Case 1: Non-degenerate diffusion ($\\sigma > 0$ and $x > 0$)**\nIn this case, the coefficient of the random variable $Z$, which is $\\sigma \\sqrt{x} \\sqrt{h}$, is strictly positive. We can rearrange the inequality to isolate $Z$:\n$$\n\\sigma \\sqrt{x} \\sqrt{h} Z  - (x + \\kappa(\\theta - x)h)\n$$\n$$\nZ  - \\frac{x + \\kappa(\\theta - x)h}{\\sigma \\sqrt{x} \\sqrt{h}}\n$$\nSince $Z$ is a standard normal random variable, the probability $P(Z  c)$ for some constant $c$ is given by the cumulative distribution function (CDF) of the standard normal distribution, denoted by $\\Phi(c)$. Therefore, the probability of $X_{n+1}$ being negative is:\n$$\nP(X_{n+1}  0) = \\Phi\\left(- \\frac{x + \\kappa(\\theta - x)h}{\\sigma \\sqrt{x} \\sqrt{h}}\\right)\n$$\nThis expression gives the probability in terms of the model parameters, the current state, and the time step, using a standard property of the normal distribution as required.\n\n**Case 2: Degenerate diffusion ($\\sigma = 0$ or $x = 0$)**\nIn this situation, the stochastic term $\\sigma \\sqrt{x} \\sqrt{h}Z$ vanishes, and the update becomes deterministic.\n$$\nX_{n+1} = x + \\kappa(\\theta - x)h\n$$\nThe value of $X_{n+1}$ is fixed, so the probability of it being negative is either $0$ or $1$.\n\nSubcase 2a: $x = 0$.\nThe update equation simplifies to:\n$$\nX_{n+1} = 0 + \\kappa(\\theta - 0)h = \\kappa\\theta h\n$$\nGiven the constraints $\\kappa > 0$, $\\theta > 0$, and the nature of a time step $h > 0$, the result $\\kappa\\theta h$ is strictly positive. Thus, $X_{n+1} > 0$. The probability of the next state being negative is zero.\n$$\nP(X_{n+1}  0 \\mid x=0) = 0\n$$\n\nSubcase 2b: $\\sigma = 0$ (and $x \\ge 0$).\nThe SDE becomes an ordinary differential equation, $dX_t = \\kappa(\\theta - X_t)dt$, and the Euler update is:\n$$\nX_{n+1} = x + \\kappa(\\theta - x)h\n$$\nThe probability of a negative step depends on the sign of this deterministic value:\n$$\nP(X_{n+1}  0 \\mid \\sigma=0) = \\begin{cases} 1  \\text{if } x + \\kappa(\\theta - x)h  0 \\\\ 0  \\text{if } x + \\kappa(\\theta - x)h \\ge 0 \\end{cases}\n$$\n\nIn summary, the probability $P_{neg} = P(X_{n+1}  0 \\mid X_n = x)$ is calculated as follows:\n1.  If $\\sigma = 0$ or $x = 0$:\n    - The update is deterministic: $X_{next} = x + \\kappa(\\theta - x)h$.\n    - $P_{neg} = 1$ if $X_{next}  0$.\n    - $P_{neg} = 0$ if $X_{next} \\ge 0$. (Note: as shown, if $x=0$, $X_{next} > 0$, so $P_{neg}=0$)\n2.  If $\\sigma > 0$ and $x > 0$:\n    - The probability is given by the CDF of the standard normal distribution:\n    $$\n    P_{neg} = \\Phi\\left(- \\frac{x + \\kappa(\\theta - x)h}{\\sigma \\sqrt{x} \\sqrt{h}}\\right)\n    $$\nThis formulation provides a complete method for calculating the one-step negativity probability for any valid set of parameters.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Calculates the one-step negativity probability for the Euler-Maruyama\n    discretization of the Cox-Ingersoll-Ross (CIR) process for several\n    test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (kappa, theta, sigma, x, h)\n    test_cases = [\n        (4.0, 0.04, 0.5, 0.04, 0.25),  # Feller condition satisfied\n        (1.2, 0.05, 0.3, 0.0, 0.1),   # Starts at x=0 (degenerate case)\n        (0.3, 0.02, 0.4, 0.02, 0.5),   # Feller condition violated\n        (10.0, 0.01, 0.0, 0.03, 0.2),  # sigma=0 (degenerate case)\n    ]\n\n    string_results = []\n    for case in test_cases:\n        kappa, theta, sigma, x, h = case\n        \n        prob = 0.0\n\n        # Case 1: Degenerate diffusion term (sigma=0 or x=0)\n        # The update is deterministic.\n        if sigma == 0.0 or x == 0.0:\n            # Deterministic update: X_{n+1} = x + kappa * (theta - x) * h\n            next_val = x + kappa * (theta - x) * h\n            if next_val  0:\n                prob = 1.0\n            else:\n                prob = 0.0\n        \n        # Case 2: Non-degenerate diffusion term (sigma  0 and x  0)\n        # The update is stochastic.\n        else:\n            # Argument for the standard normal CDF\n            # C = - (x + kappa*(theta - x)*h) / (sigma * sqrt(x*h))\n            numerator = x + kappa * (theta - x) * h\n            denominator = sigma * np.sqrt(x * h)\n            \n            # The problem of division by zero in the denominator is already\n            # handled by the check for x=0.\n            cdf_arg = -numerator / denominator\n            \n            # The probability is the CDF of the standard normal distribution.\n            prob = norm.cdf(cdf_arg)\n            \n        string_results.append(f\"{prob:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(string_results)}]\")\n\nsolve()\n```", "id": "3047714"}, {"introduction": "Having seen that the simple Euler-Maruyama scheme can fail to preserve positivity, a natural next step is to ask if a more accurate, higher-order method offers a solution. This practice explores this question by focusing on the Milstein method, a scheme with a higher order of strong convergence. You will derive the Milstein scheme for the CIR process and, through a combination of analysis and simulation, discover that it too can produce negative values [@problem_id:3002529]. This investigation reveals that the challenge of positivity is more profound than simple accuracy and is tied to the very structure of the numerical scheme.", "problem": "Consider the Cox–Ingersoll–Ross process, a one-dimensional stochastic differential equation (SDE) modeling a nonnegative diffusion, defined by $dX_t = \\kappa(\\theta - X_t)\\,dt + \\sigma\\sqrt{X_t}\\,dW_t$ with parameters $\\kappa > 0$, $\\theta > 0$, and $\\sigma > 0$. The process admits a unique strong solution that remains nonnegative under conditions that are standard in the literature. Your task is to investigate whether the explicit Milstein method, when applied to this SDE, preserves the nonnegativity of the numerical solution.\n\nStarting from first principles of Itô calculus for SDEs and the Itô–Taylor expansion to strong order one, derive a one-step explicit discretization of the Milstein method for a general scalar SDE $dX_t = a(X_t)\\,dt + b(X_t)\\,dW_t$ and then specialize it to the Cox–Ingersoll–Ross model. Use the fundamental definitions and the Itô formula for expansions up to the required order, and state all assumptions clearly. Based on this derivation, analyze whether the method enforces $X_n \\ge 0$ for all discrete times $t_n$ and explain any violations of nonnegativity in terms of the structure of the drift and diffusion coefficients and the stochastic increments.\n\nImplement a program that simulates independent sample paths using the derived explicit Milstein method for specified parameter sets. For each test case, simulate $N_{\\text{paths}}$ independent paths over $[0,T]$ with uniform time step $h$, and compute the fraction of paths that ever attain a negative value (strictly less than $0$) at any time during the simulation. A path that first becomes negative should be counted as negative thereafter; do not apply any corrective modifications (such as projection, truncation, or reflection) to force nonnegativity.\n\nThe program must:\n- Use the explicit Milstein discretization derived from first principles, specialized to the Cox–Ingersoll–Ross model.\n- Use a fixed random number generator seed to ensure reproducibility. Initialize a single generator at program start with seed $2025$ and use it for all randomness.\n- Vectorize computations across paths for efficiency and handle the square root term carefully at the boundary: it is defined for $X_n \\ge 0$ and the scheme must not attempt to evaluate $\\sqrt{X_n}$ for $X_n  0$.\n- For each path, once $X_n  0$ occurs, mark the path as negative and cease further updates to that path; subsequent steps should leave its value unchanged and it should remain marked as negative.\n\nUse the following test suite of parameter values, designed to probe different facets of positivity:\n- Case A (general case with strong mean reversion and moderate volatility): $\\kappa = 3.0$, $\\theta = 1.0$, $\\sigma = 1.0$, $X_0 = 1.0$, $h = 0.005$, $T = 1.0$, $N_{\\text{paths}} = 5000$.\n- Case B (coarser time step to test discretization error impact): $\\kappa = 3.0$, $\\theta = 1.0$, $\\sigma = 1.0$, $X_0 = 1.0$, $h = 0.02$, $T = 1.0$, $N_{\\text{paths}} = 5000$.\n- Case C (boundary of the Feller condition $2\\kappa\\theta = \\sigma^2$): $\\kappa = 2.0$, $\\theta = 1.0$, $\\sigma = 2.0$, $X_0 = 1.0$, $h = 0.005$, $T = 1.0$, $N_{\\text{paths}} = 5000$.\n- Case D (near-zero initial state): $\\kappa = 3.0$, $\\theta = 1.0$, $\\sigma = 1.0$, $X_0 = 10^{-6}$, $h = 0.005$, $T = 1.0$, $N_{\\text{paths}} = 5000$.\n\nAll quantities are dimensionless, so no physical units are required. The output for each case must be a floating-point number equal to the fraction of paths that ever become negative, rounded to six decimal places.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[resultA,resultB,resultC,resultD]\"), where each entry corresponds respectively to Cases A, B, C, and D, rounded to six decimal places. For example, if the fractions are $0.012345$, $0.067890$, $0.000000$, and $0.123456$, the program must print \"[0.012345,0.067890,0.000000,0.123456]\".", "solution": "The problem is assessed to be valid. It is scientifically grounded in the theory of stochastic differential equations and numerical methods, is well-posed with a complete and consistent set of parameters, and uses objective, formal language. It represents a standard, non-trivial exercise in computational finance and stochastic analysis.\n\n### Derivation of the Explicit Milstein Method\n\nWe begin with a general one-dimensional Itô stochastic differential equation (SDE):\n$$\ndX_t = a(X_t) \\, dt + b(X_t) \\, dW_t\n$$\nwhere $a(X_t)$ is the drift coefficient, $b(X_t)$ is the diffusion coefficient, and $W_t$ is a standard Wiener process. The goal is to derive a numerical scheme for $X_{t_{n+1}}$ given $X_{t_n}$, where $t_{n+1} = t_n + h$ for a small time step $h > 0$.\n\nThe integral form of the SDE over the interval $[t_n, t_{n+1}]$ is:\n$$\nX_{t_{n+1}} = X_{t_n} + \\int_{t_n}^{t_{n+1}} a(X_s) \\, ds + \\int_{t_n}^{t_{n+1}} b(X_s) \\, dW_s\n$$\nThe Milstein method improves upon the Euler-Maruyama method by more accurately approximating the stochastic integral. The drift integral is approximated as in the Euler method:\n$$\n\\int_{t_n}^{t_{n+1}} a(X_s) \\, ds \\approx a(X_{t_n}) h\n$$\nFor the stochastic integral, we first apply an Itô-Taylor expansion to the integrand $b(X_s)$ around $t_n$. Using Itô's formula for the function $b(x)$, we have:\n$$\nb(X_s) = b(X_{t_n}) + \\int_{t_n}^s L^0 b(X_u) \\, du + \\int_{t_n}^s L^1 b(X_u) \\, dW_u\n$$\nwhere $L^0 = a(x)\\frac{\\partial}{\\partial x} + \\frac{1}{2}b(x)^2\\frac{\\partial^2}{\\partial x^2}$ and $L^1 = b(x)\\frac{\\partial}{\\partial x}$ are the generator operators. For a strong order $1.0$ scheme, we can approximate the integrands in the expansion of $b(X_s)$ by their values at $t_n$.\n$$\nb(X_s) \\approx b(X_{t_n}) + L^1 b(X_{t_n}) \\int_{t_n}^s dW_u = b(X_{t_n}) + b(X_{t_n}) b'(X_{t_n}) (W_s - W_{t_n})\n$$\nSubstituting this approximation into the stochastic integral:\n$$\n\\int_{t_n}^{t_{n+1}} b(X_s) \\, dW_s \\approx \\int_{t_n}^{t_{n+1}} \\left[ b(X_{t_n}) + b(X_{t_n}) b'(X_{t_n}) (W_s - W_{t_n}) \\right] \\, dW_s\n$$\n$$\n= b(X_{t_n}) \\int_{t_n}^{t_{n+1}} dW_s + b(X_{t_n}) b'(X_{t_n}) \\int_{t_n}^{t_{n+1}} (W_s - W_{t_n}) \\, dW_s\n$$\nThe first integral is the Wiener increment, $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$. The second is a standard double Itô integral, whose value is known:\n$$\n\\int_{t_n}^{t_{n+1}} (W_s - W_{t_n}) \\, dW_s = \\frac{1}{2} \\left[ (W_{t_{n+1}} - W_{t_n})^2 - (t_{n+1} - t_n) \\right] = \\frac{1}{2} \\left[ (\\Delta W_n)^2 - h \\right]\n$$\nCombining these terms, we obtain the one-step explicit Milstein discretization, using the notation $X_n = X_{t_n}$:\n$$\nX_{n+1} = X_n + a(X_n)h + b(X_n)\\Delta W_n + \\frac{1}{2} b(X_n) b'(X_n) \\left[ (\\Delta W_n)^2 - h \\right]\n$$\n\n### Specialization to the Cox–Ingersoll–Ross (CIR) Model\n\nThe CIR process is defined by the SDE:\n$$\ndX_t = \\kappa(\\theta - X_t) \\, dt + \\sigma\\sqrt{X_t} \\, dW_t\n$$\nComparing with the general SDE form, we identify the coefficients:\n$$\na(x) = \\kappa(\\theta - x)\n$$\n$$\nb(x) = \\sigma\\sqrt{x} = \\sigma x^{1/2}\n$$\nThe derivative of the diffusion coefficient is (for $x > 0$):\n$$\nb'(x) = \\frac{d}{dx}(\\sigma x^{1/2}) = \\frac{1}{2}\\sigma x^{-1/2} = \\frac{\\sigma}{2\\sqrt{x}}\n$$\nA key property for the CIR Milstein scheme is that the product $b(x)b'(x)$ is a constant:\n$$\nb(x)b'(x) = (\\sigma\\sqrt{x}) \\left(\\frac{\\sigma}{2\\sqrt{x}}\\right) = \\frac{\\sigma^2}{2}\n$$\nSubstituting these coefficients into the general Milstein formula, we get the scheme for the CIR model:\n$$\nX_{n+1} = X_n + \\kappa(\\theta - X_n)h + \\sigma\\sqrt{X_n}\\Delta W_n + \\frac{1}{2}\\left(\\frac{\\sigma^2}{2}\\right)\\left[ (\\Delta W_n)^2 - h \\right]\n$$\nTo implement this, we use the property that $\\Delta W_n \\sim \\mathcal{N}(0, h)$, so we can write $\\Delta W_n = \\sqrt{h}Z_n$, where $Z_n \\sim \\mathcal{N}(0, 1)$. This gives $(\\Delta W_n)^2 = h Z_n^2$. The final scheme is:\n$$\nX_{n+1} = X_n + \\kappa(\\theta - X_n)h + \\sigma\\sqrt{X_n h}Z_n + \\frac{\\sigma^2}{4}\\left[ h Z_n^2 - h \\right]\n$$\n$$\nX_{n+1} = X_n + \\kappa(\\theta - X_n)h + \\sigma\\sqrt{X_n h}Z_n + \\frac{\\sigma^2 h}{4}(Z_n^2 - 1)\n$$\nThis is the explicit Milstein discretization for the CIR process that will be implemented.\n\n### Analysis of Nonnegativity Preservation\n\nThe true solution to the CIR SDE is guaranteed to be nonnegative if the Feller condition $2\\kappa\\theta \\geq \\sigma^2$ is met. We now analyze if the numerical scheme preserves this property.\nWe can rearrange the expression for $X_{n+1}$ as a quadratic function of the standard normal random variable $Z_n$:\n$$\nX_{n+1} = \\left(\\frac{\\sigma^2 h}{4}\\right)Z_n^2 + \\left(\\sigma\\sqrt{X_n h}\\right)Z_n + \\left(X_n + \\kappa(\\theta - X_n)h - \\frac{\\sigma^2 h}{4}\\right)\n$$\nThis is a parabola in $Z_n$ of the form $AZ_n^2 + BZ_n + C$, with $A = \\frac{\\sigma^2 h}{4} > 0$. Since the parabola opens upwards, it can attain a negative value only if its minimum value is negative. The minimum of the parabola occurs at $Z_n^* = -B/(2A)$ and the minimum value is $X_{n+1}^{\\text{min}} = C - B^2/(4A)$.\n\nLet's compute this minimum value.\n- $B^2 = (\\sigma\\sqrt{X_n h})^2 = \\sigma^2 X_n h$\n- $4A = 4 \\left(\\frac{\\sigma^2 h}{4}\\right) = \\sigma^2 h$\n- $\\frac{B^2}{4A} = \\frac{\\sigma^2 X_n h}{\\sigma^2 h} = X_n$\n- $C = X_n(1 - \\kappa h) + \\kappa\\theta h - \\frac{\\sigma^2 h}{4}$\n\nThe minimum value is:\n$$\nX_{n+1}^{\\text{min}} = C - X_n = \\left(X_n(1 - \\kappa h) + \\kappa\\theta h - \\frac{\\sigma^2 h}{4}\\right) - X_n = -\\kappa h X_n + \\kappa\\theta h - \\frac{\\sigma^2 h}{4}\n$$\n$$\nX_{n+1}^{\\text{min}} = h \\left( \\kappa\\theta - \\frac{\\sigma^2}{4} - \\kappa X_n \\right)\n$$\nThe numerical solution $X_{n+1}$ can become negative if this minimum value is negative. Since $h > 0$, negativity is possible if:\n$$\n\\kappa\\theta - \\frac{\\sigma^2}{4} - \\kappa X_n  0 \\quad \\iff \\quad X_n > \\theta - \\frac{\\sigma^2}{4\\kappa}\n$$\nThis condition reveals that for any set of parameters $(\\kappa, \\theta, \\sigma, h)$ and for a sufficiently large value of the current state $X_n$, there exists a non-zero probability (associated with the random variable $Z_n$ attaining a value close to $Z_n^*$) for the next state $X_{n+1}$ to be negative. For example, in Case A, this inequality becomes $X_n > 1 - 1/12 \\approx 0.9167$. Since the process starts at $X_0 = 1.0$, it is immediately in a region where negativity is possible.\n\nEven if $4\\kappa\\theta > \\sigma^2$, ensuring that the origin is repulsive for small $X_n$ (i.e., $X_{n+1}^{\\text{min}} > 0$ for small $X_n$), the mean-reverting nature of the process pushes $X_t$ towards $\\theta$. If $\\theta$ is in the \"negativity-possible\" region (i.e., $\\theta > \\theta - \\frac{\\sigma^2}{4\\kappa}$, which is always true), the process will spend time in this region, exposing it to the risk of becoming negative due to a large random shock.\n\nTherefore, the explicit Milstein method does not, in general, preserve the nonnegativity of the CIR process. The violation is a structural property of the scheme, where the quadratic correction term is not sufficient to counteract large negative values of the diffusion term for all possible states and random shocks.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the explicit Milstein method for the Cox-Ingersoll-Ross (CIR) process\n    to determine the fraction of paths that become negative.\n    \"\"\"\n    # Set the global seed for the random number generator for reproducibility.\n    # A single generator is initialized and used for all simulations.\n    rng = np.random.default_rng(seed=2025)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: General case with strong mean reversion and moderate volatility\n        {'label': 'A', 'kappa': 3.0, 'theta': 1.0, 'sigma': 1.0, 'X0': 1.0, 'h': 0.005, 'T': 1.0, 'N_paths': 5000},\n        # Case B: Coarser time step to test discretization error impact\n        {'label': 'B', 'kappa': 3.0, 'theta': 1.0, 'sigma': 1.0, 'X0': 1.0, 'h': 0.02, 'T': 1.0, 'N_paths': 5000},\n        # Case C: Boundary of the Feller condition 2*kappa*theta = sigma^2\n        {'label': 'C', 'kappa': 2.0, 'theta': 1.0, 'sigma': 2.0, 'X0': 1.0, 'h': 0.005, 'T': 1.0, 'N_paths': 5000},\n        # Case D: Near-zero initial state\n        {'label': 'D', 'kappa': 3.0, 'theta': 1.0, 'sigma': 1.0, 'X0': 1e-6, 'h': 0.005, 'T': 1.0, 'N_paths': 5000},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract parameters for the current simulation\n        kappa = case['kappa']\n        theta = case['theta']\n        sigma = case['sigma']\n        X0 = case['X0']\n        h = case['h']\n        T = case['T']\n        N_paths = case['N_paths']\n\n        num_steps = int(T / h)\n        \n        # Initialize all paths to the starting value X0\n        X = np.full(N_paths, X0, dtype=np.float64)\n        \n        # Boolean array to track paths that have ever become negative.\n        # Once a path is marked, it ceases to be updated.\n        is_negative = np.zeros(N_paths, dtype=bool)\n\n        # Pre-compute constants for efficiency\n        sqrt_h = np.sqrt(h)\n        sigma2_h_4 = 0.25 * sigma**2 * h\n        kappa_theta_h = kappa * theta * h\n        kappa_h = kappa * h\n\n        for _ in range(num_steps):\n            # A mask to select active paths (those that have not yet turned negative)\n            active_mask = ~is_negative\n            \n            # Optimization: if all paths have turned negative, we can exit the loop\n            if not np.any(active_mask):\n                break\n\n            num_active = np.sum(active_mask)\n            \n            # Current state values for only the active paths\n            X_n = X[active_mask]\n\n            # Generate standard normal random increments for active paths\n            Z = rng.standard_normal(size=num_active)\n\n            # Apply the explicit Milstein method for the CIR process:\n            # X_{n+1} = X_n + kappa*(theta - X_n)*h + sigma*sqrt(X_n)*sqrt(h)*Z + 0.25*sigma^2*h*(Z^2 - 1)\n            # The sqrt(X_n) is safe because X_n = 0 for all active paths.\n            term_drift = kappa_theta_h - X_n * kappa_h\n            term_diffusion = sigma * np.sqrt(X_n) * sqrt_h * Z\n            term_milstein = sigma2_h_4 * (Z**2 - 1)\n            \n            X_next = X_n + term_drift + term_diffusion + term_milstein\n\n            # Update the state of the active paths in the main state array\n            X[active_mask] = X_next\n\n            # Identify any of the just-updated paths that have now become negative.\n            # Update the master 'is_negative' tracker accordingly for these paths.\n            is_negative[active_mask] = (X_next  0)\n            \n        # After the simulation, compute the fraction of paths that ever became negative\n        fraction_negative = np.mean(is_negative)\n        results.append(fraction_negative)\n\n    # Format the final output string as a comma-separated list in brackets,\n    # with each result rounded to six decimal places.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3002529"}]}