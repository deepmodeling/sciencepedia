{"hands_on_practices": [{"introduction": "Understanding periodic systems begins with identifying the fundamental patterns, or modes, they can support. This foundational exercise ([@problem_id:2124821]) guides you through solving a simple second-order ordinary differential equation with periodic boundary conditions. By determining the specific values of $\\lambda$ (the eigenvalues) for which non-trivial solutions exist, you are effectively discovering the complete set of 'standing waves' that can exist on a ring, which form the building blocks for analyzing more complex phenomena.", "problem": "Consider a thin, perfectly elastic circular hoop of circumference $L$. The small, transverse, time-independent displacements $y(x)$ of any point on the hoop from its equilibrium circular shape can be described by a coordinate $x$ that runs from $0$ to $L$. The governing equation for these displacements is given by the differential equation:\n$$y''(x) + \\lambda y(x) = 0$$\nwhere $\\lambda$ is a real constant whose value depends on the physical properties of the hoop and the mode of vibration.\n\nSince the hoop is a continuous circle, the displacement and the slope of the displacement must be the same at the beginning and the end of the coordinate interval. This physical requirement imposes the following periodic boundary conditions:\n$$y(0) = y(L) \\quad \\text{and} \\quad y'(0) = y'(L)$$\nFor the hoop to exhibit a stable, non-trivial displacement pattern (i.e., for a solution where $y(x)$ is not identically zero), the constant $\\lambda$ can only take on a specific set of discrete values.\n\nWhich of the following expressions correctly describes all possible non-negative values of $\\lambda$ for which non-trivial solutions exist? In the options below, $n$ is an integer.\n\nA. $\\lambda_n = \\left(\\frac{n\\pi}{L}\\right)^2$, for $n=1, 2, 3, \\ldots$\n\nB. $\\lambda_n = \\left(\\frac{(2n-1)\\pi}{2L}\\right)^2$, for $n=1, 2, 3, \\ldots$\n\nC. $\\lambda_n = \\left(\\frac{2n\\pi}{L}\\right)^2$, for $n=0, 1, 2, \\ldots$\n\nD. $\\lambda_n = \\left(\\frac{n\\pi}{L}\\right)^2$, for $n=0, 1, 2, \\ldots$\n\nE. $\\lambda_n = \\left(\\frac{2n\\pi}{L}\\right)^2$, for $n=1, 2, 3, \\ldots$", "solution": "To find the values of $\\lambda$ that allow for non-trivial solutions to the boundary value problem, we must analyze the general solution of the differential equation for different cases of $\\lambda$. The differential equation is $y''(x) + \\lambda y(x) = 0$ with periodic boundary conditions $y(0) = y(L)$ and $y'(0) = y'(L)$.\n\nCase 1: $\\lambda  0$\nLet $\\lambda = k^2$ for some $k > 0$. The differential equation becomes $y''(x) + k^2 y(x) = 0$. The general solution is:\n$$y(x) = C_1 \\cos(kx) + C_2 \\sin(kx)$$\nThe derivative is:\n$$y'(x) = -C_1 k \\sin(kx) + C_2 k \\cos(kx)$$\nNow, we apply the boundary conditions.\nFrom $y(0) = y(L)$:\n$$C_1 \\cos(0) + C_2 \\sin(0) = C_1 \\cos(kL) + C_2 \\sin(kL)$$\n$$C_1 = C_1 \\cos(kL) + C_2 \\sin(kL)$$\n$$(1 - \\cos(kL))C_1 - \\sin(kL)C_2 = 0 \\quad (1)$$\nFrom $y'(0) = y'(L)$:\n$$-C_1 k \\sin(0) + C_2 k \\cos(0) = -C_1 k \\sin(kL) + C_2 k \\cos(kL)$$\n$$C_2 k = -C_1 k \\sin(kL) + C_2 k \\cos(kL)$$\nAssuming $k \\neq 0$, we can divide by $k$:\n$$C_2 = -C_1 \\sin(kL) + C_2 \\cos(kL)$$\n$$\\sin(kL)C_1 + (1 - \\cos(kL))C_2 = 0 \\quad (2)$$\nWe have a system of two linear equations for $C_1$ and $C_2$. For a non-trivial solution to exist (i.e., $C_1$ and $C_2$ are not both zero), the determinant of the coefficient matrix must be zero.\n$$\n\\det \\begin{pmatrix} 1-\\cos(kL)  -\\sin(kL) \\\\ \\sin(kL)  1-\\cos(kL) \\end{pmatrix} = 0\n$$\n$$(1-\\cos(kL))^2 - (-\\sin(kL))(\\sin(kL)) = 0$$\n$$(1 - 2\\cos(kL) + \\cos^2(kL)) + \\sin^2(kL) = 0$$\n$$1 - 2\\cos(kL) + (\\cos^2(kL) + \\sin^2(kL)) = 0$$\n$$1 - 2\\cos(kL) + 1 = 0$$\n$$2 - 2\\cos(kL) = 0$$\n$$\\cos(kL) = 1$$\nThis condition is satisfied when $kL = 2n\\pi$ for any integer $n$. Since we assumed $k > 0$ and $L > 0$, we must have $n = 1, 2, 3, \\ldots$.\nSo, $k_n = \\frac{2n\\pi}{L}$ for $n = 1, 2, 3, \\ldots$.\nThe corresponding values for $\\lambda$ are $\\lambda_n = k_n^2 = \\left(\\frac{2n\\pi}{L}\\right)^2$ for $n = 1, 2, 3, \\ldots$.\n\nCase 2: $\\lambda = 0$\nThe differential equation becomes $y''(x) = 0$. The general solution is:\n$$y(x) = C_1 x + C_2$$\nThe derivative is:\n$$y'(x) = C_1$$\nApplying the boundary conditions:\nFrom $y(0) = y(L)$:\n$$C_1(0) + C_2 = C_1 L + C_2$$\n$$C_2 = C_1 L + C_2 \\implies C_1 L = 0$$\nSince $L \\neq 0$, we must have $C_1 = 0$.\nFrom $y'(0) = y'(L)$:\n$$C_1 = C_1$$\nThis condition is always true and provides no new information.\nThe first condition forced $C_1=0$. The solution becomes $y(x) = C_2$. This is a constant function. For any choice of $C_2 \\neq 0$, this is a non-trivial solution.\nTherefore, $\\lambda = 0$ is a valid value that allows for a non-trivial solution.\n\nCase 3: $\\lambda  0$\nLet $\\lambda = -k^2$ for some $k > 0$. The differential equation becomes $y''(x) - k^2 y(x) = 0$. The general solution is:\n$$y(x) = C_1 \\cosh(kx) + C_2 \\sinh(kx)$$\nThe derivative is:\n$$y'(x) = C_1 k \\sinh(kx) + C_2 k \\cosh(kx)$$\nApplying the boundary conditions $y(0) = y(L)$ and $y'(0) = y'(L)$ leads to a system of equations for $C_1$ and $C_2$. For a non-trivial solution, the determinant of the coefficient matrix must be zero, which leads to:\n$$(1-\\cosh(kL))^2 - \\sinh^2(kL) = 0$$\n$$1 - 2\\cosh(kL) + \\cosh^2(kL) - \\sinh^2(kL) = 0$$\nUsing the identity $\\cosh^2(kL) - \\sinh^2(kL) = 1$:\n$$1 - 2\\cosh(kL) + 1 = 0$$\n$$2 - 2\\cosh(kL) = 0$$\n$$\\cosh(kL) = 1$$\nSince $k > 0$ and $L > 0$, we have $kL > 0$. The function $\\cosh(x) = 1$ only when $x=0$. Therefore, there is no $k>0$ that satisfies this condition. This means the only solution is the trivial one where $C_1=C_2=0$. There are no non-trivial solutions for $\\lambda  0$.\n\nCombining the results:\nFrom Case 2, we have $\\lambda_0 = 0$.\nFrom Case 1, we have $\\lambda_n = \\left(\\frac{2n\\pi}{L}\\right)^2$ for $n=1, 2, 3, \\ldots$.\nWe can unify these two sets of results into a single expression by allowing the integer $n$ to be a non-negative integer, i.e., $n=0, 1, 2, \\ldots$. If we plug $n=0$ into the formula from Case 1, we get $\\lambda_0 = \\left(\\frac{2(0)\\pi}{L}\\right)^2 = 0$, which matches the result from Case 2.\nThus, all possible non-negative values of $\\lambda$ are given by:\n$$\\lambda_n = \\left(\\frac{2n\\pi}{L}\\right)^2, \\quad \\text{for } n=0, 1, 2, \\ldots$$\nThis corresponds to option C.", "answer": "$$\\boxed{C}$$", "id": "2124821"}, {"introduction": "Building on the concept of fundamental modes, this practice ([@problem_id:2111482]) demonstrates how they are used to solve time-dependent problems like heat diffusion. You will see how an arbitrary initial temperature distribution on a circular wire can be expressed as a sum of the simple sinusoidal modes you discovered previously. The power of this method, known as separation of variables or Fourier series expansion, is that each mode evolves independently, making the overall solution a straightforward superposition of these decaying patterns.", "problem": "A thin, thermally conductive circular wire forms a ring with a circumference of $2\\pi$ units. The wire is laterally insulated, so heat is only permitted to flow along its circumference. We can model the wire's length by an interval of length $2\\pi$. Let $x$ be the spatial coordinate that parameterizes the position on the wire, where $x$ can be taken to range from $-\\pi$ to $\\pi$. The temperature distribution in the wire, denoted by $u(x, t)$, is governed by the one-dimensional heat equation:\n$$\n\\frac{\\partial u}{\\partial t} = k \\frac{\\partial^2 u}{\\partial x^2}\n$$\nwhere $t$ represents time, and the thermal diffusivity of the material is given as $k=4$.\n\nAt the initial time $t=0$, the temperature distribution along the wire is given by the function:\n$$\nu(x, 0) = 5 + \\cos(2x) - 3\\sin(x)\n$$\nAssuming the wire forms a perfect, continuous circle, find the temperature distribution $u(x, t)$ for all times $t \\ge 0$. Express your answer as a single analytic function of $x$ and $t$.", "solution": "We model the circular wire as a one-dimensional domain with periodic boundary conditions of period $2\\pi$. The temperature $u(x,t)$ satisfies the heat equation\n$$\n\\frac{\\partial u}{\\partial t}=k\\frac{\\partial^2 u}{\\partial x^2}, \\quad k=4,\n$$\nwith initial condition\n$$\nu(x,0)=5+\\cos(2x)-3\\sin(x).\n$$\nOn a $2\\pi$-periodic domain, we use separation of variables by seeking eigenfunctions of the spatial operator $\\frac{\\partial^2}{\\partial x^2}$ that are $2\\pi$-periodic. The periodic eigenfunctions are $X_n(x)=\\cos(nx)$ and $X_n(x)=\\sin(nx)$ for integers $n\\ge 1$, with $X_0(x)=1$. For each $n\\ge 1$, substituting $u_n(x,t)=T_n(t)X_n(x)$ gives\n$$\n\\frac{T_n'(t)}{T_n(t)}=k\\frac{X_n''(x)}{X_n(x)}=-k n^2,\n$$\nsince $X_n''(x)=-n^2 X_n(x)$. Hence\n$$\nT_n(t)=C_n \\exp(-kn^2 t).\n$$\nFor the zero mode $X_0(x)=1$, we have $X_0''(x)=0$, so $T_0'(t)=0$ and thus the constant mode is time-independent.\n\nTherefore, the general $2\\pi$-periodic solution is a Fourier series with exponentially decaying modes:\n$$\nu(x,t)=\\frac{a_0}{2}+\\sum_{n=1}^{\\infty}\\left[a_n \\exp(-kn^2 t)\\cos(nx)+b_n \\exp(-kn^2 t)\\sin(nx)\\right].\n$$\nThe initial condition $u(x,0)=5+\\cos(2x)-3\\sin(x)$ identifies the Fourier coefficients directly:\n- The constant term gives $\\frac{a_0}{2}=5$.\n- The cosine term is only $\\cos(2x)$ with coefficient $a_2=1$, and $a_n=0$ for $n\\ne 2$.\n- The sine term is only $\\sin(x)$ with coefficient $b_1=-3$, and $b_n=0$ for $n\\ne 1$.\n\nWith $k=4$, the time dependence for the $\\cos(2x)$ mode is $\\exp(-k \\cdot 2^2 t)=\\exp(-16 t)$, and for the $\\sin(x)$ mode is $\\exp(-k \\cdot 1^2 t)=\\exp(-4 t)$.\n\nTherefore,\n$$\nu(x,t)=5+\\exp(-16 t)\\cos(2x)-3\\exp(-4 t)\\sin(x).\n$$\nThis satisfies the heat equation, is $2\\pi$-periodic, and matches the given initial condition at $t=0$.", "answer": "$$\\boxed{5+\\exp(-16 t)\\cos(2x)-3\\exp(-4 t)\\sin(x)}$$", "id": "2111482"}, {"introduction": "Periodic boundary conditions are a cornerstone of modern computational science, enabling the simulation of bulk materials by eliminating surface effects. However, their implementation requires care to avoid subtle but catastrophic errors. This hands-on coding challenge ([@problem_id:2426588]) directs you to explore the critical constraint that the interaction cutoff radius $r_{\\text{cut}}$ must be less than or equal to half the simulation box length, $L/2$. By implementing a naive algorithm that violates this rule, you will directly observe the 'self-interaction' artifact, a powerful lesson in the practical geometry of periodic simulations.", "problem": "You are to design and implement a small molecular simulation kernel that reveals how periodic boundary conditions can catastrophically fail when a short-range interaction cutoff exceeds half the simulation box. Work in three spatial dimensions with a cubic box of side length $L$ and periodic boundary conditions. All distances are to be treated in dimensionless reduced units, and the pair potential is the standard Lennard–Jones potential in reduced form with $\\epsilon=1$ and $\\sigma=1$.\n\nFundamental base. Consider $N$ point particles at positions $\\{\\mathbf{r}_i\\}_{i=1}^N$ in a cubic box of side length $L$ with periodic boundary conditions. The pairwise potential energy of a configuration is, in the absence of truncation,\n$$\nU = \\sum_{1 \\le i  j \\le N} u\\!\\left(r_{ij}\\right),\n$$\nwhere $r_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|$ is the Euclidean distance and $u(r)$ is a pair potential. With periodic boundary conditions, the physically meaningful separation between two particles is the shortest distance between one particle and any periodic image of the other. This is implemented by the minimum image convention, which maps a displacement $\\Delta \\mathbf{r}$ into the interval $(-L/2,L/2]$ component-wise:\n$$\n\\Delta \\mathbf{r} \\leftarrow \\Delta \\mathbf{r} - L \\cdot \\mathrm{round}\\!\\left(\\frac{\\Delta \\mathbf{r}}{L}\\right).\n$$\nA standard short-range cutoff truncates interactions at a radius $r_{\\text{cut}}$ by setting $u(r)=0$ for $r \\ge r_{\\text{cut}}$. The Lennard–Jones potential in reduced units is\n$$\nu_{\\mathrm{LJ}}(r) = 4\\left[\\left(\\frac{1}{r}\\right)^{12} - \\left(\\frac{1}{r}\\right)^6\\right],\n$$\nfor $0rr_{\\text{cut}}$, and $u_{\\mathrm{LJ}}(r)=0$ for $r \\ge r_{\\text{cut}}$. Note that $u_{\\mathrm{LJ}}(r)$ diverges as $r \\to 0^+$.\n\nPrinciple to be demonstrated. For a cubic box with the minimum image convention and pairwise summation over unique pairs, the condition $r_{\\text{cut}} \\le L/2$ guarantees that each interacting pair $(i,j)$ has at most one periodic image within the cutoff, so no self-image interaction can occur. If one attempts to use $r_{\\text{cut}}  L/2$ by explicitly tiling the simulation box with periodic images and then applies the minimum image convention to separations, a catastrophic error can emerge: a particle can be paired with one of its own images, and the minimum image mapping collapses that displacement to zero, yielding $r=0$ and thus an infinite $u_{\\mathrm{LJ}}(r)$. You must make this mechanism explicit in code and quantify when it occurs.\n\nYour tasks.\n\n1) Implement a function that computes the total Lennard–Jones energy $U_{\\text{correct}}$ using the minimum image convention and unique pairs $ij$ in the primary box only, with truncation at $r_{\\text{cut}}$. This is correct under the requirement $r_{\\text{cut}} \\le L/2$.\n\n2) Implement a second function that attempts to handle $r_{\\text{cut}}  L/2$ by tiling the box with periodic images indexed by integer shifts $(n_x,n_y,n_z) \\in \\{-1,0,1\\}^3$, computing interactions between particles in the primary box and all images (including the primary), applying the minimum image convention to each separation, and summing contributions within $r_{\\text{cut}}$. Do not exclude interactions between a particle and its own images for nonzero shifts; only skip the trivial case of a particle with itself in the primary cell. This naive algorithm is expected to catastrophically include zero-separation pairs when $r_{\\text{cut}}  L/2$, because for a particle $i$, a periodic image at shift $(1,0,0)$ yields a displacement $\\Delta \\mathbf{r} = \\mathbf{r}_i - (\\mathbf{r}_i + L\\hat{\\mathbf{x}}) = -L\\hat{\\mathbf{x}}$, which the minimum image convention maps to $\\mathbf{0}$, and similarly for other coordinate directions.\n\n3) Define a self-interaction error indicator $S$ for a given configuration and cutoff as follows: compute $U_{\\text{naive}}$ with the naive tiling algorithm described above if $r_{\\text{cut}}  L/2$, and otherwise use the correct $U_{\\text{correct}}$. Set $S$ to `True` if either $U_{\\text{naive}}$ is not finite (for example, $+\\infty$ or $\\mathrm{NaN}$), or if, during the naive computation, any pair separation with magnitude strictly less than a small tolerance $r_{\\text{tol}}$ was considered. Use $r_{\\text{tol}} = 10^{-12}$ in reduced units. Set $S$ to `False` otherwise.\n\n4) Use the following test suite, where each case specifies $L$, $N$, particle positions in reduced units, and $r_{\\text{cut}}$ as a fraction of $L$:\n\n- Case A (happy path, no self-interaction): $L=1.0$, $N=2$, positions $\\left[\\,[0.1,0.2,0.3],[0.9,0.2,0.3]\\,\\right]$, $r_{\\text{cut}} = 0.49L$.\n- Case B (boundary condition, still safe): $L=1.0$, $N=3$, positions $\\left[\\,[0.1,0.2,0.3],[0.6,0.7,0.8],[0.55,0.2,0.8]\\,\\right]$, $r_{\\text{cut}} = 0.50L$.\n- Case C (catastrophic with a single particle): $L=1.0$, $N=1$, positions $\\left[\\,[0.12,0.23,0.34]\\,\\right]$, $r_{\\text{cut}} = 0.60L$.\n- Case D (catastrophic with a near-boundary pair): $L=1.0$, $N=2$, positions $\\left[\\,[0.1,0.2,0.3],[0.9,0.2,0.3]\\,\\right]$, $r_{\\text{cut}} = 0.60L$.\n\nAll positions are given in reduced unit fractions of $L$. For each case, compute the boolean $S$ as defined above.\n\nAngle units do not apply. There are no physical units beyond the reduced Lennard–Jones units; report the boolean outcomes without units.\n\nFinal output format. Your program should produce a single line of output containing the four boolean results for Cases A–D, in order, as a comma-separated list enclosed in square brackets, for example, \"[True,False,True,False]\".", "solution": "We begin from the physical definitions of periodic boundary conditions and pairwise additive energies. For particles at positions $\\{\\mathbf{r}_i\\}$ in a cubic box of side $L$ with periodic boundary conditions, a displacement $\\Delta \\mathbf{r}$ between two particles is not unique because of the infinite set of periodic images. The minimum image convention enforces that the representative displacement used for dynamics and energy lies in the fundamental domain $(-L/2,L/2]$ in each component:\n$$\n\\Delta \\mathbf{r} \\leftarrow \\Delta \\mathbf{r} - L \\cdot \\mathrm{round}\\!\\left(\\frac{\\Delta \\mathbf{r}}{L}\\right).\n$$\nThis mapping ensures that the norm $r=\\|\\Delta \\mathbf{r}\\|$ is the shortest distance between one particle and any image of the other. For short-range interactions, we truncate at a cutoff $r_{\\text{cut}}$ and compute\n$$\nU_{\\text{trunc}} = \\sum_{1 \\le i  j \\le N} u(r_{ij}) \\,\\Theta(r_{\\text{cut}}-r_{ij}),\n$$\nwith the Heaviside step function $\\Theta$ and $u(r)$ the Lennard–Jones potential $u_{\\mathrm{LJ}}(r) = 4[(1/r)^{12} - (1/r)^6]$. The divergence as $r \\to 0^+$ is a fundamental property of the Lennard–Jones repulsive core.\n\nThe key geometric fact is that, in a cubic box, if $r_{\\text{cut}} \\le L/2$, then for any pair $(i,j)$ there is at most one periodic image of $j$ within distance $r_{\\text{cut}}$ of $i$. To see this, suppose two distinct images of particle $j$ are within $r_{\\text{cut}}$ of $i$. Then the displacement between those two images is a lattice vector $\\mathbf{n} L$ with $\\mathbf{n} \\in \\mathbb{Z}^3 \\setminus \\{\\mathbf{0}\\}$ whose magnitude is at most $2 r_{\\text{cut}}$. If $r_{\\text{cut}} \\le L/2$, then $2 r_{\\text{cut}} \\le L$, which is incompatible with any nonzero lattice vector in a cubic lattice, since the smallest nonzero lattice vector has magnitude $L$. Therefore, no pair can be counted twice, and the minimum image convention over $ij$ is sufficient and unambiguous.\n\nHowever, if one naively tries to extend a short-range algorithm to the case $r_{\\text{cut}}  L/2$ by explicitly tiling the simulation cell with images (for example, the $3\\times 3 \\times 3$ block of shifts $\\mathbf{n} \\in \\{-1,0,1\\}^3$), computing separations to all these images, and then applying the minimum image convention before the cutoff test, a catastrophic failure appears: for a given particle $i$, consider its image at shift $\\mathbf{n}=(1,0,0)$. The unwrapped displacement is $\\Delta \\mathbf{r} = \\mathbf{r}_i - (\\mathbf{r}_i + L \\hat{\\mathbf{x}}) = -L \\hat{\\mathbf{x}}$. Applying the minimum image mapping yields\n$$\n\\Delta \\mathbf{r}' = -L \\hat{\\mathbf{x}} - L \\cdot \\mathrm{round}(-1) \\hat{\\mathbf{x}} = \\mathbf{0}.\n$$\nHence the algorithm produces a pair with separation $r=0$, which, under $u_{\\mathrm{LJ}}(r)$, contributes an infinite energy. The same holds for shifts along $\\hat{\\mathbf{y}}$ and $\\hat{\\mathbf{z}}$, and for combinations thereof. While a careful implementation would explicitly exclude interactions between a particle and any of its images (that is, identify the underlying identity of particles across images), the naive tiling scheme described fails to do so, and the minimum image convention collapses image separations to zero.\n\nAlgorithmic design:\n\n1) Correct energy for $r_{\\text{cut}} \\le L/2$. Loop over unique pairs $ij$. For each pair, compute the raw displacement $\\Delta \\mathbf{r} = \\mathbf{r}_i - \\mathbf{r}_j$, apply the minimum image mapping component-wise, compute $r=\\|\\Delta \\mathbf{r}\\|$, and, if $0rr_{\\text{cut}}$, add $u_{\\mathrm{LJ}}(r)$ to the energy. Skip $r=0$ by construction because $i \\ne j$.\n\n2) Naive energy for $r_{\\text{cut}}  L/2$. Loop over particles $i$ in the primary box, over all particles $j$ in the primary box, and over all shifts $\\mathbf{n} \\in \\{-1,0,1\\}^3$. Skip only the trivial case $\\mathbf{n}=\\mathbf{0}$ with $i=j$ to avoid double-counting the exact same particle in the same cell; otherwise consider the pair. For each triplet $(i,j,\\mathbf{n})$, compute the unwrapped displacement $\\Delta \\mathbf{r} = \\mathbf{r}_i - (\\mathbf{r}_j + L \\mathbf{n})$, apply the minimum image mapping, compute $r=\\|\\Delta \\mathbf{r}\\|$, and include the contribution if $rr_{\\text{cut}}$. Record whether any $r$ falls below a small tolerance $r_{\\text{tol}}=10^{-12}$; encountering such a case implies a self-image pair collapsing to zero separation. The Lennard–Jones $u_{\\mathrm{LJ}}(r)$ at $r=0$ is divergent, so the total energy becomes non-finite.\n\n3) Self-interaction flag. Define $S$ as `True` if, in the naive computation path activated by $r_{\\text{cut}}  L/2$, either a separation $rr_{\\text{tol}}$ was encountered or the total energy is not finite. Otherwise set $S$ to `False`. For $r_{\\text{cut}} \\le L/2$, the algorithm uses only the correct method and sets $S$ to `False` by definition.\n\nTest suite analysis:\n\n- Case A: $L=1.0$, $N=2$, positions $[ [0.1,0.2,0.3], [0.9,0.2,0.3] ]$, $r_{\\text{cut}}=0.49 L$. The minimum image separation is along $\\hat{\\mathbf{x}}$ with magnitude $0.2$, which is less than $0.49$. The correct energy is finite. The naive algorithm is not activated (since $r_{\\text{cut}} \\le L/2$), so $S$ is `False`.\n\n- Case B: $L=1.0$, $N=3$, positions $[ [0.1,0.2,0.3],[0.6,0.7,0.8],[0.55,0.2,0.8] ]$, $r_{\\text{cut}}=0.50 L$. This is the boundary case. The correct method applies, and no naive tiling is performed; there is no mechanism for a self-image collapse. Therefore $S$ is `False`.\n\n- Case C: $L=1.0$, $N=1$, position $[0.12,0.23,0.34]$, $r_{\\text{cut}}=0.60 L$. The naive tiling algorithm is activated. When $j=i$ and shift $\\mathbf{n}=(1,0,0)$ (or other nonzero shifts), the minimum image convention maps the unwrapped displacement to zero, resulting in $r=0$ and a divergent Lennard–Jones term. The energy is non-finite and/or a zero separation is detected, so $S$ is `True`.\n\n- Case D: $L=1.0$, $N=2$, positions $[ [0.1,0.2,0.3], [0.9,0.2,0.3] ]$, $r_{\\text{cut}}=0.60 L$. The naive tiling algorithm is activated. In addition to the finite interaction between the two distinct particles, the algorithm generates self-image pairs for each particle, which collapse to $r=0$ after the minimum image mapping. The energy becomes non-finite or a zero separation is detected. Hence $S$ is `True`.\n\nThe program thus computes the boolean flags for $[S_A,S_B,S_C,S_D]$ and prints them on a single line as a list in the prescribed format.", "answer": "```python\nimport numpy as np\n\ndef minimum_image(displacement, box_length):\n    # Apply minimum image convention component-wise\n    return displacement - box_length * np.round(displacement / box_length)\n\ndef lj_energy_truncated(r, rcut):\n    # Lennard-Jones reduced potential with truncation at rcut\n    # u(r) = 4*((1/r)^12 - (1/r)^6) for 0  r  rcut; 0 otherwise\n    if r = 0.0:\n        return np.inf\n    if r = rcut:\n        return 0.0\n    inv_r = 1.0 / r\n    inv_r6 = inv_r ** 6\n    inv_r12 = inv_r6 ** 2\n    return 4.0 * (inv_r12 - inv_r6)\n\ndef energy_correct(positions, L, rcut):\n    # Correct energy for rcut = L/2 using unique pairs and MIC\n    N = positions.shape[0]\n    E = 0.0\n    for i in range(N - 1):\n        for j in range(i + 1, N):\n            dr = positions[i] - positions[j]\n            dr = minimum_image(dr, L)\n            r = np.linalg.norm(dr)\n            if 0.0  r  rcut:\n                E += lj_energy_truncated(r, rcut)\n    return E\n\ndef energy_naive_tiling(positions, L, rcut, rtol=1e-12):\n    # Naive energy using 3x3x3 tiling and MIC; includes self-image interactions\n    N = positions.shape[0]\n    shifts = [-1, 0, 1]\n    E = 0.0\n    zero_sep_detected = False\n    for i in range(N):\n        ri = positions[i]\n        for j in range(N):\n            rj = positions[j]\n            for nx in shifts:\n                for ny in shifts:\n                    for nz in shifts:\n                        if nx == 0 and ny == 0 and nz == 0 and i == j:\n                            # Skip trivial self in the same cell only\n                            continue\n                        img = np.array([nx, ny, nz], dtype=float)\n                        dr = ri - (rj + L * img)\n                        dr = minimum_image(dr, L)\n                        r = np.linalg.norm(dr)\n                        if r  rtol:\n                            zero_sep_detected = True\n                        if r  rcut:\n                            E_term = lj_energy_truncated(r, rcut)\n                            E += E_term\n                            # Early detection of non-finite accumulation\n                            if not np.isfinite(E_term):\n                                return E, True\n    return E, zero_sep_detected or (not np.isfinite(E))\n\ndef self_interaction_flag(positions, L, rcut_frac):\n    rcut = rcut_frac * L\n    if rcut = 0.5 * L:\n        # Safe path: use correct method only; no naive tiling\n        _ = energy_correct(positions, L, rcut)\n        return False\n    else:\n        # Activate naive tiling to demonstrate potential catastrophe\n        E_naive, bad = energy_naive_tiling(positions, L, rcut, rtol=1e-12)\n        if bad or (not np.isfinite(E_naive)):\n            return True\n        return False\n\ndef solve():\n    # Define the test cases: (L, positions_array, rcut_fraction)\n    test_cases = [\n        # Case A: L=1.0, N=2, positions [[0.1,0.2,0.3],[0.9,0.2,0.3]], rcut=0.49L\n        (1.0, np.array([[0.1, 0.2, 0.3],\n                        [0.9, 0.2, 0.3]], dtype=float), 0.49),\n        # Case B: L=1.0, N=3, positions [[0.1,0.2,0.3],[0.6,0.7,0.8],[0.55,0.2,0.8]], rcut=0.50L\n        (1.0, np.array([[0.1, 0.2, 0.3],\n                        [0.6, 0.7, 0.8],\n                        [0.55, 0.2, 0.8]], dtype=float), 0.50),\n        # Case C: L=1.0, N=1, positions [[0.12,0.23,0.34]], rcut=0.60L\n        (1.0, np.array([[0.12, 0.23, 0.34]], dtype=float), 0.60),\n        # Case D: L=1.0, N=2, positions [[0.1,0.2,0.3],[0.9,0.2,0.3]], rcut=0.60L\n        (1.0, np.array([[0.1, 0.2, 0.3],\n                        [0.9, 0.2, 0.3]], dtype=float), 0.60),\n    ]\n\n    results = []\n    for L, positions, rcut_frac in test_cases:\n        flag = self_interaction_flag(positions, L, rcut_frac)\n        results.append(flag)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2426588"}]}