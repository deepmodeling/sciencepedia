{"hands_on_practices": [{"introduction": "Theoretical bounds in number theory can often feel abstract. A powerful way to build intuition is to compute concrete examples for small parameters. This exercise guides you through the process of calculating the exact maximum values of partial character sums for all nonprincipal characters modulo $q \\le 8$, providing a tangible dataset to compare against the predictions of general inequalities like Pólya-Vinogradov [@problem_id:3009715].", "problem": "Let $q$ be a positive integer with $2 \\leq q \\leq 8$. A Dirichlet character modulo $q$ is a function $\\chi : \\mathbb{Z} \\to \\mathbb{C}$ that is completely multiplicative, is periodic with period $q$, and satisfies $\\chi(n) = 0$ if $\\gcd(n,q)  1$, while its restriction to the group of units modulo $q$, denoted $(\\mathbb{Z}/q\\mathbb{Z})^{\\times}$, is a group homomorphism into the complex unit circle. The principal character $\\chi_{0}$ modulo $q$ is the character defined by $\\chi_{0}(n) = 1$ for $\\gcd(n,q) = 1$ and $\\chi_{0}(n) = 0$ otherwise. For a given character $\\chi$ modulo $q$, define the partial sum\n$$\nS_{\\chi}(x) \\;=\\; \\sum_{n \\leq x} \\chi(n).\n$$\nIn this problem, restrict attention to nonprincipal characters modulo $q$. Starting only from these definitions and standard properties of finite abelian groups, do the following:\n- Establish that for any nonprincipal Dirichlet character modulo $q$, the sum over one complete period satisfies $\\sum_{n=1}^{q} \\chi(n) = 0$, and deduce that the supremum over real $x \\geq 0$ of $|S_{\\chi}(x)|$ is attained by a partial sum inside a single period of length $q$.\n- For each modulus $q \\in \\{3,4,5,6,7,8\\}$, enumerate all nonprincipal characters modulo $q$ and compute, for each such $\\chi$, the exact sequence $\\{\\chi(1), \\chi(2), \\dots, \\chi(q)\\}$ and all partial sums $\\sum_{n=1}^{t} \\chi(n)$ for $t \\in \\{0,1,\\dots,q\\}$. From these, determine the exact value of $\\sup_{x \\geq 0} |S_{\\chi}(x)|$ for each $\\chi$.\n- Define the extremal quantity\n$$\nM \\;=\\; \\max_{\\substack{q \\in \\{3,4,5,6,7,8\\} \\\\ \\chi \\bmod q \\text{ nonprincipal}}} \\;\\sup_{x \\geq 0} |S_{\\chi}(x)|.\n$$\nCompute the exact value of $M$.\n- Briefly compare the computed values with widely used general bounds for character sums that are known from analytic number theory (for example, the Pólya–Vinogradov inequality), and comment on whether the small-modulus computations suggest sharpness of the general order of magnitude.\n\nProvide the final result as the exact value of $M$ with no rounding.", "solution": "The posed problem is a well-defined exercise in elementary analytic number theory. It is scientifically sound, self-contained, and all terms used are standard in the field. The problem is valid and can be solved as stated.\n\nThe first step is to establish the theoretical properties of the character sum $S_{\\chi}(x) = \\sum_{n \\leq x} \\chi(n)$ for a nonprincipal Dirichlet character $\\chi$ modulo $q$.\n\nFirst, we prove that the sum of a nonprincipal character $\\chi$ over a complete period is zero. Let $S = \\sum_{n=1}^{q} \\chi(n)$. Since $\\chi$ is a nonprincipal character, there exists an integer $a$ such that $\\gcd(a, q) = 1$ and $\\chi(a) \\neq 1$. We multiply the sum $S$ by $\\chi(a)$:\n$$\n\\chi(a) S = \\chi(a) \\sum_{n=1}^{q} \\chi(n) = \\sum_{n=1}^{q} \\chi(a)\\chi(n)\n$$\nBy complete multiplicativity, $\\chi(a)\\chi(n) = \\chi(an)$. Thus,\n$$\n\\chi(a) S = \\sum_{n=1}^{q} \\chi(an)\n$$\nAs $n$ runs through a complete set of residues modulo $q$, and since $\\gcd(a,q)=1$, the product $an$ also runs through a complete set of residues modulo $q$. Therefore, the sum on the right-hand side is simply a rearrangement of the terms in the original sum $S$.\n$$\n\\sum_{n=1}^{q} \\chi(an) = \\sum_{m=1}^{q} \\chi(m) = S\n$$\nThis leads to the equation $\\chi(a) S = S$, or $(\\chi(a) - 1)S = 0$. Since we chose $a$ such that $\\chi(a) \\neq 1$, the factor $(\\chi(a) - 1)$ is non-zero. Consequently, we must have $S = 0$. So, $\\sum_{n=1}^{q} \\chi(n) = 0$.\n\nNext, we use this result to bound the partial sums $S_{\\chi}(x)$. Let $x$ be any non-negative real number, and let $N = \\lfloor x \\rfloor$ be the integer part of $x$. Then $S_{\\chi}(x) = S_{\\chi}(N) = \\sum_{n=1}^{N} \\chi(n)$. We can write $N$ as $N = kq + t$, where $k = \\lfloor N/q \\rfloor$ is a non-negative integer and $t \\in \\{0, 1, \\dots, q-1\\}$. The sum can be split as:\n$$\nS_{\\chi}(N) = \\sum_{n=1}^{kq+t} \\chi(n) = \\left( \\sum_{j=0}^{k-1} \\sum_{m=1}^{q} \\chi(jq+m) \\right) + \\sum_{m=1}^{t} \\chi(kq+m)\n$$\nBy the $q$-periodicity of $\\chi$, we have $\\chi(jq+m) = \\chi(m)$. Applying this, the sum becomes:\n$$\nS_{\\chi}(N) = \\sum_{j=0}^{k-1} \\left( \\sum_{m=1}^{q} \\chi(m) \\right) + \\sum_{m=1}^{t} \\chi(m)\n$$\nSince $\\sum_{m=1}^{q} \\chi(m) = 0$, the first term vanishes:\n$$\nS_{\\chi}(N) = k \\cdot 0 + \\sum_{m=1}^{t} \\chi(m) = \\sum_{m=1}^{t} \\chi(m) = S_{\\chi}(t)\n$$\nThis shows that the value of any partial sum $S_{\\chi}(x)$ is equal to a partial sum $S_{\\chi}(t)$ where $t = \\lfloor x \\rfloor \\pmod q$. The set of all possible values of $S_{\\chi}(x)$ is therefore $\\{S_{\\chi}(0), S_{\\chi}(1), \\dots, S_{\\chi}(q-1)\\}$. We also note $S_{\\chi}(0)=0$ and $S_{\\chi}(q)=0$. Therefore, the supremum of the absolute value of the sum is given by the maximum over the first period:\n$$\n\\sup_{x \\geq 0} |S_{\\chi}(x)| = \\max_{0 \\leq t  q} \\left| \\sum_{n=1}^{t} \\chi(n) \\right|\n$$\n\nNow we perform the explicit computations for each modulus $q \\in \\{3,4,5,6,7,8\\}$.\n\nFor $q=3$: The group $(\\mathbb{Z}/3\\mathbb{Z})^{\\times} = \\{1, 2\\}$ is cyclic of order $2$. There is one nonprincipal character $\\chi$, determined by $\\chi(2)=-1$.\nThe values are $\\{\\chi(1), \\chi(2), \\chi(3)\\} = \\{1, -1, 0\\}$.\nThe partial sums $S_{\\chi}(t) = \\sum_{n=1}^t \\chi(n)$ for $t \\in \\{0,1,2,3\\}$ are:\n$S_{\\chi}(0)=0$, $S_{\\chi}(1)=1$, $S_{\\chi}(2)=1-1=0$, $S_{\\chi}(3)=0$.\nThe maximum absolute value is $\\sup_{x \\geq 0} |S_{\\chi}(x)| = 1$.\n\nFor $q=4$: The group $(\\mathbb{Z}/4\\mathbb{Z})^{\\times} = \\{1, 3\\}$ is cyclic of order $2$. There is one nonprincipal character $\\chi$, determined by $\\chi(3)=-1$.\nThe values are $\\{\\chi(1), \\chi(2), \\chi(3), \\chi(4)\\} = \\{1, 0, -1, 0\\}$.\nThe partial sums for $t \\in \\{0,1,2,3,4\\}$ are:\n$S_{\\chi}(0)=0$, $S_{\\chi}(1)=1$, $S_{\\chi}(2)=1+0=1$, $S_{\\chi}(3)=1+0-1=0$, $S_{\\chi}(4)=0$.\nThe maximum absolute value is $\\sup_{x \\geq 0} |S_{\\chi}(x)| = 1$.\n\nFor $q=5$: The group $(\\mathbb{Z}/5\\mathbb{Z})^{\\times} = \\{1, 2, 3, 4\\}$ is cyclic of order $4$, with generator $2$. The characters are determined by $\\chi(2) = \\omega$, where $\\omega^4=1$. The nonprincipal characters correspond to $\\omega \\in \\{i, -1, -i\\}$.\nCase 1: $\\chi_1(2)=i$. The values are $\\{\\chi_1(1), \\dots, \\chi_1(5)\\} = \\{1, i, -i, -1, 0\\}$.\nThe partial sums are: $S_{\\chi_1}(0)=0$, $S_{\\chi_1}(1)=1$, $S_{\\chi_1}(2)=1+i$, $S_{\\chi_1}(3)=1+i-i=1$, $S_{\\chi_1}(4)=1-1=0$, $S_{\\chi_1}(5)=0$.\nThe absolute values are $\\{0, 1, |1+i|=\\sqrt{2}, 1, 0, 0\\}$. The maximum is $\\sqrt{2}$. For $\\chi_3 = \\overline{\\chi_1}$ (with $\\chi_3(2)=-i$), the absolute values of the sums are identical, so the maximum is also $\\sqrt{2}$.\nCase 2: $\\chi_2(2)=-1$. The values are $\\{1, -1, -1, 1, 0\\}$.\nThe partial sums are: $S_{\\chi_2}(0)=0$, $S_{\\chi_2}(1)=1$, $S_{\\chi_2}(2)=1-1=0$, $S_{\\chi_2}(3)=0-1=-1$, $S_{\\chi_2}(4)=-1+1=0$, $S_{\\chi_2}(5)=0$.\nThe absolute values are $\\{0, 1, 0, 1, 0, 0\\}$. The maximum is $1$.\nThe maximum over all nonprincipal characters modulo $5$ is $\\sqrt{2}$.\n\nFor $q=6$: The group $(\\mathbb{Z}/6\\mathbb{Z})^{\\times} = \\{1, 5\\}$ is cyclic of order $2$. There is one nonprincipal character $\\chi$, determined by $\\chi(5)=-1$.\nThe values are $\\{\\chi(1), \\dots, \\chi(6)\\} = \\{1, 0, 0, 0, -1, 0\\}$.\nThe partial sums are: $S_{\\chi}(0)=0$, $S_{\\chi}(1)=1$, $S_{\\chi}(2)=1$, $S_{\\chi}(3)=1$, $S_{\\chi}(4)=1$, $S_{\\chi}(5)=1-1=0$, $S_{\\chi}(6)=0$.\nThe maximum absolute value is $1$.\n\nFor $q=7$: The group $(\\mathbb{Z}/7\\mathbb{Z})^{\\times}$ is cyclic of order $6$, with generator $3$. Characters are determined by $\\chi(3)=\\omega$ where $\\omega^6=1$. There are $5$ nonprincipal characters. Let $\\omega_6 = e^{i\\pi/3}$. We check the cases $\\omega = \\omega_6^k$ for $k=1,2,3$. Characters for $k=4,5$ are conjugates of $k=2,1$ and yield the same maximums.\nThe indices base $3$ are: $\\text{ind}_3(1)=0$, $\\text{ind}_3(2)=2$, $\\text{ind}_3(3)=1$, $\\text{ind}_3(4)=4$, $\\text{ind}_3(5)=5$, $\\text{ind}_3(6)=3$.\nCase 1: $\\chi_1(3)=\\omega_6 = e^{i\\pi/3}$. The values are $\\{\\chi_1(n)\\}_{n=1}^7 = \\{1, \\omega_6^2, \\omega_6, \\omega_6^4, \\omega_6^5, \\omega_6^3, 0\\}$.\nThe partial sums are: $S_{\\chi_1}(0)=0, S_{\\chi_1}(1)=1, S_{\\chi_1}(2)=1+\\omega_6^2=\\omega_6, S_{\\chi_1}(3)=\\omega_6+\\omega_6=2\\omega_6, S_{\\chi_1}(4)=2\\omega_6+\\omega_6^4=\\omega_6, S_{\\chi_1}(5)=\\omega_6+\\omega_6^5=1, S_{\\chi_1}(6)=1+\\omega_6^3=0, S_{\\chi_1}(7)=0$.\nThe absolute values are $\\{0, 1, |\\omega_6|=1, |2\\omega_6|=2, |\\omega_6|=1, 1, 0, 0\\}$. The maximum is $2$.\nCase 2: $\\chi_2(3)=\\omega_6^2 = e^{i2\\pi/3}$. The values are $\\{1, \\omega_6^4, \\omega_6^2, \\omega_6^8=\\omega_6^2, \\omega_6^{10}=\\omega_6^4, \\omega_6^6=1, 0\\}$.\nThe partial sums give a maximum absolute value of $1$.\nCase 3: $\\chi_3(3)=\\omega_6^3 = -1$. This is the Legendre symbol $(\\frac{n}{7})$. The values are $\\{1, 1, -1, 1, -1, -1, 0\\}$.\nThe partial sums are: $S_{\\chi_3}(0)=0, S_{\\chi_3}(1)=1, S_{\\chi_3}(2)=2, S_{\\chi_3}(3)=1, S_{\\chi_3}(4)=2, S_{\\chi_3}(5)=1, S_{\\chi_3}(6)=0, S_{\\chi_3}(7)=0$.\nThe maximum absolute value is $2$.\nThe maximum over all nonprincipal characters modulo $7$ is $2$.\n\nFor $q=8$: The group $(\\mathbb{Z}/8\\mathbb{Z})^{\\times} = \\{1, 3, 5, 7\\}$ is a Klein four-group ($C_2 \\times C_2$). Characters are determined by their values on generators $3$ and $5$, say $\\chi(3)=\\epsilon_1, \\chi(5)=\\epsilon_2$ where $\\epsilon_1, \\epsilon_2 \\in \\{1, -1\\}$. This gives $3$ nonprincipal characters.\nCase 1: $\\chi_1(3)=-1, \\chi_1(5)=1$. The values are $\\{\\chi_1(n)\\}_{n=1}^8 = \\{1, 0, -1, 0, 1, 0, -1, 0\\}$.\nThe partial sums are $\\{0, 1, 1, 0, 0, 1, 1, 0, 0\\}$. The maximum absolute value is $1$.\nCase 2: $\\chi_2(3)=1, \\chi_2(5)=-1$. The values are $\\{1, 0, 1, 0, -1, 0, -1, 0\\}$.\nThe partial sums are $\\{0, 1, 1, 2, 2, 1, 1, 0, 0\\}$. The maximum absolute value is $2$.\nCase 3: $\\chi_3(3)=-1, \\chi_3(5)=-1$. The values are $\\{1, 0, -1, 0, -1, 0, 1, 0\\}$.\nThe partial sums are $\\{0, 1, 1, 0, 0, -1, -1, 0, 0\\}$. The maximum absolute value is $1$.\nThe maximum over all nonprincipal characters modulo $8$ is $2$.\n\nSummary of maximums:\nFor $q=3$: max $|S|=1$.\nFor $q=4$: max $|S|=1$.\nFor $q=5$: max $|S|=\\sqrt{2}$.\nFor $q=6$: max $|S|=1$.\nFor $q=7$: max $|S|=2$.\nFor $q=8$: max $|S|=2$.\n\nThe extremal quantity $M$ is the maximum of these values:\n$$\nM = \\max\\{1, 1, \\sqrt{2}, 1, 2, 2\\} = 2\n$$\n\nFinally, we compare these results with general bounds such as the Pólya–Vinogradov inequality, which states $|S_{\\chi}(x)| \\le C \\sqrt{q} \\log q$ for some constant $C$. For our values:\n- $q=3$: $2  1$.\n- $q=4$: $2  1$.\n- $q=5$: $\\sqrt{2} \\approx 1.414  \\sqrt{5}\\log 5 \\approx 3.60$.\n- $q=7$: $2  \\sqrt{7}\\log 7 \\approx 5.15$.\n- $q=8$: $2  \\sqrt{8}\\log 8 \\approx 5.88$.\nThe bound holds in all cases. The phrase \"suggest sharpness\" concerns the order of magnitude. The computed maximums are $1, 1, \\sqrt{2}, 1, 2, 2$. The term $\\sqrt{q}$ grows as approximately $1.73, 2, 2.24, 2.45, 2.65, 2.83$. The observed values grow much more slowly than the $\\sqrt{q}\\log q$ bound. For instance, the ratio of the computed maximum to $\\sqrt{q}$ is $1/\\sqrt{3} \\approx 0.58$ for $q=3$, $\\sqrt{2}/\\sqrt{5} \\approx 0.63$ for $q=5$, $2/\\sqrt{7} \\approx 0.76$ for $q=7$, and $2/\\sqrt{8} \\approx 0.71$ for $q=8$. This ratio is not growing like $\\log q$.\nThese computations for small $q$ do not suggest that the order of magnitude $O(\\sqrt{q}\\log q)$ is sharp. In fact, they are more consistent with the conjectural bound of $O(\\sqrt{q} \\log \\log q)$ or even a simpler $O(\\sqrt{q})$ bound, as the logarithmic term does not appear to manifest for these small moduli. The $\\log q$ factor in the Pólya-Vinogradov inequality is widely believed to be an artifact of the proof methods, and not representative of the true maximal size of character sums.", "answer": "$$\n\\boxed{2}\n$$", "id": "3009715"}, {"introduction": "The cancellation observed in character sums over consecutive integers is not a universal phenomenon. This exercise explores a contrasting scenario where constructive interference leads to exceptionally large sums. By summing a character over a multiplicative progression, you will see how the \"phase clustering\" of character values can largely defeat cancellation, providing critical insight into why bounds like Pólya-Vinogradov are specifically for sums over arithmetic progressions [@problem_id:3009661].", "problem": "Let $q$ be an odd prime and let $G = (\\mathbb{Z}/q\\mathbb{Z})^{\\times}$ denote the multiplicative group modulo $q$, which is cyclic of order $q-1$. Fix a generator $g$ of $G$. Define a Dirichlet character $\\chi$ modulo $q$ by specifying its value on $g$ as $\\chi(g) = \\exp\\!\\big(2\\pi i/(q-1)\\big)$ and extending multiplicatively on $G$, with $\\chi(0)=0$. This $\\chi$ is primitive and has exact order $q-1$. For an integer $K$ with $1 \\leq K \\leq \\left\\lfloor \\frac{q-1}{2} \\right\\rfloor$, consider the multiplicative progression $n_{k} \\equiv g^{k} \\pmod{q}$ for $1 \\leq k \\leq K$ and the associated partial sum\n$$\nS_{K} \\;=\\; \\sum_{k=1}^{K} \\chi(n_{k}).\n$$\nStarting only from the definitions of Dirichlet characters and the cyclic structure of $G$, derive an exact closed-form expression for the real-valued magnitude $|S_{K}|$ in terms of $q$ and $K$, using only foundational facts such as the sum of a finite geometric series and basic trigonometric identities. Explain briefly why the chosen progression exhibits phase clustering of $\\chi(n_{k})$ and why the resulting size of $|S_{K}|$ does not contradict upper bounds for character sums over consecutive integers, such as the Pólya–Vinogradov inequality. Your final answer should be the exact closed-form expression for $|S_{K}|$ as a function of $q$ and $K$. No rounding is required.", "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the principles of number theory, well-posed with sufficient and consistent information, and objectively formulated.\n\nThe problem asks for an exact closed-form expression for the magnitude of the partial character sum $S_K = \\sum_{k=1}^{K} \\chi(n_k)$, where $n_k \\equiv g^k \\pmod{q}$.\n\nFirst, we express the terms of the sum using the definition of the Dirichlet character $\\chi$. The character $\\chi$ is defined on the generator $g$ of $G = (\\mathbb{Z}/q\\mathbb{Z})^{\\times}$ as $\\chi(g) = \\exp(2\\pi i / (q-1))$. Since $\\chi$ is a multiplicative homomorphism, its value on an element $n_k = g^k$ is given by:\n$$\n\\chi(n_k) = \\chi(g^k) = (\\chi(g))^k\n$$\nLet us denote the complex number $r = \\chi(g) = \\exp(2\\pi i / (q-1))$. The sum $S_K$ can now be written as:\n$$\nS_K = \\sum_{k=1}^{K} r^k\n$$\nThis is a finite geometric series with first term $r$, common ratio $r$, and $K$ terms. Since $q$ is an odd prime, $q \\ge 3$, which implies $q-1 \\ge 2$. Therefore, the common ratio $r = \\exp(2\\pi i / (q-1))$ is a root of unity but is not equal to $1$. The sum of this geometric series is given by the standard formula:\n$$\nS_K = r \\frac{1 - r^K}{1 - r}\n$$\nWe are asked to find the real-valued magnitude $|S_K|$. Using the properties of the modulus of complex numbers, we have:\n$$\n|S_K| = \\left| r \\frac{1 - r^K}{1 - r} \\right| = |r| \\frac{|1 - r^K|}{|1 - r|}\n$$\nThe modulus of $r$ is $|r| = |\\exp(2\\pi i / (q-1))| = 1$. Thus, the expression for the magnitude simplifies to:\n$$\n|S_K| = \\frac{|1 - r^K|}{|1 - r|}\n$$\nTo evaluate this, we use the identity for the magnitude of a difference of two complex numbers on the unit circle. For any real $\\theta$, a useful identity is $|1 - e^{i\\theta}| = 2|\\sin(\\theta/2)|$. This can be derived as follows:\n$$\n|1 - e^{i\\theta}| = |e^{i\\theta/2}(e^{-i\\theta/2} - e^{i\\theta/2})| = |e^{i\\theta/2}| \\cdot | -2i \\sin(\\theta/2) | = (1) \\cdot |-2i| \\cdot |\\sin(\\theta/2)| = 2|\\sin(\\theta/2)|\n$$\nWe apply this identity to the numerator and the denominator of our expression for $|S_K|$.\n\nFor the denominator $|1-r|$, we have $r = \\exp(2\\pi i / (q-1))$, so $\\theta = \\frac{2\\pi}{q-1}$.\n$$\n|1 - r| = 2\\left|\\sin\\left(\\frac{1}{2} \\cdot \\frac{2\\pi}{q-1}\\right)\\right| = 2\\left|\\sin\\left(\\frac{\\pi}{q-1}\\right)\\right|\n$$\nSince $q \\ge 3$, we have $q-1 \\ge 2$, so $0  \\frac{\\pi}{q-1} \\le \\frac{\\pi}{2}$. In this interval, the sine function is positive. Therefore, the absolute value is not needed:\n$$\n|1 - r| = 2\\sin\\left(\\frac{\\pi}{q-1}\\right)\n$$\nFor the numerator $|1-r^K|$, we have $r^K = (\\exp(2\\pi i / (q-1)))^K = \\exp(2\\pi i K / (q-1))$. Here, $\\theta = \\frac{2\\pi K}{q-1}$.\n$$\n|1 - r^K| = 2\\left|\\sin\\left(\\frac{1}{2} \\cdot \\frac{2\\pi K}{q-1}\\right)\\right| = 2\\left|\\sin\\left(\\frac{\\pi K}{q-1}\\right)\\right|\n$$\nThe problem specifies that $1 \\le K \\le \\lfloor \\frac{q-1}{2} \\rfloor$. This implies $0  \\frac{\\pi K}{q-1} \\le \\frac{\\pi}{q-1} \\lfloor \\frac{q-1}{2} \\rfloor \\le \\frac{\\pi}{q-1} \\frac{q-1}{2} = \\frac{\\pi}{2}$. In the interval $(0, \\pi/2]$, the sine function is also positive. So, we can remove the absolute value here as well:\n$$\n|1 - r^K| = 2\\sin\\left(\\frac{\\pi K}{q-1}\\right)\n$$\nSubstituting these results back into the expression for $|S_K|$ yields the final closed-form expression:\n$$\n|S_K| = \\frac{2\\sin\\left(\\frac{\\pi K}{q-1}\\right)}{2\\sin\\left(\\frac{\\pi}{q-1}\\right)} = \\frac{\\sin\\left(\\frac{\\pi K}{q-1}\\right)}{\\sin\\left(\\frac{\\pi}{q-1}\\right)}\n$$\nThis expression gives the exact magnitude of the sum $S_K$ as a function of $q$ and $K$.\n\nNext, we explain the conceptual aspects requested.\n\nThe reason this progression exhibits \"phase clustering\" is that the terms being summed, $\\chi(n_k) = \\exp(2\\pi i k / (q-1))$ for $k=1, 2, \\dots, K$, are not randomly distributed on the unit circle in the complex plane. Their arguments (phases) form a short arithmetic progression: $\\frac{2\\pi}{q-1}, \\frac{4\\pi}{q-1}, \\dots, \\frac{2\\pi K}{q-1}$. Given the constraint $1 \\le K \\le \\lfloor \\frac{q-1}{2} \\rfloor$, all these arguments lie in the interval $(0, \\pi]$. This means all the complex numbers $\\chi(n_k)$ lie in the upper half-plane (including the point $-1$ if $K=(q-1)/2$). When these vectors are added, their imaginary parts are all non-negative, and their real parts vary over a limited range. This leads to constructive interference, preventing the large-scale cancellation that would occur if the phases were pseudo-randomly distributed around the full circle. The sum is therefore exceptionally large.\n\nThis result does not contradict the Pólya–Vinogradov inequality. The Pólya–Vinogradov inequality provides an upper bound of the form $|\\sum_{n=M+1}^{M+N} \\chi(n)| \\ll \\sqrt{q} \\ln q$ for any non-principal character $\\chi$ modulo $q$. The crucial difference is the set over which the sum is taken. The Pólya–Vinogradov inequality applies to sums over consecutive integers (an arithmetic progression of differences $1$), which form an interval. In contrast, the sum $S_K$ is over a multiplicative progression $\\{g^1, g^2, \\dots, g^K\\} \\pmod{q}$. This is a very sparse and structured subset of residues modulo $q$. For large $q$, the magnitude of $S_K$ can be of order $O(q)$. For instance, if $K$ is close to $(q-1)/4$, then $|S_K| \\approx \\sin(\\pi/4)/\\sin(\\pi/(q-1)) \\approx \\frac{1}{\\sqrt{2}} / (\\pi/(q-1)) = \\frac{q-1}{\\pi\\sqrt{2}}$, which is linear in $q$. This is much larger than the $\\sqrt{q}\\ln q$ bound. The Pólya–Vinogradov inequality does not apply to this type of structured sum, so there is no contradiction. The large value of $|S_K|$ is a classic example demonstrating that character sums over specific structured sets can behave very differently from sums over intervals.", "answer": "$$\\boxed{\\frac{\\sin\\left(\\frac{\\pi K}{q-1}\\right)}{\\sin\\left(\\frac{\\pi}{q-1}\\right)}}$$", "id": "3009661"}, {"introduction": "Moving from small-scale manual calculations to larger numerical experiments is a fundamental skill in modern number theory. This practice challenges you to design and implement an algorithm to systematically investigate the maximal size of character sums for a range of prime moduli. By normalizing your results against the Pólya-Vinogradov scale, you will computationally assess the sharpness of this classical bound and gain experience in the full pipeline of a numerical investigation, from theoretical setup to data analysis [@problem_id:3009691].", "problem": "You are to design and implement a complete, runnable program that numerically investigates partial sums of Dirichlet characters in order to assess the growth scale that underlies character sum estimates such as the Pólya–Vinogradov phenomenon. Work exclusively with odd prime moduli to keep the structure of the multiplicative group simple. The mathematical and algorithmic tasks are as follows.\n\nStarting point and core definitions. For an odd prime modulus $p$, the multiplicative group $\\left(\\mathbb{Z}/p\\mathbb{Z}\\right)^{\\times}$ has $p-1$ elements and is cyclic. Fix a primitive root $g$ modulo $p$ so that every residue class $n$ coprime to $p$ can be written uniquely as $n \\equiv g^{a_{n}} \\pmod{p}$ for some exponent $a_{n} \\in \\{0,1,\\dots,p-2\\}$, which is the discrete logarithm of $n$ with respect to $g$. For each integer $k$ with $1 \\leq k \\leq p-2$, define a nonprincipal Dirichlet character modulo $p$ by specifying its values on powers of $g$, namely\n$$\n\\chi_{k}\\!\\left(g^{a}\\right) \\;=\\; \\exp\\!\\left(\\frac{2\\pi i\\, k\\, a}{\\,p-1\\,}\\right),\n$$\nand extend $\\chi_{k}$ to all integers by $\\chi_{k}(n)=0$ when $\\gcd(n,p)\\neq 1$ and by periodicity modulo $p$. For each such character $\\chi=\\chi_{k}$, define the partial sum function\n$$\nS_{\\chi}(x)\\;=\\;\\sum_{n\\le x}\\chi(n),\n$$\nand the maximal prefix sum magnitude\n$$\nM(\\chi)\\;=\\;\\max_{1\\le x \\le p-1}\\left|S_{\\chi}(x)\\right|.\n$$\nFor odd prime $p$, every nonprincipal character $\\chi$ satisfies $\\sum_{n=1}^{p-1}\\chi(n)=0$, so summing over full periods contributes zero, which implies the supremum of $\\left|S_{\\chi}(x)\\right|$ over all $x\\in\\mathbb{N}$ is attained within the first period $1\\le x\\le p-1$.\n\nBenchmark scale. To numerically gauge the growth rate of $M(\\chi)$, work with the natural normalization by the scale $\\sqrt{p}\\,\\log p$ and define, for each modulus $p$, the worst-case normalized maximum over all nonprincipal characters\n$$\nR(p)\\;=\\;\\frac{1}{\\sqrt{p}\\,\\log p}\\,\\max_{\\,\\chi\\ne\\chi_{0}}\\;M(\\chi).\n$$\n\nRequired derivation and algorithm. Derive an algorithm grounded in the structure of $\\left(\\mathbb{Z}/p\\mathbb{Z}\\right)^{\\times}$ that:\n- Finds a primitive root $g$ modulo $p$ starting from the prime factorization of $p-1$ and tests candidates via powering in the group.\n- Computes the discrete logarithm exponents $a_{n}$ for all $n\\in\\{1,2,\\dots,p-1\\}$ efficiently by tabulating $g^{a}\\bmod p$ for $a=0,1,\\dots,p-2$.\n- Constructs all nonprincipal characters $\\chi_{k}$ for $k=1,2,\\dots,p-2$ using the exponents $a_{n}$ and roots of unity $\\exp\\!\\left(\\frac{2\\pi i a_{n}}{p-1}\\right)$, so that $\\chi_{k}(n)=\\left(\\exp\\!\\left(\\frac{2\\pi i a_{n}}{p-1}\\right)\\right)^{k}$.\n- For each $\\chi_{k}$, computes $M(\\chi_{k})$ by cumulative summation of $\\chi_{k}(n)$ for $n$ from $1$ to $p-1$ and tracking the maximum of the absolute values of these partial sums.\n- Aggregates $R(p)$ for each modulus $p$.\n\nUnits and numerical conventions. All quantities are dimensionless. Use the natural logarithm for $\\log p$. Complex-valued arithmetic is permitted; the final outputs are real numbers.\n\nTest suite. Implement and run your algorithm on the following list of odd prime moduli, which probes small and moderate sizes and includes boundary and nontrivial cases:\n- $p=3$\n- $p=5$\n- $p=7$\n- $p=11$\n- $p=13$\n- $p=17$\n- $p=19$\n- $p=29$\n\nAnswer specification and final output format. For each test modulus $p$ in the order given, compute $R(p)$ as defined above. Your program should produce a single line of output containing these eight results as a comma-separated list of decimal numbers rounded to six decimal places and enclosed in square brackets (for example, \"[0.123456,0.234567,0.345678,0.456789,0.567890,0.678901,0.789012,0.890123]\"). No additional text or lines should be printed.", "solution": "The problem statement poses a valid and well-defined task in computational number theory. It is scientifically grounded in the theory of Dirichlet characters, is self-contained, and presents a clear, objective set of requirements for which a unique solution exists. All definitions are standard and mathematically correct. The computational tasks are feasible for the specified parameters. We may therefore proceed with a solution.\n\nThe objective is to compute the value $R(p) = \\frac{1}{\\sqrt{p}\\log p} \\max_{\\chi\\ne\\chi_{0}} M(\\chi)$ for a given list of odd prime moduli $p$. Here, $M(\\chi) = \\max_{1\\le x \\le p-1} |\\sum_{n=1}^x \\chi(n)|$ is the maximal magnitude of the partial sums of a nonprincipal Dirichlet character $\\chi$ modulo $p$. The algorithm to achieve this can be broken down into a sequence of number-theoretic constructions.\n\n**Step 1: Finding a Primitive Root**\nFor an odd prime $p$, the multiplicative group of integers modulo $p$, denoted $(\\mathbb{Z}/p\\mathbb{Z})^{\\times}$, is a cyclic group of order $\\phi(p) = p-1$. A generator of this group is called a primitive root modulo $p$. An integer $g$ is a primitive root modulo $p$ if and only if its order is $p-1$. A standard criterion to test if a candidate $g$ (with $1  g  p$) is a primitive root is to check that $g^{(p-1)/q} \\not\\equiv 1 \\pmod{p}$ for every distinct prime factor $q$ of $p-1$.\n\nThe algorithm is as follows:\n1.  Determine the set of distinct prime factors of $p-1$. This can be done by trial division since the values of $p$ are small.\n2.  Iterate through integer candidates $g=2, 3, 5, \\dots$\n3.  For each candidate $g$, compute $g^{(p-1)/q} \\pmod{p}$ for each distinct prime factor $q$ of $p-1$. For these computations, an efficient modular exponentiation algorithm (such as exponentiation by squaring) is used.\n4.  If $g^{(p-1)/q} \\not\\equiv 1 \\pmod{p}$ for all such $q$, then $g$ is a primitive root. The first such $g$ found is selected. The existence of a primitive root is guaranteed.\n\n**Step 2: Computing Discrete Logarithms**\nOnce a primitive root $g$ is fixed, every element $n \\in \\{1, 2, \\dots, p-1\\}$ can be uniquely represented as a power of $g$. The exponent $a_n$ in the congruence $n \\equiv g^{a_n} \\pmod{p}$, where $0 \\le a_n \\le p-2$, is called the discrete logarithm (or index) of $n$ to the base $g$.\n\nTo efficiently find the discrete logarithm $a_n$ for all $n$, we can pre-compute a lookup table:\n1.  Initialize an array or hash map, say `dlog`, to store the mapping from group elements to their exponents.\n2.  Iterate the exponent $a$ from $0$ to $p-2$.\n3.  In each iteration, calculate the value $v = g^a \\pmod{p}$.\n4.  Store the mapping `dlog[v] = a`.\nAfter the loop, this table allows for constant-time lookup of the discrete logarithm $a_n$ for any $n \\in \\{1, \\dots, p-1\\}$.\n\n**Step 3: Constructing Dirichlet Characters**\nThe nonprincipal Dirichlet characters $\\chi_k$ modulo $p$ are indexed by $k \\in \\{1, 2, \\dots, p-2\\}$. Their values are defined on the powers of the primitive root $g$ as\n$$ \\chi_k(g^a) = \\exp\\left(\\frac{2\\pi i k a}{p-1}\\right) $$\nFor any integer $n$ such that $\\gcd(n,p)=1$, we find its discrete logarithm $a_n$ and compute $\\chi_k(n) = \\chi_k(g^{a_n})$. If $\\gcd(n,p) \\neq 1$, then $\\chi_k(n) = 0$.\n\nLet $\\omega_1(n) = \\chi_1(n) = \\exp\\left(\\frac{2\\pi i a_n}{p-1}\\right)$. This is the \"base\" character from which all others can be generated. The value of any other character $\\chi_k$ is then given by:\n$$ \\chi_k(n) = \\exp\\left(\\frac{2\\pi i k a_n}{p-1}\\right) = \\left(\\exp\\left(\\frac{2\\pi i a_n}{p-1}\\right)\\right)^k = (\\chi_1(n))^k $$\nThis observation allows for an efficient construction. We first compute the vector of values $[\\chi_1(1), \\chi_1(2), \\dots, \\chi_1(p-1)]$ using the discrete logarithm table. Then, for each $k$, the vector of values for $\\chi_k$ is obtained by taking the $k$-th power of each element in the base vector.\n\n**Step 4: Computing the Maximal Prefix Sum Magnitude $M(\\chi_k)$**\nFor each character $\\chi_k$ ($k=1, \\dots, p-2$), we need to compute $M(\\chi_k) = \\max_{1 \\le x \\le p-1} |S_{\\chi_k}(x)|$. The partial sum is $S_{\\chi_k}(x) = \\sum_{n=1}^x \\chi_k(n)$. This can be computed iteratively:\n1.  Initialize a complex variable `current_sum` to $0$ and a real variable `max_magnitude` to $0$.\n2.  Create an array of character values `chi_values` = $[\\chi_k(1), \\chi_k(2), \\dots, \\chi_k(p-1)]$.\n3.  Iterate $x$ from $1$ to $p-1$:\n    a. Update `current_sum` by adding $\\chi_k(x)$.\n    b. Update `max_magnitude` to be the maximum of its current value and the absolute value of `current_sum`.\n4.  The final `max_magnitude` is $M(\\chi_k)$.\n\n**Step 5: Aggregating and Normalizing to find $R(p)$**\nThe final step is to compute the target quantity $R(p)$.\n1.  For a given prime $p$, we compute $M(\\chi_k)$ for all nonprincipal characters, i.e., for $k=1, 2, \\dots, p-2$.\n2.  Find the maximum of these values: $M_{\\max}(p) = \\max_{1 \\le k \\le p-2} M(\\chi_k)$.\n3.  Calculate the normalized ratio using the natural logarithm:\n$$ R(p) = \\frac{M_{\\max}(p)}{\\sqrt{p} \\log p} $$\nThis entire procedure is repeated for each prime $p$ in the provided test suite. The implementation will use `numpy` for efficient handling of complex numbers and array operations, such as vectorized power calculations and cumulative sums.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to calculate and print the results for the given test suite.\n    \"\"\"\n\n    def get_prime_factorization(n):\n        \"\"\"Finds the distinct prime factors of n.\"\"\"\n        factors = set()\n        d = 2\n        temp_n = n\n        while d * d = temp_n:\n            if temp_n % d == 0:\n                factors.add(d)\n                while temp_n % d == 0:\n                    temp_n //= d\n            d += 1\n        if temp_n  1:\n            factors.add(temp_n)\n        return list(factors)\n\n    def find_primitive_root(p):\n        \"\"\"Finds the smallest primitive root modulo an odd prime p.\"\"\"\n        if p == 3:\n            return 2\n        \n        phi = p - 1\n        prime_factors_phi = get_prime_factorization(phi)\n        \n        for g in range(2, p):\n            is_primitive = True\n            for q in prime_factors_phi:\n                # Use pow(base, exp, mod) for efficient modular exponentiation\n                if pow(g, phi // q, p) == 1:\n                    is_primitive = False\n                    break\n            if is_primitive:\n                return g\n        return -1 # Should not be reached for a prime p\n\n    def calculate_r_p(p):\n        \"\"\"\n        Calculates R(p) for a given odd prime p.\n        R(p) = (1 / (sqrt(p) * log(p))) * max_{chi != chi_0} M(chi)\n        \"\"\"\n        phi = p - 1\n        \n        # Step 1: Find a primitive root\n        g = find_primitive_root(p)\n        \n        # Step 2: Compute discrete logarithms\n        # dlogs[n] will store the discrete logarithm of n\n        dlogs = np.zeros(p, dtype=int)\n        val = 1\n        for a in range(phi):\n            dlogs[val] = a\n            val = (val * g) % p\n            \n        # Get an array of discrete logs a_n for n = 1, ..., p-1\n        # an_vals[i] corresponds to a_{i+1}\n        an_vals = np.array([dlogs[n] for n in range(1, p)])\n\n        # Step 3: Construct characters and find max M(chi)\n        # First, compute the values for the base character chi_1\n        # chi_1_vals[i] corresponds to chi_1(i+1)\n        chi_1_vals = np.exp(2j * np.pi * an_vals / phi)\n        \n        max_M = 0.0\n        \n        # Iterate over all non-principal characters k = 1, ..., p-2\n        for k in range(1, phi):\n            # Step 3 (cont.): Construct chi_k from chi_1\n            # (chi_1(n))^k = chi_k(n)\n            chi_k_vals = np.power(chi_1_vals, k)\n            \n            # Step 4: Compute M(chi_k)\n            # S_chi(x) = sum_{n=x} chi(n)\n            partial_sums = np.cumsum(chi_k_vals)\n            # M(chi) = max_{1=x=p-1} |S_chi(x)|\n            M_chi_k = np.max(np.abs(partial_sums))\n            \n            if M_chi_k  max_M:\n                max_M = M_chi_k\n\n        # Step 5: Aggregate and compute R(p)\n        R_p = max_M / (np.sqrt(p) * np.log(p))\n        \n        return R_p\n\n    # Define the test cases from the problem statement.\n    test_cases = [3, 5, 7, 11, 13, 17, 19, 29]\n\n    results = []\n    for p in test_cases:\n        result = calculate_r_p(p)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3009691"}]}