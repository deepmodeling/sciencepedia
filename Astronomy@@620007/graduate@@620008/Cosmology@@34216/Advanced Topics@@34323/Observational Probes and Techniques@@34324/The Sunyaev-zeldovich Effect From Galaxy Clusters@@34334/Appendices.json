{"hands_on_practices": [{"introduction": "The kinematic Sunyaev-Zeldovich (kSZ) effect provides a powerful way to measure the line-of-sight velocity of ionized gas. While often discussed in the context of a cluster's peculiar velocity relative to the cosmic expansion, internal bulk motions like rotation can also generate a distinct kSZ signature.\n\nThis exercise guides you through the process of translating a physical model of a rotating galaxy cluster into a predicted observational signal in the Cosmic Microwave Background (CMB) temperature map [@problem_id:891882]. By performing the line-of-sight integral of the Doppler-shifted photons, you will build a concrete understanding of how the geometry of the system and its internal dynamics directly shape the observable kSZ effect.", "problem": "A distant galaxy cluster is modeled as a spherically symmetric distribution of ionized gas (intracluster medium) in solid-body rotation. The cluster's electron number density, $n_e$, as a function of radial distance $r$ from its center, is described by a Gaussian profile:\n$$\nn_e(r) = n_{e0} \\exp\\left(-\\frac{r^2}{2\\sigma_r^2}\\right)\n$$\nwhere $n_{e0}$ is the central electron number density and $\\sigma_r$ is the characteristic radius of the cluster.\n\nThe cluster rotates as a solid body with a constant angular velocity vector $\\vec{\\omega}$. An observer is located very far from the cluster, along the $z$-axis of a Cartesian coordinate system centered on the cluster. The plane of the sky is the $(x, y)$ plane. The rotation axis of the cluster lies in the $y-z$ plane and is inclined at an angle $i$ with respect to the line of sight (the $z$-axis), such that the angular velocity vector is given by:\n$$\n\\vec{\\omega} = \\omega (\\sin i \\, \\hat{y} + \\cos i \\, \\hat{z})\n$$\nwhere $\\omega = |\\vec{\\omega}|$ is the magnitude of the angular velocity.\n\nThe bulk motion of the electrons within the cluster induces a kinematic Sunyaev-Zeldovich (kSZ) effect, causing a temperature fluctuation $\\Delta T_{kSZ}$ in the observed Cosmic Microwave Background (CMB) radiation. The temperature fluctuation at a point $(x, y)$ on the plane of the sky is given by the line-of-sight integral:\n$$\n\\frac{\\Delta T_{kSZ}(x,y)}{T_{CMB}} = -\\frac{\\sigma_T}{c} \\int_{-\\infty}^{\\infty} n_e(\\vec{r}) \\, v_{los} \\, dz\n$$\nHere, $T_{CMB}$ is the mean temperature of the CMB, $\\sigma_T$ is the Thomson scattering cross-section, $c$ is the speed of light, $\\vec{r} = x\\hat{x} + y\\hat{y} + z\\hat{z}$ is the position vector, and $v_{los}$ is the component of the electrons' bulk velocity along the line of sight pointing towards the observer.\n\nDetermine the maximum temperature increment, $\\Delta T_{max}$, observed in the kSZ temperature map. Express your answer as an analytic expression in terms of $T_{CMB}$, $\\sigma_T$, $c$, $n_{e0}$, $\\sigma_r$, $\\omega$, and $i$.", "solution": "1. Relevant equations  \nElectron density  \n$$n_e(r)=n_{e0}\\exp\\Bigl(-\\frac{r^2}{2\\sigma_r^2}\\Bigr)\\,. $$  \nBulk velocity  \n$$\\vec v=\\vec\\omega\\times\\vec r\\,,\\quad \\vec\\omega=\\omega(\\sin i\\,\\hat y+\\cos i\\,\\hat z)\\,. $$  \nkSZ temperature fluctuation  \n$$\\frac{\\Delta T_{kSZ}(x,y)}{T_{CMB}}\n=-\\frac{\\sigma_T}{c}\\int_{-\\infty}^{\\infty}n_e(\\vec r)\\,v_{los}\\,dz\\,. $$\n\n2. Compute $v_{los}=\\vec v\\cdot\\hat z$  \n$$\\vec v\n=\\bigl(\\omega\\sin i\\,z-\\omega\\cos i\\,y,\\;\\omega\\cos i\\,x,\\;-\\omega\\sin i\\,x\\bigr)\\,, $$\nso  \n$$v_{los}=v_z=-\\omega\\sin i\\,x\\,. $$\n\n3. Plug into kSZ integral  \n$$\\frac{\\Delta T}{T_{CMB}}\n=-\\frac{\\sigma_T}{c}\\int n_{e0}e^{-(x^2+y^2+z^2)/(2\\sigma_r^2)}(-\\omega\\sin i\\,x)\\,dz$$  \n$$=\\frac{\\sigma_T\\omega\\sin i\\,x\\,n_{e0}}{c}\n\\int_{-\\infty}^\\infty e^{-(x^2+y^2+z^2)/(2\\sigma_r^2)}dz$$  \n$$=\\frac{\\sigma_T\\omega\\sin i\\,x\\,n_{e0}}{c}\ne^{-(x^2+y^2)/(2\\sigma_r^2)}\\sqrt{2\\pi}\\,\\sigma_r\\,. $$\n\n4. Maximize with respect to $(x,y)$  \nWe set $y=0$ and maximize $f(x)=x\\exp(-x^2/(2\\sigma_r^2))$.  \n$$\\frac{df}{dx}=0\\ \\Rightarrow\\ x=\\sigma_r,\\quad f(\\sigma_r)=\\sigma_r e^{-1/2}\\,. $$\n\n5. Final expression  \n$$\\frac{\\Delta T_{\\max}}{T_{CMB}}\n=\\frac{\\sigma_T\\omega\\sin i\\,n_{e0}}{c}\\,\\sqrt{2\\pi}\\,\\sigma_r\\,(\\sigma_r e^{-1/2})\n=\\frac{\\sigma_T n_{e0}\\omega\\sigma_r^2\\sin i}{c}\\sqrt{\\frac{2\\pi}{e}}\\,. $$\nThus  \n$$\\Delta T_{\\max}\n=T_{CMB}\\,\\frac{\\sigma_T n_{e0}\\omega\\sigma_r^2\\sin i}{c}\\sqrt{\\frac{2\\pi}{e}}\\,. $$", "answer": "$$\\boxed{T_{CMB}\\,\\frac{\\sigma_T\\,n_{e0}\\,\\omega\\,\\sigma_r^2\\,\\sin i}{c}\\,\\sqrt{\\frac{2\\pi}{e}}}$$", "id": "891882"}, {"introduction": "Beyond the well-known spectral distortion, Thomson scattering can also polarize the CMB if the incoming radiation field, as seen by the scattering electrons, is anisotropic. In the dense environment of a galaxy cluster, the cluster's own aspherical shape and gravitational potential can induce a local quadrupole anisotropy in the CMB, which then generates a net linear polarization in the scattered light.\n\nThis advanced practice explores the rich physics of this polarized Sunyaev-Zeldovich (pSZ) effect [@problem_id:891871]. You will work with the tensor formalism of polarized radiative transfer to calculate the resulting Stokes parameters, gaining valuable insight into how the pSZ signal serves as a unique probe for the geometric shape and gravitational potential of galaxy clusters.", "problem": "The Sunyaev-Zeldovich (SZ) effect is a distortion of the Cosmic Microwave Background (CMB) spectrum caused by the scattering of CMB photons off high-energy electrons in the intracluster medium (ICM) of galaxy clusters. While the thermal SZ effect (a spectral change) arises from the energy boost given to photons, a polarized SZ signal can be generated if the CMB radiation field, as seen by the scattering electrons, possesses a quadrupole anisotropy.\n\nIn an aspherical (e.g., oblate or prolate) galaxy cluster, the gravitational potential is not spherically symmetric. This asphericity, combined with the differential gravitational redshift (related to the Integrated Sachs-Wolfe effect) experienced by CMB photons traversing the cluster from different directions, induces a local quadrupole anisotropy in the CMB radiation field at the location of the scattering electrons. Thomson scattering of this quadrupolar radiation field then generates a net linear polarization in the scattered light.\n\nThe state of polarization of radiation propagating along a direction $\\mathbf{n}$ can be described by an intensity tensor $\\mathcal{P}_{ij}$, a $3 \\times 3$ real, symmetric, and transverse ($\\mathcal{P}_{ij}n_j=0$) tensor. In a 2D basis $(\\mathbf{e}_1, \\mathbf{e}_2)$ orthogonal to $\\mathbf{n}$, the components of this tensor relate to the Stokes parameters as $I = \\mathcal{P}_{11}+\\mathcal{P}_{22}$, $Q = \\mathcal{P}_{11}-\\mathcal{P}_{22}$, and $U = 2\\mathcal{P}_{12}$.\n\nThe generation of polarized radiation via single Thomson scattering can be described by a source term in the radiative transfer equation. Let the incident radiation field at the location of an electron be described by an intensity $I(\\mathbf{n'})$ from direction $\\mathbf{n'}$. The quadrupole moment of this radiation field is a traceless tensor defined as:\n$$\n\\mathcal{I}_{ij} = \\int \\frac{d\\Omega'}{4\\pi} \\left(I(\\mathbf{n'}) - I_0\\right) \\left(n'_i n'_j - \\frac{1}{3}\\delta_{ij}\\right)\n$$\nwhere $I_0$ is the monopole (average) intensity.\n\nThe source term for the polarized scattered radiation, $\\mathcal{S}_{ij}$, which gives the generated intensity tensor per unit optical depth, is proportional to the transverse-traceless projection of this incident quadrupole. It is given by:\n$$\n\\mathcal{S}_{ij}(\\mathbf{n}) = K \\left[ (\\mathbf{P}\\mathcal{I}\\mathbf{P})_{ij} - \\frac{1}{2}P_{ij}(\\mathbf{n})\\,\\mathrm{Tr}(\\mathbf{P}\\mathcal{I}\\mathbf{P}) \\right]\n$$\nwhere $K$ is a dimensionless constant of proportionality, $P_{ij}(\\mathbf{n}) = \\delta_{ij} - n_i n_j$ is the projection tensor onto the plane transverse to the observer's line of sight $\\mathbf{n}$, and $(\\mathbf{P}\\mathcal{I}\\mathbf{P})_{ij} = P_{ik}(\\mathbf{n})\\mathcal{I}_{kl}P_{lj}(\\mathbf{n})$.\n\nConsider an electron at the center of an axially symmetric galaxy cluster. The symmetry axis of the induced CMB quadrupole is aligned with the Cartesian $\\hat{z}$-axis. The quadrupole tensor is given by:\n$$\n\\mathcal{I}_{ij} = A_Q (3\\hat{z}_i\\hat{z}_j - \\delta_{ij})\n$$\nwhere $A_Q$ is a constant amplitude reflecting the cluster's ellipticity and potential depth.\n\nAn observer measures the scattered radiation along a line of sight $\\mathbf{n}$ that makes an angle $\\theta$ with the cluster's symmetry axis $\\hat{z}$. Without loss of generality, let $\\mathbf{n} = (\\sin\\theta, 0, \\cos\\theta)$. The Stokes parameters are measured in a basis fixed to the sky: $\\mathbf{e}_1 = (0, 1, 0)$ and $\\mathbf{e}_2 = (\\cos\\theta, 0, -\\sin\\theta)$.\n\nCalculate the Stokes parameter $Q_S$ for the scattered radiation, defined as $Q_S = \\mathcal{S}_{11} - \\mathcal{S}_{22}$. Express your answer in terms of $K$, $A_Q$, and $\\theta$.", "solution": "1. The polarization source tensor is  \n$$\n\\mathcal{S}_{ij}=K\\Bigl[(P\\,\\mathcal{I}\\,P)_{ij}-\\tfrac12P_{ij}\\Tr(P\\,\\mathcal{I}\\,P)\\Bigr],\n\\quad\nP_{ij}=\\delta_{ij}-n_i n_j.\n$$  \n2. In the sky basis $(\\mathbf e_1,\\mathbf e_2)$ transverse to $\\mathbf n$, one finds  \n$$\nQ_S=\\mathcal{S}_{11}-\\mathcal{S}_{22}\n=K\\Bigl[(PIP)_{11}-(PIP)_{22}\\Bigr],\n$$  \nsince $P_{11}=P_{22}=1$ so the trace term cancels.  \n3. For any vector $\\mathbf e_r\\perp\\mathbf n$, $P\\mathbf e_r=\\mathbf e_r$, hence  \n$$\n(PIP)_{rr}=\\mathbf e_r^T\\,\\mathcal I\\,\\mathbf e_r,\n\\quad r=1,2.\n$$  \n4. The quadrupole tensor is  \n$$\n\\mathcal I_{ij}=A_Q\\,(3\\hat z_i\\hat z_j-\\delta_{ij}).\n$$  \n5. Evaluate  \n$$\n\\mathbf e_1=(0,1,0)\\implies \\mathbf e_1^T\\mathcal I\\,\\mathbf e_1\n=A_Q(3\\cdot0^2-1)=-A_Q,\n$$  \n$$\n\\mathbf e_2=(\\cos\\theta,0,-\\sin\\theta)\\implies \n\\mathbf e_2^T\\mathcal I\\,\\mathbf e_2\n=A_Q\\bigl(3(\\hat z\\cdot\\mathbf e_2)^2-1\\bigr)\n=A_Q(3\\sin^2\\theta-1).\n$$  \n6. Therefore  \n$$\nQ_S\n=K\\bigl[-A_Q -A_Q(3\\sin^2\\theta-1)\\bigr]\n=-3K\\,A_Q\\,\\sin^2\\theta.\n$$", "answer": "$$\\boxed{-3\\,K\\,A_Q\\,\\sin^2\\theta}$$", "id": "891871"}, {"introduction": "While analytical derivations provide the fundamental physical framework, applying these concepts to realistic astrophysical systems often requires computational methods. Modeling the thermal Sunyaev-Zeldovich (tSZ) effect from a galaxy cluster, with its complex three-dimensional structure, is a perfect example of this synergy between theory and computation.\n\nThis hands-on computational problem closes the loop between theory and observation by having you numerically calculate the tSZ signal for a realistic cluster model [@problem_id:2414991]. By implementing multidimensional numerical integration, you will gain practical experience in how astrophysicists create model predictions to interpret observational data, a cornerstone skill in modern cosmology and astrophysics.", "problem": "A three-dimensional hot electron plasma that models a galaxy cluster is described by an isothermal triaxial beta profile. Let the electron number density be\n$$\nn_{\\mathrm{e}}(x,y,z) = n_0 \\left[ 1 + \\left(\\frac{x^2}{a_x^2} + \\frac{y^2}{a_y^2} + \\frac{z^2}{a_z^2}\\right) \\right]^{-3\\beta/2},\n$$\nwith constant electron temperature\n$$\nT_{\\mathrm{e}}(x,y,z) = T_0.\n$$\nAssume the single-scattering Thomson limit and the non-relativistic regime for the electron thermal speeds. The Cosmic Microwave Background (CMB) has thermodynamic temperature\n$$\nT_{\\mathrm{CMB}} = 2.725~\\mathrm{K}.\n$$\nFor a given observing frequency\n$$\n\\nu,\n$$\nyou are to compute the non-relativistic thermal Sunyaev-Zeldovich (tSZ) induced thermodynamic temperature shift along a line of sight through the cluster and the aperture-averaged temperature shift over a circular aperture on the sky. Your task is to:\n- Start from the fundamental definitions of Thomson scattering, kinetic theory for an ideal electron gas, and radiative transfer in the diffusion (Kompaneets) approximation to derive an expression that relates the thermodynamic temperature shift at frequency $\\nu$ to an integral of the electron pressure along the line of sight, multiplied by a spectral factor that depends only on $\\nu$ and $T_{\\mathrm{CMB}}$.\n- Implement a multidimensional numerical integration to evaluate:\n  1. The line-of-sight temperature shift at sky-plane coordinates $(b_x,b_y)$:\n     $$\n     \\Delta T_{\\nu}^{\\mathrm{LOS}}(b_x,b_y),\n     $$\n     by integrating along the $z$-axis over a symmetric finite range $z \\in [-L_z, L_z]$ with $L_z$ chosen as a multiple of $a_z$ provided in each test, and\n  2. The aperture-averaged temperature shift over a circular aperture of radius $R$ centered at the origin in the sky plane:\n     $$\n     \\langle \\Delta T_{\\nu} \\rangle_R = \\frac{1}{\\pi R^2} \\iint_{x^2+y^2 \\le R^2} \\Delta T_{\\nu}^{\\mathrm{LOS}}(x,y)\\, \\mathrm{d}A,\n     $$\n     where $\\mathrm{d}A$ is the area element in the sky plane. This requires a multidimensional numerical integration that couples the sky-plane integral with the line-of-sight integral through the three-dimensional pressure distribution.\n\nUse the International System of Units (SI) consistently. Express all reported thermodynamic temperature shifts in kelvins. Angles, if needed, are to be in radians. You may choose any stable numerical integration method, but your implementation must explicitly perform the required multidimensional numerical integrations without using pre-tabulated special-case analytic results.\n\nPhysical constants to use:\n- Thomson cross section $\\,\\sigma_{\\mathrm{T}} = 6.6524587321\\times 10^{-29}\\,\\mathrm{m}^2$.\n- Electron rest energy $\\,m_{\\mathrm{e}} c^2 = 8.1871057769\\times 10^{-14}\\,\\mathrm{J}$.\n- Boltzmann constant $\\,k_{\\mathrm{B}} = 1.380649\\times 10^{-23}\\,\\mathrm{J/K}$.\n- Planck constant $\\,h = 6.62607015\\times 10^{-34}\\,\\mathrm{J\\,s}$.\n- Speed of light $\\,c = 2.99792458\\times 10^8\\,\\mathrm{m/s}$.\n\nTest suite. For each parameter set $(n_0, T_0, \\beta, a_x, a_y, a_z, b_x, b_y, R, \\nu, L_z)$ below, compute and return two floats:\n- The line-of-sight thermodynamic temperature shift $\\,\\Delta T_{\\nu}^{\\mathrm{LOS}}(b_x,b_y)\\,$ in kelvins.\n- The aperture-averaged thermodynamic temperature shift $\\,\\langle \\Delta T_{\\nu} \\rangle_R\\,$ in kelvins.\n\nUse the following four test cases, which together probe a general case, an off-axis line of sight, triaxial geometry, and a zero-density edge case:\n1. $\\,n_0 = 1.0\\times 10^3\\,\\mathrm{m}^{-3}$, $\\,T_0 = 8.0\\times 10^7\\,\\mathrm{K}$, $\\,\\beta = 2/3$, $\\,a_x = 4.0\\times 10^{21}\\,\\mathrm{m}$, $\\,a_y = 4.0\\times 10^{21}\\,\\mathrm{m}$, $\\,a_z = 4.0\\times 10^{21}\\,\\mathrm{m}$, $\\,b_x = 0.0\\,\\mathrm{m}$, $\\,b_y = 0.0\\,\\mathrm{m}$, $\\,R = 1.0\\times 10^{22}\\,\\mathrm{m}$, $\\,\\nu = 1.50\\times 10^{11}\\,\\mathrm{Hz}$, $\\,L_z = 12\\,a_z$.\n2. $\\,n_0 = 1.0\\times 10^3\\,\\mathrm{m}^{-3}$, $\\,T_0 = 8.0\\times 10^7\\,\\mathrm{K}$, $\\,\\beta = 2/3$, $\\,a_x = 4.0\\times 10^{21}\\,\\mathrm{m}$, $\\,a_y = 4.0\\times 10^{21}\\,\\mathrm{m}$, $\\,a_z = 4.0\\times 10^{21}\\,\\mathrm{m}$, $\\,b_x = 5.0\\times 10^{21}\\,\\mathrm{m}$, $\\,b_y = 0.0\\,\\mathrm{m}$, $\\,R = 1.0\\times 10^{22}\\,\\mathrm{m}$, $\\,\\nu = 1.50\\times 10^{11}\\,\\mathrm{Hz}$, $\\,L_z = 12\\,a_z$.\n3. $\\,n_0 = 5.0\\times 10^2\\,\\mathrm{m}^{-3}$, $\\,T_0 = 1.2\\times 10^8\\,\\mathrm{K}$, $\\,\\beta = 0.8$, $\\,a_x = 3.0\\times 10^{21}\\,\\mathrm{m}$, $\\,a_y = 6.0\\times 10^{21}\\,\\mathrm{m}$, $\\,a_z = 9.0\\times 10^{21}\\,\\mathrm{m}$, $\\,b_x = 0.0\\,\\mathrm{m}$, $\\,b_y = 0.0\\,\\mathrm{m}$, $\\,R = 8.0\\times 10^{21}\\,\\mathrm{m}$, $\\,\\nu = 1.50\\times 10^{11}\\,\\mathrm{Hz}$, $\\,L_z = 12\\,a_z$.\n4. $\\,n_0 = 0.0\\,\\mathrm{m}^{-3}$, $\\,T_0 = 8.0\\times 10^7\\,\\mathrm{K}$, $\\,\\beta = 2/3$, $\\,a_x = 4.0\\times 10^{21}\\,\\mathrm{m}$, $\\,a_y = 4.0\\times 10^{21}\\,\\mathrm{m}$, $\\,a_z = 4.0\\times 10^{21}\\,\\mathrm{m}$, $\\,b_x = 0.0\\,\\mathrm{m}$, $\\,b_y = 0.0\\,\\mathrm{m}$, $\\,R = 1.0\\times 10^{22}\\,\\mathrm{m}$, $\\,\\nu = 1.50\\times 10^{11}\\,\\mathrm{Hz}$, $\\,L_z = 12\\,a_z$.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n[\\Delta T_{\\nu,1}^{\\mathrm{LOS}}, \\langle \\Delta T_{\\nu} \\rangle_{R,1}, \\Delta T_{\\nu,2}^{\\mathrm{LOS}}, \\langle \\Delta T_{\\nu} \\rangle_{R,2}, \\Delta T_{\\nu,3}^{\\mathrm{LOS}}, \\langle \\Delta T_{\\nu} \\rangle_{R,3}, \\Delta T_{\\nu,4}^{\\mathrm{LOS}}, \\langle \\Delta T_{\\nu} \\rangle_{R,4}],\n$$\nwhere the subscript indexes the test case $\\,1,2,3,4\\,$. Each entry must be a float in kelvins.", "solution": "The problem presented is a standard, well-posed exercise in computational astrophysics, specifically concerning the calculation of the thermal Sunyaev-Zeldovich (tSZ) effect. All physical parameters, model definitions, and constants are provided and are scientifically sound and consistent. The problem statement is free of ambiguity, contradiction, and factual error. Therefore, it is deemed valid. We proceed with the solution, which consists of two parts: first, a rigorous derivation of the governing equations from fundamental principles, and second, the numerical implementation to compute the required quantities.\n\n**Part 1: Theoretical Formulation of the Thermal Sunyaev-Zeldovich Effect**\n\nThe thermal Sunyaev-Zeldovich effect is the spectral distortion of the Cosmic Microwave Background (CMB) radiation resulting from inverse Compton scattering by hot electrons in the intracluster medium (ICM) of galaxy clusters. We will derive the expression for the induced thermodynamic temperature shift, $\\Delta T_\\nu$, under the specified non-relativistic, single-scattering approximation.\n\nThe evolution of the photon occupation number, $n(\\nu)$, in a thermal bath of non-relativistic electrons is described by the Kompaneets equation. In the optically thin limit ($\\tau \\ll 1$), which is valid for the ICM, we consider the perturbation to the incident CMB blackbody radiation, $n_{BB}(\\nu)$, from a single passage through the cluster. The change in the occupation number along a line of sight with path element $dl$ is given by integrating the Kompaneets equation over the path:\n$$\n\\Delta n(\\nu) = \\int \\frac{\\partial n}{\\partial t} \\frac{dl}{c}\n$$\nThe Kompaneets equation is\n$$\n\\frac{\\partial n}{\\partial t} = \\frac{\\sigma_T n_e c}{m_e c^2} \\frac{1}{x^2} \\frac{\\partial}{\\partial x} \\left[ x^4 \\left( k_B T_e \\frac{\\partial n}{\\partial x} + n(1+n) \\right) \\right]\n$$\nwhere $x = h\\nu/(k_B T_{CMB})$ is the dimensionless frequency, $n_e$ and $T_e$ are the electron number density and temperature, $\\sigma_T$ is the Thomson cross section, $m_e c^2$ is the electron rest energy, and other symbols have their usual meanings.\n\nThe incident radiation is the CMB, for which $n = n_{BB}(T_{CMB}) = (e^x - 1)^{-1}$. Since $T_e \\gg T_{CMB}$ in a galaxy cluster, the electron gas is not in thermal equilibrium with the CMB. A standard simplification, valid for small changes, evaluates the derivative terms using the unperturbed CMB spectrum. This leads to the well-known result for the change in the occupation number:\n$$\n\\Delta n(x) = y \\cdot g(x)\n$$\nwhere $y$ is the Compton-y parameter and $g(x)$ is a spectral function. The Compton-y parameter represents the integrated electron pressure along the line of sight, scaled by physical constants:\n$$\ny = \\int \\frac{\\sigma_T n_e k_B T_e}{m_e c^2} dl\n$$\nThe spectral function $g(x)$ is derived from the Kompaneets operator acting on the blackbody spectrum:\n$$\ng(x) = \\frac{x e^x}{(e^x-1)^2} \\left( x \\frac{e^x+1}{e^x-1} - 4 \\right)\n$$\n\nThe observable quantity is not the occupation number itself, but the change in spectral intensity, $\\Delta I_\\nu$. The change in thermodynamic temperature, $\\Delta T_\\nu$, is defined via the relation $\\Delta I_\\nu = (\\partial B_\\nu / \\partial T)_{T=T_{CMB}} \\Delta T_\\nu$, where $B_\\nu(T)$ is the Planck function for blackbody radiation.\n\nThe intensity is related to the occupation number by $I_\\nu = \\frac{2h\\nu^3}{c^2} n(\\nu)$. The change in intensity is thus $\\Delta I_\\nu = \\frac{2h\\nu^3}{c^2} \\Delta n(x)$.\nThe derivative of the Planck function with respect to temperature is:\n$$\n\\left.\\frac{\\partial B_\\nu}{\\partial T}\\right|_{T=T_{CMB}} = \\frac{2h\\nu^3}{c^2} \\frac{x e^x}{T_{CMB}(e^x-1)}\n$$\nCombining these relations, we solve for the fractional temperature change:\n$$\n\\frac{\\Delta T_\\nu}{T_{CMB}} = \\frac{\\Delta I_\\nu / T_{CMB}}{(\\partial B_\\nu / \\partial T)_{T_{CMB}}} = \\frac{ (2h\\nu^3/c^2) \\Delta n(x) / T_{CMB} }{ (2h\\nu^3/c^2) [x e^x / (T_{CMB}(e^x-1))] } = \\frac{\\Delta n(x)}{x e^x / (e^x-1)}\n$$\nSubstituting the expressions for $\\Delta n(x)$ and $g(x)$:\n$$\n\\frac{\\Delta T_\\nu}{T_{CMB}} = \\frac{y \\cdot \\frac{x e^x}{(e^x-1)^2} \\left( x \\frac{e^x+1}{e^x-1} - 4 \\right)}{x e^x / (e^x-1)} = y \\left( x \\frac{e^x+1}{e^x-1} - 4 \\right)\n$$\nLet the spectral factor be $f(x) = x \\coth(x/2) - 4 = x \\frac{e^x+1}{e^x-1} - 4$. The final expression for the thermodynamic temperature shift is:\n$$\n\\Delta T_\\nu = T_{CMB} \\cdot f(x) \\cdot y\n$$\n\n**Part 2: Numerical Implementation Strategy**\n\nGiven the electron density distribution $n_e(x,y,z)$ and constant temperature $T_0$, we can express the quantities to be computed. The line of sight is along the $z$-axis.\n\n1.  **Line-of-Sight Temperature Shift**: For a line of sight passing through the sky-plane coordinates $(b_x, b_y)$, the Compton-y parameter is:\n    $$\n    y(b_x, b_y) = \\frac{\\sigma_T k_B T_0}{m_e c^2} \\int_{-L_z}^{L_z} n_e(b_x, b_y, z) dz\n    $$\n    The temperature shift is then:\n    $$\n    \\Delta T_{\\nu}^{\\mathrm{LOS}}(b_x,b_y) = T_{CMB} \\cdot f\\left(\\frac{h\\nu}{k_B T_{CMB}}\\right) \\cdot \\frac{\\sigma_T k_B T_0 n_0}{m_e c^2} \\int_{-L_z}^{L_z} \\left[ 1 + \\frac{b_x^2}{a_x^2} + \\frac{b_y^2}{a_y^2} + \\frac{z^2}{a_z^2} \\right]^{-3\\beta/2} dz\n    $$\n    This is a one-dimensional integral with respect to $z$, which will be computed numerically using `scipy.integrate.quad`.\n\n2.  **Aperture-Averaged Temperature Shift**: This is the average of $\\Delta T_{\\nu}^{\\mathrm{LOS}}(x,y)$ over a circular aperture of radius $R$:\n    $$\n    \\langle \\Delta T_{\\nu} \\rangle_R = \\frac{1}{\\pi R^2} \\iint_{x^2+y^2 \\le R^2} \\Delta T_{\\nu}^{\\mathrm{LOS}}(x,y)\\, d A\n    $$\n    Substituting the expression for $\\Delta T_{\\nu}^{\\mathrm{LOS}}$ results in a three-dimensional integral over a cylindrical domain in $(x, y, z)$ coordinates. For numerical evaluation, we transform the sky-plane integral to polar coordinates $(r, \\theta)$, where $x=r\\cos\\theta$ and $y=r\\sin\\theta$. The integral becomes:\n    $$\n    \\langle \\Delta T_{\\nu} \\rangle_R = K \\cdot \\frac{1}{\\pi R^2} \\int_0^{2\\pi} d\\theta \\int_0^R dr \\int_{-L_z}^{L_z} dz \\cdot r \\cdot \\left[ 1 + \\frac{(r\\cos\\theta)^2}{a_x^2} + \\frac{(r\\sin\\theta)^2}{a_y^2} + \\frac{z^2}{a_z^2} \\right]^{-3\\beta/2}\n    $$\n    where $K = T_{CMB} \\cdot f(x) \\cdot \\frac{\\sigma_T k_B T_0 n_0}{m_e c^2}$ is a constant prefactor for each test case, and the term $r$ arises from the Jacobian of the coordinate transformation ($dA = r dr d\\theta$). This three-dimensional integral will be computed using `scipy.integrate.nquad`.\n\nThe implementation will consist of a main function that iterates through the provided test cases. For each case, it will first compute the constant prefactors, then evaluate the one-dimensional integral for the line-of-sight shift and the three-dimensional integral for the aperture average, and finally format the results as specified. A special check for $n_0=0$ will return zero for both quantities, as there is no scattering medium.", "answer": "```python\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Solves the thermal Sunyaev-Zeldovich effect problem for a set of test cases.\n    \"\"\"\n    # Physical constants in SI units\n    SIGMA_T = 6.6524587321e-29  # Thomson cross section (m^2)\n    M_E_C2 = 8.1871057769e-14     # Electron rest energy (J)\n    K_B = 1.380649e-23           # Boltzmann constant (J/K)\n    H_PLANCK = 6.62607015e-34    # Planck constant (J*s)\n    C_LIGHT = 2.99792458e8       # Speed of light (m/s)\n    T_CMB = 2.725                # CMB temperature (K)\n\n    test_cases = [\n        # (n0, T0, beta, ax, ay, az, bx, by, R, nu, Lz_factor)\n        (1.0e3, 8.0e7, 2/3, 4.0e21, 4.0e21, 4.0e21, 0.0, 0.0, 1.0e22, 1.50e11, 12),\n        (1.0e3, 8.0e7, 2/3, 4.0e21, 4.0e21, 4.0e21, 5.0e21, 0.0, 1.0e22, 1.50e11, 12),\n        (5.0e2, 1.2e8, 0.8, 3.0e21, 6.0e21, 9.0e21, 0.0, 0.0, 8.0e21, 1.50e11, 12),\n        (0.0, 8.0e7, 2/3, 4.0e21, 4.0e21, 4.0e21, 0.0, 0.0, 1.0e22, 1.50e11, 12),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        n0, T0, beta, ax, ay, az, bx, by, R, nu, Lz_factor = case\n        \n        # Trivial case: zero electron density\n        if n0 == 0.0:\n            results.extend([0.0, 0.0])\n            continue\n        \n        Lz = Lz_factor * az\n\n        # 1. Calculate the constant prefactors\n        # Dimensionless frequency x\n        x = (H_PLANCK * nu) / (K_B * T_CMB)\n        \n        # Spectral factor f(x)\n        # f(x) = x * coth(x/2) - 4 = x * (e^x + 1) / (e^x - 1) - 4\n        f_x = x * (np.exp(x) + 1) / (np.exp(x) - 1) - 4\n        \n        # Overall constant K combining T_CMB, f(x), and physical constants\n        K = T_CMB * f_x * (SIGMA_T * K_B * T0 * n0) / M_E_C2\n\n        # 2. Compute the line-of-sight temperature shift\n        \n        # Define the integrand for the LOS integral\n        def los_integrand(z):\n            term = 1 + (bx/ax)**2 + (by/ay)**2 + (z/az)**2\n            return term**(-1.5 * beta)\n        \n        los_integral_val, _ = integrate.quad(los_integrand, -Lz, Lz)\n        delta_T_los = K * los_integral_val\n        \n        # 3. Compute the aperture-averaged temperature shift\n\n        # Define the integrand for the 3D aperture integral in (z, r, theta) coords\n        def aperture_integrand(z, r, theta):\n            x_coord = r * np.cos(theta)\n            y_coord = r * np.sin(theta)\n            term = 1 + (x_coord/ax)**2 + (y_coord/ay)**2 + (z/az)**2\n            return r * term**(-1.5 * beta) # Include Jacobian 'r'\n\n        # Set integration ranges for (z, r, theta)\n        ranges = [[-Lz, Lz], [0, R], [0, 2 * np.pi]]\n\n        aperture_integral_val, _ = integrate.nquad(aperture_integrand, ranges)\n        \n        # The aperture-averaged temperature shift\n        # <ΔT> = (1/πR^2) * K * Integral\n        avg_delta_T = K * aperture_integral_val / (np.pi * R**2)\n\n        results.extend([delta_T_los, avg_delta_T])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2414991"}]}