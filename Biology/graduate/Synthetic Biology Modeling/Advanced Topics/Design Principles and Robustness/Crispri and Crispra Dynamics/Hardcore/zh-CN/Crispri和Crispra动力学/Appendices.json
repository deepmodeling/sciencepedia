{
    "hands_on_practices": [
        {
            "introduction": "CRISPRi/a 技术的核心在于 dCas9-gRNA 复合物与 DNA 的结合。本练习将建立 CRISPR 效应子浓度与其靶点占有率在平衡状态下的基本定量关系。通过应用质量作用动力学，你将计算达到预期基因调控水平所需的效应子浓度，这是设计合成基因线路的一项基础技能。",
            "id": "3910261",
            "problem": "在成簇规律间隔短回文重复序列 (CRISPR) 系统中，包括 CRISPR 干扰 (CRISPRi) 和 CRISPR 激活 (CRISPRa)，一个失活的 Cas9 (dCas9) 蛋白与一个单导向 RNA (sgRNA) 形成复合物，此处表示为 dCas9-导向 RNA 复合物浓度 $[CG]$。考虑一个单一的基因组靶点，复合物在该靶点上以质量作用动力学进行结合和解离，且反应在伪一级条件下进行（$[CG]$ 恒定，靶点之间无竞争，无协同效应）。结合和解离速率常数分别为 $k_{\\text{on}}=10^{5}\\,\\text{M}^{-1}\\,\\text{s}^{-1}$ 和 $k_{\\text{off}}=10^{-2}\\,\\text{s}^{-1}$。将该位点被复合物占据的稳态分数定义为 $\\theta$。从质量作用动力学和稳态推理出发，确定在稳态下使 $\\theta \\geq 0.8$ 所需的最小 $[CG]$。以摩尔浓度 ($\\text{M}$) 表示最终浓度，并将答案四舍五入至 $2$ 位有效数字。此外，根据您的推导，讨论在固定的 $k_{\\text{off}}$ 和目标 $\\theta$ 下，最小 $[CG]$ 对结合速率常数 $k_{\\text{on}}$ 的敏感性。",
            "solution": "该问题经检验具有科学依据，表述清晰且客观。它基于应用于生物分子相互作用的化学动力学标准原理，这是合成生物学建模中的一种基本方法。所有必要的参数均已提供，所提问题清晰明确。\n\ndCas9-导向 RNA 复合物（浓度表示为 $[CG]$）与单个基因组靶点（表示为 $S$）之间的相互作用，可以用以下可逆反应表示：\n$$ S + CG \\rightleftharpoons CS $$\n其中 $CS$ 是复合物结合的靶点。正向（结合）和逆向（解离）反应的速率常数分别为 $k_{\\text{on}}$ 和 $k_{\\text{off}}$。\n\n在质量作用动力学假设下，结合速率为 $v_{\\text{on}} = k_{\\text{on}} [S] [CG]$，其中 $[S]$ 是游离（未结合）靶点的浓度。解离速率为 $v_{\\text{off}} = k_{\\text{off}} [CS]$，其中 $[CS]$ 是已结合靶点的浓度。\n\n在稳态下，结合速率等于解离速率：\n$$ v_{\\text{on}} = v_{\\text{off}} $$\n$$ k_{\\text{on}} [S] [CG] = k_{\\text{off}} [CS] $$\n\n根据这个等式，我们可以求出已结合靶点与游离靶点之比：\n$$ \\frac{[CS]}{[S]} = \\frac{k_{\\text{on}}}{k_{\\text{off}}} [CG] $$\n这种关系可以用解离常数 $K_d$ 来表示，它被定义为解离速率常数与结合速率常数之比：\n$$ K_d = \\frac{k_{\\text{off}}}{k_{\\text{on}}} $$\n将此代入前一个方程可得：\n$$ \\frac{[CS]}{[S]} = \\frac{[CG]}{K_d} $$\n\n问题将分数占据率 $\\theta$ 定义为被复合物结合的靶点占总靶点的比例。总靶点浓度 $[S]_{\\text{total}}$ 是游离靶点和已结合靶点浓度之和：$[S]_{\\text{total}} = [S] + [CS]$。因此，$\\theta$ 可由下式给出：\n$$ \\theta = \\frac{[CS]}{[S]_{\\text{total}}} = \\frac{[CS]}{[S] + [CS]} $$\n为了将 $\\theta$ 表示为 $[CG]$ 的函数，我们可以将分子和分母同时除以 $[S]$：\n$$ \\theta = \\frac{[CS]/[S]}{1 + [CS]/[S]} $$\n代入表达式 $\\frac{[CS]}{[S]} = \\frac{[CG]}{K_d}$：\n$$ \\theta = \\frac{[CG]/K_d}{1 + [CG]/K_d} = \\frac{[CG]}{K_d + [CG]} $$\n这是单个非协同结合位点的 Hill-Langmuir 方程。\n\n问题要求找到使分数占据率 $\\theta$ 至少为 $0.8$（即 $\\theta \\geq 0.8$）所需的最小浓度 $[CG]$。最小浓度将出现在边界条件 $\\theta = 0.8$ 处。我们可以重新整理关于 $\\theta$ 的方程来求解 $[CG]$：\n$$ \\theta (K_d + [CG]) = [CG] $$\n$$ \\theta K_d + \\theta [CG] = [CG] $$\n$$ \\theta K_d = [CG] - \\theta [CG] = [CG](1 - \\theta) $$\n$$ [CG] = K_d \\frac{\\theta}{1 - \\theta} $$\n\n现在，我们代入给定的数值。首先，我们计算解离常数 $K_d$：\n$$ K_d = \\frac{k_{\\text{off}}}{k_{\\text{on}}} = \\frac{10^{-2}\\,\\text{s}^{-1}}{10^{5}\\,\\text{M}^{-1}\\,\\text{s}^{-1}} = 10^{-7}\\,\\text{M} $$\n接下来，我们计算当 $\\theta = 0.8$ 时所需的 $[CG]$：\n$$ [CG] = (10^{-7}\\,\\text{M}) \\frac{0.8}{1 - 0.8} = (10^{-7}\\,\\text{M}) \\frac{0.8}{0.2} = (10^{-7}\\,\\text{M}) \\times 4 $$\n$$ [CG] = 4 \\times 10^{-7}\\,\\text{M} $$\n根据要求将此结果四舍五入至 $2$ 位有效数字，得到 $4.0 \\times 10^{-7}\\,\\text{M}$。\n\n接下来，我们讨论在保持 $k_{\\text{off}}$ 和目标占据率 $\\theta$ 恒定的情况下，所需最小浓度 $[CG]_{\\text{min}}$ 对结合速率常数 $k_{\\text{on}}$ 的敏感性。$[CG]_{\\text{min}}$ 的表达式为：\n$$ [CG]_{\\text{min}} = \\frac{k_{\\text{off}}}{k_{\\text{on}}} \\frac{\\theta}{1 - \\theta} $$\n由于 $k_{\\text{off}}$ 和 $\\theta$ 是固定的，因此 $k_{\\text{off}}\\frac{\\theta}{1-\\theta}$ 这一项是一个常数。我们称这个常数为 $C$。\n$$ [CG]_{\\text{min}} = \\frac{C}{k_{\\text{on}}} $$\n这个方程表明 $[CG]_{\\text{min}}$ 与 $k_{\\text{on}}$ 成反比。为了量化这种敏感性，我们可以计算弹性，即 $[CG]_{\\text{min}}$ 的分数变化与 $k_{\\text{on}}$ 的分数变化之比：\n$$ E = \\frac{d[CG]_{\\text{min}}}{[CG]_{\\text{min}}} \\bigg/ \\frac{dk_{\\text{on}}}{k_{\\text{on}}} = \\frac{d[CG]_{\\text{min}}}{dk_{\\text{on}}} \\frac{k_{\\text{on}}}{[CG]_{\\text{min}}} $$\n首先，我们计算 $[CG]_{\\text{min}}$ 关于 $k_{\\text{on}}$ 的导数：\n$$ \\frac{d[CG]_{\\text{min}}}{dk_{\\text{on}}} = \\frac{d}{dk_{\\text{on}}} \\left( C \\cdot k_{\\text{on}}^{-1} \\right) = -C \\cdot k_{\\text{on}}^{-2} = -\\frac{C}{k_{\\text{on}}^2} $$\n现在我们计算弹性：\n$$ E = \\left( -\\frac{C}{k_{\\text{on}}^2} \\right) \\frac{k_{\\text{on}}}{C/k_{\\text{on}}} = \\left( -\\frac{C}{k_{\\text{on}}^2} \\right) \\frac{k_{\\text{on}}^2}{C} = -1 $$\n$[CG]_{\\text{min}}$ 相对于 $k_{\\text{on}}$ 的弹性为 $-1$。这意味着结合速率常数 $k_{\\text{on}}$ 的任何百分比增加，都会导致达到目标占据率 $\\theta$ 所需的最小复合物浓度 $[CG]_{\\text{min}}$ 出现相同百分比的减少。例如，$k_{\\text{on}}$ 增加 $10\\%$ 会导致所需的 $[CG]_{\\text{min}}$ 减少 $10\\%$。这凸显了一种直接且强烈的反比关系：结合更快的复合物（更高的 $k_{\\text{on}}$）效率更高，需要按比例降低的浓度才能达到相同的基因组靶点饱和水平。",
            "answer": "$$\\boxed{4.0 \\times 10^{-7}}$$"
        },
        {
            "introduction": "实现高的靶点占有率是手段而非目的，最终目标是控制基因表达。本练习将生物物理结合与其功能性后果联系起来，通过建模展示靶点占有率如何转化为转录抑制。这个模型还引入了基因泄露表达这一在生物系统中普遍存在的复杂因素，让你能够更精确地预测基因抑制的效率。",
            "id": "3910276",
            "problem": "在一个经过成簇规律间隔短回文重复序列干扰（CRISPRi）技术改造的细菌细胞中，一个单一启动子驱动一个报告基因的转录。该过程由与单向导RNA（sgRNA）结合的催化失活Cas9（dCas9）介导。在没有CRISPRi效应子的情况下，该启动子以最大启动子驱动速率 $r_{\\text{max}}$ 产生转录本，并且由于不完全的转录沉默机制和基础聚合酶活性，还存在一个与效应子无关的额外泄露速率 $r_{\\text{leak}}$。当CRISPRi效应子复合物结合到靶位点时，它会在空间上阻碍有效的转录起始；设 $\\theta$ 表示dCas9–sgRNA复合物占据靶位点的平衡时间分数。假设存在单个结合位点，并且结合处于受质量作用定律支配的准稳态平衡，则占据率 $\\theta$ 由 $\\theta=\\frac{[C]}{[C]+K_{d}}$ 描述，其中 $[C]$ 是dCas9–sgRNA复合物的游离浓度，$K_{d}$ 是该复合物在靶位点上的解离常数。在这些条件下，启动子驱动对转录速率的有效贡献与位点未被占据的概率 $1-\\theta$ 成比例，而泄露贡献保持可加性且不受占据率的影响。定义泄露校正的倍数抑制为没有效应子时的总转录速率与效应子存在时的总转录速率之比。\n\n给定 $r_{\\text{max}}$ 为 $40$ 转录本/分钟，$r_{\\text{leak}}$ 为 $2$ 转录本/分钟，$K_{d}$ 为 $15$ 纳摩尔浓度，$[C]$ 为 $45$ 纳摩尔浓度，请推导一个用 $r_{\\text{max}}$、$r_{\\text{leak}}$ 和 $\\theta$ 表示的泄露校正倍数抑制的解析表达式，然后使用 $\\theta$ 的平衡关系式计算泄露校正倍数抑制的数值。将最终答案表示为无量纲小数，并四舍五入到四位有效数字。",
            "solution": "首先对问题陈述进行验证。\n\n### 步骤1：提取给定信息\n- 最大启动子驱动转录速率: $r_{\\text{max}}$\n- 泄露转录速率: $r_{\\text{leak}}$\n- dCas9–sgRNA复合物占据靶位点的平衡时间分数: $\\theta$\n- 占据率、复合物浓度和解离常数之间的关系: $\\theta=\\frac{[C]}{[C]+K_{d}}$\n- dCas9–sgRNA复合物的游离浓度: $[C]$\n- 复合物在靶位点上的解离常数: $K_{d}$\n- 启动子驱动对转录速率的有效贡献与位点未被占据的概率 $1-\\theta$ 成比例。\n- 泄露贡献是可加的且不受占据率影响。\n- 泄露校正倍数抑制 ($FR$) 的定义：没有效应子时的总转录速率与效应子存在时的总转录速率之比。\n- $r_{\\text{max}}$ 的值：$40$ 转录本/分钟。\n- $r_{\\text{leak}}$ 的值：$2$ 转录本/分钟。\n- $K_{d}$ 的值：$15$ 纳摩尔浓度。\n- $[C]$ 的值：$45$ 纳摩尔浓度。\n\n### 步骤2：使用提取的信息进行验证\n该问题具有科学依据，使用了基于空间位阻和质量作用定律的CRISPRi转录调控的标准且被广泛接受的数学模型。模型组件，如最大启动子活性、泄露表达和基于占据率的抑制，是定量分子生物学和合成生物学中的基本概念。该问题提法恰当，提供了推导解析表达式和计算唯一数值解所需的所有必要定义、关系和数值。语言客观、精确。所提供的转录速率、浓度和解离常数的数值在物理上和生物学上都是合理的。该问题不违反任何无效标准。\n\n### 步骤3：结论与行动\n该问题被认定为有效。将提供解答。\n\n任务是首先推导泄露校正倍数抑制的解析表达式，然后计算其数值。\n\n设 $R_{\\text{total}}$ 为总转录速率。该速率是启动子驱动速率和泄露速率之和。\n\n首先，我们定义在没有CRISPRi效应子的情况下的总转录速率。在这种状态下，dCas9–sgRNA复合物的浓度 $[C]$ 为 $0$。因此，占据率 $\\theta = \\frac{0}{0+K_{d}} = 0$。启动子从不被阻遏物占据。启动子驱动的转录以其最大速率 $r_{\\text{max}}$ 进行。我们记为 $R_{\\text{unrepressed}}$ 的总速率是这个最大速率和恒定泄露速率之和：\n$$R_{\\text{unrepressed}} = r_{\\text{max}} + r_{\\text{leak}}$$\n\n接下来，我们定义在有CRISPRi效应子存在的情况下的总转录速率。问题陈述中提到，启动子驱动的有效速率与位点未被占据的概率 $1-\\theta$ 成比例。泄露速率 $r_{\\text{leak}}$ 是可加的且不受影响。因此，效应子存在时的总速率，记为 $R_{\\text{repressed}}$，是：\n$$R_{\\text{repressed}} = r_{\\text{max}}(1-\\theta) + r_{\\text{leak}}$$\n\n泄露校正的倍数抑制 $FR$ 定义为没有效应子时的总转录速率与效应子存在时的总转录速率之比。\n$$FR = \\frac{R_{\\text{unrepressed}}}{R_{\\text{repressed}}}$$\n\n代入速率的表达式，我们得到用 $r_{\\text{max}}$、$r_{\\text{leak}}$ 和 $\\theta$ 表示的倍数抑制的解析表达式：\n$$FR = \\frac{r_{\\text{max}} + r_{\\text{leak}}}{r_{\\text{max}}(1-\\theta) + r_{\\text{leak}}}$$\n这就是所要求的解析表达式。\n\n现在，我们必须计算数值。首先，我们使用给定的 $[C]$ 和 $K_{d}$ 值计算占据率 $\\theta$：\n$[C] = 45$ nM\n$K_{d} = 15$ nM\n$$\\theta = \\frac{[C]}{[C]+K_{d}} = \\frac{45}{45 + 15} = \\frac{45}{60} = \\frac{3}{4} = 0.75$$\n\n有了 $\\theta$ 的值，我们现在可以使用给定的 $r_{\\text{max}}$ 和 $r_{\\text{leak}}$ 值来计算倍数抑制 $FR$：\n$r_{\\text{max}} = 40$ 转录本/分钟\n$r_{\\text{leak}} = 2$ 转录本/分钟\n$$FR = \\frac{40 + 2}{40(1 - 0.75) + 2}$$\n$$FR = \\frac{42}{40(0.25) + 2}$$\n$$FR = \\frac{42}{10 + 2}$$\n$$FR = \\frac{42}{12}$$\n$$FR = 3.5$$\n\n问题要求答案表示为无量纲小数，并四舍五入到四位有效数字。计算出的值 $3.5$ 必须写成 $3.500$ 以满足此要求。",
            "answer": "$$\\boxed{3.500}$$"
        },
        {
            "introduction": "在真实的细胞中，CRISPR 系统并非在真空中运行；它需要竞争资源，并可能与非预期的脱靶位点结合。这项高级练习要求你超越单个靶点的视角，在一个复杂系统中优化 gRNA 表达，以平衡高在靶活性与脱靶“海绵效应”之间的制约。这代表了合成生物学中一个核心的设计挑战：在复杂的细胞环境中实现精确和高效的调控。",
            "id": "3910214",
            "problem": "您正在为一个装载了单导向RNA（gRNA）的失活Cas9（dCas9）与一组基因组位点（包含一个靶上位点和多个脱靶位点）的结合平衡建模。对于成簇规律间隔短回文重复序列干扰（CRISPRi）和CRISPR激活（CRISPRa），主要的控制手段是gRNA的表达，它调节dCas9:gRNA复合物的丰度。在平衡状态下，一个位点被配体占据的分数由质量作用定律决定。您的任务是，对于测试套件中的每一组参数，确定能最大化靶上占有率的gRNA表达水平，同时满足限制脱靶封存的约束条件。\n\n从以下基础出发：\n- 平衡时的化学质量作用定律，它为单个非相互作用的结合位点提供了标准的配体占有率公式：位点$\\,i\\,$被浓度为$\\,L\\,$的游离配体占据的分数占有率$\\,\\theta_i\\,$由平衡解离常数$\\,K_{D,i}\\,$给出，公式为$\\,\\theta_i = \\dfrac{L}{K_{D,i} + L}\\,$。\n- 假设结合位点是独立且非协同的，配体（dCas9:gRNA复合物）的质量守恒：总复合物浓度$\\,X\\,$被分配给游离复合物和与各个位点结合的复合物。具体来说，如果有一个靶上位点，其有效结合容量为$\\,B_{\\mathrm{on}}\\,$，平衡解离常数为$\\,K_{D,\\mathrm{on}}\\,$；以及由$\\,j\\,$索引的多个脱靶位点，其容量为$\\,B_{\\mathrm{off},j}\\,$，解离常数为$\\,K_{D,\\mathrm{off},j}\\,$，那么质量守恒关系式为：\n$$\nX \\;=\\; L \\;+\\; B_{\\mathrm{on}}\\,\\frac{L}{K_{D,\\mathrm{on}} + L} \\;+\\; \\sum_j B_{\\mathrm{off},j}\\,\\frac{L}{K_{D,\\mathrm{off},j} + L}.\n$$\n- 假设dCas9:gRNA复合物的组装是高效的，并受限于可用的dCas9和gRNA表达量中的较小者，组装效率因子为$\\,\\alpha\\,$，因此$\\,X = \\alpha \\,\\min(C, G)\\,$，其中$\\,C\\,$是dCas9的供应量，$\\,G\\,$是gRNA的表达水平。\n\n定义以下量：\n- 靶上分数占有率 $\\,\\theta_{\\mathrm{on}} = \\dfrac{L}{K_{D,\\mathrm{on}} + L}\\,$。\n- 脱靶封存分数 $\\,f_{\\mathrm{off}} = \\dfrac{\\sum_j B_{\\mathrm{off},j}\\,\\dfrac{L}{K_{D,\\mathrm{off},j} + L}}{X}\\,$。\n- 可行的gRNA表达水平满足 $\\,0 \\le G \\le G_{\\max}\\,$ 和 $\\,f_{\\mathrm{off}} \\le f_{\\max}\\,$。\n\n对于每组参数，构建约束优化问题：\n- 在满足$\\,f_{\\mathrm{off}}(G) \\le f_{\\max}\\,$和$\\,0 \\le G \\le G_{\\max}\\,$的条件下，最大化关于$\\,G\\,$的$\\,\\theta_{\\mathrm{on}}(G)\\,$。\n- 此处，对于由$\\,G\\,$决定的给定$\\,X\\,$，$\\,L\\,$是质量守恒方程在$\\,[0,X]\\,$区间内的唯一解，并且$\\,X = \\alpha\\,\\min(C,G)\\,$。\n\n所有量都是无量纲浓度，已经归一化到一个共同的内部参考标准，因此本练习不需要绝对单位。\n\n您的程序必须：\n- 对于每个测试用例，计算在规定约束下最大化$\\,\\theta_{\\mathrm{on}}\\,$的最优$\\,G^\\star\\,$，在每个$\\,G\\,$值下使用正确的数值解法求解关于$\\,L\\,$的质量守恒关系式。\n- 如果多个$\\,G\\,$值在满足约束的同时产生相同的最大$\\,\\theta_{\\mathrm{on}}\\,$，则返回其中最小的$\\,G\\,$。\n\n测试套件：\n为以下参数集提供结果。每个集合指定为一个元组$\\,\\left(C,\\,\\alpha,\\,G_{\\max},\\,K_{D,\\mathrm{on}},\\,B_{\\mathrm{on}},\\,\\{K_{D,\\mathrm{off},j}\\},\\,\\{B_{\\mathrm{off},j}\\},\\,f_{\\max}\\right)\\,$。\n\n- 情况$\\,1\\,$（理想路径，中等脱靶效应）：\n  - $\\,C = 100\\,$, $\\,\\alpha = 0.9\\,$, $\\,G_{\\max} = 200\\,$, $\\,K_{D,\\mathrm{on}} = 0.1\\,$, $\\,B_{\\mathrm{on}} = 1.0\\,$,\n  - $\\,\\{K_{D,\\mathrm{off},j}\\} = \\{0.5,\\,1.0,\\,2.0,\\,5.0,\\,10.0\\}\\,$,\n  - $\\,\\{B_{\\mathrm{off},j}\\} = \\{5.0,\\,5.0,\\,10.0,\\,10.0,\\,20.0\\}\\,$,\n  - $\\,f_{\\max} = 0.3\\,$.\n\n- 情况$\\,2\\,$（严格的脱靶约束，边界行为）：\n  - $\\,C = 100\\,$, $\\,\\alpha = 0.9\\,$, $\\,G_{\\max} = 200\\,$, $\\,K_{D,\\mathrm{on}} = 0.1\\,$, $\\,B_{\\mathrm{on}} = 1.0\\,$,\n  - $\\,\\{K_{D,\\mathrm{off},j}\\} = \\{0.5,\\,1.0,\\,2.0,\\,5.0,\\,10.0\\}\\,$,\n  - $\\,\\{B_{\\mathrm{off},j}\\} = \\{5.0,\\,5.0,\\,10.0,\\,10.0,\\,20.0\\}\\,$,\n  - $\\,f_{\\max} = 0.05\\,$.\n\n- 情况$\\,3\\,$（dCas9限制体系，更高的脱靶容量）：\n  - $\\,C = 30\\,$, $\\,\\alpha = 0.8\\,$, $\\,G_{\\max} = 200\\,$, $\\,K_{D,\\mathrm{on}} = 0.2\\,$, $\\,B_{\\mathrm{on}} = 1.0\\,$,\n  - $\\,\\{K_{D,\\mathrm{off},j}\\} = \\{0.3,\\,0.7,\\,1.5,\\,3.0,\\,6.0\\}\\,$,\n  - $\\,\\{B_{\\mathrm{off},j}\\} = \\{8.0,\\,12.0,\\,15.0,\\,20.0,\\,25.0\\}\\,$,\n  - $\\,f_{\\max} = 0.2\\,$.\n\n- 情况$\\,4\\,$（较弱的靶上亲和力，不同的脱靶谱）：\n  - $\\,C = 100\\,$, $\\,\\alpha = 0.9\\,$, $\\,G_{\\max} = 200\\,$, $\\,K_{D,\\mathrm{on}} = 2.0\\,$, $\\,B_{\\mathrm{on}} = 1.0\\,$,\n  - $\\,\\{K_{D,\\mathrm{off},j}\\} = \\{1.0,\\,2.0,\\,4.0,\\,8.0\\}\\,$,\n  - $\\,\\{B_{\\mathrm{off},j}\\} = \\{5.0,\\,10.0,\\,15.0,\\,30.0\\}\\,$,\n  - $\\,f_{\\max} = 0.3\\,$.\n\n输出规范：\n- 您的程序应生成单行输出，其中包含四个测试用例按顺序排列的最优gRNA表达水平$\\,G^\\star\\,$，格式为用方括号括起来的逗号分隔列表，例如$\\,\\left[ g_1, g_2, g_3, g_4 \\right]\\,$。每个$\\,g_i\\,$必须是浮点数。不应打印其他任何文本。",
            "solution": "该问题要求找到最优的gRNA表达水平（表示为$G$），以最大化靶上分数占有率$\\theta_{\\mathrm{on}}$，同时满足对总可用gRNA的约束以及对被脱靶位点封存的dCas9:gRNA复合物分数$f_{\\mathrm{off}}$的约束。这是一个基于化学平衡和质量守恒原理的约束优化问题。\n\n对于给定的gRNA表达水平$G$，系统的状态由dCas9:gRNA复合物的游离浓度（表示为$L$）决定。首先，已组装复合物的总浓度$X$由dCas9供应量$C$、gRNA表达水平$G$和组装效率$\\alpha$决定：\n$$X = \\alpha \\min(C, G)$$\n这个总复合物浓度$X$被分配给游离复合物$L$以及与靶上和各种脱靶位点结合的复合物。质量守恒定律提供了以下关系：\n$$X = L + B_{\\mathrm{on}}\\frac{L}{K_{D,\\mathrm{on}} + L} + \\sum_j B_{\\mathrm{off},j}\\frac{L}{K_{D,\\mathrm{off},j} + L}$$\n其中$B_{\\mathrm{on}}$和$B_{\\mathrm{off},j}$分别是靶上位点和脱靶位点的结合容量，$K_{D,\\mathrm{on}}$和$K_{D,\\mathrm{off},j}$分别是它们的平衡解离常数。对于任何给定的$X \\ge 0$，该方程对于$L$有唯一的非负解。让我们定义函数 $F(L, X) = L + \\sum_i B_i \\frac{L}{K_{D,i} + L} - X$，其中求和遍历所有结合位点。导数 $\\frac{\\partial F}{\\partial L} = 1 + \\sum_i B_i \\frac{K_{D,i}}{(K_{D,i} + L)^2}$ 对于$L \\ge 0$是严格为正的。这确保了$F(L, X)$是$L$的单调递增函数，从而保证对于任何给定的$X$，$L$都有唯一的解。这个解可以使用求根算法（如Brent-Dekker方法）进行数值求解。$L$的搜索区间是$[0, X]$。\n\n该优化问题可正式表述为：\n$$ \\text{Maximize } \\theta_{\\mathrm{on}}(G) = \\frac{L(G)}{K_{D,\\mathrm{on}} + L(G)} $$\n$$ \\text{subject to: } \\quad 0 \\le G \\le G_{\\max} \\quad \\text{and} \\quad f_{\\mathrm{off}}(G) = \\frac{\\sum_j B_{\\mathrm{off},j}\\frac{L(G)}{K_{D,\\mathrm{off},j} + L(G)}}{X(G)} \\le f_{\\max} $$\n\n为了解决这个问题，我们分析目标函数$\\theta_{\\mathrm{on}}(G)$的行为。gRNA表达量$G$决定了$X$。当$G$在$[0, C]$范围内增加时，$X(G) = \\alpha G$也随之增加。将隐函数定理应用于$F(L,X)=0$表明$\\frac{dL}{dX} > 0$，因此$L$是$X$的单调递增函数。由于$\\theta_{\\mathrm{on}}(L)$是$L$的单调递增函数，因此对于$G \\in [0, C]$，$\\theta_{\\mathrm{on}}(G)$是$G$的单调递增函数。对于$G > C$，$X$变为常数（$X = \\alpha C$），这意味着$L$也是常数，因此对于$G > C$，$\\theta_{\\mathrm{on}}(G)$是常数。因此，$\\theta_{\\mathrm{on}}(G)$在其整个定义域$[0, G_{\\max}]$上是一个单调不减函数。\n\n这种单调性简化了优化过程。要最大化$\\theta_{\\mathrm{on}}(G)$，我们必须找到满足约束条件的最大可能$G$值。设$S_{\\mathrm{feasible}} = \\{G \\in [0, G_{\\max}] \\mid f_{\\mathrm{off}}(G) \\le f_{\\max}\\}$。我们寻求$G_{\\text{max_feasible}} = \\sup S_{\\mathrm{feasible}}$。最大靶上占有率将是$\\theta_{\\mathrm{on}}^\\star = \\theta_{\\mathrm{on}}(G_{\\text{max_feasible}})$。\n\n求解策略如下：\n1.  确定最大的可行gRNA表达水平$G_{\\text{max_feasible}}$。\n    a.  首先，在上界$G = G_{\\max}$处评估约束条件。如果$f_{\\mathrm{off}}(G_{\\max}) \\le f_{\\max}$，则整个区间$[0, G_{\\max}]$都是可行的。因此，$G_{\\text{max_feasible}} = G_{\\max}$。\n    b.  如果$f_{\\mathrm{off}}(G_{\\max}) > f_{\\max}$，则在$G_{\\max}$处违反了约束。我们必须找到可行区域的边界。脱靶分数$f_{\\mathrm{off}}(G)$通常是$G$的单调递增函数（因为增加的总复合物会饱和高亲和力的靶上位点，导致更大比例的额外复合物与低亲和力的脱靶位点结合）。我们可以定义$f_{\\mathrm{off}}(0) = 0$。鉴于$f_{\\mathrm{off}}(0) \\le f_{\\max}$和$f_{\\mathrm{off}}(G_{\\max}) > f_{\\max}$，在$(0, G_{\\max})$区间内必然存在一个$G$值，使得$f_{\\mathrm{off}}(G) = f_{\\max}$。这个值代表了允许的最大$G$值，可以通过求解在区间$[0, G_{\\max}]$上的求根问题$h(G) = f_{\\mathrm{off}}(G) - f_{\\max} = 0$来找到。这个根就是$G_{\\text{max_feasible}}$。\n\n2.  根据平局决胜规则确定最终的最优值$G^\\star$。该规则规定，如果多个$G$值产生相同的最大$\\theta_{\\mathrm{on}}$，则应返回其中最小的$G$值。\n    a.  我们已经确定，对于所有$G \\ge C$，$\\theta_{\\mathrm{on}}(G)$是常数。\n    b.  如果$G_{\\text{max_feasible}} \\le C$，则函数$\\theta_{\\mathrm{on}}(G)$在可行域$[0, G_{\\text{max_feasible}}]$上是严格递增的。最大占有率$\\theta_{\\mathrm{on}}^\\star$仅在$G = G_{\\text{max_feasible}}$处唯一达到。因此，$G^\\star = G_{\\text{max_feasible}}$。\n    c.  如果$G_{\\text{max_feasible}} > C$，则最大占有率$\\theta_{\\mathrm{on}}^\\star$在区间$[C, G_{\\text{max_feasible}}]$内的所有$G$值处都能达到。由于脱靶分数$f_{\\mathrm{off}}(G)$在$G \\ge C$时也是常数，并且点$G_{\\text{max_feasible}}$是可行的，所以整个区间$[C, G_{\\text{max_feasible}}]$都是可行的。根据平局决胜规则，我们必须选择该范围内的最小$G$值，即$C$。因此，$G^\\star = C$。\n\n该算法通过嵌套两个数值求根步骤来实现：一个用于从$X(G)$求解$L$，另一个外部步骤用于在必要时求解满足约束边界$f_{\\mathrm{off}}(G) = f_{\\max}$的最优$G^\\star$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Main function to solve the optimization problem for all test cases and print the results.\n    \"\"\"\n    # Test Suite:\n    # (C, alpha, G_max, K_D_on, B_on, {K_D_off_j}, {B_off_j}, f_max)\n    test_cases = [\n        (100.0, 0.9, 200.0, 0.1, 1.0, [0.5, 1.0, 2.0, 5.0, 10.0], [5.0, 5.0, 10.0, 10.0, 20.0], 0.3),\n        (100.0, 0.9, 200.0, 0.1, 1.0, [0.5, 1.0, 2.0, 5.0, 10.0], [5.0, 5.0, 10.0, 10.0, 20.0], 0.05),\n        (30.0, 0.8, 200.0, 0.2, 1.0, [0.3, 0.7, 1.5, 3.0, 6.0], [8.0, 12.0, 15.0, 20.0, 25.0], 0.2),\n        (100.0, 0.9, 200.0, 2.0, 1.0, [1.0, 2.0, 4.0, 8.0], [5.0, 10.0, 15.0, 30.0], 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        C, alpha, G_max, K_D_on, B_on, K_D_off, B_off, f_max = case\n        g_star = calculate_optimal_g(C, alpha, G_max, K_D_on, B_on, K_D_off, B_off, f_max)\n        results.append(g_star)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\ndef calculate_optimal_g(C, alpha, G_max, K_D_on, B_on, K_D_off, B_off, f_max):\n    \"\"\"\n    Calculates the optimal gRNA expression level G* for a single parameter set.\n    \"\"\"\n    K_D_all_sites = [K_D_on] + K_D_off\n    B_all_sites = [B_on] + B_off\n    \n    # Memoization cache for f_off(G) to speed up root finding if needed\n    memo_f_off = {}\n\n    def get_f_off(G):\n        \"\"\"\n        Calculates the off-target sequestration fraction f_off for a given G.\n        \"\"\"\n        G_val = float(G)\n        if G_val in memo_f_off:\n            return memo_f_off[G_val]\n\n        # At G=0, there is no complex, so no sequestration.\n        if G_val = 1e-12:\n            return 0.0\n\n        X = alpha * min(C, G_val)\n        if X = 1e-12:\n            return 0.0\n\n        def mass_balance_residual(L, current_X):\n            \"\"\"Defines the function whose root is the free ligand concentration L.\"\"\"\n            bound_sum = np.sum([\n                B * L / (K_D + L) for B, K_D in zip(B_all_sites, K_D_all_sites) if K_D + L > 0\n            ])\n            return L + bound_sum - current_X\n        \n        # Solve for L using a robust root-finding method.\n        # The free concentration L must be in the interval [0, X].\n        sol_L = root_scalar(mass_balance_residual, args=(X,), bracket=[0, X], method='brentq')\n        L = sol_L.root\n\n        # Calculate total concentration of complex bound to off-target sites.\n        off_target_bound = np.sum([\n            B * L / (K_D + L) for B, K_D in zip(B_off, K_D_off) if K_D + L > 0\n        ])\n        \n        result_f_off = off_target_bound / X\n        memo_f_off[G_val] = result_f_off\n        return result_f_off\n\n    # 1. Find the maximum feasible G, denoted G_max_feasible.\n    f_off_at_g_max = get_f_off(G_max)\n    \n    g_max_feasible = 0.0\n    if f_off_at_g_max = f_max:\n        # If G_max is feasible, it's the largest feasible G since f_off is monotonic.\n        g_max_feasible = G_max\n    else:\n        # If G_max is not feasible, the optimal G is at the constraint boundary.\n        # Find the root of f_off(G) - f_max = 0.\n        def constraint_violation_func(G):\n            return get_f_off(G) - f_max\n\n        # The root must lie in [0, G_max] because f_off(0) = f_max and f_off(G_max) > f_max.\n        sol_G = root_scalar(constraint_violation_func, bracket=[0, G_max], method='brentq')\n        g_max_feasible = sol_G.root\n\n    # 2. Apply the tie-breaking rule considering the dCas9-limited regime (G > C).\n    # If G_max_feasible is in the dCas9-limited regime, theta_on and f_off are constant for G >= C.\n    # The smallest G that achieves max theta_on is C.\n    if g_max_feasible > C:\n        # Check if C itself is a feasible point. f_off is monotonic increasing up to C,\n        # then constant. Since g_max_feasible is feasible, and f_off(g_max_feasible) >= f_off(C),\n        # then C is also feasible.\n        return C\n    else:\n        # If G_max_feasible = C, theta_on is strictly increasing, so the optimum is unique.\n        return g_max_feasible\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}