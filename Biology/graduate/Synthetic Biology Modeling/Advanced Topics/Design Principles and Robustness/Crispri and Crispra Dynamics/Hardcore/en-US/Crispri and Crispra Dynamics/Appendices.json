{
    "hands_on_practices": [
        {
            "introduction": "At the heart of CRISPRi/a systems lies the reversible binding of a dCas9-guide complex to a specific DNA target. This exercise establishes the foundational quantitative model for this process at equilibrium, using mass-action principles to relate effector concentration to target occupancy. Solving for the concentration required to achieve a desired level of gene regulation is a fundamental skill in synthetic biology, and this problem solidifies your understanding of the governing Hill-Langmuir isotherm.",
            "id": "3910261",
            "problem": "In Clustered Regularly Interspaced Short Palindromic Repeats (CRISPR) systems, including CRISPR interference (CRISPRi) and CRISPR activation (CRISPRa), a deactivated Cas9 (dCas9) protein forms a complex with a single guide RNA (sgRNA), with concentration $[C]$. Consider a single genomic target site to which the complex binds and unbinds with mass-action kinetics under pseudo-first-order conditions (constant $[C]$, no competition among sites, no cooperativity). The association and dissociation rate constants are $k_{\\text{on}}=10^{5}\\,\\text{M}^{-1}\\,\\text{s}^{-1}$ and $k_{\\text{off}}=10^{-2}\\,\\text{s}^{-1}$, respectively. Define the steady-state fractional occupancy of the site by the complex as $\\theta$. Starting from mass-action kinetics and steady-state reasoning, determine the minimal $[C]$ required such that $\\theta \\geq 0.8$ at steady state. Express your final concentration in molar ($\\text{M}$) and round your answer to $2$ significant figures. Additionally, based on your derivation, discuss the sensitivity of the minimal $[C]$ to the association rate constant $k_{\\text{on}}$ at fixed $k_{\\text{off}}$ and target $\\theta$.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is based on standard principles of chemical kinetics applied to biomolecular interactions, which is a fundamental approach in synthetic biology modeling. All necessary parameters are provided, and the questions asked are unambiguous.\n\nThe interaction between the dCas9–guide complex, with concentration $[C]$, and a single genomic target site, denoted by $S$, can be represented by the reversible reaction:\n$$ S + C \\rightleftharpoons CS $$\nwhere $CS$ is the complex-bound site. The rate constants for the forward (association) and reverse (dissociation) reactions are $k_{\\text{on}}$ and $k_{\\text{off}}$, respectively.\n\nUnder the assumption of mass-action kinetics, the rate of association is $v_{\\text{on}} = k_{\\text{on}} [S] [C]$, where $[S]$ is the concentration of the free (unbound) target site. The rate of dissociation is $v_{\\text{off}} = k_{\\text{off}} [CS]$, where $[CS]$ is the concentration of the bound target site.\n\nAt steady state, the rate of association equals the rate of dissociation:\n$$ v_{\\text{on}} = v_{\\text{off}} $$\n$$ k_{\\text{on}} [S] [C] = k_{\\text{off}} [CS] $$\n\nFrom this equality, we can find the ratio of bound to free sites:\n$$ \\frac{[CS]}{[S]} = \\frac{k_{\\text{on}}}{k_{\\text{off}}} [C] $$\nThis relationship can be expressed in terms of the dissociation constant, $K_D$, which is defined as the ratio of the dissociation rate constant to the association rate constant:\n$$ K_D = \\frac{k_{\\text{off}}}{k_{\\text{on}}} $$\nSubstituting this into the previous equation gives:\n$$ \\frac{[CS]}{[S]} = \\frac{[C]}{K_D} $$\n\nThe problem defines the fractional occupancy, $\\theta$, as the fraction of total target sites that are bound by the complex. The total concentration of target sites, $[S]_{\\text{total}}$, is the sum of the free and bound sites: $[S]_{\\text{total}} = [S] + [CS]$. Thus, $\\theta$ is given by:\n$$ \\theta = \\frac{[CS]}{[S]_{\\text{total}}} = \\frac{[CS]}{[S] + [CS]} $$\nTo express $\\theta$ as a function of $[C]$, we can divide the numerator and the denominator by $[S]$:\n$$ \\theta = \\frac{[CS]/[S]}{1 + [CS]/[S]} $$\nSubstituting the expression $\\frac{[CS]}{[S]} = \\frac{[C]}{K_D}$:\n$$ \\theta = \\frac{[C]/K_D}{1 + [C]/K_D} = \\frac{[C]}{K_D + [C]} $$\nThis is the Hill-Langmuir equation for a single non-cooperative binding site.\n\nThe problem requires finding the minimal concentration $[C]$ such that the fractional occupancy $\\theta$ is at least $0.8$, i.e., $\\theta \\geq 0.8$. The minimal concentration will occur at the boundary condition, $\\theta = 0.8$. We can rearrange the equation for $\\theta$ to solve for $[C]$:\n$$ \\theta (K_D + [C]) = [C] $$\n$$ \\theta K_D + \\theta [C] = [C] $$\n$$ \\theta K_D = [C] - \\theta [C] = [C](1 - \\theta) $$\n$$ [C] = K_D \\frac{\\theta}{1 - \\theta} $$\n\nNow, we substitute the given values. First, we calculate the dissociation constant $K_D$:\n$$ K_D = \\frac{k_{\\text{off}}}{k_{\\text{on}}} = \\frac{10^{-2}\\,\\text{s}^{-1}}{10^{5}\\,\\text{M}^{-1}\\,\\text{s}^{-1}} = 10^{-7}\\,\\text{M} $$\nNext, we calculate the required $[C]$ for $\\theta = 0.8$:\n$$ [C] = (10^{-7}\\,\\text{M}) \\frac{0.8}{1 - 0.8} = (10^{-7}\\,\\text{M}) \\frac{0.8}{0.2} = (10^{-7}\\,\\text{M}) \\times 4 $$\n$$ [C] = 4 \\times 10^{-7}\\,\\text{M} $$\nRounding this result to $2$ significant figures as requested gives $4.0 \\times 10^{-7}\\,\\text{M}$.\n\nNext, we address the sensitivity of the minimal required concentration, $[C]_{\\text{min}}$, to the association rate constant, $k_{\\text{on}}$, while holding $k_{\\text{off}}$ and the target occupancy $\\theta$ constant. The expression for $[C]_{\\text{min}}$ is:\n$$ [C]_{\\text{min}} = \\frac{k_{\\text{off}}}{k_{\\text{on}}} \\frac{\\theta}{1 - \\theta} $$\nSince $k_{\\text{off}}$ and $\\theta$ are fixed, the term $k_{\\text{off}}\\frac{\\theta}{1-\\theta}$ is a constant. Let's call this constant $C_{const}$.\n$$ [C]_{\\text{min}} = \\frac{C_{const}}{k_{\\text{on}}} $$\nThis equation shows that $[C]_{\\text{min}}$ is inversely proportional to $k_{\\text{on}}$. To quantify this sensitivity, we can calculate the elasticity, which is the ratio of the fractional change in $[C]_{\\text{min}}$ to the fractional change in $k_{\\text{on}}$:\n$$ E = \\frac{d[C]_{\\text{min}}}{[C]_{\\text{min}}} \\bigg/ \\frac{dk_{\\text{on}}}{k_{\\text{on}}} = \\frac{d[C]_{\\text{min}}}{dk_{\\text{on}}} \\frac{k_{\\text{on}}}{[C]_{\\text{min}}} $$\nFirst, we compute the derivative of $[C]_{\\text{min}}$ with respect to $k_{\\text{on}}$:\n$$ \\frac{d[C]_{\\text{min}}}{dk_{\\text{on}}} = \\frac{d}{dk_{\\text{on}}} \\left( C_{const} \\cdot k_{\\text{on}}^{-1} \\right) = -C_{const} \\cdot k_{\\text{on}}^{-2} = -\\frac{C_{const}}{k_{\\text{on}}^2} $$\nNow we compute the elasticity:\n$$ E = \\left( -\\frac{C_{const}}{k_{\\text{on}}^2} \\right) \\frac{k_{\\text{on}}}{C_{const}/k_{\\text{on}}} = \\left( -\\frac{C_{const}}{k_{\\text{on}}^2} \\right) \\frac{k_{\\text{on}}^2}{C_{const}} = -1 $$\nThe elasticity of $[C]_{\\text{min}}$ with respect to $k_{\\text{on}}$ is $-1$. This means that a given percentage increase in the association rate constant $k_{\\text{on}}$ results in the same percentage decrease in the minimal complex concentration $[C]_{\\text{min}}$ required to achieve the target occupancy $\\theta$. For example, a $10\\%$ increase in $k_{\\text{on}}$ leads to a $10\\%$ decrease in the required $[C]_{\\text{min}}$. This highlights a direct and strong inverse relationship: a more rapidly binding complex (higher $k_{\\text{on}}$) is more efficient, requiring a proportionally lower concentration to achieve the same level of genomic target saturation.",
            "answer": "$$\\boxed{4.0 \\times 10^{-7}}$$"
        },
        {
            "introduction": "Connecting biophysical parameters to functional outputs is a crucial step in predictive modeling. This practice builds upon the concept of equilibrium occupancy to predict its effect on gene expression, a measurable biological outcome . By incorporating the non-ideal but realistic feature of leaky transcription, you will learn to calculate the fold repression, a standard metric for quantifying the performance of a genetic regulator.",
            "id": "3910276",
            "problem": "A single promoter drives transcription of a reporter gene in a bacterial cell engineered with Clustered Regularly Interspaced Short Palindromic Repeats interference (CRISPRi), mediated by catalytically dead Cas9 (dCas9) bound to a single-guide RNA (sgRNA). In the absence of the CRISPRi effector, the promoter produces transcripts at a maximal promoter-driven rate $r_{\\text{max}}$ and, due to incomplete transcriptional silencing mechanisms and basal polymerase activity, at an additional leak rate $r_{\\text{leak}}$ that is independent of the effector. When the CRISPRi effector complex binds the target site, it sterically occludes productive transcription initiation; let $\\theta$ denote the equilibrium fraction of time the target site is occupied by the dCas9–sgRNA complex. Assuming a single binding site and quasi-steady binding equilibrium governed by the law of mass action, the occupancy is described by $\\theta=\\frac{[C]}{[C]+K_{D}}$, where $[C]$ is the free concentration of the dCas9–sgRNA complex and $K_{D}$ is the dissociation constant for the complex at the target site. Under these conditions, the productive promoter-driven contribution to the transcription rate scales with the probability that the site is unoccupied, $1-\\theta$, while the leak contribution remains additive and unaffected by occupancy. Define the leak-adjusted fold repression as the ratio of total transcription rate without the effector to the total transcription rate with the effector present.\n\nGiven $r_{\\text{max}}$ is $40$ transcripts per minute, $r_{\\text{leak}}$ is $2$ transcripts per minute, $K_{D}$ is $15$ nanomolar, and $[C]$ is $45$ nanomolar, derive an analytic expression for the leak-adjusted fold repression in terms of $r_{\\text{max}}$, $r_{\\text{leak}}$, and $\\theta$, then use the equilibrium relation for $\\theta$ to compute the numerical value of the leak-adjusted fold repression. Express your final answer as a dimensionless decimal and round your answer to four significant figures.",
            "solution": "The problem statement is first subjected to validation.\n\n### Step 1: Extract Givens\n- Maximal promoter-driven transcription rate: $r_{\\text{max}}$\n- Leak transcription rate: $r_{\\text{leak}}$\n- Equilibrium fraction of time the target site is occupied by the dCas9–sgRNA complex: $\\theta$\n- Relationship between occupancy, complex concentration, and dissociation constant: $\\theta=\\frac{[C]}{[C]+K_{D}}$\n- Free concentration of the dCas9–sgRNA complex: $[C]$\n- Dissociation constant for the complex at the target site: $K_{D}$\n- The productive promoter-driven contribution to the transcription rate scales with the probability that the site is unoccupied, $1-\\theta$.\n- The leak contribution is additive and unaffected by occupancy.\n- Definition of leak-adjusted fold repression ($FR$): the ratio of total transcription rate without the effector to the total transcription rate with the effector present.\n- Value of $r_{\\text{max}}$: $40$ transcripts per minute.\n- Value of $r_{\\text{leak}}$: $2$ transcripts per minute.\n- Value of $K_{D}$: $15$ nanomolar.\n- Value of $[C]$: $45$ nanomolar.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, using a standard and widely accepted mathematical model for transcriptional regulation by CRISPRi based on steric hindrance and the law of mass action. The model components, such as maximal promoter activity, leaky expression, and occupancy-based repression, are fundamental concepts in quantitative molecular biology and synthetic biology. The problem is well-posed, providing all necessary definitions, relationships, and numerical values to derive an analytic expression and compute a unique numerical solution. The language is objective and precise. The numerical values provided for transcription rates, concentrations, and the dissociation constant are physically and biologically plausible. The problem does not violate any of the criteria for invalidity.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. A solution will be provided.\n\nThe task is to first derive an analytic expression for the leak-adjusted fold repression and then compute its numerical value.\n\nLet $R_{\\text{total}}$ be the total transcription rate. This rate is the sum of the promoter-driven rate and the leak rate.\n\nFirst, we define the total transcription rate in the absence of the CRISPRi effector. In this state, the concentration of the dCas9–sgRNA complex $[C]$ is $0$. Consequently, the occupancy $\\theta = \\frac{0}{0+K_{D}} = 0$. The promoter is never occupied by the repressor. The promoter-driven transcription occurs at its maximal rate, $r_{\\text{max}}$. The total rate, which we denote $R_{\\text{unrepressed}}$, is the sum of this maximal rate and the constant leak rate:\n$$R_{\\text{unrepressed}} = r_{\\text{max}} + r_{\\text{leak}}$$\n\nNext, we define the total transcription rate in the presence of the CRISPRi effector. The problem states that the productive promoter-driven rate scales with the probability that the site is unoccupied, which is $1-\\theta$. The leak rate $r_{\\text{leak}}$ is additive and unaffected. Therefore, the total rate in the presence of the effector, denoted $R_{\\text{repressed}}$, is:\n$$R_{\\text{repressed}} = r_{\\text{max}}(1-\\theta) + r_{\\text{leak}}$$\n\nThe leak-adjusted fold repression, $FR$, is defined as the ratio of the total transcription rate without the effector to the total transcription rate with the effector.\n$$FR = \\frac{R_{\\text{unrepressed}}}{R_{\\text{repressed}}}$$\n\nSubstituting the expressions for the rates, we obtain the analytic expression for the fold repression in terms of $r_{\\text{max}}$, $r_{\\text{leak}}$, and $\\theta$:\n$$FR = \\frac{r_{\\text{max}} + r_{\\text{leak}}}{r_{\\text{max}}(1-\\theta) + r_{\\text{leak}}}$$\nThis is the required analytic expression.\n\nNow, we must compute the numerical value. First, we calculate the occupancy $\\theta$ using the given values for $[C]$ and $K_{D}$:\n$[C] = 45$ nM\n$K_{D} = 15$ nM\n$$\\theta = \\frac{[C]}{[C]+K_{D}} = \\frac{45}{45 + 15} = \\frac{45}{60} = \\frac{3}{4} = 0.75$$\n\nWith the value of $\\theta$, we can now compute the fold repression $FR$ using the provided values for $r_{\\text{max}}$ and $r_{\\text{leak}}$:\n$r_{\\text{max}} = 40$ transcripts/minute\n$r_{\\text{leak}} = 2$ transcripts/minute\n$$FR = \\frac{40 + 2}{40(1 - 0.75) + 2}$$\n$$FR = \\frac{42}{40(0.25) + 2}$$\n$$FR = \\frac{42}{10 + 2}$$\n$$FR = \\frac{42}{12}$$\n$$FR = 3.5$$\n\nThe problem requires the answer to be expressed as a dimensionless decimal rounded to four significant figures. The calculated value $3.5$ must be written as $3.500$ to satisfy this requirement.",
            "answer": "$$\\boxed{3.500}$$"
        },
        {
            "introduction": "Effective CRISPR-based tools must be both potent at their intended target and specific enough to avoid unintended effects. This advanced computational practice scales up our model to a systems level, accounting for competition between an on-target site and numerous off-target sites for a limited pool of dCas9-gRNA complexes. You will tackle a realistic design challenge: optimizing guide RNA expression to maximize on-target activity while controlling the total amount of off-target binding, a critical trade-off in therapeutic and synthetic circuit design.",
            "id": "3910214",
            "problem": "You are modeling the binding equilibrium of deactivated Cas9 (dCas9) loaded with a single guide RNA (gRNA) to a set of genomic sites comprising one on-target site and many off-target sites. For Clustered Regularly Interspaced Short Palindromic Repeats interference (CRISPRi) and CRISPR activation (CRISPRa), the primary control lever is gRNA expression, which tunes the abundance of the dCas9:gRNA complex. At equilibrium, the fraction of a site occupied by ligand is governed by mass action. Your task is to determine, for each parameter set in the test suite, the gRNA expression level that maximizes on-target occupancy subject to a constraint limiting off-target sequestration.\n\nStart from the following foundational base:\n- Chemical mass action at equilibrium, which yields the standard ligand occupancy formula for a single, non-interacting binding site: the fractional occupancy $\\theta_i$ of site $i$ by a ligand at free concentration $L$ and equilibrium dissociation constant $K_{D,i}$ is given by $\\theta_i = \\frac{L}{K_{D,i} + L}$.\n- Mass conservation for the ligand (the dCas9:gRNA complex) under the assumption that binding sites are independent and non-cooperative: the total complex concentration $X$ is split among free complex and complexes bound to each site. Specifically, if there is one on-target site with effective binding capacity $B_{\\mathrm{on}}$ and equilibrium dissociation constant $K_{D,\\mathrm{on}}$, and off-target sites indexed by $j$ with capacities $B_{\\mathrm{off},j}$ and dissociation constants $K_{D,\\mathrm{off},j}$, then the mass conservation relation is:\n$$\nX = L + B_{\\mathrm{on}}\\frac{L}{K_{D,\\mathrm{on}} + L} + \\sum_j B_{\\mathrm{off},j}\\frac{L}{K_{D,\\mathrm{off},j} + L}.\n$$\n- The dCas9:gRNA complex assembly is assumed highly efficient and limited by the lesser of available dCas9 and gRNA expression, with an assembly efficiency factor $\\alpha$, so that $X = \\alpha \\min(C, G)$, where $C$ is the dCas9 supply and $G$ is the gRNA expression level.\n\nDefine the following quantities:\n- On-target fractional occupancy $\\theta_{\\mathrm{on}} = \\frac{L}{K_{D,\\mathrm{on}} + L}$.\n- Off-target sequestration fraction $f_{\\mathrm{off}} = \\frac{\\sum_j B_{\\mathrm{off},j}\\frac{L}{K_{D,\\mathrm{off},j} + L}}{X}$.\n- Feasible gRNA expression levels satisfy $0 \\le G \\le G_{\\max}$ and $f_{\\mathrm{off}} \\le f_{\\max}$.\n\nFor each parameter set, formulate the constrained optimization problem:\n- Maximize $\\theta_{\\mathrm{on}}(G)$ over $G$ subject to $f_{\\mathrm{off}}(G) \\le f_{\\max}$ and $0 \\le G \\le G_{\\max}$.\n- Here $L$ is the unique solution in $[0,X]$ to the mass conservation equation for the given $X$ determined by $G$, and $X = \\alpha \\min(C,G)$.\n\nAll quantities are dimensionless concentrations normalized to a common internal reference so that absolute units are unnecessary for this exercise.\n\nYour program must:\n- For each test case, compute the optimal $G^\\star$ that maximizes $\\theta_{\\mathrm{on}}$ under the stated constraints, using correct numerical solution of the mass conservation relation for $L$ at each $G$.\n- If multiple values of $G$ yield the same maximal $\\theta_{\\mathrm{on}}$ while meeting the constraint, return the smallest such $G$.\n\nTest Suite:\nProvide results for the following parameter sets. Each set is specified as a tuple ($C$, $\\alpha$, $G_{\\max}$, $K_{D,\\mathrm{on}}$, $B_{\\mathrm{on}}$, $\\{K_{D,\\mathrm{off},j}\\}$, $\\{B_{\\mathrm{off},j}\\}$, $f_{\\max}$).\n\n- Case 1 (happy path, moderate off-targets):\n  - $C = 100$, $\\alpha = 0.9$, $G_{\\max} = 200$, $K_{D,\\mathrm{on}} = 0.1$, $B_{\\mathrm{on}} = 1.0$,\n  - $\\{K_{D,\\mathrm{off},j}\\} = \\{0.5, 1.0, 2.0, 5.0, 10.0\\}$,\n  - $\\{B_{\\mathrm{off},j}\\} = \\{5.0, 5.0, 10.0, 10.0, 20.0\\}$,\n  - $f_{\\max} = 0.3$.\n\n- Case 2 (tight off-target constraint, boundary behavior):\n  - $C = 100$, $\\alpha = 0.9$, $G_{\\max} = 200$, $K_{D,\\mathrm{on}} = 0.1$, $B_{\\mathrm{on}} = 1.0$,\n  - $\\{K_{D,\\mathrm{off},j}\\} = \\{0.5, 1.0, 2.0, 5.0, 10.0\\}$,\n  - $\\{B_{\\mathrm{off},j}\\} = \\{5.0, 5.0, 10.0, 10.0, 20.0\\}$,\n  - $f_{\\max} = 0.05$.\n\n- Case 3 (dCas9-limited regime, heavier off-target capacity):\n  - $C = 30$, $\\alpha = 0.8$, $G_{\\max} = 200$, $K_{D,\\mathrm{on}} = 0.2$, $B_{\\mathrm{on}} = 1.0$,\n  - $\\{K_{D,\\mathrm{off},j}\\} = \\{0.3, 0.7, 1.5, 3.0, 6.0\\}$,\n  - $\\{B_{\\mathrm{off},j}\\} = \\{8.0, 12.0, 15.0, 20.0, 25.0\\}$,\n  - $f_{\\max} = 0.2$.\n\n- Case 4 (weaker on-target affinity, different off-target spectrum):\n  - $C = 100$, $\\alpha = 0.9$, $G_{\\max} = 200$, $K_{D,\\mathrm{on}} = 2.0$, $B_{\\mathrm{on}} = 1.0$,\n  - $\\{K_{D,\\mathrm{off},j}\\} = \\{1.0, 2.0, 4.0, 8.0\\}$,\n  - $\\{B_{\\mathrm{off},j}\\} = \\{5.0, 10.0, 15.0, 30.0\\}$,\n  - $f_{\\max} = 0.3$.\n\nOutput specification:\n- Your program should produce a single line of output containing the optimal gRNA expression levels $G^\\star$ for the four test cases in order, as a comma-separated list enclosed in square brackets, for example [$g_1, g_2, g_3, g_4$]. Each $g_i$ must be a floating-point number. No other text should be printed.",
            "solution": "The problem requires finding the optimal gRNA expression level, denoted by $G$, that maximizes the on-target fractional occupancy, $\\theta_{\\mathrm{on}}$, subject to constraints on the total available gRNA and the fraction of dCas9:gRNA complex sequestered by off-target sites, $f_{\\mathrm{off}}$. This is a constrained optimization problem grounded in the principles of chemical equilibrium and mass conservation.\n\nThe state of the system for a given gRNA expression level $G$ is determined by the free concentration of the dCas9:gRNA complex, denoted by $L$. First, the total concentration of the assembled complex, $X$, is determined by the dCas9 supply $C$, the gRNA expression level $G$, and the assembly efficiency $\\alpha$:\n$$X = \\alpha \\min(C, G)$$\nThis total complex concentration $X$ is distributed among the free complex $L$ and complexes bound to the on-target and various off-target sites. The mass conservation law provides the following relation:\n$$X = L + B_{\\mathrm{on}}\\frac{L}{K_{D,\\mathrm{on}} + L} + \\sum_j B_{\\mathrm{off},j}\\frac{L}{K_{D,\\mathrm{off},j} + L}$$\nwhere $B_{\\mathrm{on}}$ and $B_{\\mathrm{off},j}$ are the binding capacities, and $K_{D,\\mathrm{on}}$ and $K_{D,\\mathrm{off},j}$ are the equilibrium dissociation constants for the on-target and off-target sites, respectively. For any given $X \\ge 0$, this equation has a unique non-negative solution for $L$. Let us define the function $F(L, X) = L + \\sum_i B_i \\frac{L}{K_{D,i} + L} - X$, where the sum is over all binding sites. The derivative $\\frac{\\partial F}{\\partial L} = 1 + \\sum_i B_i \\frac{K_{D,i}}{(K_{D,i} + L)^2}$ is strictly positive for $L \\ge 0$. This ensures that $F(L, X)$ is a monotonically increasing function of $L$, guaranteeing a unique solution for $L$ for any given $X$. This solution can be found numerically using a root-finding algorithm, such as the Brent-Dekker method. The search interval for $L$ is $[0, X]$.\n\nThe optimization problem is formally stated as:\n$$ \\text{Maximize } \\theta_{\\mathrm{on}}(G) = \\frac{L(G)}{K_{D,\\mathrm{on}} + L(G)} $$\n$$ \\text{subject to: } \\quad 0 \\le G \\le G_{\\max} \\quad \\text{and} \\quad f_{\\mathrm{off}}(G) = \\frac{\\sum_j B_{\\mathrm{off},j}\\frac{L(G)}{K_{D,\\mathrm{off},j} + L(G)}}{X(G)} \\le f_{\\max} $$\n\nTo solve this, we analyze the behavior of the objective function $\\theta_{\\mathrm{on}}(G)$. The gRNA expression $G$ determines $X$. As $G$ increases in the range $[0, C]$, $X(G) = \\alpha G$ increases. The implicit function theorem applied to $F(L,X)=0$ shows that $\\frac{dL}{dX} > 0$, so $L$ is a monotonically increasing function of $X$. Since $\\theta_{\\mathrm{on}}(L)$ is a monotonically increasing function of $L$, it follows that $\\theta_{\\mathrm{on}}(G)$ is a monotonically increasing function of $G$ for $G \\in [0, C]$. For $G > C$, $X$ becomes constant ($X = \\alpha C$), which means $L$ is also constant, and therefore $\\theta_{\\mathrm{on}}(G)$ is constant for $G > C$. Consequently, $\\theta_{\\mathrm{on}}(G)$ is a monotonically non-decreasing function over its entire domain $[0, G_{\\max}]$.\n\nThis monotonicity simplifies the optimization. To maximize $\\theta_{\\mathrm{on}}(G)$, we must find the largest possible value of $G$ that satisfies the constraints. Let $S_{\\mathrm{feasible}} = \\{G \\in [0, G_{\\max}] \\mid f_{\\mathrm{off}}(G) \\le f_{\\max}\\}$. We seek $G_{\\text{max_feasible}} = \\sup S_{\\mathrm{feasible}}$. The maximum on-target occupancy will be $\\theta_{\\mathrm{on}}^\\star = \\theta_{\\mathrm{on}}(G_{\\text{max_feasible}})$.\n\nThe solution strategy is as follows:\n1.  Determine the largest feasible gRNA expression level, $G_{\\text{max_feasible}}$.\n    a.  First, evaluate the constraint at the upper bound $G = G_{\\max}$. If $f_{\\mathrm{off}}(G_{\\max}) \\le f_{\\max}$, the entire range $[0, G_{\\max}]$ is feasible. Therefore, $G_{\\text{max_feasible}} = G_{\\max}$.\n    b.  If $f_{\\mathrm{off}}(G_{\\max})  f_{\\max}$, the constraint is violated at $G_{\\max}$. We must find the boundary of the feasible region. The off-target fraction $f_{\\mathrm{off}}(G)$ is typically a monotonically increasing function of $G$ (as increasing total complex saturates high-affinity on-target sites, a larger fraction of additional complex binds to lower-affinity off-target sites). We can define $f_{\\mathrm{off}}(0) = 0$. Given $f_{\\mathrm{off}}(0) \\le f_{\\max}$ and $f_{\\mathrm{off}}(G_{\\max})  f_{\\max}$, there must be a value of $G$ in $(0, G_{\\max})$ where $f_{\\mathrm{off}}(G) = f_{\\max}$. This value represents the maximum permissible $G$ and can be found by solving the root problem $h(G) = f_{\\mathrm{off}}(G) - f_{\\max} = 0$ over the interval $[0, G_{\\max}]$. This root is $G_{\\text{max_feasible}}$.\n\n2.  Determine the final optimal value $G^\\star$ based on the tie-breaking rule. The rule states that if multiple $G$ values yield the same maximal $\\theta_{\\mathrm{on}}$, the smallest such $G$ should be returned.\n    a.  We established that $\\theta_{\\mathrm{on}}(G)$ is constant for all $G \\ge C$.\n    b.  If $G_{\\text{max_feasible}} \\le C$, the function $\\theta_{\\mathrm{on}}(G)$ is strictly increasing on the feasible domain $[0, G_{\\text{max_feasible}}]$. The maximum occupancy $\\theta_{\\mathrm{on}}^\\star$ is uniquely achieved at $G = G_{\\text{max_feasible}}$. Thus, $G^\\star = G_{\\text{max_feasible}}$.\n    c.  If $G_{\\text{max_feasible}}  C$, the maximum occupancy $\\theta_{\\mathrm{on}}^\\star$ is achieved for all $G$ in the interval $[C, G_{\\text{max_feasible}}]$. Since the off-target fraction $f_{\\mathrm{off}}(G)$ is also constant for $G \\ge C$, and the point $G_{\\text{max_feasible}}$ is feasible, the entire interval $[C, G_{\\text{max_feasible}}]$ is feasible. According to the tie-breaking rule, we must select the smallest $G$ in this range, which is $C$. Thus, $G^\\star = C$.\n\nThis algorithm is implemented by nesting two numerical root-finding steps: one to solve for $L$ from $X(G)$, and a second, outer one to solve for the optimal $G^\\star$ that satisfies the constraint boundary $f_{\\mathrm{off}}(G) = f_{\\max}$ when necessary.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Main function to solve the optimization problem for all test cases and print the results.\n    \"\"\"\n    # Test Suite:\n    # (C, alpha, G_max, K_D_on, B_on, {K_D_off_j}, {B_off_j}, f_max)\n    test_cases = [\n        (100.0, 0.9, 200.0, 0.1, 1.0, [0.5, 1.0, 2.0, 5.0, 10.0], [5.0, 5.0, 10.0, 10.0, 20.0], 0.3),\n        (100.0, 0.9, 200.0, 0.1, 1.0, [0.5, 1.0, 2.0, 5.0, 10.0], [5.0, 5.0, 10.0, 10.0, 20.0], 0.05),\n        (30.0, 0.8, 200.0, 0.2, 1.0, [0.3, 0.7, 1.5, 3.0, 6.0], [8.0, 12.0, 15.0, 20.0, 25.0], 0.2),\n        (100.0, 0.9, 200.0, 2.0, 1.0, [1.0, 2.0, 4.0, 8.0], [5.0, 10.0, 15.0, 30.0], 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        C, alpha, G_max, K_D_on, B_on, K_D_off, B_off, f_max = case\n        g_star = calculate_optimal_g(C, alpha, G_max, K_D_on, B_on, K_D_off, B_off, f_max)\n        results.append(g_star)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\ndef calculate_optimal_g(C, alpha, G_max, K_D_on, B_on, K_D_off, B_off, f_max):\n    \"\"\"\n    Calculates the optimal gRNA expression level G* for a single parameter set.\n    \"\"\"\n    K_D_all_sites = [K_D_on] + K_D_off\n    B_all_sites = [B_on] + B_off\n    \n    # Memoization cache for f_off(G) to speed up root finding if needed\n    memo_f_off = {}\n\n    def get_f_off(G):\n        \"\"\"\n        Calculates the off-target sequestration fraction f_off for a given G.\n        \"\"\"\n        G_val = float(G)\n        if G_val in memo_f_off:\n            return memo_f_off[G_val]\n\n        # At G=0, there is no complex, so no sequestration.\n        if G_val = 1e-12:\n            return 0.0\n\n        X = alpha * min(C, G_val)\n        if X = 1e-12:\n            return 0.0\n\n        def mass_balance_residual(L, current_X):\n            \"\"\"Defines the function whose root is the free ligand concentration L.\"\"\"\n            bound_sum = np.sum([\n                B * L / (K_D + L) for B, K_D in zip(B_all_sites, K_D_all_sites) if K_D + L > 0\n            ])\n            return L + bound_sum - current_X\n        \n        # Solve for L using a robust root-finding method.\n        # The free concentration L must be in the interval [0, X].\n        sol_L = root_scalar(mass_balance_residual, args=(X,), bracket=[0, X], method='brentq')\n        L = sol_L.root\n\n        # Calculate total concentration of complex bound to off-target sites.\n        off_target_bound = np.sum([\n            B * L / (K_D + L) for B, K_D in zip(B_off, K_D_off) if K_D + L > 0\n        ])\n        \n        result_f_off = off_target_bound / X\n        memo_f_off[G_val] = result_f_off\n        return result_f_off\n\n    # 1. Find the maximum feasible G, denoted G_max_feasible.\n    f_off_at_g_max = get_f_off(G_max)\n    \n    g_max_feasible = 0.0\n    if f_off_at_g_max = f_max:\n        # If G_max is feasible, it's the largest feasible G since f_off is monotonic.\n        g_max_feasible = G_max\n    else:\n        # If G_max is not feasible, the optimal G is at the constraint boundary.\n        # Find the root of f_off(G) - f_max = 0.\n        def constraint_violation_func(G):\n            return get_f_off(G) - f_max\n\n        # The root must lie in [0, G_max] because f_off(0) = f_max and f_off(G_max) > f_max.\n        sol_G = root_scalar(constraint_violation_func, bracket=[0, G_max], method='brentq')\n        g_max_feasible = sol_G.root\n\n    # 2. Apply the tie-breaking rule considering the dCas9-limited regime (G > C).\n    # If G_max_feasible is in the dCas9-limited regime, theta_on and f_off are constant for G >= C.\n    # The smallest G that achieves max theta_on is C.\n    if g_max_feasible > C:\n        # Check if C itself is a feasible point. f_off is monotonic increasing up to C,\n        # then constant. Since g_max_feasible is feasible, and f_off(g_max_feasible) = f_off(C),\n        # then C is also feasible.\n        return C\n    else:\n        # If G_max_feasible = C, theta_on is strictly increasing, so the optimum is unique.\n        return g_max_feasible\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}