{
    "hands_on_practices": [
        {
            "introduction": "Our exploration of CRISPR dynamics begins with the fundamental equilibrium behavior of the system. This first practice establishes the core relationship between the concentration of the dCas9-guide complex and the steady-state occupancy of its target promoter, providing a quantitative foundation for predicting the extent of gene repression or activation. By working through this exercise , you will apply the classic Hill-Langmuir isotherm, where occupancy $\\theta$ is given by $\\theta = \\frac{[CG]}{K_D + [CG]}$, to determine the necessary complex concentration to achieve a desired level of regulation.",
            "id": "3910261",
            "problem": "In Clustered Regularly Interspaced Short Palindromic Repeats (CRISPR) systems, including CRISPR interference (CRISPRi) and CRISPR activation (CRISPRa), a deactivated Cas9 (dCas9) protein forms a complex with a single guide RNA (sgRNA), here denoted as the dCas9–guide complex concentration $[CG]$. Consider a single genomic target site to which the complex binds and unbinds with mass-action kinetics under pseudo-first-order conditions (constant $[CG]$, no competition among sites, no cooperativity). The association and dissociation rate constants are $k_{\\text{on}}=10^{5}\\,\\text{M}^{-1}\\,\\text{s}^{-1}$ and $k_{\\text{off}}=10^{-2}\\,\\text{s}^{-1}$, respectively. Define the steady-state fractional occupancy of the site by the complex as $\\theta$. Starting from mass-action kinetics and steady-state reasoning, determine the minimal $[CG]$ required such that $\\theta \\geq 0.8$ at steady state. Express your final concentration in molar ($\\text{M}$) and round your answer to $2$ significant figures. Additionally, based on your derivation, discuss the sensitivity of the minimal $[CG]$ to the association rate constant $k_{\\text{on}}$ at fixed $k_{\\text{off}}$ and target $\\theta$.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is based on standard principles of chemical kinetics applied to biomolecular interactions, which is a fundamental approach in synthetic biology modeling. All necessary parameters are provided, and the questions asked are unambiguous.\n\nThe interaction between the dCas9–guide complex, denoted by concentration $[CG]$, and a single genomic target site, denoted by $S$, can be represented by the reversible reaction:\n$$ S + CG \\rightleftharpoons CS $$\nwhere $CS$ is the complex-bound site. The rate constants for the forward (association) and reverse (dissociation) reactions are $k_{\\text{on}}$ and $k_{\\text{off}}$, respectively.\n\nUnder the assumption of mass-action kinetics, the rate of association is $v_{\\text{on}} = k_{\\text{on}} [S] [CG]$, where $[S]$ is the concentration of the free (unbound) target site. The rate of dissociation is $v_{\\text{off}} = k_{\\text{off}} [CS]$, where $[CS]$ is the concentration of the bound target site.\n\nAt steady state, the rate of association equals the rate of dissociation:\n$$ v_{\\text{on}} = v_{\\text{off}} $$\n$$ k_{\\text{on}} [S] [CG] = k_{\\text{off}} [CS] $$\n\nFrom this equality, we can find the ratio of bound to free sites:\n$$ \\frac{[CS]}{[S]} = \\frac{k_{\\text{on}}}{k_{\\text{off}}} [CG] $$\nThis relationship can be expressed in terms of the dissociation constant, $K_d$, which is defined as the ratio of the dissociation rate constant to the association rate constant:\n$$ K_d = \\frac{k_{\\text{off}}}{k_{\\text{on}}} $$\nSubstituting this into the previous equation gives:\n$$ \\frac{[CS]}{[S]} = \\frac{[CG]}{K_d} $$\n\nThe problem defines the fractional occupancy, $\\theta$, as the fraction of total target sites that are bound by the complex. The total concentration of target sites, $[S]_{\\text{total}}$, is the sum of the free and bound sites: $[S]_{\\text{total}} = [S] + [CS]$. Thus, $\\theta$ is given by:\n$$ \\theta = \\frac{[CS]}{[S]_{\\text{total}}} = \\frac{[CS]}{[S] + [CS]} $$\nTo express $\\theta$ as a function of $[CG]$, we can divide the numerator and the denominator by $[S]$:\n$$ \\theta = \\frac{[CS]/[S]}{1 + [CS]/[S]} $$\nSubstituting the expression $\\frac{[CS]}{[S]} = \\frac{[CG]}{K_d}$:\n$$ \\theta = \\frac{[CG]/K_d}{1 + [CG]/K_d} = \\frac{[CG]}{K_d + [CG]} $$\nThis is the Hill-Langmuir equation for a single non-cooperative binding site.\n\nThe problem requires finding the minimal concentration $[CG]$ such that the fractional occupancy $\\theta$ is at least $0.8$, i.e., $\\theta \\geq 0.8$. The minimal concentration will occur at the boundary condition, $\\theta = 0.8$. We can rearrange the equation for $\\theta$ to solve for $[CG]$:\n$$ \\theta (K_d + [CG]) = [CG] $$\n$$ \\theta K_d + \\theta [CG] = [CG] $$\n$$ \\theta K_d = [CG] - \\theta [CG] = [CG](1 - \\theta) $$\n$$ [CG] = K_d \\frac{\\theta}{1 - \\theta} $$\n\nNow, we substitute the given values. First, we calculate the dissociation constant $K_d$:\n$$ K_d = \\frac{k_{\\text{off}}}{k_{\\text{on}}} = \\frac{10^{-2}\\,\\text{s}^{-1}}{10^{5}\\,\\text{M}^{-1}\\,\\text{s}^{-1}} = 10^{-7}\\,\\text{M} $$\nNext, we calculate the required $[CG]$ for $\\theta = 0.8$:\n$$ [CG] = (10^{-7}\\,\\text{M}) \\frac{0.8}{1 - 0.8} = (10^{-7}\\,\\text{M}) \\frac{0.8}{0.2} = (10^{-7}\\,\\text{M}) \\times 4 $$\n$$ [CG] = 4 \\times 10^{-7}\\,\\text{M} $$\nRounding this result to $2$ significant figures as requested gives $4.0 \\times 10^{-7}\\,\\text{M}$.\n\nNext, we address the sensitivity of the minimal required concentration, $[CG]_{\\text{min}}$, to the association rate constant, $k_{\\text{on}}$, while holding $k_{\\text{off}}$ and the target occupancy $\\theta$ constant. The expression for $[CG]_{\\text{min}}$ is:\n$$ [CG]_{\\text{min}} = \\frac{k_{\\text{off}}}{k_{\\text{on}}} \\frac{\\theta}{1 - \\theta} $$\nSince $k_{\\text{off}}$ and $\\theta$ are fixed, the term $k_{\\text{off}}\\frac{\\theta}{1-\\theta}$ is a constant. Let's call this constant $C$.\n$$ [CG]_{\\text{min}} = \\frac{C}{k_{\\text{on}}} $$\nThis equation shows that $[CG]_{\\text{min}}$ is inversely proportional to $k_{\\text{on}}$. To quantify this sensitivity, we can calculate the elasticity, which is the ratio of the fractional change in $[CG]_{\\text{min}}$ to the fractional change in $k_{\\text{on}}$:\n$$ E = \\frac{d[CG]_{\\text{min}}}{[CG]_{\\text{min}}} \\bigg/ \\frac{dk_{\\text{on}}}{k_{\\text{on}}} = \\frac{d[CG]_{\\text{min}}}{dk_{\\text{on}}} \\frac{k_{\\text{on}}}{[CG]_{\\text{min}}} $$\nFirst, we compute the derivative of $[CG]_{\\text{min}}$ with respect to $k_{\\text{on}}$:\n$$ \\frac{d[CG]_{\\text{min}}}{dk_{\\text{on}}} = \\frac{d}{dk_{\\text{on}}} \\left( C \\cdot k_{\\text{on}}^{-1} \\right) = -C \\cdot k_{\\text{on}}^{-2} = -\\frac{C}{k_{\\text{on}}^2} $$\nNow we compute the elasticity:\n$$ E = \\left( -\\frac{C}{k_{\\text{on}}^2} \\right) \\frac{k_{\\text{on}}}{C/k_{\\text{on}}} = \\left( -\\frac{C}{k_{\\text{on}}^2} \\right) \\frac{k_{\\text{on}}^2}{C} = -1 $$\nThe elasticity of $[CG]_{\\text{min}}$ with respect to $k_{\\text{on}}$ is $-1$. This means that a given percentage increase in the association rate constant $k_{\\text{on}}$ results in the same percentage decrease in the minimal complex concentration $[CG]_{\\text{min}}$ required to achieve the target occupancy $\\theta$. For example, a $10\\%$ increase in $k_{\\text{on}}$ leads to a $10\\%$ decrease in the required $[CG]_{\\text{min}}$. This highlights a direct and strong inverse relationship: a more rapidly binding complex (higher $k_{\\text{on}}$) is more efficient, requiring a proportionally lower concentration to achieve the same level of genomic target saturation.",
            "answer": "$$\\boxed{4.0 \\times 10^{-7} \\, \\text{M}}$$"
        },
        {
            "introduction": "Effective and safe use of CRISPR technology hinges on its specificity. This next practice delves into the biophysical underpinnings of this specificity by modeling the impact of a single guide-target mismatch on binding affinity. By deriving how a change in kinetic parameters, such as the dissociation rate $k_{\\text{off}}$, alters the equilibrium dissociation constant $K_{d}$ and, consequently, the target occupancy , you will gain a quantitative understanding of how off-target binding is disfavored, a critical concept for designing highly specific guide RNAs.",
            "id": "3910284",
            "problem": "Consider a promoter targeted by Clustered Regularly Interspaced Short Palindromic Repeats interference (CRISPRi) or Clustered Regularly Interspaced Short Palindromic Repeats activation (CRISPRa), where a catalytically inactive CRISPR-associated protein 9 (dCas9) bound to a single-guide RNA (sgRNA) forms a binding-competent complex. Denote the concentration of the free dCas9:sgRNA complex by $[CG]$. The complex binds a single site on the DNA target $T$ according to the reversible reaction $CG + T \\rightleftharpoons CG{:}T$ with forward rate constant $k_{\\text{on}}$ and reverse rate constant $k_{\\text{off}}$. Assume a quasi-equilibrium regime on the promoter-binding timescale, a single non-cooperative binding site, and that $[CG]$ is maintained approximately constant by cellular expression and is not significantly depleted by binding to the rare target. Define the equilibrium dissociation constant by $K_{d} = \\frac{k_{\\text{off}}}{k_{\\text{on}}}$ and the fractional occupancy by $\\theta = \\frac{[CG{:}T]}{[T] + [CG{:}T]}$, where $[T]$ is the free target concentration.\n\nA single guide-target mismatch is observed to double the unbinding rate, so that the mismatched complex has $k_{\\text{off}}^{(\\text{mm})} = 2 k_{\\text{off}}$ while preserving $k_{\\text{on}}^{(\\text{mm})} = k_{\\text{on}}$. At a fixed $[CG]$, use mass-action equilibrium to derive $\\theta$ for both the perfect-match and mismatched cases from first principles, and compute the occupancy ratio $\\frac{\\theta_{\\text{mismatch}}}{\\theta_{\\text{perfect}}}$ as a closed-form analytic expression in terms of $[CG]$, $k_{\\text{on}}$, and $k_{\\text{off}}$. Provide your final expression simplified. No numerical evaluation or rounding is required. Express your final answer without units.",
            "solution": "The problem has been validated and found to be scientifically grounded, well-posed, objective, and self-contained. It is a standard exercise in biophysical modeling based on the principles of mass-action kinetics. We may therefore proceed with a formal derivation.\n\nThe system is described by the reversible binding reaction of the dCas9:sgRNA complex, denoted $CG$, to a DNA target site, $T$, forming a bound complex, $CG{:}T$:\n$$\nCG + T \\rightleftharpoons CG{:}T\n$$\nThe forward reaction is characterized by the rate constant $k_{\\text{on}}$ and the reverse reaction by $k_{\\text{off}}$. The rates of formation ($R_f$) and dissociation ($R_r$) of the bound complex are given by the law of mass action:\n$$\nR_f = k_{\\text{on}} [CG] [T]\n$$\n$$\nR_r = k_{\\text{off}} [CG{:}T]\n$$\nwhere $[CG]$, $[T]$, and $[CG{:}T]$ are the molar concentrations of the free complex, free target, and bound complex, respectively.\n\nThe problem states that we can assume a quasi-equilibrium regime. This implies that the rate of formation equals the rate of dissociation:\n$$\nR_f = R_r\n$$\n$$\nk_{\\text{on}} [CG] [T] = k_{\\text{off}} [CG{:}T]\n$$\nThe problem also defines the equilibrium dissociation constant as $K_{d} = \\frac{k_{\\text{off}}}{k_{\\text{on}}}$. We can rearrange the equilibrium equation to obtain an expression for $K_d$:\n$$\nK_d = \\frac{k_{\\text{off}}}{k_{\\text{on}}} = \\frac{[CG][T]}{[CG{:}T]}\n$$\nFrom this relationship, we can express the concentration of the free target, $[T]$, in terms of the bound target and the free complex:\n$$\n[T] = K_d \\frac{[CG{:}T]}{[CG]}\n$$\nThe fractional occupancy, $\\theta$, is defined as the ratio of the concentration of the bound target to the total concentration of the target (bound + free):\n$$\n\\theta = \\frac{[CG{:}T]}{[T] + [CG{:}T]}\n$$\nSubstituting the expression for $[T]$ into the equation for $\\theta$:\n$$\n\\theta = \\frac{[CG{:}T]}{\\left(K_d \\frac{[CG{:}T]}{[CG]}\\right) + [CG{:}T]}\n$$\nWe can factor out $[CG{:}T]$ from the denominator:\n$$\n\\theta = \\frac{[CG{:}T]}{[CG{:}T] \\left(\\frac{K_d}{[CG]} + 1\\right)}\n$$\nAssuming $[CG{:}T] > 0$, we can cancel this term from the numerator and denominator:\n$$\n\\theta = \\frac{1}{\\frac{K_d}{[CG]} + 1}\n$$\nBy multiplying the numerator and denominator by $[CG]$, we arrive at the standard Hill-Langmuir binding isotherm for a single non-cooperative site:\n$$\n\\theta = \\frac{[CG]}{[CG] + K_d}\n$$\nThis general expression for fractional occupancy will now be applied to the two specified cases.\n\n1.  **Perfect-match case**:\n    The rate constants are $k_{\\text{on}}$ and $k_{\\text{off}}$. The equilibrium dissociation constant, which we denote as $K_{d, \\text{perfect}}$, is:\n    $$\n    K_{d, \\text{perfect}} = \\frac{k_{\\text{off}}}{k_{\\text{on}}}\n    $$\n    The fractional occupancy for the perfect-match case, $\\theta_{\\text{perfect}}$, is therefore:\n    $$\n    \\theta_{\\text{perfect}} = \\frac{[CG]}{[CG] + K_{d, \\text{perfect}}} = \\frac{[CG]}{[CG] + \\frac{k_{\\text{off}}}{k_{\\text{on}}}}\n    $$\n\n2.  **Mismatched case**:\n    The problem states that a single mismatch modifies the rate constants such that $k_{\\text{on}}^{(\\text{mm})} = k_{\\text{on}}$ and $k_{\\text{off}}^{(\\text{mm})} = 2 k_{\\text{off}}$. The dissociation constant for the mismatched case, $K_{d, \\text{mismatch}}$, is:\n    $$\n    K_{d, \\text{mismatch}} = \\frac{k_{\\text{off}}^{(\\text{mm})}}{k_{\\text{on}}^{(\\text{mm})}} = \\frac{2 k_{\\text{off}}}{k_{\\text{on}}} = 2 \\left(\\frac{k_{\\text{off}}}{k_{\\text{on}}}\\right) = 2 K_{d, \\text{perfect}}\n    $$\n    The fractional occupancy for the mismatched case, $\\theta_{\\text{mismatch}}$, is:\n    $$\n    \\theta_{\\text{mismatch}} = \\frac{[CG]}{[CG] + K_{d, \\text{mismatch}}} = \\frac{[CG]}{[CG] + 2 \\frac{k_{\\text{off}}}{k_{\\text{on}}}}\n    $$\n\nFinally, we compute the ratio $\\frac{\\theta_{\\text{mismatch}}}{\\theta_{\\text{perfect}}}$:\n$$\n\\frac{\\theta_{\\text{mismatch}}}{\\theta_{\\text{perfect}}} = \\frac{\\frac{[CG]}{[CG] + 2 \\frac{k_{\\text{off}}}{k_{\\text{on}}}}}{\\frac{[CG]}{[CG] + \\frac{k_{\\text{off}}}{k_{\\text{on}}}}}\n$$\nThe $[CG]$ term in the numerators cancels out:\n$$\n\\frac{\\theta_{\\text{mismatch}}}{\\theta_{\\text{perfect}}} = \\frac{[CG] + \\frac{k_{\\text{off}}}{k_{\\text{on}}}}{[CG] + 2 \\frac{k_{\\text{off}}}{k_{\\text{on}}}}\n$$\nTo obtain the simplified closed-form expression requested, we multiply the numerator and the denominator of this complex fraction by $k_{\\text{on}}$:\n$$\n\\frac{\\theta_{\\text{mismatch}}}{\\theta_{\\text{perfect}}} = \\frac{k_{\\text{on}} \\left([CG] + \\frac{k_{\\text{off}}}{k_{\\text{on}}}\\right)}{k_{\\text{on}} \\left([CG] + 2 \\frac{k_{\\text{off}}}{k_{\\text{on}}}\\right)} = \\frac{k_{\\text{on}}[CG] + k_{\\text{off}}}{k_{\\text{on}}[CG] + 2 k_{\\text{off}}}\n$$\nThis is the final analytical expression for the occupancy ratio in terms of the given parameters.",
            "answer": "$$\n\\boxed{\\frac{k_{\\text{on}}[CG] + k_{\\text{off}}}{k_{\\text{on}}[CG] + 2 k_{\\text{off}}}}\n$$"
        },
        {
            "introduction": "We now advance from single-site analysis to a holistic, systems-level design problem that mirrors challenges faced in practical synthetic biology. This final practice  frames CRISPRi/a design as a constrained optimization task, where the goal is to maximize on-target activity while managing the inevitable sequestration of dCas9 complexes by a genome's worth of off-target sites. This computational exercise challenges you to balance efficacy and specificity, integrating the principles of mass conservation and competitive binding to find an optimal gRNA expression strategy.",
            "id": "3910214",
            "problem": "You are modeling the binding equilibrium of deactivated Cas9 (dCas9) loaded with a single guide RNA (gRNA) to a set of genomic sites comprising one on-target site and many off-target sites. For Clustered Regularly Interspaced Short Palindromic Repeats interference (CRISPRi) and CRISPR activation (CRISPRa), the primary control lever is gRNA expression, which tunes the abundance of the dCas9:gRNA complex. At equilibrium, the fraction of a site occupied by ligand is governed by mass action. Your task is to determine, for each parameter set in the test suite, the gRNA expression level that maximizes on-target occupancy subject to a constraint limiting off-target sequestration.\n\nStart from the following foundational base:\n- Chemical mass action at equilibrium, which yields the standard ligand occupancy formula for a single, non-interacting binding site: the fractional occupancy $\\theta_i$ of site $i$ by a ligand at free concentration $L$ and equilibrium dissociation constant $K_{D,i}$ is given by $\\theta_i = \\dfrac{L}{K_{D,i} + L}$.\n- Mass conservation for the ligand (the dCas9:gRNA complex) under the assumption that binding sites are independent and non-cooperative: the total complex concentration $X$ is split among free complex and complexes bound to each site. Specifically, if there is one on-target site with effective binding capacity $B_{\\mathrm{on}}$ and equilibrium dissociation constant $K_{D,\\mathrm{on}}$, and off-target sites indexed by $j$ with capacities $B_{\\mathrm{off},j}$ and dissociation constants $K_{D,\\mathrm{off},j}$, then the mass conservation relation is:\n$$\nX \\;=\\; L \\;+\\; B_{\\mathrm{on}}\\,\\frac{L}{K_{D,\\mathrm{on}} + L} \\;+\\; \\sum_j B_{\\mathrm{off},j}\\,\\frac{L}{K_{D,\\mathrm{off},j} + L}.\n$$\n- The dCas9:gRNA complex assembly is assumed highly efficient and limited by the lesser of available dCas9 and gRNA expression, with an assembly efficiency factor $\\alpha$, so that $X = \\alpha \\,\\min(C, G)$, where $C$ is the dCas9 supply and $G$ is the gRNA expression level.\n\nDefine the following quantities:\n- On-target fractional occupancy $\\theta_{\\mathrm{on}} = \\dfrac{L}{K_{D,\\mathrm{on}} + L}$.\n- Off-target sequestration fraction $f_{\\mathrm{off}} = \\dfrac{\\sum_j B_{\\mathrm{off},j}\\,\\dfrac{L}{K_{D,\\mathrm{off},j} + L}}{X}$.\n- Feasible gRNA expression levels satisfy $0 \\le G \\le G_{\\max}$ and $f_{\\mathrm{off}} \\le f_{\\max}$.\n\nFor each parameter set, formulate the constrained optimization problem:\n- Maximize $\\theta_{\\mathrm{on}}(G)$ over $G$ subject to $f_{\\mathrm{off}}(G) \\le f_{\\max}$ and $0 \\le G \\le G_{\\max}$.\n- Here $L$ is the unique solution in $[0,X]$ to the mass conservation equation for the given $X$ determined by $G$, and $X = \\alpha\\,\\min(C,G)$.\n\nAll quantities are dimensionless concentrations normalized to a common internal reference so that absolute units are unnecessary for this exercise.\n\nYour program must:\n- For each test case, compute the optimal $G^\\star$ that maximizes $\\theta_{\\mathrm{on}}$ under the stated constraints, using correct numerical solution of the mass conservation relation for $L$ at each $G$.\n- If multiple values of $G$ yield the same maximal $\\theta_{\\mathrm{on}}$ while meeting the constraint, return the smallest such $G$.\n\nTest Suite:\nProvide results for the following parameter sets. Each set is specified as a tuple $\\left(C,\\,\\alpha,\\,G_{\\max},\\,K_{D,\\mathrm{on}},\\,B_{\\mathrm{on}},\\,\\{K_{D,\\mathrm{off},j}\\},\\,\\{B_{\\mathrm{off},j}\\},\\,f_{\\max}\\right)$.\n\n- Case $1$ (happy path, moderate off-targets):\n  - $C = 100$, $\\alpha = 0.9$, $G_{\\max} = 200$, $K_{D,\\mathrm{on}} = 0.1$, $B_{\\mathrm{on}} = 1.0$,\n  - $\\{K_{D,\\mathrm{off},j}\\} = \\{0.5,\\,1.0,\\,2.0,\\,5.0,\\,10.0\\}$,\n  - $\\{B_{\\mathrm{off},j}\\} = \\{5.0,\\,5.0,\\,10.0,\\,10.0,\\,20.0\\}$,\n  - $f_{\\max} = 0.3$.\n\n- Case $2$ (tight off-target constraint, boundary behavior):\n  - $C = 100$, $\\alpha = 0.9$, $G_{\\max} = 200$, $K_{D,\\mathrm{on}} = 0.1$, $B_{\\mathrm{on}} = 1.0$,\n  - $\\{K_{D,\\mathrm{off},j}\\} = \\{0.5,\\,1.0,\\,2.0,\\,5.0,\\,10.0\\}$,\n  - $\\{B_{\\mathrm{off},j}\\} = \\{5.0,\\,5.0,\\,10.0,\\,10.0,\\,20.0\\}$,\n  - $f_{\\max} = 0.05$.\n\n- Case $3$ (dCas9-limited regime, heavier off-target capacity):\n  - $C = 30$, $\\alpha = 0.8$, $G_{\\max} = 200$, $K_{D,\\mathrm{on}} = 0.2$, $B_{\\mathrm{on}} = 1.0$,\n  - $\\{K_{D,\\mathrm{off},j}\\} = \\{0.3,\\,0.7,\\,1.5,\\,3.0,\\,6.0\\}$,\n  - $\\{B_{\\mathrm{off},j}\\} = \\{8.0,\\,12.0,\\,15.0,\\,20.0,\\,25.0\\}$,\n  - $f_{\\max} = 0.2$.\n\n- Case $4$ (weaker on-target affinity, different off-target spectrum):\n  - $C = 100$, $\\alpha = 0.9$, $G_{\\max} = 200$, $K_{D,\\mathrm{on}} = 2.0$, $B_{\\mathrm{on}} = 1.0$,\n  - $\\{K_{D,\\mathrm{off},j}\\} = \\{1.0,\\,2.0,\\,4.0,\\,8.0\\}$,\n  - $\\{B_{\\mathrm{off},j}\\} = \\{5.0,\\,10.0,\\,15.0,\\,30.0\\}$,\n  - $f_{\\max} = 0.3$.\n\nOutput specification:\n- Your program should produce a single line of output containing the optimal gRNA expression levels $G^\\star$ for the four test cases in order, as a comma-separated list enclosed in square brackets, for example $[g_1, g_2, g_3, g_4]$. Each $g_i$ must be a floating-point number. No other text should be printed.",
            "solution": "The problem requires finding the optimal gRNA expression level, denoted by $G$, that maximizes the on-target fractional occupancy, $\\theta_{\\mathrm{on}}$, subject to constraints on the total available gRNA and the fraction of dCas9:gRNA complex sequestered by off-target sites, $f_{\\mathrm{off}}$. This is a constrained optimization problem grounded in the principles of chemical equilibrium and mass conservation.\n\nThe state of the system for a given gRNA expression level $G$ is determined by the free concentration of the dCas9:gRNA complex, denoted by $L$. First, the total concentration of the assembled complex, $X$, is determined by the dCas9 supply $C$, the gRNA expression level $G$, and the assembly efficiency $\\alpha$:\n$$X = \\alpha \\min(C, G)$$\nThis total complex concentration $X$ is distributed among the free complex $L$ and complexes bound to the on-target and various off-target sites. The mass conservation law provides the following relation:\n$$X = L + B_{\\mathrm{on}}\\frac{L}{K_{D,\\mathrm{on}} + L} + \\sum_j B_{\\mathrm{off},j}\\frac{L}{K_{D,\\mathrm{off},j} + L}$$\nwhere $B_{\\mathrm{on}}$ and $B_{\\mathrm{off},j}$ are the binding capacities, and $K_{D,\\mathrm{on}}$ and $K_{D,\\mathrm{off},j}$ are the equilibrium dissociation constants for the on-target and off-target sites, respectively. For any given $X \\ge 0$, this equation has a unique non-negative solution for $L$. Let us define the function $F(L, X) = L + \\sum_i B_i \\frac{L}{K_{D,i} + L} - X$, where the sum is over all binding sites. The derivative $\\frac{\\partial F}{\\partial L} = 1 + \\sum_i B_i \\frac{K_{D,i}}{(K_{D,i} + L)^2}$ is strictly positive for $L \\ge 0$. This ensures that $F(L, X)$ is a monotonically increasing function of $L$, guaranteeing a unique solution for $L$ for any given $X$. This solution can be found numerically using a root-finding algorithm, such as the Brent-Dekker method. The search interval for $L$ is $[0, X]$.\n\nThe optimization problem is formally stated as:\n$$ \\text{Maximize } \\theta_{\\mathrm{on}}(G) = \\frac{L(G)}{K_{D,\\mathrm{on}} + L(G)} $$\n$$ \\text{subject to: } \\quad 0 \\le G \\le G_{\\max} \\quad \\text{and} \\quad f_{\\mathrm{off}}(G) = \\frac{\\sum_j B_{\\mathrm{off},j}\\frac{L(G)}{K_{D,\\mathrm{off},j} + L(G)}}{X(G)} \\le f_{\\max} $$\n\nTo solve this, we analyze the behavior of the objective function $\\theta_{\\mathrm{on}}(G)$. The gRNA expression $G$ determines $X$. As $G$ increases in the range $[0, C]$, $X(G) = \\alpha G$ increases. The implicit function theorem applied to $F(L,X)=0$ shows that $\\frac{dL}{dX} > 0$, so $L$ is a monotonically increasing function of $X$. Since $\\theta_{\\mathrm{on}}(L)$ is a monotonically increasing function of $L$, it follows that $\\theta_{\\mathrm{on}}(G)$ is a monotonically increasing function of $G$ for $G \\in [0, C]$. For $G > C$, $X$ becomes constant ($X = \\alpha C$), which means $L$ is also constant, and therefore $\\theta_{\\mathrm{on}}(G)$ is constant for $G > C$. Consequently, $\\theta_{\\mathrm{on}}(G)$ is a monotonically non-decreasing function over its entire domain $[0, G_{\\max}]$.\n\nThis monotonicity simplifies the optimization. To maximize $\\theta_{\\mathrm{on}}(G)$, we must find the largest possible value of $G$ that satisfies the constraints. Let $S_{\\mathrm{feasible}} = \\{G \\in [0, G_{\\max}] \\mid f_{\\mathrm{off}}(G) \\le f_{\\max}\\}$. We seek $G_{\\text{max_feasible}} = \\sup S_{\\mathrm{feasible}}$. The maximum on-target occupancy will be $\\theta_{\\mathrm{on}}^\\star = \\theta_{\\mathrm{on}}(G_{\\text{max_feasible}})$.\n\nThe solution strategy is as follows:\n1.  Determine the largest feasible gRNA expression level, $G_{\\text{max_feasible}}$.\n    a.  First, evaluate the constraint at the upper bound $G = G_{\\max}$. If $f_{\\mathrm{off}}(G_{\\max}) \\le f_{\\max}$, the entire range $[0, G_{\\max}]$ is feasible. Therefore, $G_{\\text{max_feasible}} = G_{\\max}$.\n    b.  If $f_{\\mathrm{off}}(G_{\\max}) > f_{\\max}$, the constraint is violated at $G_{\\max}$. We must find the boundary of the feasible region. The off-target fraction $f_{\\mathrm{off}}(G)$ is typically a monotonically increasing function of $G$ (as increasing total complex saturates high-affinity on-target sites, a larger fraction of additional complex binds to lower-affinity off-target sites). We can define $f_{\\mathrm{off}}(0) = 0$. Given $f_{\\mathrm{off}}(0) \\le f_{\\max}$ and $f_{\\mathrm{off}}(G_{\\max}) > f_{\\max}$, there must be a value of $G$ in $(0, G_{\\max})$ where $f_{\\mathrm{off}}(G) = f_{\\max}$. This value represents the maximum permissible $G$ and can be found by solving the root problem $h(G) = f_{\\mathrm{off}}(G) - f_{\\max} = 0$ over the interval $[0, G_{\\max}]$. This root is $G_{\\text{max_feasible}}$.\n\n2.  Determine the final optimal value $G^\\star$ based on the tie-breaking rule. The rule states that if multiple $G$ values yield the same maximal $\\theta_{\\mathrm{on}}$, the smallest such $G$ should be returned.\n    a.  We established that $\\theta_{\\mathrm{on}}(G)$ is constant for all $G \\ge C$.\n    b.  If $G_{\\text{max_feasible}} \\le C$, the function $\\theta_{\\mathrm{on}}(G)$ is strictly increasing on the feasible domain $[0, G_{\\text{max_feasible}}]$. The maximum occupancy $\\theta_{\\mathrm{on}}^\\star$ is uniquely achieved at $G = G_{\\text{max_feasible}}$. Thus, $G^\\star = G_{\\text{max_feasible}}$.\n    c.  If $G_{\\text{max_feasible}} > C$, the maximum occupancy $\\theta_{\\mathrm{on}}^\\star$ is achieved for all $G$ in the interval $[C, G_{\\text{max_feasible}}]$. Since the off-target fraction $f_{\\mathrm{off}}(G)$ is also constant for $G \\ge C$, and the point $G_{\\text{max_feasible}}$ is feasible, the entire interval $[C, G_{\\text{max_feasible}}]$ is feasible. According to the tie-breaking rule, we must select the smallest $G$ in this range, which is $C$. Thus, $G^\\star = C$.\n\nThis algorithm is implemented by nesting two numerical root-finding steps: one to solve for $L$ from $X(G)$, and a second, outer one to solve for the optimal $G^\\star$ that satisfies the constraint boundary $f_{\\mathrm{off}}(G) = f_{\\max}$ when necessary.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Main function to solve the optimization problem for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        (100.0, 0.9, 200.0, 0.1, 1.0, [0.5, 1.0, 2.0, 5.0, 10.0], [5.0, 5.0, 10.0, 10.0, 20.0], 0.3),\n        (100.0, 0.9, 200.0, 0.1, 1.0, [0.5, 1.0, 2.0, 5.0, 10.0], [5.0, 5.0, 10.0, 10.0, 20.0], 0.05),\n        (30.0, 0.8, 200.0, 0.2, 1.0, [0.3, 0.7, 1.5, 3.0, 6.0], [8.0, 12.0, 15.0, 20.0, 25.0], 0.2),\n        (100.0, 0.9, 200.0, 2.0, 1.0, [1.0, 2.0, 4.0, 8.0], [5.0, 10.0, 15.0, 30.0], 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        C, alpha, G_max, K_D_on, B_on, K_D_off, B_off, f_max = case\n        g_star = calculate_optimal_g(C, alpha, G_max, K_D_on, B_on, K_D_off, B_off, f_max)\n        results.append(g_star)\n\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\ndef calculate_optimal_g(C, alpha, G_max, K_D_on, B_on, K_D_off, B_off, f_max):\n    \"\"\"\n    Calculates the optimal gRNA expression level G* for a single parameter set.\n    \"\"\"\n    K_D_all_sites = [K_D_on] + K_D_off\n    B_all_sites = [B_on] + B_off\n    \n    memo_f_off = {}\n\n    def get_f_off(G):\n        \"\"\"\n        Calculates the off-target sequestration fraction f_off for a given G.\n        \"\"\"\n        G_val = float(G)\n        if G_val in memo_f_off:\n            return memo_f_off[G_val]\n\n        if G_val <= 1e-12:\n            return 0.0\n\n        X = alpha * min(C, G_val)\n        if X <= 1e-12:\n            return 0.0\n\n        def mass_balance_residual(L, current_X):\n            \"\"\"Defines the function whose root is the free ligand concentration L.\"\"\"\n            bound_sum = np.sum([\n                B * L / (K_D + L) for B, K_D in zip(B_all_sites, K_D_all_sites) if K_D + L > 0\n            ])\n            return L + bound_sum - current_X\n        \n        sol_L = root_scalar(mass_balance_residual, args=(X,), bracket=[0, X], method='brentq')\n        L = sol_L.root\n\n        off_target_bound = np.sum([\n            B * L / (K_D + L) for B, K_D in zip(B_off, K_D_off) if K_D + L > 0\n        ])\n        \n        result_f_off = off_target_bound / X\n        memo_f_off[G_val] = result_f_off\n        return result_f_off\n\n    f_off_at_g_max = get_f_off(G_max)\n    \n    g_max_feasible = 0.0\n    if f_off_at_g_max <= f_max:\n        g_max_feasible = G_max\n    else:\n        def constraint_violation_func(G):\n            return get_f_off(G) - f_max\n\n        sol_G = root_scalar(constraint_violation_func, bracket=[0, G_max], method='brentq')\n        g_max_feasible = sol_G.root\n\n    if g_max_feasible > C:\n        return C\n    else:\n        return g_max_feasible\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}