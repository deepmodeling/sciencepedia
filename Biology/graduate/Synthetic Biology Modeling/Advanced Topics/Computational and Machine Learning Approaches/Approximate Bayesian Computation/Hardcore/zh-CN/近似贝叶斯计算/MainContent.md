## 引言
[贝叶斯推断](@entry_id:146958)为我们提供了一个基于数据更新信念的严谨框架，在科学与工程的众多领域中都扮演着核心角色。然而，随着我们试图理解的系统日益复杂，描述这些系统的数学模型也变得愈发精细。特别是在合成生物学等领域，捕捉细胞内分子过程内在随机性的模型，其[似然函数](@entry_id:921601)——即在给定模型参数下观测到特定实验数据的概率——往往是“难解的”（intractable），无法写出解析形式或进行高效计算。这个核心挑战阻碍了标准贝叶斯方法的直接应用。

近似贝叶斯计算（Approximate Bayesian Computation, ABC）正是一类为应对这一挑战而生的强大计算方法。它巧妙地绕过了对[似然函数](@entry_id:921601)的直接评估，代之以一个直观的模拟与比较过程。本文旨在系统性地介绍ABC，带领读者从基本原理深入到前沿应用。在接下来的内容中，你将学习到：

在 **“原理与机制”** 一章中，我们将深入探讨ABC的核心思想，剖析其数学基础、理论性质，以及实践中面临的“[维度灾难](@entry_id:143920)”等挑战，并介绍如[ABC-MCMC](@entry_id:746188)和[ABC-SMC](@entry_id:746189)等旨在提升计算效率的高级算法。

在 **“应用与交叉学科联系”** 一章中，我们将通过合成生物学、[群体遗传学](@entry_id:146344)等领域的具体案例，展示ABC如何被用于解决真实的科学问题，从[参数推断](@entry_id:753157)到更高级的[模型选择](@entry_id:155601)和[实验设计](@entry_id:142447)。

最后，在 **“动手实践”** 部分，你将通过一系列精心设计的问题，亲手实现并应用[ABC算法](@entry_id:746190)，将理论知识转化为解决实际问题的能力。

## 原理与机制

在[贝叶斯推断](@entry_id:146958)的框架中，我们的目标是基于观测数据 $y$ 来更新我们对模型参数 $\theta$ 的认知。这一过程由贝叶斯定理数学化地表达：

$$p(\theta | y) = \frac{p(y | \theta) p(\theta)}{p(y)}$$

其中，$p(\theta)$ 是**[先验分布](@entry_id:141376)**（prior distribution），编码了我们在观测数据之前关于参数的信念；$p(y | \theta)$ 是**[似然函数](@entry_id:921601)**（likelihood function），描述了在给定参数 $\theta$ 时观测到数据 $y$ 的概率；而 $p(\theta | y)$ 则是我们追求的**后验分布**（posterior distribution），它代表了在考虑了数据之后关于参数的更新后的信念。

然而，在合成生物学的许多实际建模场景中，尤其是那些涉及内在随机性的复杂系统，[似然函数](@entry_id:921601) $p(y | \theta)$ 往往是“难解的”（intractable）。这意味着我们无法以解析形式写出它，也无法进行高效的数值计算。近似贝叶斯计算（Approximate Bayesian Computation, ABC）正是为解决这一核心挑战而设计的一类强大的计算方法。本章将深入探讨ABC的基本原理、理论基础和关键机制。

### [难解似然](@entry_id:140896)：合成生物学中的核心挑战

在合成生物学中，我们构建的数学模型常常需要捕捉细胞内分子过程的内在随机性。例如，一个典型的[基因表达模型](@entry_id:178501)可能包含转录、翻译、降解等一系列化学反应。在低分子数量下，这些事件的随机发生时间与顺序会导致细胞状态（如mRNA和蛋白质数量）随时间产生不可预测的波动。

描述这类系统动态的黄金标准是**化学主方程**（Chemical Master Equation, CME），它是一个高维、[非线性](@entry_id:637147)、[非高斯性](@entry_id:158327)的连续时间[马尔可夫跳跃过程](@entry_id:751684)。我们可以使用Gillespie的**[随机模拟算法](@entry_id:189454)**（Stochastic Simulation Algorithm, SSA）等方法，精确地从给定参数 $\theta$ 的模型中生成单条[随机轨迹](@entry_id:755474) 。这种从模型生成数据的能力，即对**生成过程**（generative process）$p(x | \theta)$ 的模拟能力，是ABC方法得以实施的基石。这里的 $x$ 代表了系统完整的潜在分子状态轨迹。

然而，实验观测通常是不完整且带有噪声的。例如，我们可能只能在离散的时间点上，通过荧光[报告蛋白](@entry_id:186359)来间接和嘈杂地测量蛋白质丰度，得到观测数据 $y$。在这种**[状态空间模型](@entry_id:137993)**（state-space model）或隐马尔可夫模型的设定下，[似然函数](@entry_id:921601) $p(y | \theta)$ 需要通过对所有可能的、能够产生观测数据 $y$ 的潜在轨迹 $x$ 进行积分（或求和）来获得 ：

$$p(y | \theta) = \int p(y | x, \theta) p(x | \theta) dx$$

在这里，$p(y | x, \theta)$ 是观测模型，描述了从真实状态 $x$ 到观测数据 $y$ 的过程（包含[测量噪声](@entry_id:275238)）；而 $p(x | \theta)$ 是由CME定义的、在无限维路径空间上的[概率测度](@entry_id:190821)。由于 $p(x | \theta)$ 的复杂性，这个积分在计算上是难解的。例如，在一个模拟[双稳态拨动开关](@entry_id:191494)的[合成基因回路](@entry_id:194435)中，即使模型结构相对简单，要评估在整个潜在路径空间上的积分也是不可能的，因为不存在[闭合形式](@entry_id:271343)的解或无偏的可行估计器  。

正是这种“[似然函数](@entry_id:921601)难解但可模拟”的特性，催生了ABC方法。

### ABC 的基本原理：用模拟和比较替代似然评估

ABC的核心思想非常直观：如果一组参数 $\theta$ 能够生成与我们实际观测到的数据 $y_{obs}$ “足够相似”的模拟数据 $y_{sim}$，那么这组参数 $\theta$ 就是一个来自后验分布的合理解。ABC将对[难解似然](@entry_id:140896)函数的直接评估，替换为一个模拟-比较-接受/拒绝的过程。

最基础的[ABC算法](@entry_id:746190)是**ABC拒绝抽样**（ABC rejection sampling），其步骤如下 ：

1.  从[先验分布](@entry_id:141376)中抽取一个候选参数 $\theta^* \sim p(\theta)$。
2.  使用 $\theta^*$ 作为输入，从[生成模型](@entry_id:177561)中模拟一个[合成数据](@entry_id:1132797)集 $y_{sim} \sim p(y | \theta^*)$。
3.  定义一个或多个**摘要统计量**（summary statistics）$s(\cdot)$，将高维数据（如时间序列）压缩到低维空间。计算观测数据的摘要统计量 $s_{obs} = s(y_{obs})$ 和模拟数据的摘要统计量 $s_{sim} = s(y_{sim})$。
4.  使用一个**距离函数**（discrepancy metric）$\rho(\cdot, \cdot)$ 来量化 $s_{sim}$ 和 $s_{obs}$ 之间的差异。
5.  如果这个距离小于一个预先设定的**容忍度**（tolerance）$\epsilon$，即 $\rho(s_{sim}, s_{obs}) \le \epsilon$，则接受参数 $\theta^*$；否则，拒绝它。
6.  重复以上步骤，直到收集到足够数量的被接受的参数。这些被接受的参数集合构成了对[后验分布](@entry_id:145605) $p(\theta | y)$ 的一个近似样本。

这个简单的算法明确了ABC框架的三个关键可调组件：摘要统计量 $s(\cdot)$，距离函数 $\rho(\cdot, \cdot)$，和容忍度 $\epsilon$。

为了更具体地理解这些组件如何相互作用，我们可以考虑一个简化的例子。假设模拟数据的摘要统计量 $s_{sim}$ 是从一个以 $\theta$ 为均值的正态分布中抽取的，即 $s_{sim} | \theta \sim \mathcal{N}(\theta, \sigma^2/m)$，其中 $\sigma^2$ 是已知的测量方差，$m$ 是[样本量](@entry_id:910360)。我们为 $\theta$ 设置一个先验 $\theta \sim \mathcal{N}(\mu_0, \tau_0^2)$。如果我们使用绝对差作为距离函数，接受准则为 $|s_{sim} - s_{obs}| \le \epsilon$。在这种情况下，我们可以解析地计算出单次抽样的**[接受概率](@entry_id:138494)**。该概率由 $s_{sim}$ 的边缘分布（这是一个以 $\mu_0$ 为均值，$\tau_0^2 + \sigma^2/m$ 为方差的正态分布）落在区间 $[s_{obs} - \epsilon, s_{obs} + \epsilon]$ 内的概率质量决定 。其精确表达式为：

$$P_{acc} = \Phi\left(\frac{s_{obs} - \mu_{0} + \epsilon}{\sqrt{\tau_{0}^{2} + \frac{\sigma^{2}}{m}}}\right) - \Phi\left(\frac{s_{obs} - \mu_{0} - \epsilon}{\sqrt{\tau_{0}^{2} + \frac{\sigma^{2}}{m}}}\right)$$

其中 $\Phi(\cdot)$ 是标准正态[累积分布函数](@entry_id:143135)。这个例子清晰地展示了算法的效率（即[接受概率](@entry_id:138494)）是如何依赖于先验、模型随机性以及我们选择的容忍度 $\epsilon$ 的。

### ABC 的形式化框架与理论性质

拒绝抽样算法实际上是更广义的ABC框架的一个特例，它对应于使用一个矩形（或指示函数）**核函数**（kernel）。一个更通用的ABC[后验分布](@entry_id:145605)的数学形式可以写作 ：

$$p_\epsilon(\theta | y) \propto p(\theta) \int K_\epsilon(\rho(s(x), s(y))) p(x | \theta) dx$$

这里的 $K_\epsilon$ 是一个权重核函数，例如[高斯核](@entry_id:1125533)或Epanechnikov核。它为距离小的模拟数据赋予高权重，距离大的模拟数据赋予低权重。容忍度 $\epsilon$ 此时扮演核函数带宽的角色。这个积分项 $\int K_\epsilon(\dots) p(x|\theta) dx$ 实际上是ABC构造的对真实[似然函数](@entry_id:921601) $p(y|\theta)$ 的一个**代理[似然](@entry_id:167119)**（surrogate likelihood）。

ABC的近似性质主要来源于两个方面：

1.  **由 $\epsilon > 0$ 引起的偏差**：只要容忍度 $\epsilon$ 不为零，ABC后验 $p_\epsilon(\theta|y)$ 就是对真实后验 $p(\theta|y)$ 的一个有偏估计。$\epsilon$ 越小，偏差越小，但计算成本（需要更多模拟才能获得一个接受样本）越高。我们可以通过分析ABC[似然](@entry_id:167119)估计量的均方误差（MSE）来理解这种[偏差-方差权衡](@entry_id:138822)。MSE可以分解为偏差的[平方和](@entry_id:161049)方差。对于给定的[核函数](@entry_id:145324) $K$，可以推导出最优的带宽 $\epsilon_{opt}$，它能够在[偏差和方差](@entry_id:170697)之间取得平衡 。

2.  **由非充分统计量引起的信息损失**：如果摘要统计量 $s(\cdot)$ 不是**充分统计量**（sufficient statistic）——即它没有捕捉到数据中关于参数 $\theta$ 的所有信息——那么即使 $\epsilon \to 0$，ABC后验收敛的目标也不是真实的后验 $p(\theta|y)$，而是 $p(\theta|s(y))$。由于信息已在摘要步骤中丢失，这种近似误差是无法通过减小 $\epsilon$ 来消除的。

综合来看，ABC后验 $p_\epsilon(\theta|y)$ 要想在 $\epsilon \to 0$ 时收敛到真实的后验 $p(\theta|y)$，必须满足一组严格的条件 ：
*   摘要统计量 $s(y)$ 对于参数 $\theta$ 必须是充分的。
*   [核函数](@entry_id:145324) $K_\epsilon$ 必须构成一个**[近似单位](@entry_id:158751)**（approximate identity），在 $\epsilon \to 0$ 时[弱收敛](@entry_id:146650)于狄拉克 $\delta$ 函数。
*   摘要统计量的[条件概率密度](@entry_id:265457) $p(s|\theta)$ 在观测值 $s(y)$ 处必须是连续的。
*   最重要的是，用于生成模拟数据的**模拟器必须忠实地代表真实的数据生成过程**，包括随机的生物化学动力学和实验测量噪声模型。任何对模型的简化（例如，用确定性ODE代替SSA，或忽略[测量噪声](@entry_id:275238)）都会导致ABC收敛到一个错误模型的后验。

尽管ABC是一种近似方法，但它有一个非常优美的理论解释，即**增广模型解释**（augmented model interpretation）。我们可以将ABC看作是在一个稍微不同的、增广的模型上进行**精确**的贝叶斯推断。这个增广模型假定，我们观测到的摘要统计量 $s(y)$ 并不是模拟产生的“真实”摘要统计量 $s(y_{sim})$，而是它的一个含噪版本，其噪声由[核函数](@entry_id:145324) $K_\epsilon$ 和距离度量 $\rho$ 定义。因此，ABC并非“近似贝叶斯”，而是“对一个近似模型的精确[贝叶斯推断](@entry_id:146958)”，这为该方法提供了坚实的理论基础。

### 实践挑战与高级机制

在实践中应用ABC时，研究者会面临两个主要挑战：摘要统计量的选择和[计算效率](@entry_id:270255)。

#### 维度灾难

ABC的性能对摘要统计量的维度 $d$ 非常敏感，这一现象被称为**[维度灾难](@entry_id:143920)**（curse of dimensionality）。直观上，在高维空间中，两个点“碰巧”靠近的概率极低。因此，随着 $d$ 的增加，为了维持一个可接受的接受率，我们必须极大地放宽容忍度 $\epsilon$，但这会增加ABC后验的偏差。

我们可以通过一个具体的例子来量化这个问题 。假设在一个 $d$ 维摘要空间中，模拟摘要 $S(\theta)$ 与观测摘要 $s^{obs}$ 之间的差异向量 $\Delta = S(\theta) - s^{obs}$ 的每个分量都服从独立的[标准正态分布](@entry_id:184509) $\mathcal{N}(0, \tau^2)$。ABC接受条件为[欧几里得范数](@entry_id:172687) $\|\Delta\|_2 \le \epsilon$。那么，[接受概率](@entry_id:138494)可以精确地表示为：

$$P_{acc} = P\left(\sum_{j=1}^d \Delta_j^2 \le \epsilon^2\right) = P\left(\sum_{j=1}^d (\tau Z_j)^2 \le \epsilon^2\right) = P\left(\chi^2(d) \le \frac{\epsilon^2}{\tau^2}\right)$$

其中 $Z_j \sim \mathcal{N}(0, 1)$，$d$ 是维度，$\chi^2(d)$ 是自由度为 $d$ 的[卡方分布](@entry_id:263145)。这个概率由[卡方分布](@entry_id:263145)的[累积分布函数](@entry_id:143135)（CDF）给出，可以用[不完全伽马函数](@entry_id:190207) $\gamma$ 和伽马函数 $\Gamma$ 表示：

$$P_{acc}(d, \epsilon, \tau) = \frac{\gamma\left(\frac{d}{2}, \frac{\epsilon^2}{2\tau^2}\right)}{\Gamma\left(\frac{d}{2}\right)}$$

由于[卡方分布](@entry_id:263145)的均值是其自由度 $d$，随着 $d$ 的增长，分布的质量会向右移动，远离固定的接受阈值 $\epsilon^2/\tau^2$。结果是，[接受概率](@entry_id:138494)会随着维度的增加而急剧下降。这凸显了选择低维且信息丰富的摘要统计量的极端重要性。这也解释了在有限计算预算下，为何高维摘要统计量是不可行的 。

#### 提升计算效率

基础的ABC拒绝抽样算法简单但效率低下，尤其是在后验分布与[先验分布](@entry_id:141376)差异很大或 $\epsilon$ 很小的情况下。为了克服这一问题，研究者开发了更先进的采样算法。

**ABC[马尔可夫链蒙特卡洛](@entry_id:138779) ([ABC-MCMC](@entry_id:746188))**

[ABC-MCMC](@entry_id:746188)将ABC思想与[马尔可夫链蒙特卡洛](@entry_id:138779)(MCMC)方法相结合 。它不是从先验中独立地抽取样本，而是在参数空间中构建一个[马尔可夫链](@entry_id:150828)，使其[平稳分布](@entry_id:194199)为目标ABC后验 $p_\epsilon(\theta|y)$。在Metropolis-Hastings框架下，从当前参数 $\theta$ 移动到一个提议参数 $\theta'$ 的[接受概率](@entry_id:138494) $\alpha$ 为：

$$\alpha(\theta \to \theta') = \min\left(1, \frac{\pi(\theta') q(\theta|\theta')}{\pi(\theta) q(\theta'|\theta)}\right)$$

其中 $q(\cdot|\cdot)$ 是[提议分布](@entry_id:144814)。这个转移只有在模拟数据满足容忍度条件 $\rho(s(y_{sim}), s_{obs}) \le \epsilon$ 时才会被考虑。值得注意的是，在计算接受率时，难解的[似然](@entry_id:167119)项 $p(y|\theta)$ 被模拟和比较步骤隐式地处理掉了，它们在Metropolis-Hastings比率中被有效地“抵消”。这使得MCMC能够在参数空间的高概率区域进行更有效的探索。

**ABC[序贯蒙特卡洛](@entry_id:147384) ([ABC-SMC](@entry_id:746189))**

[ABC-SMC](@entry_id:746189)是目前最流行和最高效的ABC变体之一 。它通过一个序贯的过程，逐步地从先验分布演化到目标[后验分布](@entry_id:145605)。该算法维护一个带权重的“粒子”云（即参数样本），并通过一系列中间分布进行传播。

一个典型的[ABC-SMC](@entry_id:746189)算法如下：
1.  **初始化 (t=1)**：通过ABC拒绝抽样从先验 $\pi(\theta)$ 中生成 $N$ 个粒子，使其满足一个宽松的容忍度 $\epsilon_1$。所有粒子的权重初始为 $1/N$。
2.  **序贯步骤 (t=2, ..., T)**：对于每一代 $t$，算法会收紧容忍度至 $\epsilon_t  \epsilon_{t-1}$。
    a. **[重采样](@entry_id:142583) (Resampling)**：根据上一代粒子的权重 $w_{t-1}$ 进行[重采样](@entry_id:142583)，以消除权重低的粒子并复制权重高的粒子。
    b. **变异 (Mutation)**：对[重采样](@entry_id:142583)后的每个粒子，通过一个**扰动核**（perturbation kernel）$K_t$ 进行随机扰动，生成一个新的候选参数 $\theta^*$。
    c. **接受/拒绝**：从模型中模拟数据，只有当 $\theta^*$ 生成的数据满足更严格的容忍度 $\epsilon_t$ 时，它才被保留为新一代的粒子 $\theta_t$。
    d. **权重更新**：根据重要性采样的原理，为新一代的粒子 $\theta_t$ 计算新的权重。权重 $w_t$ 正比于其先验概率，反比于从上一代粒子云生成它的概率：

    $$w_t^{(i)} \propto \frac{\pi(\theta_t^{(i)})}{\sum_{j=1}^N w_{t-1}^{(j)} K_t(\theta_t^{(i)} | \theta_{t-1}^{(j)})}$$

通过这种方式，粒子云逐渐适应越来越严格的约束，最终集中在满足最严格容忍度 $\epsilon_T$ 的参数区域，从而高效地近似目标[后验分布](@entry_id:145605)。