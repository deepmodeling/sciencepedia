{
    "hands_on_practices": [
        {
            "introduction": "在构建复杂的混合模型之前，我们必须掌握随机模拟的基本单元：随机模拟算法（SSA）的单步执行。本练习  旨在巩固我们对SSA回答的两个关键问题的理解：“下一个反应是哪个？”和“它何时发生？”。掌握这一点至关重要，因为许多混合方法的随机部分都依赖于这些相同的核心原则。",
            "id": "3915219",
            "problem": "考虑一个充分混合的合成基因线路模块，该模块被建模为一个双物种转换系统，包含反应 $A \\to B$ 和 $B \\to A$。在一个混合随机-确定性模拟方案中，假设这两个转换反应被指定为随机子集的一部分，并使用随机模拟算法（SSA）进行推演。假设系统体积恒定且足够小，以致于涨落不可忽略，并且这两个单分子反应的动力学在化学主方程框架下满足质量作用假设。设反应 $A \\to B$ 的随机速率常数（单位为分钟的倒数）为 $k>0$，反应 $B \\to A$ 的随机速率常数为 $h>0$。在当前离散分子数状态为 $(A,B)=(50,10)$ 时，从概念上执行一个SSA步骤，并确定：\n- 下一个反应事件是 $A \\to B$ 的概率，以及\n- 到下一个反应事件发生的期望等待时间。\n仅使用与化学主方程和充分混合随机动力学中反应事件时间的无记忆性相一致的第一性原理来推导您的表达式。用包含 $k$ 和 $h$ 的符号形式表达您的最终答案。对于期望等待时间，请以分钟为单位表示该量。在最终的方框答案中不要包含单位。不需要进行数值取整。",
            "solution": "该问题是有效的，因为它在科学上基于随机化学动力学的既定原理，问题设定良好，具有唯一且可推导的解，并以客观、正式的语言表述。我们可以开始求解。\n\n该问题要求计算与给定化学系统的随机模拟算法（SSA）（也称为Gillespie算法）单个步骤相关的两个量。该算法的基础是化学主方程（CME），它描述了系统处于特定状态的概率随时间的演化。SSA提供了一种生成系统状态随时间变化的统计精确轨迹的方法。在SSA的每一步中，都会回答两个关键问题：（1）下一个反应将在何时发生？以及（2）将是哪个反应？\n\n该系统包含两个物种，$A$ 和 $B$，以及两个单分子反应：\n1. $R_1: A \\to B$，随机速率常数为 $k > 0$。\n2. $R_2: B \\to A$，随机速率常数为 $h > 0$。\n\n系统在任意时刻 $t$ 的状态由各物种的离散分子数定义，由向量 $\\mathbf{X}(t) = (A(t), B(t))$ 给出。我们已知当前状态为 $\\mathbf{x} = (A, B) = (50, 10)$。\n\nSSA的核心是倾向函数 $a_\\mu(\\mathbf{x})$，它是反应 $\\mu$ 的随机速率常数 $c_\\mu$ 与不同反应物组合数 $h_\\mu(\\mathbf{x})$ 的乘积。对于一个充分混合的系统，在时刻 $t$ 状态为 $\\mathbf{x}$ 的条件下，$a_\\mu(\\mathbf{x}) d t$ 是反应 $\\mu$ 在无穷小时间间隔 $[t, t+dt)$ 内发生的概率。\n\n对于给定的单分子反应，倾向函数根据质量作用动力学推导如下：\n- 对于 $R_1: A \\to B$，倾向函数 $a_1$ 与反应物 $A$ 的分子数成正比。\n$$a_1(A) = k A$$\n- 对于 $R_2: B \\to A$，倾向函数 $a_2$ 与反应物 $B$ 的分子数成正比。\n$$a_2(B) = h B$$\n\n在当前状态 $(A, B) = (50, 10)$ 下，我们可以计算具体的倾向函数值：\n- $a_1 = k \\cdot 50 = 50k$\n- $a_2 = h \\cdot 10 = 10h$\n\n总倾向函数 $a_0$ 是所有单个反应倾向函数的总和。它表示任何反应事件发生的总速率。\n$$a_0 = \\sum_{\\mu=1}^{2} a_\\mu = a_1 + a_2 = 50k + 10h$$\n\n有了这些量，我们就可以解决问题的两个部分。\n\n首先，我们确定下一个反应事件是 $A \\to B$ 的概率。根据SSA的公式，下一个反应是 $R_\\mu$ 的概率是其单个倾向函数 $a_\\mu$ 与总倾向函数 $a_0$ 的比值。这是因为这些反应被视为相互竞争的泊松过程。\n因此，下一个反应是 $R_1$ ($A \\to B$) 的概率为：\n$$P(R_1 \\text{ is next}) = \\frac{a_1}{a_0} = \\frac{50k}{50k + 10h}$$\n通过从分子和分母中提取公因数 $10$，可以简化此表达式：\n$$P(R_1 \\text{ is next}) = \\frac{10(5k)}{10(5k + h)} = \\frac{5k}{5k + h}$$\n\n其次，我们确定到下一个反应事件发生的期望等待时间。CME框架（SSA由此推导而来）的一个基本性质是，等待下一个反应发生的时间 $\\tau$ 是一个随机变量，服从速率参数等于总倾向函数 $a_0$ 的指数分布。等待时间的概率密度函数是 $p(\\tau) = a_0 \\exp(-a_0 \\tau)$。这是基元反应的无记忆性的直接结果。\n\n速率参数为 $\\lambda$ 的指数分布的期望值 $E[\\tau]$ 是 $1/\\lambda$。在我们的例子中，速率参数是 $a_0$。因此，到下一个反应事件发生的期望等待时间是：\n$$E[\\tau] = \\frac{1}{a_0} = \\frac{1}{50k + 10h}$$\n问题指出，速率常数 $k$ 和 $h$ 的单位是分钟的倒数（$\\text{min}^{-1}$）。因此，倾向函数 $a_1$、$a_2$ 和 $a_0$ 的单位也是 $\\text{min}^{-1}$。所以，期望等待时间 $E[\\tau] = 1/a_0$ 的单位将是分钟，符合要求。该表达式也可以写成因式分解的形式 $\\frac{1}{10(5k+h)}$。为保持一致性，我们将在分母中使用未分解的形式。\n\n所求的两个量是下一个反应为 $A \\to B$ 的概率，即 $\\frac{5k}{5k+h}$，以及下一个反应的期望等待时间，即 $\\frac{1}{50k+10h}$ 分钟。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{5k}{5k+h} & \\frac{1}{50k+10h} \\end{pmatrix}}$$"
        },
        {
            "introduction": "现在，我们将确定性演化与离散随机事件结合在一个经典混合模型——分段确定性马尔可夫过程（PDMP）中。本练习  要求您模拟一个基因开关，其中蛋白质水平通过常微分方程（ODE）连续变化，但基因本身在随机的、依赖于状态的时刻翻转其状态。您将使用稀疏算法（thinning algorithm），这是一种处理时变事件发生率的强大技术，来确定下一次随机跳跃何时发生。",
            "id": "3915247",
            "problem": "考虑一个分段确定性马尔可夫过程 (PDMP)，该过程为一个具有二元启动子状态 $Z \\in \\{0,1\\}$ 和连续蛋白质浓度 $x \\ge 0$ 的单基因开关建模。启动子从关闭状态 $Z=0$ 切换到开启状态 $Z=1$ 的倾向是依赖于 $x$ 的 $k_{\\mathrm{on}}(x)=\\frac{\\alpha}{1+x^{n}}$，而从开启状态 $Z=1$ 切换到关闭状态 $Z=0$ 的倾向是恒定的 $k_{\\mathrm{off}}=\\beta$。在启动子切换之间，蛋白质浓度遵循常微分方程 (ODE) $\\dot{x}=k_{p} Z - \\gamma x$ 的确定性动力学。PDMP 由这些倾向以及事件之间的 ODE 共同驱动；当事件发生时，$Z$ 发生翻转，ODE 向量场也随之改变。\n\n从以下基本原理出发：(i) 一个具有随时间变化强度的非齐次泊松过程，可以通过使用一个主导的齐次泊松过程进行减薄模拟；(ii) ODE $\\dot{x}=-\\gamma x$ 的解为 $x(t)=x_{0}\\exp(-\\gamma t)$。假设初始时 $Z(0)=0$ 且 $x(0)=x_{0}$，参数 $\\alpha$、$\\beta$、$k_{p}$、$\\gamma$ 和 $n$ 如下文给定。在 $Z=0$ 的情况下，实现一个 PDMP 步骤，通过对随时间变化的从关到开的切换强度进行减薄，来计算下一个事件发生的时间。使用一个恒定的上界，该上界等于从初始条件出发的确定性轨迹上 $k_{\\mathrm{on}}(x(t))$ 的最大可能值。齐次候选事件时间服从一个指数分布，其速率为选定的上界速率，这些时间是通过使用独立的 Uniform$(0,1)$ 随机变量模拟生成的。每个提出的候选时间以等于该时间的真实强度与上界之比的概率被接受；否则，它被拒绝，减薄过程从新的时间点继续进行。\n\n使用以下参数值和初始条件：$\\alpha=0.9\\,\\mathrm{min}^{-1}$，$\\beta=0.3\\,\\mathrm{min}^{-1}$，$k_{p}=8\\,\\mathrm{min}^{-1}$，$\\gamma=0.4\\,\\mathrm{min}^{-1}$，$n=2$，以及 $x_{0}=2.5$。为保证可复现性，请使用以下用于减薄的独立 Uniform$(0,1)$ 随机变量序列：$u_{1}=0.2$, $u_{2}=0.5$, $u_{3}=0.9$, $u_{4}=0.7$, $u_{5}=0.05$, $u_{6}=0.6$。计算第一个被接受的启动子翻转发生的下一个事件时间 $t_{\\mathrm{event}}$（单位为分钟）。时间以分钟表示，并将最终答案四舍五入到 $4$ 位有效数字。",
            "solution": "该问题是减薄算法（也称为 Ogata 算法或接受-拒绝法）在模拟非齐次泊松过程中的一个有效应用，而模拟非齐次泊松过程是模拟分段确定性马尔可夫过程 (PDMP) 的核心组成部分。所有必需的数据和参数均已提供，且该模型在科学上是合理的，代表了随机基因开关的一个标准模型。\n\n系统的状态由启动子状态 $Z \\in \\{0,1\\}$ 和蛋白质浓度 $x \\ge 0$ 给出。初始条件为 $Z(0)=0$ 和 $x(0) = x_0 = 2.5$。我们需要找到第一个事件发生的时间，即启动子从关闭状态 ($Z=0$) 切换到开启状态 ($Z=1$) 的时间。\n\n步骤 1：确定蛋白质浓度的确定性演化。\n在随机跳跃之间，系统根据常微分方程 (ODE) $\\dot{x} = k_{p}Z - \\gamma x$ 演化。由于系统从状态 $Z(0)=0$ 开始，并在第一次跳跃前保持该状态，因此对于 $t \\ge 0$，控制 ODE 为：\n$$ \\dot{x} = k_{p}(0) - \\gamma x = -\\gamma x $$\n该 ODE 在初始条件 $x(0)=x_0$ 下的解为：\n$$ x(t) = x_0 \\exp(-\\gamma t) $$\n代入给定的参数值 $x_0 = 2.5$ 和 $\\gamma = 0.4\\,\\mathrm{min}^{-1}$，我们得到：\n$$ x(t) = 2.5 \\exp(-0.4 t) $$\n\n步骤 2：确定随时间变化的切换倾向。\n启动子从 $Z=0$ 切换到 $Z=1$ 的倾向是状态依赖的 $k_{\\mathrm{on}}(x) = \\frac{\\alpha}{1+x^n}$。由于 $x$ 是时间的函数，该倾向变为一个随时间变化的强度，我们将其记为 $\\lambda(t)$：\n$$ \\lambda(t) = k_{\\mathrm{on}}(x(t)) = \\frac{\\alpha}{1 + (x(t))^n} $$\n代入 $x(t)$ 的表达式以及参数值 $\\alpha=0.9\\,\\mathrm{min}^{-1}$ 和 $n=2$：\n$$ \\lambda(t) = \\frac{0.9}{1 + (2.5 \\exp(-0.4 t))^2} = \\frac{0.9}{1 + 6.25 \\exp(-0.8 t)} $$\n\n步骤 3：确定用于减薄算法的恒定速率上界。\n减薄算法需要一个恒定速率 $\\lambda_{\\max}$，使得在整个模拟区间内，对于所有 $t$ 都有 $\\lambda_{\\max} \\ge \\lambda(t)$。问题指定使用沿轨迹的 $k_{\\mathrm{on}}(x(t))$ 的最大可能值。\n对于 $t \\ge 0$，蛋白质浓度 $x(t) = 2.5 \\exp(-0.4 t)$ 是时间的单调递减函数。倾向 $k_{\\mathrm{on}}(x) = \\frac{\\alpha}{1+x^n}$ 是 $x$ 的单调递减函数（对于 $x \\ge 0$）。因此，复合函数 $\\lambda(t) = k_{\\mathrm{on}}(x(t))$ 是时间 $t$ 的单调递增函数。\n最大值是当 $t \\to \\infty$ 时的上确界：\n$$ \\lambda_{\\max} = \\sup_{t \\ge 0} \\lambda(t) = \\lim_{t \\to \\infty} \\frac{0.9}{1 + 6.25 \\exp(-0.8 t)} = \\frac{0.9}{1 + 0} = 0.9\\,\\mathrm{min}^{-1} $$\n因此，我们使用恒定速率上界 $\\lambda_{\\max} = 0.9\\,\\mathrm{min}^{-1}$。\n\n步骤 4：执行减薄算法。\n我们从时间 $t_{\\mathrm{curr}} = 0$ 开始，并使用提供的均匀分布随机变量序列 $u_i \\in (0,1)$。对于每次迭代 $j$，我们生成一个候选时间间隔 $\\Delta t_j = -\\frac{\\ln(u_{2j-1})}{\\lambda_{\\max}}$ 和一个候选事件时间 $t_{\\mathrm{cand},j} = t_{\\mathrm{curr}} + \\Delta t_j$。如果 $u_{2j} \\le \\frac{\\lambda(t_{\\mathrm{cand},j})}{\\lambda_{\\max}}$，则该事件被接受。如果被拒绝，我们设置 $t_{\\mathrm{curr}} = t_{\\mathrm{cand},j}$ 并继续。\n\n迭代 1:\n- 使用 $u_1=0.2$ 提出一个时间间隔：$\\Delta t_1 = -\\frac{\\ln(0.2)}{0.9} \\approx 1.788264\\,\\mathrm{min}$。\n- 候选时间：$t_{\\mathrm{cand},1} = 0 + 1.788264 = 1.788264\\,\\mathrm{min}$。\n- 计算在 $t_{\\mathrm{cand},1}$ 处的倾向：\n  $x(t_{\\mathrm{cand},1}) = 2.5 \\exp(-0.4 \\times 1.788264) \\approx 1.222584$。\n  $\\lambda(t_{\\mathrm{cand},1}) = \\frac{0.9}{1 + (1.222584)^2} \\approx 0.360767\\,\\mathrm{min}^{-1}$。\n- 接受概率：$\\frac{\\lambda(t_{\\mathrm{cand},1})}{\\lambda_{\\max}} = \\frac{0.360767}{0.9} \\approx 0.400852$。\n- 使用 $u_2=0.5$ 进行接受测试：$0.5 \\le 0.400852$ 吗？否。该事件被**拒绝**。\n- 更新当前时间：$t_{\\mathrm{curr}} = t_{\\mathrm{cand},1} = 1.788264\\,\\mathrm{min}$。\n\n迭代 2:\n- 使用 $u_3=0.9$ 提出一个时间间隔：$\\Delta t_2 = -\\frac{\\ln(0.9)}{0.9} \\approx 0.117067\\,\\mathrm{min}$。\n- 候选时间：$t_{\\mathrm{cand},2} = 1.788264 + 0.117067 = 1.905331\\,\\mathrm{min}$。\n- 计算在 $t_{\\mathrm{cand},2}$ 处的倾向：\n  $x(t_{\\mathrm{cand},2}) = 2.5 \\exp(-0.4 \\times 1.905331) \\approx 1.166675$。\n  $\\lambda(t_{\\mathrm{cand},2}) = \\frac{0.9}{1 + (1.166675)^2} \\approx 0.381173\\,\\mathrm{min}^{-1}$。\n- 接受概率：$\\frac{\\lambda(t_{\\mathrm{cand},2})}{\\lambda_{\\max}} = \\frac{0.381173}{0.9} \\approx 0.423526$。\n- 使用 $u_4=0.7$ 进行接受测试：$0.7 \\le 0.423526$ 吗？否。该事件被**拒绝**。\n- 更新当前时间：$t_{\\mathrm{curr}} = t_{\\mathrm{cand},2} = 1.905331\\,\\mathrm{min}$。\n\n迭代 3:\n- 使用 $u_5=0.05$ 提出一个时间间隔：$\\Delta t_3 = -\\frac{\\ln(0.05)}{0.9} \\approx 3.328591\\,\\mathrm{min}$。\n- 候选时间：$t_{\\mathrm{cand},3} = 1.905331 + 3.328591 = 5.233922\\,\\mathrm{min}$。\n- 计算在 $t_{\\mathrm{cand},3}$ 处的倾向：\n  $x(t_{\\mathrm{cand},3}) = 2.5 \\exp(-0.4 \\times 5.233922) \\approx 0.308132$。\n  $\\lambda(t_{\\mathrm{cand},3}) = \\frac{0.9}{1 + (0.308132)^2} \\approx 0.821959\\,\\mathrm{min}^{-1}$。\n- 接受概率：$\\frac{\\lambda(t_{\\mathrm{cand},3})}{\\lambda_{\\max}} = \\frac{0.821959}{0.9} \\approx 0.913288$。\n- 使用 $u_6=0.6$ 进行接受测试：$0.6 \\le 0.913288$ 吗？是。该事件被**接受**。\n\n下一个事件时间是第三个候选时间，$t_{\\mathrm{event}} = t_{\\mathrm{cand},3}$。\n累积时间为：\n$$ t_{\\mathrm{event}} = -\\frac{\\ln(u_1)}{\\lambda_{\\max}} - \\frac{\\ln(u_3)}{\\lambda_{\\max}} - \\frac{\\ln(u_5)}{\\lambda_{\\max}} = -\\frac{\\ln(u_1 u_3 u_5)}{\\lambda_{\\max}} $$\n$$ t_{\\mathrm{event}} = -\\frac{\\ln(0.2 \\times 0.9 \\times 0.05)}{0.9} = -\\frac{\\ln(0.009)}{0.9} \\approx 5.23392305\\,\\mathrm{min} $$\n四舍五入到 4 位有效数字，我们得到 $5.234$。",
            "answer": "$$ \\boxed{5.234} $$"
        },
        {
            "introduction": "虽然PDMP是精确的，但其计算成本可能很高。一种替代方法是使用化学朗之万方程（CLE）来近似系统动态，但这会引入数值挑战。本练习  探讨了一个关键问题：标准的CLE数值方法可能产生不符合物理事实的负分子数。您将评估各种强制非负性的策略，并理解为何简单的修复方法常常失败，以及为何需要更复杂的混合方法来实现稳健的模拟。",
            "id": "3915246",
            "problem": "考虑合成生物学中的一个单物种生灭基因表达模型，其中含有一种分子物种 $X$（例如信使核糖核酸）和两个反应通道：出生，其倾向函数为 $a_1(x) = k$；以及死亡，其倾向函数为 $a_2(x) = \\mu x$，其中 $k > 0$ 和 $\\mu > 0$ 是常数，$x \\in \\mathbb{R}_{\\ge 0}$ 表示拷贝数。化学计量向量为 $S = ( +1, -1 )$。化学主方程 (CME) 控制着这个连续时间马尔可夫链的精确动力学。在标准条件（大体积和中等拷贝数）下，可以得到扩散近似，即化学朗之万方程 (CLE)，在简化为一维噪声后，其形式为\n$$\ndX(t) = \\big(k - \\mu X(t)\\big)\\,dt + \\sqrt{k + \\mu X(t)}\\,dW(t),\n$$\n其中 $W(t)$ 是一个标准维纳过程。\n\n对 CLE 应用步长为 $h > 0$ 的标准显式欧拉-丸山时间离散化，可得\n$$\nX_{n+1} = X_n + \\big(k - \\mu X_n\\big)\\,h + \\sqrt{k + \\mu X_n}\\,\\sqrt{h}\\,Z_n,\n$$\n其中 $Z_n \\sim \\mathcal{N}(0,1)$ 是独立同分布的。众所周知，这种离散化方法不能保证 $X_{n+1} \\ge 0$，当 $X_n$ 很小且 $Z_n$ 为足够小的负数时，可能会产生负值，这在生物化学背景下是不符合物理实际的。\n\n你的任务是确定一种有原则的修正方法，该方法适用于混合随机-确定性模拟，既能在边界附近强制非负性，又能在一个固定的有限时间域上保持离散化 CLE 对 CME/CLE 动力学的弱收敛性。我们所说的“$p$ 阶弱收敛”是指，对于任何有界二次连续可微的检验函数 $\\varphi$，弱误差满足\n$$\n\\max_{0 \\le t_n \\le T} \\left| \\mathbb{E}\\big[\\varphi(X_n)\\big] - \\mathbb{E}\\big[\\varphi(X(t_n))\\big] \\right| = \\mathcal{O}\\big(h^p\\big),\n$$\n当 $h \\to 0$ 时。\n\n请考虑以下候选方案。选择一个能正确描述某种方法的选项，该方法 (i) 在小拷贝数区域内强制 $X_{n+1} \\ge 0$，并且 (ii) 在 CLE 系数满足标准的李普希兹条件和线性增长条件下，对于有界平滑可观测量在固定的有限时间区间上保持 1 阶弱收敛。\n\nA. 在每个 Euler–Maruyama 步后，进行分量投影到非负象限，并结合一个依赖于状态的混合切换：当 $X_n \\ge \\delta(h)$ 时，切换到随机模拟算法 (SSA)，其中 $\\delta(h) = c\\,h^\\gamma$，$c > 0$ 和 $\\gamma \\in (0,1)$ 为常数。即，\n$$\n\\tilde{X}_{n+1} = X_n + \\big(k - \\mu X_n\\big)\\,h + \\sqrt{k + \\mu X_n}\\,\\sqrt{h}\\,Z_n,\\quad X_{n+1} = \\max\\{0,\\tilde{X}_{n+1}\\},\n$$\n如果 $X_n \\ge \\delta(h)$；否则，通过 SSA 精确推进，直到状态离开 $\\delta(h)$ 邻域。这保证了 $X_{n+1} \\ge 0$，并且当 $X_n \\ge \\delta(h)$ 时，投影发生的概率为 $\\mathcal{O}\\big(e^{-C/h}\\big)$，而当 $X_n < \\delta(h)$ 时，SSA 消除了边界伪影。由于 Euler–Maruyama 在远离边界处的偏差为 $\\mathcal{O}(h)$ 且投影是指数级稀少的，该整体方案对于有界函数 $\\varphi$ 在 $[0,T]$ 上达到了 1 阶弱收敛。\n\nB. 向倾向函数中添加一个小的正偏移量 $\\varepsilon > 0$，将 $a_1(x)$ 替换为 $k + \\varepsilon$，将 $a_2(x)$ 替换为 $\\mu x + \\varepsilon$，并保持 Euler–Maruyama 更新不变。这将扩散系数增大到 $\\sqrt{k + \\mu X_n + 2\\varepsilon}$，从而在没有显式强制的情况下减少了 $X_{n+1} < 0$ 的机会。如果取 $\\varepsilon = h$，则当 $h \\to 0$ 时，增加的 $\\varepsilon$ 会消失，因此该方案保持了 1 阶弱收敛。\n\nC. 每当 $\\tilde{X}_{n+1} < 0$ 时，通过设置 $X_{n+1} := \\lvert \\tilde{X}_{n+1} \\rvert$ 来反射负的提议值，不进行混合切换。反射强制了 $X_{n+1} \\ge 0$，并且由于反射在分布上保持了增量的高斯性，因此维持了 1 阶弱收敛。\n\nD. 应用对数变换 $Y_n = \\log\\big( X_n + \\eta \\big)$，其中 $\\eta > 0$ 为固定值，通过对变换后的 CLE 应用 Euler–Maruyama 模拟 $Y$（不加伊藤修正项），然后进行逆变换以恢复 $X_{n+1} = \\exp(Y_{n+1}) - \\eta$。由于对数函数是平滑的，并通过 $\\eta$ 远离奇点，这种方法强制了正性并保持了 1 阶弱收敛。\n\nE. 通过对 $Z_n$ 施加条件以使 $\\tilde{X}_{n+1} \\ge 0$ 来截断高斯增量，即从一个下截断正态分布中抽样 $Z_n$，其截断点经选择以满足 $\\tilde{X}_{n+1} \\ge 0$。这确保了 $X_{n+1} \\ge 0$，并且由于截断只改变了分布的尾部，对于有界可观测量，1 阶弱收敛不受影响。\n\n哪个选项是正确的？",
            "solution": "用户要求评估几种针对化学朗之万方程 (CLE) 的数值方案，评估依据有两个标准：(i) 强制状态变量的非负性，以及 (ii) 保持 1 阶弱收敛。问题陈述本身在科学上是有效且适定的。它描述了一个典型的生灭过程、其对应的 CLE 以及标准的欧拉-丸山离散化。其核心问题——显式欧拉-丸山格式未能保持状态空间正性的问题——是随机微分方程 (SDE) 数值分析中一个有充分文献记载的问题，尤其是在计算生物学和金融学领域。\n\n所讨论的 SDE 是：\n$$ dX(t) = \\big(k - \\mu X(t)\\big)\\,dt + \\sqrt{k + \\mu X(t)}\\,dW(t) $$\n其中 $k > 0$ 且 $\\mu > 0$。状态空间为 $X(t) \\in [0, \\infty)$。标准的欧拉-丸山格式是：\n$$ X_{n+1} = X_n + \\big(k - \\mu X_n\\big)\\,h + \\sqrt{k + \\mu X_n}\\,\\sqrt{h}\\,Z_n, $$\n其中 $Z_n \\sim \\mathcal{N}(0,1)$。众所周知，对于系数满足特定光滑性和增长条件的 SDE，该格式具有 1 阶的弱收敛阶。然而，平方根扩散项 $g(X) = \\sqrt{k + \\mu X}$ 不是全局李普希兹的，更重要的是，高斯增量 $\\sqrt{h}Z_n$ 可能导致 $X_{n+1}$ 变为负数。\n\n我们的任务是确定哪个方案能正确地强制 $X_{n+1} \\ge 0$，同时在有限时间域 $[0, T]$ 上可证明地保持 $\\mathcal{O}(h)$ 的全局弱误差（即 1 阶弱收敛）。让我们逐一分析每个选项。\n\n### 选项 A\n\n**评估**：这个选项提出了一个包含两个部分的混合方案：\n1. **投影和 Euler-Maruyama 法：** 对于状态 $X_n \\ge \\delta(h) = c h^\\gamma$，执行一个显式 Euler-Maruyama 步，然后进行投影 $X_{n+1} = \\max\\{0, \\tilde{X}_{n+1}\\}$。\n2. **精确模拟 (SSA)：** 对于状态 $X_n < \\delta(h)$，系统使用随机模拟算法 (SSA，即 Gillespie 算法) 进行演化，这是一种针对底层化学主方程 (CME) 的精确模拟方法。\n\n**正性强制（标准 i）：** 该方案通过设计来强制非负性。投影步骤确保了在扩散区域内的 $X_{n+1} \\ge 0$，而 SSA 模拟的是非负整数上的离散跳跃过程，在“低拷贝数”区域内在地保持了非负性。\n\n**1 阶弱收敛（标准 ii）：** 标准的 Euler-Maruyama 方法具有 $\\mathcal{O}(h^2)$ 的局部弱误差，积分后得到 $\\mathcal{O}(h^1)$ 的全局弱误差。问题是这些修改是否会降低这个阶。\n- 对于 $X_n < \\delta(h)$ 使用 SSA，是用一个精确的方法 (CME) 替换了一个近似的方法 (CLE)。在小拷贝数区域，CLE 是对 CME 的一个较不准确的近似，因此切换到精确的 SSA 是一种提高保真度的修改。这类设计合理的混合方案已知可以保持，有时甚至改善收敛性质。\n- 投影 $X_{n+1} = \\max\\{0, \\tilde{X}_{n+1}\\}$ 引入了一个偏差。然而，这个偏差仅在无约束步 $\\tilde{X}_{n+1}$ 为负时才会产生。对于 $X_n \\ge \\delta(h)$，此事件的概率为 $P(\\tilde{X}_{n+1} < 0) = P\\left(Z_n < -\\frac{X_n + (k-\\mu X_n)h}{\\sqrt{k+\\mu X_n}\\sqrt{h}}\\right)$。因为边界处的漂移为正 ($k>0$) 且扩散项非零，过程被推离边界。一个已知的结果是，对于离边界足够远的状态，这个概率随 $h$ 指数级快速衰减，即为 $\\mathcal{O}(e^{-C/h})$（其中 $C>0$ 为常数）。一个以指数级小概率发生的误差项对期望的贡献也是指数级小的。对于任何 $p > 0$，这样的项比任何多项式项 $\\mathcal{O}(h^p)$ 都小，因此不会降低 1 阶的弱收敛阶。\n\n这两种技术的结合是模拟有界域上 SDE 的鲁棒、高弱阶方法的特征。该描述在物理上和数学上都是合理的。\n\n**结论**：**正确**。\n\n### 选项 B\n\n**评估**：该选项建议扰动倾向函数，这导致一个修正的 CLE。当 $\\varepsilon=h$ 时，模拟的 SDE 为 $dX_t = (k - \\mu X_t)dt + \\sqrt{k + \\mu X_t + 2h}dW_t$。\n\n**正性强制（标准 i）：** 这个方法不能强制正性。新的扩散项是 $\\sqrt{k + \\mu X_n + 2h}$，它是严格为正的。然而，随机项 $\\sqrt{k + \\mu X_n + 2h}\\sqrt{h}Z_n$ 仍然是一个高斯分布的随机变量，其标准差为 $\\sqrt{h(k + \\mu X_n + 2h)}$。由于高斯分布的支撑集是 $(-\\infty, \\infty)$，总存在非零概率使得 $Z_n$ 的负值足够大，从而导致 $X_{n+1} < 0$。\n\n**1 阶弱收敛（标准 ii）：** 虽然该方案未能满足标准 (i)，我们可以分析其弱阶。该方案模拟了一个受扰动的 SDE。目标 SDE 和模拟的 SDE 之间的差异在于扩散系数。这引入了一个建模误差。全局弱误差是该方案对受扰动 SDE 的离散化误差（为 $\\mathcal{O}(h)$）与目标 SDE 和受扰动 SDE 期望之间的误差之和。扩散系数的扰动是 $\\mathcal{O}(h)$ 阶的，这通常会在期望中引入一个 $\\mathcal{O}(h)$ 阶的偏差。因此，总的弱误差将保持为 $\\mathcal{O}(h)$。然而，未能保证正性使得该方法不适用。\n\n**结论**：**不正确**。该方案不能强制非负性。\n\n### 选项 C\n\n**评估**：该选项提出了一个反射方案：$X_{n+1} = |\\tilde{X}_{n+1}|$，其中 $\\tilde{X}_{n+1}$ 是标准的 Euler-Maruyama 步。\n\n**正性强制（标准 i）：** 使用绝对值函数可以轻易确保 $X_{n+1} \\ge 0$。\n\n**1 阶弱收敛（标准 ii）：** 该方案引入了一个显著的偏差。当 $\\tilde{X}_{n+1} < 0$ 时，方案设置 $X_{n+1} = -\\tilde{X}_{n+1}$。这种行为不代表真实的 SDE 动态。SDE 有一个漂移系数 $f(x) = k - \\mu x$，所以在边界 $x=0$ 处，漂移为 $f(0) = k > 0$。这个正漂移应该将过程推离边界。反射方案相对于提议的负状态产生了一个大小为 $2|\\tilde{X}_{n+1}|$ 的跳跃，这是对动力学的一个强烈的、人为的修改。在数值 SDE 文献中，这是一个公认的结果，即这种反射方案引入的偏差会将弱收敛阶从 1 降低到 0.5。声称它“在分布上保持了增量的高斯性”是错误的；由于反射，$X_{n+1} - X_n$ 的分布显然是非高斯的。\n\n**结论**：**不正确**。此方案不能保持 1 阶弱收敛。\n\n### 选项 D\n\n**评估**：该选项提出了一个对数变换 $Y = \\log(X+\\eta)$，其中 $\\eta > 0$。\n\n**正性强制（标准 i）：** 正性没有被强制。在模拟 $Y_{n+1}$ 后，通过 $X_{n+1} = \\exp(Y_{n+1}) - \\eta$ 恢复状态。由于 $Y_{n+1}$ 可以取任何实数值，$\\exp(Y_{n+1})$ 可以是任何正值。在极限 $Y_{n+1} \\to -\\infty$ 下，我们有 $\\exp(Y_{n+1}) \\to 0$，因此 $X_{n+1} \\to -\\eta$。由于问题陈述 $\\eta > 0$，该方案允许负值，并且只保证 $X_{n+1} > -\\eta$。如果设置 $\\eta=0$（对数-欧拉格式），则可以保证正性 $X_{n+1} > 0$。\n\n**1 阶弱收敛（标准 ii）：** 描述中称对 $Y$ 的模拟是“不加伊藤修正项”的。这是一个致命的缺陷。在 SDE 中进行变量替换时，伊藤引理规定必须在变换后过程的漂移项中加入一个修正项，即 $-\\frac{1}{2}g(x)^2 \\varphi''(x)$。省略这一项等同于应用普通微积分的法则，这对于随机过程是不正确的。这个省略在每一步的漂移近似中引入了一个 $\\mathcal{O}(h)$ 阶的误差，累积起来会导致一个 $\\mathcal{O}(1)$ 的全局误差。该方案不会收敛到正确的解，更不用说具有 1 阶弱收敛性了。\n\n**结论**：**不正确**。该方案未能强制正性，并且基于一个数学上不正确的程序（省略伊藤项）。\n\n### 选项 E\n\n**评估**：该选项建议截断高斯增量 $Z_n$。\n\n**正性强制（标准 i）：** 该方案通过构造来强制正性。随机数 $Z_n$ 从一个条件分布 $\\mathcal{N}(0,1) | (Z_n \\ge c_n)$ 中采样，其中 $c_n$ 是使数值步恰好为零的值：$c_n = - \\frac{X_n + (k - \\mu X_n)h}{\\sqrt{k + \\mu X_n}\\sqrt{h}}$。\n\n**1 阶弱收敛（标准 ii）：** 这种截断在增量的矩中引入了偏差。一个标准正态变量的均值为 $0$。一个在条件 $Z_n \\ge c_n$ 下采样的下截断标准正态变量 $Z'_n$ 的均值为 $\\mathbb{E}[Z'_n] = \\frac{\\phi(c_n)}{1-\\Phi(c_n)}$，其中 $\\phi$ 和 $\\Phi$ 分别是标准正态分布的 PDF 和 CDF。对于任何有限的 $c_n$，这个均值是非零的。这在数值步的均值中引入了一个偏差。单步的偏差是 $\\mathbb{E}[\\Delta X_n] - (\\text{漂移})h = \\sqrt{k+\\mu X_n}\\sqrt{h} \\mathbb{E}[Z'_n]$。当 $X_n$ 很小（截断最可能发生的区域）时，$c_n$ 可以是 $\\mathcal{O}(\\sqrt{h})$。在这种情况下，$\\mathbb{E}[Z'_n]$ 是 $\\mathcal{O}(1)$，并且步长中引入的偏差是 $\\mathcal{O}(\\sqrt{h})$ 阶的。这种大的局部偏差会传播，并导致全局弱误差最多为 $\\mathcal{O}(\\sqrt{h})$，对应于 0.5 的弱阶。声称这只影响尾部的说法是不正确的；当 $X_n$ 靠近边界时，截断不是一个尾部事件，它显著地改变了增量的分布。\n\n**结论**：**不正确**。此方案不能保持 1 阶弱收敛。\n\n### 结论\n只有选项 A 正确地描述了一种有原则且成熟的方法，该方法既能保证非负性，又能保持 Euler-Maruyama 格式的 1 阶弱收敛。在边界层中结合稀有投影和精确模拟是一种复杂的技术，可以正确处理在有界域上模拟 SDE 的复杂性。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}