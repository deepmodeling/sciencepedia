{
    "hands_on_practices": [
        {
            "introduction": "在合成生物学中，双稳态基因开关是导致细胞群体表型异质性的核心模块。该练习将一个双稳态系统抽象为一个在有效势能景观中运动的粒子，让您能够运用统计物理学中的经典理论来解决生物学问题。通过应用克拉默斯逃逸率理论 (Kramers' escape rate theory)，您将计算由分子噪声驱动的表型转换速率，并最终基于细致平衡原理预测群体在稳态下的表型组分 。",
            "id": "3926597",
            "problem": "一个克隆群体中的合成基因开关在两个稳定表达状态之间表现出表型异质性，这两个状态分别记为状态 $A$ (高表达) 和状态 $B$ (低表达)。用于粗粒化底层基因调控网络的慢变序参量 $x$ 被建模为一个由加性分子噪声驱动的过阻尼一维随机微分方程 (SDE)，\n$$\n\\frac{dx}{dt} \\;=\\; -\\,\\frac{dU(x)}{dx} \\;+\\; \\sqrt{2\\sigma^{2}}\\,\\eta(t),\n$$\n其中 $U(x)$ 是有效势，$\\sigma^{2}$ 是有效噪声强度，$\\eta(t)$ 是均值为零、方差为一的标准高斯白噪声。在小噪声的亚稳态区域，细胞停留在 $U(x)$ 的局域极小值 $x_{A}$ 和 $x_{B}$ 附近，并通过热激活逃逸偶尔越过其间的鞍点 $x^{\\ddagger}$ 发生跃迁。假设存在时间尺度分离，即阱内弛豫相对于阱间转换要快得多。\n\n给定以下从单独的测量或模拟中获得的粗粒化势的特征：\n- 局域极小值处的势阱曲率：$U''(x_{A}) \\equiv \\kappa_{A} = 3.0$ 和 $U''(x_{B}) \\equiv \\kappa_{B} = 2.0$。\n- 鞍点处曲率的绝对值：$\\left|U''(x^{\\ddagger})\\right| \\equiv \\kappa^{\\ddagger} = 1.5$。\n- 从各势阱到鞍点的势垒高度：$\\Delta U_{A} \\equiv U(x^{\\ddagger}) - U(x_{A}) = 4.2$ 和 $\\Delta U_{B} \\equiv U(x^{\\ddagger}) - U(x_{B}) = 3.8$。\n- 有效噪声强度：$\\sigma^{2} = 0.7$。\n\n假设适用于一维梯度动力学的小噪声 Kramers 逃逸理论成立，并且在稳态下，具有细致平衡的两态马尔可夫近似有效。以这些假设为基础，计算处于状态 $A$ 的细胞的稳态比例（以 $[0,1]$ 范围内的无量纲小数表示）。将您的答案四舍五入至四位有效数字。",
            "solution": "该问题是有效的。它展示了统计物理学和系统生物学中的一个标准情景，该情景具有科学依据、提法明确且客观。所有必要的参数都已提供，可以使用既有理论求解稳态群体比例。\n\n该系统被描述为一个两态马尔可夫过程，其状态记为 $A$ 和 $B$，对应于势 $U(x)$ 的局域极小值。设 $P_A$ 和 $P_B$ 分别为细胞群体处于状态 $A$ 和状态 $B$ 的稳态比例。根据定义，这些比例的总和必须为 1：\n$$\nP_A + P_B = 1\n$$\n在稳态下，细致平衡原理要求从状态 $A$ 到状态 $B$ 的细胞流等于从状态 $B$ 到状态 $A$ 的细胞流。这表示为：\n$$\nP_A \\, k_{A \\to B} = P_B \\, k_{B \\to A}\n$$\n其中 $k_{A \\to B}$ 是从状态 $A$ 到状态 $B$ 的跃迁速率，$k_{B \\to A}$ 是从状态 $B$ 到状态 $A$ 的跃迁速率。根据细致平衡条件，我们可以用跃迁速率来表示稳态布居数的比值：\n$$\n\\frac{P_A}{P_B} = \\frac{k_{B \\to A}}{k_{A \\to B}}\n$$\n问题指明，适用于一维梯度动力学的小噪声 Kramers 逃逸理论成立。对于给定的 SDE $\\frac{dx}{dt} = -U'(x) + \\sqrt{2\\sigma^2}\\eta(t)$，从一个势阱（例如，在 $x_i$ 处）越过一个势垒（在 $x^{\\ddagger}$ 处）的 Kramers 逃逸速率由以下公式给出：\n$$\nk_{i \\to j} = \\frac{\\sqrt{U''(x_i) |U''(x^{\\ddagger})|}}{2\\pi} \\exp\\left(-\\frac{\\Delta U_i}{\\sigma^2}\\right)\n$$\n此处，$U''(x_i)$ 是势在极小值点 $x_i$ 处的曲率，$|U''(x^{\\ddagger})|$ 是在鞍点 $x^{\\ddagger}$ 处曲率的绝对值，$\\Delta U_i = U(x^{\\ddagger}) - U(x_i)$ 是从势阱 $i$ 开始的势垒高度。\n\n使用问题陈述中提供的记号（$U''(x_A) = \\kappa_A$，$U''(x_B) = \\kappa_B$，$|U''(x^{\\ddagger})| = \\kappa^{\\ddagger}$），我们可以写出我们系统的具体跃迁速率：\n从状态 $A$ 到状态 $B$ 的速率为：\n$$\nk_{A \\to B} = \\frac{\\sqrt{\\kappa_A \\kappa^{\\ddagger}}}{2\\pi} \\exp\\left(-\\frac{\\Delta U_A}{\\sigma^2}\\right)\n$$\n从状态 $B$ 到状态 $A$ 的速率为：\n$$\nk_{B \\to A} = \\frac{\\sqrt{\\kappa_B \\kappa^{\\ddagger}}}{2\\pi} \\exp\\left(-\\frac{\\Delta U_B}{\\sigma^2}\\right)\n$$\n现在，我们计算这些速率的比值：\n$$\n\\frac{k_{B \\to A}}{k_{A \\to B}} = \\frac{\\frac{\\sqrt{\\kappa_B \\kappa^{\\ddagger}}}{2\\pi} \\exp\\left(-\\frac{\\Delta U_B}{\\sigma^2}\\right)}{\\frac{\\sqrt{\\kappa_A \\kappa^{\\ddagger}}}{2\\pi} \\exp\\left(-\\frac{\\Delta U_A}{\\sigma^2}\\right)}\n$$\n指前因子 $\\frac{\\sqrt{\\kappa^{\\ddagger}}}{2\\pi}$ 相互抵消，剩下：\n$$\n\\frac{k_{B \\to A}}{k_{A \\to B}} = \\sqrt{\\frac{\\kappa_B}{\\kappa_A}} \\exp\\left(-\\frac{\\Delta U_B}{\\sigma^2} + \\frac{\\Delta U_A}{\\sigma^2}\\right) = \\sqrt{\\frac{\\kappa_B}{\\kappa_A}} \\exp\\left(\\frac{\\Delta U_A - \\Delta U_B}{\\sigma^2}\\right)\n$$\n因此，稳态布居数的比值为：\n$$\n\\frac{P_A}{P_B} = \\sqrt{\\frac{\\kappa_B}{\\kappa_A}} \\exp\\left(\\frac{\\Delta U_A - \\Delta U_B}{\\sigma^2}\\right)\n$$\n我们已知以下数值：$\\kappa_A = 3.0$，$\\kappa_B = 2.0$，$\\Delta U_A = 4.2$，$\\Delta U_B = 3.8$ 以及 $\\sigma^2 = 0.7$。将这些值代入表达式中：\n$$\n\\frac{P_A}{P_B} = \\sqrt{\\frac{2.0}{3.0}} \\exp\\left(\\frac{4.2 - 3.8}{0.7}\\right) = \\sqrt{\\frac{2}{3}} \\exp\\left(\\frac{0.4}{0.7}\\right) = \\sqrt{\\frac{2}{3}} \\exp\\left(\\frac{4}{7}\\right)\n$$\n让我们将比值 $\\frac{P_A}{P_B}$ 记为 $R$。为了求出比例 $P_A$，我们使用归一化条件 $P_A + P_B = 1$。由于 $P_B = P_A / R$，我们有：\n$$\nP_A + \\frac{P_A}{R} = 1 \\implies P_A \\left(1 + \\frac{1}{R}\\right) = 1 \\implies P_A \\left(\\frac{R+1}{R}\\right) = 1\n$$\n解出 $P_A$ 可得：\n$$\nP_A = \\frac{R}{R+1}\n$$\n现在，我们计算 $R$ 的数值：\n$$\nR = \\sqrt{\\frac{2}{3}} \\exp\\left(\\frac{4}{7}\\right) \\approx 0.81649658 \\times \\exp(0.57142857) \\approx 0.81649658 \\times 1.77085002 \\approx 1.4460535\n$$\n最后，我们计算 $P_A$：\n$$\nP_A = \\frac{1.4460535}{1 + 1.4460535} = \\frac{1.4460535}{2.4460535} \\approx 0.5911798\n$$\n按照要求将结果四舍五入到四位有效数字，我们得到 $P_A \\approx 0.5912$。这就是处于状态 $A$ 的细胞的稳态比例。",
            "answer": "$$\n\\boxed{0.5912}\n$$"
        },
        {
            "introduction": "要理解表型异质性对群体适应度的影响，关键在于建立从单细胞行为到群体动态的数学桥梁。本练习将引导您构建一个描述两种表型（生、死、转换）的连续时间分支过程模型，并推导出其平均场动力学矩阵。您将学习如何通过计算该矩阵的主特征值（或李雅普诺夫指数）来确定群体的长期增长率，即适应度 。这个方法是分析恒定及周期性变化环境下种群演化的基础。",
            "id": "3926558",
            "problem": "考虑一个双表型种群，表型记为 $A$ 和 $B$。该种群被建模为一个具有人均出生、死亡和随机表型转换的连续时间分支过程。设 $b_A$ 和 $b_B$ 分别表示人均出生率（单位：$\\mathrm{s}^{-1}$），$d_A$ 和 $d_B$ 表示人均死亡率（单位：$\\mathrm{s}^{-1}$），$s_{AB}$ 和 $s_{BA}$ 分别表示从表型 $A$ 转换到表型 $B$ 以及从表型 $B$ 转换到表型 $A$ 的人均转换率（单位：$\\mathrm{s}^{-1}$）。设种群大小的期望向量为 $N(t) = \\begin{bmatrix} \\mathbb{E}[n_A(t)] \\\\ \\mathbb{E}[n_B(t)] \\end{bmatrix}$。从分支过程和常微分方程（ODE）的标准线性期望动态出发，构建完整的生死转换算子 $M$，使得 $\\dfrac{d}{dt} N(t) = M N(t)$。然后，在以下两种情况下，推导主李雅普诺夫指数 $\\lambda^\\star$ 的表达式，该指数决定了长期平均种群增长：\n1. 恒定环境：$M$ 是时齐的，不随时间变化。\n2. 周期性环境：$M(t)$ 在两个时齐算子 $M_1$ 和 $M_2$ 之间交替，持续时间分别为 $\\tau_1$ 和 $\\tau_2$（单位：秒），并无限重复。\n\n仅使用基于分支过程中期望的线性性质、常系数系统的线性常微分方程解以及矩阵的谱性质的原理性推理。避免使用任何未从这些基础推导出的快捷公式。\n\n对于恒定环境，所需的输出量是实数 $\\lambda^\\star$（单位：$\\mathrm{s}^{-1}$），定义为 $M$ 的特征值中最大的实部。对于周期为 $T = \\tau_1 + \\tau_2$ 的周期性环境，所需的输出量是 $\\lambda^\\star = \\dfrac{1}{T} \\log \\rho(P)$，其中 $P = \\exp(M_2 \\tau_2) \\exp(M_1 \\tau_1)$ 是单周期演化算子，$\\rho(P)$ 是 $P$ 的谱半径。\n\n编写一个程序，为下面的测试套件中的每个参数集构建 $M$（以及适用的 $M_1$、$M_2$），按规定计算 $\\lambda^\\star$，并输出结果。将每个 $\\lambda^\\star$ 以 $\\mathrm{s}^{-1}$ 为单位表示为四舍五入到六位小数的小数。\n\n测试套件：\n- 情况 $1$（一般恒定环境）：\n  - $b_A = 1.2$, $d_A = 0.3$, $b_B = 0.6$, $d_B = 0.7$, $s_{AB} = 0.15$, $s_{BA} = 0.05$。\n- 情况 $2$（边界情况：无转换）：\n  - $b_A = 0.8$, $d_A = 0.1$, $b_B = 1.0$, $d_B = 1.2$, $s_{AB} = 0$, $s_{BA} = 0$。\n- 情况 $3$（边缘情况：对称净增长和对称转换）：\n  - $b_A = 0.8$, $d_A = 0.5$, $b_B = 0.75$, $d_B = 0.45$, $s_{AB} = 0.2$, $s_{BA} = 0.2$。\n- 情况 $4$（在 $M_1$ 和 $M_2$ 之间交替的周期性环境）：\n  - 环境 $1$：$b_A^{(1)} = 1.2$, $d_A^{(1)} = 0.3$, $b_B^{(1)} = 0.5$, $d_B^{(1)} = 0.7$, $s_{AB}^{(1)} = 0.12$, $s_{BA}^{(1)} = 0.04$，持续时间 $\\tau_1 = 2.5$。\n  - 环境 $2$：$b_A^{(2)} = 0.7$, $d_A^{(2)} = 0.9$, $b_B^{(2)} = 1.4$, $d_B^{(2)} = 0.5$, $s_{AB}^{(2)} = 0.06$, $s_{BA}^{(2)} = 0.18$，持续时间 $\\tau_2 = 1.5$。\n\n定义和所需构造：\n- 根据 $b_A$、$d_A$、$b_B$、$d_B$、$s_{AB}$、$s_{BA}$ 构造一个 $2 \\times 2$ 的矩阵算子 $M$。\n- 对于周期性环境，以相同形式构造 $M_1$ 和 $M_2$，计算 $P = \\exp(M_2 \\tau_2) \\exp(M_1 \\tau_1)$，然后计算 $\\lambda^\\star$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 $[result_1,result_2,result_3,result_4]$），其中每个 $result_i$ 是为情况 $i$ 计算的 $\\lambda^\\star$，单位为 $\\mathrm{s}^{-1}$，四舍五入到六位小数。不应打印任何其他输出。",
            "solution": "我们利用分支过程期望的线性性质，从生死转换的描述中推导出线性算子。设 $\\mathbb{E}[n_A(t)]$ 和 $\\mathbb{E}[n_B(t)]$ 分别表示在时间 $t$ 时表型 $A$ 和 $B$ 的细胞的期望数量。一个表型为 $A$ 的细胞以速率 $b_A$ 出生，以速率 $d_A$ 死亡，并以速率 $s_{AB}$ 转换为表型 $B$。一个表型为 $B$ 的细胞以速率 $b_B$ 出生，以速率 $d_B$ 死亡，并以速率 $s_{BA}$ 转换为表型 $A$。在期望上，对 $\\mathbb{E}[n_A(t)]$ 变化率的贡献是净增长率 $(b_A - d_A)$ 乘以 $\\mathbb{E}[n_A(t)]$，减去因转换流出的 $s_{AB} \\mathbb{E}[n_A(t)]$，加上从 $B$ 转换到 $A$ 流入的 $s_{BA} \\mathbb{E}[n_B(t)]$。因此，\n$$\n\\frac{d}{dt} \\mathbb{E}[n_A(t)] = \\left(b_A - d_A - s_{AB}\\right) \\mathbb{E}[n_A(t)] + s_{BA} \\mathbb{E}[n_B(t)].\n$$\n类似地，对于表型 $B$：\n$$\n\\frac{d}{dt} \\mathbb{E}[n_B(t)] = s_{AB} \\mathbb{E}[n_A(t)] + \\left(b_B - d_B - s_{BA}\\right) \\mathbb{E}[n_B(t)].\n$$\n定义期望向量 $N(t) = \\begin{bmatrix} \\mathbb{E}[n_A(t)] \\\\ \\mathbb{E}[n_B(t)] \\end{bmatrix}$ 和算子\n$$\nM = \\begin{bmatrix}\nb_A - d_A - s_{AB} & s_{BA} \\\\\ns_{AB} & b_B - d_B - s_{BA}\n\\end{bmatrix}.\n$$\n该动态可以写成线性常微分方程（ODE）\n$$\n\\frac{d}{dt} N(t) = M N(t).\n$$\n对于恒定环境，$M$ 是时齐的。解由矩阵指数给出：\n$$\nN(t) = \\exp(M t) N(0).\n$$\n根据线性算子的谱理论，$N(t)$ 的长期增长由 $M$ 的特征值决定。设 $\\lambda_1, \\lambda_2$ 表示 $M$ 的特征值（可能为复数）。$\\exp(M t)$ 的范数渐近表现为 $\\exp(\\operatorname{Re}(\\lambda_{\\max}) t)$，其中 $\\operatorname{Re}(\\lambda_{\\max})$ 是特征值中最大的实部。因此，恒定环境的主李雅普诺夫指数为\n$$\n\\lambda^\\star = \\max\\left\\{ \\operatorname{Re}(\\lambda_1), \\operatorname{Re}(\\lambda_2) \\right\\}.\n$$\n该量的单位为 $\\mathrm{s}^{-1}$。\n\n对于周期性环境，假设 $M(t)$ 在两个常数算子 $M_1$ 和 $M_2$ 之间交替，持续时间分别为 $\\tau_1$ 和 $\\tau_2$，总周期为 $T = \\tau_1 + \\tau_2$。在一个周期内，状态根据单值矩阵传播\n$$\nP = \\exp(M_2 \\tau_2) \\exp(M_1 \\tau_1),\n$$\n所以在 $k$ 个周期后，\n$$\nN(k T) = P^k N(0).\n$$\n设 $\\mu_1, \\mu_2$ 表示 $P$ 的特征值，并设 $\\rho(P) = \\max\\{ |\\mu_1|, |\\mu_2| \\}$ 表示谱半径。一个周期内的增长是乘以一个因子 $\\rho(P)$，因此单位时间的主李雅普诺夫指数为\n$$\n\\lambda^\\star = \\frac{1}{T} \\log \\rho(P).\n$$\n\n算法实现：\n- 对于每个恒定环境案例，从 $(b_A, d_A, b_B, d_B, s_{AB}, s_{BA})$ 构建 $M$，计算其特征值，并取其实部的最大值作为 $\\lambda^\\star$。\n- 对于周期性环境案例，从各自的参数构建 $M_1$ 和 $M_2$，计算 $\\exp(M_1 \\tau_1)$ 和 $\\exp(M_2 \\tau_2)$，形成 $P = \\exp(M_2 \\tau_2)\\exp(M_1 \\tau_1)$，计算 $P$ 的特征值，取谱半径 $\\rho(P)$，然后计算 $\\lambda^\\star = \\dfrac{1}{\\tau_1 + \\tau_2} \\log \\rho(P)$。\n\n合理性检查和边缘情况：\n- 当 $s_{AB} = s_{BA} = 0$ 时，$M$ 是对角矩阵，对角线元素为 $(b_A - d_A)$ 和 $(b_B - d_B)$，因此 $\\lambda^\\star = \\max\\{ b_A - d_A, b_B - d_B \\}$。\n- 对于对称转换和相等的净增长率 $b_A - d_A = b_B - d_B = r$，如果 $s_{AB} = s_{BA} = s$，则算子形式为 $M = \\begin{bmatrix} r - s & s \\\\ s & r - s \\end{bmatrix}$，其特征值为 $r$ 和 $r - 2s$。因此 $\\lambda^\\star = r$，这表明当两种表型具有相等的净增长率时，对称转换不会改变主导增长率。\n\n程序为所提供的测试套件计算四个请求的 $\\lambda^\\star$ 值，并以 $[x_1,x_2,x_3,x_4]$ 的格式单行打印它们，每个值都四舍五入到六位小数，单位 $\\mathrm{s}^{-1}$ 从模型参数单位中可以隐含地理解。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm, eigvals\n\ndef operator_matrix(bA, dA, bB, dB, sAB, sBA):\n    \"\"\"\n    Construct the 2x2 birth-death-switchover operator matrix M.\n    M = [[bA - dA - sAB, sBA],\n         [sAB,           bB - dB - sBA]]\n    \"\"\"\n    return np.array([[bA - dA - sAB, sBA],\n                     [sAB,           bB - dB - sBA]], dtype=float)\n\ndef leading_exponent_constant(M):\n    \"\"\"\n    Compute the leading Lyapunov exponent (largest real part of eigenvalues) for constant M.\n    \"\"\"\n    vals = eigvals(M)\n    # Largest real part\n    return float(np.max(np.real(vals)))\n\ndef leading_exponent_periodic(M1, tau1, M2, tau2):\n    \"\"\"\n    Compute the leading Lyapunov exponent for a periodic environment alternating M1 (duration tau1)\n    and M2 (duration tau2). One-cycle propagator P = exp(M2*tau2) @ exp(M1*tau1).\n    Lyapunov exponent lambda* = (1/(tau1+tau2)) * log(spectral_radius(P)).\n    \"\"\"\n    P = expm(M2 * tau2) @ expm(M1 * tau1)\n    # Spectral radius: max absolute value of eigenvalues\n    evals = eigvals(P)\n    rho = np.max(np.abs(evals))\n    # Guard against numerical issues: rho must be positive real\n    return float(np.log(rho) / (tau1 + tau2))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: general constant environment\n        {\n            \"type\": \"constant\",\n            \"params\": {\n                \"bA\": 1.2, \"dA\": 0.3, \"bB\": 0.6, \"dB\": 0.7, \"sAB\": 0.15, \"sBA\": 0.05\n            }\n        },\n        # Case 2: boundary case (no switching)\n        {\n            \"type\": \"constant\",\n            \"params\": {\n                \"bA\": 0.8, \"dA\": 0.1, \"bB\": 1.0, \"dB\": 1.2, \"sAB\": 0.0, \"sBA\": 0.0\n            }\n        },\n        # Case 3: symmetric net growth and symmetric switching\n        {\n            \"type\": \"constant\",\n            \"params\": {\n                \"bA\": 0.8, \"dA\": 0.5, \"bB\": 0.75, \"dB\": 0.45, \"sAB\": 0.2, \"sBA\": 0.2\n            }\n        },\n        # Case 4: periodic environment alternating between M1 and M2\n        {\n            \"type\": \"periodic\",\n            \"params\": {\n                # Environment 1\n                \"bA1\": 1.2, \"dA1\": 0.3, \"bB1\": 0.5, \"dB1\": 0.7, \"sAB1\": 0.12, \"sBA1\": 0.04, \"tau1\": 2.5,\n                # Environment 2\n                \"bA2\": 0.7, \"dA2\": 0.9, \"bB2\": 1.4, \"dB2\": 0.5, \"sAB2\": 0.06, \"sBA2\": 0.18, \"tau2\": 1.5\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        ctype = case[\"type\"]\n        p = case[\"params\"]\n        if ctype == \"constant\":\n            M = operator_matrix(p[\"bA\"], p[\"dA\"], p[\"bB\"], p[\"dB\"], p[\"sAB\"], p[\"sBA\"])\n            lam = leading_exponent_constant(M)\n            results.append(lam)\n        elif ctype == \"periodic\":\n            M1 = operator_matrix(p[\"bA1\"], p[\"dA1\"], p[\"bB1\"], p[\"dB1\"], p[\"sAB1\"], p[\"sBA1\"])\n            M2 = operator_matrix(p[\"bA2\"], p[\"dA2\"], p[\"bB2\"], p[\"dB2\"], p[\"sAB2\"], p[\"sBA2\"])\n            lam = leading_exponent_periodic(M1, p[\"tau1\"], M2, p[\"tau2\"])\n            results.append(lam)\n        else:\n            # Should not occur given the test suite; default to NaN\n            results.append(float(\"nan\"))\n\n    # Round to six decimal places and format as required.\n    formatted = [f\"{x:.6f}\" for x in results]\n    print(f\"[{','.join(formatted)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在多变的环境中，细胞通过“赌博”策略（bet-hedging）——即主动维持表型多样性——来提高其长期生存几率。本练习将带领您探索一个核心问题：当环境的持续时间不服从简单的指数分布（马尔可夫过程），而是呈现出具有“记忆”的非马尔可夫特性（如幂律分布）时，最优的赌博策略是什么。您需要将一个复杂的理论模型转化为可执行的计算程序，通过优化来寻找最大化长期增长率的表型转换策略 。这项练习强调了环境波动的精细统计特性对生物策略演化的深刻影响。",
            "id": "3926594",
            "problem": "要求您构建并分析一个数学上明确的反例，其中环境切换是非马尔可夫的，其停留时间呈幂律分布。并将最优赌注对冲策略与停留时间呈指数分布的马尔可夫情况进行比较。考虑一个具有两种表型和两个交替环境的合成种群。该模型必须从第一性原理出发进行建模，并实现为一个完整的、可运行的程序，用于计算两种情况下的最优策略。\n\n基本框架如下。种群由两种表型（索引为 $i \\in \\{1,2\\}$）和两种环境（索引为 $e \\in \\{1,2\\}$）组成。每个环境 $e$ 持续一个随机的停留时间 $L_e$，在此期间，各表型的人均瞬时指数增长率是恒定的，由 $\\mu_{i,e}$ 给出，其单位是时间的倒数。环境按确定性顺序交替，其停留时间是独立抽取的，形成一个更新过程。在环境切换的瞬间，表型比例不会瞬时改变，而是通过表型切换动态过程，向特定于环境的目标比例松弛。\n\n将在给定环境时期内，时间 $t$ 时表型1的比例定义为 $f(t)$。表型切换由一个常微分方程（ODE）建模，该过程由一个恒定的适应速率 $\\sigma > 0$ 和一个特定于环境的目标比例 $s_e \\in [0,1]$ 驱动：\n$$\n\\frac{df}{dt} = \\sigma\\left(s_e - f(t)\\right).\n$$\n在一个环境 $e$ 的时期开始时，初始条件 $f(0)$ 等于前一个时期的最终比例，因为环境切换不会瞬时重新配置表型。在一个持续时间为 $L_e$ 的时期内的解是\n$$\nf(t) = s_e + \\left(f(0) - s_e\\right)e^{-\\sigma t}, \\quad t \\in [0,L_e].\n$$\n环境 $e$ 中总种群的瞬时单位时间对数增长率是特定表型速率的加权平均，这与每个小时间间隔内单细胞水平上的快速重新随机化一致：\n$$\ng_e\\left(f(t)\\right) = f(t)\\,\\mu_{1,e} + \\left(1 - f(t)\\right)\\mu_{2,e}.\n$$\n一个长度为 $L_e$ 的时期对累积对数种群规模的积分贡献是\n$$\n\\int_{0}^{L_e} g_e\\left(f(t)\\right)\\,dt = \\mu_{2,e}L_e + \\left(\\mu_{1,e} - \\mu_{2,e}\\right)\\int_{0}^{L_e} f(t)\\,dt,\n$$\n其中\n$$\n\\int_{0}^{L_e} f(t)\\,dt = s_e L_e + \\left(f(0) - s_e\\right)\\frac{1 - e^{-\\sigma L_e}}{\\sigma}.\n$$\n在许多交替时期之后，于稳态条件下，长期平均单位时间对数增长率是每个周期的期望积分对数增长除以期望周期长度。由于 $f(0)$ 通过线性松弛依赖于前一个时期，其稳态期望可以使用更新理论和线性性质来计算。令 $a_e = \\mathbb{E}\\left[e^{-\\sigma L_e}\\right]$ 且 $m_e = \\mathbb{E}\\left[L_e\\right]$。记 $X = \\mathbb{E}\\left[f(0)\\mid \\text{环境 }1\\text{ 开始时}\\right]$ 和 $Y = \\mathbb{E}\\left[f(0)\\mid \\text{环境 }2\\text{ 开始时}\\right]$。在交替条件下，它们满足以下线性系统\n$$\nY = s_1 + (X - s_1)a_1, \\quad X = s_2 + (Y - s_2)a_2.\n$$\n求解得到\n$$\nX = \\frac{s_2(1 - a_2) + s_1 a_2(1 - a_1)}{1 - a_1 a_2}, \\quad Y = s_1 + (X - s_1)a_1.\n$$\n在环境 $e$ 的一个时期内的期望积分比例变为\n$$\n\\mathbb{E}\\left[\\int_{0}^{L_e} f(t)\\,dt\\right] = s_e m_e + \\left(\\mathbb{E}[f(0)] - s_e\\right)\\frac{1 - a_e}{\\sigma},\n$$\n并且长期平均单位时间对数增长率是\n$$\n\\Gamma(s_1,s_2) = \\frac{\\sum_{e=1}^{2}\\left(\\mu_{2,e} m_e + \\left(\\mu_{1,e} - \\mu_{2,e}\\right)\\left[s_e m_e + \\left(\\mathbb{E}[f(0)]_e - s_e\\right)\\frac{1 - a_e}{\\sigma}\\right]\\right)}{m_1 + m_2}.\n$$\n\n您必须实现两种相对比的环境停留时间模型：\n- 指数（马尔可夫）情况：$L_e \\sim \\text{Exponential}(\\lambda_e)$，其中 $m_e = 1/\\lambda_e$ 且 $a_e = \\lambda_e/(\\lambda_e + \\sigma)$。\n- 幂律（非马尔可夫）情况：$L_e \\sim \\text{Pareto}(L_{\\min,e}, \\alpha_e)$，其概率密度函数为 $p(l) = \\alpha_e L_{\\min,e}^{\\alpha_e} l^{-(\\alpha_e + 1)}$（对于 $l \\ge L_{\\min,e}$），均值为 $m_e = \\alpha_e L_{\\min,e}/(\\alpha_e - 1)$（对于 $\\alpha_e > 1$），并且\n$$\na_e = \\mathbb{E}\\left[e^{-\\sigma L_e}\\right] = \\int_{L_{\\min,e}}^{\\infty} e^{-\\sigma l}\\,\\alpha_e L_{\\min,e}^{\\alpha_e} l^{-(\\alpha_e + 1)}\\,dl,\n$$\n该值必须通过数值计算得出。\n\n赌注对冲策略由依赖于环境的目标比例 $s_1 \\in [0,1]$ 和 $s_2 \\in [0,1]$ 组成。对于每种停留时间模型，您的程序必须在 $(s_1,s_2)$ 的离散化网格上搜索，以找到使 $\\Gamma(s_1,s_2)$ 最大化的配对。\n\n时间以任意一致的时间单位计量；所有输出均报告为无量纲的实数。\n\n测试套件和输出规范：\n- 使用以下三个测试用例，每个用例都指定了表型增长率、平均停留时间、适应速率和非马尔可夫参数。对于每个用例，计算指数和幂律停留时间模型的最优值，这两种模型被校准以具有相同的平均停留时间 $m_1$ 和 $m_2$：\n    1. 用例1（一般情景）：$\\mu_{1,1} = 0.8$，$\\mu_{2,1} = 0.1$，$\\mu_{1,2} = 0.1$，$\\mu_{2,2} = 0.8$，$m_1 = 5$，$m_2 = 5$，$\\sigma = 0.5$，幂律参数 $\\alpha_1 = \\alpha_2 = 1.25$，$L_{\\min,1} = L_{\\min,2} = m_e(\\alpha_e - 1)/\\alpha_e$。\n    2. 用例2（慢适应，边界条件）：$\\mu_{1,1} = 0.8$，$\\mu_{2,1} = 0.1$，$\\mu_{1,2} = 0.1$，$\\mu_{2,2} = 0.8$，$m_1 = 5$，$m_2 = 5$，$\\sigma = 0.05$，幂律参数 $\\alpha_1 = \\alpha_2 = 1.25$，$L_{\\min,1} = L_{\\min,2} = m_e(\\alpha_e - 1)/\\alpha_e$。\n    3. 用例3（弱环境对比，边缘情况）：$\\mu_{1,1} = 0.5$，$\\mu_{2,1} = 0.3$，$\\mu_{1,2} = 0.3$，$\\mu_{2,2} = 0.5$，$m_1 = 5$，$m_2 = 5$，$\\sigma = 0.5$，幂律参数 $\\alpha_1 = \\alpha_2 = 1.25$，$L_{\\min,1} = L_{\\min,2} = m_e(\\alpha_e - 1)/\\alpha_e$。\n\n您的程序必须：\n- 对于每个测试用例，计算并返回一个包含六个数字的列表：指数模型的最优平均单位时间对数增长率，以及相应的最优 $s_1$ 和 $s_2$，然后是幂律模型的最优平均单位时间对数增长率，及其最优 $s_1$ 和 $s_2$。在 $[0,1]$ 上对 $s_1$ 和 $s_2$ 使用步长为 $0.01$ 的均匀网格搜索。\n- 精确地生成一行输出，其中包含三个用例各自的列表，形式为用方括号括起来的逗号分隔列表。例如，一个有效的格式是\n$$\n[\\,[g_{\\text{exp},1},s_{1,\\text{exp},1},s_{2,\\text{exp},1},g_{\\text{pow},1},s_{1,\\text{pow},1},s_{2,\\text{pow},1}],\\,[g_{\\text{exp},2},\\dots],\\,[g_{\\text{exp},3},\\dots]\\,].\n$$\n所有报告的数值都必须是实数（浮点数）。此单行输出是唯一的程序输出。",
            "solution": "该问题提出了一个理论生物学中有效且适定的问题，具体涉及波动环境中的最优赌注对冲策略。它要求构建和分析一个模型，以比较马尔可夫（指数）与非马尔可夫（幂律）环境切换对种群长期适应度的影响。所有必需的参数和方程均已提供，其基础科学原理是可靠的，且该问题在计算上是可行的。\n\n该模型考虑一个由两种表型（索引为 $i \\in \\{1, 2\\}$）组成的种群，存在于两种环境（$e \\in \\{1, 2\\}$）之一。环境确定性地交替。在环境 $e$ 中，每个表型 $i$ 具有恒定的人均瞬时指数增长率 $\\mu_{i,e}$。环境 $e$ 中一个时期的持续时间是一个随机变量 $L_e$。\n\n在时间 $t$ 表型1的比例记为 $f(t)$。表型切换动态由一个线性常微分方程（ODE）控制，该方程描述了以恒定速率 $\\sigma > 0$ 向一个特定于环境的目标比例 $s_e \\in [0, 1]$ 松弛的过程：\n$$\n\\frac{df}{dt} = \\sigma\\left(s_e - f(t)\\right)\n$$\n给定在环境 $e$ 中一个持续时间为 $L_e$ 的时期开始时的初始比例 $f(0)$，该 ODE 的解为：\n$$\nf(t) = s_e + \\left(f(0) - s_e\\right)e^{-\\sigma t}, \\quad \\text{for } t \\in [0, L_e]\n$$\n总种群的瞬时对数增长率 $g_e(f(t))$ 是各个表型增长率的加权平均值：\n$$\ng_e\\left(f(t)\\right) = f(t)\\,\\mu_{1,e} + \\left(1 - f(t)\\right)\\mu_{2,e}\n$$\n在环境 $e$ 的一个时期内累积的总对数增长是 $g_e(f(t))$ 在持续时间 $L_e$ 上的积分。通过对 $f(t)$ 积分，我们发现积分贡献为：\n$$\n\\int_{0}^{L_e} g_e\\left(f(t)\\right)\\,dt = \\mu_{2,e}L_e + \\left(\\mu_{1,e} - \\mu_{2,e}\\right)\\int_{0}^{L_e} f(t)\\,dt\n$$\n其中积分比例为：\n$$\n\\int_{0}^{L_e} f(t)\\,dt = s_e L_e + \\left(f(0) - s_e\\right)\\frac{1 - e^{-\\sigma L_e}}{\\sigma}\n$$\n主要目标是最大化长期平均单位时间对数增长率 $\\Gamma$，即每个环境周期的期望总对数增长除以期望周期长度。一个周期由环境1中的一个时期和紧随其后的环境2中的一个时期组成。为计算此值，我们首先建立初始表型比例的稳態期望。令 $X = \\mathbb{E}\\left[f(0)\\mid \\text{环境 }1\\text{ 开始时}\\right]$ 和 $Y = \\mathbb{E}\\left[f(0)\\mid \\text{环境 }2\\text{ 开始时}\\right]$。在稳态下，一个时期结束时的期望比例是下一个时期的期望初始比例。这导出了一个线性方程组，其中 $a_e = \\mathbb{E}\\left[e^{-\\sigma L_e}\\right]$：\n$$\nY = s_1 + (X - s_1)a_1\n$$\n$$\nX = s_2 + (Y - s_2)a_2\n$$\n求解 $X$ 和 $Y$ 得到：\n$$\nX = \\frac{s_2(1 - a_2) + s_1 a_2(1 - a_1)}{1 - a_1 a_2}, \\quad Y = s_1 + (X - s_1)a_1\n$$\n在环境 $e$ 的一个时期内（例如，$e=1$，初始比例为 $X$）的期望积分比例是：\n$$\n\\mathbb{E}\\left[\\int_{0}^{L_1} f(t)\\,dt\\right] = s_1 \\mathbb{E}[L_1] + \\left(X - s_1\\right)\\mathbb{E}\\left[\\frac{1 - e^{-\\sigma L_1}}{\\sigma}\\right] = s_1 m_1 + \\left(X - s_1\\right)\\frac{1 - a_1}{\\sigma}\n$$\n其中 $m_e = \\mathbb{E}[L_e]$。一个类似的表达式对环境2也成立。将两个环境的期望贡献相加，再除以期望周期时间 $m_1 + m_2$，便得到长期增长率 $\\Gamma(s_1,s_2)$：\n$$\n\\Gamma(s_1,s_2) = \\frac{\\sum_{e=1}^{2}\\left(\\mu_{2,e} m_e + \\left(\\mu_{1,e} - \\mu_{2,e}\\right)\\left[s_e m_e + \\left(\\mathbb{E}[f(0)]_e - s_e\\right)\\frac{1 - a_e}{\\sigma}\\right]\\right)}{m_1 + m_2}\n$$\n此处，$\\mathbb{E}[f(0)]_1 = X$ 且 $\\mathbb{E}[f(0)]_2 = Y$。\n\n该分析比较了停留时间分布 $L_e$ 的两种模型，两者都经过校准以具有相同的均值 $m_e$：\n1.  **指数（马尔可夫）情况**：停留时间服从指数分布，$L_e \\sim \\text{Exponential}(\\lambda_e)$。均值为 $m_e = 1/\\lambda_e$。项 $a_e$ 可以解析计算：\n    $$\n    a_e = \\mathbb{E}\\left[e^{-\\sigma L_e}\\right] = \\int_{0}^{\\infty} e^{-\\sigma l} \\lambda_e e^{-\\lambda_e l} dl = \\frac{\\lambda_e}{\\lambda_e + \\sigma}\n    $$\n2.  **幂律（非马尔可夫）情况**：停留时间服从帕累托（Pareto）分布，$L_e \\sim \\text{Pareto}(L_{\\min,e}, \\alpha_e)$，其概率密度函数为 $p(l) = \\alpha_e L_{\\min,e}^{\\alpha_e} l^{-(\\alpha_e + 1)}$（对于 $l \\ge L_{\\min,e}$）。均值为 $m_e = \\frac{\\alpha_e L_{\\min,e}}{\\alpha_e - 1}$（对于 $\\alpha_e > 1$）。参数 $L_{\\min,e}$ 被设置为 $m_e(\\alpha_e - 1)/\\alpha_e$ 以匹配均值 $m_e$。项 $a_e$ 必须通过数值积分计算：\n    $$\n    a_e = \\mathbb{E}\\left[e^{-\\sigma L_e}\\right] = \\int_{L_{\\min,e}}^{\\infty} e^{-\\sigma l}\\,\\alpha_e L_{\\min,e}^{\\alpha_e} l^{-(\\alpha_e + 1)}\\,dl\n    $$\n\n最优赌注对冲策略由目标比例对 $(s_1, s_2)$ 定义，通过最大化 $\\Gamma(s_1, s_2)$ 来找到。这通过在参数空间 $s_1 \\in [0, 1]$ 和 $s_2 \\in [0, 1]$ 上以 $0.01$ 的精细步长执行网格搜索来实现。对于每个测试用例，都针对指数模型和幂律模型执行此优化。\n\n算法流程如下：\n1.  对于每个测试用例，提取参数 $\\mu_{i,e}$、$m_e$、$\\sigma$ 和 $\\alpha_e$。\n2.  从 $[0,1] \\times [0,1]$ 创建 $(s_1,s_2)$ 值的离散网格。\n3.  对于指数模型，计算 $\\lambda_e=1/m_e$ 和相应的 $a_e$。\n4.  对于幂律模型，计算 $L_{\\min,e}$ 并数值计算 $a_e$。\n5.  对于每个模型，遍历网格上所有的 $(s_1,s_2)$ 对。在每次迭代中：a. 使用各自的 $a_1$ 和 $a_2$ 计算稳态初始比例 $X$ 和 $Y$。b. 计算长期增长率 $\\Gamma(s_1, s_2)$。c. 记录找到的最大 $\\Gamma$ 值和相应的 $(s_1, s_2)$ 对。\n6.  存储当前测试用例下两个模型的最优 $(\\Gamma, s_1, s_2)$。\n7.  处理完所有测试用例后，将结果格式化为指定的字符串表示形式。\n该实现使用 `numpy` 进行高效的数组操作，并使用 `scipy.integrate.quad` 进行幂律情况下所需的数值积分。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Solves the bet-hedging problem for the given test cases.\n    \"\"\"\n    # Test cases defined in the problem statement\n    test_cases = [\n        {\n            \"mu11\": 0.8, \"mu21\": 0.1, \"mu12\": 0.1, \"mu22\": 0.8,\n            \"m1\": 5.0, \"m2\": 5.0, \"sigma\": 0.5,\n            \"alpha1\": 1.25, \"alpha2\": 1.25\n        },\n        {\n            \"mu11\": 0.8, \"mu21\": 0.1, \"mu12\": 0.1, \"mu22\": 0.8,\n            \"m1\": 5.0, \"m2\": 5.0, \"sigma\": 0.05,\n            \"alpha1\": 1.25, \"alpha2\": 1.25\n        },\n        {\n            \"mu11\": 0.5, \"mu21\": 0.3, \"mu12\": 0.3, \"mu22\": 0.5,\n            \"m1\": 5.0, \"m2\": 5.0, \"sigma\": 0.5,\n            \"alpha1\": 1.25, \"alpha2\": 1.25\n        }\n    ]\n\n    all_results = []\n\n    s_grid = np.linspace(0.0, 1.0, 101)\n\n    for case in test_cases:\n        mu11, mu21, mu12, mu22 = case[\"mu11\"], case[\"mu21\"], case[\"mu12\"], case[\"mu22\"]\n        m1, m2 = case[\"m1\"], case[\"m2\"]\n        sigma = case[\"sigma\"]\n        alpha1, alpha2 = case[\"alpha1\"], case[\"alpha2\"]\n\n        # --- Exponential (Markovian) Case ---\n        lambda1 = 1.0 / m1\n        lambda2 = 1.0 / m2\n        a1_exp = lambda1 / (lambda1 + sigma)\n        a2_exp = lambda2 / (lambda2 + sigma)\n        \n        # --- Power-Law (Non-Markovian) Case ---\n        # Integrand for calculating a_e for Pareto distribution\n        def pareto_integrand(l, sig, l_min, alph):\n            return np.exp(-sig * l) * alph * (l_min**alph) * (l**(-(alph + 1)))\n\n        L_min1 = m1 * (alpha1 - 1.0) / alpha1\n        L_min2 = m2 * (alpha2 - 1.0) / alpha2\n        \n        a1_pow, _ = integrate.quad(pareto_integrand, L_min1, np.inf, args=(sigma, L_min1, alpha1))\n        a2_pow, _ = integrate.quad(pareto_integrand, L_min2, np.inf, args=(sigma, L_min2, alpha2))\n        \n        case_results = []\n        \n        for model_params in [(a1_exp, a2_exp), (a1_pow, a2_pow)]:\n            a1, a2 = model_params\n            max_gamma = -np.inf\n            opt_s1, opt_s2 = -1.0, -1.0\n            \n            # Grid search for optimal (s1, s2)\n            for s1 in s_grid:\n                for s2 in s_grid:\n                    # Check for denominator singularity, though problem analysis showed it's > 0\n                    if 1.0 - a1 * a2 == 0:\n                        continue\n                    \n                    # Calculate stationary initial fractions X and Y\n                    X = (s2 * (1.0 - a2) + s1 * a2 * (1.0 - a1)) / (1.0 - a1 * a2)\n                    Y = s1 + (X - s1) * a1\n                    \n                    # Calculate long-run growth rate Gamma\n                    delta_mu1 = mu11 - mu21\n                    delta_mu2 = mu12 - mu22\n                    \n                    term1 = mu21 * m1 + delta_mu1 * (s1 * m1 + (X - s1) * (1.0 - a1) / sigma)\n                    term2 = mu22 * m2 + delta_mu2 * (s2 * m2 + (Y - s2) * (1.0 - a2) / sigma)\n                    \n                    gamma = (term1 + term2) / (m1 + m2)\n                    \n                    if gamma > max_gamma:\n                        max_gamma = gamma\n                        opt_s1, opt_s2 = s1, s2\n            \n            case_results.extend([max_gamma, round(opt_s1, 2), round(opt_s2, 2)])\n        \n        all_results.append(case_results)\n\n    # Format the final output string exactly as specified\n    sub_results = []\n    for r in all_results:\n        sub_results.append(f\"[{','.join(map(str, r))}]\")\n    final_output = f\"[{','.join(sub_results)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}