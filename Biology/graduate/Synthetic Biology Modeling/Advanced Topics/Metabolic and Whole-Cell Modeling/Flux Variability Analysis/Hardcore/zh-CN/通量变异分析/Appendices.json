{
    "hands_on_practices": [
        {
            "introduction": "在计算通量范围之前，理解通量变异性的根本来源至关重要。当代谢网络存在多种实现相同最优目标的途径时，就会出现“替代最优解”，这是通量变异性的基础。这个练习将引导您通过分析推导，在一个包含无效循环的小型网络中，亲手揭示替代最优解的存在，从而从根本上理解为何需要进行通量变异性分析 。",
            "id": "3913850",
            "problem": "考虑一个合成构建体的极简基于约束的代谢模型，该模型包含两种内部代谢物 $X$ 和 $Y$ 以及四个反应：$R_1$（吸收）、$R_5$（生物质形成）、$R_6$（$X \\to Y$）和 $R_7$（$Y \\to X$）。设通量向量为 $v = (v_1, v_5, v_6, v_7)^{\\top}$，其顺序为 $(R_1, R_5, R_6, R_7)$。内部质量平衡通过稳态约束 $S v = 0$ 实现，其中对应于代谢物 $(X, Y)$ 的化学计量矩阵 $S$ 为\n$$\nS \\;=\\; \\begin{pmatrix}\n1  -1  -1  1 \\\\\n0  0  1  -1\n\\end{pmatrix}.\n$$\n所有反应都是不可逆的，并具有以下界限：$0 \\leq v_1 \\leq 10$，$0 \\leq v_5 \\leq 100$，$0 \\leq v_6 \\leq 8$ 和 $0 \\leq v_7 \\leq 8$。目标函数是最大化生物质形成，即最大化 $c^{\\top} v$，其中 $c = (0, 1, 0, 0)^{\\top}$。通量变异性分析 (FVA) 的定义是：在目标值保持在其最大值的约束下，对于可行集上的每个反应 $i$，确定 $v_i$ 的最小值和最大值。\n\n仅从稳态质量平衡 $S v = 0$、线性通量界限和线性目标 $c^{\\top} v$ 的原理出发，不使用任何快捷公式，完成以下任务：\n- 从 $S v = 0$ 推导出 $v_1$、$v_5$、$v_6$ 和 $v_7$ 之间的关系。\n- 解释为什么最优目标值 $z^{*}$ 可以通过多个不同的通量向量（替代最优解）达到，并构建两个明确、不同且可行的通量向量，它们在满足所有约束的同时都能达到相同的最优值 $z^{*}$。\n- 在目标值保持在 $z^{*}$ 的附加约束下，对反应 $R_6$ 进行通量变异性分析 (FVA)，并计算 $v_6$ 的 FVA 区间宽度，该宽度定义为在最优条件下其最大和最小可行值之差。\n\n以 $\\mathrm{mmol}\\ \\mathrm{gDW}^{-1}\\ \\mathrm{h}^{-1}$ 为单位表示您的最终数值答案（区间宽度），其中 $\\mathrm{gDW}$ 表示克干重。如果需要四舍五入，请将您的答案舍入到四位有效数字；如果数值是精确的，则无需进行舍入。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 步骤 1：提取已知条件\n- **代谢物**：两种内部代谢物，$X$ 和 $Y$。\n- **反应**：四个反应，$R_1$（吸收）、$R_5$（生物质形成）、$R_6$（$X \\to Y$）和 $R_7$（$Y \\to X$）。\n- **通量向量**：$v = (v_1, v_5, v_6, v_7)^{\\top}$，对应于反应 $(R_1, R_5, R_6, R_7)$。\n- **化学计量矩阵**：对于代谢物 $(X, Y)$ 的化学计量矩阵 $S$ 如下所示\n$$ S = \\begin{pmatrix} 1  -1  -1  1 \\\\ 0  0  1  -1 \\end{pmatrix}. $$\n- **稳态约束**：$S v = 0$。\n- **通量界限**：\n    - $0 \\leq v_1 \\leq 10$\n    - $0 \\leq v_5 \\leq 100$\n    - $0 \\leq v_6 \\leq 8$\n    - $0 \\leq v_7 \\leq 8$\n- **目标函数**：最大化 $z = c^{\\top} v$，其中 $c = (0, 1, 0, 0)^{\\top}$，等同于最大化 $v_5$。\n- **FVA 定义**：在目标值保持在其最大值 $z^*$ 的附加约束下，确定可行集中每个 $v_i$ 的最小值和最大值。\n- **最终输出要求**：$v_6$ 的 FVA 区间宽度，以 $\\mathrm{mmol}\\ \\mathrm{gDW}^{-1}\\ \\mathrm{h}^{-1}$ 为单位表示。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，是基于约束的代谢建模的标准应用，特别是通量平衡分析 (FBA) 和通量变异性分析 (FVA)。其数学公式基于线性规划，这是一个成熟且严谨的框架。该问题是适定的，提供了一个化学计量矩阵、通量界限和一个线性目标函数，这些共同定义了一个有界可行空间，从而保证了解的存在性。该问题是客观的，并使用精确的数学语言。没有科学或事实上的不健全之处，设置中没有矛盾，也没有未定义的术语。虽然问题陈述为最终答案指定了单位，但这些单位在已知条件中并未定义（问题是用无量纲量来表述的），但这只是对最终输出格式的说明，而不是问题内部逻辑或量纲一致性的缺陷。因此，可以推导出有效的解。\n\n### 步骤 3：结论与行动\n问题有效。现在开始求解过程。\n\n按照要求，求解过程分为三个部分。\n\n首先，我们从稳态质量平衡条件 $S v = 0$ 推导出通量 $v_1$、$v_5$、$v_6$ 和 $v_7$ 之间的关系。写出矩阵向量乘积，得到一个由两个线性方程组成的方程组：\n$$ \\begin{pmatrix} 1  -1  -1  1 \\\\ 0  0  1  -1 \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_5 \\\\ v_6 \\\\ v_7 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\n该方程组的第二行立即得出以下方程：\n$$ (0)v_1 + (0)v_5 + (1)v_6 + (-1)v_7 = 0 \\implies v_6 - v_7 = 0 \\implies v_6 = v_7 $$\n这表明在稳态下，代谢物 $X$ 和 $Y$ 之间的正向和反向反应必须具有相同的通量，如果 $v_6 = v_7 > 0$，则会形成一个无效循环。\n方程组的第一行给出以下方程：\n$$ (1)v_1 + (-1)v_5 + (-1)v_6 + (1)v_7 = 0 \\implies v_1 - v_5 - v_6 + v_7 = 0 $$\n将结果 $v_6 = v_7$ 代入此方程，得到：\n$$ v_1 - v_5 - v_6 + v_6 = 0 \\implies v_1 - v_5 = 0 \\implies v_1 = v_5 $$\n这个关系表明，在稳态下，外部底物的吸收速率（$v_1$）必须等于生物质的形成速率（$v_5$）。因此，这些关系是 $v_1 = v_5$ 和 $v_6 = v_7$。\n\n其次，我们确定最优目标值 $z^*$ 并解释替代最优解的存在性。目标是最大化 $z = v_5$。可行空间由稳态关系和通量界限定义。我们有关系 $v_1 = v_5$。通量 $v_1$ 的界限是 $0 \\leq v_1 \\leq 10$。将这个不等式中的 $v_1$ 替换为 $v_5$，我们得到对 $v_5$ 的约束：$0 \\leq v_5 \\leq 10$。$v_5$ 还有一个明确的界限，$0 \\leq v_5 \\leq 100$。$v_5$ 的可行范围是这两个范围的交集，即 $[0, 10]$。因此，$v_5$ 的最大值是 $10$。最优目标值为 $z^{*} = 10$。\n\n存在替代最优解，因为目标函数 $z = v_5$ 的值完全由 $v_1$ 决定，而与通量 $v_6$ 和 $v_7$ 无关。任何满足 $v_1 = v_5 = z^* = 10$ 并且也满足对 $v_6$ 和 $v_7$ 约束的通量向量 $v = (v_1, v_5, v_6, v_7)^{\\top}$ 都是一个最优解。对 $v_6$ 和 $v_7$ 的约束是 $v_6 = v_7$，$0 \\leq v_6 \\leq 8$ 和 $0 \\leq v_7 \\leq 8$。这些约束结合起来得到 $0 \\leq v_6 \\leq 8$（其中 $v_7$ 等于 $v_6$）。由于 $v_6$ 可以在区间 $[0, 8]$ 内取任何实数值，因此有无限多个不同的通量向量可以达到最优目标值。两个这样明确、不同且可行的通量向量是：\n1.  设 $v_6 = 0$。则 $v_7 = 0$。通量向量为 $v^{(1)} = (10, 10, 0, 0)^{\\top}$。该向量满足 $S v^{(1)} = 0$ 和所有通量界限，并给出目标值 $v_5 = 10$。\n2.  设 $v_6 = 8$。则 $v_7 = 8$。通量向量为 $v^{(2)} = (10, 10, 8, 8)^{\\top}$。该向量也满足 $S v^{(2)} = 0$ 和所有通量界限，并给出目标值 $v_5 = 10$。\n\n第三，我们对反应 $R_6$ 进行通量变异性分析 (FVA) 并计算其区间宽度。$v_6$ 的 FVA 需要在满足原始约束以及目标函数保持在其最大值（即 $v_5 = z^* = 10$）这一新约束的条件下，找到 $v_6$ 的最小和最大可能值。\nFVA 的完整约束集是：\n1.  $v_1 = v_5$\n2.  $v_6 = v_7$\n3.  $0 \\leq v_1 \\leq 10$\n4.  $0 \\leq v_5 \\leq 100$\n5.  $0 \\leq v_6 \\leq 8$\n6.  $0 \\leq v_7 \\leq 8$\n7.  $v_5 = 10$\n根据约束 7，我们有 $v_5 = 10$。根据约束 1，可以得出 $v_1 = 10$。这些值与约束 3 和 4 一致。剩下的约束适用于 $v_6$ 和 $v_7$。我们从约束 2 得到 $v_6=v_7$。独立的界限是 $0 \\leq v_6 \\leq 8$（约束 5）和 $0 \\leq v_7 \\leq 8$（约束 6）。将 $v_7=v_6$ 代入 $v_7$ 的界限，得到 $0 \\leq v_6 \\leq 8$，这与 $v_6$ 的原始界限相同。因此，在最优生物质形成的条件下，通量 $v_6$ 可以在其允许范围内可行地取任何值。\n求解 $v_6$ 最小值的 FVA 问题是在这些约束下最小化 $v_6$。最小值显然是 $v_{6, \\min} = 0$。\n求解 $v_6$ 最大值的 FVA 问题是在这些约束下最大化 $v_6$。最大值显然是 $v_{6, \\max} = 8$。\n$v_6$ 的 FVA 区间是 $[0, 8]$。\n该区间的宽度是最大值和最小值之差：\n$$ \\text{Width} = v_{6, \\max} - v_{6, \\min} = 8 - 0 = 8 $$\n该问题是用无量纲数表述的。根据说明，我们将指定的单位附加到这个最终数值结果上。$v_6$ 的 FVA 区间宽度为 $8\\ \\mathrm{mmol}\\ \\mathrm{gDW}^{-1}\\ \\mathrm{h}^{-1}$。",
            "answer": "$$\n\\boxed{8}\n$$"
        },
        {
            "introduction": "理解了通量变异性的概念基础后，下一步是将其量化。本练习将指导您实现完整的通量变异性分析（FVA）工作流程，这是基于约束的建模中的一项核心技能。通过从第一性原理出发编写代码，您将首先执行通量平衡分析（FBA）确定最优目标值 $z^{\\star}$，然后在维持目标接近最优（例如 $\\ge 0.95 z^{\\star}$）的条件下，系统地探索网络中每个反应通量的可行范围 。",
            "id": "4343372",
            "problem": "考虑一个稳态代谢网络，该网络由化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$、通量向量 $v \\in \\mathbb{R}^{n}$、下界 $l \\in \\mathbb{R}^{n}$、上界 $u \\in \\mathbb{R}^{n}$ 和目标向量 $c \\in \\mathbb{R}^{n}$ 建模。基本假设如下：在稳态下，细胞内代谢物浓度不发生变化，这强制执行质量守恒约束 $S v = 0$，并且每个反应通量 $v_j$ 受限于 $l_j \\le v_j \\le u_j$。在通量平衡分析 (FBA) 中，最优生长是通过一个线性规划问题获得的，该问题在满足 $S v = 0$ 和 $l \\le v \\le u$ 的条件下最大化线性目标 $c^T v$。然后，通量变异性分析 (FVA) 刻画了在所有维持接近最优目标值的稳态通量分布中，每个单独通量 $v_j$ 的允许变化范围。具体来说，对于一个固定的比例 $\\alpha \\in (0,1]$，FVA 找到每个通量 $v_j$ 在满足 $S v = 0$、$l \\le v \\le u$ 和 $c^T v \\ge \\alpha \\, c^T v^\\*$ 条件下的最小值和最大值，其中 $v^\\*$ 表示 FBA 问题的任意最优解。\n\n你的任务是，从基本原理出发，为每个提供的网络中的所有反应实现通量变异性分析 (FVA) 的计算，并将次优性阈值固定为 $\\alpha = 0.95$。使用线性规划首先通过最大化 $c^T v$ 来获得 $v^\\*$，然后对于每个通量分量 $v_j$，在稳态约束、边界和次优性约束 $c^T v \\ge 0.95 \\, c^T v^\\*$ 的条件下计算其最小值和最大值。所有答案都应报告为不带物理单位的普通浮点数。\n\n形式上，对于每个具有数据 $(S, c, l, u)$ 的测试用例：\n- 求解 FBA 问题：最大化 $c^T v$，满足 $S v = 0$ 和 $l \\le v \\le u$，并令 $v^\\*$ 为一个最优通量向量，其最优值为 $z^\\* = c^T v^\\*$。\n- 对于每个反应索引 $j \\in \\{1,\\dots,n\\}$，求解两个线性规划问题以获得通量变异性分析边界：\n  - 最小化 $v_j$，满足 $S v = 0$、$l \\le v \\le u$ 和 $c^T v \\ge 0.95 \\, z^\\*$。\n  - 最大化 $v_j$，满足 $S v = 0$、$l \\le v \\le u$ 和 $c^T v \\ge 0.95 \\, z^\\*$。\n\n使用以下包含三个网络的测试套件。每个网络都由其化学计量矩阵 $S$、目标向量 $c$、下界 $l$ 和上界 $u$ 描述。在所有情况下，所有边界都是包含性的。代谢物数量 $m$ 和反应数量 $n$ 都很小，矩阵和向量均明确给出。\n\n测试用例 1（具有单一生物质路径的简单链）：\n- $m = 2$, $n = 3$.\n- $$S = \\begin{bmatrix}\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix}.$$\n- $$c = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\end{bmatrix}.$$\n- $$l = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad u = \\begin{bmatrix} 10 \\\\ 1000 \\\\ 1000 \\end{bmatrix}.$$\n\n测试用例 2（具有两个生物质路径的分支网络，其中一个有上限）：\n- $m = 2$, $n = 4$.\n- $$S = \\begin{bmatrix}\n1  -1  0  -1 \\\\\n0  1  -1  0\n\\end{bmatrix}.$$\n- $$c = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 1 \\end{bmatrix}.$$\n- $$l = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad u = \\begin{bmatrix} 10 \\\\ 1000 \\\\ 1000 \\\\ 8 \\end{bmatrix}.$$\n\n测试用例 3（被阻断的分支迫使采用唯一的生物质路径）：\n- $m = 2$, $n = 4$.\n- $$S = \\begin{bmatrix}\n1  -1  0  -1 \\\\\n0  1  -1  0\n\\end{bmatrix}.$$\n- $$c = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 1 \\end{bmatrix}.$$\n- $$l = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad u = \\begin{bmatrix} 10 \\\\ 0 \\\\ 1000 \\\\ 6 \\end{bmatrix}.$$\n\n你的程序应为每个测试用例计算一个成对列表 $\\big[\\min(v_j), \\max(v_j)\\big]$（对于 $j = 1, \\dots, n$），所有计算都在约束 $c^T v \\ge 0.95 \\, c^T v^\\*$ 下进行。将这三个列表按照测试用例的顺序汇总成一个列表的列表。将报告的每个边界四舍五入到 $6$ 位小数。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身是按反应索引顺序排列的 $n$ 对的列表，例如 $\\big[[[\\min(v_1),\\max(v_1)],\\dots],\\dots\\big]$。",
            "solution": "用户要求为几个小型代谢网络实现通量变异性分析 (FVA)。此分析是系统生物学中的一种标准技术。该问题在科学上是合理的、适定的且完整的。\n\n对于每个由化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$、目标向量 $c \\in \\mathbb{R}^{n}$ 以及通量边界向量 $l, u \\in \\mathbb{R}^{n}$ 定义的测试用例，解决方案分为两个主要阶段。\n\n**第 1 步：通量平衡分析 (FBA)**\n\n首先，通过求解一个线性规划 (LP) 问题来确定生物学目标函数的最大可能值 $z^\\*$。这就是 FBA 问题，其形式如下：\n$$\n\\begin{aligned}\n\\text{最大化} \\quad  z = c^T v \\\\\n\\text{约束条件} \\quad  S v = 0, \\\\\n l \\le v \\le u.\n\\end{aligned}\n$$\n在此公式中，$v \\in \\mathbb{R}^n$ 代表反应通量向量。等式约束 $S v = 0$ 强制执行稳态下的质量守恒定律，确保内部代谢物的浓度保持恒定。不等式约束 $l \\le v \\le u$ 定义了每个通量的可行范围，这取决于热力学可行性和酶容量。目标函数的最优值记为 $z^\\*$，对应于一个最优通量分布 $v^\\*$。\n\n**第 2 步：通量变异性分析 (FVA)**\n\n第二阶段计算每个单独反应 $v_j$ (对于 $j \\in \\{1, \\dots, n\\}$) 的完整可能通量范围，条件是网络维持接近最优的目标值。问题指定了一个次优性阈值 $\\alpha = 0.95$。这个要求为系统增加了一个新约束：\n$$\nc^T v \\ge \\alpha z^\\*\n$$\n此约束确保任何有效的通量分布 $v$ 产生的目标值至少为理论最大值 $z^\\*$ 的 $95\\%$。\n\n为了确定每个反应 $v_j$ 的变异性，需要求解两个独立的 LP 问题：一个用于最小可能通量，另一个用于最大可能通量。\n\n对于每个反应索引 $j \\in \\{1, \\dots, n\\}$：\n\n1.  **$v_j$ 的最小化**：通过求解以下问题找到最小通量：\n    $$\n    \\begin{aligned}\n    v_j^{\\text{min}} = \\min_{v} \\quad  v_j \\\\\n    \\text{约束条件} \\quad  S v = 0, \\\\\n     l \\le v \\le u, \\\\\n     c^T v \\ge \\alpha z^\\*.\n    \\end{aligned}\n    $$\n\n2.  **$v_j$ 的最大化**：通过求解以下问题找到最大通量：\n    $$\n    \\begin{aligned}\n    v_j^{\\text{max}} = \\max_{v} \\quad  v_j \\\\\n    \\text{约束条件} \\quad  S v = 0, \\\\\n     l \\le v \\le u, \\\\\n     c^T v \\ge \\alpha z^\\*.\n    \\end{aligned}\n    $$\n\n配对 $[v_j^{\\text{min}}, v_j^{\\text{max}}]$ 构成了反应 $j$ 的通量变异范围。此过程必须对所有反应进行迭代，因此每个网络总共需要求解 $2n$ 个 LP 问题。\n\n**示例说明：测试用例 2**\n\n为了演示该方法，我们考虑测试用例 2：\n- $S = \\begin{bmatrix} 1  -1  0  -1 \\\\ 0  1  -1  0 \\end{bmatrix}$，有 $n=4$ 个反应。\n- $c = [0, 0, 1, 1]^T$。\n- $l = [0, 0, 0, 0]^T$，$u = [10, 1000, 1000, 8]^T$。\n\n稳态约束 $S v = 0$ 得出以下关系：\n$$\nv_1 - v_2 - v_4 = 0 \\quad \\text{和} \\quad v_2 - v_3 = 0\n$$\n这些关系可简化为 $v_2 = v_3$ 和 $v_1 = v_2 + v_4$。\n\n**测试用例 2 的 FBA：**\n目标是最大化 $z = c^T v = v_3 + v_4$。代入稳态关系，$z = v_3 + (v_1 - v_2) = v_3 + (v_1 - v_3) = v_1$。目标简化为最大化 $v_1$。边界指定 $0 \\le v_1 \\le 10$。因此，最优目标值为 $z^\\* = 10$。\n\n**测试用例 2 的 FVA：**\n次优性约束为 $c^T v = v_1 \\ge \\alpha z^\\* = 0.95 \\times 10 = 9.5$。\n所有 FVA 子问题的完整约束集为：\n- $v_2 = v_3$\n- $v_1 = v_2 + v_4$\n- $9.5 \\le v_1 \\le 10$\n- $0 \\le v_2 \\le 1000$\n- $0 \\le v_3 \\le 1000$\n- $0 \\le v_4 \\le 8$\n- 所有通量 $v_j \\ge 0$。\n\n我们来寻找通量 $v_2$ 的范围：\n- **最小化 $v_2$**：为了最小化 $v_2 = v_1 - v_4$，我们必须选择允许的最小 $v_1$ 和允许的最大 $v_4$。我们设置 $v_1 = 9.5$。约束 $v_1 - v_4 = v_2 \\ge 0$ 和 $v_4 \\le 8$ 意味着我们可以设置 $v_4=8$。这给出了最小值 $v_2^{\\text{min}} = 9.5 - 8 = 1.5$。\n- **最大化 $v_2$**：为了最大化 $v_2 = v_1 - v_4$，我们必须选择最大的 $v_1$ 和最小的 $v_4$。我们设置 $v_1 = 10$ 和 $v_4 = 0$。这给出了最大值 $v_2^{\\text{max}} = 10 - 0 = 10$。\n因此，$v_2$（以及 $v_3$）的变异范围是 $[1.5, 10.0]$。\n\n整个过程使用 `scipy.optimize.linprog` 函数为三个测试用例中的每个反应系统地实现，以求解 LP 问题。最终结果按规定汇总和格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef _solve_fva_for_case(S, c_obj, l, u, alpha):\n    \"\"\"\n    Performs Flux Variability Analysis for a single metabolic network case.\n    \"\"\"\n    m, n = S.shape\n\n    # Step 1: Flux Balance Analysis (FBA) to find the optimal objective value z*\n    # We maximize c_obj.T @ v by minimizing -c_obj.T @ v.\n    c_fba = -c_obj\n    bounds_fba = list(zip(l, u))\n\n    fba_result = linprog(c=c_fba, A_eq=S, b_eq=np.zeros(m), bounds=bounds_fba, method='highs')\n\n    if not fba_result.success:\n        # For a valid problem, FBA should be feasible.\n        raise ValueError(\"FBA optimization failed for a test case.\")\n\n    z_opt = -fba_result.fun\n\n    # Step 2: Flux Variability Analysis (FVA)\n    fva_threshold = alpha * z_opt\n\n    # Common constraints for all FVA LPs:\n    # S @ v = 0 (equality)\n    # l = v = u (bounds)\n    # c_obj.T @ v >= fva_threshold  => -c_obj.T @ v = -fva_threshold (inequality)\n    A_ub_fva = -c_obj.reshape(1, -1)\n    b_ub_fva = np.array([-fva_threshold])\n    \n    variability_results = []\n    \n    for j in range(n):\n        # -- Minimize v_j --\n        c_min = np.zeros(n)\n        c_min[j] = 1\n        min_result = linprog(c=c_min, A_ub=A_ub_fva, b_ub=b_ub_fva, A_eq=S, b_eq=np.zeros(m), bounds=bounds_fba, method='highs')\n        min_vj = min_result.fun if min_result.success else np.nan\n\n        # -- Maximize v_j --\n        c_max = np.zeros(n)\n        c_max[j] = -1\n        max_result = linprog(c=c_max, A_ub=A_ub_fva, b_ub=b_ub_fva, A_eq=S, b_eq=np.zeros(m), bounds=bounds_fba, method='highs')\n        max_vj = -max_result.fun if max_result.success else np.nan\n\n        # Round to 6 decimal places as required.\n        variability_results.append([round(min_vj, 6), round(max_vj, 6)])\n        \n    return variability_results\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1\n        (\n            np.array([[1, -1, 0], [0, 1, -1]]),\n            np.array([0, 0, 1]),\n            np.array([0, 0, 0]),\n            np.array([10, 1000, 1000]),\n        ),\n        # Test Case 2\n        (\n            np.array([[1, -1, 0, -1], [0, 1, -1, 0]]),\n            np.array([0, 0, 1, 1]),\n            np.array([0, 0, 0, 0]),\n            np.array([10, 1000, 1000, 8]),\n        ),\n        # Test Case 3\n        (\n            np.array([[1, -1, 0, -1], [0, 1, -1, 0]]),\n            np.array([0, 0, 1, 1]),\n            np.array([0, 0, 0, 0]),\n            np.array([10, 0, 1000, 6]),\n        ),\n    ]\n\n    alpha = 0.95\n    results = []\n    for S, c, l, u in test_cases:\n        # Main logic to calculate the result for one case goes here.\n        case_result = _solve_fva_for_case(S, c, l, u, alpha)\n        results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # Convert the list of lists of lists to a string and remove spaces to match the specified output format.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "通量变异性分析的真正威力在于其解决实际生物学问题的能力。本练习模拟了代谢工程中的一个经典应用：预测基因敲除的表型效应。通过分析删除特定反应（模拟基因敲除）后，关键生物合成途径通量范围的变化，我们可以识别出如“合成致死”等重要的网络特性，这展示了 FVA 作为一种强大的体外预测工具的价值 。",
            "id": "3913859",
            "problem": "给定一个旨在表示简化的生物质合成模块的最小代谢网络，该网络适用于流变异性分析 (Flux Variability Analysis, FVA)。流变异性分析 (FVA) 定义为：在强制目标函数达到指定水平的情况下，计算一个流变量在稳态可行域内的可行最小值和最大值。基因-蛋白质-反应 (Gene–Protein–Reaction, GPR) 映射提供了基因、蛋白质和反应之间的对应关系，但对于本问题，您将通过直接将反应流约束为零来模拟基因干预。\n\n基本原理：\n- 内部代谢物的稳态质量平衡由一个化学计量矩阵和净生产速率为零的条件来描述。\n- 线性规划在稳态的线性等式约束和反应不可逆性及容量的边界约束下求解。\n- 流变异性分析将目标反应设定为一个固定值，然后为每个感兴趣的反应求解两个线性规划问题，以获得可行的最小值和最大值。\n\n网络规格：\n- 内部代谢物：$A$、$B$、$C$、$P$。\n- 反应（括号内为索引）：\n  - $(0)$ $R_1$：外部摄取 $\\rightarrow A$，边界 $0 \\le v_0 \\le 10$。\n  - $(1)$ $R_2$：$A \\rightarrow B$，边界 $0 \\le v_1 \\le 1000$。\n  - $(2)$ $R_3$：$A \\rightarrow C$，边界 $0 \\le v_2 \\le 1000$。\n  - $(3)$ $R_4$：$B \\rightarrow P$，边界 $0 \\le v_3 \\le 1000$。\n  - $(4)$ $R_5$：$C \\rightarrow P$，边界 $0 \\le v_4 \\le 1000$。\n  - $(5)$ $R_6$：$P \\rightarrow$ 生物质流出，边界 $0 \\le v_5 \\le 1000$，在最优生长计算中需要最大化的目标。\n- 化学计量矩阵 $S \\in \\mathbb{R}^{4 \\times 6}$，内部代谢物排序为 $(A,B,C,P)$，反应排序为 $(R_1,\\dots,R_6)$：\n  - $A$ 对应的行：$(+1,-1,-1,0,0,0)$，\n  - $B$ 对应的行：$(0,+1,0,-1,0,0)$，\n  - $C$ 对应的行：$(0,0,+1,0,-1,0)$，\n  - $P$ 对应的行：$(0,0,0,+1,+1,-1)$。\n- 需要通过 FVA 监测的生物质相关反应：$R_4$ 和 $R_5$（索引为 $3$ 和 $4$）。\n\n在此背景下合成致死的定义：如果两个反应删除单独都不会消除实现严格正最优生物质流的能力，但共同作用下，在稳态和边界约束下将最优生物质流降至零，则它们是合成致死的。\n\n每次干预（成对反应删除）的计算任务：\n1. 通过最大化 $v_5$ 来计算最优生物质流 $v_5^\\star$，约束条件为稳态约束 $S v = 0$ 和所有 $j$ 的边界 $0 \\le v_j \\le U_j$，其中任何被删除的反应其边界都固定为 $v_j = 0$。\n2. 在强制的最优生物质水平上执行流变异性分析 (FVA)，方法是向稳态约束中添加等式约束 $v_5 = v_5^\\star$，然后，对于每个生物质相关反应 $R_4$ 和 $R_5$，计算在这些约束下的可行最小值和最大值 $(v_3^{\\min}, v_3^{\\max})$ 和 $(v_4^{\\min}, v_4^{\\max})$。\n3. 将反应 $R_i$ 的 FVA 范围“坍缩”定义为条件 $v_i^{\\max} - v_i^{\\min} \\le \\varepsilon$，容差为 $\\varepsilon = 10^{-7}$。判断 $R_4$ 和 $R_5$ 是否都表现出范围坍缩。\n\n解释要求：根据通路冗余性和受 GPR 启发的干预效果，解释组合删除如何改变可行空间，并导致生物质相关反应的 FVA 范围保持不变或坍缩。\n\n测试套件：\n- 使用以下五个干预案例，每个案例都由反应索引的有序对指定删除。哨兵值 $\\mathrm{None}$ 表示该位置无删除。\n  - 案例 1：$(\\mathrm{None}, \\mathrm{None})$。\n  - 案例 2：$(1, \\mathrm{None})$。\n  - 案例 3：$(1, 2)$。\n  - 案例 4：$(1, 4)$。\n  - 案例 5：$(4, \\mathrm{None})$。\n对于每个案例，通过将相应反应流的边界设置为 $v_j=0$ 来强制执行删除。\n\n输出规格：\n- 对于上述顺序中的每个案例，输出一个布尔值，指示在强制的最优生物质约束下，$R_4$ 和 $R_5$ 的 FVA 范围是否都坍缩。您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来的结果（例如，`[result1,result2,result3,result4,result5]`）。\n\n所有流都是抽象的稳态流；输出中无需进行物理单位转换，因为要求的答案是布尔值。",
            "solution": "该问题陈述具有科学依据、定义明确、客观且完整。它描述了合成生物学和代谢工程领域的一项标准计算任务，具体来说，是将流平衡分析 (Flux Balance Analysis, FBA) 和流变异性分析 (Flux Variability Analysis, FVA) 应用于一个简化的代谢网络。网络、约束和计算目标都得到了清晰的定义，从而可以得到唯一且可验证的解。因此，该问题是有效的。\n\n对于每个指定的干预案例，解决方案需要一个两阶段的计算过程，两个阶段都使用线性规划 (Linear Programming, LP) 来实现。一个 LP 问题旨在在满足线性等式和不等式约束的条件下，优化一个线性目标函数。其一般形式为：\n$$\n\\begin{align*}\n\\text{minimize} \\quad  c^T v \\\\\n\\text{subject to} \\quad  A_{eq} v = b_{eq} \\\\\n lb \\le v \\le ub\n\\end{align*}\n$$\n其中 $v$ 是变量（流）向量，$c$ 是目标向量，$A_{eq}$ 是等式约束矩阵，$b_{eq}$ 是对应的右侧向量，$lb$ 和 $ub$ 分别是变量的下界和上界。\n\n代谢网络由化学计量矩阵 $S$ 定义。稳态假设施加了质量平衡约束 $S v = 0$，其中 $v = [v_0, v_1, v_2, v_3, v_4, v_5]^T$ 是反应流向量。在 LP 公式中，这对应于 $A_{eq} = S$ 和 $b_{eq} = 0$。反应边界提供了向量 $lb$ 和 $ub$。\n\n**网络结构和通路分析**\n\n在详述计算之前，我们先分析网络的拓扑结构。营养物质流通过 $R_1$（摄取外部底物，产生 $A$）进入系统，最大速率为 $v_0 = 10$。代谢物 $A$ 是一种前体，可以通过两条平行通路转化为代谢物 $P$：\n1.  **通路 B：** $A \\xrightarrow{R_2} B \\xrightarrow{R_4} P$。流通过质量平衡耦合：$v_1 = v_3$。\n2.  **通路 C：** $A \\xrightarrow{R_3} C \\xrightarrow{R_5} P$。流通过质量平衡耦合：$v_2 = v_4$。\n\n代谢物 $P$ 是生物质的前体，由反应 $R_6$ 排出。$P$ 的稳态条件是 $v_3 + v_4 - v_5 = 0$，这意味着 $v_5 = v_3 + v_4$。$A$ 的稳态条件是 $v_0 - v_1 - v_2 = 0$，这意味着 $v_0 = v_1 + v_2$。将这些与通路耦合（$v_1=v_3$, $v_2=v_4$）相结合，我们发现 $v_5 = v_3+v_4 = v_1+v_2 = v_0$。这个基本关系 $v_5 = v_0$ 决定了最大可能的生物质生产速率受限于最大摄取速率，即 $v_5^{\\text{max}} = v_0^{\\text{max}} = 10$。这种代谢结构表现出冗余性：只要 $v_3+v_4=10$，生物质目标就达到最大，允许在通路 B 和通路 C 之间进行灵活的权衡。\n\n**计算阶段**\n\n对于每个干预案例（由一组反应删除定义）：\n\n**阶段 1：最优生物质计算 (FBA)**\n第一步是计算可能的最大生物质流 $v_5^\\star$。这是一个典型的 FBA 问题。我们求解以下 LP 问题：\n$$\n\\begin{align*}\nv_5^\\star = \\max_{v} \\quad  v_5 \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n lb' \\le v \\le ub'\n\\end{align*}\n$$\n边界 $lb'$ 和 $ub'$ 是基本边界，并根据案例中指定的任何反应删除进行修改。对于一个被删除的反应 $R_j$，其流 $v_{j-1}$ 通过将其上下界均设置为 0 来约束为零。\n\n**阶段 2：流变异性分析 (FVA)**\n找到最优生物质流 $v_5^\\star$ 后，我们增加一个约束，将生物质生产固定在这个最优水平上：$v_5 = v_5^\\star$。这将可行流空间限制在相对于生物质生产为最优的解上。\n对于每个感兴趣的目标反应 $R_i$（这里是 $R_4$ 和 $R_5$，对应于流 $v_3$ 和 $v_4$），我们接着求解两个 LP 问题来找到其可行的最小和最大流：\n$$\n\\begin{align*}\nv_i^{\\min} = \\min_{v} \\quad  v_i \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n v_5 = v_5^\\star \\\\\n lb' \\le v \\le ub'\n\\end{align*}\n$$\n$$\n\\begin{align*}\nv_i^{\\max} = \\max_{v} \\quad  v_i \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n v_5 = v_5^\\star \\\\\n lb' \\le v \\le ub'\n\\end{align*}\n$$\n如果对于给定的容差 $\\varepsilon = 10^{-7}$，满足 $v_i^{\\max} - v_i^{\\min} \\le \\varepsilon$，则反应 $R_i$ 的范围被视为“坍缩”。当且仅当 $R_4$ 和 $R_5$ 的范围都坍缩时，该案例的最终布尔结果为真。\n\n**测试案例分析**\n\n1.  **案例 1（无删除）：** $v_5^\\star = 10$。FVA 在约束 $v_5 = 10$ 和 $v_3 + v_4 = 10$ 下执行。$v_3$ 和 $v_4$ 之间的任何流分布都是可能的，只要它们的和为 10（例如，$(v_3, v_4) = (10, 0)$ 或 $(0, 10)$ 或 $(5, 5)$）。因此，$v_3^{\\min}=0, v_3^{\\max}=10$ 且 $v_4^{\\min}=0, v_4^{\\max}=10$。两个范围都没有坍缩。**结果：False。**\n\n2.  **案例 2（删除 $R_2$）：** 删除 $R_2$ 会设置 $v_1=0$，这意味着 $v_3=0$。整个通路 B 被关闭。为了产生生物质，所有流必须通过通路 C。因此 $v_5 = v_4$。最优生物质仍为 $v_5^\\star = 10$，因为通路 C 可以承载全部流（$v_2 = v_4 = v_5 = v_0 = 10$）。在约束 $v_5=10$ 下，流分布是唯一确定的：$v_3=0$ 和 $v_4=10$。$v_3$ 和 $v_4$ 的范围都坍缩到单点（分别为 $[0,0]$ 和 $[10,10]$）。**结果：True。**\n\n3.  **案例 3（删除 $R_2, R_3$）：** 删除 $R_2$ ($v_1=0$) 和 $R_3$ ($v_2=0$) 阻断了源自代谢物 $A$ 的两条平行通路。这意味着 $v_3 = v_1 = 0$ 和 $v_4 = v_2 = 0$。因此，$v_5 = v_3 + v_4 = 0$。最优生物质是 $v_5^\\star = 0$。这是一对合成致死组合。在 $v_5^\\star=0$ 时，唯一可行的解是 $v=0$。因此，$v_3$ 和 $v_4$ 的范围是 $[0,0]$。两者都坍缩了。**结果：True。**\n\n4.  **案例 4（删除 $R_2, R_5$）：** 删除 $R_2$ ($v_1=0$) 关闭了通路 B，所以 $v_3=0$。删除 $R_5$ ($v_4=0$) 关闭了通路 C。由于通往 $P$ 的两条通路都被阻断，所以 $v_5 = v_3+v_4 = 0$。这是另一对合成致死组合。最优生物质是 $v_5^\\star = 0$。与案例 3 一样，所有流必须为零，所以 $v_3$ 和 $v_4$ 的范围坍缩。**结果：True。**\n\n5.  **案例 5（删除 $R_5$）：** 这个案例与案例 2 对称。删除 $R_5$ 会设置 $v_4=0$，关闭通路 C。所有流必须通过通路 B。最优生物质是 $v_5^\\star = 10$。在此最优点，流是唯一确定的：$v_4=0$ 和 $v_3=10$。$v_3$ 和 $v_4$ 的范围都坍缩了。**结果：True。**\n\n实现将遵循此逻辑，使用 `scipy.optimize.linprog` 来解决每个案例所需的 LP 问题。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the Flux Variability Analysis problem for a given metabolic network\n    under different gene knockout conditions.\n    \"\"\"\n    \n    # Stoichiometric matrix S for metabolites (A, B, C, P) and reactions (R1-R6)\n    S = np.array([\n        [1, -1, -1,  0,  0,  0],  # A\n        [0,  1,  0, -1,  0,  0],  # B\n        [0,  0,  1,  0, -1,  0],  # C\n        [0,  0,  0,  1,  1, -1]   # P\n    ])\n    \n    num_reactions = S.shape[1]\n\n    # Base bounds for all reactions v0 to v5\n    base_lb = np.array([0, 0, 0, 0, 0, 0], dtype=float)\n    base_ub = np.array([10, 1000, 1000, 1000, 1000, 1000], dtype=float)\n    \n    # Reactions to monitor with FVA (indices 3 and 4 for R4 and R5)\n    fva_targets = [3, 4]\n    \n    # Numerical tolerance for range collapse\n    epsilon = 1e-7\n\n    # Test cases: tuples of reaction indices to delete (None for no deletion)\n    # Indices correspond to v0, v1, ..., v5\n    test_cases = [\n        (None, None),  # Case 1\n        (1, None),     # Case 2: delete R2\n        (1, 2),        # Case 3: delete R2, R3\n        (1, 4),        # Case 4: delete R2, R5\n        (4, None)      # Case 5: delete R5\n    ]\n\n    final_results = []\n\n    for deletions in test_cases:\n        # 1. SETUP for the current case\n        current_lb = base_lb.copy()\n        current_ub = base_ub.copy()\n        \n        for del_idx in deletions:\n            if del_idx is not None:\n                current_lb[del_idx] = 0.0\n                current_ub[del_idx] = 0.0\n        \n        bounds = list(zip(current_lb, current_ub))\n        \n        # 2. FBA: Compute optimal biomass flux (v5_star)\n        # We maximize v5, which is equivalent to minimizing -v5.\n        c_fba = np.zeros(num_reactions)\n        c_fba[5] = -1.0\n        \n        res_fba = linprog(\n            c=c_fba,\n            A_eq=S,\n            b_eq=np.zeros(S.shape[0]),\n            bounds=bounds,\n            method='highs'\n        )\n\n        if not res_fba.success:\n            # Handle infeasible cases (e.g., lethal knockouts)\n            v5_star = 0.0\n        else:\n            v5_star = -res_fba.fun\n        \n        # Clamp near-zero values to zero to avoid floating point issues\n        if abs(v5_star)  epsilon:\n            v5_star = 0.0\n            \n        # 3. FVA: Compute min/max for target fluxes with v5 fixed at v5_star\n        fva_bounds = list(zip(current_lb, current_ub))\n        fva_bounds[5] = (v5_star, v5_star) # Enforce optimal biomass\n        \n        collapsed_flags = []\n        for target_idx in fva_targets:\n            # Minimize target flux\n            c_fva_min = np.zeros(num_reactions)\n            c_fva_min[target_idx] = 1.0\n            res_min = linprog(\n                c=c_fva_min,\n                A_eq=S,\n                b_eq=np.zeros(S.shape[0]),\n                bounds=fva_bounds,\n                method='highs'\n            )\n            v_min = res_min.fun if res_min.success else 0.0\n            \n            # Maximize target flux (by minimizing its negative)\n            c_fva_max = np.zeros(num_reactions)\n            c_fva_max[target_idx] = -1.0\n            res_max = linprog(\n                c=c_fva_max,\n                A_eq=S,\n                b_eq=np.zeros(S.shape[0]),\n                bounds=fva_bounds,\n                method='highs'\n            )\n            v_max = -res_max.fun if res_max.success else 0.0\n\n            # Check if the range has collapsed\n            is_collapsed = (v_max - v_min) = epsilon\n            collapsed_flags.append(is_collapsed)\n            \n        # 4. Final boolean result for the case (both must collapse)\n        final_results.append(all(collapsed_flags))\n\n    # Format the output as specified\n    print(f\"[{','.join(map(str, final_results))}]\".replace(\"True\", \"true\").replace(\"False\", \"false\"))\n\nsolve()\n```"
        }
    ]
}