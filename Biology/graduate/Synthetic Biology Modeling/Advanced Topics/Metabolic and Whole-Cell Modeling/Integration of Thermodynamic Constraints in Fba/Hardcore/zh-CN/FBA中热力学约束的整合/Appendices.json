{
    "hands_on_practices": [
        {
            "introduction": "在将热力学约束整合到整个代谢网络之前，我们必须首先掌握如何判断单个反应在特定细胞条件下的可行性。本练习旨在磨练这项核心技能 。通过计算给定代谢物浓度下的吉布斯自由能变（$\\Delta G_j$），您将能够确定反应是自发进行的（允许正向通量），还是非自发的（只允许反向通量），或是由于驱动力不足而受阻。",
            "id": "3915794",
            "problem": "合成途径中的一个胞内反应为 $A + 2B \\rightleftharpoons C$。考虑使用在 pH $7$ 下的转换标准吉布斯自由能（表示为 $\\Delta G_{j}^{\\circ'}$）将热力学约束整合到通量平衡分析（FBA, Flux Balance Analysis）中。假设代谢物活性可以很好地用浓度来近似，参考标准浓度 $c^{\\circ} = 1\\ \\mathrm{M}$，并为每种代谢物 $i \\in \\{A,B,C\\}$ 定义无量纲的对数活性变量 $y_{i} = \\ln\\!\\big(a_{i}\\big) = \\ln\\!\\big(c_{i}/c^{\\circ}\\big)$。代谢物 $i$ 的化学势为 $\\mu_{i} = \\mu_{i}^{\\circ'} + RT \\ln\\!\\big(a_{i}\\big)$，其中 $R$ 是通用气体常数，$T$ 是绝对温度。反应的吉布斯能由化学势的化学计量和给出，按照惯例，反应物带有负的化学计量系数，产物带有正的化学计量系数。施加一个最小热力学驱动力 $\\varepsilon > 0$，使得任何非零通量 $v_{j}$ 都必须满足热力学一致性：$v_{j}$ 的符号必须与 $\\Delta G_{j}$ 的符号相反，且其大小必须超过阈值 $\\varepsilon$。\n\n数据：\n- 转换标准吉布斯能：$\\Delta G_{j}^{\\circ'} = -10.0\\ \\mathrm{kJ\\,mol^{-1}}$。\n- 温度：$T = 310\\ \\mathrm{K}$。\n- 气体常数：$R = 8.314 \\times 10^{-3}\\ \\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$。\n- 代谢物浓度：$c_{A} = 1.0 \\times 10^{-4}\\ \\mathrm{M}$，$c_{B} = 1.0 \\times 10^{-3}\\ \\mathrm{M}$，$c_{C} = 1.0 \\times 10^{-5}\\ \\mathrm{M}$，标准浓度 $c^{\\circ} = 1\\ \\mathrm{M}$，得到 $y_{A} = \\ln\\!\\big(1.0 \\times 10^{-4}\\big)$，$y_{B} = \\ln\\!\\big(1.0 \\times 10^{-3}\\big)$，$y_{C} = \\ln\\!\\big(1.0 \\times 10^{-5}\\big)$。\n- 最小驱动力：$\\varepsilon = 3.0\\ \\mathrm{kJ\\,mol^{-1}}$。\n\n任务：\n1. 使用上述热力学定义和反应化学计量，计算在给定温度 $T$ 和代谢物活性下，以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位的 $\\Delta G_{j}$。\n2. 在最小驱动力 $\\varepsilon$ 的条件下，通过返回一个符号指示符 $s \\in \\{-1, 0, +1\\}$ 来决定通量 $v_{j}$ 的允许符号，其中 $+1$ 表示热力学上只允许正向通量（$v_{j} > 0$），$-1$ 表示只允许反向通量（$v_{j} < 0$），$0$ 表示在驱动力阈值下只允许零通量（$v_{j} = 0$）。\n\n答案格式：\n- 返回一个单行矩阵 $\\begin{pmatrix}\\Delta G_{j} & s\\end{pmatrix}$，其中第一个条目是计算出的能量，第二个条目是如上定义的符号指示符。\n- 能量以 $\\mathrm{kJ\\,mol^{-1}}$ 为单位表示，并四舍五入到四位有效数字。",
            "solution": "该问题被认为是有效的，因为它科学地基于化学热力学的基本原理，问题提出得很好，提供了所有必要的数据，并且其表述是客观的。它要求计算一个反应的吉布斯自由能，并根据指定的驱动力约束确定热力学上可行的通量方向，这是代谢建模中的一个标准程序。\n\n问题要求计算两个量：反应的吉布斯自由能 $\\Delta G_{j}$ 和热力学允许通量 $v_{j}$ 的符号指示符 $s$。\n\n首先，我们计算反应 $A + 2B \\rightleftharpoons C$ 的吉布斯自由能。根据反应物系数为负、产物系数为正的惯例，各物质的化学计量系数分别为 $S_{A}=-1$，$S_{B}=-2$ 和 $S_{C}=+1$。\n\n反应的吉布斯自由能 $\\Delta G_{j}$ 定义为参与反应的各物质的化学势 $\\mu_{i}$ 的总和，每个化学势都乘以其化学计量系数 $S_{i}$：\n$$ \\Delta G_{j} = \\sum_{i} S_{i} \\mu_{i} $$\n对于给定的反应，展开为：\n$$ \\Delta G_{j} = (1) \\mu_{C} + (-1) \\mu_{A} + (-2) \\mu_{B} = \\mu_{C} - \\mu_{A} - 2\\mu_{B} $$\n每种物质 $i$ 的化学势 $\\mu_{i}$ 由 $\\mu_{i} = \\mu_{i}^{\\circ'} + RT \\ln(a_{i})$ 给出，其中 $\\mu_{i}^{\\circ'}$ 是转换后的标准化学势，$R$ 是通用气体常数，$T$ 是绝对温度，$a_{i}$ 是物质 $i$ 的活性。问题指出，活性可以用相对于标准浓度 $c^{\\circ} = 1\\ \\mathrm{M}$ 的浓度 $c_i$ 来近似，即 $a_i = c_i / c^{\\circ}$。问题还定义了无量纲的对数活性变量 $y_i = \\ln(a_i)$。因此，化学势可以写成 $\\mu_{i} = \\mu_{i}^{\\circ'} + RT y_{i}$。\n\n将这个化学势的表达式代入 $\\Delta G_{j}$ 的方程中：\n$$ \\Delta G_{j} = (\\mu_{C}^{\\circ'} + RT y_{C}) - (\\mu_{A}^{\\circ'} + RT y_{A}) - 2(\\mu_{B}^{\\circ'} + RT y_{B}) $$\n将标准势项和对数活性项分组：\n$$ \\Delta G_{j} = (\\mu_{C}^{\\circ'} - \\mu_{A}^{\\circ'} - 2\\mu_{B}^{\\circ'}) + RT(y_{C} - y_{A} - 2y_{B}) $$\n$(\\mu_{C}^{\\circ'} - \\mu_{A}^{\\circ'} - 2\\mu_{B}^{\\circ'})$ 项是反应的转换标准吉布斯自由能 $\\Delta G_{j}^{\\circ'}$。这导出了 $\\Delta G_{j}$ 的最终表达式：\n$$ \\Delta G_{j} = \\Delta G_{j}^{\\circ'} + RT \\sum_{i} S_{i} y_{i} $$\n问题提供了以下数据：$\\Delta G_{j}^{\\circ'} = -10.0\\ \\mathrm{kJ\\,mol^{-1}}$，$R = 8.314 \\times 10^{-3}\\ \\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$，以及 $T = 310\\ \\mathrm{K}$。对数活性由 $y_{A} = \\ln(1.0 \\times 10^{-4})$，$y_{B} = \\ln(1.0 \\times 10^{-3})$ 和 $y_{C} = \\ln(1.0 \\times 10^{-5})$ 给出。\n\n我们来计算 $\\sum_{i} S_{i} y_{i}$ 这一项：\n$$ \\sum_{i} S_{i} y_{i} = y_{C} - y_{A} - 2y_{B} = \\ln(1.0 \\times 10^{-5}) - \\ln(1.0 \\times 10^{-4}) - 2\\ln(1.0 \\times 10^{-3}) $$\n使用对数性质 $\\ln(x) - \\ln(y) = \\ln(x/y)$ 和 $c\\ln(x) = \\ln(x^c)$：\n$$ \\sum_{i} S_{i} y_{i} = \\ln\\left(\\frac{1.0 \\times 10^{-5}}{(1.0 \\times 10^{-4}) \\times (1.0 \\times 10^{-3})^{2}}\\right) = \\ln\\left(\\frac{10^{-5}}{10^{-4} \\times 10^{-6}}\\right) = \\ln\\left(\\frac{10^{-5}}{10^{-10}}\\right) = \\ln(10^{5}) $$\n现在我们可以通过代入数值来计算 $\\Delta G_{j}$：\n$$ \\Delta G_{j} = -10.0\\ \\mathrm{kJ\\,mol^{-1}} + (8.314 \\times 10^{-3}\\ \\mathrm{kJ\\,mol^{-1}\\,K^{-1}}) \\times (310\\ \\mathrm{K}) \\times \\ln(10^{5}) $$\n首先，计算乘积 $RT$：\n$$ RT = (8.314 \\times 10^{-3}) \\times 310 \\approx 2.57734\\ \\mathrm{kJ\\,mol^{-1}} $$\n并且 $\\ln(10^5) = 5 \\ln(10) \\approx 5 \\times 2.302585 = 11.512925$：\n$$ \\Delta G_{j} \\approx -10.0 + (2.57734) \\times (11.512925) \\approx -10.0 + 29.67483 $$\n$$ \\Delta G_{j} \\approx 19.67483\\ \\mathrm{kJ\\,mol^{-1}} $$\n按要求四舍五入到四位有效数字，我们得到：\n$$ \\Delta G_{j} = 19.67\\ \\mathrm{kJ\\,mol^{-1}} $$\n这就完成了第一个任务。\n\n对于第二个任务，我们必须确定由指示符 $s$ 表示的通量 $v_{j}$ 的允许符号。热力学约束规定，对于非零通量（$v_{j} \\neq 0$），必须满足两个条件：\n1. 通量的符号必须与反应吉布斯自由能的符号相反：$\\mathrm{sign}(v_{j}) = -\\mathrm{sign}(\\Delta G_{j})$。\n2. 吉布斯自由能的大小必须超过最小驱动力阈值 $\\varepsilon$：$|\\Delta G_{j}| > \\varepsilon$。\n\n如果 $|\\Delta G_{j}| \\le \\varepsilon$，则不允许有通量，因此 $v_{j} = 0$ 且 $s=0$。\n我们有 $\\Delta G_{j} \\approx 19.67\\ \\mathrm{kJ\\,mol^{-1}}$ 和 $\\varepsilon = 3.0\\ \\mathrm{kJ\\,mol^{-1}}$。\n首先，检查大小条件：\n$$ |\\Delta G_{j}| = |19.67| = 19.67\\ \\mathrm{kJ\\,mol^{-1}} $$\n由于 $19.67 > 3.0$，条件 $|\\Delta G_{j}| > \\varepsilon$ 得到满足。因此，非零通量在热力学上是可能的。\n\n接下来，我们确定通量的符号。由于 $\\Delta G_{j} = 19.67\\ \\mathrm{kJ\\,mol^{-1}}$ 是正的，其符号为 $+1$。\n$$ \\mathrm{sign}(\\Delta G_{j}) = +1 $$\n通量符号的规则是：\n$$ \\mathrm{sign}(v_{j}) = -\\mathrm{sign}(\\Delta G_{j}) = -(+1) = -1 $$\n通量符号为 $-1$ 意味着 $v_{j} < 0$，这对应于反应向逆方向进行（$C \\rightarrow A + 2B$）。符号指示符 $s$ 定义为 $-1$ 表示仅有逆向通量。\n因此，$s = -1$。\n\n最终答案是一个包含计算出的 $\\Delta G_{j}$ 和符号指示符 $s$ 的行矩阵。\n$$ \\begin{pmatrix}\\Delta G_{j} & s\\end{pmatrix} = \\begin{pmatrix} 19.67 & -1 \\end{pmatrix} $$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 19.67 & -1 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在掌握了单个反应的分析后，下一步是将其扩展到整个网络层面。本练习将引导您为一个简单的线性通路构建一个完整的热力学通量平衡分析（FBA）模型 。您将实践从定义化学计量矩阵（$S$）开始，接着计算每个反应的热力学可行性以设定通量方向，最终求解受约束的优化问题，从而体验热力学如何作为过滤器，精确地塑造代谢网络的最佳通量分布。",
            "id": "3915837",
            "problem": "您的任务是将热力学约束整合到一个最小网络的流平衡分析（FBA）公式中。考虑三个内源代谢物 $A$、$B$ 和 $C$，以及四个反应 $R_{1}$ 到 $R_{4}$，它们排列在一个线性通路中，通过 $B$ 和 $C$ 将外部来源的 $A$ 转化为生物质。该网络由以下关于内源代谢物库的化学计量定义：\n- $R_{1}$：外部摄取 $A$ 生成 $A$，对于 $A$ 的化学计量系数为 $+1$，对于 $B$ 和 $C$ 为 $0$。\n- $R_{2}$：$A \\to B$ 消耗 $A$（化学计量系数为 $-1$）并生成 $B$（化学计量系数为 $+1$），对于 $C$ 为 $0$。\n- $R_{3}$：$B \\to C$ 消耗 $B$（化学计量系数为 $-1$）并生成 $C$（化学计量系数为 $+1$），对于 $A$ 为 $0$。\n- $R_{4}$：$C \\to \\text{Biomass}$ 消耗 $C$（化学计量系数为 $-1$），对于 $A$ 和 $B$ 为 $0$。\n\n使用稳态 FBA 质量平衡方程 $S v = 0$，其中 $S \\in \\mathbb{R}^{3 \\times 4}$ 是关于 $(A,B,C)$ 的化学计量矩阵，而 $v \\in \\mathbb{R}^{4}$ 是反应流。生物质目标由 $c = (0,0,0,1)^{\\top}$ 表示，优化问题是最大化 $c^{\\top} v$。\n\n通过要求每个正向不可逆反应在给定的细胞内条件下必须具有严格为负的吉布斯能量变化 $\\Delta G_{r} < 0$ 来整合热力学可行性。使用关系式 $\\Delta G_{r} = \\Delta G^{\\circ}_{r} + R T \\ln Q_{r}$，其中 $R$ 是通用气体常数，$T$ 是绝对温度，$Q_{r}$ 是由细胞内浓度导出的反应商。假设代谢物的细胞内浓度和标准化学势如下：\n- 细胞内浓度：$c_{A} = 1\\,\\mathrm{mM}$，$c_{B} = 0.1\\,\\mathrm{mM}$，$c_{C} = 0.01\\,\\mathrm{mM}$。\n- 标准化学势：$g^{\\circ}_{A} = -10\\,\\mathrm{kJ\\,mol^{-1}}$，$g^{\\circ}_{B} = -8\\,\\mathrm{kJ\\,mol^{-1}}$，$g^{\\circ}_{C} = -7\\,\\mathrm{kJ\\,mol^{-1}}$。\n- 温度：$T = 310\\,\\mathrm{K}$。\n- 通用气体常数：$R = 8.314 \\times 10^{-3}\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$。\n\n根据这些值，计算反应 $R_{2}: A \\to B$ 的 $\\Delta G_{2}$ 和反应 $R_{3}: B \\to C$ 的 $\\Delta G_{3}$；如果两者均为负，则对 $R_{2}$ 和 $R_{3}$ 强制施加正向不可逆性（即 $v_{2} \\ge 0$，$v_{3} \\ge 0$）。同样将 $R_{1}$（摄取）和 $R_{4}$（生物质形成）视为正向不可逆。流通量边界（单位为 $\\mathrm{mmol\\,gDW^{-1}\\,h^{-1}}$）如下：\n- $0 \\le v_{1} \\le 6$,\n- $0 \\le v_{2} \\le 5$,\n- $0 \\le v_{3} \\le 4$,\n- $0 \\le v_{4} \\le 100$.\n\n任务：\n- 写出如上所述的关于代谢物 $(A,B,C)$ 和反应 $(R_{1},R_{2},R_{3},R_{4})$ 的化学计量矩阵 $S$。\n- 在给定的细胞内条件下计算 $\\Delta G_{2}$ 和 $\\Delta G_{3}$，并说明其隐含的方向性约束。\n- 求解 FBA 问题 $\\max_{v} \\, c^{\\top} v$，该问题受限于 $S v = 0$ 和上述边界，并包含热力学不可逆性约束。\n以行矩阵的形式提供最优流通量向量 $v^{\\star}$，其条目为 $(v_{1}, v_{2}, v_{3}, v_{4})$。流通量以 $\\mathrm{mmol\\,gDW^{-1}\\,h^{-1}}$ 为单位表示。如果需要进行数值近似，请将答案四舍五入到 $4$ 位有效数字。",
            "solution": "该问题是一个适定的优化任务，将热力学约束整合到流平衡分析（FBA）框架中。我们将分三部分解决它：首先，构建化学计量矩阵；其次，进行热力学可行性分析；第三，求解约束优化问题。\n\n_任务1：化学计量矩阵 $S$_\n\n该系统涉及 $3$ 个内源代谢物 $(A, B, C)$ 和 $4$ 个反应 $(R_{1}, R_{2}, R_{3}, R_{4})$。化学计量矩阵 $S$ 的维度为 $3 \\times 4$，其中每一行对应一个代谢物，每一列对应一个反应。条目 $S_{ij}$ 表示代谢物 $i$ 在反应 $j$ 中的化学计量系数。根据问题描述：\n\n- $R_{1}$：外部 $\\to A$。这会生成 $A$ ($+1$)，对 $B$ 或 $C$ 没有影响。对应 $v_1$ 的列是 $(1, 0, 0)^{\\top}$。\n- $R_{2}$：$A \\to B$。这会消耗 $A$ ($-1$) 并生成 $B$ ($+1$)，对 $C$ 没有影响。对应 $v_2$ 的列是 $(-1, 1, 0)^{\\top}$。\n- $R_{3}$：$B \\to C$。这会消耗 $B$ ($-1$) 并生成 $C$ ($+1$)，对 $A$ 没有影响。对应 $v_3$ 的列是 $(0, -1, 1)^{\\top}$。\n- $R_{4}$：$C \\to \\text{Biomass}$。这会消耗 $C$ ($-1$)，对 $A$ 或 $B$ 没有影响。对应 $v_4$ 的列是 $(0, 0, -1)^{\\top}$。\n\n结合这些列，化学计量矩阵 $S$ 为：\n$$ S = \\begin{pmatrix} 1 & -1 & 0 & 0 \\\\ 0 & 1 & -1 & 0 \\\\ 0 & 0 & 1 & -1 \\end{pmatrix} $$\n\n_任务2：热力学可行性分析_\n\n我们必须计算反应 $R_{2}$ 和 $R_{3}$ 的吉布斯自由能变化（$\\Delta G_{r}$）以确认它们的方向性。控制方程是 $\\Delta G_{r} = \\Delta G^{\\circ}_{r} + R T \\ln Q_{r}$。\n\n气体常数 $R$ 和温度 $T$ 的乘积为：\n$$ RT = (8.314 \\times 10^{-3}\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}) \\times (310\\,\\mathrm{K}) \\approx 2.57734\\,\\mathrm{kJ\\,mol^{-1}} $$\n\n对于反应 $R_{2}: A \\to B$：\n标准吉布斯自由能变化为 $\\Delta G^{\\circ}_{2} = g^{\\circ}_{B} - g^{\\circ}_{A}$。\n$$ \\Delta G^{\\circ}_{2} = (-8\\,\\mathrm{kJ\\,mol^{-1}}) - (-10\\,\\mathrm{kJ\\,mol^{-1}}) = 2\\,\\mathrm{kJ\\,mol^{-1}} $$\n反应商为 $Q_{2} = \\frac{c_{B}}{c_{A}}$。\n$$ Q_{2} = \\frac{0.1\\,\\mathrm{mM}}{1\\,\\mathrm{mM}} = 0.1 $$\n因此，吉布斯自由能变化为：\n$$ \\Delta G_{2} = \\Delta G^{\\circ}_{2} + RT \\ln Q_{2} = 2\\,\\mathrm{kJ\\,mol^{-1}} + (2.57734\\,\\mathrm{kJ\\,mol^{-1}}) \\ln(0.1) $$\n$$ \\Delta G_{2} \\approx 2 + 2.57734 \\times (-2.30259) \\approx 2 - 5.9347 \\approx -3.9347\\,\\mathrm{kJ\\,mol^{-1}} $$\n保留 $4$ 位有效数字，$\\Delta G_{2} \\approx -3.935\\,\\mathrm{kJ\\,mol^{-1}}$。由于 $\\Delta G_{2} < 0$，反应 $R_{2}$ 在正向是热力学可行的。约束 $v_{2} \\ge 0$ 是合理的。\n\n对于反应 $R_{3}: B \\to C$：\n标准吉布斯自由能变化为 $\\Delta G^{\\circ}_{3} = g^{\\circ}_{C} - g^{\\circ}_{B}$。\n$$ \\Delta G^{\\circ}_{3} = (-7\\,\\mathrm{kJ\\,mol^{-1}}) - (-8\\,\\mathrm{kJ\\,mol^{-1}}) = 1\\,\\mathrm{kJ\\,mol^{-1}} $$\n反应商为 $Q_{3} = \\frac{c_{C}}{c_{B}}$。\n$$ Q_{3} = \\frac{0.01\\,\\mathrm{mM}}{0.1\\,\\mathrm{mM}} = 0.1 $$\n因此，吉布斯自由能变化为：\n$$ \\Delta G_{3} = \\Delta G^{\\circ}_{3} + RT \\ln Q_{3} = 1\\,\\mathrm{kJ\\,mol^{-1}} + (2.57734\\,\\mathrm{kJ\\,mol^{-1}}) \\ln(0.1) $$\n$$ \\Delta G_{3} \\approx 1 - 5.9347 \\approx -4.9347\\,\\mathrm{kJ\\,mol^{-1}} $$\n保留 $4$ 位有效数字，$\\Delta G_{3} \\approx -4.935\\,\\mathrm{kJ\\,mol^{-1}}$。由于 $\\Delta G_{3} < 0$，反应 $R_{3}$ 在正向也是热力学可行的。约束 $v_{3} \\ge 0$ 是合理的。\n\n问题指出 $R_{1}$ 和 $R_{4}$ 也被视为不可逆反应。因此，所有反应流都必须是非负的，这与所给的边界一致。\n\n_任务3：FBA优化_\n\nFBA 问题是在稳态质量平衡约束 $S v = 0$ 和流边界的条件下，最大化目标函数 $Z = c^{\\top}v$。\n目标向量是 $c = (0, 0, 0, 1)^{\\top}$，所以我们要最大化 $Z = v_{4}$。\n\n由 $S v = 0$ 得出的质量平衡方程为：\n$$\n\\begin{pmatrix} 1 & -1 & 0 & 0 \\\\ 0 & 1 & -1 & 0 \\\\ 0 & 0 & 1 & -1 \\end{pmatrix}\n\\begin{pmatrix} v_{1} \\\\ v_{2} \\\\ v_{3} \\\\ v_{4} \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n这产生一个线性方程组：\n1. $v_{1} - v_{2} = 0 \\implies v_{1} = v_{2}$\n2. $v_{2} - v_{3} = 0 \\implies v_{2} = v_{3}$\n3. $v_{3} - v_{4} = 0 \\implies v_{3} = v_{4}$\n\n从这些方程可以得出，在稳态下，所有流必须相等：\n$$ v_{1} = v_{2} = v_{3} = v_{4} $$\n\n设这个共同的流通量值为 $v$。问题是在所有四个反应的流通量边界下，最大化 $v_{4} = v$：\n- $0 \\le v_{1} \\le 6 \\implies 0 \\le v \\le 6$\n- $0 \\le v_{2} \\le 5 \\implies 0 \\le v \\le 5$\n- $0 \\le v_{3} \\le 4 \\implies 0 \\le v \\le 4$\n- $0 \\le v_{4} \\le 100 \\implies 0 \\le v \\le 100$\n\n为了同时满足所有这些约束，流通量 $v$ 必须小于或等于所有上边界的最小值：\n$$ v \\le \\min(6, 5, 4, 100) $$\n$$ v \\le 4 $$\n$v$ 的最大可能值，因此也是目标函数 $v_{4}$ 的最大可能值，是 $4$。这种情况发生在整个通路的流通量受限于反应 $R_{3}$ 的容量时。\n\n通过将所有流通量设置为此最大值，可以找到最优流通量向量 $v^{\\star}$：\n$$ v_{1}^{\\star} = v_{2}^{\\star} = v_{3}^{\\star} = v_{4}^{\\star} = 4 $$\n这些流通量的单位是 $\\mathrm{mmol\\,gDW^{-1}\\,h^{-1}}$。\n\n最优流通量向量是 $v^{\\star} = (4, 4, 4, 4)^{\\top}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 4 & 4 & 4 & 4 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "传统FBA的一个显著局限是它可能允许热力学上不可行的“无效循环”（futile cycles）存在，这会人为地夸大通量预测值并产生不切实际的代谢表型。本练习将通过一个计算实验，直观地展示这一问题，并演示如何利用热力学势变量来消除这些无效循环 。通过编写代码解决这个问题，您将亲身体会到热力学约束如何增强模型的生物学真实性和预测能力，这是现代代谢建模中的一个关键步骤。",
            "id": "3915819",
            "problem": "要求您形式化、分析并通过计算证明，在通量平衡模型中，如何通过增加热力学势变量及其诱导的方向性约束来消除无效循环，同时保持交换反应的真实稳态通量。请在以下最小化的、科学上现实的设定中进行操作。\n\n考虑一个包含代谢物 $A$、$B$、$C$、$D$ 的代谢网络以及以下反应（所有通量均采用任意一致的单位，并且是与时间无关的稳态值）：\n\n- 摄取：$v_0: \\varnothing \\to A$。\n- 内转换：$v_1: A \\to B$，$v_2: B \\to C$，$v_3: C \\to A$。\n- 产物生成与分泌：$v_4: B \\to D$，$v_5: D \\to \\varnothing$。\n\n设 $S$ 为内部代谢物 $A$、$B$、$C$、$D$ 的化学计量矩阵，设 $v = (v_0,v_1,v_2,v_3,v_4,v_5)^\\top$ 为反应通量向量。稳态约束是针对内部代谢物的标准质量平衡 $S\\,v = 0$，即：\n\n- $A$：$v_0 - v_1 + v_3 = 0$，\n- $B$：$v_1 - v_2 - v_4 = 0$，\n- $C$：$v_2 - v_3 = 0$，\n- $D$：$v_4 - v_5 = 0$。\n\n基线边界（无热力学方向性）为：\n- $0 \\le v_0 \\le V_{\\text{in}}$，\n- $-M \\le v_1 \\le M$，\n- $-M \\le v_2 \\le M$，\n- $-M \\le v_3 \\le M$，\n- $0 \\le v_4 \\le M$，\n- $0 \\le v_5 \\le M$，\n其中 $V_{\\text{in}}$ 和 $M$ 为给定的正参数。\n\n基线优化目标是最大化产物分泌 $v_5$。这可以被构建为一个线性规划问题，通过在上述约束条件下最小化 $-v_5$ 来实现。如果存在多个最优解都能达到相同的最大值 $v_5^\\star$，您必须执行第二个线性规划，该规划保留相同的稳态约束，并增加等式 $v_5 = v_5^\\star$，然后通过最大化 $v_2 + v_3$（即最小化 $-(v_2+v_3)$）来最大化内部循环活性。这第二步旨在揭示潜在的无效循环。\n\n为量化内部无效循环的大小，考虑两个典型的零空间生成元（通过观察平衡方程定义）：\n- 内部循环向量 $w = (0,\\,1,\\,1,\\,1,\\,0,\\,0)^\\top$，对应于闭环 $A \\to B \\to C \\to A$，无净交换。\n- 途径向量 $p = (1,\\,1,\\,0,\\,0,\\,1,\\,1)^\\top$，对应于从摄取到分泌的净转化，无内部循环。\n\n任何可行的稳态通量 $v$ 都可以唯一地分解在 $\\{w,p\\}$ 的张成空间中，形式为 $v = \\alpha\\,w + \\beta\\,p$，其中标量 $\\alpha$ 和 $\\beta$ 通过最小二乘法确定。将无效循环的大小定义为系数 $\\alpha$。\n\n现在引入热力学势及相关的方向性。设内部代谢物的化学势向量为 $\\mu = (\\mu_A,\\mu_B,\\mu_C,\\mu_D)$，单位为千焦/摩尔 (kJ/mol)。对于每个反应 $r$，反应吉布斯自由能变为 $\\Delta_r G = \\sum_i \\nu_{ir}\\,\\mu_i$，其中 $\\nu_{ir}$ 是反应 $r$ 中代谢物 $i$ 的化学计量系数（产物为正，反应物为负）。基本的热力学原理是，可行的净通量必须从高化学势指向低化学势，即如果正向反应的 $\\Delta_r G < 0$，则反应可以正向进行；而如果 $\\Delta_r G > 0$，则在稳态下不允许其作为净正向通量。我们通过收紧边界以在热力学允许的方向上施加不可逆性来编码这一点：\n- 如果书写的正向反应方向的 $\\Delta_r G < 0$，则将边界设置为 $0 \\le v_r \\le M$。\n- 如果书写的正向反应方向的 $\\Delta_r G > 0$，则将边界设置为 $-M \\le v_r \\le 0$（即只允许逆向反应）。\n- 反应 $v_0$、$v_4$、$v_5$ 保留其原始边界，其中 $v_4$ 假定在书写方向上是放能的，因此已经是正向不可逆的。\n\n使用以下固定的化学势（单位 kJ/mol）：$\\mu_A = 0$，$\\mu_B = -10$，$\\mu_C = -20$。这意味着：\n- $\\Delta_1 G = \\mu_B - \\mu_A = -10$ (正向 $A \\to B$ 允许)，\n- $\\Delta_2 G = \\mu_C - \\mu_B = -10$ (正向 $B \\to C$ 允许)，\n- $\\Delta_3 G = \\mu_A - \\mu_C = 20$ (正向 $C \\to A$ 不允许；只允许 $A \\to C$，即 $v_3 \\le 0$)。\n\n使用这些热力学方向性约束，重复两步优化过程：首先最大化 $v_5$ 得到 $v_5^{\\star,\\text{thermo}}$，然后在 $v_5 = v_5^{\\star,\\text{thermo}}$ 的条件下最大化 $v_2 + v_3$。从第二步的解中计算无效循环的大小 $\\alpha_{\\text{thermo}}$。同时，验证产物分泌的真实稳态通量是否得以保持，即在数值容差范围内检查 $v_5^\\star = v_5^{\\star,\\text{thermo}}$ 是否成立。\n\n您的程序必须通过线性规划解决基线问题和热力学约束问题，使用最小二乘法计算基 $\\{w,p\\}$ 的分解系数 $(\\alpha,\\beta)$，并报告增加热力学势前后的无效循环大小，以及产物分泌是否得以保持。\n\n用于覆盖不同情况的测试套件和参数：\n- 案例 1：$V_{\\text{in}} = 10$，$M = 100$。\n- 案例 2：$V_{\\text{in}} = 10$，$M = 15$。\n- 案例 3：$V_{\\text{in}} = 0$，$M = 50$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例贡献一个形式为 $[\\alpha_{\\text{baseline}},\\alpha_{\\text{thermo}},\\text{preserved}]$ 的子列表。例如，三个测试用例的语法有效输出形如 $[[a_1,b_1,\\text{True}],[a_2,b_2,\\text{False}],[a_3,b_3,\\text{True}]]$, 其中 $a_i$ 和 $b_i$ 是实数。不得有任何额外文本。\n\n计算中的所有数值量均无单位，化学势除外，其单位为千焦/摩尔 (kJ/mol)。不涉及角度单位或百分比值。请确保您的求解器在合理的数值容差内处理可行性和最优性。",
            "solution": "该问题要求分析一个最小的代谢网络，以证明在通量平衡分析（FBA）框架内，热力学约束如何在消除无效循环的同时，保持最优的产物生成通量。这将通过建立并求解一系列线性规划（LP）问题来完成，一次不带热力学约束，一次带有热力学约束，然后量化循环通量的变化。\n\n### 1. 模型构建\n\n该系统由四种代谢物 $\\{A, B, C, D\\}$ 和六个反应组成，其通量为 $v = (v_0, v_1, v_2, v_3, v_4, v_5)^\\top$。\n反应如下：\n- $v_0: \\varnothing \\to A$\n- $v_1: A \\to B$\n- $v_2: B \\to C$\n- $v_3: C \\to A$\n- $v_4: B \\to D$\n- $v_5: D \\to \\varnothing$\n\n稳态下的质量守恒原理规定，对于每种内部代谢物，生成它的通量之和必须等于消耗它的通量之和。这得到了线性系统 $S\\,v=0$，其中 $S$ 是内部代谢物 $A, B, C, D$ 的化学计量矩阵。\n\n质量平衡方程为：\n- 代谢物 $A$：$v_0 - v_1 + v_3 = 0$\n- 代谢物 $B$：$v_1 - v_2 - v_4 = 0$\n- 代谢物 $C$：$v_2 - v_3 = 0$\n- 代谢物 $D$：$v_4 - v_5 = 0$\n\n这可以写成矩阵形式 $S v = 0$，其中化学计量矩阵 $S$ 为：\n$$\nS = \\begin{pmatrix}\n1 & -1 & 0 & 1 & 0 & 0 \\\\\n0 & 1 & -1 & 0 & -1 & 0 \\\\\n0 & 0 & 1 & -1 & 0 & 0 \\\\\n0 & 0 & 0 & 0 & 1 & -1\n\\end{pmatrix}\n$$\n所有 $S v = 0$ 的解构成了 $S$ 的零空间。$S$ 的秩为 $4$，因此零空间的维度为 $6 - 4 = 2$。任何稳态通量向量 $v$ 都可以表示为张成该零空间的两个基向量的线性组合。问题提供了两个这样的向量：\n- 途径向量 $p = (1, 1, 0, 0, 1, 1)^\\top$，代表从底物摄取（$v_0$）到分泌产物（$v_5$）的净转化。\n- 内部循环向量 $w = (0, 1, 1, 1, 0, 0)^\\top$，代表无效循环 $A \\to B \\to C \\to A$。\n\n任何有效的通量分布 $v$ 都可以唯一地分解为 $v = \\alpha w + \\beta p$。系数 $\\alpha$ 量化了无效循环的大小。对质量平衡方程进行解析简化可以发现，对于任何稳态通量向量，都有 $v_3 = \\alpha$ 和 $v_5 = \\beta$。然而，我们将按照规定使用最小二乘法进行分解。\n\n### 2. 基线分析（无热力学约束）\n\n在基线情景中，反应 $v_1$、$v_2$ 和 $v_3$ 被认为是可逆的。该问题被构建为一个两阶段的线性规划问题。\n\n**阶段 1：最大化产物分泌**\n主要目标是最大化分泌通量 $v_5$。这等同于最小化 $-v_5$。\n- **目标：** 最小化 $c^\\top v$，其中 $c = (0, 0, 0, 0, 0, -1)^\\top$。\n- **约束：**\n    - 等式约束：$S v = 0$。\n    - 边界约束：\n        - $0 \\le v_0 \\le V_{\\text{in}}$\n        - $-M \\le v_1 \\le M$\n        - $-M \\le v_2 \\le M$\n        - $-M \\le v_3 \\le M$\n        - $0 \\le v_4 \\le M$\n        - $0 \\le v_5 \\le M$\n\n求解此线性规划问题可得到最大可能产物分泌速率 $v_5^\\star$。\n\n**阶段 2：最大化无效循环通量**\n为了揭示无效循环的潜力，我们在所有能达到最大产物生成 $v_5^\\star$ 的解中，寻找使循环活性最大化的通量分布。循环活性由 $v_2 + v_3$ 给出。\n- **目标：** 最小化 $c'^\\top v$，其中 $c' = (0, 0, -1, -1, 0, 0)^\\top$。\n- **约束：**\n    - 等式约束：$S v = 0$ 和 $v_5 = v_5^\\star$。\n    - 边界约束：与阶段 1 相同。\n\n求解此线性规划问题得到通量向量 $v_{\\text{baseline}}$。\n\n**循环量化：**\n无效循环的大小 $\\alpha_{\\text{baseline}}$ 是通过将 $v_{\\text{baseline}}$ 投影到基 $\\{w, p\\}$ 上找到的。这通过求解最小二乘问题来完成：最小化 $\\|v_{\\text{baseline}} - [\\begin{matrix} w & p \\end{matrix}] (\\alpha, \\beta)^\\top \\|_2^2$。\n\n### 3. 热力学约束分析\n\n热力学规定，反应只能沿着吉布斯自由能变为负（$\\Delta_r G < 0$）的方向进行。我们引入固定的化学势 $\\mu_A = 0$、$\\mu_B = -10$ 和 $\\mu_C = -20$ kJ/mol。\n\n内部反应的吉布斯自由能变为：\n- $v_1: A \\to B$: $\\Delta_1 G = \\mu_B - \\mu_A = -10 - 0 = -10$ kJ/mol。由于 $\\Delta_1 G < 0$，正反应是自发的，因此 $v_1 \\ge 0$。\n- $v_2: B \\to C$: $\\Delta_2 G = \\mu_C - \\mu_B = -20 - (-10) = -10$ kJ/mol。由于 $\\Delta_2 G < 0$，正反应是自发的，因此 $v_2 \\ge 0$。\n- $v_3: C \\to A$: $\\Delta_3 G = \\mu_A - \\mu_C = 0 - (-20) = 20$ kJ/mol。由于 $\\Delta_3 G > 0$，正反应是非自发的。只有逆反应（$A \\to C$）在热力学上是可行的，因此 $v_3 \\le 0$。\n\n这些热力学现实通过更新通量边界来强制执行：\n- **新边界：**\n    - $0 \\le v_1 \\le M$\n    - $0 \\le v_2 \\le M$\n    - $-M \\le v_3 \\le 0$\n    - 其他边界保持不变。\n\n使用这些新的、更紧的边界重复两阶段优化过程，以找到通量向量 $v_{\\text{thermo}}$ 及其对应的循环大小 $\\alpha_{\\text{thermo}}$。\n\n此分析的一个关键点是检查最大产物通量是否受这些额外约束的影响，即 $v_5^{\\star, \\text{thermo}} = v_5^\\star$ 是否成立。假设是，增加现实的热力学约束会消除像无效循环这样的不可行途径，而不会影响像产物生成这样的生物学相关目标。我们的分析旨在检验这一点。从质量平衡 $v_2 = v_3$ 和热力学约束 $v_2 \\ge 0$ 及 $v_3 \\le 0$ 可知，必然有 $v_2 = v_3 = 0$。这迫使循环通量为零，因此我们预期 $\\alpha_{\\text{thermo}} = 0$。\n\n### 4. 计算实现\n\n该过程为每个测试用例 $(V_{\\text{in}}, M)$ 进行编程实现。每个案例总共求解四个线性规划问题（两个用于基线分析，两个用于热力学约束分析）。使用 `scipy.optimize.linprog` 函数进行优化，使用 `numpy.linalg.lstsq` 函数进行循环分解。然后，将每个测试用例的结果——$\\alpha_{\\text{baseline}}$、$\\alpha_{\\text{thermo}}$ 以及一个指示产物分泌是否保持不变的布尔值——整理并打印出来。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # (V_in, M)\n        (10, 100),\n        (10, 15),\n        (0, 50),\n    ]\n\n    results = []\n    for V_in, M in test_cases:\n        result = _solve_case(V_in, M)\n        results.append(result)\n\n    # Format the final output string\n    output_str = \"[\" + \",\".join([f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]) + \"]\"\n    print(output_str)\n\ndef _solve_case(V_in, M):\n    \"\"\"\n    Solves the FBA problem for a single case (V_in, M).\n    \n    Returns a list: [alpha_baseline, alpha_thermo, preserved].\n    \"\"\"\n    \n    # Stoichiometric matrix S for internal metabolites A, B, C, D\n    # Sv = 0\n    #      v0  v1  v2  v3  v4  v5\n    S = np.array([\n        [1, -1,  0,  1,  0,  0],  # A\n        [0,  1, -1,  0, -1,  0],  # B\n        [0,  0,  1, -1,  0,  0],  # C\n        [0,  0,  0,  0,  1, -1]   # D\n    ])\n    \n    b_eq = np.zeros(4)\n    \n    # Nullspace basis vectors\n    w = np.array([0, 1, 1, 1, 0, 0]) # Cycle vector\n    p = np.array([1, 1, 0, 0, 1, 1]) # Pathway vector\n    A_lstsq = np.vstack([w, p]).T # Matrix for least squares: [w, p]\n\n    # --- 1. Baseline Analysis ---\n    \n    # Bounds for the baseline problem\n    bounds_baseline = [\n        (0, V_in),      # v0\n        (-M, M),        # v1\n        (-M, M),        # v2\n        (-M, M),        # v3\n        (0, M),         # v4\n        (0, M)          # v5\n    ]\n    \n    # Step 1: Maximize v5\n    c_max_v5 = np.array([0, 0, 0, 0, 0, -1])\n    res1 = linprog(c=c_max_v5, A_eq=S, b_eq=b_eq, bounds=bounds_baseline, method='highs')\n    if not res1.success:\n         # In case of infeasibility (e.g., V_in=0), set outputs to 0\n        if res1.status == 2:\n            v5_star = 0\n        else:\n            raise RuntimeError(f\"Baseline LP Step 1 failed: {res1.message}\")\n    else:\n        v5_star = res1.x[5]\n\n    # Step 2: Maximize v2 + v3 with v5 fixed to v5_star\n    c_max_cycle = np.array([0, 0, -1, -1, 0, 0])\n    # Add v5 = v5_star as an equality constraint\n    S_aug = np.vstack([S, [0, 0, 0, 0, 0, 1]])\n    b_eq_aug = np.append(b_eq, v5_star)\n    res2 = linprog(c=c_max_cycle, A_eq=S_aug, b_eq=b_eq_aug, bounds=bounds_baseline, method='highs')\n    if not res2.success:\n        if res2.status == 2: # Infeasible\n             v_baseline = np.zeros(6)\n             v_baseline[5] = v5_star\n             # Manually construct a feasible non-cycling flux if possible\n             if v5_star > 0:\n                 v_baseline = v5_star * p\n        else:\n            raise RuntimeError(f\"Baseline LP Step 2 failed: {res2.message}\")\n    else:\n        v_baseline = res2.x\n    \n    # Decompose to find alpha_baseline\n    coeffs_baseline, _, _, _ = np.linalg.lstsq(A_lstsq, v_baseline, rcond=None)\n    alpha_baseline = coeffs_baseline[0]\n\n    # --- 2. Thermodynamic Analysis ---\n    \n    # New bounds based on thermodynamic constraints\n    bounds_thermo = [\n        (0, V_in),      # v0\n        (0, M),         # v1 (A->B, dG  0)\n        (0, M),         # v2 (B->C, dG  0)\n        (-M, 0),        # v3 (C->A, dG > 0)\n        (0, M),         # v4\n        (0, M)          # v5\n    ]\n    \n    # Step 1: Maximize v5 with thermo bounds\n    res3 = linprog(c=c_max_v5, A_eq=S, b_eq=b_eq, bounds=bounds_thermo, method='highs')\n    if not res3.success:\n        if res3.status == 2:\n            v5_star_thermo = 0\n        else:\n            raise RuntimeError(f\"Thermo LP Step 1 failed: {res3.message}\")\n    else:\n        v5_star_thermo = res3.x[5]\n\n    # Step 2: Maximize v2 + v3 with v5 fixed to v5_star_thermo\n    b_eq_aug_thermo = np.append(b_eq, v5_star_thermo)\n    res4 = linprog(c=c_max_cycle, A_eq=S_aug, b_eq=b_eq_aug_thermo, bounds=bounds_thermo, method='highs')\n    if not res4.success:\n        if res4.status == 2:\n            v_thermo = np.zeros(6)\n            v_thermo[5] = v5_star_thermo\n            if v5_star_thermo > 0:\n                 v_thermo = v5_star_thermo * p\n        else:\n            raise RuntimeError(f\"Thermo LP Step 2 failed: {res4.message}\")\n    else:\n        v_thermo = res4.x\n\n    # Decompose to find alpha_thermo\n    coeffs_thermo, _, _, _ = np.linalg.lstsq(A_lstsq, v_thermo, rcond=None)\n    alpha_thermo = coeffs_thermo[0]\n    \n    # --- 3. Comparison ---\n    \n    # Check if the product secretion rate is preserved\n    preserved = np.isclose(v5_star, v5_star_thermo)\n\n    return [round(alpha_baseline, 4), round(alpha_thermo, 4), bool(preserved)]\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}