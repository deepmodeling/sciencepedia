{
    "hands_on_practices": [
        {
            "introduction": "Before integrating thermodynamics into genome-scale models, it is essential to master the core calculation for a single reaction. This exercise provides practice in computing the actual Gibbs free energy of reaction, $\\Delta G_j$, from its standard-state value and the concentrations of participating metabolites. By applying the fundamental relationship between $\\Delta G_j$ and reaction directionality, you will determine the thermodynamically feasible flux through a reaction, a critical first step in building more predictive metabolic models .",
            "id": "3915794",
            "problem": "A single intracellular reaction in a synthetic pathway is given by $A + 2B \\rightleftharpoons C$. Consider integrating thermodynamic constraints into Flux Balance Analysis (FBA; Flux Balance Analysis) using the transformed standard Gibbs free energy at pH $7$, denoted $\\Delta G_{j}^{\\circ'}$. Assume that metabolite activities are well approximated by concentrations, referenced to the standard concentration $c^{\\circ} = 1\\ \\mathrm{M}$, and define the dimensionless log-activity variables by $y_{i} = \\ln\\!\\big(a_{i}\\big) = \\ln\\!\\big(c_{i}/c^{\\circ}\\big)$ for each metabolite $i \\in \\{A,B,C\\}$. The chemical potential of metabolite $i$ is $\\mu_{i} = \\mu_{i}^{\\circ'} + RT \\ln\\!\\big(a_{i}\\big)$, where $R$ is the universal gas constant and $T$ is the absolute temperature. The reaction Gibbs energy is given by the stoichiometric sum over chemical potentials with the conventional sign convention that reactants carry negative stoichiometric coefficients and products carry positive stoichiometric coefficients. A minimal thermodynamic driving force $\\varepsilon  0$ is imposed such that any nonzero flux $v_{j}$ must satisfy the thermodynamic consistency: the sign of $v_{j}$ must be opposite to the sign of $\\Delta G_{j}$ and the magnitude must exceed the threshold $\\varepsilon$.\n\nData:\n- Transformed standard Gibbs energy: $\\Delta G_{j}^{\\circ'} = -10.0\\ \\mathrm{kJ\\,mol^{-1}}$.\n- Temperature: $T = 310\\ \\mathrm{K}$.\n- Gas constant: $R = 8.314 \\times 10^{-3}\\ \\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$.\n- Metabolite concentrations: $c_{A} = 1.0 \\times 10^{-4}\\ \\mathrm{M}$, $c_{B} = 1.0 \\times 10^{-3}\\ \\mathrm{M}$, $c_{C} = 1.0 \\times 10^{-5}\\ \\mathrm{M}$, with $c^{\\circ} = 1\\ \\mathrm{M}$, giving $y_{A} = \\ln\\!\\big(1.0 \\times 10^{-4}\\big)$, $y_{B} = \\ln\\!\\big(1.0 \\times 10^{-3}\\big)$, $y_{C} = \\ln\\!\\big(1.0 \\times 10^{-5}\\big)$.\n- Minimal driving force: $\\varepsilon = 3.0\\ \\mathrm{kJ\\,mol^{-1}}$.\n\nTasks:\n1. Using the thermodynamic definitions above and the reaction stoichiometry, compute $\\Delta G_{j}$ in $\\mathrm{kJ\\,mol^{-1}}$ at the given $T$ and metabolite activities.\n2. Decide the allowed sign of the flux $v_{j}$ under the minimal driving force $\\varepsilon$ by returning a sign indicator $s \\in \\{-1, 0, +1\\}$, where $+1$ denotes that only forward flux ($v_{j}  0$) is thermodynamically permitted, $-1$ denotes that only reverse flux ($v_{j}  0$) is thermodynamically permitted, and $0$ denotes that only zero flux ($v_{j} = 0$) is permitted under the driving force threshold.\n\nAnswer format:\n- Return a single row matrix $\\begin{pmatrix}\\Delta G_{j}  s\\end{pmatrix}$, where the first entry is the computed energy and the second entry is the sign indicator as defined above.\n- Express the energy in $\\mathrm{kJ\\,mol^{-1}}$ and round the energy to four significant figures.",
            "solution": "The problem is deemed valid as it is scientifically grounded in fundamental principles of chemical thermodynamics, well-posed with all necessary data provided, and objective in its formulation. It requests the calculation of the Gibbs free energy of a reaction and the determination of the thermodynamically feasible flux direction based on a specified driving force constraint, which is a standard procedure in metabolic modeling.\n\nThe problem asks for two quantities: the Gibbs free energy of reaction, $\\Delta G_{j}$, and a sign indicator, $s$, for the thermodynamically permissible flux, $v_{j}$.\n\nFirst, we calculate the Gibbs free energy of the reaction $A + 2B \\rightleftharpoons C$. The stoichiometric coefficients for the species are $S_{A}=-1$, $S_{B}=-2$, and $S_{C}=+1$, following the convention that reactants have negative coefficients and products have positive coefficients.\n\nThe Gibbs free energy of reaction, $\\Delta G_{j}$, is defined as the sum of the chemical potentials, $\\mu_{i}$, of the participating species, each weighted by its stoichiometric coefficient, $S_{i}$:\n$$ \\Delta G_{j} = \\sum_{i} S_{i} \\mu_{i} $$\nFor the given reaction, this expands to:\n$$ \\Delta G_{j} = (1) \\mu_{C} + (-1) \\mu_{A} + (-2) \\mu_{B} = \\mu_{C} - \\mu_{A} - 2\\mu_{B} $$\nThe chemical potential $\\mu_{i}$ for each species $i$ is given by $\\mu_{i} = \\mu_{i}^{\\circ'} + RT \\ln(a_{i})$, where $\\mu_{i}^{\\circ'}$ is the transformed standard chemical potential, $R$ is the universal gas constant, $T$ is the absolute temperature, and $a_{i}$ is the activity of species $i$. The problem states that activities can be approximated by concentrations $c_i$ relative to the standard concentration $c^{\\circ} = 1\\ \\mathrm{M}$, i.e., $a_i = c_i / c^{\\circ}$. The problem also defines dimensionless log-activity variables $y_i = \\ln(a_i)$. Therefore, the chemical potential can be written as $\\mu_{i} = \\mu_{i}^{\\circ'} + RT y_{i}$.\n\nSubstituting this expression for chemical potential into the equation for $\\Delta G_{j}$:\n$$ \\Delta G_{j} = (\\mu_{C}^{\\circ'} + RT y_{C}) - (\\mu_{A}^{\\circ'} + RT y_{A}) - 2(\\mu_{B}^{\\circ'} + RT y_{B}) $$\nGrouping the standard potential terms and the log-activity terms:\n$$ \\Delta G_{j} = (\\mu_{C}^{\\circ'} - \\mu_{A}^{\\circ'} - 2\\mu_{B}^{\\circ'}) + RT(y_{C} - y_{A} - 2y_{B}) $$\nThe term $(\\mu_{C}^{\\circ'} - \\mu_{A}^{\\circ'} - 2\\mu_{B}^{\\circ'})$ is the transformed standard Gibbs free energy of reaction, $\\Delta G_{j}^{\\circ'}$. This leads to the final expression for $\\Delta G_{j}$:\n$$ \\Delta G_{j} = \\Delta G_{j}^{\\circ'} + RT \\sum_{i} S_{i} y_{i} $$\nThe problem provides the following data: $\\Delta G_{j}^{\\circ'} = -10.0\\ \\mathrm{kJ\\,mol^{-1}}$, $R = 8.314 \\times 10^{-3}\\ \\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$, and $T = 310\\ \\mathrm{K}$. The log-activities are given by $y_{A} = \\ln(1.0 \\times 10^{-4})$, $y_{B} = \\ln(1.0 \\times 10^{-3})$, and $y_{C} = \\ln(1.0 \\times 10^{-5})$.\n\nLet's compute the term $\\sum_{i} S_{i} y_{i}$:\n$$ \\sum_{i} S_{i} y_{i} = y_{C} - y_{A} - 2y_{B} = \\ln(1.0 \\times 10^{-5}) - \\ln(1.0 \\times 10^{-4}) - 2\\ln(1.0 \\times 10^{-3}) $$\nUsing logarithm properties, $\\ln(x) - \\ln(y) = \\ln(x/y)$ and $c\\ln(x) = \\ln(x^c)$:\n$$ \\sum_{i} S_{i} y_{i} = \\ln\\left(\\frac{1.0 \\times 10^{-5}}{(1.0 \\times 10^{-4}) \\times (1.0 \\times 10^{-3})^{2}}\\right) = \\ln\\left(\\frac{10^{-5}}{10^{-4} \\times 10^{-6}}\\right) = \\ln\\left(\\frac{10^{-5}}{10^{-10}}\\right) = \\ln(10^{5}) $$\nNow we can calculate $\\Delta G_{j}$ by substituting the numerical values:\n$$ \\Delta G_{j} = -10.0\\ \\mathrm{kJ\\,mol^{-1}} + (8.314 \\times 10^{-3}\\ \\mathrm{kJ\\,mol^{-1}\\,K^{-1}}) \\times (310\\ \\mathrm{K}) \\times \\ln(10^{5}) $$\nFirst, calculate the product $RT$:\n$$ RT = (8.314 \\times 10^{-3}) \\times 310 \\approx 2.57734\\ \\mathrm{kJ\\,mol^{-1}} $$\nAnd $\\ln(10^5) = 5 \\ln(10) \\approx 5 \\times 2.302585 = 11.512925$:\n$$ \\Delta G_{j} \\approx -10.0 + (2.57734) \\times (11.512925) \\approx -10.0 + 29.67483 $$\n$$ \\Delta G_{j} \\approx 19.67483\\ \\mathrm{kJ\\,mol^{-1}} $$\nRounding to four significant figures as required, we get:\n$$ \\Delta G_{j} = 19.67\\ \\mathrm{kJ\\,mol^{-1}} $$\nThis completes the first task.\n\nFor the second task, we must determine the allowed sign of the flux $v_{j}$, represented by the indicator $s$. The thermodynamic constraint states that for a non-zero flux ($v_{j} \\neq 0$), two conditions must be met:\n1. The sign of the flux must be opposite to the sign of the Gibbs free energy of reaction: $\\mathrm{sign}(v_{j}) = -\\mathrm{sign}(\\Delta G_{j})$.\n2. The magnitude of the Gibbs free energy must exceed the minimal driving force threshold $\\varepsilon$: $|\\Delta G_{j}|  \\varepsilon$.\n\nIf $|\\Delta G_{j}| \\le \\varepsilon$, no flux is permitted, so $v_{j} = 0$ and $s=0$.\nWe have $\\Delta G_{j} \\approx 19.67\\ \\mathrm{kJ\\,mol^{-1}}$ and $\\varepsilon = 3.0\\ \\mathrm{kJ\\,mol^{-1}}$.\nFirst, check the magnitude condition:\n$$ |\\Delta G_{j}| = |19.67| = 19.67\\ \\mathrm{kJ\\,mol^{-1}} $$\nSince $19.67  3.0$, the condition $|\\Delta G_{j}|  \\varepsilon$ is satisfied. Therefore, a non-zero flux is thermodynamically possible.\n\nNext, we determine the sign of the flux. Since $\\Delta G_{j} = 19.67\\ \\mathrm{kJ\\,mol^{-1}}$ is positive, its sign is $+1$.\n$$ \\mathrm{sign}(\\Delta G_{j}) = +1 $$\nThe rule for the flux sign is:\n$$ \\mathrm{sign}(v_{j}) = -\\mathrm{sign}(\\Delta G_{j}) = -(+1) = -1 $$\nA flux sign of $-1$ means $v_{j}  0$, which corresponds to the reaction proceeding in the reverse direction ($C \\rightarrow A + 2B$). The sign indicator $s$ is defined as $-1$ for an exclusively reverse flux.\nThus, $s = -1$.\n\nThe final answer is a row matrix containing the computed $\\Delta G_{j}$ and the sign indicator $s$.\n$$ \\begin{pmatrix}\\Delta G_{j}  s\\end{pmatrix} = \\begin{pmatrix} 19.67  -1 \\end{pmatrix} $$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 19.67  -1 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "With the ability to determine the feasibility of individual reactions, we can now integrate this knowledge into a Flux Balance Analysis (FBA) framework. This practice guides you through the process for a minimal linear pathway, from constructing the stoichiometric matrix $S$ to solving for the optimal flux distribution . By performing thermodynamic calculations to justify irreversibility constraints, you will directly observe how these constraints prune the FBA solution space to reflect biological reality.",
            "id": "3915837",
            "problem": "You are tasked with integrating thermodynamic constraints into a Flux Balance Analysis (FBA) formulation for a minimal network. Consider three internal metabolites $A$, $B$, and $C$, and four reactions $R_{1}$ through $R_{4}$ arranged in a linear pathway that converts an external source of $A$ into biomass via $B$ and $C$. The network is defined by the following stoichiometries over the internal metabolite pool:\n- $R_{1}$: external uptake to $A$ produces $A$ with stoichiometric coefficient $+1$ for $A$ and $0$ for $B$ and $C$.\n- $R_{2}$: $A \\to B$ consumes $A$ with stoichiometric coefficient $-1$ and produces $B$ with stoichiometric coefficient $+1$, with $0$ for $C$.\n- $R_{3}$: $B \\to C$ consumes $B$ with stoichiometric coefficient $-1$ and produces $C$ with stoichiometric coefficient $+1$, with $0$ for $A$.\n- $R_{4}$: $C \\to \\text{Biomass}$ consumes $C$ with stoichiometric coefficient $-1$, with $0$ for $A$ and $B$.\n\nUse the steady-state FBA mass balance equations $S v = 0$, where $S \\in \\mathbb{R}^{3 \\times 4}$ is the stoichiometric matrix over $(A,B,C)$ and $v \\in \\mathbb{R}^{4}$ are reaction fluxes. The biomass objective is represented by $c = (0,0,0,1)^{\\top}$, and the optimization problem is to maximize $c^{\\top} v$.\n\nIntegrate thermodynamic feasibility by requiring that each irreversible reaction in the forward direction must have a strictly negative Gibbs energy change $\\Delta G_{r}  0$ under the given intracellular conditions. Use the relationship $\\Delta G_{r} = \\Delta G^{\\circ}_{r} + R T \\ln Q_{r}$, where $R$ is the universal gas constant and $T$ is the absolute temperature, and $Q_{r}$ is the reaction quotient derived from intracellular concentrations. Assume the following intracellular concentrations and standard chemical potentials for the metabolites:\n- Intracellular concentrations: $c_{A} = 1\\,\\mathrm{mM}$, $c_{B} = 0.1\\,\\mathrm{mM}$, $c_{C} = 0.01\\,\\mathrm{mM}$.\n- Standard chemical potentials: $g^{\\circ}_{A} = -10\\,\\mathrm{kJ\\,mol^{-1}}$, $g^{\\circ}_{B} = -8\\,\\mathrm{kJ\\,mol^{-1}}$, $g^{\\circ}_{C} = -7\\,\\mathrm{kJ\\,mol^{-1}}$.\n- Temperature: $T = 310\\,\\mathrm{K}$.\n- Universal gas constant: $R = 8.314 \\times 10^{-3}\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}$.\n\nFrom these values, compute $\\Delta G_{2}$ for $R_{2}: A \\to B$ and $\\Delta G_{3}$ for $R_{3}: B \\to C$; if both are negative, enforce irreversibility in the forward direction for $R_{2}$ and $R_{3}$ (i.e., $v_{2} \\ge 0$, $v_{3} \\ge 0$). Treat $R_{1}$ (uptake) and $R_{4}$ (biomass formation) as irreversible in the forward direction as well. The flux bounds (in $\\mathrm{mmol\\,gDW^{-1}\\,h^{-1}}$) are:\n- $0 \\le v_{1} \\le 6$,\n- $0 \\le v_{2} \\le 5$,\n- $0 \\le v_{3} \\le 4$,\n- $0 \\le v_{4} \\le 100$.\n\nTasks:\n- Write the stoichiometric matrix $S$ for metabolites $(A,B,C)$ and reactions $(R_{1},R_{2},R_{3},R_{4})$ as described.\n- Compute $\\Delta G_{2}$ and $\\Delta G_{3}$ under the given intracellular conditions, and state the implied directionality constraints.\n- Solve the FBA problem $\\max_{v} \\, c^{\\top} v$ subject to $S v = 0$ and the bounds above, incorporating the thermodynamic irreversibility constraints.\nProvide the optimal flux vector $v^{\\star}$ as a row matrix with entries $(v_{1}, v_{2}, v_{3}, v_{4})$. Express fluxes in $\\mathrm{mmol\\,gDW^{-1}\\,h^{-1}}$. If any numerical approximation is needed, round your answer to $4$ significant figures.",
            "solution": "The problem is a well-posed optimization task integrating thermodynamic constraints into a Flux Balance Analysis (FBA) framework. We will solve it in three parts: first, constructing the stoichiometric matrix; second, performing the thermodynamic feasibility analysis; and third, solving the constrained optimization problem.\n\n_Task 1: Stoichiometric Matrix $S$_\n\nThe system involves $3$ internal metabolites $(A, B, C)$ and $4$ reactions $(R_{1}, R_{2}, R_{3}, R_{4})$. The stoichiometric matrix $S$ will have dimensions $3 \\times 4$, where each row corresponds to a metabolite and each column to a reaction. The entries $S_{ij}$ represent the stoichiometric coefficient of metabolite $i$ in reaction $j$. Based on the problem description:\n\n- $R_{1}$: external $\\to A$. This produces $A$ ($+1$), with no effect on $B$ or $C$. The column for $v_1$ is $(1, 0, 0)^{\\top}$.\n- $R_{2}$: $A \\to B$. This consumes $A$ ($-1$) and produces $B$ ($+1$), with no effect on $C$. The column for $v_2$ is $(-1, 1, 0)^{\\top}$.\n- $R_{3}$: $B \\to C$. This consumes $B$ ($-1$) and produces $C$ ($+1$), with no effect on $A$. The column for $v_3$ is $(0, -1, 1)^{\\top}$.\n- $R_{4}$: $C \\to \\text{Biomass}$. This consumes $C$ ($-1$), with no effect on $A$ or $B$. The column for $v_4$ is $(0, 0, -1)^{\\top}$.\n\nCombining these columns, the stoichiometric matrix $S$ is:\n$$ S = \\begin{pmatrix} 1  -1  0  0 \\\\ 0  1  -1  0 \\\\ 0  0  1  -1 \\end{pmatrix} $$\n\n_Task 2: Thermodynamic Feasibility Analysis_\n\nWe must calculate the Gibbs free energy change ($\\Delta G_{r}$) for reactions $R_{2}$ and $R_{3}$ to confirm their directionality. The governing equation is $\\Delta G_{r} = \\Delta G^{\\circ}_{r} + R T \\ln Q_{r}$.\n\nThe product of the gas constant $R$ and temperature $T$ is:\n$$ RT = (8.314 \\times 10^{-3}\\,\\mathrm{kJ\\,mol^{-1}\\,K^{-1}}) \\times (310\\,\\mathrm{K}) \\approx 2.57734\\,\\mathrm{kJ\\,mol^{-1}} $$\n\nFor reaction $R_{2}: A \\to B$:\nThe standard Gibbs free energy change is $\\Delta G^{\\circ}_{2} = g^{\\circ}_{B} - g^{\\circ}_{A}$.\n$$ \\Delta G^{\\circ}_{2} = (-8\\,\\mathrm{kJ\\,mol^{-1}}) - (-10\\,\\mathrm{kJ\\,mol^{-1}}) = 2\\,\\mathrm{kJ\\,mol^{-1}} $$\nThe reaction quotient is $Q_{2} = \\frac{c_{B}}{c_{A}}$.\n$$ Q_{2} = \\frac{0.1\\,\\mathrm{mM}}{1\\,\\mathrm{mM}} = 0.1 $$\nThus, the Gibbs free energy change is:\n$$ \\Delta G_{2} = \\Delta G^{\\circ}_{2} + RT \\ln Q_{2} = 2\\,\\mathrm{kJ\\,mol^{-1}} + (2.57734\\,\\mathrm{kJ\\,mol^{-1}}) \\ln(0.1) $$\n$$ \\Delta G_{2} \\approx 2 + 2.57734 \\times (-2.30259) \\approx 2 - 5.9347 \\approx -3.9347\\,\\mathrm{kJ\\,mol^{-1}} $$\nTo $4$ significant figures, $\\Delta G_{2} \\approx -3.935\\,\\mathrm{kJ\\,mol^{-1}}$. Since $\\Delta G_{2}  0$, reaction $R_{2}$ is thermodynamically feasible in the forward direction. The constraint $v_{2} \\ge 0$ is justified.\n\nFor reaction $R_{3}: B \\to C$:\nThe standard Gibbs free energy change is $\\Delta G^{\\circ}_{3} = g^{\\circ}_{C} - g^{\\circ}_{B}$.\n$$ \\Delta G^{\\circ}_{3} = (-7\\,\\mathrm{kJ\\,mol^{-1}}) - (-8\\,\\mathrm{kJ\\,mol^{-1}}) = 1\\,\\mathrm{kJ\\,mol^{-1}} $$\nThe reaction quotient is $Q_{3} = \\frac{c_{C}}{c_{B}}$.\n$$ Q_{3} = \\frac{0.01\\,\\mathrm{mM}}{0.1\\,\\mathrm{mM}} = 0.1 $$\nThus, the Gibbs free energy change is:\n$$ \\Delta G_{3} = \\Delta G^{\\circ}_{3} + RT \\ln Q_{3} = 1\\,\\mathrm{kJ\\,mol^{-1}} + (2.57734\\,\\mathrm{kJ\\,mol^{-1}}) \\ln(0.1) $$\n$$ \\Delta G_{3} \\approx 1 - 5.9347 \\approx -4.9347\\,\\mathrm{kJ\\,mol^{-1}} $$\nTo $4$ significant figures, $\\Delta G_{3} \\approx -4.935\\,\\mathrm{kJ\\,mol^{-1}}$. Since $\\Delta G_{3}  0$, reaction $R_{3}$ is also thermodynamically feasible in the forward direction. The constraint $v_{3} \\ge 0$ is justified.\n\nThe problem states that $R_{1}$ and $R_{4}$ are also to be treated as irreversible. Therefore, all reaction fluxes must be non-negative, which is consistent with the provided bounds.\n\n_Task 3: FBA Optimization_\n\nThe FBA problem is to maximize the objective function $Z = c^{\\top}v$ subject to the steady-state mass balance constraint $S v = 0$ and flux bounds.\nThe objective vector is $c = (0, 0, 0, 1)^{\\top}$, so we want to maximize $Z = v_{4}$.\n\nThe mass balance equations from $S v = 0$ are:\n$$\n\\begin{pmatrix} 1  -1  0  0 \\\\ 0  1  -1  0 \\\\ 0  0  1  -1 \\end{pmatrix}\n\\begin{pmatrix} v_{1} \\\\ v_{2} \\\\ v_{3} \\\\ v_{4} \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThis yields a system of linear equations:\n1. $v_{1} - v_{2} = 0 \\implies v_{1} = v_{2}$\n2. $v_{2} - v_{3} = 0 \\implies v_{2} = v_{3}$\n3. $v_{3} - v_{4} = 0 \\implies v_{3} = v_{4}$\n\nFrom these equations, it follows that at steady state, all fluxes must be equal:\n$$ v_{1} = v_{2} = v_{3} = v_{4} $$\n\nLet this common flux value be $v$. The problem is to maximize $v_{4} = v$, subject to the flux bounds for all four reactions:\n- $0 \\le v_{1} \\le 6 \\implies 0 \\le v \\le 6$\n- $0 \\le v_{2} \\le 5 \\implies 0 \\le v \\le 5$\n- $0 \\le v_{3} \\le 4 \\implies 0 \\le v \\le 4$\n- $0 \\le v_{4} \\le 100 \\implies 0 \\le v \\le 100$\n\nTo satisfy all these constraints simultaneously, the flux $v$ must be less than or equal to the minimum of all the upper bounds:\n$$ v \\le \\min(6, 5, 4, 100) $$\n$$ v \\le 4 $$\nThe maximum possible value for $v$, and therefore for the objective function $v_{4}$, is $4$. This occurs when the flux through the entire pathway is limited by the capacity of reaction $R_{3}$.\n\nThe optimal flux vector $v^{\\star}$ is found by setting all fluxes to this maximum value:\n$$ v_{1}^{\\star} = v_{2}^{\\star} = v_{3}^{\\star} = v_{4}^{\\star} = 4 $$\nThe units for these fluxes are $\\mathrm{mmol\\,gDW^{-1}\\,h^{-1}}$.\n\nThe optimal flux vector is $v^{\\star} = (4, 4, 4, 4)^{\\top}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 4  4  4  4 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A primary motivation for integrating thermodynamic constraints into FBA is the elimination of thermodynamically infeasible futile cycles, which standard FBA often permits. This computational exercise demonstrates how introducing chemical potentials and their associated directionality constraints resolves such a cycle in a model network, without compromising the prediction of optimal production fluxes . This practice offers a powerful, hands-on illustration of how thermodynamic-FBA leads to more biologically meaningful and robust network models.",
            "id": "3915819",
            "problem": "You are asked to formalize, analyze, and computationally demonstrate how adding thermodynamic potential variables and their induced directionality constraints eliminates futile cycles in a flux balance model while preserving the true steady-state fluxes for exchange reactions. Work within the following minimal, scientifically realistic setup.\n\nConsider a metabolic network with metabolites $A$, $B$, $C$, $D$ and the following reactions (all fluxes are in arbitrary consistent units and are time-independent steady-state values):\n\n- Uptake: $v_0: \\varnothing \\to A$.\n- Internal conversions: $v_1: A \\to B$, $v_2: B \\to C$, $v_3: C \\to A$.\n- Product formation and secretion: $v_4: B \\to D$, $v_5: D \\to \\varnothing$.\n\nLet $S$ be the stoichiometric matrix for internal metabolites $A$, $B$, $C$, $D$, and let $v = (v_0,v_1,v_2,v_3,v_4,v_5)^\\top$ be the reaction flux vector. The steady-state constraints are the standard mass balances $S\\,v = 0$ for internal metabolites, i.e.,\n\n- $A$: $v_0 - v_1 + v_3 = 0$,\n- $B$: $v_1 - v_2 - v_4 = 0$,\n- $C$: $v_2 - v_3 = 0$,\n- $D$: $v_4 - v_5 = 0$.\n\nThe baseline bounds (without thermodynamic directionality) are:\n- $0 \\le v_0 \\le V_{\\text{in}}$,\n- $-M \\le v_1 \\le M$,\n- $-M \\le v_2 \\le M$,\n- $-M \\le v_3 \\le M$,\n- $0 \\le v_4 \\le M$,\n- $0 \\le v_5 \\le M$,\nwith given positive parameters $V_{\\text{in}}$ and $M$.\n\nThe baseline optimization objective is to maximize product secretion $v_5$. This can be posed as a linear program by minimizing $-v_5$ subject to the constraints above. If there are multiple optimal solutions that achieve the same maximal $v_5^\\star$, you must perform a second linear program that retains the same steady-state constraints and adds the equality $v_5 = v_5^\\star$, and then maximizes the internal cycle activity by maximizing $v_2 + v_3$ (i.e., minimize $-(v_2+v_3)$). This second step is designed to expose a potential futile cycle.\n\nTo quantify the magnitude of the internal futile cycle, consider the two canonical nullspace generators (defined by inspection of the balances):\n- The internal cycle vector $w = (0,\\,1,\\,1,\\,1,\\,0,\\,0)^\\top$ corresponding to the closed loop $A \\to B \\to C \\to A$ with no net exchange,\n- The pathway vector $p = (1,\\,1,\\,0,\\,0,\\,1,\\,1)^\\top$ corresponding to net conversion from uptake to secretion with no internal cycling.\n\nAny feasible steady-state flux $v$ can be uniquely decomposed in the span of $\\{w,p\\}$ as $v = \\alpha\\,w + \\beta\\,p$, where the scalars $\\alpha$ and $\\beta$ are determined by least squares. Define the futile cycle magnitude as the coefficient $\\alpha$.\n\nNow introduce thermodynamic potentials and the associated directionality. Let the chemical potential vector for internal metabolites be $\\mu = (\\mu_A,\\mu_B,\\mu_C,\\mu_D)$ in kilojoules per mole (kJ/mol). For each reaction $r$, the reaction Gibbs free energy change is $\\Delta_r G = \\sum_i \\nu_{ir}\\,\\mu_i$, where $\\nu_{ir}$ are the stoichiometric coefficients of metabolite $i$ in reaction $r$ (products positive, reactants negative). The fundamental thermodynamic principle is that feasible net flux must be oriented from higher to lower chemical potential, i.e., if the forward direction has $\\Delta_r G  0$ it may proceed forward, whereas a direction with $\\Delta_r G  0$ is disallowed as a net forward flux at steady state. We encode this by tightening bounds to impose irreversibility in the thermodynamically allowed direction:\n- If $\\Delta_r G  0$ in the forward written direction, set the bound to $0 \\le v_r \\le M$.\n- If $\\Delta_r G  0$ in the forward written direction, set the bound to $-M \\le v_r \\le 0$ (i.e., only the reverse direction is allowed).\n- Reactions $v_0$, $v_4$, $v_5$ retain their original bounds, with $v_4$ assumed exergonic in the written direction and thus already forward-irreversible.\n\nUse the following fixed potentials in kJ/mol: $\\mu_A = 0$, $\\mu_B = -10$, $\\mu_C = -20$. These imply\n- $\\Delta_1 G = \\mu_B - \\mu_A = -10$ (forward $A \\to B$ allowed),\n- $\\Delta_2 G = \\mu_C - \\mu_B = -10$ (forward $B \\to C$ allowed),\n- $\\Delta_3 G = \\mu_A - \\mu_C = 20$ (forward $C \\to A$ disallowed; only $A \\to C$ allowed, i.e., $v_3 \\le 0$).\n\nWith these thermodynamic directionality constraints, repeat the two-step optimization: first maximize $v_5$ to obtain $v_5^{\\star,\\text{thermo}}$, then maximize $v_2 + v_3$ under $v_5 = v_5^{\\star,\\text{thermo}}$. Compute the futile cycle magnitude $\\alpha_{\\text{thermo}}$ from the second step solution. Also verify that the true steady-state flux of product secretion is preserved, i.e., check whether $v_5^\\star = v_5^{\\star,\\text{thermo}}$ within a numerical tolerance.\n\nYour program must solve both baseline and thermodynamically constrained problems via linear programming, compute the decomposition coefficients $(\\alpha,\\beta)$ using least squares for the basis $\\{w,p\\}$, and report the futile cycle magnitude before and after adding potentials, as well as whether product secretion is preserved.\n\nTest suite and parameters to cover diverse cases:\n- Case $1$: $V_{\\text{in}} = 10$, $M = 100$.\n- Case $2$: $V_{\\text{in}} = 10$, $M = 15$.\n- Case $3$: $V_{\\text{in}} = 0$, $M = 50$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a sublist of the form $[\\alpha_{\\text{baseline}},\\alpha_{\\text{thermo}},\\text{preserved}]$. For example, a syntactically valid output for three cases looks like $[[a_1,b_1,\\text{True}],[a_2,b_2,\\text{False}],[a_3,b_3,\\text{True}]]$, where $a_i$ and $b_i$ are real numbers. There must be no additional text.\n\nAll numerical quantities inside computations are unitless except the chemical potentials, which are provided in kilojoules per mole (kJ/mol). No angle units or percentage values are involved. Ensure your solver treats feasibility and optimality within reasonable numerical tolerances.",
            "solution": "The problem requires an analysis of a minimal metabolic network to demonstrate how thermodynamic constraints eliminate futile cycles within the framework of Flux Balance Analysis (FBA) while preserving the optimal production flux. This will be accomplished by setting up and solving a series of linear programming (LP) problems, once without and once with thermodynamic constraints, and then quantifying the change in cyclic flux.\n\n### 1. Model Formulation\n\nThe system consists of four metabolites $\\{A, B, C, D\\}$ and six reactions, with fluxes $v = (v_0, v_1, v_2, v_3, v_4, v_5)^\\top$.\nThe reactions are:\n- $v_0: \\varnothing \\to A$\n- $v_1: A \\to B$\n- $v_2: B \\to C$\n- $v_3: C \\to A$\n- $v_4: B \\to D$\n- $v_5: D \\to \\varnothing$\n\nThe principle of mass conservation at steady state dictates that for each internal metabolite, the sum of fluxes producing it must equal the sum of fluxes consuming it. This gives the linear system $S\\,v=0$, where $S$ is the stoichiometric matrix for the internal metabolites $A, B, C, D$.\n\nThe mass balance equations are:\n- Metabolite $A$: $v_0 - v_1 + v_3 = 0$\n- Metabolite $B$: $v_1 - v_2 - v_4 = 0$\n- Metabolite $C$: $v_2 - v_3 = 0$\n- Metabolite $D$: $v_4 - v_5 = 0$\n\nThis can be written in matrix form, $S v = 0$, with the stoichiometric matrix $S$:\n$$\nS = \\begin{pmatrix}\n1  -1  0  1  0  0 \\\\\n0  1  -1  0  -1  0 \\\\\n0  0  1  -1  0  0 \\\\\n0  0  0  0  1  -1\n\\end{pmatrix}\n$$\nThe set of all solutions to $S v = 0$ forms the null space of $S$. The rank of $S$ is $4$, so the dimension of the null space is $6 - 4 = 2$. Any steady-state flux vector $v$ can be represented as a linear combination of two basis vectors spanning this null space. The problem provides two such vectors:\n- The pathway vector $p = (1, 1, 0, 0, 1, 1)^\\top$, representing the net conversion of substrate from uptake ($v_0$) to secreted product ($v_5$).\n- The internal cycle vector $w = (0, 1, 1, 1, 0, 0)^\\top$, representing the futile cycle $A \\to B \\to C \\to A$.\n\nAny valid flux distribution $v$ can be uniquely decomposed as $v = \\alpha w + \\beta p$. The coefficient $\\alpha$ quantifies the magnitude of the futile cycle. An analytical simplification of the mass balance equations reveals that for any steady-state flux vector, $v_3 = \\alpha$ and $v_5 = \\beta$. We will however use least squares for the decomposition as specified.\n\n### 2. Baseline Analysis (Without Thermodynamic Constraints)\n\nIn the baseline scenario, reactions $v_1$, $v_2$, and $v_3$ are considered reversible. The problem is formulated as a two-stage LP.\n\n**Stage 1: Maximize Product Secretion**\nThe primary objective is to maximize the secretion flux $v_5$. This is equivalent to minimizing $-v_5$.\n- **Objective:** Minimize $c^\\top v$ where $c = (0, 0, 0, 0, 0, -1)^\\top$.\n- **Constraints:**\n    - Equality: $S v = 0$.\n    - Bounds:\n        - $0 \\le v_0 \\le V_{\\text{in}}$\n        - $-M \\le v_1 \\le M$\n        - $-M \\le v_2 \\le M$\n        - $-M \\le v_3 \\le M$\n        - $0 \\le v_4 \\le M$\n        - $0 \\le v_5 \\le M$\n\nSolving this LP yields the maximum possible product secretion rate, $v_5^\\star$.\n\n**Stage 2: Maximize Futile Cycle Flux**\nTo expose the potential for futile cycling, we find the flux distribution that maximizes the cycle activity among all solutions that achieve the maximum production $v_5^\\star$. The cycle activity is given by $v_2 + v_3$.\n- **Objective:** Minimize $c'^\\top v$ where $c' = (0, 0, -1, -1, 0, 0)^\\top$.\n- **Constraints:**\n    - Equality: $S v = 0$ and $v_5 = v_5^\\star$.\n    - Bounds: Same as Stage $1$.\n\nSolving this LP gives the flux vector $v_{\\text{baseline}}$.\n\n**Cycle Quantification:**\nThe futile cycle magnitude $\\alpha_{\\text{baseline}}$ is found by projecting $v_{\\text{baseline}}$ onto the basis $\\{w, p\\}$. This is done by solving the least-squares problem: minimize $\\|v_{\\text{baseline}} - [\\begin{matrix} w  p \\end{matrix}] (\\alpha, \\beta)^\\top \\|_2^2$.\n\n### 3. Thermodynamically Constrained Analysis\n\nThermodynamics imposes that a reaction can only proceed in the direction of a negative Gibbs free energy change ($\\Delta_r G  0$). We introduce fixed chemical potentials $\\mu_A = 0$, $\\mu_B = -10$, and $\\mu_C = -20$ kJ/mol.\n\nThe Gibbs free energy change for the internal reactions are:\n- $v_1: A \\to B$: $\\Delta_1 G = \\mu_B - \\mu_A = -10 - 0 = -10$ kJ/mol. Since $\\Delta_1 G  0$, the forward reaction is spontaneous, thus $v_1 \\ge 0$.\n- $v_2: B \\to C$: $\\Delta_2 G = \\mu_C - \\mu_B = -20 - (-10) = -10$ kJ/mol. Since $\\Delta_2 G  0$, the forward reaction is spontaneous, thus $v_2 \\ge 0$.\n- $v_3: C \\to A$: $\\Delta_3 G = \\mu_A - \\mu_C = 0 - (-20) = 20$ kJ/mol. Since $\\Delta_3 G  0$, the forward reaction is non-spontaneous. Only the reverse reaction ($A \\to C$) is thermodynamically feasible, thus $v_3 \\le 0$.\n\nThese thermodynamic realities are enforced by updating the flux bounds:\n- **New Bounds:**\n    - $0 \\le v_1 \\le M$\n    - $0 \\le v_2 \\le M$\n    - $-M \\le v_3 \\le 0$\n    - Other bounds remain unchanged.\n\nThe two-stage optimization is repeated with these new, tighter bounds to find the flux vector $v_{\\text{thermo}}$ and its corresponding cycle magnitude $\\alpha_{\\text{thermo}}$.\n\nA key point of this analysis is to check if the maximum production flux is affected by these additional constraints, i.e., whether $v_5^{\\star, \\text{thermo}} = v_5^\\star$. The hypothesis is that adding realistic thermodynamic constraints eliminates infeasible pathways like the futile cycle without penalizing biologically relevant objectives like product formation. Our analysis is designed to test this. From the mass balance $v_2 = v_3$ and the thermodynamic constraints $v_2 \\ge 0$ and $v_3 \\le 0$, it is necessary that $v_2 = v_3 = 0$. This forces the cycle flux to zero, so we anticipate $\\alpha_{\\text{thermo}} = 0$.\n\n### 4. Computational Implementation\n\nThe procedure is implemented programmatically for each test case $(V_{\\text{in}}, M)$. Four LPs are solved in total for each case (two for baseline, two for thermo-constrained). The `scipy.optimize.linprog` function is used for optimization, and `numpy.linalg.lstsq` is used for the cycle decomposition. The results for each test case—$\\alpha_{\\text{baseline}}$, $\\alpha_{\\text{thermo}}$, and a boolean indicating if product secretion is preserved—are then collated and printed.",
            "answer": "```\n[[90.0, 0.0, True], [5.0, 0.0, True], [50.0, 0.0, True]]\n```"
        }
    ]
}