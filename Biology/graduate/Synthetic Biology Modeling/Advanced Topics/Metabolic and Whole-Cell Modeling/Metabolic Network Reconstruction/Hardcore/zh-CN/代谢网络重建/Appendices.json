{
    "hands_on_practices": [
        {
            "introduction": "化学计量矩阵（通常表示为 $S$）是代谢网络模型的数学基石。它将网络中所有生化反应的计量关系系统地编码为一个矩阵，为计算分析提供了基础。本练习  将引导你完成一个基础但至关重要的任务：将一个简单的线性代谢途径转化为其对应的化学计量矩阵，这是进行任何代谢流分析的第一步。",
            "id": "1445692",
            "problem": "在系统生物学中，代谢网络通常用数学方法表示以分析其性质。考虑一个细胞内简化的、假设的线性代谢途径。该途径负责通过两个中间化合物B和C，将外部营养物A转化为有价值的产物D。整个过程由以下三个不可逆的生化反应来描述，分别记为R1、R2和R3：\n\n反应 R1: $A \\rightarrow B$\n反应 R2: $2 B \\rightarrow C$\n反应 R3: $C \\rightarrow D$\n\n您的任务是为该代谢网络构建化学计量矩阵 $S$。该矩阵的组织方式必须使其行按A、B、C、D的顺序对应于代谢物，其列按R1、R2、R3的顺序对应于反应。请遵循标准惯例，即消耗的代谢物（反应物）的化学计量系数为负，生成的代谢物（产物）的化学计量系数为正。",
            "solution": "我们定义化学计量矩阵 $S$，使得 $S_{i,j}$ 是代谢物 $i$ 在反应 $j$ 中的化学计量系数，其中消耗的反应物取负值，生成的产物取正值。行按 $A$、$B$、$C$、$D$ 的顺序排列，列按 $\\text{R1}$、$\\text{R2}$、$\\text{R3}$ 的顺序排列。\n\n对于将 $A$ 转化为 $B$ 的反应 $\\text{R1}$，一个单位的 $A$ 被消耗，一个单位的 $B$ 被生成：\n$$\nS_{\\text{A},\\text{R1}}=-1,\\quad S_{\\text{B},\\text{R1}}=1,\\quad S_{\\text{C},\\text{R1}}=0,\\quad S_{\\text{D},\\text{R1}}=0.\n$$\n\n对于将 $2B$ 转化为 $C$ 的反应 $\\text{R2}$，两个单位的 $B$ 被消耗，一个单位的 $C$ 被生成：\n$$\nS_{\\text{A},\\text{R2}}=0,\\quad S_{\\text{B},\\text{R2}}=-2,\\quad S_{\\text{C},\\text{R2}}=1,\\quad S_{\\text{D},\\text{R2}}=0.\n$$\n\n对于将 $C$ 转化为 $D$ 的反应 $\\text{R3}$，一个单位的 $C$ 被消耗，一个单位的 $D$ 被生成：\n$$\nS_{\\text{A},\\text{R3}}=0,\\quad S_{\\text{B},\\text{R3}}=0,\\quad S_{\\text{C},\\text{R3}}=-1,\\quad S_{\\text{D},\\text{R3}}=1.\n$$\n\n将这些条目按照行 $(A,B,C,D)$ 和列 $(\\text{R1},\\text{R2},\\text{R3})$ 组合起来，得到\n$$\nS=\\begin{pmatrix}\n-1   0   0 \\\\\n1   -2   0 \\\\\n0   1   -1 \\\\\n0   0   1\n\\end{pmatrix}.\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}-1   0   0 \\\\ 1   -2   0 \\\\ 0   1   -1 \\\\ 0   0   1\\end{pmatrix}}$$"
        },
        {
            "introduction": "一个高质量的代谢网络重建必须在化学上是自洽的，这意味着每个反应都必须遵循质量和电荷守恒定律。在构建包含成百上千个反应的全基因组尺度模型时，手动检查每个反应的平衡性是不切实际的。因此，自动化验证是模型构建流程中不可或缺的质量控制环节。本练习  将让你亲手实现一个算法，用于自动检查反应的元素和电荷是否平衡，并计算出最小的修正方案，这正是模型 curation（修正与完善）中的一项核心任务。",
            "id": "3917903",
            "problem": "给定一个生化反应列表，其表示形式为带有方括号内明确离子电荷注释的物种化学式，以及左右两侧的初始整数化学计量系数。您的任务是编写一个完整的、可运行的程序，为每个反应判断其元素和电荷是否平衡，如果未平衡，则计算化学计量系数的最小整数调整值以恢复平衡。\n\n使用的基本原理和定义：\n- 质量和电荷守恒：在有效的代谢反应中，每种化学元素的总数和净离子电荷在反应的左侧和右侧之间是守恒的。这意味着对于所有元素，左侧的元素总数必须等于右侧的总数，并且电荷总和必须匹配。\n- 化学计量矩阵表示法：设存在的元素集合表示为 $E$，其中每个条目对应一个独特的化学元素（例如，$C$、$H$、$O$、$N$、$P$、$S$）以及一个用于离子电荷的附加维度。对于每个物种 $s$，定义其组成向量 $e(s) \\in \\mathbb{Z}^{|E|}$，其中每个分量给出相应元素的数量和离子电荷。设 $A_L \\in \\mathbb{Z}^{|E| \\times n_L}$ 和 $A_R \\in \\mathbb{Z}^{|E| \\times n_R}$ 分别为矩阵，其列是左侧和右侧物种的组成向量 $e(s)$。设 $x_L \\in \\mathbb{N}^{n_L}$ 和 $x_R \\in \\mathbb{N}^{n_R}$ 分别是左侧和右侧的化学计量系数向量。元素和电荷平衡要求\n$$\nA_L x_L = A_R x_R,\n$$\n或者等价地，使用 $M = [A_L \\;|\\; -A_R]$ 和 $\\mathbf{v} = \\begin{bmatrix} x_L \\\\ x_R \\end{bmatrix}$，\n$$\nM \\mathbf{v} = \\mathbf{0}.\n$$\n\n最小调整准则：\n- 给定一个初始整数化学计量向量 $\\mathbf{v}_0 = \\begin{bmatrix} x_{L,0} \\\\ x_{R,0} \\end{bmatrix}$，找到一个平衡的整数向量 $\\mathbf{v}^\\ast$，它在满足 $M \\mathbf{v}^\\ast = \\mathbf{0}$ 和对所有 $i$ 都有 $v^\\ast_i \\in \\mathbb{N}$ 的约束条件下，最小化 $\\sum_i |v^\\ast_i - v_{0,i}|$。如果出现平局（多个解具有相同的最小 $\\sum_i |v^\\ast_i - v_{0,i}|$ 值），则选择最小化 $\\sum_i v^\\ast_i$ 的那个解。为确保计算的可行性和可复现性，将搜索限制在有界整数框内\n$$\nv^\\ast_i \\in [\\max(0, v_{0,i} - B), v_{0,i} + B],\n$$\n其中 $B$ 是为每个测试用例提供的非负整数界限。\n\n化学式解析规则：\n- 物种化学式是一个字符串，如 \"C6H12O6[0]\" 或 \"NH4[+1]\"。元素由一个大写字母后跟一个可选的小写字母表示（例如，\"C\"、\"H\"、\"O\"、\"N\"）。每个元素后面可以跟一个非负整数计数；如果省略，则计数为 $1$。离子电荷在末尾的方括号中指定为 $[+z]$、$[-z]$ 或 $[0]$，其中 $z \\in \\mathbb{N}$。电荷作为 $E$ 中的一个额外守恒量。本问题中不使用括号或嵌套基团。如果方括号外出现无关字符（如加号），解析器必须忽略它们。\n- 示例：\"H2O[0]\" 的计数为 $H:2$、$O:1$，电荷为 $0$。\"NH4[+1]\" 的计数为 $N:1$、$H:4$，电荷为 $+1$。\n\n程序要求：\n- 对于每个反应，解析物种化学式以构建 $A_L$ 和 $A_R$，测试初始的 $\\mathbf{v}_0$ 是否满足 $M \\mathbf{v}_0 = \\mathbf{0}$，如果不平衡，则在指定的界限 $B$ 内搜索满足 $M \\mathbf{v}^\\ast = \\mathbf{0}$ 同时最小化上述调整准则的 $\\mathbf{v}^\\ast$。\n- 所有计算都应使用整数进行。本问题无需进行浮点单位转换。\n\n测试套件：\n为以下四个反应提供结果。每个测试用例指定了左侧和右侧的物种化学式、它们的初始化学计量系数以及用于最小调整搜索的界限 $B$。\n\n- 测试用例 1（元素不平衡的一般情况）：\n    - 左侧物种化学式：[\"C6H12O6[0]\", \"O2[0]\"]\n    - 右侧物种化学式：[\"CO2[0]\", \"H2O[0]\"]\n    - 初始化学计量系数：$x_{L,0} = [1, 6]$，$x_{R,0} = [5, 6]$\n    - 界限：$B = 2$\n- 测试用例 2（通过添加质子解决电荷不平衡）：\n    - 左侧物种化学式：[\"NH3[0]\", \"H+[+1]\"]\n    - 右侧物种化学式：[\"NH4[+1]\"]\n    - 初始化学计量系数：$x_{L,0} = [1, 0]$，$x_{R,0} = [1]$\n    - 界限：$B = 1$\n- 测试用例 3（已平衡；搜索半径为零的边界条件）：\n    - 左侧物种化学式：[\"CO2[0]\", \"H2O[0]\"]\n    - 右侧物种化学式：[\"H2CO3[0]\"]\n    - 初始化学计量系数：$x_{L,0} = [1, 1]$，$x_{R,0} = [1]$\n    - 界限：$B = 0$\n- 测试用例 4（通过添加水解决元素不平衡）：\n    - 左侧物种化学式：[\"C2H6O[0]\", \"O2[0]\"]\n    - 右侧物种化学式：[\"C2H4O2[0]\", \"H2O[0]\"]\n    - 初始化学计量系数：$x_{L,0} = [1, 1]$，$x_{R,0} = [1, 0]$\n    - 界限：$B = 1$\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。每个反应的结果必须编码为一个包含三个项目的列表：\n    - 一个布尔值，表示初始反应是否平衡。\n    - 调整后的左侧化学计量系数，以整数列表形式表示，物种顺序与提供时相同。\n    - 调整后的右侧化学计量系数，以整数列表形式表示，物种顺序与提供时相同。\n- 例如，一个有效的输出可能看起来像 \"[[true,[1,6],[6,6]],[false,[1,1],[1,1]],[true,[1,1],[1]],[false,[1,1],[1,1]]]\"。实际值必须与所提供测试套件的计算结果相对应，并且布尔值必须打印为 Python布尔字面量（\"True\" 或 \"False\"）。",
            "solution": "该问题要求基于质量和电荷守恒原理，验证并平衡生化反应。需要开发一种计算方法，用于解析化学式、构建化学计量表示、检查平衡状态，并在反应不平衡时找到化学计量系数的最小整数调整。该解决方案按一系列逻辑步骤设计。\n\n**1. 解析化学式与电荷**\n\n第一步是将每个化学物种的字符串表示（如 `\"C6H12O6[0]\"`）转换为机器可读的格式。每个物种 $s$ 由其组成向量 $e(s)$ 描述，该向量包含其构成化学元素的数量及其离子电荷。\n\n设计一个解析器来处理给定的化学式字符串。它系统地扫描字符串以识别元素符号，这些符号由一个大写字母和可选的一个小写字母组成。每个符号后应有一个整数计数；如果省略计数，则解释为 $1$。例如，在 `\"H2O\"` 中，解析器识别出 `H` 的计数为 $2$，`O` 的计数为 $1$。\n\n离子电荷在化学式末尾的方括号中指定，例如 `\"[+1]\"`、`\"[-2]\"` 或 `\"[0]\"`。解析器提取此整数值。一个反应中所有物种的所有独特元素集合，再增加一个代表“电荷”的条目，构成了组成向量的基础。对于一个涉及元素 $\\{C, H, O\\}$ 和电荷的反应，水 `H2O[0]` 的组成向量将基于一个有序基（如 $(C, H, O, \\text{Charge})$）构建，得到向量 $[0, 2, 1, 0]^T$。\n\n**2. 化学计量矩阵构建**\n\n守恒原理规定，对于一个平衡的反应，每种元素的总数和总电荷在反应物（左侧）和产物（右侧）两边必须相同。这可以表示为一个线性系统。\n\n设独特元素和电荷的集合为 $E$。对于一个有 $n_L$ 个反应物物种和 $n_R$ 个产物物种的反应，我们定义两个矩阵：$A_L \\in \\mathbb{Z}^{|E| \\times n_L}$ 和 $A_R \\in \\mathbb{Z}^{|E| \\times n_R}$。$A_L$ 和 $A_R$ 的列分别是左侧和右侧物种的组成向量 $e(s)$。设 $x_L \\in \\mathbb{N}^{n_L}$ 和 $x_R \\in \\mathbb{N}^{n_R}$ 分别是反应物和产物的化学计量系数向量。平衡条件是：\n$$\nA_L x_L = A_R x_R\n$$\n此方程表明反应物的总元素和电荷组成等于产物的总组成。它可以改写为齐次线性系统的形式：\n$$\nA_L x_L - A_R x_R = 0\n$$\n通过定义一个复合化学计量矩阵 $M = [A_L \\; | \\; -A_R] \\in \\mathbb{Z}^{|E| \\times (n_L + n_R)}$ 和一个复合系数向量 $\\mathbf{v} = \\begin{bmatrix} x_L \\\\ x_R \\end{bmatrix} \\in \\mathbb{N}^{n_L + n_R}$，平衡方程简化为：\n$$\nM \\mathbf{v} = \\mathbf{0}\n$$\n任何满足此方程且分量为非负整数的向量 $\\mathbf{v}$ 都代表一个化学计量平衡的反应。\n\n**3. 初始平衡验证**\n\n给定一组初始化学计量系数 $\\mathbf{v}_0 = \\begin{bmatrix} x_{L,0} \\\\ x_{R,0} \\end{bmatrix}$，通过检查是否满足 $M \\mathbf{v}_0 = \\mathbf{0}$ 来确定反应的初始平衡状态。如果矩阵向量乘法的结果是零向量，则反应是平衡的。否则，它是不平衡的。\n\n**4. 最小调整搜索**\n\n如果初始状态 $\\mathbf{v}_0$ 不平衡，任务是找到一个调整后的非负整数向量 $\\mathbf{v}^\\ast$，它满足平衡条件 $M \\mathbf{v}^\\ast = \\mathbf{0}$ 并最小化一个指定的成本函数。对 $\\mathbf{v}^\\ast$ 的搜索被限制在一个由给定搜索半径 $B \\ge 0$ 定义的有界整数框内。对于每个系数 $v_i$，搜索范围是：\n$$\nv_i \\in [\\max(0, v_{0,i} - B), \\, v_{0,i} + B]\n$$\n这定义了一个有限的、多维的候选向量 $\\mathbf{v}$ 网格。在此网格上执行系统性的穷举搜索。\n\n对于搜索框内的每个候选向量 $\\mathbf{v}$，我们首先验证它是否满足平衡条件 $M\\mathbf{v}=\\mathbf{0}$。如果满足，它就是一个有效的解。在所有有效解中，我们基于一个双层优化准则来寻找最优解 $\\mathbf{v}^\\ast$：\n1.  **主要准则**：最小化调整向量的L1范数，定义为 $C_1(\\mathbf{v}) = \\sum_i |v_i - v_{0,i}|$。这会找到在系数绝对变化总和方面与初始状态“最接近”的平衡状态。\n2.  **次要准则（决胜条件）**：如果有多个向量产生相同的最小调整距离 $C_1$，则选择那个最小化解向量本身的L1范数 $C_2(\\mathbf{v}) = \\sum_i v_i$ 的向量。这倾向于选择总体化学计量数较小的反应，以促进简洁性。\n\n搜索算法如下进行：\n- 将迄今找到的最小调整距离初始化为无穷大。\n- 遍历已定义搜索框内的每个可能的整数向量 $\\mathbf{v}$。\n- 对于每个 $\\mathbf{v}$：\n    - 检查是否 $M\\mathbf{v} = \\mathbf{0}$。如果不满足，则舍弃 $\\mathbf{v}$。\n    - 如果平衡，计算 $d_1 = \\sum_i |v_i - v_{0,i}|$。\n    - 将 $d_1$ 与当前的最小距离进行比较。\n        - 如果 $d_1$ 小于最小值，则此 $\\mathbf{v}$ 成为新的最佳候选 $\\mathbf{v}^\\ast$。更新最小距离和决胜值 $d_2 = \\sum_i v_i$。\n        - 如果 $d_1$ 等于最小值，则计算 $d_2 = \\sum_i v_i$ 并与存储的决胜值进行比较。如果 $d_2$ 更小，则 $\\mathbf{v}$ 成为新的最佳候选 $\\mathbf{v}^\\ast$。\n\n在完全探索搜索空间后，得到的 $\\mathbf{v}^\\ast$ 就是最小调整的平衡化学计量向量。如果初始反应已经平衡，则跳过调整搜索，并将初始向量 $\\mathbf{v}_0$ 视为最终结果。然后将最终输出格式化为表示初始平衡状态的布尔值，后跟与最终状态对应的左侧和右侧系数向量。",
            "answer": "```python\nimport numpy as np\nimport re\nfrom itertools import product\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final output.\n    \"\"\"\n    test_cases = [\n        {\n            \"left_species\": [\"C6H12O6[0]\", \"O2[0]\"],\n            \"right_species\": [\"CO2[0]\", \"H2O[0]\"],\n            \"x_L0\": [1, 6],\n            \"x_R0\": [5, 6],\n            \"B\": 2,\n        },\n        {\n            \"left_species\": [\"NH3[0]\", \"H+[+1]\"],\n            \"right_species\": [\"NH4[+1]\"],\n            \"x_L0\": [1, 0],\n            \"x_R0\": [1],\n            \"B\": 1,\n        },\n        {\n            \"left_species\": [\"CO2[0]\", \"H2O[0]\"],\n            \"right_species\": [\"H2CO3[0]\"],\n            \"x_L0\": [1, 1],\n            \"x_R0\": [1],\n            \"B\": 0,\n        },\n        {\n            \"left_species\": [\"C2H6O[0]\", \"O2[0]\"],\n            \"right_species\": [\"C2H4O2[0]\", \"H2O[0]\"],\n            \"x_L0\": [1, 1],\n            \"x_R0\": [1, 0],\n            \"B\": 1,\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        is_balanced_initially, final_coeffs_l, final_coeffs_r = process_reaction(\n            case[\"left_species\"], case[\"right_species\"],\n            case[\"x_L0\"], case[\"x_R0\"], case[\"B\"]\n        )\n        # Format the result string for this case as per problem requirements\n        result_str = (\n            f\"[{str(is_balanced_initially)},{str(final_coeffs_l)},\"\n            f\"{str(final_coeffs_r)}]\"\n        ).replace(\" \", \"\")\n        results.append(result_str)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\n\ndef parse_formula(formula):\n    \"\"\"\n    Parses a chemical formula string into a dictionary of element counts and charge.\n    Example: \"C6H12O6[0]\" - {'C': 6, 'H': 12, 'O': 6, 'Charge': 0}\n    \"\"\"\n    composition = {}\n    \n    # Extract charge\n    charge_match = re.search(r'\\[([+-]?\\d+)\\]', formula)\n    if charge_match:\n        composition['Charge'] = int(charge_match.group(1))\n        formula = formula[:charge_match.start()]\n    else:\n        # Assume charge 0 if not specified, though problem implies it always is\n        composition['Charge'] = 0\n\n    # Extract elements and their counts\n    element_matches = re.findall(r'([A-Z][a-z]?)(\\d*)', formula)\n    for element, count_str in element_matches:\n        count = int(count_str) if count_str else 1\n        composition[element] = composition.get(element, 0) + count\n        \n    return composition\n\ndef process_reaction(left_species, right_species, x_L0, x_R0, B):\n    \"\"\"\n    Analyzes a single reaction for balance and performs minimal adjustment if needed.\n    \"\"\"\n    all_species = left_species + right_species\n    compositions = [parse_formula(s) for s in all_species]\n\n    # Establish the basis of elements and charge\n    all_elements = set()\n    for comp in compositions:\n        all_elements.update(comp.keys())\n    \n    # Create a consistent order for elements\n    element_order = sorted([el for el in all_elements if el != 'Charge']) + ['Charge']\n    element_map = {el: i for i, el in enumerate(element_order)}\n    num_elements = len(element_order)\n\n    # Build the stoichiometric matrix M\n    num_left = len(left_species)\n    num_right = len(right_species)\n    num_total_species = num_left + num_right\n    M = np.zeros((num_elements, num_total_species), dtype=np.int64)\n\n    for i, comp in enumerate(compositions):\n        for element, count in comp.items():\n            row_idx = element_map[element]\n            sign = 1 if i  num_left else -1\n            M[row_idx, i] = sign * count\n    \n    v0 = np.array(x_L0 + x_R0, dtype=np.int64)\n\n    # Check initial balance\n    is_balanced_initially = np.all(np.dot(M, v0) == 0)\n\n    if is_balanced_initially:\n        return True, x_L0, x_R0\n\n    # If not balanced, search for the minimal adjustment\n    # Define search space for v\n    search_ranges = []\n    for i in range(num_total_species):\n        lower_bound = max(0, v0[i] - B)\n        upper_bound = v0[i] + B\n        search_ranges.append(range(lower_bound, upper_bound + 1))\n\n    best_v = None\n    min_adj_dist = float('inf')\n    min_v_sum = float('inf')\n\n    # Iterate through all candidate vectors in the search box\n    for v_tuple in product(*search_ranges):\n        v = np.array(v_tuple, dtype=np.int64)\n\n        # Check for balance\n        if np.all(np.dot(M, v) == 0):\n            adj_dist = np.sum(np.abs(v - v0))\n            v_sum = np.sum(v)\n\n            if adj_dist  min_adj_dist:\n                min_adj_dist = adj_dist\n                min_v_sum = v_sum\n                best_v = v\n            elif adj_dist == min_adj_dist:\n                if v_sum  min_v_sum:\n                    min_v_sum = v_sum\n                    best_v = v\n\n    final_coeffs_l = list(best_v[:num_left])\n    final_coeffs_r = list(best_v[num_left:])\n\n    return False, final_coeffs_l, final_coeffs_r\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "化学计量关系定义了哪些反应是“可能”发生的，而热力学则决定了在特定条件下哪些反应是“自发”的。通过整合热力学数据，我们可以为模型中的反应指定方向性（不可逆或可逆），从而大大缩小可行解空间，提高模型的预测准确性。本练习  将指导你如何综合利用吉布斯自由能（$\\Delta G'$）的估算值、其不确定性以及代谢物浓度范围，来科学地判断一个反应的方向性，并为其分配相应的通量边界。",
            "id": "3918023",
            "problem": "您正在重建一个代谢网络，必须根据热力学信息推断反应的方向性。其基本基础是化学热力学和化学计量质量作用，并假设在稀溶液中活度等于浓度。使用生化反应的转换吉布斯能量和反应商来推导每个反应的可行通量方向，然后相应地分配化学计量通量界限。\n\n给定一个反应，其中代谢物 $i$ 的化学计量系数为 $\\nu_i$（反应物为负，产物为正），生化条件下的转换吉布斯反应能量为\n$$\n\\Delta G' = \\Delta G^\\circ' + RT \\ln Q,\n$$\n其中 $Q = \\prod_i c_i^{\\nu_i}$，$c_i$ 是代谢物 $i$ 的浓度，$R$ 是气体常数，$T$ 是绝对温度。组分贡献法 (Component Contribution, CC) 提供了 $\\Delta G^\\circ'$ 的估计值，其平均值为 $\\mu$，标准差为 $\\sigma$。为了做出稳健的方向性决策，使用 $z = 1.96$ 的 $95\\%$ 置信区间，因此 $\\Delta G^\\circ'$ 位于 $[\\mu - z\\sigma, \\mu + z\\sigma]$ 内。\n\n对于代谢物浓度范围 $[c_{i,\\min}, c_{i,\\max}]$，定义\n$$\nS = \\sum_i \\nu_i \\ln c_i.\n$$\n因为 $S$ 在 $\\ln c_i$ 上是线性的，其在给定范围内的极值出现在区间端点：\n- 对于 $S_{\\min}$，当 $\\nu_i \\ge 0$ 时使用 $\\ln c_{i,\\min}$，当 $\\nu_i  0$ 时使用 $\\ln c_{i,\\max}$。\n- 对于 $S_{\\max}$，当 $\\nu_i \\ge 0$ 时使用 $\\ln c_{i,\\max}$，当 $\\nu_i  0$ 时使用 $\\ln c_{i,\\min}$。\n\n那么转换吉布斯能量的稳健界限是\n$$\n\\Delta G'_{\\min} = (\\mu - z\\sigma) + RT\\,S_{\\min}, \\quad \\Delta G'_{\\max} = (\\mu + z\\sigma) + RT\\,S_{\\max}.\n$$\n\n方向性规则：\n- 如果 $\\Delta G'_{\\max}  0$，则反应仅为正向（在所有不确定性和范围内，正向反应均为放能反应），分配 $v_{\\min} = 0$ 和 $v_{\\max} = V_{\\text{bound}}$。\n- 如果 $\\Delta G'_{\\min}  0$，则反应仅为逆向（在所有不确定性和范围内，逆向反应均为放能反应），分配 $v_{\\min} = -V_{\\text{bound}}$ 和 $v_{\\max} = 0$。\n- 否则，反应是可逆的，分配 $v_{\\min} = -V_{\\text{bound}}$ 和 $v_{\\max} = V_{\\text{bound}}$。\n\n使用 $R = 8.314 \\times 10^{-3}$ kJ mol$^{-1}$ K$^{-1}$，$T = 298.15$ K，以及 $V_{\\text{bound}} = 1000$ mmol gDW$^{-1}$ h$^{-1}$。通量界限 $v_{\\min}$ 和 $v_{\\max}$ 必须以 mmol gDW$^{-1}$ h$^{-1}$ 为单位表示为整数。\n\n实现一个程序，为下面的每个测试案例，使用上述规则计算 $\\Delta G'_{\\min}$ 和 $\\Delta G'_{\\max}$，然后相应地分配 $v_{\\min}$ 和 $v_{\\max}$。\n\n测试套件（每个案例提供化学计量、CC 参数和浓度范围；浓度单位为 M）：\n- 案例 1（理想路径，预期为仅正向）：反应 $A + B \\rightarrow C$。化学计量：$\\nu_A = -1$, $\\nu_B = -1$, $\\nu_C = +1$。CC 参数：$\\mu = -30$ kJ mol$^{-1}$, $\\sigma = 2$ kJ mol$^{-1}$。浓度范围：$A: [10^{-4}, 10^{-3}]$, $B: [10^{-4}, 10^{-3}]$, $C: [10^{-6}, 10^{-5}]$。\n- 案例 2（预期为仅逆向）：反应 $C \\rightarrow A + B$。化学计量：$\\nu_C = -1$, $\\nu_A = +1$, $\\nu_B = +1$。CC 参数：$\\mu = 25$ kJ mol$^{-1}$, $\\sigma = 1$ kJ mol$^{-1}$。浓度范围：$A: [10^{-4}, 10^{-3}]$, $B: [10^{-4}, 10^{-3}]$, $C: [10^{-6}, 10^{-5}]$。\n- 案例 3（预期为可逆）：反应 $A \\rightarrow B$。化学计量：$\\nu_A = -1$, $\\nu_B = +1$。CC 参数：$\\mu = 0$ kJ mol$^{-1}$, $\\sigma = 2$ kJ mol$^{-1}$。浓度范围：$A: [10^{-4}, 10^{-3}]$, $B: [10^{-4}, 10^{-3}]$。\n- 案例 4（边缘化学计量，预期为仅正向）：反应 $2A + B \\rightarrow 3C$。化学计量：$\\nu_A = -2$, $\\nu_B = -1$, $\\nu_C = +3$。CC 参数：$\\mu = -5$ kJ mol$^{-1}$, $\\sigma = 0.5$ kJ mol$^{-1}$。浓度范围：$A: [10^{-6}, 10^{-4}]$, $B: [10^{-6}, 10^{-3}]$, $C: [10^{-9}, 10^{-6}]$。\n\n要求的最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个结果是对应案例的 $[v_{\\min}, v_{\\max}]$ 对，不含空格。例如：$[[0,1000],[-1000,0],[-1000,1000],[0,1000]]$。",
            "solution": "问题陈述在科学上是合理的、定义明确的，并提供了所有必要信息以根据热力学原理确定反应方向性。所概述的方法是计算系统生物学中基于热力学的通量平衡分析的标准方法，其中通过计算反应的吉布斯自由能的可能范围来处理热力学数据和代谢物浓度的不确定性。所有常数、方程和参数都已提供，并且与已有的科学文献一致。因此，该问题被认为是有效的。\n\n核心原则是评估生化反应在一定生理条件范围内的自发性。如果一个反应的转换吉布斯自由能 $\\Delta G'$ 为负，则该反应是自发的（即，可以沿正向进行）。方向性是通过评估在所有可能条件下 $\\Delta G'$ 的符号来确定的，这些条件由标准吉布斯能量估计的不确定性和代谢物浓度范围定义。\n\n控制方程为：\n$$\n\\Delta G' = \\Delta G^\\circ' + RT \\ln Q\n$$\n其中 $\\Delta G^\\circ'$ 是标准转换吉布斯反应能量，$R$ 是气体常数（$8.314 \\times 10^{-3}$ kJ mol$^{-1}$ K$^{-1}$），$T$ 是绝对温度（$298.15$ K），$Q$ 是反应商，定义为 $Q = \\prod_i c_i^{\\nu_i}$。这里，$c_i$ 是代谢物 $i$ 的浓度，$\\nu_i$ 是其化学计量系数（反应物为负，产物为正）。\n\n项 $RT \\ln Q$可以展开为 $RT \\sum_i \\nu_i \\ln c_i$。我们得到了标准吉布斯能量的范围 $\\Delta G^\\circ' \\in [\\mu - z\\sigma, \\mu + z\\sigma]$（其中 $z = 1.96$）以及每个代谢物浓度的范围 $c_i \\in [c_{i,\\min}, c_{i,\\max}]$。为了找到 $\\Delta G'$ 的整体范围，我们必须找到项 $S = \\sum_i \\nu_i \\ln c_i$ 的最小值和最大值。\n\n$S$ 的极值是通过为每个代谢物选择适当的浓度端点来找到的。\n为了找到 $S_{\\min}$：\n- 对于产物（$\\nu_i  0$），当 $c_i$ 最小时，项 $\\nu_i \\ln c_i$ 最小化，所以我们使用 $c_{i,\\min}$。\n- 对于反应物（$\\nu_i  0$），当 $c_i$ 最大时，项 $\\nu_i \\ln c_i = -|\\nu_i| \\ln c_i$ 最小化（变为最负），所以我们使用 $c_{i,\\max}$。\n\n为了找到 $S_{\\max}$：\n- 对于产物（$\\nu_i  0$），当 $c_i$ 最大时，项 $\\nu_i \\ln c_i$ 最大化，所以我们使用 $c_{i,\\max}$。\n- 对于反应物（$\\nu_i  0$），当 $c_i$ 最小时，项 $\\nu_i \\ln c_i = -|\\nu_i| \\ln c_i$ 最大化（变为最不负），所以我们使用 $c_{i,\\min}$。\n\n这些规则与问题陈述中提供的定义一致。$\\Delta G'$ 的整体最小值和最大值则由以下公式给出：\n$$\n\\Delta G'_{\\min} = (\\mu - z\\sigma) + RT\\,S_{\\min}\n$$\n$$\n\\Delta G'_{\\max} = (\\mu + z\\sigma) + RT\\,S_{\\max}\n$$\n通量界限 $[v_{\\min}, v_{\\max}]$ 根据此范围的符号进行分配，其大小为 $V_{\\text{bound}} = 1000$。分配规则是：\n- 仅正向：如果 $\\Delta G'_{\\max}  0$，则 $[v_{\\min}, v_{\\max}] = [0, 1000]$。\n- 仅逆向：如果 $\\Delta G'_{\\min}  0$，则 $[v_{\\min}, v_{\\max}] = [-1000, 0]$。\n- 可逆：否则，$[v_{\\min}, v_{\\max}] = [-1000, 1000]$。\n\n常数乘积 $RT = (8.314 \\times 10^{-3}) \\times 298.15 \\approx 2.47895$ kJ mol$^{-1}$。\n\n**案例 1: $A + B \\rightarrow C$**\n- 化学计量：$\\nu_A = -1$, $\\nu_B = -1$, $\\nu_C = +1$。\n- 参数：$\\mu = -30$ kJ mol$^{-1}$, $\\sigma = 2$ kJ mol$^{-1}$。\n- 浓度 (M)：$c_A, c_B \\in [10^{-4}, 10^{-3}]$, $c_C \\in [10^{-6}, 10^{-5}]$。\n- $\\Delta G^\\circ'$ 区间：$[-30 - 1.96 \\cdot 2, -30 + 1.96 \\cdot 2] = [-33.92, -26.08]$。\n- $S_{\\min} = \\nu_C \\ln c_{C,\\min} + \\nu_A \\ln c_{A,\\max} + \\nu_B \\ln c_{B,\\max} = \\ln(10^{-6}) - \\ln(10^{-3}) - \\ln(10^{-3}) = \\ln\\left(\\frac{10^{-6}}{10^{-3} \\cdot 10^{-3}}\\right) = \\ln(1) = 0$。\n- $S_{\\max} = \\nu_C \\ln c_{C,\\max} + \\nu_A \\ln c_{A,\\min} + \\nu_B \\ln c_{B,\\min} = \\ln(10^{-5}) - \\ln(10^{-4}) - \\ln(10^{-4}) = \\ln\\left(\\frac{10^{-5}}{10^{-4} \\cdot 10^{-4}}\\right) = \\ln(1000) \\approx 6.908$。\n- $\\Delta G'_{\\min} = -33.92 + RT \\cdot 0 = -33.92$ kJ mol$^{-1}$。\n- $\\Delta G'_{\\max} = -26.08 + RT \\cdot \\ln(1000) \\approx -26.08 + 17.122 = -8.958$ kJ mol$^{-1}$。\n- 由于 $\\Delta G'_{\\max}  0$，该反应仅为正向。$v_{\\min}=0, v_{\\max}=1000$。\n\n**案例 2: $C \\rightarrow A + B$**\n- 化学计量：$\\nu_C = -1$, $\\nu_A = +1$, $\\nu_B = +1$。\n- 参数：$\\mu = 25$ kJ mol$^{-1}$, $\\sigma = 1$ kJ mol$^{-1}$。\n- 浓度 (M)：$c_C \\in [10^{-6}, 10^{-5}]$, $c_A, c_B \\in [10^{-4}, 10^{-3}]$。\n- $\\Delta G^\\circ'$ 区间：$[25 - 1.96 \\cdot 1, 25 + 1.96 \\cdot 1] = [23.04, 26.96]$。\n- $S_{\\min} = \\nu_A \\ln c_{A,\\min} + \\nu_B \\ln c_{B,\\min} + \\nu_C \\ln c_{C,\\max} = \\ln(10^{-4}) + \\ln(10^{-4}) - \\ln(10^{-5}) = \\ln\\left(\\frac{10^{-4} \\cdot 10^{-4}}{10^{-5}}\\right) = \\ln(0.001) \\approx -6.908$。\n- $S_{\\max} = \\nu_A \\ln c_{A,\\max} + \\nu_B \\ln c_{B,\\max} + \\nu_C \\ln c_{C,\\min} = \\ln(10^{-3}) + \\ln(10^{-3}) - \\ln(10^{-6}) = \\ln\\left(\\frac{10^{-3} \\cdot 10^{-3}}{10^{-6}}\\right) = \\ln(1) = 0$。\n- $\\Delta G'_{\\min} = 23.04 + RT \\cdot \\ln(0.001) \\approx 23.04 - 17.122 = 5.918$ kJ mol$^{-1}$。\n- $\\Delta G'_{\\max} = 26.96 + RT \\cdot 0 = 26.96$ kJ mol$^{-1}$。\n- 由于 $\\Delta G'_{\\min}  0$，该反应仅为逆向。$v_{\\min}=-1000, v_{\\max}=0$。\n\n**案例 3: $A \\rightarrow B$**\n- 化学计量：$\\nu_A = -1$, $\\nu_B = +1$。\n- 参数：$\\mu = 0$ kJ mol$^{-1}$, $\\sigma = 2$ kJ mol$^{-1}$。\n- 浓度 (M)：$c_A, c_B \\in [10^{-4}, 10^{-3}]$。\n- $\\Delta G^\\circ'$ 区间：$[0 - 1.96 \\cdot 2, 0 + 1.96 \\cdot 2] = [-3.92, 3.92]$。\n- $S_{\\min} = \\nu_B \\ln c_{B,\\min} + \\nu_A \\ln c_{A,\\max} = \\ln(10^{-4}) - \\ln(10^{-3}) = \\ln\\left(\\frac{10^{-4}}{10^{-3}}\\right) = \\ln(0.1) \\approx -2.303$。\n- $S_{\\max} = \\nu_B \\ln c_{B,\\max} + \\nu_A \\ln c_{A,\\min} = \\ln(10^{-3}) - \\ln(10^{-4}) = \\ln\\left(\\frac{10^{-3}}{10^{-4}}\\right) = \\ln(10) \\approx 2.303$。\n- $\\Delta G'_{\\min} = -3.92 + RT \\cdot \\ln(0.1) \\approx -3.92 - 5.708 = -9.628$ kJ mol$^{-1}$。\n- $\\Delta G'_{\\max} = 3.92 + RT \\cdot \\ln(10) \\approx 3.92 + 5.708 = 9.628$ kJ mol$^{-1}$。\n- 由于 $\\Delta G'_{\\min}  0$ 且 $\\Delta G'_{\\max}  0$，该反应是可逆的。$v_{\\min}=-1000, v_{\\max}=1000$。\n\n**案例 4: $2A + B \\rightarrow 3C$**\n- 化学计量：$\\nu_A = -2$, $\\nu_B = -1$, $\\nu_C = +3$。\n- 参数：$\\mu = -5$ kJ mol$^{-1}$, $\\sigma = 0.5$ kJ mol$^{-1}$。\n- 浓度 (M)：$c_A \\in [10^{-6}, 10^{-4}]$, $c_B \\in [10^{-6}, 10^{-3}]$, $c_C \\in [10^{-9}, 10^{-6}]$。\n- $\\Delta G^\\circ'$ 区间：$[-5 - 1.96 \\cdot 0.5, -5 + 1.96 \\cdot 0.5] = [-5.98, -4.02]$。\n- $S_{\\min} = 3 \\ln c_{C,\\min} - 2 \\ln c_{A,\\max} - 1 \\ln c_{B,\\max} = 3\\ln(10^{-9}) - 2\\ln(10^{-4}) - \\ln(10^{-3}) = \\ln\\left(\\frac{(10^{-9})^3}{(10^{-4})^2(10^{-3})}\\right) = \\ln(10^{-16}) \\approx -36.84$。\n- $S_{\\max} = 3 \\ln c_{C,\\max} - 2 \\ln c_{A,\\min} - 1 \\ln c_{B,\\min} = 3\\ln(10^{-6}) - 2\\ln(10^{-6}) - \\ln(10^{-6}) = \\ln\\left(\\frac{(10^{-6})^3}{(10^{-6})^2(10^{-6})}\\right) = \\ln(1) = 0$。\n- $\\Delta G'_{\\min} = -5.98 + RT \\cdot \\ln(10^{-16}) \\approx -5.98 - 91.326 = -97.306$ kJ mol$^{-1}$。\n- $\\Delta G'_{\\max} = -4.02 + RT \\cdot 0 = -4.02$ kJ mol$^{-1}$。\n- 由于 $\\Delta G'_{\\max}  0$，该反应仅为正向。$v_{\\min}=0, v_{\\max}=1000$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates reaction directionality based on thermodynamic information\n    for a set of test cases.\n    \"\"\"\n    \n    # Define constants\n    R = 8.314e-3  # Gas constant in kJ mol^-1 K^-1\n    T = 298.15    # Absolute temperature in K\n    z = 1.96      # Z-score for 95% confidence interval\n    V_bound = 1000 # Flux bound in mmol gDW^-1 h^-1\n\n    # Test cases as provided in the problem statement\n    test_cases = [\n        # Case 1: A + B - C\n        {\n            'stoichiometry': {'A': -1, 'B': -1, 'C': 1},\n            'params': {'mu': -30, 'sigma': 2},\n            'concentrations': {\n                'A': [1e-4, 1e-3],\n                'B': [1e-4, 1e-3],\n                'C': [1e-6, 1e-5]\n            }\n        },\n        # Case 2: C - A + B\n        {\n            'stoichiometry': {'C': -1, 'A': 1, 'B': 1},\n            'params': {'mu': 25, 'sigma': 1},\n            'concentrations': {\n                'A': [1e-4, 1e-3],\n                'B': [1e-4, 1e-3],\n                'C': [1e-6, 1e-5]\n            }\n        },\n        # Case 3: A - B\n        {\n            'stoichiometry': {'A': -1, 'B': 1},\n            'params': {'mu': 0, 'sigma': 2},\n            'concentrations': {\n                'A': [1e-4, 1e-3],\n                'B': [1e-4, 1e-3]\n            }\n        },\n        # Case 4: 2A + B - 3C\n        {\n            'stoichiometry': {'A': -2, 'B': -1, 'C': 3},\n            'params': {'mu': -5, 'sigma': 0.5},\n            'concentrations': {\n                'A': [1e-6, 1e-4],\n                'B': [1e-6, 1e-3],\n                'C': [1e-9, 1e-6]\n            }\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        stoich = case['stoichiometry']\n        params = case['params']\n        conc_ranges = case['concentrations']\n\n        mu = params['mu']\n        sigma = params['sigma']\n\n        S_min_sum = 0.0\n        S_max_sum = 0.0\n\n        for metabolite, nu in stoich.items():\n            c_min, c_max = conc_ranges[metabolite]\n            \n            # Calculate S_min\n            if nu = 0:\n                S_min_sum += nu * np.log(c_min)\n            else: # nu  0\n                S_min_sum += nu * np.log(c_max)\n\n            # Calculate S_max\n            if nu = 0:\n                S_max_sum += nu * np.log(c_max)\n            else: # nu  0\n                S_max_sum += nu * np.log(c_min)\n\n        # Calculate bounds for the standard Gibbs energy\n        dG_std_min = mu - z * sigma\n        dG_std_max = mu + z * sigma\n        \n        # Calculate robust bounds on the transformed Gibbs energy\n        dG_prime_min = dG_std_min + R * T * S_min_sum\n        dG_prime_max = dG_std_max + R * T * S_max_sum\n\n        # Apply directionality rules\n        if dG_prime_max  0:\n            # Forward-only\n            v_min = 0\n            v_max = int(V_bound)\n        elif dG_prime_min  0:\n            # Reverse-only\n            v_min = -int(V_bound)\n            v_max = 0\n        else:\n            # Reversible\n            v_min = -int(V_bound)\n            v_max = int(V_bound)\n            \n        results.append([v_min, v_max])\n\n    # Format the final output string exactly as required\n    formatted_results = ','.join([str(r).replace(' ', '') for r in results])\n    print(f\"[{formatted_results}]\")\n\nsolve()\n```"
        }
    ]
}