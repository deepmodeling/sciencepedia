{
    "hands_on_practices": [
        {
            "introduction": "研究着丝粒驱动的第一步是量化其效应。本练习提供一个假想的遗传杂交实验后代基因型计数，要求你运用严谨的统计学框架来判断是否存在非孟德尔式的分离现象 。通过推导传递偏差的最大似然估计量，你将掌握量化驱动强度并评估其统计置信度的基本方法，这是遗传学研究的核心技能。",
            "id": "2696183",
            "problem": "中心粒驱动是一种基因组内冲突，其中某个中心粒变体在不对称的雌性减数分裂过程中，会偏向性地进入功能性卵细胞。考虑一个中心粒等位基因 $A$，它在杂合子雌性中可能对标准等位基因 $a$ 产生驱动效应。将基因型为 $A/a$ 的杂合子雌性与基因型为 $a/a$ 的纯合子雄性进行杂交。假设以下基本前提：(i) 每个后代代表一次独立的减数分裂事件；(ii) 不存在合子后存活选择或基因分型错误；(iii) 如果雌性以概率 $t$ 传递 $A$ 并以概率 $1-t$ 传递 $a$，那么在 $n$ 个后代中，$A/a$ 后代的数量服从参数为 $t$ 的二项随机变量。令 $t$ 表示传递偏倚（即等位基因 $A$ 传递给卵细胞的概率，其中 $t = \\tfrac{1}{2}$ 对应于孟德尔分离定律）。\n\n从二项模型出发，并使用基于似然的推断，完成以下任务：\n- 通过在 $t \\in (0,1)$ 上最大化似然函数，推导 $t$ 的最大似然估计（MLE），并验证其为最大值点。\n- 基于在MLE处计算的观测费雪信息，推导 $t$ 的渐近双侧 $95\\%$ 置信区间（CI）。\n- 将你的结果应用于以下数据：在一次大规模杂交中，对 $n = 800$ 个存活后代进行了基因分型，其中 $k = 520$ 个为 $A/a$ 型， $n-k = 280$ 个为 $a/a$ 型。\n\n将最终答案以行矩阵的形式报告，依次包含点估计值 $\\hat{t}$、$95\\%$ CI的下界和 $95\\%$ CI的上界。将所有三个数值四舍五入至四位有效数字，并以小数形式表示概率（不要使用百分号）。",
            "solution": "用户提供了一个统计遗传学问题，必须首先验证其科学合理性和逻辑一致性。\n\n**问题验证**\n\n**步骤1：提取已知条件**\n- **模型**：等位基因 $A$ 对等位基因 $a$ 的中心粒驱动。\n- **杂交**：杂合子雌性（$A/a$）与纯合子雄性（$a/a$）进行杂交。\n- **假设**：\n    1. 每个后代代表一次独立的减数分裂。\n    2. 不存在合子后存活选择或基因分型错误。\n    3. 在 $n$ 个总后代中，$A/a$ 后代的数量（记为 $k$）是一个二项随机变量，参数为 $n$ 和 $t$，即 $k \\sim \\text{Binomial}(n, t)$。\n- **目标参数**：$t$，杂合子雌性传递等位基因 $A$ 的概率。参数空间为 $t \\in (0,1)$。$t = \\frac{1}{2}$ 对应于标准孟德尔分离。\n- **任务**：\n    1. 推导 $t$ 的最大似然估计（MLE），记为 $\\hat{t}$。\n    2. 验证推导出的估计量对应一个最大值。\n    3. 基于观测费雪信息，推导 $t$ 的渐近双侧 $95\\%$ 置信区间（CI）。\n    4. 将这些推导应用于数据：$n = 800$ 个后代，其中 $k = 520$ 个基因型为 $A/a$。\n- **报告格式**：一个包含点估计 $\\hat{t}$、CI下界和CI上界的行矩阵，所有值均四舍五入至四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n根据所需标准对问题进行评估。\n- **科学依据**：该问题在进化生物学和统计理论方面有充分的依据。在假设没有存活选择等混杂因素的情况下，二项模型是分析来自固定数量独立减数分裂事件的传递比率的标准且正确的方法。中心粒驱动是一个有充分文献记载的现象。\n- **适定性**：该问题是适定的。它指定了一个清晰的概率模型（二项分布），提供了所有必要的数据（$n$, $k$），并要求计算标准的、明确定义的统计量（MLE, CI）。存在唯一且有意义的解。\n- **客观性**：问题以精确、客观的语言陈述，没有歧义或主观论断。\n\n该问题没有任何使其无效的缺陷。它在科学上不是不合理的、不完整的、矛盾的或不适定的。这是一个生物统计学中标准的、可形式化的问题。\n\n**步骤3：结论与行动**\n问题被判定为**有效**。将提供完整解答。\n\n**解题推导**\n\n从总共 $n$ 个后代中观测到 $k$ 个 $A/a$ 后代。根据问题陈述，该过程由二项分布建模，$k \\sim \\text{Binomial}(n, t)$。在 $n$ 次试验中观测到 $k$ 次成功的概率质量函数为：\n$$ P(K=k | n, t) = \\binom{n}{k} t^k (1-t)^{n-k} $$\n似然函数 $L(t)$ 与此概率成正比，可视为关于观测数据 ($n, k$) 的参数 $t$ 的函数：\n$$ L(t; k, n) = \\binom{n}{k} t^k (1-t)^{n-k} $$\n为了便于分析，我们使用似然函数的自然对数，即对数似然函数 $\\ell(t)$：\n$$ \\ell(t) = \\ln(L(t)) = \\ln\\left(\\binom{n}{k}\\right) + k \\ln(t) + (n-k) \\ln(1-t) $$\n\n**1. $t$ 的最大似然估计（MLE）**\n为了求得 MLE $\\hat{t}$，我们将对数似然函数对 $t$ 求导，并令导数等于零。这个一阶导数是得分函数 $S(t)$。\n$$ S(t) = \\frac{d\\ell}{dt} = \\frac{k}{t} - \\frac{n-k}{1-t} $$\n令得分为零以找到临界点：\n$$ \\frac{k}{t} - \\frac{n-k}{1-t} = 0 $$\n$$ \\frac{k}{t} = \\frac{n-k}{1-t} $$\n$$ k(1-t) = t(n-k) $$\n$$ k - kt = nt - kt $$\n$$ k = nt $$\n解出 $t$ 可得最大似然估计量：\n$$ \\hat{t} = \\frac{k}{n} $$\n\n**2. 验证最大值**\n为确认 $\\hat{t}$ 对应一个最大值，我们考察对数似然函数的二阶导数。\n$$ \\frac{d^2\\ell}{dt^2} = \\frac{d}{dt}\\left(\\frac{k}{t} - \\frac{n-k}{1-t}\\right) = -\\frac{k}{t^2} - \\frac{n-k}{(1-t)^2} $$\n对于给定数据，$n=800$ 且 $k=520$。因此 $k > 0$ 且 $n-k > 0$。对于定义域 $(0,1)$ 内的任何 $t$，$t^2$ 和 $(1-t)^2$ 均为正。因此，二阶导数是两项负数之和：\n$$ \\frac{d^2\\ell}{dt^2}  0 \\quad \\text{for all } t \\in (0,1) $$\n由于二阶导数恒为负，对数似然函数在其定义域上是严格凹的。这证明了临界点 $\\hat{t} = k/n$ 是唯一的全局最大值。\n\n**3. 渐近 $95\\%$ 置信区间**\n渐近置信区间基于 MLE 分布的正态近似。$\\hat{t}$ 的方差通过费雪信息的倒数来近似。问题指定使用*观测*费雪信息 $I_O(t)$，其定义为对数似然函数二阶导数的负数，并在 MLE $\\hat{t}$ 处求值。\n$$ I_O(\\hat{t}) = -\\left.\\frac{d^2\\ell}{dt^2}\\right|_{t=\\hat{t}} = -\\left(-\\frac{k}{\\hat{t}^2} - \\frac{n-k}{(1-\\hat{t})^2}\\right) = \\frac{k}{\\hat{t}^2} + \\frac{n-k}{(1-\\hat{t})^2} $$\n代入 $\\hat{t} = k/n$ 和 $1-\\hat{t} = (n-k)/n$：\n$$ I_O(\\hat{t}) = \\frac{k}{(k/n)^2} + \\frac{n-k}{((n-k)/n)^2} = \\frac{kn^2}{k^2} + \\frac{(n-k)n^2}{(n-k)^2} = \\frac{n^2}{k} + \\frac{n^2}{n-k} $$\n$$ I_O(\\hat{t}) = \\frac{n^2(n-k) + n^2k}{k(n-k)} = \\frac{n^3}{k(n-k)} $$\n或者，可以得到一个更简单的表达式：\n$$ I_O(\\hat{t}) = \\frac{n\\hat{t}}{\\hat{t}^2} + \\frac{n(1-\\hat{t})}{(1-\\hat{t})^2} = \\frac{n}{\\hat{t}} + \\frac{n}{1-\\hat{t}} = \\frac{n(1-\\hat{t}) + n\\hat{t}}{\\hat{t}(1-\\hat{t})} = \\frac{n}{\\hat{t}(1-\\hat{t})} $$\nMLE 的渐近方差是观测费雪信息的倒数：\n$$ \\text{Var}(\\hat{t}) \\approx [I_O(\\hat{t})]^{-1} = \\frac{\\hat{t}(1-\\hat{t})}{n} $$\n估计量的标准误是该方差的平方根：\n$$ \\text{SE}(\\hat{t}) = \\sqrt{\\frac{\\hat{t}(1-\\hat{t})}{n}} $$\n$t$ 的双侧 $(1-\\alpha) \\times 100\\%$ 置信区间由 Wald 区间构建法给出：\n$$ \\text{CI} = \\hat{t} \\pm z_{\\alpha/2} \\cdot \\text{SE}(\\hat{t}) $$\n对于 $95\\%$ 的置信区间，$\\alpha = 0.05$，因此 $\\alpha/2 = 0.025$。来自标准正态分布的相应临界值为 $z_{0.025} \\approx 1.96$。\n因此，置信区间为：\n$$ \\hat{t} \\pm 1.96 \\sqrt{\\frac{\\hat{t}(1-\\hat{t})}{n}} $$\n\n**4. 应用于数据**\n给定 $n = 800$ 和 $k = 520$。\n首先，计算点估计值 $\\hat{t}$：\n$$ \\hat{t} = \\frac{k}{n} = \\frac{520}{800} = 0.65 $$\n接下来，计算标准误 $\\text{SE}(\\hat{t})$：\n$$ \\text{SE}(\\hat{t}) = \\sqrt{\\frac{0.65(1-0.65)}{800}} = \\sqrt{\\frac{0.65 \\times 0.35}{800}} = \\sqrt{\\frac{0.2275}{800}} = \\sqrt{0.000284375} \\approx 0.01686342 $$\n现在，计算 $95\\%$ CI 的误差范围 (ME)：\n$$ \\text{ME} = 1.96 \\times \\text{SE}(\\hat{t}) \\approx 1.96 \\times 0.01686342 \\approx 0.0330523 $$\n置信区间的下界和上界为：\n$$ \\text{Lower Bound} = \\hat{t} - \\text{ME} \\approx 0.65 - 0.0330523 = 0.6169477 $$\n$$ \\text{Upper Bound} = \\hat{t} + \\text{ME} \\approx 0.65 + 0.0330523 = 0.6830523 $$\n最后，我们根据要求将结果四舍五入到四位有效数字。\n- 点估计 $\\hat{t} = 0.65$ 变为 $0.6500$。\n- 下界 $0.6169477$ 变为 $0.6169$。\n- 上界 $0.6830523$ 变为 $0.6831$。\n\n点估计 $\\hat{t} = 0.65$ 与孟德尔期望值 $t=0.5$ 有显著差异，因为 $95\\%$ 置信区间 $[0.6169, 0.6831]$ 不包含 $0.5$。这为中心粒驱动提供了强有力的统计证据。",
            "answer": "$$ \\boxed{\\begin{pmatrix} 0.6500  0.6169  0.6831 \\end{pmatrix}} $$"
        },
        {
            "introduction": "一旦检测到驱动效应，接下来的问题便是其长期的演化后果。本练习将引导你构建一个群体遗传学模型，以探究驱动着丝粒的传递优势与其给生物体带来的适应性代价之间的冲突 。通过求解平衡时的等位基因频率，你将对这些相对抗的演化力量如何共同决定一个自私基因在群体中的最终命运，获得清晰的解析性理解。",
            "id": "2696239",
            "problem": "考虑一个大型、随机交配的二倍体种群，其世代不重叠，性别比相等。一个常染色体基因座上有两个等位基因：一个驱动着丝粒等位基因$D$和一个标准等位基因$d$。在着丝粒驱动作用下，杂合雌性($D d$)以概率$t$（其中$t \\in (0.5,1]$）将其等位基因$D$传递给卵细胞，而杂合雄性则公平传递等位基因（概率为$0.5$）。在减数分裂之前，生存力选择对两性作用相同，使得纯合子$D D$的相对适应度为$1-s$（其中$s \\in (0,1)$），而所有其他基因型的相对适应度为$1$。不存在突变、迁移或其他进化力。\n\n令$p$表示一代开始时合子中等位基因$D$的频率。从选择前的哈迪-温伯格基因型构成、生存力选择、伴随仅限雌性驱动的性别特异性减数分裂以及雌雄配子随机结合等基本原理出发，推导单代递推关系$p \\mapsto p'$，其中$p'$是下一代合子中等位基因$D$的频率。然后，求解所有满足$p^{\\ast} \\in (0,1)$和$p' = p$的内部平衡等位基因频率$p^{\\ast}$，并用$s$和$t$表示为一个简化的解析表达式。不需要数值近似，也不涉及单位。如果你的最终答案是数值，则四舍五入到四位有效数字；否则，请给出闭式表达式。",
            "solution": "该问题要求推导单代等位基因频率递推关系并求解所有内部平衡点。我们通过对不连续的生命周期步骤进行建模来着手。令$p$为合子中驱动等位基因$D$的频率，$q=1-p$为标准等位基因$d$的频率。\n\n1.  合子基因型频率：假设一个大型、随机交配的种群，合子中的基因型频率由哈迪-温伯格原理给出：\n    -   $DD$的频率：$f(DD) = p^{2}$\n    -   $Dd$的频率：$f(Dd) = 2pq = 2p(1-p)$\n    -   $dd$的频率：$f(dd) = q^{2} = (1-p)^{2}$\n\n2.  生存力选择：生存力选择发生在成年之前。相对适应度值给定为$w_{DD} = 1-s$、$w_{Dd} = 1$和$w_{dd} = 1$。种群的平均适应度$\\bar{w}$计算为基因型频率的加权平均值：\n    $$ \\bar{w} = f(DD)w_{DD} + f(Dd)w_{Dd} + f(dd)w_{dd} $$\n    $$ \\bar{w} = p^{2}(1-s) + 2p(1-p)(1) + (1-p)^{2}(1) $$\n    $$ \\bar{w} = p^{2} - sp^{2} + 2p - 2p^{2} + 1 - 2p + p^{2} = 1 - sp^{2} $$\n    选择之后，成年个体中的基因型频率通过平均适应度进行归一化：\n    -   成年$DD$个体的频率：$f'(DD) = \\frac{p^{2}(1-s)}{\\bar{w}} = \\frac{p^{2}(1-s)}{1-sp^{2}}$\n    -   成年$Dd$个体的频率：$f'(Dd) = \\frac{2p(1-p)}{\\bar{w}} = \\frac{2p(1-p)}{1-sp^{2}}$\n    -   成年$dd$个体的频率：$f'(dd) = \\frac{(1-p)^{2}}{\\bar{w}} = \\frac{(1-p)^{2}}{1-sp^{2}}$\n\n3.  伴随性别特异性减数分裂的配子产生：配子频率由成年个体的基因型频率决定。由于种群性别比相等，我们分别考虑雄配子库和雌配子库。\n    -   雄配子：雄性公平地传递等位基因。雄配子库中等位基因$D$的频率$p_m$，即为选择后成年个体中等位基因$D$的频率。\n        $$ p_m = f'(DD) \\times 1 + f'(Dd) \\times 0.5 = \\frac{p^{2}(1-s)}{1-sp^{2}} + \\frac{2p(1-p)}{1-sp^{2}} \\times 0.5 $$\n        $$ p_m = \\frac{p^{2} - sp^{2} + p - p^{2}}{1-sp^{2}} = \\frac{p - sp^{2}}{1-sp^{2}} $$\n    -   雌配子：杂合雌性表现出减数分裂驱动，以概率$t$传递等位基因$D$。雌配子库中等位基因$D$的频率$p_f$为：\n        $$ p_f = f'(DD) \\times 1 + f'(Dd) \\times t = \\frac{p^{2}(1-s)}{1-sp^{2}} + \\frac{2p(1-p)t}{1-sp^{2}} $$\n        $$ p_f = \\frac{p^{2} - sp^{2} + 2pt - 2p^{2}t}{1-sp^{2}} $$\n\n4.  下一代的等位基因频率：在配子随机结合的情况下，下一代合子中的等位基因频率$p'$是来自雄性和雌性配子频率的平均值：\n    $$ p' = \\frac{p_m + p_f}{2} $$\n    代入$p_m$和$p_f$的表达式：\n    $$ p' = \\frac{1}{2} \\left(\\frac{p - sp^{2}}{1-sp^{2}} + \\frac{p^{2} - sp^{2} + 2pt - 2p^{2}t}{1-sp^{2}}\\right) $$\n    $$ p' = \\frac{p - sp^{2} + p^{2}(1-s) + 2pt(1-p)}{2(1-sp^{2})} $$\n    另一种更具洞察力的递推关系推导方法是考虑等位基因频率的变化量$\\Delta p = p' - p$。成年种群经过选择后等位基因$D$的频率是$p_m$。雌性中的减数分裂驱动提供了额外的变化。杂合雌性的频率是$f'(Dd)$。这些雌性产生比例为$t$的$D$配子，与公平减数分裂相比，超出了$t-0.5$。这个超出的部分对总体等位基因频率变化有贡献，但只影响一半的配子（即来自雌性的配子）。\n    $$ p' = p_m + \\frac{1}{2} f'(Dd) (t-0.5) $$\n    $$ p' = \\frac{p-sp^{2}}{1-sp^{2}} + \\frac{1}{2} \\frac{2p(1-p)}{1-sp^{2}}(t-0.5) $$\n    $$ p' = \\frac{p - sp^{2} + p(1-p)(t-0.5)}{1-sp^{2}} $$\n    这就是所要求的等位基因$D$频率的单代递推关系。\n\n5.  求解内部平衡点：平衡等位基因频率$p^{\\ast}$是使$p' = p$成立的$p$值。我们寻找满足$p^{\\ast} \\in (0,1)$的内部平衡点。设$p' = p^{\\ast} = p$：\n    $$ p = \\frac{p - sp^{2} + p(1-p)(t-0.5)}{1-sp^{2}} $$\n    因为我们寻找的是内部平衡点，我们知道$p \\neq 0$，所以可以在等式两边同除以$p$：\n    $$ 1 = \\frac{1 - sp + (1-p)(t-0.5)}{1-sp^{2}} $$\n    两边同乘以分母：\n    $$ 1 - sp^{2} = 1 - sp + (1-p)(t-0.5) $$\n    $$ -sp^{2} = -sp + (t-0.5) - p(t-0.5) $$\n    整理各项得到一个关于$p$的二次方程：\n    $$ sp^{2} - sp - p(t-0.5) + (t-0.5) = 0 $$\n    $$ sp^{2} - p(s + t - 0.5) + (t-0.5) = 0 $$\n    这个方程可以因式分解：\n    $$ sp(p-1) - (t-0.5)(p-1) = 0 $$\n    $$ \\left(sp - (t-0.5)\\right)(p-1) = 0 $$\n    这个方程给出了两个潜在的平衡解：$p=1$和$sp - (t-0.5) = 0$。\n    解$p=1$是一个边界平衡点，而不是内部平衡点。另一个解给出：\n    $$ sp = t - 0.5 $$\n    $$ p^{\\ast} = \\frac{t - 0.5}{s} $$\n    这就是内部平衡点的解析表达式。为使该平衡点具有生物学意义且为内部平衡点，其值必须在区间$(0,1)$内。已知$t \\in (0.5, 1]$且$s \\in (0,1)$，分子$t-0.5$在$(0, 0.5]$区间内，分母$s$在$(0,1)$区间内，所以$p^{\\ast}$总是正的。其为内部平衡点的条件是$p^{\\ast}  1$，这意味着$\\frac{t-0.5}{s}  1$，即$t - 0.5  s$。如果不满足此条件，则不存在内部平衡点。问题要求的是内部平衡点的表达式，即此结果。",
            "answer": "$$\n\\boxed{\\frac{t-0.5}{s}}\n$$"
        },
        {
            "introduction": "在实际研究中，观测到传递比例扭曲仅仅是第一步，其背后的真正原因必须得到严格的辨析。这个高阶练习要求你通过分析多个遗传标记的数据模式，来区分真实的、由单个位点引起的着丝粒驱动与合子后选择等其他干扰机制 。你将推导并实现一个最大似然框架，该框架利用了局部驱动效应会随着重组距离的增加而衰减这一关键特征，这正是从全基因组数据中精确定位基因组内部冲突的有力信号。",
            "id": "2696167",
            "problem": "您面临一个受基因组内部冲突启发的广义推断任务。其目标是利用多位点基因型的传递来判断，在多个标记上观测到的传递比率畸变（TRD）是否可以最好地由以下机制解释：位于着丝粒附近的单一位点雌性减数分裂驱动、一个全基因组范围的畸变体，或诸如选择性胚胎致死之类的合子后选择。您必须从第一性原理出发推导出基于模型的似然函数，并实现一个最大似然分类器，该分类器利用畸变随重组距离的衰减特性。\n\n基本原理和假设：\n- 孟德尔分离定律指出，在没有畸变的情况下，杂合亲本以 $0.5$ 的概率将每个等位基因传递给后代。\n- 重组率 $r \\in [0,0.5]$ 是指在一次减数分裂中，一个遗传标记与一个焦点基因座因奇数次交换而分离，从而切换了单倍型相位的概率。\n- 在雌性杂合子杂交中，位于着丝粒附近一个焦点基因座上的单一位点减数分裂驱动，会使携带驱动基因的染色单体以 $0.5 + s$ 的概率偏向性地进入卵细胞，其中 $s \\in [0,0.5)$ 是驱动强度的参数。由于重组导致的相位切换，这种偏向性表现为连锁标记上的 TRD 会随重组率 $r$ 的函数而衰减。\n- 一个全基因组范围的畸变体以一个恒定的量 $0.5 + g$ 偏向母本传递，其中 $g \\in (-0.5,0.5)$，且该值与重组率 $r$ 无关。如果这种效应在两性中对称，则相同的恒定值也适用于父本杂合子。\n- 对于焦点基因座上的合子后选择（例如，胚胎致死），其生存力取决于合子基因型，而非亲源。假设非驱动等位基因的纯合子存活概率为 $1 - e$，其中 $e \\in [0,1]$，而其他基因型的存活概率为 $1$。在一个杂合亲本与一个非驱动等位基因的纯合配偶进行的测交中，存活后代中标记的 TRD 取决于 $r$，因为连锁使得标记与受选择的基因座在配子和合子中耦合在一起。\n\n您必须：\n1. 基于孟德尔分离定律及上述假设，为以下每个模型推导出在后代中观察到母本“A”标记等位基因的期望概率，该概率是重组率 $r$ 的函数：\n   - 模型 D（单一位点雌性减数分裂驱动）：雌性杂合子的传递通过驱动参数 $s$ 依赖于 $r$；雄性杂合子的传递是中性的，概率为 $0.5$。\n   - 模型 G（全基因组范围畸变体）：在雌性和雄性杂合子杂交中，传递概率恒为 $0.5 + g$，与 $r$ 无关。\n   - 模型 Z（合子后选择，例如选择性胚胎致死）：在雌性和雄性杂合子杂交中，传递概率均通过致死参数 $e$ 依赖于 $r$，并且方式相同，因为生存力选择不具有亲源特异性。\n\n2. 给定 $m$ 个标记的观测数据，其中每个标记 $i$ 提供一个重组率 $r_i$、雌性杂合子传递的计数 $(x_i^{(f)}, n_i^{(f)})$（$n_i^{(f)}$ 个后代中有 $x_i^{(f)}$ 次“A”传递），以及雄性杂合子传递的计数 $(x_i^{(m)}, n_i^{(m)})$，通过对所有标记和性别的对数概率求和，来定义并计算每个模型下的总二项对数似然。使用参数域 $s \\in [0,0.49]$、$g \\in [-0.49,0.49]$ 和 $e \\in [0,0.9999]$ 以避免退化概率。\n\n3. 为每个模型实现一个最大似然估计器（通过在指定的参数范围内进行连续优化）。选择总对数似然最高的模型。如果总对数似然出现精确的数值相等，则优先选择具有如下定义的最小标识符 $\\{0,1,2\\}$ 的模型来打破平局。\n\n4. 输出格式：您的程序必须生成单行输出，该输出是一个由方括号括起来的逗号分隔列表。每个测试用例的结果本身必须是一个双元素列表 $[M,\\hat{\\theta}]$，不含空格，其中 $M$ 是所选模型的标识符，$\\hat{\\theta}$ 是四舍五入到 $6$ 位小数的最大似然参数估计值。使用以下模型标识符映射：$0$ 表示模型 D（单一位点雌性减数分裂驱动），$1$ 表示模型 G（全基因组范围畸变体），$2$ 表示模型 Z（合子后选择）。例如，一个包含三个案例的输出可能看起来像 $[[0,0.123456],[1,-0.032100],[2,0.700000]]$。\n\n重组率单位：将 $r$ 表示为 $[0,0.5]$ 范围内的无单位十进制重组率。\n\n角度单位：不适用。\n\n百分比：所有畸变幅度必须根据情况处理为 $[-0.5,0.5]$ 或 $[0,1]$ 范围内的十进制数；不要使用百分号。\n\n测试套件（请精确使用这些输入；无需用户输入）：\n- 案例 1（局部效应的雌性减数分裂驱动）：$r = [0, 0.05, 0.1, 0.2, 0.5]$。雌性计数 $(x^{(f)}, n^{(f)}) = [(248,400),(243,400),(238,400),(229,400),(200,400)]$。雄性计数 $(x^{(m)}, n^{(m)}) = [(200,400),(200,400),(200,400),(200,400),(200,400)]$。\n- 案例 2（对称的全基因组范围畸变体）：$r = [0, 0.15, 0.3, 0.5]$。雌性计数 $[(168,300),(168,300),(168,300),(168,300)]$。雄性计数 $[(168,300),(168,300),(168,300),(168,300)]$。\n- 案例 3（强合子后选择）：$r = [0, 0.05, 0.1, 0.3, 0.5]$。雌性计数 $[(200,260),(193,260),(186,260),(158,260),(130,260)]$。对于相同的 r 和 n，雄性计数与雌性相同。\n- 案例 4（弱合子后选择）：$r = [0, 0.25, 0.5]$。雌性计数 $[(500,900),(475,900),(450,900)]$。对于相同的 r 和 n，雄性计数与雌性相同。\n- 案例 5（对称的、负向的全基因组范围畸变体）：$r = [0, 0.2, 0.4, 0.5]$。雌性计数 $[(92,200),(92,200),(92,200),(92,200)]$。对于相同的 r 和 n，雄性计数与雌性相同。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，每个案例的结果格式为 $[M,\\hat{\\theta}]$ 且不含空格，并按上述案例的顺序排列。",
            "solution": "该问题陈述已经过严格验证，被认为是科学上合理、定义明确且内部一致的。它提出了统计遗传学中的一个标准任务，要求推导和应用最大似然法进行模型选择。未检测到任何缺陷。我们将着手进行推导和求解。\n\n目标是区分解释观测到的传递比率畸变（TRD）的三种竞争性假说：单一位点雌性减数分裂驱动（模型 D）、全基因组范围畸变体（模型 G）和合子后选择（模型 Z）。这将通过推导每种模型下预期的等位基因传递频率，并选择能为观测数据赋予最高似然的模型来完成。\n\n首先，我们推导一个杂合亲本将其特有的标记等位基因（指定为‘A’）传递给后代的期望概率，我们将其表示为 $p$。我们假设标记基因座（等位基因 A/a）与焦点基因座（等位基因 D/d）连锁，重组率为 $r$。假设杂合亲本的基因型为 $AD/ad$，这意味着‘A’等位基因与‘D’等位基因处于相连相位，而‘D’等位基因是受驱动或选择效应影响的等位基因。\n\n**1. 期望传递概率的推导**\n\n**模型 D：单一位点雌性减数分裂驱动**\n该模型假定，在雌性减数分裂中，携带驱动等位基因‘D’的染色体以 $0.5+s$ 的概率传递给卵细胞，其中 $s$ 是驱动强度参数。携带‘d’等位基因的染色体以 $0.5-s$ 的概率传递。雄性减数分裂被认为是公平的，传递概率为 $0.5$。标记与焦点基因座之间的重组将 TRD 信号与标记解耦。\n\n一个配子接收到‘A’标记等位基因的条件是：(1) 携带 D 的染色体被选中且未发生重组，或 (2) 携带 d 的染色体被选中且发生了重组。因此，从雌性杂合子传递‘A’等位基因的概率 $p_D^{(f)}$ 为：\n$$p_D^{(f)}(r, s) = (0.5+s)(1-r) + (0.5-s)r$$\n$$p_D^{(f)}(r, s) = 0.5 - 0.5r + s - sr + 0.5r - sr = 0.5 + s(1 - 2r)$$\n对于雄性杂合子，分离是孟德尔式的：\n$$p_D^{(m)}(r) = 0.5$$\n\n**模型 G：全基因组范围畸变体**\n该模型假设存在一个恒定的传递偏向，该偏向与染色体位置无关（因此与 $r$ 无关）。传递‘A’等位基因的概率是 $0.5+g$，其中 $g$ 是畸变参数。对于给定的测试用例，问题暗示这种效应在两性中是对称的。\n$$p_G^{(f)}(g) = 0.5 + g$$\n$$p_G^{(m)}(g) = 0.5 + g$$\n\n**模型 Z：合子后选择**\n该模型考虑了一个杂合亲本（$AD/ad$）与一个纯合配偶（$ad/ad$）之间的测交。选择作用于合子。‘d’等位基因的纯合子（$d/d$）具有降低的生存力，其存活概率为 $1-e$。其他基因型（$D/d$）的存活概率为 $1$。\n\n该杂合亲本产生四种类型的配子，频率如下：\n- 亲本型, $AD$: $\\frac{1-r}{2}$\n- 亲本型, $ad$: $\\frac{1-r}{2}$\n- 重组型, $Ad$: $\\frac{r}{2}$\n- 重组型, $aD$: $\\frac{r}{2}$\n\n与一个 $ad$ 配子受精后，合子的基因型及其选择前频率为：\n- $AD/ad$ (焦点基因型 $D/d$, 生存力 $1$): $\\frac{1-r}{2}$\n- $ad/ad$ (焦点基因型 $d/d$, 生存力 $1-e$): $\\frac{1-r}{2}$\n- $Ad/ad$ (焦点基因型 $d/d$, 生存力 $1-e$): $\\frac{r}{2}$\n- $aD/ad$ (焦点基因型 $D/d$, 生存力 $1$): $\\frac{r}{2}$\n\n这些合子的选择后频率是通过将其选择前频率乘以各自的生存力得到的。存活后代的总频率，作为归一化常数，是这些选择后频率的总和：\n$$S = \\frac{1-r}{2}(1) + \\frac{1-r}{2}(1-e) + \\frac{r}{2}(1-e) + \\frac{r}{2}(1) = \\frac{1-r+r}{2} + \\frac{(1-r+r)(1-e)}{2} = \\frac{1}{2} + \\frac{1-e}{2} = \\frac{2-e}{2}$$\n从杂合亲本接收到‘A’等位基因的存活后代的频率，是 $AD/ad$ 和 $Ad/ad$ 基因型选择后频率的总和：\n$$F_A = \\frac{1-r}{2}(1) + \\frac{r}{2}(1-e) = \\frac{1-r + r - re}{2} = \\frac{1-re}{2}$$\n在存活后代中观察到‘A’等位基因的概率是 $F_A$ 与 $S$ 的比值：\n$$p_Z(r, e) = \\frac{F_A}{S} = \\frac{(1-re)/2}{(2-e)/2} = \\frac{1-re}{2-e}$$\n由于合子后选择不具有亲源特异性，这个概率适用于来自雌性和雄性杂合亲本的后代：\n$$p_Z^{(f)}(r, e) = p_Z^{(m)}(r, e) = \\frac{1-re}{2-e}$$\n\n**2. 对数似然计算**\n\n每个标记 $i$ 的数据包括计数 $(x_i, n_i)$，其中在总共 $n_i$ 个后代中，有 $x_i$ 个继承了‘A’等位基因。假设后代是独立的，‘A’传递的次数 $x_i$ 服从参数为 $n_i$ 和概率为 $p_i$ 的二项分布。一组观测值的对数似然是各个对数概率的总和。对于一个给定参数为 $\\theta$ 的模型，总对数似然 $LL(\\theta)$ 由下式给出：\n$$LL(\\theta) = \\sum_{sex \\in \\{f,m\\}} \\sum_{i=1}^{M} \\left[ x_i^{(sex)} \\log(p_i^{(sex)}(\\theta)) + (n_i^{(sex)} - x_i^{(sex)}) \\log(1 - p_i^{(sex)}(\\theta)) \\right]$$\n其中 $M$ 是标记的数量，$p_i^{(sex)}(\\theta)$ 是给定模型、性别和标记 $i$ 的传递概率。为了模型比较，与 $\\theta$ 无关的常数项被省略。\n\n我们为每个模型构建对数似然函数：\n\n- **模型 D（参数 $s$）**：\n$$LL_D(s) = \\sum_{i} \\left[ x_i^{(f)} \\log(p_D^{(f)}(r_i, s)) + (n_i^{(f)}-x_i^{(f)}) \\log(1-p_D^{(f)}(r_i, s)) \\right] + C_m$$\n其中 $C_m = \\sum_i [x_i^{(m)} \\log(0.5) + (n_i^{(m)}-x_i^{(m)}) \\log(0.5)]$ 是一个相对于 $s$ 的常数。\n\n- **模型 G（参数 $g$）**：\n$$LL_G(g) = \\left( \\sum_i x_i^{(f)} + \\sum_i x_i^{(m)} \\right) \\log(0.5+g) + \\left( \\sum_i (n_i^{(f)}-x_i^{(f)}) + \\sum_i (n_i^{(m)}-x_i^{(m)}) \\right) \\log(0.5-g)$$\n对于 $p = 0.5+g$ 的最大似然估计就是总观测频率，即 $\\hat{p} = \\frac{\\sum x_{tot}}{\\sum n_{tot}}$。因此，$\\hat{g} = \\hat{p} - 0.5$。\n\n- **模型 Z（参数 $e$）**：\n$$LL_Z(e) = \\sum_{i} \\left[ (x_i^{(f)}+x_i^{(m)}) \\log(p_Z(r_i,e)) + (n_i^{(f)}+n_i^{(m)}-x_i^{(f)}-x_i^{(m)}) \\log(1-p_Z(r_i,e)) \\right]$$\n\n**3. 最大似然估计与模型选择**\n\n对于每个模型，我们找到使其对数似然函数最大化的参数值（$\\hat{s}, \\hat{g}, \\hat{e}$）。这是一个最大似然估计（MLE）问题。对于模型 D 和 Z，MLE 没有简单的闭式解，必须使用数值优化来求解。对于模型 G，MLE 可以解析计算。我们在指定的参数界限内执行此优化：$s \\in [0, 0.49]$、$g \\in [-0.49, 0.49]$ 和 $e \\in [0, 0.9999]$。\n\n产生最高最大对数似然值 $LL^* = \\max(LL_D(\\hat{s}), LL_G(\\hat{g}), LL_Z(\\hat{e}))$ 的模型被选为对数据的最佳解释。在对数似然值出现数值相等的情况下，选择具有最低标识符的模型（D 为 $0$，G 为 $1$，Z 为 $2$）。最终输出将呈现所选模型的标识符及其对应的参数估计值，四舍五入到六位小数。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves the problem of classifying transmission ratio distortion using maximum likelihood.\n    \"\"\"\n    test_cases = [\n        {\n            \"r\": np.array([0, 0.05, 0.1, 0.2, 0.5]),\n            \"xf\": np.array([248, 243, 238, 229, 200]),\n            \"nf\": np.array([400, 400, 400, 400, 400]),\n            \"xm\": np.array([200, 200, 200, 200, 200]),\n            \"nm\": np.array([400, 400, 400, 400, 400]),\n        },\n        {\n            \"r\": np.array([0, 0.15, 0.3, 0.5]),\n            \"xf\": np.array([168, 168, 168, 168]),\n            \"nf\": np.array([300, 300, 300, 300]),\n            \"xm\": np.array([168, 168, 168, 168]),\n            \"nm\": np.array([300, 300, 300, 300]),\n        },\n        {\n            \"r\": np.array([0, 0.05, 0.1, 0.3, 0.5]),\n            \"xf\": np.array([200, 193, 186, 158, 130]),\n            \"nf\": np.array([260, 260, 260, 260, 260]),\n            \"xm\": np.array([200, 193, 186, 158, 130]),\n            \"nm\": np.array([260, 260, 260, 260, 260]),\n        },\n        {\n            \"r\": np.array([0, 0.25, 0.5]),\n            \"xf\": np.array([500, 475, 450]),\n            \"nf\": np.array([900, 900, 900]),\n            \"xm\": np.array([500, 475, 450]),\n            \"nm\": np.array([900, 900, 900]),\n        },\n        {\n            \"r\": np.array([0, 0.2, 0.4, 0.5]),\n            \"xf\": np.array([92, 92, 92, 92]),\n            \"nf\": np.array([200, 200, 200, 200]),\n            \"xm\": np.array([92, 92, 92, 92]),\n            \"nm\": np.array([200, 200, 200, 200]),\n        },\n    ]\n\n    results = []\n    \n    # Parameter bounds\n    s_bounds = (0, 0.49)\n    g_bounds = (-0.49, 0.49)\n    e_bounds = (0, 0.9999)\n\n    for case in test_cases:\n        r, xf, nf, xm, nm = case[\"r\"], case[\"xf\"], case[\"nf\"], case[\"xm\"], case[\"nm\"]\n\n        # --- Model D: Meiotic Drive (s) ---\n        def neg_log_lik_d(s, r_d, xf_d, nf_d, xm_d, nm_d):\n            pf = 0.5 + s * (1 - 2 * r_d)\n            # Clip to avoid log(0) for robustness, although bounds should prevent it\n            pf = np.clip(pf, 1e-9, 1 - 1e-9)\n            \n            log_lik_f = np.sum(xf_d * np.log(pf) + (nf_d - xf_d) * np.log(1 - pf))\n            # Male part is constant with respect to s, but included for complete LL value\n            pm = 0.5\n            log_lik_m = np.sum(xm_d * np.log(pm) + (nm_d - xm_d) * np.log(1 - pm))\n            \n            return -(log_lik_f + log_lik_m)\n\n        res_d = minimize_scalar(neg_log_lik_d, bounds=s_bounds, args=(r, xf, nf, xm, nm), method='bounded')\n        mle_s = res_d.x\n        max_ll_d = -res_d.fun\n\n        # --- Model G: Genome-wide Distorter (g) ---\n        def log_lik_g(g, x_total, n_total):\n            p = 0.5 + g\n            p = np.clip(p, 1e-9, 1 - 1e-9)\n            return x_total * np.log(p) + (n_total - x_total) * np.log(1 - p)\n            \n        x_total = np.sum(xf) + np.sum(xm)\n        n_total = np.sum(nf) + np.sum(nm)\n        \n        # Analytical MLE for g, clipped to bounds\n        p_obs = x_total / n_total\n        mle_g = np.clip(p_obs - 0.5, g_bounds[0], g_bounds[1])\n        max_ll_g = log_lik_g(mle_g, x_total, n_total)\n\n        # --- Model Z: Zygotic Selection (e) ---\n        def neg_log_lik_z(e, r_z, xf_z, nf_z, xm_z, nm_z):\n            # To prevent division by zero, although bounds on e make 2-e  1\n            if e = 2.0: return np.inf\n\n            p = (1 - r_z * e) / (2 - e)\n            p = np.clip(p, 1e-9, 1 - 1e-9)\n            \n            x_tot_z = xf_z + xm_z\n            n_tot_z = nf_z + nm_z\n            \n            log_lik = np.sum(x_tot_z * np.log(p) + (n_tot_z - x_tot_z) * np.log(1 - p))\n            return -log_lik\n\n        res_z = minimize_scalar(neg_log_lik_z, bounds=e_bounds, args=(r, xf, nf, xm, nm), method='bounded')\n        mle_e = res_z.x\n        max_ll_z = -res_z.fun\n\n        # --- Model Selection ---\n        log_likelihoods = [max_ll_d, max_ll_g, max_ll_z]\n        params = [mle_s, mle_g, mle_e]\n\n        max_ll = -np.inf\n        best_model_idx = -1\n\n        # Using a small tolerance for floating point comparisons of likelihoods\n        # Tie-breaking: D(0) > G(1) > Z(2)\n        if log_likelihoods[0] > max_ll:\n            max_ll = log_likelihoods[0]\n            best_model_idx = 0\n        if log_likelihoods[1] > max_ll + 1e-9: # prefer model G only if LL is strictly greater\n            max_ll = log_likelihoods[1]\n            best_model_idx = 1\n        if log_likelihoods[2] > max_ll + 1e-9: # prefer model Z only if LL is strictly greater\n            max_ll = log_likelihoods[2]\n            best_model_idx = 2\n\n        best_param = params[best_model_idx]\n        results.append([best_model_idx, best_param])\n\n    # Format output\n    formatted_results = [f'[{m},{p:.6f}]' for m, p in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}