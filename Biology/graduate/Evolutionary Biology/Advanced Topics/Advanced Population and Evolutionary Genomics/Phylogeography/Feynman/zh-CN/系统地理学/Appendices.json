{
    "hands_on_practices": [
        {
            "introduction": "错配分布（mismatch distribution）是系统地理学中用于推断种群历史动态的经典工具。该分布的形状直接反映了种群中谱系对的溯祖时间分布，因此，它为我们提供了一扇观察过去的窗口。通过分析错配分布的形态——是平滑的单峰还是崎岖的多峰——研究人员可以区分种群是经历了近期的快速扩张，还是长期保持了稳定或复杂的结构 。这项练习旨在培养您从成对核苷酸差异模式中解读种群历史信号的核心技能。",
            "id": "1954835",
            "problem": "一位保护生物学家正在研究两种有亲缘关系但地理上隔离的蝴蝶物种，*Papilio spectabilis* 和 *Papilio opacus* 的种群历史。对于每个物种，该生物学家从众多个体中收集样本，并对它们线粒体脱氧核糖核酸（mtDNA）的一个非编码区进行测序。利用这些序列数据，该生物学家为每个种群构建了错配分布。错配分布是一个直方图，显示了样本中所有可能的DNA序列对之间，观察到的每种配对核苷酸差异（错配）数量的频率。\n\n结果如下：\n- 对于 *Papilio spectabilis*，其错配分布平滑且呈明显的单峰形态，类似于一个有单一清晰峰值的钟形曲线。\n- 对于 *Papilio opacus*，其错配分布被描述为“不规则的”，并且明显是多峰的，显示出几个高度不同的清晰峰值。\n\n基于这些观察结果和谱系地理学的原理，以下哪项陈述最准确地对比了这两个种群可能的种群动态历史？\n\nA. *P. spectabilis* 可能经历了一次近期的快速种群扩张，而 *P. opacus* 可能在很长一段时间内保持了相对稳定的种群大小，或者其历史更为复杂，涉及种群亚结构。\n\nB. *P. opacus* 可能经历了一次近期的快速种群扩张，而 *P. spectabilis* 可能在很长一段时间内保持了相对稳定的种群大小，或者其历史更为复杂，涉及种群亚结构。\n\nC. *P. spectabilis* 的单峰表明该种群目前正在经历严重的种群瓶颈，而 *P. opacus* 的多峰则表明发生了多次来自不同避难所的同时扩张事件。\n\nD. 两个种群可能都是古老且稳定的。*P. spectabilis* 的平滑分布是由强烈的纯化选择清除了新突变所致，而 *P. opacus* 的不规则分布则表明选择压力松弛。\n\nE. *P. spectabilis* 的单峰分布表明它源自单一的祖先种群，而 *P. opacus* 的多峰分布则表明它是一个由几个不同种群近期混合形成的杂交物种。",
            "solution": "错配分布是样本中所有序列对之间配对核苷酸差异数量的直方图。根据溯祖理论，这种分布的形状反映了种群动态历史，因为它整合了谱系对的溯祖时间的分布。\n\n原理1（突发性种群扩张）：如果一个种群近期从较小的规模经历了快速扩张，其谱系树往往呈星状，许多溯祖事件都集中在扩张开始的附近。在突发扩张模型下，配对差异的期望分布是平滑且单峰的，可以近似为一种类泊松波，其峰值位于参数 $\\tau$ 附近，该参数与扩张以来的时间和突变率成比例。形式上，一个理想化的预测是，随机一对序列相差 $k$ 个位点的概率近似为 $P(K=k) \\propto \\exp(-\\tau)\\,\\tau^{k}/k!$，其中 $\\tau$ 是扩张以来的突变时间，对于配对差异，它满足 $\\tau \\propto 2 \\mu t$，其中 $\\mu$ 是每个序列的突变率， $t$ 是扩张以来的世代数。由此产生的直方图是平滑且明显单峰的（一个单一的清晰峰值）。\n\n原理2（长期稳定或种群结构）：如果一个种群在很长一段时间内保持了相对恒定的大小，由于在多个时间尺度上的谱系分选，配对溯祖时间的分布会很宽且呈多峰形态；种群亚结构或复杂的种群动态事件（例如，瓶颈、反复的收缩/扩张，或分化的亚种群之间的混合）会进一步导致多峰的出现。经验上，这样的历史会产生一个“不规则的”、明显多峰的错配分布，带有几个高度不同的峰。在这种情况下，Harpending的不规则指数会更高，反映了其不规则性。\n\n应用于观察结果：\n- 对于 *Papilio spectabilis*，其错配分布平滑且呈明显的单峰形态。根据原理1，这种模式是近期从一个较小的祖先种群快速进行种群扩张的标志，它会产生一个星状谱系树和一个以 $\\tau$ 为中心的单峰波。\n- 对于 *Papilio opacus*，其错配分布不规则且明显是多峰的。根据原理2，这种模式与一个长期以来种群动态稳定和/或表现出种群亚结构或更复杂的种群动态历史的种群相一致，而不是单一的近期扩张。\n\n评估选项：\n- 选项A与上述分析相符：*P. spectabilis* 经历了近期的快速扩张；*P. opacus* 种群稳定或具有复杂的/亚结构的种群历史。这与标准的Rogers–Harpending解释一致。\n- 选项B颠倒了推论，与观察到的分布形状不一致。\n- 选项C将单峰错误地归因于严重的瓶颈；虽然瓶颈会影响分布模式，但近期突发性扩张的标志是单峰，而不是持续的严重瓶颈，而且多峰的解释也无需多个同时发生的扩张事件。\n- 选项D援引了选择差异；数据来自一个mtDNA的非编码区，那里的纯化选择作用极小，而且选择也不是对这些分布形状的标准解释；此外，古老的稳定性通常产生不规则分布，而不是平滑的单峰模式。\n- 选项E为解释多峰性而援引了杂交起源，并声称单峰性意味着源自单一祖先种群；错配分布本身并不能诊断杂交物种形成，而且除了扩张特征之外，单峰性并不能唯一地意味着单一祖先种群。\n\n因此，最准确的对比由选项A给出。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在系统地理学推断中，仅依赖单个遗传标记（如线粒体DNA）可能会得出模糊甚至错误的结论，因为不同的进化过程可能产生相似的遗传模式。例如，种群扩张和选择性清除都能导致遗传多样性的降低。这项练习  挑战您综合利用不同遗传背景（母系遗传的 mtDNA 和双亲遗传的核 DNA）的数据，以区分两种截然不同的历史情景。掌握这种比较基因组学方法对于构建稳健的进化假说至关重要，它能帮助我们厘清种群动态和选择的混淆效应。",
            "id": "1954844",
            "problem": "一个进化生物学家团队正在研究*Petrocallis glacialis*的谱系地理学，这是一种发现于几个不相连山脉的小型高山植物。他们试图了解该物种自末次冰盛期以来的历史。提出了两种主要假说：\n\n1.  **近期范围扩张：** 该物种在单一的南部避难所中度过了冰期，然后迅速扩张，定居于其当前零散的分布区。\n2.  **线粒体选择性清除：** 该物种已长期占据其当前的山脉群，导致种群间出现深度遗传分化。然而，近期一次涉及线粒体基因组中有利突变的选择性清除已扩散至所有种群，抹去了该部分基因组中原有的谱系地理结构。\n\n为区分这两种情景，研究人员从该物种分布范围内收集样本，并分析了线粒体DNA（mtDNA，母系遗传且不重组）和几个不连锁的核DNA（nDNA）标记。他们的分析揭示了以下模式：\n*   mtDNA显示出极低的核苷酸多样性。单一单倍型占主导地位，并在所有山脉中以高频率出现，其他稀有单倍型仅相差一两个突变。\n*   相比之下，nDNA标记则显示出高水平的遗传多样性。此外，存在显著的遗传结构，不同山脉的种群之间观察到强烈的等位基因频率差异（高$F_{ST}$值）。\n\n基于这些遗传数据的组合，以下哪个结论得到了最有力的支持？\n\nA. 范围扩张假说得到支持，因为低mtDNA多样性是与来自小型奠基群体的定居相关的种群瓶颈的典型标志。\n\nB. 线粒体选择性清除假说得到支持，因为在nDNA中观察到的深度分化与所有种群近期拥有共同祖先的情况不符。\n\nC. 数据相互矛盾，无法区分这两种假说，需要分析如化石花粉等额外数据。\n\nD. 范围扩张假说得到支持，而nDNA中的高度结构很可能是由于扩张后迅速发生的强烈的、趋异的局域适应造成的。\n\nE. 线粒体选择性清除假说得到支持，因为已知一个基因组（线粒体）上的选择性清除会导致另一个基因组（核）的多样性和结构增加。",
            "solution": "我们通过将两种假说的全基因组预期与观察到的模式进行对比来区分它们，运用了关于遗传漂变、基因流、选择和有效种群大小的种群遗传学原理。\n\n1) 单一避难所近期范围扩张假说下的预期：\n- 严重的瓶颈和连续的奠基者事件预示着整个基因组的遗传多样性会降低，而不仅仅是mtDNA。因为mtDNA是单倍体、单亲遗传且不重组，它对遗传漂变尤为敏感，因此预期会出现极低的mtDNA多样性和一个占主导地位的单倍型。然而，中性核基因座也应显示出多样性降低。\n- 在近期扩张之后，预计中性种种群结构会较弱，因为等位基因频率几乎没有时间通过漂变产生分化；$F_{ST}$应该为低到中等，除非隔离已持续很长时间。在多个不连锁的核标记上出现强烈的、一致的结构，需要足够的分化时间或非常有限的基因流。\n- 因此，在近期单一避难所扩张的情景下，预期不会出现极低mtDNA多样性与高核DNA多样性以及多个不连锁核标记上高$F_{ST}$值的组合；这种组合需要引入异常迅速且普遍的全基因组范围的趋异选择，才能在许多中性标记上产生强烈的结构，而这是不太可能的。\n\n2) 长期区域性占据后发生线粒体选择性清除假说下的预期：\n- 如果种群长期隔离在基因流有限的多个山脉中，中性核标记应显示出高多样性和强烈的种群间分化（高$F_{ST}$），反映了在不同种群单元（deme）中的深度溯祖时间和遗传漂变。\n- mtDNA是不重组且母系遗传的，近期发生在mtDNA上的选择性清除将通过遗传搭便车（hitchhiking）效应清除整个物种的线粒体变异，从而产生单一的高频mtDNA单倍型和少数仅相差一两个突变的近缘变体。由于清除仅限于线粒体基因组，它不会使不连锁的核标记同质化，因此核DNA的多样性和结构得以保留。\n- 因此，低mtDNA多样性与遍布所有山脉的占主导地位的单倍型，再加上多个不连锁核标记上的高且结构化的多样性，这与叠加在长期种群结构之上的近期线粒体选择性清除的特征完全匹配。\n\n3) 选项评估：\n- A：不完整，且与核数据相矛盾；瓶颈/扩张应降低核多样性并减弱中性结构，而不是在不连锁的核基因座上产生高$F_{ST}$。\n- B：与观察到的深度核分化和强烈结构一致，同时由于近期的清除事件，整个物种的mtDNA多样性丧失。\n- C：数据并不矛盾；在考虑mtDNA与核DNA不同的遗传和重组特性时，这些数据具有诊断性。\n- D：需要跨多个不连锁基因座的快速、强烈且普遍的局域适应才能在近期扩张后产生高$F_{ST}$，这是不太可能的，特别是考虑到中性标记。它也未能解释严重奠基者事件后的高核多样性。\n- E：机理陈述不正确；一个基因组中的选择性清除不会导致另一基因组中多样性或结构的增加。\n\n因此，得到最有力支持的结论是，线粒体选择性清除假说得到了低且同质化的mtDNA多样性与高且结构化的核多样性组合的支持。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "现代系统地理学研究正日益从定性模式描述转向定量的、基于模型的假说检验。范围扩张等复杂的种群动态过程会在基因组中留下可预测的空间遗传印记。这项练习  将带您亲手实践如何将抽象的理论概念转化为可计算的汇总统计量，如杂合度梯度（$b_H$）、方向性指数（$\\Psi$）和私有等位基因梯度（$b_P$）。这不仅是一次编程挑战，更是对现代计算系统地理学核心逻辑的深刻体验，为您将来应用近似贝叶斯计算（ABC）等高级方法奠定基础。",
            "id": "2744109",
            "problem": "您将执行一项基于谱系地理学的概念设计任务，重点是区分伴随等位基因冲浪的范围扩张与距离隔离平衡。您必须将生物学定义转化为可执行的算法，并利用精心定义的摘要统计量，构建一个受近似贝叶斯计算（ABC）启发的简单决策规则。\n\n考虑一个一维样带，其中包含位于位置 $x_{\\ell}$（$\\ell = 1, \\dots, L$）的多个种群（亚群）。在 $S$ 个独立的双等位基因位点中的每一个位点上，您从种群 $\\ell$ 中观察到一个大小为 $n$ 基因拷贝（单倍体计数）的样本中衍生等位基因的计数 $k_{\\ell,s}$。衍生等位基因的频率为 $p_{\\ell,s} = k_{\\ell,s} / n$。假设 $n$ 在所有位点和种群中均保持不变。对于以下所有公式，请严格按照其表述来解释求和与平均值。所有计算都应使用实数进行。\n\n使用以下基本定义：\n- 等位基因频率定义为 $p = k/n$。\n- 具有等位基因频率 $p$ 的双等位基因座的期望杂合度为 $H = 2p(1-p)$。\n- 变量 $Y$ 和 $X$ 之间的样本协方差为 $\\mathrm{Cov}(X,Y) = \\frac{1}{L} \\sum_{\\ell=1}^{L} (X_{\\ell} - \\bar{X})(Y_{\\ell} - \\bar{Y})$，其中 $\\bar{X}$ 和 $\\bar{Y}$ 是样本均值。\n- 样本方差为 $\\mathrm{Var}(X) = \\mathrm{Cov}(X,X)$。\n- 当 $\\mathrm{Var}(X) > 0$ 时，$Y$ 对 $X$ 回归的最小二乘斜率为 $b_{Y|X} = \\frac{\\mathrm{Cov}(X,Y)}{\\mathrm{Var}(X)}$。\n- 两个长度为 $L$ 的向量 $u$ 和 $v$ 之间的皮尔逊相关性为 $r(u,v) = \\frac{\\mathrm{Cov}(u,v)}{\\sqrt{\\mathrm{Var}(u)\\,\\mathrm{Var}(v)}}$，如果 $\\mathrm{Var}(u) = 0$ 或 $\\mathrm{Var}(v) = 0$，则定义为 $0$。\n\n根据这些定义，推导并实现以下摘要统计量：\n1. 杂合度梯度。对于每个种群 $\\ell$，计算所有位点的平均期望杂合度，\n   $$H_{\\ell} = \\frac{1}{S} \\sum_{s=1}^{S} 2 p_{\\ell,s}\\left(1-p_{\\ell,s}\\right)。$$\n   将 $H_{\\ell}$ 对距离 $x_{\\ell}$ 进行回归，以获得斜率\n   $$b_H = \\frac{\\mathrm{Cov}(x, H)}{\\mathrm{Var}(x)}。$$\n2. 方向性指数。对于每个位点 $s$，计算所有种群中 $x_{\\ell}$ 与 $p_{\\ell,s}$ 之间的皮尔逊相关性，\n   $$r_s = r\\left(\\{x_{\\ell}\\}_{\\ell=1}^{L}, \\{p_{\\ell,s}\\}_{\\ell=1}^{L}\\right)。$$\n   将方向性指数定义为所有位点的平均相关性，\n   $$\\Psi = \\frac{1}{S} \\sum_{s=1}^{S} r_s。$$\n3. 私有等位基因梯度。对于每个种群 $\\ell$，将私有衍生等位基因计数 $C_{\\ell}$ 定义为满足 $k_{\\ell,s} > 0$ 且对于所有 $m \\neq \\ell$ 都有 $k_{m,s} = 0$ 的位点 $s$ 的数量。私有等位基因率为 $R_{\\ell} = C_{\\ell}/S$。将 $R_{\\ell}$ 对 $x_{\\ell}$ 进行回归，以获得\n   $$b_P = \\frac{\\mathrm{Cov}(x, R)}{\\mathrm{Var}(x)}。$$\n\n使用这些统计量的符号设计一个受ABC启发的决策规则。对于一个假设的从低 $x$ 到高 $x$ 的扩张（源头位于最小的 $x$ 处），伴随等位基因冲浪的范围扩张通常会导致杂合度随距离递减、衍生等位基因频率随距离呈渐变式增加，以及私有等位基因在扩张前沿富集。基于此逻辑，如果以下三个不等式中至少有两个成立，则将数据集分类为扩张：$b_H < 0$，$\\Psi > 0$， $b_P > 0$。否则，将其分类为距离隔离平衡。分类结果必须是布尔值。\n\n实现一个程序，为下方的每个测试用例计算 $(b_H, \\Psi, b_P)$ 并输出分类结果。您的程序必须生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，“[True,False,True]”）。\n\n测试套件：\n- 案例A（类扩张）。使用 $L = 5$， $S = 8$， $n = 20$。距离 $x = [$0$, $1$, $2$, $3$, $4$]$。衍生等位基因计数 $k_{\\ell,s}$ 以长度为 $S$ 的行给出，对应种群 $\\ell = 1, \\dots, 5$：\n  - $\\ell=1$：[$8$, $7$, $6$, $4$, $0$, $0$, $5$, $3$]\n  - $\\ell=2$：[$10$, $9$, $8$, $6$, $0$, $0$, $7$, $4$]\n  - $\\ell=3$：[$12$, $12$, $11$, $10$, $0$, $0$, $9$, $5$]\n  - $\\ell=4$：[$14$, $15$, $14$, $14$, $0$, $0$, $11$, $6$]\n  - $\\ell=5$：[$17$, $18$, $17$, $18$, $20$, $18$, $14$, $8$]\n- 案例B（类距离隔离平衡）。使用 $L = 5$， $S = 8$， $n = 20$。距离 $x = [$0$, $1$, $2$, $3$, $4$]$。衍生等位基因计数 $k_{\\ell,s}$ 如下：\n  - $\\ell=1$：[$10$, $8$, $12$, $7$, $1$, $9$, $11$, $10$]\n  - $\\ell=2$：[$11$, $9$, $11$, $8$, $0$, $10$, $10$, $10$]\n  - $\\ell=3$：[$10$, $10$, $10$, $10$, $1$, $10$, $9$, $10$]\n  - $\\ell=4$：[$9$, $9$, $11$, $8$, $0$, $10$, $10$, $10$]\n  - $\\ell=5$：[$10$, $8$, $12$, $7$, $1$, $9$, $11$, $10$]\n- 案例C（渐变性最小的边缘案例）。使用 $L = 4$， $S = 6$, $n = 20$。距离 $x = [$0$, $1$, $2$, $3$]$。衍生等位基因计数 $k_{\\ell,s}$ 如下：\n  - $\\ell=1$：[$10$, $6$, $14$, $2$, $0$, $8$]\n  - $\\ell=2$：[$10$, $6$, $14$, $0$, $0$, $8$]\n  - $\\ell=3$：[$10$, $6$, $14$, $0$, $0$, $8$]\n  - $\\ell=4$：[$10$, $6$, $14$, $0$, $2$, $8$]\n\n您的程序应生成单行输出，其中按顺序包含三个案例的布尔分类结果，格式为用方括号括起来的逗号分隔列表。方括号内不允许有空格。输出必须严格遵循格式“[result_A,result_B,result_C]”。答案中不要求使用物理单位或角度单位，也不使用百分比。最终输出为布尔值。",
            "solution": "问题陈述经过验证。\n\n步骤1：提取已知信息。\n- 一个一维样带，其中种群位于位置 $x_{\\ell}$，$\\ell = 1, \\dots, L$。\n- 在 $S$ 个独立的双等位基因座中的每一个位点上，从一个大小为 $n$ 的样本中得到衍生等位基因的计数 $k_{\\ell,s}$。\n- 衍生等位基因频率为 $p_{\\ell,s} = k_{\\ell,s} / n$。\n- $n$ 是恒定的。\n- 基本定义：\n  - 等位基因频率：$p = k/n$。\n  - 期望杂合度：$H = 2p(1-p)$。\n  - 样本协方差：$\\mathrm{Cov}(X,Y) = \\frac{1}{L} \\sum_{\\ell=1}^{L} (X_{\\ell} - \\bar{X})(Y_{\\ell} - \\bar{Y})$。\n  - 样本方差：$\\mathrm{Var}(X) = \\mathrm{Cov}(X,X)$。\n  - 最小二乘斜率：当 $\\mathrm{Var}(X) > 0$ 时，$b_{Y|X} = \\frac{\\mathrm{Cov}(X,Y)}{\\mathrm{Var}(X)}$。\n  - 皮尔逊相关性：$r(u,v) = \\frac{\\mathrm{Cov}(u,v)}{\\sqrt{\\mathrm{Var}(u)\\,\\mathrm{Var}(v)}}$，如果 $\\mathrm{Var}(u) = 0$ 或 $\\mathrm{Var}(v) = 0$，则定义为 $0$。\n- 需要推导的摘要统计量：\n  1. 杂合度梯度，$b_H$：平均期望杂合度 $H_{\\ell} = \\frac{1}{S} \\sum_{s=1}^{S} 2 p_{\\ell,s}(1-p_{\\ell,s})$ 对距离 $x_{\\ell}$ 回归的斜率。\n  2. 方向性指数，$\\Psi$：所有位点 $s$ 的皮尔逊相关性 $r_s = r(\\{x_{\\ell}\\}, \\{p_{\\ell,s}\\})$ 的均值，即 $\\Psi = \\frac{1}{S} \\sum_{s=1}^{S} r_s$。\n  3. 私有等位基因梯度，$b_P$：私有等位基因率 $R_{\\ell} = C_{\\ell}/S$ 对距离 $x_{\\ell}$ 回归的斜率，其中 $C_{\\ell}$ 是满足 $k_{\\ell,s} > 0$ 且对所有 $m \\neq \\ell$ 都有 $k_{m,s} = 0$ 的位点 $s$ 的数量。\n- 决策规则：\n  - 如果以下三个不等式中至少有两个成立，则数据集代表范围扩张：$b_H < 0$，$\\Psi > 0$， $b_P > 0$。否则，分类为距离隔离平衡。\n- 测试用例：提供了三个特定的数据集（A、B、C），每个数据集都指定了参数 $L$、$S$、$n$ 以及种群位置 $x$ 和等位基因计数 $k$ 的数据。\n\n步骤2：使用提取的已知信息进行验证。\n根据验证标准对问题进行评估。\n- **科学依据充分**：该问题基于演化生物学和群体遗传学中已建立的概念，特别是谱系地理学。所描述的现象（范围扩张、等位基因冲浪、距离隔离）以及所使用的遗传指标（杂合度、等位基因频率梯度、私有等位基因）都是该领域的核心内容。扩张的预期特征（$b_H < 0$、$\\Psi > 0$、 $b_P > 0$）与该领域的开创性理论和实证工作一致。该问题在科学上是合理的。\n- **定义明确**：该问题提供了所有必要的定义、公式、数据以及一个清晰、无歧义的决策规则。每个术语都得到了精确定义，并且通往解决方案的计算路径也已明确阐述。该问题是自洽的，其结构保证了每个测试用例都有唯一的解。\n- **客观性**：该问题以精确、量化和正式的语言陈述。它不含主观论断、推测或模棱两可之处。\n\n步骤3：结论与行动。\n该问题被判定为**有效**。这是一个基于可靠科学原理的、严谨且自洽的计算任务。将提供解决方案。\n\n该任务是实现一个算法，根据一个受近似贝叶斯计算（ABC）启发的决策规则对基因组数据集进行分类。该分类旨在区分两种人口统计学情景：伴随等位基因冲浪的范围扩张和距离隔离平衡。这需要从沿空间样带的等位基因计数数据中计算三个摘要统计量。\n\n该算法采用模块化方式设计，首先计算主要的遗传量，然后利用这些量构建所需的三个摘要统计量。\n\n**1. 数据准备**\n\n每个数据集的原始输入包括种群数量 $L$、位点数量 $S$、每个种群的样本量 $n$、种群位置向量 $x = \\{x_{\\ell}\\}_{\\ell=1}^{L}$ 以及衍生等位基因计数矩阵 $k = \\{k_{\\ell,s}\\}$。第一步是将等位基因计数转换为频率。对于每个种群 $\\ell$ 和位点 $s$，衍生等位基因频率计算如下：\n$$p_{\\ell,s} = \\frac{k_{\\ell,s}}{n}$$\n这将得到一个 $L \\times S$ 的等位基因频率矩阵 $p$。\n\n**2. 摘要统计量的计算**\n\n算法的核心在于从位置 $x$ 和遗传数据（$p$ 和 $k$）中计算三个指定的摘要统计量（$b_H$、$\\Psi$、 $b_P$）。样本协方差和方差的计算严格遵循给定的公式，该公式使用 $1/L$ 作为归一化因子。\n\n**统计量1：杂合度梯度 ($b_H$)**\n该统计量衡量遗传多样性的渐变趋势。\n- 首先，对于每个种群 $\\ell$，通过对所有 $S$ 个位点进行平均来计算平均期望杂合度 $H_{\\ell}$。单个双等位基因位点的期望杂合度为 $H = 2p(1-p)$。\n$$H_{\\ell} = \\frac{1}{S} \\sum_{s=1}^{S} 2 p_{\\ell,s}(1-p_{\\ell,s})$$\n这将得到一个长度为 $L$ 的向量 $H = \\{H_{\\ell}\\}_{\\ell=1}^{L}$。\n- 接下来，计算 $H$ 对 $x$ 回归的最小二乘斜率 $b_H$。\n$$b_H = \\frac{\\mathrm{Cov}(x, H)}{\\mathrm{Var}(x)}$$\n其中 $\\mathrm{Var}(x) = \\frac{1}{L} \\sum_{\\ell=1}^{L} (x_{\\ell} - \\bar{x})^2$ 且 $\\mathrm{Cov}(x, H) = \\frac{1}{L} \\sum_{\\ell=1}^{L} (x_{\\ell} - \\bar{x})(H_{\\ell} - \\bar{H})$。$b_H$ 的负值表示杂合度倾向于随样带距离的增加而降低，这是范围扩张的一个典型特征。\n\n**统计量2：方向性指数 ($\\Psi$)**\n该统计量量化等位基因频率的整体方向性趋势。\n- 对于每个位点 $s$，计算种群位置向量 $x$ 与该位点的等位基因频率向量 $\\{p_{\\ell,s}\\}_{\\ell=1}^{L}$ 之间的皮尔逊相关系数 $r_s$。\n$$r_s = \\frac{\\mathrm{Cov}(x, \\{p_{\\ell,s}\\})}{\\sqrt{\\mathrm{Var}(x)\\,\\mathrm{Var}(\\{p_{\\ell,s}\\})}}$$\n根据问题定义，如果任一向量的方差为零，则 $r_s$ 取值为 $0$。\n- 方向性指数 $\\Psi$ 则是这些相关系数在所有位点上的平均值。\n$$\\Psi = \\frac{1}{S} \\sum_{s=1}^{S} r_s$$\n$\\Psi > 0$ 的值表明衍生等位基因频率随距离系统性增加，这是从低 $x$ 到高 $x$ 扩张过程中等位基因冲浪所预期的模式。\n\n**统计量3：私有等位基因梯度 ($b_P$)**\n该统计量衡量稀有、地理上局限的等位基因的空间分布。\n- 首先，对于每个种群 $\\ell$，我们计算私有衍生等位基因的数量 $C_{\\ell}$。如果位点 $s$ 上的一个等位基因在该种群中存在（$k_{\\ell,s} > 0$），但在所有其他种群中均不存在（对所有 $m \\neq \\ell$ 均有 $k_{m,s} = 0$），则该等位基因是种群 $\\ell$ 的私有等位基因。\n- 将计数 $C_{\\ell}$ 除以位点总数 $S$，将其转换为一个比率。\n$$R_{\\ell} = \\frac{C_{\\ell}}{S}$$\n这将生成一个向量 $R = \\{R_{\\ell}\\}_{\\ell=1}^{L}$。\n- 最后，计算私有等位基因率 $R$ 对位置向量 $x$ 回归的斜率 $b_P$。\n$$b_P = \\frac{\\mathrm{Cov}(x, R)}{\\mathrm{Var}(x)}$$\n$b_P$ 的正值表示私有等位基因在扩张前沿（较大的 $x$）更为常见，这是等位基因冲浪的一个典型后果。\n\n**3. 决策规则**\n\n最终的分类通过应用指定的决策规则来完成。如果以下三个条件中至少有两个得到满足，则数据集被分类为“扩张”（输出 `True`）：\n1. $b_H < 0$\n2. $\\Psi > 0$\n3. $b_P > 0$\n\n如果满足的条件少于两个，则数据集被分类为“距离隔离平衡”（输出 `False`）。此完整过程独立地应用于提供的每个测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the phylogeography classification problem for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"L\": 5, \"S\": 8, \"n\": 20,\n            \"x\": np.array([0, 1, 2, 3, 4], dtype=float),\n            \"k\": np.array([\n                [8, 7, 6, 4, 0, 0, 5, 3],\n                [10, 9, 8, 6, 0, 0, 7, 4],\n                [12, 12, 11, 10, 0, 0, 9, 5],\n                [14, 15, 14, 14, 0, 0, 11, 6],\n                [17, 18, 17, 18, 20, 18, 14, 8],\n            ], dtype=float)\n        },\n        {\n            \"L\": 5, \"S\": 8, \"n\": 20,\n            \"x\": np.array([0, 1, 2, 3, 4], dtype=float),\n            \"k\": np.array([\n                [10, 8, 12, 7, 1, 9, 11, 10],\n                [11, 9, 11, 8, 0, 10, 10, 10],\n                [10, 10, 10, 10, 1, 10, 9, 10],\n                [9, 9, 11, 8, 0, 10, 10, 10],\n                [10, 8, 12, 7, 1, 9, 11, 10],\n            ], dtype=float)\n        },\n        {\n            \"L\": 4, \"S\": 6, \"n\": 20,\n            \"x\": np.array([0, 1, 2, 3], dtype=float),\n            \"k\": np.array([\n                [10, 6, 14, 2, 0, 8],\n                [10, 6, 14, 0, 0, 8],\n                [10, 6, 14, 0, 0, 8],\n                [10, 6, 14, 0, 2, 8],\n            ], dtype=float)\n        }\n    ]\n\n    def _cov(X, Y):\n        \"\"\"Computes sample covariance with 1/L normalization.\"\"\"\n        if len(X) == 0: return 0.0\n        X_bar = np.mean(X)\n        Y_bar = np.mean(Y)\n        return np.sum((X - X_bar) * (Y - Y_bar)) / len(X)\n\n    def _var(X):\n        \"\"\"Computes sample variance with 1/L normalization.\"\"\"\n        if len(X) == 0: return 0.0\n        return _cov(X, X)\n\n    def _pearson_r(u, v):\n        \"\"\"Computes Pearson correlation coefficient.\"\"\"\n        var_u = _var(u)\n        var_v = _var(v)\n        if var_u == 0 or var_v == 0:\n            return 0.0\n        cov_uv = _cov(u, v)\n        return cov_uv / np.sqrt(var_u * var_v)\n\n    def _slope(Y, X):\n        \"\"\"Computes least-squares slope of Y regressed on X.\"\"\"\n        var_x = _var(X)\n        if var_x == 0:\n            return 0.0 # Or handle as error, problem implies Var(x)>0\n        cov_xy = _cov(X, Y)\n        return cov_xy / var_x\n        \n    def classify(L, S, n, x, k):\n        \"\"\"\n        Computes the three summary statistics and applies the decision rule.\n        \"\"\"\n        p = k / n\n\n        # 1. Heterozygosity gradient (b_H)\n        H_matrix = 2 * p * (1 - p)\n        H_vector = np.mean(H_matrix, axis=1)\n        b_H = _slope(H_vector, x)\n\n        # 2. Directionality index (Psi)\n        correlations = []\n        p_T = p.T # Transpose to iterate over loci\n        for s in range(S):\n            p_s_vector = p_T[s]\n            r_s = _pearson_r(x, p_s_vector)\n            correlations.append(r_s)\n        Psi = np.mean(correlations) if correlations else 0.0\n\n        # 3. Private allele gradient (b_P)\n        C_vector = np.zeros(L)\n        k_T = k.T # Transpose to iterate over loci\n        for s in range(S):\n            k_s_vector = k_T[s]\n            # A locus has a private allele if exactly one deme has non-zero count\n            if np.count_nonzero(k_s_vector) == 1:\n                # Find which deme has the private allele\n                l_private = np.nonzero(k_s_vector)[0][0]\n                C_vector[l_private] += 1\n        \n        R_vector = C_vector / S\n        b_P = _slope(R_vector, x)\n        \n        # Decision Rule\n        conditions_met = 0\n        if b_H  0:\n            conditions_met += 1\n        if Psi > 0:\n            conditions_met += 1\n        if b_P > 0:\n            conditions_met += 1\n        \n        return conditions_met >= 2\n\n    results = []\n    for case in test_cases:\n        result = classify(case[\"L\"], case[\"S\"], case[\"n\"], case[\"x\"], case[\"k\"])\n        results.append(result)\n\n    # Format the final output string exactly as specified.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}