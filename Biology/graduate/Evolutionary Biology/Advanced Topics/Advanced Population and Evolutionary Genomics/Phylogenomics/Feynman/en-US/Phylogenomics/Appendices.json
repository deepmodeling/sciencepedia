{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of molecular dating is the molecular clock hypothesis, which posits that substitutions accumulate at a roughly constant rate over time. When this holds true, the evolutionary distances in a phylogeny exhibit a special property called ultrametricity. This exercise provides a direct, hands-on method to test this critical assumption by applying the three-point condition to a distance matrix, allowing you to quantitatively assess the clock-like behavior of evolutionary data before attempting to estimate divergence times .",
            "id": "2743629",
            "problem": "A genomics consortium assembled whole-genome alignments of five single-copy orthologs from five taxa, labeled $\\{A,B,C,D,E\\}$. From the alignments, they estimated pairwise evolutionary path distances under a time-reversible substitution model, reporting distances in substitutions per site. For a strictly clock-like (ultrametric) divergence process, the three-point condition states that, for any triple of taxa $\\{i,j,k\\}$, among the three pairwise distances $\\{d_{ij},d_{ik},d_{jk}\\}$, the two largest values are equal in the noise-free limit. To operationalize a test of ultrametricity that is agnostic to tree topology, define the ultrametric deviation index\n$$\nU \\equiv \\max_{\\{i,j,k\\}} \\left(\\max\\{d_{ij},d_{ik},d_{jk}\\} - \\text{second\\_largest}\\{d_{ij},d_{ik},d_{jk}\\}\\right),\n$$\nwhich is zero if and only if all triples satisfy the three-point condition exactly. You are given the following symmetric distance matrix $\\mathbf{D}=(d_{ij})$ in the taxon order $(A,B,C,D,E)$, with diagonal entries equal to $0$:\n$$\n\\mathbf{D}=\n\\begin{pmatrix}\n0 & 0.608 & 0.992 & 0.998 & 1.004 \\\\\n0.608 & 0 & 0.996 & 1.006 & 1.002 \\\\\n0.992 & 0.996 & 0 & 0.406 & 0.398 \\\\\n0.998 & 1.006 & 0.406 & 0 & 0.304 \\\\\n1.004 & 1.002 & 0.398 & 0.304 & 0\n\\end{pmatrix}.\n$$\nStarting only from the core definition of ultrametricity via the three-point condition, compute the ultrametric deviation index $U$ for this matrix. Then, based on the commonly used decision rule that a strict molecular clock model is plausible if $U \\leq \\delta$ with $\\delta=0.020$ substitutions per site (reflecting typical genome-scale sampling noise), assess plausibility in your reasoning. Report only the value of $U$, rounded to four significant figures, and express the result in substitutions per site.",
            "solution": "The problem requires the computation of the ultrametric deviation index, denoted $U$, for a given pairwise distance matrix $\\mathbf{D}$. The validity of the problem statement is confirmed, as it is scientifically grounded, well-posed, and objective. I will proceed with the solution.\n\nThe set of five taxa is labeled $\\{A,B,C,D,E\\}$, which we may index as $\\{1,2,3,4,5\\}$ respectively. The provided symmetric distance matrix is:\n$$\n\\mathbf{D}=\n\\begin{pmatrix}\n0 & 0.608 & 0.992 & 0.998 & 1.004 \\\\\n0.608 & 0 & 0.996 & 1.006 & 1.002 \\\\\n0.992 & 0.996 & 0 & 0.406 & 0.398 \\\\\n0.998 & 1.006 & 0.406 & 0 & 0.304 \\\\\n1.004 & 1.002 & 0.398 & 0.304 & 0\n\\end{pmatrix}.\n$$\nThe ultrametric deviation index $U$ is defined as the maximum deviation from the three-point condition over all possible triples of taxa $\\{i,j,k\\}$:\n$$\nU \\equiv \\max_{\\{i,j,k\\}} \\left(\\max\\{d_{ij},d_{ik},d_{jk}\\} - \\text{second\\_largest}\\{d_{ij},d_{ik},d_{jk}\\}\\right).\n$$\nFor $n=5$ taxa, there are $\\binom{5}{3} = \\frac{5!}{3!2!} = 10$ unique triples to evaluate. Let $\\Delta_{ijk}$ denote the deviation for a given triple $\\{i,j,k\\}$. We must compute $\\Delta_{ijk}$ for all $10$ triples.\n\nThe pairwise distances $d_{ij}$ are:\n$d_{12} = 0.608$, $d_{13} = 0.992$, $d_{14} = 0.998$, $d_{15} = 1.004$\n$d_{23} = 0.996$, $d_{24} = 1.006$, $d_{25} = 1.002$\n$d_{34} = 0.406$, $d_{35} = 0.398$\n$d_{45} = 0.304$\n\nWe now evaluate the deviation for each triple:\n\n$1$. Triple $\\{1,2,3\\}$: Distances are $\\{d_{12}, d_{13}, d_{23}\\} = \\{0.608, 0.992, 0.996\\}$.\nThe two largest are $0.996$ and $0.992$.\n$\\Delta_{123} = 0.996 - 0.992 = 0.004$.\n\n$2$. Triple $\\{1,2,4\\}$: Distances are $\\{d_{12}, d_{14}, d_{24}\\} = \\{0.608, 0.998, 1.006\\}$.\nThe two largest are $1.006$ and $0.998$.\n$\\Delta_{124} = 1.006 - 0.998 = 0.008$.\n\n$3$. Triple $\\{1,2,5\\}$: Distances are $\\{d_{12}, d_{15}, d_{25}\\} = \\{0.608, 1.004, 1.002\\}$.\nThe two largest are $1.004$ and $1.002$.\n$\\Delta_{125} = 1.004 - 1.002 = 0.002$.\n\n$4$. Triple $\\{1,3,4\\}$: Distances are $\\{d_{13}, d_{14}, d_{34}\\} = \\{0.992, 0.998, 0.406\\}$.\nThe two largest are $0.998$ and $0.992$.\n$\\Delta_{134} = 0.998 - 0.992 = 0.006$.\n\n$5$. Triple $\\{1,3,5\\}$: Distances are $\\{d_{13}, d_{15}, d_{35}\\} = \\{0.992, 1.004, 0.398\\}$.\nThe two largest are $1.004$ and $0.992$.\n$\\Delta_{135} = 1.004 - 0.992 = 0.012$.\n\n$6$. Triple $\\{1,4,5\\}$: Distances are $\\{d_{14}, d_{15}, d_{45}\\} = \\{0.998, 1.004, 0.304\\}$.\nThe two largest are $1.004$ and $0.998$.\n$\\Delta_{145} = 1.004 - 0.998 = 0.006$.\n\n$7$. Triple $\\{2,3,4\\}$: Distances are $\\{d_{23}, d_{24}, d_{34}\\} = \\{0.996, 1.006, 0.406\\}$.\nThe two largest are $1.006$ and $0.996$.\n$\\Delta_{234} = 1.006 - 0.996 = 0.010$.\n\n$8$. Triple $\\{2,3,5\\}$: Distances are $\\{d_{23}, d_{25}, d_{35}\\} = \\{0.996, 1.002, 0.398\\}$.\nThe two largest are $1.002$ and $0.996$.\n$\\Delta_{235} = 1.002 - 0.996 = 0.006$.\n\n$9$. Triple $\\{2,4,5\\}$: Distances are $\\{d_{24}, d_{25}, d_{45}\\} = \\{1.006, 1.002, 0.304\\}$.\nThe two largest are $1.006$ and $1.002$.\n$\\Delta_{245} = 1.006 - 1.002 = 0.004$.\n\n$10$. Triple $\\{3,4,5\\}$: Distances are $\\{d_{34}, d_{35}, d_{45}\\} = \\{0.406, 0.398, 0.304\\}$.\nThe two largest are $0.406$ and $0.398$.\n$\\Delta_{345} = 0.406 - 0.398 = 0.008$.\n\nThe set of calculated deviations is $\\{0.004, 0.008, 0.002, 0.006, 0.012, 0.006, 0.010, 0.006, 0.004, 0.008\\}$.\nThe ultrametric deviation index $U$ is the maximum of these values:\n$$\nU = \\max\\{0.004, 0.008, 0.002, 0.006, 0.012, 0.006, 0.010, 0.006, 0.004, 0.008\\} = 0.012.\n$$\nThe value $0.012$ is an exact result of the subtractions. The problem requires rounding to four significant figures. The significant figures in $0.012$ are $1$ and $2$. To express this with four significant figures, we must add trailing zeros, yielding $0.01200$.\n\nFinally, the problem asks to assess plausibility based on the decision rule $U \\leq \\delta$, with the threshold $\\delta = 0.020$ substitutions per site. We have computed $U = 0.012$. Comparing this to the threshold:\n$$\n0.012 \\leq 0.020.\n$$\nSince the computed ultrametric deviation index $U$ is less than or equal to the specified threshold $\\delta$, the hypothesis of a strict molecular clock (ultrametricity) is considered plausible for this dataset under the given decision rule.\nThe final required output is the value of $U$ rounded to four significant figures.",
            "answer": "$$\\boxed{0.01200}$$"
        },
        {
            "introduction": "Phylogenomic data allows us to move beyond simple tree reconstruction and test specific, complex evolutionary hypotheses. This problem delves into the fascinating phenomenon of trans-species polymorphism, where ancestral genetic variants persist through a speciation event. You will act as a genomic detective, using molecular clock principles to calculate the age of a chromosomal inversion and determine if it predates the split between two species, while also learning how to correct for confounding processes like post-speciation gene flow .",
            "id": "2307569",
            "problem": "Two closely related insect species, *Divergens volans* and *Divergens quietus*, are studied to understand the genomic basis of their speciation. *D. volans* is known to be polymorphic for a large chromosomal inversion on its third chromosome, with individuals carrying either the standard (S) or the inverted (I) arrangement. In contrast, its sister species, *D. quietus*, is found to be entirely fixed for the inverted (I) arrangement. Genetic analysis of a distant outgroup species, *Divergens primus*, confirms it is fixed for the standard (S) arrangement, establishing S as the ancestral state.\n\nOne leading hypothesis is that this inversion represents a case of trans-species polymorphism, where the inversion arose in the common ancestral population of *D. volans* and *D. quietus*. Under this model, both the S and I arrangements were maintained by balancing selection for a significant period before the speciation event, and were then differentially sorted in the two daughter lineages.\n\nTo test this, you are provided with the following phylogenomic data:\n1.  The average pairwise nucleotide divergence between the standard (S) and inverted (I) haplotypes, sampled from within the *D. volans* population and calculated using loci inside the inversion, is $d_{in} = 0.050$.\n2.  The average pairwise nucleotide divergence between *D. volans* and *D. quietus*, calculated from a large set of autosomal loci located far from the inversion where recombination is frequent, is $d_{out} = 0.031$.\n3.  The fossil-calibrated neutral mutation rate for this genus is $\\mu = 1.25 \\times 10^{-3}$ substitutions per site per million years. You can relate divergence ($d$) to time ($T$) using the molecular clock formula $T = \\frac{d}{2\\mu}$, where the factor of 2 accounts for divergence accumulating on two separate lineages.\n4.  Advanced demographic modeling, which accounts for factors like Incomplete Lineage Sorting (ILS), has revealed that a sustained low level of gene flow occurred between the two species after their initial split. This introgression affected only the freely recombining regions of the genome (i.e., those outside the inversion). The quantifiable impact of this gene flow is that the observed divergence at these unlinked loci ($d_{out}$) yields an apparent speciation time that is 25% shorter than the true, actual speciation time.\n\nBased on this information, calculate the duration, in millions of years, that the S/I polymorphism was maintained in the common ancestral population before the lineages leading to *D. volans* and *D. quietus* split. Express your answer in millions of years, rounded to two significant figures.",
            "solution": "We are asked for the time interval during which the S/I inversion polymorphism was maintained in the common ancestral population prior to the speciation split. Let $T_{\\text{inv}}$ be the age of the inversion (time since the S and I haplotype classes began diverging) and $T_{\\text{spec}}$ be the true speciation time. The desired duration is\n$$\nT_{\\text{ancestral}}=T_{\\text{inv}}-T_{\\text{spec}}.\n$$\n\nBy the molecular clock, for two lineages diverging neutrally,\n$$\nT=\\frac{d}{2\\mu}.\n$$\nThus, using the divergence inside the inversion between S and I within *D. volans*,\n$$\nT_{\\text{inv}}=\\frac{d_{\\text{in}}}{2\\mu}.\n$$\n\nFor the speciation time, the freely recombining loci give an apparent time\n$$\nT_{\\text{app}}=\\frac{d_{\\text{out}}}{2\\mu},\n$$\nbut post-split introgression makes this apparent time shorter than the true time by a factor of $1-0.25=0.75$, i.e.,\n$$\nT_{\\text{app}}=0.75\\,T_{\\text{spec}} \\quad \\Rightarrow \\quad T_{\\text{spec}}=\\frac{T_{\\text{app}}}{0.75}.\n$$\n\nPutting this together,\n$$\nT_{\\text{ancestral}}=\\frac{d_{\\text{in}}}{2\\mu}-\\frac{1}{0.75}\\cdot\\frac{d_{\\text{out}}}{2\\mu}.\n$$\n\nNow substitute the given values $d_{\\text{in}}=0.050$, $d_{\\text{out}}=0.031$, and $\\mu=1.25 \\times 10^{-3}$ substitutions per site per million years:\n$$\nT_{\\text{inv}}=\\frac{0.050}{2\\cdot 1.25\\times 10^{-3}}=\\frac{0.050}{2.5\\times 10^{-3}}=20,\n$$\n$$\nT_{\\text{app}}=\\frac{0.031}{2\\cdot 1.25\\times 10^{-3}}=\\frac{0.031}{2.5\\times 10^{-3}}=12.4,\n$$\n$$\nT_{\\text{spec}}=\\frac{12.4}{0.75}=16.533\\overline{3},\n$$\n$$\nT_{\\text{ancestral}}=20-16.533\\overline{3}=3.466\\overline{6}.\n$$\n\nRounded to two significant figures, this is $3.5$ million years.",
            "answer": "$$\\boxed{3.5}$$"
        },
        {
            "introduction": "While phylogenetic trees are powerful models, evolution is not always a purely bifurcating process; events like hybridization and horizontal gene transfer create reticulate relationships. This advanced exercise introduces you to the frontier of phylogenomics by tasking you with modeling such a reticulate history using a phylogenetic network. You will implement a computational search to find the best-fit network model that explains a collection of discordant gene trees, providing a practical introduction to the principles of network coalescent theory and likelihood-based model selection .",
            "id": "2743622",
            "problem": "You are given a simplified, self-contained estimation task grounded in phylogenomics. The aim is to estimate the number and placement of reticulations that maximize a displayed-tree mixture pseudo-likelihood under a network multispecies coalescent approximation, using a fixed set of taxa and a fixed base species tree. The task is formulated so that it is precisely computable by an algorithm, with a finite candidate set and a rigorous tie-breaking rule.\n\nFundamental base and modeling assumptions:\n- Consider a fixed set of taxa $\\mathcal{X}=\\{A,B,C,D\\}$ and a fixed rooted species tree $T_0=((A,B),(C,D))$, which we denote as the base tree topology $t_{AB|CD}$.\n- Let the set of rooted, fully resolved, binary gene tree topologies on these four taxa be $\\mathcal{G}=\\{t_{AB|CD}, t_{AC|BD}, t_{AD|BC}\\}$. We will index them as $0 \\mapsto t_{AB|CD}$, $1 \\mapsto t_{AC|BD}$, and $2 \\mapsto t_{AD|BC}$.\n- We observe counts $\\mathbf{c}=(c_0,c_1,c_2) \\in \\mathbb{N}^3$ of gene trees falling into each of these three topological classes. The total number of gene trees is $n=c_0+c_1+c_2$.\n\nDisplayed-tree mixture pseudo-likelihood:\n- For any network with at most one reticulation on the base tree, we define a displayed-tree mixture pseudo-model as follows. A reticulation is constructed by choosing an ordered pair of distinct taxa $(x,y)$, interpreted as lineage $x$ receiving an additional parent from the lineage ancestral to $y$. The network is parameterized by an inheritance probability $\\gamma \\in (0,1)$ along the reticulation edge. This yields two displayed trees with positive probability: the base tree $t_{AB|CD}$ with probability $(1-\\gamma)$, and the alternate tree $t_{xy}$ that groups $x$ with $y$ with probability $\\gamma$. The third topology has probability $0$. If $t_{xy}=t_{AB|CD}$, then the mixture degenerates to the base tree with probability $1$.\n- To avoid zero probabilities and preserve normalization, we introduce a contamination (smoothing) parameter $\\delta=10^{-9}$ and define, for each $t \\in \\mathcal{G}$,\n$$\np_\\delta(t) \\;=\\; (1-\\delta)\\,p(t) \\;+\\; \\frac{\\delta}{3},\n$$\nwhere $p(t)$ are the model probabilities given by the displayed-tree mixture above. The smoothed probabilities $p_\\delta(t)$ are strictly positive and sum to $1$.\n- The log pseudo-likelihood for observed counts $\\mathbf{c}$ under candidate model $\\mathcal{M}$ with smoothed probabilities $p_\\delta(t_i)$ is\n$$\n\\ell(\\mathcal{M}\\,;\\,\\mathbf{c}) \\;=\\; \\sum_{i=0}^{2} c_i \\,\\log\\!\\big(p_\\delta(t_i)\\big).\n$$\n\nCandidate model set and optimization:\n- You must consider the following finite candidate set.\n  1. Zero-reticulation model: the base tree only. Denote this as $k=0$ with no parameters, i.e., $p(t_{AB|CD})=1$ and $p(t)=0$ for the other two topologies before smoothing.\n  2. One-reticulation models: for every ordered pair $(x,y)$ of distinct taxa from $\\{A,B,C,D\\}$ and for every $\\gamma$ in the discrete grid $G=\\{0.2,0.5,0.8\\}$, define the network $\\mathcal{N}(x\\leftarrow y,\\gamma)$ as above. Denote these as $k=1$ models.\n- For each test case, among all candidates, choose the model that maximizes the log pseudo-likelihood $\\ell(\\mathcal{M};\\mathbf{c})$.\n- If there are ties (differences less than machine precision), apply the following deterministic tie-breaking rule in this order: prefer smaller $k$; then, for $k=1$, prefer smaller $\\gamma$ in the order $0.2 \\prec 0.5 \\prec 0.8$; then prefer lexicographically smaller ordered pair $(x,y)$ under the taxon order $A \\prec B \\prec C \\prec D$.\n\nMapping between taxon pairs and topologies:\n- For any unordered pair $\\{x,y\\}$, define $t_{xy}$ as the rooted topology that has the cherry (sibling pair) $\\{x,y\\}$. For the base tree $t_{AB|CD}$, the cherries are $\\{A,B\\}$ and $\\{C,D\\}$, so $t_{AB|CD}=t_{AB}=t_{CD}$. The other mappings are $t_{AC|BD}=t_{AC}=t_{BD}$ and $t_{AD|BC}=t_{AD}=t_{BC}$. Thus, for an ordered pair $(x,y)$, the alternate topology is determined by the unordered pair $\\{x,y\\}$.\n\nNumerical test suite:\n- Use the following four independent test cases, each specified by a count vector $\\mathbf{c}=(c_0,c_1,c_2)$:\n  1. $\\mathbf{c}^{(1)}=(95,3,2)$.\n  2. $\\mathbf{c}^{(2)}=(50,45,5)$.\n  3. $\\mathbf{c}^{(3)}=(34,33,33)$.\n  4. $\\mathbf{c}^{(4)}=(0,100,0)$.\n\nRequired output format:\n- For each test case, output either $[0]$ if the optimal model has zero reticulations, or $[1,\\gamma,i,j]$ if the optimal model has one reticulation with inheritance probability $\\gamma \\in \\{0.2,0.5,0.8\\}$ placed on the ordered pair $(x_i, x_j)$, where taxa are indexed as $A \\mapsto 0$, $B \\mapsto 1$, $C \\mapsto 2$, $D \\mapsto 3$.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, for example, $[[0],[1,0.5,0,2],\\dots]$.\n- There are no physical units to report. All angles, if any, are not applicable. Any proportions should be represented as decimals.\n\nYour task: Implement a program that computes, for each test case, the model maximizing the smoothed displayed-tree mixture pseudo-likelihood as defined above, applies the tie-breaking rule, and prints the required aggregated single-line output.",
            "solution": "The problem is valid. It presents a well-posed optimization task grounded in a simplified phylogenomic model. All constants, formulas, candidate models, and tie-breaking rules are specified unambiguously, permitting a unique and computable solution.\n\nThe objective is to identify, for each given vector of gene tree counts $\\mathbf{c}=(c_0, c_1, c_2)$, the model $\\mathcal{M}$ from a finite candidate set that maximizes the log pseudo-likelihood function:\n$$\n\\ell(\\mathcal{M}\\,;\\,\\mathbf{c}) \\;=\\; \\sum_{i=0}^{2} c_i \\,\\log\\!\\big(p_\\delta(t_i)\\big)\n$$\nHere, $t_i$ denotes the $i$-th gene tree topology ($0$ for $t_{AB|CD}$, $1$ for $t_{AC|BD}$, $2$ for $t_{AD|BC}$), $c_i$ is its observed count, and $p_\\delta(t_i)$ is the smoothed probability of observing that topology under model $\\mathcal{M}$.\n\n### Algorithmic Solution\nThe solution is found by systematically evaluating every model in the candidate set and selecting the one that maximizes $\\ell(\\mathcal{M}\\,;\\,\\mathbf{c})$, subject to a deterministic tie-breaking procedure.\n\n**1. Candidate Model Set**\nThe candidate set consists of two classes of models:\n- **The Zero-Reticulation Model ($k=0$)**: This model corresponds to the base species tree $T_0 = ((A,B),(C,D))$ without any reticulation. The unsmoothed probabilities for the three gene tree topologies are $p(t_0)=1$, $p(t_1)=0$, and $p(t_2)=0$.\n- **One-Reticulation Models ($k=1$)**: These models are constructed for each ordered pair of distinct taxa $(x,y)$ from $\\mathcal{X}=\\{A,B,C,D\\}$ and for each inheritance probability $\\gamma$ in the discrete set $G=\\{0.2, 0.5, 0.8\\}$. A model $\\mathcal{N}(x\\leftarrow y, \\gamma)$ generates the base topology $t_0$ with probability $p(t_0) = 1-\\gamma$ and an alternate topology $t_{xy}$ with probability $p(t_{xy}) = \\gamma$. The third topology has probability $0$. There are $4 \\times 3 = 12$ such ordered pairs and $3$ values for $\\gamma$, yielding $36$ one-reticulation models.\n\n**2. Likelihood Calculation**\nFor any model $\\mathcal{M}$, the unsmoothed probabilities $p(t_i)$ are first determined. These are then converted to smoothed probabilities $p_\\delta(t_i)$ using the provided formula with $\\delta=10^{-9}$:\n$$\np_\\delta(t_i) \\;=\\; (1-\\delta)\\,p(t_i) \\;+\\; \\frac{\\delta}{3}\n$$\nThe log pseudo-likelihood is then computed using the given counts $\\mathbf{c}$. If a count $c_i$ is $0$, its corresponding term $c_i \\log(p_\\delta(t_i))$ is $0$ and does not contribute to the sum.\n\n**3. Mapping and Indexing**\nTo implement the algorithm, we use numerical indices:\n- **Taxa**: $A \\mapsto 0$, $B \\mapsto 1$, $C \\mapsto 2$, $D \\mapsto 3$.\n- **Topologies**: $t_{AB|CD} \\mapsto 0$, $t_{AC|BD} \\mapsto 1$, $t_{AD|BC} \\mapsto 2$.\n- **Alternate Topology Mapping**: The alternate topology $t_{xy}$ is determined by the unordered pair $\\{x, y\\}$. The mapping from an unordered pair of taxon indices to a topology index is:\n  - $\\{0,1\\} \\to 0$ ($t_{AB}$) and $\\{2,3\\} \\to 0$ ($t_{CD}$), both corresponding to $t_{AB|CD}$.\n  - $\\{0,2\\} \\to 1$ ($t_{AC}$) and $\\{1,3\\} \\to 1$ ($t_{BD}$), both corresponding to $t_{AC|BD}$.\n  - $\\{0,3\\} \\to 2$ ($t_{AD}$) and $\\{1,2\\} \\to 2$ ($t_{BC}$), both corresponding to $t_{AD|BC}$.\n\n**4. Optimization and Tie-Breaking Algorithm**\nFor each test case $\\mathbf{c}$:\n1.  Initialize the best model as the $k=0$ model. Calculate its log-likelihood $\\ell_0$ and store its parameters and likelihood, for example, as a state tuple $(\\ell_0, k=0, \\gamma=\\infty, i=\\infty, j=\\infty)$. Using infinity for parameters of the $k=1$ model ensures correct tie-breaking.\n2.  Iterate through all $36$ one-reticulation models, defined by the tuple $(i, j, \\gamma)$, where $i, j \\in \\{0,1,2,3\\}$, $i \\neq j$, and $\\gamma \\in \\{0.2, 0.5, 0.8\\}$.\n3.  For each $k=1$ model, determine its probability vector $(p(t_0), p(t_1), p(t_2))$ and calculate its log-likelihood $\\ell_1$.\n4.  Compare the current $k=1$ model with the best model found so far. A new model becomes the best if:\n    a. Its log-likelihood is strictly greater (by more than machine precision, e.g., $10^{-12}$) than the best log-likelihood.\n    b. Its log-likelihood is effectively equal to the best log-likelihood, and its parameters are preferred by the tie-breaking rule. The rule is applied lexicographically to the parameter tuple $(k, \\gamma, i, j)$, where smaller values are preferred. The rule \"prefer smaller $k$\" implies that if $\\ell(k=1) \\approx \\ell(k=0)$, the $k=0$ model prevails.\n5.  After evaluating all candidate models, the parameters of the stored best model are formatted into the required output string. This process is repeated for all test cases.\n\nThis systematic procedure guarantees finding the unique optimal model as defined by the problem statement.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the optimal phylogenomic model for a set of gene tree counts.\n\n    The function iterates through a finite set of candidate models (one zero-reticulation\n    and multiple one-reticulation models) and calculates a smoothed log pseudo-likelihood\n    for each. The model that maximizes this likelihood, subject to a strict tie-breaking\n    rule, is selected for each test case.\n    \"\"\"\n    # Define problem constants and test cases\n    TAXA_INDICES = {'A': 0, 'B': 1, 'C': 2, 'D': 3}\n    GAMMA_GRID = [0.2, 0.5, 0.8]\n    DELTA = 1e-9\n    TEST_CASES = [\n        (95, 3, 2),\n        (50, 45, 5),\n        (34, 33, 33),\n        (0, 100, 0),\n    ]\n\n    # Pre-compute the mapping from an unordered taxon pair (i, j) to the \n    # corresponding alternate gene tree topology index.\n    # Topology indices: 0: t_AB|CD, 1: t_AC|BD, 2: t_AD|BC\n    pair_to_alt_idx = {\n        tuple(sorted((TAXA_INDICES['A'], TAXA_INDICES['B']))): 0,\n        tuple(sorted((TAXA_INDICES['C'], TAXA_INDICES['D']))): 0,\n        tuple(sorted((TAXA_INDICES['A'], TAXA_INDICES['C']))): 1,\n        tuple(sorted((TAXA_INDICES['B'], TAXA_INDICES['D']))): 1,\n        tuple(sorted((TAXA_INDICES['A'], TAXA_INDICES['D']))): 2,\n        tuple(sorted((TAXA_INDICES['B'], TAXA_INDICES['C']))): 2,\n    }\n\n    def calculate_log_likelihood(counts, p_model):\n        \"\"\"Calculates the smoothed log pseudo-likelihood.\"\"\"\n        p_smoothed = [(1 - DELTA) * p + DELTA / 3.0 for p in p_model]\n        log_likelihood = 0.0\n        for count, prob in zip(counts, p_smoothed):\n            if count > 0:\n                # Ensure probability is not zero before log\n                if prob <= 0: return -np.inf \n                log_likelihood += count * np.log(prob)\n        return log_likelihood\n\n    all_results = []\n    \n    for counts in TEST_CASES:\n        # Start with the k=0 model as the initial best model.\n        # This model has p(t_0)=1, p(t_1)=0, p(t_2)=0.\n        p_k0 = [1.0, 0.0, 0.0]\n        best_ll = calculate_log_likelihood(counts, p_k0)\n        # State tuple for comparison: (log-likelihood, k, gamma, i, j)\n        best_state = (best_ll, 0, float('inf'), float('inf'), float('inf'))\n        \n        # Evaluate all k=1 models.\n        num_taxa = len(TAXA_INDICES)\n        for i in range(num_taxa):  # taxon x\n            for j in range(num_taxa):  # taxon y\n                if i == j:\n                    continue\n                \n                sorted_pair = tuple(sorted((i, j)))\n                alt_idx = pair_to_alt_idx[sorted_pair]\n\n                for gamma in GAMMA_GRID:\n                    p_k1 = [0.0, 0.0, 0.0]\n                    # The base topology is always t_0.\n                    # The alternate topology is determined by the pair {x,y}.\n                    if alt_idx == 0:  # Degenerate case where alternate is the base topology\n                        p_k1[0] = 1.0\n                    else:\n                        p_k1[0] = 1.0 - gamma\n                        p_k1[alt_idx] = gamma\n                    \n                    current_ll = calculate_log_likelihood(counts, p_k1)\n                    \n                    # Compare with the best model using likelihood and tie-breaking rules.\n                    # A k=1 model is chosen only if its likelihood is strictly greater.\n                    # If likelihoods are tied, k=0 is preferred over k=1.\n                    # For ties between k=1 models, smaller gamma then smaller (i,j) are preferred.\n                    \n                    if current_ll > best_state[0] + 1e-12: # Strictly better likelihood\n                        best_state = (current_ll, 1, gamma, i, j)\n                    elif np.isclose(current_ll, best_state[0]): # Tie in likelihood\n                        current_tiebreak_tuple = (1, gamma, i, j)\n                        best_tiebreak_tuple = (best_state[1], best_state[2], best_state[3], best_state[4])\n                        if current_tiebreak_tuple < best_tiebreak_tuple:\n                           best_state = (current_ll, 1, gamma, i, j)\n        \n        # Format the result for the current test case.\n        if best_state[1] == 0:\n            all_results.append([0])\n        else:\n            _, _, gamma, i, j = best_state\n            all_results.append([1, gamma, i, j])\n\n    # Generate the final output string in the specified format.\n    result_str_list = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    final_output = f\"[{','.join(result_str_list)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}