{
    "hands_on_practices": [
        {
            "introduction": "理论的基石是理解文化性状在群体中的传播动态。此练习将带您从第一性原理出发，推导一个有益的文化创新在有限群体中的固定概率。通过应用经典的Moran过程模型，您将掌握量化机会和选择在文化演化中作用的基础技能，并深入理解随机性如何影响文化性状的最终命运 。",
            "id": "2716387",
            "problem": "考虑一个由两种可选文化变体的文化携带者组成的、大小固定为 $N$ 的种群：一种是初始稀有的创新变体 $I$，另一种是原有传统变体 $T$。在基因-文化协同演化和双重继承理论的框架下，假设文化变迁通过每次发生一个的社会学习事件来进行。在每个事件中，从种群中选择一个榜样，然后一个随机选择的学习者会采纳该榜样的文化变体，以替代其当前的变体。不存在突变（创新只在最开始发生一次），唯一的随机性来源是社会学习过程中的群体抽样。\n\n水平传播以速率参数 $\\beta$ 发生，这意味着收益差异通过水平社会学习体现在榜样选择中，其强度与 $\\beta$ 成正比。假设创新变体 $I$ 相对于 $T$ 具有一个不依赖于频率的收益优势 $s_c$（因此 $I$ 的收益为 $1 + s_c$，$T$ 的收益为 $1$）。假设水平社会学习使榜样选择偏向于一种有效的文化适应度，该适应度将收益优势按水平传播速率 $\\beta$ 进行线性缩放，因此被选为榜样的相对可能性对于 $I$ 来说与 $f_I = 1 + \\beta s_c$ 成正比，对于 $T$ 来说与 $f_T = 1$ 成正比。这引出一个出生-死亡文化莫兰过程：在每次更新中，以与其适应度 $f$ 成正比的概率选择一个榜样，一个均匀随机选择的学习者采纳该榜样的变体。\n\n从单个创新者（状态 $i=1$）开始，请从第一性原理推导变体 $I$ 的精确固定概率（即 $I$ 最终占据整个种群的概率），并将其表示为包含 $N$, $\\beta$ 和 $s_c$ 的闭式解析表达式。您的最终答案必须是一个没有单位的单一表达式。如果您在推导中引入了任何中间符号，请在最终表达式中将它们消去，使其只依赖于 $N$, $\\beta$ 和 $s_c$。",
            "solution": "问题陈述已经过严格验证，被认为是具有科学依据、提法恰当、客观且内部一致的。它描述了一个标准的出生-死亡过程，具体来说是置于文化演化背景下的带选择的莫兰模型。因此，该问题是有效的，并允许一个形式化的数学解。\n\n我们将从第一性原理推导固定概率。系统的状态由携带创新变体 $I$ 的个体数量定义，我们将其记为 $i$。种群大小固定为 $N$，因此有 $N-i$ 个个体携带传统变体 $T$。$i$ 的状态空间为 $\\{0, 1, \\dots, N\\}$。状态 $i=0$ 和 $i=N$ 是吸收态，分别对应于变体 $T$ 和 $I$ 的固定。\n\n该过程是一个离散时间马尔可夫链。在每一步，会发生一个单一事件，可能使 $i$ 的值改变 $+1$、$-1$ 或 $0$。我们必须首先确定转移概率。\n\n根据问题描述，榜样以与其有效文化适应度成正比的概率被选择，而学习者则被均匀随机地选择来采纳榜样的变体。\n$I$ 型个体的有效文化适应度值为 $f_I = 1 + \\beta s_c$，$T$ 型个体的为 $f_T = 1$。\n\n在一个有 $i$ 个创新者和 $N-i$ 个传统者的种群中，总适应度是所有个体适应度值的总和：\n$$ W_{total} = i \\cdot f_I + (N-i) \\cdot f_T = i(1 + \\beta s_c) + (N-i)(1) = N + i \\beta s_c $$\n\n选择一个 $I$ 型个体作为榜样的概率是所有 $I$ 型个体总适应度与种群总适应度的比率：\n$$ P(\\text{model is } I) = \\frac{i f_I}{W_{total}} = \\frac{i(1 + \\beta s_c)}{N + i \\beta s_c} $$\n类似地，选择一个 $T$ 型个体作为榜样的概率是：\n$$ P(\\text{model is } T) = \\frac{(N-i) f_T}{W_{total}} = \\frac{N-i}{N + i \\beta s_c} $$\n\n学习者从大小为 $N$ 的种群中被均匀随机地选择。\n如果选择了一个 $I$ 型榜样和一个 $T$ 型学习者，创新者的数量 $i$ 就会增加 1（即 $i \\to i+1$）。种群中有 $N-i$ 个 $T$ 型个体。选择一个 $T$ 型学习者的概率是 $\\frac{N-i}{N}$。因此，数量增加的转移概率 $T_i^+$ 为：\n$$ T_i^+ = P(i \\to i+1) = P(\\text{model is } I) \\times P(\\text{learner is } T) = \\frac{i(1 + \\beta s_c)}{N + i \\beta s_c} \\times \\frac{N-i}{N} $$\n\n如果选择了一个 $T$ 型榜样和一个 $I$ 型学习者，创新者的数量 $i$ 就会减少 1（即 $i \\to i-1$）。种群中有 $i$ 个 $I$ 型个体。选择一个 $I$ 型学习者的概率是 $\\frac{i}{N}$。因此，数量减少的转移概率 $T_i^-$ 为：\n$$ T_i^- = P(i \\to i-1) = P(\\text{model is } T) \\times P(\\text{learner is } I) = \\frac{N-i}{N + i \\beta s_c} \\times \\frac{i}{N} $$\n\n保持在状态 $i$ 的概率为 $T_i^0 = 1 - T_i^+ - T_i^-$。对于计算 $1 \\le i \\le N-1$ 范围内的固定概率而言，位于 $i=0$ 和 $i=N$ 的吸收态是无关的。\n\n对于一维出生-死亡过程，从状态 $k$（即有 $k$ 个突变体）开始的固定概率 $\\Phi_k$ 由以下通用公式给出：\n$$ \\Phi_k = \\frac{1 + \\sum_{j=1}^{k-1} \\prod_{i=1}^{j} \\frac{T_i^-}{T_i^+}}{1 + \\sum_{j=1}^{N-1} \\prod_{i=1}^{j} \\frac{T_i^-}{T_i^+}} $$\n问题指定我们从单个创新者开始，因此 $k=1$。在这种情况下，分子中的求和为空（从 $j=1$ 到 $k-1=0$），其定义为 $0$。该公式简化为：\n$$ \\Phi_1 = \\frac{1}{1 + \\sum_{j=1}^{N-1} \\prod_{i=1}^{j} \\frac{T_i^-}{T_i^+}} $$\n我们现在必须计算比率 $\\gamma_i = \\frac{T_i^-}{T_i^+}$。\n$$ \\gamma_i = \\frac{\\frac{(N-i)i}{N(N + i \\beta s_c)}}{\\frac{i(1 + \\beta s_c)(N-i)}{N(N + i \\beta s_c)}} = \\frac{1}{1 + \\beta s_c} $$\n这个比率是一个常数，与状态 $i$ 无关。让我们将此常数定义为 $\\gamma = \\frac{1}{1 + \\beta s_c}$。\n\n固定概率公式中的乘积项变为：\n$$ \\prod_{i=1}^{j} \\gamma_i = \\prod_{i=1}^{j} \\gamma = \\gamma^j $$\n将此代入 $\\Phi_1$ 的表达式中：\n$$ \\Phi_1 = \\frac{1}{1 + \\sum_{j=1}^{N-1} \\gamma^j} $$\n分母是一个几何级数：$1 + \\sum_{j=1}^{N-1} \\gamma^j = \\sum_{j=0}^{N-1} \\gamma^j$。\n这个有限几何级数的和由 $\\frac{1-\\gamma^N}{1-\\gamma}$ 给出，前提是 $\\gamma \\ne 1$。\n$\\gamma=1$ 的情况对应于 $\\beta s_c = 0$，即中性情况。此时，$\\Phi_1 = \\frac{1}{1 + (N-1)} = \\frac{1}{N}$，这是正确的中性固定概率。\n对于 $\\gamma \\ne 1$：\n$$ \\Phi_1 = \\frac{1}{\\frac{1-\\gamma^N}{1-\\gamma}} = \\frac{1-\\gamma}{1-\\gamma^N} $$\n这是用 $\\gamma$ 表示的精确固定概率。为了以问题给定的参数 $N$、$\\beta$ 和 $s_c$ 给出最终答案，我们将 $\\gamma = \\frac{1}{1 + \\beta s_c}$ 代回该表达式。\n$$ \\Phi_1 = \\frac{1 - \\frac{1}{1 + \\beta s_c}}{1 - \\left(\\frac{1}{1 + \\beta s_c}\\right)^N} $$\n为简化此表达式并消除繁分数，我们进行代数变换。\n分子是：\n$$ 1 - \\frac{1}{1 + \\beta s_c} = \\frac{(1 + \\beta s_c) - 1}{1 + \\beta s_c} = \\frac{\\beta s_c}{1 + \\beta s_c} $$\n分母是：\n$$ 1 - \\frac{1}{(1 + \\beta s_c)^N} = \\frac{(1 + \\beta s_c)^N - 1}{(1 + \\beta s_c)^N} $$\n将这两部分组合得到：\n$$ \\Phi_1 = \\frac{\\frac{\\beta s_c}{1 + \\beta s_c}}{\\frac{(1 + \\beta s_c)^N - 1}{(1 + \\beta s_c)^N}} = \\frac{\\beta s_c}{1 + \\beta s_c} \\times \\frac{(1 + \\beta s_c)^N}{(1 + \\beta s_c)^N - 1} $$\n这可以简化为最终的闭式表达式：\n$$ \\Phi_1 = \\frac{\\beta s_c (1 + \\beta s_c)^{N-1}}{(1 + \\beta s_c)^N - 1} $$\n该表达式代表了在指定的文化莫兰过程中，单个创新者的精确固定概率。",
            "answer": "$$ \\boxed{\\frac{\\beta s_c (1 + \\beta s_c)^{N-1}}{(1 + \\beta s_c)^{N} - 1}} $$"
        },
        {
            "introduction": "在掌握了基础模型之后，下一步是学习如何分析和解释复杂的演化数据。Price方程是剖析演化变化来源的强大工具。本练习要求您运用Price方程，将整体表型变化分解为遗传和文化两个部分，例如区分作用于基因的选择和作用于文化的选择。通过这个实践，您将能够更精确地在双重继承理论框架下解读经验数据 。",
            "id": "2716419",
            "problem": "一个研究双重继承理论 (DIT) 的团队，在一个大型、年龄结构化的人类群体中，记录了一个离散世代内关于繁殖产出和某个标量表型的个体层面数据，该表型由遗传和文化成分加性构成。设个体 $i$ 的表型为 $z_{i} = g_{i} + c_{i}$，其中 $g_{i}$ 是加性遗传值，$c_{i}$ 是文化获得值。设 $w_{i}$ 表示个体 $i$ 的绝对适合度（后代的期望数量）。该团队提供了以下凭经验估计的、按世代汇总的量：\n- 平均适合度 $\\bar{w} = 1.25$ 后代/亲代。\n- 遗传选择协方差 $\\mathrm{Cov}(w,g) = 0.08$ (性状单位$\\cdot$后代)。\n- 文化选择协方差 $\\mathrm{Cov}(w,c) = 0.15$ (性状单位$\\cdot$后代)。\n- 遗传传递项 $\\mathbb{E}(w\\,\\Delta g) = -0.0125$ (性状单位$\\cdot$后代)。\n- 文化传递项 $\\mathbb{E}(w\\,\\Delta c) = -0.0250$ (性状单位$\\cdot$后代)。\n\n从标量表型的标准 Price 方程和加性分解 $z_{i} = g_{i} + c_{i}$ 出发，推导平均表型在一个世代内的期望变化量 $\\Delta \\bar{z}$ 分解为其遗传选择、文化选择、遗传传递和文化传递等分量的加性分解式。使用你的分解式，计算对于此数据集，文化在一个世代内对表型变化的贡献。\n\n你的最终数值答案以“性状单位/世代”为单位，并四舍五入到四位有效数字。",
            "solution": "该问题要求使用 Price 方程推导表型变化的加性分解，并随后计算文化对这一变化的贡献。该问题有科学依据，提法明确，并为得到唯一解提供了所有必要信息。\n\n出发点是描述平均表型 $\\bar{z}$ 在一个世代内变化的 Price 方程的一般形式：\n$$ \\bar{w} \\Delta \\bar{z} = \\mathrm{Cov}(w, z) + \\mathbb{E}(w \\Delta z) $$\n此处，$\\bar{w}$ 是群体的平均适合度，$w$ 是个体适合度，$z$ 是个体表型值，$\\mathrm{Cov}(w, z)$ 是适合度与表型之间的协方差（选择项），$\\mathbb{E}(w \\Delta z)$ 是亲代与子代之间表型变化的适合度加权平均值（传递项）。\n\n个体 $i$ 的表型 $z_i$ 表示为遗传值 $g_i$ 和文化获得值 $c_i$ 的加性组合：\n$$ z_i = g_i + c_i $$\n我们将此分解式代入 Price 方程。\n\n首先，考虑协方差项 $\\mathrm{Cov}(w, z)$。利用协方差的双线性性质：\n$$ \\mathrm{Cov}(w, z) = \\mathrm{Cov}(w, g + c) = \\mathrm{Cov}(w, g) + \\mathrm{Cov}(w, c) $$\n$\\mathrm{Cov}(w, g)$ 项代表了作用于表型遗传分量的选择效应，而 $\\mathrm{Cov}(w, c)$ 项代表了作用于文化分量的选择效应。\n\n接下来，考虑传递项 $\\mathbb{E}(w \\Delta z)$。表型变化量 $\\Delta z_i$ 是亲代 $i$ 的子代表型与亲代 $i$ 的表型之间的平均差异。给定 $z = g+c$，该变化可分解为 $\\Delta z = \\Delta g + \\Delta c$。我们将其代入传递项，并利用期望算子的线性性质：\n$$ \\mathbb{E}(w \\Delta z) = \\mathbb{E}(w(\\Delta g + \\Delta c)) = \\mathbb{E}(w \\Delta g) + \\mathbb{E}(w \\Delta c) $$\n$\\mathbb{E}(w \\Delta g)$ 项代表了非孟德尔式传递和突变对遗传分量的影响，而 $\\mathbb{E}(w \\Delta c)$ 项代表了有偏的文化传递（例如，不完美学习、引导变异）的影响。\n\n结合这些展开的项，复合表型的完整 Price 方程变为：\n$$ \\bar{w} \\Delta \\bar{z} = \\mathrm{Cov}(w, g) + \\mathrm{Cov}(w, c) + \\mathbb{E}(w \\Delta g) + \\mathbb{E}(w \\Delta c) $$\n为了求出平均表型的总变化量 $\\Delta \\bar{z}$，我们将整个方程除以平均适合度 $\\bar{w}$：\n$$ \\Delta \\bar{z} = \\frac{\\mathrm{Cov}(w, g)}{\\bar{w}} + \\frac{\\mathrm{Cov}(w, c)}{\\bar{w}} + \\frac{\\mathbb{E}(w \\Delta g)}{\\bar{w}} + \\frac{\\mathbb{E}(w \\Delta c)}{\\bar{w}} $$\n这就是所要求的将总表型变化分解为四个分量——遗传选择、文化选择、遗传传递和文化传递——的加性分解式。\n\n平均表型的总变化量 $\\Delta \\bar{z}$ 是平均遗传值的变化量 $\\Delta \\bar{g}$ 和平均文化值的变化量 $\\Delta \\bar{c}$ 之和。\n$$ \\Delta \\bar{z} = \\Delta \\bar{g} + \\Delta \\bar{c} $$\n通过对我们分解式中的遗传项和文化项进行分组，我们可以确定 $\\Delta \\bar{g}$ 和 $\\Delta \\bar{c}$ 的表达式：\n$$ \\Delta \\bar{g} = \\frac{\\mathrm{Cov}(w, g) + \\mathbb{E}(w \\Delta g)}{\\bar{w}} $$\n$$ \\Delta \\bar{c} = \\frac{\\mathrm{Cov}(w, c) + \\mathbb{E}(w \\Delta c)}{\\bar{w}} $$\n问题要求计算“文化对表型变化的贡献”。这对应于平均文化值的总变化量 $\\Delta \\bar{c}$。\n\n我们已知以下经验值：\n- 平均适合度 $\\bar{w} = 1.25$\n- 文化选择协方差 $\\mathrm{Cov}(w,c) = 0.15$\n- 文化传递项 $\\mathbb{E}(w \\Delta c) = -0.0250$\n\n我们用这些值来计算 $\\Delta \\bar{c}$：\n$$ \\Delta \\bar{c} = \\frac{\\mathrm{Cov}(w, c) + \\mathbb{E}(w \\Delta c)}{\\bar{w}} $$\n代入数值：\n$$ \\Delta \\bar{c} = \\frac{0.15 + (-0.0250)}{1.25} $$\n$$ \\Delta \\bar{c} = \\frac{0.15 - 0.025}{1.25} $$\n$$ \\Delta \\bar{c} = \\frac{0.125}{1.25} $$\n$$ \\Delta \\bar{c} = 0.1 $$\n问题要求答案四舍五入到四位有效数字。因此，值 $0.1$ 必须写成 $0.1000$。单位是“性状单位/世代”，因为 $\\Delta \\bar{c}$ 的单位与表型 $c$ 的单位相同。",
            "answer": "$$\\boxed{0.1000}$$"
        },
        {
            "introduction": "最后的实践是从分析走向综合，您将亲手构建一个完整的基因-文化协同演化案例的仿真模型：乳糖酶持久性与奶制品业的协同演化。该任务要求您将选择、社会学习和基因-文化反馈等核心理论概念转化为一个可运行的计算模型。通过模拟基因与文化之间的耦合动态，您将直观地理解二者如何在漫长的时间尺度上相互作用，共同塑造出独特的人类适应性特征 。",
            "id": "2716366",
            "problem": "您需要实现一个完整、可运行的程序，该程序模拟一个双重继承理论 (DIT) 模型，用于研究一个遗传性状（乳糖酶持久性）和一个文化性状（奶制品业）的共同演化。您的设计必须从演化生物学的有效基础出发，并推导出离散时间下的耦合基因-文化动态。该生物种群假定为泛交种群，世代离散且不重叠。遗传性状由一个具有两个等位基因的单一基因座编码，文化性状是一种社会传播的实践，其采纳动态取决于收益。\n\n请仅从以下基本依据出发：\n- 在大种群、随机交配、单一基因座和两个等位基因的条件下，符合 Hardy–Weinberg 平衡比例。\n- 离散时间下的确定性生存力选择。\n- 因收益差异导致的频率依赖性采纳，遵循复制子类型的社会学习动态。\n- 基于全新世奶制品业出现与传播的考古学合理时间线，世代时间为 $25$ 年。使用总计 $T=400$ 个世代（对应 $10{,}000$ 年）的模拟期。\n\n请使用以下组件和定义构建模型。\n- 遗传状态：令 $p_t \\in [0,1]$ 表示在第 $t$ 代中乳糖酶持久性等位基因的频率，其中 $t \\in \\{0,1,\\dots,T\\}$。假设在该世代的奶制品业环境下，乳糖酶持久性对适应度效应呈显性。\n- 文化状态：令 $q_t \\in [0,1]$ 表示在第 $t$ 代中奶制品业（采纳者）的频率。\n- 适应度环境：乳糖酶持久性的适应度效应取决于同一世代的奶制品业实践；令每代的选择系数为 $s \\ge 0$，使得在第 $t$ 代，奶制品业的采纳者为乳糖酶持久性等位基因的携带者带来与 $q_t$ 成正比的优势。\n- 文化环境：奶制品业的采纳通过收益偏向的社会学习进行，学习率为 $r > 0$，在第 $t$ 代有利于采纳的收益差异为 $[(b_0 + b_1\\,p_t) - c]$，其中 $b_0 \\ge 0$ 是与基因型无关的奶制品业基线收益，$b_1 \\ge 0$ 捕捉了基因-文化互补性（额外收益随乳糖酶持久性等位基因频率的增加而增加），而 $c \\ge 0$ 是奶制品业的成本。\n- 起始时间：将奶制品业的起始定义为距今 $\\Omega$ 个世代之前。在总模拟期为 $T$ 的情况下，正向模拟中的起始代数索引为 $g_{\\mathrm{on}} = T - \\Omega$。在 $t < g_{\\mathrm{on}}$ 之前，奶制品业不存在，且 $q_t$ 被约束为 $0$。在 $t = g_{\\mathrm{on}}$ 时，以一个小的种子频率 $q_\\varepsilon \\in (0,1)$ 引入奶制品业。\n\n您的程序必须精确实现以下离散时间过程：\n- 在 $t=0$ 时初始化：将 $p_0$ 设置为具体案例的初始等位基因频率，并将 $q_0$ 设置为 $0$。\n- 对于每一代 $t \\in \\{0,1,\\dots,T-1\\}$：\n  - 如果 $t < g_{\\mathrm{on}}$，则设置 $q_t = 0$。\n  - 如果 $t = g_{\\mathrm{on}}$，用 $\\max(q_t, q_\\varepsilon)$ 替换 $q_t$ 以引入奶制品业种子。\n  - 文化更新：通过收益偏向的复制子步骤，从 $q_t$ 和 $p_t$ 更新得到 $q_{t+1}$：\n    $$q_{t+1} = \\mathrm{clip}\\Big(q_t + r\\,q_t\\,(1-q_t)\\,\\big[(b_0 + b_1\\,p_t) - c\\big]\\Big)$$\n    其中 $\\mathrm{clip}(x)$ 函数通过在区间边界处截断，将 $x$ 投影到 $[0,1]$。\n  - 遗传更新：通过在该世代环境下的确定性生存力选择（遵循 Hardy–Weinberg 定律和乳糖酶持久性的显性效应），从 $p_t$ 和 $q_t$ 更新得到 $p_{t+1}$。请使用这些假设所推导出的标准离散时间选择更新方法。\n- 记录 $p_t$ 首次达到或超过指定阈值 $p^\\star$ 的世代索引（整数），并同样记录 $q_t$ 首次达到或超过 $q^\\star$ 的世代索引。如果在 $t = T$（含）之前从未达到阈值，则记录为 $-1$。阈值评估应基于按上述规则生成的序列 $\\{p_t\\}_{t=0}^{T}$ 和 $\\{q_t\\}_{t=0}^{T}$ 进行。\n\n所有时间必须以世代（整数）为单位表示。所有频率必须以 $[0,1]$ 区间内的小数表示。\n\n请为以下参数集测试套件实现模拟，这些参数集的选择旨在反映考古学上合理的起始时间，并涵盖性质上不同的动态机制。对于所有案例，使用 $T = 400$，$p^\\star = 0.6$，$q^\\star = 0.8$，世代长度为 $25$ 年（仅为背景信息，无需转换单位）。\n\n- 案例 A（早期起始，强耦合）：\n  - 初始等位基因频率 $p_0 = 0.01$。\n  - 选择系数 $s = 0.02$。\n  - 社会学习率 $r = 0.15$。\n  - 基线文化收益 $b_0 = 0.02$。\n  - 基因-文化互补性 $b_1 = 0.10$。\n  - 文化成本 $c = 0.01$。\n  - 奶制品业起始于距今 $\\Omega = 360$ 个世代（约 $9{,}000$ 年），因此 $g_{\\mathrm{on}} = 40$。\n  - 种子频率 $q_\\varepsilon = 0.02$。\n\n- 案例 B（较晚起始，中等耦合）：\n  - $p_0 = 0.01$。\n  - $s = 0.015$。\n  - $r = 0.10$。\n  - $b_0 = 0.02$。\n  - $b_1 = 0.08$。\n  - $c = 0.012$。\n  - $\\Omega = 240$（约 $6{,}000$ 年），因此 $g_{\\mathrm{on}} = 160$。\n  - $q_\\varepsilon = 0.02$。\n\n- 案例 C（无耦合，无遗传选择；文化独立兴起）：\n  - $p_0 = 0.05$。\n  - $s = 0.00$。\n  - $r = 0.12$。\n  - $b_0 = 0.02$。\n  - $b_1 = 0.00$。\n  - $c = 0.005$。\n  - $\\Omega = 360$，因此 $g_{\\mathrm{on}} = 40$。\n  - $q_\\varepsilon = 0.01$。\n\n- 案例 D（易出现双稳态，起步困难）：\n  - $p_0 = 0.01$。\n  - $s = 0.02$。\n  - $r = 0.10$。\n  - $b_0 = 0.00$。\n  - $b_1 = 0.05$。\n  - $c = 0.02$。\n  - $\\Omega = 240$，因此 $g_{\\mathrm{on}} = 160$。\n  - $q_\\varepsilon = 0.02$。\n\n您的程序必须为每个案例计算以下四个输出：\n- 最终等位基因频率 $p_T$（四舍五入到六位小数）。\n- 最终文化频率 $q_T$（四舍五入到六位小数）。\n- $p_t \\ge p^\\star$ 的最早世代索引（整数，若从未达到则为 $-1$）。\n- $q_t \\ge q^\\star$ 的最早世代索引（整数，若从未达到则为 $-1$）。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含按 A、B、C、D 顺序连接的所有案例结果，格式为用方括号括起来的逗号分隔列表。每个案例的顺序必须是 $[p_T, q_T, t_{p^\\star}, t_{q^\\star}]$。例如，最终行的有效格式为\n  $$[\\text{A}_{p_T},\\text{A}_{q_T},\\text{A}_{t_{p^\\star}},\\text{A}_{t_{q^\\star}},\\text{B}_{p_T},\\dots,\\text{D}_{t_{q^\\star}}]$$\n所有频率必须是 $[0,1]$ 区间内、四舍五入到六位小数的小数，所有时间必须是世代整数。",
            "solution": "所提出的问题是要求基于双重继承理论 (DIT) 的原则，构建并实现一个基因-文化共同演化的模拟模型。具体案例是乳糖酶持久性（一种遗传性状）与奶制品业（一种文化性状）的共同演化。\n\n### 问题验证\n\n首先，我必须验证问题陈述的有效性。\n\n**步骤 1：提取给定信息**\n\n*   **模型框架**：基于离散时间的双重继承理论 (DIT)，模拟期为 $T=400$ 个世代。\n*   **遗传系统**：单一基因座，两个等位基因。乳糖酶持久性等位基因的频率为 $p_t \\in [0,1]$。对于适应度效应，假定乳糖酶持久性等位基因为显性。\n*   **文化系统**：单一文化性状（奶制品业）。采纳者的频率为 $q_t \\in [0,1]$。\n*   **基因-文化相互作用**：\n    *   **遗传更新**：对乳糖酶持久性等位基因的选择取决于奶制品业的频率 $q_t$。选择系数为 $s \\ge 0$。更新遵循在 Hardy-Weinberg 条件下的确定性生存力选择。\n    *   **文化更新**：奶制品业的采纳遵循收益偏向的社会学习（复制子动态），学习率为 $r > 0$。收益差异为 $\\Delta_{\\pi} = (b_0 + b_1 p_t) - c$。\n*   **模拟时间线**：\n    *   总模拟期：$T = 400$ 个世代。\n    *   奶制品业起始时间：距今 $\\Omega$ 个世代，在模拟时间中为 $g_{\\mathrm{on}} = T - \\Omega$。\n    *   对于 $t < g_{\\mathrm{on}}$，有 $q_t=0$。\n    *   在 $t = g_{\\mathrm{on}}$ 时，以频率 $q_\\varepsilon > 0$ 引入奶制品业种子。\n*   **更新方程**：\n    *   文化：$q_{t+1} = \\mathrm{clip}\\Big(q_t + r\\,q_t\\,(1-q_t)\\,\\big[(b_0 + b_1\\,p_t) - c\\big]\\Big)$，其中 $\\mathrm{clip}(x)$ 将 $x$ 投影到 $[0,1]$ 上。\n    *   遗传：由显性效应和适应度对 $q_t$ 的依赖性所决定的标准离散时间选择更新。\n*   **输出要求**：\n    *   最终频率 $p_T, q_T$。\n    *   频率达到阈值 $p^\\star=0.6$ 和 $q^\\star=0.8$ 的首个世代索引 $t_{p^\\star}, t_{q^\\star}$。\n*   **测试案例参数**：提供了四个不同的参数集（A, B, C, D），包含 $p_0, s, r, b_0, b_1, c, \\Omega, q_\\varepsilon$ 的具体值。\n\n**步骤 2：使用提取的信息进行验证**\n\n根据验证标准对问题进行评估。\n\n*   **科学基础**：该模型基于演化生物学中已确立的标准框架：双重继承理论、Hardy-Weinberg 平衡、确定性选择和复制子动态。将其应用于乳糖酶持久性和奶制品业是该领域的经典案例。指定的参数和时间尺度是合理的。该问题具有科学合理性。\n*   **良构性**：该问题描述了一个耦合的、一阶非线性差分方程系统。初始条件和更新规则均已指定。遗传更新规则虽然没有给出最终公式，但通过“在 Hardy–Weinberg 和显性条件下的确定性生存力选择”的原则被明确规定。如下文详述，这一标准推导过程会得出一个唯一的公式。该系统是明确定义的，对于给定的初始状态和参数，存在唯一解。\n*   **客观性**：问题以精确的数学术语陈述，没有歧义、主观性或非科学性主张。\n\n**步骤 3：结论与行动**\n\n该问题是 **有效的**。它是一个计算生物学领域中良构且具有科学依据的问题。我现在将着手构建解决方案。\n\n### 模型推导与算法设计\n\n在实现模拟之前，我们必须根据规定，最终确定更新方程的数学形式。\n\n**1. 文化更新动态**\n奶制品业频率 $q_t$ 的更新规则是直接给出的：\n$$q_{t+1} = \\mathrm{clip}\\left(q_t + r\\,q_t\\,(1-q_t)\\,\\left[\\left(b_0 + b_1\\,p_t\\right) - c\\right]\\right)$$\n此处，$q_t(1-q_t)$ 代表种群中文化性状的方差，括号中的项是采纳与不采纳奶制品业之间的收益差异。参数 $r$ 是社会学习率，用于调整文化变迁的速度。$\\mathrm{clip}$ 函数确保 $q_{t+1}$ 保持在 $[0,1]$ 区间内。\n\n**2. 遗传更新动态**\n等位基因频率 $p_t$ 的更新规则必须从所述原则中推导出来。\n设 $A$ 为乳糖酶持久性等位基因（频率为 $p_t$），$a$ 为非持久性等位基因（频率为 $1-p_t$）。在随机交配（泛交）下，受孕时的基因型频率由 Hardy-Weinberg 平衡比例给出：\n*   $f(AA) = p_t^2$\n*   $f(Aa) = 2p_t(1-p_t)$\n*   $f(aa) = (1-p_t)^2$\n\n等位基因 $A$ 的显性意味着基因型 $AA$ 和 $Aa$ 具有相同的表型（乳糖酶持久性）。问题陈述指出，这些个体获得的选择优势与奶制品业的频率 $q_t$ 成正比。我们定义每个基因型的相对适应度（生存力）如下：\n*   $w_{AA} = 1 + s\\,q_t$\n*   $w_{Aa} = 1 + s\\,q_t$\n*   $w_{aa} = 1$\n参数 $s$ 是最大选择系数，在 $q_t=1$ 时实现。\n\n在第 $t$ 代，种群的平均适应度 $\\bar{w}_t$ 是基因型适应度的加权平均值：\n$$\\bar{w}_t = f(AA)w_{AA} + f(Aa)w_{Aa} + f(aa)w_{aa}$$\n$$\\bar{w}_t = p_t^2(1+s\\,q_t) + 2p_t(1-p_t)(1+s\\,q_t) + (1-p_t)^2(1)$$\n提出公因式 $(1+s\\,q_t)$：\n$$\\bar{w}_t = (p_t^2 + 2p_t(1-p_t))(1+s\\,q_t) + (1-p_t)^2$$\n乳糖酶持久性基因型的频率是 $p_t^2 + 2p_t(1-p_t) = 2p_t - p_t^2$。代入此式可得：\n$$\\bar{w}_t = (2p_t-p_t^2)(1+s\\,q_t) + (1-p_t)^2 = (2p_t-p_t^2) + s\\,q_t(2p_t-p_t^2) + 1 - 2p_t + p_t^2$$\n$$\\bar{w}_t = 1 + s\\,q_t(2p_t-p_t^2)$$\n\n下一代等位基因 $A$ 的频率 $p_{t+1}$ 是选择后基因库中等位基因 $A$ 的频率。这可以通过将每个基因型对该等位基因的贡献按其选择后频率进行加权来计算：\n$$p_{t+1} = \\frac{p_t^2 w_{AA} + p_t(1-p_t)w_{Aa}}{\\bar{w}_t}$$\n$$p_{t+1} = \\frac{p_t^2(1+s\\,q_t) + p_t(1-p_t)(1+s\\,q_t)}{\\bar{w}_t} = \\frac{p_t(p_t + 1-p_t)(1+s\\,q_t)}{\\bar{w}_t}$$\n$$p_{t+1} = \\frac{p_t(1+s\\,q_t)}{\\bar{w}_t}$$\n代入 $\\bar{w}_t$ 的表达式，我们得到最终的遗传更新方程：\n$$p_{t+1} = \\frac{p_t(1+s\\,q_t)}{1 + s\\,q_t(2p_t - p_t^2)}$$\n\n**3. 模拟算法**\n\n对于每个测试案例，将进行 $T=400$ 个世代的模拟。\n1.  初始化两个长度为 $T+1$ 的数组 `p` 和 `q`，用于存储状态历史。\n2.  设置初始条件：`p[0] = p_0` 和 `q[0] = 0`。\n3.  在奶制品业开始之前，动态是静止的。对于从 $0$ 到 $g_{\\mathrm{on}}-1$ 的所有世代 $t$，状态保持为 $(p_0, 0)$。我们可以在计算上跳过这一时期，并为 $t \\in \\{1, \\dots, g_{\\mathrm{on}}-1\\}$ 设置 `p[t] = p_0` 和 `q[t] = 0`。\n4.  在第 $t=g_{\\mathrm{on}}$ 代，引入文化性状：设置 `q[g_on] = q_\\varepsilon`。遗传状态仍然是 `p[g_on] = p_0`。\n5.  从 $g_{\\mathrm{on}}$ 到 $T-1$ 对 $t$ 进行迭代：\n    a. 从历史数组中检索当前状态 $(p_t, q_t)$：`p_t = p[t]`, `q_t = q[t]`。\n    b. 使用推导出的更新方程计算下一个状态 $(p_{t+1}, q_{t+1})$。\n    c. 将新状态存储在历史数组中：`p[t+1] = p_{t+1}`, `q[t+1] = q_{t+1}`。\n6.  循环完成后，生成了完整的历史记录 $\\{p_t\\}_{t=0}^{T}$ 和 $\\{q_t\\}_{t=0}^{T}$。\n7.  最终值 $p_T$ 和 $q_T$ 从 `p[T]` 和 `q[T]` 中读取。\n8.  通过搜索完整的 `p` 和 `q` 数组，找到各自阈值 ($p^\\star=0.6$, $q^\\star=0.8$) 首次达到或超过时的索引，从而确定阈值穿越时间 $t_{p^\\star}$ 和 $t_{q^\\star}$。如果从未达到阈值，则记录为 $-1$。\n此过程是确定性的，并将为四个指定的测试案例分别实现。",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(p0, s, r, b0, b1, c, g_on, q_epsilon, T, p_star, q_star):\n    \"\"\"\n    Runs a single simulation of the gene-culture coevolution model.\n\n    Args:\n        p0 (float): Initial frequency of lactase persistence allele.\n        s (float): Selection coefficient.\n        r (float): Social learning rate.\n        b0 (float): Baseline cultural benefit.\n        b1 (float): Gene-culture complementarity benefit.\n        c (float): Cultural cost.\n        g_on (int): Generation index for the onset of dairying.\n        q_epsilon (float): Seed frequency for dairying.\n        T (int): Total number of generations.\n        p_star (float): Threshold for allele frequency.\n        q_star (float): Threshold for cultural frequency.\n\n    Returns:\n        tuple: (p_T, q_T, t_p_star, t_q_star)\n    \"\"\"\n    # Initialize history arrays for genetic and cultural frequencies\n    p = np.zeros(T + 1)\n    q = np.zeros(T + 1)\n\n    # Set initial conditions at t=0\n    p[0] = p0\n    q[0] = 0.0\n\n    # Main simulation loop\n    # The state (p, q) is updated from generation t to t+1.\n    for t in range(T):\n        p_t = p[t]\n        q_t = q[t]\n\n        # Apply special rule for seeding culture at onset generation g_on\n        # According to the problem, \"If t = g_on, replace qt by max(qt, q_epsilon)\".\n        # Since q[g_on] would be 0 from the steps before, this is equivalent to setting it.\n        if t == g_on:\n            q_t = max(q_t, q_epsilon)\n        \n        # Another rule \"If t < g_on, set qt = 0\". With q[0]=0 and the update\n        # equation for q having a q_t factor, q will remain 0 until seeded.\n        # This rule is naturally satisfied.\n\n        # Cultural update to get q_{t+1}\n        payoff_diff = (b0 + b1 * p_t) - c\n        delta_q = r * q_t * (1 - q_t) * payoff_diff\n        q_t_plus_1 = q_t + delta_q\n        q[t+1] = np.clip(q_t_plus_1, 0.0, 1.0)\n\n        # Genetic update to get p_{t+1}\n        # Only perform selection if s > 0 and q_t > 0 to avoid division by zero/no-op\n        if s > 0 and q_t > 0:\n            mean_fitness = 1.0 + s * q_t * (2 * p_t - p_t**2)\n            p[t+1] = (p_t * (1.0 + s * q_t)) / mean_fitness\n        else:\n            p[t+1] = p_t\n            \n        # The problem statement says \"evaluate thresholds on the sequence {qt} as generated\".\n        # This implies we should use the post-seeding q_t value for the threshold check at t=g_on.\n        # So we update our history array `q` within the loop to reflect the seeded value.\n        if t == g_on:\n            q[t] = q_t\n\n    # After the loop, we have the complete trajectories p[0...T] and q[0...T]\n    \n    # Extract final frequencies\n    p_T = p[T]\n    q_T = q[T]\n\n    # Find first generation index where thresholds are met or exceeded\n    p_reach_indices = np.where(p >= p_star)[0]\n    t_p_star = int(p_reach_indices[0]) if len(p_reach_indices) > 0 else -1\n\n    q_reach_indices = np.where(q >= q_star)[0]\n    t_q_star = int(q_reach_indices[0]) if len(q_reach_indices) > 0 else -1\n\n    return p_T, q_T, t_p_star, t_q_star\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Global parameters\n    T = 400\n    p_star = 0.6\n    q_star = 0.8\n\n    # Test suite of parameter sets\n    test_cases = {\n        'A': {\n            'p0': 0.01, 's': 0.02, 'r': 0.15, 'b0': 0.02, 'b1': 0.10, 'c': 0.01,\n            'omega': 360, 'q_epsilon': 0.02\n        },\n        'B': {\n            'p0': 0.01, 's': 0.015, 'r': 0.10, 'b0': 0.02, 'b1': 0.08, 'c': 0.012,\n            'omega': 240, 'q_epsilon': 0.02\n        },\n        'C': {\n            'p0': 0.05, 's': 0.00, 'r': 0.12, 'b0': 0.02, 'b1': 0.00, 'c': 0.005,\n            'omega': 360, 'q_epsilon': 0.01\n        },\n        'D': {\n            'p0': 0.01, 's': 0.02, 'r': 0.10, 'b0': 0.00, 'b1': 0.05, 'c': 0.02,\n            'omega': 240, 'q_epsilon': 0.02\n        }\n    }\n\n    results = []\n    case_order = ['A', 'B', 'C', 'D']\n\n    for case_id in case_order:\n        params = test_cases[case_id]\n        g_on = T - params['omega']\n        \n        p_T, q_T, t_p_star, t_q_star = run_simulation(\n            params['p0'], params['s'], params['r'], params['b0'],\n            params['b1'], params['c'], g_on, params['q_epsilon'],\n            T, p_star, q_star\n        )\n        \n        # Format results as specified\n        results.append(f\"{p_T:.6f}\")\n        results.append(f\"{q_T:.6f}\")\n        results.append(str(t_p_star))\n        results.append(str(t_q_star))\n\n    # Print the final output in the required single-line format\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}