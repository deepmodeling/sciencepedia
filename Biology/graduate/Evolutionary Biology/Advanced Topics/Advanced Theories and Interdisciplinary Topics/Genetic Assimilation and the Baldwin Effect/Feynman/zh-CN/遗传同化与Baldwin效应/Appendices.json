{
    "hands_on_practices": [
        {
            "introduction": "本练习深入探讨了反应规范演化的定量遗传学基础。通过应用多变量育种者方程，你将推导出平均表型（截距）及其可塑性（斜率）对作用于一系列环境的选择的演化响应。这项实践对于理解遗传相关和环境分布如何共同塑造适应性可塑性的演化至关重要，而适应性可塑性是鲍德温效应和遗传同化的核心机制。",
            "id": "2717165",
            "problem": "一个种群对某一数量性状在非生物环境中表现出线性反应范式。设在环境 $E$ 中表达的表型为 $z(E) = a + b E$，其中 $a$ 是截距（在 $E=0$ 时的表型），$b$ 是斜率（可塑性）。$a$ 和 $b$ 的加性遗传值具有均值 $\\bar{a}$ 和 $\\bar{b}$，以及一个遗传方差-协方差矩阵 $\\mathbf{G}$，其元素为 $G_{aa}$、$G_{ab}=G_{ba}$ 和 $G_{bb}$。遇到环境 $E$ 的概率密度为 $p(E)$，其矩为有限值。在环境 $E$ 中的相对适合度通过一个未知但平滑的函数依赖于 $z(E)$；定义表型上特定于环境的方向选择梯度为 $\\beta_{z}(E) = \\partial \\ln W(z,E)/\\partial z \\big|_{z=z(E)}$，其中 $W$ 是相对适合度。\n\n使用多变量育种家方程（也称为 Lande 方程），该方程指出，加性遗传性状均值向量的每代变化等于遗传方差-协方差矩阵乘以这些性状上的方向选择梯度向量。仔细应用链式法则和环境分布 $p(E)$，将对 $z(E)$ 的选择与对 $a$ 和 $b$ 的选择联系起来。\n\n对于上面定义的反应范式，哪个选项正确地给出了每代响应 $\\Delta \\bar{a}$ 和 $\\Delta \\bar{b}$（用 $\\mathbf{G}$、$p(E)$ 和 $\\beta_{z}(E)$ 表示），从而指明了对 $z(E)$ 的选择如何在整个环境分布中引致 $a$ 和 $b$ 的相关响应？\n\nA. $\\Delta \\begin{pmatrix}\\bar{a}\\\\ \\bar{b}\\end{pmatrix} = \\mathbf{G} \\begin{pmatrix}\\beta_{a}\\\\ \\beta_{b}\\end{pmatrix}$，其中 $\\beta_{a} = \\int \\beta_{z}(E)\\, p(E)\\, dE$ 且 $\\beta_{b} = \\int E\\, \\beta_{z}(E)\\, p(E)\\, dE$，因此明确地\n$\\Delta \\bar{a} = G_{aa}\\!\\int \\beta_{z}(E)p(E)dE + G_{ab}\\!\\int E\\,\\beta_{z}(E)p(E)dE$ 且\n$\\Delta \\bar{b} = G_{ab}\\!\\int \\beta_{z}(E)p(E)dE + G_{bb}\\!\\int E\\,\\beta_{z}(E)p(E)dE$。\n\nB. $\\Delta \\begin{pmatrix}\\bar{a}\\\\ \\bar{b}\\end{pmatrix} = \\mathbf{P} \\begin{pmatrix}\\beta_{a}\\\\ \\beta_{b}\\end{pmatrix}$，其中 $\\beta_{a} = \\int \\beta_{z}(E)\\, p(E)\\, dE$ 且 $\\beta_{b} = \\int E\\, \\beta_{z}(E)\\, p(E)\\, dE$，这里 $\\mathbf{P}$ 是 $a$ 和 $b$ 的表型方差-协方差矩阵。\n\nC. $\\Delta \\bar{a} = G_{aa} \\int \\beta_{z}(E)\\, p(E)\\, dE$ 且 $\\Delta \\bar{b} = G_{bb} \\int E\\, \\beta_{z}(E)\\, p(E)\\, dE$ （无非对角线项），因为选择分别作用于 $a$ 和 $b$。\n\nD. $\\Delta \\begin{pmatrix}\\bar{a}\\\\ \\bar{b}\\end{pmatrix} = \\mathbf{G} \\begin{pmatrix}\\beta_{a}\\\\ \\beta_{b}\\end{pmatrix}$，其中 $\\beta_{a} = \\int \\beta_{z}(E)\\, p(E)\\, dE$ 且 $\\beta_{b} = \\int \\dfrac{\\partial \\beta_{z}(E)}{\\partial E}\\, p(E)\\, dE$，因为斜率 $b$ 与跨 $E$ 的变化有关。\n\n选择唯一的最佳选项。",
            "solution": "我们从核心的数量遗传学原理和定义出发，推导其响应。反应范式为 $z(E) = a + b E$，其加性遗传参数为 $a$ 和 $b$。遗传方差-协方差矩阵为 $\\mathbf{G} = \\begin{pmatrix}G_{aa} & G_{ab}\\\\ G_{ab} & G_{bb}\\end{pmatrix}$。多变量育种家方程（Lande 方程）指出\n$$\n\\Delta \\boldsymbol{\\bar{\\theta}} = \\mathbf{G}\\, \\boldsymbol{\\beta},\n$$\n其中 $\\boldsymbol{\\bar{\\theta}} = \\begin{pmatrix}\\bar{a}\\\\ \\bar{b}\\end{pmatrix}$，而 $\\boldsymbol{\\beta} = \\begin{pmatrix}\\beta_{a}\\\\ \\beta_{b}\\end{pmatrix}$ 是作用于遗传参数 $a$ 和 $b$ 的方向选择梯度向量。性状上的方向选择梯度定义为平均相对适合度对该性状均值的偏导数，在弱选择下，这等同于相对适合度与该性状之间的协方差除以表型方差。在此，选择在每个环境 $E$ 中直接作用于 $z(E)$，其特定于环境的表型选择梯度为\n$$\n\\beta_{z}(E) \\equiv \\frac{\\partial \\ln W(z,E)}{\\partial z}\\Big|_{z=z(E)}.\n$$\n由于每个个体根据 $p(E)$ 遭遇环境 $E$，作用于遗传参数的总体选择梯度是特定于环境的梯度乘以表型对这些参数的敏感度（链式法则）后，以 $p(E)$ 为权重的期望值。敏感度为\n$$\n\\frac{\\partial z(E)}{\\partial a} = 1, \\quad \\frac{\\partial z(E)}{\\partial b} = E.\n$$\n因此，\n$$\n\\beta_{a} = \\int \\beta_{z}(E)\\, \\frac{\\partial z(E)}{\\partial a}\\, p(E)\\, dE = \\int \\beta_{z}(E)\\, p(E)\\, dE,\n$$\n$$\n\\beta_{b} = \\int \\beta_{z}(E)\\, \\frac{\\partial z(E)}{\\partial b}\\, p(E)\\, dE = \\int E\\, \\beta_{z}(E)\\, p(E)\\, dE.\n$$\n代入多变量育종家方程可得\n$$\n\\Delta \\bar{a} = G_{aa}\\, \\beta_{a} + G_{ab}\\, \\beta_{b}\n= G_{aa}\\!\\int \\beta_{z}(E)\\, p(E)\\, dE \\;+\\; G_{ab}\\!\\int E\\, \\beta_{z}(E)\\, p(E)\\, dE,\n$$\n$$\n\\Delta \\bar{b} = G_{ab}\\, \\beta_{a} + G_{bb}\\, \\beta_{b}\n= G_{ab}\\!\\int \\beta_{z}(E)\\, p(E)\\, dE \\;+\\; G_{bb}\\!\\int E\\, \\beta_{z}(E)\\, p(E)\\, dE.\n$$\n这些表达式显示了在环境分布上对 $z(E)$ 的选择如何引致 $a$ 和 $b$ 的直接响应和相关响应，这是通过环境权重 $p(E)$ 和遗传协方差 $G_{ab}$ 共同介导的。特别是，如果 $p(E)$ 在某个 $E^{\\ast}$ 附近变窄，且 $\\beta_{z}(E)$ 平滑变化，那么 $\\int E\\, \\beta_{z}(E)\\, p(E)\\, dE$ 趋向于 $E^{\\ast}\\int \\beta_{z}(E)\\, p(E)\\, dE$，从而减少了当在 $E=0$ 附近测量时专门针对 $b$ 的选择分量。在持续的新环境 $E^{\\ast}$ 下，选择将主要改变 $\\bar{a}$，并通过 $G_{ab}$ 引起 $\\bar{b}$ 的相关变化；如果环境随后稳定下来，$\\beta_{b}$ 会趋近于 $0$，从而有利于降低可塑性（与遗传同化一致），然而在短暂的环境异质性期间，非零的 $\\beta_{b}$ 会有利于适应性可塑性（通往 Baldwin 效应的一条途径）。\n\n逐项分析：\n- A: 这与推导相符。它使用了多变量育种家方程，并通过 $\\partial z/\\partial a = 1$ 和 $\\partial z/\\partial b = E$ 将 $\\beta_{z}(E)$ 正确地通过链式法则映射到 $\\beta_{a}$ 和 $\\beta_{b}$，并且通过 $G_{ab}$ 包含了相关响应项。结论 — 正确。\n- B: 此选项错误地使用了表型方差-协方差矩阵 $\\mathbf{P}$ 来代替遗传方差-协方差矩阵 $\\mathbf{G}$。育种家方程要求使用加性遗传方差和协方差来计算进化响应。结论 — 错误。\n- C: 此选项忽略了非对角线的遗传协方差项 $G_{ab}$。除非假设 $G_{ab}=0$，否则它无法捕捉相关响应，也不是题目所要求的一般表达式。结论 — 错误。\n- D: 此选项错误地识别了 $\\beta_{b}$。对 $b$ 的选择梯度来自于 $z(E)$ 对 $b$ 的敏感度，即 $E$，而非来自于 $\\partial \\beta_{z}(E)/\\partial E$。对环境求导混淆了选择如何作用于表型与表型如何依赖于遗传参数。结论 — 错误。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "这项实践将理论转向实验策略，挑战你像实验演化生物学家一样思考。你将设计一个实验方案，以区分对可塑性益处的选择和对其内在成本的选择，这是演化生物学中的一个基本挑战。本练习将磨练你构建具有适当对照的实验的能力，以检验关于促进渠道化和遗传同化的条件的特定假说。",
            "id": "2717228",
            "problem": "在一项实验进化研究中，您的目标是将表型可塑性成本的选择与平均表型的选择分离开来，以检验遗传同化和鲍德温效应的条件。考虑一个具有环境依赖性反应规范的单一数量性状。设表达的表型由线性映射给出\n$$\nz = a + b \\,(x - x_0),\n$$\n其中 $a$ 是反应规范的截距（参考环境中的平均表型），$b$ 是反应规范的斜率（可塑性），$x$ 是一个环境状态变量，$x_0$ 是一个固定的参考状态。适应度受到围绕环境特异性最适值 $\\theta(x)$ 的高斯稳定选择作用，其宽度参数为 $\\omega^2$，并且当诱导被触发时，激活可塑性机制会产生一种成本。假设个体适应度采用乘法形式\n$$\nW = \\exp\\!\\left(-\\frac{(z - \\theta(x))^2}{2\\,\\omega^2}\\right)\\times \\bigl(1 - c\\,b^2\\bigr)^{I},\n$$\n其中 $c \\in (0,1)$ 是可塑性诱导成本的参数，$I\\in\\{0,1\\}$ 是一个指示变量，当可塑性机制被诱导时等于 $1$，否则等于 $0$。假设当 $x = x_0$ 时，最适值等于一个常数 $\\theta_0$，即 $\\theta(x_0)=\\theta_0$。诱导事件 $I$ 可以在不改变 $x$ 或 $\\theta(x)$ 的情况下被外源控制（例如，通过激素类似物或线索呈现）。\n\n您可以使用从具有相同祖先分布初始化的重复种群，其中 $a$ 的加性遗传方差为 $G_{aa}$，$b$ 的加性遗传方差为 $G_{bb}$，且开始时 $a$ 和 $b$ 之间的协方差可以忽略不计。您可以在多代中实施环境方案，控制 $x$ 和诱导概率 $q=\\Pr(I=1)$，其中 $q$ 是由实验者选择的处理参数。假设在弱选择下遵循标准的数量遗传学（QG）动态，因此性状 $y\\in\\{a,b\\}$ 的平均值的预期变化为每代 $\\Delta \\bar{y} \\approx G_{yy}\\,\\beta_y$，其中 $\\beta_y = \\partial \\ln \\bar{W}/\\partial y$ 是作用于 $y$ 的选择梯度。\n\n您的目标是选择一个方案，将可塑性成本的选择与平均表型的选择分离开来，并预测在该方案下 $\\bar{a}$ 和 $\\bar{b}$ 的进化响应，以及对随后进入一个使可塑性具有适应性用途的新环境中，其直接适应度响应的定性预测。所有种群都维持在相同的普查规模和人口学条件下，并且 $c\\,\\bar{b}^2 \\ll 1$，因此泰勒近似是有效的。\n\n哪个选项最好地指定了一个方案，该方案能够清晰地将可塑性成本的选择与平均表型的选择分离开来，并正确预测在所述模型下的进化结果？\n\nA. 在所有种群的所有世代中，将环境状态维持在 $x=x_0$，因此在每一代中 $\\theta(x)=\\theta_0$ 且 $z=a$。将重复品系随机分配到两种处理中：一种是未诱导处理，$q=0$（无外源线索；所有个体和世代的 $I=0$）；另一种是强制诱导处理，$q=1$（每代都有外源线索；所有个体的 $I=1$），而不改变 $x$ 或 $\\theta(x)$。预测：因为当 $x=x_0$ 时，稳定选择分量仅依赖于 $a$，所以对 $a$ 的选择在不同处理中是相同的，选择梯度为 $\\beta_a \\approx -(\\bar{a}-\\theta_0)/\\omega^2$；而对 $b$ 的选择梯度在 $q=0$ 时为 $\\beta_b\\approx 0$，在 $q=1$ 时为 $\\beta_b \\approx -2c\\,\\bar{b}$（对 $c$ 取一阶近似），因此 $\\bar{b}$ 仅在强制诱导处理中下降。许多代之后，两种处理的 $\\bar{a}\\to \\theta_0$，但只有强制诱导品系表现出可塑性降低（渠道化）。如果随后暴露于一个新环境，其中 $x\\neq x_0$ 且最适值随 $x$ 变化（例如 $\\theta(x)=\\theta_0+\\alpha\\,(x-x_0)$ 且 $\\alpha>0$），未诱导品系通过可塑性追踪（一种鲍德温效应）享有更高的即时适应度，而强制诱导品系则因 $\\bar{b}$ 降低而落后。\n\nB. 使用两种具有不同最适值的环境，在一组重复中设置 $x=x_0$，在另一组中设置 $x=x_0+\\delta$，同时在两组中都保持 $q=1$，以便总是触发诱导。预测：环境间 $\\bar{b}$ 的差异揭示了可塑性的成本，因为诱导成本在两种环境中都适用，并且 $\\bar{a}$ 会独立地进化以匹配各自环境的 $\\theta(x)$。\n\nC. 在所有种群中维持 $x=x_0$ 和 $q=0$，因此 $z=a$ 且从不发生诱导，但测量可塑性成本的代谢代理指标，并假设它对 $b$ 施加了选择压力。预测：即使没有诱导，$\\bar{b}$ 也会因对抗维持成本的选择而下降，而 $\\bar{a}$ 则向 $\\theta_0$ 进化。\n\nD. 在每一代中，呈现一个围绕 $x_0$ 的对称 $x$ 值分布，其中一个处理的均值与另一个相同但方差更高，并在两个处理中都保持 $q=0$。预测：高方差处理隔离了对可塑性成本的选择，因为平均最适值是相同的，所以由于更频繁的错配，$\\bar{b}$ 在那里下降得更快，而 $\\bar{a}$ 在不同处理中保持相似。",
            "solution": "所提出的问题要求基于一个特定的数量遗传学模型，设计一个实验方案，以将表型可塑性成本的选择与平均表型的选择分离开来。\n\n### 求解推导\n\n目标是设计一个实验方案，将可塑性成本的选择（与 $b$ 和 $c$ 相关）与可塑性适应性价值的选择（与 $b$ 追踪 $\\theta(x)$ 相关）分离开来。\n\n个体的对数适应度为：\n$$\n\\ln W(a,b,I|x) = -\\frac{(a + b(x-x_0) - \\theta(x))^2}{2\\omega^2} + I \\ln(1 - cb^2)\n$$\n在弱选择近似下，作用于种群平均性状 $\\bar{a}$ 和 $\\bar{b}$ 的选择梯度由在平均性状值处评估的 $\\ln W$ 偏导数的期望值给出。\n$$\n\\beta_a = E_{x,I}\\left[ \\frac{\\partial \\ln W}{\\partial a} \\right] \\approx E_{x,I}\\left[ -\\frac{\\bar{a} + \\bar{b}(x-x_0) - \\theta(x)}{\\omega^2} \\right]\n$$\n$$\n\\beta_b = E_{x,I}\\left[ \\frac{\\partial \\ln W}{\\partial b} \\right] \\approx E_{x,I}\\left[ -\\frac{(\\bar{a} + \\bar{b}(x-x_0) - \\theta(x))}{\\omega^2}(x-x_0) + I \\frac{-2c\\bar{b}}{1-c\\bar{b}^2} \\right]\n$$\n使用近似 $c\\bar{b}^2 \\ll 1$，我们得到 $\\ln(1-c\\bar{b}^2) \\approx -c\\bar{b}^2$ 和 $\\frac{-2c\\bar{b}}{1-c\\bar{b}^2} \\approx -2c\\bar{b}$。作用于 $b$ 的梯度变为：\n$$\n\\beta_b \\approx E_{x,I}\\left[ -\\frac{(\\bar{a} + \\bar{b}(x-x_0) - \\theta(x))}{\\omega^2}(x-x_0) - 2c\\bar{b}I \\right]\n$$\n为了分离对可塑性成本的选择，我们必须消除 $\\beta_b$ 表达式中的第一项，该项代表了因 $b$ 在使表型 $z$ 匹配最适值 $\\theta(x)$ 方面的作用而受到的选择。该项与 $(x-x_0)$ 成正比。使该项为零的最直接方法是确保在所有世代的所有个体中，$x-x_0 = 0$。\n\n现在让我们根据这一要求评估每个选项。\n\n**选项A分析**\n\n-   **方案**：环境固定在 $x=x_0$。建立两种处理：一种是 $q=0$（因此所有个体的 $I=0$），另一种是 $q=1$（因此所有个体的 $I=1$）。\n-   **推导**：当 $x=x_0$ 时，表型简化为 $z = a$。最适值为 $\\theta(x_0) = \\theta_0$。选择梯度的一般表达式变为：\n    -   $\\beta_a = E_{I}\\left[ -\\frac{\\bar{a} - \\theta_0}{\\omega^2} \\right] = -\\frac{\\bar{a} - \\theta_0}{\\omega^2}$。这与诱导处理无关。在两种处理中，选择都将驱使 $\\bar{a}$ 朝向 $\\theta_0$。\n    -   $\\beta_b \\approx E_{I}\\left[ -\\frac{(\\bar{a} - \\theta_0)}{\\omega^2}(0) - 2c\\bar{b}I \\right] = -2c\\bar{b} E[I] = -2c\\bar{b}q$。\n-   **在未诱导处理中（$q=0$）**：$\\beta_a = -(\\bar{a}-\\theta_0)/\\omega^2$ 且 $\\beta_b \\approx 0$。选择作用于 $a$，但 $b$ 是中性的。\n-   **在强制诱导处理中（$q=1$）**：$\\beta_a = -(\\bar{a}-\\theta_0)/\\omega^2$ 且 $\\beta_b \\approx -2c\\bar{b}$。选择像以前一样作用于 $a$，但现在由于成本，对 $b$ 存在直接的负选择。\n-   **结论**：该方案成功地将对 $a$ 和 $b$ 的选择解耦。通过设置 $x=x_0$，可塑性对表型的影响被消除, 使得适应度的稳定选择分量仅依赖于 $a$。成本分量仅依赖于 $b$（和 $I$）。$q=0$ 和 $q=1$ 处理之间的比较因此完美地隔离了诱导成本的影响。选项中陈述的预测直接由此得出：在两种处理中 $\\bar{a}$ 都向 $\\theta_0$ 进化，而 $\\bar{b}$ 仅在 $q=1$ 处理中由于成本而向 $0$ 进化（渠道化）。随后的新环境测试正确地预测了 $q=0$ 品系，因为它保留了祖先的可塑性，可能会比渠道化的 $q=1$ 品系表现出更高的适应度，这是教科书级别关于可塑性潜在益处（与鲍德温效应相关）的例证。\n-   **结论**：**正确**。\n\n**选项B分析**\n\n-   **方案**：两个环境处理，$x=x_0$ 和 $x=x_0+\\delta$，两者都进行强制诱导（$q=1$，因此 $I=1$）。\n-   **结论**：这个方案混淆了因 $b$ 在追踪最适值方面的作用而受到的选择和由于成本而产生的选择。它没有将这两种选择来源分开。\n-   **结论**：**不正确**。\n\n**选项C分析**\n\n-   **方案**：在所有种群中维持 $x=x_0$ 和 $q=0$（$I=0$）。\n-   **结论**：在问题中指定的适应度函数下，对 $b$ 没有选择作用。预测“$\\bar{b}$ 会因对抗维持成本的选择而下降”是无效的，因为模型中不包含此类“维持成本”。\n-   **结论**：**不正确**。\n\n**选项D分析**\n\n-   **方案**：两种处理，具有围绕 $x_0$ 的对称 $x$ 分布，但方差不同。诱导始终关闭（$q=0$，因此 $I=0$）。\n-   **结论**：由于始终 $I=0$，成本项 $(1-cb^2)^I$ 始终为 $1$。因此，对成本参数 $c$ 没有选择作用。该方案根据其设计，无法测试问题中定义的可塑性成本的影响。\n-   **结论**：**不正确**。\n\n基于这一全面分析，只有选项A提供了一个能够正确地将可塑性成本的选择与其他作用于反应规范的选择来源分离开来的方案，并且其预测与所提供的模型一致。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "这最后一个实践提供了计算演化生物学中的一个顶级综合体验，要求你从基本原理出发构建一个基于个体的模拟。你将实现一个 Wright-Fisher 模型来模拟遗传同化的过程，观察种群如何首先通过可塑性适应，然后在一个新的、稳定的环境中演化出遗传上固定的性状。通过操纵可塑性成本等参数，你将对驱动这一经典演化现象的力量获得直观和动态的理解。",
            "id": "2717245",
            "problem": "设计并实现一个基于个体的 Wright–Fisher 模拟，以检验在不同表型可塑性代价下是否会出现遗传同化，该模拟需基于自然选择、基因型-表型映射和稳定性选择的定义。您的程序必须实现以下模型、规则和检测准则，然后运行一个指定的测试套件。最终输出必须是单行内容，其中包含一个整数列表，具体格式见末尾规定。\n\n基本原理：使用以下广为接受的定义和规则：\n- 自然选择被建模为与适应度成比例的差异性繁殖，其中适应度是表型与环境不匹配度以及任何内在代价的非负函数。\n- 基因型-表型映射是一个从遗传变量到性状值的确定性或随机性函数。\n- 在围绕最适值的稳定性选择下，表型的适应度是与最适值偏差平方的减函数。\n- Wright–Fisher 种群在离散的、非重叠的世代中演化，其繁殖通过与适应度成比例的多项式抽样进行。\n\n模型设定：\n1) 基因型。每个个体 $i$ 携带一个双位点数量基因型 $\\mathbf{g}_i(t) = (a_i(t), b_i(t))$，其中 $a_i(t)$ 是遗传编码的基线（截距），$b_i(t)$ 是遗传编码的线性可塑性系数（斜率）。\n2) 发育映射。在第 $t$ 代，个体 $i$ 表达的表型为\n$$\nz_i(t) = a_i(t) + b_i(t) \\, c_t,\n$$\n其中 $c_t$ 是一个环境线索。不存在额外的发育噪音。\n3) 环境。环境分为两个阶段：\n   - 阶段一（转变前）：对于 $t \\in \\{0,1,\\dots,T_{\\mathrm{shift}}-1\\}$，从 $\\mathcal{N}(0,1)$ 中抽取 $c_t$，并设定适应度最适值 $\\theta_t = c_t$。\n   - 阶段二（转变后）：对于 $t \\in \\{T_{\\mathrm{shift}}, T_{\\mathrm{shift}}+1, \\dots, G-1\\}$，设定 $c_t = 0$，并将适应度最适值固定在 $\\theta_t = \\theta^\\star$。\n4) 适应度。设围绕最适值的稳定性选择具有高斯形式，宽度参数为 $\\omega > 0$，并施加一个与 $b_i(t)^2$ 成比例的可塑性乘积代价，代价系数为 $k \\ge 0$：\n$$\nw_i(t) = \\exp\\!\\left( - \\frac{(z_i(t) - \\theta_t)^2}{2 \\, \\omega^2} \\right) \\cdot \\exp\\!\\left( - k \\, b_i(t)^2 \\right).\n$$\n5) 繁殖与突变。使用种群大小为 $N$ 的 Wright–Fisher 模型。在每一代中，以与 $w_i(t)$ 成比例的概率进行有放回抽样，选出 $N$ 个亲本。每个子代继承其亲本的基因型，并伴有加性高斯突变：\n$$\na_i(t+1) = a_{\\pi(i)}(t) + \\varepsilon_{a,i}(t), \\quad \\varepsilon_{a,i}(t) \\sim \\mathcal{N}(0,\\sigma_a^2), \\\\\nb_i(t+1) = b_{\\pi(i)}(t) + \\varepsilon_{b,i}(t), \\quad \\varepsilon_{b,i}(t) \\sim \\mathcal{N}(0,\\sigma_b^2),\n$$\n突变在个体间和位点间独立发生，其中 $\\pi(i)$ 表示子代 $i$ 的亲本索引。突变后通过截断将 $b_i(t)$ 约束在一个有限区间内。\n6) 初始化。在 $t=0$ 时，从 $\\mathcal{N}(0,\\sigma_{\\mathrm{init}}^2)$ 中独立抽取 $a_i(0)$ 和 $b_i(0)$ 进行初始化。\n\n遗传同化的检测。此处，遗传同化定义为：在恒定的转变后环境中，个体不再依赖可塑性，同时所需表型得以遗传固定。操作上，对于阶段二中一个大小为 $W$ 的连续世代滑动窗口，在满足以下两个条件的最早世代 $t \\ge T_{\\mathrm{shift}} + W - 1$ 宣布发生同化：\n- 小可塑性准则：对于所有世代 $g \\in \\{t-W+1,\\dots,t\\}$，满足 $\\lvert \\bar{b}(g) \\rvert \\le \\varepsilon_b$。其中 $\\bar{b}(g)$ 是第 $g$ 代的种群平均可塑性系数值。\n- 遗传固定准则：对于所有 $g \\in \\{t-W+1,\\dots,t\\}$，满足 $\\lvert \\bar{a}(g) - \\theta^\\star \\rvert \\le \\varepsilon_a$。其中 $\\bar{a}(g)$ 是第 $g$ 代的种群平均基线值。\n如果在 $G-1$ 之前不存在这样的 $t$，则报告未发生同化。\n\n使用的模拟参数：\n- 种群大小 $N = 200$。\n- 总世代数 $G = 800$。\n- 环境转变世代 $T_{\\mathrm{shift}} = 400$。\n- 转变后的最适值 $\\theta^\\star = 1.0$。\n- 稳定性选择宽度 $\\omega = 0.5$。\n- 突变标准差 $\\sigma_a = 0.02$ 和 $\\sigma_b = 0.02$。\n- 初始化标准差 $\\sigma_{\\mathrm{init}} = 0.01$。\n- 可塑性截断边界 $b_{\\min} = -5$ 和 $b_{\\max} = 5$（每代突变后通过截断应用）。\n- 同化窗口大小 $W = 10$。\n- 阈值 $\\varepsilon_b = 0.05$ 和 $\\varepsilon_a = 0.05$。\n- 随机性。对所有随机过程使用固定的种子 $12345$，以确保结果是可复现的。\n\n数值细节：\n- 使用对数适应度来稳定地计算抽样概率，方法是在指数化前减去最大对数适应度。\n- 如果数值下溢导致所有未归一化的权重都为零，则回退到均匀抽样。\n\n测试套件：运行四个独立的案例，仅可塑性代价系数 $k$ 不同：\n- 案例 1：$k = 0.0$。\n- 案例 2：$k = 0.001$。\n- 案例 3：$k = 0.01$。\n- 案例 4：$k = 0.05$。\n\n答案规格：\n- 对于每个案例，输出一个整数：满足同化准则的最早世代索引 $t$；如果始终未满足，则输出 $-1$。\n- 您的程序应生成单行输出，包含一个方括号括起来的逗号分隔列表（例如，$[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4]$）。",
            "solution": "该解决方案实现了一个基于个体的模拟，用以建模一个数量性状在不断变化的环境条件下的演化，具体过程如问题所述。算法的核心是根据 Wright–Fisher 模型，对一个大小为 $N$ 的种群进行 $G$ 个非重叠世代的离散时间模拟。\n\n**1. 模型与状态表示**\n在任何世代 $t$，种群由 $N=200$ 个个体组成。每个个体 $i$ 的基因型由一对连续值 $\\mathbf{g}_i(t) = (a_i(t), b_i(t))$ 表示，分别对应遗传基线和可塑性系数。这些值存储在两个数值数组中，一个用于所有 $a_i$ 值的集合，另一个用于 $b_i$ 值的集合。\n\n**2. 模拟初始化**\n在初始世代 $t=0$，通过从一个独立同分布的高斯分布 $\\mathcal{N}(0, \\sigma_{\\mathrm{init}}^2)$ 中为所有 $i \\in \\{1, \\dots, N\\}$ 抽取 $a_i(0)$ 和 $b_i(0)$ 的值来初始化基因型，其中 $\\sigma_{\\mathrm{init}}=0.01$。然后，将可塑性系数 $b_i(0)$ 截断到区间 $[b_{\\min}, b_{\\max}]$ 内，即 $[-5, 5]$。对于四个测试案例中的每一个，都使用固定的种子 $12345$ 来初始化一个专用的伪随机数生成器，以确保随机轨迹（环境波动、突变）是相同的，从而隔离了可塑性代价系数 $k$ 的影响。\n\n**3. 世代循环**\n模拟从 $t=0$ 到 $G-1=799$ 迭代进行。在每一代中，发生以下一系列事件：\n\n*   **环境定义**：确定环境线索 $c_t$ 和表型最适值 $\\theta_t$。\n    *   在阶段一（$t < T_{\\mathrm{shift}}=400$），环境是可变的。$c_t$ 从标准正态分布 $\\mathcal{N}(0,1)$ 中抽取，最适值设定为与线索匹配，即 $\\theta_t = c_t$。这种选择机制有利于可塑性，因为它允许个体追踪波动的最适值。\n    *   在阶段二（$t \\ge T_{\\mathrm{shift}}=400$），环境变得恒定。线索固定为 $c_t=0$，最适值固定在一个新值 $\\theta_t = \\theta^\\star = 1.0$。\n\n*   **表型表达**：每个个体的表型 $z_i(t)$ 根据其基因型和环境线索，通过线性发育图计算得出：\n    $$\n    z_i(t) = a_i(t) + b_i(t) c_t\n    $$\n\n*   **适应度计算**：每个个体的适应度 $w_i(t)$ 基于其表型与最适值的匹配程度以及可塑性的内在代价计算得出。\n    $$\n    w_i(t) = \\exp\\left( - \\frac{(z_i(t) - \\theta_t)^2}{2 \\omega^2} \\right) \\cdot \\exp\\left( - k b_i(t)^2 \\right)\n    $$\n    其中 $\\omega=0.5$ 是稳定性选择的宽度，而 $k$ 是代价系数。为了保持数值稳定性，计算使用对数适应度。在进行指数运算前，通过减去其最大值来平移对数适应度值，以防止在计算用于抽样的相对适应度权重时发生浮点数下溢。\n\n*   **繁殖**：通过从当前代中有放回地抽样 $N$ 个亲本，形成下一代。个体 $i$ 被选为亲本的概率与其适应度成正比，即 $p_i \\propto w_i(t)$。\n\n*   **遗传与突变**：$N$ 个子代中的每一个都继承其所选亲本的基因型。然后，该基因型会发生突变。\n    $$\n    a_i(t+1) = a_{\\pi(i)}(t) + \\varepsilon_{a,i}(t), \\quad \\text{其中 } \\varepsilon_{a,i}(t) \\sim \\mathcal{N}(0, \\sigma_a^2) \\\\\n    b_i(t+1) = b_{\\pi(i)}(t) + \\varepsilon_{b,i}(t), \\quad \\text{其中 } \\varepsilon_{b,i}(t) \\sim \\mathcal{N}(0, \\sigma_b^2)\n    $$\n    其中 $\\sigma_a = \\sigma_b = 0.02$。突变后，新的可塑性系数 $b_i(t+1)$ 被截断，以确保它们保持在区间 $[-5, 5]$ 内。\n\n**4. 遗传同化的检测**\n模拟在阶段二期间检查遗传同化的发生。检查从第 $t = T_{\\mathrm{shift}} + W - 1 = 409$ 代开始。对于此后的每一代 $t$ 直到 $G-1$，算法会检查过去 $W=10$ 个世代的滑动窗口内种群的平均基因型 $\\bar{a}(g)$ 和 $\\bar{b}(g)$。在以下两个条件于窗口中所有世代同时满足的第一个世代 $t$ 时，宣布发生同化：\n1.  **小可塑性准则**：$|\\bar{b}(g)| \\le \\varepsilon_b$，其中 $\\varepsilon_b = 0.05$。\n2.  **遗传固定准则**：$|\\bar{a}(g) - \\theta^\\star| \\le \\varepsilon_a$，其中 $\\varepsilon_a=0.05$ 且 $\\theta^\\star=1.0$。\n\n如果这些条件得到满足，则将该世代索引 $t$ 记录为同化时间。如果在完成所有 $G$ 个世代后条件仍未满足，则记录值为 $-1$。\n\n**5. 测试套件的执行**\n整个模拟被封装在一个函数中，该函数针对可塑性代价 $k$ 的每个指定值 $k \\in \\{0.0, 0.001, 0.01, 0.05\\}$ 执行四次。这四次运行的结果被收集并格式化为所要求的输出列表。",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(k, rng, N, G, T_shift, theta_star, omega, sigma_a, sigma_b, sigma_init, b_min, b_max, W, epsilon_a, epsilon_b):\n    \"\"\"\n    Runs a single Wright-Fisher simulation for genetic assimilation.\n    \"\"\"\n    # 1. Initialization\n    a = rng.normal(loc=0.0, scale=sigma_init, size=N)\n    b = rng.normal(loc=0.0, scale=sigma_init, size=N)\n    b = np.clip(b, b_min, b_max)\n\n    mean_a_history = []\n    mean_b_history = []\n    \n    assimilation_time = -1\n\n    # 2. Main generation loop\n    for t in range(G):\n        # 2a. Environment\n        if t < T_shift:\n            c_t = rng.normal(loc=0.0, scale=1.0)\n            theta_t = c_t\n        else:\n            c_t = 0.0\n            theta_t = theta_star\n\n        # 2b. Phenotype\n        z = a + b * c_t\n\n        # 2c. Fitness calculation (using log-fitness for stability)\n        log_w = -((z - theta_t)**2 / (2 * omega**2)) - k * (b**2)\n        \n        log_w -= np.max(log_w)\n        w = np.exp(log_w)\n        \n        sum_w = np.sum(w)\n        if sum_w == 0.0:\n            probs = np.full(N, 1.0 / N)\n        else:\n            probs = w / sum_w\n\n        # 2d. Reproduction (Wright-Fisher sampling)\n        parent_indices = rng.choice(N, size=N, p=probs, replace=True)\n        a_parents = a[parent_indices]\n        b_parents = b[parent_indices]\n\n        # 2e. Mutation\n        a_new = a_parents + rng.normal(loc=0.0, scale=sigma_a, size=N)\n        b_new = b_parents + rng.normal(loc=0.0, scale=sigma_b, size=N)\n        \n        # 2f. Truncation of plasticity coefficient\n        b_new = np.clip(b_new, b_min, b_max)\n        \n        a = a_new\n        b = b_new\n\n        # 3. Data recording for assimilation check\n        mean_a_history.append(np.mean(a))\n        mean_b_history.append(np.mean(b))\n\n        # 4. Check for genetic assimilation\n        if t >= T_shift + W - 1:\n            window_start_idx = t - W + 1\n            \n            a_mean_window = np.array(mean_a_history[window_start_idx : t + 1])\n            b_mean_window = np.array(mean_b_history[window_start_idx : t + 1])\n            \n            fixation_condition = np.all(np.abs(a_mean_window - theta_star) <= epsilon_a)\n            plasticity_condition = np.all(np.abs(b_mean_window) <= epsilon_b)\n            \n            if fixation_condition and plasticity_condition:\n                assimilation_time = t\n                break\n\n    return assimilation_time\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    N = 200\n    G = 800\n    T_shift = 400\n    theta_star = 1.0\n    omega = 0.5\n    sigma_a = 0.02\n    sigma_b = 0.02\n    sigma_init = 0.01\n    b_min, b_max = -5.0, 5.0\n    W = 10\n    epsilon_a = 0.05\n    epsilon_b = 0.05\n    seed = 12345\n    \n    k_values = [0.0, 0.001, 0.01, 0.05]\n    \n    results = []\n    \n    for k in k_values:\n        rng = np.random.default_rng(seed)\n        \n        result = run_simulation(\n            k, rng, N, G, T_shift, theta_star, omega, \n            sigma_a, sigma_b, sigma_init, b_min, b_max, \n            W, epsilon_a, epsilon_b\n        )\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}