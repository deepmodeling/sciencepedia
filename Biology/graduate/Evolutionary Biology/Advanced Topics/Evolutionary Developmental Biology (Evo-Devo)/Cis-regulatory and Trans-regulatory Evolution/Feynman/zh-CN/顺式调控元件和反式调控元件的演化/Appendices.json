{
    "hands_on_practices": [
        {
            "introduction": "研究顺式（cis）和反式（trans）调控演化的第一步，是从实验数据中准确地量化这些效应。本练习提供了一个动手实践机会，让您能够使用经典的F1杂交实验设计来剖析基因表达差异的顺式和反式组分，这是功能基因组学中的一项基石技术 。您将学习如何整合来自亲本品系、杂交子代中的等位基因特异性表达（ASE）以及用于校正偏差的基因组DNA对照的数据，从而得出可靠的估计值。",
            "id": "2696998",
            "problem": "您正在研究两个已分化的单倍体菌株（记为菌株 $P$ 和菌株 $Q$）中的一个单基因。在菌株 $P$ 和 $Q$ 中，通过核糖核酸测序（RNA-seq）对信使核糖核酸（mRNA）的丰度进行量化（具有重复文库和已知的文库大小），在F1代杂交体中测量等位基因特异性表达（ASE），并使用杂合基因组DNA（gDNA）对照来量化比对偏倚。假设遵循以下基本建模原则。\n\n- 中心法则和表达测量：对于给定基因，RNA-seq的读取计数与潜在的mRNA丰度成正比，并受文库大小的调节。在对数尺度上，对于该基因，跨菌株的重复测量丰度之间的随机性，可以通过一个同方差对数正态模型很好地近似。\n\n- 顺式与反式效应：设 $E_{P}$ 和 $E_{Q}$ 分别为在相同环境下生长的菌株 $P$ 和 $Q$ 中该基因的平均mRNA丰度。在自然对数尺度上，假设一个加性模型 $\\ln(E_{P}) - \\ln(E_{Q}) = \\gamma + \\tau$，其中 $\\gamma$ 是顺式调控对数效应（等位基因特异性，共享反式环境），$\\tau$ 是反式调控对数效应（背景特异性，所有等位基因共享）。\n\n- F1代杂交体中ASE的逻辑：在F1代杂交体中，两个等位基因经历相同的反式环境，因此等位基因特异性丰度的对数比值等于 $\\gamma$。由于序列比对偏倚，观测到的ASE读取计数被一个偏向某个等位基因的未知乘性比对偏倚因子 $b$ 所扭曲，因此比对到 $P$ 等位基因与 $Q$ 等位基因的读取数的预期比值（odds）要乘以 $b$。\n\n- 似然假设：对于亲本样本，对数正态模型意味着 $\\ln(E_{P}/E_{Q})$ 的最大似然估计（MLE）等于菌株 $P$ 和 $Q$ 中重复样本的文库大小标准化计数的平均对数值之差。对于F1代中的ASE，将比对到的等位基因计数视为二项分布抽样的读取，其比值（odds）与真实的等位基因特异性丰度乘以比对偏倚成正比，顺式比值（cis odds）的MLE等于观测到的等位基因比值（allele odds）除以 $b$。gDNA对照（潜在的等位基因拷贝数相等）提供了 $b$ 的MLE，即观测到的gDNA等位基因比值（gDNA allele odds）。\n\n此基因的数据：\n- 亲本 $P$ 的RNA-seq数据：重复计数 $(y_{P,1},y_{P,2},y_{P,3}) = (120, 150, 90)$，对应的文库大小为 $(L_{P,1},L_{P,2},L_{P,3}) = (10 \\times 10^{6}, 12 \\times 10^{6}, 8 \\times 10^{6})$ 总比对读取数。\n- 亲本 $Q$ 的RNA-seq数据：重复计数 $(y_{Q,1},y_{Q,2},y_{Q,3}) = (60, 70, 65)$，对应的文库大小为 $(L_{Q,1},L_{Q,2},L_{Q,3}) = (11 \\times 10^{6}, 9 \\times 10^{6}, 10 \\times 10^{6})$ 总比对读取数。\n- 该基因在F1代杂交体中的ASE计数：分配给等位基因 $P$ 的读取数为 $260$，分配给等位基因 $Q$ 的读取数为 $140$。\n- 该基因座的杂合gDNA对照：分配给等位基因 $P$ 的读取数为 $5200$，分配给等位基因 $Q$ 的读取数为 $4800$。\n\n仅使用上述建模假设和第一性原理似然推理，计算由 $\\ln(E_{P}/E_{Q}) = \\gamma + \\tau$ 定义的反式调控对数效应 $\\tau$ 的最大似然估计（以自然对数为底）。将您的最终答案表示为单个实数。将最终答案四舍五入到四位有效数字。",
            "solution": "该问题是有效的。它在科学上基于进化和功能基因组学的原理，特别是将基因表达差异分解为顺式和反式调控组分。该问题提供了一套清晰、自洽的假设、数据和定义，可以通过逻辑和数学推理得出一个唯一的解。\n\n目标是计算反式调控对数效应（记为 $\\tau$）的最大似然估计（MLE）。提供的基本模型是自然对数尺度上的一个加性分解：\n$$ \\ln(E_{P}) - \\ln(E_{Q}) = \\gamma + \\tau $$\n其中 $E_{P}$ 和 $E_{Q}$ 是菌株 $P$ 和 $Q$ 中的平均mRNA丰度，$\\gamma$ 是顺式调控对数效应，$\\tau$ 是反式调控对数效应。\n\n根据最大似然估计的不变性，$\\tau$ 的MLE（记为 $\\hat{\\tau}$）由以下公式给出：\n$$ \\hat{\\tau} = \\widehat{\\ln(E_{P}/E_{Q})} - \\hat{\\gamma} $$\n这需要我们首先计算总表达量对数比值的MLE，即 $\\widehat{\\ln(E_{P}/E_{Q})}$，以及顺式调控对数效应的MLE，即 $\\hat{\\gamma}$。\n\n步骤1：估计总表达量对数比值 $\\widehat{\\ln(E_{P}/E_{Q})}$。\n问题陈述，$\\ln(E_{P}/E_{Q})$ 的MLE是文库大小标准化计数的平均对数值之差。设 $y_{S,i}$ 为菌株 $S \\in \\{P, Q\\}$ 的第 $i$ 个重复样本的读取计数，$L_{S,i}$ 为其文库大小。给定重复样本的文库大小标准化表达量为 $n_{S,i} = y_{S,i} / L_{S,i}$。\n那么，MLE为：\n$$ \\widehat{\\ln(E_{P}/E_{Q})} = \\frac{1}{3} \\sum_{i=1}^{3} \\ln(n_{P,i}) - \\frac{1}{3} \\sum_{i=1}^{3} \\ln(n_{Q,i}) = \\frac{1}{3} \\ln \\left( \\frac{\\prod_{i=1}^{3} n_{P,i}}{\\prod_{i=1}^{3} n_{Q,i}} \\right) $$\n菌株 $P$ 的数据为计数 $(y_{P,1}, y_{P,2}, y_{P,3}) = (120, 150, 90)$ 和文库大小 $(L_{P,1}, L_{P,2}, L_{P,3}) = (10 \\times 10^{6}, 12 \\times 10^{6}, 8 \\times 10^{6})$。标准化计数的乘积为：\n$$ \\prod_{i=1}^{3} n_{P,i} = \\left(\\frac{120}{10 \\times 10^{6}}\\right) \\left(\\frac{150}{12 \\times 10^{6}}\\right) \\left(\\frac{90}{8 \\times 10^{6}}\\right) = \\frac{1620000}{960 \\times 10^{18}} = 1687.5 \\times 10^{-21} $$\n菌株 $Q$ 的数据为计数 $(y_{Q,1}, y_{Q,2}, y_{Q,3}) = (60, 70, 65)$ 和文库大小 $(L_{Q,1}, L_{Q,2}, L_{Q,3}) = (11 \\times 10^{6}, 9 \\times 10^{6}, 10 \\times 10^{6})$。标准化计数的乘积为：\n$$ \\prod_{i=1}^{3} n_{Q,i} = \\left(\\frac{60}{11 \\times 10^{6}}\\right) \\left(\\frac{70}{9 \\times 10^{6}}\\right) \\left(\\frac{65}{10 \\times 10^{6}}\\right) = \\frac{273000}{990 \\times 10^{18}} = \\frac{27300}{99} \\times 10^{-21} $$\n乘积之比为：\n$$ \\frac{\\prod n_{P,i}}{\\prod n_{Q,i}} = \\frac{1687.5}{\\frac{27300}{99}} = \\frac{1687.5 \\times 99}{27300} = \\frac{167062.5}{27300} = \\frac{4455}{728} $$\n因此，总表达量对数比值的MLE为：\n$$ \\widehat{\\ln(E_{P}/E_{Q})} = \\frac{1}{3} \\ln\\left(\\frac{4455}{728}\\right) $$\n\n步骤2：估计顺式调控对数效应 $\\hat{\\gamma}$。\n顺式效应 $\\gamma$ 是F1代杂交体中等位基因特异性丰度的对数比值。观测到的等位基因特异性读取计数受到因子 $b$ 的偏倚影响。问题陈述，真实顺式比值 $\\exp(\\gamma)$ 的MLE等于从ASE中观测到的等位基因比值除以偏倚的MLE $\\hat{b}$。\n首先，我们从杂合gDNA对照中估计 $\\hat{b}$。在gDNA中，真实的等位基因拷贝数比例为 $1:1$。该模型意味着 $\\hat{b}$ 等于观测到的gDNA等位基因比值。\n给定等位基因 $P$ 和 $Q$ 的gDNA计数为 $N_{P,gDNA} = 5200$ 和 $N_{Q,gDNA} = 4800$：\n$$ \\hat{b} = \\frac{N_{P,gDNA}}{N_{Q,gDNA}} = \\frac{5200}{4800} = \\frac{52}{48} = \\frac{13}{12} $$\n接下来，我们使用F1代杂交体的ASE计数：$N_{P,ASE} = 260$ 和 $N_{Q,ASE} = 140$。观测到的ASE比值为：\n$$ \\frac{N_{P,ASE}}{N_{Q,ASE}} = \\frac{260}{140} = \\frac{13}{7} $$\n那么，顺式比值的MLE为：\n$$ \\exp(\\hat{\\gamma}) = \\frac{N_{P,ASE}/N_{Q,ASE}}{\\hat{b}} = \\frac{13/7}{13/12} = \\frac{13}{7} \\times \\frac{12}{13} = \\frac{12}{7} $$\n取自然对数，得到顺式调控对数效应的MLE：\n$$ \\hat{\\gamma} = \\ln\\left(\\frac{12}{7}\\right) $$\n\n步骤3：估计反式调控对数效应 $\\hat{\\tau}$。\n现在，我们将总效应和顺式调控效应的估计值代入主方程：\n$$ \\hat{\\tau} = \\widehat{\\ln(E_{P}/E_{Q})} - \\hat{\\gamma} = \\frac{1}{3} \\ln\\left(\\frac{4455}{728}\\right) - \\ln\\left(\\frac{12}{7}\\right) $$\n为了求出数值，我们计算各项：\n$$ \\widehat{\\ln(E_{P}/E_{Q})} = \\frac{1}{3} \\ln\\left(\\frac{4455}{728}\\right) \\approx \\frac{1}{3} \\ln(6.119505...) \\approx \\frac{1.811481...}{3} \\approx 0.6038270 $$\n$$ \\hat{\\gamma} = \\ln\\left(\\frac{12}{7}\\right) \\approx \\ln(1.714285...) \\approx 0.5389965 $$\n将这些值相减得到：\n$$ \\hat{\\tau} \\approx 0.6038270 - 0.5389965 = 0.0648305 $$\n将结果四舍五入到四位有效数字，得到 $0.06483$。",
            "answer": "$$\\boxed{0.06483}$$"
        },
        {
            "introduction": "在掌握了顺式和反式效应的基本剖析方法之后，本练习将引导您进入一个更复杂的统计视角，即考虑实验重复之间的变异。通过分解表达差异的总方差，您可以探索顺式和反式演化之间的相互作用，例如识别补偿性演化模式，即一个领域的演化变化掩盖了另一个领域的变化 。这项练习将磨练您的计算技能，并让您更深入地洞察不同调控演化模式之间的动态关系。",
            "id": "2696994",
            "problem": "您将获得一个关于两个已分化谱系及其第一代杂交体中基因表达的概念模型。任务是设计一个程序，为每个测试用例计算观察到的表达差异的一种原则性分解，将其分解为可归因于cis-调控差异、trans-调控差异及其协方差的组分，该过程仅使用调控遗传学的基本定义和实验设计逻辑。\n\n基本原理：\n- 在分子生物学的中心法则中，转录输出由局部脱氧核糖核酸序列特征（cis-调控元件）和可扩散的细胞因子（trans-作用调节因子）之间的相互作用所决定。对于一个目标基因，假设在给定的基因型-因子背景下，其表达水平可以乘法性地分解为一个cis-贡献和一个trans-贡献。也就是说，在谱系$1$的亲本中，表达量是谱系$1$所携带的等位基因特有的cis-项与谱系$1$的细胞环境特有的trans-项的乘积。谱系$2$的情况与此类似。\n- 在谱系$1$和$2$之间的第一代杂交体中，两个等位基因都经历相同的trans-环境，但保留了它们谱系特性的cis-调控序列。\n- 通过取自然对数，可以将贡献的乘法模型线性化，把乘性效应转换为加性效应，这简化了对比分析和方差分解。\n\n需从第一性原理实现的定义：\n- 令$P1_i$和$P2_i$分别表示来自谱系$1$亲本和谱系$2$亲本的表达量的第$i$次重复测量值。\n- 令$A1_i$和$A2_i$分别表示第一代杂交体中源自谱系$1$和谱系$2$的等位基因的等位基因特异性表达的第$i$次重复测量值。所有使用的对数均为自然对数。\n- 对于每次重复$i$，在对数尺度上定义三个可加的量，这些量必须能根据上述实验设计和基本原理推导出来：\n  - 亲本间的总对数差异$d_i$。\n  - 一个对数量，它利用杂交体中两个等位基因共享相同trans-环境这一事实来分离出cis-调控差异$c_i$。\n  - 一个对数量，它利用trans-作用是全局性的以及总差异由cis-和trans-共同引起这一事实来分离出trans-调控差异$t_i$。\n- 在所有重复中，使用分母为（n-1）的标准定义计算无偏样本方差和协方差，其中$n$是重复次数：\n  - $d_i$的样本方差为$\\mathrm{Var}(d)$，$c_i$的样本方差为$\\mathrm{Var}(c)$，$t_i$的样本方差为$\\mathrm{Var}(t)$，样本协方差为$\\mathrm{Cov}(c,t)$。\n- 使用随机变量和的方差代数，将$\\mathrm{Var}(d)$表示为$\\mathrm{Var}(c)$、$\\mathrm{Var}(t)$和$\\mathrm{Cov}(c,t)$的函数，然后计算以下分数（以小数值而非百分比表示）：\n  - $f_{\\mathrm{cis}} = \\mathrm{Var}(c) / \\mathrm{Var}(d)$\n  - $f_{\\mathrm{trans}} = \\mathrm{Var}(t) / \\mathrm{Var}(d)$\n  - $f_{\\mathrm{cov}} = 2\\,\\mathrm{Cov}(c,t) / \\mathrm{Var}(d)$\n当$\\mathrm{Var}(d) > 0$时，这三个分数的和应为$1$（允许舍入误差）。\n\n对于每个测试用例，您的程序必须：\n- 使用自然对数和上述实验设计逻辑，计算每次重复的量$d_i$、$c_i$、$t_i$。\n- 计算样本均值$\\overline{c}$和$\\overline{t}$、无偏样本协方差$\\mathrm{Cov}(c,t)$以及上文定义的分数$f_{\\mathrm{cis}}$、$f_{\\mathrm{trans}}$、$f_{\\mathrm{cov}}$。\n- 将所有返回的浮点数四舍五入到六位小数。\n\n角度单位不适用。不需要物理单位。\n\n测试套件：\n每个测试用例由四个等长的正数列表定义，代表$P1_i$、$P2_i$、$A1_i$、$A2_i$在重复$i = 1,\\dots,n$中的值。全部计算过程使用自然对数。\n\n- 测试用例1（具有中度差异的一般情况）：\n  - $P1 = [182.211, 181.2375, 173.115]$\n  - $P2 = [100, 90, 105]$\n  - $A1 = [179.018, 181.359, 169.415]$\n  - $A2 = [120, 110, 130]$\n\n- 测试用例2（边界情况，基本上为纯trans-调控差异，杂交体中无等位基因特异性差异）：\n  - $P1 = [150, 160, 99]$\n  - $P2 = [100, 80, 90]$\n  - $A1 = [120, 100, 105]$\n  - $A2 = [120, 100, 105]$\n\n- 测试用例3（边界情况，基本上为纯cis-调控差异，亲本差异等于杂交体中的等位基因特异性差异）：\n  - $P1 = [117, 165, 130]$\n  - $P2 = [90, 110, 100]$\n  - $A1 = [130, 180, 195]$\n  - $A2 = [100, 120, 150]$\n\n- 测试用例4（具有负协方差和近似恒定总差异的补偿性cis和trans效应）：\n  - $P1 = [149.182, 164.100, 134.264]$\n  - $P2 = [100, 110, 90]$\n  - $A1 = [255.0966, 146.600, 214.333]$\n  - $A2 = [140, 120, 130]$\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含一个长度为$4$的列表，每个元素按顺序对应一个测试用例。\n- 每个元素必须是一个包含六个浮点数的列表，四舍五入到六位小数，顺序如下：$[\\,\\overline{c},\\,\\overline{t},\\,f_{\\mathrm{cis}},\\,f_{\\mathrm{trans}},\\,f_{\\mathrm{cov}},\\,\\mathrm{Cov}(c,t)\\,]$。\n- 全部输出必须打印为单行，表示为一个使用方括号的类Python嵌套列表，例如：$\"[[x_{11},x_{12},\\dots,x_{16}],[x_{21},\\dots,x_{26}],\\dots]\"$，不得包含额外文本。",
            "solution": "该问题要求将两个谱系间的基因表达差异分解为可归因于cis-和trans-调控演化的组分。所提供的概念模型是演化基因组学中的一个标准框架，它假定基因表达是cis-作用元件和trans-作用因子的乘法函数。该问题具有科学依据且数学上是适定的。我们将首先对模型进行形式化，然后从第一性原理推导所需数量。\n\n该模型假设对于一个给定的基因，其表达水平$E$是cis-调控贡献$C$和trans-调控贡献$T$的乘积。\n$$E = C \\cdot T$$\n通过取自然对数，这种乘法关系被线性化，从而将模型转化为加法模型。\n$$\\ln(E) = \\ln(C) + \\ln(T)$$\n这种加法形式更适合进行分析和方差分解。我们用小写字母表示经过对数转换的量，例如，$c = \\ln(C)$。\n\n对于每次重复$i$，我们获得了四个来源的表达数据：谱系$1$的親本($P1_i$)、谱系$2$的親本($P2_i$)、F1杂交体中来自谱系$1$的等位基因($A1_i$)，以及F1杂交体中来自谱系$2$的等位基因($A2_i$)。我们可以将这些实验测量值映射到对数加法模型上。令$c_1$和$c_2$分别为来自谱系$1$和谱系$2$的等位基因的cis-调控效应。令$t_1$和$t_2$分别为亲本谱系$1$和$2$的trans-调控环境，令$h$为F1杂交体中的共同trans-调控环境。对于给定的重复$i$，我们可以写出：\n$$ \\ln(P1_i) = c_{1,i} + t_{1,i} $$\n$$ \\ln(P2_i) = c_{2,i} + t_{2,i} $$\n$$ \\ln(A1_i) = c_{1,i} + h_i $$\n$$ \\ln(A2_i) = c_{2,i} + h_i $$\n下标$i$表示每次重复测量都有其自身对这些潜在效应的实现，这考虑了生物学和技术上的变异性。\n\n问题要求为每次重复$i$计算三个量：总差异$d_i$、cis-调控差异$c_i$和trans-调控差异$t_i$。\n\n$1$. 亲本间的总对数差异$d_i$定义为其对数表达水平的差值。\n$$ d_i = \\ln(P1_i) - \\ln(P2_i) = (c_{1,i} - c_{2,i}) + (t_{1,i} - t_{2,i}) $$\n这个量代表了两个谱系间累积的总差异，包括cis-和trans-效应。\n\n$2$. 通过比较在同一杂交体trans-环境($h_i$)中两个不同等位基因（$A1_i$和$A2_i$）的表达，可以分离出cis-调控差异$c_i$。任何差异都必然源于cis-调控序列。\n$$ c_i = \\ln(A1_i) - \\ln(A2_i) = (c_{1,i} + h_i) - (c_{2,i} + h_i) = c_{1,i} - c_{2,i} $$\n该表达式正确地分离出了两个等位基因的cis-调控效应之间的差异。\n\n$3$. trans-调控差异$t_i$是总差异中不能被cis-效应解释的部分。鉴于对数转换模型的加性性质，其中$d_i$是总cis-和trans-差异之和，我们有$d_i = c_i + t_i$。因此，我们可以通过减法求得$t_i$：\n$$ t_i = d_i - c_i = (\\ln(P1_i) - \\ln(P2_i)) - (\\ln(A1_i) - \\ln(A2_i)) $$\n代入模型组分可以证实，此式分离出了trans-环境中的差异。\n$$ t_i = \\left( (c_{1,i} - c_{2,i}) + (t_{1,i} - t_{2,i}) \\right) - (c_{1,i} - c_{2,i}) = t_{1,i} - t_{2,i} $$\n\n计算出每次重复的向量$\\{c_i\\}$和$\\{t_i\\}$（$i=1, \\dots, n$）后，我们进行统计分析。我们计算样本均值$\\overline{c}$和$\\overline{t}$，并使用分母$(n-1)$计算无偏樣本方差和协方差：\n$$ \\overline{c} = \\frac{1}{n} \\sum_{i=1}^{n} c_i \\quad\\quad \\overline{t} = \\frac{1}{n} \\sum_{i=1}^{n} t_i $$\n$$ \\mathrm{Var}(c) = \\frac{1}{n-1} \\sum_{i=1}^{n} (c_i - \\overline{c})^2 $$\n$$ \\mathrm{Var}(t) = \\frac{1}{n-1} \\sum_{i=1}^{n} (t_i - \\overline{t})^2 $$\n$$ \\mathrm{Cov}(c,t) = \\frac{1}{n-1} \\sum_{i=1}^{n} (c_i - \\overline{c})(t_i - \\overline{t}) $$\n总差异的方差$\\mathrm{Var}(d)$也是必需的。由于$d_i = c_i + t_i$，根据方差的性质，我们有：\n$$ \\mathrm{Var}(d) = \\mathrm{Var}(c+t) = \\mathrm{Var}(c) + \\mathrm{Var}(t) + 2\\mathrm{Cov}(c,t) $$\n最后一步是将该总方差分解为来自cis-差异、trans-差异及其协方差的分数贡献。这些分数定义为：\n$$ f_{\\mathrm{cis}} = \\frac{\\mathrm{Var}(c)}{\\mathrm{Var}(d)} $$\n$$ f_{\\mathrm{trans}} = \\frac{\\mathrm{Var}(t)}{\\mathrm{Var}(d)} $$\n$$ f_{\\mathrm{cov}} = \\frac{2\\mathrm{Cov}(c,t)}{\\mathrm{Var}(d)} $$\n根据定义，这些分数的和必须为$1$。该算法将为提供的每个测试用例计算这些量。实现将使用`numpy`进行对数、差值、均值、方差和协方差的向量化计算，确保遵循指定的统计定义（例如，使用$1$的自由度增量以获得无偏样本估计）。所有最终的浮点数结果将按要求四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the decomposition of gene expression divergence into cis, trans,\n    and covariance components for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (\n            [182.211, 181.2375, 173.115], # P1\n            [100, 90, 105], # P2\n            [179.018, 181.359, 169.415], # A1\n            [120, 110, 130], # A2\n        ),\n        (\n            [150, 160, 99], # P1\n            [100, 80, 90], # P2\n            [120, 100, 105], # A1\n            [120, 100, 105], # A2\n        ),\n        (\n            [117, 165, 130], # P1\n            [90, 110, 100], # P2\n            [130, 180, 195], # A1\n            [100, 120, 150], # A2\n        ),\n        (\n            [149.182, 164.100, 134.264], # P1\n            [100, 110, 90], # P2\n            [255.0966, 146.600, 214.333], # A1\n            [140, 120, 130], # A2\n        ),\n    ]\n\n    all_results = []\n    for P1, P2, A1, A2 in test_cases:\n        # Convert lists to numpy arrays for vectorized operations.\n        P1_arr = np.array(P1, dtype=np.float64)\n        P2_arr = np.array(P2, dtype=np.float64)\n        A1_arr = np.array(A1, dtype=np.float64)\n        A2_arr = np.array(A2, dtype=np.float64)\n\n        # Take natural logarithms.\n        log_P1 = np.log(P1_arr)\n        log_P2 = np.log(P2_arr)\n        log_A1 = np.log(A1_arr)\n        log_A2 = np.log(A2_arr)\n\n        # Compute replicate-wise quantities d, c, and t.\n        # d: total log-divergence between parents.\n        # c: cis-regulatory log-divergence from allele-specific expression in hybrid.\n        # t: trans-regulatory log-divergence derived from the additive model.\n        d = log_P1 - log_P2\n        c = log_A1 - log_A2\n        t = d - c\n\n        # Compute sample means.\n        mean_c = np.mean(c)\n        mean_t = np.mean(t)\n        \n        # Compute unbiased sample variances (ddof=1 for n-1 denominator).\n        # Check for case with n=1, where variance is not defined.\n        n = len(P1)\n        if n < 2:\n            # According to problem constraints (n=3), this block is not reached.\n            # Define behavior for this edge case if necessary.\n            # Here we can set variances to 0, which would lead to NaN for fractions.\n            var_d = 0.0\n            var_c = 0.0\n            var_t = 0.0\n            cov_ct = 0.0\n        else:\n            var_d = np.var(d, ddof=1)\n            var_c = np.var(c, ddof=1)\n            var_t = np.var(t, ddof=1)\n            # Compute unbiased sample covariance matrix.\n            cov_matrix = np.cov(c, t, ddof=1)\n            cov_ct = cov_matrix[0, 1]\n\n        # Calculate fractional contributions to variance.\n        # Handle division by zero if Var(d) is zero.\n        if var_d == 0.0:\n            # If total divergence is constant, fractions are not well-defined.\n            # This indicates either no variation or perfect compensation.\n            # Depending on context, interpretation varies. In this problem,\n            # test cases are designed to have Var(d) > 0.\n            f_cis, f_trans, f_cov = np.nan, np.nan, np.nan\n        else:\n            f_cis = var_c / var_d\n            f_trans = var_t / var_d\n            f_cov = 2 * cov_ct / var_d\n\n        # Assemble the list of results for the current test case.\n        result = [mean_c, mean_t, f_cis, f_trans, f_cov, cov_ct]\n        \n        # Round all values to six decimal places.\n        rounded_result = [round(x, 6) for x in result]\n        all_results.append(rounded_result)\n\n    # Final print statement in the exact required format.\n    # The str() representation of a list includes spaces after commas.\n    # The requirement seems to want no spaces, so we remove them.\n    # Example: \"[[v1,v2],[v3,v4]]\"\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了调控效应的测量和统计表征之后，我们现在转向塑造这些效应的演化驱动力。本练习要求您从第一性原理出发，建立一个理论模型，将作用于基因表达的稳定性选择（stabilizing selection）与补偿多效性反式效应的顺式调控元件的演化联系起来 。通过推导调控系统的最优状态，您将能更深刻地理解适应性景观（fitness landscapes）和遗传约束是如何支配基因调控的演化轨迹的。",
            "id": "2697006",
            "problem": "考虑一个二倍体基因，其信使核糖核酸 (mRNA) 表达量与其谱系特异性最适值之间的偏差，是由一个顺式作用组分和一个反式作用组分加性决定的。设表达量与最适值的偏差表示为 $E - E^{*}$，其中 $E^{*}$ 是维持生存能力的最适表达水平。在每个谱系 $i \\in \\{1,2\\}$ 中，设反式作用背景使表达量偏移 $t_{i}$（由于其对许多其他基因的影响所施加的限制，该值对于该谱系是一个常数），并设目标基因处的可演化顺式作用修饰为 $c_{i}$。假设适应度具有以下广泛使用的结构：\n- 围绕最适值的表达量受到稳定选择的作用，该选择呈高斯分布，曲率为 $S>0$，因此适应度中与表达相关的组分是 $\\exp\\!\\big(-\\tfrac{S}{2}(E-E^{*})^{2}\\big)$。\n- 顺式调控变化会产生多效性代价，该代价与其大小的平方成正比，系数为 $\\alpha>0$，贡献一个乘法因子 $\\exp\\!\\big(-\\tfrac{\\alpha}{2}c_{i}^{2}\\big)$。\n- 反式调控背景会产生多效性代价，该代价与其大小的平方成正比，系数为 $\\gamma>0$，贡献一个乘法因子 $\\exp\\!\\big(-\\tfrac{\\gamma}{2}t_{i}^{2}\\big)$；然而，在谱系 $i$ 中，$t_{i}$ 受到对其他基因的选择作用的外部限制（即，在谱系 $i$ 内优化 $c_{i}$ 时，将 $t_{i}$ 视为常数）。\n\n在每个谱系 $i$ 内，表达偏差为 $E-E^{*}=c_{i}+t_{i}$，且目标基因及多效性代价的总适应度是上述三个因子的乘积。\n\n现在考虑两个谱系之间进行杂交，形成子一代（F1）杂种。在 F1 中，假设：\n- 反式作用环境是共显性的和加性的，产生的杂种反式效应为 $(t_{1}+t_{2})/2$。\n- 每个等位基因保留其自身的顺式调控序列，且等位基因对总表达量的贡献在剂量上相等，因此顺式作用对杂种总表达量的贡献是平均值 $(c_{1}+c_{2})/2$。\n\n假设在每个亲本谱系 $i$ 中，顺式修饰因子 $c_{i}$ 已经演化以在给定 $t_{i}$ 的情况下最大化总适应度，请推导出 F1 杂种平均表达量与最适值的偏差 $(E_{\\mathrm{F1}}-E^{*})$ 的一个闭式表达式，该表达式仅包含 $S$、$\\alpha$、$t_{1}$ 和 $t_{2}$。请以无单位的单个简化解析表达式的形式给出你的最终答案。",
            "solution": "所给的问题陈述科学严谨、定义明确且内部逻辑一致。它描述了演化遗传学中一个关于基因表达上选择力平衡的标准理论模型。下面我们进行形式化求解。\n\n对于谱系 $i \\in \\{1, 2\\}$ 中的一个二倍体个体，其总适应度 $W_i$ 是三个组分的乘积：对表达水平的稳定选择、顺式调控的多效性代价以及反式调控背景的多效性代价。其表达式为：\n$$\nW_i(c_i) = \\exp\\left(-\\frac{S}{2}(E-E^{*})^{2}\\right) \\exp\\left(-\\frac{\\alpha}{2}c_{i}^{2}\\right) \\exp\\left(-\\frac{\\gamma}{2}t_{i}^{2}\\right)\n$$\n其中 $c_i$ 是顺式作用修饰，$t_i$ 是反式作用背景效应。与最适表达的偏差由加性模型 $E-E^{*} = c_i + t_i$ 给出。将此代入适应度函数，得到：\n$$\nW_i(c_i) = \\exp\\left(-\\frac{S}{2}(c_i + t_i)^{2} - \\frac{\\alpha}{2}c_{i}^{2} - \\frac{\\gamma}{2}t_{i}^{2}\\right)\n$$\n为了找到使适应度最大化的 $c_i$ 值，我们可以等价地最大化对数适应度 $w_i(c_i) = \\ln(W_i(c_i))$，因为对数函数是严格单调的。\n$$\nw_i(c_i) = -\\frac{S}{2}(c_i + t_i)^{2} - \\frac{\\alpha}{2}c_{i}^{2} - \\frac{\\gamma}{2}t_{i}^{2}\n$$\n问题陈述指出，$c_i$ 的演化是为了在给定常数 $t_i$ 的情况下最大化适应度。因此，我们通过对 $w_i(c_i)$ 关于 $c_i$ 求导并令其为零来找到最大值。包含 $\\gamma$ 的项相对于 $c_i$ 是一个常数，因此不影响优化过程。\n$$\n\\frac{d w_i}{d c_i} = \\frac{d}{d c_i} \\left( -\\frac{S}{2}(c_i + t_i)^{2} - \\frac{\\alpha}{2}c_{i}^{2} \\right) = -S(c_i + t_i) - \\alpha c_i\n$$\n令导数为零，定义了最优的顺式作用修饰，我们将其记为 $c_i^*$：\n$$\n-S(c_i^* + t_i) - \\alpha c_i^* = 0\n$$\n$$\n-S t_i = S c_i^* + \\alpha c_i^*\n$$\n$$\n-S t_i = (S + \\alpha) c_i^*\n$$\n解出 $c_i^*$ 得：\n$$\nc_i^* = -\\frac{S}{S + \\alpha} t_i\n$$\n这是一个最大值，因为在给定条件 $S > 0$ 和 $\\alpha > 0$ 下，其二阶导数 $\\frac{d^2 w_i}{d c_i^2} = -S - \\alpha$ 严格为负。这个最优顺式效应的表达式适用于两个亲本谱系，$i=1$ 和 $i=2$。因此，我们有：\n$$\nc_1^* = -\\frac{S}{S + \\alpha} t_1 \\quad \\text{和} \\quad c_2^* = -\\frac{S}{S + \\alpha} t_2\n$$\n接下来，我们考虑子一代 (F1) 杂种。问题指明，反式作用环境是加性的，产生的杂种反式效应为 $t_{\\mathrm{F1}} = \\frac{t_1 + t_2}{2}$。类似地，顺式作用对总表达量的贡献是亲本等位基因的平均值，$c_{\\mathrm{F1}} = \\frac{c_1 + c_2}{2}$。F1 杂种中与最适值的总表达偏差是这些效应的总和：\n$$\nE_{\\mathrm{F1}}-E^{*} = c_{\\mathrm{F1}} + t_{\\mathrm{F1}} = \\frac{c_1 + c_2}{2} + \\frac{t_1 + t_2}{2}\n$$\n我们必须使用最优值 $c_1^*$ 和 $c_2^*$ 作为亲本的顺式效应，因为问题假设亲本谱系已经演化至各自的适应度最大值。代入 $c_1^*$ 和 $c_2^*$ 的表达式：\n$$\nE_{\\mathrm{F1}}-E^{*} = \\frac{1}{2}\\left(-\\frac{S}{S + \\alpha} t_1 - \\frac{S}{S + \\alpha} t_2\\right) + \\frac{t_1 + t_2}{2}\n$$\n我们可以提取公因式：\n$$\nE_{\\mathrm{F1}}-E^{*} = -\\frac{S}{2(S + \\alpha)}(t_1 + t_2) + \\frac{1}{2}(t_1 + t_2)\n$$\n$$\nE_{\\mathrm{F1}}-E^{*} = \\left(1 - \\frac{S}{S + \\alpha}\\right)\\left(\\frac{t_1 + t_2}{2}\\right)\n$$\n简化第一个括号中的表达式：\n$$\n1 - \\frac{S}{S + \\alpha} = \\frac{S + \\alpha}{S + \\alpha} - \\frac{S}{S + \\alpha} = \\frac{S + \\alpha - S}{S + \\alpha} = \\frac{\\alpha}{S + \\alpha}\n$$\n将这个简化后的项代回 F1 表达偏差的方程中，得到最终结果：\n$$\nE_{\\mathrm{F1}}-E^{*} = \\left(\\frac{\\alpha}{S + \\alpha}\\right)\\left(\\frac{t_1 + t_2}{2}\\right) = \\frac{\\alpha(t_1 + t_2)}{2(S + \\alpha)}\n$$\n该表达式仅由所要求的参数 $S$、$\\alpha$、$t_1$ 和 $t_2$ 表示。",
            "answer": "$$\n\\boxed{\\frac{\\alpha(t_1 + t_2)}{2(S + \\alpha)}}\n$$"
        }
    ]
}