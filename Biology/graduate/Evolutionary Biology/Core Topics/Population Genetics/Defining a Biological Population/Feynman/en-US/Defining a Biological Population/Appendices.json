{
    "hands_on_practices": [
        {
            "introduction": "Quantifying the genetic differentiation among groups is a cornerstone of population genetics. This exercise asks you to derive the celebrated equilibrium expression for Wright's fixation index, $F_{ST}$, from first principles under the ideal island model of migration . By working through the balance between gene flow, which homogenizes populations, and genetic drift, which causes them to diverge, you will gain a deep, mechanistic understanding of what this crucial statistic represents.",
            "id": "2700067",
            "problem": "A metapopulation consists of $n = 20$ demes connected by symmetric island-model migration. Each deme is diploid, follows ideal Wright–Fisher reproduction with non-overlapping generations, and has constant census size $N = 100$. Assume that the effective population size equals the census size, so $N_{e} = N$. In each generation, a fraction $m = 0.01$ of the gene copies in each deme are replaced by migrants drawn from the metapopulation-wide migrant pool. Consider a neutral biallelic locus with allele frequency $p_{i}$ in deme $i$ and metapopulation mean $\\bar{p}$, under the assumptions that selection and mutation are negligible on the timescale of migration and drift.\n\nStarting from the definition of the fixation index ($F$-statistics; $F_{ST}$) as the standardized among-deme variance in allele frequency,\n$$\nF_{ST} \\equiv \\frac{\\operatorname{Var}(p_{i})}{\\bar{p}\\left(1-\\bar{p}\\right)},\n$$\nand using only the basic Wright–Fisher sampling variance for drift and the linear mixing of allele frequencies under migration, derive the island-model equilibrium expression for $F_{ST}$ in the many-deme, weak-migration limit. Then evaluate the expected $F_{ST}$ for the given parameters.\n\nRound your final numeric answer to four significant figures and report it as a pure number without units.",
            "solution": "The problem requires the derivation of the equilibrium fixation index, $F_{ST}$, under the island model of migration and its subsequent calculation for a specific set of parameters. The derivation will be built from first principles, namely the effects of genetic drift and migration on allele frequencies.\n\nLet $p_{i,t}$ be the frequency of an allele at a neutral biallelic locus in deme $i$ at generation $t$. There are $n$ such demes, each of diploid size $N$. The effective population size is $N_e = N$. The mean allele frequency across the metapopulation is $\\bar{p} = \\frac{1}{n} \\sum_{i=1}^{n} p_{i,t}$. The problem specifies a \"many-deme limit\" ($n \\to \\infty$), which implies that the metapopulation mean allele frequency $\\bar{p}$ can be treated as a constant parameter, as random fluctuations in any single deme have a negligible effect on the global average.\n\nThe change in allele frequency from generation $t$ to $t+1$ occurs in two steps: migration followed by genetic drift.\n\n1.  **Migration**: In each generation, a fraction $m$ of the gene copies in a deme are replaced by migrants from the metapopulation-wide migrant pool. The allele frequency in this pool is $\\bar{p}$. The allele frequency in deme $i$ after migration, denoted $p'_{i,t}$, is a weighted average of the frequency before migration, $p_{i,t}$, and the frequency of the migrant pool, $\\bar{p}$:\n    $$p'_{i,t} = (1-m)p_{i,t} + m\\bar{p}$$\n\n2.  **Genetic Drift**: The next generation is formed by sampling $2N$ gene copies from the post-migration gene pool of the deme. This is a binomial sampling process (Wright-Fisher model). The expected allele frequency in generation $t+1$ is $E[p_{i,t+1}|p'_{i,t}] = p'_{i,t}$, and the variance due to sampling is $\\operatorname{Var}(p_{i,t+1}|p'_{i,t}) = \\frac{p'_{i,t}(1-p'_{i,t})}{2N}$.\n\nOur goal is to find the equilibrium variance of allele frequencies among demes, $V_{eq} = \\operatorname{Var}(p_i)$. Let $V_t = \\operatorname{Var}(p_{i,t}) = E[(p_{i,t} - \\bar{p})^2]$, where the expectation is taken over all demes. We derive a recurrence relation for $V_t$.\n\nThe variance in the next generation is $V_{t+1} = E[(p_{i,t+1} - \\bar{p})^2]$. We use the law of total expectation, conditioning on the post-migration frequency $p'_{i,t}$:\n$$V_{t+1} = E_{i} \\left[ E \\left[ (p_{i,t+1} - \\bar{p})^2 | p'_{i,t} \\right] \\right]$$\nThe inner expectation is over the random drift process. We expand the squared term:\n$$E \\left[ (p_{i,t+1} - \\bar{p})^2 | p'_{i,t} \\right] = E \\left[ ((p_{i,t+1} - p'_{i,t}) + (p'_{i,t} - \\bar{p}))^2 | p'_{i,t} \\right]$$\n$$= E[(p_{i,t+1} - p'_{i,t})^2 | p'_{i,t}] + (p'_{i,t} - \\bar{p})^2 + 2(p'_{i,t} - \\bar{p})E[p_{i,t+1} - p'_{i,t} | p'_{i,t}]$$\nThe first term is the variance from drift: $\\operatorname{Var}(p_{i,t+1}|p'_{i,t}) = \\frac{p'_{i,t}(1-p'_{i,t})}{2N}$. The cross-term is zero because $E[p_{i,t+1}|p'_{i,t}] = p'_{i,t}$. Thus:\n$$E \\left[ (p_{i,t+1} - \\bar{p})^2 | p'_{i,t} \\right] = \\frac{p'_{i,t}(1-p'_{i,t})}{2N} + (p'_{i,t} - \\bar{p})^2$$\nNow, we take the outer expectation over the distribution of allele frequencies among demes:\n$$V_{t+1} = E_{i} \\left[ \\frac{p'_{i,t}(1-p'_{i,t})}{2N} \\right] + E_{i} \\left[ (p'_{i,t} - \\bar{p})^2 \\right]$$\nThe second term is the variance of the post-migration frequencies, $\\operatorname{Var}(p'_{i,t})$. From the migration equation, $\\operatorname{Var}(p'_{i,t}) = \\operatorname{Var}((1-m)p_{i,t} + m\\bar{p})$. Since $\\bar{p}$ and $m$ are constants, this is $(1-m)^2 \\operatorname{Var}(p_{i,t}) = (1-m)^2 V_t$.\n\nFor the first term, we need $E[p'_{i,t}(1-p'_{i,t})]$. We know that for any random variable $X$, $E[X(1-X)] = E[X] - E[X^2]$.\n$E[p'_{i,t}] = E[(1-m)p_{i,t} + m\\bar{p}] = (1-m)E[p_{i,t}] + m\\bar{p} = (1-m)\\bar{p} + m\\bar{p} = \\bar{p}$.\n$E[(p'_{i,t})^2] = \\operatorname{Var}(p'_{i,t}) + (E[p'_{i,t}])^2 = (1-m)^2 V_t + \\bar{p}^2$.\nTherefore, $E[p'_{i,t}(1-p'_{i,t})] = \\bar{p} - ((1-m)^2 V_t + \\bar{p}^2) = \\bar{p}(1-\\bar{p}) - (1-m)^2 V_t$.\nSubstituting these results back into the equation for $V_{t+1}$:\n$$V_{t+1} = \\frac{\\bar{p}(1-\\bar{p}) - (1-m)^2 V_t}{2N} + (1-m)^2 V_t$$\n$$V_{t+1} = \\frac{\\bar{p}(1-\\bar{p})}{2N} + V_t (1-m)^2 \\left(1 - \\frac{1}{2N}\\right)$$\nThis is the exact recurrence relation for the among-deme variance. At equilibrium, a balance is reached between migration, which reduces variance, and drift, which increases it. We set $V_{t+1} = V_t = V_{eq}$ and solve for $V_{eq}$:\n$$V_{eq} = \\frac{\\bar{p}(1-\\bar{p})}{2N} + V_{eq} (1-m)^2 \\left(1 - \\frac{1}{2N}\\right)$$\n$$V_{eq} \\left[ 1 - (1-m)^2 \\left(1 - \\frac{1}{2N}\\right) \\right] = \\frac{\\bar{p}(1-\\bar{p})}{2N}$$\nThe problem asks for the solution in the \"weak-migration limit\". This implies that the migration rate $m$ is small ($m \\ll 1$), and generally that the deme size $N$ is large ($1/N \\ll 1$). We can thus approximate the term in the brackets. First, $(1-m)^2 \\approx 1-2m$.\n$$1 - (1-m)^2 \\left(1 - \\frac{1}{2N}\\right) \\approx 1 - (1-2m)\\left(1 - \\frac{1}{2N}\\right)$$\n$$= 1 - \\left(1 - \\frac{1}{2N} - 2m + \\frac{m}{N}\\right) = 2m + \\frac{1}{2N} - \\frac{m}{N}$$\nAs both $m$ and $1/N$ are small, the product term $m/N$ is of a smaller order and can be neglected. The expression simplifies to $2m + \\frac{1}{2N}$.\nSubstituting this back into the equilibrium equation:\n$$V_{eq} \\left( 2m + \\frac{1}{2N} \\right) \\approx \\frac{\\bar{p}(1-\\bar{p})}{2N}$$\n$$V_{eq} \\left( \\frac{4Nm + 1}{2N} \\right) \\approx \\frac{\\bar{p}(1-\\bar{p})}{2N}$$\nSolving for $V_{eq}$:\n$$V_{eq} \\approx \\frac{\\bar{p}(1-\\bar{p})}{4Nm + 1}$$\nThe fixation index $F_{ST}$ is defined as the standardized variance:\n$$F_{ST} = \\frac{\\operatorname{Var}(p_i)}{\\bar{p}(1-\\bar{p})} = \\frac{V_{eq}}{\\bar{p}(1-\\bar{p})}$$\nSubstituting our derived expression for $V_{eq}$:\n$$F_{ST} \\approx \\frac{1}{4Nm + 1}$$\nThis is the classic equilibrium expression for $F_{ST}$ under the infinite island model with weak migration and drift. The number of demes $n$ does not appear in this formula because the model assumes $n$ is large enough that the migrant pool is effectively infinite and its allele frequency is constant. The provided value $n=20$ is thus irrelevant to the calculation under the specified \"many-deme limit\" assumption.\n\nNow, we evaluate this expression for the given parameters: $N = N_e = 100$ and $m = 0.01$.\n$$F_{ST} \\approx \\frac{1}{4 \\times 100 \\times 0.01 + 1} = \\frac{1}{4 + 1} = \\frac{1}{5} = 0.2$$\nThe problem requires the answer to be rounded to four significant figures.\n$$F_{ST} = 0.2000$$",
            "answer": "$$\\boxed{0.2000}$$"
        },
        {
            "introduction": "Theoretical metrics like $F_{ST}$ are powerful, but their true utility comes from applying them to interpret data patterns. This problem presents a realistic scenario where you must weigh evidence from within-population mating patterns (Hardy–Weinberg Equilibrium), the consequences of pooling distinct groups (the Wahlund effect), and the level of genetic differentiation ($F_{ST}$) . This exercise sharpens the critical reasoning skills needed to synthesize multiple lines of evidence into a nuanced and biologically sound conclusion about population boundaries.",
            "id": "2700030",
            "problem": "You sampled multilocus genotypes from two spatially separated aggregations of a marine invertebrate during a single breeding season. Within each aggregation, genotype frequencies at $L=20$ putatively neutral single-nucleotide polymorphisms (SNPs) do not deviate from Hardy–Weinberg equilibrium (HWE), after appropriate multiple-testing control. When the two aggregations are pooled, there is a statistically significant heterozygote deficit consistent with a Wahlund effect. A standard estimator of Wright’s fixation index yields $F_{ST}=0.03$ between the two aggregations. Assume loci are unlinked and selectively neutral, sampling is random within aggregations, and generation time is $1$ year.\n\nUsing first principles suitable to evolutionary biology, decide whether the two aggregations should be treated as separate populations for evolutionary inference at these loci. Your reasoning should start from: (i) the definition of a population as a group of potentially interbreeding individuals in which random mating applies at the spatiotemporal scale of interest; (ii) the conditions for Hardy–Weinberg equilibrium; (iii) the Wahlund effect as a consequence of mixing subgroups with different allele frequencies; and (iv) the interpretation of $F$-statistics as standardized variance in allele frequencies among subgroups. You may assume the classic island-model approximation linking $F_{ST}$ to gene flow is applicable for an order-of-magnitude interpretation.\n\nWhich option best states whether these two aggregations constitute separate populations and justifies the decision?\n\nA. They should be treated as separate operational populations for analyses that assume random mating, because the significant Wahlund effect when pooled shows that random mating does not occur across the combined set at the sampling scale, while within-aggregation HWE is consistent with random mating. However, $F_{ST}=0.03$ implies substantial gene flow, so they are connected demes within a larger metapopulation rather than evolutionarily independent units.\n\nB. They should be treated as a single panmictic population, because $F_{ST}=0.03$ is below the conventional $0.05$ threshold for “low differentiation,” and the Wahlund effect is likely a statistical artifact that can be ignored when sample sizes are large.\n\nC. They are distinct, effectively isolated populations (approaching species-level isolation), because any nonzero $F_{ST}$, even as small as $0.03$, demonstrates negligible gene flow and near-complete reproductive isolation.\n\nD. No inference about population status is possible from these genetic data; without explicit demographic measurements of dispersal and mating, neither HWE, the Wahlund effect, nor $F_{ST}$ can inform whether the aggregations are separate populations.",
            "solution": "The problem statement is first subjected to a rigorous validation to ensure its scientific and logical integrity.\n\n**Step 1: Extraction of Givens**\nThe following information is provided verbatim or by direct implication in the problem statement:\n- Two spatially separated aggregations of a marine invertebrate are sampled.\n- Sampling occurred during a single breeding season.\n- Data are multilocus genotypes from $L=20$ putatively neutral single-nucleotide polymorphisms (SNPs).\n- Within each aggregation, genotype frequencies do not deviate from Hardy–Weinberg equilibrium (HWE).\n- When the two aggregations are pooled, there is a statistically significant heterozygote deficit.\n- This deficit is consistent with a Wahlund effect.\n- The estimated Wright’s fixation index is $F_{ST}=0.03$ between the two aggregations.\n- Assumptions: loci are unlinked, loci are selectively neutral, sampling is random within aggregations, and generation time is $1$ year.\n- The task is to decide if the two aggregations should be treated as separate populations.\n- The reasoning must be based on: (i) the definition of a population, (ii) conditions for HWE, (iii) the Wahlund effect, and (iv) interpretation of $F$-statistics.\n- The classic island-model approximation for interpreting $F_{ST}$ is assumed to be applicable.\n\n**Step 2: Validation of Problem Statement**\nThe problem is scientifically grounded. The concepts of Hardy-Weinberg equilibrium, the Wahlund effect, and $F_{ST}$ are cornerstone principles of population genetics. The scenario described—HWE within subpopulations but a heterozygote deficit when pooled, coupled with a small but non-zero $F_{ST}$—is a classic textbook example of population structure. The data ($F_{ST}=0.03$, $L=20$ SNPs) are realistic. The problem is well-posed, providing sufficient information and clear assumptions (neutrality, unlinked loci, random sampling) to arrive at a logical conclusion. The language is objective and precise. The problem does not violate any criteria for validity; it is self-contained, consistent, and scientifically sound.\n\n**Step 3: Verdict**\nThe problem statement is valid. A formal solution will be derived.\n\n**Derivation**\n\nThe question requires a determination of whether two aggregations constitute separate populations, based on provided genetic data and fundamental principles.\n\n(i) The definition of a biological population is a group of individuals that are potentially interbreeding and where mating is random (panmixia) at the spatiotemporal scale under consideration. An ideal population is a panmictic unit.\n\n(ii) Hardy-Weinberg Equilibrium (HWE) describes a state where allele and genotype frequencies remain constant across generations in an infinitely large, randomly mating population free from mutation, migration, and selection. Observation of HWE within each aggregation, as stated in the problem, implies that the condition of random mating is met *within* each aggregation at the observed spatiotemporal scale.\n\n(iii) The Wahlund effect is the reduction in observed heterozygosity (and a corresponding excess of homozygotes) in a sample that is a mixture of two or more distinct subpopulations, compared to HWE expectations based on the pooled allele frequencies. The problem states that when the two aggregations are pooled, a \"statistically significant heterozygote deficit consistent with a Wahlund effect\" is observed. This is direct, powerful evidence that the two aggregations are *not* a single, randomly-mating unit. The existence of the Wahlund effect signifies a departure from panmixia across the combined group, meaning they fail to meet the definition of a single population. Therefore, for any analysis that assumes panmixia, they must be treated as separate operational units.\n\n(iv) The fixation index, $F_{ST}$, quantifies the genetic differentiation among subpopulations. It is defined as the standardized variance in allele frequencies among the subpopulations, or equivalently, as the correlation of uniting gametes relative to gametes drawn at random from the total population. A value of $F_{ST}=0$ implies no differentiation (panmixia), while $F_{ST}=1$ implies complete fixation of different alleles in different subpopulations. The given value is $F_{ST}=0.03$. This value, being greater than $0$, confirms the conclusion from the Wahlund effect: there is demonstrable genetic differentiation between the two aggregations.\n\nTo interpret the magnitude of $F_{ST}=0.03$, we use the provided island-model approximation. In a simple island model at equilibrium between drift and migration, $F_{ST}$ is related to the number of effective migrants per generation ($Nm$) by the formula:\n$$F_{ST} \\approx \\frac{1}{1 + 4Nm}$$\nwhere $N$ is the effective population size of a deme and $m$ is the migration rate. Solving for $Nm$:\n$$4Nm \\approx \\frac{1}{F_{ST}} - 1$$\nSubstituting the given value $F_{ST}=0.03$:\n$$4Nm \\approx \\frac{1}{0.03} - 1 = 33.33... - 1 = 32.33...$$\n$$Nm \\approx \\frac{32.33...}{4} \\approx 8.08$$\nAn estimated number of approximately $8$ effective migrants per generation is substantial. A common, though informal, guideline in conservation and evolutionary biology is that $Nm > 1$ is sufficient to prevent strong differentiation due to genetic drift. A value of $Nm \\approx 8$ indicates a significant level of gene flow connecting the two aggregations. This means that while they are not a single panmictic unit, they are also not evolutionarily independent. They are demographically connected components of a larger metapopulation.\n\n**Conclusion Synthesis**\nThe evidence points to a two-part conclusion:\n1.  The aggregations are distinct mating units, not a single panmictic population. This is proven by the significant Wahlund effect. Thus, for modeling purposes requiring an assumption of random mating, they must be treated as separate \"operational populations\".\n2.  The aggregations are not evolutionarily independent. The low but non-zero $F_{ST}$ value translates to substantial gene flow, indicating they are connected demes within a broader metapopulation structure.\n\n**Evaluation of Options**\n\nA. **They should be treated as separate operational populations for analyses that assume random mating, because the significant Wahlund effect when pooled shows that random mating does not occur across the combined set at the sampling scale, while within-aggregation HWE is consistent with random mating. However, $F_{ST}=0.03$ implies substantial gene flow, so they are connected demes within a larger metapopulation rather than evolutionarily independent units.**\nThis statement is perfectly aligned with the derivation. It correctly identifies that the Wahlund effect requires treating them as separate operational units for certain analyses. It also correctly interprets the $F_{ST}=0.03$ value as indicating substantial gene flow, leading to the accurate conclusion that they are connected demes, not independent units. This captures the necessary nuance of the situation.\n**Verdict: Correct**\n\nB. **They should be treated as a single panmictic population, because $F_{ST}=0.03$ is below the conventional $0.05$ threshold for “low differentiation,” and the Wahlund effect is likely a statistical artifact that can be ignored when sample sizes are large.**\nThis option is flawed. The problem explicitly states the Wahlund effect is \"statistically significant,\" contradicting the claim that it is an artifact to be ignored. The presence of a significant Wahlund effect is definitive proof against panmixia. Furthermore, while $F_{ST}=0.03$ may be qualitatively described as \"low,\" it is significantly different from zero, and its interpretation must be consistent with the other data. Relying on an arbitrary threshold like $0.05$ to declare panmixia is poor scientific reasoning.\n**Verdict: Incorrect**\n\nC. **They are distinct, effectively isolated populations (approaching species-level isolation), because any nonzero $F_{ST}$, even as small as $0.03$, demonstrates negligible gene flow and near-complete reproductive isolation.**\nThis is a severe misinterpretation of the data. As calculated, $F_{ST}=0.03$ corresponds to approximately $8$ effective migrants per generation. This is considered substantial gene flow, not \"negligible.\" It is entirely inconsistent with \"near-complete reproductive isolation.\" This option represents an extreme and incorrect conclusion.\n**Verdict: Incorrect**\n\nD. **No inference about population status is possible from these genetic data; without explicit demographic measurements of dispersal and mating, neither HWE, the Wahlund effect, nor $F_{ST}$ can inform whether the aggregations are separate populations.**\nThis statement is fundamentally incorrect. The entire field of population genetics is dedicated to making inferences about population structure, mating systems, and demographic history from genetic data. The combination of HWE tests, Wahlund effect analysis, and $F_{ST}$ estimation is a standard and powerful framework for precisely this purpose. To claim these data are uninformative is to reject foundational principles of the discipline.\n**Verdict: Incorrect**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "This hands-on coding exercise guides you through building a complete bioinformatics pipeline, from raw genotypes to a statistically tested conclusion about population structure, tackling practical challenges such as clonality . You will implement algorithms for distinguishing genetic individuals (genets) from their clonal copies (ramets) and then perform a permutation test to assess the significance of the observed $F_{ST}$. These methods are fundamental to modern molecular ecology and conservation genetics, providing a robust framework for analyzing real-world data.",
            "id": "2700015",
            "problem": "You are given multilocus genotype data from diploid seagrass ramets collected in a meadow that is partitioned into two spatial patches labeled \"A\" and \"B\". Some multilocus genotypes are repeated due to clonality. Your task is to design and implement an algorithm that (i) counts the number of distinct genets by clustering ramets that are indistinguishable up to a specified genotyping-error tolerance, and (ii) assesses whether the ramets belong to a single interbreeding population across the two patches by testing for genetic differentiation between patches after clone correction.\n\nBase your design only on the following fundamental definitions and well-tested facts from evolutionary genetics:\n- A genet is an asexual lineage represented by one or more ramets; under multilocus genotyping, a genet can be operationally defined as a cluster of ramets whose multilocus genotypes are identical within an allowed genotyping-error tolerance.\n- A multilocus genotype is a vector of unordered allele pairs, one unordered pair for each locus. For a diploid genotype at one locus, the alleles can be represented by an unordered multiset $\\{a,b\\}$ where $a$ and $b$ are integers denoting allele states.\n- A mismatch at one locus between two ramets occurs when the unordered allele pairs differ; the multilocus distance between two ramets is the count of loci with mismatches. Two ramets are considered the same genet if their multilocus distance is less than or equal to a specified tolerance $e_{\\max}$ measured in loci. To ensure transitivity under tolerance, define genets as connected components in an undirected graph where vertices are ramets and an edge is present when the distance is less than or equal to $e_{\\max}$.\n- To assess whether the meadow constitutes a single population across the two patches after clone correction, quantify differentiation between patches using gene diversity (expected heterozygosity). For one locus, if $p_i$ is the frequency of allele $i$, then the gene diversity is $H = 1 - \\sum_i p_i^2$. Let $H_T$ be the total gene diversity pooled across patches and $H_S$ be the sample-size-weighted average of within-patch gene diversities. For an informative locus with $H_T > 0$, define $F_{ST}^{(\\ell)} = (H_T - H_S)/H_T$. Average $F_{ST}^{(\\ell)}$ across loci with $H_T > 0$ to obtain the multilocus $F_{ST}$.\n- To test the null hypothesis that the two patches form a single population, perform a permutation test by randomly permuting patch labels across clone-corrected genets to generate a null distribution of multilocus $F_{ST}$. The empirical $p$-value is $(1 + \\#\\{\\text{permuted } F_{ST} \\ge F_{ST}^{\\text{obs}}\\})/(1 + R)$ where $R$ is the number of permutations.\n\nYour program must:\n- Represent each ramet's multilocus genotype as a list of unordered allele pairs. Each allele is an integer. The genotype distance between two ramets is the number of loci where the unordered allele pairs differ.\n- Cluster ramets into genets by building the graph defined above using the specified $e_{\\max}$ and counting its connected components. For clone correction in downstream analysis, represent each genet by a single arbitrarily chosen ramet from its component.\n- Compute multilocus $F_{ST}$ between patches on the clone-corrected set using the definition above, averaging across loci with $H_T > 0$.\n- Perform a permutation test with $R$ permutations to obtain an empirical $p$-value under the null hypothesis of a single population across patches. Use a fixed random seed so that results are reproducible.\n- Decide that the meadow constitutes a single population if the empirical $p$-value is greater than or equal to $\\alpha$.\n\nAngle units and physical units are not involved. All reported proportions must be decimals, not percentages. Report $F_{ST}$ rounded to $6$ decimal places and the $p$-value rounded to $4$ decimal places.\n\nTest suite. Your program must hard-code and analyze the following $4$ test cases. Each test case specifies the number of loci $L$, a list of ramets with their multilocus genotypes and patch labels, the tolerance $e_{\\max}$ in loci, the number of permutations $R$, the significance threshold $\\alpha$, and the required outputs.\n\n- Test case $1$ (repeated multilocus genotypes, low differentiation):\n  - $L = 4$.\n  - Ramets listed as $\\big($genotype, patch$\\big)$ in order:\n    1. $([(10,11),(20,20),(31,31),(40,41)], \\text{A})$\n    2. $([(10,11),(20,21),(31,31),(40,41)], \\text{A})$\n    3. $([(10,10),(20,21),(30,31),(40,40)], \\text{A})$\n    4. $([(11,11),(20,21),(31,32),(41,41)], \\text{B})$\n    5. $([(11,11),(20,21),(31,32),(41,41)], \\text{B})$\n    6. $([(10,11),(21,21),(30,30),(41,41)], \\text{B})$\n    7. $([(10,11),(20,21),(31,31),(40,41)], \\text{A})$\n    8. $([(10,11),(20,21),(30,32),(40,41)], \\text{B})$\n    9. $([(10,11),(20,21),(31,31),(40,41)], \\text{A})$\n    10. $([(10,10),(20,20),(31,32),(41,41)], \\text{B})$\n  - $e_{\\max} = 1$.\n  - $R = 499$, $\\alpha = 0.05$.\n  - Output: number of genets $G$, multilocus $F_{ST}$, $p$-value, and a boolean decision.\n\n- Test case $2$ (strong differentiation between patches, repeated genotypes):\n  - $L = 4$.\n  - Ramets:\n    1. $([(10,10),(20,20),(30,30),(40,40)], \\text{A})$\n    2. $([(10,11),(20,20),(30,30),(40,40)], \\text{A})$\n    3. $([(10,10),(20,20),(30,31),(40,40)], \\text{A})$\n    4. $([(10,10),(20,20),(30,30),(40,40)], \\text{A})$\n    5. $([(12,12),(22,22),(33,33),(43,43)], \\text{B})$\n    6. $([(12,12),(22,22),(33,33),(43,43)], \\text{B})$\n    7. $([(12,12),(22,22),(33,34),(43,43)], \\text{B})$\n    8. $([(12,12),(22,22),(33,33),(43,44)], \\text{B})$\n  - $e_{\\max} = 0$.\n  - $R = 499$, $\\alpha = 0.05$.\n  - Output: $G$, multilocus $F_{ST}$, $p$-value, boolean decision.\n\n- Test case $3$ (edge case: all ramets genetically identical across patches):\n  - $L = 4$.\n  - Ramets:\n    1. $([(5,5),(6,6),(7,7),(8,8)], \\text{A})$\n    2. $([(5,5),(6,6),(7,7),(8,8)], \\text{A})$\n    3. $([(5,5),(6,6),(7,7),(8,8)], \\text{B})$\n    4. $([(5,5),(6,6),(7,7),(8,8)], \\text{B})$\n  - $e_{\\max} = 0$.\n  - $R = 499$, $\\alpha = 0.05$.\n  - Note: For any locus with $H_T = 0$, exclude it from the multilocus average. If all loci have $H_T = 0$, define the multilocus $F_{ST}$ to be $0$ by convention, and report a $p$-value of $1$.\n  - Output: $G$, multilocus $F_{ST}$, $p$-value, boolean decision.\n\n- Test case $4$ (borderline, small sample size and slight divergence):\n  - $L = 4$.\n  - Ramets:\n    1. $([(100,101),(200,200),(300,301),(400,400)], \\text{A})$\n    2. $([(100,100),(200,201),(300,300),(400,401)], \\text{A})$\n    3. $([(100,101),(200,201),(300,301),(400,401)], \\text{B})$\n    4. $([(100,101),(200,200),(300,301),(400,401)], \\text{B})$\n  - $e_{\\max} = 0$.\n  - $R = 499$, $\\alpha = 0.05$.\n  - Output: $G$, multilocus $F_{ST}$, $p$-value, boolean decision.\n\nFinal output format. Your program should produce a single line of output containing the results for the four test cases as a comma-separated list enclosed in square brackets. Each test case's result must itself be a list of the form $[G, F_{ST}, p, \\text{decision}]$, where $G$ is an integer, $F_{ST}$ and $p$ are floating-point numbers rounded as specified, and $\\text{decision}$ is a boolean. For example: $[[2,0.012345,0.1234,True],[...],[...],[...]]$.",
            "solution": "The problem presented is a well-posed and scientifically grounded exercise in computational population genetics. It requires the implementation of a standard workflow for analyzing clonal populations: first, identifying unique genetic individuals (genets) from sampled tissues (ramets) in the presence of somatic mutations or genotyping errors; second, assessing population structure by quantifying genetic differentiation among pre-defined patches. The provided definitions and methodologies, including genet identification via graph clustering, the calculation of Wright's $F$-statistic ($F_{ST}$), and hypothesis testing using a permutation test, are all standard and correct within the field of evolutionary biology. The problem is valid, and a solution can be constructed through a systematic, principle-based algorithm.\n\nThe algorithmic design is partitioned into three main logical components, as dictated by the problem statement.\n\n**I. Genet Identification and Clone Correction**\n\nA genet, or a genetic individual, may be represented by multiple ramets in clonal organisms. Due to potential genotyping errors or somatic mutations, ramets originating from the same genet may not have perfectly identical multilocus genotypes. The problem addresses this by defining a distance tolerance, $e_{\\max}$.\n\n1.  **Genotype Representation and Distance**: Each diploid multilocus genotype is a vector of unordered allele pairs. An allele pair for a single locus, such as $\\{a, b\\}$, is a multiset. This is critical for distinguishing homozygotes $\\{a, a\\}$ from heterozygotes $\\{a, b\\}$. To facilitate comparison, each allele pair is converted to a canonical representation, such as a frequency map or a sorted tuple. For this implementation, a multiset representation is used. The distance, $d(G_1, G_2)$, between two multilocus genotypes, $G_1$ and $G_2$, is defined as the number of loci at which their corresponding allele pairs are not identical:\n    $$\n    d(G_1, G_2) = \\sum_{l=1}^{L} \\mathbb{I}(G_{1,l} \\neq G_{2,l})\n    $$\n    where $L$ is the number of loci and $\\mathbb{I}(\\cdot)$ is the indicator function.\n\n2.  **Graph-Based Clustering**: To identify genets, we construct an undirected graph $\\mathcal{G} = (V, E)$, where the vertex set $V$ represents the collection of sampled ramets. An edge $(u, v) \\in E$ exists between two ramets $u$ and $v$ if and only if the distance between their genotypes is less than or equal to the specified tolerance, $d(G_u, G_v) \\le e_{\\max}$.\n\n3.  **Connected Components**: A genet is operationally defined as a connected component in the graph $\\mathcal{G}$. This definition correctly ensures transitivity: if ramet A is genetically close to B, and B is close to C, then A, B, and C are all members of the same genet, regardless of the direct distance between A and C. The number of genets, $G$, is the number of connected components in $\\mathcal{G}$. These components can be found using a standard graph traversal algorithm, such as Breadth-First Search (BFS) or Depth-First Search (DFS).\n\n4.  **Clone Correction**: For subsequent population genetic analyses, it is necessary to avoid pseudoreplication by including each genet only once. This is achieved through clone correction. From each identified connected component (genet), a single representative ramet is arbitrarily chosen. The dataset for the subsequent analysis consists of the genotypes and patch labels of these representative genets.\n\n**II. Quantification of Genetic Differentiation using $F_{ST}$**\n\nThe statistic $F_{ST}$ is used to measure the genetic differentiation between the two patches, 'A' and 'B', using the clone-corrected data.\n\n1.  **Gene Diversity**: The analysis is based on gene diversity (expected heterozygosity), $H$. For a given locus in a population with allele frequencies $p_i$ for alleles $i = 1, \\dots, k$, the gene diversity is:\n    $$\n    H = 1 - \\sum_{i=1}^{k} p_i^2\n    $$\n    Allele frequencies are calculated by counting alleles from the diploid genotypes of the representative genets. A genet with genotype $\\{a,b\\}$ contributes one allele $a$ and one allele $b$ to the gene pool.\n\n2.  **Hierarchical Diversities**: We calculate gene diversity at three levels for each locus $\\ell$:\n    -   $H_A^{(\\ell)}$ and $H_B^{(\\ell)}$: The gene diversity within patch 'A' and patch 'B', respectively.\n    -   $H_T^{(\\ell)}$: The total gene diversity, calculated from allele frequencies in the pooled population of all representative genets from both patches.\n    -   $H_S^{(\\ell)}$: The average subpopulation gene diversity, computed as the weighted average of the within-patch diversities, where the weights are the number of genets in each patch ($n_A$ and $n_B$):\n        $$\n        H_S^{(\\ell)} = \\frac{n_A H_A^{(\\ell)} + n_B H_B^{(\\ell)}}{n_A + n_B}\n        $$\n\n3.  **Multilocus $F_{ST}$**: The fixation index for a single locus $\\ell$, $F_{ST}^{(\\ell)}$, is calculated as the proportion of the total genetic variance that is due to differences between patches:\n    $$\n    F_{ST}^{(\\ell)} = \\frac{H_T^{(\\ell)} - H_S^{(\\ell)}}{H_T^{(\\ell)}}\n    $$\n    This calculation is performed only for loci where $H_T^{(\\ell)} > 0$, as differentiation cannot be measured at monomorphic loci. The overall multilocus $F_{ST}$ is the arithmetic mean of the single-locus $F_{ST}^{(\\ell)}$ values over all informative loci. If no loci are informative (all $H_T^{(\\ell)} = 0$), the multilocus $F_{ST}$ is defined to be $0$ by convention.\n\n**III. Hypothesis Testing via Permutation**\n\nA permutation test is employed to assess the statistical significance of the observed $F_{ST}$ value. The null hypothesis, $H_0$, is that the ramets across both patches are drawn from a single, panmictic population (i.e., there is no significant genetic structure).\n\n1.  **Observed Statistic**: First, the multilocus $F_{ST}^{\\text{obs}}$ is calculated from the original clone-corrected data.\n\n2.  **Null Distribution Generation**: A null distribution for $F_{ST}$ is generated by simulating the scenario under $H_0$. This is achieved by randomly permuting the patch labels ('A' or 'B') among the representative genets. For each of $R$ permutations:\n    -   A new dataset is created with the original genotypes but shuffled patch labels.\n    -   A multilocus $F_{ST}^{\\text{perm}}$ is computed for this permuted dataset.\n\n3.  **Empirical $p$-value**: The empirical $p$-value is the probability of observing an $F_{ST}$ value as large as or larger than $F_{ST}^{\\text{obs}}$ under the null hypothesis. It is calculated as:\n    $$\n    p = \\frac{1 + N_{\\ge}}{1 + R}\n    $$\n    where $N_{\\ge}$ is the number of permutations for which $F_{ST}^{\\text{perm}} \\ge F_{ST}^{\\text{obs}}$. The addition of $1$ to the numerator and denominator prevents a $p$-value of $0$ and accounts for the observed data as one possible outcome.\n\n4.  **Decision**: The null hypothesis is not rejected if the resulting $p$-value is greater than or equal to the significance level $\\alpha$. In this case, we conclude that the data are consistent with the two patches belonging to a single interbreeding population. Otherwise, if $p < \\alpha$, we reject $H_0$ and conclude that there is significant genetic differentiation between the patches. For reproducibility, the random number generator used for permutations is initialized with a fixed seed.",
            "answer": "```python\nimport numpy as np\nfrom collections import Counter\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases.\n    \"\"\"\n    \n    # Test case 1 data\n    tc1_ramets = [\n        ([(10, 11), (20, 20), (31, 31), (40, 41)], 'A'),\n        ([(10, 11), (20, 21), (31, 31), (40, 41)], 'A'),\n        ([(10, 10), (20, 21), (30, 31), (40, 40)], 'A'),\n        ([(11, 11), (20, 21), (31, 32), (41, 41)], 'B'),\n        ([(11, 11), (20, 21), (31, 32), (41, 41)], 'B'),\n        ([(10, 11), (21, 21), (30, 30), (41, 41)], 'B'),\n        ([(10, 11), (20, 21), (31, 31), (40, 41)], 'A'),\n        ([(10, 11), (20, 21), (30, 32), (40, 41)], 'B'),\n        ([(10, 11), (20, 21), (31, 31), (40, 41)], 'A'),\n        ([(10, 10), (20, 20), (31, 32), (41, 41)], 'B')\n    ]\n\n    # Test case 2 data\n    tc2_ramets = [\n        ([(10, 10), (20, 20), (30, 30), (40, 40)], 'A'),\n        ([(10, 11), (20, 20), (30, 30), (40, 40)], 'A'),\n        ([(10, 10), (20, 20), (30, 31), (40, 40)], 'A'),\n        ([(10, 10), (20, 20), (30, 30), (40, 40)], 'A'),\n        ([(12, 12), (22, 22), (33, 33), (43, 43)], 'B'),\n        ([(12, 12), (22, 22), (33, 33), (43, 43)], 'B'),\n        ([(12, 12), (22, 22), (33, 34), (43, 43)], 'B'),\n        ([(12, 12), (22, 22), (33, 33), (43, 44)], 'B')\n    ]\n\n    # Test case 3 data\n    tc3_ramets = [\n        ([(5, 5), (6, 6), (7, 7), (8, 8)], 'A'),\n        ([(5, 5), (6, 6), (7, 7), (8, 8)], 'A'),\n        ([(5, 5), (6, 6), (7, 7), (8, 8)], 'B'),\n        ([(5, 5), (6, 6), (7, 7), (8, 8)], 'B')\n    ]\n\n    # Test case 4 data\n    tc4_ramets = [\n        ([(100, 101), (200, 200), (300, 301), (400, 400)], 'A'),\n        ([(100, 100), (200, 201), (300, 300), (400, 401)], 'A'),\n        ([(100, 101), (200, 201), (300, 301), (400, 401)], 'B'),\n        ([(100, 101), (200, 200), (300, 301), (400, 401)], 'B')\n    ]\n\n    test_cases = [\n        {'L': 4, 'ramets': tc1_ramets, 'e_max': 1, 'R': 499, 'alpha': 0.05},\n        {'L': 4, 'ramets': tc2_ramets, 'e_max': 0, 'R': 499, 'alpha': 0.05},\n        {'L': 4, 'ramets': tc3_ramets, 'e_max': 0, 'R': 499, 'alpha': 0.05},\n        {'L': 4, 'ramets': tc4_ramets, 'e_max': 0, 'R': 499, 'alpha': 0.05}\n    ]\n\n    results = []\n    \n    # Use a fixed seed for reproducibility of permutation test\n    RANDOM_SEED = 42\n\n    for case in test_cases:\n        result = _process_test_case(case['L'], case['ramets'], case['e_max'], case['R'], case['alpha'], RANDOM_SEED)\n        results.append(result)\n\n    # Format the final output as a single string\n    output_str = \"[\" + \",\".join([f\"[{G},{fst:.6f},{p:.4f},{str(d).lower()}]\" for G, fst, p, d in results]) + \"]\"\n    print(output_str)\n\ndef _process_test_case(L, ramets, e_max, R, alpha, seed):\n    \"\"\"\n    Processes a single test case from start to finish.\n    \"\"\"\n    canonical_ramets = []\n    for genotype, patch in ramets:\n        # Convert genotypes to a list of Counters for easy comparison of unordered pairs\n        canon_geno = [Counter(g) for g in genotype]\n        canonical_ramets.append((canon_geno, patch))\n    \n    # Step 1: Identify genets and perform clone correction\n    G, clone_corrected_data = _identify_genets(canonical_ramets, e_max, L)\n\n    # Handle special case where Fst cannot be meaningfully computed\n    # If all genets are identical, Ht=0 for all loci where the single genet is homozygous.\n    # The problem specifies Fst=0 and p=1 if all Ht=0.\n    # This occurs here if G=1 and the single genet is homozygous at all loci.\n    is_monomorphic_system = True\n    if len(clone_corrected_data) > 1:\n        first_genotype = clone_corrected_data[0][0]\n        for genotype, _ in clone_corrected_data[1:]:\n            if genotype != first_genotype:\n                is_monomorphic_system = False\n                break\n\n    if is_monomorphic_system:\n         # Check if all loci are homozygous\n         all_homozygous = True\n         if clone_corrected_data:\n             geno = clone_corrected_data[0][0]\n             for locus_geno in geno:\n                 if len(locus_geno) > 1: # More than one unique allele\n                     all_homozygous = False\n                     break\n         if all_homozygous:\n             fst, p_val = 0.0, 1.0\n             decision = p_val >= alpha\n             return [G, fst, p_val, decision]\n\n\n    # Step 2 & 3: Calculate Fst and perform permutation test\n    fst, p_val = _perform_permutation_test(clone_corrected_data, L, R, seed)\n    \n    # Step 4: Make a decision\n    decision = p_val >= alpha\n    \n    return [G, fst, p_val, decision]\n\ndef _calculate_distance(geno1, geno2, L):\n    \"\"\"Calculates the multilocus distance between two canonical genotypes.\"\"\"\n    mismatches = 0\n    for i in range(L):\n        if geno1[i] != geno2[i]:\n            mismatches += 1\n    return mismatches\n\ndef _identify_genets(ramets_data, e_max, L):\n    \"\"\"Identifies genets by finding connected components in the ramet graph.\"\"\"\n    num_ramets = len(ramets_data)\n    adj = [[0] * num_ramets for _ in range(num_ramets)]\n    \n    for i in range(num_ramets):\n        for j in range(i, num_ramets):\n            dist = _calculate_distance(ramets_data[i][0], ramets_data[j][0], L)\n            if dist <= e_max:\n                adj[i][j] = adj[j][i] = 1\n\n    visited = [False] * num_ramets\n    num_genets = 0\n    representatives = []\n    \n    for i in range(num_ramets):\n        if not visited[i]:\n            num_genets += 1\n            # Add the first unvisited ramet of a component as the representative\n            representatives.append(ramets_data[i])\n            \n            # Use BFS to find all ramets in the same component\n            q = [i]\n            visited[i] = True\n            head = 0\n            while head < len(q):\n              u = q[head]\n              head += 1\n              for v in range(num_ramets):\n                  if adj[u][v] and not visited[v]:\n                      visited[v] = True\n                      q.append(v)\n                      \n    return num_genets, representatives\n\ndef _calculate_fst(data, L):\n    \"\"\"Calculates multilocus Fst from clone-corrected data.\"\"\"\n    locus_fsts = []\n    \n    for l in range(L):\n        alleles_A, alleles_B = [], []\n        n_A, n_B = 0, 0\n        \n        for genotype, patch in data:\n            allele_pair = list(genotype[l].elements())\n            if patch == 'A':\n                alleles_A.extend(allele_pair)\n                n_A += 1\n            else:\n                alleles_B.extend(allele_pair)\n                n_B += 1\n        \n        alleles_T = alleles_A + alleles_B\n        \n        if not alleles_T: continue # No data for this locus\n        \n        counts_T = Counter(alleles_T)\n        num_alleles_T = len(alleles_T)\n        if num_alleles_T == 0: continue\n        sum_sq_freq_T = sum((c / num_alleles_T) ** 2 for c in counts_T.values())\n        H_T = 1 - sum_sq_freq_T\n        \n        if H_T > 0:\n            # Calculate H_A\n            num_alleles_A = len(alleles_A)\n            if num_alleles_A > 0:\n                counts_A = Counter(alleles_A)\n                sum_sq_freq_A = sum((c / num_alleles_A) ** 2 for c in counts_A.values())\n                H_A = 1 - sum_sq_freq_A\n            else:\n                H_A = 0\n\n            # Calculate H_B\n            num_alleles_B = len(alleles_B)\n            if num_alleles_B > 0:\n                counts_B = Counter(alleles_B)\n                sum_sq_freq_B = sum((c / num_alleles_B) ** 2 for c in counts_B.values())\n                H_B = 1 - sum_sq_freq_B\n            else:\n                H_B = 0\n            \n            n_T = n_A + n_B\n            if n_T == 0: continue\n            \n            H_S = (n_A * H_A + n_B * H_B) / n_T\n            \n            fst_locus = (H_T - H_S) / H_T\n            locus_fsts.append(fst_locus)\n            \n    if not locus_fsts:\n        return 0.0\n    \n    return np.mean(locus_fsts)\n\ndef _perform_permutation_test(data, L, R, seed):\n    \"\"\"Performs a permutation test to get Fst_obs and p-value.\"\"\"\n    if not data:\n        return 0.0, 1.0\n\n    fst_obs = _calculate_fst(data, L)\n    \n    # If observed Fst is 0 (e.g., all genets identical), p-value is 1.\n    is_obs_zero = np.isclose(fst_obs, 0.0)\n    \n    genotypes = [d[0] for d in data]\n    patch_labels = np.array([d[1] for d in data])\n    \n    rng = np.random.default_rng(seed)\n    \n    ge_count = 0\n    for _ in range(R):\n        permuted_labels = rng.permutation(patch_labels)\n        permuted_data = list(zip(genotypes, permuted_labels))\n        fst_perm = _calculate_fst(permuted_data, L)\n        \n        if fst_perm >= fst_obs or (is_obs_zero and np.isclose(fst_perm, 0.0)):\n             ge_count += 1\n            \n    p_value = (ge_count + 1) / (R + 1)\n    \n    return fst_obs, p_value\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}