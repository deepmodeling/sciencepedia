{
    "hands_on_practices": [
        {
            "introduction": "遗传漂变的强度并非恒定不变；它关键地取决于群体大小和当前的等位基因频率。一个精确量化此效应的方法是计算单代内等位基因频率变化的期望方差。这个基础练习将引导你从第一性原理出发，推导经典Wright-Fisher模型中的这一方差，揭示群体遗传学理论的基石——关系式 $\\text{Var}(\\Delta p | p_t) = p_t(1-p_t)/(2N)$。",
            "id": "2753537",
            "problem": "考虑一个经典的赖特-费舍尔模型（Wright–Fisher model），该模型描述了一个普查规模恒定为 $N$ 的二倍体种群。此种群世代不重叠、随机交配，且无选择、突变或迁移。在此种群中，我们关注一个单一的双等位基因中性位点。在第 $t$ 代，等位基因 $A$ 的种群频率为 $p_t \\in [0,1]$。每一代都是通过从亲代基因库中有放回地独立抽取 $2N$ 个配子而形成的，其中每个抽取的配子为 $A$ 型的概率为 $p_t$。\n\n定义下一代等位基因频率为 $p_{t+1}$，单代频率变化为 $\\Delta p \\equiv p_{t+1} - p_t$。请严格地从赖特-费舍尔模型的生成抽样机制出发，并利用二项分布的基本性质以及方差在仿射变换下的性质，推导出精确的条件方差 $\\operatorname{Var}(\\Delta p \\mid p_t, N)$，并将其表示为关于 $p_t$ 和 $N$ 的闭式表达式。请勿使用扩散近似或渐近极限；请精确计算有限 $N$ 下的结果。请将最终答案表示为单一的解析表达式。无需四舍五入，不涉及单位。",
            "solution": "按题干所述，问题需要进行验证。\n\n步骤1：提取已知条件。\n- 模型：经典的赖特-费舍尔模型。\n- 种群：二倍体，恒定普查规模 $N$。\n- 世代：不重叠。\n- 交配：随机。\n- 位点：单双等位基因中性位点（等位基因 $A$）。\n- 演化力：无选择、突变或迁移。\n- 第 $t$ 代的等位基因频率：$p_t \\in [0,1]$。\n- 生成机制：每一代通过从亲代基因库中有放回地独立抽取 $2N$ 个配子形成。\n- 抽样概率：抽到 $A$ 等位基因的概率为 $p_t$。\n- 下一代等位基因频率：$p_{t+1}$。\n- 单代等位基因频率变化：$\\Delta p \\equiv p_{t+1} - p_t$。\n- 目标：推导精确的条件方差 $\\operatorname{Var}(\\Delta p \\mid p_t, N)$。\n- 约束：推导过程必须仅使用生成抽样机制、二项分布的基本性质以及方差在仿射变换下的性质。结果必须是针对有限 $N$ 的精确闭式表达式，不得使用扩散近似或渐近极限。\n\n步骤2：使用提取的已知条件进行验证。\n该问题陈述具有科学依据，论述严谨且客观。它描述了群体遗传学中的一个标准基础模型（赖特-费舍尔模型），并要求推导一个经典结果。所有术语都得到了精确定义，并且提供了必要的信息。该问题不基于任何事实错误，不是比喻性的，不是不完整或矛盾的，在其理论框架内没有描述不切实际的条件，问题本身是适定的，是科学上可验证的，并且不是一个“伪深刻”的问题。该问题有效。\n\n步骤3：结论与行动。\n问题有效。将提供完整的推导过程。\n\n推导过程从问题陈述中定义的基本抽样过程开始。\n设 $X_{t+1}$ 为一个随机变量，表示在第 $t+1$ 代种群中等位基因 $A$ 的拷贝数。由于种群是大小为 $N$ 的二倍体，该位点的等位基因总数为 $2N$。\n根据赖特-费舍尔模型的生成机制，第 $t+1$ 代的这 $2N$ 个等位基因是通过从第 $t$ 代的基因库中有放回地抽样得到的。亲代基因库中等位基因 $A$ 的频率是 $p_t$。\n因此，这 $2N$ 次抽取中的每一次都是一次独立的伯努利试验，其成功概率为 $p_t$（其中“成功”定义为抽到 $A$ 等位基因）。在 $2N$ 次独立伯努利试验中，成功的总次数 $X_{t+1}$ 服从二项分布。我们把这个条件分布写成：\n$$\nX_{t+1} \\mid p_t \\sim \\text{Binomial}(n=2N, p=p_t)\n$$\n根据定义，第 $t+1$ 代的等位基因频率（记为 $p_{t+1}$）是 $A$ 等位基因的数量除以种群中等位基因的总数。\n$$\np_{t+1} = \\frac{X_{t+1}}{2N}\n$$\n我们需要求解的是等位基因频率变化的条件方差 $\\operatorname{Var}(\\Delta p \\mid p_t, N)$，其中 $\\Delta p = p_{t+1} - p_t$。\n我们首先计算下一代等位基因频率的条件方差 $\\operatorname{Var}(p_{t+1} \\mid p_t, N)$。\n我们使用方差在标量变换下的性质，即对于一个随机变量 $Y$ 和一个常数 $c$，有 $\\operatorname{Var}(cY) = c^2 \\operatorname{Var}(Y)$。在我们的例子中，$Y = X_{t+1}$，常数是 $c = \\frac{1}{2N}$。\n$$\n\\operatorname{Var}(p_{t+1} \\mid p_t, N) = \\operatorname{Var}\\left(\\frac{X_{t+1}}{2N} \\mid p_t, N\\right) = \\left(\\frac{1}{2N}\\right)^2 \\operatorname{Var}(X_{t+1} \\mid p_t, N)\n$$\n一个服从二项分布 $Z \\sim \\text{Binomial}(n, p)$ 的随机变量的方差由 $\\operatorname{Var}(Z) = np(1-p)$ 给出。\n将此公式应用于 $X_{t+1}$，我们得到：\n$$\n\\operatorname{Var}(X_{t+1} \\mid p_t, N) = (2N) p_t (1 - p_t)\n$$\n将此结果代入 $p_{t+1}$ 的方差表达式中：\n$$\n\\operatorname{Var}(p_{t+1} \\mid p_t, N) = \\frac{1}{(2N)^2} [2N p_t (1 - p_t)] = \\frac{2N p_t (1 - p_t)}{4N^2} = \\frac{p_t(1 - p_t)}{2N}\n$$\n现在，我们来考虑我们感兴趣的量，$\\operatorname{Var}(\\Delta p \\mid p_t, N)$。\n$$\n\\Delta p = p_{t+1} - p_t\n$$\n这个差的方差必须在给定 $p_t$ 的条件下计算。在这个条件背景下，$p_t$ 是一个固定的、非随机的量。它是系统发生转变时的状态。\n我们使用方差在常数平移下的性质，即对于一个随机变量 $Y$ 和一个常数 $k$，有 $\\operatorname{Var}(Y - k) = \\operatorname{Var}(Y)$。\n在这里，$Y = p_{t+1}$，常数是 $k = p_t$。\n因此，\n$$\n\\operatorname{Var}(\\Delta p \\mid p_t, N) = \\operatorname{Var}(p_{t+1} - p_t \\mid p_t, N) = \\operatorname{Var}(p_{t+1} \\mid p_t, N)\n$$\n这就证明了等位基因频率变化的方差等于下一代等位基因频率的方差。\n结合我们的结果，我们得到最终的表达式：\n$$\n\\operatorname{Var}(\\Delta p \\mid p_t, N) = \\frac{p_t(1 - p_t)}{2N}\n$$\n这就是赖特-费舍尔模型中单代等位基因频率变化的条件方差的精确闭式表达式，它是严格按照要求从模型的生成过程和基本统计原理推导出来的。",
            "answer": "$$\n\\boxed{\\frac{p_t(1 - p_t)}{2N}}\n$$"
        },
        {
            "introduction": "群体遗传学使用多种模型来捕捉跨代随机抽样的本质。具有非重叠世代的Wright-Fisher模型和具有重叠世代的Moran模型代表了两种截然不同的基本方法。本实践旨在挑战你连接这两种模型，通过证明在适当的时间尺度下，它们描述了相同的潜在扩散过程。通过令它们各自的方差产生率（即扩散系数）相等，你将推导出统一这两种观点的关键尺度因子。",
            "id": "2753553",
            "problem": "一个中性等位基因在一个大小为 $N$、世代不重叠的封闭、随机交配的二倍体种群中根据 Wright–Fisher 模型进行分离，以及在一个通过单个出生-死亡事件根据 Moran 模型演化的世代重叠种群中进行分离。令 $p_t$ 表示在时间 $t$ 的等位基因频率。\n\n假设以下基本定义。\n\n1. Wright–Fisher 模型：在每一代中，下一代的 $2N$ 个基因拷贝是从当前代中独立抽样的，每个拷贝是目标等位基因的概率为 $p_t$。因此 $p_{t+1} = \\frac{K}{2N}$，其中 $K \\sim \\operatorname{Binomial}(2N,p_t)$。\n\n2. 基因拷贝上的 Moran 模型：种群表示为 $M$ 个单倍体基因拷贝，其中 $M=2N$，通过重复的替换事件演化。在每个事件中，从种群中均匀随机选择一个基因拷贝作为亲本并进行复制，然后均匀随机选择一个基因拷贝（可能与亲本类型相同）将其移除。令“Moran 事件”表示这样一次出生-死亡替换，并令 $p$ 表示事件发生前的等位基因频率。\n\n将“每单位时间”的漂变方差定义为等位基因频率增量的主阶条件方差除以时间单位。对于 Wright–Fisher 模型，取时间单位为一代。对于 Moran 模型，假设在对应于一个 Wright-Fisher 世代的时间间隔内，期望发生 $c$ 次 Moran 出生-死亡事件；假设在固定等位基因频率 $p$ 下，事件间的增量在主阶上是独立的。\n\n仅使用上述基本定义和二项分布的标准性质，首先计算每个 Wright–Fisher 世代的中性遗传漂变方差。接着，计算单个 Moran 出生-死亡事件贡献的中性遗传漂变方差。然后，通过在相同的等位基因频率 $p$ 下匹配两个扩散系数（方差率），确定唯一的缩放因子 $c=c(N)$，即为了使两个模型具有相同的中性漂变扩散系数，在一个 Wright–Fisher 世代期间必须发生的 Moran 出生-死亡事件的期望数量。\n\n你的最终答案必须是 $c(N)$ 的一个单一闭式表达式，不带单位。不需要进行数值近似或四舍五入。",
            "solution": "该问题要求我们确定缩放因子 $c(N)$，该因子使得 Wright-Fisher 模型和 Moran 模型的中性遗传漂变扩散系数相等。我们将首先按照定义计算每个模型每单位时间的等位基因频率变化的方差，然后将这两个量相等。对于特定时间的等位基因频率，我们使用通用符号 $p$。\n\n首先，我们分析 Wright-Fisher 模型。种群由 $N$ 个二倍体个体组成，对应 $2N$ 个基因拷贝。下一代的等位基因频率 $p_{t+1}$ 由 $p_{t+1} = \\frac{K}{2N}$ 给出，其中 $K$ 是从二项分布 $K \\sim \\operatorname{Binomial}(2N, p_t)$ 中抽取的随机变量。一代之内等位基因频率的变化是 $\\Delta p = p_{t+1} - p_t$。问题要求的是每单位时间的漂变方差，对于 Wright-Fisher 模型，这即是 $\\Delta p$ 在一代内的条件方差。\n对于中性等位基因，该变化的条件期望为零：\n$$E[\\Delta p | p_t] = E[p_{t+1} - p_t | p_t] = E\\left[\\frac{K}{2N}\\right] - p_t = \\frac{1}{2N}E[K] - p_t = \\frac{1}{2N}(2Np_t) - p_t = 0$$\n因此，条件方差为：\n$$\\operatorname{Var}(\\Delta p | p_t) = \\operatorname{Var}(p_{t+1} - p_t | p_t)$$\n由于 $p_t$ 在条件中是给定的常数，这可以简化为：\n$$\\operatorname{Var}(\\Delta p | p_t) = \\operatorname{Var}(p_{t+1} | p_t) = \\operatorname{Var}\\left(\\frac{K}{2N} | p_t\\right) = \\frac{1}{(2N)^2} \\operatorname{Var}(K | p_t)$$\n二项随机变量 $\\operatorname{Binomial}(n,p)$ 的方差是 $n p (1-p)$。在我们的例子中， $n=2N$ 且概率是 $p_t$。因此， $\\operatorname{Var}(K | p_t) = 2N p_t(1-p_t)$。\n将此代入频率变化的方差表达式中，我们得到 Wright-Fisher 模型的扩散系数，我们将其记为 $D_{WF}$：\n$$D_{WF} = \\frac{1}{4N^2} \\left[2N p_t(1-p_t)\\right] = \\frac{p_t(1-p_t)}{2N}$$\n\n接下来，我们分析 Moran 模型。种群被定义为 $M = 2N$ 个单倍体基因拷贝。设目标等位基因的数量为 $i$，则频率为 $p = i/M$。一次 Moran 事件是一次单个的出生-死亡替换。问题描述“从种群中均匀随机选择一个基因拷贝作为亲本并进行复制，然后均匀随机选择一个...基因拷贝将其移除”，被解释为从 $M$ 个基因拷贝的种群中进行两次独立抽取，以确定亲本和被移除的个体。\n令 $\\delta p$ 为在一次这样的事件中等位基因频率的变化。目标等位基因的数量 $i$ 可以变化 $+1$、$-1$ 或 $0$。\n如果选择一个目标等位基因作为亲本（概率为 $p = i/M$），并选择一个非目标等位基因进行移除（概率为 $1-p = (M-i)/M$），则目标等位基因的数量增加一（$\\Delta i = +1$）。此转移的概率是 $p(1-p)$。\n如果选择一个非目标等位基因作为亲本（概率为 $1-p$），并选择一个目标等位基因进行移除（概率为 $p$），则目标等位基因的数量减少一（$\\Delta i = -1$）。此转移的概率是 $(1-p)p$。\n如果亲本和被移除的个体属于同一类型，则等位基因的数量保持不变（$\\Delta i = 0$），这种情况发生的概率为 $p^2 + (1-p)^2$。\n频率的变化是 $\\delta p = \\Delta i / M$。每次事件的期望变化是：\n$$E[\\delta p | p] = \\frac{1}{M} E[\\Delta i | p] = \\frac{1}{M} \\left[ (+1)p(1-p) + (-1)p(1-p) + (0)\\left(p^2+(1-p)^2\\right) \\right] = 0$$\n每次事件的频率变化的方差是 $\\operatorname{Var}(\\delta p | p) = E[(\\delta p)^2 | p] - (E[\\delta p | p])^2 = E[(\\delta p)^2 | p]$。\n$$E[(\\delta p)^2 | p] = \\left(\\frac{+1}{M}\\right)^2 p(1-p) + \\left(\\frac{-1}{M}\\right)^2 p(1-p) + (0)^2\\left(p^2+(1-p)^2\\right) = \\frac{2p(1-p)}{M^2}$$\n代入 $M=2N$，每次 Moran 事件的方差为：\n$$\\operatorname{Var}(\\delta p | p) = \\frac{2p(1-p)}{(2N)^2} = \\frac{p(1-p)}{2N^2}$$\n根据题目，在一个对应于 Wright-Fisher 世代的时间内，有 $c$ 次这样的事件。假设增量独立，此期间的总方差，即 Moran 模型的扩散系数 $D_M$ 为：\n$$D_M = c \\cdot \\operatorname{Var}(\\delta p | p) = c \\frac{p(1-p)}{2N^2}$$\n\n为了找到缩放因子 $c(N)$，我们在一个共同的参考频率 $p$ 下，令两个扩散系数相等，$D_{WF} = D_M$：\n$$\\frac{p(1-p)}{2N} = c \\frac{p(1-p)}{2N^2}$$\n对于 $p \\in (0,1)$ 的多态种群，我们可以将等式两边同时除以 $p(1-p)$ 项：\n$$\\frac{1}{2N} = \\frac{c}{2N^2}$$\n对此方程求解 $c$，得到唯一的缩放因子：\n$$c = \\frac{2N^2}{2N} = N$$\n因此，为了使中性漂变方差在一代的时间尺度上相等，必须发生 $N$ 次 Moran 出生-死亡事件。",
            "answer": "$$\\boxed{N}$$"
        },
        {
            "introduction": "像Wright-Fisher这样的离散模型在理论上可以收敛到一个连续的扩散过程，这是一个非常强大的概念。这个动手计算练习将该理论付诸实践，让你使用扩散近似的随机微分方程（SDE）直接模拟等位基因频率的轨迹。你将实施欧拉-丸山方法来数值求解SDE，从而在处理漂变、选择和突变效应方面获得实践经验，同时也将直面重要的数值问题，如稳定性和在 $p=0$ 及 $p=1$ 处边界的施加。",
            "id": "2753540",
            "problem": "您需要使用随机微分方程的 Euler–Maruyama 离散化方法，实现一个带有选择和双向突变的 Wright–Fisher 扩散的数值模拟器。等位基因频率过程被建模为等位基因-1 频率 $p_t \\in [0,1]$ 的一维 Itô 扩散，其漂移系数和扩散系数源于经典群体遗传学。模型假设如下：\n\n- 存在一个恒定的有效种群大小 $N_e > 0$。\n- 作用于等位基因 1 的基因选择，其选择系数为 $s \\in \\mathbb{R}$。\n- 从等位基因 1 到等位基因 0 的突变率为 $u \\ge 0$，从等位基因 0 到等位基因 1 的突变率为 $v \\ge 0$。\n- Wright–Fisher 扩散的漂移项 $a(p)$ 和扩散项 $b(p)$ 由下式给出\n  $$ a(p) = s\\,p\\,(1-p) + v\\,(1-p) - u\\,p, \\qquad b(p) = \\frac{p\\,(1-p)}{2\\,N_e}. $$\n- $p_t$ 的随机微分方程（Itô 形式）为\n  $$ \\mathrm{d}p_t = a(p_t)\\,\\mathrm{d}t + \\sqrt{b(p_t)}\\,\\mathrm{d}W_t, $$\n  其中 $W_t$ 是一个标准 Wiener 过程。\n\n您的任务是：\n\n1. 基于上述模型规范（这是基本依据），实现单路径 Euler–Maruyama 时间离散化，以在均匀网格 $t_n = n\\,\\Delta t$（其中 $n=0,1,\\dots, T/\\Delta t$）上模拟 $p_t$，并使用给定的初始条件 $p_0 \\in [0,1]$。每个时间步使用独立的标准正态增量。\n2. 按如下方式强制执行状态约束：\n   - 在每个 Euler–Maruyama 步之后，如果状态离开区间，则通过“钳位”(clamping)操作将其投影回闭区间 $[0,1]$，即将任何提议值 $\\tilde p$ 替换为 $\\min\\{\\max\\{\\tilde p,0\\},1\\}$。\n   - 如果 $u = 0$ 且 $v = 0$（无突变），则将 $p=0$ 和 $p=1$ 视为吸收边界：一旦过程达到 $p=0$ 或 $p=1$，它将在所有后续步骤中保持在该状态。如果突变非零（即 $u>0$ 或 $v>0$），则不进行吸收。\n3. 在您的内部设计中讨论数值稳定性，并在测试套件中选择能反映 $p=0$ 和 $p=1$ 附近稳定和潜在不稳定两种状态的 $\\Delta t$ 值。数值方法应具有鲁棒性，即对于所有指定的测试用例，它都能终止并返回一个在 $[0,1]$ 区间内的值。\n\n使用以下测试套件。对于每个测试用例，使用指定的参数模拟单条轨迹，并使用提供的伪随机种子以确保可复现性。返回时间 $T$ 时的最终等位基因频率（即在 $t = T$ 时），结果表示为小数，并精确到小数点后六位。\n\n- 测试用例 1（常规路径，中性，内部起始）：$N_e = 10000$, $s = 0$, $u = 0$, $v = 0$, $p_0 = 0.5$, $T = 1.0$, $\\Delta t = 0.0005$, seed $= 12345$。\n- 测试用例 2（接近 $0$，弱正选择和微小正向突变）：$N_e = 5000$, $s = 0.01$, $u = 0$, $v = 0.00001$, $p_0 = 0.001$, $T = 2.0$, $\\Delta t = 0.0005$, seed $= 2021$。\n- 测试用例 3（接近 $1$，负选择和远离等位基因 1 的突变）：$N_e = 5000$, $s = -0.02$, $u = 0.00002$, $v = 0$, $p_0 = 0.999$, $T = 1.5$, $\\Delta t = 0.0005$, seed $= 2022$。\n- 测试用例 4（更粗的时间步以探测稳定性）：$N_e = 2000$, $s = 0$, $u = 0$, $v = 0$, $p_0 = 0.3$, $T = 1.0$, $\\Delta t = 0.01$, seed $= 7$。\n- 测试用例 5（小 $N_e$，对称突变和更强的漂移）：$N_e = 50$, $s = 0$, $u = 0.001$, $v = 0.001$, $p_0 = 0.5$, $T = 0.5$, $\\Delta t = 0.0005$, seed $= 4242$。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。例如，输出必须如下所示\n  $$ [x_1,x_2,x_3,x_4,x_5], $$\n  其中每个 $x_i$ 是测试用例 $i$ 的最终等位基因频率，四舍五入到小数点后六位，并以小数形式表示（不带百分号）。\n\n不需要也不允许用户输入。给定上述种子，输出应该是确定性的。根据设计，所有结果必须在闭区间 $[0,1]$ 内。",
            "solution": "所提出的问题是 Wright–Fisher 扩散的数值模拟，这是群体遗传学中的一个基本随机过程，用于模拟等位基因频率在突变、选择和遗传漂变作用下的演化。任务是实现 Euler–Maruyama 方法来求解相应的随机微分方程 (SDE)。该问题陈述的有效性得到了证实，因为它在科学上基于既定理论，提供了所有必要参数使其成为一个适定问题，并被客观地表述为一个计算任务。\n\n等位基因频率的演化（用 $p_t$ 表示）由一维 Itô SDE 描述：\n$$\n\\mathrm{d}p_t = a(p_t)\\,\\mathrm{d}t + \\sqrt{b(p_t)}\\,\\mathrm{d}W_t\n$$\n其中 $W_t$ 是一个标准 Wiener 过程。漂移系数 $a(p)$ 和扩散系数 $b(p)$ 分别概括了确定性力和随机力。\n\n漂移项 $a(p) = s\\,p\\,(1-p) + v\\,(1-p) - u\\,p$ 模拟了等位基因频率的系统性变化。项 $s\\,p\\,(1-p)$ 代表基因选择，其中 $s$ 是选择系数。项 $v\\,(1-p)$ 和 $-u\\,p$ 分别代表从等位基因 0 到等位基因 1 的突变（速率为 $v$）和从等位基因 1 到等位基因 0 的突变（速率为 $u$）。\n\n扩散项 $b(p) = \\frac{p\\,(1-p)}{2\\,N_e}$ 模拟了由于有限种群大小而引起的随机波动，这被称为遗传漂变。这些波动的幅度与有效种群大小 $N_e$ 成反比。\n\n为了模拟该过程的一条轨迹，我们将时间离散化为大小为 $\\Delta t$ 的步长，使得 $t_n = n\\,\\Delta t$。Euler–Maruyama 格式通过以下递推关系来近似 SDE：\n$$\np_{n+1} = p_n + a(p_n)\\,\\Delta t + \\sqrt{b(p_n)}\\,\\Delta W_n\n$$\n其中 $p_n \\approx p(t_n)$ 且 $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$ 是 Wiener 过程的一个增量。这些增量是独立同分布的正态随机变量，均值为 $0$，方差为 $\\Delta t$。因此，我们可以写成 $\\Delta W_n = \\sqrt{\\Delta t}\\,Z_n$，其中 $Z_n$ 是一个标准正态随机变量，$Z_n \\sim \\mathcal{N}(0, 1)$。\n\n代入 $a(p)$、$b(p)$ 和 $\\Delta W_n$ 的表达式，下一个提议状态 $\\tilde{p}_{n+1}$ 的完整更新规则是：\n$$\n\\tilde{p}_{n+1} = p_n + \\left( s\\,p_n\\,(1-p_n) + v\\,(1-p_n) - u\\,p_n \\right)\\Delta t + \\sqrt{\\frac{p_n\\,(1-p_n)}{2\\,N_e}}\\sqrt{\\Delta t}\\,Z_n\n$$\n\n此数值模拟的一个关键方面是处理 $p=0$ 和 $p=1$ 处的状态空间边界。根据定义，等位基因频率被限制在区间 $[0,1]$ 内。然而，Euler–Maruyama 步骤中的随机项可能导致 $\\tilde{p}_{n+1}$ 落在此区间之外，这在数学上和生物学上都是无意义的。这是该数值方案的一个常见的人为现象。\n为确保过程保持在其有效域内，强制执行两条规则：\n\n1.  **钳位 (Clamping)**：每步之后，将提议值 $\\tilde{p}_{n+1}$ 投影回区间 $[0,1]$。这是通过操作 $p_{n+1} = \\max(0, \\min(1, \\tilde{p}_{n+1}))$ 实现的。该方法是鲁棒的，并能确保状态变量始终保持有效。\n\n2.  **吸收边界 (Absorbing Boundaries)**：在没有突变（$u=0$ 且 $v=0$）的情况下，边界 $p=0$ 和 $p=1$ 代表一个等位基因的固定。在这些点，漂移项 $a(p)$ 和扩散方差 $b(p)$ 均为零。因此，一旦频率达到 $0$ 或 $1$，它就被“吸收”，无法再改变。在模拟中，如果在这些条件下 $p_n$ 为 $0$ 或 $1$，它将在所有后续时间步中保持固定。当存在突变时（$u>0$ 或 $v>0$），边界不再是吸收性的。例如，在 $p=0$ 时，漂移项变为 $a(0)=v>0$，将频率推回区间 $(0,1]$。在 $p=1$ 处也发生类似效应，此时 $a(1)=-u<0$。钳位机制能正确处理来自边界的这种“反射”（更准确地说是重新进入）。\n\n数值稳定性是一个需要关注的问题，尤其是在使用较大的时间步长 $\\Delta t$ 时。大的 $\\Delta t$ 会增加随机增量的方差，使得发生大的、非物理性跳跃的可能性更高。测试用例 4 通过使用一个比其他情况大 20 倍的 $\\Delta t$ 来探讨这一点。尽管存在解析的稳定性条件，但指定的钳位程序提供了一个实用且鲁棒的解决方案，可以防止模拟失败，代价是如果时间步长相对于动力学过程过大，可能会引入少量偏差。\n\n单条模拟路径的算法如下：\n1.  初始化参数：$N_e, s, u, v, p_0, T, \\Delta t$ 以及伪随机数生成器的种子。\n2.  设置初始等位基因频率 $p = p_0$。\n3.  计算总时间步数，$N_{\\text{steps}} = \\text{round}(T / \\Delta t)$。\n4.  迭代 $N_{\\text{steps}}$ 次：\n    a.  如果 $u=0$、$v=0$，且 $p=0$ 或 $p=1$，则状态被吸收；此路径的模拟可以终止，返回当前的 $p$ 值。\n    b.  计算漂移项 $a(p)$ 和扩散标准差因子 $\\sigma_p = \\sqrt{p(1-p)/(2N_e)}$。\n    c.  生成一个标准正态随机数 $Z \\sim \\mathcal{N}(0,1)$。\n    d.  计算下一个提议状态：$\\tilde{p} = p + a(p)\\Delta t + \\sigma_p \\sqrt{\\Delta t} Z$。\n    e.  应用钳位规则：$p = \\max(0, \\min(1, \\tilde{p}))$。\n5.  循环终止后，最终的 $p$ 值即为结果 $p_T$。\n\n此过程将应用于每个测试用例以生成所需的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the suite of Wright-Fisher diffusion simulations.\n    \"\"\"\n\n    test_cases = [\n        # (Ne, s, u, v, p0, T, dt, seed)\n        (10000, 0.0, 0.0, 0.0, 0.5, 1.0, 0.0005, 12345),\n        (5000, 0.01, 0.0, 0.00001, 0.001, 2.0, 0.0005, 2021),\n        (5000, -0.02, 0.00002, 0.0, 0.999, 1.5, 0.0005, 2022),\n        (2000, 0.0, 0.0, 0.0, 0.3, 1.0, 0.01, 7),\n        (50, 0.0, 0.001, 0.001, 0.5, 0.5, 0.0005, 4242),\n    ]\n\n    results = []\n    for params in test_cases:\n        final_p = simulate_wf_diffusion(*params)\n        # Format the result to exactly six decimal places.\n        results.append(f\"{final_p:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef simulate_wf_diffusion(Ne, s, u, v, p0, T, dt, seed):\n    \"\"\"\n    Simulates a single path of the Wright-Fisher diffusion using Euler-Maruyama.\n\n    Args:\n        Ne (int): Effective population size.\n        s (float): Selection coefficient.\n        u (float): Mutation rate from allele 1 to 0.\n        v (float): Mutation rate from allele 0 to 1.\n        p0 (float): Initial allele frequency.\n        T (float): Total simulation time.\n        dt (float): Time step size.\n        seed (int): Seed for the pseudo-random number generator.\n\n    Returns:\n        float: The final allele frequency at time T.\n    \"\"\"\n    \n    # Initialize the pseudo-random number generator for reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # Current allele frequency.\n    p = p0\n    \n    # Calculate the number of steps, ensuring it is an integer.\n    # Using round() is robust against floating-point inaccuracies.\n    num_steps = int(round(T / dt))\n    \n    # Pre-calculate sqrt(dt) for efficiency in the loop.\n    sqrt_dt = np.sqrt(dt)\n\n    # Check for absorbing boundaries case at the start.\n    is_absorbing = (u == 0.0 and v == 0.0)\n\n    for _ in range(num_steps):\n        # Handle absorbing boundaries if applicable.\n        if is_absorbing and (p == 0.0 or p == 1.0):\n            # If the state is absorbed, it remains fixed.\n            break\n\n        # Calculate drift coefficient a(p).\n        drift_a = s * p * (1 - p) + v * (1 - p) - u * p\n\n        # Calculate diffusion coefficient b(p).\n        # This will be zero if p=0 or p=1, correctly nullifying the stochastic term.\n        diffusion_b_term = np.sqrt(p * (1 - p) / (2 * Ne))\n\n        # Generate a standard normal random increment.\n        Z = rng.normal(0, 1)\n\n        # Euler-Maruyama step.\n        # The stochastic increment is sqrt(b(p)) * dW = sqrt(b(p)) * Z * sqrt(dt).\n        p_tilde = p + drift_a * dt + diffusion_b_term * Z * sqrt_dt\n        \n        # Enforce state constraints [0, 1] by clamping.\n        p = min(max(p_tilde, 0.0), 1.0)\n    \n    return p\n\n# Execute the simulation.\nsolve()\n```"
        }
    ]
}