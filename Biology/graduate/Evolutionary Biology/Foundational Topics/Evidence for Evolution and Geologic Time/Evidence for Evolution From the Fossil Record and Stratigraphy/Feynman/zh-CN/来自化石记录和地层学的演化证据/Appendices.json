{
    "hands_on_practices": [
        {
            "introduction": "要定量地研究进化，我们必须首先将化石锚定在绝对时间中。本练习将演示放射性测年的核心原理，特别是铷-锶（Rb-Sr）法，该方法使我们能够为包含化石的地层上下的火山灰层赋予精确的数值年龄。通过应用放射性衰变方程，您将对地质年代学家如何建立所有后续进化分析所必需的时间框架有基本的理解。",
            "id": "2706735",
            "problem": "在一个整合地层序列中，对位于一个含化石的沉积单元正下方的一个火山灰层进行了铷-锶（Rb–Sr）体系分析。测量该火山灰的一个全岩等分样的现今同位素比值为 $^{87}\\mathrm{Rb}/^{87}\\mathrm{Sr} = 0.25$ 和 $^{87}\\mathrm{Sr}/^{86}\\mathrm{Sr} = 0.7100$。由同源矿物构建的一条独立等时线约束了该火山灰在沉积时的初始锶同位素组成为 $^{87}\\mathrm{Sr}/^{86}\\mathrm{Sr} = 0.6990$。$^{87}\\mathrm{Rb}$ 的放射性衰变常数为 $\\lambda = 1.42 \\times 10^{-11}\\,\\mathrm{yr}^{-1}$。仅使用基本放射性衰变原理和相对于一个稳定参考同位素的同位素质量平衡，计算该火山灰层的结晶年龄。根据叠覆原理，说明这个绝对年龄为上覆含化石单元限定的是最大年龄还是最小年龄，并用一句话陈述你的理由。将你的数值年龄四舍五入到 $2$ 位有效数字，并以十亿年（Ga）为单位表示。你最终报告的答案必须仅为以 Ga 为单位的数值。",
            "solution": "该问题要求使用铷-锶（Rb-Sr）放射性测年法计算一个火山灰层的结晶年龄，并分析其与上覆含化石单元的地层关系。\n\n基本原理是母体同位素 $^{87}\\mathrm{Rb}$ 通过 β 衰变转变为子体同位素 $^{87}\\mathrm{Sr}$。在时间 $t$ 时剩余的母体原子数，记为 $N_{^{87}\\mathrm{Rb}}(t)$，通过指数衰变定律与初始原子数 $N_{^{87}\\mathrm{Rb}}(0)$ 相关联：\n$$ N_{^{87}\\mathrm{Rb}}(t) = N_{^{87}\\mathrm{Rb}}(0) \\exp(-\\lambda t) $$\n其中 $\\lambda$ 是 $^{87}\\mathrm{Rb}$ 的衰变常数。\n\n由该衰变产生的放射成因子体原子数 $D^*$ ($^{87}\\mathrm{Sr}_{\\text{rad}}$) 等于母体原子数的减少量：\n$$ D^* = N_{^{87}\\mathrm{Rb}}(0) - N_{^{87}\\mathrm{Rb}}(t) $$\n通过重新整理衰变定律，$N_{^{87}\\mathrm{Rb}}(0) = N_{^{87}\\mathrm{Rb}}(t) \\exp(\\lambda t)$，我们可以用现今的母体原子数来表示 $D^*$：\n$$ D^* = N_{^{87}\\mathrm{Rb}}(t) \\exp(\\lambda t) - N_{^{87}\\mathrm{Rb}}(t) = N_{^{87}\\mathrm{Rb}}(t)(\\exp(\\lambda t) - 1) $$\n\n现今存在的 $^{87}\\mathrm{Sr}$ 原子总数 $N_{^{87}\\mathrm{Sr}}(t)$，是初始存在的 $^{87}\\mathrm{Sr}$ 原子数 $N_{^{87}\\mathrm{Sr}}(0)$ 与自结晶以来产生的放射成因原子数 $D^*$ 的总和：\n$$ N_{^{87}\\mathrm{Sr}}(t) = N_{^{87}\\mathrm{Sr}}(0) + N_{^{87}\\mathrm{Rb}}(t)(\\exp(\\lambda t) - 1) $$\n\n在同位素地球化学中，标准做法是将这些绝对丰度对锶的一种稳定的、非放射成因的同位素 $^{86}\\mathrm{Sr}$ 进行归一化，其丰度 $N_{^{86}\\mathrm{Sr}}$ 不随时间变化。将该方程两边同除以 $N_{^{86}\\mathrm{Sr}}$，得到以可测量的同位素比值表示的标准等时线方程：\n$$ \\frac{N_{^{87}\\mathrm{Sr}}(t)}{N_{^{86}\\mathrm{Sr}}} = \\frac{N_{^{87}\\mathrm{Sr}}(0)}{N_{^{86}\\mathrm{Sr}}} + \\frac{N_{^{87}\\mathrm{Rb}}(t)}{N_{^{86}\\mathrm{Sr}}} (\\exp(\\lambda t) - 1) $$\n使用更紧凑的记法，其中 $(\\cdot)_p$ 表示现今比值，$(\\cdot)_0$ 表示时间 $t=0$ 时的初始比值，上式变为：\n$$ \\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_p = \\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_0 + \\left(\\frac{^{87}\\mathrm{Rb}}{^{86}\\mathrm{Sr}}\\right)_p (\\exp(\\lambda t) - 1) $$\n问题提供了以下数据：\n现今测量比值 $\\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_p = 0.7100$。\n初始比值 $\\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_0 = 0.6990$。\n衰变常数 $\\lambda = 1.42 \\times 10^{-11}\\,\\mathrm{yr}^{-1}$。\n现今测量比值 $\\left(\\frac{^{87}\\mathrm{Rb}}{^{87}\\mathrm{Sr}}\\right)_p = 0.25$。\n\n等时线方程需要现今的母体同位素与稳定子体同位素之比，即 $\\left(\\frac{^{87}\\mathrm{Rb}}{^{86}\\mathrm{Sr}}\\right)_p$。这可以通过对给定比值进行代数变换得出：\n$$ \\left(\\frac{^{87}\\mathrm{Rb}}{^{86}\\mathrm{Sr}}\\right)_p = \\left(\\frac{^{87}\\mathrm{Rb}}{^{87}\\mathrm{Sr}}\\right)_p \\times \\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_p $$\n代入数值：\n$$ \\left(\\frac{^{87}\\mathrm{Rb}}{^{86}\\mathrm{Sr}}\\right)_p = 0.25 \\times 0.7100 = 0.1775 $$\n现在我们有了求解年龄 $t$ 所需的所有要素。让我们重新整理等时线方程，以分离出 $t$：\n$$ \\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_p - \\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_0 = \\left(\\frac{^{87}\\mathrm{Rb}}{^{86}\\mathrm{Sr}}\\right)_p (\\exp(\\lambda t) - 1) $$\n$$ \\frac{\\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_p - \\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_0}{\\left(\\frac{^{87}\\mathrm{Rb}}{^{86}\\mathrm{Sr}}\\right)_p} = \\exp(\\lambda t) - 1 $$\n$$ 1 + \\frac{\\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_p - \\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_0}{\\left(\\frac{^{87}\\mathrm{Rb}}{^{86}\\mathrm{Sr}}\\right)_p} = \\exp(\\lambda t) $$\n取等式两边的自然对数：\n$$ \\ln\\left(1 + \\frac{\\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_p - \\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_0}{\\left(\\frac{^{87}\\mathrm{Rb}}{^{86}\\mathrm{Sr}}\\right)_p}\\right) = \\lambda t $$\n最后，求解 $t$：\n$$ t = \\frac{1}{\\lambda} \\ln\\left(1 + \\frac{\\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_p - \\left(\\frac{^{87}\\mathrm{Sr}}{^{86}\\mathrm{Sr}}\\right)_0}{\\left(\\frac{^{87}\\mathrm{Rb}}{^{86}\\mathrm{Sr}}\\right)_p}\\right) $$\n将数值代入此表达式：\n$$ t = \\frac{1}{1.42 \\times 10^{-11}\\,\\mathrm{yr}^{-1}} \\ln\\left(1 + \\frac{0.7100 - 0.6990}{0.1775}\\right) $$\n$$ t = \\frac{1}{1.42 \\times 10^{-11}\\,\\mathrm{yr}^{-1}} \\ln\\left(1 + \\frac{0.011}{0.1775}\\right) $$\n$$ t = \\frac{1}{1.42 \\times 10^{-11}\\,\\mathrm{yr}^{-1}} \\ln(1 + 0.0619718...) $$\n$$ t = \\frac{1}{1.42 \\times 10^{-11}\\,\\mathrm{yr}^{-1}} \\ln(1.0619718...) $$\n$$ t = \\frac{0.060126...}{1.42 \\times 10^{-11}\\,\\mathrm{yr}^{-1}} \\approx 4.234 \\times 10^9\\,\\mathrm{years} $$\n问题要求年龄以十亿年（Ga）为单位表示，其中 $1\\,\\mathrm{Ga} = 10^9\\,\\mathrm{years}$，并四舍五入到 $2$ 位有效数字。\n$$ t \\approx 4.2\\,\\mathrm{Ga} $$\n关于地层约束，叠覆原理指出，在一个整合地层层序中，任何一个地层都比其下伏的地层要年轻。由于含化石的沉积单元直接位于已测年的火山灰层之上，因此化石必定比火山灰年轻。因此，该火山灰层的绝对年龄为上覆化石提供了一个最大年龄。\n\n理由如下：叠覆原理规定，上覆的含化石单元比其下方的已测年火山灰层年轻，因此火山灰的年龄为化石的年龄设定了一个最大界限。",
            "answer": "$$\\boxed{4.2}$$"
        },
        {
            "introduction": "一旦我们确定了含化石地层的年代，就可以开始量化进化变化的速率。本练习介绍了“达尔文”这一衡量形态演化的标准单位，并指导您完成其计算。将此工具应用于假设的化石数据，将巩固您将原始测量值和时间间隔转化为有意义的进化速率的能力。",
            "id": "2706715",
            "problem": "一个地层序列保留了一段连续的海洋剖面，从中在两个层位采集了同谱系软体动物的样本，这两个层位被区域上可对比的火山灰层所界定。高精度放射性测年将下层火山灰的年龄定为$34.00$百万年，上层火山灰的年龄定为$32.00$百万年，根据地层叠覆原理和绝对测年法，确定了化石样本之间存在$2.00$百万年的时间间隔。一个线性形态性状（壳肋宽度）的样本均值，在下层层位为$5.00$单位，在上层层位为$10.00$单位，样本量足够大，因此在本次计算中可将这些均值视为精确值。在化石记录的宏观演化研究中，以“达尔文”（darwin）为单位的演化速率定义为每$1$百万年（Myr）性状均值自然对数的变化量。\n\n仅使用这些数据和上述定义，计算该谱系在两个层位之间的演化速率（以达尔文为单位），并简要解释其大小，用每$1$百万年的倍数变化来表示。用达尔文表示该速率，并将您的答案四舍五入到四位有效数字。",
            "solution": "首先对问题陈述进行验证。\n\n步骤1：提取已知条件。\n- 下层火山灰年龄：$34.00$百万年。\n- 上层火山灰年龄：$32.00$百万年。\n- 时间间隔（$\\Delta t$）：$2.00$百万年。\n- 下层层位性状均值（$M_1$）：$5.00$单位。\n- 上层层位性状均值（$M_2$）：$10.00$单位。\n- 以达尔文为单位的演化速率（$d$）的定义：每$1$百万年性状均值自然对数的变化量。\n\n步骤2：使用提取的已知条件进行验证。\n问题经评估后被认为是有效的。它在科学上基于古生物学、地层学和宏观演化的既定原理。所提供的数据是一致的；$2.00$百万年的时间间隔是火山灰层年龄的正确差值（$34.00 - 32.00 = 2.00$）。该问题设定良好、客观，并包含计算出唯一、有意义解所需的所有信息。不存在逻辑矛盾、不切实际的假设或含糊之处。\n\n步骤3：结论与行动。\n问题有效。将推导解答。\n\n以达尔文为单位的演化速率（我们用符号$d$表示）定义为每百万年一个性状均值的自然对数的变化量。该定义的数学公式为：\n$$d = \\frac{\\ln(M_2) - \\ln(M_1)}{\\Delta t}$$\n在此， $M_1$是初始时间（下层层位）的性状均值， $M_2$是最终时间（上层层位）的性状均值，而$\\Delta t$是以百万年为单位的时间间隔。\n\n问题给出的已知条件是：\n- 初始性状均值，$M_1 = 5.00$。\n- 最终性状均值，$M_2 = 10.00$。\n- 时间间隔，$\\Delta t = 2.00$百万年。\n\n我们将这些值代入速率方程：\n$$d = \\frac{\\ln(10.00) - \\ln(5.00)}{2.00}$$\n通过应用对数性质 $\\ln(a) - \\ln(b) = \\ln(\\frac{a}{b})$，我们简化分子：\n$$d = \\frac{\\ln\\left(\\frac{10.00}{5.00}\\right)}{2.00} = \\frac{\\ln(2.00)}{2.00}$$\n为了获得数值，我们使用$2$的自然对数的近似值，即 $\\ln(2) \\approx 0.69314718...$。速率$d$的计算如下：\n$$d = \\frac{0.69314718...}{2.00} \\approx 0.34657359...$$\n问题要求最终答案必须四舍五入到四位有效数字。第四位有效数字是$5$，其后的数字是$7$，所以我们向上取整。\n$$d \\approx 0.3466$$\n\n问题还要求用每$1$百万年的倍数变化来解释这个速率。演化速率$d$意味着，对于$\\Delta t = 1$百万年的时间间隔，我们有$d = \\ln(M_{\\text{final}}) - \\ln(M_{\\text{initial}})$。这可以重写为$d = \\ln\\left(\\frac{M_{\\text{final}}}{M_{\\text{initial}}}\\right)$。比率$\\frac{M_{\\text{final}}}{M_{\\text{initial}}}$是倍数变化，我们将其表示为$F$。因此，$d = \\ln(F)$。每百万年的倍数变化可以通过对速率取指数来找到：\n$$F = \\exp(d)$$\n使用我们计算出的速率的精确表达式$d = \\frac{\\ln(2)}{2}$：\n$$F = \\exp\\left(\\frac{\\ln(2)}{2}\\right) = \\left(\\exp(\\ln(2))\\right)^{1/2} = 2^{1/2} = \\sqrt{2} \\approx 1.414$$\n这个结果表明，在指定的时间间隔内，该形态性状（壳肋宽度）每百万年增加约$1.414$倍。这与总体观察结果一致：在$2.00$百万年的时期内，总倍数变化是从$5.00$到$10.00$，即为$2$倍。我们将计算出的每百万年倍数变化复合两百万年，得到$(\\sqrt{2})^2 = 2$，这证实了结果的逻辑一致性。",
            "answer": "$$\\boxed{0.3466}$$"
        },
        {
            "introduction": "化石记录不仅揭示了进化的发生，还揭示了其发生的方式。这个高级实践超越了简单的速率计算，运用统计模型来检验关于进化模式的竞争性假说。您将使用赤池信息准则（Akaike Information Criterion, AIC）来实施和比较两个基本模型——停滞模型和随机游走模型，以确定哪个模型能更好地解释古生物学时间序列，从而为您提供一个强大的定量假说检验工具。",
            "id": "2706707",
            "problem": "给定一个单一谱系的壳体平均尺寸测量值的时间序列，该序列按地层顺序排列，尺寸单位为毫米，采样于已知的地层年龄（单位：百万年，Myr）。您必须实现两种用于描述连续地层层位之间性状变化的演化模型，并基于赤池信息准则（Akaike Information Criterion, AIC）选择拟合度更好的模型。这两种模型的定义如下。\n\n模型S（停滞）：每个观测值 $x_i$ 都是来自一个正态分布的独立实现，该分布具有未知的恒定均值 $\\mu$ 和方差 $\\sigma^2$，即 $x_i \\sim \\mathcal{N}(\\mu,\\sigma^2)$，其中 $i=1,\\dots,n$。\n\n模型RW（连续时间中的无偏随机游走）：增量 $d_i = x_i - x_{i-1}$ 是独立的，且服从均值为 $0$、方差与样本间的时间间隔成正比的正态分布，即 $d_i \\sim \\mathcal{N}\\!\\left(0, v \\,\\Delta t_i\\right)$，其中 $i=2,\\dots,n$。此处 $\\Delta t_i = t_i - t_{i-1} > 0$ 是样本间的时间间隔（单位：百万年），$v$ 是未知的每百万年扩散方差。\n\n假设不存在额外的观测误差。对于给定的数据，使用最大似然法为每个模型估计参数。使用赤池信息准则（AIC）来选择更优模型（AIC值越小越好），其定义为 $\\mathrm{AIC} = 2k - 2\\ln\\hat{L}$，其中 $k$ 是估计参数的数量，$\\hat{L}$ 是模型下的最大化似然值。对于模型S，参数为 $\\mu$ 和 $\\sigma^2$，因此 $k$ 取为 $k_S = 2$。对于模型RW，参数为扩散方差 $v$，因此 $k$ 取为 $k_{RW} = 1$；初始观测值 $x_1$ 被视为给定值（而不是一个参数）。\n\n如果两个AIC值的差异在 $10^{-9}$ 的绝对容差范围内，则选择参数较少的模型（即模型RW）。否则，选择AIC值较小的模型。您无需报告参数估计值，只需报告每个测试用例所选择的模型。\n\n输入数据相关的所有物理量都带有指定的单位，但您的输出是无单位的。请确保所有对数运算都是自然对数。\n\n请实现一个程序来评估以下测试套件。对于每个测试用例，计算AIC偏好的模型，并输出一个整数代码：输出 $0$ 表示选择模型S（停滞），输出 $1$ 表示选择模型RW（无偏随机游走）。\n\n测试套件：\n- 案例 $1$（等间距）：壳体尺寸（单位：mm）为 $[10, 10, 11, 10, 12, 12, 12, 13, 13, 13]$，采样于等间距的地层层位，时间间隔为 $\\Delta t = 0.5$ 百万年。即，时间（单位：百万年）$t = [0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5]$，壳体尺寸 $x = [10, 10, 11, 10, 12, 12, 12, 13, 13, 13]$。\n- 案例 $2$（近似停滞，中度噪声）：时间（单位：百万年）$t = [0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4]$，壳体尺寸（单位：mm）$x = [10.0, 10.2, 9.9, 10.1, 10.0, 10.1, 9.95, 10.05]$。\n- 案例 $3$（边界长度，两点）：时间（单位：百万年）$t = [0.0, 1.0]$，壳体尺寸（单位：mm）$x = [5.0, 7.0]$。\n- 案例 $4$（可变间距，近似停滞）：时间（单位：百万年）$t = [0.0, 0.1, 0.6, 1.6, 2.6]$，壳体尺寸（单位：mm）$x = [100.0, 100.1, 100.05, 100.0, 100.05]$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表内容为按上述案例顺序排列的结果。例如，输出形式为 $[m_1,m_2,m_3,m_4]$，其中每个 $m_i \\in \\{0,1\\}$ 表示案例 $i$ 所选择的模型。\n\n最终输出是包含整数列表的单行文本，无任何附加文字。",
            "solution": "所提出的问题是统计模型选择中的一个有效练习，这是定量科学中的一项基本任务。它要求使用赤池信息准则（AIC）来比较两种用于演化时间序列数据的标准模型——停滞模型和无偏随机游走模型。该问题具有科学依据，定义明确，并包含获得唯一解所需的所有信息。我们将通过推导每个模型的最大似然估计量和AIC表达式来求解。\n\n设数据为 $n$ 个性状测量值的时间序列 $\\mathbf{x} = \\{x_1, x_2, \\dots, x_n\\}$，其对应的时间点为 $\\mathbf{t} = \\{t_1, t_2, \\dots, t_n\\}$。\n\n**模型S：停滞**\n\n该模型假定性状值是从一个具有恒定均值 $\\mu$ 和方差 $\\sigma^2$ 的单一正态分布中抽取的独立同分布随机变量。模型表示为：\n$$ x_i \\sim \\mathcal{N}(\\mu, \\sigma^2) \\quad \\text{for } i = 1, \\dots, n $$\n似然函数 $L_S(\\mu, \\sigma^2; \\mathbf{x})$ 是各个概率密度的乘积：\n$$ L_S(\\mu, \\sigma^2; \\mathbf{x}) = \\prod_{i=1}^{n} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(x_i - \\mu)^2}{2\\sigma^2}\\right) $$\n因此，对数似然函数为：\n$$ \\ln L_S(\\mu, \\sigma^2; \\mathbf{x}) = -\\frac{n}{2}\\ln(2\\pi) - \\frac{n}{2}\\ln(\\sigma^2) - \\frac{1}{2\\sigma^2}\\sum_{i=1}^{n}(x_i - \\mu)^2 $$\n为了找到 $\\mu$ 和 $\\sigma^2$ 的最大似然估计量（MLEs），我们将 $\\ln L_S$ 对每个参数求偏导数并令其为零。此过程得出的 $\\mu$ 的MLE为样本均值，$\\sigma^2$ 的MLE为样本方差（分母为 $n$）：\n$$ \\hat{\\mu} = \\frac{1}{n} \\sum_{i=1}^{n} x_i $$\n$$ \\hat{\\sigma}^2 = \\frac{1}{n} \\sum_{i=1}^{n} (x_i - \\hat{\\mu})^2 $$\n将这些估计量代回对数似然函数，得到最大化对数似然值 $\\ln\\hat{L}_S$：\n$$ \\ln \\hat{L}_S = -\\frac{n}{2}\\ln(2\\pi\\hat{\\sigma}^2) - \\frac{1}{2\\hat{\\sigma}^2} \\sum_{i=1}^{n}(x_i - \\hat{\\mu})^2 = -\\frac{n}{2}\\ln(2\\pi\\hat{\\sigma}^2) - \\frac{n\\hat{\\sigma}^2}{2\\hat{\\sigma}^2} $$\n$$ \\ln \\hat{L}_S = -\\frac{n}{2} \\left[ \\ln(2\\pi\\hat{\\sigma}^2) + 1 \\right] $$\n该模型估计的参数数量为 $k_S = 2$（对应 $\\mu$ 和 $\\sigma^2$）。AIC计算如下：\n$$ \\mathrm{AIC}_S = 2k_S - 2\\ln\\hat{L}_S = 4 - 2\\ln\\hat{L}_S $$\n\n**模型RW：无偏随机游走**\n\n该模型将连续观测值之间的增量 $d_i = x_i - x_{i-1}$ 描述为来自一个正态分布的独立随机抽取值，该分布的均值为 0，方差与时间间隔 $\\Delta t_i = t_i - t_{i-1}$ 成正比。模型为：\n$$ d_i \\sim \\mathcal{N}(0, v\\Delta t_i) \\quad \\text{for } i = 2, \\dots, n $$\n此处，$v$ 是扩散方差参数。似然函数 $L_{RW}(v; \\mathbf{d})$ 由 $n-1$ 个增量构建而成：\n$$ L_{RW}(v; \\mathbf{d}) = \\prod_{i=2}^{n} \\frac{1}{\\sqrt{2\\pi v\\Delta t_i}} \\exp\\left(-\\frac{d_i^2}{2v\\Delta t_i}\\right) $$\n对数似然函数为：\n$$ \\ln L_{RW}(v; \\mathbf{d}) = \\sum_{i=2}^{n} \\left[ -\\frac{1}{2}\\ln(2\\pi v\\Delta t_i) - \\frac{d_i^2}{2v\\Delta t_i} \\right] $$\n$$ \\ln L_{RW}(v; \\mathbf{d}) = -\\frac{n-1}{2}\\ln(v) - \\frac{1}{2v} \\sum_{i=2}^{n} \\frac{d_i^2}{\\Delta t_i} - \\frac{1}{2} \\sum_{i=2}^{n} \\ln(2\\pi\\Delta t_i) $$\n对 $v$ 求导并令结果为零，可得出 $v$ 的MLE：\n$$ \\hat{v} = \\frac{1}{n-1} \\sum_{i=2}^{n} \\frac{d_i^2}{\\Delta t_i} = \\frac{1}{n-1} \\sum_{i=2}^{n} \\frac{(x_i - x_{i-1})^2}{t_i - t_{i-1}} $$\n将 $\\hat{v}$ 代回对数似然函数，即可得到最大化对数似然值 $\\ln\\hat{L}_{RW}$。这可以有多种表达形式；一种直接的计算形式是：\n$$ \\ln \\hat{L}_{RW} = \\sum_{i=2}^{n} \\left[ -\\frac{1}{2}\\ln(2\\pi\\hat{v}\\Delta t_i) - \\frac{d_i^2}{2\\hat{v}\\Delta t_i} \\right] $$\n一种可用于验证的简化解析形式是：\n$$ \\ln \\hat{L}_{RW} = -\\frac{n-1}{2}(1 + \\ln(2\\pi\\hat{v})) - \\frac{1}{2}\\sum_{i=2}^{n}\\ln(\\Delta t_i) $$\n估计的参数数量为 $k_{RW} = 1$（对应 $v$，因为 $x_1$ 是给定的）。AIC为：\n$$ \\mathrm{AIC}_{RW} = 2k_{RW} - 2\\ln\\hat{L}_{RW} = 2 - 2\\ln\\hat{L}_{RW} $$\n\n**模型选择**\n\nAIC值较低的模型是更受偏好的模型。在两个模型AIC值相等的情况下（定义为 $|\\mathrm{AIC}_S - \\mathrm{AIC}_{RW}| \\le 10^{-9}$），简约性原则要求选择参数较少的模型。由于 $k_{RW} = 1 < k_S = 2$，因此在相等情况下选择模型RW。这导出了以下决策规则：当且仅当模型S的AIC分数显著低于模型RW时，才选择模型S；否则，选择模型RW。在计算上，规则如下：\n- 如果 $\\mathrm{AIC}_S < \\mathrm{AIC}_{RW} - 10^{-9}$，选择模型S（输出 $0$）。\n- 否则，选择模型RW（输出 $1$）。\n\n提供的测试用例将根据这些推导出的公式进行评估。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_aic_stasis(x: np.ndarray) -> float:\n    \"\"\"\n    Calculates the AIC for the stasis model (Model S).\n\n    Args:\n        x: A numpy array of trait measurements.\n\n    Returns:\n        The AIC value for the stasis model.\n    \"\"\"\n    n = len(x)\n    if n == 0:\n        return np.inf\n\n    # MLE for variance (np.var uses denominator n by default)\n    sigma2_hat = np.var(x)\n\n    if sigma2_hat <= 0:\n        # This case implies a perfect fit, log-likelihood is infinite,\n        # so AIC is -infinity.\n        return -np.inf\n\n    # Maximized log-likelihood for the stasis model.\n    # ln_L_S = -n/2 * (ln(2*pi*sigma2_hat) + 1)\n    ln_L_S = -n / 2.0 * (np.log(2 * np.pi * sigma2_hat) + 1.0)\n\n    # AIC = 2k - 2*ln(L), with k=2 parameters (mu, sigma^2).\n    k_S = 2\n    aic_S = 2 * k_S - 2 * ln_L_S\n    return aic_S\n\n\ndef calculate_aic_rw(t: np.ndarray, x: np.ndarray) -> float:\n    \"\"\"\n    Calculates the AIC for the unbiased random walk model (Model RW).\n\n    Args:\n        t: A numpy array of time points.\n        x: A numpy array of trait measurements.\n\n    Returns:\n        The AIC value for the random walk model.\n    \"\"\"\n    n = len(x)\n    if n < 2:\n        return np.inf\n\n    # Increments in trait and time\n    d = np.diff(x)\n    dt = np.diff(t)\n    \n    # Check for invalid time steps\n    if np.any(dt <= 0):\n        # This case is disallowed by the problem statement but is a robust check.\n        return np.inf\n\n    # MLE for diffusion variance v\n    # v_hat = (1/(n-1)) * sum(d_i^2 / dt_i)\n    # np.mean computes the sum and divides by the number of elements (n-1).\n    v_hat_terms = d**2 / dt\n    v_hat = np.mean(v_hat_terms)\n    \n    if v_hat <= 0:\n        # Perfect fit, all increments are zero. AIC is -infinity.\n        return -np.inf\n\n    # Maximized log-likelihood for the random walk model.\n    # ln_L_RW = sum( -1/2 * ln(2*pi*v_hat*dt_i) - d_i^2 / (2*v_hat*dt_i) )\n    ln_L_RW_terms = -0.5 * np.log(2 * np.pi * v_hat * dt) - v_hat_terms / (2 * v_hat)\n    ln_L_RW = np.sum(ln_L_RW_terms)\n\n    # AIC = 2k - 2*ln(L), with k=1 parameter (v).\n    k_RW = 1\n    aic_RW = 2 * k_RW - 2 * ln_L_RW\n    return aic_RW\n\n\ndef select_model(t: np.ndarray, x: np.ndarray) -> int:\n    \"\"\"\n    Selects the better model based on AIC.\n\n    Args:\n        t: A numpy array of time points.\n        x: A numpy array of trait measurements.\n\n    Returns:\n        0 if Model S (stasis) is selected, 1 if Model RW (random walk) is selected.\n    \"\"\"\n    aic_S = calculate_aic_stasis(x)\n    aic_RW = calculate_aic_rw(t, x)\n    \n    # Tolerance for floating point comparison\n    tolerance = 1e-9\n\n    # Select model S only if it is significantly better (lower AIC).\n    # Otherwise, select model RW (either because it's better, or because\n    # it's a tie and RW is more parsimonious).\n    if aic_S < aic_RW - tolerance:\n        return 0  # Model S is preferred\n    else:\n        return 1  # Model RW is preferred\n\n\ndef solve():\n    \"\"\"\n    Runs the full test suite and prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (equal spacing)\n        (np.array([0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5]),\n         np.array([10., 10., 11., 10., 12., 12., 12., 13., 13., 13.])),\n        # Case 2 (near-stasis, modest noise)\n        (np.array([0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4]),\n         np.array([10.0, 10.2, 9.9, 10.1, 10.0, 10.1, 9.95, 10.05])),\n        # Case 3 (boundary length, two points)\n        (np.array([0.0, 1.0]),\n         np.array([5.0, 7.0])),\n        # Case 4 (variable spacing, near-stasis)\n        (np.array([0.0, 0.1, 0.6, 1.6, 2.6]),\n         np.array([100.0, 100.1, 100.05, 100.0, 100.05]))\n    ]\n\n    results = []\n    for t, x in test_cases:\n        selected = select_model(t, x)\n        results.append(selected)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}