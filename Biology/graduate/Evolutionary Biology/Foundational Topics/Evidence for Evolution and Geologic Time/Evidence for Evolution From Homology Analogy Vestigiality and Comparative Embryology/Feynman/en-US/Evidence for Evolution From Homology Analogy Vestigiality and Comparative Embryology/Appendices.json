{
    "hands_on_practices": [
        {
            "introduction": "The concept of homology is central to comparative biology, but how do we rigorously test a homology hypothesis? This exercise guides you through formalizing a classic macroevolutionary question—the homology between the reptilian jaw joint and mammalian ear ossicles—using the principle of parsimony . You will learn how competing evolutionary scenarios can be translated into quantitative character codings and evaluated by which explanation requires fewer evolutionary steps on a phylogeny, providing a powerful demonstration of hypothesis testing in action.",
            "id": "2706069",
            "problem": "A central inference in evolutionary biology is that putative homologies are supported when an explicit, character-level hypothesis explaining observed anatomical distributions across taxa requires fewer evolutionary changes than competing, mutually exclusive codings that deny homology. Consider the well-documented transformation of the primary jaw joint (articular–quadrate) in non-mammalian vertebrates to the mammalian middle-ear ossicles (malleus–incus), which is historically interpreted as a homologous transformation based on comparative embryology and development. You will evaluate two mutually exclusive character-coding schemes that encapsulate the two alternative hypotheses and compute the minimum number of steps each requires on a fixed phylogeny using unordered parsimony.\n\nUse the following rooted phylogeny in Newick format (root at Actinopterygian): \"(Actinopterygian,(Amphibian,(Reptile,(Cynodont,(Monotreme,Therian)))))\". The terminal taxa are: Actinopterygian, Amphibian, Reptile, Cynodont, Monotreme, Therian. Assume equal weights and unordered character evolution.\n\nThe observed comparative anatomy and development are as follows. In Actinopterygian, Amphibian, and Reptile, the primary jaw joint is between articular and quadrate, and there are no separate middle-ear malleus and incus. In Cynodont (a non-mammalian synapsid), a transitional condition retains an articular–quadrate jaw joint albeit reduced, with no fully detached middle-ear ossicles. In Monotreme and Therian mammals, the jaw joint is dentary–squamosal and the middle ear possesses malleus and incus derived from the first pharyngeal arch.\n\nConstruct two mutually exclusive character-coding schemes capturing the competing hypotheses, then compute the minimum number of steps required for each coding on the given tree using Fitch parsimony:\n\n- Hypothesis $H_{1}$ (homology): The mammalian malleus–incus are homologous to the non-mammalian articular–quadrate. Code a single unordered binary character $C^{(H_{1})}$ with state $0$ denoting “the element functions as the primary jaw joint (articular–quadrate)” and state $1$ denoting “the same element functions as middle-ear ossicles (malleus–incus).” For Cynodont, use a polymorphic state $ \\{0,1\\} $ to reflect the transitional condition.\n\n- Hypothesis $H_{2}$ (non-homology/analogy): The mammalian malleus–incus are neomorphic and not homologous to the articular–quadrate. Under this hypothesis, represent the observations with two independent unordered binary characters: $C_{A}$ coding presence ($1$) versus absence ($0$) of the articular–quadrate jaw bones, and $C_{M}$ coding presence ($1$) versus absence ($0$) of the malleus–incus. Define the parsimony score for $H_{2}$ as the sum of the minimum steps for $C_{A}$ and $C_{M}$.\n\nExplicitly specify the terminal states you assign under each coding, then compute the minimum number of steps on the given tree using unordered Fitch parsimony with equal weights. Report your final result as a row matrix $$\\begin{pmatrix} s_{H_{1}}  s_{H_{2}} \\end{pmatrix}$$, where $s_{H_{1}}$ is the minimum number of steps for $C^{(H_{1})}$ and $s_{H_{2}}$ is the sum of minimum steps for $C_{A}$ and $C_{M}$. No rounding is required. The final answer must be a single row matrix with no units.",
            "solution": "The problem is subjected to validation before any attempt at a solution.\n\nStep 1: Extraction of Givens.\n- **Phylogeny:** A rooted tree given in Newick format as \"(Actinopterygian,(Amphibian,(Reptile,(Cynodont,(Monotreme,Therian)))))\". The root is at the branch leading to Actinopterygian.\n- **Terminal Taxa:** Actinopterygian, Amphibian, Reptile, Cynodont, Monotreme, Therian.\n- **Methodology:** Unordered Fitch parsimony with equal character state weights. The parsimony score is the minimum number of evolutionary steps (state changes).\n- **Anatomical Observations:**\n    - Actinopterygian, Amphibian, Reptile: Possess an articular-quadrate primary jaw joint; lack separate malleus-incus middle-ear ossicles.\n    - Cynodont: Possesses a reduced articular-quadrate jaw joint and no fully detached middle-ear ossicles. This is defined as a transitional condition.\n    - Monotreme, Therian: Possess a dentary-squamosal jaw joint and malleus-incus middle-ear ossicles.\n- **Hypothesis $H_{1}$ (Homology):**\n    - A single unordered binary character, $C^{(H_{1})}$.\n    - State $0$: The homologous element functions as the primary jaw joint (articular-quadrate).\n    - State $1$: The homologous element functions as middle-ear ossicles (malleus-incus).\n    - Cynodont is coded with a polymorphic state $\\{0,1\\}$.\n- **Hypothesis $H_{2}$ (Non-homology/Analogy):**\n    - Two independent unordered binary characters, $C_{A}$ and $C_{M}$.\n    - Character $C_{A}$: Presence ($1$) versus absence ($0$) of the articular-quadrate jaw bones.\n    - Character $C_{M}$: Presence ($1$) versus absence ($0$) of the malleus-incus middle-ear ossicles.\n    - The parsimony score for $H_{2}$, denoted as $s_{H_{2}}$, is the sum of the minimum steps for $C_{A}$ and $C_{M}$.\n- **Objective:** Compute the minimum number of steps for each hypothesis, $s_{H_{1}}$ and $s_{H_{2}}$, and report them as a row matrix $$\\begin{pmatrix} s_{H_{1}}  s_{H_{2}} \\end{pmatrix}$$.\n\nStep 2: Validation of Problem Statement.\n- **Scientific Grounding:** The problem is scientifically grounded. It presents a classic example of macroevolutionary transformation (jaw joint to ear ossicles) and employs a standard quantitative method in phylogenetics (parsimony) to evaluate competing hypotheses of homology. The phylogeny and anatomical data are consistent with established paleontological and comparative anatomical knowledge.\n- **Well-Posedness:** The problem is well-posed. It provides a fixed tree, explicitly defined character-coding schemes, and a deterministic algorithm (Fitch parsimony) for which a unique minimum step count exists. All necessary information is provided.\n- **Objectivity:** The problem is objective, requiring a formal calculation based on provided data and rules, free of subjective interpretation or opinion.\n\nStep 3: Verdict.\nThe problem is valid. It is a well-defined exercise in phylogenetic character analysis. A solution will now be computed.\n\nThe core of the task is to calculate the minimum number of character-state changes (the parsimony score) for two competing hypotheses on a given phylogeny. The phylogeny can be represented with labeled internal nodes for clarity. Let the internal nodes be $N_{1}$, $N_{2}$, $N_{3}$, and $N_{4}$.\n- $N_{1}$: Most recent common ancestor (MRCA) of Monotreme and Therian.\n- $N_{2}$: MRCA of Cynodont and $N_{1}$.\n- $N_{3}$: MRCA of Reptile and $N_{2}$.\n- $N_{4}$: MRCA of Amphibian and $N_{3}$.\nThe root of the tree is the MRCA of Actinopterygian and $N_{4}$.\n\nThe calculation will employ the Fitch algorithm. In the first (bottom-up) pass, for each internal node $k$ with daughter nodes $i$ and $j$ having state sets $S_{i}$ and $S_{j}$, the state set for $k$ is $S_{k} = S_{i} \\cap S_{j}$ if the intersection is non-empty. If the intersection is empty ($S_{i} \\cap S_{j} = \\emptyset$), then $S_{k} = S_{i} \\cup S_{j}$, and one step (a change) is added to the total length of the tree.\n\n**Analysis of Hypothesis $H_{1}$ (Homology)**\n\nUnder $H_{1}$, we use a single character $C^{(H_{1})}$.\n- **State Assignment:**\n    - Actinopterygian: State $0$ (jaw joint function).\n    - Amphibian: State $0$.\n    - Reptile: State $0$.\n    - Cynodont: State $\\{0,1\\}$ (polymorphic/transitional).\n    - Monotreme: State $1$ (ear ossicle function).\n    - Therian: State $1$.\n\n- **Fitch Algorithm (Bottom-up Pass):**\n    1.  **Node $N_{1}$ (parent of Monotreme, Therian):** $S_{Monotreme}=\\{1\\}$, $S_{Therian}=\\{1\\}$. The intersection is $S_{Monotreme} \\cap S_{Therian} = \\{1\\}$, which is non-empty. Thus, $S_{N_{1}}=\\{1\\}$. Steps = $0$.\n    2.  **Node $N_{2}$ (parent of Cynodont, $N_{1}$):** $S_{Cynodont}=\\{0,1\\}$, $S_{N_{1}}=\\{1\\}$. The intersection is $S_{Cynodont} \\cap S_{N_{1}} = \\{0,1\\} \\cap \\{1\\} = \\{1\\}$, which is non-empty. Thus, $S_{N_{2}}=\\{1\\}$. Steps remain $0$.\n    3.  **Node $N_{3}$ (parent of Reptile, $N_{2}$):** $S_{Reptile}=\\{0\\}$, $S_{N_{2}}=\\{1\\}$. The intersection is $S_{Reptile} \\cap S_{N_{2}} = \\{0\\} \\cap \\{1\\} = \\emptyset$, which is empty. Thus, $S_{N_{3}} = S_{Reptile} \\cup S_{N_{2}} = \\{0\\} \\cup \\{1\\} = \\{0,1\\}$. A step is counted. Steps = $1$.\n    4.  **Node $N_{4}$ (parent of Amphibian, $N_{3}$):** $S_{Amphibian}=\\{0\\}$, $S_{N_{3}}=\\{0,1\\}$. The intersection is $S_{Amphibian} \\cap S_{N_{3}} = \\{0\\} \\cap \\{0,1\\} = \\{0\\}$, which is non-empty. Thus, $S_{N_{4}}=\\{0\\}$. Steps remain $1$.\n    5.  **Root Node (parent of Actinopterygian, $N_{4}$):** $S_{Actinopterygian}=\\{0\\}$, $S_{N_{4}}=\\{0\\}$. The intersection is $S_{Actinopterygian} \\cap S_{N_{4}} = \\{0\\}$, which is non-empty. Thus, $S_{Root}=\\{0\\}$. Steps remain $1$.\n\nThe total minimum number of steps for hypothesis $H_{1}$ is $s_{H_{1}} = 1$. This single change represents the evolutionary transition of the element's function from a jaw joint to an ear ossicle.\n\n**Analysis of Hypothesis $H_{2}$ (Non-homology)**\n\nUnder $H_{2}$, we analyze two independent characters, $C_{A}$ and $C_{M}$, and sum their scores.\n\n**Character $C_{A}$: Presence($1$)/Absence($0$) of Articular-Quadrate Jaw Bones.**\n- **State Assignment:**\n    - Actinopterygian: $1$ (present).\n    - Amphibian: $1$ (present).\n    - Reptile: $1$ (present).\n    - Cynodont: $1$ (present, albeit reduced).\n    - Monotreme: $0$ (absent).\n    - Therian: $0$ (absent).\n\n- **Fitch Algorithm for $C_{A}$:**\n    1.  **Node $N_{1}$:** $S_{Monotreme}=\\{0\\}$, $S_{Therian}=\\{0\\}$. Intersection is $\\{0\\}$. $S_{N_{1}}=\\{0\\}$. Steps = $0$.\n    2.  **Node $N_{2}$:** $S_{Cynodont}=\\{1\\}$, $S_{N_{1}}=\\{0\\}$. Intersection is empty. $S_{N_{2}} = \\{0\\} \\cup \\{1\\} = \\{0,1\\}$. Steps = $1$.\n    3.  **Node $N_{3}$:** $S_{Reptile}=\\{1\\}$, $S_{N_{2}}=\\{0,1\\}$. Intersection is $\\{1\\}$. $S_{N_{3}}=\\{1\\}$. Steps remain $1$.\n    4.  **Node $N_{4}$:** $S_{Amphibian}=\\{1\\}$, $S_{N_{3}}=\\{1\\}$. Intersection is $\\{1\\}$. $S_{N_{4}}=\\{1\\}$. Steps remain $1$.\n    5.  **Root Node:** $S_{Actinopterygian}=\\{1\\}$, $S_{N_{4}}=\\{1\\}$. Intersection is $\\{1\\}$. $S_{Root}=\\{1\\}$. Steps remain $1$.\nThe minimum number of steps for $C_{A}$ is $1$. This step represents the loss of the articular-quadrate jaw joint.\n\n**Character $C_{M}$: Presence($1$)/Absence($0$) of Malleus-Incus Ossicles.**\n- **State Assignment:**\n    - Actinopterygian: $0$ (absent).\n    - Amphibian: $0$ (absent).\n    - Reptile: $0$ (absent).\n    - Cynodont: $0$ (absent, \"no fully detached... ossicles\").\n    - Monotreme: $1$ (present).\n    - Therian: $1$ (present).\n\n- **Fitch Algorithm for $C_{M}$:**\n    1.  **Node $N_{1}$:** $S_{Monotreme}=\\{1\\}$, $S_{Therian}=\\{1\\}$. Intersection is $\\{1\\}$. $S_{N_{1}}=\\{1\\}$. Steps = $0$.\n    2.  **Node $N_{2}$:** $S_{Cynodont}=\\{0\\}$, $S_{N_{1}}=\\{1\\}$. Intersection is empty. $S_{N_{2}} = \\{0\\} \\cup \\{1\\} = \\{0,1\\}$. Steps = $1$.\n    3.  **Node $N_{3}$:** $S_{Reptile}=\\{0\\}$, $S_{N_{2}}=\\{0,1\\}$. Intersection is $\\{0\\}$. $S_{N_{3}}=\\{0\\}$. Steps remain $1$.\n    4.  **Node $N_{4}$:** $S_{Amphibian}=\\{0\\}$, $S_{N_{3}}=\\{0\\}$. Intersection is $\\{0\\}$. $S_{N_{4}}=\\{0\\}$. Steps remain $1$.\n    5.  **Root Node:** $S_{Actinopterygian}=\\{0\\}$, $S_{N_{4}}=\\{0\\}$. Intersection is $\\{0\\}$. $S_{Root}=\\{0\\}$. Steps remain $1$.\nThe minimum number of steps for $C_{M}$ is $1$. This step represents the neomorphic origin of the malleus-incus complex.\n\nThe total parsimony score for hypothesis $H_{2}$ is the sum of the scores for the two characters:\n$s_{H_{2}} = \\text{score}(C_{A}) + \\text{score}(C_{M}) = 1 + 1 = 2$.\n\n**Final Result**\nThe minimum number of steps required under the homology hypothesis is $s_{H_{1}} = 1$. The minimum number of steps required under the non-homology hypothesis is $s_{H_{2}} = 2$. The problem asks for the result as a row matrix $$\\begin{pmatrix} s_{H_{1}}  s_{H_{2}} \\end{pmatrix}$$.\nSubstituting the calculated values, we obtain the final matrix.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1  2\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Evidence for evolution is not only found in new structures but also in the remnants of those that are no longer functional. This exercise explores vestigiality at the molecular level through the concept of pseudogenization, where a gene loses its function and decays over evolutionary time . You will apply the ratio of nonsynonymous to synonymous substitution rates ($d_N/d_S$), a cornerstone technique in molecular evolution, to quantify the signature of lost function in a vision gene and distinguish neutral decay from ongoing selective constraint.",
            "id": "2706009",
            "problem": "A single-copy long-wavelength-sensitive opsin coding sequence from $6$ primate species (four Haplorhini with intact vision genes and two Strepsirrhini, of which one is a nocturnal species with evidence of loss-of-function mutations) is aligned without gaps relative to the inferred ancestral reading frame. Orthology is supported by conserved exon–intron structure and synteny (homology), and the nocturnal strepsirrhine lineage shows a frameshift and two premature stop codons consistent with vestigialization (pseudogenization). For the coding region of length $L$ codons, the codon-degeneracy analysis yields a total of $S = 300$ synonymous sites and $N = 600$ nonsynonymous sites (so $S+N=900$ nucleotide sites) that are comparable across lineages.\n\nA maximum parsimony (MP) reconstruction of changes mapped onto the species tree identifies substitutions uniquely occurring on the branch leading to the nocturnal strepsirrhine lineage after its split from its closest sampled relative. On this branch, there are $D_{S} = 60$ synonymous differences and $D_{N} = 120$ nonsynonymous differences. For the set of other branches leading to species with intact genes, the aggregate mapping shows a strong excess of synonymous over nonsynonymous changes, consistent with purifying selection (data provided for context only; you are not required to compute ratios for those branches).\n\nUsing the standard framework in which the observed proportions of synonymous and nonsynonymous differences per site are corrected for multiple hits under the Jukes–Cantor model as in the Nei–Gojobori approach, compute the ratio of the nonsynonymous to synonymous substitution rates, $d_{N}/d_{S}$ (often denoted $\\omega$), specifically for the nocturnal strepsirrhine branch. Then, based on first principles of how $\\omega$ behaves under purifying selection, neutrality, and positive selection, reason whether the calculated value is more consistent with pseudogenization (neutral evolution following loss of function) or merely relaxed constraint without complete loss of function. Do not assume any shortcut formulas beyond the standard correction and definitions.\n\nReport the numerical value of $d_{N}/d_{S}$ for the nocturnal strepsirrhine branch as a pure number with no units, rounded to $3$ significant figures.",
            "solution": "The problem statement has been subjected to a strict validation process.\n\n**Step 1: Extracted Givens**\n- Sequence type: single-copy long-wavelength-sensitive opsin coding sequence.\n- Species: $6$ primates.\n- Total synonymous sites: $S = 300$.\n- Total nonsynonymous sites: $N = 600$.\n- Analysis is for the branch leading to a nocturnal strepsirrhine lineage.\n- Synonymous differences on this branch: $D_{S} = 60$.\n- Nonsynonymous differences on this branch: $D_{N} = 120$.\n- Correction model: Jukes-Cantor model, as in the Nei-Gojobori approach.\n- Required computation: The ratio $\\omega = d_{N}/d_{S}$.\n- Required interpretation: Whether the value of $\\omega$ is more consistent with pseudogenization or relaxed constraint.\n- Required output format: Numerical value rounded to $3$ significant figures.\n\n**Step 2: Validation Using Extracted Givens**\n- **Scientifically Grounded:** The problem is based on fundamental and standard principles of molecular phylogenetics and evolutionary genetics, specifically the analysis of selective pressures on protein-coding genes. The concepts of synonymous ($S$) and nonsynonymous ($N$) sites, substitutions ($d_S$, $d_N$), the Jukes-Cantor correction, and the interpretation of the $\\omega$ ratio are all central to the field. The biological context (pseudogenization of a vision gene in a nocturnal animal) is a classic, well-documented evolutionary phenomenon.\n- **Well-Posed:** All necessary data ($S, N, D_S, D_N$) are provided. The methodology is clearly specified (Nei-Gojobori with Jukes-Cantor correction). The question is unambiguous and leads to a unique, derivable solution.\n- **Objective:** The problem is stated using precise, quantitative language and is free of subjective or non-scientific claims.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, well-posed, and objective. It contains no logical contradictions, ambiguities, or factual errors. Therefore, the problem is deemed **valid**. A full solution will be provided.\n\nThe task is to compute the ratio of the nonsynonymous substitution rate ($d_N$) to the synonymous substitution rate ($d_S$), denoted by $\\omega$, for a specific lineage and to interpret the result in the context of molecular evolution.\n\nFirst, we compute the observed proportion of synonymous differences ($p_S$) and nonsynonymous differences ($p_N$) on the branch leading to the nocturnal strepsirrhine. These proportions are the number of observed differences divided by the total number of available sites in each category.\n\nThe given values are:\nNumber of synonymous sites, $S = 300$.\nNumber of synonymous differences, $D_S = 60$.\nNumber of nonsynonymous sites, $N = 600$.\nNumber of nonsynonymous differences, $D_N = 120$.\n\nThe proportion of synonymous differences is:\n$$ p_S = \\frac{D_S}{S} = \\frac{60}{300} = 0.2 $$\nThe proportion of nonsynonymous differences is:\n$$ p_N = \\frac{D_N}{N} = \\frac{120}{600} = 0.2 $$\n\nNext, these observed proportions must be corrected for multiple substitutions at the same site, which are not directly observable. The problem specifies the use of the Jukes-Cantor (JC69) model for this correction. The JC69 formula estimates the number of substitutions per site, $d$, from the observed proportion of different sites, $p$, as:\n$$ d = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}p\\right) $$\nThis formula is applied independently to both the synonymous and nonsynonymous categories.\n\nThe corrected rate of synonymous substitutions per synonymous site, $d_S$, is:\n$$ d_S = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}p_S\\right) = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}(0.2)\\right) $$\nThe corrected rate of nonsynonymous substitutions per nonsynonymous site, $d_N$, is:\n$$ d_N = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}p_N\\right) = -\\frac{3}{4} \\ln\\left(1 - \\frac{4}{3}(0.2)\\right) $$\n\nBecause the proportions of differences are identical ($p_S = p_N = 0.2$), the application of the same correction function to both must yield identical corrected rates:\n$$ d_S = d_N $$\n\nThe ratio $\\omega = d_N/d_S$ is therefore:\n$$ \\omega = \\frac{d_N}{d_S} = 1 $$\nWhen rounded to $3$ significant figures as requested, the value is $1.00$.\n\nNow for the interpretation. The ratio $\\omega = d_N/d_S$ is a critical indicator of the selective pressure acting on a protein-coding gene. The theoretical expectations for $\\omega$ are as follows:\n- $\\omega  1$: Purifying (negative) selection. Nonsynonymous mutations are deleterious and are removed by selection, leading to a lower rate of nonsynonymous substitution compared to synonymous (neutral) substitution. This is an indicator of functional constraint.\n- $\\omega \\approx 1$: Neutral evolution. There is no selective pressure on the protein sequence. Nonsynonymous mutations are neither favored nor disfavored and accumulate at the same rate as synonymous mutations. This is the definitive signature of a pseudogene or a gene that has completely lost its function.\n- $\\omega  1$: Positive (diversifying) selection. Nonsynonymous mutations are advantageous and are fixed by selection at a higher rate than synonymous mutations. This is an indicator of adaptive evolution.\n\nThe calculated value for the nocturnal strepsirrhine branch is $\\omega = 1.00$. This result is perfectly consistent with the hypothesis of neutral evolution. The biological context provides strong evidence for this: the opsin gene is in a nocturnal species (where color vision is less critical) and shows molecular evidence of being non-functional (frameshift, stop codons), i.e., it is a pseudogene. In a pseudogene, the selective constraint to maintain a specific amino acid sequence is lost. Consequently, nonsynonymous mutations are no longer deleterious and accumulate at the neutral rate, which is the same as the rate for synonymous mutations. Hence, $d_N$ becomes equal to $d_S$, and $\\omega$ is expected to be $1$.\n\nThe alternative interpretation, 'merely relaxed constraint without complete loss of function,' would imply that selection is weaker but not absent. This would lead to a value of $\\omega$ greater than what is observed under strong constraint but still significantly less than $1$. The observed value of $\\omega = 1.00$ is strong evidence for complete loss of function and subsequent pseudogenization, not simply relaxed constraint.",
            "answer": "$$ \\boxed{1.00} $$"
        },
        {
            "introduction": "In modern evolutionary biology, a robust case for homology is built upon a consilience of evidence from disparate sources, including morphology, gene expression, and genomic context. This final practice introduces a powerful integrative approach using a Bayesian framework to formally combine these different data types . By building a probabilistic classifier, you will learn how to quantitatively weigh diverse lines of evidence to compute the posterior probability of homology ($P(H \\mid \\text{data})$), reflecting the sophisticated, evidence-based nature of contemporary evolutionary inference.",
            "id": "2706019",
            "problem": "Construct a program that implements a principled Bayesian classifier to estimate the posterior probability of homology for a pair of biological structures using three evidence modalities: binary morphological character matches, a normalized gene expression similarity score, and a synteny count of conserved neighboring genes. The program must be derived from fundamental definitions of homology and probability theory, and must be implementable without specialized domain databases.\n\nBase assumptions and model components:\n1. Two mutually exclusive hypotheses are considered: homology ($H$) versus non-homology resulting in analogy or convergence ($A$). The prior probability of homology is $P(H) = \\pi$, with $P(A) = 1 - \\pi$.\n2. Conditional on the hypothesis, the three evidence modalities are treated as conditionally independent:\n   - Morphological characters: there are $n$ independent binary characters whose states in the two taxa are scored as matching or not. Let $m$ denote the number of matches. Under hypothesis $X \\in \\{H,A\\}$, the match probability is $p_X \\sim \\mathrm{Beta}(\\alpha_X, \\beta_X)$, and matches arise as $m \\mid n, p_X \\sim \\mathrm{Binomial}(n, p_X)$.\n   - Gene expression similarity: the normalized similarity score $s \\in (0,1)$ is modeled under hypothesis $X \\in \\{H,A\\}$ as $s \\sim \\mathrm{Beta}(\\alpha_{S,X}, \\beta_{S,X})$.\n   - Synteny: the number of shared neighboring genes $k \\in \\{0,1,2,\\dots\\}$ is modeled under hypothesis $X \\in \\{H,A\\}$ as $k \\sim \\mathrm{Poisson}(\\lambda_X)$.\n\nFundamental base:\n- Use Bayes’ theorem from probability theory to derive the posterior $P(H \\mid \\text{data})$ from the prior and the likelihoods implied by the above generative assumptions.\n- Use the standard definitions of the Beta, Binomial, and Poisson families and their conjugacy where appropriate.\n\nHyperparameters to use:\n- Prior: $\\pi = 0.3$.\n- Morphology (match probability priors): $\\alpha_H = 8$, $\\beta_H = 2$; $\\alpha_A = 3$, $\\beta_A = 7$.\n- Gene expression similarity (Beta parameters): $\\alpha_{S,H} = 12$, $\\beta_{S,H} = 4$; $\\alpha_{S,A} = 4$, $\\beta_{S,A} = 12$.\n- Synteny (Poisson rates): $\\lambda_H = 5.0$, $\\lambda_A = 1.2$.\n\nData representation for a single case:\n- A quadruple $(n, m, s, k)$ with $n \\in \\mathbb{Z}_{\\ge 0}$, $m \\in \\{0,1,\\dots,n\\}$, $s \\in (0,1)$, $k \\in \\mathbb{Z}_{\\ge 0}$.\n\nTask:\n- For each test case, compute the posterior probability $P(H \\mid n, m, s, k)$ implied by the above model, expressing the final result as a real number in $[0,1]$.\n\nMathematical requirements:\n- Your program must compute the marginal likelihood for morphology by integrating out $p_X$ under the $\\mathrm{Beta}(\\alpha_X,\\beta_X)$ prior, the Beta density for $s$ under the appropriate $(\\alpha_{S,X}, \\beta_{S,X})$, and the Poisson mass for $k$ under $\\lambda_X$. Combine these under the assumption of conditional independence to obtain the likelihood under $H$ and under $A$, and then apply Bayes’ theorem to obtain the posterior.\n- All intermediate calculations must be numerically stable and must obey the standard definitions of the Beta function and the Gamma function. You may use logarithms to ensure numerical stability, but the final posterior must be returned on the probability scale.\n\nTest suite:\n- Use the following $6$ test cases, each a quadruple $(n, m, s, k)$:\n  1. $(20, 16, 0.78, 6)$\n  2. $(25, 20, 0.20, 2)$\n  3. $(15, 6, 0.60, 7)$\n  4. $(0, 0, 0.50, 0)$\n  5. $(10, 7, 0.999999, 4)$\n  6. $(10, 3, 0.000001, 0)$\n\nAnswer specification and output format:\n- For each test case, output the posterior probability $P(H \\mid n, m, s, k)$ as a float rounded to $6$ decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test cases, for example: $[x_1,x_2,\\dots,x_6]$ where each $x_i$ is a float with exactly $6$ digits after the decimal point.\n- No physical units apply to this problem.",
            "solution": "The problem requires the construction of a Bayesian classifier to determine the posterior probability of homology, $P(H \\mid \\text{data})$, given evidence from three conditionally independent sources: morphology, gene expression, and synteny. The data for a given case is a quadruple $D = (n, m, s, k)$. We are to evaluate two mutually exclusive hypotheses: $H$ (homology) and $A$ (analogy/convergence).\n\nAccording to Bayes' theorem, the posterior probability of homology is given by:\n$$ P(H \\mid D) = \\frac{P(D \\mid H) P(H)}{P(D)} $$\nThe denominator, $P(D)$, is the marginal likelihood of the data, which is obtained by the law of total probability:\n$$ P(D) = P(D \\mid H) P(H) + P(D \\mid A) P(A) $$\nThe prior probabilities are given as $P(H) = \\pi = 0.3$ and $P(A) = 1 - \\pi = 0.7$. Substituting the marginal likelihood expression into the posterior formula yields:\n$$ P(H \\mid D) = \\frac{P(D \\mid H) P(H)}{P(D \\mid H) P(H) + P(D \\mid A) P(A)} $$\nThis can be rewritten in terms of the likelihood ratio, which is often more convenient for computation:\n$$ P(H \\mid D) = \\left(1 + \\frac{P(D \\mid A) P(A)}{P(D \\mid H) P(H)}\\right)^{-1} $$\nThe problem states that the three evidence modalities (morphology $D_m = \\{n, m\\}$, gene expression $D_s = \\{s\\}$, and synteny $D_k = \\{k\\}$) are conditionally independent given the hypothesis $X \\in \\{H, A\\}$. Therefore, the total likelihood $P(D \\mid X)$ is the product of the individual likelihoods:\n$$ P(D \\mid X) = P(D_m \\mid X) \\cdot P(D_s \\mid X) \\cdot P(D_k \\mid X) $$\nWe must derive the expression for each of these likelihood components.\n\n1.  **Morphological Likelihood $P(D_m \\mid X)$**:\n    The model specifies a Beta-Binomial process. The probability of a morphological character match, $p_X$, is drawn from a Beta distribution, $p_X \\sim \\mathrm{Beta}(\\alpha_X, \\beta_X)$. Given $p_X$, the number of matches $m$ in $n$ characters follows a Binomial distribution, $m \\mid n, p_X \\sim \\mathrm{Binomial}(n, p_X)$.\n    To find the marginal likelihood $P(m, n \\mid X)$, we must integrate out the unknown parameter $p_X$:\n    $$ P(m, n \\mid X) = \\int_0^1 P(m \\mid n, p_X) P(p_X \\mid \\alpha_X, \\beta_X) \\, dp_X $$\n    Substituting the probability mass function of the Binomial distribution and the probability density function of the Beta distribution:\n    $$ P(m, n \\mid X) = \\int_0^1 \\left[ \\binom{n}{m} p_X^m (1-p_X)^{n-m} \\right] \\left[ \\frac{p_X^{\\alpha_X-1} (1-p_X)^{\\beta_X-1}}{B(\\alpha_X, \\beta_X)} \\right] \\, dp_X $$\n    where $B(a,b)$ is the Beta function. Rearranging terms:\n    $$ P(m, n \\mid X) = \\frac{\\binom{n}{m}}{B(\\alpha_X, \\beta_X)} \\int_0^1 p_X^{m+\\alpha_X-1} (1-p_X)^{n-m+\\beta_X-1} \\, dp_X $$\n    The integral is the definition of $B(m+\\alpha_X, n-m+\\beta_X)$. Thus, the marginal likelihood is:\n    $$ P(m, n \\mid X) = \\binom{n}{m} \\frac{B(m+\\alpha_X, n-m+\\beta_X)}{B(\\alpha_X, \\beta_X)} $$\n\n2.  **Gene Expression Likelihood $P(D_s \\mid X)$**:\n    The similarity score $s$ is modeled as a draw from a Beta distribution, $s \\mid X \\sim \\mathrm{Beta}(\\alpha_{S,X}, \\beta_{S,X})$. The likelihood is simply the value of the probability density function at $s$:\n    $$ P(s \\mid X) = \\frac{s^{\\alpha_{S,X}-1} (1-s)^{\\beta_{S,X}-1}}{B(\\alpha_{S,X}, \\beta_{S,X})} $$\n\n3.  **Synteny Likelihood $P(D_k \\mid X)$**:\n    The count of shared neighboring genes $k$ is modeled as a draw from a Poisson distribution, $k \\mid X \\sim \\mathrm{Poisson}(\\lambda_X)$. The likelihood is the value of the probability mass function at $k$:\n    $$ P(k \\mid X) = \\frac{\\lambda_X^k e^{-\\lambda_X}}{k!} $$\n\nTo ensure numerical stability when computing the posterior, particularly with products of small probabilities, it is standard practice to work with log-probabilities. Let $L_X = \\log P(D \\mid X)$.\n$$ L_X = \\log P(m, n \\mid X) + \\log P(s \\mid X) + \\log P(k \\mid X) $$\nUsing the definitions of the Beta and Gamma functions ($B(a,b) = \\frac{\\Gamma(a)\\Gamma(b)}{\\Gamma(a+b)}$, $\\binom{n}{m} = \\frac{n!}{m!(n-m)!}$, and $k! = \\Gamma(k+1)$), we can express the log-likelihoods in terms of the log-gamma function, $\\log \\Gamma(z)$, which is numerically robust.\n\n1.  **Log-Likelihood for Morphology**:\n    $$ \\log P(m,n \\mid X) = \\log\\Gamma(n+1) - \\log\\Gamma(m+1) - \\log\\Gamma(n-m+1) + \\log B(m+\\alpha_X, n-m+\\beta_X) - \\log B(\\alpha_X, \\beta_X) $$\n    where $\\log B(a,b) = \\log\\Gamma(a) + \\log\\Gamma(b) - \\log\\Gamma(a+b)$.\n\n2.  **Log-Likelihood for Gene Expression**:\n    $$ \\log P(s \\mid X) = (\\alpha_{S,X}-1)\\log(s) + (\\beta_{S,X}-1)\\log(1-s) - \\log B(\\alpha_{S,X}, \\beta_{S,X}) $$\n\n3.  **Log-Likelihood for Synteny**:\n    $$ \\log P(k \\mid X) = k\\log(\\lambda_X) - \\lambda_X - \\log\\Gamma(k+1) $$\n\nWith these log-likelihoods, we calculate the total log-likelihoods $L_H$ and $L_A$. The posterior probability can then be computed stably using the log-odds formulation. Define the log-ratio of the posterior probabilities:\n$$ R = \\log\\left(\\frac{P(A \\mid D)}{P(H \\mid D)}\\right) = \\log\\left(\\frac{P(D \\mid A) P(A)}{P(D \\mid H) P(H)}\\right) = L_A - L_H + \\log(P(A)) - \\log(P(H)) $$\nThe desired posterior $P(H \\mid D)$ is then given by the logistic (sigmoid) function of $-R$:\n$$ P(H \\mid D) = \\frac{1}{1 + e^R} $$\nThe program below implements this derivation using the provided hyperparameters and test cases. It uses functions from `scipy.special` for robust computation of log-gamma and log-beta functions.\nThe hyperparameters are:\n-   Prior: $\\pi = 0.3$.\n-   Morphology: $H \\to \\{\\alpha_H=8, \\beta_H=2\\}$, $A \\to \\{\\alpha_A=3, \\beta_A=7\\}$.\n-   Gene Expression: $H \\to \\{\\alpha_{S,H}=12, \\beta_{S,H}=4\\}$, $A \\to \\{\\alpha_{S,A}=4, \\beta_{S,A}=12\\}$.\n-   Synteny: $H \\to \\{\\lambda_H=5.0\\}$, $A \\to \\{\\lambda_A=1.2\\}$.\nThe implementation will encapsulate this entire logic to compute the posterior for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import gammaln, betaln\n\ndef solve():\n    \"\"\"\n    Computes the posterior probability of homology for a series of test cases\n    based on a Bayesian model with morphological, gene expression, and synteny evidence.\n    \"\"\"\n\n    # --- Hyperparameters ---\n    # Prior probability of homology H\n    pi_H = 0.3\n    pi_A = 1.0 - pi_H\n    log_pi_H = np.log(pi_H)\n    log_pi_A = np.log(pi_A)\n\n    # Morphology parameters (Beta-Binomial)\n    alpha_H, beta_H = 8, 2\n    alpha_A, beta_A = 3, 7\n\n    # Gene expression parameters (Beta)\n    alpha_S_H, beta_S_H = 12, 4\n    alpha_S_A, beta_S_A = 4, 12\n\n    # Synteny parameters (Poisson)\n    lambda_H = 5.0\n    lambda_A = 1.2\n\n    # --- Test Cases ---\n    test_cases = [\n        (20, 16, 0.78, 6),\n        (25, 20, 0.20, 2),\n        (15, 6, 0.60, 7),\n        (0, 0, 0.50, 0),\n        (10, 7, 0.999999, 4),\n        (10, 3, 0.000001, 0)\n    ]\n\n    def calculate_log_likelihood(n, m, s, k, alpha_X, beta_X, alpha_S_X, beta_S_X, lambda_X):\n        \"\"\"\n        Calculates the total log-likelihood for a given hypothesis X.\n        \"\"\"\n        # 1. Morphological Log-Likelihood (Beta-Binomial)\n        # log(binom(n, m)) + log(B(m+a, n-m+b)) - log(B(a, b))\n        # log(binom(n, m)) = gammaln(n+1) - gammaln(m+1) - gammaln(n-m+1)\n        if n > 0 or m > 0: # n=0, m=0 gives log-likelihood of 0\n             log_L_morph = (gammaln(n + 1) - gammaln(m + 1) - gammaln(n - m + 1) +\n                           betaln(m + alpha_X, n - m + beta_X) -\n                           betaln(alpha_X, beta_X))\n        else: # n=0, m=0 case. No data, so likelihood is 1, log-likelihood is 0.\n            log_L_morph = 0.0\n\n        # 2. Gene Expression Log-Likelihood (Beta)\n        # (a-1)log(s) + (b-1)log(1-s) - log(B(a, b))\n        log_L_expr = ((alpha_S_X - 1) * np.log(s) +\n                      (beta_S_X - 1) * np.log(1.0 - s) -\n                      betaln(alpha_S_X, beta_S_X))\n\n        # 3. Synteny Log-Likelihood (Poisson)\n        # k*log(lambda) - lambda - log(k!)\n        log_L_synteny = (k * np.log(lambda_X) - lambda_X - gammaln(k + 1))\n\n        return log_L_morph + log_L_expr + log_L_synteny\n\n    results = []\n    for case in test_cases:\n        n, m, s, k = case\n\n        # Calculate log-likelihoods for H (Homology) and A (Analogy)\n        log_likelihood_H = calculate_log_likelihood(n, m, s, k, alpha_H, beta_H, alpha_S_H, beta_S_H, lambda_H)\n        log_likelihood_A = calculate_log_likelihood(n, m, s, k, alpha_A, beta_A, alpha_S_A, beta_S_A, lambda_A)\n        \n        # Combine with log priors to get unnormalized log posteriors\n        log_posterior_unnorm_H = log_likelihood_H + log_pi_H\n        log_posterior_unnorm_A = log_likelihood_A + log_pi_A\n\n        # Calculate the log-odds ratio of A vs H for numerical stability\n        # R = log(P(A|D)/P(H|D)) = log_posterior_unnorm_A - log_posterior_unnorm_H\n        # P(H|D) = 1 / (1 + exp(R))\n        if log_posterior_unnorm_H > log_posterior_unnorm_A:\n            # More stable calculation when H is more probable\n            log_ratio = log_posterior_unnorm_A - log_posterior_unnorm_H\n            posterior_H = 1.0 / (1.0 + np.exp(log_ratio))\n        else:\n            # More stable calculation when A is more probable\n            log_ratio = log_posterior_unnorm_H - log_posterior_unnorm_A\n            posterior_H = np.exp(log_ratio) / (1.0 + np.exp(log_ratio))\n\n        results.append(posterior_H)\n\n    # Format output as specified\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}