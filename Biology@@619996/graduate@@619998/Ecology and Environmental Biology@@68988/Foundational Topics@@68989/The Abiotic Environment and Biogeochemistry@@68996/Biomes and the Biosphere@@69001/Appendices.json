{"hands_on_practices": [{"introduction": "Understanding a biome's role in the global carbon cycle requires a precise accounting of all carbon fluxes. This exercise [@problem_id:2473755] walks you through the crucial derivation of Net Biome Production ($NBP$) from Net Ecosystem Production ($NEP$) by incorporating losses from disturbances like fire and harvest. This practice will solidify your understanding of the complete carbon mass balance, which is essential for determining if a biome is a true net sink or source of carbon.", "problem": "In terrestrial carbon accounting, the control volume for a forest biome is commonly taken to include all live biomass, dead organic matter, and soils within the ecosystem boundary. Starting from the conservation of mass for carbon and core ecosystem definitions, derive how atmospheric disturbance emissions and lateral carbon fluxes transform Net Ecosystem Production (NEP) into Net Biome Production (NBP). Specifically, begin with the definitions of Gross Primary Production (GPP), autotrophic respiration, and heterotrophic respiration, and construct a mass balance that yields an expression for NBP as a function of NEP, direct atmospheric carbon emissions from disturbance within the control volume, and net lateral carbon transport across the ecosystem boundary. Clearly state how harvested material and fire emissions are categorized within this mass balance.\n\nThen, use your derived expression to compute the NBP of a managed temperate forest given the following annual, area-normalized fluxes:\n- Gross Primary Production (GPP): $2250 \\ \\text{g C m}^{-2} \\text{ yr}^{-1}$.\n- Autotrophic respiration ($R_{\\mathrm{a}}$): $955 \\ \\text{g C m}^{-2} \\text{ yr}^{-1}$.\n- Heterotrophic respiration ($R_{\\mathrm{h}}$): $895 \\ \\text{g C m}^{-2} \\text{ yr}^{-1}$.\n- Direct atmospheric carbon emission from a mean-annualized fire regime within the control volume: $70 \\ \\text{g C m}^{-2} \\text{ yr}^{-1}$.\n- Timber harvest removes $H_{\\mathrm{gross}} = 180 \\ \\text{g C m}^{-2} \\text{ yr}^{-1}$ of biomass C from the stand; a fraction $f_{\\mathrm{off}} = 0.65$ leaves the ecosystem boundary as wood products, while the remainder is left on site as slash and is already represented in measured heterotrophic respiration.\n- Hydrologic lateral export of dissolved and particulate organic carbon across the ecosystem boundary: $28 \\ \\text{g C m}^{-2} \\text{ yr}^{-1}$.\n- Hydrologic lateral import of organic carbon across the ecosystem boundary from upslope inflow: $6 \\ \\text{g C m}^{-2} \\text{ yr}^{-1}$.\n\nAssume that Net Ecosystem Production is defined as $ \\mathrm{NEP} = \\mathrm{GPP} - R_{\\mathrm{a}} - R_{\\mathrm{h}} $, that slash decomposition is included in $R_{\\mathrm{h}}$, and that all fluxes are temporally averaged to be commensurate on the annual timescale.\n\nReport the NBP as a single number in $\\text{g C m}^{-2} \\text{ yr}^{-1}$. Round your final answer to three significant figures. Express the final answer in $\\text{g C m}^{-2} \\text{ yr}^{-1}$.", "solution": "The derivation and solution proceed from the principle of conservation of mass for carbon within the defined ecosystem control volume. The net rate of change of carbon stock within the biome, which is defined as Net Biome Production ($\\mathrm{NBP}$), is equal to the sum of all carbon inputs minus the sum of all carbon outputs.\n\nLet $C$ be the total carbon stock in the ecosystem control volume (live biomass, dead organic matter, soil). Then, by definition:\n$$ \\mathrm{NBP} = \\frac{dC}{dt} $$\nThe fluxes of carbon into and out of the control volume are categorized as follows:\n1.  Fluxes to/from the atmosphere:\n    - Input: Gross Primary Production ($\\mathrm{GPP}$), the uptake of atmospheric $\\mathrm{CO}_2$ via photosynthesis.\n    - Output: Ecosystem Respiration ($R_{\\mathrm{eco}}$), which is the sum of autotrophic respiration ($R_{\\mathrm{a}}$) and heterotrophic respiration ($R_{\\mathrm{h}}$).\n    - Output: Direct emissions from disturbances, such as fire ($F_{\\mathrm{fire}}$).\n2.  Lateral fluxes across the ecosystem boundary:\n    - Input: Lateral transport into the ecosystem, such as hydrologic import ($F_{\\mathrm{hydro,in}}$).\n    - Output: Lateral transport out of the ecosystem, including removal of harvested materials ($F_{\\mathrm{harvest,export}}$) and hydrologic export ($F_{\\mathrm{hydro,out}}$).\n\nThe comprehensive mass balance equation is thus:\n$$ \\mathrm{NBP} = \\frac{dC}{dt} = \\mathrm{GPP} - R_{\\mathrm{a}} - R_{\\mathrm{h}} - F_{\\mathrm{fire}} - F_{\\mathrm{harvest,export}} - F_{\\mathrm{hydro,out}} + F_{\\mathrm{hydro,in}} $$\nThe problem defines Net Ecosystem Production ($\\mathrm{NEP}$) as the net carbon exchange with the atmosphere resulting only from biological processes:\n$$ \\mathrm{NEP} = \\mathrm{GPP} - R_{\\mathrm{a}} - R_{\\mathrm{h}} $$\nSubstituting the definition of $\\mathrm{NEP}$ into the mass balance equation yields the relationship between $\\mathrm{NBP}$ and $\\mathrm{NEP}$:\n$$ \\mathrm{NBP} = \\mathrm{NEP} - F_{\\mathrm{fire}} - F_{\\mathrm{harvest,export}} - F_{\\mathrm{hydro,out}} + F_{\\mathrm{hydro,in}} $$\nThis expression shows that $\\mathrm{NBP}$ is the $\\mathrm{NEP}$ adjusted for non-biological atmospheric emissions (disturbances) and net lateral transport of carbon. Let us define the net lateral carbon transport, $F_{\\mathrm{lateral,net}}$, as the sum of all lateral outputs minus lateral inputs. Further, we can define a total disturbance flux, $F_{\\mathrm{D}}$, as the sum of all non-respiratory losses. In this problem, $F_{\\mathrm{D}}$ includes fire emissions and net lateral transport.\n$$ \\mathrm{NBP} = \\mathrm{NEP} - F_{\\mathrm{fire}} - (F_{\\mathrm{harvest,export}} + F_{\\mathrm{hydro,out}} - F_{\\mathrm{hydro,in}}) $$\nThis is the required derived relationship.\n\nThe provided flux categories are assigned as follows:\n- Fire emissions ($F_{\\mathrm{fire}}$) are a direct atmospheric carbon loss.\n- Harvested material that leaves the ecosystem is a lateral carbon loss. The magnitude is $F_{\\mathrm{harvest,export}} = H_{\\mathrm{gross}} \\times f_{\\mathrm{off}}$. The remaining fraction, $1 - f_{\\mathrm{off}}$, is left on site as slash. The problem correctly states that the resulting decomposition emissions are already accounted for within the $R_{\\mathrm{h}}$ term, preventing double-counting.\n- Hydrologic export ($F_{\\mathrm{hydro,out}}$) and import ($F_{\\mathrm{hydro,in}}$) are lateral fluxes.\n\nNow, we compute the numerical value for $\\mathrm{NBP}$.\nFirst, calculate $\\mathrm{NEP}$:\n$$ \\mathrm{NEP} = \\mathrm{GPP} - R_{\\mathrm{a}} - R_{\\mathrm{h}} $$\n$$ \\mathrm{NEP} = 2250 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} - 955 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} - 895 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} $$\n$$ \\mathrm{NEP} = 2250 - 1850 = 400 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} $$\nNext, calculate the lateral harvest export flux:\n$$ F_{\\mathrm{harvest,export}} = H_{\\mathrm{gross}} \\times f_{\\mathrm{off}} = 180 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} \\times 0.65 = 117 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} $$\nFinally, substitute all values into the derived expression for $\\mathrm{NBP}$:\n$$ \\mathrm{NBP} = \\mathrm{NEP} - F_{\\mathrm{fire}} - F_{\\mathrm{harvest,export}} - F_{\\mathrm{hydro,out}} + F_{\\mathrm{hydro,in}} $$\n$$ \\mathrm{NBP} = 400 - 70 - 117 - 28 + 6 $$\nAll terms are in units of $\\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$.\n$$ \\mathrm{NBP} = 400 - (70 + 117 + 28 - 6) $$\n$$ \\mathrm{NBP} = 400 - (187 + 22) $$\n$$ \\mathrm{NBP} = 400 - 209 $$\n$$ \\mathrm{NBP} = 191 \\, \\frac{\\mathrm{g \\, C}}{\\mathrm{m^2 \\, yr}} $$\nThe result $191$ has three significant figures, which satisfies the rounding requirement. This positive value indicates that the forest ecosystem, despite disturbances and management, is a net sink for carbon at a rate of $191 \\, \\mathrm{g \\, C \\, m^{-2} \\, yr^{-1}}$.", "answer": "$$\\boxed{191}$$", "id": "2473755"}, {"introduction": "With the carbon accounting framework established, we now tackle the practical challenge of quantifying its key biological components. This computational practice [@problem_id:2473798] simulates a core task for ecosystem scientists: analyzing data from eddy covariance towers. You will use a standard temperature-response model to partition the measured net $\\mathrm{CO}_2$ flux into its two constituent parts, Gross Primary Production ($GPP$) and ecosystem Respiration ($R$), giving you hands-on experience with the data analysis that underpins our understanding of ecosystem metabolism.", "problem": "You are given short, synthetic, but physically plausible eddy covariance time series for eight equally spaced samples over a $24$ hour period for each of three contrasting biomes. For each sample, the vertical $\\mathrm{CO}_{2}$ flux $F_{\\mathrm{CO2}}$ (positive upward to the atmosphere) and canopy air temperature $T$ are provided, along with a Boolean flag that indicates whether the sample occurred during nighttime. The time step is uniform within each case and equal to $10800$ s so that the eight samples cover an exact day. The goal is to derive Net Ecosystem Production (NEP) by partitioning $F_{\\mathrm{CO2}}$ into Gross Primary Production (GPP) and ecosystem respiration $R$ using only the nighttime temperature response model and then reconstruct NEP across the full diurnal period.\n\nFundamental definitions and assumptions to use:\n- Mass balance of ecosystem $\\mathrm{CO}_{2}$ exchange under the eddy covariance sign convention (positive upward): $F_{\\mathrm{CO2}}(t) = R(t) - \\mathrm{GPP}(t)$.\n- Definition of Net Ecosystem Production (NEP): $\\mathrm{NEP}(t) = \\mathrm{GPP}(t) - R(t)$. Thus, positive $\\mathrm{NEP}$ indicates net carbon uptake by the ecosystem.\n- At night, $\\mathrm{GPP}(t) = 0$ so that $F_{\\mathrm{CO2}}(t) = R(t)$ for nighttime samples.\n- Temperature response of ecosystem respiration: $R(T) = R_{0}\\, Q_{10}^{(T - 10)/10}$, where $R_{0}$ is respiration at $T = 10\\,^{\\circ}\\mathrm{C}$ and $Q_{10}$ is the temperature sensitivity factor over a $10\\,^{\\circ}\\mathrm{C}$ increase.\n\nYour tasks, for each test case separately:\n1. Use only the nighttime samples and the model $R(T) = R_{0}\\, Q_{10}^{(T - 10)/10}$ to estimate $R_{0}$ and $Q_{10}$ by ordinary least squares on the natural logarithm of nighttime fluxes. Use the natural logarithm. Exclude any nighttime samples with nonpositive $F_{\\mathrm{CO2}}$ (none occur in the provided data).\n2. Using the fitted respiration parameters, predict respiration $\\widehat{R}(t)$ at all times from the full temperature series.\n3. Partition daytime fluxes into photosynthesis by computing $\\widehat{\\mathrm{GPP}}(t) = \\max(\\widehat{R}(t) - F_{\\mathrm{CO2}}(t), 0)$ for daytime samples and enforce $\\widehat{\\mathrm{GPP}}(t) = 0$ for nighttime samples.\n4. Compute instantaneous $\\mathrm{NEP}(t) = \\widehat{\\mathrm{GPP}}(t) - \\widehat{R}(t)$ at all times.\n5. Report two summary diagnostics:\n   - The arithmetic mean of daytime $\\widehat{\\mathrm{GPP}}(t)$ in $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$, rounded to three decimals.\n   - The $24$-hour integrated $\\mathrm{NEP}$ in $\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$ via Riemann sum over the eight samples with time step $\\Delta t = 10800$ s, using the conversion factor $12 \\times 10^{-6}\\,\\mathrm{g\\,C}$ per $\\mu\\mathrm{mol}$ of carbon. Round to three decimals.\n\nParameter estimation details:\n- Linearize the respiration model by taking natural logarithms: letting $x = (T - 10)/10$ and $y = \\ln R$, the model becomes $y = \\ln R_{0} + (\\ln Q_{10})\\, x$. Fit intercept and slope by least squares using nighttime pairs $\\{(x_{i}, \\ln F_{\\mathrm{CO2},i})\\}$.\n- Recover $R_{0} = \\exp(\\text{intercept})$ and $Q_{10} = \\exp(\\text{slope})$.\n\nUnits:\n- $F_{\\mathrm{CO2}}$ in $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$.\n- $T$ in $^{\\circ}\\mathrm{C}$.\n- Time step $\\Delta t$ in s.\n- Daytime mean $\\widehat{\\mathrm{GPP}}$ in $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$.\n- Daily integrated $\\mathrm{NEP}$ in $\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$.\n\nTest suite (three cases). For each case, arrays are length $8$ with indices $0$ to $7$, each sample separated by $\\Delta t = 10800$ s:\n\nCase 1 (temperate forest-like):\n- $T$ [$^{\\circ}\\mathrm{C}$]: [$6$, $5$, $7$, $12$, $18$, $23$, $16$, $10$]\n- $F_{\\mathrm{CO2}}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$]: [$2.274$, $2.121$, $2.437$, $-6.554$, $-10.777$, $-6.614$, $-4.453$, $3.000$]\n- is\\_night: [True, True, True, False, False, False, False, True]\n\nCase 2 (warm savanna-like):\n- $T$ [$^{\\circ}\\mathrm{C}$]: [$20$, $18$, $17$, $24$, $30$, $34$, $28$, $22$]\n- $F_{\\mathrm{CO2}}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$]: [$6.250$, $5.205$, $4.748$, $-10.985$, $-14.375$, $-2.452$, $-4.999$, $7.508$]\n- is\\_night: [True, True, True, False, False, False, False, True]\n\nCase 3 (boreal forest-like):\n- $T$ [$^{\\circ}\\mathrm{C}$]: [$0$, $-2$, $1$, $5$, $12$, $15$, $9$, $3$]\n- $F_{\\mathrm{CO2}}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$]: [$0.833$, $0.741$, $0.884$, $-2.882$, $-8.313$, $-5.988$, $-3.585$, $0.994$]\n- is\\_night: [True, True, True, False, False, False, False, True]\n\nRequired program behavior:\n- Implement the above method for each case.\n- For each case, compute and round to three decimals: $\\widehat{R}_{0}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$], $\\widehat{Q}_{10}$ [unitless], mean daytime $\\widehat{\\mathrm{GPP}}$ [$\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$], and daily integrated $\\mathrm{NEP}$ [$\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$].\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list of three inner lists (one per case), each inner list in the order [$\\widehat{R}_{0}$,$\\widehat{Q}_{10}$,mean\\_daytime\\_GPP,NEP\\_24h], all rounded to three decimals, with no spaces, e.g., \"[[r01,q101,gpp1,nep1],[r02,q102,gpp2,nep2],[r03,q103,gpp3,nep3]]\".\n- No input should be read; all data are as specified above.\n\nAnswer units:\n- Report mean daytime $\\widehat{\\mathrm{GPP}}$ in $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$ rounded to three decimals.\n- Report $24$-hour integrated $\\mathrm{NEP}$ in $\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$ rounded to three decimals.", "solution": "The task is to partition the net ecosystem $\\mathrm{CO}_2$ exchange ($F_{\\mathrm{CO2}}$) into its constituent components: ecosystem respiration ($R$) and Gross Primary Production (GPP). This is a foundational technique in biometeorology. The analysis proceeds on a case-by-case basis for three distinct biome-like datasets.\n\nThe governing equations are:\n1.  The mass balance for $\\mathrm{CO}_2$ flux: $F_{\\mathrm{CO2}}(t) = R(t) - \\mathrm{GPP}(t)$. The sign convention is positive flux upwards, away from the ecosystem surface.\n2.  Net Ecosystem Production (NEP): $\\mathrm{NEP}(t) = \\mathrm{GPP}(t) - R(t) = -F_{\\mathrm{CO2}}(t)$.\n3.  The temperature-dependent model for ecosystem respiration: $R(T) = R_{0}\\, Q_{10}^{(T - 10)/10}$. Here, $R_0$ is the base respiration rate at a reference temperature of $10\\,^{\\circ}\\mathrm{C}$, and $Q_{10}$ is the factor by which respiration rate increases for a $10\\,^{\\circ}\\mathrm{C}$ rise in temperature.\n\nThe core of the methodology lies in using nighttime data to parameterize the respiration model. During the night, photosynthesis ceases, so $\\mathrm{GPP}(t) = 0$. Consequently, the measured flux is equal to the ecosystem respiration: $F_{\\mathrm{CO2}}(t) = R(t)$ for nighttime samples. This allows for the estimation of the parameters $R_0$ and $Q_{10}$.\n\n**Step 1: Parameter Estimation for Respiration Model**\nThe exponential respiration model $R(T) = R_{0}\\, Q_{10}^{(T - 10)/10}$ is non-linear. To facilitate a linear least-squares fit, the model is transformed by taking the natural logarithm:\n$$ \\ln(R) = \\ln(R_{0}) + \\frac{T - 10}{10} \\ln(Q_{10}) $$\nThis equation is of the linear form $y = c + m x$, where:\n-   $y = \\ln(R)$\n-   $x = (T - 10)/10$\n-   The intercept $c = \\ln(R_{0})$\n-   The slope $m = \\ln(Q_{10})$\n\nFor each case, we extract the nighttime samples of temperature $T$ and flux $F_{\\mathrm{CO2}}$. We use $F_{\\mathrm{CO2}}$ as the measured value of $R$. We then compute the corresponding pairs $(x_i, y_i)$ where $x_i = (T_i - 10)/10$ and $y_i = \\ln(F_{\\mathrm{CO2},i})$. Ordinary least squares (OLS) regression is then applied to these pairs to find the optimal slope $m$ and intercept $c$. The respiration model parameters are then recovered via the inverse transformation:\n$$ \\widehat{R}_{0} = \\exp(c) $$\n$$ \\widehat{Q}_{10} = \\exp(m) $$\n\n**Step 2: Reconstruct Respiration and Partition GPP**\nWith the fitted parameters $\\widehat{R}_{0}$ and $\\widehat{Q}_{10}$, we can predict the ecosystem respiration $\\widehat{R}(t)$ at all $8$ time steps using the full temperature series $T$.\n$$ \\widehat{R}(t) = \\widehat{R}_{0} \\widehat{Q}_{10}^{(T(t) - 10)/10} $$\n\nGross Primary Production ($\\widehat{\\mathrm{GPP}}$) is then partitioned. For nighttime samples, $\\widehat{\\mathrm{GPP}}(t)$ is defined as $0$. For daytime samples, it is calculated from the flux balance equation, $\\mathrm{GPP} = R - F_{\\mathrm{CO2}}$. To ensure physical plausibility (photosynthesis cannot be negative), we use:\n$$ \\widehat{\\mathrm{GPP}}(t) = \\max(\\widehat{R}(t) - F_{\\mathrm{CO2}}(t), 0) \\quad \\text{for daytime} $$\n\n**Step 3: Compute NEP and Summary Diagnostics**\nInstantaneous Net Ecosystem Production is computed at all time steps using the partitioned components:\n$$ \\mathrm{NEP}(t) = \\widehat{\\mathrm{GPP}}(t) - \\widehat{R}(t) $$\nNote that for daytime samples, this simplifies to $\\mathrm{NEP}(t) = (\\widehat{R}(t) - F_{\\mathrm{CO2}}(t)) - \\widehat{R}(t) = -F_{\\mathrm{CO2}}(t)$, assuming $\\widehat{R}(t) - F_{\\mathrm{CO2}}(t) > 0$, which is the case here. For nighttime samples, $\\mathrm{NEP}(t) = -\\widehat{R}(t)$.\n\nFinally, two summary diagnostics are calculated for each case:\n1.  **Mean daytime $\\widehat{\\mathrm{GPP}}$**: The arithmetic mean of the $\\widehat{\\mathrm{GPP}}(t)$ values computed for all daytime samples.\n2.  **24-hour integrated NEP**: This is calculated by a Riemann sum over the $8$ samples, with a uniform time step $\\Delta t = 10800$ s. The total carbon exchange in $\\mu\\mathrm{mol}\\,\\mathrm{m}^{-2}$ is converted to $\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}$ using the molar mass of carbon ($12.0\\,\\mathrm{g/mol}$, or $12 \\times 10^{-6}\\,\\mathrm{g/\\mu mol}$).\n    $$ \\mathrm{NEP}_{24\\mathrm{h}} = \\left( \\sum_{i=1}^{8} \\mathrm{NEP}(t_i) \\cdot \\Delta t \\right) \\cdot (12 \\times 10^{-6}\\,\\mathrm{g\\,C}/\\mu\\mathrm{mol}) $$\n\nThe following program implements this procedure to generate the final answer.\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the eddy covariance partitioning problem for three test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"T\": np.array([6.0, 5.0, 7.0, 12.0, 18.0, 23.0, 16.0, 10.0]),\n            \"F_CO2\": np.array([2.274, 2.121, 2.437, -6.554, -10.777, -6.614, -4.453, 3.000]),\n            \"is_night\": np.array([True, True, True, False, False, False, False, True]),\n        },\n        {\n            \"T\": np.array([20.0, 18.0, 17.0, 24.0, 30.0, 34.0, 28.0, 22.0]),\n            \"F_CO2\": np.array([6.250, 5.205, 4.748, -10.985, -14.375, -2.452, -4.999, 7.508]),\n            \"is_night\": np.array([True, True, True, False, False, False, False, True]),\n        },\n        {\n            \"T\": np.array([0.0, -2.0, 1.0, 5.0, 12.0, 15.0, 9.0, 3.0]),\n            \"F_CO2\": np.array([0.833, 0.741, 0.884, -2.882, -8.313, -5.988, -3.585, 0.994]),\n            \"is_night\": np.array([True, True, True, False, False, False, False, True]),\n        },\n    ]\n\n    all_results = []\n    \n    # Constants\n    DELTA_T_S = 10800.0  # Time step in seconds\n    C_CONVERSION_FACTOR = 12.0 * 1e-6  # gC per umol C\n\n    for case in test_cases:\n        T = case[\"T\"]\n        F_CO2 = case[\"F_CO2\"]\n        is_night = case[\"is_night\"]\n\n        # Step 1: Estimate R0 and Q10 from nighttime data\n        T_night = T[is_night]\n        F_CO2_night = F_CO2[is_night]\n        \n        # Linearize the model: y = ln(R0) + ln(Q10) * x\n        # where x = (T-10)/10 and y = ln(F_CO2)\n        x_reg = (T_night - 10.0) / 10.0\n        y_reg = np.log(F_CO2_night)\n\n        # Perform ordinary least squares using numpy.polyfit (degree 1)\n        # It returns [slope, intercept]\n        slope, intercept = np.polyfit(x_reg, y_reg, 1)\n        \n        # Recover R0 and Q10\n        ln_Q10 = slope\n        ln_R0 = intercept\n        R0_hat = np.exp(ln_R0)\n        Q10_hat = np.exp(ln_Q10)\n\n        # Step 2: Predict respiration R_hat for all time steps\n        R_hat = R0_hat * (Q10_hat ** ((T - 10.0) / 10.0))\n\n        # Step 3: Partition daytime fluxes to get GPP_hat\n        GPP_hat = np.zeros_like(T)\n        is_day = ~is_night\n        \n        daytime_GPP_unconstrained = R_hat[is_day] - F_CO2[is_day]\n        GPP_hat[is_day] = np.maximum(daytime_GPP_unconstrained, 0)\n        \n        # Step 4: Compute instantaneous NEP_hat\n        NEP_hat = GPP_hat - R_hat\n        \n        # Step 5: Calculate summary diagnostics\n        # Mean daytime GPP\n        mean_daytime_GPP = np.mean(GPP_hat[is_day])\n        \n        # 24-hour integrated NEP\n        # Sum of NEP rates * time step to get total umol/m^2/day\n        total_NEP_umol = np.sum(NEP_hat) * DELTA_T_S\n        # Convert to gC/m^2/day\n        NEP_24h_gC = total_NEP_umol * C_CONVERSION_FACTOR\n        \n        # Store results rounded to three decimals\n        results = [\n            round(R0_hat, 3),\n            round(Q10_hat, 3),\n            round(mean_daytime_GPP, 3),\n            round(NEP_24h_gC, 3)\n        ]\n        all_results.append(results)\n\n    # Format the final output string\n    # e.g., \"[[r01,q101,gpp1,nep1],[r02,q102,gpp2,nep2],[r03,q103,gpp3,nep3]]\"\n    inner_lists_str = []\n    for res_list in all_results:\n        # Format numbers to 3 decimal places explicitly for trailing zeros\n        formatted_list = [f\"{x:.3f}\" for x in res_list]\n        inner_lists_str.append(f\"[{','.join(formatted_list)}]\")\n    \n    final_output = f\"[{','.join(inner_lists_str)}]\"\n    \n    # This function would print final_output, which is the required answer\n    # print(final_output)\n\n```", "answer": "```\n[[3.000,2.000,14.613,6.388],[5.000,2.500,23.332,6.425],[1.000,1.500,9.973,4.072]]\n```", "id": "2473798"}, {"introduction": "Finally, we place our understanding of ecosystem function into a broader geographical context by classifying biomes based on climate. This exercise [@problem_id:2473806] provides practical experience with a classic and influential classification scheme, the Holdridge life zone system. By processing raw climate data according to the system's specific rules for calculating biotemperature and mapping points in logarithmic space, you will forge a tangible link between local climate conditions and global biome patterns.", "problem": "A field station at a midlatitude location recorded monthly mean air temperatures and monthly precipitation totals for a single calendar year. In the Holdridge life zone framework, the mean annual biotemperature is defined as the arithmetic mean of the $12$ monthly mean temperatures after replacing any monthly mean temperature below $0\\,^\\circ\\mathrm{C}$ or above $30\\,^\\circ\\mathrm{C}$ by $0\\,^\\circ\\mathrm{C}$. Assume that the Holdridge life zone diagram is used in its standard logarithmic form, and that mapping a site to a “hexagon” can be approximated by assigning the site to the nearest geometric center along each axis in base-$2$ logarithmic space. Specifically, let the set of biotemperature centers be $\\{\\,1.5,\\,3,\\,6,\\,12,\\,24\\,\\}$ (degrees Celsius) and the set of annual precipitation centers be $\\{\\,62.5,\\,125,\\,250,\\,500,\\,1000,\\,2000,\\,4000\\,\\}$ (millimeters). For a site with mean annual biotemperature $B$ and annual precipitation $P$ (millimeters), define the assigned biotemperature center $B_c$ and precipitation center $P_c$ as the values from their respective sets that minimize the squared Euclidean distance in the plane with coordinates $(\\log_{2} B,\\,\\log_{2} P)$; ties, if any, are broken in favor of the larger center. Index the biotemperature centers by $i_B \\in \\{1,2,3,4,5\\}$ in increasing order and the precipitation centers by $i_P \\in \\{1,2,3,4,5,6,7\\}$ in increasing order, and define the unique hexagon index as $I = 100\\,i_B + i_P$.\n\nThe station’s monthly mean temperatures (in $^\\circ\\mathrm{C}$) are:\n$(-5,\\,-2,\\,3,\\,10,\\,16,\\,27,\\,32,\\,31,\\,24,\\,12,\\,5,\\,-1)$,\nand the monthly precipitation totals (in millimeters) are:\n$(30,\\,28,\\,35,\\,45,\\,60,\\,75,\\,100,\\,90,\\,85,\\,80,\\,85,\\,87)$.\n\nUsing only the definitions above (do not introduce any alternative mappings), compute the mean annual biotemperature $B$, the annual precipitation $P$, perform the nearest-center assignment in base-$2$ logarithmic space, and report the resulting hexagon index $I$. Express your final answer as a pure number with no units. If you perform any intermediate numerical approximations, ensure they are sufficiently accurate to identify the correct nearest centers unambiguously. No rounding instruction is required for the final answer since it is an integer.", "solution": "We begin from the core Holdridge definitions:\n\n1. Mean annual biotemperature $B$ is the arithmetic mean of the $12$ monthly mean temperatures after replacing any monthly mean temperature below $0\\,^\\circ\\mathrm{C}$ or above $30\\,^\\circ\\mathrm{C}$ by $0\\,^\\circ\\mathrm{C}$. Formally,\n$$\nB \\;=\\; \\frac{1}{12} \\sum_{m=1}^{12} b(T_m),\n\\quad\nb(T) \\;=\\; \\begin{cases}\nT, & 0 \\le T \\le 30,\\\\\n0, & \\text{otherwise}.\n\\end{cases}\n$$\n\n2. Annual precipitation $P$ is the sum of the $12$ monthly precipitation totals:\n$$\nP \\;=\\; \\sum_{m=1}^{12} P_m.\n$$\n\n3. The Holdridge diagram uses logarithmic axes; we approximate hexagon assignment by choosing the nearest geometric centers in base-$2$ logarithmic space. Thus, with $x=\\log_{2} B$ and $y=\\log_{2} P$, we choose $B_c \\in \\{\\,1.5,\\,3,\\,6,\\,12,\\,24\\,\\}$ and $P_c \\in \\{\\,62.5,\\,125,\\,250,\\,500,\\,1000,\\,2000,\\,4000\\,\\}$ to minimize\n$$\nd^{2} \\;=\\; \\bigl(\\log_{2} B - \\log_{2} B_c\\bigr)^{2} \\;+\\; \\bigl(\\log_{2} P - \\log_{2} P_c\\bigr)^{2}.\n$$\nBecause the distance is separable across axes, minimizing $d^{2}$ reduces to independently choosing the nearest $B_c$ to $B$ in $\\log_{2}$ space and the nearest $P_c$ to $P$ in $\\log_{2}$ space; ties are broken by selecting the larger center.\n\nCompute $B$:\n\n- Monthly mean temperatures are $(-5,\\,-2,\\,3,\\,10,\\,16,\\,27,\\,32,\\,31,\\,24,\\,12,\\,5,\\,-1)$. Applying $b(T)$ sets any $T<0$ or $T>30$ to $0$:\n$$\nb(T_m) \\;=\\; (0,\\,0,\\,3,\\,10,\\,16,\\,27,\\,0,\\,0,\\,24,\\,12,\\,5,\\,0).\n$$\n- Sum of adjusted monthly values:\n$$\n\\sum_{m=1}^{12} b(T_m) \\;=\\; 3 + 10 + 16 + 27 + 24 + 12 + 5 \\;=\\; 97.\n$$\n- Hence,\n$$\nB \\;=\\; \\frac{97}{12}.\n$$\n\nCompute $P$:\n\n- Monthly precipitation totals are $(30,\\,28,\\,35,\\,45,\\,60,\\,75,\\,100,\\,90,\\,85,\\,80,\\,85,\\,87)$ millimeters, so\n$$\nP \\;=\\; 30 + 28 + 35 + 45 + 60 + 75 + 100 + 90 + 85 + 80 + 85 + 87 \\;=\\; 800.\n$$\n\nAssign nearest centers in base-$2$ logarithmic space:\n\n- Compute $\\log_{2} B$:\n$$\nB \\;=\\; \\frac{97}{12} \\;\\approx\\; 8.083\\overline{3},\n\\qquad\n\\log_{2} B \\;=\\; \\frac{\\ln B}{\\ln 2} \\;\\approx\\; \\log_{2}(8.083\\overline{3}) \\;\\approx\\; 3.015.\n$$\n- Candidate biotemperature centers and their base-$2$ logarithms:\n$$\n\\log_{2}(1.5) \\approx 0.585,\\quad\n\\log_{2}(3) \\approx 1.585,\\quad\n\\log_{2}(6) \\approx 2.585,\\quad\n\\log_{2}(12) \\approx 3.585,\\quad\n\\log_{2}(24) \\approx 4.585.\n$$\n- Differences along the biotemperature axis:\n$$\n|\\log_{2} B - \\log_{2}(6)| \\approx |3.015 - 2.585| \\approx 0.430, \\\\\n|\\log_{2} B - \\log_{2}(12)| \\approx |3.015 - 3.585| \\approx 0.570.\n$$\nValues for $1.5$, $3$, and $24$ are much farther. Therefore, the nearest biotemperature center is $B_c = 6$, which corresponds to index $i_B = 3$ in the ordered set $\\{1.5,\\,3,\\,6,\\,12,\\,24\\}$.\n\n- Compute $\\log_{2} P$:\n$$\nP \\;=\\; 800 \\;=\\; 2^{5} \\times 25 \\;\\Rightarrow\\; \\log_{2} P \\;=\\; 5 + \\log_{2}(25) \\;=\\; 5 + 2\\log_{2}(5) \\;\\approx\\; 9.643856.\n$$\n- Candidate precipitation centers and their base-$2$ logarithms:\n$$\n\\log_{2}(62.5) \\approx 5.965784,\\quad\n\\log_{2}(125) \\approx 6.965784,\\quad\n\\log_{2}(250) \\approx 7.965784,\\\\\n\\log_{2}(500) \\approx 8.965784,\\quad\n\\log_{2}(1000) \\approx 9.965784,\\quad\n\\log_{2}(2000) \\approx 10.965784,\\quad\n\\log_{2}(4000) \\approx 11.965784.\n$$\n- Differences along the precipitation axis near $P$:\n$$\n|\\log_{2} P - \\log_{2}(500)| \\approx |9.643856 - 8.965784| \\approx 0.678072, \\\\\n|\\log_{2} P - \\log_{2}(1000)| \\approx |9.643856 - 9.965784| \\approx 0.321928.\n$$\nThe nearest precipitation center is $P_c = 1000$, which corresponds to index $i_P = 5$ in the ordered set $\\{62.5,\\,125,\\,250,\\,500,\\,1000,\\,2000,\\,4000\\}$.\n\nCompute the hexagon index:\n$$\nI \\;=\\; 100\\,i_B + i_P \\;=\\; 100 \\times 3 + 5 \\;=\\; 305.\n$$\n\nThus, the unique hexagon index determined by the station’s data and the specified mapping protocol is $I = 305$.", "answer": "$$\\boxed{305}$$", "id": "2473806"}]}