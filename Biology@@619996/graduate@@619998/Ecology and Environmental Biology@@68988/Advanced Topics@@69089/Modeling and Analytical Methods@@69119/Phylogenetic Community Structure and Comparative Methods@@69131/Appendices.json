{"hands_on_practices": [{"introduction": "At the heart of all phylogenetic community and comparative methods lies the concept of distance between species on a tree. Before we can analyze complex patterns, we must first master the fundamental task of calculating these distances from a given phylogeny. This practice problem [@problem_id:2520702] guides you through this core skill, asking you to compute distances using two different but equivalent methods: direct path summation and a formula based on the depths of nodes. By demonstrating their mathematical identity, you will build a foundational intuition for the geometry of trees that is indispensable for all further analysis.", "problem": "In comparative community ecology, pairwise phylogenetic distances among species are used to quantify evolutionary relatedness that underpins tests of phylogenetic clustering or overdispersion. Consider a rooted, bifurcating phylogenetic tree on four tips $\\{A,B,C,D\\}$ with nonnegative branch lengths measured in expected substitutions per site. The root splits into two clades: the first clade contains tips $A$ and $B$, and the second clade contains tips $C$ and $D$. The branch length from the root to the internal node that is the most recent common ancestor of $A$ and $B$ is $0.5$. From that internal node, the branch lengths to $A$ and $B$ are $0.6$ and $0.9$, respectively. The branch length from the root to the internal node that is the most recent common ancestor of $C$ and $D$ is $0.4$. From that internal node, the branch lengths to $C$ and $D$ are $0.3$ and $1.1$, respectively.\n\nUsing only fundamental definitions for distances on trees (connected acyclic graphs with additive edge lengths) and the definition of the Most Recent Common Ancestor (MRCA), do the following:\n\n- For each unordered pair of tips $\\{i,j\\} \\subset \\{A,B,C,D\\}$, define $s_{ij}$ as the sum of branch lengths along the unique path between $i$ and $j$, computed directly by traversing edges on the tree.\n- Starting from first principles, derive an expression for the tree distance $d_{ij}$ between tips $i$ and $j$ in terms of root-to-tip depths and the depth of $\\operatorname{MRCA}(i,j)$, then evaluate $d_{ij}$ for all unordered pairs.\n- Define the discrepancy\n$$\nE \\equiv \\sum_{i<j} \\left| d_{ij} - s_{ij} \\right|,\n$$\nwhere the sum is taken over the six unordered pairs $\\{A,B\\}, \\{A,C\\}, \\{A,D\\}, \\{B,C\\}, \\{B,D\\}, \\{C,D\\}$.\n\nWhat is the value of $E$? Express your answer in substitutions per site. Provide the exact value; no rounding is required.", "solution": "The problem as stated is well-defined, internally consistent, and scientifically grounded in the principles of graph theory as applied to phylogenetics. It is a valid problem.\n\nWe begin by formalizing the structure of the phylogenetic tree and the given parameters. The tree has a set of tips (leaves) $T = \\{A, B, C, D\\}$ and internal nodes, including the root $R$. The topology is described as follows: the root $R$ is the most recent common ancestor (MRCA) of the two clades $\\{A, B\\}$ and $\\{C, D\\}$. Let $N_{AB}$ be the MRCA of tips $A$ and $B$, and let $N_{CD}$ be the MRCA of tips $C$ and $D$. The root $R$ is the MRCA for any pair of tips with one from $\\{A, B\\}$ and the other from $\\{C, D\\}$.\n\nThe branch lengths, denoted by $l(u, v)$ for the edge between nodes $u$ and $v$, are given as:\n$l(R, N_{AB}) = 0.5$\n$l(N_{AB}, A) = 0.6$\n$l(N_{AB}, B) = 0.9$\n$l(R, N_{CD}) = 0.4$\n$l(N_{CD}, C) = 0.3$\n$l(N_{CD}, D) = 1.1$\n\nThe problem requires a three-part analysis.\n\nFirst, we calculate $s_{ij}$ for all six unordered pairs of tips $\\{i, j\\}$. The quantity $s_{ij}$ is defined as the sum of branch lengths along the unique path connecting tips $i$ and $j$.\n\nFor $\\{A, B\\}$: The path is $A \\leftrightarrow N_{AB} \\leftrightarrow B$.\n$s_{AB} = l(N_{AB}, A) + l(N_{AB}, B) = 0.6 + 0.9 = 1.5$.\n\nFor $\\{C, D\\}$: The path is $C \\leftrightarrow N_{CD} \\leftrightarrow D$.\n$s_{CD} = l(N_{CD}, C) + l(N_{CD}, D) = 0.3 + 1.1 = 1.4$.\n\nFor $\\{A, C\\}$: The path is $A \\leftrightarrow N_{AB} \\leftrightarrow R \\leftrightarrow N_{CD} \\leftrightarrow C$.\n$s_{AC} = l(N_{AB}, A) + l(R, N_{AB}) + l(R, N_{CD}) + l(N_{CD}, C) = 0.6 + 0.5 + 0.4 + 0.3 = 1.8$.\n\nFor $\\{A, D\\}$: The path is $A \\leftrightarrow N_{AB} \\leftrightarrow R \\leftrightarrow N_{CD} \\leftrightarrow D$.\n$s_{AD} = l(N_{AB}, A) + l(R, N_{AB}) + l(R, N_{CD}) + l(N_{CD}, D) = 0.6 + 0.5 + 0.4 + 1.1 = 2.6$.\n\nFor $\\{B, C\\}$: The path is $B \\leftrightarrow N_{AB} \\leftrightarrow R \\leftrightarrow N_{CD} \\leftrightarrow C$.\n$s_{BC} = l(N_{AB}, B) + l(R, N_{AB}) + l(R, N_{CD}) + l(N_{CD}, C) = 0.9 + 0.5 + 0.4 + 0.3 = 2.1$.\n\nFor $\\{B, D\\}$: The path is $B \\leftrightarrow N_{AB} \\leftrightarrow R \\leftrightarrow N_{CD} \\leftrightarrow D$.\n$s_{BD} = l(N_{AB}, B) + l(R, N_{AB}) + l(R, N_{CD}) + l(N_{CD}, D) = 0.9 + 0.5 + 0.4 + 1.1 = 2.9$.\n\nSecond, we must derive an expression for the tree distance $d_{ij}$ in terms of root-to-tip depths and the depth of the MRCA. Let $\\delta(v)$ be the depth of any node $v$, defined as the sum of branch lengths on the path from the root $R$ to $v$. By definition, $\\delta(R) = 0$.\n\nThe fundamental definition of distance in a tree is the path-sum distance, which is precisely how $s_{ij}$ is defined. Let us denote this fundamental distance by $\\mathcal{D}(i, j)$. The unique path between any two tips $i$ and $j$ consists of two parts: the path from $i$ to $\\operatorname{MRCA}(i, j)$ and the path from $\\operatorname{MRCA}(i, j)$ to $j$.\nThe length of the path from $i$ to $\\operatorname{MRCA}(i, j)$ is the sum of branch lengths along this path. This path is a segment of the path from $i$ to the root $R$. Therefore, its length is the difference between the depth of $i$ and the depth of $\\operatorname{MRCA}(i, j)$.\nPath length $(i \\to \\operatorname{MRCA}(i, j)) = \\delta(i) - \\delta(\\operatorname{MRCA}(i, j))$.\nSimilarly, for tip $j$:\nPath length $(j \\to \\operatorname{MRCA}(i, j)) = \\delta(j) - \\delta(\\operatorname{MRCA}(i, j))$.\nThe total distance $\\mathcal{D}(i, j)$ is the sum of these two path lengths:\n$\\mathcal{D}(i, j) = (\\delta(i) - \\delta(\\operatorname{MRCA}(i, j))) + (\\delta(j) - \\delta(\\operatorname{MRCA}(i, j)))$.\nThis simplifies to:\n$\\mathcal{D}(i, j) = \\delta(i) + \\delta(j) - 2 \\cdot \\delta(\\operatorname{MRCA}(i, j))$.\n\nThe problem defines $d_{ij}$ as the quantity evaluated using this derived expression. Thus, we have:\n$$d_{ij} \\equiv \\delta(i) + \\delta(j) - 2 \\cdot \\delta(\\operatorname{MRCA}(i, j))$$\nSince this expression is derived directly from the first principles of path-sum distance, it is mathematically equivalent to $s_{ij}$. That is, $d_{ij} = s_{ij}$ for any tree with additive branch lengths.\n\nWe now evaluate the depths for all relevant nodes:\n$\\delta(R) = 0$\n$\\delta(N_{AB}) = l(R, N_{AB}) = 0.5$\n$\\delta(N_{CD}) = l(R, N_{CD}) = 0.4$\n$\\delta(A) = \\delta(N_{AB}) + l(N_{AB}, A) = 0.5 + 0.6 = 1.1$\n$\\delta(B) = \\delta(N_{AB}) + l(N_{AB}, B) = 0.5 + 0.9 = 1.4$\n$\\delta(C) = \\delta(N_{CD}) + l(N_{CD}, C) = 0.4 + 0.3 = 0.7$\n$\\delta(D) = \\delta(N_{CD}) + l(N_{CD}, D) = 0.4 + 1.1 = 1.5$\n\nNow we compute $d_{ij}$ for all pairs:\n$\\operatorname{MRCA}(A, B) = N_{AB}$.\n$d_{AB} = \\delta(A) + \\delta(B) - 2 \\cdot \\delta(N_{AB}) = 1.1 + 1.4 - 2(0.5) = 2.5 - 1.0 = 1.5$.\n\n$\\operatorname{MRCA}(C, D) = N_{CD}$.\n$d_{CD} = \\delta(C) + \\delta(D) - 2 \\cdot \\delta(N_{CD}) = 0.7 + 1.5 - 2(0.4) = 2.2 - 0.8 = 1.4$.\n\nFor all other pairs, the MRCA is the root $R$.\n$\\operatorname{MRCA}(A, C) = R$.\n$d_{AC} = \\delta(A) + \\delta(C) - 2 \\cdot \\delta(R) = 1.1 + 0.7 - 2(0) = 1.8$.\n\n$\\operatorname{MRCA}(A, D) = R$.\n$d_{AD} = \\delta(A) + \\delta(D) - 2 \\cdot \\delta(R) = 1.1 + 1.5 - 2(0) = 2.6$.\n\n$\\operatorname{MRCA}(B, C) = R$.\n$d_{BC} = \\delta(B) + \\delta(C) - 2 \\cdot \\delta(R) = 1.4 + 0.7 - 2(0) = 2.1$.\n\n$\\operatorname{MRCA}(B, D) = R$.\n$d_{BD} = \\delta(B) + \\delta(D) - 2 \\cdot \\delta(R) = 1.4 + 1.5 - 2(0) = 2.9$.\n\nComparing the sets of values:\n$s_{AB} = 1.5$ and $d_{AB} = 1.5$.\n$s_{CD} = 1.4$ and $d_{CD} = 1.4$.\n$s_{AC} = 1.8$ and $d_{AC} = 1.8$.\n$s_{AD} = 2.6$ and $d_{AD} = 2.6$.\n$s_{BC} = 2.1$ and $d_{BC} = 2.1$.\n$s_{BD} = 2.9$ and $d_{BD} = 2.9$.\nAs predicted by the derivation, $s_{ij} = d_{ij}$ for all pairs $\\{i, j\\}$.\n\nThird, we compute the total discrepancy $E$.\n$$E \\equiv \\sum_{i<j} \\left| d_{ij} - s_{ij} \\right|$$\nThe sum is over the six unordered pairs.\n$E = |d_{AB} - s_{AB}| + |d_{AC} - s_{AC}| + |d_{AD} - s_{AD}| + |d_{BC} - s_{BC}| + |d_{BD} - s_{BD}| + |d_{CD} - s_{CD}|$\n$E = |1.5 - 1.5| + |1.8 - 1.8| + |2.6 - 2.6| + |2.1 - 2.1| + |2.9 - 2.9| + |1.4 - 1.4|$\n$E = 0 + 0 + 0 + 0 + 0 + 0 = 0$.\n\nThe problem is a conceptual check of the fundamental definitions of distance on a tree. The two methods of calculating pairwise distance, direct path summation ($s_{ij}$) and the formula based on depths ($d_{ij}$), are mathematically equivalent. The discrepancy $E$ must therefore be zero. The calculations confirm this result.", "answer": "$$\\boxed{0}$$", "id": "2520702"}, {"introduction": "With a solid grasp of phylogenetic distances, we can move to one of the most powerful applications in community ecology: quantifying the differences between communities. The UniFrac distance is a cornerstone metric, particularly in microbiome research, that measures the unique fraction of evolutionary history in two samples. This exercise [@problem_id:2520695] challenges you to calculate both the unweighted (presence/absence) and weighted (abundance-aware) versions of UniFrac, revealing how they can lead to different conclusions about community similarity. Working through this problem will sharpen your understanding of how to choose the right tool to answer specific ecological questions about beta-diversity.", "problem": "Consider two microbiome samples, denoted sample $\\mathrm{S1}$ and sample $\\mathrm{S2}$, drawn from a community whose taxa are represented by a rooted, bifurcating phylogenetic tree with additive branch lengths. The tree has five terminal taxa (Operational Taxonomic Units (OTUs)) labeled $\\mathrm{A}$, $\\mathrm{B}$, $\\mathrm{C}$, $\\mathrm{D}$, and $\\mathrm{E}$. The topology and branch lengths are as follows, where each line indicates a branch from a parent (left) to a child (right) with branch length in parentheses:\n- $\\mathrm{root} \\to \\mathrm{X}$ ($0.4$), $\\mathrm{root} \\to \\mathrm{Y}$ ($0.6$)\n- $\\mathrm{X} \\to \\mathrm{A}$ ($0.2$), $\\mathrm{X} \\to \\mathrm{B}$ ($0.3$)\n- $\\mathrm{Y} \\to \\mathrm{Y1}$ ($0.25$), $\\mathrm{Y} \\to \\mathrm{E}$ ($0.35$)\n- $\\mathrm{Y1} \\to \\mathrm{C}$ ($0.1$), $\\mathrm{Y1} \\to \\mathrm{D}$ ($0.15$)\n\nThe observed counts of each OTU in each sample are:\n- $\\mathrm{S1}$: $\\mathrm{A}=40$, $\\mathrm{B}=10$, $\\mathrm{C}=5$, $\\mathrm{D}=0$, $\\mathrm{E}=45$\n- $\\mathrm{S2}$: $\\mathrm{A}=0$, $\\mathrm{B}=30$, $\\mathrm{C}=35$, $\\mathrm{D}=25$, $\\mathrm{E}=10$\n\nUse the following foundational definitions.\n- Presence/absence on a branch: A sample is said to have presence on a branch if the sum of its counts over all descendant OTUs of that branch is greater than $0$.\n- Unweighted UniFrac distance $d_{U}$ between two samples is the total branch length that is present in exactly one of the two samples divided by the total branch length that is present in at least one of the two samples.\n- Weighted UniFrac distance $d_{W}$ between two samples is computed by first converting counts within each sample to relative abundances that sum to $1$ across OTUs. For each branch $b$ with length $L_{b}$, let $p_{\\mathrm{S1}}(b)$ and $p_{\\mathrm{S2}}(b)$ be the sum of relative abundances in $\\mathrm{S1}$ and $\\mathrm{S2}$, respectively, over descendant OTUs of branch $b$. Then the normalized weighted UniFrac distance is\n$$\nd_{W} \\;=\\; \\frac{\\sum_{b} L_{b}\\,|p_{\\mathrm{S1}}(b) - p_{\\mathrm{S2}}(b)|}{\\sum_{b} L_{b}\\,\\big(p_{\\mathrm{S1}}(b)+p_{\\mathrm{S2}}(b)\\big)}.\n$$\n\nTasks:\n1. Compute $d_{U}$ for $\\mathrm{S1}$ and $\\mathrm{S2}$ from first principles using the definition above.\n2. Compute $d_{W}$ for $\\mathrm{S1}$ and $\\mathrm{S2}$ from first principles using the definition above.\n3. Briefly interpret in words why $d_{U}$ and $d_{W}$ differ in this case, focusing on the contribution of rare lineages and how abundances interact with branch lengths.\n4. Finally, compute the ratio $R = d_{W}/d_{U}$ and report $R$ as a dimensionless number rounded to four significant figures.\n\nExpress the final reported ratio $R$ as a pure number (no units). The final numerical answer must be rounded to four significant figures.", "solution": "The problem is scientifically grounded, well-posed, and contains all necessary information for a unique solution. We shall proceed with the calculation as specified. The problem requires the computation of two ecological distance metrics, the unweighted and weighted UniFrac distances ($d_U$ and $d_W$), followed by an interpretation of their difference and the calculation of their ratio $R$.\n\nFirst, we must reconstruct the phylogenetic tree and list all branches with their corresponding lengths $L_b$. The tree has $8$ branches in total. Let us label them for clarity:\n\\begin{itemize}\n    \\item $b_1$: $\\mathrm{root} \\to \\mathrm{X}$, $L_1 = 0.4$\n    \\item $b_2$: $\\mathrm{root} \\to \\mathrm{Y}$, $L_2 = 0.6$\n    \\item $b_3$: $\\mathrm{X} \\to \\mathrm{A}$, $L_3 = 0.2$\n    \\item $b_4$: $\\mathrm{X} \\to \\mathrm{B}$, $L_4 = 0.3$\n    \\item $b_5$: $\\mathrm{Y} \\to \\mathrm{Y1}$, $L_5 = 0.25$\n    \\item $b_6$: $\\mathrm{Y} \\to \\mathrm{E}$, $L_6 = 0.35$\n    \\item $b_7$: $\\mathrm{Y1} \\to \\mathrm{C}$, $L_7 = 0.1$\n    \\item $b_8$: $\\mathrm{Y1} \\to \\mathrm{D}$, $L_8 = 0.15$\n\\end{itemize}\nThe set of descendant terminal taxa for each branch is:\n\\begin{itemize}\n    \\item Descendants of $b_1$: $\\{\\mathrm{A}, \\mathrm{B}\\}$\n    \\item Descendants of $b_2$: $\\{\\mathrm{C}, \\mathrm{D}, \\mathrm{E}\\}$\n    \\item Descendants of $b_3$: $\\{\\mathrm{A}\\}$\n    \\item Descendants of $b_4$: $\\{\\mathrm{B}\\}$\n    \\item Descendants of $b_5$: $\\{\\mathrm{C}, \\mathrm{D}\\}$\n    \\item Descendants of $b_6$: $\\{\\mathrm{E}\\}$\n    \\item Descendants of $b_7$: $\\{\\mathrm{C}\\}$\n    \\item Descendants of $b_8$: $\\{\\mathrm{D}\\}$\n\\end{itemize}\n\nThe observed counts are:\n\\begin{itemize}\n    \\item Sample S1: $\\mathrm{A}=40$, $\\mathrm{B}=10$, $\\mathrm{C}=5$, $\\mathrm{D}=0$, $\\mathrm{E}=45$\n    \\item Sample S2: $\\mathrm{A}=0$, $\\mathrm{B}=30$, $\\mathrm{C}=35$, $\\mathrm{D}=25$, $\\mathrm{E}=10$\n\\end{itemize}\n\n**Task 1: Computation of the Unweighted UniFrac distance, $d_U$**\n\nThe unweighted UniFrac distance is defined as $d_U = \\frac{\\text{length of branches present in one sample only}}{\\text{length of branches present in at least one sample}}$. A branch is considered present if the sum of counts of its descendant taxa is greater than $0$.\n\nWe tabulate the presence/absence status for each branch in each sample:\n\\begin{itemize}\n    \\item $b_1$ ($\\{\\mathrm{A}, \\mathrm{B}\\}$): S1 sum = $40+10 = 50>0$ (Present); S2 sum = $0+30 = 30>0$ (Present).\n    \\item $b_2$ ($\\{\\mathrm{C}, \\mathrm{D}, \\mathrm{E}\\}$): S1 sum = $5+0+45 = 50>0$ (Present); S2 sum = $35+25+10 = 70>0$ (Present).\n    \\item $b_3$ ($\\{\\mathrm{A}\\}$): S1 sum = $40>0$ (Present); S2 sum = $0$ (Absent).\n    \\item $b_4$ ($\\{\\mathrm{B}\\}$): S1 sum = $10>0$ (Present); S2 sum = $30>0$ (Present).\n    \\item $b_5$ ($\\{\\mathrm{C}, \\mathrm{D}\\}$): S1 sum = $5+0 = 5>0$ (Present); S2 sum = $35+25 = 60>0$ (Present).\n    \\item $b_6$ ($\\{\\mathrm{E}\\}$): S1 sum = $45>0$ (Present); S2 sum = $10>0$ (Present).\n    \\item $b_7$ ($\\{\\mathrm{C}\\}$): S1 sum = $5>0$ (Present); S2 sum = $35>0$ (Present).\n    \\item $b_8$ ($\\{\\mathrm{D}\\}$): S1 sum = $0$ (Absent); S2 sum = $25>0$ (Present).\n\\end{itemize}\n\nThe branches present in exactly one sample are $b_3$ (S1 only) and $b_8$ (S2 only). The sum of their lengths comprises the numerator of $d_U$:\n$$ \\text{Numerator} = L_3 + L_8 = 0.2 + 0.15 = 0.35 $$\nThe denominator is the total length of all branches that are present in at least one of the two samples. From our analysis, all $8$ branches are present in at least one sample. Thus, the denominator is the total length of the tree:\n$$ \\text{Denominator} = \\sum_{i=1}^{8} L_i = 0.4 + 0.6 + 0.2 + 0.3 + 0.25 + 0.35 + 0.1 + 0.15 = 2.35 $$\nTherefore, the unweighted UniFrac distance is:\n$$ d_U = \\frac{0.35}{2.35} = \\frac{35}{235} = \\frac{7}{47} $$\n\n**Task 2: Computation of the Weighted UniFrac distance, $d_W$**\n\nThe weighted UniFrac distance $d_W$ requires converting counts to relative abundances. The total number of reads in each sample is $100$.\n\\begin{itemize}\n    \\item Sample S1 abundances: $p_{\\mathrm{A},1}=0.4$, $p_{\\mathrm{B},1}=0.1$, $p_{\\mathrm{C},1}=0.05$, $p_{\\mathrm{D},1}=0$, $p_{\\mathrm{E},1}=0.45$\n    \\item Sample S2 abundances: $p_{\\mathrm{A},2}=0$, $p_{\\mathrm{B},2}=0.3$, $p_{\\mathrm{C},2}=0.35$, $p_{\\mathrm{D},2}=0.25$, $p_{\\mathrm{E},2}=0.1$\n\\end{itemize}\nFor each branch $b$, we compute $p_{\\mathrm{S1}}(b)$ and $p_{\\mathrm{S2}}(b)$, the sum of relative abundances of its descendant taxa.\n\\begin{itemize}\n    \\item $b_1$: $p_{\\mathrm{S1}}(b_1)=0.4+0.1=0.5$; $p_{\\mathrm{S2}}(b_1)=0+0.3=0.3$\n    \\item $b_2$: $p_{\\mathrm{S1}}(b_2)=0.05+0+0.45=0.5$; $p_{\\mathrm{S2}}(b_2)=0.35+0.25+0.1=0.7$\n    \\item $b_3$: $p_{\\mathrm{S1}}(b_3)=0.4$; $p_{\\mathrm{S2}}(b_3)=0$\n    \\item $b_4$: $p_{\\mathrm{S1}}(b_4)=0.1$; $p_{\\mathrm{S2}}(b_4)=0.3$\n    \\item $b_5$: $p_{\\mathrm{S1}}(b_5)=0.05+0=0.05$; $p_{\\mathrm{S2}}(b_5)=0.35+0.25=0.6$\n    \\item $b_6$: $p_{\\mathrm{S1}}(b_6)=0.45$; $p_{\\mathrm{S2}}(b_6)=0.1$\n    \\item $b_7$: $p_{\\mathrm{S1}}(b_7)=0.05$; $p_{\\mathrm{S2}}(b_7)=0.35$\n    \\item $b_8$: $p_{\\mathrm{S1}}(b_8)=0$; $p_{\\mathrm{S2}}(b_8)=0.25$\n\\end{itemize}\nNow we compute the numerator and denominator for $d_W = \\frac{\\sum_{b} L_{b}\\,|p_{\\mathrm{S1}}(b) - p_{\\mathrm{S2}}(b)|}{\\sum_{b} L_{b}\\,\\big(p_{\\mathrm{S1}}(b)+p_{\\mathrm{S2}}(b)\\big)}$.\n\nNumerator: $\\sum L_{b}\\,|p_{\\mathrm{S1}}(b) - p_{\\mathrm{S2}}(b)|$\n$$ N = 0.4|0.5-0.3| + 0.6|0.5-0.7| + 0.2|0.4-0| + 0.3|0.1-0.3| + 0.25|0.05-0.6| + 0.35|0.45-0.1| + 0.1|0.05-0.35| + 0.15|0-0.25| $$\n$$ N = 0.4(0.2) + 0.6(0.2) + 0.2(0.4) + 0.3(0.2) + 0.25(0.55) + 0.35(0.35) + 0.1(0.3) + 0.15(0.25) $$\n$$ N = 0.08 + 0.12 + 0.08 + 0.06 + 0.1375 + 0.1225 + 0.03 + 0.0375 = 0.6675 $$\n\nDenominator: $\\sum L_{b}\\,(p_{\\mathrm{S1}}(b) + p_{\\mathrm{S2}}(b))$\n$$ D = 0.4(0.5+0.3) + 0.6(0.5+0.7) + 0.2(0.4+0) + 0.3(0.1+0.3) + 0.25(0.05+0.6) + 0.35(0.45+0.1) + 0.1(0.05+0.35) + 0.15(0+0.25) $$\n$$ D = 0.4(0.8) + 0.6(1.2) + 0.2(0.4) + 0.3(0.4) + 0.25(0.65) + 0.35(0.55) + 0.1(0.4) + 0.15(0.25) $$\n$$ D = 0.32 + 0.72 + 0.08 + 0.12 + 0.1625 + 0.1925 + 0.04 + 0.0375 = 1.6725 $$\n\nThe weighted UniFrac distance is:\n$$ d_W = \\frac{0.6675}{1.6725} = \\frac{6675}{16725} = \\frac{267}{669} = \\frac{89}{223} $$\n\n**Task 3: Interpretation of the difference between $d_U$ and $d_W$**\n\nWe have calculated $d_U = \\frac{7}{47} \\approx 0.149$ and $d_W = \\frac{89}{223} \\approx 0.399$. The weighted UniFrac distance is substantially larger than the unweighted distance ($d_W > 2.5 \\times d_U$). This indicates that while the two samples share most of their phylogenetic lineages, the relative abundances of these lineages are dramatically different.\n\n$d_U$ is sensitive only to presence/absence information. It is small because the only qualitative differences between the samples are the presence of taxon $\\mathrm{A}$ in S1 (absent in S2) and taxon $\\mathrm{D}$ in S2 (absent in S1). These correspond to the terminal branches $b_3$ and $b_8$, whose combined length ($0.35$) is small relative to the total tree length ($2.35$). $d_U$ ignores the fact that other taxa, such as $\\mathrm{C}$ and $\\mathrm{E}$, are present in both samples but at vastly different abundances.\n\n$d_W$ incorporates abundance information. It is large because it is sensitive to the large shifts in relative abundances along many branches of the tree, not just those where taxa are completely absent. For instance, taxon $\\mathrm{E}$ is present in both samples (contributing $0$ to the $d_U$ numerator via its terminal branch), but its abundance plummets from $45\\%$ in S1 to $10\\%$ in S2. This large proportional shift, weighted by the branch length $L_6=0.35$, makes a large contribution to the $d_W$ numerator ($0.35 \\times|0.45 - 0.10| = 0.1225$). Similarly, major abundance shifts in taxa $\\mathrm{B}$ and $\\mathrm{C}$ contribute significantly to $d_W$. Thus, $d_W$ captures that the communities are dominated by different parts of the phylogenetic tree, even if they draw from a similar set of lineages.\n\n**Task 4: Computation of the ratio $R = d_W/d_U$**\n\nUsing the exact fractional forms calculated previously:\n$$ R = \\frac{d_W}{d_U} = \\frac{89/223}{7/47} = \\frac{89 \\times 47}{223 \\times 7} = \\frac{4183}{1561} $$\nNow we compute the numerical value and round to four significant figures:\n$$ R \\approx 2.6796925... $$\nRounding to four significant figures yields $2.680$.", "answer": "$$\\boxed{2.680}$$", "id": "2520695"}, {"introduction": "Beyond comparing communities, phylogenies are essential for comparative methods that test hypotheses about trait evolution across species. Phylogenetic Generalized Least Squares (PGLS) is a foundational tool that corrects for the statistical non-independence of species data arising from shared evolutionary history. This advanced practice [@problem_id:2520685] takes you under the hood of PGLS, showing how the underlying model can be extended to account for real-world complexities like species-specific measurement error. By manually calculating the regression parameters, you will gain a deep appreciation for the mechanics and flexibility of this powerful statistical framework.", "problem": "A researcher investigates how a continuous ecological response trait $y$ relates linearly to a continuous predictor $x$ across $3$ species while accounting for phylogenetic relatedness and unequal measurement error variances. Under a Brownian motion model of trait evolution with known rate parameter $\\sigma^{2}$ and an ultrametric tree, the trait vector is modeled as multivariate normal with a covariance given by the sum of the phylogenetic covariance and the measurement error variance. Specifically, the total covariance is $\\sigma^{2} C + E$, where $C$ is the phylogenetic covariance implied by shared branch lengths and $E$ is a known diagonal matrix of species-specific measurement error variances.\n\nYou are given the following small dataset for species $\\{A,B,C\\}$:\n- Predictor values $x$: $x_{A} = 1.0$, $x_{B} = 2.0$, $x_{C} = 4.0$.\n- Response values $y$: $y_{A} = 1.2$, $y_{B} = 2.3$, $y_{C} = 3.9$.\n\nThe ultrametric phylogeny has total root-to-tip time $2$ for each lineage, with species $A$ and $B$ sharing a most recent common ancestor at time $1$, and species $C$ splitting at the root. Under Brownian motion, the phylogenetic covariance matrix $C$ (shared path lengths) is\n$$\nC \\;=\\;\n\\begin{pmatrix}\n2 & 1 & 0 \\\\\n1 & 2 & 0 \\\\\n0 & 0 & 2\n\\end{pmatrix}.\n$$\nIndependent measurement error variances are known and given by\n$$\nE \\;=\\;\n\\begin{pmatrix}\n0.1 & 0 & 0 \\\\\n0 & 0.2 & 0 \\\\\n0 & 0 & 0.3\n\\end{pmatrix}.\n$$\nAssume the Brownian motion rate parameter is $\\sigma^{2} = 1.0$. Fit the phylogenetic generalized least squares (PGLS) regression of $y$ on $x$ with an intercept under a Gaussian linear model with the specified total covariance. Compute the PGLS slope parameter for the effect of $x$ on $y$, incorporating measurement error via $E$ as described. Express your answer as a real number with no units, and round your answer to four significant figures.", "solution": "The appropriate fundamental base is the Gaussian linear model with correlated errors induced by phylogeny under Brownian motion, plus independent measurement error. Let the response vector be $y \\in \\mathbb{R}^{n}$, the design matrix be $X \\in \\mathbb{R}^{n \\times p}$, and the parameter vector be $\\beta \\in \\mathbb{R}^{p}$. Under a Brownian motion model with known rate $\\sigma^{2}$ on a fixed phylogeny, the phylogenetic covariance among tip values is $\\sigma^{2} C$, where $C$ collects shared path lengths, and independent measurement error contributes an additive variance matrix $E$. Thus, the total covariance is\n$$\nV \\;=\\; \\sigma^{2} C + E.\n$$\nAssuming multivariate normal errors, $y \\sim \\mathcal{N}(X \\beta, V)$, the maximum likelihood estimator for $\\beta$ is the generalized least squares estimator\n$$\n\\hat{\\beta} \\;=\\; \\left(X^{\\top} V^{-1} X\\right)^{-1} X^{\\top} V^{-1} y,\n$$\nprovided $V$ is positive definite.\n\nWe now instantiate these objects. There are $n=3$ species and we fit an intercept and slope, so $p=2$. The design matrix is\n$$\nX \\;=\\; \\begin{pmatrix}\n1 & x_{A} \\\\\n1 & x_{B} \\\\\n1 & x_{C}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n1 & 1.0 \\\\\n1 & 2.0 \\\\\n1 & 4.0\n\\end{pmatrix}.\n$$\nWith $\\sigma^{2} = 1.0$, the total covariance is\n$$\nV \\;=\\; \\sigma^{2} C + E \\;=\\;\n\\begin{pmatrix}\n2 & 1 & 0 \\\\\n1 & 2 & 0 \\\\\n0 & 0 & 2\n\\end{pmatrix}\n+\n\\begin{pmatrix}\n0.1 & 0 & 0 \\\\\n0 & 0.2 & 0 \\\\\n0 & 0 & 0.3\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n2.1 & 1 & 0 \\\\\n1 & 2.2 & 0 \\\\\n0 & 0 & 2.3\n\\end{pmatrix}.\n$$\nThis $V$ is block diagonal in the sense that the $\\{A,B\\}$ block is independent of $C$ given the model. We invert $V$ by inverting the $2 \\times 2$ block and the $1 \\times 1$ block separately. For the $\\{A,B\\}$ block,\n$$\nS \\;=\\; \\begin{pmatrix} 2.1 & 1 \\\\ 1 & 2.2 \\end{pmatrix}, \\quad \\det(S) \\;=\\; 2.1 \\cdot 2.2 - 1 \\cdot 1 \\;=\\; 3.62,\n$$\nso\n$$\nS^{-1} \\;=\\; \\frac{1}{3.62} \\begin{pmatrix} 2.2 & -1 \\\\ -1 & 2.1 \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{110}{181} & -\\frac{50}{181} \\\\\n-\\frac{50}{181} & \\frac{105}{181}\n\\end{pmatrix}.\n$$\nFor species $C$, the variance is $2.3$, whose inverse is $1/2.3 = 10/23$. Therefore,\n$$\nV^{-1} \\;=\\; W \\;=\\;\n\\begin{pmatrix}\n\\frac{110}{181} & -\\frac{50}{181} & 0 \\\\\n-\\frac{50}{181} & \\frac{105}{181} & 0 \\\\\n0 & 0 & \\frac{10}{23}\n\\end{pmatrix}.\n$$\nNext compute the normal equations components $X^{\\top} W X$ and $X^{\\top} W y$. Let $x = (1.0, 2.0, 4.0)^{\\top}$ and $y = (1.2, 2.3, 3.9)^{\\top} = \\left(\\frac{6}{5}, \\frac{23}{10}, \\frac{39}{10}\\right)^{\\top}$. We proceed entrywise:\n- The scalar $1^{\\top} W 1$ equals the sum of all entries of $W$:\n$$\n1^{\\top} W 1 \\;=\\; \\frac{60}{181} + \\frac{55}{181} + \\frac{10}{23} \\;=\\; \\frac{4455}{4163}.\n$$\n- The scalar $1^{\\top} W x$:\n$$\nW x \\;=\\; \\begin{pmatrix} \\frac{110}{181} \\cdot 1 + \\left(-\\frac{50}{181}\\right)\\cdot 2 \\\\ \\left(-\\frac{50}{181}\\right)\\cdot 1 + \\frac{105}{181} \\cdot 2 \\\\ \\frac{10}{23} \\cdot 4 \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix} \\frac{10}{181} \\\\ \\frac{160}{181} \\\\ \\frac{40}{23} \\end{pmatrix},\n\\quad\n1^{\\top} W x \\;=\\; \\frac{10}{181} + \\frac{160}{181} + \\frac{40}{23} \\;=\\; \\frac{11150}{4163}.\n$$\n- The scalar $x^{\\top} W x$:\n$$\nx^{\\top} W x \\;=\\; 1 \\cdot \\frac{10}{181} + 2 \\cdot \\frac{160}{181} + 4 \\cdot \\frac{40}{23} \\;=\\; \\frac{36550}{4163}.\n$$\nThus,\n$$\nX^{\\top} W X \\;=\\;\n\\begin{pmatrix}\n\\frac{4455}{4163} & \\frac{11150}{4163} \\\\\n\\frac{11150}{4163} & \\frac{36550}{4163}\n\\end{pmatrix}.\n$$\nNow compute $X^{\\top} W y$. First,\n$$\nW y \\;=\\;\n\\begin{pmatrix}\n\\frac{110}{181} \\cdot \\frac{6}{5} + \\left(-\\frac{50}{181}\\right) \\cdot \\frac{23}{10} \\\\\n\\left(-\\frac{50}{181}\\right) \\cdot \\frac{6}{5} + \\frac{105}{181} \\cdot \\frac{23}{10} \\\\\n\\frac{10}{23} \\cdot \\frac{39}{10}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{17}{181} \\\\\n\\frac{363}{362} \\\\\n\\frac{39}{23}\n\\end{pmatrix}.\n$$\nTherefore,\n$$\nX^{\\top} W y \\;=\\;\n\\begin{pmatrix}\n1 & 1 & 1 \\\\\n1 & 2 & 4\n\\end{pmatrix}\n\\begin{pmatrix}\n\\frac{17}{181} \\\\\n\\frac{363}{362} \\\\\n\\frac{39}{23}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{17}{181} + \\frac{363}{362} + \\frac{39}{23} \\\\\n\\frac{17}{181} + 2 \\cdot \\frac{363}{362} + 4 \\cdot \\frac{39}{23}\n\\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{23249}{8326} \\\\\n\\frac{36976}{4163}\n\\end{pmatrix}.\n$$\nTo simplify, multiply both sides of the normal equations by $4163$ to clear denominators. Define\n$$\nM \\;=\\; 4163 \\, X^{\\top} W X \\;=\\; \\begin{pmatrix} 4455 & 11150 \\\\ 11150 & 36550 \\end{pmatrix}, \n\\qquad\nb \\;=\\; 4163 \\, X^{\\top} W y \\;=\\; \\begin{pmatrix} 4163 \\cdot \\frac{23249}{8326} \\\\ 4163 \\cdot \\frac{36976}{4163} \\end{pmatrix}\n\\;=\\;\n\\begin{pmatrix}\n\\frac{23249}{2} \\\\\n36976\n\\end{pmatrix}.\n$$\nWe solve $M \\hat{\\beta} = b$. The inverse of $M$ is\n$$\nM^{-1} \\;=\\; \\frac{1}{\\det(M)} \\begin{pmatrix} 36550 & -11150 \\\\ -11150 & 4455 \\end{pmatrix},\n\\quad\n\\det(M) \\;=\\; 4455 \\cdot 36550 - 11150^{2} \\;=\\; 162{,}810{,}250 - 124{,}322{,}500 = 38{,}487{,}750.\n$$\nThe slope (second component) is\n$$\n\\hat{\\beta}_{\\text{slope}} \\;=\\; \\frac{-11150 \\cdot \\left(\\frac{23249}{2}\\right) + 4455 \\cdot 36976}{38{,}487{,}750}\n\\;=\\; \\frac{-129{,}613{,}175 + 164{,}728{,}080}{38{,}487{,}750}\n\\;=\\; \\frac{35{,}114{,}905}{38{,}487{,}750}.\n$$\nThis exact ratio evaluates numerically to approximately\n$$\n\\hat{\\beta}_{\\text{slope}} \\;\\approx\\; 0.912365\\ldots\n$$\nRounded to four significant figures as requested, the PGLS slope is $0.9124$.", "answer": "$$\\boxed{0.9124}$$", "id": "2520685"}]}