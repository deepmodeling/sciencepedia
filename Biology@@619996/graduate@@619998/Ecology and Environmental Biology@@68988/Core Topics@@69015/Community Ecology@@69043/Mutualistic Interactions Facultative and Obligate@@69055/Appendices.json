{"hands_on_practices": [{"introduction": "Understanding mutualism begins with a precise definition of dependence. This first practice exercise asks you to formalize the concept of obligate mutualism using a classic population growth model. By analyzing the model's parameters, you will derive the condition under which a species cannot persist without its partner and calculate the critical density of the partner species required to prevent extinction [@problem_id:2511278]. This is a foundational skill for linking ecological definitions to quantitative dynamic models.", "problem": "Consider two interacting species, indexed by $i$ and $j$, that engage in a trophic mutualism. Let $N_i$ and $N_j$ denote their respective population densities (e.g., individuals per unit area). At low density of species $i$, assume its per capita growth rate is well-approximated by the additive contributions of density-independent births, density-independent deaths, weak intraspecific self-limitation, and a saturating mutualistic benefit provided by species $j$:\n$$\n\\frac{1}{N_i}\\frac{dN_i}{dt}\n\\;=\\;\nr_i \\;-\\; c_i \\;-\\; b_i N_i \\;+\\; \\frac{\\beta_{ij} N_j}{1 + h_{ij} N_j},\n$$\nwhere $r_i>0$ is the baseline per capita birth rate, $c_i>0$ is the baseline per capita mortality rate, $b_i>0$ is the intraspecific self-limitation coefficient for species $i$, $\\beta_{ij}>0$ sets the initial slope of the mutualistic benefit of partner $j$, and $h_{ij}>0$ is a saturation parameter that limits the per capita mutualistic gain to an asymptote as $N_j$ grows large. For the purpose of determining the minimal partner density required to prevent decline when species $i$ is rare, you may use the standard rare-invader approximation that the term $b_i N_i$ is negligible as $N_i \\to 0$.\n\nUsing only fundamental demographic definitions and the provided functional form, do the following:\n\n- Using the definition that a species is obligately dependent on its partner if it declines in the partner’s absence when rare, explain why the condition $r_i - c_i < 0$ implies obligate dependence of species $i$ on species $j$.\n- Compute the minimal partner density $N_j^\\ast$ such that the per capita growth rate of species $i$ is exactly zero when $N_i \\to 0$. Express $N_j^\\ast$ as a closed-form symbolic expression in terms of $r_i$, $c_i$, $\\beta_{ij}$, and $h_{ij}$. If evaluated numerically, $N_j^\\ast$ should be expressed in the same units as $N_j$ (e.g., individuals per unit area). Do not include units in the final boxed expression.", "solution": "The problem presented is a standard exercise in theoretical ecology concerning the dynamics of mutualistic interactions. It is scientifically grounded, well-posed, and contains all necessary information for a complete solution. We will proceed directly to the analysis.\n\nThe per capita growth rate of species $i$ is given by the equation:\n$$\n\\frac{1}{N_i}\\frac{dN_i}{dt}\n\\;=\\;\nr_i \\;-\\; c_i \\;-\\; b_i N_i \\;+\\; \\frac{\\beta_{ij} N_j}{1 + h_{ij} N_j}\n$$\nHere, $r_i$ is the per capita birth rate, $c_i$ is the per capita mortality rate, $b_i N_i$ represents intraspecific competition, and the final term is the saturating benefit from the mutualist partner, species $j$.\n\nFirst, we must explain why the condition $r_i - c_i < 0$ implies that species $i$ is an obligate mutualist with respect to species $j$. The definition provided is that a species is obligately dependent if it declines in its partner's absence when rare. Let us formalize this definition using the given model.\n\"In its partner's absence\" implies that the density of species $j$ is zero, $N_j = 0$.\n\"When rare\" implies that the density of species $i$ is infinitesimally small, $N_i \\to 0$. Under this condition, the problem statement specifies that the intraspecific self-limitation term, $b_i N_i$, is negligible and can be set to zero.\n\nWe substitute these two conditions, $N_j=0$ and $N_i \\to 0$, into the per capita growth rate equation:\n$$\n\\left. \\frac{1}{N_i}\\frac{dN_i}{dt} \\right|_{N_j=0, N_i \\to 0} \\;=\\; r_i - c_i - b_i(0) + \\frac{\\beta_{ij} (0)}{1 + h_{ij} (0)}\n$$\nThis simplifies to:\n$$\n\\left. \\frac{1}{N_i}\\frac{dN_i}{dt} \\right|_{N_j=0, N_i \\to 0} \\;=\\; r_i - c_i\n$$\nThe term $r_i - c_i$ is the intrinsic rate of natural increase (or decrease) for species $i$ in the absence of both its mutualist partner and density-dependent effects. For the population to decline (i.e., $\\frac{dN_i}{dt} < 0$), its per capita growth rate must be negative. Given that $N_i$ is a positive density, this requires $\\frac{1}{N_i}\\frac{dN_i}{dt} < 0$. Therefore, the condition for population decline in the absence of the partner is precisely $r_i - c_i < 0$. This demonstrates that if the baseline mortality rate $c_i$ exceeds the baseline birth rate $r_i$, the species cannot sustain itself without the benefit conferred by its mutualist partner and is, by definition, an obligate mutualist.\n\nNext, we compute the minimal partner density $N_j^\\ast$ required for species $i$ to have a zero per capita growth rate when it is rare. We again apply the rare-invader approximation, $N_i \\to 0$, which allows us to neglect the $b_i N_i$ term. We are seeking the density $N_j = N_j^\\ast$ at which the per capita growth rate is exactly zero.\nThe equation becomes:\n$$\n0 \\;=\\; r_i - c_i + \\frac{\\beta_{ij} N_j^\\ast}{1 + h_{ij} N_j^\\ast}\n$$\nTo solve for $N_j^\\ast$, we rearrange the equation. It is algebraically convenient to express the initial growth deficit as a positive quantity. As established, for an obligate mutualist, $r_i - c_i < 0$, which means $c_i - r_i > 0$.\n$$\nc_i - r_i \\;=\\; \\frac{\\beta_{ij} N_j^\\ast}{1 + h_{ij} N_j^\\ast}\n$$\nThis equation has a biologically meaningful solution ($N_j^\\ast > 0$) only if the left-hand side is positive, reaffirming that this minimal density concept is relevant only for obligate mutualists. We proceed with the algebraic manipulation:\n$$\n(c_i - r_i)(1 + h_{ij} N_j^\\ast) \\;=\\; \\beta_{ij} N_j^\\ast\n$$\nDistributing the term on the left-hand side:\n$$\n(c_i - r_i) + (c_i - r_i)h_{ij} N_j^\\ast \\;=\\; \\beta_{ij} N_j^\\ast\n$$\nWe collect all terms containing $N_j^\\ast$ on one side of the equation:\n$$\nc_i - r_i \\;=\\; \\beta_{ij} N_j^\\ast - (c_i - r_i)h_{ij} N_j^\\ast\n$$\nFactoring out $N_j^\\ast$:\n$$\nc_i - r_i \\;=\\; N_j^\\ast \\left( \\beta_{ij} - (c_i - r_i)h_{ij} \\right)\n$$\nFinally, we isolate $N_j^\\ast$ by dividing by its coefficient. For a positive solution $N_j^\\ast > 0$ to exist, the denominator must also be positive, since the numerator $c_i - r_i$ is positive. This implies the condition $\\beta_{ij} > (c_i - r_i)h_{ij}$, which means the maximum possible mutualistic benefit, $\\beta_{ij}/h_{ij}$, must exceed the intrinsic population deficit, $c_i - r_i$. Assuming this condition holds, the expression for the minimal partner density is:\n$$\nN_j^\\ast \\;=\\; \\frac{c_i - r_i}{\\beta_{ij} - (c_i - r_i)h_{ij}}\n$$\nThis is the required closed-form symbolic expression for the minimal partner density.", "answer": "$$\n\\boxed{\\frac{c_i - r_i}{\\beta_{ij} - h_{ij} (c_i - r_i)}}\n$$", "id": "2511278"}, {"introduction": "While the previous exercise examined the persistence condition for one obligate species, many mutualisms involve reciprocal dependence. This practice explores the dynamic consequences when two species are obligately dependent on each other, a scenario that often generates a strong Allee effect. You will use dynamical systems analysis to identify the existence of alternative stable states—coexistence versus collapse—and determine the critical threshold in initial population densities that separates these two fates [@problem_id:2511283]. This analysis highlights why the starting conditions can be just as important as the interaction rules for the long-term outcome of a mutualistic relationship.", "problem": "Two obligate mutualists, species $X$ and $Y$, interact via a saturating (Holling type II) mutualistic functional response and experience intraspecific self-limitation. The per-capita growth of each species is negative in the absence of its partner, representing obligate mutualism. A minimal, widely used formulation consistent with these assumptions is\n$$\n\\frac{dX}{dt} \\;=\\; X\\!\\left(-d \\;-\\; c\\,X \\;+\\; \\frac{\\alpha\\,Y}{H + Y}\\right), \n\\qquad\n\\frac{dY}{dt} \\;=\\; Y\\!\\left(-d \\;-\\; c\\,Y \\;+\\; \\frac{\\alpha\\,X}{H + X}\\right),\n$$\nwhere $d>0$ is the absolute value of the intrinsic per-capita decline rate in isolation (obligate dependence), $c>0$ quantifies intraspecific crowding (self-limitation), $\\alpha>0$ is the mutualistic benefit coefficient, and $H>0$ is the half-saturation constant of the mutualistic response. Assume parameters satisfy $\\,\\alpha > c\\,H + d + 2\\sqrt{c\\,d\\,H}\\,$ so that two distinct positive symmetric equilibria exist.\n\nStarting only from these equations and standard dynamical systems methods (nullclines, fixed points, and local linearization), derive the minimal equal initial densities for the two species that guarantee convergence to the positive coexistence equilibrium rather than collapse to extinction. Specifically, determine the critical value $s_{\\mathrm{crit}}$ such that if $X(0) \\ge s_{\\mathrm{crit}}$ and $Y(0) \\ge s_{\\mathrm{crit}}$, the trajectory converges to the stable positive coexistence equilibrium, whereas if at least one species starts below this threshold (and sufficiently close to it), the system collapses.\n\nExpress your final answer as a single closed-form analytic expression for the row vector $\\bigl(X_{\\mathrm{crit}},\\,Y_{\\mathrm{crit}}\\bigr)$ in terms of $\\alpha$, $c$, $d$, and $H$, where $X_{\\mathrm{crit}} = Y_{\\mathrm{crit}} = s_{\\mathrm{crit}}$. No numerical approximation is required and no units should be included in the final answer.", "solution": "The problem presented is a standard, well-posed problem in mathematical ecology concerning the dynamics of obligate mutualism. It is scientifically grounded, formally specified, and requires a rigorous application of dynamical systems theory. The premises are consistent and sufficient for a unique solution. I shall proceed with the derivation.\n\nThe system of differential equations describing the populations of the two species, $X$ and $Y$, is given by:\n$$\n\\frac{dX}{dt} = X f(X, Y) = X\\left(-d - cX + \\frac{\\alpha Y}{H + Y}\\right)\n$$\n$$\n\\frac{dY}{dt} = Y g(X, Y) = Y\\left(-d - cY + \\frac{\\alpha X}{H + X}\\right)\n$$\nwhere all parameters $d, c, \\alpha, H$ are positive constants. The problem asks for a critical initial density threshold, $s_{\\mathrm{crit}}$, that separates trajectories converging to a stable coexistence equilibrium from those collapsing to extinction.\n\nFirst, we must identify the equilibria, or fixed points, of the system, where $\\frac{dX}{dt} = 0$ and $\\frac{dY}{dt} = 0$.\nThe equations yield the following possibilities for non-negative populations:\n$1$. The trivial (extinction) equilibrium: $E_0 = (0, 0)$.\n$2$. Coexistence equilibria, where $X > 0$ and $Y > 0$. In this case, the per-capita growth rates must be zero:\n$$\n-d - cX + \\frac{\\alpha Y}{H + Y} = 0\n$$\n$$\n-d - cY + \\frac{\\alpha X}{H + X} = 0\n$$\nDue to the symmetric nature of the equations, we investigate symmetric equilibria where $X = Y = N^*$. Substituting this into either equation yields a single equation for $N^*$:\n$$\n-d - cN^* + \\frac{\\alpha N^*}{H + N^*} = 0\n$$\nTo solve for $N^*$, we eliminate the fraction by multiplying by $(H + N^*)$, which is non-zero for $N^* \\ge 0$:\n$$\n(-d - cN^*)(H + N^*) + \\alpha N^* = 0\n$$\n$$\n-dH - dN^* - cH N^* - c(N^*)^2 + \\alpha N^* = 0\n$$\nRearranging this into a standard quadratic form $a(N^*)^2 + b(N^*) + k = 0$:\n$$\nc(N^*)^2 + (d + cH - \\alpha)N^* + dH = 0\n$$\nThe roots of this quadratic equation are given by the quadratic formula:\n$$\nN^* = \\frac{- (d + cH - \\alpha) \\pm \\sqrt{(d + cH - \\alpha)^2 - 4cdH}}{2c}\n$$\n$$\nN^* = \\frac{\\alpha - d - cH \\pm \\sqrt{(\\alpha - d - cH)^2 - 4cdH}}{2c}\n$$\nThe problem provides the condition $\\alpha > c H + d + 2\\sqrt{c d H}$. This implies $\\alpha - (d+cH) > 2\\sqrt{cdH} > 0$. Squaring this inequality gives $(\\alpha - d - cH)^2 > 4cdH$. Thus, the discriminant is positive, and two distinct real roots for $N^*$ exist. Let us verify they are positive. The product of the roots is $\\frac{dH}{c} > 0$, so both roots have the same sign. The sum of the roots is $\\frac{\\alpha - d - cH}{c} > 0$. As both their sum and product are positive, both roots must be positive. We denote these two symmetric positive equilibria as $E_1 = (N_1^*, N_1^*)$ and $E_2 = (N_2^*, N_2^*)$, where:\n$$\nN_1^* = \\frac{\\alpha - d - cH - \\sqrt{(\\alpha - d - cH)^2 - 4cdH}}{2c}\n$$\n$$\nN_2^* = \\frac{\\alpha - d - cH + \\sqrt{(\\alpha - d - cH)^2 - 4cdH}}{2c}\n$$\nClearly, $0 < N_1^* < N_2^*$.\n\nNext, we determine the stability of these equilibria via local linearization. The Jacobian matrix of the system is:\n$$\nJ(X,Y) = \\begin{pmatrix} \\frac{\\partial}{\\partial X}(Xf) & \\frac{\\partial}{\\partial Y}(Xf) \\\\ \\frac{\\partial}{\\partial X}(Yg) & \\frac{\\partial}{\\partial Y}(Yg) \\end{pmatrix} = \\begin{pmatrix} f + X\\frac{\\partial f}{\\partial X} & X\\frac{\\partial f}{\\partial Y} \\\\ Y\\frac{\\partial g}{\\partial X} & g + Y\\frac{\\partial g}{\\partial Y} \\end{pmatrix}\n$$\nAt an equilibrium $(X^*, Y^*)$, $f(X^*, Y^*) = g(X^*, Y^*) = 0$. The partial derivatives are:\n$\\frac{\\partial f}{\\partial X} = -c$, $\\frac{\\partial f}{\\partial Y} = \\frac{\\alpha H}{(H+Y)^2}$, $\\frac{\\partial g}{\\partial X} = \\frac{\\alpha H}{(H+X)^2}$, $\\frac{\\partial g}{\\partial Y} = -c$.\nThe Jacobian evaluated at a symmetric equilibrium $(N^*, N^*)$ is:\n$$\nJ(N^*, N^*) = \\begin{pmatrix} -cN^* & \\frac{\\alpha H N^*}{(H+N^*)^2} \\\\ \\frac{\\alpha H N^*}{(H+N^*)^2} & -cN^* \\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ are the solutions to $\\det(J - \\lambda I) = 0$:\n$$\n(-cN^* - \\lambda)^2 - \\left(\\frac{\\alpha H N^*}{(H+N^*)^2}\\right)^2 = 0\n$$\nThis gives two eigenvalues:\n$$\n\\lambda_{1,2} = -cN^* \\pm \\frac{\\alpha H N^*}{(H+N^*)^2}\n$$\nThe eigenvalue $\\lambda_2 = -cN^* - \\frac{\\alpha H N^*}{(H+N^*)^2}$ is always negative. The stability of the equilibrium therefore depends on the sign of $\\lambda_1 = -cN^* + \\frac{\\alpha H N^*}{(H+N^*)^2}$.\nAn equilibrium is a stable node if both eigenvalues are negative ($\\lambda_1 < 0$). It is a saddle point if one is positive and one is negative ($\\lambda_1 > 0$).\nThe sign of $\\lambda_1$ is determined by the sign of $-c + \\frac{\\alpha H}{(H+N^*)^2}$. Let $r(N) = -d - cN + \\frac{\\alpha N}{H+N}$ be the per-capita growth rate on the diagonal $X=Y$. The equilibria $N_1^*$ and $N_2^*$ are the roots of $r(N) = 0$. The expression determining the sign of $\\lambda_1$ is $r'(N^*) = -c + \\frac{\\alpha H}{(H+N^*)^2}$. The function $r(N)$ is proportional to a downward-opening parabola in $N$ in the numerator, so $r(N)>0$ for $N \\in (N_1^*, N_2^*)$. Consequently, at the smaller root $N_1^*$, the function $r(N)$ must be increasing, so $r'(N_1^*) > 0$, implying $\\lambda_1 > 0$. At the larger root $N_2^*$, $r(N)$ must be decreasing, so $r'(N_2^*) < 0$, implying $\\lambda_1 < 0$.\nThus, $E_1 = (N_1^*, N_1^*)$ is a saddle point, and $E_2 = (N_2^*, N_2^*)$ is a stable node. The origin $E_0 = (0,0)$ can be shown to be a stable node, as the Jacobian there is $\\begin{pmatrix} -d & 0 \\\\ 0 & -d \\end{pmatrix}$, with eigenvalues $-d, -d$.\n\nThe phase space is partitioned into two basins of attraction: one for the extinction equilibrium $E_0$ and one for the coexistence equilibrium $E_2$. The boundary between these basins is the stable manifold of the saddle point $E_1$. This manifold is the separatrix. Trajectories starting on one side of the separatrix converge to $E_2$; those starting on the other side converge to $E_0$.\n\nThe problem seeks the minimal value $s_{\\mathrm{crit}}$ such that the region defined by $X(0) \\ge s_{\\mathrm{crit}}$ and $Y(0) \\ge s_{\\mathrm{crit}}$ lies entirely within the basin of attraction of $E_2$. Let this region be $\\mathcal{R}_s = [s, \\infty) \\times [s, \\infty)$. We seek $\\min\\{s | \\mathcal{R}_s \\subseteq \\mathcal{B}(E_2)\\}$.\nConsider the region $\\mathcal{R}_{N_1^*} = [N_1^*, \\infty) \\times [N_1^*, \\infty)$. We examine the vector field on its boundaries.\n$1$. On the lower boundary $Y = N_1^*, X \\ge N_1^*$: The outward normal vector is in the $-Y$ direction. The flow across this boundary is determined by the sign of $\\frac{dY}{dt}$.\n$$\n\\frac{dY}{dt} = N_1^* \\left(-d - cN_1^* + \\frac{\\alpha X}{H + X}\\right)\n$$\nUsing the equilibrium condition $-d - cN_1^* = -\\frac{\\alpha N_1^*}{H+N_1^*}$, we have:\n$$\n\\frac{dY}{dt} = N_1^* \\left(\\frac{\\alpha X}{H + X} - \\frac{\\alpha N_1^*}{H+N_1^*}\\right)\n$$\nSince the function $u \\mapsto \\frac{\\alpha u}{H+u}$ is strictly increasing for $u \\ge 0$, and $X \\ge N_1^*$, it follows that $\\frac{dY}{dt} \\ge 0$. The vector field points into or is tangent to the region $\\mathcal{R}_{N_1^*}$.\n$2$. On the left boundary $X = N_1^*, Y \\ge N_1^*$: By symmetry, $\\frac{dX}{dt} \\ge 0$. The vector field again points into or is tangent to the region.\n\nSince the flow on the finite boundaries of $\\mathcal{R}_{N_1^*}$ is directed into the region, $\\mathcal{R}_{N_1^*}$ is an invariant set (a trapping region). Any trajectory starting in $\\mathcal{R}_{N_1^*}$ (except at the saddle point $E_1$ itself) cannot leave and must converge to an equilibrium within it. As $E_2$ is the only stable equilibrium in this region, all such trajectories converge to $E_2$. Therefore, $\\mathcal{R}_{N_1^*} \\setminus \\{E_1\\} \\subset \\mathcal{B}(E_2)$.\n\nTo establish minimality, we must show that for any $s < N_1^*$, the region $\\mathcal{R}_s$ is not entirely contained in $\\mathcal{B}(E_2)$. Consider the point $(s,s)$ where $s < N_1^*$. This point lies on the line $X=Y$. The dynamics on this line are governed by the one-dimensional equation $\\frac{dN}{dt} = N r(N)$. For $N \\in (0, N_1^*)$, we have $r(N)<0$, so $\\frac{dN}{dt} < 0$. Thus, any trajectory starting at $(s,s)$ with $s \\in (0, N_1^*)$ will converge to the origin $E_0$. This means $(s,s) \\in \\mathcal{B}(E_0)$, so $\\mathcal{R}_s$ is not fully contained in $\\mathcal{B}(E_2)$.\n\nTherefore, the minimal value for the threshold is $s_{\\mathrm{crit}} = N_1^*$. The problem asks for the vector $(X_{\\mathrm{crit}}, Y_{\\mathrm{crit}}) = (s_{\\mathrm{crit}}, s_{\\mathrm{crit}})$. The value is the smaller root of the quadratic equation derived earlier.\n\n$$\ns_{\\mathrm{crit}} = N_1^* = \\frac{\\alpha - d - cH - \\sqrt{(\\alpha - d - cH)^2 - 4cdH}}{2c}\n$$\nThus, the critical initial densities are $X_{\\mathrm{crit}} = Y_{\\mathrm{crit}} = s_{\\mathrm{crit}}$.", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\alpha - d - cH - \\sqrt{(\\alpha - d - cH)^{2} - 4cdH}}{2c} & \\frac{\\alpha - d - cH - \\sqrt{(\\alpha - d - cH)^{2} - 4cdH}}{2c} \\end{pmatrix}}\n$$", "id": "2511283"}, {"introduction": "The theoretical concepts of facultative and obligate mutualism are clear-cut, but classifying real-world interactions is often complicated by noisy data and natural variability. This final practice bridges the gap between theory and data analysis by applying a modern statistical approach to the problem. You will implement a Bayesian hierarchical model to calculate the posterior probability that a species is an obligate mutualist, given a set of growth rate measurements [@problem_id:2511253]. This exercise demonstrates how to formalize ecological hypotheses within a rigorous statistical framework, a crucial skill in contemporary ecological research.", "problem": "Consider a species that interacts mutualistically with a partner. Across multiple ecological sites and two experimental conditions—partner absent and partner present—you observe replicate estimates of its per capita growth rate. Assume that per capita growth is measured as a dimensionless daily rate; the final outputs in this problem are probabilities and therefore unitless decimals. Distinguish between two ecological hypotheses for the species: obligate mutualism versus facultative mutualism. We formalize these hypotheses using a Bayesian hierarchical model grounded in two fundamental bases: (i) the definition that an obligate mutualist has nonpositive expected growth without its partner, while a facultative mutualist has nonnegative expected growth without its partner; (ii) the well-tested assumption that aggregated ecological growth measurements under repeated sampling are well approximated by Gaussian (normal) distributions at multiple hierarchical levels due to the Central Limit Theorem (CLT).\n\nModel the data as follows. For each site index $s \\in \\{1,\\dots,S\\}$, condition indicator $c \\in \\{0,1\\}$ with $c=0$ denoting partner absent and $c=1$ denoting partner present, and replicate index $r \\in \\{1,\\dots,n_{s,c}\\}$,\n$$\ny_{s,c,r} \\mid m_{s,c}, \\sigma^2 \\sim \\mathcal{N}(m_{s,c}, \\sigma^2),\n$$\n$$\nm_{s,c} \\mid \\mu_c, \\tau_c^2 \\sim \\mathcal{N}(\\mu_c, \\tau_c^2).\n$$\nHere $y_{s,c,r}$ is the growth observation, $m_{s,c}$ is the latent site-level mean for condition $c$, $\\mu_c$ is the across-site mean for condition $c$, $\\sigma^2$ is the known within-site measurement variance, and $\\tau_c^2$ is the known between-site variance for condition $c$. Let the prior for the across-site mean under partner present be the same under both hypotheses and constrained to be positive,\n$$\n\\mu_1 \\sim \\mathcal{N}(m_1, s_1^2) \\text{ truncated to } (0,\\infty).\n$$\nFor the across-site mean under partner absent, use a truncated normal prior that encodes each hypothesis:\n- Obligate mutualism hypothesis $\\mathcal{M}_{\\mathrm{obl}}$: \n$$\n\\mu_0 \\sim \\mathcal{N}(m_0, s_0^2) \\text{ truncated to } (-\\infty, 0].\n$$\n- Facultative mutualism hypothesis $\\mathcal{M}_{\\mathrm{fac}}$:\n$$\n\\mu_0 \\sim \\mathcal{N}(m_0, s_0^2) \\text{ truncated to } [0, \\infty).\n$$\nLet the prior probability of the obligate hypothesis be $\\pi \\in (0,1)$ and the facultative hypothesis be $1-\\pi$. Because the prior and likelihood for $\\mu_1$ are identical under the two hypotheses, the Bayes factor that compares $\\mathcal{M}_{\\mathrm{obl}}$ to $\\mathcal{M}_{\\mathrm{fac}}$ depends only on the partner-absent data ($c=0$). Define the site-level sample mean for partner-absent data as\n$$\n\\bar{y}_{s,0} = \\frac{1}{n_{s,0}} \\sum_{r=1}^{n_{s,0}} y_{s,0,r},\n$$\nwith effective variance\n$$\nV_{s,0} = \\tau_0^2 + \\frac{\\sigma^2}{n_{s,0}}.\n$$\nThen the marginalized likelihood of the set $\\{\\bar{y}_{s,0}\\}_{s=1}^{S}$ under an untruncated normal prior $\\mu_0 \\sim \\mathcal{N}(m_0, s_0^2)$ is available in closed form. If we write\n$$\na = \\sum_{s=1}^{S} \\frac{1}{V_{s,0}}, \\quad b = \\sum_{s=1}^{S} \\frac{\\bar{y}_{s,0}}{V_{s,0}}, \\quad c = \\sum_{s=1}^{S} \\frac{\\bar{y}_{s,0}^2}{V_{s,0}},\n$$\nthen the untruncated posterior for $\\mu_0$ is $\\mathcal{N}(m_n, s_n^2)$ with\n$$\ns_n^2 = \\frac{1}{a + \\frac{1}{s_0^2}}, \\quad m_n = s_n^2 \\left(b + \\frac{m_0}{s_0^2}\\right).\n$$\nLet $\\phi(\\cdot)$ and $\\Phi(\\cdot)$ denote the standard normal probability density function and cumulative distribution function, respectively. The marginal likelihood under a truncated prior equals the untruncated marginal likelihood multiplied by a ratio of normalizing constants for the truncated normal prior and the truncated normal posterior, which are $\\Phi$-terms evaluated at the truncation boundaries. Concretely, if $\\mathcal{L}_{\\mathrm{untr}}$ denotes the untruncated marginal likelihood of $\\{\\bar{y}_{s,0}\\}$ given $(m_0, s_0^2)$, then\n$$\n\\mathcal{L}_{\\mathrm{obl}} = \\mathcal{L}_{\\mathrm{untr}} \\cdot \\frac{\\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)}{\\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)}, \\quad\n\\mathcal{L}_{\\mathrm{fac}} = \\mathcal{L}_{\\mathrm{untr}} \\cdot \\frac{1 - \\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)}{1 - \\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)}.\n$$\nFinally, the posterior probability that the species is obligate is given by Bayes’s theorem:\n$$\n\\mathbb{P}(\\mathcal{M}_{\\mathrm{obl}} \\mid \\text{data}) = \\frac{\\pi \\, \\mathcal{L}_{\\mathrm{obl}}}{\\pi \\, \\mathcal{L}_{\\mathrm{obl}} + (1-\\pi) \\, \\mathcal{L}_{\\mathrm{fac}}}.\n$$\n\nYour task is to implement a program that computes $\\mathbb{P}(\\mathcal{M}_{\\mathrm{obl}} \\mid \\text{data})$ for a small test suite of datasets. For each dataset, you are given the partner-absent and partner-present replicate observations by site (use the partner-present data only to acknowledge that conditions exist; it cancels from the comparison given the identical specification under both hypotheses), along with the known parameters $(\\sigma, \\tau_0, m_0, s_0, \\pi)$. All answers must be decimals and unitless. The required final output format is a single line containing a list of the posterior probabilities for the obligate hypothesis for each dataset, rounded to $6$ decimal places, as a comma-separated list enclosed in square brackets (for example, $[0.731000,0.502345]$).\n\nUse the following test suite. Each dataset contains site-wise replicate observations under partner-absent ($c=0$) and partner-present ($c=1$) conditions. In all cases, take $\\tau_1$ and the prior on $\\mu_1$ to be identical across hypotheses, so that the contribution of $c=1$ cancels and does not enter the computation. You must use only the partner-absent data for the computation described above.\n\n- Dataset A (clear obligate-like pattern): $\\sigma = 0.05$, $\\tau_0 = 0.10$, $m_0 = 0.0$, $s_0 = 0.5$, $\\pi = 0.5$.\n  - Sites and replicates, partner absent ($c=0$):\n    - Site $1$: $[-0.32,-0.28,-0.30]$\n    - Site $2$: $[-0.12,-0.08,-0.10]$\n    - Site $3$: $[-0.22,-0.25,-0.18]$\n  - Sites and replicates, partner present ($c=1$) [included for completeness; does not affect comparison]:\n    - Site $1$: $[0.55,0.62,0.58]$\n    - Site $2$: $[0.41,0.37,0.44]$\n    - Site $3$: $[0.66,0.61,0.63]$\n\n- Dataset B (clear facultative-like pattern): $\\sigma = 0.05$, $\\tau_0 = 0.10$, $m_0 = 0.0$, $s_0 = 0.5$, $\\pi = 0.5$.\n  - Partner absent ($c=0$):\n    - Site $1$: $[0.22,0.18,0.25]$\n    - Site $2$: $[0.35,0.29,0.31]$\n    - Site $3$: $[0.12,0.15,0.17]$\n  - Partner present ($c=1$):\n    - Site $1$: $[0.48,0.52,0.50]$\n    - Site $2$: $[0.62,0.58,0.60]$\n    - Site $3$: $[0.40,0.43,0.41]$\n\n- Dataset C (ambiguous near-zero pattern with fewer replicates): $\\sigma = 0.10$, $\\tau_0 = 0.10$, $m_0 = 0.0$, $s_0 = 0.5$, $\\pi = 0.5$.\n  - Partner absent ($c=0$):\n    - Site $1$: $[-0.03,0.01]$\n    - Site $2$: $[0.02,-0.01]$\n    - Site $3$: $[0.00,0.03]$\n  - Partner present ($c=1$):\n    - Site $1$: $[0.25,0.28]$\n    - Site $2$: $[0.30,0.34]$\n    - Site $3$: $[0.26,0.29]$\n\n- Dataset D (boundary case: high noise and single replicate per site): $\\sigma = 0.20$, $\\tau_0 = 0.15$, $m_0 = 0.0$, $s_0 = 0.5$, $\\pi = 0.5$.\n  - Partner absent ($c=0$):\n    - Site $1$: $[0.10]$\n    - Site $2$: $[-0.05]$\n    - Site $3$: $[0.02]$\n    - Site $4$: $[-0.01]$\n  - Partner present ($c=1$):\n    - Site $1$: $[0.20]$\n    - Site $2$: $[0.18]$\n    - Site $3$: $[0.22]$\n    - Site $4$: $[0.19]$\n\nYour program should produce a single line of output containing the posterior probabilities for $\\mathcal{M}_{\\mathrm{obl}}$ for the four datasets, in the exact format $[p_A,p_B,p_C,p_D]$, where each $p_{\\cdot}$ is rounded to $6$ decimal places.", "solution": "We formalize the ecological decision between obligate and facultative mutualism using a Bayesian hierarchical normal model with truncated priors reflecting the core ecological definitions: an obligate mutualist has nonpositive expected growth without its partner, while a facultative mutualist has nonnegative expected growth without its partner. The modeling begins with Gaussian likelihoods for replicate observations, justified by the Central Limit Theorem (CLT), and Gaussian random effects for site-level means.\n\nStep $1$: Likelihood reduction via site means. For partner-absent data ($c=0$), for each site $s$ with $n_{s,0}$ replicates, define the sample mean $\\bar{y}_{s,0} = \\frac{1}{n_{s,0}} \\sum_{r=1}^{n_{s,0}} y_{s,0,r}$. Integrating the site-level mean $m_{s,0}$ from the hierarchical model\n$$\ny_{s,0,r} \\mid m_{s,0} \\sim \\mathcal{N}(m_{s,0}, \\sigma^2), \\quad m_{s,0} \\mid \\mu_0 \\sim \\mathcal{N}(\\mu_0, \\tau_0^2)\n$$\nleads to the independent marginal distribution for site means\n$$\n\\bar{y}_{s,0} \\mid \\mu_0 \\sim \\mathcal{N}\\!\\left(\\mu_0, V_{s,0}\\right), \\quad V_{s,0} = \\tau_0^2 + \\frac{\\sigma^2}{n_{s,0}}.\n$$\nThe within-site sums of squares contribute multiplicative constants that are the same under both hypotheses and thus cancel in model comparison; sufficiency is carried by the $\\bar{y}_{s,0}$ and $V_{s,0}$.\n\nStep $2$: Conjugate update under an untruncated prior. Suppose $\\mu_0 \\sim \\mathcal{N}(m_0, s_0^2)$ without truncation. Define precision-weighted summaries\n$$\na = \\sum_{s=1}^{S} \\frac{1}{V_{s,0}}, \\quad b = \\sum_{s=1}^{S} \\frac{\\bar{y}_{s,0}}{V_{s,0}}, \\quad c = \\sum_{s=1}^{S} \\frac{\\bar{y}_{s,0}^2}{V_{s,0}}.\n$$\nBy normal-normal conjugacy, the untruncated posterior for $\\mu_0$ is $\\mathcal{N}(m_n, s_n^2)$ with\n$$\ns_n^2 = \\frac{1}{a + \\frac{1}{s_0^2}}, \\quad m_n = s_n^2 \\left(b + \\frac{m_0}{s_0^2}\\right).\n$$\nThe untruncated marginal likelihood (evidence) is obtained by integrating the product of the Gaussian likelihood and Gaussian prior over $\\mu_0$. Accounting for normalizing constants explicitly, the untruncated evidence equals\n$$\n\\mathcal{L}_{\\mathrm{untr}} = \\left[\\prod_{s=1}^{S} \\frac{1}{\\sqrt{2\\pi V_{s,0}}}\\right] \\cdot \\sqrt{\\frac{s_n^2}{s_0^2}} \\cdot \\exp\\!\\left\\{-\\frac{1}{2}\\left[c + \\frac{m_0^2}{s_0^2} - s_n^2\\left(b + \\frac{m_0}{s_0^2}\\right)^2\\right]\\right\\}.\n$$\nThis arises from completing the square in the exponent and integrating a Gaussian over $\\mu_0$:\n$$\n\\int \\exp\\!\\left(-\\frac{1}{2}\\left[(a+\\frac{1}{s_0^2})\\mu_0^2 - 2\\left(b + \\frac{m_0}{s_0^2}\\right)\\mu_0 + c + \\frac{m_0^2}{s_0^2}\\right]\\right) \\frac{d\\mu_0}{\\sqrt{2\\pi s_0^2}} = \\sqrt{\\frac{s_n^2}{s_0^2}} \\exp\\!\\left(-\\frac{1}{2}\\left[c + \\frac{m_0^2}{s_0^2} - \\frac{\\left(b + \\frac{m_0}{s_0^2}\\right)^2}{\\frac{1}{s_n^2}}\\right]\\right),\n$$\nand $\\frac{1}{s_n^2} = a + \\frac{1}{s_0^2}$.\n\nStep $3$: Truncated priors and the evidence ratio. Under a truncated normal prior on $\\mu_0$, the prior density equals the untruncated normal density divided by a normalizing constant (a tail probability of a Gaussian), and the posterior density is the untruncated posterior Gaussian divided by the corresponding posterior tail probability. Therefore, the truncated-prior marginal likelihood equals the untruncated marginal likelihood multiplied by the ratio of the posterior truncation normalizer to the prior truncation normalizer. For truncation set $A = (-\\infty, 0]$, the normalizers are $\\Phi\\!\\left(\\frac{0 - m}{s}\\right)$ for a Gaussian $\\mathcal{N}(m,s^2)$. Consequently,\n$$\n\\mathcal{L}_{\\mathrm{obl}} = \\mathcal{L}_{\\mathrm{untr}} \\cdot \\frac{\\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)}{\\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)}.\n$$\nFor truncation set $A = [0, \\infty)$, the normalizers are $1 - \\Phi\\!\\left(\\frac{0 - m}{s}\\right)$, giving\n$$\n\\mathcal{L}_{\\mathrm{fac}} = \\mathcal{L}_{\\mathrm{untr}} \\cdot \\frac{1 - \\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)}{1 - \\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)}.\n$$\nBecause the partner-present parameter $\\mu_1$ has the same truncated prior under both hypotheses and the same likelihood structure, its contribution cancels in the Bayes factor between $\\mathcal{M}_{\\mathrm{obl}}$ and $\\mathcal{M}_{\\mathrm{fac}}$. Thus only $c=0$ data enter the odds.\n\nStep $4$: Posterior model probability. With prior probability $\\pi$ on $\\mathcal{M}_{\\mathrm{obl}}$, Bayes’s theorem yields\n$$\n\\mathbb{P}(\\mathcal{M}_{\\mathrm{obl}} \\mid \\text{data}) = \\frac{\\pi \\, \\mathcal{L}_{\\mathrm{obl}}}{\\pi \\, \\mathcal{L}_{\\mathrm{obl}} + (1-\\pi) \\, \\mathcal{L}_{\\mathrm{fac}}}.\n$$\nFor numerical stability, compute all likelihoods in log-space and use the log-sum-exp trick. Specifically, define\n$$\n\\ell_{\\mathrm{untr}} = \\log \\mathcal{L}_{\\mathrm{untr}} = -\\frac{1}{2} \\sum_{s=1}^{S} \\log(2\\pi V_{s,0}) + \\frac{1}{2}\\left(\\log s_n^2 - \\log s_0^2\\right) - \\frac{1}{2}\\left[c + \\frac{m_0^2}{s_0^2} - s_n^2 \\left(b + \\frac{m_0}{s_0^2}\\right)^2\\right],\n$$\nthen\n$$\n\\ell_{\\mathrm{obl}} = \\ell_{\\mathrm{untr}} + \\log \\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right) - \\log \\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right),\n$$\n$$\n\\ell_{\\mathrm{fac}} = \\ell_{\\mathrm{untr}} + \\log\\!\\left(1 - \\Phi\\!\\left(\\frac{0 - m_n}{s_n}\\right)\\right) - \\log\\!\\left(1 - \\Phi\\!\\left(\\frac{0 - m_0}{s_0}\\right)\\right).\n$$\nFinally,\n$$\n\\log \\text{num} = \\log \\pi + \\ell_{\\mathrm{obl}}, \\quad \\log \\text{alt} = \\log (1-\\pi) + \\ell_{\\mathrm{fac}},\n$$\n$$\n\\mathbb{P}(\\mathcal{M}_{\\mathrm{obl}} \\mid \\text{data}) = \\frac{\\exp(\\log \\text{num})}{\\exp(\\log \\text{num}) + \\exp(\\log \\text{alt})}.\n$$\n\nStep $5$: Algorithm. For each dataset:\n- Compute site-wise means $\\bar{y}_{s,0}$ and counts $n_{s,0}$ from the partner-absent replicates.\n- Compute $V_{s,0} = \\tau_0^2 + \\sigma^2 / n_{s,0}$, then $(a,b,c)$, and $(s_n^2, m_n)$.\n- Compute $\\ell_{\\mathrm{untr}}$, $\\ell_{\\mathrm{obl}}$, $\\ell_{\\mathrm{fac}}$, and the posterior probability using the log-sum-exp approach.\n- Round the result to $6$ decimals.\n\nEdge cases in the provided test suite include clear separation (Dataset A and Dataset B), ambiguity near the ecological threshold at zero (Dataset C), and low-information settings with high noise and single replicates (Dataset D). These probe how the hierarchical pooling and the truncation-based ecological constraints combine to yield principled posterior probabilities rather than deterministic classifications.\n\nThe final program implements this procedure for all four datasets and prints a single line: $[p_A,p_B,p_C,p_D]$, where each $p_{\\cdot}$ is rounded to $6$ decimals.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef log_untruncated_evidence(ybars, ns, sigma, tau0, m0, s0):\n    \"\"\"\n    Compute log L_untr for partner-absent data under hierarchical normal model\n    with known sigma, tau0, and untruncated prior mu0 ~ N(m0, s0^2).\n    Uses sufficient statistics of site means and their variances.\n    \"\"\"\n    ybars = np.array(ybars, dtype=float)\n    ns = np.array(ns, dtype=float)\n    Vs = tau0**2 + (sigma**2) / ns  # Effective variances for site means\n    inv_Vs = 1.0 / Vs\n\n    a = np.sum(inv_Vs)\n    b = np.sum(ybars * inv_Vs)\n    c = np.sum((ybars ** 2) * inv_Vs)\n\n    inv_s0_sq = 1.0 / (s0 ** 2)\n    sn2 = 1.0 / (a + inv_s0_sq)\n    mn = sn2 * (b + m0 * inv_s0_sq)\n\n    # Log of untruncated evidence\n    # sum log(2π V_s)\n    sum_log_terms = np.sum(np.log(2.0 * np.pi * Vs))\n    term_const = -0.5 * sum_log_terms\n    term_scale = 0.5 * (np.log(sn2) - np.log(s0 ** 2))\n    quad = -0.5 * (c + (m0 ** 2) * inv_s0_sq - sn2 * (b + m0 * inv_s0_sq) ** 2)\n    logL = term_const + term_scale + quad\n    return logL, mn, np.sqrt(sn2)\n\ndef log_truncation_ratio(m, s, m0, s0, side):\n    \"\"\"\n    Compute log of the ratio of truncation normalizers Posterior/Prior\n    for side in {'le0', 'ge0'} corresponding to (-inf, 0] or [0, inf).\n    \"\"\"\n    # Compute prior and posterior tail CDFs at 0\n    if side == 'le0':\n        # (-inf, 0]\n        post_tail = norm.logcdf((0.0 - m) / s)\n        prior_tail = norm.logcdf((0.0 - m0) / s0)\n    elif side == 'ge0':\n        # [0, inf) -> log(1 - Phi)\n        # Use logsf for numerical stability\n        post_tail = norm.logsf((0.0 - m) / s)  # log(1 - Phi)\n        prior_tail = norm.logsf((0.0 - m0) / s0)\n    else:\n        raise ValueError(\"side must be 'le0' or 'ge0'\")\n    return post_tail - prior_tail\n\ndef posterior_prob_obligate(absent_sites, sigma, tau0, m0, s0, pi_obl):\n    \"\"\"\n    Compute P(obligate | data) given:\n    - absent_sites: list of lists of replicates per site under c=0\n    - sigma: known within-site sd\n    - tau0: known between-site sd for c=0\n    - m0, s0: prior mean and sd for mu0 (before truncation)\n    - pi_obl: prior probability of obligate hypothesis\n    \"\"\"\n    # Compute site means and counts\n    ybars = []\n    ns = []\n    for reps in absent_sites:\n        arr = np.array(reps, dtype=float)\n        ybars.append(float(np.mean(arr)))\n        ns.append(int(len(arr)))\n    # Untruncated evidence and posterior params\n    logL_untr, mn, sn = log_untruncated_evidence(ybars, ns, sigma, tau0, m0, s0)\n    # Truncation ratios for obligate (=0) and facultative (>=0)\n    log_ratio_obl = log_truncation_ratio(mn, sn, m0, s0, side='le0')\n    log_ratio_fac = log_truncation_ratio(mn, sn, m0, s0, side='ge0')\n    logL_obl = logL_untr + log_ratio_obl\n    logL_fac = logL_untr + log_ratio_fac\n    # Posterior model probability using log-sum-exp\n    log_num = np.log(pi_obl) + logL_obl\n    log_alt = np.log(1.0 - pi_obl) + logL_fac\n    # Normalize\n    m = max(log_num, log_alt)\n    denom = m + np.log(np.exp(log_num - m) + np.exp(log_alt - m))\n    p_obl = np.exp(log_num - denom)\n    return p_obl\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (absent_sites, present_sites, sigma, tau0, m0, s0, pi)\n    # present_sites included for completeness; not used in computation.\n    test_cases = [\n        (\n            [[-0.32, -0.28, -0.30],\n             [-0.12, -0.08, -0.10],\n             [-0.22, -0.25, -0.18]],\n            [[0.55, 0.62, 0.58],\n             [0.41, 0.37, 0.44],\n             [0.66, 0.61, 0.63]],\n            0.05, 0.10, 0.0, 0.5, 0.5\n        ),\n        (\n            [[0.22, 0.18, 0.25],\n             [0.35, 0.29, 0.31],\n             [0.12, 0.15, 0.17]],\n            [[0.48, 0.52, 0.50],\n             [0.62, 0.58, 0.60],\n             [0.40, 0.43, 0.41]],\n            0.05, 0.10, 0.0, 0.5, 0.5\n        ),\n        (\n            [[-0.03, 0.01],\n             [0.02, -0.01],\n             [0.00, 0.03]],\n            [[0.25, 0.28],\n             [0.30, 0.34],\n             [0.26, 0.29]],\n            0.10, 0.10, 0.0, 0.5, 0.5\n        ),\n        (\n            [[0.10],\n             [-0.05],\n             [0.02],\n             [-0.01]],\n            [[0.20],\n             [0.18],\n             [0.22],\n             [0.19]],\n            0.20, 0.15, 0.0, 0.5, 0.5\n        ),\n    ]\n\n    results = []\n    for case in test_cases:\n        absent_sites, present_sites, sigma, tau0, m0, s0, pi = case\n        p = posterior_prob_obligate(absent_sites, sigma, tau0, m0, s0, pi)\n        # Round to 6 decimal places\n        results.append(f\"{p:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2511253"}]}