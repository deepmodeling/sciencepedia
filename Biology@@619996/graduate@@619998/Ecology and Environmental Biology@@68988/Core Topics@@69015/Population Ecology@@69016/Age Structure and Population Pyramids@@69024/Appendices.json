{"hands_on_practices": [{"introduction": "Life tables are the bedrock of demographic analysis, providing a systematic summary of survival and reproduction patterns across a population's lifespan. This exercise focuses on the fundamental mechanics of a life table, asking you to derive core parameters such as age-specific survival ($p_x$) and mortality ($q_x$) probabilities, as well as remaining life expectancy ($e_x$), directly from a cohort's survivorship schedule ($l_x$). Mastering these calculations [@problem_id:2468956] is the first step toward understanding how an organism's life history translates into population-level dynamics and the resulting age structure.", "problem": "A structured population is monitored in discrete time with annual age classes of width $1$ year, and survivorship and fecundity are measured at exact integer ages. Let $l_x$ denote the survivorship function, interpreted as the probability that a newborn survives to exact age $x$, and let $m_x$ denote the per-capita fertility (offspring per individual per year) at exact age $x$. Define $p_x$ as the conditional probability of surviving from age $x$ to age $x+1$, $q_x$ as the conditional probability of dying in the interval $[x,x+1)$ given alive at age $x$, and $e_x$ as the remaining life expectancy at exact age $x$ (expected additional years lived).\n\nUsing only the core definitions of conditional probability and mathematical expectation, derive general expressions that relate $p_x$ and $q_x$ to $l_x$, and express $e_x$ in terms of $l_x$ under the standard life-table assumption that deaths are spread uniformly within each $1$-year interval.\n\nThen, consider a short-lived species with maximum age $5$ years, for which there are no survivors at exact age $5$ (that is, $l_5 = 0$). The measured schedules are:\n- Exact ages $x \\in \\{0,1,2,3,4,5\\}$.\n- Survivorship values: $l_0 = 1.00$, $l_1 = 0.88$, $l_2 = 0.74$, $l_3 = 0.55$, $l_4 = 0.30$, $l_5 = 0.00$.\n- Fertility values: $m_0 = 0$, $m_1 = 0$, $m_2 = 1.30$, $m_3 = 1.10$, $m_4 = 0.20$, $m_5 = 0$.\n\nCompute the full sequences $\\{p_x\\}$ and $\\{q_x\\}$ for $x \\in \\{0,1,2,3,4\\}$ and the remaining life expectancy $e_1$. Briefly interpret how the computed $\\{p_x\\}$, $\\{q_x\\}$, and $\\{e_x\\}$ together with $\\{m_x\\}$ inform expectations about the population’s age structure (for example, whether the age pyramid is bottom-heavy or top-heavy). Report only the numerical value of $e_1$ as your final answer, rounded to four significant figures. Express the final life expectancy in years.", "solution": "The problem requires the derivation of fundamental life-table parameters and their application to a specific dataset for a short-lived species. The problem statement is scientifically sound, well-posed, and contains all necessary information for its resolution.\n\nFirst, we derive the general expressions as required.\n\nThe survivorship function, $l_x$, is the probability that a newborn individual survives to attain exact age $x$. The function $l_x$ is, by definition, monotonically non-increasing, with $l_0 = 1$.\n\nThe parameter $p_x$ is the conditional probability that an individual alive at age $x$ will survive to age $x+1$. Using the formal definition of conditional probability, $P(A|B) = \\frac{P(A \\cap B)}{P(B)}$, we let event $B$ be \"survival to age $x$\" and event $A$ be \"survival to age $x+1$\". The probability of event $B$ is $P(B) = l_x$. The event \"survival to age $x+1$\" is a subset of the event \"survival to age $x$\". Thus, the intersection $A \\cap B$ is simply event $A$, and its probability is $P(A) = l_{x+1}$.\nTherefore, the expression for $p_x$ is:\n$$p_x = \\frac{l_{x+1}}{l_x}$$\n\nThe parameter $q_x$ is the conditional probability that an individual alive at age $x$ will die within the age interval $[x, x+1)$. For an individual alive at age $x$, there are only two possible outcomes in the next year: survival to age $x+1$ or death before age $x+1$. These are mutually exclusive and exhaustive events. Thus, their probabilities must sum to $1$.\n$$p_x + q_x = 1$$\nFrom this, we derive the expression for $q_x$ in terms of $p_x$ and subsequently in terms of $l_x$:\n$$q_x = 1 - p_x = 1 - \\frac{l_{x+1}}{l_x} = \\frac{l_x - l_{x+1}}{l_x}$$\nThe numerator, $l_x - l_{x+1}$, represents the probability that a newborn dies in the age interval $[x, x+1)$.\n\nNext, we derive the expression for the remaining life expectancy at age $x$, denoted $e_x$. This is the expected number of additional years an individual of age $x$ will live. We are given the standard assumption that deaths are uniformly distributed within any $1$-year age interval.\nLet $L_i$ be the number of person-years lived by the cohort in the age interval $[i, i+1)$. Under the uniform distribution of deaths assumption, $L_i$ is the average of the number of individuals alive at the start and end of the interval, which from a cohort of size $l_0=1$ is $L_i = \\frac{l_i + l_{i+1}}{2}$.\nThe total number of person-years lived by the cohort from age $x$ onwards is $T_x = \\sum_{i=x}^{\\omega-1} L_i$, where $\\omega$ is the maximum age at which no individuals survive (i.e., $l_\\omega=0$).\nThe life expectancy $e_x$ is the average of these future person-years over the $l_x$ individuals who are alive at age $x$.\n$$e_x = \\frac{T_x}{l_x} = \\frac{1}{l_x} \\sum_{i=x}^{\\omega-1} L_i$$\nSubstituting the expression for $L_i$:\n$$e_x = \\frac{1}{l_x} \\sum_{i=x}^{\\omega-1} \\frac{l_i + l_{i+1}}{2}$$\nThis is the required general expression for $e_x$.\n\nNow, we apply these formulae to the specific data provided for the species.\nThe data are: $\\omega=5$, $l_0 = 1.00$, $l_1 = 0.88$, $l_2 = 0.74$, $l_3 = 0.55$, $l_4 = 0.30$, and $l_5 = 0.00$. The fertility schedule is $m_0 = 0$, $m_1 = 0$, $m_2 = 1.30$, $m_3 = 1.10$, $m_4 = 0.20$, and $m_5 = 0$.\n\nWe compute the sequence $\\{p_x\\}$ for $x \\in \\{0,1,2,3,4\\}$:\n$p_0 = \\frac{l_1}{l_0} = \\frac{0.88}{1.00} = 0.88$\n$p_1 = \\frac{l_2}{l_1} = \\frac{0.74}{0.88} \\approx 0.8409$\n$p_2 = \\frac{l_3}{l_2} = \\frac{0.55}{0.74} \\approx 0.7432$\n$p_3 = \\frac{l_4}{l_3} = \\frac{0.30}{0.55} \\approx 0.5455$\n$p_4 = \\frac{l_5}{l_4} = \\frac{0.00}{0.30} = 0.00$\n\nWe compute the sequence $\\{q_x\\}$ for $x \\in \\{0,1,2,3,4\\}$ using $q_x=1-p_x$:\n$q_0 = 1 - 0.88 = 0.12$\n$q_1 = 1 - \\frac{0.74}{0.88} = \\frac{0.14}{0.88} \\approx 0.1591$\n$q_2 = 1 - \\frac{0.55}{0.74} = \\frac{0.19}{0.74} \\approx 0.2568$\n$q_3 = 1 - \\frac{0.30}{0.55} = \\frac{0.25}{0.55} \\approx 0.4545$\n$q_4 = 1 - 0.00 = 1.00$\n\nWe compute the remaining life expectancy at age $1$, $e_1$. With $x=1$ and $\\omega=5$:\n$$e_1 = \\frac{1}{l_1} \\sum_{i=1}^{4} \\frac{l_i + l_{i+1}}{2} = \\frac{1}{l_1} \\left( \\frac{l_1+l_2}{2} + \\frac{l_2+l_3}{2} + \\frac{l_3+l_4}{2} + \\frac{l_4+l_5}{2} \\right)$$\nFirst, we calculate the $L_i$ values:\n$L_1 = \\frac{l_1+l_2}{2} = \\frac{0.88+0.74}{2} = 0.81$\n$L_2 = \\frac{l_2+l_3}{2} = \\frac{0.74+0.55}{2} = 0.645$\n$L_3 = \\frac{l_3+l_4}{2} = \\frac{0.55+0.30}{2} = 0.425$\n$L_4 = \\frac{l_4+l_5}{2} = \\frac{0.30+0.00}{2} = 0.15$\nThe total future person-years for the cohort from age $1$ is $T_1 = L_1 + L_2 + L_3 + L_4 = 0.81 + 0.645 + 0.425 + 0.15 = 2.03$.\nNow, we compute $e_1$:\n$$e_1 = \\frac{T_1}{l_1} = \\frac{2.03}{0.88} \\approx 2.306818...$$\nRounding to four significant figures, $e_1 = 2.307$ years.\n\nFinally, we interpret the results. To understand the population's age structure, we must evaluate its growth potential. The net reproductive rate, $R_0$, is the average number of offspring produced by an individual over its lifetime, given by $R_0 = \\sum_{x=0}^{\\omega-1} l_x m_x$.\n$R_0 = l_0 m_0 + l_1 m_1 + l_2 m_2 + l_3 m_3 + l_4 m_4$\n$R_0 = (1.00)(0) + (0.88)(0) + (0.74)(1.30) + (0.55)(1.10) + (0.30)(0.20)$\n$R_0 = 0 + 0 + 0.962 + 0.605 + 0.06 = 1.627$\nSince $R_0 = 1.627 > 1$, the population is growing. A growing population, in the absence of significant immigration or emigration, will exhibit a bottom-heavy age pyramid. This structure is characterized by a high proportion of individuals in the youngest age classes, with numbers dwindling in successive older age classes due to mortality (as shown by the increasing $q_x$ values). The reproduction is concentrated at ages $2$ and $3$, and survivorship to these ages is substantial ($l_2=0.74$), which fuels the population growth and maintains a large base of young individuals. The combination of high fecundity in early-middle age and a relatively short lifespan ($e_0 = 2.97$ years) is typical for a species with rapid population turnover and an expansive age structure.", "answer": "$$\\boxed{2.307}$$", "id": "2468956"}, {"introduction": "Matrix population models are powerful tools for moving beyond description to prediction and management. This practice introduces elasticity analysis, a key technique in conservation biology that measures the proportional sensitivity of the population growth rate, $\\lambda$, to changes in specific vital rates. By deriving and comparing the elasticities of different survival and fertility parameters [@problem_id:2468967], you will learn how to pinpoint the demographic transitions that most strongly influence population viability, a crucial skill for designing effective and targeted management strategies.", "problem": "A population with three age classes is modeled by a discrete-time, age-structured matrix population model. Let the population vector at time step $t$ be $n(t) \\in \\mathbb{R}^{3}_{\\ge 0}$, and let the projection matrix be the $3 \\times 3$ Leslie matrix\n$$\nA \\;=\\;\n\\begin{pmatrix}\n0 & 0.9 & 1.6 \\\\\n0.4 & 0 & 0 \\\\\n0 & 0.6 & 0\n\\end{pmatrix}.\n$$\nBy definition, the long-term growth rate is the dominant eigenvalue $\\lambda$ of $A$, the stable age distribution $w$ is a right eigenvector satisfying $A w = \\lambda w$, and the reproductive value vector $v$ is a left eigenvector satisfying $v^{\\top} A = \\lambda v^{\\top}$.\n\nManagement can act on one of four age-specific demographic parameters, each corresponding to a single entry of $A$:\n- $k=1$: increase survival from age class $1$ to age class $2$ (entry $a_{2,1}$),\n- $k=2$: increase survival from age class $2$ to age class $3$ (entry $a_{3,2}$),\n- $k=3$: increase fertility of age class $2$ (entry $a_{1,2}$),\n- $k=4$: increase fertility of age class $3$ (entry $a_{1,3}$).\n\nAssume that the effect of a small, proportional change in a single entry $a_{i j}$ on $\\lambda$ is quantified by the elasticity $e_{i j}$, defined by\n$$\ne_{i j} \\;=\\; \\frac{\\partial \\ln \\lambda}{\\partial \\ln a_{i j}}.\n$$\nUsing only fundamental definitions of eigenvalues and eigenvectors and the definition of elasticity above, derive and compute the elasticities $e_{2,1}$, $e_{3,2}$, $e_{1,2}$, and $e_{1,3}$ for the matrix $A$ and determine which single age-specific management action (encoded by the index $k \\in \\{1,2,3,4\\}$ as listed above) most strongly influences $\\lambda$.\n\nYour final answer must be the single integer $k$ that corresponds to the action with the largest elasticity. Do not include any units. Do not round, since the requested output is an index.", "solution": "The task is to determine which of the four demographic parameters—$a_{2,1}$, $a_{3,2}$, $a_{1,2}$, or $a_{1,3}$—has the greatest proportional influence on the population growth rate $\\lambda$. This is measured by the elasticity $e_{ij}$.\n\nFirst, we derive a general expression for elasticity, as required. The definition of the right eigenvector is $A w = \\lambda w$. We differentiate this equation with respect to a matrix element $a_{ij}$, treating $\\lambda$ and $w$ as functions of $a_{ij}$:\n$$ \\frac{\\partial}{\\partial a_{ij}} (A w) = \\frac{\\partial A}{\\partial a_{ij}} w + A \\frac{\\partial w}{\\partial a_{ij}} = \\frac{\\partial \\lambda}{\\partial a_{ij}} w + \\lambda \\frac{\\partial w}{\\partial a_{ij}} $$\nLet $E_{ij}$ be the matrix with a $1$ at position $(i,j)$ and zeros elsewhere. Then $\\frac{\\partial A}{\\partial a_{ij}} = E_{ij}$.\n$$ E_{ij} w + A \\frac{\\partial w}{\\partial a_{ij}} = \\frac{\\partial \\lambda}{\\partial a_{ij}} w + \\lambda \\frac{\\partial w}{\\partial a_{ij}} $$\nLeft-multiplying by the transpose of the left eigenvector, $v^{\\top}$, gives:\n$$ v^{\\top} E_{ij} w + v^{\\top} A \\frac{\\partial w}{\\partial a_{ij}} = \\frac{\\partial \\lambda}{\\partial a_{ij}} v^{\\top} w + \\lambda v^{\\top} \\frac{\\partial w}{\\partial a_{ij}} $$\nUsing the definition of the left eigenvector, $v^{\\top} A = \\lambda v^{\\top}$, the equation simplifies:\n$$ v^{\\top} E_{ij} w + \\lambda v^{\\top} \\frac{\\partial w}{\\partial a_{ij}} = \\frac{\\partial \\lambda}{\\partial a_{ij}} v^{\\top} w + \\lambda v^{\\top} \\frac{\\partial w}{\\partial a_{ij}} $$\n$$ v^{\\top} E_{ij} w = \\frac{\\partial \\lambda}{\\partial a_{ij}} v^{\\top} w $$\nThe term $v^{\\top} E_{ij} w$ is the scalar product $v_i w_j$. The term $v^{\\top} w$ is the scalar product of the two eigenvectors, often written as $\\langle v, w \\rangle$. This gives the sensitivity of $\\lambda$ to $a_{ij}$:\n$$ \\frac{\\partial \\lambda}{\\partial a_{ij}} = \\frac{v_i w_j}{v^{\\top} w} $$\nThe elasticity $e_{ij}$ is defined as $e_{ij} = \\frac{\\partial \\ln \\lambda}{\\partial \\ln a_{ij}}$. Using the chain rule, this is $e_{ij} = \\frac{a_{ij}}{\\lambda} \\frac{\\partial \\lambda}{\\partial a_{ij}}$. Substituting the sensitivity gives:\n$$ e_{ij} = \\frac{a_{ij} v_i w_j}{\\lambda (v^{\\top} w)} $$\nTo find which elasticity is largest, we must compare the four quantities $e_{2,1}$, $e_{3,2}$, $e_{1,2}$, and $e_{1,3}$. Since $\\lambda > 0$ and the eigenvectors $v$ and $w$ are strictly positive, the denominator $\\lambda(v^{\\top} w)$ is a positive scalar common to all four expressions. Therefore, comparing the elasticities is equivalent to comparing the numerators $C_k = a_{ij} v_i w_j$ for each action $k$.\n\nNext, we determine the structure of the eigenvectors $w$ and $v$ in terms of $\\lambda$. The characteristic equation $\\det(A - \\lambda I) = 0$ for the given matrix is:\n$$ \\det \\begin{pmatrix} -\\lambda & 0.9 & 1.6 \\\\ 0.4 & -\\lambda & 0 \\\\ 0 & 0.6 & -\\lambda \\end{pmatrix} = -\\lambda(\\lambda^2) - 0.9(-0.4\\lambda) + 1.6(0.4 \\cdot 0.6) = 0 $$\n$$ -\\lambda^3 + 0.36\\lambda + 0.384 = 0 \\quad \\implies \\quad \\lambda^3 - 0.36\\lambda - 0.384 = 0 $$\nThis is the fundamental relationship that $\\lambda$ must satisfy.\n\nThe right eigenvector $w = (w_1, w_2, w_3)^{\\top}$ is found by solving $(A - \\lambda I)w = 0$:\nFrom the second row: $0.4 w_1 - \\lambda w_2 = 0 \\implies w_2 = \\frac{0.4}{\\lambda} w_1$.\nFrom the third row: $0.6 w_2 - \\lambda w_3 = 0 \\implies w_3 = \\frac{0.6}{\\lambda} w_2 = \\frac{0.6 \\cdot 0.4}{\\lambda^2} w_1 = \\frac{0.24}{\\lambda^2} w_1$.\nSetting $w_1 = 1$ for scaling, the right eigenvector is proportional to $w \\propto \\begin{pmatrix} 1 \\\\ 0.4/\\lambda \\\\ 0.24/\\lambda^2 \\end{pmatrix}$.\n\nThe left eigenvector $v = (v_1, v_2, v_3)^{\\top}$ is found by solving $(A^{\\top} - \\lambda I)v = 0$:\n$$ \\begin{pmatrix} -\\lambda & 0.4 & 0 \\\\ 0.9 & -\\lambda & 0.6 \\\\ 1.6 & 0 & -\\lambda \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\nFrom the first row: $-\\lambda v_1 + 0.4 v_2 = 0 \\implies v_2 = \\frac{\\lambda}{0.4} v_1 = 2.5\\lambda v_1$.\nFrom the third row: $1.6 v_1 - \\lambda v_3 = 0 \\implies v_3 = \\frac{1.6}{\\lambda} v_1$.\nSetting $v_1 = 1$ for scaling, the left eigenvector is proportional to $v \\propto \\begin{pmatrix} 1 \\\\ 2.5\\lambda \\\\ 1.6/\\lambda \\end{pmatrix}$.\n\nNow we compute the quantities $C_k = a_{ij} v_i w_j$ to be compared:\n- For $k=1$ (entry $a_{2,1}$): $C_1 = a_{2,1} v_2 w_1 = (0.4) \\cdot (2.5\\lambda) \\cdot (1) = \\lambda$.\n- For $k=2$ (entry $a_{3,2}$): $C_2 = a_{3,2} v_3 w_2 = (0.6) \\cdot (1.6/\\lambda) \\cdot (0.4/\\lambda) = \\frac{0.384}{\\lambda^2}$.\n- For $k=3$ (entry $a_{1,2}$): $C_3 = a_{1,2} v_1 w_2 = (0.9) \\cdot (1) \\cdot (0.4/\\lambda) = \\frac{0.36}{\\lambda}$.\n- For $k=4$ (entry $a_{1,3}$): $C_4 = a_{1,3} v_1 w_3 = (1.6) \\cdot (1) \\cdot (0.24/\\lambda^2) = \\frac{0.384}{\\lambda^2}$.\n\nWe must now compare $C_1 = \\lambda$, $C_2 = C_4 = \\frac{0.384}{\\lambda^2}$, and $C_3 = \\frac{0.36}{\\lambda}$.\nWe use the characteristic equation $\\lambda^3 = 0.36\\lambda + 0.384$. Since $\\lambda$ is the dominant eigenvalue of a primitive, non-negative matrix, $\\lambda$ is a positive real number.\n\nComparison $1$: Compare $C_1$ and $C_3$. We compare $\\lambda$ with $\\frac{0.36}{\\lambda}$. This is equivalent to comparing $\\lambda^2$ with $0.36$ (since $\\lambda > 0$).\nFrom the characteristic equation, $\\lambda^3 = 0.36\\lambda + 0.384$.\nSince $\\lambda > 0$ and $0.384 > 0$, we have $\\lambda^3 > 0.36\\lambda$.\nDividing by $\\lambda$ (which is positive) yields $\\lambda^2 > 0.36$.\nTherefore, $\\lambda > \\frac{0.36}{\\lambda}$, which implies $C_1 > C_3$.\n\nComparison $2$: Compare $C_1$ and $C_2$ (and $C_4$). We compare $\\lambda$ with $\\frac{0.384}{\\lambda^2}$. This is equivalent to comparing $\\lambda^3$ with $0.384$.\nFrom the characteristic equation, $\\lambda^3 = 0.36\\lambda + 0.384$.\nSince $\\lambda > 0$, the term $0.36\\lambda$ is positive.\nThus, $\\lambda^3 = 0.36\\lambda + 0.384 > 0.384$.\nTherefore, $\\lambda > \\frac{0.384}{\\lambda^2}$, which implies $C_1 > C_2$ and $C_1 > C_4$.\n\nThe comparisons show that $C_1$ is the largest of the four values. The quantity $C_1$ corresponds to the elasticity $e_{2,1}$, which is associated with the management action $k=1$. Hence, increasing the survival from age class $1$ to age class $2$ has the strongest influence on the population growth rate $\\lambda$. The index for this action is $k=1$.", "answer": "$$\n\\boxed{1}\n$$", "id": "2468967"}, {"introduction": "Classic demographic models often simplify reality by assuming all individuals within an age class are identical, but in nature, variation is the rule. This advanced computational exercise explores the consequences of such individual heterogeneity, guiding you to build a hierarchical model that incorporates random variation in survival and fertility. You will see firsthand how ignoring this underlying variability can lead to biased estimates of population parameters, a concept rooted in mathematical principles like Jensen's inequality. This practice [@problem_id:2468924] offers critical insights into modern ecological modeling and the importance of accounting for individual differences when predicting population trajectories and structure.", "problem": "You are asked to formalize and compute consequences of a hierarchical age-structured model that estimates age-specific survival and fertility while accounting for individual heterogeneity, and to quantify how this heterogeneity alters an inferred stable age structure (population pyramid). You must derive your approach from first principles appropriate to ecology and environmental biology and implement it as a complete, runnable program that produces a single line of output as specified below.\n\nAssume an age-structured population with discrete, annual time steps and age classes indexed by $a \\in \\{0,1,\\dots,A-1\\}$. Let $A$ be a fixed positive integer with $A \\ge 2$. The model must be grounded in the following foundational bases:\n\n- Core definition of the Leslie matrix for age-structured dynamics: the next-year age vector $\\mathbf{n}(t+1)$ satisfies $\\mathbf{n}(t+1) = \\mathbf{L}\\,\\mathbf{n}(t)$, where $\\mathbf{L}$ is a nonnegative matrix with fertility values in the first row and survival probabilities on the subdiagonal. For age classes $a \\in \\{0,\\dots,A-2\\}$, the subdiagonal element is the probability of surviving from age $a$ to age $a+1$. The top row element at column $a$ is the expected number of female offspring produced by a female of age $a$ per time step.\n- Life table facts for survival and fertility: survival is a probability in $[0,1]$, fertility is a nonnegative expected count. The stable age distribution is the normalized right Perron vector of $\\mathbf{L}$, and the long-run growth rate is the spectral radius (dominant eigenvalue) of $\\mathbf{L}$. Both are real and positive for a primitive nonnegative matrix due to the Perron–Frobenius theorem.\n- Hierarchical individual heterogeneity modeled via random effects that shift the latent scales of survival and fertility. Specifically: survival on the logit scale with an additive normal random effect, and fertility on the log scale with an additive normal random effect (lognormal heterogeneity).\n\nModel specification to implement:\n\n- Let age-specific baseline survival logits be $\\eta_a$ for $a \\in \\{0,\\dots,A-2\\}$, so the baseline survival for age $a$ ignoring heterogeneity is $s_a^{\\text{naive}} = \\operatorname{logit}^{-1}(\\eta_a)$, where $\\operatorname{logit}^{-1}(x) = \\frac{1}{1+e^{-x}}$.\n- Let age-specific baseline fertility log-means be $\\phi_a$ for $a \\in \\{0,\\dots,A-1\\}$, so the baseline fertility ignoring heterogeneity is $m_a^{\\text{naive}} = e^{\\phi_a}$.\n- Introduce individual random effects: for survival, $b \\sim \\mathcal{N}(0,\\sigma_s^2)$ added on the logit scale; for fertility, $c \\sim \\mathcal{N}(0,\\sigma_f^2)$ added on the log scale. The age-specific population-averaged quantities that account for heterogeneity are:\n  - $s_a^{\\text{hier}} = \\mathbb{E}\\big[\\operatorname{logit}^{-1}(\\eta_a + b)\\big]$ for $a \\in \\{0,\\dots,A-2\\}$, where the expectation is with respect to $b \\sim \\mathcal{N}(0,\\sigma_s^2)$.\n  - $m_a^{\\text{hier}} = \\mathbb{E}\\big[e^{\\phi_a + c}\\big]$ for $a \\in \\{0,\\dots,A-1\\}$, where the expectation is with respect to $c \\sim \\mathcal{N}(0,\\sigma_f^2)$.\n\nYou must compute $s_a^{\\text{naive}}$, $m_a^{\\text{naive}}$, $s_a^{\\text{hier}}$, and $m_a^{\\text{hier}}$ for a given test suite. For $\\mathbb{E}\\big[\\operatorname{logit}^{-1}(\\eta_a + b)\\big]$ there is no closed form in general; you must evaluate it numerically by a high-accuracy quadrature method that is appropriate for a normal distribution. For $\\mathbb{E}\\big[e^{\\phi_a + c}\\big]$ you must use the implied lognormal mean.\n\nFor each parameter set in the test suite, do the following:\n\n1. Construct two Leslie matrices $\\mathbf{L}_{\\text{naive}}$ and $\\mathbf{L}_{\\text{hier}}$ using the corresponding survival and fertility vectors. Each matrix is $A \\times A$, has fertility values in the first row, and has survival values on the subdiagonal. The last age class has no survival to a higher class.\n2. Compute the dominant eigenvalue $\\lambda_{\\text{naive}}$ of $\\mathbf{L}_{\\text{naive}}$ and $\\lambda_{\\text{hier}}$ of $\\mathbf{L}_{\\text{hier}}$, interpreted as long-run multiplicative growth factors per time step. Then compute the corresponding stable age distributions $\\mathbf{p}_{\\text{naive}}$ and $\\mathbf{p}_{\\text{hier}}$ as the right Perron vectors normalized to sum to $1$.\n3. Compute the total variation distance between the two stable distributions,\n   $$ D_{\\text{TV}} = \\tfrac{1}{2}\\sum_{a=0}^{A-1} \\left| p_{\\text{hier},a} - p_{\\text{naive},a} \\right|. $$\n4. Compute the proportion in the youngest age class group under the hierarchical model,\n   $$ Y_{\\text{hier}} = \\sum_{a=0}^{1} p_{\\text{hier},a}, $$\n   where the group is ages $a=0$ and $a=1$.\n\nTest suite (fixed values to be used by your program):\n\n- Number of age classes: $A = 7$.\n- Survival logit baselines (length $A-1=6$): $\\eta = \\{-1.2, -0.3, 1.0, 1.3, 1.1, 0.5\\}$ for ages $a=0,1,2,3,4,5$ respectively.\n- Fertility log baselines (length $A=7$): $\\phi = \\{-10.0, -5.0, -0.7, -0.3, -0.5, -0.9, -1.5\\}$ for ages $a=0,1,2,3,4,5,6$ respectively.\n- Three heterogeneity settings $(\\sigma_s,\\sigma_f)$:\n  1. Case $1$ (no heterogeneity): $(\\sigma_s,\\sigma_f) = (0.0, 0.0)$.\n  2. Case $2$ (moderate heterogeneity): $(\\sigma_s,\\sigma_f) = (0.7, 0.5)$.\n  3. Case $3$ (strong heterogeneity): $(\\sigma_s,\\sigma_f) = (1.2, 0.9)$.\n\nProgram requirements:\n\n- Use Gauss–Hermite quadrature to evaluate $s_a^{\\text{hier}} = \\mathbb{E}\\big[\\operatorname{logit}^{-1}(\\eta_a + b)\\big]$ accurately for $b \\sim \\mathcal{N}(0,\\sigma_s^2)$. The quadrature must be consistent with the standard normal density via a correct change of variables.\n- Compute stable age distributions via a numerically robust method that guarantees nonnegativity of the resulting vector (for example, a power iteration on the nonnegative matrix).\n- For each case, output a list of four real numbers $[\\lambda_{\\text{naive}}, \\lambda_{\\text{hier}}, D_{\\text{TV}}, Y_{\\text{hier}}]$, each rounded to $6$ decimals.\n- Final output format: your program should produce a single line of output containing the results for the three cases as a comma-separated list of lists, enclosed in square brackets, for example, $\\big[\\,[\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot]\\,\\big]$.\n\nNotes on scientific realism:\n\n- Choose numerical quadrature parameters to ensure high accuracy and numerical stability for the expectations.\n- All survival probabilities must lie in $[0,1]$ and all fertilities must be nonnegative, consistent with the life table definitions.\n- The matrices constructed are nonnegative and, under the given parameter values, primitive; hence the dominant eigenvalue and stable age distribution are well-defined.\n\nYour program must hard-code the test suite as above and must not require any input. The output must be precisely one line in the exact format specified, with the numbers rounded to six decimals and no extra text.", "solution": "We start from the fundamental representation of age-structured population dynamics via the Leslie matrix. Let $\\mathbf{n}(t)$ denote the vector of expected abundances in each age class at time $t \\in \\{0,1,2,\\dots\\}$. The one-step projection is given by\n$$\n\\mathbf{n}(t+1) = \\mathbf{L}\\,\\mathbf{n}(t),\n$$\nwhere $\\mathbf{L}$ is an $A \\times A$ nonnegative matrix with fertilities in its top row and survivals on the subdiagonal. Specifically, writing $\\mathbf{m} = (m_0,\\dots,m_{A-1})$ for fertilities and $\\mathbf{s} = (s_0,\\dots,s_{A-2})$ for survivals, we have\n$$\n\\mathbf{L} =\n\\begin{bmatrix}\nm_0 & m_1 & \\cdots & m_{A-1} \\\\\ns_0 & 0 & \\cdots & 0 \\\\\n0 & s_1 & \\cdots & 0 \\\\\n\\vdots & \\vdots & \\ddots & \\vdots \\\\\n0 & 0 & \\cdots & s_{A-2}\n\\end{bmatrix}.\n$$\nBy the Perron–Frobenius theorem for primitive nonnegative matrices, $\\mathbf{L}$ has a positive dominant eigenvalue $\\lambda$ (the long-run multiplicative growth factor) with a corresponding right eigenvector $\\mathbf{v} \\succ \\mathbf{0}$. Normalizing $\\mathbf{v}$ to unit sum yields the stable age distribution $\\mathbf{p} = \\mathbf{v}/\\sum_a v_a$.\n\nTo embed individual heterogeneity, we specify a hierarchical model where survival is modeled on the logit scale and fertility on the log scale with additive normal random effects:\n- For survival at age $a \\in \\{0,\\dots,A-2\\}$, the individual-level survival probability for individual $i$ is\n$$\nS_{i,a} = \\operatorname{logit}^{-1}(\\eta_a + b_i), \\quad b_i \\sim \\mathcal{N}(0,\\sigma_s^2),\n$$\nwhose population-averaged value is\n$$\ns_a^{\\text{hier}} = \\mathbb{E}\\left[S_{i,a}\\right] = \\int_{-\\infty}^{\\infty} \\frac{1}{1+e^{-(\\eta_a + b)}} \\, \\varphi(b;0,\\sigma_s^2)\\, db,\n$$\nwhere $\\varphi(\\cdot;0,\\sigma_s^2)$ denotes a normal density with mean $0$ and variance $\\sigma_s^2$.\n- For fertility at age $a \\in \\{0,\\dots,A-1\\}$, the individual-level expected number of daughters is\n$$\nM_{i,a} = e^{\\phi_a + c_i}, \\quad c_i \\sim \\mathcal{N}(0,\\sigma_f^2),\n$$\nwhich yields the population-averaged value\n$$\nm_a^{\\text{hier}} = \\mathbb{E}\\left[M_{i,a}\\right] = \\mathbb{E}\\left[e^{\\phi_a + c_i}\\right] = e^{\\phi_a}\\,\\mathbb{E}\\left[e^{c_i}\\right] = e^{\\phi_a + \\frac{1}{2}\\sigma_f^2}.\n$$\nThese two expectations represent the marginal mean survival and marginal mean fertility across individuals, accounting for heterogeneity on the latent scales. By contrast, a naive plug-in that ignores heterogeneity sets $s_a^{\\text{naive}} = \\operatorname{logit}^{-1}(\\eta_a)$ and $m_a^{\\text{naive}} = e^{\\phi_a}$.\n\nFor $s_a^{\\text{hier}} = \\mathbb{E}\\left[\\operatorname{logit}^{-1}(\\eta_a + b)\\right]$ with $b \\sim \\mathcal{N}(0,\\sigma_s^2)$, a direct closed form is not available in general. However, it can be computed to high accuracy by Gauss–Hermite quadrature. Recall the Gauss–Hermite rule\n$$\n\\int_{-\\infty}^{\\infty} e^{-x^2} f(x)\\, dx \\approx \\sum_{i=1}^{N} w_i f(x_i),\n$$\nwhere $\\{x_i\\}_{i=1}^{N}$ are the nodes (roots of the physicists’ Hermite polynomial of order $N$) and $\\{w_i\\}_{i=1}^{N}$ are the corresponding positive weights. For $b \\sim \\mathcal{N}(0,\\sigma_s^2)$, we write $b = \\sigma_s z$ with $z \\sim \\mathcal{N}(0,1)$, and use the change of variables $z = \\sqrt{2}\\,x$, yielding\n$$\n\\mathbb{E}\\left[g(b)\\right] = \\int_{-\\infty}^{\\infty} g(\\sigma_s z)\\,\\frac{1}{\\sqrt{2\\pi}} e^{-z^2/2}\\, dz\n= \\frac{1}{\\sqrt{\\pi}}\\int_{-\\infty}^{\\infty} g\\!\\left(\\sigma_s \\sqrt{2}\\, x\\right) e^{-x^2}\\, dx\n\\approx \\frac{1}{\\sqrt{\\pi}} \\sum_{i=1}^{N} w_i \\, g\\!\\left(\\sigma_s \\sqrt{2}\\, x_i\\right).\n$$\nSetting $g(u) = \\operatorname{logit}^{-1}(\\eta_a + u)$ gives a numerically stable and accurate approximation for $s_a^{\\text{hier}}$ when $N$ is moderately large (for example, $N=50$).\n\nOnce we have both $\\mathbf{L}_{\\text{naive}}$ and $\\mathbf{L}_{\\text{hier}}$, we require numerical methods to compute their dominant eigenpairs. While a direct eigendecomposition is possible, the power iteration method is particularly suitable for nonnegative matrices and guarantees nonnegativity of iterates:\n- Initialize $\\mathbf{v}^{(0)} \\succ \\mathbf{0}$ with $\\sum_a v_a^{(0)} = 1$.\n- Iterate $\\mathbf{v}^{(k+1)} = \\mathbf{L}\\,\\mathbf{v}^{(k)} / \\sum_a (\\mathbf{L}\\,\\mathbf{v}^{(k)})_a$ until $\\|\\mathbf{v}^{(k+1)} - \\mathbf{v}^{(k)}\\|_1$ is below a small tolerance.\n- At convergence, $\\mathbf{p} = \\mathbf{v}^{(k)}$ is the stable age distribution, and the dominant eigenvalue is $\\lambda = \\sum_a (\\mathbf{L}\\,\\mathbf{p})_a$, because $\\sum_a (\\mathbf{L}\\,\\mathbf{p})_a = \\sum_a \\lambda p_a = \\lambda \\sum_a p_a = \\lambda$ for $\\sum_a p_a = 1$.\n\nTo quantify implications for inferred population pyramids, we compare the stable distributions $\\mathbf{p}_{\\text{naive}}$ and $\\mathbf{p}_{\\text{hier}}$ via the total variation distance\n$$\nD_{\\text{TV}} = \\tfrac{1}{2}\\sum_{a=0}^{A-1} \\left| p_{\\text{hier},a} - p_{\\text{naive},a} \\right|,\n$$\nand summarize the youngest segment under the hierarchical model as\n$$\nY_{\\text{hier}} = \\sum_{a=0}^{1} p_{\\text{hier},a}.\n$$\n\nInterpretation based on core convexity results:\n- Fertility heterogeneity on the log scale yields $m_a^{\\text{hier}} = e^{\\phi_a + \\frac{1}{2}\\sigma_f^2}$, which strictly exceeds $e^{\\phi_a}$ when $\\sigma_f^2 > 0$. Thus, heterogeneity on the log scale inflates marginal fertility via the arithmetic mean of a lognormal distribution, which tends to increase $\\lambda_{\\text{hier}}$ relative to $\\lambda_{\\text{naive}}$ and to shift the stable age distribution toward younger classes (larger $Y_{\\text{hier}}$), other factors equal.\n- Survival heterogeneity on the logit scale interacts with the S-shaped convexity of the logistic function. For ages with baseline $s_a^{\\text{naive}}  \\tfrac{1}{2}$ (i.e., $\\eta_a  0$), the logistic function is locally convex, and Jensen’s inequality implies $s_a^{\\text{hier}} \\ge s_a^{\\text{naive}}$. For ages with baseline $s_a^{\\text{naive}} > \\tfrac{1}{2}$ (i.e., $\\eta_a > 0$), it is locally concave, implying $s_a^{\\text{hier}} \\le s_a^{\\text{naive}}$. Therefore, heterogeneity tends to increase survival in early low-survival ages and decrease it in high-survival ages, with ambiguous net effects on $\\lambda$ and the pyramid shape depending on the balance of ages.\n\nScientific implications for inferred pyramids:\n- When $(\\sigma_s,\\sigma_f) = (0,0)$, the hierarchical and naive constructions coincide, giving $D_{\\text{TV}} = 0$ and identical pyramids.\n- As $\\sigma_f$ increases, $m_a^{\\text{hier}}$ increases multiplicatively for all ages with potential reproduction, thereby typically increasing $\\lambda_{\\text{hier}}$ and shifting mass toward younger ages (larger $Y_{\\text{hier}}$), producing a broader base in the pyramid.\n- As $\\sigma_s$ increases, $s_a^{\\text{hier}}$ increases for early ages with $\\eta_a  0$ and decreases for later ages with $\\eta_a > 0$, tending to refill the youngest classes while thinning some older classes, thus also generally broadening the base relative to the naive model. The net distortion from the naive pyramid is summarized by $D_{\\text{TV}}$ and can be substantial under strong heterogeneity.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.hermite import hermgauss\n\ndef logistic(x):\n    # Stable logistic\n    # For large negative x, use expit form without overflow\n    return 1.0 / (1.0 + np.exp(-x))\n\ndef expected_logistic_with_normal(eta, sigma, gh_n=64):\n    \"\"\"\n    Compute E[ logistic(eta + b) ] where b ~ N(0, sigma^2)\n    via Gauss-Hermite quadrature with gh_n nodes.\n    \"\"\"\n    if sigma == 0.0:\n        return logistic(eta)\n    # Nodes and weights for integral with weight e^{-x^2}\n    x, w = hermgauss(gh_n)\n    # Change of variable: z ~ N(0,1), z = sqrt(2)*x; b = sigma*z = sigma*sqrt(2)*x\n    # E[g(b)] = (1/sqrt(pi)) sum w_i g(sigma*sqrt(2)*x_i)\n    arg = eta + sigma * np.sqrt(2.0) * x\n    g = logistic(arg)\n    val = (w @ g) / np.sqrt(np.pi)\n    # Ensure numerical bounds\n    return float(min(max(val, 0.0), 1.0))\n\ndef leslie_matrix(survivals, fertilities):\n    \"\"\"\n    Build an A x A Leslie matrix with given survivals (length A-1)\n    and fertilities (length A).\n    \"\"\"\n    A = len(fertilities)\n    L = np.zeros((A, A), dtype=float)\n    # top row: fertilities\n    L[0, :] = fertilities\n    # subdiagonal: survivals\n    for a in range(A - 1):\n        L[a + 1, a] = survivals[a]\n    return L\n\ndef power_method_stable_dist(L, tol=1e-14, max_iter=100000):\n    \"\"\"\n    Compute the stable age distribution (right Perron vector) and dominant eigenvalue\n    for a nonnegative matrix L using power iteration, normalizing by sum at each step.\n    Returns (lambda_dom, p), where p sums to 1 and is nonnegative.\n    \"\"\"\n    A = L.shape[0]\n    v = np.ones(A, dtype=float)\n    v /= v.sum()\n    lam = None\n    for _ in range(max_iter):\n        Lv = L @ v\n        s = Lv.sum()\n        if s = 0 or not np.isfinite(s):\n            # Degenerate case should not occur with given inputs\n            s = 1.0\n        v_new = Lv / s\n        diff = np.abs(v_new - v).sum()\n        v = v_new\n        lam = s  # since sum(v)=1, sum(L v)=lambda\n        if diff  tol:\n            break\n    # Ensure nonnegativity, normalize\n    v = np.maximum(v, 0.0)\n    total = v.sum()\n    if total == 0.0:\n        # Fallback: uniform\n        v = np.ones(A) / A\n        lam = (L @ v).sum()\n    else:\n        v /= total\n    return float(lam), v\n\ndef round6(x):\n    return float(np.round(x, 6))\n\ndef compute_case(eta_vec, phi_vec, sigma_s, sigma_f):\n    \"\"\"\n    Compute metrics [lambda_naive, lambda_hier, D_TV, Y_hier]\n    for a single test case.\n    eta_vec: length A-1 (survival logits)\n    phi_vec: length A (fertility log-means)\n    \"\"\"\n    A = len(phi_vec)\n    # Naive parameters\n    s_naive = np.array([logistic(eta) for eta in eta_vec], dtype=float)\n    m_naive = np.exp(np.array(phi_vec, dtype=float))\n    # Hierarchical parameters\n    s_hier = np.array([expected_logistic_with_normal(eta, sigma_s) for eta in eta_vec], dtype=float)\n    m_hier = np.exp(np.array(phi_vec, dtype=float) + 0.5 * (sigma_f ** 2))\n    # Build Leslie matrices\n    L_naive = leslie_matrix(s_naive, m_naive)\n    L_hier = leslie_matrix(s_hier, m_hier)\n    # Dominant eigenvalues and stable distributions\n    lam_naive, p_naive = power_method_stable_dist(L_naive)\n    lam_hier, p_hier = power_method_stable_dist(L_hier)\n    # Total variation distance\n    D_TV = 0.5 * np.abs(p_hier - p_naive).sum()\n    # Youngest group proportion (ages 0 and 1) under hierarchical model\n    Y_hier = p_hier[0:2].sum()\n    return [round6(lam_naive), round6(lam_hier), round6(D_TV), round6(Y_hier)]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    A = 7\n    # Survival logits for ages 0..A-2 (length 6)\n    eta = [-1.2, -0.3, 1.0, 1.3, 1.1, 0.5]\n    # Fertility log-means for ages 0..A-1 (length 7)\n    phi = [-10.0, -5.0, -0.7, -0.3, -0.5, -0.9, -1.5]\n    test_cases = [\n        (eta, phi, 0.0, 0.0),   # Case 1: no heterogeneity\n        (eta, phi, 0.7, 0.5),   # Case 2: moderate heterogeneity\n        (eta, phi, 1.2, 0.9),   # Case 3: strong heterogeneity\n    ]\n\n    results = []\n    for case in test_cases:\n        eta_vec, phi_vec, sigma_s, sigma_f = case\n        res = compute_case(eta_vec, phi_vec, sigma_s, sigma_f)\n        results.append(res)\n\n    # Final print statement in the exact required format.\n    # Single line, list of lists, comma-separated, numbers rounded to six decimals already.\n    def fmt_list(lst):\n        return \"[\" + \",\".join(f\"{x:.6f}\" for x in lst) + \"]\"\n    print(\"[\" + \",\".join(fmt_list(r) for r in results) + \"]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2468924"}]}