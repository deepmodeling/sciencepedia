{"hands_on_practices": [{"introduction": "Understanding how an organism eliminates a contaminant is a cornerstone of toxicokinetics. This first practice focuses on hepatic clearance, the process by which the liver removes substances from the blood. By starting from the fundamental principle of mass conservation, you will derive the \"well-stirred\" model, a classic framework that connects an organ's blood flow ($Q_h$), the compound's binding to proteins ($f_u$), and the liver's intrinsic metabolic capacity ($CL_{\\text{int}}$). Completing this exercise [@problem_id:2540401] provides a mechanistic basis for predicting a key determinant of a compound's persistence in the body.", "problem": "An endocrine-disrupting steroidal compound enters the liver of an adult teleost fish at steady state during continuous environmental exposure. Assume the following scientifically standard conditions for a well-mixed hepatic compartment: (i) the liver is modeled as a single, instantly and homogeneously mixed control volume; (ii) blood and hepatocytes are at equilibrium with respect to unbound compound within the liver; (iii) the intrinsic metabolic capacity of the liver is linear with respect to the unbound concentration, characterized by a whole-liver intrinsic clearance normalized to body mass, denoted $CL_{\\text{int}}$; (iv) extrahepatic elimination and biliary excretion are negligible relative to hepatic biotransformation; (v) the blood-to-plasma concentration ratio is unity and binding in red blood cells is negligible so that the fraction unbound in blood, $f_u$, is well defined; and (vi) all flows and clearances are normalized to body mass.\n\nStarting only from conservation of mass for a steady-state control volume and the core definition of clearance as elimination rate divided by an appropriate reference concentration, derive an analytical expression for the hepatic clearance $CL_h$ under the above assumptions. Then evaluate $CL_h$ for the endocrine disruptor in this fish given:\n- hepatic blood flow $Q_h = $ $2.4$ L h$^{-1}$ kg$^{-1}$,\n- fraction unbound in blood $f_u = $ $0.015$,\n- whole-liver intrinsic clearance $CL_{\\text{int}} = $ $400$ L h$^{-1}$ kg$^{-1}$.\n\nExpress your final numeric answer for $CL_h$ in L h$^{-1}$ kg$^{-1}$ and round to four significant figures.", "solution": "The derivation begins with the principle of mass conservation for the liver, treated as a single control volume at steady state. At steady state, the rate at which the compound enters the liver must equal the rate at which it leaves the liver, either by blood flow or by elimination (metabolism).\n\nLet $C_a$ be the concentration of the compound in the blood entering the liver (arterial), and $C_v$ be the concentration in the blood exiting the liver (venous). Let $Q_h$ be the hepatic blood flow. The rate of entry is $Q_h \\cdot C_a$, and the rate of exit via blood flow is $Q_h \\cdot C_v$. The rate of elimination within the liver, $E_h$, is the difference between the rate of entry and the rate of exit.\n$$E_h = Q_h \\cdot C_a - Q_h \\cdot C_v = Q_h (C_a - C_v)$$\n\nHepatic clearance, $CL_h$, is defined as the rate of elimination divided by the concentration of the compound entering the organ.\n$$CL_h = \\frac{E_h}{C_a} = \\frac{Q_h (C_a - C_v)}{C_a} = Q_h \\cdot E_R$$\nwhere $E_R = \\frac{C_a - C_v}{C_a}$ is the hepatic extraction ratio, representing the fraction of the compound removed from the blood during a single pass through the liver.\n\nThe problem states that elimination is a linear function of the *unbound* concentration in the liver. The proportionality constant is the intrinsic clearance, $CL_{\\text{int}}$. The rate of elimination can therefore also be expressed as:\n$$E_h = CL_{\\text{int}} \\cdot C_{u, \\text{liver}}$$\nwhere $C_{u, \\text{liver}}$ is the unbound concentration of the compound within the liver.\n\nAccording to the \"well-stirred\" model assumption (i), the liver is homogeneously mixed. This implies that the concentration throughout the liver tissue is uniform and equal to the concentration in the exiting venous blood, $C_v$. Furthermore, assumption (ii) states that the unbound concentrations in blood and liver tissue are in equilibrium. Thus, the unbound concentration in the liver is equal to the unbound concentration in the exiting venous blood.\n$$C_{u, \\text{liver}} = f_u \\cdot C_v$$\nwhere $f_u$ is the fraction unbound in blood.\n\nSubstituting this into the expression for the rate of elimination gives:\n$$E_h = CL_{\\text{int}} \\cdot f_u \\cdot C_v$$\n\nWe now have two expressions for the rate of elimination, $E_h$. Equating them allows us to connect the physiological parameters ($Q_h$) with the biochemical parameters ($CL_{\\text{int}}, f_u$).\n$$Q_h (C_a - C_v) = CL_{\\text{int}} \\cdot f_u \\cdot C_v$$\nOur goal is to find an expression for $CL_h$ that does not depend on the concentrations $C_a$ or $C_v$. To achieve this, we rearrange the equation to solve for the ratio $\\frac{C_v}{C_a}$.\n$$Q_h \\cdot C_a - Q_h \\cdot C_v = CL_{\\text{int}} \\cdot f_u \\cdot C_v$$\n$$Q_h \\cdot C_a = (Q_h + CL_{\\text{int}} \\cdot f_u) \\cdot C_v$$\n$$\\frac{C_v}{C_a} = \\frac{Q_h}{Q_h + CL_{\\text{int}} \\cdot f_u}$$\n\nThe extraction ratio $E_R$ is defined as $1 - \\frac{C_v}{C_a}$.\n$$E_R = 1 - \\frac{Q_h}{Q_h + CL_{\\text{int}} \\cdot f_u} = \\frac{(Q_h + CL_{\\text{int}} \\cdot f_u) - Q_h}{Q_h + CL_{\\text{int}} \\cdot f_u} = \\frac{CL_{\\text{int}} \\cdot f_u}{Q_h + CL_{\\text{int}} \\cdot f_u}$$\n\nFinally, substitute this expression for $E_R$ back into the equation for hepatic clearance, $CL_h = Q_h \\cdot E_R$.\n$$CL_h = Q_h \\cdot \\frac{CL_{\\text{int}} \\cdot f_u}{Q_h + CL_{\\text{int}} \\cdot f_u}$$\nThis is the derived analytical expression for hepatic clearance under the assumptions of the well-stirred model.\n\nNow, we evaluate $CL_h$ using the provided numerical values:\n- $Q_h = 2.4$ L h$^{-1}$ kg$^{-1}$\n- $f_u = 0.015$\n- $CL_{\\text{int}} = 400$ L h$^{-1}$ kg$^{-1}$\n\nFirst, calculate the product $CL_{\\text{int}} \\cdot f_u$, which is often termed the \"unbound intrinsic clearance\".\n$$CL_{\\text{int}} \\cdot f_u = (400 \\text{ L h}^{-1} \\text{kg}^{-1}) \\cdot (0.015) = 6 \\text{ L h}^{-1} \\text{kg}^{-1}$$\nSubstitute this value into the expression for $CL_h$:\n$$CL_h = \\frac{Q_h \\cdot (CL_{\\text{int}} \\cdot f_u)}{Q_h + (CL_{\\text{int}} \\cdot f_u)} = \\frac{(2.4 \\text{ L h}^{-1} \\text{kg}^{-1}) \\cdot (6 \\text{ L h}^{-1} \\text{kg}^{-1})}{2.4 \\text{ L h}^{-1} \\text{kg}^{-1} + 6 \\text{ L h}^{-1} \\text{kg}^{-1}}$$\n$$CL_h = \\frac{14.4 \\text{ (L h}^{-1} \\text{kg}^{-1})^2}{8.4 \\text{ L h}^{-1} \\text{kg}^{-1}}$$\n$$CL_h = \\frac{14.4}{8.4} \\text{ L h}^{-1} \\text{kg}^{-1} = \\frac{12}{7} \\text{ L h}^{-1} \\text{kg}^{-1}$$\nAs a decimal value, this is approximately $1.7142857...$ L h$^{-1}$ kg$^{-1}$.\nRounding to four significant figures as requested, we obtain:\n$$CL_h \\approx 1.714 \\text{ L h}^{-1} \\text{kg}^{-1}$$", "answer": "$$\n\\boxed{1.714}\n$$", "id": "2540401"}, {"introduction": "After determining a compound's concentration in the body, the next step in toxicological assessment is to quantify its effect. This exercise explores the fundamental link between contaminant concentration and biological response, the domain of toxicodynamics. You will derive the Hill equation, a powerful dose-response model, from the principles of receptor-ligand binding kinetics [@problem_id:2540397]. This practice will equip you with a quantitative tool to characterize a toxicant's potency ($EC_{50}$) and the cooperativity ($n$) of its action, building a bridge from molecular interactions to observable organism-level effects.", "problem": "A pelagic fish population in a temperate estuary is chronically exposed to an estrogenic contaminant that binds to the estrogen receptor and induces vitellogenin production. Assume a single-site receptor mechanism with cooperative ligand-receptor binding and rapid equilibrium relative to organismal response dynamics. Start from the law of mass action for receptor-ligand binding and the definition of receptor occupancy, and assume a monotonic linkage function between occupancy and effect such that the effect is proportional to occupancy with a maximum effect $E_{\\max}$ when all receptors are occupied. Under cooperative binding of order $n$ and defining the half-maximal effective concentration (EC50) as the concentration at which the effect is half-maximal, derive an expression for the concentration-effect relationship $E(C)$ in terms of $E_{\\max}$, $\\mathrm{EC}_{50}$, $n$, and the exposure concentration $C$.\n\nA calibrated assay for this species yields parameters $E_{\\max}=100\\,\\%$, $\\mathrm{EC}_{50}=2\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$, and Hill coefficient $n=1.2$. Using your derived expression:\n1. Compute the effect $E(C)$ at $C=0.5\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$, $C=2\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$, and $C=10\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$, and briefly interpret where the system is most sensitive to changes in $C$ on the linear concentration scale versus the logarithmic concentration scale.\n2. Let the local linear sensitivity be $S(C)=\\frac{dE}{dC}$. Evaluate $S(\\mathrm{EC}_{50})$ symbolically, then numerically for the given parameters.\n\nExpress the final reported value of $S(\\mathrm{EC}_{50})$ in $\\%\\,\\mathrm{per}\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$ and round your final answer to $4$ significant figures. The intermediate values of $E(C)$ are for interpretation and do not need to be rounded to a specific number of significant figures.", "solution": "The derivation of the concentration-effect relationship begins with the law of mass action applied to the cooperative binding of a ligand (contaminant, $C$) to a receptor ($R$). The problem specifies a cooperative binding of order $n$, which can be represented by the equilibrium reaction:\n$$ nC + R \\rightleftharpoons C_n R $$\nwhere $C_n R$ is the receptor-ligand complex. The dissociation constant, $K_d$, for this reaction is given by the law of mass action at equilibrium:\n$$ K_d = \\frac{[C]^n [R]}{[C_n R]} $$\nHere, $[C]$ is the concentration of the contaminant, $[R]$ is the concentration of free, unoccupied receptors, and $[C_n R]$ is the concentration of the occupied receptor complex. The problem statement uses the symbol $C$ for the contaminant concentration, so we will adopt this notation, replacing $[C]$ with $C$.\n\nReceptor occupancy, denoted by the symbol $\\theta$, is defined as the fraction of total receptors that are occupied by the ligand. The total receptor concentration, $[R_{total}]$, is the sum of free and occupied receptors: $[R_{total}] = [R] + [C_n R]$.\nThus, occupancy is:\n$$ \\theta = \\frac{[C_n R]}{[R_{total}]} $$\nTo express $\\theta$ as a function of $C$, we first rearrange the definition of total receptors to find an expression for $[R]$: $[R] = [R_{total}] - [C_n R]$. We substitute this into the equation for $K_d$:\n$$ K_d = \\frac{C^n ([R_{total}] - [C_n R])}{[C_n R]} $$\nNow, we must solve for the ratio $\\frac{[C_n R]}{[R_{total}]}$.\n$$ K_d [C_n R] = C^n [R_{total}] - C^n [C_n R] $$\n$$ [C_n R] (K_d + C^n) = C^n [R_{total}] $$\n$$ \\theta = \\frac{[C_n R]}{[R_{total}]} = \\frac{C^n}{K_d + C^n} $$\nThis expression is the Hill-Langmuir equation, which relates receptor occupancy to ligand concentration for cooperative binding.\n\nThe problem states that the biological effect, $E$, is proportional to the receptor occupancy, $\\theta$, and reaches a maximum, $E_{\\max}$, when all receptors are occupied (i.e., when $\\theta=1$). This implies a linear relationship: $E(C) = E_{\\max} \\cdot \\theta(C)$.\nSubstituting our expression for $\\theta(C)$, we get:\n$$ E(C) = E_{\\max} \\frac{C^n}{K_d + C^n} $$\nThe final step in the derivation is to express $K_d$ in terms of the half-maximal effective concentration, $\\mathrm{EC}_{50}$. By definition, at $C = \\mathrm{EC}_{50}$, the effect is half of the maximum: $E(\\mathrm{EC}_{50}) = \\frac{E_{\\max}}{2}$.\nSubstituting this into our effect equation:\n$$ \\frac{E_{\\max}}{2} = E_{\\max} \\frac{(\\mathrm{EC}_{50})^n}{K_d + (\\mathrm{EC}_{50})^n} $$\n$$ \\frac{1}{2} = \\frac{(\\mathrm{EC}_{50})^n}{K_d + (\\mathrm{EC}_{50})^n} $$\n$$ K_d + (\\mathrm{EC}_{50})^n = 2(\\mathrm{EC}_{50})^n $$\n$$ K_d = (\\mathrm{EC}_{50})^n $$\nThis result provides the crucial link between the microscopic dissociation constant and the macroscopic, phenomenological parameter $\\mathrm{EC}_{50}$. Substituting this back into the equation for $E(C)$ yields the final form of the concentration-effect relationship, commonly known as the Hill equation:\n$$ E(C) = E_{\\max} \\frac{C^n}{(\\mathrm{EC}_{50})^n + C^n} $$\n\n**Part 1: Calculation and Interpretation**\n\nWe are given the parameters $E_{\\max}=100\\,\\%$, $\\mathrm{EC}_{50}=2\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$, and $n=1.2$. We compute the effect $E(C)$ at the specified concentrations.\n\nAt $C = 0.5\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$:\n$$ E(0.5) = 100 \\frac{(0.5)^{1.2}}{(2)^{1.2} + (0.5)^{1.2}} = 100 \\frac{0.435275}{2.297397 + 0.435275} \\approx 15.93\\,\\% $$\n\nAt $C = 2\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$:\n$$ E(2) = 100 \\frac{(2)^{1.2}}{(2)^{1.2} + (2)^{1.2}} = 100 \\frac{1}{1+1} = 50\\,\\% $$\nThis result is expected, as $C$ equals the $\\mathrm{EC}_{50}$.\n\nAt $C = 10\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$:\n$$ E(10) = 100 \\frac{(10)^{1.2}}{(2)^{1.2} + (10)^{1.2}} = 100 \\frac{15.84893}{2.297397 + 15.84893} \\approx 87.34\\,\\% $$\n\nInterpretation of sensitivity:\nThe sensitivity of the system to a change in concentration can be assessed by the slope of the concentration-response curve. We must distinguish between sensitivity on a linear concentration scale versus a logarithmic scale.\nSensitivity on a linear scale is given by the derivative $\\frac{dE}{dC}$. The maximum of this function, corresponding to the steepest point of the $E$ vs. $C$ plot, occurs at the inflection point, which is at $C = \\mathrm{EC}_{50} \\left( \\frac{n-1}{n+1} \\right)^{1/n}$. For $n=1.2$, this is $C = 2 \\left( \\frac{1.2-1}{1.2+1} \\right)^{1/1.2} \\approx 0.294\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$.\nSensitivity on a logarithmic scale is given by the derivative $\\frac{dE}{d(\\ln C)} = C \\frac{dE}{dC}$. The maximum of this function, corresponding to the steepest point of the sigmoidal $E$ vs. $\\log C$ plot, occurs precisely at $C = \\mathrm{EC}_{50}$. In pharmacology and toxicology, dose-response relationships are most often plotted on a logarithmic concentration axis. Therefore, the system is conventionally considered most sensitive around its central point, $C = \\mathrm{EC}_{50} = 2\\,\\mathrm{ng}\\,\\mathrm{mL}^{-1}$, where a given *proportional* or *fold* change in concentration yields the greatest change in effect.\n\n**Part 2: Sensitivity Evaluation**\n\nThe local linear sensitivity is defined as $S(C) = \\frac{dE}{dC}$. We must differentiate the expression for $E(C)$:\n$$ E(C) = E_{\\max} \\frac{C^n}{K + C^n} \\quad \\text{where } K = (\\mathrm{EC}_{50})^n $$\nUsing the quotient rule for differentiation:\n$$ S(C) = \\frac{dE}{dC} = E_{\\max} \\frac{(nC^{n-1})(K+C^n) - (C^n)(nC^{n-1})}{(K+C^n)^2} $$\n$$ S(C) = E_{\\max} \\frac{nKC^{n-1} + nC^{2n-1} - nC^{2n-1}}{(K+C^n)^2} = \\frac{E_{\\max} n K C^{n-1}}{(K+C^n)^2} $$\nSubstituting $K = (\\mathrm{EC}_{50})^n$ back into the expression:\n$$ S(C) = \\frac{E_{\\max} n (\\mathrm{EC}_{50})^n C^{n-1}}{((\\mathrm{EC}_{50})^n + C^n)^2} $$\nWe are asked to evaluate this function at $C=\\mathrm{EC}_{50}$.\n$$ S(\\mathrm{EC}_{50}) = \\frac{E_{\\max} n (\\mathrm{EC}_{50})^n (\\mathrm{EC}_{50})^{n-1}}{((\\mathrm{EC}_{50})^n + (\\mathrm{EC}_{50})^n)^2} = \\frac{E_{\\max} n (\\mathrm{EC}_{50})^{2n-1}}{(2(\\mathrm{EC}_{50})^n)^2} $$\n$$ S(\\mathrm{EC}_{50}) = \\frac{E_{\\max} n (\\mathrm{EC}_{50})^{2n-1}}{4(\\mathrm{EC}_{50})^{2n}} = \\frac{E_{\\max} n}{4 \\cdot \\mathrm{EC}_{50}} $$\nThis is the symbolic expression for the sensitivity at the half-maximal concentration.\n\nFinally, we compute the numerical value using the given parameters: $E_{\\max}=100$, $n=1.2$, and $\\mathrm{EC}_{50}=2$.\n$$ S(\\mathrm{EC}_{50}) = \\frac{100 \\times 1.2}{4 \\times 2} = \\frac{120}{8} = 15 $$\nThe units of $E$ are $\\%$ and the units of $C$ are $\\mathrm{ng}\\,\\mathrm{mL}^{-1}$. Therefore, the units of $S$ are $\\% \\text{ per } \\mathrm{ng}\\,\\mathrm{mL}^{-1}$.\nThe problem requires rounding the final answer to $4$ significant figures.", "answer": "$$\\boxed{15.00}$$", "id": "2540397"}, {"introduction": "The ultimate goal of ecotoxicology is often to predict risks at the population level, which requires integrating multiple biological processes and accounting for their inherent uncertainty. This capstone practice guides you through the process of building a comprehensive model that connects toxicokinetics (TK) and toxicodynamics (TD) to population dynamics. By implementing a Monte Carlo simulation [@problem_id:2540392], you will learn how to propagate parameter uncertainty from both the TK and TD models all the way to a probabilistic forecast of population growth rate ($\\lambda$). This advanced exercise provides hands-on experience with the kind of integrated assessment modeling that is essential for modern environmental risk management.", "problem": "Consider a population exposed to a constant external concentration of a single contaminant during a breeding period of length $T$ days. The goal is to propagate uncertainty from Toxicokinetics (TK) and Toxicodynamics (TD) into the prediction of a population-level endpoint, specifically the dominant eigenvalue $\\lambda$ of a two-stage Leslie matrix, using Monte Carlo (MC) simulation with specified parameter distributions. The program you write must implement the following mechanistic steps, beginning only from the principles stated here.\n\n1. Toxicokinetics (TK): Model internal concentration dynamics with a one-compartment, first-order uptake-elimination ordinary differential equation,\n$$\n\\frac{d C_{\\mathrm{int}}(t)}{dt} = k_u \\, C_{\\mathrm{ext}} - k_e \\, C_{\\mathrm{int}}(t),\n$$\nwhere $C_{\\mathrm{ext}}$ is the constant external concentration during the breeding period, $C_{\\mathrm{int}}(t)$ is internal concentration, $k_u$ is the uptake rate constant, and $k_e$ is the elimination rate constant. Assume initial internal concentration $C_{\\mathrm{int}}(0)=0$. Define the time-averaged internal concentration over the breeding period as\n$$\n\\overline{C}_{\\mathrm{int}} = \\frac{1}{T}\\int_{0}^{T} C_{\\mathrm{int}}(t)\\, dt.\n$$\nYou must compute $\\overline{C}_{\\mathrm{int}}$ from the differential equation above. Either numerical integration or an analytically correct evaluation of the integral is acceptable; however, the algorithm must be robust for small values of $k_e T$.\n\n2. Toxicodynamics (TD): Map the internal dose metric to vital-rate multipliers using Hill-type (log-logistic) relationships. Let the survival multiplier be\n$$\nm_s = \\frac{1}{1 + \\left(\\frac{\\overline{C}_{\\mathrm{int}}}{\\mathrm{EC50}_s}\\right)^{n_s}},\n$$\nand the fecundity multiplier be\n$$\nm_f = \\frac{1}{1 + \\left(\\frac{\\overline{C}_{\\mathrm{int}}}{\\mathrm{EC50}_f}\\right)^{n_f}},\n$$\nwhere $\\mathrm{EC50}_s$, $\\mathrm{EC50}_f$ are the median-effect internal concentrations for survival and fecundity respectively, and $n_s$, $n_f$ are Hill slopes. These multipliers scale baseline vital rates as $s = s_0 \\, m_s$, $p = p_0 \\, m_s$, and $f = f_0 \\, m_f$, where $s_0$ is baseline juvenile-to-adult survival over one breeding period, $p_0$ is baseline adult survival over one breeding period, and $f_0$ is baseline per-adult fecundity over one breeding period.\n\n3. Population projection: Use a two-stage Leslie matrix\n$$\n\\mathbf{L}=\\begin{bmatrix}\n0 & f \\\\\ns & p\n\\end{bmatrix},\n$$\nand define $\\lambda$ as the dominant eigenvalue (real, nonnegative) of $\\mathbf{L}$.\n\n4. Uncertainty propagation with Monte Carlo (MC): Sample TK and TD parameters from independent lognormal distributions parameterized in natural-log space. For a lognormal variable $X \\sim \\mathrm{Lognormal}(\\mu,\\sigma)$, $\\ln X \\sim \\mathcal{N}(\\mu,\\sigma^2)$. Use the distributions and constants below. For all simulations, fix the random number generator seed to $12345$ to ensure reproducibility, and use exactly $N=10000$ independent Monte Carlo samples per test case.\n\nParameter distributions (all parameters are sampled independently for each Monte Carlo draw):\n- TK parameters:\n  - $k_u \\sim \\mathrm{Lognormal}(\\mu=\\ln 5, \\sigma=0.3)$ with unit $(\\mathrm{L}\\,\\mathrm{kg}^{-1}\\,\\mathrm{day}^{-1})$.\n  - $k_e \\sim \\mathrm{Lognormal}(\\mu=\\ln 0.5, \\sigma=0.2)$ with unit $(\\mathrm{day}^{-1})$.\n- TD parameters:\n  - $\\mathrm{EC50}_s \\sim \\mathrm{Lognormal}(\\mu=\\ln 50, \\sigma=0.5)$ with unit $(\\mathrm{mg}\\,\\mathrm{kg}^{-1})$.\n  - $n_s \\sim \\mathrm{Lognormal}(\\mu=\\ln 2, \\sigma=0.25)$ unitless.\n  - $\\mathrm{EC50}_f \\sim \\mathrm{Lognormal}(\\mu=\\ln 30, \\sigma=0.4)$ with unit $(\\mathrm{mg}\\,\\mathrm{kg}^{-1})$.\n  - $n_f \\sim \\mathrm{Lognormal}(\\mu=\\ln 1.5, \\sigma=0.25)$ unitless.\n\nFixed baseline vital rates (apply to every test case):\n- $s_0 = 0.4$ (unitless, per breeding period).\n- $p_0 = 0.6$ (unitless, per breeding period).\n- $f_0 = 5$ (unitless, offspring per adult per breeding period).\n\nExposure scenario and units:\n- $C_{\\mathrm{ext}}$ is constant during the breeding period and is specified in $(\\mathrm{mg}\\,\\mathrm{L}^{-1})$.\n- $T$ is the breeding period duration in $(\\mathrm{days})$.\n- Internal concentration $C_{\\mathrm{int}}$ and $\\overline{C}_{\\mathrm{int}}$ are in $(\\mathrm{mg}\\,\\mathrm{kg}^{-1})$.\n\nTest suite: Run the MC algorithm for the following four test cases, each given as $(C_{\\mathrm{ext}}, T)$:\n- Case A: $(10, 30)$\n- Case B (boundary, no exposure): $(0, 30)$\n- Case C (high exposure, longer duration): $(100, 60)$\n- Case D (short duration): $(20, 5)$\n\nAll numbers in the input specifications above are exact and must be used as given.\n\nRequired outputs for each test case:\n- Compute the following four quantities from the Monte Carlo sample of $\\lambda$ values:\n  1. The sample mean of $\\lambda$.\n  2. The empirical lower $0.025$ quantile of $\\lambda$.\n  3. The empirical upper $0.975$ quantile of $\\lambda$.\n  4. The empirical probability that $\\lambda &lt; 1$ (i.e., the fraction of simulated $\\lambda$ values strictly less than $1$).\n- Express all four outputs as unitless floats. Round each to exactly six digits after the decimal point.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of four-element lists, with no spaces, enclosed in square brackets. For example,\n$$\n[\\,[\\text{mean}_A,\\text{lo}_A,\\text{hi}_A,\\text{pdecl}_A],[\\text{mean}_B,\\text{lo}_B,\\text{hi}_B,\\text{pdecl}_B],[\\text{mean}_C,\\text{lo}_C,\\text{hi}_C,\\text{pdecl}_C],[\\text{mean}_D,\\text{lo}_D,\\text{hi}_D,\\text{pdecl}_D]\\,].\n$$\nUse the four test cases in the order A, B, C, D described above. There must be no additional whitespace or text.\n\nNumerical stability requirements and constraints:\n- Ensure robustness for small $k_e T$ when computing $\\overline{C}_{\\mathrm{int}}$; if using a closed-form expression, implement a series expansion as needed for $k_e T \\to 0$.\n- The final $\\lambda$ is dimensionless and must be interpreted per breeding period. All intermediate computations must respect the units specified above.", "solution": "The solution requires a multi-step analytical and computational procedure. It begins with solving the differential equation for toxicokinetics, followed by deriving the population-level endpoint, and culminates in a Monte Carlo simulation for uncertainty propagation.\n\n**1. Toxicokinetics (TK) Model Solution**\n\nThe dynamics of the internal contaminant concentration, $C_{\\mathrm{int}}(t)$, are described by a first-order linear ordinary differential equation (ODE):\n$$\n\\frac{d C_{\\mathrm{int}}(t)}{dt} = k_u \\, C_{\\mathrm{ext}} - k_e \\, C_{\\mathrm{int}}(t)\n$$\nwith the initial condition $C_{\\mathrm{int}}(0) = 0$. Here, $k_u$ is the uptake rate constant in units of $(\\mathrm{L}\\,\\mathrm{kg}^{-1}\\,\\mathrm{day}^{-1})$, $C_{\\mathrm{ext}}$ is the constant external concentration in $(\\mathrm{mg}\\,\\mathrm{L}^{-1})$, and $k_e$ is the elimination rate constant in $(\\mathrm{day}^{-1})$. The term $k_u C_{\\mathrm{ext}}$ has units of $(\\mathrm{mg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{day}^{-1})$, consistent with the rate of change of internal concentration.\n\nThis ODE can be solved using an integrating factor, $I(t) = e^{\\int k_e dt} = e^{k_e t}$. Multiplying the rearranged ODE, $\\frac{d C_{\\mathrm{int}}}{dt} + k_e C_{\\mathrm{int}} = k_u C_{\\mathrm{ext}}$, by $I(t)$ gives:\n$$\ne^{k_e t}\\frac{d C_{\\mathrm{int}}}{dt} + k_e e^{k_e t} C_{\\mathrm{int}} = k_u C_{\\mathrm{ext}} e^{k_e t}\n$$\nThe left side is the derivative of the product $C_{\\mathrm{int}}(t)e^{k_e t}$. Integrating both sides with respect to time $t$ from $0$ to $t$ yields:\n$$\n\\int_0^t \\frac{d}{d\\tau} \\left( C_{\\mathrm{int}}(\\tau)e^{k_e \\tau} \\right) d\\tau = \\int_0^t k_u C_{\\mathrm{ext}} e^{k_e \\tau} d\\tau\n$$\n$$\nC_{\\mathrm{int}}(t)e^{k_e t} - C_{\\mathrm{int}}(0)e^0 = k_u C_{\\mathrm{ext}} \\left[ \\frac{e^{k_e \\tau}}{k_e} \\right]_0^t\n$$\nApplying the initial condition $C_{\\mathrm{int}}(0)=0$ and evaluating the integral:\n$$\nC_{\\mathrm{int}}(t)e^{k_e t} = \\frac{k_u C_{\\mathrm{ext}}}{k_e} (e^{k_e t} - 1)\n$$\nSolving for $C_{\\mathrm{int}}(t)$, we obtain the analytical solution:\n$$\nC_{\\mathrm{int}}(t) = \\frac{k_u C_{\\mathrm{ext}}}{k_e} (1 - e^{-k_e t})\n$$\nThis equation describes the internal concentration at any time $t$ during the exposure period. For the special case where the external concentration $C_{\\mathrm{ext}} = 0$, it is trivial to show that $C_{\\mathrm{int}}(t) = 0$ for all time.\n\n**2. Time-Averaged Internal Concentration $\\overline{C}_{\\mathrm{int}}$**\n\nThe relevant dose metric for chronic effects is defined as the time-averaged internal concentration over the breeding period of length $T$:\n$$\n\\overline{C}_{\\mathrm{int}} = \\frac{1}{T}\\int_{0}^{T} C_{\\mathrm{int}}(t)\\, dt\n$$\nSubstituting the derived expression for $C_{\\mathrm{int}}(t)$:\n$$\n\\overline{C}_{\\mathrm{int}} = \\frac{1}{T}\\int_{0}^{T} \\frac{k_u C_{\\mathrm{ext}}}{k_e} (1 - e^{-k_e t})\\, dt = \\frac{k_u C_{\\mathrm{ext}}}{k_e T} \\left[ t + \\frac{e^{-k_e t}}{k_e} \\right]_{0}^{T}\n$$\nEvaluating the definite integral:\n$$\n\\overline{C}_{\\mathrm{int}} = \\frac{k_u C_{\\mathrm{ext}}}{k_e T} \\left( (T + \\frac{e^{-k_e T}}{k_e}) - (0 + \\frac{1}{k_e}) \\right) = \\frac{k_u C_{\\mathrm{ext}}}{k_e T} \\left( T + \\frac{e^{-k_e T} - 1}{k_e} \\right)\n$$\nThis expression can be rearranged to a more compact form:\n$$\n\\overline{C}_{\\mathrm{int}} = \\frac{k_u C_{\\mathrm{ext}}}{k_e} \\left( 1 - \\frac{1 - e^{-k_e T}}{k_e T} \\right)\n$$\nFor numerical implementation, this formula must be handled with care when the product $k_e T$ is close to zero. Direct computation can lead to catastrophic cancellation in the numerator $1 - e^{-k_e T}$ and division by a small number. A more robust approach uses the function $\\mathrm{expm1}(x) = e^x - 1$, which is implemented to be accurate for small $x$. The term $(1 - e^{-k_e T})/(k_e T)$ can be computed as $-\\mathrm{expm1}(-k_e T)/(k_e T)$. In the limit as $k_e T \\to 0$, the expression for $\\overline{C}_{\\mathrm{int}}$ approaches $\\frac{1}{2} k_u C_{\\mathrm{ext}} T$, which corresponds to a linear uptake scenario.\n\n**3. Toxicodynamics (TD) and Population Dynamics**\n\nThe time-averaged internal concentration $\\overline{C}_{\\mathrm{int}}$ is linked to effects on vital rates through Hill-type dose-response functions, yielding multipliers $m_s$ for survival and $m_f$ for fecundity. The affected vital rates are $s = s_0 m_s$, $p = p_0 m_s$, and $f = f_0 m_f$, where $s_0=0.4$, $p_0=0.6$, and $f_0=5$ are the baseline rates.\n\nThese rates populate a two-stage Leslie matrix:\n$$\n\\mathbf{L}=\\begin{bmatrix}\n0 & f \\\\\ns & p\n\\end{bmatrix}\n$$\nThe population growth rate is given by the dominant eigenvalue $\\lambda$ of this matrix. The eigenvalues are the roots of the characteristic equation $\\det(\\mathbf{L} - \\lambda\\mathbf{I}) = 0$:\n$$\n\\det\\begin{bmatrix}\n-\\lambda & f \\\\\ns & p-\\lambda\n\\end{bmatrix} = (-\\lambda)(p-\\lambda) - fs = \\lambda^2 - p\\lambda - fs = 0\n$$\nThis is a quadratic equation in $\\lambda$. By the quadratic formula, the roots are:\n$$\n\\lambda = \\frac{p \\pm \\sqrt{p^2 + 4fs}}{2}\n$$\nSince $s, p, f$ are non-negative rates, the term under the square root, $p^2 + 4fs$, is always non-negative. According to the Perron-Frobenius theorem for non-negative matrices, there exists a unique, real, non-negative dominant eigenvalue. This corresponds to the larger root:\n$$\n\\lambda = \\frac{p + \\sqrt{p^2 + 4fs}}{2}\n$$\nThis value $\\lambda$ is the primary output of the deterministic portion of the model.\n\n**4. Monte Carlo Uncertainty Propagation**\n\nThe core of the problem is to propagate the uncertainty from the six TK and TD parameters ($k_u, k_e, \\mathrm{EC50}_s, n_s, \\mathrm{EC50}_f, n_f$) to the predicted eigenvalue $\\lambda$. This is achieved through Monte Carlo simulation. The procedure for each test case $(C_{\\mathrm{ext}}, T)$ is as follows:\n\n1.  Initialize a random number generator with a fixed seed of $12345$ for reproducibility.\n2.  Generate $N=10000$ independent samples for each of the six parameters from their specified lognormal distributions. A variable $X \\sim \\mathrm{Lognormal}(\\mu, \\sigma)$ is generated by sampling $Z \\sim \\mathcal{N}(\\mu, \\sigma^2)$ and setting $X = e^Z$.\n3.  For each of the $N$ sets of parameter samples, execute the deterministic model sequence:\n    a. Calculate $\\overline{C}_{\\mathrm{int}}$ using the sampled $k_u$, $k_e$ and the given $C_{\\mathrm{ext}}, T$.\n    b. Calculate the multipliers $m_s$ and $m_f$ using the sampled TD parameters and the calculated $\\overline{C}_{\\mathrm{int}}$.\n    c. Calculate the vital rates $s, p, f$.\n    d. Calculate the corresponding eigenvalue $\\lambda$.\n4.  This process yields a sample of $N=10000$ values of $\\lambda$.\n5.  From this sample, compute the required summary statistics: the sample mean, the empirical $0.025$ and $0.975$ quantiles (forming a $95\\%$ credible interval), and the empirical probability of population decline, $P(\\lambda < 1)$, which is the fraction of samples where $\\lambda < 1$.\n\nFor the control case where $C_{\\mathrm{ext}}=0$, the internal concentration $\\overline{C}_{\\mathrm{int}}$ is always zero. Consequently, the multipliers $m_s$ and $m_f$ are always $1$, and the vital rates $s, p, f$ are always equal to their baseline values $s_0, p_0, f_0$. The eigenvalue $\\lambda$ is therefore a single deterministic value, $\\lambda_0 = (p_0 + \\sqrt{p_0^2 + 4f_0 s_0})/2 \\approx 1.745683$, for all $N$ simulations. The mean, lower quantile, and upper quantile will all be this value, and the probability of decline will be $0$. This serves as a critical internal control for the logic of the algorithm.\n\nThe final implementation will be a Python script that performs these calculations for each specified test case and formats the output precisely as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_mc_simulation(C_ext, T, N, rng):\n    \"\"\"\n    Runs a Monte Carlo simulation for a single exposure scenario.\n\n    Args:\n        C_ext (float): External contaminant concentration.\n        T (float): Duration of the exposure period.\n        N (int): Number of Monte Carlo samples.\n        rng (numpy.random.Generator): A seeded random number generator.\n\n    Returns:\n        list: A list of four floats: [mean_lambda, lower_quantile, \n                                     upper_quantile, prob_decline].\n    \"\"\"\n    # Fixed baseline vital rates (constants)\n    s0 = 0.4\n    p0 = 0.6\n    f0 = 5.0\n\n    # Generate N parameter samples from specified lognormal distributions.\n    # The problem specifies Lognormal(mu, sigma) where ln(X) ~ N(mu, sigma^2).\n    # numpy.random.lognormal takes mean (mu) and sigma of the underlying normal dist.\n    \n    # TK parameters\n    k_u = rng.lognormal(mean=np.log(5.0), sigma=0.3, size=N)\n    k_e = rng.lognormal(mean=np.log(0.5), sigma=0.2, size=N)\n    \n    # TD parameters\n    EC50_s = rng.lognormal(mean=np.log(50.0), sigma=0.5, size=N)\n    n_s = rng.lognormal(mean=np.log(2.0), sigma=0.25, size=N)\n    EC50_f = rng.lognormal(mean=np.log(30.0), sigma=0.4, size=N)\n    n_f = rng.lognormal(mean=np.log(1.5), sigma=0.25, size=N)\n\n    # 1. Toxicokinetics: Calculate time-averaged internal concentration (C_int_bar)\n    # Handle the C_ext = 0 case separately for efficiency and clarity.\n    if C_ext == 0.0:\n        C_int_bar = np.zeros(N)\n    else:\n        # Use the analytical solution for C_int_bar derived from the ODE.\n        # C_int_bar = (k_u * C_ext / k_e) * (1 - (1 - exp(-k_e*T)) / (k_e*T))\n        # For numerical stability when k_e*T is small, (1-exp(-x))/x is computed\n        # as -expm1(-x)/x.\n        x = k_e * T\n        stable_frac = -np.expm1(-x) / x\n        C_int_bar = (k_u * C_ext / k_e) * (1.0 - stable_frac)\n\n    # 2. Toxicodynamics: Map internal dose to vital rate multipliers\n    m_s = 1.0 / (1.0 + (C_int_bar / EC50_s)**n_s)\n    m_f = 1.0 / (1.0 + (C_int_bar / EC50_f)**n_f)\n    \n    # Calculate affected vital rates\n    s = s0 * m_s\n    p = p0 * m_s\n    f = f0 * m_f\n\n    # 3. Population projection: Calculate dominant eigenvalue lambda\n    # lambda = (p + sqrt(p^2 + 4*f*s)) / 2\n    lambda_samples = (p + np.sqrt(p**2 + 4.0 * f * s)) / 2.0\n    \n    # 4. Compute and return required output statistics from the lambda sample\n    mean_lambda = np.mean(lambda_samples)\n    q_low = np.quantile(lambda_samples, 0.025)\n    q_high = np.quantile(lambda_samples, 0.975)\n    prob_decline = np.mean(lambda_samples < 1.0)\n    \n    return [mean_lambda, q_low, q_high, prob_decline]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Monte Carlo simulation parameters\n    N = 10000\n    seed = 12345\n    rng = np.random.default_rng(seed)\n    \n    # Test cases as tuples of (C_ext, T)\n    test_cases = [\n        (10.0, 30.0),  # Case A\n        (0.0, 30.0),   # Case B\n        (100.0, 60.0), # Case C\n        (20.0, 5.0)    # Case D\n    ]\n    \n    all_results = []\n    for C_ext, T in test_cases:\n        # Run simulation for one case\n        results_for_case = run_mc_simulation(C_ext, T, N, rng)\n        all_results.append(results_for_case)\n    \n    # Format the final output string exactly as specified.\n    # Example: [[meanA,loA,hiA,pdeclA],[meanB,loB,hiB,pdeclB],...]\n    # Values are rounded to 6 decimal places. Commas are separators. No spaces.\n    case_strings = []\n    for stats in all_results:\n        # Format each statistic to 6 decimal places and join with commas\n        formatted_stats = f\"{stats[0]:.6f},{stats[1]:.6f},{stats[2]:.6f},{stats[3]:.6f}\"\n        case_strings.append(f\"[{formatted_stats}]\")\n    \n    # Join all case strings and enclose in brackets\n    final_output_string = f\"[{','.join(case_strings)}]\"\n    \n    # The final print statement must ONLY produce the required string.\n    print(final_output_string)\n\n# Execute the solver\nsolve()\n```", "id": "2540392"}]}