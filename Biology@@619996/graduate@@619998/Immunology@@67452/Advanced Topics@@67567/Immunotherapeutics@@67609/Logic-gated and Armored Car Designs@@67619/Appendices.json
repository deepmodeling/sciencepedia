{"hands_on_practices": [{"introduction": "An essential strategy for improving the safety and specificity of CAR T-cell therapy is to engineer logic gates that require the recognition of two distinct antigens for full activation. This exercise explores the fundamental design of a two-input AND-gate, where T-cell activation depends on the concurrent and independent binding of two separate CAR modules to their respective antigens. By applying the law of mass action to model receptor-ligand equilibrium, you will derive the core mathematical relationship governing the system's activation probability, providing a quantitative foundation for designing more discriminating immunotherapies [@problem_id:2864928].", "id": "2864928", "problem": "A T cell is engineered with a two-module Chimeric Antigen Receptor (CAR) system to implement an AND-type logic gate and is further armored to secrete Interleukin-12 (IL-12) upon activation. The first module, denoted CAR$\\zeta$, delivers the primary activation signal via the CD3$\\zeta$ chain when it binds antigen $A_{\\zeta}$. The second module, denoted CAR28, delivers costimulation via CD28 when it binds a distinct antigen $A_{28}$. In a synapse with a target cell, let the free, effective antigen concentrations be $[A_{\\zeta}]$ and $[A_{28}]$, respectively. The binding of each module to its cognate antigen is monovalent, occurs under well-mixed conditions, and reaches equilibrium. The equilibrium dissociation constants are $K_{D\\zeta}$ for CAR$\\zeta$:$A_{\\zeta}$ and $K_{D28}$ for CAR28:$A_{28}$, defined in the usual way by the Law of Mass Action. Assume antigen is present in sufficient excess relative to receptor such that the free antigen concentrations $[A_{\\zeta}]$ and $[A_{28}]$ can be treated as fixed.\n\nDefine the cell to be activated when both modules are engaged concurrently within the same signaling microdomain. Assume the engagement events of CAR$\\zeta$ and CAR28 are independent and that signals integrate multiplicatively in the following sense: the activation probability equals the product of the marginal engagement probabilities contributed by each module at equilibrium.\n\nStarting only from the definition of the equilibrium dissociation constant and standard mass-action equilibrium for monovalent binding, derive an analytical expression for the activation probability $P_{\\mathrm{act}}$ as a function of $[A_{\\zeta}]$, $[A_{28}]$, $K_{D\\zeta}$, and $K_{D28}$. Express your final answer as a single closed-form expression. Do not approximate numerically; no rounding is required. State your final result as a dimensionless probability.", "solution": "The problem statement has been evaluated and is deemed valid. It is scientifically grounded, well-posed, objective, and contains all necessary information to derive a unique solution based on fundamental principles of biochemical kinetics. The task is to derive the activation probability of a logic-gated CAR T cell, which requires applying the law of mass action to model receptor-ligand binding at equilibrium.\n\nThe problem defines the activation probability, $P_{\\mathrm{act}}$, as the product of the marginal engagement probabilities of the two independent CAR modules, CAR$\\zeta$ and CAR28. This is expressed as:\n$$P_{\\mathrm{act}} = P_{\\zeta} \\cdot P_{28}$$\nwhere $P_{\\zeta}$ is the probability of a CAR$\\zeta$ module being engaged and $P_{28}$ is the probability of a CAR28 module being engaged. The engagement probability for a given receptor type is equivalent to the fraction of that receptor population that is bound to its cognate antigen at equilibrium.\n\nFirst, we derive the general expression for the fraction of bound receptors for a monovalent binding reaction at equilibrium. Let $R$ represent a generic receptor, $A$ its cognate antigen, and $RA$ the receptor-antigen complex. The binding reaction is:\n$$R + A \\rightleftharpoons RA$$\nThe equilibrium dissociation constant, $K_{D}$, is defined by the law of mass action as:\n$$K_D = \\frac{[R] [A]}{[RA]}$$\nwhere $[R]$, $[A]$, and $[RA]$ are the equilibrium concentrations of the free receptor, free antigen, and the complex, respectively.\n\nThe total concentration of receptors, $[R]_{\\mathrm{total}}$, is the sum of the concentrations of free receptors and bound receptors:\n$$[R]_{\\mathrm{total}} = [R] + [RA]$$\nThe probability of engagement is the fraction of total receptors that are bound, which we denote as $\\theta$:\n$$\\theta = \\frac{[RA]}{[R]_{\\mathrm{total}}}$$\nTo express $\\theta$ in terms of measurable quantities, we first rearrange the $K_D$ expression to solve for the free receptor concentration $[R]$:\n$$[R] = \\frac{K_D [RA]}{[A]}$$\nSubstituting this into the equation for the total receptor concentration gives:\n$$[R]_{\\mathrm{total}} = \\frac{K_D [RA]}{[A]} + [RA]$$\nFactoring out $[RA]$:\n$$[R]_{\\mathrm{total}} = [RA] \\left( \\frac{K_D}{[A]} + 1 \\right) = [RA] \\left( \\frac{K_D + [A]}{[A]} \\right)$$\nNow we can solve for the fraction of bound receptors, $\\theta$:\n$$\\theta = \\frac{[RA]}{[R]_{\\mathrm{total}}} = \\frac{[RA]}{[RA] \\left( \\frac{K_D + [A]}{[A]} \\right)} = \\frac{[A]}{[A] + K_D}$$\nThis is the Hill-Langmuir equation, which describes the fraction of receptor sites occupied by a ligand as a function of the ligand concentration. The problem specifies that the free antigen concentrations, $[A_{\\zeta}]$ and $[A_{28}]$, can be treated as fixed, which is consistent with the use of $[A]$ in this derivation.\n\nWe now apply this general result to each of the two CAR modules.\n\nFor the CAR$\\zeta$ module, the receptor is CAR$\\zeta$, the antigen is $A_{\\zeta}$, and the dissociation constant is $K_{D\\zeta}$. The probability of engagement, $P_{\\zeta}$, is therefore:\n$$P_{\\zeta} = \\frac{[A_{\\zeta}]}{[A_{\\zeta}] + K_{D\\zeta}}$$\n\nFor the CAR28 module, the receptor is CAR28, the antigen is $A_{28}$, and the dissociation constant is $K_{D28}$. The probability of engagement, $P_{28}$, is:\n$$P_{28} = \\frac{[A_{28}]}{[A_{28}] + K_{D28}}$$\n\nFinally, according to the problem's AND-gate model, the total activation probability $P_{\\mathrm{act}}$ is the product of these two independent probabilities:\n$$P_{\\mathrm{act}} = P_{\\zeta} \\cdot P_{28} = \\left( \\frac{[A_{\\zeta}]}{[A_{\\zeta}] + K_{D\\zeta}} \\right) \\left( \\frac{[A_{28}]}{[A_{28}] + K_{D28}} \\right)$$\nThis is the final, closed-form analytical expression for the activation probability as a function of the given parameters. The expression is dimensionless, as required for a probability.", "answer": "$$\n\\boxed{\\left( \\frac{[A_{\\zeta}]}{[A_{\\zeta}] + K_{D\\zeta}} \\right) \\left( \\frac{[A_{28}]}{[A_{28}] + K_{D28}} \\right)}\n$$"}, {"introduction": "Beyond combinatorial antigen recognition, another powerful strategy for controlling CAR T-cell activity involves integrating both activating and inhibitory signals within the immunological synapse. This practice challenges you to model this intracellular \"tug-of-war\" by analyzing the steady-state phosphorylation level of key signaling motifs, which results from a balance between kinase activity from an activating CAR and phosphatase activity from a co-engaged inhibitory CAR (iCAR). By quantifying how an iCAR alters the T-cell's activation potential, you will gain crucial insight into how these \"armored\" designs can prevent off-target toxicity and enhance therapeutic precision [@problem_id:2864949].", "id": "2864949", "problem": "A single engineered T cell simultaneously expresses an activating Chimeric Antigen Receptor (CAR) and an inhibitory CAR (iCAR), forming a single immunological synapse with a target cell. The net triggering of Zeta-chain-associated protein kinase $70$ (ZAP-$70$) is determined by the phosphorylation state of Immunoreceptor Tyrosine-based Activation Motif (ITAM) sites on the activating CAR’s CD$3\\zeta$ module. Assume the following fundamental bases:\n- At the synapse, receptor–ligand binding follows equilibrium mass-action with dissociation constant $K_{d}$, so that the fraction of bound receptors equals the ligand concentration divided by the sum of the ligand concentration and $K_{d}$.\n- Phosphorylation and dephosphorylation of ITAMs follow linear mass-action kinetics with rates proportional to the numbers of engaged activating CARs and engaged iCARs, respectively, plus a basal dephosphorylation term present even without iCAR engagement.\n- The steady-state probability that an ITAM is phosphorylated equals the steady-state phosphorylated fraction, and this is taken as the net ZAP-$70$ activation probability at the synapse.\n\nThe synapse patch contains $N_{A}^{\\text{tot}} = 120$ activating CAR chains and $N_{I}^{\\text{tot}} = 60$ iCAR chains. The target cell displays antigen for the activating CAR at an effective synaptic concentration $L_{A} = 20$ nM with $K_{d,A} = 10$ nM, and antigen for the iCAR at $L_{I} = 15$ nM with $K_{d,I} = 5$ nM. Each bound activating CAR contributes a phosphorylation rate constant $k_{p} = 0.15$ s$^{-1}$ (per ITAM). Each bound iCAR recruits phosphatase activity contributing a dephosphorylation rate constant $k_{d} = 0.40$ s$^{-1}$ (per ITAM). A basal dephosphorylation rate $k_{0} = 0.03$ s$^{-1}$ acts independently of iCAR engagement.\n\nUsing only these assumptions and parameters, derive from first principles and compute the fold-change in the steady-state ZAP-$70$ activation probability due to co-engagement of the iCAR, defined as the ratio\n$R = \\dfrac{\\text{ZAP-}70\\ \\text{activation with activating CAR and iCAR co-engaged}}{\\text{ZAP-}70\\ \\text{activation with only activating CAR engaged}}$.\nExpress your final answer as a decimal rounded to four significant figures. No units are required in the final answer.", "solution": "The problem requires the validation of its premises before a solution is attempted.\n\nFirst, I will extract the given information verbatim.\n- Total activating CAR chains: $N_{A}^{\\text{tot}} = 120$\n- Total inhibitory CAR chains: $N_{I}^{\\text{tot}} = 60$\n- Activating ligand concentration: $L_{A} = 20$ nM\n- Activating CAR dissociation constant: $K_{d,A} = 10$ nM\n- Inhibitory ligand concentration: $L_{I} = 15$ nM\n- Inhibitory CAR dissociation constant: $K_{d,I} = 5$ nM\n- Phosphorylation rate constant per bound activating CAR: $k_{p} = 0.15$ s$^{-1}$\n- Dephosphorylation rate constant per bound iCAR: $k_{d} = 0.40$ s$^{-1}$\n- Basal dephosphorylation rate constant: $k_{0} = 0.03$ s$^{-1}$\n- The fraction of bound receptors is given by the formula $\\frac{L}{L + K_{d}}$.\n- Phosphorylation and dephosphorylation of ITAMs are modeled by linear mass-action kinetics.\n- ZAP-$70$ activation probability is equivalent to the steady-state fraction of phosphorylated ITAMs.\n- The target quantity is the ratio $R = \\dfrac{\\text{ZAP-}70\\ \\text{activation with activating CAR and iCAR co-engaged}}{\\text{ZAP-}70\\ \\text{activation with only activating CAR engaged}}$.\n\nNow, I will validate the problem. The problem is a standard exercise in biochemical kinetics and systems biology. It uses established concepts such as mass-action kinetics and receptor-ligand binding equilibria. The model is a simplification of a complex biological process, but it is internally consistent, scientifically grounded, and well-posed. All parameters necessary for a unique solution are provided, and no contradictions are present. The language is objective and precise. The problem is therefore deemed valid.\n\nI will now proceed with the solution.\n\nThe problem asks for the steady-state probability of ITAM phosphorylation, which we denote as $p$. This probability represents the fraction of total ITAMs on activating CARs that are in a phosphorylated state at steady state. Let $I_{p}$ and $I_{u}$ represent the number of phosphorylated and unphosphorylated ITAMs, respectively. The evolution of the fraction of phosphorylated ITAMs, $p = \\frac{I_p}{I_p + I_u}$, is described by the differential equation:\n$$ \\frac{dp}{dt} = k_{f} (1 - p) - k_{r} p $$\nwhere $k_{f}$ is the total phosphorylation rate constant and $k_{r}$ is the total dephosphorylation rate constant. This equation follows from linear mass-action kinetics, where the rate of phosphorylation is proportional to the fraction of unphosphorylated sites, $(1-p)$, and the rate of dephosphorylation is proportional to the fraction of phosphorylated sites, $p$.\n\nAt steady state, $\\frac{dp}{dt} = 0$. This gives:\n$$ k_{f} (1 - p_{ss}) = k_{r} p_{ss} $$\nSolving for the steady-state fraction $p_{ss}$:\n$$ k_{f} = k_{f} p_{ss} + k_{r} p_{ss} = (k_{f} + k_{r}) p_{ss} $$\n$$ p_{ss} = \\frac{k_{f}}{k_{f} + k_{r}} $$\n\nThe problem states that the total phosphorylation rate is proportional to the number of engaged activating CARs, $N_{A}$. Each engaged CAR contributes a rate constant $k_p$. Thus, the total phosphorylation rate constant is:\n$$ k_{f} = k_{p} N_{A} $$\nThe total dephosphorylation rate includes a basal component $k_{0}$ and a component proportional to the number of engaged iCARs, $N_{I}$. Each engaged iCAR contributes a rate constant $k_d$. Thus, the total dephosphorylation rate constant is:\n$$ k_{r} = k_{0} + k_{d} N_{I} $$\n\nThe number of engaged receptors is determined by the ligand concentration $L$ and the dissociation constant $K_d$. The fraction of bound receptors is $f = \\frac{L}{L + K_d}$.\nThe number of engaged activating CARs, $N_{A}$, is:\n$$ N_{A} = N_{A}^{\\text{tot}} \\cdot \\frac{L_{A}}{L_{A} + K_{d,A}} $$\nThe number of engaged inhibitory CARs, $N_{I}$, is:\n$$ N_{I} = N_{I}^{\\text{tot}} \\cdot \\frac{L_{I}}{L_{I} + K_{d,I}} $$\n\nWe now substitute the given numerical values:\n$$ N_{A} = 120 \\cdot \\frac{20}{20 + 10} = 120 \\cdot \\frac{20}{30} = 120 \\cdot \\frac{2}{3} = 80 $$\n$$ N_{I} = 60 \\cdot \\frac{15}{15 + 5} = 60 \\cdot \\frac{15}{20} = 60 \\cdot \\frac{3}{4} = 45 $$\n\nWith these values, we can calculate the effective rate constants:\nThe phosphorylation term is $k_{p} N_{A} = 0.15 \\, \\text{s}^{-1} \\cdot 80 = 12 \\, \\text{s}^{-1}$.\nThe iCAR-dependent dephosphorylation term is $k_{d} N_{I} = 0.40 \\, \\text{s}^{-1} \\cdot 45 = 18 \\, \\text{s}^{-1}$.\nThe basal dephosphorylation rate constant is $k_{0} = 0.03 \\, \\text{s}^{-1}$.\n\nWe must calculate the ZAP-$70$ activation probability for two cases.\n\nCase 1: Activating CAR and iCAR are co-engaged.\nIn this case, both $N_A$ and $N_I$ are non-zero. The activation probability, $p_{\\text{with-iCAR}}$, is:\n$$ p_{\\text{with-iCAR}} = \\frac{k_{f}}{k_{f} + k_{r}} = \\frac{k_{p} N_{A}}{k_{p} N_{A} + k_{0} + k_{d} N_{I}} $$\nSubstituting the computed values:\n$$ p_{\\text{with-iCAR}} = \\frac{12}{12 + 0.03 + 18} = \\frac{12}{30.03} $$\n\nCase 2: Only activating CAR is engaged.\nThis implies there is no signal from the iCARs, so we set their contribution to zero. This corresponds to $N_I=0$. The activation probability, $p_{\\text{no-iCAR}}$, is:\n$$ p_{\\text{no-iCAR}} = \\frac{k_{p} N_{A}}{k_{p} N_{A} + k_{0}} $$\nSubstituting the computed values:\n$$ p_{\\text{no-iCAR}} = \\frac{12}{12 + 0.03} = \\frac{12}{12.03} $$\n\nThe problem asks for the fold-change, $R$, which is the ratio of these two probabilities:\n$$ R = \\frac{p_{\\text{with-iCAR}}}{p_{\\text{no-iCAR}}} = \\frac{\\frac{k_{p} N_{A}}{k_{p} N_{A} + k_{0} + k_{d} N_{I}}}{\\frac{k_{p} N_{A}}{k_{p} N_{A} + k_{0}}} $$\nSimplifying this expression algebraically:\n$$ R = \\frac{k_{p} N_{A} + k_{0}}{k_{p} N_{A} + k_{0} + k_{d} N_{I}} $$\nNow, we substitute the values for the terms:\n$$ R = \\frac{12 + 0.03}{12 + 0.03 + 18} = \\frac{12.03}{30.03} $$\nComputing the final numerical value:\n$$ R \\approx 0.40059940059... $$\nThe problem requires the answer to be rounded to four significant figures.\n$$ R \\approx 0.4006 $$\nThis result, being less than $1$, correctly reflects the inhibitory function of the co-engaged iCAR system.", "answer": "$$\\boxed{0.4006}$$"}, {"introduction": "While sophisticated logic gates enhance single-cell precision, the ultimate clinical success of any immunotherapy is determined by its ability to overcome tumor evolution at the population level. This final practice shifts the focus from deterministic, single-cell biophysics to the stochastic dynamics of a heterogeneous tumor population, tasking you with modeling tumor escape as a probabilistic race between CAR T-cell killing and the random loss of target antigens. By implementing a model based on competing exponential processes, you will quantify the probability and expected timeline of therapeutic resistance, a critical step in predicting long-term treatment outcomes and designing more robust therapies [@problem_id:2864958].", "id": "2864958", "problem": "You are asked to formalize and analyze a stochastic model of tumor escape in the context of logic-gated Chimeric Antigen Receptor (CAR) T cell designs. In an AND-gated CAR design, a tumor cell is susceptible to CAR-mediated killing if and only if it co-expresses two independent antigens, denoted as $A$ and $B$. Tumor cells that lose either $A$ or $B$ become resistant to AND-gated CAR killing. The goal is to quantify how asymmetric antigen loss (loss of $A$ versus loss of $B$) affects tumor escape and to compute the expected time to escape under a stochastic loss model.\n\nFundamental base and model assumptions:\n- Each of $N$ initial tumor cells is double-positive and independently experiences three competing, memoryless processes: CAR-mediated killing, loss of antigen $A$, and loss of antigen $B$. The time to the first event for each process is exponentially distributed with constant hazard rates $k$ (per day), $\\lambda_A$ (per day), and $\\lambda_B$ (per day), respectively.\n- For each cell, define $r = k + \\lambda_A + \\lambda_B$. By the memoryless property of the exponential distribution, the time to the first event for that cell is exponentially distributed with rate $r$, and the identity of the first event is selected with probabilities proportional to $k$, $\\lambda_A$, and $\\lambda_B$.\n- A cell that is killed is removed. A cell that loses $A$ (respectively $B$) becomes resistant and is labeled as an $A$-loss escapee (respectively a $B$-loss escapee).\n- Define tumor escape as the event that at least one resistant cell (either $A$-loss or $B$-loss) appears before all $N$ cells are killed, together with the time at which the double-positive population is fully depleted (the maximum over the $N$ per-cell first-event times). The expected time to escape is defined as the expected time to depletion of double-positive cells, conditioned on the escape event having occurred. If the escape probability equals zero under the given parameters, define the expected time to escape to be $0$ by convention.\n- All rates are in per day, and expected times must be reported in days.\n\nRequired outputs per test case:\n1. The escape probability as a decimal in $[0,1]$.\n2. The expected time to escape in days, conditioned on escape, in decimal units.\n3. The probability that escape arises exclusively via antigen $A$ loss, meaning at least one $A$-loss escapee and zero $B$-loss escapees, as a decimal in $[0,1]$.\n4. The probability that escape arises exclusively via antigen $B$ loss, meaning at least one $B$-loss escapee and zero $A$-loss escapees, as a decimal in $[0,1]$.\n5. The probability that escape arises with both $A$-loss and $B$-loss escapees present among the $N$ final outcomes, as a decimal in $[0,1]$.\n\nYour program must implement the above model from first principles using the following well-tested facts without introducing any additional modeling assumptions:\n- For independent exponential clocks with rates $k$, $\\lambda_A$, and $\\lambda_B$, the minimum time is exponentially distributed with rate $r = k + \\lambda_A + \\lambda_B$, and the probability that a given clock is the minimum equals its rate divided by $r$.\n- For $N$ independent, identically distributed exponential random variables with rate $r$, the expected maximum equals the $N$th harmonic number divided by $r$, that is, $\\mathbb{E}[\\max\\{T_1,\\dots,T_N\\}] = H_N / r$, where $H_N = \\sum_{i=1}^{N} 1/i$.\n- For $N$ independent cells each with mutually exclusive outcomes (killed, $A$-loss, $B$-loss) occurring with probabilities $p_K = k/r$, $p_A = \\lambda_A/r$, and $p_B = \\lambda_B/r$, the joint distribution of the counts across $N$ cells is multinomial with parameters $(N; p_K, p_A, p_B)$.\n\nTest suite:\nFor each parameter set, interpret $k$, $\\lambda_A$, $\\lambda_B$ as per-day rates and $N$ as an integer cell count. Compute all five outputs described above for the following six test cases:\n\n1. $(N, k, \\lambda_A, \\lambda_B) = (100, 0.5, 0.05, 0.05)$\n2. $(N, k, \\lambda_A, \\lambda_B) = (100, 0.5, 0.2, 0.01)$\n3. $(N, k, \\lambda_A, \\lambda_B) = (100, 0.5, 0.01, 0.2)$\n4. $(N, k, \\lambda_A, \\lambda_B) = (50, 0.5, 0.0, 0.0)$\n5. $(N, k, \\lambda_A, \\lambda_B) = (20, 0.0, 0.05, 0.08)$\n6. $(N, k, \\lambda_A, \\lambda_B) = (1, 0.3, 0.2, 0.05)$\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of sublists, in the same order as the test cases. Each sublist must be of the form $[x_1,x_2,x_3,x_4,x_5]$ where $x_1$ is the escape probability, $x_2$ is the expected time to escape in days (conditioned on escape), $x_3$ is the probability of $A$-only escape, $x_4$ is the probability of $B$-only escape, and $x_5$ is the probability of escape with both $A$ and $B$ losses present. All five values in each sublist must be rounded to six decimal places. For example, an output line with two hypothetical cases would look like:\n[[x11,x12,x13,x14,x15],[x21,x22,x23,x24,x25]]\n\nAll outputs that represent probabilities must be decimals in $[0,1]$, and all times must be in days. No percentage signs are allowed. Angles are not involved in this problem.", "solution": "The problem as stated is a well-posed exercise in the application of probability theory to a stochastic model of tumor evolution under therapy. It is scientifically grounded, free of contradictions, and contains all necessary information for a unique solution. We shall proceed with a formal derivation from first principles.\n\nThe model considers $N$ independent and identical tumor cells. For each cell, three mutually exclusive events can occur: killing, loss of antigen $A$, or loss of antigen $B$. The times to these events are modeled as independent exponential random variables with constant rates $k$, $\\lambda_A$, and $\\lambda_B$ respectively.\n\nThe time to the first event for any given cell, $T$, is the minimum of the three exponentially distributed times. It is therefore itself exponentially distributed with a total rate $r = k + \\lambda_A + \\lambda_B$.\nThe identity of this first event is determined by which process \"wins the race\". The probabilities for each outcome are proportional to their rates:\n-   Probability of being killed, $p_K = \\frac{k}{k + \\lambda_A + \\lambda_B} = \\frac{k}{r}$.\n-   Probability of becoming an $A$-loss escapee, $p_A = \\frac{\\lambda_A}{k + \\lambda_A + \\lambda_B} = \\frac{\\lambda_A}{r}$.\n-   Probability of becoming a $B$-loss escapee, $p_B = \\frac{\\lambda_B}{k + \\lambda_A + \\lambda_B} = \\frac{\\lambda_B}{r}$.\nIt is clear that $p_K + p_A + p_B = 1$.\n\nThe final outcomes for the $N$ cells are independent trials. Let $N_K$, $N_A$, and $N_B$ be the random variables representing the number of cells that are killed, lose antigen $A$, and lose antigen $B$, respectively. The joint distribution of these counts $(N_K, N_A, N_B)$ is a multinomial distribution with parameters $(N; p_K, p_A, p_B)$.\n\nWe now derive the five required quantities.\n\n1.  **Escape Probability, $P(\\text{Escape})$**\n    Tumor escape occurs if at least one cell becomes resistant, which means not all $N$ cells are killed. The complementary event is \"no escape\", where all $N$ cells are killed. This corresponds to the outcome $N_K = N$, $N_A = 0$, and $N_B = 0$.\n    The probability of no escape is the probability of $N$ independent \"kill\" events:\n    $$P(\\text{No Escape}) = P(N_K=N) = p_K^N = \\left(\\frac{k}{r}\\right)^N$$\n    The probability of escape is therefore:\n    $$P(\\text{Escape}) = 1 - P(\\text{No Escape}) = 1 - \\left(\\frac{k}{r}\\right)^N$$\n\n2.  **Expected Time to Escape, Conditioned on Escape**\n    The time to depletion of the initial double-positive population is the maximum of the $N$ individual first-event times, $T_{\\text{depletion}} = \\max\\{T_1, \\dots, T_N\\}$. Each $T_i$ is an independent and identically distributed exponential random variable with rate $r$. The problem correctly states that the expected value of this maximum is $\\mathbb{E}[T_{\\text{depletion}}] = H_N / r$, where $H_N = \\sum_{i=1}^{N} \\frac{1}{i}$ is the $N$-th harmonic number.\n    A key property of exponential race models is that the time of the first event (the minimum) is independent of the identity of the winner. Consequently, for each cell $i$, the time $T_i$ is independent of its outcome (killed, $A$-loss, or $B$-loss). This independence extends to the entire population: the time to depletion $T_{\\text{depletion}}$ is independent of the collective outcome, including the event of escape.\n    Therefore, conditioning on escape does not alter the expectation of the depletion time, provided escape is possible.\n    $$\\mathbb{E}[T_{\\text{depletion}} | \\text{Escape}] = \\mathbb{E}[T_{\\text{depletion}}] = \\frac{H_N}{r}$$\n    By the problem's definition, if the escape probability is zero (which occurs if and only if $\\lambda_A = 0$ and $\\lambda_B = 0$), the expected time is defined as $0$.\n\n3.  **Probability of A-only Escape, $P(A\\text{-only})$**\n    This event is defined as having at least one $A$-loss escapee and zero $B$-loss escapees. In terms of counts, this is the event $\\{N_A \\ge 1 \\text{ and } N_B = 0\\}$.\n    We can calculate this using the law of total probability: $P(N_A \\ge 1 \\text{ and } N_B = 0) = P(N_B = 0) - P(N_A = 0 \\text{ and } N_B = 0)$.\n    The event $\\{N_B=0\\}$ means that all $N$ cells must have an outcome of either being killed or losing antigen $A$. The probability for a single cell to have such an outcome is $p_K+p_A$. For $N$ independent cells, this is:\n    $$P(N_B = 0) = (p_K + p_A)^N = \\left(\\frac{k+\\lambda_A}{r}\\right)^N$$\n    The event $\\{N_A = 0 \\text{ and } N_B = 0\\}$ is precisely the \"no escape\" event, where all cells are killed. Its probability is $p_K^N$.\n    Therefore, the probability of $A$-only escape is:\n    $$P(A\\text{-only}) = (p_K + p_A)^N - p_K^N = \\left(\\frac{k+\\lambda_A}{r}\\right)^N - \\left(\\frac{k}{r}\\right)^N$$\n\n4.  **Probability of B-only Escape, $P(B\\text{-only})$**\n    By symmetry, the probability of having at least one $B$-loss escapee and zero $A$-loss escapees ($\\{N_B \\ge 1 \\text{ and } N_A = 0\\}$) is:\n    $$P(B\\text{-only}) = (p_K + p_B)^N - p_K^N = \\left(\\frac{k+\\lambda_B}{r}\\right)^N - \\left(\\frac{k}{r}\\right)^N$$\n\n5.  **Probability of Mixed Escape (Both $A$ and $B$ Loss), $P(A,B\\text{-both})$**\n    This is the event where at least one $A$-loss escapee and at least one $B$-loss escapee are present, i.e., $\\{N_A \\ge 1 \\text{ and } N_B \\ge 1\\}$.\n    The total escape event is the disjoint union of three events: $A$-only escape, $B$-only escape, and mixed escape. Thus:\n    $$P(\\text{Escape}) = P(A\\text{-only}) + P(B\\text{-only}) + P(A,B\\text{-both})$$\n    Rearranging gives:\n    $$P(A,B\\text{-both}) = P(\\text{Escape}) - P(A\\text{-only}) - P(B\\text{-only})$$\n    Substituting the previously derived expressions:\n    $$P(A,B\\text{-both}) = \\left(1 - p_K^N\\right) - \\left((p_K + p_A)^N - p_K^N\\right) - \\left((p_K + p_B)^N - p_K^N\\right)$$\n    $$P(A,B\\text{-both}) = 1 - (p_K + p_A)^N - (p_K + p_B)^N + p_K^N$$\n    $$P(A,B\\text{-both}) = 1 - \\left(\\frac{k+\\lambda_A}{r}\\right)^N - \\left(\\frac{k+\\lambda_B}{r}\\right)^N + \\left(\\frac{k}{r}\\right)^N$$\n    This completes the derivation of all required quantities. The implementation will proceed by applying these formulae to the given test cases.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the stochastic tumor escape problem for a suite of test cases.\n    \"\"\"\n\n    def calculate_results_for_case(N, k, lambda_A, lambda_B):\n        \"\"\"\n        Calculates the five required outputs based on the derived formulas.\n\n        Args:\n            N (int): Initial number of tumor cells.\n            k (float): Hazard rate for CAR-mediated killing.\n            lambda_A (float): Hazard rate for antigen A loss.\n            lambda_B (float): Hazard rate for antigen B loss.\n\n        Returns:\n            list: A list containing the five calculated metrics, rounded to 6 decimal places.\n        \"\"\"\n        # Calculate the total rate r.\n        # Based on problem constraints (rates >= 0), r can only be 0 if all rates are 0.\n        # Test cases do not include r=0, so no division by zero will occur.\n        r = k + lambda_A + lambda_B\n\n        # Handle the trivial case where no escape is possible.\n        if lambda_A == 0 and lambda_B == 0:\n            return [0.0, 0.0, 0.0, 0.0, 0.0]\n\n        # Calculate single-cell outcome probabilities.\n        p_K = k / r\n        p_A = lambda_A / r\n        p_B = lambda_B / r\n\n        # To avoid repeated calculations, compute necessary powers.\n        # Use float(N) for compatibility with numpy's power function.\n        Nf = float(N)\n        p_K_pow_N = np.power(p_K, Nf)\n        p_KA_pow_N = np.power(p_K + p_A, Nf)\n        p_KB_pow_N = np.power(p_K + p_B, Nf)\n\n        # 1. Escape probability, P(Escape)\n        # P(Escape) = 1 - P(No Escape) = 1 - p_K^N\n        prob_escape = 1.0 - p_K_pow_N\n\n        # 2. Expected time to escape, conditioned on escape\n        # E[T_escape | Escape] = E[T_depletion] = H_N / r\n        # H_N is calculated only if needed.\n        if N == 0:\n            H_N = 0.0\n        else:\n            H_N = np.sum(1.0 / np.arange(1, N + 1))\n        expected_time_escape = H_N / r\n        \n        # 3. Probability of A-only escape, P(A-only)\n        # P(A-only) = P(N_B=0) - P(N_A=0, N_B=0) = (p_K + p_A)^N - p_K^N\n        prob_A_only = p_KA_pow_N - p_K_pow_N\n\n        # 4. Probability of B-only escape, P(B-only)\n        # P(B-only) = P(N_A=0) - P(N_A=0, N_B=0) = (p_K + p_B)^N - p_K^N\n        prob_B_only = p_KB_pow_N - p_K_pow_N\n\n        # 5. Probability of mixed escape (both A and B loss), P(A,B-both)\n        # P(A,B-both) = P(Escape) - P(A-only) - P(B-only)\n        # This simplifies to 1 - (p_K+p_A)^N - (p_K+p_B)^N + p_K^N\n        prob_mixed = prob_escape - prob_A_only - prob_B_only\n\n        return [\n            round(prob_escape, 6),\n            round(expected_time_escape, 6),\n            round(prob_A_only, 6),\n            round(prob_B_only, 6),\n            round(prob_mixed, 6)\n        ]\n\n    # Test suite from the problem statement.\n    test_cases = [\n        (100, 0.5, 0.05, 0.05),\n        (100, 0.5, 0.2, 0.01),\n        (100, 0.5, 0.01, 0.2),\n        (50, 0.5, 0.0, 0.0),\n        (20, 0.0, 0.05, 0.08),\n        (1, 0.3, 0.2, 0.05)\n    ]\n\n    results = []\n    for case in test_cases:\n        N, k, lambda_A, lambda_B = case\n        result = calculate_results_for_case(N, k, lambda_A, lambda_B)\n        results.append(result)\n\n    # Format the final output string exactly as specified.\n    # e.g., [[val1, val2, ...], [val1, val2, ...]]\n    # map(str, results) converts each sublist to its string representation.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"}]}