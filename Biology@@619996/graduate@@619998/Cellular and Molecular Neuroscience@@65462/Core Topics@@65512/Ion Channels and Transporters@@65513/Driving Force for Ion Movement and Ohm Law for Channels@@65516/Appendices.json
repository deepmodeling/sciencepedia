{"hands_on_practices": [{"introduction": "Understanding ion movement begins with a simple yet powerful relationship analogous to Ohm's law in electrical circuits. This practice challenges you to derive the equation $I = g(V_m - E_{\\text{rev}})$ from the fundamental concept of electrochemical potential, solidifying the link between thermodynamics and electrophysiology. By calculating current for different membrane potentials, you will develop an intuitive feel for the concept of 'driving force' and how it dictates the direction of ion flow through open channels [@problem_id:2709152].", "problem": "A single population of identical ion channels embedded in a membrane exhibits strictly linear current–voltage behavior over the voltage range of interest. The intra- and extracellular ion concentrations are held constant, and the measured reversal potential is $E_{\\text{rev}} = -80\\,\\text{mV}$, defined as the transmembrane potential at which the net current through the channels is zero. The macroscopic conductance of the open channels under these conditions is $g = 10\\,\\text{nS}$ (nanoSiemens). The membrane potential is voltage-clamped to either $V_{m} = -60\\,\\text{mV}$ or $V_{m} = -100\\,\\text{mV}$. Adopt the sign convention that positive current corresponds to the outward movement of positive charge.\n\nStarting from the definition of electrochemical equilibrium for an ion species, in which the electrochemical potentials on the two sides of the membrane are equal at zero net flux, and invoking linear response near equilibrium (in which the flux is proportional to its thermodynamic driving force), derive an expression for the macroscopic current $I$ through this ohmic channel as a function of $V_{m}$, $E_{\\text{rev}}$, and $g$ under the stated sign convention. Then evaluate $I$ at $V_{m} = -60\\,\\text{mV}$ and $V_{m} = -100\\,\\text{mV}$.\n\nIn your reasoning, state the direction of ionic movement at each membrane potential in terms of outward versus inward movement of positive charge. Express the two current values in picoamperes ($\\text{pA}$) and round each to three significant figures. For the purposes of the final numeric answer, report the two current values as a row vector $\\big[I(V_{m}=-60\\,\\text{mV}),\\ I(V_{m}=-100\\,\\text{mV})\\big]$ in $\\text{pA}$.", "solution": "The problem requires the derivation of the current-voltage relationship for an ohmic ion channel starting from fundamental thermodynamic principles, followed by the calculation of the current for two specified membrane potentials.\n\nThe derivation begins with the definition of the electrochemical potential, $\\tilde{\\mu}_S$, for an ion species $S$ with valence (charge number) $z$. The electrochemical potential represents the total Gibbs free energy per mole of the ion, and its gradient is the driving force for ion movement. For an ion $S$ at concentration $[S]$ and electrical potential $V$, the electrochemical potential is given by:\n$$ \\tilde{\\mu}_S = \\mu_S^0 + RT \\ln[S] + zFV $$\nwhere $\\mu_S^0$ is the standard chemical potential, $R$ is the ideal gas constant, $T$ is the absolute temperature, and $F$ is the Faraday constant.\n\nThe thermodynamic driving force for the movement of the ion across the membrane is the difference in the electrochemical potential between the inside ('in') and outside ('out') of the cell:\n$$ \\Delta\\tilde{\\mu}_S = \\tilde{\\mu}_{S,in} - \\tilde{\\mu}_{S,out} $$\nSubstituting the expression for $\\tilde{\\mu}_S$:\n$$ \\Delta\\tilde{\\mu}_S = (\\mu_{S,in}^0 + RT \\ln[S]_{in} + zFV_{in}) - (\\mu_{S,out}^0 + RT \\ln[S]_{out} + zFV_{out}) $$\nAssuming the standard chemical potential is the same on both sides ($\\mu_{S,in}^0 = \\mu_{S,out}^0$), this simplifies to:\n$$ \\Delta\\tilde{\\mu}_S = RT \\ln\\left(\\frac{[S]_{in}}{[S]_{out}}\\right) + zF(V_{in} - V_{out}) $$\nThe transmembrane potential is defined as $V_m = V_{in} - V_{out}$. Therefore, the driving force is:\n$$ \\Delta\\tilde{\\mu}_S = RT \\ln\\left(\\frac{[S]_{in}}{[S]_{out}}\\right) + zFV_m $$\nAt electrochemical equilibrium, there is no net flux of ions across the membrane. This condition corresponds to zero net driving force, $\\Delta\\tilde{\\mu}_S = 0$. The membrane potential at which this occurs is the reversal potential, $E_{rev}$ (for a channel permeable to a single ion species, this is the Nernst potential).\n$$ 0 = RT \\ln\\left(\\frac{[S]_{in}}{[S]_{out}}\\right) + zFE_{rev} $$\nFrom this, we can express the concentration-dependent term as:\n$$ RT \\ln\\left(\\frac{[S]_{in}}{[S]_{out}}\\right) = -zFE_{rev} $$\nSubstituting this back into the general expression for the driving force $\\Delta\\tilde{\\mu}_S$ allows us to express the driving force in terms of measurable electrical quantities:\n$$ \\Delta\\tilde{\\mu}_S = -zFE_{rev} + zFV_m = zF(V_m - E_{rev}) $$\nThis equation shows that the thermodynamic driving force for ion movement (in Joules per mole) is directly proportional to the electrical driving force, $(V_m - E_{rev})$, which is the difference between the membrane potential and the ion's equilibrium potential (in Volts).\n\nThe problem states that we should invoke linear response theory, which posits that for systems near equilibrium, the flux is proportional to the thermodynamic driving force. Let the net molar flux of ions be $J_S$ (in mol/s). Then:\n$$ J_S = \\mathcal{L} \\Delta\\tilde{\\mu}_S $$\nwhere $\\mathcal{L}$ is a phenomenological transport coefficient that depends on the properties of the channel and membrane. The macroscopic electrical current, $I$, is the net flow of charge per unit time. This is related to the molar flux by $I = zFJ_S$. Substituting the expressions for $J_S$ and $\\Delta\\tilde{\\mu}_S$:\n$$ I = zF(\\mathcal{L} \\Delta\\tilde{\\mu}_S) = zF(\\mathcal{L} [zF(V_m - E_{rev})]) = (zF)^2\\mathcal{L}(V_m - E_{rev}) $$\nThis result shows that the current $I$ is linearly proportional to the electrical driving force $(V_m - E_{rev})$. This is Ohm's law for an ion channel. The term $(zF)^2\\mathcal{L}$ represents the macroscopic conductance of the channel population, which we denote by $g$. Since $\\mathcal{L}$ must be positive (related to entropy production), the conductance $g$ is always positive. Thus, we arrive at the derived expression for the current:\n$$ I = g(V_m - E_{rev}) $$\nThis model is consistent with the problem's premise that the channel exhibits \"strictly linear current-voltage behavior.\"\n\nThe specified sign convention is that positive current corresponds to the outward movement of positive charge. Let us check our derived formula. If $V_m > E_{rev}$, the driving force $(V_m - E_{rev})$ is positive. Since $g > 0$, the current $I$ is positive. A membrane potential more positive than the reversal potential drives positive ions out or negative ions in, both of which constitute an outward current of positive charge. If $V_m < E_{rev}$, the driving force is negative, the current $I$ is negative, and this corresponds to an inward movement of positive charge. The derived formula is therefore consistent with the stated sign convention.\n\nNow, we evaluate the current $I$ for the given conditions:\n- Conductance $g = 10\\,\\text{nS} = 10 \\times 10^{-9}\\,\\text{S}$\n- Reversal potential $E_{rev} = -80\\,\\text{mV} = -80 \\times 10^{-3}\\,\\text{V}$\n\nCase 1: $V_m = -60\\,\\text{mV} = -60 \\times 10^{-3}\\,\\text{V}$\nThe current $I_1$ is:\n$$ I_1 = g(V_m - E_{rev}) = (10 \\times 10^{-9}\\,\\text{S}) \\times ((-60 \\times 10^{-3}\\,\\text{V}) - (-80 \\times 10^{-3}\\,\\text{V})) $$\n$$ I_1 = (10 \\times 10^{-9}\\,\\text{S}) \\times (20 \\times 10^{-3}\\,\\text{V}) = 200 \\times 10^{-12}\\,\\text{A} = 200\\,\\text{pA} $$\nSince $I_1$ is positive, the current represents an outward movement of positive charge. This is because the membrane potential ($V_m = -60\\,\\text{mV}$) is more positive than the reversal potential ($E_{rev} = -80\\,\\text{mV}$), creating an outward electrical driving force. Rounded to three significant figures, the value is $200\\,\\text{pA}$.\n\nCase 2: $V_m = -100\\,\\text{mV} = -100 \\times 10^{-3}\\,\\text{V}$\nThe current $I_2$ is:\n$$ I_2 = g(V_m - E_{rev}) = (10 \\times 10^{-9}\\,\\text{S}) \\times ((-100 \\times 10^{-3}\\,\\text{V}) - (-80 \\times 10^{-3}\\,\\text{V})) $$\n$$ I_2 = (10 \\times 10^{-9}\\,\\text{S}) \\times (-20 \\times 10^{-3}\\,\\text{V}) = -200 \\times 10^{-12}\\,\\text{A} = -200\\,\\text{pA} $$\nSince $I_2$ is negative, the current represents an inward movement of positive charge. This is because the membrane potential ($V_m = -100\\,\\text{mV}$) is more negative than the reversal potential ($E_{rev} = -80\\,\\text{mV}$), creating an inward electrical driving force for positive ions (or outward for negative ions). Rounded to three significant figures, the value is $-200\\,\\text{pA}$.\n\nThe two requested current values are $200\\,\\text{pA}$ and $-200\\,\\text{pA}$.", "answer": "$$\\boxed{\\begin{pmatrix} 200 & -200 \\end{pmatrix}}$$", "id": "2709152"}, {"introduction": "The sign of a measured current provides vital information, but its physical interpretation depends on the charge of the permeating ion. This practice builds upon the ohmic model by presenting two distinct scenarios: one involving a cation-selective channel and another an anion-selective channel. Working through these cases will sharpen your ability to translate the sign of a current—positive for outward, negative for inward—into the physical direction of ion flux for both positively and negatively charged ions [@problem_id:2709178].", "problem": "A neuron is voltage-clamped so that the intracellular potential relative to the extracellular bath is controlled at a membrane potential $V_{m}$, where by convention $V_{m} = V_{\\text{in}} - V_{\\text{out}}$. Positive current is defined as net outward movement of positive charge (the standard electrophysiological sign convention). The reversal potential $E_{\\text{rev}}$ of a channel is the membrane potential at which there is no net current through that channel. Over the voltage range considered, each open-channel population behaves as a linear, ohmic element with constant slope conductance $g$.\n\nTwo separate cell recordings are performed, each with a distinct, single-species–selective channel population fully activated at steady state:\n\n- Case C (cation-selective, sodium/potassium–permeable): $E_{\\text{rev}} = 0$ mV and $g = 2.5$ nS. Clamp $V_{m}$ to three values: $-60$ mV, $0$ mV, and $+30$ mV.\n\n- Case A (anion-selective, chloride–permeable): $E_{\\text{rev}} = -65$ mV and $g = 3.0$ nS. Clamp $V_{m}$ to three values: $-80$ mV, $-65$ mV, and $-40$ mV.\n\nStarting only from the definitions above and the linearity of the current–voltage relationship, determine for each case and voltage:\n1) the steady-state macroscopic current magnitude and sign, expressed in picoamperes (pA), and\n2) the physical direction of ion movement (into or out of the cell).\n\nExplain how the sign of the measured current relates to the direction of ion flux for cation versus anion channels under the stated sign convention.\n\nRound all numerical current values to three significant figures. For your boxed final answer, report only the six numerical current values (in pA, with sign) in the order $\\big[I_{\\text{C}}(-60\\ \\text{mV}),\\ I_{\\text{C}}(0\\ \\text{mV}),\\ I_{\\text{C}}(+30\\ \\text{mV}),\\ I_{\\text{A}}(-80\\ \\text{mV}),\\ I_{\\text{A}}(-65\\ \\text{mV}),\\ I_{\\text{A}}(-40\\ \\text{mV})\\big]$.", "solution": "The core principle governing ion movement through a population of open channels behaving as an ohmic element is a form of Ohm's Law:\n$$\nI = g(V_m - E_{\\text{rev}})\n$$\nwhere $I$ is the macroscopic current, $g$ is the total conductance of the channel population, $V_m$ is the membrane potential, and $E_{\\text{rev}}$ is the reversal potential for the permeant ion species. The term $(V_m - E_{\\text{rev}})$ represents the electrochemical driving force on the ions.\n\nThe problem specifies the sign convention: positive current ($I > 0$) corresponds to the net outward movement of positive charge from the intracellular to the extracellular medium. Consequently, negative current ($I < 0$) signifies a net inward movement of positive charge. The physical direction of ion movement depends on both the sign of the current and the charge of the ion (cation or anion). Note that for calculations, currents will be in picoamperes ($\\text{pA}$), conductances in nanosiemens ($\\text{nS}$), and potentials in millivolts ($\\text{mV}$). The conversion is direct: $1\\,\\text{pA} = 1\\,\\text{nS} \\times 1\\,\\text{mV}$.\n\n**Case C: Cation-selective channel**\n\nFor this case, the given parameters are a conductance $g_C = 2.5\\,\\text{nS}$ and a reversal potential $E_{\\text{rev}, C} = 0\\,\\text{mV}$. The permeating ions are cations, which are positively charged. Therefore, the direction of net ion movement is identical to the direction of the net flow of positive charge (the conventional current).\n\n1.  For $V_m = -60\\,\\text{mV}$:\n    The driving force is $(V_m - E_{\\text{rev}, C}) = (-60\\,\\text{mV} - 0\\,\\text{mV}) = -60\\,\\text{mV}$.\n    The current $I_C$ is:\n    $$\n    I_C = (2.5\\,\\text{nS}) \\times (-60\\,\\text{mV}) = -150\\,\\text{pA}\n    $$\n    The current is negative, indicating a net inward flow of positive charge. As the ions are cations, the physical direction of ion movement is **into the cell**.\n\n2.  For $V_m = 0\\,\\text{mV}$:\n    The driving force is $(V_m - E_{\\text{rev}, C}) = (0\\,\\text{mV} - 0\\,\\text{mV}) = 0\\,\\text{mV}$.\n    The current $I_C$ is:\n    $$\n    I_C = (2.5\\,\\text{nS}) \\times (0\\,\\text{mV}) = 0\\,\\text{pA}\n    $$\n    The current is zero, as the membrane potential is equal to the reversal potential. There is **no net movement** of ions.\n\n3.  For $V_m = +30\\,\\text{mV}$:\n    The driving force is $(V_m - E_{\\text{rev}, C}) = (+30\\,\\text{mV} - 0\\,\\text{mV}) = +30\\,\\text{mV}$.\n    The current $I_C$ is:\n    $$\n    I_C = (2.5\\,\\text{nS}) \\times (+30\\,\\text{mV}) = +75\\,\\text{pA}\n    $$\n    Rounding to three significant figures gives $75.0\\,\\text{pA}$. The current is positive, indicating a net outward flow of positive charge. The cations move **out of the cell**.\n\n**Case A: Anion-selective channel**\n\nFor this case, the given parameters are $g_A = 3.0\\,\\text{nS}$ and $E_{\\text{rev}, A} = -65\\,\\text{mV}$. The permeating ions are anions, which are negatively charged. Therefore, the physical direction of ion movement is opposite to the direction of the conventional current (net flow of positive charge).\n\n1.  For $V_m = -80\\,\\text{mV}$:\n    The driving force is $(V_m - E_{\\text{rev}, A}) = (-80\\,\\text{mV} - (-65\\,\\text{mV})) = -15\\,\\text{mV}$.\n    The current $I_A$ is:\n    $$\n    I_A = (3.0\\,\\text{nS}) \\times (-15\\,\\text{mV}) = -45\\,\\text{pA}\n    $$\n    Rounding to three significant figures gives $-45.0\\,\\text{pA}$. The current is negative, representing an inward flow of positive charge. To achieve this with negatively charged anions, the anions must move in the opposite direction. Thus, the physical direction of ion movement is **out of the cell**.\n\n2.  For $V_m = -65\\,\\text{mV}$:\n    The driving force is $(V_m - E_{\\text{rev}, A}) = (-65\\,\\text{mV} - (-65\\,\\text{mV})) = 0\\,\\text{mV}$.\n    The current $I_A$ is:\n    $$\n    I_A = (3.0\\,\\text{nS}) \\times (0\\,\\text{mV}) = 0\\,\\text{pA}\n    $$\n    The current is zero. There is **no net movement** of ions.\n\n3.  For $V_m = -40\\,\\text{mV}$:\n    The driving force is $(V_m - E_{\\text{rev}, A}) = (-40\\,\\text{mV} - (-65\\,\\text{mV})) = +25\\,\\text{mV}$.\n    The current $I_A$ is:\n    $$\n    I_A = (3.0\\,\\text{nS}) \\times (+25\\,\\text{mV}) = +75\\,\\text{pA}\n    $$\n    Rounding to three significant figures gives $75.0\\,\\text{pA}$. The current is positive, representing an outward flow of positive charge. To achieve this, negatively charged anions must move in the opposite direction. Thus, the physical direction of ion movement is **into the cell**.\n\n**Explanation of Current Sign vs. Ion Flux**\n\nThe relationship between the sign of the measured current and the physical direction of ion flux depends critically on the charge of the permeating ion. The convention defines current based on the movement of *positive* charge.\n\n-   **For Cation Channels:** Cations are positively charged ions (e.g., $\\text{Na}^+$, $\\text{K}^+$, $\\text{Ca}^{2+}$). The movement of cations is in the same direction as the flow of positive charge.\n    -   A **positive current** ($I > 0$, outward flow of positive charge) signifies that cations are moving **out of the cell**.\n    -   A **negative current** ($I < 0$, inward flow of positive charge) signifies that cations are moving **into the cell**.\n\n-   **For Anion Channels:** Anions are negatively charged ions (e.g., $\\text{Cl}^-$). The movement of anions results in a conventional current in the direction opposite to their flow.\n    -   A **positive current** ($I > 0$, outward flow of positive charge) is equivalent to an inward flow of negative charge. This signifies that anions are moving **into the cell**.\n    -   A **negative current** ($I < 0$, inward flow of positive charge) is equivalent to an outward flow of negative charge. This signifies that anions are moving **out of the cell**.\n\nIn summary, the sign of the current directly indicates the flux direction for cations but indicates the opposite flux direction for anions.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-150 & 0 & 75.0 & -45.0 & 0 & 75.0\n\\end{pmatrix}\n}\n$$", "id": "2709178"}, {"introduction": "The previous exercises involved calculating currents from known parameters; in real research, we often work in reverse. This capstone practice simulates the analysis of experimental data, challenging you to infer microscopic channel properties from macroscopic recordings. By implementing a computational analysis, you will connect the ohmic behavior of a single channel to the aggregate current of a large population and extract key parameters like single-channel conductance ($\\gamma$) and voltage-dependent open probability ($P_o(V)$) [@problem_id:2709126].", "problem": "You are asked to design and implement an algorithmic analysis, based solely on first principles of channel biophysics and dimensional analysis, to infer the single-channel conductance and the voltage-dependent open probability from jointly provided macroscopic and single-channel current data. Your implementation must accept a fixed, embedded “test suite” of cases and must output the requested results for each case in a single line, as specified below.\n\nStart from the following base principles and definitions that are widely accepted in cellular and molecular neuroscience:\n- The electrochemical driving force is the difference between the membrane potential and the reversal potential, written as $\\Delta V = V - E_{\\mathrm{rev}}$.\n- For an ohmic single channel, the open-state charge flow is proportional to the driving force, with proportionality given by the conductance. Physical consistency requires dimensional analysis with the unit identity $1\\,\\text{nS} \\cdot 1\\,\\text{mV} = 1\\,\\text{pA}$ and hence $1\\,\\text{pS} \\cdot 1\\,\\text{mV} = 10^{-3}\\,\\text{pA}$.\n- The macroscopic current is the aggregate of many channels and equals the expected number of open channels times the open-state single-channel current.\n\nYour task:\n- Using only the above bases, infer the single-channel conductance $\\gamma$ (in $\\mathrm{pS}$) and the reversal potential $E_{\\mathrm{rev}}$ (in $\\mathrm{mV}$) from single-channel open-level amplitudes measured at multiple voltages and their reported uncertainties.\n- Then, use the inferred single-channel current–voltage relation together with macroscopic current data and known channel count to infer the open probability $P_o(V)$ at each provided voltage.\n- Because measurement noise is present in the single-channel amplitudes, use a weighted linear modeling approach consistent with the ohmic assumption to estimate the parameters. Weights must be the inverse of the variance of the amplitude measurements at each voltage.\n- Ensure unit consistency throughout. Voltages are given in millivolts (mV), currents in picoamperes (pA), and conductance in picosiemens (pS). Express all final conductances in $\\mathrm{pS}$ and all potentials in $\\mathrm{mV}$. For open probabilities, enforce the physical bounds by mapping any negative value to $0$ and any value greater than $1$ to $1$. If the inferred single-channel current magnitude at a voltage is numerically indistinguishable from zero (use a threshold of $10^{-6}\\,\\mathrm{pA}$ to decide), then return $\\mathrm{nan}$ for $P_o$ at that voltage.\n- Angles are not relevant in this task. No percentages are used; probabilities must be reported as decimals between $0$ and $1$ inclusive.\n\nTest suite:\nFor each case, you are given arrays of voltages $V$ (in $\\mathrm{mV}$), measured single-channel open-level amplitudes $i_{\\mathrm{sc}}$ (in $\\mathrm{pA}$), their standard deviations $\\sigma_{i}$ (in $\\mathrm{pA}$), the macroscopic currents $I_{\\mathrm{macro}}$ (in $\\mathrm{pA}$), and the number of available channels $N$ (dimensionless). Use the data exactly as listed.\n\nCase A:\n- $V_{\\mathrm{mV}} = [$ $-80$, $-60$, $-40$, $-20$, $0$, $20$, $40$ $]$\n- $i_{\\mathrm{sc, pA}} = [$ $-0.842$, $-0.598$, $-0.355$, $-0.118$, $0.121$, $0.365$, $0.603$ $]$\n- $\\sigma_{i,\\mathrm{pA}} = [$ $0.012$, $0.010$, $0.009$, $0.010$, $0.010$, $0.011$, $0.012$ $]$\n- $I_{\\mathrm{macro, pA}} = [$ $-4.50$, $-22.8$, $-77.4$, $-69.8$, $91.6$, $285.9$, $479.8$ $]$\n- $N = $ $800$\n\nCase B:\n- $V_{\\mathrm{mV}} = [$ $-25$, $-10$, $-5$, $5$, $15$, $25$ $]$\n- $i_{\\mathrm{sc, pA}} = [$ $-0.498$, $-0.203$, $-0.104$, $0.102$, $0.298$, $0.502$ $]$\n- $\\sigma_{i,\\mathrm{pA}} = [$ $0.015$, $0.012$, $0.010$, $0.010$, $0.012$, $0.015$ $]$\n- $I_{\\mathrm{macro, pA}} = [$ $-1.35$, $-3.28$, $-2.50$, $4.04$, $14.18$, $24.65$ $]$\n- $N = $ $50$\n\nCase C:\n- $V_{\\mathrm{mV}} = [$ $-90$, $-80$, $-70$, $-50$, $-40$, $-30$ $]$\n- $i_{\\mathrm{sc, pA}} = [$ $-0.242$, $-0.158$, $-0.079$, $0.081$, $0.158$, $0.241$ $]$\n- $\\sigma_{i,\\mathrm{pA}} = [$ $0.012$, $0.011$, $0.010$, $0.010$, $0.011$, $0.012$ $]$\n- $I_{\\mathrm{macro, pA}} = [$ $-45.8$, $-28.2$, $-11.7$, $4.30$, $3.82$, $2.28$ $]$\n- $N = $ $200$\n\nOutput specification:\n- For each case, compute and return a list of the form $[$ $\\gamma_{\\mathrm{pS}}$, $E_{\\mathrm{rev,mV}}$, $[P_o(V_1), P_o(V_2), \\ldots]$ $]$, where all floating-point numbers are rounded to $6$ decimal places.\n- Your program should produce a single line of output containing the results for all three cases as a comma-separated list enclosed in square brackets, i.e., $[ \\text{caseA\\_result}, \\text{caseB\\_result}, \\text{caseC\\_result} ]$ where each case result has the specified structure.", "solution": "The task is to perform a quantitative analysis of simulated electrophysiological data to infer key biophysical parameters. The analysis is divided into two primary stages. First, we determine the single-channel conductance, $\\gamma$, and the reversal potential, $E_{\\mathrm{rev}}$, from current-voltage ($i-V$) data for a single channel. Second, we use these parameters, in conjunction with macroscopic current data, to infer the voltage-dependent open probability, $P_o(V)$.\n\n**Part 1: Inference of Single-Channel Parameters ($\\gamma$ and $E_{\\mathrm{rev}}$)**\n\nThe problem statement establishes that the single-channel current, $i_{\\mathrm{sc}}$, follows an ohmic model, where the current is proportional to the electrochemical driving force. This is expressed as:\n$$ i_{\\mathrm{sc}} = g \\cdot (V - E_{\\mathrm{rev}}) $$\nwhere $g$ represents the single-channel conductance, $V$ is the membrane potential, and $E_{\\mathrm{rev}}$ is the reversal potential. A crucial aspect of this problem is the consistent handling of physical units. We are given that potentials are in millivolts ($\\mathrm{mV}$), currents are in picoamperes ($\\mathrm{pA}$), and the desired conductance is in picosiemens ($\\mathrm{pS}$). The problem provides the unit identity $1\\,\\text{pS} \\cdot 1\\,\\text{mV} = 10^{-3}\\,\\text{pA}$. To correctly relate the numerical values, if we denote the numerical value of conductance in $\\mathrm{pS}$ as $\\gamma$, the model must be written as:\n$$ i_{\\mathrm{sc}} [\\mathrm{pA}] = (\\gamma [\\mathrm{pS}] \\cdot 10^{-3}) \\cdot (V [\\mathrm{mV}] - E_{\\mathrm{rev}} [\\mathrm{mV}]) $$\nThis equation is linear with respect to $V$ and can be expressed in the standard form $y = mx + c$, where $y$ corresponds to $i_{\\mathrm{sc}}$ and $x$ corresponds to $V$:\n$$ i_{\\mathrm{sc}} = mV + c $$\nBy comparing the two equation forms, we can relate the regression parameters, slope $m$ and intercept $c$, to the physical parameters:\n$$ m = \\gamma \\cdot 10^{-3} \\quad (\\text{units of } \\mathrm{pA}/\\mathrm{mV}, \\text{ or } \\mathrm{nS}) $$\n$$ c = -m \\cdot E_{\\mathrm{rev}} \\quad (\\text{units of } \\mathrm{pA}) $$\nSolving for $\\gamma$ and $E_{\\mathrm{rev}}$ yields:\n$$ \\gamma = 1000 \\cdot m \\quad (\\text{units of } \\mathrm{pS}) $$\n$$ E_{\\mathrm{rev}} = -\\frac{c}{m} \\quad (\\text{units of } \\mathrm{mV}) $$\nTo estimate $m$ and $c$ from the provided data points $(V_k, i_k)$ with current measurement uncertainties $\\sigma_k$, we must employ a weighted linear least squares regression. This statistical method minimizes the weighted sum of squared residuals, $\\chi^2$:\n$$ \\chi^2(m, c) = \\sum_{k=1}^{N_{data}} w_k (i_k - (mV_k + c))^2 $$\nThe weights, $w_k$, are defined as the inverse of the variance of each measurement, i.e., $w_k = 1/\\sigma_k^2$. The values of $m$ and $c$ that minimize $\\chi^2$ are found by solving the system of normal equations, which gives the following expressions:\n$$ m = \\frac{ S_w S_{wvi} - S_{wv} S_{wi} }{ S_w S_{wvv} - (S_{wv})^2 } $$\n$$ c = \\frac{ S_{wvv} S_{wi} - S_{wv} S_{wvi} }{ S_w S_{wvv} - (S_{wv})^2 } $$\nThe sums $S_x$ are defined over all data points $k$:\n- $S_w = \\sum_k w_k$\n- $S_{wv} = \\sum_k w_k V_k$\n- $S_{wi} = \\sum_k w_k i_k$\n- $S_{wvv} = \\sum_k w_k V_k^2$\n- $S_{wvi} = \\sum_k w_k V_k i_k$\n\nThe algorithm for the first part involves computing these five weighted sums from the single-channel data, calculating $m$ and $c$, and then converting these regression parameters into the physical quantities $\\gamma$ and $E_{\\mathrm{rev}}$.\n\n**Part 2: Inference of Open Probability ($P_o(V)$)**\n\nThe macroscopic current, $I_{\\mathrm{macro}}$, through a population of $N$ identical channels is given by the product of the number of channels, the probability of a channel being open, and the current through a single open channel:\n$$ I_{\\mathrm{macro}}(V) = N \\cdot P_o(V) \\cdot i_{\\mathrm{sc}}(V) $$\nThis equation can be algebraically rearranged to solve for the open probability $P_o(V)$:\n$$ P_o(V) = \\frac{I_{\\mathrm{macro}}(V)}{N \\cdot i_{\\mathrm{sc}}(V)} $$\nIn this calculation, it is essential to use the idealized single-channel current, $i_{\\mathrm{sc, fit}}(V)$, derived from the linear model fitted in Part 1, rather than the noisy experimental measurements of $i_{\\mathrm{sc}}$. This ensures that the denominator is based on a consistent biophysical model. The fitted single-channel current at a voltage $V_k$ is:\n$$ i_{\\mathrm{sc, fit}}(V_k) = m V_k + c $$\nTherefore, the open probability at each voltage $V_k$ is calculated as:\n$$ P_o(V_k) = \\frac{I_{\\mathrm{macro}}(V_k)}{N \\cdot (m V_k + c)} $$\nTwo specific constraints must be applied. First, to prevent division by a near-zero number around the reversal potential, if $|i_{\\mathrm{sc, fit}}(V_k)| < 10^{-6}\\,\\mathrm{pA}$, the value of $P_o(V_k)$ must be set to not-a-number ($\\mathrm{nan}$). Second, since $P_o$ is a probability, its value must be physically constrained to the interval $[0, 1]$. Any computed value outside this range must be clipped; values less than $0$ are set to $0$, and values greater than $1$ are set to $1$.\n\nThe complete algorithm for each test case is as follows:\n1.  From the input arrays $V$, $i_{\\mathrm{sc}}$, and $\\sigma_{i}$, compute the weights $w_k=1/\\sigma_k^2$ and the five summary statistics $S_w, S_{wv}, S_{wi}, S_{wvv}, S_{wvi}$.\n2.  Calculate the best-fit slope $m$ and intercept $c$ of the single-channel $i-V$ relationship.\n3.  Compute the single-channel conductance $\\gamma = 1000 \\cdot m$ and reversal potential $E_{\\mathrm{rev}} = -c/m$.\n4.  For each voltage $V_k$ in the dataset, calculate the corresponding fitted single-channel current $i_{\\mathrm{sc, fit}}(V_k)$.\n5.  Using $I_{\\mathrm{macro}}(V_k)$, $N$, and $i_{\\mathrm{sc, fit}}(V_k)$, compute the open probability $P_o(V_k)$, applying the specified thresholding and clipping rules.\n6.  Assemble the final results—$\\gamma$, $E_{\\mathrm{rev}}$, and the list of $P_o(V_k)$ values—and format them according to the output specification.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the entire problem by processing a test suite of biophysical data.\n    The final output is printed in the specified single-line format.\n    \"\"\"\n\n    test_suite = {\n        \"Case A\": {\n            \"V_mV\": [-80, -60, -40, -20, 0, 20, 40],\n            \"i_sc_pA\": [-0.842, -0.598, -0.355, -0.118, 0.121, 0.365, 0.603],\n            \"sigma_i_pA\": [0.012, 0.010, 0.009, 0.010, 0.010, 0.011, 0.012],\n            \"I_macro_pA\": [-4.50, -22.8, -77.4, -69.8, 91.6, 285.9, 479.8],\n            \"N\": 800\n        },\n        \"Case B\": {\n            \"V_mV\": [-25, -10, -5, 5, 15, 25],\n            \"i_sc_pA\": [-0.498, -0.203, -0.104, 0.102, 0.298, 0.502],\n            \"sigma_i_pA\": [0.015, 0.012, 0.010, 0.010, 0.012, 0.015],\n            \"I_macro_pA\": [-1.35, -3.28, -2.50, 4.04, 14.18, 24.65],\n            \"N\": 50\n        },\n        \"Case C\": {\n            \"V_mV\": [-90, -80, -70, -50, -40, -30],\n            \"i_sc_pA\": [-0.242, -0.158, -0.079, 0.081, 0.158, 0.241],\n            \"sigma_i_pA\": [0.012, 0.011, 0.010, 0.010, 0.011, 0.012],\n            \"I_macro_pA\": [-45.8, -28.2, -11.7, 4.30, 3.82, 2.28],\n            \"N\": 200\n        }\n    }\n\n    all_results = []\n    case_order = [\"Case A\", \"Case B\", \"Case C\"]\n\n    for case_name in case_order:\n        data = test_suite[case_name]\n        result = analyze_channel_data(\n            V_mV=data[\"V_mV\"],\n            i_sc_pA=data[\"i_sc_pA\"],\n            sigma_i_pA=data[\"sigma_i_pA\"],\n            I_macro_pA=data[\"I_macro_pA\"],\n            N=data[\"N\"]\n        )\n        all_results.append(result)\n\n    print_formatted_results(all_results)\n    \ndef analyze_channel_data(V_mV, i_sc_pA, sigma_i_pA, I_macro_pA, N):\n    \"\"\"\n    Analyzes a single case of ion channel data to infer biophysical parameters.\n\n    Args:\n        V_mV (list): Voltages in mV.\n        i_sc_pA (list): Single-channel currents in pA.\n        sigma_i_pA (list): Standard deviations of single-channel currents in pA.\n        I_macro_pA (list): Macroscopic currents in pA.\n        N (int): Number of channels.\n\n    Returns:\n        tuple: A tuple containing gamma (pS), E_rev (mV), and a list of Po values.\n    \"\"\"\n    V = np.array(V_mV, dtype=np.float64)\n    i = np.array(i_sc_pA, dtype=np.float64)\n    sigma = np.array(sigma_i_pA, dtype=np.float64)\n    I_macro = np.array(I_macro_pA, dtype=np.float64)\n\n    # Part 1: Infer gamma and E_rev via weighted linear regression\n    # Weights are inverse variance\n    w = 1.0 / (sigma**2)\n\n    # Calculate weighted sums\n    S_w = np.sum(w)\n    S_wv = np.sum(w * V)\n    S_wi = np.sum(w * i)\n    S_wvv = np.sum(w * V**2)\n    S_wvi = np.sum(w * V * i)\n    \n    # Calculate slope (m) and intercept (c) of the i-V relationship\n    denominator = S_w * S_wvv - S_wv**2\n    m = (S_w * S_wvi - S_wv * S_wi) / denominator\n    c = (S_wvv * S_wi - S_wv * S_wvi) / denominator\n\n    # Convert regression parameters to physical parameters\n    # gamma_pS = m * 1000, since m is in nS (pA/mV)\n    gamma_pS = m * 1000.0\n    # E_rev = -c/m, which is the x-intercept\n    E_rev_mV = -c / m\n    \n    # Part 2: Infer open probability P_o(V)\n    Po_list = []\n    i_sc_fit_pA = m * V + c\n    \n    for k in range(len(V)):\n        i_fit = i_sc_fit_pA[k]\n        I_macro_k = I_macro[k]\n        \n        # Handle case where single-channel current is numerically zero\n        if abs(i_fit) < 1e-6:\n            Po = np.nan\n        else:\n            # Calculate raw open probability\n            Po_raw = I_macro_k / (N * i_fit)\n            # Clip Po to physical bounds [0, 1]\n            Po = np.clip(Po_raw, 0.0, 1.0)\n            \n        Po_list.append(Po)\n        \n    return gamma_pS, E_rev_mV, Po_list\n\ndef print_formatted_results(all_results):\n    \"\"\"\n    Formats the analysis results for all cases into the specified single-line string.\n    \"\"\"\n    formatted_cases = []\n    for gamma, E_rev, Po_list in all_results:\n        # Format Po list, handling nan values\n        Po_str_list = []\n        for p in Po_list:\n            if np.isnan(p):\n                Po_str_list.append('nan')\n            else:\n                Po_str_list.append(f\"{p:.6f}\")\n        \n        # Assemble the formatted strings for a single case\n        gamma_str = f\"{gamma:.6f}\"\n        E_rev_str = f\"{E_rev:.6f}\"\n        Po_list_str = f\"[{','.join(Po_str_list)}]\"\n        \n        case_str = f\"[{gamma_str},{E_rev_str},{Po_list_str}]\"\n        formatted_cases.append(case_str)\n        \n    # Join all cases into the final output format\n    final_output = f\"[{','.join(formatted_cases)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "2709126"}]}