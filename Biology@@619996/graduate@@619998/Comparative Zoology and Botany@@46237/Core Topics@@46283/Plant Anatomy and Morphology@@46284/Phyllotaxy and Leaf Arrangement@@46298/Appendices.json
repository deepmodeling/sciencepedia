{"hands_on_practices": [{"introduction": "The generative spiral is the cornerstone of classical phyllotactic theory, describing how a sequence of simple, local rules can generate complex global patterns. This first practice invites you to translate this theory into a predictive computational model [@problem_id:2597254]. By implementing the foundational equations for primordium placement, you will explore how the divergence angle $\\alpha$ and plastochron ratio $\\rho$ directly determine the geometry of the resulting spiral lattice and, consequently, the observable parastichy numbers.", "problem": "You are given a phyllotactic model in which successive primordia are initiated with a constant divergence angle and a constant plastochron ratio. The primordia are modeled as points in the plane in polar coordinates, where the $n$-th primordium has angle $\\theta_n$ and radius $r_n$. The divergence angle is a constant $\\alpha$ specified in degrees, and the plastochron ratio is a constant $\\rho > 1$ (dimensionless) such that each successive radius scales by $\\rho$. Use the following foundational definitions and empirically supported facts:\n\n- The $n$-th primordium is placed at polar coordinates $(r_n, \\theta_n)$ with\n  $$r_n = r_0 \\,\\rho^n \\quad \\text{and} \\quad \\theta_n = n\\,\\alpha,$$\n  where $r_0 > 0$ is an arbitrary reference radius. You must take $r_0 = 1$ for all computations because only relative distances matter in the criterion below.\n- Angles used for any trigonometric computation must be in radians. The divergence angle $\\alpha$ is provided in degrees and must be converted to radians internally as $\\alpha_{\\mathrm{rad}} = \\alpha \\cdot \\pi/180$.\n- For any two primordia separated by an index offset $k \\in \\mathbb{Z}_{>0}$, define the principal angular difference $\\Delta\\theta_k \\in [0,\\pi]$ via wrapping to the interval $[-\\pi,\\pi]$:\n  $$\\Delta\\theta_k = \\min\\left(\\left| \\left(k\\,\\alpha_{\\mathrm{rad}} + \\pi \\right) \\bmod 2\\pi - \\pi \\right|, \\, \\pi \\right).$$\n- In Euclidean geometry in the plane, the squared distance between two points $(r_1,\\theta_1)$ and $(r_2,\\theta_2)$ is\n  $$d^2 = r_1^2 + r_2^2 - 2 r_1 r_2 \\cos(\\theta_2 - \\theta_1).$$\n\nFrom these fundamentals, it follows that the Euclidean distance between primordia $n$ and $n+k$ can be written in the normalized, dimensionless form (independent of $n$)\n$$\\delta_k = \\sqrt{1 + \\rho^{2k} - 2 \\rho^k \\cos(\\Delta\\theta_k)},$$\nwhich is the distance scaled by $r_n$ due to the logarithmic scaling of radii by $\\rho$.\n\nDefine the dominant parastichy pair as the pair of coprime positive integers $(k_1,k_2)$, with $1 \\le k_1  k_2 \\le K_{\\max}$, that minimize the product $\\delta_{k_1}\\,\\delta_{k_2}$. This is a distance-based criterion that favors two shortest, independent spiral families in the local lattice of neighbor relations. Resolve ties by the following rules in order:\n1. Prefer the pair with smaller $\\max(k_1,k_2)$.\n2. If still tied, prefer the pair with smaller $k_2$.\n3. If still tied, prefer the pair with smaller $k_1$.\n\nYou must simulate the first $N$ primordia implicitly via the model above, but the computation of the dominant parastichy pair must use the normalized distance criterion. Let\n$$K_{\\max} = \\min(N-1, 60),$$\nso that all candidate separations do not exceed the number of available primordia and remain computationally bounded.\n\nAngle unit specification: All inputs for $\\alpha$ are given in degrees, and all internal trigonometric computations must be performed in radians. There are no physical units for lengths in this model; distances are dimensionless due to normalization by $r_n$.\n\nYour task is to write a complete, runnable program that, for each test case below, computes and returns the dominant parastichy pair $(k_1,k_2)$ using the specified distance criterion. The final output for all test cases must be aggregated into a single line as a comma-separated list of lists, enclosed in square brackets, for example: \"[[k1,k2],[k1,k2],...]\".\n\nTest Suite (each test case is a tuple $(\\alpha,\\rho,N)$):\n1. $(137.3, 1.08, 100)$\n2. $(137.5, 1.05, 100)$\n3. $(99.5, 1.08, 100)$\n4. $(170.0, 1.12, 100)$\n5. $(137.3, 1.005, 50)$\n6. $(137.3, 1.08, 8)$\n\nOutput specification:\n- For each test case, output the dominant parastichy pair as a list of two integers $[k_1,k_2]$.\n- Aggregate the results for all test cases into a single line printed as a list of lists, for example: \"[[a,b],[c,d],...]\" without any extra text.\n\nYour program must not read any input and must produce exactly one line of output in the specified format.", "solution": "The posed problem is subjected to validation and is found to be **valid**. It is scientifically grounded in established models of phyllotaxis, mathematically well-posed with a clear objective function and constraints, and free of ambiguity or contradiction. It represents a formal computational task derived from principles of developmental botany and geometry. I will therefore proceed with a complete solution.\n\nThe solution is designed as a deterministic algorithm that implements the specified criteria for identifying the dominant parastichy pair. The methodology is structured into three main phases: parameter initialization, pre-computation of normalized distances, and a systematic search for the optimal pair.\n\n**1. Parameter Initialization and Constants**\n\nFor each given test case, defined by the tuple $(\\alpha, \\rho, N)$, we begin by setting up the necessary parameters for calculation.\n- The divergence angle $\\alpha$, provided in degrees, must be converted to radians for use in trigonometric functions. The conversion is $\\alpha_{\\mathrm{rad}} = \\alpha \\cdot \\pi / 180$.\n- The maximum separation index, $K_{\\max}$, must be determined according to the problem specification. It is defined as $K_{\\max} = \\min(N-1, 60)$, where $N$ is the number of primordia. This caps the search space to a computationally manageable size. For all test cases, $N \\ge 8$, which guarantees $K_{\\max} \\ge 7$ and allows for the formation of pairs $(k_1, k_2)$ with $1 \\le k_1  k_2$.\n\n**2. Pre-computation of Normalized Distances $\\delta_k$**\n\nThe optimization criterion depends on the normalized distances $\\delta_k$. To avoid redundant calculations, we pre-compute and store these values for all relevant separation indices $k$, from $k=1$ to $k=K_{\\max}$. For each integer $k$ in this range, the value of $\\delta_k$ is calculated as follows:\n\n- First, the principal angular difference $\\Delta\\theta_k$ is computed. The total angle for a separation of $k$ primordia is $k\\,\\alpha_{\\mathrm{rad}}$. This angle is wrapped to the interval $[-\\pi, \\pi]$ to find the shortest angle between the vectors. The given formula is $\\left(k\\,\\alpha_{\\mathrm{rad}} + \\pi \\right) \\bmod 2\\pi - \\pi$, which correctly maps the angle to $[-\\pi, \\pi)$. Let this wrapped angle be $\\phi_k$. The principal angular difference is then the magnitude $\\Delta\\theta_k = |\\phi_k| \\in [0, \\pi]$.\n- Second, with $\\Delta\\theta_k$ known, we compute the normalized distance $\\delta_k$ using the provided formula, which is derived from the law of cosines in a logarithmically growing spiral:\n$$\n\\delta_k = \\sqrt{1 + \\rho^{2k} - 2 \\rho^k \\cos(\\Delta\\theta_k)}\n$$\nThese values are stored in an array for efficient lookup during the search phase.\n\n**3. Systematic Search for the Dominant Parastichy Pair**\n\nThe core of the problem is to find a specific pair of integers $(k_1, k_2)$ that satisfies a set of hierarchical criteria. The pair must consist of a coprime pair of integers, $k_1$ and $k_2$, such that $1 \\le k_1  k_2 \\le K_{\\max}$. The search for the optimal pair proceeds by systematically checking all valid candidate pairs.\n\n- We iterate through all possible values of $k_2$ from $2$ to $K_{\\max}$, and for each $k_2$, we iterate through all possible values of $k_1$ from $1$ to $k_2-1$.\n- For each pair $(k_1, k_2)$, we perform a coprimality test. This is achieved by computing the greatest common divisor (GCD) of $k_1$ and $k_2$. If $\\text{gcd}(k_1, k_2) = 1$, the pair is a valid candidate.\n- For each valid candidate pair, we evaluate its \"quality\" based on the specified criteria. The primary criterion is to minimize the product of the normalized distances, $P = \\delta_{k_1} \\delta_{k_2}$. The secondary and tertiary criteria are tie-breaking rules: if products are equal, prefer the pair with smaller $\\max(k_1, k_2)$ (which is equivalent to smaller $k_2$), and then smaller $k_1$.\n- This hierarchical optimization problem can be elegantly solved by finding the minimum of a tuple. For each candidate pair $(k_1, k_2)$, we form a tuple $(P, k_2, k_1)$. We maintain a \"best\" tuple found so far and update it whenever a new candidate pair yields a lexicographically smaller tuple. Lexicographical comparison of $(P, k_2, k_1)$ naturally enforces the primary minimization of $P$, followed by minimization of $k_2$, and finally minimization of $k_1$.\n\nThe algorithm begins with an initial \"best\" tuple set to $(\\infty, \\infty, \\infty)$. After checking all valid pairs, the pair $(k_1, k_2)$ corresponding to the final \"best\" tuple is the dominant parastichy pair. This procedure is performed for each test case, and the results are aggregated into the specified output format.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef compute_dominant_parastichy(alpha_deg, rho, N):\n    \"\"\"\n    Computes the dominant parastichy pair (k1, k2) for a given phyllotactic model.\n\n    Args:\n        alpha_deg (float): The divergence angle in degrees.\n        rho (float): The plastochron ratio.\n        N (int): The number of primordia.\n\n    Returns:\n        list: A list of two integers [k1, k2] representing the dominant pair.\n    \"\"\"\n    # 1. Parameter Initialization and Constants\n    alpha_rad = np.deg2rad(alpha_deg)\n    K_max = min(N - 1, 60)\n\n    # A pair (k1, k2) requires k2 >= 2, so K_max must be at least 2.\n    if K_max  2:\n        return None  # No valid pairs can be formed.\n\n    # 2. Pre-computation of Normalized Distances delta_k\n    # delta_k array is 1-indexed for convenience (index k maps to delta_k).\n    delta_k = np.zeros(K_max + 1)\n    for k in range(1, K_max + 1):\n        # Calculate the principal angular difference in [0, pi].\n        total_angle = k * alpha_rad\n        # Wrap angle to [-pi, pi) using the specified formula's logic.\n        # This is a standard and robust way to perform angle wrapping in programming.\n        wrapped_angle = (total_angle + np.pi) % (2 * np.pi) - np.pi\n        delta_theta_k = np.abs(wrapped_angle)\n\n        # Calculate the normalized distance delta_k.\n        cos_val = np.cos(delta_theta_k)\n        rho_k = np.power(rho, k)\n        rho_2k = np.power(rho, 2 * k) # or rho_k**2\n        delta_k[k] = np.sqrt(1 + rho_2k - 2 * rho_k * cos_val)\n\n    # 3. Systematic Search for the Dominant Parastichy Pair\n    best_tuple = (float('inf'), float('inf'), float('inf'))\n    best_pair = None\n\n    # Iterate through all candidate pairs (k1, k2) with 1 = k1  k2 = K_max.\n    for k2 in range(2, K_max + 1):\n        for k1 in range(1, k2):\n            # Check for coprimality.\n            if math.gcd(k1, k2) == 1:\n                # Calculate the product of normalized distances.\n                product = delta_k[k1] * delta_k[k2]\n                \n                # Form a tuple for lexicographical comparison.\n                # This elegantly handles the minimization criterion and tie-breaking rules:\n                # 1. Minimize product.\n                # 2. Minimize max(k1, k2) -> k2.\n                # 3. Minimize k1.\n                current_tuple = (product, k2, k1)\n                \n                if current_tuple  best_tuple:\n                    best_tuple = current_tuple\n                    best_pair = [k1, k2]\n    \n    return best_pair\n\ndef solve():\n    \"\"\"\n    Runs the defined test suite and prints the formatted results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (137.3, 1.08, 100),\n        (137.5, 1.05, 100),\n        (99.5, 1.08, 100),\n        (170.0, 1.12, 100),\n        (137.3, 1.005, 50),\n        (137.3, 1.08, 8),\n    ]\n\n    results = []\n    for case in test_cases:\n        alpha, rho, N = case\n        result = compute_dominant_parastichy(alpha, rho, N)\n        # The str() of a list is its representation, e.g., \"[5, 8]\".\n        results.append(str(result))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2597254"}, {"introduction": "While forward modeling predicts patterns from known parameters, a more common scientific challenge is the inverse problem: inferring the hidden developmental parameters from a static, observed specimen. This practice guides you through a sophisticated inverse problem where the goal is to deduce a plant's global divergence angle $\\theta$ and its radial growth history from a series of parastichy counts [@problem_id:2597382]. This exercise will hone your skills in computational optimization and dealing with the ambiguities inherent in reconstructing dynamic processes from static data.", "problem": "You must write a complete, runnable program that, given observed counts of left- and right-handed parastichies at multiple radii in a spiral phyllotactic pattern, infers a single global divergence angle and a monotone nondecreasing trajectory of plastochron ratios across the given radii, under a generative-spiral model. The required output is a single line that aggregates the numerical answers for all provided test cases.\n\nThe fundamental base is the generative spiral model of phyllotaxis. In this model, primordia are indexed by an integer $k \\in \\mathbb{Z}$ and have polar coordinates $(\\rho_k,\\varphi_k)$ given by\n$\\rho_k = \\rho_0 \\, a^k$ and $\\varphi_k = k \\, \\theta$,\nwhere $\\rho_0 > 0$ is a scale constant, $a > 0$ is the plastochron ratio, and $\\theta \\in (0,2\\pi)$ is the divergence angle. Two primordia separated by $q \\in \\mathbb{N}$ indices, namely $k$ and $k+q$, have a normalized Euclidean separation (chord) that depends only on $a$, $\\theta$, and $q$, obtained by dividing the Euclidean distance by $\\rho_k$:\n$$\n\\delta(q; a, \\theta) \\;=\\; \\sqrt{1 + a^{2q} - 2\\,a^q \\cos(q \\,\\theta)}.\n$$\nFor a given pair $(a,\\theta)$, the visible parastichy counts are modeled as the two values $m,n \\in \\{1,2,\\dots,Q_{\\max}\\}$ that minimize $\\delta(q; a,\\theta)$ over $q \\in \\{1,2,\\dots,Q_{\\max}\\}$, with ties broken arbitrarily but consistently, and where order does not matter between $m$ and $n$ (they are a set of two counts). In classical phyllotaxis, when $\\theta/(2\\pi)$ is irrational, these $m$ and $n$ typically correspond to two consecutive denominators of convergents in the continued fraction expansion of $\\theta/(2\\pi)$, often yielding consecutive Fibonacci numbers when $\\theta$ is close to the golden angle, but for this task you must only use the distance-based definition above.\n\nInverse problem statement and constraints:\n- You are given, for each test case $j$, a strictly increasing list of radii $\\{r_{j,i}\\}_{i=1}^{M_j}$ and associated observed unordered parastichy pairs $\\{ \\{L_{j,i},R_{j,i}\\} \\}_{i=1}^{M_j}$, where each $L_{j,i}, R_{j,i} \\in \\mathbb{N}$.\n- Assume a single global divergence angle $\\theta_j$ for the test case $j$, and a sequence of plastochron ratios $\\{a_{j,i}\\}_{i=1}^{M_j}$, one value per radius sample, such that $a_{j,1} \\le a_{j,2} \\le \\cdots \\le a_{j,M_j}$ (monotone nondecreasing with increasing radius index).\n- For each $i$, the unordered pair $\\{L_{j,i},R_{j,i}\\}$ must equal the unordered set of the two $q$ values that minimize $\\delta(q;a_{j,i},\\theta_j)$ over $q \\in \\{1,2,\\dots,Q_{\\max}\\}$.\n- You must restrict the search to $a_{j,i} \\in [a_{\\min}, a_{\\max}]$ with $a_{\\min} = 1.01$ and $a_{\\max} = 1.30$, and to $\\theta_j \\in [\\theta_{\\min}, \\theta_{\\max}]$ with $\\theta_{\\min} = 130^{\\circ}$ and $\\theta_{\\max} = 150^{\\circ}$.\n- Use $Q_{\\max} = 34$.\n\nUniqueness rule for selection among multiple feasible solutions: for each test case $j$, among all $\\theta_j \\in [\\theta_{\\min},\\theta_{\\max}]$ that admit at least one nondecreasing sequence $\\{a_{j,i}\\}_{i=1}^{M_j}$ within $[a_{\\min},a_{\\max}]^{M_j}$ satisfying the pair-matching constraints, select the $\\theta_j$ that maximizes the sum, over $i=1,\\dots,M_j$, of the measure (length) of the subset of $[a_{\\min},a_{\\max}]$ for which the $i$-th observed pair is satisfied. If multiple $\\theta_j$ values tie, select the smallest such $\\theta_j$. For the chosen $\\theta_j$, select the pointwise minimal (greedy, leftmost) nondecreasing sequence $\\{a_{j,i}\\}_{i=1}^{M_j}$ within the feasible subsets.\n\nAngle unit and rounding rule:\n- Report each $\\theta_j$ in degrees. Round each reported $\\theta_j$ to three decimals.\n- Report each $a_{j,i}$ as a unitless ratio. Round each reported $a_{j,i}$ to three decimals.\n\nTest suite:\n- Case $1$: Radii $\\{r_{1,i}\\} = [\\,1.0,\\,1.5,\\,2.0,\\,3.0\\,]$ with observed pairs $\\{ \\{L_{1,i},R_{1,i}\\} \\} = [\\,\\{8,13\\},\\,\\{5,8\\},\\,\\{3,5\\},\\,\\{2,3\\}\\,]$.\n- Case $2$: Radii $\\{r_{2,i}\\} = [\\,1.0,\\,2.0\\,]$ with observed pairs $\\{ \\{L_{2,i},R_{2,i}\\} \\} = [\\,\\{5,8\\},\\,\\{3,5\\}\\,]$.\n- Case $3$: Radii $\\{r_{3,i}\\} = [\\,1.0\\,]$ with observed pairs $\\{ \\{L_{3,1},R_{3,1}\\} \\} = [\\,\\{1,2\\}\\,]$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for all three cases, concatenated in order, as a comma-separated list enclosed in square brackets. For case $j$ with $M_j$ radii, output $M_j+1$ numbers: first the inferred $\\theta_j$ in degrees (rounded to three decimals), followed by the $M_j$ inferred plastochron ratios $a_{j,1},\\dots,a_{j,M_j}$ (each rounded to three decimals). Concatenate these sequences for $j=1,2,3$ and output them as one flat list. Example schematic format (with placeholders): \n\"[theta1_deg,a11,a12,...,theta2_deg,a21,a22,...,theta3_deg,a31,...]\".\nAll angles must be in degrees and all ratios must be rounded to three decimals. No other text should be printed.\n\nYour program must not read any input and must not perform any file or network input/output. It must compute the outputs solely from the definitions, constraints, and the provided test suite above.", "solution": "The user has submitted a problem in the field of mathematical botany, specifically concerning the inverse problem of phyllotaxis. The task is to infer model parameters from observational data.\n\n### Step 1: Extract Givens\n\n- **Generative Spiral Model**: Primordia indexed by $k \\in \\mathbb{Z}$ have polar coordinates $(\\rho_k, \\varphi_k)$ where $\\rho_k = \\rho_0 a^k$ and $\\varphi_k = k \\theta$. The parameters are the plastochron ratio $a > 0$ and the divergence angle $\\theta \\in (0, 2\\pi)$.\n- **Normalized Chord Distance**: The separation between primordia $k$ and $k+q$ is given by $\\delta(q; a, \\theta) = \\sqrt{1 + a^{2q} - 2a^q \\cos(q\\theta)}$.\n- **Parastichy Pair Definition**: For a given $(a, \\theta)$, the visible parastichy counts are the two integers $\\{m, n\\}$ from $\\{1, 2, \\dots, Q_{\\max}\\}$ that minimize $\\delta(q; a, \\theta)$.\n- **Maximum Parastichy Order**: $Q_{\\max} = 34$.\n- **Inverse Problem Data**: For each test case $j$, a set of $M_j$ observations is provided, consisting of strictly increasing radii $\\{r_{j,i}\\}_{i=1}^{M_j}$ and corresponding unordered parastichy pairs $\\{\\{L_{j,i}, R_{j,i}\\}\\}_{i=1}^{M_j}$.\n- **Parameter Constraints**: A single global divergence angle $\\theta_j$ is assumed for each case. The plastochron ratios $\\{a_{j,i}\\}_{i=1}^{M_j}$ must be monotone nondecreasing with the observation index $i$, i.e., $a_{j,1} \\le a_{j,2} \\le \\dots \\le a_{j,M_j}$.\n- **Search Space**: The parameters are constrained to $a_{j,i} \\in [1.01, 1.30]$ and $\\theta_j \\in [130^\\circ, 150^\\circ]$.\n- **Uniqueness Rule**:\n    1.  Consider only $\\theta_j$ values that admit at least one valid nondecreasing sequence $\\{a_{j,i}\\}$.\n    2.  Among these feasible $\\theta_j$, select the one that maximizes the score $S(\\theta_j) = \\sum_{i=1}^{M_j} \\text{measure}(A_i(\\theta_j))$, where $A_i(\\theta_j)$ is the set of $a \\in [1.01, 1.30]$ for which the pair $\\{L_{j,i}, R_{j,i}\\}$ is predicted.\n    3.  If multiple $\\theta_j$ values yield the maximal score, the smallest $\\theta_j$ is chosen.\n    4.  For the selected $\\theta_j$, the solution sequence $\\{a_{j,i}\\}$ is the \"pointwise minimal (greedy, leftmost)\" nondecreasing sequence satisfying the constraints.\n- **Output Format**: $\\theta_j$ in degrees rounded to three decimals; $a_{j,i}$ as unitless ratios rounded to three decimals. The results for all cases are to be concatenated into a single flat list.\n- **Test Suite**:\n    - Case $1$: radii $\\{1.0, 1.5, 2.0, 3.0\\}$, pairs $[\\{8,13\\}, \\{5,8\\}, \\{3,5\\}, \\{2,3\\}]$.\n    - Case $2$: radii $\\{1.0, 2.0\\}$, pairs $[\\{5,8\\}, \\{3,5\\}]$.\n    - Case $3$: radius $\\{1.0\\}$, pair $[\\{1,2\\}]$.\n\n### Step 2: Validate Using Extracted Givens\n\n- **Scientific Grounding**: The problem is founded on the canonical generative spiral model of phyllotaxis, a well-established and fundamental concept in mathematical biology. The distance minimization criterion for identifying visible parastichies is a standard technique. The problem is scientifically rigorous and sound.\n- **Well-Posedness**: The problem is well-posed. Although it is a complex inverse problem, the search space is bounded, and the uniqueness rule provides a clear objective function and tie-breaking criteria for selecting $\\theta_j$. The additional rule for selecting the sequence $\\{a_{j,i}\\}$ ensures a single, deterministic solution for any valid input.\n- **Objectivity**: The problem is stated in precise, objective mathematical language, free from ambiguity or subjective claims. All terms are formally defined.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. It is a well-defined, scientifically grounded computational task. The provided constraints and uniqueness rules structure a complex inverse problem into a solvable, albeit computationally intensive, search and optimization procedure. Proceeding to solution.\n\n### Algorithmic Solution\n\nThe problem requires finding parameters $(\\theta_j, \\{a_{j,i}\\})$ that are consistent with observed data, subject to a specific optimization criterion. The relationship between the parameters and the observed parastichy pairs is highly non-linear, making direct analytical inversion intractable. Therefore, a numerical approach based on a systematic grid search over the parameter space is the most robust strategy.\n\n**1. Discretization of the Parameter Space**\nThe continuous parameter space for the divergence angle $\\theta$ and the plastochron ratio $a$ is discretized into fine grids. The angle $\\theta$ is sampled from its domain $[\\$130^\\circ\\$, \\$150^\\circ\\$]$ and the ratio $a$ is sampled from its domain $[\\$1.01\\$, \\$1.30\\$]$. The resolution of these grids determines the precision of the search.\n\n**2. Precomputation of the Forward Map**\nA crucial step for efficiency is to precompute the forward map, which maps each pair of parameters $(\\theta, a)$ from the discretized grids to its corresponding predicted parastichy pair. This map, denoted $\\mathcal{P}(\\theta, a)$, is constructed as follows:\n- For each grid point $(\\theta_k, a_l)$:\n- Calculate the normalized chord distance $\\delta(q; a_l, \\theta_k)$ for all possible parastichy orders $q \\in \\{1, 2, \\dots, Q_{\\max}\\}$.\n- Identify the two values of $q$ that yield the two smallest distances. These two values form the unordered parastichy pair $\\mathcal{P}(\\theta_k, a_l)$.\nThis entire map is stored in a lookup table (a multi-dimensional array), allowing for constant-time retrieval of the predicted pair for any grid point.\n\n**3. Solving a Test Case**\nFor each test case, the algorithm iterates through all discrete $\\theta_k$ values in the search grid to find the optimal one according to the problem's rules.\n\n**3.1. Feasibility and Scoring of $\\theta_k$**\nFor a given candidate angle $\\theta_k$:\n- First, the set of feasible plastochron ratios, $A_i(\\theta_k)$, is determined for each observation $i$ by querying the precomputed map $\\mathcal{P}$. $A_i(\\theta_k)$ consists of all $a_l$ values on the grid for which $\\mathcal{P}(\\theta_k, a_l)$ matches the $i$-th observed parastichy pair.\n- The feasibility of $\\theta_k$ is then checked. An angle is feasible if and only if there exists at least one monotone nondecreasing sequence $\\{a_{j,i}\\}$ where each $a_{j,i}$ is chosen from its respective feasible set $A_i(\\theta_k)$. This is verified with a greedy test: one must be able to select $a_1 \\in A_1(\\theta_k)$, then $a_2 \\in A_2(\\theta_k)$ with $a_2 \\ge a_1$, and so on for all observations. If such a path does not exist, $\\theta_k$ is discarded.\n- If $\\theta_k$ is feasible, its score, $S(\\theta_k)$, is calculated as the sum of the measures of the feasible sets, $S(\\theta_k) = \\sum_i \\text{measure}(A_i(\\theta_k))$. In our discrete model, the measure is proportional to the count of grid points in each set.\n\n**3.2. Selection of Optimal Angle $\\theta_j^*_j$**\nThe algorithm maintains the feasible angle with the highest score found so far. The iteration over $\\theta_k$ from smallest to largest naturally handles the tie-breaking rule, which mandates selecting the smallest angle in case of a score tie.\n\n**4. Determination of Plastochron Ratios $\\{a_{j,i}\\}^*_{j,i}$**\nOnce the optimal angle $\\theta_j^*$ for a test case is identified, the corresponding sequence of plastochron ratios $\\{a_{j,i}\\}^*$ is constructed. This is done by applying the \"pointwise minimal (greedy, leftmost)\" rule:\n- $a_{j,1}^*$ is chosen as the minimum value in the feasible set $A_1(\\theta_j^*)$.\n- For each subsequent observation $i > 1$, $a_{j,i}^*$ is chosen as the minimum value in its feasible set $A_i(\\theta_j^*)$ that is also greater than or equal to the previously determined ratio $a_{j,i-1}^*$.\n\nThis deterministic procedure is applied to each test case. The resulting optimal angles and plastochron ratio sequences are then rounded to three decimal places and formatted into the required single-line output.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes the divergence angle and plastochron ratios for phyllotactic patterns.\n    \"\"\"\n    \n    # Define constants from the problem statement\n    Q_MAX = 34\n    A_MIN, A_MAX = 1.01, 1.30\n    THETA_MIN, THETA_MAX = 130.0, 150.0\n\n    # Grid resolution. These values offer a balance between precision and\n    # computational cost (memory and time).\n    NUM_THETA = 2001  # Corresponds to a step of 0.01 degrees\n    NUM_A = 291     # Corresponds to a step of 0.001\n\n    # Create the discretized parameter grids\n    theta_grid = np.linspace(THETA_MIN, THETA_MAX, NUM_THETA, dtype=np.float64)\n    a_grid = np.linspace(A_MIN, A_MAX, NUM_A, dtype=np.float64)\n    q_vals = np.arange(1, Q_MAX + 1, dtype=np.int32)\n\n    # --- Precomputation of the Forward Map ---\n    # This step maps each (theta, a) grid point to its predicted parastichy pair.\n    # Vectorized computation using numpy broadcasting is used for efficiency.\n    \n    # Reshape arrays for broadcasting\n    theta_rad = np.deg2rad(theta_grid).reshape(-1, 1, 1)  # Shape: (NUM_THETA, 1, 1)\n    a_vals_b = a_grid.reshape(1, -1, 1)                  # Shape: (1, NUM_A, 1)\n    q_vals_b = q_vals.reshape(1, 1, -1)                  # Shape: (1, 1, Q_MAX)\n\n    # Calculate delta^2 = 1 + a^(2q) - 2*a^q*cos(q*theta) across the entire grid\n    cos_term = np.cos(q_vals_b * theta_rad)              # Broadcasts to (NUM_THETA, NUM_A, Q_MAX)\n    a_pow_q = a_vals_b ** q_vals_b                       # Broadcasts to (NUM_THETA, NUM_A, Q_MAX)\n    delta_sq = 1 + a_pow_q**2 - 2 * a_pow_q * cos_term   # Shape: (NUM_THETA, NUM_A, Q_MAX)\n\n    # Use argpartition to find the indices of the two smallest delta_sq values for each (theta, a)\n    top_two_indices = np.argpartition(delta_sq, 2, axis=2)[:, :, :2]\n\n    # Retrieve the q values (parastichy numbers) and sort them to create canonical pairs\n    parastichy_map = np.sort(q_vals[top_two_indices], axis=2)\n\n    # --- Test Cases ---\n    test_cases = [\n        [frozenset([8, 13]), frozenset([5, 8]), frozenset([3, 5]), frozenset([2, 3])],\n        [frozenset([5, 8]), frozenset([3, 5])],\n        [frozenset([1, 2])],\n    ]\n\n    final_results_flat = []\n\n    for case_observations in test_cases:\n        best_theta = -1.0\n        max_score = -1\n        best_theta_a_indices_collection = None\n\n        # Iterate through all discrete theta values to find the optimal one\n        for theta_idx, theta in enumerate(theta_grid):\n            \n            # For the current theta, find feasible 'a' indices for each observation\n            all_obs_feasible_a_indices = []\n            for obs_pair in case_observations:\n                sorted_obs_pair = np.array(sorted(list(obs_pair)), dtype=np.int32)\n                matches = np.all(parastichy_map[theta_idx, :, :] == sorted_obs_pair, axis=1)\n                feasible_a_indices = np.where(matches)[0]\n                all_obs_feasible_a_indices.append(feasible_a_indices)\n\n            # Check if a non-decreasing sequence of 'a' values is possible (feasibility)\n            last_a_idx = -1\n            path_possible = True\n            for feasible_indices in all_obs_feasible_a_indices:\n                if feasible_indices.size == 0:\n                    path_possible = False\n                    break\n                # Find the smallest 'a' index for this observation that is >= the last one\n                possible_next_indices = feasible_indices[feasible_indices >= last_a_idx]\n                if possible_next_indices.size == 0:\n                    path_possible = False\n                    break\n                # We only need to confirm a path exists, using the greedy choice\n                last_a_idx = possible_next_indices[0]\n\n            # If theta is feasible, calculate its score and update the best theta if necessary\n            if path_possible:\n                current_score = sum(len(indices) for indices in all_obs_feasible_a_indices)\n                \n                if current_score > max_score:\n                    max_score = current_score\n                    best_theta = theta\n                    best_theta_a_indices_collection = all_obs_feasible_a_indices\n        \n        # Once optimal theta is found, reconstruct the plastochron ratio sequence\n        final_a_values = []\n        last_a_idx = -1\n        for feasible_indices in best_theta_a_indices_collection:\n            possible_next_indices = feasible_indices[feasible_indices >= last_a_idx]\n            chosen_a_idx = possible_next_indices[0]\n            final_a_values.append(a_grid[chosen_a_idx])\n            last_a_idx = chosen_a_idx\n\n        # Append results for the current case to the final list\n        final_results_flat.append(f\"{best_theta:.3f}\")\n        for a_val in final_a_values:\n            final_results_flat.append(f\"{a_val:.3f}\")\n            \n    # Print the final result in the exact required format\n    print(f\"[{','.join(final_results_flat)}]\")\n\nsolve()\n```", "id": "2597382"}, {"introduction": "Moving beyond descriptive modeling, this final practice challenges you to engage in mechanistic hypothesis testing, a hallmark of advanced scientific inquiry. While many phyllotactic patterns converge to the golden angle, significant and stable deviations are common in nature, demanding a causal explanation. This exercise guides you through the process of formalizing a leading biological hypothesis—that anisotropic inhibitory fields in the shoot apical meristem cause these deviations—into a rigorous, quantitative statistical test [@problem_id:2597327]. You will learn how to connect abstract biophysical theory to a concrete data analysis plan capable of validating or refuting a mechanistic model.", "problem": "A plant species exhibits a consistent deviation of its mean divergence angle from the classical golden angle of approximately $137.5^\\circ$ across multiple individuals grown under identical conditions. High-resolution time-lapse confocal imaging of the shoot apical meristem yields, for each newly initiated primordium indexed by $i$, the divergence angle $\\delta_i$ (in radians) relative to the previous primordium, the azimuth of the previous primordium $\\theta_{i-1}$ on the meristem rim, the instantaneous orientation $\\phi_i$ of the principal anatomical axis of the apical dome (estimated from the ellipse of curvature), and a scalar measure $e_i \\in [0,1]$ of apical dome ellipticity (larger values indicate greater anisotropy). The plastochron and meristem radius are also recorded and are approximately constant over the observational window.\n\nConsider the inhibitory field model of phyllotaxis at the peripheral zone: primordia initiate at angular positions on a circle where a cumulative inhibitory potential $V(\\theta)$, arising from existing organs, attains a local minimum. Assume the following foundational base, which you may use without further justification:\n- The placement rule is minimization of a scalar potential $V(\\theta)$ along the circle of initiation.\n- In the isotropic case, the individual contribution of a primordium located at angle $\\psi$ to the potential at angle $\\theta$ depends only on the angular difference $\\theta-\\psi$ via a smooth, even, unimodal repulsive kernel.\n- Small geometric anisotropy of the tissue can be modeled as a weak azimuthal modulation of the inhibitory sensitivity with the lowest nontrivial angular order dictated by apical dome ellipticity.\n\nYou are asked to decide, using a rigorous quantitative procedure grounded in these principles, whether anisotropy of the inhibitory field can explain the observed deviations from the golden angle in this species.\n\nWhich of the following proposed tests most directly and rigorously addresses this question?\n\nA. Fit a mechanistic anisotropy-augmented inhibitory model in which the effective sensitivity includes a quadrupolar modulation proportional to $e_i$ with axis $\\phi_i$, leading (under first-order perturbation around the isotropic minimum) to a predicted shift of the divergence angle that is proportional to $e_i \\cos\\!\\big(2(\\theta_{i-1}-\\phi_i)\\big)$. Cast residuals as draws from a von Mises (circular normal) distribution with concentration parameter $\\kappa$ and perform a nested maximum-likelihood comparison between an isotropic baseline (anisotropy coefficient fixed to $0$) and the anisotropic model (anisotropy coefficient free) via a Likelihood Ratio Test (LRT). Conclude that inhibitory field anisotropy explains the deviation if and only if the LRT is significant at a pre-specified level and the estimated anisotropy coefficient has the sign predicted by the mechanistic model; include meristem radius and plastochron as covariates to control for confounds.\n\nB. Compute the sample mean of $\\{\\delta_i\\}$ and perform a one-sample $t$-test against $137.5^{\\circ}$. Conclude that anisotropy explains the deviation if the test is significant.\n\nC. Apply the Rayleigh test for non-uniformity to the set of residuals $\\{\\delta_i - 137.5^{\\circ}\\}$ pooled over all plants. Conclude that anisotropy explains the deviation if the residuals are non-uniform on the circle.\n\nD. Reorient plants by rotating pots by $90^\\circ$ relative to gravity midway through imaging. If the mean divergence angle changes after rotation, conclude that anisotropy of the inhibitory field explains the deviation from the golden angle. No parametric modeling or explicit coupling to $\\phi_i$ is required.", "solution": "We begin from the placement rule: new primordia initiate at angular positions $\\theta$ on a circle where the cumulative inhibitory potential $V(\\theta)$ is minimized. In the isotropic case, the contribution to $V(\\theta)$ from a single primordium at $\\psi$ is a smooth, even function $I(\\theta-\\psi)$ with $I'(\\cdot)$ odd and $I''(\\cdot)$ even, and the observed divergence angle $\\delta$ tends toward the value that optimizes packing, empirically near the golden angle. Deviations from this angle can arise from departures from the isotropic assumptions, including anisotropy of the tissue that modulates inhibitory sensitivity with azimuth.\n\nA minimal anisotropy consistent with an elliptic geometry of the apical dome is an order-$2$ (quadrupolar) angular modulation. Let the local sensitivity to inhibition at angle $\\theta$ be scaled by a factor $S(\\theta) = 1 + \\varepsilon \\, e \\cos\\!\\big(2(\\theta-\\phi)\\big)$, where $\\varepsilon$ is a small dimensionless coefficient capturing the proportionality between ellipticity and anisotropic modulation, $e \\in [0,1]$ quantifies ellipticity, and $\\phi$ is the axis of symmetry (major axis) of the apical dome. Then, to first order in $\\varepsilon$, the cumulative potential from existing primordia located at angles $\\{\\psi_j\\}$ is\n$$\nV(\\theta) \\approx \\sum_j I(\\theta-\\psi_j)\\,\\big[1 + \\varepsilon \\, e \\cos\\!\\big(2(\\theta-\\phi)\\big)\\big].\n$$\nThe initiation angle $\\theta^\\ast$ satisfies the stationarity condition $\\partial_\\theta V(\\theta^\\ast) = 0$. Consider a perturbative expansion around the isotropic minimizer at angle $\\theta_0$ (which, relative to the last primordium at angle $\\theta_{\\text{prev}}$, would correspond to $\\delta_0 = \\theta_0 - \\theta_{\\text{prev}}$ near the golden angle). Let $\\theta^\\ast = \\theta_0 + \\Delta$ with $|\\Delta| \\ll 1$. Differentiating and expanding to first order in $\\Delta$ and $\\varepsilon$,\n$$\n0 = \\partial_\\theta V(\\theta^\\ast) \\approx \\sum_j \\Big[ I'(\\theta_0-\\psi_j) + I''(\\theta_0-\\psi_j)\\,\\Delta \\Big]\\big[1 + \\varepsilon \\, e \\cos\\!\\big(2(\\theta_0-\\phi)\\big)\\big] - \\sum_j I(\\theta_0-\\psi_j)\\, \\varepsilon \\, e \\, 2 \\sin\\!\\big(2(\\theta_0-\\phi)\\big)\\,,\n$$\nwhere the derivative of $\\cos\\!\\big(2(\\theta-\\phi)\\big)$ produces a $-2\\sin\\!\\big(2(\\theta-\\phi)\\big)$ factor. In the isotropic baseline, $\\sum_j I'(\\theta_0-\\psi_j)=0$ by definition of $\\theta_0$ as a minimum. Retaining leading terms yields\n$$\n\\Delta \\sum_j I''(\\theta_0-\\psi_j) \\approx \\varepsilon \\, e \\left[ 2 \\sin\\!\\big(2(\\theta_0-\\phi)\\big)\\,\\sum_j I(\\theta_0-\\psi_j) \\right].\n$$\nThus\n$$\n\\Delta \\approx \\varepsilon \\, e \\, G \\, \\sin\\!\\big(2(\\theta_0-\\phi)\\big),\n$$\nwith a constant $G = \\dfrac{2\\sum_j I(\\theta_0-\\psi_j)}{\\sum_j I''(\\theta_0-\\psi_j)}$ determined by the kernel shape and the current phyllotactic state. For sequences dominated by the nearest previous primordium at $\\psi_{j}=\\theta_{\\text{prev}}$, $\\theta_0 - \\psi_j \\approx \\delta_0$, and the dependence on the anisotropy axis enters through the relative angle $\\theta_{\\text{prev}} - \\phi$. Up to a phase shift between sine and cosine determined by $G$ and the expansion point, this predicts that the first-order shift of the divergence angle from its isotropic value is proportional to a quadrupolar function of the misalignment with the anisotropy axis:\n$$\n\\delta - \\delta_0 = \\Delta \\approx \\beta \\, e \\, \\cos\\!\\big(2(\\theta_{\\text{prev}}-\\phi)\\big),\n$$\nfor some coefficient $\\beta$ (absorbing $G$ and the phase). This provides a testable directional signature: deviations should covary with $e$ and with the order-$2$ angular contrast between $\\theta_{\\text{prev}}$ and $\\phi$.\n\nA statistically principled test should therefore:\n- Link deviations of $\\delta_i$ from a baseline angle $\\alpha$ to the measured anisotropy $e_i$ and axis $\\phi_i$ through the predicted quadrupolar coupling to $\\theta_{i-1}$.\n- Account for the circular nature of angular errors (periodicity) using an appropriate noise model such as the von Mises (circular normal) distribution with concentration $\\kappa$.\n- Compare a nested isotropic baseline (no anisotropy coupling) to an anisotropic alternative using a Likelihood Ratio Test (LRT), a standard frequentist device for nested models.\n\nConcretely, define a generative model for $\\delta_i$:\n$$\n\\delta_i \\sim \\text{von Mises}\\!\\left(\\mu_i, \\kappa\\right), \\quad \\mu_i = \\alpha + \\beta \\, e_i \\cos\\!\\big(2(\\theta_{i-1}-\\phi_i)\\big) + \\mathbf{z}_i^\\top \\boldsymbol{\\gamma},\n$$\nwhere $\\alpha$ is the baseline divergence (near the golden angle but estimated from data), $\\beta$ encodes the anisotropy effect predicted above, and $\\mathbf{z}_i$ includes covariates such as meristem radius and plastochron to control for confounds with coefficients $\\boldsymbol{\\gamma}$. The isotropic null sets $\\beta=0$; the anisotropic alternative estimates $\\beta$ freely. The log-likelihood under the von Mises density $f(\\delta \\mid \\mu,\\kappa) = \\dfrac{1}{2\\pi I_0(\\kappa)} \\exp\\!\\big(\\kappa \\cos(\\delta-\\mu)\\big)$, where $I_0(\\cdot)$ is the modified Bessel function of the first kind of order $0$, is\n$$\n\\ell(\\alpha,\\beta,\\boldsymbol{\\gamma},\\kappa) = \\sum_i \\left[ -\\log\\!\\big(2\\pi I_0(\\kappa)\\big) + \\kappa \\cos\\!\\big(\\delta_i - \\mu_i\\big) \\right].\n$$\nMaximization yields $\\hat{\\ell}_{\\text{iso}}$ at $\\beta=0$ and $\\hat{\\ell}_{\\text{aniso}}$ at unconstrained $\\beta$. The Likelihood Ratio Test (LRT) statistic\n$$\n\\Lambda = 2\\big(\\hat{\\ell}_{\\text{aniso}} - \\hat{\\ell}_{\\text{iso}}\\big)\n$$\nis asymptotically $\\chi^2$-distributed with $\\,$$1$ degree of freedom under the null, permitting a significance decision. A sign-consistency check on $\\hat{\\beta}$ relative to the predicted mapping between $e$ and divergence shift provides mechanistic validation.\n\nWe now evaluate each option:\n\nOption A: This option proposes exactly the mechanistically justified quadrupolar coupling $\\propto e_i \\cos\\!\\big(2(\\theta_{i-1}-\\phi_i)\\big)$ derived above, uses an appropriate circular error model (von Mises), performs a nested maximum-likelihood comparison between an isotropic baseline and an anisotropic alternative via a Likelihood Ratio Test (LRT), and controls for covariates such as meristem radius and plastochron. It also requires that the estimated anisotropy coefficient’s sign matches the mechanistic prediction. This directly operationalizes the first-principles derivation and furnishes a rigorous quantitative decision. Verdict — Correct.\n\nOption B: A one-sample $t$-test of the mean divergence angle against $137.5^\\circ$ ignores the directional signature of anisotropy, the dependence on $\\theta_{i-1}$ and $\\phi_i$, the measured ellipticity $e_i$, and the circular nature of the data. A significant difference from the golden angle could arise from multiple causes (e.g., changes in organ size, growth kinetics, or non-anisotropic alterations of the inhibition kernel), and failure to reject does not rule out anisotropy. This does not test the anisotropy mechanism. Verdict — Incorrect.\n\nOption C: The Rayleigh test checks for non-uniformity of angular data around the circle but, applied to residuals about $137.5^\\circ$, it does not incorporate the predicted order-$2$ coupling to the anisotropy axis or the measured ellipticity. Non-uniform residuals could reflect other structured deviations; uniform residuals do not exclude anisotropy if effects cancel across orientations. This is not a targeted, mechanistically informed test. Verdict — Incorrect.\n\nOption D: Rotating the plant by $90^\\circ$ relative to gravity is a perturbation experiment, but it does not, by itself, quantify the coupling between divergence deviations and the intrinsic anisotropy axis $\\phi$ of the apical dome or distinguish inhibitory field anisotropy from other gravity-dependent processes (e.g., differential growth via gravitropism). Without parametric modeling tied to $\\phi_i$ and $e_i$, this is neither specific nor rigorous as a test of inhibitory field anisotropy explaining the deviation. Verdict — Incorrect.", "answer": "$$\\boxed{A}$$", "id": "2597327"}]}