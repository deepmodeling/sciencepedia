{"hands_on_practices": [{"introduction": "The concept of herd immunity is the cornerstone of public health vaccination strategy. This practice builds your understanding from first principles, starting with the relationship between the basic reproduction number ($R_0$) and the effective reproduction number ($R_e$). You will derive the classic formula for the herd immunity threshold, $H^* = 1 - \\frac{1}{R_0}$, which represents the minimum fraction of a population that must be immune to prevent an epidemic from growing. This exercise then takes a crucial step further by guiding you to analyze how uncertainty in our estimate of $R_0$ propagates to uncertainty in the calculated herd immunity target, a vital skill for both research and public health communication [@problem_id:2543678].", "problem": "In a large, homogeneously mixing host population governed by the Susceptible–Infectious–Removed (SIR) framework, the basic reproduction number $R_{0}$ is defined as the expected number of secondary infections generated by a single typical infectious individual in a wholly susceptible population. Let $H \\in [0,1]$ denote the immune fraction (for example, immune due to sterilizing vaccination or prior infection), so that the susceptible fraction is $S = 1 - H$. It is a well-tested fact that at the start of an epidemic, when depletion of susceptibles by infection is negligible, the effective reproduction number satisfies $R_{\\mathrm{e}} = R_{0} S$. Sustained transmission requires $R_{\\mathrm{e}} > 1$, and prevention of sustained transmission requires $R_{\\mathrm{e}} < 1$.\n\nStarting from these foundational facts, derive the minimal immune fraction $H^{*}$ that just prevents sustained transmission (that is, the threshold at which $R_{\\mathrm{e}} = 1$). Then, treat $H^{*}$ as an explicit function of $R_{0}$ and, using a first-order Taylor (delta-method) approximation, obtain the leading-order linear uncertainty propagation from uncertainty in $R_{0}$ to uncertainty in $H^{*}$; that is, if the standard deviation of $R_{0}$ is $\\sigma_{R_{0}}$, define the sensitivity coefficient $c$ by $\\sigma_{H^{*}} \\approx c\\,\\sigma_{R_{0}}$ and express $c$ in terms of $R_{0}$.\n\nFinally, evaluate both quantities at $R_{0} = 3.5$. For the minimal immune fraction $H^{*}$ at $R_{0} = 3.5$, report your result as a decimal fraction rounded to four significant figures (do not use a percentage sign). For the sensitivity coefficient $c$ at $R_{0} = 3.5$, provide an exact expression. Report your final result as a two-entry row matrix $\\big[\\,H^{*},\\,c\\,\\big]$ with no units inside the matrix.", "solution": "The problem statement is subjected to validation.\n\nGivens are extracted verbatim as follows:\n1.  The population is large, homogeneously mixing, and governed by the Susceptible–Infectious–Removed (SIR) framework.\n2.  The basic reproduction number is $R_{0}$.\n3.  The immune fraction is $H \\in [0,1]$.\n4.  The susceptible fraction is $S = 1 - H$.\n5.  The effective reproduction number is $R_{\\mathrm{e}} = R_{0} S$ at the start of an epidemic.\n6.  Sustained transmission requires $R_{\\mathrm{e}} > 1$.\n7.  Prevention of sustained transmission requires $R_{\\mathrm{e}} < 1$.\n8.  The task is to find the minimal immune fraction $H^{*}$ that just prevents sustained transmission, where $R_{\\mathrm{e}} = 1$.\n9.  The task is to find the sensitivity coefficient $c$ in the relation $\\sigma_{H^{*}} \\approx c\\,\\sigma_{R_{0}}$, derived from a first-order Taylor approximation.\n10. The values must be evaluated at $R_{0} = 3.5$.\n11. The value for $H^{*}$ must be a decimal fraction rounded to four significant figures.\n12. The value for $c$ must be an exact expression.\n\nThe problem is validated against the mandatory criteria.\n*   **Scientific Grounding**: The problem is built upon the foundational principles of mathematical epidemiology, specifically the SIR model and the concept of the herd immunity threshold. The relation $R_{\\mathrm{e}} = R_{0} S$ is a cornerstone of this field. Thus, the problem is scientifically sound.\n*   **Well-Posedness**: The objectives are clearly stated and mathematically derivable from the provided premises. The questions ask for specific quantities ($H^{*}$ and $c$) for which unique solutions exist.\n*   **Objectivity**: The problem is stated using precise, quantitative, and unbiased language.\n\nThe problem is deemed valid as it does not exhibit any of the enumerated flaws. It is scientifically grounded, well-posed, and objective. The solution proceeds.\n\nThe first objective is to derive the minimal immune fraction, denoted $H^{*}$, required to prevent sustained transmission. The threshold for preventing sustained transmission is the point at which the effective reproduction number, $R_{\\mathrm{e}}$, is equal to $1$. At this threshold, each infectious individual produces, on average, one new infection, so the epidemic does not grow.\n\nWe are given the relation:\n$$R_{\\mathrm{e}} = R_{0} S$$\nWe are also given that the susceptible fraction $S$ is related to the immune fraction $H$ by:\n$$S = 1 - H$$\nSubstituting the expression for $S$ into the equation for $R_{\\mathrm{e}}$ yields:\n$$R_{\\mathrm{e}} = R_{0} (1 - H)$$\nTo find the herd immunity threshold $H^{*}$, we set $R_{\\mathrm{e}} = 1$:\n$$1 = R_{0} (1 - H^{*})$$\nWe now solve for $H^{*}$ as a function of $R_{0}$. This is under the assumption that $R_{0} > 1$, which is the necessary condition for an epidemic to be possible in the first place. If $R_{0} \\le 1$, no epidemic can occur even in a fully susceptible population, and the required immune fraction is $0$. Given the context and the value $R_{0} = 3.5$, the assumption $R_{0} > 1$ is valid.\n$$\\frac{1}{R_{0}} = 1 - H^{*}$$\n$$H^{*} = 1 - \\frac{1}{R_{0}}$$\nThis expression gives the minimal immune fraction needed to achieve herd immunity.\n\nThe second objective is to determine the sensitivity coefficient $c$ that relates the uncertainty in $H^{*}$ to the uncertainty in $R_{0}$. This is achieved using a first-order Taylor series approximation, also known as the delta method. For a function $H^{*}(R_{0})$, the uncertainty propagation is given by:\n$$\\sigma_{H^{*}} \\approx \\left| \\frac{dH^{*}}{dR_{0}} \\right| \\sigma_{R_{0}}$$\nThe problem defines the sensitivity coefficient $c$ as the factor in this approximation:\n$$c = \\left| \\frac{dH^{*}}{dR_{0}} \\right|$$\nWe must compute the derivative of $H^{*}(R_{0}) = 1 - \\frac{1}{R_{0}} = 1 - R_{0}^{-1}$ with respect to $R_{0}$:\n$$\\frac{dH^{*}}{dR_{0}} = \\frac{d}{dR_{0}} \\left( 1 - R_{0}^{-1} \\right) = 0 - (-1)R_{0}^{-2} = \\frac{1}{R_{0}^{2}}$$\nSince $R_{0}^{2}$ is always positive for $R_{0} > 1$, the derivative is positive, and the absolute value is redundant. Therefore, the sensitivity coefficient is:\n$$c = \\frac{1}{R_{0}^{2}}$$\n\nFinally, we evaluate both $H^{*}$ and $c$ for the given value $R_{0} = 3.5$.\n\nFor the minimal immune fraction $H^{*}$:\n$$H^{*} = 1 - \\frac{1}{3.5} = 1 - \\frac{1}{7/2} = 1 - \\frac{2}{7} = \\frac{5}{7}$$\nThe problem requires this result as a decimal fraction rounded to four significant figures.\n$$\\frac{5}{7} \\approx 0.7142857...$$\nRounding to four significant figures, we get:\n$$H^{*} \\approx 0.7143$$\n\nFor the sensitivity coefficient $c$:\n$$c = \\frac{1}{R_{0}^{2}} = \\frac{1}{(3.5)^{2}}$$\nThe problem requires an exact expression for this value.\n$$(3.5)^{2} = \\left(\\frac{7}{2}\\right)^{2} = \\frac{49}{4} = 12.25$$\nTherefore,\n$$c = \\frac{1}{49/4} = \\frac{4}{49}$$\n\nThe final answer is to be reported as a two-entry row matrix $\\begin{pmatrix} H^{*}  c \\end{pmatrix}$.\nThe two calculated values are $H^{*} \\approx 0.7143$ and $c = \\frac{4}{49}$.\nThe matrix is thus $\\begin{pmatrix} 0.7143  \\frac{4}{49} \\end{pmatrix}$.", "answer": "$$\\boxed{\\begin{pmatrix} 0.7143  \\frac{4}{49} \\end{pmatrix}}$$", "id": "2543678"}, {"introduction": "While theoretical thresholds provide a target, the journey begins with measuring a vaccine's power. This exercise bridges theory and practice by tasking you with analyzing data from a hypothetical Randomized Controlled Trial (RCT). You will calculate the direct vaccine efficacy ($\\text{VE}$) against disease using the standard formula based on the relative risk ($\\text{RR}$) of infection between vaccinated and unvaccinated groups. More importantly, this problem prompts a critical analysis of how real-world behaviors, such as differences in exposure, can introduce bias into these estimates, honing your ability to critically appraise and interpret the findings of clinical trials [@problem_id:2543673].", "problem": "An individually randomized, double-blind Randomized Controlled Trial (RCT) was conducted to estimate the direct protection against disease conferred by a candidate inactivated vaccine against an endemic respiratory virus in a closed community over a follow-up of $12$ weeks. At baseline all participants were disease-free, retention at $12$ weeks was $100$ percent, and case definitions and surveillance were identical across arms. Vaccine coverage in the community outside the trial was negligible, so indirect (herd) effects can be ignored for this analysis. In the vaccinated arm, $N_{v} = 4{,}500$ participants were enrolled and $C_{v} = 81$ experienced laboratory-confirmed disease during follow-up. In the unvaccinated (placebo) arm, $N_{u} = 1{,}500$ participants were enrolled and $C_{u} = 108$ experienced laboratory-confirmed disease during follow-up.\n\nStarting from fundamental definitions of cumulative incidence (attack rate), risk, and Relative Risk (RR), and using the interpretation of direct vaccine efficacy against disease as the proportionate reduction in disease risk among vaccinated individuals relative to unvaccinated individuals, first derive the estimand for direct vaccine efficacy in terms of observable quantities, and then compute its value from the trial data. \n\nThen, using a simple mass-action exposure model in which the instantaneous force of infection is proportional to an exposure intensity parameter, qualitatively analyze how a systematic difference in mean exposure intensity between vaccinated and unvaccinated participants would bias the estimator you derived. Let the ratio of mean exposure intensity in vaccinated to unvaccinated participants be denoted by $\\theta$, and assume a multiplicative effect of the vaccine on susceptibility that does not modify exposure intensity. Explain the direction of bias in terms of $\\theta$ without invoking any additional unprovided formulas.\n\nReport only the numerical estimate of the direct vaccine efficacy against disease as a decimal (not a percentage), rounded to $3$ significant figures.", "solution": "We begin from core epidemiologic definitions. Over a fixed follow-up with complete ascertainment, the cumulative incidence (attack rate) in a group is the proportion of participants who experience the outcome during follow-up. For the vaccinated and unvaccinated arms, respectively, these are\n$$\n\\text{AR}_{v} \\equiv \\frac{C_{v}}{N_{v}}, \\qquad \\text{AR}_{u} \\equiv \\frac{C_{u}}{N_{u}}.\n$$\nThe Relative Risk (RR) comparing vaccinated to unvaccinated is defined as\n$$\n\\text{RR} \\equiv \\frac{\\text{risk in vaccinated}}{\\text{risk in unvaccinated}} = \\frac{\\text{AR}_{v}}{\\text{AR}_{u}},\n$$\nunder the conditions of equal follow-up and complete case ascertainment.\n\nDirect vaccine efficacy against disease is defined conceptually as the proportionate reduction in disease risk among vaccinated individuals relative to unvaccinated individuals under otherwise comparable conditions. If the vaccine acts multiplicatively on susceptibility (a standard and well-tested modeling assumption in infectious disease epidemiology), then the risk in vaccinated individuals can be written as\n$$\n\\text{risk}_{v} = (1 - \\text{VE}_{D}^{\\text{true}})\\,\\text{risk}_{u},\n$$\nwhere $\\text{VE}_{D}^{\\text{true}}$ is the true direct vaccine efficacy against disease. Rearranging,\n$$\n\\frac{\\text{risk}_{v}}{\\text{risk}_{u}} = 1 - \\text{VE}_{D}^{\\text{true}} \\quad \\Longrightarrow \\quad \\text{VE}_{D}^{\\text{true}} = 1 - \\frac{\\text{risk}_{v}}{\\text{risk}_{u}}.\n$$\nWith observable risks identified by attack rates in this closed cohort with complete follow-up, the corresponding estimator is\n$$\n\\widehat{\\text{VE}}_{D} = 1 - \\frac{\\text{AR}_{v}}{\\text{AR}_{u}} = 1 - \\text{RR}.\n$$\n\nCompute the attack rates from the data:\n$$\n\\text{AR}_{v} = \\frac{C_{v}}{N_{v}} = \\frac{81}{4{,}500} = 0.018, \\qquad\n\\text{AR}_{u} = \\frac{C_{u}}{N_{u}} = \\frac{108}{1{,}500} = 0.072.\n$$\nHence\n$$\n\\text{RR} = \\frac{0.018}{0.072} = 0.25,\n$$\nand therefore\n$$\n\\widehat{\\text{VE}}_{D} = 1 - 0.25 = 0.75.\n$$\nRounded to $3$ significant figures and expressed as a decimal, this is $0.750$.\n\nWe now analyze bias from differential exposure. Under a mass-action view, the instantaneous force of infection $\\lambda$ is proportional to an exposure intensity parameter and the per-contact infection probability. Let the mean exposure intensity in vaccinated and unvaccinated arms be $E_{v}$ and $E_{u}$, respectively, and define the exposure ratio $\\theta \\equiv E_{v}/E_{u}$. Let the per-contact infection probability and other transmission parameters be shared across arms aside from the vaccine’s multiplicative reduction in susceptibility. Then, in expectation over the follow-up, the vaccinated group experiences a force of infection scaled by $(1 - \\text{VE}_{D}^{\\text{true}})\\theta$ relative to the unvaccinated group. For rare outcomes over a common follow-up duration, the cumulative incidence is approximately proportional to the force of infection, so the observed Relative Risk is approximately\n$$\n\\text{RR}_{\\text{obs}} \\approx (1 - \\text{VE}_{D}^{\\text{true}})\\,\\theta.\n$$\nConsequently, the observed estimator satisfies\n$$\n\\widehat{\\text{VE}}_{D,\\text{obs}} \\approx 1 - (1 - \\text{VE}_{D}^{\\text{true}})\\,\\theta.\n$$\nFrom this expression, the direction of bias is immediate:\n- If $\\theta  1$ (vaccinated participants are, on average, less exposed), then $\\text{RR}_{\\text{obs}}$ is smaller and $\\widehat{\\text{VE}}_{D,\\text{obs}}$ is larger than $\\text{VE}_{D}^{\\text{true}}$; the estimator is biased upward (overestimation).\n- If $\\theta  1$ (vaccinated participants are more exposed), then $\\text{RR}_{\\text{obs}}$ is larger and $\\widehat{\\text{VE}}_{D,\\text{obs}}$ is smaller than $\\text{VE}_{D}^{\\text{true}}$; the estimator is biased downward (underestimation).\n- If $\\theta = 1$ (no differential exposure), then $\\widehat{\\text{VE}}_{D,\\text{obs}}$ is unbiased for $\\text{VE}_{D}^{\\text{true}}$ under the stated assumptions.\n\nIn summary, using fundamental definitions, we obtain the estimator as the complement of the Relative Risk, compute it from the trial data, and show analytically how differential exposure, captured by $\\theta$, biases the estimate upward or downward depending on whether vaccinated individuals experience lower or higher exposure than unvaccinated individuals.", "answer": "$$\\boxed{0.750}$$", "id": "2543673"}, {"introduction": "Immunity is not a static state; it evolves over time due to waning and is bolstered by additional vaccine doses. This advanced computational exercise moves beyond simple efficacy metrics to model the dynamic, time-dependent nature of vaccine protection using a survival analysis framework. You will work with hazard functions, $h(t)$, to quantify how the instantaneous risk of infection is modified by a primary vaccination series and subsequent boosters, each with its own waning rate. By implementing this model, you will gain hands-on experience in quantifying the incremental effectiveness ($\\overline{\\text{IE}}$) of booster campaigns, a skill set at the forefront of modern epidemiology and public health policy [@problem_id:2543669].", "problem": "You are tasked with implementing a program that quantifies the incremental effectiveness of booster doses in a survival (time-to-infection) framework by modeling multiple time-dependent exposures that multiplicatively modify the hazard of infection. The solution must proceed from first principles, using definitions of hazard, cumulative hazard, and vaccine effectiveness, and must not rely on canned shortcuts. All computations are to be performed numerically by direct integration.\n\nThe foundational base consists of:\n- The definition of the hazard function $h(t)$ as the instantaneous rate of event occurrence at time $t$.\n- The cumulative hazard $H(t) = \\int_{0}^{t} h(u)\\,du$ and the relation between hazard ratio and vaccine effectiveness via $VE = 1 - \\text{hazard ratio}$ when comparing two exposure scenarios.\n- The assumption that independent, time-varying exposures act multiplicatively on the hazard on the log-scale.\n\nModel specification:\n- The baseline hazard is $h_0(t) = \\lambda_0 \\cdot m(t)$, where $\\lambda_0$ is a constant baseline hazard (in per-day units) and $m(t)$ is an exogenous, piecewise-constant environmental multiplier that captures time-varying force-of-infection due to factors such as seasonality or contact rates.\n- There are $K$ vaccination doses administered at times $\\tau_k$ for $k \\in \\{1,\\dots,K\\}$, each contributing a time-dependent, decaying protection on the log-hazard scale. The hazard with a specified subset of doses $\\mathcal{S} \\subseteq \\{1,\\dots,K\\}$ active is\n$$\nh_{\\mathcal{S}}(t) \\;=\\; h_0(t)\\,\\exp\\Bigg(-\\sum_{k \\in \\mathcal{S}} \\theta_k \\, e^{-\\omega_k \\,(t-\\tau_k)}\\;\\mathbf{1}\\{t \\ge \\tau_k\\}\\Bigg),\n$$\nwhere $\\theta_k  0$ is the initial log-hazard reduction amplitude after dose $k$, $\\omega_k \\ge 0$ is the waning rate for dose $k$, and $\\mathbf{1}\\{\\cdot\\}$ is the indicator function.\n\nIncremental effectiveness target:\n- For a given observation window $[a,b]$ and a partition of doses into a base regimen $\\mathcal{B}$ and an added set of booster doses $\\mathcal{A}$ (so the full set is $\\mathcal{B} \\cup \\mathcal{A}$), define the time-averaged hazard ratio over the window as the ratio of cumulative hazards:\n$$\n\\overline{\\text{HR}} \\;=\\; \\frac{\\int_{a}^{b} h_{\\mathcal{B}\\cup\\mathcal{A}}(t)\\,dt}{\\int_{a}^{b} h_{\\mathcal{B}}(t)\\,dt}.\n$$\n- Define the incremental effectiveness as $\\overline{\\text{IE}} = 1 - \\overline{\\text{HR}}$, expressed as a decimal (not a percentage).\n- Your program must compute $\\overline{\\text{HR}}$ and $\\overline{\\text{IE}}$ for each specified test case by numerically approximating the integrals using the trapezoidal rule on a uniform time grid with step size $\\Delta t = 0.01$ days.\n\nEnvironmental multiplier $m(t)$:\n- The function $m(t)$ is piecewise constant over intervals $[s_j,e_j)$ with multiplier $c_j$, so that $m(t) = c_j$ when $t \\in [s_j,e_j)$.\n\nUnits and numerical requirements:\n- Time is in days, hazards are per day. Report $\\overline{\\text{HR}}$ and $\\overline{\\text{IE}}$ rounded to six decimal places as decimals (no percent sign).\n\nTest suite:\nImplement your program to compute results for the following five test cases. In each case, the program must use $\\Delta t = 0.01$ days for the numerical integration.\n\n- Test case 1 (primary series plus one booster during the observation window):\n  - Baseline hazard: $\\lambda_0 = 0.01$ per day.\n  - Environmental multiplier: intervals $[0,60)$ with $c=1.0$, $[60,120)$ with $c=1.5$, $[120,365)$ with $c=1.0$.\n  - Doses ($K=3$):\n    - $k=1$: $\\tau_1 = 0$, $\\theta_1 = 1.2$, $\\omega_1 = 0.01$.\n    - $k=2$: $\\tau_2 = 21$, $\\theta_2 = 0.8$, $\\omega_2 = 0.02$.\n    - $k=3$: $\\tau_3 = 150$, $\\theta_3 = 1.0$, $\\omega_3 = 0.03$.\n  - Observation window: $[a,b] = [150,210]$.\n  - Base regimen $\\mathcal{B} = \\{1,2\\}$, added boosters $\\mathcal{A} = \\{3\\}$.\n\n- Test case 2 (booster after the window; checks boundary behavior):\n  - Baseline hazard: $\\lambda_0 = 0.01$ per day.\n  - Environmental multiplier: intervals $[0,60)$ with $c=1.0$, $[60,120)$ with $c=1.5$, $[120,365)$ with $c=1.0$.\n  - Doses ($K=3$):\n    - $k=1$: $\\tau_1 = 0$, $\\theta_1 = 1.2$, $\\omega_1 = 0.01$.\n    - $k=2$: $\\tau_2 = 21$, $\\theta_2 = 0.8$, $\\omega_2 = 0.02$.\n    - $k=3$: $\\tau_3 = 400$, $\\theta_3 = 1.0$, $\\omega_3 = 0.03$.\n  - Observation window: $[a,b] = [150,210]$.\n  - Base regimen $\\mathcal{B} = \\{1,2\\}$, added boosters $\\mathcal{A} = \\{3\\}$.\n\n- Test case 3 (rapid waning of primary series; booster early in window):\n  - Baseline hazard: $\\lambda_0 = 0.02$ per day.\n  - Environmental multiplier: interval $[0,365)$ with $c=1.0$.\n  - Doses ($K=3$):\n    - $k=1$: $\\tau_1 = 0$, $\\theta_1 = 1.0$, $\\omega_1 = 0.10$.\n    - $k=2$: $\\tau_2 = 21$, $\\theta_2 = 0.6$, $\\omega_2 = 0.10$.\n    - $k=3$: $\\tau_3 = 120$, $\\theta_3 = 1.2$, $\\omega_3 = 0.03$.\n  - Observation window: $[a,b] = [120,140]$.\n  - Base regimen $\\mathcal{B} = \\{1,2\\}$, added boosters $\\mathcal{A} = \\{3\\}$.\n\n- Test case 4 (two boosters; incremental effect of both relative to primary series only):\n  - Baseline hazard: $\\lambda_0 = 0.015$ per day.\n  - Environmental multiplier: intervals $[0,180)$ with $c=1.2$, $[180,260)$ with $c=1.6$, $[260,365)$ with $c=1.0$.\n  - Doses ($K=4$):\n    - $k=1$: $\\tau_1 = 0$, $\\theta_1 = 1.0$, $\\omega_1 = 0.01$.\n    - $k=2$: $\\tau_2 = 21$, $\\theta_2 = 0.7$, $\\omega_2 = 0.02$.\n    - $k=3$: $\\tau_3 = 120$, $\\theta_3 = 0.8$, $\\omega_3 = 0.03$.\n    - $k=4$: $\\tau_4 = 200$, $\\theta_4 = 0.6$, $\\omega_4 = 0.05$.\n  - Observation window: $[a,b] = [200,260]$.\n  - Base regimen $\\mathcal{B} = \\{1,2\\}$, added boosters $\\mathcal{A} = \\{3,4\\}$.\n\n- Test case 5 (no waning; checks constant incremental effect independent of $m(t)$):\n  - Baseline hazard: $\\lambda_0 = 0.01$ per day.\n  - Environmental multiplier: intervals $[0,50)$ with $c=1.4$, $[50,110)$ with $c=0.8$, $[110,365)$ with $c=1.2$.\n  - Doses ($K=3$):\n    - $k=1$: $\\tau_1 = 0$, $\\theta_1 = 0.9$, $\\omega_1 = 0.0$.\n    - $k=2$: $\\tau_2 = 21$, $\\theta_2 = 0.7$, $\\omega_2 = 0.0$.\n    - $k=3$: $\\tau_3 = 60$, $\\theta_3 = 0.5$, $\\omega_3 = 0.0$.\n  - Observation window: $[a,b] = [50,110]$.\n  - Base regimen $\\mathcal{B} = \\{1,2\\}$, added boosters $\\mathcal{A} = \\{3\\}$.\n\nFinal output format:\n- Your program should produce a single line of output containing a Python-style list of per-test-case results, where each result is itself a two-element list $[\\overline{\\text{HR}}, \\overline{\\text{IE}}]$, with both values rounded to six decimal places. For example: $[[0.500000,0.500000],[0.750000,0.250000]]$.", "solution": "The problem as stated is scientifically grounded, mathematically well-posed, and provides a complete and consistent specification for a computational task. It is based on standard principles of survival analysis and epidemiological modeling. There are no contradictions, ambiguities, or factual errors. Therefore, the problem is valid and a solution will be provided.\n\nThe objective is to compute the incremental effectiveness, $\\overline{\\text{IE}}$, of a set of booster vaccine doses, $\\mathcal{A}$, when added to a base regimen, $\\mathcal{B}$. This is to be done over a specified observation window $[a, b]$. The calculation proceeds from the fundamental definitions of hazard functions and their relationship to vaccine effectiveness.\n\nFirst, we formalize the quantities to be computed. The problem defines the time-averaged hazard ratio, $\\overline{\\text{HR}}$, as the ratio of cumulative hazards over the window $[a, b]$:\n$$\n\\overline{\\text{HR}} \\;=\\; \\frac{\\int_{a}^{b} h_{\\mathcal{B}\\cup\\mathcal{A}}(t)\\,dt}{\\int_{a}^{b} h_{\\mathcal{B}}(t)\\,dt}\n$$\nThe incremental effectiveness, $\\overline{\\text{IE}}$, is then defined as:\n$$\n\\overline{\\text{IE}} = 1 - \\overline{\\text{HR}}\n$$\nOur primary task is thus to evaluate the two definite integrals in the expression for $\\overline{\\text{HR}}$. These integrals represent the total accumulated hazard under the full regimen ($\\mathcal{F} = \\mathcal{B} \\cup \\mathcal{A}$) and the base regimen ($\\mathcal{B}$), respectively.\n\nThe integrand is the hazard function, $h_{\\mathcal{S}}(t)$, for a given set of vaccine doses $\\mathcal{S}$. It is specified by the model:\n$$\nh_{\\mathcal{S}}(t) \\;=\\; h_0(t)\\,\\exp\\Bigg(-\\sum_{k \\in \\mathcal{S}} \\theta_k \\, e^{-\\omega_k \\,(t-\\tau_k)}\\;\\mathbf{1}\\{t \\ge \\tau_k\\}\\Bigg)\n$$\nHere, $h_0(t) = \\lambda_0 \\cdot m(t)$ is the baseline hazard, which depends on a constant rate $\\lambda_0$ and a time-varying, piecewise-constant environmental multiplier $m(t)$. The exponential term models the combined protective effect of the vaccines in set $\\mathcal{S}$. For each dose $k$, administered at time $\\tau_k$, the effect starts at an initial log-hazard reduction of $\\theta_k$ and wanes exponentially with rate $\\omega_k$. The indicator function $\\mathbf{1}\\{t \\ge \\tau_k\\}$ ensures that a dose contributes to protection only at times $t$ following its administration.\n\nThe problem mandates numerical integration using the trapezoidal rule with a uniform time step of $\\Delta t = 0.01$ days. For an integral $I = \\int_{a}^{b} f(t)\\,dt$, this method requires creating a discrete time grid $t_i = a + i\\Delta t$ for $i=0, 1, \\dots, N$, where $N = (b-a)/\\Delta t$. The integral is then approximated by the sum:\n$$\nI \\approx \\frac{\\Delta t}{2} \\left[ f(t_0) + 2\\sum_{i=1}^{N-1} f(t_i) + f(t_N) \\right]\n$$\nThis numerical scheme must be applied to compute both the numerator and the denominator of $\\overline{\\text{HR}}$.\n\nThe computational procedure is as follows:\n$1$. For each test case, the parameters are extracted: the observation window $[a, b]$, the baseline hazard constant $\\lambda_0$, the definition of the function $m(t)$, the parameters for all doses $(\\tau_k, \\theta_k, \\omega_k)$, and the dose sets for the base regimen $\\mathcal{B}$ and added boosters $\\mathcal{A}$.\n\n$2$. A uniform time grid, denoted as an array `t_grid`, is constructed over the interval $[a, b]$ with step size $\\Delta t = 0.01$. The number of points in this grid will be $N+1$, where $N = (b-a)/\\Delta t$.\n\n$3$. A vectorized function to evaluate the environmental multiplier $m(t)$ for all points in `t_grid` is created. Since $m(t)$ is piecewise-constant over intervals $[s_j, e_j)$, this function will map each time point in `t_grid` to its corresponding multiplier value $c_j$.\n\n$4$. A general function is implemented to calculate the hazard values $h_{\\mathcal{S}}(t)$ across `t_grid` for an arbitrary set of doses $\\mathcal{S}$. This function performs the following steps:\n    a. It computes the log-hazard reduction sum for each time point $t_i$ in `t_grid`. This involves iterating through each dose $k \\in \\mathcal{S}$ and adding its contribution, $\\theta_k e^{-\\omega_k(t_i - \\tau_k)}$, only if $t_i \\ge \\tau_k$.\n    b. It calculates the baseline hazard $h_0(t_i) = \\lambda_0 \\cdot m(t_i)$ for all $t_i$.\n    c. It combines these to compute the final hazard $h_{\\mathcal{S}}(t_i) = h_0(t_i) \\exp(-\\text{sum of log-hazard reductions})$.\n\n$5$. This hazard calculation function is invoked twice:\n    a. Once with the dose set $\\mathcal{B}$ to generate an array of hazard values `hazard_base` over `t_grid`.\n    b. Once with the full dose set $\\mathcal{F} = \\mathcal{B} \\cup \\mathcal{A}$ to generate `hazard_full`.\n\n$6$. The trapezoidal rule is applied to these arrays of values to compute the integrals. Using a library function such as `numpy.trapz` is efficient and correct.\n    $$ \\text{integral\\_base} = \\text{np.trapz}(\\text{hazard\\_base}, x=\\text{t\\_grid}) $$\n    $$ \\text{integral\\_full} = \\text{np.trapz}(\\text{hazard\\_full}, x=\\text{t\\_grid}) $$\n\n$7$. Finally, the required metrics are calculated and rounded to $6$ decimal places:\n    $$ \\overline{\\text{HR}} = \\text{integral\\_full} / \\text{integral\\_base} $$\n    $$ \\overline{\\text{IE}} = 1 - \\overline{\\text{HR}} $$\nThis procedure is repeated for all specified test cases, and the results are aggregated into the required output format.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes incremental vaccine effectiveness based on a time-dependent hazard model.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        {\n            \"lambda0\": 0.01,\n            \"m_params\": [(0, 60, 1.0), (60, 120, 1.5), (120, 365, 1.0)],\n            \"doses\": [\n                {\"tau\": 0, \"theta\": 1.2, \"omega\": 0.01}, # k=1\n                {\"tau\": 21, \"theta\": 0.8, \"omega\": 0.02}, # k=2\n                {\"tau\": 150, \"theta\": 1.0, \"omega\": 0.03}, # k=3\n            ],\n            \"window\": [150, 210],\n            \"base_regimen\": {1, 2},\n            \"added_boosters\": {3},\n        },\n        # Test case 2\n        {\n            \"lambda0\": 0.01,\n            \"m_params\": [(0, 60, 1.0), (60, 120, 1.5), (120, 365, 1.0)],\n            \"doses\": [\n                {\"tau\": 0, \"theta\": 1.2, \"omega\": 0.01}, # k=1\n                {\"tau\": 21, \"theta\": 0.8, \"omega\": 0.02}, # k=2\n                {\"tau\": 400, \"theta\": 1.0, \"omega\": 0.03}, # k=3\n            ],\n            \"window\": [150, 210],\n            \"base_regimen\": {1, 2},\n            \"added_boosters\": {3},\n        },\n        # Test case 3\n        {\n            \"lambda0\": 0.02,\n            \"m_params\": [(0, 365, 1.0)],\n            \"doses\": [\n                {\"tau\": 0, \"theta\": 1.0, \"omega\": 0.10}, # k=1\n                {\"tau\": 21, \"theta\": 0.6, \"omega\": 0.10}, # k=2\n                {\"tau\": 120, \"theta\": 1.2, \"omega\": 0.03}, # k=3\n            ],\n            \"window\": [120, 140],\n            \"base_regimen\": {1, 2},\n            \"added_boosters\": {3},\n        },\n        # Test case 4\n        {\n            \"lambda0\": 0.015,\n            \"m_params\": [(0, 180, 1.2), (180, 260, 1.6), (260, 365, 1.0)],\n            \"doses\": [\n                {\"tau\": 0, \"theta\": 1.0, \"omega\": 0.01}, # k=1\n                {\"tau\": 21, \"theta\": 0.7, \"omega\": 0.02}, # k=2\n                {\"tau\": 120, \"theta\": 0.8, \"omega\": 0.03},# k=3\n                {\"tau\": 200, \"theta\": 0.6, \"omega\": 0.05},# k=4\n            ],\n            \"window\": [200, 260],\n            \"base_regimen\": {1, 2},\n            \"added_boosters\": {3, 4},\n        },\n        # Test case 5\n        {\n            \"lambda0\": 0.01,\n            \"m_params\": [(0, 50, 1.4), (50, 110, 0.8), (110, 365, 1.2)],\n            \"doses\": [\n                {\"tau\": 0, \"theta\": 0.9, \"omega\": 0.0}, # k=1\n                {\"tau\": 21, \"theta\": 0.7, \"omega\": 0.0}, # k=2\n                {\"tau\": 60, \"theta\": 0.5, \"omega\": 0.0}, # k=3\n            ],\n            \"window\": [50, 110],\n            \"base_regimen\": {1, 2},\n            \"added_boosters\": {3},\n        },\n    ]\n\n    dt = 0.01\n    results = []\n\n    for case in test_cases:\n        lambda0 = case[\"lambda0\"]\n        m_params = case[\"m_params\"]\n        all_doses = case[\"doses\"]\n        a, b = case[\"window\"]\n        base_regimen_indices = case[\"base_regimen\"]\n        added_boosters_indices = case[\"added_boosters\"]\n        full_regimen_indices = base_regimen_indices.union(added_boosters_indices)\n\n        # Create a vectorized function for the environmental multiplier m(t)\n        def get_m_values(t_arr, params):\n            m_vals = np.zeros_like(t_arr, dtype=float)\n            for start, end, c_val in params:\n                mask = (t_arr >= start)  (t_arr  end)\n                m_vals[mask] = c_val\n            return m_vals\n\n        # Function to compute hazard for a given time grid and dose set\n        def get_hazard_values(t_arr, dose_indices):\n            # Calculate the sum of log-hazard reductions from all active doses\n            log_hazard_reduction = np.zeros_like(t_arr, dtype=float)\n            for k in dose_indices:\n                dose = all_doses[k - 1] # Problem uses 1-based indexing\n                tau_k, theta_k, omega_k = dose[\"tau\"], dose[\"theta\"], dose[\"omega\"]\n                \n                # Apply effect only for t >= tau_k\n                active_mask = t_arr >= tau_k\n                \n                # Calculate waning effect where applicable\n                time_since_dose = t_arr[active_mask] - tau_k\n                waning_effect = theta_k * np.exp(-omega_k * time_since_dose)\n                \n                log_hazard_reduction[active_mask] += waning_effect\n\n            # Calculate baseline hazard\n            m_vals = get_m_values(t_arr, m_params)\n            h0_vals = lambda0 * m_vals\n            \n            # Combine to get the full hazard\n            hazard_vals = h0_vals * np.exp(-log_hazard_reduction)\n            return hazard_vals\n\n        # Set up the time grid for numerical integration\n        # Use np.linspace for precision with floating point start/end/step\n        num_points = int(round((b - a) / dt)) + 1\n        t_grid = np.linspace(a, b, num_points)\n\n        # Calculate hazard values for both regimens\n        hazard_base = get_hazard_values(t_grid, base_regimen_indices)\n        hazard_full = get_hazard_values(t_grid, full_regimen_indices)\n\n        # Numerically integrate using the trapezoidal rule\n        integral_base = np.trapz(hazard_base, x=t_grid)\n        integral_full = np.trapz(hazard_full, x=t_grid)\n\n        # Guard against division by zero (theoretically possible but not with these inputs)\n        if integral_base == 0:\n            hr = 1.0 if integral_full == 0 else np.inf\n        else:\n            hr = integral_full / integral_base\n\n        ie = 1.0 - hr\n\n        # Append rounded results for the current test case\n        results.append([round(hr, 6), round(ie, 6)])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2543669"}]}